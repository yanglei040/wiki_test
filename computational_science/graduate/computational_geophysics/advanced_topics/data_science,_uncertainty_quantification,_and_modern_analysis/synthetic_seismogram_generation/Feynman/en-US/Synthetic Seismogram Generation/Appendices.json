{
    "hands_on_practices": [
        {
            "introduction": "Before any wave propagation can be modeled, we must first define the computational domain. A critical parameter in this setup is the spatial sampling interval, as it dictates our ability to represent propagating waves without artifacts. This exercise guides you through the process of determining the maximum allowable spacing to prevent spatial aliasing, connecting fundamental wave properties like velocity, frequency, and angle of propagation to the Nyquist sampling theorem. ",
            "id": "3615906",
            "problem": "You are designing a two-dimensional synthetic shot gather for an isotropic acoustic medium using Finite Difference (FD) modeling. Receivers are to be placed along a horizontal line at uniform spacing $\\Delta x$. The modeled source is a band-limited wavelet whose temporal spectrum is negligible above a specified maximum frequency $f_{\\max}$. To ensure that the shot gather exhibits no spatial aliasing for any event whose apparent emergence angle at the receiver line (measured from the vertical) does not exceed a prescribed maximum $\\theta_{\\max}$, you must choose $\\Delta x$ small enough to satisfy the spatial sampling requirements for all plane-wave components present in the data. \n\nStarting from the following fundamental bases:\n- The constant-coefficient acoustic wave equation in two dimensions, whose monochromatic plane-wave solutions $p(x,z,t)=A \\exp\\{ \\mathrm{i}(\\omega t - k_x x - k_z z)\\}$ satisfy the dispersion relation $\\omega^{2} = v^{2}(k_x^{2} + k_z^{2})$, where $v$ is the phase velocity, $\\omega=2\\pi f$ is the angular frequency, and $(k_x,k_z)$ is the wavevector.\n- The Nyquist sampling theorem in space, which states that a band-limited field in wavenumber $k_x$ can be sampled on a spatial grid of spacing $\\Delta x$ without aliasing if its wavenumber support satisfies $|k_x| \\leq \\pi/\\Delta x$,\n\nderive a conservative expression for the maximum allowable receiver spacing $\\Delta x$ that prevents spatial aliasing for all temporal frequencies up to $f_{\\max}$ and all emergence angles up to $\\theta_{\\max}$, when the minimum phase velocity in the model is $v_{\\min}$. Then evaluate this spacing numerically for the design parameters\n$$v_{\\min} = 2.000 \\times 10^{3} \\text{ m/s}, \\quad f_{\\max} = 1.00 \\times 10^{2} \\text{ Hz}, \\quad \\theta_{\\max} = 60.0^\\circ.$$\n\nExpress the final spacing in meters, and round your answer to four significant figures. Use degrees for angles.",
            "solution": "The derivation proceeds by first establishing a relationship between the horizontal wavenumber $k_x$, frequency $f$, velocity $v$, and emergence angle $\\theta$. We then determine the maximum possible value of $k_x$ under the specified constraints and apply the Nyquist sampling criterion to find the corresponding maximum allowable receiver spacing $\\Delta x$.\n\nFor a monochromatic plane wave, the magnitude of the wavevector $\\vec{k}$ is given by $k = |\\vec{k}| = \\sqrt{k_x^2 + k_z^2}$. From the dispersion relation, $\\omega^2 = v^2 k^2$, which implies $k = \\omega/v$. Since $\\omega = 2\\pi f$, we have:\n$$k = \\frac{2\\pi f}{v}$$\nThe emergence angle $\\theta$ is measured from the vertical ($z$) axis. The components of the wavevector are thus related to the angle $\\theta$ by $k_x = k \\sin\\theta$ and $k_z = k \\cos\\theta$. Substituting the expression for $k$, we find the horizontal wavenumber $k_x$:\n$$k_x = \\frac{2\\pi f}{v} \\sin\\theta$$\nThe spatial Nyquist sampling theorem requires that the sampling interval $\\Delta x$ must be small enough to capture the highest horizontal wavenumber present in the signal without aliasing. The condition is $|k_x| \\le k_{x, \\text{Nyquist}} = \\frac{\\pi}{\\Delta x}$. To ensure this condition holds for all possible waves in the simulation, we must consider the worst-case scenario that maximizes $|k_x|$. This yields a conservative (i.e., sufficiently small) sampling interval.\n\nThe magnitude of $k_x$ is maximized when:\n1. The frequency $f$ is at its maximum value, $f_{\\max}$.\n2. The phase velocity $v$ is at its minimum value, $v_{\\min}$. A lower velocity medium results in a shorter wavelength for a given frequency, hence a larger wavenumber.\n3. The term $|\\sin\\theta|$ is maximized. Given that the angle $\\theta$ can range from $0$ up to $\\theta_{\\max}$, and $\\sin\\theta$ is a monotonically increasing function on the interval $[0^\\circ, 90^\\circ]$, its maximum value occurs at $\\theta = \\theta_{\\max}$.\n\nCombining these factors gives the absolute maximum horizontal wavenumber, $k_{x, \\text{abs_max}}$:\n$$k_{x, \\text{abs_max}} = \\frac{2\\pi f_{\\max}}{v_{\\min}} \\sin\\theta_{\\max}$$\nThe no-aliasing condition for the receiver spacing $\\Delta x$ must hold for this maximum wavenumber:\n$$k_{x, \\text{abs_max}} \\le \\frac{\\pi}{\\Delta x}$$\nSubstituting the expression for $k_{x, \\text{abs_max}}$:\n$$\\frac{2\\pi f_{\\max}}{v_{\\min}} \\sin\\theta_{\\max} \\le \\frac{\\pi}{\\Delta x}$$\nSolving for $\\Delta x$, we find the constraint on the receiver spacing:\n$$\\Delta x \\le \\frac{\\pi v_{\\min}}{2\\pi f_{\\max} \\sin\\theta_{\\max}}$$\nSimplifying this expression yields the formula for the maximum allowable receiver spacing, $\\Delta x_{\\max}$, that guarantees no spatial aliasing:\n$$\\Delta x_{\\max} = \\frac{v_{\\min}}{2 f_{\\max} \\sin\\theta_{\\max}}$$\nThis is the derived conservative expression for the receiver spacing.\n\nNext, we evaluate this expression using the given numerical values:\n- $v_{\\min} = 2.000 \\times 10^{3} \\text{ m/s}$\n- $f_{\\max} = 1.00 \\times 10^{2} \\text{ Hz}$\n- $\\theta_{\\max} = 60.0^\\circ$\n\nWe note that $\\sin(60.0^\\circ) = \\frac{\\sqrt{3}}{2}$.\n\nSubstituting these values into the formula for $\\Delta x_{\\max}$:\n$$\\Delta x_{\\max} = \\frac{2.000 \\times 10^{3}}{2 \\times (1.00 \\times 10^{2}) \\times \\sin(60.0^\\circ)}$$\n$$\\Delta x_{\\max} = \\frac{2000}{2 \\times 100 \\times \\frac{\\sqrt{3}}{2}} = \\frac{2000}{100\\sqrt{3}} = \\frac{20}{\\sqrt{3}}$$\nCalculating the numerical value:\n$$\\Delta x_{\\max} \\approx 11.54700538... \\text{ m}$$\nAs per the problem's requirement, the result must be rounded to four significant figures.\n$$\\Delta x_{\\max} \\approx 11.55 \\text{ m}$$",
            "answer": "$$\\boxed{11.55}$$"
        },
        {
            "introduction": "The fidelity of a synthetic seismogram depends profoundly on the accuracy of the underlying Earth model. In geophysical practice, some rock properties are often estimated from others using well-established empirical relations. This hands-on problem delves into the practical consequences of this process by asking you to quantify the error introduced into seismic amplitudes when density is estimated from P-wave velocity via Gardner's relation, rather than using directly measured values. ",
            "id": "3615963",
            "problem": "You are given a set of layer pairs representing planar, horizontal interfaces in a one-dimensional acoustic Earth. Each layer is homogeneous, isotropic, and lossless. A plane compressional wave of normal incidence propagates downward and interacts with each interface. You are to assess, for each interface, how the use of an empirical density-velocity power-law to estimate density from compressional-wave speed introduces a bias in the normal-incidence reflection coefficient relative to using the measured density.\n\nStart from the following fundamental base:\n- Continuity of acoustic pressure and particle velocity across a planar interface for a plane wave at normal incidence in a one-dimensional, linear, lossless acoustic medium.\n- Definition of acoustic impedance as $Z$ equal to the product of bulk density and compressional-wave speed.\n- The existence of a widely used empirical power-law linking bulk density to compressional-wave speed, originally established from laboratory and well-log data, parameterized by two positive constants.\n\nTasks to perform and quantities to compute:\n1. Derive the normal-incidence reflection coefficient at an interface between two acoustic half-spaces in terms of the acoustic impedances of the upper and lower media, using only the fundamental base described above.\n2. Using the empirical power-law relating bulk density and compressional-wave speed with constants $a_g$ and $b_g$, convert it to be consistent with the specified units in this problem. The canonical constants to use are $a_g=0.31$ and $b_g=0.25$, which map compressional-wave speed in meters per second to bulk density in grams per cubic centimeter. Convert this relation to output density in kilograms per cubic meter. Your program must consistently use compressional-wave speed in meters per second and density in kilograms per cubic meter.\n3. For each test interface below, compute:\n   - The true reflection coefficient $R_{\\text{true}}$ using the measured densities in the two layers.\n   - The Gardner-estimated reflection coefficient $R_{\\text{est}}$ by replacing the measured densities with the densities estimated from the compressional-wave speeds using the unit-consistent empirical power-law you established in step $2$.\n   - The signed amplitude bias $\\Delta R = R_{\\text{est}} - R_{\\text{true}}$. This quantity is dimensionless and must be reported as a decimal number.\n\nNumerical and unit requirements:\n- Use compressional-wave speed $V_P$ in meters per second.\n- Use density $\\rho$ in kilograms per cubic meter.\n- The reflection coefficient and the amplitude bias are dimensionless.\n- Round each reported amplitude bias to six decimal places.\n\nTest suite:\nCompute the signed amplitude bias $\\Delta R$ for the following five interfaces, each specified by the quadruple $(V_{P1},\\rho_1,V_{P2},\\rho_2)$, where the subscript $1$ denotes the upper layer and the subscript $2$ denotes the lower layer. The units are meters per second for $V_P$ and kilograms per cubic meter for $\\rho$.\n\n- Case $1$: $(V_{P1},\\rho_1,V_{P2},\\rho_2) = (2200, 2150, 2600, 2350)$\n- Case $2$: $(V_{P1},\\rho_1,V_{P2},\\rho_2) = (2500, 2200, 6000, 2700)$\n- Case $3$: $(V_{P1},\\rho_1,V_{P2},\\rho_2) = (1500, 1800, 1700, 1850)$\n- Case $4$ (constructed so that the true impedance contrast is zero): $(V_{P1},\\rho_1,V_{P2},\\rho_2) = (2000, 2000, 1600, 2500)$\n- Case $5$ (gas-charged sand example): $(V_{P1},\\rho_1,V_{P2},\\rho_2) = (2750, 2400, 2000, 1700)$\n\nFinal output format:\nYour program should produce a single line of output containing the signed amplitude biases for the five test cases as a comma-separated list enclosed in square brackets and rounded to six decimal places, for example, $[\\Delta R_1,\\Delta R_2,\\Delta R_3,\\Delta R_4,\\Delta R_5]$. There must be no spaces in the output string. Because each $\\Delta R$ is dimensionless, no unit should be printed.",
            "solution": "### Step 1: Derivation of the Normal-Incidence Reflection Coefficient\n\nThe normal-incidence reflection coefficient $R$ at a planar interface between two acoustic media can be derived from the boundary conditions of continuity for acoustic pressure and particle velocity.\n\nLet the interface be located at the plane $z=0$. The upper medium ($z<0$) is layer $1$ with properties ($\\rho_1$, $V_{P1}$), and the lower medium ($z>0$) is layer $2$ with properties ($\\rho_2$, $V_{P2}$). A harmonic plane compressional wave propagates downwards in the positive $z$ direction.\n\nThe acoustic pressure $P(z,t)$ and the normal component of particle velocity $u(z,t)$ for a plane wave can be expressed in terms of a displacement potential $\\phi(z,t)$:\n$$P(z,t) = -\\rho \\frac{\\partial \\phi}{\\partial t}$$\n$$u(z,t) = \\frac{\\partial \\phi}{\\partial z}$$\n\nFor a harmonic wave with angular frequency $\\omega$, the displacement potentials are:\n- In layer $1$: $\\phi_1(z,t) = \\left( A_I e^{-ik_1 z} + A_R e^{ik_1 z} \\right) e^{i\\omega t}$\n- In layer $2$: $\\phi_2(z,t) = A_T e^{-ik_2 z} e^{i\\omega t}$\n\nHere, $A_I$, $A_R$, and $A_T$ are the complex amplitudes of the incident, reflected, and transmitted waves, respectively. The wavenumber in each layer is $k_j = \\omega/V_{Pj}$ for $j=1,2$.\n\nThe pressure and particle velocity in each layer are:\n- Layer $1$:\n  - $P_1(z,t) = -i\\omega\\rho_1 \\left( A_I e^{-ik_1 z} + A_R e^{ik_1 z} \\right) e^{i\\omega t}$\n  - $u_1(z,t) = -ik_1 \\left( A_I e^{-ik_1 z} - A_R e^{ik_1 z} \\right) e^{i\\omega t}$\n- Layer $2$:\n  - $P_2(z,t) = -i\\omega\\rho_2 A_T e^{-ik_2 z} e^{i\\omega t}$\n  - $u_2(z,t) = -ik_2 A_T e^{-ik_2 z} e^{i\\omega t}$\n\nApplying the boundary conditions at $z=0$:\n1.  Continuity of pressure: $P_1(0,t) = P_2(0,t)$\n    $$\\rho_1 (A_I + A_R) = \\rho_2 A_T$$\n2.  Continuity of particle velocity: $u_1(0,t) = u_2(0,t)$\n    $$k_1 (A_I - A_R) = k_2 A_T$$\n\nWe can express $A_T$ from the first equation as $A_T = \\frac{\\rho_1}{\\rho_2} (A_I + A_R)$ and substitute it into the second equation:\n$$k_1 (A_I - A_R) = k_2 \\frac{\\rho_1}{\\rho_2} (A_I + A_R)$$\n\nSubstituting $k_j = \\omega/V_{Pj}$ and simplifying by canceling $\\omega$:\n$$\\frac{1}{V_{P1}} (A_I - A_R) = \\frac{\\rho_1}{V_{P2}\\rho_2} (A_I + A_R)$$\n\nRearranging terms to solve for the reflection coefficient $R = A_R/A_I$:\n$$V_{P2}\\rho_2 (A_I - A_R) = V_{P1}\\rho_1 (A_I + A_R)$$\n\nDefining the acoustic impedance as $Z_j = \\rho_j V_{Pj}$:\n$$Z_2 (A_I - A_R) = Z_1 (A_I + A_R)$$\n$$Z_2 A_I - Z_1 A_I = Z_1 A_R + Z_2 A_R$$\n$$A_I (Z_2 - Z_1) = A_R (Z_1 + Z_2)$$\n\nThis yields the expression for the normal-incidence reflection coefficient:\n$$R = \\frac{A_R}{A_I} = \\frac{Z_2 - Z_1}{Z_2 + Z_1}$$\n\n### Step 2: Unit Conversion of the Empirical Power-Law\n\nThe problem provides an empirical power-law (Gardner's relation) linking bulk density $\\rho$ to compressional-wave speed $V_P$:\n$$\\rho' = a_g (V_P)^{b_g}$$\nwhere $\\rho'$ is in grams per cubic centimeter ($\\text{g/cm}^3$), $V_P$ is in meters per second ($\\text{m/s}$), and the constants are $a_g=0.31$ and $b_g=0.25$.\n\nThe problem requires density $\\rho$ to be in kilograms per cubic meter ($\\text{kg/m}^3$). The conversion between these units is:\n$$1 \\, \\text{g/cm}^3 = \\frac{10^{-3} \\, \\text{kg}}{(10^{-2} \\, \\text{m})^3} = \\frac{10^{-3}}{10^{-6}} \\, \\text{kg/m}^3 = 1000 \\, \\text{kg/m}^3$$\nTherefore, to convert $\\rho'$ from $\\text{g/cm}^3$ to $\\rho$ in $\\text{kg/m}^3$, we multiply by $1000$:\n$$\\rho \\, (\\text{in kg/m}^3) = 1000 \\times \\rho' \\, (\\text{in g/cm}^3)$$\nApplying this to the empirical relation:\n$$\\rho = 1000 \\times a_g (V_P)^{b_g}$$\nSubstituting the given values for $a_g$ and $b_g$:\n$$\\rho_{\\text{est}} = 1000 \\times 0.31 \\times (V_P)^{0.25} = 310 (V_P)^{0.25}$$\nThis is the unit-consistent equation used for estimating density, $\\rho_{\\text{est}}$, in $\\text{kg/m}^3$ from $V_P$ in $\\text{m/s}$. We can define new constants for these units: $a=310$ and $b=0.25$.\n\n### Step 3: Calculation of Reflection Coefficient Bias\n\nFor each interface, specified by $(V_{P1}, \\rho_1, V_{P2}, \\rho_2)$, we compute two reflection coefficients.\n\n1.  **True Reflection Coefficient ($R_{\\text{true}}$)**:\n    This is calculated using the measured densities and velocities.\n    -   True acoustic impedances: $Z_1 = \\rho_1 V_{P1}$ and $Z_2 = \\rho_2 V_{P2}$.\n    -   True reflection coefficient: $R_{\\text{true}} = \\frac{Z_2 - Z_1}{Z_2 + Z_1}$.\n\n2.  **Gardner-estimated Reflection Coefficient ($R_{\\text{est}}$)**:\n    This is calculated by replacing the measured densities with densities estimated from the velocities using the converted power-law.\n    -   Estimated densities: $\\rho_{1,\\text{est}} = a (V_{P1})^b$ and $\\rho_{2,\\text{est}} = a (V_{P2})^b$, with $a=310$ and $b=0.25$.\n    -   Estimated acoustic impedances: $Z_{1,\\text{est}} = \\rho_{1,\\text{est}} V_{P1} = a (V_{P1})^{b} V_{P1} = a (V_{P1})^{1+b}$ and $Z_{2,\\text{est}} = a (V_{P2})^{1+b}$.\n    -   Estimated reflection coefficient:\n        $$R_{\\text{est}} = \\frac{Z_{2,\\text{est}} - Z_{1,\\text{est}}}{Z_{2,\\text{est}} + Z_{1,\\text{est}}} = \\frac{a (V_{P2})^{1+b} - a (V_{P1})^{1+b}}{a (V_{P2})^{1+b} + a (V_{P1})^{1+b}}$$\n        The constant $a$ cancels, simplifying the expression to:\n        $$R_{\\text{est}} = \\frac{(V_{P2})^{1.25} - (V_{P1})^{1.25}}{(V_{P2})^{1.25} + (V_{P1})^{1.25}}$$\n\n3.  **Signed Amplitude Bias ($\\Delta R$)**:\n    The bias is the difference between the estimated and true reflection coefficients.\n    $$\\Delta R = R_{\\text{est}} - R_{\\text{true}}$$\n    This dimensionless quantity is computed for each case and rounded to six decimal places.\n\nThis procedure is applied to the five test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the signed amplitude bias in reflection coefficients\n    for five geological interfaces.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (V_P1, rho_1, V_P2, rho_2)\n    # Units: V_P in m/s, rho in kg/m^3\n    test_cases = [\n        # Case 1\n        (2200.0, 2150.0, 2600.0, 2350.0),\n        # Case 2\n        (2500.0, 2200.0, 6000.0, 2700.0),\n        # Case 3\n        (1500.0, 1800.0, 1700.0, 1850.0),\n        # Case 4 (zero true impedance contrast)\n        (2000.0, 2000.0, 1600.0, 2500.0),\n        # Case 5 (gas-charged sand example)\n        (2750.0, 2400.0, 2000.0, 1700.0),\n    ]\n\n    results = []\n    \n    # Power for Gardner's relation, b = 0.25\n    b = 0.25\n    power = 1.0 + b # This is 1.25\n\n    def calculate_bias(vp1, rho1, vp2, rho2):\n        \"\"\"\n        Calculates the signed amplitude bias for a single interface.\n\n        Args:\n            vp1 (float): P-wave velocity of the upper layer (m/s).\n            rho1 (float): Density of the upper layer (kg/m^3).\n            vp2 (float): P-wave velocity of the lower layer (m/s).\n            rho2 (float): Density of the lower layer (kg/m^3).\n\n        Returns:\n            float: The signed amplitude bias.\n        \"\"\"\n        # 1. Calculate the true reflection coefficient (R_true)\n        z1_true = rho1 * vp1\n        z2_true = rho2 * vp2\n        \n        # Handle the case where Z1 + Z2 is zero to avoid division by zero,\n        # although physically unlikely for positive Vp and rho.\n        if (z1_true + z2_true) == 0:\n            # If Z1 = -Z2, R is undefined. If Z1=Z2=0, also undefined.\n            # Assuming Z1=Z2=0 results in R_true=0 as there is no impedance.\n            # Physically, Z > 0.\n            r_true = 0.0\n        else:\n            r_true = (z2_true - z1_true) / (z1_true + z2_true)\n\n        # 2. Calculate the Gardner-estimated reflection coefficient (R_est)\n        # As derived, R_est = (V_P2^(1+b) - V_P1^(1+b)) / (V_P2^(1+b) + V_P1^(1+b))\n        vp1_pow = vp1 ** power\n        vp2_pow = vp2 ** power\n\n        if (vp1_pow + vp2_pow) == 0:\n            # Should not happen for positive Vp\n            r_est = 0.0\n        else:\n            r_est = (vp2_pow - vp1_pow) / (vp1_pow + vp2_pow)\n\n        # 3. Calculate the signed amplitude bias (Delta R)\n        delta_r = r_est - r_true\n        return delta_r\n\n    for case in test_cases:\n        vp1, rho1, vp2, rho2 = case\n        bias = calculate_bias(vp1, rho1, vp2, rho2)\n        # Format the result to exactly six decimal places for the output string.\n        results.append(f\"{bias:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Complex numerical simulations require robust methods for verification, and one of the most elegant is the reciprocity principle. This principle, which dictates symmetry upon swapping source and receiver locations, provides a powerful check on the correctness of a lossless wave propagation code. This comprehensive practice involves using a finite-difference model to first confirm reciprocity in a simple medium, and then to investigate how this fundamental symmetry is broken by the introduction of physically realistic, non-reciprocal phenomena like attenuation. ",
            "id": "3615893",
            "problem": "Consider the generation and analysis of synthetic seismograms in one spatial dimension by modeling the acoustic pressure field. Begin from a valid physical base: a linear, time-invariant, scalar acoustic wave operator acting on pressure, and appropriate boundary conditions. For a spatial coordinate $x \\in [0,L]$ with $L$ in $\\mathrm{m}$ and time $t \\in [0,T]$ with $T$ in $\\mathrm{s}$, define the pressure field $p(x,t)$ driven by a compact source. The goal is to synthesize virtual-source seismograms by exchanging source and receiver locations and to assess positional reciprocity in the lossless case. Then introduce attenuation via a spatially nonuniform damping, combined with asymmetric boundary absorption, and quantify the resulting deviation from positional symmetry in the synthetic pairs.\n\nUse a discretization consistent with the following principles:\n- The medium is discretized on a uniform grid with $N_x$ points and spacing $\\Delta x = L/(N_x-1)$ in $\\mathrm{m}$.\n- The time axis uses a uniform step $\\Delta t$ in $\\mathrm{s}$ satisfying a Courant stability condition tied to the maximum wavespeed.\n- The wavespeed $c(x)$ in $\\mathrm{m/s}$ can be heterogeneous but is piecewise constant. Density is implicitly absorbed into the scalar formulation for $p(x,t)$.\n- The evolution is governed by a scalar second-order hyperbolic equation with optional linear damping:\n$$\n\\frac{\\partial^2 p}{\\partial t^2}(x,t) + \\gamma(x) \\frac{\\partial p}{\\partial t}(x,t) - c(x)^2 \\frac{\\partial^2 p}{\\partial x^2}(x,t) = s(x,t),\n$$\nwhere $\\gamma(x)$ in $\\mathrm{s}^{-1}$ is a nonnegative damping profile and $s(x,t)$ is the source term. Reflective boundaries correspond to zero spatial gradient at $x=0$ and $x=L$. Asymmetric boundary absorption is effected by ramping $\\gamma(x)$ near one boundary only.\n\nA virtual-source seismogram at a location $x_r$ due to a source at $x_s$ is the impulse response recorded at $x_r$ when the source is at $x_s$. The positional reciprocity test compares the trace recorded at $x_r$ for a source at $x_s$ versus the trace recorded at $x_s$ for a source at $x_r$, in identical media and boundary conditions. Quantify the deviation by the normalized $\\ell_2$ difference between the two traces,\n$$\n\\varepsilon = \\frac{\\left\\| d_{r \\leftarrow s}(t) - d_{s \\leftarrow r}(t) \\right\\|_2}{\\max\\left(\\left\\| d_{r \\leftarrow s}(t) \\right\\|_2, \\left\\| d_{s \\leftarrow r}(t) \\right\\|_2\\right)},\n$$\nwhich is dimensionless.\n\nImplement a finite difference scheme that advances $p(x,t)$ using second-order central differences in time and space, injects a band-limited impulsive source wavelet $s(t)$ at the source grid point, and records the pressure at the receiver grid point over time. Ensure scientific realism by choosing parameters and verifying stability. Angles, if any, are not used in this problem.\n\nDesign and run the following test suite. All distances are in $\\mathrm{m}$, time in $\\mathrm{s}$, and wavespeed in $\\mathrm{m/s}$:\n\n- Test Case A (homogeneous, lossless, reflective boundaries):\n    - $L = 1000$, $N_x = 801$, $c(x) \\equiv 2000$, $\\gamma(x) \\equiv 0$.\n    - Total time $T = 0.40$.\n    - Source central frequency $f_0 = 25$.\n    - Source location $x_s = 200$, receiver location $x_r = 800$.\n    - Compute $\\varepsilon$ and report a boolean indicating whether $\\varepsilon \\le 10^{-3}$.\n\n- Test Case B (layered, lossless, reflective boundaries):\n    - $L = 1000$, $N_x = 801$, $c(x) = 1800$ for $x \\in [0,500)$ and $c(x) = 2500$ for $x \\in [500,1000]$, $\\gamma(x) \\equiv 0$.\n    - Total time $T = 0.50$.\n    - Source central frequency $f_0 = 20$.\n    - Source location $x_s = 300$, receiver location $x_r = 900$.\n    - Compute $\\varepsilon$ and report a boolean indicating whether $\\varepsilon \\le 2 \\cdot 10^{-3}$.\n\n- Test Case C (homogeneous with attenuation and asymmetric boundary absorption):\n    - $L = 1000$, $N_x = 801$, $c(x) \\equiv 2200$.\n    - Total time $T = 0.60$.\n    - Source central frequency $f_0 = 25$.\n    - Source location $x_s = 100$, receiver location $x_r = 900$.\n    - Damping profile $\\gamma(x) = 0$ except a right-boundary sponge region over the last $200$ $\\mathrm{m}$, ramped quadratically to $\\gamma_{\\max} = 50$ $\\mathrm{s}^{-1}$ at $x=L$.\n    - Compute and report the float value of $\\varepsilon$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of Test Case A, Test Case B, and Test Case C, namely $[b_A,b_B,\\varepsilon_C]$ where $b_A$ and $b_B$ are booleans and $\\varepsilon_C$ is a float rounded by the default string conversion of the programming language. The outputs are dimensionless.",
            "solution": "The solution is developed by first discretizing the governing partial differential equation and then implementing the resulting algorithm for the specified test cases.\n\nThe governing equation for the pressure field $p(x,t)$ is the 1D scalar wave equation with a linear damping term:\n$$\n\\frac{\\partial^2 p}{\\partial t^2}(x,t) + \\gamma(x) \\frac{\\partial p}{\\partial t}(x,t) - c(x)^2 \\frac{\\partial^2 p}{\\partial x^2}(x,t) = s(x,t)\n$$\nwhere $p$ is the pressure, $c(x)$ is the wave-speed, $\\gamma(x)$ is the damping coefficient, and $s(x,t)$ is the source term.\n\nWe discretize this equation using second-order central differences for both time and spatial derivatives on a uniform grid. Let $p_i^n$ denote the pressure at spatial grid point $x_i = i\\Delta x$ and time $t_n = n\\Delta t$. The discrete approximations of the derivatives are:\n$$\n\\frac{\\partial^2 p}{\\partial t^2} \\approx \\frac{p_i^{n+1} - 2p_i^n + p_i^{n-1}}{\\Delta t^2}\n$$\n$$\n\\frac{\\partial p}{\\partial t} \\approx \\frac{p_i^{n+1} - p_i^{n-1}}{2\\Delta t}\n$$\n$$\n\\frac{\\partial^2 p}{\\partial x^2} \\approx \\frac{p_{i+1}^n - 2p_i^n + p_{i-1}^n}{\\Delta x^2}\n$$\nSubstituting these into the governing equation and collecting terms to solve for the pressure at the next time step, $p_i^{n+1}$, yields the following explicit finite-difference update scheme:\n$$\np_i^{n+1} \\left(\\frac{1}{\\Delta t^2} + \\frac{\\gamma_i}{2\\Delta t}\\right) = \\frac{2p_i^n}{\\Delta t^2} - p_i^{n-1}\\left(\\frac{1}{\\Delta t^2} - \\frac{\\gamma_i}{2\\Delta t}\\right) + c_i^2 \\left(\\frac{p_{i+1}^n - 2p_i^n + p_{i-1}^n}{\\Delta x^2}\\right) + s_i^n\n$$\nMultiplying by $\\Delta t^2$ and rearranging gives the computational formula for $p_i^{n+1}$:\n$$\np_i^{n+1} = \\frac{1}{1 + \\frac{\\gamma_i \\Delta t}{2}} \\left[ 2p_i^n - p_i^{n-1}\\left(1 - \\frac{\\gamma_i \\Delta t}{2}\\right) + \\left(\\frac{c_i \\Delta t}{\\Delta x}\\right)^2 \\left(p_{i+1}^n - 2p_i^n + p_{i-1}^n\\right) \\right] + \\frac{\\Delta t^2 s_i^n}{1 + \\frac{\\gamma_i \\Delta t}{2}}\n$$\nFor numerical stability, the time step $\\Delta t$ must satisfy the Courant-Friedrichs-Lewy (CFL) condition, $c_{\\max} \\frac{\\Delta t}{\\Delta x} \\le S$, where $c_{\\max}$ is the maximum wavespeed present in the model and $S$ is a safety factor known as the Courant number, which we set to a conservative value of $S=0.5$.\n\nThe source term $s(x,t)$ is modeled as a product of a spatial Dirac delta function and a temporal wavelet, $s(x,t) = S(t)\\delta(x-x_s)$. In the discrete domain, this is approximated as $s_i^n = S(t_n) \\frac{\\delta_{i,i_s}}{\\Delta x}$, where $i_s$ is the grid index of the source location $x_s$. The source wavelet $S(t)$ is chosen to be a Ricker wavelet, a standard choice in seismology, centered at a peak frequency $f_0$ with a time delay $t_0 = 1/f_0$:\n$$\nS(t) = \\left(1 - 2\\left(\\pi f_0 (t - t_0)\\right)^2\\right) e^{-\\left(\\pi f_0 (t - t_0)\\right)^2}\n$$\nReflective boundaries at $x=0$ and $x=L$ are implemented using a zero-gradient (Neumann) condition, $\\frac{\\partial p}{\\partial x} = 0$. This is achieved by using ghost points such that $p_{-1}^n = p_1^n$ and $p_{N_x}^n = p_{N_x-2}^n$, which simplifies the discrete Laplacian operator at the boundaries $i=0$ and $i=N_x-1$.\n\nThe core of the problem is to test positional reciprocity, which states that for a linear, time-invariant, and lossless medium, the seismic trace recorded at location $x_r$ from a source at $x_s$ is identical to the trace recorded at $x_s$ from a source at $x_r$. This principle stems from the self-adjoint property of the underlying wave operator when $\\gamma(x) = 0$. We quantify the deviation from reciprocity using the normalized $\\ell_2$ difference, $\\varepsilon$:\n$$\n\\varepsilon = \\frac{\\left\\| d_{r \\leftarrow s}(t) - d_{s \\leftarrow r}(t) \\right\\|_2}{\\max\\left(\\left\\| d_{r \\leftarrow s}(t) \\right\\|_2, \\left\\| d_{s \\leftarrow r}(t) \\right\\|_2\\right)}\n$$\nFor each test case, we perform two simulations: one with the source at $x_s$ and receiver at $x_r$, and a second with the locations exchanged. We then compute $\\varepsilon$ from the two resulting time series, $d_{r \\leftarrow s}(t)$ and $d_{s \\leftarrow r}(t)$.\n\n*   For Test Cases A (homogeneous, lossless) and B (layered, lossless), the medium is lossless ($\\gamma(x) \\equiv 0$). The wave operator is self-adjoint, and reciprocity must hold. Any computed $\\varepsilon > 0$ will be due to numerical artifacts such as floating-point error and discretization differences, and is expected to be very small.\n*   For Test Case C (homogeneous, with attenuation), the damping profile $\\gamma(x)$ is non-zero and asymmetric. This breaks the self-adjointness of the wave operator. The wave propagation is no longer time-reversible in the same way, and thus positional reciprocity is explicitly broken. A significant, non-zero value of $\\varepsilon$ is expected, reflecting the physical asymmetry introduced by the damping. Specifically, a wave originating at $x_s=100$ and traveling to $x_r=900$ propagates through a mostly lossless medium, whereas a wave originating at $x_s=900$ (inside the absorbing layer) is immediately and strongly attenuated before it can propagate to $x_r=100$. This leads to vastly different recorded seismograms.\n\nThe algorithm proceeds by setting up the grid, material properties ($c(x)$, $\\gamma(x)$), source wavelet, and FDTD coefficients for each test case. The main FDTD loop then iteratively computes the pressure field over time, injecting the source and recording the seismogram at the receiver location. This process is repeated for the reciprocal source-receiver pair to compute $\\varepsilon$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for synthetic seismogram generation\n    and reciprocity analysis.\n    \"\"\"\n\n    def run_fd_simulation(L, Nx, T, c_profile_func, gamma_profile_func, f0, xs_pos, xr_pos, courant_S=0.5):\n        \"\"\"\n        Performs a single 1D finite-difference wave propagation simulation.\n\n        Returns:\n            np.ndarray: The recorded seismogram at the receiver location.\n        \"\"\"\n        # ---- 1. Grid and model setup ----\n        dx = L / (Nx - 1)\n        x = np.linspace(0, L, Nx)\n\n        c = c_profile_func(x)\n        gamma = gamma_profile_func(x)\n\n        c_max = np.max(c)\n        if c_max == 0:\n            raise ValueError(\"Maximum velocity cannot be zero.\")\n            \n        dt = courant_S * dx / c_max\n        Nt = int(np.ceil(T / dt))\n        t = np.linspace(0, dt * (Nt - 1), Nt)\n\n        xs_idx = int(round(xs_pos / dx))\n        xr_idx = int(round(xr_pos / dx))\n\n        # ---- 2. Source wavelet setup (Ricker) ----\n        t0 = 1.0 / f0\n        source_t_shifted = t - t0\n        tau_sq = (np.pi * f0 * source_t_shifted)**2\n        source_wavelet = (1.0 - 2.0 * tau_sq) * np.exp(-tau_sq)\n\n        # ---- 3. FDTD setup ----\n        p_prev = np.zeros(Nx)\n        p_curr = np.zeros(Nx)\n        p_next = np.zeros(Nx)\n        seismogram = np.zeros(Nt)\n\n        gdt2 = gamma * dt / 2.0\n        inv_denom = 1.0 / (1.0 + gdt2)\n        \n        # ---- 4. FDTD main loop ----\n        for n in range(Nt - 1):\n            # Calculate spatial second derivative (Laplacian)\n            laplacian = np.zeros(Nx)\n            # Interior points\n            laplacian[1:-1] = (p_curr[2:] - 2 * p_curr[1:-1] + p_curr[:-2])\n            # Reflective (Neumann) boundary conditions\n            laplacian[0] = 2.0 * (p_curr[1] - p_curr[0])\n            laplacian[-1] = 2.0 * (p_curr[-2] - p_curr[-1])\n            laplacian /= dx**2\n\n            # Update pressure field p_next\n            term_p_curr = 2.0 * p_curr\n            term_p_prev = (1.0 - gdt2) * p_prev\n            term_laplacian = dt**2 * c**2 * laplacian\n            \n            p_next = inv_denom * (term_p_curr - term_p_prev + term_laplacian)\n            \n            # Add source term for p at t_n -> p at t_{n+1}\n            source_val = source_wavelet[n]\n            if source_val != 0:\n                p_next[xs_idx] += inv_denom[xs_idx] * (dt**2 * source_val / dx)\n            \n            # ---- 5. Record and update ----\n            seismogram[n+1] = p_next[xr_idx]\n            p_prev, p_curr = p_curr, p_next\n\n        return seismogram\n\n    def compute_reciprocity_error(params):\n        \"\"\"\n        Computes the reciprocity error epsilon for a given set of parameters.\n        \"\"\"\n        L, Nx, T, c_profile_func, gamma_profile_func, f0, xs, xr = params\n        \n        # Simulation 1: Source at xs, Receiver at xr\n        trace1 = run_fd_simulation(L, Nx, T, c_profile_func, gamma_profile_func, f0, xs, xr)\n        \n        # Simulation 2: Source at xr, Receiver at xs (reciprocal)\n        trace2 = run_fd_simulation(L, Nx, T, c_profile_func, gamma_profile_func, f0, xr, xs)\n        \n        # Compute epsilon\n        norm_diff = np.linalg.norm(trace1 - trace2)\n        norm_trace1 = np.linalg.norm(trace1)\n        norm_trace2 = np.linalg.norm(trace2)\n        norm_max = max(norm_trace1, norm_trace2)\n        \n        if norm_max == 0:\n            return 0.0\n        \n        return norm_diff / norm_max\n\n    # --- Test Case A ---\n    L_A, Nx_A, T_A, f0_A, xs_A, xr_A = 1000, 801, 0.40, 25, 200, 800\n    c_prof_A = lambda x: np.full_like(x, 2000.0)\n    gamma_prof_A = lambda x: np.zeros_like(x)\n    params_A = (L_A, Nx_A, T_A, c_prof_A, gamma_prof_A, f0_A, xs_A, xr_A)\n    epsilon_A = compute_reciprocity_error(params_A)\n    result_A = epsilon_A = 1e-3\n\n    # --- Test Case B ---\n    L_B, Nx_B, T_B, f0_B, xs_B, xr_B = 1000, 801, 0.50, 20, 300, 900\n    def c_prof_B(x):\n        c = np.full_like(x, 1800.0)\n        c[x >= 500] = 2500.0\n        return c\n    gamma_prof_B = lambda x: np.zeros_like(x)\n    params_B = (L_B, Nx_B, T_B, c_prof_B, gamma_prof_B, f0_B, xs_B, xr_B)\n    epsilon_B = compute_reciprocity_error(params_B)\n    result_B = epsilon_B = 2e-3\n\n    # --- Test Case C ---\n    L_C, Nx_C, T_C, f0_C, xs_C, xr_C = 1000, 801, 0.60, 25, 100, 900\n    c_prof_C = lambda x: np.full_like(x, 2200.0)\n    def gamma_prof_C(x):\n        gamma = np.zeros_like(x)\n        sponge_width = 200.0\n        sponge_start = L_C - sponge_width\n        sponge_zone = x >= sponge_start\n        rel_pos = (x[sponge_zone] - sponge_start) / sponge_width\n        gamma[sponge_zone] = 50.0 * rel_pos**2\n        return gamma\n    params_C = (L_C, Nx_C, T_C, c_prof_C, gamma_prof_C, f0_C, xs_C, xr_C)\n    result_C = compute_reciprocity_error(params_C)\n\n    results = [result_A, result_B, result_C]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}