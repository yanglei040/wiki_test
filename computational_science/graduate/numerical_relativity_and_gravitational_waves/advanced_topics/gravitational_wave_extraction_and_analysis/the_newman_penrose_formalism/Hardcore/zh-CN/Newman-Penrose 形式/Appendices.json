{
    "hands_on_practices": [
        {
            "introduction": "使用纽曼-彭罗斯（Newman-Penrose, NP）形式体系的第一步是为感兴趣的时空定义一个合适的零标架（null tetrad）。本练习提供了为史瓦西（Schwarzschild）时空从头开始构建这样一个标架的基础实践，以确保其满足所需的归一化和正交性条件。这对于任何后续使用该形式体系的工作来说都是一项基石技能。",
            "id": "3493649",
            "problem": "考虑质量参数为 $M$ 的 Schwarzschild 时空，以内行 Eddington–Finkelstein 坐标 $(v,r,\\theta,\\phi)$ 写出，其线元为\n$$\nds^{2} = -\\left(1-\\frac{2M}{r}\\right) dv^{2} + 2\\, dv\\, dr + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right).\n$$\n令 $g_{ab}$ 表示在该坐标基下的度规分量，其号差为 $(-,+,+,+)$。在 Newman–Penrose (NP) 形式体系中，引入一个零四足 $\\{l^{a}, n^{a}, m^{a}, \\bar{m}^{a}\\}$，它由两个实零矢量 $l^{a}$ 和 $n^{a}$，以及一个复零矢量 $m^{a}$ 及其复共轭 $\\bar{m}^{a}$ 组成。在 $(-,+,+,+)$ 约定下，NP 内积归一化要求\n$$\nl^{a} n_{a} = -1,\\quad m^{a} \\bar{m}_{a} = 1,\\quad l^{a} l_{a} = n^{a} n_{a} = m^{a} m_{a} = \\bar{m}^{a} \\bar{m}_{a} = 0,\n$$\n且所有其他不同的内积为零，即 $l^{a} m_{a} = l^{a} \\bar{m}_{a} = n^{a} m_{a} = n^{a} \\bar{m}_{a} = 0$。\n\n从这些定义和给定的度规出发，构造一个与径向零方向对齐的显式零四足拟设，使得：\n- $l^{a}$ 与常数 $v$ 的径向零曲线相切，\n- $n^{a}$ 位于 $\\partial_{v}$ 和 $\\partial_{r}$ 张成的空间内，并被归一化以使 $l^{a} n_{a} = -1$，\n- $m^{a}$ 和 $\\bar{m}^{a}$ 与固定 $(v,r)$ 处的单位二维球面相切。\n\n然后，使用 $g_{ab}$ 显式计算并验证每个 NP 内积，以表明该四足满足所需的归一化和正交条件。\n\n答案规格：\n- 在坐标基 $(\\partial_{v}, \\partial_{r}, \\partial_{\\theta}, \\partial_{\\phi})$ 中，以单一闭式解析表达式的形式给出四个四足矢量的分量。将这 16 个分量按 $(l^{v}, l^{r}, l^{\\theta}, l^{\\phi}, n^{v}, n^{r}, n^{\\theta}, n^{\\phi}, m^{v}, m^{r}, m^{\\theta}, m^{\\phi}, \\bar{m}^{v}, \\bar{m}^{r}, \\bar{m}^{\\theta}, \\bar{m}^{\\phi})$ 的顺序排列成单行。\n- 保持最终表达式精确；无需四舍五入。",
            "solution": "该问题陈述是微分几何和广义相对论中的一个有效练习，具体涉及将 Newman-Penrose (NP) 形式体系应用于内行 Eddington-Finkelstein 坐标下的 Schwarzschild 时空。该问题是自洽的、有科学依据且良定的。我们将继续进行解答。\n\n坐标系由 $(x^a) = (v, r, \\theta, \\phi)$ 给出。Schwarzschild 度规的线元为\n$$\nds^{2} = -\\left(1-\\frac{2M}{r}\\right) dv^{2} + 2\\, dv\\, dr + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right).\n$$\n度规张量 $g_{ab}$ 的分量可以直接从线元中读出：\n$$\ng_{ab} = \\begin{pmatrix}\n-\\left(1-\\frac{2M}{r}\\right)  1  0  0 \\\\\n1  0  0  0 \\\\\n0  0  r^2  0 \\\\\n0  0  0  r^2 \\sin^2\\theta\n\\end{pmatrix}.\n$$\n满足 $g^{ac}g_{cb} = \\delta^a_b$ 的逆度规张量 $g^{ab}$ 计算如下：\n$$\ng^{ab} = \\begin{pmatrix}\n0  1  0  0 \\\\\n1  1-\\frac{2M}{r}  0  0 \\\\\n0  0  \\frac{1}{r^2}  0 \\\\\n0  0  0  \\frac{1}{r^2 \\sin^2\\theta}\n\\end{pmatrix}.\n$$\n\n我们现在将根据指定条件构造零四足 $\\{l^{a}, n^{a}, m^{a}, \\bar{m}^{a}\\}$。\n\n**1. 构造矢量 $l^a$**\n矢量 $l^a$ 要求与常数 $v$ 的径向零曲线相切。一条具有常数 $v$、$\\theta$ 和 $\\phi$ 的曲线由 $r$ 参数化，其切矢量与 $\\partial_r$ 成正比。因此，我们可以设 $l^a = C_l \\delta^a_r$，其中 $C_l$ 是某个缩放因子。在坐标中，这表示为 $l^a = (0, C_l, 0, 0)$。\n零条件 $l^a l_a = g_{ab}l^a l^b = 0$ 要求：\n$$\ng_{rr} (C_l)^2 = 0 \\cdot (C_l)^2 = 0.\n$$\n对于任何 $C_l$，此条件都成立。我们有缩放 $l^a$ 的自由。一个标准且方便的选择是设 $C_l=1$。因此，我们选择：\n$$\nl^a = (0, 1, 0, 0).\n$$\n该矢量对应于外行主零方向。\n\n**2. 构造矢量 $n^a$**\n矢量 $n^a$ 要求位于 $\\partial_v$ 和 $\\partial_r$ 张成的空间内，因此其分量形式为 $n^a = (n^v, n^r, 0, 0)$。它还必须满足归一化条件 $l^a n_a = -1$。\n首先，我们求协变分量 $n_a = g_{ab} n^b$：\n$n_r = g_{ra} n^a = g_{rv} n^v + g_{rr} n^r = 1 \\cdot n^v + 0 \\cdot n^r = n^v$。\n归一化条件变为：\n$$\nl^a n_a = l^r n_r = 1 \\cdot n^v = -1 \\implies n^v = -1.\n$$\n所以，$n^a = (-1, n^r, 0, 0)$。分量 $n^r$ 由零条件 $n^a n_a = 0$ 确定：\n$$\nn^a n_a = g_{ab}n^a n^b = g_{vv}(n^v)^2 + 2g_{vr}n^v n^r + g_{rr}(n^r)^2 = 0.\n$$\n代入已知分量和度规值：\n$$\n-\\left(1-\\frac{2M}{r}\\right)(-1)^2 + 2(1)(-1)n^r + 0 \\cdot (n^r)^2 = 0\n$$\n$$\n-\\left(1-\\frac{2M}{r}\\right) - 2n^r = 0 \\implies n^r = -\\frac{1}{2}\\left(1-\\frac{2M}{r}\\right).\n$$\n因此，矢量 $n^a$ 为：\n$$\nn^a = \\left(-1, -\\frac{1}{2}\\left(1-\\frac{2M}{r}\\right), 0, 0\\right).\n$$\n\n**3. 构造矢量 $m^a$ 和 $\\bar{m}^a$**\n矢量 $m^a$ 和 $\\bar{m}^a$ 与常数 $v$ 和 $r$ 的二维球面相切。这意味着它们是 $\\partial_\\theta$ 和 $\\partial_\\phi$ 的线性组合，因此 $m^a = (0, 0, m^\\theta, m^\\phi)$。\n矢量 $m^a$ 是零矢量的条件，$m^a m_a = 0$，意味着：\n$$\ng_{ab}m^a m^b = g_{\\theta\\theta}(m^\\theta)^2 + g_{\\phi\\phi}(m^\\phi)^2 = 0\n$$\n$$\nr^2(m^\\theta)^2 + r^2\\sin^2\\theta(m^\\phi)^2 = 0 \\implies (m^\\theta)^2 + \\sin^2\\theta(m^\\phi)^2 = 0.\n$$\n这表明分量之间存在复数关系。一个满足此条件的标准选择是\n$$\nm^\\theta = \\frac{C_m}{\\sqrt{2}r}, \\quad m^\\phi = \\frac{i C_m}{\\sqrt{2}r\\sin\\theta},\n$$\n其中 $C_m$ 是一个模为1的复数，它设定了矢量的相位。我们选择 $C_m=1$。这得到：\n$$\nm^a = \\left(0, 0, \\frac{1}{\\sqrt{2}r}, \\frac{i}{\\sqrt{2}r\\sin\\theta}\\right).\n$$\n那么复共轭矢量 $\\bar{m}^a$ 是：\n$$\n\\bar{m}^a = \\left(0, 0, \\frac{1}{\\sqrt{2}r}, -\\frac{i}{\\sqrt{2}r\\sin\\theta}\\right).\n$$\n我们必须验证归一化条件 $m^a \\bar{m}_a = 1$：\n$$\nm^a \\bar{m}_a = g_{ab}m^a\\bar{m}^b = g_{\\theta\\theta}m^\\theta\\bar{m}^\\theta + g_{\\phi\\phi}m^\\phi\\bar{m}^\\phi\n$$\n$$\n= r^2\\left(\\frac{1}{\\sqrt{2}r}\\right)\\left(\\frac{1}{\\sqrt{2}r}\\right) + r^2\\sin^2\\theta\\left(\\frac{i}{\\sqrt{2}r\\sin\\theta}\\right)\\left(\\frac{-i}{\\sqrt{2}r\\sin\\theta}\\right)\n$$\n$$\n= \\frac{r^2}{2r^2} + \\frac{r^2\\sin^2\\theta(-i^2)}{2r^2\\sin^2\\theta} = \\frac{1}{2} + \\frac{1}{2} = 1.\n$$\n归一化条件得到满足。\n\n**所构造四足的总结：**\n$$\nl^a = (0, 1, 0, 0)\n$$\n$$\nn^a = \\left(-1, -\\frac{1}{2}\\left(1-\\frac{2M}{r}\\right), 0, 0\\right)\n$$\n$$\nm^a = \\left(0, 0, \\frac{1}{\\sqrt{2}r}, \\frac{i}{\\sqrt{2}r\\sin\\theta}\\right)\n$$\n$$\n\\bar{m}^a = \\left(0, 0, \\frac{1}{\\sqrt{2}r}, -\\frac{i}{\\sqrt{2}r\\sin\\theta}\\right)\n$$\n\n**所有内积的显式验证**\n为严谨起见，我们计算四足矢量的协变形式：\n$l_a = g_{ab}l^b = (g_{vr}, g_{rr}, 0, 0) = (1, 0, 0, 0)$。\n$n_a = g_{ab}n^b = ( -g_{vv} - \\frac{1}{2}g_{vr}(1-\\frac{2M}{r}), -g_{rv}, 0, 0) = (\\frac{1}{2}(1-\\frac{2M}{r}), -1, 0, 0)$。\n$m_a = g_{ab}m^b = (0, 0, g_{\\theta\\theta}m^\\theta, g_{\\phi\\phi}m^\\phi) = (0, 0, \\frac{r}{\\sqrt{2}}, \\frac{ir\\sin\\theta}{\\sqrt{2}})$。\n$\\bar{m}_a = (0, 0, \\frac{r}{\\sqrt{2}}, -\\frac{ir\\sin\\theta}{\\sqrt{2}})$。\n\n现在我们检查所有 10 个内积：\n1.  $l^a l_a = l^r l_r = 1 \\cdot 0 = 0$。\n2.  $n^a n_a = n^v n_v + n^r n_r = (-1)\\frac{1}{2}(1-\\frac{2M}{r}) + (-\\frac{1}{2}(1-\\frac{2M}{r}))(-1) = 0$。\n3.  $m^a m_a = m^\\theta m_\\theta + m^\\phi m_\\phi = (\\frac{1}{\\sqrt{2}r})(\\frac{r}{\\sqrt{2}}) + (\\frac{i}{\\sqrt{2}r\\sin\\theta})(\\frac{ir\\sin\\theta}{\\sqrt{2}}) = \\frac{1}{2} - \\frac{1}{2} = 0$。\n4.  $\\bar{m}^a \\bar{m}_a = \\overline{m^a m_a} = 0$。\n5.  $l^a n_a = l^r n_r = 1 \\cdot (-1) = -1$。\n6.  $m^a \\bar{m}_a = m^\\theta \\bar{m}_\\theta + m^\\phi \\bar{m}_\\phi = (\\frac{1}{\\sqrt{2}r})(\\frac{r}{\\sqrt{2}}) + (\\frac{i}{\\sqrt{2}r\\sin\\theta})(\\frac{-ir\\sin\\theta}{\\sqrt{2}}) = \\frac{1}{2} + \\frac{1}{2} = 1$。\n7.  $l^a m_a = l^r m_r = 1 \\cdot 0 = 0$。\n8.  $l^a \\bar{m}_a = l^r \\bar{m}_r = 1 \\cdot 0 = 0$。\n9.  $n^a m_a = n^v m_v + n^r m_r = (-1) \\cdot 0 + n^r \\cdot 0 = 0$。\n10. $n^a \\bar{m}_a = n^v \\bar{m}_v + n^r \\bar{m}_r = (-1) \\cdot 0 + n^r \\cdot 0 = 0$。\n\n所有归一化和正交条件均得到满足。所构造的四足是正确的。现在将这些分量组合成最终答案的格式。\n这些分量是：\n$l^a = (0, 1, 0, 0)$\n$n^a = (-1, -\\frac{1}{2}(1-\\frac{2M}{r}), 0, 0)$\n$m^a = (0, 0, \\frac{1}{\\sqrt{2}r}, \\frac{i}{\\sqrt{2}r\\sin\\theta})$\n$\\bar{m}^a = (0, 0, \\frac{1}{\\sqrt{2}r}, \\frac{-i}{\\sqrt{2}r\\sin\\theta})$\n按指定顺序排列，它们构成了最终结果。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  1  0  0  -1  -\\frac{1}{2}\\left(1-\\frac{2M}{r}\\right)  0  0  0  0  \\frac{1}{\\sqrt{2}r}  \\frac{i}{\\sqrt{2}r\\sin\\theta}  0  0  \\frac{1}{\\sqrt{2}r}  -\\frac{i}{\\sqrt{2}r\\sin\\theta} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "建立了标架之后，下一步是计算物理量。本练习聚焦于关键的外尔标量（Weyl scalar）$\\Psi_{4}$，它编码了出射的引力辐射。你将探索 $\\Psi_{4}$ 在标架变换（一次零性助推，null boost）下的行为，这是正确解释从数值模拟中提取的引力波信号的一个至关重要的概念。",
            "id": "3493693",
            "problem": "在数值相对论和引力波提取的背景下，考虑一个度规符号差为 $(-,+,+,+)$ 的洛伦兹时空和一个 Newman-Penrose (NP) 零标架 $(l^{a},n^{a},m^{a},\\bar{m}^{a})$，其归一化条件为 $l^{a}n_{a}=-1$，$m^{a}\\bar{m}_{a}=1$，所有其他内积为零。韦尔标量 $\\Psi_{4}$ 通过韦尔张量 $C_{abcd}$ 与标架的缩并定义为 $\\Psi_{4}=-C_{abcd}\\,n^{a}\\,\\bar{m}^{b}\\,n^{c}\\,\\bar{m}^{d}$。考虑一个实正函数 $A$，它生成一类保持 NP 归一化条件不变的零性 boost，具体由 $l^{a}\\to l'^{a}=A\\,l^{a}$，$n^{a}\\to n'^{a}=A^{-1}n^{a}$ 和 $m^{a}\\to m'^{a}=m^{a}$ 给出。\n\na) 仅从 $\\Psi_{4}$ 的张量定义和零标架的归一化条件出发，推导 $\\Psi_{4}$ 在上述 boost 变换下的变换定律，并证明 $\\Psi_{4}\\to \\Psi'_{4}=A^{-2}\\Psi_{4}$。\n\nb) 在引力波数据分析中，人们在一个大面积半径的提取球面上定义复标量场 $\\Psi_{4}(t,\\theta,\\phi)$，并将其投影到自旋权重为 $-2$ 的自旋权重球谐函数上，以获得模式振幅\n$$\n\\Psi_{4,\\ell m}(t)=\\int \\Psi_{4}(t,\\theta,\\phi)\\,{}_{-2}\\bar{Y}_{\\ell m}(\\theta,\\phi)\\,d\\Omega.\n$$\n假设在提取半径处，数值模拟中使用的标架相对于一个选定的辐射标架，经过一个与角度无关的实因子 $A(t)$ 的 boost 变换，因此测得的标量与 (a) 部分中找到的 boost 变换相关。假设测度 $d\\Omega$ 和函数 ${}_{-2}Y_{\\ell m}(\\theta,\\phi)$ 不受此 boost 变换的影响，推导 $\\Psi_{4,\\ell m}^{\\mathrm{meas}}(t)$ 和 $\\Psi_{4,\\ell m}^{\\mathrm{phys}}(t)$ 之间的关系，并说明为恢复物理模式而必须应用于每个测量模式的单个乘法修正因子。你的最终答案应为该修正因子的一个以 $A(t)$ 表示的闭合形式解析表达式，不包含任何单位。\n\n只提供乘法因子作为最终答案，而不是一个等式，且不包含任何单位。无需进行四舍五入。",
            "solution": "所述问题是有效的。它在科学上基于广义相对论和 Newman-Penrose 形式体系的原理，信息充分且一致，表述客观，是一个适定的问题。我们可以开始求解。\n\n问题分为两部分。首先，我们必须推导韦尔标量 $\\Psi_{4}$ 在一个特定的零性 boost 下的变换性质。其次，我们应用这个结果来确定从数值模拟中提取的引力波模式的修正因子。\n\n**a) $\\Psi_{4}$ 在零性 boost 下的变换**\n\n我们被给定了韦尔标量 $\\Psi_{4}$ 的定义，它用韦尔张量 $C_{abcd}$ 和 Newman-Penrose (NP) 零标架矢量 $(l^{a}, n^{a}, m^{a}, \\bar{m}^{a})$ 表示为：\n$$\n\\Psi_{4} = -C_{abcd}\\,n^{a}\\,\\bar{m}^{b}\\,n^{c}\\,\\bar{m}^{d}\n$$\n我们正在考虑一个零性 boost 变换（一种 III 型洛伦兹变换），它对标架矢量的变换如下：\n$$\nl'^{a} = A\\,l^{a}\n$$\n$$\nn'^{a} = A^{-1}n^{a}\n$$\n$$\nm'^{a} = m^{a}\n$$\n其中 $A$ 是一个实正函数。复共轭矢量 $\\bar{m}^{a}$ 的变换是通过对 $m^{a}$ 的变换取复共轭得到的：\n$$\n\\bar{m}'^{a} = \\overline{(m^{a})} = \\bar{m}^{a}\n$$\n问题陈述了这些变换保持 NP 归一化条件不变（$l'^{a}n'_{a} = (A l^{a})(A^{-1}n_{a}) = l^{a}n_{a} = -1$ 和 $m'^{a}\\bar{m}'_{a} = m^{a}\\bar{m}_{a} = 1$）。\n\n为了找到 $\\Psi_{4}$ 的变换定律，我们在新的（带撇的）基底下写出该标量的表达式，记作 $\\Psi'_{4}$：\n$$\n\\Psi'_{4} = -C_{abcd}\\,n'^{a}\\,\\bar{m}'^{b}\\,n'^{c}\\,\\bar{m}'^{d}\n$$\n韦尔张量 $C_{abcd}$ 是一个几何对象，其分量不发生变换；而是与新的基矢量进行缩并。我们将带撇的标架矢量的表达式代入此方程：\n$$\n\\Psi'_{4} = -C_{abcd}\\,(A^{-1}n^{a})\\,(\\bar{m}^{b})\\,(A^{-1}n^{c})\\,(\\bar{m}^{d})\n$$\n由于 $A$ 是一个标量函数，因子 $A^{-1}$ 可以从张量缩并中提出来：\n$$\n\\Psi'_{4} = (A^{-1})(A^{-1}) \\left( -C_{abcd}\\,n^{a}\\,\\bar{m}^{b}\\,n^{c}\\,\\bar{m}^{d} \\right)\n$$\n$$\n\\Psi'_{4} = A^{-2} \\left( -C_{abcd}\\,n^{a}\\,\\bar{m}^{b}\\,n^{c}\\,\\bar{m}^{d} \\right)\n$$\n括号中的表达式是原始韦尔标量 $\\Psi_{4}$ 的定义。因此，我们得到了 $\\Psi_{4}$ 在这个特定的零性 boost 下的变换定律：\n$$\n\\Psi'_{4} = A^{-2}\\Psi_{4}\n$$\n这就完成了 (a) 部分要求的推导。\n\n**b) 引力波模式的修正因子**\n\n在 (b) 部分，我们被告知，数值模拟中使用的标架（“测量”标架）相对于一个物理上选定的辐射标架（“物理”标架）发生了 boost 变换。我们将测量量与 (a) 部分中的带撇参考系相关联，将物理量与不带撇的参考系相关联。boost 因子 $A$ 被给定为仅时间的函数 $A(t)$，且与角度无关。\n\n根据 (a) 部分的结果，测量的韦尔标量 $\\Psi_{4}^{\\mathrm{meas}}$ 与物理韦尔标量 $\\Psi_{4}^{\\mathrm{phys}}$ 的关系为：\n$$\n\\Psi_{4}^{\\mathrm{meas}}(t,\\theta,\\phi) = A(t)^{-2} \\Psi_{4}^{\\mathrm{phys}}(t,\\theta,\\phi)\n$$\n测量波形的模式振幅 $\\Psi_{4,\\ell m}^{\\mathrm{meas}}(t)$ 是通过将 $\\Psi_{4}^{\\mathrm{meas}}$ 投影到自旋权重为 $s = -2$ 的自旋权重球谐函数上获得的：\n$$\n\\Psi_{4,\\ell m}^{\\mathrm{meas}}(t) = \\int \\Psi_{4}^{\\mathrm{meas}}(t,\\theta,\\phi)\\,{}_{-2}\\bar{Y}_{\\ell m}(\\theta,\\phi)\\,d\\Omega\n$$\n其中积分是在单位球面上进行的，测度为 $d\\Omega = \\sin\\theta\\,d\\theta\\,d\\phi$。\n\n我们将测量标量和物理标量之间的关系代入这个积分表达式：\n$$\n\\Psi_{4,\\ell m}^{\\mathrm{meas}}(t) = \\int \\left( A(t)^{-2} \\Psi_{4}^{\\mathrm{phys}}(t,\\theta,\\phi) \\right)\\,{}_{-2}\\bar{Y}_{\\ell m}(\\theta,\\phi)\\,d\\Omega\n$$\n由于 boost 因子 $A(t)$ 与角度变量 $(\\theta, \\phi)$ 无关，因此项 $A(t)^{-2}$ 对于积分来说是一个常数，可以被提出来：\n$$\n\\Psi_{4,\\ell m}^{\\mathrm{meas}}(t) = A(t)^{-2} \\int \\Psi_{4}^{\\mathrm{phys}}(t,\\theta,\\phi)\\,{}_{-2}\\bar{Y}_{\\ell m}(\\theta,\\phi)\\,d\\Omega\n$$\n我们认出剩下的积分正是物理模式振幅 $\\Psi_{4,\\ell m}^{\\mathrm{phys}}(t)$ 的定义：\n$$\n\\Psi_{4,\\ell m}^{\\mathrm{phys}}(t) = \\int \\Psi_{4}^{\\mathrm{phys}}(t,\\theta,\\phi)\\,{}_{-2}\\bar{Y}_{\\ell m}(\\theta,\\phi)\\,d\\Omega\n$$\n因此，测量模式振幅与物理模式振幅之间的关系是：\n$$\n\\Psi_{4,\\ell m}^{\\mathrm{meas}}(t) = A(t)^{-2} \\Psi_{4,\\ell m}^{\\mathrm{phys}}(t)\n$$\n问题要求的是为恢复*物理*模式振幅而必须应用于*测量*模式振幅的乘法修正因子。为了找到这个因子，我们对上述方程求解 $\\Psi_{4,\\ell m}^{\\mathrm{phys}}(t)$：\n$$\n\\Psi_{4,\\ell m}^{\\mathrm{phys}}(t) = A(t)^{2} \\Psi_{4,\\ell m}^{\\mathrm{meas}}(t)\n$$\n这个方程明确地表明，物理模式是通过将测量模式乘以一个因子 $A(t)^{2}$ 得到的。因此，所需的修正因子是 $A(t)^{2}$。",
            "answer": "$$\n\\boxed{A(t)^{2}}\n$$"
        },
        {
            "introduction": "这最后一个练习将理论与计算联系起来，而这正是数值相对论的核心。基于前面的概念，你将设计一个数值流程，用于分析来自扭曲网格上模拟数据的引力波信号 $\\psi_4$。这个练习处理了坐标扭曲和模式混淆等真实世界中的挑战，为研究人员提取和量化引力波所使用的技术提供了实践经验。",
            "id": "3493653",
            "problem": "构建一个完整的数值计算流程，用于计算在数值畸变球面上的 Newman-Penrose 标量 $\\,\\psi_4\\,$（其自旋权重为 $\\,s=-2\\,$）的自旋权重球谐变换，并量化角度混叠和泄漏。你的程序必须实现并使用 Newman-Penrose eth 算子 $\\,ð\\,$ 和 $\\,\\bar{ð}\\,$ 作为基本构建块，并且必须仅依赖于基础定义和广为接受的恒等式，而不使用本问题陈述中提供的快捷公式。推导必须从以下基础开始：\n\n- 单位球面 $\\,\\mathbb{S}^2\\,$，具有标准极坐标 $\\,(\\theta,\\phi)\\,$ 和度量元 $\\,ds^2=d\\theta^2+\\sin^2\\theta\\,d\\phi^2\\,$。\n- 在 $\\,\\mathbb{S}^2\\,$ 上自旋权重为 $\\,s\\,$ 的函数的定义，以及作用于自旋权重为 $\\,s\\,$ 的场 $\\,\\eta(\\theta,\\phi)\\,$ 的 Newman-Penrose eth 算子 $\\,ð\\,$ 和 $\\,\\bar{ð}\\,$：\n$$\nð\\,\\eta = -(\\sin\\theta)^s \\left(\\partial_\\theta + i\\,\\csc\\theta\\,\\partial_\\phi\\right)\\left[(\\sin\\theta)^{-s}\\eta\\right],\\qquad\n\\bar{ð}\\,\\eta = -(\\sin\\theta)^{-s} \\left(\\partial_\\theta - i\\,\\csc\\theta\\,\\partial_\\phi\\right)\\left[(\\sin\\theta)^{s}\\eta\\right].\n$$\n- 自旋权重球谐函数 $\\,{}_{s}Y_{\\ell m}(\\theta,\\phi)\\,$ 在 $\\,\\mathbb{S}^2\\,$ 上的正交归一性：\n$$\n\\int_0^{2\\pi}\\!\\!\\int_0^\\pi {}_{s}Y_{\\ell m}(\\theta,\\phi)\\;{}_{s}Y^*_{\\ell' m'}(\\theta,\\phi)\\,\\sin\\theta\\,d\\theta\\,d\\phi \\;=\\;\\delta_{\\ell\\ell'}\\delta_{mm'}.\n$$\n\n基于此，你必须推导以下内容：\n\n1) 一种数学上原则性的构建通用整数 $\\,s\\,$ 的自旋权重球谐函数 $\\,{}_{s}Y_{\\ell m}\\,$ 的方法，从标量球谐函数 $\\,Y_{\\ell m}\\,$ 开始。明确陈述 $\\,ð\\,$ 和 $\\,\\bar{ð}\\,$ 作用于 $\\,{}_{s}Y_{\\ell m}\\,$ 时满足的阶梯关系，并解释这如何证明生成 $\\,\\psi_4\\,$ 所需的 $\\,{}_{-2}Y_{\\ell m}\\,$ 的合理性。\n\n2) 在畸变球面采样上的数值自旋权重谐波变换。考虑一个光滑、双射的角度畸变映射 $\\,(\\theta,\\phi)\\mapsto(\\Theta(\\theta,\\phi),\\Phi(\\theta,\\phi))\\,$，由下式给出\n$$\n\\Theta(\\theta,\\phi)=\\theta+\\varepsilon\\sin\\theta\\sin\\phi,\\qquad \\Phi(\\theta,\\phi)=\\phi+\\varepsilon\\sin\\theta\\cos\\phi,\n$$\n其中 $\\,\\varepsilon\\,$ 是一个小的实数。将 $\\,(\\theta,\\phi)\\,$ 视为均匀的计算网格，将 $\\,(\\Theta,\\Phi)\\,$ 视为场被采样的物理角度。通过球面上的变量替换，此映射下的正确面积元为\n$$\nd\\Omega = \\sin\\Theta\\,\\left|\\det\\frac{\\partial(\\Theta,\\Phi)}{\\partial(\\theta,\\phi)}\\right|\\,d\\theta\\,d\\phi,\n$$\n因此，近似积分的黎曼和使用权重\n$$\nw(\\theta,\\phi)=\\sin\\Theta(\\theta,\\phi)\\;\\left|\\det\\frac{\\partial(\\Theta,\\Phi)}{\\partial(\\theta,\\phi)}\\right|\\;\\Delta\\theta\\,\\Delta\\phi.\n$$\n同时定义忽略了雅可比行列式的朴素权重：\n$$\nw_{\\text{naive}}(\\theta,\\phi)=\\sin\\Theta(\\theta,\\phi)\\;\\Delta\\theta\\,\\Delta\\phi.\n$$\n\n3) 将一个采样的自旋权重场 $\\,\\psi_4(\\Theta,\\Phi)\\,$ 投影到基函数有限集合 $\\,\\{{}_{-2}Y_{\\ell m}\\}_{\\ell=\\ell_{\\min}}^{\\ell_{\\max},\\,m=-\\ell,\\ldots,\\ell}\\,$ 上的最小二乘法，其中 $\\,\\ell_{\\min}=2\\,$。使用加权正规方程或由求积权重 $\\,w\\,$ 构建的加权最小二乘系统，以获得满足以下条件的系数 $\\,a_{\\ell m}\\,$\n$$\n\\psi_4(\\Theta,\\Phi)\\approx \\sum_{\\ell=2}^{\\ell_{\\max}}\\sum_{m=-\\ell}^{\\ell} a_{\\ell m}\\;{}_{-2}Y_{\\ell m}(\\Theta,\\Phi)\n$$\n在离散加权 $\\,L^2\\,$ 意义下。\n\n4) 角度泄漏和混叠的明确度量：\n- 令 $\\,\\mathcal{S}\\,$ 表示真实场中实际存在且位于已解析频带 $\\,\\ell\\le \\ell_{\\max}\\,$ 内的目标模式集合。定义总恢复功率 $\\,P_{\\text{rec}}=\\sum_{\\ell,m}|a_{\\ell m}|^2\\,$ 和带内目标功率 $\\,P_{\\text{tgt}}=\\sum_{(\\ell,m)\\in\\mathcal{S}}|a_{\\ell m}|^2\\,$。定义泄漏分数\n$$\nL = 1 - \\frac{P_{\\text{tgt}}}{P_{\\text{rec}}},\\quad\\text{约定当 }P_{\\text{rec}}=0\\text{ 时 }L=0.\n$$\n- 对于所有真实内容都在已解析频带内的测试，根据构造定义混叠分数为 $\\,A=0\\,$（无未解析内容）。对于所有真实内容都在已解析频带外的测试，定义混叠分数为\n$$\nA=\\frac{P_{\\text{rec}}}{P_{\\text{true}}},\\qquad P_{\\text{true}}=\\sum_{(\\ell,m)\\in\\text{true}} |A_{\\ell m}|^2,\n$$\n即，带外真实功率混叠到已解析频带内的分数。\n\n你的程序必须实现：\n- 在均匀的 $(\\theta,\\phi)$ 网格上使用有限差分实现 Newman-Penrose 算子 $\\,ð\\,$ 和 $\\,\\bar{ð}\\,$，并用它们对一个代表性的 $\\,{}_{s}Y_{\\ell m}\\,$ 进行数值阶梯关系检验（你无需打印此检验；它用于证明构造的合理性）。\n- 一个稳健的求值器，用于在任意角度 $\\,(\\Theta,\\Phi)\\,$ 计算整数 $\\,s\\,$（包括 $\\,s=-2\\,$）的 $\\,{}_{s}Y_{\\ell m}(\\Theta,\\Phi)\\,$，适用于在畸变网格上构建变换矩阵。\n- 一个用于求解系数 $\\,a_{\\ell m}\\,$ 的加权最小二乘解算器。\n\n单位：无需报告物理单位，因为单位球面上的所有量都是无量纲的。角度必须以弧度为单位。\n\n测试套件：\n对以下每种情况，计算如上定义的泄漏分数 $\\,L\\,$ 和混叠分数 $\\,A\\,$。\n\n- 测试 1（理想情况，无畸变，带内）：$\\,\\ell_{\\max}=8\\,$，$\\,N_\\theta=64\\,$，$\\,N_\\phi=128\\,$，$\\,\\varepsilon=0\\,$。场 $\\,\\psi_4={}_{-2}Y_{2,2}\\,$，具有单位复振幅。使用正确的权重 $\\,w=\\sin\\theta\\,\\Delta\\theta\\,\\Delta\\phi\\,$。为此测试输出两个浮点数 $[L,A]$。\n- 测试 2（畸变，朴素权重）：与测试 1 相同，但 $\\,\\varepsilon=0.1\\,$ 并使用上面定义的朴素权重 $\\,w_{\\text{naive}}\\,$。输出 $[L,A]$。\n- 测试 3（畸变，雅可比校正权重）：与测试 2 相同，但使用校正后的权重 $\\,w=\\sin\\Theta\\,\\left|\\det\\frac{\\partial(\\Theta,\\Phi)}{\\partial(\\theta,\\phi)}\\right|\\,\\Delta\\theta\\,\\Delta\\phi\\,$。输出 $[L,A]$。\n- 测试 4（混叠边界情况）：$\\,\\ell_{\\max}=8\\,$，$\\,N_\\theta=32\\,$，$\\,N_\\phi=64\\,$，$\\,\\varepsilon=0\\,$。场 $\\,\\psi_4={}_{-2}Y_{12,2}\\,$，具有单位振幅（完全在带外）。使用正确的无畸变权重。输出 $[L,A]$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含八个结果，以逗号分隔的列表形式并用方括号括起，按测试 1 到 4 的顺序排列，每个测试贡献其 $L$ 然后是 $A$ 条目：\n- 整体格式：$[\\text{L1},\\text{A1},\\text{L2},\\text{A2},\\text{L3},\\text{A3},\\text{L4},\\text{A4}]$。\n所有角度必须以弧度处理，所有数字必须打印为十进制浮点数。",
            "solution": "该问题要求构建一个数值流程，在畸变球面上执行自旋权重球谐变换，重点在于量化像泄漏和混叠这样的数值伪影。该流程必须从第一性原理出发进行开发，始于 Newman-Penrose (NP) 形式体系。\n\n### 第 1 部分：自旋权重球谐函数的理论构建\n\n此分析的基础是自旋权重球谐函数集 ${}_{s}Y_{\\ell m}(\\theta,\\phi)$，它们构成了球面 $\\mathbb{S}^2$ 上自旋权重为 $s$ 的函数的完备正交归一基。问题提供了正交归一性条件：\n$$\n\\int_{\\mathbb{S}^2} {}_{s}Y_{\\ell m}(\\theta,\\phi)\\;{}_{s}Y^*_{\\ell' m'}(\\theta,\\phi)\\,d\\Omega \\;=\\; \\int_0^{2\\pi}\\!\\!\\int_0^\\pi {}_{s}Y_{\\ell m}(\\theta,\\phi)\\;{}_{s}Y^*_{\\ell' m'}(\\theta,\\phi)\\,\\sin\\theta\\,d\\theta\\,d\\phi \\;=\\;\\delta_{\\ell\\ell'}\\delta_{mm'}.\n$$\n问题还提供了 Newman-Penrose eth 算子 $ð$（读作 \"eth\"）和 $\\bar{ð}$（读作 \"eth-bar\"）的定义，它们作用于自旋权重为 $s$ 的场 $\\eta$：\n$$\nð\\,\\eta = -(\\sin\\theta)^s \\left(\\partial_\\theta + i\\,\\csc\\theta\\,\\partial_\\phi\\right)\\left[(\\sin\\theta)^{-s}\\eta\\right],\n$$\n$$\n\\bar{ð}\\,\\eta = -(\\sin\\theta)^{-s} \\left(\\partial_\\theta - i\\,\\csc\\theta\\,\\partial_\\phi\\right)\\left[(\\sin\\theta)^{s}\\eta\\right].\n$$\n这些算子的一个关键性质是 $ð$ 将函数的自旋权重提高 $1$，而 $\\bar{ð}$ 将其降低 $1$。当它们作用于自旋权重球谐函数时，它们作为阶梯算子，满足以下关系：\n$$\nð\\,{}_{s}Y_{\\ell m} = \\sqrt{(\\ell-s)(\\ell+s+1)}\\,{}_{s+1}Y_{\\ell m},\n$$\n$$\n\\bar{ð}\\,{}_{s}Y_{\\ell m} = -\\sqrt{(\\ell+s)(\\ell-s+1)}\\,{}_{s-1}Y_{\\ell m}.\n$$\n这些关系在 $\\ell \\ge |s|$ 时有效。它们提供了一种从著名的标量球谐函数 $Y_{\\ell m}$（等同于 ${}_{0}Y_{\\ell m}$）开始，构建任何整数自旋权重 $s$ 的谐波的直接方法。\n\n对于自旋权重为 $s=-2$ 的引力波标量 $\\psi_4$，我们需要基函数 ${}_{-2}Y_{\\ell m}$。这些函数可以通过对标量谐波 ${}_{0}Y_{\\ell m}$ 两次应用 $\\bar{ð}$ 算子来生成。\n第一次应用 ($s=0 \\to s=-1$):\n$$\n\\bar{ð}\\,{}_{0}Y_{\\ell m} = -\\sqrt{(\\ell+0)(\\ell-0+1)}\\,{}_{-1}Y_{\\ell m} = -\\sqrt{\\ell(\\ell+1)}\\,{}_{-1}Y_{\\ell m}.\n$$\n第二次应用 ($s=-1 \\to s=-2$):\n$$\n\\bar{ð}\\,{}_{-1}Y_{\\ell m} = -\\sqrt{(\\ell-1)(\\ell-(-1)+1)}\\,{}_{-2}Y_{\\ell m} = -\\sqrt{(\\ell-1)(\\ell+2)}\\,{}_{-2}Y_{\\ell m}.\n$$\n结合这些，我们得到了一个用 $\\bar{ð}$ 的重复作用表示 ${}_{-2}Y_{\\ell m}$ 的表达式：\n$$\n{}_{-2}Y_{\\ell m} = \\frac{1}{\\sqrt{(\\ell-1)(\\ell+2)}} \\bar{ð} \\left( \\frac{1}{\\sqrt{\\ell(\\ell+1)}} \\bar{ð}\\,{}_{0}Y_{\\ell m} \\right) = \\frac{1}{\\sqrt{\\ell(\\ell+1)(\\ell-1)(\\ell+2)}} \\bar{ð}^2 Y_{\\ell m}.\n$$\n此推导在 $\\ell \\ge |s|$ 时有效，因此对于 $s=-2$，我们必须有 $\\ell \\ge 2$，这与引力辐射的物理学以及问题中 $\\ell_{\\min}=2$ 的规定相一致。\n\n虽然这种构建是基础性的，但通过有限差分直接进行数值实现会累积误差。对于在球面上任意点进行稳健数值计算的求值器，使用已知的 ${}_{s}Y_{\\ell m}$ 的闭式表达式更为可靠，该表达式即为这种构建方法的结果。自旋权重谐波与 Wigner 小 $d$-矩阵 $d^\\ell_{m,s}(\\theta)$ 相关：\n$$\n{}_{s}Y_{\\ell m}(\\theta, \\phi) = \\sqrt{\\frac{2\\ell+1}{4\\pi}} d^\\ell_{m,s}(\\theta) e^{im\\phi}.\n$$\n$d$-矩阵元本身可以用雅可比多项式 $P_n^{(\\alpha,\\beta)}(x)$ 表示。一种数值上方便的实现策略利用对称性来计算任何有效整数索引的 $d^\\ell_{m,s}$。核心公式，在 $m \\ge s \\ge 0$ 时有效，为：\n$$\nd^\\ell_{m,s}(\\theta) = \\left[\\frac{(\\ell+m)!(\\ell-m)!}{(\\ell+s)!(\\ell-s)!}\\right]^{1/2} (\\sin(\\theta/2))^{m-s} (\\cos(\\theta/2))^{m+s} P_{\\ell-m}^{(m-s, m+s)}(\\cos\\theta).\n$$\n$m,s$ 的其他情况可以使用对称关系处理，例如 $d^\\ell_{m,s}(\\theta) = d^\\ell_{-s,-m}(\\theta)$ 和 $d^\\ell_{m,s}(\\theta) = (-1)^{m-s}d^\\ell_{s,m}(\\theta)$。数值实现将利用这些恒等式。\n\n### 第 2 部分：在畸变球面上的离散化\n\n数值相对论模拟通常涉及与简单球坐标网格不完全对齐的坐标系。问题通过一个畸变映射 $(\\theta,\\phi)\\mapsto(\\Theta(\\theta,\\phi),\\Phi(\\theta,\\phi))$ 来模拟这种情况，其中 $(\\theta,\\phi)$ 表示均匀的计算网格，而 $(\\Theta,\\Phi)$ 是场被采样的物理角坐标。给定的映射是：\n$$\n\\Theta(\\theta,\\phi)=\\theta+\\varepsilon\\sin\\theta\\sin\\phi,\\qquad \\Phi(\\theta,\\phi)=\\phi+\\varepsilon\\sin\\theta\\cos\\phi.\n$$\n当通过离散和在这些新坐标中对球面进行积分时，与计算网格单元 $d\\theta d\\phi$ 相关联的面积元 $d\\Omega$ 不再是简单的 $\\sin\\theta d\\theta d\\phi$。变量替换要求引入变换的雅可比行列式：\n$$\nd\\Omega = \\sin\\Theta(\\theta,\\phi)\\,\\left|\\det\\frac{\\partial(\\Theta,\\Phi)}{\\partial(\\theta,\\phi)}\\right|\\,d\\theta\\,d\\phi.\n$$\n雅可比行列式 $J(\\theta,\\phi) = \\det\\frac{\\partial(\\Theta,\\Phi)}{\\partial(\\theta,\\phi)}$ 计算如下：\n$$\n\\frac{\\partial\\Theta}{\\partial\\theta} = 1 + \\varepsilon \\cos\\theta\\sin\\phi, \\qquad \\frac{\\partial\\Theta}{\\partial\\phi} = \\varepsilon \\sin\\theta\\cos\\phi,\n$$\n$$\n\\frac{\\partial\\Phi}{\\partial\\theta} = \\varepsilon \\cos\\theta\\cos\\phi, \\qquad \\frac{\\partial\\Phi}{\\partial\\phi} = 1 - \\varepsilon \\sin\\theta\\sin\\phi.\n$$\n$$\nJ(\\theta,\\phi) = \\frac{\\partial\\Theta}{\\partial\\theta}\\frac{\\partial\\Phi}{\\partial\\phi} - \\frac{\\partial\\Theta}{\\partial\\phi}\\frac{\\partial\\Phi}{\\partial\\theta} = (1 + \\varepsilon \\cos\\theta\\sin\\phi)(1 - \\varepsilon \\sin\\theta\\sin\\phi) - (\\varepsilon \\sin\\theta\\cos\\phi)(\\varepsilon \\cos\\theta\\cos\\phi)\n$$\n$$\nJ(\\theta,\\phi) = 1 + \\varepsilon\\sin\\phi(\\cos\\theta - \\sin\\theta) - \\varepsilon^2\\sin\\theta\\cos\\theta.\n$$\n对于具有间距 $\\Delta\\theta$ 和 $\\Delta\\phi$ 的离散网格，点 $(\\theta_j, \\phi_k)$ 的正确求积权重是 $w_{jk} = \\sin(\\Theta_{jk})|J(\\theta_j, \\phi_k)|\\Delta\\theta\\Delta\\phi$。忽略坐标畸变对面积元影响的朴素权重是 $w_{\\text{naive},jk} = \\sin(\\Theta_{jk})\\Delta\\theta\\Delta\\phi$。\n\n### 第 3 部分：最小二乘谐波变换\n\n目标是找到采样场 $\\psi_4$ 在自旋权重球谐函数基中展开的系数 $a_{\\ell m}$，直到最大模式数 $\\ell_{\\max}$：\n$$\n\\psi_4(\\Theta_i, \\Phi_i) \\approx \\sum_{\\ell=2}^{\\ell_{\\max}}\\sum_{m=-\\ell}^{\\ell} a_{\\ell m}\\;{}_{-2}Y_{\\ell m}(\\Theta_i, \\Phi_i),\n$$\n其中索引 $i$ 遍历所有 $N_p$ 个网格点。这是一个线性系统，通常是超定的（$N_p \\gg N_b$，基模式的数量）。系数 $a_{\\ell m}$ 是通过最小化加权残差平方和来找到的：\n$$\n\\chi^2 = \\sum_{i=1}^{N_p} w_i \\left| \\psi_4(\\Theta_i, \\Phi_i) - \\sum_{\\alpha=1}^{N_b} a_{\\alpha} B_{\\alpha}(\\Theta_i, \\Phi_i) \\right|^2.\n$$\n这里，$\\alpha$ 是 $(\\ell, m)$ 的多重索引，$a_\\alpha$ 是系数 $a_{\\ell m}$，$B_\\alpha$ 是基函数 ${}_{-2}Y_{\\ell m}$。这是一个标准的加权线性最小二乘问题。令 $y_i = \\psi_4(\\Theta_i, \\Phi_i)$ 为数据向量，$X_{i\\alpha} = B_{\\alpha}(\\Theta_i, \\Phi_i)$ 为设计矩阵，$W$ 为权重 $w_i$ 的对角矩阵。该问题等价于在最小二乘意义下求解线性系统 $(\\sqrt{W}X)a = (\\sqrt{W}y)$。这可以使用数值线性代数库高效求解。\n\n### 第 4 部分：量化泄漏和混叠\n\n问题定义了两种度量来量化谐波变换中的误差：\n- **泄漏 ($L$)**：衡量恢复的功率中有多少位于原始信号中不存在的模式（在已解析频带内）。给定总恢复功率 $P_{\\text{rec}}=\\sum_{\\ell,m}|a_{\\ell m}|^2$ 和在“真实”目标模式中恢复的功率 $P_{\\text{tgt}}=\\sum_{(\\ell,m)\\in\\mathcal{S}}|a_{\\ell m}|^2$，泄漏为 $L = 1 - P_{\\text{tgt}}/P_{\\text{rec}}$。集合 $\\mathcal{S}$ 包含真实信号中存在且位于已解析频带 $\\ell \\le \\ell_{\\max}$ 内的 $(\\ell,m)$ 模式。网格畸变可能导致来自单个真实模式的功率“泄漏”到其他模式中，从而增加 $L$。\n- **混叠 ($A$)**：衡量由于欠采样，来自高频模式（超出 $\\ell_{\\max}$）的功率被错误地解释为低频模式功率的分数。对于完全在已解析频带之外的信号，任何恢复的功率都是由混叠引起的。该分数为 $A=P_{\\text{rec}}/P_{\\text{true}}$，其中 $P_{\\text{true}}$ 是原始带外信号的总功率。\n\n实现将通过构建 ${}_{s}Y_{\\ell m}$、雅可比行列式和最小二乘解算器所需的函数，然后将它们应用于问题中定义的四个测试用例来计算每个用例的 $L$ 和 $A$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jacobi, gammaln\nfrom math import factorial\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n\n    # Test Suite: [lmax, N_theta, N_phi, epsilon, field_lm, weights_type]\n    # 'field_lm' is the (l,m) mode of the true input signal.\n    # 'weights_type' can be 'naive' or 'correct'.\n    test_cases = [\n        (8, 64, 128, 0.0, (2, 2), 'correct'), # Test 1\n        (8, 64, 128, 0.1, (2, 2), 'naive'),   # Test 2\n        (8, 64, 128, 0.1, (2, 2), 'correct'), # Test 3\n        (8, 32, 64, 0.0, (12, 2), 'correct'), # Test 4\n    ]\n\n    results = []\n    for case in test_cases:\n        L, A = run_spin_transform_test(*case)\n        results.extend([L, A])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef wigner_d_lm_s(l, m, s, theta):\n    \"\"\"\n    Computes the Wigner small-d matrix element d^l_{m,s}(theta).\n    This implementation uses symmetries to reduce all cases to one where\n    m >= s >= 0, for which a direct formula involving Jacobi polynomials is used.\n    \"\"\"\n    # Trivial case\n    if l == 0:\n        return np.ones_like(theta) if m == 0 and s == 0 else np.zeros_like(theta)\n        \n    # Symmetry relations to bring indices into the primary domain (m >= s >= 0)\n    # d^l_ms = (-1)^(m-s) d^l_sm\n    if abs(m)  abs(s):\n        return (-1)**(m - s) * wigner_d_lm_s(l, s, m, theta)\n    \n    # d^l_ms = d^l_-m,-s\n    if m  0:\n        return (-1)**(m - s) * wigner_d_lm_s(l, -m, -s, theta)\n\n    # Now we have m = |s|, and m = 0.\n    # d^l_m,s = (-1)^(m-s) d^l_m,-s. If s  0, handle it.\n    if s  0:\n        return (-1)**(m - s) * wigner_d_lm_s(l, m, -s, theta)\n\n    # Primary domain: m = s = 0\n    # Use log-gamma for factorials to avoid overflow/underflow\n    log_fact_term = 0.5 * (\n        gammaln(l + m + 1) + gammaln(l - m + 1) -\n        gammaln(l + s + 1) - gammaln(l - s + 1)\n    )\n    prefactor = np.exp(log_fact_term)\n\n    term1 = np.sin(theta / 2)**(m - s)\n    term2 = np.cos(theta / 2)**(m + s)\n    \n    jacobi_poly = jacobi(l - m, m - s, m + s)(np.cos(theta))\n\n    return prefactor * term1 * term2 * jacobi_poly\n\ndef sYlm(s, l, m, theta, phi):\n    \"\"\"\n    Evaluates the spin-weighted spherical harmonic _sY_lm at angles (theta, phi).\n    theta and phi can be arrays.\n    \"\"\"\n    if abs(s) > l or abs(m) > l:\n        return np.zeros_like(theta, dtype=np.complex128)\n    \n    norm = np.sqrt((2 * l + 1) / (4 * np.pi))\n    d_matrix_val = wigner_d_lm_s(l, m, s, theta)\n    phase = np.exp(1j * m * phi)\n    \n    return norm * d_matrix_val * phase\n\ndef run_spin_transform_test(lmax, N_theta, N_phi, epsilon, field_lm, weights_type):\n    \"\"\"\n    Performs a single test of the spin-weighted spherical harmonic transform.\n    \"\"\"\n    s = -2 # Spin weight for psi_4\n    lmin = abs(s)\n\n    # 1. Define computational grid (uniform in theta, phi)\n    # A mid-point grid in theta avoids poles.\n    delta_theta = np.pi / N_theta\n    delta_phi = 2 * np.pi / N_phi\n    theta_1d = (np.arange(N_theta) + 0.5) * delta_theta\n    phi_1d = np.arange(N_phi) * delta_phi\n    theta_grid, phi_grid = np.meshgrid(theta_1d, phi_1d, indexing='ij')\n\n    # 2. Define distorted physical grid (Theta, Phi)\n    Theta_grid = theta_grid + epsilon * np.sin(theta_grid) * np.sin(phi_grid)\n    Phi_grid = phi_grid + epsilon * np.sin(theta_grid) * np.cos(phi_grid)\n\n    # 3. Calculate quadrature weights\n    if weights_type == 'correct':\n        # Jacobian determinant of the distortion map\n        J = 1 + epsilon * np.sin(phi_grid) * (np.cos(theta_grid) - np.sin(theta_grid)) \\\n            - epsilon**2 * np.sin(theta_grid) * np.cos(theta_grid)\n        weights = np.sin(Theta_grid) * np.abs(J) * delta_theta * delta_phi\n    elif weights_type == 'naive':\n        weights = np.sin(Theta_grid) * delta_theta * delta_phi\n    else:\n        raise ValueError(\"Unknown weights_type\")\n\n    # Flatten grids and weights for linear algebra\n    N_points = N_theta * N_phi\n    sqrt_weights_flat = np.sqrt(weights.flatten())\n    Theta_flat = Theta_grid.flatten()\n    Phi_flat = Phi_grid.flatten()\n    \n    # 4. Construct basis modes and design matrix for least-squares\n    modes = []\n    for l in range(lmin, lmax + 1):\n        for m in range(-l, l + 1):\n            modes.append((l, m))\n    \n    N_modes = len(modes)\n    mode_map = {mode: i for i, mode in enumerate(modes)}\n    \n    # Design matrix A (unweighted)\n    A = np.zeros((N_points, N_modes), dtype=np.complex128)\n    for i, (l, m) in enumerate(modes):\n        A[:, i] = sYlm(s, l, m, Theta_flat, Phi_flat)\n        \n    # Weighted design matrix A'\n    A_prime = A * sqrt_weights_flat[:, np.newaxis]\n\n    # 5. Construct data vector from true field\n    true_l, true_m = field_lm\n    true_field = sYlm(s, true_l, true_m, Theta_flat, Phi_flat)\n    \n    # Weighted data vector b'\n    b_prime = true_field * sqrt_weights_flat\n\n    # 6. Solve the weighted least-squares problem\n    coeffs, residuals, rank, s_values = np.linalg.lstsq(A_prime, b_prime, rcond=None)\n    \n    # 7. Calculate leakage and aliasing metrics\n    P_rec = np.sum(np.abs(coeffs)**2)\n    \n    if P_rec == 0:\n        return 0.0, 0.0\n\n    in_band_and_in_signal = (true_l >= lmin and true_l = lmax)\n    \n    # Calculate Leakage\n    if in_band_and_in_signal:\n        true_mode_idx = mode_map.get((true_l, true_m))\n        if true_mode_idx is not None:\n            P_tgt = np.abs(coeffs[true_mode_idx])**2\n        else: # Should not happen if logic is correct\n            P_tgt = 0.0\n        L = 1 - P_tgt / P_rec\n    else: # True signal is out of band, so any recovered power is \"leaked\" from the empty target set\n        P_tgt = 0.0\n        L = 1.0\n\n    # Calculate Aliasing\n    if not in_band_and_in_signal: # All true content is out-of-band\n        # True power is 1 since signal is a single normalized harmonic\n        P_true = 1.0\n        A = P_rec / P_true\n    else: # All true content is in-band\n        A = 0.0\n\n    return L, A\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}