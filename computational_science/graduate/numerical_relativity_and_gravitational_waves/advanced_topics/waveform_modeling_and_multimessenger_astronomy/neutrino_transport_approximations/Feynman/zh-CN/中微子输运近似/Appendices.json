{
    "hands_on_practices": [
        {
            "introduction": "这第一个练习将我们的理解建立在扩散近似的基础上，这是描述光学厚介质中输运问题的基石。通过求解一个具有空间变化的透明度 $\\kappa_t(z)$ 的简化稳态情景下的中微子能量密度 $E$ 分布，我们可以直观地理解介质的物理属性如何影响辐射场。在进入更复杂的数值模型之前，这项解析练习至关重要。",
            "id": "3480971",
            "problem": "考虑一个表示中子星并合遗迹中光学厚的中微子不透明层垂直结构的一维平面平行板，其占据 $0 \\leq z \\leq L$ 的空间。在稳态下，假设中微子辐射场可以很好地用扩散近似来描述：中微子能量通量 $F^{z}(z)$ 与中微子能量密度 $E(z)$ 的梯度通过以下关系式联系：\n$$\nF^{z}(z) = - D(z) \\, \\partial_{z} E(z),\n$$\n其中扩散系数 $D(z)$ 由下式给出：\n$$\nD(z) = \\frac{c}{3 \\, \\kappa_{t}(z)},\n$$\n其中 $c$ 是光速，$\\kappa_{t}(z)$ 是输运不透明度。假设介质处于稳态，因此中微子能量守恒简化为：\n$$\n\\partial_{z} F^{z}(z) = 0,\n$$\n并且输运不透明度在整个板内根据以下公式线性变化：\n$$\n\\kappa_{t}(z) = \\kappa_{0} \\left( 1 + \\alpha \\, \\frac{z}{L} \\right),\n$$\n其中 $\\kappa_{0} > 0$ 且 $\\alpha > -1$ 是一个无量纲梯度参数，确保在整个板内 $\\kappa_{t}(z) > 0$。施加固定的中微子能量密度边界条件：\n$$\nE(0) = E_{0}, \\qquad E(L) = E_{L},\n$$\n其中 $E_{0}$ 和 $E_{L}$ 是有限值且不一定相等。从给定的守恒律和闭合关系出发，推导整个板上的恒定稳态通量 $F^{z}$ 和能量密度剖面 $E(z)$。讨论在 $\\alpha \\to 0$ 和 $\\alpha \\to +\\infty$ 的物理极限下，$E(z)$ 的形状和 $F^{z}$ 的大小，并用介质的光学性质来解释。\n\n对于你的最终答案，请提供闭合形式的无量纲剖面：\n$$\n\\phi(z) \\equiv \\frac{E(z) - E_{L}}{E_{0} - E_{L}},\n$$\n表示为 $z$、$L$ 和 $\\alpha$ 的单个解析函数。这个最终答案是无量纲的；不需要单位。不要求进行数值取整。",
            "solution": "所给的问题陈述是辐射输运理论背景下的一个适定边值问题，具体使用了扩散近似。它的科学依据充分，内容自洽，所有数据和条件都一致且足以得到唯一解。因此，该问题是有效的。\n\n出发点是一维稳态中微子能量守恒律，\n$$\n\\partial_{z} F^{z}(z) = 0\n$$\n对此方程关于 $z$ 积分表明，中微子能量通量 $F^{z}$ 在整个板内是恒定的。记这个恒定通量为 $F^{z}_{0}$。\n$$\nF^{z}(z) = F^{z}_{0}\n$$\n问题陈述指出，通量通过扩散近似与中微子能量密度 $E(z)$ 的梯度相关，\n$$\nF^{z}_{0} = -D(z) \\, \\partial_{z} E(z)\n$$\n其中 $D(z)$ 是扩散系数。这可以改写为关于 $E(z)$ 的微分方程：\n$$\n\\frac{dE}{dz} = -\\frac{F^{z}_{0}}{D(z)}\n$$\n扩散系数由 $D(z) = \\frac{c}{3\\kappa_{t}(z)}$ 给出，其中 $c$ 是光速，$\\kappa_{t}(z)$ 是输运不透明度。将此代入微分方程，得到：\n$$\n\\frac{dE}{dz} = -F^{z}_{0} \\frac{3\\kappa_{t}(z)}{c}\n$$\n我们给定了输运不透明度的线性剖面：\n$$\n\\kappa_{t}(z) = \\kappa_{0} \\left( 1 + \\alpha \\frac{z}{L} \\right)\n$$\n其中 $\\kappa_{0} > 0$ 且 $\\alpha > -1$。将其代入能量密度梯度的方程中，得到：\n$$\n\\frac{dE}{dz} = -\\frac{3\\kappa_{0}F^{z}_{0}}{c} \\left( 1 + \\alpha \\frac{z}{L} \\right)\n$$\n为求得能量剖面 $E(z)$ 和恒定通量 $F^{z}_{0}$，我们对此方程进行积分，并应用边界条件 $E(0) = E_{0}$ 和 $E(L) = E_{L}$。我们可以分离变量，并从 $z=0$ 积分到一个任意位置 $z$：\n$$\n\\int_{E(0)}^{E(z)} dE' = \\int_{0}^{z} -\\frac{3\\kappa_{0}F^{z}_{0}}{c} \\left( 1 + \\alpha \\frac{z'}{L} \\right) dz'\n$$\n$$\nE(z) - E(0) = -\\frac{3\\kappa_{0}F^{z}_{0}}{c} \\left[ z' + \\frac{\\alpha z'^{2}}{2L} \\right]_{0}^{z}\n$$\n使用 $E(0) = E_{0}$，我们得到 $E(z)$ 的一个中间表达式：\n$$\nE(z) - E_{0} = -\\frac{3\\kappa_{0}F^{z}_{0}}{c} \\left( z + \\frac{\\alpha z^{2}}{2L} \\right)\n$$\n为确定未知通量 $F^{z}_{0}$，我们在 $z=L$ 处应用第二个边界条件：\n$$\nE(L) - E_{0} = -\\frac{3\\kappa_{0}F^{z}_{0}}{c} \\left( L + \\frac{\\alpha L^{2}}{2L} \\right)\n$$\n代入 $E(L)=E_{L}$ 并简化括号中的项：\n$$\nE_{L} - E_{0} = -\\frac{3\\kappa_{0}F^{z}_{0}L}{c} \\left( 1 + \\frac{\\alpha}{2} \\right)\n$$\n现在我们可以求解恒定通量 $F^{z}_{0}$：\n$$\nF^{z}_{0} = -\\frac{c(E_{L}-E_{0})}{3\\kappa_{0}L(1+\\frac{\\alpha}{2})} = \\frac{c(E_{0}-E_{L})}{3\\kappa_{0}L(\\frac{2+\\alpha}{2})} = \\frac{2c(E_{0}-E_{L})}{3\\kappa_{0}L(2+\\alpha)}\n$$\n这就是恒定稳态通量的表达式。条件 $\\alpha > -1$ 确保了分母 $2+\\alpha > 1$ 永远不为零。\n\n现在我们可以通过将 $F^{z}_{0}$ 的表达式代回到 $E(z)$ 的方程中，来推导能量密度剖面 $E(z)$ 的最终表达式：\n$$\nE(z) = E_{0} -\\frac{3\\kappa_{0}}{c} \\left( \\frac{2c(E_{0}-E_{L})}{3\\kappa_{0}L(2+\\alpha)} \\right) \\left( z + \\frac{\\alpha z^{2}}{2L} \\right)\n$$\n$$\nE(z) = E_{0} - (E_{0}-E_{L}) \\frac{2}{L(2+\\alpha)} \\left( z + \\frac{\\alpha z^{2}}{2L} \\right)\n$$\n\n我们现在讨论物理极限。\n情况1：$\\alpha \\to 0$。此时，不透明度变为均匀的，$\\kappa_{t}(z) = \\kappa_{0}$。介质是均匀的。\n通量简化为：\n$$\nF^{z}_{0} = \\lim_{\\alpha \\to 0} \\frac{2c(E_{0}-E_{L})}{3\\kappa_{0}L(2+\\alpha)} = \\frac{c(E_{0}-E_{L})}{3\\kappa_{0}L}\n$$\n能量密度剖面变为：\n$$\nE(z) = \\lim_{\\alpha \\to 0} \\left[ E_{0} - (E_{0}-E_{L}) \\frac{2(z + \\frac{\\alpha z^{2}}{2L})}{L(2+\\alpha)} \\right] = E_{0} - (E_{0}-E_{L})\\frac{2z}{2L} = E_{0} - (E_{0}-E_{L})\\frac{z}{L}\n$$\n这是一个线性剖面，$E(z) = E_{0}(1-\\frac{z}{L}) + E_{L}\\frac{z}{L}$，这与在均匀介质中扩散的预期结果相符。\n\n情况2：$\\alpha \\to +\\infty$。此时，不透明度梯度非常陡峭。不透明度 $\\kappa_{t}(z)$ 在 $z=0$ 处是有限的，但对于 $z>0$ 则无界增长。\n通量变为：\n$$\nF^{z}_{0} = \\lim_{\\alpha \\to +\\infty} \\frac{2c(E_{0}-E_{L})}{3\\kappa_{0}L(2+\\alpha)} = 0\n$$\n板的总光学深度发散，板变得无法进行能量输运，因此通量消失。\n对于能量密度剖面，我们考察乘以 $(E_{0}-E_{L})$ 的项的极限：\n$$\n\\lim_{\\alpha \\to +\\infty} \\frac{2(z + \\frac{\\alpha z^{2}}{2L})}{L(2+\\alpha)} = \\lim_{\\alpha \\to \\infty} \\frac{2z/L + \\alpha z^{2}/L^{2}}{2+\\alpha} = \\lim_{\\alpha \\to \\infty} \\frac{\\alpha(2z/(\\alpha L) + z^2/L^2)}{\\alpha(2/\\alpha + 1)} = \\frac{z^2}{L^2}\n$$\n所以，剖面变为：\n$$\nE(z) = E_{0} - (E_{0}-E_{L})\\frac{z^{2}}{L^{2}}\n$$\n这是一个抛物线剖面。梯度大小 $|dE/dz|$ 与 $\\kappa_t(z)$ 成正比，以维持恒定的通量 $F^z_0=-D(z)dE/dz$。由于当 $\\alpha>0$ 时，$\\kappa_t(z)$ 随 $z$ 增加，剖面必须在 $z=0$ 附近更平坦，而在 $z=L$ 附近更陡峭。极限抛物线剖面 $E_0 - (E_0-E_L)(z/L)^2$ 的确在 $z=0$ 处斜率为零，而在 $z=L$ 处斜率最陡，这与此物理推理一致。\n\n最后，我们推导无量纲剖面 $\\phi(z) \\equiv \\frac{E(z) - E_{L}}{E_{0} - E_{L}}$，假设 $E_{0} \\neq E_{L}$。\n从剖面 $E(z)$，我们有：\n$$\nE(z) - E_{L} = \\left[ E_{0} - (E_{0}-E_{L}) \\frac{2(z + \\frac{\\alpha z^{2}}{2L})}{L(2+\\alpha)} \\right] - E_{L}\n$$\n$$\nE(z) - E_{L} = (E_{0} - E_{L}) - (E_{0}-E_{L}) \\frac{2(z + \\frac{\\alpha z^{2}}{2L})}{L(2+\\alpha)}\n$$\n$$\nE(z) - E_{L} = (E_{0}-E_{L}) \\left[ 1 - \\frac{2(z + \\frac{\\alpha z^{2}}{2L})}{L(2+\\alpha)} \\right]\n$$\n除以 $(E_{0}-E_{L})$ 得到 $\\phi(z)$：\n$$\n\\phi(z) = 1 - \\frac{2z + \\frac{\\alpha z^{2}}{L}}{L(2+\\alpha)} = 1 - \\frac{2z/L + \\alpha z^{2}/L^{2}}{2+\\alpha}\n$$\n这就是所要求的无量纲剖面。",
            "answer": "$$\n\\boxed{1 - \\frac{\\frac{2z}{L} + \\frac{\\alpha z^{2}}{L^{2}}}{2 + \\alpha}}\n$$"
        },
        {
            "introduction": "超越扩散极限需要更复杂的矩方法，例如 M1 闭合，但这些方法必须遵守基本的物理原理。这个编程练习旨在解决“可实现性问题”(realizability problem)，即确保中微子通量的大小 $|F|$ 永远不会在非物理的情况下超过能量密度 $E$（在 $c=1$ 的单位制下）。通过实现并测试一个通量限制器，您将亲手实践保证现代辐射输运代码稳定性和物理一致性的关键环节。",
            "id": "3480969",
            "problem": "考虑在一维空间中，采用矩方法并以交通流类比进行解释的中微子辐射输运问题。令 $E$ 表示中微子能量密度，$F$ 表示中微子通量。在流体的局域静止系中，并采用光速 $c$ 满足 $c=1$ 的自然单位制（所有量均为无量纲），动理学理论和因果性的基本约束要求满足可实现性条件 $E \\ge 0$ 和 $\\lvert F \\rvert \\le E$。定义通量因子 $f$：当 $E>0$ 时，$f = \\lvert F \\rvert / E$；当 $E=0$ 时，$f=0$。一个封闭关系规定了爱丁顿因子 $\\chi(f)$，它将通量因子映射到有效辐射压。该关系具有以下基于物理动机的端点条件：在各向同性扩散极限下 $\\chi(0)=1/3$，在自由流极限下 $\\chi(1)=1$。此外，$\\chi(f)$ 必须满足 $1/3 \\le \\chi(f) \\le 1$ 并且在 $f \\in [0,1]$ 上是单调不减的。\n\n您的任务是编写一个完整的程序，对下面测试套件中的每个测试用例执行以下步骤：\n\n1) 将给定的配置解释为一组由索引 $i$ 标记的一维单向束流，每个束流具有非负的能量贡献 $e_i \\ge 0$ 和方向 $s_i \\in \\{-1,+1\\}$。通过叠加构造原始矩：\n   - $E_{\\mathrm{raw}} = \\sum_i e_i$，\n   - $F_{\\mathrm{raw}} = \\sum_i e_i s_i$。\n   在特定测试中，可能会对 $F_{\\mathrm{raw}}$ 应用一个乘性过冲因子 $\\alpha \\ge 0$ 来模拟数值过冲，导致在限制之前 $F_{\\mathrm{raw}} \\leftarrow \\alpha\\, F_{\\mathrm{raw}}$。在一个测试中，原始矩 $(E_{\\mathrm{raw}},F_{\\mathrm{raw}})$ 是直接给出的，没有束流。\n\n2) 应用一个通量限制器以获得可实现的矩 $(E,F)$。如有必要，仅修改 $F_{\\mathrm{raw}}$ 的大小（保留其符号），以使可实现性约束 $E \\ge 0$ 和 $\\lvert F \\rvert \\le E$ 成立。使用最小修正原则，即仅在需要满足 $\\lvert F \\rvert \\le E$ 时才减小 $F_{\\mathrm{raw}}$ 的大小。\n\n3) 根据限制后的矩 $(E,F)$ 计算通量因子 $f$。当 $E>0$ 时，使用 $f=\\lvert F \\rvert/E$；如果 $E=0$，则 $f=0$。\n\n4) 使用一个与上述基本端点和单调性一致的封闭关系 $\\chi(f)$ 来计算每个用例的爱丁顿因子。\n\n5) 对每个测试用例，评估下面所述的指定通过/失败条件。\n\n交通流解释：将 $E$ 视为汽车密度的类比，将 $F$ 视为净流量，其最大可能流量大小为 $\\lvert F \\rvert \\le E$。反向束流的叠加对应于交叉交通；限制器必须防止非物理的拥堵（违反 $\\lvert F \\rvert \\le E$）或稀疏（由于增加逆流而导致 $f$ 增加）。\n\n在 $c=1$ 的自然单位制下工作，因此所有量都是无量纲的。\n\n测试套件。请精确实现以下五个测试用例：\n\n- 测试 1（自由流单束流，无过冲）：一个束流 $(e_1,s_1)=(1.0,+1)$。无过冲因子，即 $\\alpha=1.0$。在限制和封闭之后，如果以下所有条件在容差 $\\varepsilon=10^{-12}$ 内均成立，则该用例通过：\n  - 可实现性：$E \\ge 0$ 且 $\\lvert F \\rvert \\le E$，\n  - 端点一致性：$\\lvert f - 1 \\rvert \\le \\varepsilon$ 且 $\\lvert \\chi(f) - 1 \\rvert \\le \\varepsilon$。\n\n- 测试 2（各向同性双束流交叉，无过冲）：两个束流 $(e_1,s_1)=(1.0,+1)$ 和 $(e_2,s_2)=(1.0,-1)$。无过冲，即 $\\alpha=1.0$。在限制和封闭之后，如果满足以下条件，则该用例通过：\n  - 可实现性成立，\n  - 各向同性端点：$\\lvert f - 0 \\rvert \\le \\varepsilon$ 且 $\\lvert \\chi(f) - 1/3 \\rvert \\le \\varepsilon$，其中 $\\varepsilon=10^{-12}$。\n\n- 测试 3（在增加逆流下的单调性）：比较配置 A 和 B。\n  - A：一个束流 $(e_1,s_1)=(1.0,+1)$，无过冲。\n  - B：两个束流 $(e_1,s_1)=(1.0,+1)$ 和 $(e_2,s_2)=(0.2,-1)$，无过冲。\n  如果限制后的通量因子满足 $f_B \\le f_A + \\varepsilon$，其中 $\\varepsilon=10^{-12}$，则测试通过。\n\n- 测试 4（过冲修正）：一个束流 $(e_1,s_1)=(1.0,+1)$，在限制前对 $F_{\\mathrm{raw}}$ 应用过冲因子 $\\alpha=1.5$。如果在限制后满足以下条件，则测试通过：\n  - 可实现性成立，\n  - 限制后的通量因子满足 $\\lvert f - 1 \\rvert \\le \\varepsilon$，其中 $\\varepsilon=10^{-12}$，\n  - $F$ 的符号与限制前原始 $F_{\\mathrm{raw}}$ 的符号相匹配。\n\n- 测试 5（零能量极限处理）：原始矩直接给出为 $(E_{\\mathrm{raw}},F_{\\mathrm{raw}})=(0.0,0.7)$。如果在限制后满足以下条件，则测试通过：\n  - 可实现性成立，\n  - $E=0$ 且 $F=0$，因此 $f=0$。\n\n最终输出格式。您的程序应产生单行输出，其中包含五个测试的结果，格式为方括号内以逗号分隔的布尔值列表（例如，“[True,False,True,True,True]”）。不允许有其他输出。\n\n注意：\n- 您必须实现一个封闭关系 $\\chi(f)$，它满足基本端点条件 $\\chi(0)=1/3$ 和 $\\chi(1)=1$，在 $[0,1]$ 上单调不减，并保持在 $[1/3,1]$ 范围内。您必须在解决方案推导中从基本原理出发证明您的选择。\n- 角度单位不适用。\n- 由于选择了 $c=1$，所有量都是无量纲的。",
            "solution": "此问题已经过验证。\n\n### 第一步：提取给定条件\n- **变量与定义**:\n  - $E$: 中微子能量密度。\n  - $F$: 中微子通量。\n  - $c=1$: 自然单位制，所有量均为无量纲。\n  - 可实现性条件: $E \\ge 0$ 且 $\\lvert F \\rvert \\le E$。\n  - 通量因子: 当 $E > 0$ 时，$f = \\lvert F \\rvert / E$；当 $E=0$ 时，$f=0$。\n  - 爱丁顿因子: $\\chi(f)$，是通量因子的函数。\n- **封闭关系性质**:\n  - 端点条件: $\\chi(0)=1/3$，$\\chi(1)=1$。\n  - 值域和单调性: $1/3 \\le \\chi(f) \\le 1$ 且 $\\chi(f)$ 在 $f \\in [0,1]$ 上必须是单调不减的。\n- **流程**:\n  1. 根据束流 $(e_i, s_i)$（其中 $e_i \\ge 0, s_i \\in \\{-1, +1\\}$）使用 $E_{\\mathrm{raw}} = \\sum_i e_i$ 和 $F_{\\mathrm{raw}} = \\sum_i e_i s_i$ 构建原始矩 $(E_{\\mathrm{raw}}, F_{\\mathrm{raw}})$，或直接给出。\n  2. 对通量应用一个可选的过冲因子 $\\alpha \\ge 0$: $F_{\\mathrm{raw}} \\leftarrow \\alpha F_{\\mathrm{raw}}$。\n  3. 应用通量限制器以获得可实现的矩 $(E, F)$，仅在必要时减小 $\\lvert F_{\\mathrm{raw}} \\rvert$ 以满足 $\\lvert F \\rvert \\le E$，并保留 $F_{\\mathrm{raw}}$ 的符号。$E = E_{\\mathrm{raw}}$。\n  4. 计算 $f$ 和 $\\chi(f)$。\n  5. 评估每个测试用例的通过/失败条件。\n- **测试用例**:\n  - 测试 1: 一个束流 $(e_1, s_1)=(1.0, +1)$，$\\alpha=1.0$。如果可实现性成立，$\\lvert f - 1 \\rvert \\le \\varepsilon$ 且 $\\lvert \\chi(f) - 1 \\rvert \\le \\varepsilon$（其中 $\\varepsilon=10^{-12}$），则通过。\n  - 测试 2: 两个束流 $(e_1,s_1)=(1.0,+1)$, $(e_2,s_2)=(1.0,-1)$，$\\alpha=1.0$。如果可实现性成立，$\\lvert f - 0 \\rvert \\le \\varepsilon$ 且 $\\lvert \\chi(f) - 1/3 \\rvert \\le \\varepsilon$（其中 $\\varepsilon=10^{-12}$），则通过。\n  - 测试 3: 配置 A：一个束流 $(1.0,+1)$。配置 B：两个束流 $(1.0,+1)$, $(0.2,-1)$。两者都 $\\alpha=1.0$。如果 $f_B \\le f_A + \\varepsilon$（其中 $\\varepsilon=10^{-12}$），则通过。\n  - 测试 4: 一个束流 $(1.0,+1)$，$\\alpha=1.5$。如果可实现性成立，$\\lvert f - 1 \\rvert \\le \\varepsilon$，且 $F$ 的符号与限制前的 $F_{\\mathrm{raw}}$ 符号匹配，则通过。\n  - 测试 5: 原始矩 $(E_{\\mathrm{raw}},F_{\\mathrm{raw}})=(0.0,0.7)$。如果可实现性成立且 $E=0, F=0, f=0$，则通过。\n\n### 第二步：使用提取的给定条件进行验证\n- **科学基础**: 该问题在辐射流体力学的矩方法中有坚实的科学基础，这是计算天体物理学和数值相对论中模拟中微子输运的标准和基本工具。可实现性条件是从底层的动理学理论推导出的基本约束。由爱丁顿因子 $\\chi(f)$ 表示的封闭关系概念及其规定的性质是该方法的核心。该问题在科学上是合理的。\n- **良构性**: 该问题是良构的。每个测试用例的输入都明确指定，计算最终量的过程是算法化和确定性的。选择一个封闭关系 $\\chi(f)$ 的要求受到明确定义的数学性质的约束，允许许多简单有效的解，因此不会给仅依赖于端点值的测试结果带来歧义。通过/失败条件是精确的数值检查。\n- **客观性**: 问题以客观的数学术语陈述，没有任何主观或有偏见的语言。\n\n### 第三步：结论与行动\n问题陈述有效。它自成体系、科学上合理且定义明确。将提供完整的解决方案。\n\n### 求解推导\n\n该问题要求实现并测试一个用于一维空间中中微子辐射输运矩的通量限制程序。解决方案包括四个主要部分：计算原始矩、应用通量限制器以确保物理可实现性、计算通量因子和爱丁顿因子，以及根据一组测试用例进行验证。\n\n**1. 原始矩计算**\n中微子分布函数的零阶和一阶角矩分别对应于能量密度 $E$ 和通量 $F$。对于一维单向束流的集合，这些矩是通过线性叠加构建的。给定一组束流，每个束流具有能量贡献 $e_i \\ge 0$ 和方向 $s_i \\in \\{-1, +1\\}$，原始矩为：\n$$ E_{\\mathrm{raw}} = \\sum_i e_i $$\n$$ F_{\\mathrm{raw}} = \\sum_i e_i s_i $$\n在某些数值计算情境中，通量可能会出现伪振荡或过冲。这种效应通过在任何进一步处理之前，对原始通量应用一个乘性因子 $\\alpha \\ge 0$ 来建模，$F_{\\mathrm{raw}} \\leftarrow \\alpha F_{\\mathrm{raw}}$。\n\n**2. 可实现性与通量限制器**\n根据动理学理论，能量密度必须为非负（$E \\ge 0$），并且通量的大小不能超过能量密度（在 $c=1$ 的单位制下），即 $\\lvert F \\rvert \\le E$。这些是“可实现性条件”。由于束流能量 $e_i$ 是非负的，因此得到的原始能量密度 $E_{\\mathrm{raw}} = \\sum_i e_i$ 也是非负的，所以我们设置最终能量密度 $E = E_{\\mathrm{raw}}$，满足第一个条件。\n\n第二个条件 $\\lvert F \\rvert \\le E$ 可能会被原始通量 $F_{\\mathrm{raw}}$ 违反，尤其是在应用了过冲之后。通量限制器是一个函数，它修改 $F_{\\mathrm{raw}}$ 以产生一个满足该条件的新通量 $F$。问题规定了一个“最小修正原则”：只有当 $F_{\\mathrm{raw}}$ 的大小不符合物理实际时才减小它，并且必须保留其符号。这导致了对限制后通量 $F$ 的以下规定：\n$$ F = \\begin{cases} F_{\\mathrm{raw}}  \\text{若 } |F_{\\mathrm{raw}}| \\le E \\\\ \\text{sgn}(F_{\\mathrm{raw}}) \\cdot E  \\text{若 } |F_{\\mathrm{raw}}| > E \\end{cases} $$\n这可以紧凑地表示为：\n$$ F = \\text{sgn}(F_{\\mathrm{raw}}) \\cdot \\min(|F_{\\mathrm{raw}}|, E) $$\n其中 $\\text{sgn}(x)$ 是符号函数。这个公式能正确处理所有情况，包括当 $E=0$ 时，此时强制 $F=0$。\n\n**3. 通量因子与爱丁顿因子**\n通量因子 $f$ 是通量大小的归一化度量，定义为：\n$$ f = \\begin{cases} \\frac{\\lvert F \\rvert}{E}  \\text{若 } E > 0 \\\\ 0  \\text{若 } E = 0 \\end{cases} $$\n根据构造，$0 \\le f \\le 1$。爱丁顿因子 $\\chi(f)$ 将辐射压与能量密度联系起来，由一个“封闭”关系提供。问题要求选择一个满足以下条件的 $\\chi(f)$：\n- $\\chi(0) = 1/3$ （各向同性扩散极限）\n- $\\chi(1) = 1$ （自由流极限）\n- 在 $f \\in [0,1]$ 上单调不减。\n\n一个满足这些条件的简单且有物理动机的选择是 Minerbo 封闭关系：\n$$ \\chi(f) = \\frac{1}{3} + \\frac{2}{3}f^2 $$\n我们来验证这个选择。当 $f=0$ 时，$\\chi(0) = 1/3$。当 $f=1$ 时，$\\chi(1) = 1/3 + 2/3 = 1$。其导数是 $\\chi'(f) = 4f/3$，对于 $f \\in [0,1]$ 是非负的，保证了单调性。这个封闭关系将用于需要评估 $\\chi(f)$ 的测试用例。\n\n**4. 测试用例评估**\n现在我们将此框架应用于每个测试用例，数值容差为 $\\varepsilon = 10^{-12}$。\n\n- **测试 1 (自由流单束流)**:\n  - 输入: 束流 $(e_1,s_1)=(1.0,+1)$, $\\alpha=1.0$。\n  - 原始矩: $E_{\\mathrm{raw}} = 1.0$, $F_{\\mathrm{raw}} = 1.0 \\times (+1) = 1.0$。\n  - 限制器: $E=1.0$。因为 $|F_{\\mathrm{raw}}|=1.0 \\le E=1.0$，无需修改。$F=1.0$。\n  - 可实现性: $E=1.0 \\ge 0$ 且 $|F|=1.0 \\le E=1.0$。成立。\n  - 因子: $f = |1.0|/1.0 = 1.0$。$\\chi(1.0) = 1/3 + 2/3(1.0)^2 = 1.0$。\n  - 条件: $|f-1.0|=0 \\le \\varepsilon$ 且 $|\\chi(f)-1.0|=0 \\le \\varepsilon$。都通过。\n  - 结果: **True**。\n\n- **测试 2 (各向同性双束流交叉)**:\n  - 输入: 束流 $(1.0,+1)$ 和 $(1.0,-1)$, $\\alpha=1.0$。\n  - 原始矩: $E_{\\mathrm{raw}} = 1.0+1.0=2.0$, $F_{\\mathrm{raw}} = 1.0 \\times (+1) + 1.0 \\times (-1) = 0.0$。\n  - 限制器: $E=2.0$。因为 $|F_{\\mathrm{raw}}|=0.0 \\le E=2.0$，无需修改。$F=0.0$。\n  - 可实现性: $E=2.0 \\ge 0$ 且 $|F|=0.0 \\le E=2.0$。成立。\n  - 因子: $f = |0.0|/2.0 = 0.0$。$\\chi(0.0) = 1/3 + 2/3(0.0)^2 = 1/3$。\n  - 条件: $|f-0.0|=0 \\le \\varepsilon$ 且 $|\\chi(f)-1/3| \\approx 0 \\le \\varepsilon$。都通过。\n  - 结果: **True**。\n\n- **测试 3 (单调性)**:\n  - 配置 A: 一个束流 $(1.0,+1)$。根据测试 1，我们得到 $E_A=1.0, F_A=1.0 \\implies f_A = 1.0$。\n  - 配置 B: 束流 $(1.0,+1)$ 和 $(0.2,-1)$。\n    - 原始矩: $E_{\\mathrm{raw}} = 1.0+0.2=1.2$, $F_{\\mathrm{raw}} = 1.0 \\times (+1) + 0.2 \\times (-1) = 0.8$。\n    - 限制器: $E_B=1.2$。因为 $|F_{\\mathrm{raw}}|=0.8 \\le E_B=1.2$，无需修改。$F_B=0.8$。\n    - 因子: $f_B = |0.8|/1.2 = 2/3$。\n  - 条件: 是否 $f_B \\le f_A + \\varepsilon$？即 $2/3 \\le 1.0 + \\varepsilon$？是的。\n  - 结果: **True**。\n\n- **测试 4 (过冲修正)**:\n  - 输入: 束流 $(1.0,+1)$, $\\alpha=1.5$。\n  - 原始矩: $E_{\\mathrm{raw}} = 1.0$。过冲前的 $F_{\\mathrm{raw}}$ 是 $1.0$。符号为正。过冲后，$F_{\\mathrm{raw}} = 1.5 \\times 1.0 = 1.5$。\n  - 限制器: $E=1.0$。因为 $|F_{\\mathrm{raw}}|=1.5 > E=1.0$，限制器激活。$F = \\text{sgn}(1.5) \\cdot \\min(1.5, 1.0) = 1.0 \\times 1.0 = 1.0$。\n  - 可实现性: $E=1.0 \\ge 0$ 且 $|F|=1.0 \\le E=1.0$。成立。\n  - 因子: $f = |1.0|/1.0 = 1.0$。\n  - 条件: $|f-1.0|=0 \\le \\varepsilon$。通过。$F=1.0$ 的符号为正，与过冲前 $F_{\\mathrm{raw}}$ 为 $1.0$ 的符号匹配。通过。\n  - 结果: **True**。\n\n- **测试 5 (零能量极限处理)**:\n  - 输入: 原始矩 $(E_{\\mathrm{raw}},F_{\\mathrm{raw}})=(0.0, 0.7)$。\n  - 限制器: $E=0.0$。因为 $|F_{\\mathrm{raw}}|=0.7 > E=0.0$，限制器激活。$F = \\text{sgn}(0.7) \\cdot \\min(0.7, 0.0) = 1.0 \\times 0.0 = 0.0$。\n  - 可实现性: $E=0.0 \\ge 0$ 且 $|F|=0.0 \\le E=0.0$。成立。\n  - 因子: 因为 $E=0$，$f$ 根据定义为 $0$。\n  - 条件: $E=0.0$, $F=0.0$, 且 $f=0.0$。全部成立。\n  - 结果: **True**。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global tolerance for floating point comparisons\nEPSILON = 1e-12\n\ndef chi(f):\n    \"\"\"\n    Computes the Eddington factor using the Minerbo closure.\n    This closure satisfies chi(0)=1/3, chi(1)=1, and is monotonic.\n    chi(f) = 1/3 + 2/3 * f**2\n    \"\"\"\n    return 1/3 + (2/3) * f**2\n\ndef process_moments(E_raw, F_raw):\n    \"\"\"\n    Applies the flux limiter to raw moments and computes the flux factor.\n    \n    Args:\n        E_raw (float): Raw energy density.\n        F_raw (float): Raw flux.\n        \n    Returns:\n        tuple: A tuple containing the limited (E, F) and the flux factor f.\n    \"\"\"\n    E = E_raw\n\n    # Apply the flux limiter based on the minimal modification principle.\n    # The magnitude of the flux is capped at E, while its sign is preserved.\n    # F = sgn(F_raw) * min(|F_raw|, E).\n    # np.copysign is used for a robust implementation of sgn(F_raw) * magnitude.\n    magnitude_F = min(abs(F_raw), E)\n    F = np.copysign(magnitude_F, F_raw) if F_raw != 0 else 0.0\n    \n    # If E is exactly zero, the realizability condition |F| = E forces F to be zero.\n    # The line above handles this correctly since min(abs(F_raw), 0) is 0.\n\n    # Compute the flux factor f, handling the E=0 case.\n    if E > 0:\n        f = abs(F) / E\n    else:  # E is zero, so f is zero by definition.\n        f = 0.0\n        \n    return E, F, f\n\ndef test_1():\n    \"\"\"Test 1: Free-streaming single beam, no overshoot.\"\"\"\n    beams = [(1.0, 1.0)]  # (e_i, s_i)\n    alpha = 1.0\n    \n    E_raw = sum(e for e, s in beams)\n    F_raw_pre = sum(e * s for e, s in beams)\n    F_raw = alpha * F_raw_pre\n    \n    E, F, f = process_moments(E_raw, F_raw)\n    \n    realizability_ok = (E >= 0 and abs(F) = E + EPSILON)\n    f_ok = abs(f - 1.0) = EPSILON\n    chi_val = chi(f)\n    chi_ok = abs(chi_val - 1.0) = EPSILON\n    \n    return all([realizability_ok, f_ok, chi_ok])\n\ndef test_2():\n    \"\"\"Test 2: Isotropic two-beam crossing, no overshoot.\"\"\"\n    beams = [(1.0, 1.0), (1.0, -1.0)]\n    alpha = 1.0\n\n    E_raw = sum(e for e, s in beams)\n    F_raw_pre = sum(e * s for e, s in beams)\n    F_raw = alpha * F_raw_pre\n    \n    E, F, f = process_moments(E_raw, F_raw)\n    \n    realizability_ok = (E >= 0 and abs(F) = E + EPSILON)\n    f_ok = abs(f - 0.0) = EPSILON\n    chi_val = chi(f)\n    chi_ok = abs(chi_val - (1/3)) = EPSILON\n    \n    return all([realizability_ok, f_ok, chi_ok])\n\ndef test_3():\n    \"\"\"Test 3: Monotonicity under added counter-flow.\"\"\"\n    # Configuration A\n    beams_A = [(1.0, 1.0)]\n    E_raw_A = sum(e for e, s in beams_A)\n    F_raw_A = sum(e * s for e, s in beams_A)\n    _, _, f_A = process_moments(E_raw_A, F_raw_A)\n\n    # Configuration B\n    beams_B = [(1.0, 1.0), (0.2, -1.0)]\n    E_raw_B = sum(e for e, s in beams_B)\n    F_raw_B = sum(e * s for e, s in beams_B)\n    _, _, f_B = process_moments(E_raw_B, F_raw_B)\n    \n    monotonicity_ok = f_B = f_A + EPSILON\n    return monotonicity_ok\n\ndef test_4():\n    \"\"\"Test 4: Overshoot correction.\"\"\"\n    beams = [(1.0, 1.0)]\n    alpha = 1.5\n    \n    E_raw = sum(e for e, s in beams)\n    F_raw_pre = sum(e * s for e, s in beams)\n    sign_F_raw_pre = np.sign(F_raw_pre)\n    \n    F_raw = alpha * F_raw_pre\n    \n    E, F, f = process_moments(E_raw, F_raw)\n    \n    realizability_ok = (E >= 0 and abs(F) = E + EPSILON)\n    f_ok = abs(f - 1.0) = EPSILON\n\n    # If F is zero, its sign can be considered to match any other sign for this problem's purpose\n    sign_F = np.sign(F) if F != 0 else sign_F_raw_pre\n    sign_ok = sign_F == sign_F_raw_pre\n\n    return all([realizability_ok, f_ok, sign_ok])\n\ndef test_5():\n    \"\"\"Test 5: Zero-energy limit handling.\"\"\"\n    E_raw = 0.0\n    F_raw = 0.7\n    \n    E, F, f = process_moments(E_raw, F_raw)\n    \n    realizability_ok = (E >= 0 and abs(F) = E + EPSILON)\n    E_ok = (E == 0.0)\n    F_ok = (F == 0.0)\n    f_ok = (f == 0.0)\n    \n    return all([realizability_ok, E_ok, F_ok, f_ok])\n\ndef solve():\n    \"\"\"\n    Executes all test cases and prints the results in the required format.\n    \"\"\"\n    test_cases = [\n        test_1,\n        test_2,\n        test_3,\n        test_4,\n        test_5\n    ]\n\n    results = []\n    for test_func in test_cases:\n        results.append(test_func())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "矩方法方程构成了一个双曲型偏微分方程组，其中信息以有限速度传播。这最后一个练习处理的是一个复杂但至关重要的任务：为此类系统实施合适的边界条件，这对于像中子星或吸积盘这样的有限区域内的任何模拟都至关重要。通过推导和实现一个基于特征线的流出边界条件，您将学会如何防止可能污染模拟结果的虚假数值反射。",
            "id": "3480949",
            "problem": "您的任务是为中微子二矩输运设计并测试一个保约束边界条件，该条件适用于一维简化模型中用于数值相对论应用的切除或流出边界。请从以下基本基础和定义开始。\n\n二矩近似（在其最简单形式中也称为 M1 闭合）使用能量密度矩和通量矩来模拟中微子辐射场。考虑一个具有常数爱丁顿因子闭合的一维、无量纲、线性化系统：\n$$\n\\partial_t E + \\partial_x F = 0,\\qquad \\partial_t F + \\partial_x \\left(\\chi E\\right) = 0,\n$$\n其中 $E$ 是中微子能量密度矩，$F$ 是中微子通量矩，$\\chi \\in (0,1]$ 是一个代表闭合的常数爱丁顿因子。在狭义相对论单位制（$c=1$）且无源项的情况下，该系统代表了中微子输运的双曲部分。物理上允许的状态必须满足因果性约束 $E \\ge |F|$。\n\n您的任务是：\n- 推导上述双曲系统的特征结构（特征值和特征向量），并写出边界处的入流和出流特征变量。\n- 在一个具有外向单位法向量 $n$ 的边界上，构建一个流出（无入流）边界条件。该条件将入流特征变量设置为零，同时保留来自内部区域的出流特征变量。此边界条件必须是保约束的，即在应用边界条件后，边界状态必须满足 $E \\ge |F|$。\n- 使用局部 Lax-Friedrichs (Rusanov) 数值通量，为上述系统在空间域 $x \\in [0, L]$（其中 $L=1$）上实现一个一阶守恒有限体积积分器。使用具有 $N_x$ 个单元的均匀网格，并根据 Courant–Friedrichs–Lewy (CFL) 数 $\\text{CFL} \\in (0,1)$ 选择时间步长。\n- 通过选择以下初始条件来初始化一个纯粹向右移动的中微子脉冲：\n$$\nE(x,0) = E_0 \\exp\\!\\left(-\\frac{(x-x_0)^2}{2 \\sigma^2}\\right),\\qquad F(x,0) = \\lambda E(x,0),\n$$\n其中 $\\lambda$ 是系统的正特征速度，$(E_0,\\; x_0,\\; \\sigma)$ 是常数。这确保了初始时特征为右行，其左行分量可忽略不计。\n- 将系统演化至最终时间\n$$\nT_{\\text{end}} = \\alpha \\frac{L - x_0}{\\lambda},\n$$\n其中 $\\alpha1$ 确保脉冲已完全与右边界相互作用。通过在两个边界处的时间积分法向入流通量来测量伪反射，其定义如下。设 $F^i n_i$ 是通量矩在边界面的外向单位法向量上的投影。将在一个边界处的入流大小 $\\mathcal{I}(t)$ 定义为 $-\\left(F^i n_i\\right)$ 的正部，即 $\\mathcal{I}(t) = \\max\\left(0, -F^i n_i\\right)$。在整个模拟过程中的总入流度量为\n$$\n\\mathcal{R} = \\frac{1}{\\int_0^L E(x,0)\\,dx}\\int_0^{T_{\\text{end}}}\\left[\\mathcal{I}_{\\text{left}}(t) + \\mathcal{I}_{\\text{right}}(t)\\right]\\,dt,\n$$\n其中分母通过域中的初始总能量进行归一化。值 $\\mathcal{R}$ 是无量纲的。\n\n在两个域边界上实现并比较两种边界条件：\n- 一种朴素的零梯度边界条件，定义为将内部单元的状态复制到鬼点单元。\n- 您推导出的特征无入流、保约束边界条件，该条件将入流特征变量设置为零，并保留出流特征变量。\n\n为使数值计算清晰，取 $L=1$（无量纲）、$E_0=1$（无量纲）、$\\sigma=0.05$（无量纲）、$x_0=0.25$（无量纲）和 $\\alpha=1.1$（无量纲）。确保所有计算均以无量纲单位进行。\n\n测试套件。对于每个参数元组 $(\\chi,\\; \\text{CFL},\\; N_x,\\; \\text{BC})$，计算如上定义的反射度量 $\\mathcal{R}$。使用以下五个测试用例：\n- 测试 1：$(\\chi = 1/3,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{char})$。\n- 测试 2：$(\\chi = 1/3,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{naive})$。\n- 测试 3：$(\\chi = 9/10,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{char})$。\n- 测试 4：$(\\chi = 9/10,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{naive})$。\n- 测试 5：$(\\chi = 9/10,\\; \\text{CFL} = 19/20,\\; N_x = 200,\\; \\text{BC} = \\text{char})$。\n\n您的程序应计算出五个 $\\mathcal{R}$ 值的列表，每个测试一个，按上述顺序排列，为四舍五入到 $6$ 位小数的浮点数。最终程序输出必须是单行，包含用方括号括起来的逗号分隔列表形式的结果，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_j$ 是测试 $j$ 的四舍五入值。所有输出都是无量纲数。此问题不涉及角度。此问题不涉及百分比。由于所有量都是无量纲的，因此不需要物理单位。输出必须严格遵守此格式，且不包含任何额外文本。",
            "solution": "该问题要求为一维线性化二矩中微子输运系统设计、实现和测试一个保约束流出边界条件。我们将首先验证问题陈述，然后进行推导和数值实现。\n\n### 步骤 1：提取已知条件\n- **方程组**：\n$$\n\\partial_t E + \\partial_x F = 0,\\qquad \\partial_t F + \\partial_x \\left(\\chi E\\right) = 0\n$$\n- **变量与定义**：\n    - $E$：中微子能量密度矩。\n    - $F$：中微子通量矩。\n    - $\\chi \\in (0,1]$：常数爱丁顿因子。\n    - **因果性约束**：物理状态必须满足 $E \\ge |F|$。\n- **数值方案**：\n    - 一阶守恒有限体积法。\n    - 局部 Lax-Friedrichs (Rusanov) 数值通量。\n    - 空间域：$x \\in [0, L]$，其中 $L=1$。\n    - 具有 $N_x$ 个单元的均匀网格。\n    - 时间步长由 Courant–Friedrichs–Lewy (CFL) 数 $\\text{CFL} \\in (0,1)$ 决定。\n- **初始条件**：\n$$\nE(x,0) = E_0 \\exp\\!\\left(-\\frac{(x-x_0)^2}{2 \\sigma^2}\\right),\\qquad F(x,0) = \\lambda E(x,0)\n$$\n    - $\\lambda$：系统的正特征速度。\n    - 常数：$L=1$，$E_0=1$，$\\sigma=0.05$，$x_0=0.25$。\n- **演化时间**：\n$$\nT_{\\text{end}} = \\alpha \\frac{L - x_0}{\\lambda}\n$$\n    - 常数：$\\alpha=1.1$。\n- **反射度量 ($\\mathcal{R}$)**：\n$$\n\\mathcal{R} = \\frac{1}{\\int_0^L E(x,0)\\,dx}\\int_0^{T_{\\text{end}}}\\left[\\mathcal{I}_{\\text{left}}(t) + \\mathcal{I}_{\\text{right}}(t)\\right]\\,dt\n$$\n    - 入流大小 $\\mathcal{I}(t) = \\max\\left(0, -F^i n_i\\right)$，其中 $F^i n_i$ 是通量矩在外向法向量 $n$ 上的投影。\n- **待比较的边界条件**：\n    1.  **朴素 (Naive)**：零梯度（将内部单元状态复制到鬼点单元）。\n    2.  **特征 (Characteristic)**：无入流、保约束。\n- **测试套件**：\n    - 测试 1：$(\\chi = 1/3,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{char})$\n    - 测试 2：$(\\chi = 1/3,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{naive})$\n    - 测试 3：$(\\chi = 9/10,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{char})$\n    - 测试 4：$(\\chi = 9/10,\\; \\text{CFL} = 2/5,\\; N_x = 400,\\; \\text{BC} = \\text{naive})$\n    - 测试 5：$(\\chi = 9/10,\\; \\text{CFL} = 19/20,\\; N_x = 200,\\; \\text{BC} = \\text{char})$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上基于成熟的 M1 矩形式主义辐射输运理论，这是计算天体物理学中的一种标准技术。一个带有常数闭合的线性化一维版本是一个常见的模型问题。该系统是双曲型的，而为其实现和测试边界条件的任务是偏微分方程数值方法中的一个适定问题。所有术语和参数都得到了精确和客观的定义。整个设置是自洽的，没有矛盾。对于无量纲模拟，所选参数在物理上和数值上都是合理的。\n\n### 步骤 3：结论与行动\n问题是有效的。我们着手解决。\n\n### 基于原理的解决方案设计\n\n#### 1. 系统的特征结构\n该方程组可以写成向量形式 $\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0$，其中状态向量为 $\\mathbf{U} = [E, F]^T$，通量向量为 $\\mathbf{F}(\\mathbf{U}) = [F, \\chi E]^T$。对于这个线性系统，这等价于 $\\partial_t \\mathbf{U} + A\\partial_x \\mathbf{U} = 0$，其中 $A$ 是通量的雅可比矩阵：\n$$\nA = \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{U}} = \\begin{pmatrix} 0  1 \\\\ \\chi  0 \\end{pmatrix}\n$$\n特征速度是 $A$ 的特征值 $\\lambda$，通过求解 $\\det(A - \\lambda I) = 0$ 得到：\n$$\n(-\\lambda)(-\\lambda) - (1)(\\chi) = \\lambda^2 - \\chi = 0 \\implies \\lambda_\\pm = \\pm\\sqrt{\\chi}\n$$\n满足 $A\\mathbf{r}_\\pm = \\lambda_\\pm \\mathbf{r}_\\pm$ 的右特征向量 $\\mathbf{r}_\\pm$ 是：\n$$\n\\mathbf{r}_+ = \\begin{pmatrix} 1 \\\\ \\sqrt{\\chi} \\end{pmatrix} \\quad (\\text{对应 } \\lambda_+ = \\sqrt{\\chi}), \\qquad \\mathbf{r}_- = \\begin{pmatrix} 1 \\\\ -\\sqrt{\\chi} \\end{pmatrix} \\quad (\\text{对应 } \\lambda_- = -\\sqrt{\\chi})\n$$\n相应的左特征向量 $\\mathbf{l}_\\pm$，满足 $\\mathbf{l}_\\pm A = \\lambda_\\pm \\mathbf{l}_\\pm$（并归一化以使 $\\mathbf{l}_i \\cdot \\mathbf{r}_j = \\delta_{ij}$），是右特征向量矩阵的逆矩阵的行。一组未归一化的左特征向量是 $\\mathbf{l}_+ = [\\sqrt{\\chi}, 1]$ 和 $\\mathbf{l}_- = [\\sqrt{\\chi}, -1]$。\n对角化系统的特征变量是通过将状态向量投影到左特征向量上形成的：\n$$\nw_+ = \\sqrt{\\chi}E + F \\quad (\\text{右行，与 } \\lambda_+  0 \\text{ 相关})\n$$\n$$\nw_- = \\sqrt{\\chi}E - F \\quad (\\text{左行，与 } \\lambda_-  0 \\text{ 相关})\n$$\n\n初始条件 $F(x,0) = \\lambda E(x,0)$ 与 $\\lambda = \\sqrt{\\chi}$ 意味着 $w_-(x,0) = \\sqrt{\\chi}E(x,0) - \\sqrt{\\chi}E(x,0) = 0$。因此，初始脉冲是纯粹右行的。\n\n#### 2. 特征流出边界条件\n流出边界条件防止伪信息进入计算域。这是通过在边界处将入流特征变量设置为零来实现的。\n\n**在右边界 ($x=L=1$)：**\n外向单位法向量为 $n=+1$。如果波速 $\\lambda$ 满足 $\\lambda n  0$，则该波为入流波。\n- 与 $\\lambda_+ = \\sqrt{\\chi}$ 相关的波是出流波 ($\\lambda_+ n  0$)。\n- 与 $\\lambda_- = -\\sqrt{\\chi}$ 相关的波是入流波 ($\\lambda_- n  0$)。\n因此，边界条件是：\n1.  将入流特征设置为零：$w_{-, g} = 0$，其中下标 $g$ 表示鬼点单元状态 $(E_g, F_g)$。这意味着 $\\sqrt{\\chi}E_g - F_g = 0$。\n2.  从内部保留出流特征：$w_{+, g} = w_{+, i}$，其中 $i$ 表示最后一个内部单元的状态 $(E_i, F_i)$。这意味着 $\\sqrt{\\chi}E_g + F_g = \\sqrt{\\chi}E_i + F_i$。\n求解这个 $2 \\times 2$ 系统得到鬼点单元状态：\n$$\nE_g = \\frac{1}{2}\\left(E_i + \\frac{F_i}{\\sqrt{\\chi}}\\right), \\qquad F_g = \\sqrt{\\chi} E_g\n$$\n\n**在左边界 ($x=0$)：**\n外向单位法向量为 $n=-1$。如果 $\\lambda n  0$，则波为入流波。\n- 与 $\\lambda_+ = \\sqrt{\\chi}$ 相关的波是入流波 ($\\lambda_+ n  0$)。\n- 与 $\\lambda_- = -\\sqrt{\\chi}$ 相关的波是出流波 ($\\lambda_- n  0$)。\n边界条件是：\n1.  将入流特征设置为零：$w_{+, g} = 0 \\implies \\sqrt{\\chi}E_g + F_g = 0$。\n2.  从内部保留出流特征：$w_{-, g} = w_{-, i} \\implies \\sqrt{\\chi}E_g - F_g = \\sqrt{\\chi}E_i - F_i$。\n求解鬼点单元状态得到：\n$$\nE_g = \\frac{1}{2}\\left(E_i - \\frac{F_i}{\\sqrt{\\chi}}\\right), \\qquad F_g = -\\sqrt{\\chi} E_g\n$$\n\n**约束保持：** 推导出的鬼点单元状态满足 $|F_g| = \\sqrt{\\chi}|E_g|$。为了使约束 $E_g \\ge |F_g|$ 成立，我们需要 $E_g \\ge \\sqrt{\\chi}|E_g|$，只要 $E_g \\ge 0$ 这就成立，因为 $\\sqrt{\\chi} \\le 1$。然而，如果内部状态 $(E_i, F_i)$ 的通量大小 $|F_i|$ 相对于 $E_i$ 很大，计算 $E_g$ 的公式可能会产生负值。例如，在右边界，如果 $F_i  -\\sqrt{\\chi}E_i$，$E_g$ 将为负（这在物理上是无效的）。为了强制保持约束，我们增加一个下限：如果计算出的 $E_g$ 为负，则该状态代表真空。因此，我们将鬼点单元状态设置为 $(E_g, F_g) = (0, 0)$。该状态平凡地同时满足无入流条件和物理约束。\n\n#### 3. 数值积分方案\n我们在一个单元宽度为 $\\Delta x = L/N_x$ 的均匀网格上使用一阶有限体积法。单元 $j$ 中的状态通过以下方式更新：\n$$\n\\mathbf{U}_j^{n+1} = \\mathbf{U}_j^n - \\frac{\\Delta t}{\\Delta x}(\\mathbf{F}^*_{j+1/2} - \\mathbf{F}^*_{j-1/2})\n$$\n其中 $\\mathbf{F}^*_{j+1/2}$ 是单元 $j$ 和 $j+1$ 之间界面上的数值通量。我们使用局部 Lax-Friedrichs (Rusanov) 通量：\n$$\n\\mathbf{F}^*(\\mathbf{U}_L, \\mathbf{U}_R) = \\frac{1}{2}\\left(\\mathbf{F}(\\mathbf{U}_L) + \\mathbf{F}(\\mathbf{U}_R)\\right) - \\frac{S_{\\max}}{2}(\\mathbf{U}_R - \\mathbf{U}_L)\n$$\n这里，$\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 是界面左右两侧的状态。对于该系统，最大特征速度为 $S_{\\max} = \\max(|\\lambda_\\pm|) = \\sqrt{\\chi}$。时间步长的选择需满足 CFL 条件：\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{S_{\\max}} = \\text{CFL} \\frac{\\Delta x}{\\sqrt{\\chi}}\n$$\n\n#### 4. 反射度量的计算\n反射度量 $\\mathcal{R}$ 将总的时间积分入流通量通过初始总能量进行归一化。\n- 初始总能量通过对网格求和计算：$\\int_0^L E(x,0) dx \\approx \\sum_{j=0}^{N_x-1} E_j(t=0) \\Delta x$。\n- 时间积分通过对时间步求和来近似：$\\int_0^{T_{\\text{end}}} (\\dots) dt \\approx \\sum_n (\\dots) \\Delta t$。\n- 入流通量大小 $\\mathcal{I}(t) = \\max(0, -F^i n_i)$ 在每个边界处计算。\n    - 在左边界 ($x=0$, $n=-1$)：$\\mathcal{I}_{\\text{left}}(t) = \\max(0, F(x=0, t))$。\n    - 在右边界 ($x=L$, $n=1$)：$\\mathcal{I}_{\\text{right}}(t) = \\max(0, -F(x=L, t))$。\n- 边界界面处的物理通量 $F$ 通过该界面处数值通量向量 $\\mathbf{F}^*$ 的能量分量来近似。例如，$F(x=L, t)$ 由 $\\mathbf{F}^*_{N_x-1/2}$ 的第一个分量近似。这确保了与数值方案的一致性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for neutrino transport boundary conditions.\n    \"\"\"\n\n    def run_simulation(chi, cfl, Nx, bc_type):\n        \"\"\"\n        Runs a single 1D neutrino transport simulation and computes the reflection metric.\n\n        Args:\n            chi (float): The Eddington factor.\n            cfl (float): The CFL number for time-stepping.\n            Nx (int): The number of spatial grid cells.\n            bc_type (str): The boundary condition type ('char' or 'naive').\n\n        Returns:\n            float: The computed reflection metric R.\n        \"\"\"\n        # --- 1. Setup Simulation Parameters and Grid ---\n        L = 1.0\n        E0 = 1.0\n        sigma = 0.05\n        x0 = 0.25\n        alpha = 1.1\n\n        dx = L / Nx\n        x = np.linspace(dx / 2.0, L - dx / 2.0, Nx)\n\n        lambda_speed = np.sqrt(chi)\n        dt = cfl * dx / lambda_speed\n        T_end = alpha * (L - x0) / lambda_speed\n\n        # --- 2. Initial Conditions ---\n        E = E0 * np.exp(-((x - x0) ** 2) / (2.0 * sigma**2))\n        F = lambda_speed * E\n        U = np.array([E, F])\n\n        initial_total_energy = np.sum(U[0, :]) * dx\n\n        # --- 3. Main Evolution Loop ---\n        t = 0.0\n        total_integrated_inflow = 0.0\n        num_ghost_cells = 1\n\n        while t  T_end:\n            # Ensure the final step does not overshoot T_end\n            current_dt = min(dt, T_end - t)\n\n            # --- 3a. Apply Boundary Conditions ---\n            U_g = np.zeros((2, Nx + 2 * num_ghost_cells))\n            U_g[:, num_ghost_cells:-num_ghost_cells] = U\n\n            if bc_type == 'naive':\n                # Zero-gradient BC: copy interior to ghost\n                U_g[:, 0] = U_g[:, 1]  # Left ghost cell\n                U_g[:, -1] = U_g[:, -2]  # Right ghost cell\n            elif bc_type == 'char':\n                # Characteristic no-inflow BC\n                # Left boundary (x=0)\n                E_i_left, F_i_left = U[:, 0]\n                E_g_left = 0.5 * (E_i_left - F_i_left / lambda_speed)\n                if E_g_left  0.0:\n                    U_g[:, 0] = 0.0\n                else:\n                    U_g[0, 0] = E_g_left\n                    U_g[1, 0] = -lambda_speed * E_g_left\n\n                # Right boundary (x=L)\n                E_i_right, F_i_right = U[:, -1]\n                E_g_right = 0.5 * (E_i_right + F_i_right / lambda_speed)\n                if E_g_right  0.0:\n                    U_g[:, -1] = 0.0\n                else:\n                    U_g[0, -1] = E_g_right\n                    U_g[1, -1] = lambda_speed * E_g_right\n            \n            # --- 3b. Compute Numerical Fluxes (Rusanov) ---\n            # Physical flux F(U) = [F, chi*E]\n            def physical_flux(state_vec):\n                flux_vec = np.zeros_like(state_vec)\n                flux_vec[0, :] = state_vec[1, :]       # Flux of E is F\n                flux_vec[1, :] = chi * state_vec[0, :]  # Flux of F is chi*E\n                return flux_vec\n\n            U_L = U_g[:, :-1]\n            U_R = U_g[:, 1:]\n            \n            F_phys_L = physical_flux(U_L)\n            F_phys_R = physical_flux(U_R)\n            \n            s_max = lambda_speed\n            F_num = 0.5 * (F_phys_L + F_phys_R) - 0.5 * s_max * (U_R - U_L)\n\n            # --- 3c. Calculate and Accumulate Reflection Metric ---\n            # At left boundary (x=0), normal n=-1. Incoming flux F > 0.\n            # Use energy component of numerical flux at interface 0.\n            F_bdy_left = F_num[0, 0]\n            inflow_left = max(0.0, F_bdy_left)\n            \n            # At right boundary (x=L), normal n=1. Incoming flux F  0.\n            # Use energy component of numerical flux at last interface.\n            F_bdy_right = F_num[0, -1]\n            inflow_right = max(0.0, -F_bdy_right)\n\n            total_integrated_inflow += (inflow_left + inflow_right) * current_dt\n\n            # --- 3d. Update State Vector (First-Order Finite Volume) ---\n            U -= (current_dt / dx) * (F_num[:, 1:] - F_num[:, :-1])\n            \n            t += current_dt\n\n        # --- 4. Compute Final Metric ---\n        if initial_total_energy > 0:\n            R = total_integrated_inflow / initial_total_energy\n        else:\n            R = 0.0\n        \n        return R\n\n    # --- Test Suite ---\n    test_cases = [\n        # (chi, cfl, Nx, bc_type)\n        (1.0/3.0, 2.0/5.0, 400, 'char'),\n        (1.0/3.0, 2.0/5.0, 400, 'naive'),\n        (9.0/10.0, 2.0/5.0, 400, 'char'),\n        (9.0/10.0, 2.0/5.0, 400, 'naive'),\n        (9.0/10.0, 19.0/20.0, 200, 'char'),\n    ]\n\n    results = []\n    for case in test_cases:\n        chi, cfl, Nx, bc_type = case\n        result = run_simulation(chi, cfl, Nx, bc_type)\n        results.append(round(result, 6))\n\n    # --- Final Output ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}