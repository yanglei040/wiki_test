{
    "hands_on_practices": [
        {
            "introduction": "在自适应网格加密（AMR）中，不同分辨率的网格具有不同的稳定性约束，这通常由 Courant-Friedrichs-Lewy (CFL) 条件决定。为了提高计算效率，我们采用时间子循环（subcycling）技术，允许不同层级的网格以各自稳定的小时间步长演化，而不是强制整个模拟使用最细网格的微小时间步长。 这项练习将指导您计算多层级 AMR 结构中的稳定时间步长，并确定保持模拟稳定和同步所需的子循环参数，这是实现和使用 AMR 代码的一项关键技能。",
            "id": "3503472",
            "problem": "考虑一个在计算天体物理模拟中采用自适应网格加密（AMR）的一维显式有限体积求解器，用于求解双曲守恒律。网格层级结构包含三个层级：一个粗网格层级 $\\ell = 0$，一个相对于 $\\ell = 0$ 层级加密因子为 $r_{1} = 3$ 的较细层级 $\\ell = 1$，以及一个相对于 $\\ell = 1$ 层级加密因子为 $r_{2} = 2$ 的最细层级 $\\ell = 2$。粗网格层级的空间步长为 $\\Delta x_{0} = 9.6 \\times 10^{9}$ 米，因此 $\\Delta x_{1} = \\Delta x_{0}/r_{1}$ 且 $\\Delta x_{2} = \\Delta x_{1}/r_{2}$。在每个层级上解析的最大特征速度（通量雅可比矩阵特征值的最大绝对值）分别为：$\\ell = 0$ 层级上 $a_{0} = 2.0 \\times 10^{7}$ 米/秒，$\\ell = 1$ 层级上 $a_{1} = 3.3 \\times 10^{7}$ 米/秒，以及 $\\ell = 2$ 层级上 $a_{2} = 4.0 \\times 10^{7}$ 米/秒。Courant–Friedrichs–Lewy (CFL) 数为 $C_{\\mathrm{CFL}} = 0.45$。\n\n使用适用于双曲系统显式有限体积离散化的 Courant–Friedrichs–Lewy 稳定性要求，首先计算每个 AMR 层级上允许的时间步长，记为 $\\Delta t_{\\ell}^{\\max}$（其中 $\\ell \\in \\{0,1,2\\}$）。然后，假设粗网格层级前进一个长度为 $\\Delta t_{0} = \\Delta t_{0}^{\\max}$ 的时间步。通过选择整数 $n_{1}$ 和 $n_{2}$，在较细层级上实现层级同步的子循环（subcycling），使得在粗网格层级单步推进期间，$\\ell = 1$ 层级执行 $n_{1}$ 个子步，$\\ell = 2$ 层级执行 $n_{2}$ 个子步。同时满足 $\\Delta t_{1} = \\Delta t_{0}/n_{1} \\le \\Delta t_{1}^{\\max}$ 和 $\\Delta t_{2} = \\Delta t_{0}/n_{2} \\le \\Delta t_{2}^{\\max}$，并且 $n_{2}$ 是 $n_{1}$ 的正整数倍以确保嵌套同步。在所有允许的选择中，选取满足这些约束的最小 $n_{1}$ 和最小倍数 $n_{2}$。\n\n将区间 $[0,\\Delta t_{0}]$ 内的同步时间定义为所有较细层级同时完成其整数个子步长的时刻集合，此时它们可以与其父层级进行通量修正；在上述 $n_{2}$ 是 $n_{1}$ 的倍数的约束下，这些同步时间即为 $\\ell = 1$ 层级子步的边界。列出这些时间，包括粗网格层级步长的开始和结束时间。所有时间量均以秒为单位表示。\n\n在最终答案中，按顺序以单行的形式提供三元组 $\\left(\\Delta t_{0}^{\\max}, \\Delta t_{1}^{\\max}, \\Delta t_{2}^{\\max}\\right)$、实际的子循环时间步长 $\\left(\\Delta t_{0}, \\Delta t_{1}, \\Delta t_{2}\\right)$ 以及在一个粗网格层级步长内的有序同步时间 $\\left(t_{0}, t_{1}, t_{2}, t_{3}, t_{4}, t_{5}\\right)$。无需四舍五入。",
            "solution": "用户提供了一个计算天体物理学中的问题，涉及自适应网格加密（AMR）模拟中的时间步进。该问题要求基于 Courant-Friedrichs-Lewy (CFL) 稳定性条件计算时间步长，并确定子循环参数和同步时间。\n\n首先根据所需标准对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取给定条件**\n- AMR 层级：$\\ell \\in \\{0, 1, 2\\}$。\n- 从 $\\ell=0$ 层级到 $\\ell=1$ 层级的加密因子：$r_{1} = 3$。\n- 从 $\\ell=1$ 层级到 $\\ell=2$ 层级的加密因子：$r_{2} = 2$。\n- 粗网格层级空间步长：$\\Delta x_{0} = 9.6 \\times 10^{9}$ 米。\n- 空间步长关系：$\\Delta x_{1} = \\Delta x_{0}/r_{1}$ 且 $\\Delta x_{2} = \\Delta x_{1}/r_{2}$。\n- 每个层级上的最大特征速度：$a_{0} = 2.0 \\times 10^{7}$ 米/秒，$a_{1} = 3.3 \\times 10^{7}$ 米/秒，$a_{2} = 4.0 \\times 10^{7}$ 米/秒。\n- Courant-Friedrichs-Lewy (CFL) 数：$C_{\\mathrm{CFL}} = 0.45$。\n- 粗网格层级推进的时间步长：$\\Delta t_{0} = \\Delta t_{0}^{\\max}$。\n- 子循环约束：\n  - $\\ell=1$ 层级执行 $n_{1}$ 个子步，其中 $\\Delta t_{1} = \\Delta t_{0}/n_{1} \\le \\Delta t_{1}^{\\max}$。\n  - $\\ell=2$ 层级执行 $n_{2}$ 个子步，其中 $\\Delta t_{2} = \\Delta t_{0}/n_{2} \\le \\Delta t_{2}^{\\max}$。\n- 同步约束：$n_{2}$ 是 $n_{1}$ 的正整数倍。\n- 最小性约束：$n_{1}$ 是满足其约束的最小整数，而 $n_{2}$ 是满足其约束的 $n_{1}$ 的最小倍数。\n- 同步时间：在粗网格层级步长区间 $[0, \\Delta t_{0}]$ 内，$\\ell=1$ 层级子步的边界。\n\n**步骤 2：使用提取的给定条件进行验证**\n- **科学基础**：该问题基于 CFL 条件，这是双曲方程显式数值方法稳定性的一个基本原则。带子循环的 AMR 是计算流体动力学和天体物理学中一种标准的、科学上有效的技术。该问题牢固地植根于成熟的数值分析理论。\n- **适定性**：所有必需的参数（$\\Delta x_0$, $r_1$, $r_2$, $a_\\ell$, $C_{\\mathrm{CFL}}$）都已提供。对子循环整数（$n_1, n_2$）的约束定义清晰，并能导出一个唯一的最小解。该问题是自洽的，在数学上是适定的。\n- **客观性**：该问题使用精确、无歧义的数学术语和物理量进行表述，不含主观性语言。\n\n**步骤 3：结论与行动**\n该问题是有效的，因为它科学上合理、适定且客观。将提供一个完整的解答。\n\n### 解答\n\n解答过程分为几个步骤：\n1.  计算每个层级 $\\ell$ 的空间步长 $\\Delta x_{\\ell}$。\n2.  使用 CFL 条件计算每个层级的最大允许时间步长 $\\Delta t_{\\ell}^{\\max}$。\n3.  确定满足给定约束的整数子循环数 $n_{1}$ 和 $n_{2}$。\n4.  计算用于子循环推进的实际时间步长 $\\Delta t_{\\ell}$。\n5.  列出一个粗网格层级步长内的同步时间。\n\n**1. 空间步长**\n较细层级的空间步长由给定的加密因子确定。\n- $\\ell=0$ 层级：$\\Delta x_{0} = 9.6 \\times 10^{9} \\, \\text{m}$。\n- $\\ell=1$ 层级：$\\Delta x_{1} = \\frac{\\Delta x_{0}}{r_{1}} = \\frac{9.6 \\times 10^{9}}{3} = 3.2 \\times 10^{9} \\, \\text{m}$。\n- $\\ell=2$ 层级：$\\Delta x_{2} = \\frac{\\Delta x_{1}}{r_{2}} = \\frac{3.2 \\times 10^{9}}{2} = 1.6 \\times 10^{9} \\, \\text{m}$。\n\n**2. 最大允许时间步长**\n对于一维显式有限体积格式，CFL 条件指出，为保证稳定性，时间步长 $\\Delta t$ 必须满足 $\\Delta t \\le C_{\\mathrm{CFL}} \\frac{\\Delta x}{a}$，其中 $a$ 是最大特征速度。因此，层级 $\\ell$ 上的最大允许时间步长为 $\\Delta t_{\\ell}^{\\max} = C_{\\mathrm{CFL}} \\frac{\\Delta x_{\\ell}}{a_{\\ell}}$。\n\n- $\\ell=0$ 层级：\n$$ \\Delta t_{0}^{\\max} = C_{\\mathrm{CFL}} \\frac{\\Delta x_{0}}{a_{0}} = 0.45 \\times \\frac{9.6 \\times 10^{9} \\, \\text{m}}{2.0 \\times 10^{7} \\, \\text{m/s}} = 0.45 \\times (4.8 \\times 10^{2} \\, \\text{s}) = 216 \\, \\text{s} $$\n- $\\ell=1$ 层级：\n$$ \\Delta t_{1}^{\\max} = C_{\\mathrm{CFL}} \\frac{\\Delta x_{1}}{a_{1}} = 0.45 \\times \\frac{3.2 \\times 10^{9} \\, \\text{m}}{3.3 \\times 10^{7} \\, \\text{m/s}} = 0.45 \\times \\frac{3.2}{3.3} \\times 10^{2} \\, \\text{s} = \\frac{1.44}{3.3} \\times 10^{2} \\, \\text{s} = \\frac{144}{3.3} \\, \\text{s} = \\frac{1440}{33} \\, \\text{s} = \\frac{480}{11} \\, \\text{s} $$\n- $\\ell=2$ 层级：\n$$ \\Delta t_{2}^{\\max} = C_{\\mathrm{CFL}} \\frac{\\Delta x_{2}}{a_{2}} = 0.45 \\times \\frac{1.6 \\times 10^{9} \\, \\text{m}}{4.0 \\times 10^{7} \\, \\text{m/s}} = 0.45 \\times (0.4 \\times 10^{2} \\, \\text{s}) = 18 \\, \\text{s} $$\n第一个要求的值集合是 $(\\Delta t_{0}^{\\max}, \\Delta t_{1}^{\\max}, \\Delta t_{2}^{\\max}) = (216, \\frac{480}{11}, 18)$。\n\n**3. 子循环整数**\n粗网格层级以大小为 $\\Delta t_{0} = \\Delta t_{0}^{\\max} = 216 \\, \\text{s}$ 的步长推进一​​步。\n对于 $\\ell=1$ 层级，子步数 $n_{1}$ 必须满足 $\\Delta t_{1} = \\frac{\\Delta t_{0}}{n_{1}} \\le \\Delta t_{1}^{\\max}$。这意味着：\n$$ n_{1} \\ge \\frac{\\Delta t_{0}}{\\Delta t_{1}^{\\max}} = \\frac{216}{\\frac{480}{11}} = \\frac{216 \\times 11}{480} = \\frac{9 \\times 24 \\times 11}{20 \\times 24} = \\frac{99}{20} = 4.95 $$\n由于 $n_{1}$ 必须是整数，所以 $n_{1}$ 的最小值为 $\\lceil 4.95 \\rceil = 5$。\n\n对于 $\\ell=2$ 层级，子步数 $n_{2}$ 必须满足 $\\Delta t_{2} = \\frac{\\Delta t_{0}}{n_{2}} \\le \\Delta t_{2}^{\\max}$。这意味着：\n$$ n_{2} \\ge \\frac{\\Delta t_{0}}{\\Delta t_{2}^{\\max}} = \\frac{216}{18} = 12 $$\n此外，$n_{2}$ 必须是 $n_{1}=5$ 的正整数倍。我们必须找到大于或等于 $12$ 的 $5$ 的最小倍数。$5$ 的相关倍数是 $5, 10, 15, \\dots$。其中最小的倍数是 $15$。\n因此，所选的子循环整数为 $n_{1} = 5$ 和 $n_{2} = 15$。\n\n**4. 实际子循环时间步长**\n每个层级的实际时间步长根据子循环整数计算得出。\n- $\\ell=0$ 层级：$\\Delta t_{0} = 216 \\, \\text{s}$。\n- $\\ell=1$ 层级：$\\Delta t_{1} = \\frac{\\Delta t_{0}}{n_{1}} = \\frac{216}{5} = 43.2 \\, \\text{s}$。\n- $\\ell=2$ 层级：$\\Delta t_{2} = \\frac{\\Delta t_{0}}{n_{2}} = \\frac{216}{15} = \\frac{72}{5} = 14.4 \\, \\text{s}$。\n第二个要求的值集合是 $(\\Delta t_{0}, \\Delta t_{1}, \\Delta t_{2}) = (216, 43.2, 14.4)$。\n\n**5. 同步时间**\n同步时间是 $\\ell=1$ 层级子步的边界。因为 $\\ell=1$ 层级执行 $n_{1}=5$ 个子步，每个子步持续时间为 $\\Delta t_{1} = 43.2 \\, \\text{s}$，所以同步时间 $t_j$ 由 $t_j = j \\cdot \\Delta t_{1}$ 给出，其中 $j=0, 1, \\dots, 5$。\n- $t_{0} = 0 \\times 43.2 = 0 \\, \\text{s}$\n- $t_{1} = 1 \\times 43.2 = 43.2 \\, \\text{s}$\n- $t_{2} = 2 \\times 43.2 = 86.4 \\, \\text{s}$\n- $t_{3} = 3 \\times 43.2 = 129.6 \\, \\text{s}$\n- $t_{4} = 4 \\times 43.2 = 172.8 \\, \\text{s}$\n- $t_{5} = 5 \\times 43.2 = 216.0 \\, \\text{s}$\n第三个要求的值集合是 $(0, 43.2, 86.4, 129.6, 172.8, 216.0)$。\n\n这三组结果被合并到一个单行矩阵中作为最终答案。\n- $(\\Delta t_{0}^{\\max}, \\Delta t_{1}^{\\max}, \\Delta t_{2}^{\\max}) = (216, \\frac{480}{11}, 18)$\n- $(\\Delta t_{0}, \\Delta t_{1}, \\Delta t_{2}) = (216, 43.2, 14.4)$\n- $(t_0, \\dots, t_5) = (0, 43.2, 86.4, 129.6, 172.8, 216)$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 216 & \\frac{480}{11} & 18 & 216 & 43.2 & 14.4 & 0 & 43.2 & 86.4 & 129.6 & 172.8 & 216 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "当 AMR 算法创建一个新的细化网格时，我们必须根据其父级粗网格的数据来初始化新网格上的物理量，这个过程称为“prolongation”。这个过程必须是守恒的，并且要避免在激波或接触间断等剧烈变化的区域引入非物理的振荡。 这个编程练习将引导您实现一种基于分段线性重构和斜率限制器的标准 prolongation 技术，让您亲身体验如何从单元平均值构建高阶数据表示，同时强制执行单调性等物理约束，这是现代激波捕捉格式的基石。",
            "id": "3503480",
            "problem": "考虑在计算天体物理学背景下，一个带有接触间断的可压缩流密度的一维有限体积表示。自适应网格加密（AMR）旨在从粗网格单元平均值构造细网格初始数据，同时保持守恒性并避免伪极值。其基本原理是单元平均值的有限体积定义以及使用斜率限制器的总变差递减（TVD）重构。\n\n设粗网格是均匀的，单元中心位于 $x_i$，宽度为 $\\Delta x$。粗网格单元平均密度为 $\\bar{\\rho}_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho(x)\\,dx$。对于延拓过程，每个粗单元 $i$ 被细分为 $r$ 个细子单元，索引为 $j \\in \\{0,1,\\dots,r-1\\}$，每个子单元的宽度为 $\\Delta x / r$。在每个粗单元 $i$ 内使用分段线性重构，\n$$\n\\rho_i(x) = \\bar{\\rho}_i + s_i \\frac{x - x_i}{\\Delta x},\n$$\n其中 $s_i$ 是根据相邻粗单元平均值计算的受限斜率，以保证TVD性质。定义后向和前向差分\n$$\n\\Delta_- = \\bar{\\rho}_i - \\bar{\\rho}_{i-1}, \\quad \\Delta_+ = \\bar{\\rho}_{i+1} - \\bar{\\rho}_i,\n$$\n以及以下斜率限制器：\n- Minmod 限制器：$\\mathrm{mm}(a,b) = \\begin{cases}\\mathrm{sign}(a)\\min(|a|,|b|), & ab > 0, \\\\ 0, & \\text{否则。}\\end{cases}$，其中 $s_i = \\mathrm{mm}(\\Delta_-,\\Delta_+)$。\n- Monotonized Central (MC) 限制器：$s_i = \\mathrm{mm}_3\\left(\\frac{\\Delta_- + \\Delta_+}{2}, 2\\Delta_-, 2\\Delta_+\\right)$，其中如果 $ab>0$ 且 $ac>0$，$\\mathrm{mm}_3(a,b,c)$ 返回 $\\mathrm{sign}(a)\\min(|a|,|b|,|c|)$，否则返回 $0$。\n- Van Leer 限制器：$s_i = \\begin{cases}\\frac{2\\Delta_- \\Delta_+}{\\Delta_- + \\Delta_+}, & \\Delta_- \\Delta_+ > 0, \\\\ 0, & \\text{否则。}\\end{cases}$。\n\n在区域边界处，当邻居单元不可用时，设置 $s_i = 0$ 以保持守恒性。粗单元 $i$ 内的子单元 $j$ 的子单元平均密度为\n$$\n\\bar{\\rho}_{i,j} = \\frac{r}{\\Delta x}\\int_{x_{i-1/2} + \\frac{j}{r}\\Delta x}^{x_{i-1/2} + \\frac{j+1}{r}\\Delta x} \\rho_i(x)\\,dx.\n$$\n对于上述分段线性的 $\\rho_i(x)$，子单元平均值等于其在子单元中点处的值，得到\n$$\n\\bar{\\rho}_{i,j} = \\bar{\\rho}_i + s_i\\,c_j,\\quad c_j = \\left(\\frac{j+\\frac{1}{2}}{r} - \\frac{1}{2}\\right).\n$$\n为避免在接触间断处产生伪极值，对每个粗单元 $i$ 施加一个保界裁剪，其局部界限为\n$$\n\\rho_{\\min,i} = \\min\\{\\bar{\\rho}_{i-1},\\bar{\\rho}_i,\\bar{\\rho}_{i+1}\\},\\quad \\rho_{\\max,i} = \\max\\{\\bar{\\rho}_{i-1},\\bar{\\rho}_i,\\bar{\\rho}_{i+1}\\},\n$$\n在边界处仅使用可用的邻居单元。强制执行\n$$\n\\bar{\\rho}_{i,j} \\leftarrow \\min\\left(\\rho_{\\max,i}, \\max\\left(\\rho_{\\min,i}, \\bar{\\rho}_{i,j}\\right)\\right).\n$$\n\n实现一个程序，该程序：\n1. 根据指定的限制器计算受限斜率 $s_i$。\n2. 对于给定的加密比 $r$，使用上述公式计算细网格子单元平均值 $\\bar{\\rho}_{i,j}$。\n3. 对每个粗单元应用保界裁剪。\n4. 将每个测试用例的加密后的子单元平均值输出为浮点数列表。\n\n所有密度均采用无量纲代码单位；无需进行物理单位转换。不涉及角度。程序必须生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。列表中的每个元素本身也是一个由方括号括起来的逗号分隔列表，表示相应测试用例的加密后单元平均密度，且不含任何空格。例如：$[[a_1,a_2,\\dots],[b_1,b_2,\\dots]]$。\n\n使用以下测试套件，其设计旨在覆盖平滑行为、尖锐接触间断、振荡模式和边界效应：\n- 测试 1（平滑单调增加，Minmod，$r=2$）：粗网格平均值 $\\left[\\,1.0,\\,1.1,\\,1.2,\\,1.3\\,\\right]$。\n- 测试 2（接触间断，MC，$r=2$）：粗网格平均值 $\\left[\\,1.0,\\,1.0,\\,5.0,\\,5.0\\,\\right]$。\n- 测试 3（振荡模式，Van Leer，$r=4$）：粗网格平均值 $\\left[\\,3.0,\\,1.0,\\,3.0,\\,1.0\\,\\right]$。\n- 测试 4（带有对称邻居的孤立跳跃，Minmod，$r=2$）：粗网格平均值 $\\left[\\,0.5,\\,0.5,\\,2.0,\\,0.5,\\,0.5\\,\\right]$。\n\n对于每个测试用例，输出应为展平的细网格列表 $\\left[\\,\\bar{\\rho}_{0,0},\\dots,\\bar{\\rho}_{0,r-1},\\bar{\\rho}_{1,0},\\dots,\\bar{\\rho}_{1,r-1},\\dots\\,\\right]$，格式如上所述。最终输出必须是形如 $[ \\text{case1\\_list}, \\text{case2\\_list}, \\text{case3\\_list}, \\text{case4\\_list} ]$ 的单行文本，且不含任何空格。",
            "solution": "问题陈述被评估为有效。它提出了一个定义明确的计算任务，该任务基于流体动力学数值方法的既定原则，特别是关于自适应网格加密（AMR）的原则。所提供的分段线性重构、斜率限制器和子单元平均的公式是标准且正确的。该问题是自洽的，所有必要的数据和边界条件都已指定，使得每个测试用例都有唯一的解。\n\n将粗网格单元平均密度 $\\bar{\\rho}_i$ 延拓到加密比为 $r$ 的细网格上的过程包含三个主要步骤：斜率计算、子单元平均值计算和保界裁剪。\n\n### 1. 受限斜率计算\n对每个粗单元 $i$，计算一个斜率 $s_i$ 来定义分段线性重构，$\\rho_i(x) = \\bar{\\rho}_i + s_i \\frac{x - x_i}{\\Delta x}$，其中 $x_i$ 是单元 $i$ 的中心，$\\Delta x$ 是其宽度。为了防止在尖锐特征附近引入伪振荡（这一性质被称为总变差递减或TVD），斜率 $s_i$ 会根据局部数据进行限制。\n\n计算取决于单元的位置：\n-   **边界单元**：对于区域中的第一个（$i=0$）和最后一个（$i=N-1$）单元，无法获得完整的邻居单元集。为保持保守且简单的处理方式，斜率设为零，即 $s_0 = 0$ 和 $s_{N-1} = 0$。这对应于边界处的分段常数重构。\n-   **内部单元**：对于任何内部单元 $i$，其斜率由其直接相邻的单元确定。我们首先计算后向和前向差分：\n    $$\n    \\Delta_- = \\bar{\\rho}_i - \\bar{\\rho}_{i-1} \\quad ; \\quad \\Delta_+ = \\bar{\\rho}_{i+1} - \\bar{\\rho}_i\n    $$\n    然后将这些差分传递给斜率限制器函数。问题指定了三种此类限制器：\n\n    1.  **Minmod 限制器**：这是最具耗散性的限制器，能强力抑制振荡。斜率由下式给出：\n        $$\n        s_i = \\mathrm{mm}(\\Delta_-, \\Delta_+) = \\begin{cases}\\mathrm{sign}(\\Delta_-)\\min(|\\Delta_-|,|\\Delta_+|), & \\Delta_- \\Delta_+ > 0 \\\\ 0, & \\text{否则}\\end{cases}\n        $$\n        仅当数据局部单调时（即 $\\Delta_-$ 和 $\\Delta_+$ 符号相同），斜率才为非零。在局部极值点，斜率为零。\n\n    2.  **Monotonized Central (MC) 限制器**：该限制器设计用于在平滑区域比 Minmod 更准确。它使用一个三参数的 minmod 函数定义：\n        $$\n        s_i = \\mathrm{mm}_3\\left(\\frac{\\Delta_- + \\Delta_+}{2}, 2\\Delta_-, 2\\Delta_+\\right)\n        $$\n        其中，如果 $a, b, c$ 符号全部相同，$\\mathrm{mm}_3(a,b,c)$ 返回 $\\mathrm{sign}(a)\\min(|a|,|b|,|c|)$，否则返回 $0$。该限制器考虑中心差分斜率 $(\\Delta_- + \\Delta_+)/2$，并用两倍的单侧差分来限制它。\n\n    3.  **Van Leer 限制器**：该限制器在两个单侧差分之间提供平滑过渡，并以其对接触间断的良好解析度而闻名。它是两个差分的调和平均：\n        $$\n        s_i = \\begin{cases}\\frac{2\\Delta_- \\Delta_+}{\\Delta_- + \\Delta_+}, & \\Delta_- \\Delta_+ > 0 \\\\ 0, & \\text{否则}\\end{cases}\n        $$\n\n### 2. 子单元平均值延拓\n一旦每个粗单元 $i$ 的斜率 $s_i$ 已知，我们就可以确定其中 $r$ 个子单元中每一个的平均密度 $\\bar{\\rho}_{i,j}$。子单元的索引为 $j \\in \\{0, 1, \\dots, r-1\\}$。一个线性函数在一个区间上的平均值等于该函数在此区间中点处的值。这将积分定义简化为代数定义。粗单元 $i$ 中子单元 $j$ 的中点相对于粗单元中心 $x_i$ 有一个距离因子的偏移。这导出以下公式：\n$$\n\\bar{\\rho}_{i,j} = \\bar{\\rho}_i + s_i\\,c_j\n$$\n其中系数 $c_j$ 仅取决于子单元索引 $j$ 和加密比 $r$：\n$$\nc_j = \\left(\\frac{j+\\frac{1}{2}}{r} - \\frac{1}{2}\\right)\n$$\n这些系数代表了每个子单元中心与其父单元中心的归一化距离。例如，对于 $r=2$，我们有 $c_0 = -0.25$ 和 $c_1 = 0.25$。\n\n### 3. 保界裁剪\nTVD斜率限制器旨在防止在单元界面上重构的点值产生新的极值。然而，为了严格保证新的*单元平均值*也不会产生新的局部极值，需要应用一个额外的裁剪步骤。对于每个粗单元 $i$，我们根据其单元平均值本身及其可用的邻居单元来定义局部界限：\n$$\n\\rho_{\\min,i} = \\min\\{\\bar{\\rho}_{k} \\mid k \\in \\{i-1, i, i+1\\} \\cap [0, N-1]\\}\n$$\n$$\n\\rho_{\\max,i} = \\max\\{\\bar{\\rho}_{k} \\mid k \\in \\{i-1, i, i+1\\} \\cap [0, N-1]\\}\n$$\n对于边界单元 $i=0$，邻域为 $\\{0, 1\\}$。对于内部单元，邻域为 $\\{i-1, i, i+1\\}$。\n\n每个计算出的子单元平均值 $\\bar{\\rho}_{i,j}$ 随后被强制限制在这些界限内：\n$$\n\\bar{\\rho}_{i,j} \\leftarrow \\min\\left(\\rho_{\\max,i}, \\max\\left(\\rho_{\\min,i}, \\bar{\\rho}_{i,j}\\right)\\right)\n$$\n这确保了加密后的数据场在局部上仍受原始粗网格数据的约束，这对于稳定性、物理真实性至关重要，尤其是在接触间断处。\n\n### 示例演练：测试用例 1\n-   **输入**：粗网格平均值 $\\bar{\\rho} = [1.0, 1.1, 1.2, 1.3]$，限制器：Minmod，$r=2$。\n-   **斜率**：\n    -   $s_0 = 0$ (边界)。\n    -   $i=1$: $\\Delta_- = 1.1-1.0=0.1$, $\\Delta_+ = 1.2-1.1=0.1$. $\\mathrm{mm}(0.1, 0.1) = 0.1$。所以，$s_1=0.1$。\n    -   $i=2$: $\\Delta_- = 1.2-1.1=0.1$, $\\Delta_+ = 1.3-1.2=0.1$. $\\mathrm{mm}(0.1, 0.1) = 0.1$。所以，$s_2=0.1$。\n    -   $s_3 = 0$ (边界)。\n    -   斜率向量为 $s = [0, 0.1, 0.1, 0]$。\n-   **子单元平均值 ($r=2 \\implies c_0=-0.25, c_1=0.25$)**：\n    -   $i=0$: $\\bar{\\rho}_{0,0} = 1.0 + 0 \\cdot (-0.25) = 1.0$; $\\bar{\\rho}_{0,1} = 1.0 + 0 \\cdot (0.25) = 1.0$。\n    -   $i=1$: $\\bar{\\rho}_{1,0} = 1.1 + 0.1 \\cdot (-0.25) = 1.075$; $\\bar{\\rho}_{1,1} = 1.1 + 0.1 \\cdot (0.25) = 1.125$。\n    -   $i=2$: $\\bar{\\rho}_{2,0} = 1.2 + 0.1 \\cdot (-0.25) = 1.175$; $\\bar{\\rho}_{2,1} = 1.2 + 0.1 \\cdot (0.25) = 1.225$。\n    -   $i=3$: $\\bar{\\rho}_{3,0} = 1.3 + 0 \\cdot (-0.25) = 1.3$; $\\bar{\\rho}_{3,1} = 1.3 + 0 \\cdot (0.25) = 1.3$。\n-   **裁剪**：\n    -   $i=0$: 界限为 $[\\min(1.0, 1.1), \\max(1.0, 1.1)] = [1.0, 1.1]$。值 $[1.0, 1.0]$ 在界限内。\n    -   $i=1$: 界限为 $[\\min(1.0, 1.1, 1.2), \\max(1.0, 1.1, 1.2)] = [1.0, 1.2]$。值 $[1.075, 1.125]$ 在界限内。\n    -   $i=2$: 界限为 $[\\min(1.1, 1.2, 1.3), \\max(1.1, 1.2, 1.3)] = [1.1, 1.3]$。值 $[1.175, 1.225]$ 在界限内。\n    -   $i=3$: 界限为 $[\\min(1.2, 1.3), \\max(1.2, 1.3)] = [1.2, 1.3]$。值 $[1.3, 1.3]$ 在界限内。\n    -   在本例中，裁剪步骤没有改变任何值，因为 Minmod 限制器已经确保了重构是非振荡的。\n-   **最终结果**：展平的细单元平均值列表为 $[1.0, 1.0, 1.075, 1.125, 1.175, 1.225, 1.3, 1.3]$。",
            "answer": "[[1.0,1.0,1.075,1.125,1.175,1.225,1.3,1.3],[1.0,1.0,1.0,1.0,5.0,5.0,5.0,5.0],[3.0,3.0,3.0,3.0,1.0,1.0,1.0,1.0,3.0,3.0,3.0,3.0,1.0,1.0,1.0,1.0],[0.5,0.5,0.5,0.5,2.0,2.0,0.5,0.5,0.5,0.5]]"
        },
        {
            "introduction": "在采用时间子循环的 AMR 方法中，一个核心挑战是确保质量、动量和能量等物理量的严格守恒。由于共享边界的粗网格和细网格以不同的时间步长演化，它们在边界上计算出的数值通量会不匹配，从而破坏了守恒律。 为了解决这个问题，我们采用一种称为“refluxing”的通量修正程序。这项练习通过一个特殊案例来建立对 refluxing 机制的深刻理解，通过分析流场平行于网格界面的情况，它将促使您从第一性原理出发，理解数值通量的物理意义以及为何在这种特定场景下通量修正恰好为零。",
            "id": "3503513",
            "problem": "考虑一个二维被动标量场 $q(x,y,t)$ 的平流，其受守恒律\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (q \\,\\boldsymbol{v}) = 0,\n$$\n支配，速度为常数 $\\boldsymbol{v} = (u, 0)$ 且 $u > 0$。一个自适应网格加密 (AMR) 层次结构包含一个由尺寸为 $\\Delta x_c = \\Delta y_c$ 的方形网格组成的均匀粗网格层，以及一个加密比为 $r = 2$、覆盖区域 $y > 0$ 的单一细网格层。粗细网格界面与水平线 $y = 0$ 完全重合，因此其切线方向平行于 $x$ 轴，其外向单位法向量为 $\\pm \\hat{\\boldsymbol{y}}$。假设细网格层使用时间步长 $\\Delta t_f = \\Delta t_c / r$ 进行子循环推进，其中 $\\Delta t_c$ 是粗网格时间步长，并且两层都使用与守恒律一致的、基于迎风数值通量的守恒有限体积 Godunov 更新方法。设初始数据 $q(x,y,0)$ 是任意的，但足够正则以确保格式保持稳定。\n\n我们关注位于界面正上方的两个相邻粗网格 $C_1$ 和 $C_2$（其中心位于 $y = +\\Delta y_c/2$），它们的底面分别在 $x \\in [0, \\Delta x_c]$ 和 $x \\in [\\Delta x_c, 2\\Delta x_c]$ 区间内位于界面上。在一个粗网格时间步长 $\\Delta t_c$ 后，应用标准的回流通量修正（refluxing）方法来强制跨越粗细网格界面的守恒性。\n\n仅使用守恒律和有限体积原理，计算在一个粗网格时间步长后，仅由跨越粗细网格界面的通量引起的、对这两个粗网格中网格平均标量 $q$ 的回流通量修正贡献 $(\\delta Q_{C_1}, \\delta Q_{C_2})$。以与 $q$ 相同的单位表示你的最终值。提供精确值（无需四舍五入）。以行向量的形式按顺序 $(\\delta Q_{C_1}, \\delta Q_{C_2})$ 输出你的最终有序对。",
            "solution": "问题要求计算在一个粗网格时间步长后，对两个指定的粗网格 $C_1$ 和 $C_2$ 中的网格平均标量的回流通量修正贡献 $(\\delta Q_{C_1}, \\delta Q_{C_2})$。回流通量修正是在自适应网格加密（AMR）中使用的一种程序，用于在不同分辨率的网格之间的界面上强制执行物理量的严格守恒。\n\n控制方程是关于被动标量 $q$ 的二维守恒律：\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (q \\,\\boldsymbol{v}) = 0\n$$\n其守恒形式为 $\\frac{\\partial q}{\\partial t} + \\nabla \\cdot \\boldsymbol{F} = 0$，其中通量矢量为 $\\boldsymbol{F} = q\\boldsymbol{v}$。\n给定常数速度场 $\\boldsymbol{v} = (u, 0)$ 且 $u > 0$，通量矢量为 $\\boldsymbol{F} = (qu, 0)$。\n\n有限体积格式通过在一个面积为 $A_C$ 的网格 $C$ 上积分来离散化该方程。令 $Q_C(t) = \\frac{1}{A_C} \\int_C q(x,y,t) \\,dA$ 为标量的网格平均值。网格中该标量的总量为 $M_C(t) = Q_C(t) A_C$。守恒律的积分形式为：\n$$\n\\frac{dM_C}{dt} + \\oint_{\\partial C} \\boldsymbol{F} \\cdot \\hat{\\boldsymbol{n}} \\,dL = 0\n$$\n其中 $\\partial C$ 是网格的边界，$\\hat{\\boldsymbol{n}}$ 是外向单位法向量。从时间 $t^n$ 到 $t^{n+1} = t^n + \\Delta t$，标量总量 $M_C$ 的时间离散更新公式为：\n$$\nM_C^{n+1} = M_C^n - \\Delta t \\sum_{i \\in \\text{faces}} F_i^* L_i\n$$\n其中 $F_i^*$ 是穿过面 $i$ 的单位长度数值通量，$L_i$ 是面 $i$ 的长度。\n\n回流通量修正程序旨在修正粗网格计算的穿过粗细（C-F）界面的通量，与细网格计算的穿过同一界面的通量之和之间的不匹配。粗网格执行一个大小为 $\\Delta t_c$ 的时间步，而细网格执行 $r$ 个大小为 $\\Delta t_f = \\Delta t_c / r$ 的子循环时间步。\n\n一个粗网格时间步后，施加到粗网格 $C$ 上的总回流通量修正是：粗网格计算表明已穿过 C-F 界面的总标量质量，与细网格计算表明已穿过同一界面的总标量质量之间的差值。\n设 $\\mathcal{F}_{\\text{coarse}}$ 是在 $\\Delta t_c$ 时间内，粗网格上计算的穿过网格 $C$ 的 C-F 边界的总质量通量。设 $\\mathcal{F}_{\\text{fine}}$ 是穿过相应细网格边界的质量通量之和，并在 $r$ 个细网格时间步上求和。对网格 $C$ 中总质量的回流通量修正是 $\\delta M_C = \\mathcal{F}_{\\text{coarse}} - \\mathcal{F}_{\\text{fine}}$。\n\n解决这个问题的关键在于理解穿过 C-F 界面的通量的性质。界面位于直线 $y=0$ 处。对于位于界面上方（在 $y>0$ 区域）的粗网格 $C_1$ 和 $C_2$，它们的底面位于这条线上。这些面的外向单位法向量为 $\\hat{\\boldsymbol{n}} = (0, -1)$。对于界面下方的细网格，它们的顶面位于这条线上，其外向单位法向量为 $\\hat{\\boldsymbol{n}} = (0, 1)$。总的来说，界面的法线平行于 $y$ 轴。\n\n穿过该界面的物理通量由通量矢量 $\\boldsymbol{F}$ 和单位法向量 $\\hat{\\boldsymbol{n}}$ 的点积给出。\n$$\n\\boldsymbol{F} \\cdot \\hat{\\boldsymbol{n}} = (qu, 0) \\cdot (0, \\pm 1) = 0\n$$\n穿过水平界面的物理通量恒为零，因为速度场是纯水平的，即与界面相切。在 $y$ 方向上没有标量 $q$ 的输运。\n\n问题陈述数值格式使用与守恒律一致的、基于迎风数值通量的 Godunov 更新方法。对于平流方程，穿过法向量为 $\\hat{\\boldsymbol{n}}$ 的网格面的迎风通量与速度的法向分量 $v_n = \\boldsymbol{v} \\cdot \\hat{\\boldsymbol{n}}$ 成正比。数值通量由 $F^* = v_n q_{\\text{upwind}}$ 给出，其中 $q_{\\text{upwind}}$ 是从界面迎风侧取值的标量值。\n\n在这个具体问题中，C-F 界面上速度的法向分量是：\n$$\nv_n = \\boldsymbol{v} \\cdot \\hat{\\boldsymbol{n}} = (u, 0) \\cdot (0, \\pm 1) = 0\n$$\n由于法向速度分量为零，穿过 $y=0$ 界面的 Godunov/迎风数值通量 $F^*$ 也必须为零。\n$$\nF^* = 0 \\cdot q_{\\text{upwind}} = 0\n$$\n这对与界面相邻的网格中的任何状态 $q$ 都成立。\n\n现在我们可以计算构成回流通量修正的各项。\n1.  **粗网格通量**：在时间步长 $\\Delta t_c$ 内，粗网格计算的通过网格 $C_1$ 底面（长度为 $\\Delta x_c$）的流出通量为 $\\mathcal{F}_{\\text{coarse}, C_1} = F_{\\text{coarse}}^* \\cdot \\Delta x_c \\cdot \\Delta t_c$。由于 $F_{\\text{coarse}}^*=0$，我们有 $\\mathcal{F}_{\\text{coarse}, C_1} = 0$。\n\n2.  **细网格通量**：细网格由尺寸为 $\\Delta x_f = \\Delta x_c/2$ 的网格组成。$C_1$ 的底面被两个细网格的面所覆盖。从细网格的角度看，总通量是穿过这些细网格面的通量之和，并在 $r=2$ 个子循环上求和。对于界面上的每个细网格面和每个细网格时间步，都会计算数值通量 $F_{\\text{fine}}^*$。由于该界面上的法向速度 $v_n$ 为零，因此所有这些计算的 $F_{\\text{fine}}^*$ 也都为零。因此，这些细网格通量之和 $\\mathcal{F}_{\\text{fine}, C_1}$ 也为零。\n\n对网格 $C_1$ 中总质量的回流通量修正是：\n$$\n\\delta M_{C_1} = \\mathcal{F}_{\\text{coarse}, C_1} - \\mathcal{F}_{\\text{fine}, C_1} = 0 - 0 = 0\n$$\n完全相同的逻辑也适用于相邻的粗网格 $C_2$。它的底面也位于 $y=0$ 界面上，因此对其总质量的回流通量修正也为零：\n$$\n\\delta M_{C_2} = 0\n$$\n问题要求的是对网格平均标量 $\\delta Q_{C_1}$ 和 $\\delta Q_{C_2}$ 的回流通量修正贡献。网格平均量的变化与总质量的变化相关，关系为 $\\delta Q_C = \\delta M_C / A_C$，其中 $A_C = \\Delta x_c \\Delta y_c$ 是粗网格的面积。\n由于 $\\delta M_{C_1} = 0$ 且 $\\delta M_{C_2} = 0$，我们有：\n$$\n\\delta Q_{C_1} = \\frac{0}{A_{C_1}} = 0\n$$\n$$\n\\delta Q_{C_2} = \\frac{0}{A_{C_2}} = 0\n$$\n因此，对这两个网格的网格平均标量的回流通量修正贡献均为零。这是流体流动方向与粗细网格界面完全平行的直接结果。\n\n最终答案是有序对 $(\\delta Q_{C_1}, \\delta Q_{C_2})$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0\n\\end{pmatrix}\n}\n$$"
        }
    ]
}