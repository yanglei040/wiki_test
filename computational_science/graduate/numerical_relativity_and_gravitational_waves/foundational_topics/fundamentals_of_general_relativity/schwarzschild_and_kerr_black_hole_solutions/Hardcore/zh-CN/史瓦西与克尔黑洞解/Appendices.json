{
    "hands_on_practices": [
        {
            "introduction": "黑洞如何“振铃”（其准正规模）与其时空几何，特别是不稳定光子轨道的特性，紧密相关。这个练习提供了一种动手实践的方式，在短波（eikonal）极限下验证这种深刻的联系 。通过该练习，你将把光子轨道的李雅普诺夫指数与准正规模的阻尼率联系起来，从而揭示黑洞几何和其动力学响应之间的内在关系。",
            "id": "3485877",
            "problem": "考虑一个静态球对称时空，其线元在几何单位制（$G=c=1$）下由 $ds^2=-f(r)\\,dt^2+f(r)^{-1}\\,dr^2+r^2(d\\theta^2+\\sin^2\\theta\\,d\\phi^2)$ 给出。重点研究 Schwarzschild 情形，其中 $f(r)=1-\\frac{2M}{r}$。取 $M=1$ 以使所有量均为无量纲量，并将所有角度视为弧度。\n\n你的任务是：\n\n1. 从赤道运动的零测地线方程出发，确定决定不稳定圆形光子轨道半径 $r_{\\rm ph}$ 的条件以及相应的坐标角频率 $\\Omega_{\\rm ph}$。用 $f(r)$ 及其在 $r_{\\rm ph}$ 处的径向导数表示你的结果。\n\n2. 通过将径向运动在 $r_{\\rm ph}$ 附近线性化，导出控制小径向扰动指数增长的 Lyapunov 指数 $\\lambda$，并纯粹用 $f(r)$ 及其在 $r_{\\rm ph}$ 处的径向导数表示。使用坐标时间 $t$ 作为演化参数。\n\n3. 对于 Schwarzschild 黑洞的轴向（奇宇称）引力扰动，主方程可以写作 $$\\frac{d^2\\Psi}{dx^2}+\\big(\\omega^2-V_\\ell(r)\\big)\\Psi=0$$，其中 $x$ 是由 $dx/dr=f(r)^{-1}$ 定义的 tortoise 坐标，而 Regge–Wheeler 势为 $V_\\ell(r)=f(r)\\left(\\frac{\\ell(\\ell+1)}{r^2}-\\frac{6}{r^3}\\right)$（对于整数 $\\ell\\ge 2$）。使用在势垒峰值 $r=r_0(\\ell)$ 附近的一阶 Wentzel–Kramers–Brillouin (WKB) 近似，得到准简正模频率 $\\omega_{\\ell n}$ 虚部的主导阶表达式，用势 $V_\\ell$ 及其关于 $x$ 的二阶导数表示，两者均在 $r_0(\\ell)$ 处取值。将 $n\\in\\{0,1,2,\\dots\\}$ 视为泛音指数。\n\n4. 在程函近似（eikonal regime）$\\ell\\gg 1$下，建立阻尼率 $-\\operatorname{Im}(\\omega_{\\ell n})$ 与光子轨道上的 Lyapunov 指数 $\\lambda$ 之间的关系，证明 WKB 预言简化为程函公式 $-\\operatorname{Im}(\\omega_{\\ell n})\\approx (n+\\tfrac{1}{2})\\,\\lambda$。\n\n5. 实现一个程序，该程序：\n   - 对于 $f(r)=1-2/r$ (其中 $M=1$)，通过求解第 1 部分中导出的圆形零轨道条件来计算 $r_{\\rm ph}$。\n   - 使用第 2 部分中导出的表达式计算 $\\lambda$。\n   - 对于下面测试套件中的每个 $(\\ell,n)$，找到 $V_\\ell(r)$ 的峰值 $r_0(\\ell)$，计算 $V_\\ell(r_0)$ 及其关于 tortoise 坐标 $x$ 的二阶导数，并计算第 3 部分中得到的一阶 WKB 阻尼率 $-\\operatorname{Im}(\\omega_{\\ell n})$。\n   - 对于每个测试用例，返回程函预言相对于 WKB 阻尼率的相对误差，定义为 $\\left|\\frac{\\,(n+\\tfrac{1}{2})\\lambda - \\left(-\\operatorname{Im}(\\omega_{\\ell n})\\right)\\,}{(n+\\tfrac{1}{2})\\lambda}\\right|$。\n\n使用以下测试套件：\n- 用例 A (正常路径): $(\\ell,n)=(10,0)$。\n- 用例 B (边缘情况：小 $\\ell$): $(\\ell,n)=(2,0)$。\n- 用例 C (边缘情况：大 $\\ell$，高泛音): $(\\ell,n)=(50,1)$。\n\n你的程序必须生成单行输出，其中包含用例 A、B 和 C 的三个相对误差，格式为一个逗号分隔的列表，并用方括号括起来（例如，[e_A,e_B,e_C]）。不允许外部输入。所有计算均在 $M=1$ 的几何单位制下进行，所有角度均以弧度为单位。输出为无量纲浮点数。",
            "solution": "我们从 $M=1$ 的几何单位制下的 Schwarzschild 线元开始：$ds^2=-f(r)\\,dt^2+f(r)^{-1}\\,dr^2+r^2(d\\theta^2+\\sin^2\\theta\\,d\\phi^2)$，其中 $f(r)=1-2/r$。我们考虑赤道零测地线，因此 $\\theta=\\pi/2$ 且 $ds^2=0$。\n\n1. 测地线的 Lagrangian 量为 $\\mathcal{L}=\\tfrac{1}{2}\\left(-f(r)\\dot t^2+f(r)^{-1}\\dot r^2+r^2\\dot\\phi^2\\right)$，其中点号表示对仿射参数的导数。单位质量的守恒能量和角动量分别为 $E=f(r)\\dot t$ 和 $L=r^2\\dot\\phi$。零条件得出 $0=-f(r)\\dot t^2+f(r)^{-1}\\dot r^2+r^2\\dot\\phi^2$。消去 $\\dot t$ 和 $\\dot\\phi$ 以 $E$ 和 $L$ 代替，得到径向方程\n$$\n\\dot r^2+V_{\\rm eff}(r)=E^2, \\quad V_{\\rm eff}(r)=f(r)\\frac{L^2}{r^2}.\n$$\n不稳定的圆形零轨道满足 $\\dot r=0$ 和 $dV_{\\rm eff}/dr=0$。条件 $dV_{\\rm eff}/dr=0$ 即\n$$\n\\frac{d}{dr}\\left(\\frac{f(r)}{r^2}\\right)=0 \\quad\\Longleftrightarrow\\quad r f'(r)-2 f(r)=0.\n$$\n在光子轨道半径 $r=r_{\\rm ph}$ 处求值，此式定义了 $r_{\\rm ph}$。坐标角频率为\n$$\n\\Omega_{\\rm ph}\\equiv\\frac{d\\phi}{dt}=\\frac{\\dot\\phi}{\\dot t}=\\frac{L/r^2}{E/f(r)}=\\frac{f(r)}{r^2}\\frac{L}{E}.\n$$\n在圆形零轨道上，$V_{\\rm eff}(r_{\\rm ph})=E^2$，这意味着 $f(r_{\\rm ph})\\frac{L^2}{r_{\\rm ph}^2}=E^2$。因此 $L/E=r_{\\rm ph}/\\sqrt{f(r_{\\rm ph})}$，代入 $\\Omega_{\\rm ph}$ 的表达式可得\n$$\n\\Omega_{\\rm ph}=\\frac{\\sqrt{f(r_{\\rm ph})}}{r_{\\rm ph}}.\n$$\n\n2. 为求 Lyapunov 指数，我们将径向方程在 $r_{\\rm ph}$ 附近线性化。设 $r(\\lambda)=r_{\\rm ph}+\\delta r(\\lambda)$，其中 $\\delta r$ 很小。径向方程为 $\\dot r^2+V_{\\rm eff}(r)=E^2$。对仿射参数求导并线性化，得到形式如下的方程\n$$\n\\ddot{\\delta r}+\\frac{1}{2}V_{\\rm eff}''(r_{\\rm ph})\\,\\delta r=0,\n$$\n其中撇号表示对 $r$ 的导数。以坐标时间 $t$ 测量的增长率需要通过 $\\frac{d}{d\\lambda}=\\dot t\\,\\frac{d}{dt}$ 进行变量替换，其中 $\\dot t=E/f(r)$。在 $r_{\\rm ph}$ 处，$\\dot t_{\\rm ph}=E/f(r_{\\rm ph})$。因此\n$$\n\\frac{d^2\\delta r}{dt^2}+\\left[\\frac{V_{\\rm eff}''(r_{\\rm ph})}{2\\,\\dot t_{\\rm ph}^2}\\right]\\delta r=0,\n$$\n其不稳定解的行为是 $\\delta r\\sim e^{\\lambda t}$，其中\n$$\n\\lambda=\\sqrt{\\frac{-V_{\\rm eff}''(r_{\\rm ph})}{2\\,\\dot t_{\\rm ph}^2}}.\n$$\n使用 $V_{\\rm eff}=f L^2/r^2$，我们计算 $V_{\\rm eff}''(r)=L^2\\left[\\frac{f''(r)}{r^2}-\\frac{4 f'(r)}{r^3}+\\frac{6 f(r)}{r^4}\\right]$。圆形轨道条件 $r f'(r)-2 f(r)=0$ 意味着在 $r=r_{\\rm ph}$ 处有 $\\frac{f'(r_{\\rm ph})}{r_{\\rm ph}}=\\frac{2 f(r_{\\rm ph})}{r_{\\rm ph}^2}$。代入并化简可得\n$$\nV_{\\rm eff}''(r_{\\rm ph})=L^2\\left[\\frac{f''(r_{\\rm ph})}{r_{\\rm ph}^2}-\\frac{8 f(r_{\\rm ph})}{r_{\\rm ph}^4}+\\frac{6 f(r_{\\rm ph})}{r_{\\rm ph}^4}\\right]\n=L^2\\left[\\frac{f''(r_{\\rm ph})}{r_{\\rm ph}^2}-\\frac{2 f(r_{\\rm ph})}{r_{\\rm ph}^4}\\right].\n$$\n在圆形零轨道上，$E^2=f(r_{\\rm ph})\\frac{L^2}{r_{\\rm ph}^2}$，所以 $\\dot t_{\\rm ph}=\\frac{E}{f(r_{\\rm ph})}=\\frac{L}{r_{\\rm ph}\\sqrt{f(r_{\\rm ph})}}$。因此\n$$\n\\lambda=\\sqrt{\\frac{-V_{\\rm eff}''(r_{\\rm ph})}{2\\,\\dot t_{\\rm ph}^2}}\n=\\sqrt{\\frac{-\\left[\\frac{f''(r_{\\rm ph})}{r_{\\rm ph}^2}-\\frac{2 f(r_{\\rm ph})}{r_{\\rm ph}^4}\\right] L^2}{2 \\left(\\frac{L^2}{r_{\\rm ph}^2 f(r_{\\rm ph})}\\right)}}\n=\\sqrt{\\frac{f(r_{\\rm ph})}{2}\\left[-f''(r_{\\rm ph})+\\frac{2 f(r_{\\rm ph})}{r_{\\rm ph}^2}\\right]} \\,\\frac{1}{r_{\\rm ph}}.\n$$\n等价地，\n$$\n\\lambda=\\sqrt{\\frac{f(r_{\\rm ph})\\left(2 f(r_{\\rm ph})-r_{\\rm ph}^2 f''(r_{\\rm ph})\\right)}{2\\,r_{\\rm ph}^2}}.\n$$\n对于 Schwarzschild 时空，$f(r)=1-2/r$，$f'(r)=2/r^2$，以及 $f''(r)=-4/r^3$。光子半径条件 $r f'(r)-2 f(r)=0$ 给出 $r_{\\rm ph}=3$。于是\n$$\n\\Omega_{\\rm ph}=\\frac{\\sqrt{1-2/3}}{3}=\\frac{1}{3\\sqrt{3}},\\quad\n\\lambda=\\sqrt{\\frac{(1-2/3)\\left(2(1-2/3)-9(-4/27)\\right)}{2\\cdot 9}}\n=\\frac{1}{3\\sqrt{3}}=\\Omega_{\\rm ph}.\n$$\n\n3. 轴向模的 Regge–Wheeler 势为 $V_\\ell(r)=f(r)\\left(\\frac{\\ell(\\ell+1)}{r^2}-\\frac{6}{r^3}\\right)$。通过 $dx/dr=f(r)^{-1}$ 定义 tortoise 坐标 $x$。在势垒峰值 $x=x_0$（对应于 $r=r_0(\\ell)$）附近，一阶 WKB 近似（Schutz–Will）给出\n$$\n\\frac{\\omega^2-V_0}{\\sqrt{-2 V_0''}}=-i\\left(n+\\frac{1}{2}\\right),\n$$\n其中 $V_0=V_\\ell(r_0)$ 且 $V_0''=\\left.\\frac{d^2V_\\ell}{dx^2}\\right|_{x_0}$。解出 $\\omega$ 的主导阶为\n$$\n\\omega\\approx \\sqrt{V_0}-i\\left(n+\\frac{1}{2}\\right)\\frac{\\sqrt{-2 V_0''}}{2\\sqrt{V_0}},\n$$\n因此阻尼率为\n$$\n-\\operatorname{Im}(\\omega_{\\ell n})\\approx \\left(n+\\frac{1}{2}\\right)\\frac{\\sqrt{-2 V_0''}}{2\\sqrt{V_0}}=\\left(n+\\frac{1}{2}\\right)\\sqrt{\\frac{-V_0''}{2 V_0}}.\n$$\n\n4. 在程函近似 $\\ell\\gg 1$下，$V_\\ell$ 的峰值趋近于光子轨道，$r_0(\\ell)\\to r_{\\rm ph}$，且 $V_0\\sim \\ell(\\ell+1)\\frac{f(r_{\\rm ph})}{r_{\\rm ph}^2}=\\ell(\\ell+1)\\Omega_{\\rm ph}^2$。使用 $d/dx=f(r)\\,d/dr$，我们有 $\\frac{d^2V_\\ell}{dx^2}=f^2 \\frac{d^2V_\\ell}{dr^2}+f f'\\frac{dV_\\ell}{dr}$。在峰值处，$\\frac{dV_\\ell}{dr}=0$，所以 $V_0''=f(r_0)^2\\left.\\frac{d^2V_\\ell}{dr^2}\\right|_{r_0}$。在此 régimen 下，直接计算表明 $\\sqrt{-V_0''/(2 V_0)}\\to \\lambda$，从而得到程函公式\n$$\n-\\operatorname{Im}(\\omega_{\\ell n})\\approx \\left(n+\\frac{1}{2}\\right)\\lambda.\n$$\n\n5. 算法实现：\n- 对于 $f(r)=1-2/r$，通过求解 $r f'(r)-2 f(r)=0$ 来计算 $r_{\\rm ph}$；解为 $r_{\\rm ph}=3$。\n- 使用 $\\lambda=\\sqrt{\\frac{f(r_{\\rm ph})\\left(2 f(r_{\\rm ph})-r_{\\rm ph}^2 f''(r_{\\rm ph})\\right)}{2\\,r_{\\rm ph}^2}}$ 计算 $\\lambda$。\n- 对每个 $\\ell$：\n  - 找到 $\\frac{dV_\\ell}{dr}=0$ 处的 $r_0(\\ell)$。\n  - 计算 $V_0=V_\\ell(r_0)$ 和 $V_0''=\\left.\\frac{d^2V_\\ell}{dx^2}\\right|_{r_0}=f(r_0)^2\\left.\\frac{d^2V_\\ell}{dr^2}\\right|_{r_0}+f(r_0)f'(r_0)\\left.\\frac{dV_\\ell}{dr}\\right|_{r_0}$；根据构造，在极大值点第二项可以忽略。\n  - 计算 WKB 阻尼率 $-\\operatorname{Im}(\\omega_{\\ell n})\\approx\\left(n+\\tfrac{1}{2}\\right)\\sqrt{\\frac{-V_0''}{2 V_0}}$ 和相对误差 $\\left|\\frac{(n+\\tfrac{1}{2})\\lambda-\\left(-\\operatorname{Im}\\omega\\right)}{(n+\\tfrac{1}{2})\\lambda}\\right|$。\n\n然后我们为指定的测试套件评估这些相对误差：\n- 用例 A: $(\\ell,n)=(10,0)$。\n- 用例 B: $(\\ell,n)=(2,0)$。\n- 用例 C: $(\\ell,n)=(50,1)$。\n\n程序按 [A,B,C] 的顺序输出一行，其中包含三个无量纲的相对误差，格式为用方括号括起来的逗号分隔列表。这通过展示相对误差随 $\\ell$ 增长而减小，从而数值上验证了程函关系。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\n# Geometric units: G=c=M=1\ndef f(r):\n    return 1.0 - 2.0 / r\n\ndef fp(r):\n    return 2.0 / (r**2)\n\ndef fpp(r):\n    return -4.0 / (r**3)\n\ndef photon_orbit_radius():\n    # Solve r f'(r) - 2 f(r) = 0 for Schwarzschild\n    # Bracket between just outside horizon and a large radius\n    func = lambda r: r * fp(r) - 2.0 * f(r)\n    # The photon sphere is known at r=3; bracket [2.001, 10] ensures bracketing root\n    return brentq(func, 2.001, 10.0)\n\ndef lyapunov_exponent_at_photon_orbit():\n    r_ph = photon_orbit_radius()\n    fr = f(r_ph)\n    frr = fpp(r_ph)\n    # lambda = sqrt( f(r_ph) * [2 f(r_ph) - r_ph^2 f''(r_ph)] / (2 r_ph^2) )\n    lam = np.sqrt(fr * (2.0 * fr - r_ph**2 * frr) / (2.0 * r_ph**2))\n    return lam\n\ndef regge_wheeler_potential(r, ell):\n    L = ell * (ell + 1.0)\n    return f(r) * (L / r**2 - 6.0 / r**3)\n\ndef dV_dr(r, ell):\n    L = ell * (ell + 1.0)\n    fr = f(r)\n    fp_r = fp(r)\n    g = L / r**2 - 6.0 / r**3\n    gp = -2.0 * L / r**3 + 18.0 / r**4\n    return fp_r * g + fr * gp\n\ndef d2V_dr2(r, ell):\n    L = ell * (ell + 1.0)\n    fr = f(r)\n    fp_r = fp(r)\n    fpp_r = fpp(r)\n    g = L / r**2 - 6.0 / r**3\n    gp = -2.0 * L / r**3 + 18.0 / r**4\n    gpp = 6.0 * L / r**4 - 72.0 / r**5\n    return fpp_r * g + 2.0 * fp_r * gp + fr * gpp\n\ndef find_potential_peak_radius(ell):\n    # Find r0 where dV/dr = 0, near r=3. Bracket around [2.001, 10].\n    # dV/dr is positive below the peak and negative above for reasonable ell=2.\n    func = lambda r: dV_dr(r, ell)\n    # Narrower bracket around 3 improves robustness\n    low = 2.01\n    high = 6.0\n    # Ensure sign change; if not, expand bracket\n    f_low = func(low)\n    f_high = func(high)\n    if f_low * f_high  0:\n        # Expand bracket if needed\n        low = 2.001\n        high = 10.0\n    r0 = brentq(func, low, high)\n    return r0\n\ndef wkb_damping_rate(ell, n):\n    r0 = find_potential_peak_radius(ell)\n    V0 = regge_wheeler_potential(r0, ell)\n    # Second derivative with respect to tortoise coordinate x:\n    # d/dx = f(r) d/dr, so d2V/dx2 = f^2 d2V/dr2 + f f' dV/dr\n    fr = f(r0)\n    fp_r = fp(r0)\n    Vp = dV_dr(r0, ell)\n    Vpp = d2V_dr2(r0, ell)\n    Vxx = fr * (fr * Vpp + fp_r * Vp)\n    # At the maximum, Vxx should be negative\n    if Vxx = 0 or V0 == 0:\n        # Safeguard: return NaN to indicate breakdown (should not occur for valid cases)\n        return np.nan\n    gamma = (n + 0.5) * np.sqrt(-Vxx / (2.0 * V0))\n    return gamma\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Cases: A: (ell=10, n=0), B: (ell=2, n=0), C: (ell=50, n=1)\n    test_cases = [\n        (10, 0),\n        (2, 0),\n        (50, 1),\n    ]\n\n    lam = lyapunov_exponent_at_photon_orbit()\n    results = []\n    for ell, n in test_cases:\n        gamma_wkb = wkb_damping_rate(ell, n)\n        target = (n + 0.5) * lam\n        rel_err = abs(target - gamma_wkb) / target\n        results.append(rel_err)\n\n    # Final print statement in the exact required format.\n    # Print floats with sufficient precision, as a comma-separated list enclosed in brackets.\n    print(f\"[{','.join(f'{x:.12g}' for x in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然史瓦西黑洞上的微扰可以用我们熟悉的球谐函数来描述，但克尔黑洞的旋转破坏了这种完美的球对称性。这个练习将深入探讨如何计算描述克尔时空微扰的正确角函数——自旋权球状谐函数 。通过数值求解Teukolsky方程的角度部分，你将掌握研究克尔时空中波动现象的基石。",
            "id": "3485904",
            "problem": "你必须编写一个完整、可运行的程序，对于给定的自旋权重 $s$、方位角量子数 $m$、阶数 $\\ell$ 和无量纲扁率 $c = a \\omega$，通过求解相关的 Sturm–Liouville 特征值问题，数值计算自旋权重扁球面角函数 ${}_sS_{\\ell m}(\\theta;c)$，并验证它们在单位球面上的正交性。全程使用弧度制角度。不提供外部输入；你的程序必须定义并运行指定的测试套件，并按要求格式打印汇总结果。\n\n基本和核心定义：\n- 在克尔黑洞微扰的 Teukolsky 主方程的可分离形式中，自旋权重扁球面谐函数 (SWSphH) ${}_sS_{\\ell m}(\\theta;c)$ 是通过代入 $x=\\cos\\theta$ 得到的角向常微分方程的特征函数：\n$$\n\\frac{d}{dx}\\left[(1-x^2)\\frac{d S}{dx}\\right] + \\left[(c x)^2 - 2 c s x - \\frac{(m + s x)^2}{1-x^2} + s + A\\right] S(x) = 0,\n$$\n其中 $S(x) = {}_sS_{\\ell m}(\\arccos x;c)$，$c$ 是无量纲扁率，$s$ 是自旋权重，$m$ 是方位角整数，$A$ 是角向分离常数（特征值）。当 $c=0$ 时，有 $A = \\ell(\\ell+1) - s(s+1)$。\n- 在球面上完整的自旋权重扁球面谐函数在此定义为\n$${}_s\\mathcal{S}_{\\ell m}(\\theta,\\phi;c) = \\frac{1}{\\sqrt{2\\pi}}\\, {}_sS_{\\ell m}(\\theta;c)\\, e^{i m \\phi},$$\n使得在球面上的正交归一关系以下列形式成立\n$$\\int_0^{2\\pi}\\!\\!\\int_0^\\pi {}_s\\mathcal{S}_{\\ell m}(\\theta,\\phi;c)\\, {}_s\\mathcal{S}_{\\ell' m'}(\\theta,\\phi;c)^{\\!*}\\, \\sin\\theta\\, d\\theta\\, d\\phi = \\delta_{\\ell\\ell'} \\delta_{mm'},$$\n通过变量替换 $x=\\cos\\theta$，该关系简化为\n$$\\int_{-1}^{1} {}_sS_{\\ell m}(x;c)\\, {}_sS_{\\ell' m}(x;c)\\, dx = \\delta_{\\ell\\ell'}.$$\n\n你的任务：\n1) 将自伴随角向算符离散化为一个一维 Sturm–Liouville 问题，在 $x \\in [-1,1]$ 上，对于固定的 $(s,m,c)$：\n$$\n\\mathcal{L}[S](x) = \\frac{d}{dx}\\left[(1-x^2)\\frac{d S}{dx}\\right] + V_{s m c}(x)\\, S(x), \\quad\nV_{s m c}(x) = (c x)^2 - 2 c s x - \\frac{(m + s x)^2}{1-x^2} + s,\n$$\n并求解 $A$，使得 $\\mathcal{L}[S](x) + A\\, S(x) = 0$，其中 $S(x)$ 在 $x=\\pm 1$ 处是正则的。在覆盖 $[-1,1]$ 的 $N$ 个单元的均匀网格上，使用保守的有限体积法进行离散化，网格点位于单元中心。对项 $(1-x^2) dS/dx$ 在 $x=\\pm 1$ 处施加自然的无通量边界行为。构建一个代表 $\\mathcal{L}$ 的对称三对角矩阵，使得离散特征问题可以写作\n$$\n\\mathbf{L}\\,\\mathbf{S} = -A\\, \\mathbf{S},\n$$\n并找到最小的特征值 $A$（升序）及其对应的特征向量。\n\n2) 归一化每个离散特征向量，以强制满足连续归一化条件\n$$\n\\int_{-1}^{1} S_\\alpha(x)\\, S_\\beta(x)\\, dx = \\delta_{\\alpha\\beta},\n$$\n通过在你的均匀单元中心网格上使用中点法则来近似积分。此处 $\\alpha,\\beta$ 表示在固定的 $(s,m,c)$ 下的模态指数。完整的 ${}_s\\mathcal{S}_{\\ell m}$ 的归一化随后通过 $\\phi$ 中的前置因子 $1/\\sqrt{2\\pi}$ 实现。\n\n3) 模态识别：对于给定的 $(s,m,c)$，允许的阶数满足 $\\ell \\ge \\ell_{\\min} = \\max(|m|,|s|)$。按 $A$ 的升序排列特征对。将第 $k$ 个特征对与 $\\ell=\\ell_{\\min}+k$ 关联，其中 $k\\in\\{0,1,2,\\dots\\}$。\n\n4) 正交性验证：对于每一对请求的模态，计算数值内积\n$$\nI = \\int_0^{2\\pi}\\!\\!\\int_0^\\pi {}_s\\mathcal{S}_{\\ell m}\\, {}_s\\mathcal{S}_{\\ell' m'}^{\\!*}\\, \\sin\\theta\\, d\\theta\\, d\\phi,\n$$\n通过：\n- 对 $\\theta$ 积分，在 $x=\\cos\\theta$ 上使用中点法则，这与你的网格和归一化方法一致。\n- 对 $\\phi$ 积分，在 $[0,2\\pi)$（弧度）上的 $M_\\phi$ 个均匀点上使用梯形法则来近似。\n\n以浮点数形式报告绝对误差 $|I - \\delta_{\\ell\\ell'}\\delta_{mm'}|$。\n\n角度单位要求：所有角度均为弧度。\n\n测试套件和要求输出：\n实现并运行以下六个测试用例；对于每个用例，输出绝对误差 $|I - \\delta_{\\ell\\ell'}\\delta_{mm'}|$：\n- 测试 1 (理想情况，精确球面极限): $s=-2$, $m=2$, $c=0.0$, 比较 $(\\ell,\\ell')=(2,2)$。\n- 测试 2 (在 $c=0$ 时跨阶数的正交性): $s=-2$, $m=2$, $c=0.0$, 比较 $(\\ell,\\ell')=(2,3)$。\n- 测试 3 (扁球面情况，中等 $c$ 值): $s=-2$, $m=2$, $c=0.5$, 比较 $(\\ell,\\ell')=(2,2)$。\n- 测试 4 (跨方位角量子数的正交性): $s=-2$, $m=1$ 对比 $m'=2$, $c=0.5$, 两者均有 $\\ell=\\ell'=2$。\n- 测试 5 (标量极限，球面情况): $s=0$, $m=0$, $c=0.0$, 比较 $(\\ell,\\ell')=(0,1)$。\n- 测试 6 (标量扁球面，中等 $c$ 值): $s=0$, $m=0$, $c=1.0$, 比较 $(\\ell,\\ell')=(0,0)$。\n\n数值参数：\n- 在 $x\\in[-1,1]$ 上使用包含 $N=400$ 个单元的均匀单元中心网格。\n- 在 $\\phi\\in[0,2\\pi)$ 上使用 $M_\\phi=256$ 个均匀点。\n\n最终输出格式：\n你的程序应生成单行输出，包含测试 1–6 的六个浮点数误差，格式为用方括号括起来的、以逗号分隔的 Python 列表，顺序与上面列出的一致。例如：[e1,e2,e3,e4,e5,e6]。不应打印任何其他文本。",
            "solution": "该问题要求数值计算自旋权重扁球面谐函数 ${}_sS_{\\ell m}(\\theta;c)$ 并验证其正交归一性。这通过求解相关的角向微分方程来实现，该方程构成一个 Sturm-Liouville 问题。求解过程通过有限体积离散化执行，随后对正交关系进行数值验证。\n\n### 基于原理的设计\n\n#### 1. Sturm-Liouville 问题构建\n角函数 $S(x) = {}_sS_{\\ell m}(\\arccos x;c)$ 的控制常微分方程由下式给出：\n$$\n\\frac{d}{dx}\\left[(1-x^2)\\frac{d S}{dx}\\right] + \\left[(c x)^2 - 2 c s x - \\frac{(m + s x)^2}{1-x^2} + s + A\\right] S(x) = 0\n$$\n该方程可以表示为自伴随 Sturm-Liouville 特征问题的形式，$\\mathcal{L}[S](x) + A S(x) = 0$，其中算符 $\\mathcal{L}$ 定义为：\n$$\n\\mathcal{L}[S](x) = \\frac{d}{dx}\\left(p(x)\\frac{dS}{dx}\\right) + q(x)S(x)\n$$\n其中 $p(x) = 1-x^2$，势函数为 $q(x) = V_{s m c}(x) = (c x)^2 - 2 c s x - \\frac{(m + s x)^2}{1-x^2} + s$。角向分离常数 $A$ 是特征值，函数 $S(x)$ 是特征函数，它必须在边界 $x=\\pm 1$ 处是正则的。\n\n#### 2. 有限体积离散化\n我们在定义域 $x \\in [-1, 1]$ 上的均匀网格上离散化算符 $\\mathcal{L}$。该定义域被划分为 $N$ 个宽度为 $\\Delta x = 2/N$ 的单元。单元中心表示为 $x_i = -1 + (i + 0.5)\\Delta x$，其中 $i=0, 1, \\dots, N-1$，单元面位于 $x_{i+1/2} = -1 + (i+1)\\Delta x$。\n\n我们将特征问题方程在第 $i$ 个单元上积分，从 $x_{i-1/2}$ 到 $x_{i+1/2}$：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( \\frac{d}{dx}\\left[p(x)\\frac{dS}{dx}\\right] + (q(x)+A)S(x) \\right) dx = 0\n$$\n对第一项应用微积分基本定理，对第二项应用中点法则，得到：\n$$\n\\left[p(x)\\frac{dS}{dx}\\right]_{i+1/2} - \\left[p(x)\\frac{dS}{dx}\\right]_{i-1/2} + (q(x_i) + A)S(x_i)\\Delta x \\approx 0\n$$\n单元面上的导数通过相邻单元中心函数值 $S_i = S(x_i)$ 的中心差分来近似：\n$$\n\\left(\\frac{dS}{dx}\\right)_{i+1/2} \\approx \\frac{S_{i+1} - S_i}{\\Delta x}\n$$\n代入这些近似值并除以 $\\Delta x$，将第 $i$ 个单元的方程整理成一个包含 $S_{i-1}$、$S_i$ 和 $S_{i+1}$ 的线性代数方程。\n\n#### 3. 矩阵特征问题构建\n这个由 $N$ 个线性方程组成的系统构成一个矩阵特征问题 $\\mathbf{L}\\mathbf{S} = -A\\mathbf{S}$，其中 $\\mathbf{S}$ 是特征函数值的向量 $[S_0, S_1, \\dots, S_{N-1}]^T$。矩阵 $\\mathbf{L}$ 是一个实对称三对角矩阵。其元素由离散化方程确定：\n- 对角元素：$L_{i,i} = -\\frac{p_{i+1/2} + p_{i-1/2}}{(\\Delta x)^2} + q_i$\n- 非对角元素：$L_{i, i+1} = L_{i+1, i} = \\frac{p_{i+1/2}}{(\\Delta x)^2}$\n\n边界条件通过因子 $p(x)=1-x^2$ 自然处理，该因子在定义域端点处为零，即 $p(\\pm 1) = 0$。在我们的网格中，这意味着 $p(x_{-1/2})=0$ 和 $p(x_{N-1/2})=0$，这简化了第一个 ($i=0$) 和最后一个 ($i=N-1$) 单元的方程，从而封闭了系统，无需引入虚拟单元。这种结构确保了 $\\mathbf{L}$ 是对称的。\n\n#### 4. 特征值求解与模态识别\n对称三对角特征问题可以使用专门的数值例程（如 `scipy.linalg.eigh_tridiagonal`）高效求解。这会得到一组 $N$ 个实特征值 $\\lambda_k = -A_k$ 及其对应的正交归一特征向量 $\\mathbf{v}_k$。特征值 $A_k$ 按升序排序。问题指定了一个模态识别规则：对于固定的 $(s, m)$，第 $k$ 个本征模（其中 $k=0, 1, 2, \\dots$）对应于阶数 $\\ell = \\ell_{\\min} + k$，其中 $\\ell_{\\min} = \\max(|m|, |s|)$。\n\n#### 5. 特征函数归一化\n标准库返回的特征向量 $\\mathbf{v}_k$ 通常在欧几里得意义下是归一化的，即 $\\sum_i (v_{k,i})^2 = 1$。然而，连续函数的物理正交归一条件是 $\\int_{-1}^1 S_k(x) S_j(x) dx = \\delta_{kj}$。用中点法则近似这个积分，得到离散的归一化条件：\n$$\n\\sum_{i=0}^{N-1} S_k(x_i) S_j(x_i) \\Delta x = \\delta_{kj}\n$$\n为满足此条件，库返回的特征向量 $\\mathbf{v}_k$ 必须被重新缩放。正确归一化的离散特征函数由 $\\mathbf{S}_k = \\mathbf{v}_k / \\sqrt{\\Delta x}$ 给出。\n\n#### 6. 正交性验证\n最后一步是通过计算以下积分来验证完整的扁球面谐函数 ${}_s\\mathcal{S}_{\\ell m}(\\theta,\\phi;c)$ 的正交归一性：\n$$\nI = \\int_0^{2\\pi}\\!\\!\\int_0^\\pi {}_s\\mathcal{S}_{\\ell m}(\\theta,\\phi;c)\\, {}_s\\mathcal{S}_{\\ell' m'}(\\theta,\\phi;c)^{\\!*}\\, \\sin\\theta\\, d\\theta\\, d\\phi\n$$\n代入定义 ${}_s\\mathcal{S}_{\\ell m} = \\frac{1}{\\sqrt{2\\pi}} {}_sS_{\\ell m} e^{im\\phi}$ 并进行变量替换 $x=\\cos\\theta$，积分变为：\n$$\nI = \\left(\\frac{1}{2\\pi} \\int_0^{2\\pi} e^{i(m-m')\\phi} d\\phi\\right) \\left(\\int_{-1}^1 {}_sS_{\\ell m}(x;c)\\, {}_sS_{\\ell' m'}(x;c)\\, dx\\right)\n$$\n关于 $\\phi$ 的积分使用 $M_\\phi$ 个点的均匀网格上的梯形法则计算。关于 $x$ 的积分使用中点法则计算，与之前建立的网格和归一化方法保持一致。最终的数值结果 $I_{\\text{num}}$ 与理论值 $\\delta_{\\ell\\ell'}\\delta_{mm'}$ 进行比较，并报告绝对误差。由于特征向量是实数，对 ${}_sS_{\\ell' m'}$ 的共轭没有影响。离散特征向量 $\\mathbf{S}_k$ 的数值正交性确保了 $x$ 积分的计算结果为 $\\delta_{\\ell\\ell'}$，而 $\\phi$ 积分的离散傅里叶和的计算结果为 $2\\pi \\delta_{mm'}$。因此，总误差预计接近机器精度，从而证实了整个数值程序的自洽性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for spin-weighted spheroidal harmonics.\n    \"\"\"\n\n    # Numerical parameters as specified in the problem statement.\n    N = 400\n    M_phi = 256\n\n    # Test suite definition. Each case is a pair of mode parameter tuples.\n    # Format: ((s, m, c, l), (s', m', c', l'))\n    # s' and c' are always the same as s and c in these tests.\n    test_cases = [\n        ((-2, 2, 0.0, 2), (-2, 2, 0.0, 2)),  # Test 1\n        ((-2, 2, 0.0, 2), (-2, 2, 0.0, 3)),  # Test 2\n        ((-2, 2, 0.5, 2), (-2, 2, 0.5, 2)),  # Test 3\n        ((-2, 1, 0.5, 2), (-2, 2, 0.5, 2)),  # Test 4\n        ((0, 0, 0.0, 0), (0, 0, 0.0, 1)),   # Test 5\n        ((0, 0, 1.0, 0), (0, 0, 1.0, 0)),   # Test 6\n    ]\n\n    results = []\n    memo = {}  # Memoization to store computed eigenpairs for a given (s, m, c)\n\n    def get_spheroidal_harmonic(s, m, c, l):\n        \"\"\"\n        Computes the discrete spin-weighted spheroidal harmonic for given parameters.\n        Utilizes memoization to avoid re-computing for the same (s, m, c).\n        \"\"\"\n        key = (s, m, c)\n        if key not in memo:\n            # Setup grid for x in [-1, 1]\n            dx = 2.0 / N\n            x_centers = -1.0 + (np.arange(N) + 0.5) * dx\n            x_faces = -1.0 + np.arange(N + 1) * dx\n\n            # Define p(x) = 1 - x^2 and q(x) = V(x)\n            p = 1.0 - x_faces**2\n            p[0], p[-1] = 0.0, 0.0 # Enforce boundary conditions exactly\n\n            # Potential term V(x). The grid points x_centers are never exactly +/- 1.\n            V = (c * x_centers)**2 - 2 * c * s * x_centers - (m + s * x_centers)**2 / (1 - x_centers**2) + s\n\n            # Construct the symmetric tridiagonal matrix L\n            diag = -(p[1:] + p[:-1]) / dx**2 + V\n            off_diag = p[1:-1] / dx**2\n\n            # Solve the eigenproblem L*S = -A*S.\n            # eigh_tridiagonal eigenvalues (lambdas) are sorted ascendingly.\n            lambdas, vecs = eigh_tridiagonal(diag, off_diag)\n\n            # Eigenvalues are A = -lambda. Sort A in ascending order.\n            A_sorted = -lambdas[::-1]\n            # Sort eigenvectors accordingly.\n            vecs_sorted = vecs[:, ::-1]\n\n            # Normalize eigenvectors for integral norm.\n            # Integral S^2 dx approx sum(S_i^2 * dx) = 1.\n            # S_i = v_i / sqrt(dx) - sum(v_i^2/dx * dx) = sum(v_i^2) = 1.\n            S_normalized = vecs_sorted / np.sqrt(dx)\n            \n            memo[key] = {\n                'eigenvalues': A_sorted,\n                'eigenfunctions': S_normalized.T\n            }\n\n        # Identify the requested mode\n        l_min = max(abs(s), abs(m))\n        k = l - l_min\n        if k  0 or k >= N:\n             raise ValueError(f\"Degree l={l} is out of computable range for s={s}, m={m}.\")\n\n        return memo[key]['eigenfunctions'][k]\n\n    for case in test_cases:\n        params1, params2 = case\n        s1, m1, c1, l1 = params1\n        s2, m2, c2, l2 = params2\n\n        # Compute the two eigenfunctions to be compared\n        S1 = get_spheroidal_harmonic(s1, m1, c1, l1)\n        S2 = get_spheroidal_harmonic(s2, m2, c2, l2)\n\n        # Calculate the orthonormality integral numerically\n        dx = 2.0 / N\n        dphi = 2.0 * np.pi / M_phi\n\n        # 1. theta-integral part (using midpoint rule on x = cos(theta))\n        # This is the discrete inner product.\n        theta_integral = np.sum(S1 * S2) * dx\n\n        # 2. phi-integral part (using trapezoidal rule)\n        phi_grid = np.arange(M_phi) * dphi\n        phi_integrand = np.exp(1j * (m1 - m2) * phi_grid)\n        phi_integral = np.sum(phi_integrand) * dphi\n\n        # Combine to get the full integral I\n        I_num = (1.0 / (2.0 * np.pi)) * theta_integral * phi_integral\n        \n        # Determine the exact theoretical value (Kronecker deltas)\n        target = 1.0 if l1 == l2 and m1 == m2 else 0.0\n\n        # Calculate and store the absolute error\n        error = np.abs(I_num - target)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理解一个动力学过程的最后一步是量化由引力波带走的能量、动量和其他守恒量。这个练习将引导你进入未来类光无穷远处的Bondi-Sachs形式体系 。你将通过数值方法验证BMS平衡律，该定律精确地将辐射通量（即“新闻函数”$N(u,\\theta,\\phi)$）与黑洞质量、动量及其他荷的变化联系起来。",
            "id": "3485929",
            "problem": "一个作为 Schwarzschild 黑洞小微扰的渐近平坦时空，在未来零无穷 $\\mathscr{I}^+$ 处允许一个 Bondi-Sachs 描述，其中与 Bondi-Metzner-Sachs (BMS) 群相关的平衡量定律定量地将荷的变化与引力辐射的通量联系起来。在线性化体系中围绕 Schwarzschild 背景进行研究，并假设真空，轴对称性仅被辐射场所破坏。使用几何化单位制，其中 $G=c=1$，角度以弧度为单位。将推迟时间 $u$ 处的 Bondi 新闻 $N(u,\\theta,\\phi)$ 视为辐射描述子，并假设 Bondi 质量面 $m(u,\\theta,\\phi)$ 遵循一个角度局域的演化方程，该方程对新闻振幅密度呈线性关系。\n\n从基本定律和核心定义出发，确定计算以下各项所需的表达式：(i) 能量荷的变化，(ii) 空间动量荷分量的变化，以及 (iii) 与固定超平移描述子 $f(\\theta,\\phi)$ 相关的超动量荷的变化。将每个变化表示为在 $\\mathscr{I}^+$ 上对由 Bondi 新闻 $N(u,\\theta,\\phi)$ 构建的适当密度的积分，并计算相应平衡量定律中出现的积分通量。你的推导必须从此情境下广义相对论的有效基础出发，并且不得依赖未经证明的简化公式。\n\n然后，实现一个完整、可运行的程序，对以下三个测试案例进行数值评估和验证平衡量定律：\n- 能量平衡：$\\Delta E + \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_E(u)\\,du = 0$，其中 $\\Delta E$ 是初始和最终 $u$ 切片之间的能量荷变化，$\\mathcal{F}_E(u)$ 是在固定 $u$ 上对球面积分的瞬时能量通量密度。\n- 动量平衡：$\\Delta P_i + \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_{P_i}(u)\\,du = 0$，对于 $i\\in\\{x,y,z\\}$，其中 $\\Delta P_i$ 是相应动量荷分量的变化，$\\mathcal{F}_{P_i}(u)$ 是在固定 $u$ 上对球面积分的瞬时动量通量密度。\n- 超动量平衡：$\\Delta Q_f + \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_f(u)\\,du = 0$，其中 $Q_f$ 是与固定超平移描述子 $f(\\theta,\\phi)$ 相关的荷，$\\mathcal{F}_f(u)$ 是相应的通量密度，两者均在固定 $u$ 上对球面积分。\n\n假设一个模型，其中 Bondi 新闻分离为时间依赖和角度依赖 $N(u,\\theta,\\phi) = A(u)\\,S(\\theta,\\phi)$，其中 $A(u)$ 是预设的脉冲轮廓，$S(\\theta,\\phi)$ 是预设的角度模式。假设质量面根据 $\\partial_u m(u,\\theta,\\phi) = -|N(u,\\theta,\\phi)|^2$ 进行局域演化，使得荷的变化由 $m$ 的角度积分给出，而通量由适当加权的 $|N|^2$ 的角度积分给出。使用单位向量 $\\boldsymbol{n}(\\theta,\\phi)$，其分量为 $n_x(\\theta,\\phi)=\\sin\\theta\\cos\\phi$、$n_y(\\theta,\\phi)=\\sin\\theta\\sin\\phi$ 和 $n_z(\\theta,\\phi)=\\cos\\theta$ 来定义动量权重。使用超平移描述子 $f(\\theta,\\phi)=\\mathrm{Re}\\,Y_{2,0}(\\theta,\\phi)$，其中 $Y_{\\ell,m}(\\theta,\\phi)$ 是采用 Condon-Shortley 相位约定的标量球谐函数。程序必须使用数值上可靠的求积法，对测度为 $d\\Omega$ 的球面进行角度积分。\n\n你的程序必须实现以下测试套件，每个案例由定义初始质量、脉冲轮廓 $A(u)$ 和 $S(\\theta,\\phi)$ 的球谐函数组合的参数指定。对于所有案例，使用时间区间 $[u_{\\min},u_{\\max}]=[-10,10]$ 和足够小以解析脉冲的时间步长，在 $\\cos\\theta$ 上使用高斯-勒让德节点和在 $\\phi$ 上使用均匀节点的角度积分，并使用几何化单位制 ($G=c=1$)。球谐函数 $Y_{\\ell,m}$ 必须如标准数学库中定义。轮廓 $A(u)$ 是一个高斯函数 $A(u)=A_0\\exp\\!\\big(-\\frac{(u-u_0)^2}{2\\sigma^2}\\big)$。\n\n- 案例 1（轴对称脉冲）：\n    - 初始质量：$M_0=1$。\n    - 脉冲参数：$A_0=0.1$, $u_0=0$, $\\sigma=0.8$。\n    - 角度模式：$S(\\theta,\\phi) = Y_{2,0}(\\theta,\\phi)$。\n\n- 案例 2（具有净动量通量的各向异性脉冲）：\n    - 初始质量：$M_0=1$。\n    - 脉冲参数：$A_0=0.1$, $u_0=0$, $\\sigma=0.8$。\n    - 角度模式：$S(\\theta,\\phi) = Y_{2,2}(\\theta,\\phi) + 0.6\\,Y_{2,1}(\\theta,\\phi)$。\n\n- 案例 3（无辐射）：\n    - 初始质量：$M_0=1$。\n    - 脉冲参数：$A_0=0$, $u_0=0$, $\\sigma=1.0$。\n    - 角度模式：$S(\\theta,\\phi) = Y_{2,0}(\\theta,\\phi)$。\n\n对于每个案例，计算以下五个布尔输出，以在一个严格的数值容差内验证平衡量定律：能量平衡、x方向动量平衡、y方向动量平衡、z方向动量平衡，以及对于 $f(\\theta,\\phi)=\\mathrm{Re}\\,Y_{2,0}(\\theta,\\phi)$ 的超动量平衡。如果平衡量定律左侧的绝对值小于容差 $\\varepsilon=10^{-9}$ 乘以从荷或通量积分的量级中选择的相关尺度，则布尔值为真。\n\n最终输出格式：你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，按顺序将案例1、案例2、案例3的五个布尔值展平，总共十五个布尔值。例如，输出应类似于[b11,b12,b13,b14,b15,b21,b22,b23,b24,b25,b31,b32,b33,b34,b35]，其中每个 bij 是 True 或 False。",
            "solution": "该问题要求在一个简化的、用于微扰 Schwarzschild 黑洞的 Bondi-Sachs 框架中，推导并数值验证能量、动量和超动量的平衡量定律。解决方案分两个阶段进行：首先，根据给定的假设，对所需表达式进行理论推导；其次，设计一个数值算法，以验证这些定律在特定测试案例下的成立性。\n\n### 理论推导\n\n我们在未来零无穷 $\\mathscr{I}^+$ 的渐近平坦时空背景下进行操作，该时空由推迟时间 $u$ 和球面角 $(\\theta, \\phi)$ 参数化。基本量是描述出射引力辐射的 Bondi 新闻 $N(u, \\theta, \\phi)$，以及 Bondi 质量面 $m(u, \\theta, \\phi)$。\n\n问题陈述我们应使用一个简化的、角度局域的质量面演化方程，其形式为：\n$$ \\frac{\\partial m(u, \\theta, \\phi)}{\\partial u} = -|N(u, \\theta, \\phi)|^2 $$\n该方程定义了天球上特定角度的质量损失率，并将其直接归因于该角度上新闻振幅的平方。虽然这是对广义相对论中完整演化方程（其中包含新闻的角度导数）的简化，但它是本问题要使用的明确模型。\n\n与 BMS 群相关的荷被定义为质量面 $m(u, \\theta, \\phi)$ 乘以特定权重函数 $W(\\theta, \\phi)$ 在单位球面 $S^2$ 上的积分。在给定时间 $u$ 的一个通用荷 $C_W$ 的形式为：\n$$ C_W(u) = \\frac{1}{4\\pi} \\int_{S^2} m(u, \\theta, \\phi) W(\\theta, \\phi) \\, d\\Omega $$\n其中 $d\\Omega = \\sin\\theta \\, d\\theta \\, d\\phi$ 是球面上的面积元。\n\n在时间区间 $[u_{\\min}, u_{\\max}]$ 内，该荷的变化量 $\\Delta C_W$ 为：\n$$ \\Delta C_W = C_W(u_{\\max}) - C_W(u_{\\min}) = \\frac{1}{4\\pi} \\int_{S^2} [m(u_{\\max}, \\theta, \\phi) - m(u_{\\min}, \\theta, \\phi)] W(\\theta, \\phi) \\, d\\Omega $$\n质量面的变化量 $m(u_{\\max}) - m(u_{\\min})$ 可以通过对给定的演化方程关于 $u$ 积分得到：\n$$ m(u_{\\max}, \\theta, \\phi) - m(u_{\\min}, \\theta, \\phi) = \\int_{u_{\\min}}^{u_{\\max}} \\frac{\\partial m(u', \\theta, \\phi)}{\\partial u'} \\, du' = - \\int_{u_{\\min}}^{u_{\\max}} |N(u', \\theta, \\phi)|^2 \\, du' $$\n将此代入 $\\Delta C_W$ 的表达式中：\n$$ \\Delta C_W = - \\frac{1}{4\\pi} \\int_{S^2} \\left( \\int_{u_{\\min}}^{u_{\\max}} |N(u', \\theta, \\phi)|^2 \\, du' \\right) W(\\theta, \\phi) \\, d\\Omega $$\n\n平衡量定律将此荷的变化与辐射通量联系起来。与荷 $C_W$ 相关的瞬时通量定义为：\n$$ \\mathcal{F}_W(u) = \\frac{1}{4\\pi} \\int_{S^2} |N(u, \\theta, \\phi)|^2 W(\\theta, \\phi) \\, d\\Omega $$\n在时间区间上的总积分通量为：\n$$ F_W = \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_W(u) \\, du = \\int_{u_{\\min}}^{u_{\\max}} \\left( \\frac{1}{4\\pi} \\int_{S^2} |N(u, \\theta, \\phi)|^2 W(\\theta, \\phi) \\, d\\Omega \\right) du $$\n通过应用 Fubini 定理交换积分顺序，这变为：\n$$ F_W = \\frac{1}{4\\pi} \\int_{S^2} \\left( \\int_{u_{\\min}}^{u_{\\max}} |N(u, \\theta, \\phi)|^2 \\, du \\right) W(\\theta, \\phi) \\, d\\Omega $$\n比较 $\\Delta C_W$ 和 $F_W$ 的表达式，我们发现 $\\Delta C_W = -F_W$。这就建立了一般的平衡量定律：\n$$ \\Delta C_W + F_W = 0 $$\n我们的任务是针对权重函数 $W(\\theta, \\phi)$ 的不同选择，数值上验证这个恒等式。\n\n**1. 能量平衡**\nBondi 能量 $E(u)$ 对应于权重函数 $W(\\theta, \\phi) = 1$。\n- 荷（能量）：$E(u) = \\frac{1}{4\\pi} \\int_{S^2} m(u, \\theta, \\phi) \\, d\\Omega$。\n- 通量（功率）：$\\mathcal{F}_E(u) = \\frac{1}{4\\pi} \\int_{S^2} |N(u, \\theta, \\phi)|^2 \\, d\\Omega$。\n- 平衡量定律：$\\Delta E + \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_E(u) \\, du = 0$。\n\n**2. 动量平衡**\n对于 $i \\in \\{x,y,z\\}$，Bondi 线性动量 $P_i(u)$ 对应于权重函数 $W(\\theta, \\phi) = n_i(\\theta, \\phi)$，其中 $\\boldsymbol{n}$ 是球面上的单位径向矢量：$n_x = \\sin\\theta\\cos\\phi$, $n_y = \\sin\\theta\\sin\\phi$, $n_z = \\cos\\theta$。\n- 荷（动量）：$P_i(u) = \\frac{1}{4\\pi} \\int_{S^2} m(u, \\theta, \\phi) n_i(\\theta, \\phi) \\, d\\Omega$。\n- 通量（动量通量）：$\\mathcal{F}_{P_i}(u) = \\frac{1}{4\\pi} \\int_{S^2} |N(u, \\theta, \\phi)|^2 n_i(\\theta, \\phi) \\, d\\Omega$。\n- 平衡量定律：$\\Delta P_i + \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_{P_i}(u) \\, du = 0$。\n\n**3. 超动量平衡**\n超动量荷 $Q_f(u)$ 与一个由函数 $f(\\theta, \\phi)$ 描述的超平移相关。这里，权重函数是 $W(\\theta, \\phi) = f(\\theta, \\phi) = \\mathrm{Re}\\,Y_{2,0}(\\theta, \\phi)$。由于球谐函数 $Y_{2,0}$ 是实数，因此 $f(\\theta, \\phi) = Y_{2,0}(\\theta, \\phi)$。\n- 荷（超动量）：$Q_f(u) = \\frac{1}{4\\pi} \\int_{S^2} m(u, \\theta, \\phi) f(\\theta, \\phi) \\, d\\Omega$。\n- 通量（超动量通量）：$\\mathcal{F}_f(u) = \\frac{1}{4\\pi} \\int_{S^2} |N(u, \\theta, \\phi)|^2 f(\\theta, \\phi) \\, d\\Omega$。\n- 平衡量定律：$\\Delta Q_f + \\int_{u_{\\min}}^{u_{\\max}} \\mathcal{F}_f(u) \\, du = 0$。\n\n### 数值实现策略\n\n为了验证这些平衡量定律，我们必须独立计算 $\\Delta C_W$ 和积分通量 $F_W$，并检查它们的和是否接近于零。我们假设在辐射到达 $u_{\\min}$ 之前，系统是一个质量为 $M_0$ 的未受扰动的 Schwarzschild 黑洞。这意味着初始质量面是各向同性的 $m(u_{\\min}, \\theta, \\phi) = M_0$。\n这个初始条件意味着：\n- $E(u_{\\min}) = \\frac{1}{4\\pi} \\int M_0 \\cdot 1 \\, d\\Omega = M_0$。\n- $P_i(u_{\\min}) = \\frac{M_0}{4\\pi} \\int n_i \\, d\\Omega = 0$。\n- $Q_f(u_{\\min}) = \\frac{M_0}{4\\pi} \\int Y_{2,0} \\, d\\Omega = 0$（根据球谐函数的正交性）。\n\n平衡量定律的两边按以下方式计算：\n\n1.  **荷的变化量，$\\Delta C_W$**：\n    -   首先，求出最终质量面：$m(u_{\\max}, \\theta, \\phi) = m(u_{\\min}, \\theta, \\phi) - \\int_{u_{\\min}}^{u_{\\max}} |N|^2 du$。\n    -   给定 $N(u, \\theta, \\phi) = A(u)S(\\theta, \\phi)$，这等于 $m(u_{\\max}, \\theta, \\phi) = M_0 - |S(\\theta, \\phi)|^2 \\int_{u_{\\min}}^{u_{\\max}} A(u)^2 du$。\n    -   计算最终荷 $C_W(u_{\\max}) = \\frac{1}{4\\pi} \\int m(u_{\\max}) W \\, d\\Omega$。\n    -   计算变化量 $\\Delta C_W = C_W(u_{\\max}) - C_W(u_{\\min})$。\n\n2.  **积分通量，$F_W$**：\n    -   对于区间中的每个时间步 $u_j$，计算瞬时通量 $\\mathcal{F}_W(u_j) = \\frac{A(u_j)^2}{4\\pi} \\int |S(\\theta, \\phi)|^2 W(\\theta, \\phi) \\, d\\Omega$。\n    -   将这个通量的时间序列在 $[u_{\\min}, u_{\\max}]$ 上积分，得到总通量 $F_W = \\int \\mathcal{F}_W(u) du$。\n\n数值积分使用稳健的求积方法进行。球面上的积分 $\\int_0^{2\\pi}d\\phi \\int_0^{\\pi} \\sin\\theta d\\theta (\\dots) = \\int_0^{2\\pi}d\\phi \\int_{-1}^{1} dx (\\dots)$，其中 $x=\\cos\\theta$，使用高斯-勒让德求积法进行 $x$ 积分，使用梯形法则进行周期性的 $\\phi$ 积分。时间积分使用梯形法则计算。如果 $|\\Delta C_W + F_W|  \\varepsilon \\times \\text{scale}$，则平衡量定律得到验证，其中 $\\varepsilon=10^{-9}$，尺度由相关物理量的量级确定。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import sph_harm\n\ndef verify_balance_laws_for_case(case_params):\n    \"\"\"\n    Computes and verifies the five balance laws for a single test case.\n    \"\"\"\n    M0, A0, u0, sigma, S_func = case_params\n    u_min, u_max = -10.0, 10.0\n    epsilon = 1e-9\n\n    # Set up numerical grids\n    # Time grid\n    num_u = 4001\n    u_grid = np.linspace(u_min, u_max, num_u)\n    \n    # Angular grid (Gauss-Legendre for theta, uniform for phi)\n    num_theta = 128\n    num_phi = 256\n    costheta_nodes, leg_weights = np.polynomial.legendre.leggauss(num_theta)\n    theta_nodes = np.arccos(costheta_nodes)\n    phi_nodes = np.linspace(0.0, 2.0 * np.pi, num_phi, endpoint=False)\n    dphi = 2.0 * np.pi / num_phi\n\n    # Create meshgrids for vectorized calculations\n    THETA, PHI = np.meshgrid(theta_nodes, phi_nodes, indexing='ij')\n\n    # Calculate angular patterns on the grid\n    S_grid = S_func(THETA, PHI)\n    S2_grid = np.abs(S_grid)**2  # |S(theta,phi)|^2\n\n    # Define weight functions for charges and fluxes\n    W_E = np.ones_like(THETA)\n    W_Px = np.sin(THETA) * np.cos(PHI)\n    W_Py = np.sin(THETA) * np.sin(PHI)\n    W_Pz = np.cos(THETA)\n    W_f = sph_harm(0, 2, PHI, THETA).real # f = Re(Y_2,0)\n    \n    weight_grids = [W_E, W_Px, W_Py, W_Pz, W_f]\n\n    # Calculate time-dependent pulse profile\n    A_u = A0 * np.exp(-(u_grid - u0)**2 / (2.0 * sigma**2))\n    A2_u = A_u**2  # A(u)^2\n\n    # Initial charges (based on m(u_min, theta, phi) = M0)\n    C_E_min = M0\n    C_Px_min, C_Py_min, C_Pz_min, C_f_min = 0.0, 0.0, 0.0, 0.0\n    C_mins = [C_E_min, C_Px_min, C_Py_min, C_Pz_min, C_f_min]\n\n    # Calculate final mass aspect: m_final = M0 - |S|^2 * integral(A^2 du)\n    I_A = np.trapz(A2_u, u_grid)\n    delta_m_grid = -S2_grid * I_A\n    m_final_grid = M0 + delta_m_grid\n\n    case_results = []\n    \n    for i in range(len(weight_grids)):\n        W_grid = weight_grids[i]\n        C_W_min = C_mins[i]\n\n        # --- Path 1: Calculate the change in charge, Delta C_W ---\n        # C_W(u_final) = (1 / 4pi) * integral(m_final * W dOmega)\n        charge_integrand_final = m_final_grid * W_grid\n        phi_integral_final = np.sum(charge_integrand_final, axis=1) * dphi\n        angular_integral_final = np.sum(leg_weights * phi_integral_final)\n        C_W_final = angular_integral_final / (4.0 * np.pi)\n        \n        Delta_C_W = C_W_final - C_W_min\n\n        # --- Path 2: Calculate the total integrated flux, F_W ---\n        # F_W = integral_{u_min}^{u_max} du [ A(u)^2 / (4pi) * integral(|S|^2 * W dOmega) ]\n        flux_angular_integrand = S2_grid * W_grid\n        flux_phi_integral = np.sum(flux_angular_integrand, axis=1) * dphi\n        flux_angular_integral = np.sum(leg_weights * flux_phi_integral)\n        \n        flux_vs_u = A2_u * (flux_angular_integral / (4.0 * np.pi))\n        F_W = np.trapz(flux_vs_u, u_grid)\n\n        # --- Final Verification ---\n        LHS = Delta_C_W + F_W\n        \n        # Define a relevant scale for the tolerance check\n        scale = max(abs(C_W_min), abs(C_W_final), abs(F_W))\n        \n        is_balanced = False\n        if np.isclose(scale, 0.0):\n            # If all quantities are zero, the law holds if LHS is numerically zero\n            is_balanced = np.isclose(LHS, 0.0)\n        else:\n            # Relative tolerance check\n            is_balanced = abs(LHS)  epsilon * scale\n            \n        case_results.append(is_balanced)\n\n    return case_results\n\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run verification, and print results.\n    \"\"\"\n    # Define the angular patterns S(theta, phi) for each test case\n    S1 = lambda theta, phi: sph_harm(0, 2, phi, theta)\n    S2 = lambda theta, phi: sph_harm(2, 2, phi, theta) + 0.6 * sph_harm(1, 2, phi, theta)\n    S3 = lambda theta, phi: sph_harm(0, 2, phi, theta) # Pattern does not matter for A0=0\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Case 1: Axisymmetric pulse\n        (1.0, 0.1, 0.0, 0.8, S1),\n        # Case 2: Anisotropic pulse\n        (1.0, 0.1, 0.0, 0.8, S2),\n        # Case 3: No radiation\n        (1.0, 0.0, 0.0, 1.0, S3),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Run verification for each case, which returns a list of 5 booleans\n        results_for_case = verify_balance_laws_for_case(case)\n        all_results.extend(results_for_case)\n\n    # Format the final output as a comma-separated list of booleans in brackets\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        }
    ]
}