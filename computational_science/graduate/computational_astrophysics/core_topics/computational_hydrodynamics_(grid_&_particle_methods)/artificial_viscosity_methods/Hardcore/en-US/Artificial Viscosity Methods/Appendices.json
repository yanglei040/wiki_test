{
    "hands_on_practices": [
        {
            "introduction": "Numerical schemes for hyperbolic conservation laws, like the advection equation, can be notoriously unstable when steep gradients are present. This first practice grounds the concept of artificial viscosity in fundamental numerical analysis, exploring why a simple centered-difference scheme fails and how to fix it . By performing a rigorous stability and monotonicity analysis, you will derive the minimal amount of viscous dissipation required to ensure a stable and non-oscillatory (Total Variation Diminishing) solution, providing a first-principles justification for adding what is essentially a controlled numerical error.",
            "id": "3504913",
            "problem": "Consider the one-dimensional linear advection equation used as a model for passive scalar transport in computational astrophysics,\n$$\n\\partial_{t} u(x,t) + a\\,\\partial_{x} u(x,t) = 0,\n$$\naugmented by an artificial viscosity term to stabilize numerical oscillations near steep gradients,\n$$\n\\partial_{t} u(x,t) + a\\,\\partial_{x} u(x,t) = \\epsilon\\,\\partial_{xx} u(x,t).\n$$\nAssume a uniform grid with spacing $\\Delta x$ and an explicit single-step time integrator with time step $\\Delta t$. Consider the following conservative finite difference scheme with forward Euler time stepping, centered differencing for the advective flux, and a second difference for the viscous flux:\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\frac{a\\,\\Delta t}{2\\,\\Delta x}\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right) + \\frac{\\epsilon\\,\\Delta t}{\\Delta x^{2}}\\left(u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}\\right).\n$$\nIntroduce the nondimensional parameters $\\lambda = \\frac{a\\,\\Delta t}{\\Delta x}$ and $\\mu = \\frac{\\epsilon\\,\\Delta t}{\\Delta x^{2}}$. Starting from first principles, do the following:\n\n- Derive the consistency (accuracy) conditions for this scheme by Taylor expansion, identifying the leading-order terms in the local truncation error in terms of $\\Delta t$, $\\Delta x$, $a$, and $\\epsilon$.\n- Using the Lax–Richtmyer equivalence theorem (LRET), articulate stability requirements for this linear constant-coefficient scheme to guarantee convergence under grid refinement.\n- Map the Total Variation Diminishing (TVD) requirement to a monotonicity constraint for this linear update and derive the inequalities on $\\lambda$ and $\\mu$ that enforce TVD for all grid points.\n- From these inequalities, determine the minimal artificial viscosity $\\epsilon(\\Delta x,\\Delta t)$ that guarantees TVD behavior for the given discretization while maintaining consistency.\n\nProvide your final answer as a single closed-form expression for the minimal artificial viscosity $\\epsilon$ in terms of $a$ and $\\Delta x$, without any numerical substitution. If evaluated numerically, express $\\epsilon$ in square meters per second, but do not include units in the final expression. No rounding is required.",
            "solution": "The problem statement is valid as it presents a standard, well-posed problem in computational fluid dynamics concerning the numerical analysis of a finite difference scheme for the advection-diffusion equation. The problem is scientifically grounded, objective, and self-contained. I will proceed with the four-part derivation as requested.\n\nThe governing partial differential equation (PDE) is the one-dimensional linear advection-diffusion equation:\n$$\n\\partial_{t} u + a\\,\\partial_{x} u = \\epsilon\\,\\partial_{xx} u\n$$\nThe provided finite difference scheme is:\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\frac{a\\,\\Delta t}{2\\,\\Delta x}\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right) + \\frac{\\epsilon\\,\\Delta t}{\\Delta x^{2}}\\left(u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}\\right)\n$$\nUsing the nondimensional parameters $\\lambda = \\frac{a\\,\\Delta t}{\\Delta x}$ and $\\mu = \\frac{\\epsilon\\,\\Delta t}{\\Delta x^{2}}$, the scheme can be written as:\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\frac{\\lambda}{2}\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right) + \\mu\\left(u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}\\right)\n$$\n\nFirst, to derive the consistency conditions and local truncation error, we perform a Taylor series expansion of each term in the scheme around the point $(x_j, t_n)$. We rearrange the scheme as:\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + a\\frac{u_{j+1}^{n} - u_{j-1}^{n}}{2\\,\\Delta x} - \\epsilon\\frac{u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}}{\\Delta x^{2}} = 0\n$$\nWe expand each term, where $u$ and its derivatives are evaluated at $(x_j, t_n)$:\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{(u + \\Delta t\\,\\partial_t u + \\frac{\\Delta t^2}{2}\\partial_{tt} u + \\dots) - u}{\\Delta t} = \\partial_t u + \\frac{\\Delta t}{2}\\partial_{tt} u + O(\\Delta t^2)\n$$\n$$\n\\frac{u_{j+1}^{n} - u_{j-1}^{n}}{2\\,\\Delta x} = \\frac{(u + \\Delta x\\,\\partial_x u + \\frac{\\Delta x^2}{2}\\partial_{xx} u + \\frac{\\Delta x^3}{6}\\partial_{xxx} u + \\dots) - (u - \\Delta x\\,\\partial_x u + \\frac{\\Delta x^2}{2}\\partial_{xx} u - \\frac{\\Delta x^3}{6}\\partial_{xxx} u + \\dots)}{2\\,\\Delta x} = \\partial_x u + \\frac{\\Delta x^2}{6}\\partial_{xxx} u + O(\\Delta x^4)\n$$\n$$\n\\frac{u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}}{\\Delta x^{2}} = \\frac{(u + \\Delta x\\,\\partial_x u + \\frac{\\Delta x^2}{2}\\partial_{xx} u + \\dots) - 2u + (u - \\Delta x\\,\\partial_x u + \\frac{\\Delta x^2}{2}\\partial_{xx} u + \\dots)}{\\Delta x^2} = \\partial_{xx} u + \\frac{\\Delta x^2}{12}\\partial_{xxxx} u + O(\\Delta x^4)\n$$\nSubstituting these expansions into the rearranged scheme gives the truncation error, $T_j^n$:\n$$\nT_j^n = \\left(\\partial_t u + \\frac{\\Delta t}{2}\\partial_{tt} u\\right) + a\\left(\\partial_x u + \\frac{\\Delta x^2}{6}\\partial_{xxx} u\\right) - \\epsilon\\left(\\partial_{xx} u + \\frac{\\Delta x^2}{12}\\partial_{xxxx} u\\right) + \\dots\n$$\n$$\nT_j^n = (\\partial_t u + a\\,\\partial_x u - \\epsilon\\,\\partial_{xx} u) + \\frac{\\Delta t}{2}\\partial_{tt} u + a\\,\\frac{\\Delta x^2}{6}\\partial_{xxx} u - \\epsilon\\,\\frac{\\Delta x^2}{12}\\partial_{xxxx} u + O(\\Delta t^2, \\Delta x^4)\n$$\nFor an exact solution to the PDE, the first term $(\\partial_t u + a\\,\\partial_x u - \\epsilon\\,\\partial_{xx} u)$ is zero. The local truncation error is therefore:\n$$\nT_j^n = \\frac{\\Delta t}{2}\\partial_{tt} u + a\\,\\frac{\\Delta x^2}{6}\\partial_{xxx} u - \\epsilon\\,\\frac{\\Delta x^2}{12}\\partial_{xxxx} u + \\dots\n$$\nThe scheme is consistent because $T_j^n \\to 0$ as $\\Delta t \\to 0$ and $\\Delta x \\to 0$. The leading-order error terms are $O(\\Delta t)$ and $O(\\Delta x^2)$, so the scheme is first-order accurate in time and second-order accurate in space.\n\nSecond, according to the Lax–Richtmyer equivalence theorem, for a consistent scheme applied to a well-posed linear initial-value problem, convergence is equivalent to stability. We analyze stability using the von Neumann method. We seek a solution of the form $u_j^n = g^n e^{ikx_j}$, where $g$ is the amplification factor and $k$ is the wavenumber. Substituting this into the scheme:\n$$\ng = 1 - \\frac{\\lambda}{2}(e^{ik\\Delta x} - e^{-ik\\Delta x}) + \\mu(e^{ik\\Delta x} - 2 + e^{-ik\\Delta x})\n$$\nUsing Euler's formula, with $\\theta = k\\Delta x$, we have $e^{i\\theta} - e^{-i\\theta} = 2i\\sin\\theta$ and $e^{i\\theta} + e^{-i\\theta} - 2 = 2\\cos\\theta - 2 = -4\\sin^2(\\theta/2)$.\n$$\ng(\\theta) = 1 - i\\lambda\\sin\\theta - 4\\mu\\sin^2(\\frac{\\theta}{2})\n$$\nThe stability condition is $|g| \\le 1$ for all $\\theta \\in [-\\pi, \\pi]$.\n$$\n|g|^2 = \\left(1 - 4\\mu\\sin^2(\\frac{\\theta}{2})\\right)^2 + (-\\lambda\\sin\\theta)^2 \\le 1\n$$\n$$\n1 - 8\\mu\\sin^2(\\frac{\\theta}{2}) + 16\\mu^2\\sin^4(\\frac{\\theta}{2}) + \\lambda^2\\sin^2\\theta \\le 1\n$$\nUsing $\\sin\\theta = 2\\sin(\\theta/2)\\cos(\\theta/2)$, we get:\n$$\n-8\\mu\\sin^2(\\frac{\\theta}{2}) + 16\\mu^2\\sin^4(\\frac{\\theta}{2}) + 4\\lambda^2\\sin^2(\\frac{\\theta}{2})\\cos^2(\\frac{\\theta}{2}) \\le 0\n$$\nFor $\\theta \\neq 0$, we can divide by $4\\sin^2(\\theta/2)  0$:\n$$\n-2\\mu + 4\\mu^2\\sin^2(\\frac{\\theta}{2}) + \\lambda^2\\cos^2(\\frac{\\theta}{2}) \\le 0\n$$\nSince $\\cos^2(\\theta/2) = 1 - \\sin^2(\\theta/2)$, the inequality becomes:\n$$\n\\lambda^2 - 2\\mu + (4\\mu^2 - \\lambda^2)\\sin^2(\\frac{\\theta}{2}) \\le 0\n$$\nThis must hold for all $\\sin^2(\\theta/2) \\in [0, 1]$. We check the endpoints.\nAt $\\sin^2(\\theta/2) = 0$ (i.e., $\\theta=0$): $\\lambda^2 - 2\\mu \\le 0 \\implies \\lambda^2 \\le 2\\mu$.\nAt $\\sin^2(\\theta/2) = 1$ (i.e., $\\theta=\\pi$): $\\lambda^2 - 2\\mu + 4\\mu^2 - \\lambda^2 \\le 0 \\implies 4\\mu^2 - 2\\mu \\le 0 \\implies 2\\mu(2\\mu - 1) \\le 0$. Since $\\mu = \\epsilon\\Delta t/\\Delta x^2 \\ge 0$, this implies $2\\mu - 1 \\le 0$, or $\\mu \\le 1/2$.\nThus, the stability requirements are $\\lambda^2 \\le 2\\mu$ and $\\mu \\le 1/2$.\n\nThird, we map the Total Variation Diminishing (TVD) requirement to a monotonicity constraint. A sufficient condition for a linear scheme to be TVD is that it is monotone, which means all coefficients in its explicit update form are non-negative. We rewrite the scheme to identify these coefficients:\n$$\nu_{j}^{n+1} = \\left(\\mu + \\frac{\\lambda}{2}\\right)u_{j-1}^{n} + (1 - 2\\mu)u_{j}^{n} + \\left(\\mu - \\frac{\\lambda}{2}\\right)u_{j+1}^{n}\n$$\nThe coefficients are $C_{j-1} = \\mu + \\lambda/2$, $C_j = 1 - 2\\mu$, and $C_{j+1} = \\mu - \\lambda/2$. For monotonicity, all must be non-negative.\n1. $C_j = 1 - 2\\mu \\ge 0 \\implies \\mu \\le 1/2$.\n2. The other two coefficients depend on the sign of $\\lambda = a\\Delta t/\\Delta x$.\n   Case $a \\ge 0$ ($\\lambda \\ge 0$):\n   $C_{j-1} = \\mu + \\lambda/2 \\ge 0$ is always true since $\\mu, \\lambda \\ge 0$.\n   $C_{j+1} = \\mu - \\lambda/2 \\ge 0 \\implies \\lambda \\le 2\\mu$.\n   Case $a  0$ ($\\lambda  0$):\n   $C_{j-1} = \\mu + \\lambda/2 \\ge 0 \\implies \\mu \\ge -\\lambda/2 \\implies \\mu \\ge |\\lambda|/2 \\implies |\\lambda| \\le 2\\mu$.\n   $C_{j+1} = \\mu - \\lambda/2 = \\mu + |\\lambda|/2 \\ge 0$ is always true.\nIn both cases, the conditions for monotonicity (and thus TVD) are:\n$$\n|\\lambda| \\le 2\\mu \\quad \\text{and} \\quad \\mu \\le \\frac{1}{2}\n$$\nNote that the TVD condition $|\\lambda| \\le 2\\mu$ is stricter than the stability condition $\\lambda^2 \\le 2\\mu$, as squaring the former gives $\\lambda^2 \\le 4\\mu^2$, and since $\\mu \\le 1/2$, $4\\mu^2 = 2\\mu(2\\mu) \\le 2\\mu(1) = 2\\mu$.\n\nFourth, we determine the minimal artificial viscosity $\\epsilon$ from these TVD inequalities. The first inequality is $|\\lambda| \\le 2\\mu$. Substituting the definitions of $\\lambda$ and $\\mu$:\n$$\n\\left|\\frac{a\\,\\Delta t}{\\Delta x}\\right| \\le 2\\left(\\frac{\\epsilon\\,\\Delta t}{\\Delta x^{2}}\\right)\n$$\nAssuming $\\Delta t  0$ and $\\Delta x  0$, we can simplify:\n$$\n\\frac{|a|}{\\Delta x} \\le \\frac{2\\epsilon}{\\Delta x^2} \\implies |a|\\Delta x \\le 2\\epsilon\n$$\nThis gives a lower bound on the artificial viscosity coefficient:\n$$\n\\epsilon \\ge \\frac{|a|\\Delta x}{2}\n$$\nThe minimal artificial viscosity that can satisfy this condition is therefore $\\epsilon_{\\min} = \\frac{|a|\\Delta x}{2}$. For this choice to guarantee TVD, the second condition, $\\mu \\le 1/2$, must also be satisfiable. Substituting $\\epsilon = \\epsilon_{\\min}$:\n$$\n\\mu = \\frac{\\epsilon_{\\min}\\Delta t}{\\Delta x^2} = \\frac{(|a|\\Delta x/2)\\Delta t}{\\Delta x^2} = \\frac{|a|\\Delta t}{2\\Delta x} = \\frac{|\\lambda|}{2}\n$$\nThe condition $\\mu \\le 1/2$ becomes $|\\lambda|/2 \\le 1/2$, which simplifies to $|\\lambda| \\le 1$. This is the standard Courant-Friedrichs-Lewy (CFL) condition for an advective scheme. Therefore, a TVD scheme is only possible if the time step is chosen such that $|\\lambda| = |a|\\Delta t / \\Delta x \\le 1$. Assuming the scheme operates under this condition, the minimal artificial viscosity required to enforce TVD behavior is given by the equality in the first condition. This choice of $\\epsilon$ is consistent with the original advection equation in the limit of grid refinement, as $\\epsilon \\propto \\Delta x$ implies $\\epsilon \\to 0$ as $\\Delta x \\to 0$.\n\nThe minimal artificial viscosity $\\epsilon$ is thus expressed in terms of $a$ and $\\Delta x$.\n$$\n\\epsilon_{\\min} = \\frac{|a|\\Delta x}{2}\n$$",
            "answer": "$$\n\\boxed{\\frac{|a|\\Delta x}{2}}\n$$"
        },
        {
            "introduction": "Having established the theoretical need for artificial viscosity, we now turn to a practical question: how does one choose the values of the viscosity coefficients in a simulation? This exercise tackles this problem by analyzing the canonical Sedov-Taylor blast wave, a cornerstone test for astrophysical hydrodynamics codes . You will use scaling arguments and the Rankine-Hugoniot jump conditions to derive a direct relationship between the dimensionless artificial viscosity parameters, such as $\\alpha$ and $\\beta$, and the physical thickness of the numerically captured shock, learning how to calibrate these parameters to achieve a desired resolution.",
            "id": "3504909",
            "problem": "Consider a one-dimensional, spherically symmetric Sedov-Taylor blast wave in a uniform medium of rest-mass density $\\rho_0$ and adiabatic index $\\gamma$. The inviscid dynamics are governed by the Euler equations for compressible flow together with the Rankine–Hugoniot shock jump conditions. In the strong-shock limit, the shock radius obeys a self-similar scaling law $R_s(t) \\propto t^{2/5}$ and the shock speed $U_s(t) = \\mathrm{d}R_s/\\mathrm{d}t \\propto t^{-3/5}$. The post-shock sound speed $c_{s,2}$ is related to the shock speed $U_s$ by a constant ratio that depends only on $\\gamma$. Define this ratio as $\\kappa \\equiv c_{s,2}/U_s$.\n\nTo capture shocks numerically while preserving self-similar scaling, many schemes use Artificial Viscosity (AV). A standard form is the von Neumann–Richtmyer AV, which augments the pressure by\n$$\nq = \\rho\\left(\\beta\\, \\ell^2 (\\nabla\\cdot \\mathbf{u})^2 + \\alpha\\, c_s\\, \\ell\\, \\lvert \\nabla\\cdot \\mathbf{u}\\rvert\\right),\n$$\nwhere $\\rho$ is the density, $\\mathbf{u}$ is the velocity, $c_s$ is the local sound speed, $\\ell$ is a characteristic numerical length (take $\\ell = \\Delta x$), and $\\alpha$ and $\\beta$ are dimensionless AV coefficients. The goal is to spread the shock over a thickness $\\delta$ that is approximately $N$ zones, so that $\\delta \\approx N \\Delta x$, while preserving the self-similar scaling.\n\nStarting from the Euler equations and the Rankine–Hugoniot conditions in the strong-shock limit, proceed from first principles to:\n1) Derive the post-shock sound speed $c_{s,2}$ in terms of the shock speed $U_s$ and the adiabatic index $\\gamma$, and hence show that $\\kappa \\equiv c_{s,2}/U_s$ is a constant depending only on $\\gamma$.\n2) By balancing the AV-induced stress with the inertial momentum flux across the shock layer, derive an equation for the nondimensional shock thickness $x \\equiv \\delta/\\ell$ of the form\n$$\n\\beta \\left(\\frac{\\ell}{\\delta}\\right)^2 + \\alpha \\kappa \\left(\\frac{\\ell}{\\delta}\\right) = 1,\n$$\nand show that prescribing $x = N$ implies a relation between $\\beta$, $\\alpha$, $N$, and $\\kappa$.\n3) Solve the relation from step 2 to obtain $\\beta$ in terms of $\\alpha$, $N$, and $\\kappa$, under the condition that $\\beta \\ge 0$ for physical admissibility and self-similarity (which requires a time-independent $x$). Explicitly identify the constraint on $\\alpha$ for given $N$ and $\\gamma$ ensuring $\\beta \\ge 0$.\n4) Provide an algorithm that, for given $(\\gamma, \\alpha, N)$, computes $\\kappa(\\gamma)$, computes $\\beta$, and independently verifies the implied thickness $x$ by solving the quadratic relation for $x$ without assuming $x=N$ a priori. Use $\\ell = \\Delta x$ so that $x = \\delta/\\Delta x$.\n\nYour program must implement the algorithm from step 4 and evaluate it on the following test suite. All quantities in the output are dimensionless, so no physical units are required.\n- Test case 1 (pure quadratic AV): $\\gamma = 5/3$, $\\alpha = 0$, $N = 3$.\n- Test case 2 (pure linear AV achieving $x=N$): $\\gamma = 5/3$, $N = 4$, and choose $\\alpha = N/\\kappa(\\gamma)$ so that $\\beta = 0$.\n- Test case 3 (mixed AV): $\\gamma = 1.4$, $\\alpha = 1.0$, $N = 6$.\n- Test case 4 (near-boundary mixed AV): $\\gamma = 5/3$, choose $\\alpha = 0.95\\, N/\\kappa(\\gamma)$ with $N=3$.\n\nFor each test case, your program must output two values in order:\n- The computed $\\beta$ according to your derived formula.\n- The independently verified $x$ obtained by solving the quadratic relation for the nondimensional thickness, i.e., solving for $x = \\delta/\\Delta x$ directly from the relation in step 2 without assuming $x=N$.\n\nFinal output format: Your program should produce a single line of output containing the eight floating-point results for the four test cases, ordered as\n$$\n[\\beta_1, x_1, \\beta_2, x_2, \\beta_3, x_3, \\beta_4, x_4],\n$$\nrounded to six decimal places, with comma separators and enclosed in square brackets (e.g., \"[1.000000,3.000000,0.000000,4.000000, ...]\").",
            "solution": "The problem is valid as it is scientifically grounded in the principles of fluid dynamics and computational astrophysics, well-posed, objective, and internally consistent. We proceed with a step-by-step derivation and solution.\n\n### Step 1: Derivation of the Post-Shock Sound Speed Ratio $\\kappa$\n\nWe analyze a one-dimensional strong shock using the Rankine-Hugoniot jump conditions in the shock rest frame. Let the pre-shock (upstream) state be denoted by subscript $1$ and the post-shock (downstream) state by subscript $2$.\n\nThe given conditions are:\n- Pre-shock density: $\\rho_1 = \\rho_0$\n- Pre-shock velocity: $u_1 = U_s$ (velocity of the medium entering the shock)\n- Strong shock limit: Pre-shock pressure $P_1 \\to 0$ and specific internal energy $e_1 \\to 0$.\n\nThe Rankine-Hugoniot conditions for conservation of mass, momentum, and energy are:\n1.  Mass: $\\rho_1 u_1 = \\rho_2 u_2$\n    $$ \\rho_0 U_s = \\rho_2 u_2 $$\n2.  Momentum: $P_1 + \\rho_1 u_1^2 = P_2 + \\rho_2 u_2^2$\n    $$ \\rho_0 U_s^2 = P_2 + \\rho_2 u_2^2 $$\n3.  Energy: $e_1 + \\frac{P_1}{\\rho_1} + \\frac{1}{2}u_1^2 = e_2 + \\frac{P_2}{\\rho_2} + \\frac{1}{2}u_2^2$, where $e = \\frac{P}{(\\gamma-1)\\rho}$ for an ideal gas.\n    $$ \\frac{1}{2}U_s^2 = \\frac{P_2}{(\\gamma-1)\\rho_2} + \\frac{P_2}{\\rho_2} + \\frac{1}{2}u_2^2 = \\frac{\\gamma P_2}{(\\gamma-1)\\rho_2} + \\frac{1}{2}u_2^2 $$\n\nFrom the mass conservation equation, we have $u_2 = (\\rho_0/\\rho_2) U_s$. Substituting this into the momentum equation:\n$$ P_2 = \\rho_0 U_s^2 - \\rho_2 \\left(\\frac{\\rho_0}{\\rho_2} U_s\\right)^2 = \\rho_0 U_s^2 \\left(1 - \\frac{\\rho_0}{\\rho_2}\\right) $$\nNow, substitute the expressions for $u_2$ and $P_2$ into the energy equation:\n$$ \\frac{1}{2}U_s^2 = \\frac{\\gamma}{(\\gamma-1)\\rho_2} \\left[\\rho_0 U_s^2 \\left(1 - \\frac{\\rho_0}{\\rho_2}\\right)\\right] + \\frac{1}{2}\\left(\\frac{\\rho_0}{\\rho_2} U_s\\right)^2 $$\nDividing by $U_s^2$ and letting $\\xi = \\rho_0/\\rho_2$ be the inverse compression ratio:\n$$ \\frac{1}{2} = \\frac{\\gamma}{\\gamma-1} \\frac{\\rho_0}{\\rho_2} - \\frac{\\gamma}{\\gamma-1} \\left(\\frac{\\rho_0}{\\rho_2}\\right)^2 + \\frac{1}{2}\\left(\\frac{\\rho_0}{\\rho_2}\\right)^2 $$\n$$ \\frac{1}{2} = \\frac{\\gamma}{\\gamma-1} \\xi - \\left(\\frac{\\gamma}{\\gamma-1} - \\frac{1}{2}\\right)\\xi^2 = \\frac{\\gamma}{\\gamma-1} \\xi - \\frac{\\gamma+1}{2(\\gamma-1)} \\xi^2 $$\nMultiplying by $2(\\gamma-1)$ yields a quadratic equation for $\\xi$:\n$$ \\gamma-1 = 2\\gamma \\xi - (\\gamma+1)\\xi^2 \\implies (\\gamma+1)\\xi^2 - 2\\gamma\\xi + (\\gamma-1) = 0 $$\nThe solutions are $\\xi=1$ (the trivial no-shock case) and $\\xi = \\frac{\\gamma-1}{\\gamma+1}$. Thus, the compression ratio is $\\rho_2/\\rho_0 = \\frac{\\gamma+1}{\\gamma-1}$.\n\nNow we find the post-shock pressure $P_2$:\n$$ P_2 = \\rho_0 U_s^2 (1 - \\xi) = \\rho_0 U_s^2 \\left(1 - \\frac{\\gamma-1}{\\gamma+1}\\right) = \\frac{2\\rho_0 U_s^2}{\\gamma+1} $$\nThe post-shock sound speed $c_{s,2}$ is given by $c_{s,2}^2 = \\gamma P_2 / \\rho_2$:\n$$ c_{s,2}^2 = \\gamma \\frac{P_2}{\\rho_2} = \\gamma \\frac{2\\rho_0 U_s^2 / (\\gamma+1)}{ \\rho_0 (\\gamma+1)/(\\gamma-1)} = \\frac{2\\gamma(\\gamma-1)}{(\\gamma+1)^2} U_s^2 $$\nTaking the square root gives the post-shock sound speed:\n$$ c_{s,2} = U_s \\frac{\\sqrt{2\\gamma(\\gamma-1)}}{\\gamma+1} $$\nThe ratio $\\kappa$ is therefore:\n$$ \\kappa \\equiv \\frac{c_{s,2}}{U_s} = \\frac{\\sqrt{2\\gamma(\\gamma-1)}}{\\gamma+1} $$\nThis expression depends only on the adiabatic index $\\gamma$, so $\\kappa$ is a constant for a given medium.\n\n### Step 2: Derivation of the Shock Thickness Equation\n\nThe von Neumann-Richtmyer artificial viscosity (AV) adds a term $q$ to the pressure to model shock dissipation. The problem asks us to derive a relation by balancing the AV-induced stress with the inertial momentum flux.\n\nThe inertial momentum flux of the upstream gas is the ram pressure, $\\rho_0 U_s^2$. We postulate that the maximum AV stress, $q_{max}$, must be of this order to halt the incoming flow:\n$$ q_{max} \\approx \\rho_0 U_s^2 $$\nThe AV stress is given by:\n$$ q = \\rho\\left(\\beta\\, \\ell^2 (\\nabla\\cdot \\mathbf{u})^2 + \\alpha\\, c_s\\, \\ell\\, \\lvert \\nabla\\cdot \\mathbf{u}\\rvert\\right) $$\nTo evaluate $q$ within the shock layer of thickness $\\delta$, we make the following scaling approximations:\n- The velocity gradient across the shock is of order the shock speed divided by the shock thickness: $|\\nabla \\cdot \\mathbf{u}| \\approx U_s/\\delta$.\n- The characteristic sound speed within the dissipative region is the post-shock sound speed: $c_s \\approx c_{s,2} = \\kappa U_s$.\n- The density factor $\\rho$ in the AV formula is often chosen based on numerical convenience and stability. To obtain the desired relation, we choose the pre-shock density $\\rho_0$.\n\nSubstituting these approximations into the expression for $q$:\n$$ q \\approx \\rho_0 \\left( \\beta \\ell^2 \\left(\\frac{U_s}{\\delta}\\right)^2 + \\alpha (\\kappa U_s) \\ell \\left(\\frac{U_s}{\\delta}\\right) \\right) $$\n$$ q \\approx \\rho_0 U_s^2 \\left( \\beta \\left(\\frac{\\ell}{\\delta}\\right)^2 + \\alpha \\kappa \\left(\\frac{\\ell}{\\delta}\\right) \\right) $$\nEquating this to the ram pressure $\\rho_0 U_s^2$:\n$$ \\rho_0 U_s^2 \\approx \\rho_0 U_s^2 \\left( \\beta \\left(\\frac{\\ell}{\\delta}\\right)^2 + \\alpha \\kappa \\left(\\frac{\\ell}{\\delta}\\right) \\right) $$\nThis simplifies to the desired relation:\n$$ \\beta \\left(\\frac{\\ell}{\\delta}\\right)^2 + \\alpha \\kappa \\left(\\frac{\\ell}{\\delta}\\right) = 1 $$\nWith the definition of the nondimensional shock thickness $x \\equiv \\delta/\\ell$, the relation becomes $\\beta(1/x)^2 + \\alpha\\kappa(1/x) = 1$. If we prescribe that the shock thickness spans $N$ zones, i.e., $x = N$, we get a relation between the AV coefficients and physical parameters:\n$$ \\beta \\left(\\frac{1}{N}\\right)^2 + \\alpha \\kappa \\left(\\frac{1}{N}\\right) = 1 $$\n\n### Step 3: Expression for $\\beta$ and Physical Constraint\n\nWe solve the relation from Step 2 for $\\beta$:\n$$ \\frac{\\beta}{N^2} + \\frac{\\alpha \\kappa}{N} = 1 \\implies \\frac{\\beta}{N^2} = 1 - \\frac{\\alpha \\kappa}{N} $$\n$$ \\beta = N^2 \\left(1 - \\frac{\\alpha \\kappa}{N}\\right) = N^2 - N \\alpha \\kappa $$\nFor $\\beta$ to be physically admissible (representing a dissipative, not antidissipative, process), we must have $\\beta \\ge 0$. This imposes a constraint on $\\alpha$:\n$$ N^2 - N \\alpha \\kappa \\ge 0 $$\nSince $N  0$, we can divide by $N$:\n$$ N - \\alpha \\kappa \\ge 0 \\implies N \\ge \\alpha \\kappa $$\nThus, the constraint on the linear viscosity coefficient $\\alpha$ is:\n$$ \\alpha \\le \\frac{N}{\\kappa} $$\n\n### Step 4: Algorithm for Computing $\\beta$ and Verifying $x$\n\nThe algorithm proceeds as follows for a given set of parameters $(\\gamma, \\alpha, N)$:\n1.  **Compute $\\kappa$**: Use the formula derived in Step 1:\n    $$ \\kappa(\\gamma) = \\frac{\\sqrt{2\\gamma(\\gamma-1)}}{\\gamma+1} $$\n2.  **Compute $\\beta$**: Use the formula derived in Step 3:\n    $$ \\beta(\\alpha, N, \\kappa) = N^2 - N \\alpha \\kappa $$\n3.  **Verify thickness $x$**: Solve the quadratic relation from Step 2 for $x$ without assuming $x=N$. Let $y = 1/x$. The equation is:\n    $$ \\beta y^2 + (\\alpha\\kappa) y - 1 = 0 $$\n    This is a quadratic equation for $y$.\n    -   If $\\beta \\approx 0$, the equation is linear: $(\\alpha \\kappa) y - 1 = 0$, so $y = 1/(\\alpha\\kappa)$, which gives $x = \\alpha\\kappa$.\n    -   If $\\beta  0$, we use the quadratic formula for $y$. Since $x$ must be a positive physical thickness, $y=1/x$ must also be positive.\n    $$ y = \\frac{-(\\alpha\\kappa) \\pm \\sqrt{(\\alpha\\kappa)^2 - 4(\\beta)(-1)}}{2\\beta} = \\frac{-\\alpha\\kappa \\pm \\sqrt{(\\alpha\\kappa)^2 + 4\\beta}}{2\\beta} $$\n    Since $\\beta \\ge 0$, the term under the square root is non-negative. To ensure $y  0$, we must choose the positive root:\n    $$ y = \\frac{-\\alpha\\kappa + \\sqrt{(\\alpha\\kappa)^2 + 4\\beta}}{2\\beta} $$\n    The independently verified thickness is then $x = 1/y$. As a self-consistency check, substituting the expression for $\\beta$ into this formula for $y$ recovers $y=1/N$, thus $x=N$, provided $\\beta0$. This \"verification\" step confirms the algebraic consistency of our derivation.\n\nThis constitutes the complete algorithm to be implemented.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements an algorithm to compute artificial viscosity parameters for a\n    Sedov-Taylor blast wave and verifies the resulting shock thickness.\n    \"\"\"\n    \n    # Define test cases: (type, gamma, alpha_parameter, N)\n    # 'const_alpha': alpha_parameter is the value of alpha.\n    # 'beta_zero': alpha is calculated as N/kappa to make beta=0.\n    # 'scaled_alpha': alpha is calculated as alpha_parameter * N/kappa.\n    test_cases = [\n        ('const_alpha', 5/3, 0.0, 3),  # Test case 1\n        ('beta_zero', 5/3, None, 4),   # Test case 2\n        ('const_alpha', 1.4, 1.0, 6),  # Test case 3\n        ('scaled_alpha', 5/3, 0.95, 3) # Test case 4\n    ]\n\n    results = []\n\n    for case_type, gamma, alpha_param, N in test_cases:\n        # Step 1: Compute kappa(gamma)\n        # kappa = c_{s,2} / U_s\n        kappa = np.sqrt(2 * gamma * (gamma - 1)) / (gamma + 1)\n\n        # Step 2: Determine alpha and compute beta\n        alpha = 0.0\n        if case_type == 'const_alpha':\n            alpha = alpha_param\n        elif case_type == 'beta_zero':\n            #\n            # Set alpha such that beta = 0.\n            # beta = N^2 - N * alpha * kappa = 0  =  alpha = N / kappa\n            #\n            alpha = N / kappa\n        elif case_type == 'scaled_alpha':\n            #\n            # Set alpha as a scaling factor of the beta=0 case.\n            # alpha = scaling_factor * (N / kappa)\n            #\n            alpha = alpha_param * N / kappa\n        \n        # beta = N^2 - N * alpha * kappa\n        beta = N**2 - N * alpha * kappa\n\n        # Step 3: Independently verify the nondimensional thickness x\n        # This is done by solving beta * (1/x)^2 + alpha*kappa * (1/x) - 1 = 0 for x.\n        ak = alpha * kappa\n        x = 0.0\n\n        # Handle the case where beta is numerically close to zero (linear equation for 1/x)\n        if np.isclose(beta, 0.0):\n            # The relation becomes alpha*kappa * (1/x) = 1 = x = alpha*kappa\n            # Note that for this case, N = alpha*kappa by definition of alpha.\n            if np.isclose(ak, 0.0): # Should not happen in these test cases\n                x = np.inf\n            else:\n                x = ak\n        else: # Standard quadratic case for 1/x\n            # Let y = 1/x. Equation is beta*y^2 + ak*y - 1 = 0\n            # Physical solution (y  0) requires the positive root.\n            discriminant = ak**2 + 4 * beta\n            \n            # Since beta is guaranteed to be = 0 by the problem setup\n            # for physically meaningful shocks, discriminant is non-negative.\n            sqrt_discriminant = np.sqrt(discriminant)\n            \n            # y = (-ak + sqrt(discriminant)) / (2*beta)\n            y = (-ak + sqrt_discriminant) / (2 * beta)\n\n            if np.isclose(y, 0.0):\n                x = np.inf\n            else:\n                x = 1.0 / y\n        \n        results.extend([beta, x])\n\n    # Print results in the specified format, rounded to 6 decimal places.\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While essential for capturing shocks, a constant or \"always-on\" artificial viscosity is a blunt instrument that can damp physical motions, such as turbulence or shear instabilities, corrupting the physics of the simulation. This final practice explores the design of a \"smart\" viscosity scheme that activates only in the presence of strong compression . You will design a dimensionless shock sensor based on the velocity divergence, test its ability to distinguish between compressive waves and divergence-free vortices, and implement a hysteresis mechanism to prevent unwanted chatter—a common practical issue in time-dependent simulations.",
            "id": "3504907",
            "problem": "Consider a compressible fluid described by the Euler equations for inviscid flow. From the continuity equation $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{v}) = 0$, infer that local compression is associated with negative velocity divergence, $\\nabla \\cdot \\mathbf{v}  0$. Artificial Viscosity (AV) is often activated by a shock sensor that responds strongly to compression while remaining insensitive to divergence-free motions such as steady vortices. Your task is to derive, implement, and assess a divergence-based shock sensor, together with a simple hysteresis mechanism to reduce temporal chatter in time-dependent AV activation.\n\nStarting from first principles, design a dimensionless sensor $S$ using the following constraints:\n- $S$ must compare a compressive timescale built from $-\\nabla \\cdot \\mathbf{v}$ to the acoustic cell-crossing timescale built from the sound speed $c_s$ and the grid spacing $\\Delta x$.\n- $S$ must be non-negative and must increase with the magnitude of compression.\n- $S$ must be insensitive to divergence-free flows where $\\nabla \\cdot \\mathbf{v} = 0$.\n\nImplement the sensor on uniform Cartesian grids using second-order central differences with periodic boundary conditions to approximate spatial derivatives. Use nondimensional units: set the domain length $L=1$ and the sound speed $c_s=1$, so all reported values are dimensionless floats.\n\nConstruct the following test suite to assess sensitivity and chatter:\n\n- Test Case 1 (Compressive sound wave in one dimension):\n  - Domain: $x \\in [0,L]$ with $L=1$ and $N_x=64$ grid points, uniform spacing $\\Delta x = L/N_x$.\n  - Velocity field: $v(x,t) = A \\sin(k x - \\omega t)$ with $A=0.8$, $k = 2\\pi$, and $\\omega = c_s k$.\n  - Time integration: $N_t = 200$ time steps over one period $T = 2\\pi/\\omega$, uniform time step $\\Delta t = T/N_t$.\n  - Noise model for measured divergence: add independent Gaussian noise at each time step with standard deviation $\\sigma_{\\text{div}} = 0.2\\,A\\,k$ to the divergence before computing $S$.\n  - AV activation decision at each time: define a naive activation state $a_{\\text{plain}}(t)$ that is $1$ if the domain-maximum sensor exceeds a plain threshold $\\alpha_{\\text{plain}} = 0.06$, and $0$ otherwise.\n  - Hysteresis mechanism: define a filtered sensor $s_f(t)$ obeying a first-order relaxation $s_f(t) = s_f(t-\\Delta t) + (\\Delta t/\\tau)\\,[s_{\\max}(t) - s_f(t-\\Delta t)]$ with $\\tau = 0.02\\,T$, where $s_{\\max}(t)$ is the domain-maximum of the noisy sensor at time $t$. Define a hysteretic activation state $a_{\\text{hyst}}(t)$ that switches on when $s_f(t) \\ge \\alpha_{\\text{on}} = 0.07$ and switches off when $s_f(t) \\le \\alpha_{\\text{off}}=0.035$.\n  - Required metrics: compute the peak domain-maximum sensor over time for the noise-free wave, and count the number of activation toggles for naive and hysteretic activation over the noisy time series.\n\n- Test Case 2 (Two-dimensional steady Taylor–Green vortex):\n  - Domain: $(x,y) \\in [0,L]\\times[0,L]$ with $L=1$, $N_x=N_y=64$, uniform $\\Delta x = \\Delta y = L/N_x$.\n  - Velocity field: $v_x(x,y) = V_0 \\sin(k x)\\cos(k y)$, $v_y(x,y) = -V_0 \\cos(k x)\\sin(k y)$ with $V_0=1$, $k=2\\pi$. This flow is exactly divergence-free in the continuum.\n  - Time series for chatter assessment: hold the field steady and generate $N_t=200$ samples with divergence noise added at each sample, using a Gaussian noise with standard deviation chosen so that the sensor noise has a standard deviation $\\sigma_S = 0.004$. Implement this by adding divergence noise with standard deviation $\\sigma_{\\text{div}} = \\sigma_S\\,c_s/\\Delta x$ before computing $S$.\n  - AV activation decision: use the same naive and hysteretic mechanisms as in Test Case 1, but with thresholds $\\alpha_{\\text{plain}}=0.003$, $\\alpha_{\\text{on}}=0.005$, $\\alpha_{\\text{off}}=0.0025$, and relaxation timescale $\\tau=0.02$ in units of the sampling interval.\n  - Required metrics: compute the peak domain-maximum sensor for the noise-free steady vortex, and count activation toggles for naive and hysteretic activation over the noisy samples.\n\n- Test Case 3 (Uniform flow edge case):\n  - Domain: $x \\in [0,L]$ with $L=1$, $N_x=64$, uniform $\\Delta x = L/N_x$.\n  - Velocity field: $v(x) = U_0$ with $U_0=1$ (constant).\n  - Required metric: compute the domain-maximum sensor for the noise-free field.\n\nFor spatial derivatives, use second-order central differences with periodic boundary conditions. For one dimension, approximate $\\partial_x v$ by $(v_{i+1} - v_{i-1})/(2\\Delta x)$. For two dimensions, approximate $\\nabla \\cdot \\mathbf{v}$ by $(v_{x,i+1,j}-v_{x,i-1,j})/(2\\Delta x) + (v_{y,i,j+1}-v_{y,i,j-1})/(2\\Delta y)$.\n\nYour program must output a single line containing the following seven dimensionless values in the specified order:\n1. The peak domain-maximum sensor over time for the noise-free compressive wave (float).\n2. The peak domain-maximum sensor for the noise-free steady Taylor–Green vortex (float).\n3. The domain-maximum sensor for the noise-free uniform flow (float).\n4. The number of activation toggles over the noisy compressive wave time series using the naive thresholding (integer).\n5. The number of activation toggles over the noisy compressive wave time series using the hysteresis mechanism (integer).\n6. The number of activation toggles over the noisy vortex samples using the naive thresholding (integer).\n7. The number of activation toggles over the noisy vortex samples using the hysteresis mechanism (integer).\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5,result6,result7]\"). All reported values are dimensionless and should be computed as specified above.",
            "solution": "The user has provided a problem that requires the derivation and implementation of an artificial viscosity shock sensor, along with an assessment of its performance using a set of well-defined test cases. The problem is to be treated with scientific rigor.\n\n### Problem Validation\n\n**Step 1: Extracted Givens**\n- **Sensor Concept**: A dimensionless sensor $S$ must be designed based on the ratio of the acoustic cell-crossing timescale ($T_{\\text{acoustic}} = \\Delta x / c_s$) to a compressive timescale derived from $-\\nabla \\cdot \\mathbf{v}$. It must be non-negative, responsive to compression ($\\nabla \\cdot \\mathbf{v}  0$), and insensitive to divergence-free or expanding flows.\n- **Numerical Method**: Second-order central differences on uniform Cartesian grids with periodic boundary conditions. The specific stencils for 1D and 2D derivatives are provided.\n- **Global Parameters**: Domain length $L=1$, sound speed $c_s=1$.\n- **Test Case 1 (1D Compressive Wave)**:\n  - Grid: $N_x=64$, $\\Delta x = L/N_x$.\n  - Velocity: $v(x,t) = A \\sin(k x - \\omega t)$ with $A=0.8$, $k = 2\\pi$, $\\omega = c_s k$.\n  - Time Integration: $N_t = 200$ steps over one period $T = 2\\pi/\\omega$.\n  - Noise: Gaussian noise with $\\sigma_{\\text{div}} = 0.2\\,A\\,k$ added to the analytical divergence.\n  - Naive Activation: Threshold $\\alpha_{\\text{plain}} = 0.06$.\n  - Hysteresis: Filter $s_f(t) = s_f(t-\\Delta t) + (\\Delta t/\\tau)\\,[s_{\\max}(t) - s_f(t-\\Delta t)]$ with $\\tau = 0.02\\,T$. Thresholds $\\alpha_{\\text{on}} = 0.07$, $\\alpha_{\\text{off}}=0.035$.\n- **Test Case 2 (2D Taylor-Green Vortex)**:\n  - Grid: $N_x=N_y=64$, $\\Delta x = \\Delta y = L/N_x$.\n  - Velocity: $v_x(x,y) = V_0 \\sin(k x)\\cos(k y)$, $v_y(x,y) = -V_0 \\cos(k x)\\sin(k y)$ with $V_0=1$, $k=2\\pi$.\n  - Time Series: $N_t=200$ static samples.\n  - Noise: Gaussian noise added to numerical divergence, with $\\sigma_{\\text{div}} = \\sigma_S\\,c_s/\\Delta x$ and $\\sigma_S = 0.004$.\n  - Naive Activation: Threshold $\\alpha_{\\text{plain}}=0.003$.\n  - Hysteresis: Same filter form with $\\tau=0.02$ in units of sampling interval. Thresholds $\\alpha_{\\text{on}}=0.005$, $\\alpha_{\\text{off}}=0.0025$.\n- **Test Case 3 (1D Uniform Flow)**:\n  - Grid: $N_x=64$, $\\Delta x = L/N_x$.\n  - Velocity: $v(x) = U_0=1$.\n- **Required Outputs**: Seven specific metrics from these tests.\n\n**Step 2: Validation Using Extracted Givens**\n- **Scientific Grounding**: The problem is well-grounded in computational astrophysics and fluid dynamics. Artificial viscosity, shock sensors, Euler equations, and the chosen test cases (sound wave, Taylor-Green vortex) are standard concepts and tools in the field. The link between mass conservation and velocity divergence is fundamental. The problem is scientifically sound.\n- **Well-Posedness**: The problem is exceptionally well-posed. All parameters, boundary conditions, numerical schemes, noise models, and analysis procedures are specified with high precision. This ensures that a unique and meaningful numerical solution can be obtained.\n- **Objectivity**: The problem is stated in precise, objective, and unbiased technical language.\n- **Consistency and Completeness**: All required information is provided and is internally consistent. There are no contradictions. A slight ambiguity in the interpretation of the hysteresis timescale $\\tau$ for Test Case 2 exists, but it is resolvable through a physically-motivated interpretation of filter stability, which is a standard part of such an analysis. This does not render the problem invalid but requires careful consideration during the solution.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. It is a well-formulated problem in computational physics that is solvable as stated. I will now proceed with the solution.\n\n### Derivation of the Shock Sensor\n\nThe sensor $S$ is required to be a dimensionless quantity comparing two timescales:\n1.  The acoustic cell-crossing time, $T_{\\text{acoustic}} = \\Delta x / c_s$, where $\\Delta x$ is the grid spacing and $c_s$ is the sound speed.\n2.  The compression timescale, $T_{\\text{comp}}$. The velocity divergence, $\\nabla \\cdot \\mathbf{v}$, has units of inverse time ($T^{-1}$). In compressive regions, $\\nabla \\cdot \\mathbf{v}  0$. We can thus define a rate of compression as $-\\nabla \\cdot \\mathbf{v}$. The associated timescale is $T_{\\text{comp}} = 1 / (-\\nabla \\cdot \\mathbf{v})$.\n\nThe sensor should increase with the strength of compression. Stronger compression implies a smaller $T_{\\text{comp}}$. Therefore, $S$ should be proportional to the ratio $T_{\\text{acoustic}} / T_{\\text{comp}}$.\n\n$$\nS \\propto \\frac{T_{\\text{acoustic}}}{T_{\\text{comp}}} = \\frac{\\Delta x / c_s}{1 / (-\\nabla \\cdot \\mathbf{v})} = \\frac{-\\Delta x (\\nabla \\cdot \\mathbf{v})}{c_s}\n$$\n\nThe sensor must be non-negative and insensitive to expansion ($\\nabla \\cdot \\mathbf{v}  0$) or divergence-free flow ($\\nabla \\cdot \\mathbf{v} = 0$). This is achieved by taking the maximum of the derived expression and zero. For a general grid spacing $h$, the final form of the sensor is:\n\n$$\nS = \\max\\left(0, \\frac{-h (\\nabla \\cdot \\mathbf{v})}{c_s}\\right)\n$$\n\nThis formulation satisfies all the design constraints given in the problem statement.\n\n### Numerical Implementation and Test Case Analysis\n\nThe problem will be solved by implementing the specified numerical schemes and running the three test cases. For reproducibility of the stochastic components, a fixed random seed will be used.\n\n**Test Case 1: 1D Compressive Sound Wave**\nA 1D grid is set up with $N_x=64$ points on the domain $[0, 1]$. The velocity field $v(x,t) = A \\sin(k x - \\omega t)$ is evaluated over $N_t=200$ time steps covering one full period $T$.\n-   **Metric 1 (Noise-free Peak Sensor)**: The velocity field is defined at a representative time (e.g., $t=0$). The divergence, $\\partial_x v$, is computed using the specified second-order central difference stencil with periodic boundary conditions. The sensor field $S(x)$ is calculated, and its maximum value across the domain is found. Since the wave profile translates without change, this peak value is constant for all time.\n-   **Metrics 4  5 (Activation Toggles)**: A time series of the domain-maximum sensor value, $s_{\\max}(t)$, is generated over $N_t$ time steps. At each step, the analytical divergence $\\partial_x v = Ak\\cos(kx-\\omega t)$ is computed, and Gaussian noise with standard deviation $\\sigma_{\\text{div}} = 0.2\\,A\\,k$ is added. The noisy sensor field is computed, and its maximum value $s_{\\max, \\text{noisy}}(t)$ is recorded.\n    -   **Naive Activation**: The activation state $a_{\\text{plain}}(t)$ is determined by comparing $s_{\\max, \\text{noisy}}(t)$ to the threshold $\\alpha_{\\text{plain}} = 0.06$. The number of times the state changes, i.e., $a_{\\text{plain}}(t) \\neq a_{\\text{plain}}(t-1)$, is counted.\n    -   **Hysteretic Activation**: A filtered sensor value $s_f(t)$ is updated using the rule $s_f(t) = s_f(t-\\Delta t) + \\frac{\\Delta t}{\\tau}(s_{\\max, \\text{noisy}}(t) - s_f(t-\\Delta t))$, starting with $s_f=0$. The filter coefficient is $\\frac{\\Delta t}{\\tau} = \\frac{T/N_t}{0.02\\,T} = \\frac{1/200}{0.02} = 0.25$. The hysteretic state $a_{\\text{hyst}}(t)$ switches on when $s_f(t) \\ge \\alpha_{\\text{on}}=0.07$ and off when $s_f(t) \\le \\alpha_{\\text{off}}=0.035$. The number of toggles is counted.\n\n**Test Case 2: 2D Steady Taylor-Green Vortex**\nA 2D grid is set up with $N_x \\times N_y = 64 \\times 64$. The steady velocity field $(v_x, v_y)$ is divergence-free in the continuum.\n-   **Metric 2 (Noise-free Peak Sensor)**: The velocity components are defined on the grid. The divergence $\\nabla \\cdot \\mathbf{v}$ is computed numerically. For a uniform grid and the given central difference scheme, the numerical divergence is also identically zero. Consequently, the sensor value $S$ is zero everywhere, and its maximum is $0$.\n-   **Metrics 6  7 (Activation Toggles)**: $N_t=200$ noisy samples are generated. For each sample, the base numerical divergence (which is zero) has Gaussian noise with $\\sigma_{\\text{div}} = (\\sigma_S c_s) / \\Delta x = (0.004 \\cdot 1) / (1/64) = 0.256$ added. The maximum of the resulting sensor field, $s_{\\max, \\text{noisy}}$, is found.\n    -   **Naive Activation**: Toggles are counted by comparing $s_{\\max, \\text{noisy}}$ to $\\alpha_{\\text{plain}}=0.003$.\n    -   **Hysteretic Activation**: The filter is applied to the series of $s_{\\max, \\text{noisy}}$ values. The parameter $\\tau=0.02$ \"in units of the sampling interval\" implies a filter where the update coefficient $\\Delta t/\\tau$ is taken as $0.02$, as any other interpretation leads to an unstable filter. The thresholds are $\\alpha_{\\text{on}}=0.005$ and $\\alpha_{\\text{off}}=0.0025$. Toggles are counted.\n\n**Test Case 3: 1D Uniform Flow**\nThe velocity is constant, $v(x) = U_0$.\n-   **Metric 3 (Noise-free Peak Sensor)**: The numerical divergence of a constant field using a central difference stencil is exactly zero. Thus, the sensor value is zero everywhere, and its maximum is $0$.\n\nThe following code implements this logic to compute the seven required metrics.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and assesses a divergence-based shock sensor\n    for artificial viscosity in computational astrophysics.\n    \"\"\"\n    # Use a fixed seed for reproducibility of noisy results\n    np.random.seed(42)\n\n    # --- Sensor Definition ---\n    def calculate_sensor(divergence, h, cs):\n        \"\"\"Calculates the dimensionless shock sensor S.\"\"\"\n        return np.maximum(0, -h * divergence / cs)\n\n    # --- Numerical Differentiation ---\n    def div_1d(v, dx):\n        \"\"\"Computes 1D divergence (dv/dx) with 2nd-order central differences.\"\"\"\n        return (np.roll(v, -1) - np.roll(v, 1)) / (2 * dx)\n\n    def div_2d(vx, vy, dx, dy):\n        \"\"\"Computes 2D divergence with 2nd-order central differences.\"\"\"\n        dvx_dx = (np.roll(vx, -1, axis=1) - np.roll(vx, 1, axis=1)) / (2 * dx)\n        dvy_dy = (np.roll(vy, -1, axis=0) - np.roll(vy, 1, axis=0)) / (2 * dy)\n        return dvx_dx + dvy_dy\n\n    # --- Toggle Counting Utility ---\n    def count_toggles(activation_series):\n        \"\"\"Counts the number of state changes in a boolean/binary series.\"\"\"\n        return np.sum(activation_series[1:] != activation_series[:-1])\n\n    # --- Test Case 1: 1D Compressive Sound Wave ---\n    def run_case_1():\n        # Parameters\n        L, cs = 1.0, 1.0\n        Nx = 64\n        dx = L / Nx\n        A, k = 0.8, 2 * np.pi\n        omega = cs * k\n        T = 2 * np.pi / omega\n        Nt = 200\n        dt = T / Nt\n        \n        x = np.linspace(0, L, Nx, endpoint=False)\n        times = np.linspace(0, T, Nt, endpoint=False)\n\n        # Metric 1: Peak domain-maximum sensor (noise-free)\n        # The wave just translates, so we can check at t=0.\n        v_t0 = A * np.sin(k * x)\n        div_v_numeric = div_1d(v_t0, dx)\n        s_field_numeric = calculate_sensor(div_v_numeric, dx, cs)\n        peak_sensor_wave = np.max(s_field_numeric)\n\n        # Metrics 4  5: Activation Toggles (noisy)\n        sigma_div = 0.2 * A * k\n        alpha_plain = 0.06\n        tau = 0.02 * T\n        filter_coeff = dt / tau\n        alpha_on, alpha_off = 0.07, 0.035\n\n        s_max_noisy_series = np.zeros(Nt)\n        for i, t in enumerate(times):\n            div_v_analytical = A * k * np.cos(k * x - omega * t)\n            noise = np.random.normal(0, sigma_div, size=Nx)\n            noisy_div = div_v_analytical + noise\n            s_noisy = calculate_sensor(noisy_div, dx, cs)\n            s_max_noisy_series[i] = np.max(s_noisy)\n\n        # Naive activation\n        activation_plain = s_max_noisy_series = alpha_plain\n        toggles_plain_wave = count_toggles(activation_plain)\n\n        # Hysteretic activation\n        activation_hyst = np.zeros(Nt, dtype=bool)\n        s_f = 0.0\n        current_state = False\n        for i in range(Nt):\n            s_f += filter_coeff * (s_max_noisy_series[i] - s_f)\n            if s_f = alpha_on:\n                current_state = True\n            elif s_f = alpha_off:\n                current_state = False\n            activation_hyst[i] = current_state\n        toggles_hyst_wave = count_toggles(activation_hyst)\n\n        return peak_sensor_wave, toggles_plain_wave, toggles_hyst_wave\n\n    # --- Test Case 2: 2D Steady Taylor-Green Vortex ---\n    def run_case_2():\n        # Parameters\n        L, cs = 1.0, 1.0\n        Nx = Ny = 64\n        dx = dy = L / Nx\n        V0, k = 1.0, 2.0 * np.pi\n        Nt = 200\n\n        x = y = np.linspace(0, L, Nx, endpoint=False)\n        xx, yy = np.meshgrid(x, y)\n\n        # Metric 2: Peak domain-maximum sensor (noise-free)\n        vx = V0 * np.sin(k * xx) * np.cos(k * yy)\n        vy = -V0 * np.cos(k * xx) * np.sin(k * yy)\n        # For this setup with central differences, the numerical divergence is zero\n        div_v_numeric = div_2d(vx, vy, dx, dy)\n        s_field_numeric = calculate_sensor(div_v_numeric, dx, cs)\n        peak_sensor_vortex = np.max(s_field_numeric)\n\n        # Metrics 6  7: Activation Toggles (noisy)\n        sigma_S = 0.004\n        sigma_div = sigma_S * cs / dx\n        alpha_plain = 0.003\n        \n        # As reasoned in the solution, an unstable filter arises from a literal\n        # reading of tau. The coefficient (dt/tau) must be what is specified.\n        filter_coeff = 0.02\n        alpha_on, alpha_off = 0.005, 0.0025\n\n        s_max_noisy_series = np.zeros(Nt)\n        base_div = div_v_numeric # This is a zero field\n        for i in range(Nt):\n            noise = np.random.normal(0, sigma_div, size=(Ny, Nx))\n            noisy_div = base_div + noise\n            s_noisy = calculate_sensor(noisy_div, dx, cs)\n            s_max_noisy_series[i] = np.max(s_noisy)\n\n        # Naive activation\n        activation_plain = s_max_noisy_series = alpha_plain\n        toggles_plain_vortex = count_toggles(activation_plain)\n        \n        # Hysteretic activation\n        activation_hyst = np.zeros(Nt, dtype=bool)\n        s_f = 0.0\n        current_state = False\n        for i in range(Nt):\n            s_f += filter_coeff * (s_max_noisy_series[i] - s_f)\n            if s_f = alpha_on:\n                current_state = True\n            elif s_f = alpha_off:\n                current_state = False\n            activation_hyst[i] = current_state\n        toggles_hyst_vortex = count_toggles(activation_hyst)\n\n        return peak_sensor_vortex, toggles_plain_vortex, toggles_hyst_vortex\n\n    # --- Test Case 3: Uniform Flow ---\n    def run_case_3():\n        # Parameters\n        L, cs = 1.0, 1.0\n        Nx = 64\n        dx = L / Nx\n        U0 = 1.0\n\n        # Metric 3: Domain-maximum sensor (noise-free)\n        v = np.full(Nx, U0)\n        div_v_numeric = div_1d(v, dx) # Will be exactly zero\n        s_field = calculate_sensor(div_v_numeric, dx, cs)\n        peak_sensor_uniform = np.max(s_field)\n\n        return peak_sensor_uniform\n\n    # --- Execute all cases and collect results ---\n    peak_sensor_wave, toggles_plain_wave, toggles_hyst_wave = run_case_1()\n    peak_sensor_vortex, toggles_plain_vortex, toggles_hyst_vortex = run_case_2()\n    peak_sensor_uniform = run_case_3()\n    \n    results = [\n        peak_sensor_wave,\n        peak_sensor_vortex,\n        peak_sensor_uniform,\n        toggles_plain_wave,\n        toggles_hyst_wave,\n        toggles_plain_vortex,\n        toggles_hyst_vortex\n    ]\n\n    # Format and print the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}