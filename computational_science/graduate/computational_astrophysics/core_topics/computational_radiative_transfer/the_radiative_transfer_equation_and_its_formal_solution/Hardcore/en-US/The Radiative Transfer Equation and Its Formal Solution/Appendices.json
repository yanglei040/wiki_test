{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex numerical simulations, it is essential to master the analytical solution of the radiative transfer equation for simple cases. This foundational exercise  challenges you to derive the emergent intensity from first principles for a medium where the source function varies linearly with optical depth. Successfully completing this integration by hand provides a concrete understanding of how the formal solution acts as a weighted average of the source function along the line of sight.",
            "id": "3540918",
            "problem": "Consider a plane-parallel, stationary medium at fixed frequency $\\nu$, with optical depth $\\tau_{\\nu}$ measured inward from the surface toward the far boundary so that $\\tau_{\\nu}=0$ at the emergent surface and $\\tau_{\\nu}=T$ at the far end of the ray. Along a single ray directed outward with direction cosine $\\mu=1$, the specific intensity $I_{\\nu}(\\tau_{\\nu})$ obeys the radiative transfer equation (RTE), which in terms of optical depth is $d I_{\\nu}/d \\tau_{\\nu} = I_{\\nu} - S_{\\nu}$, where $S_{\\nu}(\\tau_{\\nu})$ is the source function. Assume the boundary condition $I_{\\nu}(T)=0$ at the far end (no incident radiation from that direction). The source function varies linearly with optical depth as $S_{\\nu}(\\tau_{\\nu})=a+b\\,\\tau_{\\nu}$, where $a$ and $b$ are constants independent of $\\tau_{\\nu}$.\n\nStarting only from the definition of optical depth and the RTE, derive the appropriate formal solution and carry out the integration to obtain a closed-form analytic expression for the emergent specific intensity $I_{\\nu}(0)$ in terms of $a$, $b$, and $T$. Express your final result symbolically; no numerical evaluation or rounding is required. Your final answer must be a single closed-form expression.",
            "solution": "The problem is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Medium**: A plane-parallel, stationary medium at a fixed frequency $\\nu$.\n- **Optical Depth Coordinate**: $\\tau_{\\nu}$ is measured inward from the surface.\n- **Surface Condition**: $\\tau_{\\nu}=0$ at the emergent surface.\n- **Far Boundary Condition**: $\\tau_{\\nu}=T$ at the far end of the ray.\n- **Ray Direction**: The ray is directed outward with direction cosine $\\mu=1$.\n- **Radiative Transfer Equation (RTE)**: The specific intensity $I_{\\nu}(\\tau_{\\nu})$ obeys $\\frac{d I_{\\nu}}{d \\tau_{\\nu}} = I_{\\nu} - S_{\\nu}$.\n- **Boundary Condition at Far End**: $I_{\\nu}(T)=0$.\n- **Source Function**: $S_{\\nu}(\\tau_{\\nu})$ varies linearly with optical depth as $S_{\\nu}(\\tau_{\\nu})=a+b\\,\\tau_{\\nu}$.\n- **Constants**: $a$ and $b$ are constants independent of $\\tau_{\\nu}$.\n- **Objective**: Derive a closed-form analytic expression for the emergent specific intensity $I_{\\nu}(0)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective.\n1.  **Scientific Soundness**: The problem describes a canonical scenario in radiative transfer theory. The given Radiative Transfer Equation, $\\frac{dI_{\\nu}}{d\\tau_{\\nu}} = I_{\\nu} - S_{\\nu}$, is the correct form for an outward-propagating ray ($\\mu=1$) in a plane-parallel atmosphere where the optical depth $\\tau_{\\nu}$ is defined to increase into the medium. The linear source function $S_{\\nu}(\\tau_{\\nu}) = a+b\\,\\tau_{\\nu}$ is a standard and useful approximation (the first-order Taylor expansion of the source function).\n2.  **Well-Posedness**: The problem provides a first-order linear ordinary differential equation with a single, well-defined boundary condition ($I_{\\nu}(T)=0$). This constitutes a well-posed initial value problem (or boundary value problem), which admits a unique solution.\n3.  **Completeness**: All necessary components—the governing equation, the form of the source function, the boundary condition, and the coordinate system—are explicitly defined. The problem is self-contained.\n4.  **Clarity**: The terminology used is standard in astrophysics and physics. There is no ambiguity in the definitions or the goal.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be derived.\n\nThe radiative transfer equation for a ray with direction cosine $\\mu=1$ is given as:\n$$\n\\frac{d I_{\\nu}}{d \\tau_{\\nu}} = I_{\\nu} - S_{\\nu}\n$$\nThis is a first-order linear inhomogeneous ordinary differential equation. We can rewrite it in the standard form:\n$$\n\\frac{d I_{\\nu}}{d \\tau_{\\nu}} - I_{\\nu} = -S_{\\nu}(\\tau_{\\nu})\n$$\nTo solve this equation, we use the method of integrating factors. The integrating factor $P(\\tau_{\\nu})$ is:\n$$\nP(\\tau_{\\nu}) = \\exp\\left(\\int (-1) d\\tau_{\\nu}\\right) = \\exp(-\\tau_{\\nu})\n$$\nMultiplying the entire equation by the integrating factor $\\exp(-\\tau_{\\nu})$ gives:\n$$\n\\exp(-\\tau_{\\nu})\\frac{d I_{\\nu}}{d \\tau_{\\nu}} - \\exp(-\\tau_{\\nu}) I_{\\nu} = -S_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu})\n$$\nThe left-hand side can be recognized as the derivative of a product, using the product rule for differentiation:\n$$\n\\frac{d}{d \\tau_{\\nu}} \\left(I_{\\nu}(\\tau_{\\nu}) \\exp(-\\tau_{\\nu})\\right) = -S_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu})\n$$\nTo find the formal solution, we integrate this equation from the boundary at $\\tau'_{\\nu}=T$ to an arbitrary point $\\tau_{\\nu}$. We use $\\tau'_{\\nu}$ as the integration variable to avoid confusion with the limit of integration $\\tau_{\\nu}$.\n$$\n\\int_{T}^{\\tau_{\\nu}} \\frac{d}{d \\tau'_{\\nu}} \\left(I_{\\nu}(\\tau'_{\\nu}) \\exp(-\\tau'_{\\nu})\\right) d\\tau'_{\\nu} = \\int_{T}^{\\tau_{\\nu}} -S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nApplying the fundamental theorem of calculus to the left side:\n$$\n\\left[ I_{\\nu}(\\tau'_{\\nu}) \\exp(-\\tau'_{\\nu}) \\right]_{T}^{\\tau_{\\nu}} = I_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu}) - I_{\\nu}(T)\\exp(-T)\n$$\nEquating this to the right side gives:\n$$\nI_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu}) - I_{\\nu}(T)\\exp(-T) = -\\int_{T}^{\\tau_{\\nu}} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nWe apply the given boundary condition $I_{\\nu}(T)=0$:\n$$\nI_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu}) = \\int_{\\tau_{\\nu}}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nwhere we have reversed the limits of integration to absorb the negative sign. Solving for $I_{\\nu}(\\tau_{\\nu})$:\n$$\nI_{\\nu}(\\tau_{\\nu}) = \\exp(\\tau_{\\nu}) \\int_{\\tau_{\\nu}}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\int_{\\tau_{\\nu}}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-(\\tau'_{\\nu}-\\tau_{\\nu})) d\\tau'_{\\nu}\n$$\nThis is the formal solution. We are asked to find the emergent specific intensity, which is $I_{\\nu}(0)$. We set $\\tau_{\\nu}=0$:\n$$\nI_{\\nu}(0) = \\int_{0}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nNow, we substitute the given linear source function $S_{\\nu}(\\tau'_{\\nu}) = a + b\\,\\tau'_{\\nu}$:\n$$\nI_{\\nu}(0) = \\int_{0}^{T} (a + b\\,\\tau'_{\\nu}) \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nWe can split this integral into two parts:\n$$\nI_{\\nu}(0) = a \\int_{0}^{T} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} + b \\int_{0}^{T} \\tau'_{\\nu} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nThe first integral is straightforward:\n$$\n\\int_{0}^{T} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\left[ -\\exp(-\\tau'_{\\nu}) \\right]_{0}^{T} = -\\exp(-T) - (-\\exp(0)) = 1 - \\exp(-T)\n$$\nThe second integral requires integration by parts, $\\int u \\, dv = uv - \\int v \\, du$. Let $u = \\tau'_{\\nu}$ and $dv = \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}$. Then $du = d\\tau'_{\\nu}$ and $v = -\\exp(-\\tau'_{\\nu})$.\n$$\n\\int \\tau'_{\\nu} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\tau'_{\\nu} (-\\exp(-\\tau'_{\\nu})) - \\int (-\\exp(-\\tau'_{\\nu})) d\\tau'_{\\nu} = -\\tau'_{\\nu}\\exp(-\\tau'_{\\nu}) + \\int \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\nCarrying out the last integration gives the indefinite integral:\n$$\n-\\tau'_{\\nu}\\exp(-\\tau'_{\\nu}) - \\exp(-\\tau'_{\\nu}) = -(\\tau'_{\\nu}+1)\\exp(-\\tau'_{\\nu})\n$$\nNow, we evaluate the definite integral from $0$ to $T$:\n$$\n\\int_{0}^{T} \\tau'_{\\nu} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\left[ -(\\tau'_{\\nu}+1)\\exp(-\\tau'_{\\nu}) \\right]_{0}^{T}\n$$\n$$\n= \\left( -(T+1)\\exp(-T) \\right) - \\left( -(0+1)\\exp(0) \\right)\n$$\n$$\n= -(T+1)\\exp(-T) + 1 = 1 - (T+1)\\exp(-T)\n$$\nCombining the results for the two parts, we have:\n$$\nI_{\\nu}(0) = a(1 - \\exp(-T)) + b(1 - (T+1)\\exp(-T))\n$$\nExpanding and collecting terms provides a simplified expression:\n$$\nI_{\\nu}(0) = a - a\\exp(-T) + b - b\\exp(-T) - bT\\exp(-T)\n$$\n$$\nI_{\\nu}(0) = a + b - (a + b + bT)\\exp(-T)\n$$\nThis is the final closed-form expression for the emergent specific intensity.",
            "answer": "$$\n\\boxed{a+b - (a+b+bT)\\exp(-T)}\n$$"
        },
        {
            "introduction": "The Eddington-Barbier relation provides a powerful shortcut for estimating emergent intensity, but when does this approximation hold? This computational practice  asks you to explore the limits of this relation by numerically computing the exact formal solution for various challenging source functions, including sharp discontinuities and spikes. By comparing the exact integral to the simple approximation, you will develop a practical intuition for why and by how much the approximation fails when the source function is not a slowly varying function of optical depth.",
            "id": "3540949",
            "problem": "You are asked to examine the approximation quality of the Eddington–Barbier relation, which states that the emergent specific intensity $I_\\nu(\\mu)$ from a plane-parallel atmosphere is approximately given by the source function $S_\\nu(\\tau_\\nu)$ evaluated at optical depth equal to the angle cosine, $I_\\nu(\\mu) \\approx S_\\nu(\\tau_\\nu = \\mu)$. The goal is to quantify and understand when and by how much this approximation deviates from the formal solution of the radiative transfer equation.\n\nStarting from the radiative transfer equation in a static, plane-parallel medium with no incident radiation at the top boundary,\n$$\n\\mu \\frac{d I_\\nu(\\tau_\\nu, \\mu)}{d \\tau_\\nu} = I_\\nu(\\tau_\\nu, \\mu) - S_\\nu(\\tau_\\nu),\n$$\nderive the formal solution for the emergent specific intensity $I_\\nu(0, \\mu)$ at the surface $\\tau_\\nu = 0$ in terms of the source function $S_\\nu(\\tau_\\nu)$ and the optical depth $\\tau_\\nu$. Use that formal solution to compute $I_\\nu(\\mu)$ numerically for several sharply featured source functions $S_\\nu(\\tau_\\nu)$ and compare it to $S_\\nu(\\tau_\\nu=\\mu)$.\n\nYour program must implement:\n- The derived formal solution for $I_\\nu(\\mu)$ at the surface as an integral over $\\tau_\\nu$.\n- A set of source functions $S_\\nu(\\tau_\\nu)$ that include sharp features (discontinuities, narrow spikes, and rapidly oscillating components).\n- The Eddington–Barbier approximation $S_\\nu(\\tau_\\nu=\\mu)$.\n- The absolute deviation $\\Delta(\\mu) = \\left| I_\\nu(\\mu) - S_\\nu(\\tau_\\nu=\\mu) \\right|$ for each test case.\n\nAll quantities in this problem can be treated as dimensionless, and no physical units are required. Angles are represented by their cosines $\\mu$, which are dimensionless numbers in the interval $[0, 1]$.\n\nImplement the following test suite. For each case, compute the absolute deviation $\\Delta(\\mu)$ as defined above.\n\n- Case $1$ (linear baseline, exact scenario):\n  $$\n  S(\\tau) = a + b \\tau,\\quad a = 1.0,\\quad b = 0.5,\\quad \\mu = 0.7.\n  $$\n- Case $2$ (step discontinuity with $\\mu  \\tau_0$):\n  $$\n  S(\\tau) =\n  \\begin{cases}\n  s_0  \\text{if } \\tau  \\tau_0,\\\\\n  s_1  \\text{if } \\tau \\ge \\tau_0,\n  \\end{cases}\n  \\quad s_0 = 1.0,\\quad s_1 = 2.0,\\quad \\tau_0 = 0.2,\\quad \\mu = 0.1.\n  $$\n- Case $3$ (step discontinuity with $\\mu = \\tau_0$):\n  $$\n  S(\\tau) =\n  \\begin{cases}\n  s_0  \\text{if } \\tau  \\tau_0,\\\\\n  s_1  \\text{if } \\tau \\ge \\tau_0,\n  \\end{cases}\n  \\quad s_0 = 1.0,\\quad s_1 = 2.0,\\quad \\tau_0 = 0.2,\\quad \\mu = 0.2,\n  $$\n  and for the evaluation $S(\\mu)$ at the discontinuity, use $S(\\tau \\ge \\tau_0)$.\n- Case $4$ (narrow Gaussian spike near the surface):\n  $$\n  S(\\tau) = a + A \\exp\\left( - \\frac{(\\tau - \\tau_c)^2}{2 \\sigma^2} \\right),\\quad a = 1.0,\\quad A = 3.0,\\quad \\tau_c = 0.05,\\quad \\sigma = 0.01,\\quad \\mu = 0.1.\n  $$\n- Case $5$ (rapidly oscillating, exponentially damped component):\n  $$\n  S(\\tau) = a + A \\exp\\left( - \\frac{\\tau}{\\tau_d} \\right) \\cos(\\omega \\tau),\\quad a = 1.0,\\quad A = 1.0,\\quad \\tau_d = 0.2,\\quad \\omega = 30.0,\\quad \\mu = 0.5.\n  $$\n\nYour program should:\n- Derive and implement the formal solution for $I_\\nu(\\mu)$ at the surface based on the radiative transfer equation.\n- Numerically integrate the formal solution to machine precision for each source function using robust quadrature.\n- For each test case, compute the absolute deviation $\\Delta(\\mu)$.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each float rounded to six decimal places, in the order of the cases listed above. For example, the output format must be exactly like\n$$\n[0.000000,0.123456,0.654321,0.111111,0.222222].\n$$",
            "solution": "The user-provided problem has been analyzed according to the specified validation protocol.\n\n### Step 1: Extract Givens\n- **Governing Equation**: The radiative transfer equation in a static, plane-parallel medium: $\\mu \\frac{d I_\\nu(\\tau_\\nu, \\mu)}{d \\tau_\\nu} = I_\\nu(\\tau_\\nu, \\mu) - S_\\nu(\\tau_\\nu)$.\n- **Boundary Condition**: No incident radiation at the top boundary ($\\tau_\\nu=0$). The medium is treated as semi-infinite.\n- **Approximation to Test**: The Eddington–Barbier relation, $I_\\nu(\\mu) \\approx S_\\nu(\\tau_\\nu = \\mu)$. $I_\\nu(\\mu)$ here denotes the emergent specific intensity at the surface, $I_\\nu(0, \\mu)$.\n- **Quantity to Compute**: The absolute deviation $\\Delta(\\mu) = \\left| I_\\nu(\\mu) - S_\\nu(\\tau_\\nu=\\mu) \\right|$.\n- **Test Cases**:\n    - **Case 1**: $S(\\tau) = a + b \\tau$, with $a = 1.0$, $b = 0.5$, $\\mu = 0.7$.\n    - **Case 2**: $S(\\tau) = \\begin{cases} s_0  \\text{if } \\tau  \\tau_0, \\\\ s_1  \\text{if } \\tau \\ge \\tau_0, \\end{cases}$ with $s_0 = 1.0$, $s_1 = 2.0$, $\\tau_0 = 0.2$, $\\mu = 0.1$.\n    - **Case 3**: Same $S(\\tau)$ as Case $2$, with $s_0 = 1.0$, $s_1 = 2.0$, $\\tau_0 = 0.2$, $\\mu = 0.2$. For the evaluation $S(\\mu)$, use $S(\\tau \\ge \\tau_0)$.\n    - **Case 4**: $S(\\tau) = a + A \\exp\\left( - \\frac{(\\tau - \\tau_c)^2}{2 \\sigma^2} \\right)$, with $a = 1.0$, $A = 3.0$, $\\tau_c = 0.05$, $\\sigma = 0.01$, $\\mu = 0.1$.\n    - **Case 5**: $S(\\tau) = a + A \\exp\\left( - \\frac{\\tau}{\\tau_d} \\right) \\cos(\\omega \\tau)$, with $a = 1.0$, $A = 1.0$, $\\tau_d = 0.2$, $\\omega = 30.0$, $\\mu = 0.5$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed as follows:\n- **Scientifically Grounded**: The problem is based on the fundamental radiative transfer equation, a cornerstone of astrophysics. The Eddington-Barbier relation is a standard, well-established approximation. The analysis requested is a typical textbook exercise to understand the limits of this approximation. All concepts are scientifically sound.\n- **Well-Posed**: The problem is clearly defined. The governing equation, boundary conditions, and source functions are all specified, leading to a unique solution for the emergent intensity. The numerical task is well-defined.\n- **Objective**: The problem is stated in precise mathematical and physical terms, free of subjectivity or ambiguity.\n- **Completeness**: All necessary parameters for each test case are provided.\n- **No other invalidating flaws** are detected.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution Design\nThe core of the problem is to compare the exact formal solution for the emergent specific intensity, $I_\\nu(\\mu)$, with its Eddington-Barbier approximation, $S_\\nu(\\tau_\\nu=\\mu)$. We begin by deriving the formal solution.\n\n**Derivation of the Formal Solution**\n\nThe radiative transfer equation is given as:\n$$\n\\mu \\frac{d I_\\nu(\\tau_\\nu, \\mu)}{d \\tau_\\nu} = I_\\nu(\\tau_\\nu, \\mu) - S_\\nu(\\tau_\\nu)\n$$\nFor brevity, we drop the subscript $\\nu$. This is a first-order linear ordinary differential equation, which can be rearranged to the standard form $\\frac{dI}{d\\tau} + P(\\tau)I = Q(\\tau)$:\n$$\n\\frac{d I}{d \\tau} - \\frac{1}{\\mu} I = -\\frac{1}{\\mu} S(\\tau)\n$$\nThe integrating factor is $M(\\tau) = \\exp\\left(\\int -\\frac{1}{\\mu} d\\tau\\right) = e^{-\\tau/\\mu}$. Multiplying the equation by $M(\\tau)$ yields:\n$$\ne^{-\\tau/\\mu} \\frac{d I}{d \\tau} - \\frac{1}{\\mu} e^{-\\tau/\\mu} I = -\\frac{1}{\\mu} e^{-\\tau/\\mu} S(\\tau)\n$$\nThe left-hand side is the derivative of the product $I(\\tau, \\mu) e^{-\\tau/\\mu}$:\n$$\n\\frac{d}{d \\tau} \\left( I(\\tau, \\mu) e^{-\\tau/\\mu} \\right) = -\\frac{1}{\\mu} S(\\tau) e^{-\\tau/\\mu}\n$$\nTo find the emergent intensity $I(0, \\mu)$ for outward-directed radiation ($\\mu  0$), we integrate from a great depth ($\\tau \\to \\infty$) to the surface ($\\tau = 0$).\n$$\n\\int_{\\infty}^0 \\frac{d}{dt} \\left( I(t, \\mu) e^{-t/\\mu} \\right) dt = \\int_{\\infty}^0 \\left( -\\frac{1}{\\mu} S(t) e^{-t/\\mu} \\right) dt\n$$\n$$\n\\left[ I(t, \\mu) e^{-t/\\mu} \\right]_{\\infty}^0 = \\frac{1}{\\mu} \\int_0^{\\infty} S(t) e^{-t/\\mu} dt\n$$\nEvaluating the left side gives $I(0, \\mu) e^0 - \\lim_{t \\to \\infty} I(t, \\mu) e^{-t/\\mu}$. The limit term vanishes for a semi-infinite atmosphere, as any physically realistic intensity source deep in the star will be completely attenuated by the infinite optical depth. Thus, the formal solution for the emergent intensity at the surface is:\n$$\nI(\\mu) \\equiv I(0, \\mu) = \\int_0^\\infty S(\\tau) e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu}\n$$\nThis equation shows that the emergent intensity is a weighted average of the source function over all depths. The weighting function, $\\frac{e^{-\\tau/\\mu}}{\\mu}$, is known as the contribution function. It has a mean depth of $\\int_0^\\infty \\tau \\frac{e^{-\\tau/\\mu}}{\\mu} d\\tau = \\mu$. This is the basis of the Eddington-Barbier approximation: if $S(\\tau)$ is a slowly varying function, it can be taken out of the integral and evaluated at this mean depth, i.e., $I(\\mu) \\approx S(\\tau=\\mu) \\int_0^\\infty e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu} = S(\\tau=\\mu)$.\n\n**Numerical Implementation**\n\nThe program will compute $I(\\mu)$ by numerically integrating the formal solution using the `scipy.integrate.quad` function, which is a robust tool for numerical quadrature. For each test case, we define the specific source function $S(\\tau)$ and the parameters. The absolute deviation $\\Delta(\\mu) = |I(\\mu) - S(\\tau=\\mu)|$ is then calculated.\n\n- **Case 1 (Linear)**: $S(\\tau) = a + b\\tau$. For any linear source function, the Eddington-Barbier relation is exact. The formal solution gives $I(\\mu) = \\int_0^\\infty (a+b\\tau) e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu} = a+b\\mu$, which is identical to $S(\\tau=\\mu)$. Therefore, $\\Delta(\\mu)$ must be $0$ (within machine precision). This serves as a validation of the numerical integrator.\n\n- **Case 2  3 (Step Discontinuity)**: The source function has a sudden jump. The integral for $I(\\mu)$ provides a smoothed value, averaging contributions from before and after the jump, weighted by the exponential kernel. The approximation $S(\\tau=\\mu)$, however, abruptly switches from $s_0$ to $s_1$ as $\\mu$ crosses $\\tau_0$. The deviation $\\Delta(\\mu)$ will be significant, especially near the discontinuity. For Case $3$, $\\mu = \\tau_0$, and the approximation is defined as $S(\\mu) = s_1$. The integral, however, includes contributions from $\\tau  \\tau_0$ where $S(\\tau)=s_0$. The resulting deviation is large: $I(\\mu) = s_0 + (s_1-s_0)e^{-\\tau_0/\\mu} = 1+(2-1)e^{-1} \\approx 1.368$, while $S(\\mu)=2$, giving $\\Delta \\approx 0.632$.\n\n- **Case 4 (Narrow Gaussian Spike)**: The source function has a very sharp, localized feature. The kernel $e^{-\\tau/\\mu}$ has an effective width of $\\mu$. Here $\\mu=0.1$ is much larger than the spike's width $\\sigma=0.01$. The integral for $I(\\mu)$ will \"smooth over\" the spike, yielding a value close to the baseline $a=1.0$ with a small contribution from the spike. The approximation $S(\\tau=\\mu)=S(0.1)$, however, evaluates the source function far in the tail of the Gaussian, resulting in a value very close to $a=1.0$. The deviation arises from the integrated (but attenuated) contribution of the peak, which is not captured by the simple point evaluation.\n\n- **Case 5 (Rapid Oscillation)**: The source function oscillates rapidly. The integral averages over these oscillations, effectively damping them. The result for $I(\\mu)$ will be close to the mean value of the source function, which is $a=1.0$. The approximation $S(\\mu)$, however, picks the value of the source function at a specific phase of the cosine, which can be far from the mean. This leads to a notable deviation. For $\\mu=0.5$ and $\\omega=30$, $S(0.5)$ evaluates $\\cos(15)$, which is significantly different from its average value of $0$.\n\nThe implementation will define each source function and its parameters, compute the numerical integral for $I(\\mu)$, evaluate $S(\\mu)$, calculate the absolute deviation $\\Delta(\\mu)$, and format the results as required. For the discontinuous source function cases, the integral is split at the point of discontinuity $\\tau_0$ to ensure numerical accuracy.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes the absolute deviation of the Eddington-Barbier approximation\n    for several test cases of source functions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"id\": 1,\n            \"type\": \"linear\",\n            \"params\": {\"a\": 1.0, \"b\": 0.5},\n            \"mu\": 0.7\n        },\n        {\n            \"id\": 2,\n            \"type\": \"step\",\n            \"params\": {\"s0\": 1.0, \"s1\": 2.0, \"tau0\": 0.2},\n            \"mu\": 0.1\n        },\n        {\n            \"id\": 3,\n            \"type\": \"step\",\n            \"params\": {\"s0\": 1.0, \"s1\": 2.0, \"tau0\": 0.2},\n            \"mu\": 0.2\n        },\n        {\n            \"id\": 4,\n            \"type\": \"gaussian\",\n            \"params\": {\"a\": 1.0, \"A\": 3.0, \"tau_c\": 0.05, \"sigma\": 0.01},\n            \"mu\": 0.1\n        },\n        {\n            \"id\": 5,\n            \"type\": \"oscillating\",\n            \"params\": {\"a\": 1.0, \"A\": 1.0, \"tau_d\": 0.2, \"omega\": 30.0},\n            \"mu\": 0.5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        mu = case[\"mu\"]\n        params = case[\"params\"]\n        \n        # Define source function S(tau) based on the case type\n        if case[\"type\"] == \"linear\":\n            def s_func(tau):\n                return params[\"a\"] + params[\"b\"] * tau\n        elif case[\"type\"] == \"step\":\n            def s_func(tau):\n                return params[\"s0\"] if tau  params[\"tau0\"] else params[\"s1\"]\n        elif case[\"type\"] == \"gaussian\":\n            def s_func(tau):\n                return params[\"a\"] + params[\"A\"] * np.exp(\n                    -((tau - params[\"tau_c\"])**2) / (2 * params[\"sigma\"]**2)\n                )\n        elif case[\"type\"] == \"oscillating\":\n            def s_func(tau):\n                return params[\"a\"] + params[\"A\"] * np.exp(\n                    -tau / params[\"tau_d\"]\n                ) * np.cos(params[\"omega\"] * tau)\n        \n        # Integrand for the formal solution of I(mu)\n        integrand = lambda tau: s_func(tau) * np.exp(-tau / mu) / mu\n        \n        # Compute the formal solution I(mu) via numerical integration\n        if case[\"type\"] == \"step\":\n            # For discontinuous functions, split the integral at the point of\n            # discontinuity for better accuracy.\n            tau0 = params[\"tau0\"]\n            integral1, _ = integrate.quad(integrand, 0, tau0)\n            integral2, _ = integrate.quad(integrand, tau0, np.inf)\n            i_formal = integral1 + integral2\n        else:\n            i_formal, _ = integrate.quad(integrand, 0, np.inf)\n\n        # Compute the Eddington-Barbier approximation S(tau=mu)\n        # Special handling for case 3 at the discontinuity\n        if case[\"id\"] == 3:\n            s_approx = params[\"s1\"] # As specified: S(tau = tau0)\n        else:\n            s_approx = s_func(mu)\n            \n        # Compute the absolute deviation\n        deviation = abs(i_formal - s_approx)\n        results.append(deviation)\n\n    # Format the final output string as required\n    output_str = f\"[{','.join(f'{r:.6f}' for r in results)}]\"\n    print(output_str)\n\nsolve()\n\n```"
        },
        {
            "introduction": "Radiative transfer becomes more complex in dynamic environments like stellar winds, where large velocity gradients dominate the physics. This advanced exercise  guides you through a numerical experiment to assess the accuracy of the powerful Sobolev approximation for a resonance line formed in a spherically expanding wind. By implementing both a full formal solution and the Sobolev approximation, you will gain invaluable hands-on experience with modeling P Cygni profiles and understanding the physical conditions that justify the Large Velocity Gradient (LVG) approach.",
            "id": "3540922",
            "problem": "You are asked to design and implement a numerical experiment in computational astrophysics to assess the accuracy of the Sobolev approximation for a single, isolated resonance line formed in a spherically symmetric, monotonically accelerating stellar wind. The objective is to compare the emergent specific intensity computed from the full radiative transfer equation to that computed using the Sobolev approximation, and to report a dimensionless error metric for several well-chosen test cases.\n\nThe fundamental base must be the one-dimensional radiative transfer equation along a ray,\n$$\n\\frac{d I_\\nu}{d s} = - \\chi_\\nu(\\nu, r) I_\\nu + \\eta_\\nu(\\nu, r),\n$$\nwith the source function defined as $S_\\nu(\\nu,r) \\equiv \\eta_\\nu(\\nu,r) / \\chi_\\nu(\\nu,r)$. In this task, the line is pure resonance with a constant source function $S_\\nu(\\nu,r) = S_0$ (independent of $r$ and $\\nu$), and there is no background continuum ($I_\\nu$ at the inner boundary is zero).\n\nGeometry and kinematics:\n- The wind is spherically symmetric with stellar radius $R_\\star$ and extends to an outer radius $R_{\\max}$.\n- Along a radial ray (impact parameter $p=0$), the radius is $r = s$ and the line-of-sight projection of the velocity equals the radial velocity, $v_{\\parallel}(r) = v(r)$.\n- The velocity law follows a standard \"beta-law\" \n$$\nv(r) = v_\\infty \\left(1 - \\frac{R_\\star}{r}\\right)^\\beta,\n$$\nfor $r \\ge R_\\star$, with $v_\\infty$ the terminal velocity and $\\beta$ a positive exponent.\n\nLine opacity:\n- The line frequency is $\\nu_0$.\n- The comoving-frame frequency seen by material moving at speed $v_\\parallel(r)$ is approximated non-relativistically by \n$$\n\\nu'(\\nu, r) = \\nu \\left(1 - \\frac{v_\\parallel(r)}{c}\\right),\n$$\nwhere $c$ is the speed of light.\n- The frequency-dependent extinction coefficient along the ray is modeled with a Gaussian centered at $\\nu_0$ and normalized to unity at the line center,\n$$\n\\chi_\\nu(\\nu, r) = \\chi_0 \\exp\\left(-\\left[\\frac{\\nu'(\\nu,r) - \\nu_0}{\\Delta \\nu_D}\\right]^2\\right),\n$$\nwhere $\\chi_0$ is the line-center extinction coefficient (units of inverse length), and $\\Delta \\nu_D = \\nu_0 v_{\\mathrm{th}}/c$ is the Doppler width associated with a thermal speed $v_{\\mathrm{th}}$.\n\nYou must compute two emergent intensity estimates at the outer boundary $r = R_{\\max}$ for specified $\\nu$:\n1. A \"full formal solution\" obtained by numerically integrating the radiative transfer equation along the radial ray from $r=R_\\star$ to $r=R_{\\max}$ with $I_\\nu(R_\\star) = 0$. Use a first-order exact update on each spatial step under the assumption that $\\chi_\\nu$ and $S_\\nu$ are locally constant over the step. In other words, discretize the path into small segments and apply the exact attenuation-emission update on each segment to advance $I_\\nu$.\n2. A \"Sobolev approximation\" intensity computed by evaluating the local Sobolev optical depth at the resonance point (if such a point exists along the ray) using the monotonic velocity gradient and the Gaussian line described above, and then treating the interaction as a local absorption-emission event with the constant source function $S_0$. If no resonance point lies within $[R_\\star, R_{\\max}]$, then the Sobolev intensity should be treated as zero.\n\nYour program must implement the following components in scientifically consistent units:\n- Units: use SI units throughout. Frequencies $\\nu$ and $\\nu_0$ in $\\mathrm{Hz}$, distances in $\\mathrm{m}$, speeds in $\\mathrm{m/s}$, and extinction $\\chi_0$ in $\\mathrm{m}^{-1}$. The source function $S_0$ may be treated as dimensionless by reporting intensities normalized to $S_0$.\n- The formal solution: numerical path integration for $I_\\nu(R_{\\max})$, with the piecewise-exact attenuate-and-emit update, using a sufficiently fine spatial grid to ensure convergence.\n- The Sobolev approximation: locate the resonance point along the ray by solving $\\nu'(r) = \\nu_0$, equivalently \n$$\nv(r_{\\mathrm{res}}) = c \\left(1 - \\frac{\\nu_0}{\\nu}\\right),\n$$\nfor $\\nu  \\nu_0$ along the near-side radial ray. If $r_{\\mathrm{res}} \\notin [R_\\star, R_{\\max}]$, there is no resonance inside the wind. Use the spherical beta-law derivative\n$$\n\\frac{d v}{d r} = v_\\infty \\beta \\frac{R_\\star}{r^2} \\left(1 - \\frac{R_\\star}{r}\\right)^{\\beta - 1},\n$$\nand the Gaussian line model specified above to construct the Sobolev optical depth at the resonance point. Then compute the Sobolev intensity for the constant source function case.\n\nError metric specification:\n- For each test case, compute a dimensionless symmetric relative error \n$$\n\\varepsilon = \\frac{2 \\left| I_{\\nu,\\mathrm{Sob}} - I_{\\nu,\\mathrm{full}} \\right|}{\\left| I_{\\nu,\\mathrm{Sob}} \\right| + \\left| I_{\\nu,\\mathrm{full}} \\right|},\n$$\nwith the convention that $\\varepsilon = 0$ if both intensities are exactly zero. Report the error using intensities normalized by $S_0$ so that the error is dimensionless.\n\nTest suite:\nUse the following three scientifically plausible test cases that probe different regimes:\n- Case A (typical, single resonance inside wind): \n  $v_\\infty = 2.0 \\times 10^{6}\\ \\mathrm{m/s}$, $\\beta = 1.0$, $R_\\star = 7.0 \\times 10^{9}\\ \\mathrm{m}$, $R_{\\max} = 3.5 \\times 10^{11}\\ \\mathrm{m}$, \n  $\\chi_0 = 3.0 \\times 10^{-8}\\ \\mathrm{m}^{-1}$, $v_{\\mathrm{th}} = 1.0 \\times 10^{4}\\ \\mathrm{m/s}$, \n  $S_0 = 1.0$ (dimensionless normalization), $\\nu_0 = 1.0 \\times 10^{15}\\ \\mathrm{Hz}$, \n  $\\nu = 1.001 \\times 10^{15}\\ \\mathrm{Hz}$.\n- Case B (near terminal speed resonance, large Sobolev depth):\n  same parameters except $\\nu = 1.0065 \\times 10^{15}\\ \\mathrm{Hz}$.\n- Case C (no resonance inside wind):\n  same parameters except $\\nu = 1.008 \\times 10^{15}\\ \\mathrm{Hz}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[resultA,resultB,resultC]\"), where each entry is the value of $\\varepsilon$ (a decimal float) for the corresponding test case, in the order A, B, C. Intensities are implicitly normalized to $S_0$, so the errors are dimensionless. No units should be printed in the output.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of radiative transfer in astrophysics, well-posed with a complete and consistent set of definitions and parameters, and expressed in objective, formal language. The task requires a direct comparison between a numerical solution of the radiative transfer equation and the widely used Sobolev approximation, which constitutes a standard and meaningful problem in computational astrophysics.\n\nHerein, a detailed solution is developed, outlining the physical principles and the numerical algorithms required to perform the specified computation.\n\n### Governing Principles and Model Setup\n\nThe physical system under consideration is a spherically symmetric, accelerating stellar wind. The transfer of radiation through this medium is described by the one-dimensional radiative transfer equation (RTE) along a line of sight (a ray):\n$$\n\\frac{d I_\\nu}{d s} = \\eta_\\nu - \\chi_\\nu I_\\nu\n$$\nwhere $s$ is the path length along the ray, $I_\\nu$ is the specific intensity at frequency $\\nu$, $\\eta_\\nu$ is the emissivity, and $\\chi_\\nu$ is the extinction coefficient. It is convenient to define the source function $S_\\nu = \\eta_\\nu / \\chi_\\nu$. The problem specifies a constant source function $S_\\nu = S_0$ for a pure resonance line and no background continuum radiation, meaning the intensity at the base of the wind is zero ($I_\\nu(r=R_\\star) = 0$). For simplicity and as specified, we normalize all intensities by $S_0$, effectively setting $S_0=1$.\n\nThe problem is simplified to a radial ray from the observer, such that the path length coordinate $s$ is identical to the radial coordinate $r$. The line-of-sight velocity of the gas $v_\\parallel(r)$ is simply the radial wind velocity $v(r)$. This velocity follows the standard beta-law:\n$$\nv(r) = v_\\infty \\left(1 - \\frac{R_\\star}{r}\\right)^\\beta\n$$\nfor $r \\ge R_\\star$, where $v_\\infty$ is the terminal velocity, $R_\\star$ is the stellar radius, and $\\beta$ is a model parameter.\n\nThe interaction between radiation and matter is confined to a single spectral line with rest frequency $\\nu_0$. Due to the motion of the gas, a photon of frequency $\\nu$ in the observer's frame is seen at a Doppler-shifted frequency $\\nu'$ in the comoving frame of the gas:\n$$\n\\nu'(\\nu, r) = \\nu \\left(1 - \\frac{v(r)}{c}\\right)\n$$\nThe extinction coefficient $\\chi_\\nu$ is given by a Gaussian profile centered on $\\nu_0$, representing thermal broadening:\n$$\n\\chi_\\nu(\\nu, r) = \\chi_0 \\exp\\left(-\\left[\\frac{\\nu'(\\nu,r) - \\nu_0}{\\Delta \\nu_D}\\right]^2\\right)\n$$\nwhere $\\chi_0$ is the line-center opacity, and $\\Delta \\nu_D = \\nu_0 v_{\\mathrm{th}}/c$ is the Doppler width corresponding to a thermal velocity $v_{\\mathrm{th}}$.\n\n### Full Formal Solution by Numerical Integration\n\nThe first method is a direct numerical integration of the RTE. We discretize the radial path from $r=R_\\star$ to $r=R_{\\max}$ into a series of small segments. For each segment from $r_i$ to $r_{i+1}$ of length $\\Delta r_i = r_{i+1} - r_i$, we assume the extinction coefficient $\\chi_\\nu$ and source function $S_0$ are constant. The optical depth of the segment is $\\Delta \\tau_{\\nu,i} = \\chi_\\nu(\\tilde{r}_i) \\Delta r_i$, where $\\tilde{r}_i$ is the midpoint radius.\n\nThe RTE, $dI_\\nu/d\\tau_\\nu = -I_\\nu + S_0$, has an exact solution over a segment of constant properties:\n$$\nI_\\nu(r_{i+1}) = I_\\nu(r_i) e^{-\\Delta \\tau_{\\nu,i}} + S_0 \\left(1 - e^{-\\Delta \\tau_{\\nu,i}}\\right)\n$$\nStarting with the boundary condition $I_\\nu(R_\\star) = 0$, we apply this update rule iteratively for each segment until we reach the outer boundary $R_{\\max}$. The final intensity $I_\\nu(R_{\\max})$ is the \"full formal solution\" $I_{\\nu,\\mathrm{full}}$. To ensure accuracy, particularly in regions where physical properties change rapidly (i.e., near the star), a logarithmic spatial grid is used, which provides higher resolution at smaller radii.\n\n### Sobolev Approximation\n\nThe Sobolev (or Large Velocity Gradient, LVG) approximation simplifies the radiative transfer problem by assuming that the velocity gradient $|dv/dr|$ is large. This implies that the region over which a gas parcel can interact with a photon of a given frequency is very small (the \"resonance zone\"). The optical depth integral is then evaluated locally at this resonance point, $r_{\\mathrm{res}}$.\n\nA resonance occurs at the radius $r_{\\mathrm{res}}$ where the comoving-frame frequency $\\nu'$ matches the line's rest frequency $\\nu_0$:\n$$\n\\nu'\\left(\\nu, r_{\\mathrm{res}}\\right) = \\nu_0 \\implies v(r_{\\mathrm{res}}) = c \\left(1 - \\frac{\\nu_0}{\\nu}\\right)\n$$\nThis equation is solved for $r_{\\mathrm{res}}$ by inverting the beta-law velocity profile. For the case $\\beta=1$:\n$$\nr_{\\mathrm{res}} = R_\\star \\left(1 - \\frac{v(r_{\\mathrm{res}})}{v_\\infty}\\right)^{-1}\n$$\nA physically meaningful resonance point must satisfy $R_\\star \\le r_{\\mathrm{res}} \\le R_{\\max}$ and $0  v(r_{\\mathrm{res}})  v_\\infty$. If these conditions are not met, no resonance occurs within the wind, and the Sobolev approximation predicts zero interaction, so $I_{\\nu,\\mathrm{Sob}} = 0$.\n\nIf a valid resonance point exists, the Sobolev optical depth, $\\tau_{\\mathrm{Sob}}$, is calculated. By re-parameterizing the optical depth integral in terms of velocity and assuming the velocity gradient is constant across the narrow resonance zone, one can derive:\n$$\n\\tau_{\\mathrm{Sob}} = \\int \\chi_\\nu ds \\approx \\frac{1}{|dv/dr|_{r_{\\mathrm{res}}}} \\int_{-\\infty}^{\\infty} \\chi_0 \\exp\\left(-\\left(\\frac{\\delta v}{v_{\\mathrm{th}}}\\right)^2\\right) d(\\delta v) = \\frac{\\sqrt{\\pi} \\, \\chi_0 v_{\\mathrm{th}}}{|dv/dr|_{r_{\\mathrm{res}}}}\n$$\nwhere the velocity gradient for the beta-law is given by:\n$$\n\\frac{dv}{dr} = v_\\infty \\beta \\frac{R_\\star}{r^2} \\left(1 - \\frac{R_\\star}{r}\\right)^{\\beta - 1}\n$$\nWith the Sobolev optical depth, the emergent intensity (for zero background intensity) is:\n$$\nI_{\\nu,\\mathrm{Sob}} = S_0 \\left(1 - e^{-\\tau_{\\mathrm{Sob}}}\\right)\n$$\n\n### Error Metric\n\nThe accuracy of the Sobolev approximation is quantified by the dimensionless symmetric relative error $\\varepsilon$ between the normalized intensities from the two methods:\n$$\n\\varepsilon = \\frac{2 \\left| I_{\\nu,\\mathrm{Sob}} - I_{\\nu,\\mathrm{full}} \\right|}{\\left| I_{\\nu,\\mathrm{Sob}} \\right| + \\left| I_{\\nu,\\mathrm{full}} \\right|}\n$$\nThis metric ranges from $0$ (perfect agreement) to $2$ (maximal disagreement, e.g., one value is zero while the other is non-zero). By convention, if both intensities are zero, $\\varepsilon=0$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.constants import c\n\ndef solve():\n    \"\"\"\n    Main function to solve the radiative transfer problem for the specified test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"case\": \"A\",\n            \"v_inf\": 2.0e6,  # m/s\n            \"beta\": 1.0,\n            \"R_star\": 7.0e9,  # m\n            \"R_max\": 3.5e11,  # m\n            \"chi_0\": 3.0e-8,  # m^-1\n            \"v_th\": 1.0e4,  # m/s\n            \"S_0\": 1.0,  # Dimensionless\n            \"nu_0\": 1.0e15,  # Hz\n            \"nu\": 1.001e15,  # Hz\n        },\n        {\n            \"case\": \"B\",\n            \"v_inf\": 2.0e6,\n            \"beta\": 1.0,\n            \"R_star\": 7.0e9,\n            \"R_max\": 3.5e11,\n            \"chi_0\": 3.0e-8,\n            \"v_th\": 1.0e4,\n            \"S_0\": 1.0,\n            \"nu_0\": 1.0e15,\n            \"nu\": 1.0065e15,\n        },\n        {\n            \"case\": \"C\",\n            \"v_inf\": 2.0e6,\n            \"beta\": 1.0,\n            \"R_star\": 7.0e9,\n            \"R_max\": 3.5e11,\n            \"chi_0\": 3.0e-8,\n            \"v_th\": 1.0e4,\n            \"S_0\": 1.0,\n            \"nu_0\": 1.0e15,\n            \"nu\": 1.008e15,\n        },\n    ]\n\n    def v_law(r, p):\n        \"\"\"Beta-velocity law.\"\"\"\n        # Prevent division by zero or negative arguments for r  R_star\n        # The problem statement guarantees r = R_star.\n        term = 1.0 - p[\"R_star\"] / r\n        return p[\"v_inf\"] * (term**p[\"beta\"])\n\n    def dv_dr_law(r, p):\n        \"\"\"Derivative of the beta-velocity law.\"\"\"\n        term1 = p[\"v_inf\"] * p[\"beta\"] * p[\"R_star\"] / (r**2)\n        term2 = (1.0 - p[\"R_star\"] / r)**(p[\"beta\"] - 1.0)\n        return term1 * term2\n\n    def calculate_full_intensity(p, n_steps=200000):\n        \"\"\"\n        Calculates the emergent intensity using the full formal solution.\n        A fine logarithmic grid is used for numerical stability and accuracy.\n        \"\"\"\n        r_grid = np.logspace(np.log10(p[\"R_star\"]), np.log10(p[\"R_max\"]), n_steps)\n        dr = np.diff(r_grid)\n        r_mid = r_grid[:-1] + dr / 2.0\n\n        delta_nu_D = p[\"nu_0\"] * p[\"v_th\"] / c\n        intensity = 0.0\n\n        # Vectorized calculation for efficiency\n        vel_mid = v_law(r_mid, p)\n        nu_prime = p[\"nu\"] * (1.0 - vel_mid / c)\n        \n        exponent = -((nu_prime - p[\"nu_0\"]) / delta_nu_D)**2\n        chi_nu_mid = p[\"chi_0\"] * np.exp(exponent)\n        \n        delta_tau = chi_nu_mid * dr\n        \n        # Iterative update (cannot be fully vectorized due to sequential dependency)\n        for d_tau in delta_tau:\n            exp_neg_dtau = np.exp(-d_tau)\n            intensity = intensity * exp_neg_dtau + p[\"S_0\"] * (1.0 - exp_neg_dtau)\n\n        return intensity\n\n    def calculate_sobolev_intensity(p):\n        \"\"\"Calculates the emergent intensity using the Sobolev approximation.\"\"\"\n        v_req = c * (1.0 - p[\"nu_0\"] / p[\"nu\"])\n\n        if not (0  v_req  p[\"v_inf\"]):\n            return 0.0\n\n        # Invert the velocity law to find r_res\n        # v_req = v_inf * (1 - R_star/r_res)^beta\n        # (v_req/v_inf)^(1/beta) = 1 - R_star/r_res\n        # r_res = R_star / (1 - (v_req/v_inf)^(1/beta))\n        r_res = p[\"R_star\"] / (1.0 - (v_req / p[\"v_inf\"])**(1.0 / p[\"beta\"]))\n\n        if not (p[\"R_star\"] = r_res = p[\"R_max\"]):\n            return 0.0\n\n        dv_dr = dv_dr_law(r_res, p)\n        \n        # The velocity gradient must be positive for the wind to be accelerating.\n        if dv_dr = 0:\n            return 0.0\n\n        tau_sob = (np.sqrt(np.pi) * p[\"chi_0\"] * p[\"v_th\"]) / dv_dr\n        \n        intensity_sob = p[\"S_0\"] * (1.0 - np.exp(-tau_sob))\n        return intensity_sob\n\n    results = []\n    for params in test_cases:\n        I_full = calculate_full_intensity(params)\n        I_sob = calculate_sobolev_intensity(params)\n\n        numerator = 2.0 * abs(I_sob - I_full)\n        denominator = abs(I_sob) + abs(I_full)\n\n        if denominator == 0.0:\n            error = 0.0\n        else:\n            error = numerator / denominator\n        \n        results.append(error)\n\n    # Format the final output as specified.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}