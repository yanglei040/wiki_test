{
    "hands_on_practices": [
        {
            "introduction": "To begin our practical exploration, we will calculate the second-order energy correction for a non-degenerate system. This correction, $E^{(2)}$, is a cornerstone of perturbation theory, quantifying how a state's energy is shifted due to its coupling with other states. This exercise  applies the standard formula $E_n^{(2)} = \\sum_{k \\neq n} \\frac{|\\langle k|\\hat{V}|n\\rangle|^2}{E_n^{(0)} - E_k^{(0)}}$ to a concrete nuclear shell-model problem, helping to solidify the physical meaning of the matrix elements and energy denominators that govern this fundamental quantum mechanical effect.",
            "id": "3609922",
            "problem": "Consider a spherical shell-model Hamiltonian for a medium-mass nucleus written as $\\hat{H}=\\hat{H}_{0}+\\hat{V}_{\\mathrm{res}}$, where $\\hat{H}_{0}$ is a mean-field one-body Hamiltonian that defines the unperturbed single-particle orbitals and energies, and $\\hat{V}_{\\mathrm{res}}$ is a residual two-body interaction. Focus on a single valence neutron occupying an orbital in the $\\mathit{sd}$ shell, denoted by the unperturbed many-body eigenstate $\\left|n\\right\\rangle$ with energy $E_{n}^{(0)}$ of $\\hat{H}_{0}$. The residual interaction $\\hat{V}_{\\mathrm{res}}$ couples $\\left|n\\right\\rangle$ to a set of orthonormal $\\mathit{pf}$-shell excited many-body states $\\{\\left|\\alpha_{k}\\right\\rangle\\}$ of $\\hat{H}_{0}$ with unperturbed energies $E_{\\alpha_{k}}^{(0)}$. Assume the diagonal matrix element of the residual interaction in the reference state vanishes, i.e., $\\langle n|\\hat{V}_{\\mathrm{res}}|n\\rangle=0$, so that the first-order energy correction to $E_{n}^{(0)}$ is zero.\n\nFor a computational estimate, you are provided the following data for four relevant $\\mathit{pf}$-shell excited states that dominantly mix with $\\left|n\\right\\rangle$:\n\n- Energy gaps relative to the reference state: $\\Delta_{k}\\equiv E_{\\alpha_{k}}^{(0)}-E_{n}^{(0)}$ with values\n  $$\n  \\Delta_{1}=6.7\\ \\mathrm{MeV},\\quad \\Delta_{2}=5.6\\ \\mathrm{MeV},\\quad \\Delta_{3}=7.3\\ \\mathrm{MeV},\\quad \\Delta_{4}=9.1\\ \\mathrm{MeV}.\n  $$\n- Two-Body Matrix Elements (TBME) representing the full coupling amplitudes (including angular-momentum recoupling) of the residual interaction between the reference state and each excited state,\n  $$\n  V_{n\\alpha_{1}}=+0.18\\ \\mathrm{MeV},\\quad V_{n\\alpha_{2}}=+0.24\\ \\mathrm{MeV},\\quad V_{n\\alpha_{3}}=-0.15\\ \\mathrm{MeV},\\quad V_{n\\alpha_{4}}=+0.10\\ \\mathrm{MeV},\n  $$\nwhere each $V_{n\\alpha_{k}}\\equiv\\langle\\alpha_{k}|\\hat{V}_{\\mathrm{res}}|n\\rangle$ is real.\n\nStarting from the standard foundations of time-independent non-degenerate perturbation theory for quantum many-body systems, derive the expression for the second-order correction to the energy of $\\left|n\\right\\rangle$ due to $\\hat{V}_{\\mathrm{res}}$, and then evaluate it using the data above. Express the final energy correction in megaelectronvolts ($\\mathrm{MeV}$) and round your answer to four significant figures. The final answer must be a single real-valued number.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It presents a standard exercise in applying time-independent non-degenerate perturbation theory to a nuclear shell-model context, a cornerstone of computational nuclear physics. All necessary data are provided, and the physical parameters are of a reasonable scale for such a system. The problem is therefore deemed valid.\n\nWe begin by deriving the expression for the second-order energy correction. The full Hamiltonian is given by $\\hat{H} = \\hat{H}_{0} + \\hat{V}_{\\mathrm{res}}$, where $\\hat{H}_{0}$ is the unperturbed Hamiltonian and $\\hat{V}_{\\mathrm{res}}$ is the perturbation. We seek a perturbative solution to the time-independent Schrödinger equation $\\hat{H}|\\Psi_n\\rangle = E_n |\\Psi_n\\rangle$. The unperturbed problem is defined by $\\hat{H}_{0}|m\\rangle = E_m^{(0)}|m\\rangle$, where $\\{|m\\rangle\\}$ forms a complete orthonormal basis of eigenstates.\n\nWe expand the exact energy eigenvalue $E_n$ and eigenstate $|\\Psi_n\\rangle$ as a power series in a formal parameter $\\lambda$, where the full Hamiltonian is written as $\\hat{H} = \\hat{H}_{0} + \\lambda \\hat{V}_{\\mathrm{res}}$.\n$$E_n = E_n^{(0)} + \\lambda E_n^{(1)} + \\lambda^2 E_n^{(2)} + \\mathcal{O}(\\lambda^3)$$\n$$|\\Psi_n\\rangle = |n\\rangle + \\lambda |\\Psi_n^{(1)}\\rangle + \\lambda^2 |\\Psi_n^{(2)}\\rangle + \\mathcal{O}(\\lambda^3)$$\nSubstituting these expansions into the Schrödinger equation $(\\hat{H}_{0} + \\lambda \\hat{V}_{\\mathrm{res}})|\\Psi_n\\rangle = E_n |\\Psi_n\\rangle$ and collecting terms of the same order in $\\lambda$ yields a hierarchy of equations.\n\nThe zeroth-order equation is $\\hat{H}_{0}|n\\rangle = E_n^{(0)}|n\\rangle$, which is satisfied by definition.\n\nThe first-order equation is:\n$$\\hat{H}_{0}|\\Psi_n^{(1)}\\rangle + \\hat{V}_{\\mathrm{res}}|n\\rangle = E_n^{(0)}|\\Psi_n^{(1)}\\rangle + E_n^{(1)}|n\\rangle$$\nTo find the first-order energy correction $E_n^{(1)}$, we project this equation onto the unperturbed state $\\langle n|$:\n$$\\langle n| \\hat{H}_{0}|\\Psi_n^{(1)}\\rangle + \\langle n| \\hat{V}_{\\mathrm{res}}|n\\rangle = E_n^{(0)}\\langle n|\\Psi_n^{(1)}\\rangle + E_n^{(1)}\\langle n|n\\rangle$$\nSince $\\hat{H}_{0}$ is Hermitian, $\\langle n|\\hat{H}_{0} = E_n^{(0)}\\langle n|$. Using this and the normalization $\\langle n|n\\rangle = 1$, the equation simplifies to:\n$$E_n^{(0)}\\langle n|\\Psi_n^{(1)}\\rangle + \\langle n| \\hat{V}_{\\mathrm{res}}|n\\rangle = E_n^{(0)}\\langle n|\\Psi_n^{(1)}\\rangle + E_n^{(1)}$$\nThis gives the standard result $E_n^{(1)} = \\langle n| \\hat{V}_{\\mathrm{res}}|n\\rangle$. The problem statement specifies that this term is zero.\n\nThe second-order equation is:\n$$\\hat{H}_{0}|\\Psi_n^{(2)}\\rangle + \\hat{V}_{\\mathrm{res}}|\\Psi_n^{(1)}\\rangle = E_n^{(0)}|\\Psi_n^{(2)}\\rangle + E_n^{(1)}|\\Psi_n^{(1)}\\rangle + E_n^{(2)}|n\\rangle$$\nProjecting onto $\\langle n|$ gives:\n$$\\langle n|\\hat{H}_{0}|\\Psi_n^{(2)}\\rangle + \\langle n|\\hat{V}_{\\mathrm{res}}|\\Psi_n^{(1)}\\rangle = E_n^{(0)}\\langle n|\\Psi_n^{(2)}\\rangle + E_n^{(1)}\\langle n|\\Psi_n^{(1)}\\rangle + E_n^{(2)}\\langle n|n\\rangle$$\nAgain, using $\\langle n|\\hat{H}_{0} = E_n^{(0)}\\langle n|$ and $\\langle n|n\\rangle=1$, we find:\n$$E_n^{(2)} = \\langle n|\\hat{V}_{\\mathrm{res}}|\\Psi_n^{(1)}\\rangle - E_n^{(1)}\\langle n|\\Psi_n^{(1)}\\rangle$$\nSince we are given $E_n^{(1)} = 0$, the second-order energy correction is simplified to $E_n^{(2)} = \\langle n|\\hat{V}_{\\mathrm{res}}|\\Psi_n^{(1)}\\rangle$.\n\nTo proceed, we need an expression for the first-order correction to the state, $|\\Psi_n^{(1)}\\rangle$. We expand it in the complete basis of unperturbed eigenstates $\\{|m\\rangle\\}$:\n$$|\\Psi_n^{(1)}\\rangle = \\sum_{m} c_m |m\\rangle = \\sum_{m \\neq n} c_m |m\\rangle$$\nThe coefficient for $|n\\rangle$ is taken to be zero, which corresponds to the intermediate normalization convention $\\langle n|\\Psi_n\\rangle = 1$. Substituting this expansion into the first-order equation $(\\hat{H}_{0} - E_n^{(0)})|\\Psi_n^{(1)}\\rangle = (E_n^{(1)} - \\hat{V}_{\\mathrm{res}})|n\\rangle$ and using $E_n^{(1)} = 0$, we get:\n$$\\sum_{m \\neq n} c_m (\\hat{H}_{0} - E_n^{(0)}) |m\\rangle = -\\hat{V}_{\\mathrm{res}}|n\\rangle$$\n$$\\sum_{m \\neq n} c_m (E_m^{(0)} - E_n^{(0)}) |m\\rangle = -\\hat{V}_{\\mathrm{res}}|n\\rangle$$\nProjecting onto an arbitrary state $\\langle k|$ for $k \\neq n$:\n$$c_k (E_k^{(0)} - E_n^{(0)}) = -\\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle \\implies c_k = \\frac{\\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle}{E_n^{(0)} - E_k^{(0)}}$$\nNow we substitute $|\\Psi_n^{(1)}\\rangle = \\sum_{k \\neq n} \\frac{\\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle}{E_n^{(0)} - E_k^{(0)}} |k\\rangle$ into the expression for $E_n^{(2)}$:\n$$E_n^{(2)} = \\langle n| \\hat{V}_{\\mathrm{res}} \\left( \\sum_{k \\neq n} \\frac{\\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle}{E_n^{(0)} - E_k^{(0)}} |k\\rangle \\right) = \\sum_{k \\neq n} \\frac{\\langle n|\\hat{V}_{\\mathrm{res}}|k\\rangle \\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle}{E_n^{(0)} - E_k^{(0)}}$$\nSince $\\hat{V}_{\\mathrm{res}}$ is a Hermitian operator, $\\langle n|\\hat{V}_{\\mathrm{res}}|k\\rangle = \\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle^*$. Therefore, the numerator is $|\\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle|^2$. The derived expression for the second-order energy correction is:\n$$E_n^{(2)} = \\sum_{k \\neq n} \\frac{|\\langle k|\\hat{V}_{\\mathrm{res}}|n\\rangle|^2}{E_n^{(0)} - E_k^{(0)}}$$\nThe problem states that only a specific set of four excited states, $\\{\\left|\\alpha_{k}\\right\\rangle\\}_{k=1}^4$, contribute significantly. We thus approximate the sum over all states $k \\neq n$ with a sum over these four states.\nThe given matrix elements are $V_{n\\alpha_{k}} \\equiv \\langle\\alpha_{k}|\\hat{V}_{\\mathrm{res}}|n\\rangle$, which are real. Thus, $|\\langle\\alpha_k|\\hat{V}_{\\mathrm{res}}|n\\rangle|^2 = V_{n\\alpha_k}^2$.\nThe energy denominators are given as $\\Delta_{k} \\equiv E_{\\alpha_{k}}^{(0)} - E_{n}^{(0)}$. Note that $E_n^{(0)} - E_{\\alpha_k}^{(0)} = -\\Delta_k$.\nThe expression for the energy correction becomes:\n$$E_{n}^{(2)} = \\sum_{k=1}^{4} \\frac{V_{n\\alpha_{k}}^2}{E_{n}^{(0)} - E_{\\alpha_{k}}^{(0)}} = -\\sum_{k=1}^{4} \\frac{V_{n\\alpha_{k}}^2}{\\Delta_{k}}$$\nWe now substitute the provided numerical values into this formula. All quantities are in units of $\\mathrm{MeV}$.\n$$E_{n}^{(2)} = - \\left( \\frac{(+0.18)^2}{6.7} + \\frac{(+0.24)^2}{5.6} + \\frac{(-0.15)^2}{7.3} + \\frac{(+0.10)^2}{9.1} \\right)$$\n$$E_{n}^{(2)} = - \\left( \\frac{0.0324}{6.7} + \\frac{0.0576}{5.6} + \\frac{0.0225}{7.3} + \\frac{0.0100}{9.1} \\right) \\, \\mathrm{MeV}$$\nCalculating each term:\n$$ \\frac{0.0324}{6.7} \\approx 0.00483582 \\, \\mathrm{MeV} $$\n$$ \\frac{0.0576}{5.6} \\approx 0.01028571 \\, \\mathrm{MeV} $$\n$$ \\frac{0.0225}{7.3} \\approx 0.00308219 \\, \\mathrm{MeV} $$\n$$ \\frac{0.0100}{9.1} \\approx 0.00109890 \\, \\mathrm{MeV} $$\nSumming these contributions:\n$$ \\sum_{k=1}^{4} \\frac{V_{n\\alpha_{k}}^2}{\\Delta_{k}} \\approx 0.00483582 + 0.01028571 + 0.00308219 + 0.00109890 \\approx 0.01930262 \\, \\mathrm{MeV} $$\nThe second-order energy correction is the negative of this sum:\n$$ E_{n}^{(2)} \\approx -0.01930262 \\, \\mathrm{MeV} $$\nThe problem requires the answer to be rounded to four significant figures. The first non-zero digit is $1$ in the hundredths place. The next three digits are $9$, $3$, and $0$. The fifth significant digit is $2$, which is less than $5$, so we round down.\n$$ E_{n}^{(2)} \\approx -0.01930 \\, \\mathrm{MeV} $$",
            "answer": "$$\\boxed{-0.01930}$$"
        },
        {
            "introduction": "Real quantum systems often feature degeneracies, where multiple states share the same unperturbed energy. In this scenario, standard non-degenerate perturbation theory fails. This practice  guides you through implementing the correct procedure: diagonalizing the perturbation matrix within the degenerate subspace to find the first-order energy splittings and the \"good\" basis states. Mastering this technique is essential for correctly treating systems with symmetries and is a key step toward constructing more sophisticated effective Hamiltonians.",
            "id": "3609934",
            "problem": "Consider a time-independent Hamiltonian $H = H_0 + \\lambda V$ acting in a finite-dimensional Hilbert space that models low-lying configurations of the $pf$-shell in the nucleus $^{48}\\mathrm{Ca}$. Assume $\\lambda$ is a small, dimensionless bookkeeping parameter and set $\\lambda = 1$ for numerical evaluation. Let the unperturbed Hamiltonian $H_0$ possess a degenerate subspace $S = \\{ \\lvert \\alpha \\rangle \\}_{\\alpha=1}^{d}$ with common energy $E_{\\mathrm{S}}$ such that $H_0 \\lvert \\alpha \\rangle = E_{\\mathrm{S}} \\lvert \\alpha \\rangle$ for all $\\alpha \\in \\{1,\\dots,d\\}$. Let the orthogonal complement $Q$ be spanned by states $\\{ \\lvert r \\rangle \\}$ with $H_0 \\lvert r \\rangle = E_r \\lvert r \\rangle$ and $E_r \\neq E_{\\mathrm{S}}$. The perturbation $V$ is Hermitian and specified by its matrix elements within $S$ and couplings from $S$ to $Q$:\n- $V_{SS}$, a $d \\times d$ Hermitian matrix with entries $V_{\\alpha \\beta} = \\langle \\alpha \\lvert V \\rvert \\beta \\rangle$,\n- $V_{RS}$, an $n_{\\mathrm{out}} \\times d$ matrix with entries $V_{r\\alpha} = \\langle r \\lvert V \\rvert \\alpha \\rangle$,\n- and $\\langle r \\lvert V \\rvert r' \\rangle = 0$ for all $r \\neq r'$ in $Q$ (no direct perturbative coupling among $Q$-space states).\n\nUse the framework of time-independent degenerate perturbation theory to do the following for each provided test case:\n1. Diagonalize $V_{SS}$ within the degenerate subspace $S$. Let the eigenvalues be $v_k$ and the corresponding normalized eigenvectors be $\\lvert \\psi_k^{(0)} \\rangle = \\sum_{\\alpha=1}^{d} c_{k\\alpha} \\lvert \\alpha \\rangle$, with $k \\in \\{1,\\dots,d\\}$ and real coefficients $c_{k\\alpha}$.\n2. Form the first-order energy corrections $E_{\\mathrm{S}} + v_k$ for each $k$.\n3. Quantify the role of off-diagonal couplings to $Q$ through the second-order energy corrections\n$$\nE_k^{(2)} = \\sum_{r} \\frac{\\left| \\langle r \\lvert V \\rvert \\psi_k^{(0)} \\rangle \\right|^2}{E_{\\mathrm{S}} - E_r}\n= \\sum_{r} \\frac{\\left| \\sum_{\\alpha=1}^{d} c_{k\\alpha} \\, V_{r\\alpha} \\right|^2}{E_{\\mathrm{S}} - E_r} \\, ,\n$$\nand report the total corrected energies $E_k^{\\mathrm{tot}} = E_{\\mathrm{S}} + v_k + E_k^{(2)}$.\nAll energies and matrix elements are expressed in megaelectronvolts (MeV). Report all final energies in megaelectronvolts (MeV), rounded to $6$ decimal places.\n\nFundamental base and assumptions:\n- The time-independent Schrödinger equation $H \\lvert \\Psi \\rangle = E \\lvert \\Psi \\rangle$ holds.\n- The perturbation $V$ is Hermitian and small enough for perturbation theory to be applicable.\n- The degenerate subspace $S$ is exactly degenerate under $H_0$ with energy $E_{\\mathrm{S}}$; small near-degeneracy effects relevant to the $pf$-shell can be absorbed into $V_{SS}$ as diagonal entries that mimic residual monopole shifts.\n\nTest suite:\nProvide results for the following three parameter sets, chosen to probe a \"happy path\" case, a boundary case with purely second-order shifts, and a nearly-degenerate case with weak first-order mixing:\n\n- Test case $1$ (happy path):\n  - $d = 3$,\n  - $E_{\\mathrm{S}} = -8.0 \\ \\mathrm{MeV}$,\n  - $E_r$ list: $\\left[ -2.5, 1.0, 4.0, 7.5 \\right] \\ \\mathrm{MeV}$,\n  - $V_{SS} = \\begin{pmatrix}\n    0.25 & 0.10 & -0.05 \\\\\n    0.10 & -0.15 & 0.08 \\\\\n    -0.05 & 0.08 & 0.05\n    \\end{pmatrix} \\ \\mathrm{MeV}$,\n  - $V_{RS} = \\begin{pmatrix}\n    0.05 & -0.02 & 0.03 \\\\\n    -0.01 & 0.04 & -0.02 \\\\\n    0.02 & 0.00 & 0.01 \\\\\n    0.00 & -0.03 & 0.02\n    \\end{pmatrix} \\ \\mathrm{MeV}$.\n\n- Test case $2$ (boundary: no first-order splitting):\n  - $d = 2$,\n  - $E_{\\mathrm{S}} = -7.5 \\ \\mathrm{MeV}$,\n  - $E_r$ list: $\\left[ -6.0, -3.0, 0.0 \\right] \\ \\mathrm{MeV}$,\n  - $V_{SS} = \\begin{pmatrix}\n    0.0 & 0.0 \\\\\n    0.0 & 0.0\n    \\end{pmatrix} \\ \\mathrm{MeV}$,\n  - $V_{RS} = \\begin{pmatrix}\n    0.02 & -0.01 \\\\\n    0.03 & 0.00 \\\\\n    0.00 & 0.02\n    \\end{pmatrix} \\ \\mathrm{MeV}$.\n\n- Test case $3$ (nearly degenerate with weak first-order mixing):\n  - $d = 3$,\n  - $E_{\\mathrm{S}} = -8.0 \\ \\mathrm{MeV}$,\n  - $E_r$ list: $\\left[ -10.0, -6.0, -1.0 \\right] \\ \\mathrm{MeV}$,\n  - $V_{SS} = \\begin{pmatrix}\n    0.01 & 0.006 & 0.0 \\\\\n    0.006 & -0.02 & -0.004 \\\\\n    0.0 & -0.004 & 0.005\n    \\end{pmatrix} \\ \\mathrm{MeV}$,\n  - $V_{RS} = \\begin{pmatrix}\n    0.03 & 0.01 & -0.02 \\\\\n    -0.02 & 0.00 & 0.01 \\\\\n    0.01 & -0.03 & 0.00\n    \\end{pmatrix} \\ \\mathrm{MeV}$.\n\nAlgorithmic requirements:\n- For each test case, compute the eigenvalues $v_k$ and eigenvectors $c_{k\\alpha}$ of $V_{SS}$ (use an eigensolver suitable for real symmetric matrices).\n- Compute $E_k^{(2)}$ using the formula above with the given $E_r$ and $V_{RS}$.\n- Produce the total corrected energies $E_k^{\\mathrm{tot}}$ in megaelectronvolts (MeV), rounded to $6$ decimal places.\n- For each test case, output the list $\\left[ E_1^{\\mathrm{tot}}, E_2^{\\mathrm{tot}}, \\dots, E_d^{\\mathrm{tot}} \\right]$ sorted in ascending order.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of the ascending total corrected energies in megaelectronvolts (MeV), each rounded to $6$ decimal places. For example, an output for three test cases should look like $\\left[ \\left[ x_1, x_2, x_3 \\right], \\left[ y_1, y_2 \\right], \\left[ z_1, z_2, z_3 \\right] \\right]$ with all $x_i$, $y_i$, $z_i$ given as decimal floats in megaelectronvolts (MeV).",
            "solution": "The user-provided problem is a well-defined exercise in computational quantum mechanics, specifically applying time-independent degenerate perturbation theory to a model nuclear physics system. A full validation has been performed, and the problem is deemed valid as it is scientifically grounded, mathematically well-posed, objective, and self-contained.\n\nThe problem asks for the calculation of energy eigenvalues of a Hamiltonian $H = H_0 + V$ up to the second order in the perturbation $V$. The unperturbed Hamiltonian $H_0$ has a $d$-dimensional degenerate subspace $S$ with energy $E_{\\mathrm{S}}$. The standard procedure for degenerate perturbation theory is as follows.\n\n**Step 1: First-Order Correction and Zeroth-Order Wavefunctions**\n\nThe presence of degeneracy requires finding the \"good\" basis states within the degenerate subspace $S$. These are the states that diagonalize the perturbation operator $V$ projected onto $S$. This is equivalent to solving the eigenvalue equation for the $d \\times d$ matrix $V_{SS}$, whose elements are $V_{\\alpha \\beta} = \\langle \\alpha \\lvert V \\rvert \\beta \\rangle$.\n$$\nV_{SS} \\mathbf{c}_k = v_k \\mathbf{c}_k\n$$\nwhere $k \\in \\{1, 2, \\dots, d\\}$. The eigenvalues $v_k$ are the first-order corrections to the energy. The corresponding eigenvectors $\\mathbf{c}_k$ are vectors of coefficients $c_{k\\alpha}$ that define the good basis states (the zeroth-order wavefunctions):\n$$\n\\lvert \\psi_k^{(0)} \\rangle = \\sum_{\\alpha=1}^{d} c_{k\\alpha} \\lvert \\alpha \\rangle\n$$\nSince $V_{SS}$ is specified to be Hermitian (and in the test cases, real and symmetric), its eigenvalues $v_k$ are real, and its eigenvectors $\\mathbf{c}_k$ can be chosen to be orthonormal. The energy of the system, corrected to first order, is then given by:\n$$\nE_k \\approx E_{\\mathrm{S}} + v_k\n$$\nIf some or all $v_k$ are equal, the degeneracy may persist at first order and is only potentially lifted by higher-order corrections.\n\n**Step 2: Second-Order Energy Correction**\n\nThe second-order correction to the energy for the $k$-th state arises from the coupling of the good basis states $\\lvert \\psi_k^{(0)} \\rangle$ to states $\\lvert r \\rangle$ in the orthogonal complement space $Q$. The formula for this correction is:\n$$\nE_k^{(2)} = \\sum_{r \\in Q} \\frac{\\left| \\langle r \\lvert V \\rvert \\psi_k^{(0)} \\rangle \\right|^2}{E_{\\mathrm{S}} - E_r}\n$$\nSubstituting the expansion for $\\lvert \\psi_k^{(0)} \\rangle$, we get the expression provided in the problem statement:\n$$\nE_k^{(2)} = \\sum_{r} \\frac{\\left| \\sum_{\\alpha=1}^{d} c_{k\\alpha} \\langle r \\lvert V \\rvert \\alpha \\rangle \\right|^2}{E_{\\mathrm{S}} - E_r} = \\sum_{r} \\frac{\\left| \\sum_{\\alpha=1}^{d} c_{k\\alpha} V_{r\\alpha} \\right|^2}{E_{\\mathrm{S}} - E_r}\n$$\nThe term in the numerator, $\\sum_{\\alpha=1}^{d} V_{r\\alpha} c_{k\\alpha}$, can be efficiently computed for all $r$ simultaneously using a matrix-vector product. Let $V_{RS}$ be the matrix with entries $V_{r\\alpha}$ and $\\mathbf{c}_k$ be the column vector of coefficients. The vector of matrix elements $\\langle r \\lvert V \\rvert \\psi_k^{(0)} \\rangle$ is given by the product $V_{RS} \\mathbf{c}_k$.\n\n**Step 3: Total Corrected Energy**\n\nThe total energy for each state, corrected up to the second order, is the sum of the unperturbed energy, the first-order correction, and the second-order correction:\n$$\nE_k^{\\mathrm{tot}} = E_{\\mathrm{S}} + v_k + E_k^{(2)}\n$$\nThis procedure is applied to each of the three test cases provided. For each case, we first diagonalize the corresponding $V_{SS}$ matrix to find the first-order corrections $v_k$ and the coefficient vectors $\\mathbf{c}_k$. Then, using these coefficients and the provided matrices $V_{RS}$ and energies $E_r$, we compute the second-order corrections $E_k^{(2)}$. Finally, we sum all contributions to find the total energies $E_k^{\\mathrm{tot}}$, sort them in ascending order, and report the results. All quantities are in units of megaelectronvolts (MeV).\n\nThe computational implementation will leverage the `numpy` library for numerical linear algebra operations, particularly `numpy.linalg.eigh` for the robust diagonalization of the real symmetric $V_{SS}$ matrices, which guarantees real eigenvalues and a complete orthonormal set of eigenvectors.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the degenerate perturbation theory problem for the provided test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (happy path)\n        {\n            \"d\": 3,\n            \"ES\": -8.0,\n            \"Er_list\": np.array([-2.5, 1.0, 4.0, 7.5]),\n            \"VSS\": np.array([\n                [0.25, 0.10, -0.05],\n                [0.10, -0.15, 0.08],\n                [-0.05, 0.08, 0.05]\n            ]),\n            \"VRS\": np.array([\n                [0.05, -0.02, 0.03],\n                [-0.01, 0.04, -0.02],\n                [0.02, 0.00, 0.01],\n                [0.00, -0.03, 0.02]\n            ])\n        },\n        # Test case 2 (boundary: no first-order splitting)\n        {\n            \"d\": 2,\n            \"ES\": -7.5,\n            \"Er_list\": np.array([-6.0, -3.0, 0.0]),\n            \"VSS\": np.array([\n                [0.0, 0.0],\n                [0.0, 0.0]\n            ]),\n            \"VRS\": np.array([\n                [0.02, -0.01],\n                [0.03, 0.00],\n                [0.00, 0.02]\n            ])\n        },\n        # Test case 3 (nearly degenerate with weak first-order mixing)\n        {\n            \"d\": 3,\n            \"ES\": -8.0,\n            \"Er_list\": np.array([-10.0, -6.0, -1.0]),\n            \"VSS\": np.array([\n                [0.01, 0.006, 0.0],\n                [0.006, -0.02, -0.004],\n                [0.0, -0.004, 0.005]\n            ]),\n            \"VRS\": np.array([\n                [0.03, 0.01, -0.02],\n                [-0.02, 0.00, 0.01],\n                [0.01, -0.03, 0.00]\n            ])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        d = case[\"d\"]\n        ES = case[\"ES\"]\n        Er = case[\"Er_list\"]\n        VSS = case[\"VSS\"]\n        VRS = case[\"VRS\"]\n\n        # Step 1: Diagonalize VSS to get first-order corrections (v_k)\n        # and zeroth-order wavefunctions (columns of C).\n        # numpy.linalg.eigh is suitable for Hermitian (or real symmetric) matrices.\n        v_k, C = np.linalg.eigh(VSS)\n\n        case_energies = []\n        for k in range(d):\n            # First-order eigenvalue\n            first_order_correction = v_k[k]\n\n            # Zeroth-order coefficient vector c_k\n            c_k = C[:, k]\n\n            # Step 2: Calculate the second-order energy correction.\n            # The term <r|V|psi_k^(0)> = sum_alpha c_k_alpha V_r_alpha\n            # is computed via matrix-vector multiplication.\n            V_psi_k = VRS @ c_k\n            \n            # Denominators for the second-order correction sum\n            energy_denominators = ES - Er\n            \n            # Sum the terms |<r|V|psi_k>|^2 / (ES - Er)\n            second_order_correction = np.sum(np.abs(V_psi_k)**2 / energy_denominators)\n            \n            # Step 3: Calculate total corrected energy\n            total_energy = ES + first_order_correction + second_order_correction\n            case_energies.append(total_energy)\n\n        # Sort the energies in ascending order\n        case_energies.sort()\n        results.append(case_energies)\n\n    # Format the final output string according to the specifications.\n    outer_list_str = []\n    for inner_list in results:\n        # Round each energy to 6 decimal places and format as a string\n        inner_list_str = [f\"{val:.6f}\" for val in inner_list]\n        # Join the inner list elements with a comma and a space\n        outer_list_str.append(f\"[{', '.join(inner_list_str)}]\")\n    \n    # Join the outer list elements and enclose in brackets\n    final_output = f\"[{', '.join(outer_list_str)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Perturbation theory provides a powerful approximation, but its accuracy must always be validated. This final practice  establishes a complete computational workflow to benchmark second-order perturbation theory against an exact diagonalization for the pairing Hamiltonian, a cornerstone model of nuclear structure. You will not only compare the perturbative result to the exact energy but also investigate the effects of truncating the sum over intermediate states—a common and necessary approximation in large-scale calculations. This exercise provides critical hands-on experience in building, solving, and validating a quantum many-body model from first principles.",
            "id": "3609931",
            "problem": "You are asked to implement and validate a computational workflow for comparing time-independent perturbation theory against exact diagonalization for a small, tractable nuclear-structure model. The physical and algorithmic setting is as follows.\n\nModel Hamiltonian and definitions. Consider a system of identical nucleon pairs in a set of doubly-degenerate single-particle orbitals. Work strictly in the seniority-zero subspace (all particles paired), so that only pair creation and annihilation act. The Hamiltonian is split as a sum $$\\hat{H}=\\hat{H}_0+\\lambda \\hat{V},$$ where $$\\hat{H}_0=\\sum_{i=1}^{\\Omega} \\epsilon_i \\hat{N}_i$$ is the unperturbed Hamiltonian that counts pair occupation with single-particle energies $$\\epsilon_i,$$ and $$\\hat{V}=-G \\sum_{i=1}^{\\Omega} \\sum_{j=1}^{\\Omega} \\hat{P}_i^\\dagger \\hat{P}_j$$ is a constant- pairing two-body interaction with strength $$G>0.$$ Here $$\\hat{P}_i^\\dagger$$ creates a time-reversed pair in orbital $$i,$$ $$\\hat{P}_i$$ annihilates such a pair, $$\\hat{N}_i=2 \\hat{P}_i^\\dagger \\hat{P}_i$$ is the paired-number operator in orbital $$i,$$ $$\\Omega$$ is the number of active orbitals, $$\\lambda \\in \\mathbb{R}$$ is a dimensionless coupling scale, and all energies must be expressed in Mega-electronvolts (MeV). Use an equally spaced single-particle spectrum $$\\epsilon_i=(i-1)\\Delta$$ for $$i=1,\\dots,\\Omega,$$ with fixed spacing $$\\Delta.$$ The unperturbed ground state is the Slater determinant with $$N_p$$ pairs occupying the lowest $$N_p$$ orbitals at $$\\lambda=0.$$ Assume this state is non-degenerate whenever needed.\n\nValidation workflow requirements. Your program must:\n- Construct the seniority-zero basis of pair-occupation configurations for given $$\\Omega$$ and $$N_p.$$\n- Build the exact Hamiltonian matrix $$\\hat{H}=\\hat{H}_0+\\lambda \\hat{V}$$ in this basis. In this subspace, $$\\hat{H}_0$$ is diagonal with eigenvalues equal to twice the sum of occupied $$\\epsilon_i,$$ and $$\\hat{V}$$ has a diagonal contribution and connects basis states that differ by moving one pair from orbital $$j$$ to $$i.$$ Diagonalize $$\\hat{H}$$ to obtain the exact ground-state energy $$E_{\\mathrm{exact}}(\\lambda,\\Omega,N_p,G,\\Delta).$$\n- Implement non-degenerate Rayleigh–Schrödinger perturbation theory through second order about $$\\lambda=0$$ for the unperturbed ground state. The second-order correction involves a sum over intermediate states with non-zero matrix elements of $$\\hat{V}$$ connecting to the reference. To study truncation effects, you must include an intermediate-state energy cutoff $$E_{\\mathrm{cut}}\\ge 0$$ that restricts the sum to intermediate states with unperturbed excitation energy less than or equal to $$E_{\\mathrm{cut}}.$$ Denote the corresponding second-order perturbative ground-state energy by $$E_{\\mathrm{PT2}}(\\lambda,\\Omega,N_p,G,\\Delta,E_{\\mathrm{cut}}).$$\n- Compare $$E_{\\mathrm{PT2}}$$ to $$E_{\\mathrm{exact}}$$ for a set of test cases. For each case, compute the absolute error $$|E_{\\mathrm{PT2}}-E_{\\mathrm{exact}}|.$$\n\nNumerical and unit conventions. Use $\\Delta$ and $G$ given per test case. All energies must be in MeV. Your program must round every floating-point result that it outputs to exactly six decimal places. Angles are not used. Do not print units; numerical values are understood to be in MeV.\n\nTest suite. Your program must hard-code and evaluate the following seven test cases, each specified by $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})$$:\n\n- Test $$1$$ (happy path, small coupling and truncated intermediates): $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})=(6,2,1.0,0.5,0.2,1.0).$$ Output the absolute error as a float.\n- Test $$2$$ (intermediate-state truncation convergence check): Using the same $$(\\Omega,N_p,\\Delta,G,\\lambda)=(6,2,1.0,0.5,0.2),$$ compare two cutoffs $$E_{\\mathrm{cut}}=1.0$$ and $$E_{\\mathrm{cut}}=\\infty.$$ Output a boolean that is $$\\mathrm{True}$$ if and only if the absolute error with $$E_{\\mathrm{cut}}=\\infty$$ is less than or equal to the absolute error with $$E_{\\mathrm{cut}}=1.0,$$ and $$\\mathrm{False}$$ otherwise.\n- Test $$3$$ (boundary $$\\lambda=0$$): $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})=(8,3,1.0,0.7,0.0,0.5).$$ Output the absolute error as a float.\n- Test $$4$$ (basis size, smaller): $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})=(6,2,1.0,0.5,0.3,\\infty).$$ Output the absolute error as a float.\n- Test $$5$$ (basis size, larger): $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})=(8,2,1.0,0.5,0.3,\\infty).$$ Output the absolute error as a float.\n- Test $$6$$ (edge truncation $$E_{\\mathrm{cut}}=0$$): $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})=(6,2,1.0,0.5,0.2,0.0).$$ Output the absolute error as a float.\n- Test $$7$$ (stronger coupling): $$(\\Omega,N_p,\\Delta,G,\\lambda,E_{\\mathrm{cut}})=(6,2,1.0,0.5,1.0,\\infty).$$ Output the absolute error as a float.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain exactly seven entries, one per test in the order above. All floats must be rounded to six decimals. For example, a valid output format looks like $$[0.123456,\\mathrm{True},0.000000,0.111111,0.222222,0.333333,0.444444].$$ No other text may be printed.",
            "solution": "The problem is deemed valid as it presents a self-contained, scientifically grounded, and well-posed computational physics task. It is based on the standard pairing Hamiltonian model in nuclear structure theory and utilizes fundamental quantum mechanical methods, namely exact diagonalization and Rayleigh-Schrödinger perturbation theory. The parameters and objectives are clearly defined, allowing for a unique and meaningful solution.\n\nThe solution is implemented by following a principled, step-by-step procedure. The core task is to compute the ground-state energy of a model Hamiltonian using two different methods and compare the results. The Hamiltonian is given by $\\hat{H}=\\hat{H}_0+\\lambda \\hat{V}$, acting on a system of $N_p$ nucleon pairs distributed among $\\Omega$ orbitals.\n\n**1. Basis Construction**\n\nThe system is restricted to the seniority-zero subspace, where all nucleons are paired. A basis state is uniquely defined by specifying which $N_p$ of the $\\Omega$ available single-particle orbitals are occupied by a pair. We can represent each basis state $|\\Psi_k\\rangle$ by a set of occupied orbital indices $K = \\{o_1, o_2, \\dots, o_{N_p}\\}$. For a system with $\\Omega$ orbitals and $N_p$ pairs, the total number of basis states, and thus the dimension of the Hamiltonian matrix, is $D = \\binom{\\Omega}{N_p}$. These basis states are constructed computationally by generating all combinations of $N_p$ elements from the set of orbital indices $\\{0, 1, \\dots, \\Omega-1\\}$. The single-particle energies are $\\epsilon_i = (i-1)\\Delta$ for $i=1, \\dots, \\Omega$; using $0$-based indexing for orbitals $k=0, \\dots, \\Omega-1$, this becomes $\\epsilon_k = k\\Delta$.\n\n**2. Exact Hamiltonian and Diagonalization**\n\nThe full Hamiltonian matrix $\\mathbf{H}$ is constructed in this basis. The matrix elements $H_{kl} = \\langle \\Psi_k | \\hat{H} | \\Psi_l \\rangle$ are the sum of contributions from the unperturbed Hamiltonian $\\hat{H}_0$ and the interaction $\\lambda\\hat{V}$.\n\n-   **Unperturbed Hamiltonian $\\hat{H}_0$:** The problem states that $\\hat{H}_0 = \\sum_{i=1}^{\\Omega} \\epsilon_i \\hat{N}_i$ is diagonal, with eigenvalues equal to twice the sum of occupied single-particle energies. For a state $|\\Psi_k\\rangle$ with occupied orbitals $K$, the unperturbed energy is $E_k^{(0)} = \\sum_{o \\in K} 2\\epsilon_o = \\sum_{o \\in K} 2 \\cdot o \\cdot \\Delta$. Therefore, the matrix elements of $\\hat{H}_0$ are:\n    $$\n    \\langle \\Psi_k | \\hat{H}_0 | \\Psi_l \\rangle = E_k^{(0)} \\delta_{kl}\n    $$\n\n-   **Interaction Hamiltonian $\\hat{V}$:** The interaction is $\\hat{V} = -G \\sum_{i,j=1}^{\\Omega} \\hat{P}_i^\\dagger \\hat{P}_j$. Its matrix elements $\\langle \\Psi_k | \\hat{V} | \\Psi_l \\rangle$ are determined by the action of the pair creation ($\\hat{P}^\\dagger$) and annihilation ($\\hat{P}$) operators on the basis states. Assuming these operators follow hard-core boson or fermionic anticommutation rules simplified for the seniority-zero subspace, the matrix elements are:\n    -   **Diagonal elements ($k=l$):** The operator $\\hat{P}_i^\\dagger \\hat{P}_j$ contributes only when $i=j$. The term $\\hat{P}_i^\\dagger \\hat{P}_i$ acts as a number operator for pairs in orbital $i$, yielding $1$ if orbital $i$ is occupied and $0$ otherwise. For a state with $N_p$ pairs, the sum over all orbitals gives $N_p$.\n        $$\n        \\langle \\Psi_k | \\hat{V} | \\Psi_k \\rangle = \\left\\langle \\Psi_k \\left| -G \\sum_{i,j} \\hat{P}_i^\\dagger \\hat{P}_j \\right| \\Psi_k \\right\\rangle = -G \\sum_{o \\in K} 1 = -G N_p\n        $$\n    -   **Off-diagonal elements ($k \\neq l$):** The operator $\\hat{P}_i^\\dagger \\hat{P}_j$ with $i \\neq j$ annihilates a pair in orbital $j$ and creates one in orbital $i$. This operator connects states that differ by the movement of a single pair. For such states, the matrix element is found to be constant.\n        $$\n        \\langle \\Psi_k | \\hat{V} | \\Psi_l \\rangle = -G \\quad \\text{if } |\\Psi_k\\rangle \\text{ and } |\\Psi_l\\rangle \\text{ differ by one pair position}\n        $$\n        If the states differ by more than one pair position, the matrix element is $0$.\n\nCombining these, the full Hamiltonian matrix element is:\n$$\nH_{kl} = E_k^{(0)} \\delta_{kl} + \\lambda V_{kl}\n$$\nwhere $V_{kk} = -G N_p$ and $V_{kl} = -G$ for states connected by a single pair hop. The resulting matrix $\\mathbf{H}$ is Hermitian. Its eigenvalues are found by numerical diagonalization. The lowest eigenvalue is the exact ground-state energy, $E_{\\mathrm{exact}}$.\n\n**3. Rayleigh-Schrödinger Perturbation Theory**\n\nThe ground-state energy is approximated to second order in the coupling $\\lambda$. The formula is:\n$$\nE_{\\mathrm{PT2}} = E_0^{(0)} + \\lambda E_0^{(1)} + \\lambda^2 E_0^{(2)}\n$$\n\n-   **Unperturbed Ground State:** The unperturbed ground state $|\\Psi_0\\rangle$ is the configuration with the lowest energy at $\\lambda=0$. This corresponds to filling the lowest-energy orbitals, i.e., orbitals $\\{0, 1, \\dots, N_p-1\\}$. Its energy is $E_0^{(0)} = \\sum_{k=0}^{N_p-1} 2k\\Delta$.\n\n-   **First-Order Correction:** This is the expectation value of the perturbation in the unperturbed ground state.\n    $$\n    E_0^{(1)} = \\langle \\Psi_0 | \\hat{V} | \\Psi_0 \\rangle = -G N_p\n    $$\n\n-   **Second-Order Correction:** The second-order correction is given by the sum over all excited states $|k\\rangle$:\n    $$\n    E_0^{(2)} = \\sum_{k \\neq 0} \\frac{|\\langle \\Psi_k | \\hat{V} | \\Psi_0 \\rangle|^2}{E_0^{(0)} - E_k^{(0)}}\n    $$\n    The matrix element $\\langle \\Psi_k | \\hat{V} | \\Psi_0 \\rangle$ is non-zero (equal to $-G$) only for states $|\\Psi_k\\rangle$ that are created from $|\\Psi_0\\rangle$ by moving a single pair from an occupied orbital $j \\in \\{0, \\dots, N_p-1\\}$ to an unoccupied orbital $i \\in \\{N_p, \\dots, \\Omega-1\\}$. The energy of such a state is $E_k^{(0)} = E_0^{(0)} - 2j\\Delta + 2i\\Delta$. The energy denominator is $E_0^{(0)} - E_k^{(0)} = 2\\Delta(j-i)$. The sum becomes:\n    $$\n    E_0^{(2)} = \\sum_{j=0}^{N_p-1} \\sum_{i=N_p}^{\\Omega-1} \\frac{(-G)^2}{2\\Delta(j-i)} = \\frac{G^2}{2\\Delta} \\sum_{j=0}^{N_p-1} \\sum_{i=N_p}^{\\Omega-1} \\frac{1}{j-i}\n    $$\n    The problem introduces an intermediate-state energy cutoff $E_{\\mathrm{cut}}$. This restricts the sum to include only intermediate states $|\\Psi_k\\rangle$ whose unperturbed excitation energy, $E_k^{(0)} - E_0^{(0)} = 2\\Delta(i-j)$, is less than or equal to $E_{\\mathrm{cut}}$.\n\n**4. Computational Workflow and Comparison**\n\nFor each test case specified by $(\\Omega, N_p, \\Delta, G, \\lambda, E_{\\mathrm{cut}})$:\n1.  The seniority-zero basis is generated.\n2.  The exact Hamiltonian matrix $\\mathbf{H}$ is constructed and diagonalized to find $E_{\\mathrm{exact}}$.\n3.  The perturbative energy $E_{\\mathrm{PT2}}$ is calculated using the formulas derived above, applying the $E_{\\mathrm{cut}}$ constraint.\n4.  The absolute error $|E_{\\mathrm{PT2}} - E_{\\mathrm{exact}}|$ is computed. For Test $2$, two errors are computed for $E_{\\mathrm{cut}}=1.0$ and $E_{\\mathrm{cut}}=\\infty$, and their magnitudes are compared.\nThis procedure is systematically applied to all test cases, and the results are aggregated into the required output format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\nfrom itertools import combinations\n\ndef calculate_energies(Omega, Np, Delta, G, lam, E_cut):\n    \"\"\"\n    Calculates the exact and 2nd-order perturbative ground state energies.\n    \n    Args:\n        Omega (int): Number of active orbitals.\n        Np (int): Number of nucleon pairs.\n        Delta (float): Single-particle energy spacing in MeV.\n        G (float): Pairing interaction strength in MeV.\n        lam (float): Dimensionless coupling scale.\n        E_cut (float or np.inf): Intermediate-state energy cutoff for PT2 in MeV.\n\n    Returns:\n        tuple[float, float]: A tuple containing (E_exact, E_PT2).\n    \"\"\"\n    # 1. Basis Generation\n    # Orbitals are 0-indexed: 0, 1, ..., Omega-1\n    basis_tuples = list(combinations(range(Omega), Np))\n    num_states = len(basis_tuples)\n    state_to_idx = {state: i for i, state in enumerate(basis_tuples)}\n\n    # 2. Hamiltonian Matrix Construction\n    H = np.zeros((num_states, num_states), dtype=np.float64)\n\n    for i in range(num_states):\n        state_i_orbitals = set(basis_tuples[i])\n        \n        # Diagonal element of H0\n        e0_i = sum(2 * k * Delta for k in state_i_orbitals)\n        \n        # Diagonal element of V\n        v_ii = -G * Np\n        \n        H[i, i] = e0_i + lam * v_ii\n\n        # Off-diagonal elements of V\n        # Iterate over states with index j > i to build the upper triangle\n        for j in range(i + 1, num_states):\n            state_j_orbitals = set(basis_tuples[j])\n            \n            # V connects states that differ by moving one pair.\n            # This is equivalent to their intersection having Np-1 elements.\n            if len(state_i_orbitals.intersection(state_j_orbitals)) == Np - 1:\n                v_ij = -G\n                H[i, j] = lam * v_ij\n                H[j, i] = lam * v_ij # H is symmetric\n\n    # 3. Exact Diagonalization\n    # eigh is for Hermitian matrices and returns sorted eigenvalues.\n    eigenvalues = eigh(H, eigvals_only=True)\n    e_exact = eigenvalues[0]\n\n    # 4. Perturbation Theory\n    # Unperturbed ground state: pairs occupy orbitals 0, ..., Np-1\n    gs_unperturbed_orbitals = range(Np)\n    \n    # E_0^(0): Unperturbed ground state energy\n    e0_0 = sum(2 * k * Delta for k in gs_unperturbed_orbitals)\n\n    # E_0^(1): First-order correction\n    e0_1 = -G * Np\n\n    # E_0^(2): Second-order correction\n    e0_2 = 0.0\n    occupied_indices = range(Np)\n    unoccupied_indices = range(Np, Omega)\n\n    for j in occupied_indices:          # Pair moved FROM orbital j\n        for i in unoccupied_indices:  # Pair moved TO orbital i\n            # Unperturbed excitation energy for this intermediate state\n            excitation_energy = 2 * Delta * (i - j)\n            \n            # Apply the energy cutoff E_cut\n            if E_cut is np.inf or excitation_energy <= E_cut:\n                # Denominator in PT2 formula is E_0^(0) - E_k^(0)\n                energy_diff_denom = 2 * Delta * (j - i)\n                # Matrix element <k|V|0> is -G\n                e0_2 += ((-G)**2) / energy_diff_denom\n    \n    e_pt2 = e0_0 + lam * e0_1 + lam**2 * e0_2\n\n    return e_exact, e_pt2\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_suite = [\n        {'type': 'error', 'params': (6, 2, 1.0, 0.5, 0.2, 1.0)},\n        {'type': 'compare_error', 'params': (6, 2, 1.0, 0.5, 0.2)},\n        {'type': 'error', 'params': (8, 3, 1.0, 0.7, 0.0, 0.5)},\n        {'type': 'error', 'params': (6, 2, 1.0, 0.5, 0.3, np.inf)},\n        {'type': 'error', 'params': (8, 2, 1.0, 0.5, 0.3, np.inf)},\n        {'type': 'error', 'params': (6, 2, 1.0, 0.5, 0.2, 0.0)},\n        {'type': 'error', 'params': (6, 2, 1.0, 0.5, 1.0, np.inf)},\n    ]\n\n    results = []\n\n    for test in test_suite:\n        if test['type'] == 'error':\n            e_exact, e_pt2 = calculate_energies(*test['params'])\n            error = abs(e_pt2 - e_exact)\n            results.append(error)\n        \n        elif test['type'] == 'compare_error':\n            base_params = test['params']\n            \n            # Calculate error with E_cut = 1.0\n            e_exact_1, e_pt2_1 = calculate_energies(*base_params, E_cut=1.0)\n            error1 = abs(e_pt2_1 - e_exact_1)\n\n            # Calculate error with E_cut = infinity\n            # The exact energy is independent of E_cut, so we can reuse e_exact_1\n            _, e_pt2_2 = calculate_energies(*base_params, E_cut=np.inf)\n            error2 = abs(e_pt2_2 - e_exact_1)\n\n            results.append(error2 <= error1)\n\n    # Format the final output string as per requirements\n    output_parts = []\n    for res in results:\n        if isinstance(res, bool):\n            output_parts.append(str(res))\n        else:\n            output_parts.append(f\"{res:.6f}\")\n            \n    print(f\"[{','.join(output_parts)}]\")\n\nsolve()\n```"
        }
    ]
}