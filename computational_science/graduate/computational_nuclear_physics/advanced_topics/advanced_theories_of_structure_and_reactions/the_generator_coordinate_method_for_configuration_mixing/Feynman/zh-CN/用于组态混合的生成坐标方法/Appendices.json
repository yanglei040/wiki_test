{
    "hands_on_practices": [
        {
            "introduction": "为了真正掌握生成坐标方法（GCM），我们必须将理论与实践联系起来。本章节的练习旨在帮助你实现这一目标，从基本推导逐步过渡到计算实现。我们从最简单的非平凡构型混合问题开始：两个非正交态的混合。这个练习至关重要，它揭示了变分原理如何具体化为广义本征值问题（即离散形式的 Hill-Wheeler-Griffin 方程），并阐明了哈密顿核和规范核在其中扮演的核心角色。通过解决这个 $2 \\times 2$ 的情况，你将掌握所有 GCM 计算的基本代数构建模块 。",
            "id": "3600747",
            "problem": "考虑原子核多体理论中用于组态混合的生成坐标方法 (GCM)。从应用于两个非正交组态叠加的试探态的不含时变分原理出发，推导广义本征值问题，并获得广义本征值的显式解析表达式。具体来说，取试探态为 $|\\Psi\\rangle = f_{1}|\\Phi_{1}\\rangle + f_{2}|\\Phi_{2}\\rangle$，其中 $|\\Phi_{1}\\rangle$ 和 $|\\Phi_{2}\\rangle$ 是两个实数、归一化但非正交的参考态，代表两个不同的集体组态（例如，在生成坐标方法（GCM）的背景下，是两个具有不同形变参数的约束 Hartree-Fock-Bogoliubov 真空）。变分原理 $\\delta\\langle\\Psi|( \\hat{H} - E )|\\Psi\\rangle = 0$ 导出一个广义本征值问题，其哈密顿核和模核定义为 $H_{ij} = \\langle\\Phi_{i}|\\hat{H}|\\Phi_{j}\\rangle$ 和 $N_{ij} = \\langle\\Phi_{i}|\\Phi_{j}\\rangle$，其中 $i,j \\in \\{1,2\\}$。\n\n假设这些态是单独归一化的，因此 $N_{11} = N_{22} = 1$，并定义实数重叠 $N_{12} = N_{21} = n$，其中 $|n| < 1$。同时假设一个实数、对称的哈密顿核 $H_{ij} = H_{ji}$，其矩阵元为 $H_{11} = h_{11}$，$H_{22} = h_{22}$，以及 $H_{12} = H_{21} = h_{12}$。写出 $2\\times 2$ 的哈密顿矩阵 $H$ 和模矩阵 $N$，推导非平庸解的久期条件，并以所得二次方程的闭式解根的形式，求得两个广义本征值 $E$。将最终答案表示为两个本征值的精确解析表达式。不要进行任何数值近似。",
            "solution": "该问题是有效的。这是一个理论核物理中定义明确的问题，它依赖于标准的变分原理和生成坐标方法（GCM）的形式体系。所有必要的参数和条件都已给出，并且该问题具有科学依据、客观且内部一致。\n\n我们从应用于试探态 $|\\Psi\\rangle = f_{1}|\\Phi_{1}\\rangle + f_{2}|\\Phi_{2}\\rangle$ 的变分原理开始。需要求驻值的量是 $\\hat{H} - E\\hat{I}$ 的期望值：\n$$\n\\delta \\langle\\Psi| (\\hat{H} - E) |\\Psi\\rangle = 0\n$$\n其中 $E$ 是一个确保最终态归一化的拉格朗日乘子，被解释为能量本征值。这些态是实数的，系数 $f_1, f_2$ 是实数变分参数。\n\n让我们展开这个期望值：\n$$\n\\langle\\Psi| (\\hat{H} - E) |\\Psi\\rangle = \\langle f_{1}\\Phi_{1} + f_{2}\\Phi_{2} | (\\hat{H} - E) | f_{1}\\Phi_{1} + f_{2}\\Phi_{2} \\rangle\n$$\n展开内积得到：\n$$\n\\sum_{i,j \\in \\{1,2\\}} f_{i}f_{j} \\langle\\Phi_{i}| (\\hat{H} - E) |\\Phi_{j}\\rangle = \\sum_{i,j \\in \\{1,2\\}} f_{i}f_{j} (\\langle\\Phi_{i}|\\hat{H}|\\Phi_{j}\\rangle - E\\langle\\Phi_{i}|\\Phi_{j}\\rangle)\n$$\n使用所提供的哈密顿核 $H_{ij} = \\langle\\Phi_{i}|\\hat{H}|\\Phi_{j}\\rangle$ 和模核 $N_{ij} = \\langle\\Phi_{i}|\\Phi_{j}\\rangle$ 的定义，我们定义泛函 $\\mathcal{L}(f_1, f_2)$：\n$$\n\\mathcal{L}(f_1, f_2) = \\sum_{i,j=1}^{2} f_{i}f_{j} (H_{ij} - E N_{ij})\n$$\n变分原理要求找到 $\\mathcal{L}$ 关于参数 $f_1$ 和 $f_2$ 的驻点：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial f_k} = 0 \\quad \\text{for } k=1, 2\n$$\n让我们计算关于 $f_k$ 的偏导数：\n$$\n\\frac{\\partial}{\\partial f_k} \\left( \\sum_{i,j=1}^{2} f_{i}f_{j} (H_{ij} - E N_{ij}) \\right) = \\sum_{j=1}^{2} f_{j} (H_{kj} - E N_{kj}) + \\sum_{i=1}^{2} f_{i} (H_{ik} - E N_{ik}) = 0\n$$\n由于矩阵 $H$ 和 $N$ 是实数且对称的（$H_{ij} = H_{ji}, N_{ij} = N_{ji}$），这两个求和项是相同的。因此，我们有：\n$$\n2 \\sum_{j=1}^{2} (H_{kj} - E N_{kj}) f_j = 0\n$$\n这给了我们一个关于 $f_1$ 和 $f_2$ 的二元线性齐次方程组：\n$$\n(H_{11} - E N_{11})f_1 + (H_{12} - E N_{12})f_2 = 0 \\\\\n(H_{21} - E N_{21})f_1 + (H_{22} - E N_{22})f_2 = 0\n$$\n这个方程组可以写成矩阵形式的广义本征值问题：\n$$\n(H - E N) \\mathbf{f} = \\mathbf{0}\n$$\n其中 $H$ 是哈密顿矩阵，$N$ 是模矩阵，$\\mathbf{f}$ 是系数向量：\n$$\nH = \\begin{pmatrix} H_{11}  H_{12} \\\\ H_{21}  H_{22} \\end{pmatrix}, \\quad N = \\begin{pmatrix} N_{11}  N_{12} \\\\ N_{21}  N_{22} \\end{pmatrix}, \\quad \\mathbf{f} = \\begin{pmatrix} f_1 \\\\ f_2 \\end{pmatrix}\n$$\n使用指定的矩阵元值：$H_{11} = h_{11}$，$H_{22} = h_{22}$，$H_{12} = H_{21} = h_{12}$，以及 $N_{11} = N_{22} = 1$，$N_{12} = N_{21} = n$。这些矩阵是：\n$$\nH = \\begin{pmatrix} h_{11}  h_{12} \\\\ h_{12}  h_{22} \\end{pmatrix}, \\quad N = \\begin{pmatrix} 1  n \\\\ n  1 \\end{pmatrix}\n$$\n矩阵方程变为：\n$$\n\\begin{pmatrix} h_{11} - E  h_{12} - En \\\\ h_{12} - En  h_{22} - E \\end{pmatrix} \\begin{pmatrix} f_1 \\\\ f_2 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n为了得到非平庸解（即 $\\mathbf{f} \\neq \\mathbf{0}$），系数矩阵的行列式必须为零。这就是久期条件：\n$$\n\\det(H - E N) = 0\n$$\n$$\n\\det \\begin{pmatrix} h_{11} - E  h_{12} - En \\\\ h_{12} - En  h_{22} - E \\end{pmatrix} = 0\n$$\n展开行列式得到：\n$$\n(h_{11} - E)(h_{22} - E) - (h_{12} - En)^2 = 0\n$$\n让我们展开并按 $E$ 的幂次整理各项：\n$$\nh_{11}h_{22} - E h_{11} - E h_{22} + E^2 - (h_{12}^2 - 2Enh_{12} + E^2n^2) = 0\n$$\n$$\nE^2(1 - n^2) - E(h_{11} + h_{22} - 2nh_{12}) + (h_{11}h_{22} - h_{12}^2) = 0\n$$\n这是一个关于广义本征值 $E$ 的二次方程，形式为 $aE^2 + bE + c = 0$，其系数为：\n$a = 1 - n^2$\n$b = -(h_{11} + h_{22} - 2nh_{12})$\n$c = h_{11}h_{22} - h_{12}^2$\n\n解由二次公式 $E = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 给出。\n代入系数：\n$$\nE = \\frac{(h_{11} + h_{22} - 2nh_{12}) \\pm \\sqrt{(-(h_{11} + h_{22} - 2nh_{12}))^2 - 4(1 - n^2)(h_{11}h_{22} - h_{12}^2)}}{2(1 - n^2)}\n$$\n让我们分析判别式 $\\Delta = b^2 - 4ac$：\n$$\n\\Delta = (h_{11} + h_{22} - 2nh_{12})^2 - 4(1 - n^2)(h_{11}h_{22} - h_{12}^2)\n$$\n展开各项：\n$$\n\\Delta = (h_{11}^2 + h_{22}^2 + 4n^2h_{12}^2 + 2h_{11}h_{22} - 4nh_{11}h_{12} - 4nh_{22}h_{12}) - (4h_{11}h_{22} - 4h_{12}^2 - 4n^2h_{11}h_{22} + 4n^2h_{12}^2)\n$$\n合并同类项：\n$$\n\\Delta = (h_{11}^2 - 2h_{11}h_{22} + h_{22}^2) - 4nh_{12}(h_{11} + h_{22}) + 4h_{12}^2 + 4n^2h_{11}h_{22}\n$$\n注意到 $(h_{11}-h_{22})^2 = h_{11}^2 - 2h_{11}h_{22} + h_{22}^2$：\n$$\n\\Delta = (h_{11} - h_{22})^2 - 4nh_{12}(h_{11} + h_{22}) + 4h_{12}^2 + 4n^2h_{11}h_{22}\n$$\n这可以被重排成一个更具洞察力的形式。注意\n$4(1-n^2)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + 4\\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2$\n可简化为判别式 $\\Delta$。\n因此，$\\sqrt{\\Delta} = 2\\sqrt{(1-n^2)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2}$。\n将此代回 $E$ 的解中：\n$$\nE = \\frac{(h_{11} + h_{22} - 2nh_{12}) \\pm 2\\sqrt{(1-n^2)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2}}{2(1 - n^2)}\n$$\n这可以写成：\n$$\nE = \\frac{1}{1-n^2} \\left( \\frac{h_{11}+h_{22}}{2} - nh_{12} \\pm \\sqrt{(1-n^2)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2} \\right)\n$$\n这就是两个广义本征值，代表了混合态的能量。\n让我们定义两个本征值 $E_1$ 和 $E_2$，分别对应于正号和负号。\n$E_1 = \\frac{1}{1-n^2} \\left[ \\frac{h_{11}+h_{22}}{2} - nh_{12} + \\sqrt{(1-n^2)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2} \\right]$\n$E_2 = \\frac{1}{1-n^2} \\left[ \\frac{h_{11}+h_{22}}{2} - nh_{12} - \\sqrt{(1-n^2)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2} \\right]$\n这些就是本征值的闭式解析表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{1-n^2} \\left( \\frac{h_{11}+h_{22}}{2} - nh_{12} + \\sqrt{\\left(1-n^2\\right)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2} \\right)  \\frac{1}{1-n^2} \\left( \\frac{h_{11}+h_{22}}{2} - nh_{12} - \\sqrt{\\left(1-n^2\\right)\\left(\\frac{h_{11}-h_{22}}{2}\\right)^2 + \\left(h_{12} - n\\frac{h_{11}+h_{22}}{2}\\right)^2} \\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了基本推导之后，我们从抽象代数转向一个具体的可解数值示例。这个练习模拟了一个在 GCM 计算中常见的挑战性场景：三个几乎相同、强烈重叠的基态构成的系统。通过解决这个问题，你将体会到对称性在简化复杂问题中的强大作用，并对 GCM 矩阵的结构有更深入的理解，这对于计算物理学家而言是一项至关重要的技能 。",
            "id": "3600758",
            "problem": "在用于组态混合的生成坐标方法 (GCM) 中，对于一组离散化的非正交组态，Hill–Wheeler–Griffin (HWG) 方程可简化为一个形式为 $H \\mathbf{c} = E N \\mathbf{c}$ 的广义矩阵本征值问题，其中 $H$ 和 $N$ 分别是哈密顿核和模核，其矩阵元分别为 $H_{ij} = \\langle \\Phi_{i} | \\hat{H} | \\Phi_{j} \\rangle$ 和 $N_{ij} = \\langle \\Phi_{i} | \\Phi_{j} \\rangle$。考虑一个包含 $3$ 个强重叠的生成坐标基矢的玩具模型，使得其重叠（模）矩阵 $N$ 是近奇异但正定的。设哈密顿核 $H$ 和模核 $N$ 为以下 $3 \\times 3$ 实对称矩阵（$H$ 的矩阵元单位为 MeV，$N$ 的矩阵元是无量纲的）：\n$$\nH \\;=\\; \\begin{pmatrix}\n1.02  0.99  0.99 \\\\\n0.99  1.02  0.99 \\\\\n0.99  0.99  1.02\n\\end{pmatrix}, \n\\qquad\nN \\;=\\; \\begin{pmatrix}\n1  0.99  0.99 \\\\\n0.99  1  0.99 \\\\\n0.99  0.99  1\n\\end{pmatrix}.\n$$\n这些矩阵源于三个几乎重合的非正交组态，这种情况在实际的 GCM 离散化中经常出现。$H$ 和 $N$ 都是正定的，且 $N$ 是近奇异的。\n\n从 HWG 框架和广义矩阵本征值问题的基本原理出发，显式求解所有三个广义本征值 $E$ 和满足 $\\mathbf{c}_{k}^{\\mathsf{T}} N \\,\\mathbf{c}_{\\ell} = \\delta_{k\\ell}$ 的一组完备的 $N$-正交归一本征矢 $\\{\\mathbf{c}_{k}\\}_{k=1}^{3}$。展示确定正定性、本征系统的结构以及构造 $N$-正交归一本征矢的每一步。\n\n最后，作为报告结果，仅给出最低的广义本征值（基态能量）作为一个单独的数值。将您的答案四舍五入到四位有效数字，并以 MeV 为单位表示最终能量。",
            "solution": "该问题提出了一个广义矩阵本征值问题 $H \\mathbf{c} = E N \\mathbf{c}$，这是核理论中生成坐标方法 (GCM) 的一个基本问题。给定的矩阵为\n$$\nH \\;=\\; \\begin{pmatrix}\n1.02  0.99  0.99 \\\\\n0.99  1.02  0.99 \\\\\n0.99  0.99  1.02\n\\end{pmatrix} \\, \\text{MeV},\n\\qquad\nN \\;=\\; \\begin{pmatrix}\n1  0.99  0.99 \\\\\n0.99  1  0.99 \\\\\n0.99  0.99  1\n\\end{pmatrix}.\n$$\n任务是找到所有广义本征值 $E$ 和一组完备的 $N$-正交归一本征矢 $\\mathbf{c}_k$，并报告最低的本征值。\n\n首先，我们验证问题的基本设定。这是一个定义明确的线性代数问题，基于 GCM 已建立的物理框架。所有数据都已提供，并且矩阵的物理动机源于强重叠、几乎相同的基矢情景。该问题是有效的。\n\n巧妙求解的关键在于识别矩阵 $H$ 和 $N$ 的高度对称结构。这两个矩阵都可以表示为 $aI + bJ$ 的形式，其中 $I$ 是 $3 \\times 3$ 单位矩阵，$J$ 是 $3 \\times 3$ 的全1矩阵。\n\n对于哈密顿矩阵 $H$：\n设 $H_{ij} = a_H \\delta_{ij} + b_H$。对角元为 $H_{ii} = a_H + b_H = 1.02$。非对角元为 $H_{ij} = b_H = 0.99$。由此可得 $b_H = 0.99$ 和 $a_H = 1.02 - 0.99 = 0.03$。因此，\n$$\nH = 0.03 \\, I + 0.99 \\, J.\n$$\n\n对于模矩阵 $N$：\n设 $N_{ij} = a_N \\delta_{ij} + b_N$。对角元为 $N_{ii} = a_N + b_N = 1$。非对角元为 $N_{ij} = b_N = 0.99$。由此可得 $b_N = 0.99$ 和 $a_N = 1 - 0.99 = 0.01$。因此，\n$$\nN = 0.01 \\, I + 0.99 \\, J.\n$$\n$H$ 的单位是 MeV，而 $N$ 是无量纲的。参数 $a_H, b_H$ 的单位是 MeV，而 $a_N, b_N$ 是无量纲的。\n\n矩阵 $J$ 有一个已知的本征系统。对于一个 $n \\times n$ 矩阵 $J$，其本征值为 $n$（重数为 1）和 $0$（重数为 $n-1$）。对应于本征值 $n$ 的本征矢是全1向量 $\\mathbf{v}_s = \\begin{pmatrix} 1  1  \\dots  1 \\end{pmatrix}^{\\mathsf{T}}$ 的任意倍数。对应于本征值 $0$ 的本征空间由所有分量之和为零的向量组成，即 $\\sum_i v_i = 0$。\n\n由于 $H$ 和 $N$ 都是 $I$ 和 $J$ 的线性组合，它们相互对易（$HN = NH$），并且可以同时对角化。它们共享同一组本征矢。设 $\\mathbf{v}$ 是一个共同的本征矢，则\n$$\nH \\mathbf{v} = \\lambda_H \\mathbf{v} \\quad \\text{和} \\quad N \\mathbf{v} = \\lambda_N \\mathbf{v}.\n$$\n将这些代入广义本征值方程 $H \\mathbf{v} = E N \\mathbf{v}$ 得到\n$$\n\\lambda_H \\mathbf{v} = E (\\lambda_N \\mathbf{v}).\n$$\n由于 $\\mathbf{v} \\neq \\mathbf{0}$，这可以简化为 $\\lambda_H = E \\lambda_N$。问题中指出 $N$ 是正定的，这意味着它的所有本征值 $\\lambda_N$ 都严格为正，因此我们可以将广义本征值写为 $H$ 和 $N$ 标准本征值的比值：\n$$\nE = \\frac{\\lambda_H}{\\lambda_N}.\n$$\n\n现在我们计算当 $n=3$ 时 $H$ 和 $N$ 的本征值。\n矩阵 $aI + bJ$ 的本征值为 $a+nb$ 和 $a$（重数为 $n-1$）。\n\n对于 $N$（$a_N=0.01, b_N=0.99, n=3$）：\n非简并本征值为 $\\lambda_1(N) = a_N + 3b_N = 0.01 + 3(0.99) = 0.01 + 2.97 = 2.98$。\n简并本征值为 $\\lambda_{2,3}(N) = a_N = 0.01$。\n由于 $2.98 > 0$ 和 $0.01 > 0$ 都成立，所以 $N$ 的所有本征值都是正的，这证实了问题陈述中 $N$ 是正定的。从 $\\lambda_{2,3}(N)$ 的微小数值可以看出其近奇异性。\n\n对于 $H$（$a_H=0.03, b_H=0.99, n=3$）：\n非简并本征值为 $\\lambda_1(H) = a_H + 3b_H = 0.03 + 3(0.99) = 0.03 + 2.97 = 3.00$ MeV。\n简并本征值为 $\\lambda_{2,3}(H) = a_H = 0.03$ MeV。\n由于所有本征值都是正的，所以 $H$ 也是正定的。\n\n现在我们可以计算广义本征值 $E_k$：\n第一个广义本征值，对应于对称本征矢，为\n$$\nE_1 = \\frac{\\lambda_1(H)}{\\lambda_1(N)} = \\frac{3.00}{2.98} = \\frac{150}{149} \\, \\text{MeV}.\n$$\n两个简并的广义本征值为\n$$\nE_{2,3} = \\frac{\\lambda_{2,3}(H)}{\\lambda_{2,3}(N)} = \\frac{0.03}{0.01} = 3 \\, \\text{MeV}.\n$$\n三个广义本征值是 $E_1 = \\frac{150}{149} \\approx 1.0067$ MeV，以及 $E_2=E_3=3$ MeV。最低的本征值，对应于系统的基态，是 $E_1$。\n\n接下来，我们构造一组满足 $\\mathbf{c}_k^{\\mathsf{T}} N \\mathbf{c}_\\ell = \\delta_{k\\ell}$ 的 $N$-正交归一本征矢 $\\{\\mathbf{c}_k\\}$。\n第一个本征矢 $\\mathbf{c}_1$：\n这个本征矢对应于 $E_1$，是 $J$ 矩阵本征值为 3 的本征矢。一个未归一化的本征矢是 $\\tilde{\\mathbf{c}}_1 = \\begin{pmatrix} 1  1  1 \\end{pmatrix}^{\\mathsf{T}}$。\n归一化常数 $A_1$ 可从条件 $A_1^2 \\tilde{\\mathbf{c}}_1^{\\mathsf{T}} N \\tilde{\\mathbf{c}}_1 = 1$ 求出。\n$$\n\\tilde{\\mathbf{c}}_1^{\\mathsf{T}} N \\tilde{\\mathbf{c}}_1 = \\tilde{\\mathbf{c}}_1^{\\mathsf{T}} (\\lambda_1(N) \\tilde{\\mathbf{c}}_1) = \\lambda_1(N) (\\tilde{\\mathbf{c}}_1^{\\mathsf{T}} \\tilde{\\mathbf{c}}_1) = 2.98 \\times (1^2 + 1^2 + 1^2) = 2.98 \\times 3 = 8.94.\n$$\n所以，$A_1 = 1/\\sqrt{8.94}$。归一化后的本征矢是：\n$$\n\\mathbf{c}_1 = \\frac{1}{\\sqrt{8.94}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}.\n$$\n\n本征矢 $\\mathbf{c}_2, \\mathbf{c}_3$：\n它们对应于简并本征值 $E_{2,3}=3$，并张成 $J$ 矩阵本征值为 0 的本征空间。这个本征空间是由 $v_1+v_2+v_3=0$ 定义的平面。我们必须在这个平面中找到两个相对于 $N$-内积 $(\\mathbf{u}, \\mathbf{v})_N = \\mathbf{u}^{\\mathsf{T}} N \\mathbf{v}$ 正交归一的向量。\n让我们为此平面选择一组初始基矢，例如 $\\mathbf{v}_2 = \\begin{pmatrix} 1  -1  0 \\end{pmatrix}^{\\mathsf{T}}$ 和 $\\mathbf{v}_3 = \\begin{pmatrix} 1  0  -1 \\end{pmatrix}^{\\mathsf{T}}$。\n我们使用 $N$-内积应用 Gram-Schmidt 正交化过程。对于这个子空间中的任意向量 $\\mathbf{v}$，有 $N\\mathbf{v} = \\lambda_2(N) \\mathbf{v} = 0.01 \\mathbf{v}$。因此，内积为 $(\\mathbf{u}, \\mathbf{v})_N = 0.01 (\\mathbf{u}^{\\mathsf{T}} \\mathbf{v})$。\n\n令第一个未归一化的正交向量为 $\\tilde{\\mathbf{c}}_2 = \\mathbf{v}_2 = \\begin{pmatrix} 1  -1  0 \\end{pmatrix}^{\\mathsf{T}}$。\n构造第二个向量 $\\tilde{\\mathbf{c}}_3$，使其与 $\\tilde{\\mathbf{c}}_2$ 是 $N$-正交的：\n$$\n\\tilde{\\mathbf{c}}_3 = \\mathbf{v}_3 - \\frac{(\\mathbf{v}_3, \\tilde{\\mathbf{c}}_2)_N}{(\\tilde{\\mathbf{c}}_2, \\tilde{\\mathbf{c}}_2)_N} \\tilde{\\mathbf{c}}_2.\n$$\n内积为：\n$$\n(\\tilde{\\mathbf{c}}_2, \\tilde{\\mathbf{c}}_2)_N = 0.01 (\\tilde{\\mathbf{c}}_2^{\\mathsf{T}} \\tilde{\\mathbf{c}}_2) = 0.01(1^2 + (-1)^2 + 0^2) = 0.01 \\times 2 = 0.02.\n$$\n$$\n(\\mathbf{v}_3, \\tilde{\\mathbf{c}}_2)_N = 0.01 (\\mathbf{v}_3^{\\mathsf{T}} \\tilde{\\mathbf{c}}_2) = 0.01(1 \\cdot 1 + 0 \\cdot (-1) + (-1) \\cdot 0) = 0.01 \\times 1 = 0.01.\n$$\n所以，\n$$\n\\tilde{\\mathbf{c}}_3 = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix} - \\frac{0.01}{0.02} \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix} - \\frac{1}{2} \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ -1 \\end{pmatrix}.\n$$\n现在我们有了一个 $N$-正交集 $\\{\\tilde{\\mathbf{c}}_1, \\tilde{\\mathbf{c}}_2, \\tilde{\\mathbf{c}}_3\\}$。最后一步是对 $\\tilde{\\mathbf{c}}_2$ 和 $\\tilde{\\mathbf{c}}_3$ 进行归一化。\n对于 $\\mathbf{c}_2$：\n归一化因子是 $1/\\sqrt{(\\tilde{\\mathbf{c}}_2, \\tilde{\\mathbf{c}}_2)_N} = 1/\\sqrt{0.02}$。\n$$\n\\mathbf{c}_2 = \\frac{1}{\\sqrt{0.02}} \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\end{pmatrix}.\n$$\n对于 $\\mathbf{c}_3$：\n我们计算它的 $N$-模：\n$(\\tilde{\\mathbf{c}}_3, \\tilde{\\mathbf{c}}_3)_N = 0.01(\\tilde{\\mathbf{c}}_3^{\\mathsf{T}} \\tilde{\\mathbf{c}}_3) = 0.01((1/2)^2 + (1/2)^2 + (-1)^2) = 0.01(1/4 + 1/4 + 1) = 0.01(1.5) = 0.015$。\n归一化因子是 $1/\\sqrt{0.015}$。\n$$\n\\mathbf{c}_3 = \\frac{1}{\\sqrt{0.015}} \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ -1 \\end{pmatrix}.\n$$\n这就完成了整个本征系统的构造。\n\n最终要求的结果是最低的广义本征值（基态能量），四舍五入到四位有效数字。\n$$\nE_{\\text{ground}} = E_1 = \\frac{150}{149} \\, \\text{MeV} \\approx 1.0067114... \\, \\text{MeV}.\n$$\n四舍五入到四位有效数字得到 $1.007$ MeV。",
            "answer": "$$\n\\boxed{1.007}\n$$"
        },
        {
            "introduction": "最后的练习是一个综合性的计算项目，它将带你进入实际的 GCM 计算核心。任何真实的 GCM 计算都依赖于对复杂多体态（如对偶的 Bardeen-Cooper-Schrieffer (BCS) 真空态）之间矩阵元的计算。这个问题将指导你实现并验证规范核的计算，这是 GCM 计算机制的心脏。通过将解析公式与基于广义威克定理和普法夫行列式的数值实现进行比较，本练习将深化你对底层多体理论的理解，并培养实用的计算技能 。",
            "id": "3600771",
            "problem": "您将从第一性原理出发，实现 Generator Coordinate Method (GCM) 中用于组态混合所需的两个成对 Hartree–Fock–Bogoliubov (HFB) 真空态之间的重叠核。其物理背景是一个具有时间反演对称性的两能级、恒定配对的玩具模型，该模型在正则 Bardeen–Cooper–Schrieffer (BCS) 形式下进行处理。您的程序必须针对配对相互作用强度 $G$（单位为兆电子伏，MeV）的几个不同数值，计算两个 BCS 真空态之间的数值重叠，并将其与直接的解析表达式进行基准比较。所有输出均为无量纲。若有角度，则必须以弧度为单位，但此处不需要。\n\n从以下基础知识开始。\n\n- HFB 真空态可以写成一个准粒子真空，它由粒子产生-湮灭算符的 Bogoliubov 变换定义。在一个时间反演不变的正则基中，它简化为 BCS 形式，每对 $k$ 具有振幅 $u_k$ 和 $v_k$。\n- 对于一个具有单粒子能量 $\\varepsilon_k$（简并的时间反演对）和配对强度 $G$ 的恒定配对哈密顿量，BCS 振幅由自洽的能隙和粒子数方程确定：\n  $$\\Delta = G \\sum_k u_k v_k,$$\n  $$\\sum_k v_k^2 = N,$$\n  其中准粒子能量为 $E_k = \\sqrt{(\\varepsilon_k - \\mu)^2 + \\Delta^2}$，振幅为\n  $$u_k^2 = \\frac{1}{2}\\left(1 + \\frac{\\varepsilon_k - \\mu}{E_k}\\right),\\quad v_k^2 = \\frac{1}{2}\\left(1 - \\frac{\\varepsilon_k - \\mu}{E_k}\\right),\\quad u_k v_k = \\frac{\\Delta}{2 E_k},$$\n  其中 $\\mu$ 是化学势，$\\Delta$ 是配对能隙。\n- 在同一正则基上定义的两个 BCS 真空态之间的重叠具有一个解析表达式\n  $$\\mathcal{O}_{\\mathrm{an}} = \\prod_k \\left( u_k^{(a)} u_k^{(b)} + v_k^{(a)} v_k^{(b)} \\right),$$\n  其中上标 $(a)$ 和 $(b)$ 表示两个不同的 BCS 解，它们可能有不同的 $G$，但具有相同的单粒子基和能量。对于实数的 $u_k$ 和 $v_k$，此重叠是实数且非负的。\n- 广义 Wick 定理给出了以 Bogoliubov 矩阵表示的数值重叠。在正则基中，为每个时间反演对 $k$ 定义块对角的 Bogoliubov 矩阵 $U$ 和 $V$，其 $2\\times 2$ 块为：\n  $$U_k = \\begin{pmatrix} u_k  0 \\\\ 0  u_k \\end{pmatrix},\\quad V_k = \\begin{pmatrix} 0  -v_k \\\\ v_k  0 \\end{pmatrix}.$$\n  对于两个真空态 $(a)$ 和 $(b)$，构建 Onishi 矩阵\n  $$S = U^{(a)\\dagger} U^{(b)} + V^{(a)\\dagger} V^{(b)},$$\n  并使用关系式\n  $$\\left|\\langle \\Phi^{(a)} | \\Phi^{(b)} \\rangle\\right| = \\sqrt{\\det S}.$$\n  为了通过 Pfaffian 稳定地计算 $\\det S$，使用恒等式\n  $$\\operatorname{pf}\\begin{pmatrix} 0  S \\\\ -S^{\\mathsf{T}}  0 \\end{pmatrix} = (-1)^{n(n-1)/2} \\det S,$$\n  其中 $n$ 是 $S$ 的维数，$\\operatorname{pf}(\\cdot)$ 表示反对称矩阵的 Pfaffian。重叠的绝对值则为 $\\sqrt{|\\operatorname{pf}(\\cdot)|}$。\n\n您的计算模型必须在科学上是真实的且自洽的：\n\n- 考虑 $M$ 个时间反演对分裂成两个能级。设较低能级的简并度为 $\\Omega_1$，能量为 $\\varepsilon_1 = -d/2$；较高能级的简并度为 $\\Omega_2$，能量为 $\\varepsilon_2 = +d/2$，其中 $d$ 是一个正的形变劈裂。总对数为 $M = \\Omega_1 + \\Omega_2$。使用半填充，即对数 $N = M/2$。\n- 对于每个给定的配对强度 $G$，计算两个 BCS 真空态：一个在 $G$ 处，另一个在 $G' = G + \\delta G$ 处的比较真空态，其中 $\\delta G$ 是一个固定的微小增量。\n- 为每个真空态自洽地求解能隙和粒子数方程，以获得 $(\\mu, \\Delta)$，然后获得所有对的 $(u_k, v_k)$。\n\n实现以下要求。\n\n1. 为 BCS 能隙和粒子数方程实现一个鲁棒的求解器。使用能够确保在 $G$ 值较小和较大时都能收敛的初始猜测值。如果 $G = 0$，必须使用平凡解 $\\Delta = 0$，并将化学势 $ \\mu $ 置于两个能级之间（例如 $\\mu = 0$）。\n2. 为每个真空态构建 Bogoliubov 矩阵 $U$ 和 $V$，然后构成矩阵 $S = U^{(a)\\dagger} U^{(b)} + V^{(a)\\dagger} V^{(b)}$ 以及 $2n \\times 2n$ 的反对称块矩阵\n   $$B = \\begin{pmatrix} 0  S \\\\ -S^{\\mathsf{T}}  0 \\end{pmatrix}.$$\n   实现一个带选主元的数值稳定的 Pfaffian 例程来计算 $\\operatorname{pf}(B)$。\n3. 计算数值重叠幅值 $\\mathcal{O}_{\\mathrm{pf}} = \\sqrt{|\\operatorname{pf}(B)|}$ 和如上所述的解析重叠 $\\mathcal{O}_{\\mathrm{an}}$。为每个测试用例返回绝对差 $|\\mathcal{O}_{\\mathrm{pf}} - \\mathcal{O}_{\\mathrm{an}}|$。\n\n物理单位和数值规范：\n\n- 能量 $\\varepsilon_k$、能隙 $\\Delta$ 和相互作用强度 $G$ 必须以兆电子伏 ($\\mathrm{MeV}$) 表示。\n- 重叠是无量纲的。\n- 如果需要角度，使用弧度单位；此处不需要。\n\n测试套件和输出规范：\n\n- 使用 $\\Omega_1 = 3$，$\\Omega_2 = 3$，因此 $M = 6$ 对，半填充 $N = 3$。使用形变劈裂 $d = 1.4$（单位 $\\mathrm{MeV}$），因此 $\\varepsilon_1 = -0.7$ 和 $\\varepsilon_2 = +0.7$（单位 $\\mathrm{MeV}$）。\n- 使用配对强度（单位 $\\mathrm{MeV}$）$G \\in \\{0.0, 0.2, 0.5, 1.0, 2.0\\}$，并使用固定的增量 $\\delta G = 0.15$（单位 $\\mathrm{MeV}$）来定义在 $G' = G + \\delta G$ 处的比较真空态。\n- 对于每个 $G$，计算绝对差 $|\\mathcal{O}_{\\mathrm{pf}} - \\mathcal{O}_{\\mathrm{an}}|$，结果为一个浮点数。\n\n您的程序应该产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$）。不应打印任何其他文本。",
            "solution": "用户要求在一个简化的原子核模型中，实现并验证两种用于计算两个 Bardeen–Cooper–Schrieffer (BCS) 真空态之间重叠的方法。这个问题是在生成坐标方法 (GCM) 的背景下提出的，在这种方法中，这类重叠构成了用于组态混合的积分方程的核。\n\n### 问题验证\n\n根据指定的标准对问题进行评估：\n\n1.  **已知条件提取**:\n    - **模型**: 一个两能级系统，其单粒子能量为 $\\varepsilon_1 = -d/2$ 和 $\\varepsilon_2 = +d/2$，每个能级分别具有 $\\Omega_1$ 和 $\\Omega_2$ 个时间反演对的简并度。\n    - **参数**: $\\Omega_1 = 3$, $\\Omega_2 = 3$, $d = 1.4 \\, \\mathrm{MeV}$。这给出总对数为 $M = \\Omega_1 + \\Omega_2 = 6$。系统处于半填充状态，因此对数为 $N=M/2=3$。\n    - **相互作用**: 强度为 $G$ 的恒定配对相互作用。\n    - **态**: 两个 BCS 真空态 $|\\Phi^{(a)}\\rangle$ 和 $|\\Phi^{(b)}\\rangle$ 分别由配对强度 $G^{(a)} = G$ 和 $G^{(b)} = G + \\delta G$ 生成，其中 $\\delta G = 0.15 \\, \\mathrm{MeV}$。\n    - **$G$ 的测试值**: $\\{0.0, 0.2, 0.5, 1.0, 2.0\\}$ 单位为 $\\mathrm{MeV}$。\n    - **BCS 方程**: 关联配对能隙 $\\Delta$、化学势 $\\mu$、配对强度 $G$ 和 BCS 振幅 $(u_k, v_k)$ 的标准方程组。\n    - **解析重叠**: $\\mathcal{O}_{\\mathrm{an}} = \\prod_k \\left( u_k^{(a)} u_k^{(b)} + v_k^{(a)} v_k^{(b)} \\right)$。\n    - **数值重叠**: $\\mathcal{O}_{\\mathrm{pf}} = \\sqrt{|\\operatorname{pf}(B)|}$, 其中 $B = \\begin{pmatrix} 0  S \\\\ -S^{\\mathsf{T}}  0 \\end{pmatrix}$ 且 $S = U^{(a)\\dagger} U^{(b)} + V^{(a)\\dagger} V^{(b)}$。\n    - **任务**: 为每个 $G$ 计算绝对差 $|\\mathcal{O}_{\\mathrm{pf}} - \\mathcal{O}_{\\mathrm{an}}|$。明确要求实现一个稳定的 Pfaffian 算法。\n\n2.  **验证**:\n    - **科学依据**: 这个问题牢固地植根于量子多体理论的原理，特别是 BCS 理论及其通过 GCM 在核结构物理中的应用。所涉及的方程、概念以及选择的玩具模型都是标准的并且在科学上是合理的。\n    - **适定性**: 所有必要的参数和条件都已提供，以唯一地确定问题。模型的对称设置（$\\Omega_1=\\Omega_2$、半填充、粒子-空穴对称的能量 $\\pm d/2$）带来了显著的简化：由于对称性，化学势 $\\mu$ 必须为零。这将 BCS 问题简化为求解关于能隙 $\\Delta$ 的单个方程，这是此适定模型的一个特点，而非缺陷。\n    - **客观性**: 问题以精确、定量的术语陈述，没有任何主观性。\n\n3.  **结论**: 这个问题是 **有效的**。它是一个定义明确的计算物理问题，自成体系、科学正确且客观。\n\n### 基于原理的解决方案设计\n\n解决方案遵循 BCS 模型的物理原理，通过分步实现指定的计算来进行。\n\n#### 1. 对称两能级模型的 BCS 解\n\n对于给定的模型，半填充时的粒子-空穴对称性迫使化学势 $\\mu=0$。这简化了 BCS 方程。\n粒子数守恒方程 $\\sum_k v_k^2 = N$ 变为：\n$$ \\Omega_1 v_1^2 + \\Omega_2 v_2^2 = N $$\n当 $\\mu=0$ 时，两个能级的准粒子能量相同：$E_1 = E_2 = E = \\sqrt{(d/2)^2 + \\Delta^2}$。占据振幅由下式给出：\n$$ v_1^2 = \\frac{1}{2}\\left(1 - \\frac{\\varepsilon_1}{E}\\right) = \\frac{1}{2}\\left(1 + \\frac{d/2}{E}\\right) $$\n$$ v_2^2 = \\frac{1}{2}\\left(1 - \\frac{\\varepsilon_2}{E}\\right) = \\frac{1}{2}\\left(1 - \\frac{d/2}{E}\\right) $$\n将这些代入粒子数方程，其中 $\\Omega_1 = \\Omega_2 = 3$ 且 $N=3$：\n$$ 3 \\cdot \\frac{1}{2}\\left(1 + \\frac{d/2}{E}\\right) + 3 \\cdot \\frac{1}{2}\\left(1 - \\frac{d/2}{E}\\right) = 3 \\implies \\frac{3}{2}(1 + 1) = 3 \\implies 3 = 3 $$\n这证实了只要 $\\mu=0$，对于任何 $\\Delta$ 值，粒子数方程都成立。我们只需要求解能隙方程：\n$$ \\Delta = G \\sum_k u_k v_k = G (\\Omega_1 u_1 v_1 + \\Omega_2 u_2 v_2) $$\n使用 $u_k v_k = \\Delta / (2E_k)$ 和 $E_1=E_2=E$：\n$$ \\Delta = G \\left( \\Omega_1 \\frac{\\Delta}{2E} + \\Omega_2 \\frac{\\Delta}{2E} \\right) = G \\frac{\\Delta}{2E} (\\Omega_1 + \\Omega_2) = G \\frac{M\\Delta}{2E} $$\n对于非平凡解（$\\Delta \\neq 0$），我们可以两边同除以 $\\Delta$：\n$$ 1 = \\frac{GM}{2E} \\implies 2E = GM \\implies 2\\sqrt{(d/2)^2 + \\Delta^2} = GM $$\n求解 $\\Delta^2$：\n$$ 4((d/2)^2 + \\Delta^2) = (GM)^2 \\implies d^2 + 4\\Delta^2 = G^2 M^2 \\implies \\Delta^2 = \\frac{G^2 M^2 - d^2}{4} $$\n只有当 $G > G_c = d/M$ 时，$\\Delta$ 才存在实数的非零解。对于 $G \\le G_c$，唯一的物理可行解是 $\\Delta=0$，对应于正常（非配对）态。根据给定参数，$G_c = 1.4 / 6 \\approx 0.233 \\, \\mathrm{MeV}$。\n\n#### 2. 重叠计算\n对于每个测试用例 $G$，我们使用各自的配对强度 $G^{(a)}=G$ 和 $G^{(b)}=G+\\delta G$ 来计算真空态 $(a)$ 和 $(b)$ 的 BCS 振幅。\n\n**解析重叠 $\\mathcal{O}_{\\mathrm{an}}$**:\n总重叠是所有 $M=6$ 对的乘积。由于有 $\\Omega_1=3$ 个相同的类型 1 对和 $\\Omega_2=3$ 个相同的类型 2 对，公式为：\n$$ \\mathcal{O}_{\\mathrm{an}} = \\left( u_1^{(a)} u_1^{(b)} + v_1^{(a)} v_1^{(b)} \\right)^{\\Omega_1} \\left( u_2^{(a)} u_2^{(b)} + v_2^{(a)} v_2^{(b)} \\right)^{\\Omega_2} $$\n\n**通过 Pfaffian 计算的数值重叠 $\\mathcal{O}_{\\mathrm{pf}}$**:\n这包括几个步骤：\n1.  **构建 Bogoliubov 矩阵**: 对于每个真空态，$U$ 和 $V$ 是 $12 \\times 12$ 的块对角矩阵，因为单粒子空间的维数为 $2M=12$。\n2.  **构建 Onishi 矩阵 $S$**: $S = U^{(a)\\dagger} U^{(b)} + V^{(a)\\dagger} V^{(b)}$。由于 $u_k$ 和 $v_k$ 是实数，$U^\\dagger=U$。$V$ 的块是斜对称的，因此 $V_k^\\dagger = V_k^\\mathsf{T} = -V_k$，使得 $V^\\dagger = -V$。\n    $S$ 的第 $k$ 个 $2 \\times 2$ 块是：\n    $$ S_k = \\begin{pmatrix} u_k^{(a)}u_k^{(b)} + v_k^{(a)}v_k^{(b)}  0 \\\\ 0  u_k^{(a)}u_k^{(b)} + v_k^{(a)}v_k^{(b)} \\end{pmatrix} $$\n    因此，$S$ 是一个对角矩阵。\n3.  **构建矩阵 $B$**: $B$ 是一个 $24 \\times 24$ 的斜对称矩阵：$B = \\begin{pmatrix} 0  S \\\\ -S^{\\mathsf{T}}  0 \\end{pmatrix}$。由于 $S$ 是对角矩阵，$S^\\mathsf{T} = S$。\n4.  **计算 Pfaffian**: 问题明确要求实现一个 Pfaffian 算法。我们使用带全选主元的高斯消去法实现一个稳定版本。\n5.  **计算重叠**: $\\mathcal{O}_{\\mathrm{pf}} = \\sqrt{|\\operatorname{pf}(B)|}$。\n\n$B$ 的结构允许直接计算其 Pfaffian。使用提供的恒等式，$\\operatorname{pf}(B) = (-1)^{n(n-1)/2} \\det S$，其中 $n=12$ 是 $S$ 的维数。符号因子为 $(-1)^{12(11)/2} = (-1)^{66} = +1$。因此，$\\operatorname{pf}(B) = \\det S$。\n由于 $S$ 是对角矩阵，其行列式是对角元素的乘积：\n$$ \\det S = \\left( u_1^{(a)}u_1^{(b)} + v_1^{(a)}v_1^{(b)} \\right)^{2\\Omega_1} \\left( u_2^{(a)}u_2^{(b)} + v_2^{(a)}v_2^{(b)} \\right)^{2\\Omega_2} = (\\mathcal{O}_{\\mathrm{an}})^2 $$\n这导致 $\\operatorname{pf}(B) = \\mathcal{O}_{\\mathrm{an}}^2$。重叠是实数且非负的，所以 $|\\operatorname{pf}(B)| = \\mathcal{O}_{\\mathrm{an}}^2$。\n最后，$\\mathcal{O}_{\\mathrm{pf}} = \\sqrt{|\\operatorname{pf}(B)|} = \\sqrt{\\mathcal{O}_{\\mathrm{an}}^2} = \\mathcal{O}_{\\mathrm{an}}$。\n两种方法必须产生相同的结果，绝对差 $|\\mathcal{O}_{\\mathrm{pf}} - \\mathcal{O}_{\\mathrm{an}}|$ 在机器精度范围内应为零。该计算可以作为此恒等式的数值验证，以及对 Pfaffian 实现的测试。",
            "answer": "```python\nimport numpy as np\n\ndef pfaffian_pivoted(A):\n    \"\"\"\n    Computes the Pfaffian of a real skew-symmetric matrix using\n    Gaussian elimination with full pivoting (Parlett-Reid algorithm adapted\n    for skew-symmetric matrices).\n\n    Args:\n        A (np.ndarray): A 2n x 2n skew-symmetric matrix.\n\n    Returns:\n        float: The Pfaffian of A.\n    \"\"\"\n    n_dim = A.shape[0]\n    if n_dim % 2 != 0:\n        return 0.0\n\n    M = A.copy().astype(np.float64)\n    perm_sign = 1.0\n    pf_val = 1.0\n\n    for k in range(n_dim // 2):\n        i, j = 2 * k, 2 * k + 1\n\n        # Find the element with the largest absolute value in the strict upper\n        # triangle of the remaining submatrix M[i:, i:].\n        max_abs_val = 0.0\n        piv_r, piv_c = i, j\n        \n        current_max_val = -1.0\n        for r_idx in range(i, n_dim):\n            for c_idx in range(r_idx + 1, n_dim):\n                if abs(M[r_idx, c_idx]) > current_max_val:\n                    current_max_val = abs(M[r_idx, c_idx])\n                    piv_r, piv_c = r_idx, c_idx\n\n        max_abs_val = current_max_val\n\n        if max_abs_val < 1e-15:\n            return 0.0\n\n        # Permute rows and columns to bring the pivot to position (i, j).\n        # Swap row/col i with piv_r\n        if piv_r != i:\n            M[[i, piv_r], :] = M[[piv_r, i], :]\n            M[:, [i, piv_r]] = M[:, [piv_r, i]]\n            perm_sign *= -1\n\n        # The original piv_c may have moved.\n        piv_c_new = piv_c\n        if piv_c == i:\n            piv_c_new = piv_r\n        \n        if piv_c_new != j:\n            M[[j, piv_c_new], :] = M[[piv_c_new, j], :]\n            M[:, [j, piv_c_new]] = M[:, [piv_c_new, j]]\n            perm_sign *= -1\n\n        pivot = M[i, j]\n        pf_val *= pivot\n\n        if k < n_dim // 2 - 1:\n            inv_pivot = 1.0 / pivot\n            \n            # Schur complement update on M[j+1:, j+1:]\n            update_slice = slice(j + 1, n_dim)\n            v = M[update_slice, i]\n            w = M[update_slice, j]\n            \n            sub_M = M[update_slice, update_slice]\n            update_matrix = inv_pivot * (np.outer(v, w) - np.outer(w, v))\n            sub_M += update_matrix\n            M[update_slice, update_slice] = sub_M\n\n    return perm_sign * pf_val\n\ndef get_bcs_solution(G, M, d):\n    \"\"\"\n    Solves the BCS equations for the symmetric two-level model.\n    \"\"\"\n    eps1, eps2 = -d / 2.0, d / 2.0\n    \n    # Calculate pairing gap Delta\n    delta_sq_arg = G**2 * M**2 - d**2\n    delta = 0.5 * np.sqrt(max(0, delta_sq_arg))\n\n    if delta == 0:\n        # Normal (unpaired) state\n        u1, v1 = 0.0, 1.0\n        u2, v2 = 1.0, 0.0\n    else:\n        # Superconducting (paired) state\n        # Quasiparticle energy E is the same for both levels due to symmetry\n        E = np.sqrt((d / 2.0)**2 + delta**2)\n        \n        # Amplitudes for level 1\n        u1_sq = 0.5 * (1 + eps1 / E)\n        v1_sq = 0.5 * (1 - eps1 / E)\n        u1, v1 = np.sqrt(u1_sq), np.sqrt(v1_sq)\n        \n        # Amplitudes for level 2\n        u2_sq = 0.5 * (1 + eps2 / E)\n        v2_sq = 0.5 * (1 - eps2 / E)\n        u2, v2 = np.sqrt(u2_sq), np.sqrt(v2_sq)\n        \n    return u1, v1, u2, v2\n\ndef solve():\n    \"\"\"\n    Main function to perform the overlap calculation and comparison.\n    \"\"\"\n    # Physical and numerical parameters\n    Omega1 = 3\n    Omega2 = 3\n    d = 1.4      # MeV\n    delta_G = 0.15 # MeV\n    G_values = [0.0, 0.2, 0.5, 1.0, 2.0] # MeV\n\n    M = Omega1 + Omega2\n    \n    results = []\n\n    for G_a in G_values:\n        G_b = G_a + delta_G\n\n        # Get BCS solutions for both vacua\n        u1a, v1a, u2a, v2a = get_bcs_solution(G_a, M, d)\n        u1b, v1b, u2b, v2b = get_bcs_solution(G_b, M, d)\n\n        # --- 1. Analytical Overlap Calculation ---\n        term1 = u1a * u1b + v1a * v1b\n        term2 = u2a * u2b + v2a * v2b\n        O_an = (term1**Omega1) * (term2**Omega2)\n\n        # --- 2. Numerical Overlap Calculation via Pfaffian ---\n        dim_sp = 2 * M  # Single-particle space dimension\n        \n        # Construct Bogoliubov U, V matrices\n        Ua, Va = np.zeros((dim_sp, dim_sp)), np.zeros((dim_sp, dim_sp))\n        Ub, Vb = np.zeros((dim_sp, dim_sp)), np.zeros((dim_sp, dim_sp))\n\n        for k in range(M):\n            idx = 2 * k\n            if k < Omega1:\n                u_a, v_a = u1a, v1a\n                u_b, v_b = u1b, v1b\n            else:\n                u_a, v_a = u2a, v2a\n                u_b, v_b = u2b, v2b\n\n            # For vacuum (a)\n            Ua[idx, idx], Ua[idx + 1, idx + 1] = u_a, u_a\n            Va[idx, idx + 1], Va[idx + 1, idx] = -v_a, v_a\n            \n            # For vacuum (b)\n            Ub[idx, idx], Ub[idx + 1, idx + 1] = u_b, u_b\n            Vb[idx, idx + 1], Vb[idx + 1, idx] = -v_b, v_b\n        \n        # Onishi matrix S = Ua.T @ Ub + Va.T @ Vb (dagger is transpose for real matrices)\n        S = Ua.T @ Ub + Va.T @ Vb\n        \n        # Skew-symmetric block matrix B\n        dim_B = 2 * dim_sp\n        B = np.zeros((dim_B, dim_B))\n        B[:dim_sp, dim_sp:] = S\n        B[dim_sp:, :dim_sp] = -S.T\n\n        # Compute Pfaffian of B\n        pf_B = pfaffian_pivoted(B)\n\n        # Compute overlap from Pfaffian\n        O_pf = np.sqrt(np.abs(pf_B))\n\n        # --- 3. Compute and store absolute difference ---\n        diff = np.abs(O_pf - O_an)\n        results.append(diff)\n    \n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}