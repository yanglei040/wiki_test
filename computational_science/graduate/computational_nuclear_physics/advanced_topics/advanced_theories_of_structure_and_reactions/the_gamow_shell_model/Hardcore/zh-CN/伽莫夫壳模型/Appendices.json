{
    "hands_on_practices": [
        {
            "introduction": "伽莫夫壳模型的核心是将传统的壳模型扩展到开放量子系统，其基石是伯格伦完备集，其中包含了束缚态、共振态和散射连续谱态。在构建多体模型之前，我们必须首先理解这些单粒子组分，特别是作为衰变准束缚态的共振态。本练习将引导你完成一个基础但至关重要的任务：在一个简单的球形方势阱中，通过求解薛定谔方程来确定一个$s$波伽莫夫态的位置，并提取其衰变宽度()。这个实践将理论概念（$S$矩阵的极点）与具体的数值计算联系起来，为你理解共振态的物理本质提供了坚实的动手经验。",
            "id": "3600450",
            "problem": "考虑一个单粒子中子，其在球对称、有限程势阱中由不含时径向薛定谔方程描述。该势为半径为 $R$、深度为 $V_0$ 的球方势阱，定义为当 $0 \\le r \\le R$ 时 $V(r) = -V_0$，当 $r > R$ 时 $V(r) = 0$。在非相对论量子力学框架下，使用标准的单粒子散射理论进行计算。取约化质量等于中子质量，并使用适用于 Gamow 壳模型中 Gamow 态的纯出射边界条件。使用以下物理常数：约化普朗克常数乘以光速等于 $\\hbar c = 197.3269804\\,\\text{MeV}\\cdot\\text{fm}$，中子质量等于 $m_n c^2 = 939.0\\,\\text{MeV}$。定义 $\\alpha \\equiv 2\\mu/\\hbar^2$，其中 $\\mu = m_n$。\n\n从轨道角动量为零（即 $l=0$ 的 s 波）的径向薛定谔方程以及势阱外纯出射的渐近行为要求出发，推导决定 S 矩阵极点位置的复超越方程。用复外部动量 $k$ 和内部动量 $q$ 表示此方程，其中 $k^2 = \\alpha E$，$q^2 = \\alpha(E + V_0)$，$E$ 为复能量。清晰地陈述在 $r=R$ 处导致该超越方程的匹配条件。\n\n将极点能量定义为 $E = E_r - i \\Gamma/2$，其中 $E_r$ 和 $\\Gamma$ 为实数，且 $\\Gamma \\ge 0$。对于任何满足纯出射边界条件且得出 $\\operatorname{Im}(E)  0$ 的解，使用 $\\Gamma = -2\\,\\operatorname{Im}(E)$ 提取以 $\\text{MeV}$ 为单位的宽度 $\\Gamma$。如果 $\\operatorname{Im}(E) \\ge 0$，则报告宽度为 $0$。\n\n算法任务：实现一个稳健的数值求解器，用于求解您推导出的复超越方程，其中以复变量 $k$ 为未知数。使用复数平方根的主支来定义 $q = \\sqrt{k^2 + \\alpha V_0}$。求解位于复 $k$ 平面第四象限（$\\operatorname{Re}(k) > 0$ 且 $\\operatorname{Im}(k)  0$）且具有最小正实能量 $E_r = \\operatorname{Re}(k^2/\\alpha)$ 的 s 波极点。如果多个极点满足这些标准，选择 $E_r$ 最小的那个。如果没有找到这样的极点，则返回宽度 $0$。\n\n数值单位和输出规范：所有能量以 $\\text{MeV}$ 表示，所有长度以 $\\text{fm}$ 表示。您的程序必须为以下 $(V_0, R)$ 参数集测试套件计算宽度 $\\Gamma$：\n- $(V_0, R) = (50.0\\,\\text{MeV}, 4.0\\,\\text{fm})$\n- $(V_0, R) = (50.0\\,\\text{MeV}, 5.0\\,\\text{fm})$\n- $(V_0, R) = (30.0\\,\\text{MeV}, 4.0\\,\\text{fm})$\n- $(V_0, R) = (70.0\\,\\text{MeV}, 3.0\\,\\text{fm})$\n- $(V_0, R) = (10.0\\,\\text{MeV}, 4.0\\,\\text{fm})$\n\n您的算法必须是自包含和确定性的，无需用户输入。为提高稳健性，您可以对复动量 $k$ 使用多个初始猜测值，这些值位于 $k \\approx m\\pi/R$（$m$ 为小整数）附近，每个都带有一个小的负虚部，然后根据上述选择规则挑选有效根。在复数运算中使用主平方根。\n\n您的程序应生成单行输出，其中包含五个宽度值，以逗号分隔，并用方括号括起，每个宽度值四舍五入到小数点后六位，例如 $\\texttt{[0.123456,0.000000,0.987654,0.111111,0.222222]}$。",
            "solution": "该问题要求推导并数值求解球方势阱中 s 波 Gamow 态的超越方程。Gamow 态是对应于复能量 $E = E_r - i\\Gamma/2$ 的不含时薛定谔方程的解，代表一个随时间衰变的准束缚态或共振态。能量的虚部与衰变宽度 $\\Gamma$ 相关。\n\n出发点是轨道角动量为零（$l=0$）时，约化径向波函数 $u(r) = r\\psi(r)$ 的径向薛定谔方程：\n$$\n-\\frac{\\hbar^2}{2\\mu} \\frac{d^2u(r)}{dr^2} + V(r)u(r) = E u(r)\n$$\n在此，$\\mu$ 是约化质量，取为中子质量 $m_n$。势 $V(r)$ 是一个深度为 $V_0 > 0$、半径为 $R$ 的有限球方势阱：\n$$\nV(r) =\n\\begin{cases}\n-V_0  \\text{for } 0 \\le r \\le R \\\\\n0  \\text{for } r > R\n\\end{cases}\n$$\n我们定义常数 $\\alpha \\equiv 2\\mu/\\hbar^2$。该方程在两个区域中进行分析。\n\n在内部区域（$0 \\le r \\le R$），方程为：\n$$\n\\frac{d^2u_I(r)}{dr^2} + \\alpha(E + V_0)u_I(r) = 0\n$$\n定义内部波数 $q$ 使得 $q^2 = \\alpha(E + V_0)$，方程简化为简谐振子形式：\n$$\n\\frac{d^2u_I(r)}{dr^2} + q^2 u_I(r) = 0\n$$\n通解为 $u_I(r) = A'\\sin(qr) + B'\\cos(qr)$。物理要求全波函数 $\\psi(r) = u(r)/r$ 在原点保持有限，这意味着 $u(0)=0$。该边界条件强制 $B'=0$，从而得到内部解：\n$$\nu_I(r) = A \\sin(qr)\n$$\n其中 $A$ 是一个归一化常数。\n\n在外部区域（$r > R$），势为零，$V(r)=0$，方程变为：\n$$\n\\frac{d^2u_{II}(r)}{dr^2} + \\alpha E u_{II}(r) = 0\n$$\n定义外部波数 $k$ 使得 $k^2 = \\alpha E$，方程为：\n$$\n\\frac{d^2u_{II}(r)}{dr^2} + k^2 u_{II}(r) = 0\n$$\n通解是入射球面波 $e^{-ikr}$ 和出射球面波 $e^{ikr}$ 的叠加。Gamow 态作为 S 矩阵的极点，由纯出射边界条件定义。此条件要求入射波的系数为零。因此，外部解为：\n$$\nu_{II}(r) = C e^{ikr}\n$$\n其中 $C$ 是一个常数。对于共振态，能量 $E$ 是复数，波数 $k$ 也是复数。具体来说，对于一个衰变态，我们预期 $\\operatorname{Im}(E)  0$，这意味着 $k$ 位于复平面的第四象限（$\\operatorname{Re}(k) > 0$ 且 $\\operatorname{Im}(k)  0$）。这确保了概率密度 $|\\psi_{II}(r,t)|^2 \\propto |e^{i(kr - Et/\\hbar)}/r|^2$ 随 $r$ 指数增长，这是非物理的 Gamow 态的一个特征。\n\n为了找到允许的复能量，我们在边界 $r=R$ 处施加波函数 $u(r)$ 及其一阶导数 $u'(r)$ 的连续性条件。匹配条件是：\n1.  $u_I(R) = u_{II}(R) \\implies A \\sin(qR) = C e^{ikR}$\n2.  $u_I'(R) = u_{II}'(R) \\implies A q \\cos(qR) = C (ik) e^{ikR}$\n\n为了得到一个不依赖于常数 $A$ 和 $C$ 的方程，我们将第二个方程除以第一个方程（假设 $A, C,$ 和 $\\sin(qR)$ 均不为零）：\n$$\n\\frac{A q \\cos(qR)}{A \\sin(qR)} = \\frac{C (ik) e^{ikR}}{C e^{ikR}}\n$$\n这得到了 S 矩阵极点的复超越方程：\n$$\nq \\cot(qR) = ik\n$$\n该方程的解是 Gamow 态的复动量 $k$。内部动量 $q$ 通过定义 $k^2 = \\alpha E$ 和 $q^2 = \\alpha(E+V_0)$ 与 $k$ 相关联，这给出 $q^2 = k^2 + \\alpha V_0$。我们使用复数平方根的主支来定义 $q = \\sqrt{k^2 + \\alpha V_0}$。\n\n算法任务是对此方程进行数值求解，求解复变量 $k$。为了更好的数值稳定性，特别是在余切函数的极点附近，方程被重写为 $q \\cos(qR) - ik \\sin(qR) = 0$。这种形式的根与原方程的根相同，除了 $\\sin(qR)=0$ 的特殊情况，这些情况对应于无限深势阱的束缚态，不是我们所寻求的解。\n\n算法流程如下：\n1.  使用给定的物理常数计算常数 $\\alpha = 2 m_n c^2 / (\\hbar c)^2$。\n2.  对于每对参数 $(V_0, R)$，使用数值求根算法求解复方程 $f(k) = q \\cos(qR) - ik \\sin(qR) = 0$。\n3.  为了找到所需的极点，使用多个 $k$ 的初始猜测值进行搜索。共振通常被视为无限深势阱的“泄漏”束缚态。半径为 $R$ 的无限深势阱中的态的波数是实数，$k_m = m\\pi/R$（$m$ 为正整数）。因此，共振极点的良好初始猜测值是靠近这些值的复数，并带有一个小的负虚部，例如，$k_{\\text{guess}} = m\\pi/R - i\\delta$（$\\delta > 0$）。\n4.  求解器找到的每个根 $k_{\\text{sol}}$ 都需要根据问题的标准进行验证：\n    - 极点必须在第四象限：$\\operatorname{Re}(k_{\\text{sol}}) > 0$ 且 $\\operatorname{Im}(k_{\\text{sol}})  0$。\n    - 相应能量的实部，$E_r = \\operatorname{Re}(k_{\\text{sol}}^2/\\alpha)$，必须为正。\n5.  收集从各种初始猜测值中找到的所有有效极点。如果多个不同的极点满足标准，则按其实能量 $E_r$ 进行排序。选择具有最小正 $E_r$ 的那个。\n6.  从选定的极点的复动量 $k_{\\text{pole}}$，计算复能量 $E = k_{\\text{pole}}^2 / \\alpha$。\n7.  使用关系式 $\\Gamma = -2\\operatorname{Im}(E)$ 提取衰变宽度 $\\Gamma$。根据选择标准（$\\operatorname{Re}(k)>0, \\operatorname{Im}(k)0$），$\\operatorname{Im}(E)$ 将为负，从而得到一个正的宽度 $\\Gamma$。如果没有找到这样的极点，宽度报告为 $0$。最终值格式化为六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root\n\ndef solve():\n    \"\"\"\n    Derives and solves the transcendental equation for s-wave Gamow states\n    in a spherical square well potential.\n    \"\"\"\n\n    # Physical constants\n    HBARC = 197.3269804  # MeV * fm\n    M_N_C2 = 939.0      # MeV\n    ALPHA = 2.0 * M_N_C2 / HBARC**2  # MeV^-1 * fm^-2\n\n    # Test cases from the problem statement: (V0 in MeV, R in fm)\n    test_cases = [\n        (50.0, 4.0),\n        (50.0, 5.0),\n        (30.0, 4.0),\n        (70.0, 3.0),\n        (10.0, 4.0),\n    ]\n\n    results = []\n    for V0, R in test_cases:\n        pole_k = find_gamow_pole(V0, R, ALPHA)\n        \n        if pole_k is not None:\n            # Calculate complex energy E from the pole momentum k\n            E = pole_k**2 / ALPHA\n            # Calculate width Gamma = -2 * Im(E)\n            # Im(E) is guaranteed to be  0 for a valid pole, so Gamma > 0.\n            # The problem asks to report Gamma=0 if Im(E) >= 0; this is a safeguard.\n            gamma = -2 * E.imag if E.imag  0 else 0.0\n        else:\n            # If no valid pole is found, width is 0\n            gamma = 0.0\n        \n        results.append(f\"{gamma:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef find_gamow_pole(V0, R, alpha):\n    \"\"\"\n    Finds the s-wave Gamow pole with the smallest positive real energy.\n    \n    Args:\n        V0 (float): Potential well depth in MeV.\n        R (float): Potential well radius in fm.\n        alpha (float): Constant 2*mu/hbar^2 in MeV^-1 * fm^-2.\n\n    Returns:\n        complex or None: The complex momentum k of the desired pole, or None if not found.\n    \"\"\"\n\n    def target_function(k_vec, V0_in, R_in, alpha_in):\n        \"\"\"\n        Target function f(k) = q*cos(qR) - i*k*sin(qR) = 0 for the root finder.\n        The input k_vec is a real array [Re(k), Im(k)].\n        The output is a real array [Re(f(k)), Im(f(k))].\n        This form avoids poles of cot(qR).\n        \"\"\"\n        k = k_vec[0] + 1j * k_vec[1]\n        \n        # Avoid k=0\n        if abs(k)  1e-9:\n            return [1e10, 1e10]\n\n        q_squared = k**2 + alpha_in * V0_in\n        q = np.sqrt(q_squared) # Principal square root\n        \n        qR = q * R_in\n\n        # Numerically stable form of the transcendental equation\n        val = q * np.cos(qR) - 1j * k * np.sin(qR)\n        \n        return [val.real, val.imag]\n\n    found_poles = []\n    \n    # Grid of initial guesses for k = k_r + i*k_i\n    # Guesses are based on resonances being \"leaky\" bound states of an infinite well (k_r ~ m*pi/R)\n    m_vals = range(1, 15)\n    im_k_vals = np.linspace(-0.01, -0.8, 20)\n\n    for m in m_vals:\n        re_k_guess = m * np.pi / R\n        for im_k_guess in im_k_vals:\n            k_guess = np.array([re_k_guess, im_k_guess])\n            \n            sol = root(target_function, k_guess, args=(V0, R, alpha), method='hybr', tol=1e-9)\n\n            if sol.success:\n                k_sol = sol.x[0] + 1j * sol.x[1]\n\n                # Verify that it is a genuine root\n                res = target_function(sol.x, V0, R, alpha)\n                if np.sqrt(res[0]**2 + res[1]**2) > 1e-7:\n                    continue\n\n                # Validate the pole based on problem criteria\n                # 1. Pole in 4th quadrant (Re(k) > 0, Im(k)  0)\n                if k_sol.real = 0 or k_sol.imag >= 0:\n                    continue\n                \n                # 2. Smallest positive real energy E_r\n                E = k_sol**2 / alpha\n                if E.real = 0:\n                    continue\n                    \n                found_poles.append((E.real, k_sol))\n\n    if not found_poles:\n        return None\n\n    # Sort poles by the real part of the energy\n    found_poles.sort(key=lambda x: x[0])\n    \n    # Filter out duplicate solutions found from different initial guesses\n    unique_poles = []\n    for pole in found_poles:\n        is_duplicate = False\n        for unique_pole in unique_poles:\n            # Check if k-values are very close\n            if np.isclose(pole[1], unique_pole[1], rtol=1e-5, atol=1e-5):\n                is_duplicate = True\n                break\n        if not is_duplicate:\n            unique_poles.append(pole)\n\n    # Return the k of the pole with the smallest positive E_r\n    if unique_poles:\n        return unique_poles[0][1]\n    else:\n        return None\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "理解了单个共振态是如何从单粒子势中产生之后，下一步自然是学习如何将这些态作为基石来构建一个多体理论。本练习将指导你构建一个极小化的双中子伽莫夫壳模型，这是一个探索开放量子系统中多体现象的理想“玩具模型”()。你将亲手构造一个包含一个共振态和离散化连续谱的伯格伦基，并在此基础上建立一个包含对力相互作用的复对称哈密顿量。通过求解这个哈密顿量的本征问题，你将能够分析不同组态之间的混合，直观地看到剩余相互作用是如何影响一个弱束缚系统的结构的。",
            "id": "3600461",
            "problem": "在一个单一的 $p_{3/2}$ 分波中，使用一个显式的共振单粒子态和沿着一条旋转的复能量围线离散化的非共振连续谱，实现一个最小双中子 Gamow 壳模型 (GSM)。构建总角动量 $J=0$、具有秩为一的可分离配对剩余相互作用的复对称双体哈密顿量，并分析当配对强度变化时，共振-共振组态的组态混合情况。\n\n您必须从以下原理和核心定义出发：\n\n- Berggren 完备性：一个包含束缚态和共振 Gamow 态以及沿着复动量或复能量平面上的一条围线离散化的非共振连续谱的单粒子基，构成一个完备集。在计算中，连续谱积分通过使用具有正权重的离散点进行求积来近似。\n- 对于单个 $p_{3/2}$ 分波，只考虑耦合到总角动量 $J=0$ 的双中子态。\n- 在 Berggren 基中构建时，复能量单粒子哈密顿量会产生一个复对称（非厄米）的双体哈密顿量。右本征矢量通过求解一个广义复对称本征问题得到。\n- 一个秩为一的可分离配对剩余相互作用会产生一个外积形式的双体矩阵。\n\n基于这些原理，实现以下具体的模型选择，不要引入任何额外的假设：\n\n1. 单粒子谱：\n   - 一个具有复能量 $E_{r} = 2.0 - i\\,0.2$（单位为兆电子伏特 MeV）的共振 Gamow 极点。其求积权重固定为 $w_{r} = 1.0$。\n   - 一个由复能量平面上一条直线上 $N$ 个点表示的非共振连续谱，参数化为\n     $$E(s) = s\\,e^{-2 i \\theta}, \\quad s \\in (0, E_{\\max}),$$\n     其中 $E_{\\max} > 0$ 是一个实能量截断，$\\theta > 0$ 是一个以弧度为单位的旋转角。使用含 $N$ 个点的中点法则：\n     $$s_{n} = \\left(n - \\tfrac{1}{2}\\right)\\frac{E_{\\max}}{N}, \\quad n = 1,2,\\dots,N,$$\n     连续谱求积权重为\n     $$w_{n} = \\frac{E_{\\max}}{N}.$$\n     单粒子列表则为 $\\{(E_{r}, w_{r}), (E(s_{1}), w_{1}), \\dots, (E(s_{N}), w_{N})\\}$。\n\n2. 双粒子 $J=0$ 基和哈密顿量：\n   - 构建由无序对 $(i,j)$（其中 $i \\le j$）标记的反对称化双粒子基矢，每个索引遍历包括共振态和 $N$ 个连续谱点的完整单粒子集。假设所有单粒子态都具有相同的 $j=3/2$。\n   - 未微扰的双体能量为\n     $$H_{0,(ij),(ij)} = E_{i} + E_{j}.$$\n   - 包含一个秩为一的可分离配对剩余相互作用\n     $$V = -G\\,|U\\rangle \\langle U|,$$\n     其标量耦合强度为 $G \\ge 0$（单位 MeV），对形状因子分量为\n     $$U_{(ij)} = N_{ij}\\,\\sqrt{w_{i} w_{j}}, \\quad N_{ij} = \\begin{cases} 1  i \\ne j, \\\\ \\tfrac{1}{\\sqrt{2}}  i=j. \\end{cases}$$\n     这会产生复对称矩阵元\n     $$V_{(ij),(kl)} = -G\\,U_{(ij)}\\,U_{(kl)}.$$\n   - 完整的双体哈密顿量为\n     $$H = H_{0} + V,$$\n     它是复对称的。\n\n3. 本征问题和可观测量：\n   - 对角化 $H$ 以获得本征值 $\\{\\mathcal{E}_{\\alpha}\\}$ 和右本征矢量 $\\{|\\Psi_{\\alpha}\\rangle\\}$。\n   - 选择“基态”作为本征值的实部 $\\mathrm{Re}\\,\\mathcal{E}_{\\alpha}$ 最小的本征态。\n   - 为分析组态混合，关注共振-共振组态 $(i=j=\\text{resonance})$。设 $C_{\\mathrm{RR}}$ 是所选右本征矢量在此基矢上的分量。为了得到一个数值上稳健且实值的混合度量，使用标准欧几里得范数对右本征矢量进行归一化，即强制满足\n     $$\\sum_{p} |C_{p}|^{2} = 1,$$\n     并将共振-共振混合权重定义为\n     $$W_{\\mathrm{RR}} = |C_{\\mathrm{RR}}|^{2}.$$\n\n4. 单位和数值规范：\n   - 所有能量必须以兆电子伏特 (MeV) 表示。\n   - 所有角度必须以弧度为单位。\n   - 以 MeV 为单位报告基态能量的实部 $\\mathrm{Re}\\,\\mathcal{E}_{\\mathrm{gs}}$，并将混合权重 $W_{\\mathrm{RR}}$ 报告为无量纲小数。\n   - 将报告的两个数字都四舍五入到六位小数。\n\n5. 要求的输出格式：\n   - 您的程序应生成单行输出，其中包含每个测试用例的结果列表，每个结果本身是一个双元素列表 $[\\mathrm{Re}\\,\\mathcal{E}_{\\mathrm{gs}}, W_{\\mathrm{RR}}]$。最终输出必须是形如\n     $$\\big[ [x_{1},y_{1}], [x_{2},y_{2}], \\dots \\big],$$\n     的单行，其中每个 $x_{k}$ 和 $y_{k}$ 都是四舍五入到六位的小数，且没有多余的空格。\n\n需要实现和评估的测试套件：\n\n- 情况 A (理想路径)：$G = 0.25$ MeV, $N = 6$, $E_{\\max} = 10.0$ MeV, $\\theta = 0.34906585$ 弧度。\n- 情况 B (零耦合边界)：$G = 0.0$ MeV, $N = 6$, $E_{\\max} = 10.0$ MeV, $\\theta = 0.34906585$ 弧度。\n- 情况 C (更密的连续谱，更强的配对)：$G = 0.75$ MeV, $N = 10$, $E_{\\max} = 12.0$ MeV, $\\theta = 0.261799388$ 弧度。\n- 情况 D (最小连续谱的边缘情况)：$G = 1.2$ MeV, $N = 1$, $E_{\\max} = 8.0$ MeV, $\\theta = 0.34906585$ 弧度。\n\n您的程序必须完全按照规定构建哈密顿量，根据上述准则求解基态，在欧几里得归一化下计算 $W_{\\mathrm{RR}}$，并打印一行包含四个结果的、用逗号分隔并括在方括号中的列表，例如\n$$[[x_{A},y_{A}],[x_{B},y_{B}],[x_{C},y_{C}],[x_{D},y_{D}]].$$",
            "solution": "该问题提出了一个属于计算核物理领域的有效、适定且具有科学依据的任务。它要求针对单个 $p_{3/2}$ 分波实现一个最小双中子 Gamow 壳模型 (GSM)，并探讨在可分离配对相互作用下的组态混合。问题陈述是自洽的，提供了构建和求解模型所需的所有物理原理、数学定义和数值参数。我们将通过系统、分步的推导和构建来得出解决方案。\n\n问题的核心在于构建并对角化一个复对称的多体哈密顿量。这个哈密顿量建立在一种称为 Berggren 基的单粒子基上，该基是专为开放量子系统设计的。此类系统的特征是可能发生粒子发射，从而导致具有有限寿命的态（共振态），这些态由复能量描述。\n\n**步骤 1：构建单粒子 Berggren 基**\n\n模型的基础是单粒子基，根据 Berggren 完备性关系，该基由束缚态、共振 (Gamow) 态和离散化的非共振连续谱组成。问题指定了一个由一个共振态和一个离散化连续谱围线组成的基。设单粒子态的总数为 $K = N+1$。我们用索引 $i \\in \\{0, 1, \\dots, N\\}$ 来标记这些态。\n\n1.  **共振态 ($i=0$)：**\n    给定一个单独的共振极点，其复能量为 $E_0$，关联的求积权重为 $w_0$：\n    $$E_0 = E_r = (2.0 - i\\,0.2) \\, \\mathrm{MeV}$$\n    $$w_0 = w_r = 1.0$$\n\n2.  **离散化连续谱态 ($i=1, \\dots, N$)：**\n    连续谱由复能量平面上一条旋转围线上的 $N$ 个态表示，$E(s) = s\\,e^{-2i\\theta}$。连续谱上的积分通过使用中点法则的求积和来近似。沿围线路径的第 $n$ 个离散点 $s_n$ 及其关联的能量 $E_n$ 和权重 $w_n$ 由下式给出：\n    $$s_n = \\left(n - \\frac{1}{2}\\right) \\frac{E_{\\max}}{N}, \\quad \\text{for } n = 1, 2, \\dots, N$$\n    连续谱态（我们将其索引为 $i=1$ 到 $N$）对应的复能量为：\n    $$E_i = s_i \\, e^{-2i\\theta}, \\quad \\text{for } i = 1, 2, \\dots, N$$\n    这些连续谱态的求积权重为：\n    $$w_i = \\frac{E_{\\max}}{N}, \\quad \\text{for } i = 1, 2, \\dots, N$$\n    这就定义了完整的单粒子能量集合 $\\{E_i\\}_{i=0}^{N}$ 和权重集合 $\\{w_i\\}_{i=0}^{N}$。\n\n**步骤 2：构建 $J=0$ 的双体哈密顿量**\n\n双中子哈密顿量 $H$ 是未微扰双体哈密顿量 $H_0$ 和剩余配对相互作用 $V$ 的和。我们在由先前定义的单粒子态构成的反对称化双粒子态 $|\\phi_{ij}\\rangle$ 的基中构建此哈密顿量。对于处于同一 $j=3/2$ 壳层并耦合至总角动量 $J=0$ 的两个中子，基矢可以由无序对 $(i,j)$ 索引，其中 $i, j \\in \\{0, 1, \\dots, N\\}$ 且 $i \\le j$。\n\n这个双体希尔伯特空间的维度是 $M = \\frac{(N+1)(N+2)}{2}$。我们通过按字典序排列对偶索引 $(i,j)$，即 $(0,0), (0,1), \\dots, (0,N), (1,1), \\dots, (N,N)$，来建立一个从单个矩阵索引 $p \\in \\{0, 1, \\dots, M-1\\}$ 到对偶索引 $(i,j)$ 的映射。\n\n1.  **未微扰哈密顿量 ($H_0$)：**\n    在这个基中，$H_0$ 是对角的。中子占据单粒子态 $i$ 和 $j$ 的双体态的能量就是它们能量的总和。\n    $$H_{0,p,q} = (E_i + E_j) \\, \\delta_{pq}$$\n    其中对偶 $(i,j)$ 对应于索引 $p$。\n\n2.  **可分离配对相互作用 ($V$)：**\n    相互作用以秩为一的可分离势给出，$V = -G |U\\rangle\\langle U|$，其中 $G$ 是配对强度，而 $|U\\rangle$ 是双体基中的对形状因子矢量。$V$ 的矩阵元为：\n    $$V_{p,q} = -G \\, U_p \\, U_q$$\n    其中 $p$ 和 $q$ 分别对应对偶 $(i,j)$ 和 $(k,l)$。对应于对偶 $(i,j)$ 的分量 $U_p$ 定义为：\n    $$U_p \\equiv U_{(ij)} = N_{ij} \\sqrt{w_i w_j}$$\n    归一化因子 $N_{ij}$ 源于双中子波函数的反对称化：\n    $$N_{ij} = \\begin{cases} \\frac{1}{\\sqrt{2}}  \\text{if } i = j \\\\ 1  \\text{if } i \\ne j \\end{cases}$$\n\n3.  **完整哈密顿量 ($H$)：**\n    完整的哈密顿矩阵是和 $H = H_0 + V$。\n    $$H_{p,q} = (E_i + E_j) \\, \\delta_{pq} - G \\, U_p \\, U_q$$\n    这个矩阵是复对称的 ($H = H^T$)，但不是厄米的 ($H \\ne H^\\dagger$)，这是 Berggren 基中哈密顿量的一个典型特征。\n\n**步骤 3：本征问题求解和可观测量计算**\n\n最后一步是求解双中子系统的定态薛定谔方程，它具有矩阵本征值问题的形式：\n$$H |\\Psi_\\alpha\\rangle = \\mathcal{E}_\\alpha |\\Psi_\\alpha\\rangle$$\n我们使用一个能够处理复非厄米矩阵的标准数值本征求解器，来找到复本征值 $\\{\\mathcal{E}_\\alpha\\}$ 及其对应的右本征矢量 $\\{|\\Psi_\\alpha\\rangle\\}$。\n\n1.  **基态识别：**\n    问题将基态定义为本征值实部最小的本征态。在开放量子系统理论中，一个复本征值的实部被解释为多体态的能量，这是一种惯例。\n    $$\\mathcal{E}_{\\mathrm{gs}} = \\min_{\\alpha} \\{\\mathrm{Re}(\\mathcal{E}_\\alpha)\\}$$\n    我们识别出这个本征值 $\\mathcal{E}_{\\mathrm{gs}}$ 及其关联的本征矢量 $|\\Psi_{\\mathrm{gs}}\\rangle$。\n\n2.  **组态混合分析：**\n    我们关心的是发现系统处于共振-共振 (RR) 组态的概率，在此组态中，两个中子都占据共振 Gamow 态 ($i=j=0$)。\n    -   识别对应于 RR 组态的基矢。在我们的字典序中，这对应于第一个基矢，$p=0$。\n    -   设基态本征矢量的分量为 $C_p$，即 $|\\Psi_{\\mathrm{gs}}\\rangle = \\sum_p C_p |\\phi_p\\rangle$。RR 分量是 $C_{\\mathrm{RR}} = C_0$。\n    -   问题为计算混合权重指定了一种非标准的欧几里得归一化方法。我们对本征矢量进行归一化，使得 $\\sum_p |C_p|^2 = 1$。\n    -   混合权重 $W_{\\mathrm{RR}}$ 随后被定义为归一化 RR 分量的模平方：\n    $$W_{\\mathrm{RR}} = |C_{\\mathrm{RR}}|^2 / \\sum_{p=0}^{M-1} |C_p|^2$$\n\n该算法的流程是为每个给定的测试用例实施这三个步骤，计算基态能量 $\\mathrm{Re}(\\mathcal{E}_{\\mathrm{gs}})$ 和混合权重 $W_{\\mathrm{RR}}$，并以指定的精度报告结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve_case(G, N, E_max, theta):\n    \"\"\"\n    Solves a single case of the two-neutron Gamow Shell Model.\n    \"\"\"\n    # Step 1: Construct the single-particle Berggren basis\n    # The basis consists of one resonant state and N continuum states.\n    num_sp_states = N + 1\n    sp_energies = np.zeros(num_sp_states, dtype=np.complex128)\n    sp_weights = np.zeros(num_sp_states, dtype=np.float64)\n\n    # Resonant state (index 0)\n    sp_energies[0] = 2.0 - 0.2j\n    sp_weights[0] = 1.0\n\n    # Discretized continuum states (indices 1 to N)\n    if N > 0:\n        s_n = (np.arange(1, N + 1) - 0.5) * E_max / N\n        continuum_energies = s_n * np.exp(-2j * theta)\n        continuum_weights = np.full(N, E_max / N)\n        \n        sp_energies[1:] = continuum_energies\n        sp_weights[1:] = continuum_weights\n\n    # Step 2: Construct the two-body Hamiltonian for J=0\n    \n    # Create a mapping from a flat matrix index 'p' to a pair of sp state indices (i, j)\n    basis_pairs = []\n    for i in range(num_sp_states):\n        for j in range(i, num_sp_states):\n            basis_pairs.append((i, j))\n    \n    dim = len(basis_pairs)\n    H = np.zeros((dim, dim), dtype=np.complex128)\n\n    # Construct H0 (diagonal part) and the U vector for the interaction\n    U = np.zeros(dim, dtype=np.float64)\n    for p, (i, j) in enumerate(basis_pairs):\n        # Unperturbed energy (diagonal part of H)\n        H[p, p] = sp_energies[i] + sp_energies[j]\n        \n        # Form factor component U_p\n        N_ij = 1.0 / np.sqrt(2.0) if i == j else 1.0\n        U[p] = N_ij * np.sqrt(sp_weights[i] * sp_weights[j])\n\n    # Construct V (interaction part) and add to H\n    V = -G * np.outer(U, U)\n    H += V\n\n    # Step 3: Solve the eigenvalue problem and compute observables\n    eigenvalues, eigenvectors = linalg.eig(H)\n    \n    # Identify the ground state (smallest real part of eigenvalue)\n    gs_index = np.argmin(np.real(eigenvalues))\n    gs_energy_re = np.real(eigenvalues[gs_index])\n    gs_vector = eigenvectors[:, gs_index]\n    \n    # The RR configuration corresponds to the first basis state (p=0)\n    # due to the lexicographical ordering of pairs (0,0), (0,1),...\n    C_RR = gs_vector[0]\n    \n    # The problem specifies using Euclidean norm for the mixing weight.\n    # Eigenvectors from linalg.eig are already normalized to have Euclidean norm 1.\n    # So, sum(|C_p|^2) is already 1.\n    W_RR = np.abs(C_RR)**2\n\n    return gs_energy_re, W_RR\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: Happy path\n        # G (MeV), N, E_max (MeV), theta (rad)\n        (0.25, 6, 10.0, 0.34906585),\n        # Case B: Zero coupling boundary\n        (0.0, 6, 10.0, 0.34906585),\n        # Case C: Denser continuum, stronger pairing\n        (0.75, 10, 12.0, 0.261799388),\n        # Case D: Edge case with minimal continuum\n        (1.2, 1, 8.0, 0.34906585)\n    ]\n\n    all_results = []\n    for G, N, E_max, theta in test_cases:\n        gs_energy_re, W_RR = solve_case(G, N, E_max, theta)\n        all_results.append(f\"[{gs_energy_re:.6f},{W_RR:.6f}]\")\n\n    print(f\"[{','.join(all_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "伽莫夫壳模型成功地描述了开放量子系统，但它依赖于非厄米量子力学的数学框架，这与我们所熟悉的描述封闭系统的理论有所不同。本练习聚焦于这一框架的核心概念：双正交性()。由于哈密顿量是复对称而非厄米的，其左、右本征矢量不再通过简单的共轭转置相关联。你将学习如何正确地对这些左右本征矢量进行归一化，并使用正确的“c-积”来计算期望值，从而验证理论的一致性。通过将伽莫夫壳模型的方法与传统的厄米方法进行直接的数值比较，你将深刻理解为何在处理共振和连续谱时，必须采用这一独特的数学形式。",
            "id": "3600507",
            "problem": "您的任务是在伽莫夫壳模型（Gamow shell model, GSM）中实现并验证双正交归一化和依赖于度规的期望值。GSM是一种计算核物理框架，它采用复对称哈密顿量来描述具有共振态和散射态的开放量子系统。伽莫夫壳模型（GSM）使用Berggren系综，这导致了一个复对称哈密顿量，因此其左、右本征矢之间不是通过厄米共轭相关联。取而代之的是，合适的内积是所谓的复对称积，也称为$c$-积，其定义中不包含复共轭。\n\n从非厄米线性代数的基本原理和复对称矩阵的谱性质出发，设$H$为一个满足$H = H^{\\mathrm{T}}$的复对称哈密顿矩阵，并设$O$为一个由矩阵表示的可观测量，该矩阵不保证与$H$对易。右本征矢 $\\{ \\lvert \\Psi_n \\rangle \\}$ 满足 $H \\lvert \\Psi_n \\rangle = E_n \\lvert \\Psi_n \\rangle$，而左本征矢 $\\{ \\langle \\tilde{\\Psi}_n \\rvert \\}$ 满足 $\\langle \\tilde{\\Psi}_n \\rvert H = E_n \\langle \\tilde{\\Psi}_n \\rvert$，这等价于 $(H^{\\mathrm{T}}) \\lvert \\tilde{\\Psi}_n \\rangle = E_n \\lvert \\tilde{\\Psi}_n \\rangle$，其中 $\\langle \\tilde{\\Psi}_n \\rvert = \\lvert \\tilde{\\Psi}_n \\rangle^{\\mathrm{T}}$。在GSM中的双正交归一化条件是 $\\langle \\tilde{\\Psi}_m \\vert \\Psi_n \\rangle = \\delta_{mn}$，其中 $\\langle \\tilde{\\Psi} \\vert$ 表示$c$-积的转置bra。GSM中的期望值则取为 $\\langle \\tilde{\\Psi} \\vert \\mathcal{O} \\vert \\Psi \\rangle$，这与标准的厄米度规期望值 $\\langle \\Psi \\vert \\mathcal{O} \\vert \\Psi \\rangle$ 不同。\n\n您将：\n- 对两个给定的复对称哈密顿量，在$c$-积下实现双正交归一化。\n- 验证$H$在其本征态下，使用$c$-积计算的期望值等于其本征值，即 $\\langle \\tilde{\\Psi}_n \\vert H \\vert \\Psi_n \\rangle = E_n$。\n- 与厄米度规期望值 $\\langle \\Psi_n \\vert H \\vert \\Psi_n \\rangle$ 进行比较（其中 $\\lvert \\Psi_n \\rangle$ 在厄米度规下进行了标准归一化）。\n- 通过在三种度规下评估 $\\langle \\cdot \\vert [O_1, O_2] \\vert \\cdot \\rangle$ 的大小，探究不同度规约定如何影响对非对易可观测量的估计：GSM $c$-积、厄米度规，以及使用正定度规算符 $\\eta$ 的广义度规。\n\n使用以下显式$3 \\times 3$复对称矩阵测试套件，其中$\\mathrm{i}$表示虚数单位。\n\n哈密顿量 $H_1$：\n$$\nH_1 = \\begin{pmatrix}\n-2.0 + 0.5\\,\\mathrm{i}  0.35  0.15\\,\\mathrm{i} \\\\\n0.35  -1.2 + 0.8\\,\\mathrm{i}  0.27 - 0.05\\,\\mathrm{i} \\\\\n0.15\\,\\mathrm{i}  0.27 - 0.05\\,\\mathrm{i}  -0.4 + 1.1\\,\\mathrm{i}\n\\end{pmatrix}.\n$$\n\n哈密顿量 $H_2$：\n$$\nH_2 = \\begin{pmatrix}\n-1.0 + 0.3\\,\\mathrm{i}  0.2 + 0.02\\,\\mathrm{i}  0.05\\,\\mathrm{i} \\\\\n0.2 + 0.02\\,\\mathrm{i}  -0.98 + 0.31\\,\\mathrm{i}  0.18 - 0.01\\,\\mathrm{i} \\\\\n0.05\\,\\mathrm{i}  0.18 - 0.01\\,\\mathrm{i}  -0.6 + 0.95\\,\\mathrm{i}\n\\end{pmatrix}.\n$$\n\n用于$H_1$的算符 $O_1$ 和 $O_2$：\n$$\nO_1^{(1)} = \\begin{pmatrix}\n1.0  0.1  -0.05\\,\\mathrm{i} \\\\\n0.1  0.5  0.07 + 0.02\\,\\mathrm{i} \\\\\n-0.05\\,\\mathrm{i}  0.07 + 0.02\\,\\mathrm{i}  -0.2\n\\end{pmatrix}, \\quad\nO_2^{(1)} = \\begin{pmatrix}\n0.3  -0.06 + 0.03\\,\\mathrm{i}  0.12 \\\\\n-0.06 + 0.03\\,\\mathrm{i}  -0.1  -0.09\\,\\mathrm{i} \\\\\n0.12  -0.09\\,\\mathrm{i}  0.8\n\\end{pmatrix}.\n$$\n\n用于$H_2$的算符 $O_1$ 和 $O_2$（构造为在一个标量位移内对易，作为一个边界情况）：\n$$\nO_1^{(2)} = \\begin{pmatrix}\n0.9  0.02  -0.01\\,\\mathrm{i} \\\\\n0.02  0.88  0.015 \\\\\n-0.01\\,\\mathrm{i}  0.015  0.1\n\\end{pmatrix}, \\quad\nO_2^{(2)} = O_1^{(2)} + 0.001\\,I,\n$$\n其中$I$是单位矩阵。\n\n广义度规算符（对角且正定）：\n$$\n\\eta_1 = \\mathrm{diag}(1.0, 0.5, 2.0), \\quad \\eta_2 = \\mathrm{diag}(0.7, 1.1, 1.5).\n$$\n\n计算任务：\n1. 对于每个哈密顿量 $H \\in \\{H_1, H_2\\}$，计算其右本征对 $\\{(E_n, \\lvert \\Psi_n \\rangle)\\}$ 和来自 $H^{\\mathrm{T}}$ 的左本征矢 $\\{\\lvert \\tilde{\\Psi}_n \\rangle\\}$，并执行双正交归一化，使得 $\\langle \\tilde{\\Psi}_m \\vert \\Psi_n \\rangle = \\delta_{mn}$，其中内积为$c$-积，定义为 $\\langle \\tilde{\\Psi} \\vert = \\lvert \\tilde{\\Psi} \\rangle^{\\mathrm{T}}$ 和 $\\langle \\tilde{\\Psi} \\vert \\Psi \\rangle = \\lvert \\tilde{\\Psi} \\rangle^{\\mathrm{T}} \\lvert \\Psi \\rangle$。\n2. 验证所选本征态 $\\lvert \\Psi_{*} \\rangle$ 的GSM期望值一致性，该本征态选为$E_n$虚部绝对值最小的态（解释为最窄共振）：计算GSM期望值 $\\langle \\tilde{\\Psi}_{*} \\vert H \\vert \\Psi_{*} \\rangle$ 并报告差值的绝对值 $\\left\\lvert \\langle \\tilde{\\Psi}_{*} \\vert H \\vert \\Psi_{*} \\rangle - E_{*} \\right\\rvert$。\n3. 计算$H$在同一本征态下的厄米度规期望值，其中右本征矢在厄米范数下归一化，即定义 $\\lvert \\Phi_{*} \\rangle = \\lvert \\Psi_{*} \\rangle / \\sqrt{\\langle \\Psi_{*} \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}}$，其中 $\\langle \\Psi \\vert \\Psi \\rangle_{\\mathrm{Herm}} = \\lvert \\Psi \\rangle^{\\dagger} \\lvert \\Psi \\rangle$，并报告差值的绝对值 $\\left\\lvert \\langle \\Phi_{*} \\vert H \\vert \\Phi_{*} \\rangle - E_{*} \\right\\rvert$。\n4. 对于每对 $(O_1^{(k)}, O_2^{(k)})$，$k \\in \\{1,2\\}$，计算对易子 $[O_1^{(k)}, O_2^{(k)}] = O_1^{(k)} O_2^{(k)} - O_2^{(k)} O_1^{(k)}$，并在选定的本征态 $\\lvert \\Psi_{*} \\rangle$ 下，根据三种度规约定评估其期望值的绝对值：\n   - GSM $c$-积：$\\left\\lvert \\langle \\tilde{\\Psi}_{*} \\vert [O_1^{(k)}, O_2^{(k)}] \\vert \\Psi_{*} \\rangle \\right\\rvert$。\n   - 厄米度规：$\\left\\lvert \\langle \\Phi_{*} \\vert [O_1^{(k)}, O_2^{(k)}] \\vert \\Phi_{*} \\rangle \\right\\rvert$。\n   - 广义 $\\eta$-度规：$\\left\\lvert \\frac{\\langle \\Psi_{*} \\vert \\eta_k [O_1^{(k)}, O_2^{(k)}] \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}}{\\langle \\Psi_{*} \\vert \\eta_k \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}} \\right\\rvert$。\n5. 关于双正交归一化的质量，检查完整的双正交性矩阵 $B$（其元素为 $B_{mn} = \\langle \\tilde{\\Psi}_m \\vert \\Psi_n \\rangle$）是否在$10^{-8}$的容差内数值上等于单位矩阵，即 $\\max\\{\\lvert B_{mm} - 1 \\rvert, \\max_{m\\neq n} \\lvert B_{mn} \\rvert\\}  10^{-8}$，并为每个哈密顿量返回一个布尔型的通过/失败结果。\n\n数值和实现细节：\n- 对所有归一化检查使用$10^{-8}$的数值容差。\n- 所有计算都是无量纲的；不需要物理单位。\n- 不涉及角度；不需要角度单位。\n- 对于右谱和左谱之间的本征对配对，通过最小绝对差将左本征值与右本征值匹配。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的结果列表，并用方括号括起来。该列表必须按顺序包含：\n- 对于 $H_1$：双正交归一化通过的布尔值。\n- 对于 $H_2$：双正交归一化通过的布尔值。\n- 对于 $H_1$：浮点数 $\\left\\lvert \\langle \\tilde{\\Psi}_{*} \\vert H_1 \\vert \\Psi_{*} \\rangle - E_{*} \\right\\rvert$。\n- 对于 $H_1$：浮点数 $\\left\\lvert \\langle \\Phi_{*} \\vert H_1 \\vert \\Phi_{*} \\rangle - E_{*} \\right\\rvert$。\n- 对于 $H_1$：三个浮点数 $\\left\\lvert \\langle \\tilde{\\Psi}_{*} \\vert [O_1^{(1)}, O_2^{(1)}] \\vert \\Psi_{*} \\rangle \\right\\rvert$、$\\left\\lvert \\langle \\Phi_{*} \\vert [O_1^{(1)}, O_2^{(1)}] \\vert \\Phi_{*} \\rangle \\right\\rvert$ 和 $\\left\\lvert \\frac{\\langle \\Psi_{*} \\vert \\eta_1 [O_1^{(1)}, O_2^{(1)}] \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}}{\\langle \\Psi_{*} \\vert \\eta_1 \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}} \\right\\rvert$。\n- 对于 $H_2$：浮点数 $\\left\\lvert \\langle \\tilde{\\Psi}_{*} \\vert H_2 \\vert \\Psi_{*} \\rangle - E_{*} \\right\\rvert$。\n- 对于 $H_2$：浮点数 $\\left\\lvert \\langle \\Phi_{*} \\vert H_2 \\vert \\Phi_{*} \\rangle - E_{*} \\right\\rvert$。\n- 对于 $H_2$：三个浮点数 $\\left\\lvert \\langle \\tilde{\\Psi}_{*} \\vert [O_1^{(2)}, O_2^{(2)}] \\vert \\Psi_{*} \\rangle \\right\\rvert$、$\\left\\lvert \\langle \\Phi_{*} \\vert [O_1^{(2)}, O_2^{(2)}] \\vert \\Phi_{*} \\rangle \\right\\rvert$ 和 $\\left\\lvert \\frac{\\langle \\Psi_{*} \\vert \\eta_2 [O_1^{(2)}, O_2^{(2)}] \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}}{\\langle \\Psi_{*} \\vert \\eta_2 \\vert \\Psi_{*} \\rangle_{\\mathrm{Herm}}} \\right\\rvert$。\n\n因此，您的程序必须输出一个包含12个条目的列表：两个布尔值后跟十个浮点数，严格按照此顺序和格式，针对指定的测试套件。",
            "solution": "该问题要求实现和验证非厄米量子力学中的概念，特别是在用于开放量子系统的伽莫夫壳模型（GSM）中应用的概念。该模型的基础是复对称哈密顿量 $H = H^{\\mathrm{T}}$，其谱性质与用于描述封闭系统的厄米哈密顿量显著不同。核心任务是正确处理左、右本征矢的双正交基，并使用不同的度规定义计算期望值。\n\n首先，我们必须建立复对称哈密顿量 $H$ 的本征系统。右本征矢 $\\lvert \\Psi_n \\rangle$ 及其对应的复本征值 $E_n$ 通过求解右本征值方程 $H \\lvert \\Psi_n \\rangle = E_n \\lvert \\Psi_n \\rangle$ 来找到。左本征矢，用 bra $\\langle \\tilde{\\Psi}_n \\rvert$ 表示，满足左本征值方程 $\\langle \\tilde{\\Psi}_n \\rvert H = E_n \\langle \\tilde{\\Psi}_n \\rvert$。对此方程进行转置得到 $H^{\\mathrm{T}} \\lvert \\tilde{\\Psi}_n \\rangle = E_n \\lvert \\tilde{\\Psi}_n \\rangle$，这里我们使用了左本征 bra 的列向量表示 $\\lvert \\tilde{\\Psi}_n \\rangle = (\\langle \\tilde{\\Psi}_n \\rvert)^{\\mathrm{T}}$ 的定义。由于 $H$ 是复对称的（$H=H^{\\mathrm{T}}$），$H$ 的左本征矢就是 $H$ 自身的右本征矢，对应于同一组本征值 $\\{E_n\\}$。然而，对于一般的非简并矩阵，左本征矢 $\\lvert \\tilde{\\Psi}_n \\rangle$ 与右本征矢 $\\lvert \\Psi_n \\rangle$ 之间没有简单的关系。在计算上，我们通过对角化 $H$ 来找到右本征矢，通过对角化 $H^{\\mathrm{T}}$ 来找到左本征矢。标准的数值本征求解器可能以不同的顺序返回本征值和本征矢，因此有必要配对相应的左、右本征矢。这可以通过基于最小绝对差匹配两次对角化得到的本征值来实现，这可以使用最优分配算法稳健地解决。\n\n左、右本征矢集合 $\\{ \\lvert \\tilde{\\Psi}_m \\rangle \\}$ 和 $\\{ \\lvert \\Psi_n \\rangle \\}$ 构成一个双正交系统。它们在标准的厄米内积 $\\langle u \\vert v \\rangle_{\\mathrm{Herm}} = u^{\\dagger}v$ 下不是正交的。相反，它们在复对称内积（或称 $c$-积）下是正交的，该内积定义为 $\\langle \\tilde{u} \\vert v \\rangle = \\tilde{u}^{\\mathrm{T}}v$，不含复共轭。对于不同的非简并本征值，当 $m \\neq n$ 时，这给出 $\\langle \\tilde{\\Psi}_m \\vert \\Psi_n \\rangle = 0$。下一步是强制执行完整的双正交归一化条件 $\\langle \\tilde{\\Psi}_m \\vert \\Psi_n \\rangle = \\delta_{mn}$。如果我们从原始本征矢 $\\lvert \\Psi_n^{\\text{raw}} \\rangle$ 和 $\\lvert \\tilde{\\Psi}_n^{\\text{raw}} \\rangle$ 开始，我们计算归一化积分 $N_n = \\langle \\tilde{\\Psi}_n^{\\text{raw}} \\vert \\Psi_n^{\\text{raw}} \\rangle = (\\lvert \\tilde{\\Psi}_n^{\\text{raw}} \\rangle)^{\\mathrm{T}} \\lvert \\Psi_n^{\\text{raw}} \\rangle$。归一化后的本征矢则是 $\\lvert \\Psi_n \\rangle = \\lvert \\Psi_n^{\\text{raw}} \\rangle / \\sqrt{N_n}$ 和 $\\lvert \\tilde{\\Psi}_n \\rangle = \\lvert \\tilde{\\Psi}_n^{\\text{raw}} \\rangle / \\sqrt{N_n}$。这种缩放选择确保了归一化条件得到满足。这种归一化的质量可以通过构建重叠矩阵 $B_{mn} = \\langle \\tilde{\\Psi}_m \\vert \\Psi_n \\rangle$ 并检查其与单位矩阵 $I$ 的偏差来验证。\n\n建立了双正交归一化基后，我们就可以计算期望值。在GSM框架中，可观测量 $\\mathcal{O}$ 在态 $\\lvert \\Psi_n \\rangle$ 中的期望值的正确定义是 $\\langle \\mathcal{O} \\rangle_n = \\langle \\tilde{\\Psi}_n \\vert \\mathcal{O} \\vert \\Psi_n \\rangle$。一个关键的一致性检查是，哈密顿量自身的期望值必须等于相应的本征值：$\\langle \\tilde{\\Psi}_n \\vert H \\vert \\Psi_n \\rangle = \\langle \\tilde{\\Psi}_n \\vert (E_n \\lvert \\Psi_n \\rangle) = E_n \\langle \\tilde{\\Psi}_n \\vert \\Psi_n \\rangle = E_n$。计算的第一部分将对该性质进行数值验证。\n\n这与标准的厄米期望值 $\\langle \\Psi_n \\vert \\mathcal{O} \\vert \\Psi_n \\rangle_{\\mathrm{Herm}}$ 形成对比，后者要求态矢量在厄米内积下归一化，即使用 $\\lvert \\Phi_n \\rangle = \\lvert \\Psi_n \\rangle / \\sqrt{\\langle \\Psi_n \\vert \\Psi_n \\rangle_{\\mathrm{Herm}}}$。对于像 $H$ 这样的非厄米算符，量 $\\langle \\Phi_n \\vert H \\vert \\Phi_n \\rangle_{\\mathrm{Herm}}$ 是一个瑞利商，通常不等于本征值 $E_n$。问题要求计算此偏差的大小。\n\n最后，我们探究度规的选择如何影响与 $H$ 不对易的可观测量的期望值。我们计算对易子 $[O_1, O_2] = O_1 O_2 - O_2 O_1$，并使用三种不同的 prescriptions 来评估其在所选态 $\\lvert \\Psi_* \\rangle$（最窄共振，具有最小的 $\\lvert \\mathrm{Im}(E_n) \\rvert$）下的期望值：\n1.  GSM $c$-积期望值：$ \\langle \\tilde{\\Psi}_* \\vert [O_1, O_2] \\vert \\Psi_* \\rangle $。\n2.  标准厄米期望值：$ \\langle \\Phi_* \\vert [O_1, O_2] \\vert \\Phi_* \\rangle_{\\mathrm{Herm}} $，使用厄米归一化的态 $\\lvert \\Phi_* \\rangle$。\n3.  广义 $\\eta$-度规期望值：$ \\frac{\\langle \\Psi_* \\vert \\eta [O_1, O_2] \\vert \\Psi_* \\rangle_{\\mathrm{Herm}}}{\\langle \\Psi_* \\vert \\eta \\vert \\Psi_* \\rangle_{\\mathrm{Herm}}} $，其中 $\\eta$ 是一个正定度规算符。这在广义内积结构内使用了双正交归一化的态 $\\lvert \\Psi_* \\rangle$。\n\n计算针对两个不同的哈密顿量及其相关算符进行，其中一个案例被构造成对易子恒等于零，作为数值合理性检查。最终结果将量化这些不同理论约定对物理可观测量所产生的差异。\n\n每个测试案例的算法步骤如下：\n1.  数值对角化 $H$ 以获得 $\\{E_n, \\lvert \\Psi_n^{\\text{raw}} \\rangle\\}$，以及 $H^{\\mathrm{T}}$ 以获得 $\\{E'_m, \\lvert \\tilde{\\Psi}_m^{\\text{raw}} \\rangle\\}$。\n2.  通过寻找最小化本征值集合 $\\{E_n\\}$ 和 $\\{E'_m\\}$ 之间距离的置换，来对齐左、右本征矢。\n3.  对于每对 $(n)$，计算归一化常数 $N_n = (\\lvert \\tilde{\\Psi}_n^{\\text{raw}} \\rangle)^{\\mathrm{T}} \\lvert \\Psi_n^{\\text{raw}} \\rangle$ 并缩放本征矢以获得双正交归一化集合 $\\{ \\lvert \\Psi_n \\rangle, \\lvert \\tilde{\\Psi}_n \\rangle \\}$。\n4.  根据指定的容差验证双正交归一化关系，并记录布尔结果。\n5.  确定与本征值虚部绝对值最小的态相对应的索引“$*$”。\n6.  使用GSM、厄米和 $\\eta$-度规的公式，计算索引为“$*$”的态所需的期望值和差值。\n7.  收集并报告所有指定的量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linear_sum_assignment\n\ndef process_case(H, O1, O2, eta, tolerance):\n    \"\"\"\n    Performs all calculations for a single Hamiltonian and its associated operators.\n    \"\"\"\n    # 1. Eigendecomposition and eigenvector pairing\n    E_R, V_R = np.linalg.eig(H)\n    E_L, V_L_raw = np.linalg.eig(H.T)\n\n    # Pair left and right eigenvectors by matching eigenvalues\n    cost_matrix = np.abs(E_R[:, np.newaxis] - E_L_raw[np.newaxis, :])\n    row_ind, col_ind = linear_sum_assignment(cost_matrix)\n    # Reorder left eigenvectors and eigenvalues to match the right ones\n    V_L_sorted = V_L_raw[:, col_ind]\n\n    # 2. Biorthogonal normalization\n    # Compute normalization constants using c-product (transpose, not dagger)\n    norm_factors_sq = np.einsum('ij,ij->j', V_L_sorted, V_R)\n    norm_factors = np.sqrt(norm_factors_sq)\n    \n    # Apply normalization\n    psi_R_norm = V_R / norm_factors[np.newaxis, :]\n    psi_L_norm = V_L_sorted / norm_factors[np.newaxis, :]\n\n    # 3. Task 5: Biorthogonality check\n    B = psi_L_norm.T @ psi_R_norm\n    off_diag = B - np.diag(np.diag(B))\n    max_off_diag_err = np.max(np.abs(off_diag))\n    max_diag_err = np.max(np.abs(np.diag(B) - 1.0))\n    norm_pass = max(max_diag_err, max_off_diag_err)  tolerance\n\n    # 4. State selection: narrowest resonance (smallest |Im(E)|)\n    star_idx = np.argmin(np.abs(np.imag(E_R)))\n    E_star = E_R[star_idx]\n    psi_star = psi_R_norm[:, star_idx]\n    psi_tilde_star_T = psi_L_norm[:, star_idx].T # This is the bra vector\n\n    # 5. Task 2: GSM expectation consistency\n    exp_H_gsm = psi_tilde_star_T @ H @ psi_star\n    diff_gsm = np.abs(exp_H_gsm - E_star)\n\n    # 6. Task 3: Hermitian expectation of H\n    # Hermitian normalization for the selected right eigenvector\n    herm_norm = np.sqrt(psi_star.conj().T @ psi_star)\n    phi_star = psi_star / herm_norm\n    exp_H_herm = phi_star.conj().T @ H @ phi_star\n    diff_herm = np.abs(exp_H_herm - E_star)\n\n    # 7. Task 4: Commutator expectations\n    C = O1 @ O2 - O2 @ O1\n\n    # GSM c-product expectation\n    exp_C_gsm = np.abs(psi_tilde_star_T @ C @ psi_star)\n    \n    # Hermitian metric expectation\n    exp_C_herm = np.abs(phi_star.conj().T @ C @ phi_star)\n\n    # Generalized eta-metric expectation\n    num = psi_star.conj().T @ eta @ C @ psi_star\n    den = psi_star.conj().T @ eta @ psi_star\n    exp_C_eta = np.abs(num / den) if np.abs(den) > 1e-12 else 0.0\n\n    return [norm_pass, diff_gsm, diff_herm, exp_C_gsm, exp_C_herm, exp_C_eta]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and orchestrate the calculations.\n    \"\"\"\n    \n    # Define Hamiltonians\n    H1 = np.array([\n        [-2.0 + 0.5j, 0.35, 0.15j],\n        [0.35, -1.2 + 0.8j, 0.27 - 0.05j],\n        [0.15j, 0.27 - 0.05j, -0.4 + 1.1j]\n    ], dtype=np.complex128)\n\n    H2 = np.array([\n        [-1.0 + 0.3j, 0.2 + 0.02j, 0.05j],\n        [0.2 + 0.02j, -0.98 + 0.31j, 0.18 - 0.01j],\n        [0.05j, 0.18 - 0.01j, -0.6 + 0.95j]\n    ], dtype=np.complex128)\n\n    # Define Operators for H1\n    O1_1 = np.array([\n        [1.0, 0.1, -0.05j],\n        [0.1, 0.5, 0.07 + 0.02j],\n        [-0.05j, 0.07 + 0.02j, -0.2]\n    ], dtype=np.complex128)\n\n    O2_1 = np.array([\n        [0.3, -0.06 + 0.03j, 0.12],\n        [-0.06 + 0.03j, -0.1, -0.09j],\n        [0.12, -0.09j, 0.8]\n    ], dtype=np.complex128)\n\n    # Define Operators for H2\n    O1_2 = np.array([\n        [0.9, 0.02, -0.01j],\n        [0.02, 0.88, 0.015],\n        [-0.01j, 0.015, 0.1]\n    ], dtype=np.complex128)\n\n    O2_2 = O1_2 + 0.001 * np.eye(3)\n\n    # Define Metric Operators\n    eta1 = np.diag([1.0, 0.5, 2.0])\n    eta2 = np.diag([0.7, 1.1, 1.5])\n\n    # Tolerance for normalization check\n    tolerance = 1e-8\n\n    # Process each case\n    results1 = process_case(H1, O1_1, O2_1, eta1, tolerance)\n    results2 = process_case(H2, O1_2, O2_2, eta2, tolerance)\n\n    # Assemble final list in the specified order\n    final_output_raw = [\n        results1[0], results2[0],\n        results1[1], results1[2], results1[3], results1[4], results1[5],\n        results2[1], results2[2], results2[3], results2[4], results2[5]\n    ]\n    \n    # Format the output string as required\n    formatted_output = []\n    for item in final_output_raw:\n        if isinstance(item, (bool, np.bool_)):\n            formatted_output.append(str(item))\n        else:\n            formatted_output.append(f\"{item:.6f}\")\n\n    print(f\"[{','.join(formatted_output)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}