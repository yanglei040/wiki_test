{
    "hands_on_practices": [
        {
            "introduction": "在描述原子核的激发态之前，我们必须首先精确地构建其基态。本练习的核心是实现 Bardeen-Cooper-Schrieffer (BCS) 方程，这是处理成对系统中 Hartree-Fock-Bogoliubov (HFB) 理论的基石。通过在一个简化的双能级模型中数值求解配对能隙 $\\Delta$ 和化学势 $\\lambda$，你将亲手实践准粒子和超流基态等基本概念，而 QRPA 正是建立在这样的基态之上的。",
            "id": "3606041",
            "problem": "实现一个完整的程序，该程序为一个简化的常数配对双能级模型构建 Bardeen-Cooper-Schrieffer (BCS) 准粒子真空，并验证作为准粒子随机相位近似 (QRPA) 基础的两个基本恒等式。考虑一个全同费米子系统，该系统处于由 $i \\in \\{1,2\\}$ 索引的两个单粒子能级上，其单粒子能量为 $\\epsilon_i$，配对简并度为 $\\Omega_i$（每个能级上时间反演对的数量）。简化的常数配对哈密顿量为\n$$\nH = \\sum_{i=1}^{2} 2\\,\\epsilon_i\\,\\hat{N}_i \\;-\\; G \\sum_{i,j=1}^{2} \\hat{P}_i^\\dagger \\hat{P}_j,\n$$\n其中 $G \\gt 0$ 是配对强度，$\\hat{N}_i$ 计算能级 $i$ 上的对数，而 $\\hat{P}_i^\\dagger$ 在能级 $i$ 上创建一个关联对。在零温下，Bardeen-Cooper-Schrieffer (BCS) 方法引入了一个到准粒子的 Bogoliubov-Valatin 变换，其振幅为 $u_i$ 和 $v_i$，并定义了准粒子能量 $E_i$。BCS 态由配对能隙 $\\Delta$ 和化学势 $\\lambda$ 确定，它们在粒子数 $N$ 固定的约束下最小化基态能量。\n\n对于每个测试用例，您的程序必须通过求解双能级简化常数配对哈密顿量的 BCS 方程，自洽地计算 $u_i$、$v_i$ 和 $E_i$：\n- 准粒子能量定义为\n$$\nE_i \\equiv \\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}.\n$$\n- 占据振幅满足\n$$\nv_i^2 \\equiv \\tfrac{1}{2}\\left(1 - \\frac{\\epsilon_i - \\lambda}{E_i}\\right),\\qquad u_i^2 \\equiv 1 - v_i^2.\n$$\n- 能隙方程为\n$$\n\\Delta \\equiv \\frac{G}{2}\\sum_{i=1}^{2}\\Omega_i \\frac{\\Delta}{E_i},\n$$\n这等价于条件\n$$\n\\Delta = 0 \\quad \\text{or} \\quad 1 = \\frac{G}{2}\\sum_{i=1}^{2}\\frac{\\Omega_i}{E_i}.\n$$\n- 粒子数方程为\n$$\nN \\equiv 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2.\n$$\n\n您的程序必须能稳健地处理配对相（$\\Delta \\gt 0$）和正常相（$\\Delta = 0$）。在正常相中，极限值 $v_i^2 \\in \\{0, \\tfrac{1}{2}, 1\\}$ 由 $\\epsilon_i - \\lambda$ 的符号确定，其中 $\\lambda$ 的位置在可能的情况下应实现所要求的粒子数 $N$。\n\n对于每个测试用例，在计算出 $\\{u_i,v_i,E_i\\}_{i=1,2}$ 后，数值上验证以下内容：\n- 对所有时间反演对求和的 Bogoliubov 归一化：\n$$\n\\sum_{i=1}^{2} \\Omega_i \\left(u_i^2 + v_i^2\\right) \\stackrel{?}{=} \\Omega_{\\text{tot}},\n$$\n其中 $\\Omega_{\\text{tot}} \\equiv \\Omega_1 + \\Omega_2$。\n- 粒子数期望值：\n$$\n\\langle N \\rangle \\equiv 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2 \\stackrel{?}{=} N.\n$$\n\n数值细节和约定：\n- 能量 $\\epsilon_i$、$G$ 和 $E_i$ 以及能隙 $\\Delta$ 必须以兆电子伏特 (MeV) 为单位处理。程序输出中不需要单位，因为输出是布尔值。\n- 在两次验证中，使用 $10^{-10}$ 的数值容差来评估相等性。\n- 不使用角度。不需要百分比输出。\n- 您可以使用任何确定性的数值求根策略来求解 $\\Delta$ 和 $\\lambda$，包括尝试多个初始猜测值。如果找不到 $\\Delta \\gt 0$ 的解，您必须回退到正常相（$\\Delta = 0$），并在可能的情况下选择与所要求的 $N$ 一致的 $\\lambda$。\n\n测试套件：\n- 案例 1（配对，对称，半满）：$\\epsilon = [-0.5, +0.5]$ MeV，$\\Omega = [4, 4]$，$G = 0.2$ MeV，$N = 8$。\n- 案例 2（正常相，低于临界耦合）：$\\epsilon = [-0.5, +0.5]$ MeV，$\\Omega = [4, 4]$，$G = 0.1$ MeV，$N = 8$。\n- 案例 3（不对称一般情况，配对）：$\\epsilon = [0.0, 1.5]$ MeV，$\\Omega = [3, 5]$，$G = 0.3$ MeV，$N = 10$。\n\n要求的最终输出格式：\n- 您的程序应生成一行输出，其中包含一个按以下顺序排列的布尔值扁平列表：\n$$\n[\\text{case1\\_norm\\_ok},\\ \\text{case1\\_N\\_ok},\\ \\text{case2\\_norm\\_ok},\\ \\text{case2\\_N\\_ok},\\ \\text{case3\\_norm\\_ok},\\ \\text{case3\\_N\\_ok}],\n$$\n其中，当且仅当相应的验证在 $10^{-10}$ 的容差内成立时，每个条目才为 true。例如，如果所有检查都通过，一个有效的输出可能看起来像 $[True,True,True,True,True,True]$。\n\n实现要求：\n- 最终答案必须是一个完整、可运行的 Python 程序。它不能要求任何用户输入、文件或网络访问。它必须如上所述为测试套件计算结果，并以指定的确切格式打印单行输出。",
            "solution": "该问题要求实现一个程序来求解一个双能级原子核模型的 Bardeen-Cooper-Schrieffer (BCS) 方程，并随后验证两个基本恒等式。对问题陈述的验证证实了它在科学上是合理的、适定的，并且包含了得出唯一且有意义的解所需的所有必要信息。该模型及其相关方程是理论核物理领域的标准。\n\n求解策略涉及寻找配对能隙 $\\Delta$ 和化学势 $\\lambda$，使得它们对于给定的参数集自洽地满足 BCS 方程：单粒子能量 $\\{\\epsilon_1, \\epsilon_2\\}$、配对简并度 $\\{\\Omega_1, \\Omega_2\\}$、配对强度 $G$ 和总粒子数 $N$。解必须考虑到两种可能的相：$\\Delta  0$ 的配对（超流）相，以及 $\\Delta = 0$ 的正常相。\n\n问题的核心是求解一个关于两个未知数 $\\Delta$ 和 $\\lambda$ 的耦合非线性方程组。该方法分为两部分，分别处理配对相和正常相。\n\n首先，尝试在以 $\\Delta  0$ 为特征的配对相中寻找解。在此相中，两个控制方程是能隙方程和粒子数方程。\n\n能隙方程由下式给出：\n$$\n1 = \\frac{G}{2}\\sum_{i=1}^{2}\\frac{\\Omega_i}{E_i}\n$$\n其中 $E_i$ 是能级 $i$ 的准粒子能量：\n$$\nE_i = \\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}\n$$\n粒子数方程为：\n$$\nN = 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2\n$$\n其中 $v_i^2$ 是能级 $i$ 上一个对态的占据概率：\n$$\nv_i^2 = \\frac{1}{2}\\left(1 - \\frac{\\epsilon_i - \\lambda}{E_i}\\right)\n$$\n将 $v_i^2$ 和 $E_i$ 的表达式代入，能隙和粒子数方程就转换成一个仅依赖于 $\\Delta$ 和 $\\lambda$ 的方程组：\n$$\nf_1(\\Delta, \\lambda) = 1 - \\frac{G}{2}\\sum_{i=1}^{2}\\frac{\\Omega_i}{\\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}} = 0\n$$\n$$\nf_2(\\Delta, \\lambda) = N - \\sum_{i=1}^{2}\\Omega_i \\left(1 - \\frac{\\epsilon_i - \\lambda}{\\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}}\\right) = 0\n$$\n这个方程组通过数值方法求解对偶 $(\\Delta, \\lambda)$。我们采用一个数值求根算法，具体是 `scipy.optimize.root`，它寻找一个向量 $(\\Delta, \\lambda)$，使残差 $(f_1, f_2)$ 趋于零。为了确保一个物理上有意义的解，我们只接受在小的数值容差范围内 $\\Delta  0$ 的结果。选择一个合理的初始猜测值，$\\lambda$ 接近单粒子能量的平均值，而 $\\Delta$ 是一个小的正值。\n\n如果数值求解器未能找到收敛解，或者如果得到的 $\\Delta$ 不是正数，我们断定系统处于正常相。在此相中，$\\Delta=0$。准粒子能量简化为 $E_i = |\\epsilon_i - \\lambda|$。对于固定的粒子数 $N$，基态对应于一个无相互作用的构型，其中单粒子能级按能量递增的顺序填充。占据概率 $v_i^2$ 变为 0 或 1，除非某个能级被部分填充。化学势 $\\lambda$ 由粒子数条件确定。具体来说，$\\lambda$ 被设置为最高占据（或部分占据）能级的单粒子能量。然后计算占据概率 $v_i^2$ 以满足粒子数约束 $N = 2\\sum_i \\Omega_i v_i^2$。对于低于 $\\lambda$ 的能级，$v_i^2=1$；对于高于 $\\lambda$ 的能级，$v_i^2=0$；对于位于 $\\lambda$ 的能级，$v_i^2$ 取一个在 $[0,1]$ 范围内的值以满足粒子数方程。\n\n一旦确定了 $\\Delta$、$\\lambda$ 和相应的 $v_i^2$ 的值，我们计算 $u_i^2 = 1 - v_i^2$。利用这些量，进行两次验证。\n1. Bogoliubov 归一化：计算总和 $\\sum_{i=1}^{2} \\Omega_i (u_i^2 + v_i^2)$ 并与总配对简并度 $\\Omega_{\\text{tot}} = \\Omega_1 + \\Omega_2$ 进行比较。这是一个恒等式，因为 $u_i^2+v_i^2=1$，可作为对实现的健全性检查。\n2. 粒子数期望值：计算粒子数的期望值 $\\langle N \\rangle = 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2$，并与目标粒子数 $N$ 进行比较。这确认了解是否正确满足约束条件。\n\n两次比较都使用 $10^{-10}$ 的数值容差。每个测试用例得到的布尔结果被汇编成一个最终列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root\n\n# language: Python\n# version: 3.12\n# libraries:\n#   - name: numpy\n#     version: 1.23.5\n#   - name: scipy\n#     version: 1.11.4\n\ndef solve():\n    \"\"\"\n    Main function to run the BCS calculations for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (paired, symmetric, half-filled)\n        {'eps': np.array([-0.5, 0.5]), 'Omega': np.array([4, 4]), 'G': 0.2, 'N': 8},\n        # Case 2 (normal phase, below critical coupling)\n        {'eps': np.array([-0.5, 0.5]), 'Omega': np.array([4, 4]), 'G': 0.1, 'N': 8},\n        # Case 3 (asymmetric general case, paired)\n        {'eps': np.array([0.0, 1.5]), 'Omega': np.array([3, 5]), 'G': 0.3, 'N': 10},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        norm_ok, n_ok = compute_and_verify(\n            case['eps'], case['Omega'], case['G'], case['N']\n        )\n        all_results.extend([norm_ok, n_ok])\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\n\ndef compute_and_verify(eps, Omega, G, N):\n    \"\"\"\n    Solves the BCS equations and verifies the identities for a single test case.\n    \n    Returns:\n        tuple[bool, bool]: A tuple containing the boolean results for the\n                           normalization check and the particle number check.\n    \"\"\"\n    tolerance = 1e-10\n\n    def solve_paired_phase(eps, Omega, G, N):\n        \"\"\"Attempts to find a paired solution (Delta  0).\"\"\"\n        def equations(variables):\n            Delta, lam = variables\n            \n            # Penalize unphysical Delta=0 region to guide the solver\n            if Delta = 0:\n                return [1e10, 1e10]\n\n            # Quasiparticle energies\n            E = np.sqrt((eps - lam)**2 + Delta**2)\n\n            # Avoid division by zero, although Delta  0 should prevent this.\n            if np.any(E  tolerance):\n                return [1e10, 1e10]\n\n            # Gap equation residual\n            res_gap = (G / 2.0) * np.sum(Omega / E) - 1.0\n            \n            # Number equation residual\n            res_num = np.sum(Omega * (1.0 - (eps - lam) / E)) - N\n            \n            return [res_gap, res_num]\n\n        # Initial guess\n        lam_guess = np.mean(eps)\n        delta_guess = 0.1  # Small positive guess for Delta\n        \n        sol = root(equations, [delta_guess, lam_guess], method='hybr', tol=tolerance)\n        \n        if sol.success and sol.x[0] > tolerance:\n            return sol.x # Returns (Delta, lambda)\n        return None\n\n    solution = solve_paired_phase(eps, Omega, G, N)\n    \n    if solution is not None:\n        # Paired solution found\n        Delta, lam = solution\n        E = np.sqrt((eps - lam)**2 + Delta**2)\n        v_sq = 0.5 * (1.0 - (eps - lam) / E)\n    else:\n        # Fallback to normal phase (Delta = 0)\n        Delta = 0.0\n        \n        # Sort levels by energy to handle filling sequence\n        sort_indices = np.argsort(eps)\n        eps_sorted = eps[sort_indices]\n        Omega_sorted = Omega[sort_indices]\n\n        N_level1_capacity = 2 * Omega_sorted[0]\n        \n        v_sq_sorted = np.zeros(2)\n        \n        # Determine lambda and occupations based on N\n        if N = N_level1_capacity:\n            lam = eps_sorted[0]\n            if N_level1_capacity > 0:\n                v_sq_sorted[0] = N / N_level1_capacity\n            # v_sq_sorted[1] is already 0\n        else:\n            lam = eps_sorted[1]\n            v_sq_sorted[0] = 1.0\n            N_remaining = N - N_level1_capacity\n            N_level2_capacity = 2 * Omega_sorted[1]\n            if N_level2_capacity > 0:\n                v_sq_sorted[1] = N_remaining / N_level2_capacity\n        \n        # Revert sorting to match original order of eps/Omega\n        v_sq = v_sq_sorted[np.argsort(sort_indices)]\n\n    u_sq = 1.0 - v_sq\n\n    # --- Verifications ---\n    \n    # 1. Bogoliubov normalization check\n    Omega_tot = np.sum(Omega)\n    norm_check_val = np.sum(Omega * (u_sq + v_sq))\n    norm_ok = np.isclose(norm_check_val, Omega_tot, atol=tolerance, rtol=0)\n\n    # 2. Particle number expectation check\n    number_check_val = 2.0 * np.sum(Omega * v_sq)\n    n_ok = np.isclose(number_check_val, N, atol=tolerance, rtol=0)\n\n    return bool(norm_ok), bool(n_ok)\n\nsolve()\n```"
        },
        {
            "introduction": "在 BCS 基态的基础上，本练习将直接处理 QRPA 方法的核心。你将为一个示意性的多能级系统实现一个 QRPA 计算，以确定集体激发态的能量。这个过程包括构建和对角化 QRPA 矩阵，从而直接洞察原子核的集体响应是如何从单个准粒子能量和剩余相互作用的博弈中产生的。",
            "id": "3606102",
            "problem": "通过线性化含时Hartree-Fock-Bogoliubov (TDHFB)方程，实现对由可分离的粒子-空穴剩余相互作用增强的概略、自洽配对平均场的数值小振幅线性响应计算。目标是使用准粒子随机相位近似 (QRPA) 计算最低集体激发能，并验证其相对于双准粒子基截断的收敛性。\n\n从以下适合该情景的基础出发：\n- 广义密度矩阵的TDHFB方程由 $i \\hbar \\, d\\mathcal{R}/dt = [\\mathcal{H}[\\mathcal{R}], \\mathcal{R}]$ 给出，在核结构应用中，能量单位设为兆电子伏特 (MeV)，并令 $\\hbar = 1$。\n- 对于常数配对哈密顿量，Hartree-Fock-Bogoliubov (HFB) 基态可通过Bardeen-Cooper-Schrieffer (BCS) 能隙方程及粒子数条件获得。考虑一个对称的栅栏谱，包含 $\\Omega$ 个双重简并单粒子能级，其能量 $\\{\\epsilon_k\\}$ 是相对于在对称点选择的参考化学势来度量的。在恰好半满且谱对称的情况下，可取化学势 $\\lambda = 0$，并求解能隙方程 $1 = G \\sum_k \\left(2 \\sqrt{\\epsilon_k^2 + \\Delta^2}\\right)^{-1}$ 以找到配对能隙 $\\Delta$。准粒子能量为 $E_k = \\sqrt{\\epsilon_k^2 + \\Delta^2}$，占据振幅为 $u_k^2 = \\frac{1}{2}\\left(1 + \\frac{\\epsilon_k}{E_k}\\right)$ 和 $v_k^2 = 1 - u_k^2$。\n- 剩余粒子-空穴相互作用取为可分离算符形式 $V_{\\mathrm{res}} = -\\kappa \\, \\hat{Q} \\, \\hat{Q}$，其中 $\\hat{Q} = \\sum_k f_k \\left(\\hat{n}_k + \\hat{n}_{\\bar{k}}\\right)$ 且 $\\hat{n}_k = a_k^\\dagger a_k$。这个单体算符通过其Bogoliubov展开中的反常项与双准粒子激发耦合。\n\n任务要求：\n1. 从线性化的TDHFB方程推导出建立在HFB基态上的双准粒子基中的QRPA本征值问题。使用准玻色子近似和QRPA矩阵的双对易子定义，获得以HFB准粒子能量和由 $\\hat{Q}$ 诱导的耦合形状因子表示的矩阵的显式表达式。\n2. 对于上述定义的概略模型，将双准粒子基限制在时间反演配对态 $\\{|k \\, \\bar{k}\\rangle\\}$ 上，其未受扰动的双准粒子能量为 $2 E_k$。通过仅保留该基中能量最低的 $N_{\\mathrm{trunc}}$ 个双准粒子组态来实现截断。\n3. 计算求解所推导的本征值问题的最低正QRPA本征频率 $\\omega_{\\min}$。该量是QRPA矩阵的最小正本征值，代表最低集体激发能（单位MeV）。\n4. 通过为多个 $N_{\\mathrm{trunc}}$ 值计算 $\\omega_{\\min}$ 来验证相对于双准粒子截斷的收敛性。\n\n需要实现的数值和物理细节：\n- 使用具有 $\\Omega$ 个双重简并能级的栅栏谱：$\\epsilon_k = \\left(k - \\frac{\\Omega + 1}{2}\\right) d$，对于 $k \\in \\{1,2,\\dots,\\Omega\\}$，这样在半满时谱关于零对称。根据对称性取 $\\lambda = 0$。\n- 使用稳健的求根方法求解Bardeen-Cooper-Schrieffer (BCS) 能隙方程以得到 $\\Delta$，并计算 $\\{E_k, u_k, v_k\\}$。\n- 在算符 $\\hat{Q}$ 中选择结构因子 $f_k = \\epsilon_k$，这会导致与双准粒子空间的非平凡耦合。\n- 在截断的 $\\{|k \\, \\bar{k}\\rangle\\}$ 基中构建QRPA矩阵并求解其本征值；选择最小正本征值作为 $\\omega_{\\min}$。\n- 所有能量均以MeV表示。您的程序必须将报告的每个 $\\omega_{\\min}$ 四舍五入到MeV的后三位小数。\n\n测试套件和要求的最终输出格式：\n- 使用以下五组测试用例，每组由 $(\\Omega, d, G, \\kappa, N_{\\mathrm{trunc}})$ 指定，所有耦合常数单位为MeV，能量单位为MeV：\n    - 测试 1 (正常路径): $(20, 0.5, 0.55, 0.04, 4)$\n    - 测试 2 (收敛性增加): $(20, 0.5, 0.55, 0.04, 8)$\n    - 测试 3 (边界情况，无剩余耦合): $(20, 0.5, 0.55, 0.00, 8)$\n    - 测试 4 (边缘情况，最小截断): $(10, 0.5, 0.60, 0.06, 1)$\n    - 测试 5 (覆盖性，更密集的谱): $(30, 0.25, 0.40, 0.03, 10)$\n- 您的程序必须产生单行输出，包含一个方括号括起来的逗号分隔列表形式的结果，例如 $[\\omega_1,\\omega_2,\\dots,\\omega_5]$，其中每个 $\\omega_i$ 是对应测试用例的最低集体激发能，单位为MeV，四舍五入到三位小数。\n\n所有计算必须是纯数值和自包含的，仅使用指定的运行时环境。不允许用户输入。答案必须按规定以MeV为单位给出，四舍五入到三位小数，并采用上述确切的输出格式。此问题不涉及角度。此问题不涉及百分比。",
            "solution": "该问题要求为一个概略的核模型实施准粒子随机相位近似 (QRPA) 计算，以找到最低集体激发能。这涉及在小振幅极限下求解含时Hartree-Fock-Bogoliubov (TDHFB) 方程。步骤如下：首先，使用Hartree-Fock-Bogoliubov (HFB) 框架内的Bardeen-Cooper-Schrieffer (BCS) 理论确定基态。其次，推导并求解描述此基态附近线性响应的QRPA方程，以应对指定的剩余相互作用。\n\n原子核由 $\\Omega$ 个双重简并的单粒子能级建模，其能量为 $\\epsilon_k = (k - (\\Omega + 1)/2)d$（$k \\in \\{1, 2, \\dots, \\Omega\\}$），围绕化学势 $\\lambda=0$ 对称。粒子间通过强度为 $G$ 的常数配对力相互作用。\n\n**1. 基态：HFB/BCS 解**\n\nHFB基态通过求解BCS方程得到。配对能隙 $\\Delta$ 由能隙方程确定：\n$$\n1 = G \\sum_{k=1}^{\\Omega} \\frac{1}{2 \\sqrt{\\epsilon_k^2 + \\Delta^2}}\n$$\n这是一个关于 $\\Delta$ 的非线性方程，必须使用求根算法进行数值求解。给定 $\\Delta$，每个能级 $k$ 的准粒子能量 $E_k$ 和占据振幅 $u_k, v_k$ 由下式给出：\n$$\nE_k = \\sqrt{\\epsilon_k^2 + \\Delta^2}\n$$\n$$\nu_k^2 = \\frac{1}{2} \\left(1 + \\frac{\\epsilon_k}{E_k}\\right), \\quad v_k^2 = \\frac{1}{2} \\left(1 - \\frac{\\epsilon_k}{E_k}\\right)\n$$\nHFB基态是这些准粒子的真空态。激发建立在该状态之上。\n\n**2. 集体激发的QRPA方程**\n\nHFB基态周围的小振幅振荡由QRPA描述。对于能量为 $\\omega$ 的激发，QRPA运动方程可以表示为一个矩阵本征值问题：\n$$\n\\begin{pmatrix} A  B \\\\ -B^*  -A^* \\end{pmatrix} \\begin{pmatrix} X \\\\ Y \\end{pmatrix} = \\omega \\begin{pmatrix} X \\\\ Y \\end{pmatrix}\n$$\n这里，$X$ 和 $Y$ 分别是激发的前行和后行振幅，基由双准粒子 (2QP) 态构成。对于指定的问题，我们考虑形式为 $|k\\bar{k}\\rangle = \\beta_k^\\dagger \\beta_{\\bar{k}}^\\dagger |\\text{HFB}\\rangle$ 的2QP态，其中 $\\beta^\\dagger$ 创建一个准粒子，而 $|\\text{HFB}\\rangle$ 是HFB基态。态 $|k\\bar{k}\\rangle$ 的未受扰动能量为 $2E_k$。对于给定的相互作用，矩阵 $A$ 和 $B$ 是实数且对称的。\n\nQRPA矩阵 $A$ 和 $B$ 由涉及完整哈密顿量 $H = H_{HFB} + V_{\\mathrm{res}}$ 的双对易子定义：\n$$\nA_{ij} = \\langle \\text{HFB} | [\\beta_{\\bar{i}}\\beta_i, [H, \\beta_j^\\dagger\\beta_{\\bar{j}}^\\dagger]] | \\text{HFB} \\rangle\n$$\n$$\nB_{ij} = -\\langle \\text{HFB} | [\\beta_{\\bar{i}}\\beta_i, [H, \\beta_{\\bar{j}}\\beta_j]] | \\text{HFB} \\rangle\n$$\n哈密顿量的HFB部分 $H_{HFB}$ 对矩阵 $A$ 贡献一个对角项 $2E_i \\delta_{ij}$，对 $B$ 贡献为零。剩余相互作用 $V_{\\mathrm{res}} = -\\kappa \\hat{Q}\\hat{Q}$（其中 $\\hat{Q} = \\sum_k \\epsilon_k (\\hat{n}_k+\\hat{n}_{\\bar k})$）提供了描述集体响应的非对角耦合。\n\n算符 $\\hat{Q}$ 是数算符的和，并且是时间偶的。它与2QP空间的耦合来自其在基态和2QP态之间的矩阵元，即所谓的“反常”项。对于指定的算符 $\\hat{Q}$，该矩阵元为：\n$$\nq_k \\equiv \\langle k\\bar{k} | \\hat{Q} | \\text{HFB} \\rangle = 2 f_k u_k v_k = 2 \\epsilon_k \\frac{\\Delta}{2E_k} = \\frac{\\epsilon_k \\Delta}{E_k}\n$$\n对于形式为 $V_{\\mathrm{res}} = -\\kappa \\hat{Q}\\hat{Q}$ 的可分离粒子-空穴相互作用，对QRPA矩阵的贡献是一个标准结果：\n$$\nA'_{ij} = -2\\kappa q_i q_j\n$$\n$$\nB'_{ij} = -2\\kappa q_i q_j\n$$\n因此，完整的QRPA矩阵为：\n$$\nA_{ij} = 2E_i \\delta_{ij} - 2\\kappa q_i q_j\n$$\n$$\nB_{ij} = -2\\kappa q_i q_j\n$$\n索引 $i$ 和 $j$ 遍历截断基中包含的2QP态集合。\n\n**3. 数值实现**\n\n寻找最低集体激发能 $\\omega_{\\min}$ 的算法流程如下：\n1.  对于给定的参数 $(\\Omega, d, G, \\kappa, N_{\\mathrm{trunc}})$，首先计算单粒子能量 $\\epsilon_k$。\n2.  数值求解BCS能隙方程以得到 $\\Delta  0$。我们使用Brent-Dekker方法，因其稳健性。\n3.  计算所有 $k \\in \\{1, \\dots, \\Omega\\}$ 的准粒子能量 $E_k$。\n4.  2QP基由具有未受扰动能量 $2E_k$ 的态构成。我们通过选择能量 $2E_k$ 最低的 $N_{\\mathrm{trunc}}$ 个态来截断该基。设这些选定能级的索引为 $I_{\\mathrm{trunc}}$。\n5.  对于每个 $k \\in I_{\\mathrm{trunc}}$，计算耦合因子 $q_k = \\epsilon_k \\Delta / E_k$。\n6.  使用推导的表达式构建 $N_{\\mathrm{trunc}} \\times N_{\\mathrm{trunc}}$ 矩阵 $A$ 和 $B$。\n7.  构建完整的 $2N_{\\mathrm{trunc}} \\times 2N_{\\mathrm{trunc}}$ QRPA矩阵 $\\mathcal{M} = \\begin{pmatrix} A  B \\\\ -B  -A \\end{pmatrix}$。\n8.  计算 $\\mathcal{M}$ 的本征值。本征值为实数，并成对出现 $\\pm \\omega$。\n9.  最低正本征值对应于最低集体激发能 $\\omega_{\\min}$。\n10. 对每个测试用例重复此过程，可以观察到 $\\omega_{\\min}$ 相对于 $N_{\\mathrm{trunc}}$ 的收敛性。$\\kappa=0$ 的值对应于未受扰动情况，此时QRPA本征值就是2QP能量 $2E_k$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Implements a QRPA calculation for a schematic nuclear model to find the\n    lowest collective excitation energy.\n    \"\"\"\n    test_cases = [\n        (20, 0.5, 0.55, 0.04, 4),   # Test 1\n        (20, 0.5, 0.55, 0.04, 8),   # Test 2\n        (20, 0.5, 0.55, 0.00, 8),   # Test 3\n        (10, 0.5, 0.60, 0.06, 1),   # Test 4\n        (30, 0.25, 0.40, 0.03, 10), # Test 5\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        Omega, d, G, kappa, N_trunc = case\n        \n        # 1. Single-particle spectrum\n        k_vals = np.arange(1, Omega + 1)\n        epsilons = (k_vals - (Omega + 1) / 2) * d\n        \n        # 2. Solve BCS gap equation for Delta\n        def gap_equation_func(delta, G_val, eps_vals):\n            if delta = 1e-9: # The gap must be positive\n                return -1.0 # Return a value that indicates failure or wrong side\n            \n            # Avoid division by zero if delta is very small and an epsilon is zero\n            energies = np.sqrt(eps_vals**2 + delta**2)\n            if np.any(energies  1e-12):\n                return np.inf\n\n            return 1.0 - G_val * np.sum(1.0 / (2.0 * energies))\n\n        try:\n            # A non-zero gap exists only if G  G_crit. If not, brentq fails.\n            # In that case, Delta = 0 is the solution.\n            Delta = brentq(gap_equation_func, 1e-6, 20.0, args=(G, epsilons))\n        except ValueError:\n            Delta = 0.0\n\n        # Handle the non-interacting case (G=0) or sub-critical G\n        if Delta == 0.0:\n            if G > 0: # Check if brentq failed for another reason\n                # Sum at Delta=0, check if starting point is valid\n                # If sum > 1/G, a solution exists.\n                test_sum = G * np.sum(1.0 / (2.0 * np.abs(epsilons[epsilons != 0])))\n                if test_sum = 1.0: # No gap solution, physics is correct\n                    pass\n                else: # Numerical failure\n                    raise RuntimeError(\"BCS solver failed to find a valid gap.\")\n            E_k = np.abs(epsilons)\n        else:\n            E_k = np.sqrt(epsilons**2 + Delta**2)\n\n        # 3. Truncate the two-quasiparticle (2QP) basis\n        # Sort by 2QP energy 2*E_k and select the N_trunc lowest\n        sorted_indices = np.argsort(E_k)\n        trunc_indices = sorted_indices[:N_trunc]\n        \n        E_trunc = E_k[trunc_indices]\n        eps_trunc = epsilons[trunc_indices]\n        \n        # If kappa is zero, the answer is the lowest unperturbed 2QP energy\n        if kappa == 0.0:\n            omega_min = 2.0 * E_trunc[0]\n            results.append(f\"{omega_min:.3f}\")\n            continue\n\n        # 4. Construct QRPA matrices A and B\n        if Delta == 0.0: # No pairing, q_k factors are zero\n            q_k_trunc = np.zeros_like(E_trunc)\n        else:\n            q_k_trunc = eps_trunc * Delta / E_trunc\n        \n        A = np.diag(2.0 * E_trunc) - 2.0 * kappa * np.outer(q_k_trunc, q_k_trunc)\n        B = -2.0 * kappa * np.outer(q_k_trunc, q_k_trunc)\n        \n        # 5. Form the full QRPA matrix M and solve the eigenvalue problem\n        M = np.block([\n            [A, B],\n            [-B, -A]\n        ])\n        \n        eigenvalues = np.linalg.eigvals(M)\n        \n        # 6. Find the lowest positive eigenvalue\n        positive_eigenvalues = eigenvalues.real[eigenvalues.real > 1e-9]\n        if len(positive_eigenvalues) == 0:\n            # This can happen if the QRPA collapses (imaginary eigenvalues)\n            # or if all eigenvalues are zero.\n            omega_min = 0.0\n        else:\n            omega_min = np.min(positive_eigenvalues)\n            \n        results.append(f\"{omega_min:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "最后的这个练习深入探讨了多体理论中一个更高级也更关键的方面：自洽性原理。通过一个示意性的模型，你将研究破坏平均场和剩余相互作用之间联系所带来的后果，这是非自洽计算中常见的陷阱。通过比较包含和省略重排项的结果，本练习将展示对 Thouless 定理的违背，并强调一个自洽的理论框架对于获得有物理意义的结果是何等重要。",
            "id": "3606044",
            "problem": "考虑偶偶核在准粒子随机相位近似 (QRPA) 框架下的线性响应。设同位旋标量单极算符定义为 $\\hat{F}=\\sum_{i=1}^{A} r_i^2$，并假设集体动力学可以由一个从一组双准粒子组态构建的单一可分离 QRPA 模式来描述。算符 $\\hat{F}$ 的能量加权求和规则 (EWSR) 定义为 $m_1=\\sum_{\\nu} \\omega_{\\nu} \\left|\\langle 0|\\hat{F}|\\nu\\rangle\\right|^2$，其中 $\\omega_{\\nu}$ 是 QRPA 激发能，而 $|\\nu\\rangle$ 是对应的 QRPA 本征态。Thouless 定理指出，在完全自洽的随机相位近似 (RPA) 或 QRPA 中，EWSR 等于双对易子的基态期望值 $m_1=\\frac{1}{2}\\langle 0|[\\hat{F},[\\hat{H},\\hat{F}]]|0\\rangle$。\n\n从以下基本基础出发：\n- 导致 QRPA 本征值问题的依赖时间的 Hartree-Fock-Bogoliubov (TDHFB) 线性响应理论，\n- EWSR 的双对易子定义，\n- 将集体模式映射到单个玻色子自由度上的示意性可分離 QRPA 模型。\n\n在单模式可分離 QRPA 模型中，本征值问题可以用矩阵 $A$ 和 $B$ 写成\n$$\n\\begin{pmatrix}\nA  B \\\\\n-B  -A\n\\end{pmatrix}\n\\begin{pmatrix}\nX \\\\\nY\n\\end{pmatrix}\n=\n\\omega\n\\begin{pmatrix}\n1  0 \\\\\n0  -1\n\\end{pmatrix}\n\\begin{pmatrix}\nX \\\\\nY\n\\end{pmatrix},\n$$\n在准玻色子近似下，归一化条件为 $X^2 - Y^2 = 1$。在具有依赖于密度的能量密度泛函 (EDF) 的自洽模型中，重排项会进入剩余相互作用。为了示意性地表示这种效应，使用以下参数化：\n- 未受扰动的双准粒子能量是一个单一常数 $\\Omega$ (单位为 MeV)，\n- $\\hat{F}$ 与集体坐标的耦合振幅是一个单一常数 $q$ (单位为 fm$^2$)，\n- 基本剩余相互作用强度为 $\\kappa_0$ (单位为 MeV)，\n- 密度依赖性由参数 $\\alpha$ (无量纲) 和体密度 $\\rho$ (单位为 fm$^{-3}$) 表征，\n- 包含重排项的有效剩余相互作用强度为 $K_{\\mathrm{eff}}=\\kappa_0\\,(1+\\alpha \\rho)$ (单位为 MeV)。\n\n将 QRPA 矩阵建模如下：\n- 包含重排项：$A_{\\mathrm{inc}}=\\Omega+K_{\\mathrm{eff}}$，$B_{\\mathrm{inc}}=K_{\\mathrm{eff}}$，\n- 省略重排项：$A_{\\mathrm{om}}=\\Omega+K_{\\mathrm{eff}}$，$B_{\\mathrm{om}}=\\kappa_0$，\n这反映了平均场包含了密度依赖的修正 (进入 $A$)，而剩余相互作用省略了重排项的导数 (从而减小了 $B$)。\n\n对于任一情况，QRPA 激发能为\n$$\n\\omega = \\sqrt{A^2 - B^2},\n$$\n前后向振幅之比 $r$ 为\n$$\nr = \\frac{Y}{X} = -\\frac{A - \\omega}{B},\n$$\n由此，到 $\\hat{F}$ 的跃迁振幅因子为\n$$\nS = \\frac{1+r}{1-r},\n$$\n使用了 $X^2 - Y^2 = 1$。单模式模型的 QRPA EWSR 则计算为\n$$\nm_1^{\\mathrm{QRPA}} = \\omega\\,S\\,q^2,\n$$\n其中 $q^2$ 确保了同位旋标量单极算符具有正确的量纲。对于集体哈密顿量为 $\\hat{H}=\\frac{\\Omega}{2}(\\hat{P}^2+\\hat{Q}^2)+\\Lambda(\\rho)\\,\\hat{Q}^2$ 且满足正则对易关系 $[\\hat{Q},\\hat{P}]=i$ 的单模式映射，其双对易子 EWSR 为\n$$\nm_1^{\\mathrm{dc}} = \\frac{1}{2}\\langle 0|[\\hat{F},[\\hat{H},\\hat{F}]]|0\\rangle = \\Omega\\,q^2,\n$$\n因为 $[\\hat{Q},[\\hat{Q}^2,\\hat{Q}]]=0$ 且只有动能项对双对易子有贡献。在自洽的 QRPA 计算中，$m_1^{\\mathrm{QRPA}}$ 必须等于 $m_1^{\\mathrm{dc}}$ (Thouless 定理)。省略重排项会破坏这种相等关系。\n\n任务：\n1. 实现一个程序，为每个测试用例计算：\n   - 包含重排项的 QRPA EWSR $m_1^{\\mathrm{inc}}=\\omega_{\\mathrm{inc}}\\,S_{\\mathrm{inc}}\\,q^2$，\n   - 省略重排项的 QRPA EWSR $m_1^{\\mathrm{om}}=\\omega_{\\mathrm{om}}\\,S_{\\mathrm{om}}\\,q^2$，\n   - 双对易子 EWSR $m_1^{\\mathrm{dc}}=\\Omega\\,q^2$，\n   - 因省略而导致的 EWSR 变化量 $\\Delta m_1 = m_1^{\\mathrm{inc}} - m_1^{\\mathrm{om}}$，\n   - 包含重排项时对 Thouless 定理的违背量 $v_{\\mathrm{inc}} = m_1^{\\mathrm{dc}} - m_1^{\\mathrm{inc}}$，\n   - 省略重排项时对 Thouless 定理的违背量 $v_{\\mathrm{om}} = m_1^{\\mathrm{dc}} - m_1^{\\mathrm{om}}$。\n2. 将所有 EWSR 量 $m_1$ 及其差值以 MeV·fm$^4$ 为单位表示。\n3. 你的程序应该生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果，每个内部列表对应一个测试用例，并包含三个浮点数 $[\\Delta m_1, v_{\\mathrm{inc}}, v_{\\mathrm{om}}]$ (单位为 MeV·fm$^4$)，格式严格如下： \"[[x11,x12,x13],[x21,x22,x23],...]\" 且不含任何空格，即 \"[[x11,x12,x13],[x21,x22,x23],...]\"。\n4. 使用以下测试套件以确保覆盖率：\n   - 用例 1 (正常路径)：$\\Omega=14$ MeV, $q=3.0$ fm$^2$, $\\kappa_0=5.0$ MeV, $\\alpha=0.5$, $\\rho=0.16$ fm$^{-3}$，\n   - 用例 2 (边界，无密度依赖)：$\\Omega=12$ MeV, $q=2.5$ fm$^2$, $\\kappa_0=4.0$ MeV, $\\alpha=0.0$, $\\rho=0.16$ fm$^{-3}$，\n   - 用例 3 (强密度依赖)：$\\Omega=20$ MeV, $q=4.0$ fm$^2$, $\\kappa_0=6.0$ MeV, $\\alpha=2.0$, $\\rho=0.16$ fm$^{-3}$，\n   - 用例 4 (软模式边缘情况)：$\\Omega=8$ MeV, $q=1.0$ fm$^2$, $\\kappa_0=3.0$ MeV, $\\alpha=1.5$, $\\rho=0.10$ fm$^{-3}$。\n\n你的程序必须是自包含的，并且不得读取任何输入。它应该只打印包含结果列表的所需单行输出，格式如上文精确指定。",
            "solution": "问题陈述的有效性经过了严格评估。该问题提法恰当，科学上基于原子核集体运动理论 (QRPA)，并给出了一个清晰的量化任务。所有必要的参数和方程都已指定。然而，在跃迁振幅因子 $S$ 的定义中存在一个微小的内部不一致。陈述中断言 $S = (X+Y)^2/X^2 = (1+r)/(1-r)$，使用了关系式 $X^2-Y^2=1$ 和定义 $r=Y/X$。等式的第一部分 $(X+Y)^2/X^2$ 可简化为 $(1+r)^2$。对于任何非零的 $r$，断言 $(1+r)^2 = (1+r)/(1-r)$ 在算术上是错误的。\n\n这可能是一个排印错误。在 QRPA 理论中，对于一个时间奇跃迁算符（其跃迁强度将正比于 $(X+Y)^2$），一个标准结果是 $(X+Y)^2 = \\frac{1+r}{1-r}$，这是使用归一化条件 $X^2-Y^2=1$ 推导出来的。如果我们假设该因子的预期定义是 $S=(X+Y)^2$，那么后续的等式就成立了。此外，使用关系式 $S = (1+r)/(1-r)$ 会导出预期的物理结果，即在自洽情况下 Thouless 定理得到满足 ($m_1^{\\mathrm{inc}} = m_1^{\\mathrm{dc}}$)，如下所示。因此，该问题被认为是有效的，前提是作如下解读：术语 `/X^2` 是一个排印错误，应使用的正确公式是 $S = (1+r)/(1-r)$。\n\n目标是在一个示意性的准粒子随机相位近似 (QRPA) 模型中，计算和比较同位旋标量单极算符的能量加权求和规则 (EWSR)。我们将分析两种情景：一种是与底层的平均场理论完全自洽的（“包含重排项”），另一种是通过从剩余相互作用中省略重排项而破坏自洽性的（“省略重排项”）。这使我们能够量化对 Thouless 定理的违背程度，该定理指出，在自洽理论中，通过 QRPA 计算的 EWSR $m_1^{\\mathrm{QRPA}}$ 必须等于从双对易子导出的值 $m_1^{\\mathrm{dc}}$。\n\n该模型的基本参数是未受扰动的双准粒子能量 $\\Omega$、算符耦合强度 $q$、基本剩余相互作用强度 $\\kappa_0$，以及控制相互作用密度依赖性的参数 $\\alpha$ 和 $\\rho$。有效剩余相互作用强度为 $K_{\\mathrm{eff}}=\\kappa_0\\,(1+\\alpha \\rho)$。\n\nQRPA 本征值问题由矩阵 $A$ 和 $B$ 表征。其解给出激发能 $\\omega = \\sqrt{A^2 - B^2}$ 和前后向振幅之比 $r = Y/X = -(A-\\omega)/B$。\n\n首先，我们分析正确包含重排项的自洽情况。QRPA 矩阵为 $A_{\\mathrm{inc}}=\\Omega+K_{\\mathrm{eff}}$ 和 $B_{\\mathrm{inc}}=K_{\\mathrm{eff}}$。\n激发能为：\n$$\n\\omega_{\\mathrm{inc}} = \\sqrt{A_{\\mathrm{inc}}^2 - B_{\\mathrm{inc}}^2} = \\sqrt{(\\Omega+K_{\\mathrm{eff}})^2 - K_{\\mathrm{eff}}^2} = \\sqrt{\\Omega^2 + 2\\Omega K_{\\mathrm{eff}}} = \\sqrt{\\Omega(\\Omega+2K_{\\mathrm{eff}})}\n$$\n振幅比为 $r_{\\mathrm{inc}} = - (A_{\\mathrm{inc}} - \\omega_{\\mathrm{inc}})/B_{\\mathrm{inc}}$。跃迁因子 $S_{\\mathrm{inc}}$ 由下式给出：\n$$\nS_{\\mathrm{inc}} = \\frac{1+r_{\\mathrm{inc}}}{1-r_{\\mathrm{inc}}} = \\frac{1 - (A_{\\mathrm{inc}} - \\omega_{\\mathrm{inc}})/B_{\\mathrm{inc}}}{1 + (A_{\\mathrm{inc}} - \\omega_{\\mathrm{inc}})/B_{\\mathrm{inc}}} = \\frac{B_{\\mathrm{inc}} - A_{\\mathrm{inc}} + \\omega_{\\mathrm{inc}}}{B_{\\mathrm{inc}} + A_{\\mathrm{inc}} - \\omega_{\\mathrm{inc}}}\n$$\n代入 $A_{\\mathrm{inc}}=\\Omega+K_{\\mathrm{eff}}$ 和 $B_{\\mathrm{inc}}=K_{\\mathrm{eff}}$：\n$$\nS_{\\mathrm{inc}} = \\frac{K_{\\mathrm{eff}} - (\\Omega+K_{\\mathrm{eff}}) + \\omega_{\\mathrm{inc}}}{K_{\\mathrm{eff}} + (\\Omega+K_{\\mathrm{eff}}) - \\omega_{\\mathrm{inc}}} = \\frac{\\omega_{\\mathrm{inc}} - \\Omega}{\\Omega + 2K_{\\mathrm{eff}} - \\omega_{\\mathrm{inc}}}\n$$\nQRPA EWSR 为 $m_1^{\\mathrm{inc}} = \\omega_{\\mathrm{inc}} S_{\\mathrm{inc}} q^2$。让我们计算乘积 $\\omega_{\\mathrm{inc}} S_{\\mathrm{inc}}$：\n$$\n\\omega_{\\mathrm{inc}} S_{\\mathrm{inc}} = \\omega_{\\mathrm{inc}} \\frac{\\omega_{\\mathrm{inc}} - \\Omega}{\\Omega + 2K_{\\mathrm{eff}} - \\omega_{\\mathrm{inc}}} = \\frac{\\omega_{\\mathrm{inc}}^2 - \\Omega \\omega_{\\mathrm{inc}}}{\\Omega + 2K_{\\mathrm{eff}} - \\omega_{\\mathrm{inc}}}\n$$\n使用 $\\omega_{\\mathrm{inc}}^2 = \\Omega^2 + 2\\Omega K_{\\mathrm{eff}}$：\n$$\n\\omega_{\\mathrm{inc}} S_{\\mathrm{inc}} = \\frac{(\\Omega^2 + 2\\Omega K_{\\mathrm{eff}}) - \\Omega \\omega_{\\mathrm{inc}}}{\\Omega + 2K_{\\mathrm{eff}} - \\omega_{\\mathrm{inc}}} = \\frac{\\Omega(\\Omega + 2K_{\\mathrm{eff}} - \\omega_{\\mathrm{inc}})}{\\Omega + 2K_{\\mathrm{eff}} - \\omega_{\\mathrm{inc}}} = \\Omega\n$$\n因此，$m_1^{\\mathrm{inc}} = \\Omega q^2$。双对易子求和规则给出为 $m_1^{\\mathrm{dc}} = \\Omega q^2$。我们看到 $m_1^{\\mathrm{inc}}=m_1^{\\mathrm{dc}}$，满足 Thouless 定理。违背量 $v_{\\mathrm{inc}} = m_1^{\\mathrm{dc}} - m_1^{\\mathrm{inc}}$ 恒为零。\n\n接下来，我们分析从剩余相互作用中省略重排项的非自洽情况。QRPA 矩阵为 $A_{\\mathrm{om}}=\\Omega+K_{\\mathrm{eff}}$ 和 $B_{\\mathrm{om}}=\\kappa_0$。\n激发能为：\n$$\n\\omega_{\\mathrm{om}} = \\sqrt{(\\Omega+K_{\\mathrm{eff}})^2 - \\kappa_0^2}\n$$\n振幅比为 $r_{\\mathrm{om}} = -(A_{\\mathrm{om}} - \\omega_{\\mathrm{om}})/B_{\\mathrm{om}}$，跃迁因子为 $S_{\\mathrm{om}} = (1+r_{\\mathrm{om}})/(1-r_{\\mathrm{om}})$。\n相应的 QRPA EWSR 为：\n$$\nm_1^{\\mathrm{om}} = \\omega_{\\mathrm{om}} S_{\\mathrm{om}} q^2\n$$\n该值通常不等于 $\\Omega q^2$。在这种情况下，对 Thouless 定理的违背量为 $v_{\\mathrm{om}} = m_1^{\\mathrm{dc}} - m_1^{\\mathrm{om}} = \\Omega q^2 - m_1^{\\mathrm{om}}$。\n\n要计算的最后一个量是由于省略重排项而导致的 EWSR 变化量：\n$$\n\\Delta m_1 = m_1^{\\mathrm{inc}} - m_1^{\\mathrm{om}} = \\Omega q^2 - m_1^{\\mathrm{om}}\n$$\n我们注意到，对于这个特定模型，违背量 $v_{\\mathrm{om}}$ 与变化量 $\\Delta m_1$ 是相同的。\n\n算法如下：\n1. 对于每个测试用例 $(\\Omega, q, \\kappa_0, \\alpha, \\rho)$:\n2. 计算 $K_{\\mathrm{eff}}=\\kappa_0\\,(1+\\alpha \\rho)$。\n3. 包含重排项的 EWSR 为 $m_1^{\\mathrm{inc}} = \\Omega q^2$。双对易子的值为 $m_1^{\\mathrm{dc}} = \\Omega q^2$。因此，违背量为 $v_{\\mathrm{inc}} = 0$。\n4. 对于省略重排项的情况，计算 $A_{\\mathrm{om}}=\\Omega+K_{\\mathrm{eff}}$ 和 $B_{\\mathrm{om}}=\\kappa_0$。\n5. 计算能量 $\\omega_{\\mathrm{om}} = \\sqrt{A_{\\mathrm{om}}^2 - B_{\\mathrm{om}}^2}$。\n6. 计算比率 $r_{\\mathrm{om}} = - (A_{\\mathrm{om}} - \\omega_{\\mathrm{om}})/B_{\\mathrm{om}}$。\n7. 计算因子 $S_{\\mathrm{om}} = (1+r_{\\mathrm{om}})/(1-r_{\\mathrm{om}})$。\n8. 计算 EWSR $m_1^{\\mathrm{om}} = \\omega_{\\mathrm{om}} S_{\\mathrm{om}} q^2$。\n9. 计算所需的输出：$\\Delta m_1 = m_1^{\\mathrm{inc}} - m_1^{\\mathrm{om}}$，$v_{\\mathrm{inc}} = 0$，以及 $v_{\\mathrm{om}} = m_1^{\\mathrm{dc}} - m_1^{\\mathrm{om}}$。\n10. 存储三元组 $[\\Delta m_1, v_{\\mathrm{inc}}, v_{\\mathrm{om}}]$ 以用于最终输出。\n此过程将为所有提供的测试用例实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes EWSR-related quantities for a schematic QRPA model\n    to demonstrate the effect of omitting rearrangement terms.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Omega, q, kappa0, alpha, rho)\n    test_cases = [\n        (14.0, 3.0, 5.0, 0.5, 0.16),    # Case 1 (happy path)\n        (12.0, 2.5, 4.0, 0.0, 0.16),    # Case 2 (boundary, no density dependence)\n        (20.0, 4.0, 6.0, 2.0, 0.16),    # Case 3 (strong density dependence)\n        (8.0, 1.0, 3.0, 1.5, 0.10),     # Case 4 (soft mode edge case)\n    ]\n\n    results = []\n    for Omega, q, kappa0, alpha, rho in test_cases:\n        # Calculate intermediate and final quantities\n        \n        # Effective residual strength\n        K_eff = kappa0 * (1 + alpha * rho)\n        \n        # Square of the coupling amplitude\n        q_squared = q**2\n        \n        # Double-commutator EWSR (and the self-consistent QRPA EWSR)\n        m1_dc = Omega * q_squared\n        m1_inc = m1_dc\n        \n        # Thouless theorem violation with rearrangement included\n        v_inc = m1_dc - m1_inc  # This is always 0 by construction\n        \n        # --- Calculations for the case with rearrangement omitted ---\n        \n        # A and B matrices for the omitted case\n        A_om = Omega + K_eff\n        B_om = kappa0\n        \n        m1_om = 0.0\n        # Check for QRPA stability condition |A|  |B|\n        if abs(A_om) > abs(B_om):\n            # QRPA excitation energy\n            omega_om = np.sqrt(A_om**2 - B_om**2)\n            \n            # Ratio of backward to forward amplitudes\n            # B_om (kappa0) is always positive in test cases, no division by zero\n            r_om = -(A_om - omega_om) / B_om\n            \n            # Transition amplitude factor S\n            # Denominator (1 - r_om) can't be zero since it implies |A| = |B|\n            S_om = (1 + r_om) / (1 - r_om)\n            \n            # QRPA EWSR with rearrangement omitted\n            m1_om = omega_om * S_om * q_squared\n        else:\n            # Handle the unstable case if it were to occur, though not in test data.\n            # In an unstable case, omega would be imaginary. We set EWSR to 0 or NaN.\n            # For this problem, we can assume stability based on the parameters.\n            pass\n\n        # Change in EWSR due to omission of rearrangement terms\n        delta_m1 = m1_inc - m1_om\n        \n        # Thouless theorem violation with rearrangement omitted\n        v_om = m1_dc - m1_om\n        \n        # Append the list of results for this test case\n        results.append([delta_m1, v_inc, v_om])\n\n    # Format the output string as specified: \"[[x1,y1,z1],[x2,y2,z2],...]\"\n    # with no spaces.\n    inner_strings = []\n    for res_case in results:\n        # Format each number and join them with commas inside brackets.\n        inner_strings.append(f\"[{res_case[0]},{res_case[1]},{res_case[2]}]\")\n    \n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}