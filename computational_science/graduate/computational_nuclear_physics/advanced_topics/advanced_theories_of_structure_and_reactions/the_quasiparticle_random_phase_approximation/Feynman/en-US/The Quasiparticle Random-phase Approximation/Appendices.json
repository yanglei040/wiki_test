{
    "hands_on_practices": [
        {
            "introduction": "Before we can describe the excited states of a nucleus, we must first establish a robust description of its ground state. The Quasiparticle Random-Phase Approximation (QRPA) is built upon a ground state described by the Hartree-Fock-Bogoliubov (HFB) theory, often simplified to the Bardeen-Cooper-Schrieffer (BCS) approach for pairing correlations. This first exercise  is essential, as it walks you through the implementation of the fundamental BCS equations to determine the properties of the paired ground state, such as the pairing gap $\\Delta$ and quasiparticle structure, which form the vacuum for QRPA excitations.",
            "id": "3606041",
            "problem": "Implement a complete program that constructs the Bardeen-Cooper-Schrieffer (BCS) quasiparticle vacuum for a reduced constant-pairing two-level model and verifies two fundamental identities that underlie the Quasiparticle Random-Phase Approximation (QRPA). Consider a system of identical fermions in two single-particle levels indexed by $i \\in \\{1,2\\}$ with single-particle energies $\\epsilon_i$ and pair degeneracies $\\Omega_i$ (the number of time-reversed pairs per level). The reduced constant-pairing Hamiltonian is\n$$\nH = \\sum_{i=1}^{2} 2\\,\\epsilon_i\\,\\hat{N}_i \\;-\\; G \\sum_{i,j=1}^{2} \\hat{P}_i^\\dagger \\hat{P}_j,\n$$\nwhere $G \\gt 0$ is the pairing strength, $\\hat{N}_i$ counts pairs in level $i$, and $\\hat{P}_i^\\dagger$ creates a correlated pair in level $i$. At zero temperature, the Bardeen-Cooper-Schrieffer (BCS) approach introduces a Bogoliubov-Valatin transformation to quasiparticles with amplitudes $u_i$ and $v_i$ and defines the quasiparticle energies $E_i$. The BCS state is determined by the pairing gap $\\Delta$ and the chemical potential $\\lambda$ that minimize the ground-state energy subject to fixed particle number $N$.\n\nYour program must, for each test case, compute $u_i$, $v_i$, and $E_i$ self-consistently by solving the BCS equations for the reduced constant pairing Hamiltonian with two levels:\n- The quasiparticle energies are defined by\n$$\nE_i \\equiv \\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}.\n$$\n- The occupation amplitudes satisfy\n$$\nv_i^2 \\equiv \\tfrac{1}{2}\\left(1 - \\frac{\\epsilon_i - \\lambda}{E_i}\\right),\\qquad u_i^2 \\equiv 1 - v_i^2.\n$$\n- The gap equation is\n$$\n\\Delta \\equiv \\frac{G}{2}\\sum_{i=1}^{2}\\Omega_i \\frac{\\Delta}{E_i},\n$$\nwhich is equivalent to the condition\n$$\n\\Delta = 0 \\quad \\text{or} \\quad 1 = \\frac{G}{2}\\sum_{i=1}^{2}\\frac{\\Omega_i}{E_i}.\n$$\n- The particle-number equation is\n$$\nN \\equiv 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2.\n$$\n\nYour program must robustly handle both the paired phase with $\\Delta \\gt 0$ and the normal phase with $\\Delta = 0$. In the normal phase, the limiting values $v_i^2 \\in \\{0, \\tfrac{1}{2}, 1\\}$ are determined by the sign of $\\epsilon_i - \\lambda$ with $\\lambda$ placed to realize the requested $N$ when possible.\n\nFor each test case, after computing $\\{u_i,v_i,E_i\\}_{i=1,2}$, verify numerically the following:\n- Bogoliubov normalization summed over all time-reversed pairs:\n$$\n\\sum_{i=1}^{2} \\Omega_i \\left(u_i^2 + v_i^2\\right) \\stackrel{?}{=} \\Omega_{\\text{tot}},\n$$\nwhere $\\Omega_{\\text{tot}} \\equiv \\Omega_1 + \\Omega_2$.\n- Particle-number expectation:\n$$\n\\langle N \\rangle \\equiv 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2 \\stackrel{?}{=} N.\n$$\n\nNumerical details and conventions:\n- Energies $\\epsilon_i$, $G$, and $E_i$ and the gap $\\Delta$ must be treated in mega-electron-volts (MeV). No units are required in the program output because the outputs are booleans.\n- Use a numerical tolerance of $10^{-10}$ to assess equality in the two verifications.\n- Angles are not used. No percentage outputs are required.\n- You may use any deterministic numerical root-finding strategy to solve for $\\Delta$ and $\\lambda$, including attempting multiple initial guesses. If no $\\Delta \\gt 0$ solution is found, you must fall back to the normal phase with $\\Delta = 0$ and choose $\\lambda$ consistently with the requested $N$ when possible.\n\nTest suite:\n- Case $1$ (paired, symmetric, half-filled): $\\epsilon = [-0.5, +0.5]$ in MeV, $\\Omega = [4, 4]$, $G = 0.2$ in MeV, $N = 8$.\n- Case $2$ (normal phase, below critical coupling): $\\epsilon = [-0.5, +0.5]$ in MeV, $\\Omega = [4, 4]$, $G = 0.1$ in MeV, $N = 8$.\n- Case $3$ (asymmetric general case, paired): $\\epsilon = [0.0, 1.5]$ in MeV, $\\Omega = [3, 5]$, $G = 0.3$ in MeV, $N = 10$.\n\nRequired final output format:\n- Your program should produce a single line of output containing a flat list of booleans in the following order:\n$$\n[\\text{case1\\_norm\\_ok},\\ \\text{case1\\_N\\_ok},\\ \\text{case2\\_norm\\_ok},\\ \\text{case2\\_N\\_ok},\\ \\text{case3\\_norm\\_ok},\\ \\text{case3\\_N\\_ok}],\n$$\nwhere each entry is true if and only if the corresponding verification holds within the tolerance $10^{-10}$. For example, a valid output could look like $[True,True,True,True,True,True]$ if all checks pass.\n\nImplementation requirements:\n- The final answer must be a complete, runnable Python program. It must not require any user input, files, or network access. It must compute the results for the test suite as described above and print the single-line output in the exact format specified.",
            "solution": "The problem requires the implementation of a program to solve the Bardeen-Cooper-Schrieffer (BCS) equations for a two-level nuclear model and subsequently verify two fundamental identities. The validation of the problem statement confirms that it is scientifically sound, well-posed, and contains all necessary information to proceed with a unique and meaningful solution. The model and its associated equations are standard in the field of theoretical nuclear physics.\n\nThe solution strategy involves finding the pairing gap $\\Delta$ and the chemical potential $\\lambda$ that self-consistently satisfy the BCS equations for a given set of parameters: single-particle energies $\\{\\epsilon_1, \\epsilon_2\\}$, pair degeneracies $\\{\\Omega_1, \\Omega_2\\}$, pairing strength $G$, and total particle number $N$. The solution must account for two possible phases: a paired (superfluid) phase where $\\Delta > 0$, and a normal phase where $\\Delta = 0$.\n\nThe core of the problem is to solve a system of two coupled, non-linear equations for the two unknowns, $\\Delta$ and $\\lambda$. The approach is bifurcated into handling the paired and normal phases separately.\n\nFirst, an attempt is made to find a solution in the paired phase, characterized by $\\Delta > 0$. In this phase, the two governing equations are the gap equation and the particle-number equation.\n\nThe gap equation is given by:\n$$\n1 = \\frac{G}{2}\\sum_{i=1}^{2}\\frac{\\Omega_i}{E_i}\n$$\nwhere $E_i$ is the quasiparticle energy for level $i$:\n$$\nE_i = \\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}\n$$\nThe particle-number equation is:\n$$\nN = 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2\n$$\nwhere $v_i^2$ is the occupation probability for a pair state in level $i$:\n$$\nv_i^2 = \\frac{1}{2}\\left(1 - \\frac{\\epsilon_i - \\lambda}{E_i}\\right)\n$$\nSubstituting the expressions for $v_i^2$ and $E_i$ transforms the gap and number equations into a system dependent only on $\\Delta$ and $\\lambda$:\n$$\nf_1(\\Delta, \\lambda) = 1 - \\frac{G}{2}\\sum_{i=1}^{2}\\frac{\\Omega_i}{\\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}} = 0\n$$\n$$\nf_2(\\Delta, \\lambda) = N - \\sum_{i=1}^{2}\\Omega_i \\left(1 - \\frac{\\epsilon_i - \\lambda}{\\sqrt{(\\epsilon_i - \\lambda)^2 + \\Delta^2}}\\right) = 0\n$$\nThis system of equations is solved numerically for the pair $(\\Delta, \\lambda)$. We employ a numerical root-finding algorithm, specifically `scipy.optimize.root`, which seeks a vector $(\\Delta, \\lambda)$ that drives the residuals $(f_1, f_2)$ to zero. To ensure a physically meaningful solution, we only accept results where $\\Delta > 0$ within a small numerical tolerance. A reasonable initial guess is chosen, with $\\lambda$ near the average of the single-particle energies and $\\Delta$ being a small positive value.\n\nIf the numerical solver fails to find a convergent solution or if the resulting $\\Delta$ is not positive, we conclude that the system is in the normal phase. In this phase, $\\Delta=0$. The quasiparticle energies simplify to $E_i = |\\epsilon_i - \\lambda|$. The ground state for a fixed particle number $N$ corresponds to a non-interacting configuration where single-particle levels are filled in order of increasing energy. The occupation probabilities $v_i^2$ become either $0$ or $1$, unless a level is partially filled. The chemical potential $\\lambda$ is determined by the particle number condition. Specifically, $\\lambda$ is set equal to the single-particle energy of the highest occupied (or partially occupied) level. The occupation probabilities $v_i^2$ are then calculated to satisfy the number constraint $N = 2\\sum_i \\Omega_i v_i^2$. For levels below $\\lambda$, $v_i^2=1$; for levels above $\\lambda$, $v_i^2=0$; and for the level at $\\lambda$, $v_i^2$ takes a value in $[0,1]$ that fulfills the number equation.\n\nOnce the values for $\\Delta$, $\\lambda$, and the corresponding $v_i^2$ are determined, we calculate $u_i^2 = 1 - v_i^2$. With these quantities, two verifications are performed.\n1. Bogoliubov normalization: The sum $\\sum_{i=1}^{2} \\Omega_i (u_i^2 + v_i^2)$ is computed and compared against the total pair degeneracy $\\Omega_{\\text{tot}} = \\Omega_1 + \\Omega_2$. This is an identity since $u_i^2+v_i^2=1$, serving as a sanity check on the implementation.\n2. Particle-number expectation: The expectation value of the particle number, $\\langle N \\rangle = 2\\sum_{i=1}^{2}\\Omega_i\\,v_i^2$, is computed and compared against the target particle number $N$. This confirms that the solution correctly satisfies the constraint.\n\nBoth comparisons are made using a numerical tolerance of $10^{-10}$. The resulting boolean outcomes for each test case are compiled into a final list.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root\n\n# language: Python\n# version: 3.12\n# libraries:\n#   - name: numpy\n#     version: 1.23.5\n#   - name: scipy\n#     version: 1.11.4\n\ndef solve():\n    \"\"\"\n    Main function to run the BCS calculations for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (paired, symmetric, half-filled)\n        {'eps': np.array([-0.5, 0.5]), 'Omega': np.array([4, 4]), 'G': 0.2, 'N': 8},\n        # Case 2 (normal phase, below critical coupling)\n        {'eps': np.array([-0.5, 0.5]), 'Omega': np.array([4, 4]), 'G': 0.1, 'N': 8},\n        # Case 3 (asymmetric general case, paired)\n        {'eps': np.array([0.0, 1.5]), 'Omega': np.array([3, 5]), 'G': 0.3, 'N': 10},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        norm_ok, n_ok = compute_and_verify(\n            case['eps'], case['Omega'], case['G'], case['N']\n        )\n        all_results.extend([norm_ok, n_ok])\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\n\ndef compute_and_verify(eps, Omega, G, N):\n    \"\"\"\n    Solves the BCS equations and verifies the identities for a single test case.\n    \n    Returns:\n        tuple[bool, bool]: A tuple containing the boolean results for the\n                           normalization check and the particle number check.\n    \"\"\"\n    tolerance = 1e-10\n\n    def solve_paired_phase(eps, Omega, G, N):\n        \"\"\"Attempts to find a paired solution (Delta > 0).\"\"\"\n        def equations(variables):\n            Delta, lam = variables\n            \n            # Penalize unphysical Delta<=0 region to guide the solver\n            if Delta <= 0:\n                return [1e10, 1e10]\n\n            # Quasiparticle energies\n            E = np.sqrt((eps - lam)**2 + Delta**2)\n\n            # Avoid division by zero, although Delta > 0 should prevent this.\n            if np.any(E < tolerance):\n                return [1e10, 1e10]\n\n            # Gap equation residual\n            res_gap = (G / 2.0) * np.sum(Omega / E) - 1.0\n            \n            # Number equation residual\n            res_num = np.sum(Omega * (1.0 - (eps - lam) / E)) - N\n            \n            return [res_gap, res_num]\n\n        # Initial guess\n        lam_guess = np.mean(eps)\n        delta_guess = 0.1  # Small positive guess for Delta\n        \n        sol = root(equations, [delta_guess, lam_guess], method='hybr', tol=tolerance)\n        \n        if sol.success and sol.x[0] > tolerance:\n            return sol.x # Returns (Delta, lambda)\n        return None\n\n    solution = solve_paired_phase(eps, Omega, G, N)\n    \n    if solution is not None:\n        # Paired solution found\n        Delta, lam = solution\n        E = np.sqrt((eps - lam)**2 + Delta**2)\n        v_sq = 0.5 * (1.0 - (eps - lam) / E)\n    else:\n        # Fallback to normal phase (Delta = 0)\n        Delta = 0.0\n        \n        # Sort levels by energy to handle filling sequence\n        sort_indices = np.argsort(eps)\n        eps_sorted = eps[sort_indices]\n        Omega_sorted = Omega[sort_indices]\n\n        N_level1_capacity = 2 * Omega_sorted[0]\n        \n        v_sq_sorted = np.zeros(2)\n        \n        # Determine lambda and occupations based on N\n        if N <= N_level1_capacity:\n            lam = eps_sorted[0]\n            if N_level1_capacity > 0:\n                v_sq_sorted[0] = N / N_level1_capacity\n            # v_sq_sorted[1] is already 0\n        else:\n            lam = eps_sorted[1]\n            v_sq_sorted[0] = 1.0\n            N_remaining = N - N_level1_capacity\n            N_level2_capacity = 2 * Omega_sorted[1]\n            if N_level2_capacity > 0:\n                v_sq_sorted[1] = N_remaining / N_level2_capacity\n        \n        # Revert sorting to match original order of eps/Omega\n        v_sq = v_sq_sorted[np.argsort(sort_indices)]\n\n    u_sq = 1.0 - v_sq\n\n    # --- Verifications ---\n    \n    # 1. Bogoliubov normalization check\n    Omega_tot = np.sum(Omega)\n    norm_check_val = np.sum(Omega * (u_sq + v_sq))\n    norm_ok = np.isclose(norm_check_val, Omega_tot, atol=tolerance, rtol=0)\n\n    # 2. Particle number expectation check\n    number_check_val = 2.0 * np.sum(Omega * v_sq)\n    n_ok = np.isclose(number_check_val, N, atol=tolerance, rtol=0)\n\n    return bool(norm_ok), bool(n_ok)\n\nsolve()\n```"
        },
        {
            "introduction": "Having established the quasiparticle ground state, we can now investigate its collective excitations. The QRPA models these excitations as coherent, small-amplitude vibrations built upon the HFB/BCS vacuum. This practice  takes you to the heart of the method, requiring you to construct the QRPA matrices for a schematic interaction and solve the resulting eigenvalue problem. By doing so, you will gain direct experience with how collective behavior emerges from the underlying microscopic theory and understand the practical role of basis truncation in numerical calculations.",
            "id": "3606102",
            "problem": "Implement a numerical small-amplitude linear response calculation by linearizing the Time-Dependent Hartree-Fock-Bogoliubov (TDHFB) equations for a schematic, self-consistent pairing mean field augmented by a separable particle-hole residual interaction. The objective is to compute the lowest collective excitation energy using the Quasiparticle Random-Phase Approximation (QRPA), and to verify its convergence with respect to a truncation of the two-quasiparticle basis.\n\nStart from the following context-appropriate base:\n- The TDHFB equation for the generalized density matrix is given by $i \\hbar \\, d\\mathcal{R}/dt = [\\mathcal{H}[\\mathcal{R}], \\mathcal{R}]$, and in nuclear structure applications one sets $\\hbar = 1$ in energy units of mega-electron-volts (MeV).\n- The Hartree-Fock-Bogoliubov (HFB) ground state for a constant-pairing Hamiltonian is obtained from the Bardeen-Cooper-Schrieffer (BCS) gap equation together with the particle number condition. Consider a symmetric picket-fence spectrum of $\\Omega$ doubly degenerate single-particle levels with energies $\\{\\epsilon_k\\}$ measured relative to a reference chemical potential chosen at symmetry. At exact half filling and for a symmetric spectrum one may take the chemical potential to be $\\lambda = 0$, and solve the gap equation $1 = G \\sum_k \\left(2 \\sqrt{\\epsilon_k^2 + \\Delta^2}\\right)^{-1}$ to find the pairing gap $\\Delta$. The quasiparticle energies are $E_k = \\sqrt{\\epsilon_k^2 + \\Delta^2}$ and the occupation amplitudes are $u_k^2 = \\frac{1}{2}\\left(1 + \\frac{\\epsilon_k}{E_k}\\right)$ and $v_k^2 = 1 - u_k^2$.\n- The residual particle-hole interaction is taken to be a separable operator of the form $V_{\\mathrm{res}} = -\\kappa \\, \\hat{Q} \\, \\hat{Q}$, with $\\hat{Q} = \\sum_k f_k \\left(\\hat{n}_k + \\hat{n}_{\\bar{k}}\\right)$ and $\\hat{n}_k = a_k^\\dagger a_k$. This one-body operator couples to two-quasiparticle excitations through the anomalous terms in its Bogoliubov expansion.\n\nTask requirements:\n1. Derive from the linearized TDHFB equation the QRPA eigenvalue problem in the two-quasiparticle basis built on the HFB ground state. Use the quasiboson approximation and the double-commutator definition of the QRPA matrices to obtain explicit expressions for the matrices in terms of the HFB quasiparticle energies and the coupling form factors induced by $\\hat{Q}$.\n2. For the schematic model defined above, restrict the two-quasiparticle basis to the time-reversal paired states $\\{|k \\, \\bar{k}\\rangle\\}$, with unperturbed two-quasiparticle energies $2 E_k$. Implement a truncation by keeping only the $N_{\\mathrm{trunc}}$ lowest-energy two-quasiparticle configurations in this basis.\n3. Compute the lowest positive QRPA eigenfrequency $\\omega_{\\min}$ that solves the derived eigenvalue problem. This quantity is the smallest positive eigenvalue of the QRPA matrix and represents the lowest collective excitation energy in MeV.\n4. Verify convergence with respect to the two-quasiparticle truncation by evaluating $\\omega_{\\min}$ for multiple values of $N_{\\mathrm{trunc}}$.\n\nNumerical and physical details to implement:\n- Use a picket-fence spectrum with $\\Omega$ doubly degenerate levels: $\\epsilon_k = \\left(k - \\frac{\\Omega + 1}{2}\\right) d$ for $k \\in \\{1,2,\\dots,\\Omega\\}$, so that the spectrum is symmetric about zero at half filling. Take $\\lambda = 0$ by symmetry.\n- Solve the Bardeen-Cooper-Schrieffer (BCS) gap equation for $\\Delta$ using a robust root-finding method, and compute $\\{E_k, u_k, v_k\\}$.\n- Choose the structure factors $f_k = \\epsilon_k$ in the operator $\\hat{Q}$, which leads to nontrivial coupling to the two-quasiparticle space.\n- Build the QRPA matrix in the truncated $\\{|k \\, \\bar{k}\\rangle\\}$ basis and solve for its eigenvalues; select the smallest positive eigenvalue as $\\omega_{\\min}$.\n- Express all energies in MeV. Your program must round each reported $\\omega_{\\min}$ to three decimal places in MeV.\n\nTest suite and required final output format:\n- Use the following set of five test cases, each specified by $(\\Omega, d, G, \\kappa, N_{\\mathrm{trunc}})$ with all coupling constants in MeV and energies in MeV:\n    - Test 1 (happy path): $(20, 0.5, 0.55, 0.04, 4)$\n    - Test 2 (convergence increase): $(20, 0.5, 0.55, 0.04, 8)$\n    - Test 3 (boundary, no residual coupling): $(20, 0.5, 0.55, 0.00, 8)$\n    - Test 4 (edge, minimal truncation): $(10, 0.5, 0.60, 0.06, 1)$\n    - Test 5 (coverage, denser spectrum): $(30, 0.25, 0.40, 0.03, 10)$\n- Your program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[\\omega_1,\\omega_2,\\dots,\\omega_5]$, where each $\\omega_i$ is the lowest collective excitation energy for the corresponding test case, in MeV, rounded to three decimal places.\n\nAll computations must be purely numerical and self-contained, using only the specified runtime environment. No user input is permitted. The answer must be given in MeV as specified, rounded to three decimal places, and in the exact output format above. Angles do not appear in this problem. Percentages do not appear in this problem.",
            "solution": "The problem requires the implementation of a Quasiparticle Random-Phase Approximation (QRPA) calculation for a schematic nuclear model to find the lowest collective excitation energy. This involves solving the Time-Dependent Hartree-Fock-Bogoliubov (TDHFB) equations in the small-amplitude limit. The procedure is as follows: first, the ground state is determined using the Bardeen-Cooper-Schrieffer (BCS) theory within the Hartree-Fock-Bogoliubov (HFB) framework. Second, the QRPA equations, which describe linear response about this ground state, are derived and solved for the specified residual interaction.\n\nThe nucleus is modeled by $\\Omega$ doubly degenerate single-particle levels with energies $\\epsilon_k = (k - (\\Omega + 1)/2)d$ for $k \\in \\{1, 2, \\dots, \\Omega\\}$, symmetric around a chemical potential $\\lambda=0$. The particles interact via a constant pairing force of strength $G$.\n\n**1. Ground State: The HFB/BCS Solution**\n\nThe HFB ground state is found by solving the BCS equations. The pairing gap $\\Delta$ is determined by the gap equation:\n$$\n1 = G \\sum_{k=1}^{\\Omega} \\frac{1}{2 \\sqrt{\\epsilon_k^2 + \\Delta^2}}\n$$\nThis is a nonlinear equation for $\\Delta$, which must be solved numerically using a root-finding algorithm. Given $\\Delta$, the quasiparticle energies $E_k$ and the occupation amplitudes $u_k, v_k$ for each level $k$ are given by:\n$$\nE_k = \\sqrt{\\epsilon_k^2 + \\Delta^2}\n$$\n$$\nu_k^2 = \\frac{1}{2} \\left(1 + \\frac{\\epsilon_k}{E_k}\\right), \\quad v_k^2 = \\frac{1}{2} \\left(1 - \\frac{\\epsilon_k}{E_k}\\right)\n$$\nThe HFB ground state is the vacuum for these quasiparticles. Excitations are built upon this state.\n\n**2. The QRPA Equations for Collective Excitations**\n\nSmall-amplitude oscillations around the HFB ground state are described by the QRPA. The QRPA equations of motion, for an excitation with energy $\\omega$, can be expressed as a matrix eigenvalue problem:\n$$\n\\begin{pmatrix} A & B \\\\ -B^* & -A^* \\end{pmatrix} \\begin{pmatrix} X \\\\ Y \\end{pmatrix} = \\omega \\begin{pmatrix} X \\\\ Y \\end{pmatrix}\n$$\nHere, $X$ and $Y$ are the forward and backward-going amplitudes for the excitation, and the basis is composed of two-quasiparticle (2QP) states. For the specified problem, we consider 2QP states of the form $|k\\bar{k}\\rangle = \\beta_k^\\dagger \\beta_{\\bar{k}}^\\dagger |\\text{HFB}\\rangle$, where $\\beta^\\dagger$ creates a quasiparticle and $|\\text{HFB}\\rangle$ is the HFB ground state. The state $|k\\bar{k}\\rangle$ has an unperturbed energy of $2E_k$. The matrices $A$ and $B$ are real and symmetric for the given interaction.\n\nThe QRPA matrices $A$ and $B$ are defined by double commutators involving the full Hamiltonian $H = H_{HFB} + V_{\\mathrm{res}}$:\n$$\nA_{ij} = \\langle \\text{HFB} | [\\beta_{\\bar{i}}\\beta_i, [H, \\beta_j^\\dagger\\beta_{\\bar{j}}^\\dagger]] | \\text{HFB} \\rangle\n$$\n$$\nB_{ij} = -\\langle \\text{HFB} | [\\beta_{\\bar{i}}\\beta_i, [H, \\beta_{\\bar{j}}\\beta_j]] | \\text{HFB} \\rangle\n$$\nThe HFB part of the Hamiltonian, $H_{HFB}$, contributes a diagonal term $2E_i \\delta_{ij}$ to the matrix $A$ and zero to $B$. The residual interaction, $V_{\\mathrm{res}} = -\\kappa \\hat{Q}\\hat{Q}$ with $\\hat{Q} = \\sum_k \\epsilon_k (\\hat{n}_k+\\hat{n}_{\\bar k})$, provides the off-diagonal couplings that describe a collective response.\n\nThe operator $\\hat{Q}$ is a sum of number operators and is time-even. Its coupling to the 2QP space comes from its matrix elements between the ground state and 2QP states, the so-called \"anomalous\" terms. For the operator $\\hat{Q}$ specified, this matrix element is:\n$$\nq_k \\equiv \\langle k\\bar{k} | \\hat{Q} | \\text{HFB} \\rangle = 2 f_k u_k v_k = 2 \\epsilon_k \\frac{\\Delta}{2E_k} = \\frac{\\epsilon_k \\Delta}{E_k}\n$$\nFor a separable particle-hole interaction of the form $V_{\\mathrm{res}} = -\\kappa \\hat{Q}\\hat{Q}$, the contributions to the QRPA matrices are a standard result:\n$$\nA'_{ij} = -2\\kappa q_i q_j\n$$\n$$\nB'_{ij} = -2\\kappa q_i q_j\n$$\nThus, the full QRPA matrices are:\n$$\nA_{ij} = 2E_i \\delta_{ij} - 2\\kappa q_i q_j\n$$\n$$\nB_{ij} = -2\\kappa q_i q_j\n$$\nThe indices $i$ and $j$ run over the set of 2QP states included in the truncated basis.\n\n**3. Numerical Implementation**\n\nThe algorithmic procedure to find the lowest collective excitation energy $\\omega_{\\min}$ is:\n1.  For the given parameters $(\\Omega, d, G, \\kappa, N_{\\mathrm{trunc}})$, first compute the single-particle energies $\\epsilon_k$.\n2.  Solve the BCS gap equation numerically for $\\Delta > 0$. We use the Brent-Dekker method for its robustness.\n3.  Compute the quasiparticle energies $E_k$ for all $k \\in \\{1, \\dots, \\Omega\\}$.\n4.  The 2QP basis is formed by states with unperturbed energies $2E_k$. We truncate this basis by selecting the $N_{\\mathrm{trunc}}$ states with the lowest energies $2E_k$. Let the indices of these selected levels be $I_{\\mathrm{trunc}}$.\n5.  For each $k \\in I_{\\mathrm{trunc}}$, compute the coupling factor $q_k = \\epsilon_k \\Delta / E_k$.\n6.  Construct the $N_{\\mathrm{trunc}} \\times N_{\\mathrm{trunc}}$ matrices $A$ and $B$ using the derived expressions.\n7.  Form the full $2N_{\\mathrm{trunc}} \\times 2N_{\\mathrm{trunc}}$ QRPA matrix $\\mathcal{M} = \\begin{pmatrix} A & B \\\\ -B & -A \\end{pmatrix}$.\n8.  Compute the eigenvalues of $\\mathcal{M}$. The eigenvalues are real and appear in pairs $\\pm \\omega$.\n9.  The lowest positive eigenvalue corresponds to the lowest collective excitation energy, $\\omega_{\\min}$.\n10. The procedure is repeated for each test case, and the convergence of $\\omega_{\\min}$ with respect to $N_{\\mathrm{trunc}}$ can be observed. A value of $\\kappa=0$ corresponds to the unperturbed case, where the QRPA eigenvalues are simply the 2QP energies $2E_k$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Implements a QRPA calculation for a schematic nuclear model to find the\n    lowest collective excitation energy.\n    \"\"\"\n    test_cases = [\n        (20, 0.5, 0.55, 0.04, 4),   # Test 1\n        (20, 0.5, 0.55, 0.04, 8),   # Test 2\n        (20, 0.5, 0.55, 0.00, 8),   # Test 3\n        (10, 0.5, 0.60, 0.06, 1),   # Test 4\n        (30, 0.25, 0.40, 0.03, 10), # Test 5\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        Omega, d, G, kappa, N_trunc = case\n        \n        # 1. Single-particle spectrum\n        k_vals = np.arange(1, Omega + 1)\n        epsilons = (k_vals - (Omega + 1) / 2) * d\n        \n        # 2. Solve BCS gap equation for Delta\n        def gap_equation_func(delta, G_val, eps_vals):\n            if delta <= 1e-9: # The gap must be positive\n                return -1.0 # Return a value that indicates failure or wrong side\n            \n            # Avoid division by zero if delta is very small and an epsilon is zero\n            energies = np.sqrt(eps_vals**2 + delta**2)\n            if np.any(energies < 1e-12):\n                return np.inf\n\n            return 1.0 - G_val * np.sum(1.0 / (2.0 * energies))\n\n        try:\n            # A non-zero gap exists only if G > G_crit. If not, brentq fails.\n            # In that case, Delta = 0 is the solution.\n            Delta = brentq(gap_equation_func, 1e-6, 20.0, args=(G, epsilons))\n        except ValueError:\n            Delta = 0.0\n\n        # Handle the non-interacting case (G=0) or sub-critical G\n        if Delta == 0.0:\n            if G > 0: # Check if brentq failed for another reason\n                # Sum at Delta=0, check if starting point is valid\n                # If sum > 1/G, a solution exists.\n                test_sum = G * np.sum(1.0 / (2.0 * np.abs(epsilons[epsilons != 0])))\n                if test_sum <= 1.0: # No gap solution, physics is correct\n                    pass\n                else: # Numerical failure\n                    raise RuntimeError(\"BCS solver failed to find a valid gap.\")\n            E_k = np.abs(epsilons)\n        else:\n            E_k = np.sqrt(epsilons**2 + Delta**2)\n\n        # 3. Truncate the two-quasiparticle (2QP) basis\n        # Sort by 2QP energy 2*E_k and select the N_trunc lowest\n        sorted_indices = np.argsort(E_k)\n        trunc_indices = sorted_indices[:N_trunc]\n        \n        E_trunc = E_k[trunc_indices]\n        eps_trunc = epsilons[trunc_indices]\n        \n        # If kappa is zero, the answer is the lowest unperturbed 2QP energy\n        if kappa == 0.0:\n            omega_min = 2.0 * E_trunc[0]\n            results.append(f\"{omega_min:.3f}\")\n            continue\n\n        # 4. Construct QRPA matrices A and B\n        if Delta == 0.0: # No pairing, q_k factors are zero\n            q_k_trunc = np.zeros_like(E_trunc)\n        else:\n            q_k_trunc = eps_trunc * Delta / E_trunc\n        \n        A = np.diag(2.0 * E_trunc) - 2.0 * kappa * np.outer(q_k_trunc, q_k_trunc)\n        B = -2.0 * kappa * np.outer(q_k_trunc, q_k_trunc)\n        \n        # 5. Form the full QRPA matrix M and solve the eigenvalue problem\n        M = np.block([\n            [A, B],\n            [-B, -A]\n        ])\n        \n        eigenvalues = np.linalg.eigvals(M)\n        \n        # 6. Find the lowest positive eigenvalue\n        positive_eigenvalues = eigenvalues.real[eigenvalues.real > 1e-9]\n        if len(positive_eigenvalues) == 0:\n            # This can happen if the QRPA collapses (imaginary eigenvalues)\n            # or if all eigenvalues are zero.\n            omega_min = 0.0\n        else:\n            omega_min = np.min(positive_eigenvalues)\n            \n        results.append(f\"{omega_min:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "The QRPA is more than a tool for calculating excitation spectra; it is also a powerful diagnostic for the stability of the mean-field ground state itself. A fundamental result of the theory is that a dynamical instability in the ground state manifests as imaginary eigenfrequencies in the QRPA solution. In this final practice , you will use this feature to probe for a pairing instability, observing how the QRPA eigenvalues change as the pairing interaction strength is artificially increased, and pinpointing the critical point where the stable ground state collapses.",
            "id": "3606057",
            "problem": "You are asked to implement a computational experiment that detects the onset of a quasiparticle random-phase approximation (QRPA) instability in the pairing channel of a finite system described by a simplified Energy Density Functional (EDF). The aim is to vary the residual pairing strength and identify when the QRPA spectrum acquires imaginary eigenvalues, which signals that the chosen EDF parameters violate local stability (Thouless stability) in the pairing channel. This problem focuses on the pairing vibrational mode built on a Hartree-Fock-Bogoliubov (HFB) ground state, using the Bardeen-Cooper-Schrieffer (BCS) approximation to obtain the quasiparticle spectrum.\n\nDefinitions and setup:\n- The EDF is represented in a canonical basis by a set of single-particle energies $ \\{\\epsilon_k\\}_{k=1}^N $ relative to a chemical potential $ \\mu $ and an attractive pairing interaction of baseline strength $ G_0 $ (in MeV). The EDF residual pairing vertex in the QRPA is scaled by a dimensionless control factor $ \\alpha $, so the residual pairing strength entering the QRPA $ B $-matrix is $ \\alpha G_0 $.\n- Starting from the single-particle spectrum, the HFB ground state in the Bardeen-Cooper-Schrieffer (BCS) approximation is obtained by solving the pairing gap equation for the pairing gap $ \\Delta $,\n$$\n1 = G_0 \\sum_{k=1}^N \\frac{1}{2 E_k},\n$$\nwhere the quasiparticle energies $ E_k $ satisfy\n$$\nE_k = \\sqrt{(\\epsilon_k - \\mu)^2 + \\Delta^2}.\n$$\nIf no positive solution $ \\Delta > 0 $ exists for the given $ G_0 $, then set $ \\Delta = 0 $ and the system remains in the normal phase.\n- The Bogoliubov amplitudes $ u_k $ and $ v_k $ are defined by\n$$\nu_k^2 = \\frac{1}{2}\\left(1 + \\frac{\\epsilon_k - \\mu}{E_k}\\right), \\quad v_k^2 = \\frac{1}{2}\\left(1 - \\frac{\\epsilon_k - \\mu}{E_k}\\right), \\quad u_k v_k = \\frac{\\Delta}{2 E_k}.\n$$\n- The QRPA matrix in the canonical two-quasiparticle basis has the block structure\n$$\n\\mathcal{H} = \\begin{pmatrix} A & B \\\\ -B & -A \\end{pmatrix},\n$$\nwith the blocks defined as\n$$\nA_{kk'} = 2 E_k \\, \\delta_{kk'}, \\qquad B_{kk'} = \\alpha G_0 \\, F_k F_{k'},\n$$\nwhere $ F_k = u_k v_k = \\dfrac{\\Delta}{2 E_k} $. The QRPA eigenvalue problem reads\n$$\n\\mathcal{H} \\begin{pmatrix} X \\\\ Y \\end{pmatrix} = \\omega \\begin{pmatrix} X \\\\ Y \\end{pmatrix}.\n$$\nUnder stable conditions, the eigenfrequencies $ \\omega $ are real (with a spurious zero-frequency mode associated with broken gauge symmetry), while the appearance of imaginary parts in $ \\omega $ indicates a dynamical instability of the ground state with respect to pairing vibrations.\n\nYour tasks:\n1. Implement the computation of $ \\Delta $ by solving the BCS gap equation for given $ \\{\\epsilon_k\\} $, $ \\mu $, and $ G_0 $. If the equation has no solution with $ \\Delta > 0 $, set $ \\Delta = 0 $.\n2. Compute $ E_k $, $ u_k $, $ v_k $, and $ F_k $.\n3. Assemble the QRPA matrix $ \\mathcal{H} $ and compute its eigenvalues $ \\omega $.\n4. Determine the largest absolute value of the imaginary part among all QRPA eigenvalues,\n$$\nI_{\\max} = \\max_i \\left| \\operatorname{Im}(\\omega_i) \\right|.\n$$\nThe onset of instability is indicated by $ I_{\\max} > 0 $.\n5. Your program must output, for each test case, the value of $ I_{\\max} $ in MeV as a float rounded to six decimal places.\n\nPhysical units:\n- All energies (including $ \\epsilon_k $, $ \\mu $, $ G_0 $, $ \\Delta $, $ E_k $, and eigenvalues $ \\omega $) must be treated in MeV.\n- Your programâ€™s outputs $ I_{\\max} $ must be expressed in MeV.\n\nAngle units:\n- No angles are used in this problem.\n\nOutput format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[$r_1$,$r_2$,$r_3$]\". Each $ r_i $ is the $ I_{\\max} $ value for the corresponding test case, rounded to six decimal places.\n\nTest suite:\nUse the following canonical basis, baseline pairing, and chemical potential for all test cases:\n- $ \\{\\epsilon_k\\} = [-3.0, -1.5, -0.5, 0.5, 1.5, 3.0] $ in MeV,\n- $ \\mu = 0.0 $ in MeV,\n- $ G_0 = 0.9 $ in MeV.\n\nVary the residual pairing scaling $ \\alpha $ across the following values to form six test cases:\n- Case 1: $ \\alpha = 0.5 $ (reduced residual pairing; expected stable),\n- Case 2: $ \\alpha = 1.0 $ (self-consistent residual; expected stable),\n- Case 3: $ \\alpha = 1.5 $ (moderate increase; expected stable),\n- Case 4: $ \\alpha = 2.0 $ (near stability boundary; potential softening),\n- Case 5: $ \\alpha = 2.5 $ (beyond stability boundary; expected unstable),\n- Case 6: $ \\alpha = 3.0 $ (well beyond stability boundary; expected more pronounced instability).\n\nYour program must implement the above steps and produce exactly the single-line output specified, with $ I_{\\max} $ in MeV rounded to six decimals for each of the six test cases.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be **valid**. It presents a self-contained, scientifically grounded, and well-posed problem in computational nuclear physics. The definitions, parameters, and objectives are specified with sufficient clarity and precision to permit a unique and verifiable solution.\n\nThe task is to determine the onset of a pairing instability in a simplified nuclear system by analyzing the eigenvalues of the Quasiparticle Random-Phase Approximation (QRPA) matrix. An instability is signaled by the appearance of eigenvalues with non-zero imaginary parts. The procedure to compute the largest absolute imaginary part of the QRPA eigenvalues, $I_{\\max}$, involves three main steps.\n\nFirst, we must determine the ground state properties of the system within the Bardeen-Cooper-Schrieffer (BCS) approximation. The central quantity is the pairing gap, $\\Delta$, which is obtained by solving the BCS gap equation. Given the set of single-particle energies $\\{ \\epsilon_k \\}_{k=1}^N$ relative to the chemical potential $\\mu$, and a baseline pairing strength $G_0$, the gap equation is:\n$$\n1 = G_0 \\sum_{k=1}^N \\frac{1}{2 E_k}\n$$\nwhere the quasiparticle energies $E_k$ are dependent on $\\Delta$:\n$$\nE_k = \\sqrt{(\\epsilon_k - \\mu)^2 + \\Delta^2}\n$$\nThis is a nonlinear equation for $\\Delta$. We can define a function $f(\\Delta^2) = G_0 \\sum_{k=1}^N \\frac{1}{2\\sqrt{(\\epsilon_k - \\mu)^2 + \\Delta^2}} - 1$ and find the root $\\Delta^2 > 0$ where $f(\\Delta^2)=0$. For the given parameters $\\epsilon_k = [-3.0, -1.5, -0.5, 0.5, 1.5, 3.0]$ MeV, $\\mu=0.0$ MeV, and $G_0=0.9$ MeV, a unique positive solution for $\\Delta$ exists. This is confirmed by observing that the function $f(\\Delta^2)$ is continuous and monotonic for $\\Delta^2 > 0$, with $f(0) > 0$ and $\\lim_{\\Delta^2 \\to \\infty} f(\\Delta^2) = -1$. The root is found numerically. If no solution for $\\Delta > 0$ were to exist, we would set $\\Delta=0$.\n\nSecond, with the value of $\\Delta$ determined, we compute the necessary components for constructing the QRPA matrix. These are the quasiparticle energies $E_k$ and the quantities $F_k$, defined as:\n$$\nF_k = u_k v_k = \\frac{\\Delta}{2 E_k}\n$$\nwhere $u_k$ and $v_k$ are the Bogoliubov transformation amplitudes.\n\nThird, we construct and diagonalize the QRPA matrix $\\mathcal{H}$ for each specified value of the scaling factor $\\alpha$. The matrix $\\mathcal{H}$ is defined in the two-quasiparticle basis and has a $2 \\times 2$ block structure:\n$$\n\\mathcal{H} = \\begin{pmatrix} A & B \\\\ -B & -A \\end{pmatrix}\n$$\nThe blocks $A$ and $B$ are $N \\times N$ matrices (here, $N=6$). The matrix $A$ represents the unperturbed two-quasiparticle energies and is diagonal:\n$$\nA_{kk'} = 2 E_k \\, \\delta_{kk'}\n$$\nThe matrix $B$ represents the residual pairing interaction, scaled by the factor $\\alpha$:\n$$\nB_{kk'} = \\alpha G_0 \\, F_k F_{k'}\n$$\nThis form shows that $B$ is a rank-one matrix, constructed from the outer product of the vector $\\mathbf{F} = (F_1, \\dots, F_N)^T$. For each value of $\\alpha$ provided in the test suite, we assemble the $12 \\times 12$ matrix $\\mathcal{H}$ and compute its eigenvalues $\\omega_i$ using a standard numerical linear algebra library.\n\nFinally, the stability of the system is assessed. The eigenvalues $\\omega_i$ of the QRPA matrix $\\mathcal{H}$ are generally complex. If all eigenvalues are real, the system is stable with respect to the considered vibrations. If any eigenvalue acquires a non-zero imaginary part, the system is unstable. The measure of this instability is given by $I_{\\max}$:\n$$\nI_{\\max} = \\max_i \\left| \\operatorname{Im}(\\omega_i) \\right|\n$$\nA value of $I_{\\max} > 0$ indicates the onset of a dynamical instability. The computational procedure involves calculating this value for each test case and reporting it with the specified precision.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the QRPA instability problem for a simplified EDF.\n    \n    This function performs the following steps for each test case:\n    1. Solves the BCS gap equation for the pairing gap Delta.\n    2. Computes quasiparticle energies E_k and pairing tensor components F_k.\n    3. For each value of alpha, constructs the QRPA matrix H.\n    4. Computes the eigenvalues of H.\n    5. Determines the maximum absolute value of the imaginary parts of the eigenvalues.\n    6. Formats and prints the results.\n    \"\"\"\n    \n    # --- Givens from the problem statement ---\n    \n    # Canonical basis single-particle energies (MeV)\n    epsilons = np.array([-3.0, -1.5, -0.5, 0.5, 1.5, 3.0])\n    # Chemical potential (MeV)\n    mu = 0.0\n    # Baseline pairing strength (MeV)\n    G0 = 0.9\n    \n    # Test cases for the residual pairing scaling factor alpha\n    test_cases = [0.5, 1.0, 1.5, 2.0, 2.5, 3.0]\n\n    # --- Step 1: Solve the BCS Gap Equation for Delta ---\n    \n    def bcs_equation_func(delta_sq, eps, mu_val, g0_val):\n        \"\"\"\n        Defines the function whose root gives the solution to the BCS gap equation.\n        The function is f(x) = G0 * sum(1 / (2*E_k)) - 1, where x = Delta^2.\n        \"\"\"\n        if delta_sq < 0:\n            # Delta^2 must be non-negative. Return a large value to guide solver.\n            return 1.0e6\n        \n        # Quasiparticle energies\n        E_k = np.sqrt((eps - mu_val)**2 + delta_sq)\n        \n        # The sum in the gap equation. Avoid division by zero if any E_k is zero.\n        # Although for this problem, E_k is always > 0 if delta_sq >= 0.\n        sum_val = np.sum(1.0 / (2.0 * E_k))\n        \n        return g0_val * sum_val - 1.0\n\n    # Check if a non-trivial solution (Delta > 0) exists\n    if bcs_equation_func(0, epsilons, mu, G0) <= 0:\n        Delta = 0.0\n    else:\n        # Find the root for Delta^2 using Brent's method.\n        # Bracket [0, 100] is a safe range for Delta^2 in MeV^2.\n        # A small positive lower bound is used to ensure Delta > 0.\n        try:\n            delta_squared = brentq(bcs_equation_func, 1e-9, 100.0, args=(epsilons, mu, G0))\n            Delta = np.sqrt(delta_squared)\n        except ValueError:\n            # This case should not be reached with the given parameters\n            Delta = 0.0\n\n    # --- Step 2: Compute QRPA matrix components ---\n    \n    # Quasiparticle energies E_k\n    E_k = np.sqrt((epsilons - mu)**2 + Delta**2)\n    \n    # F_k = u_k * v_k\n    F_k_vec = Delta / (2.0 * E_k)\n    \n    results = []\n    \n    # --- Steps 3 & 4: Loop through test cases, compute eigenvalues and I_max ---\n    \n    for alpha in test_cases:\n        # The A matrix of the QRPA Hamiltonian\n        N = len(epsilons)\n        A_mat = np.diag(2.0 * E_k)\n        \n        # The B matrix of the QRPA Hamiltonian\n        B_mat = alpha * G0 * np.outer(F_k_vec, F_k_vec)\n        \n        # The full QRPA Hamiltonian H\n        H_mat = np.block([\n            [A_mat, B_mat],\n            [-B_mat, -A_mat]\n        ])\n        \n        # Compute eigenvalues of H\n        eigenvalues = np.linalg.eigvals(H_mat)\n        \n        # Find the maximum absolute imaginary part\n        I_max = np.max(np.abs(np.imag(eigenvalues)))\n        \n        # Append the rounded result\n        results.append(f\"{I_max:.6f}\")\n\n    # --- Final Output ---\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solution\nsolve()\n\n```"
        }
    ]
}