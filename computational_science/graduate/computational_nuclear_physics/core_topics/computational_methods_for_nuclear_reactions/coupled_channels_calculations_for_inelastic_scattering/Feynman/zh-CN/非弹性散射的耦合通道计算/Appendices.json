{
    "hands_on_practices": [
        {
            "introduction": "在进行任何复杂的计算之前，我们必须首先确定问题的框架。本练习侧重于运用角动量和宇称守恒等基本定律，来确定在非弹性散射反应中有哪些通道被耦合在一起。掌握这一步对于正确建立耦合方程组至关重要，而这正是整个计算的基础 。",
            "id": "3553022",
            "problem": "在非弹性核散射的耦合通道 (CC) 描述中，各个通道由弹核的轨道角动量 $l$、弹核的内禀自旋 $s$、靶核自旋 $I$ 以及通过角动量耦合得到的总角动量 $J$ 来标记。考虑一个自旋为 $\\frac{1}{2}$ 的弹核从一个球形偶偶靶核上散射，该靶核的基态为 $I_{i}=0^{+}$，第一激发态为 $I_{f}=2^{+}$。假设主要的入射轨道角动量为 $l_{i}=2$。靶核的 $0^{+} \\rightarrow 2^{+}$ 非弹性激发是由相互作用中张量阶数为 $L=2$ 的四极耦合驱动的，该相互作用是转动不变且宇称守恒的。\n\n仅从以下基本原理出发：\n- 在转动不变的相互作用下，总角动量 $J$ 及其投影是守恒的。\n- 角动量根据三角形定则相加：当耦合 $j_{1}$ 和 $j_{2}$ 时，合成的角动量 $j$ 满足 $|j_{1}-j_{2}| \\leq j \\leq j_{1}+j_{2}$，并以整数步长取值。\n- 对于一个球张量阶数为 $L$ 的宇称守恒耦合，其空间部分包含宇称为 $(-1)^{L}$ 的球谐函数 $Y_{L}(\\hat{r})$，这意味着相对运动轨道角动量 $l$ 的变化遵循 $|l_{i}-L| \\leq l_{f} \\leq l_{i}+L$，并且必须满足总的宇称选择定则。\n\n在跃迁过程中 $J$ 守恒的要求下，确定由 $L=2$ 相互作用驱动的、在弹性通道 $(I_{i}=0^{+},\\, l_{i}=2,\\, s=\\frac{1}{2})$ 与非弹性通道 $(I_{f}=2^{+},\\, l_{f},\\, s=\\frac{1}{2})$ 之间产生非零非弹性耦合的总角动量 $J$ 的完整集合。使用 $\\mathrm{pmatrix}$ 环境，将最终答案表示为一个行矩阵，其中允许的 $J$ 值按升序排列。无需四舍五入。",
            "solution": "用户希望找到在一核散射反应中，在指定的初始通道和末态通道之间存在非零非弹性耦合的总角动量 $J$ 的集合。该问题是量子力学角动量耦合规则的一个良定的、有科学依据的应用，因此被认为是有效的。\n\n解决此问题的核心原理是总角动量 $J$ 守恒。如题所述，一个转动不变的相互作用使总角动量及其投影守恒。这意味着初始（弹性）通道与末态（非弹性）通道之间的非零耦合仅在总角动量 $J$ 可以由*初始*和*末态*两个通道中的组分角动量构成时才会发生。因此，我们的任务是找出初始通道所有可能的 $J$ 值集合以及所有允许的末态通道的所有可能的 $J$ 值集合，然后求这两个集合的交集。\n\n我们用 $l$ 表示弹核轨道角动量，用 $s$ 表示弹核内禀自旋，用 $I$ 表示靶核自旋。总角动量为 $\\vec{J} = \\vec{l} + \\vec{s} + \\vec{I}$。角动量根据三角形定则相加：对于 $\\vec{j} = \\vec{j}_1 + \\vec{j}_2$，其大小 $j$ 的可能取值为 $|j_1 - j_2|, |j_1 - j_2| + 1, \\dots, j_1 + j_2$。\n\n**步骤 1：确定初始（弹性）通道的可能总角动量 $J$ 的集合。**\n\n初始通道由以下量子数定义：\n- 靶核自旋：$I_{i}=0$\n- 弹核轨道角动量：$l_{i}=2$\n- 弹核自旋：$s=\\frac{1}{2}$\n\n我们需要找到由耦合 $\\vec{J} = \\vec{I}_i + \\vec{l}_i + \\vec{s}$ 产生的 $J$ 的可能值。\n由于 $I_i=0$，耦合简化为 $\\vec{J} = \\vec{l}_i + \\vec{s}$。\n对 $l_i=2$ 和 $s=\\frac{1}{2}$ 使用角动量相加的三角形定则：\n$$|l_i - s| \\leq J \\leq l_i + s$$\n$$|2 - \\frac{1}{2}| \\leq J \\leq 2 + \\frac{1}{2}$$\n$$\\frac{3}{2} \\leq J \\leq \\frac{5}{2}$$\n在此范围内的可能 $J$ 值为半整数，即 $J=\\frac{3}{2}$ 和 $J=\\frac{5}{2}$。我们将此集合表示为 $J_{\\text{initial}} = \\{\\frac{3}{2}, \\frac{5}{2}\\}$。\n\n**步骤 2：确定允许的末态通道构型。**\n\n末态（非弹性）通道由以下量子数定义：\n- 靶核自旋：$I_{f}=2$\n- 弹核自旋：$s=\\frac{1}{2}$\n- 弹核轨道角动量：$l_f$（待定）\n\n末态轨道角动量 $l_f$ 的可能值受到源于相互作用势性质的两个选择定则的约束。\n\n首先，该相互作用是张量阶数为 $L=2$ 的四极耦合。这对轨道角动量的变化施加了三角形定则：\n$$|l_i - L| \\leq l_f \\leq l_i + L$$\n代入 $l_i=2$ 和 $L=2$：\n$$|2 - 2| \\leq l_f \\leq 2 + 2$$\n$$0 \\leq l_f \\leq 4$$\n因此，$l_f$ 的可能值为 $l_f \\in \\{0, 1, 2, 3, 4\\}$。\n\n其次，该相互作用是宇称守恒的。这意味着末态的总宇称必须与初态的总宇称相同。一个通道态的宇称由 $\\Pi = \\pi_{\\text{target}} \\times (-1)^{l}$ 给出，其中 $\\pi_{\\text{target}}$ 是靶核态的内禀宇称。我们假设弹核具有一个确定的、不变的正内禀宇称。\n\n- 初态宇称：初态靶核态为 $0^{+}$，因此其宇称为正（$\\pi(I_i)=+1$）。轨道角动量为 $l_i=2$。\n$$\\Pi_i = \\pi(0^{+}) \\times (-1)^{l_i} = (+1) \\times (-1)^{2} = +1$$\n- 末态宇称：末态靶核态为 $2^{+}$，因此其宇称也为正（$\\pi(I_f)=+1$）。\n$$\\Pi_f = \\pi(2^{+}) \\times (-1)^{l_f} = (+1) \\times (-1)^{l_f} = (-1)^{l_f}$$\n\n对于宇称守恒的相互作用，我们必须有 $\\Pi_i = \\Pi_f$：\n$$+1 = (-1)^{l_f}$$\n这个方程仅当 $l_f$ 为偶数时才成立。将此条件与 $l_f \\in \\{0, 1, 2, 3, 4\\}$ 相结合，末态轨道角动量的允许值为 $l_f \\in \\{0, 2, 4\\}$。\n\n**步骤 3：确定允许的末态通道的可能总角动量 $J$ 的集合。**\n\n我们必须对每个允许的 $l_f$ 值，找出通过耦合 $\\vec{J} = \\vec{I}_f + \\vec{l}_f + \\vec{s}$ 可以形成的所有可能的 $J$ 值。\n末态通道 $J$ 值的总集合 $J_{\\text{final}}$ 将是每个 $l_f$ 生成的集合的并集。\n\n- **情况 1：$l_f=0$**\n  耦合为 $\\vec{J} = \\vec{I}_f + \\vec{s}$，其中 $I_f=2$，$s=\\frac{1}{2}$。\n  $$|2 - \\frac{1}{2}| \\leq J \\leq 2 + \\frac{1}{2} \\implies \\frac{3}{2} \\leq J \\leq \\frac{5}{2}$$\n  可能的 $J$ 值为 $J \\in \\{\\frac{3}{2}, \\frac{5}{2}\\}$。\n\n- **情况 2：$l_f=2$**\n  耦合为 $\\vec{J} = \\vec{I}_f + \\vec{l}_f + \\vec{s}$，其中 $I_f=2$，$l_f=2$，$s=\\frac{1}{2}$。方便起见，我们先耦合 $\\vec{K} = \\vec{I}_f + \\vec{l}_f$，然后再耦合 $\\vec{J} = \\vec{K} + \\vec{s}$。\n  对于 $\\vec{K} = \\vec{2} + \\vec{2}$，可能的 $K$ 值为 $K \\in \\{0, 1, 2, 3, 4\\}$。\n  现在，对每个 $K$，我们与 $s=\\frac{1}{2}$ 进行耦合：\n  - $K=0, s=\\frac{1}{2} \\implies J = \\frac{1}{2}$\n  - $K=1, s=\\frac{1}{2} \\implies J = \\{\\frac{1}{2}, \\frac{3}{2}\\}$\n  - $K=2, s=\\frac{1}{2} \\implies J = \\{\\frac{3}{2}, \\frac{5}{2}\\}$\n  - $K=3, s=\\frac{1}{2} \\implies J = \\{\\frac{5}{2}, \\frac{7}{2}\\}$\n  - $K=4, s=\\frac{1}{2} \\implies J = \\{\\frac{7}{2}, \\frac{9}{2}\\}$\n  对于 $l_f=2$ 的这些可能性的并集是 $J \\in \\{\\frac{1}{2}, \\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2}, \\frac{9}{2}\\}$。\n\n- **情况 3：$l_f=4$**\n  耦合为 $\\vec{J} = \\vec{I}_f + \\vec{l}_f + \\vec{s}$，其中 $I_f=2$，$l_f=4$，$s=\\frac{1}{2}$。同样，先耦合 $\\vec{K} = \\vec{I}_f + \\vec{l}_f$。\n  对于 $\\vec{K} = \\vec{2} + \\vec{4}$，可能的 $K$ 值为 $K \\in \\{2, 3, 4, 5, 6\\}$。\n  现在，对每个 $K$，我们与 $s=\\frac{1}{2}$ 进行耦合：\n  - $K=2, s=\\frac{1}{2} \\implies J = \\{\\frac{3}{2}, \\frac{5}{2}\\}$\n  - $K=3, s=\\frac{1}{2} \\implies J = \\{\\frac{5}{2}, \\frac{7}{2}\\}$\n  - $K=4, s=\\frac{1}{2} \\implies J = \\{\\frac{7}{2}, \\frac{9}{2}\\}$\n  - $K=5, s=\\frac{1}{2} \\implies J = \\{\\frac{9}{2}, \\frac{11}{2}\\}$\n  - $K=6, s=\\frac{1}{2} \\implies J = \\{\\frac{11}{2}, \\frac{13}{2}\\}$\n  对于 $l_f=4$ 的这些可能性的并集是 $J \\in \\{\\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2}, \\frac{9}{2}, \\frac{11}{2}, \\frac{13}{2}\\}$。\n\n末态通道所有可能的 $J$ 值的完整集合是这三种情况集合的并集：\n$$J_{\\text{final}} = \\{\\frac{3}{2}, \\frac{5}{2}\\} \\cup \\{\\frac{1}{2}, \\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2}, \\frac{9}{2}\\} \\cup \\{\\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2}, \\frac{9}{2}, \\frac{11}{2}, \\frac{13}{2}\\}$$\n$$J_{\\text{final}} = \\{\\frac{1}{2}, \\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2}, \\frac{9}{2}, \\frac{11}{2}, \\frac{13}{2}\\}$$\n\n**步骤 4：找到允许非零耦合的总角动量 $J$ 的集合。**\n\n如前所述，只有当 $J$ 的值同时存在于初始通道和末态通道构型中时，才会存在非零耦合。这对应于集合 $J_{\\text{initial}}$ 和 $J_{\\text{final}}$ 的交集。\n$$J_{\\text{allowed}} = J_{\\text{initial}} \\cap J_{\\text{final}}$$\n$$J_{\\text{allowed}} = \\{\\frac{3}{2}, \\frac{5}{2}\\} \\cap \\{\\frac{1}{2}, \\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2}, \\frac{9}{2}, \\frac{11}{2}, \\frac{13}{2}\\}$$\n公共元素是 $\\frac{3}{2}$ 和 $\\frac{5}{2}$。\n$$J_{\\text{allowed}} = \\{\\frac{3}{2}, \\frac{5}{2}\\}$$\n\n因此，在给定通道之间产生非零非弹性耦合的总角动量 $J$ 的完整集合是 $\\{\\frac{3}{2}, \\frac{5}{2}\\}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3}{2}  \\frac{5}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一旦确定了耦合通道，下一步就是量化连接它们之间相互作用的强度。本练习将指导您计算耦合矩阵元，这是耦合通道方程中势矩阵的关键组成部分。您将看到抽象的 Racah 代数和实验数据（如约化跃迁几率 $B(E2)$）如何结合在一起，为模型提供动力学输入 。",
            "id": "3553006",
            "problem": "考虑一个耦合通道非弹性散射计算，其中一个轨道角动量为 $L$ 的无自旋抛射体与一个内禀角动量（自旋）为 $I$ 的偶偶靶核发生散射。该耦合由靶上的电四极跃迁算符 $T^{(2)}$ 和作用于抛射体相对坐标方向的 Racah 归一化球谐函数 (RNSH) $C_{2\\mu}(\\hat{R}) = \\sqrt{\\frac{4\\pi}{5}}\\,Y_{2\\mu}(\\hat{R})$ 通过张量积 $[\\,T^{(2)} \\otimes C_{2}\\,]^{(0)}$ 组合成一个实验室标量而产生。\n\n假设初态通道具有 $I_{i}=0$、$L_{i}=0$ 和总角动量 $J_{i}=0$；末态通道具有 $I_{f}=2$、$L_{f}=2$ 和总角动量 $J_{f}=0$。在整个过程中，抛射体自旋为 $s=0$。指定的约化跃迁几率为 $B(E2; I_{i}=0 \\rightarrow I_{f}=2) = 625\\,e^{2}\\,\\text{fm}^{4}$。\n\n从以下基本要素出发：\n- Wigner–Eckart 定理，以其用于球张量 $T^{(k)}$ 的标准 $3j$ 符号形式表示：$\\langle J_{f} M_{f} | T^{(k)}_{q} | J_{i} M_{i} \\rangle = (-1)^{J_{f}-M_{f}} \\begin{pmatrix} J_{f}  k  J_{i} \\\\ -M_{f}  q  M_{i} \\end{pmatrix} \\langle J_{f} \\| T^{(k)} \\| J_{i} \\rangle$。\n- 约化跃迁几率 $B(E\\lambda)$ 的定义：$B(E\\lambda; J_{i} \\rightarrow J_{f}) = \\frac{1}{2J_{i}+1} \\left| \\langle J_{f} \\| \\mathcal{M}(E\\lambda) \\| J_{i} \\rangle \\right|^{2}$，此处 $\\mathcal{M}(E2) \\equiv T^{(2)}$。\n- 轨道角动量之间的 Racah 归一化球谐函数的约化矩阵元：$\\langle L_{f} \\| C_{\\lambda} \\| L_{i} \\rangle = (-1)^{L_{f}} \\sqrt{(2L_{f}+1)(2L_{i}+1)} \\begin{pmatrix} L_{f}  \\lambda  L_{i} \\\\ 0  0  0 \\end{pmatrix}$。\n- 通过 Wigner $9j$ 符号对作用于不同角动量子空间上的张量积进行重耦合：$\\langle (j_{1} j_{2}) j \\| [T^{(k_{1})}(1) \\otimes U^{(k_{2})}(2)]^{(k)} \\| (j_{1}' j_{2}') j' \\rangle = (-1)^{j_{1}+j_{2}+j'+k} \\hat{j}\\,\\hat{k} \\begin{Bmatrix} j_{1}  j_{2}  j \\\\ j_{1}'  j_{2}'  j' \\\\ k_{1}  k_{2}  k \\end{Bmatrix} \\langle j_{1} \\| T^{(k_{1})} \\| j_{1}' \\rangle \\langle j_{2} \\| U^{(k_{2})} \\| j_{2}' \\rangle$，其中 $\\hat{x} \\equiv \\sqrt{2x+1}$。\n- 等效地，对于标量（$k=0$）重耦合的特殊情况，Wigner $6j$ 符号的约化为：$\\begin{Bmatrix} L  I  J \\\\ I'  L'  0 \\end{Bmatrix} = (-1)^{L+I+J} \\frac{\\delta_{L,L'}\\,\\delta_{I,I'}}{\\sqrt{(2L+1)(2I+1)}}$。\n\n根据上述基本定律和定义，推导指定跃迁的标量耦合矩阵元的模 $\\left| \\langle J_{f}=0 \\| [\\,T^{(2)} \\otimes C_{2}\\,]^{(0)} \\| J_{i}=0 \\rangle \\right|$。清楚地展示 $3j$、$6j$ 和 $9j$ 系数如何参与重构过程。将您的最终数值结果四舍五入到四位有效数字。以 $e\\,\\text{fm}^{2}$ 为单位表示最终答案。",
            "solution": "该问题要求推导在指定的核散射初态和末态之间的标量耦合矩阵元的模 $\\left| \\langle J_{f}=0 \\| [\\,T^{(2)} \\otimes C_{2}\\,]^{(0)} \\| J_{i}=0 \\rangle \\right|$。推导过程必须基于所提供的基本公式。\n\n初态和末态是通过将靶的内禀角动量（自旋）$I$ 和抛射体的轨道角动量 $L$ 耦合到总角动量 $J$ 而形成的复合态。我们将这些态表示为 $|(IL)J\\rangle$。\n- 初态：$|J_i=0\\rangle = |(I_i L_i) J_i\\rangle = |(0,0)0\\rangle$。\n- 末态：$|J_f=0\\rangle = |(I_f L_f) J_f\\rangle = |(2,2)0\\rangle$。\n\n耦合算符是一个标量（$k=0$），由作用于靶自由度（空间1）的算符 $T^{(2)}$ 和作用于抛射体相对坐标（空间2）的算符 $C_2$ 的张量积形成。需要计算的量是该算符的约化矩阵元 (RME)，即 $\\langle J_f=0 \\| [\\,T^{(2)} \\otimes C_{2}\\,]^{(0)} \\| J_i=0 \\rangle$。\n\n我们应用所提供的公式来计算作用于耦合态的张量积算符的约化矩阵元：\n$$ \\langle (j_{1} j_{2}) j \\| [T^{(k_{1})}(1) \\otimes U^{(k_{2})}(2)]^{(k)} \\| (j_{1}' j_{2}') j' \\rangle = (-1)^{j_{1}+j_{2}+j'+k} \\hat{j}\\,\\hat{k} \\begin{Bmatrix} j_{1}  j_{2}  j \\\\ j_{1}'  j_{2}'  j' \\\\ k_{1}  k_{2}  k \\end{Bmatrix} \\langle j_{1} \\| T^{(k_{1})} \\| j_{1}' \\rangle \\langle j_{2} \\| U^{(k_{2})} \\| j_{2}' \\rangle $$\n使用简写 $\\hat{x} \\equiv \\sqrt{2x+1}$。\n\n我们根据我们的问题进行以下替换：\n- 空间 1（靶）：$j_1 \\to I_f=2$，$j_1' \\to I_i=0$。算符：$T^{(k_1)} \\to T^{(2)}$，因此 $k_1=2$。\n- 空间 2（抛射体）：$j_2 \\to L_f=2$，$j_2' \\to L_i=0$。算符：$U^{(k_2)} \\to C_2$，因此 $k_2=2$。\n- 耦合空间：$j \\to J_f=0$，$j' \\to J_i=0$。算符阶数：$k=0$。\n\n将这些值代入公式中：\n$$ \\langle (I_f L_f) J_f \\| [T^{(2)} \\otimes C_2]^{(0)} \\| (I_i L_i) J_i \\rangle = (-1)^{I_f+L_f+J_i+0} \\hat{J_f} \\hat{0} \\begin{Bmatrix} I_f  L_f  J_f \\\\ I_i  L_i  J_i \\\\ 2  2  0 \\end{Bmatrix} \\langle I_f \\| T^{(2)} \\| I_i \\rangle \\langle L_f \\| C_2 \\| L_i \\rangle $$\n$$ \\langle (2,2)0 \\| [T^{(2)} \\otimes C_2]^{(0)} \\| (0,0)0 \\rangle = (-1)^{2+2+0+0} \\hat{0} \\hat{0} \\begin{Bmatrix} 2  2  0 \\\\ 0  0  0 \\\\ 2  2  0 \\end{Bmatrix} \\langle 2 \\| T^{(2)} \\| 0 \\rangle \\langle 2 \\| C_2 \\| 0 \\rangle $$\n前置因子为 $\\hat{0} = \\sqrt{2(0)+1}=1$ 和 $(-1)^4=1$。表达式简化为：\n$$ \\langle \\dots \\rangle = \\begin{Bmatrix} 2  2  0 \\\\ 0  0  0 \\\\ 2  2  0 \\end{Bmatrix} \\langle 2 \\| T^{(2)} \\| 0 \\rangle \\langle 2 \\| C_2 \\| 0 \\rangle $$\n\n接下来，我们计算 Wigner $9j$ 符号。如果 $9j$ 符号的某一行或某一列包含零，则可以进行简化。对于 $(3,3)$ 位置为零的 $9j$ 符号，其一般约化公式为：\n$$ \\begin{Bmatrix} j_1  j_2  j_3 \\\\ j_4  j_5  j_6 \\\\ j_7  j_8  0 \\end{Bmatrix} = \\frac{(-1)^{j_2+j_4+j_3+j_7}}{\\hat{j_3}\\hat{j_7}} \\delta_{j_3,j_6} \\delta_{j_7,j_8} \\begin{Bmatrix} j_1  j_2  j_3 \\\\ j_5  j_4  j_7 \\end{Bmatrix} $$\n通过行置换（偶数次置换不改变其值），我们的符号可以变为这种形式：\n$$ \\begin{Bmatrix} 2  2  0 \\\\ 0  0  0 \\\\ 2  2  0 \\end{Bmatrix} = \\begin{Bmatrix} 2  2  0 \\\\ 2  2  0 \\\\ 0  0  0 \\end{Bmatrix} $$\n应用约化公式，其中 $j_1=2, j_2=2, j_3=0; j_4=2, j_5=2, j_6=0; j_7=0, j_8=0$：\n$$ \\begin{Bmatrix} 2  2  0 \\\\ 2  2  0 \\\\ 0  0  0 \\end{Bmatrix} = \\frac{(-1)^{2+2+0+0}}{\\hat{0}\\hat{0}} \\delta_{0,0} \\delta_{0,0} \\begin{Bmatrix} 2  2  0 \\\\ 2  2  0 \\end{Bmatrix} = \\begin{Bmatrix} 2  2  0 \\\\ 2  2  0 \\end{Bmatrix} $$\n现在我们使用包含零元项的 $6j$ 符号的一般公式来计算得到的 Wigner $6j$ 符号：\n$$ \\begin{Bmatrix} j_1  j_2  j_3 \\\\ l_1  l_2  0 \\end{Bmatrix} = (-1)^{j_1+l_2+j_3} \\frac{\\delta_{j_2,l_1} \\delta_{j_1,l_2}}{\\sqrt{(2j_1+1)(2j_2+1)}} $$\n当 $j_1=2, j_2=2, j_3=0; l_1=2, l_2=2$ 时，我们有：\n$$ \\begin{Bmatrix} 2  2  0 \\\\ 2  2  0 \\end{Bmatrix} = (-1)^{2+2+0} \\frac{\\delta_{2,2} \\delta_{2,2}}{\\sqrt{(2(2)+1)(2(2)+1)}} = \\frac{1}{\\sqrt{5}\\sqrt{5}} = \\frac{1}{5} $$\n因此，$9j$ 符号的计算结果为 $\\frac{1}{5}$。该约化矩阵元为：\n$$ \\langle \\dots \\rangle = \\frac{1}{5} \\langle I_f=2 \\| T^{(2)} \\| I_i=0 \\rangle \\langle L_f=2 \\| C_2 \\| L_i=0 \\rangle $$\n\n现在，我们必须确定两个未耦合的约化矩阵元。\n\n1.  **靶约化矩阵元：** $\\langle I_f=2 \\| T^{(2)} \\| I_i=0 \\rangle$。\n    我们已知约化跃迁几率 $B(E2; I_{i}=0 \\rightarrow I_{f}=2) = 625\\,e^{2}\\,\\text{fm}^{4}$ 及其定义：\n    $$ B(E\\lambda; J_i \\to J_f) = \\frac{1}{2J_i+1} |\\langle J_f \\| \\mathcal{M}(E\\lambda) \\| J_i \\rangle|^2 $$\n    根据 $\\mathcal{M}(E2) \\equiv T^{(2)}$，并代入靶自旋 $J_i \\to I_i=0$ 和 $J_f \\to I_f=2$：\n    $$ B(E2; 0 \\to 2) = \\frac{1}{2(0)+1} |\\langle 2 \\| T^{(2)} \\| 0 \\rangle|^2 = |\\langle 2 \\| T^{(2)} \\| 0 \\rangle|^2 $$\n    $$ 625\\,e^2\\,\\text{fm}^4 = |\\langle 2 \\| T^{(2)} \\| 0 \\rangle|^2 $$\n    取平方根得到约化矩阵元的模：\n    $$ |\\langle I_f=2 \\| T^{(2)} \\| I_i=0 \\rangle| = \\sqrt{625\\,e^2\\,\\text{fm}^4} = 25\\,e\\,\\text{fm}^2 $$\n\n2.  **抛射体约化矩阵元：** $\\langle L_f=2 \\| C_2 \\| L_i=0 \\rangle$。\n    我们使用所提供的 Racah 归一化球谐函数的约化矩阵元公式：\n    $$ \\langle L_f \\| C_{\\lambda} \\| L_i \\rangle = (-1)^{L_f} \\sqrt{(2L_f+1)(2L_i+1)} \\begin{pmatrix} L_f  \\lambda  L_i \\\\ 0  0  0 \\end{pmatrix} $$\n    代入 $L_f=2$、$L_i=0$ 和 $\\lambda=2$：\n    $$ \\langle 2 \\| C_2 \\| 0 \\rangle = (-1)^{2} \\sqrt{(2(2)+1)(2(0)+1)} \\begin{pmatrix} 2  2  0 \\\\ 0  0  0 \\end{pmatrix} = \\sqrt{5} \\begin{pmatrix} 2  2  0 \\\\ 0  0  0 \\end{pmatrix} $$\n    对于这种结构，Wigner $3j$ 符号有一个通用的值：\n    $$ \\begin{pmatrix} j  j  0 \\\\ 0  0  0 \\end{pmatrix} = (-1)^j \\frac{1}{\\sqrt{2j+1}} $$\n    对于 $j=2$：\n    $$ \\begin{pmatrix} 2  2  0 \\\\ 0  0  0 \\end{pmatrix} = (-1)^2 \\frac{1}{\\sqrt{2(2)+1}} = \\frac{1}{\\sqrt{5}} $$\n    将此结果代回约化矩阵元的表达式中：\n    $$ \\langle L_f=2 \\| C_2 \\| L_i=0 \\rangle = \\sqrt{5} \\times \\frac{1}{\\sqrt{5}} = 1 $$\n\n最后，我们将各部分组合起来，以求得总标量耦合矩阵元的模：\n$$ \\left| \\langle J_f=0 \\| [\\,T^{(2)} \\otimes C_{2}\\,]^{(0)} \\| J_i=0 \\rangle \\right| = \\left| \\frac{1}{5} \\times (\\pm 25\\,e\\,\\text{fm}^2) \\times 1 \\right| $$\n靶约化矩阵元的相位是一个约定问题，但其模是固定的。\n$$ \\left| \\langle \\dots \\rangle \\right| = \\frac{1}{5} \\times 25\\,e\\,\\text{fm}^2 = 5\\,e\\,\\text{fm}^2 $$\n问题要求将结果四舍五入到四位有效数字。\n$$ 5.000\\,e\\,\\text{fm}^2 $$\n该推导过程明确展示了 $9j$ 符号在初始重耦合中的作用、$6j$ 符号在其计算中的作用，以及 $3j$ 符号在计算抛射体约化矩阵元中的作用。",
            "answer": "$$\\boxed{5.000}$$"
        },
        {
            "introduction": "在理论框架搭建完成后，这最后一个练习将带您从纸笔计算转向键盘编程，挑战您为一个双通道散射问题实现数值求解器。通过编写代码计算相移和 S 矩阵，您将直接体验计算散射理论的核心，并比较不同数值方法的准确性。这个练习弥合了理论形式与实用高性能科学计算之间的鸿沟 。",
            "id": "3552990",
            "problem": "考虑在s波部分中的径向耦合通道非弹性散射，该散射由一个双通道径向Schrödinger方程在单位制 $\\hbar^2/(2\\mu)=1$ 下建模。通道矢量 $u(r) = \\begin{pmatrix} u_1(r) \\\\ u_2(r) \\end{pmatrix}$ 的耦合方程为\n$$\n- \\frac{d^2}{dr^2} u(r) + V(r)\\,u(r) = k^2\\,u(r),\n$$\n其中能量参数 $k$ 满足 $k > 0$。设矩阵势为一个半径为 $a > 0$ 的方势阱，\n$$\nV(r) = \\begin{cases}\nV_0\\,\\mathbb{I} + w\\,\\sigma_x,   0 \\le r  a,\\\\\n0,   r \\ge a,\n\\end{cases}\n$$\n其中 $\\sigma_x = \\begin{pmatrix}0  1\\\\ 1  0\\end{pmatrix}$，$\\mathbb{I}$ 是单位矩阵，$V_0$ 是一个实常数（阱深，可以为负），$w$ 是一个实常数（耦合强度）。在使 $\\sigma_x$ 对角化的对角基中，系统在势阱内解耦为两个标量s波方程\n$$\n- \\frac{d^2}{dr^2} u_{\\pm}(r) + V_{\\pm}\\,u_{\\pm}(r) = k^2\\,u_{\\pm}(r), \\quad V_{\\pm} = V_0 \\pm w,\n$$\n在原点处具有正则边界条件，即 $u_{\\pm}(0) = 0$ 和 $u_{\\pm}'(0) = 1$（这是一个方便的归一化，固定了正则解的尺度）。在势阱外，对于 $r \\ge a$，势为零，每个通道都遵循自由s波方程。对于每个解耦的通道，定义 $q_{\\pm}^2 = k^2 - V_{\\pm}$，并取 $q_{\\pm} > 0$（内部散射）。\n\n推导的基本依据：\n- 径向s波Schrödinger方程及其在原点处的边界条件（$u(0)=0$；正则解在 $r=0$ 附近的行为类似 $u(r)\\sim r$）。\n- 对于 $r \\ge a$（其中 $V(r)=0$），外部s波解是自由解的线性组合，通过在 $r=a$ 处使用对数导数 $L(a) = u'(a)/u(a)$ 匹配内部解，可以从中提取相移 $\\delta$。\n- 两个通道的散射矩阵（也称为散射算符）$S$ 是幺正的，并且在使内部耦合对角化的基中，等于 $\\mathrm{diag}(e^{2 i \\delta_+}, e^{2 i \\delta_-})$；通过使势阱内 $V(r)$ 对角化的正交矩阵 $U$ 变换回原始通道基，会产生表示非弹性散射振幅的非对角元。\n\n任务：\n1. 从以上出发，推导单个s波通道在能量 $k$ 下的相移公式（用内部对数导数表示）：具体来说，对于 $r=a$，将 $\\delta$ 表示为 $k$、$a$ 和 $L(a)=u'(a)/u(a)$ 的函数。所有角度必须以弧度为单位。\n2. 实现两种数值离散化方法来计算具有恒定内部势 $V_{\\pm}$ 的解耦标量方程的 $L_{\\pm}(a)$：\n   - 在 $[0,a]$ 上使用谱元配置法，该方法在Chebyshev-Gauss-Lobatto节点上使用分段Lagrange多项式。将 $[0,a]$ 划分为 $M$ 个等大单元。在每个单元上，使用多项式阶数 $p$ 和Chebyshev-Gauss-Lobatto节点，并通过平均界面节点的贡献来组装具有 $C^0$ 连续性的全局一阶和二阶导数算子。通过替换全局代数系统中的两行来施加边界条件 $u(0)=0$ 和 $u'(0)=1$。求解配置系统得到 $u(r)$，并使用组装好的全局一阶导数算子估计在 $r=a$ 处的对数导数。\n   - 在具有 $N_{\\text{steps}}$ 个步长、步距为 $h=a/N_{\\text{steps}}$ 的均匀网格上使用有限差分推进格式，该格式使用从离散化方程 $u''(r) + q^2 u(r)=0$ 推导出的二阶递推关系以及与 $u'(0)=1$ 一致的初始条件 $u(0)=0$ 和 $u(h)\\approx h$。使用二阶单侧导数公式估计 $u'(a)$ 并计算 $L(a)$。\n3. 根据两个相移 $\\delta_{\\pm}$，在内部耦合为 $V_0\\,\\mathbb{I}+w\\,\\sigma_x$ 的原始通道基中构建 $2\\times 2$ 散射矩阵。使用使 $\\sigma_x$ 对角化的幺正正交矩阵 $U$ 将 $\\mathrm{diag}(e^{2 i \\delta_+}, e^{2 i \\delta_-})$ 变换回原始基。提取非对角元 $\\lvert S_{12} \\rvert$ 的模，作为非弹性混合的度量。\n4. 对于下面的每个测试用例，通过与精确求解恒定势内部方程得到的精确解析参考值进行比较，计算两种方法中 $\\lvert S_{12} \\rvert$ 的绝对误差。然后计算比率 $\\text{error}_{\\text{SE}}/\\text{error}_{\\text{FD}}$，其中 $\\text{SE}$ 表示谱元法，$\\text{FD}$ 表示有限差分法。最终输出是无量纲浮点数。\n\n相移提取规则：\n- 设 $u(r)$ 是直到 $r=a$ 的内部正则解，并设 $L(a)=u'(a)/u(a)$。相同能量下的外部自由s波解等效于一个带有相移的正弦函数。推导并使用关系式 $\\delta = \\arctan\\!\\left(\\frac{k}{L(a)}\\right) - k\\,a$。\n\n用于验证的精确参考：\n- 对于恒定的内部 $q0$，具有 $u(0)=0$, $u'(0)=1$ 的精确内部正则解是 $u(r) = \\frac{1}{q}\\sin(q r)$。因此，$L_{\\text{exact}}(a) = \\frac{u'(a)}{u(a)} = q\\,\\cot(q a)$，精确相移为 $\\delta_{\\text{exact}} = \\arctan\\!\\left(\\frac{k}{q\\,\\cot(q a)}\\right) - k\\,a$。\n\n构建耦合通道散射矩阵：\n- 使用正交矩阵 $U = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1  1\\\\ 1  -1\\end{pmatrix}$，从而在原始基中 $S = U \\,\\mathrm{diag}(e^{2 i \\delta_+}, e^{2 i \\delta_-})\\, U^{\\top}$。\n\n测试套件和要求的输出：\n- 使用以下科学上一致的测试用例，所有角度均以弧度为单位，除上述无量纲系统外，不需要其他物理单位。每个测试用例是一个元组 $(a, k, V_0, w, M, p, N_{\\text{steps}})$：\n  1. $(2.0, 2.0, -5.0, 1.0, 4, 6, 20)$\n  2. $(2.0, 2.0, -5.0, 1.0, 1, 3, 2)$\n  3. $(2.0, 2.0, -5.0, 1.0, 8, 8, 56)$\n  4. $(1.5, 2.0, -1.0, 0.615, 4, 6, 20)$\n- 对于每个用例，计算 $\\lvert S_{12} \\rvert$ 的比率 $\\text{error}_{\\text{SE}}/\\text{error}_{\\text{FD}}$，其中误差是通过解析内部解获得的精确 $\\lvert S_{12} \\rvert$ 与计算值之间的绝对差。最终输出必须是单行，包含一个用方括号括起来的这四个比率的逗号分隔列表，例如 $[r_1,r_2,r_3,r_4]$。\n\n你的程序必须是一个完整的、可运行的Python脚本，它实现所述的谱元配置法（使用Chebyshev-Gauss-Lobatto节点和通过平均界面节点贡献进行 $C^0$ 连续性的全局组装）和有限差分推进格式，从计算出的相移构建耦合通道散射矩阵，评估精确参考值，并以上述指定的确切格式打印测试套件的最终比率。所有角度必须以弧度处理，所有输出均为无量纲浮点数。",
            "solution": "该问题要求计算一个由径向Schrödinger方程和方势阱势描述的双通道系统的非弹性散射矩阵元 $\\lvert S_{12} \\rvert$。计算需要使用两种不同的数值方法——有限差分（FD）法和谱元（SE）法——并将结果与精确解析解进行比较，以确定它们绝对误差的比率。\n\n双通道波函数矢量 $u(r) = \\begin{pmatrix} u_1(r) \\\\ u_2(r) \\end{pmatrix}$ 的主导方程是：\n$$\n- \\frac{d^2}{dr^2} u(r) + V(r)\\,u(r) = k^2\\,u(r)\n$$\n势 $V(r)$ 是一个定义在 $r \\in [0, \\infty)$ 上的矩阵势。在半径 $a$ 内部，当 $0 \\le r  a$ 时，势为 $V(r) = V_0\\,\\mathbb{I} + w\\,\\sigma_x$，在其他地方为零。矩阵 $\\sigma_x = \\begin{pmatrix}0  1\\\\ 1  0\\end{pmatrix}$ 耦合了这两个通道。通过使用正交矩阵 $U = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1  1\\\\ 1  -1\\end{pmatrix}$ 变换到使 $\\sigma_x$ 对角化的基，系统解耦为两个关于本征波函数 $u_{\\pm}(r)$ 的独立标量Schrödinger方程：\n$$\n- \\frac{d^2}{dr^2} u_{\\pm}(r) + V_{\\pm}\\,u_{\\pm}(r) = k^2\\,u_{\\pm}(r), \\quad\\text{对于 } 0 \\le r  a\n$$\n相应的标量势是势矩阵的本征值，$V_{\\pm} = V_0 \\pm w$。问题指定了散射态，因此我们定义一个内部波数 $q_{\\pm} = \\sqrt{k^2 - V_{\\pm}}$，它是实数且为正。当 $r  a$ 时，方程变为：\n$$\n\\frac{d^2}{dr^2} u_{\\pm}(r) + q_{\\pm}^2 u_{\\pm}(r) = 0\n$$\n解在原点处必须是正则的，对于s波（$l=0$）情况，这意味着 $u_{\\pm}(0)=0$。问题指定了归一化条件 $u_{\\pm}'(0)=1$。\n\n求解过程包含几个步骤：计算每个通道的对数导数 $L_{\\pm}(a) = u_{\\pm}'(a)/u_{\\pm}(a)$，提取相移 $\\delta_{\\pm}$，构建散射矩阵 $S$，最后计算所需的误差比率。\n\n### 第1步：相移和散射矩阵\n对于每个解耦的通道（$\\pm$），当 $r \\ge a$ 时，解是一个自由球面波，$u_{\\text{ext}}(r) \\propto \\sin(kr + \\delta)$。相移 $\\delta$ 是通过在边界 $r=a$ 处利用对数导数匹配内部解和外部解来确定的。如问题中所给，相移 $\\delta$ 可以通过匹配半径 $a$ 处的对数导数 $L(a)$ 使用以下公式计算：\n$$\n\\delta = \\arctan\\left(\\frac{k}{L(a)}\\right) - k\\,a\n$$\n一旦找到两个相移 $\\delta_+$ 和 $\\delta_-$，对角基中的散射矩阵为 $S_{\\text{diag}} = \\mathrm{diag}(e^{2i\\delta_+}, e^{2i\\delta_-})$。我们使用矩阵 $U$ 将其变换回原始通道基：\n$$\nS = U S_{\\text{diag}} U^{\\top} = \\frac{1}{2}\\begin{pmatrix}1  1\\\\ 1  -1\\end{pmatrix} \\begin{pmatrix}e^{2i\\delta_+}  0\\\\ 0  e^{2i\\delta_-}\\end{pmatrix} \\begin{pmatrix}1  1\\\\ 1  -1\\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix}e^{2i\\delta_+} + e^{2i\\delta_-}  e^{2i\\delta_+} - e^{2i\\delta_-}\\\\ e^{2i\\delta_+} - e^{2i\\delta_-}  e^{2i\\delta_+} + e^{2i\\delta_-}\\end{pmatrix}\n$$\n非对角元 $S_{12}$ 代表非弹性散射振幅。其模为：\n$$\n\\lvert S_{12} \\rvert = \\left\\lvert \\frac{e^{2i\\delta_+} - e^{2i\\delta_-}}{2} \\right\\rvert = \\lvert \\sin(\\delta_+ - \\delta_-) \\rvert\n$$\n这个简化公式将用于所有 $\\lvert S_{12} \\rvert$ 的计算。\n\n### 第2步：精确解析解（参考）\n对于恒定势 $V_{\\pm}$，方程 $u_{\\pm}''(r) + q_{\\pm}^2 u_{\\pm}(r) = 0$ 在边界条件 $u_{\\pm}(0)=0$ 和 $u_{\\pm}'(0)=1$ 下的精确解为：\n$$\nu_{\\pm}(r) = \\frac{1}{q_{\\pm}}\\sin(q_{\\pm} r)\n$$\n相应的一阶导数为 $u_{\\pm}'(r) = \\cos(q_{\\pm} r)$。在 $r=a$ 处的精确对数导数为：\n$$\nL_{\\text{exact},\\pm}(a) = \\frac{u_{\\pm}'(a)}{u_{\\pm}(a)} = q_{\\pm}\\cot(q_{\\pm} a)\n$$\n利用这个，我们计算精确相移 $\\delta_{\\text{exact},\\pm}$ 和精确值 $\\lvert S_{12, \\text{exact}} \\rvert = \\lvert\\sin(\\delta_{\\text{exact},+} - \\delta_{\\text{exact},-})\\rvert$。\n\n### 第3步：有限差分法（FD）\n有限差分法在均匀网格 $r_i = i \\cdot h$（其中 $i=0, \\dots, N_{\\text{steps}}$，$h=a/N_{\\text{steps}}$）上求解 $u''(r) = -q^2 u(r)$。我们对二阶导数使用二阶中心差分近似：\n$$\n\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} = -q^2 u_i\n$$\n这得出了推进递推关系：\n$$\nu_{i+1} = (2 - (qh)^2)u_i - u_{i-1}\n$$\n初始条件设置为 $u_0 = u(0) = 0$ 和 $u_1 = u(h) \\approx h u'(0) = h$。对于 $i=1, \\dots, N_{\\text{steps}}-1$ 应用该递推关系，以找到直到 $u_{N_{\\text{steps}}}=u(a)$ 的解。\n在 $r=a$ 处的导数使用单侧二阶有限差分公式估计：\n$$\nu'(a) = u'(r_{N_{\\text{steps}}}) \\approx \\frac{3u_{N_{\\text{steps}}} - 4u_{N_{\\text{steps}}-1} + u_{N_{\\text{steps}}-2}}{2h}\n$$\n从 $u(a)$ 和 $u'(a)$，我们计算 $L_{\\text{FD}}(a)$，并随后计算 $\\delta_{\\text{FD}}$ 和 $\\lvert S_{12, \\text{FD}} \\rvert$。\n\n### 第4步：谱元法（SE）\n谱元法提供了一个高阶近似。区域 $[0, a]$ 被划分为 $M$ 个单元，每个单元的大小为 $h_{\\text{el}} = a/M$。在每个单元 $[z_m, z_{m+1}]$ 内，解由一组Chebyshev-Gauss-Lobatto (CGL) 节点上的 $p$ 阶多项式来近似。\n参考区间 $\\xi \\in [-1, 1]$ 上的CGL节点为 $\\xi_j = \\cos(j\\pi/p)$，其中 $j=0, \\dots, p$。这些节点被映射到每个物理单元。唯一的全局节点总数为 $N_{\\text{glob}} = M \\cdot p + 1$。\n\n该方法的核心是构建作用于全局节点上函数值向量的全局微分矩阵 $\\mathbf{D}^{(1)}$ 和 $\\mathbf{D}^{(2)}$。这些矩阵由单元级微分矩阵组装而成。对于一个参考单元，计算标准的Chebyshev微分矩阵 $\\mathbf{D}_{\\text{cheb}}$。对于一个物理单元，该矩阵通过变换的雅可比行列式进行缩放：$\\mathbf{D}_{\\text{el}}^{(1)} = (2/h_{\\text{el}})\\mathbf{D}_{\\text{cheb}}$ 和 $\\mathbf{D}_{\\text{el}}^{(2)} = (2/h_{\\text{el}})^2\\mathbf{D}_{\\text{cheb}}^2$。\n\n全局矩阵通过对每个单元的贡献求和来组装（直接刚度求和）。按规定，通过平均界面节点的贡献来施加 $C^0$ 连续性。这是通过将所有单元矩阵的贡献加到全局矩阵中，然后将对应于界面节点（由两个单元共享的节点）的行除以 $2$ 来实现的。\n\n微分方程 $-u'' - q^2 u = 0$ 被转换为一个全局代数系统：\n$$\n(-\\mathbf{D}^{(2)} - q^2\\mathbf{I})\\mathbf{u} = \\mathbf{0}\n$$\n其中 $\\mathbf{u}$ 是全局节点处未知函数值的向量。该系统被修改以包含边界条件：\n1. $u(0)=0$：第一个方程（第 $0$ 行）被替换为 $u_0 = 0$。\n2. $u'(0)=1$：第二个方程（第 $1$ 行）被替换为导数条件，$\\sum_j \\mathbf{D}^{(1)}_{0j} u_j = 1$。\n\n求解得到的线性系统 $\\mathbf{A}\\mathbf{u} = \\mathbf{b}$ 以得到 $\\mathbf{u}$。然后使用解向量和全局一阶导数算子计算对数导数：\n$$\nL_{\\text{SE}}(a) = \\frac{u'(a)}{u(a)} = \\frac{(\\mathbf{D}^{(1)}\\mathbf{u})_{N_{\\text{glob}}-1}}{u_{N_{\\text{glob}}-1}}\n$$\n由此，我们计算 $\\delta_{\\text{SE}}$ 和 $\\lvert S_{12, \\text{SE}} \\rvert$。\n\n### 第5步：最终计算\n对于每个测试用例，我们计算物理参数 $q_{\\pm}$，然后使用精确法、FD法和SE法计算 $\\lvert S_{12} \\rvert$。计算绝对误差：\n$$\n\\text{error}_{\\text{SE}} = \\lvert \\lvert S_{12, \\text{SE}} \\rvert - \\lvert S_{12, \\text{exact}} \\rvert \\rvert\n$$\n$$\n\\text{error}_{\\text{FD}} = \\lvert \\lvert S_{12, \\text{FD}} \\rvert - \\lvert S_{12, \\text{exact}} \\rvert \\rvert\n$$\n最后，计算所需的比率 $\\text{error}_{\\text{SE}} / \\text{error}_{\\text{FD}}$。",
            "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef chebyshev_diff_matrices(p):\n    \"\"\"\n    Computes the Chebyshev differentiation matrices D1 and D2 on CGL nodes.\n    \n    Args:\n        p (int): Polynomial degree.\n        \n    Returns:\n        tuple: (D1, D2, nodes) where D1 is the first-derivative matrix,\n               D2 is the second-derivative matrix, and nodes are the CGL nodes.\n    \"\"\"\n    if p == 0:\n        return np.array([[0.]]), np.array([[0.]]), np.array([0.])\n    \n    nodes = np.cos(np.pi * np.arange(p + 1) / p)\n    D1 = np.zeros((p + 1, p + 1))\n    c = np.ones(p + 1)\n    c[0] = 2.\n    c[p] = 2.\n    \n    for i in range(p + 1):\n        for j in range(p + 1):\n            if i == j:\n                if i == 0:\n                    D1[i, j] = (2 * p**2 + 1) / 6.\n                elif i == p:\n                    D1[i, j] = -(2 * p**2 + 1) / 6.\n                else:\n                    D1[i, j] = -nodes[j] / (2 * (1 - nodes[j]**2))\n            else:\n                D1[i, j] = (c[i] / c[j]) * ((-1)**(i + j)) / (nodes[i] - nodes[j])\n                \n    D2 = np.dot(D1, D1)\n    return D1, D2, nodes\n\ndef get_phase_shift(k, a, L):\n    \"\"\"\n    Calculates the phase shift from the logarithmic derivative.\n    delta = arctan(k/L(a)) - k*a\n    \"\"\"\n    # handle k/L singularity\n    if np.isclose(L, 0):\n        # Taking principal value_ assuming k > 0\n        return (np.pi / 2) * np.sign(k) - k * a\n    return np.arctan(k / L) - k * a\n\ndef calculate_s12_mag(delta_plus, delta_minus):\n    \"\"\"\n    Calculates the magnitude of the off-diagonal S-matrix element.\n    |S12| = |sin(delta_plus - delta_minus)|\n    \"\"\"\n    return np.abs(np.sin(delta_plus - delta_minus))\n\ndef solve_channel(params, M, p, N_steps):\n    \"\"\"\n    Solves for one channel using all three methods: Exact, FD, SE.\n    \"\"\"\n    q, k, a = params['q'], params['k'], params['a']\n    \n    # 1. Exact Analytical Method\n    qa = q * a\n    if np.isclose(np.sin(qa), 0):\n        L_exact = 1e30  # Effectively infinite for u(a)=0\n    else:\n        L_exact = q * np.cos(qa) / np.sin(qa)\n    delta_exact = get_phase_shift(k, a, L_exact)\n\n    # 2. Finite-Difference Method\n    h = a / N_steps\n    u_fd = np.zeros(N_steps + 1)\n    if N_steps > 0:\n        u_fd[1] = h  # u(h) approx h*u'(0)\n    \n    if N_steps > 1:\n        C = 2.0 - (q * h)**2\n        for i in range(1, N_steps):\n            u_fd[i+1] = C * u_fd[i] - u_fd[i-1]\n    \n        u_prime_a = (3 * u_fd[N_steps] - 4 * u_fd[N_steps-1] + u_fd[N_steps-2]) / (2 * h)\n        \n        if np.isclose(u_fd[N_steps], 0):\n            L_fd = 1e30\n        else:\n            L_fd = u_prime_a / u_fd[N_steps]\n    else: # Cannot use 3-point formula, result will be poor.\n        L_fd = np.nan\n\n    delta_fd = get_phase_shift(k, a, L_fd) if not np.isnan(L_fd) else np.nan\n\n    # 3. Spectral Element Method\n    D_cheb, D2_cheb, _ = chebyshev_diff_matrices(p)\n    \n    N_glob = M * p + 1\n    D1_glob = np.zeros((N_glob, N_glob))\n    D2_glob = np.zeros((N_glob, N_glob))\n    h_elem = a / M\n    \n    # Assembly via direct stiffness summation\n    for m in range(M):\n        D1_elem = (2 / h_elem) * D_cheb\n        D2_elem = (2 / h_elem)**2 * D2_cheb\n        g_idx = np.arange(m*p, m*p + p + 1)\n        D1_glob[np.ix_(g_idx, g_idx)] += D1_elem\n        D2_glob[np.ix_(g_idx, g_idx)] += D2_elem\n    \n    # Average contributions at element interfaces\n    for m in range(1, M):\n        interface_idx = m * p\n        D1_glob[interface_idx, :] /= 2.0\n        D2_glob[interface_idx, :] /= 2.0\n    \n    A = -D2_glob - (q**2) * np.identity(N_glob)\n    b = np.zeros(N_glob)\n    \n    # Enforce boundary conditions u(0)=0, u'(0)=1\n    A[0, :] = 0.0\n    A[0, 0] = 1.0\n    b[0] = 0.0\n    \n    # Replace eq at node 1 with u'(0)=1. D1_glob[0,:] is the operator for u'(0).\n    A[1, :] = D1_glob[0, :]\n    b[1] = 1.0\n    \n    try:\n        u_se = linalg.solve(A, b, assume_a='gen')\n        u_a = u_se[-1]\n        u_prime_a = D1_glob[-1, :] @ u_se\n        \n        if np.isclose(u_a, 0):\n            L_se = 1e30\n        else:\n            L_se = u_prime_a / u_a\n        \n        delta_se = get_phase_shift(k, a, L_se)\n    except linalg.LinAlgError:\n        delta_se = np.nan\n\n    return delta_exact, delta_fd, delta_se\n\ndef run_case(a, k, V0, w, M, p, N_steps):\n    \"\"\"\n    Runs a single test case and computes the error ratio.\n    \"\"\"\n    V_plus = V0 + w\n    V_minus = V0 - w\n    q_plus_sq = k**2 - V_plus\n    q_minus_sq = k**2 - V_minus\n\n    if q_plus_sq = 0 or q_minus_sq = 0:\n        return np.nan\n\n    q_plus = np.sqrt(q_plus_sq)\n    q_minus = np.sqrt(q_minus_sq)\n\n    params_plus = {'q': q_plus, 'k': k, 'a': a}\n    params_minus = {'q': q_minus, 'k': k, 'a': a}\n    \n    delta_exact_p, delta_fd_p, delta_se_p = solve_channel(params_plus, M, p, N_steps)\n    delta_exact_m, delta_fd_m, delta_se_m = solve_channel(params_minus, M, p, N_steps)\n    \n    # Check for failures in numerical methods\n    if any(np.isnan([delta_fd_p, delta_se_p, delta_fd_m, delta_se_m])):\n        return np.nan\n\n    S12_exact = calculate_s12_mag(delta_exact_p, delta_exact_m)\n    S12_fd = calculate_s12_mag(delta_fd_p, delta_fd_m)\n    S12_se = calculate_s12_mag(delta_se_p, delta_se_m)\n    \n    error_fd = np.abs(S12_fd - S12_exact)\n    error_se = np.abs(S12_se - S12_exact)\n    \n    if np.isclose(error_fd, 0):\n        return np.inf if not np.isclose(error_se, 0) else 1.0\n    \n    return error_se / error_fd\n\ndef solve():\n    \"\"\"\n    Main function to run test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (a, k, V0, w, M, p, N_steps)\n        (2.0, 2.0, -5.0, 1.0, 4, 6, 20),\n        (2.0, 2.0, -5.0, 1.0, 1, 3, 2),\n        (2.0, 2.0, -5.0, 1.0, 8, 8, 56),\n        (1.5, 2.0, -1.0, 0.615, 4, 6, 20)\n    ]\n\n    results = []\n    for case in test_cases:\n        ratio = run_case(*case)\n        results.append(str(ratio))\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}