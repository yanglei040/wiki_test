{
    "hands_on_practices": [
        {
            "introduction": "理解探测器性能的第一步是建立一个详尽的物理模型。我们将以环形成像切伦科夫（RICH）探测器为例，从基本物理原理出发，即描述切伦科夫辐射的Frank–Tamm公式。这项练习展示了如何将基本物理原理与探测器特有的效应（如几何结构、材料特性、传感器效率）相结合，以预测关键性能指标，包括探测到的光子数 $N_{\\gamma}$ 和最终的角度分辨率 $\\sigma_{\\theta}$。这是为粒子鉴别（PID）创建精确似然函数的基础。",
            "id": "3526738",
            "problem": "在一个用于粒子鉴别的环形成像切伦科夫（RICH）探测器中，考虑一个速度参数 $\\beta \\approx 1$ 的超相对论性带电粒子，穿过一个长度为 $L$、折射率为 $n$ 的气体辐射体，该折射率在感兴趣的光学波段内近似恒定。单位路径长度、单位波长的切伦科夫光子微分产额由 Frank–Tamm 公式给出，在波长域中可认为其与 $1/\\lambda^{2}$ 成正比，并取决于折射率和 $\\beta$。辐射体表现出体吸收效应，其特征为一个与波长无关的吸收长度 $\\Lambda$。因此，在辐射体内深度 $x$ 处产生的光子必须穿过剩余的路径 $L-x$，并根据指数吸收规律被衰减。光子穿过一个透射率为 $T_{\\mathrm{w}}$ 的窗口，然后被成像到一个几何接收度为 $A_{\\mathrm{g}}$、量子效率 $\\mathrm{QE}(\\lambda)$ 与波长相关的光电探测器上。\n\n假设：\n- 辐射体长度 $L = 1.2\\,\\mathrm{m}$，\n- 折射率 $n = 1.0014$（在光学波段内为常数），\n- 吸收长度 $\\Lambda = 12\\,\\mathrm{m}$（与波长无关），\n- 窗口透射率 $T_{\\mathrm{w}} = 0.92$（与波长无关），\n- 几何接收度 $A_{\\mathrm{g}} = 0.28$（与波长无关），\n- 光学带宽 $\\lambda \\in [\\lambda_{1},\\lambda_{2}]$，其中 $\\lambda_{1} = 3.0 \\times 10^{-7}\\,\\mathrm{m}$ 且 $\\lambda_{2} = 6.0 \\times 10^{-7}\\,\\mathrm{m}$，\n- 光电探测器量子效率建模为线性函数 $\\mathrm{QE}(\\lambda) = a + b\\,\\lambda$，其中 $\\mathrm{QE}(\\lambda_{1}) = 0.20$ 且 $\\mathrm{QE}(\\lambda_{2}) = 0.35$，\n- 精细结构常数 $\\alpha = 1/137.036$，\n- 单光子切伦科夫角测量不确定度 $\\sigma_{\\text{single}} = 7.5 \\times 10^{-3}\\,\\mathrm{rad}$，主要由色散和成像粒度决定，在本计算中假设其与 $\\lambda$ 无关。\n\n任务：\n1. 从 Frank–Tamm 谱产额和辐射体中的指数衰减出发，推导在整个辐射体长度 $L$ 上探测到的切伦科夫光子期望数 $N_{\\gamma}$ 的表达式，其中需恰当考虑沿路径的产生、在剩余距离上的衰减、窗口透射率、几何接收度以及与波长相关的量子效率。\n2. 使用独立测量的统计估计第一性原理，将每条径迹的切伦科夫角分辨率 $\\sigma_{\\theta}$ 与单光子分辨率 $\\sigma_{\\text{single}}$ 及 $N_{\\gamma}$ 联系起来，并计算 $\\sigma_{\\theta}$ 的数值。\n\n将最终的角度分辨率四舍五入到三位有效数字。最终的角度分辨率以弧度表示。最终答案必须是一个实数值。",
            "solution": "问题要求两个主要结果：首先是探测到的切伦科夫光子期望数 $N_{\\gamma}$ 的表达式，其次是由此产生的每条径迹的切伦科夫角分辨率 $\\sigma_{\\theta}$。我们将按顺序解决这些任务。\n\n**第1部分：探测到的光子数 $N_{\\gamma}$ 的推导与计算**\n\n基本过程是带电粒子以速度 $v$ 在折射率为 $n$ 的电介质中运动时发射切伦科夫辐射，其速度满足 $v > c/n$，其中 $c$ 是真空中的光速。每单位路径长度 $dx$ 和单位波长 $d\\lambda$ 产生的微分光子数由 Frank–Tamm 公式给出：\n$$\n\\frac{d^2N_{\\text{prod}}}{dx\\,d\\lambda} = \\frac{2\\pi\\alpha}{\\lambda^2} \\sin^2\\theta_c\n$$\n其中 $\\alpha \\approx 1/137.036$ 是精细结构常数，$\\theta_c$ 是切伦科夫角，由 $\\cos\\theta_c = \\frac{1}{n\\beta}$ 定义，其中 $\\beta = v/c$。\n\n问题指出该粒子是超相对论性的，这意味着其速度参数 $\\beta \\approx 1$。由于 $n = 1.0014 > 1$，切伦科夫条件 $\\beta > 1/n$ 得以满足。对于 $\\beta \\approx 1$，正弦平方项变为：\n$$\n\\sin^2\\theta_c = 1 - \\cos^2\\theta_c \\approx 1 - \\frac{1}{n^2}\n$$\n因此，产生的光子的谱产额为：\n$$\n\\frac{d^2N_{\\text{prod}}}{dx\\,d\\lambda} = \\frac{2\\pi\\alpha}{\\lambda^2} \\left(1 - \\frac{1}{n^2}\\right)\n$$\n这些光子是在辐射体内沿粒子长度为 $L$ 的径迹产生的。在深度 $x$ 处产生的光子必须行进剩余的距离 $L-x$ 才能离开辐射体。在此过程中，它会受到以吸收长度 $\\Lambda$ 为特征的吸收作用。光子存活下来穿过此路径的概率由指数衰减因子 $\\exp\\left(-\\frac{L-x}{\\Lambda}\\right)$ 给出。\n\n离开辐射体后，光子必须穿过透射率为 $T_{\\mathrm{w}}$ 的窗口，处于成像系统的几何接收度 $A_{\\mathrm{g}}$ 范围内，并最终被具有波长依赖量子效率 $\\mathrm{QE}(\\lambda)$ 的光电探测器探测到。\n\n从深度为 $x$ 的一段 $dx$ 和波长间隔为 $d\\lambda$ 中*探测到的*光子微分数 $dN_{\\gamma}$，是产生的光子数与所有后续效率因子的乘积：\n$$\ndN_{\\gamma} = \\frac{2\\pi\\alpha}{\\lambda^2} \\left(1 - \\frac{1}{n^2}\\right) \\exp\\left(-\\frac{L-x}{\\Lambda}\\right) T_{\\mathrm{w}} A_{\\mathrm{g}} \\mathrm{QE}(\\lambda) \\,dx\\,d\\lambda\n$$\n为求得探测到的总光子数 $N_{\\gamma}$，我们必须将此表达式对整个辐射体路径长度（从 $x=0$ 到 $x=L$）以及探测器的整个敏感波长范围（从 $\\lambda=\\lambda_1$ 到 $\\lambda=\\lambda_2$）进行积分：\n$$\nN_{\\gamma} = \\int_{\\lambda_1}^{\\lambda_2} \\int_0^L \\frac{2\\pi\\alpha}{\\lambda^2} \\left(1 - \\frac{1}{n^2}\\right) \\exp\\left(-\\frac{L-x}{\\Lambda}\\right) T_{\\mathrm{w}} A_{\\mathrm{g}} \\mathrm{QE}(\\lambda) \\,dx\\,d\\lambda\n$$\n大多数项相对于一个或两个积分变量是常数。我们可以将积分重排为：\n$$\nN_{\\gamma} = 2\\pi\\alpha \\left(1 - \\frac{1}{n^2}\\right) T_{\\mathrm{w}} A_{\\mathrm{g}} \\left( \\int_0^L \\exp\\left(-\\frac{L-x}{\\Lambda}\\right) \\,dx \\right) \\left( \\int_{\\lambda_1}^{\\lambda_2} \\frac{\\mathrm{QE}(\\lambda)}{\\lambda^2} \\,d\\lambda \\right)\n$$\n首先，我们计算关于路径长度 $x$ 的积分：\n$$\nI_x = \\int_0^L \\exp\\left(-\\frac{L-x}{\\Lambda}\\right) \\,dx = \\left[ \\Lambda \\exp\\left(-\\frac{L-x}{\\Lambda}\\right) \\right]_0^L = \\Lambda \\left(\\exp(0) - \\exp\\left(-\\frac{L}{\\Lambda}\\right)\\right) = \\Lambda \\left(1 - \\exp\\left(-\\frac{L}{\\Lambda}\\right)\\right)\n$$\n接下来，我们计算关于波长 $\\lambda$ 的积分。量子效率被给定为一个线性函数 $\\mathrm{QE}(\\lambda) = a + b\\lambda$。我们使用给定的条件来求参数 $a$ 和 $b$：$\\mathrm{QE}(\\lambda_1) = 0.20$ 和 $\\mathrm{QE}(\\lambda_2) = 0.35$，其中 $\\lambda_1 = 3.0 \\times 10^{-7}\\,\\mathrm{m}$ 且 $\\lambda_2 = 6.0 \\times 10^{-7}\\,\\mathrm{m}$。\n$$\na + b\\lambda_1 = 0.20 \\\\\na + b\\lambda_2 = 0.35\n$$\n第二个方程减去第一个方程得到 $b(\\lambda_2 - \\lambda_1) = 0.15$，所以：\n$$\nb = \\frac{0.15}{\\lambda_2 - \\lambda_1} = \\frac{0.15}{(6.0 - 3.0) \\times 10^{-7}\\,\\mathrm{m}} = \\frac{0.15}{3.0 \\times 10^{-7}\\,\\mathrm{m}} = 5.0 \\times 10^5\\,\\mathrm{m}^{-1}\n$$\n将 $b$ 代回第一个方程：\n$$\na = 0.20 - b\\lambda_1 = 0.20 - (5.0 \\times 10^5\\,\\mathrm{m}^{-1})(3.0 \\times 10^{-7}\\,\\mathrm{m}) = 0.20 - 0.15 = 0.05\n$$\n所以，量子效率函数为 $\\mathrm{QE}(\\lambda) = 0.05 + (5.0 \\times 10^5\\,\\mathrm{m}^{-1})\\lambda$。现在我们可以求解波长积分：\n$$\nI_{\\lambda} = \\int_{\\lambda_1}^{\\lambda_2} \\frac{a+b\\lambda}{\\lambda^2} \\,d\\lambda = \\int_{\\lambda_1}^{\\lambda_2} \\left(\\frac{a}{\\lambda^2} + \\frac{b}{\\lambda}\\right) \\,d\\lambda = \\left[ -\\frac{a}{\\lambda} + b\\ln(\\lambda) \\right]_{\\lambda_1}^{\\lambda_2}\n$$\n$$\nI_{\\lambda} = \\left(-\\frac{a}{\\lambda_2} + b\\ln(\\lambda_2)\\right) - \\left(-\\frac{a}{\\lambda_1} + b\\ln(\\lambda_1)\\right) = a\\left(\\frac{1}{\\lambda_1} - \\frac{1}{\\lambda_2}\\right) + b\\ln\\left(\\frac{\\lambda_2}{\\lambda_1}\\right)\n$$\n$N_{\\gamma}$ 的完整表达式为：\n$$\nN_{\\gamma} = 2\\pi\\alpha \\left(1 - \\frac{1}{n^2}\\right) T_{\\mathrm{w}} A_{\\mathrm{g}} \\left[\\Lambda \\left(1 - \\exp\\left(-\\frac{L}{\\Lambda}\\right)\\right)\\right] \\left[a\\left(\\frac{1}{\\lambda_1} - \\frac{1}{\\lambda_2}\\right) + b\\ln\\left(\\frac{\\lambda_2}{\\lambda_1}\\right)\\right]\n$$\n现在，我们代入给定的数值：\n$\\alpha = 1/137.036$, $n = 1.0014$, $T_{\\mathrm{w}} = 0.92$, $A_{\\mathrm{g}} = 0.28$, $L = 1.2\\,\\mathrm{m}$, $\\Lambda = 12\\,\\mathrm{m}$。\n公共前置因子为 $S_0 = 2\\pi\\alpha \\left(1 - \\frac{1}{n^2}\\right) = 2\\pi \\left(\\frac{1}{137.036}\\right) \\left(1 - \\frac{1}{1.0014^2}\\right) \\approx 1.28206 \\times 10^{-4}$。\n总效率和接收度因子为 $T_{\\mathrm{w}}A_{\\mathrm{g}} = 0.92 \\times 0.28 = 0.2576$。\n有效辐射体长度为 $I_x = 12\\,\\mathrm{m} \\times (1 - \\exp(-1.2/12)) = 12\\,\\mathrm{m} \\times (1 - \\exp(-0.1)) \\approx 1.141956\\,\\mathrm{m}$。\n波长积分的值为：\n$$\n\\frac{1}{\\lambda_1} - \\frac{1}{\\lambda_2} = \\frac{1}{3.0 \\times 10^{-7}\\,\\mathrm{m}} - \\frac{1}{6.0 \\times 10^{-7}\\,\\mathrm{m}} = \\frac{10^7}{6}\\,\\mathrm{m}^{-1}\n$$\n$$\n\\ln\\left(\\frac{\\lambda_2}{\\lambda_1}\\right) = \\ln\\left(\\frac{6.0 \\times 10^{-7}}{3.0 \\times 10^{-7}}\\right) = \\ln(2)\n$$\n$$\nI_{\\lambda} = 0.05 \\left(\\frac{10^7}{6}\\,\\mathrm{m}^{-1}\\right) + (5.0 \\times 10^5\\,\\mathrm{m}^{-1})\\ln(2) = 5.0 \\times 10^5 (\\frac{1}{6} + \\ln(2))\\,\\mathrm{m}^{-1} \\approx 4.29907 \\times 10^5\\,\\mathrm{m}^{-1}\n$$\n将所有部分相乘：\n$$\nN_{\\gamma} = (1.28206 \\times 10^{-4}) \\times (0.2576) \\times (1.141956\\,\\mathrm{m}) \\times (4.29907 \\times 10^5\\,\\mathrm{m}^{-1}) \\approx 16.206\n$$\n所以，探测到的光子期望数约为 $16.2$。\n\n**第2部分：每条径迹角度分辨率 $\\sigma_{\\theta}$ 的计算**\n\n每条径迹的切伦科夫角是通过对 $N_{\\gamma}$ 个探测到的光子各自测得的角度进行平均来确定的。如果每个光子都提供了一个角度的独立测量，其分辨率为 $\\sigma_{\\text{single}}$，那么平均角度（即径迹的角度）的不确定度由平均值的标准误差给出：\n$$\n\\sigma_{\\theta} = \\frac{\\sigma_{\\text{single}}}{\\sqrt{N_{\\gamma}}}\n$$\n给定 $\\sigma_{\\text{single}} = 7.5 \\times 10^{-3}\\,\\mathrm{rad}$，并且我们已计算出 $N_{\\gamma} \\approx 16.206$。\n代入这些值：\n$$\n\\sigma_{\\theta} = \\frac{7.5 \\times 10^{-3}\\,\\mathrm{rad}}{\\sqrt{16.206}} \\approx \\frac{7.5 \\times 10^{-3}\\,\\mathrm{rad}}{4.0257} \\approx 1.8630 \\times 10^{-3}\\,\\mathrm{rad}\n$$\n按要求将结果四舍五入到三位有效数字：\n$$\n\\sigma_{\\theta} \\approx 1.86 \\times 10^{-3}\\,\\mathrm{rad}\n$$",
            "answer": "$$\\boxed{1.86 \\times 10^{-3}}$$"
        },
        {
            "introduction": "现代高能物理实验通常配备多个子探测器系统，一项关键任务便是如何以最优方式组合它们提供的信息。本练习应用贝叶斯定理，将来自多个独立探测器测量（如飞行时间、RICH和电离能量损失）的似然信息结合起来。你将练习计算后验对数优势比，这是一种区分不同种类粒子的强大判据，并学习如何设计决策阈值以达到特定的物理目标，例如控制某种粒子的误判率。这个过程连接了概率模型与实际的科学决策。",
            "id": "3526746",
            "problem": "在计算高能物理的粒子鉴别（PID）任务中，一个径迹被三个子探测器观测：飞行时间系统（TOF）、环形成像切伦科夫探测器（RICH）以及一个通过能量损失提供比电离信息（dE/dx）的径迹探测器。事件级特征向量表示为 $x$。假设在给定粒子种类的情况下，三个子探测器的测量在统计上是独立的，并且仅有的两个相关粒子假设是 $\\pi$ 介子（pion）和 $K$ 介子（kaon）。在此径迹的运动学条件下，先验粒子种类概率为 $p(\\pi)=0.65$ 和 $p(K)=0.35$。在观测到的 $x$ 处，子探测器的似然（概率密度）值如下：\n- TOF: $p_{\\mathrm{TOF}}(x \\mid \\pi)=0.18$, $p_{\\mathrm{TOF}}(x \\mid K)=0.32$,\n- RICH: $p_{\\mathrm{RICH}}(x \\mid \\pi)=0.05$, $p_{\\mathrm{RICH}}(x \\mid K)=0.20$,\n- dE/dx: $p_{dE/dx}(x \\mid \\pi)=0.40$, $p_{dE/dx}(x \\mid K)=0.10$.\n\n仅使用基本概率法则，包括贝叶斯定理和所述的条件独立性，计算后验对数优势比\n$$\ns(x)\\equiv \\ln \\frac{p(\\pi \\mid x)}{p(K \\mid x)}.\n$$\n接下来，考虑设计一个阈值分类器，如果 $s(x)>\\tau$，则将粒子判定为 $\\pi$ 介子，否则判定为 $K$ 介子。假设在真实假设为 $K$ 介子的条件下，每个探测器的对数似然比贡献 $\\ell_{i}(x)\\equiv \\ln\\!\\big(p_{i}(x \\mid \\pi)/p_{i}(x \\mid K)\\big)$（其中 $i\\in\\{\\mathrm{TOF},\\mathrm{RICH},dE/dx\\}$）是相互独立的，并且服从高斯分布，其均值和方差为\n$$\n\\ell_{\\mathrm{TOF}} \\sim \\mathcal{N}(-0.6,\\,0.25),\\quad \\ell_{\\mathrm{RICH}} \\sim \\mathcal{N}(-1.1,\\,0.36),\\quad \\ell_{dE/dx} \\sim \\mathcal{N}(-0.2,\\,0.16).\n$$\n假设先验优势比的贡献 $\\ln\\!\\big(p(\\pi)/p(K)\\big)$ 是 $s(x)$ 中的一个恒定加法项。设计决策阈值 $\\tau$，以实现目标 $K$ 介子误判率 $r_{K\\to\\pi}=0.05$，其中 $r_{K\\to\\pi}$ 是一个真实的 $K$ 介子被分类为 $\\pi$ 介子的概率，即 $r_{K\\to\\pi}=\\mathbb{P}_{K}\\!\\big[s(x)>\\tau\\big]$。\n\n计算给定事件的 $s(x)$ 和为指定目标误判率而设的 $\\tau$。为了评分，只报告阈值 $\\tau$。将阈值表示为一个无单位的纯数，并将答案四舍五入到四位有效数字。",
            "solution": "该问题要求进行与粒子鉴别任务相关的两项计算：针对一个特定事件的后验对数优势比 $s(x)$，以及一个基于目标误判率的分类器的决策阈值 $\\tau$。\n\n首先，我们建立后验对数优势比 $s(x)$ 的一般形式，其定义为：\n$$\ns(x) \\equiv \\ln \\frac{p(\\pi \\mid x)}{p(K \\mid x)}\n$$\n其中 $\\pi$ 和 $K$ 分别代表 $\\pi$ 介子和 $K$ 介子假设，而 $x$ 是事件级特征向量。\n\n使用贝叶斯定理，对于一个假设 $H \\in \\{\\pi, K\\}$，其后验概率由 $p(H \\mid x) = \\frac{p(x \\mid H) p(H)}{p(x)}$ 给出。项 $p(x)$ 是证据项，它对两个假设是共同的，在比值中被消掉：\n$$\n\\frac{p(\\pi \\mid x)}{p(K \\mid x)} = \\frac{p(x \\mid \\pi) p(\\pi) / p(x)}{p(x \\mid K) p(K) / p(x)} = \\frac{p(x \\mid \\pi)}{p(x \\mid K)} \\frac{p(\\pi)}{p(K)}\n$$\n取自然对数得到对数优势比：\n$$\ns(x) = \\ln \\left( \\frac{p(x \\mid \\pi)}{p(x \\mid K)} \\right) + \\ln \\left( \\frac{p(\\pi)}{p(K)} \\right)\n$$\n问题陈述，来自三个子探测器（TOF, RICH, dE/dx）的测量在给定粒子种类的情况下是条件独立的。因此，总似然 $p(x \\mid H)$ 是各个子探测器似然的乘积：\n$$\np(x \\mid H) = p_{\\mathrm{TOF}}(x \\mid H) \\cdot p_{\\mathrm{RICH}}(x \\mid H) \\cdot p_{dE/dx}(x \\mid H)\n$$\n将此代入 $s(x)$ 的表达式，并使用对数的性质 $\\ln(ab) = \\ln(a) + \\ln(b)$，我们得到：\n$$\ns(x) = \\left[ \\ln \\frac{p_{\\mathrm{TOF}}(x \\mid \\pi)}{p_{\\mathrm{TOF}}(x \\mid K)} + \\ln \\frac{p_{\\mathrm{RICH}}(x \\mid \\pi)}{p_{\\mathrm{RICH}}(x \\mid K)} + \\ln \\frac{p_{dE/dx}(x \\mid \\pi)}{p_{dE/dx}(x \\mid K)} \\right] + \\ln \\frac{p(\\pi)}{p(K)}\n$$\n\n**第一部分：计算给定事件的 $s(x)$**\n\n对于一个特定事件 $x$，问题提供了以下值：\n- 先验概率：$p(\\pi)=0.65$, $p(K)=0.35$。\n- TOF 似然：$p_{\\mathrm{TOF}}(x \\mid \\pi)=0.18$, $p_{\\mathrm{TOF}}(x \\mid K)=0.32$。\n- RICH 似然：$p_{\\mathrm{RICH}}(x \\mid \\pi)=0.05$, $p_{\\mathrm{RICH}}(x \\mid K)=0.20$。\n- dE/dx 似然：$p_{dE/dx}(x \\mid \\pi)=0.40$, $p_{dE/dx}(x \\mid K)=0.10$。\n\n我们计算 $s(x)$ 表达式中的每一项：\n对数先验优势比项为：\n$$\n\\ln \\frac{p(\\pi)}{p(K)} = \\ln \\frac{0.65}{0.35} = \\ln \\frac{13}{7}\n$$\n对数似然比项为：\n$$\n\\ell_{\\mathrm{TOF}}(x) = \\ln \\frac{p_{\\mathrm{TOF}}(x \\mid \\pi)}{p_{\\mathrm{TOF}}(x \\mid K)} = \\ln \\frac{0.18}{0.32} = \\ln \\frac{9}{16}\n$$\n$$\n\\ell_{\\mathrm{RICH}}(x) = \\ln \\frac{p_{\\mathrm{RICH}}(x \\mid \\pi)}{p_{\\mathrm{RICH}}(x \\mid K)} = \\ln \\frac{0.05}{0.20} = \\ln \\frac{1}{4}\n$$\n$$\n\\ell_{dE/dx}(x) = \\ln \\frac{p_{dE/dx}(x \\mid \\pi)}{p_{dE/dx}(x \\mid K)} = \\ln \\frac{0.40}{0.10} = \\ln(4)\n$$\n将这些项相加得到 $s(x)$：\n$$\ns(x) = \\ln\\frac{9}{16} + \\ln\\frac{1}{4} + \\ln(4) + \\ln\\frac{13}{7} = \\ln\\frac{9}{16} - \\ln(4) + \\ln(4) + \\ln\\frac{13}{7} = \\ln\\frac{9}{16} + \\ln\\frac{13}{7} = \\ln\\left(\\frac{9 \\times 13}{16 \\times 7}\\right) = \\ln\\frac{117}{112}\n$$\n数值上，$s(x) \\approx \\ln(1.0446) \\approx 0.0436$。\n\n**第二部分：计算决策阈值 $\\tau$**\n\n在第二部分中，我们得到了在真实假设为 $K$ 介子的条件下，对数似然比 $\\ell_i(x) = \\ln(p_i(x \\mid \\pi)/p_i(x \\mid K))$ 的统计模型。这些被假设为独立的的高斯随机变量：\n- $\\ell_{\\mathrm{TOF}} \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$，其中 $\\mu_1 = -0.6$，$\\sigma_1^2 = 0.25$。\n- $\\ell_{\\mathrm{RICH}} \\sim \\mathcal{N}(\\mu_2, \\sigma_2^2)$，其中 $\\mu_2 = -1.1$，$\\sigma_2^2 = 0.36$。\n- $\\ell_{dE/dx} \\sim \\mathcal{N}(\\mu_3, \\sigma_3^2)$，其中 $\\mu_3 = -0.2$，$\\sigma_3^2 = 0.16$。\n\n检验统计量 $s(x)$ 可以写成这些随机变量的和，再加上一个对数先验优势比的常数项：\n$$\ns(x) = \\ell_{\\mathrm{TOF}}(x) + \\ell_{\\mathrm{RICH}}(x) + \\ell_{dE/dx}(x) + \\ln\\frac{p(\\pi)}{p(K)}\n$$\n独立高斯变量的和也是一个高斯变量。令 $L(x) = \\ell_{\\mathrm{TOF}}(x) + \\ell_{\\mathrm{RICH}}(x) + \\ell_{dE/dx}(x)$。在 $K$ 介子假设下，$L(x)$ 的分布是 $\\mathcal{N}(\\mu_L, \\sigma_L^2)$，其中均值是均值之和，方差是方差之和：\n$$\n\\mu_L = \\mu_1 + \\mu_2 + \\mu_3 = -0.6 - 1.1 - 0.2 = -1.9\n$$\n$$\n\\sigma_L^2 = \\sigma_1^2 + \\sigma_2^2 + \\sigma_3^2 = 0.25 + 0.36 + 0.16 = 0.77\n$$\n统计量 $s(x)$ 是 $L(x)$ 的线性变换，具体为 $s(x)=L(x)+C$，其中 $C = \\ln(p(\\pi)/p(K))$。因此，在 $K$ 介子假设下 $s(x)$ 的分布也是高斯分布，$s(x) \\mid K \\sim \\mathcal{N}(\\mu_s, \\sigma_s^2)$，其参数为：\n$$\n\\mu_s = \\mu_L + \\ln\\frac{p(\\pi)}{p(K)} = -1.9 + \\ln\\frac{0.65}{0.35} = -1.9 + \\ln\\frac{13}{7}\n$$\n$$\n\\sigma_s^2 = \\sigma_L^2 = 0.77\n$$\n标准差是 $\\sigma_s = \\sqrt{0.77}$。\n\n$K$ 介子误判率 $r_{K\\to\\pi}$ 是将一个真实的 $K$ 介子分类为 $\\pi$ 介子的概率。这在 $s(x) > \\tau$ 时发生。我们给定的目标率为 $r_{K\\to\\pi} = 0.05$。\n$$\n\\mathbb{P}_K[s(x) > \\tau] = 0.05\n$$\n为了求出 $\\tau$，我们将变量 $s(x)$ 标准化。令 $Z = \\frac{s(x) - \\mu_s}{\\sigma_s}$，它服从标准正态分布，$Z \\sim \\mathcal{N}(0, 1)$。\n条件变为：\n$$\n\\mathbb{P}_K\\left[\\frac{s(x) - \\mu_s}{\\sigma_s} > \\frac{\\tau - \\mu_s}{\\sigma_s}\\right] = 0.05 \\implies \\mathbb{P}\\left[Z > \\frac{\\tau - \\mu_s}{\\sigma_s}\\right] = 0.05\n$$\n这意味着 $\\frac{\\tau - \\mu_s}{\\sigma_s}$ 是对应于标准正态分布上 $5\\%$ 尾部的临界值 $z_{0.05}$。这个值是该分布的第 95 百分位数，$\\Phi^{-1}(0.95)$，其中 $\\Phi$ 是标准正态分布的累积分布函数。\n使用标准表格或计算器，可得 $z_{0.05} \\approx 1.64485$。\n我们现在可以解出 $\\tau$：\n$$\n\\frac{\\tau - \\mu_s}{\\sigma_s} = z_{0.05} \\implies \\tau = \\mu_s + z_{0.05} \\sigma_s\n$$\n代入 $\\mu_s$ 和 $\\sigma_s$ 的表达式：\n$$\n\\tau = \\left(-1.9 + \\ln\\frac{13}{7}\\right) + z_{0.05} \\sqrt{0.77}\n$$\n现在，我们计算数值：\n$$\n\\ln\\frac{13}{7} \\approx 0.619039\n$$\n$$\n\\mu_s \\approx -1.9 + 0.619039 = -1.280961\n$$\n$$\n\\sigma_s = \\sqrt{0.77} \\approx 0.877496\n$$\n$$\n\\tau \\approx -1.280961 + (1.64485 \\times 0.877496)\n$$\n$$\n\\tau \\approx -1.280961 + 1.443369\n$$\n$$\n\\tau \\approx 0.162408\n$$\n四舍五入到四位有效数字，阈值为 $\\tau = 0.1624$。",
            "answer": "$$\n\\boxed{0.1624}\n$$"
        },
        {
            "introduction": "探测器的性能并非一成不变，它会随着温度等环境因素的变化而漂移，因此粒子鉴别算法必须能适应这些变化。这项高级练习模拟了一项真实的刻度任务：你将利用刻度数据，拟合一个描述RICH探测器折射率随温度变化的模型。通过实现这种“域适应”（domain adaptation），你将学习如何使用刻度后的模型来更新在不同条件下采集的数据的粒子似然。这个端到端的练习结合了物理建模、统计拟合和计算实现，完整地反映了实验粒子物理学中的一个典型工作流程。",
            "id": "3526795",
            "problem": "设计并实现一个完整、可运行的程序，通过拟合一个依赖于温度的折射率模型并更新粒子种类的似然，来对不同数据采集时期的粒子鉴别标定进行域自适应。计算背景为高能物理中的环形成像切伦科夫（RICH）粒子鉴别，使用以下基本原理：切伦科夫辐射条件和相对论运动学。您的程序必须按顺序执行以下任务，且仅使用本说明中提供的数值。\n\n任务 A（拟合折射率的温度依赖性）：使用切伦科夫辐射关系和相对论运动学，为折射率的线性温度模型构建一个加权最小二乘估计器。物理模型从以下基本关系开始：对于一个动量为 $p$、静止质量为 $m$ 的粒子，在光速 $c$ 设为 $1$ 的自然单位制中，相对论速度分数为 $\\,\\beta = \\dfrac{p}{\\sqrt{p^2 + m^2}}\\,$。对于折射率为 $n$ 的辐射体，当 $\\,n \\beta \\ge 1\\,$ 时，切伦科夫角 $\\theta_{\\mathrm{C}}$ 满足 $\\,\\cos \\theta_{\\mathrm{C}} = \\dfrac{1}{n \\beta}\\,$；否则，不产生切伦科夫辐射。假设折射率在参考温度 $T_{\\mathrm{ref}}$ 附近随温度 $T$ 线性变化，关系如下：\n$$\nn(T) = n_0 + \\alpha \\left(T - T_{\\mathrm{ref}}\\right),\n$$\n其中 $n_0$ 和 $\\alpha$ 是未知参数。从使用已知粒子种类和动量在不同温度下获取的标定数据中，利用切伦科夫关系式的反演，从测量的切伦科夫角 $\\theta_i$ 构建每次运行的估计值 $\\hat{n}_i$，并执行加权最小二乘拟合以获得 $(n_0, \\alpha)$。将 $\\theta_i$ 的测量不确定度传播到 $\\hat{n}_i$ 的不确定度上，以定义拟合的权重。\n\n任务 B（计算更新的粒子种类似然和对数似然比）：对于每个测试径迹，使用在径迹运行温度 $T^\\star$ 下拟合的 $n(T)$，为集合 $\\{\\pi, K\\}$ 中的每个粒子种类 $s$ 计算超过阈值（$n(T^\\star)\\,\\beta_s \\ge 1$）时的期望切伦科夫角 $\\theta_{\\mathrm{exp}}(T^\\star, p, m_s)$。将单径迹测量似然建模为观测到的切伦科夫角 $\\theta_{\\mathrm{obs}}$ 的高斯密度，其均值为 $\\theta_{\\mathrm{exp}}$，标准差为 $\\sigma_\\theta$。对于在 $T^\\star$ 和 $p$ 下低于阈值（即 $n(T^\\star)\\,\\beta_s < 1$）的粒子种类，在物理允许的角度范围 $[0, \\theta_{\\max}(T^\\star)]$ 内赋予一个小的均匀背景密度，其中 $\\theta_{\\max}(T) = \\arccos\\!\\left(1/n(T)\\right)$，以反映信号环的缺失，同时允许伪迹的出现。具体来说，对于低于阈值的粒子种类，使用一个常数密度 $\\varepsilon(T^\\star) = 10^{-6}/\\theta_{\\max}(T^\\star)$，单位为反弧度。对于超过阈值的粒子种类，使用高斯密度：\n$$\n\\mathcal{L}_s(\\theta_{\\mathrm{obs}}) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_\\theta}\\,\\exp\\!\\left(-\\frac{\\left(\\theta_{\\mathrm{obs}} - \\theta_{\\mathrm{exp}}(T^\\star, p, m_s)\\right)^2}{2\\,\\sigma_\\theta^2}\\right).\n$$\n对于每个测试案例，计算对数似然比：\n$$\n\\Lambda_{\\pi/K} \\equiv \\ln \\mathcal{L}_{\\pi} - \\ln \\mathcal{L}_{K}.\n$$\n\n全程使用的基本常数、单位和定义：\n- 使用自然单位制，其中 $c = 1$，因此动量 $p$ 和质量 $m$ 的单位是 $\\mathrm{GeV}$，速度是无量纲的。\n- 角度必须以弧度为单位。\n- 温度必须以开尔文为单位。\n- 对于任何温度 $T$，背景密度尺度固定为 $\\varepsilon(T) = 10^{-6}/\\theta_{\\max}(T)$。\n- 在任务 A 中，为将不确定度从角度传播到折射率，使用导数 $\\,\\dfrac{\\partial}{\\partial \\theta}\\left(\\dfrac{1}{\\beta \\cos \\theta}\\right) = \\dfrac{\\sin \\theta}{\\beta \\cos^2 \\theta} = \\hat{n}\\,\\tan \\theta\\,$，因此 $\\,\\sigma_{n,i} = \\hat{n}_i \\tan(\\theta_i)\\,\\sigma_{\\theta,i}\\,$，相应的权重为 $\\,w_i = 1/\\sigma_{n,i}^2\\,$。\n\n任务 A 的标定数据和常数：\n- 参考温度 $T_{\\mathrm{ref}} = $ $293.0$ $\\mathrm{K}$。\n- 标定粒子种类：电子，质量 $m_e = $ $0.000511$ $\\mathrm{GeV}$。\n- 所有标定运行的标定粒子动量：$p_{\\mathrm{cal}} = $ $5.0$ $\\mathrm{GeV}$。\n- 每次运行的标定元组 $(T_i, \\theta_i, \\sigma_{\\theta,i})$：\n  - $(T_1, \\theta_1, \\sigma_{\\theta,1}) = ($ $289.0$, $0.052967$, $0.00010$ $)$\n  - $(T_2, \\theta_2, \\sigma_{\\theta,2}) = ($ $293.0$, $0.052890$, $0.00010$ $)$\n  - $(T_3, \\theta_3, \\sigma_{\\theta,3}) = ($ $296.0$, $0.052814$, $0.00010$ $)$\n  - $(T_4, \\theta_4, \\sigma_{\\theta,4}) = ($ $300.0$, $0.052720$, $0.00010$ $)$\n  - $(T_5, \\theta_5, \\sigma_{\\theta,5}) = ($ $305.0$, $0.052628$, $0.00010$ $)$\n\n任务 B 的粒子种类定义：\n- Pion 质量 $m_{\\pi} = $ $0.13957$ $\\mathrm{GeV}$。\n- Kaon 质量 $m_{K} = $ $0.49367$ $\\mathrm{GeV}$。\n\n任务 B 的测试组（每个案例是一个元组 $(T^\\star, p, \\theta_{\\mathrm{obs}}, \\sigma_\\theta)$）：\n- 案例 1：$( $ $295.0$, $5.0$, $0.0449$, $0.0015$ $)$\n- 案例 2：$( $ $295.0$, $3.0$, $0.0250$, $0.0015$ $)$\n- 案例 3：$( $ $295.0$, $0.5$, $0.0100$, $0.0015$ $)$\n- 案例 4：$( $ $295.0$, $10.0$, $0.0350$, $0.0015$ $)$\n\n数学和算法要求：\n- 在任务 A 中，对每个标定元组反演切伦科夫关系式，得到 $\\hat{n}_i = 1/\\left(\\beta_{\\mathrm{cal}} \\cos \\theta_i\\right)$，其中 $\\beta_{\\mathrm{cal}} = \\dfrac{p_{\\mathrm{cal}}}{\\sqrt{p_{\\mathrm{cal}}^2 + m_e^2}}$，使用上面给出的导数将不确定度传播到 $\\sigma_{n,i}$，并通过最小化加权残差平方和 $\\sum_i w_i \\left(y_i - n_0 - \\alpha x_i\\right)^2$（其中 $w_i = 1/\\sigma_{n,i}^2$）来拟合线性模型 $y_i = n_0 + \\alpha x_i$，其中 $y_i = \\hat{n}_i$，$x_i = T_i - T_{\\mathrm{ref}}$。使用加权正规方程组的闭式解来计算 $(n_0, \\alpha)$。\n- 在任务 B 中，对于每个测试案例 $(T^\\star, p, \\theta_{\\mathrm{obs}}, \\sigma_\\theta)$ 和每种粒子 $s \\in \\{\\pi, K\\}$，计算 $\\beta_s = \\dfrac{p}{\\sqrt{p^2 + m_s^2}}$。如果 $n(T^\\star)\\,\\beta_s \\ge 1$，则设置 $\\theta_{\\mathrm{exp}} = \\arccos\\!\\left(\\dfrac{1}{n(T^\\star)\\,\\beta_s}\\right)$ 并计算高斯似然密度；否则，将似然密度设置为均匀背景 $\\varepsilon(T^\\star)$。然后按上文定义计算 $\\Lambda_{\\pi/K}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试案例的结果，形式为一个由方括号括起来的、逗号分隔的浮点数列表，顺序与上述案例一致。即，必须打印一个形如 $[r_1,r_2,r_3,r_4]$ 的字符串，其中每个 $r_i$ 是案例 $i$ 的 $\\Lambda_{\\pi/K}$ 的浮点数值。\n\n所有角度必须以弧度处理和报告。无需用户输入；程序必须是自包含的，并且只能使用上面提供的数据。程序必须遵守指定的执行环境和库约束。",
            "solution": "用户提供了一个定义明确的计算物理问题，需要一个两阶段的解决方案：首先是标定步骤，以确定物理模型的参数；其次是将此模型应用于新数据。该问题在科学上是合理的，数学上是严谨的，并包含了唯一解所需的所有必要信息。\n\n解决方案按规定分为两个连续的任务。\n\n### 任务 A：拟合折射率的温度依赖性\n\n第一个任务是通过对标定数据进行加权最小二乘拟合来确定折射率线性模型 $n(T) = n_0 + \\alpha (T - T_{\\mathrm{ref}})$ 的参数 $n_0$ 和 $\\alpha$。\n\n**1. 准备工作**\n标定数据是使用动量 $p_{\\mathrm{cal}} = 5.0\\,\\mathrm{GeV}$、质量 $m_e = 0.000511\\,\\mathrm{GeV}$ 的电子束获得的。相对论速度分数 $\\beta_{\\mathrm{cal}}$ 对所有标定运行都是恒定的：\n$$\n\\beta_{\\mathrm{cal}} = \\frac{p_{\\mathrm{cal}}}{\\sqrt{p_{\\mathrm{cal}}^2 + m_e^2}} = \\frac{5.0}{\\sqrt{5.0^2 + (0.000511)^2}} \\approx 0.999999994778\n$$\n参考温度为 $T_{\\mathrm{ref}} = 293.0\\,\\mathrm{K}$。\n\n**2. 处理标定数据**\n对于每个标定数据点 $(T_i, \\theta_i, \\sigma_{\\theta,i})$，我们计算线性拟合 $y_i = n_0 + \\alpha x_i$ 对应的点 $(x_i, y_i)$ 及其相关权重 $w_i$。\n- 自变量是 $x_i = T_i - T_{\\mathrm{ref}}$。\n- 因变量，即折射率的估计值，是 $y_i = \\hat{n}_i = \\frac{1}{\\beta_{\\mathrm{cal}} \\cos \\theta_i}$。\n- $\\hat{n}_i$ 的不确定度由 $\\sigma_{\\theta,i}$ 传播而来，使用提供的公式：$\\sigma_{n,i} = \\hat{n}_i \\tan(\\theta_i) \\sigma_{\\theta,i}$。\n- 拟合的权重是方差的倒数：$w_i = 1/\\sigma_{n,i}^2$。\n\n下表总结了计算出的五个标定点的值：\n\n| $i$ | $T_i$ (K) | $\\theta_i$ (rad) | $\\sigma_{\\theta,i}$ (rad) | $x_i$ (K) | $\\hat{n}_i$ (y_i) | $\\sigma_{n,i}$ | $w_i$ ($10^{10}\\,\\mathrm{rad}^{-2}$) |\n|---|---|---|---|---|---|---|---|\n| 1 | $289.0$ | $0.052967$ | $0.00010$ | $-4.0$ | $1.00140445$ | $5.3039 \\times 10^{-6}$ | $3.5539$ |\n| 2 | $293.0$ | $0.052890$ | $0.00010$ | $0.0$ | $1.00140026$ | $5.2977 \\times 10^{-6}$ | $3.5657$ |\n| 3 | $296.0$ | $0.052814$ | $0.00010$ | $3.0$ | $1.00139611$ | $5.2917 \\times 10^{-6}$ | $3.5769$ |\n| 4 | $300.0$ | $0.052720$ | $0.00010$ | $7.0$ | $1.00139109$ | $5.2843 \\times 10^{-6}$ | $3.5899$ |\n| 5 | $305.0$ | $0.052628$ | $0.00010$ | $12.0$ | $1.00138612$ | $5.2770 \\times 10^{-6}$ | $3.6027$ |\n\n**3. 加权最小二乘估计**\n我们通过最小化加权残差平方和 $\\chi^2 = \\sum_i w_i (y_i - n_0 - \\alpha x_i)^2$ 来找到参数 $(n_0, \\alpha)$。闭式解由加权正规方程组给出。我们计算所需的和：\n$$ S_w = \\sum_i w_i \\quad S_{wx} = \\sum_i w_i x_i \\quad S_{wy} = \\sum_i w_i y_i $$\n$$ S_{wxx} = \\sum_i w_i x_i^2 \\quad S_{wxy} = \\sum_i w_i x_i y_i $$\n使用表中的值，我们得到：\n$S_w \\approx 1.78891 \\times 10^{11}$\n$S_{wx} \\approx 6.50147 \\times 10^{11}$\n$S_{wy} \\approx 1.79153 \\times 10^{11}$\n$S_{wxx} \\approx 8.16315 \\times 10^{12}$\n$S_{wxy} \\approx 6.49466 \\times 10^{11}$\n\n然后按如下方式计算参数：\n$$ \\alpha = \\frac{S_w S_{wxy} - S_{wx} S_{wy}}{S_w S_{wxx} - (S_{wx})^2} $$\n$$ n_0 = \\frac{S_{wy} - \\alpha S_{wx}}{S_w} $$\n代入这些和值，得到最佳拟合参数：\n$$ n_0 \\approx 1.00140018 $$\n$$ \\alpha \\approx -1.1390 \\times 10^{-6} \\, \\mathrm{K}^{-1} $$\n$\\alpha$ 的负值正确地反映了随着温度升高，辐射气体介质的折射率（以及密度）降低。因此，拟合后的模型为：$n(T) = 1.00140018 - 1.1390 \\times 10^{-6}(T-293.0)$。\n\n### 任务 B：计算更新的粒子种类似然\n\n利用标定好的 $n(T)$ 模型，我们现在为四个测试案例计算对数似然比 $\\Lambda_{\\pi/K}$。对于每个案例，我们有一个径迹，其具有温度 $T^\\star$、动量 $p$、观测到的切伦科夫角 $\\theta_{\\mathrm{obs}}$ 和角度分辨率 $\\sigma_\\theta$。粒子假设为 pion（$m_\\pi = 0.13957\\,\\mathrm{GeV}$）和 kaon（$m_K = 0.49367\\,\\mathrm{GeV}$）。\n\n对于每种粒子 $s \\in \\{\\pi, K\\}$，我们计算其速度 $\\beta_s = p/\\sqrt{p^2+m_s^2}$ 并检查切伦科夫条件 $n(T^\\star)\\beta_s \\ge 1$。\n- 如果超过阈值，对数似然为 $\\ln\\mathcal{L}_s = -\\ln(\\sqrt{2\\pi}\\sigma_\\theta) - \\frac{(\\theta_{\\mathrm{obs}}-\\theta_{\\mathrm{exp},s})^2}{2\\sigma_\\theta^2}$，其中 $\\theta_{\\mathrm{exp},s} = \\arccos\\left(1/(n(T^\\star)\\beta_s)\\right)$。\n- 如果低于阈值，对数似然为 $\\ln\\mathcal{L}_s = \\ln(\\varepsilon(T^\\star))$，其中 $\\varepsilon(T^\\star) = 10^{-6}/\\arccos(1/n(T^\\star))$。\n\n所有测试案例都在 $T^\\star = 295.0\\,\\mathrm{K}$。对应的折射率为：\n$$ n(T^\\star=295.0) = 1.00140018 - 1.1390 \\times 10^{-6} (295.0 - 293.0) \\approx 1.0013979 $$\n最大角是 $\\theta_{\\max}(T^\\star) = \\arccos(1/n^\\star) \\approx 0.05288\\,\\mathrm{rad}$，背景对数密度是 $\\ln(\\varepsilon(T^\\star)) = \\ln(10^{-6}/0.05288) \\approx -10.875$。\n\n**案例 1：** $(T^\\star, p, \\theta_{\\mathrm{obs}}, \\sigma_\\theta) = (295.0, 5.0, 0.0449, 0.0015)$\n- Pion: $\\beta_\\pi \\approx 0.99961$。$n^\\star\\beta_\\pi \\approx 1.00101 > 1$（超过阈值）。$\\theta_{\\mathrm{exp},\\pi} \\approx 0.04488\\,\\mathrm{rad}$。\n- Kaon: $\\beta_K \\approx 0.99516$。$n^\\star\\beta_K \\approx 0.99655 < 1$（低于阈值）。\n- $\\ln\\mathcal{L}_\\pi \\approx -\\ln(\\sqrt{2\\pi} \\cdot 0.0015) - \\frac{(0.0449-0.04488)^2}{2(0.0015)^2} \\approx 5.5835 - 0.0001 \\approx 5.5834$。\n- $\\ln\\mathcal{L}_K = -10.875$。\n- $\\Lambda_{\\pi/K} = \\ln\\mathcal{L}_\\pi - \\ln\\mathcal{L}_K \\approx 5.5834 - (-10.875) \\approx \\mathbf{16.458}$。\n\n**案例 2：** $(T^\\star, p, \\theta_{\\mathrm{obs}}, \\sigma_\\theta) = (295.0, 3.0, 0.0250, 0.0015)$\n- Pion: $\\beta_\\pi \\approx 0.99893$。$n^\\star\\beta_\\pi \\approx 1.00033 > 1$（超过阈值）。$\\theta_{\\mathrm{exp},\\pi} \\approx 0.02568\\,\\mathrm{rad}$。\n- Kaon: $\\beta_K \\approx 0.98680$。$n^\\star\\beta_K \\approx 0.98819 < 1$（低于阈值）。\n- $\\ln\\mathcal{L}_\\pi \\approx 5.5835 - \\frac{(0.0250-0.02568)^2}{2(0.0015)^2} \\approx 5.5835 - 0.1027 \\approx 5.4808$。\n- $\\ln\\mathcal{L}_K = -10.875$。\n- $\\Lambda_{\\pi/K} \\approx 5.4808 - (-10.875) \\approx \\mathbf{16.356}$。\n\n**案例 3：** $(T^\\star, p, \\theta_{\\mathrm{obs}}, \\sigma_\\theta) = (295.0, 0.5, 0.0100, 0.0015)$\n- Pion: $\\beta_\\pi \\approx 0.96311$。$n^\\star\\beta_\\pi \\approx 0.96446 < 1$（低于阈值）。\n- Kaon: $\\beta_K \\approx 0.71063$。$n^\\star\\beta_K \\approx 0.71162 < 1$（低于阈值）。\n- 两种粒子都低于切伦科夫阈值。因此，它们的似然是相同的，都等于背景密度。\n- $\\ln\\mathcal{L}_\\pi = \\ln\\mathcal{L}_K = -10.875$。\n- $\\Lambda_{\\pi/K} = \\ln\\mathcal{L}_\\pi - \\ln\\mathcal{L}_K = \\mathbf{0.0}$。\n\n**案例 4：** $(T^\\star, p, \\theta_{\\mathrm{obs}}, \\sigma_\\theta) = (295.0, 10.0, 0.0350, 0.0015)$\n- Pion: $\\beta_\\pi \\approx 0.99990$。$n^\\star\\beta_\\pi \\approx 1.00130 > 1$（超过阈值）。$\\theta_{\\mathrm{exp},\\pi} \\approx 0.05096\\,\\mathrm{rad}$。\n- Kaon: $\\beta_K \\approx 0.99878$。$n^\\star\\beta_K \\approx 1.00018 > 1$（超过阈值）。\n- 两种粒子都超过阈值。对数似然比简化为 $\\Lambda_{\\pi/K} = \\frac{1}{2\\sigma_\\theta^2}[(\\theta_{\\mathrm{obs}} - \\theta_{\\mathrm{exp},K})^2 - (\\theta_{\\mathrm{obs}} - \\theta_{\\mathrm{exp},\\pi})^2]$。\n- $\\theta_{\\mathrm{exp},K} = \\arccos(1/(n^\\star \\beta_K)) \\approx 0.01890\\,\\mathrm{rad}$。\n- $(\\theta_{\\mathrm{obs}} - \\theta_{\\mathrm{exp},K})^2 = (0.0350-0.01890)^2 \\approx 2.592 \\times 10^{-4}$。\n- $(\\theta_{\\mathrm{obs}} - \\theta_{\\mathrm{exp},\\pi})^2 = (0.0350-0.05096)^2 \\approx 2.547 \\times 10^{-4}$。\n- $\\Lambda_{\\pi/K} = \\frac{1}{2(0.0015)^2} (2.592\\times 10^{-4} - 2.547\\times 10^{-4}) \\approx \\mathbf{1.001}$。\n\n最终结果是这四个对数似然比的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs domain adaptation of particle identification calibrations by fitting\n    a temperature-dependent refractive index model and updating species likelihoods.\n    \"\"\"\n\n    # --- Task A: Fit the temperature dependence of the refractive index ---\n\n    # Fundamental constants, units, and definitions\n    m_e = 0.000511  # Electron mass in GeV\n    T_ref = 293.0   # Reference temperature in Kelvin\n    p_cal = 5.0     # Calibrator momentum in GeV\n\n    # Per-run calibration tuples (T_i, theta_i, sigma_theta_i)\n    calibration_data = [\n        (289.0, 0.052967, 0.00010),\n        (293.0, 0.052890, 0.00010),\n        (296.0, 0.052814, 0.00010),\n        (300.0, 0.052720, 0.00010),\n        (305.0, 0.052628, 0.00010),\n    ]\n\n    # Calculate beta for the calibrator electron\n    beta_cal = p_cal / np.sqrt(p_cal**2 + m_e**2)\n\n    # Process calibration data for weighted least squares\n    x_i_list, y_i_list, w_i_list = [], [], []\n    for Ti, theta_i, sigma_theta_i in calibration_data:\n        x_i = Ti - T_ref\n        \n        # Estimate refractive index n_hat\n        n_hat_i = 1.0 / (beta_cal * np.cos(theta_i))\n        \n        # Propagate uncertainty to sigma_n\n        sigma_n_i = n_hat_i * np.tan(theta_i) * sigma_theta_i\n        \n        # Calculate weight\n        w_i = 1.0 / sigma_n_i**2\n        \n        x_i_list.append(x_i)\n        y_i_list.append(n_hat_i)\n        w_i_list.append(w_i)\n\n    x = np.array(x_i_list)\n    y = np.array(y_i_list)\n    w = np.array(w_i_list)\n\n    # Calculate sums for weighted least squares normal equations\n    S_w = np.sum(w)\n    S_wx = np.sum(w * x)\n    S_wy = np.sum(w * y)\n    S_wxx = np.sum(w * x**2)\n    S_wxy = np.sum(w * x * y)\n\n    # Solve for alpha and n0\n    denominator = S_w * S_wxx - S_wx**2\n    alpha = (S_w * S_wxy - S_wx * S_wy) / denominator\n    n0 = (S_wy - alpha * S_wx) / S_w\n    \n    # Define the fitted refractive index model function\n    def n_model(T):\n        return n0 + alpha * (T - T_ref)\n\n    # --- Task B: Compute updated species likelihoods and log-likelihood ratios ---\n\n    # Species definitions\n    m_pi = 0.13957  # Pion mass in GeV\n    m_K = 0.49367   # Kaon mass in GeV\n    species = {'pi': m_pi, 'K': m_K}\n\n    # Test suite for Task B (T_star, p, theta_obs, sigma_theta)\n    test_cases = [\n        (295.0, 5.0, 0.0449, 0.0015),\n        (295.0, 3.0, 0.0250, 0.0015),\n        (295.0, 0.5, 0.0100, 0.0015),\n        (295.0, 10.0, 0.0350, 0.0015),\n    ]\n\n    results = []\n    \n    # Pre-calculate log of normalization constant for Gaussian\n    LOG_SQRT_2PI = np.log(np.sqrt(2 * np.pi))\n\n    for T_star, p, theta_obs, sigma_theta in test_cases:\n        n_star = n_model(T_star)\n        \n        # Calculate background likelihood terms\n        # Handle case where n_star = 1, although unlikely with this data\n        if n_star = 1.0:\n            log_L_background = -np.inf\n        else:\n            theta_max_star = np.arccos(1.0 / n_star)\n            epsilon_star = 1e-6 / theta_max_star\n            log_L_background = np.log(epsilon_star)\n\n        log_likelihoods = {}\n        for s_name, m_s in species.items():\n            beta_s = p / np.sqrt(p**2 + m_s**2)\n            \n            # Check Cherenkov threshold condition\n            if n_star * beta_s >= 1.0:\n                # Above threshold: Gaussian likelihood\n                theta_exp = np.arccos(1.0 / (n_star * beta_s))\n                log_L = -LOG_SQRT_2PI - np.log(sigma_theta) - (theta_obs - theta_exp)**2 / (2 * sigma_theta**2)\n                log_likelihoods[s_name] = log_L\n            else:\n                # Below threshold: Uniform background likelihood\n                log_likelihoods[s_name] = log_L_background\n        \n        # Compute log-likelihood ratio\n        Lambda_pi_K = log_likelihoods['pi'] - log_likelihoods['K']\n        results.append(Lambda_pi_K)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}