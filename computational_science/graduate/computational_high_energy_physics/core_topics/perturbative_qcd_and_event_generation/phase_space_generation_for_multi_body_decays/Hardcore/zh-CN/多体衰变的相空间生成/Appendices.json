{
    "hands_on_practices": [
        {
            "introduction": "在我们着手生成相空间之前，我们必须首先理解其数学定义和物理意义。本练习旨在巩固洛伦兹不变相空间（LIPS）测度 $d\\Phi_n$ 的基本概念。通过量纲分析和对最简单的双体衰变情形的直接计算，您将把这一抽象的测度与一个关键的物理可观测量——衰变宽度 $\\Gamma$ 联系起来，从而验证整个形式体系的自洽性。",
            "id": "3528195",
            "problem": "考虑一个质量为 $M$ 的母粒子衰变为 $n$ 个末态粒子，其总四动量为 $P^{\\mu}$。在自然单位制 $\\hbar = c = 1$ 中进行计算。将 $n$ 粒子系统的洛伦兹不变相空间 (LIPS) 测度定义为\n$$\nd\\Phi_{n}(P; p_{1},\\dots,p_{n}) \\equiv (2\\pi)^{4}\\,\\delta^{(4)}\\!\\left(P - \\sum_{i=1}^{n} p_{i}\\right)\\,\\prod_{i=1}^{n}\\frac{d^{3}\\mathbf{p}_{i}}{(2\\pi)^{3}\\,2E_{i}}.\n$$\n从衰变宽度的通用表达式出发，\n$$\n\\Gamma = \\frac{1}{2M}\\int |\\mathcal{M}|^{2}\\, d\\Phi_{n},\n$$\n其中 $|\\mathcal{M}|^{2}$ 是不变矩阵元的平方，请完成以下任务：\n\n1. 在自然单位制中，确定 $d\\Phi_{n}$ 的质量量纲，并推导出为使衰变宽度 $\\Gamma$ 具有正确的质量量纲，$|\\mathcal{M}|^{2}$ 所需的质量量纲。\n2. 在无质量情况下，对一个常数不变矩阵元平方 $|\\mathcal{M}|^{2} = \\text{const}$ 进行计算。具体到在母粒子静止系中衰变为两个无质量末态粒子 ($n=2$) 的情况，通过对整个立体角积分来计算总衰变宽度。证明角分布是各向同性的，并求出用 $M$ 和常数 $|\\mathcal{M}|^{2}$ 表示的总衰变宽度的解析表达式。\n\n最终宽度用自然单位制表示。无需进行数值舍入。",
            "solution": "该问题分为两部分。首先，我们对洛伦兹不变相空间测度 $d\\Phi_{n}$ 和不变矩阵元平方 $|\\mathcal{M}|^{2}$ 进行质量量纲分析。其次，我们计算一个特定情况下的总衰变宽度 $\\Gamma$，即两体衰变为无质量粒子的情况。\n\n**第一部分：量纲分析**\n\n我们在自然单位制 $\\hbar = c = 1$ 中进行计算。在此系统中，质量、能量、动量、长度的倒数和时间的倒数都具有相同的量纲，我们将其记为 $[\\text{质量}]$。\n\n洛伦兹不变相空间 (LIPS) 测度由下式给出：\n$$\nd\\Phi_{n}(P; p_{1},\\dots,p_{n}) = (2\\pi)^{4}\\,\\delta^{(4)}\\!\\left(P - \\sum_{i=1}^{n} p_{i}\\right)\\,\\prod_{i=1}^{n}\\frac{d^{3}\\mathbf{p}_{i}}{(2\\pi)^{3}\\,2E_{i}}\n$$\n为确定其质量量纲，我们来分析每个组成部分。\n- 动量微分 $d^{3}\\mathbf{p}_{i}$ 是动量空间中的一个体积元。由于动量 $\\mathbf{p}_{i}$ 的量纲为 $[\\text{质量}]^{1}$，因此 $d^{3}\\mathbf{p}_{i}$ 的量纲为 $[\\text{质量}]^{3}$。\n- 能量 $E_{i}$ 的量纲为 $[\\text{质量}]^{1}$。\n- 因此，单粒子测度 $\\frac{d^{3}\\mathbf{p}_{i}}{2E_{i}}$ 的量纲为 $\\frac{[\\text{质量}]^{3}}{[\\text{质量}]^{1}} = [\\text{质量}]^{2}$。因子 $2$ 是无量纲的。\n- 对所有 $n$ 个末态粒子的乘积 $\\prod_{i=1}^{n}\\frac{d^{3}\\mathbf{p}_{i}}{(2\\pi)^{3}\\,2E_{i}}$ 的量纲是单粒子测度量纲的 $n$ 次方。因子 $(2\\pi)^{3}$ 是无量纲的。因此，该乘积的量纲是 $([\\text{质量}]^{2})^{n} = [\\text{质量}]^{2n}$。\n- 四维狄拉克δ函数 $\\delta^{(4)}(Q)$ 的自变量 $Q$ 是一个四动量，其量纲为 $[\\text{质量}]^{1}$。δ函数的量纲是其自变量量纲的倒数。这源于性质 $\\int \\delta(x) dx = 1$ (无量纲)。因此，$\\delta^{(4)}(Q)$ 的量纲为 $[\\text{质量}]^{-4}$。\n- 因子 $(2\\pi)^{4}$ 是无量纲的。\n\n综合这些结果，$d\\Phi_{n}$ 的质量量纲为：\n$$\n[d\\Phi_{n}] = [\\text{质量}]^{-4} \\times [\\text{质量}]^{2n} = [\\text{质量}]^{2n-4}\n$$\n现在，我们使用衰变宽度 $\\Gamma$ 的公式来求不变矩阵元平方 $|\\mathcal{M}|^{2}$ 的量纲：\n$$\n\\Gamma = \\frac{1}{2M}\\int |\\mathcal{M}|^{2}\\, d\\Phi_{n}\n$$\n衰变宽度 $\\Gamma$ 是一个速率，对应于时间的倒数。在自然单位制中，时间的量纲为 $[\\text{质量}]^{-1}$，所以 $[\\Gamma] = [\\text{质量}]^{1}$。母粒子的质量 $M$ 的量纲为 $[\\text{质量}]^{1}$。积分号不改变被积函数的量纲。\n量纲关系为：\n$$\n[\\Gamma] = [M]^{-1} \\times [|\\mathcal{M}|^{2}] \\times [d\\Phi_{n}]\n$$\n代入已知量纲：\n$$\n[\\text{质量}]^{1} = [\\text{质量}]^{-1} \\times [|\\mathcal{M}|^{2}] \\times [\\text{质量}]^{2n-4}\n$$\n$$\n[\\text{质量}]^{1} = [|\\mathcal{M}|^{2}] \\times [\\text{质量}]^{2n-5}\n$$\n解出 $|\\mathcal{M}|^{2}$ 的量纲：\n$$\n[|\\mathcal{M}|^{2}] = \\frac{[\\text{质量}]^{1}}{[\\text{质量}]^{2n-5}} = [\\text{质量}]^{1-(2n-5)} = [\\text{质量}]^{6-2n}\n$$\n\n**第二部分：两体衰变计算**\n\n我们现在具体研究质量为 $M$ 的母粒子衰变为 $n=2$ 个无质量末态粒子 ($m_1 = m_2 = 0$) 的情况。我们假设不变矩阵元平方 $|\\mathcal{M}|^2$ 是一个常数。计算在母粒子的静止系中进行，其中其四动量为 $P^{\\mu} = (M, \\mathbf{0})$。\n\n对于 $n=2$ 的情况，LIPS 测度为：\n$$\nd\\Phi_{2} = (2\\pi)^{4}\\,\\delta^{(4)}(P - p_{1} - p_{2})\\,\\frac{d^{3}\\mathbf{p}_{1}}{(2\\pi)^{3}\\,2E_{1}}\\frac{d^{3}\\mathbf{p}_{2}}{(2\\pi)^{3}\\,2E_{2}} = \\frac{1}{4(2\\pi)^{2}}\\,\\delta^{(4)}(P - p_{1} - p_{2})\\,\\frac{d^{3}\\mathbf{p}_{1}}{E_{1}}\\frac{d^{3}\\mathbf{p}_{2}}{E_{2}}\n$$\n我们利用 delta 函数的动量部分 $\\delta^{(3)}(\\mathbf{0} - \\mathbf{p}_{1} - \\mathbf{p}_{2})$ 对第二个粒子的动量 $\\mathbf{p}_{2}$ 进行积分。此积分使得 $\\mathbf{p}_{2} = -\\mathbf{p}_{1}$。\nLIPS 表达式变为：\n$$\nd\\Phi_{2} = \\frac{1}{16\\pi^{2}}\\int \\frac{d^{3}\\mathbf{p}_{1}}{E_{1}E_{2}} \\delta(M-E_{1}-E_{2}) \\bigg|_{\\mathbf{p}_{2}=-\\mathbf{p}_{1}}\n$$\n由于末态粒子是无质量的，它们的能量-动量关系为 $E_i=|\\mathbf{p}_i|$。由于 $\\mathbf{p}_{2} = -\\mathbf{p}_{1}$，我们有 $E_{2} = |\\mathbf{p}_{2}| = |-\\mathbf{p}_{1}| = |\\mathbf{p}_{1}| = E_{1}$。我们把共同的能量记为 $E \\equiv E_1 = E_2$，动量大小记为 $p \\equiv |\\mathbf{p}_1| = |\\mathbf{p}_2|$，因此 $E=p$。能量守恒的 delta 函数变为 $\\delta(M-2E)$。相空间测度简化为：\n$$\nd\\Phi_{2} = \\frac{1}{16\\pi^{2}} \\frac{d^{3}\\mathbf{p}_{1}}{E^{2}} \\delta(M-2E)\n$$\n为了继续对 $\\mathbf{p}_{1}$ 进行积分，我们切换到动量空间中的球坐标：$d^{3}\\mathbf{p}_{1} = p^{2}dp\\,d\\Omega = E^{2}dE\\,d\\Omega$，其中 $d\\Omega = \\sin\\theta\\,d\\theta\\,d\\phi$ 是立体角元。\n将此代入 $d\\Phi_{2}$ 的表达式中：\n$$\nd\\Phi_{2} = \\frac{1}{16\\pi^{2}} \\frac{E^{2}dE\\,d\\Omega}{E^{2}} \\delta(M-2E) = \\frac{1}{16\\pi^{2}} \\delta(M-2E) dE\\,d\\Omega\n$$\n衰变宽度为 $\\Gamma = \\frac{1}{2M}\\int |\\mathcal{M}|^{2}\\,d\\Phi_{2}$。由于 $|\\mathcal{M}|^{2}$ 是常数，我们可以写出关于立体角 $d\\Omega$ 和能量 $dE$ 的微分衰变宽度：\n$$\n\\frac{d^{2}\\Gamma}{dE\\,d\\Omega} = \\frac{|\\mathcal{M}|^{2}}{2M} \\frac{1}{16\\pi^{2}} \\delta(M-2E)\n$$\n为了求得角分布 $\\frac{d\\Gamma}{d\\Omega}$，我们对能量 $E$ 进行积分：\n$$\n\\frac{d\\Gamma}{d\\Omega} = \\int_{0}^{\\infty} \\frac{d^{2}\\Gamma}{dE\\,d\\Omega} dE = \\frac{|\\mathcal{M}|^{2}}{32\\pi^{2}M} \\int_{0}^{\\infty} \\delta(M-2E) dE\n$$\n使用狄拉克δ函数的性质 $\\int \\delta(g(x))dx = \\sum_i \\frac{1}{|g'(x_i)|}$，其中 $x_i$ 是 $g(x)$ 的根，我们有 $g(E)=M-2E$，其在 $E=M/2$ 处有一个单根。其导数为 $g'(E)=-2$。所以，$\\int_{0}^{\\infty} \\delta(M-2E) dE = \\frac{1}{|-2|} = \\frac{1}{2}$。\n于是微分衰变宽度为：\n$$\n\\frac{d\\Gamma}{d\\Omega} = \\frac{|\\mathcal{M}|^{2}}{32\\pi^{2}M} \\left(\\frac{1}{2}\\right) = \\frac{|\\mathcal{M}|^{2}}{64\\pi^{2}M}\n$$\n由于该表达式与角变量 $\\theta$ 和 $\\phi$ 无关，所以该衰变是各向同性的。\n\n为了求得总衰变宽度 $\\Gamma$，我们将微分宽度对整个立体角进行积分：\n$$\n\\Gamma = \\int \\frac{d\\Gamma}{d\\Omega} d\\Omega = \\int \\frac{|\\mathcal{M}|^{2}}{64\\pi^{2}M} d\\Omega\n$$\n对整个立体角的积分为 $\\int d\\Omega = 4\\pi$。\n$$\n\\Gamma = \\frac{|\\mathcal{M}|^{2}}{64\\pi^{2}M} (4\\pi) = \\frac{|\\mathcal{M}|^{2}}{16\\pi M}\n$$\n这就是总衰变宽度的最终解析表达式。",
            "answer": "$$\\boxed{\\frac{|\\mathcal{M}|^2}{16 \\pi M}}$$"
        },
        {
            "introduction": "直接为包含三个或更多粒子的末态生成事件是复杂的，一个强大的计算技术是将多体衰变分解为一系列连续的两体衰变。本练习聚焦于该方法的核心问题：如何确定这个衰变链中中间虚粒子的运动学允许质量范围。您将运用 Källén 函数 $\\lambda$ 这一优雅的工具，从第一性原理出发，推导出一个子系统不变质量的积分边界，这是所有递归相空间生成算法的理论基石。",
            "id": "3528144",
            "problem": "考虑一个质量为 $M$ 的母粒子衰变为三个质量分别为 $m_{1}$、$m_{2}$ 和 $m_{3}$ 的子粒子。将子粒子的四动量记为 $p_{1}$、$p_{2}$ 和 $p_{3}$，其中 $p_{i}^{2} = m_{i}^{2}$，并将 $(1,2)$ 子系统的不变质量平方定义为 $s_{12} \\equiv (p_{1} + p_{2})^{2}$。在度规符号为 $(+,-,-,-)$ 的度规下，并在母粒子的静止系中进行计算，其中 $p_{\\text{parent}}^{\\mu} = (M, \\mathbf{0})$。假设 $M \\ge m_{1} + m_{2} + m_{3}$，因此该衰变在运动学上是允许的。\n\n在计算高能物理中，三体衰变的相空间生成通常通过将三体相空间因子分解为两个连续的两体相空间来进行。其中，一个不变质量为 $\\sqrt{s_{12}}$ 的中间有效粒子反冲粒子3，然后衰变为粒子1和粒子2。为了使这种因子分解在运动学上有效，两个两体子过程中的质心系 (CM) 动量都必须是实数。这个要求由 Källén 函数的非负性来体现，\n$$\\lambda(x,y,z) \\equiv x^{2} + y^{2} + z^{2} - 2xy - 2xz - 2yz,$$\n并应用于每个子过程：\n$$\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0 \\quad \\text{和} \\quad \\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0.$$\n\n仅从能量动量守恒、Källén 函数的定义以及两体运动学中质心系动量为实数的物理要求出发，确定能同时满足这两个不等式的 $s_{12}$ 的允许积分区间。请用仅包含 $M$、$m_{1}$、$m_{2}$ 和 $m_{3}$ 的闭式解析表达式表示您的最终答案。不需要进行数值计算。请提供 $s_{12}$ 的下限和上限作为最终答案。",
            "solution": "我们首先回顾两体运动学以及 Källén 函数如何控制质心系动量的实数性。对于一个总不变质量平方为 $s$、衰变为质量为 $m_{a}$ 和 $m_{b}$ 的粒子的两体系统，其在质心 (CM) 系中的三动量大小为\n$$\nk(s; m_{a}, m_{b}) = \\frac{\\sqrt{\\lambda(s, m_{a}^{2}, m_{b}^{2})}}{2\\sqrt{s}}.\n$$\n质心系动量为实数的充要条件是 $\\lambda(s, m_{a}^{2}, m_{b}^{2}) \\ge 0$。该条件体现了相对论运动学中的三角不等式。\n\n对于三体衰变 $M \\to 1\\,2\\,3$，我们将运动学因子分解为两个连续的两体子系统：\n1. 在母粒子静止系中，不变质量为 $\\sqrt{s_{12}}$ 的有效粒子反冲粒子3。相应的质心系动量为实数的充要条件是\n$$\n\\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0.\n$$\n2. 在 $(1,2)$ 子系统的静止系中，质量为 $\\sqrt{s_{12}}$ 的有效粒子衰变为粒子1和粒子2。相应的质心系动量为实数的充要条件是\n$$\n\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0.\n$$\n\n我们现在分析每个不等式对 $s_{12}$ 的影响。\n\n首先，考虑 $\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0$。利用恒等式\n$$\n\\lambda(s, m_{1}^{2}, m_{2}^{2}) = \\left(s - (m_{1} + m_{2})^{2}\\right)\\left(s - (m_{1} - m_{2})^{2}\\right),\n$$\n不等式 $\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0$ 意味着\n$$\ns_{12} \\le (m_{1} - m_{2})^{2} \\quad \\text{或} \\quad s_{12} \\ge (m_{1} + m_{2})^{2}。\n$$\n物理上，由两个具有正能量的在壳粒子组成的两粒子系统的不变质量必须满足 $\\sqrt{s_{12}} \\ge m_{1} + m_{2}$；分支 $s_{12} \\le (m_{1} - m_{2})^{2}$ 对应于具有正能量的在壳衰变产物的类空或非物理构型，在衰变运动学中被排除。因此，来自 $(1,2)$ 衰变的物理约束是\n$$\ns_{12} \\ge (m_{1} + m_{2})^{2}.\n$$\n\n其次，考虑 $\\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0$。利用类似的因子分解，\n$$\n\\lambda(M^{2}, s_{12}, m_{3}^{2}) = \\left(M^{2} - \\left(\\sqrt{s_{12}} + m_{3}\\right)^{2}\\right)\\left(M^{2} - \\left(\\sqrt{s_{12}} - m_{3}\\right)^{2}\\right),\n$$\n该不等式意味着\n$$\ns_{12} \\le (M - m_{3})^{2} \\quad \\text{或} \\quad s_{12} \\ge (M + m_{3})^{2}。\n$$\n分支 $s_{12} \\ge (M + m_{3})^{2}$ 与母粒子质量为 $M$ 的衰变中的能量动量守恒不相容，因为它要求 $(1,2)$ 子系统的不变质量至少比母粒子质量大 $m_{3}$。因此，在母粒子静止系中，来自粒子3反冲 $(1,2)$ 集团的物理约束是\n$$\ns_{12} \\le (M - m_{3})^{2}.\n$$\n\n结合这两个物理约束，确保两个子过程中质心系动量均为实数的 $s_{12}$ 的允许区间是\n$$\n(m_{1} + m_{2})^{2} \\le s_{12} \\le (M - m_{3})^{2}.\n$$\n这个区间非空的条件恰好是 $M \\ge m_{1} + m_{2} + m_{3}$，这正是假设的衰变在运动学上允许的条件。因此，在因子分解的三体相空间中，$s_{12}$ 的积分限由下限 $(m_{1} + m_{2})^{2}$ 和上限 $(M - m_{3})^{2}$ 给出。",
            "answer": "$$\\boxed{[(m_{1}+m_{2})^{2}, (M-m_{3})^{2}]}$$"
        },
        {
            "introduction": "这个最终的练习将前面的概念融会贯通，构建一个完整、可工作的科学计算程序，是连接理论运动学与实用计算物理学的顶石项目。您将基于顺序两体衰变模型实现一个递归事件生成器，在母粒子静止系中生成事件，并应用洛伦兹变换将其转换到任意实验室参考系。此过程不仅能让您掌握事件生成的实际操作，还将通过对雅可比行列式的数值验证，加深对相空间测度洛伦兹不变性的理解。",
            "id": "3528153",
            "problem": "你的任务是为计算高能物理领域实现、验证和测试一个洛伦兹协变的多体衰变事件生成器。其基本依据是闵可夫斯基线元在洛伦兹变换下的不变性、质量壳关系以及洛伦兹不变相空间测度的定义。请完全在自然单位制中进行操作，其中光速等于1，所有能量和质量以吉电子伏特（$\\mathrm{GeV}$）表示，所有角度以弧度表示。\n\n从以下基本事实出发：\n- 符号为 $\\left(+,-,-,-\\right)$ 的闵可夫斯基度规在正常原时洛伦兹变换下保持不变。\n- 一个静止的有质量母粒子的四维动量为 $P^{\\mu} = \\left(M, 0, 0, 0\\right)$，其中 $M$ 是母粒子的质量，单位为 $\\mathrm{GeV}$。\n- 一个质量为 $m_i$ 的末态粒子满足 $p_i^{\\mu} p_{i\\mu} = m_i^2$，其中 $p_i^0 = E_i = \\sqrt{m_i^2 + \\boldsymbol{p}_i^2}$。\n- $n$ 体洛伦兹不变相空间测度为\n$$\nd\\Phi_n\\left(P; m_1,\\dots,m_n\\right) = (2\\pi)^4 \\,\\delta^{(4)}\\!\\left(P - \\sum_{i=1}^n p_i\\right)\\,\\prod_{i=1}^n \\frac{d^3 \\boldsymbol{p}_i}{(2\\pi)^3\\,2 E_i}.\n$$\n\n你的任务是：\n1. 推导洛伦兹变换，该变换将任意四维矢量从母粒子静止系映射到实验室系。在实验室系中，母粒子的四维速度为 $u^{\\mu}$，满足 $u^{\\mu} u_{\\mu} = 1$。请用三维速度 $\\boldsymbol{\\beta}$ 和洛伦兹因子 $\\gamma$ 来表示此变换，其中 $u^{\\mu} = \\left(\\gamma, \\gamma \\boldsymbol{\\beta}\\right)$ 且 $\\gamma = 1/\\sqrt{1-\\boldsymbol{\\beta}^2}$。最终的映射应能将母粒子静止系中的任意四维矢量 $p^{\\mu} = \\left(E, \\boldsymbol{p}\\right)$ 转换为实验室系中的 $p'^{\\mu}$。\n2. 基于同样的基础，证明在固定的洛伦兹变换下，每个粒子的空间动量雅可比行列式满足\n$$\n\\det\\!\\left(\\frac{\\partial \\boldsymbol{p}'}{\\partial \\boldsymbol{p}}\\right) = \\frac{E'}{E},\n$$\n并以此得出结论：相空间元中的每个因子 $d^3\\boldsymbol{p}_i / E_i$ 在该变换下是不变的，因此 $d\\Phi_n$ 也是不变的。\n3. 在母粒子静止系中，为一个衰变为具有给定质量 $m_1,\\dots,m_n$ 的子粒子的 $n$ 体衰变，实现一个确定性的事件生成器。使用一系列二体衰变来递归处理，其中角度以弧度为单位且各向同性，中间质量在运动学上是允许的。你的生成器必须在母粒子静止系中精确地保持四维动量守恒，并为所有子粒子生成有效的在壳四维矢量。对于一个母粒子质量为 $m_0$、衰变为质量为 $m_a$ 和 $m_b$ 的二体衰变，使用相对论二体运动学，通过 Källén 函数确定在母粒子静止系中的共同三维动量大小 $p^\\ast$，并确保 $p^\\ast \\ge 0$。\n4. 对于给定的母粒子四维速度 $u^{\\mu}$，将你推导出的洛伦兹变换应用于生成的末态四维矢量，以获得实验室系中的四维矢量，并数值验证：\n   - 总四维动量按要求进行变换，使得变换后的子粒子四维矢量之和等于 $M u^{\\mu}$。\n   - 对于每个子粒子，雅可比恒等式 $\\det(\\partial \\boldsymbol{p}'/\\partial \\boldsymbol{p}) = E'/E$ 在固定的绝对公差范围内成立。\n5. 你的程序应运行以下参数集的测试套件，并为每个测试用例报告所有检查是否通过，结果为单个布尔值：\n   - 测试 1（二体，中等 boost）：$M = 5.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[1.0, 1.0\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(1.25, 0.75, 0.0, 0.0\\right)$。\n   - 测试 2（三体，斜向 boost）：$M = 10.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[2.0, 1.0, 0.5\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(1.6666666666666667, 0.4444444444444444, 0.8888888888888888, 0.8888888888888888\\right)$。\n   - 测试 3（四体，单位 boost）：$M = 6.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[0.5, 0.5, 0.5, 0.5\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(1.0, 0.0, 0.0, 0.0\\right)$。\n   - 测试 4（三体，超相对论性 boost，含无质量子粒子）：$M = 3.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[0.0, 0.5, 0.3\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(7.088812050083354, 0.0, 0.0, 7.01792392958252\\right)$。\n\n数值和单位要求：\n- 使用自然单位制，能量和质量单位为 $\\mathrm{GeV}$，角度单位为弧度。\n- 对所有涉及浮点计算的相等性检查，使用 $10^{-8}$ 的绝对公差。\n- 每个测试用例使用固定的伪随机数生成器种子，以获得确定的各向同性角度，从而使输出可重复。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含四个测试用例的结果，形式为一个用方括号括起来的逗号分隔的布尔值列表，例如 $\\left[\\text{True},\\text{False},\\text{True},\\text{True}\\right]$。确切要求的格式是：包含 Python 列表字面量语法的单行文本，例如 `[True,False,True,True]`。",
            "solution": "该问题提出了计算高能物理领域的一项综合任务：推导、实现并验证一个洛伦兹协变的多体衰变事件生成器。问题陈述具有科学依据，提法明确且客观。它完全基于狭义相对论的原理，使用了四维矢量、闵可夫斯基度规、洛伦兹变换和洛伦兹不变相空间测度等标准定义和形式体系。为测试用例提供的参数在运动学上是允许且一致的。因此，该问题是有效的，下面给出了完整的解答。\n\n**1. 洛伦兹变换的推导**\n\n我们的任务是找到一个变换，它能将一个四维矢量 $p^{\\mu} = (E, \\boldsymbol{p})$ 从母粒子静止系映射到实验室系，其中母粒子的四维速度为 $u^{\\mu} = (\\gamma, \\gamma\\boldsymbol{\\beta})$。设静止系为 $S$，实验室系为 $S'$。母粒子在 $S$ 系中静止，在 $S'$ 系中以三维速度 $\\boldsymbol{\\beta}$ 运动。因此，$S$ 系相对于 $S'$ 系以速度 $-\\boldsymbol{\\beta}$ 运动。从 $S$ 到 $S'$ 的变换因此是一个速度为 $+\\boldsymbol{\\beta}$ 的洛伦兹变换。\n\n一个通用的洛伦兹变换由矩阵 $\\Lambda(\\boldsymbol{\\beta})$ 描述。$S$ 系中的一个四维矢量 $p^{\\mu}$ 通过 $p'^{\\mu} = \\Lambda^{\\mu}_{\\ \\nu} p^{\\nu}$ 变换到 $S'$ 系中的 $p'^{\\mu}$。变换矩阵 $\\Lambda(\\boldsymbol{\\beta})$ 的分量为：\n$$\n\\begin{align*}\n\\Lambda^{0}_{\\ 0} = \\gamma \\\\\n\\Lambda^{i}_{\\ 0} = \\Lambda^{0}_{\\ i} = \\gamma \\beta^i \\\\\n\\Lambda^{i}_{\\ j} = \\delta_{ij} + (\\gamma-1) \\frac{\\beta^i \\beta^j}{\\boldsymbol{\\beta}^2}\n\\end{align*}\n$$\n其中 $\\gamma = 1/\\sqrt{1-\\boldsymbol{\\beta}^2}$ 是洛伦兹因子，$\\beta^i$ 是三维速度 $\\boldsymbol{\\beta}$ 的分量，$\\delta_{ij}$ 是克罗内克 δ。母粒子的四维速度 $u^{\\mu}$ 定义为 $(\\gamma, \\gamma\\boldsymbol{\\beta})$，这直接提供了变换参数 $\\gamma = u^0$ 和 $\\boldsymbol{\\beta} = \\boldsymbol{u}/u^0$，其中 $\\boldsymbol{u}$ 是 $u^\\mu$ 的空间部分。\n\n将此变换应用于 $p^{\\mu} = (E, p^1, p^2, p^3) = (E, \\boldsymbol{p})$，我们得到变换后的四维矢量 $p'^{\\mu} = (E', \\boldsymbol{p}')$ 的分量：\n\n时间分量 $E' = p'^0$：\n$$\nE' = \\Lambda^{0}_{\\ \\nu} p^{\\nu} = \\Lambda^{0}_{\\ 0} p^0 + \\sum_{j=1}^3 \\Lambda^{0}_{\\ j} p^j = \\gamma E + \\sum_{j=1}^3 \\gamma \\beta^j p^j = \\gamma (E + \\boldsymbol{\\beta} \\cdot \\boldsymbol{p})\n$$\n\n空间分量 $p'^i$：\n$$\np'^i = \\Lambda^{i}_{\\ \\nu} p^{\\nu} = \\Lambda^{i}_{\\ 0} p^0 + \\sum_{j=1}^3 \\Lambda^{i}_{\\ j} p^j = \\gamma \\beta^i E + \\sum_{j=1}^3 \\left(\\delta_{ij} + (\\gamma-1) \\frac{\\beta^i \\beta^j}{\\boldsymbol{\\beta}^2}\\right) p^j\n$$\n用矢量符号表示，这变成：\n$$\n\\boldsymbol{p}' = \\gamma E \\boldsymbol{\\beta} + \\boldsymbol{p} + (\\gamma-1) \\frac{\\boldsymbol{\\beta} (\\boldsymbol{\\beta} \\cdot \\boldsymbol{p})}{\\boldsymbol{\\beta}^2} = \\boldsymbol{p} + \\gamma E \\boldsymbol{\\beta} + (\\gamma-1) \\frac{(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})}{\\boldsymbol{\\beta}^2} \\boldsymbol{\\beta}\n$$\n这些方程表示了从母粒子静止系到实验室系的任意四维矢量的完整变换。\n\n**2. 雅可比行列式与相空间元的不变性**\n\n我们被要求证明空间动量变换的雅可比行列式为 $\\det(\\partial \\boldsymbol{p}'/\\partial \\boldsymbol{p}) = E'/E$。该变换为 $\\boldsymbol{p}'(\\boldsymbol{p}) = \\boldsymbol{p} + \\gamma E(\\boldsymbol{p}) \\boldsymbol{\\beta} + (\\gamma-1) \\frac{(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})}{\\boldsymbol{\\beta}^2} \\boldsymbol{\\beta}$，其中能量 $E$ 通过在壳关系 $E = \\sqrt{m^2 + \\boldsymbol{p}^2}$ 是 $\\boldsymbol{p}$ 的函数。能量 $E$ 对动量分量 $p_j$ 的偏导数为 $\\partial E / \\partial p_j = p_j/E$。\n\n雅可比矩阵 $J$ 的元素为 $J_{ij} = \\partial p'_i / \\partial p_j$：\n$$\nJ_{ij} = \\frac{\\partial p'_i}{\\partial p_j} = \\delta_{ij} + \\gamma \\beta_i \\frac{\\partial E}{\\partial p_j} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2} \\beta_i \\frac{\\partial}{\\partial p_j}(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})\n$$\n$$\nJ_{ij} = \\delta_{ij} + \\gamma \\beta_i \\frac{p_j}{E} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2} \\beta_i \\beta_j\n$$\n这可以用张量积表示法写成 $J = I + \\boldsymbol{\\beta} \\otimes \\left( \\frac{\\gamma}{E}\\boldsymbol{p} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}\\boldsymbol{\\beta} \\right)^T$。利用矩阵行列式引理 $\\det(I + \\boldsymbol{a}\\boldsymbol{b}^T) = 1 + \\boldsymbol{b}^T \\boldsymbol{a} = 1 + \\boldsymbol{a} \\cdot \\boldsymbol{b}$，我们有：\n$$\n\\det(J) = 1 + \\boldsymbol{\\beta} \\cdot \\left( \\frac{\\gamma}{E}\\boldsymbol{p} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}\\boldsymbol{\\beta} \\right) = 1 + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{\\beta})\n$$\n$$\n\\det(J) = 1 + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) + \\gamma - 1 = \\gamma + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) = \\frac{\\gamma E + \\gamma(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p})}{E}\n$$\n分子正是变换后能量 $E'$ 的表达式。因此，我们证明了恒等式：\n$$\n\\det\\left(\\frac{\\partial \\boldsymbol{p}'}{\\partial \\boldsymbol{p}}\\right) = \\frac{E'}{E}\n$$\n三维动量空间的体积元变换为 $d^3\\boldsymbol{p}' = |\\det(J)| d^3\\boldsymbol{p} = (E'/E) d^3\\boldsymbol{p}$，因为能量是正的。重新整理这个关系，我们发现：\n$$\n\\frac{d^3\\boldsymbol{p}'}{E'} = \\frac{d^3\\boldsymbol{p}}{E}\n$$\n这表明每个粒子的测度 $d^3\\boldsymbol{p}/E$ 是洛伦兹不变的。由于完整的相空间测度 $d\\Phi_n$ 是这些项和洛伦兹不变的 delta 函数 $\\delta^{(4)}(P - \\sum p_i)$ 的乘积，所以 $d\\Phi_n$ 本身也是洛伦兹不变的。\n\n**3. 确定性事件生成器算法**\n\n为了在母粒子静止系中生成 $n$ 体衰变 $M \\to m_1 + \\dots + m_n$，我们采用一种递归算法，将该过程建模为一系列连续的二体衰变：$M \\to V_{n-1} + m_n$，然后 $V_{n-1} \\to V_{n-2} + m_{n-1}$，依此类推，直到最后的二体衰变 $V_2 \\to m_1 + m_2$。这里，$V_k$ 是一个虚中间粒子，代表前 $k$ 个末态粒子系统的不变质量。\n\n该算法的核心是一个处理二体衰变 $m_0 \\to m_a + m_b$ 的函数。在 $m_0$ 的静止系中，运动学决定了两个子粒子以大小相等、方向相反的动量 $p^*$ 背对背产生。该动量由 Källén 函数 $\\lambda(x, y, z) = x^2+y^2+z^2-2xy-2yz-2zx$ 给出：\n$$\np^* = \\frac{\\sqrt{\\lambda(m_0^2, m_a^2, m_b^2)}}{2m_0}\n$$\n如果 $m_0 > m_a + m_b$，则衰变在运动学上是允许的，这确保了 $p^* > 0$。出射方向是各向同性的，意味着它在 $4\\pi$ 的立体角上均匀分布。我们使用从确定性伪随机数中抽样的极角 $\\theta$ 和方位角 $\\phi$ 来生成这个方向：$\\cos\\theta$ 在 $[-1, 1]$ 上均匀分布，$\\phi$ 在 $[0, 2\\pi]$ 上均匀分布。产生的三维动量为 $\\boldsymbol{p}_a = p^*\\hat{n}$ 和 $\\boldsymbol{p}_b = -p^*\\hat{n}$，其中 $\\hat{n}$ 是所选方向的单位矢量。能量则为 $E_a = \\sqrt{m_a^2+(p^*)^2}$ 和 $E_b = \\sqrt{m_b^2+(p^*)^2}$。\n\n对于从 $n$ 到 $n-1$ 个粒子的递归步骤，我们考虑衰变 $M \\to V_{n-1} + m_n$。虚粒子的质量 $m_{V_{n-1}}$ 不是固定的。它必须位于运动学允许的范围 $[\\sum_{i=1}^{n-1} m_i, M - m_n]$ 内。为了确保对可用相空间进行确定性且有代表性的抽样，我们根据一个伪随机数 $r \\in [0, 1]$，通过在其允许范围内进行线性插值来选择平方质量 $m_{V_{n-1}}^2$：\n$$\nm_{V_{n-1}}^2 = \\left(\\sum_{i=1}^{n-1} m_i\\right)^2 + r \\cdot \\left((M - m_n)^2 - \\left(\\sum_{i=1}^{n-1} m_i\\right)^2\\right)\n$$\n在确定 $m_{V_{n-1}}$ 之后，我们在母粒子静止系中进行 $M$ 到 $V_{n-1}$ 和 $m_n$ 的二体衰变。这会得到它们的四维动量。然后，构成 $V_{n-1}$ 的 $n-1$ 个粒子通过对同一函数的递归调用来生成，其中 $m_{V_{n-1}}$ 作为新的母粒子质量。这 $n-1$ 个子粒子在 $V_{n-1}$ 的静止系中生成，并且必须使用 $V_{n-1}$ 的速度 $\\boldsymbol{\\beta}_V = \\boldsymbol{p}_{V_{n-1}}/E_{V_{n-1}}$ 将它们变换到原始的母粒子静止系中。最终的输出是所有 $n$ 个变换后四维矢量的集合。\n\n**4. 验证程序**\n\n对每个测试用例，实现的生成器将根据几个标准进行验证：\n1.  **静止系动量守恒**：在母粒子静止系中，所有生成的末态粒子的四维动量之和 $\\sum p_i^{\\mu}$ 必须在数值公差 $10^{-8}$ 内等于母粒子的四维动量 $P^{\\mu} = (M, 0, 0, 0)$。\n2.  **实验室系动量守恒**：将四维动量 $p_i^{\\mu}$ 变换到实验室系以获得 $p'^{\\mu}_i$。这些变换后的四维矢量之和 $\\sum p'^{\\mu}_i$ 必须在相同公差内等于母粒子在实验室系中的四维动量 $P'^{\\mu} = M u^{\\mu}$。\n3.  **雅可比恒等式**：对于每个子粒子 $i$，我们数值计算 $3 \\times 3$ 的雅可比矩阵 $J_i = \\partial \\boldsymbol{p}'_i/\\partial \\boldsymbol{p}_i$。然后将其行列式 $\\det(J_i)$ 与实验室系能量与静止系能量之比 $E'_i/E_i$ 进行比较。对于所有子粒子，该等式必须在指定的公差范围内成立。\n\n只有当所有这三项检查都满足时，一个测试用例才被视为通过（`True`）。如果任何检查对任何粒子失败，整个测试用例将被标记为`False`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Set the absolute tolerance for all floating-point comparisons.\nTOLERANCE = 1e-8\n\ndef kallen(x_sq, y_sq, z_sq):\n    \"\"\"\n    Computes the Källén function lambda(x^2, y^2, z^2).\n    This form is more numerically stable than the one with square roots.\n    \"\"\"\n    return (x_sq - y_sq - z_sq)**2 - 4 * y_sq * z_sq\n\ndef boost(p4, beta_vec):\n    \"\"\"\n    Performs a Lorentz boost on a four-vector p4.\n    \n    Args:\n        p4 (np.ndarray): The four-vector (E, px, py, pz).\n        beta_vec (np.ndarray): The 3-velocity vector for the boost.\n\n    Returns:\n        np.ndarray: The boosted four-vector.\n    \"\"\"\n    beta_sq = np.dot(beta_vec, beta_vec)\n    if beta_sq  TOLERANCE**2:\n        return p4\n        \n    gamma = 1.0 / np.sqrt(1.0 - beta_sq)\n    E = p4[0]\n    p_vec = p4[1:]\n    \n    beta_dot_p = np.dot(beta_vec, p_vec)\n    \n    E_prime = gamma * (E + beta_dot_p)\n    p_prime_vec = p_vec + gamma * E * beta_vec + (gamma - 1.0) * beta_dot_p / beta_sq * beta_vec\n    \n    return np.array([E_prime, p_prime_vec[0], p_prime_vec[1], p_prime_vec[2]])\n\ndef generate_decay_products(parent_mass, daughter_masses, rng):\n    \"\"\"\n    Recursively generates four-vectors for an n-body decay in the parent rest frame.\n\n    Args:\n        parent_mass (float): Mass of the decaying parent particle.\n        daughter_masses (list[float]): List of masses of the final-state particles.\n        rng (np.random.Generator): A seeded random number generator.\n\n    Returns:\n        list[np.ndarray]: A list of the final-state particles' four-vectors.\n    \"\"\"\n    n = len(daughter_masses)\n    \n    if n == 1:\n        return [np.array([parent_mass, 0.0, 0.0, 0.0])]\n\n    # Recursive step: M -> V + m_n, where V decays to the first n-1 particles.\n    head_masses = daughter_masses[:-1]\n    tail_mass = daughter_masses[-1]\n    \n    # Determine the kinematically allowed range for the virtual particle's mass.\n    m_head_min = sum(head_masses)\n    m_head_max = parent_mass - tail_mass\n    \n    # Generate the virtual mass by sampling its square uniformly.\n    r = rng.random()\n    m_head_sq = m_head_min**2 + r * (m_head_max**2 - m_head_min**2)\n    m_head = np.sqrt(m_head_sq)\n\n    # Perform the two-body decay of the parent into the virtual particle and the last daughter.\n    p_star_sq = kallen(parent_mass**2, m_head**2, tail_mass**2) / (4 * parent_mass**2)\n    p_star_mag = np.sqrt(p_star_sq)\n    \n    # Generate an isotropic direction for the decay products.\n    costh = 2.0 * rng.random() - 1.0\n    sinth = np.sqrt(1.0 - costh**2)\n    phi = 2.0 * np.pi * rng.random()\n    \n    p_star_vec = p_star_mag * np.array([sinth * np.cos(phi), sinth * np.sin(phi), costh])\n    \n    # Calculate four-vectors for the virtual particle and the tail daughter.\n    E_head = np.sqrt(m_head**2 + p_star_mag**2)\n    E_tail = np.sqrt(tail_mass**2 + p_star_mag**2)\n    \n    p4_head_in_parent_frame = np.array([E_head, *p_star_vec])\n    p4_tail_in_parent_frame = np.array([E_tail, *-p_star_vec])\n    \n    # Recursively generate decay products for the virtual particle in its own rest frame.\n    daughters_in_head_frame = generate_decay_products(m_head, head_masses, rng)\n    \n    # Boost these products from the virtual particle's rest frame to the parent's rest frame.\n    beta_vec_boost = p_star_vec / E_head\n    boosted_daughters = [boost(p4, beta_vec_boost) for p4 in daughters_in_head_frame]\n    \n    return boosted_daughters + [p4_tail_in_parent_frame]\n\ndef calculate_jacobian(p4_rest, beta_vec):\n    \"\"\"\n    Calculates the 3x3 Jacobian matrix of the momentum transformation.\n    \"\"\"\n    beta_sq = np.dot(beta_vec, beta_vec)\n    if beta_sq  TOLERANCE**2:\n        return np.identity(3)\n\n    gamma = 1.0 / np.sqrt(1.0 - beta_sq)\n    E_rest = p4_rest[0]\n    p_rest_vec = p4_rest[1:]\n\n    # J_ij = delta_ij + (gamma * p_j / E) * beta_i + ((gamma-1)/beta^2) * beta_i * beta_j\n    term2 = np.outer(beta_vec, (gamma / E_rest) * p_rest_vec)\n    term3 = ((gamma - 1.0) / beta_sq) * np.outer(beta_vec, beta_vec)\n    \n    return np.identity(3) + term2 + term3\n\ndef solve():\n    test_cases = [\n        # Test 1 (two-body, moderate boost)\n        {'M': 5.0, 'masses': [1.0, 1.0], 'u_lab': np.array([1.25, 0.75, 0.0, 0.0])},\n        # Test 2 (three-body, oblique boost)\n        {'M': 10.0, 'masses': [2.0, 1.0, 0.5], 'u_lab': np.array([1.6666666666666667, 0.4444444444444444, 0.8888888888888888, 0.8888888888888888])},\n        # Test 3 (four-body, identity boost)\n        {'M': 6.0, 'masses': [0.5, 0.5, 0.5, 0.5], 'u_lab': np.array([1.0, 0.0, 0.0, 0.0])},\n        # Test 4 (three-body, ultra-relativistic boost with a massless daughter)\n        {'M': 3.0, 'masses': [0.0, 0.5, 0.3], 'u_lab': np.array([7.088812050083354, 0.0, 0.0, 7.01792392958252])}\n    ]\n\n    results = []\n    for i, case in enumerate(test_cases):\n        M, masses, u_lab = case['M'], case['masses'], case['u_lab']\n        \n        # Use a deterministic seed for each test case for reproducibility.\n        rng = np.random.default_rng(seed=i)\n        \n        case_passed = True\n        \n        # Pre-check kinematics\n        if M = sum(masses):\n            results.append(False)\n            continue\n            \n        # 1. Generate decay products in the parent rest frame.\n        rest_frame_p4s = generate_decay_products(M, masses, rng)\n        \n        # 2. Verify momentum conservation in the rest frame.\n        total_p4_rest = np.sum(rest_frame_p4s, axis=0)\n        expected_p4_rest = np.array([M, 0.0, 0.0, 0.0])\n        if not np.allclose(total_p4_rest, expected_p4_rest, atol=TOLERANCE, rtol=0):\n            case_passed = False\n        \n        # 3. Boost all particles to the lab frame.\n        gamma = u_lab[0]\n        beta_vec = u_lab[1:] / gamma if gamma > 1.0 else np.array([0.0, 0.0, 0.0])\n        \n        lab_frame_p4s = [boost(p4, beta_vec) for p4 in rest_frame_p4s]\n        \n        # 4. Verify momentum conservation in the lab frame.\n        total_p4_lab = np.sum(lab_frame_p4s, axis=0)\n        expected_p4_lab = M * u_lab\n        if not np.allclose(total_p4_lab, expected_p4_lab, atol=TOLERANCE, rtol=0):\n            case_passed = False\n            \n        # 5. Verify the Jacobian identity for each particle.\n        beta_sq = np.dot(beta_vec, beta_vec)\n        if beta_sq > TOLERANCE**2:\n            for p4_rest, p4_lab in zip(rest_frame_p4s, lab_frame_p4s):\n                E_rest, E_lab = p4_rest[0], p4_lab[0]\n                \n                # Avoid division by zero for particles at rest (should not happen for daughters)\n                if E_rest  TOLERANCE:\n                    # If rest energy is zero, lab energy must also be zero (for non-singular Jacobian)\n                    if abs(E_lab) > TOLERANCE:\n                        case_passed = False\n                    continue\n\n                jacobian = calculate_jacobian(p4_rest, beta_vec)\n                det_J = np.linalg.det(jacobian)\n                ratio_E = E_lab / E_rest\n                \n                if not np.isclose(det_J, ratio_E, atol=TOLERANCE, rtol=0):\n                    case_passed = False\n                    break # A single failure is enough\n        \n        results.append(case_passed)\n        \n    print(f\"[{','.join(map(str, [r.item() for r in results]))}]\")\n\nsolve()\n```"
        }
    ]
}