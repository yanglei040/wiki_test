{
    "hands_on_practices": [
        {
            "introduction": "Detector geometries in high-energy physics are complex, hierarchical structures composed of thousands of nested volumes. To make sense of simulation data, we must be able to translate coordinates from a deeply nested local frame, such as a sensor chip, all the way out to the global laboratory frame. This exercise provides foundational practice in composing a series of rigid body transformations to calculate the global coordinates of a point, a critical skill for understanding how detector layouts are represented and used in simulation toolkits .",
            "id": "3510869",
            "problem": "In computational High-Energy Physics (HEP), detector simulations rely on a precise hierarchical description of nested volumes and their rigid placements. Consider a right-handed Cartesian world frame $\\mathcal{W}$ with a barrel volume $\\mathcal{B}$ placed in $\\mathcal{W}$, a module volume $\\mathcal{M}$ placed in $\\mathcal{B}$, and a sensor volume $\\mathcal{S}$ placed in $\\mathcal{M}$. Each placement is a rigid transform defined by a rotation and a translation, acting on the coordinates of the placed (child) frame to produce coordinates in the placing (mother) frame. Use the following core definition for a rigid placement from a local frame to its mother frame: if $\\mathbf{x}_{\\text{local}}$ are local coordinates, then the mother-frame coordinates are $\\mathbf{x}_{\\text{mother}} = R \\,\\mathbf{x}_{\\text{local}} + \\mathbf{t}$, where $R$ is a proper orthogonal rotation matrix and $\\mathbf{t}$ is a translation vector expressed in the mother frame.\n\nAll rotations are defined as right-handed rotations about axes expressed in the mother frame and all angles are given in radians. Let $\\hat{n}_0 = \\frac{1}{\\sqrt{3}}(1,1,1)$, $\\theta_0 = \\frac{\\pi}{3}$ define the rotation from $\\mathcal{W}$ to $\\mathcal{B}$ via Rodrigues’ rotation formula, followed by translation $\\mathbf{t}_0 = (100,-50,20)$ in millimeter (mm). The placement from $\\mathcal{B}$ to $\\mathcal{M}$ is a rotation about the $\\hat{y}$-axis of $\\mathcal{B}$ by $\\theta_1 = \\frac{\\pi}{4}$, followed by translation $\\mathbf{t}_1 = (30,10,-40)$ in millimeter (mm). The placement from $\\mathcal{M}$ to $\\mathcal{S}$ is a rotation about the $\\hat{x}$-axis of $\\mathcal{M}$ by $\\theta_2 = \\frac{\\pi}{6}$, followed by translation $\\mathbf{t}_2 = (-5,25,15)$ in millimeter (mm). A point is specified in the local sensor frame as $\\mathbf{p}_{\\mathcal{S}} = (12,-8,5)$ in millimeter (mm).\n\nUsing the fundamental definitions of rigid rotations and translations, and carefully respecting the order of operations implied by the local-to-mother mapping at each level, compute the world-frame coordinates $\\mathbf{x}_{\\mathcal{W}}$ of the point $\\mathbf{p}_{\\mathcal{S}}$. Express your final answer as a row vector of the three components in millimeter (mm), rounded to four significant figures.",
            "solution": "The problem requires the computation of the coordinates of a point $\\mathbf{p}_{\\mathcal{S}}$ given in a local sensor frame $\\mathcal{S}$ into the global world frame $\\mathcal{W}$. The coordinate system follows a hierarchical structure of nested volumes: the sensor volume $\\mathcal{S}$ is placed in a module volume $\\mathcal{M}$, which is placed in a barrel volume $\\mathcal{B}$, which itself is placed in the world frame $\\mathcal{W}$. Each placement is a rigid transformation from a local (child) frame to a mother (placing) frame, defined by the relation $\\mathbf{x}_{\\text{mother}} = R \\,\\mathbf{x}_{\\text{local}} + \\mathbf{t}$, where $R$ is a rotation matrix and $\\mathbf{t}$ is a translation vector.\n\nWe will find the coordinates of the point in the world frame, denoted $\\mathbf{p}_{\\mathcal{W}}$, by applying the transformations sequentially: $\\mathcal{S} \\to \\mathcal{M} \\to \\mathcal{B} \\to \\mathcal{W}$.\n\nLet $\\mathbf{p}_{\\mathcal{S}}$, $\\mathbf{p}_{\\mathcal{M}}$, $\\mathbf{p}_{\\mathcal{B}}$, and $\\mathbf{p}_{\\mathcal{W}}$ be the coordinate vectors of the point in the frames $\\mathcal{S}$, $\\mathcal{M}$, $\\mathcal{B}$, and $\\mathcal{W}$, respectively. The given point is $\\mathbf{p}_{\\mathcal{S}} = (12, -8, 5)^T$. All coordinates are in millimeters (mm).\n\nThe transformations are:\n1. From $\\mathcal{S}$ to $\\mathcal{M}$: $\\mathbf{p}_{\\mathcal{M}} = R_2 \\mathbf{p}_{\\mathcal{S}} + \\mathbf{t}_2$\n2. From $\\mathcal{M}$ to $\\mathcal{B}$: $\\mathbf{p}_{\\mathcal{B}} = R_1 \\mathbf{p}_{\\mathcal{M}} + \\mathbf{t}_1$\n3. From $\\mathcal{B}$ to $\\mathcal{W}$: $\\mathbf{p}_{\\mathcal{W}} = R_0 \\mathbf{p}_{\\mathcal{B}} + \\mathbf{t}_0$\n\nWe will compute these step-by-step.\n\n**Step 1: Transformation from Sensor Frame $\\mathcal{S}$ to Module Frame $\\mathcal{M}$**\n\nThe placement of $\\mathcal{S}$ in $\\mathcal{M}$ is defined by a rotation $R_2$ about the $\\hat{x}$-axis of $\\mathcal{M}$ by an angle $\\theta_2 = \\frac{\\pi}{6}$, followed by a translation $\\mathbf{t}_2 = (-5, 25, 15)^T$.\n\nThe rotation matrix $R_2$ for a rotation about the $\\hat{x}$-axis is:\n$$R_2 = R_x(\\theta_2) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\theta_2  -\\sin\\theta_2 \\\\ 0  \\sin\\theta_2  \\cos\\theta_2 \\end{pmatrix}$$\nWith $\\theta_2 = \\frac{\\pi}{6}$, we have $\\cos(\\frac{\\pi}{6}) = \\frac{\\sqrt{3}}{2}$ and $\\sin(\\frac{\\pi}{6}) = \\frac{1}{2}$.\n$$R_2 = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{\\sqrt{3}}{2}  -\\frac{1}{2} \\\\ 0  \\frac{1}{2}  \\frac{\\sqrt{3}}{2} \\end{pmatrix}$$\n\nNow we compute $\\mathbf{p}_{\\mathcal{M}}$:\n$$\\mathbf{p}_{\\mathcal{M}} = R_2 \\mathbf{p}_{\\mathcal{S}} + \\mathbf{t}_2 = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{\\sqrt{3}}{2}  -\\frac{1}{2} \\\\ 0  \\frac{1}{2}  \\frac{\\sqrt{3}}{2} \\end{pmatrix} \\begin{pmatrix} 12 \\\\ -8 \\\\ 5 \\end{pmatrix} + \\begin{pmatrix} -5 \\\\ 25 \\\\ 15 \\end{pmatrix}$$\n$$\\mathbf{p}_{\\mathcal{M}} = \\begin{pmatrix} 12 \\\\ -4\\sqrt{3} - \\frac{5}{2} \\\\ -4 + \\frac{5\\sqrt{3}}{2} \\end{pmatrix} + \\begin{pmatrix} -5 \\\\ 25 \\\\ 15 \\end{pmatrix} = \\begin{pmatrix} 7 \\\\ 25 - 4\\sqrt{3} - 2.5 \\\\ 15 - 4 + 2.5\\sqrt{3} \\end{pmatrix} = \\begin{pmatrix} 7 \\\\ 22.5 - 4\\sqrt{3} \\\\ 11 + 2.5\\sqrt{3} \\end{pmatrix}$$\n\n**Step 2: Transformation from Module Frame $\\mathcal{M}$ to Barrel Frame $\\mathcal{B}$**\n\nThe placement of $\\mathcal{M}$ in $\\mathcal{B}$ is a rotation $R_1$ about the $\\hat{y}$-axis of $\\mathcal{B}$ by $\\theta_1 = \\frac{\\pi}{4}$, followed by a translation $\\mathbf{t}_1 = (30, 10, -40)^T$.\n\nThe rotation matrix $R_1$ for a rotation about the $\\hat{y}$-axis is:\n$$R_1 = R_y(\\theta_1) = \\begin{pmatrix} \\cos\\theta_1  0  \\sin\\theta_1 \\\\ 0  1  0 \\\\ -\\sin\\theta_1  0  \\cos\\theta_1 \\end{pmatrix}$$\nWith $\\theta_1 = \\frac{\\pi}{4}$, we have $\\cos(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$ and $\\sin(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$.\n$$R_1 = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2} \\\\ 0  1  0 \\\\ -\\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2} \\end{pmatrix}$$\n\nNow we compute $\\mathbf{p}_{\\mathcal{B}}$:\n$$\\mathbf{p}_{\\mathcal{B}} = R_1 \\mathbf{p}_{\\mathcal{M}} + \\mathbf{t}_1 = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2} \\\\ 0  1  0 \\\\ -\\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2} \\end{pmatrix} \\begin{pmatrix} 7 \\\\ 22.5 - 4\\sqrt{3} \\\\ 11 + 2.5\\sqrt{3} \\end{pmatrix} + \\begin{pmatrix} 30 \\\\ 10 \\\\ -40 \\end{pmatrix}$$\nLet's compute the components of $R_1 \\mathbf{p}_{\\mathcal{M}}$:\n$$(R_1 \\mathbf{p}_{\\mathcal{M}})_x = \\frac{7\\sqrt{2}}{2} + \\frac{\\sqrt{2}}{2}(11 + 2.5\\sqrt{3}) = \\frac{\\sqrt{2}}{2}(18 + 2.5\\sqrt{3}) = 9\\sqrt{2} + 1.25\\sqrt{6}$$\n$$(R_1 \\mathbf{p}_{\\mathcal{M}})_y = 22.5 - 4\\sqrt{3}$$\n$$(R_1 \\mathbf{p}_{\\mathcal{M}})_z = -\\frac{7\\sqrt{2}}{2} + \\frac{\\sqrt{2}}{2}(11 + 2.5\\sqrt{3}) = \\frac{\\sqrt{2}}{2}(4 + 2.5\\sqrt{3}) = 2\\sqrt{2} + 1.25\\sqrt{6}$$\nAdding the translation $\\mathbf{t}_1$:\n$$\\mathbf{p}_{\\mathcal{B}} = \\begin{pmatrix} 30 + 9\\sqrt{2} + 1.25\\sqrt{6} \\\\ 10 + 22.5 - 4\\sqrt{3} \\\\ -40 + 2\\sqrt{2} + 1.25\\sqrt{6} \\end{pmatrix} = \\begin{pmatrix} 30 + 9\\sqrt{2} + 1.25\\sqrt{6} \\\\ 32.5 - 4\\sqrt{3} \\\\ -40 + 2\\sqrt{2} + 1.25\\sqrt{6} \\end{pmatrix}$$\n\n**Step 3: Transformation from Barrel Frame $\\mathcal{B}$ to World Frame $\\mathcal{W}$**\n\nThe placement of $\\mathcal{B}$ in $\\mathcal{W}$ is a rotation $R_0$ defined by Rodrigues' formula with axis $\\hat{n}_0 = \\frac{1}{\\sqrt{3}}(1,1,1)$ and angle $\\theta_0 = \\frac{\\pi}{3}$, followed by a translation $\\mathbf{t}_0 = (100, -50, 20)^T$.\n\nRodrigues' formula for a rotation matrix $R$ given an axis $\\hat{n}$ and angle $\\theta$ is $R = I + (\\sin\\theta)K + (1-\\cos\\theta)K^2$, where $K$ is the cross-product matrix of $\\hat{n}=(n_x, n_y, n_z)^T$.\n$$K = \\begin{pmatrix} 0  -n_z  n_y \\\\ n_z  0  -n_x \\\\ -n_y  n_x  0 \\end{pmatrix}$$\nFor $\\hat{n}_0 = \\frac{1}{\\sqrt{3}}(1,1,1)$, we have $K_0 = \\frac{1}{\\sqrt{3}}\\begin{pmatrix} 0  -1  1 \\\\ 1  0  -1 \\\\ -1  1  0 \\end{pmatrix}$.\nThen $K_0^2 = \\frac{1}{3}\\begin{pmatrix} -2  1  1 \\\\ 1  -2  1 \\\\ 1  1  -2 \\end{pmatrix}$.\nFor $\\theta_0 = \\frac{\\pi}{3}$, we have $\\sin\\theta_0 = \\frac{\\sqrt{3}}{2}$ and $\\cos\\theta_0 = \\frac{1}{2}$, so $1-\\cos\\theta_0 = \\frac{1}{2}$.\n\nSubstituting into Rodrigues' formula:\n$$R_0 = I + \\frac{\\sqrt{3}}{2} K_0 + \\frac{1}{2} K_0^2$$\n$$R_0 = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} + \\frac{1}{2}\\begin{pmatrix} 0  -1  1 \\\\ 1  0  -1 \\\\ -1  1  0 \\end{pmatrix} + \\frac{1}{6}\\begin{pmatrix} -2  1  1 \\\\ 1  -2  1 \\\\ 1  1  -2 \\end{pmatrix}$$\n$$R_0 = \\begin{pmatrix} 1-\\frac{1}{3}  -\\frac{1}{2}+\\frac{1}{6}  \\frac{1}{2}+\\frac{1}{6} \\\\ \\frac{1}{2}+\\frac{1}{6}  1-\\frac{1}{3}  -\\frac{1}{2}+\\frac{1}{6} \\\\ -\\frac{1}{2}+\\frac{1}{6}  \\frac{1}{2}+\\frac{1}{6}  1-\\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  \\frac{2}{3} \\\\ \\frac{2}{3}  \\frac{2}{3}  -\\frac{1}{3} \\\\ -\\frac{1}{3}  \\frac{2}{3}  \\frac{2}{3} \\end{pmatrix} = \\frac{1}{3}\\begin{pmatrix} 2  -1  2 \\\\ 2  2  -1 \\\\ -1  2  2 \\end{pmatrix}$$\n\nFinally, we compute $\\mathbf{p}_{\\mathcal{W}}$:\n$$\\mathbf{p}_{\\mathcal{W}} = R_0 \\mathbf{p}_{\\mathcal{B}} + \\mathbf{t}_0 = \\frac{1}{3}\\begin{pmatrix} 2  -1  2 \\\\ 2  2  -1 \\\\ -1  2  2 \\end{pmatrix} \\begin{pmatrix} 30 + 9\\sqrt{2} + 1.25\\sqrt{6} \\\\ 32.5 - 4\\sqrt{3} \\\\ -40 + 2\\sqrt{2} + 1.25\\sqrt{6} \\end{pmatrix} + \\begin{pmatrix} 100 \\\\ -50 \\\\ 20 \\end{pmatrix}$$\nLet's evaluate the matrix-vector product, denoted $\\mathbf{v} = R_0 \\mathbf{p}_{\\mathcal{B}}$:\n$$3v_x = 2(30 + 9\\sqrt{2} + 1.25\\sqrt{6}) - (32.5 - 4\\sqrt{3}) + 2(-40 + 2\\sqrt{2} + 1.25\\sqrt{6})$$\n$$3v_x = 60 + 18\\sqrt{2} + 2.5\\sqrt{6} - 32.5 + 4\\sqrt{3} - 80 + 4\\sqrt{2} + 2.5\\sqrt{6} = -52.5 + 22\\sqrt{2} + 4\\sqrt{3} + 5\\sqrt{6}$$\n$$3v_y = 2(30 + 9\\sqrt{2} + 1.25\\sqrt{6}) + 2(32.5 - 4\\sqrt{3}) - (-40 + 2\\sqrt{2} + 1.25\\sqrt{6})$$\n$$3v_y = 60 + 18\\sqrt{2} + 2.5\\sqrt{6} + 65 - 8\\sqrt{3} + 40 - 2\\sqrt{2} - 1.25\\sqrt{6} = 165 + 16\\sqrt{2} - 8\\sqrt{3} + 1.25\\sqrt{6}$$\n$$3v_z = -(30 + 9\\sqrt{2} + 1.25\\sqrt{6}) + 2(32.5 - 4\\sqrt{3}) + 2(-40 + 2\\sqrt{2} + 1.25\\sqrt{6})$$\n$$3v_z = -30 - 9\\sqrt{2} - 1.25\\sqrt{6} + 65 - 8\\sqrt{3} - 80 + 4\\sqrt{2} + 2.5\\sqrt{6} = -45 - 5\\sqrt{2} - 8\\sqrt{3} + 1.25\\sqrt{6}$$\nUsing numerical values $\\sqrt{2} \\approx 1.41421$, $\\sqrt{3} \\approx 1.73205$, $\\sqrt{6} \\approx 2.44949$:\n$$3v_x \\approx -52.5 + 22(1.41421) + 4(1.73205) + 5(2.44949) = -52.5 + 31.11262 + 6.92820 + 12.24745 = -2.21173$$\n$$v_x \\approx -0.73724$$\n$$3v_y \\approx 165 + 16(1.41421) - 8(1.73205) + 1.25(2.44949) = 165 + 22.62736 - 13.85640 + 3.06186 = 176.83282$$\n$$v_y \\approx 58.94427$$\n$$3v_z \\approx -45 - 5(1.41421) - 8(1.73205) + 1.25(2.44949) = -45 - 7.07105 - 13.85640 + 3.06186 = -62.86559$$\n$$v_z \\approx -20.95520$$\n\nFinally, we add the translation $\\mathbf{t}_0$:\n$$\\mathbf{p}_{\\mathcal{W}} = \\mathbf{v} + \\mathbf{t}_0 \\approx \\begin{pmatrix} -0.73724 \\\\ 58.94427 \\\\ -20.95520 \\end{pmatrix} + \\begin{pmatrix} 100 \\\\ -50 \\\\ 20 \\end{pmatrix} = \\begin{pmatrix} 99.26276 \\\\ 8.94427 \\\\ -0.95520 \\end{pmatrix}$$\nRounding each component to four significant figures:\n$p_{\\mathcal{W},x} \\approx 99.26$\n$p_{\\mathcal{W},y} \\approx 8.944$\n$p_{\\mathcal{W},z} \\approx -0.9552$\n\nThe world-frame coordinates of the point are approximately $(99.26, 8.944, -0.9552)$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 99.26  8.944  -0.9552 \\end{pmatrix} } $$"
        },
        {
            "introduction": "The inverse of local-to-global transformation is just as crucial: determining which specific detector element was struck by a particle. This process, known as digitization, connects the continuous path of a simulated particle to the discrete output of the detector hardware. This problem challenges you to work backward from a global hit coordinate to find its location in a sensor's local frame and determine the exact pixel channel that would register the signal, a key step in simulating realistic detector responses .",
            "id": "3510927",
            "problem": "A planar pixel sensor module in a computational high-energy physics simulation is described by a rigid body transform from its local frame $(u,v,w)$ to the laboratory global frame $(x,y,z)$. The transform consists of a proper orthonormal rotation matrix $R$ and a translation vector $\\mathbf{t}$, obeying the standard rigid body rule $\\mathbf{x}_{\\mathrm{global}} = R \\, \\mathbf{x}_{\\mathrm{local}} + \\mathbf{t}$, where $R^{\\top} R = I$ and $\\det R = 1$. The module’s local axes are defined such that $w$ is the surface normal, and the sensitive plane is at $w=0$. The pixel sensor has a non-square pitch: it is segmented into $N_u$ columns along $u$ with pitch $p_u$, and $N_v$ rows along $v$ with pitch $p_v$. The active area is centered at $(u,v)=(0,0)$, spanning the closed interval $[-\\frac{N_u p_u}{2}, \\frac{N_u p_u}{2}]$ along $u$ and $[-\\frac{N_v p_v}{2}, \\frac{N_v p_v}{2}]$ along $v$. Pixels are indexed by integer pairs $(i,j)$ with $i \\in \\{0,1,\\ldots,N_u-1\\}$ increasing with $u$ and $j \\in \\{0,1,\\ldots,N_v-1\\}$ increasing with $v$, where $(i,j)=(0,0)$ corresponds to the pixel whose lower-left corner is at $(u_{\\min}, v_{\\min}) = \\left(-\\frac{N_u p_u}{2}, -\\frac{N_v p_v}{2}\\right)$.\n\nFor a particular module, the local-to-global rotation is a pure rotation about the global $z$-axis by angle $\\theta$ with $\\cos\\theta = 0.8$ and $\\sin\\theta = 0.6$, so that\n$$\nR = \\begin{pmatrix}\n0.8  -0.6  0 \\\\\n0.6  \\phantom{-}0.8  0 \\\\\n0  0  1\n\\end{pmatrix},\n$$\nand the translation vector is\n$$\n\\mathbf{t} = \\begin{pmatrix} 10 \\\\ 5 \\\\ 2 \\end{pmatrix}~\\mathrm{mm}.\n$$\nThe sensor has $N_u = 800$ columns at pitch $p_u = 0.025~\\mathrm{mm}$ and $N_v = 400$ rows at pitch $p_v = 0.150~\\mathrm{mm}$, centered at the local origin.\n\nA simulated particle hit is recorded at global coordinates\n$$\n\\mathbf{x}_{\\mathrm{global}} = \\begin{pmatrix} 15 \\\\ 10 \\\\ 2 \\end{pmatrix}~\\mathrm{mm}.\n$$\n\nStarting from the definitions of rigid body transforms and orthonormal rotations, derive the local coordinates $(u,v)$ for this hit and determine the discrete pixel indices $(i,j)$ that the hit falls into, together with the single-channel identifier $c$ defined by row-major ordering $c = j \\, N_u + i$. Report the final answer as the row matrix $\\big(u, v, i, j, c\\big)$ with $u$ and $v$ expressed in $\\mathrm{mm}$ and rounded to four significant figures, and with $i$, $j$, and $c$ as integers without units.",
            "solution": "The local-to-global mapping is given by the rigid body rule $\\mathbf{x}_{\\mathrm{global}} = R \\, \\mathbf{x}_{\\mathrm{local}} + \\mathbf{t}$, where $R$ is orthonormal with $R^{\\top} R = I$ and $\\det R = 1$. For an orthonormal $R$, the inverse transform is $\\mathbf{x}_{\\mathrm{local}} = R^{\\top} \\left( \\mathbf{x}_{\\mathrm{global}} - \\mathbf{t} \\right)$, which follows from $R^{-1} = R^{\\top}$.\n\nWe are given\n$$\nR = \\begin{pmatrix}\n0.8  -0.6  0 \\\\\n0.6  \\phantom{-}0.8  0 \\\\\n0  0  1\n\\end{pmatrix}, \\quad\n\\mathbf{t} = \\begin{pmatrix} 10 \\\\ 5 \\\\ 2 \\end{pmatrix}~\\mathrm{mm}, \\quad\n\\mathbf{x}_{\\mathrm{global}} = \\begin{pmatrix} 15 \\\\ 10 \\\\ 2 \\end{pmatrix}~\\mathrm{mm}.\n$$\nFirst compute the global offset vector\n$$\n\\Delta \\mathbf{x} = \\mathbf{x}_{\\mathrm{global}} - \\mathbf{t} = \\begin{pmatrix} 15-10 \\\\ 10-5 \\\\ 2-2 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 0 \\end{pmatrix}~\\mathrm{mm}.\n$$\nNext use the inverse transform\n$$\n\\mathbf{x}_{\\mathrm{local}} = R^{\\top} \\, \\Delta \\mathbf{x}.\n$$\nBecause $R$ is a rotation about $z$, its transpose is\n$$\nR^{\\top} = \\begin{pmatrix}\n0.8  \\phantom{-}0.6  0 \\\\\n-0.6  0.8  0 \\\\\n0  0  1\n\\end{pmatrix}.\n$$\nThus\n$$\n\\begin{pmatrix} u \\\\ v \\\\ w \\end{pmatrix}\n= \n\\begin{pmatrix}\n0.8  \\phantom{-}0.6  0 \\\\\n-0.6  0.8  0 \\\\\n0  0  1\n\\end{pmatrix}\n\\begin{pmatrix} 5 \\\\ 5 \\\\ 0 \\end{pmatrix}\n=\n\\begin{pmatrix}\n0.8 \\cdot 5 + 0.6 \\cdot 5 \\\\\n-0.6 \\cdot 5 + 0.8 \\cdot 5 \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n4 + 3 \\\\\n-3 + 4 \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n7 \\\\ 1 \\\\ 0\n\\end{pmatrix}~\\mathrm{mm}.\n$$\nTherefore, the local hit coordinates on the sensor plane are $(u,v) = (7~\\mathrm{mm}, 1~\\mathrm{mm})$ with $w=0$ as expected.\n\nTo assign pixel indices, we start from the segmentation definitions. The active area is centered at the origin with\n$$\nu_{\\min} = -\\frac{N_u p_u}{2}, \\quad u_{\\max} = \\frac{N_u p_u}{2}, \\quad v_{\\min} = -\\frac{N_v p_v}{2}, \\quad v_{\\max} = \\frac{N_v p_v}{2}.\n$$\nGiven $N_u = 800$ and $p_u = 0.025~\\mathrm{mm}$, we have\n$$\nN_u p_u = 800 \\times 0.025~\\mathrm{mm} = 20~\\mathrm{mm}, \\quad u_{\\min} = -10~\\mathrm{mm}, \\quad u_{\\max} = 10~\\mathrm{mm}.\n$$\nGiven $N_v = 400$ and $p_v = 0.150~\\mathrm{mm}$, we have\n$$\nN_v p_v = 400 \\times 0.150~\\mathrm{mm} = 60~\\mathrm{mm}, \\quad v_{\\min} = -30~\\mathrm{mm}, \\quad v_{\\max} = 30~\\mathrm{mm}.\n$$\nThe continuous-to-discrete mapping that preserves consistent binning from the lower-left corner $(u_{\\min}, v_{\\min})$ is\n$$\ni = \\left\\lfloor \\frac{u - u_{\\min}}{p_u} \\right\\rfloor, \\qquad\nj = \\left\\lfloor \\frac{v - v_{\\min}}{p_v} \\right\\rfloor,\n$$\nwith the floor function $\\lfloor \\cdot \\rfloor$ producing the unique integer index of the pixel whose lower-left corner bounds the hit in each dimension. For $(u,v) = (7~\\mathrm{mm}, 1~\\mathrm{mm})$,\n$$\n\\frac{u - u_{\\min}}{p_u} = \\frac{7 - (-10)}{0.025} = \\frac{17}{0.025} = 680, \\quad \\Rightarrow \\quad i = \\lfloor 680 \\rfloor = 680,\n$$\n$$\n\\frac{v - v_{\\min}}{p_v} = \\frac{1 - (-30)}{0.150} = \\frac{31}{0.150} \\approx 206.666\\ldots, \\quad \\Rightarrow \\quad j = \\lfloor 206.666\\ldots \\rfloor = 206.\n$$\nBoth indices satisfy $0 \\leq i \\leq N_u - 1$ and $0 \\leq j \\leq N_v - 1$, confirming the hit lies within the active area. The single-channel identifier in row-major ordering is\n$$c = j \\, N_u + i = 206 \\times 800 + 680 = 164800 + 680 = 165480.$$\nFinally, round $u$ and $v$ to four significant figures and express them in $\\mathrm{mm}$ as required. Since $u=7~\\mathrm{mm}$ and $v=1~\\mathrm{mm}$ are exact to the precision implied, they become $u = 7.000$ and $v = 1.000$ when written with four significant figures. Assemble the requested row matrix $(u, v, i, j, c)$.",
            "answer": "$$\\boxed{\\begin{pmatrix}7.000  1.000  680  206  165480\\end{pmatrix}}$$"
        },
        {
            "introduction": "Particle transport simulations proceed by \"stepping\" a particle through the detector geometry, requiring the program to constantly answer the question: \"How far can I travel before hitting the next material boundary?\" This is the fundamental query of ray tracing, which boils down to finding the intersection of a particle's trajectory with the geometric shapes that define the detector. This practice guides you through the derivation and calculation of a line-cylinder intersection, a core computational primitive for navigating the most common type of tracker geometry .",
            "id": "3510886",
            "problem": "A cylindrical tracker barrel in a High-Energy Physics (HEP) simulation is modeled as the lateral surface of an infinite cylinder aligned with the $z$-axis, described by the equation $x^{2} + y^{2} = r^{2}$. A charged particle’s trajectory is propagated as a straight ray in local coordinates according to $\\mathbf{x}(t) = \\mathbf{x}_{0} + t\\,\\mathbf{d}$, where $\\mathbf{x}_{0} = (x_{0}, y_{0}, z_{0})$ is the starting point inside the cylinder, $\\mathbf{d} = (d_{x}, d_{y}, d_{z})$ is a unit direction vector, and $t \\geq 0$ is the path length parameter measured in meters.\n\nStarting from the definitions of the cylinder and the parametric line, and without assuming any pre-derived intersection formulas, derive the analytic expression for the intersection parameter(s) $t$ by enforcing the geometric constraint that the trajectory lies on the cylindrical surface. Then specialize your result to select the smallest positive intersection $t$ (the first hit/exit along the ray).\n\nAfter deriving the general expression, evaluate it numerically for the following physically plausible configuration representative of a silicon tracker barrel layer:\n- Cylinder radius $r = 1.3\\,\\mathrm{m}$,\n- Starting point $\\mathbf{x}_{0} = (0.5,\\,-0.6,\\,2.0)\\,\\mathrm{m}$,\n- Unit direction vector $\\mathbf{d} = \\bigl(0.4,\\,0.5,\\,\\sqrt{0.59}\\bigr)$, where $\\sqrt{0.59}$ is chosen so that $\\mathbf{d}$ is normalized.\n\nRound your final numerical answer to four significant figures and express it in meters.\n\nFinally, as part of your derivation, briefly discuss how a floating-point implementation should robustly handle grazing incidence (near-tangential intersection) cases, including the roles of the discriminant, numerical tolerances, and a numerically stable root evaluation strategy. Your final reported quantity must be only the smallest positive $t$ as specified above.",
            "solution": "The problem is first validated to ensure it is well-posed, scientifically grounded, and self-contained.\n\n**Step 1: Extract Givens**\n- Cylindrical surface equation: $x^{2} + y^{2} = r^{2}$, infinite in $z$.\n- Particle trajectory (parametric line): $\\mathbf{x}(t) = \\mathbf{x}_{0} + t\\,\\mathbf{d}$, for $t \\geq 0$.\n- Starting point: $\\mathbf{x}_{0} = (x_{0}, y_{0}, z_{0})$, located inside the cylinder.\n- Direction vector: $\\mathbf{d} = (d_{x}, d_{y}, d_{z})$, a unit vector ($|\\mathbf{d}|=1$).\n- Numerical values for evaluation:\n  - Radius: $r = 1.3\\,\\mathrm{m}$.\n  - Starting point: $\\mathbf{x}_{0} = (0.5,\\,-0.6,\\,2.0)\\,\\mathrm{m}$.\n  - Direction vector: $\\mathbf{d} = \\bigl(0.4,\\,0.5,\\,\\sqrt{0.59}\\bigr)$.\n- Required output: The smallest positive intersection parameter $t$, rounded to four significant figures.\n- Additional requirement: Discuss robust handling of grazing incidence in a floating-point implementation.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem describes the intersection of a straight line and a cylinder, a fundamental problem in computational geometry and particle tracking simulations used in High-Energy Physics. The straight-line approximation is valid over short distances or in field-free regions. The setup is scientifically and mathematically sound.\n- **Well-Posedness**: The problem is clearly defined. We can check if the provided starting point is indeed inside the cylinder: $x_{0}^{2} + y_{0}^{2} = (0.5)^{2} + (-0.6)^{2} = 0.25 + 0.36 = 0.61$. The cylinder radius squared is $r^{2} = (1.3)^{2} = 1.69$. Since $0.61  1.69$, the point is inside. We also verify the direction vector is normalized: $|\\mathbf{d}|^2 = d_{x}^{2} + d_{y}^{2} + d_{z}^{2} = (0.4)^{2} + (0.5)^{2} + (\\sqrt{0.59})^{2} = 0.16 + 0.25 + 0.59 = 1.00$. All conditions are met for a well-posed problem that admits a unique, meaningful solution.\n- **Objectivity**: The problem is stated using precise mathematical language, free of ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full derivation and solution will be provided.\n\n**Derivation of the Intersection Parameter**\n\nThe trajectory is given by the parametric equation $\\mathbf{x}(t) = \\mathbf{x}_{0} + t\\mathbf{d}$. In component form, this is:\n$$x(t) = x_{0} + t d_{x}$$\n$$y(t) = y_{0} + t d_{y}$$\n$$z(t) = z_{0} + t d_{z}$$\n\nThe cylindrical surface is defined by the equation $x^{2} + y^{2} = r^{2}$. Note that this equation is independent of the $z$-coordinate, so we only need to consider the projection of the trajectory onto the $xy$-plane.\n\nTo find the intersection point(s), we substitute the parametric expressions for $x(t)$ and $y(t)$ into the cylinder equation:\n$$ (x_{0} + t d_{x})^{2} + (y_{0} + t d_{y})^{2} = r^{2} $$\n\nExpanding the terms, we get:\n$$ (x_{0}^{2} + 2 t x_{0} d_{x} + t^{2} d_{x}^{2}) + (y_{0}^{2} + 2 t y_{0} d_{y} + t^{2} d_{y}^{2}) = r^{2} $$\n\nWe rearrange this into a standard quadratic equation of the form $At^{2} + Bt + C = 0$ by grouping terms by powers of $t$:\n$$ t^{2}(d_{x}^{2} + d_{y}^{2}) + t(2x_{0}d_{x} + 2y_{0}d_{y}) + (x_{0}^{2} + y_{0}^{2} - r^{2}) = 0 $$\n\nThe coefficients $A$, $B$, and $C$ are thus:\n$$ A = d_{x}^{2} + d_{y}^{2} $$\n$$ B = 2(x_{0}d_{x} + y_{0}d_{y}) $$\n$$ C = x_{0}^{2} + y_{0}^{2} - r^{2} $$\n\nThese can be expressed more concisely using vector notation for the components in the $xy$-plane. Let $\\mathbf{x}_{0, \\perp} = (x_{0}, y_{0})$ and $\\mathbf{d}_{\\perp} = (d_{x}, d_{y})$. The coefficients become:\n$$ A = \\mathbf{d}_{\\perp} \\cdot \\mathbf{d}_{\\perp} = |\\mathbf{d}_{\\perp}|^{2} $$\n$$ B = 2(\\mathbf{x}_{0, \\perp} \\cdot \\mathbf{d}_{\\perp}) $$\n$$ C = \\mathbf{x}_{0, \\perp} \\cdot \\mathbf{x}_{0, \\perp} - r^{2} = |\\mathbf{x}_{0, \\perp}|^{2} - r^{2} $$\n\nThe solutions for $t$ are given by the quadratic formula:\n$$ t = \\frac{-B \\pm \\sqrt{B^{2} - 4AC}}{2A} $$\n\nThe problem specifies that the particle starts inside the cylinder, meaning $|\\mathbf{x}_{0, \\perp}|^{2}  r^{2}$. This implies that the coefficient $C = |\\mathbf{x}_{0, \\perp}|^{2} - r^{2}$ is negative. The coefficient $A = |\\mathbf{d}_{\\perp}|^{2}$ is non-negative. For any trajectory not parallel to the $z$-axis (i.e., $\\mathbf{d}_{\\perp} \\neq \\mathbf{0}$), we have $A  0$.\n\nThe discriminant is $\\Delta = B^{2} - 4AC$. Since $A0$ and $C0$, the term $-4AC$ is positive. Thus, $\\Delta = B^{2} - 4AC  B^2 \\geq 0$, which guarantees two distinct real roots for $t$.\n\nThe product of the roots is given by Vieta's formulas as $t_{1}t_{2} = C/A$. Since $A0$ and $C0$, the product $t_{1}t_{2}$ is negative. This means one root must be positive and the other must be negative.\n\nThe two roots are $t_{\\pm} = \\frac{-B \\pm \\sqrt{\\Delta}}{2A}$. Since $\\sqrt{\\Delta}  0$, the root with the plus sign is always greater than the root with the minus sign. As one root must be positive and one negative, the positive root must be the larger one:\n$$ t = \\frac{-B + \\sqrt{B^{2} - 4AC}}{2A} $$\nThis is the smallest positive value of $t$ that satisfies the intersection condition, representing the first time the particle's path intersects the cylinder wall.\n\n**Numerical Evaluation**\n\nWe are given:\n- $r = 1.3$\n- $\\mathbf{x}_{0} = (0.5, -0.6, 2.0)$\n- $\\mathbf{d} = (0.4, 0.5, \\sqrt{0.59})$\n\nFrom these, we calculate the coefficients $A$, $B$, and $C$:\n$$ A = d_{x}^{2} + d_{y}^{2} = (0.4)^{2} + (0.5)^{2} = 0.16 + 0.25 = 0.41 $$\n$$ B = 2(x_{0}d_{x} + y_{0}d_{y}) = 2((0.5)(0.4) + (-0.6)(0.5)) = 2(0.2 - 0.3) = 2(-0.1) = -0.2 $$\n$$ C = x_{0}^{2} + y_{0}^{2} - r^{2} = (0.5)^{2} + (-0.6)^{2} - (1.3)^{2} = 0.25 + 0.36 - 1.69 = 0.61 - 1.69 = -1.08 $$\n\nNext, we calculate the discriminant $\\Delta = B^{2} - 4AC$:\n$$ \\Delta = (-0.2)^{2} - 4(0.41)(-1.08) = 0.04 + 1.7712 = 1.8112 $$\n\nNow we compute the smallest positive root $t$:\n$$ t = \\frac{-(-0.2) + \\sqrt{1.8112}}{2(0.41)} = \\frac{0.2 + \\sqrt{1.8112}}{0.82} $$\n$$ t \\approx \\frac{0.2 + 1.3458083}{0.82} = \\frac{1.5458083}{0.82} \\approx 1.88513207... $$\n\nRounding to four significant figures, we get $t = 1.885\\,\\mathrm{m}$.\n\n**Discussion on Floating-Point Robustness**\n\nIn a floating-point implementation, special care is required for grazing incidence, where the trajectory is nearly tangent to the cylinder.\n$1$. **The Discriminant:** Grazing incidence corresponds to a discriminant $\\Delta = B^{2} - 4AC$ that is close to zero. Due to finite precision, a true value of $\\Delta = 0$ (tangency) might be computed as a small negative number, leading to the erroneous conclusion of no intersection. A robust implementation should use a tolerance, $\\epsilon$. If the computed $\\Delta$ is negative but its absolute value is smaller than $\\epsilon$ (i.e., $-\\epsilon  \\Delta  0$), it should be treated as a tangent intersection by setting $\\Delta = 0$.\n$2$. **Numerical Tolerances:** The choice of $\\epsilon$ is critical and depends on the floating-point precision (e.g., single or double) and the problem's geometric scale. It safeguards against incorrect \"miss\" classifications for near-tangent paths. For a tangent hit ($\\Delta=0$), there is one unique solution $t = -B/(2A)$.\n$3$. **Numerically Stable Root Evaluation:** The standard quadratic formula can suffer from catastrophic cancellation error when subtracting two nearly-equal numbers. To find the positive root $t = (-B + \\sqrt{\\Delta})/(2A)$, cancellation could occur if $B$ is positive and $B \\approx \\sqrt{\\Delta}$. A more stable approach is to first calculate the root that involves an addition in the numerator (thus avoiding subtraction of nearly equal floating point numbers), and then find the second root using Vieta's formula ($t_{1}t_{2} = C/A$). The more robustly computed root is $t_{\\text{stable}} = \\frac{-B - \\operatorname{sgn}(B)\\sqrt{B^{2}-4AC}}{2A}$. The other root is then $t_{\\text{other}} = C/(A \\cdot t_{\\text{stable}})$. For a starting point inside the cylinder, one of these will be positive and one negative. The implementation should select the positive one. This strategy avoids the loss of precision regardless of the signs and magnitudes of the coefficients.",
            "answer": "$$\\boxed{1.885}$$"
        }
    ]
}