{
    "hands_on_practices": [
        {
            "introduction": "我们从一个具体的低维例子开始，以建立对约束形式和惩罚形式等价性的基本直觉。这个练习将引导你直接应用 Karush-Kuhn-Tucker (KKT) 条件来分析一个带 $\\ell_1$ 范数约束的最小二乘问题。通过求解，你将看到约束问题中的拉格朗日乘子 $\\mu$ 如何精确地对应于惩罚问题（LASSO）中产生相同解的正则化参数 $\\lambda$，从而直接揭示两种范式间的核心联系。",
            "id": "3446594",
            "problem": "考虑一个低维情况下的带$\\ell_1$范数正则化的最小二乘数据拟合问题。设感知矩阵为 $A \\in \\mathbb{R}^{2 \\times 3}$，数据向量为 $y \\in \\mathbb{R}^{2}$，具体如下：\n$$\nA = \\begin{pmatrix} 1  0  1 \\\\ 0  1  -1 \\end{pmatrix}, \\quad y = \\begin{pmatrix} 3 \\\\ 1 \\end{pmatrix}.\n$$\n设$\\ell_1$球的半径为 $\\tau = 1$。定义带约束的$\\ell_1$范数正则化最小二乘问题为\n$$\n\\min_{x \\in \\mathbb{R}^{3}} \\ \\frac{1}{2} \\|A x - y\\|_{2}^{2} \\quad \\text{subject to} \\quad \\|x\\|_{1} \\le \\tau,\n$$\n以及其惩罚（拉格朗日）形式\n$$\n\\min_{x \\in \\mathbb{R}^{3}} \\ \\frac{1}{2} \\|A x - y\\|_{2}^{2} + \\lambda \\|x\\|_{1},\n$$\n其中 $\\lambda  0$。从凸最优性和$\\ell_1$范数次微分的核心定义出发，证明约束问题的最优解位于$\\ell_1$球的角点 $x^{\\star} = (\\tau, 0, 0)$ (即 $x^{\\star} = (1, 0, 0)$)，并计算使得惩罚问题达到相同最优解$x^{\\star}$的$\\lambda$的精确值。你的最终结果无需四舍五入。你的最终答案必须是单个实数。",
            "solution": "该问题要求我们验证一个带约束的$\\ell_1$正则化最小二乘问题的给定解，然后找出正则化参数$\\lambda$，使得相应的惩罚（拉格朗日）形式具有相同的解。我们将使用凸优化的一阶最优性条件来解决这个问题。\n\n设目标函数为 $f(x) = \\frac{1}{2} \\|A x - y\\|_{2}^{2}$，正则化项为 $g(x) = \\|x\\|_{1}$。给定的数据是：\n$$\nA = \\begin{pmatrix} 1  0  1 \\\\ 0  1  -1 \\end{pmatrix}, \\quad y = \\begin{pmatrix} 3 \\\\ 1 \\end{pmatrix}, \\quad \\tau = 1.\n$$\n给定的最优解是 $x^{\\star} = (1, 0, 0)^{T}$。\n\n函数 $f(x)$ 是可微的凸函数。其梯度由 $\\nabla f(x) = A^{T}(Ax - y)$ 给出。函数 $g(x)$ 是凸函数，但并非处处可微。必须使用其次微分 $\\partial g(x)$。\n\n首先，我们计算 $f(x)$ 在点 $x^{\\star}$ 处的梯度：\n$$\nAx^{\\star} = \\begin{pmatrix} 1  0  1 \\\\ 0  1  -1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.\n$$\n残差向量是：\n$$\nAx^{\\star} - y = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 3 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\end{pmatrix}.\n$$\n$A$ 的转置是：\n$$\nA^{T} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 1  -1 \\end{pmatrix}.\n$$\n因此，$x^{\\star}$ 处的梯度是：\n$$\n\\nabla f(x^{\\star}) = A^{T}(Ax^{\\star} - y) = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 1  -1 \\end{pmatrix} \\begin{pmatrix} -2 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} (1)(-2) + (0)(-1) \\\\ (0)(-2) + (1)(-1) \\\\ (1)(-2) + (-1)(-1) \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\\\ -1 \\end{pmatrix}.\n$$\n\n其次，我们来刻画$\\ell_1$范数 $g(x) = \\|x\\|_{1} = \\sum_{i=1}^{3} |x_{i}|$ 在 $x^{\\star} = (1, 0, 0)^{T}$ 处的次微分。次微分 $\\partial g(x)$ 是其分量 $|x_{i}|$ 的次微分的笛卡尔积。绝对值函数在一点 $z$ 处的次微分，当 $z \\neq 0$ 时为 $\\operatorname{sign}(z)$，当 $z=0$ 时为区间 $[-1, 1]$。\n对于 $x^{\\star} = (1, 0, 0)^{T}$：\n\\begin{itemize}\n    \\item $x_{1}^{\\star} = 1 \\ne 0 \\implies$ 次梯度的第一个分量是 $\\operatorname{sign}(1) = 1$。\n    \\item $x_{2}^{\\star} = 0 \\implies$ 次梯度的第二个分量位于 $[-1, 1]$ 内。\n    \\item $x_{3}^{\\star} = 0 \\implies$ 次梯度的第三个分量位于 $[-1, 1]$ 内。\n\\end{itemize}\n因此，任何次梯度向量 $s \\in \\partial g(x^{\\star})$ 都必须具有 $s = (1, s_{2}, s_{3})^{T}$ 的形式，其中 $s_{2} \\in [-1, 1]$ 且 $s_{3} \\in [-1, 1]$。\n\n现在，我们可以着手处理这两个任务。\n\n**第一部分：验证约束问题的解**\n约束问题是：\n$$\n\\min_{x \\in \\mathbb{R}^{3}} \\ f(x) \\quad \\text{subject to} \\quad g(x) \\le \\tau.\n$$\n由于这是一个凸优化问题，Karush-Kuhn-Tucker (KKT) 条件是最优性的充分必要条件。对于一个点 $x^{\\star}$ 成为解，必须存在一个拉格朗日乘子 $\\mu \\ge 0$ 使得：\n1.  **原始可行性：** $\\|x^{\\star}\\|_{1} \\le \\tau$\n2.  **对偶可行性：** $\\mu \\ge 0$\n3.  **互补松弛性：** $\\mu (\\|x^{\\star}\\|_{1} - \\tau) = 0$\n4.  **平稳性：** $0 \\in \\nabla f(x^{\\star}) + \\mu \\, \\partial g(x^{\\star})$\n\n让我们在 $\\tau=1$ 的情况下，对 $x^{\\star} = (1, 0, 0)^{T}$ 检查这些条件：\n\n1.  **原始可行性：** $\\|x^{\\star}\\|_{1} = |1| + |0| + |0| = 1$。由于 $1 \\le 1$ 成立，所以 $x^{\\star}$ 是可行的。该约束是激活的。\n2.  **互补松弛性：** 由于 $\\|x^{\\star}\\|_{1} - \\tau = 1 - 1 = 0$，条件 $\\mu (0) = 0$ 对任何 $\\mu$ 都满足。\n3.  **平稳性和对偶可行性：** 平稳性条件可以写成 $-\\nabla f(x^{\\star}) \\in \\mu \\, \\partial g(x^{\\star})$，这意味着对于某个 $s \\in \\partial g(x^{\\star})$，有 $-\\nabla f(x^{\\star}) = \\mu s$。\n我们有 $-\\nabla f(x^{\\star}) = -(-2, -1, -1)^{T} = (2, 1, 1)^{T}$。该方程变为：\n$$\n\\begin{pmatrix} 2 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\mu \\begin{pmatrix} 1 \\\\ s_{2} \\\\ s_{3} \\end{pmatrix} = \\begin{pmatrix} \\mu \\\\ \\mu s_{2} \\\\ \\mu s_{3} \\end{pmatrix}\n$$\n其中 $s_{2}, s_{3} \\in [-1, 1]$。\n从第一个分量，我们得到 $\\mu = 2$。这满足对偶可行性条件 $\\mu \\ge 0$。\n将 $\\mu = 2$ 代入其他两个分量方程：\n\\begin{itemize}\n    \\item $1 = 2 s_{2} \\implies s_{2} = \\frac{1}{2}$\n    \\item $1 = 2 s_{3} \\implies s_{3} = \\frac{1}{2}$\n\\end{itemize}\n我们必须验证这个次梯度是有效的。向量 $s = (1, 1/2, 1/2)^{T}$ 是一个有效的次梯度，因为 $s_{2} = 1/2 \\in [-1, 1]$ 且 $s_{3} = 1/2 \\in [-1, 1]$。\n由于所有KKT条件在 $\\mu=2$ 时都得到满足，点 $x^{\\star}=(1, 0, 0)^{T}$ 确实是约束问题的最优解。\n\n**第二部分：计算惩罚问题的 $\\lambda$**\n惩罚（拉格朗日）问题是：\n$$\n\\min_{x \\in \\mathbb{R}^{3}} \\ \\frac{1}{2} \\|A x - y\\|_{2}^{2} + \\lambda \\|x\\|_{1} \\equiv \\min_{x \\in \\mathbb{R}^{3}} f(x) + \\lambda g(x).\n$$\n这是一个无约束凸优化问题。一个点 $x^{\\star}$ 是全局最小值点，当且仅当零向量包含在 $x^{\\star}$ 处目标函数的次微分中。使用次微分的求和法则（因为 $f(x)$ 是可微的）：\n$$\n0 \\in \\partial (f(x^{\\star}) + \\lambda g(x^{\\star})) = \\nabla f(x^{\\star}) + \\lambda \\, \\partial g(x^{\\star}).\n$$\n这等价于条件 $-\\nabla f(x^{\\star}) \\in \\lambda \\, \\partial g(x^{\\star})$。这要求存在一个次梯度 $s \\in \\partial g(x^{\\star})$ 使得：\n$$\n-\\nabla f(x^{\\star}) = \\lambda s.\n$$\n这与KKT分析中的平稳性条件具有完全相同的代数形式，只是用 $\\lambda$ 代替了拉格朗日乘子 $\\mu$。\n使用我们之前对 $x^{\\star}=(1, 0, 0)^{T}$ 的结果：\n$$\n-\\nabla f(x^{\\star}) = \\begin{pmatrix} 2 \\\\ 1 \\\\ 1 \\end{pmatrix}, \\quad \\text{且} \\quad s = \\begin{pmatrix} 1 \\\\ s_{2} \\\\ s_{3} \\end{pmatrix} \\text{ 其中 } s_2, s_3 \\in [-1, 1].\n$$\n该条件变为：\n$$\n\\begin{pmatrix} 2 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\lambda \\begin{pmatrix} 1 \\\\ s_{2} \\\\ s_{3} \\end{pmatrix} = \\begin{pmatrix} \\lambda \\\\ \\lambda s_{2} \\\\ \\lambda s_{3} \\end{pmatrix}.\n$$\n从第一个分量，我们立即得到 $\\lambda = 2$。\n问题要求 $\\lambda  0$，此条件已满足。我们必须确认这个 $\\lambda$ 的选择与其余分量是一致的。\n$$\n1 = 2s_{2} \\implies s_{2} = \\frac{1}{2}.\n$$\n$$\n1 = 2s_{3} \\implies s_{3} = \\frac{1}{2}.\n$$\n所需的次梯度向量是 $s = (1, 1/2, 1/2)^{T}$。这是 $\\partial g(x^{\\star})$ 的一个有效元素，因为 $s_{2}=1/2 \\in [-1, 1]$ 且 $s_{3}=1/2 \\in [-1, 1]$。\n因此，对于 $\\lambda = 2$，惩罚问题的最优性条件在 $x^{\\star}=(1, 0, 0)^{T}$ 处得到满足。\n\n使得惩罚问题与约束问题具有相同最优解 $x^{\\star}$ 的 $\\lambda$ 值，恰好是约束问题KKT条件中的拉格朗日乘子 $\\mu$，我们已求得其值为 $2$。",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "在建立了基本直觉之后，我们转向一个更深刻的理论视角。本练习将从优化理论中的值函数 $\\varphi(\\tau)$ 出发，探讨参数之间的泛函关系。你将通过此练习推导出约束问题最优值对约束边界变化的敏感度（即其导数）与惩罚项参数 $\\lambda$ 之间的深刻联系，即 $\\lambda = -\\varphi'(\\tau)$。这个结果是包络定理的一个直接体现，它为在两种等价范式间进行转换提供了一个强大的分析工具。",
            "id": "3446602",
            "problem": "考虑在压缩感知和稀疏优化中出现的凸优化公式。约束形式在 $\\ell_1$ 预算下最小化二次数据保真度，而惩罚形式则在二次数据保真度与 $\\ell_1$ 惩罚项之间进行权衡。设 $A \\in \\mathbb{R}^{2 \\times 2}$ 为单位矩阵 $A = I$，且设 $y \\in \\mathbb{R}^{2}$ 为 $y = \\begin{pmatrix} 4 \\\\ 1 \\end{pmatrix}$。定义约束公式的值函数 $\\varphi(\\tau)$ 如下\n$$\n\\varphi(\\tau) \\triangleq \\min_{x \\in \\mathbb{R}^{2}} \\left\\{ \\frac{1}{2} \\|x - y\\|_{2}^{2} \\; \\text{subject to} \\; \\|x\\|_{1} \\leq \\tau \\right\\}.\n$$\n惩罚形式的公式为\n$$\n\\min_{x \\in \\mathbb{R}^{2}} \\left\\{ \\frac{1}{2} \\|x - y\\|_{2}^{2} + \\lambda \\|x\\|_{1} \\right\\}.\n$$\n仅从凸分析的基本定义和原理出发，包括拉格朗日对偶和 Karush-Kuhn-Tucker (KKT) 条件，并利用包络定理关联值函数和拉格朗日乘子，推导约束问题的最优解结构，表达值函数 $\\varphi(\\tau)$，并在 $\\varphi(\\tau)$ 可微处建立 $\\ell_1$ 约束的拉格朗日乘子 $\\lambda$ 与其导数之间的关系。\n\n然后，对于目标残差能量 $\\varepsilon = \\frac{81}{100}$，构造 $\\tau$ 使得 $\\varphi(\\tau) = \\varepsilon$，并通过导数关系确定相应的 $\\lambda$。将最终答案表示为单个实数。无需四舍五入。",
            "solution": "该问题旨在通过一个具体的例子来阐明约束形式和惩罚形式的$\\ell_1$优化问题之间的等价性。我们将首先求解约束问题，推导出其值函数$\\varphi(\\tau)$，然后利用包络定理建立$\\varphi'(\\tau)$与惩罚项参数$\\lambda$之间的关系，并最终求解特定参数下的$\\lambda$。\n\n**1. 约束问题的解**\n\n约束问题为在$\\ell_1$球$\\|x\\|_1 \\le \\tau$上寻找点$y=(4,1)^\\top$的欧几里得投影。其拉格朗日函数为：\n$$ L(x, \\lambda) = \\frac{1}{2}\\|x-y\\|_2^2 + \\lambda(\\|x\\|_1 - \\tau), \\quad \\lambda \\ge 0 $$\nKKT平稳性条件为 $0 \\in x-y+\\lambda\\partial\\|x\\|_1$，即 $y-x \\in \\lambda\\partial\\|x\\|_1$。这导出了著名的软阈值算子解：\n$$ x_i = \\operatorname{sgn}(y_i) \\max(|y_i|-\\lambda, 0) = S_\\lambda(y_i) $$\n其中拉格朗日乘子$\\lambda$由互补松弛性条件决定。由于$\\|y\\|_1=5$，对于$\\tau  5$的情况，约束是激活的，即$\\|x\\|_1=\\tau$。\n对于$y=(4,1)^\\top$，我们有$x = (\\max(4-\\lambda, 0), \\max(1-\\lambda, 0))^\\top$。通过求解$\\|x\\|_1=\\tau$来确定$\\lambda$关于$\\tau$的函数关系：\n*   当$3 \\le \\tau \\le 5$时，$\\lambda \\in [0,1]$，解的形式为$x=(4-\\lambda, 1-\\lambda)^\\top$。$\\|x\\|_1 = 5-2\\lambda = \\tau \\implies \\lambda = \\frac{5-\\tau}{2}$。此时 $x(\\tau) = \\left(\\frac{3+\\tau}{2}, \\frac{\\tau-3}{2}\\right)^\\top$。\n*   当$0 \\le \\tau  3$时，$\\lambda \\in (1,4]$，解的形式为$x=(4-\\lambda, 0)^\\top$。$\\|x\\|_1 = 4-\\lambda = \\tau \\implies \\lambda = 4-\\tau$。此时 $x(\\tau) = (\\tau, 0)^\\top$。\n\n**2. 值函数 $\\varphi(\\tau)$ 及其导数**\n\n值函数$\\varphi(\\tau) = \\frac{1}{2}\\|x(\\tau)-y\\|_2^2$。代入上面求得的$x(\\tau)$：\n*   当$3 \\le \\tau \\le 5$时，$x-y = \\left(\\frac{\\tau-5}{2}, \\frac{\\tau-5}{2}\\right)^\\top$，所以 $\\varphi(\\tau) = \\frac{1}{2} \\left( 2 \\cdot \\left(\\frac{\\tau-5}{2}\\right)^2 \\right) = \\frac{(\\tau-5)^2}{4}$。\n*   当$0 \\le \\tau  3$时，$x-y = (\\tau-4, -1)^\\top$，所以 $\\varphi(\\tau) = \\frac{1}{2}((\\tau-4)^2 + 1)$。\n\n根据包络定理，值函数对其约束参数的导数等于负的拉格朗日乘子，即$\\lambda(\\tau) = -\\varphi'(\\tau)$。我们来验证这一点：\n*   当$3  \\tau  5$时，$\\varphi'(\\tau) = \\frac{2(\\tau-5)}{4} = \\frac{\\tau-5}{2}$。因此 $\\lambda = -\\varphi'(\\tau) = \\frac{5-\\tau}{2}$，与我们的推导一致。\n*   当$0  \\tau  3$时，$\\varphi'(\\tau) = \\frac{1}{2}(2(\\tau-4)) = \\tau-4$。因此 $\\lambda = -\\varphi'(\\tau) = 4-\\tau$，也与推导一致。\n\n**3. 求解$\\lambda$**\n\n我们需要求解$\\varphi(\\tau) = \\varepsilon = \\frac{81}{100}$。\n*   在区间$[3, 5]$上，$\\frac{(\\tau-5)^2}{4} = \\frac{81}{100} \\implies (\\tau-5)^2 = \\frac{324}{100}$。由于$\\tau \\le 5$，我们取$\\tau-5 = -\\sqrt{3.24} = -1.8$，得到$\\tau = 3.2 = \\frac{16}{5}$。该值在$[3,5]$区间内，是有效解。\n*   在区间$[0, 3)$上，$\\frac{1}{2}((\\tau-4)^2+1) = \\frac{81}{100} \\implies (\\tau-4)^2+1 = \\frac{81}{50} \\implies (\\tau-4)^2 = \\frac{31}{50}$。解为$\\tau = 4 \\pm \\sqrt{31/50}$。两个解都不在$[0,3)$区间内。\n\n因此，唯一的解是$\\tau = \\frac{16}{5}$。将此值代入对应的$\\lambda$关系式中：\n$$ \\lambda = \\frac{5-\\tau}{2} = \\frac{5 - \\frac{16}{5}}{2} = \\frac{\\frac{25-16}{5}}{2} = \\frac{9/5}{2} = \\frac{9}{10} $$\n最终，与残差能量$\\varepsilon=81/100$对应的惩罚参数是$\\lambda = 9/10$。",
            "answer": "$$ \\boxed{\\frac{9}{10}} $$"
        },
        {
            "introduction": "理论的最终目的是指导实践。这个综合性练习将理论与计算相结合，要求你设计一个数值算法来求解约束形式的优化问题，并验证其与惩罚形式的等价性。你将实现一个投影梯度下降法，并利用其数值解来从 KKT 条件中提取对应的正则化参数 $\\lambda$。通过在多种精心设计的测试场景下验证这种等价性，你将巩固对这一核心理论在实际算法环境中稳健性的理解。",
            "id": "3446598",
            "problem": "设 $A \\in \\mathbb{R}^{m \\times n}$ 为给定矩阵，$b \\in \\mathbb{R}^{m}$ 为给定向量。考虑带 $\\ell_1$ 范数预算的约束二次优化问题：\n$$\n\\min_{x \\in \\mathbb{R}^{n}} \\ \\frac{1}{2}\\|A x - b\\|_{2}^{2} \\quad \\text{subject to} \\quad \\|x\\|_{1} \\le \\epsilon,\n$$\n其中 $\\epsilon \\ge 0$ 是一个指定参数。目标是设计并实现一个算法程序，该程序对下述每个测试用例执行以下步骤，并输出一个可验证的结果：\n\n1. 求解该约束问题，以获得数值最优解 $x^{\\star}$。\n\n2. 计算残差 $r^{\\star} = A^{\\top}(A x^{\\star} - b)$，并从 Karush–Kuhn–Tucker (KKT) 平稳性条件中提取一个标量 $\\lambda \\ge 0$\n$$\n-A^{\\top}(A x^{\\star} - b) \\in \\lambda \\, \\partial \\|x^{\\star}\\|_{1},\n$$\n其中 $\\partial \\|x\\|_{1}$ 表示 $\\ell_1$ 范数的次微分。您必须使用以下选择：\n$$\n\\lambda := \\|r^{\\star}\\|_{\\infty} = \\max_{i \\in \\{1,\\dots,n\\}} |r^{\\star}_{i}|.\n$$\n\n3. 对于计算出的 $\\lambda$，验证 $x^{\\star}$ 对拉格朗日罚问题\n$$\n\\min_{x \\in \\mathbb{R}^{n}} \\ \\frac{1}{2}\\|A x - b\\|_{2}^{2} + \\lambda \\|x\\|_{1},\n$$\n的最优性，具体方法是检验等价的 KKT 条件：\n$$\n\\text{for all } i: \\quad\n\\begin{cases}\nr^{\\star}_{i} + \\lambda \\,\\operatorname{sign}(x^{\\star}_{i}) = 0,   \\text{if } x^{\\star}_{i} \\neq 0, \\\\\n|r^{\\star}_{i}| \\le \\lambda,   \\text{if } x^{\\star}_{i} = 0,\n\\end{cases}\n$$\n其中 $\\operatorname{sign}(\\cdot)$ 是符号函数，并使用了次梯度刻画 $\\partial \\|x\\|_{1} = \\{z \\in \\mathbb{R}^{n} : z_{i} = \\operatorname{sign}(x_{i}) \\text{ if } x_{i} \\neq 0, \\ |z_{i}| \\le 1 \\text{ if } x_{i} = 0\\}$。此外，还需在指定的数值容差范围内验证原始可行性 $\\|x^{\\star}\\|_{1} \\le \\epsilon$ 和互补松弛性 $\\lambda(\\|x^{\\star}\\|_{1} - \\epsilon) = 0$。\n\n该算法必须从凸优化的第一性原理推导得出：\n\n- 使用带范数约束的凸规划的 KKT 条件以及 $\\ell_1$ 范数的次微分刻画。\n- 对约束问题使用投影梯度法，其中到 $\\ell_1$ 球 $\\{x : \\|x\\|_{1} \\le \\epsilon\\}$ 的投影通过排序和阈值化精确计算。\n- 使用基于梯度 $\\nabla \\left(\\frac{1}{2}\\|A x - b\\|_{2}^{2}\\right) = A^{\\top}(A x - b)$ 的 Lipschitz 常数的步长，该常数是 $A$ 的谱范数的平方，即 $L = \\|A\\|_{2}^{2}$。\n\n您的程序必须实现以下测试套件。对于每个用例，使用给定的种子确定性地构造 $A$ 和 $b$，并按规定设置 $\\epsilon$：\n\n- 测试用例 1 (非激活约束，零拉格朗日乘子边界)：\n  - $m = 80$, $n = 40$, 种子 $= 11$。\n  - 构造 $A$，其元素 $a_{ij} \\sim \\mathcal{N}(0, 1/\\sqrt{m})$。\n  - 独立地构造 $x_{\\mathrm{true}} \\sim \\mathcal{N}(0, 1)^{n}$，并设 $b = A x_{\\mathrm{true}}$。\n  - 设 $\\epsilon = 1.5 \\|x_{\\mathrm{true}}\\|_{1}$。\n\n- 测试用例 2 (激活约束，欠定，稀疏目标)：\n  - $m = 40$, $n = 100$, 种子 $= 22$。\n  - 构造 $A$，其元素 $a_{ij} \\sim \\mathcal{N}(0, 1/\\sqrt{m})$。\n  - 构造一个 $k$-稀疏的 $x_{\\mathrm{true}}$，其中 $k=5$ 个非零元位于均匀随机的位置，非零值 $\\sim \\mathcal{N}(0,1)$，并设 $b = A x_{\\mathrm{true}} + \\eta$，其中 $\\eta \\sim \\mathcal{N}(0, 0.01^{2})^{m}$。\n  - 设 $\\epsilon = 0.8 \\|x_{\\mathrm{true}}\\|_{1}$。\n\n- 测试用例 3 (零预算边界情况)：\n  - $m = 50$, $n = 100$, 种子 $= 33$。\n  - 构造 $A$，其元素 $a_{ij} \\sim \\mathcal{N}(0, 1/\\sqrt{m})$。\n  - 构造 $b \\sim \\mathcal{N}(0, 1)^{m}$。\n  - 设 $\\epsilon = 0$。\n\n- 测试用例 4 (最小二乘点位于 $\\ell_1$ 球边界上的边界情况)：\n  - $m = 70$, $n = 30$, 种子 $= 44$。\n  - 构造 $A$，其元素 $a_{ij} \\sim \\mathcal{N}(0, 1/\\sqrt{m})$。\n  - 构造 $b \\sim \\mathcal{N}(0, 1)^{m}$。\n  - 使用正规方程求解器或等效的数值稳定方法，计算 $\\min_{x} \\|A x - b\\|_{2}^{2}$ 的唯一最小二乘解 $x_{\\mathrm{LS}}$；设 $\\epsilon = \\|x_{\\mathrm{LS}}\\|_{1}$。\n\n实现细节和容差：\n- 使用投影梯度法，步长为 $t = 1/\\|A\\|_{2}^{2}$。\n- 使用最多 $10000$ 次迭代，如果变化满足 $\\|x^{k+1} - x^{k}\\|_{2} \\le 10^{-8}$，则提前终止。\n- 对 KKT 平稳性检查和互补松弛性使用 $10^{-6}$ 的数值容差。\n- 到 $\\ell_1$ 球的投影必须是精确的：给定 $y \\in \\mathbb{R}^{n}$ 和 $\\epsilon \\ge 0$，返回 $x = \\operatorname{proj}_{\\|x\\|_{1} \\le \\epsilon}(y)$，其计算方法为：对 $|y|$ 排序，找到一个阈值 $\\theta$ 使得 $\\sum_{i=1}^{n} \\max(|y_{i}| - \\theta, 0) = \\epsilon$，然后设置 $x_{i} = \\operatorname{sign}(y_{i}) \\max(|y_{i}| - \\theta, 0)$。\n\n最终输出规范：\n- 对于每个测试用例，您的程序必须输出一个列表，其中包含计算出的 $\\lambda$（作为浮点数）和一个布尔值。当且仅当所有验证都通过时，该布尔值为真：在 $\\lambda$ 处的罚问题的 KKT 平稳性、原始可行性 $\\|x^{\\star}\\|_{1} \\le \\epsilon$，以及在指定容差内的互补松弛性 $\\lambda(\\|x^{\\star}\\|_{1} - \\epsilon) \\approx 0$。\n- 您的程序应生成单行输出，其中包含所有四个测试用例的结果，格式为方括号内由逗号分隔的列表，每个元素是上述的单个测试列表。例如，一个有效的输出格式是\n$$\n[\\,[\\lambda_{1}, \\mathrm{True}], [\\lambda_{2}, \\mathrm{False}], [\\lambda_{3}, \\mathrm{True}], [\\lambda_{4}, \\mathrm{True}]\\,].\n$$\n此问题不涉及物理单位或角度，因此输出中无需包含它们。",
            "solution": "该问题要求设计并实现一个算法，以数值方式验证约束形式和惩罚形式的$\\ell_1$正则化二次优化问题之间的等价性。这两种形式在凸优化理论中通过拉格朗日对偶性联系在一起，对于这类问题，强对偶性成立，这意味着它们的解是相关的。\n\n约束问题可以表示为：\n$$\n\\min_{x \\in \\mathbb{R}^{n}} \\ f(x) := \\frac{1}{2}\\|A x - b\\|_{2}^{2} \\quad \\text{subject to} \\quad \\|x\\|_{1} \\le \\epsilon\n$$\n这是一个凸优化问题，因为目标函数$f(x)$是凸的，约束集$C = \\{x \\in \\mathbb{R}^{n} : \\|x\\|_{1} \\le \\epsilon\\}$（即$\\ell_1$球）也是凸的。\n\n解决此问题的指定算法是投影梯度法（Projected Gradient Method, PGD）。PGD的迭代更新规则是：\n$$\nx^{k+1} = \\operatorname{proj}_{C}(x^k - t \\nabla f(x^k))\n$$\n其中$\\operatorname{proj}_{C}(\\cdot)$是到可行集$C$上的欧几里得投影，$t$是步长，$\\nabla f(x)$是目标函数的梯度。\n$f(x) = \\frac{1}{2}(Ax-b)^{\\top}(Ax-b)$的梯度是 $\\nabla f(x) = A^{\\top}(A x - b)$。\n为保证PGD收敛，步长$t$必须满足$0  t  2/L$，其中$L$是梯度$\\nabla f(x)$的Lipschitz常数。问题指定使用固定步长$t = 1/L$，其中$L = \\|A\\|_{2}^{2}$（$A$的谱范数的平方）。\n\n从PGD获得数值解$x^{\\star}$后，我们根据Karush–Kuhn–Tucker (KKT)条件来验证其性质。约束问题的拉格朗日函数是：\n$$\n\\mathcal{L}(x, \\lambda) = \\frac{1}{2}\\|A x - b\\|_{2}^{2} + \\lambda (\\|x\\|_{1} - \\epsilon)\n$$\n其中$\\lambda \\ge 0$是拉格朗日乘子。在点$x^\\star$处的最优性KKT条件是：\n1.  原始可行性：$\\|x^{\\star}\\|_{1} \\le \\epsilon$。\n2.  对偶可行性：$\\lambda \\ge 0$。\n3.  互补松弛性：$\\lambda (\\|x^{\\star}\\|_{1} - \\epsilon) = 0$。\n4.  平稳性：$0 \\in \\nabla f(x^{\\star}) + \\lambda \\partial \\|x^{\\star}\\|_{1}$，其中$\\partial \\|\\cdot\\|_1$是$\\ell_1$范数的次微分。\n\n平稳性条件可以重写为 $-A^{\\top}(A x^{\\star} - b) \\in \\lambda \\partial \\|x^{\\star}\\|_{1}$。令$r^{\\star} = A^{\\top}(A x^{\\star} - b)$，则条件为$-r^{\\star} \\in \\lambda \\partial \\|x^{\\star}\\|_{1}$。从这个条件中，可以推导出$\\lambda$的一个候选值。$\\ell_1$范数的次梯度是集合$\\partial \\|x\\|_{1} = \\{z \\in \\mathbb{R}^{n} : z_i = \\operatorname{sign}(x_i) \\text{ if } x_i \\neq 0, \\text{ and } |z_i| \\le 1 \\text{ if } x_i = 0\\}$。因此：\n-   如果 $x^{\\star}_i \\neq 0$：$-r^{\\star}_i = \\lambda \\operatorname{sign}(x^{\\star}_i) \\implies |r^{\\star}_i| = \\lambda$。\n-   如果 $x^{\\star}_i = 0$：$|-r^{\\star}_i| \\le \\lambda \\cdot 1 \\implies |r^{\\star}_i| \\le \\lambda$。\n综合这些，$\\lambda$必须等于$x^\\star$支撑集上残差分量的最大绝对值，并且必须大于或等于非支撑集上残差分量的绝对值。一个满足此条件的有效$\\lambda$选择是整个残差向量的$\\ell_{\\infty}$范数，即$\\lambda = \\|r^{\\star}\\|_{\\infty} = \\max_{i} |r^{\\star}_i|$，这也是问题所指定的。\n\n使用这个$\\lambda$，我们接着验证$x^{\\star}$是否也是惩罚（拉格朗日）问题的解：\n$$\n\\min_{x \\in \\mathbb{R}^{n}} \\ \\frac{1}{2}\\|A x - b\\|_{2}^{2} + \\lambda \\|x\\|_{1}\n$$\n此问题的最优性条件是$0 \\in \\nabla f(x^{\\star}) + \\lambda \\partial \\|x^{\\star}\\|_1$，这恰好是原始约束问题的平稳性条件。因此，验证过程涉及在给定容差内，数值上检查三元组$(x^{\\star}, \\lambda)$是否满足所有KKT条件。\n\n实现将通过定义Python函数来完成：到$\\ell_1$球的投影、PGD求解器以及一个主函数来协调问题陈述中定义的四个测试用例。这些测试用例旨在探究问题的不同情景，例如非激活约束（$\\lambda=0$）、激活约束（$\\lambda>0$）、零预算约束（$x^\\star=0$）以及无约束解恰好位于约束边界上的特殊情况。",
            "answer": "```python\nimport numpy as np\n\ndef project_L1_ball(y, epsilon):\n    \"\"\"\n    Computes the Euclidean projection of a vector y onto the L1-ball of radius epsilon.\n    \"\"\"\n    if epsilon  0:\n        raise ValueError(\"Projection radius epsilon must be non-negative.\")\n    \n    if epsilon == 0:\n        return np.zeros_like(y)\n        \n    if np.linalg.norm(y, 1) = epsilon:\n        return y\n\n    signs = np.sign(y)\n    v = np.abs(y)\n    n = len(v)\n\n    u = np.sort(v)[::-1]\n    \n    cs = np.cumsum(u)\n    \n    j_vals = np.arange(1, n + 1)\n    condition = u > (cs - epsilon) / j_vals\n    \n    rho_idx = np.where(condition)[0]\n    rho = rho_idx[-1] + 1\n    \n    theta = (cs[rho - 1] - epsilon) / rho\n    \n    x_proj = signs * np.maximum(v - theta, 0)\n    \n    return x_proj\n\ndef solve_constrained(A, b, epsilon):\n    \"\"\"\n    Solves min 1/2 ||Ax - b||_2^2 s.t. ||x||_1 = epsilon using Projected Gradient Descent.\n    \"\"\"\n    m, n = A.shape\n    \n    L = np.linalg.norm(A, 2)**2\n    if L == 0:\n        # Handle the case where A is a zero matrix.\n        return np.zeros(n)\n    t = 1.0 / L\n    \n    x = np.zeros(n)\n    max_iter = 10000\n    conv_tol = 1e-8\n    \n    for _ in range(max_iter):\n        gradient = A.T @ (A @ x - b)\n        y = x - t * gradient\n        x_next = project_L1_ball(y, epsilon)\n        \n        if np.linalg.norm(x_next - x) = conv_tol:\n            break\n        \n        x = x_next\n        \n    return x\n\ndef perform_test(m, n, seed, setup_func, epsilon_func):\n    \"\"\"\n    Runs a single test case: sets up data, solves, and verifies.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    A, b, epsilon = setup_func(m, n, rng, epsilon_func)\n\n    # 1. Solve the constrained problem\n    x_star = solve_constrained(A, b, epsilon)\n    \n    # 2. Compute residual and lambda\n    r_star = A.T @ (A @ x_star - b)\n    lambda_val = np.linalg.norm(r_star, np.inf)\n\n    # 3. Verification\n    verify_tol = 1e-6\n    verification_passed = True\n    \n    # Verify KKT conditions for the penalized problem\n    nonzero_indices = np.where(np.abs(x_star) > 1e-7)[0] # Use a slightly stricter tol for support detection\n    zero_indices = np.where(np.abs(x_star) = 1e-7)[0]\n\n    # For x_i != 0: r_i + lambda * sign(x_i) = 0\n    if len(nonzero_indices) > 0:\n        kkt_nonzero_check = np.all(np.abs(r_star[nonzero_indices] + lambda_val * np.sign(x_star[nonzero_indices])) = verify_tol)\n        if not kkt_nonzero_check:\n            verification_passed = False\n            \n    # For x_i = 0: |r_i| = lambda. This is true by definition of lambda.\n    if len(zero_indices) > 0:\n        kkt_zero_check = np.all(np.abs(r_star[zero_indices]) = lambda_val + verify_tol)\n        if not kkt_zero_check:\n            verification_passed = False\n\n    # Verify primal feasibility for the constrained problem\n    l1_norm_x_star = np.linalg.norm(x_star, 1)\n    if not (l1_norm_x_star = epsilon + verify_tol):\n        verification_passed = False\n        \n    # Verify complementary slackness for the constrained problem\n    if not (np.abs(lambda_val * (l1_norm_x_star - epsilon)) = verify_tol):\n         # Special check for case 4 where x_ls is on boundary.\n         # Here grad is 0, so r_star is 0, lambda is 0. Condition is satisfied.\n         # For non-active case 1, lambda=0, so satisfied.\n         # The only case this is strict is when lambda > 0 and ||x*||_1 must be epsilon.\n         if lambda_val > verify_tol and abs(l1_norm_x_star - epsilon) > verify_tol:\n            verification_passed = False\n\n    return [lambda_val, verification_passed]\n\n# Setup functions for data generation for each test case\ndef setup_case1(m, n, rng, epsilon_func):\n    A = rng.normal(0, 1/np.sqrt(m), size=(m, n))\n    x_true = rng.normal(0, 1, size=n)\n    b = A @ x_true\n    epsilon = epsilon_func(x_true)\n    return A, b, epsilon\n\ndef setup_case2(m, n, rng, epsilon_func):\n    A = rng.normal(0, 1/np.sqrt(m), size=(m, n))\n    k = 5\n    x_true = np.zeros(n)\n    support = rng.choice(n, k, replace=False)\n    x_true[support] = rng.normal(0, 1, size=k)\n    noise = rng.normal(0, 0.01, size=m)\n    b = A @ x_true + noise\n    epsilon = epsilon_func(x_true)\n    return A, b, epsilon\n    \ndef setup_case3(m, n, rng, epsilon_func):\n    A = rng.normal(0, 1/np.sqrt(m), size=(m, n))\n    b = rng.normal(0, 1, size=m)\n    epsilon = epsilon_func(None) # epsilon is just 0\n    return A, b, epsilon\n    \ndef setup_case4(m, n, rng, epsilon_func):\n    A = rng.normal(0, 1/np.sqrt(m), size=(m, n))\n    b = rng.normal(0, 1, size=m)\n    x_ls = np.linalg.lstsq(A, b, rcond=None)[0]\n    epsilon = epsilon_func(x_ls)\n    return A, b, epsilon\n    \ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        (80, 40, 11, setup_case1, lambda x: 1.5 * np.linalg.norm(x, 1)),\n        (40, 100, 22, setup_case2, lambda x: 0.8 * np.linalg.norm(x, 1)),\n        (50, 100, 33, setup_case3, lambda x: 0.0),\n        (70, 30, 44, setup_case4, lambda x: np.linalg.norm(x, 1))\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = perform_test(*case_params)\n        results.append(result)\n\n    def format_item(item):\n        lambda_val, is_verified = item\n        # Use scientific notation for small numbers for better readability\n        lambda_str = f\"{lambda_val:.6e}\" if abs(lambda_val)  1e-4 and lambda_val != 0 else f\"{lambda_val}\"\n        return f\"[{lambda_str},{'True' if is_verified else 'False'}]\"\n\n    print(f\"[{','.join(map(format_item, results))}]\")\n\nsolve()\n```"
        }
    ]
}