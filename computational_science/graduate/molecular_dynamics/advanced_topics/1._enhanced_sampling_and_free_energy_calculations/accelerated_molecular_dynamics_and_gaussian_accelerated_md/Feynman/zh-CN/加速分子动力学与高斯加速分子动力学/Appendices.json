{
    "hands_on_practices": [
        {
            "introduction": "在设置高斯加速分子动力学（GaMD）参数之前，理解基本的模拟设置如何影响底层势能面至关重要。本练习将引导您运用统计力学原理，分析如SHAKE等全息约束如何通过移除自由度来改变系统的势能统计特性，包括其极值和方差。这项练习旨在建立模拟细节与GaMD关键统计量之间联系的深刻理解，为更精确的参数化奠定基础 。",
            "id": "3393789",
            "problem": "一个经典系统由 $n$ 个独立的一维谐振内坐标 $\\{q_{i}\\}_{i=1}^{n}$ 组成，每个坐标的势能为 $v_{i}(q_{i}) = \\frac{1}{2}k\\,q_{i}^{2}$。该系统与绝对温度为 $T$ 的热浴接触，构成一个正则系综。诸如 SHAKE 或 RATTLE 的完整约束算法强制其中 $m$ 个坐标固定在预设值 $\\{s\\}$ 上，其中 $0 \\le m \\le n$，且所有被约束的坐标都设置为相同的固定值 $s$（即，对于 $m$ 个被约束的坐标，$q_{j} \\equiv s$，而其余 $n-m$ 个坐标 $q_{i}$ 是自由的）。假设所有谐振模式具有相同的弹簧常数 $k$ 且统计独立，并且未约束的坐标在其他方面没有耦合。\n\n为了分析总势能 $V = \\sum_{i=1}^{n} v_{i}(q_{i})$ 的范围，额外假设由于坚硬但有限的外部边界使得位移 $|q_{i}| > A$ 在采样期间动态不可及，每个未约束的坐标被限制在一个物理可及的区间 $q_{i} \\in [-A, A]$ 内，其中 $A > 0$。在这些条件下：\n\n1. 从正则系综的定义和二次模式的独立性出发，推导完整约束相对于无约束情况如何改变总势能 $V$ 的最小值和最大值。将偏移量 $\\Delta V_{\\min}$ 和 $\\Delta V_{\\max}$ 表示为 $n$、$m$、$k$、$A$ 和 $s$ 的函数。\n\n2. 高斯加速分子动力学 (GaMD) 使用形如 $E = V_{\\min} + c\\,\\sigma_{V}$ 的规则选择一个偏置能 $E$，其中 $c$ 是一个固定的无量纲参数，$\\sigma_{V}$ 是正则系综下总势能的标准差。利用基本统计力学，当 $m$ 个坐标被约束在 $q=s$ 时，推导 $\\sigma_{V}$ 的修正估计量，然后计算 GaMD 偏置能的偏移，定义为 $E_{\\mathrm{corr}} - E_{0}$，其中 $E_{\\mathrm{corr}}$ 使用修正后的 $\\sigma_{V}$ 和约束后的 $V_{\\min}$，而 $E_{0}$ 是在相同系统中当 $m=0$（无约束）时将获得的偏置能。用 $n$、$m$、$k$、$s$、$k_{B}$、$T$ 和 $c$ 表示你对 $E_{\\mathrm{corr}} - E_{0}$ 的最终结果。\n\n以焦耳为单位表示最终答案。不代入任何数值；提供一个封闭形式的解析表达式。",
            "solution": "问题陈述具有科学依据，提法恰当且内容自洽。它描述了一个在正则系综统计力学框架下分析的、受完整约束的经典谐振子系统的物理和数学上一致的模型。该问题是有效的，可以按如下方式求解。\n\n问题分为两部分。第一部分涉及约束对总势能 $V$ 的最小和最大可能值的确定性影响。第二部分讨论这些约束对 $V$ 的方差的统计效应以及由此产生的高斯加速分子动力学 (GaMD) 能量偏置的偏移。\n\n$n$ 个独立谐振坐标系统的总势能由下式给出：\n$$\nV = \\sum_{i=1}^{n} v_{i}(q_{i}) = \\sum_{i=1}^{n} \\frac{1}{2}k\\,q_{i}^{2}\n$$\n其中 $k$ 是统一的弹簧常数。\n\n### 第1部分：最小和最大势能的偏移\n\n这部分分析考虑每个未约束坐标的物理可及范围为一个有限区间 $q_{i} \\in [-A, A]$。\n\n**无约束系统 ($m=0$)**\n\n在没有完整约束的情况下，所有 $n$ 个坐标都可以在区间 $[-A, A]$ 内自由变化。总势能为 $V_{0} = \\sum_{i=1}^{n} \\frac{1}{2}k\\,q_{i}^{2}$。\n最小势能 $V_{\\min, 0}$ 出现在每一项 $\\frac{1}{2}k\\,q_{i}^{2}$ 都被最小化时。由于 $k > 0$ 且 $q_{i}^{2} \\geq 0$，当所有 $i=1, \\dots, n$ 的 $q_{i} = 0$ 时达到最小值。\n$$\nV_{\\min, 0} = \\sum_{i=1}^{n} \\frac{1}{2}k\\,(0)^{2} = 0\n$$\n最大势能 $V_{\\max, 0}$ 出现在每一项 $\\frac{1}{2}k\\,q_{i}^{2}$ 都被最大化时。这发生在对所有 $i=1, \\dots, n$，$|q_{i}|$ 取最大值，即 $|q_{i}|=A$ 时。\n$$\nV_{\\max, 0} = \\sum_{i=1}^{n} \\frac{1}{2}k\\,A^{2} = \\frac{1}{2}nkA^{2}\n$$\n\n**约束系统 ($m>0$)**\n\n当 $m$ 个坐标被约束时，它们被固定在值 $s$ 上，即 $q_{j} = s$。其余的 $n-m$ 个坐标可以在 $[-A, A]$ 内自由变化。总势能 $V_{\\mathrm{corr}}$ 是来自被约束和未约束坐标贡献的总和。\n$$\nV_{\\mathrm{corr}} = \\sum_{j=1}^{m} \\frac{1}{2}k\\,s^{2} + \\sum_{i=1}^{n-m} \\frac{1}{2}k\\,q_{i}^{2}\n$$\n第一项是由于约束引起的恒定能量偏置。\n最小势能 $V_{\\min, \\mathrm{corr}}$ 出现在对未约束坐标的求和被最小化时。这发生在所有 $n-m$ 个自由坐标的 $q_{i}=0$ 时。\n$$\nV_{\\min, \\mathrm{corr}} = \\frac{1}{2}mks^{2} + \\sum_{i=1}^{n-m} \\frac{1}{2}k\\,(0)^{2} = \\frac{1}{2}mks^{2}\n$$\n最大势能 $V_{\\max, \\mathrm{corr}}$ 出现在对未约束坐标的求和被最大化时。这发生在所有 $n-m$ 个自由坐标的 $|q_{i}|=A$ 时。\n$$\nV_{\\max, \\mathrm{corr}} = \\frac{1}{2}mks^{2} + \\sum_{i=1}^{n-m} \\frac{1}{2}k\\,A^{2} = \\frac{1}{2}mks^{2} + \\frac{1}{2}(n-m)kA^{2}\n$$\n\n**能量极值的偏移**\n\n最小势能的偏移 $\\Delta V_{\\min}$ 是约束和无约束情况下的最小值之差。\n$$\n\\Delta V_{\\min} = V_{\\min, \\mathrm{corr}} - V_{\\min, 0} = \\frac{1}{2}mks^{2} - 0 = \\frac{1}{2}mks^{2}\n$$\n最大势能的偏移 $\\Delta V_{\\max}$ 是约束和无约束情况下的最大值之差。\n$$\n\\Delta V_{\\max} = V_{\\max, \\mathrm{corr}} - V_{\\max, 0} = \\left(\\frac{1}{2}mks^{2} + \\frac{1}{2}(n-m)kA^{2}\\right) - \\frac{1}{2}nkA^{2}\n$$\n$$\n\\Delta V_{\\max} = \\frac{1}{2}mks^{2} + \\frac{1}{2}nkA^{2} - \\frac{1}{2}mkA^{2} - \\frac{1}{2}nkA^{2} = \\frac{1}{2}m(ks^{2} - kA^{2})\n$$\n\n### 第2部分：GaMD 能量偏置的偏移\n\nGaMD 能量偏置定义为 $E = V_{\\min} + c\\,\\sigma_{V}$，其中 $\\sigma_V$ 是正则系综中总势能的标准差。$\\sigma_V$ 的计算是一个统计力学问题，对于理想谐振子，我们不施加有限边界 $[-A, A]$，该边界仅为分析能量范围而指定。\n\n首先，我们必须在温度为 $T$ 的正则系综中，求出单个一维谐振子势能 $v(q) = \\frac{1}{2}kq^{2}$ 的方差。坐标 $q$ 的概率分布为 $P(q) \\propto \\exp(-\\beta v(q))$，其中 $\\beta = (k_B T)^{-1}$。\n根据单个二次自由度的能量均分定理，平均势能为：\n$$\n\\langle v \\rangle = \\left\\langle \\frac{1}{2}kq^{2} \\right\\rangle = \\frac{1}{2}k_B T\n$$\n为了求方差 $\\sigma_v^2 = \\langle v^2 \\rangle - \\langle v \\rangle^2$，我们必须计算 $\\langle v^2 \\rangle$。\n坐标 $q$ 服从均值为 $0$，方差为 $\\sigma_q^2 = \\langle q^2 \\rangle$ 的高斯分布。从平均能量可知 $\\frac{1}{2}k\\langle q^2 \\rangle = \\frac{1}{2}k_B T$，这意味着 $\\langle q^2 \\rangle = \\frac{k_B T}{k}$。\n对于均值为 $0$ 的高斯变量，其四阶矩与二阶矩的关系为 $\\langle q^4 \\rangle = 3(\\langle q^2 \\rangle)^2$。\n现在我们可以计算 $\\langle v^2 \\rangle$：\n$$\n\\langle v^2 \\rangle = \\left\\langle \\left(\\frac{1}{2}kq^2\\right)^2 \\right\\rangle = \\frac{k^2}{4}\\langle q^4 \\rangle = \\frac{k^2}{4} \\cdot 3(\\langle q^2 \\rangle)^2 = \\frac{3k^2}{4} \\left(\\frac{k_B T}{k}\\right)^2 = \\frac{3}{4}(k_B T)^2\n$$\n因此，单个谐振子势能的方差为：\n$$\n\\sigma_v^2 = \\langle v^2 \\rangle - \\langle v \\rangle^2 = \\frac{3}{4}(k_B T)^2 - \\left(\\frac{1}{2}k_B T\\right)^2 = \\left(\\frac{3}{4} - \\frac{1}{4}\\right)(k_B T)^2 = \\frac{1}{2}(k_B T)^2\n$$\n\n**无约束系统 ($m=0$)**\n\n总势能为 $V_0 = \\sum_{i=1}^{n} v_i$。由于谐振子是独立的，总和的方差是方差的总和。\n$$\n\\sigma_{V,0}^2 = \\text{Var}(V_0) = \\sum_{i=1}^{n} \\sigma_{v_i}^2 = n \\sigma_v^2 = \\frac{n}{2}(k_B T)^2\n$$\n标准差为：\n$$\n\\sigma_{V,0} = \\sqrt{\\frac{n}{2}} k_B T\n$$\n无约束系统的 GaMD 偏置能为 $E_0 = V_{\\min, 0} + c\\,\\sigma_{V,0}$。使用 $V_{\\min, 0} = 0$：\n$$\nE_0 = 0 + c \\sqrt{\\frac{n}{2}} k_B T = c k_B T \\sqrt{\\frac{n}{2}}\n$$\n\n**约束系统 ($m>0$)**\n\n总势能为 $V_{\\mathrm{corr}} = \\frac{1}{2}mks^2 + \\sum_{i=1}^{n-m} v_i$。第一项是常数，对总方差没有贡献。求和是对 $n-m$ 个独立的谐振子进行的。\n$$\n\\sigma_{V, \\mathrm{corr}}^2 = \\text{Var}(V_{\\mathrm{corr}}) = \\text{Var}\\left(\\sum_{i=1}^{n-m} v_i\\right) = \\sum_{i=1}^{n-m} \\sigma_{v_i}^2 = (n-m)\\sigma_v^2 = \\frac{n-m}{2}(k_B T)^2\n$$\n修正后的标准差为：\n$$\n\\sigma_{V, \\mathrm{corr}} = \\sqrt{\\frac{n-m}{2}} k_B T\n$$\n约束系统的 GaMD 偏置能为 $E_{\\mathrm{corr}} = V_{\\min, \\mathrm{corr}} + c\\,\\sigma_{V, \\mathrm{corr}}$。使用 $V_{\\min, \\mathrm{corr}} = \\frac{1}{2}mks^2$：\n$$\nE_{\\mathrm{corr}} = \\frac{1}{2}mks^2 + c \\sqrt{\\frac{n-m}{2}} k_B T = \\frac{1}{2}mks^2 + c k_B T \\sqrt{\\frac{n-m}{2}}\n$$\n\n**GaMD 偏置能的偏移**\n\nGaMD 偏置能的偏移是差值 $E_{\\mathrm{corr}} - E_0$：\n$$\nE_{\\mathrm{corr}} - E_0 = \\left(\\frac{1}{2}mks^2 + c k_B T \\sqrt{\\frac{n-m}{2}}\\right) - \\left(c k_B T \\sqrt{\\frac{n}{2}}\\right)\n$$\n$$\nE_{\\mathrm{corr}} - E_0 = \\frac{1}{2}mks^2 + c k_B T \\left(\\sqrt{\\frac{n-m}{2}} - \\sqrt{\\frac{n}{2}}\\right)\n$$\n该表达式可以通过提取因子 $\\frac{1}{\\sqrt{2}}$ 来简化：\n$$\nE_{\\mathrm{corr}} - E_0 = \\frac{1}{2}mks^2 + \\frac{c k_B T}{\\sqrt{2}} (\\sqrt{n-m} - \\sqrt{n})\n$$\n这是 GaMD 偏置能量偏移的最终表达式，用给定的参数表示。由于 $ks^2$ 和 $k_B T$ 的单位都是能量，因此每一项的单位都是能量（焦耳）。",
            "answer": "$$\n\\boxed{\\frac{1}{2}mks^{2} + \\frac{c k_{B} T}{\\sqrt{2}} (\\sqrt{n-m} - \\sqrt{n})}\n$$"
        },
        {
            "introduction": "选择合适的GaMD参数是在模拟加速效率与热力学数据重加权准确性之间寻求平衡的艺术。本练习将挑战您在确保数值稳定性和维持重加权保真度这两个竞争目标之间做出权衡，以确定核心的谐波力常数 $k$。通过这一基于简化模型的计算实践，您将获得将理论考量转化为具体参数选择的宝贵经验 。",
            "id": "3393744",
            "problem": "在加速分子动力学 (aMD) 和高斯加速分子动力学 (GaMD) 中，引入一个偏置势来平滑底层的势能面并增强越能垒事件，同时允许通过统计重加权恢复到无偏置的热力学。考虑一个子系统的二面角势能，记为 $V$，它是通过一次短时间的常规分子动力学 (cMD) 模拟得到的。假设在平衡后，$V$ 可以很好地用均值为 $\\mu$、标准差为 $\\sigma$ 的正态分布来近似，即 $V \\sim \\mathcal{N}(\\mu,\\sigma^{2})$。在单偏置 GaMD 中，施加一个谐波偏置\n$$\n\\Delta V = \\begin{cases}\n\\dfrac{1}{2}\\,k\\,(E - V)^{2}, & V < E,\\\n[6pt]\n0, & V \\ge E,\n\\end{cases}\n$$\n其中 $k>0$ 是一个曲率参数，$E$ 是一个能量阈值。假设已从子系统的 cMD 模拟中估计出以下统计上一致的量：\n- $\\mu = 120$ kJ mol$^{-1}$，\n- $\\sigma = 25$ kJ mol$^{-1}$，\n- $V_{\\min} = 60$ kJ mol$^{-1}$ (在足够长的样本中观测到的最小 $V$ 值)，\n并且您将 GaMD 阈值设置为 $E = \\mu + 1.5\\,\\sigma$。为了解析设计的目的，假设 $V \\ge E$ 的概率足够小，以至于您可以将偏置视为始终激活，即近似为 $\\Delta V \\approx \\dfrac{1}{2}k(E-V)^{2}$ 而不进行截断。\n\n您希望根据基于重加权理论和数值稳定性的两个同步设计目标来选择 $k$：\n1) 重加权保真度目标：强制要求偏置势的标准差 $\\mathrm{sd}(\\Delta V)$ 等于目标值 $s_{0} = 10$ kJ mol$^{-1}$。\n2) 稳定性目标：强制要求在采样最小值处的最大偏置 $\\Delta V_{\\max} = \\dfrac{1}{2}k(E - V_{\\min})^{2}$ 不超过上限 $\\Delta V_{\\mathrm{cap}} = 40$ kJ mol$^{-1}$。\n\n仅从上述定义和正态随机变量的标准矩性质出发，首先推导出一个用 $\\mu$、$\\sigma$、$E$ 和 $s_{0}$ 表示的、实现重加权保真度目标的 $k$ 的解析表达式。接着，推导由稳定性目标所暗示的 $k$ 的上界。然后，通过选择最严格的选项，计算同时满足这两个目标的 $k$ 的数值。将您的最终结果表示为一个以 (kJ mol$^{-1}$)$^{-1}$ 为单位的数字，并四舍五入到 $4$ 位有效数字。",
            "solution": "该问题是有效的，因为它科学地基于加速分子动力学的原理，问题陈述清晰，信息充分且一致，并以客观、正式的语言表达。我们开始求解。\n\n问题要求确定高斯加速分子动力学 (GaMD) 中的谐波力常数 $k$，使其同时满足两个设计目标。子系统的势能 $V$ 假定服从正态分布 $V \\sim \\mathcal{N}(\\mu, \\sigma^2)$。GaMD 偏置势 $\\Delta V$ 被近似为始终激活：\n$$\n\\Delta V \\approx \\frac{1}{2}k(E-V)^2\n$$\n其中 $k>0$ 是待定参数，$E$ 是能量阈值。\n\n给定参数如下：\n- 势能均值：$\\mu = 120 \\, \\text{kJ mol}^{-1}$\n- 势能标准差：$\\sigma = 25 \\, \\text{kJ mol}^{-1}$\n- 观测到的最小势能：$V_{\\min} = 60 \\, \\text{kJ mol}^{-1}$\n- 偏置势的目标标准差：$s_0 = 10 \\, \\text{kJ mol}^{-1}$\n- 允许的最大偏置势：$\\Delta V_{\\mathrm{cap}} = 40 \\, \\text{kJ mol}^{-1}$\n\n能量阈值 $E$ 根据以下规则设置：\n$$\nE = \\mu + 1.5\\,\\sigma\n$$\n代入给定值，我们得到：\n$$\nE = 120 + 1.5 \\times 25 = 120 + 37.5 = 157.5 \\, \\text{kJ mol}^{-1}\n$$\n\n首先，我们根据重加权保真度目标推导 $k$ 的表达式。\n该目标规定偏置势的标准差 $\\mathrm{sd}(\\Delta V)$ 必须等于 $s_0$。这等价于偏置势的方差 $\\mathrm{Var}(\\Delta V)$ 等于 $s_0^2$。\n$$\n\\mathrm{Var}(\\Delta V) = E[\\Delta V^2] - (E[\\Delta V])^2 = s_0^2\n$$\n为计算期望值，我们使用随机变量 $V \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 的性质。使用中心化变量 $X = V - \\mu$ 会很方便，该变量服从分布 $X \\sim \\mathcal{N}(0, \\sigma^2)$。$X$ 的各阶矩为 $E[X]=0$，$E[X^2]=\\sigma^2$，$E[X^3]=0$ 和 $E[X^4]=3\\sigma^4$。\n\n偏置势内部的项是 $E-V = E - (\\mu + X) = (E-\\mu) - X$。\n$\\Delta V$ 的期望值为：\n$$\nE[\\Delta V] = E\\left[\\frac{1}{2}k(E-V)^2\\right] = \\frac{k}{2} E[((E-\\mu) - X)^2]\n$$\n$$\nE[\\Delta V] = \\frac{k}{2} E[(E-\\mu)^2 - 2(E-\\mu)X + X^2]\n$$\n利用期望的线性性质和 $X$ 的各阶矩：\n$$\nE[\\Delta V] = \\frac{k}{2} ((E-\\mu)^2 - 2(E-\\mu)E[X] + E[X^2]) = \\frac{k}{2} ((E-\\mu)^2 + \\sigma^2)\n$$\n接下来，我们计算 $\\Delta V^2$ 的期望：\n$$\nE[\\Delta V^2] = E\\left[\\left(\\frac{1}{2}k(E-V)^2\\right)^2\\right] = \\frac{k^2}{4} E[(E-V)^4] = \\frac{k^2}{4} E[((E-\\mu)-X)^4]\n$$\n使用二项式展开 $(a-b)^4 = a^4 - 4a^3b + 6a^2b^2 - 4ab^3 + b^4$：\n$$\nE[\\Delta V^2] = \\frac{k^2}{4} E[(E-\\mu)^4 - 4(E-\\mu)^3X + 6(E-\\mu)^2X^2 - 4(E-\\mu)X^3 + X^4]\n$$\n利用 $X$ 的各阶矩：\n$$\nE[\\Delta V^2] = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2E[X^2] + E[X^4]] = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2\\sigma^2 + 3\\sigma^4]\n$$\n现在我们计算方差：\n$$\n\\mathrm{Var}(\\Delta V) = E[\\Delta V^2] - (E[\\Delta V])^2\n$$\n$$\n\\mathrm{Var}(\\Delta V) = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2\\sigma^2 + 3\\sigma^4] - \\left(\\frac{k}{2} ((E-\\mu)^2 + \\sigma^2)\\right)^2\n$$\n$$\n\\mathrm{Var}(\\Delta V) = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2\\sigma^2 + 3\\sigma^4] - \\frac{k^2}{4} [(E-\\mu)^4 + 2(E-\\mu)^2\\sigma^2 + \\sigma^4]\n$$\n$$\n\\mathrm{Var}(\\Delta V) = \\frac{k^2}{4} [4(E-\\mu)^2\\sigma^2 + 2\\sigma^4] = \\frac{k^2\\sigma^2}{2} [2(E-\\mu)^2 + \\sigma^2]\n$$\n令其等于 $s_0^2$ 并求解 $k$（因为 $k>0$）：\n$$\ns_0^2 = \\frac{k^2\\sigma^2}{2} [2(E-\\mu)^2 + \\sigma^2]\n$$\n$$\nk^2 = \\frac{2s_0^2}{\\sigma^2(2(E-\\mu)^2 + \\sigma^2)}\n$$\n$$\nk = \\frac{\\sqrt{2}s_0}{\\sigma\\sqrt{2(E-\\mu)^2 + \\sigma^2}}\n$$\n这就是满足重加权保真度目标的 $k$ 的解析表达式。我们称此值为 $k_{\\mathrm{fidelity}}$。\n\n其次，我们从稳定性目标推导 $k$ 的上界。此目标要求最大偏置 $\\Delta V_{\\max} = \\frac{1}{2}k(E-V_{\\min})^2$ 不超过 $\\Delta V_{\\mathrm{cap}}$。\n$$\n\\frac{1}{2}k(E - V_{\\min})^2 \\le \\Delta V_{\\mathrm{cap}}\n$$\n求解 $k$ 得到上界：\n$$\nk \\le \\frac{2\\Delta V_{\\mathrm{cap}}}{(E - V_{\\min})^2}\n$$\n我们称此上限为 $k_{\\mathrm{stability\\_max}}$。\n\n现在，我们计算数值。\n首先，我们计算 $k_{\\mathrm{fidelity}}$ 所需的各项：\n- $E-\\mu = 157.5 - 120 = 37.5$\n- $\\sigma = 25$\n- $s_0 = 10$\n$$\nk_{\\mathrm{fidelity}} = \\frac{\\sqrt{2} \\times 10}{25\\sqrt{2(37.5)^2 + (25)^2}} = \\frac{10\\sqrt{2}}{25\\sqrt{2(1406.25) + 625}} = \\frac{10\\sqrt{2}}{25\\sqrt{2812.5 + 625}} = \\frac{10\\sqrt{2}}{25\\sqrt{3437.5}}\n$$\n$$\nk_{\\mathrm{fidelity}} \\approx \\frac{14.142136}{25 \\times 58.6302} \\approx \\frac{14.142136}{1465.755} \\approx 0.00964836 \\, (\\text{kJ mol}^{-1})^{-1}\n$$\n接下来，我们计算上界 $k_{\\mathrm{stability\\_max}}$：\n- $E - V_{\\min} = 157.5 - 60 = 97.5$\n- $\\Delta V_{\\mathrm{cap}} = 40$\n$$\nk_{\\mathrm{stability\\_max}} = \\frac{2 \\times 40}{(97.5)^2} = \\frac{80}{9506.25} \\approx 0.00841552 \\, (\\text{kJ mol}^{-1})^{-1}\n$$\n要同时满足两个目标，我们选择的 $k$ 必须为 $k_{\\mathrm{fidelity}}$，且此选择必须满足稳定性约束 $k \\le k_{\\mathrm{stability\\_max}}$。\n我们比较这两个值：\n$$\nk_{\\mathrm{fidelity}} \\approx 0.009648\n$$\n$$\nk_{\\mathrm{stability\\_max}} \\approx 0.008416\n$$\n由于 $k_{\\mathrm{fidelity}} > k_{\\mathrm{stability\\_max}}$，为达到期望的重加权保真度所需的 $k$ 值违反了数值稳定性准则。因此，我们必须选择最严格的选项，即稳定性目标允许的最大值。这确保了模拟保持稳定，代价是无法完美达到目标偏置标准差。\n$k$ 的最终值为：\n$$\nk = k_{\\mathrm{stability\\_max}} \\approx 0.00841552 \\, (\\text{kJ mol}^{-1})^{-1}\n$$\n根据要求四舍五入到 $4$ 位有效数字，我们得到 $0.008416$。",
            "answer": "$$\n\\boxed{0.008416}\n$$"
        },
        {
            "introduction": "静态参数在漫长的模拟中可能并非最优，因此自adaptive算法是提升GaMD性能的关键。本练习要求您通过编程实现一个反馈控制系统，它能实时监控增强势分布的高斯性，并动态调整其强度。这项高级实践模拟了研究级别的自适应增强采样方法，旨在培养您创建能够响应系统动态演化的、稳健模拟的实用技能 。",
            "id": "3393748",
            "problem": "您需要实现一个自动化的高斯性检测器，用于高斯加速分子动力学 (GaMD) 中使用的增强势时间序列，并用它在模拟的生产运行期间动态调整谐波分数参数 $k_0$。目标是使累积的增强势增量随时间的分布保持近似高斯分布，从而使二阶累积量展开仍然合理。\n\n请使用以下基本依据和定义。\n\n- 在高斯加速分子动力学 (GaMD) 中，一个谐波增强势被施加到系统上。自由能重加权的统计效率和理论一致性取决于增强势增量近似服从正态分布。正态性可以通过标准的统计检验和分位数诊断来评估。\n- 对于数据向量 $x = (x_1,\\dots,x_n)$，定义 $z$-分数样本 $z_i = (x_i - \\bar{x})/s_x$，其中 $\\bar{x}$ 是样本均值，$s_x$ 是样本标准差。如果对于某个小容差 $\\varepsilon$，有 $s_x \\le \\varepsilon$，则将该窗口视为非高斯。\n- 设 $\\Phi$ 为标准正态分布的累积分布函数，$\\Phi^{-1}$ 为其分位数函数。设 $z_{(1)} \\le \\dots \\le z_{(n)}$ 为 $z$-分数的顺序统计量。定义理论分位数 $q_i = \\Phi^{-1}\\!\\left(\\frac{i - 0.5}{n}\\right)$，其中 $i = 1,\\dots,n$。定义均方根分位数残差\n  $$\\rho = \\left( \\frac{1}{n} \\sum_{i=1}^{n} \\left(z_{(i)} - q_i \\right)^2 \\right)^{1/2}.$$\n- 定义针对 $z$-分数的标准正态分布的 Kolmogorov–Smirnov 检验 $p$-值 为 $p_{\\mathrm{KS}} \\in [0,1]$。一个窗口被接受为近似高斯，当且仅当同时满足 $\\rho \\le \\tau$ 和 $p_{\\mathrm{KS}} \\ge \\alpha$，其中 $\\tau > 0$ 和 $\\alpha \\in (0,1)$ 是用户指定的阈值。\n- 考虑在单变量时间序列 $(X_t)_{t=1}^{N}$ 上使用滚动窗口方案，窗口宽度为 $W$，步长为 $S$。对于窗口起始索引 $t \\in \\{1, 1+S, 1+2S, \\dots\\}$，且满足 $t+W-1 \\le N$，计算窗口 $(X_t,\\dots,X_{t+W-1})$ 的高斯性判定。\n- 设谐波分数参数 $k_0$ 按以下规则在线更新\n  $$k_0 \\leftarrow \\mathrm{clamp}\\!\\left(k_0 + \\eta_{\\uparrow}\\right) \\text{ 如果窗口被接受为高斯, 否则 } k_0 \\leftarrow \\mathrm{clamp}\\!\\left(k_0 - \\eta_{\\downarrow}\\right),$$\n  其中 $\\eta_{\\uparrow} > 0$ 和 $\\eta_{\\downarrow} > 0$ 是步长，且\n  $$\\mathrm{clamp}(x) = \\min\\{\\max\\{x, k_{0,\\min}\\}, k_{0,\\max}\\}.$$\n  区间端点 $k_{0,\\min}$ 和 $k_{0,\\max}$ 满足 $0  k_{0,\\min}  k_{0,\\max}  1$。参数 $k_0$ 是无量纲的。\n\n实现一个程序，对于给定的合成时间序列和参数，在处理完所有滚动窗口后，返回 $k_0$ 的最终值。时间序列 $(X_t)$ 将使用带有固定种子的伪随机数生成器从指定的分布中生成。在这个合成设置中，增强势增量是无量纲的，您应按照规定在每个窗口内进行标准化。所有计算输出都是无量纲实数，并且必须四舍五入到六位小数。\n\n必须将滚动窗口高斯性检测和控制应用于以下测试套件。对于每种情况，按规定生成时间序列 $(X_t)$，然后应用滚动窗口程序和 $k_0$ 的动态更新。\n\n- 情况1 (高斯基线增长):\n  - 生成：对于 $t=1,\\dots,N$，$X_t \\sim \\mathcal{N}(0,1)$ 独立同分布，种子 $s = 20240501$。\n  - 参数: $N = 2000$, $W = 200$, $S = 100$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.3$, $\\eta_{\\uparrow} = 0.02$, $\\eta_{\\downarrow} = 0.05$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.99$。\n\n- 情况2 (重尾抑制):\n  - 生成：对于 $t=1,\\dots,N$，$X_t \\sim \\mathrm{Laplace}(0,1)$ 独立同分布，种子 $s = 20240502$。位置为 $0$、尺度为 $1$ 的拉普拉斯分布的密度为 $f(x) = \\frac{1}{2} e^{-|x|}$。\n  - 参数: $N = 2000$, $W = 200$, $S = 100$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.8$, $\\eta_{\\uparrow} = 0.02$, $\\eta_{\\downarrow} = 0.05$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.99$。\n\n- 情况3 (具有不重叠窗口的块混合):\n  - 生成：对于 $N = 1000$ 个点，种子 $s = 20240503$，前 $\\lfloor 0.6 N \\rfloor$ 个点独立从 $\\mathcal{N}(0,1)$ 中抽取，其余点独立从 $\\mathrm{Laplace}(0,1)$ 中抽取。按此顺序连接以形成 $(X_t)$。\n  - 参数: $N = 1000$, $W = 200$, $S = 200$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.4$, $\\eta_{\\uparrow} = 0.1$, $\\eta_{\\downarrow} = 0.2$, $k_{0,\\min} = 0.1$, $k_{0,\\max} = 0.9$。\n\n- 情况4 (退化的零方差窗口):\n  - 生成：确定性常数序列 $X_t = 0$，对所有 $t=1,\\dots,N$ (无随机性)。\n  - 参数: $N = 200$, $W = 50$, $S = 25$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.2$, $\\eta_{\\uparrow} = 0.01$, $\\eta_{\\downarrow} = 0.03$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.99$。将任何样本标准差 $\\le \\varepsilon$（其中 $\\varepsilon = 10^{-12}$）的窗口视为非高斯。\n\n- 情况5 (交替块):\n  - 生成：对于 $N = 1200$ 个点，种子 $s = 20240505$ 且 $W = 200$，创建 6 个长度为 $W$ 的连续块，从 $\\mathcal{N}(0,1)$ 开始，在 $\\mathcal{N}(0,1)$ 和 $\\mathrm{Laplace}(0,1)$ 之间交替，并连接以形成 $(X_t)$。\n  - 参数: $N = 1200$, $W = 200$, $S = 200$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.5$, $\\eta_{\\uparrow} = 0.05$, $\\eta_{\\downarrow} = 0.05$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.95$。\n\n您的程序必须为每种情况实现以下步骤。\n\n- 完全按照情况规定生成 $(X_t)_{t=1}^{N}$。\n- 对于每个步长为 $S$ 的窗口 $(X_t,\\dots,X_{t+W-1})$，计算 $z$-分数、均方根分位数残差 $\\rho$ 以及相对于标准正态分布的 Kolmogorov–Smirnov $p$-值 $p_{\\mathrm{KS}}$。如果窗口中的样本标准差 $\\le \\varepsilon$（其中 $\\varepsilon = 10^{-12}$），则将该窗口视为非高斯。\n- 通过同时要求 $\\rho \\le \\tau$ 和 $p_{\\mathrm{KS}} \\ge \\alpha$ 来判定高斯性。\n- 根据给定规则更新 $k_0$，并将其限制在 $[k_{0,\\min}, k_{0,\\max}]$ 范围内。\n- 处理完所有窗口后，记录最终的 $k_0$ 值（无量纲）并四舍五入到六位小数。\n\n最终输出格式要求：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4,result5]”），其中每个结果是对应情况的最终 $k_0$ 值，四舍五入到六位小数。\n\n注。\n\n- 本问题中的所有数学符号和数字都应按字面意思解释；输出是无物理单位的实数（无量纲）。\n- 本问题中不使用角度。",
            "solution": "问题陈述已经过分析并被认为是有效的。它在科学上基于分子动力学中增强采样方法的原理，问题阐述清晰，提供了所有必要信息，并且其定义和要求的任务是客观的。\n\n该问题要求为高斯加速分子动力学 (GaMD) 中的谐波分数参数 $k_0$ 实现一个在线控制算法。此程序背后的基本原理是要求所施加的增强势 $\\Delta V$ 服从近似高斯分布。这对于可观测量（observables）的解析重加权以恢复正则系综平均至关重要，因为当二阶累积量展开足够时，重加权公式最易于处理且理论上最健全，而 $\\Delta V$ 的正态性为此提供了依据。\n\n所提出的算法通过对增强势增量的时间序列 $(X_t)$ 进行滚动窗口统计分析，将这一原理付诸实践。对于每个宽度为 $W$ 的数据窗口，我们使用一个包含两部分的统计检验，对 $z$-分数数据 $z_i=(x_i - \\bar{x})/s_x$ 进行检验，以评估其与高斯分布的偏差。接受一个窗口为“高斯”的标准是：\n1.  Kolmogorov-Smirnov (KS) 检验的 $p$-值 $p_{\\mathrm{KS}}$ 必须大于或等于一个显著性阈值 $\\alpha$。KS 检验是一种非参数检验，它将样本的经验累积分布函数 (ECDF) 与参考分布的理论累积分布函数 (CDF) 进行比较——在本例中，参考分布是标准正态分布 $\\mathcal{N}(0,1)$。一个小的 $p$-值表明样本分布与参考分布有显著差异。\n2.  均方根分位数残差 $\\rho$ 必须小于或等于一个容差 $\\tau$。该度量源于分位数-分位数 (Q-Q) 图分析。它测量样本分位数 $z_{(i)}$ 与标准正态分布的理论分位数 $q_i = \\Phi^{-1}\\!\\left(\\frac{i - 0.5}{n}\\right)$ 之间的平均偏差。这种检验对分布尾部的差异特别敏感，而这在统计力学中通常至关重要。\n\n对于样本标准差 $s_x$ 低于某个小容差 $\\varepsilon$ 的数据窗口，会作为特殊情况处理，立即将其归类为非高斯。这能正确识别出那些因缺乏方差而无法与正态分布进行有意义比较的退化或近退化窗口。\n\n基于这个二元决策（高斯或非高斯），参数 $k_0$ 会根据一个反馈控制规则进行动态调整。如果窗口被认为是高斯分布，则 $k_0$ 增加一个步长 $\\eta_{\\uparrow}$，这反映了可以施加更强（也更有效）的偏置势的信心。相反，如果检测到非高斯特性，则 $k_0$ 减少一个步长 $\\eta_{\\downarrow}$，这是一个纠正措施，旨在降低偏置强度，引导系统回到高斯近似成立的状态。参数 $k_0$ 使用一个钳位函数被限制在预定义的范围 $[k_{0,\\min}, k_{0,\\max}]$ 内，以确保其稳定性。\n\n对于每个测试用例，实现过程包括以下步骤：\n1.  使用带种子的伪随机数生成器，根据指定的分布（$\\mathcal{N}(0,1)$、$\\mathrm{Laplace}(0,1)$ 或它们的混合）生成长度为 $N$ 的合成时间序列 $(X_t)_{t=1}^{N}$，以确保可复现性。\n2.  将参数 $k_0$ 初始化为其起始值 $k_0^{(0)}$。\n3.  使用宽度为 $W$、步长为 $S$ 的滚动窗口遍历时间序列。\n4.  在每个窗口内，计算样本标准差 $s_x$。如果 $s_x \\le \\varepsilon = 10^{-12}$，则该窗口被归类为非高斯。否则，对数据进行 $z$-分数转换，并计算 $p_{\\mathrm{KS}}$ 和 $\\rho$。\n5.  应用决策规则：当且仅当 $p_{\\mathrm{KS}} \\ge \\alpha$ 且 $\\rho \\le \\tau$ 时，窗口被接受为高斯分布。\n6.  根据决策更新 $k_0$，使用更新规则 $k_0 \\leftarrow k_0 + \\eta_{\\uparrow}$ (高斯) 或 $k_0 \\leftarrow k_0 - \\eta_{\\downarrow}$ (非高斯)，然后将其钳位到区间 $[k_{0,\\min}, k_{0,\\max}]$。\n7.  在处理完所有窗口后，报告最终的 $k_0$ 值，四舍五入到六位小数。\n\n整个过程被封装在一个程序中，该程序处理五个不同的测试用例，每个用例都旨在探究算法行为的不同方面，例如其对纯高斯数据、重尾数据、混合数据和退化数据的响应。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import kstest, norm\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the final results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case 1 (Gaussian baseline growth)\",\n            \"generation_type\": \"gaussian\",\n            \"seed\": 20240501,\n            \"N\": 2000, \"W\": 200, \"S\": 100,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.3, \"eta_up\": 0.02, \"eta_down\": 0.05,\n            \"k0_min\": 0.05, \"k0_max\": 0.99,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 2 (Heavy-tailed suppression)\",\n            \"generation_type\": \"laplace\",\n            \"seed\": 20240502,\n            \"N\": 2000, \"W\": 200, \"S\": 100,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.8, \"eta_up\": 0.02, \"eta_down\": 0.05,\n            \"k0_min\": 0.05, \"k0_max\": 0.99,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 3 (Block mixture with non-overlapping windows)\",\n            \"generation_type\": \"block_mixture\",\n            \"seed\": 20240503,\n            \"N\": 1000, \"W\": 200, \"S\": 200,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.4, \"eta_up\": 0.1, \"eta_down\": 0.2,\n            \"k0_min\": 0.1, \"k0_max\": 0.9,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 4 (Degenerate zero-variance windows)\",\n            \"generation_type\": \"degenerate\",\n            \"seed\": None, # No randomness needed\n            \"N\": 200, \"W\": 50, \"S\": 25,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.2, \"eta_up\": 0.01, \"eta_down\": 0.03,\n            \"k0_min\": 0.05, \"k0_max\": 0.99,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 5 (Alternating blocks)\",\n            \"generation_type\": \"alternating_blocks\",\n            \"seed\": 20240505,\n            \"N\": 1200, \"W\": 200, \"S\": 200,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.5, \"eta_up\": 0.05, \"eta_down\": 0.05,\n            \"k0_min\": 0.05, \"k0_max\": 0.95,\n            \"epsilon\": 1e-12\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        final_k0 = run_simulation_case(params)\n        results.append(f\"{final_k0:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef run_simulation_case(params):\n    \"\"\"\n    Runs a single simulation case for GaMD k0 parameter adjustment.\n    \n    Args:\n        params (dict): A dictionary containing all parameters for the simulation.\n        \n    Returns:\n        float: The final value of k0 after processing all windows.\n    \"\"\"\n    # Unpack parameters from the dictionary\n    N, W, S = params[\"N\"], params[\"W\"], params[\"S\"]\n    alpha, tau, epsilon = params[\"alpha\"], params[\"tau\"], params[\"epsilon\"]\n    k0_init, eta_up, eta_down = params[\"k0_init\"], params[\"eta_up\"], params[\"eta_down\"]\n    k0_min, k0_max = params[\"k0_min\"], params[\"k0_max\"]\n    seed = params[\"seed\"]\n    generation_type = params[\"generation_type\"]\n    \n    # --- 1. Generate Time Series X_t ---\n    if seed is not None:\n        rng = np.random.default_rng(seed)\n\n    if generation_type == \"gaussian\":\n        X = rng.normal(loc=0, scale=1, size=N)\n    elif generation_type == \"laplace\":\n        X = rng.laplace(loc=0, scale=1, size=N)\n    elif generation_type == \"block_mixture\":\n        n_gauss = int(np.floor(0.6 * N))\n        n_laplace = N - n_gauss\n        X_gauss = rng.normal(loc=0, scale=1, size=n_gauss)\n        X_laplace = rng.laplace(loc=0, scale=1, size=n_laplace)\n        X = np.concatenate((X_gauss, X_laplace))\n    elif generation_type == \"alternating_blocks\":\n        num_blocks = N // W\n        blocks = []\n        for i in range(num_blocks):\n            if i % 2 == 0:  # Gaussian block\n                blocks.append(rng.normal(loc=0, scale=1, size=W))\n            else:  # Laplace block\n                blocks.append(rng.laplace(loc=0, scale=1, size=W))\n        X = np.concatenate(blocks)\n    elif generation_type == \"degenerate\":\n        X = np.zeros(N)\n    \n    k0 = k0_init\n\n    # --- 2. Rolling Window Analysis ---\n    for t_start in range(0, N - W + 1, S):\n        window = X[t_start : t_start + W]\n        \n        # Use ddof=1 for sample standard deviation, as is standard.\n        s_x = np.std(window, ddof=1)\n        \n        is_gaussian = False\n        if s_x > epsilon:\n            # Z-score the window data\n            x_mean = np.mean(window)\n            z_scores = (window - x_mean) / s_x\n            \n            # Kolmogorov-Smirnov test against standard normal distribution\n            _, p_ks = kstest(z_scores, 'norm')\n            \n            # Root-mean-square quantile residual (rho)\n            n_samples = len(z_scores)\n            z_ordered = np.sort(z_scores)\n            \n            # Theoretical quantiles q_i\n            i = np.arange(1, n_samples + 1)\n            p_i = (i - 0.5) / n_samples\n            q_i = norm.ppf(p_i)\n            \n            rho = np.sqrt(np.mean((z_ordered - q_i)**2))\n            \n            # Gaussianity decision - both conditions must be met\n            if rho = tau and p_ks >= alpha:\n                is_gaussian = True\n        \n        # If s_x = epsilon, the window is considered non-Gaussian by definition.\n        \n        # --- 3. Update and Clamp k0 ---\n        if is_gaussian:\n            k0 += eta_up\n        else:\n            k0 -= eta_down\n            \n        k0 = np.clip(k0, k0_min, k0_max)\n        \n    return k0\n\nsolve()\n```"
        }
    ]
}