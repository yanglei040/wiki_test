{
    "hands_on_practices": [
        {
            "introduction": "在分子动力学模拟中，最直接的非键相互作用处理方法是“硬截断”，即在截断半径 $r_{\\text{cut}}$ 之外完全忽略相互作用。然而，这种简单的做法会在截断处引入一个非物理的力的不连续性，可能严重破坏能量守恒和模拟的稳定性。本练习旨在通过计算一个无量纲比率，来量化这种力不连续性的严重程度，从而帮助您直观地理解为何需要更复杂的截断方案 。",
            "id": "3429360",
            "problem": "考虑一个由 Lennard-Jones (LJ) 势函数建模的单个非键对相互作用，其定义为 $V_{\\mathrm{LJ}}(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$，其中 $\\epsilon$ 和 $\\sigma$ 分别是特征能量和长度尺度。在分子动力学 (MD) 中，一种常见的非键截断策略是在截断半径 $r_{\\mathrm{cut}}$ 处进行直接截断，对于 $r > r_{\\mathrm{cut}}$，设置 $V_{\\mathrm{LJ}}(r) = 0$，这意味着力 $F(r)$ 在 $r_{\\mathrm{cut}}$ 处跳变为 $0$。从牛顿第二定律以及力是势的负梯度的定义出发，分析直接截断引入的不连续性。\n\n设截断半径为 $r_{\\mathrm{cut}} = 2.5\\sigma$。将直接截断下的力不连续性的大小定义为跳变 $|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{-}) - F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{+})|$，注意到 $F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{+}) = 0$。为了评估数值稳定性，将这个由不连续性引起的加速度变化与一个质量为 $m$、在温度 $T$ 下以热速度 $v_{\\mathrm{rms}}$ 运动的粒子在一个时间步长 $\\Delta t$ 内的典型平滑加速度变化进行比较。使用均方根速率 $v_{\\mathrm{rms}} = \\sqrt{\\frac{3 k_B T}{m}}$，其中 $k_B$ 是 Boltzmann 常数，并通过在 $r_{\\mathrm{cut}}$ 附近线性化，将平滑加速度大小的变化估计为 $\\Delta a_{\\mathrm{smooth}} \\approx \\frac{|\\,\\frac{\\mathrm{d}F}{\\mathrm{d}r}(r_{\\mathrm{cut}})\\,|\\, v_{\\mathrm{rms}} \\Delta t}{m}$。\n\n计算在 $r_{\\mathrm{cut}} = 2.5\\sigma$ 时的无量纲稳定性比率 $S = \\frac{\\Delta a_{\\mathrm{disc}}}{\\Delta a_{\\mathrm{smooth}}}$，其中 $\\Delta a_{\\mathrm{disc}} = \\frac{|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}})|}{m}$。使用以下符合物理实际的参数：$\\epsilon/k_B = 120\\,\\mathrm{K}$，$\\sigma = 3.4\\,\\mathrm{\\AA}$，$m = 39.948\\,\\mathrm{amu}$，$T = 300\\,\\mathrm{K}$，以及 $\\Delta t = 2\\,\\mathrm{fs}$。全程使用国际单位制 (SI)，其中 $k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$ 且 $1\\,\\mathrm{amu} = 1.66053906660 \\times 10^{-27}\\,\\mathrm{kg}$。\n\n将你的最终答案表示为单个无量纲数 $S$，并四舍五入到四位有效数字。",
            "solution": "用户希望分析 Lennard-Jones 势中因直接截断而产生的力不连续性，并计算无量纲稳定性比率 $S$。\n\n首先，验证问题陈述。\n**第1步：提取已知条件**\n- Lennard-Jones 势：$V_{\\mathrm{LJ}}(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$\n- 直接截断：对于 $r > r_{\\mathrm{cut}}$，$V_{\\mathrm{LJ}}(r) = 0$\n- 截断半径：$r_{\\mathrm{cut}} = 2.5\\sigma$\n- 力的定义：$F(r) = -\\frac{\\mathrm{d}V(r)}{\\mathrm{d}r}$\n- 在 $r_{\\mathrm{cut}}^{+}$ 处的力：$F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{+}) = 0$\n- 力不连续性的大小：$|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{-}) - F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{+})| = |F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{-})|$\n- 不连续性引起的加速度变化：$\\Delta a_{\\mathrm{disc}} = \\frac{|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}})|}{m}$\n- 均方根速率：$v_{\\mathrm{rms}} = \\sqrt{\\frac{3 k_B T}{m}}$\n- 平滑加速度变化：$\\Delta a_{\\mathrm{smooth}} \\approx \\frac{|\\,\\frac{\\mathrm{d}F}{\\mathrm{d}r}(r_{\\mathrm{cut}})\\,|\\, v_{\\mathrm{rms}} \\Delta t}{m}$\n- 无量纲稳定性比率：$S = \\frac{\\Delta a_{\\mathrm{disc}}}{\\Delta a_{\\mathrm{smooth}}}$\n- 参数：$\\epsilon/k_B = 120\\,\\mathrm{K}$，$\\sigma = 3.4\\,\\mathrm{\\AA}$，$m = 39.948\\,\\mathrm{amu}$，$T = 300\\,\\mathrm{K}$，$\\Delta t = 2\\,\\mathrm{fs}$。\n- 常数：$k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$，$1\\,\\mathrm{amu} = 1.66053906660 \\times 10^{-27}\\,\\mathrm{kg}$。\n- 最终答案格式：单个无量纲数 $S$，四舍五入到四位有效数字。\n\n**第2步：使用提取的已知条件进行验证**\n问题具有科学依据，使用了标准的 Lennard-Jones 势以及经典力学和统计力学的基本概念。问题提法很严谨，为得到唯一解提供了所有必要的定义、常数和参数。语言客观而精确。问题直接关系到分子动力学模拟中的一个关键数值问题。未发现任何缺陷。\n\n**第3步：结论与行动**\n问题有效。将提供完整解答。\n\n目标是计算无量纲稳定性比率 $S$，其定义为由力不连续性引起的加速度变化 $\\Delta a_{\\mathrm{disc}}$ 与一个时间步长内估计的平滑加速度变化 $\\Delta a_{\\mathrm{smooth}}$ 之比。\n\nLennard-Jones (LJ) 势由下式给出：\n$$V_{\\mathrm{LJ}}(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right] = 4\\epsilon\\left(\\sigma^{12}r^{-12} - \\sigma^{6}r^{-6}\\right)$$\n力 $F_{\\mathrm{LJ}}(r)$ 是势的负梯度：\n$$F_{\\mathrm{LJ}}(r) = -\\frac{\\mathrm{d}V_{\\mathrm{LJ}}(r)}{\\mathrm{d}r} = -4\\epsilon\\left(-12\\sigma^{12}r^{-13} - (-6)\\sigma^{6}r^{-7}\\right)$$\n$$F_{\\mathrm{LJ}}(r) = 4\\epsilon\\left(12\\sigma^{12}r^{-13} - 6\\sigma^{6}r^{-7}\\right) = \\frac{24\\epsilon}{r}\\left[2\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$$\n截断半径 $r_{\\mathrm{cut}}$ 处的力不连续性为 $|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{-}) - F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{+})|$。对于直接截断，当 $r > r_{\\mathrm{cut}}$ 时，$V_{\\mathrm{LJ}}(r) = 0$，这意味着 $F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{+}) = 0$。因此，不连续性为 $|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}}^{-})| = |F_{\\mathrm{LJ}}(r_{\\mathrm{cut}})|$。相关的加速度变化为 $\\Delta a_{\\mathrm{disc}} = \\frac{|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}})|}{m}$。\n\n平滑加速度变化通过使用力对位置的导数 $\\frac{\\mathrm{d}F}{\\mathrm{d}r}$ 来估计，该导数代表势的“刚度”。\n$$\\frac{\\mathrm{d}F_{\\mathrm{LJ}}(r)}{\\mathrm{d}r} = \\frac{\\mathrm{d}}{\\mathrm{d}r}\\left(48\\epsilon\\sigma^{12}r^{-13} - 24\\epsilon\\sigma^{6}r^{-7}\\right)$$\n$$\\frac{\\mathrm{d}F_{\\mathrm{LJ}}(r)}{\\mathrm{d}r} = 48\\epsilon\\sigma^{12}(-13)r^{-14} - 24\\epsilon\\sigma^{6}(-7)r^{-8} = -624\\epsilon\\sigma^{12}r^{-14} + 168\\epsilon\\sigma^{6}r^{-8}$$\n$$\\frac{\\mathrm{d}F_{\\mathrm{LJ}}(r)}{\\mathrm{d}r} = \\frac{24\\epsilon}{r^2}\\left[-26\\left(\\frac{\\sigma}{r}\\right)^{12} + 7\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$$\n估计的平滑加速度变化为 $\\Delta a_{\\mathrm{smooth}} = \\frac{|\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}r}(r_{\\mathrm{cut}})| v_{\\mathrm{rms}} \\Delta t}{m}$。\n\n稳定性比率 $S$ 为：\n$$S = \\frac{\\Delta a_{\\mathrm{disc}}}{\\Delta a_{\\mathrm{smooth}}} = \\frac{|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}})|/m}{|\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}r}(r_{\\mathrm{cut}})| v_{\\mathrm{rms}} \\Delta t/m} = \\frac{|F_{\\mathrm{LJ}}(r_{\\mathrm{cut}})|}{|\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}r}(r_{\\mathrm{cut}})| v_{\\mathrm{rms}} \\Delta t}$$\n让我们引入无量纲距离 $x = r/\\sigma$。截断点位于 $x_{\\mathrm{cut}} = r_{\\mathrm{cut}}/\\sigma = 2.5$。\n力及其导数可以用 $x$ 表示：\n$$F_{\\mathrm{LJ}}(x) = \\frac{24\\epsilon}{\\sigma x}\\left[2x^{-12} - x^{-6}\\right]$$\n$$\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}r} = \\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}x}\\frac{\\mathrm{d}x}{\\mathrm{d}r} = \\frac{1}{\\sigma}\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}x} = \\frac{1}{\\sigma}\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(48\\epsilon\\sigma^{11}x^{-13} - 24\\epsilon\\sigma^5 x^{-7}\\right) = \\frac{24\\epsilon}{\\sigma^2}\\left[-26x^{-14} + 7x^{-8}\\right]$$\n现在，将这些代入 $S$ 的表达式中：\n$$S = \\frac{\\left| \\frac{24\\epsilon}{r_{\\mathrm{cut}}}\\left[2\\left(\\frac{\\sigma}{r_{\\mathrm{cut}}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{\\mathrm{cut}}}\\right)^{6}\\right] \\right|}{\\left| \\frac{24\\epsilon}{r_{\\mathrm{cut}}^2}\\left[-26\\left(\\frac{\\sigma}{r_{\\mathrm{cut}}}\\right)^{12} + 7\\left(\\frac{\\sigma}{r_{\\mathrm{cut}}}\\right)^{6}\\right] \\right| v_{\\mathrm{rms}} \\Delta t}$$\n因子 $24\\epsilon$ 被消去。设 $u = \\sigma/r_{\\mathrm{cut}}$。\n$$S = \\frac{r_{\\mathrm{cut}} |2u^{12} - u^6|}{(|-26u^{12} + 7u^6|) v_{\\mathrm{rms}} \\Delta t} = \\frac{r_{\\mathrm{cut}}}{v_{\\mathrm{rms}} \\Delta t} \\frac{|2u^{12} - u^6|}{|-26u^{12} + 7u^6|}$$\n使用 $x_{\\mathrm{cut}} = r_{\\mathrm{cut}}/\\sigma = 2.5$，我们得到 $u = 1/2.5 = 0.4$。\n当 $r > \\sigma$ 时，吸引项 $r^{-6}$ 主导排斥项 $r^{-12}$。在 $r_{\\mathrm{cut}} = 2.5\\sigma$ 处，力是吸引力，因此 $F_{\\mathrm{LJ}}  0$。$2(\\frac{\\sigma}{r_{\\mathrm{cut}}})^{12} - (\\frac{\\sigma}{r_{\\mathrm{cut}}})^{6} = 2(2.5)^{-12} - (2.5)^{-6}  0$。另外，我们需要确定在 $r_{\\mathrm{cut}}$ 处力导数 $\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}r}$ 的符号，其正负由 $-26(\\sigma/r)^{12} + 7(\\sigma/r)^{6}$ 决定。在 $r_{\\mathrm{cut}} = 2.5\\sigma$ 处，$(\\sigma/r)^6 = (0.4)^6 = 0.004096$，远小于 $1$。因此 $7 - 26(0.4)^6 > 0$，这意味着 $\\frac{\\mathrm{d}F_{\\mathrm{LJ}}}{\\mathrm{d}r}$ 为正。\n因此， $|2u^{12} - u^6| = u^6(1 - 2u^6)$ 并且 $|-26u^{12} + 7u^6| = u^6(7 - 26u^6)$。\n$$S = \\frac{r_{\\mathrm{cut}}}{v_{\\mathrm{rms}} \\Delta t} \\frac{u^6(1 - 2u^6)}{ u^6(7 - 26u^6)} = \\frac{r_{\\mathrm{cut}}}{v_{\\mathrm{rms}} \\Delta t} \\frac{1 - 2u^6}{7 - 26u^6}$$\n代入 $u = \\sigma/r_{\\mathrm{cut}}$:\n$$S = \\frac{r_{\\mathrm{cut}}}{v_{\\mathrm{rms}} \\Delta t} \\frac{1 - 2(r_{\\mathrm{cut}}/\\sigma)^{-6}}{7 - 26(r_{\\mathrm{cut}}/\\sigma)^{-6}}$$\n现在我们代入国际单位制 (SI) 的数值。\n$r_{\\mathrm{cut}} = 2.5 \\times \\sigma = 2.5 \\times (3.4 \\times 10^{-10} \\,\\mathrm{m}) = 8.5 \\times 10^{-10} \\,\\mathrm{m}$。\n$m = 39.948 \\,\\mathrm{amu} \\times (1.66053906660 \\times 10^{-27} \\,\\mathrm{kg/amu}) = 6.63352 \\times 10^{-26} \\,\\mathrm{kg}$。\n$T = 300 \\,\\mathrm{K}$。\n$\\Delta t = 2 \\,\\mathrm{fs} = 2 \\times 10^{-15} \\,\\mathrm{s}$。\n$k_B = 1.380649 \\times 10^{-23} \\,\\mathrm{J\\,K^{-1}}$。\n首先，计算 $v_{\\mathrm{rms}}$：\n$$v_{\\mathrm{rms}} = \\sqrt{\\frac{3 k_B T}{m}} = \\sqrt{\\frac{3 \\times (1.380649 \\times 10^{-23} \\,\\mathrm{J\\,K^{-1}}) \\times (300 \\,\\mathrm{K})}{6.63352 \\times 10^{-26} \\,\\mathrm{kg}}}$$\n$$v_{\\mathrm{rms}} = \\sqrt{\\frac{1.2425841 \\times 10^{-20} \\,\\mathrm{J}}{6.63352 \\times 10^{-26} \\,\\mathrm{kg}}} = \\sqrt{187319.47 \\,\\mathrm{m^2\\,s^{-2}}} \\approx 432.804 \\,\\mathrm{m\\,s^{-1}}$$\n接下来，计算分母项 $v_{\\mathrm{rms}} \\Delta t$：\n$$v_{\\mathrm{rms}} \\Delta t = (432.804 \\,\\mathrm{m\\,s^{-1}}) \\times (2 \\times 10^{-15} \\,\\mathrm{s}) = 8.65608 \\times 10^{-13} \\,\\mathrm{m}$$\n现在，计算包含 $r_{\\mathrm{cut}}/\\sigma = 2.5$ 的无量纲分数：\n$$f = \\frac{1 - 2(2.5)^{-6}}{7 - 26(2.5)^{-6}}$$\n$(2.5)^{-6} = ( \\frac{2}{5} )^6 = \\frac{64}{15625} = 0.004096$.\n$$f = \\frac{1 - 2(0.004096)}{7 - 26(0.004096)} = \\frac{1 - 0.008192}{7 - 0.106496} = \\frac{0.991808}{6.893504} \\approx 0.143875$$\n最后，计算 $S$：\n$$S = \\frac{r_{\\mathrm{cut}}}{v_{\\mathrm{rms}} \\Delta t} \\times f = \\frac{8.5 \\times 10^{-10} \\,\\mathrm{m}}{8.65608 \\times 10^{-13} \\,\\mathrm{m}} \\times 0.143875$$\n$$S \\approx (981.968) \\times (0.143875) \\approx 141.286$$\n四舍五入到四位有效数字，结果是 $141.3$。\n$S$ 的这个大数值表明，由于穿过截断点而引起的瞬时加速度变化，比一个时间步长内的典型平滑加速度变化大 100 多倍。这突显了对势函数进行简单截断所导致的严重数值不稳定性。",
            "answer": "$$\n\\boxed{141.3}\n$$"
        },
        {
            "introduction": "虽然硬截断方法在计算力时忽略了长程相互作用，但这些被忽略的相互作用对体系总能量的贡献却不可小觑。为了修正这一系统性误差，我们引入了“长程校正”或“尾部校正”的概念。本练习将指导您从基本原理出发，推导Lennard-Jones势在截断后的能量长程校正项的解析表达式，这是在模拟中准确报告热力学性质的一项关键技能 。",
            "id": "3429355",
            "problem": "考虑一个通过分子动力学 (MD) 模拟的各向同性的、均匀的伦纳德-琼斯流体，其数密度为 $\\rho$，对势为 $u(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$。一个常见的非键截断策略是在一个有限的截断半径 $r_{\\text{cut}}$ 处截断势函数，这会忽略所有 $rr_{\\text{cut}}$ 的相互作用，而不进行移位。在空间均匀的流体中，每个粒子的平均构型势能可以用对势和径向分布函数 (RDF) $g(r)$ 来表示。为了补偿超出 $r_{\\text{cut}}$ 而被忽略的长程贡献，人们引入了每个粒子能量的尾部校正，并采用近似 $g(r)\\approx 1$（对于 $r\\geq r_{\\text{cut}}$）。\n\n从均匀流体中每个粒子构型势能关于 $u(r)$ 和 $g(r)$ 的基本定义出发，并使用近似 $g(r)\\approx 1$（对于 $r\\geq r_{\\text{cut}}$），推导一个由于在 $r_{\\text{cut}}$ 处截断而引起的每个粒子构型势能的尾部校正的闭式解析表达式。你的最终答案仅需用 $\\rho$、$\\epsilon$、$\\sigma$ 和 $r_{\\text{cut}}$ 表示。不要进行任何数值代入。假设全程使用国际单位制 (SI)：$\\rho$ 的单位为 $\\text{m}^{-3}$，$\\sigma$ 和 $r_{\\text{cut}}$ 的单位为 $\\text{m}$，$\\epsilon$ 的单位为 $\\text{J}$。最终的每个粒子的能量以 $\\text{J}$ 为单位表示。你的最终答案必须是一个单一的闭式解析表达式；不要在最终表达式中包含单位。",
            "solution": "用户希望我验证问题然后解决它。\n\n**1. 问题验证**\n\n*   **步骤1：提取已知条件**\n    *   系统：各向同性的、均匀的伦纳德-琼斯流体。\n    *   模拟方法：分子动力学 (MD)。\n    *   数密度：$\\rho$。\n    *   对势：$u(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$。\n    *   截断策略：在 $r_{\\text{cut}}$ 处简单截断（对于 $r  r_{\\text{cut}}$，势为零）。\n    *   近似：对于 $r \\geq r_{\\text{cut}}$，径向分布函数 (RDF) $g(r) \\approx 1$。\n    *   目标：推导每个粒子的构型势能的尾部校正。\n    *   最终表达式必须用 $\\rho$、$\\epsilon$、$\\sigma$ 和 $r_{\\text{cut}}$ 表示。\n    *   单位指定为国际单位制，最终能量单位为焦耳，但表达式必须是纯符号形式。\n\n*   **步骤2：使用提取的已知条件进行验证**\n    *   **科学依据：** 该问题是统计力学和分子模拟领域中的一个标准且基本的推导。伦纳德-琼斯势、径向分布函数的概念，以及使用带有尾部校正的势截断，都是公认的原理。对于远离临界点的均匀流体，在长距离下 $g(r) \\to 1$ 的近似是物理上合理的。\n    *   **适定性：** 该问题陈述清晰，提供了所有必要信息和一个具体目标。它要求推导一个单一、明确定义的量，并且存在唯一的解析解。\n    *   **客观性：** 语言正式且精确，使用了物理学和化学的标准术语。没有主观或模糊的陈述。\n\n*   **步骤3：结论与行动**\n    *   **结论：** 该问题被判定为**有效**。它具有科学依据、适定性且客观。\n    *   **行动：** 继续推导解答。\n\n**2. 解答推导**\n\n对于一个体积为 $V$、包含 $N$ 个粒子、通过对加性势 $u(r)$ 相互作用的系统，其总平均构型势能 $\\langle U \\rangle$ 可以用数密度 $\\rho = N/V$ 和径向分布函数 $g(r)$ 来表示。\n$$\n\\frac{\\langle U \\rangle}{N} = \\frac{1}{2} \\rho \\int_{0}^{\\infty} u(r) g(r) \\, 4\\pi r^2 dr\n$$\n因子 $\\frac{1}{2}$ 是为了校正粒子对的双重计数。项 $\\rho g(r) 4\\pi r^2 dr$ 表示在以某个中心粒子为中心、半径为 $r$、厚度为 $dr$ 的球壳中找到的平均粒子数。\n\n在使用简单截断方案的分子动力学模拟中，对于所有大于截断半径 $r_{\\text{cut}}$ 的分子间距 $r$，对势被设为零。因此，由模拟计算出的势能（我们记为 $\\frac{\\langle U_{\\text{calc}} \\rangle}{N}$）仅包含来自 $r \\leq r_{\\text{cut}}$ 的粒子对的贡献：\n$$\n\\frac{\\langle U_{\\text{calc}} \\rangle}{N} = 2\\pi \\rho \\int_{0}^{r_{\\text{cut}}} u(r) g(r) r^2 dr\n$$\n每个粒子的势能的尾部校正（我们记为 $U_{\\text{tail}}$）是来自 $r  r_{\\text{cut}}$ 时被忽略的相互作用的贡献。它是真实能量与计算能量之差：\n$$\nU_{\\text{tail}} = \\frac{\\langle U \\rangle}{N} - \\frac{\\langle U_{\\text{calc}} \\rangle}{N} = 2\\pi \\rho \\int_{r_{\\text{cut}}}^{\\infty} u(r) g(r) r^2 dr\n$$\n问题要求我们使用近似，即在截断距离之外，流体在结构上是不相关的，这意味着对于 $r \\geq r_{\\text{cut}}$，$g(r) \\approx 1$。对于典型液体，在几个分子直径的距离上，这是一个合理的假设。应用此近似，尾部校正的表达式变为：\n$$\nU_{\\text{tail}} \\approx 2\\pi \\rho \\int_{r_{\\text{cut}}}^{\\infty} u(r) \\cdot (1) \\cdot r^2 dr = 2\\pi \\rho \\int_{r_{\\text{cut}}}^{\\infty} u(r) r^2 dr\n$$\n现在，我们将伦纳德-琼斯对势 $u(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$ 代入积分中：\n$$\nU_{\\text{tail}} = 2\\pi \\rho \\int_{r_{\\text{cut}}}^{\\infty} 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right] r^2 dr\n$$\n我们可以将常数提到积分之外：\n$$\nU_{\\text{tail}} = 8\\pi \\rho \\epsilon \\int_{r_{\\text{cut}}}^{\\infty} \\left( \\frac{\\sigma^{12}}{r^{12}} - \\frac{\\sigma^{6}}{r^{6}} \\right) r^2 dr\n$$\n$$\nU_{\\text{tail}} = 8\\pi \\rho \\epsilon \\int_{r_{\\text{cut}}}^{\\infty} \\left( \\sigma^{12}r^{-10} - \\sigma^{6}r^{-4} \\right) dr\n$$\n现在我们对 $r$ 进行积分：\n$$\n\\int \\left( \\sigma^{12}r^{-10} - \\sigma^{6}r^{-4} \\right) dr = \\sigma^{12}\\frac{r^{-9}}{-9} - \\sigma^{6}\\frac{r^{-3}}{-3} = -\\frac{\\sigma^{12}}{9r^9} + \\frac{\\sigma^{6}}{3r^3}\n$$\n在 $r_{\\text{cut}}$ 到 $\\infty$ 的积分限上计算此结果：\n$$\nU_{\\text{tail}} = 8\\pi \\rho \\epsilon \\left[ -\\frac{\\sigma^{12}}{9r^9} + \\frac{\\sigma^{6}}{3r^3} \\right]_{r_{\\text{cut}}}^{\\infty}\n$$\n$$\nU_{\\text{tail}} = 8\\pi \\rho \\epsilon \\left( \\left( \\lim_{r\\to\\infty} \\left( -\\frac{\\sigma^{12}}{9r^9} + \\frac{\\sigma^{6}}{3r^3} \\right) \\right) - \\left( -\\frac{\\sigma^{12}}{9r_{\\text{cut}}^9} + \\frac{\\sigma^{6}}{3r_{\\text{cut}}^3} \\right) \\right)\n$$\n当 $r \\to \\infty$ 时，第一个括号中的两项都趋近于 $0$。因此，我们得到：\n$$\nU_{\\text{tail}} = 8\\pi \\rho \\epsilon \\left( 0 - \\left( -\\frac{\\sigma^{12}}{9r_{\\text{cut}}^9} + \\frac{\\sigma^{6}}{3r_{\\text{cut}}^3} \\right) \\right)\n$$\n$$\nU_{\\text{tail}} = 8\\pi \\rho \\epsilon \\left( \\frac{\\sigma^{12}}{9r_{\\text{cut}}^9} - \\frac{\\sigma^{6}}{3r_{\\text{cut}}^3} \\right)\n$$\n这就是每个粒子构型势能的尾部校正的最终闭式解析表达式，仅用给定参数 $\\rho$、$\\epsilon$、$\\sigma$ 和 $r_{\\text{cut}}$ 表示。",
            "answer": "$$\n\\boxed{8\\pi \\rho \\epsilon \\left( \\frac{\\sigma^{12}}{9r_{\\text{cut}}^{9}} - \\frac{\\sigma^{6}}{3r_{\\text{cut}}^{3}} \\right)}\n$$"
        },
        {
            "introduction": "对于静电这种长程力，截断策略的选择对模拟结果的影响尤为显著，简单的截断或位移方案可能不足以准确描述物理过程。本练习是一个编程实践，要求您实现并比较不同的静电截断方法（如截断-位移法和反应场法）对离子对平均力势（PMF）的影响。通过计算和比较接触离子对与溶剂分离离子对之间的能垒，您将亲身体会到不同算法如何改变体系的自由能形貌，进而影响对热力学和动力学性质的预测 。",
            "id": "3429373",
            "problem": "你需要实现、分析和比较离子对最小模型中静电作用的非键截断策略，并量化平均力势（PMF）在接触离子对与下一个溶剂结构化状态之间的势垒高度如何依赖于屏蔽长度和截断半径之间的关系。你的程序必须计算在参考模型（无截断）、截断-平移的汤川静电截断模型和类反应场静电截断模型下的势垒高度。类反应场截断通过添加一个内部二次场来强制势及其一阶导数在截断半径处的连续性。PMF被建模为静电汤川相互作用和衰减振荡溶剂化项的总和。所有能量必须以千焦/摩尔（kJ/mol）为单位报告。\n\n基本原理：\n- 介电质中两点电荷间的静电相互作用由库仑定律给出。在线性响应（德拜-休克尔理论）下，具有屏蔽长度 $\\lambda$ 的介质中产生一个屏蔽势（汤川形式）$u_{\\mathrm{Y}}(r) = \\dfrac{1}{4 \\pi \\varepsilon_0 \\varepsilon_r} \\dfrac{q_1 q_2}{r} e^{-r/\\lambda}$，其中 $r$ 是中心间距，$\\varepsilon_r$ 是相对介电常数。\n- 在稀疏极限下，径向分布函数 $g(r)$ 满足 $g(r) \\approx \\exp\\left(-\\beta u_{\\mathrm{eff}}(r)\\right)$，其中 $u_{\\mathrm{eff}}(r)$ 是有效对势，$\\beta = 1/(k_{\\mathrm{B}} T)$。平均力势（PMF）为 $W(r) = -k_{\\mathrm{B}} T \\ln g(r) \\approx u_{\\mathrm{eff}}(r)$，相差一个加性常数。我们利用这一点，通过对具有物理动机的贡献求和来构建一个PMF模型。\n- 球形腔中的反应场截断通过添加一个类谐波内场，强制势在截断半径处连续且力为零。对于一个通用对势 $u(r)$，通过 $u_{\\mathrm{RF}}(r) = u(r) + a r^2 + b$ 来强制 $u_{\\mathrm{RF}}(r_c) = 0$ 和 $\\dfrac{d}{dr} u_{\\mathrm{RF}}(r)\\big|_{r=r_c} = 0$，得到 $a = -\\dfrac{u'(r_c)}{2 r_c}$ 和 $b = -u(r_c) - a r_c^2$。\n\n模型定义：\n- 静电学（参考，无截断）：$u_{\\mathrm{ref}}(r) = u_{\\mathrm{Y}}(r) = \\dfrac{1}{4 \\pi \\varepsilon_0 \\varepsilon_r} \\dfrac{q_1 q_2}{r} e^{-r/\\lambda}$。\n- 在截断半径 $r_c$ 处的截断-平移（TS）汤川静电学：\n  - 对于 $r \\le r_c$， $u_{\\mathrm{TS}}(r) = u_{\\mathrm{Y}}(r) - u_{\\mathrm{Y}}(r_c)$。\n  - 对于 $r  r_c$， $u_{\\mathrm{TS}}(r) = 0$。\n- 在截断半径 $r_c$ 处的类反应场（RF）汤川静电学：\n  - 计算 $a = -\\dfrac{u'_{\\mathrm{Y}}(r_c)}{2 r_c}$，$b = -u_{\\mathrm{Y}}(r_c) - a r_c^2$。\n  - 对于 $r \\le r_c$， $u_{\\mathrm{RF}}(r) = u_{\\mathrm{Y}}(r) + a r^2 + b$。\n  - 对于 $r  r_c$， $u_{\\mathrm{RF}}(r) = 0$。\n- 溶剂化结构项（添加到所有PMF中，与截断策略无关）：$w_{\\mathrm{solv}}(r) = B \\exp\\!\\left(-\\dfrac{r - \\sigma}{\\lambda}\\right) \\cos\\!\\left( \\dfrac{2 \\pi (r - \\sigma)}{d} + \\pi \\right)$，对于 $r \\ge \\sigma$。其中 $B  0$，相位 $\\pi$ 的选择使得接触区域被稳定（负贡献），而下一个溶剂壳层贡献一个势垒（正贡献）。\n- 方法 $X \\in \\{\\mathrm{ref}, \\mathrm{TS}, \\mathrm{RF}\\}$ 的 PMF 模型：$W_X(r) = u_X(r) + w_{\\mathrm{solv}}(r)$，对于 $r \\ge \\sigma$。\n- 势垒高度 $\\Delta W_X$ 定义为 $\\Delta W_X = W_X(r_{\\text{max},1}) - W_X(r_{\\text{min},1})$，其中 $r_{\\text{min},1}$ 是 $W_X(r)$ 在 $r \\ge \\sigma$ 的第一个局部最小值，而 $r_{\\text{max},1}$ 是在 $r  r_{\\text{min},1}$ 的第一个局部最大值。如果任一极值不存在，则势垒未定义。\n\n量、常数和单位：\n- 电荷：$q_1 = +e$, $q_2 = -e$，其中 $e = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$。\n- 介电常数：$\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\ \\mathrm{F\\,m^{-1}}$，$\\varepsilon_r = 78.5$。\n- 库仑常数：$k_e = \\dfrac{1}{4 \\pi \\varepsilon_0}$。\n- 阿伏伽德罗常数：$N_A = 6.02214076 \\times 10^{23}\\ \\mathrm{mol^{-1}}$。\n- 所有间距 $r$、$\\sigma$、$r_c$ 和 $\\lambda$ 都以纳米为单位。在使用 $\\varepsilon_0$ 之前，必须在适当的地方转换为米。\n- 所有能量必须以 $\\mathrm{kJ\\,mol^{-1}}$ 报告。\n- 结构参数（所有测试案例中固定）：接触直径 $\\sigma = 0.3\\ \\mathrm{nm}$，振荡周期 $d = 0.8\\ \\mathrm{nm}$，振荡振幅 $B = 4.0\\ \\mathrm{kJ\\,mol^{-1}}$。\n\n你的实现所需的数学表达式：\n- 汤川静电势，以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位，作为 $r$（纳米）和 $\\lambda$（纳米）的函数：\n  $$u_{\\mathrm{Y}}(r) = \\left( \\dfrac{1}{4 \\pi \\varepsilon_0 \\varepsilon_r} \\dfrac{q_1 q_2}{r \\times 10^{-9}} e^{-r/\\lambda} \\right) \\times \\dfrac{N_A}{1000}.$$\n- 其关于 $r$ 的导数（其中 $r$ 和 $\\lambda$ 以纳米为单位），单位为 $\\mathrm{kJ\\,mol^{-1}\\,nm^{-1}}$：\n  $$\\dfrac{d u_{\\mathrm{Y}}}{dr}(r) = \\left( \\dfrac{1}{4 \\pi \\varepsilon_0 \\varepsilon_r} q_1 q_2 \\times 10^{9} \\right) \\times \\dfrac{N_A}{1000} \\times e^{-r/\\lambda} \\left( -\\dfrac{1}{\\lambda r} - \\dfrac{1}{r^2} \\right).$$\n- 反应场系数：\n  $$a = -\\dfrac{u'_{\\mathrm{Y}}(r_c)}{2 r_c}, \\quad b = -u_{\\mathrm{Y}}(r_c) - a r_c^2.$$\n\n算法要求：\n- 在 $r \\in [\\sigma + \\delta, r_{\\max}]$ 范围内，在足够精细的网格上对 $W_X(r)$ 进行采样，其中 $\\delta = 10^{-4}\\ \\mathrm{nm}$，$r_{\\max} = 2.5\\ \\mathrm{nm}$，以便可靠地检测第一个局部最小值和随后的第一个局部最大值。\n- 使用离散比较 $W[i-1] > W[i]  W[i+1]$ 检测最小值，使用 $W[i-1]  W[i] > W[i+1]$ 检测最大值。\n- 计算 $\\Delta W_{\\mathrm{ref}}$, $\\Delta W_{\\mathrm{TS}}$, $\\Delta W_{\\mathrm{RF}}$，单位为 $\\mathrm{kJ\\,mol^{-1}}$。\n- 对于每个测试案例，计算相对于参考模型的势垒高度误差：\n  $$E_{\\mathrm{TS}} = \\Delta W_{\\mathrm{TS}} - \\Delta W_{\\mathrm{ref}}, \\quad E_{\\mathrm{RF}} = \\Delta W_{\\mathrm{RF}} - \\Delta W_{\\mathrm{ref}}$$\n- 将报告的每个误差四舍五入到三位小数。\n\n测试套件：\n- 使用以下 $(r_c,\\ \\lambda)$ 对列表，其中 $r_c$ 和 $\\lambda$ 以纳米为单位：\n  - 案例 1：$(r_c = 1.5,\\ \\lambda = 0.3)$。\n  - 案例 2：$(r_c = 0.6,\\ \\lambda = 1.0)$。\n  - 案例 3：$(r_c = 0.7,\\ \\lambda = 0.5)$。\n  - 案例 4：$(r_c = 0.8,\\ \\lambda = 1.5)$。\n\n输出规范：\n- 你的程序必须输出一行，包含按上述顺序排列的案例的 $[E_{\\mathrm{TS}}, E_{\\mathrm{RF}}]$ 对列表。输出格式必须是单行，用方括号括起来的逗号分隔列表，其中每个元素本身是一个包含两个四舍五入到三位小数的浮点数的列表。例如，有四个案例的输出应如下所示：\n  `[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]]`\n不得打印任何额外文本。所有能量必须以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位，并四舍五入到三位小数。",
            "solution": "该问题要求实现和比较三种不同的介电介质中离子对平均力势（PMF）模型，重点是量化两种常见的静电截断方案引入的误差。解决方案涉及定义PMF模型，实现一个数值方法来找到每个模型的相关势垒高度，然后为一组给定的参数计算误差。\n\n### 基于原理的设计\n\n该解决方案基于统计力学和分子模拟的基本原理进行设计。\n\n**1. 平均力势（PMF）的物理模型**\n\n两个离子之间的PMF $W(r)$ 是在分离距离为 $r$ 时的有效相互作用势的度量，该势已对周围溶剂的所有构型进行了平均。在稀疏极限下，它可以近似为直接相互作用和溶剂介导的相互作用之和。问题为给定的静电方法 $X$ 指定了一个模型PMF $W_X(r)$，作为静电势 $u_X(r)$ 和溶剂结构化贡献 $w_{\\mathrm{solv}}(r)$ 的和：\n\n$$\nW_X(r) = u_X(r) + w_{\\mathrm{solv}}(r)\n$$\n\n分析仅限于距离 $r \\ge \\sigma$，其中 $\\sigma$ 是离子的接触直径。\n\n- **静电相互作用 ($u_X(r)$):** 在具有屏蔽长度 $\\lambda$ 的介电介质中，两个电荷 $q_1$ 和 $q_2$ 之间的裸静电相互作用由汤川势描述，这是德拜-休克尔理论的结果：\n  $$u_{\\mathrm{Y}}(r) = C_{\\mathrm{el}} \\dfrac{e^{-r/\\lambda}}{r},$$\n  其中 $C_{\\mathrm{el}} = \\dfrac{q_1 q_2}{4 \\pi \\varepsilon_0 \\varepsilon_r}$。问题提供了一个预先计算好的以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位的势能表达式，以及其关于 $r$ 的导数，单位为 $\\mathrm{kJ\\,mol^{-1}\\,nm^{-1}}$。\n\n- **溶剂化贡献 ($w_{\\mathrm{solv}}(r)$):** 该项模拟了离子周围溶剂堆积的振荡性质。它由一个阻尼余弦函数给出，这是一种常见的唯象形式：\n  $$\n  w_{\\mathrm{solv}}(r) = B \\exp\\!\\left(-\\dfrac{r - \\sigma}{\\lambda}\\right) \\cos\\!\\left( \\dfrac{2 \\pi (r - \\sigma)}{d} + \\pi \\right)\n  $$\n  参数 $B$、$d$ 和 $\\sigma$ 分别控制溶剂壳层的振幅、周期和相位。衰减长度与静电屏蔽长度 $\\lambda$ 相关联。相位 $\\pi$ 确保了在 $r=\\sigma$ 处的第一个贡献是吸引性的（一个最小值）。\n\n**2. 静电截断模型**\n\n在分子模拟中，像汤川势这样的长程势通常在截断半径 $r_c$ 处被截断，以减少计算成本。该问题分析了三种这样的方案：\n\n- **参考模型 (ref):** 不应用截断。使用完整的汤川势。\n  $$u_{\\mathrm{ref}}(r) = u_{\\mathrm{Y}}(r)$$\n\n- **截断-平移模型 (TS):** 势在 $r_c$ 处被截断，并进行垂直平移，使其在截断点处连续且等于零。\n  $$\n  u_{\\mathrm{TS}}(r) = \n  \\begin{cases} \n  u_{\\mathrm{Y}}(r) - u_{\\mathrm{Y}}(r_c)  r \\le r_c \\\\\n  0  r  r_c\n  \\end{cases}\n  $$\n  该方法确保了势的连续性，但在 $r_c$ 处引入了力的不连续性（势的负导数）。\n\n- **类反应场模型 (RF):** 这种更复杂的方法通过添加一个二次项来修改 $r \\le r_c$ 时的势。该项的系数被选择来强制势及其一阶导数在 $r_c$ 处均为零。这确保了势和力都是连续的。\n  $$\n  u_{\\mathrm{RF}}(r) = \n  \\begin{cases} \n  u_{\\mathrm{Y}}(r) + a r^2 + b  r \\le r_c \\\\\n  0  r  r_c\n  \\end{cases}\n  $$\n  其中系数 $a$ 和 $b$ 由边界条件 $u_{\\mathrm{RF}}(r_c) = 0$ 和 $u'_{\\mathrm{RF}}(r_c) = 0$ 确定：\n  $$a = -\\dfrac{u'_{\\mathrm{Y}}(r_c)}{2 r_c}, \\quad b = -u_{\\mathrm{Y}}(r_c) - a r_c^2$$\n\n**3. 势垒高度计算**\n\n问题要求计算PMF中的第一个势垒的高度，该势垒将接触离子对（CIP）状态与下一个稳定构型（例如，溶剂分离离子对，SSIP）分离开。该势垒高度 $\\Delta W_X$ 定义为第一个局部最大值和第一个局部最小值处的PMF之差：\n\n$$\n\\Delta W_X = W_X(r_{\\max,1}) - W_X(r_{\\min,1})\n$$\n\n这里，$r_{\\min,1}$ 是 $r \\ge \\sigma$ 时的第一个局部最小值的位置，$r_{\\max,1}$ 是 $r  r_{\\min,1}$ 时的第一个局部最大值的位置。\n\n**4. 算法实现**\n\n算法设计将这些物理和数学定义直接转化为计算过程。\n\n- **离散化:** 连续的PMF $W_X(r)$ 在一个精细的一维 $r$ 值网格上进行评估。该网格从 $r = \\sigma + \\delta$ 延伸到一个足够大的距离 $r_{\\max}$，步长很小，以确保可以准确定位极值。\n\n- **极值查找:** 通过迭代离散化的PMF值来确定第一个最小值和随后的最大值的位置。如果 $W[i-1]  W[i]  W[i+1]$，则网格位置 $r[i]$ 处的点 $W[i]$ 被认为是局部最小值；如果 $W[i-1]  W[i] > W[i+1]$，则被认为是局部最大值。搜索是顺序进行的：首先，算法找到第一个最小值，然后在更大的 $r$ 值处搜索第一个最大值。\n\n- **误差计算:** 在计算了三种模型的势垒高度 $\\Delta W_{\\mathrm{ref}}$、$\\Delta W_{\\mathrm{TS}}$ 和 $\\Delta W_{\\mathrm{RF}}$ 之后，通过减去参考势垒高度来计算截断方案引入的误差：\n  $$E_{\\mathrm{TS}} = \\Delta W_{\\mathrm{TS}} - \\Delta W_{\\mathrm{ref}}$$\n  $$E_{\\mathrm{RF}} = \\Delta W_{\\mathrm{RF}} - \\Delta W_{\\mathrm{ref}}$$\n\n对每个测试案例重复此过程，每个案例由一对截断半径 $r_c$ 和屏蔽长度 $\\lambda$ 的值组成。结果量化了截断方案的准确性如何依赖于这两个长度尺度之间的关系。最终的实现使用 `numpy` 库将这些步骤封装在一个Python脚本中，以进行高效的向量化计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Implements and compares nonbonded cutoff strategies for electrostatics in a\n    minimal model of ion pairing. Calculates the error in the potential of mean\n    force (PMF) barrier height for truncated-and-shifted (TS) and\n    reaction-field-like (RF) cutoffs relative to a reference model.\n    \"\"\"\n\n    # Constants and Parameters\n    e = 1.602176634e-19  # Elementary charge in Coulombs\n    eps0 = 8.8541878128e-12  # Vacuum permittivity in F/m\n    eps_r = 78.5  # Relative permittivity\n    Na = 6.02214076e23  # Avogadro constant in mol^-1\n    q1q2 = -e**2\n\n    # Structural parameters\n    sigma = 0.3  # Contact diameter in nm\n    d = 0.8  # Oscillation period in nm\n    B = 4.0  # Oscillation amplitude in kJ/mol\n\n    # Algorithmic parameters\n    delta = 1e-4  # nm\n    r_max_range = 2.5  # Max separation in nm\n    grid_step = 1e-4  # Grid step in nm\n\n    # Pre-calculate the Yukawa prefactor K in units of kJ/mol * nm.\n    # The formula is derived from the expression for u_Y(r) provided,\n    # converting from SI units for energy (J) and distance (m) to the\n    # desired units of kJ/mol and nm.\n    # K = ( (q1*q2) / (4*pi*eps0*eps_r) * 1e9_nm/m ) * (Na / 1000_J/kJ)\n    K_prefactor = (q1q2 / (4 * np.pi * eps0 * eps_r)) * 1e9 * (Na / 1000.0)\n\n    def u_yukawa(r, lam):\n        \"\"\"Calculates Yukawa potential in kJ/mol.\"\"\"\n        # r and lam in nm.\n        # Add a small epsilon to r to avoid division by zero if r=0 is ever passed.\n        r_safe = np.maximum(r, 1e-12)\n        return K_prefactor * np.exp(-r_safe / lam) / r_safe\n\n    def u_yukawa_deriv(r, lam):\n        \"\"\"Calculates the derivative of Yukawa potential in kJ/mol/nm.\"\"\"\n        # r and lam in nm.\n        r_safe = np.maximum(r, 1e-12)\n        return K_prefactor * np.exp(-r_safe / lam) * (-1 / (lam * r_safe) - 1 / r_safe**2)\n\n    def w_solv(r, lam):\n        \"\"\"Calculates the solvation term in kJ/mol.\"\"\"\n        # r and lam in nm. Defined for r = sigma.\n        return B * np.exp(-(r - sigma) / lam) * np.cos(2 * np.pi * (r - sigma) / d + np.pi)\n\n    def find_barrier_height(W_values):\n        \"\"\"Finds the first barrier height from a discretized PMF.\"\"\"\n        min_idx = -1\n        max_idx = -1\n\n        # Find first local minimum\n        for i in range(1, len(W_values) - 1):\n            if W_values[i - 1]  W_values[i] and W_values[i]  W_values[i + 1]:\n                min_idx = i\n                break\n        \n        if min_idx == -1:\n            return np.nan\n\n        # Find first local maximum after the minimum\n        for i in range(min_idx + 1, len(W_values) - 1):\n            if W_values[i - 1]  W_values[i] and W_values[i]  W_values[i + 1]:\n                max_idx = i\n                break\n\n        if max_idx == -1:\n            return np.nan\n\n        return W_values[max_idx] - W_values[min_idx]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (rc, lambda) in nanometers\n        (1.5, 0.3),\n        (0.6, 1.0),\n        (0.7, 0.5),\n        (0.8, 1.5),\n    ]\n\n    results = []\n    \n    r_grid = np.arange(sigma + delta, r_max_range, grid_step)\n\n    for rc, lam in test_cases:\n        # Calculate common potential components on the grid\n        u_y_grid = u_yukawa(r_grid, lam)\n        w_s_grid = w_solv(r_grid, lam)\n\n        # 1. Reference PMF (no cutoff)\n        W_ref = u_y_grid + w_s_grid\n        dW_ref = find_barrier_height(W_ref)\n\n        # 2. Truncated-and-shifted PMF\n        u_y_rc = u_yukawa(rc, lam)\n        u_ts_grid = np.where(r_grid = rc, u_y_grid - u_y_rc, 0.0)\n        W_ts = u_ts_grid + w_s_grid\n        dW_ts = find_barrier_height(W_ts)\n\n        # 3. Reaction-field-like PMF\n        u_y_deriv_rc = u_yukawa_deriv(rc, lam)\n        a = -u_y_deriv_rc / (2 * rc)\n        b = -u_y_rc - a * rc**2\n        u_rf_grid = np.where(r_grid = rc, u_y_grid + a * r_grid**2 + b, 0.0)\n        W_rf = u_rf_grid + w_s_grid\n        dW_rf = find_barrier_height(W_rf)\n        \n        if np.isnan(dW_ref) or np.isnan(dW_ts) or np.isnan(dW_rf):\n             # This is an unexpected outcome for the given problem parameters.\n             results.append((np.nan, np.nan))\n             continue\n\n        # Calculate errors relative to the reference model\n        E_ts = dW_ts - dW_ref\n        E_rf = dW_rf - dW_ref\n        results.append((E_ts, E_rf))\n\n    # Format the final output string to the exact required format.\n    formatted_pairs = [f\"[{ts:.3f},{rf:.3f}]\" for ts, rf in results]\n    print(f\"[{','.join(formatted_pairs)}]\")\n\nsolve()\n```"
        }
    ]
}