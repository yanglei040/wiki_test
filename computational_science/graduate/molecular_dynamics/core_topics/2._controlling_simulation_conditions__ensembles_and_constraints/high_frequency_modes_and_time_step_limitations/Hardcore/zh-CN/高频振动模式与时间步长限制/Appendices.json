{
    "hands_on_practices": [
        {
            "introduction": "分子中最高频的运动，例如化学键的伸缩振动，通常是决定分子动力学（MD）模拟时间步长上限的关键因素。通过将这种运动简化为经典的一维谐振子模型，我们可以精确地分析数值积分算法（如速度 Verlet 算法）的行为。这项练习将指导你进行线性稳定性分析，从数学上推导出积分稳定性的基本条件，并计算出一个典型高频模式所允许的最大时间步长。 这个过程不仅揭示了积分算法的“奈奎斯特频率”，也为理解为何在实践中必须选择远小于此理论上限的时间步长以保证精度奠定了基础。",
            "id": "3415676",
            "problem": "分子动力学 (MD) 中的一维高频振动模式可以建模为一个谐振子，其势能为 $U(x) = \\frac{1}{2} k x^2$，质量为 $m$，其中 $x$ 是位移，$k$ 是力常数，$m$ 是质量。运动方程遵循牛顿第二定律，$m \\frac{d^2 x}{d t^2} = -k x$，该定律通过 $\\omega = \\sqrt{k/m}$ 定义了角频率 $\\omega$。考虑使用速度 Verlet 积分器进行数值时间演化，时间步长为 $\\Delta t$。更新方程为\n$x_{n+1} = x_n + v_n \\Delta t + \\frac{1}{2} a_n (\\Delta t)^2, \\quad v_{n+1} = v_n + \\frac{1}{2} (a_n + a_{n+1}) \\Delta t,$\n其中 $a_n = -\\omega^2 x_n$ 是第 $n$ 步的加速度。\n\n从这些定义和方程出发，对离散动力学进行线性稳定性分析，以获得确保数值解有界运动的稳定性条件。然后，利用该结果，为以下符合物理现实的参数确定最大时间步长 $\\Delta t_{\\max}$：\n- $k = 500\\,\\mathrm{N/m}$，\n- $m = 1.000\\,\\mathrm{amu}$，转换关系为 $1\\,\\mathrm{amu} = 1.66053906660 \\times 10^{-27}\\,\\mathrm{kg}$。\n\n将 $\\Delta t_{\\max}$ 以飞秒为单位表示，并将答案四舍五入到四位有效数字。最后，论证在实践中为何通常选择远小于稳定性所允许的最大时间步长，讨论除了纯粹的数值稳定性之外，高频模式的精度考虑因素。",
            "solution": "该问题是有效的，因为它科学地基于经典力学和数值分析的原理，问题设定良好，目标明确，数据充分，并且表述客观。分析涉及速度 Verlet 算法的稳定性，该算法是分子动力学模拟的基石。\n\n解答过程分为三部分：首先，进行线性稳定性分析以推导稳定性条件；其次，为给定的物理参数计算最大稳定时间步长；第三，讨论为何实际应用中的时间步长选择得比此最大值要小。\n\n**1. 线性稳定性分析**\n\n该系统是一个一维谐振子，其运动方程为 $m \\ddot{x} = -k x$，可以写成 $\\ddot{x} = -\\omega^2 x$，其中 $\\omega = \\sqrt{k/m}$ 是角频率。在时间步长 $n$ 处的加速度为 $a_n = -\\omega^2 x_n$。\n\n速度 Verlet 算法由以下更新方程给出：\n$$x_{n+1} = x_n + v_n \\Delta t + \\frac{1}{2} a_n (\\Delta t)^2$$\n$$v_{n+1} = v_n + \\frac{1}{2} (a_n + a_{n+1}) \\Delta t$$\n\n为了进行稳定性分析，我们将第 $n+1$ 步的系统状态（由向量 $\\mathbf{z}_{n+1} = \\begin{pmatrix} x_{n+1} \\\\ v_{n+1} \\end{pmatrix}$ 表示）表示为第 $n$ 步状态（$\\mathbf{z}_{n} = \\begin{pmatrix} x_{n} \\\\ v_{n} \\end{pmatrix}$）的线性变换。这定义了传递矩阵 $\\mathbf{T}$，使得 $\\mathbf{z}_{n+1} = \\mathbf{T} \\mathbf{z}_{n}$。\n\n首先，我们将 $a_n = -\\omega^2 x_n$ 代入位置更新方程：\n$$x_{n+1} = x_n + v_n \\Delta t - \\frac{1}{2} \\omega^2 x_n (\\Delta t)^2 = \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + v_n \\Delta t$$\n\n接下来，我们用 $x_n$ 和 $v_n$ 来表示 $v_{n+1}$。我们在速度更新方程中使用 $a_{n+1} = -\\omega^2 x_{n+1}$：\n$$v_{n+1} = v_n + \\frac{1}{2} \\left(-\\omega^2 x_n - \\omega^2 x_{n+1}\\right) \\Delta t = v_n - \\frac{1}{2} \\omega^2 \\Delta t (x_n + x_{n+1})$$\n代入 $x_{n+1}$ 的表达式：\n$$v_{n+1} = v_n - \\frac{1}{2} \\omega^2 \\Delta t \\left(x_n + \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + v_n \\Delta t\\right)$$\n$$v_{n+1} = v_n - \\frac{1}{2} \\omega^2 \\Delta t \\left(\\left(2 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + v_n \\Delta t\\right)$$\n$$v_{n+1} = -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2\\right) x_n + \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) v_n$$\n\n现在我们可以将该系统写成矩阵形式：\n$$\\begin{pmatrix} x_{n+1} \\\\ v_{n+1} \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2  \\Delta t \\\\ -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2\\right)  1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2 \\end{pmatrix} \\begin{pmatrix} x_n \\\\ v_n \\end{pmatrix}$$\n\n传递矩阵为：\n$$\\mathbf{T} = \\begin{pmatrix} 1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2  \\Delta t \\\\ -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2\\right)  1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2 \\end{pmatrix}$$\n\n为使数值解保持有界（稳定），传递矩阵 $\\mathbf{T}$ 的特征值 $\\lambda$ 的模长不得超过 $1$，即 $|\\lambda| \\le 1$。特征值是特征方程 $\\det(\\mathbf{T} - \\lambda \\mathbf{I}) = 0$ 的根。令 $A = 1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2$。\n$$\\det \\begin{pmatrix} A - \\lambda  \\Delta t \\\\ -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2\\right)  A - \\lambda \\end{pmatrix} = 0$$\n$$(A - \\lambda)^2 + \\omega^2 (\\Delta t)^2 \\left(1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2\\right) = 0$$\n$$\\lambda^2 - 2A\\lambda + A^2 + \\omega^2 (\\Delta t)^2 - \\frac{1}{4}\\omega^4 (\\Delta t)^4 = 0$$\n注意到 $\\det(\\mathbf{T}) = A^2 + \\omega^2 (\\Delta t)^2 (1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2) = (1-\\frac{1}{2}\\omega^2 (\\Delta t)^2)^2 + \\omega^2 (\\Delta t)^2 - \\frac{1}{4}\\omega^4 (\\Delta t)^4 = 1 - \\omega^2 (\\Delta t)^2 + \\frac{1}{4}\\omega^4 (\\Delta t)^4 + \\omega^2 (\\Delta t)^2 - \\frac{1}{4}\\omega^4 (\\Delta t)^4 = 1$。由于特征值的乘积为 $1$，如果一个特征值的模长 $|\\lambda| > 1$（因此另一个特征值的模长 $|\\lambda|  1$），则会出现不稳定性。稳定性要求特征值是在单位圆上的共轭复数。这发生在二次特征方程的判别式为非正值时。\n根为 $\\lambda = A \\pm \\sqrt{A^2 - \\det(\\mathbf{T})} = A \\pm \\sqrt{A^2-1}$。\n对于复数根，我们需要 $A^2 - 1 \\le 0$，即 $|A| \\le 1$。\n$$|1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2| \\le 1$$\n这个不等式可以分为两个条件：\n1) $1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2 \\le 1 \\implies -\\frac{1}{2}\\omega^2 (\\Delta t)^2 \\le 0$，由于 $\\omega^2 > 0$ 且 $(\\Delta t)^2 > 0$，此条件恒成立。\n2) $1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2 \\ge -1 \\implies 2 \\ge \\frac{1}{2}\\omega^2 (\\Delta t)^2 \\implies 4 \\ge \\omega^2 (\\Delta t)^2$。\n由于 $\\omega > 0$ 且 $\\Delta t > 0$，我们取平方根：\n$$\\omega \\Delta t \\le 2$$\n这就是应用于谐振子的速度 Verlet 积分器的稳定性条件。\n\n**2. 最大时间步长的计算**\n\n稳定性条件 $\\omega \\Delta t \\le 2$ 给出了最大允许时间步长为 $\\Delta t_{\\max} = \\frac{2}{\\omega}$。我们已获得计算该值所需的物理参数。\n- $k = 500 \\, \\mathrm{N/m} = 500 \\, \\mathrm{kg/s^2}$\n- $m = 1.000 \\, \\mathrm{amu}$\n- $1 \\, \\mathrm{amu} = 1.66053906660 \\times 10^{-27} \\, \\mathrm{kg}$\n\n首先，我们用国际单位制（SI）计算质量：\n$$m = 1.000 \\times (1.66053906660 \\times 10^{-27} \\, \\mathrm{kg}) = 1.66053906660 \\times 10^{-27} \\, \\mathrm{kg}$$\n\n接着，我们计算角频率 $\\omega$：\n$$\\omega = \\sqrt{\\frac{k}{m}} = \\sqrt{\\frac{500 \\, \\mathrm{kg/s^2}}{1.66053906660 \\times 10^{-27} \\, \\mathrm{kg}}}$$\n$$\\omega \\approx \\sqrt{3.01106031 \\times 10^{29} \\, \\mathrm{s}^{-2}} \\approx 5.48731305 \\times 10^{14} \\, \\mathrm{s}^{-1}$$\n\n现在，我们计算最大时间步长 $\\Delta t_{\\max}$：\n$$\\Delta t_{\\max} = \\frac{2}{\\omega} = \\frac{2}{5.48731305 \\times 10^{14} \\, \\mathrm{s}^{-1}} \\approx 3.644743 \\times 10^{-15} \\, \\mathrm{s}$$\n\n最后，我们将结果转换为飞秒（$1 \\, \\mathrm{fs} = 10^{-15} \\, \\mathrm{s}$）并四舍五入到四位有效数字：\n$$\\Delta t_{\\max} \\approx 3.644743 \\, \\mathrm{fs}$$\n$$\\Delta t_{\\max} \\approx 3.645 \\, \\mathrm{fs}$$\n\n**3. 使用更小时间步长的理由**\n\n稳定性条件 $\\omega \\Delta t \\le 2$ 仅确保数值轨迹不会指数发散；它不保证精度。在实践中，分子动力学模拟必须精确地再现物理动力学过程，这对时间步长 $\\Delta t$ 施加了更严格的约束。\n\n对于振子而言，精度的主要衡量标准是数值积分在多大程度上能够守恒能量并再现正确的振荡频率。尽管速度 Verlet 算法是辛算法，并表现出色的长期能量守恒性，但它会引入一个取决于时间步长大小的相误差。这个误差表现为振荡频率的偏移。\n\n数值振荡器的频率 $\\omega_{\\text{num}}$ 可以通过传递矩阵的特征值与真实频率 $\\omega$ 相关联。特征值为 $\\lambda = e^{\\pm i \\omega_{\\text{num}} \\Delta t}$。其实部为 $\\Re(\\lambda) = \\cos(\\omega_{\\text{num}} \\Delta t)$。根据我们的分析，$\\Re(\\lambda) = A = 1 - \\frac{1}{2}(\\omega \\Delta t)^2$。\n因此，我们有如下关系：\n$$\\cos(\\omega_{\\text{num}} \\Delta t) = 1 - \\frac{1}{2}(\\omega \\Delta t)^2$$\n我们可以解出 $\\omega_{\\text{num}}$：\n$$\\omega_{\\text{num}} = \\frac{1}{\\Delta t} \\arccos\\left(1 - \\frac{1}{2}(\\omega \\Delta t)^2\\right)$$\n对于小的 $\\omega \\Delta t$，泰勒展开表明 $\\omega_{\\text{num}} \\approx \\omega(1 - \\frac{1}{24}(\\omega \\Delta t)^2)$。这意味着 $\\omega_{\\text{num}}  \\omega$，所以数值振荡器比真实振荡器稍慢，随时间推移导致相位相差越来越大。\n\n频率的相对误差约为 $\\frac{\\omega_{\\text{num}} - \\omega}{\\omega} \\approx -\\frac{1}{24}(\\omega \\Delta t)^2$。\n当 $\\Delta t$ 接近稳定性极限 $\\Delta t_{\\max} = 2/\\omega$ 时，项 $\\omega \\Delta t$ 接近 $2$。\n在极限情况下，$\\omega_{\\text{num}} = \\frac{1}{(2/\\omega)} \\arccos(1 - \\frac{1}{2}(2)^2) = \\frac{\\omega}{2} \\arccos(-1) = \\frac{\\pi \\omega}{2}$。\n频率之比为 $\\omega_{\\text{num}}/\\omega = \\pi/2 \\approx 1.57$。这是一个 $57\\%$ 的误差，大到无法接受。在这个具体的推导中，我似乎犯了一个错误；让我重新评估一下。\n啊，我的特征值分析假设了复数根，但在稳定性边界上它们是实数。让我们再次分析 arccos 的参数。$\\cos(\\omega_{\\text{num}} \\Delta t) = 1 - \\frac{1}{2}(\\omega \\Delta t)^2$。当 $\\omega \\Delta t = 2$ 时，$\\cos(\\omega_{\\text{num}} \\Delta t) = -1$，所以 $\\omega_{\\text{num}} \\Delta t = \\pi$，导致 $\\omega_{\\text{num}} = \\frac{\\pi}{\\Delta t} = \\frac{\\pi}{2/\\omega} = \\frac{\\pi}{2}\\omega$。不，这似乎是对的。我最初通过泰勒展开得到的 $\\omega_{num}  \\omega$ 的分析对小的 $\\Delta t$ 成立，而这个极限情况显示 $\\omega_{num} > \\omega$。对于实际的 $\\Delta t$ 选择，泰勒级数是相关的。关键点是在稳定性极限处误差很大。\n\n为了保持高保真度，频率误差必须保持很小。例如，要将相对频率误差保持在 $1\\%$ ($0.01$) 以下，我们需要：\n$$\\frac{1}{24}(\\omega \\Delta t)^2 \\lesssim 0.01$$\n$$(\\omega \\Delta t)^2 \\lesssim 0.24 \\implies \\omega \\Delta t \\lesssim \\sqrt{0.24} \\approx 0.49$$\n这个条件 $\\omega \\Delta t \\lesssim 0.5$ 比稳定性条件 $\\omega \\Delta t \\le 2$ 严格四倍。这意味着时间步长必须至少比 $\\Delta t_{\\max}$ 小四倍。\n\n在分子动力学中，一个普遍的经验法则是使用一个比系统中最快振动模式的周期（$T = 2\\pi/\\omega$）小至少一个数量级的时间步长。这对应于 $\\Delta t \\approx T/10 = (2\\pi/\\omega)/10 \\approx 0.628/\\omega$。这种选择，$\\Delta t \\approx 0.6/\\omega$，确保最快的振动在每个周期内被多次采样，从而实现其动力学的精确积分，并保持可接受的能量守恒和相精度。对于本问题中的系统，这个实用规则将建议时间步长为 $\\Delta t \\approx \\frac{0.628}{5.487 \\times 10^{14}} \\approx 1.14 \\, \\mathrm{fs}$，这远小于 $\\Delta t_{\\max}=3.645 \\, \\mathrm{fs}$。\n\n总之，数值稳定性仅仅是防止模拟发散的阈值。要获得准确且具有物理意义的结果，需要一个更小的时间步长来最小化积分误差，特别是高频模式的相误差。",
            "answer": "$$\\boxed{3.645}$$"
        },
        {
            "introduction": "既然高频振动模式迫使我们使用极小的时间步长，一个常见的应对策略便是使用约束算法（如 SHAKE 或 RATTLE）来“冻结”这些快速的自由度。然而，这种做法并非没有代价。这项概念性练习将引导你深入探讨施加约束对系统总能量守恒性的影响。 通过对比无约束和有约束两种方案下能量的长期行为，你将学会辨析辛积分器带来的有界能量振荡与非精确约束求解器引入的长期能量漂移之间的区别，从而更深刻地理解延长模拟时间步长所做的权衡。",
            "id": "3415632",
            "problem": "在分子动力学 (MD) 中，刚性键近似被广泛用于消除高频振动模式 (HFVM)，从而可以在不破坏积分器稳定性的情况下采用更大的时间步长。考虑一个双原子分子，其原子质量相等，均为 $m$，由一个刚性谐振子键势 $V(r) = \\tfrac{1}{2} k (r - r_0)^2$ 连接，其中 $r$ 是原子间距，$r_0$ 是平衡键长，$k$ 是一个大的刚度常数。折合质量为 $\\mu = m/2$，因此键的自然频率为 $\\omega_h = \\sqrt{k / \\mu}$。考虑两种数值方案：\n\n(i) 一个无约束的速度Verlet方案，应用于完整的哈密顿动力学，其中的刚性键势未被约束解析，使用一个满足该方法线性稳定性条件的恒定时间步长 $\\Delta t$。\n\n(ii) 一个有约束的速度Verlet方案，通过每步的位置和速度校正来强制执行完整键长约束 $r = r_0$，使用一种SHAKE/RATTLE类型方法中的投影算法，该算法迭代求解约束残差，使其在指定的容差 $\\epsilon_c$ 内，该容差定义为每步校正后位置约束违背的最大范数。\n\n假设没有恒温器、没有恒压器、没有外力，并忽略舍入误差。所有校正都以确定性的方式执行。对于方案 (ii)，假设约束求解器如果运行到精确满足约束（$\\epsilon_c = 0$），会产生一个辛约束映射；否则，对于有限的 $\\epsilon_c > 0$，该映射会偏离精确辛性。\n\n从双原子系统的牛顿第二定律 $m \\,\\ddot{\\boldsymbol{r}}_1 = - \\nabla_{\\boldsymbol{r}_1} V$，$m \\,\\ddot{\\boldsymbol{r}}_2 = - \\nabla_{\\boldsymbol{r}_2} V$ 以及速度Verlet在无约束情况下作为二阶、时间可逆、辛积分器的定义出发，推断在每种方案下总能量 $E(t)$ 的定性和定量的长时间行为。特别地，确定以下各项的领头阶标度（用 $\\Delta t$、$\\omega_h$ 和 $\\epsilon_c$ 表示）：\n\n- 对于方案 (i)，$E(t)$ 围绕其均值的有界振荡的振幅。\n- 对于方案 (i)，$E(t)$ 中是否存在长期漂移及其速率。\n- 对于方案 (ii)，当 $\\epsilon_c  0$ 但很小时，$E(t)$ 中有界振荡的振幅。\n- 对于方案 (ii)，当 $\\epsilon_c  0$ 但很小时，$E(t)$ 中是否存在长期漂移及其速率。\n\n选择最准确地描述这些标度和行为的选项。\n\nA. 对于方案 (i)，$E(t)$ 表现出振幅标度为 $\\mathcal{O}\\!\\left( (\\omega_h \\Delta t)^2 \\right)$ 的有界振荡，且没有长期漂移。对于方案 (ii)，当 $\\epsilon_c  0$ 时，该方法失去精确辛性，并产生一个长期能量漂移，其速率标度为 $\\mathcal{O}\\!\\left( \\epsilon_c^2 / \\Delta t \\right)$，而剩余自由度 (DOF) 的能量误差的振荡分量标度为 $\\mathcal{O}\\!\\left( \\Delta t^2 \\right)$。\n\nB. 对于方案 (i)，$E(t)$ 显示出速率为 $\\mathcal{O}\\!\\left( \\Delta t \\right)$ 的长期漂移；对于方案 (ii)，约束校正完全消除了漂移，只留下振幅为 $\\mathcal{O}\\!\\left( \\Delta t^3 \\right)$ 的有界振荡。\n\nC. 对于方案 (i)，有界能量振荡的振幅为 $\\mathcal{O}\\!\\left( \\Delta t \\right)$；对于方案 (ii)，长期漂移速率为 $\\mathcal{O}\\!\\left( \\epsilon_c / \\Delta t \\right)$，振荡分量为 $\\mathcal{O}\\!\\left( \\Delta t \\right)$。\n\nD. 对于方案 (i)，$E(t)$ 表现出振幅为 $\\mathcal{O}\\!\\left( \\Delta t^2 \\right)$ 的有界振荡，外加一个以速率 $\\mathcal{O}\\!\\left( \\Delta t^3 \\right)$ 累积的长期漂移；对于方案 (ii)，长期漂移速率为 $\\mathcal{O}\\!\\left( \\epsilon_c \\right)$，与 $\\Delta t$ 无关。\n\nE. 两种方案都只产生振幅为 $\\mathcal{O}\\!\\left( \\Delta t^2 \\right)$ 的有界振荡，对于任何 $\\epsilon_c \\ge 0$ 都有精确为零的长期漂移。",
            "solution": "问题陈述是分子动力学数值积分器分析中的一个有效练习。它在科学上是合理的、良定的和客观的。它准确地描述了两种标准的模拟方案，并就其长时间能量守恒性质提出了一个理论上合理的问题。因此，我们可以进行完整的解答。\n\n分析的关键在于速度Verlet积分器的性质以及施加完整约束的效果。\n\n**方案 (i)：无约束的速度Verlet**\n\n速度Verlet算法是一种二阶、时间可逆和辛的积分器。由后向误差分析确立的辛性的一个关键推论是，由积分器生成的数值轨迹并不精确守恒真实的哈密顿量 $H$，而是精确守恒一个附近的*影子哈密顿量* $\\tilde{H}$。对于一个时间步长为 $\\Delta t$ 的二阶积分器，影子哈密顿量可以表示为一个渐近级数：\n$$ \\tilde{H} = H + (\\Delta t)^2 H_2 + (\\Delta t)^4 H_4 + \\dots $$\n其中 $H_2$、$H_4$ 等是位置和动量的函数，涉及势能的高阶导数。\n\n因为数值轨迹精确守恒 $\\tilde{H}$，所以真实系统的总能量 $E(t) = H(\\boldsymbol{q}(t), \\boldsymbol{p}(t))$ 会围绕 $\\tilde{H}$ 的恒定值表现出有界振荡。平均能量没有长期（长期的、系统的）漂移。\n\n这些能量振荡的振幅由影子哈密顿量中的领头阶修正项 $(\\Delta t)^2 H_2$ 的大小决定。$H_2$ 项涉及哈密顿量与自身的泊松括号，并与势的刚度成标度关系。对于一个自然频率为 $\\omega_h$ 的谐振子，$H_2$ 项将包含与力常数 $k = \\mu \\omega_h^2$ 成比例的因子。控制误差的无量纲参数是 $\\omega_h \\Delta t$。详细分析表明，能量振荡的振幅与此参数成二次方标度关系。\n$$ \\text{Amplitude}(E_{\\text{osc}}) \\sim \\mathcal{O}\\! \\left( ( \\omega_h \\Delta t )^2 \\right) $$\nVerlet积分器的稳定性要求 $\\omega_h \\Delta t \\le 2$，因此这个无量纲量是高频模式误差的正确度量。\n\n总之，对于方案 (i)，总能量 $E(t)$ 表现出振幅标度为 $\\mathcal{O}((\\omega_h \\Delta t)^2)$ 的有界振荡，并且没有长期漂移。\n\n**方案 (ii)：有约束的速度Verlet (SHAKE/RATTLE)**\n\n该方案用刚性完整约束 $g(\\boldsymbol{r}) = r - r_0 = 0$ 替代了刚性谐振子键。SHAKE/RATTLE算法用于在每个时间步强制执行此约束。\n\n问题陈述正确地指出，如果约束方程被求解到机器精度（即 $\\epsilon_c = 0$），所得到的映射（例如 RATTLE）在约束相空间上将是辛的。在这种理想情况下，能量行为将类似于方案 (i)，但高频 $\\omega_h$ 已被消除。剩余的自由度（平移和转动）具有低得多的特征频率，导致振幅为 $\\mathcal{O}((\\Delta t)^2)$ 的有界能量振荡，且没有长期漂移。\n\n然而，问题指定了一个有限容差 $\\epsilon_c  0$。这意味着当位置约束违背小于或等于 $\\epsilon_c$ 时，用于约束方程的迭代求解器会终止。这种不精确的解在每一步都会引入一个小的、非保守的微扰，从而破坏了积分方案的精确辛性。一个非辛积分器通常会表现出能量的长期漂移。\n\n我们可以估计这种漂移的速率。位置约束违背为 $|\\Delta r| \\sim \\mathcal{O}(\\epsilon_c)$。这意味着原子间距为 $r \\approx r_0 \\pm \\epsilon_c$，这会引入一个残余势能以及来自原始势的一个相关的人为恢复力 $F_{\\text{res}} \\approx k \\Delta r \\sim \\mathcal{O}(k \\epsilon_c)$。用于速度的RATTLE算法也会产生一个与 $\\epsilon_c$ 相关的误差。平行于键的速度分量本应为零，但现在非零且标度为 $v_{\\parallel} \\sim \\mathcal{O}(\\epsilon_c / \\Delta t)$。这个非零速度意味着残余力可以做功。这个人为的力在单个时间步长 $\\Delta t$ 内所做的功近似为：\n$$ \\Delta E_{\\text{step}} \\approx F_{\\text{res}} \\cdot (v_{\\parallel} \\cdot \\Delta t) $$\n代入标度行为：\n$$ \\Delta E_{\\text{step}} \\sim (k \\epsilon_c) \\cdot (\\frac{\\epsilon_c}{\\Delta t} \\cdot \\Delta t) \\sim k \\epsilon_c^2 $$\n这是每步的能量漂移。长期能量漂移的速率是每步的漂移除以时间步长：\n$$ \\frac{dE}{dt} \\approx \\frac{\\Delta E_{\\text{step}}}{\\Delta t} \\sim \\mathcal{O}\\! \\left( \\frac{k \\epsilon_c^2}{\\Delta t} \\right) \\sim \\mathcal{O}\\! \\left( \\frac{\\omega_h^2 \\epsilon_c^2}{\\Delta t} \\right) $$\n问题要求用给定参数表示标度，因此速率标度为 $\\mathcal{O}(\\epsilon_c^2 / \\Delta t)$。\n\n除了这种漂移之外，底层的二阶积分器仍在演化剩余的、无约束的自由度（例如，质心平移、整体转动）。与这些较慢运动相关的能量将表现出Verlet方法的特征性有界振荡，其振幅标度为 $\\mathcal{O}((\\Delta t)^2)$。\n\n总之，对于 $\\epsilon_c  0$ 的方案 (ii)，总能量 $E(t)$ 表现为一个速率标度为 $\\mathcal{O}(\\epsilon_c^2/\\Delta t)$ 的长期漂移和一个振幅标度为 $\\mathcal{O}((\\Delta t)^2)$ 的有界振荡的叠加。\n\n**选项评估**\n\n*   **A. 对于方案 (i)，$E(t)$ 表现出振幅标度为 $\\mathcal{O}\\!\\left( (\\omega_h \\Delta t)^2 \\right)$ 的有界振荡，且没有长期漂移。对于方案 (ii)，当 $\\epsilon_c  0$ 时，该方法失去精确辛性，并产生一个长期能量漂移，其速率标度为 $\\mathcal{O}\\!\\left( \\epsilon_c^2 / \\Delta t \\right)$，而剩余自由度 (DOF) 的能量误差的振荡分量标度为 $\\mathcal{O}\\!\\left( \\Delta t^2 \\right)$。**\n    该陈述与我们为两种方案推导出的行为完全匹配。对方案 (i) 的分析（有界振荡标度为 $\\mathcal{O}((\\omega_h \\Delta t)^2)$，无漂移）是正确的。对方案 (ii) 的分析（由非辛性引起的长期漂移，漂移速率标度为 $\\mathcal{O}(\\epsilon_c^2/\\Delta t)$，以及底层振荡标度为 $\\mathcal{O}((\\Delta t)^2)$）也是正确的。\n    **结论：正确。**\n\n*   **B. 对于方案 (i)，$E(t)$ 显示出速率为 $\\mathcal{O}\\!\\left( \\Delta t \\right)$ 的长期漂移；对于方案 (ii)，约束校正完全消除了漂移，只留下振幅为 $\\mathcal{O}\\!\\left( \\Delta t^3 \\right)$ 的有界振荡。**\n    该陈述在多个方面都是错误的。方案 (i) 使用辛积分器，没有领头阶的长期漂移。对于方案 (ii)，使用有限容差 $\\epsilon_c  0$ 会*引入*长期漂移，而不是消除它。对于二阶方法，振荡振幅的标度为 $\\mathcal{O}((\\Delta t)^2)$，而不是 $\\mathcal{O}((\\Delta t)^3)$。\n    **结论：错误。**\n\n*   **C. 对于方案 (i)，有界能量振荡的振幅为 $\\mathcal{O}\\!\\left( \\Delta t \\right)$；对于方案 (ii)，长期漂移速率为 $\\mathcal{O}\\!\\left( \\epsilon_c / \\Delta t \\right)$，振荡分量为 $\\mathcal{O}\\!\\left( \\Delta t \\right)$。**\n    该陈述是错误的。对于方案 (i)，能量振荡的振幅标度为 $\\mathcal{O}((\\Delta t)^2)$，而不是 $\\mathcal{O}(\\Delta t)$。对于方案 (ii)，尽管漂移速率的标度在文献中存在一些争议（有些分析得出 $\\mathcal{O}(\\epsilon_c/\\Delta t)$），但振荡分量的标度为 $\\mathcal{O}(\\Delta t)$ 是绝对错误的；它应该是 $\\mathcal{O}((\\Delta t)^2)$。\n    **结论：错误。**\n\n*   **D. 对于方案 (i)，$E(t)$ 表现出振幅为 $\\mathcal{O}\\!\\left( \\Delta t^2 \\right)$ 的有界振荡，外加一个以速率 $\\mathcal{O}\\!\\left( \\Delta t^3 \\right)$ 累积的长期漂移；对于方案 (ii)，长期漂移速率为 $\\mathcal{O}\\!\\left( \\epsilon_c \\right)$，与 $\\Delta t$ 无关。**\n    该陈述是错误的。方案 (i) 没有长期漂移。方案 (ii) 的漂移速率标度为 $\\mathcal{O}(\\epsilon_c)$ 在物理上和量纲上都是有问题的，并且与显示出对 $\\Delta t$ 依赖性的标准分析不一致。\n    **结论：错误。**\n\n*   **E. 两种方案都只产生振幅为 $\\mathcal{O}\\!\\left( \\Delta t^2 \\right)$ 的有界振荡，对于任何 $\\epsilon_c \\ge 0$ 都有精确为零的长期漂移。**\n    该陈述是错误的。它正确地指出了方案 (i) 的有界振荡（尽管忽略了重要的 $\\omega_h$ 依赖性），但错误地声称当 $\\epsilon_c  0$ 时方案 (ii) 没有长期漂移。不精确约束的积分器的非辛性质必然导致能量漂移。\n    **结论：错误。**\n\n基于严谨的分析，选项 A 是唯一一个为两种方案的能量行为提供了完全准确描述的选项。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理论分析为我们提供了稳定性的判据，但在实践中亲眼见证模拟因时间步长过大而“崩溃”是理解这一概念的有力方式。这项编程练习将指导你构建一个简单的双原子分子模拟，并系统地增大时间步长，直至系统失稳。 通过监测总能量、温度和作用力等关键物理量，你将学会如何在自己的模拟中诊断数值不稳定性，并用经验数据验证前面练习中推导出的理论极限。",
            "id": "3415667",
            "problem": "构建一个完全指定的程序，通过扫描时间步长值并评估稳定性诊断指标，以经验性方法定位高频模式导致一个简单分子动力学系统失稳的临界时间步长。完全在约化单位下工作，其中质量 $m$、玻尔兹曼常数 $k_{\\mathrm{B}}$ 以及特征长度和能量标度均等于 $1$，因此不需要物理单位。\n\n考虑一个由两个质量为 $m = 1$ 的相同点粒子组成的一维系统，其位置为 $x_0(t)$ 和 $x_1(t)$，速度为 $v_0(t)$ 和 $v_1(t)$。这两个粒子由一个弹簧常数为 $k_b$、静止长度为零的谐振键连接，并且每个粒子都通过一个弹簧常数为 $k_t$ 的谐振弹簧束缚在原点。总势能为\n$$\nU(x_0,x_1) = \\tfrac{1}{2} k_t x_0^2 + \\tfrac{1}{2} k_t x_1^2 + \\tfrac{1}{2} k_b (x_1 - x_0)^2.\n$$\n根据牛顿第二定律，作用在粒子 $0$ 和粒子 $1$ 上的总力为\n$$\nF_0 = -\\frac{\\partial U}{\\partial x_0} = -k_t x_0 + k_b (x_1 - x_0), \\quad F_1 = -\\frac{\\partial U}{\\partial x_1} = -k_t x_1 - k_b (x_1 - x_0).\n$$\n运动方程为\n$$\nm \\frac{d^2 x_i}{dt^2} = F_i, \\quad i \\in \\{0,1\\}, \\quad m = 1.\n$$\n使用速度 Verlet 方法以均匀时间步长 $\\Delta t$ 对动力学进行积分：\n- 给定时间 $t$ 时的位置 $x_i(t)$、速度 $v_i(t)$ 和加速度 $a_i(t) = F_i(t)/m$，更新\n$$\nx_i(t+\\Delta t) = x_i(t) + v_i(t)\\,\\Delta t + \\tfrac{1}{2} a_i(t)\\,\\Delta t^2,\n$$\n计算 $F_i(t+\\Delta t)$ 和 $a_i(t+\\Delta t) = F_i(t+\\Delta t)/m$，然后更新\n$$\nv_i(t+\\Delta t) = v_i(t) + \\tfrac{1}{2}\\left[a_i(t) + a_i(t+\\Delta t)\\right]\\Delta t.\n$$\n\n初始化和可观测量：\n- 初始化位置为 $x_0(0) = -x_{\\mathrm{init}}$，$x_1(0) = +x_{\\mathrm{init}}$，其中 $x_{\\mathrm{init}} = 0.1$。\n- 通过从均值为零、方差为 $\\sigma_v^2 = T_0/m$ 的正态分布中独立抽样来初始化速度，目标温度为 $T_0 = 1$。为保证可复现性，使用固定的伪随机数生成器种子 $13579$，并且对于每个新的 $\\Delta t$ 扫描值和每个测试用例，都使用相同的种子重新初始化随机数生成器。\n- 定义瞬时动能\n$$\nK(t) = \\tfrac{1}{2} m\\left[v_0(t)^2 + v_1(t)^2\\right],\n$$\n瞬时总能量\n$$\nE(t) = K(t) + U\\big(x_0(t),x_1(t)\\big),\n$$\n以及瞬时温度（在 $k_{\\mathrm{B}}=1$ 的约化单位下）\n$$\nT(t) = \\frac{2\\,K(t)}{\\mathrm{dof}},\n$$\n其中总自由度数 $\\mathrm{dof} = 2$。\n- 定义均方根力为时间和粒子平均值\n$$\nF_{\\mathrm{RMS}} = \\left(\\frac{1}{2N_s}\\sum_{n=1}^{N_s}\\sum_{i=0}^{1} F_i(t_n)^2 \\right)^{1/2},\n$$\n其中 $N_s$ 是在丢弃初始平衡阶段后采样的时点数。\n\n稳定性诊断和判定规则：\n- 对于给定的 $\\Delta t$，运行 $N_{\\mathrm{steps}}$ 个积分步，丢弃前 $N_{\\mathrm{burn}}$ 个样本作为平衡过程，然后评估：\n    - 温度的相对标准差，\n    $$\n    \\delta_T = \\frac{\\mathrm{std}\\left(T\\right)}{\\mathrm{mean}\\left(T\\right)},\n    $$\n      在预烧期后的采样段上计算。\n    - 总能量的相对峰峰振荡幅度，\n    $$\n    \\delta_E = \\frac{\\max(E) - \\min(E)}{\\mathrm{mean}(E)},\n    $$\n      在预烧期后的采样段上计算。\n    - 在预烧期后的整个轨迹上计算的均方根力 $F_{\\mathrm{RMS}}$。\n- 如果满足以下任一条件，则时间步长为 $\\Delta t$ 的模拟被视为不稳定：\n    - 提前终止触发条件：在积分过程中的任何时刻， $|x_0|$ 或 $|x_1|$ 超过 $X_{\\max}$，或 $|E|$ 超过 $E_{\\max}$，或在位置、速度或能量中遇到任何非有限值。\n    - 运行后度量阈值：$\\delta_T  \\tau_T$，或 $\\delta_E  \\tau_E$，或 $F_{\\mathrm{RMS}}  \\tau_F$。\n- 使用以下阈值\n$$\n\\tau_T = 0.25,\\quad \\tau_E = 0.20,\\quad \\tau_F = 10^3,\\quad X_{\\max} = 10^3,\\quad E_{\\max} = 10^6.\n$$\n\n时间步长扫描和阈值报告：\n- 对每个测试用例，在均匀网格上扫描指定范围的 $\\Delta t$ 值。临界阈值是扫描中检测到不稳定性的最小 $\\Delta t$。如果在整个扫描过程中未检测到不稳定性，则该测试用例返回 $-1.0$。\n\n实现细节和要使用的常数：\n- 所有运行均使用 $N_{\\mathrm{steps}} = 5000$ 和 $N_{\\mathrm{burn}} = 200$。\n- 对于每个 $\\Delta t$，使用上述指定的相同初始条件和相同的随机种子 $13579$ 重新初始化位置和速度。\n- 使用上面定义的质量 $m=1$、玻尔兹曼常数 $k_{\\mathrm{B}}=1$ 和自由度 $\\mathrm{dof}=2$。\n\n测试套件：\n- 情况 A（非常硬的键）：\n    - $k_b = 1000$，$k_t = 1$，$\\Delta t$ 在区间 $[0.005, 0.08]$ 内，增量为 $0.0025$。\n- 情况 B（中等硬度的键）：\n    - $k_b = 200$，$k_t = 1$，$\\Delta t$ 在区间 $[0.01, 0.20]$ 内，增量为 $0.005$。\n- 情况 C（软键）：\n    - $k_b = 20$，$k_t = 1$，$\\Delta t$ 在区间 $[0.02, 0.30]$ 内，增量为 $0.01$。\n\n程序要求：\n- 您的程序必须精确实现上述动力学和诊断，并生成单行输出，其中包含按顺序排列的情况 A、B 和 C 的三个检测到的阈值，四舍五入到 $6$ 位小数。如果对于给定情况未找到阈值，则该情况输出 $-1.000000$。\n- 最终输出格式：包含逗号分隔的 Python 风格列表的单行，例如 `[0.045000,0.105000,-1.000000]`。\n\n不从标准输入读取任何输入。结果必须完全在程序内部使用指定的测试套件和常数计算，并以确切的输出格式打印。",
            "solution": "所提出的问题是计算物理学领域（特别是在分子动力学领域）中一个定义明确且科学上合理的练习。它被认为是有效的，下面提供了完整的解决方案。任务是通过经验性方法确定一个简单的双粒子谐振子系统变得数值不稳定时的临界积分时间步长 $\\Delta t$。这是通过在一系列 $\\Delta t$ 值上执行一系列分子动力学模拟并应用一组明确的稳定性标准来完成的。\n\n问题的核心在于计算效率（倾向于较大的 $\\Delta t$）与数值准确性和稳定性（需要较小的 $\\Delta t$）之间的权衡。像速度 Verlet 方法这样的数值积分器的稳定性受到系统内最高运动频率的限制。对于谐振系统，这个频率由质量和弹簧常数决定。该问题旨在通过测试具有逐渐变硬的键（更高的 $k_b$）的系统来证明这一原理，这些系统引入了更高频率的振荡，因此需要更小、更仔细选择的时间步长。\n\n解决方案是通过对每个测试用例遵循一个严格的、分步的程序来实现的。\n\n**1. 系统定义和运动方程**\n\n物理系统由两个质量为 $m=1$ 的粒子组成，其位置为 $x_0(t)$ 和 $x_1(t)$。它们的相互作用和约束由势能函数描述：\n$$\nU(x_0, x_1) = \\frac{1}{2} k_t x_0^2 + \\frac{1}{2} k_t x_1^2 + \\frac{1}{2} k_b (x_1 - x_0)^2\n$$\n这里，$k_t$ 是将每个粒子束缚在原点的弹簧常数，$k_b$ 是连接两个粒子的谐振键的弹簧常数。\n\n作用在每个粒子上的力由势能的负梯度导出，$F_i = -\\frac{\\partial U}{\\partial x_i}$：\n$$\nF_0 = -k_t x_0 + k_b (x_1 - x_0) = -(k_t + k_b) x_0 + k_b x_1\n$$\n$$\nF_1 = -k_t x_1 - k_b (x_1 - x_0) = k_b x_0 - (k_t + k_b) x_1\n$$\n加速度则由牛顿第二定律给出，$a_i = F_i / m$。由于质量 $m=1$，我们有 $a_i = F_i$。\n\n**2. 数值积分：速度 Verlet 算法**\n\n运动方程使用速度 Verlet 算法进行数值积分。这是一种标准的、鲁棒的方法，在长时间的模拟中表现出良好的能量守恒性。给定时间 $t$ 时的系统状态——位置 $x_i(t)$、速度 $v_i(t)$ 和加速度 $a_i(t)$——在时间 $t+\\Delta t$ 的状态分两个阶段计算：\n- **阶段 1（位置更新）：** 将位置推进一个完整的时间步长 $\\Delta t$：\n$$\nx_i(t+\\Delta t) = x_i(t) + v_i(t)\\,\\Delta t + \\frac{1}{2} a_i(t)\\,\\Delta t^2\n$$\n- **阶段 2（速度更新）：** 使用更新后的位置 $x_i(t+\\Delta t)$ 计算新的力 $F_i(t+\\Delta t)$ 和加速度 $a_i(t+\\Delta t)$。然后使用新旧加速度的对称平均值将速度推进一个完整的时间步长：\n$$\nv_i(t+\\Delta t) = v_i(t) + \\frac{1}{2}\\left[a_i(t) + a_i(t+\\Delta t)\\right]\\Delta t\n$$\n\n**3. 模拟协议和稳定性评估**\n\n对于每个参数集（一个“测试用例”），在指定范围的 $\\Delta t$ 值上进行扫描。对于扫描中的每个单独的 $\\Delta t$，都会执行一次完整的模拟。\n\n- **初始化：** 对于每次模拟运行，系统都会重新初始化以确保独立的测试。位置被设置为固定值：$x_0(0) = -0.1$ 和 $x_1(0) = 0.1$。速度 $v_0(0)$ 和 $v_1(0)$ 从均值为 $0$、方差为 $\\sigma_v^2 = T_0/m = 1/1 = 1$ 的正态分布中抽取。至关重要的是，对于每个 $\\Delta t$，伪随机数生成器都使用值 $13579$ 重新播种。这保证了每个时间步长都在完全相同的初始微观状态下进行测试，使得比较公平且可复现。\n\n- **积分：** 系统演化 $N_{\\mathrm{steps}} = 5000$ 步。在积分过程中，每一步都会执行两次用于检测严重不稳定性的*提前终止*检查：\n    1. 如果任一粒子的绝对位置 $|x_i|$ 超过一个大值 $X_{\\max} = 10^3$。\n    2. 如果绝对总能量 $|E|$ 超过 $E_{\\max} = 10^6$。\n    如果发生上述任一情况，或生成了非有限数（例如 `NaN`、`inf`），则该 $\\Delta t$ 的模拟立即停止并标记为不稳定。\n\n- **运行后分析：** 如果模拟完成了所有 $5000$ 步，则丢弃前 $N_{\\mathrm{burn}} = 200$ 步的轨迹数据，以使系统达到平衡。剩余的 $N_s = 4800$ 步用于计算三个诊断度量：\n    1. **温度涨落 $\\delta_T$**：瞬时温度的相对标准差，$\\delta_T = \\mathrm{std}(T)/\\mathrm{mean}(T)$。温度定义为 $T(t) = 2K(t)/\\mathrm{dof} = K(t)$，其中 $K(t)$ 是总动能，自由度数为 $\\mathrm{dof}=2$。\n    2. **能量涨落 $\\delta_E$**：总能量的相对峰峰涨落，$\\delta_E = (\\max(E) - \\min(E))/\\mathrm{mean}(E)$。\n    3. **均方根力 $F_{\\mathrm{RMS}}$**：时间和粒子平均的 RMS 力，$F_{\\mathrm{RMS}} = \\left(\\frac{1}{2N_s}\\sum_{n=1}^{N_s}\\sum_{i=0}^{1} F_i(t_n)^2 \\right)^{1/2}$。\n\n- **判定规则：** 如果任何计算出的度量超过其预定义的阈值，则该次运行被分类为不稳定：$\\delta_T  0.25$，$\\delta_E  0.20$，或 $F_{\\mathrm{RMS}}  10^3$。\n\n**4. 确定临界时间步长**\n\n每个测试用例的扫描从最小的 $\\Delta t$ 进行到最大的 $\\Delta t$。第一个被认为是不稳定的 $\\Delta t$ 值（通过提前终止或运行后分析）即为该情况的临界时间步长。然后该情况的搜索终止。如果扫描完成而没有任何模拟被标记为不稳定，则报告值为 $-1.0$，表示稳定性极限超出了测试范围。\n\n所提供的 Python 代码自动执行了这整个过程，它有条不紊地实现了每个步骤，以得出三个指定测试用例的最终数值结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import ...\n\ndef potential_energy(x, kb, kt):\n    \"\"\"Calculates the potential energy of the system.\"\"\"\n    x0, x1 = x\n    return 0.5 * kt * x0**2 + 0.5 * kt * x1**2 + 0.5 * kb * (x1 - x0)**2\n\ndef forces(x, kb, kt):\n    \"\"\"Calculates the forces on the particles.\"\"\"\n    x0, x1 = x\n    F0 = -kt * x0 + kb * (x1 - x0)\n    F1 = -kt * x1 - kb * (x1 - x0)\n    return np.array([F0, F1])\n\ndef run_simulation(kb, kt, dt, params):\n    \"\"\"\n    Runs a single molecular dynamics simulation for a given set of parameters.\n    Returns True if stable, False if unstable.\n    \"\"\"\n    # Unpack parameters\n    m, T0, dof, x_init_val, seed = params['m'], params['T0'], params['dof'], params['x_init'], params['seed']\n    N_steps, N_burn = params['N_steps'], params['N_burn']\n    X_max, E_max = params['X_max'], params['E_max']\n    tau_T, tau_E, tau_F = params['tau_T'], params['tau_E'], params['tau_F']\n    N_samples = N_steps - N_burn\n\n    # 1. Initialization for each run\n    rng = np.random.default_rng(seed)\n    x = np.array([-x_init_val, x_init_val])\n    v = rng.normal(loc=0.0, scale=np.sqrt(T0 / m), size=2)\n\n    # Initial calculations\n    F = forces(x, kb, kt)\n    a = F / m\n    U = potential_energy(x, kb, kt)\n    K = 0.5 * m * np.sum(v**2)\n    E = K + U\n\n    if not np.isfinite(E):\n        return False\n\n    # Data storage for post-run analysis\n    E_samples = []\n    T_samples = []\n    F_squared_sum = 0.0\n\n    # 2. Integration loop (Velocity Verlet)\n    for step in range(N_steps):\n        # Position update\n        x = x + v * dt + 0.5 * a * dt**2\n\n        # Early termination check: position\n        if np.any(np.abs(x) > X_max):\n            return False\n\n        # Force/acceleration update\n        F_new = forces(x, kb, kt)\n        a_new = F_new / m\n\n        # Velocity update\n        v = v + 0.5 * (a + a_new) * dt\n\n        # Update acceleration for next step\n        a = a_new\n\n        # Energy and other observables\n        U = potential_energy(x, kb, kt)\n        K = 0.5 * m * np.sum(v**2)\n        E = K + U\n\n        # Early termination checks: energy and finite values\n        if not np.isfinite(E) or abs(E) > E_max:\n            return False\n            \n        # 3. Data Sampling\n        if step >= N_burn:\n            T = 2.0 * K / dof\n            E_samples.append(E)\n            T_samples.append(T)\n            F_squared_sum += np.sum(F_new**2)\n\n    # 4. Post-run analysis\n    E_arr = np.array(E_samples)\n    T_arr = np.array(T_samples)\n\n    if E_arr.size == 0 or T_arr.size == 0 or not np.all(np.isfinite(E_arr)) or not np.all(np.isfinite(T_arr)):\n        return False\n        \n    mean_T = np.mean(T_arr)\n    std_T = np.std(T_arr)\n    mean_E = np.mean(E_arr)\n    \n    if mean_T == 0 or mean_E == 0: # Avoid division by zero\n        return False\n\n    delta_T = std_T / mean_T\n    delta_E = (np.max(E_arr) - np.min(E_arr)) / mean_E\n    F_rms = np.sqrt(F_squared_sum / (2 * N_samples))\n\n    # 5. Decision rule\n    if delta_T > tau_T or delta_E > tau_E or F_rms > tau_F:\n        return False\n\n    return True # Stable\n\ndef find_critical_dt(case_params, sim_params):\n    \"\"\"\n    Scans a range of dt values to find the first unstable one.\n    \"\"\"\n    kb, kt, dt_start, dt_end, dt_inc = case_params\n\n    # Generate the scan range for dt, ensuring endpoint is included\n    dt_scan = np.arange(dt_start, dt_end + dt_inc * 0.5, dt_inc)\n\n    for dt in dt_scan:\n        is_stable = run_simulation(kb, kt, dt, sim_params)\n        if not is_stable:\n            return dt\n            \n    return -1.0\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    sim_params = {\n        'm': 1.0, \n        'T0': 1.0, \n        'dof': 2,\n        'x_init': 0.1,\n        'seed': 13579,\n        'N_steps': 5000, \n        'N_burn': 200,\n        'X_max': 1.0e3, \n        'E_max': 1.0e6,\n        'tau_T': 0.25, \n        'tau_E': 0.20, \n        'tau_F': 1.0e3\n    }\n\n    test_cases = [\n        # (kb, kt, dt_start, dt_end, dt_inc)\n        (1000.0, 1.0, 0.005, 0.08, 0.0025),  # Case A\n        (200.0, 1.0, 0.01, 0.20, 0.005),   # Case B\n        (20.0, 1.0, 0.02, 0.30, 0.01),      # Case C\n    ]\n    \n    results = []\n    for case in test_cases:\n        critical_dt = find_critical_dt(case, sim_params)\n        results.append(critical_dt)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}