{
    "hands_on_practices": [
        {
            "introduction": "Before we can analyze the structure of a simulated fluid, we must understand the geometric constraints imposed by our simulation setup. This exercise explores how Periodic Boundary Conditions (PBC) and the Minimum Image Convention (MIC) define a maximum meaningful distance for calculating correlation functions like the RDF. Deriving this limit is a foundational step to ensure your analysis is free from artifacts of the finite box size and accurately reflects the bulk properties of the system .",
            "id": "3440031",
            "problem": "A three-dimensional molecular dynamics simulation uses Periodic Boundary Conditions (PBC) in a cubic box of edge length $L$. Pair distances are computed using the Minimum Image Convention (MIC), i.e., for any pair of particles with position difference vector $\\boldsymbol{\\Delta r}$, one reduces to $\\boldsymbol{\\delta} = \\boldsymbol{\\Delta r} - L \\boldsymbol{n}$ with $\\boldsymbol{n} \\in \\mathbb{Z}^{3}$ chosen such that each component of $\\boldsymbol{\\delta}$ lies in the interval $[-L/2, L/2]$. The Radial Distribution Function (RDF) $g(r)$ is defined for a homogeneous and isotropic system by counting neighbors in spherical shells of radius $r$ and thickness $dr$ around a reference particle, and the coordination number $N(r)$ is defined by $N(r) = 4 \\pi \\rho \\int_{0}^{r} g(s) s^{2} \\,ds$, where $\\rho$ is the number density.\n\nStarting from these definitions and the geometric constraints imposed by the MIC, determine the largest radius $r_{\\max}$ such that spherical shells of radius $r \\leq r_{\\max}$ are fully supported by the MIC-reduced separation space without directional bias or truncation, ensuring that $g(r)$ and $N(r)$ can be interpreted as bulk quantities free of geometric artifacts arising from the finite simulation box. Express $r_{\\max}$ as a closed-form analytic expression in terms of $L$. Your final answer must be a single expression. No numerical approximation is required.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- **Simulation Type**: Three-dimensional molecular dynamics.\n- **Boundary Conditions**: Periodic Boundary Conditions (PBC) in a cubic box.\n- **Box Geometry**: A cube of edge length $L$.\n- **Distance Calculation**: Minimum Image Convention (MIC).\n- **MIC Definition**: The reduced separation vector $\\boldsymbol{\\delta}$ has components that lie in the interval $[-L/2, L/2]$. Specifically, for a position difference vector $\\boldsymbol{\\Delta r}$, $\\boldsymbol{\\delta} = \\boldsymbol{\\Delta r} - L \\boldsymbol{n}$ where $\\boldsymbol{n} \\in \\mathbb{Z}^{3}$ is chosen appropriately.\n- **Radial Distribution Function (RDF)**: $g(r)$ is defined by counting neighbors in spherical shells of radius $r$ and thickness $dr$.\n- **Coordination Number**: $N(r) = 4 \\pi \\rho \\int_{0}^{r} g(s) s^{2} \\,ds$, where $\\rho$ is the number density.\n- **Objective**: Determine the largest radius $r_{\\max}$ such that spherical shells of radius $r \\leq r_{\\max}$ are \"fully supported by the MIC-reduced separation space without directional bias or truncation\".\n- **Output Format**: A closed-form analytic expression for $r_{\\max}$ in terms of $L$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scientifically grounded, well-posed, and objective.\n- **Scientific Grounding**: The concepts of Periodic Boundary Conditions (PBC), the Minimum Image Convention (MIC), the Radial Distribution Function ($g(r)$), and the Coordination Number ($N(r)$) are fundamental and standard tools in the field of molecular dynamics and statistical mechanics. The problem is firmly rooted in established computational physics principles.\n- **Well-Posedness**: The problem is clearly defined. It asks for a maximum radius $r_{\\max}$ based on a specific geometric constraint (the sphere for RDF calculation must fit inside the MIC-defined computational cell). The definitions are precise, and a unique, meaningful solution is expected to exist.\n- **Objectivity**: The language is formal and technical. All terms are standard and unambiguously defined within the context of the field.\n\nThe problem exhibits none of the invalidating flaws. It is a standard and important consideration in the practical application of molecular simulations.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\nThe problem asks for the largest radius $r_{\\max}$ that ensures the calculation of the Radial Distribution Function, $g(r)$, is not biased by the geometry of the simulation box under the Minimum Image Convention (MIC).\n\nThe Minimum Image Convention for a cubic box of edge length $L$ restricts the components of the separation vector $\\boldsymbol{\\delta} = (\\delta_x, \\delta_y, \\delta_z)$ between any two particles (or their periodic images) to the range $[ -L/2, L/2 ]$. This means, for a reference particle conceptually placed at the origin $(0,0,0)$, all other particles are considered within a cubic volume defined by:\n$$ -\\frac{L}{2} \\le \\delta_x \\le \\frac{L}{2} $$\n$$ -\\frac{L}{2} \\le \\delta_y \\le \\frac{L}{2} $$\n$$ -\\frac{L}{2} \\le \\delta_z \\le \\frac{L}{2} $$\nThis defines the primary simulation cell for distance calculations, which is a cube of side length $L$ centered at the reference particle.\n\nThe RDF, $g(r)$, and the coordination number, $N(r)$, are calculated by counting particles in spherical shells of radius $r$ and thickness $dr$. For these quantities to reflect the properties of a bulk, isotropic system, the spherical sampling volume must not be distorted or truncated by the boundaries of the simulation cell. This is the meaning of the requirement that the spherical shells be \"fully supported ... without directional bias or truncation\". Directional bias would occur if, for a given radius $r$, the sampling sphere is cut by the faces of the MIC cube, leading to an under-counting of particles in certain directions.\n\nTo avoid this artifact, the entire sphere of radius $r$ used for sampling must be contained within the MIC-defined cubic volume. The problem therefore reduces to a purely geometric one: finding the radius of the largest sphere that can be inscribed within a cube of edge length $L$.\n\nLet the cube be centered at the origin $(0, 0, 0)$. Its faces are the planes defined by $x = \\pm L/2$, $y = \\pm L/2$, and $z = \\pm L/2$. A sphere of radius $r$ centered at the origin is the set of all points $(x, y, z)$ satisfying the inequality $x^2 + y^2 + z^2 \\le r^2$.\n\nFor the sphere to be inscribed within the cube, every point on the sphere's surface must lie inside or on the boundary of the cube. The point on the sphere's surface that is furthest from the origin in, for example, the $x$-direction is $(r, 0, 0)$. For this point to be within the cube, its $x$-coordinate must satisfy $r \\le L/2$. The same logic applies to the $y$ and $z$ directions.\n\nThe shortest distance from the center of the cube to its boundary is the perpendicular distance to one of its faces. The distance from the origin $(0, 0, 0)$ to the face at the plane $x = L/2$ is precisely $L/2$. This is the minimum distance from the center to any point on the boundary of the cube. Therefore, the radius of the largest possible inscribed sphere is limited by this distance.\n\nIf we choose a radius $r > L/2$, the sphere would extend beyond the faces of the cube. For example, a point such as $(L/2 + \\epsilon, 0, 0)$ for any $\\epsilon > 0$ would lie outside the MIC-box, while potentially being within the sphere of radius $r$. This would truncate the sphere, violating the condition for an unbiased calculation.\n\nConsequently, the maximum radius $r_{\\max}$ for which the sampling sphere is fully contained within the MIC-defined cube is exactly half the edge length of the box.\n\n$$ r_{\\max} = \\frac{L}{2} $$\n\nThis ensures that for any $r \\le r_{\\max}$, the spherical volume of radius $r$ is complete and not subject to geometric artifacts from the periodic boundary conditions, thereby allowing $g(r)$ and $N(r)$ to be interpreted as true bulk quantities.",
            "answer": "$$\n\\boxed{\\frac{L}{2}}\n$$"
        },
        {
            "introduction": "The power of the RDF concept truly shines when we analyze complex mixtures, where the arrangement of different chemical species determines the material's properties. This practice moves beyond single-component systems to partial RDFs, $g_{\\alpha\\beta}(r)$, challenging you to calculate species-resolved coordination numbers in a hypothetical ternary mixture . This skill is essential for studying solutions, alloys, and other multicomponent materials where specific atomic interactions govern the overall structure.",
            "id": "3440057",
            "problem": "Consider a macroscopically large, isotropic ternary liquid mixture of species $\\mathrm{A}$, $\\mathrm{B}$, and $\\mathrm{C}$ at thermodynamic equilibrium, with total number density $\\rho = 31.0\\,\\mathrm{nm}^{-3}$ and mole fractions $x_{\\mathrm{A}} = 0.55$, $x_{\\mathrm{B}} = 0.30$, and $x_{\\mathrm{C}} = 0.15$. The species-resolved structure in this mixture is characterized by the partial radial distribution functions $g_{\\alpha\\beta}(r)$, where by definition $g_{\\alpha\\beta}(r)$ is the ratio of the conditional average number density of species $\\beta$ at distance $r$ from a tagged particle of species $\\alpha$ to the bulk number density of species $\\beta$. The first-shell minima for $\\mathrm{A}$–$\\mathrm{B}$ and $\\mathrm{A}$–$\\mathrm{C}$ are located at $r_{\\min}^{\\mathrm{AB}} = 0.58\\,\\mathrm{nm}$ and $r_{\\min}^{\\mathrm{AC}} = 0.62\\,\\mathrm{nm}$, respectively. Over the ranges relevant to the first shells, the following piecewise forms approximate the partial radial distribution functions:\n\n$$\ng_{\\mathrm{AB}}(r) = \n\\begin{cases}\n0,  0 \\le r  0.28\\,\\mathrm{nm},\\\\\n1 + 1.8\\,\\exp\\!\\big(-7.5\\, r\\big),  0.28\\,\\mathrm{nm} \\le r \\le 0.58\\,\\mathrm{nm},\\\\\n1,  r  0.58\\,\\mathrm{nm},\n\\end{cases}\n$$\n\n\n$$\ng_{\\mathrm{AC}}(r) = \n\\begin{cases}\n0,  0 \\le r  0.30\\,\\mathrm{nm},\\\\\n1 + 2.2\\,\\exp\\!\\big(-8.0\\, r\\big),  0.30\\,\\mathrm{nm} \\le r \\le 0.62\\,\\mathrm{nm},\\\\\n1,  r  0.62\\,\\mathrm{nm}.\n\\end{cases}\n$$\n\nUsing only the foundational definition of the partial radial distribution function and standard geometric considerations for spherical shells, first derive the general expression for the species-resolved coordination number $N_{\\alpha\\beta}(R)$ of species $\\beta$ around a tagged $\\alpha$ within a sphere of radius $R$. Then, evaluate the total first-shell coordination number around a tagged $\\mathrm{A}$ as the sum of the species-resolved counts at their respective first minima,\n\n$$\nN_{\\mathrm{A}}^{(1)} \\equiv N_{\\mathrm{AB}}\\!\\big(r_{\\min}^{\\mathrm{AB}}\\big) + N_{\\mathrm{AC}}\\!\\big(r_{\\min}^{\\mathrm{AC}}\\big),\n$$\n\nusing the functions above and the bulk species number densities $\\rho_{\\beta} = x_{\\beta}\\,\\rho$. Express the final coordination number as a pure number (dimensionless) and round your answer to four significant figures.",
            "solution": "The problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution. Therefore, it is deemed valid.\n\nThe first step is to derive the general expression for the species-resolved coordination number, $N_{\\alpha\\beta}(R)$. The partial radial distribution function, $g_{\\alpha\\beta}(r)$, is defined as the ratio of the conditional local number density of species $\\beta$ at a distance $r$ from a central particle of species $\\alpha$, denoted $\\rho_{\\beta}^{\\alpha}(r)$, to the bulk number density of species $\\beta$, denoted $\\rho_{\\beta}$.\n$$g_{\\alpha\\beta}(r) = \\frac{\\rho_{\\beta}^{\\alpha}(r)}{\\rho_{\\beta}}$$\nFrom this definition, the local density of $\\beta$ particles is $\\rho_{\\beta}^{\\alpha}(r) = \\rho_{\\beta} g_{\\alpha\\beta}(r)$.\n\nThe number of $\\beta$ particles, $dN_{\\alpha\\beta}$, within a thin spherical shell of radius $r$ and infinitesimal thickness $dr$ around a central $\\alpha$ particle is the product of the local density and the volume of the shell, $dV = 4\\pi r^2 dr$.\n$$dN_{\\alpha\\beta} = \\rho_{\\beta}^{\\alpha}(r) dV = \\rho_{\\beta} g_{\\alpha\\beta}(r) (4\\pi r^2 dr)$$\nTo find the total number of $\\beta$ particles within a sphere of radius $R$, we integrate this expression from $r=0$ to $r=R$.\n$$N_{\\alpha\\beta}(R) = \\int_{0}^{R} dN_{\\alpha\\beta} = \\int_{0}^{R} \\rho_{\\beta} g_{\\alpha\\beta}(r) (4\\pi r^2) dr$$\nRearranging the terms yields the general expression for the coordination number:\n$$N_{\\alpha\\beta}(R) = 4\\pi \\rho_{\\beta} \\int_{0}^{R} r^2 g_{\\alpha\\beta}(r) dr$$\nThis is the required general expression.\n\nNext, we evaluate the total first-shell coordination number around a tagged A particle, $N_{\\mathrm{A}}^{(1)}$, defined as $N_{\\mathrm{A}}^{(1)} = N_{\\mathrm{AB}}(r_{\\min}^{\\mathrm{AB}}) + N_{\\mathrm{AC}}(r_{\\min}^{\\mathrm{AC}})$.\n\nFirst, we calculate the bulk number densities for species $\\mathrm{B}$ and $\\mathrm{C}$ using the total number density $\\rho = 31.0\\,\\mathrm{nm}^{-3}$ and the mole fractions $x_{\\mathrm{B}} = 0.30$ and $x_{\\mathrm{C}} = 0.15$.\n$$\\rho_{\\mathrm{B}} = x_{\\mathrm{B}} \\rho = (0.30)(31.0\\,\\mathrm{nm}^{-3}) = 9.3\\,\\mathrm{nm}^{-3}$$\n$$\\rho_{\\mathrm{C}} = x_{\\mathrm{C}} \\rho = (0.15)(31.0\\,\\mathrm{nm}^{-3}) = 4.65\\,\\mathrm{nm}^{-3}$$\n\nNow, we calculate the coordination number $N_{\\mathrm{AB}}(r_{\\min}^{\\mathrm{AB}})$ with $r_{\\min}^{\\mathrm{AB}} = 0.58\\,\\mathrm{nm}$.\n$$N_{\\mathrm{AB}}(0.58) = 4\\pi \\rho_{\\mathrm{B}} \\int_{0}^{0.58} r^2 g_{\\mathrm{AB}}(r) dr$$\nUsing the given piecewise form for $g_{\\mathrm{AB}}(r)$, the integral is split. The function is $0$ for $r  0.28\\,\\mathrm{nm}$, so the integral from $0$ to $0.28\\,\\mathrm{nm}$ is zero.\n$$N_{\\mathrm{AB}}(0.58) = 4\\pi \\rho_{\\mathrm{B}} \\int_{0.28}^{0.58} r^2 \\left(1 + 1.8\\,\\exp(-7.5 r)\\right) dr$$\nThe integral separates into two parts:\n$$I_{\\mathrm{AB}} = \\int_{0.28}^{0.58} r^2 dr + 1.8 \\int_{0.28}^{0.58} r^2 \\exp(-7.5 r) dr$$\nThe first part is:\n$$\\int_{0.28}^{0.58} r^2 dr = \\left[ \\frac{r^3}{3} \\right]_{0.28}^{0.58} = \\frac{(0.58)^3 - (0.28)^3}{3} = \\frac{0.195112 - 0.021952}{3} \\approx 0.057720\\,\\mathrm{nm}^3$$\nThe second part requires integration by parts. The indefinite integral is:\n$$\\int r^2 \\exp(-ar) dr = -\\frac{\\exp(-ar)}{a^3}(a^2 r^2 + 2ar + 2) + C$$\nFor $a=7.5\\,\\mathrm{nm}^{-1}$, the definite integral is:\n$$ \\begin{aligned} \\int_{0.28}^{0.58} r^2 \\exp(-7.5 r) dr = \\left[ -\\frac{\\exp(-7.5r)}{7.5^3}(7.5^2 r^2 + 2(7.5)r + 2) \\right]_{0.28}^{0.58} \\\\ \\approx (-0.0009059) - (-0.0030747) \\approx 0.0021688\\,\\mathrm{nm}^3 \\end{aligned} $$\nSubstituting these into the expression for $I_{\\mathrm{AB}}$:\n$$I_{\\mathrm{AB}} \\approx 0.057720\\,\\mathrm{nm}^3 + 1.8 \\times (0.0021688\\,\\mathrm{nm}^3) \\approx 0.061624\\,\\mathrm{nm}^3$$\nNow, we calculate $N_{\\mathrm{AB}}(0.58)$:\n$$N_{\\mathrm{AB}}(0.58) = 4\\pi (9.3\\,\\mathrm{nm}^{-3}) (0.061624\\,\\mathrm{nm}^3) \\approx 7.2017$$\n\nNext, we calculate the coordination number $N_{\\mathrm{AC}}(r_{\\min}^{\\mathrm{AC}})$ with $r_{\\min}^{\\mathrm{AC}} = 0.62\\,\\mathrm{nm}$.\n$$N_{\\mathrm{AC}}(0.62) = 4\\pi \\rho_{\\mathrm{C}} \\int_{0}^{0.62} r^2 g_{\\mathrm{AC}}(r) dr$$\nUsing the piecewise form for $g_{\\mathrm{AC}}(r)$, where it is $0$ for $r  0.30\\,\\mathrm{nm}$:\n$$N_{\\mathrm{AC}}(0.62) = 4\\pi \\rho_{\\mathrm{C}} \\int_{0.30}^{0.62} r^2 \\left(1 + 2.2\\,\\exp(-8.0 r)\\right) dr$$\nThe integral $I_{\\mathrm{AC}}$ is:\n$$I_{\\mathrm{AC}} = \\int_{0.30}^{0.62} r^2 dr + 2.2 \\int_{0.30}^{0.62} r^2 \\exp(-8.0 r) dr$$\nThe first part is:\n$$\\int_{0.30}^{0.62} r^2 dr = \\left[ \\frac{r^3}{3} \\right]_{0.30}^{0.62} = \\frac{(0.62)^3 - (0.30)^3}{3} = \\frac{0.238328 - 0.027}{3} \\approx 0.070443\\,\\mathrm{nm}^3$$\nFor the second part, with $a=8.0\\,\\mathrm{nm}^{-1}$:\n$$ \\begin{aligned} \\int_{0.30}^{0.62} r^2 \\exp(-8.0 r) dr = \\left[ -\\frac{\\exp(-8.0r)}{8.0^3}(8.0^2 r^2 + 2(8.0)r + 2) \\right]_{0.30}^{0.62} \\\\ \\approx (-0.0005001) - (-0.0022256) \\approx 0.0017255\\,\\mathrm{nm}^3 \\end{aligned} $$\nSubstituting these into the expression for $I_{\\mathrm{AC}}$:\n$$I_{\\mathrm{AC}} \\approx 0.070443\\,\\mathrm{nm}^3 + 2.2 \\times (0.0017255\\,\\mathrm{nm}^3) \\approx 0.074239\\,\\mathrm{nm}^3$$\nNow, we calculate $N_{\\mathrm{AC}}(0.62)$:\n$$N_{\\mathrm{AC}}(0.62) = 4\\pi (4.65\\,\\mathrm{nm}^{-3}) (0.074239\\,\\mathrm{nm}^3) \\approx 4.3392$$\n\nFinally, we sum the two coordination numbers to find the total first-shell coordination number around particle A:\n$$N_{\\mathrm{A}}^{(1)} = N_{\\mathrm{AB}}(0.58) + N_{\\mathrm{AC}}(0.62) \\approx 7.2017 + 4.3392 = 11.5409$$\nRounding the result to four significant figures gives $11.54$.",
            "answer": "$$\\boxed{11.54}$$"
        },
        {
            "introduction": "The radial distribution function is more than just a tool for counting neighbors; its precise shape encodes deep information about the phase of matter. This computational exercise challenges you to connect the mathematical form of $g(r)$—specifically its long-range decay—to the physical concept of structural order by comparing systems in two and three dimensions . By implementing and analyzing these model systems, you will gain insight into how the RDF reveals the subtle differences between liquids, hexatic phases, and crystals.",
            "id": "3439993",
            "problem": "Consider an isotropic fluid in either two dimensions or three dimensions, with number density $\\rho$ expressed in nanometers to the power of the corresponding dimension (for example, $\\mathrm{nm}^{-2}$ in two dimensions and $\\mathrm{nm}^{-3}$ in three dimensions). The radial distribution function (RDF) $g(r)$, where $r$ is the scalar separation in nanometers, characterizes the probability density of finding a particle at separation $r$ relative to an ideal gas at the same density. The coordination number $N(r)$ up to a radius $r$ is the expected number of neighbors within that radius. For isotropic systems, by the definition of $g(r)$ and geometry, the coordination number is given by\n$$\nN_{d}(r) = S_{d} \\, \\rho \\int_{0}^{r} g(r') \\, r'^{d-1} \\, dr' \\, ,\n$$\nwhere $d \\in \\{2,3\\}$ is the spatial dimension, $S_{2} = 2\\pi$ and $S_{3} = 4\\pi$ are the surface areas of the unit circle and unit sphere, respectively, and $r$ is measured in nanometers.\n\nIn three dimensions, typical simple liquids exhibit rapidly decaying positional correlations, often well-approximated by exponentially damped oscillations. In two dimensions, long-range physics differs: positional or bond-orientational correlations may decay more slowly, and in certain regimes associated with hexatic order, slow decay of structural correlations complicates the operational definition of a stable first coordination shell via a clear plateau in $N(r)$. In this problem, you will contrast two-dimensional and three-dimensional results by constructing $g(r)$ with different envelopes and analyzing the implications for the stability of the first coordination shell.\n\nYou must implement a program that, for a given set of model parameters, constructs $g(r)$ over a specified radial grid and then:\n1. Detects the first local maximum $r_{\\text{peak}}$ of $g(r)$ for $r0$, and the subsequent first local minimum $r_{\\min}$ occurring at $rr_{\\text{peak}}$.\n2. Computes $N_{d}(r_{\\min})$ using the definition above, with $r$ measured in nanometers and $\\rho$ in $\\mathrm{nm}^{-d}$. The resulting $N_{d}(r_{\\min})$ is dimensionless (a count of neighbors).\n3. Computes the post-minimum slope metric\n$$\n\\mathcal{S} = \\frac{N_{d}(r_{\\min}+\\Delta) - N_{d}(r_{\\min})}{\\Delta} \\, ,\n$$\nwith $\\Delta = 0.2$ nanometers, expressed in neighbors per nanometer. This metric operationally quantifies the stability of the first coordination shell: smaller $\\mathcal{S}$ indicates a clearer plateau and a more stable shell boundary, while larger $\\mathcal{S}$ indicates continued accumulation of neighbors beyond $r_{\\min}$.\n\nYou must use the following parametric forms for the radial distribution function to instantiate test cases that probe slow algebraic decay in two dimensions (representing quasi-long-range structural correlations relevant near hexatic order), faster exponential decay in two dimensions (representing short-range positional order typical of the hexatic regime), and exponentially damped oscillations in three dimensions:\n$$\ng(r) = 1 + A \\, \\cos\\!\\left( \\frac{2\\pi\\, (r - r_{0})}{\\lambda} \\right) \\, E(r) \\, ,\n$$\nwhere the envelope $E(r)$ differs by case:\n- Two-dimensional algebraic envelope: $E_{\\text{alg}}(r) = \\left(1 + \\frac{r}{\\lambda}\\right)^{-\\eta}$ with exponent $\\eta0$.\n- Two-dimensional exponential envelope: $E_{\\exp}^{(2\\mathrm{D})}(r) = \\exp\\!\\left( -\\frac{r}{\\xi} \\right)$ with correlation length $\\xi0$ in nanometers.\n- Three-dimensional exponentially damped envelope with additional polynomial attenuation: $E_{\\text{exp-poly}}^{(3\\mathrm{D})}(r) = \\dfrac{\\exp\\!\\left( -\\dfrac{r}{\\xi} \\right)}{\\left(1 + \\dfrac{r}{\\lambda}\\right)^{p}}$ with $p0$.\n\nTo ensure scientific realism and numerical stability, when evaluating $g(r)$ numerically you must enforce $g(r) \\ge 0$ by replacing negative values with $0$ before performing integration. Distances must be in nanometers, densities in $\\mathrm{nm}^{-d}$, and the slope metric $\\mathcal{S}$ must be reported in neighbors per nanometer.\n\nYour program must use a uniform radial grid $r \\in [r_{\\text{min-grid}}, r_{\\text{max-grid}}]$ with $r_{\\text{min-grid}} = 0.05$ nanometers, $r_{\\text{max-grid}} = 5.0$ nanometers, and a grid spacing of $h = 0.001$ nanometers. Local extrema detection must be performed by identifying the first sign change of the discrete derivative of $g(r)$: a change from positive to negative indicates a local maximum, and from negative to positive indicates a local minimum. The first maximum encountered for $r0$ defines $r_{\\text{peak}}$, and the subsequent first minimum defines $r_{\\min}$.\n\nTest Suite:\nUse the following four parameter sets, representing different physical regimes. All distances are in nanometers.\n\nTest Case $1$ (two-dimensional, slow algebraic decay):\n- $d = 2$, $\\rho = 12.8$ $\\mathrm{nm}^{-2}$, $A = 0.35$, $\\lambda = 0.30$, $r_{0} = 0.30$, envelope $E_{\\text{alg}}$, $\\eta = 0.25$.\n\nTest Case $2$ (two-dimensional, hexatic-like short-range positional order modeled by exponential decay):\n- $d = 2$, $\\rho = 12.8$ $\\mathrm{nm}^{-2}$, $A = 0.35$, $\\lambda = 0.30$, $r_{0} = 0.30$, envelope $E_{\\exp}^{(2\\mathrm{D})}$, $\\xi = 1.0$.\n\nTest Case $3$ (three-dimensional, exponentially damped oscillations):\n- $d = 3$, $\\rho = 30.0$ $\\mathrm{nm}^{-3}$, $A = 0.35$, $\\lambda = 0.30$, $r_{0} = 0.30$, envelope $E_{\\text{exp-poly}}^{(3\\mathrm{D})}$, $\\xi = 0.50$, $p = 2.0$.\n\nTest Case $4$ (two-dimensional, extreme slow decay to emphasize lack of a clear plateau):\n- $d = 2$, $\\rho = 12.8$ $\\mathrm{nm}^{-2}$, $A = 0.35$, $\\lambda = 0.30$, $r_{0} = 0.30$, envelope $E_{\\text{alg}}$, $\\eta = 0.05$.\n\nRequired Outputs:\nFor each test case, compute and return two quantities: the coordination number at the first minimum $N_{d}(r_{\\min})$ (dimensionless), and the post-minimum slope $\\mathcal{S}$ in neighbors per nanometer. Your program should produce a single line of output containing the eight results, ordered by test case and within each test case by $N_{d}(r_{\\min})$ then $\\mathcal{S}$, as a comma-separated list enclosed in square brackets (for example, $[N_{1},\\mathcal{S}_{1},N_{2},\\mathcal{S}_{2},N_{3},\\mathcal{S}_{3},N_{4},\\mathcal{S}_{4}]$). No additional text should be printed.",
            "solution": "The task requires computing the coordination number $N_{d}(r)$ from a model radial distribution function $g(r)$ and analyzing the stability of the first coordination shell in two dimensions versus three dimensions. The derivation proceeds from core definitions.\n\nWe begin with the definition of the radial distribution function (RDF) $g(r)$, which rescales the pair separation probability density relative to an ideal gas at the same number density $\\rho$. For an isotropic system in spatial dimension $d$, the expected number of neighbors within radius $r$ is\n$$\nN_{d}(r) = \\int_{V(r)} \\rho \\, g(\\lVert \\mathbf{r}' \\rVert) \\, d^{d}\\mathbf{r}' \\, ,\n$$\nwhere $V(r)$ is the ball of radius $r$. By spherical symmetry, the volume element in radial coordinates gives\n$$\nd^{d}\\mathbf{r}' = S_{d} \\, r'^{d-1} \\, dr' \\, ,\n$$\nwhere $S_{d}$ is the surface area of the unit sphere in $d$ dimensions, $S_{2} = 2\\pi$ and $S_{3} = 4\\pi$. Substituting, we obtain\n$$\nN_{d}(r) = S_{d} \\, \\rho \\int_{0}^{r} g(r') \\, r'^{d-1} \\, dr' \\, .\n$$\nThis $N_{d}(r)$ is dimensionless because $\\rho$ carries units of $\\mathrm{nm}^{-d}$, $r'^{d-1}$ carries units of $\\mathrm{nm}^{d-1}$, and $dr'$ carries units of $\\mathrm{nm}$, so the integrand multiplied by $S_{d}$ is unitless.\n\nTo construct $g(r)$, we employ physically motivated damped oscillatory forms. The oscillatory part approximates local structuring with a characteristic repeat distance $\\lambda$, and the envelope $E(r)$ imposes decay reflecting the spatial dimensionality and physical regime.\n\nWe define\n$$\ng(r) = 1 + A \\, \\cos\\!\\left( \\frac{2\\pi \\, (r - r_{0})}{\\lambda} \\right) \\, E(r) \\, ,\n$$\nwith the following envelopes:\n- Two-dimensional algebraic decay\n$$\nE_{\\text{alg}}(r) = \\left(1 + \\frac{r}{\\lambda}\\right)^{-\\eta} \\, , \\quad \\eta  0 \\, .\n$$\nThis expresses slow decay of structural correlations consistent with quasi-long-range behavior; smaller $\\eta$ implies slower decay and therefore a weaker tendency toward a plateau in $N_{2}(r)$.\n- Two-dimensional exponential decay\n$$\nE_{\\exp}^{(2\\mathrm{D})}(r) = \\exp\\!\\left( - \\frac{r}{\\xi} \\right) \\, , \\quad \\xi  0 \\, .\n$$\nThis reflects short-range positional order characteristic of the hexatic regime, where $g(r) - 1$ decays rapidly with $r$.\n- Three-dimensional exponentially damped oscillations with additional polynomial attenuation\n$$\nE_{\\text{exp-poly}}^{(3\\mathrm{D})}(r) = \\frac{\\exp\\!\\left( - \\frac{r}{\\xi} \\right)}{\\left(1 + \\frac{r}{\\lambda}\\right)^{p}} \\, , \\quad p  0 \\, .\n$$\nThis envelope captures the more rapid suppression of correlations in three dimensions.\n\nBecause the RDF $g(r)$ is nonnegative by definition, for numerical robustness we enforce $g(r) \\geq 0$ by clipping negative values of the analytic model to zero. This ensures that computed $N_{d}(r)$ is nondecreasing and physically interpretable as a cumulative neighbor count.\n\nAlgorithmic design follows from these principles:\n1. Construct a uniform grid $r_{i} = r_{\\text{min-grid}} + i h$ for $i = 0,1,\\dots,N$, with $r_{\\text{min-grid}} = 0.05$ nanometers, $r_{\\text{max-grid}} = 5.0$ nanometers, and grid spacing $h = 0.001$ nanometers. This resolution balances accuracy and computational cost.\n2. Evaluate $g(r_{i})$ according to the model, apply clipping $g(r_{i}) \\leftarrow \\max(g(r_{i}), 0)$, and compute the discrete derivative $\\Delta g_{i} = g(r_{i+1}) - g(r_{i})$.\n3. Detect the first local maximum by finding the first index $i_{\\text{peak}}$ such that $\\Delta g_{i_{\\text{peak}}-1}  0$ and $\\Delta g_{i_{\\text{peak}}}  0$, corresponding to a sign change from positive to negative in the discrete derivative. The radius at the peak is $r_{\\text{peak}} = r_{i_{\\text{peak}}}$.\n4. Detect the first local minimum after $i_{\\text{peak}}$ by finding the first index $i_{\\min}  i_{\\text{peak}}$ such that $\\Delta g_{i_{\\min}-1}  0$ and $\\Delta g_{i_{\\min}}  0$, corresponding to a sign change from negative to positive. The radius at the minimum is $r_{\\min} = r_{i_{\\min}}$.\n5. Compute $N_{d}(r_{i})$ for all $i$ via cumulative numerical quadrature of the integrand $\\rho \\, g(r_{i}) \\, r_{i}^{d-1}$ multiplied by $S_{d}$. A simple and reliable approach is the composite trapezoidal rule, which approximates the integral by summing $\\frac{1}{2} (f_{i} + f_{i+1}) h$ over successive subintervals, where $f_{i} = S_{d} \\, \\rho \\, g(r_{i}) \\, r_{i}^{d-1}$. This yields $N_{d}(r_{i})$ as a cumulative sum over the grid.\n6. Evaluate $N_{d}(r_{\\min})$ by indexing the cumulative integral at $i_{\\min}$. Then compute the slope metric\n$$\n\\mathcal{S} = \\frac{N_{d}(r_{\\min} + \\Delta) - N_{d}(r_{\\min})}{\\Delta} \\, ,\n$$\nusing $\\Delta = 0.2$ nanometers. The value at $r_{\\min} + \\Delta$ can be obtained by reading the cumulative integral at the grid index closest to $r_{\\min} + \\Delta$.\n7. Report $N_{d}(r_{\\min})$ (dimensionless) and $\\mathcal{S}$ (neighbors per nanometer) for each test case.\n\nScientific interpretation connects the decay envelope to the stability of the first coordination shell. In two dimensions with algebraic decay, $E_{\\text{alg}}(r)$ decreases slowly with $r$, so $g(r)$ remains significantly above its asymptotic value $1$ over long distances. As a result, $N_{2}(r)$ continues increasing notably beyond the first minimum, yielding a larger $\\mathcal{S}$ and a less distinct plateau. In the hexatic-like two-dimensional case with exponential decay, $E_{\\exp}^{(2\\mathrm{D})}(r)$ suppresses oscillations more strongly, so $N_{2}(r)$ approaches a near-plateau more rapidly, resulting in smaller $\\mathcal{S}$. In three dimensions, correlations decay even more rapidly because $E_{\\text{exp-poly}}^{(3\\mathrm{D})}(r)$ combines exponential and polynomial attenuation, leading to an even clearer plateau and typically the smallest $\\mathcal{S}$. The extreme slow-decay two-dimensional case with very small $\\eta$ accentuates the lack of a stable coordination shell by maintaining a large $\\mathcal{S}$.\n\nThis methodology is general, relying only on the fundamental definition of coordination numbers from $g(r)$ and basic numerical quadrature. The test suite covers a typical two-dimensional slow-decay regime, a two-dimensional hexatic-like regime with short-range positional correlations, a three-dimensional liquid, and an extreme slow-decay edge case to test the robustness of shell stability detection. The outputs are quantitative and directly comparable across cases because $N_{d}(r_{\\min})$ is dimensionless and $\\mathcal{S}$ is expressed in neighbors per nanometer.",
            "answer": "```python\n# Python 3.12\n# Libraries: numpy 1.23.5, scipy 1.11.4 (not used)\nimport numpy as np\n\ndef build_grid(r_min=0.05, r_max=5.0, h=0.001):\n    n = int(np.floor((r_max - r_min) / h)) + 1\n    r = r_min + np.arange(n) * h\n    return r, h\n\ndef envelope_2d_alg(r, lam, eta):\n    # Algebraic envelope: (1 + r/lambda)^(-eta)\n    return (1.0 + r / lam) ** (-eta)\n\ndef envelope_2d_exp(r, xi):\n    # Exponential envelope: exp(-r/xi)\n    return np.exp(-r / xi)\n\ndef envelope_3d_exp_poly(r, xi, lam, p):\n    # Exponential with polynomial attenuation: exp(-r/xi) / (1 + r/lambda)^p\n    return np.exp(-r / xi) / (1.0 + r / lam) ** p\n\ndef g_of_r(r, params):\n    # Common oscillatory form with clipping to enforce non-negativity\n    A = params['A']\n    lam = params['lambda']\n    r0 = params['r0']\n    kind = params['kind']\n    if kind == '2d_alg':\n        eta = params['eta']\n        env = envelope_2d_alg(r, lam, eta)\n    elif kind == '2d_exp':\n        xi = params['xi']\n        env = envelope_2d_exp(r, xi)\n    elif kind == '3d_exp_poly':\n        xi = params['xi']\n        p = params['p']\n        env = envelope_3d_exp_poly(r, xi, lam, p)\n    else:\n        raise ValueError(\"Unknown envelope kind.\")\n\n    osc = np.cos(2.0 * np.pi * (r - r0) / lam)\n    g = 1.0 + A * osc * env\n    # Enforce physical non-negativity\n    g = np.maximum(g, 0.0)\n    return g\n\ndef find_first_peak_and_min(r, g):\n    # Use discrete derivative sign changes to find first local maximum and subsequent minimum\n    dg = np.diff(g)\n    peak_idx = None\n    min_idx = None\n    # Find first sign change + to -\n    for i in range(1, len(dg)):\n        if dg[i-1] > 0.0 and dg[i]  0.0:\n            peak_idx = i\n            break\n    if peak_idx is None:\n        # Fallback: take global maximum index\n        peak_idx = int(np.argmax(g))\n    # Find first sign change - to + after peak\n    for i in range(peak_idx + 1, len(dg)):\n        if dg[i-1]  0.0 and dg[i] > 0.0:\n            min_idx = i\n            break\n    if min_idx is None:\n        # Fallback: take next extremum or last index\n        min_idx = min(len(r) - 2, peak_idx + 50)  # arbitrary fallback near peak\n    return peak_idx, min_idx\n\ndef cumulative_trapezoid(y, h):\n    # Cumulative integral using composite trapezoid rule\n    # y[i] corresponds to f(r_i)\n    # cum[i] approximates integral from r_0 to r_i\n    cum = np.zeros_like(y)\n    # cum[0] = 0 by definition\n    for i in range(1, len(y)):\n        cum[i] = cum[i-1] + 0.5 * (y[i-1] + y[i]) * h\n    return cum\n\ndef compute_results_for_case(params, r, h):\n    d = params['d']\n    rho = params['rho']\n    g = g_of_r(r, params)\n\n    # Detect first peak and subsequent minimum\n    peak_idx, min_idx = find_first_peak_and_min(r, g)\n    r_peak = r[peak_idx]\n    r_min = r[min_idx]\n\n    # Build integrand f(r) = S_d * rho * g(r) * r^(d-1)\n    if d == 2:\n        S_d = 2.0 * np.pi\n        power = 1\n    elif d == 3:\n        S_d = 4.0 * np.pi\n        power = 2\n    else:\n        raise ValueError(\"Dimension must be 2 or 3.\")\n    integrand = S_d * rho * g * (r ** power)\n\n    # Cumulative integral for N_d(r)\n    Ncum = cumulative_trapezoid(integrand, h)\n\n    # Coordination number at first minimum\n    N_at_rmin = float(Ncum[min_idx])\n\n    # Post-minimum slope over Delta = 0.2 nm\n    Delta = 0.2\n    r_target = r_min + Delta\n    # Find closest index to r_target\n    target_idx = int(np.clip(np.searchsorted(r, r_target), 0, len(r) - 1))\n    N_target = float(Ncum[target_idx])\n    Slope = (N_target - N_at_rmin) / Delta\n\n    return N_at_rmin, Slope\n\ndef solve():\n    # Define radial grid\n    r, h = build_grid(r_min=0.05, r_max=5.0, h=0.001)\n\n    # Test cases as specified\n    test_cases = [\n        # Case 1: 2D algebraic envelope, eta=0.25\n        {\n            'd': 2,\n            'rho': 12.8,         # nm^-2\n            'A': 0.35,\n            'lambda': 0.30,      # nm\n            'r0': 0.30,          # nm\n            'kind': '2d_alg',\n            'eta': 0.25\n        },\n        # Case 2: 2D exponential envelope, xi=1.0 nm\n        {\n            'd': 2,\n            'rho': 12.8,         # nm^-2\n            'A': 0.35,\n            'lambda': 0.30,      # nm\n            'r0': 0.30,          # nm\n            'kind': '2d_exp',\n            'xi': 1.0            # nm\n        },\n        # Case 3: 3D exponential with polynomial attenuation, xi=0.5 nm, p=2.0\n        {\n            'd': 3,\n            'rho': 30.0,         # nm^-3\n            'A': 0.35,\n            'lambda': 0.30,      # nm\n            'r0': 0.30,          # nm\n            'kind': '3d_exp_poly',\n            'xi': 0.50,          # nm\n            'p': 2.0\n        },\n        # Case 4: 2D algebraic envelope, extreme slow decay eta=0.05\n        {\n            'd': 2,\n            'rho': 12.8,         # nm^-2\n            'A': 0.35,\n            'lambda': 0.30,      # nm\n            'r0': 0.30,          # nm\n            'kind': '2d_alg',\n            'eta': 0.05\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        N_at_rmin, Slope = compute_results_for_case(params, r, h)\n        results.append(N_at_rmin)\n        results.append(Slope)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}