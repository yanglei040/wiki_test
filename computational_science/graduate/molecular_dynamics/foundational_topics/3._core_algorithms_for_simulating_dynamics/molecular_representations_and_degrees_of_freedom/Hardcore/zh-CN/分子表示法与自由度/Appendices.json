{
    "hands_on_practices": [
        {
            "introduction": "我们从最简单的非平凡系统——双原子分子——开始。虽然笛卡尔坐标很简单，但内坐标（键长、角度）通常更直观，也与化学性质更相关。本练习  旨在探索这种坐标变换所需付出的数学代价：雅可比行列式。我们将看到，这个因子不仅仅是一个数学上的奇特存在，它对于正确的统计抽样以及将动能与温度关联起来至关重要。",
            "id": "3426902",
            "problem": "考虑一个由两个点质量 $m_{1}$ 和 $m_{2}$ 组成的自由、孤立的双原子分子，它们在三维空间中的笛卡尔位置矢量分别为 $\\mathbf{r}_{1}$ 和 $\\mathbf{r}_{2}$。引入质心 (COM) 坐标 $\\mathbf{R}_{\\mathrm{cm}}$ 和内部间距矢量 $\\mathbf{s} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$。用球坐标 $(R,\\theta,\\phi)$ 表示内部矢量 $\\mathbf{s}$，其由标准关系式 $s_{x} = R \\sin\\theta \\cos\\phi$，$s_{y} = R \\sin\\theta \\sin\\phi$ 和 $s_{z} = R \\cos\\theta$ 定义，其中 $R \\ge 0$，$\\theta \\in [0,\\pi]$ 且 $\\phi \\in [0,2\\pi)$。\n\n仅使用坐标变换和相空间测度的基本定义，并从牛顿动能 $T = \\frac{1}{2} m v^{2}$ 以及折合质量 $\\mu = \\frac{m_{1} m_{2}}{m_{1} + m_{2}}$ 出发，完成以下任务：\n\n(a) 推导从笛卡尔分量 $(s_{x},s_{y},s_{z})$ 到内部球坐标 $(R,\\theta,\\phi)$ 变换的雅可比行列式 $J(R,\\theta)$，该变换由 $\\mathrm{d}^{3}\\mathbf{s} = J(R,\\theta)\\,\\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 隐式定义。\n\n(b) 假设势能 $U(R)$ 是一个仅依赖于 $R$ 的各向同性函数，解释在正则系综中进行分子动力学 (MD) 采样时，$J(R,\\theta)$ 如何（在一个归一化常数之内）进入正则构型概率密度 $p(R,\\theta,\\phi)$。然后，从用 $(R,\\theta,\\phi)$ 及其时间导数 $(\\dot{R},\\dot{\\theta},\\dot{\\phi})$ 表示的相对运动的动能出发，讨论如何从内部速度构建一个与麦克斯韦-玻尔兹曼 (MB) 分布和能量均分原理一致的温度估算器。\n\n以单个关于 $J(R,\\theta)$ 的闭式解析表达式的形式提供你的最终答案。不需要进行数值取整。不要在最终表达式中包含单位。",
            "solution": "该问题被验证为具有科学依据、适定且客观。它是经典力学和统计力学中一个与分子动力学相关的标准练习。\n\n**(a) 雅可比行列式 $J(R,\\theta)$ 的推导**\n\n该问题要求计算从内部间距矢量 $\\mathbf{s}$ 的笛卡尔坐标 $(s_x, s_y, s_z)$ 到球坐标 $(R, \\theta, \\phi)$ 变换的雅可比行列式 $J(R,\\theta)$。笛卡尔坐标中的体元是 $\\mathrm{d}^3\\mathbf{s} = \\mathrm{d}s_x \\mathrm{d}s_y \\mathrm{d}s_z$。向球坐标的变换引入了一个雅可比因子，使得体元变为 $\\mathrm{d}^3\\mathbf{s} = |J_{\\det}| \\, \\mathrm{d}R \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi$，其中 $J_{\\det}$ 是雅可比矩阵的行列式。问题将 $J(R,\\theta)$ 定义为这个因子，所以 $J(R,\\theta) = |J_{\\det}|$。\n\n变换方程如下所示：\n$$s_x = R \\sin\\theta \\cos\\phi$$\n$$s_y = R \\sin\\theta \\sin\\phi$$\n$$s_z = R \\cos\\theta$$\n\n雅可比行列式 $J_{\\det}$ 是偏导数矩阵 $\\frac{\\partial(s_x, s_y, s_z)}{\\partial(R, \\theta, \\phi)}$ 的行列式：\n$$\nJ_{\\det} = \\det \\begin{pmatrix} \\frac{\\partial s_x}{\\partial R} & \\frac{\\partial s_x}{\\partial \\theta} & \\frac{\\partial s_x}{\\partial \\phi} \\\\ \\frac{\\partial s_y}{\\partial R} & \\frac{\\partial s_y}{\\partial \\theta} & \\frac{\\partial s_y}{\\partial \\phi} \\\\ \\frac{\\partial s_z}{\\partial R} & \\frac{\\partial s_z}{\\partial \\theta} & \\frac{\\partial s_z}{\\partial \\phi} \\end{pmatrix}\n$$\n首先，我们计算所需的偏导数：\n$$\n\\begin{matrix}\n\\frac{\\partial s_x}{\\partial R} = \\sin\\theta \\cos\\phi  \\quad & \\frac{\\partial s_x}{\\partial \\theta} = R \\cos\\theta \\cos\\phi  \\quad & \\frac{\\partial s_x}{\\partial \\phi} = -R \\sin\\theta \\sin\\phi \\\\\n\\frac{\\partial s_y}{\\partial R} = \\sin\\theta \\sin\\phi  \\quad & \\frac{\\partial s_y}{\\partial \\theta} = R \\cos\\theta \\sin\\phi  \\quad & \\frac{\\partial s_y}{\\partial \\phi} = R \\sin\\theta \\cos\\phi \\\\\n\\frac{\\partial s_z}{\\partial R} = \\cos\\theta  \\quad & \\frac{\\partial s_z}{\\partial \\theta} = -R \\sin\\theta  \\quad & \\frac{\\partial s_z}{\\partial \\phi} = 0\n\\end{matrix}\n$$\n现在，我们构建雅可比矩阵并计算其行列式。\n$$\nJ_{\\det} = \\begin{vmatrix}\n\\sin\\theta \\cos\\phi & R \\cos\\theta \\cos\\phi & -R \\sin\\theta \\sin\\phi \\\\\n\\sin\\theta \\sin\\phi & R \\cos\\theta \\sin\\phi & R \\sin\\theta \\cos\\phi \\\\\n\\cos\\theta & -R \\sin\\theta & 0\n\\end{vmatrix}\n$$\n沿第三行展开行列式：\n$$\nJ_{\\det} = \\cos\\theta \\begin{vmatrix} R \\cos\\theta \\cos\\phi & -R \\sin\\theta \\sin\\phi \\\\ R \\cos\\theta \\sin\\phi & R \\sin\\theta \\cos\\phi \\end{vmatrix} - (-R \\sin\\theta) \\begin{vmatrix} \\sin\\theta \\cos\\phi & -R \\sin\\theta \\sin\\phi \\\\ \\sin\\theta \\sin\\phi & R \\sin\\theta \\cos\\phi \\end{vmatrix} + 0\n$$\n我们计算这两个 $2 \\times 2$ 行列式：\n$$\n\\det_1 = (R \\cos\\theta \\cos\\phi)(R \\sin\\theta \\cos\\phi) - (-R \\sin\\theta \\sin\\phi)(R \\cos\\theta \\sin\\phi) \\\\\n= R^2 \\sin\\theta \\cos\\theta \\cos^2\\phi + R^2 \\sin\\theta \\cos\\theta \\sin^2\\phi \\\\\n= R^2 \\sin\\theta \\cos\\theta (\\cos^2\\phi + \\sin^2\\phi) = R^2 \\sin\\theta \\cos\\theta\n$$\n$$\n\\det_2 = (\\sin\\theta \\cos\\phi)(R \\sin\\theta \\cos\\phi) - (-R \\sin\\theta \\sin\\phi)(\\sin\\theta \\sin\\phi) \\\\\n= R \\sin^2\\theta \\cos^2\\phi + R \\sin^2\\theta \\sin^2\\phi \\\\\n= R \\sin^2\\theta (\\cos^2\\phi + \\sin^2\\phi) = R \\sin^2\\theta\n$$\n将这些结果代回 $J_{\\det}$ 的表达式：\n$$\nJ_{\\det} = \\cos\\theta (R^2 \\sin\\theta \\cos\\theta) + R \\sin\\theta (R \\sin^2\\theta) \\\\\n= R^2 \\sin\\theta \\cos^2\\theta + R^2 \\sin^3\\theta \\\\\n= R^2 \\sin\\theta (\\cos^2\\theta + \\sin^2\\theta) = R^2 \\sin\\theta\n$$\n雅可比行列式为 $J_{\\det} = R^2 \\sin\\theta$。问题通过体元 $\\mathrm{d}^3\\mathbf{s} = J(R,\\theta)\\,\\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 来定义 $J(R, \\theta)$。这需要行列式的绝对值。对于给定的坐标范围 $R \\ge 0$ 和 $\\theta \\in [0,\\pi]$，项 $\\sin\\theta$ 是非负的，因此 $|J_{\\det}| = R^2 \\sin\\theta$。\n因此，雅可比行列式为 $J(R, \\theta) = R^{2}\\sin\\theta$。\n\n**(b) 对统计力学和温度估算的影响**\n\n雅可比行列式 $J(R,\\theta)$ 在用内部坐标构建统计力学平均值时起着至关重要的作用。\n\n**正则构型概率密度：**\n在正则系综（粒子数 $N$、体积 $V$ 和温度 $T$ 恒定）中，观测到系统处于特定微观构型的概率与玻尔兹曼因子 $\\exp(-U / (k_B T))$ 成正比，其中 $U$ 是该构型的势能，$k_B$ 是玻尔兹曼常数。\n对于 MD 采样，我们关心的是所选坐标空间上的概率密度函数。内部自由度的坐标是 $(R, \\theta, \\phi)$。在构型空间的无穷小体元内发现系统构型的概率 $\\mathrm{d}P$ 由下式给出：\n$$ \\mathrm{d}P \\propto \\exp\\left(-\\frac{U(\\text{config})}{k_B T}\\right) \\mathrm{d}V_{\\text{config}} $$\n势能被给定为一个各向同性函数 $U(R)$。矢量 $\\mathbf{s}$ 所在三维空间中的体元是 $\\mathrm{d}^3\\mathbf{s}$。如 (a) 部分所示，当用球坐标表示时，该体元并非简单的 $\\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$，而是 $\\mathrm{d}^3\\mathbf{s} = R^2 \\sin\\theta \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = J(R, \\theta) \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$。\n在范围 $[R, R+\\mathrm{d}R]$、$[\\theta, \\theta+\\mathrm{d}\\theta]$ 和 $[\\phi, \\phi+\\mathrm{d}\\phi]$ 内发现内部构型的概率为：\n$$ \\mathrm{d}P(R, \\theta, \\phi) \\propto \\exp\\left(-\\frac{U(R)}{k_B T}\\right) J(R, \\theta) \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi $$\n正则构型概率密度 $p(R, \\theta, \\phi)$ 由 $\\mathrm{d}P = p(R, \\theta, \\phi) \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 定义。因此，在一个归一化常数 $C$ 之内：\n$$ p(R, \\theta, \\phi) = C \\exp\\left(-\\frac{U(R)}{k_B T}\\right) R^2 \\sin\\theta $$\n雅可比行列式 $J(R, \\theta) = R^2 \\sin\\theta$ 作为一个度规因子或相空间体积因子。它确保构型以正确的统计权重被采样。例如，$\\theta$ 接近 $\\pi/2$ 的状态在笛卡尔空间中比 $\\theta$ 接近 $0$ 或 $\\pi$ 的状态占据更多的“体积”。在使用这些内部坐标正确采样正则系综的 MD 模拟中，必须包含这个因子。\n\n**从内部速度估算温度：**\n双原子分子的总动能为 $T_{\\mathrm{total}} = \\frac{1}{2}m_1|\\dot{\\mathbf{r}}_1|^2 + \\frac{1}{2}m_2|\\dot{\\mathbf{r}}_2|^2$。通过变换到质心坐标 $\\mathbf{R}_{\\mathrm{cm}}$ 和相对坐标 $\\mathbf{s}$，动能可以分离为两个独立的项：\n$$ T_{\\mathrm{total}} = T_{\\mathrm{cm}} + T_{\\mathrm{rel}} = \\frac{1}{2}(m_1+m_2)|\\dot{\\mathbf{R}}_{\\mathrm{cm}}|^2 + \\frac{1}{2}\\mu|\\dot{\\mathbf{s}}|^2 $$\n其中 $\\mu = \\frac{m_1 m_2}{m_1+m_2}$ 是折合质量。我们关心的是内部运动，它由相对动能 $T_{\\mathrm{rel}} = \\frac{1}{2}\\mu|\\dot{\\mathbf{s}}|^2$ 描述。\n\n为了用球坐标表示 $T_{\\mathrm{rel}}$，我们首先找到 $|\\dot{\\mathbf{s}}|^2$ 的表达式。在标准正交球坐标基 $(\\mathbf{\\hat{r}}, \\mathbf{\\hat{\\theta}}, \\mathbf{\\hat{\\phi}})$ 中，速度矢量 $\\dot{\\mathbf{s}}$ 为：\n$$ \\dot{\\mathbf{s}} = \\dot{R}\\mathbf{\\hat{r}} + R\\dot{\\theta}\\mathbf{\\hat{\\theta}} + R\\sin\\theta\\dot{\\phi}\\mathbf{\\hat{\\phi}} $$\n模的平方是：\n$$ |\\dot{\\mathbf{s}}|^2 = \\dot{R}^2 + (R\\dot{\\theta})^2 + (R\\sin\\theta\\dot{\\phi})^2 = \\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2 $$\n将此代入 $T_{\\mathrm{rel}}$ 的表达式：\n$$ T_{\\mathrm{rel}} = \\frac{1}{2}\\mu \\left(\\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2\\right) $$\n为了应用能量均分原理，我们必须确定哈密顿量中的二次自由度。相对运动的哈密顿量是 $H_{\\mathrm{rel}} = T_{\\mathrm{rel}} + U(R)$。共轭动量是：\n$$ p_R = \\frac{\\partial T_{\\mathrm{rel}}}{\\partial \\dot{R}} = \\mu \\dot{R} $$\n$$ p_\\theta = \\frac{\\partial T_{\\mathrm{rel}}}{\\partial \\dot{\\theta}} = \\mu R^2 \\dot{\\theta} $$\n$$ p_\\phi = \\frac{\\partial T_{\\mathrm{rel}}}{\\partial \\dot{\\phi}} = \\mu R^2 \\sin^2\\theta \\dot{\\phi} $$\n用这些动量表示 $T_{\\mathrm{rel}}$：\n$$ T_{\\mathrm{rel}} = \\frac{p_R^2}{2\\mu} + \\frac{p_\\theta^2}{2\\mu R^2} + \\frac{p_\\phi^2}{2\\mu R^2 \\sin^2\\theta} $$\n相对运动的哈密顿量有3个动能项，每一项都是某个动量分量的二次方。正则系综中这些动量的麦克斯韦-玻尔兹曼分布意味着这些项中每一项的平均能量都是 $\\frac{1}{2}k_B T$。这就是均分原理。\n$$ \\left\\langle \\frac{p_R^2}{2\\mu} \\right\\rangle = \\frac{1}{2}k_B T, \\quad \\left\\langle \\frac{p_\\theta^2}{2\\mu R^2} \\right\\rangle = \\frac{1}{2}k_B T, \\quad \\left\\langle \\frac{p_\\phi^2}{2\\mu R^2 \\sin^2\\theta} \\right\\rangle = \\frac{1}{2}k_B T $$\n相对运动的总平均动能是这些平均值之和：\n$$ \\langle T_{\\mathrm{rel}} \\rangle = \\frac{3}{2}k_B T $$\n在 MD 模拟中，瞬时动能 $T_{\\mathrm{rel}}$ 可以在每个时间步从坐标 $(R, \\theta, \\phi)$ 及其时间导数 $(\\dot{R}, \\dot{\\theta}, \\dot{\\phi})$ 计算得出。这个瞬时动能的时间平均值，记为 $\\langle T_{\\mathrm{rel}} \\rangle_{MD}$，是系综平均 $\\langle T_{\\mathrm{rel}} \\rangle$ 的一个估算量。因此，通过将 MD 平均值与理论系综平均值等同，可以找到一个一致的温度估算器：\n$$ \\frac{3}{2}k_B T = \\langle T_{\\mathrm{rel}} \\rangle_{MD} = \\left\\langle \\frac{1}{2}\\mu \\left(\\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2\\right) \\right\\rangle_{MD} $$\n求解 $T$ 得到温度估算器：\n$$ T = \\frac{2}{3k_B} \\langle T_{\\mathrm{rel}} \\rangle_{MD} = \\frac{\\mu}{3k_B} \\left\\langle \\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2 \\right\\rangle_{MD} $$\n该估算器与麦克斯韦-玻尔兹曼分布一致，因为能量均分定理的推导依赖于对动量的 MB 分布进行积分，而该分布与 $\\exp(-H_{\\text{kin}}/(k_B T))$ 成正比。",
            "answer": "$$\n\\boxed{R^{2}\\sin\\theta}\n$$"
        },
        {
            "introduction": "接下来，我们转向一个更复杂的系统——三原子分子。在内坐标中，势能的表达通常很简单，但动能并非如此。本练习  将引入质量度规张量（或G矩阵），它揭示了看似独立的内坐标运动之间隐藏的“动力学耦合”。理解这一点对于分析分子振动和开发高级模拟算法至关重要。",
            "id": "3426928",
            "problem": "考虑一个由原子 $A$、$B$ 和 $C$ 组成的非线性三原子分子，其质量分别为 $m_A$、$m_B$ 和 $m_C$。设内坐标为 $q = (r_1, r_2, \\theta)$，其中 $r_1$ 是键长 $A$–$B$，$r_2$ 是键长 $B$–$C$，$\\theta$ 是以 $B$ 为顶点的键角。为消除整体平动和转动，采用以下具有物理动机的表示方法：\n\n- 将分子平面约束在 $x$–$y$ 平面内。\n- 通过要求从 $B$ 到 $A$ 的向量沿 $x$ 轴正方向来固定取向。\n- 施加质心约束，使质心位于原点。\n\n根据这些约定，定义相对于原子 $B$ 的位置向量为 $r_A = (r_1, 0, 0)$ 和 $r_C = (r_2 \\cos\\theta, r_2 \\sin\\theta, 0)$，并写出满足质心约束的绝对笛卡尔坐标 $R_A(q)$、$R_B(q)$、$R_C(q)$。使用动能的基本定义 $T = \\frac{1}{2} \\sum_{i \\in \\{A,B,C\\}} m_i \\left|\\dot{R}_i\\right|^2$ 和运动学关系 $\\dot{R} = J(q)\\,\\dot{q}$，其中 $J(q)$ 是笛卡尔嵌入相对于 $q$ 的雅可比矩阵，可以推导出 $T = \\frac{1}{2}\\,\\dot{q}^{\\mathsf{T}} G(q)\\, \\dot{q}$，其中质量度规 $G(q) = J(q)^{\\mathsf{T}} M J(q)$ 且 $M = \\mathrm{diag}(m_A I_3, m_B I_3, m_C I_3)$。\n\n任务：\n- 通过对 $R_A(q)$、$R_B(q)$、$R_C(q)$ 分别关于 $r_1$、$r_2$ 和 $\\theta$ 求导，显式地构造雅可比矩阵 $J(q)$。\n- 计算质量度规 $G(q)$，并确定哪些非对角线项编码了动能中 $\\dot{r}_1$、$\\dot{r}_2$ 和 $\\dot{\\theta}$ 之间的耦合。\n\n答案规格：\n- 令 $M = m_A + m_B + m_C$。\n- 你的最终答案必须是 $G(q)$ 中出现的耦合系数 $g_{r_1 r_2}(q)$ 的单一、闭式解析表达式。\n- 不需要进行数值计算，也无需四舍五入。请用 $m_A$、$m_B$、$m_C$、$M$ 和 $\\theta$ 来符号化地表示你的最终答案。",
            "solution": "### 步骤 1：提取已知条件\n- 一个由原子 $A$、$B$、$C$ 组成的非线性三原子分子，质量分别为 $m_A$、$m_B$、$m_C$。\n- 总质量 $M = m_A + m_B + m_C$。\n- 内坐标为 $q = (r_1, r_2, \\theta)$，其中 $r_1$ 是键长 $A$–$B$，$r_2$ 是键长 $B$–$C$，$\\theta$ 是以 $B$ 为顶点的键角。\n- 分子平面为 $x$–$y$ 平面。\n- 从 $B$ 到 $A$ 的向量沿 $x$ 轴正方向。\n- 质心位于原点：$\\sum_{i \\in \\{A,B,C\\}} m_i R_i = 0$。\n- 相对于原子 $B$ 的位置向量为 $r_A = (r_1, 0, 0)$ 和 $r_C = (r_2 \\cos\\theta, r_2 \\sin\\theta, 0)$。\n- 动能为 $T = \\frac{1}{2} \\sum_{i} m_i |\\dot{R}_i|^2 = \\frac{1}{2}\\,\\dot{q}^{\\mathsf{T}} G(q)\\, \\dot{q}$。\n- 质量度规张量为 $G(q) = J(q)^{\\mathsf{T}} M J(q)$，其中 $M = \\mathrm{diag}(m_A I_3, m_B I_3, m_C I_3)$。\n- $G$ 矩阵的一个元素由 $G_{ij}(q) = \\sum_{k \\in \\{A,B,C\\}} m_k \\frac{\\partial R_k}{\\partial q_i} \\cdot \\frac{\\partial R_k}{\\partial q_j}$ 给出。\n- 任务是计算耦合系数 $g_{r_1 r_2}(q)$，即质量度规张量的元素 $G_{12}(q)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：**该问题描述了分子动能以内坐标表示的标准公式，这是化学物理和分子动力学中的一个基本概念。使用质量度规张量（或 Wilson 形式主义中的 G 矩阵）是一种行之有效的方法。这些约束是将内运动与整体平动和转动分离开的物理上现实的方法。该问题是科学上合理的。\n- **适定性：**该问题提供了所有必要的定义和约束，以唯一地确定作为内坐标函数的笛卡尔坐标，并随后确定雅可比矩阵和 G 矩阵。目标是找到一个特定的、明确定义的数学量。该问题是适定的。\n- **客观性：**该问题以精确的数学和物理术语陈述，没有任何主观或偏见的语言。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它具有科学依据、适定、客观且完整。我将继续进行求解。\n\n### 求解推导\n第一步是确定绝对笛卡尔位置向量 $R_A$、$R_B$ 和 $R_C$ 作为内坐标 $q = (r_1, r_2, \\theta)$ 的函数。相对于原子 $B$ 的位置向量已知为 $r_A$ 和 $r_C$。我们可以将绝对位置写为：\n$R_A = R_B + r_A$\n$R_C = R_B + r_C$\n\n质心（COM）约束由下式给出：\n$$m_A R_A + m_B R_B + m_C R_C = 0$$\n将相对位置代入质心约束方程：\n$$m_A (R_B + r_A) + m_B R_B + m_C (R_B + r_C) = 0$$\n$$(m_A + m_B + m_C) R_B + m_A r_A + m_C r_C = 0$$\n使用定义 $M = m_A + m_B + m_C$，我们解出 $R_B$：\n$$R_B = -\\frac{1}{M} (m_A r_A + m_C r_C)$$\n现在我们可以用 $r_A$ 和 $r_C$ 来表示 $R_A$ 和 $R_C$：\n$$R_A = R_B + r_A = r_A - \\frac{1}{M} (m_A r_A + m_C r_C) = \\left(1 - \\frac{m_A}{M}\\right) r_A - \\frac{m_C}{M} r_C = \\frac{m_B+m_C}{M} r_A - \\frac{m_C}{M} r_C$$\n$$R_C = R_B + r_C = r_C - \\frac{1}{M} (m_A r_A + m_C r_C) = -\\frac{m_A}{M} r_A + \\left(1 - \\frac{m_C}{M}\\right) r_C = -\\frac{m_A}{M} r_A + \\frac{m_A+m_B}{M} r_C$$\n\n问题要求计算耦合系数 $g_{r_1 r_2}(q)$，即质量度规张量 $G$ 的元素 $G_{12}$。内坐标为 $q_1=r_1$，$q_2=r_2$ 和 $q_3=\\theta$。元素 $G_{r_1 r_2}$ 由下式给出：\n$$g_{r_1 r_2}(q) = G_{r_1 r_2} = \\sum_{k \\in \\{A,B,C\\}} m_k \\left( \\frac{\\partial R_k}{\\partial r_1} \\cdot \\frac{\\partial R_k}{\\partial r_2} \\right)$$\n我们需要计算笛卡尔位置向量关于 $r_1$ 和 $r_2$ 的偏导数。向量 $r_A$ 和 $r_C$ 对内坐标的依赖关系如下：\n$r_A(q) = (r_1, 0, 0)$\n$r_C(q) = (r_2 \\cos\\theta, r_2 \\sin\\theta, 0)$\n它们的偏导数是：\n$\\frac{\\partial r_A}{\\partial r_1} = (1, 0, 0)$; $\\frac{\\partial r_A}{\\partial r_2} = (0, 0, 0)$\n$\\frac{\\partial r_C}{\\partial r_1} = (0, 0, 0)$; $\\frac{\\partial r_C}{\\partial r_2} = (\\cos\\theta, \\sin\\theta, 0)$\n\n现在，我们计算绝对位置 $R_A, R_B, R_C$ 的导数：\n对于 $r_1$：\n$$\\frac{\\partial R_A}{\\partial r_1} = \\frac{m_B+m_C}{M} \\frac{\\partial r_A}{\\partial r_1} = \\frac{m_B+m_C}{M} (1, 0, 0)$$\n$$\\frac{\\partial R_B}{\\partial r_1} = -\\frac{m_A}{M} \\frac{\\partial r_A}{\\partial r_1} = -\\frac{m_A}{M} (1, 0, 0)$$\n$$\\frac{\\partial R_C}{\\partial r_1} = -\\frac{m_A}{M} \\frac{\\partial r_A}{\\partial r_1} = -\\frac{m_A}{M} (1, 0, 0)$$\n\n对于 $r_2$：\n$$\\frac{\\partial R_A}{\\partial r_2} = -\\frac{m_C}{M} \\frac{\\partial r_C}{\\partial r_2} = -\\frac{m_C}{M} (\\cos\\theta, \\sin\\theta, 0)$$\n$$\\frac{\\partial R_B}{\\partial r_2} = -\\frac{m_C}{M} \\frac{\\partial r_C}{\\partial r_2} = -\\frac{m_C}{M} (\\cos\\theta, \\sin\\theta, 0)$$\n$$\\frac{\\partial R_C}{\\partial r_2} = \\frac{m_A+m_B}{M} \\frac{\\partial r_C}{\\partial r_2} = \\frac{m_A+m_B}{M} (\\cos\\theta, \\sin\\theta, 0)$$\n\n接下来，我们计算每个原子的点积：\n$$\\frac{\\partial R_A}{\\partial r_1} \\cdot \\frac{\\partial R_A}{\\partial r_2} = \\left(\\frac{m_B+m_C}{M}\\right)\\left(-\\frac{m_C}{M}\\right) (1,0,0) \\cdot (\\cos\\theta, \\sin\\theta, 0) = -\\frac{m_C(m_B+m_C)}{M^2} \\cos\\theta$$\n$$\\frac{\\partial R_B}{\\partial r_1} \\cdot \\frac{\\partial R_B}{\\partial r_2} = \\left(-\\frac{m_A}{M}\\right)\\left(-\\frac{m_C}{M}\\right) (1,0,0) \\cdot (\\cos\\theta, \\sin\\theta, 0) = \\frac{m_A m_C}{M^2} \\cos\\theta$$\n$$\\frac{\\partial R_C}{\\partial r_1} \\cdot \\frac{\\partial R_C}{\\partial r_2} = \\left(-\\frac{m_A}{M}\\right)\\left(\\frac{m_A+m_B}{M}\\right) (1,0,0) \\cdot (\\cos\\theta, \\sin\\theta, 0) = -\\frac{m_A(m_A+m_B)}{M^2} \\cos\\theta$$\n\n最后，我们通过将这些项按各自的质量加权求和来组合出 $g_{r_1 r_2}$ 的表达式：\n$$g_{r_1 r_2} = m_A \\left(-\\frac{m_C(m_B+m_C)}{M^2} \\cos\\theta\\right) + m_B \\left(\\frac{m_A m_C}{M^2} \\cos\\theta\\right) + m_C \\left(-\\frac{m_A(m_A+m_B)}{M^2} \\cos\\theta\\right)$$\n提取公因式 $\\frac{\\cos\\theta}{M^2}$：\n$$g_{r_1 r_2} = \\frac\n{\\cos\\theta}{M^2} \\left[ -m_A m_C(m_B+m_C) + m_A m_B m_C - m_A m_C(m_A+m_B) \\right]$$\n展开括号内的项：\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_B m_C - m_A m_C^2 + m_A m_B m_C - m_A^2 m_C - m_A m_B m_C \\right]$$\n项 $+m_A m_B m_C$ 和一个 $-m_A m_B m_C$相互抵消：\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_C^2 - m_A^2 m_C - m_A m_B m_C \\right]$$\n提取公因式 $-m_A m_C$：\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_C (m_C + m_A + m_B) \\right]$$\n注意到 $m_A+m_B+m_C = M$：\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_C M \\right]$$\n通过消去一个因子 $M$ 来简化表达式：\n$$g_{r_1 r_2}(q) = - \\frac{m_A m_C}{M} \\cos\\theta$$\n这就是两个键伸缩坐标 $r_1$ 和 $r_2$ 之间的耦合系数。",
            "answer": "$$\\boxed{- \\frac{m_A m_C}{M} \\cos(\\theta)}$$"
        },
        {
            "introduction": "最后，我们来解决一个定义内坐标时的常见陷阱：冗余性。虽然一个包含 $3N-6$ 个坐标的最小集是足够的，但定义更多的坐标往往更方便，但这会导致线性依赖。这个计算练习  演示了一种强大的数值技术，它使用威尔逊B矩阵和奇异值分解（SVD）来自动检测这些冗余，并为如何解决它们提供建议。这是建立复杂分子模拟时一项至关重要的技能。",
            "id": "3426888",
            "problem": "给定一个三原子分子，其原子标号为 $O$、$H_1$ 和 $H_2$，以及一组由以下四个标量函数组成的冗余内坐标：$q_1 =$ 键长 $r(O,H_1)$，单位为 $\\mathrm{\\AA}$；$q_2 =$ 键长 $r(O,H_2)$，单位为 $\\mathrm{\\AA}$；$q_3 =$ 键角 $\\angle(H_1\\text{--}O\\text{--}H_2)$，单位为弧度；$q_4 =$ 非键合距离 $r(H_1,H_2)$，单位为 $\\mathrm{\\AA}$。设这三个原子的笛卡尔坐标堆叠成一个单一向量 $x \\in \\mathbb{R}^{9}$，按原子 $(O, H_1, H_2)$ 和每个原子的分量 $(x,y,z)$ 的顺序排列。\n\n定义 Wilson $B$ 矩阵为内坐标相对于笛卡尔坐标的雅可比矩阵，其元素为\n$$\nB_{k,\\alpha i} \\equiv \\frac{\\partial q_k}{\\partial r_{i\\alpha}},\n$$\n其中 $k \\in \\{1,2,3,4\\}$ 索引内坐标，$i \\in \\{O,H_1,H_2\\}$ 索引原子，$\\alpha \\in \\{x,y,z\\}$ 索引笛卡尔分量。因此，$B \\in \\mathbb{R}^{4 \\times 9}$。\n\n任务：\n- 从内坐标作为笛卡尔坐标的几何函数的定义以及 $B$ 作为雅可比矩阵的定义出发，使用中心有限差分法构建 $B$ 的数值近似。对每个笛卡尔分量施加大小为 $h$ 的对称扰动，并通过下式近似每个偏导数：\n$$\n\\frac{\\partial q_k}{\\partial r_{i\\alpha}} \\approx \\frac{q_k(x + h e_{i\\alpha}) - q_k(x - h e_{i\\alpha})}{2h},\n$$\n其中 $e_{i\\alpha}$ 是 $\\mathbb{R}^{9}$ 中对相应笛卡尔分量施加扰动的单位向量。选择的 $h$ 单位为 $\\mathrm{\\AA}$。\n- 通过奇异值分解（SVD，Singular Value Decomposition）计算 $B$ 的奇异值。按降序报告奇异值。通过将最小的奇异值与最大的奇异值进行比较，利用奇异值识别内坐标之间的近线性相关性。在这里，近线性相关性定义为任何满足 $s / s_{\\max}  \\tau$ 的奇异值 $s$，其中使用了一个相对阈值 $\\tau$。\n- 提出一种算法正则化方法，通过选择一个内坐标来舍弃，从而减少冗余。一种有原则的方法是构建对称的内坐标度规\n$$\nG \\equiv B B^{\\top} \\in \\mathbb{R}^{4 \\times 4},\n$$\n其特征值是 $B$ 的奇异值的平方，其特征向量识别了内坐标的线性组合。设 $u_{\\min}$ 是与 $G$ 的最小特征值相关联的单位范数特征向量。作为一个具体、确定性的规则，选择要舍弃的坐标索引 $j^\\star \\in \\{0,1,2,3\\}$（对 $\\{q_1,q_2,q_3,q_4\\}$ 进行从零开始的索引），该索引对应于 $u_{\\min}$ 的最大分量幅值，即\n$$\nj^\\star = \\arg\\max_{j \\in \\{0,1,2,3\\}} |(u_{\\min})_j|.\n$$\n\n使用以下笛卡尔几何形状的测试套件（所有坐标单位为 $\\mathrm{\\AA}$，角度单位为弧度）：\n\n- 测试用例 1（弯曲参考几何）：$O=(0,0,0)$, $H_1=(0.9572,0,0)$, $H_2=(-0.2399872,0.927297,0)$。\n- 测试用例 2（将测试用例 1 绕 $z$ 轴进行 $\\phi = 47^\\circ$ 的刚体旋转）：$R_z(\\phi)$ 是绕 $z$ 轴的旋转，通过 $R_z(\\phi)\\,r$ 计算每个原子 $r$ 的新坐标，其中 $\\phi$ 使用弧度。\n- 测试用例 3（近线性角 $\\angle(H_1\\text{--}O\\text{--}H_2) \\approx 179.9^\\circ$）：$O=(0,0,0)$, $H_1=(1,0,0)$, $H_2=(-\\cos\\delta,\\sin\\delta,0)$，其中 $\\delta = 0.1^\\circ$ 以弧度表示。\n- 测试用例 4（对称弯曲，大角度）：$O=(0,0,0)$, $H_1=(1,0,0)$, $H_2=(\\cos(120^\\circ),\\sin(120^\\circ),0)$，其中三角函数参数转换为弧度。\n\n要求：\n- 使用中心有限差分法，以 $\\mathrm{\\AA}$ 为单位的统一标量步长 $h$ 构建 $B$。使用基于 `arctan2` 的稳健角度定义，以使角度 $\\angle(H_1\\text{--}O\\text{--}H_2)$ 位于 $[0,\\pi]$ 弧度范围内。\n- 对每个测试用例，按降序计算 $B$ 的奇异值。\n- 对每个测试用例，计算 $G = B B^{\\top}$、其最小特征值对应的单位特征向量 $u_{\\min}$，以及根据上述规则建议的舍弃索引 $j^\\star$。\n- 在每个测试中均使用以下常量：$h = 10^{-6}\\ \\mathrm{\\AA}$，$\\tau = 10^{-8}$。\n- 单位：输入的笛卡尔坐标单位为 $\\mathrm{\\AA}$，角度内坐标必须以弧度计算。奇异值是无量纲的。报告的奇异值应四舍五入到六位小数。\n\n最终输出规范：\n- 对每个测试用例，生成一个形式为 $[svals,drop]$ 的结果，其中 $svals$ 是 $B$ 的四个奇异值按降序排列的列表，每个值四舍五入到六位小数，而 $drop$ 是要舍弃的整数索引 $j^\\star$（从零开始）。\n- 将四个结果聚合到单行中：一个用方括号括起来的逗号分隔列表，例如 $[[\\dots],[\\dots],[\\dots],[\\dots]]$，不含任何空格。",
            "solution": "用户的请求是一个有效的科学问题。它定义明确，基于分子力学和线性代数的原理，并为得到唯一的、可验证的解提供了所有必要的数据和定义。\n\n### 基于原理的设计\n\n该问题要求使用一组冗余的内坐标，为三原子分子构建和分析 Wilson B 矩阵。解决方案涉及数值微分、线性代数以及一种用于识别和解决坐标冗余的算法方法。\n\n#### 1. 内坐标 ($q_k$) 及其几何定义\n\n问题为包含原子 $O$、$H_1$ 和 $H_2$ 的三原子分子定义了一组四个内坐标 $\\{q_1, q_2, q_3, q_4\\}$。它们的定义依赖于笛卡尔坐标向量 $x \\in \\mathbb{R}^9$，其中 $x = (\\mathbf{r}_O, \\mathbf{r}_{H_1}, \\mathbf{r}_{H_2})$ 且 $\\mathbf{r}_i = (r_{ix}, r_{iy}, r_{iz})$。\n\n-   **键长 $q_1$**：原子 $O$ 和 $H_1$ 之间的距离。\n    $$q_1(x) = \\|\\mathbf{r}_{H_1} - \\mathbf{r}_O\\|$$\n-   **键长 $q_2$**：原子 $O$ 和 $H_2$ 之间的距离。\n    $$q_2(x) = \\|\\mathbf{r}_{H_2} - \\mathbf{r}_O\\|$$\n-   **键角 $q_3$**：角 $\\angle(H_1\\text{--}O\\text{--}H_2)$。为确保数值稳定性，特别是对于接近 $0$ 和 $\\pi$ 的角度，该值使用双参数反正切函数计算。令 $\\mathbf{v}_1 = \\mathbf{r}_{H_1} - \\mathbf{r}_O$ 且 $\\mathbf{v}_2 = \\mathbf{r}_{H_2} - \\mathbf{r}_O$。角度 $q_3$ 由下式给出：\n    $$q_3(x) = \\mathrm{atan2}(\\|\\mathbf{v}_1 \\times \\mathbf{v}_2\\|, \\mathbf{v}_1 \\cdot \\mathbf{v}_2)$$\n    该定义正确地得出一个在 $[0, \\pi]$ 弧度范围内的角度。\n-   **非键合距离 $q_4$**：原子 $H_1$ 和 $H_2$ 之间的距离。\n    $$q_4(x) = \\|\\mathbf{r}_{H_1} - \\mathbf{r}_{H_2}\\|$$\n\n这四个坐标通过余弦定理在几何上相关，$q_4^2 = q_1^2 + q_2^2 - 2q_1q_2 \\cos(q_3)$，这在坐标集中引入了一个单一的冗余。一个非线性的三原子分子只有 $3N-6=3$ 个内部自由度。\n\n#### 2. 通过有限差分构建 Wilson B 矩阵\n\nWilson B 矩阵是内坐标相对于笛卡尔坐标的雅可比矩阵。其元素是偏导数 $B_{k,j} = \\partial q_k / \\partial x_j$，其中 $k$ 索引内坐标，$j$ 索引 9 个笛卡尔分量。问题指定使用步长为 $h$ 的中心有限差分法对这些导数进行数值近似：\n$$\nB_{k,j} = \\frac{\\partial q_k}{\\partial x_j} \\approx \\frac{q_k(x + h e_j) - q_k(x - h e_j)}{2h}\n$$\n这里，$e_j$ 是 $\\mathbb{R}^9$ 中的一个单位向量，在第 $j$ 个位置为 1，其余位置为零。通过遍历 9 个笛卡尔坐标中的每一个，施加对称扰动，计算四个内坐标的变化，并填充 $4 \\times 9$ B 矩阵的相应列来构建 B 矩阵。\n\n#### 3. 使用 SVD 和 G 矩阵进行冗余分析\n\n内坐标之间的几何冗余导致 B 矩阵的行是线性相关的。这种相关性可以通过 $B$ 的奇异值分解（SVD）来分析，或者等效地，通过分析内坐标度规矩阵 $G$ 的特征系统来分析。\n\n-   **奇异值分解 (SVD)**：B 的 SVD 为 $B = U S V^\\top$。构成 $S$ 对角线的奇异值量化了由 $B$ 表示的线性变换的“拉伸”效应。一个为零（或数值上接近零，即 $s/s_{\\max}  \\tau$）的奇异值表明，在输入（笛卡尔）空间中存在一个方向，该方向被映射到输出（内）空间中的零，这对应于秩亏。B 的秩揭示了独立内坐标的数量。对于非线性的三原子分子，我们期望有三个显著的奇异值和一个接近零的奇异值，后者对应于单一的冗余。\n\n-   **度规矩阵 ($G$)**：矩阵 $G = BB^\\top$ 是一个 $4 \\times 4$ 的对称矩阵。其特征值是 $B$ 的奇异值的平方。因此，$B$ 的一个近零奇异值对应于 $G$ 的一个近零特征值。与 $G$ 的最小特征值相关联的特征向量 $u_{\\min}$ 尤为重要。它满足 $G u_{\\min} = (BB^\\top) u_{\\min} \\approx 0$。这意味着向量 $B^\\top u_{\\min}$ 近似为零，也就是说，由 $u_{\\min}$ 的分量加权的 $B$ 的行（即梯度 $\\nabla_x q_k$）的线性组合为零：\n    $$ \\sum_{k=1}^4 (u_{\\min})_k \\frac{\\partial q_k}{\\partial x_j} \\approx 0 \\quad \\text{for all } j=1, \\dots, 9 $$\n    因此，$u_{\\min}$ 直接描述了代表冗余性的内坐标梯度的线性组合。\n\n#### 4. 算法正则化\n\n为解决冗余问题，必须移除一个坐标。选择要舍弃哪个坐标的一种有原则的方法是，识别出对冗余贡献最大的那个坐标。问题指定了以下规则：\n$$\nj^\\star = \\arg\\max_{j \\in \\{0,1,2,3\\}} |(u_{\\min})_j|\n$$\n此规则识别出在定义冗余的线性组合中，其梯度具有最大系数的坐标索引。该坐标被认为是“依赖性最强”的，是移除的主要候选者。\n\n### 算法实现\n\n该解决方案使用 Python 的 `numpy` 库实现。\n1.  **测试用例**：将四个笛卡尔几何形状定义为 `numpy` 数组。对于测试用例 2、3 和 4，按要求将角度从度转换为弧度。通过应用指定的 $z$ 轴旋转矩阵生成测试用例 2 的坐标。\n2.  **内坐标函数**：创建一个辅助函数 `get_internal_coords(x)`，用于从一个 9 元素的笛卡尔向量 `x` 计算四个内坐标。此函数利用 `numpy` 进行向量运算，如 `linalg.norm`、`cross`、`dot` 和 `arctan2`。\n3.  **主循环**：程序遍历每个测试用例。\n    a.  初始化一个 $4 \\times 9$ 的 B 矩阵。\n    b.  通过一个从 $j=0$ 到 $8$ 的循环，使用步长 $h=10^{-6}$ 的中心差分公式逐列填充该矩阵。\n    c.  在 $B$ 上调用 `numpy.linalg.svd` 以获得奇异值。\n    d.  计算 G 矩阵为 $G = B @ B.T$。\n    e.  使用 `numpy.linalg.eigh` 找到对称矩阵 $G$ 的特征值和特征向量。`eigh` 会方便地按升序返回特征值，因此最小的特征值是第一个元素，其对应的特征向量是返回的特征向量矩阵的第一列。\n    f.  通过对该特征向量 $u_{\\min}$ 的各分量绝对值应用 `numpy.argmax` 来找到舍弃索引 $j^\\star$。\n4.  **输出格式化**：每个测试用例的结果——一个包含四个四舍五入到六位小数的奇异值的列表和一个整数舍弃索引——被格式化为字符串 `[[svals],drop]`。然后将这些字符串聚合到一个最终的、用方括号括起来的逗号分隔列表中，不含空格，以匹配问题规范。测试用例 2 的计算可作为一种验证，因为其奇异值和舍弃索引的结果必须与测试用例 1 相同，因为 B 矩阵对于刚体旋转是不变的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the molecular representation problem for four test cases.\n    Constructs the Wilson B-matrix, computes its singular values,\n    and identifies a redundant internal coordinate to drop.\n    \"\"\"\n\n    # --- Test Case Definitions ---\n    # Case 1: Bent reference geometry\n    rO1 = np.array([0.0, 0.0, 0.0])\n    rH1_1 = np.array([0.9572, 0.0, 0.0])\n    rH2_1 = np.array([-0.2399872, 0.927297, 0.0])\n    case1_coords = np.concatenate([rO1, rH1_1, rH2_1])\n\n    # Case 2: Rigid-body rotation of Case 1\n    phi = np.deg2rad(47)\n    Rz = np.array([\n        [np.cos(phi), -np.sin(phi), 0.0],\n        [np.sin(phi),  np.cos(phi), 0.0],\n        [0.0,          0.0,         1.0]\n    ])\n    rO2 = rO1 @ Rz.T  # Origin is invariant\n    rH1_2 = rH1_1 @ Rz.T\n    rH2_2 = rH2_1 @ Rz.T\n    case2_coords = np.concatenate([rO2, rH1_2, rH2_2])\n\n    # Case 3: Near-linear geometry\n    delta = np.deg2rad(0.1)\n    rO3 = np.array([0.0, 0.0, 0.0])\n    rH1_3 = np.array([1.0, 0.0, 0.0])\n    rH2_3 = np.array([-np.cos(delta), np.sin(delta), 0.0])\n    case3_coords = np.concatenate([rO3, rH1_3, rH2_3])\n\n    # Case 4: Symmetric bent, wide angle\n    angle_120 = np.deg2rad(120)\n    rO4 = np.array([0.0, 0.0, 0.0])\n    rH1_4 = np.array([1.0, 0.0, 0.0])\n    rH2_4 = np.array([np.cos(angle_120), np.sin(angle_120), 0.0])\n    case4_coords = np.concatenate([rO4, rH1_4, rH2_4])\n\n    test_cases = [\n        case1_coords,\n        case2_coords,\n        case3_coords,\n        case4_coords\n    ]\n\n    # --- Constants ---\n    h = 1e-6\n\n    def get_internal_coords(x_cart):\n        \"\"\"\n        Computes the four internal coordinates from a 9-vector of Cartesian coords.\n        x_cart: [rOx, rOy, rOz, rH1x, rH1y, rH1z, rH2x, rH2y, rH2z]\n        Returns: [q1, q2, q3, q4]\n        \"\"\"\n        r_o = x_cart[0:3]\n        r_h1 = x_cart[3:6]\n        r_h2 = x_cart[6:9]\n\n        # q1: bond length r(O,H1)\n        q1 = np.linalg.norm(r_h1 - r_o)\n        \n        # q2: bond length r(O,H2)\n        q2 = np.linalg.norm(r_h2 - r_o)\n        \n        # q3: bond angle angle(H1-O-H2)\n        v1 = r_h1 - r_o\n        v2 = r_h2 - r_o\n        \n        cross_prod_norm = np.linalg.norm(np.cross(v1, v2))\n        dot_prod = np.dot(v1, v2)\n        \n        # Use numerically stable arctan2 for the angle in [0, pi]\n        q3 = np.arctan2(cross_prod_norm, dot_prod)\n        \n        # q4: nonbonded distance r(H1,H2)\n        q4 = np.linalg.norm(r_h1 - r_h2)\n        \n        return np.array([q1, q2, q3, q4])\n\n    # --- Main Calculation Loop ---\n    results_data = []\n    \n    for x_ref in test_cases:\n        # Construct B-matrix using central finite differences\n        B = np.zeros((4, 9))\n        for i in range(9):\n            x_plus = x_ref.copy()\n            x_plus[i] += h\n            x_minus = x_ref.copy()\n            x_minus[i] -= h\n            \n            q_plus = get_internal_coords(x_plus)\n            q_minus = get_internal_coords(x_minus)\n            \n            B[:, i] = (q_plus - q_minus) / (2 * h)\n            \n        # Compute singular values of B\n        _, s, _ = np.linalg.svd(B)\n        \n        # Compute G matrix and its eigensystem\n        G = B @ B.T\n        eigenvalues, eigenvectors = np.linalg.eigh(G)\n        \n        # Eigenvector for the smallest eigenvalue (eigh sorts ascendingly)\n        u_min = eigenvectors[:, 0]\n        \n        # Determine coordinate to drop based on the largest component of u_min\n        j_star = np.argmax(np.abs(u_min))\n        \n        results_data.append((s, j_star))\n\n    # --- Final Output Formatting ---\n    result_strings = []\n    for svals, drop_idx in results_data:\n        svals_str = f\"[{','.join(f'{val:.6f}' for val in svals)}]\"\n        result_strings.append(f\"[{svals_str},{drop_idx}]\")\n\n    final_output_str = f\"[{','.join(result_strings)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}