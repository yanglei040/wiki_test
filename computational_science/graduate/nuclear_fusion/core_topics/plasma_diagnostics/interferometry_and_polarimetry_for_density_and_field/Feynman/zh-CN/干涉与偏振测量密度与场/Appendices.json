{
    "hands_on_practices": [
        {
            "introduction": "在等离子体诊断中，一个核心挑战是如何从充满噪声的背景中提取出清晰的物理信号。我们的第一个实践将探讨外差干涉测量中使用的一项基本技术：相干平均。通过分析对多个拍频周期进行平均如何提高信噪比（$SNR$），你将定量地理解噪声抑制效果，并掌握其与诊断系统解析快速变化的等离子体现象的能力之间固有的权衡关系 。",
            "id": "3704245",
            "problem": "用于核聚变等离子体诊断的微波外差干涉仪通过探测光束与本振信号混频后的相位来测量线积分电子密度，其中本振信号经过失谐以产生频率为 $f_b$ 的拍频。解调后的复信号建模为 $x(t) = \\phi(t) + w(t)$，其中 $\\phi(t)$ 是真实的等离子体相位，而 $w(t)$ 是加性高斯白噪声 (Additive White Gaussian Noise (AWGN))，其均值为零，在连续的拍频周期内统计独立，并在平均区间内是平稳的。为了提高信噪比 (SNR)，数据处理对 $N$ 个连续拍频周期内的解调复数样本进行相干平均，这等效于一个时长为 $T_{\\text{avg}} = N/f_b$ 的矩形移动平均。\n\n假设线平均电子密度在一个缓慢变化的背景上叠加了一个小的正弦波动，使得相位可以写成 $\\phi(t) = \\phi_0 + \\Delta \\phi \\cos(2\\pi f_{\\text{var}} t)$，其波动频率为 $f_{\\text{var}}$。$\\phi(t)$ 的估计量是移动平均的输出 $y(t) = \\frac{1}{T_{\\text{avg}}} \\int_{t - T_{\\text{avg}}}^{t} x(\\tau)\\, d\\tau$。\n\n给定 $f_b = 2.0 \\times 10^{6}$ Hz, $N = 100$, 且 $f_{\\text{var}} = 1.0 \\times 10^{4}$ Hz:\n\n- 在 $w(t)$ 在各拍频周期内独立的假设下，计算相干平均相对于未经平均的估计量所实现的信噪比改善因子（以功率计）。\n- 通过计算平均窗口对频率为 $f_{\\text{var}}$ 的正弦波动所引入的幅度衰减，来量化时间分辨率上的权衡，即计算滤波器在角频率 $\\omega_{\\text{var}} = 2\\pi f_{\\text{var}}$ 处的频率响应的幅值。\n\n将最终答案表示为一个行矩阵，其中包含两个无量纲数，顺序为 [信噪比改善因子, 幅度衰减]。将答案四舍五入到四位有效数字。幅度衰减是一个幅值比（无量纲）。信噪比改善因子是无量纲的。",
            "solution": "这个问题提得很好，并且有科学依据。它要求将信号处理的基本原理应用于等离子体诊断的现实场景中。我们将按顺序解决问题的两个部分。\n\n第一部分：信噪比改善因子\n\n功率信噪比 (SNR) 定义为信号功率与噪声功率之比。改善因子是平均后的信噪比与平均前的信噪比之比。\n设解调信号为 $x(t) = \\phi(t) + w(t)$，其中 $\\phi(t)$ 是期望信号（等离子体相位），而 $w(t)$ 是加性高斯白噪声 (AWGN)。\n\n“未经平均的估计量”可以被看作是在一个拍频周期内采集的带噪信号的单个样本。设该单个样本的噪声分量的方差为 $\\sigma_w^2$。这对应于输入噪声功率 $P_{n, \\text{in}} = \\sigma_w^2$。设信号功率为 $P_{s, \\text{in}}$。输入信噪比为 $SNR_{\\text{in}} = P_{s, \\text{in}} / P_{n, \\text{in}}$。\n\n问题陈述了在 $N$ 个连续的拍频周期上进行相干平均。噪声 $w(t)$ 被指定为“在连续的拍频周期内统计独立”。这使我们能够将 $N$ 个连续样本的噪声分量 $w_1, w_2, \\dots, w_N$ 建模为独立同分布 (i.i.d.) 的随机变量，每个变量的均值为零，方差为 $\\sigma_w^2$。\n\n平均过程计算这 $N$ 个样本的算术平均值。得到的噪声分量是 $w_{\\text{avg}} = \\frac{1}{N} \\sum_{i=1}^{N} w_i$。这个平均后噪声的方差就是输出噪声功率 $P_{n, \\text{out}}$。由于样本的独立性：\n$$P_{n, \\text{out}} = \\text{Var}(w_{\\text{avg}}) = \\text{Var}\\left(\\frac{1}{N} \\sum_{i=1}^{N} w_i\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\text{Var}(w_i) = \\frac{1}{N^2} (N \\sigma_w^2) = \\frac{\\sigma_w^2}{N}$$\n因此，噪声功率降低了 $N$ 倍：\n$$P_{n, \\text{out}} = \\frac{P_{n, \\text{in}}}{N}$$\n“相干平均”意味着与拍频相比变化缓慢的信号分量会相长叠加。对于在平均周期 $T_{\\text{avg}}$ 内近似恒定的信号，平均过程会保持信号的幅度。因此，输出信号功率 $P_{s, \\text{out}}$ 近似等于输入信号功率 $P_{s, \\text{in}}$。\n\n输出信噪比为 $SNR_{\\text{out}} = P_{s, \\text{out}} / P_{n, \\text{out}}$。\n信噪比改善因子 $I_{SNR}$ 为：\n$$I_{SNR} = \\frac{SNR_{\\text{out}}}{SNR_{\\text{in}}} = \\frac{P_{s, \\text{out}}/P_{n, \\text{out}}}{P_{s, \\text{in}}/P_{n, \\text{in}}} = \\left(\\frac{P_{s, \\text{out}}}{P_{s, \\text{in}}}\\right) \\left(\\frac{P_{n, \\text{in}}}{P_{n, \\text{out}}}\\right)$$\n代入功率关系式，我们得到：\n$$I_{SNR} \\approx (1) \\left(\\frac{P_{n, \\text{in}}}{P_{n, \\text{in}}/N}\\right) = N$$\n给定 $N=100$，信噪比改善因子恰好是 $100$。表示为四位有效数字，即为 $100.0$。\n\n第二部分：幅度衰减\n\n估计量被定义为一个移动平均滤波器：\n$$y(t) = \\frac{1}{T_{\\text{avg}}} \\int_{t - T_{\\text{avg}}}^{t} x(\\tau)\\, d\\tau$$\n该操作是输入信号 $x(t)$ 与一个矩形脉冲响应 $h(t)$ 的卷积，其中：\n$$h(t) = \\begin{cases} 1/T_{\\text{avg}}  \\text{if } 0 \\le t \\le T_{\\text{avg}} \\\\ 0  \\text{otherwise} \\end{cases}$$\n正弦分量的幅度衰减由滤波器的频率响应 $H(\\omega) = \\mathcal{F}\\{h(t)\\}$ 在该正弦波频率处的幅值给出。频率响应是脉冲响应的傅里叶变换：\n$$H(\\omega) = \\int_{-\\infty}^{\\infty} h(t) \\exp(-i\\omega t) \\,dt = \\frac{1}{T_{\\text{avg}}} \\int_{0}^{T_{\\text{avg}}} \\exp(-i\\omega t) \\,dt$$\n$$H(\\omega) = \\frac{1}{T_{\\text{avg}}} \\left[ \\frac{\\exp(-i\\omega t)}{-i\\omega} \\right]_{0}^{T_{\\text{avg}}} = \\frac{1}{T_{\\text{avg}}} \\frac{\\exp(-i\\omega T_{\\text{avg}}) - 1}{-i\\omega}$$\n为了求出幅值，我们可以重写这个表达式：\n$$H(\\omega) = \\frac{\\exp(-i\\omega T_{\\text{avg}}/2)}{-i\\omega T_{\\text{avg}}} \\left( \\exp(-i\\omega T_{\\text{avg}}/2) - \\exp(i\\omega T_{\\text{avg}}/2) \\right)$$\n$$H(\\omega) = \\frac{\\exp(-i\\omega T_{\\text{avg}}/2)}{-i\\omega T_{\\text{avg}}} \\left( -2i \\sin(\\omega T_{\\text{avg}}/2) \\right) = \\exp(-i\\omega T_{\\text{avg}}/2) \\frac{\\sin(\\omega T_{\\text{avg}}/2)}{\\omega T_{\\text{avg}}/2}$$\n幅度衰减是这个复函数的幅值：\n$$|H(\\omega)| = \\left| \\exp(-i\\omega T_{\\text{avg}}/2) \\right| \\left| \\frac{\\sin(\\omega T_{\\text{avg}}/2)}{\\omega T_{\\text{avg}}/2} \\right| = \\left| \\frac{\\sin(\\omega T_{\\text{avg}}/2)}{\\omega T_{\\text{avg}}/2} \\right|$$\n这是归一化 sinc 函数的幅值。我们需要在波动的角频率 $\\omega_{\\text{var}} = 2\\pi f_{\\text{var}}$ 处计算它的值。平均时间为 $T_{\\text{avg}} = N/f_b$。\n函数的自变量变为：\n$$\\frac{\\omega_{\\text{var}} T_{\\text{avg}}}{2} = \\frac{(2\\pi f_{\\text{var}})(N/f_b)}{2} = \\frac{\\pi N f_{\\text{var}}}{f_b}$$\n代入给定值：$N = 100$，$f_{\\text{var}} = 1.0 \\times 10^4$ Hz，以及 $f_b = 2.0 \\times 10^6$ Hz。\n$$\\frac{\\pi N f_{\\text{var}}}{f_b} = \\frac{\\pi \\times 100 \\times (1.0 \\times 10^4)}{2.0 \\times 10^6} = \\frac{\\pi \\times 10^2 \\times 10^4}{2 \\times 10^6} = \\frac{\\pi \\times 10^6}{2 \\times 10^6} = \\frac{\\pi}{2}$$\n因此，幅度衰减为：\n$$|H(\\omega_{\\text{var}})| = \\left| \\frac{\\sin(\\pi/2)}{\\pi/2} \\right| = \\frac{1}{\\pi/2} = \\frac{2}{\\pi}$$\n现在，我们计算数值并四舍五入到四位有效数字：\n$$\\frac{2}{\\pi} \\approx 0.63661977...$$\n保留四位有效数字，幅度衰减为 $0.6366$。\n\n最终答案是一个包含信噪比改善因子 ($100.0$) 和幅度衰减 ($0.6366$) 的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n100.0 & 0.6366\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "除了数据后处理，优化诊断系统的物理配置对于实现最佳性能也至关重要。本练习聚焦于一个旋光测量系统，旨在解决一个实际问题：在存在一个消光比有限的非理想偏振片的情况下，如何最大化系统对微小法拉第旋转角 $\\psi$ 的测量灵敏度。你将推导出检偏器的最优放置角度，从而揭示对硬件局限性的审慎理论分析如何直接引导我们设计出更灵敏、更稳健的测量方案 。",
            "id": "3704186",
            "problem": "在磁约束聚变等离子体中，一种偏振法拉第旋转诊断技术使用一束来自光功率为 $P_{0}$、频率为 $\\nu$ 的受激辐射光放大（激光）的线性偏振探测光。该探测光穿过等离子体，并经历一个小的法拉第旋转角 $\\psi$（假设 $|\\psi| \\ll 1$）。旋转后的偏振由一个线性偏振器（检偏器）进行分析，其透射轴相对于进入等离子体前的输入偏振方向设置了角度 $\\theta$。该检偏器是不完美的，其特性由一个有限的消光比 $E \\in (0,1)$ 描述，该消光比定义为与检偏器轴正交的偏振光的透射功率与与之对齐的偏振光的透射功率之比。光电探测器的量子效率为 $\\eta \\in (0,1)$，测量在时间 $T$ 上进行积分。假设测量受光子散粒噪声限制，并忽略其他技术噪声。\n\n从电磁波偏振的基本原理和线性二向衰减器的定义出发，对不完美的检偏器进行建模，并推导出透射光功率作为 $\\psi$ 和 $\\theta$ 的函数。对小角度 $\\psi$ 的测量进行线性化，并使用泊松光子统计，将用于估计 $\\psi$ 的信噪比（SNR）用探测光子数相对于 $\\psi$ 的导数和散粒噪声方差来表示。\n\n然后，对于给定的消光比 $E$，确定使信噪比相对于 $\\theta$ 最大化的检偏器角度 $\\theta$，并以闭合形式计算相应的最大信噪比。将最优检偏器角度以弧度表示，信噪比以无量纲量表示。你的最终答案必须是单个闭合形式的解析表达式或一对这样的表达式。如果同时给出最优角度和相应的信噪比，请将它们一起写成一个单行向量。不需要进行数值计算或四舍五入。",
            "solution": "用户希望我解决一个关于聚变等离子体中偏振法拉第旋转诊断的问题。\n\n### 问题验证\n\n#### 步骤1：提取已知条件\n-   激光的初始光功率：$P_0$。\n-   激光的频率：$\\nu$。\n-   等离子体引起的法拉第旋转角：$\\psi$。\n-   关于旋转角的假设：$|\\psi| \\ll 1$。\n-   检偏器透射轴相对于输入偏振的角度：$\\theta$。\n-   不完美检偏器的消光比：$E \\in (0,1)$，定义为正交偏振的透射功率与对齐偏振的透射功率之比。\n-   光电探测器的量子效率：$\\eta \\in (0,1)$。\n-   测量积分时间：$T$。\n-   主要噪声源：光子散粒噪声。其他技术噪声被忽略。\n\n#### 步骤2：使用提取的已知条件进行验证\n-   **科学上合理**：该问题描述了用于测量等离子体物理学中法拉第旋转的标准偏振测量装置。偏振、偏振器、消光比、光电探测器、散粒噪声以及探测功率与光子计数之间关系的概念都是光学和实验物理学中基本且公认的原理。应用于磁约束聚变等离子体是该诊断技术的主要应用案例。\n-   **问题适定**：该问题是适定的。它提供了推导理论模型和执行所要求的优化所需的所有必要参数（$P_0, \\nu, \\psi, \\theta, E, \\eta, T$）和一个关键假设（$|\\psi| \\ll 1$）。目标明确：推导透射功率，推导信噪比（SNR），找到最优检偏器角度 $\\theta$，并找到相应的最大SNR。\n-   **客观性**：语言精确且技术性强，没有歧义或主观内容。\n-   该问题不违反任何科学原理，与所述主题直接相关，是自洽的，物理上是合理的（不完美的偏振器是现实的），结构良好，并非微不足道，并且是科学上可验证的。\n\n#### 步骤3：结论与行动\n问题有效。将提供完整的解决方案。\n\n### 解答\n\n解答过程分四步进行：\n1.  对不完美的检偏器进行建模，并推导透射光功率的表达式。\n2.  为法拉第角 $\\psi$ 的测量建立信噪比（SNR）的公式。\n3.  确定使该信噪比最大化的最优检偏器角度 $\\theta$。\n4.  计算在最优角度下可实现的最大信噪比。\n\n**1. 透射光功率**\n\n我们使用琼斯矩阵法来描述光的偏振态。设初始的线性偏振光沿x轴偏振。其归一化的琼斯矢量为：\n$$ \\mathbf{J}_{in} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} $$\n等离子体将偏振面旋转一个角度 $\\psi$。这由一个旋转矩阵 $R(\\psi)$ 表示：\n$$ R(\\psi) = \\begin{pmatrix} \\cos\\psi  -\\sin\\psi \\\\ \\sin\\psi  \\cos\\psi \\end{pmatrix} $$\n光穿过等离子体后的琼斯矢量为：\n$$ \\mathbf{J}_{plasma} = R(\\psi) \\mathbf{J}_{in} = \\begin{pmatrix} \\cos\\psi \\\\ \\sin\\psi \\end{pmatrix} $$\n不完美的检偏器是一个线性二向衰减器。其特性由其主轴定义。设透射轴对电场振幅的透射系数为 $1$，正交轴的透射系数为 $\\sqrt{E}$（因为功率与振幅的平方成正比，而消光比 $E$ 是针对功率的）。在其自身坐标系中，其琼斯矩阵为：\n$$ M_{analyzer}' = \\begin{pmatrix} 1  0 \\\\ 0  \\sqrt{E} \\end{pmatrix} $$\n检偏器的透射轴相对于初始偏振方向（x轴）成 $\\theta$ 角。为了在实验室坐标系中找到其琼斯矩阵，我们应用一个旋转变换：\n$$ M_{analyzer}(\\theta) = R(\\theta) M_{analyzer}' R(-\\theta) = R(\\theta) \\begin{pmatrix} 1  0 \\\\ 0  \\sqrt{E} \\end{pmatrix} R(-\\theta) $$\n通过检偏器透射的光的琼斯矢量为：\n$$ \\mathbf{J}_{out} = M_{analyzer}(\\theta) \\mathbf{J}_{plasma} = R(\\theta) \\begin{pmatrix} 1  0 \\\\ 0  \\sqrt{E} \\end{pmatrix} R(-\\theta) \\begin{pmatrix} \\cos\\psi \\\\ \\sin\\psi \\end{pmatrix} $$\n首先，将经过等离子体旋转的矢量旋转到检偏器的坐标系中：\n$$ R(-\\theta) \\mathbf{J}_{plasma} = \\begin{pmatrix} \\cos\\theta  \\sin\\theta \\\\ -\\sin\\theta  \\cos\\theta \\end{pmatrix} \\begin{pmatrix} \\cos\\psi \\\\ \\sin\\psi \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta\\cos\\psi + \\sin\\theta\\sin\\psi \\\\ -\\sin\\theta\\cos\\psi + \\cos\\theta\\sin\\psi \\end{pmatrix} = \\begin{pmatrix} \\cos(\\theta-\\psi) \\\\ -\\sin(\\theta-\\psi) \\end{pmatrix} $$\n现在，应用二向衰减器矩阵：\n$$ \\begin{pmatrix} 1  0 \\\\ 0  \\sqrt{E} \\end{pmatrix} \\begin{pmatrix} \\cos(\\theta-\\psi) \\\\ -\\sin(\\theta-\\psi) \\end{pmatrix} = \\begin{pmatrix} \\cos(\\theta-\\psi) \\\\ -\\sqrt{E}\\sin(\\theta-\\psi) \\end{pmatrix} $$\n最后，旋转回实验室坐标系。然而，总透射功率在旋转下是不变的，所以我们可以直接从检偏器坐标系中的矢量计算它。透射功率分数是该矢量的模的平方：\n$$ \\frac{P_T}{P_0} = |\\cos(\\theta-\\psi)|^2 + |-\\sqrt{E}\\sin(\\theta-\\psi)|^2 = \\cos^2(\\theta-\\psi) + E \\sin^2(\\theta-\\psi) $$\n透射功率 $P_T$ 作为 $\\psi$ 和 $\\theta$ 的函数是：\n$$ P_T(\\psi, \\theta) = P_0 \\left( \\cos^2(\\theta-\\psi) + E \\sin^2(\\theta-\\psi) \\right) $$\n\n**2. 信噪比 (SNR)**\n\n单个光子的能量是 $h\\nu$。在积分时间 $T$ 内探测到的光子数量为：\n$$ N(\\psi, \\theta) = \\frac{\\eta P_T(\\psi, \\theta) T}{h\\nu} = \\frac{\\eta P_0 T}{h\\nu} \\left( \\cos^2(\\theta-\\psi) + E \\sin^2(\\theta-\\psi) \\right) $$\n法拉第角 $\\psi$ 是从测量的光子数 $N_{meas}$ 推断出来的。信号是由 $\\psi$ 引起的光子数变化。对于小角度 $\\psi$，信号为 $\\Delta N \\approx \\frac{\\partial N}{\\partial \\psi}\\psi$。测量的灵敏度是光子数相对于角度 $\\psi$ 的导数：\n$$ \\frac{\\partial N}{\\partial\\psi} = \\frac{\\eta P_0 T}{h\\nu} \\frac{\\partial}{\\partial\\psi} \\left( \\cos^2(\\theta-\\psi) + E \\sin^2(\\theta-\\psi) \\right) $$\n$$ \\frac{\\partial N}{\\partial\\psi} = \\frac{\\eta P_0 T}{h\\nu} \\left( -2\\cos(\\theta-\\psi)\\sin(\\theta-\\psi)(-1) + 2E\\sin(\\theta-\\psi)\\cos(\\theta-\\psi)(-1) \\right) $$\n$$ \\frac{\\partial N}{\\partial\\psi} = \\frac{\\eta P_0 T}{h\\nu} \\left( \\sin(2(\\theta-\\psi)) - E\\sin(2(\\theta-\\psi)) \\right) = \\frac{\\eta P_0 T}{h\\nu} (1-E) \\sin(2(\\theta-\\psi)) $$\n对于小角度测量，我们在 $\\psi=0$ 处评估灵敏度：\n$$ \\left.\\frac{\\partial N}{\\partial\\psi}\\right|_{\\psi=0} = \\frac{\\eta P_0 T}{h\\nu} (1-E) \\sin(2\\theta) $$\n测量受光子散粒噪声的限制，该噪声遵循泊松统计。噪声是探测到的光子数的标准差，$\\sigma_N = \\sqrt{\\langle N \\rangle}$。对于小信号，噪声主要由背景光子决定，即在 $\\psi=0$ 处。\n$$ N(0, \\theta) = \\frac{\\eta P_0 T}{h\\nu} \\left( \\cos^2\\theta + E \\sin^2\\theta \\right) $$\n噪声为 $\\sigma_N \\approx \\sqrt{N(0, \\theta)}$。\n确定 $\\psi$ 的不确定度由 $\\sigma_\\psi = \\frac{\\sigma_N}{|\\partial N / \\partial \\psi|}$ 给出。$\\psi$ 的测量的信噪比定义为 $\\text{SNR}_\\psi = \\frac{|\\psi|}{\\sigma_\\psi}$。代入表达式：\n$$ \\text{SNR}_\\psi = \\frac{|\\psi| |\\partial N / \\partial \\psi|_{\\psi=0}}{\\sqrt{N(0)}} $$\n为了优化测量系统，我们必须最大化乘以 $|\\psi|$ 的因子，我们将其表示为 $\\mathcal{F}(\\theta)$：\n$$ \\mathcal{F}(\\theta) = \\frac{|\\partial N / \\partial \\psi|_{\\psi=0}}{\\sqrt{N(0)}} = \\frac{\\frac{\\eta P_0 T}{h\\nu} |(1-E) \\sin(2\\theta)|}{\\sqrt{\\frac{\\eta P_0 T}{h\\nu} \\left( \\cos^2\\theta + E \\sin^2\\theta \\right)}} = \\sqrt{\\frac{\\eta P_0 T}{h\\nu}} \\frac{(1-E) |\\sin(2\\theta)|}{\\sqrt{\\cos^2\\theta + E \\sin^2\\theta}} $$\n其中我们使用 $E \\in (0,1)$，所以 $1-E > 0$。我们寻求最大化依赖于 $\\theta$ 的部分。\n\n**3. 最优检偏器角度**\n\n让我们优化函数 $f(\\theta) = \\frac{|\\sin(2\\theta)|}{\\sqrt{\\cos^2\\theta + E \\sin^2\\theta}}$。我们可以处理 $f(\\theta)^2$ 并且不失一般性地考虑 $\\theta \\in [0, \\pi/2]$，因此 $\\sin(2\\theta) \\ge 0$。\n$$ g(\\theta) = f(\\theta)^2 = \\frac{\\sin^2(2\\theta)}{\\cos^2\\theta + E \\sin^2\\theta} = \\frac{4\\sin^2\\theta\\cos^2\\theta}{\\cos^2\\theta + E \\sin^2\\theta} $$\n令 $u = \\cos^2\\theta$。则 $\\sin^2\\theta = 1-u$。函数变为：\n$$ h(u) = \\frac{4u(1-u)}{u + E(1-u)} = \\frac{4(u-u^2)}{u(1-E)+E} \\quad \\text{for } u \\in [0,1] $$\n为了找到最大值，我们将关于 $u$ 的导数设为零：\n$$ \\frac{dh}{du} = 4 \\frac{(1-2u)(u(1-E)+E) - (u-u^2)(1-E)}{(u(1-E)+E)^2} = 0 $$\n分子必须为零：\n$$ (1-2u)(u(1-E)+E) - (u-u^2)(1-E) = 0 $$\n$$ u(1-E) + E - 2u^2(1-E) - 2uE - u(1-E) + u^2(1-E) = 0 $$\n$$ E - u^2(1-E) - 2uE = 0 $$\n$$ (1-E)u^2 + 2Eu - E = 0 $$\n这是一个关于 $u = \\cos^2\\theta$ 的二次方程。解是：\n$$ u = \\frac{-2E \\pm \\sqrt{(2E)^2 - 4(1-E)(-E)}}{2(1-E)} = \\frac{-2E \\pm \\sqrt{4E^2 + 4E - 4E^2}}{2(1-E)} = \\frac{-E \\pm \\sqrt{E}}{1-E} $$\n由于 $u = \\cos^2\\theta$ 必须为正，我们取“+”号：\n$$ u_{opt} = \\frac{-E + \\sqrt{E}}{1-E} = \\frac{\\sqrt{E}(1-\\sqrt{E})}{(1-\\sqrt{E})(1+\\sqrt{E})} = \\frac{\\sqrt{E}}{1+\\sqrt{E}} $$\n对于 $E \\in (0,1)$，该值在 $0$ 和 $1$ 之间，因此它是一个有效的解。这对应于最优角度 $\\theta_{opt}$。\n我们有 $\\cos^2\\theta_{opt} = \\frac{\\sqrt{E}}{1+\\sqrt{E}}$ 和 $\\sin^2\\theta_{opt} = 1 - u_{opt} = \\frac{1}{1+\\sqrt{E}}$。\n因此，$\\tan^2\\theta_{opt} = \\frac{\\sin^2\\theta_{opt}}{\\cos^2\\theta_{opt}} = \\frac{1}{\\sqrt{E}}$。\n对于 $\\theta \\in [0, \\pi/2]$，取正根，我们得到 $\\tan\\theta_{opt} = E^{-1/4}$。\n最优检偏器角度是：\n$$ \\theta_{opt} = \\arctan(E^{-1/4}) $$\n\n**4. 最大信噪比**\n\n现在我们通过将 $u_{opt}$ 代入 $h(u) = f(\\theta)^2$ 的表达式来计算 $\\mathcal{F}(\\theta)$ 的最大值：\n$$ f(\\theta_{opt})^2 = \\frac{4 u_{opt}(1-u_{opt})}{u_{opt}(1-E)+E} $$\n分子是 $4 \\left( \\frac{\\sqrt{E}}{1+\\sqrt{E}} \\right) \\left( \\frac{1}{1+\\sqrt{E}} \\right) = \\frac{4\\sqrt{E}}{(1+\\sqrt{E})^2}$。\n分母是 $\\left(\\frac{\\sqrt{E}}{1+\\sqrt{E}}\\right)(1-E) + E = \\frac{\\sqrt{E}(1-\\sqrt{E})(1+\\sqrt{E})}{1+\\sqrt{E}} + E = \\sqrt{E}(1-\\sqrt{E}) + E = \\sqrt{E}-E+E = \\sqrt{E}$。\n所以，$f(\\theta_{opt})^2 = \\frac{4\\sqrt{E}}{(1+\\sqrt{E})^2} \\frac{1}{\\sqrt{E}} = \\frac{4}{(1+\\sqrt{E})^2}$。\n取平方根，得到 $f(\\theta_{opt}) = \\frac{2}{1+\\sqrt{E}}$。\n最大信噪比因子 $\\mathcal{F}_{max}$ 是：\n$$ \\mathcal{F}_{max} = \\sqrt{\\frac{\\eta P_0 T}{h\\nu}} \\times (1-E) f(\\theta_{opt}) = \\sqrt{\\frac{\\eta P_0 T}{h\\nu}} (1-E) \\frac{2}{1+\\sqrt{E}} $$\n使用恒等式 $1-E = (1-\\sqrt{E})(1+\\sqrt{E})$：\n$$ \\mathcal{F}_{max} = \\sqrt{\\frac{\\eta P_0 T}{h\\nu}} \\frac{2(1-\\sqrt{E})(1+\\sqrt{E})}{1+\\sqrt{E}} = 2(1-\\sqrt{E})\\sqrt{\\frac{\\eta P_0 T}{h\\nu}} $$\n因此，用于估计角度 $\\psi$ 的相应最大信噪比为：\n$$ \\text{SNR}_{max} = |\\psi| \\mathcal{F}_{max} = 2|\\psi|(1-\\sqrt{E})\\sqrt{\\frac{\\eta P_0 T}{h\\nu}} $$\n按照惯例，我们可以省略 $\\psi$ 上的绝对值，因为它只是一个缩放因子。\n最终答案是最优角度 $\\theta_{opt}$ 和相应的最大信噪比。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\arctan(E^{-1/4}) & 2\\psi(1-\\sqrt{E})\\sqrt{\\frac{\\eta P_0 T}{h\\nu}} \\end{pmatrix} } $$"
        },
        {
            "introduction": "许多诊断技术提供的是沿某条弦路径的线积分数据，但我们的最终目标通常是理解等离子体局域的、具有空间分布的物理性质。这最后一个实践将介绍强大的层析成像反演技术，它能从一组弦测量数据 $y$ 重建出二维等离子体剖面 $x$。你将把这个问题构建为线性模型 $A x \\approx y$，并推导吉洪诺夫正则化（Tikhonov regularization）最小二乘拟合的解，这是一种在等离子体物理中广泛用于解决不适定反问题的稳健方法 。",
            "id": "3704205",
            "problem": "您的任务是为通过干涉测量法和旋光测量法测量的非轴对称等离子体可观测量，构建并实现一种离散化的层析成像反演方法。从基本物理关系和等离子体视线诊断的核心定义出发，推导在使用Tikhonov正则化时，最小二乘最小化器必须满足的条件。然后，实现得到的正规方程，以从合成的多弦数据中恢复体素化场。所有量都必须使用国际单位制（SI）。\n\n本问题建立在以下广为接受的基本事实之上：\n- 对于穿越磁化等离子体的电磁波，其中电子数密度为 $n_e(\\mathbf{r})$，磁场为 $\\mathbf{B}(\\mathbf{r})$，沿某条弦的干涉相移（在长波极限下）可以很好地近似为 $n_e$ 的线积分乘以一个已知的比例常数。我们将该常数吸收到一个缩放因子中，从而得到单位为 $\\mathrm{m}^{-2}$ 的有效线积分电子柱密度。\n- 沿某条弦的偏振法拉第旋转（以弧度为单位）可以很好地近似为（同样在长波极限下）乘积 $n_e B_{\\parallel}$ 的线积分乘以一个已知的比例常数。我们将该常数吸收到一个缩放因子中，从而得到单位为 $\\mathrm{T}\\cdot\\mathrm{m}^{-2}$ 的有效线积分 $n_e B_{\\parallel}$。角度使用弧度。\n\n将二维横截面离散化为具有分段常数未知量的矩形体素。对于每条弦 $m$，测量值被建模为体素值的加权和，权重等于每条弦在每个体素中的路径长度，从而产生线性模型 $A x \\approx y$，其中：\n- $A \\in \\mathbb{R}^{M \\times N}$ 是路径长度（单位为 $\\mathrm{m}$）的几何矩阵，\n- $x \\in \\mathbb{R}^{N}$ 是未知体素值的向量（$n_e$ 的单位为 $\\mathrm{m}^{-3}$ 或 $n_e B_{\\parallel}$ 的单位为 $\\mathrm{T}\\cdot\\mathrm{m}^{-3}$），\n- $y \\in \\mathbb{R}^{M}$ 是有效线积分测量值的向量（单位为 $\\mathrm{m}^{-2}$ 或 $\\mathrm{T}\\cdot\\mathrm{m}^{-2}$）。\n\n为了在非轴对称和可能欠定的几何构型下稳定反演过程，使用带有算子 $L \\in \\mathbb{R}^{P \\times N}$（例如，用于促进平滑度的一阶有限差分，或用于岭回归的单位矩阵）和先验 $x_0 \\in \\mathbb{R}^{N}$ 的Tikhonov正则化。\n\n任务1（推导）：\n- 从最小二乘优化的第一性原理出发，不使用任何快捷公式，推导在最小化由数据失配和对 $L(x - x_0)$ 在欧几里得范数下的二次惩罚构成的目标函数时，Tikhonov正则化问题的最小化器必须满足的正规方程。清晰地陈述所有假设并展示每个逻辑步骤。\n\n任务2（实现）：\n- 针对下述每个测试用例，编写一个程序，构建矩阵和向量，求解推导出的正规方程以获得 $x$，并输出恢复的体素值。您的求解器必须能处理通用的矩形 $L$ 和通用的 $A$，并且除了指定的库之外，不得依赖任何外部库。\n- 以 $\\mathrm{m}^{-3}$ 表示恢复的电子密度，以 $\\mathrm{T}\\cdot\\mathrm{m}^{-3}$ 表示恢复的 $n_e B_{\\parallel}$。\n- 对于所有输出，数字应四舍五入至三位有效数字。\n- 角度（在涉及底层物理时）必须以弧度处理。\n\n测试套件：\n所有矩阵和向量都已明确给出；每个数字均以SI单位提供。每个测试用例都指定了几何矩阵 $A$、正则化算子 $L$、正则化强度 $\\lambda$（单位为 $\\mathrm{m}$）、先验 $x_0$（在所有情况下均为零）和测量向量 $y$。\n\n测试用例1和2中，$3\\times 3$ 网格的体素排序索引约定为行主序：\n$\n\\begin{bmatrix}\n0 & 1 & 2 \\\\\n3 & 4 & 5 \\\\\n6 & 7 & 8\n\\end{bmatrix}\n$，\n测试用例3和4中，$2\\times 2$ 网格的体素排序索引约定为行主序：\n$\n\\begin{bmatrix}\n0 & 1 \\\\\n2 & 3\n\\end{bmatrix}\n$。\n\n- 测试用例1（干涉测量，非轴对称，平滑度正则化）：\n  - 几何矩阵 $A \\in \\mathbb{R}^{6 \\times 9}$，行代表弦：\n    1. 中间水平弦穿过体素 $[3,4,5]$，长度为 $[0.01,0.01,0.01]$ $\\mathrm{m}$。\n    2. 右侧垂直弦穿过体素 $[2,5,8]$，长度为 $[0.01,0.01,0.01]$ $\\mathrm{m}$。\n    3. 左上到右下对角弦穿过体素 $[0,4,8]$，长度为 $[0.01414,0.01414,0.01414]$ $\\mathrm{m}$。\n    4. 右上到左下对角弦穿过体素 $[2,4,6]$，长度为 $[0.01414,0.01414,0.01414]$ $\\mathrm{m}$。\n    5. 顶部水平弦穿过体素 $[0,1,2]$，长度为 $[0.01,0.01,0.01]$ $\\mathrm{m}$。\n    6. 中间垂直弦穿过体素 $[1,4,7]$，长度为 $[0.01,0.01,0.01]$ $\\mathrm{m}$。\n    明确地：\n    $\n    A = \\begin{bmatrix}\n    0 & 0 & 0 & 0.01 & 0.01 & 0.01 & 0 & 0 & 0 \\\\\n    0 & 0 & 0.01 & 0 & 0 & 0.01 & 0 & 0 & 0.01 \\\\\n    0.01414 & 0 & 0 & 0 & 0.01414 & 0 & 0 & 0 & 0.01414 \\\\\n    0 & 0 & 0.01414 & 0 & 0.01414 & 0 & 0.01414 & 0 & 0 \\\\\n    0.01 & 0.01 & 0.01 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n    0 & 0.01 & 0 & 0 & 0.01 & 0 & 0.01 & 0 & 0\n    \\end{bmatrix}。\n    $\n  - 正则化算子 $L \\in \\mathbb{R}^{12 \\times 9}$ 为 $3\\times 3$ 网格上的一阶差分，行向量如下：\n    水平差分：\n    $\n    [1,-1,0,0,0,0,0,0,0],\\ [0,1,-1,0,0,0,0,0,0],\\\n    [0,0,0,1,-1,0,0,0,0],\\ [0,0,0,0,1,-1,0,0,0],\\\n    [0,0,0,0,0,0,1,-1,0],\\ [0,0,0,0,0,0,0,1,-1]\n    $，\n    垂直差分：\n    $\n    [1,0,0,-1,0,0,0,0,0],\\ [0,1,0,0,-1,0,0,0,0],\\\n    [0,0,1,0,0,-1,0,0,0],\\ [0,0,0,1,0,0,-1,0,0],\\\n    [0,0,0,0,1,0,0,-1,0],\\ [0,0,0,0,0,1,0,0,-1].\n    $\n  - 正则化强度 $\\lambda = 0.02$ $\\mathrm{m}$，先验 $x_0 = \\mathbf{0}$。\n  - 测量向量 $y$（单位为 $\\mathrm{m}^{-2}$）：\n    $\n    y = [4.5\\times 10^{17},\\ 2.5\\times 10^{17},\\ 5.656\\times 10^{17},\\ 6.0802\\times 10^{17},\\ 3.2\\times 10^{17},\\ 4.8\\times 10^{17}].\n    $\n\n  恢复的 $x$ 必须以 $\\mathrm{m}^{-3}$ 为单位。\n\n- 测试用例2（旋光测量，非轴对称，单位矩阵正则化）：\n  - 几何矩阵 $A \\in \\mathbb{R}^{6 \\times 9}$ 与测试用例1相同。\n  - 正则化算子 $L = I_{9}$ (单位矩阵)，$\\lambda = 0.03$ $\\mathrm{m}$，先验 $x_0 = \\mathbf{0}$。\n  - 测量向量 $y$ 为有效线积分 $n_e B_{\\parallel}$（单位为 $\\mathrm{T}\\cdot\\mathrm{m}^{-2}$）：\n    $\n    y = [7.5\\times 10^{17},\\ 5.2\\times 10^{17},\\ 1.15948\\times 10^{18},\\ 9.898\\times 10^{17},\\ 6.5\\times 10^{17},\\ 8.5\\times 10^{17}].\n    $\n  恢复的 $x$ 必须为 $n_e B_{\\parallel}$，单位为 $\\mathrm{T}\\cdot\\mathrm{m}^{-3}$。\n\n- 测试用例3（干涉测量，欠定 $2\\times 2$ 网格，单位矩阵正则化）：\n  - 几何矩阵 $A \\in \\mathbb{R}^{3 \\times 4}$：\n    $\n    A = \\begin{bmatrix}\n    0.01 & 0.01 & 0 & 0 \\\\\n    0.01 & 0 & 0.01 & 0 \\\\\n    0.01414 & 0 & 0 & 0.01414\n    \\end{bmatrix}.\n    $\n  - 正则化算子 $L = I_{4}$，$\\lambda = 0.005$ $\\mathrm{m}$，先验 $x_0 = \\mathbf{0}$。\n  - 测量向量 $y$（单位为 $\\mathrm{m}^{-2}$）：\n    $\n    y = [2.7\\times 10^{17},\\ 3.2\\times 10^{17},\\ 3.535\\times 10^{17}].\n    $\n  恢复的 $x$ 必须以 $\\mathrm{m}^{-3}$ 为单位。\n\n- 测试用例4（干涉测量，与测试用例3相同但使用强正则化）：\n  - 几何矩阵 $A$ 和算子 $L$ 与测试用例3相同。\n  - $\\lambda = 1.0$ $\\mathrm{m}$，先验 $x_0 = \\mathbf{0}$。\n  - 测量向量 $y$ 与测试用例3相同。\n  恢复的 $x$ 必须以 $\\mathrm{m}^{-3}$ 为单位。\n\n输出规范：\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，其本身是一个逗号分隔的列表，包含恢复的体素值，四舍五入到三位有效数字并以科学记数法格式化。输出中不得包含任何空格。例如：$[ [\\dots], [\\dots], [\\dots], [\\dots] ]$，但无空格：\"[[case1_values],[case2_values],[case3_values],[case4_values]]\"。",
            "solution": "该问题要求推导并实现一个Tikhonov正则化线性反演问题的解法，这是等离子体物理中层析成像重建的标准方法。整个过程分为两个任务：首先，从第一性原理推导正规方程；其次，根据提供的测试用例实现一个数值求解器来求解这些方程。\n\n### 任务1：正规方程的推导\n\n问题是要求解一个体素值向量 $x \\in \\mathbb{R}^{N}$，该向量能最好地表示等离子体的状态，给定一组线积分测量值 $y \\in \\mathbb{R}^{M}$。未知数与测量值之间的关系由线性系统 $Ax \\approx y$ 建模，其中 $A \\in \\mathbb{R}^{M \\times N}$ 是几何矩阵，包含测量弦穿过每个体素的路径长度。\n\n由于许多层析成像问题具有不适定性（例如，问题是欠定的或矩阵 $A$ 是病态的），我们引入Tikhonov正则化来稳定解。目标是找到一个向量 $x$，使其最小化一个复合目标函数 $J(x)$，该函数包括数据保真项和正则化项。\n\n目标函数 $J(x)$ 定义为数据失配的欧几里得范数平方与正则化项的欧几里得范数平方之和：\n$$ J(x) = \\|Ax - y\\|_2^2 + \\alpha \\|L(x - x_0)\\|_2^2 $$\n在这里，$L \\in \\mathbb{R}^{P \\times N}$ 是正则化算子，$x_0 \\in \\mathbb{R}^{N}$ 是解的先验估计，$\\alpha$ 是一个标量正则化参数，用于平衡这两项。\n\n问题指定了一个正则化强度 $\\lambda$，其单位为长度（米，$\\mathrm{m}$）。为了确保目标函数中的量纲一致性，我们必须恰当地设置参数 $\\alpha$。让我们分析一下干涉测量情况下的单位：\n- 测量向量 $y$ 的单位是 $\\mathrm{m}^{-2}$。因此，数据失配项 $\\|Ax - y\\|_2^2$ 的单位是 $(\\mathrm{m}^{-2})^2 = \\mathrm{m}^{-4}$。\n- 未知向量 $x$ 的单位是 $\\mathrm{m}^{-3}$。如果正则化算子 $L$ 是无量纲的（如单位矩阵或有限差分算子），则正则化项 $\\|L(x - x_0)\\|_2^2$ 的单位是 $(\\mathrm{m}^{-3})^2 = \\mathrm{m}^{-6}$。\n\n为了使这两项可以相加，$\\alpha$ 的单位必须是 $\\mathrm{m}^2$。给定 $\\lambda$ 的单位是米，一个自然且常见的选择是 $\\alpha = \\lambda^2$。因此，目标函数是：\n$$ J(x) = \\|Ax - y\\|_2^2 + \\lambda^2 \\|L(x - x_0)\\|_2^2 $$\n\n为了找到使此函数最小化的向量 $x$，我们必须找到 $J(x)$ 相对于 $x$ 的梯度为零向量的位置。首先，我们使用转置表示法将范数的平方表示为点积，其中对于向量 $v$，$\\|v\\|_2^2 = v^T v$：\n$$ J(x) = (Ax - y)^T(Ax - y) + \\lambda^2 (L(x - x_0))^T(L(x - x_0)) $$\n\n展开这些项：\n$$ J(x) = (x^T A^T - y^T)(Ax - y) + \\lambda^2 (x - x_0)^T L^T L (x - x_0) $$\n$$ J(x) = (x^T A^T Ax - x^T A^T y - y^T A x + y^T y) + \\lambda^2 [x^T (L^T L) x - x^T L^T L x_0 - x_0^T L^T L x + x_0^T L^T L x_0] $$\n\n注意到标量项 $y^T A x$ 和 $x_0^T L^T L x$ 分别等于它们的转置 $x^T A^T y$ 和 $x^T L^T L x_0$，我们可以简化表达式：\n$$ J(x) = x^T (A^T A) x - 2 y^T A x + y^T y + \\lambda^2 [x^T (L^T L) x - 2 x_0^T L^T L x + x_0^T L^T L x_0] $$\n\n现在，我们使用标准的矩阵微积分恒等式计算梯度 $\\nabla_x J(x) = \\frac{\\partial J(x)}{\\partial x}$：$\\frac{\\partial}{\\partial x} (c^T x) = c$ 和 $\\frac{\\partial}{\\partial x} (x^T M x) = (M + M^T)x$。由于 $A^T A$ 和 $L^T L$ 都是对称矩阵，二次项的导数分别简化为 $2(A^T A)x$ 和 $2(L^T L)x$。\n\n对 $J(x)$ 中的每一项关于 $x$ 求导：\n- $\\frac{\\partial}{\\partial x} (x^T (A^T A) x) = 2(A^T A)x$\n- $\\frac{\\partial}{\\partial x} (-2 y^T A x) = -2 A^T y$\n- $\\frac{\\partial}{\\partial x} (y^T y) = 0$ (相对于 $x$ 是常数)\n- $\\frac{\\partial}{\\partial x} (\\lambda^2 x^T (L^T L) x) = 2 \\lambda^2 (L^T L)x$\n- $\\frac{\\partial}{\\partial x} (-2 \\lambda^2 x_0^T L^T L x) = -2 \\lambda^2 (L^T L)x_0$\n- $\\frac{\\partial}{\\partial x} (\\lambda^2 x_0^T L^T L x_0) = 0$ (相对于 $x$ 是常数)\n\n将这些导数相加得到 $J(x)$ 的梯度：\n$$ \\nabla_x J(x) = 2(A^T A)x - 2 A^T y + 2 \\lambda^2 (L^T L)x - 2 \\lambda^2 (L^T L)x_0 $$\n\n我们通过将其梯度设为零向量来找到 $J(x)$ 的最小值：\n$$ 2(A^T A)x - 2 A^T y + 2 \\lambda^2 (L^T L)x - 2 \\lambda^2 (L^T L)x_0 = \\mathbf{0} $$\n\n两边除以 $2$ 并重新整理各项以分离 $x$：\n$$ (A^T A)x + \\lambda^2 (L^T L)x = A^T y + \\lambda^2 (L^T L)x_0 $$\n$$ (A^T A + \\lambda^2 L^T L)x = A^T y + \\lambda^2 L^T L x_0 $$\n\n这是Tikhonov正则化的正规方程的一般形式。对于本问题中的具体情况，先验被设定为 $x_0 = \\mathbf{0}$。这简化了方程的右侧：\n$$ (A^T A + \\lambda^2 L^T L)x = A^T y $$\n\n这是一个形如 $M_{sys} x = b_{sys}$ 的线性系统，其中系统矩阵 $M_{sys} = A^T A + \\lambda^2 L^T L$，右侧向量 $b_{sys} = A^T y$。解 $x$ 可以通过标准的线性代数求解器找到。只要 $A$ 和 $L$ 的零空间没有非平凡的交集，对于 $\\lambda > 0$，矩阵 $M_{sys}$ 保证是可逆的，这个问题中使用的正则化算子满足这一条件。\n\n### 任务2：实现\n\n实现直接遵循推导出的正规方程。对于每个测试用例，一个Python脚本执行以下步骤：\n1.  根据问题陈述中的逐字数据，使用`numpy`数组定义矩阵 $A$ 和 $L$、测量向量 $y$、先验向量 $x_0$ 以及正则化参数 $\\lambda$。\n2.  构建系统矩阵 $M_{sys} = A^T A + \\lambda^2 L^T L$。使用`numpy`的`.T`属性和`@`运算符执行矩阵转置和乘法。\n3.  构建右侧向量 $b_{sys} = A^T y$（因为所有测试用例中 $x_0=\\mathbf{0}$）。\n4.  使用函数`np.linalg.solve()`求解线性系统 $M_{sys} x = b_{sys}$ 以获得未知向量 $x$。\n5.  将得到的解向量 $x$ 的元素格式化为科学记数法字符串，保留三位有效数字（例如 `1.23e+19`）。\n6.  将所有测试用例的格式化字符串连接成一个符合指定格式 `[[case1_results],[case2_results],...]` 且不含空格的单行输出。",
            "answer": "```\n[[1.25e+19,1.42e+19,5.29e+18,1.60e+19,1.65e+19,1.25e+19,1.87e+19,1.55e+19,9.45e+18],[2.50e+19,2.83e+19,1.17e+19,2.50e+19,3.17e+19,2.50e+19,2.50e+19,2.50e+19,1.67e+19],[1.50e+19,1.19e+19,1.69e+19,1.00e+19],[2.12e+15,1.35e+15,1.60e+15,2.50e+15]]\n```"
        }
    ]
}