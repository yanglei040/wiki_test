{
    "hands_on_practices": [
        {
            "introduction": "The ability to measure plasma temperature using Electron Cyclotron Emission (ECE) hinges on a fundamental principle: the frequency of the emitted radiation is directly tied to the local magnetic field strength. This first exercise takes you back to the basics, starting from the Lorentz force, to derive the electron cyclotron frequency from first principles. By calculating this frequency for a typical tokamak magnetic field, you will ground your understanding of the ECE diagnostic in the core physics of charged particle motion and establish the relevant electromagnetic spectrum for this powerful measurement technique. ",
            "id": "3697423",
            "problem": "An axisymmetric tokamak operates at an on-axis toroidal magnetic field magnitude of $B = 5\\,\\mathrm{T}$. In Electron Cyclotron Emission (ECE) thermography, optically emitted radiation from gyrating electrons is observed at integer harmonics of the electron cyclotron motion. Starting from the Lorentz force law and the non-relativistic equation of motion for an electron in a uniform magnetic field, derive the non-relativistic electron cyclotron angular frequency and use it to determine the emission frequency at the second harmonic, denoted $f_{2}$. Assume the non-relativistic limit is adequate for thermal electrons in fusion plasmas where $T_{e} \\ll m_{e}c^{2}$. Use the following constants: elementary charge $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$ and electron mass $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$. \n\nCompute the numerical value of $f_{2}$ for $B = 5\\,\\mathrm{T}$. Express your final frequency in gigahertz and round your answer to four significant figures. Then, briefly comment on whether this frequency lies within the millimeter-wave band and on its suitability for ECE-based millimeter-wave diagnostics in tokamaks, considering typical propagation and instrumentation realities. Your final answer must be a single number.",
            "solution": "The problem statement is evaluated to be valid as it is scientifically grounded, well-posed, and objective. It provides a standard physics problem based on fundamental principles of electromagnetism and plasma physics, with all necessary data for a unique solution.\n\nWe begin the derivation from the Lorentz force law, which describes the force $\\mathbf{F}$ on a charged particle moving with velocity $\\mathbf{v}$ in the presence of an electric field $\\mathbf{E}$ and a magnetic field $\\mathbf{B}$. For an electron with charge $q = -e$, this is given by:\n$$ \\mathbf{F} = -e(\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B}) $$\nThe electron's motion is governed by Newton's second law, $\\mathbf{F} = m_e \\mathbf{a} = m_e \\frac{d\\mathbf{v}}{dt}$, where $m_e$ is the electron mass and $\\mathbf{a}$ is its acceleration.\n\nIn the case of a uniform magnetic field $\\mathbf{B}$ and in the absence of an electric field ($\\mathbf{E} = \\mathbf{0}$), the equation of motion for the electron becomes:\n$$ m_e \\frac{d\\mathbf{v}}{dt} = -e(\\mathbf{v} \\times \\mathbf{B}) $$\nFor simplicity, let us align the magnetic field with the $z$-axis, such that $\\mathbf{B} = B\\hat{\\mathbf{z}}$. The velocity vector is $\\mathbf{v} = v_x\\hat{\\mathbf{x}} + v_y\\hat{\\mathbf{y}} + v_z\\hat{\\mathbf{z}}$. The cross product $\\mathbf{v} \\times \\mathbf{B}$ is then:\n$$ \\mathbf{v} \\times \\mathbf{B} = (v_x\\hat{\\mathbf{x}} + v_y\\hat{\\mathbf{y}} + v_z\\hat{\\mathbf{z}}) \\times (B\\hat{\\mathbf{z}}) = B(v_y\\hat{\\mathbf{x}} - v_x\\hat{\\mathbf{y}}) $$\nSubstituting this into the equation of motion and resolving into Cartesian components yields:\n\\begin{align*} m_e \\frac{dv_x}{dt} &= -eBv_y \\\\ m_e \\frac{dv_y}{dt} &= eBv_x \\\\ m_e \\frac{dv_z}{dt} &= 0 \\end{align*}\nThe third equation implies that the velocity component parallel to the magnetic field, $v_z$, is constant. The motion along the magnetic field is un-accelerated.\n\nThe first two equations describe the motion in the plane perpendicular to the magnetic field. They form a system of coupled first-order linear differential equations. We can decouple them by differentiating the first equation with respect to time:\n$$ m_e \\frac{d^2v_x}{dt^2} = -eB\\frac{dv_y}{dt} $$\nSubstituting the expression for $\\frac{dv_y}{dt}$ from the second equation gives:\n$$ m_e \\frac{d^2v_x}{dt^2} = -eB \\left(\\frac{eBv_x}{m_e}\\right) = -\\frac{(eB)^2}{m_e}v_x $$\nRearranging this equation, we obtain the standard form of a simple harmonic oscillator equation:\n$$ \\frac{d^2v_x}{dt^2} + \\left(\\frac{eB}{m_e}\\right)^2 v_x = 0 $$\nThe angular frequency of this oscillation is the non-relativistic electron cyclotron angular frequency, $\\omega_{ce}$:\n$$ \\omega_{ce} = \\frac{eB}{m_e} $$\nHere, $e$ denotes the magnitude of the elementary charge. This is the angular frequency at which the electron gyrates in a circle in the plane perpendicular to the magnetic field. The emitted radiation occurs at integer multiples (harmonics) of the fundamental cyclotron frequency, $f_{ce}$. The fundamental frequency is related to the angular frequency by $f_{ce} = \\frac{\\omega_{ce}}{2\\pi}$.\n$$ f_{ce} = \\frac{eB}{2\\pi m_e} $$\nThe problem asks for the emission frequency at the second harmonic, $f_2$, which is twice the fundamental frequency:\n$$ f_{2} = 2f_{ce} = 2 \\left(\\frac{eB}{2\\pi m_e}\\right) = \\frac{eB}{\\pi m_e} $$\nNow we compute the numerical value of $f_{2}$ using the provided constants for a magnetic field of $B = 5\\,\\mathrm{T}$:\n-   $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n-   $m_e = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$\n-   $B = 5\\,\\mathrm{T}$\n\nSubstituting these values into the expression for $f_2$:\n$$ f_2 = \\frac{(1.602176634 \\times 10^{-19}\\,\\mathrm{C})(5\\,\\mathrm{T})}{\\pi (9.1093837015 \\times 10^{-31}\\,\\mathrm{kg})} $$\n$$ f_2 \\approx \\frac{8.01088317 \\times 10^{-19}}{2.861780447 \\times 10^{-30}}\\,\\mathrm{Hz} \\approx 2.799235 \\times 10^{11}\\,\\mathrm{Hz} $$\nThe problem requires the frequency to be expressed in gigahertz ($1\\,\\mathrm{GHz} = 10^9\\,\\mathrm{Hz}$) and rounded to four significant figures.\n$$ f_2 \\approx 279.9235\\,\\mathrm{GHz} $$\n$$ f_2 \\approx 279.9\\,\\mathrm{GHz} $$\n\nThe question also requests a brief commentary.\nThe calculated frequency $f_2 = 279.9\\,\\mathrm{GHz}$ lies within the millimeter-wave portion of the electromagnetic spectrum, which is conventionally defined as spanning from $30\\,\\mathrm{GHz}$ to $300\\,\\mathrm{GHz}$ (wavelengths from $10\\,\\mathrm{mm}$ to $1\\,\\mathrm{mm}$). This frequency is indeed well-suited for ECE-based diagnostics in tokamaks. The main reasons are:\n1.  **Plasma Propagation**: For typical high-density tokamak plasmas, the second harmonic ECE frequency is usually higher than the plasma cutoff frequencies (such as the plasma frequency and the right-hand cutoff frequency). This allows the radiation to propagate out of the dense plasma core to external antennas without being reflected or absorbed by resonant plasma phenomena other than the cyclotron resonance itself.\n2.  **Spatial Localization**: The toroidal magnetic field in a tokamak varies spatially, approximately as $B \\propto 1/R$, where $R$ is the major radius. Since the ECE frequency is directly proportional to $B$, there is a one-to-one mapping between the emission frequency and the radial location in the plasma. By measuring the radiation power at a specific frequency (e.g., $279.9\\,\\mathrm{GHz}$), one can determine the electron temperature at the corresponding unique spatial location (here, the magnetic axis where $B=5\\,\\mathrm{T}$).\n3.  **Instrumentation**: The technology for generating, transmitting, and detecting millimeter-wave radiation is mature and robust. Components like quasi-optical transmission lines, heterodyne radiometers, and solid-state detectors are readily available, enabling the construction of high-performance ECE diagnostic systems with excellent sensitivity and temporal resolution.",
            "answer": "$$ \\boxed{279.9} $$"
        },
        {
            "introduction": "Moving from the physics of emission to the practice of measurement, this problem addresses a critical, real-world task: calibrating the diagnostic instrument. A radiometer measures radiation power, not temperature directly, and adds its own thermal noise to the signal. This exercise guides you through the standard hot/cold-load calibration procedure to determine the system's intrinsic noise temperature, $T_{sys}$, and then use it to forecast the ultimate sensitivity of the measurement, providing a quantitative answer to the crucial question: what is the smallest temperature fluctuation we can reliably detect? ",
            "id": "3697448",
            "problem": "A millimeter-wave Electron Cyclotron Emission (ECE) thermography diagnostic on a high-field fusion device uses a heterodyne radiometer channel viewing the second harmonic extraordinary mode near the electron cyclotron resonance. The receiver is characterized by on-bench hot/cold-load calibration and in-shot parameters as follows. A planar blackbody hot load at temperature $T_{hot} = 295 \\,\\mathrm{K}$ and a liquid-nitrogen-cooled cold load at $T_{cold} = 77 \\,\\mathrm{K}$ are presented at the radiometer input in turn. The radiometer output powers measured by a square-law detector are $P_{hot} = 2.022 \\times 10^{-3} \\,\\mathrm{W}$ and $P_{cold} = 2.000 \\times 10^{-3} \\,\\mathrm{W}$. The Intermediate Frequency (IF) chain has an effective noise bandwidth $B = 1.25 \\times 10^{9} \\,\\mathrm{Hz}$, and the channel’s sampling (integration) time is $\\tau = 1.00 \\times 10^{-5} \\,\\mathrm{s}$. The in-shot forward optics have transmission efficiency $\\eta_{t} = 0.92$ along the line-of-sight, the collected mode fraction (including polarization and optical coupling) is $\\kappa = 0.85$, and the local optical depth at the emission layer is $\\tau_{opt} = 2.00$. Assume the Rayleigh–Jeans limit is valid for all stated temperatures and frequencies.\n\nStarting only from the definition of thermal radiation in the Rayleigh–Jeans limit, linearity of the receiver, and standard statistical properties of square-law detection, first determine the system noise temperature $T_{sys}$ using the hot/cold-load measurements. Then, based on the radiometer equation, forecast the minimum detectable electron temperature fluctuation $\\delta T_{e,\\min}$ for this channel by relating the input brightness temperature fluctuation to the electron temperature through the product $\\alpha = \\eta_{t} \\,\\kappa \\,\\left(1 - \\exp(-\\tau_{opt})\\right)$.\n\nExpress $T_{sys}$ in $\\mathrm{K}$ and $\\delta T_{e,\\min}$ in $\\mathrm{K}$. Round both final numerical results to three significant figures.",
            "solution": "The problem requires the determination of the system noise temperature $T_{sys}$ and the minimum detectable electron temperature fluctuation $\\delta T_{e,\\min}$ for an Electron Cyclotron Emission (ECE) radiometer channel, based on provided calibration and operational parameters.\n\nFirst, a validation of the problem statement is necessary.\nThe givens extracted from the problem are:\nHot load temperature: $T_{hot} = 295 \\,\\mathrm{K}$\nCold load temperature: $T_{cold} = 77 \\,\\mathrm{K}$\nRadiometer output power (hot load): $P_{hot} = 2.022 \\times 10^{-3} \\,\\mathrm{W}$\nRadiometer output power (cold load): $P_{cold} = 2.000 \\times 10^{-3} \\,\\mathrm{W}$\nIntermediate Frequency (IF) noise bandwidth: $B = 1.25 \\times 10^{9} \\,\\mathrm{Hz}$\nSampling (integration) time: $\\tau = 1.00 \\times 10^{-5} \\,\\mathrm{s}$\nForward optics transmission efficiency: $\\eta_{t} = 0.92$\nCollected mode fraction (coupling efficiency): $\\kappa = 0.85$\nLocal optical depth: $\\tau_{opt} = 2.00$\nAssumptions: The Rayleigh–Jeans limit holds, the receiver is linear, and standard statistical properties of square-law detection apply.\nThe problem is scientifically grounded in the principles of radiometry and plasma diagnostics. All provided values are physically realistic for an ECE diagnostic on a fusion experiment. The problem is well-posed, providing all necessary information to calculate the requested quantities, and contains no internal contradictions or ambiguities. Therefore, the problem is deemed valid and a solution can be derived.\n\nThe first step is to calculate the system noise temperature, $T_{sys}$. The problem states the receiver is linear and the Rayleigh-Jeans approximation is valid. In this limit, the noise power delivered by a thermal source is proportional to its brightness temperature. A heterodyne radiometer adds its own internal noise, which can be characterized by an equivalent input noise temperature, the system noise temperature $T_{sys}$. The total output power $P$ from the square-law detector is linearly proportional to the sum of the input brightness temperature $T_{rad}$ and the system noise temperature $T_{sys}$.\n$$P = C (T_{rad} + T_{sys})$$\nwhere $C$ is a proportionality constant that encompasses the system gain, the Boltzmann constant $k_B$, and the IF bandwidth $B$.\n\nDuring the hot/cold-load calibration, the radiometer views blackbody sources, for which the brightness temperature equals the physical temperature. We can write two equations:\nFor the hot load: $P_{hot} = C (T_{hot} + T_{sys})$\nFor the cold load: $P_{cold} = C (T_{cold} + T_{sys})$\n\nTo solve for $T_{sys}$, we can use the Y-factor method, which relies on the ratio of the two power measurements:\n$$Y = \\frac{P_{hot}}{P_{cold}} = \\frac{C (T_{hot} + T_{sys})}{C (T_{cold} + T_{sys})} = \\frac{T_{hot} + T_{sys}}{T_{cold} + T_{sys}}$$\nRearranging this equation to solve for $T_{sys}$:\n$$Y (T_{cold} + T_{sys}) = T_{hot} + T_{sys}$$\n$$Y T_{cold} + Y T_{sys} = T_{hot} + T_{sys}$$\n$$T_{sys} (Y - 1) = T_{hot} - Y T_{cold}$$\n$$T_{sys} = \\frac{T_{hot} - Y T_{cold}}{Y - 1}$$\nSubstituting the given numerical values:\n$Y = \\frac{2.022 \\times 10^{-3}}{2.000 \\times 10^{-3}} = 1.011$\n$$T_{sys} = \\frac{295 - (1.011)(77)}{1.011 - 1} = \\frac{295 - 77.847}{0.011} = \\frac{217.153}{0.011} \\approx 19741.18 \\,\\mathrm{K}$$\nRounding to three significant figures, the system noise temperature is $T_{sys} = 1.97 \\times 10^{4} \\,\\mathrm{K}$.\n\nThe second step is to determine the minimum detectable electron temperature fluctuation, $\\delta T_{e,\\min}$. This is dictated by the radiometer equation, which describes the statistical uncertainty of the measurement. For a total power radiometer with a square-law detector, the root-mean-square (RMS) fluctuation of the measured temperature, $\\delta T_{\\text{out}}$, is given by the total system temperature divided by the square root of the bandwidth-integration time product.\nThe minimum detectable change in input brightness temperature, $\\delta T_{B, \\min}$, corresponds to the noise-equivalent temperature (NET) of the instrument, which is the fluctuation level for a signal-to-noise ratio of $1$. This intrinsic instrument sensitivity is determined by the system's own noise floor, $T_{sys}$.\n$$\\delta T_{B, \\min} = \\frac{T_{sys}}{\\sqrt{B \\tau}}$$\nThe brightness temperature $T_B$ measured by the radiometer is related to the plasma's electron temperature $T_e$ through the equation of radiative transfer. For an optically gray medium ($\\tau_{opt} > 0$) viewed through lossy optics, the relation is:\n$$T_B = \\eta_{t} \\kappa T_e (1 - \\exp(-\\tau_{opt}))$$\nThe problem defines the coefficient $\\alpha = \\eta_{t} \\kappa (1 - \\exp(-\\tau_{opt}))$, so we have a simple linear relationship:\n$$T_B = \\alpha T_e$$\nA small fluctuation in electron temperature, $\\delta T_e$, will produce a corresponding fluctuation in brightness temperature, $\\delta T_B$:\n$$\\delta T_B = \\alpha \\delta T_e$$\nThe minimum detectable electron temperature fluctuation, $\\delta T_{e,\\min}$, is the value that produces a brightness temperature fluctuation equal to the radiometer's noise-equivalent temperature, $\\delta T_{B, \\min}$.\n$$\\delta T_{e, \\min} = \\frac{\\delta T_{B, \\min}}{\\alpha} = \\frac{T_{sys}}{\\alpha \\sqrt{B \\tau}}$$\nNow, we substitute the known and calculated values. First, calculate the dimensionless factors:\n$\\alpha = \\eta_{t} \\kappa (1 - \\exp(-\\tau_{opt})) = (0.92)(0.85)(1 - \\exp(-2.00)) \\approx (0.782)(1 - 0.135335) \\approx 0.67617$\nThe bandwidth-time product is:\n$B \\tau = (1.25 \\times 10^{9} \\,\\mathrm{Hz})(1.00 \\times 10^{-5} \\,\\mathrm{s}) = 12500$\nNow, calculate $\\delta T_{e, \\min}$:\n$$\\delta T_{e, \\min} = \\frac{19741.18}{\\sqrt{12500} \\cdot 0.67617} \\approx \\frac{19741.18}{(111.803)(0.67617)} \\approx \\frac{19741.18}{75.594} \\approx 261.15 \\,\\mathrm{K}$$\nRounding to three significant figures, the minimum detectable electron temperature fluctuation is $\\delta T_{e,\\min} = 261 \\,\\mathrm{K}$.\n\nThe final answers are $T_{sys} \\approx 1.97 \\times 10^{4} \\,\\mathrm{K}$ and $\\delta T_{e,\\min} \\approx 261 \\,\\mathrm{K}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.97 \\times 10^{4} & 261\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Our final practice integrates the preceding concepts into a comprehensive numerical simulation of the full ECE thermography process. In reality, the measured brightness temperature is a weighted average over a region of the plasma, and the inversion from multi-channel measurements to a temperature profile is an ill-posed problem. This advanced exercise challenges you to build a forward model based on the radiative transfer equation and then use linearized uncertainty propagation to see how measurement noise affects the final reconstructed temperature profile, exploring scenarios from optically thick to thin plasmas. ",
            "id": "3697449",
            "problem": "You are given a simplified, yet physically consistent, one-dimensional forward model for Electron Cyclotron Emission (ECE) thermography in a magnetically confined fusion plasma. The model is based on the fundamental radiative transfer equation and Kirchhoff’s law, and it is discretized along a single ray equivalent to a radial line of sight to an ECE receiver. Your task is to assemble the Jacobian matrix of the forward model and then use it to perform linearized uncertainty propagation to quantify the posterior standard deviation of the reconstructed electron temperature profile under measurement noise.\n\nStart from the following fundamental base and definitions:\n- Radiative transfer for brightness temperature in the Rayleigh–Jeans limit: along a path coordinate $s$ with absorption coefficient $\\kappa(s)$ and electron temperature $T_e(s)$, the brightness temperature $T_b$ seen at the detector is the formal solution of the linear transport equation,\n$$\nT_b = \\int_0^{L} \\kappa(s) T_e(s) \\exp\\!\\Big(-\\int_s^{L} \\kappa(u)\\,\\mathrm{d}u\\Big)\\,\\mathrm{d}s,\n$$\nwhere $L$ is the total path length from the plasma interior to the detector. This follows from the differential equation $\\frac{\\mathrm{d}I}{\\mathrm{d}s} = -\\kappa I + j$ with emissivity $j=\\kappa T_e$ in brightness temperature units by Kirchhoff’s law, and using the Rayleigh–Jeans correspondence between intensity and brightness temperature.\n- The local electron cyclotron frequency is $f_{ce}(r) = \\frac{e B(r)}{2\\pi m_e}$, where $e$ is the elementary charge, $m_e$ is the electron mass, and $B(r)$ is the magnetic field magnitude. For a given ECE channel tuned to frequency $f_i$ at harmonic $s$, the local absorption is peaked where $f_i \\approx s f_{ce}(r)$.\n\nDiscretize the plasma along the line of sight into $N$ uniform cells indexed by $j \\in \\{0,\\dots,N-1\\}$, with positions $r_j$ increasing from the plasma center ($j=0$) toward the detector at the edge ($j=N-1$). Let $\\Delta s$ be the uniform path length per cell, and define the discrete absorption coefficient for channel $i$ at cell $j$ as\n$$\n\\kappa_{ij} = k_0\\,n_e(r_j)\\,G\\!\\big(f_i - s f_{ce}(r_j)\\big),\n$$\nwhere $k_0$ is a scalar that sets the optical-depth scale, $n_e(r)$ is a given dimensionless electron density profile shape, and $G(\\cdot)$ is a Gaussian line shape\n$$\nG(\\Delta f) = \\exp\\!\\Big(-\\frac{\\Delta f^2}{2\\,\\delta f^2}\\Big),\n$$\nwith line width $\\delta f$. Then, the discrete forward model for channel $i$ is\n$$\ny_i = \\sum_{j=0}^{N-1} \\Delta s \\,\\kappa_{ij}\\,\\exp\\!\\Big(-\\Delta s \\sum_{m=j+1}^{N-1} \\kappa_{im}\\Big)\\,T_j + \\varepsilon_i,\n$$\nwhere $T_j \\equiv T_e(r_j)$ is the electron temperature at cell $j$ and $\\varepsilon_i$ is measurement noise. This model is linear in $\\{T_j\\}$, so the Jacobian $J$ with entries $J_{ij} = \\frac{\\partial y_i}{\\partial T_j}$ equals the forward operator matrix $W$ defined by\n$$\nW_{ij} = \\Delta s \\,\\kappa_{ij}\\,\\exp\\!\\Big(-\\Delta s \\sum_{m=j+1}^{N-1} \\kappa_{im}\\Big).\n$$\n\nSuppose the reconstruction adopts a Tikhonov-regularized weighted least-squares estimator for $T$,\n$$\n\\widehat{T} = \\arg\\min_T \\left\\{(y - WT)^\\top \\Sigma_n^{-1}(y - WT) + \\lambda \\|LT\\|_2^2\\right\\},\n$$\nwhere $\\Sigma_n$ is the noise covariance of the measurements, $\\lambda \\ge 0$ is the regularization strength, and $L$ is a first-difference operator that penalizes roughness. Because the estimator is linear in $y$, the linearized posterior covariance for the reconstruction is\n$$\n\\mathrm{Cov}(\\widehat{T}) = K \\,\\Sigma_n\\, K^\\top,\\quad \\text{with } K = \\Big(W^\\top \\Sigma_n^{-1} W + \\lambda L^\\top L\\Big)^{-1} W^\\top \\Sigma_n^{-1}.\n$$\nEquivalently, since $\\Big(W^\\top \\Sigma_n^{-1} W + \\lambda L^\\top L\\Big)$ is symmetric positive definite for $\\lambda > 0$ and full data support, one may use\n$$\n\\mathrm{Cov}(\\widehat{T}) = \\Big(W^\\top \\Sigma_n^{-1} W + \\lambda L^\\top L\\Big)^{-1} \\, W^\\top \\Sigma_n^{-1} W \\, \\Big(W^\\top \\Sigma_n^{-1} W + \\lambda L^\\top L\\Big)^{-1}.\n$$\n\nImplement the following physically grounded parameterization to assemble $W$ and evaluate the posterior standard deviations (the square root of the diagonal of $\\mathrm{Cov}(\\widehat{T})$) for a set of test cases. All quantities must be expressed in the specified SI units, and the final reported uncertainties must be in kelvin.\n\nGeometry and profiles (shared by all test cases):\n- Number of cells: $N = 20$.\n- Plasma minor radius: $a = 0.5\\,\\mathrm{m}$.\n- Cell positions: $r_j$ uniformly spaced from $0$ to $a$, with $\\Delta s = \\frac{a}{N-1}$.\n- Magnetic field: $B(r) = B_0 \\left(1 - \\beta\\,\\frac{r}{a}\\right)$ with $B_0 = 5.0\\,\\mathrm{T}$ and $\\beta = 0.4$.\n- Electron cyclotron frequency: $f_{ce}(r) = \\frac{e B(r)}{2\\pi m_e}$, with $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$ and $m_e = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$.\n- Harmonic: $s = 2$.\n- Electron density shape: $n_e(r) = 1 - \\left(\\frac{r}{a}\\right)^2$ (dimensionless, normalized).\n- Gaussian line width: $\\delta f = 4.0\\times 10^9\\,\\mathrm{Hz}$.\n- Number of ECE channels: $M = 16$, with frequencies $f_i$ uniformly spaced from $170\\times 10^9\\,\\mathrm{Hz}$ to $270\\times 10^9\\,\\mathrm{Hz}$.\n\nRegularization:\n- First-difference matrix $L \\in \\mathbb{R}^{(N-1)\\times N}$ defined by $(LT)_k = T_{k+1} - T_{k}$ for $k \\in \\{0,\\dots,N-2\\}$.\n\nNoise models and optical-depth scales (test suite):\n- Test case $1$ (happy path): $k_0 = 50.0\\,\\mathrm{m}^{-1}$, $\\lambda = 10^{-2}$, uncorrelated noise with standard deviation $\\sigma = 1.5\\times 10^4\\,\\mathrm{K}$ per channel, i.e., $\\Sigma_n = \\sigma^2 I_M$.\n- Test case $2$ (optically thin): $k_0 = 5.0\\,\\mathrm{m}^{-1}$, $\\lambda = 5\\times 10^{-3}$, uncorrelated noise with the same $\\sigma$.\n- Test case $3$ (optically thick edge-weighted): $k_0 = 150.0\\,\\mathrm{m}^{-1}$, $\\lambda = 5\\times 10^{-2}$, uncorrelated noise with the same $\\sigma$.\n- Test case $4$ (correlated noise): $k_0 = 50.0\\,\\mathrm{m}^{-1}$, $\\lambda = 10^{-2}$, correlated noise with nearest-neighbor correlation coefficient $\\rho = 0.3$,\n$$\n\\Sigma_n[i,j] =\n\\begin{cases}\n\\sigma^2, & i=j,\\\\\n\\rho\\,\\sigma^2, & |i-j| = 1,\\\\\n0, & \\text{otherwise},\n\\end{cases}\n$$\nwith the same $\\sigma$ as above.\n\nTasks to implement:\n- Assemble the forward matrix $W \\in \\mathbb{R}^{M\\times N}$ using the discrete model for each test case’s $k_0$.\n- Assemble $L$ once as a first-difference operator.\n- For each noise model, compute $\\Sigma_n$ and its inverse $\\Sigma_n^{-1}$.\n- Compute the linear estimator gain $K$ and then the posterior covariance $\\mathrm{Cov}(\\widehat{T}) = K \\Sigma_n K^\\top$.\n- Extract the posterior standard deviation profile $\\sqrt{\\mathrm{diag}(\\mathrm{Cov}(\\widehat{T}))}$.\n\nAnswer format and unit requirements:\n- Report, for each test case, the posterior standard deviations at three indices: $j=0$ (magnetic axis), $j=\\lceil N/2 \\rceil$ (mid-radius), and $j=N-1$ (edge).\n- Express all three reported uncertainties in kelvin, each rounded to three decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, with one inner list per test case in the order given above, e.g., $[[u_{1,0},u_{1,\\mathrm{mid}},u_{1,\\mathrm{edge}}],[u_{2,0},\\dots],\\dots]$, where each $u$ is a decimal number in kelvin.\n\nYour program must be a complete and runnable implementation that performs all the steps above and prints exactly one line in the specified output format. No random sampling is allowed; all computations must be deterministic from the inputs as specified.",
            "solution": "The problem requires the computation of posterior standard deviations for an electron temperature profile reconstructed from simulated Electron Cyclotron Emission (ECE) measurements. The solution involves implementing a linearized forward model based on the radiative transfer equation, defining a Tikhonov-regularized inversion, and applying the formula for linearized posterior uncertainty propagation. The calculation is to be performed for four distinct test cases, each with different physical or statistical parameters.\n\nThe procedural steps are as follows:\n1.  Define the physical and computational domain, which includes the spatial grid, ECE frequency channels, and relevant physical constants.\n2.  For each test case, assemble the forward operator matrix $W$, which maps the electron temperature profile $T$ to the measured brightness temperatures $y$.\n3.  Assemble the first-difference regularization operator $L$ and the noise covariance matrix $\\Sigma_n$.\n4.  Compute the posterior covariance matrix $\\mathrm{Cov}(\\widehat{T})$ for the estimated temperature profile $\\widehat{T}$.\n5.  Extract the posterior standard deviations from the diagonal of $\\mathrm{Cov}(\\widehat{T})$ and report the values at specified locations.\n\nLet's detail each step.\n\nFirst, we establish the shared parameters and grids. The plasma is discretized into $N=20$ cells along a radial line of sight of length $a=0.5\\,\\mathrm{m}$. The cell positions $r_j$ for $j \\in \\{0, \\dots, N-1\\}$ are uniformly spaced from $r_0=0$ to $r_{N-1}=a$. The path length per cell is $\\Delta s = a/(N-1)$. There are $M=16$ ECE measurement channels with frequencies $f_i$ for $i \\in \\{0, \\dots, M-1\\}$ uniformly spaced from $170 \\times 10^9\\,\\mathrm{Hz}$ to $270 \\times 10^9\\,\\mathrm{Hz}$.\n\nThe physical properties of the plasma are defined by given profiles. The magnetic field strength varies with radius as $B(r_j) = B_0 (1 - \\beta r_j/a)$, with $B_0=5.0\\,\\mathrm{T}$ and $\\beta=0.4$. This leads to a spatially varying electron cyclotron frequency $f_{ce}(r_j) = e B(r_j) / (2\\pi m_e)$, where $e$ and $m_e$ are the elementary charge and electron mass, respectively. The electron density profile is given by the normalized shape $n_e(r_j) = 1 - (r_j/a)^2$.\n\nThe core of the forward model is the forward operator matrix $W \\in \\mathbb{R}^{M \\times N}$. Its elements $W_{ij}$ are derived from the discretized radiative transfer equation and represent the contribution of the temperature $T_j$ in cell $j$ to the signal in channel $i$.\nThe assembly of $W$ starts with the calculation of the absorption coefficient matrix $\\kappa \\in \\mathbb{R}^{M \\times N}$. The element $\\kappa_{ij}$ depends on the ECE channel frequency $f_i$, the local plasma properties at cell $j$, and the optical depth scaling factor $k_0$:\n$$\n\\kappa_{ij} = k_0\\,n_e(r_j)\\,G\\!\\big(f_i - s f_{ce}(r_j)\\big)\n$$\nHere, $s=2$ is the harmonic number and $G(\\Delta f) = \\exp(-\\Delta f^2 / (2\\delta f^2))$ is a Gaussian line shape function with a given width $\\delta f = 4.0\\times 10^9\\,\\mathrm{Hz}$.\n\nWith the absorption coefficients determined, the elements of the forward matrix $W$ are given by:\n$$\nW_{ij} = \\Delta s \\,\\kappa_{ij}\\,\\exp\\!\\Big(-\\Delta s \\sum_{m=j+1}^{N-1} \\kappa_{im}\\Big)\n$$\nThe exponential term accounts for the attenuation of the radiation from cell $j$ as it propagates through the outer cells ($m > j$) towards the detector. The sum $\\sum_{m=j+1}^{N-1} \\kappa_{im}$ is the optical depth of this path. This calculation is performed for each test case, as $W$ depends on $k_0$.\n\nThe temperature reconstruction uses Tikhonov regularization to ensure a stable and physically meaningful solution. The regularization term $\\lambda \\|LT\\|_2^2$ penalizes roughness in the temperature profile. The first-difference operator $L \\in \\mathbb{R}^{(N-1) \\times N}$ is a matrix where each row $k$ computes the difference $T_{k+1} - T_k$. It is defined by $L_{k,k} = -1$, $L_{k,k+1} = 1$, and zeros elsewhere.\n\nThe measurement uncertainty is characterized by the noise covariance matrix $\\Sigma_n \\in \\mathbb{R}^{M \\times M}$. For test cases with uncorrelated noise, $\\Sigma_n = \\sigma^2 I_M$, where $\\sigma$ is the noise standard deviation and $I_M$ is the identity matrix. For the correlated noise case, $\\Sigma_n$ is a tridiagonal matrix with diagonal elements $\\sigma^2$ and first off-diagonal elements $\\rho\\sigma^2$, where $\\rho$ is the nearest-neighbor correlation coefficient.\n\nThe posterior covariance of the estimated temperature profile, $\\mathrm{Cov}(\\widehat{T})$, is calculated using the provided formula. Let us define the matrix $A = W^\\top \\Sigma_n^{-1} W + \\lambda L^\\top L$, where $\\Sigma_n^{-1}$ is the inverse of the noise covariance matrix and $\\lambda$ is the regularization parameter. The matrix $A$ encapsulates both the data fidelity (weighted by noise) and the prior constraint on profile smoothness. The posterior covariance is then:\n$$\n\\mathrm{Cov}(\\widehat{T}) = A^{-1} \\left( W^\\top \\Sigma_n^{-1} W \\right) A^{-1}\n$$\nThis computation requires matrix multiplication, and importantly, the inversion of the $N \\times N$ matrix $A$.\n\nFinally, the posterior standard deviation for the temperature estimate in each cell $j$, denoted $\\sigma_{\\widehat{T_j}}$, is the square root of the corresponding diagonal element of the covariance matrix:\n$$\n\\sigma_{\\widehat{T_j}} = \\sqrt{\\mathrm{Cov}(\\widehat{T})_{jj}}\n$$\nThese standard deviations quantify the uncertainty in the reconstructed temperature at each spatial point. The process is repeated for all four test cases, and the standard deviations at indices $j=0$ (core), $j=10$ (mid-radius), and $j=19$ (edge) are reported.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import inv\n\ndef solve():\n    \"\"\"\n    Solves the ECE thermography uncertainty propagation problem.\n    \"\"\"\n    # === 1. Define shared constants and geometry ===\n    e = 1.602176634e-19  # Elementary charge in C\n    m_e = 9.1093837015e-31  # Electron mass in kg\n    \n    N = 20  # Number of spatial cells\n    M = 16  # Number of ECE channels\n    \n    a = 0.5  # Plasma minor radius in m\n    B0 = 5.0  # Magnetic field on axis in T\n    beta = 0.4  # Magnetic field gradient parameter\n    \n    s = 2  # Harmonic number\n    df_line = 4.0e9  # Gaussian line width in Hz\n    \n    f_start = 170e9  # Start frequency in Hz\n    f_end = 270e9  # End frequency in Hz\n    \n    # === 2. Set up grids and profiles ===\n    r = np.linspace(0.0, a, N)  # Spatial grid from center to edge\n    ds = a / (N - 1)  # Path length per cell\n    \n    f_channels = np.linspace(f_start, f_end, M)  # ECE frequency channels\n    \n    # Pre-compute spatial profiles\n    B_r = B0 * (1 - beta * r / a)\n    f_ce_r = (e * B_r) / (2 * np.pi * m_e)\n    ne_r = 1 - (r / a)**2\n\n    # === 3. Define the first-difference regularization operator L ===\n    L = np.zeros((N - 1, N))\n    for i in range(N - 1):\n        L[i, i] = -1.0\n        L[i, i + 1] = 1.0\n\n    # === 4. Define test cases ===\n    test_cases = [\n        # k0, lambda, sigma, rho (rho=0 for uncorrelated)\n        (50.0, 1e-2, 1.5e4, 0.0), # Case 1\n        (5.0, 5e-3, 1.5e4, 0.0), # Case 2\n        (150.0, 5e-2, 1.5e4, 0.0),# Case 3\n        (50.0, 1e-2, 1.5e4, 0.3)  # Case 4\n    ]\n\n    all_results = []\n\n    # === 5. Loop through test cases and perform calculations ===\n    for k0, lam, sigma, rho in test_cases:\n        # --- a. Assemble the forward matrix W ---\n        \n        # Calculate absorption coefficient matrix kappa (M x N)\n        kappa = np.zeros((M, N))\n        for i in range(M):\n            for j in range(N):\n                delta_f = f_channels[i] - s * f_ce_r[j]\n                G = np.exp(-delta_f**2 / (2 * df_line**2))\n                kappa[i, j] = k0 * ne_r[j] * G\n        \n        # Calculate forward matrix W (M x N)\n        W = np.zeros((M, N))\n        for i in range(M):\n            for j in range(N):\n                # Sum kappa for cells between j and the detector\n                outward_sum_kappa = np.sum(kappa[i, j + 1:])\n                tau_out = ds * outward_sum_kappa\n                W[i, j] = ds * kappa[i, j] * np.exp(-tau_out)\n\n        # --- b. Assemble the noise covariance matrix Sigma_n ---\n        if rho == 0.0:\n            sigma_n = (sigma**2) * np.eye(M)\n        else:\n            sigma_n = (sigma**2) * np.eye(M)\n            off_diag_val = rho * (sigma**2)\n            sigma_n += off_diag_val * np.eye(M, k=1)\n            sigma_n += off_diag_val * np.eye(M, k=-1)\n        \n        # --- c. Compute the posterior covariance Cov(T_hat) ---\n        sigma_n_inv = inv(sigma_n)\n        \n        WT_sn_inv_W = W.T @ sigma_n_inv @ W\n        LT_L = L.T @ L\n        \n        A = WT_sn_inv_W + lam * LT_L\n        A_inv = inv(A)\n        \n        # Using the form Cov = A_inv * (W^T * Sigma_n_inv * W) * A_inv\n        cov_T_hat = A_inv @ WT_sn_inv_W @ A_inv\n        \n        # --- d. Extract and store standard deviations ---\n        variances = np.diag(cov_T_hat)\n        # Handle potential small negative values from numerical error\n        std_devs = np.sqrt(np.maximum(0, variances))\n        \n        indices_to_report = [0, int(np.ceil(N / 2)), N - 1]\n        \n        case_results = [\n            f\"{std_devs[indices_to_report[0]]:.3f}\",\n            f\"{std_devs[indices_to_report[1]]:.3f}\",\n            f\"{std_devs[indices_to_report[2]]:.3f}\"\n        ]\n        all_results.append(f\"[{','.join(case_results)}]\")\n\n    # === 6. Format and print the final output ===\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}