{
    "hands_on_practices": [
        {
            "introduction": "理解无力磁场的第一步是量化电流密度 $\\mathbf{J}$ 与磁场 $\\mathbf{B}$ 之间的平行程度。标量参数 $\\alpha$ 正是为此而定义的关键物理量。本练习旨在通过推导，加深你对 $\\alpha$ 物理意义的理解，并揭示它与理想线性无力场（即Beltrami场）中常数 $\\lambda$ 的直接联系。",
            "id": "3699872",
            "problem": "在一个磁约束核聚变等离子体中，考虑一个可以忽略位移电流且电场为稳恒的磁静态。基本出发点是无位移电流的麦克斯韦-安培定律 $\\nabla \\times \\mathbf{B} = \\mu_{0}\\,\\mathbf{J}$，以及磁流体动力学（MHD）力平衡方程 $\\nabla p + \\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$，其中 $\\mu_{0}$ 是真空磁导率，$p$ 是等离子体压力。定义标量\n$$\\alpha(\\mathbf{r}) \\equiv \\mu_{0}\\,\\frac{\\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r})}{|\\mathbf{B}(\\mathbf{r})|^{2}}.$$\n首先，仅从上述基本定律出发，证明 $\\alpha(\\mathbf{r})$ 直接衡量了电流与磁场的对准程度，因为它分离出了 $\\mathbf{J}$ 平行于 $\\mathbf{B}$ 的分量，并且当 $\\mathbf{J}$ 处处垂直于 $\\mathbf{B}$ 时，该标量为零。然后，在一个半径为 $a$ 的长直轴对称圆柱等离子体柱（代表高磁雷诺数弛豫态）的背景下，考虑一个由 $\\nabla \\times \\mathbf{B} = \\lambda\\,\\mathbf{B}$（其中 $\\lambda$ 为常数标量）定义的贝尔特拉米磁场。假设该磁场与轴向坐标和方位角无关，其圆柱分量为 $\\mathbf{B}(r) = B_{r}(r)\\,\\hat{\\mathbf{e}}_{r} + B_{\\theta}(r)\\,\\hat{\\mathbf{e}}_{\\theta} + B_{z}(r)\\,\\hat{\\mathbf{e}}_{z}$，并且在 $r=0$ 处磁场保持有限。计算此轴对称圆柱贝尔特拉米磁场的 $\\alpha(r)$。将最终答案以 $\\mathrm{m}^{-1}$ 为单位，表示为单个闭合形式表达式。无需四舍五入。",
            "solution": "问题分为两部分。第一部分要求证明标量函数 $\\alpha(\\mathbf{r})$ 的物理意义。第二部分要求计算特定物理系统（轴对称圆柱贝尔特拉米磁场）的 $\\alpha(\\mathbf{r})$。\n\n**第一部分：$\\alpha(\\mathbf{r})$ 的物理解释**\n\n标量函数定义为：\n$$\n\\alpha(\\mathbf{r}) \\equiv \\mu_{0}\\,\\frac{\\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r})}{|\\mathbf{B}(\\mathbf{r})|^{2}}\n$$\n为了理解其物理意义，我们将电流密度矢量 $\\mathbf{J}(\\mathbf{r})$ 分解为两个分量：一个平行于磁场 $\\mathbf{B}(\\mathbf{r})$ 的分量，记为 $\\mathbf{J}_{\\|}(\\mathbf{r})$；另一个垂直于磁场的分量，记为 $\\mathbf{J}_{\\perp}(\\mathbf{r})$。\n$$\n\\mathbf{J}(\\mathbf{r}) = \\mathbf{J}_{\\|}(\\mathbf{r}) + \\mathbf{J}_{\\perp}(\\mathbf{r})\n$$\n根据定义，平行分量 $\\mathbf{J}_{\\|}$ 是 $\\mathbf{J}$ 在 $\\mathbf{B}$ 方向上的投影。$\\mathbf{B}$ 的方向由单位矢量 $\\hat{\\mathbf{b}} = \\frac{\\mathbf{B}}{|\\mathbf{B}|}$ 给出。因此，投影为：\n$$\n\\mathbf{J}_{\\|} = (\\mathbf{J} \\cdot \\hat{\\mathbf{b}})\\hat{\\mathbf{b}} = \\left(\\mathbf{J} \\cdot \\frac{\\mathbf{B}}{|\\mathbf{B}|}\\right) \\frac{\\mathbf{B}}{|\\mathbf{B}|} = \\frac{\\mathbf{J} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\\mathbf{B}\n$$\n垂直分量 $\\mathbf{J}_{\\perp}$ 的定义满足 $\\mathbf{J}_{\\perp} \\cdot \\mathbf{B} = 0$。\n\n现在，我们将分解式 $\\mathbf{J} = \\mathbf{J}_{\\|} + \\mathbf{J}_{\\perp}$ 代入 $\\alpha(\\mathbf{r})$ 的定义中：\n$$\n\\alpha(\\mathbf{r}) = \\mu_{0}\\,\\frac{(\\mathbf{J}_{\\|} + \\mathbf{J}_{\\perp}) \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}} = \\mu_{0}\\,\\frac{\\mathbf{J}_{\\|} \\cdot \\mathbf{B} + \\mathbf{J}_{\\perp} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\n$$\n由于根据定义 $\\mathbf{J}_{\\perp} \\cdot \\mathbf{B} = 0$，表达式简化为：\n$$\n\\alpha(\\mathbf{r}) = \\mu_{0}\\,\\frac{\\mathbf{J}_{\\|} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\n$$\n这表明 $\\alpha(\\mathbf{r})$ 完全取决于平行于磁场的电流密度分量。它有效地分离出了 $\\mathbf{J}_{\\|}$ 的贡献。\n\n此外，我们可以重新整理 $\\mathbf{J}_{\\|}$ 的表达式：\n$$\n\\mathbf{J}_{\\|} = \\frac{\\mathbf{J} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\\mathbf{B}\n$$\n两边同乘以 $\\mu_{0}$ 并与 $\\alpha(\\mathbf{r})$ 的定义进行比较：\n$$\n\\mu_{0}\\,\\mathbf{J}_{\\|} = \\left(\\mu_{0}\\,\\frac{\\mathbf{J} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\\right)\\mathbf{B} = \\alpha(\\mathbf{r})\\,\\mathbf{B}\n$$\n这个关系式 $\\mu_{0}\\,\\mathbf{J}_{\\|} = \\alpha(\\mathbf{r})\\,\\mathbf{B}$ 表明，$\\alpha(\\mathbf{r})$ 是磁场 $\\mathbf{B}$ 与平行电流密度 $\\mathbf{J}_{\\|}$（经 $\\mu_{0}$ 缩放）之间的比例标量。因此，$\\alpha(\\mathbf{r})$ 是对电流与磁场对准程度的直接度量。\n\n最后，我们必须证明当 $\\mathbf{J}$ 处处垂直于 $\\mathbf{B}$ 时，$\\alpha(\\mathbf{r})$ 为零。如果在所有点 $\\mathbf{r}$ 上都有 $\\mathbf{J} \\perp \\mathbf{B}$，那么它们的标量积为零：\n$$\n\\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r}) = 0\n$$\n将此代入 $\\alpha(\\mathbf{r})$ 的定义中：\n$$\n\\alpha(\\mathbf{r}) = \\mu_{0}\\,\\frac{0}{|\\mathbf{B}(\\mathbf{r})|^{2}} = 0\n$$\n（假设磁场非零，即 $|\\mathbf{B}(\\mathbf{r})| \\neq 0$）。这就完成了问题的第一部分。\n\n**第二部分：轴对称圆柱贝尔特拉米磁场的 $\\alpha(r)$ 计算**\n\n在第二部分中，我们给定一个贝尔特拉米磁场，其定义属性为：\n$$\n\\nabla \\times \\mathbf{B} = \\lambda\\,\\mathbf{B}\n$$\n其中 $\\lambda$ 是一个常数标量。$\\nabla \\times$ 的单位是长度的倒数（$L^{-1}$），因此为了使方程量纲一致，$\\lambda$ 的单位必须是 $L^{-1}$（例如 $\\mathrm{m}^{-1}$）。\n\n问题还给出了磁静态的麦克斯韦-安培定律：\n$$\n\\nabla \\times \\mathbf{B} = \\mu_{0}\\,\\mathbf{J}\n$$\n通过令这两个 $\\nabla \\times \\mathbf{B}$ 的表达式相等，我们为贝尔特拉米磁场建立了电流密度 $\\mathbf{J}$ 和磁场 $\\mathbf{B}$ 之间的直接关系：\n$$\n\\mu_{0}\\,\\mathbf{J} = \\lambda\\,\\mathbf{B}\n$$\n这可以重新整理以用 $\\mathbf{B}$ 表示 $\\mathbf{J}$：\n$$\n\\mathbf{J}(\\mathbf{r}) = \\frac{\\lambda}{\\mu_{0}}\\,\\mathbf{B}(\\mathbf{r})\n$$\n该方程表明，对于具有恒定 $\\lambda$ 的贝尔特拉米磁场，电流密度矢量 $\\mathbf{J}$ 处处与磁场矢量 $\\mathbf{B}$ 共线（平行）。在这种情况下，电流密度的垂直分量 $\\mathbf{J}_{\\perp}$ 为零。这种构型被称为线性无力场，因为洛伦兹力密度 $\\mathbf{J} \\times \\mathbf{B} = \\left(\\frac{\\lambda}{\\mu_{0}}\\,\\mathbf{B}\\right) \\times \\mathbf{B} = \\frac{\\lambda}{\\mu_{0}}\\,(\\mathbf{B} \\times \\mathbf{B}) = \\mathbf{0}$。根据给定的MHD力平衡方程 $\\nabla p + \\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$，这意味着 $\\nabla p = \\mathbf{0}$，因此等离子体压力是均匀的。\n\n现在我们使用其定义来计算 $\\alpha(r)$。对于这个具体计算，关于圆柱几何的所有详细假设（轴对称性、与 $z$ 和 $\\theta$ 无关）都不是必需的，因为关系式 $\\mathbf{J} = (\\lambda/\\mu_{0})\\mathbf{B}$ 对任何贝尔特拉米磁场都普遍成立。\n$$\n\\alpha(r) \\equiv \\mu_{0}\\,\\frac{\\mathbf{J}(r) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\n代入从贝尔特拉米条件导出的 $\\mathbf{J}(r)$ 表达式：\n$$\n\\alpha(r) = \\mu_{0}\\,\\frac{\\left(\\frac{\\lambda}{\\mu_{0}}\\,\\mathbf{B}(r)\\right) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\n我们可以提出标量常数：\n$$\n\\alpha(r) = \\mu_{0}\\,\\frac{\\lambda}{\\mu_{0}}\\,\\frac{\\mathbf{B}(r) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\n真空磁导率常数 $\\mu_{0}$ 被消去：\n$$\n\\alpha(r) = \\lambda\\,\\frac{\\mathbf{B}(r) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\n矢量与其自身的标量积 $\\mathbf{B}(r) \\cdot \\mathbf{B}(r)$ 等于其大小的平方 $|\\mathbf{B}(r)|^{2}$。\n$$\n\\alpha(r) = \\lambda\\,\\frac{|\\mathbf{B}(r)|^{2}}{|\\mathbf{B}(r)|^{2}}\n$$\n假设磁场非零，即 $|\\mathbf{B}(r)|^{2} \\neq 0$（这对于磁约束是物理上必需的），我们可以消去分子和分母中的 $|\\mathbf{B}(r)|^{2}$ 项。剩下：\n$$\n\\alpha(r) = \\lambda\n$$\n标量函数 $\\alpha(r)$ 不是位置 $r$ 的函数，而是等于定义贝尔特拉米磁场的常数标量 $\\lambda$。$\\lambda$ 的单位是 $\\mathrm{m}^{-1}$，符合要求。",
            "answer": "$$\\boxed{\\lambda}$$"
        },
        {
            "introduction": "在建立磁平衡构型后，下一个关键步骤是理解其几何结构，因为这直接决定了等离子体的约束性能。安全因子 $q$ 是描述磁力线螺旋缠绕程度的核心参数，对分析宏观稳定性至关重要。通过这个练习，你将亲手从磁场分量推导出这一关键几何量，从而更好地把握磁约束的拓扑特性。",
            "id": "3699938",
            "problem": "在磁约束核聚变的背景下，考虑一个半径为 $a$ 的直的、轴对称的圆柱形等离子体，其轴向坐标 $z$ 具有周期性，周期为 $L$，因此 $z$ 和 $z+L$ 是等同的。磁场 $\\boldsymbol{B}(r)$ 处于无力状态，即 $\\boldsymbol{j} \\times \\boldsymbol{B} = \\boldsymbol{0}$（其中 $\\boldsymbol{j}$ 为电流密度），并且符合静磁学定律，即 $\\nabla \\cdot \\boldsymbol{B} = 0$ 和 $\\nabla \\times \\boldsymbol{B} = \\mu_{0} \\boldsymbol{j}$。在假定的对称性下，设 $\\boldsymbol{B} = B_{z}(r) \\,\\hat{\\boldsymbol{z}} + B_{\\theta}(r) \\,\\hat{\\boldsymbol{\\theta}}$，其中 $B_{r}(r) = 0$，且 $B_{z}(r), B_{\\theta}(r)$ 仅依赖于径向坐标 $r$。\n\n在此构型中，磁场线是螺旋曲线，它们在沿 $z$ 轴前进的同时环绕圆柱体。将半径 $r$ 处的安全因子 $q(r)$ 定义为一条磁场线每完成一次极向旋转（即极向角 $\\theta$ 变化 $2\\pi$）所经过的轴向周期数（即沿周期长度 $L$ 的遍历次数）。从上述基本定律和“磁场线是其上每一点的切线都与 $\\boldsymbol{B}$ 平行的曲线”这一定义出发，推导 $q(r)$ 关于 $B_{z}(r)$、$B_{\\theta}(r)$ 和周期长度 $L$ 的解析表达式。\n\n你的最终答案必须是 $q(r)$ 的单个闭合形式表达式。安全因子是无量纲的，因此不需要单位。无需进行数值计算或四舍五入。",
            "solution": "首先根据所需标准对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- **系统**：一个半径为 $a$ 的直的、轴对称的圆柱形等离子体。\n- **周期性**：轴向坐标 $z$ 具有周期性，周期为 $L$，即 $z \\equiv z+L$。\n- **物理学**：磁场 $\\boldsymbol{B}$ 处于无力状态，满足 $\\boldsymbol{j} \\times \\boldsymbol{B} = \\boldsymbol{0}$。\n- **方程**：适用静磁学定律：$\\nabla \\cdot \\boldsymbol{B} = 0$ 和 $\\nabla \\times \\boldsymbol{B} = \\mu_{0} \\boldsymbol{j}$，其中 $\\boldsymbol{j}$ 是电流密度。\n- **场结构**：由于对称性，磁场由 $\\boldsymbol{B} = B_{z}(r) \\,\\hat{\\boldsymbol{z}} + B_{\\theta}(r) \\,\\hat{\\boldsymbol{\\theta}}$ 给出，其中 $B_{r}(r) = 0$。分量 $B_{z}(r)$ 和 $B_{\\theta}(r)$ 仅依赖于径向坐标 $r$。\n- **磁场线的定义**：一条曲线，其上每一点的切线都与 $\\boldsymbol{B}$ 平行。\n- **安全因子 $q(r)$ 的定义**：磁场线每完成一次极向旋转（$\\theta$ 变化 $2\\pi$）所经过的轴向周期数（沿长度 $L$ 的遍历次数）。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题描述了一个标准的圆柱形箍缩模型，这是等离子体物理和聚变研究中一个有效且基本​​的简化。无力场、静磁学和安全因子的概念是磁流体力学（MHD）的核心。这些条件在科学上是合理的。\n- **适定性**：该问题是适定的。所提供的定义和物理定律足以推导出 $q(r)$ 的唯一解析表达式。\n- **客观性**：该问题以精确、客观的语言陈述，没有歧义或主观性陈述。\n- **完整性与一致性**：条件 $B_r = 0$ 以及磁场仅依赖于 $r$ 的设定，在圆柱坐标系中自动满足 $\\nabla \\cdot \\boldsymbol{B} = 0$，从而确保了一致性。推导表达式所需的所有必要信息均已提供。\n- **真实性**：该模型是一种理想化（环体的大环径比极限），但它在理论等离子体物理学中是一个物理上合理且广泛使用的模型。\n\n**步骤3：结论与行动**\n该问题是有效的，因为它在科学上合理、适定且自洽。可以进行求解过程。\n\n**安全因子 $q(r)$ 的推导**\n\n磁场线是空间中的一条曲线，其上每一点的切向量都与磁场矢量 $\\boldsymbol{B}$ 平行。设磁场线上一点的圆柱坐标为 $(r, \\theta, z)$。沿此磁场线的无穷小位移矢量为 $d\\boldsymbol{l} = dr\\,\\hat{\\boldsymbol{r}} + r\\,d\\theta\\,\\hat{\\boldsymbol{\\theta}} + dz\\,\\hat{\\boldsymbol{z}}$。\n\n$d\\boldsymbol{l}$ 平行于 $\\boldsymbol{B}$ 的条件意味着它们的分量成比例：\n$$\n\\frac{dr}{B_r} = \\frac{r\\,d\\theta}{B_{\\theta}} = \\frac{dz}{B_z}\n$$\n问题指明磁场结构为 $\\boldsymbol{B} = B_{\\theta}(r) \\,\\hat{\\boldsymbol{\\theta}} + B_{z}(r) \\,\\hat{\\boldsymbol{z}}$，这意味着径向分量 $B_r$ 为零。比例关系的第一部分 $\\frac{dr}{B_r} = \\frac{dr}{0}$ 意味着对于沿磁场线的任何非零位移，都有 $dr=0$。这表明每条磁场线完全位于一个恒定半径 $r$ 的圆柱面上。这与问题将安全因子 $q(r)$ 定义为半径的函数是一致的。\n\n对于恒定半径 $r$ 曲面上的磁场线，其极向位移和轴向位移之间的关系由剩下的等式决定：\n$$\n\\frac{r\\,d\\theta}{B_{\\theta}(r)} = \\frac{dz}{B_{z}(r)}\n$$\n由于 $B_{\\theta}$ 和 $B_z$ 仅依赖于 $r$，它们在任何给定的磁场线上都是常数。我们可以重排这个微分方程，以求出极向角相对于轴向距离的变化率，该变化率代表了螺旋磁场线的螺距：\n$$\n\\frac{d\\theta}{dz} = \\frac{B_{\\theta}(r)}{r B_{z}(r)}\n$$\n安全因子 $q(r)$ 定义为每完成一次极向旋转（$\\theta$ 变化 $2\\pi$）所经过的轴向周期 $L$ 的次数。设 $\\Delta z$ 为总极向角变化 $\\Delta\\theta$ 所对应的总轴向行进距离。\n轴向周期数为 $\\frac{\\Delta z}{L}$。\n极向旋转次数为 $\\frac{\\Delta\\theta}{2\\pi}$。\n因此，$q(r)$ 的定义可以写成：\n$$\nq(r) = \\frac{\\text{轴向周期数}}{\\text{极向旋转次数}} = \\frac{\\Delta z / L}{\\Delta\\theta / 2\\pi} = \\frac{2\\pi}{L} \\frac{\\Delta z}{\\Delta\\theta}\n$$\n比率 $\\frac{\\Delta z}{\\Delta\\theta}$ 可以从我们关于磁场线的微分关系中求得。由于对于给定的 $r$，比率 $\\frac{d\\theta}{dz}$ 是一个常数，所以有限变化的比率 $\\frac{\\Delta\\theta}{\\Delta z}$ 也等于这个常数值：\n$$\n\\frac{\\Delta\\theta}{\\Delta z} = \\frac{B_{\\theta}(r)}{r B_{z}(r)}\n$$\n将其倒置，得到 $q(r)$ 公式所需的比率：\n$$\n\\frac{\\Delta z}{\\Delta\\theta} = \\frac{r B_{z}(r)}{B_{\\theta}(r)}\n$$\n将此结果代入 $q(r)$ 的表达式中：\n$$\nq(r) = \\frac{2\\pi}{L} \\left( \\frac{r B_{z}(r)}{B_{\\theta}(r)} \\right)\n$$\n这就得到了安全因子的最终解析表达式。给出的其他条件，例如无力状态，确保了所描述的磁场构型是一个有效的静态平衡，但对于根据磁场分量几何推导 $q(r)$ 而言并非直接需要。",
            "answer": "$$\n\\boxed{\\frac{2 \\pi r B_{z}(r)}{L B_{\\theta}(r)}}\n$$"
        },
        {
            "introduction": "尽管理想的轴对称无力场模型是理论分析的基石，但现实世界中的磁约束装置不可避免地存在非轴对称的微小扰动。本计算练习将引导你探索这些“不完美”所带来的深刻后果，即磁力线混沌现象及其对等离子体约束的潜在破坏。这项实践让你能亲身体验用于分析复杂磁拓扑的现代计算物理方法，并理解其对聚变研究的实际意义。",
            "id": "3699924",
            "problem": "考虑一个用于近似核聚变中环形装置的磁约束等离子体柱的直周期圆柱模型。假设存在一个无力磁场，其定义为磁力消失的条件，即 $\\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$，其中 $\\mathbf{J}$ 是电流密度，$\\mathbf{B}$ 是磁场。使用安培定律 $\\mu_{0}\\mathbf{J} = \\nabla \\times \\mathbf{B}$ 和无力条件，背景场的标准模型是一个贝尔特拉米场，满足 $\\nabla \\times \\mathbf{B}_{0} = \\alpha \\mathbf{B}_{0}$，其中 $\\alpha$ 为常数。在半径为 $a$ 的圆柱域中，一个轴对称解采用经过充分检验的形式\n$\\mathbf{B}_{0}(r) = B_{0}\\,J_{1}(\\alpha r)\\,\\hat{\\boldsymbol{\\theta}} + B_{0}\\,J_{0}(\\alpha r)\\,\\hat{\\mathbf{z}}$，\n其中 $J_{0}$ 和 $J_{1}$ 是第一类贝塞尔函数，$r$ 是径向坐标，$\\hat{\\boldsymbol{\\theta}}$ 是角向单位矢量，$\\hat{\\mathbf{z}}$ 是轴向单位矢量。我们假设 $\\alpha a  2.4048255577$，以使得在 $[0,a]$ 上 $J_{0}(\\alpha r) > 0$，从而避免轴向场反转和奇异的磁力线方程。在一个轴向周期长度为 $L_{z}$ 的直圆柱体中，使用磁通函数 $\\psi(r,\\theta,z)$ 引入一个小的、非轴对称的、无散的微扰：\n$\\psi(r,\\theta,z) = \\varepsilon\\,B_{0}\\,a^{2}\\,f(r)\\,\\cos\\big(m\\,\\theta - k\\,z\\big)$,\n$f(r) = \\left(\\frac{r}{a}\\right)^{m}\\exp\\!\\left(-\\left(\\frac{r}{a}\\right)^{2}\\right)$,\n$k = \\frac{2\\pi n}{L_{z}}$，\n其中 $\\varepsilon$ 是一个小振幅，$m$ 和 $n$ 是指定螺旋模的整数，$k$ 是轴向波数。通过 $\\mathbf{B}_{\\perp} = \\nabla\\psi \\times \\hat{\\mathbf{z}}$ 定义微扰，因此微扰后的磁场为 $\\mathbf{B} = \\mathbf{B}_{0} + \\mathbf{B}_{\\perp}$，其分量为\n$B_{r} = -\\frac{1}{r}\\frac{\\partial \\psi}{\\partial \\theta}$, $B_{\\theta} = \\frac{\\partial \\psi}{\\partial r} + B_{0}J_{1}(\\alpha r)$, $B_{z} = B_{0}J_{0}(\\alpha r)$。\n磁力线与 $\\mathbf{B}$ 相切，并满足\n$\\frac{d r}{d z} = \\frac{B_{r}}{B_{z}},\\quad \\frac{d \\theta}{d z} = \\frac{B_{\\theta}}{r\\,B_{z}}$，\n其中 $z$ 充当自变量。庞加莱映射通过在轴向位置 $z = \\ell\\,L_{z}$（其中 $\\ell$ 为整数）处进行采样来定义，这类似于环形装置中的环向渡越。对于足够小的 $\\varepsilon$，柯尔莫哥洛夫-阿诺德-莫泽 (KAM) 不变环架可以持续存在，但共振的 $m/n$ 曲面和重叠的磁岛会产生混沌的磁力线行为。这种混沌会因磁力线向壁面（$r=a$）的径向漂移而降低约束性能。\n\n仅从上述基本定律和定义出发，执行以下操作：\n\n- 推导积分磁力线方程所需的显式表达式，清晰地陈述每个量，包括 $\\psi(r,\\theta,z)$ 所需的所有导数。\n- 设计一个算法，对于给定的参数和在 $z=0$ 处的初始点 $(r_{0},\\theta_{0})$，使用均匀步长 $\\Delta z$ 的四阶龙格－库塔方法，在给定的庞加莱周期数 $N_{\\text{per}}$ 内积分磁力线方程。时间步长 $\\Delta z$ 的选择应足以充分解析螺旋微扰。\n- 通过计算有限时间李雅普诺夫指数 (FTLE) 来量化磁力线对初始条件的敏感性，此处定义为\n$\\lambda = \\frac{1}{T}\\ln\\left(\\frac{d(T)}{d(0)}\\right)$，\n其中 $T = N_{\\text{surv}}\\,L_{z}$ 是总积分长度，直到完成 $N_{\\text{per}}$ 个周期或磁力线到达 $r \\ge a$（丢失），以先发生者为准；$d(0)$ 是两个邻近初始条件之间的初始无穷小分离；$d(T)$ 是在最后一个可用的庞加莱截面上测得的最终分离。使用庞加莱平面上的度量 $d = \\sqrt{(\\Delta r)^{2} + (r_{\\text{avg}}\\Delta\\theta)^{2}}$，并以弧度为单位测量角度 $\\theta$。\n- 定义一个约束指示器如下：如果磁力线在所有 $N_{\\text{per}}$ 个庞加莱周期内保持在 $r  a$ 的范围内，则约束指示器 $C=1$；否则，$C=0$。",
            "solution": "用户希望解决一个关于圆柱等离子体模型中磁力线混沌的问题。\n\n### **1. 问题验证**\n\n首先，对问题陈述进行严格的验证。\n\n- **已知条件提取**：从问题陈述中逐字提取所有给定的物理定律（$\\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$，$\\mu_0\\mathbf{J} = \\nabla \\times \\mathbf{B}$）、数学模型（贝尔特拉米场 $\\mathbf{B}_0$，微扰 $\\psi$）、分量定义（$B_r, B_\\theta, B_z$）、动力学方程（$\\frac{dr}{dz}, \\frac{d\\theta}{dz}$）、分析方法（庞加莱映射，FTLE）、数值参数（$a, \\alpha, B_0, L_z, \\delta\\theta_{0}, \\Delta z$）以及测试案例。\n- **科学依据**：该问题在应用于等离子体物理的磁流体力学 (MHD) 和混沌理论原理方面有坚实的基础，是核聚变研究中的一个标准课题。无力平衡和在小微扰下磁力线轨迹的分析是经典的。\n- **适定性**：该问题在数学上是适定的。控制磁力线的常微分方程 (ODE) 定义明确。条件 $\\alpha a = 8.0 \\times 0.2 = 1.6  2.4048...$ 确保了轴向磁场 $B_z=B_0 J_0(\\alpha r)$ 在域 $r \\in [0, a)$ 内没有零点，从而防止了 ODE 中的奇异点。有限时间李雅普诺夫指数 (FTLE) 的定义在磁力线完成一个庞加莱周期前丢失 ($T=0$) 时可能出现 $0/0$ 的不定形式。这通过采纳标准约定来解决，即对于零时间范围，FTLE 为零，使得定义完整且可计算。\n- **客观性与完整性**：问题陈述语言客观、精确，并提供了计算唯一解所需的所有数据和约束。数值积分方法 (RK4) 和步长均已指定，确保了可复现性。\n\n**结论**：该问题被认为是有效的，因为其科学上合理，数学上适定且完整。\n\n### **2. 磁力线方程的推导**\n\n磁力线轨迹由以下常微分方程组确定：\n$$\n\\frac{dr}{dz} = \\frac{B_r}{B_z}, \\quad \\frac{d\\theta}{dz} = \\frac{B_\\theta}{r B_z}\n$$\n我们必须推导磁场分量 $B_r$、$B_\\theta$ 和 $B_z$ 的显式表达式。轴向分量 $B_z$ 直接由背景场 $\\mathbf{B}_0$ 给出：\n$$\nB_z(r) = B_0 J_0(\\alpha r)\n$$\n其他分量 $B_r$ 和 $B_\\theta$ 取决于磁通函数 $\\psi(r, \\theta, z)$ 的导数。\n$$\n\\psi(r, \\theta, z) = \\varepsilon B_0 a^2 f(r) \\cos(m\\theta - kz), \\quad \\text{其中} \\quad f(r) = \\left(\\frac{r}{a}\\right)^m \\exp\\left(-\\left(\\frac{r}{a}\\right)^2\\right)\n$$\n首先，我们计算关于 $\\theta$ 的偏导数：\n$$\n\\frac{\\partial \\psi}{\\partial \\theta} = \\varepsilon B_0 a^2 f(r) \\frac{\\partial}{\\partial \\theta} \\cos(m\\theta - kz) = -m \\varepsilon B_0 a^2 f(r) \\sin(m\\theta - kz)\n$$\n径向场分量则为：\n$$\nB_r = -\\frac{1}{r} \\frac{\\partial \\psi}{\\partial \\theta} = \\frac{m \\varepsilon B_0 a^2}{r} f(r) \\sin(m\\theta - kz)\n$$\n接下来，我们计算关于 $r$ 的偏导数。对 $f(r)$ 使用乘积法则：\n$$\n\\frac{\\partial f}{\\partial r} = \\frac{\\partial}{\\partial r} \\left[ \\left(\\frac{r}{a}\\right)^m e^{-(r/a)^2} \\right] = \\left(\\frac{m r^{m-1}}{a^m}\\right) e^{-(r/a)^2} + \\left(\\frac{r^m}{a^m}\\right) \\left(-\\frac{2r}{a^2}\\right) e^{-(r/a)^2}\n$$\n提出公因子 $f(r) = (r/a)^m e^{-(r/a)^2}$：\n$$\n\\frac{\\partial f}{\\partial r} = \\left(\\frac{m}{r} - \\frac{2r}{a^2}\\right) f(r)\n$$\n这给出了磁通函数的导数：\n$$\n\\frac{\\partial \\psi}{\\partial r} = \\varepsilon B_0 a^2 \\left(\\frac{m}{r} - \\frac{2r}{a^2}\\right) f(r) \\cos(m\\theta - kz)\n$$\n角向场是微扰与背景场之和：\n$$\nB_\\theta = \\frac{\\partial \\psi}{\\partial r} + B_0 J_1(\\alpha r) = \\varepsilon B_0 a^2 \\left(\\frac{m}{r} - \\frac{2r}{a^2}\\right) f(r) \\cos(m\\theta - kz) + B_0 J_1(\\alpha r)\n$$\n将这些分量代入磁力线 ODE 并通过消去 $B_0$ 进行简化：\n$$\n\\frac{dr}{dz} = \\frac{1}{J_0(\\alpha r)} \\left[ \\frac{m \\varepsilon a^2}{r} f(r) \\sin(m\\theta - kz) \\right]\n$$\n$$\n\\frac{d\\theta}{dz} = \\frac{1}{r J_0(\\alpha r)} \\left[ \\varepsilon a^2 \\left(\\frac{m}{r} - \\frac{2r}{a^2}\\right) f(r) \\cos(m\\theta - kz) + J_1(\\alpha r) \\right]\n$$\n这两个方程构成了需要进行数值积分的系统。\n\n### **3. 算法设计**\n\n算法的核心是一个四阶龙格－库塔 (RK4) 积分器，用于求解两个无限小分离的磁力线的耦合常微分方程。\n\n1.  **初始化**：对于每个测试案例 $(\\varepsilon, m, n, r_{0}, \\theta_{0}, N_{\\text{per}})$，设置物理常数（$a, \\alpha, L_z$）和数值参数（$\\Delta z, \\delta\\theta_0$）。计算轴向波数 $k = 2\\pi n / L_z$。\n2.  **轨迹设置**：在 $z=0$ 处定义两个初始点：\n    - 轨迹 1: $(r_1, \\theta_1) = (r_0, \\theta_0)$\n    - 轨迹 2: $(r_2, \\theta_2) = (r_0, \\theta_0 + \\delta\\theta_0)$\n3.  **初始分离**：计算初始分离 $d(0) = r_0 |\\delta\\theta_0|$。\n4.  **积分循环**：\n    - 状态向量为 $\\mathbf{y} = [r_1, \\theta_1, r_2, \\theta_2]$。积分从 $z=0$ 进行到 $z=N_{\\text{per}}L_z$。\n    - 在每一步中，使用应用于推导出的 ODE 的 RK4 方法将 $\\mathbf{y}$ 从 $z$推进到 $z+\\Delta z$。\n    - 每步之后，检查主轨迹的径向位置 $r_1$。如果 $r_1 \\ge a$，则认为磁力线已丢失。积分停止，并将约束指示器设为 $C=0$。\n    - 在每个庞加莱周期结束时（即当 $z$ 是 $L_z$ 的倍数时），存储状态向量 $\\mathbf{y}$。此数据用于 FTLE 计算。\n5.  **后处理**：\n    - **存续周期数 ($N_{\\text{surv}}$)**：如果循环完成而没有丢失，则 $N_{\\text{surv}} = N_{\\text{per}}$ 且 $C=1$。如果在第 $i$ 步丢失，则 $N_{\\text{surv}} = \\lfloor (i-1) \\Delta z / L_z \\rfloor$，这计算了在丢失前完成的*完整*周期数。\n    - **FTLE 计算 ($\\lambda$)**：时间范围是 $T = N_{\\text{surv}} L_z$。\n        - 如果 $T=0$，设 $\\lambda=0$。\n        - 如果 $T>0$，从最后一个完成的庞加莱截面（$z=T$）检索存储的状态向量。使用度量 $d = \\sqrt{(\\Delta r)^2 + (r_{\\text{avg}}\\Delta\\theta)^2}$ 计算最终分离 $d(T)$，其中 $\\Delta\\theta$ 被归一化到区间 $(-\\pi, \\pi]$。\n        - FTLE 则为 $\\lambda = \\frac{1}{T} \\ln\\left(\\frac{d(T)}{d(0)}\\right)$。\n6.  **输出格式化**：最终的三元组 $[\\lambda, C, N_{\\text{surv}}]$ 按照规定格式化，$\\lambda$ 四舍五入到六位小数。\n\n这种结构化方法确保了问题的所有要求都以可验证和可复现的方式得到满足。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import j0, j1\n\ndef solve():\n    \"\"\"\n    Main function to solve for all test cases and print the results.\n    \"\"\"\n    # Device and background parameters (constants for all tests)\n    A = 0.2  # m, radius\n    ALPHA = 8.0  # m^-1, Beltrami parameter\n    B0 = 5.0  # T, magnetic field magnitude (note: cancels out in ODEs)\n    LZ = 10.0  # m, axial periodic length\n    DTHETA0 = 1e-6  # rad, initial angular separation\n    DZ = LZ / 800.0 # m, integration step size\n\n    # Test cases: (epsilon, m, n, r0, theta0, N_per)\n    test_cases = [\n        (1e-4, 2, 1, 0.02, 0.1, 80),\n        (5e-4, 2, 1, 0.10, 1.0, 80),\n        (2e-3, 2, 1, 0.16, 2.0, 80),\n        (8e-3, 2, 1, 0.18, 2.5, 80),\n    ]\n\n    results = []\n    for case in test_cases:\n        eps, m, n, r0, theta0, n_per = case\n        result = compute_case(eps, m, n, r0, theta0, n_per, A, ALPHA, LZ, DTHETA0, DZ)\n        results.append(result)\n    \n    # Format the final output string as per requirements.\n    # Ex: [[lambda1,C1,Nsurv1],[lambda2,C2,Nsurv2]]\n    result_strings = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef odes(z, y, m, k, eps, a, alpha):\n    \"\"\"\n    Computes the derivatives dr/dz and dtheta/dz for two trajectories.\n    y = [r1, theta1, r2, theta2]\n    \"\"\"\n    r1, theta1, r2, theta2 = y\n    \n    a_sq = a * a\n    eps_a_sq = eps * a_sq\n    derivatives = np.zeros(4)\n\n    # Derivatives for trajectory 1\n    # Check for r=0 to avoid division by zero, although r0 > 0.\n    if r1 == 0:\n        dr1_dz, dtheta1_dz = 0.0, alpha / 2.0\n    else:\n        phi1 = m * theta1 - k * z\n        j0_r1 = j0(alpha * r1)\n        f_r1 = (r1 / a)**m * np.exp(-(r1 / a)**2)\n        \n        dr1_dz = (eps_a_sq * m / (r1 * j0_r1)) * f_r1 * np.sin(phi1)\n        \n        dtheta1_dz_pert = (eps_a_sq / (r1 * j0_r1)) * (m / r1 - 2 * r1 / a_sq) * f_r1 * np.cos(phi1)\n        dtheta1_dz_main = j1(alpha * r1) / (r1 * j0_r1)\n        dtheta1_dz = dtheta1_dz_main + dtheta1_dz_pert\n    derivatives[0], derivatives[1] = dr1_dz, dtheta1_dz\n\n    # Derivatives for trajectory 2\n    if r2 == 0:\n        dr2_dz, dtheta2_dz = 0.0, alpha / 2.0\n    else:\n        phi2 = m * theta2 - k * z\n        j0_r2 = j0(alpha * r2)\n        f_r2 = (r2 / a)**m * np.exp(-(r2 / a)**2)\n    \n        dr2_dz = (eps_a_sq * m / (r2 * j0_r2)) * f_r2 * np.sin(phi2)\n        \n        dtheta2_dz_pert = (eps_a_sq / (r2 * j0_r2)) * (m / r2 - 2 * r2 / a_sq) * f_r2 * np.cos(phi2)\n        dtheta2_dz_main = j1(alpha * r2) / (r2 * j0_r2)\n        dtheta2_dz = dtheta2_dz_main + dtheta2_dz_pert\n    derivatives[2], derivatives[3] = dr2_dz, dtheta2_dz\n        \n    return derivatives\n\ndef compute_case(eps, m, n, r0, theta0, n_per, a, alpha, lz, dtheta0, dz):\n    \"\"\"\n    Integrates field lines for a single test case and computes results.\n    \"\"\"\n    k = 2 * np.pi * n / lz\n\n    # Initial state vector [r1, theta1, r2, theta2]\n    y = np.array([r0, theta0, r0, theta0 + dtheta0], dtype=np.float64)\n    z = 0.0\n\n    d0 = r0 * dtheta0\n    \n    steps_per_period = int(round(lz / dz))\n    total_steps = n_per * steps_per_period\n\n    poincare_states = {0: y.copy()}\n    \n    is_lost = False\n    final_step = 0\n    \n    for i in range(total_steps):\n        # Fourth-Order Runge-Kutta step\n        k1 = odes(z, y, m, k, eps, a, alpha)\n        k2 = odes(z + 0.5 * dz, y + 0.5 * dz * k1, m, k, eps, a, alpha)\n        k3 = odes(z + 0.5 * dz, y + 0.5 * dz * k2, m, k, eps, a, alpha)\n        k4 = odes(z + dz, y + dz * k3, m, k, eps, a, alpha)\n        y += (dz / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n        z += dz\n        \n        # Check for loss condition on the primary trajectory\n        if y[0] >= a:\n            is_lost = True\n            final_step = i + 1\n            break\n            \n        # Store state at each Poincaré section crossing\n        if (i + 1) % steps_per_period == 0:\n            period_num = (i + 1) // steps_per_period\n            poincare_states[period_num] = y.copy()\n\n    if is_lost:\n        # Field line is lost. Confinement is 0.\n        C = 0\n        # N_surv is the number of full periods completed before loss.\n        # Loss occurred at step `final_step`. Survived up to step `final_step - 1`.\n        # z_survived = (final_step - 1) * dz.\n        n_surv = int(np.floor((final_step - 1) * dz / lz))\n    else:\n        # Field line survived for all periods.\n        C = 1\n        n_surv = n_per\n\n    # Calculate Finite-Time Lyapunov Exponent (FTLE)\n    T = n_surv * lz\n    \n    if T == 0:\n        # If lost before the first Poincaré section, time horizon is zero.\n        # FTLE is defined as 0 in this case.\n        ftle = 0.0\n    else:\n        last_state = poincare_states[n_surv]\n        r1_T, theta1_T, r2_T, theta2_T = last_state\n        \n        dr_T = r2_T - r1_T\n        dtheta_T = theta2_T - theta1_T\n        \n        # Normalize angle difference to (-pi, pi] to get shortest angle.\n        dtheta_T = (dtheta_T + np.pi) % (2 * np.pi) - np.pi\n        \n        r_avg_T = (r1_T + r2_T) / 2.0\n        \n        # Use the specified metric for separation distance.\n        dt_sq = dr_T**2 + (r_avg_T * dtheta_T)**2\n        dt = np.sqrt(dt_sq)\n        \n        if dt == 0 or d0 == 0:\n            ftle = 0.0\n        else:\n            ftle = (1.0 / T) * np.log(dt / d0)\n\n    return [round(ftle, 6), C, n_surv]\n\n# Execute the solver\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}