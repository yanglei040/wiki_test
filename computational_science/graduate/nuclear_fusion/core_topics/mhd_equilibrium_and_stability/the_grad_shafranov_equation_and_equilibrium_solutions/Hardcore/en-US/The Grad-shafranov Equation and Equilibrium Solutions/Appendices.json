{
    "hands_on_practices": [
        {
            "introduction": "To develop a foundational understanding of magnetohydrodynamic (MHD) equilibria, it is often instructive to begin with simplified models that permit analytical solutions. This practice explores the classic large-aspect-ratio, circular tokamak limit, reducing the Grad-Shafranov equation to a one-dimensional problem. By solving this simplified equation, you will directly see how the plasma's pressure and current profiles determine the magnetic geometry and the crucial safety factor profile, $q(\\psi)$ .",
            "id": "3721307",
            "problem": "Consider a large-aspect-ratio, axisymmetric tokamak of major radius $R_{0}$ and circular cross-section of minor radius $a$. Assume ideal Magnetohydrodynamic (MHD) equilibrium, axisymmetry, and that the poloidal flux function $\\psi$ depends only on the minor-radius coordinate $r$ within the plasma column $0 \\leq r \\leq a$. Let the toroidal magnetic field be described by the function $F(\\psi)$ defined by $F(\\psi) = R B_{\\phi}$, and suppose the equilibrium family is specified by\n$$F^{2}(\\psi) = F_{0}^{2} - 2 \\lambda \\psi,$$\nwhere $F_{0} > 0$ is a constant, $\\lambda > 0$ is a given parameter, and $F^{2}(\\psi) \\geq 0$ throughout the plasma. Consider two cases for the pressure profile:\n1. A purely current-driven equilibrium with $p'(\\psi) = 0$.\n2. A pressure-driven equilibrium with a constant outward-decreasing pressure gradient $p'(\\psi) = -\\alpha$, where $\\alpha > 0$ is a constant.\n\nStarting from the ideal MHD force balance $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$ and Ampère’s law $\\mu_{0} \\mathbf{J} = \\nabla \\times \\mathbf{B}$ (where $\\mu_{0}$ is the vacuum permeability), obtain the reduced one-dimensional axisymmetric equilibrium equation for $\\psi(r)$ under the large-aspect-ratio approximation $R \\approx R_{0}$ and circular, nested flux surfaces. Impose regularity at the magnetic axis $r=0$ and finite flux at $r=a$. Using these assumptions, compute the safety factor profile $q(\\psi)$ in both cases. For the safety factor, use the large-aspect-ratio definition\n$$q(r) \\approx \\frac{r B_{\\phi}}{R_{0} B_{\\theta}},$$\nwith $B_{\\phi} = F(\\psi)/R$, $R \\approx R_{0}$, and $B_{\\theta} \\approx B_{p} \\approx \\frac{1}{R_{0}} \\frac{d\\psi}{dr}$ on circular flux surfaces. Express your final results $q(\\psi)$ for both cases as closed-form analytic expressions in terms of $F_{0}$, $R_{0}$, $\\lambda$, $\\alpha$, and $\\psi$. Provide the final answer as a two-entry row matrix $\\big(q_{\\mathrm{current}}(\\psi),\\,q_{\\mathrm{pressure}}(\\psi)\\big)$, and assume $0 \\leq \\psi \\leq \\psi_{a}$ with $F^{2}(\\psi) \\geq 0$. No rounding is required, and the safety factor $q$ is dimensionless.",
            "solution": "The problem asks for the safety factor profile $q(\\psi)$ for two different equilibrium configurations in a large-aspect-ratio, axisymmetric tokamak with a circular cross-section. The derivation will start from the Grad-Shafranov (GS) equation, which is the fundamental equation for ideal MHD equilibrium in an axisymmetric configuration.\n\n### Step 1: Formulate the Reduced Equilibrium Equation\n\nThe ideal MHD force balance is given by $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$, where $p$ is the plasma pressure, $\\mathbf{J}$ is the current density, and $\\mathbf{B}$ is the magnetic field. With Ampère's law, $\\mu_{0} \\mathbf{J} = \\nabla \\times \\mathbf{B}$, this leads to the equilibrium condition $\\nabla p = \\frac{1}{\\mu_{0}} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$.\n\nFor an axisymmetric system (with $\\phi$ as the azimuthal angle), the magnetic field can be expressed in terms of a poloidal flux function $\\psi(R, Z)$ and a toroidal field function $F(\\psi)$:\n$$ \\mathbf{B} = \\frac{F(\\psi)}{R} \\hat{\\phi} + \\frac{1}{R} \\nabla \\psi \\times \\hat{\\phi} $$\nwhere $R$ is the major radius coordinate. The quantity $\\psi$ is constant on a magnetic flux surface. The pressure $p$ is also a flux function, $p=p(\\psi)$.\n\nSubstituting this form of $\\mathbf{B}$ into the equilibrium condition yields the Grad-Shafranov equation:\n$$ \\Delta^* \\psi = -\\mu_{0} R^{2} \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi} $$\nwhere $\\Delta^* = R \\frac{\\partial}{\\partial R}\\left( \\frac{1}{R} \\frac{\\partial}{\\partial R} \\right) + \\frac{\\partial^2}{\\partial Z^2}$ is the Grad-Shafranov operator in cylindrical coordinates $(R, \\phi, Z)$.\nThe equation can also be written as:\n$$ \\Delta^* \\psi = -\\mu_{0} R^{2} p'(\\psi) - \\frac{1}{2} \\frac{dF^{2}(\\psi)}{d\\psi} $$\n\nWe are given the following problem-specific information and approximations:\n1.  **Large-aspect-ratio tokamak**: The major radius $R$ anywhere within the plasma can be approximated by the constant major radius of the magnetic axis, $R \\approx R_{0}$.\n2.  **Circular, nested flux surfaces**: The poloidal flux $\\psi$ is a function of the minor radius $r$ only, i.e., $\\psi = \\psi(r)$.\n3.  **Functional forms**:\n    - $F^{2}(\\psi) = F_{0}^{2} - 2 \\lambda \\psi$\n    - $p'(\\psi)$ is specified for two cases.\n\nUnder these approximations, a local coordinate system $(r, \\theta)$ centered on the magnetic axis is used, where $R = R_{0} + r \\cos\\theta$ and $Z = r \\sin\\theta$. For $r \\ll R_{0}$, the operator $\\Delta^*$ simplifies to the standard Laplacian in polar coordinates:\n$$ \\Delta^* \\psi \\approx \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left( r \\frac{\\partial \\psi}{\\partial r} \\right) + \\frac{1}{r^{2}} \\frac{\\partial^2 \\psi}{\\partial \\theta^2} $$\nSince we assume $\\psi = \\psi(r)$, the derivative with respect to $\\theta$ vanishes, and the operator becomes:\n$$ \\Delta^* \\psi \\approx \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) $$\nFrom the given form of $F^{2}(\\psi)$, we compute its derivative:\n$$ \\frac{dF^{2}}{d\\psi} = \\frac{d}{d\\psi}(F_{0}^{2} - 2 \\lambda \\psi) = -2 \\lambda $$\nSubstituting these expressions into the Grad-Shafranov equation and using $R \\approx R_{0}$:\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = -\\mu_{0} R_{0}^{2} p'(\\psi) - \\frac{1}{2} (-2 \\lambda) $$\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = -\\mu_{0} R_{0}^{2} p'(\\psi) + \\lambda $$\nThis is the reduced one-dimensional axisymmetric equilibrium equation for $\\psi(r)$.\n\n### Step 2: Solve for the Two Cases and Compute the Safety Factor\n\nThe safety factor $q$ is defined for large aspect ratio and circular flux surfaces as:\n$$ q(r) \\approx \\frac{r B_{\\phi}}{R_{0} B_{\\theta}} $$\nWe are given the expressions $B_{\\phi} = F(\\psi)/R \\approx F(\\psi)/R_{0}$ and the poloidal field $B_{\\theta} \\approx B_{p} \\approx \\frac{1}{R_{0}} \\frac{d\\psi}{dr}$. Substituting these into the formula for $q$:\n$$ q(r) \\approx \\frac{r (F(\\psi)/R_{0})}{R_{0} (\\frac{1}{R_{0}} \\frac{d\\psi}{dr})} = \\frac{r F(\\psi)}{R_{0} \\frac{d\\psi}{dr}} $$\nTo find $q(\\psi)$, we first need to determine $\\frac{d\\psi}{dr}$ by solving the reduced equilibrium equation for each case.\n\nWe integrate the reduced equation with respect to $r$:\n$$ \\int_{0}^{r} \\frac{d}{ds}\\left( s \\frac{d\\psi}{ds} \\right) ds = \\int_{0}^{r} s \\big( -\\mu_{0} R_{0}^{2} p'(\\psi(s)) + \\lambda \\big) ds $$\n$$ r \\frac{d\\psi}{dr} = \\int_{0}^{r} s \\big( -\\mu_{0} R_{0}^{2} p'(\\psi(s)) + \\lambda \\big) ds $$\nThe constant of integration is zero due to the regularity condition at the magnetic axis ($r=0$), which requires the poloidal field $B_{\\theta}$ to be zero, hence $\\frac{d\\psi}{dr}(0)=0$.\n\n**Case 1: Current-driven equilibrium, $p'(\\psi) = 0$.**\n\nThe reduced equation becomes:\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = \\lambda $$\nIntegrating once from $0$ to $r$:\n$$ r \\frac{d\\psi}{dr} = \\int_{0}^{r} \\lambda s \\, ds = \\frac{\\lambda r^{2}}{2} $$\nSolving for $\\frac{d\\psi}{dr}$:\n$$ \\frac{d\\psi}{dr} = \\frac{\\lambda r}{2} $$\nNow, we substitute this into the expression for the safety factor:\n$$ q_{\\mathrm{current}}(r) = \\frac{r F(\\psi)}{R_{0} (\\frac{\\lambda r}{2})} = \\frac{2 F(\\psi)}{R_{0} \\lambda} $$\nSince $F(\\psi) = \\sqrt{F_{0}^{2} - 2\\lambda\\psi}$, the safety factor profile as a function of $\\psi$ is:\n$$ q_{\\mathrm{current}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{\\lambda R_{0}} $$\n\n**Case 2: Pressure-driven equilibrium, $p'(\\psi) = -\\alpha$.**\n\nThe reduced equation becomes:\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = -\\mu_{0} R_{0}^{2} (-\\alpha) + \\lambda = \\mu_{0} R_{0}^{2} \\alpha + \\lambda $$\nThe right-hand side is a constant. Let's define $C = \\lambda + \\mu_{0} R_{0}^{2} \\alpha$.\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = C $$\nThis equation has the same form as in Case 1, with $\\lambda$ replaced by $C$. Integrating from $0$ to $r$:\n$$ r \\frac{d\\psi}{dr} = \\int_{0}^{r} C s \\, ds = \\frac{C r^{2}}{2} $$\nSolving for $\\frac{d\\psi}{dr}$:\n$$ \\frac{d\\psi}{dr} = \\frac{C r}{2} = \\frac{(\\lambda + \\mu_{0} R_{0}^{2} \\alpha) r}{2} $$\nSubstitute this into the expression for the safety factor:\n$$ q_{\\mathrm{pressure}}(r) = \\frac{r F(\\psi)}{R_{0} \\frac{(\\lambda + \\mu_{0} R_{0}^{2} \\alpha) r}{2}} = \\frac{2 F(\\psi)}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)} $$\nExpressing this in terms of $\\psi$:\n$$ q_{\\mathrm{pressure}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)} $$\n\n### Step 3: Final Answer Formulation\n\nThe final answer requires a two-entry row matrix containing the expressions for $q_{\\mathrm{current}}(\\psi)$ and $q_{\\mathrm{pressure}}(\\psi)$.\n\nThe first entry is for the current-driven case ($p'(\\psi)=0$):\n$$ q_{\\mathrm{current}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{\\lambda R_{0}} $$\nThe second entry is for the pressure-driven case ($p'(\\psi)=-\\alpha$):\n$$ q_{\\mathrm{pressure}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)} $$\n\nThese two expressions form the final answer.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{\\lambda R_{0}} & \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A physically realistic plasma equilibrium cannot exist in isolation; it must be in force balance with the external magnetic fields that confine it. This exercise shifts our focus from the plasma interior to the critical plasma-vacuum interface . Starting from the fundamental ideal MHD momentum balance, you will derive the universal pressure balance condition that must be satisfied at the boundary, demonstrating how the plasma pressure is contained by a jump in the magnetic pressure.",
            "id": "3721291",
            "problem": "Consider a large-aspect-ratio, axisymmetric toroidal plasma in static ideal magnetohydrodynamic (MHD) equilibrium with a last closed magnetic surface denoted by $\\psi=\\psi_{a}$. Inside the plasma, the static ideal MHD momentum balance holds, and the pressure is a flux function, $p=p(\\psi)$. Outside the plasma, there is a vacuum region in which the magnetic field is current-free and the poloidal flux $\\psi$ satisfies the homogeneous Grad–Shafranov equation. Assume the boundary $\\psi=\\psi_{a}$ is a magnetic surface so that the magnetic field is tangent to it, that is, $\\boldsymbol{B}\\cdot\\boldsymbol{n}=0$ on both sides of the boundary, where $\\boldsymbol{n}$ is the unit normal pointing outward.\n\nLet the plasma pressure on the boundary be a positive constant $p_{a}=p(\\psi_{a})$. The magnitude of the magnetic field on the plasma side of the boundary has a known poloidal variation typical of large-aspect-ratio equilibria,\n$$\nB_{\\text{in}}(\\theta)=B_{0}\\bigl(1-\\epsilon\\cos\\theta\\bigr),\n$$\nwhere $0<\\epsilon\\ll 1$ is a small inverse-aspect-ratio parameter, $B_{0}>0$ is a constant, and $\\theta$ is the poloidal angle. The vacuum region has zero fluid pressure and carries no volume current.\n\nStarting only from the static ideal MHD momentum balance, Maxwell’s equations, and the definition of the Maxwell stress, derive the normal stress continuity condition across the boundary and use $\\boldsymbol{B}\\cdot\\boldsymbol{n}=0$ to show how the vacuum solution enforces pointwise force balance at the edge. Then, evaluate the ratio\n$$\nR(\\theta)\\equiv \\frac{B_{\\text{out}}(\\theta)}{B_{\\text{in}}(\\theta)},\n$$\nwhere $B_{\\text{out}}(\\theta)$ is the magnitude of the vacuum magnetic field just outside the boundary. Your final answer must be a single closed-form analytic expression for $R(\\theta)$ in terms of $p_{a}$, $\\mu_{0}$, $B_{0}$, $\\epsilon$, and $\\theta$. No numerical evaluation is required.",
            "solution": "The fundamental equation governing a static ideal MHD equilibrium is the momentum balance equation, which states that the pressure gradient force is balanced by the Lorentz force:\n$$\n\\nabla p = \\boldsymbol{j} \\times \\boldsymbol{B}\n$$\nwhere $p$ is the plasma pressure, $\\boldsymbol{j}$ is the current density, and $\\boldsymbol{B}$ is the magnetic field. In a static system, Ampere's law relates the current density to the magnetic field:\n$$\n\\nabla \\times \\boldsymbol{B} = \\mu_{0}\\boldsymbol{j}\n$$\nwhere $\\mu_{0}$ is the permeability of free space. We can substitute $\\boldsymbol{j} = \\frac{1}{\\mu_{0}}\\nabla \\times \\boldsymbol{B}$ into the momentum balance equation:\n$$\n\\nabla p = \\frac{1}{\\mu_{0}}(\\nabla \\times \\boldsymbol{B}) \\times \\boldsymbol{B}\n$$\nUsing the vector identity $(\\nabla \\times \\boldsymbol{A}) \\times \\boldsymbol{A} = (\\boldsymbol{A} \\cdot \\nabla)\\boldsymbol{A} - \\frac{1}{2}\\nabla(A^{2})$, where $A=|\\boldsymbol{A}|$, we can rewrite the right-hand side:\n$$\n\\nabla p = \\frac{1}{\\mu_{0}}\\left( (\\boldsymbol{B} \\cdot \\nabla)\\boldsymbol{B} - \\nabla\\left(\\frac{B^{2}}{2}\\right) \\right)\n$$\nThis equation can be rearranged into a divergence form. We can write $\\nabla p = \\nabla \\cdot (p\\boldsymbol{I})$, where $\\boldsymbol{I}$ is the identity tensor. The equation becomes:\n$$\n\\nabla \\cdot (p\\boldsymbol{I}) - \\frac{1}{\\mu_{0}}\\left( (\\boldsymbol{B} \\cdot \\nabla)\\boldsymbol{B} - \\nabla\\left(\\frac{B^{2}}{2}\\right) \\right) = 0\n$$\nRecognizing that the term $\\frac{1}{\\mu_{0}}\\left( (\\boldsymbol{B} \\cdot \\nabla)\\boldsymbol{B} - \\nabla\\left(\\frac{B^{2}}{2}\\right) \\right)$ is the divergence of the magnetic stress tensor, $-\\nabla \\cdot \\boldsymbol{\\sigma}_{M}$, where $\\boldsymbol{\\sigma}_{M} = \\frac{1}{\\mu_{0}}\\left(\\frac{B^{2}}{2}\\boldsymbol{I} - \\boldsymbol{B}\\boldsymbol{B}\\right)$, the momentum equation can be expressed as the divergence of a total stress tensor $\\boldsymbol{T}$ being zero:\n$$\n\\nabla \\cdot \\boldsymbol{T} = 0\n$$\nwhere $\\boldsymbol{T}$ is the sum of the fluid pressure tensor $p\\boldsymbol{I}$ and the Maxwell stress tensor $\\boldsymbol{\\sigma}_{M}$ (using the physics convention where pressure is positive):\n$$\n\\boldsymbol{T} = \\left(p + \\frac{B^{2}}{2\\mu_{0}}\\right)\\boldsymbol{I} - \\frac{1}{\\mu_{0}}\\boldsymbol{B}\\boldsymbol{B}\n$$\nTo find the condition across the boundary between the plasma and the vacuum, we integrate $\\nabla \\cdot \\boldsymbol{T} = 0$ over an infinitesimal \"pillbox\" volume $V$ straddling the interface. Applying the divergence theorem, we get:\n$$\n\\int_{V} (\\nabla \\cdot \\boldsymbol{T}) dV = \\oint_{S} (\\boldsymbol{T} \\cdot \\boldsymbol{n}) dS = 0\n$$\nwhere $S$ is the surface of the pillbox and $\\boldsymbol{n}$ is the outward normal from the plasma into the vacuum. As the height of the pillbox shrinks to zero, the integral over the side surfaces vanishes. The integral over the top (vacuum side, area $\\Delta A$) and bottom (plasma side, area $\\Delta A$) surfaces remains, leading to the jump condition:\n$$\n[[\\boldsymbol{T} \\cdot \\boldsymbol{n}]] = 0\n$$\nwhere $[[X]] \\equiv X_{\\text{out}} - X_{\\text{in}}$ denotes the jump in the quantity $X$ across the interface. Substituting the expression for $\\boldsymbol{T}$:\n$$\n\\left[\\left[\\left(p + \\frac{B^{2}}{2\\mu_{0}}\\right)\\boldsymbol{n} - \\frac{1}{\\mu_{0}}\\boldsymbol{B}(\\boldsymbol{B} \\cdot \\boldsymbol{n})\\right]\\right] = 0\n$$\nThe problem states that the boundary is a magnetic surface, so the magnetic field is everywhere tangent to it. This implies that the normal component of the magnetic field is zero on both sides of the interface: $\\boldsymbol{B}_{\\text{in}} \\cdot \\boldsymbol{n} = 0$ and $\\boldsymbol{B}_{\\text{out}} \\cdot \\boldsymbol{n} = 0$. Consequently, the term $\\frac{1}{\\mu_{0}}\\boldsymbol{B}(\\boldsymbol{B} \\cdot \\boldsymbol{n})$ vanishes on both sides. The jump condition simplifies to:\n$$\n\\left[\\left[\\left(p + \\frac{B^{2}}{2\\mu_{0}}\\right)\\boldsymbol{n}\\right]\\right] = \\left( \\left(p_{\\text{out}} + \\frac{B_{\\text{out}}^{2}}{2\\mu_{0}}\\right) - \\left(p_{\\text{in}} + \\frac{B_{\\text{in}}^{2}}{2\\mu_{0}}\\right) \\right) \\boldsymbol{n} = 0\n$$\nSince $\\boldsymbol{n}$ is a non-zero normal vector, the scalar coefficient must be zero. This gives the normal stress continuity condition across the boundary:\n$$\np_{\\text{out}} + \\frac{B_{\\text{out}}^{2}}{2\\mu_{0}} = p_{\\text{in}} + \\frac{B_{\\text{in}}^{2}}{2\\mu_{0}}\n$$\nThis equation represents the pointwise force balance at the plasma-vacuum interface. The total pressure, which is the sum of the thermodynamic pressure $p$ and the magnetic pressure $B^{2}/(2\\mu_{0})$, must be continuous across the boundary.\n\nNow, we apply the specific conditions given in the problem. The pressure on the plasma side of the boundary is $p_{\\text{in}} = p_{a}$. The region outside is a vacuum, so the pressure there is $p_{\\text{out}} = 0$. The magnetic field magnitudes on the inner and outer surfaces of the boundary are $B_{\\text{in}}(\\theta)$ and $B_{\\text{out}}(\\theta)$, respectively. The balance equation becomes:\n$$\n0 + \\frac{B_{\\text{out}}^{2}(\\theta)}{2\\mu_{0}} = p_{a} + \\frac{B_{\\text{in}}^{2}(\\theta)}{2\\mu_{0}}\n$$\nWe need to find the ratio $R(\\theta) \\equiv \\frac{B_{\\text{out}}(\\theta)}{B_{\\text{in}}(\\theta)}$. From the pressure balance equation, we solve for $B_{\\text{out}}^{2}(\\theta)$:\n$$\nB_{\\text{out}}^{2}(\\theta) = 2\\mu_{0} p_{a} + B_{\\text{in}}^{2}(\\theta)\n$$\nNow, we can compute the square of the ratio $R(\\theta)$:\n$$\nR^{2}(\\theta) = \\frac{B_{\\text{out}}^{2}(\\theta)}{B_{\\text{in}}^{2}(\\theta)} = \\frac{2\\mu_{0} p_{a} + B_{\\text{in}}^{2}(\\theta)}{B_{\\text{in}}^{2}(\\theta)} = 1 + \\frac{2\\mu_{0} p_{a}}{B_{\\text{in}}^{2}(\\theta)}\n$$\nSince the magnetic field magnitude must be positive, we take the positive square root:\n$$\nR(\\theta) = \\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{B_{\\text{in}}^{2}(\\theta)}}\n$$\nFinally, we substitute the given expression for the magnetic field on the plasma side of the boundary, $B_{\\text{in}}(\\theta)=B_{0}(1-\\epsilon\\cos\\theta)$:\n$$\nR(\\theta) = \\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{\\left[B_{0}(1-\\epsilon\\cos\\theta)\\right]^{2}}} = \\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{B_{0}^{2}(1-\\epsilon\\cos\\theta)^{2}}}\n$$\nThis is the final closed-form analytic expression for the ratio $R(\\theta)$.",
            "answer": "$$\n\\boxed{\\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{B_{0}^{2}(1-\\epsilon\\cos\\theta)^{2}}}}\n$$"
        },
        {
            "introduction": "While analytical models offer invaluable insight, calculating equilibria for realistic, shaped tokamaks requires powerful numerical techniques. This practice introduces the finite element method (FEM), the workhorse for modern equilibrium solvers . You will translate the Grad-Shafranov partial differential equation into its 'weak form' and construct the discrete matrix system, gaining hands-on experience with the mathematical and computational foundation of the tools used daily in fusion research.",
            "id": "3721297",
            "problem": "You are to derive and implement a finite element discretization for the axisymmetric magnetohydrodynamic equilibrium known as the Grad-Shafranov equation in cylindrical coordinates with radial coordinate $R$ and vertical coordinate $Z$, starting from first principles appropriate to nuclear fusion plasmas. Use the physical starting point of static Magnetohydrodynamics (MHD) equilibrium, where the force balance law is $ \\nabla p = \\mathbf{j} \\times \\mathbf{B} $, together with Ampère's law $ \\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} $ and axisymmetry (no dependence on the toroidal angle). From these, derive the governing Partial Differential Equation (PDE) for the poloidal flux function $ \\psi(R,Z) $ that represents the Grad-Shafranov equilibrium. Then obtain a weak form by multiplying the PDE by an admissible test function $ v(R,Z) $ and integrating over the poloidal cross-section domain, applying integration by parts carefully to isolate stiffness-type terms (containing spatial derivatives of $ \\psi $ and $ v $) and source-type terms (containing prescribed functions and data). Clearly state the resulting weak integrals in terms of $ (R,Z) $ for:\n- the stiffness terms that involve $ \\partial_R \\psi $ and $ \\partial_Z \\psi $ paired against derivatives of $ v $ in $ (R,Z) $, and\n- the source terms driven by radial weighting and profiles of pressure and toroidal field.\n\nDiscretize the weak form using the Finite Element Method (FEM) with first-order (linear) triangular elements over a rectangular domain $ \\Omega = \\{ (R,Z) : R \\in [1,2], Z \\in [0,1] \\} $. Use a mesh of four nodes located at $ (R,Z) = (1,0), (2,0), (1,1), (2,1) $ and two triangles: element $ e_0 $ with nodes $ (1,0),(2,0),(1,1) $ and element $ e_1 $ with nodes $ (2,0),(2,1),(1,1) $. Let the shape functions on each element be $ N_i(R,Z) $ for local node indices $ i \\in \\{1,2,3\\} $, with $ \\psi(R,Z) \\approx \\sum_i \\psi_i N_i(R,Z) $ and $ v(R,Z) = N_j(R,Z) $ serving as test functions. Express the stiffness integrals for the symmetric gradient part $ \\int_{\\Omega} \\left( \\partial_R \\psi \\, \\partial_R v + \\partial_Z \\psi \\, \\partial_Z v \\right) \\, \\mathrm{d}\\Omega $, the non-symmetric first-order term $ \\int_{\\Omega} \\frac{1}{R} \\partial_R \\psi \\, v \\, \\mathrm{d}\\Omega $, and the profile-driven source integrals $ \\int_{\\Omega} s(R,\\psi) \\, v \\, \\mathrm{d}\\Omega $ in terms of $ N_i $, $ \\partial_R N_i $, $ \\partial_Z N_i $. Here let the pressure and toroidal field be parameterized by $ p'(\\psi) = \\alpha $ (constant) and $ F(\\psi) = \\beta \\psi $, so that $ F(\\psi) F'(\\psi) = \\beta^2 \\psi $. With these parameterizations, split the weak form into:\n- a gradient stiffness matrix with entries $ K_{ij} $,\n- a non-symmetric convection-like matrix with entries $ C_{ij} $ arising from the $ (1/R) $ weight times $ \\partial_R \\psi $,\n- a reaction (mass-like) matrix with entries $ M_{ij} $ proportional to $ \\beta^2 $ and the product $ N_i N_j $,\n- and a source vector with entries $ f_j $ containing the term $ \\mu_0 \\alpha R^2 N_j $.\n\nYour program must assemble the global matrices $ K $, $ C $, $ M $ and the global source vector $ f $ for the described mesh using the following element-level formulations:\n- $ K_{ij}^{(e)} = \\int_{e} \\left( \\partial_R N_i \\, \\partial_R N_j + \\partial_Z N_i \\, \\partial_Z N_j \\right) \\, \\mathrm{d}e $,\n- $ C_{ij}^{(e)} = \\int_{e} \\frac{1}{R} \\, \\partial_R N_i \\, N_j \\, \\mathrm{d}e $,\n- $ M_{ij}^{(e)} = \\int_{e} \\frac{1}{2} \\beta^2 \\, N_i \\, N_j \\, \\mathrm{d}e $,\n- $ f_{j}^{(e)} = \\int_{e} \\mu_0 \\alpha R^2 \\, N_j \\, \\mathrm{d}e $.\n\nFor first-order triangles, use the known constant gradients $ \\partial_R N_i = b_i $ and $ \\partial_Z N_i = c_i $ obtained from the coordinates of the triangle, and compute $ K_{ij}^{(e)} = (b_i b_j + c_i c_j) A_e $ exactly, where $ A_e $ is the element area. For $ C_{ij}^{(e)} $ and $ f_j^{(e)} $, evaluate the integrals numerically with a symmetric three-point barycentric quadrature that is exact for quadratic polynomials, using barycentric points $ (1/6, 1/6, 2/3) $, $ (1/6, 2/3, 1/6) $, $ (2/3, 1/6, 1/6) $ with equal weights $ 1/3 $; map those barycentric coordinates to $ (R,Z) $ within each triangle via $ (R,Z) = \\sum_k \\lambda_k (R_k, Z_k) $. For $ M_{ij}^{(e)} $, you may use the exact formula for linear elements $ \\int_{e} N_i N_j \\, \\mathrm{d}e = A_e/6 $ if $ i=j $ and $ A_e/12 $ if $ i \\neq j $.\n\nUse the International System of Units (SI) for all quantities. Take the magnetic permeability $ \\mu_0 = 4 \\pi \\times 10^{-7} $ in SI units. Treat $ \\alpha $ and $ \\beta $ as SI-consistent constants. Your program should assemble the global $ 4 \\times 4 $ matrices $ K $, $ C $, $ M $ and the global $ 4 $-vector $ f $ for the mesh and then output, for each specified test case, the sums of all entries of $ K $, $ C $, $ M $, and the sum of entries of $ f $ as four floating-point numbers. Express the final outputs in SI units as pure decimal numbers (no unit symbols in the output string).\n\nTest Suite:\n- Case $1$: $ \\alpha = 2.0 \\times 10^{4} $, $ \\beta = 0.0 $.\n- Case $2$: $ \\alpha = 0.0 $, $ \\beta = 1.0 $.\n- Case $3$: $ \\alpha = 5.0 \\times 10^{4} $, $ \\beta = 0.5 $.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list of three lists, one per test case. Each inner list must be $ [S_K, S_C, S_M, S_f] $. For example, the output should look like `[[x_1,x_2,x_3,x_4],[y_1,y_2,y_3,y_4],[z_1,z_2,z_3,z_4]]` where each $ x_i, y_i, z_i $ are decimal numbers.",
            "solution": "We begin from the static Magnetohydrodynamics (MHD) equilibrium condition $ \\nabla p = \\mathbf{j} \\times \\mathbf{B} $ and Ampère's law $ \\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} $ with axisymmetry (no toroidal angle dependence). Introduce cylindrical coordinates $ (R,\\phi,Z) $ and the poloidal flux function $ \\psi(R,Z) $ such that the magnetic field decomposes as $ \\mathbf{B} = \\mathbf{B}_{\\text{pol}} + \\mathbf{B}_{\\phi} $, where $ \\mathbf{B}_{\\text{pol}} = \\frac{1}{R} \\nabla \\psi \\times \\hat{\\boldsymbol{\\phi}} $ and $ \\mathbf{B}_{\\phi} = \\frac{F(\\psi)}{R} \\hat{\\boldsymbol{\\phi}} $. The quantities $ p(\\psi) $ and $ F(\\psi) $ are flux functions by axisymmetry. Combining $ \\nabla p = \\mathbf{j} \\times \\mathbf{B} $ and $ \\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} $ with the above representation yields the Grad-Shafranov equation,\n$$\n\\Delta^* \\psi = - \\mu_0 R^2 \\frac{\\mathrm{d} p}{\\mathrm{d}\\psi} - \\frac{1}{2} \\frac{\\mathrm{d} (F^2)}{\\mathrm{d}\\psi},\n$$\nwhere $ \\Delta^* \\psi = R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right ) + \\frac{\\partial^2 \\psi}{\\partial Z^2} = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2} $. This governing equation follows directly from the divergence form $ \\Delta^* \\psi = R \\nabla \\cdot \\left( \\frac{1}{R} \\nabla \\psi \\right ) $ and the axisymmetric force balance with flux functions $ p(\\psi) $ and $ F(\\psi) $.\n\nTo construct the weak form, multiply the PDE by a test function $ v(R,Z) $ and integrate over the poloidal cross-section $ \\Omega $:\n$$\n\\int_{\\Omega} \\left( \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2} \\right) v \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\left( - \\mu_0 R^2 \\frac{\\mathrm{d} p}{\\mathrm{d}\\psi} - \\frac{1}{2} F(\\psi) \\frac{\\mathrm{d} F}{\\mathrm{d}\\psi} \\right) v \\, \\mathrm{d}\\Omega.\n$$\nIntegrating by parts the second derivatives, and assuming Dirichlet-type boundary conditions that eliminate boundary terms, one obtains\n$$\n- \\int_{\\Omega} \\frac{\\partial \\psi}{\\partial R} \\frac{\\partial v}{\\partial R} \\, \\mathrm{d}\\Omega - \\int_{\\Omega} \\frac{\\partial \\psi}{\\partial Z} \\frac{\\partial v}{\\partial Z} \\, \\mathrm{d}\\Omega - \\int_{\\Omega} \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} v \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\left( - \\mu_0 R^2 \\frac{\\mathrm{d} p}{\\mathrm{d}\\psi} - \\frac{1}{2} F(\\psi) \\frac{\\mathrm{d} F}{\\mathrm{d}\\psi} \\right) v \\, \\mathrm{d}\\Omega.\n$$\nMultiplying both sides by $ -1 $ and recognizing the decomposition into stiffness and source parts yields\n$$\n\\int_{\\Omega} \\left( \\frac{\\partial \\psi}{\\partial R} \\frac{\\partial v}{\\partial R} + \\frac{\\partial \\psi}{\\partial Z} \\frac{\\partial v}{\\partial Z} \\right) \\, \\mathrm{d}\\Omega + \\int_{\\Omega} \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} v \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\left( \\mu_0 R^2 \\frac{\\mathrm{d} p}{\\mathrm{d}\\psi} + \\frac{1}{2} F(\\psi) \\frac{\\mathrm{d} F}{\\mathrm{d}\\psi} \\right) v \\, \\mathrm{d}\\Omega.\n$$\nIn this form, the left-hand side contains a symmetric gradient stiffness term and a non-symmetric first-order term, while the right-hand side is a source term that may include a reaction contribution if $ F(\\psi) \\frac{\\mathrm{d}F}{\\mathrm{d}\\psi} $ depends on $ \\psi $.\n\nWe parameterize $ \\frac{\\mathrm{d} p}{\\mathrm{d}\\psi} = \\alpha $ (constant) and $ F(\\psi) = \\beta \\psi $, so $ F(\\psi) \\frac{\\mathrm{d}F}{\\mathrm{d}\\psi} = \\beta^2 \\psi $. Substituting this into the weak form yields\n$$\n\\int_{\\Omega} \\left( \\frac{\\partial \\psi}{\\partial R} \\frac{\\partial v}{\\partial R} + \\frac{\\partial \\psi}{\\partial Z} \\frac{\\partial v}{\\partial Z} \\right) \\, \\mathrm{d}\\Omega + \\int_{\\Omega} \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} v \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\mu_0 \\alpha R^2 v \\, \\mathrm{d}\\Omega + \\int_{\\Omega} \\frac{1}{2} \\beta^2 \\psi v \\, \\mathrm{d}\\Omega.\n$$\nDiscretize $ \\psi $ with linear triangular shape functions on each element $ e $ using $ \\psi \\approx \\sum_i \\psi_i N_i $ and test function $ v = N_j $ for a given node $ j $. The element matrices and vector are then:\n- Gradient stiffness (symmetric) term:\n$$\nK_{ij}^{(e)} = \\int_e \\left( \\partial_R N_i \\, \\partial_R N_j + \\partial_Z N_i \\, \\partial_Z N_j \\right) \\, \\mathrm{d}e.\n$$\nFor linear triangles, the gradients are constants $ \\partial_R N_i = b_i $ and $ \\partial_Z N_i = c_i $, so\n$$\nK_{ij}^{(e)} = (b_i b_j + c_i c_j) A_e,\n$$\nwhere $ A_e $ is the area of element $ e $.\n- First-order non-symmetric term:\n$$\nC_{ij}^{(e)} = \\int_e \\frac{1}{R} \\, \\partial_R N_i \\, N_j \\, \\mathrm{d}e = \\int_e \\frac{1}{R} \\, b_i \\, N_j \\, \\mathrm{d}e.\n$$\nSince $ R $ varies over the element, evaluate with a three-point barycentric quadrature exact to second order. Let barycentric points $ (\\lambda_1,\\lambda_2,\\lambda_3) $ be $ (1/6,1/6,2/3) $, $ (1/6,2/3,1/6) $, $ (2/3,1/6,1/6) $ with weights $ w_q = 1/3 $. The physical coordinates are $ (R_q,Z_q) = \\sum_k \\lambda_k (R_k,Z_k) $. Then\n$$\nC_{ij}^{(e)} \\approx A_e \\sum_{q=1}^3 w_q \\, \\frac{1}{R_q} \\, b_i \\, N_j(\\lambda^{(q)}),\n$$\nwith $ N_j(\\lambda) = \\lambda_j $ for linear barycentric shape functions.\n- Reaction (mass-like) term from $ \\frac{1}{2} \\beta^2 \\psi v $:\n$$\nM_{ij}^{(e)} = \\int_e \\frac{1}{2} \\beta^2 N_i N_j \\, \\mathrm{d}e.\n$$\nFor linear triangles, the exact integrals are well known:\n$$\n\\int_e N_i N_j \\, \\mathrm{d}e = \\begin{cases}\nA_e/6 & \\text{if } i=j,\\\\\nA_e/12 & \\text{if } i \\neq j,\n\\end{cases}\n$$\nhence\n$$\nM_{ij}^{(e)} = \\frac{1}{2} \\beta^2 \\times \\begin{cases}\nA_e/6 & i=j,\\\\\nA_e/12 & i \\neq j.\n\\end{cases}\n$$\n- Source vector from $ \\mu_0 \\alpha R^2 v $:\n$$\nf_{j}^{(e)} = \\int_e \\mu_0 \\alpha R^2 N_j \\, \\mathrm{d}e \\approx A_e \\sum_{q=1}^3 w_q \\, \\mu_0 \\alpha R_q^2 \\, N_j(\\lambda^{(q)}).\n$$\n\nThe global assembly places each element contribution $ K^{(e)}, C^{(e)}, M^{(e)} $ and $ f^{(e)} $ into their corresponding global matrices and vector using the mapping from local node indices $ i,j \\in \\{1,2,3\\} $ to global node indices in $ \\{0,1,2,3\\} $ associated with the mesh nodes $ (R,Z) = (1,0), (2,0), (1,1), (2,1) $. The triangle $ e_0 $ uses the global nodes $ [0,1,2] $, and triangle $ e_1 $ uses $ [1,3,2] $. The element areas are obtained from the determinant formula\n$$\nA_e = \\frac{1}{2} \\left| (R_2-R_1)(Z_3-Z_1) - (R_3-R_1)(Z_2-Z_1) \\right|.\n$$\nThe constant gradients $ b_i, c_i $ for each triangle are found from\n$$\nb_1 = \\frac{Z_2 - Z_3}{2 A_e}, \\quad c_1 = \\frac{R_3 - R_2}{2 A_e}, \\quad\nb_2 = \\frac{Z_3 - Z_1}{2 A_e}, \\quad c_2 = \\frac{R_1 - R_3}{2 A_e}, \\quad\nb_3 = \\frac{Z_1 - Z_2}{2 A_e}, \\quad c_3 = \\frac{R_2 - R_1}{2 A_e}.\n$$\nThe three-point barycentric quadrature of a function $ g $ over triangle $ e $ is\n$$\n\\int_e g(R,Z) \\, \\mathrm{d}e \\approx A_e \\sum_{q=1}^3 w_q \\, g(R_q,Z_q),\n$$\nwith $ w_q = 1/3 $ and $ (R_q,Z_q) $ obtained from the barycentric coordinates $ \\lambda^{(q)} $ and the triangle's node coordinates.\n\nUsing these formulas, the program assembles the global $ 4 \\times 4 $ matrices $ K $, $ C $, $ M $ and the global $ 4 $-vector $ f $ in the International System of Units (SI), with $ \\mu_0 = 4 \\pi \\times 10^{-7} $. For each test case $ (\\alpha,\\beta) $, it computes:\n- $ S_K = \\sum_{i,j} K_{ij} $,\n- $ S_C = \\sum_{i,j} C_{ij} $,\n- $ S_M = \\sum_{i,j} M_{ij} $,\n- $ S_f = \\sum_{j} f_j $.\nThese are reported as pure decimal numbers corresponding to SI units. The three test cases exercise complementary aspects of the formulation: Case $1$ ($ \\beta = 0 $) highlights the source-only loading from the pressure gradient, Case $2$ ($ \\alpha = 0 $) isolates the reaction (mass-like) contribution due to the toroidal field function, and Case $3$ combines both effects.\n\nAlgorithmic outline implemented in the program:\n- Define nodes and elements for the mesh of $ \\Omega $.\n- For each element, compute $ A_e $ and the constants $ b_i, c_i $.\n- Assemble $ K $ using the exact constant-gradient formula.\n- Assemble $ C $ and $ f $ using three-point barycentric quadrature; evaluate $ R $ and $ N_j $ at quadrature points.\n- Assemble $ M $ using the exact linear-element formula for $ \\int N_i N_j $ scaled by $ \\frac{1}{2} \\beta^2 $.\n- For each test case, form the global matrices and vector, compute the sums $ S_K, S_C, S_M, S_f $, and output them in the required single-line list format.\n\nThis design transparently links the physical principles of MHD equilibrium to the discrete operator structure produced by a finite element method on a simple mesh, preserving the $ (R,Z) $ dependence, and demonstrating how axisymmetric weights such as $ 1/R $ and $ R^2 $ enter the stiffness and source terms within the weak form.",
            "answer": "`[[1.0,0.0,0.0,0.007665485966336332],[1.0,0.0,0.25,0.0],[1.0,0.0,0.0625,0.01916371491584083]]`"
        }
    ]
}