{
    "hands_on_practices": [
        {
            "introduction": "The safety factor, $q$, is a cornerstone of tokamak physics, quantifying the pitch of magnetic field lines on a flux surface. Its profile, $q(r)$, is not an independent parameter but is determined by the distribution of plasma current. This exercise provides fundamental practice in connecting a physical source—the toroidal current density—to the resulting magnetic field structure and the $q$-profile, a crucial first step in analyzing any toroidal equilibrium. ",
            "id": "3708367",
            "problem": "In an axisymmetric, large-aspect-ratio circular tokamak, magnetic flux surfaces are nested and labeled by the minor radius $r$ ($0 \\le r \\le a$), where $a$ is the plasma minor radius and $R_0$ is the geometric major radius. The toroidal magnetic field is $B_{\\phi}(R) = B_0 R_0 / R$, with $B_0$ the on-axis toroidal field and $R$ the cylindrical major radius. The poloidal magnetic field arises from the toroidal plasma current density $j_{\\phi}(r)$ via Ampère’s law, so that $B_{\\theta}(r) = \\mu_0 I_p(r)/(2\\pi r)$, where $I_p(r)$ is the current enclosed by the circle of radius $r$. Consider a physically plausible, centrally peaked toroidal current density profile $j_{\\phi}(r) = j_0 \\left(1 - \\frac{r^2}{a^2}\\right)$, for $0 \\le r \\le a$, with total plasma current $I_p \\equiv I_p(a)$.\n\nStarting from the fundamental definition of the tokamak safety factor $q(r)$ as the number of toroidal turns per poloidal turn of a magnetic field line, and using the large-aspect-ratio circular-flux-surface approximation to relate $q(r)$ to magnetic field components on a flux surface, derive a closed-form expression for $q(r)$ in terms of $B_0$, $R_0$, $\\mu_0$, $I_p$, $a$, and $r$. Then compute the radial derivative $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$ to assess the magnetic shear. Use the approximation $R \\approx R_0$ on a given flux surface when evaluating $q(r)$ for large aspect ratio. Express your final results for $q(r)$ and $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$ as closed-form symbolic expressions. No numerical evaluation is required.",
            "solution": "The problem is valid as it is scientifically grounded in tokamak plasma physics, well-posed, and objective. It provides a complete set of definitions and parameters to derive the safety factor $q(r)$ and the magnetic shear $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$.\n\nThe safety factor, $q(r)$, is defined as the number of toroidal turns a magnetic field line makes for each poloidal turn. For a large-aspect-ratio ($R_0 \\gg a$) tokamak with circular flux surfaces, the path of a magnetic field line is described by the differential equation $\\frac{R \\mathrm{d}\\phi}{\\mathrm{d}l_{\\mathrm{pol}}}} = \\frac{B_{\\phi}}{B_{\\theta}}$, where $\\mathrm{d}l_{\\mathrm{pol}}$ is the element of poloidal arc length. For a circular flux surface of minor radius $r$, $\\mathrm{d}l_{\\mathrm{pol}} = r \\mathrm{d}\\theta$. The equation becomes $\\frac{R \\mathrm{d}\\phi}{r \\mathrm{d}\\theta} = \\frac{B_{\\phi}}{B_{\\theta}}$. Rearranging gives the pitch of the field line, $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta} = \\frac{r B_{\\phi}}{R B_{\\theta}}$. The safety factor $q(r)$ is this pitch averaged over the flux surface. For a large-aspect-ratio circular tokamak, we can approximate the major radius $R$ on the flux surface by the geometric major radius $R_0$, and the toroidal field $B_{\\phi}$ by its on-axis value $B_0$. This gives the standard formula:\n$$q(r) \\approx \\frac{r B_0}{R_0 B_{\\theta}(r)}$$\nTo find $q(r)$, we must first determine the poloidal magnetic field, $B_{\\theta}(r)$, which is generated by the toroidal current density $j_{\\phi}(r)$. The problem provides the current density profile:\n$$j_{\\phi}(r) = j_0 \\left(1 - \\frac{r^2}{a^2}\\right)$$\nThe current $I_p(r)$ enclosed within a radius $r$ is found by integrating $j_{\\phi}(r)$ over the circular cross-section:\n$$I_p(r) = \\int_0^r j_{\\phi}(r') 2\\pi r' \\mathrm{d}r' = \\int_0^r j_0 \\left(1 - \\frac{(r')^2}{a^2}\\right) 2\\pi r' \\mathrm{d}r'$$\n$$I_p(r) = 2\\pi j_0 \\int_0^r \\left(r' - \\frac{(r')^3}{a^2}\\right) \\mathrm{d}r' = 2\\pi j_0 \\left[ \\frac{(r')^2}{2} - \\frac{(r')^4}{4a^2} \\right]_0^r$$\n$$I_p(r) = 2\\pi j_0 \\left(\\frac{r^2}{2} - \\frac{r^4}{4a^2}\\right) = \\pi j_0 r^2 \\left(1 - \\frac{r^2}{2a^2}\\right)$$\nThe total plasma current $I_p$ is the current enclosed at the plasma edge, $r=a$:\n$$I_p = I_p(a) = \\pi j_0 a^2 \\left(1 - \\frac{a^2}{2a^2}\\right) = \\pi j_0 a^2 \\left(1 - \\frac{1}{2}\\right) = \\frac{\\pi j_0 a^2}{2}$$\nWe can use this relation to express the central current density $j_0$ in terms of the total current $I_p$:\n$$j_0 = \\frac{2 I_p}{\\pi a^2}$$\nSubstituting this expression for $j_0$ back into the equation for $I_p(r)$:\n$$I_p(r) = \\pi \\left(\\frac{2 I_p}{\\pi a^2}\\right) r^2 \\left(1 - \\frac{r^2}{2a^2}\\right) = \\frac{2I_p r^2}{a^2} \\left(\\frac{2a^2 - r^2}{2a^2}\\right) = \\frac{I_p r^2 (2a^2 - r^2)}{a^4}$$\nNow, we use Ampère’s law to find the poloidal magnetic field $B_{\\theta}(r)$:\n$$B_{\\theta}(r) = \\frac{\\mu_0 I_p(r)}{2\\pi r} = \\frac{\\mu_0}{2\\pi r} \\left(\\frac{I_p r^2 (2a^2 - r^2)}{a^4}\\right) = \\frac{\\mu_0 I_p r (2a^2 - r^2)}{2\\pi a^4}$$\nWith this expression for $B_{\\theta}(r)$, we can find the safety factor $q(r)$:\n$$q(r) = \\frac{r B_0}{R_0 B_{\\theta}(r)} = \\frac{r B_0}{R_0 \\left(\\frac{\\mu_0 I_p r (2a^2 - r^2)}{2\\pi a^4}\\right)}$$\n$$q(r) = \\frac{r B_0 \\cdot 2\\pi a^4}{R_0 \\mu_0 I_p r (2a^2 - r^2)} = \\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)}$$\nThis is the closed-form expression for $q(r)$ in terms of the specified parameters.\n\nNext, we compute the magnetic shear, defined as the radial derivative of the safety factor, $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$.\nLet $C = \\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p}$. Then $q(r) = C (2a^2 - r^2)^{-1}$. We use the chain rule for differentiation:\n$$\\frac{\\mathrm{d}q}{\\mathrm{d}r} = \\frac{\\mathrm{d}}{\\mathrm{d}r} \\left[ C (2a^2 - r^2)^{-1} \\right] = C \\cdot (-1) (2a^2 - r^2)^{-2} \\cdot \\frac{\\mathrm{d}}{\\mathrm{d}r}(2a^2 - r^2)$$\n$$\\frac{\\mathrm{d}q}{\\mathrm{d}r} = -C (2a^2 - r^2)^{-2} (-2r) = \\frac{2Cr}{(2a^2 - r^2)^2}$$\nSubstituting the expression for the constant $C$ back into the equation:\n$$\\frac{\\mathrm{d}q}{\\mathrm{d}r} = \\frac{2r}{(2a^2 - r^2)^2} \\left(\\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p}\\right) = \\frac{4\\pi a^4 r B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)^2}$$\nThis is the final expression for the magnetic shear $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)}  \\frac{4\\pi a^4 r B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Beyond the value of the safety factor itself, its radial variation—the magnetic shear—plays a critical role in the stability of a confined plasma. Strong magnetic shear can suppress many magnetohydrodynamic (MHD) instabilities that would otherwise disrupt confinement. This problem focuses on quantifying this important property using a model $q$-profile, allowing you to explore the concept of low-shear regions and understand how they are influenced by the shape of the equilibrium profiles. ",
            "id": "3708353",
            "problem": "Consider an axisymmetric toroidal plasma with nested magnetic flux surfaces labeled by the minor radius $r \\geq 0$. The safety factor $q(r)$, which measures the field-line pitch across flux surfaces, is specified by $q(r) = q_0 + a r^2$ with $q_0  0$ and $a  0$. Starting from the standard definition of the dimensionless magnetic shear used in toroidal confinement, derive the explicit expression for the magnetic shear $\\hat{s}(r)$ as a function of $r$, $q_0$, and $a$. Then, introduce a dimensionless shear threshold $0  \\epsilon  2$ to define the boundary of a low-shear region via the condition $\\hat{s}(r_\\epsilon) = \\epsilon$, and solve for the radius $r_\\epsilon$ of that boundary in closed form. Based on your expression, discuss qualitatively how the size and location of low-shear regions depend on $a$ for fixed $q_0$ and $\\epsilon$. Express your final answer as the pair $\\left(\\hat{s}(r), r_\\epsilon\\right)$ in a closed-form analytic expression. No units are required.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of plasma physics and magnetohydrodynamics, well-posed with sufficient and consistent information, and objectively formulated.\n\nThe first task is to derive the expression for the dimensionless magnetic shear, $\\hat{s}(r)$. The standard definition of magnetic shear in an axisymmetric toroidal device, using the minor radius $r$ as a flux surface label, is given by:\n$$\n\\hat{s}(r) = \\frac{r}{q(r)} \\frac{\\mathrm{d}q(r)}{\\mathrm{d}r}\n$$\nThe problem specifies the safety factor profile as:\n$$\nq(r) = q_0 + a r^2\n$$\nwhere $q_0  0$ and $a  0$ are constants.\n\nFirst, we compute the derivative of $q(r)$ with respect to $r$:\n$$\n\\frac{\\mathrm{d}q(r)}{\\mathrm{d}r} = \\frac{\\mathrm{d}}{\\mathrm{d}r} (q_0 + a r^2) = 2ar\n$$\nNext, we substitute the expressions for $q(r)$ and its derivative into the definition of $\\hat{s}(r)$:\n$$\n\\hat{s}(r) = \\frac{r}{q_0 + a r^2} (2ar)\n$$\nSimplifying this expression yields the magnetic shear profile as a function of $r$:\n$$\n\\hat{s}(r) = \\frac{2ar^2}{q_0 + a r^2}\n$$\nThis is the first part of the required answer.\n\nThe second task is to find the radius $r_\\epsilon$ of the boundary of a low-shear region. This boundary is defined by the condition $\\hat{s}(r_\\epsilon) = \\epsilon$, where $\\epsilon$ is a dimensionless shear threshold satisfying $0  \\epsilon  2$.\n\nWe set our derived expression for $\\hat{s}(r)$ equal to $\\epsilon$ at the radius $r = r_\\epsilon$:\n$$\n\\frac{2ar_\\epsilon^2}{q_0 + a r_\\epsilon^2} = \\epsilon\n$$\nTo solve for $r_\\epsilon$, we rearrange the equation algebraically:\n$$\n2ar_\\epsilon^2 = \\epsilon (q_0 + a r_\\epsilon^2)\n$$\n$$\n2ar_\\epsilon^2 = \\epsilon q_0 + \\epsilon a r_\\epsilon^2\n$$\nGroup the terms containing $r_\\epsilon^2$:\n$$\n2ar_\\epsilon^2 - \\epsilon a r_\\epsilon^2 = \\epsilon q_0\n$$\n$$\n(2a - \\epsilon a) r_\\epsilon^2 = \\epsilon q_0\n$$\n$$\na(2 - \\epsilon) r_\\epsilon^2 = \\epsilon q_0\n$$\nNow, we can isolate $r_\\epsilon^2$:\n$$\nr_\\epsilon^2 = \\frac{\\epsilon q_0}{a(2 - \\epsilon)}\n$$\nSince the minor radius $r$ must be non-negative, we take the positive square root to find $r_\\epsilon$:\n$$\nr_\\epsilon = \\sqrt{\\frac{\\epsilon q_0}{a(2 - \\epsilon)}}\n$$\nThe problem constraints ensure that this solution is physically meaningful. Given $q_0  0$, $a  0$, and $0  \\epsilon  2$, the numerator $\\epsilon q_0$ is positive, and the denominator term $(2 - \\epsilon)$ is also positive. Therefore, the argument of the square root is positive, and a real, positive-valued radius $r_\\epsilon$ exists. The condition $\\epsilon  2$ is necessary because the shear $\\hat{s}(r)$ asymptotically approaches $2$ as $r \\to \\infty$: $\\lim_{r\\to\\infty} \\hat{s}(r) = \\lim_{r\\to\\infty} \\frac{2ar^2}{ar^2(q_0/(ar^2) + 1)} = 2$. Thus, a shear value $\\epsilon \\ge 2$ would never be reached at a finite radius.\n\nThe final task is to provide a qualitative discussion of the dependence of the low-shear region on the parameter $a$, for fixed $q_0$ and $\\epsilon$.\n\nThe magnetic shear $\\hat{s}(r)$ is zero at the magnetic axis ($r=0$) and increases monotonically with $r$, as its derivative $\\frac{\\mathrm{d}\\hat{s}}{\\mathrm{d}r} = \\frac{4arq_0}{(q_0 + ar^2)^2}$ is strictly positive for $r  0$. The low-shear region is therefore the central part of the plasma, defined by the radial interval $[0, r_\\epsilon]$. The \"size\" of this region is characterized by its radius $r_\\epsilon$.\n\nFrom the derived expression for $r_\\epsilon$:\n$$\nr_\\epsilon = \\sqrt{\\frac{\\epsilon q_0}{a(2 - \\epsilon)}}\n$$\nwe can see the relationship between $r_\\epsilon$ and $a$. With $q_0$ and $\\epsilon$ held constant, $r_\\epsilon$ is inversely proportional to the square root of $a$:\n$$\nr_\\epsilon \\propto \\frac{1}{\\sqrt{a}}\n$$\nThis means that as the parameter $a$ increases, the radius $r_\\epsilon$ of the low-shear region's boundary decreases. An increase in $a$ corresponds to a steeper radial increase of the safety factor profile $q(r) = q_0 + ar^2$. A steeper $q$-profile physically implies a stronger magnetic shear. Consequently, for larger values of $a$, the shear threshold $\\epsilon$ is reached at a smaller minor radius. Therefore, increasing $a$ shrinks the size of the low-shear region, confining it more closely to the magnetic axis.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2ar^2}{q_0 + ar^2}  \\sqrt{\\frac{\\epsilon q_0}{a(2 - \\epsilon)}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical models provide invaluable insight, the study of complex magnetic fields in modern fusion devices relies heavily on numerical computation. This practice bridges the gap between theory and application by guiding you through the implementation of a field-line-following code to calculate the rotational transform, $\\iota$. By numerically integrating the path of a field line from its governing differential equations, you will gain a practical understanding of how this key geometric property is determined and how it behaves in the presence of magnetic perturbations. ",
            "id": "3708366",
            "problem": "You are given the task of designing and implementing a field-line-following algorithm to compute the rotational transform on a nested magnetic flux surface in a toroidal confinement device. The domain of the motion is a single, invariant flux surface labeled by a flux coordinate $\\,\\psi\\,$, and the field line is described by a geometric poloidal angle $\\,\\theta\\,$ and a geometric toroidal angle $\\,\\phi\\,$. The rotational transform $\\,\\iota(\\psi)\\,$ is defined as the asymptotic mean poloidal winding per unit toroidal winding along a magnetic field line on the surface. The fundamental base you should start from is: field lines are integral curves of the magnetic field $\\,\\mathbf{B}\\,$, which are tangent to $\\,\\mathbf{B}\\,$ so that $\\,d\\mathbf{x}/ds \\parallel \\mathbf{B}\\,$, and on a flux surface $\\,\\psi=\\mathrm{const}\\,$ they satisfy an angular evolution that can be written as an ordinary differential equation for $\\,\\theta(\\phi)\\,$. The rotational transform is the long-time average\n$$\n\\iota(\\psi)\\equiv \\lim_{\\Delta \\phi \\to \\infty} \\frac{\\Delta \\theta}{\\Delta \\phi}\\,,\n$$\nwhere $\\,\\Delta \\theta\\,$ and $\\,\\Delta \\phi\\,$ are the net poloidal and toroidal angle changes along the same field-line segment on the surface. All angles must be in radians.\n\nTo provide a concrete and testable setting while staying within first-principles reasoning, consider a canonical toy model for the field-line angular dynamics on a given surface:\n$$\n\\frac{d\\theta}{d\\phi} = \\iota_0 + \\varepsilon \\cos\\!\\big(m\\,\\theta - n\\,\\phi\\big)\\,,\n$$\nwhere $\\,\\iota_0\\,$ is the surface’s true rotational transform (a dimensionless constant on the surface), $\\,\\varepsilon\\,$ is a small dimensionless amplitude capturing the non-straightness of the geometric angles with respect to straight-field-line angles, and $\\,m,n\\,$ are integers describing the dominant helical shaping of the surface and field. This model respects that the field line remains on $\\,\\psi=\\mathrm{const}\\,$ and that the additional angle dependence is bounded and periodic. In this model, $\\,\\iota(\\psi)\\,$ is the long-time average of $\\,\\frac{\\mathrm{d}\\theta}{\\mathrm{d}\\phi}\\,$ along a field line.\n\nYour task is to:\n- Derive, from the provided foundational principles, a numerically stable algorithm to estimate $\\,\\iota(\\psi)\\,$ by following a magnetic field line on a given surface and measuring the average $\\,\\Delta \\theta/\\Delta \\phi\\,$ over many toroidal transits. Your derivation must be principle-based and must not assume any shortcut formulas beyond the fundamental definitions above.\n- Implement the algorithm as a program that integrates the ordinary differential equation for $\\,\\theta(\\phi)\\,$ with initial condition $\\,\\theta(\\phi{=}0)=0\\,$ over $\\,N_{\\mathrm{tor}}\\,$ toroidal turns, i.e., $\\,\\phi \\in [0, 2\\pi N_{\\mathrm{tor}}]\\,$. Use a fixed-step, numerically stable method. The recommended estimator for the rotational transform is\n$$\n\\widehat{\\iota} = \\frac{\\theta(2\\pi N_{\\mathrm{tor}})-\\theta(0)}{2\\pi N_{\\mathrm{tor}}}\\,,\n$$\nwhich directly implements the definition of $\\,\\iota(\\psi)\\,$ as a long-time ratio. All angles must be in radians.\n- Ensure your algorithm discusses stability and convergence with respect to the step size in $\\,\\phi\\,$ and the number of toroidal turns $\\,N_{\\mathrm{tor}}\\,$, and reflects this in your implementation choices.\n\nThe input to your algorithm will be a fixed set of test cases, each specified by parameters $\\,(\\iota_0, \\varepsilon, m, n, N_{\\mathrm{tor}})\\,$. The initial condition is always $\\,\\theta(0)=0\\,$. For each test case, your program must output the single estimated float $\\,\\widehat{\\iota}\\,$ computed by your algorithm. There is no external input; all parameters are embedded in your program.\n\nTest Suite:\n- Case $1$ (baseline, straight-field-line limit): $\\iota_0 = 2/3$, $\\varepsilon = 0$, $m=1$, $n=0$, $N_{\\mathrm{tor}}=10$.\n- Case $2$ (non-resonant, irrational baseline with small modulation): $\\iota_0 = \\sqrt{2}-1$, $\\varepsilon = 0.1$, $m=3$, $n=2$, $N_{\\mathrm{tor}}=50$.\n- Case $3$ (non-resonant, moderate modulation): $\\iota_0 = 3/5$, $\\varepsilon = 0.3$, $m=2$, $n=1$, $N_{\\mathrm{tor}}=40$.\n- Case $4$ (near-resonant, locking-prone geometry): $\\iota_0 = 1$, $\\varepsilon = 0.4$, $m=1$, $n=1$, $N_{\\mathrm{tor}}=60$.\n\nAngle unit requirement: All angles $\\,\\theta\\,$ and $\\,\\phi\\,$ are in radians. The rotational transform $\\,\\iota\\,$ is dimensionless.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite, e.g.,\n$$\n[\\widehat{\\iota}_1,\\widehat{\\iota}_2,\\widehat{\\iota}_3,\\widehat{\\iota}_4]\\,.\n$$\n- Each $\\,\\widehat{\\iota}\\,$ must be a float. You may round to a reasonable number of decimal places, but ensure the values reflect convergence to the long-time average as specified.",
            "solution": "The problem requires the design and implementation of an algorithm to compute the rotational transform, $\\widehat{\\iota}$, on a magnetic flux surface. The solution is derived from the fundamental principles provided.\n\nThe rotational transform, $\\iota(\\psi)$, is defined as the asymptotic average rate of change of the poloidal angle, $\\theta$, with respect to the toroidal angle, $\\phi$, along a magnetic field line residing on a constant flux surface $\\psi$. Mathematically, this is given by the limit:\n$$\n\\iota(\\psi) \\equiv \\lim_{\\Delta \\phi \\to \\infty} \\frac{\\Delta \\theta}{\\Delta \\phi}\n$$\nwhere $\\Delta \\theta$ and $\\Delta \\phi$ are the net poloidal and toroidal angular displacements. This limit can be rewritten using the fundamental theorem of calculus as the long-time average of the instantaneous rate of change, $\\frac{\\mathrm{d}\\theta}{\\mathrm{d}\\phi'}$:\n$$\n\\iota(\\psi) = \\lim_{\\Delta\\phi \\to \\infty} \\frac{1}{\\Delta\\phi} \\int_{0}^{\\Delta\\phi} \\frac{\\mathrm{d}\\theta}{\\mathrm{d}\\phi'} \\mathrm{d}\\phi' = \\frac{\\theta(\\Delta\\phi) - \\theta(0)}{\\Delta\\phi}\n$$\nThe problem provides a specific model for the field line dynamics on the flux surface through a first-order ordinary differential equation (ODE):\n$$\n\\frac{\\mathrm{d}\\theta}{\\mathrm{d}\\phi} = f(\\theta, \\phi) = \\iota_0 + \\varepsilon \\cos(m\\theta - n\\phi)\n$$\nwith a specified initial condition $\\theta(\\phi=0) = 0$.\n\nOur task is to compute a numerical estimate of this limit. The problem specifies the estimator $\\widehat{\\iota}$ by replacing the infinite limit with a large, finite integration over $N_{\\mathrm{tor}}$ toroidal turns. The total toroidal angle change is thus $\\Delta\\phi = 2\\pi N_{\\mathrm{tor}}$. The estimator for the rotational transform is:\n$$\n\\widehat{\\iota} = \\frac{\\theta(2\\pi N_{\\mathrm{tor}}) - \\theta(0)}{2\\pi N_{\\mathrm{tor}}}\n$$\nTo compute $\\widehat{\\iota}$, we must first find the value of the poloidal angle $\\theta$ at the final toroidal angle $\\phi_{final} = 2\\pi N_{\\mathrm{tor}}$. This requires solving the initial value problem (IVP) defined by the ODE and the initial condition $\\theta(0)=0$.\n\nA numerical integration method is required because the ODE is generally not solvable analytically. The problem mandates a fixed-step, numerically stable method. The fourth-order Runge-Kutta (RK4) method is an excellent choice, offering a favorable balance of accuracy (global error proportional to $h^4$, where $h$ is the step size) and stability for this class of problem.\n\nThe RK4 algorithm proceeds by discretizing the toroidal angle $\\phi$ into small steps of size $h$. Let $\\phi_i = i \\cdot h$ and $\\theta_i \\approx \\theta(\\phi_i)$. To find $\\theta_{i+1}$ from $\\theta_i$, the RK4 method computes four intermediate slopes:\n\\begin{align*}\nk_1 = h \\cdot f(\\theta_i, \\phi_i) \\\\\nk_2 = h \\cdot f(\\theta_i + k_1/2, \\phi_i + h/2) \\\\\nk_3 = h \\cdot f(\\theta_i + k_2/2, \\phi_i + h/2) \\\\\nk_4 = h \\cdot f(\\theta_i + k_3, \\phi_i + h)\n\\end{align*}\nThe next value of $\\theta$ is then found by a weighted average of these slopes:\n$$\n\\theta_{i+1} = \\theta_i + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\nThe algorithm for computing $\\widehat{\\iota}$ for a given set of parameters $(\\iota_0, \\varepsilon, m, n, N_{\\mathrm{tor}})$ is as follows:\n1.  **Initialization**: Set the initial conditions $\\theta = 0$ and $\\phi = 0$. Define the final toroidal angle $\\phi_{final} = 2\\pi N_{\\mathrm{tor}}$.\n2.  **Discretization**: Choose a step size $h$ that is small enough to resolve the oscillatory term $\\cos(m\\theta - n\\phi)$. A robust approach is to fix the number of integration steps per toroidal turn, $N_{steps\\_per\\_turn}$. A value such as $N_{steps\\_per\\_turn} = 2000$ provides high accuracy. The step size is then $h = 2\\pi / N_{steps\\_per\\_turn}$, and the total number of steps is $N_{total} = N_{\\mathrm{tor}} \\cdot N_{steps\\_per\\_turn}$.\n3.  **Integration**: Starting from $(\\theta, \\phi) = (0, 0)$, iterate $N_{total}$ times. In each iteration, update $\\theta$ and $\\phi$ using the RK4 formulas described above. That is, compute $\\theta_{i+1}$ from $\\theta_i$ and advance $\\phi_i$ to $\\phi_{i+1} = \\phi_i + h$.\n4.  **Final Calculation**: After the final step, the computed value of $\\theta$ is an approximation of $\\theta(2\\pi N_{\\mathrm{tor}})$. Use this final value to calculate the estimator:\n    $$\n    \\widehat{\\iota} = \\frac{\\theta_{final} - 0}{\\phi_{final}} = \\frac{\\theta_{final}}{2\\pi N_{\\mathrm{tor}}}\n    $$\nThis procedure directly implements the definition of the rotational transform as a long-time average, approximated over a finite number of turns, and uses a standard, high-quality numerical method to ensure accuracy and stability, as required. The convergence of $\\widehat{\\iota}$ to a stable value depends on both the number of turns $N_{\\mathrm{tor}}$ (a physical convergence towards the asymptotic limit) and the number of steps per turn (a numerical convergence to the true solution of the ODE for a given $N_{\\mathrm{tor}}$). The parameters provided in the problem, including $N_{\\mathrm{tor}}$, are used as a fixed part of the problem specification.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the rotational transform for a set of test cases by integrating\n    the field line equations using the 4th-order Runge-Kutta method.\n    \"\"\"\n\n    # Define the right-hand side of the ODE: d(theta)/d(phi) = f(theta, phi)\n    def f(theta, phi, iota0, epsilon, m, n):\n        \"\"\"\n        Calculates the rate of change of poloidal angle theta w.r.t. toroidal angle phi.\n        \"\"\"\n        return iota0 + epsilon * np.cos(m * theta - n * phi)\n\n    def calculate_iota_hat(iota0, epsilon, m, n, N_tor):\n        \"\"\"\n        Integrates the ODE for a given test case to find the estimated rotational transform.\n        \n        Args:\n            iota0 (float): Baseline rotational transform.\n            epsilon (float): Perturbation amplitude.\n            m (int): Poloidal mode number.\n            n (int): Toroidal mode number.\n            N_tor (int): Number of toroidal turns for integration.\n\n        Returns:\n            float: The estimated rotational transform iota_hat.\n        \"\"\"\n        # Initial conditions\n        theta_0 = 0.0\n        phi_0 = 0.0\n        \n        # Integration parameters\n        phi_final = 2.0 * np.pi * N_tor\n        \n        # Numerical stability and accuracy are ensured by using a sufficient number\n        # of steps per toroidal turn. 2000 steps provide good convergence.\n        N_steps_per_turn = 2000\n        N_total_steps = int(N_tor * N_steps_per_turn)\n        \n        # Fixed step size\n        h = (phi_final - phi_0) / N_total_steps\n        \n        # Integration loop using 4th-order Runge-Kutta (RK4)\n        theta = theta_0\n        phi = phi_0\n        \n        for _ in range(N_total_steps):\n            k1 = h * f(theta, phi, iota0, epsilon, m, n)\n            k2 = h * f(theta + 0.5 * k1, phi + 0.5 * h, iota0, epsilon, m, n)\n            k3 = h * f(theta + 0.5 * k2, phi + 0.5 * h, iota0, epsilon, m, n)\n            k4 = h * f(theta + k3, phi + h, iota0, epsilon, m, n)\n            \n            theta += (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0\n            phi += h\n        \n        # Final estimator for the rotational transform\n        iota_hat = (theta - theta_0) / phi_final\n        \n        return iota_hat\n\n    # Test suite as specified in the problem statement\n    test_cases = [\n        # Case 1: (iota0, epsilon, m, n, N_tor)\n        (2.0/3.0, 0.0, 1, 0, 10),\n        # Case 2\n        (np.sqrt(2.0) - 1.0, 0.1, 3, 2, 50),\n        # Case 3\n        (3.0/5.0, 0.3, 2, 1, 40),\n        # Case 4\n        (1.0, 0.4, 1, 1, 60),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_iota_hat(*case)\n        results.append(result)\n\n    # Format the final output string as a list of floats\n    # Rounded to 8 decimal places for consistent output\n    output_str = f\"[{','.join(f'{r:.8f}' for r in results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}