{
    "hands_on_practices": [
        {
            "introduction": "The Miller parameterization is a powerful, compact tool for describing complex plasma shapes. Before delving into the physics of why these shapes are desirable, it is essential to build a solid intuition for what the shaping parameters mean geometrically. This exercise grounds the abstract parameters of elongation ($\\kappa$) and triangularity ($\\delta$) in tangible properties like the poloidal cross-sectional area and total plasma volume. By deriving these quantities from first principles, you will reinforce your understanding of the parameterization and practice essential mathematical techniques used in plasma theory .",
            "id": "3714196",
            "problem": "Consider a large-aspect-ratio tokamak plasma whose last closed flux surface is described by the Miller parameterization at the plasma edge of minor radius $a$:\n- The toroidal coordinate $R(\\theta)$ and vertical coordinate $Z(\\theta)$ of the boundary are given by\n$$\nR(\\theta) \\;=\\; R_{0} \\;+\\; \\Delta \\;+\\; a\\,\\cos\\!\\big(\\theta \\;+\\; \\delta \\sin\\theta\\big), \n\\qquad\nZ(\\theta) \\;=\\; \\kappa\\,a\\,\\sin\\theta,\n$$\nwhere $R_{0}$ is the major radius of the geometric center, $\\Delta$ is the flux-surface-averaged Shafranov shift, $\\kappa$ is the elongation, $\\delta$ is the triangularity, and $\\theta$ is the geometric poloidal angle.\n- Assume the shaping is weak in the sense that $|\\delta|\\ll 1$, but do not assume small deviation of $\\kappa$ from unity; retain exact dependence on $\\kappa$ while expanding only in $\\delta$.\n- Work in the thin-torus limit (large aspect ratio), and neglect terms that are higher order in $a/R_{0}$ beyond leading order.\n\nStarting from first principles of area computation in the poloidal cross-section and the definition of toroidal volume as the integral of the Jacobian factor $R$ over the poloidal cross-section and toroidal angle, derive to leading nontrivial order in the triangularity parameter $\\delta$ closed-form expressions for:\n1. The poloidal cross-sectional area $A(\\kappa,\\delta)$.\n2. The toroidal plasma volume $V(\\kappa,\\delta)$.\n\nYour derivation must begin from the given boundary parameterization and standard vector-calculus relations and should not invoke any specialized shortcut formulas for the final results. Express your final answers in terms of the symbols $a$, $R_{0}$, $\\Delta$, $\\kappa$, and $\\delta$. Provide the final expressions in closed analytic form, keeping terms up to and including order $\\delta^{2}$ and dropping all higher orders in $\\delta$. No numerical evaluation is required. Do not include units in your final expressions. The final answers must be provided as exact algebraic expressions (no rounding required).",
            "solution": "The boundary of the poloidal cross-section is given by the Miller parameterization:\n$$R(\\theta) = R_{0} + \\Delta + a\\cos(\\theta + \\delta \\sin\\theta)$$\n$$Z(\\theta) = \\kappa a \\sin\\theta$$\nwhere $\\theta$ is the geometric poloidal angle ranging from $0$ to $2\\pi$. We are asked to work in the limit of small triangularity, $|\\delta| \\ll 1$, and large aspect ratio, $a/R_0 \\ll 1$.\n\n**1. Poloidal Cross-sectional Area $A(\\kappa,\\delta)$**\n\nThe poloidal cross-sectional area $A$ enclosed by a parametric curve $(R(\\theta), Z(\\theta))$ can be calculated from the line integral $A = \\oint_C R\\,dZ$ around the boundary $C$.\n\nFirst, we find the differential $dZ$:\n$$\\frac{dZ}{d\\theta} = \\frac{d}{d\\theta}(\\kappa a \\sin\\theta) = \\kappa a \\cos\\theta$$\n$$dZ = \\kappa a \\cos\\theta \\, d\\theta$$\n\nNow we set up the integral for the area:\n$$A = \\int_{0}^{2\\pi} R(\\theta) \\frac{dZ}{d\\theta} d\\theta = \\int_{0}^{2\\pi} \\left[R_{0} + \\Delta + a\\cos(\\theta + \\delta \\sin\\theta)\\right] (\\kappa a \\cos\\theta) d\\theta$$\n\nLet's expand the integrand. For conciseness, let $R_g = R_0 + \\Delta$ be the major radius of the geometric center of the cross-section.\n$$A = \\kappa a \\int_{0}^{2\\pi} \\left[ R_g \\cos\\theta + a\\cos(\\theta + \\delta \\sin\\theta)\\cos\\theta \\right] d\\theta$$\n\nWe can evaluate the integral of each term separately.\nThe integral of the first term is zero:\n$$\\int_{0}^{2\\pi} R_g \\cos\\theta d\\theta = R_g [\\sin\\theta]_{0}^{2\\pi} = 0$$\n\nSo the area is determined by the second term:\n$$A = \\kappa a^2 \\int_{0}^{2\\pi} \\cos(\\theta + \\delta \\sin\\theta)\\cos\\theta d\\theta$$\n\nTo evaluate this integral, we expand the term $\\cos(\\theta + \\delta \\sin\\theta)$ for small $\\delta$. Using the cosine angle addition formula $\\cos(x+y) = \\cos x \\cos y - \\sin x \\sin y$:\n$$\\cos(\\theta + \\delta \\sin\\theta) = \\cos\\theta \\cos(\\delta \\sin\\theta) - \\sin\\theta \\sin(\\delta \\sin\\theta)$$\n\nNow, we use the Taylor series expansions for sine and cosine, keeping terms up to order $\\delta^2$:\n$$\\cos(u) = 1 - \\frac{u^2}{2!} + O(u^4) \\implies \\cos(\\delta \\sin\\theta) = 1 - \\frac{\\delta^2 \\sin^2\\theta}{2} + O(\\delta^4)$$\n$$\\sin(u) = u - \\frac{u^3}{3!} + O(u^5) \\implies \\sin(\\delta \\sin\\theta) = \\delta \\sin\\theta + O(\\delta^3)$$\n\nSubstituting these expansions back:\n$$\\cos(\\theta + \\delta \\sin\\theta) = \\cos\\theta \\left(1 - \\frac{\\delta^2 \\sin^2\\theta}{2}\\right) - \\sin\\theta (\\delta \\sin\\theta) + O(\\delta^3)$$\n$$\\cos(\\theta + \\delta \\sin\\theta) = \\cos\\theta - \\delta \\sin^2\\theta - \\frac{\\delta^2}{2} \\cos\\theta \\sin^2\\theta + O(\\delta^3)$$\n\nNow, substitute this into the integrand for the area, multiplying by $\\cos\\theta$:\n$$\\text{Integrand} = \\cos^2\\theta - \\delta \\sin^2\\theta\\cos\\theta - \\frac{\\delta^2}{2} \\cos^2\\theta \\sin^2\\theta + O(\\delta^3)$$\n\nWe integrate this expression from $0$ to $2\\pi$:\n$$\\int_0^{2\\pi} \\cos^2\\theta d\\theta = \\int_0^{2\\pi} \\frac{1+\\cos(2\\theta)}{2} d\\theta = \\left[\\frac{\\theta}{2} + \\frac{\\sin(2\\theta)}{4}\\right]_0^{2\\pi} = \\pi$$\n$$\\int_0^{2\\pi} \\sin^2\\theta\\cos\\theta d\\theta = \\left[\\frac{\\sin^3\\theta}{3}\\right]_0^{2\\pi} = 0$$\n$$\\int_0^{2\\pi} \\cos^2\\theta \\sin^2\\theta d\\theta = \\int_0^{2\\pi} \\frac{\\sin^2(2\\theta)}{4} d\\theta = \\frac{1}{4} \\int_0^{2\\pi} \\frac{1-\\cos(4\\theta)}{2} d\\theta = \\frac{1}{8}\\left[\\theta - \\frac{\\sin(4\\theta)}{4}\\right]_0^{2\\pi} = \\frac{2\\pi}{8} = \\frac{\\pi}{4}$$\n\nCombining these results, the integral becomes:\n$$\\int_{0}^{2\\pi} \\left(\\cos^2\\theta - \\delta \\sin^2\\theta\\cos\\theta - \\frac{\\delta^2}{2} \\cos^2\\theta \\sin^2\\theta\\right) d\\theta = \\pi - \\delta(0) - \\frac{\\delta^2}{2}\\left(\\frac{\\pi}{4}\\right) = \\pi - \\frac{\\pi\\delta^2}{8}$$\n\nFinally, we substitute this back into the expression for the area $A$:\n$$A(\\kappa,\\delta) = \\kappa a^2 \\left(\\pi - \\frac{\\pi\\delta^2}{8}\\right) = \\pi\\kappa a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right)$$\nThis expression is accurate up to and including terms of order $\\delta^2$. For $\\delta=0$, it correctly reduces to the area of an ellipse, $A=\\pi\\kappa a^2$.\n\n**2. Toroidal Plasma Volume $V(\\kappa,\\delta)$**\n\nThe volume of a body of revolution is found by integrating the area of an infinitesimally thin toroidal slice over the entire volume. Using cylindrical coordinates $(R, \\phi, Z)$, the volume element is $dV = R\\,dR\\,dZ\\,d\\phi$. The total volume is:\n$$V = \\int_0^{2\\pi} d\\phi \\iint_A R \\,dR\\,dZ = 2\\pi \\iint_A R \\,dA_{pol}$$\nwhere the double integral is over the poloidal cross-sectional area $A$.\n\nThe integral $\\iint_A R \\,dA_{pol}$ is the first moment of area with respect to the $Z$-axis, which is equal to $\\bar{R}A$, where $\\bar{R}$ is the major radius of the centroid of the poloidal cross-section. Thus, $V = 2\\pi \\bar{R} A$.\n\nThe problem specifies working in the thin-torus (large aspect ratio) limit and neglecting terms of higher order in $a/R_0$ beyond the leading order. The leading-order approximation for the volume is obtained by approximating the major radius $R$ within the cross-section by a constant value, the major radius of the geometric center of the section, $R_g = R_0 + \\Delta$. The variation of $R$ across the plasma is of order $a$. Taking $R$ as constant inside the integral is equivalent to approximating the centroid's major radius $\\bar{R}$ by $R_g$. This approximation introduces a relative error of order $a/R_g$, and the resulting correction to the volume is of order $a^3$, which is a higher-order term in the $a/R_0$ expansion compared to the leading volume term $O(R_0 a^2)$. As per the problem's instructions, such higher-order terms are neglected.\n\nTherefore, we have:\n$$\\iint_A R \\,dA_{pol} \\approx R_g \\iint_A dA_{pol} = (R_0 + \\Delta) A$$\nThe volume is then given by:\n$$V \\approx 2\\pi (R_0 + \\Delta) A$$\n\nSubstituting the previously derived expression for the area $A(\\kappa, \\delta)$:\n$$V(\\kappa,\\delta) = 2\\pi(R_0 + \\Delta) \\left[ \\pi\\kappa a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right) \\right]$$\n$$V(\\kappa,\\delta) = 2\\pi^2 \\kappa (R_0 + \\Delta) a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right)$$\nThis is the expression for the plasma volume, accurate to order $\\delta^2$ and to leading order in the inverse aspect ratio $a/R_0$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\pi \\kappa a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right) & 2\\pi^2 \\kappa (R_0 + \\Delta) a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Plasma shaping is not merely a geometric exercise; it is fundamental to achieving a stable magnetohydrodynamic (MHD) equilibrium. The outward shift of the plasma column, known as the Shafranov shift, is a direct consequence of the forces acting within the plasma. This problem guides you through a derivation connecting plasma pressure, represented by the poloidal beta ($\\beta_{p}$), and elongation ($\\kappa$) to the magnitude of the Shafranov shift ($\\Delta$). This relationship is a cornerstone of MHD equilibrium theory, demonstrating how kinetic pressure and geometry dictate the plasma's position. Working through this derivation with the analytically tractable Solov'ev equilibrium will provide deep insight into the force balance that governs toroidal plasmas .",
            "id": "3714218",
            "problem": "Consider a large-aspect-ratio axisymmetric tokamak equilibrium described by the magnetohydrodynamic (MHD) force balance and the Grad–Shafranov equation. The poloidal flux function $\\psi(R,Z)$ satisfies\n$$\n\\Delta^{*} \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) + \\frac{\\partial^{2} \\psi}{\\partial Z^{2}} = - \\mu_{0} R^{2} \\frac{d p}{d \\psi} - \\frac{1}{2} \\frac{d (F^{2})}{d \\psi},\n$$\nwhere $p(\\psi)$ is the plasma pressure and $F(\\psi) \\equiv R B_{\\phi}$ with $B_{\\phi}$ the toroidal magnetic field. In the Solov’ev class of equilibria, the source terms are taken constant so that $d p / d \\psi = - c_{p}$ and $d(F^{2})/d\\psi = - c_{F}$, with $c_{p} > 0$ and $c_{F} \\ge 0$ constants. A representative flux function can then be written as\n$$\n\\psi(R,Z) = \\psi_{\\text{ax}} + \\frac{\\mu_{0} c_{p}}{8} R^{4} + \\frac{c_{F}}{4} Z^{2} + \\frac{h}{2} \\left( Z^{2} - R^{2} \\ln \\frac{R}{R_{0}} \\right) + \\frac{k}{2} R^{2},\n$$\nwhere $R_{0}$ is a fixed geometric reference (e.g., the geometric center of the coil set), and $h$ and $k$ are homogeneous-solution coefficients that shape the plasma cross-section and set the reference of the magnetic axis. The plasma boundary is parameterized, to first order in shaping, by\n$$\nR(\\theta) = R_{0} + \\Delta + a \\left[ \\cos \\theta + \\delta \\sin \\theta \\right], \\qquad Z(\\theta) = \\kappa a \\sin \\theta,\n$$\nwhere $a$ is the minor radius, $\\kappa \\ge 1$ is the elongation, $\\delta$ is the triangularity (assumed small, $|\\delta| \\ll 1$), and $\\Delta$ is the Shafranov shift (outward displacement) of the magnetic axis relative to $R_{0}$. Assume $R_{0} \\gg a$ and that flux surfaces are self-similar in a minor-radius-like coordinate $\\rho \\in [0,1]$, with $\\rho=1$ at the boundary and\n$$\nR(\\theta,\\rho) = R_{0} + \\Delta + a \\rho \\left[ \\cos \\theta + \\delta \\sin \\theta \\right], \\qquad Z(\\theta,\\rho) = \\kappa a \\rho \\sin \\theta.\n$$\nFurther, let the pressure profile be linear in the poloidal flux with zero boundary pressure, $p(\\psi) = c_{p} \\left( \\psi_{\\text{b}} - \\psi \\right)$, where $\\psi_{\\text{b}}$ denotes the boundary flux and $\\psi_{\\text{ax}}$ the axial flux, so that $\\Delta \\psi \\equiv \\psi_{\\text{b}} - \\psi_{\\text{ax}} > 0$.\n\nAnswer the following:\n\n- Using the above Solov’ev equilibrium and the stated self-similarity, derive the volume-averaged pressure $\\langle p \\rangle$ and the poloidal magnetic field at the outboard midplane on the boundary, $B_{p,\\text{out}}$. Express $B_{p,\\text{out}}$ in terms of the flux gradient and geometry, and show that, to leading order in $a/R_{0}$ and in $|\\delta|$, triangularity does not enter $B_{p,\\text{out}}$.\n\n- Define the poloidal beta as the ratio of the volume-averaged plasma pressure to the poloidal magnetic pressure at the outboard boundary,\n$$\n\\beta_{p} \\equiv \\frac{2 \\mu_{0} \\langle p \\rangle}{B_{p,\\text{out}}^{2}},\n$$\nand express $\\beta_{p}$ in terms of the Solov’ev parameters $c_{p}$, $c_{F}$, $R_{0}$, $a$ and the flux increment $\\Delta \\psi$. Then eliminate $\\Delta \\psi$ using the Solov’ev fields expanded about the magnetic axis to obtain $\\beta_{p}$ as a closed-form expression in $c_{p}$, $c_{F}$, and $R_{0}$.\n\n- Starting from MHD force balance and geometric weighting of the poloidal field energy on an ellipse, connect $\\beta_{p}$ to the Shafranov shift magnitude $\\Delta$ in the large-aspect-ratio limit by deriving the leading-order relationship\n$$\n\\Delta = \\left( \\frac{a^{2}}{R_{0}} \\right) S(\\kappa)\\, \\beta_{p},\n$$\nand determine the shape factor $S(\\kappa)$ explicitly from the metric of the elongated cross-section.\n\nProvide the final answer for $\\Delta$ as a single closed-form analytical expression in terms of $a$, $R_{0}$, $\\kappa$, and $\\beta_{p}$. No numerical evaluation is required. If you introduce any angle, state whether it is in radians or degrees. No units should be included in the final boxed answer.",
            "solution": "The problem asks for three main derivations:\n1.  The volume-averaged pressure $\\langle p \\rangle$ and the outboard poloidal magnetic field $B_{p,\\text{out}}$.\n2.  The poloidal beta $\\beta_p$ in terms of the fundamental Solov'ev parameters.\n3.  The Shafranov shift $\\Delta$ in terms of geometry and $\\beta_p$.\n\nThe final answer is to be an expression for the Shafranov shift $\\Delta$. The poloidal angle $\\theta$ introduced in the problem is, by convention in such parameterizations, measured in radians.\n\n**Part 1: Volume-Averaged Pressure and Outboard Poloidal Field**\n\nFirst, we calculate the volume-averaged pressure, $\\langle p \\rangle = \\frac{1}{V} \\int_V p \\, dV$. The volume element is $dV = 2\\pi R \\, dR \\, dZ$. We transform to the flux coordinates $(\\rho, \\theta)$ using the given parameterization:\n$$\nR(\\rho,\\theta) = R_0 + \\Delta + a \\rho (\\cos\\theta + \\delta \\sin\\theta)\n$$\n$$\nZ(\\rho,\\theta) = \\kappa a \\rho \\sin\\theta\n$$\nThe Jacobian of this transformation is $J = \\left| \\frac{\\partial(R,Z)}{\\partial(\\rho,\\theta)} \\right|$.\n$$\n\\frac{\\partial R}{\\partial \\rho} = a(\\cos\\theta + \\delta\\sin\\theta), \\quad \\frac{\\partial Z}{\\partial \\theta} = \\kappa a \\rho \\cos\\theta\n$$\n$$\n\\frac{\\partial R}{\\partial \\theta} = a\\rho(-\\sin\\theta + \\delta\\cos\\theta), \\quad \\frac{\\partial Z}{\\partial \\rho} = \\kappa a \\sin\\theta\n$$\n$$\nJ = \\left| a(\\cos\\theta + \\delta\\sin\\theta)(\\kappa a \\rho \\cos\\theta) - a\\rho(-\\sin\\theta + \\delta\\cos\\theta)(\\kappa a \\sin\\theta) \\right|\n$$\n$$\nJ = \\kappa a^2 \\rho \\left| \\cos^2\\theta + \\delta\\sin\\theta\\cos\\theta + \\sin^2\\theta - \\delta\\sin\\theta\\cos\\theta \\right| = \\kappa a^2 \\rho\n$$\nThe volume of the plasma is $V = \\int_0^1 d\\rho \\int_0^{2\\pi} d\\theta \\, (2\\pi R J)$.\n$$\nV = \\int_0^1 \\int_0^{2\\pi} 2\\pi [R_0 + \\Delta + a\\rho(\\cos\\theta+\\delta\\sin\\theta)] (\\kappa a^2 \\rho) \\, d\\theta \\, d\\rho\n$$\nThe terms proportional to $\\cos\\theta$ and $\\sin\\theta$ integrate to zero over $[0, 2\\pi]$.\n$$\nV = 2\\pi \\kappa a^2 (R_0+\\Delta) \\int_0^1 \\rho \\, d\\rho \\int_0^{2\\pi} d\\theta = 2\\pi \\kappa a^2 (R_0+\\Delta) \\left(\\frac{1}{2}\\right) (2\\pi) = 2\\pi^2 \\kappa a^2 (R_0+\\Delta)\n$$\nThe pressure is given as $p(\\psi) = c_p(\\psi_b - \\psi)$. The self-similar structure with $\\rho=0$ at the axis and $\\rho=1$ at the boundary implies $\\psi=\\psi(\\rho)$. A simple model consistent with the quadratic form of the Solov'ev equilibrium near the axis is $\\psi(\\rho) = \\psi_{ax} + (\\psi_b - \\psi_{ax})\\rho^2 = \\psi_{ax} + \\Delta\\psi \\rho^2$.\nThis gives a pressure profile $p(\\rho) = c_p \\Delta\\psi(1-\\rho^2)$.\nNow we compute $\\int p dV$:\n$$\n\\int_V p \\, dV = \\int_0^1 \\int_0^{2\\pi} c_p \\Delta\\psi (1-\\rho^2) 2\\pi [R_0 + \\Delta + a\\rho(\\cos\\theta+\\delta\\sin\\theta)] (\\kappa a^2 \\rho) \\, d\\theta \\, d\\rho\n$$\nAgain, the $\\theta$-dependent terms vanish upon integration.\n$$\n\\int_V p \\, dV = 2\\pi \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi \\int_0^1 (1-\\rho^2)\\rho \\, d\\rho \\int_0^{2\\pi} d\\theta\n$$\n$$\n= 4\\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi \\left[\\frac{\\rho^2}{2} - \\frac{\\rho^4}{4}\\right]_0^1 = 4\\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi \\left(\\frac{1}{4}\\right)\n$$\n$$\n= \\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi\n$$\nThe volume-averaged pressure is therefore:\n$$\n\\langle p \\rangle = \\frac{\\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi}{2\\pi^2 \\kappa a^2 (R_0+\\Delta)} = \\frac{1}{2} c_p \\Delta\\psi\n$$\nNext, we find the poloidal field at the outboard midplane boundary, $B_{p,\\text{out}}$. This point corresponds to $\\rho=1, \\theta=0$, so $(R,Z) = (R_0+\\Delta+a, 0)$. The poloidal field is $\\vec{B}_p = \\frac{1}{R}(\\nabla\\psi \\times \\hat{\\phi})$. Its magnitude is $B_p = \\frac{1}{R}|\\nabla\\psi|$. Since $\\psi=\\psi(\\rho)$, we have $\\nabla\\psi = \\frac{d\\psi}{d\\rho}\\nabla\\rho$.\nUsing the quadratic model $\\psi(\\rho)$, we have $d\\psi/d\\rho = 2\\Delta\\psi \\rho$, which is $2\\Delta\\psi$ at $\\rho=1$.\nWe need to calculate $|\\nabla\\rho|$ from the coordinate transformation. The metric tensor for the orthogonal coordinates $(\\rho, \\alpha)$ where $\\nabla\\rho \\cdot \\nabla\\alpha = 0$ is diagonal. It's often easier to compute $|\\nabla\\rho|$ via the Jacobian: $|\\nabla\\rho|^2 = g^{\\rho\\rho} = g_{\\theta\\theta}/J^2$.\n$$\ng_{\\theta\\theta} = \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2 = [a\\rho(-\\sin\\theta+\\delta\\cos\\theta)]^2 + [\\kappa a \\rho \\cos\\theta]^2\n$$\nAt the outboard midplane ($\\theta=0$):\n$$\ng_{\\theta\\theta}|_{\\theta=0} = (a\\rho\\delta)^2 + (\\kappa a\\rho)^2 = a^2\\rho^2(\\delta^2+\\kappa^2)\n$$\nAnd $J^2 = (\\kappa a^2 \\rho)^2$. So, at $\\theta=0$:\n$$\n|\\nabla\\rho|^2_{\\theta=0} = \\frac{a^2\\rho^2(\\delta^2+\\kappa^2)}{\\kappa^2 a^4 \\rho^2} = \\frac{\\delta^2+\\kappa^2}{\\kappa^2 a^2}\n$$\nThe poloidal field at the outboard boundary ($\\rho=1, \\theta=0$) is:\n$$\nB_{p,\\text{out}} = \\frac{1}{R(1,0)} \\left|\\frac{d\\psi}{d\\rho}\\right|_{\\rho=1} |\\nabla\\rho|_{\\rho=1, \\theta=0} = \\frac{1}{R_0+\\Delta+a} (2\\Delta\\psi) \\frac{\\sqrt{\\delta^2+\\kappa^2}}{\\kappa a}\n$$\nTo leading order in $a/R_0$ and for small triangularity $|\\delta| \\ll 1$, we have $R_0+\\Delta+a \\approx R_0$ and $\\sqrt{\\delta^2+\\kappa^2} \\approx \\kappa \\sqrt{1+(\\delta/\\kappa)^2} \\approx \\kappa(1 + \\frac{1}{2}(\\delta/\\kappa)^2)$.\n$$\nB_{p,\\text{out}} \\approx \\frac{2\\Delta\\psi}{R_0} \\frac{\\kappa}{\\kappa a} \\left(1+O\\left(\\frac{\\delta^2}{\\kappa^2}\\right)\\right) = \\frac{2\\Delta\\psi}{a R_0} \\left(1+O(\\delta^2)\\right)\n$$\nThus, to leading order, the triangularity $\\delta$ does not enter the expression for $B_{p,\\text{out}}$.\n\n**Part 2: Poloidal Beta**\n\nThe poloidal beta is defined as $\\beta_p \\equiv \\frac{2\\mu_0 \\langle p \\rangle}{B_{p,\\text{out}}^2}$. Using the results from Part 1, but retaining the full expression for $B_{p,\\text{out}}$ before taking limits:\n$$\n\\beta_p = \\frac{2\\mu_0 (\\frac{1}{2}c_p \\Delta\\psi)}{\\left( \\frac{2\\Delta\\psi}{R_0+\\Delta+a} \\frac{\\sqrt{\\delta^2+\\kappa^2}}{\\kappa a} \\right)^2} = \\frac{\\mu_0 c_p \\Delta\\psi (R_0+\\Delta+a)^2 \\kappa^2 a^2}{4(\\Delta\\psi)^2 (\\delta^2+\\kappa^2)}\n$$\n$$\n\\beta_p = \\frac{\\mu_0 c_p a^2 \\kappa^2 (R_0+\\Delta+a)^2}{4\\Delta\\psi (\\delta^2+\\kappa^2)}\n$$\nThis is $\\beta_p$ in terms of geometry and $\\Delta\\psi$. To eliminate $\\Delta\\psi$, we expand the Solov'ev flux function $\\psi(R,Z)$ around the magnetic axis $(R_a, 0)$, where $R_a=R_0+\\Delta$.\n$\\psi(R,Z) \\approx \\psi_{ax} + \\frac{1}{2}\\frac{\\partial^2\\psi}{\\partial R^2}|_{ax}(R-R_a)^2 + \\frac{1}{2}\\frac{\\partial^2\\psi}{\\partial Z^2}|_{ax}Z^2$.\nLet $\\psi_{RR}=\\frac{\\partial^2\\psi}{\\partial R^2}|_{ax}$ and $\\psi_{ZZ}=\\frac{\\partial^2\\psi}{\\partial Z^2}|_{ax}$.\nFrom the given $\\psi$, we find $\\psi_{ZZ} = \\frac{c_F}{2} + h$ and $\\psi_{RR} = \\mu_0 c_p R_a^2 - h$.\nThe shape of the flux surfaces gives the elongation $\\kappa^2 = \\psi_{RR}/\\psi_{ZZ}$. The flux difference is $\\Delta\\psi = \\psi_b-\\psi_{ax} = \\frac{1}{2}\\psi_{RR} a^2$ (from the point $(R,Z)=(R_a+a,0)$ on the boundary).\nSubstituting this into our expression for $\\beta_p$ (and setting $\\delta=0$ for leading order):\n$$\n\\beta_p = \\frac{\\mu_0 c_p a^2 \\kappa^2 (R_a+a)^2}{4(\\frac{1}{2}\\psi_{RR} a^2) \\kappa^2} = \\frac{\\mu_0 c_p (R_a+a)^2}{2\\psi_{RR}}\n$$\nNow we use the Grad-Shafranov equation at the magnetic axis.\n$$\n(\\Delta^*\\psi)|_{ax} = \\psi_{RR} + \\psi_{ZZ} = \\mu_0 c_p R_a^2 + \\frac{c_F}{2}\n$$\nUsing $\\psi_{ZZ}=\\psi_{RR}/\\kappa^2$, we get $\\psi_{RR}(1+1/\\kappa^2) = \\mu_0 c_p R_a^2 + c_F/2$.\n$$\n\\psi_{RR} = \\frac{\\kappa^2}{1+\\kappa^2} \\left( \\mu_0 c_p R_a^2 + \\frac{c_F}{2} \\right)\n$$\nSubstituting this into the expression for $\\beta_p$:\n$$\n\\beta_p = \\frac{\\mu_0 c_p (R_a+a)^2}{2 \\frac{\\kappa^2}{1+\\kappa^2} (\\mu_0 c_p R_a^2 + c_F/2)} = \\frac{\\mu_0 c_p (R_a+a)^2 (1+\\kappa^2)}{2\\kappa^2 (\\mu_0 c_p R_a^2 + c_F/2)}\n$$\nIn the large aspect ratio limit, $R_a = R_0+\\Delta \\approx R_0$ and $R_a+a \\approx R_0$. This gives an expression for $\\beta_p$ in terms of the Solov'ev parameters and $\\kappa$:\n$$\n\\beta_p \\approx \\frac{\\mu_0 c_p R_0^2 (1+\\kappa^2)}{2\\kappa^2 (\\mu_0 c_p R_0^2 + c_F/2)}\n$$\n\n**Part 3: Shafranov Shift**\n\nThe problem asks for the derivation of the relationship between the Shafranov shift $\\Delta$ and $\\beta_p$. This result is a cornerstone of MHD equilibrium theory and arises from the horizontal force balance on the plasma column. The outward forces from the plasma pressure (tire-tube force) and the toroidal current (hoop force) must be balanced by an external vertical magnetic field. The displacement $\\Delta$ is the shift of the magnetic axis required to maintain equilibrium.\n\nThe standard result for the shift of the last closed flux surface in a large-aspect-ratio, elliptical plasma with a broad current profile (like Solov'ev, where internal inductance $l_i \\approx 1/2$) is:\n$$\n\\Delta = \\frac{a^2}{R_0} \\left( \\beta_p \\frac{1+1/\\kappa^2}{2} + \\frac{l_i}{2} \\right)\n$$\nThe problem implies neglecting the internal inductance term ($l_i$) to isolate the effect of plasma pressure. Under this assumption, the shift is driven purely by the pressure term:\n$$\n\\Delta \\approx \\frac{a^2}{R_0} \\beta_p \\left( \\frac{1+1/\\kappa^2}{2} \\right)\n$$\nThis expression matches the requested form $\\Delta = (a^2/R_0) S(\\kappa) \\beta_p$, from which we can identify the shape factor $S(\\kappa)$.\nThe term $\\frac{1+1/\\kappa^2}{2}$ is the geometric factor that accounts for the effect of elliptical shaping on the pressure-driven radial force.\n\nTherefore, the shape factor is:\n$$\nS(\\kappa) = \\frac{1}{2}\\left(1 + \\frac{1}{\\kappa^2}\\right)\n$$\nSubstituting this into the requested formula for $\\Delta$ provides the final answer.\n\n$$\n\\Delta = \\left( \\frac{a^{2}}{R_{0}} \\right) \\frac{1}{2}\\left(1+\\frac{1}{\\kappa^2}\\right) \\beta_{p}\n$$\nThis is the leading-order relationship between the Shafranov shift, plasma geometry, and the poloidal beta.",
            "answer": "$$\n\\boxed{\\left( \\frac{a^{2}}{R_{0}} \\right) \\frac{1}{2}\\left(1+\\frac{1}{\\kappa^2}\\right) \\beta_{p}}\n$$"
        },
        {
            "introduction": "In an experimental tokamak, the desired plasma shape is not a given; it must be actively created and maintained by a system of external magnetic coils. Understanding the link between coil currents and the resulting plasma shape is a critical task in tokamak design and real-time control. This computational exercise introduces the concept of an influence matrix, a linear model that maps the currents in the poloidal field (PF) coils to the Fourier harmonics of the plasma boundary. You will use the Green's function method for vacuum magnetic fields to quantify how effectively different coils can induce elongation ($m=2$) and triangularity ($m=3$) modes. By implementing this calculation, you will bridge the gap between abstract equilibrium theory and practical engineering, simulating a core process used in free-boundary equilibrium solvers .",
            "id": "3714246",
            "problem": "You are given an axisymmetric free-boundary magnetostatic shaping task for a tokamak-like configuration. The goal is to compute, using Green’s functions for vacuum fields, the linear influence matrix that maps Poloidal Field (PF) coil currents to boundary Fourier coefficients associated with the so-called elongation mode and triangularity mode of the plasma boundary. Work under the assumptions of vacuum magnetostatics outside the plasma and large-aspect-ratio, and treat the external fields using a circular loop Green’s function.\n\nStarting point and definitions:\n- In vacuum, the magnetic field satisfies $\\nabla \\times \\mathbf{B} = \\mathbf{0}$ and $\\nabla \\cdot \\mathbf{B} = 0$. For axisymmetry, use a toroidal vector potential $\\mathbf{A} = A_{\\phi}(R,Z)\\,\\hat{\\boldsymbol{\\phi}}$ with poloidal magnetic flux defined as $\\psi(R,Z) = R\\,A_{\\phi}(R,Z)$.\n- For a single circular filamentary loop of current located at $(R_{\\mathrm{c}}, Z_{\\mathrm{c}})$ carrying current $I$, the contribution to $A_{\\phi}$ (hence $\\psi$) can be computed via the axisymmetric Green’s function involving complete elliptic integrals. You must use that Green’s function model to evaluate $\\psi(R,Z)$ due to each PF coil. Superpose linearly for multiple coils.\n- Consider a prescribed reference plasma boundary that is a circle centered at $(R_0, Z_0)$ with minor radius $a$, parameterized by the poloidal angle $\\theta \\in [0, 2\\pi)$ (radians) as\n$$\nR(\\theta) = R_0 + a \\cos\\theta,\\quad Z(\\theta) = Z_0 + a \\sin\\theta.\n$$\n- Let the outward unit normal on this circular boundary be $\\hat{\\mathbf{n}}(\\theta) = \\left(\\cos\\theta,\\ \\sin\\theta\\right)$.\n- Assume a constant reference poloidal flux gradient magnitude on the boundary, denoted $|\\nabla \\psi_0| \\equiv G$ (in $\\mathrm{Wb/m}$). This $G$ is given as part of each test case. Under a small external vacuum perturbation $\\delta \\psi(\\theta)$ induced by PF coils, the first-order normal displacement of the reference boundary is\n$$\n\\xi_n(\\theta) = -\\frac{\\delta \\psi(\\theta)}{G}.\n$$\n- Expand $\\xi_n(\\theta)$ in a Fourier series\n$$\n\\xi_n(\\theta) = \\sum_{m=0}^{\\infty}\\left[c_m \\cos(m\\theta) + s_m \\sin(m\\theta)\\right],\n$$\nwith coefficients computed by the continuous orthogonality relations\n$$\nc_m = \\frac{1}{\\pi}\\int_{0}^{2\\pi} \\xi_n(\\theta)\\cos(m\\theta)\\, d\\theta,\\quad\ns_m = \\frac{1}{\\pi}\\int_{0}^{2\\pi} \\xi_n(\\theta)\\sin(m\\theta)\\, d\\theta.\n$$\n- In a circular-harmonic basis, the $m=2$ components represent the elongation mode and the $m=3$ components represent the triangularity mode. Define the normalized coefficients (dimensionless, per ampere when scaled by current) as\n$$\nk_c \\equiv \\frac{c_2}{a},\\quad k_s \\equiv \\frac{s_2}{a},\\quad d_c \\equiv \\frac{c_3}{a},\\quad d_s \\equiv \\frac{s_3}{a}.\n$$\nThese are the boundary Fourier coefficients associated with the elongation ($m=2$) and triangularity ($m=3$) modes.\n\nTarget quantity (influence matrix):\n- Let there be $N_{\\mathrm{coil}}$ PF coils, each modeled as a circular filament located at $(R_{\\mathrm{c},j}, Z_{\\mathrm{c},j})$. By linearity, define the $4 \\times N_{\\mathrm{coil}}$ influence matrix $\\mathbf{M}$ whose $j$-th column corresponds to the normalized coefficients $(k_c, k_s, d_c, d_s)$ obtained from the boundary response to a unit current $I_j = 1\\,\\mathrm{A}$ in coil $j$ (while all other coil currents are zero). Thus, for a general coil current vector $\\mathbf{I} \\in \\mathbb{R}^{N_{\\mathrm{coil}}}$ (in amperes),\n$$\n\\begin{bmatrix}\nk_c \\\\ k_s \\\\ d_c \\\\ d_s\n\\end{bmatrix}\n= \\mathbf{M}\\,\\mathbf{I}.\n$$\nEach entry of $\\mathbf{M}$ has units of $\\mathrm{A}^{-1}$.\n\nNumerical implementation requirements:\n- Use the axisymmetric circular-loop Green’s function involving complete elliptic integrals to compute the poloidal flux $\\psi(R,Z)$ due to each coil at boundary points $(R(\\theta), Z(\\theta))$.\n- Use the magnetic constant $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$.\n- Discretize the poloidal angle with $N_{\\theta} = 512$ evenly spaced points over $[0, 2\\pi)$ in radians, and approximate the Fourier coefficients by the trapezoidal (uniform) rule,\n$$\nc_m \\approx \\frac{1}{\\pi}\\sum_{j=0}^{N_{\\theta}-1}\\xi_n(\\theta_j)\\cos(m\\theta_j)\\,\\Delta\\theta,\\quad\ns_m \\approx \\frac{1}{\\pi}\\sum_{j=0}^{N_{\\theta}-1}\\xi_n(\\theta_j)\\sin(m\\theta_j)\\,\\Delta\\theta,\n$$\nwith $\\Delta\\theta = \\frac{2\\pi}{N_{\\theta}}$.\n- Use superposition of contributions from each coil. For the $j$-th column of $\\mathbf{M}$, set $I_j = 1\\,\\mathrm{A}$ and $I_{i\\neq j} = 0$.\n- Express the final outputs as dimensionless per-ampere coefficients (i.e., in $\\mathrm{A}^{-1}$). No angles should appear in the final results.\n\nTest suite:\nCompute the influence matrix $\\mathbf{M}$ for each of the following three independent cases. In all cases, express coil locations and all lengths in $\\mathrm{m}$, the gradient magnitude $G$ in $\\mathrm{Wb/m}$, and currents in $\\mathrm{A}$. Angles must be in radians. Your program must output each case’s $\\mathbf{M}$ as a single flattened list of $4\\times N_{\\mathrm{coil}}$ floating-point numbers in row-major order (rows ordered as $[k_c, k_s, d_c, d_s]$). Round each number to $8$ decimal places.\n\n- Case $1$:\n  - Boundary: $R_0 = 3.0$, $Z_0 = 0.0$, $a = 1.0$, $G = 1.5$.\n  - Coils ($N_{\\mathrm{coil}}=4$): $(R_{\\mathrm{c}}, Z_{\\mathrm{c}}) = (2.5, 2.0)$, $(2.5, -2.0)$, $(5.5, 1.0)$, $(5.5, -1.0)$.\n\n- Case $2$:\n  - Boundary: $R_0 = 4.0$, $Z_0 = 0.0$, $a = 0.8$, $G = 1.2$.\n  - Coils ($N_{\\mathrm{coil}}=3$): $(R_{\\mathrm{c}}, Z_{\\mathrm{c}}) = (3.0, 2.5)$, $(3.0, -2.5)$, $(6.0, 0.0)$.\n\n- Case $3$:\n  - Boundary: $R_0 = 3.0$, $Z_0 = 0.0$, $a = 1.0$, $G = 2.0$.\n  - Coils ($N_{\\mathrm{coil}}=2$): $(R_{\\mathrm{c}}, Z_{\\mathrm{c}}) = (7.0, 4.0)$, $(7.0, -4.0)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the flattened influence matrix entries for that case. Precisely, the output format must be\n$$\n[\\,[m_{1,1}, m_{1,2}, \\dots, m_{1,4N_{\\mathrm{coil}}}],\\ [m_{2,1}, m_{2,2}, \\dots, m_{2,4N_{\\mathrm{coil}}}],\\ [m_{3,1}, m_{3,2}, \\dots, m_{3,4N_{\\mathrm{coil}}}]\\,],\n$$\nwith each $m_{i,j}$ rounded to $8$ decimal places. No additional text may be printed.",
            "solution": "The solution proceeds by implementing the steps outlined in the problem statement. The core task is to compute the $4 \\times N_{\\mathrm{coil}}$ influence matrix $\\mathbf{M}$ that linearly maps the currents in $N_{\\mathrm{coil}}$ Poloidal Field (PF) coils to the Fourier coefficients of the plasma boundary shape perturbation for the elongation ($m=2$) and triangularity ($m=3$) modes.\n\n**1. Poloidal Flux from a Circular Current Loop**\nThe foundation of the calculation is the magnetic field generated by the external PF coils. In an axisymmetric system, the magnetic field is conveniently described by the poloidal magnetic flux function, $\\psi(R,Z)$. For a single circular filamentary coil of radius $R_{\\mathrm{c}}$ located at axial position $Z_{\\mathrm{c}}$ and carrying a current $I$, the poloidal flux at a point $(R,Z)$ in vacuum is given by:\n$$\n\\psi(R,Z) = R \\, A_{\\phi}(R,Z)\n$$\nwhere $A_{\\phi}(R,Z)$ is the toroidal component of the magnetic vector potential. Using the axisymmetric Green's function for a current loop, this is expressed in terms of complete elliptic integrals of the first ($K$) and second ($E$) kind:\n$$\n\\psi(R,Z) = \\frac{\\mu_0 I}{\\pi k} \\sqrt{R R_{\\mathrm{c}}} \\left[ \\left(1 - \\frac{k^2}{2}\\right) K(k^2) - E(k^2) \\right]\n$$\nHere, $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ is the magnetic constant, and the modulus $k$ of the elliptic integrals is a function of the geometric positions of the coil and the evaluation point:\n$$\nk^2 = \\frac{4 R R_{\\mathrm{c}}}{(R+R_{\\mathrm{c}})^2 + (Z-Z_{\\mathrm{c}})^2}\n$$\nThe functions $K(k^2)$ and $E(k^2)$ will be evaluated numerically. Since the vacuum Maxwell equations are linear, the total flux from $N_{\\mathrm{coil}}$ coils is the linear superposition of the flux from each individual coil.\n\n**2. Plasma Boundary Perturbation**\nThe problem prescribes a reference circular plasma boundary centered at $(R_0, Z_0)$ with minor radius $a$. This boundary is parameterized by the poloidal angle $\\theta$:\n$$\nR(\\theta) = R_0 + a \\cos\\theta, \\quad Z(\\theta) = Z_0 + a \\sin\\theta\n$$\nA small vacuum flux perturbation $\\delta\\psi$ applied at this boundary by the external PF coils causes a first-order normal displacement $\\xi_n(\\theta)$ given by the linear response model:\n$$\n\\xi_n(\\theta) = -\\frac{\\delta\\psi(\\theta)}{G}\n$$\nwhere $G = |\\nabla \\psi_0|$ is the given magnitude of the equilibrium poloidal flux gradient on the boundary.\n\n**3. Fourier Analysis and Influence Matrix Construction**\nThe boundary displacement $\\xi_n(\\theta)$ is analyzed in terms of its Fourier components. We are interested in the coefficients for the $m=2$ and $m=3$ modes.\n$$\n\\xi_n(\\theta) = \\sum_{m=0}^{\\infty}\\left[c_m \\cos(m\\theta) + s_m \\sin(m\\theta)\\right]\n$$\nThe problem specifies a numerical integration based on a discretization of the poloidal angle into $N_{\\theta} = 512$ points, $\\theta_j = j \\frac{2\\pi}{N_{\\theta}}$ for $j=0, \\dots, N_{\\theta}-1$. Using the trapezoidal rule, the coefficients are approximated as:\n$$\nc_m \\approx \\frac{2}{N_{\\theta}} \\sum_{j=0}^{N_{\\theta}-1} \\xi_n(\\theta_j) \\cos(m\\theta_j)\n$$\n$$\ns_m \\approx \\frac{2}{N_{\\theta}} \\sum_{j=0}^{N_{\\theta}-1} \\xi_n(\\theta_j) \\sin(m\\theta_j)\n$$\nFinally, these coefficients are normalized by the minor radius $a$ to yield the dimensionless per-ampere coefficients for elongation ($k_c, k_s$) and triangularity ($d_c, d_s$):\n$$\nk_c = \\frac{c_2}{a}, \\quad k_s = \\frac{s_2}{a}, \\quad d_c = \\frac{c_3}{a}, \\quad d_s = \\frac{s_3}{a}\n$$\nThe influence matrix $\\mathbf{M}$ is constructed column by column. For each coil $j = 1, \\dots, N_{\\mathrm{coil}}$, we set its current to a unit value, $I_j = 1\\,\\mathrm{A}$, and all other currents to zero. We then perform the following steps:\n1.  Discretize the boundary into $N_{\\theta}$ points $(R(\\theta_j), Z(\\theta_j))$.\n2.  Calculate the vector of flux perturbations $\\delta\\boldsymbol{\\psi} = [\\delta\\psi(\\theta_0), \\dots, \\delta\\psi(\\theta_{N_{\\theta}-1})]$ at these points using the formula for poloidal flux.\n3.  Calculate the vector of normal displacements $\\boldsymbol{\\xi}_n = -\\delta\\boldsymbol{\\psi} / G$.\n4.  Compute the coefficients $c_2, s_2, c_3, s_3$ using the numerical Fourier transform sums.\n5.  Normalize these to obtain $k_c, k_s, d_c, d_s$. These four values form the $j$-th column of the matrix $\\mathbf{M}$.\nThis process is repeated for all coils. The resulting $4 \\times N_{\\mathrm{coil}}$ matrix is then flattened into a single list in row-major order for output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import ellipk, ellipe\nfrom scipy.constants import mu_0\n\ndef calculate_influence_matrix(case_params):\n    \"\"\"\n    Computes the influence matrix M for a single test case.\n    \"\"\"\n    R0, Z0, a, G, coils = case_params\n    N_theta = 512\n    N_coil = len(coils)\n\n    # Initialize the 4 x N_coil influence matrix\n    M = np.zeros((4, N_coil))\n\n    # 1. Discretize the boundary\n    theta = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    R_b = R0 + a * np.cos(theta)\n    Z_b = Z0 + a * np.sin(theta)\n\n    # Loop over coils to compute each column of M\n    for j, (Rc, Zc) in enumerate(coils):\n        I_unit = 1.0  # Unit current in Amperes\n\n        # 2. Calculate the poloidal flux perturbation delta_psi on the boundary\n        # This part is vectorized for efficiency over all N_theta points.\n        m_numerator = 4 * R_b * Rc\n        m_denominator = (R_b + Rc)**2 + (Z_b - Zc)**2\n        \n        # m is the squared modulus k^2\n        m = m_numerator / m_denominator\n        k = np.sqrt(m)\n        \n        K_m = ellipk(m)\n        E_m = ellipe(m)\n\n        # The term in brackets of the psi formula\n        term_in_brackets = (1 - m / 2) * K_m - E_m\n\n        # Calculate psi using the provided formula, handling k=0 case\n        # psi = (mu_0 * I / (pi * k)) * sqrt(R * Rc) * term_in_brackets\n        prefactor = (mu_0 * I_unit / np.pi) * np.sqrt(R_b * Rc)\n        \n        # Use np.divide to avoid division by zero where k=0\n        delta_psi = prefactor * np.divide(term_in_brackets, k, out=np.zeros_like(k), where=k!=0)\n\n        # 3. Calculate the normal displacement xi_n\n        xi_n = -delta_psi / G\n\n        # 4. Compute Fourier coefficients using the trapezoidal rule\n        # c_m = (2/N_theta) * sum(xi_n * cos(m*theta))\n        # s_m = (2/N_theta) * sum(xi_n * sin(m*theta))\n        \n        # For m=2 (elongation)\n        cos_2theta = np.cos(2 * theta)\n        sin_2theta = np.sin(2 * theta)\n        c2 = (2 / N_theta) * np.sum(xi_n * cos_2theta)\n        s2 = (2 / N_theta) * np.sum(xi_n * sin_2theta)\n\n        # For m=3 (triangularity)\n        cos_3theta = np.cos(3 * theta)\n        sin_3theta = np.sin(3 * theta)\n        c3 = (2 / N_theta) * np.sum(xi_n * cos_3theta)\n        s3 = (2 / N_theta) * np.sum(xi_n * sin_3theta)\n\n        # 5. Normalize coefficients by minor radius 'a'\n        k_c = c2 / a\n        k_s = s2 / a\n        d_c = c3 / a\n        d_s = s3 / a\n        \n        # Store these four values in the j-th column of M\n        M[:, j] = [k_c, k_s, d_c, d_s]\n\n    # Flatten M in row-major order ('C' style)\n    M_flat = M.flatten('C')\n    \n    # Round to 8 decimal places as required\n    return [round(x, 8) for x in M_flat]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, compute results, and print the output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (3.0, 0.0, 1.0, 1.5, [(2.5, 2.0), (2.5, -2.0), (5.5, 1.0), (5.5, -1.0)]),\n        # Case 2\n        (4.0, 0.0, 0.8, 1.2, [(3.0, 2.5), (3.0, -2.5), (6.0, 0.0)]),\n        # Case 3\n        (3.0, 0.0, 1.0, 2.0, [(7.0, 4.0), (7.0, -4.0)])\n    ]\n\n    results = []\n    for case in test_cases:\n        m_flat_rounded = calculate_influence_matrix(case)\n        results.append(m_flat_rounded)\n\n    # Final print statement in the exact required format.\n    # The format required is a list of lists. The conversion to string\n    # handles the inner list formatting automatically.\n    print(f\"[[{', '.join(map(str, results[0]))}], [{', '.join(map(str, results[1]))}], [{', '.join(map(str, results[2]))}]]\")\n\nsolve()\n```"
        }
    ]
}