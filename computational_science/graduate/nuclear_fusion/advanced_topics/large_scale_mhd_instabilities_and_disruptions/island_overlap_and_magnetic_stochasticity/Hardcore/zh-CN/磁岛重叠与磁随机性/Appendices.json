{
    "hands_on_practices": [
        {
            "introduction": "磁岛在有理磁面上形成，这些磁面在等离子体中离散分布。要理解磁岛是否会重叠，我们首先需要知道这些有理面彼此之间的距离。这项实践将引导你推导磁剪切与相邻有理面径向间距之间的基本关系()，这是决定等离子体稳定性和输运特性的一个关键因素。",
            "id": "3705821",
            "problem": "考虑一个具有嵌套磁通面的大环径比、轴对称的环形等离子体，其特征由安全因子剖面 $q(r)$ 描述，其中 $r$ 是一个类小半径的磁通面标签。有理面出现在 $q(r)=m/n$ 的位置，其中 $m$ 和 $n$ 是互质整数。磁剪切定义为 $s_{\\hat{q}}(r)=\\frac{d\\ln q}{d\\ln r}$。在磁岛重叠和磁随机性出现的背景下，相邻有理面之间的径向间距控制着磁岛重叠的难易程度。仅使用安全因子、有理面和磁剪切的基本定义，推导相邻有理面 $q(r)=m/n$ 和 $q(r)=(m+1)/n$ 之间的局域径向间距 $\\Delta r$ 的解析表达式。以米为单位，用闭合形式表示最终答案，并在 $q(r_{m/n})=m/n$ 的位置 $r_{m/n}$ 处进行计算，并用 $r_{m/n}$、$m$ 和 $s_{\\hat{q}}(r_{m/n})$ 表示。不需要进行数值计算，除了 $q(r)$ 的局域光滑性和可微性外，不应引入其他近似。最终答案必须是单一的闭合形式解析表达式。",
            "solution": "目标是推导由安全因子 $q = m/n$ 和 $q = (m+1)/n$ 定义的两个相邻有理磁面之间的局域径向间距 $\\Delta r$ 的解析表达式。最终表达式必须在 $q=m/n$ 磁面的径向位置上计算，并用半径 $r_{m/n}$、极向模数 $m$ 和磁剪切 $s_{\\hat{q}}(r_{m/n})$ 表示。\n\n设这两个指定的有理面的径向位置分别表示为 $r_1$ 和 $r_2$。\n根据定义，这些磁面上的安全因子为：\n$q(r_1) = \\frac{m}{n}$\n$q(r_2) = \\frac{m+1}{n}$\n\n我们将内磁面的径向位置定义为 $r_{m/n}$，因此 $r_1 = r_{m/n}$。相邻外磁面的径向位置（假设 $q$ 剖面单调递增）是 $r_2$。那么径向间距为 $\\Delta r = r_2 - r_1$。\n\n这两个磁面之间的安全因子变化为：\n$$\n\\Delta q = q(r_2) - q(r_1) = \\frac{m+1}{n} - \\frac{m}{n} = \\frac{1}{n}\n$$\n\n问题指出我们关心的是*局域*径向间距，并且我们假设安全因子剖面 $q(r)$ 是小半径 $r$ 的光滑可微函数。对于一个小的间距 $\\Delta r$，变化量 $\\Delta q$ 可以通过在 $r_1$ 点对 $q(r)$ 进行一阶泰勒展开与 $\\Delta r$ 联系起来：\n$$\nq(r_2) = q(r_1 + \\Delta r) \\approx q(r_1) + \\left. \\frac{dq}{dr} \\right|_{r=r_1} \\Delta r\n$$\n整理这个近似式得到：\n$$\n\\Delta q = q(r_2) - q(r_1) \\approx \\left. \\frac{dq}{dr} \\right|_{r=r_1} \\Delta r\n$$\n由此，我们可以将径向间距 $\\Delta r$ 表示为：\n$$\n\\Delta r \\approx \\frac{\\Delta q}{\\left. \\frac{dq}{dr} \\right|_{r=r_1}}\n$$\n\n为了继续推导，我们必须用给定的磁剪切定义 $s_{\\hat{q}}(r)$ 来表示导数 $\\frac{dq}{dr}$。磁剪切定义为 $q$ 相对于 $r$ 的对数导数：\n$$\ns_{\\hat{q}}(r) = \\frac{d\\ln q}{d\\ln r}\n$$\n使用链式法则，我们可以展开这个定义：\n$$\ns_{\\hat{q}}(r) = \\frac{\\frac{1}{q(r)} \\frac{dq(r)}{dr}}{\\frac{1}{r}} = \\frac{r}{q(r)} \\frac{dq(r)}{dr}\n$$\n现在我们可以解这个方程得到导数 $\\frac{dq}{dr}$：\n$$\n\\frac{dq}{dr} = s_{\\hat{q}}(r) \\frac{q(r)}{r}\n$$\n\n现在，我们将这个导数的表达式代回到我们关于 $\\Delta r$ 的方程中：\n$$\n\\Delta r \\approx \\frac{\\Delta q}{s_{\\hat{q}}(r_1) \\frac{q(r_1)}{r_1}}\n$$\n问题要求该表达式在位置 $r_{m/n}$ 处进行计算，这对应于我们定义的半径 $r_1$。在此位置，我们有：\n- $r_1 = r_{m/n}$\n- $q(r_1) = \\frac{m}{n}$\n- $\\Delta q = \\frac{1}{n}$\n- $s_{\\hat{q}}(r_1) = s_{\\hat{q}}(r_{m/n})$\n\n将这些具体数值代入 $\\Delta r$ 的表达式中：\n$$\n\\Delta r \\approx \\frac{\\frac{1}{n}}{s_{\\hat{q}}(r_{m/n}) \\frac{m/n}{r_{m/n}}}\n$$\n\n我们现在简化这个代数表达式。项 $1/n$ 同时出现在分子和分母中，可以消去：\n$$\n\\Delta r \\approx \\frac{1}{n} \\cdot \\frac{r_{m/n}}{s_{\\hat{q}}(r_{m/n}) (m/n)} = \\frac{1}{n} \\cdot \\frac{n \\cdot r_{m/n}}{m \\cdot s_{\\hat{q}}(r_{m/n})}\n$$\n$$\n\\Delta r = \\frac{r_{m/n}}{m \\cdot s_{\\hat{q}}(r_{m/n})}\n$$\n这就是 $q=m/n$ 和 $q=(m+1)/n$ 磁面之间径向间距 $\\Delta r$ 的最终解析表达式。它按照要求，用局域半径 $r_{m/n}$、极向模数 $m$ 和局域磁剪切 $s_{\\hat{q}}(r_{m/n})$ 表示。由于 $r_{m/n}$ 的单位是米，而 $m$ 和 $s_{\\hat{q}}$ 都是无量纲量，因此得到的 $\\Delta r$ 的单位正确地为米。$\\Delta r$ 的符号由磁剪切的符号决定；对于标准的正剪切剖面 ($s_{\\hat{q}} > 0$)，$q$ 随 $r$ 增加，$\\Delta r$ 为正，符合预期。",
            "answer": "$$\n\\boxed{\\frac{r_{m/n}}{m \\cdot s_{\\hat{q}}(r_{m/n})}}\n$$"
        },
        {
            "introduction": "在确定了潜在磁岛之间的间距后，下一步是量化单个磁岛的大小。理论模型通常在抽象的磁通坐标中描述磁岛宽度，但为了实际应用和与实验进行比较，我们需要其在真实空间坐标中的大小。这项实践将指导你完成这一关键转换()，并阐明磁岛的表观尺寸如何依赖于所选的坐标系。",
            "id": "3705784",
            "problem": "考虑一个大环径比、圆形截面的托卡马克，其大半径为 $R_0$，小半径为 $a$。设在有理面 $r=r_s$ 附近，环向磁场在半径方向上近似恒定，其值为 $B_{\\phi}(r_s)$，并设安全因子 $q(r)$ 在一个 $m/n$ 磁岛的有理面上满足 $q(r_s)=m/n$。定义极向磁通坐标 $\\psi(r)$，使得 $2\\pi \\psi(r)$ 等于由小半径 $r$ 标记的磁面所包围的总极向磁通量。一个饱和磁岛在极向磁通坐标下的半宽度为 $\\Delta \\psi$。\n\n仅使用圆形、轴对称托卡马克中极向磁通和安全因子的基本几何定义，推导磁岛的径向半宽度 $\\Delta r$ 关于 $\\Delta \\psi$、$q(r_s)$、$r_s$ 和 $B_{\\phi}(r_s)$ 的表达式。对以下参数，数值计算 $\\Delta r$：\n- $R_0 = 3.0\\,\\text{m}$，\n- $r_s = 0.40\\,\\text{m}$，\n- $B_{\\phi}(r_s) = 5.3\\,\\text{T}$，\n- $q(r_s) = 2.5$，\n- $\\Delta \\psi = 2.2\\times 10^{-2}\\,\\text{Wb}$。\n\n然后，解释当径向坐标 $x$ 是 $\\psi$ 的单调函数时，岛宽如何依赖于 $x$ 的选择，并提供关联 $\\Delta x$ 与 $\\Delta \\psi$ 的普适变换法则。你的数值答案必须是 $\\Delta r$ 的值，并且必须以米为单位表示。将你的数值答案四舍五入到四位有效数字。",
            "solution": "该问题要求推导磁岛的径向半宽度 $\\Delta r$，对其进行数值计算，并解释岛宽如何依赖于所选的径向坐标。\n\n首先，我们推导径向半宽度 $\\Delta r$ 与极向磁通坐标下的半宽度 $\\Delta \\psi$ 之间的关系。推导从安全因子 $q$ 关于磁通量的基本定义开始。安全因子是环向磁通量的微分变化 $d\\Phi$ 与极向磁通量的微分变化 $d\\Psi_p$ 之比。\n$$q = \\frac{d\\Phi}{d\\Psi_p}$$\n问题陈述极向磁通量由 $2\\pi\\psi(r)$ 给出，因此我们有 $\\Psi_p = 2\\pi\\psi$。将此代入 $q$ 的定义得到：\n$$q = \\frac{d\\Phi}{d(2\\pi\\psi)} = \\frac{1}{2\\pi} \\frac{d\\Phi}{d\\psi}$$\n为了继续推导，我们需要磁通量的表达式。对于大环径比、圆形截面的托卡马克，小半径 $r$ 内包围的环向磁通量 $\\Phi$ 可以通过将环向磁场 $B_{\\phi}$ 在圆形面积 $\\pi r^2$ 上积分来近似。问题中说明 $B_{\\phi}$ 在有理面 $r_s$ 附近近似恒定。因此我们可以写出：\n$$\\Phi(r) \\approx \\pi r^2 B_{\\phi}(r)$$\n环向磁通量关于小半径 $r$ 的导数是：\n$$\\frac{d\\Phi}{dr} = 2\\pi r B_{\\phi}(r)$$\n使用链式法则，我们可以将关于 $\\psi$ 的导数与关于 $r$ 的导数联系起来：\n$$\\frac{d\\Phi}{d\\psi} = \\frac{d\\Phi}{dr} \\frac{dr}{d\\psi} = \\left(2\\pi r B_{\\phi}(r)\\right) \\frac{dr}{d\\psi}$$\n将此代回 $q$ 的表达式：\n$$q(r) = \\frac{1}{2\\pi} \\left(2\\pi r B_{\\phi}(r) \\frac{dr}{d\\psi}\\right) = r B_{\\phi}(r) \\frac{dr}{d\\psi}$$\n这个方程提供了径向坐标 $r$ 和磁通坐标 $\\psi$ 之间的关键关系。我们可以重排它来表示 $\\psi$ 关于 $r$ 的导数：\n$$\\frac{d\\psi}{dr} = \\frac{r B_{\\phi}(r)}{q(r)}$$\n磁岛是局限于有理面 $r_s$ 周圍的小结构。对于一个小的磁岛半宽度，我们可以使用线性近似来关联半径的变化 $\\Delta r$ 与磁通坐标的相应变化 $\\Delta \\psi$。\n$$\\Delta \\psi \\approx \\frac{d\\psi}{dr}\\bigg|_{r=r_s} \\Delta r$$\n代入我们在有理面 $r=r_s$ 处计算的导数表达式：\n$$\\Delta \\psi \\approx \\left(\\frac{r_s B_{\\phi}(r_s)}{q(r_s)}\\right) \\Delta r$$\n求解径向半宽度 $\\Delta r$，我们得到所求的表达式：\n$$\\Delta r \\approx \\frac{q(r_s) \\Delta \\psi}{r_s B_{\\phi}(r_s)}$$\n接下来，我们使用给定的参数数值计算 $\\Delta r$：\n- $q(r_s) = 2.5$\n- $\\Delta \\psi = 2.2 \\times 10^{-2}\\,\\text{Wb}$\n- $r_s = 0.40\\,\\text{m}$\n- $B_{\\phi}(r_s) = 5.3\\,\\text{T}$\n\n将这些值代入推导出的公式：\n$$\\Delta r = \\frac{(2.5) \\times (2.2 \\times 10^{-2}\\,\\text{Wb})}{(0.40\\,\\text{m}) \\times (5.3\\,\\text{T})}$$\n$$\\Delta r = \\frac{5.5 \\times 10^{-2}\\,\\text{Wb}}{2.12\\,\\text{T}\\cdot\\text{m}}$$\n单位是一致的，因为 $1\\,\\text{Wb} = 1\\,\\text{T}\\cdot\\text{m}^2$。\n$$\\Delta r = \\frac{5.5 \\times 10^{-2}}{2.12}\\,\\text{m} \\approx 0.025943396\\,\\text{m}$$\n按照要求将结果四舍五入到四位有效数字：\n$$\\Delta r \\approx 0.02594\\,\\text{m}$$\n\n最后，我们讨论岛宽对径向坐标选择的依赖性。磁岛尺寸的一个基本的、与坐标无关的度量是其磁通半宽度 $\\Delta \\psi$（或更精确地说，是重联磁通）。任何其他的径向坐标，我们称之为 $x$，都是极向磁通的单调函数，因此我们可以写成 $x = x(\\psi)$。用坐标 $x$ 表示的岛宽，记作 $\\Delta x$，代表了从磁岛的O点到其分界面的 $x$ 的变化量。对于一个小磁岛，这个变化量可以通过一阶泰勒展开与 $\\Delta \\psi$ 相关联：\n$$\\Delta x \\approx \\frac{dx}{d\\psi}\\bigg|_{\\psi=\\psi_s} \\Delta \\psi$$\n其中 $\\psi_s$ 是有理面处的磁通坐标值。这就是普适的变换法则。\n\n该法则表明，岛宽不是一个空间不变量；其数值直接依赖于用于测量的径向坐标的定义。项 $\\frac{dx}{d\\psi}$ 就像一个“度规”，将磁通宽度转换为所选坐标系中的空间宽度。对于径向坐标 $x=r$，我们得到 $\\frac{dr}{d\\psi} = \\frac{q}{rB_{\\phi}}$，这恢复了我们最初的公式。如果我们选择了不同的坐标，例如归一化环向磁通 $\\rho = \\sqrt{\\Phi/\\Phi_a}$（其中 $\\Phi_a$ 是总环向磁通），岛宽 $\\Delta \\rho$ 的表达式将会不同，由有理面处的导数 $\\frac{d\\rho}{d\\psi}$ 决定。",
            "answer": "$$\\boxed{0.02594}$$"
        },
        {
            "introduction": "最后的这项实践将所有概念融会贯通，是整个理论的高潮。利用共振间距和磁岛宽度的知识，我们将应用Chirikov重叠判据来预测向磁随机性的转变。你将实现一个简化的动力学模型（扭曲映射），计算Chirikov参数，然后通过数值诊断直接观察混沌行为的出现()，从而在几何重叠条件与混沌的发生之间建立一个切实的联系。",
            "id": "3705723",
            "problem": "考虑一个双共振保面积扭转映射，该映射模拟了用于核聚变的环形磁约束中的磁力线动力学，以角-作用量变量 $(\\theta,I)$ 写出，其中 $\\theta \\in [0,2\\pi)$（单位为弧度），$I \\in \\mathbb{R}$。该映射定义为\n$$\nI_{n+1} = I_n + K_1 \\sin(m_1 \\theta_n) + K_2 \\sin(m_2 \\theta_n), \\quad \\theta_{n+1} = \\theta_n + I_{n+1} \\pmod{2\\pi},\n$$\n其中 $K_1$、$K_2$ 是微扰振幅，$m_1$、$m_2$ 是代表两个共振微扰的谐波模数的正整数。这是一个近可积哈密顿系统的规范离散时间近似，其扭转（频率）为 $\\omega(I) = I$，它能够描述磁岛链以及通过磁岛重叠引发的磁随机性。\n\n从第一性原理出发，使用以下基本依据：\n- 扭转映射的定义为 $\\omega(I) = I$，以及谐波 $m$ 发生共振的条件，即每次迭代的旋转量 $I$ 满足 $m I \\approx 2\\pi q$（其中 $q$ 为整数）。\n- 在共振点附近使用局域单摆近似来估计 $I$ 中的共振宽度。\n- Chirikov 重叠判据，该判据预测，当共振半宽之和超过共振中心之间的作用量距离时，会发生大范围的随机性。\n\n你的任务是：\n- 为两个谐波 $m_1$ 和 $m_2$ 推导主共振中心 $I_{\\mathrm{res},j}$ 的表达式（选择 $q=1$），以及作用量空间分离度 $\\Delta I_{\\mathrm{res}} = |I_{\\mathrm{res},1} - I_{\\mathrm{res},2}|$ 的可计算表达式。\n- 利用每个共振点附近的单摆近似和扭转 $\\frac{d\\omega}{dI} = 1$，推导每个共振半宽 $w_j$ 在作用量空间中关于 $K_j$ 和 $m_j$ 的可计算表达式。\n- 定义 Chirikov 重叠参数\n$$\nS = \\frac{w_1 + w_2}{\\Delta I_{\\mathrm{res}}}.\n$$\n对于给定的 $(K_1,m_1,K_2,m_2)$，数值计算 $S$，并与随机层形成的迭代映射诊断结果进行比较。\n\n为与迭代映射结果进行比较，请实现上述映射，并在 $N$ 次迭代中计算两个数值诊断量：\n- 从切映射线性化估计的有限时间最大李雅普诺夫指数 $\\lambda$（在每次迭代中重缩放切向量并对对数增长进行平均）。\n- 作用量变量 $I$ 在轨道的后暂态部分（舍弃初始暂态）的标准差。\n\n当有限时间最大李雅普诺夫指数超过一个小的正阈值，或者 $I$ 的标准差超过共振分离度的一部分时，将“随机层形成”声明为布尔值：\n- 使用 $\\lambda_{\\mathrm{thr}} = 0.01$ 和 $\\sigma_{\\mathrm{thr}} = 0.30 \\, \\Delta I_{\\mathrm{res}}$。\n- 对初始角度 $\\theta_0 \\in \\{0.1,1.0,2.0,3.0\\}$（单位为弧度）进行采样。对于每个测试用例，将作用量初始化在两个共振中心的中间点，\n$$\nI_0 = \\frac{I_{\\mathrm{res},1} + I_{\\mathrm{res},2}}{2} = \\pi \\left(\\frac{1}{m_1} + \\frac{1}{m_2}\\right),\n$$\n并将采样得到的 $\\theta_0$ 中最大的李雅普诺夫指数和最大的 $I$ 标准差作为该用例的代表性诊断结果。\n\n角度必须以弧度处理。不需要其他物理单位。\n\n实现上述内容并解决以下参数集的测试套件，其中所有 $m_j$ 均为整数，所有 $K_j$ 均为非负实数：\n- 测试 1：$(m_1,m_2,K_1,K_2,N) = (3,5,0.05,0.05,40000)$。\n- 测试 2：$(m_1,m_2,K_1,K_2,N) = (3,5,0.30,0.30,40000)$。\n- 测试 3：$(m_1,m_2,K_1,K_2,N) = (2,7,0.30,0.30,40000)$。\n- 测试 4：$(m_1,m_2,K_1,K_2,N) = (3,4,0.06,0.06,40000)$。\n\n对于每个测试，输出一个对，其中包含四舍五入到三位小数的 Chirikov 参数 $S$ 和一个布尔值，该布尔值指示迭代映射诊断是否如上文定义的那样检测到随机层。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表的每个元素是对应于一个测试的对，顺序与上面列出的顺序相同：\n$$\n\\big[ [S_1,\\text{bool}_1],[S_2,\\text{bool}_2],[S_3,\\text{bool}_3],[S_4,\\text{bool}_4] \\big].\n$$",
            "solution": "问题陈述描述了一个双共振保面积扭转映射，这是等离子体物理和非线性动力学中研究磁岛形成和混沌（随机性）起始的典型模型。任务是为此映射推导 Chirikov 重叠判据，并将其对随机性的预测与直接数值诊断进行比较。\n\n该问题具有科学依据，提法恰当，并包含了唯一解所需的所有信息。所规定的定义和方法，如单摆近似、Chirikov 判据和李雅普诺夫指数估计，是该领域的标准方法。因此，该问题被认为是有效的，有必要提供完整解答。\n\n解答过程分为两部分：首先，对 Chirikov 判据所需量的理论推导；其次，对用于从迭代映射数据中诊断随机性的数值方法的解释。\n\n### 1. 理论推导\n\n#### 1.1. 共振中心与分离度\n\n系统由以下映射描述：\n$$\nI_{n+1} = I_n + K_1 \\sin(m_1 \\theta_n) + K_2 \\sin(m_2 \\theta_n)\n$$\n$$\n\\theta_{n+1} = \\theta_n + I_{n+1} \\pmod{2\\pi}\n$$\n量 $I$ 作为旋转数或频率，$\\omega(I) = I$。对于谐波模 $m$ 的共振，发生在整数次旋转（例如 $q$ 次）对应于 $m$ 个完整的角度周期时，这会导致一个稳相关系。条件是 $m \\omega(I) = 2\\pi q$，对于我们的映射，这变成 $m I = 2\\pi q$。\n\n问题指定使用主共振，即 $q=1$。因此，第 $j$ 个谐波 ($m_j$) 在作用量空间中的共振中心为：\n$$\nI_{\\mathrm{res},j} = \\frac{2\\pi}{m_j}\n$$\n两个主共振中心在作用量空间中的分离度是：\n$$\n\\Delta I_{\\mathrm{res}} = |I_{\\mathrm{res},1} - I_{\\mathrm{res},2}| = \\left| \\frac{2\\pi}{m_1} - \\frac{2\\pi}{m_2} \\right| = 2\\pi \\left| \\frac{1}{m_1} - \\frac{1}{m_2} \\right|\n$$\n\n#### 1.2. 共振半宽\n\n为求单个共振的宽度，我们通过只考虑一个微扰项来分离其效应。让我们分析与 $(K_j, m_j)$ 相关的共振，忽略另一项。映射简化为：\n$$\nI_{n+1} = I_n + K_j \\sin(m_j \\theta_n)\n$$\n$$\n\\theta_{n+1} = \\theta_n + I_{n+1} \\pmod{2\\pi}\n$$\n我们进行变量替换，以研究共振中心 $I_{\\mathrm{res},j} = 2\\pi/m_j$ 附近的动力学。令 $\\delta I_n = I_n - I_{\\mathrm{res},j}$ 为与共振中心的偏差。我们定义一个“慢”相位变量 $\\phi_n = m_j \\theta_n \\pmod{2\\pi}$。\n\n从映射方程中，我们可以写出 $\\delta I_n$ 和 $\\phi_n$ 的演化方程：\n对于作用量：\n$$\nI_{n+1} - I_{\\mathrm{res},j} = I_n - I_{\\mathrm{res},j} + K_j \\sin(m_j \\theta_n) \\implies \\delta I_{n+1} = \\delta I_n + K_j \\sin(\\phi_n)\n$$\n对于相位：\n$$\n\\theta_{n+1} = \\theta_n + I_{\\mathrm{res},j} + \\delta I_{n+1}\n$$\n乘以 $m_j$ 并取结果模 $2\\pi$：\n$$\nm_j \\theta_{n+1} \\pmod{2\\pi} = (m_j \\theta_n + m_j I_{\\mathrm{res},j} + m_j \\delta I_{n+1}) \\pmod{2\\pi}\n$$\n由于 $m_j I_{\\mathrm{res},j} = 2\\pi$，该项在模运算下消失：\n$$\n\\phi_{n+1} = (\\phi_n + m_j \\delta I_{n+1}) \\pmod{2\\pi}\n$$\n现在，我们通过定义一个新的动量变量 $P_n = m_j \\delta I_n$ 来重新缩放作用量偏差。因此，$\\delta I_n = P_n/m_j$。将此代入演化方程得到：\n$$\n\\frac{P_{n+1}}{m_j} = \\frac{P_n}{m_j} + K_j \\sin(\\phi_n) \\implies P_{n+1} = P_n + m_j K_j \\sin(\\phi_n)\n$$\n对于相位：\n$$\n\\phi_{n+1} = (\\phi_n + P_{n+1}) \\pmod{2\\pi}\n$$\n这个 $(\\phi, P)$ 映射恰好是“标准映射”，其有效随机性参数为 $k_{\\mathrm{eff}} = m_j K_j$。共振的宽度由该有效单摆系统的分界面的全部范围决定。对于标准映射，动量变量 $P$ 中分界面的半宽是众所周知的 $w_P = 2\\sqrt{k_{\\mathrm{eff}}}$。\n\n代入我们的有效参数，在 $P$ 中的半宽是：\n$$\nw_{P,j} = 2\\sqrt{m_j K_j}\n$$\n为了找到原始作用量变量 $I$ 中的半宽，我们必须使用关系 $P = m_j \\delta I$ 进行反变换，因此 $\\delta I = P/m_j$。所以，$I$ 中的半宽 $w_j$ 是：\n$$\nw_j = \\frac{w_{P,j}}{m_j} = \\frac{2\\sqrt{m_j K_j}}{m_j} = 2\\sqrt{\\frac{K_j}{m_j}}\n$$\n如要求的那样，此表达式同时依赖于 $K_j$ 和 $m_j$。注意，扭转 $\\frac{d\\omega}{dI} = 1$ 在此推导中被隐式使用，因为它确保了相位推进和作用量之间的线性关系。\n\n#### 1.3. Chirikov 重叠判据\n\nChirikov 判据指出，当相邻共振的半宽之和变得与它们中心之间的距离相当或超过该距离时，就会出现大范围的随机性。无量纲的 Chirikov 重叠参数 $S$ 量化了这一点：\n$$\nS = \\frac{w_1 + w_2}{\\Delta I_{\\mathrm{res}}}\n$$\n$S \\gtrsim 1$ 的值是全局混沌开始的阈值。代入我们推导的表达式：\n$$\nS = \\frac{2\\sqrt{K_1/m_1} + 2\\sqrt{K_2/m_2}}{2\\pi |1/m_1 - 1/m_2|} = \\frac{\\sqrt{K_1/m_1} + \\sqrt{K_2/m_2}}{\\pi |1/m_1 - 1/m_2|}\n$$\n这提供了一个基于映射参数的 $S$ 的可计算公式。\n\n### 2. 数值诊断\n\n#### 2.1. 有限时间最大李雅普诺夫指数\n\n最大李雅普诺夫指数 $\\lambda$ 衡量邻近轨道发散的平均指数率。一个正的 $\\lambda$ 是混沌的明确标志。它通过沿轨道演化一个切向量并对其对数增长率进行平均来计算。\n\n切映射是主映射的雅可比矩阵。令 $f(\\theta_n) = K_1 \\sin(m_1 \\theta_n) + K_2 \\sin(m_2 \\theta_n)$。雅可比矩阵是：\n$$\nJ_n = \\frac{\\partial(I_{n+1}, \\theta_{n+1})}{\\partial(I_n, \\theta_n)} = \\begin{pmatrix} \\frac{\\partial I_{n+1}}{\\partial I_n}  \\frac{\\partial I_{n+1}}{\\partial \\theta_n} \\\\ \\frac{\\partial \\theta_{n+1}}{\\partial I_n}  \\frac{\\partial \\theta_{n+1}}{\\partial \\theta_n} \\end{pmatrix} = \\begin{pmatrix} 1  f'(\\theta_n) \\\\ 1  1+f'(\\theta_n) \\end{pmatrix}\n$$\n其中 $f'(\\theta_n) = K_1 m_1 \\cos(m_1 \\theta_n) + K_2 m_2 \\cos(m_2 \\theta_n)$。\n\n算法如下：\n1. 初始化一个归一化的切向量 $\\vec{v}_0$，例如 $\\vec{v}_0 = (1, 0)$。\n2. 对每一步 $n=0, \\dots, N-1$：\n   a. 演化轨道：$(\\theta_{n+1}, I_{n+1})$。\n   b. 演化切向量：$\\vec{v}'_{n+1} = J_n \\cdot \\vec{v}_n$。\n   c. 计算增长因子（范数）：$d_{n+1} = ||\\vec{v}'_{n+1}||$。\n   d. 累加增长因子的对数：$L = L + \\ln(d_{n+1})$。\n   e. 为下一步重新归一化向量：$\\vec{v}_{n+1} = \\vec{v}'_{n+1} / d_{n+1}$。\n3. 有限时间李雅普诺夫指数是 $\\lambda = L/N$。\n计算出的 $\\lambda > \\lambda_{\\mathrm{thr}} = 0.01$ 表示混沌行为。\n\n#### 2.2. 作用量的标准差\n\n在混沌区域，作用量变量 $I$ 不被限制在规则的环面上，而是可以在大范围内游走。$I$ 的标准差，记为 $\\sigma_I$，可作为衡量这种游走范围的简单代理。一个大的 $\\sigma_I$ 表明轨道正在探索一个宽的随机层。\n\n我们在轨道的后半部分计算 $\\sigma_I$，以排除初始暂态。对于总共 $N$ 次迭代，我们舍弃前 $N_{\\mathrm{transient}}$ 个点（例如 $N$ 的 $10\\%$），并计算集合 $\\{I_n | n \\in [N_{\\mathrm{transient}}, N-1]\\}$ 的标准差。\n如果 $\\sigma_I$ 是共振分离度的一个显著部分，即如果 $\\sigma_I > \\sigma_{\\mathrm{thr}} = 0.30 \\, \\Delta I_{\\mathrm{res}}$，则可推断出随机性。\n\n#### 2.3. 随机性检测\n对于每个测试用例，我们考虑四个初始角度 $\\theta_0 \\in \\{0.1, 1.0, 2.0, 3.0\\}$，作用量 $I_0$ 固定在两个共振的中间点。$\\lambda$ 和 $\\sigma_I$ 的代表值是在这四个初始条件下观察到的最大值。如果任一数值标准（$\\lambda > \\lambda_{\\mathrm{thr}}$ 或 $\\sigma_I > \\sigma_{\\mathrm{thr}}$）被满足，则“随机层形成”的布尔标志被设置为 `True`。",
            "answer": "```python\nimport numpy as np\n\ndef run_test_case(m1, m2, K1, K2, N):\n    \"\"\"\n    Analyzes a single test case for the two-resonance twist map.\n    \n    Args:\n        m1 (int): Mode number of the first resonance.\n        m2 (int): Mode number of the second resonance.\n        K1 (float): Amplitude of the first perturbation.\n        K2 (float): Amplitude of the second perturbation.\n        N (int): Number of iterations for numerical simulation.\n\n    Returns:\n        list: A pair [S, is_stochastic], where S is the Chirikov parameter\n              rounded to 3 decimal places, and is_stochastic is a boolean.\n    \"\"\"\n    # Force float division for Python 2 compatibility, although env is 3.12\n    m1, m2, K1, K2 = float(m1), float(m2), float(K1), float(K2)\n    \n    # 1. Theoretical Calculations\n    # Resonance centers (q=1)\n    I_res1 = 2.0 * np.pi / m1\n    I_res2 = 2.0 * np.pi / m2\n    \n    # Separation between resonance centers\n    delta_I_res = np.abs(I_res1 - I_res2)\n    \n    # Resonance half-widths\n    # Using the derivation w_j = 2 * sqrt(K_j / m_j)\n    w1 = 2.0 * np.sqrt(K1 / m1)\n    w2 = 2.0 * np.sqrt(K2 / m2)\n    \n    # Chirikov overlap parameter S\n    if delta_I_res > 1e-9:\n        S = (w1 + w2) / delta_I_res\n    else:\n        # Avoid division by zero if m1=m2, though problem constraints imply m1!=m2\n        S = np.inf\n\n    # 2. Numerical Diagnostics\n    initial_thetas = [0.1, 1.0, 2.0, 3.0]\n    I0 = np.pi * (1.0/m1 + 1.0/m2)\n    \n    max_lyapunov = 0.0\n    max_sigma_I = 0.0\n\n    two_pi = 2.0 * np.pi\n    \n    for theta0 in initial_thetas:\n        # --- Initialize orbit and tangent vector ---\n        theta, I = theta0, I0\n        # tangent vector for Lyapunov exponent, corresponds to [d_theta, d_I]^T\n        delta_theta, delta_I = 1.0, 0.0 \n        \n        log_sum = 0.0\n        I_history = np.zeros(N)\n\n        for n in range(N):\n            I_history[n] = I\n            \n            # --- Evolve main orbit ---\n            f_theta = K1 * np.sin(m1 * theta) + K2 * np.sin(m2 * theta)\n            I_next = I + f_theta\n            theta_next = (theta + I_next) % two_pi\n            \n            # --- Evolve tangent vector ---\n            # Jacobian entries\n            f_prime_theta = m1 * K1 * np.cos(m1 * theta) + m2 * K2 * np.cos(m2 * theta)\n            # Jacobian matrix for (theta, I) variables is J = [[1+f', 1], [f', 1]]\n            # Evolve tangent vector v_next = J * v\n            delta_theta_next = (1.0 + f_prime_theta) * delta_theta + delta_I\n            delta_I_next = f_prime_theta * delta_theta + delta_I\n            \n            # --- Rescale and accumulate for Lyapunov exponent ---\n            norm_sq = delta_theta_next**2 + delta_I_next**2\n            if norm_sq > 0:\n                norm = np.sqrt(norm_sq)\n                log_sum += np.log(norm)\n                delta_theta = delta_theta_next / norm\n                delta_I = delta_I_next / norm\n            else:\n                # In case vector collapses to zero (highly unlikely)\n                delta_theta, delta_I = 1.0, 0.0\n\n\n            # --- Update state for next iteration ---\n            theta, I = theta_next, I_next\n\n        # --- Finalize diagnostics for this theta0 ---\n        # Lyapunov exponent\n        lyapunov_exp = log_sum / N\n        if lyapunov_exp > max_lyapunov:\n            max_lyapunov = lyapunov_exp\n            \n        # Standard deviation of I (post-transient)\n        transient_steps = N // 10\n        sigma_I = np.std(I_history[transient_steps:])\n        if sigma_I > max_sigma_I:\n            max_sigma_I = sigma_I\n\n    # 3. Stochasticity Detection\n    lambda_thr = 0.01\n    sigma_thr = 0.30 * delta_I_res\n    \n    is_stochastic = (max_lyapunov > lambda_thr) or (max_sigma_I > sigma_thr)\n    \n    return [round(S, 3), is_stochastic]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (m1, m2, K1, K2, N)\n        (3, 5, 0.05, 0.05, 40000),\n        (3, 5, 0.30, 0.30, 40000),\n        (2, 7, 0.30, 0.30, 40000),\n        (3, 4, 0.06, 0.06, 40000),\n    ]\n\n    results = []\n    for case in test_cases:\n        m1, m2, K1, K2, N = case\n        result = run_test_case(m1, m2, K1, K2, N)\n        results.append(result)\n\n    # Format the final output string\n    # Convert bools to lowercase 'true'/'false' for standard JSON-like format\n    result_strs = [f\"[{res[0]},{str(res[1]).lower()}]\" for res in results]\n    print(f\"[{','.join(result_strs)}]\")\n\nsolve()\n```"
        }
    ]
}