{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration, we first need to master the fundamental scales and frequencies that govern plasma microinstabilities. This exercise will guide you through a critical scaling analysis, connecting the macroscopic geometry of a tokamak, like its major radius $R$ and safety factor $q$, to the microscopic kinetic scales relevant to Ion Temperature Gradient (ITG) modes. By practicing this derivation, you will develop essential skills in parameter estimation and build physical intuition for the interplay between different dynamic processes in a fusion plasma .",
            "id": "3704985",
            "problem": "Consider a large–aspect-ratio tokamak plasma relevant to Ion Temperature Gradient (ITG) modes, characterized by major radius $R$, minor radius $a \\ll R$, toroidal magnetic field $B$, ion temperature $T_i$, ion mass $m_i$, and ion charge $e$. Let the safety factor be $q=\\mathcal{O}(1\\text{–}5)$ and define the ion thermal speed by $v_{ti}=\\sqrt{2 T_i/m_i}$, the ion cyclotron frequency by $\\Omega_i = e B/m_i$, and the ion Larmor radius by $\\rho_i = v_{ti}/\\Omega_i$. Let $k_y$ denote the binormal (approximately poloidal) wavenumber perpendicular to the magnetic field and $L_n \\equiv \\left| \\mathrm{d} \\ln n_i / \\mathrm{d} r \\right|^{-1}$ the ion density gradient scale length. The ion diamagnetic frequency is defined by $\\omega_{*i} = k_y T_i/(e B L_n)$.\n\nStarting from basic field-line geometry and the definition of the safety factor for a large–aspect-ratio tokamak, argue that the parallel connection length scales as $L_{\\parallel} \\sim q R$ up to factors of order unity. Using this scaling, the definition of the ion thermal speed, and the expression for the ion diamagnetic frequency above, derive a closed-form expression for the ratio of the parallel transit frequency to the ion diamagnetic frequency,\n$$\n\\frac{\\left(v_{ti}/L_{\\parallel}\\right)}{\\omega_{*i}} \\, ,\n$$\nexpressed purely in terms of $q$, $R$, $L_n$, $k_y$, and $\\rho_i$, eliminating $T_i$ and $B$ in favor of $\\rho_i$ and the given parameters. Ignore factors of order unity associated with geometric constants. Provide your final answer as a single analytic expression. Do not include any units.",
            "solution": "The problem statement has been validated and is deemed scientifically grounded, well-posed, and self-contained. It presents a standard derivation in the field of plasma physics related to microinstabilities in tokamaks. We may therefore proceed with the solution.\n\nThe problem asks for two main results: first, to justify the scaling of the parallel connection length $L_{\\parallel}$; and second, to derive a closed-form expression for the ratio of the parallel ion transit frequency to the ion diamagnetic frequency.\n\nFirst, we establish the scaling of the parallel connection length, $L_{\\parallel}$, in a large–aspect-ratio tokamak. A magnetic field line in a tokamak follows a helical path. In toroidal coordinates $(r, \\theta, \\phi)$ corresponding to the minor radius, poloidal angle, and toroidal angle, respectively, a differential element of length along a field line, $d\\vec{s}$, is aligned with the magnetic field vector $\\vec{B}$. The magnetic field is given by $\\vec{B} = B_p \\hat{\\theta} + B_T \\hat{\\phi}$, where $B_p$ is the poloidal component and $B_T$ is the toroidal component. The pitch of the field line is given by the ratio of the poloidal and toroidal path length elements, which must equal the ratio of the magnetic field components:\n$$\n\\frac{dl_p}{dl_t} = \\frac{r d\\theta}{R d\\phi} = \\frac{B_p}{B_T}\n$$\nHere, $r$ is the minor radial coordinate, and $R$ is the major radius.\n\nThe safety factor, $q$, is defined for a large-aspect-ratio, circular-cross-section plasma as:\n$$\nq(r) = \\frac{r B_T}{R B_p}\n$$\nSubstituting this definition into the field-line-following equation gives:\n$$\n\\frac{r d\\theta}{R d\\phi} = \\frac{r}{q R} \\implies d\\phi = q d\\theta\n$$\nThis relation shows that for a field line to complete one full poloidal transit ($\\Delta \\theta = 2\\pi$), it must complete $q$ full toroidal transits ($\\Delta \\phi = 2\\pi q$).\n\nThe parallel connection length, $L_{\\parallel}$, is the characteristic length scale along the magnetic field line that connects regions relevant to the mode structure. For ballooning-type modes like ITG modes, this is typically the distance along the field line from the outboard midplane (a region of \"bad\" curvature) to the inboard midplane (a region of \"good\" curvature), corresponding to a poloidal displacement of $\\Delta\\theta = \\pi$. The length along the field line, $s$, for a large-aspect-ratio tokamak where $B_T \\gg B_p$ is dominated by the toroidal path, so $ds \\approx dl_t = R d\\phi$. Integrating this over the relevant path gives the scaling for $L_{\\parallel}$:\n$$\nL_{\\parallel} = \\int ds \\approx \\int R d\\phi = R \\int q d\\theta\n$$\nFor a poloidal transit of $\\Delta\\theta \\sim \\mathcal{O}(1)$, for instance $\\Delta\\theta = \\pi$, and treating $q$ as constant over this distance, we find $L_{\\parallel} \\sim q R$. The problem statement permits ignoring factors of order unity, so we adopt the scaling:\n$$\nL_{\\parallel} \\sim q R\n$$\nThis is consistent with the definition of the parallel wavenumber for the most unstable modes, $k_{\\parallel} \\sim 1/(qR)$.\n\nNext, we derive the ratio of the parallel transit frequency, $\\omega_t \\equiv v_{ti}/L_{\\parallel}$, to the ion diamagnetic frequency, $\\omega_{*i}$. The ratio is:\n$$\n\\frac{\\omega_t}{\\omega_{*i}} = \\frac{v_{ti}/L_{\\parallel}}{\\omega_{*i}}\n$$\nWe are given the following definitions:\nIon thermal speed: $v_{ti} = \\sqrt{2 T_i/m_i}$\nIon diamagnetic frequency: $\\omega_{*i} = \\frac{k_y T_i}{e B L_n}$\nAnd we use our derived scaling $L_{\\parallel} \\sim q R$.\n\nSubstituting these into the ratio, we obtain:\n$$\n\\frac{v_{ti}/L_{\\parallel}}{\\omega_{*i}} \\sim \\frac{\\left( \\sqrt{2 T_i/m_i} \\right) / (qR)}{\\left( k_y T_i \\right) / \\left( e B L_n \\right)}\n$$\nRearranging the terms gives:\n$$\n\\frac{\\sqrt{2 T_i/m_i}}{qR} \\cdot \\frac{e B L_n}{k_y T_i} = \\frac{\\sqrt{2} \\sqrt{T_i}}{\\sqrt{m_i}} \\frac{e B L_n}{q R k_y T_i}\n$$\nWe can simplify the terms involving $T_i$:\n$$\n= \\frac{\\sqrt{2} e B L_n}{q R k_y \\sqrt{m_i} \\sqrt{T_i}}\n$$\nThe problem requires the final expression to be in terms of $q$, $R$, $L_n$, $k_y$, and the ion Larmor radius $\\rho_i$, eliminating $T_i$ and $B$. The definition of $\\rho_i$ is given as:\n$$\n\\rho_i = \\frac{v_{ti}}{\\Omega_i}\n$$\nwhere $\\Omega_i = e B/m_i$ is the ion cyclotron frequency. Substituting the definitions for $v_{ti}$ and $\\Omega_i$:\n$$\n\\rho_i = \\frac{\\sqrt{2 T_i/m_i}}{e B/m_i} = \\frac{\\sqrt{2 T_i m_i}}{e B}\n$$\nWe now solve this expression for the group of terms $\\frac{e B}{\\sqrt{m_i} \\sqrt{T_i}}$ that appeared in our intermediate result for the frequency ratio:\n$$\n\\rho_i = \\frac{\\sqrt{2} \\sqrt{m_i} \\sqrt{T_i}}{e B} \\implies \\frac{1}{\\rho_i} = \\frac{e B}{\\sqrt{2} \\sqrt{m_i} \\sqrt{T_i}}\n$$\nMultiplying by $\\sqrt{2}$ yields the desired group:\n$$\n\\frac{\\sqrt{2}}{\\rho_i} = \\frac{e B}{\\sqrt{m_i} \\sqrt{T_i}}\n$$\nNow, we substitute this result back into our expression for the frequency ratio:\n$$\n\\frac{v_{ti}/L_{\\parallel}}{\\omega_{*i}} \\sim \\left( \\frac{\\sqrt{2} L_n}{q R k_y} \\right) \\left( \\frac{e B}{\\sqrt{m_i} \\sqrt{T_i}} \\right) = \\left( \\frac{\\sqrt2 L_n}{q R k_y} \\right) \\left( \\frac{\\sqrt{2}}{\\rho_i} \\right)\n$$\nFinally, multiplying the constants gives the closed-form expression:\n$$\n\\frac{v_{ti}/L_{\\parallel}}{\\omega_{*i}} \\sim \\frac{2 L_n}{q R k_y \\rho_i}\n$$\nThis expression is purely in terms of the required parameters $q$, $R$, $L_n$, $k_y$, and $\\rho_i$. The factor of $2$ is retained as it arises directly from the algebraic manipulation of the provided definitions for $v_{ti}$ and $\\rho_i$, and is not a geometric factor of order unity that we were instructed to ignore.",
            "answer": "$$\n\\boxed{\\frac{2 L_n}{q R k_y \\rho_i}}\n$$"
        },
        {
            "introduction": "Building on an understanding of the fundamental scales, we can construct simplified models to capture the essential behavior of instabilities. This practice explores a classic and physically intuitive model for the ITG mode growth rate, which results from the competition between a driving mechanism that strengthens with wavenumber and a damping mechanism that suppresses short wavelengths . By analytically finding the wavenumber that maximizes this growth rate, you will uncover why ITG turbulence is typically dominated by fluctuations at a characteristic scale of $k_{\\perp}\\rho_i \\sim 1$.",
            "id": "3704986",
            "problem": "Consider a collisionless, electrostatic, magnetized plasma representative of the core of a tokamak, with singly charged ions of mass $m_i$ and electrons responding adiabatically. Let the background magnetic field be uniform with magnitude $B$, and define the ion thermal speed $v_{ti} = \\sqrt{2 T_i/m_i}$, the ion Larmor radius $\\rho_i = v_{ti}/\\Omega_i$ with $\\Omega_i = e B/m_i$, and perpendicular wavenumber $k_{\\perp}^{2} = k_{x}^{2} + k_{y}^{2}$. Assume straight-field-line slab geometry and local (ballooning) approximation, with a constant ion temperature gradient characterized by the inverse scale length $L_{T_i}^{-1} = -\\partial \\ln T_i/\\partial x$ and density gradient characterized by $L_{n}^{-1} = -\\partial \\ln n_0/\\partial x$, where $n_0$ and $T_i$ are the equilibrium density and ion temperature. Let the ion temperature gradient parameter be $\\eta_i = L_n/L_{T_i}$, and the ion diamagnetic frequency be $\\omega_{*i} = k_y T_i/(e B L_n)$.\n\nWork in the drift-kinetic ordering with $\\omega \\ll \\Omega_i$, $k_{\\perp}\\rho_i \\sim \\mathcal{O}(1)$, and adiabatic electrons such that the electron density perturbation satisfies $\\delta n_e/n_0 = e \\varphi/T_e$ for electrostatic potential $\\varphi$. For the ion response, adopt the long-wavelength gyrokinetic quasineutrality relation, in which the gyroaveraged ion density is reduced by finite Larmor radius effects through the gyroaverage factor $\\Gamma_0(b)$, where $b = k_{\\perp}^{2}\\rho_i^{2}$ and $\\Gamma_0(b) = I_0(b)\\exp(-b)$ with $I_0$ the modified Bessel function of the first kind. In the fluid limit of the ion gyrokinetic equation, the non-adiabatic ion response to the ion temperature gradient drive scales with $k_y$ and the ion polarization density scales with $k_{\\perp}^{2}\\rho_i^{2}$.\n\nUsing these foundations and a Padé approximation accurate in both the limits $b \\ll 1$ and $b \\gtrsim 1$, namely $\\Gamma_0(b) \\approx 1/(1 + b)$, derive a reduced long-wavelength expression for the linear Ion Temperature Gradient (ITG) mode growth rate of the form\n$$\n\\gamma(k_y) = \\mathcal{C}\\,\\frac{k_y}{1 + k_{\\perp}^{2}\\rho_i^{2}},\n$$\nwhere $\\mathcal{C}$ is a positive constant that depends on $\\omega_{*i}$, $\\eta_i$, and order-unity geometric factors but is independent of $k_x$ and $k_y$. From this expression, show that for $k_{\\perp}\\rho_i \\ll 1$, the growth rate increases with $k_y$ while for $k_{\\perp}\\rho_i \\gtrsim 1$ it decreases with $k_y$. Then, by maximizing $\\gamma(k_y)$ with respect to $k_y$ at fixed $k_x$, quantify the transition by finding a closed-form analytic expression for the dimensionless transition wavenumber $k_y^{*}\\rho_i$ at which $\\partial \\gamma/\\partial k_y = 0$.\n\nExpress your final answer as the analytic expression for $k_y^{*}\\rho_i$ in terms of $k_x$ and $\\rho_i$. No numerical evaluation or rounding is required, and the answer is dimensionless.",
            "solution": "The problem has been validated and is deemed scientifically grounded, well-posed, and objective. It provides a simplified but physically representative model for the growth rate of Ion Temperature Gradient (ITG) modes and asks for a standard mathematical optimization to be performed. All necessary information is provided.\n\nThe objective is to find the value of the perpendicular wavenumber in the binormal direction, $k_y$, that maximizes the given linear growth rate $\\gamma(k_y)$. This value will be denoted as $k_y^*$. The problem provides the functional form of the growth rate:\n$$\n\\gamma(k_y) = \\mathcal{C}\\,\\frac{k_y}{1 + k_{\\perp}^{2}\\rho_i^{2}}\n$$\nwhere $\\mathcal{C}$ is a positive constant independent of $k_x$ and $k_y$, and $\\rho_i$ is the ion Larmor radius. The square of the perpendicular wavenumber is defined as $k_{\\perp}^{2} = k_{x}^{2} + k_{y}^{2}$. Substituting this definition into the expression for the growth rate gives:\n$$\n\\gamma(k_y) = \\mathcal{C}\\,\\frac{k_y}{1 + (k_{x}^{2} + k_{y}^{2})\\rho_i^{2}}\n$$\nTo find the value of $k_y$ that maximizes this function for a fixed value of $k_x$, we must compute the derivative of $\\gamma(k_y)$ with respect to $k_y$ and set it to zero. We treat $\\mathcal{C}$, $k_x$, and $\\rho_i$ as constants during this process.\n\nWe apply the quotient rule for differentiation, $\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$. Let us define the numerator and denominator of the expression for $\\gamma(k_y)/\\mathcal{C}$:\n$$\nu(k_y) = k_y\n$$\n$$\nv(k_y) = 1 + (k_{x}^{2} + k_{y}^{2})\\rho_i^{2} = 1 + k_{x}^{2}\\rho_i^{2} + k_{y}^{2}\\rho_i^{2}\n$$\nTheir derivatives with respect to $k_y$ are:\n$$\n\\frac{du}{dk_y} = 1\n$$\n$$\n\\frac{dv}{dk_y} = 2k_y\\rho_i^{2}\n$$\nNow, we compute the derivative of $\\gamma(k_y)$:\n$$\n\\frac{\\partial \\gamma}{\\partial k_y} = \\mathcal{C} \\frac{\\frac{du}{dk_y}v(k_y) - u(k_y)\\frac{dv}{dk_y}}{[v(k_y)]^2}\n$$\n$$\n\\frac{\\partial \\gamma}{\\partial k_y} = \\mathcal{C} \\frac{(1)(1 + k_{x}^{2}\\rho_i^{2} + k_{y}^{2}\\rho_i^{2}) - (k_y)(2k_y\\rho_i^{2})}{(1 + k_{x}^{2}\\rho_i^{2} + k_{y}^{2}\\rho_i^{2})^2}\n$$\nSimplifying the numerator, we obtain:\n$$\n\\frac{\\partial \\gamma}{\\partial k_y} = \\mathcal{C} \\frac{1 + k_{x}^{2}\\rho_i^{2} + k_{y}^{2}\\rho_i^{2} - 2k_y^{2}\\rho_i^{2}}{(1 + (k_{x}^{2} + k_{y}^{2})\\rho_i^{2})^2} = \\mathcal{C} \\frac{1 + k_{x}^{2}\\rho_i^{2} - k_{y}^{2}\\rho_i^{2}}{(1 + (k_{x}^{2} + k_{y}^{2})\\rho_i^{2})^2}\n$$\nTo find the extremum, we set the derivative equal to zero. This occurs when the numerator is zero, as the denominator is always positive for real $k_y$ and $k_x$:\n$$\n1 + k_{x}^{2}\\rho_i^{2} - k_{y}^{2}\\rho_i^{2} = 0\n$$\nWe solve this equation for $k_y$. This value of $k_y$ is the desired wavenumber $k_y^*$.\n$$\n(k_y^*)^{2}\\rho_i^{2} = 1 + k_{x}^{2}\\rho_i^{2}\n$$\nSince the growth rate $\\gamma(k_y)$ is positive for $k_y > 0$ (given $\\mathcal{C}>0$), we are interested in the positive solution for $k_y^*$:\n$$\n(k_y^*)^{2} = \\frac{1 + k_{x}^{2}\\rho_i^{2}}{\\rho_i^{2}} \\implies k_y^* = \\frac{\\sqrt{1 + k_{x}^{2}\\rho_i^{2}}}{\\rho_i}\n$$\nThis critical point corresponds to a maximum because the numerator of the derivative, $1 + k_{x}^{2}\\rho_i^{2} - k_{y}^{2}\\rho_i^{2}$, is positive for $k_y < k_y^*$ and negative for $k_y > k_y^*$. This means $\\gamma(k_y)$ is increasing for $k_y < k_y^*$ and decreasing for $k_y > k_y^*$.\n\nThe problem asks for the dimensionless transition wavenumber $k_y^{*}\\rho_i$. We can find this by multiplying our expression for $k_y^*$ by $\\rho_i$:\n$$\nk_y^{*}\\rho_i = \\rho_i \\left( \\frac{\\sqrt{1 + k_{x}^{2}\\rho_i^{2}}}{\\rho_i} \\right)\n$$\n$$\nk_y^{*}\\rho_i = \\sqrt{1 + k_{x}^{2}\\rho_i^{2}}\n$$\nThis expression provides the dimensionless wavenumber $k_y^{*}\\rho_i$ at which the ITG mode growth rate is maximal, in terms of the fixed radial wavenumber component $k_x$ and the ion Larmor radius $\\rho_i$. This corresponds to the transition point where the growth rate ceases to increase with $k_y$ and begins to decrease.",
            "answer": "$$\\boxed{\\sqrt{1 + k_{x}^{2}\\rho_{i}^{2}}}$$"
        },
        {
            "introduction": "While analytical models provide crucial insight, modern plasma physics research relies heavily on numerical simulations to capture the complexity of toroidal geometry. This final practice bridges the gap between simplified theory and computational methods by framing the ITG mode as a numerical eigenvalue problem . You will explore the ballooning formalism, a powerful mathematical tool that simplifies the problem, and then discretize the resulting equation to see how the physical effects of magnetic shear, curvature, and parallel dynamics are implemented in a computational framework.",
            "id": "3704973",
            "problem": "Consider a collisionless, electrostatic, low-beta, magnetized plasma in a toroidal confinement device. Focus on Ion Temperature Gradient (ITG) modes in the local, linear, ballooning-space representation near a rational surface. Assume adiabatic electrons, long-wavelength compared to the ion Larmor radius, and use standard gyrokinetic ordering where the fluctuating potential is small. Begin from the fundamental linear ion gyrokinetic equation and quasineutrality with line-tying along magnetic field lines, and perform the ballooning transform to reduce the problem to a one-dimensional eigenvalue problem in the ballooning angle coordinate. Impose physically motivated boundary conditions at large absolute ballooning angle based on the requirement of bounded energy density.\n\nYour tasks are:\n- Derive, from first principles, a one-dimensional linear eigenvalue problem in ballooning space for the electrostatic potential envelope $\\,\\phi(\\theta)\\,$ in dimensionless units, valid under the above assumptions. Clearly define the boundary condition at large $\\,|\\theta|\\,$, and interpret each term in the reduced equation in terms of parallel compressibility, magnetic shear, and curvature-driven ion temperature gradient drive.\n- Explain how to truncate the infinite domain to a finite interval and choose boundary conditions consistent with the physical decay of $\\,\\phi(\\theta)\\,$.\n- Detail a finite-difference discretization that converts the continuous eigenvalue problem into a generalized matrix eigenvalue problem suitable for numerical solution.\n\nFor the purpose of numerical verification, adopt the following reduced model after your derivation: take the effective potential to be $\\,U(\\theta) = s^2 \\theta^2\\,$, where $\\,s\\,$ is a dimensionless magnetic shear, include a curvature/drive shift $\\,\\Lambda\\,$, and model the linear coupling of the eigenfrequency as a scalar complex factor. In dimensionless form, the reduced eigenvalue problem is to be discretized as\n$$\n-\\,\\frac{d^2 \\phi}{d \\theta^2} \\;+\\; U(\\theta)\\,\\phi \\;-\\; \\Lambda\\,\\phi \\;=\\; \\omega\\,(a + i\\,b)\\,\\phi,\n$$\nwhere $\\,\\omega\\,$ is the complex eigenfrequency normalized to a characteristic drift frequency, $\\,a\\,\\in\\mathbb{R}\\,$ represents a reactive coupling coefficient, and $\\,b\\,\\in\\mathbb{R}_{\\ge 0}\\,$ represents a dissipative or non-Hermitian contribution that can lead to growth when combined with a negative operator eigenvalue. Use the boundary condition $\\,\\phi(\\theta) \\to 0\\,$ as $\\,|\\theta|\\to\\infty\\,$, approximated on a truncated finite interval by homogeneous Dirichlet conditions. All quantities are dimensionless; treat $\\,\\theta\\,$ in radians.\n\nDiscretization requirements:\n- Truncate the domain to $\\,\\theta \\in [-\\theta_{\\max},\\,\\theta_{\\max}]\\,$ with $\\,N\\,$ interior points, and impose homogeneous Dirichlet boundary conditions at the endpoints to mimic decay at large $\\,|\\theta|\\,$.\n- Use second-order centered finite differences for the second derivative on a uniform grid with spacing $\\,h = \\frac{2\\,\\theta_{\\max}}{N+1}\\,$, yielding the standard tridiagonal approximation for $\\,\\frac{d^2}{d\\theta^2}\\,$.\n- Assemble the generalized matrix eigenvalue problem\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} \\;=\\; \\omega\\,\\mathbf{B}\\,\\boldsymbol{\\phi},\n$$\nwith\n$$\n\\mathbf{A} \\;=\\; \\mathbf{L} \\;+\\; \\operatorname{diag}\\!\\big(U(\\theta_j)\\big) \\;-\\; \\Lambda\\,\\mathbf{I},\n\\qquad\n\\mathbf{L} \\;=\\; -\\,\\mathbf{D}_2,\n\\qquad\n\\mathbf{B} \\;=\\; (a + i\\,b)\\,\\mathbf{I},\n$$\nwhere $\\,\\mathbf{D}_2\\,$ is the second-derivative finite-difference matrix with homogeneous Dirichlet boundary conditions, $\\,\\mathbf{I}\\,$ is the identity, and $\\,\\theta_j\\,$ are the interior grid points.\n\nAlgorithmic output requirement:\n- For each test case below, compute all generalized eigenvalues $\\,\\omega_k\\,$ and select the eigenvalue with the largest imaginary part $\\,\\max_k \\operatorname{Im}(\\omega_k)\\,$. Report that largest imaginary part as the numerical proxy for the linear growth rate. If all $\\,\\operatorname{Im}(\\omega_k)\\le 0\\,$, the mode is stable and the reported value will be non-positive.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nTest suite:\n- Case $\\,1\\,$ (expected unstable under strong drive): $\\,N = 64\\,$, $\\,\\theta_{\\max} = 6.0\\,$, $\\,s = 0.6\\,$, $\\,\\Lambda = 120.0\\,$, $\\,a = 1.0\\,$, $\\,b = 0.3\\,$.\n- Case $\\,2\\,$ (expected stable under weak drive): $\\,N = 64\\,$, $\\,\\theta_{\\max} = 6.0\\,$, $\\,s = 0.6\\,$, $\\,\\Lambda = 5.0\\,$, $\\,a = 1.0\\,$, $\\,b = 0.3\\,$.\n- Case $\\,3\\,$ (near-threshold behavior): $\\,N = 48\\,$, $\\,\\theta_{\\max} = 5.0\\,$, $\\,s = 0.9\\,$, $\\,\\Lambda = 60.0\\,$, $\\,a = 0.8\\,$, $\\,b = 0.2\\,$.\n- Case $\\,4\\,$ (purely conservative coupling): $\\,N = 48\\,$, $\\,\\theta_{\\max} = 5.0\\,$, $\\,s = 0.9\\,$, $\\,\\Lambda = 60.0\\,$, $\\,a = 0.8\\,$, $\\,b = 0.0\\,$.\n\nAll numerical values above are dimensionless. Angles $\\,\\theta\\,$ are to be treated in radians. The final output should be the list of four floating-point numbers $\\,\\left[\\operatorname{Im}(\\omega_{\\text{dom},1}), \\operatorname{Im}(\\omega_{\\text{dom},2}), \\operatorname{Im}(\\omega_{\\text{dom},3}), \\operatorname{Im}(\\omega_{\\text{dom},4})\\right]\\,$ on a single line as specified.",
            "solution": "The problem asks for a derivation of the one-dimensional eigenvalue equation for Ion Temperature Gradient (ITG) modes in ballooning space, followed by a numerical solution of a simplified model equation. The validation confirms that the problem is scientifically grounded in plasma physics, well-posed, and provides a clear, self-contained set of instructions for a numerical task. All assumptions and simplifications are standard within the field for pedagogical and research purposes. The problem is valid.\n\n**Part 1: Derivation and Interpretation**\n\nWe begin in a toroidal magnetic confinement system (like a tokamak) with nested magnetic flux surfaces. ITG modes are microinstabilities driven by the spatial gradient of the ion temperature. We consider a collisionless, electrostatic, low-$\\beta$ plasma. The analysis is local to a single rational magnetic surface.\n\nThe starting points are the linear ion gyrokinetic equation for the perturbed ion distribution function, $\\delta f_i$, and the quasineutrality condition, $\\delta n_i = \\delta n_e$. The electrons are assumed to respond adiabatically to the fluctuating electrostatic potential $\\phi$, so their perturbed density is given by the Boltzmann relation $\\delta n_e = n_0 \\frac{e \\phi}{T_e}$, where $n_0$ is the equilibrium density and $T_e$ is the electron temperature.\n\nThe linear Vlasov equation for the guiding-center distribution function $f_i$ is\n$$\n\\frac{\\partial f_i}{\\partial t} + (\\mathbf{v}_\\parallel + \\mathbf{v}_D) \\cdot \\nabla f_i - \\frac{e}{m_i} \\nabla_\\parallel \\phi \\frac{\\partial F_{0i}}{\\partial E} = 0\n$$\nwhere $F_{0i}$ is the background Maxwellian distribution, and $\\mathbf{v}_D$ is the magnetic drift (curvature and $\\nabla B$). We linearize this equation for a perturbation of the form $\\phi(\\mathbf{r}, t) = \\phi(\\mathbf{r}) e^{-i\\omega t}$.\n\nThe core difficulty in analyzing modes in a torus is that the magnetic field strength and curvature vary on a flux surface. This couples different poloidal harmonics. The ballooning transformation is a mathematical tool to handle this. It transforms the two-dimensional problem in the radial ($r$) and poloidal ($\\theta$) directions on a flux surface into a one-dimensional problem in an extended, infinite poloidal angle coordinate, also denoted $\\theta$. A fluctuating quantity $\\Phi(r, \\theta, \\zeta)$ (where $\\zeta$ is the toroidal angle) is represented as:\n$$\n\\Phi(r, \\theta, \\zeta) = e^{-in\\zeta} \\sum_{m} e^{im\\theta} \\phi_m(r) \\rightarrow e^{-in\\zeta} \\int_{-\\infty}^{\\infty} d\\theta_k e^{inq\\theta_k} \\hat{\\phi}(\\theta_k, r)\n$$\nAssuming the mode is strongly localized around a rational surface $r=r_0$ where $q(r_0)=m_0/n_0$, the mode structure is represented by a single envelope function $\\phi(\\theta)$ in the extended ballooning coordinate $\\theta \\in (-\\infty, \\infty)$. The parallel and perpendicular wavevectors in this representation become operators:\n$$\nk_\\parallel \\rightarrow \\frac{1}{q R_0} (-i \\frac{\\partial}{\\partial \\theta})\n$$\n$$\nk_\\perp^2 \\rightarrow k_y^2 [1 + (s\\theta - \\alpha \\sin\\theta)^2]\n$$\nwhere $k_y = nq/r$ is the binormal wavevector, $q$ is the safety factor, $R_0$ is the major radius, $s = (r/q) (dq/dr)$ is the magnetic shear, and $\\alpha = -2(r/R_0)(1-q^{-2})$ is related to the ballooning parameter.\n\nThe ion density perturbation $\\delta n_i = \\int d^3v \\, \\delta f_i$ is calculated by solving the gyrokinetic equation for $\\delta f_i$ and integrating over velocity space. In the long-wavelength limit ($k_\\perp \\rho_i \\ll 1$, where $\\rho_i$ is the ion Larmor radius), and using the assumptions of the problem, the quasineutrality condition $\\delta n_e = \\delta n_i$ yields a second-order ordinary differential equation for the potential envelope $\\phi(\\theta)$:\n$$\n\\left[ \\frac{\\partial^2}{\\partial \\theta^2} + k_y^2 \\rho_s^2 (s\\theta)^2 + \\frac{q^2}{\\tau} \\left( \\frac{\\omega_{*e}}{\\omega} - 1 - \\frac{\\omega_{Di}}{\\omega} \\left( 1 + \\eta_i \\right) \\right) \\right] \\phi(\\theta) = 0\n$$\nHere, $\\tau=T_e/T_i$, $\\omega_{*e}$ is the electron diamagnetic drift frequency, $\\omega_{Di} \\approx 2 \\epsilon_n \\omega_{*e} (\\cos\\theta + s\\theta \\sin\\theta)$ is the ion magnetic drift frequency which includes curvature effects, and $\\eta_i = d(\\ln T_i)/d(\\ln n_i)$ is the ratio of density to temperature gradient scale lengths. This equation is still complex. The problem provides a simplified phenomenological model that captures the essential physics:\n$$\n-\\,\\frac{d^2 \\phi}{d \\theta^2} \\;+\\; U(\\theta)\\,\\phi \\;-\\; \\Lambda\\,\\phi \\;=\\; \\omega\\,(a + i\\,b)\\,\\phi\n$$\nThis is a Schrödinger-like eigenvalue equation. Let us interpret its terms:\n1.  $-\\frac{d^2\\phi}{d\\theta^2}$: This term originates from the $k_\\parallel^2$ operator and represents the effect of ion motion along the magnetic field lines. It corresponds to parallel ion compressibility and sound wave propagation. This effect tends to \"short out\" the potential fluctuation along the field lines, which is a stabilizing mechanism.\n2.  $U(\\theta) = s^2 \\theta^2$: This term is a simplified representation of the $k_\\perp^2$ variation. The magnetic shear $s$ causes the mode's effective radial wavevector to increase for large $|\\theta|$, enhancing various damping mechanisms (not explicitly included but modeled by this term) and localizing the mode. It acts as a potential well, confining the eigenfunction $\\phi(\\theta)$ around $\\theta=0$.\n3.  $\\Lambda$: This term represents the instability drive, which for ITG modes arises from the combination of unfavorable magnetic curvature and the ion pressure gradient (proportional to $1+\\eta_i$). A larger $\\Lambda$ corresponds to a stronger drive. It effectively lowers the potential energy floor, making it easier for a bound state (an unstable mode) to exist. In the full physics model, this term is coupled with the frequency $\\omega$.\n4.  $\\omega(a + i b)\\phi$: This is the eigenvalue term. $\\omega$ is the complex mode frequency, with $\\operatorname{Re}(\\omega)$ being the oscillation frequency and $\\operatorname{Im}(\\omega)$ being the growth rate. The complex factor $(a+ib)$ models the complicated frequency dependence of the full plasma response, which has been simplified away on the left-hand side. The imaginary part $b$ represents non-Hermitian effects like kinetic wave-particle resonances that are necessary for growth. A positive growth rate, $\\operatorname{Im}(\\omega) > 0$, signifies an unstable mode.\n\n**Boundary Conditions and Discretization**\n\nA physically meaningful mode must be spatially localized, implying its energy density (proportional to $|\\phi|^2$) must be integrable. This requires that the eigenfunction $\\phi(\\theta)$ must decay to zero as $|\\theta| \\to \\infty$. The potential $U(\\theta)=s^2\\theta^2$ ensures that all solutions are indeed localized and decay exponentially.\n\nFor a numerical solution, we truncate the infinite domain $\\theta \\in (-\\infty, \\infty)$ to a finite interval $[-\\theta_{\\max}, \\theta_{\\max}]$. If $\\theta_{\\max}$ is chosen large enough, the eigenfunction will be negligibly small at the boundaries. We can therefore approximate the decay condition with the homogeneous Dirichlet boundary conditions: $\\phi(-\\theta_{\\max}) = 0$ and $\\phi(\\theta_{\\max}) = 0$.\n\nWe discretize this continuous problem using a finite-difference scheme. We define a uniform grid of $N$ interior points $\\theta_j = -\\theta_{\\max} + j h$ for $j=1, \\dots, N$, with grid spacing $h = \\frac{2\\theta_{\\max}}{N+1}$. The vector of function values at these points is $\\boldsymbol{\\phi} = [\\phi_1, \\phi_2, \\dots, \\phi_N]^T$. The second derivative is approximated using a second-order centered difference stencil:\n$$\n\\frac{d^2\\phi}{d\\theta^2}\\bigg|_{\\theta_j} \\approx \\frac{\\phi_{j-1} - 2\\phi_j + \\phi_{j+1}}{h^2}\n$$\nWith the boundary conditions $\\phi_0 = \\phi_{N+1} = 0$, the operator $-\\frac{d^2}{d\\theta^2}$ becomes an $N \\times N$ matrix $\\mathbf{L}$:\n$$\n\\mathbf{L} = \\frac{1}{h^2} \\begin{pmatrix} 2 & -1 & 0 & \\cdots & 0 \\\\ -1 & 2 & -1 & & 0 \\\\ 0 & -1 & \\ddots & \\ddots & \\vdots \\\\ \\vdots & & \\ddots & 2 & -1 \\\\ 0 & \\cdots & 0 & -1 & 2 \\end{pmatrix}\n$$\nThe potential term $U(\\theta)\\phi$ becomes a diagonal matrix multiplying $\\boldsymbol{\\phi}$, with elements $\\operatorname{diag}(U(\\theta_j)) = \\operatorname{diag}(s^2\\theta_j^2)$. The constant term $-\\Lambda\\phi$ becomes $-\\Lambda\\mathbf{I}$, where $\\mathbf{I}$ is the identity matrix. The eigenvalue problem is thus converted into a generalized matrix eigenvalue problem:\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} = \\omega\\,\\mathbf{B}\\,\\boldsymbol{\\phi}\n$$\nwhere the matrices $\\mathbf{A}$ and $\\mathbf{B}$ are given by:\n$$\n\\mathbf{A} = \\mathbf{L} + \\operatorname{diag}(s^2 \\theta_j^2) - \\Lambda\\mathbf{I}\n$$\n$$\n\\mathbf{B} = (a + i b)\\mathbf{I}\n$$\nThis system can be solved numerically for the eigenvalues $\\omega$ and their corresponding eigenvectors $\\boldsymbol{\\phi}$. The instability growth rate is the largest imaginary part found among all eigenvalues.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Solves the generalized eigenvalue problem for a simplified ITG mode model\n    for a series of test cases and reports the maximum growth rate for each.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, theta_max, s, Lambda, a, b)\n        (64, 6.0, 0.6, 120.0, 1.0, 0.3),\n        (64, 6.0, 0.6, 5.0, 1.0, 0.3),\n        (48, 5.0, 0.9, 60.0, 0.8, 0.2),\n        (48, 5.0, 0.9, 60.0, 0.8, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, theta_max, s, Lambda, a, b = case\n\n        # 1. Set up the grid\n        # Grid spacing for N interior points. The total number of intervals is N+1.\n        h = 2.0 * theta_max / (N + 1)\n        # Interior grid points from -theta_max+h to theta_max-h\n        theta_j = np.linspace(-theta_max + h, theta_max - h, N)\n\n        # 2. Construct the matrices A and B for the problem A*phi = omega*B*phi\n\n        # Construct matrix L = -D_2, representing the -d^2/d(theta)^2 operator\n        # with homogeneous Dirichlet boundary conditions.\n        # This is a tridiagonal matrix.\n        main_diag_L = np.full(N, 2.0 / h**2)\n        off_diag_L = np.full(N - 1, -1.0 / h**2)\n        L = np.diag(main_diag_L) + np.diag(off_diag_L, k=1) + np.diag(off_diag_L, k=-1)\n        \n        # Construct the potential matrix U_mat = diag(U(theta_j))\n        U_theta = s**2 * theta_j**2\n        U_mat = np.diag(U_theta)\n\n        # Construct matrix A = L + U_mat - Lambda*I\n        I = np.eye(N)\n        A = L + U_mat - Lambda * I\n\n        # Construct matrix B = (a + i*b)*I\n        B = (a + 1j * b) * I\n\n        # 3. Solve the generalized eigenvalue problem\n        # scipy.linalg.eig solves A*v = w*B*v, where w are the eigenvalues.\n        try:\n            eigenvalues, _ = eig(A, b=B)\n        except np.linalg.LinAlgError:\n            # Should not happen with the given B matrix as it's non-singular.\n            # But as a safeguard:\n            results.append(np.nan)\n            continue\n            \n        # 4. Find the dominant growth rate\n        # The growth rate is the imaginary part of the eigenvalue omega.\n        # We are looking for the most unstable mode, which has the largest growth rate.\n        if eigenvalues is not None and len(eigenvalues) > 0:\n            max_growth_rate = np.max(np.imag(eigenvalues))\n        else:\n            max_growth_rate = 0.0 # Or handle as an error\n            \n        results.append(max_growth_rate)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}