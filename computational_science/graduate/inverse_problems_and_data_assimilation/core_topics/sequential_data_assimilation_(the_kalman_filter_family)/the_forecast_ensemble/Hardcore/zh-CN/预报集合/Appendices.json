{
    "hands_on_practices": [
        {
            "introduction": "为了真正掌握预报集合，我们必须首先理解其核心机制：集合卡尔曼滤波（EnKF）的分析步骤。本练习将引导你手动完成一个完整的随机EnKF分析更新。通过在一个小规模的线性问题中，从计算集合均值和协方差，到构建卡尔曼增益，再到利用扰动观测来更新每个集合成员，你将亲身体验信息是如何从观测中融入到预报集合中，从而减少不确定性。",
            "id": "3425298",
            "problem": "考虑一个线性数据同化设定，其中状态向量为 $x \\in \\mathbb{R}^{2}$，观测模型为 $y = \\mathbf{H} x + v$，其中 $v$ 是高斯观测噪声，其分布为 $v \\sim \\mathcal{N}(0,\\mathbf{R})$。给定一个包含 $N=4$ 个成员的预报集合、观测算子 $\\mathbf{H}$、观测噪声协方差 $\\mathbf{R}$ 以及一个实现的观测值 $y$。执行随机集合卡尔曼滤波器 (EnKF) 的一个分析步骤，为了可复现性，使用固定的合成观测扰动，然后计算分析集合平均的第一个分量。\n\n提供的量如下：\n- 观测算子 $\\mathbf{H} = \\begin{pmatrix} 1  2 \\end{pmatrix}$。\n- 观测噪声协方差 $\\mathbf{R} = \\begin{pmatrix} \\frac{1}{25} \\end{pmatrix}$。\n- 实现的观测值 $y = 1$。\n- 预报集合成员（写为列向量）：\n$$\nx_{1}^{f} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad\nx_{2}^{f} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\quad\nx_{3}^{f} = \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix}, \\quad\nx_{4}^{f} = \\begin{pmatrix} -1 \\\\ 2 \\end{pmatrix}.\n$$\n- 合成观测扰动（从 $\\mathcal{N}(0,\\mathbf{R})$ 中抽取的固定样本，用于随机 EnKF 更新）：\n$$\ne_{1} = \\frac{1}{10}, \\quad e_{2} = -\\frac{1}{25}, \\quad e_{3} = 0, \\quad e_{4} = -\\frac{3}{25}.\n$$\n\n请遵循线性高斯情况下标准的随机集合卡尔曼滤波器 (EnKF) 分析步骤：使用无偏样本协方差估计量（分母为 $N-1$）来形成状态空间中的预报样本协方差，构建观测空间中对应的协方差，计算增益，然后使用合成观测扰动更新每个集合成员。完成这些步骤后，计算分析集合平均向量。您的任务是提供分析集合平均的第一个分量，形式为一个精确的既约分数。不需要四舍五入，也不涉及单位。",
            "solution": "该问题是有效的，因为它提出了数据同化领域一个适定的、有科学依据的情景，并为唯一解提供了所有必要数据。我们将继续求解分析集合平均的第一个分量。\n\n随机集合卡尔曼滤波器 (EnKF) 的分析步骤根据以下公式将每个预报集合成员 $x_j^f$ 更新为分析成员 $x_j^a$：\n$$x_j^a = x_j^f + \\mathbf{K} (y_j - \\mathbf{H} x_j^f)$$\n其中 $y_j = y + e_j$ 是第 $j$ 个成员的扰动观测，而 $e_j$ 是从观测误差分布 $\\mathcal{N}(0,\\mathbf{R})$ 中随机抽取的一个样本。对于本问题，扰动 $e_j$ 以固定的合成值形式提供。卡尔曼增益 $\\mathbf{K}$ 由下式给出：\n$$\\mathbf{K} = \\mathbf{P}^f \\mathbf{H}^T (\\mathbf{H} \\mathbf{P}^f \\mathbf{H}^T + \\mathbf{R})^{-1}$$\n这里，$\\mathbf{P}^f$ 是预报集合的样本协方差。\n\n主要目标是找到分析集合平均 $\\bar{x}^a = \\frac{1}{N} \\sum_{j=1}^{N} x_j^a$。我们可以为平均值推导一个直接的更新公式：\n$$ \\bar{x}^a = \\frac{1}{N} \\sum_{j=1}^{N} \\left( x_j^f + \\mathbf{K} (y + e_j - \\mathbf{H} x_j^f) \\right) $$\n$$ \\bar{x}^a = \\left( \\frac{1}{N} \\sum_{j=1}^{N} x_j^f \\right) + \\mathbf{K} \\left( \\frac{1}{N} \\sum_{j=1}^{N} (y + e_j - \\mathbf{H} x_j^f) \\right) $$\n$$ \\bar{x}^a = \\bar{x}^f + \\mathbf{K} \\left( y + \\left(\\frac{1}{N} \\sum_{j=1}^{N} e_j\\right) - \\mathbf{H} \\left(\\frac{1}{N} \\sum_{j=1}^{N} x_j^f\\right) \\right) $$\n$$ \\bar{x}^a = \\bar{x}^f + \\mathbf{K} (y + \\bar{e} - \\mathbf{H} \\bar{x}^f) $$\n其中 $\\bar{e}$ 是所提供的合成扰动的平均值。我们将系统地计算此方程中的各项。\n\n步骤 1：计算预报集合平均 $\\bar{x}^f$。\n预报集合有 $N=4$ 个成员：\n$$ x_{1}^{f} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad x_{2}^{f} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\quad x_{3}^{f} = \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix}, \\quad x_{4}^{f} = \\begin{pmatrix} -1 \\\\ 2 \\end{pmatrix} $$\n平均值为：\n$$ \\bar{x}^f = \\frac{1}{4} \\left( \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix} + \\begin{pmatrix} -1 \\\\ 2 \\end{pmatrix} \\right) = \\frac{1}{4} \\begin{pmatrix} 1+0+2-1 \\\\ 0+1-1+2 \\end{pmatrix} = \\frac{1}{4} \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix} $$\n\n步骤 2：计算样本预报协方差 $\\mathbf{P}^f$。\n问题指定使用分母为 $N-1 = 3$ 的无偏估计量。\n$$ \\mathbf{P}^f = \\frac{1}{3} \\sum_{j=1}^{4} (x_j^f - \\bar{x}^f)(x_j^f - \\bar{x}^f)^T $$\n集合扰动为：\n$$ x_1' = \\begin{pmatrix} 1 - \\frac{1}{2} \\\\ 0 - \\frac{1}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} \\\\ -\\frac{1}{2} \\end{pmatrix}, \\quad x_2' = \\begin{pmatrix} 0 - \\frac{1}{2} \\\\ 1 - \\frac{1}{2} \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix} $$\n$$ x_3' = \\begin{pmatrix} 2 - \\frac{1}{2} \\\\ -1 - \\frac{1}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{3}{2} \\\\ -\\frac{3}{2} \\end{pmatrix}, \\quad x_4' = \\begin{pmatrix} -1 - \\frac{1}{2} \\\\ 2 - \\frac{1}{2} \\end{pmatrix} = \\begin{pmatrix} -\\frac{3}{2} \\\\ \\frac{3}{2} \\end{pmatrix} $$\n外积之和为：\n$$ \\sum_{j=1}^{4} x_j' (x_j')^T = \\begin{pmatrix} \\frac{1}{4}  -\\frac{1}{4} \\\\ -\\frac{1}{4}  \\frac{1}{4} \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{4}  -\\frac{1}{4} \\\\ -\\frac{1}{4}  \\frac{1}{4} \\end{pmatrix} + \\begin{pmatrix} \\frac{9}{4}  -\\frac{9}{4} \\\\ -\\frac{9}{4}  \\frac{9}{4} \\end{pmatrix} + \\begin{pmatrix} \\frac{9}{4}  -\\frac{9}{4} \\\\ -\\frac{9}{4}  \\frac{9}{4} \\end{pmatrix} = \\begin{pmatrix} \\frac{20}{4}  -\\frac{20}{4} \\\\ -\\frac{20}{4}  \\frac{20}{4} \\end{pmatrix} = \\begin{pmatrix} 5  -5 \\\\ -5  5 \\end{pmatrix} $$\n因此，样本协方差为：\n$$ \\mathbf{P}^f = \\frac{1}{3} \\begin{pmatrix} 5  -5 \\\\ -5  5 \\end{pmatrix} = \\begin{pmatrix} \\frac{5}{3}  -\\frac{5}{3} \\\\ -\\frac{5}{3}  \\frac{5}{3} \\end{pmatrix} $$\n\n步骤 3：计算卡尔曼增益 $\\mathbf{K}$。\n首先，我们计算 $\\mathbf{P}^f \\mathbf{H}^T$：\n$$ \\mathbf{P}^f \\mathbf{H}^T = \\begin{pmatrix} \\frac{5}{3}  -\\frac{5}{3} \\\\ -\\frac{5}{3}  \\frac{5}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} \\frac{5}{3} - \\frac{10}{3} \\\\ -\\frac{5}{3} + \\frac{10}{3} \\end{pmatrix} = \\begin{pmatrix} -\\frac{5}{3} \\\\ \\frac{5}{3} \\end{pmatrix} $$\n接下来，我们计算项 $\\mathbf{H} \\mathbf{P}^f \\mathbf{H}^T$：\n$$ \\mathbf{H} \\mathbf{P}^f \\mathbf{H}^T = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} -\\frac{5}{3} \\\\ \\frac{5}{3} \\end{pmatrix} = -\\frac{5}{3} + \\frac{10}{3} = \\frac{5}{3} $$\n观测噪声协方差为 $\\mathbf{R} = \\frac{1}{25}$。增益表达式的分母是：\n$$ \\mathbf{H} \\mathbf{P}^f \\mathbf{H}^T + \\mathbf{R} = \\frac{5}{3} + \\frac{1}{25} = \\frac{125}{75} + \\frac{3}{75} = \\frac{128}{75} $$\n其逆为 $(\\frac{128}{75})^{-1} = \\frac{75}{128}$。\n现在，我们计算卡尔曼增益 $\\mathbf{K}$：\n$$ \\mathbf{K} = (\\mathbf{P}^f \\mathbf{H}^T) (\\mathbf{H} \\mathbf{P}^f \\mathbf{H}^T + \\mathbf{R})^{-1} = \\begin{pmatrix} -\\frac{5}{3} \\\\ \\frac{5}{3} \\end{pmatrix} \\left(\\frac{75}{128}\\right) = \\begin{pmatrix} -\\frac{5 \\cdot 75}{3 \\cdot 128} \\\\ \\frac{5 \\cdot 75}{3 \\cdot 128} \\end{pmatrix} = \\begin{pmatrix} -\\frac{5 \\cdot 25}{128} \\\\ \\frac{5 \\cdot 25}{128} \\end{pmatrix} = \\begin{pmatrix} -\\frac{125}{128} \\\\ \\frac{125}{128} \\end{pmatrix} $$\n\n步骤 4：计算平均值更新公式的各项。\n观测值为 $y = 1$。\n合成扰动的平均值为：\n$$ \\bar{e} = \\frac{1}{4} \\left( \\frac{1}{10} - \\frac{1}{25} + 0 - \\frac{3}{25} \\right) = \\frac{1}{4} \\left( \\frac{1}{10} - \\frac{4}{25} \\right) = \\frac{1}{4} \\left( \\frac{5}{50} - \\frac{8}{50} \\right) = \\frac{1}{4} \\left( -\\frac{3}{50} \\right) = -\\frac{3}{200} $$\n平均预报观测值为：\n$$ \\mathbf{H} \\bar{x}^f = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix} = \\frac{1}{2} + \\frac{2}{2} = \\frac{3}{2} $$\n平均新息项为：\n$$ y + \\bar{e} - \\mathbf{H} \\bar{x}^f = 1 - \\frac{3}{200} - \\frac{3}{2} = \\frac{200}{200} - \\frac{3}{200} - \\frac{300}{200} = -\\frac{103}{200} $$\n\n步骤 5：计算分析集合平均 $\\bar{x}^a$ 及其第一个分量。\n$$ \\bar{x}^a = \\bar{x}^f + \\mathbf{K} (y + \\bar{e} - \\mathbf{H} \\bar{x}^f) = \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix} + \\begin{pmatrix} -\\frac{125}{128} \\\\ \\frac{125}{128} \\end{pmatrix} \\left( -\\frac{103}{200} \\right) $$\n我们关心的是 $\\bar{x}^a$ 的第一个分量，记为 $(\\bar{x}^a)_1$：\n$$ (\\bar{x}^a)_1 = \\frac{1}{2} + \\left(-\\frac{125}{128}\\right) \\left(-\\frac{103}{200}\\right) = \\frac{1}{2} + \\frac{125 \\cdot 103}{128 \\cdot 200} $$\n我们简化分数：$\\frac{125}{200} = \\frac{5 \\cdot 25}{8 \\cdot 25} = \\frac{5}{8}$。\n$$ (\\bar{x}^a)_1 = \\frac{1}{2} + \\frac{5 \\cdot 103}{128 \\cdot 8} = \\frac{1}{2} + \\frac{515}{1024} $$\n为了将这些分数相加，我们找到一个公分母：\n$$ (\\bar{x}^a)_1 = \\frac{512}{1024} + \\frac{515}{1024} = \\frac{1027}{1024} $$\n分子是 $1027 = 13 \\times 79$，分母是 $1024 = 2^{10}$。该分数为最简分数。\n分析集合平均的第一个分量是 $\\frac{1027}{1024}$。",
            "answer": "$$\\boxed{\\frac{1027}{1024}}$$"
        },
        {
            "introduction": "在实践中，由于计算资源的限制，预报集合的成员数量通常远小于模式状态空间的维度，这会导致所谓的“子采样”问题，系统性地低估了预报误差协方差。为了解决这个问题，数据同化领域引入了协方差膨胀技术。本练习通过一个基础的数学推导，揭示了最常用的“乘法膨胀”是如何在不改变集合均值（即中心估计）的情况下，有效增加集合离散度（即不确定性）的。",
            "id": "3425670",
            "problem": "考虑一个集合卡尔曼滤波器（EnKF）中的预报集合，其状态维度为 $n$，集合大小为 $N \\ge 2$。设集合矩阵为 $X \\in \\mathbb{R}^{n \\times N}$，集合均值为 $x^{\\mathrm{f}} = \\frac{1}{N} X \\mathbf{1}$（其中 $\\mathbf{1} \\in \\mathbb{R}^{N}$ 是全一向量），扰动为 $A = X - x^{\\mathrm{f}} \\mathbf{1}^{\\top} \\in \\mathbb{R}^{n \\times N}$。预报样本协方差定义为 $P = \\frac{1}{N-1} A A^{\\top} \\in \\mathbb{R}^{n \\times n}$。\n\n通过一个标量因子 $\\lambda > 1$ 对扰动进行乘性膨胀，产生膨胀后的扰动 $A' = \\lambda A$ 和膨胀后的集合 $X' = x^{\\mathrm{f}} \\mathbf{1}^{\\top} + A'$。仅从这些定义出发，判断集合均值在此膨胀下是否保持不变，并推导变换后的预报样本协方差 $P'$，用 $\\lambda$ 和 $P$ 表示。\n\n请将变换后的预报样本协方差 $P'$ 作为最终答案，以单一的闭式解析表达式给出。无需数值取整，也无需单位。",
            "solution": "问题陈述已经过严格验证，被认为是自洽的、在数据同化领域有科学依据且数学上是适定的。所有定义在集合卡尔曼滤波器（EnKF）的背景下都是标准的。该问题有效，将推导其解。\n\n任务有两部分：首先，确定集合均值在指定的乘性膨胀下是否不变；其次，推导新的预报样本协方差矩阵 $P'$ 关于膨胀因子 $\\lambda$ 和原始协方差矩阵 $P$ 的表达式。\n\n我们首先处理第一部分：集合均值的保持性。原始集合均值由 $x^{\\mathrm{f}} = \\frac{1}{N} X \\mathbf{1}$ 给出。膨胀后的集合定义为 $X' = x^{\\mathrm{f}} \\mathbf{1}^{\\top} + A'$，其中 $A' = \\lambda A$。新的集合均值，我们记为 $x'^{\\mathrm{f}}$，通过将均值的定义应用于新的集合矩阵 $X'$ 来计算：\n$$\nx'^{\\mathrm{f}} = \\frac{1}{N} X' \\mathbf{1}\n$$\n代入 $X'$ 的表达式，我们得到：\n$$\nx'^{\\mathrm{f}} = \\frac{1}{N} \\left( x^{\\mathrm{f}} \\mathbf{1}^{\\top} + A' \\right) \\mathbf{1}\n$$\n将右侧的向量 $\\mathbf{1}$ 分配进去，我们得到：\n$$\nx'^{\\mathrm{f}} = \\frac{1}{N} \\left( x^{\\mathrm{f}} \\mathbf{1}^{\\top} \\mathbf{1} + A' \\mathbf{1} \\right)\n$$\n乘积 $\\mathbf{1}^{\\top} \\mathbf{1}$ 是全一向量与自身的点积，即其 $N$ 个分量（每个都等于1）的总和。因此，$\\mathbf{1}^{\\top} \\mathbf{1} = N$。第一项变为 $x^{\\mathrm{f}} N$。\n\n对于第二项 $A' \\mathbf{1}$，我们首先代入 $A' = \\lambda A$：\n$$\nA' \\mathbf{1} = (\\lambda A) \\mathbf{1} = \\lambda (A \\mathbf{1})\n$$\n现在我们必须计算项 $A \\mathbf{1}$。使用扰动矩阵的定义 $A = X - x^{\\mathrm{f}} \\mathbf{1}^{\\top}$：\n$$\nA \\mathbf{1} = \\left( X - x^{\\mathrm{f}} \\mathbf{1}^{\\top} \\right) \\mathbf{1} = X \\mathbf{1} - x^{\\mathrm{f}} \\mathbf{1}^{\\top} \\mathbf{1}\n$$\n根据集合均值的定义 $x^{\\mathrm{f}} = \\frac{1}{N} X \\mathbf{1}$，我们可以写出 $X \\mathbf{1} = N x^{\\mathrm{f}}$。将此式和 $\\mathbf{1}^{\\top} \\mathbf{1} = N$ 代入 $A \\mathbf{1}$ 的表达式中，我们发现：\n$$\nA \\mathbf{1} = N x^{\\mathrm{f}} - x^{\\mathrm{f}} N = \\mathbf{0}\n$$\n这证明了一个基本性质：扰动向量（$A$ 的列）之和为零向量。因此，$A' \\mathbf{1} = \\lambda (A \\mathbf{1}) = \\lambda \\mathbf{0} = \\mathbf{0}$。\n\n将这些结果代回新均值 $x'^{\\mathrm{f}}$ 的表达式中：\n$$\nx'^{\\mathrm{f}} = \\frac{1}{N} \\left( x^{\\mathrm{f}} N + \\mathbf{0} \\right) = \\frac{1}{N} (N x^{\\mathrm{f}}) = x^{\\mathrm{f}}\n$$\n这证明了集合均值在这种形式的乘性膨胀下是保持不变的，即 $x'^{\\mathrm{f}} = x^{\\mathrm{f}}$。这是膨胀技术的一个关键特性，它确保了状态的中心估计值不发生偏移，而离散度则增加。\n\n接下来，我们处理第二部分：推导变换后的预报样本协方差 $P'$。应用于膨胀后集合的预报样本协方差的定义是：\n$$\nP' = \\frac{1}{N-1} A' (A')^{\\top}\n$$\n我们已知膨胀后的扰动为 $A' = \\lambda A$。将其代入 $P'$ 的定义中：\n$$\nP' = \\frac{1}{N-1} (\\lambda A) (\\lambda A)^{\\top}\n$$\n利用标量与矩阵乘积的转置性质 $(\\lambda A)^{\\top} = \\lambda A^{\\top}$，我们可以将表达式重写为：\n$$\nP' = \\frac{1}{N-1} (\\lambda A) (\\lambda A^{\\top})\n$$\n由于 $\\lambda$ 是一个标量，我们可以交换因子：\n$$\nP' = \\frac{1}{N-1} \\lambda^2 (A A^{\\top})\n$$\n将标量项 $\\lambda^2$ 从表达式中提出：\n$$\nP' = \\lambda^2 \\left( \\frac{1}{N-1} A A^{\\top} \\right)\n$$\n我们认出括号中的项是原始预报样本协方差的定义，$P = \\frac{1}{N-1} A A^{\\top}$。因此，膨胀后的协方差矩阵与原始协方差矩阵之间的关系是：\n$$\nP' = \\lambda^2 P\n$$\n这个结果表明，对集合扰动应用乘性膨胀因子 $\\lambda$ 会导致预报误差协方差矩阵按因子 $\\lambda^2$进行缩放。这是因为协方差是二阶矩，因此它会随着应用于基础变量（扰动）的缩放因子的平方进行缩放。",
            "answer": "$$\n\\boxed{\\lambda^{2} P}\n$$"
        },
        {
            "introduction": "预报集合的最终目标是捕捉和追踪动态系统中最关键的不确定性来源，这通常与系统的动力不稳定性紧密相关。本计算实践模拟了“起转”（spin-up）过程，让你观察一个初始信息量不足的集合，在经历多个数据同化循环后，其误差协方差结构如何逐渐演变并与系统的“不稳定子空间”对齐。这个练习将抽象的理论概念转化为一个可观察、可量化的动态过程，加深对集合在混沌系统中作用的理解。",
            "id": "3425714",
            "problem": "考虑一个动力系统的离散时间、线性、高斯数据同化循环，该系统状态向量维度为 $n$，由预报算子的切线性模型控制。模型状态按 $x_{k+1} = M x_k + w_k$ 演化，其中 $x_k \\in \\mathbb{R}^n$ 是循环 $k$ 时的状态，$M \\in \\mathbb{R}^{n \\times n}$ 是切线性模型（非线性模型 $M'(x)$ 沿某轨迹求值的雅可比矩阵，在本问题中假定为常数），$w_k \\sim \\mathcal{N}(0,Q)$ 是协方差为 $Q \\in \\mathbb{R}^{n \\times n}$ 的高斯过程噪声。观测由 $y_k = H x_k + v_k$ 给出，其中观测算子为 $H \\in \\mathbb{R}^{m \\times n}$，$v_k \\sim \\mathcal{N}(0,R)$ 是协方差为 $R \\in \\mathbb{R}^{m \\times m}$ 的高斯观测噪声。预报误差协方差为 $P_f \\in \\mathbb{R}^{n \\times n}$，分析误差协方差为 $P_a \\in \\mathbb{R}^{n \\times n}$。\n\n从一个较差的初始先验开始的预报集合启动过程，其特征是 $P_f$ 与 $M$ 的动力学不稳定子空间对齐。假设 $M$ 的谱为实数且为正，并假设 $M$ 可被正交对角化为 $M = V \\Lambda V^\\top$，其中 $V \\in \\mathbb{R}^{n \\times n}$ 是正交矩阵（即 $V^\\top V = I$），$\\Lambda = \\operatorname{diag}(\\lambda_1,\\dots,\\lambda_n)$ 且 $\\lambda_i > 0$。定义不稳定子空间 $\\mathcal{U}$ 为 $M$ 对应于特征值 $\\lambda_i > 1$ 的特征向量所张成的空间。设 $r$ 为 $\\mathcal{U}$ 的维数（即满足 $\\lambda_i > 1$ 的 $\\lambda_i$ 的数量）。$P_f$ 与 $\\mathcal{U}$ 的对齐程度通过子空间之间的主交角来量化：设 $U \\in \\mathbb{R}^{n \\times r}$ 是 $\\mathcal{U}$ 的一个标准正交基，设 $V_r \\in \\mathbb{R}^{n \\times r}$ 是由 $P_f$ 对应其最大 $r$ 个特征值的 $r$ 个标准正交特征向量构成的矩阵。由 $U$ 和 $V_r$ 的列向量张成的子空间之间的主交角的余弦是 $U^\\top V_r$ 的奇异值。定义一个对齐阈值 $\\tau \\in (0,1)$，当 $U^\\top V_r$ 的最小奇异值大于或等于 $\\tau$ 时，我们认为 $P_f$ 与 $\\mathcal{U}$ 对齐。\n\n从一个初始的较差先验协方差 $P_f^{(0)} = \\sigma_0^2 I$（其中 $\\sigma_0^2 > 0$）开始，给定 $Q$、$R$ 和 $H$，数据同化循环通过交替进行预报和分析步骤来推进。$P_f$ 首次达到与 $\\mathcal{U}$ 对齐（如上定义）所需的循环次数，取决于 $M$ 的谱和观测网络 $H$ 的几何结构。您的任务是，对于一组指定的测试用例，使用标准的线性高斯卡尔曼滤波器（KF）协方差更新来进行预报和分析步骤，并计算首次满足对齐准则的循环指数 $k$。如果在指定的最大循环次数 $k_{\\max}$ 内未达到对齐，则该测试用例报告 $-1$。\n\n对于每个测试用例，系统由以下参数指定：$n$、特征值 $\\lambda_i$、一个确定性构造的正交特征基 $V$、表示为状态坐标选择（单位矩阵的行）的观测算子 $H$、取为缩放单位矩阵的协方差 $Q$ 和 $R$，以及初始先验方差 $\\sigma_0^2$。在每个循环中，应根据线性高斯假设下的标准卡尔曼滤波器协方差传播来更新预报和分析协方差。使用 Joseph 稳定形式的分析协方差更新。在每个循环中，使用如上定义的主交角评估对齐准则，并记录 $U^\\top V_r$ 的最小奇异值至少为 $\\tau$ 的首次循环 $k$。\n\n角度单位不适用，因为对齐度量是通过余弦定义的。所有输出都是无量纲的浮点数或整数。本问题中没有物理单位。\n\n为以下测试套件实现此过程。在所有情况下，通过对一个由整数种子固定的随机矩阵进行 $\\operatorname{QR}$ 分解，来确定性地定义正交矩阵 $V$；也就是说，使用一个固定的种子生成一个具有独立标准正态分布条目的矩阵，计算其 $\\operatorname{QR}$ 分解，并取其 Q 因子作为正交矩阵 $V$。\n\n测试套件：\n- 情况 $1$（理想路径）：\n  - $n = 3$，特征值 $\\lambda = [1.3, 1.05, 0.8]$，用于 $V$ 的种子：$123$。\n  - $H$ 仅观测第三个坐标（即，$H$ 是选择索引 3 的行向量）。\n  - $Q = 10^{-3} I$，$R = 10^{-2} I$，$\\sigma_0^2 = 25$。\n  - 对齐阈值 $\\tau = 0.95$，最大循环次数 $k_{\\max} = 200$。\n- 情况 $２$（对不稳定和稳定方向的部分观测）：\n  - $n = 4$，特征值 $\\lambda = [1.4, 1.2, 0.9, 0.8]$，用于 $V$ 的种子：$456$。\n  - $H$ 观测坐标 1 和 3（即，$H$ 选择索引 1 和 3）。\n  - $Q = 5 \\times 10^{-4} I$，$R = 2 \\times 10^{-2} I$，$\\sigma_0^2 = 25$。\n  - 对齐阈值 $\\tau = 0.95$，最大循环次数 $k_{\\max} = 300$。\n- 情况 $３$（完全观测，可能无法对齐）：\n  - $n = 3$，特征值 $\\lambda = [1.5, 0.95, 0.7]$，用于 $V$ 的种子：$789$。\n  - $H = I$（即，观测所有 3 个坐标）。\n  - $Q = 10^{-3} I$，$R = 10^{-2} I$，$\\sigma_0^2 = 25$。\n  - 对齐阈值 $\\tau = 0.95$，最大循环次数 $k_{\\max} = 150$。\n- 情况 $４$（弱不稳定性，缓慢启动过程，边界情况）：\n  - $n = 5$，特征值 $\\lambda = [1.01, 1.0, 0.99, 0.95, 0.9]$，用于 $V$ 的种子：$101$。\n  - $H$ 观测坐标 2、4 和 5（即，$H$ 选择索引 2、4 和 5）。\n  - $Q = 5 \\times 10^{-4} I$，$R = 10^{-2} I$，$\\sigma_0^2 = 100$。\n  - 对齐阈值 $\\tau = 0.95$，最大循环次数 $k_{\\max} = 500$。\n\n实现要求：\n- 在线性高斯假设下，对预报和分析步骤使用标准的卡尔曼滤波器协方差更新。对于分析，使用 Joseph 稳定形式以确保数值对称性和正半定性。\n- 在每个循环 $k$ 中，从前一个分析协方差 $P_a^{(k-1)}$ 计算预报协方差 $P_f^{(k)}$，然后使用 $M$ 的不稳定子空间与 $P_f^{(k)}$ 的维数相匹配（维数为 $r$）的主导特征子空间之间的主交角来评估对齐度量。\n- 返回首次满足对齐准则的循环指数 $k$，如果 $k_{\\max}$ 内没有发生对齐，则返回 $-1$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result_1,result_2,result_3,result_4]$），其中每个 $result_i$ 是相应测试用例首次满足对齐标准的循环指数 $k$，如果未满足则为 $-1$。",
            "solution": "该问题要求我们确定预报误差协方差 $P_f$ 与系统动力学的不稳定子空间对齐所需的数据同化循环次数。这涉及通过线性卡尔曼滤波器循环模拟协方差矩阵的演化，并在每一步应用特定的几何对齐准则。\n\n整体方法结构如下：\n1.  根据每个测试用例提供的参数定义系统模型。这包括构建切线性模型矩阵 $M$、观测算子 $H$ 以及噪声协方差矩阵 $Q$ 和 $R$。\n2.  识别模型 $M$ 的不稳定子空间 $\\mathcal{U}$ 并构建其标准正交基 $U$。\n3.  基于给定的较差先验初始化分析误差协方差 $P_a$。问题陈述我们从一个初始的先验预报协方差 $P_f^{(0)} = \\sigma_0^2 I$ 开始。一个标准的数据同化循环包括一个预报步骤，然后是一个分析步骤。我们将其解释为，在循环 $k=0$ 时，设置初始分析协方差为 $P_a^{(0)} = \\sigma_0^2 I$。\n4.  对 $k=1, 2, \\dots, k_{\\max}$ 进行数据同化循环迭代。\n5.  在每个循环 $k$ 中，首先执行预报步骤以计算预报误差协方差 $P_f^{(k)}$。\n6.  然后，评估 $P_f^{(k)}$ 的主导子空间与不稳定子空间 $\\mathcal{U}$ 之间的对齐准则。如果达到对齐，循环次数 $k$ 即为结果。\n7.  如果未达到对齐，则执行分析步骤以计算分析误差协方差 $P_a^{(k)}$，该协方差将用于下一个循环的预报步骤。\n8.  如果循环完成而未达到对齐，则结果为 $-1$。\n\n其核心科学原理植根于卡尔曼滤波和线性代数。\n\n**1. 卡尔曼滤波器协方差传播**\n\n误差协方差的演化由线性高斯假设下的卡尔曼滤波器方程控制。一个循环包括两个步骤：\n\n**预报步骤：** 来自前一个循环的分析误差协方差 $P_a^{(k-1)}$，使用切线性模型 $M$ 向前传播。由于系统动力学，不确定性会增长，并被过程噪声 $w_k \\sim \\mathcal{N}(0, Q)$ 放大。当前循环 $k$ 的预报误差协方差由下式给出：\n$$P_f^{(k)} = M P_a^{(k-1)} M^\\top + Q$$\n\n**分析步骤：** 预报状态（及其协方差 $P_f^{(k)}$）使用观测 $y_k = H x_k + v_k$（其中 $v_k \\sim \\mathcal{N}(0, R)$）进行更新。此更新减少了不确定性。得到的分析误差协方差 $P_a^{(k)}$ 使用 Joseph 稳定形式计算，以确保数值稳定并保持协方差矩阵的正半定性。方程如下：\n- 卡尔曼增益：$K_k = P_f^{(k)} H^\\top (H P_f^{(k)} H^\\top + R)^{-1}$\n- 分析协方差：$P_a^{(k)} = (I - K_k H) P_f^{(k)} (I - K_k H)^\\top + K_k R K_k^\\top$\n\n**2. 子空间对齐准则**\n\n启动过程涉及预报误差协方差 $P_f$ 逐渐被增长最快的误差模态所主导，这些模态对应于动力学的不稳定子空间。我们使用子空间之间的主交角来量化此对齐。\n\n**不稳定子空间 ($\\mathcal{U}$):** 模型由 $M = V \\Lambda V^\\top$ 给出，其中 $\\Lambda = \\operatorname{diag}(\\lambda_1, \\dots, \\lambda_n)$ 包含特征值，正交矩阵 $V$ 的列是相应的特征向量。不稳定子空间 $\\mathcal{U}$ 是与特征值 $\\lambda_i > 1$ 相关联的特征向量所张成的空间。设 $r$ 为此类特征值的数量。$\\mathcal{U}$ 的一个标准正交基由矩阵 $U \\in \\mathbb{R}^{n \\times r}$ 构成，其列是来自 $V$ 的相应 $r$ 个特征向量。\n\n**$P_f$ 的主导子空间：** 预报误差协方差 $P_f^{(k)}$ 是一个对称正半定矩阵。其特征分解揭示了不确定性的主方向。$P_f^{(k)}$ 的 $r$ 维主导子空间由其对应于 $r$ 个最大特征值的 $r$ 个特征向量所张成。该子空间的一个标准正交基是矩阵 $V_r \\in \\mathbb{R}^{n \\times r}$，其列是这 $r$ 个前导特征向量。\n\n**对齐度量：** 分别由 $U$ 和 $V_r$ 的列所张成的两个子空间之间的对齐度，通过它们的主交角来衡量。这些角的余弦是矩阵 $C = U^\\top V_r$ 的奇异值。问题将对齐定义为当这些余弦中的最小值（即 $C$ 的最小奇异值）大于或等于给定的阈值 $\\tau \\in (0,1)$ 时达成。条件是：\n$$ \\min(\\sigma(U^\\top V_r)) \\ge \\tau $$\n其中 $\\sigma(\\cdot)$ 表示奇异值集合。\n\n**3. 算法实现**\n\n对于每个测试用例，算法按以下步骤进行：\n1.  **设置**：根据给定参数（$n$、$\\lambda$、种子、观测索引、噪声尺度）构建矩阵 $M$、$H$、$Q$ 和 $R$。通过对一个由给定种子生成的标准正态随机矩阵应用 QR 分解，确定性地生成正交矩阵 $V$。从 $V$ 中提取不稳定子空间的基 $U$。\n2.  **初始化**：设置初始分析协方差 $P_a^{(0)} = \\sigma_0^2 I$。\n3.  **迭代**：对于从 $1$ 到 $k_{\\max}$ 的 $k$：\n    a. 计算 $P_f^{(k)} = M P_a^{(k-1)} M^\\top + Q$。\n    b. 计算 $P_f^{(k)}$ 的特征分解，以找到其 $r$ 维主导子空间的基 $V_r$。\n    c. 计算 $U^\\top V_r$ 的最小奇异值。如果它 $\\ge \\tau$，则返回 $k$。\n    d. 如果未对齐，则使用 Joseph 形式计算卡尔曼增益 $K_k$ 和下一个分析协方差 $P_a^{(k)}$。\n4.  **终止**：如果循环结束，则返回 $-1$。\n对每个测试用例实施此过程，以找到首次对齐的循环指数。",
            "answer": "$$\n\\boxed{[15, 23, -1, 217]}\n$$"
        }
    ]
}