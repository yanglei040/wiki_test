{
    "hands_on_practices": [
        {
            "introduction": "卡尔曼滤波器通常以离散时间形式呈现，但它所建模的许多物理系统本质上是连续的。本练习旨在弥合这一差距，引导您从一个基本的连续时间动态系统（一个受随机加速度扰动的质点）出发，推导出其离散时间等效模型所需的关键参数。通过这个实践 ，您将掌握如何将连续过程噪声的物理特性转化为离散时间卡尔曼滤波器中的过程噪声协方差矩阵 $Q_d$，这是将滤波器应用于现实世界问题的基础一步。",
            "id": "2753297",
            "problem": "一个一维点质量被建模，用于使用离散时间卡尔曼滤波器 (KF) 进行状态估计。其连续时间运动学由位置 $p(t)$ 和速度 $v(t)$ 定义，动态方程为\n$$\\frac{d}{dt}\\begin{pmatrix} p(t) \\\\ v(t) \\end{pmatrix} = \\underbrace{\\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix}}_{F} \\begin{pmatrix} p(t) \\\\ v(t) \\end{pmatrix} + \\underbrace{\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}}_{L} a(t),$$\n其中 $a(t)$ 是一个零均值、标量、白高斯加速度过程，其单边功率谱密度为常数 $q$，单位为 $\\mathrm{m}^{2}\\mathrm{s}^{-3}$。系统以周期 $\\Delta t = 0.1\\,\\mathrm{s}$ 进行采样。测量模型仅包含位置，其形式为\n$$y_{k} = \\underbrace{\\begin{pmatrix}1  0\\end{pmatrix}}_{H} \\begin{pmatrix} p_{k} \\\\ v_{k} \\end{pmatrix} + r_{k},$$\n其中 $r_{k}$ 是零均值白高斯测量噪声，其方差为 $R = \\mathrm{diag}(0.04)$，单位为 $\\mathrm{m}^{2}$。\n\n从线性时不变状态转移概念以及连续时间白高斯过程噪声在有限采样间隔内如何通过连续时间系统传播的定义出发，推导由白噪声加速度驱动的采样系统的离散时间过程噪声协方差矩阵 $Q_{d}$。然后，使用 $q = 0.5$ 和 $\\Delta t = 0.1\\,\\mathrm{s}$ 对 $Q_{d}$ 进行数值计算。\n\n所有量均使用国际单位制 (SI)（米和秒）。以数值形式报告 $Q_{d}$ 的各项，并将每项四舍五入到四位有效数字。最终答案中不包括单位。",
            "solution": "所述问题是适定的，具有科学依据，并为获得唯一解提供了所有必要信息。我们将开始推导。\n\n系统的连续时间动态由线性时不变 (LTI) 随机微分方程给出：\n$$ \\frac{d}{dt} x(t) = F x(t) + L w(t) $$\n其中状态向量为 $x(t) = \\begin{pmatrix} p(t) \\\\ v(t) \\end{pmatrix}$，状态动态矩阵为 $F = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix}$，噪声输入矩阵为 $L = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，而 $w(t) = a(t)$ 是连续时间白高斯噪声，其均值为零，功率谱密度 (PSD) 为 $q$。该噪声过程的自相关函数为 $E[w(t)w(\\tau)] = q \\delta(t-\\tau)$，其中 $\\delta(\\cdot)$ 是狄拉克δ函数。\n\n该微分方程的解，将状态从时间 $t_k$ 传播到 $t_{k+1} = t_k + \\Delta t$，由常数变易法公式给出：\n$$ x(t_{k+1}) = e^{F(t_{k+1}-t_k)} x(t_k) + \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau)} L w(\\tau) d\\tau $$\n这可以写成标准的离散时间形式 $x_{k+1} = A_d x_k + w_{dk}$，其中 $x_k \\equiv x(t_k)$，离散时间状态转移矩阵为 $A_d = e^{F\\Delta t}$，离散时间过程噪声向量为：\n$$ w_{dk} = \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau)} L w(\\tau) d\\tau $$\n目标是求出此离散时间过程噪声的协方差矩阵 $Q_d$，其定义为 $Q_d = E[w_{dk}w_{dk}^T]$。\n\n我们计算期望值：\n$$ Q_d = E\\left[ \\left( \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau_1)} L w(\\tau_1) d\\tau_1 \\right) \\left( \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau_2)} L w(\\tau_2) d\\tau_2 \\right)^T \\right] $$\n$$ Q_d = E\\left[ \\int_{t_k}^{t_{k+1}} \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau_1)} L w(\\tau_1) w(\\tau_2) L^T e^{F^T(t_{k+1}-\\tau_2)} d\\tau_1 d\\tau_2 \\right] $$\n通过将期望算子移到积分内部，并使用性质 $E[w(\\tau_1)w(\\tau_2)] = q \\delta(\\tau_1-\\tau_2)$，我们得到：\n$$ Q_d = \\int_{t_k}^{t_{k+1}} \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau_1)} L (q \\delta(\\tau_1-\\tau_2)) L^T e^{F^T(t_{k+1}-\\tau_2)} d\\tau_1 d\\tau_2 $$\n利用狄拉克δ函数的筛选性质来计算关于 $\\tau_2$ 的积分：\n$$ Q_d = q \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1}-\\tau)} L L^T e^{F^T(t_{k+1}-\\tau)} d\\tau $$\n为了简化积分，我们进行变量替换。令 $s = t_{k+1} - \\tau$。则 $ds = -d\\tau$。积分限从 $\\tau=t_k$ 变为 $s=\\Delta t$，从 $\\tau=t_{k+1}$ 变为 $s=0$。\n$$ Q_d = q \\int_{\\Delta t}^{0} e^{Fs} L L^T e^{F^T s} (-ds) = q \\int_{0}^{\\Delta t} e^{Fs} L L^T e^{F^T s} ds $$\n为了计算这个积分，我们必须首先计算矩阵指数 $e^{Fs}$。矩阵 $F$ 是幂零矩阵，因为 $F^2 = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$。因此，指数的泰勒级数在一次项后截断：\n$$ e^{Fs} = I + Fs + \\frac{1}{2!} (Fs)^2 + \\dots = I + Fs = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} 0  s \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 1  s \\\\ 0  1 \\end{pmatrix} $$\n其转置为 $e^{F^T s} = (e^{Fs})^T = \\begin{pmatrix} 1  0 \\\\ s  1 \\end{pmatrix}$。\n项 $L L^T$ 为：\n$$ L L^T = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} \\begin{pmatrix} 0  1 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  1 \\end{pmatrix} $$\n现在我们组装被积函数：\n$$ e^{Fs} L L^T e^{F^T s} = \\begin{pmatrix} 1  s \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ s  1 \\end{pmatrix} = \\begin{pmatrix} 0  s \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ s  1 \\end{pmatrix} = \\begin{pmatrix} s^2  s \\\\ s  1 \\end{pmatrix} $$\n现在我们将此矩阵从 $s=0$ 积分到 $s=\\Delta t$：\n$$ \\int_{0}^{\\Delta t} \\begin{pmatrix} s^2  s \\\\ s  1 \\end{pmatrix} ds = \\begin{pmatrix} \\int_{0}^{\\Delta t} s^2 ds  \\int_{0}^{\\Delta t} s ds \\\\ \\int_{0}^{\\Delta t} s ds  \\int_{0}^{\\Delta t} 1 ds \\end{pmatrix} = \\begin{pmatrix} \\left[\\frac{s^3}{3}\\right]_{0}^{\\Delta t}  \\left[\\frac{s^2}{2}\\right]_{0}^{\\Delta t} \\\\ \\left[\\frac{s^2}{2}\\right]_{0}^{\\Delta t}  \\left[s\\right]_{0}^{\\Delta t} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\Delta t^3}{3}  \\frac{\\Delta t^2}{2} \\\\ \\frac{\\Delta t^2}{2}  \\Delta t \\end{pmatrix} $$\n最后，乘以标量PSD $q$，我们得到离散时间过程噪声协方差矩阵的解析表达式：\n$$ Q_d = q \\begin{pmatrix} \\frac{\\Delta t^3}{3}  \\frac{\\Delta t^2}{2} \\\\ \\frac{\\Delta t^2}{2}  \\Delta t \\end{pmatrix} $$\n现在，我们代入指定的数值：$q = 0.5$ 和 $\\Delta t = 0.1\\,\\mathrm{s}$。\n$$ \\Delta t^3 = (0.1)^3 = 0.001 $$\n$$ \\Delta t^2 = (0.1)^2 = 0.01 $$\n$$ \\Delta t = 0.1 $$\n$$ Q_d = 0.5 \\begin{pmatrix} \\frac{0.001}{3}  \\frac{0.01}{2} \\\\ \\frac{0.01}{2}  0.1 \\end{pmatrix} = 0.5 \\begin{pmatrix} 0.0003333...  0.005 \\\\ 0.005  0.1 \\end{pmatrix} $$\n$$ Q_d = \\begin{pmatrix} 0.0001666...  0.0025 \\\\ 0.0025  0.05 \\end{pmatrix} $$\n按要求将每个元素四舍五入到四位有效数字：\n$Q_{d,11}$ 项为 $0.0001666...$，四舍五入为 $0.0001667$。\n$Q_{d,12} = Q_{d,21}$ 项为 $0.0025$，为显示四位有效数字，写作 $0.002500$。\n$Q_{d,22}$ 项为 $0.05$，为显示四位有效数字，写作 $0.05000$。\n因此，最终的数值矩阵为：\n$$ Q_d = \\begin{pmatrix} 0.0001667  0.002500 \\\\ 0.002500  0.05000 \\end{pmatrix} $$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.0001667  0.002500 \\\\ 0.002500  0.05000 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在推导出精确的离散时间过程噪声协方差 $Q_d$ 后，一个自然而然的问题是：我们能否使用更简单的近似方法？本练习将带您深入探讨模型离散化误差的影响，通过一个计算实验来量化使用一阶近似 $Q_d \\approx Q_c \\Delta t$ 与使用精确值所产生的差异。这个实践  将让您直观地看到采样间隔 $\\Delta t$ 如何影响近似的精度，并帮助您理解在滤波器设计中，模型保真度与计算简便性之间的权衡。",
            "id": "3425006",
            "problem": "考虑一个由随机微分方程 $x'(t) = F x(t) + \\Gamma \\dot{W}(t)$ 描述的连续时间、线性、时不变、高斯随机动力学系统，其中 $x(t) \\in \\mathbb{R}^n$ 是状态，$F \\in \\mathbb{R}^{n \\times n}$ 是一个恒定模型矩阵，$\\Gamma \\in \\mathbb{R}^{n \\times r}$ 将白噪声映射到状态，$\\dot{W}(t)$ 表示标准 $r$ 维布朗运动 (BM) 的形式导数。设观测模型为 $y_k = H x(t_k) + v_k$，其中 $H \\in \\mathbb{R}^{m \\times n}$，$v_k$ 是均值为零、协方差为 $R \\in \\mathbb{R}^{m \\times m}$ 的高斯噪声，$t_k = k \\Delta t$，其中 $\\Delta t$ 是以秒为单位的固定采样间隔。\n\n您将通过比较精确的离散时间过程噪声协方差与常用的一阶近似，来分析模型离散化误差对离散时间卡尔曼滤波器 (KF) 的影响。时长为 $\\Delta t$ 的单步精确离散时间过程噪声协方差定义为连续时间模型精确时间离散化中出现的随机积分的协方差。一阶近似用 $Q_d^{\\text{approx}} \\approx \\Gamma \\Gamma^\\top \\Delta t$ 替代精确协方差。\n\n从基本定义（线性随机微分方程、由 $e^{F t}$ 定义的状态转移矩阵以及随机积分的 Itô 等距性质）出发，推导精确单步离散时间过程噪声协方差 $Q_d^{\\text{exact}}$ 的一个有原理依据的表达式，并实现一种数值稳定的方法，以便在 $F$ 和 $\\Gamma$ 为常数时精确计算它。然后，在离散时间 KF 的单个数据同化步骤中，比较使用 $Q_d^{\\text{exact}}$ 与 $Q_d^{\\text{approx}}$ 得到的后验均值，并量化因使用 $Q_d^{\\text{approx}}$ 而在后验均值中引起的偏差。\n\n使用以下固定的、科学上一致的配置：\n- 状态维度 $n = 2$ 和噪声维度 $r = 1$。\n- 模型矩阵 $F = \\begin{bmatrix} 0  1 \\\\ -2  -\\tfrac{1}{2} \\end{bmatrix}$，其元素单位为秒的倒数。\n- 噪声映射 $\\Gamma = \\begin{bmatrix} \\tfrac{1}{5} \\\\ 1 \\end{bmatrix}$，使得连续时间谱密度为 $Q_c = \\Gamma \\Gamma^\\top$。\n- 观测矩阵 $H = \\begin{bmatrix} 1  0 \\end{bmatrix}$。\n- 观测噪声协方差 $R = \\begin{bmatrix} (2 \\times 10^{-1})^2 \\end{bmatrix} = \\begin{bmatrix} 4 \\times 10^{-2} \\end{bmatrix}$。\n- 先验均值 $m_0 = \\begin{bmatrix} \\tfrac{1}{2} \\\\ -\\tfrac{1}{2} \\end{bmatrix}$ (无量纲)。\n- 先验协方差 $P_0 = \\text{diag}\\!\\left( \\tfrac{2}{5}, \\tfrac{2}{5} \\right)$ (无量纲)。\n- 单个观测值 $y_1 = \\tfrac{5}{4}$ (无量纲)。\n\n对于从 $t_0$ 到 $t_1 = t_0 + \\Delta t$ 的单个预测-更新步骤，为每个指定的 $\\Delta t$ 执行以下操作：\n1. 计算由 $F$ 蕴含的精确离散时间状态转移矩阵 $\\Phi(\\Delta t)$。\n2. 通过精确评估由线性随机微分方程和 Itô 等距性质产生的随机积分的协方差，来计算 $Q_d^{\\text{exact}}$。实现一种不依赖于无穷级数截断的数值稳定计算方法；您可以使用适当构造的分块矩阵的矩阵指数，来为常数 $F$ 和 $\\Gamma$ 精确评估该积分。\n3. 计算 $Q_d^{\\text{approx}} = \\Gamma \\Gamma^\\top \\Delta t$。\n4. 使用相同的 $\\Phi(\\Delta t)$、$H$、$R$、$m_0$、$P_0$ 和 $y_1$，通过离散时间 KF 的预测和更新，计算两个后验均值：一个使用 $Q_d^{\\text{exact}}$，另一个使用 $Q_d^{\\text{approx}}$。\n5. 计算这两个后验均值之差的欧几里得范数，以量化因使用 $Q_d^{\\text{approx}}$ 替代 $Q_d^{\\text{exact}}$ 而引起的后验偏差。\n\n此问题中不出现角度，除时间外所有量均为无量纲。时间以秒表示。后验偏差范数是无量纲的。\n\n测试套件 (采样间隔，单位为秒)：\n- $\\Delta t = 10^{-6}$ (极小步长边界情况),\n- $\\Delta t = 10^{-2}$ (小步长情况),\n- $\\Delta t = 10^{-1}$ (正常路径情况),\n- $\\Delta t = \\tfrac{1}{2}$ (中等步长情况),\n- $\\Delta t = 2$ (大步长情况)。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序与上述测试套件一致，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$。每个 $\\text{result}_i$ 都必须是一个浮点数，等于相应 $\\Delta t$ 的后验均值差的欧几里得范数。",
            "solution": "目标是分析当过程噪声协方差矩阵 $Q_d$ 被近似时，在离散时间卡尔曼滤波器 (KF) 的后验状态估计中引入的偏差。我们比较使用精确的离散时间过程噪声协方差 $Q_d^{\\text{exact}}$ 得到的后验均值与使用一阶近似 $Q_d^{\\text{approx}}$ 得到的后验均值。\n\n系统的连续时间动力学由线性随机微分方程 (SDE) 给出：\n$$x'(t) = F x(t) + \\Gamma \\dot{W}(t)$$\n其中 $x(t) \\in \\mathbb{R}^n$ 是状态向量，$F \\in \\mathbb{R}^{n \\times n}$ 是恒定动力学矩阵，$\\Gamma \\in \\mathbb{R}^{n \\times r}$ 是噪声耦合矩阵，$\\dot{W}(t)$ 代表向量值高斯白噪声。\n\n该 SDE 在时长为 $\\Delta t = t_{k+1} - t_k$ 的时间区间 $[t_k, t_{k+1}]$ 上的精确解提供了离散时间状态空间模型：\n$$x(t_{k+1}) = e^{F \\Delta t} x(t_k) + \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1} - \\tau)} \\Gamma \\, dW(\\tau)$$\n这可以写成标准的离散时间形式 $x_{k+1} = \\Phi x_k + w_k$，其中：\n- 状态转移矩阵为 $\\Phi(\\Delta t) = e^{F \\Delta t}$。\n- 离散时间过程噪声为 $w_k = \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1} - \\tau)} \\Gamma \\, dW(\\tau)$。\n\n过程噪声 $w_k$ 是一个零均值高斯随机变量。其协方差，即精确的离散时间过程噪声协方差 $Q_d^{\\text{exact}}$，是我们必须计算的量。\n\n**1. 精确过程噪声协方差 $Q_d^{\\text{exact}}$ 的推导**\n\n$w_k$ 的协方差定义为 $Q_d^{\\text{exact}} = \\mathbb{E}[w_k w_k^\\top]$。通过对定义 $w_k$ 的随机积分应用 Itô 等距性质（该性质指出，关于布朗运动的积分的方差是被积函数平方的积分），我们得到：\n$$Q_d^{\\text{exact}} = \\mathbb{E} \\left[ \\left(\\int_{t_k}^{t_{k+1}} e^{F(t_{k+1} - \\tau)} \\Gamma dW(\\tau)\\right) \\left(\\int_{t_k}^{t_{k+1}} e^{F(t_{k+1} - s)} \\Gamma dW(s)\\right)^\\top \\right]$$\n$$Q_d^{\\text{exact}} = \\int_{t_k}^{t_{k+1}} e^{F(t_{k+1} - \\tau)} \\Gamma (I) \\Gamma^\\top e^{F^\\top(t_{k+1} - \\tau)} d\\tau$$\n通过变量替换 $s = t_{k+1} - \\tau$，积分变为：\n$$Q_d^{\\text{exact}}(\\Delta t) = \\int_{0}^{\\Delta t} e^{Fs} (\\Gamma \\Gamma^\\top) e^{F^\\top s} \\, ds$$\n量 $Q_c = \\Gamma \\Gamma^\\top$ 是连续时间过程噪声谱密度。\n\n该问题将其与常见的一阶 Euler-Maruyama 近似进行对比：\n$$Q_d^{\\text{approx}}(\\Delta t) = \\Gamma \\Gamma^\\top \\Delta t = Q_c \\Delta t$$\n该近似源于在积分内假设 $e^{Fs} \\approx I$，这仅在 $s$ 非常小时才准确。\n\n**2. $Q_d^{\\text{exact}}$ 的数值稳定计算**\n\n矩阵指数的直接数值积分或级数展开可能不稳定或计算成本高昂。一种针对常数 $F$ 和 $\\Gamma$ 的稳定且精确的方法，称为 Van Loan 方法，涉及一个更大的增广矩阵的矩阵指数。我们构造一个 $2n \\times 2n$ 的分块矩阵 $M$：\n$$M = \\begin{bmatrix} -F  Q_c \\\\ 0  F^\\top \\end{bmatrix}$$\n$M \\Delta t$ 的指数可以表示为分块形式：\n$$\\exp(M \\Delta t) = \\begin{bmatrix} e^{-F \\Delta t}  \\int_0^{\\Delta t} e^{-F(\\Delta t - s)} Q_c e^{F^\\top s} ds \\\\ 0  e^{F^\\top \\Delta t} \\end{bmatrix}$$\n让我们将计算出的矩阵指数表示为 $E = \\exp(M \\Delta t)$，其分块为 $E = \\begin{bmatrix} E_{11}  E_{12} \\\\ E_{21}  E_{22} \\end{bmatrix}$。右上角的分块 $E_{12}$ 是：\n$$E_{12} = e^{-F \\Delta t} \\int_0^{\\Delta t} e^{Fs} Q_c e^{F^\\top s} ds = (e^{F \\Delta t})^{-1} Q_d^{\\text{exact}} = \\Phi^{-1} Q_d^{\\text{exact}}$$\n因此，我们可以通过计算状态转移矩阵 $\\Phi = e^{F\\Delta t}$ 然后相乘来找到精确的协方差：\n$$Q_d^{\\text{exact}} = \\Phi E_{12}$$\n这种方法避免了数值积分，并提供了一个数值上稳健的解。\n\n**3. 卡尔曼滤波器预测和更新步骤**\n\n卡尔曼滤波器随时间传播状态估计（均值和协方差）。从时间 $t_0$ 的先验均值 $m_0$ 和协方差 $P_0$ 开始，我们执行一个预测-更新循环，以获得在 $t_1 = t_0 + \\Delta t$ 时的后验估计。\n\n**预测步骤：** 使用离散时间模型将先验估计向前投影到未来时间。\n- 预测状态均值：$m_{1|0} = \\Phi m_0$\n- 预测状态协方差：$P_{1|0} = \\Phi P_0 \\Phi^\\top + Q_d$\n\n**更新步骤：** 使用观测值 $y_1$ 校正预测估计。\n- 观测模型：$y_1 = H x(t_1) + v_1$，噪声协方差为 $R$。\n- 新息（测量残差）：$\\nu_1 = y_1 - H m_{1|0}$\n- 新息协方差：$S_1 = H P_{1|0} H^\\top + R$\n- 卡尔曼增益：$K_1 = P_{1|0} H^\\top S_1^{-1}$\n- 后验（更新后）状态均值：$m_1 = m_{1|0} + K_1 \\nu_1$\n- 后验（更新后）状态协方差：$P_1 = (I - K_1 H) P_{1|0}$\n\n**4. 量化后验偏差**\n\n对于每个给定的 $\\Delta t$，整个 KF 过程执行两次：\n1. 使用 $Q_d = Q_d^{\\text{exact}}$ 计算 $P_{1|0}^{\\text{exact}}$ 并随后计算后验均值 $m_1^{\\text{exact}}$。\n2. 使用 $Q_d = Q_d^{\\text{approx}}$ 计算 $P_{1|0}^{\\text{approx}}$ 并随后计算后验均值 $m_1^{\\text{approx}}$。\n\n请注意，状态转移矩阵 $\\Phi$、先验信息 ($m_0, P_0$) 和预测均值 $m_{1|0}$ 在两种情况下都是相同的。差异源于预测协方差 $P_{1|0}$，它影响卡尔曼增益 $K_1$，从而影响最终的后验均值 $m_1$。\n\n由近似引起的偏差通过两个所得后验均值之差的欧几里得范数量化：\n$$\\text{Bias} = \\| m_1^{\\text{exact}} - m_1^{\\text{approx}} \\|_2$$\n\n此过程使用指定的参数执行：\n- $n=2$, $r=1$, $m=1$\n- $F = \\begin{bmatrix} 0  1 \\\\ -2  -1/2 \\end{bmatrix}$\n- $\\Gamma = \\begin{bmatrix} 1/5 \\\\ 1 \\end{bmatrix}$，得到 $Q_c = \\Gamma \\Gamma^\\top = \\begin{bmatrix} 1/25  1/5 \\\\ 1/5  1 \\end{bmatrix}$\n- $H = \\begin{bmatrix} 1  0 \\end{bmatrix}$\n- $R = \\begin{bmatrix} 4 \\times 10^{-2} \\end{bmatrix}$\n- $m_0 = \\begin{bmatrix} 1/2 \\\\ -1/2 \\end{bmatrix}$\n- $P_0 = \\text{diag}(2/5, 2/5)$\n- $y_1 = 5/4$\n对测试套件 $\\{10^{-6}, 10^{-2}, 10^{-1}, 1/2, 2\\}$ 中的每个 $\\Delta t$ 重复此计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Computes the bias in the Kalman filter posterior mean caused by using a \n    first-order approximation for the process noise covariance instead of the\n    exact one derived from the continuous-time model.\n    \"\"\"\n    \n    # Define fixed problem parameters based on the problem statement.\n    # State dimension n = 2, observation dimension m = 1, noise dimension r = 1.\n    F = np.array([[0.0, 1.0], [-2.0, -0.5]])\n    Gamma = np.array([[0.2], [1.0]])\n    H = np.array([[1.0, 0.0]])\n    R = np.array([[(0.2)**2]])\n    m0 = np.array([[0.5], [-0.5]])\n    P0 = np.diag([0.4, 0.4])\n    y1 = 1.25\n    \n    # Continuous-time process noise spectral density\n    Qc = Gamma @ Gamma.T\n    n = F.shape[0]\n\n    # Define the test cases from the problem statement.\n    # Each case is a sampling interval delta_t in seconds.\n    test_cases = [1e-6, 1e-2, 1e-1, 0.5, 2.0]\n\n    results = []\n    \n    for dt in test_cases:\n        # Main logic to calculate the result for one case (one delta_t).\n\n        # 1. Compute the exact discrete-time state transition matrix Phi.\n        Phi = expm(F * dt)\n\n        # 2. Compute the exact discrete-time process noise covariance Qd_exact.\n        # This uses the Van Loan method by forming a 2n x 2n block matrix.\n        M_block = np.block([\n            [-F, Qc],\n            [np.zeros((n, n)), F.T]\n        ])\n        \n        # Compute the matrix exponential of the block matrix.\n        E = expm(M_block * dt)\n        \n        # Extract the upper-right n x n block.\n        E12 = E[:n, n:]\n        \n        # Calculate Qd_exact using the formula Qd_exact = Phi * E12.\n        Qd_exact = Phi @ E12\n\n        # 3. Compute the first-order approximation for the process noise covariance.\n        Qd_approx = Qc * dt\n\n        # 4. Perform one Kalman filter prediction-update step for both cases.\n        # This helper function encapsulates the KF update logic.\n        def kf_update(P_predicted, m_predicted, H_obs, R_obs, y_obs):\n            # Innovation (measurement residual)\n            nu = y_obs - (H_obs @ m_predicted)\n            # Innovation covariance\n            S = H_obs @ P_predicted @ H_obs.T + R_obs\n            # Kalman gain (note S is 1x1, so inv is 1/S)\n            K = P_predicted @ H_obs.T @ np.linalg.inv(S)\n            # Posterior mean\n            m_posterior = m_predicted + K @ nu\n            return m_posterior\n\n        # Prediction step (common to both cases)\n        m1_predicted = Phi @ m0\n        \n        # Predicted covariance for the 'exact' case\n        P1_predicted_exact = Phi @ P0 @ Phi.T + Qd_exact\n        \n        # Predicted covariance for the 'approximate' case\n        P1_predicted_approx = Phi @ P0 @ Phi.T + Qd_approx\n        \n        # Make observation a 2D array for consistent matrix operations\n        y1_vec = np.array([[y1]])\n\n        # Update step to get posterior mean for both cases\n        m1_posterior_exact = kf_update(P1_predicted_exact, m1_predicted, H, R, y1_vec)\n        m1_posterior_approx = kf_update(P1_predicted_approx, m1_predicted, H, R, y1_vec)\n        \n        # 5. Compute the Euclidean norm of the difference between the posterior means.\n        posterior_bias_norm = np.linalg.norm(m1_posterior_exact - m1_posterior_approx)\n        results.append(posterior_bias_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理论上，卡尔曼滤波器的协方差矩阵在每次更新后都应保持正半定。然而，在实际的计算机实现中，由于有限精度算术的舍入误差，这一基本属性可能会被破坏，导致滤波器发散。本练习通过一个精心设计的反例，揭示了标准协方差更新公式的数值脆弱性。通过这个实践 ，您不仅能诊断出这种由“灾难性抵消”引起的数值问题，还能从根本上理解为何需要采用平方根滤波等更稳健的算法来保证滤波器的长期稳定运行。",
            "id": "3424957",
            "problem": "考虑一个线性、时不变、离散时间的高斯状态空间模型。在给定的时间步，单步预测状态 $x_{k|k-1}$ 服从均值为 $m_{k|k-1}$、协方差为 $P_{k|k-1}$ 的高斯分布。根据 $y_k = H x_k + v_k$ 获得一个测量值 $y_k$，其中 $v_k$ 是高斯噪声，零均值，独立于 $x_k$，协方差为 $R$。除非另有规定，否则请在精确算术下进行计算。\n\nA 部分（精确算术，基础推导）：从 $(x_k, y_k)$ 的联合高斯性和联合高斯变量的条件协方差定义出发，推导后验协方差 $P_{k|k}$ 的解析表达式，并解释为什么在精确算术下，$P_{k|k}$ 是半正定 (PSD) 的。你的推导必须基于分块矩阵求逆恒等式和舒尔补的半正定性特征。\n\nB 部分（有限精度反例）：定义一个有限精度算术模型如下：每个标量乘积和标量和都立即四舍五入到 $4$ 位有效数字，并且 $2 \\times 2$ 矩阵求逆通过伴随矩阵公式进行，同样的舍入规则应用于所有中间的标量乘积、和以及倒数。在这个有限精度模型中，考虑\n$$\nP_{k|k-1} = \\begin{pmatrix} 1.000  0.9990 \\\\ 0.9990  0.9980 \\end{pmatrix}, \\quad\nH = I_2, \\quad\nR = 0.0010\\, I_2.\n$$\n计算新息协方差 $S = H P_{k|k-1} H^{\\top} + R$、其逆矩阵 $S^{-1}$、卡尔曼增益 $K = P_{k|k-1} H^{\\top} S^{-1}$，然后使用朴素的协方差更新公式 $P_{k|k} = (I - K H) P_{k|k-1}$ 计算后验协方差，所有计算都在所述的舍入模型下进行。然后通过 $\\tfrac{1}{2}\\big(P_{k|k} + P_{k|k}^{\\top}\\big)$ 将结果对称化。通过计算其最小特征值，证明对称化后的矩阵不是半正定的。\n\nC 部分（通过平方根滤波器进行补救）：基于数值线性代数和协方差分解的基本原理，概述平方根卡尔曼滤波器如何通过传播一个 Cholesky 因子 $S_{k|k}$（其中 $P_{k|k} = S_{k|k} S_{k|k}^{\\top}$）并通过正交三角 (QR) 分解对其进行更新，从而与朴素的协方差更新相比，减轻了因有限精度导致的半正定性损失。\n\n答案说明：将 B 部分中对称化后验协方差的最小特征值作为最终答案报告。将你的答案四舍五入到四位有效数字。答案是无单位的，并且必须是一个单个实数。",
            "solution": "该问题经验证是自洽的、有科学依据且适定的。所提供的事前协方差矩阵 $P_{k|k-1}$ 在指定的有限精度算术模型下是半正定的，因此构成了一个有效的前提。\n\nA 部分：基础推导与半正定性证明\n\n我们首先建立状态 $x_k$ 和测量值 $y_k$ 的联合分布。状态 $x_k$ 假定在预测步骤中具有先验高斯分布，$x_k \\sim \\mathcal{N}(m_{k|k-1}, P_{k|k-1})$。测量值 $y_k$ 通过线性模型 $y_k = H x_k + v_k$ 与状态相关，其中噪声 $v_k$ 是一个独立的零均值高斯过程，$v_k \\sim \\mathcal{N}(0, R)$。\n\n由于 $x_k$ 和 $y_k$ 是联合高斯分布的，我们可以通过其均值向量和协方差矩阵来描述它们的联合分布。令联合向量为 $Z = \\begin{pmatrix} x_k \\\\ y_k \\end{pmatrix}$。\n\n联合向量的均值为：\n$$\n\\mathbb{E}[Z] = \\begin{pmatrix} \\mathbb{E}[x_k] \\\\ \\mathbb{E}[y_k] \\end{pmatrix} = \\begin{pmatrix} m_{k|k-1} \\\\ \\mathbb{E}[H x_k + v_k] \\end{pmatrix} = \\begin{pmatrix} m_{k|k-1} \\\\ H m_{k|k-1} + \\mathbb{E}[v_k] \\end{pmatrix} = \\begin{pmatrix} m_{k|k-1} \\\\ H m_{k|k-1} \\end{pmatrix}\n$$\n\n联合向量的协方差矩阵是一个分块矩阵：\n$$\n\\text{Cov}(Z) = \\begin{pmatrix} \\text{Cov}(x_k)  \\text{Cov}(x_k, y_k) \\\\ \\text{Cov}(y_k, x_k)  \\text{Cov}(y_k) \\end{pmatrix}\n$$\n各分块计算如下：\n- $\\text{Cov}(x_k) = P_{k|k-1}$\n- $\\text{Cov}(x_k, y_k) = \\text{Cov}(x_k, H x_k + v_k) = \\text{Cov}(x_k, H x_k) + \\text{Cov}(x_k, v_k)$。由于 $x_k$ 和 $v_k$ 相互独立，$\\text{Cov}(x_k, v_k)=0$。因此，$\\text{Cov}(x_k, y_k) = \\text{Cov}(x_k, x_k) H^{\\top} = P_{k|k-1} H^{\\top}$。\n- $\\text{Cov}(y_k, x_k) = \\left(\\text{Cov}(x_k, y_k)\\right)^{\\top} = H P_{k|k-1}$。\n- $\\text{Cov}(y_k) = \\text{Cov}(H x_k + v_k) = \\text{Cov}(H x_k) + \\text{Cov}(v_k) = H \\text{Cov}(x_k) H^{\\top} + R = H P_{k|k-1} H^{\\top} + R$。这是新息协方差，记为 $S_k$。\n\n因此，联合协方差矩阵为：\n$$\n\\text{Cov}(Z) = \\begin{pmatrix} P_{k|k-1}  P_{k|k-1} H^{\\top} \\\\ H P_{k|k-1}  S_k \\end{pmatrix}\n$$\n后验协方差 $P_{k|k}$ 是给定测量值 $y_k$ 时 $x_k$ 的条件协方差。对于一个联合高斯分块向量 $\\begin{pmatrix} X_1 \\\\ X_2 \\end{pmatrix}$，其协方差为 $\\begin{pmatrix} \\Sigma_{11}  \\Sigma_{12} \\\\ \\Sigma_{21}  \\Sigma_{22} \\end{pmatrix}$，给定 $X_2$ 时 $X_1$ 的条件协方差由 $\\Sigma_{22}$ 的舒尔补给出：\n$$\n\\text{Cov}(X_1 | X_2) = \\Sigma_{11} - \\Sigma_{12} \\Sigma_{22}^{-1} \\Sigma_{21}\n$$\n通过将 $X_1 = x_k$ 和 $X_2 = y_k$ 进行识别，我们代入来自 $\\text{Cov}(Z)$ 的分块：\n$$\nP_{k|k} = P_{k|k-1} - (P_{k|k-1} H^{\\top}) S_k^{-1} (H P_{k|k-1})\n$$\n这是更新后协方差的标准形式。\n\n为了证明在精确算术下 $P_{k|k}$ 是半正定 (PSD) 的，我们使用 PSD 矩阵的舒尔补特征。一个对称分块矩阵 $M = \\begin{pmatrix} A  B \\\\ B^{\\top}  D \\end{pmatrix}$ 是 PSD 的，当且仅当 $D \\succeq 0$ 且其舒尔补 $A - B D^{-1} B^{\\top} \\succeq 0$（假设 $D$ 是可逆的，即正定的）。\n联合协方差矩阵 $\\text{Cov}(Z)$ 根据定义是一个协方差矩阵，因此必须是 PSD 的。我们来分析它的分块：\n- $A = P_{k|k-1}$，作为一个协方差矩阵，是 PSD 的。\n- $B = P_{k|k-1} H^{\\top}$。\n- $D = S_k = H P_{k|k-1} H^{\\top} + R$。由于 $P_{k|k-1} \\succeq 0$，那么 $H P_{k|k-1} H^{\\top} \\succeq 0$。由于 $R$ 是一个协方差矩阵，$R \\succeq 0$。两个半正定矩阵之和是半正定的，所以 $S_k \\succeq 0$。通常假设 $R$ 是正定的，这使得 $S_k$ 是正定的，因此是可逆的。\n\n由于 $\\text{Cov}(Z)$ 是 PSD 的且 $S_k$ 是正定的，$\\text{Cov}(Z)$ 中 $S_k$ 的舒尔补必须是 PSD 的。这个舒尔补恰好是我们为后验协方差推导出的表达式：\n$$\nP_{k|k} = P_{k|k-1} - P_{k|k-1} H^{\\top} S_k^{-1} H P_{k|k-1} \\succeq 0\n$$\n因此，在精确算术中，后验协方差 $P_{k|k}$ 保证是半正定的。\n\nB 部分：有限精度反例\n\n我们使用指定的有限精度算术模型（将每个标量乘积和和四舍五入到 4 位有效数字）进行计算。\n给定：\n$P_{k|k-1} = \\begin{pmatrix} 1.000  0.9990 \\\\ 0.9990  0.9980 \\end{pmatrix}$，$H = I_2 = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$，$R = \\begin{pmatrix} 0.0010  0 \\\\ 0  0.0010 \\end{pmatrix}$。\n\n1.  计算新息协方差 $S = H P_{k|k-1} H^{\\top} + R = P_{k|k-1} + R$：\n    $S = \\begin{pmatrix} 1.000+0.0010  0.9990+0 \\\\ 0.9990+0  0.9980+0.0010 \\end{pmatrix} = \\begin{pmatrix} 1.0010  0.9990 \\\\ 0.9990  0.9990 \\end{pmatrix}$。\n    将和 $1.0010$ 四舍五入到 4 位有效数字得到 $1.001$。\n    $S = \\begin{pmatrix} 1.001  0.9990 \\\\ 0.9990  0.9990 \\end{pmatrix}$。\n\n2.  使用伴随矩阵公式 $S^{-1} = \\frac{1}{\\det(S)} \\text{adj}(S)$ 计算 $S^{-1}$：\n    - $\\det(S) = (1.001 \\times 0.9990) - (0.9990 \\times 0.9990)$。\n    - 乘积 1：$1.001 \\times 0.9990 = 0.999999 \\to 1.000$。\n    - 乘积 2：$0.9990 \\times 0.9990 = 0.998001 \\to 0.9980$。\n    - 和：$1.000 - 0.9980 = 0.0020$。四舍五入到 4 位有效数字 - $0.002000$。\n    - $1 / \\det(S) = 1 / 0.002000 = 500.0$。\n    - adj$(S) = \\begin{pmatrix} 0.9990  -0.9990 \\\\ -0.9990  1.001 \\end{pmatrix}$。\n    - $S^{-1} = 500.0 \\times \\begin{pmatrix} 0.9990  -0.9990 \\\\ -0.9990  1.001 \\end{pmatrix} = \\begin{pmatrix} 500.0 \\times 0.9990  500.0 \\times -0.9990 \\\\ 500.0 \\times -0.9990  500.0 \\times 1.001 \\end{pmatrix}$。\n    - 元素 (1,1)：$499.5$。元素 (1,2)：$-499.5$。元素 (2,1)：$-499.5$。元素 (2,2)：$500.5$。\n    - $S^{-1} = \\begin{pmatrix} 499.5  -499.5 \\\\ -499.5  500.5 \\end{pmatrix}$。\n\n3.  计算卡尔曼增益 $K = P_{k|k-1} H^{\\top} S^{-1} = P_{k|k-1} S^{-1}$：\n    $K = \\begin{pmatrix} 1.000  0.9990 \\\\ 0.9990  0.9980 \\end{pmatrix} \\begin{pmatrix} 499.5  -499.5 \\\\ -499.5  500.5 \\end{pmatrix}$。\n    - $K_{11} = (1.000 \\times 499.5) + (0.9990 \\times -499.5) = (499.5) + (-499.0005 \\to -499.0) = 0.5 \\to 0.5000$。\n    - $K_{12} = (1.000 \\times -499.5) + (0.9990 \\times 500.5) = (-499.5) + (499.9995 \\to 500.0) = 0.5 \\to 0.5000$。\n    - $K_{21} = (0.9990 \\times 499.5) + (0.9980 \\times -499.5) = (499.0005 \\to 499.0) + (-498.501 \\to -498.5) = 0.5 \\to 0.5000$。\n    - $K_{22} = (0.9990 \\times -499.5) + (0.9980 \\times 500.5) = (-499.0005 \\to -499.0) + (499.499 \\to 499.5) = 0.5 \\to 0.5000$。\n    - $K = \\begin{pmatrix} 0.5000  0.5000 \\\\ 0.5000  0.5000 \\end{pmatrix}$。\n\n4.  计算后验协方差 $P_{k|k} = (I - K H) P_{k|k-1} = (I-K)P_{k|k-1}$：\n    - $I - K = \\begin{pmatrix} 1.000 - 0.5000  0 - 0.5000 \\\\ 0 - 0.5000  1.000 - 0.5000 \\end{pmatrix} = \\begin{pmatrix} 0.5000  -0.5000 \\\\ -0.5000  0.5000 \\end{pmatrix}$。\n    - $P_{k|k} = \\begin{pmatrix} 0.5000  -0.5000 \\\\ -0.5000  0.5000 \\end{pmatrix} \\begin{pmatrix} 1.000  0.9990 \\\\ 0.9990  0.9980 \\end{pmatrix}$。\n    - $P_{11} = (0.5000 \\times 1.000) + (-0.5000 \\times 0.9990) = (0.5000) + (-0.4995) = 0.0005 \\to 0.0005000$。\n    - $P_{12} = (0.5000 \\times 0.9990) + (-0.5000 \\times 0.9980) = (0.4995) + (-0.4990) = 0.0005 \\to 0.0005000$。\n    - $P_{21} = (-0.5000 \\times 1.000) + (0.5000 \\times 0.9990) = (-0.5000) + (0.4995) = -0.0005 \\to -0.0005000$。\n    - $P_{22} = (-0.5000 \\times 0.9990) + (0.5000 \\times 0.9980) = (-0.4995) + (0.4990) = -0.0005 \\to -0.0005000$。\n    - $P_{k|k} = \\begin{pmatrix} 0.0005000  0.0005000 \\\\ -0.0005000  -0.0005000 \\end{pmatrix}$。\n\n5.  将结果对称化：$P_{k|k}^{\\text{sym}} = \\frac{1}{2}\\big(P_{k|k} + P_{k|k}^{\\top}\\big)$：\n    - $P_{k|k} + P_{k|k}^{\\top} = \\begin{pmatrix} 0.0005000  0.0005000 \\\\ -0.0005000  -0.0005000 \\end{pmatrix} + \\begin{pmatrix} 0.0005000  -0.0005000 \\\\ 0.0005000  -0.0005000 \\end{pmatrix} = \\begin{pmatrix} 0.001000  0 \\\\ 0  -0.001000 \\end{pmatrix}$。\n    - $P_{k|k}^{\\text{sym}} = \\frac{1}{2} \\begin{pmatrix} 0.001000  0 \\\\ 0  -0.001000 \\end{pmatrix} = \\begin{pmatrix} 0.0005000  0 \\\\ 0  -0.0005000 \\end{pmatrix}$。\n\n6.  计算最小特征值：由于对称化后的矩阵是对角矩阵，其特征值是其对角线元素：$\\lambda_1 = 0.0005000$ 和 $\\lambda_2 = -0.0005000$。最小特征值是 $-0.0005000$。这个负特征值表明得到的矩阵不是半正定的，这是朴素更新公式在有限精度下的失效。\n\nC 部分：通过平方根滤波器进行补救\n\n平方根卡尔曼滤波器通过传播协方差的矩阵平方根，而不是协方差矩阵本身，来减轻半正定性的损失。其基本思想是维持一个因子，例如 Cholesky 因子 $S_{k|k}$，它是一个下三角矩阵，使得 $P_{k|k} = S_{k|k} S_{k|k}^{\\top}$。\n\n这种方法的主要优点是：\n1.  **保证半正定性**：根据构造，对于任何实矩阵 $A$，形如 $A A^{\\top}$ 的矩阵总是半正定的。这是因为对于任何向量 $x$，二次型 $x^{\\top}(A A^{\\top})x = (A^{\\top}x)^{\\top}(A^{\\top}x) = \\|A^{\\top}x\\|_2^2$ 总是非负的。只要滤波器计算出实值的 Cholesky 因子 $S_{k|k}$，得到的全协方差矩阵 $P_{k|k} = S_{k|k} S_{k|k}^{\\top}$ 就保证是半正定的。这完全避免了在 B 部分中观察到的失效模式，即计算出的协方差变得不定。\n2.  **改进的数值稳定性**：矩阵 $P$ 的条件数与它的 Cholesky 因子 $S$ 的条件数通过 $\\kappa(P) = \\kappa(S)^2$ 相关联。涉及平方根因子 $S$ 的数值运算是在一个通常比 $P$ 条件数好得多的矩阵上执行的，从而减少了舍入误差的影响。在 B 部分中观察到的灾难性抵消，特别是在减法 $(I-KH)P_{k|k-1}$ 中，是在病态矩阵上操作的症状。\n3.  **使用稳定的数值技术**：从先验因子 $S_{k|k-1}$ 到后验因子 $S_{k|k}$ 的更新步骤是使用数值稳定的算法实现的，最著名的是那些基于正交变换（如 QR 分解）的算法。测量更新可以被表述为寻找矩阵和或差的 Cholesky 因子的问​​题，这可以通过构造一个辅助数组并应用一系列高度稳定的 Givens 旋转或 Householder 反射来将其三角化来完成。这些正交变换是完全良态的，不会放大数值误差，从而保持了因子的准确性，进而保持了协方差表示的完整性。",
            "answer": "$$\\boxed{-0.0005000}$$"
        }
    ]
}