{
    "hands_on_practices": [
        {
            "introduction": "为了扎实掌握集合调整卡尔曼滤波器（EAKF）的核心机制，我们从一个基础练习开始。该实践将问题简化为一个一维线性高斯系统，让您能够从第一性原理出发推导 EAKF 的更新过程。通过手动计算后验均值和方差，并确定应用于每个集合成员的确定性调整，您将具体理解 EAKF 是如何将理论上的贝叶斯更新转化为实际的集合变换的 。",
            "id": "3378748",
            "problem": "考虑一个一维线性高斯数据同化场景，标量状态变量 $x$ 代表气温。给定一个大小为 $N = 5$ 的预报（先验）集合，其成员（单位为开尔文）为\n$$\n\\{x_{1}^{f},x_{2}^{f},x_{3}^{f},x_{4}^{f},x_{5}^{f}\\}=\\{299.0,\\,300.5,\\,298.7,\\,301.2,\\,300.1\\}\\ \\mathrm{K}.\n$$\n观测算子为恒等算子，因此观测值 $y$ 直接测量 $x$。有一个值为 $y=300.8\\ \\mathrm{K}$ 的单一观测值，观测误差为高斯分布，其均值为零，已知方差为 $R=0.25\\ \\mathrm{K}^{2}$。假设预报集合是 $x$ 的高斯先验分布的一个无偏蒙特卡洛表示。\n\n从线性高斯反演问题和数据同化的第一性原理出发，即专门针对线性高斯模型的 Bayes 定理以及由此得到的后验均值和协方差的 Kalman 滤波器表征，并利用集合调整 Kalman 滤波器（EAKF）的定义性质——即它对集合距平应用一个确定性的、保持均值的线性映射，使得分析集合的样本协方差与 Kalman 后验协方差相匹配——完成以下任务：\n\n- 推导在此设置下由线性高斯贝叶斯更新所蕴含的标量后验（分析）均值和方差。\n- 根据 EAKF 分析集合在一维情况下必须精确匹配这些后验一阶矩和二阶矩的要求，确定应用于每个集合距平的确定性调整。\n- 应用此调整来计算第四个集合成员 $x_{4}^{a}$ 经 EAKF 更新后的值。\n\n从给定集合估计预报协方差时，使用除数为 $N-1$ 的无偏有限集合样本协方差。将 $x_{4}^{a}$ 的最终数值答案以开尔文表示，并四舍五入到四位有效数字。",
            "solution": "该问题是有效的。这是一个在数据同化领域内适定的、有科学依据的问题，为获得唯一解提供了所有必要信息。\n\n问题要求使用集合调整 Kalman 滤波器（EAKF）计算特定集合成员的更新值。求解过程首先需要从线性高斯贝叶斯更新中推导出理论上的后验均值和方差，然后利用 EAKF 的定义性质来确定应用于该集合的变换。\n\n**1. 线性高斯系统的贝叶斯框架**\n\n问题设定在线性高斯框架中。状态变量 $x$ 的先验分布假定为高斯分布，由预报集合的统计数据表示：\n$$x \\sim \\mathcal{N}(\\bar{x}^f, P^f)$$\n其中 $\\bar{x}^f$ 是预报均值，$P^f$ 是预报误差协方差（在这个一维情况下为标量方差）。\n\n观测模型是线性的，并带有加性高斯噪声：\n$$y = Hx + v, \\quad v \\sim \\mathcal{N}(0, R)$$\n其中 $y$ 是观测值，$H$ 是观测算子，$v$ 是观测误差，$R$ 是观测误差方差。由此，似然函数 $p(y|x)$ 也是高斯分布：\n$$y|x \\sim \\mathcal{N}(Hx, R)$$\n\n根据 Bayes 定理，后验分布 $p(x|y)$ 与似然和先验的乘积成正比，$p(x|y) \\propto p(y|x)p(x)$。对于这个线性高斯系统，后验分布也是一个高斯分布：\n$$x|y \\sim \\mathcal{N}(\\bar{x}^a, P^a)$$\n后验（或分析）均值 $\\bar{x}^a$ 和方差 $P^a$ 由标准的 Kalman 滤波器更新方程给出。\n\n**2. 后验均值和方差的推导**\n\n首先，我们从给定的预报集合 $\\{x_{1}^{f},x_{2}^{f},x_{3}^{f},x_{4}^{f},x_{5}^{f}\\}=\\{299.0, 300.5, 298.7, 301.2, 300.1\\}$ 估计先验矩，即预报均值 $\\bar{x}^f$ 和方差 $P^f$。集合大小为 $N=5$。\n\n预报均值是集合的样本均值：\n$$\n\\bar{x}^f = \\frac{1}{N} \\sum_{i=1}^{N} x_i^f = \\frac{1}{5}(299.0 + 300.5 + 298.7 + 301.2 + 300.1) = \\frac{1499.5}{5} = 299.9\\ \\mathrm{K}\n$$\n\n预报方差是无偏样本方差，使用除数 $N-1$：\n$$\nP^f = \\frac{1}{N-1} \\sum_{i=1}^{N} (x_i^f - \\bar{x}^f)^2\n$$\n距平的平方 $(x_i^f - \\bar{x}^f)^2$ 为：\n$(299.0 - 299.9)^2 = (-0.9)^2 = 0.81$\n$(300.5 - 299.9)^2 = (0.6)^2 = 0.36$\n$(298.7 - 299.9)^2 = (-1.2)^2 = 1.44$\n$(301.2 - 299.9)^2 = (1.3)^2 = 1.69$\n$(300.1 - 299.9)^2 = (0.2)^2 = 0.04$\n$$\nP^f = \\frac{1}{4}(0.81 + 0.36 + 1.44 + 1.69 + 0.04) = \\frac{4.34}{4} = 1.085\\ \\mathrm{K}^2\n$$\n\n现在，我们应用 Kalman 滤波器更新方程。观测算子是恒等算子，因此在这个标量情况下，$H=1$。观测值为 $y=300.8\\ \\mathrm{K}$，其误差方差为 $R=0.25\\ \\mathrm{K}^2$。\n\nKalman 增益 $K$ 为：\n$$\nK = P^f H^T (H P^f H^T + R)^{-1} = P^f (P^f + R)^{-1} = \\frac{1.085}{1.085 + 0.25} = \\frac{1.085}{1.335}\n$$\n\n分析均值 $\\bar{x}^a$ 为：\n$$\n\\bar{x}^a = \\bar{x}^f + K(y - H\\bar{x}^f) = 299.9 + \\frac{1.085}{1.335}(300.8 - 299.9) = 299.9 + \\frac{1.085}{1.335}(0.9)\n$$\n$$\n\\bar{x}^a = 299.9 + \\frac{0.9765}{1.335} \\approx 299.9 + 0.731460674 \\approx 300.63146\\ \\mathrm{K}\n$$\n\n分析方差 $P^a$ 为：\n$$\nP^a = (I - KH)P^f = (1 - K)P^f = \\left(1 - \\frac{1.085}{1.335}\\right) \\times 1.085 = \\frac{0.25}{1.335} \\times 1.085 = \\frac{0.27125}{1.335}\n$$\n$$\nP^a \\approx 0.20318352\\ \\mathrm{K}^2\n$$\n\n**3. 集合调整 Kalman 滤波器 (EAKF) 更新**\n\nEAKF 通过一个保持均值并调整距平的确定性线性变换，将每个预报集合成员 $x_i^f$ 更新为分析成员 $x_i^a$：\n$$\nx_i^a = \\bar{x}^a + \\alpha (x_i^f - \\bar{x}^f)\n$$\n其中 $\\bar{x}^a$ 是上面计算出的分析均值。选择缩放因子 $\\alpha$，使得得到的分析集合 $\\{x_i^a\\}$ 的样本方差与理论分析方差 $P^a$ 相匹配。\n\n分析集合的样本方差为：\n$$\nP^a_{\\text{ens}} = \\frac{1}{N-1} \\sum_{i=1}^{N} (x_i^a - \\bar{x}^a)^2 = \\frac{1}{N-1} \\sum_{i=1}^{N} (\\alpha(x_i^f - \\bar{x}^f))^2 = \\alpha^2 \\left(\\frac{1}{N-1} \\sum_{i=1}^{N} (x_i^f - \\bar{x}^f)^2\\right) = \\alpha^2 P^f\n$$\n令 $P^a_{\\text{ens}} = P^a$，我们得到：\n$$\n\\alpha^2 P^f = P^a \\implies \\alpha = \\sqrt{\\frac{P^a}{P^f}}\n$$\n代入 $P^a = (1-K)P^f$：\n$$\n\\alpha = \\sqrt{\\frac{(1-K)P^f}{P^f}} = \\sqrt{1-K}\n$$\n现在我们计算 $\\alpha$ 的值：\n$$\n\\alpha = \\sqrt{1 - \\frac{1.085}{1.335}} = \\sqrt{\\frac{1.335 - 1.085}{1.335}} = \\sqrt{\\frac{0.25}{1.335}} \\approx 0.43274233\n$$\n\n**4. 计算更新后的第四个集合成员**\n\n我们现在应用 EAKF 更新规则来计算第四个集合成员的分析值 $x_4^a$。\n给定的预报成员是 $x_4^f = 301.2\\ \\mathrm{K}$。\n该成员的预报距平为 $x_4^f - \\bar{x}^f = 301.2 - 299.9 = 1.3\\ \\mathrm{K}$。\n\n更新后的值 $x_4^a$ 为：\n$$\nx_4^a = \\bar{x}^a + \\alpha (x_4^f - \\bar{x}^f)\n$$\n使用之前计算的值：\n$$\nx_4^a \\approx 300.63146067 + (0.43274233 \\times 1.3)\n$$\n$$\nx_4^a \\approx 300.63146067 + 0.56256503\n$$\n$$\nx_4^a \\approx 301.1940257\\ \\mathrm{K}\n$$\n\n问题要求将答案四舍五入到四位有效数字。数字是 $301.194...$。前四位有效数字是 $3, 0, 1, 1$。第五位是 $9$，所以我们将第四位有效数字向上取整。\n$$\nx_4^a \\approx 301.2\\ \\mathrm{K}\n$$",
            "answer": "$$\\boxed{301.2}$$"
        },
        {
            "introduction": "掌握了基本更新机制后，我们来探讨 EAKF 的一个关键特性：它在处理非线性观测算子时的行为。理论上，完美的贝叶斯更新与观测数据被处理的顺序无关，但 EAKF 依赖于有限集合的线性回归，这可能打破这一理想属性。本练习  将引导您通过一个精心构建的反例，来证明以不同顺序同化观测数据会导致不同的后验状态，从而揭示该滤波器的近似本质。",
            "id": "3378631",
            "problem": "考虑一个标量状态变量 $x \\in \\mathbb{R}$，其先验有限集合大小为 $N=3$，由成员 $x^{(1)}=-2$、$x^{(2)}=1$ 和 $x^{(3)}=1$ 给出。假设观测误差是加性的、独立的、高斯的。有两个可用的观测：\n- 第一个是 $y_{1}$，其观测函数为 $h_{1}(x)=x$，误差方差为 $R_{1}=1$。\n- 第二个是 $y_{2}$，其观测函数为 $h_{2}(x)=x^{2}$，误差方差为 $R_{2}=1$。\n\n假设实现的观测值等于相应观测函数的先验集合均值，因此对于 $y_{1}$ 和 $y_{2}$，新息均为零，只有集合异常被调整。\n\n同化过程使用集合调整卡尔曼滤波（Ensemble Adjustment Kalman Filter, EAKF）进行。对于每个标量观测 $y$，其观测函数 $z=h(x)$ 应用于每个集合成员以产生 $\\{z^{(i)}\\}_{i=1}^{N}$。EAKF 确定性地调整观测空间异常，使得 $z$ 的后验方差与标量卡尔曼后验方差一致，然后使用从有限集合计算出的最小二乘线性回归斜率 $b=\\operatorname{cov}(x,z)/\\operatorname{var}(z)$，将这些调整后的观测空间异常映射回状态空间异常。基于以下公式进行计算：\n- 标量线性高斯后验方差公式，$\\operatorname{var}(z \\mid y)=\\left(\\operatorname{var}(z)^{-1}+R^{-1}\\right)^{-1}=\\frac{\\operatorname{var}(z)\\,R}{\\operatorname{var}(z)+R}$。\n- 样本均值、方差和协方差的定义，$\\overline{u}=\\frac{1}{N}\\sum_{i=1}^{N}u^{(i)}$，$\\operatorname{var}(u)=\\frac{1}{N-1}\\sum_{i=1}^{N}\\left(u^{(i)}-\\overline{u}\\right)^{2}$，$\\operatorname{cov}(u,v)=\\frac{1}{N-1}\\sum_{i=1}^{N}\\left(u^{(i)}-\\overline{u}\\right)\\left(v^{(i)}-\\overline{v}\\right)$。\n\n任务：\n1. 按照 $y_{1}$ 然后 $y_{2}$ 的顺序处理两个观测，使用上述 EAKF 异常调整逻辑。计算状态 $x$ 的最终后验集合方差。\n2. 按照相反的顺序，$y_{2}$ 然后 $y_{1}$，处理两个观测，并计算 $x$ 的最终后验集合方差。\n3. 提供差异 $\\Delta=\\operatorname{var}^{\\text{post}}_{x}\\big|_{y_{1}\\rightarrow y_{2}}-\\operatorname{var}^{\\text{post}}_{x}\\big|_{y_{2}\\rightarrow y_{1}}$ 的精确封闭形式表达式，并简化为单个有理数。不需要四舍五入。\n4. 简要解释为什么对于这个有限集合，两个后验方差不同，并讨论至少两种在实践中可以减少或消除这种顺序依赖性的缓解策略。\n\n你的最终答案必须是 $\\Delta$ 的精确值，表示为单个最简分数。",
            "solution": "所述问题具有科学依据，提法恰当，并基于数据同化中集合调整卡尔曼滤波（EAKF）的既定原则。所有必要的数据、定义和条件都已提供，且没有内部矛盾。因此，该问题是有效的，可以计算出解。\n\n任务是计算在以两种不同顺序同化两个观测值 $y_1$ 和 $y_2$ 后的最终后验状态方差，求出这些方差的差异，并解释结果。集合大小为 $N=3$。样本均值、方差和协方差定义如下：\n$$ \\overline{u}=\\frac{1}{N}\\sum_{i=1}^{N}u^{(i)} $$\n$$ \\operatorname{var}(u)=\\frac{1}{N-1}\\sum_{i=1}^{N}\\left(u^{(i)}-\\overline{u}\\right)^{2} $$\n$$ \\operatorname{cov}(u,v)=\\frac{1}{N-1}\\sum_{i=1}^{N}\\left(u^{(i)}-\\overline{u}\\right)\\left(v^{(i)}-\\overline{v}\\right) $$\n\n状态 $x$ 的初始先验集合为 $\\{x^{(1)}, x^{(2)}, x^{(3)}\\} = \\{-2, 1, 1\\}$。\n初始先验均值为 $\\bar{x} = \\frac{1}{3}(-2+1+1) = 0$。\n初始先验方差为 $\\operatorname{var}(x) = \\frac{1}{3-1}\\left((-2-0)^2 + (1-0)^2 + (1-0)^2\\right) = \\frac{1}{2}(4+1+1) = 3$。\n\n问题指出新息为零，因此每一步的后验均值将等于先验均值。我们只需要更新集合异常。\n\n**1. 处理顺序 $y_1$ 然后 $y_2$**\n\n**步骤 1：同化 $y_1$**\n第一个观测是 $y_1$，观测函数为 $h_1(x)=x$，误差方差为 $R_1=1$。\n将先验集合映射到观测空间：$\\{z_1^{(i)}\\} = \\{h_1(x^{(i)})\\} = \\{-2, 1, 1\\}$。\n$z_1$ 的统计量与 $x$ 的相同：\n$\\bar{z}_1 = \\bar{x} = 0$。\n$\\operatorname{var}(z_1) = \\operatorname{var}(x) = 3$。\n\n使用标量卡尔曼公式计算观测空间中的后验方差：\n$$ \\operatorname{var}(z_1|y_1) = \\frac{\\operatorname{var}(z_1) R_1}{\\operatorname{var}(z_1) + R_1} = \\frac{3 \\cdot 1}{3+1} = \\frac{3}{4} $$\nEAKF 将先验观测异常缩小一个因子 $\\alpha_1$：\n$$ \\alpha_1 = \\sqrt{\\frac{\\operatorname{var}(z_1|y_1)}{\\operatorname{var}(z_1)}} = \\sqrt{\\frac{3/4}{3}} = \\sqrt{\\frac{1}{4}} = \\frac{1}{2} $$\n调整后的观测异常为 $z_1'^{\\text{post}(i)} = \\alpha_1 z_1'^{\\text{prior}(i)}$。\n为更新状态异常，我们计算线性回归斜率 $b_1$：\n$$ b_1 = \\frac{\\operatorname{cov}(x, z_1)}{\\operatorname{var}(z_1)} = \\frac{\\operatorname{cov}(x, x)}{\\operatorname{var}(x)} = 1 $$\n后验状态异常是通过应用基于观测空间异常变化的更新来找到的。更新公式为 $x'^{\\text{post}(i)} = x'^{\\text{prior}(i)} + b_1(z_1'^{\\text{post}(i)} - z_1'^{\\text{prior}(i)})$。由于 $z_1=x$，我们有 $z_1' = x'$，因此这变为 $x'^{\\text{post}(i)} = x'^{\\text{prior}(i)} + 1 \\cdot (\\alpha_1 x'^{\\text{prior}(i)} - x'^{\\text{prior}(i)}) = \\alpha_1 x'^{\\text{prior}(i)}$。\n先验状态异常为 $\\{x'^{(1)}, x'^{(2)}, x'^{(3)}\\} = \\{-2, 1, 1\\}$。\n后验状态异常为：\n$x'^{\\text{post}(1)} = \\frac{1}{2}(-2) = -1$\n$x'^{\\text{post}(2)} = \\frac{1}{2}(1) = \\frac{1}{2}$\n$x'^{\\text{post}(3)} = \\frac{1}{2}(1) = \\frac{1}{2}$\n$x$ 的新集合（即下一步的先验）为 $\\{x^{(i)}\\} = \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$，均值为 $\\bar{x}=0$。\n这个中间集合的方差是 $\\operatorname{var}(x) = \\frac{1}{2}((-1)^2 + (\\frac{1}{2})^2 + (\\frac{1}{2})^2) = \\frac{1}{2}(1+\\frac{1}{4}+\\frac{1}{4}) = \\frac{3}{4}$。\n\n**步骤 2：同化 $y_2$**\n第二个观测是 $y_2$，其观测函数为 $h_2(x)=x^2$，误差方差为 $R_2=1$。先验集合为 $x \\in \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$。\n将此集合映射到观测空间：$\\{z_2^{(i)}\\} = \\{h_2(x^{(i)})\\} = \\{(-1)^2, (\\frac{1}{2})^2, (\\frac{1}{2})^2\\} = \\{1, \\frac{1}{4}, \\frac{1}{4}\\}$。\n计算此步骤先验的统计量：\n$\\bar{x} = 0$，$\\operatorname{var}(x) = \\frac{3}{4}$。\n$\\bar{z}_2 = \\frac{1}{3}(1+\\frac{1}{4}+\\frac{1}{4}) = \\frac{1}{2}$。\n$\\operatorname{var}(z_2) = \\frac{1}{2}((1-\\frac{1}{2})^2 + (\\frac{1}{4}-\\frac{1}{2})^2 + (\\frac{1}{4}-\\frac{1}{2})^2) = \\frac{1}{2}((\\frac{1}{2})^2 + (-\\frac{1}{4})^2 + (-\\frac{1}{4})^2) = \\frac{1}{2}(\\frac{1}{4}+\\frac{1}{16}+\\frac{1}{16}) = \\frac{3}{16}$。\n$\\operatorname{cov}(x, z_2) = \\frac{1}{2}\\left( (-1-0)(1-\\frac{1}{2}) + (\\frac{1}{2}-0)(\\frac{1}{4}-\\frac{1}{2}) + (\\frac{1}{2}-0)(\\frac{1}{4}-\\frac{1}{2}) \\right) = \\frac{1}{2}(-\\frac{1}{2} - \\frac{1}{8} - \\frac{1}{8}) = -\\frac{3}{8}$。\n\n计算观测空间中的后验方差：\n$$ \\operatorname{var}(z_2|y_2) = \\frac{\\operatorname{var}(z_2) R_2}{\\operatorname{var}(z_2) + R_2} = \\frac{3/16 \\cdot 1}{3/16+1} = \\frac{3/16}{19/16} = \\frac{3}{19} $$\n收缩因子为 $\\alpha_2 = \\sqrt{\\frac{\\operatorname{var}(z_2|y_2)}{\\operatorname{var}(z_2)}} = \\sqrt{\\frac{3/19}{3/16}} = \\sqrt{\\frac{16}{19}} = \\frac{4}{\\sqrt{19}}$。\n回归斜率为 $b_2 = \\frac{\\operatorname{cov}(x, z_2)}{\\operatorname{var}(z_2)} = \\frac{-3/8}{3/16} = -2$。\n\n最终的后验状态异常为 $x'^{\\text{post}(i)} = x'^{\\text{prior}(i)} + b_2(\\alpha_2 - 1)z_2'^{\\text{prior}(i)}$。\n先验异常：$x' \\in \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$，$z_2' \\in \\{\\frac{1}{2}, -\\frac{1}{4}, -\\frac{1}{4}\\}$。\n$x'^{\\text{post}(1)} = -1 + (-2)(\\frac{4}{\\sqrt{19}}-1)(\\frac{1}{2}) = -1 - (\\frac{4}{\\sqrt{19}}-1) = -\\frac{4}{\\sqrt{19}}$。\n$x'^{\\text{post}(2)} = \\frac{1}{2} + (-2)(\\frac{4}{\\sqrt{19}}-1)(-\\frac{1}{4}) = \\frac{1}{2} + \\frac{1}{2}(\\frac{4}{\\sqrt{19}}-1) = \\frac{2}{\\sqrt{19}}$。\n$x'^{\\text{post}(3)} = \\frac{1}{2} + (-2)(\\frac{4}{\\sqrt{19}}-1)(-\\frac{1}{4}) = \\frac{2}{\\sqrt{19}}$。\n最终的后验方差是：\n$$ \\operatorname{var}^{\\text{post}}_{x}\\big|_{y_{1}\\rightarrow y_{2}} = \\frac{1}{2}\\left( (-\\frac{4}{\\sqrt{19}})^2 + (\\frac{2}{\\sqrt{19}})^2 + (\\frac{2}{\\sqrt{19}})^2 \\right) = \\frac{1}{2}\\left(\\frac{16}{19} + \\frac{4}{19} + \\frac{4}{19}\\right) = \\frac{12}{19} $$\n\n**2. 处理顺序 $y_2$ 然后 $y_1$**\n\n**步骤 1：同化 $y_2$**\n先验是初始集合 $x \\in \\{-2, 1, 1\\}$，其中 $\\bar{x}=0, \\operatorname{var}(x)=3$。\n观测函数 $h_2(x)=x^2, R_2=1$。\n映射到观测空间：$\\{z_2^{(i)}\\} = \\{h_2(x^{(i)})\\} = \\{(-2)^2, 1^2, 1^2\\} = \\{4, 1, 1\\}$。\n计算统计量：\n$\\bar{z}_2 = \\frac{1}{3}(4+1+1) = 2$。\n$\\operatorname{var}(z_2) = \\frac{1}{2}((4-2)^2 + (1-2)^2 + (1-2)^2) = \\frac{1}{2}(4+1+1) = 3$。\n$\\operatorname{cov}(x, z_2) = \\frac{1}{2}\\left( (-2-0)(4-2) + (1-0)(1-2) + (1-0)(1-2) \\right) = \\frac{1}{2}(-4-1-1) = -3$。\n\n观测空间中的后验方差：\n$$ \\operatorname{var}(z_2|y_2) = \\frac{\\operatorname{var}(z_2) R_2}{\\operatorname{var}(z_2) + R_2} = \\frac{3 \\cdot 1}{3+1} = \\frac{3}{4} $$\n收缩因子 $\\alpha_2 = \\sqrt{\\frac{3/4}{3}} = \\frac{1}{2}$。回归斜率 $b_2 = \\frac{-3}{3}=-1$。\n更新状态异常：$x'^{\\text{post}(i)} = x'^{\\text{prior}(i)} + b_2(\\alpha_2 - 1)z_2'^{\\text{prior}(i)}$。\n先验异常：$x' \\in \\{-2, 1, 1\\}$，$z_2' \\in \\{2, -1, -1\\}$。\n$x'^{\\text{post}(1)} = -2 + (-1)(\\frac{1}{2}-1)(2) = -2 + (-1)(-\\frac{1}{2})(2) = -2+1 = -1$。\n$x'^{\\text{post}(2)} = 1 + (-1)(\\frac{1}{2}-1)(-1) = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n$x'^{\\text{post}(3)} = 1 + (-1)(\\frac{1}{2}-1)(-1) = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n中间集合是 $x \\in \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$，其中 $\\bar{x}=0$ 且方差 $\\operatorname{var}(x) = \\frac{3}{4}$。\n\n**步骤 2：同化 $y_1$**\n先验是 $x \\in \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$，方差为 $\\operatorname{var}(x)=\\frac{3}{4}$。观测是 $h_1(x)=x, R_1=1$。\n映射到观测空间：$z_1 \\in \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$。\n$\\bar{z}_1 = 0$，$\\operatorname{var}(z_1) = \\frac{3}{4}$。\n观测空间中的后验方差：\n$$ \\operatorname{var}(z_1|y_1) = \\frac{\\operatorname{var}(z_1) R_1}{\\operatorname{var}(z_1) + R_1} = \\frac{3/4 \\cdot 1}{3/4+1} = \\frac{3/4}{7/4} = \\frac{3}{7} $$\n收缩因子 $\\alpha_1 = \\sqrt{\\frac{3/7}{3/4}} = \\sqrt{\\frac{4}{7}} = \\frac{2}{\\sqrt{7}}$。\n对状态异常的更新是 $x'^{\\text{post}(i)} = \\alpha_1 x'^{\\text{prior}(i)}$。\n先验异常：$x' \\in \\{-1, \\frac{1}{2}, \\frac{1}{2}\\}$。\n$x'^{\\text{post}(1)} = \\frac{2}{\\sqrt{7}}(-1) = -\\frac{2}{\\sqrt{7}}$。\n$x'^{\\text{post}(2)} = \\frac{2}{\\sqrt{7}}(\\frac{1}{2}) = \\frac{1}{\\sqrt{7}}$。\n$x'^{\\text{post}(3)} = \\frac{2}{\\sqrt{7}}(\\frac{1}{2}) = \\frac{1}{\\sqrt{7}}$。\n最终的后验方差是：\n$$ \\operatorname{var}^{\\text{post}}_{x}\\big|_{y_{2}\\rightarrow y_{1}} = \\frac{1}{2}\\left( (-\\frac{2}{\\sqrt{7}})^2 + (\\frac{1}{\\sqrt{7}})^2 + (\\frac{1}{\\sqrt{7}})^2 \\right) = \\frac{1}{2}\\left(\\frac{4}{7} + \\frac{1}{7} + \\frac{1}{7}\\right) = \\frac{3}{7} $$\n\n**3. 后验方差的差异**\n差异是 $\\Delta = \\operatorname{var}^{\\text{post}}_{x}\\big|_{y_{1}\\rightarrow y_{2}}-\\operatorname{var}^{\\text{post}}_{x}\\big|_{y_{2}\\rightarrow y_{1}}$。\n$$ \\Delta = \\frac{12}{19} - \\frac{3}{7} = \\frac{12 \\cdot 7 - 3 \\cdot 19}{19 \\cdot 7} = \\frac{84 - 57}{133} = \\frac{27}{133} $$\n\n**4. 解释与缓解策略**\n\n后验方差之所以不同，是因为当集合调整卡尔曼滤波与有限集合和非线性观测算子顺序应用时，它对观测处理的顺序并非不变。核心原因在于观测算子的状态相关线性化。该滤波器通过线性回归来近似观测对状态的影响，其系数 $b=\\operatorname{cov}(x,z)/\\operatorname{var}(z)$ 是根据当前集合计算的。\n\n在 $y_1 \\rightarrow y_2$ 的情况下：线性观测 $y_1$ 首先减小了集合的方差。随后同化非线性观测 $y_2$（使用 $h_2(x)=x^2$）时，使用的回归系数是根据这个已经收缩的集合（$\\{-1, 1/2, 1/2\\}$）计算的，我们发现 $b_2 = -2$。\n\n在 $y_2 \\rightarrow y_1$ 的情况下：非线性观测 $y_2$ 首先被同化。回归系数是根据原始的、更宽的集合（$\\{-2, 1, 1\\}$）计算的，得出了一个不同的系数 $b_2 = -1$。这种不同的线性化导致了不同的中间集合，尽管第二步中的线性更新形式上是路径无关的，但其起点不同，从而导致了不同的最终后验。\n\n这种顺序依赖性是在存在非线性的情况下，使用有限集合来估计用于更新状态的互协方差的直接后果。真实的贝叶斯更新是顺序无关的，但 EAKF 是一种近似。\n\n减少或消除这种顺序依赖性的两种缓解策略是：\n1.  **批量同化**：同时处理所有观测。这涉及将观测向量增广为 $Y = [y_1, y_2]^T$，并将观测算子增广为 $H(x)=[h_1(x), h_2(x)]^T$。然后使用观测空间协方差和回归系数的矩阵运算执行一次 EAKF 更新。这通过将观测作为一个整体块来处理，在数学上消除了顺序依赖性。\n2.  **增加集合大小**：小集合大小（$N=3$）带来的采样误差加剧了顺序依赖效应。一个更大的集合将提供更稳定和准确的协方差和回归统计量估计。当 $N \\rightarrow \\infty$ 时，样本协方差收敛于潜在分布的真实协方差，滤波器的行为接近于精确卡尔曼滤波器（对于线性问题）或成为更准确的蒙特卡洛近似（对于非线性问题），从而减少顺序依赖性的实际影响。",
            "answer": "$$\\boxed{\\frac{27}{133}}$$"
        },
        {
            "introduction": "现在我们转向实际数据同化中的另一个基本挑战：秩亏问题。在许多现实应用中，集合大小远小于状态或观测维度（$N-1 \\lt m$），这意味着集合子空间无法表示所有可能的误差结构。本练习  深入探讨了这一限制的后果，要求您推导并量化滤波器无法校正的残余失配，从而清晰地衡量当集合大小不足时 EAKF 的性能边界。",
            "id": "3378735",
            "problem": "考虑一个数据同化中的线性反演问题，其状态向量为 $\\;x \\in \\mathbb{R}^{n}\\;$，观测算子为 $\\;H \\in \\mathbb{R}^{m \\times n}\\;$，秩为 $\\;m\\;$。观测由 $\\;y = H x + e\\;$ 给出，其中 $\\;e \\sim \\mathcal{N}(0,R)\\;$ 且 $\\;R \\in \\mathbb{R}^{m \\times m}\\;$ 是对称正定矩阵。一个大小为 $\\;N\\;$ 的集合定义了一个先验均值 $\\;\\bar{x}^{f}\\;$ 和一个样本先验协方差 $\\;P^{f}\\;$，其秩为 $\\;r = N - 1\\;$。假设 $\\;r  m\\;$，因此先验集合异常无法张成整个观测空间。\n\n集合调整卡尔曼滤波器 (Ensemble Adjustment Kalman Filter, EAKF) 执行一种确定性更新，调整集合异常以在集合子空间内实现与线性高斯贝叶斯分析一致的后验协方差。定义先验观测空间协方差 $\\;S = H P^{f} H^{\\top}\\;$ 和白化矩阵 $\\;\\tilde{S} = R^{-1/2} S R^{-1/2}\\;$。设 $\\;\\tilde{S}\\;$ 的特征分解为 $\\;\\tilde{S} = Q \\Lambda Q^{\\top}\\;$，其中 $\\;Q \\in \\mathbb{R}^{m \\times m}\\;$ 是标准正交矩阵，$\\;\\Lambda = \\mathrm{diag}(\\lambda_{1},\\ldots,\\lambda_{m})\\;$，由于秩亏，最后 $\\;m-r\\;$ 个特征值为零。\n\n从限制在集合子空间内的贝叶斯分析的线性高斯最小二乘公式以及相关的正规方程出发，推导沿观测方向可达到的最小分析方差，并说明秩亏如何限制创新方差的减小。然后，用 $\\;\\Lambda\\;$ 和白化创新向量 $\\;\\tilde{d} = R^{-1/2}(y - H \\bar{x}^{f})\\;$ 来量化残余失配范数 $\\;\\|y - H \\bar{x}_{a}\\|_{R^{-1}}^{2}\\;$，其中 $\\;\\bar{x}_{a}\\;$ 是 EAKF 分析均值。\n\n最后，对特定情况 $\\;m = 3\\;$, $\\;r = 2\\;$ 以及 $\\;Q = I_{3}\\;$ 和 $\\;\\Lambda = \\mathrm{diag}(4,1,0)\\;$ 评估这些量。取白化创新向量 $\\;\\tilde{d} = [2,\\,-1,\\,3]^{\\top}\\;$。报告：\n- $\\;\\|y - H \\bar{x}_{a}\\|_{R^{-1}}^{2}\\;$ 的数值，以及\n- 由 $\\;\\mathrm{tr}\\big((I + \\tilde{S})^{-1}\\big)\\;$ 度量的观测空间中可达到的最小平均分析方差。\n\n将两个所求的数值四舍五入到四位有效数字。两个答案都是无量纲的；不要包含单位。",
            "solution": "首先验证问题的科学合理性、自洽性和适定性。\n\n### 步骤 1：提取已知条件\n- 状态向量：$x \\in \\mathbb{R}^{n}$\n- 观测算子：$H \\in \\mathbb{R}^{m \\times n}$，秩为 $m$\n- 观测模型：$y = H x + e$，其中 $e$ 是观测误差\n- 观测误差分布：$e \\sim \\mathcal{N}(0,R)$，其中 $R \\in \\mathbb{R}^{m \\times m}$ 是对称正定矩阵。\n- 先验预报均值：$\\bar{x}^{f}$\n- 样本先验预报协方差：$P^{f}$，秩为 $r = N - 1$，其中 $N$ 是集合大小。\n- 秩条件：$r  m$\n- 先验观测空间协方差：$S = H P^{f} H^{\\top}$\n- 白化先验观测空间协方差：$\\tilde{S} = R^{-1/2} S R^{-1/2}$\n- $\\tilde{S}$ 的特征分解：$\\tilde{S} = Q \\Lambda Q^{\\top}$，其中 $Q \\in \\mathbb{R}^{m \\times m}$ 是标准正交矩阵，$\\Lambda = \\mathrm{diag}(\\lambda_{1},\\ldots,\\lambda_{m})$。\n- 因秩亏导致的特征值性质：$\\Lambda$ 中的最后 $m-r$ 个特征值为零。\n- 分析均值：$\\bar{x}_{a}$\n- 白化创新向量：$\\tilde{d} = R^{-1/2}(y - H \\bar{x}^{f})$\n- 特定情况参数：$m = 3$, $r = 2$, $Q = I_{3}$, $\\Lambda = \\mathrm{diag}(4,1,0)$，以及 $\\tilde{d} = [2,\\,-1,\\,3]^{\\top}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在线性反演问题和数据同化的框架内是适定的。该表述使用了集合卡尔曼滤波的标准定义。已知条件是内部一致的；例如，条件 $m=3$ 和 $r=2$ 意味着 $S$ 和 $\\tilde{S}$ 有 $m-r=1$ 个零特征值，这与给定的 $\\Lambda = \\mathrm{diag}(4,1,0)$ 一致。该问题具有科学依据、客观，并包含进行求解所需的所有信息。没有矛盾或歧义之处。\n\n### 步骤 3：结论与行动\n问题有效。将进行完整求解。\n\n### 推导\n\n在线性高斯设置中，分析状态是通过最小化成本函数 $J(x) = (x - \\bar{x}^f)^\\top (P^f)^{-1} (x - \\bar{x}^f) + (y - Hx)^\\top R^{-1} (y - Hx)$ 找到的。均值状态的解，即最佳线性无偏估计（BLUE），由标准卡尔曼滤波更新方程给出。\n\n分析均值 $\\bar{x}_{a}$ 是：\n$$ \\bar{x}_{a} = \\bar{x}^{f} + K (y - H\\bar{x}^{f}) $$\n其中 $K$ 是卡尔曼增益。由于 $P^f$ 是秩亏的，我们使用不要求 $(P^f)^{-1}$ 的 $K$ 的形式：\n$$ K = P^{f}H^{\\top}(H P^{f} H^{\\top} + R)^{-1} = P^{f}H^{\\top}(S + R)^{-1} $$\n分析误差协方差矩阵 $P_a = \\mathrm{Cov}(\\bar{x}_a - x_{\\text{true}})$ 是：\n$$ P_{a} = (I - KH)P^{f} = P^{f} - P^{f}H^{\\top}(S+R)^{-1}HP^{f} $$\n问题要求沿观测方向的分析方差，这对应于投影到观测空间中的分析误差协方差 $H P_{a} H^{\\top}$。\n$$ H P_{a} H^{\\top} = H(P^{f} - P^{f}H^{\\top}(S+R)^{-1}HP^{f})H^{\\top} = S - S(S+R)^{-1}S $$\n使用恒等式 $A - A(A+B)^{-1}A = A(A+B)^{-1}B$，我们可以将其简化为：\n$$ H P_{a} H^{\\top} = S(S+R)^{-1}R $$\n为了用给定的白化量来分析，我们变换这个表达式。令 $\\tilde{P}_a^{\\text{obs}} = R^{-1/2}(H P_a H^\\top)R^{-1/2}$。\n$$ \\tilde{P}_a^{\\text{obs}} = R^{-1/2} [S(S+R)^{-1}R] R^{-1/2} = (R^{-1/2} S R^{-1/2}) (R^{1/2}(S+R)^{-1}R^{1/2}) $$\n第二项是 $(R^{-1/2}(S+R)R^{-1/2})^{-1} = (\\tilde{S}+I)^{-1}$。所以，\n$$ \\tilde{P}_a^{\\text{obs}} = \\tilde{S}(\\tilde{S}+I)^{-1} $$\n这个在观测空间中的白化分析误差协方差矩阵的特征值是 $\\frac{\\lambda_i}{1+\\lambda_i}$。这些表示每个模式可达到的最小分析误差方差，作为观测误差方差的一部分。\n\n接下来，我们处理创新方差的减小。创新向量是 $d = y - H\\bar{x}^f$。分析残差是 $d_a = y - H\\bar{x}_a$。\n$$ d_a = y - H(\\bar{x}^f + K d) = d - HKd = (I - HK)d $$\n代入 $K=P^fH^\\top(S+R)^{-1}$ 和 $S=HP^fH^\\top$：\n$$ d_a = (I - S(S+R)^{-1})d $$\n使用恒等式 $I - A(A+B)^{-1} = B(A+B)^{-1}$，我们得到：\n$$ d_a = R(S+R)^{-1}d $$\n我们将其转换为白化量，$\\tilde{d} = R^{-1/2}d$ 和 $\\tilde{d}_a = R^{-1/2}d_a$。\n$$ \\tilde{d}_a = R^{-1/2} R(S+R)^{-1}R^{1/2}\\tilde{d} = R^{1/2}(S+R)^{-1}R^{1/2}\\tilde{d} = (\\tilde{S}+I)^{-1}\\tilde{d} $$\n使用特征分解 $\\tilde{S}=Q\\Lambda Q^\\top$，我们可以投影到 $\\tilde{S}$ 的特征基上。令 $\\tilde{d}' = Q^\\top \\tilde{d}$ 和 $\\tilde{d}_a' = Q^\\top \\tilde{d}_a$。\n$$ \\tilde{d}_a' = Q^\\top(Q(\\Lambda+I)Q^\\top)^{-1}Q\\tilde{d}' = (\\Lambda+I)^{-1}\\tilde{d}' $$\n分量形式为 $\\tilde{d}_{a,i}' = \\frac{1}{1+\\lambda_i}\\tilde{d}_i'$。\n当 $\\lambda_i > 0$ 时，创新分量减小一个因子 $1+\\lambda_i$。当由于 $P^f$ 的秩亏而导致 $\\lambda_i = 0$ 时，我们有 $\\tilde{d}_{a,i}' = \\tilde{d}_i'$。这意味着在集合未张成的观测空间方向上，创新（失配）根本没有减小。这就是由秩亏对创新方差减小施加的界限。\n\n现在，我们量化残余失配范数 $\\|y - H \\bar{x}_{a}\\|_{R^{-1}}^{2}$。这个范数等价于白化分析残差向量 $\\tilde{d}_a$ 的欧几里得范数的平方。\n$$ \\|y - H \\bar{x}_{a}\\|_{R^{-1}}^{2} = \\|\\tilde{d}_a\\|^2 = \\|(\\tilde{S}+I)^{-1}\\tilde{d}\\|^2 $$\n使用特征分解：\n$$ \\|\\tilde{d}_a\\|^2 = \\|Q(\\Lambda+I)^{-1}Q^\\top \\tilde{d}\\|^2 $$\n由于 $Q$ 是一个标准正交矩阵，它保持欧几里得范数不变，$\\|Qz\\|^2=\\|z\\|^2$。\n$$ \\|\\tilde{d}_a\\|^2 = \\|(\\Lambda+I)^{-1}Q^\\top \\tilde{d}\\|^2 $$\n令 $\\tilde{d}' = Q^\\top \\tilde{d}$，范数内的向量具有分量 $\\frac{\\tilde{d}'_i}{1+\\lambda_i}$。范数的平方是这些分量的平方和：\n$$ \\|y - H \\bar{x}_{a}\\|_{R^{-1}}^{2} = \\sum_{i=1}^m \\frac{(\\tilde{d}'_i)^2}{(1+\\lambda_i)^2} $$\n\n### 数值计算\n我们已知 $m = 3$, $r = 2$, $Q = I_{3}$, $\\Lambda = \\mathrm{diag}(4,1,0)$，以及 $\\tilde{d} = [2,\\,-1,\\,3]^{\\top}$。\n\n首先，我们计算残余失配范数。由于 $Q=I_3$，投影的创新 $\\tilde{d}' = Q^\\top \\tilde{d} = \\tilde{d}$。所以，$\\tilde{d}'_1=2$, $\\tilde{d}'_2=-1$，以及 $\\tilde{d}'_3=3$。特征值是 $\\lambda_1=4$, $\\lambda_2=1$，以及 $\\lambda_3=0$。\n$$ \\|y - H \\bar{x}_{a}\\|_{R^{-1}}^{2} = \\frac{(2)^2}{(1+4)^2} + \\frac{(-1)^2}{(1+1)^2} + \\frac{(3)^2}{(1+0)^2} $$\n$$ = \\frac{4}{25} + \\frac{1}{4} + \\frac{9}{1} = 0.16 + 0.25 + 9 = 9.41 $$\n四舍五入到四位有效数字，结果是 $9.410$。\n\n第二，我们计算量 $\\mathrm{tr}\\big((I + \\tilde{S})^{-1}\\big)$，问题将其定义为观测空间中可达到的最小平均分析方差的度量。\n给定 $Q = I_3$, $\\tilde{S} = Q\\Lambda Q^\\top = \\Lambda = \\mathrm{diag}(4,1,0)$。\n$$ I + \\tilde{S} = \\mathrm{diag}(1,1,1) + \\mathrm{diag}(4,1,0) = \\mathrm{diag}(5,2,1) $$\n逆矩阵是：\n$$ (I + \\tilde{S})^{-1} = \\mathrm{diag}(5^{-1}, 2^{-1}, 1^{-1}) = \\mathrm{diag}(\\frac{1}{5}, \\frac{1}{2}, 1) $$\n迹是主对角线元素的和：\n$$ \\mathrm{tr}\\big((I + \\tilde{S})^{-1}\\big) = \\frac{1}{5} + \\frac{1}{2} + 1 = 0.2 + 0.5 + 1 = 1.7 $$\n四舍五入到四位有效数字，结果是 $1.700$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 9.410  1.700 \\end{pmatrix} } $$"
        }
    ]
}