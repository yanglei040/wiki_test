{
    "hands_on_practices": [
        {
            "introduction": "为了巩固控制变量变换的理论概念，我们将通过一系列动手实践来加深理解。这些练习旨在逐步培养您的技能，从基本机理到在大型系统中的实际应用。第一个练习 () 将控制变量变换的抽象思想置于一个简单、物理直观的问题中：估算扩散系数。我们将看到变换如何将一个受约束的物理参数（必须为正）映射到一个无约束的控制变量上，从而简化优化过程，您将练习变换目标函数及其导数的核心微积分方法。",
            "id": "3372052",
            "problem": "考虑一维稳态无量纲扩散问题，空间区间为 $x \\in [0,1]$，扩散系数 $D > 0$ 为空间常数，源项 $s_0 > 0$ 均匀，且边界条件为齐次狄利克雷边界条件。浓度场 $c(x;D)$ 满足\n$$\n0 = D \\,\\frac{d^2 c}{dx^2} + s_0,\\quad c(0;D) = 0,\\quad c(1;D) = 0.\n$$\n给定三个观测点的浓度值，位置分别为 $x_1 = 0.2$、$x_2 = 0.5$ 和 $x_3 = 0.8$，数据向量为\n$$\n\\mathbf{d} = \\begin{pmatrix} 0.205 \\\\ 0.315 \\\\ 0.195 \\end{pmatrix},\n$$\n数据误差协方差为\n$$\n\\mathbf{C}_d = \\operatorname{diag}(0.01,\\,0.01,\\,0.01).\n$$\n假设 $D$ 的先验分布为高斯分布，均值为 $D_b = 0.5$，方差为 $\\sigma_D^2 = (0.2)^2$。应用控制变量变换（CVT），通过由下式定义的标量控制变量 $z \\in \\mathbb{R}$ 来白化先验：\n$$\nD = D_b + \\sigma_D\\, z.\n$$\n在控制变量 $z$ 中建立最小二乘目标函数，其中观测算子 $\\mathbf{H}$ 在位置 $\\{x_i\\}_{i=1}^3$ 处对模型浓度进行采样。使用高斯-牛顿法（从线性化和目标函数的二次近似的第一性原理推导），计算背景场 $z=0$ 处的高斯-牛顿更新量 $\\delta z$。\n\n取 $s_0 = 1$。将最终的更新量 $\\delta z$ 表示为一个无量纲标量。将答案四舍五入至四位有效数字。",
            "solution": "用户希望求解一个逆扩散问题中控制变量的第一个高斯-牛顿更新量。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n\n-   **控制方程**: $0 = D \\,\\frac{d^2 c}{dx^2} + s_0$，对于 $x \\in [0,1]$。\n-   **边界条件**: $c(0;D) = 0$, $c(1;D) = 0$。\n-   **参数**: 扩散系数 $D > 0$，均匀源 $s_0 > 0$。在最终计算中，$s_0=1$。\n-   **数据**: 在 $x_1 = 0.2$、$x_2 = 0.5$、$x_3 = 0.8$ 处的观测值。\n-   **数据向量**: $\\mathbf{d} = \\begin{pmatrix} 0.205 \\\\ 0.315 \\\\ 0.195 \\end{pmatrix}$。\n-   **数据误差协方差**: $\\mathbf{C}_d = \\operatorname{diag}(0.01,\\,0.01,\\,0.01)$。\n-   **先验信息**: $D$ 的先验分布为高斯分布，均值为 $D_b = 0.5$，方差为 $\\sigma_D^2 = (0.2)^2$。\n-   **控制变量变换（CVT）**: $D = D_b + \\sigma_D\\, z$，其中 $z \\in \\mathbb{R}$。\n-   **方法**: 高斯-牛顿法，计算背景状态 $z=0$ 处的更新量 $\\delta z$。\n\n**1.2. 使用提取的已知条件进行验证**\n\n-   **科学依据**：问题描述了一个稳态扩散-反应过程，这是物理学和工程学中的一个基本概念。数学模型是一个标准的二阶常微分方程。这在科学上是合理的。\n-   **良态性**：该问题是良态的。对于任何给定的 $D>0$，带有狄利克雷边界条件的常微分方程都有唯一解。逆问题是在一个标准的贝叶斯/正则化最小二乘框架中构建的，该框架旨在产生一个稳定的解。所有必要的数据、先验信息和误差统计数据都已提供。\n-   **客观性**：问题使用了精确的数学语言陈述，并提供了客观的数值数据。没有主观或含糊不清的术语。\n-   **完整性**：问题是自洽的，提供了执行所要求计算所需的所有信息。\n-   **形式化可行性**：问题已经处于形式化的数学结构中，并且与逆问题中的控制变量变换和高斯-牛顿法的主题直接相关。\n\n**1.3. 结论与行动**\n\n该问题是有效的，因为它科学上合理、良态、客观且完整。我将继续解决它。\n\n### 步骤 2：推导与求解\n\n**2.1. 正演模型解**\n首先，我们求解正演问题以找到浓度 $c(x;D)$。控制方程是一个二阶常微分方程：\n$$ D \\frac{d^2 c}{dx^2} = -s_0 $$\n对 $x$ 积分两次得到：\n$$ D \\frac{dc}{dx} = -s_0 x + A $$\n$$ D c(x) = -\\frac{s_0}{2} x^2 + A x + B $$\n其中 $A$ 和 $B$ 是积分常数。我们应用齐次狄利克雷边界条件：\n-   $c(0) = 0 \\implies D c(0) = 0 = B$。\n-   $c(1) = 0 \\implies D c(1) = 0 = -\\frac{s_0}{2} + A$。这给出 $A = \\frac{s_0}{2}$。\n\n将常数代回，浓度场的解为：\n$$ D c(x; D) = -\\frac{s_0}{2}x^2 + \\frac{s_0}{2}x = \\frac{s_0}{2}(x - x^2) $$\n$$ c(x; D) = \\frac{s_0}{2D} (x - x^2) $$\n\n**2.2. 控制变量的目标函数**\n贝叶斯最小二乘目标函数 $J$ 是数据失配项和背景惩罚项之和：\n$$ J(D) = \\frac{1}{2} (\\mathbf{H}(D) - \\mathbf{d})^T \\mathbf{C}_d^{-1} (\\mathbf{H}(D) - \\mathbf{d}) + \\frac{1}{2} (D - D_b)^2 \\sigma_D^{-2} $$\n其中 $\\mathbf{H}(D)$ 是在观测位置 $\\{x_i\\}$ 处评估 $c(x;D)$ 的观测算子。\n\n控制变量变换为 $D(z) = D_b + \\sigma_D z$。$D$ 的先验项变为：\n$$ \\frac{1}{2} \\frac{((D_b + \\sigma_D z) - D_b)^2}{\\sigma_D^2} = \\frac{1}{2} \\frac{(\\sigma_D z)^2}{\\sigma_D^2} = \\frac{1}{2}z^2 $$\n这将 $D$ 上的先验分布转换为 $z$ 上的标准正态先验分布。用控制变量 $z$ 表示的目标函数是：\n$$ J(z) = \\frac{1}{2} (\\mathbf{H}(z) - \\mathbf{d})^T \\mathbf{C}_d^{-1} (\\mathbf{H}(z) - \\mathbf{d}) + \\frac{1}{2}z^2 $$\n其中 $\\mathbf{H}(z) \\equiv \\mathbf{H}(D(z))$。\n\n**2.3. 高斯-牛顿法**\n高斯-牛顿法在当前估计值 $z_k$ 附近将目标函数近似为二次函数，并找到最小化此近似的更新量 $\\delta z$。我们从背景状态开始，所以 $z_k=0$。\n$z_k+\\delta z$ 处的目标函数通过首先在 $z_k$ 附近线性化观测算子 $\\mathbf{H}(z)$ 来近似：\n$$ \\mathbf{H}(z_k + \\delta z) \\approx \\mathbf{H}(z_k) + \\mathbf{H}'(z_k) \\delta z $$\n其中 $\\mathbf{H}'(z_k) = \\frac{d\\mathbf{H}}{dz}\\big|_{z_k}$ 是雅可比矩阵（在这种标量情况下是一个列向量）。\n\n将此代入 $J(z_k+\\delta z)$：\n$$ J(z_k + \\delta z) \\approx \\frac{1}{2} (\\mathbf{H}(z_k) + \\mathbf{H}'(z_k) \\delta z - \\mathbf{d})^T \\mathbf{C}_d^{-1} (\\mathbf{H}(z_k) + \\mathbf{H}'(z_k) \\delta z - \\mathbf{d}) + \\frac{1}{2}(z_k + \\delta z)^2 $$\n为求最小值，我们对 $\\delta z$ 求导并令结果为零：\n$$ \\frac{\\partial J}{\\partial(\\delta z)} = (\\mathbf{H}'(z_k))^T \\mathbf{C}_d^{-1} (\\mathbf{H}(z_k) - \\mathbf{d} + \\mathbf{H}'(z_k) \\delta z) + (z_k + \\delta z) = 0 $$\n重新排列各项以求解 $\\delta z$：\n$$ \\delta z \\left[ (\\mathbf{H}'(z_k))^T \\mathbf{C}_d^{-1} \\mathbf{H}'(z_k) + 1 \\right] = - \\left[ (\\mathbf{H}'(z_k))^T \\mathbf{C}_d^{-1} (\\mathbf{H}(z_k) - \\mathbf{d}) + z_k \\right] $$\n题目要求我们找到背景状态下的更新量，因此我们设 $z_k=0$：\n$$ \\delta z \\left[ (\\mathbf{H}'(0))^T \\mathbf{C}_d^{-1} \\mathbf{H}'(0) + 1 \\right] = -(\\mathbf{H}'(0))^T \\mathbf{C}_d^{-1} (\\mathbf{H}(0) - \\mathbf{d}) $$\n这个方程定义了高斯-牛顿更新量 $\\delta z$。\n\n**2.4. 数值计算**\n现在我们使用给定值来计算更新方程中的各项：\n$s_0 = 1$, $D_b = 0.5$, $\\sigma_D = 0.2$。位置是 $x_1 = 0.2$, $x_2 = 0.5$, $x_3 = 0.8$。\n数据是 $\\mathbf{d} = \\begin{pmatrix} 0.205 \\\\ 0.315 \\\\ 0.195 \\end{pmatrix}$ 且 $\\mathbf{C}_d^{-1} = \\frac{1}{0.01}\\mathbf{I} = 100\\,\\mathbf{I}$。\n\n-   **计算 $\\mathbf{H}(0)$**：当 $z=0$ 时，我们有 $D = D_b = 0.5$。模型为 $c(x; 0.5) = \\frac{1}{2(0.5)}(x-x^2) = x-x^2$。\n    $$ \\mathbf{H}(0) = \\begin{pmatrix} 0.2 - 0.2^2 \\\\ 0.5 - 0.5^2 \\\\ 0.8 - 0.8^2 \\end{pmatrix} = \\begin{pmatrix} 0.16 \\\\ 0.25 \\\\ 0.16 \\end{pmatrix} $$\n-   **计算失配 $\\mathbf{r}_0 = \\mathbf{H}(0) - \\mathbf{d}$**：\n    $$ \\mathbf{r}_0 = \\begin{pmatrix} 0.16 - 0.205 \\\\ 0.25 - 0.315 \\\\ 0.16 - 0.195 \\end{pmatrix} = \\begin{pmatrix} -0.045 \\\\ -0.065 \\\\ -0.035 \\end{pmatrix} $$\n-   **计算雅可比矩阵 $\\mathbf{H}'(0)$**：我们需要计算在每个 $x_i$ 处的 $\\frac{d\\mathbf{H}}{dz} = \\frac{\\partial c}{\\partial z}$。根据链式法则：\n    $$ \\frac{\\partial c}{\\partial z} = \\frac{\\partial c}{\\partial D} \\frac{dD}{dz} $$\n    我们有 $\\frac{dD}{dz} = \\sigma_D$。并且 $\\frac{\\partial c}{\\partial D} = \\frac{\\partial}{\\partial D} \\left( \\frac{s_0}{2D}(x-x^2) \\right) = -\\frac{s_0}{2D^2}(x-x^2)$。\n    所以，$\\frac{\\partial c}{\\partial z} = -\\frac{s_0 \\sigma_D}{2D^2}(x-x^2)$。\n    当 $z=0$ 时，$D=D_b=0.5$：\n    $$ \\frac{\\partial c}{\\partial z}\\bigg|_{z=0} = -\\frac{1 \\cdot 0.2}{2(0.5)^2}(x-x^2) = -\\frac{0.2}{0.5}(x-x^2) = -0.4(x-x^2) $$\n    现在对每个 $x_i$进行计算：\n    $$ \\mathbf{H}'(0) = \\begin{pmatrix} -0.4(0.2 - 0.2^2) \\\\ -0.4(0.5 - 0.5^2) \\\\ -0.4(0.8 - 0.8^2) \\end{pmatrix} = \\begin{pmatrix} -0.4(0.16) \\\\ -0.4(0.25) \\\\ -0.4(0.16) \\end{pmatrix} = \\begin{pmatrix} -0.064 \\\\ -0.100 \\\\ -0.064 \\end{pmatrix} $$\n-   **计算更新方程的各项**：\n    近似Hessian矩阵的项为 $G = (\\mathbf{H}'(0))^T \\mathbf{C}_d^{-1} \\mathbf{H}'(0) + 1$：\n    $$ (\\mathbf{H}'(0))^T \\mathbf{C}_d^{-1} \\mathbf{H}'(0) = 100 \\begin{pmatrix} -0.064 & -0.100 & -0.064 \\end{pmatrix} \\begin{pmatrix} -0.064 \\\\ -0.100 \\\\ -0.064 \\end{pmatrix} $$\n    $$ = 100 ((-0.064)^2 + (-0.100)^2 + (-0.064)^2) = 100 (0.004096 + 0.01 + 0.004096) = 100(0.018192) = 1.8192 $$\n    所以，$G = 1.8192 + 1 = 2.8192$。\n\n    梯度的项为 $g = (\\mathbf{H}'(0))^T \\mathbf{C}_d^{-1} \\mathbf{r}_0$：\n    $$ g = 100 \\begin{pmatrix} -0.064 & -0.100 & -0.064 \\end{pmatrix} \\begin{pmatrix} -0.045 \\\\ -0.065 \\\\ -0.035 \\end{pmatrix} $$\n    $$ = 100 ((-0.064)(-0.045) + (-0.100)(-0.065) + (-0.064)(-0.035)) $$\n    $$ = 100 (0.00288 + 0.0065 + 0.00224) = 100(0.01162) = 1.162 $$\n-   **求解 $\\delta z$**：\n    更新方程为 $\\delta z \\cdot G = -g$。\n    $$ \\delta z (2.8192) = -1.162 $$\n    $$ \\delta z = -\\frac{1.162}{2.8192} \\approx -0.41217047... $$\n四舍五入到四位有效数字，高斯-牛顿更新量为 $\\delta z = -0.4122$。",
            "answer": "$$\n\\boxed{-0.4122}\n$$"
        },
        {
            "introduction": "现在我们从单个参数转向高维状态向量。在大规模数据同化中使用控制变量变换的一个主要原因是为了改善优化问题的数值属性。这个实践练习 () 提供了一个动手数值实验，通过比较有无变换前后优化问题 Hessian 矩阵的条件数，来量化这种好处。",
            "id": "3372107",
            "problem": "考虑一个带线性观测算子的一维变分数据同化问题。代价函数由变分数据同化中的标准二次型给出：\n$$\nJ(x) = \\frac{1}{2} \\left\\| x - x_b \\right\\|_{B^{-1}}^2 + \\frac{1}{2} \\left\\| y - H x \\right\\|_{R^{-1}}^2,\n$$\n其中 $x \\in \\mathbb{R}^n$ 是状态向量，$x_b \\in \\mathbb{R}^n$ 是背景场状态，$y \\in \\mathbb{R}^n$ 是观测值，$B \\in \\mathbb{R}^{n \\times n}$ 是背景误差协方差矩阵，$H \\in \\mathbb{R}^{n \\times n}$ 是线性观测算子，$R \\in \\mathbb{R}^{n \\times n}$ 是观测误差协方差矩阵。假设 $H = I$ 且 $R = \\sigma_o^2 I$，其中 $I$ 是单位矩阵，$\\sigma_o^2 > 0$ 是观测误差方差。\n\n在任意点，$J(x)$ 的 Hessian 矩阵的 Gauss-Newton 近似为\n$$\nK = B^{-1} + H^\\top R^{-1} H.\n$$\n当 $H = I$ 和 $R = \\sigma_o^2 I$ 时，该式简化为\n$$\nK = B^{-1} + \\frac{1}{\\sigma_o^2} I.\n$$\n\n引入由 $x = x_b + L v$ 定义的控制变量变换，其中 $L \\in \\mathbb{R}^{n \\times n}$ 的选择满足 $L L^\\top = B$（因此 $L$ 是 $B$ 的矩阵平方根），$v \\in \\mathbb{R}^n$ 是控制变量。在 $v$-空间中，Gauss-Newton Hessian 矩阵变为\n$$\nK_v = I + L^\\top H^\\top R^{-1} H L.\n$$\n对于 $H = I$ 和 $R = \\sigma_o^2 I$，该式为\n$$\nK_v = I + \\frac{1}{\\sigma_o^2} L^\\top L = I + \\frac{1}{\\sigma_o^2} B.\n$$\n\n设背景误差协方差 $B$ 由单位区间 $[0,1]$ 上 $n$ 个点的均匀一维网格上的指数相关性定义。网格点为 $x_i = \\frac{i}{n-1}$，其中 $i = 0, 1, \\dots, n-1$。$B$ 的元素定义为\n$$\nB_{ij} = \\sigma_b^2 \\exp\\left(-\\frac{|x_i - x_j|}{\\ell}\\right),\n$$\n其中 $\\sigma_b^2 > 0$ 是背景方差，$\\ell > 0$ 是相关长度尺度，两者均为无量纲。\n\n你的任务是：\n- 针对 $n = 64$，$\\sigma_b^2 = 1$ 和 $\\ell = 0.2$ 构建 $B$。\n- 使用 $B$ 的特征值分解计算 $L = B^{1/2}$。\n- 对于每个指定的 $\\sigma_o^2$ 值，计算未变换的 Hessian 矩阵 $K$ 和变换后的 Hessian 矩阵 $K_v$ 的 2-范数条件数（谱范数（2-范数）条件数）。对称正定矩阵 $A$ 的 2-范数条件数定义为\n$$\n\\kappa_2(A) = \\frac{\\lambda_{\\max}(A)}{\\lambda_{\\min}(A)},\n$$\n其中 $\\lambda_{\\max}(A)$ 和 $\\lambda_{\\min}(A)$ 分别是 $A$ 的最大和最小特征值。\n\n为以下观测误差方差的测试套件提供数值结果：\n- $\\sigma_o^2 = 10^{-8}$ (边界情况：观测极度精确)，\n- $\\sigma_o^2 = 10^{-4}$,\n- $\\sigma_o^2 = 10^{-2}$,\n- $\\sigma_o^2 = 10^{0}$ (一般情况)，\n- $\\sigma_o^2 = 10^{2}$ (边界情况：观测噪声极大)。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素本身都应是一个双元素列表，包含对应 $\\sigma_o^2$ 的 $[\\kappa_2(K), \\kappa_2(K_v)]$ 对。例如，输出格式必须为\n$$\n[\\,[\\kappa_2(K\\_1),\\kappa_2(K\\_{v,1})],\\,[\\kappa_2(K\\_2),\\kappa_2(K\\_{v,2})],\\,\\dots\\,],\n$$\n以标准 Python 列表语法打印为单行。不涉及物理单位；所有量均为无量纲。",
            "solution": "问题陈述是一个适定且具有科学依据的数值线性代数练习，应用于变分数据同化领域。它要求计算标准数据同化代价函数中 Hessian 矩阵的两种不同形式的条件数。所有参数和定义均已提供，问题是自洽的，没有矛盾或歧义。这是一个有效的问题。\n\n核心任务是计算两个矩阵的谱条件数 $\\kappa_2(A) = \\lambda_{\\max}(A)/\\lambda_{\\min}(A)$：未变换的 Hessian 矩阵 $K$ 和变换后的 Hessian 矩阵 $K_v$。\n提供的定义如下：\n1.  未变换的 Hessian 矩阵：$K = B^{-1} + \\frac{1}{\\sigma_o^2} I$\n2.  变换后的 Hessian 矩阵：$K_v = I + \\frac{1}{\\sigma_o^2} B$\n\n这里，$B$ 是背景误差协方差矩阵，$I$ 是单位矩阵，$\\sigma_o^2$ 是观测误差方差。为了计算条件数，我们必须找到 $K$ 和 $K_v$ 的最小和最大特征值。这些特征值可以直接与 $B$ 的特征值关联起来。\n\n设 $\\{\\lambda_i(B)\\}$ 为矩阵 $B$ 的特征值集合。由于 $B$ 被构造成对称正定矩阵，其特征值为实数且为正。设 $\\lambda_{\\min}(B)$ 和 $\\lambda_{\\max}(B)$ 分别表示 $B$ 的最小和最大特征值。\n\n**$K$ 的特征值**\n\n逆矩阵 $B^{-1}$ 的特征值是 $B$ 特征值的倒数，即 $\\{1/\\lambda_i(B)\\}$。顺序相反，因此 $B^{-1}$ 的最大特征值是 $1/\\lambda_{\\min}(B)$，最小特征值是 $1/\\lambda_{\\max}(B)$。\n将一个缩放的单位矩阵 $\\alpha I$ 加到任意矩阵上，会使其特征值平移 $\\alpha$。在我们的例子中，$\\alpha = 1/\\sigma_o^2$。\n因此，$K = B^{-1} + \\frac{1}{\\sigma_o^2} I$ 的极值特征值为：\n$$\n\\lambda_{\\max}(K) = \\lambda_{\\max}(B^{-1}) + \\frac{1}{\\sigma_o^2} = \\frac{1}{\\lambda_{\\min}(B)} + \\frac{1}{\\sigma_o^2}\n$$\n$$\n\\lambda_{\\min}(K) = \\lambda_{\\min}(B^{-1}) + \\frac{1}{\\sigma_o^2} = \\frac{1}{\\lambda_{\\max}(B)} + \\frac{1}{\\sigma_o^2}\n$$\n$K$ 的条件数则为：\n$$\n\\kappa_2(K) = \\frac{\\lambda_{\\max}(K)}{\\lambda_{\\min}(K)} = \\frac{\\frac{1}{\\lambda_{\\min}(B)} + \\frac{1}{\\sigma_o^2}}{\\frac{1}{\\lambda_{\\max}(B)} + \\frac{1}{\\sigma_o^2}}\n$$\n\n**$K_v$ 的特征值**\n\n矩阵 $\\frac{1}{\\sigma_o^2}B$ 的特征值为 $\\{\\frac{\\lambda_i(B)}{\\sigma_o^2}\\}$。加上单位矩阵 $I$ 会使这些特征值平移 $1$。\n因此，$K_v = I + \\frac{1}{\\sigma_o^2} B$ 的极值特征值为：\n$$\n\\lambda_{\\max}(K_v) = 1 + \\frac{\\lambda_{\\max}(B)}{\\sigma_o^2}\n$$\n$$\n\\lambda_{\\min}(K_v) = 1 + \\frac{\\lambda_{\\min}(B)}{\\sigma_o^2}\n$$\n$K_v$ 的条件数则为：\n$$\n\\kappa_2(K_v) = \\frac{\\lambda_{\\max}(K_v)}{\\lambda_{\\min}(K_v)} = \\frac{1 + \\frac{\\lambda_{\\max}(B)}{\\sigma_o^2}}{1 + \\frac{\\lambda_{\\min}(B)}{\\sigma_o^2}}\n$$\n\n这种解析方法表明，我们只需要计算矩阵 $B$ 的极值特征值。计算条件数不需要显式地构造 $B^{-1}$ 或矩阵平方根 $L=B^{1/2}$。\n\n数值实现计划如下：\n1.  定义问题参数：网格大小 $n = 64$，背景方差 $\\sigma_b^2 = 1$，以及相关长度 $\\ell = 0.2$。\n2.  在区间 $[0, 1]$ 上创建包含 $n$ 个点的一维网格。\n3.  根据其定义 $B_{ij} = \\sigma_b^2 \\exp\\left(-\\frac{|x_i - x_j|}{\\ell}\\right)$ 构建 $n \\times n$ 的背景误差协方差矩阵 $B$。\n4.  计算实对称矩阵 $B$ 的特征值。适用于对称矩阵的专门算法，如 `numpy.linalg.eigvalsh`，是合适的，因为它高效且数值稳定。该函数返回已排序的特征值。\n5.  提取最小和最大特征值 $\\lambda_{\\min}(B)$ 和 $\\lambda_{\\max}(B)$。\n6.  遍历给定的观测误差方差列表 $\\sigma_o^2 = \\{10^{-8}, 10^{-4}, 10^{-2}, 10^{0}, 10^{2}\\}$。\n7.  在每次迭代中，使用推导出的公式计算 $\\kappa_2(K)$ 和 $\\kappa_2(K_v)$。\n8.  存储每个 $[\\kappa_2(K), \\kappa_2(K_v)]$ 对，并将最终的对列表格式化为所需的单行字符串输出。",
            "answer": "[[1.0000538231269558,677501.3718919639],[2.857930729165187,677.519969986386],[13.587267191147576,68.75013720779435],[677.519969986386,2.857930729165187],[677501.3718919639,1.0000538231269558]]"
        },
        {
            "introduction": "在天气预报等实际应用中，状态向量可能包含数百万个变量，这使得直接构建像背景误差协方差矩阵 $B$ 或其平方根 $L$ 这样的矩阵变得不可行。最后一个练习 () 解决了这一挑战，展示了如何为一个涉及周期性系统的常见场景高效地实现控制变量变换。您将把变换的代数定义与一个基于快速傅里叶变换 (FFT) 的快速算法联系起来，并分析其计算成本。",
            "id": "3372128",
            "problem": "考虑一个网格大小为 $N$ 的一维周期性离散化，以及一个被视为酉矩阵的离散傅里叶变换（DFT）矩阵 $F \\in \\mathbb{C}^{N \\times N}$，因此有 $F^{-1} = F^{*}$。在增量四维变分资料同化（增量 $4$D-Var）中，一种常见的控制变量变换使用一个对称正定的循环背景协方差矩阵 $B \\in \\mathbb{R}^{N \\times N}$。循环结构意味着 $B$ 可被DFT对角化：$B = F^{*} \\Lambda F$，其中 $\\Lambda = \\operatorname{diag}(\\lambda_{0},\\ldots,\\lambda_{N-1})$ 且对所有 $k$ 都有 $\\lambda_{k} \\ge 0$。然后，一个满足 $B = L L^{T}$ 的控制变量变换因子 $L$ 可以在谱空间上构造如下\n$$\nL \\;=\\; F^{*} \\, \\operatorname{diag}(d_{0},\\ldots,d_{N-1}) \\, F, \\quad d_{k} \\;=\\; \\sqrt{\\lambda_{k}} \\in \\mathbb{R}_{\\ge 0}.\n$$\n请你设计一个算法，使用快速傅里叶变换（FFT）将 $L$ 和 $L^{T}$ 应用于任意向量 $x \\in \\mathbb{R}^{N}$，并推导其计算复杂度和内存需求作为 $N$ 的函数。\n\n你的推导必须从以下基本依据出发：\n- 卷积定理和循环矩阵可被DFT对角化的性质：循环算子的应用等价于在谱域中乘以其傅里叶符号。\n- 关于欧几里得内积的伴随的定义以及 $F$ 的酉性。\n- 基-2 Cooley–Tukey FFT 的标准成本模型：\n  - 一次长度为 $N$ 的复数到复数 FFT 的主导项成本为 $5 N \\log_{2} N$ 次浮点运算（flops）。\n  - 一次长度为 $N$ 的复数到复数逆 FFT 的主导项成本也为 $5 N \\log_{2} N$ 次 flops。\n  - 一个复数与一个实标量的逐点乘法的主导项成本为 $2$ 次 flops。\n\n设计一个显式算法，使用 FFT 应用 $L$ 和 $L^{T}$，且不覆盖输入或输出数组，并假设：\n- 你将谱振幅 $d_{k}$（对于 $k=0,\\ldots,N-1$）作为实数预计算并存储。\n- 你使用一个独立的长度为 $N$ 的复数工作缓冲区（即 $N$ 个复数）来存放傅里叶系数。\n- 输入和输出数组是分别存储的长度为 $N$ 的实值数组。\n\n从第一性原理出发，推导：\n- 在上述成本模型下，将 $L$ 和 $L^{T}$ 各应用一次于任意实数输入的主导项总浮点运算次数。\n- 所需的峰值辅助内存，以存储的实数浮点数数量计量，包括预计算的 $d_{k}$ 和复数工作缓冲区，但不包括输入和输出数组的存储。\n\n请以单个解析表达式的形式给出最终答案，该表达式为一个双元素行向量，其中第一个元素是关于 $N$ 的浮点运算次数函数，第二个元素是关于 $N$ 的辅助内存函数。无需进行数值代入或四舍五入。对数应明确表示为 $\\log_{2}(\\cdot)$，内存应严格以实数单位计算，而非字节或字。",
            "solution": "该问题要求设计一个算法来应用控制变量变换 $L$ 及其转置 $L^T$，并确定此应用的计算复杂度和内存需求。该问题是有效的，因为它在科学上基于线性代数和资料同化的原理，是适定的、客观的且内部一致的。\n\n首先，我们分析变换矩阵 $L$ 及其转置 $L^T$ 的结构。矩阵 $L$ 定义为\n$$\nL = F^{*} D F\n$$\n其中 $F$ 是酉离散傅里叶变换（DFT）矩阵，$D = \\operatorname{diag}(d_{0}, d_{1}, \\ldots, d_{N-1})$ 是一个由非负实数 $d_k = \\sqrt{\\lambda_k}$ 构成的对角矩阵。值 $\\lambda_k$ 是背景协方差矩阵 $B$ 的特征值。问题陈述 $B$ 是一个实对称正定循环矩阵。\n\n让我们确定 $L$ 的转置：\n$$\nL^T = (F^{*} D F)^T = F^T D^T (F^*)^T\n$$\n由于 $D$ 是实对角矩阵，所以 $D^T = D$。酉DFT矩阵 $F$ 的元素为 $F_{jk} = \\frac{1}{\\sqrt{N}} \\exp(-2\\pi i jk / N)$，它是一个对称矩阵，即 $F^T = F$。$F$ 的共轭转置的转置是 $(F^*)^T = \\overline{F}$，其中 $\\overline{F}$ 是 $F$ 的逐元素复共轭。因此，\n$$\nL^T = F D \\overline{F}\n$$\n矩阵 $B$ 是一个实对称循环矩阵。一个实循环矩阵是对称的，当且仅当其生成首行 $(b_0, b_1, \\ldots, b_{N-1})$ 满足 $b_j = b_{N-j}$（对于 $j=1, \\ldots, N-1$）。这类矩阵的特征值是实数，并满足对称性质 $\\lambda_k = \\lambda_{N-k}$（指数对 $N$ 取模）。因此，谱值 $d_k = \\sqrt{\\lambda_k}$ 也满足 $d_k = d_{N-k}$。对角矩阵 $D$ 的这一对称性质意味着 $L$ 本身也是一个对称矩阵。为了证明这一点，我们检查是否有 $L = L^T$：\n$$\nL = L^T \\iff F^* D F = F D \\overline{F}\n$$\nDFT矩阵满足 $F^* = \\overline{F}$。将此代入右侧得到 $F D F^*$。因此，对称的条件是 $F^* D F = F D F^*$。这是否等价于交换性 $D (F^* F) = (F^* F) D$？不是。让我们用 $F$ 左乘，用 $F^*$ 右乘：\n$$\nF(F^* D F)F^* = F(F D F^*)F^* \\implies (FF^*) D (FF^*) = (FF) D (F^*F^*)\n$$\n由于 $F$ 是酉矩阵，$FF^* = I$。所以我们有 $I D I = F^2 D (F^*)^2$。令 $P = F^2$。矩阵 $P$ 是奇偶翻转置换矩阵，$(Px)_j = x_{-j \\pmod N}$。条件变为 $D = P D P^{-1}$，这意味着 $D$ 必须与 $P$ 交换。这要求对所有 $j$ 都有 $d_j = d_{-j \\pmod N} = d_{N-j}$。正如已确立的，这个条件对于对称循环矩阵是成立的。因此，$L$ 是一个对称矩阵，$L=L^T$。\n条件 $B=LL^T$ 也得到满足：$LL^T=L^2 = (F^* D F)(F^* D F) = F^* D (FF^*) D F = F^* D I D F = F^* D^2 F = F^* \\Lambda F = B$。该公式是一致的。\n\n由于 $L=L^T$，应用 $L$ 的算法与应用 $L^T$ 的算法相同。我们设计一个算法来计算 $y = Lx$，其中 $x \\in \\mathbb{R}^N$ 是任意实数输入向量。操作 $y = (F^* D F)x$ 可分解为三个步骤：\n1.  将 $F$ 应用于 $x$：$\\hat{x} = Fx$。这是一个正向DFT。\n2.  将 $D$ 应用于 $\\hat{x}$：$\\hat{y} = D\\hat{x}$。这是一个逐点乘法，$\\hat{y}_k = d_k \\hat{x}_k$。\n3.  将 $F^*$ 应用于 $\\hat{y}$：$y = F^*\\hat{y}$。这是一个逆DFT。\n\n使用指定工作缓冲区的算法如下：\n输入：实向量 $x \\in \\mathbb{R}^N$。\n预计算存储：实向量 $d = (d_0, \\ldots, d_{N-1})$。\n辅助存储：复向量 $\\texttt{work} \\in \\mathbb{C}^N$。\n输出：实向量 $y \\in \\mathbb{R}^N$。\n\n计算 $y = Lx$ 的算法：\n1.  初始化工作缓冲区：对于 $k=0, \\ldots, N-1$，设置 $\\texttt{work}_k \\leftarrow x_k + 0i$。\n2.  正向傅里叶变换：对 $\\texttt{work}$ 应用一次复数到复数 FFT。令结果为 $\\hat{x}_{\\texttt{work}}$。$\\texttt{work} \\leftarrow \\text{FFT}(\\texttt{work})$。\n3.  谱乘法：对于 $k=0, \\ldots, N-1$，将工作缓冲区的元素乘以相应的谱振幅：$\\texttt{work}_k \\leftarrow d_k \\times \\texttt{work}_k$。\n4.  逆傅里叶变换：对 $\\texttt{work}$ 应用一次复数到复数逆 FFT。令结果为 $y_{\\texttt{work}}$。$\\texttt{work} \\leftarrow \\text{IFFT}(\\texttt{work})$。\n5.  最终确定输出：对于 $k=0, \\ldots, N-1$，将工作缓冲区的实部复制到输出向量：$y_k \\leftarrow \\operatorname{Re}(\\texttt{work}_k)$。\n\n现在，我们基于此算法和给定的成本模型来推导计算复杂度和内存需求。\n\n**计算复杂度（浮点运算次数）**\n我们计算单次应用 $L$ 所需的浮点运算（flops）次数。\n- 步骤 1（初始化）：这是一个数据复制操作，不涉及浮点运算。成本 = $0$ flops。\n- 步骤 2（FFT）：一次长度为 $N$ 的复数到复数 FFT 的主导项成本为 $5 N \\log_{2} N$ flops。\n- 步骤 3（谱乘法）：此步骤涉及 $N$ 次复数与实标量的乘法。每次此类乘法成本为 $2$ flops。此步骤的总成本为 $2N$ flops。\n- 步骤 4（IFFT）：一次长度为 $N$ 的复数到复数逆 FFT 的主导项成本为 $5 N \\log_{2} N$ flops。\n- 步骤 5（最终确定）：这是一个数据复制操作，成本为 $0$ flops。\n\n单次应用 $L$ 的总浮点运算次数是这些步骤成本的总和：\n$$\nC_L = (5 N \\log_{2} N) + (2N) + (5 N \\log_{2} N) = 10 N \\log_{2} N + 2N\n$$\n问题要求分别应用一次 $L$ 和 $L^T$ 的总浮点运算次数。由于 $L=L^T$，应用 $L^T$ 的成本是相同的，$C_{L^T} = C_L$。总成本为：\n$$\nC_{\\text{total}} = C_L + C_{L^T} = 2 \\times (10 N \\log_{2} N + 2N) = 20 N \\log_{2} N + 4N\n$$\n此表达式表示从给定成本模型推导出的总浮点运算次数的主导项。\n\n**辅助内存需求**\n问题要求峰值辅助内存，不包括输入和输出数组的存储。辅助内存包括用于预计算的谱振幅 $d_k$ 和复数工作缓冲区的存储。\n1.  **$d_k$ 的存储**：向量 $d = (d_0, \\ldots, d_{N-1})$ 包含 $N$ 个实数。所需内存为 $N$ 个实数浮点数。\n2.  **复数工作缓冲区**：该缓冲区是一个长度为 $N$ 的复数数组。每个复数需要存储一个实部和一个虚部。因此，该缓冲区需要存储 $N \\times 2 = 2N$ 个实数浮点数。\n\n所需的总辅助内存是这两部分之和：\n$$\nM_{\\text{aux}} = N + 2N = 3N\n$$\n内存以实数浮点数的单位计算。\n\n将总浮点运算次数和辅助内存的结果相结合，我们可以将最终答案表示为一个双元素行向量。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 20 N \\log_{2}(N) + 4N & 3N \\end{pmatrix}}\n$$"
        }
    ]
}