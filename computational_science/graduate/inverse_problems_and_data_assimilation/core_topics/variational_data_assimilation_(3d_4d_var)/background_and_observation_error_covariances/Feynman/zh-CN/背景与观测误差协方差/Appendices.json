{
    "hands_on_practices": [
        {
            "introduction": "构建一个实际的背景误差协方差矩阵 $B$ 是数据同化的基石。虽然简单的各向同性模型（其中相关性仅取决于距离）易于实现，但它们往往无法捕捉地球物理流体中普遍存在的方向依赖性。本练习将引导您根据第一性原理，结合主导流向等物理信息，构建一个更真实的各向异性协方差模型。通过此实践，您将掌握如何将物理直觉转化为数据同化系统所需的精确定量结构 。",
            "id": "3366407",
            "problem": "考虑一个二维数据同化情景，其中，一个标量地球物理场的背景误差由一个二阶平稳高斯随机场建模，其协方差依赖于空间分离，但表现出与给定流向一致的各向异性。建模的前提是，相关性随椭圆距离衰减，该椭圆距离的主轴沿局部流向和垂直于局部流向对齐，且具有不同的长度尺度。背景误差方差在空间上是恒定的。\n\n设给定的流向由 $(x,y)$ 平面中的非零向量 $\\boldsymbol{d} = (1,1)$ 给出，两个方向相关的相关长度尺度分别为沿流向 $L_{\\parallel} = 100$ $\\mathrm{km}$ 和垂直于流向 $L_{\\perp} = 30$ $\\mathrm{km}$。背景误差方差为 $\\sigma_{b}^{2} = 9$ $\\mathrm{K}^{2}$。考虑一个均匀的二维网格，其节点位置为 $\\boldsymbol{x}_{1} = (0 \\ \\mathrm{km}, 0 \\ \\mathrm{km})$ 和 $\\boldsymbol{x}_{2} = (60 \\ \\mathrm{km}, 40 \\ \\mathrm{km})$。\n\n从仅依赖于分离向量的二阶平稳高斯协方差的标准定义出发，通过旋转和缩放将协方差主轴与流向对齐来构造各向异性，建立与 $\\boldsymbol{d}$ 对齐的背景协方差模型，并推导 $\\boldsymbol{x}_{1}$ 和 $\\boldsymbol{x}_{2}$ 之间协方差项 $B_{12}$ 的显式闭式表达式。\n\n您的最终答案必须是只包含初等函数和常数的单个闭式解析表达式。协方差以 $\\mathrm{K}^{2}$ 表示。最终的方框答案中不要包含任何单位。",
            "solution": "## 问题验证\n\n### 步骤1：提取已知条件\n- **场类型**: 标量地球物理场\n- **误差模型**: 二阶平稳高斯随机场\n- **各向异性方向**: 与 $(x,y)$ 平面中的流向量 $\\boldsymbol{d} = (1,1)$ 对齐。\n- **相关长度尺度**:\n    - $L_{\\parallel} = 100 \\ \\mathrm{km}$ (沿流向)\n    - $L_{\\perp} = 30 \\ \\mathrm{km}$ (垂直于流向)\n- **背景误差方差**: $\\sigma_{b}^{2} = 9 \\ \\mathrm{K}^{2}$\n- **网格点位置**:\n    - $\\boldsymbol{x}_{1} = (0 \\ \\mathrm{km}, 0 \\ \\mathrm{km})$\n    - $\\boldsymbol{x}_{2} = (60 \\ \\mathrm{km}, 40 \\ \\mathrm{km})$\n- **任务**: 推导背景误差在 $\\boldsymbol{x}_{1}$ 和 $\\boldsymbol{x}_{2}$ 之间协方差项 $B_{12}$ 的显式闭式表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**: 该问题在数据同化和空间统计理论中有充分的依据。使用具有方向相关长度尺度的高斯场对各向异性背景误差协方差进行建模，是气象学、海洋学和其他地球科学中一种标准且广泛使用的技术（例如，在三维变分和四维变分系统中）。通过旋转和缩放构造各向异性是一种基本方法。\n2.  **适定性**: 该问题是适定的。所有必要的参数（$\\boldsymbol{d}$、$L_{\\parallel}$、$L_{\\perp}$、$\\sigma_{b}^{2}$）和位置（$\\boldsymbol{x}_{1}$、$\\boldsymbol{x}_{2}$）都已提供。模型结构（高斯、平稳）已明确定义。这种设置允许计算出协方差 $B_{12}$ 的一个唯一的、有意义的值。\n3.  **客观性**: 该问题以精确、客观的数学语言陈述。没有主观或模糊的术语。\n4.  **完整性与一致性**: 该问题是自洽的。给定的数据在量纲上是一致的（所有空间量纲均为 $\\mathrm{km}$，方差为 $\\mathrm{K}^{2}$）。没有矛盾之处。\n5.  **未检测到其他缺陷**: 该问题不违反任何其他无效性标准。它不是平凡的、隐喻性的，也不超出科学验证的范围。\n\n### 步骤3：结论与行动\n问题是 **有效的**。将提供完整解答。\n\n## 解答\n\n背景误差协方差矩阵 $\\mathbf{B}$ 的元素 $B_{ij}$ 表示位置 $\\boldsymbol{x}_i$ 和 $\\boldsymbol{x}_j$ 之间背景误差的协方差。对于二阶平稳场，该协方差可以表示为背景误差方差 $\\sigma_{b}^{2}$ 与一个仅依赖于分离向量 $\\boldsymbol{h} = \\boldsymbol{x}_j - \\boldsymbol{x}_i$ 的相关函数 $\\rho(\\boldsymbol{h})$ 的乘积。\n\n因此，在 $\\boldsymbol{x}_{1}$ 和 $\\boldsymbol{x}_{2}$ 处误差之间的协方差由下式给出：\n$$\nB_{12} = \\sigma_{b}^{2} \\rho(\\boldsymbol{x}_{2} - \\boldsymbol{x}_{1})\n$$\n问题指定了一个具有各向异性的高斯相关模型。相关函数的形式为：\n$$\n\\rho(\\boldsymbol{h}) = \\exp\\left(-\\frac{1}{2} D^2\\right)\n$$\n其中 $D^2$ 是一个平方“距离”度量，由相关长度尺度归一化。对于与特定轴对齐的各向异性相关，该度量是一个二次型。各向异性由流向向量 $\\boldsymbol{d} = (1,1)$ 定义。我们必须将分离向量 $\\boldsymbol{h}$ 分解为平行于和垂直于此流向的分量。\n\n首先，我们定义与流向对齐和垂直于流向的标准正交基向量。流向由 $\\boldsymbol{d} = (1,1)$ 给出。平行方向上的单位向量 $\\boldsymbol{u}_{\\parallel}$ 是：\n$$\n\\boldsymbol{u}_{\\parallel} = \\frac{\\boldsymbol{d}}{\\|\\boldsymbol{d}\\|} = \\frac{(1,1)}{\\sqrt{1^2 + 1^2}} = \\frac{1}{\\sqrt{2}}(1,1)\n$$\n与 $\\boldsymbol{d}$ 正交的一个向量是，例如 $(1,-1)$。垂直方向上对应的单位向量 $\\boldsymbol{u}_{\\perp}$ 是：\n$$\n\\boldsymbol{u}_{\\perp} = \\frac{1}{\\sqrt{2}}(1,-1)\n$$\n接下来，我们计算两个网格点 $\\boldsymbol{x}_{1} = (0, 0)$ 和 $\\boldsymbol{x}_{2} = (60, 40)$ 之间的分离向量 $\\boldsymbol{h}$：\n$$\n\\boldsymbol{h} = \\boldsymbol{x}_{2} - \\boldsymbol{x}_{1} = (60 - 0, 40 - 0) = (60, 40) \\ \\mathrm{km}\n$$\n现在，我们将分离向量 $\\boldsymbol{h}$ 投影到基向量 $\\boldsymbol{u}_{\\parallel}$ 和 $\\boldsymbol{u}_{\\perp}$ 上，以找到其在流向对齐坐标系中的分量。\n平行于流向的分量 $h_{\\parallel}$ 是 $\\boldsymbol{h}$ 在 $\\boldsymbol{u}_{\\parallel}$ 上的标量投影：\n$$\nh_{\\parallel} = \\boldsymbol{h} \\cdot \\boldsymbol{u}_{\\parallel} = (60, 40) \\cdot \\left(\\frac{1}{\\sqrt{2}}(1,1)\\right) = \\frac{1}{\\sqrt{2}}(60 \\times 1 + 40 \\times 1) = \\frac{100}{\\sqrt{2}} \\ \\mathrm{km}\n$$\n垂直于流向的分量 $h_{\\perp}$ 是 $\\boldsymbol{h}$ 在 $\\boldsymbol{u}_{\\perp}$ 上的标量投影：\n$$\nh_{\\perp} = \\boldsymbol{h} \\cdot \\boldsymbol{u}_{\\perp} = (60, 40) \\cdot \\left(\\frac{1}{\\sqrt{2}}(1,-1)\\right) = \\frac{1}{\\sqrt{2}}(60 \\times 1 + 40 \\times (-1)) = \\frac{20}{\\sqrt{2}} \\ \\mathrm{km}\n$$\n归一化的椭圆距离平方 $D^2$ 是使用这些分量及其各自的相关长度尺度 $L_{\\parallel} = 100 \\ \\mathrm{km}$ 和 $L_{\\perp} = 30 \\ \\mathrm{km}$ 构建的：\n$$\nD^2 = \\left(\\frac{h_{\\parallel}}{L_{\\parallel}}\\right)^2 + \\left(\\frac{h_{\\perp}}{L_{\\perp}}\\right)^2\n$$\n代入我们计算出的值：\n$$\nD^2 = \\left(\\frac{100/\\sqrt{2}}{100}\\right)^2 + \\left(\\frac{20/\\sqrt{2}}{30}\\right)^2 = \\left(\\frac{1}{\\sqrt{2}}\\right)^2 + \\left(\\frac{2}{3\\sqrt{2}}\\right)^2\n$$\n$$\nD^2 = \\frac{1}{2} + \\frac{4}{9 \\times 2} = \\frac{1}{2} + \\frac{2}{9}\n$$\n$$\nD^2 = \\frac{9}{18} + \\frac{4}{18} = \\frac{13}{18}\n$$\n现在我们可以计算相关性 $\\rho(\\boldsymbol{h})$：\n$$\n\\rho(\\boldsymbol{h}) = \\exp\\left(-\\frac{1}{2} D^2\\right) = \\exp\\left(-\\frac{1}{2} \\cdot \\frac{13}{18}\\right) = \\exp\\left(-\\frac{13}{36}\\right)\n$$\n最后，我们可以使用给定的背景误差方差 $\\sigma_{b}^{2} = 9 \\ \\mathrm{K}^{2}$ 来计算协方差项 $B_{12}$。\n$$\nB_{12} = \\sigma_{b}^{2} \\rho(\\boldsymbol{h}) = 9 \\exp\\left(-\\frac{13}{36}\\right)\n$$\n这就是两个指定点之间协方差的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{9 \\exp\\left(-\\frac{13}{36}\\right)}\n$$"
        },
        {
            "introduction": "与背景误差协方差 $B$ 描述状态变量之间的相关性类似，观测误差协方差 $R$ 描述了观测误差之间的相关性。在实践中，为了简便起见，研究人员常常假设 $R$ 是一个对角矩阵，即忽略观测误差之间的相关性。本练习通过一个分析推导，揭示了这种简化假设可能带来的严重后果，即错误地高估观测数据所提供的信息量 。这个练习将帮助您理解为什么准确地建模 $R$ 对于避免对观测的“过拟合”至关重要。",
            "id": "3366409",
            "problem": "考虑一个标量状态变量的线性高斯数据同化设置，其中状态 $x$ 的先验（背景）是均值为 $x_{b}$、方差为 $B=\\sigma_{b}^{2}$ 的高斯分布。两个独立的仪器使用线性观测算子 $H=\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 观测同一状态变量，得到观测模型 $y = H x + \\epsilon$。观测误差 $\\epsilon$ 是零均值高斯分布，其协方差为 $R$，其中真实的观测误差协方差为\n$$\nR_{\\text{true}} \\;=\\; \\sigma_{o}^{2}\\begin{pmatrix} 1 & \\rho \\\\ \\rho & 1 \\end{pmatrix},\n$$\n相关系数为 $\\rho \\in (-1,1)$。一个忽略观测误差相关的同化系统转而使用对角近似\n$$\nR_{\\text{diag}} \\;=\\; \\sigma_{o}^{2} I_{2}.\n$$\n令 Kalman 增益定义为 $K \\;=\\; B H^{\\top} \\left(H B H^{\\top} + R \\right)^{-1}$，并定义信号自由度（DFS）为 $\\mathrm{DFS} \\;=\\; \\mathrm{tr}\\!\\left(HK\\right)$。\n\n仅从这些定义以及线性高斯估计和线性代数的标准性质出发，推导在 $R_{\\text{true}}$ 和 $R_{\\text{diag}}$ 条件下的 DFS 的闭式表达式，然后计算乘性膨胀因子\n$$\n\\Phi(\\rho,\\sigma_{b}^{2},\\sigma_{o}^{2}) \\;=\\; \\frac{\\mathrm{DFS}(R_{\\text{diag}})}{\\mathrm{DFS}(R_{\\text{true}})}.\n$$\n请以 $\\rho$、$\\sigma_{b}^{2}$ 和 $\\sigma_{o}^{2}$ 的单个简化解析表达式的形式给出您的最终结果。不需要进行数值计算或四舍五入。",
            "solution": "该问题被验证为是自洽的，其科学基础在于数据同化和线性代数的原理，并且在数学上是适定的。参数定义清晰，目标是推导一个解析表达式，这是一个可行的任务。因此，我们可以开始求解。\n\n问题的核心是在两种不同的观测误差协方差矩阵 $R$ 的假设下，计算信号自由度（DFS）（定义为 $\\mathrm{DFS} = \\mathrm{tr}(HK)$），然后求出所得 DFS 值的比率。Kalman 增益 $K$ 由 $K = B H^{\\top} (H B H^{\\top} + R)^{-1}$ 给出。\n\n给定的量有：\n- 状态 $x$ 是一个标量。\n- 背景误差方差是一个标量 $B = \\sigma_{b}^{2}$。\n- 观测算子是 $H = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$，这是一个 $2 \\times 1$ 的矩阵。因此，其转置为 $H^{\\top} = \\begin{pmatrix} 1 & 1 \\end{pmatrix}$，一个 $1 \\times 2$ 的矩阵。\n\n首先，我们计算 Kalman 增益表达式中出现的项 $HBH^{\\top}$。\n$$\nHBH^{\\top} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} \\sigma_{b}^{2} \\begin{pmatrix} 1 & 1 \\end{pmatrix} = \\sigma_{b}^{2} \\begin{pmatrix} 1 \\cdot 1 & 1 \\cdot 1 \\\\ 1 \\cdot 1 & 1 \\cdot 1 \\end{pmatrix} = \\sigma_{b}^{2} \\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix}.\n$$\n这是一个 $2 \\times 2$ 的矩阵。\n\nDFS 可以使用迹的性质 $\\mathrm{tr}(AB) = \\mathrm{tr}(BA)$ 来计算。\n$$\n\\mathrm{DFS} = \\mathrm{tr}(HK) = \\mathrm{tr}(KH).\n$$\n由于状态是标量，$B$ 是一个 $1 \\times 1$ 的矩阵。增益 $K$ 的维度为 $(1 \\times 1) \\times (1 \\times 2) \\times ((2 \\times 1) \\times (1 \\times 1) \\times (1 \\times 2) + (2 \\times 2))^{-1}$，这导致 $K$ 是一个 $1 \\times 2$ 的矩阵。乘积 $KH$ 是一个 $(1 \\times 2) \\times (2 \\times 1) = 1 \\times 1$ 的矩阵。一个 $1 \\times 1$ 矩阵的迹就是其唯一的元素。因此，$\\mathrm{DFS} = KH$。让我们计算这个乘积：\n$$\n\\mathrm{DFS} = KH = \\left( B H^{\\top} (H B H^{\\top} + R)^{-1} \\right) H = B \\left( H^{\\top} (H B H^{\\top} + R)^{-1} H \\right).\n$$\n对于标量状态，这种形式在计算上很方便。\n\n我们现在将为两种指定的协方差矩阵计算 DFS。\n\n**1. 使用真实观测误差协方差 $R_{\\text{true}}$ 的 DFS**\n\n真实的协方差由 $R_{\\text{true}} = \\sigma_{o}^{2}\\begin{pmatrix} 1 & \\rho \\\\ \\rho & 1 \\end{pmatrix}$ 给出。我们定义待求逆的矩阵为 $M_{\\text{true}} = HBH^{\\top} + R_{\\text{true}}$。\n$$\nM_{\\text{true}} = \\sigma_{b}^{2} \\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix} + \\sigma_{o}^{2} \\begin{pmatrix} 1 & \\rho \\\\ \\rho & 1 \\end{pmatrix} = \\begin{pmatrix} \\sigma_{b}^{2} + \\sigma_{o}^{2} & \\sigma_{b}^{2} + \\rho\\sigma_{o}^{2} \\\\ \\sigma_{b}^{2} + \\rho\\sigma_{o}^{2} & \\sigma_{b}^{2} + \\sigma_{o}^{2} \\end{pmatrix}.\n$$\n为了求这个 $2 \\times 2$ 矩阵的逆，我们首先计算它的行列式。\n\\begin{align*}\n\\det(M_{\\text{true}}) &= (\\sigma_{b}^{2} + \\sigma_{o}^{2})^{2} - (\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2})^{2} \\\\\n&= \\left( (\\sigma_{b}^{2} + \\sigma_{o}^{2}) - (\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) \\right) \\left( (\\sigma_{b}^{2} + \\sigma_{o}^{2}) + (\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) \\right) \\\\\n&= (\\sigma_{o}^{2} - \\rho\\sigma_{o}^{2}) (2\\sigma_{b}^{2} + \\sigma_{o}^{2} + \\rho\\sigma_{o}^{2}) \\\\\n&= \\sigma_{o}^{2}(1-\\rho) (2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)).\n\\end{align*}\n那么逆矩阵是：\n$$\nM_{\\text{true}}^{-1} = \\frac{1}{\\det(M_{\\text{true}})} \\begin{pmatrix} \\sigma_{b}^{2} + \\sigma_{o}^{2} & -(\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) \\\\ -(\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) & \\sigma_{b}^{2} + \\sigma_{o}^{2} \\end{pmatrix}.\n$$\n现在我们计算标量 $H^{\\top} M_{\\text{true}}^{-1} H$。\n\\begin{align*}\nH^{\\top} M_{\\text{true}}^{-1} H &= \\begin{pmatrix} 1 & 1 \\end{pmatrix} \\left( \\frac{1}{\\det(M_{\\text{true}})} \\begin{pmatrix} \\sigma_{b}^{2} + \\sigma_{o}^{2} & -(\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) \\\\ -(\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) & \\sigma_{b}^{2} + \\sigma_{o}^{2} \\end{pmatrix} \\right) \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} \\\\\n&= \\frac{1}{\\det(M_{\\text{true}})} \\begin{pmatrix} 1 & 1 \\end{pmatrix} \\begin{pmatrix} (\\sigma_{b}^{2} + \\sigma_{o}^{2}) - (\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) \\\\ -(\\sigma_{b}^{2} + \\rho\\sigma_{o}^{2}) + (\\sigma_{b}^{2} + \\sigma_{o}^{2}) \\end{pmatrix} \\\\\n&= \\frac{1}{\\det(M_{\\text{true}})} \\begin{pmatrix} 1 & 1 \\end{pmatrix} \\begin{pmatrix} \\sigma_{o}^{2}(1-\\rho) \\\\ \\sigma_{o}^{2}(1-\\rho) \\end{pmatrix} \\\\\n&= \\frac{1}{\\det(M_{\\text{true}})} \\left( \\sigma_{o}^{2}(1-\\rho) + \\sigma_{o}^{2}(1-\\rho) \\right) = \\frac{2\\sigma_{o}^{2}(1-\\rho)}{\\det(M_{\\text{true}})}.\n\\end{align*}\n代入行列式的表达式：\n$$\nH^{\\top} (HBH^{\\top} + R_{\\text{true}})^{-1} H = \\frac{2\\sigma_{o}^{2}(1-\\rho)}{\\sigma_{o}^{2}(1-\\rho) (2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho))} = \\frac{2}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)}.\n$$\n最后，我们得到真实协方差下的 DFS：\n$$\n\\mathrm{DFS}(R_{\\text{true}}) = B \\left( H^{\\top} (HBH^{\\top} + R_{\\text{true}})^{-1} H \\right) = \\sigma_{b}^{2} \\cdot \\frac{2}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)} = \\frac{2\\sigma_{b}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)}.\n$$\n\n**2. 使用对角观测误差协方差 $R_{\\text{diag}}$ 的 DFS**\n\n对角近似为 $R_{\\text{diag}} = \\sigma_{o}^{2} I_{2} = \\sigma_{o}^{2}\\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$。这对应于 $R_{\\text{true}}$ 中相关系数 $\\rho=0$ 的特例。因此，我们可以通过在 $\\mathrm{DFS}(R_{\\text{true}})$ 的结果中设置 $\\rho=0$ 来获得 $\\mathrm{DFS}(R_{\\text{diag}})$ 的表达式。\n$$\n\\mathrm{DFS}(R_{\\text{diag}}) = \\frac{2\\sigma_{b}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+0)} = \\frac{2\\sigma_{b}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}}.\n$$\n\n**3. 计算乘性膨胀因子 $\\Phi$**\n\n膨胀因子 $\\Phi$ 定义为对角近似下的 DFS 与真实协方差下的 DFS 之比。\n$$\n\\Phi(\\rho,\\sigma_{b}^{2},\\sigma_{o}^{2}) = \\frac{\\mathrm{DFS}(R_{\\text{diag}})}{\\mathrm{DFS}(R_{\\text{true}})} = \\frac{\\frac{2\\sigma_{b}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}}}{\\frac{2\\sigma_{b}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)}}.\n$$\n分子中公有的项 $2\\sigma_{b}^{2}$ 被约去，我们剩下：\n$$\n\\Phi(\\rho,\\sigma_{b}^{2},\\sigma_{o}^{2}) = \\frac{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}}.\n$$\n这个表达式可以被简化以突出相关性的影响：\n$$\n\\Phi = \\frac{(2\\sigma_{b}^{2} + \\sigma_{o}^{2}) + \\rho\\sigma_{o}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}} = 1 + \\frac{\\rho\\sigma_{o}^{2}}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}}.\n$$\n问题要求一个单一的简化解析表达式，分数形式最为合适。\n$$\n\\Phi(\\rho,\\sigma_{b}^{2},\\sigma_{o}^{2}) = \\frac{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}}.\n$$\n这个最终表达式量化了忽略观测误差相关性如何膨胀了感知到的信号自由度。如果 $\\rho > 0$，那么 $\\Phi > 1$，表明高估了观测的信息含量。如果 $\\rho < 0$，那么 $\\Phi < 1$，表明低估了信息含量。",
            "answer": "$$ \\boxed{ \\frac{2\\sigma_{b}^{2} + \\sigma_{o}^{2}(1+\\rho)}{2\\sigma_{b}^{2} + \\sigma_{o}^{2}} } $$"
        },
        {
            "introduction": "在实际应用中，我们使用的背景误差协方差模型几乎总是真实情况的一种简化或近似。因此，一个核心的实践任务是“调整”这些模型参数，以在给定观测网络的情况下最大化分析的准确性。本练习模拟了这样一个真实世界中的场景：您需要通过数值实验来寻找一个（可能被错误设定的）$B$ 矩阵模型中的最优相关长度，以最小化预期的分析误差方差 。这个编码实践将加深您对模型误差、观测系统和分析质量之间复杂相互作用的理解。",
            "id": "3366397",
            "problem": "考虑一个由向量 $x \\in \\mathbb{R}^{N}$ 表示的一维空间状态，该状态是由时间白噪声、空间均匀高斯强迫驱动的线性平流-扩散随机偏微分方程 (SPDE) 的稳态。一个经过充分检验的推论是，稳态空间背景误差协方差具有指数核，因此真实的背景误差协方差矩阵 $B_{\\text{true}} \\in \\mathbb{R}^{N \\times N}$ 可以建模为 $[B_{\\text{true}}]_{ij} = \\sigma_{b}^{2} \\exp(-|s_{i} - s_{j}|/L_{\\text{true}})$，其中 $s_{1},\\dots,s_{N}$ 为网格点位置，$\\sigma_{b}^{2} > 0$ 为背景方差， $L_{\\text{true}} > 0$ 为真实相关长度。观测被建模为 $y = H x + e$，其中 $H \\in \\mathbb{R}^{m \\times N}$ 选择 $m$ 个点观测值，$e \\sim \\mathcal{N}(0, R)$ 且 $R = \\sigma_{o}^{2} I_{m}$，其中 $\\sigma_{o}^{2} > 0$。一位分析员使用一个错误指定的背景误差协方差 $B(L)$ 进行线性高斯分析，该协方差具有相同的参数形式，但使用一个可调的相关长度 $L$（以及相同的方差 $\\sigma_{b}^{2}$）：$[B(L)]_{ij} = \\sigma_{b}^{2} \\exp(-|s_{i} - s_{j}|/L)$。\n\n您的任务是，当分析使用从错误指定的 $B(L)$ 计算出的卡尔曼滤波器 (KF) 增益时，推导并实现期望分析误差方差。从线性高斯估计理论的基础出发，使用 $B(L)$ 和已知的 $R$ 通过卡尔曼滤波器计算出的分析为 $x_{a}(L) = K(L) y$，其中 $K(L) = B(L) H^{\\top} \\left(H B(L) H^{\\top} + R\\right)^{-1}$。实际分析误差为 $x - x_{a}(L)$，其中 $x \\sim \\mathcal{N}(0, B_{\\text{true}})$ 和 $e \\sim \\mathcal{N}(0, R)$ 是独立的。推导期望分析误差协方差 $\\Sigma_{a}(L) = \\mathbb{E}\\left[(x - x_{a}(L))(x - x_{a}(L))^{\\top}\\right]$ 和每个状态分量的期望后验方差 $J(L) = \\frac{1}{N} \\mathrm{tr}\\left(\\Sigma_{a}(L)\\right)$ 的表达式。然后，对于下面列出的每个测试用例，在一组指定的候选值网格上计算使 $J(L)$ 最小化的长度 $L$。\n\n您必须实现一个程序，该程序：\n- 分别使用指定的 $L_{\\text{true}}$ 和候选 $L$ 值，通过指数核构建 $B_{\\text{true}}$ 和 $B(L)$。\n- 将观测矩阵 $H$ 构建为与指定观测索引相对应的单位矩阵的行，并设置 $R = \\sigma_{o}^{2} I_{m}$。\n- 为每个候选 $L$ 计算 $K(L)$、$\\Sigma_{a}(L)$ 和 $J(L)$。\n- 选择使 $J(L)$ 最小化的 $L$，并返回最小化值 $L^{\\star}$ 和最小值 $J(L^{\\star})$。\n\n所有计算都是纯数学的；没有需要报告的物理单位。不涉及角度。最终输出必须是四舍五入到恰好六位小数的浮点数。\n\n测试套件：\n- 案例 A (正常路径，中等密度观测)：\n  - 网格：$N = 60$，$s_{i} = \\frac{i}{N-1}$，其中 $i = 0, \\dots, N-1$。\n  - 真实协方差参数：$\\sigma_{b}^{2} = 1.0$，$L_{\\text{true}} = 0.12$。\n  - 观测：索引 $0, 6, 12, \\dots, 54$ (每6个网格点一个)，因此 $m = 10$。\n  - 观测误差：$\\sigma_{o}^{2} = 0.04$ 且 $R = \\sigma_{o}^{2} I_{m}$。\n  - 候选相关长度：线性网格 $L \\in [0.02, 0.50]$，包含 $121$ 个等间距值 (包括端点)。\n- 案例 B (边界情况，单点观测)：\n  - 网格：$N = 60$，$s_{i} = \\frac{i}{N-1}$。\n  - 真实协方差参数：$\\sigma_{b}^{2} = 1.0$，$L_{\\text{true}} = 0.15$。\n  - 观测：单个索引 $30$ (中心点)，因此 $m = 1$。\n  - 观测误差：$\\sigma_{o}^{2} = 0.01$ 且 $R = \\sigma_{o}^{2} I_{1}$。\n  - 候选相关长度：线性网格 $L \\in [0.01, 0.60]$，包含 $120$ 个等间距值 (包括端点)。\n- 案例 C (边界倾向，带有中等噪声的非常密集的观测)：\n  - 网格：$N = 40$，$s_{i} = \\frac{i}{N-1}$。\n  - 真实协方差参数：$\\sigma_{b}^{2} = 1.0$，$L_{\\text{true}} = 0.05$。\n  - 观测：索引 $0, 1, 2, \\dots, 39$ (所有网格点)，因此 $m = 40$。\n  - 观测误差：$\\sigma_{o}^{2} = 0.5$ 且 $R = \\sigma_{o}^{2} I_{m}$。\n  - 候选相关长度：线性网格 $L \\in [0.01, 0.30]$，包含 $100$ 个等间距值 (包括端点)。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素都是一个双元素列表 $[L^{\\star}, J(L^{\\star})]$，对应于相应的测试用例。\n- 数值必须四舍五入到六位小数。\n- 例如，三个案例的输出必须如下所示：`[[0.123456,0.234567],[0.234567,0.345678],[0.345678,0.456789]]`。",
            "solution": "我们使用线性高斯估计来为一维稳态平流-扩散场建立问题模型。此类场的稳态背景误差协方差可以通过平稳指数核很好地建模，这是一个经典结果，与 Ornstein–Uhlenbeck 过程以及 Matérn 类协方差的高斯马尔可夫随机场表示相一致。因此，对于网格点 $s_{1}, \\dots, s_{N}$ 和真实相关长度 $L_{\\text{true}}$，我们取 $[B_{\\text{true}}]_{ij} = \\sigma_{b}^{2} \\exp(-|s_{i} - s_{j}|/L_{\\text{true}})$。分析使用一个具有相同形式但可调参数 $L$ 的错误指定的协方差，$[B(L)]_{ij} = \\sigma_{b}^{2} \\exp(-|s_{i} - s_{j}|/L)$。\n\n观测模型为 $y = H x + e$，其中 $H \\in \\mathbb{R}^{m \\times N}$ 选择 $m$ 个点观测值，且 $e \\sim \\mathcal{N}(0, R)$ 与 $x$ 独立。使用 $B(L)$ 作为背景误差协方差，通过卡尔曼滤波器 (KF) 计算出的分析为 $x_{a}(L) = K(L) y$，其中 KF 增益为\n$$\nK(L) = B(L) H^{\\top} \\left(H B(L) H^{\\top} + R\\right)^{-1}.\n$$\n这是通过最小化后验期望二次损失推导出的标准线性高斯贝叶斯估计器得出的。尽管该估计器对于 $B(L)$ 是线性最优的，但当 $B(L) \\neq B_{\\text{true}}$ 时，它通常是不匹配的。\n\n定义 $A(L) = I_{N} - K(L) H$。实际分析误差为 $x - x_{a}(L) = A(L) x - K(L) e$。对 $x$ 和 $e$ 的联合分布（独立，零均值）求期望，得出期望分析误差协方差\n$$\n\\Sigma_{a}(L) = \\mathbb{E}\\left[(x - x_{a}(L))(x - x_{a}(L))^{\\top}\\right]\n= A(L) B_{\\text{true}} A(L)^{\\top} + K(L) R K(L)^{\\top}.\n$$\n该表达式是利用协方差的双线性和 $x$ 与 $e$ 的独立性得到的，其中使用了 $\\mathbb{E}[x x^{\\top}] = B_{\\text{true}}$ 和 $\\mathbb{E}[e e^{\\top}] = R$ 以及交叉项 $\\mathbb{E}[x e^{\\top}] = 0$。\n\n每个状态分量的期望后验方差随后被定义为\n$$\nJ(L) = \\frac{1}{N} \\mathrm{tr}\\left(\\Sigma_{a}(L)\\right),\n$$\n它是所有状态分量上后验误差方差的平均值，并且是一个对网格排列保持不变的性能标量度量。\n\n$B(L)$ 中错误指定相关长度的影响：\n- 如果 $L$ 相对于 $L_{\\text{true}}$ 太小，那么 $B(L)$ 近似为对角矩阵，导致增益 $K(L)$ 局域化。分析倾向于使来自点观测的信息传播不足，从而在远离观测位置的地方留下较大的后验方差。\n- 如果 $L$ 相对于 $L_{\\text{true}}$ 太大，那么 $B(L)$ 会强加很强的长程相干性，增益 $K(L)$ 会过度传播观测的影响，可能将观测噪声广泛地注入，并降低对真实场的局部保真度，这也会增加 $J(L)$。\n- 因此，存在一种权衡，它会导出一个最优的 $L^{\\star}$，在信息传播和噪声注入之间取得平衡，以最小化 $J(L)$。\n\n计算 $J(L)$ 和寻找 $L^{\\star}$ 的算法设计：\n1. 构建网格坐标 $s_{i} = \\frac{i}{N-1}$，其中 $i = 0, \\dots, N-1$。\n2. 构建 $B_{\\text{true}} \\in \\mathbb{R}^{N \\times N}$，其元素为 $[B_{\\text{true}}]_{ij} = \\sigma_{b}^{2} \\exp(-|s_{i} - s_{j}|/L_{\\text{true}})$。\n3. 通过选择指定的索引来构建观测矩阵 $H \\in \\mathbb{R}^{m \\times N}$；$H$ 由与观测到的网格点相对应的单位矩阵的行组成。设置 $R = \\sigma_{o}^{2} I_{m}$。\n4. 对于测试用例指定范围内的每个候选 $L$：\n   - 构建 $B(L)$，其元素为 $[B(L)]_{ij} = \\sigma_{b}^{2} \\exp(-|s_{i} - s_{j}|/L)$。\n   - 计算 $S(L) = H B(L) H^{\\top} + R$ 并求解以 $S(L)$ 为系数的线性系统（避免显式求逆）：\n     $$\n     K(L) = B(L) H^{\\top} \\left(S(L)\\right)^{-1}.\n     $$\n     在计算上，通过线性求解来计算 $K(L)^{\\top} = \\left(S(L)\\right)^{-1} \\left(H B(L)\\right)$。\n   - 形成 $A(L) = I_{N} - K(L) H$。\n   - 计算 $\\Sigma_{a}(L) = A(L) B_{\\text{true}} A(L)^{\\top} + K(L) R K(L)^{\\top}$ 和 $J(L) = \\frac{1}{N} \\mathrm{tr}\\left(\\Sigma_{a}(L)\\right)$。\n5. 在候选集中选择使 $J(L)$ 最小化的 $L^{\\star}$，并报告 $[L^{\\star}, J(L^{\\star})]$。\n\n测试套件的数值规格确保覆盖以下情况：\n- 一个具有中等密度观测的典型案例 (案例 A)。\n- 一个由单个观测引入高度局域化信息的边界情况 (案例 B)。\n- 一个具有非常密集观测的边界倾向案例，其中观测噪声和模型平滑度相互作用 (案例 C)。\n\n所需程序实现上述计算，并打印单行输出，其中包含一个由三个双元素列表组成的列表，每个测试用例对应一个列表，所有数字都四舍五入到六位小数，并严格按照 $[[L^{\\star},J(L^{\\star})],\\dots]$ 的格式。",
            "answer": "```python\nimport numpy as np\n\ndef exponential_covariance_matrix(s, sigma_b2, L):\n    # Build covariance matrix with entries sigma_b2 * exp(-|si - sj| / L)\n    N = s.size\n    # Use broadcasting for efficiency\n    dists = np.abs(s.reshape(-1, 1) - s.reshape(1, -1))\n    return sigma_b2 * np.exp(-dists / L)\n\ndef build_observation_matrix(N, obs_indices):\n    m = len(obs_indices)\n    H = np.zeros((m, N), dtype=float)\n    for r, c in enumerate(obs_indices):\n        H[r, c] = 1.0\n    return H\n\ndef compute_J_for_L(B_true, H, R, B_assumed):\n    N = B_true.shape[0]\n    I_N = np.eye(N, dtype=float)\n    # Compute S = H B_assumed H^T + R\n    HB = H @ B_assumed  # shape (m, N)\n    S = HB @ H.T + R    # shape (m, m)\n    # Solve for K^T: S * X = HB  => X = S^{-1} HB\n    # K^T has shape (m, N); K has shape (N, m)\n    # Use solve for numerical stability\n    K_T = np.linalg.solve(S, HB)\n    K = K_T.T\n    # A = I - K H\n    A = I_N - K @ H\n    # Sigma_a = A B_true A^T + K R K^T\n    Sigma_a = A @ B_true @ A.T + K @ R @ K.T\n    # J(L) = (1/N) * trace(Sigma_a)\n    J = float(np.trace(Sigma_a) / N)\n    return J\n\ndef grid_search_optimal_L(N, s, obs_indices, sigma_b2, L_true, sigma_o2, L_min, L_max, n_candidates):\n    # Precompute true covariance and observation structures\n    B_true = exponential_covariance_matrix(s, sigma_b2, L_true)\n    H = build_observation_matrix(N, obs_indices)\n    m = len(obs_indices)\n    R = sigma_o2 * np.eye(m, dtype=float)\n\n    # Candidate L values (inclusive grid)\n    L_values = np.linspace(L_min, L_max, n_candidates)\n    best_L = None\n    best_J = np.inf\n\n    for L in L_values:\n        B_assumed = exponential_covariance_matrix(s, sigma_b2, L)\n        J = compute_J_for_L(B_true, H, R, B_assumed)\n        if J  best_J:\n            best_J = J\n            best_L = float(L)\n\n    return best_L, float(best_J)\n\ndef format_number(x):\n    # Format float with exactly six decimal places\n    return f\"{x:.6f}\"\n\ndef format_result_list(results):\n    # results is a list of [L_star, J_star]; return a string like [[a,b],[c,d],...]\n    inner = []\n    for pair in results:\n        a, b = pair\n        inner.append(f\"[{format_number(a)},{format_number(b)}]\")\n    return f\"[{','.join(inner)}]\"\n\ndef solve():\n    results = []\n\n    # Case A\n    N_A = 60\n    s_A = np.linspace(0.0, 1.0, N_A)\n    sigma_b2_A = 1.0\n    L_true_A = 0.12\n    obs_indices_A = list(range(0, N_A, 6))  # every 6th grid point\n    sigma_o2_A = 0.04\n    L_min_A, L_max_A, n_candidates_A = 0.02, 0.50, 121\n    L_star_A, J_star_A = grid_search_optimal_L(\n        N_A, s_A, obs_indices_A, sigma_b2_A, L_true_A, sigma_o2_A, L_min_A, L_max_A, n_candidates_A\n    )\n    results.append([L_star_A, J_star_A])\n\n    # Case B\n    N_B = 60\n    s_B = np.linspace(0.0, 1.0, N_B)\n    sigma_b2_B = 1.0\n    L_true_B = 0.15\n    obs_indices_B = [30]  # single central observation\n    sigma_o2_B = 0.01\n    L_min_B, L_max_B, n_candidates_B = 0.01, 0.60, 120\n    L_star_B, J_star_B = grid_search_optimal_L(\n        N_B, s_B, obs_indices_B, sigma_b2_B, L_true_B, sigma_o2_B, L_min_B, L_max_B, n_candidates_B\n    )\n    results.append([L_star_B, J_star_B])\n\n    # Case C\n    N_C = 40\n    s_C = np.linspace(0.0, 1.0, N_C)\n    sigma_b2_C = 1.0\n    L_true_C = 0.05\n    obs_indices_C = list(range(N_C))  # all grid points observed\n    sigma_o2_C = 0.5\n    L_min_C, L_max_C, n_candidates_C = 0.01, 0.30, 100\n    L_star_C, J_star_C = grid_search_optimal_L(\n        N_C, s_C, obs_indices_C, sigma_b2_C, L_true_C, sigma_o2_C, L_min_C, L_max_C, n_candidates_C\n    )\n    results.append([L_star_C, J_star_C])\n\n    print(format_result_list(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}