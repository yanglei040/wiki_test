{
    "hands_on_practices": [
        {
            "introduction": "构建吉布斯采样器的第一步是推导每个未知参数的全条件分布。本练习将通过一个经典的分层高斯模型，指导您为中心化和非中心化两种参数化方案推导这些分布。掌握此项技能至关重要，因为它不仅是实现吉布斯采样的基础，而且还能让您深入理解不同参数化策略如何影响采样效率 。",
            "id": "3386530",
            "problem": "考虑一个数据同化场景，其中有一个由 $n$ 个传感器组成的网络，用于测量一个潜在的校准偏移场。设观测数据为 $y_{i} \\in \\mathbb{R}$（$i=1,\\dots,n$），并考虑以下分层随机效应逆模型：\n- 观测（似然）：$y_{i} \\mid x_{i} \\sim \\mathcal{N}(x_{i}, \\sigma^{2})$，对于 $i=1,\\dots,n$ 独立。\n- 随机效应（状态模型）：$x_{i} \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^{2})$，对于 $i=1,\\dots,n$ 独立。\n- 超先验：$\\mu \\sim \\mathcal{N}(0, \\kappa^{2})$。\n\n假设 $\\sigma^{2} > 0$, $\\tau^{2} > 0$, 和 $\\kappa^{2} > 0$ 均为已知。对于吉布斯采样（Gibbs sampling），一种马尔可夫链蒙特卡洛（MCMC）方法，我们关注两种等价的参数化方法：\n\n1) 中心化参数化：直接对潜在效应 $x_{1},\\dots,x_{n}$ 和超参数 $\\mu$ 进行采样。\n\n2) 非中心化参数化：重参数化为 $x_{i} = \\mu + \\tau z_{i}$，其中 $z_{i} \\sim \\mathcal{N}(0,1)$ 独立同分布，然后对 $z_{1},\\dots,z_{n}$ 和 $\\mu$ 进行采样。\n\n任务：\n1) 从该模型所蕴含的联合密度出发，仅使用高斯分布的基本性质和共轭性，推导中心化参数化的全条件分布：对每个 $i$ 的 $x_{i} \\mid \\mu, y_{i}$，以及 $\\mu \\mid x_{1:n}, y_{1:n}$。\n\n2) 推导非中心化参数化的全条件分布：对每个 $i$ 的 $z_{i} \\mid \\mu, y_{i}$，以及 $\\mu \\mid z_{1:n}, y_{1:n}$。\n\n3) 通过解析地边缘化潜在效应 $x_{1:n}$，推导观测模型 $y_{i} \\mid \\mu$，并用它来获得后验分布 $\\mu \\mid y_{1:n}$。请用 $\\{y_{i}\\}_{i=1}^{n}$、$\\sigma^{2}$、$\\tau^{2}$、$\\kappa^{2}$ 和 $n$ 来表示后验均值 $\\mathbb{E}[\\mu \\mid y_{1:n}]$，并提供一个单一的闭式解析表达式作为最终答案。不要代入数值；不需要四舍五入。最终答案必须是单个解析表达式。",
            "solution": "该问题提出了一个标准的贝叶斯分层模型，并要求推导与吉布斯采样相关的几个条件分布和后验分布，以及一个边缘后验均值的推导。该模型具有科学依据，是良定的，并且所有必要信息都已提供。因此，该问题是有效的，可以推导出解。\n\n分层模型定义如下：\n- 观测模型（似然）：$y_{i} \\mid x_{i} \\sim \\mathcal{N}(x_{i}, \\sigma^{2})$，对于 $i=1,\\dots,n$。\n- 状态模型：$x_{i} \\mid \\mu \\sim \\mathcal{N}(\\mu, \\tau^{2})$，对于 $i=1,\\dots,n$。\n- 超先验：$\\mu \\sim \\mathcal{N}(0, \\kappa^{2})$。\n方差 $\\sigma^{2}$、$\\tau^{2}$ 和 $\\kappa^{2}$ 是已知常数。\n\n正态分布 $\\mathcal{N}(m, s^2)$ 的概率密度函数 (PDF) 为 $p(x) = (2\\pi s^2)^{-1/2} \\exp(-\\frac{(x-m)^2}{2s^2})$。在涉及高斯分布乘积的推导中，通常只需处理指数中的项，因为它们唯一地确定了所得到的高斯分布的均值和方差。如果 $\\ln p(z)$ 是 $z$ 的二次函数，则密度 $p(z)$ 是高斯分布。具体来说，如果 $p(z) \\propto \\exp(-\\frac{1}{2}(Az^2 - 2Bz))$，那么 $z$ 服从正态分布，其均值为 $B/A$，方差为 $1/A$。这等价于配方法。\n\n**1) 中心化参数化的全条件分布**\n\n**推导 $p(x_{i} \\mid \\mu, y_{i})$：**\n$x_i$ 的全条件分布由其与马尔可夫毯（在此模型中为 $y_i$ 和 $\\mu$）的关系确定。根据贝叶斯定理，该条件分布与似然函数和 $x_i$ 的先验的乘积成正比：\n$$p(x_{i} \\mid \\mu, y_{i}) \\propto p(y_i, x_i, \\mu) \\propto p(y_{i} \\mid x_{i}) p(x_{i} \\mid \\mu)$$\n这里，我们有 $p(y_{i} \\mid x_{i}) \\propto \\exp\\left(-\\frac{(y_i - x_i)^2}{2\\sigma^2}\\right)$ 和 $p(x_{i} \\mid \\mu) \\propto \\exp\\left(-\\frac{(x_i - \\mu)^2}{2\\tau^2}\\right)$。\n其乘积与各指数项之和的指数成正比：\n$$p(x_{i} \\mid \\mu, y_{i}) \\propto \\exp\\left( -\\frac{(x_i - y_i)^2}{2\\sigma^2} - \\frac{(x_i - \\mu)^2}{2\\tau^2} \\right)$$\n为了找到得到的高斯分布的参数，我们展开指数中关于 $x_i$ 的二次项：\n$$-\\frac{1}{2\\sigma^2}(x_i^2 - 2x_iy_i + y_i^2) - \\frac{1}{2\\tau^2}(x_i^2 - 2x_i\\mu + \\mu^2)$$\n合并包含 $x_i^2$ 和 $x_i$ 的项：\n$$-\\frac{1}{2} \\left[ x_i^2 \\left(\\frac{1}{\\sigma^2} + \\frac{1}{\\tau^2}\\right) - 2x_i \\left(\\frac{y_i}{\\sigma^2} + \\frac{\\mu}{\\tau^2}\\right) \\right] + C$$\n其中 $C$ 包含不依赖于 $x_i$ 的项。这是 $x_i$ 的正态分布的指数部分。精度（方差的倒数）是 $x_i^2/2$ 的系数，均值是 $x_i$ 的系数除以精度。\n精度为 $\\frac{1}{\\sigma_{x_i}^2} = \\frac{1}{\\sigma^2} + \\frac{1}{\\tau^2} = \\frac{\\sigma^2+\\tau^2}{\\sigma^2\\tau^2}$。因此，方差为 $\\sigma_{x_i}^2 = \\frac{\\sigma^2\\tau^2}{\\sigma^2+\\tau^2}$。\n均值 $\\mu_{x_i}$ 由 $\\mu_{x_i} / \\sigma_{x_i}^2 = \\frac{y_i}{\\sigma^2} + \\frac{\\mu}{\\tau^2}$ 给出。\n$$\\mu_{x_i} = \\left(\\frac{\\sigma^2\\tau^2}{\\sigma^2+\\tau^2}\\right)\\left(\\frac{y_i}{\\sigma^2} + \\frac{\\mu}{\\tau^2}\\right) = \\frac{\\tau^2y_i + \\sigma^2\\mu}{\\sigma^2+\\tau^2}$$\n所以，全条件分布为 $x_{i} \\mid \\mu, y_{i} \\sim \\mathcal{N}\\left(\\frac{y_i\\tau^2 + \\mu\\sigma^2}{\\sigma^2+\\tau^2}, \\frac{\\sigma^2\\tau^2}{\\sigma^2+\\tau^2}\\right)$。\n\n**推导 $p(\\mu \\mid x_{1:n}, y_{1:n})$：**\n给定潜在效应 $x_{1:n}$，$\\mu$ 条件独立于观测值 $y_{1:n}$。因此，$p(\\mu \\mid x_{1:n}, y_{1:n}) = p(\\mu \\mid x_{1:n})$。\n$$p(\\mu \\mid x_{1:n}) \\propto p(x_{1:n} \\mid \\mu) p(\\mu) = \\left(\\prod_{i=1}^n p(x_i \\mid \\mu)\\right) p(\\mu)$$\n指数部分是各个PDF指数项的和：\n$$\\sum_{i=1}^n \\left(-\\frac{(x_i - \\mu)^2}{2\\tau^2}\\right) - \\frac{(\\mu - 0)^2}{2\\kappa^2} = -\\frac{1}{2\\tau^2}\\sum_{i=1}^n(x_i - \\mu)^2 - \\frac{\\mu^2}{2\\kappa^2}$$\n展开关于 $\\mu$ 的二次项：\n$$-\\frac{1}{2\\tau^2}(\\sum x_i^2 - 2\\mu\\sum x_i + n\\mu^2) - \\frac{\\mu^2}{2\\kappa^2}$$\n合并包含 $\\mu^2$ 和 $\\mu$ 的项：\n$$-\\frac{1}{2} \\left[ \\mu^2 \\left(\\frac{n}{\\tau^2} + \\frac{1}{\\kappa^2}\\right) - 2\\mu \\left(\\frac{\\sum_{i=1}^n x_i}{\\tau^2}\\right) \\right] + C'$$\n$\\mu$ 的后验精度为 $\\frac{1}{\\sigma_{\\mu}^2} = \\frac{n}{\\tau^2} + \\frac{1}{\\kappa^2} = \\frac{n\\kappa^2+\\tau^2}{\\tau^2\\kappa^2}$。方差为 $\\sigma_{\\mu}^2 = \\frac{\\tau^2\\kappa^2}{n\\kappa^2+\\tau^2}$。\n后验均值 $\\mu_{\\mu}$ 由 $\\mu_{\\mu} / \\sigma_{\\mu}^2 = \\frac{\\sum x_i}{\\tau^2}$ 给出。\n$$\\mu_{\\mu} = \\left(\\frac{\\tau^2\\kappa^2}{n\\kappa^2+\\tau^2}\\right) \\left(\\frac{\\sum x_i}{\\tau^2}\\right) = \\frac{\\kappa^2 \\sum_{i=1}^n x_i}{n\\kappa^2+\\tau^2}$$\n所以，全条件分布为 $\\mu \\mid x_{1:n} \\sim \\mathcal{N}\\left(\\frac{\\kappa^2 \\sum_{i=1}^n x_i}{n\\kappa^2+\\tau^2}, \\frac{\\tau^2\\kappa^2}{n\\kappa^2+\\tau^2}\\right)$。\n\n**2) 非中心化参数化的全条件分布**\n\n这里，我们有 $x_i = \\mu + \\tau z_i$，其中 $z_i \\sim \\mathcal{N}(0, 1)$。似然函数变为 $y_i \\mid \\mu, z_i \\sim \\mathcal{N}(\\mu + \\tau z_i, \\sigma^2)$。\n\n**推导 $p(z_{i} \\mid \\mu, y_{i})$：**\n$z_i$ 的条件分布取决于 $y_i$ 和 $\\mu$。\n$$p(z_i \\mid \\mu, y_i) \\propto p(y_i \\mid z_i, \\mu) p(z_i)$$\n指数部分是 $-\\frac{(y_i - (\\mu + \\tau z_i))^2}{2\\sigma^2} - \\frac{z_i^2}{2(1)^2}$。展开关于 $z_i$ 的二次项：\n$$-\\frac{1}{2\\sigma^2}((y_i-\\mu)^2 - 2\\tau z_i(y_i-\\mu) + \\tau^2 z_i^2) - \\frac{z_i^2}{2}$$\n合并包含 $z_i^2$ 和 $z_i$ 的项：\n$$-\\frac{1}{2} \\left[ z_i^2 \\left(\\frac{\\tau^2}{\\sigma^2} + 1\\right) - 2z_i \\left(\\frac{\\tau(y_i-\\mu)}{\\sigma^2}\\right) \\right] + C''$$\n$z_i$ 的后验精度为 $\\frac{1}{\\sigma_{z_i}^2} = \\frac{\\tau^2}{\\sigma^2} + 1 = \\frac{\\tau^2+\\sigma^2}{\\sigma^2}$。方差为 $\\sigma_{z_i}^2 = \\frac{\\sigma^2}{\\sigma^2+\\tau^2}$。\n后验均值 $\\mu_{z_i}$ 由 $\\mu_{z_i} / \\sigma_{z_i}^2 = \\frac{\\tau(y_i-\\mu)}{\\sigma^2}$ 给出。\n$$\\mu_{z_i} = \\left(\\frac{\\sigma^2}{\\sigma^2+\\tau^2}\\right) \\left(\\frac{\\tau(y_i-\\mu)}{\\sigma^2}\\right) = \\frac{\\tau(y_i - \\mu)}{\\sigma^2+\\tau^2}$$\n所以，$z_i \\mid \\mu, y_i \\sim \\mathcal{N}\\left(\\frac{\\tau(y_i - \\mu)}{\\sigma^2+\\tau^2}, \\frac{\\sigma^2}{\\sigma^2+\\tau^2}\\right)$。\n\n**推导 $p(\\mu \\mid z_{1:n}, y_{1:n})$：**\n$\\mu$ 的条件分布通过 $p(\\mu \\mid z_{1:n}, y_{1:n}) \\propto p(y_{1:n} \\mid \\mu, z_{1:n}) p(\\mu)$ 找到。\n似然项为 $p(y_{1:n} \\mid \\mu, z_{1:n}) = \\prod_{i=1}^n p(y_i \\mid \\mu, z_i)$。我们定义 $w_i = y_i - \\tau z_i$。那么 $y_i - \\mu - \\tau z_i = w_i - \\mu$。单个观测的似然为 $p(y_i \\mid \\mu, z_i) \\propto \\exp(-\\frac{(w_i - \\mu)^2}{2\\sigma^2})$。这意味着我们观测到 $w_i \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n现在的推断问题是，在给定来自 $\\mathcal{N}(\\mu, \\sigma^2)$ 分布的观测值 $w_{1:n}$ 和 $\\mu$ 的 $\\mathcal{N}(0, \\kappa^2)$ 先验的情况下，求 $\\mu$ 的后验分布。这在结构上与 $p(\\mu \\mid x_{1:n})$ 的推导相同，只是用 $w_i$ 替换了 $x_i$，用 $\\sigma^2$ 替换了 $\\tau^2$。\n遵循相同的逻辑，$\\mu$ 的后验是一个正态分布，其均值和方差为：\n$$\\mu_{\\mu|z,y} = \\frac{\\kappa^2 \\sum_{i=1}^n w_i}{n\\kappa^2+\\sigma^2} = \\frac{\\kappa^2 \\sum_{i=1}^n (y_i - \\tau z_i)}{n\\kappa^2+\\sigma^2}$$\n$$\\sigma_{\\mu|z,y}^2 = \\frac{\\sigma^2\\kappa^2}{n\\kappa^2+\\sigma^2}$$\n因此，$\\mu \\mid z_{1:n}, y_{1:n} \\sim \\mathcal{N}\\left(\\frac{\\kappa^2 \\sum_{i=1}^n (y_i - \\tau z_i)}{n\\kappa^2+\\sigma^2}, \\frac{\\sigma^2\\kappa^2}{n\\kappa^2+\\sigma^2}\\right)$。\n\n**3) $\\mu$ 的边缘后验分布**\n\n首先，我们通过对 $x_i$ 积分来求出给定 $\\mu$ 的 $y_i$ 的边缘分布：\n$$p(y_i \\mid \\mu) = \\int p(y_i \\mid x_i) p(x_i \\mid \\mu) dx_i$$\n这是两个高斯分布的卷积。令 $x_i = \\mu + \\delta_i$ 其中 $\\delta_i \\sim \\mathcal{N}(0, \\tau^2)$，以及 $y_i = x_i + \\epsilon_i$ 其中 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。那么 $y_i = \\mu + \\delta_i + \\epsilon_i$。\n给定 $\\mu$ 的 $y_i$ 的均值为 $\\mathbb{E}[y_i \\mid \\mu] = \\mathbb{E}[\\mu + \\delta_i + \\epsilon_i] = \\mu + 0 + 0 = \\mu$。\n给定 $\\mu$ 的 $y_i$ 的方差，由于 $\\delta_i$ 和 $\\epsilon_i$ 是独立的，所以是 $\\text{Var}(y_i \\mid \\mu) = \\text{Var}(\\delta_i) + \\text{Var}(\\epsilon_i) = \\tau^2 + \\sigma^2$。\n因此，边缘观测模型是 $y_i \\mid \\mu \\sim \\mathcal{N}(\\mu, \\sigma^2 + \\tau^2)$。\n\n现在，我们使用这个边缘似然来推导后验分布 $p(\\mu \\mid y_{1:n})$。\n$$p(\\mu \\mid y_{1:n}) \\propto p(y_{1:n} \\mid \\mu) p(\\mu) = \\left(\\prod_{i=1}^n p(y_i \\mid \\mu)\\right) p(\\mu)$$\n给定 $\\mu$，观测值 $y_i$ 是独立的。我们有一个来自 $\\mathcal{N}(\\mu, \\sigma^2+\\tau^2)$ 的样本 $y_{1:n}$ 和一个先验 $\\mu \\sim \\mathcal{N}(0, \\kappa^2)$。这又是一个标准的共轭先验更新。该问题与 $p(\\mu \\mid x_{1:n})$ 的推导同构，只需将 $x_i$ 替换为 $y_i$，将 $\\tau^2$ 替换为 $\\sigma^2+\\tau^2$。\n后验分布 $p(\\mu \\mid y_{1:n})$ 是一个正态分布。其均值为 $\\mathbb{E}[\\mu \\mid y_{1:n}]$。使用第1部分推导的公式：\n$$\\mathbb{E}[\\mu \\mid y_{1:n}] = \\frac{\\kappa^2 \\sum_{i=1}^n y_i}{n\\kappa^2 + (\\sigma^2 + \\tau^2)}$$\n这就是后验均值的最终表达式。它可以改写为：\n$$\\mathbb{E}[\\mu \\mid y_{1:n}] = \\frac{n\\kappa^2}{n\\kappa^2 + \\sigma^2 + \\tau^2} \\left(\\frac{1}{n} \\sum_{i=1}^n y_i\\right) + \\frac{\\sigma^2 + \\tau^2}{n\\kappa^2 + \\sigma^2 + \\tau^2} (0)$$\n这表明它是样本均值 $\\bar{y}$ 和先验均值 $0$ 的加权平均值。\n\n最终答案要求是后验均值 $\\mathbb{E}[\\mu \\mid y_{1:n}]$ 的单个闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{\\kappa^2 \\sum_{i=1}^{n} y_i}{n\\kappa^2 + \\sigma^2 + \\tau^2}}\n$$"
        },
        {
            "introduction": "在许多实际应用中，参数的全条件分布并非易于采样的标准形式。在这种情况下，“吉布斯内部梅特罗波利斯”（Metropolis-within-Gibbs）策略提供了一个强大的解决方案。本练习要求您从详细平衡（detailed balance）条件出发，推导该混合算法中梅特罗波利斯步骤的接受概率 。",
            "id": "3386603",
            "problem": "考虑一个数据同化中的贝叶斯逆问题，其中未知的状态向量 $x \\in \\mathbb{R}^{d}$ 是根据观测值 $y \\in \\mathbb{R}^{m}$ 推断出来的。设先验密度为 $p(x)$，似然为 $L(y \\mid x)$，两者在其支撑集上均为严格正值。根据贝叶斯定理，后验密度定义为 $ \\pi(x \\mid y) \\propto L(y \\mid x)\\,p(x) $。你的任务是通过一种逐分量的马尔可夫链蒙特卡洛 (MCMC) 方法从 $ \\pi(x \\mid y) $ 中进行采样。\n\n假设你打算在给定 $x_{-i}$（即从向量 $x$ 中移除第 $i$ 个分量后得到的向量）的情况下，对坐标 $x_{i}$ 进行 Gibbs 更新，但其全条件密度 $ \\pi(x_{i} \\mid x_{-i}, y) $ 不具有易于处理的形式。作为替代，你设计了一个 Gibbs 内部 Metropolis (MwG) 步骤，该步骤从一个提议密度 $ q(x_{i}' \\mid x_{-i}) $ 中提议一个新的值 $x_{i}'$（该提议密度在 $ \\pi(x \\mid y) $ 为正的所有区域上都有支撑），并保持 $x_{-i}$ 不变。\n\n请仅使用 Metropolis-Hastings (MH) 方法的核心定义（即作为一个对目标分布强制施加细致平衡条件的马尔可夫核）以及后验分布的定义 $ \\pi(x \\mid y) \\propto L(y \\mid x)\\,p(x) $，来推导此 MwG 移动的接受概率 $ \\alpha_{i}(x_{i} \\to x_{i}' ; x_{-i}) $。你的推导必须明确使用针对保持 $x_{-i}$ 固定的单坐标提议的细致平衡条件。请用 $ L(y \\mid x) $、$ p(x) $ 和 $ q(x_{i}' \\mid x_{-i}) $ 将你的最终答案表示为单个闭式解析表达式。\n\n提供接受概率的最终表达式。最终答案必须是单个闭式解析表达式。不要在最终答案中提供步骤。",
            "solution": "该问题要求推导 Gibbs 内部 Metropolis (MwG) 步骤的接受概率。该推导必须基于细致平衡原理，这是 Metropolis-Hastings (MH) 算法的基石。\n\n设目标分布为后验密度 $\\pi(x \\mid y)$，其中 $x \\in \\mathbb{R}^{d}$ 是状态向量，$y \\in \\mathbb{R}^{m}$ 是观测值。对于任意两个状态 $x$ 和 $x'$，如果一个马尔可夫链转移核 $K(x' \\mid x)$ 满足关于 $\\pi(x \\mid y)$ 的细致平衡条件，则：\n$$ \\pi(x \\mid y) K(x' \\mid x) = \\pi(x' \\mid y) K(x \\mid x') $$\nMH 算法构造了这样一个核。从状态 $x$ 到新状态 $x'$ 的转移是一个两步过程：\n$1$. 从一个提议分布 $Q(x' \\mid x)$ 中生成一个候选状态 $x'$。\n$2$. 以概率 $\\alpha(x \\to x')$ 接受该候选状态 $x'$。如果被拒绝，则马尔可夫链保持在状态 $x$。\n\n对于 $x' \\neq x$ 的转移，转移核由 $K(x' \\mid x) = Q(x' \\mid x) \\alpha(x \\to x')$ 给出。将此代入细致平衡方程可得：\n$$ \\pi(x \\mid y) Q(x' \\mid x) \\alpha(x \\to x') = \\pi(x' \\mid y) Q(x \\mid x') \\alpha(x' \\to x) $$\n满足此关系的接受概率的标准选择是 Metropolis-Hastings 接受概率：\n$$ \\alpha(x \\to x') = \\min \\left( 1, \\frac{\\pi(x' \\mid y) Q(x \\mid x')}{\\pi(x \\mid y) Q(x' \\mid x)} \\right) $$\n\n在给定问题的背景下，我们不是一次性更新整个向量 $x$，而是对单个坐标 $x_i$ 执行逐分量更新。这是通用 MH 框架的一个特例。设当前状态为 $x = (x_i, x_{-i})$，其中 $x_{-i}$ 是除 $x_i$ 之外所有分量组成的向量。提议的移动仅改变第 $i$ 个分量。提议一个新值 $x_i'$，得到候选状态 $x' = (x_i', x_{-i})$。其他分量保持固定，因此 $x'_{-i} = x_{-i}$。\n\n新分量 $x_i'$ 的提议是从一个指定为 $q(x_i' \\mid x_{-i})$ 的密度中抽取的。这定义了*完整状态向量*的提议分布，对于这个第 $i$ 分量的更新步骤，我们将其表示为 $Q_i(x' \\mid x)$。由于从 $x$ 提议状态 $x'$ 的移动是通过随机选择 $x_i'$ 并确定性地保持 $x_{-i}$ 固定来完成的，因此正向提议概率密度为：\n$$ Q_i(x' \\mid x) = q(x_i' \\mid x_{-i}) $$\n这里隐含的含义是，这个提议是在给定 $x=(x_i, x_{-i})$ 的情况下对 $x'=(x_i', x_{-i})$ 的提议。\n\n为了计算接受概率，我们还需要逆向提议概率密度 $Q_i(x \\mid x')$。这是从新状态 $x'$ 出发提议原状态 $x$ 的概率。逆向移动是从 $x' = (x_i', x_{-i})$ 到 $x = (x_i, x_{-i})$。根据问题的定义，对一个分量新值（本例中为 $x_i$）的提议取决于作出提议时所处状态的其他分量（本例中为 $x_{-i}'$）。由于 $x_{-i}' = x_{-i}$，逆向提议概率密度为：\n$$ Q_i(x \\mid x') = q(x_i \\mid x_{-i}' ) = q(x_i \\mid x_{-i}) $$\n这表明对第 $i$ 个分量值的提议依赖于其他分量的值，而不依赖于第 $i$ 个分量本身当前的值。\n\n现在我们可以将这些特定形式的提议分布代入通用的 MH 接受概率公式中。我们将使用符号 $\\alpha_i(x_i \\to x_i' ; x_{-i})$ 来表示这个分量特定的接受概率。\n$$ \\alpha_{i}(x_{i} \\to x_{i}' ; x_{-i}) = \\min \\left( 1, \\frac{\\pi(x' \\mid y) Q_i(x \\mid x')}{\\pi(x \\mid y) Q_i(x' \\mid x)} \\right) = \\min \\left( 1, \\frac{\\pi(x' \\mid y) \\, q(x_i \\mid x_{-i})}{\\pi(x \\mid y) \\, q(x_i' \\mid x_{-i})} \\right) $$\n\n问题陈述了后验密度由贝叶斯定理给出，$\\pi(x \\mid y) \\propto L(y \\mid x) p(x)$。比例常数与 $x$ 无关，在比率中会被约分。因此，对于任意状态 $z$，我们可以用乘积 $L(y \\mid z) p(z)$ 来代替 $\\pi(z \\mid y)$：\n$$ \\alpha_{i}(x_{i} \\to x_{i}' ; x_{-i}) = \\min \\left( 1, \\frac{L(y \\mid x')p(x') \\, q(x_i \\mid x_{-i})}{L(y \\mid x)p(x) \\, q(x_i' \\mid x_{-i})} \\right) $$\n\n为了以完全显式的形式给出最终表达式，我们回顾 $x = (x_i, x_{-i})$ 和 $x' = (x_i', x_{-i})$，并将似然 $L$ 和先验 $p$ 的自变量以分量形式写出：\n$$ \\alpha_{i}(x_{i} \\to x_{i}' ; x_{-i}) = \\min \\left( 1, \\frac{L(y \\mid x_{i}', x_{-i}) p(x_{i}', x_{-i}) \\, q(x_{i} \\mid x_{-i})}{L(y \\mid x_{i}, x_{-i}) p(x_{i}, x_{-i}) \\, q(x_{i}' \\mid x_{-i})} \\right) $$\n这就是指定的 Gibbs 内部 Metropolis 步骤的接受概率的最终闭式表达式，它直接从细致平衡条件推导得出。",
            "answer": "$$\n\\boxed{\\min \\left( 1, \\frac{L(y \\mid x_{i}', x_{-i}) p(x_{i}', x_{-i}) \\, q(x_{i} \\mid x_{-i})}{L(y \\mid x_{i}, x_{-i}) p(x_{i}, x_{-i}) \\, q(x_{i}' \\mid x_{-i})} \\right)}\n$$"
        },
        {
            "introduction": "物理或统计模型中的参数通常受限于特定区间，例如方差必须为正。直接在受限空间中进行坐标式吉布斯采样可能导致采样链不可约（reducible），从而无法正确探索整个后验分布。本练习旨在分析此问题，并引导您应用变量变换（如对数或logit变换）将问题转化到无约束空间，同时通过雅可比行列式（Jacobian）校正确保后验分布的正确性 。",
            "id": "3386585",
            "problem": "考虑一个贝叶斯数据同化反演问题，其中一个未知参数向量 $\\theta = (\\kappa,\\rho)$ 出现在一个隐藏状态 $x$ 的状态空间模型中。该隐藏状态 $x$ 通过带噪声的线性测量 $y$ 进行观测。假设 $\\kappa$ 是一个正的扩散系数，$\\rho$ 是一个自相关参数，因此自然参数空间为 $\\Theta = (0,\\infty) \\times (0,1)$。设后验分布为\n$$\n\\pi(\\kappa,\\rho,x \\mid y) \\propto \\pi(y \\mid x)\\,\\pi(x \\mid \\kappa,\\rho)\\,\\pi(\\kappa)\\,\\pi(\\rho),\n$$\n其中 $\\pi(y \\mid x)$ 是由线性观测算子诱导的高斯似然，$\\pi(x \\mid \\kappa,\\rho)$ 是一个高斯分布，其均值和协方差通过一个源于物理的动力学模型依赖于 $(\\kappa,\\rho)$，而 $\\pi(\\kappa)$ 和 $\\pi(\\rho)$ 分别是支撑在 $(0,\\infty)$ 和 $(0,1)$ 上的正常先验。一个标准的吉布斯采样器通过从给定另一个块和数据 $y$ 的全条件分布中采样，交替更新块 $(x)$ 和 $(\\kappa,\\rho)$。\n\n你的任务是，从第一性原理出发，推断约束条件 $\\kappa \\in (0,\\infty)$ 和 $\\rho \\in (0,1)$ 如何影响 $(\\kappa,\\rho)$ 块内坐标级吉布斯更新的遍历性，并提出一种变换，该变换能够实现无约束的吉布斯采样，同时保持 $(\\kappa,\\rho)$ 上的后验分布。\n\n选择所有正确的陈述。\n\nA. 在约束空间 $\\Theta = (0,\\infty)\\times(0,1)$ 中，一个从其正常全条件分布中采样 $\\kappa \\mid (\\rho,x,y)$ 和 $\\rho \\mid (\\kappa,x,y)$ 的坐标级吉布斯采样器必然是遍历的；如果每个条件分布在其约束支撑集上处处为正，则约束不能导致可约性。\n\nB. 映射 $(u,v) = T(\\kappa,\\rho)$，其中 $u = \\log \\kappa$ 和 $v = \\log\\!\\big(\\rho/(1-\\rho)\\big)$，是从 $\\Theta$到 $\\mathbb{R}^2$ 的一个双射连续可微变换，并且变换坐标中相应的雅可比调整联合密度正比于\n$$\n\\pi(y \\mid x)\\,\\pi\\!\\big(x \\mid \\kappa,\\rho\\big)\\,\\pi(\\kappa)\\,\\pi(\\rho)\\, e^{u}\\,\\sigma(v)\\,\\big(1-\\sigma(v)\\big),\n$$\n其中 $\\kappa = e^{u}$，$\\rho = \\sigma(v)$，且 $\\sigma(v) = (1+e^{-v})^{-1}$。对 $(u,v)$ 运行以该变换后的密度为目标的吉布斯采样，在逆映射下产生的样本，其在 $(\\kappa,\\rho)$ 上的平稳分布与原始后验分布 $\\pi(\\kappa,\\rho \\mid y)$ 相匹配。\n\nC. 在由 $u = \\log \\kappa$ 和 $v = \\log\\!\\big(\\rho/(1-\\rho)\\big)$ 定义的对数-logit变换 $(u,v)$ 下，$u$ 和 $v$ 的全条件分布必然是高斯的，这保证了 $(u,v)$ 的吉布斯链的几何遍历性。\n\nD. 如果 $(\\kappa,\\rho)$ 的后验支撑集是 $\\Theta$ 内轴对齐矩形的不相交并集，那么约束空间上的坐标级吉布斯采样器可能是可约的，因为给定一个坐标，另一个坐标的条件支撑集可能被限制在同一个矩形内，从而阻止了在不连通分量之间的移动。\n\nE. 如果变换空间 $(u,v)$ 中的吉布斯采样器是 Harris 遍历的，其不变密度（在归一化常数意义下）等于 $(u,v)$ 中经雅可比调整的目标密度，那么通过逆映射 $(\\kappa,\\rho) = T^{-1}(u,v)$ 推前该链，会得到一个在约束空间上以 $\\pi(\\kappa,\\rho \\mid y)$ 为不变分布的 Harris 遍历链。",
            "solution": "我们从第一性原理开始：贝叶斯后验 $\\pi(\\kappa,\\rho,x \\mid y)$ 可分解为似然和先验的乘积。吉布斯采样器通过从全条件分布中迭代采样来构建马尔可夫链。该链在包括 $\\psi$-不可约性和非周期性在内的条件下是遍历的，在约束状态空间的背景下，这些条件关键性地取决于支撑集的几何形状和转移核的正性。约束可以改变支撑集的连通性以及条件支撑集的性质，从而影响不可约性。为了在保持目标分布的同时实现无约束采样，可以应用一个到欧几里得空间的双射可微变换，并使用变量替换定理来获得经适当雅可比调整的目标密度。\n\n约束对遍历性的影响。考虑 $(\\kappa,\\rho)$ 塊的坐标级吉布斯采样，其中在每次迭代中，我们从限制在约束支撑集 $(0,\\infty)$ 和 $(0,1)$ 上的 $\\pi(\\kappa \\mid \\rho,x,y)$ 和 $\\pi(\\rho \\mid \\kappa,x,y)$ 中采样。即使每个全条件分布在其支撑集上都是正常的且严格为正，整个链的遍历性也不是自动保证的。关键在于链是否是 $\\psi$-不可约的：对于任何具有正常数平稳概率的可测集 $A$，链应该能够在一定步数内从任何起点以正常数概率到达 $A$。如果 $(\\kappa,\\rho)$ 的联合后验支撑集是不连通的，并且其方式使得条件支撑集阻止了分量之间的跨越，那么坐标级吉布斯采样可能是可约的。一个典型的构造是支撑在两个轴对齐矩形的不相交并集上的后验分布，\n$$\nS = \\big((a_1,b_1)\\times(c_1,d_1)\\big) \\,\\cup\\, \\big((a_2,b_2)\\times(c_2,d_2)\\big),\n$$\n其中 $(a_1,b_1)\\times(c_1,d_1)$ 与 $(a_2,b_2)\\times(c_2,d_2)$ 不相交，并且在叉积 $(a_1,b_1)\\times(c_2,d_2)$ 或 $(a_2,b_2)\\times(c_1,d_1)$ 上没有质量。从第一个矩形开始，以 $\\kappa \\in (a_1,b_1)$ 为条件的坐标级吉布斯步骤必然将 $\\rho$ 限制在 $(c_1,d_1)$ 内，然后以 $\\rho \\in (c_1,d_1)$ 为条件又将 $\\kappa$ 限制在 $(a_1,b_1)$ 内。因此，链无法进入第二个矩形，这显示了可约性。这说明了约束和支撑集几何形状如何损害不可约性，进而损害遍历性。\n\n到无约束空间的变换和后验保持。定义一个变换 $T:\\Theta \\to \\mathbb{R}^2$ 为\n$$\nu = \\log \\kappa, \\quad v = \\operatorname{logit}(\\rho) = \\log\\!\\Big(\\frac{\\rho}{1-\\rho}\\Big).\n$$\n这个映射是双射的，其逆映射由下式给出\n$$\n\\kappa = e^{u}, \\quad \\rho = \\sigma(v) = \\frac{1}{1+e^{-v}}.\n$$\n逆映射 $T^{-1}(u,v)$ 的雅可比矩阵是对角的，其元素为\n$$\n\\frac{\\partial \\kappa}{\\partial u} = e^{u} = \\kappa, \\quad \\frac{\\partial \\rho}{\\partial v} = \\sigma(v)\\big(1-\\sigma(v)\\big) = \\rho(1-\\rho),\n$$\n因此 $T^{-1}$ 的雅可比行列式的绝对值为\n$$\n\\left|\\det J_{T^{-1}}(u,v)\\right| = e^{u}\\,\\sigma(v)\\,\\big(1-\\sigma(v)\\big).\n$$\n根据变量替换定理，变换坐标 $(x,u,v)$ 中的联合后验密度，在忽略归一化常数的情况下，为\n$$\n\\tilde{\\pi}(u,v,x \\mid y) \\;\\propto\\; \\pi\\!\\big(y \\mid x\\big)\\,\\pi\\!\\big(x \\mid \\kappa,\\rho\\big)\\,\\pi(\\kappa)\\,\\pi(\\rho)\\,\\left|\\det J_{T^{-1}}(u,v)\\right|,\n$$\n其中 $\\kappa = e^{u}$ 和 $\\rho = \\sigma(v)$。因此，\n$$\n\\tilde{\\pi}(u,v,x \\mid y) \\;\\propto\\; \\pi\\!\\big(y \\mid x\\big)\\,\\pi\\!\\big(x \\mid e^{u},\\sigma(v)\\big)\\,\\pi\\!\\big(e^{u}\\big)\\,\\pi\\!\\big(\\sigma(v)\\big)\\, e^{u}\\,\\sigma(v)\\,\\big(1-\\sigma(v)\\big).\n$$\n在无约束空间 $\\mathbb{R}^2 \\times \\mathcal{X}$ 中，使用正确的雅可比调整密度，构建一个以 $\\tilde{\\pi}(u,v,x \\mid y)$ 为目标的吉布斯采样器，其不变分布为 $\\tilde{\\Pi}$，该分布在 $T^{-1}$下的推前恰好是 $(\\kappa,\\rho,x)$ 上的原始后验分布 $\\Pi$。特别地，对于任何可测集 $A \\subset \\Theta \\times \\mathcal{X}$，有\n$$\n\\Pi(A) \\;=\\; \\tilde{\\Pi}\\!\\big((T \\times \\mathrm{id}_{\\mathcal{X}})(A)\\big).\n$$\n此外，遍历性属性（如Harris遍历性）在可测同构下是保持的：如果变换后的链对于不变测度 $\\tilde{\\Pi}$ 是Harris遍历的，那么在 $T^{-1}$ 下的像链对于不变测度 $\\Pi$ 也是Harris遍历的。\n\n忽略雅可比行列式的后果。如果使用从未经调整的后验分布 $\\pi(\\kappa,\\rho,x \\mid y)$ 与 $(\\kappa,\\rho)=(e^{u},\\sigma(v))$ 复合而得出的全条件分布来采样 $(u,v)$，但没有雅可比因子 $e^{u}\\,\\sigma(v)\\,(1-\\sigma(v))$，那么在 $(u,v)$ 中得到的不变密度将正比于\n$$\n\\pi\\!\\big(y \\mid x\\big)\\,\\pi\\!\\big(x \\mid e^{u},\\sigma(v)\\big)\\,\\pi\\!\\big(e^{u}\\big)\\,\\pi\\!\\big(\\sigma(v)\\big),\n$$\n其在 $T^{-1}$ 下的推前不是 $\\pi(\\kappa,\\rho,x \\mid y)$，而是一个除以雅可比行列式的重加权版本。例如，即使在 $(0,1)$ 上对 $\\rho$ 使用均匀先验，并且似然不依赖于 $\\rho$，忽略雅可比行列式将在错误方向上进行变量替换后，诱导出 $v$ 上的一个非均匀密度，该密度正比于 $\\sigma(v)\\,(1-\\sigma(v))^{-1}$，从而使隐含的 $\\rho$ 的后验分布产生偏差。因此，雅可比因子是必不可少的。\n\n逐项分析。\n\n选项A：此选项声称，如果条件分布在约束支撑集上是正常的且为正，则遍历性得到保证。这是不正确的。如前所述，当联合支撑集以坐标级条件分布将链限制在单个分量内的方式不连通时，可能出现可约性。条件支撑集上的正常性和正性并不能保证链可以在不连通分量之间移动。结论：不正确。\n\n选项B：此选项指定了对数和logit变换，指出了 $T:\\Theta \\to \\mathbb{R}^2$ 是双射且连续可微的，计算了雅可比因子 $e^{u}\\,\\sigma(v)\\,(1-\\sigma(v))$，并断言在 $(u,v)$ 中以雅可比调整后的密度为目标的吉布斯采样所产生的样本，在逆映射下的像在 $(\\kappa,\\rho)$ 上具有正确的后验分布。所有这些都源于变量替换定理和推前测度在双射下的不变性。结论：正确。\n\n选项C：此选项断言，在对数-logit变换下，全条件分布必然是高斯的，并且这保证了几何遍历性。一般来说，变换后的条件分布不一定是高斯的；它们的形式取决于 $\\pi(x \\mid \\kappa,\\rho)$、$\\pi(\\kappa)$ 和 $\\pi(\\rho)$。即使当 $x$ 的线性高斯模型中出现高斯结构时，由于 $(\\kappa,\\rho)$ 对 $(u,v)$ 的非线性依赖以及雅可比因子的存在，$(u,v)$ 的诱导条件分布通常也不是高斯的。此外，仅凭某些条件分布的高斯性并不能保证几何遍历性。结论：不正确。\n\n选项D：此选项指出，如果后验支撑集是轴对齊矩形的不相交并集，坐标级吉布斯采样可能是可约的，因为条件分布会将链困在单个矩形内。如使用 $S = \\big((a_1,b_1)\\times(c_1,d_1)\\big) \\cup \\big((a_2,b_2)\\times(c_2,d_2)\\big)$ 且交叉项上没有质量的例子所示，给定一个坐标位于一个矩形内，另一个坐标的条件支撑集也保持在同一个矩形内，从而阻止了跨分量的转移。这证明了可约性。结论：正确。\n\n选项E：此选项断言，当以 $(u,v)$ 中正确进行雅可比调整的密度为目标时，Harris遍历性和不变分布在逆映射下会适当地变换。在一个具有可测逆的双射可测映射 $T$ 下，一个Harris遍历马尔可夫链的像仍然是Harris遍历的，并且不变测度通过 $T$ 推前（并通过 $T^{-1}$ 拉回）。在我们的设置中，以正确的变换后密度为目标可确保在 $T^{-1}$ 下的推前能够恢复 $\\pi(\\kappa,\\rho \\mid y)$。结论：正确。",
            "answer": "$$\\boxed{BDE}$$"
        }
    ]
}