{
    "hands_on_practices": [
        {
            "introduction": "在实际应用高斯过程先验之前，一个关键步骤是确定其协方差核的超参数。本练习提供了一个基于矩量法的动手实践，旨在从给定的经验协方差数据中估算马特恩核的参数。通过一个$\\nu = 1/2$的特例，您将看到理论公式如何与模拟的观测数据联系起来，这是在数据同化和机器学习中进行模型校准的一项基本技能。",
            "id": "3400800",
            "problem": "考虑一个定义在$\\mathbb{R}$上的一维线性逆问题，其空间状态场为$u(x)$。在数据同化设定中，您将$u(x)$建模为一个零均值高斯过程（GP），其协方差核为平稳且各向同性的Matérn协方差核。Matérn核由边际方差$\\sigma^{2}  0$、相关长度$\\rho  0$和光滑度参数$\\nu  0$参数化。您假设光滑度参数固定为$\\nu = \\tfrac{1}{2}$。\n\n现有从GP先验中独立抽样得到的样本大小为$M$的集合，其中$M$足够大，以至于根据大数定律，经验协方差可以很好地近似真实协方差。令$\\widehat{C}(h)$表示在分离距离$h \\ge 0$处的经验协方差，它是根据平稳性和各向同性假设，使用标准协方差估计量从该集合中计算得出的。假设从该集合中获得了以下经验值：\n- 在分离距离$h = 0$处，$\\widehat{C}(0) = 1.44$。\n- 在分离距离$h = 3$处，$\\widehat{C}(3) = 0.36$。\n\n仅使用平稳高斯过程协方差函数的基本定义、Matérn类的定义公式以及特殊函数的标准性质，通过将$\\nu = \\tfrac{1}{2}$时的理论Matérn协方差与经验协方差进行匹配，推导相关长度$\\rho$的矩估计法估计值。然后计算得到的$\\rho$的数值。\n\n以与距离$h$相同的空间单位表示您对$\\rho$的最终估计，但只报告数值。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求估计一个零均值高斯过程（GP）的相关长度$\\rho$，该过程的先验协方差由光滑度参数$\\nu = \\frac{1}{2}$的Matérn核描述。估计将使用矩估计法进行，通过将理论协方差与给定的经验协方差值进行匹配。\n\n首先，我们陈述对于分离距离$h \\ge 0$的平稳且各向同性的Matérn协方差函数的一般形式：\n$$C(h; \\sigma^2, \\rho, \\nu) = \\sigma^2 \\frac{2^{1-\\nu}}{\\Gamma(\\nu)} \\left( \\frac{\\sqrt{2\\nu} h}{\\rho} \\right)^\\nu K_\\nu \\left( \\frac{\\sqrt{2\\nu} h}{\\rho} \\right)$$\n这里，$\\sigma^2$是边际方差，$\\rho  0$是相关长度，$\\nu  0$是光滑度参数。函数$\\Gamma(\\cdot)$是伽马函数，而$K_\\nu(\\cdot)$是$\\nu$阶第二类修正贝塞尔函数。\n\n问题指定光滑度参数固定为$\\nu = \\frac{1}{2}$。我们必须针对此特定情况简化通用的Matérn公式。为此，我们使用特殊函数在$\\nu = \\frac{1}{2}$时的标准性质：\n1. 伽马函数在$\\frac{1}{2}$处的值为$\\Gamma\\left(\\frac{1}{2}\\right) = \\sqrt{\\pi}$。\n2. $\\frac{1}{2}$阶第二类修正贝塞尔函数有一个闭式表达式：$K_{\\frac{1}{2}}(z) = \\sqrt{\\frac{\\pi}{2z}} \\exp(-z)$。\n\n让我们将$\\nu = \\frac{1}{2}$代入Matérn公式。贝塞尔函数的自变量变为：\n$$ \\frac{\\sqrt{2\\nu} h}{\\rho} = \\frac{\\sqrt{2 \\cdot \\frac{1}{2}} h}{\\rho} = \\frac{h}{\\rho} $$\n现在，将所有部分代入协方差函数表达式中：\n$$ C(h) = \\sigma^2 \\frac{2^{1-\\frac{1}{2}}}{\\Gamma\\left(\\frac{1}{2}\\right)} \\left( \\frac{h}{\\rho} \\right)^{\\frac{1}{2}} K_{\\frac{1}{2}} \\left( \\frac{h}{\\rho} \\right) $$\n$$ C(h) = \\sigma^2 \\frac{2^{\\frac{1}{2}}}{\\sqrt{\\pi}} \\left( \\frac{h}{\\rho} \\right)^{\\frac{1}{2}} \\left[ \\sqrt{\\frac{\\pi}{2(h/\\rho)}} \\exp\\left(-\\frac{h}{\\rho}\\right) \\right] $$\n我们现在可以简化指数函数前的各项：\n$$ C(h) = \\sigma^2 \\left[ \\frac{\\sqrt{2}}{\\sqrt{\\pi}} \\cdot \\frac{\\sqrt{h}}{\\sqrt{\\rho}} \\cdot \\sqrt{\\frac{\\pi \\rho}{2h}} \\right] \\exp\\left(-\\frac{h}{\\rho}\\right) $$\n$$ C(h) = \\sigma^2 \\sqrt{\\frac{2}{\\pi} \\cdot \\frac{h}{\\rho} \\cdot \\frac{\\pi \\rho}{2h}} \\exp\\left(-\\frac{h}{\\rho}\\right) $$\n$$ C(h) = \\sigma^2 \\sqrt{1} \\exp\\left(-\\frac{h}{\\rho}\\right) $$\n因此，对于$\\nu = \\frac{1}{2}$，Matérn协方差函数简化为众所周知的指数协方差函数：\n$$ C(h) = \\sigma^2 \\exp\\left(-\\frac{h}{\\rho}\\right) $$\n对于一个平稳过程，零分离距离处的协方差$C(0)$等于边际方差$\\sigma^2$。这与我们推导的公式一致，因为$\\exp(0) = 1$。\n$$ C(0) = \\sigma^2 \\exp\\left(-\\frac{0}{\\rho}\\right) = \\sigma^2 $$\n\n矩估计法包括将理论协方差函数$C(h)$与给定数据点的经验估计值$\\widehat{C}(h)$相等。我们已知：\n1. $\\widehat{C}(0) = 1.44$\n2. $\\widehat{C}(3) = 0.36$\n\n我们建立一个包含两个未知数$\\sigma^2$和$\\rho$的方程组：\n$$ C(0) = \\sigma^2 = \\widehat{C}(0) = 1.44 $$\n$$ C(3) = \\sigma^2 \\exp\\left(-\\frac{3}{\\rho}\\right) = \\widehat{C}(3) = 0.36 $$\n\n从第一个方程，我们直接得到方差的矩估计法估计值：\n$$ \\hat{\\sigma}^2 = 1.44 $$\n我们将此值代入第二个方程以求解$\\rho$：\n$$ 1.44 \\cdot \\exp\\left(-\\frac{3}{\\rho}\\right) = 0.36 $$\n两边同除以$1.44$：\n$$ \\exp\\left(-\\frac{3}{\\rho}\\right) = \\frac{0.36}{1.44} = \\frac{36}{144} = \\frac{1}{4} $$\n为了求解$\\rho$，我们对两边取自然对数：\n$$ \\ln\\left[\\exp\\left(-\\frac{3}{\\rho}\\right)\\right] = \\ln\\left(\\frac{1}{4}\\right) $$\n$$ -\\frac{3}{\\rho} = -\\ln(4) $$\n$$ \\frac{3}{\\rho} = \\ln(4) $$\n最后，我们分离出$\\rho$：\n$$ \\rho = \\frac{3}{\\ln(4)} $$\n这就是$\\rho$估计值的精确解析表达式。\n\n问题要求一个四舍五入到四位有效数字的数值。我们计算其值：\n$$ \\ln(4) = \\ln(2^2) = 2 \\ln(2) \\approx 2 \\times 0.693147... = 1.386294... $$\n$$ \\rho = \\frac{3}{1.386294...} \\approx 2.164042... $$\n四舍五入到四位有效数字，我们得到：\n$$ \\rho \\approx 2.164 $$",
            "answer": "$$\\boxed{2.164}$$"
        },
        {
            "introduction": "高斯过程不仅能为场本身建模，还能为其导数等相关量提供概率描述。本练习将引导您在一个假设场景中，推导在同化一个线性观测后，场导数的后验方差。这个过程涉及到对马特恩协方差核函数进行微分，清晰地展示了如何量化物理场梯度的不确定性，这在许多依赖于梯度信息的科学领域（如流体力学和地球物理学）中至关重要。",
            "id": "3400797",
            "problem": "考虑一个定义在 $\\mathbb{R}$ 上的未知一维标量场 $u(x)$，该场具有零均值和一个平滑度参数为 $\\nu = 5/2$ 的平稳 Matérn 协方差核的高斯过程（GP）先验。两个位置 $x$ 和 $x'$ 之间的 Matérn 协方差核仅取决于它们之间的距离 $r = |x - x'|$，定义如下：\n$$\nk(r) = \\sigma^{2}\\left(1 + \\frac{\\sqrt{5}\\, r}{\\ell} + \\frac{5 r^{2}}{3 \\ell^{2}}\\right)\\exp\\!\\left(-\\frac{\\sqrt{5}\\, r}{\\ell}\\right),\n$$\n其中 $\\sigma^{2}  0$ 是边际方差，$\\ell  0$ 是相关长度。假设由于 $\\nu = 5/2$，导数过程 $u'(x)$ 在均方意义下存在。\n\n在一个数据同化场景中，通过一个线性测量算子收集单个标量观测值，该算子将场在两个不同位置的值相加，并加上独立的测量噪声：\n$$\ny = u(x_{0}) + u(x_{1}) + \\varepsilon,\n$$\n其中 $\\varepsilon \\sim \\mathcal{N}(0,\\tau^{2})$ 与 $u$ 独立，且噪声方差 $\\tau^{2}  0$ 已知。假设这些位置满足 $x_{0}  x_{1}  x^{\\ast}$，并定义距离如下：\n$$\nr_{0} = x^{\\ast} - x_{0}, \\quad r_{1} = x^{\\ast} - x_{1}, \\quad d = x_{1} - x_{0}.\n$$\n\n从高斯过程的基本定义、上述给出的 Matérn 核以及联合高斯随机变量的标准性质出发，推导在观测值 $y$ 条件下导数 $u'(x^{\\ast})$ 的后验方差。请将最终结果表示为关于 $\\sigma^{2}$、$\\ell$、$\\tau^{2}$、$r_{0}$、$r_{1}$ 和 $d$ 的单个闭式解析表达式。最终答案中不要提供中间计算步骤。不需要进行数值近似；请提供精确表达式。",
            "solution": "该问题要求推导在单个线性观测值 $y$ 条件下，高斯过程（GP）场导数 $u'(x^{\\ast})$ 的后验方差。场 $u(x)$ 由一个零均值 GP 先验定义，其 Matérn 协方差核为 $k(r)$，平滑度参数为 $\\nu = 5/2$。\n\n问题的核心在于联合高斯随机变量的性质。设目标随机变量为 $T = u'(x^{\\ast})$，观测随机变量为 $Y = y = u(x_{0}) + u(x_{1}) + \\varepsilon$。由于 $u(x)$ 是一个高斯过程，而 $\\varepsilon$ 是一个高斯随机变量，因此从 $u(x)$ 和 $\\varepsilon$ 中抽取的样本的任何线性组合都将是高斯的。具体来说，$u'(x^{\\ast})$、$u(x_0)$ 和 $u(x_1)$ 是联合高斯的，因此 $T$ 和 $Y$ 也是联合高斯的。两者的均值都为零，因为 GP 先验的均值为零，噪声 $\\varepsilon$ 的均值也为零。\n\n$T$ 和 $Y$ 的联合分布是一个二元高斯分布：\n$$\n\\begin{pmatrix} T \\\\ Y \\end{pmatrix} \\sim \\mathcal{N}\\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} \\text{Var}[T]  \\text{Cov}[T, Y] \\\\ \\text{Cov}[Y, T]  \\text{Var}[Y] \\end{pmatrix} \\right)\n$$\n在观测值 $Y=y$ 条件下 $T$ 的后验方差由条件高斯分布的标准公式给出：\n$$\n\\text{Var}[T | Y=y] = \\text{Var}[T] - \\frac{(\\text{Cov}[T, Y])^2}{\\text{Var}[Y]}\n$$\n为求得解，我们必须计算右侧的三个量：$\\text{Var}[T]$、$\\text{Var}[Y]$ 和 $\\text{Cov}[T, Y]$。这些量由指定的 Matérn 协方差核 $k(r)$ 及其导数确定。\n\n场 $u(x)$ 的协方差函数由 $k(|x-x'|)$ 给出，其中\n$$\nk(r) = \\sigma^{2}\\left(1 + \\frac{\\sqrt{5}\\, r}{\\ell} + \\frac{5 r^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, r}{\\ell}\\right)\n$$\n涉及导数过程 $u'(x)$ 的协方差通过对核函数求导得到。相关关系如下：\n$$\n\\text{Cov}[u(x), u(x')] = k(|x-x'|)\n$$\n$$\n\\text{Cov}[u'(x), u(x')] = \\frac{\\partial}{\\partial x} k(|x-x'|) = \\text{sgn}(x-x') \\frac{dk}{dr}(|x-x'|)\n$$\n$$\n\\text{Cov}[u'(x), u'(x')] = \\frac{\\partial^2}{\\partial x \\partial x'} k(|x-x'|) = -\\frac{d^2k}{dr^2}(|x-x'|)\n$$\n对于 $x \\neq x'$。某一点导数的方差由 $\\text{Var}[u'(x)] = \\lim_{x' \\to x} \\text{Cov}[u'(x), u'(x')] = -\\left. \\frac{d^2k}{dr^2} \\right|_{r=0}$ 给出。\n\n首先，我们计算 $k(r)$ 关于 $r$ 的一阶和二阶导数：\n$$\n\\frac{dk}{dr} = \\frac{d}{dr} \\left[ \\sigma^{2}\\left(1 + \\frac{\\sqrt{5}\\, r}{\\ell} + \\frac{5 r^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, r}{\\ell}\\right) \\right]\n$$\n使用乘法法则，我们得到：\n$$\n\\frac{dk}{dr} = \\sigma^{2} \\left[ \\left(\\frac{\\sqrt{5}}{\\ell} + \\frac{10r}{3\\ell^2}\\right) - \\frac{\\sqrt{5}}{\\ell}\\left(1 + \\frac{\\sqrt{5}\\, r}{\\ell} + \\frac{5 r^{2}}{3 \\ell^{2}}\\right) \\right] \\exp\\left(-\\frac{\\sqrt{5}\\, r}{\\ell}\\right)\n$$\n$$\n\\frac{dk}{dr} = \\sigma^{2} \\left[ \\frac{\\sqrt{5}}{\\ell} + \\frac{10r}{3\\ell^2} - \\frac{\\sqrt{5}}{\\ell} - \\frac{5r}{\\ell^2} - \\frac{5\\sqrt{5}r^2}{3\\ell^3} \\right] \\exp\\left(-\\frac{\\sqrt{5}\\, r}{\\ell}\\right)\n$$\n$$\n\\frac{dk}{dr} = -\\frac{5\\sigma^2 r}{3\\ell^2}\\left(1 + \\frac{\\sqrt{5}r}{\\ell}\\right) \\exp\\left(-\\frac{\\sqrt{5}r}{\\ell}\\right)\n$$\n接下来，我们计算二阶导数 $\\frac{d^2k}{dr^2}$：\n$$\n\\frac{d^2k}{dr^2} = \\frac{d}{dr} \\left[ -\\frac{5\\sigma^2}{3\\ell^2}\\left(r + \\frac{\\sqrt{5}r^2}{\\ell}\\right) \\exp\\left(-\\frac{\\sqrt{5}r}{\\ell}\\right) \\right]\n$$\n再次应用乘法法则：\n$$\n\\frac{d^2k}{dr^2} = -\\frac{5\\sigma^2}{3\\ell^2} \\left[ \\left(1+\\frac{2\\sqrt{5}r}{\\ell}\\right) - \\frac{\\sqrt{5}}{\\ell}\\left(r + \\frac{\\sqrt{5}r^2}{\\ell}\\right) \\right] \\exp\\left(-\\frac{\\sqrt{5}r}{\\ell}\\right)\n$$\n$$\n\\frac{d^2k}{dr^2} = -\\frac{5\\sigma^2}{3\\ell^2} \\left(1+\\frac{\\sqrt{5}r}{\\ell} - \\frac{5r^2}{\\ell^2}\\right) \\exp\\left(-\\frac{\\sqrt{5}r}{\\ell}\\right)\n$$\n\n现在我们可以计算所需的方差和协方差。\n\n1.  **目标先验方差, $\\text{Var}[T]$**：\n    $T = u'(x^{\\ast})$，因此其方差是导数过程的先验方差。\n    $$\n    \\text{Var}[T] = \\text{Var}[u'(x^{\\ast})] = -\\left. \\frac{d^2k}{dr^2} \\right|_{r=0} = -\\left( -\\frac{5\\sigma^2}{3\\ell^2} (1+0-0) \\exp(0) \\right) = \\frac{5\\sigma^2}{3\\ell^2}\n    $$\n\n2.  **观测值方差, $\\text{Var}[Y]$**：\n    $Y = u(x_0) + u(x_1) + \\varepsilon$。由于 $\\varepsilon$ 与高斯过程 $u(x)$ 独立，其方差线性相加。\n    $$\n    \\text{Var}[Y] = \\text{Var}[u(x_0) + u(x_1)] + \\text{Var}[\\varepsilon]\n    $$\n    $$\n    \\text{Var}[Y] = \\text{Var}[u(x_0)] + \\text{Var}[u(x_1)] + 2\\text{Cov}[u(x_0), u(x_1)] + \\tau^2\n    $$\n    任意点的方差为 $k(0) = \\sigma^2$。$u(x_0)$ 和 $u(x_1)$ 之间的协方差为 $k(|x_1-x_0|) = k(d)$。\n    $$\n    \\text{Var}[Y] = \\sigma^2 + \\sigma^2 + 2k(d) + \\tau^2 = 2\\sigma^2 + 2k(d) + \\tau^2\n    $$\n    代入 $k(d)$ 的表达式：\n    $$\n    \\text{Var}[Y] = 2\\sigma^2 + 2\\sigma^{2}\\left(1 + \\frac{\\sqrt{5}\\, d}{\\ell} + \\frac{5 d^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, d}{\\ell}\\right) + \\tau^2\n    $$\n    这可以写成：\n    $$\n    \\text{Var}[Y] = 2\\sigma^2\\left[1 + \\left(1 + \\frac{\\sqrt{5}\\, d}{\\ell} + \\frac{5 d^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, d}{\\ell}\\right)\\right] + \\tau^2\n    $$\n\n3.  **目标与观测值之间的协方差, $\\text{Cov}[T, Y]$**：\n    利用协方差的线性和 $\\varepsilon$ 的独立性：\n    $$\n    \\text{Cov}[T, Y] = \\text{Cov}[u'(x^{\\ast}), u(x_0) + u(x_1) + \\varepsilon] = \\text{Cov}[u'(x^{\\ast}), u(x_0)] + \\text{Cov}[u'(x^{\\ast}), u(x_1)]\n    $$\n    我们使用公式 $\\text{Cov}[u'(x), u(x')] = \\text{sgn}(x-x') \\frac{dk}{dr}(|x-x'|)$。\n    对于第一项，$x=x^{\\ast}$ 且 $x'=x_0$。由于 $x^{\\ast}  x_0$，$\\text{sgn}(x^{\\ast}-x_0) = 1$。距离为 $|x^{\\ast}-x_0|=r_0$。\n    $$\n    \\text{Cov}[u'(x^{\\ast}), u(x_0)] = \\frac{dk}{dr}(r_0)\n    $$\n    对于第二项，$x=x^{\\ast}$ 且 $x'=x_1$。由于 $x^{\\ast}  x_1$，$\\text{sgn}(x^{\\ast}-x_1) = 1$。距离为 $|x^{\\ast}-x_1|=r_1$。\n    $$\n    \\text{Cov}[u'(x^{\\ast}), u(x_1)] = \\frac{dk}{dr}(r_1)\n    $$\n    因此，\n    $$\n    \\text{Cov}[T, Y] = \\frac{dk}{dr}(r_0) + \\frac{dk}{dr}(r_1)\n    $$\n    代入 $\\frac{dk}{dr}$ 的表达式：\n    $$\n    \\text{Cov}[T, Y] = -\\frac{5\\sigma^2 r_0}{3\\ell^2}\\left(1 + \\frac{\\sqrt{5}r_0}{\\ell}\\right) \\exp\\left(-\\frac{\\sqrt{5}r_0}{\\ell}\\right) -\\frac{5\\sigma^2 r_1}{3\\ell^2}\\left(1 + \\frac{\\sqrt{5}r_1}{\\ell}\\right) \\exp\\left(-\\frac{\\sqrt{5}r_1}{\\ell}\\right)\n    $$\n    $$\n    \\text{Cov}[T, Y] = -\\frac{5\\sigma^2}{3\\ell^2} \\left[ r_0\\left(1 + \\frac{\\sqrt{5}r_0}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_0}{\\ell}\\right) + r_1\\left(1 + \\frac{\\sqrt{5}r_1}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_1}{\\ell}\\right) \\right]\n    $$\n\n最后，我们将这三个分量代入后验方差的公式中：\n$$\n\\text{Var}[u'(x^{\\ast}) | y] = \\text{Var}[T] - \\frac{(\\text{Cov}[T, Y])^2}{\\text{Var}[Y]}\n$$\n得到的单个闭式表达式为：\n$$\n\\frac{5\\sigma^2}{3\\ell^2} - \\frac{\\left(-\\frac{5\\sigma^2}{3\\ell^2} \\left[ r_0\\left(1 + \\frac{\\sqrt{5}r_0}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_0}{\\ell}\\right) + r_1\\left(1 + \\frac{\\sqrt{5}r_1}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_1}{\\ell}\\right) \\right]\\right)^2}{2\\sigma^2\\left[1 + \\left(1 + \\frac{\\sqrt{5}\\, d}{\\ell} + \\frac{5 d^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, d}{\\ell}\\right)\\right] + \\tau^2}\n$$\n将分子项平方并简化系数可得：\n$$\n\\frac{5\\sigma^2}{3\\ell^2} - \\frac{\\frac{25\\sigma^4}{9\\ell^4} \\left( r_0\\left(1 + \\frac{\\sqrt{5}r_0}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_0}{\\ell}\\right) + r_1\\left(1 + \\frac{\\sqrt{5}r_1}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_1}{\\ell}\\right) \\right)^2}{2\\sigma^2\\left(1 + \\left(1 + \\frac{\\sqrt{5}\\, d}{\\ell} + \\frac{5 d^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, d}{\\ell}\\right)\\right) + \\tau^2}\n$$\n这就是后验方差的最终解析表达式。",
            "answer": "$$\n\\boxed{\\frac{5\\sigma^2}{3\\ell^2} - \\frac{\\frac{25\\sigma^4}{9\\ell^4} \\left( r_0\\left(1 + \\frac{\\sqrt{5}r_0}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_0}{\\ell}\\right) + r_1\\left(1 + \\frac{\\sqrt{5}r_1}{\\ell}\\right)\\exp\\left(-\\frac{\\sqrt{5}r_1}{\\ell}\\right) \\right)^2}{2\\sigma^2\\left(1 + \\left(1 + \\frac{\\sqrt{5}\\, d}{\\ell} + \\frac{5 d^{2}}{3 \\ell^{2}}\\right)\\exp\\left(-\\frac{\\sqrt{5}\\, d}{\\ell}\\right)\\right) + \\tau^2}}\n$$"
        },
        {
            "introduction": "在处理高维问题时，直接操作完整的协方差矩阵在计算上往往是不可行的。本练习介绍了一种核心降维技术——卡尔胡宁-勒维（KL）展开，用于构建先验协方差矩阵的低秩近似。通过在一个设定好的数值实验中编程实现该方法，您将能够量化模型简化带来的计算增益与精度损失之间的权衡，这是解决大规模逆问题和数据同化问题的关键策略。",
            "id": "3400809",
            "problem": "考虑一个在一维空间域 $[0,1]$ 上的贝叶斯线性逆问题。设 $u$ 是一个定义在包含 $N=100$ 个点的均匀网格上的潜场，其先验为一个零均值的高斯过程 (GP)，并具有 Matérn 协方差核。观测数据由一个线性观测算子生成，该算子选择网格点的一个子集，并添加独立的高斯噪声。任务是实现先验协方差的 Karhunen–Loève (KL) 截断，并评估其对数据同化中使用的后验均值的影响。\n\n允许的基础知识：\n- 高斯过程 (GP) 先验和高斯似然的定义。\n- 多元高斯分布在线性变换和条件化下的性质。\n- Matérn 协方差函数的定义和贝塞尔函数的基本性质。\n- 对称正定矩阵的谱分解 (特征分解)。\n\n除了从上述基础知识可以推导出的内容外，不要使用任何专门的快捷公式。\n\n设置：\n- 将 $[0,1]$ 离散化为 $N=100$ 个等距网格点 $x_i = \\frac{i}{N-1}$，其中 $i=0,1,\\dots,N-1$。\n- 定义一个确定性的“真实”场 $u_{\\text{true}}(x) = \\sin(2\\pi x) + 0.5\\cos(5\\pi x)$，并在网格上对其进行求值。\n- 定义 $M=10$ 个观测位置为 $M$ 个等距的内部网格点 (不包括端点)；这些位置对应于将区间细分为 $M+1$ 个相等段并选择内部网格索引所获得的索引。\n- 观测算子 $H$ 通过选择这 $M$ 个索引处的条目，将 $\\mathbb{R}^N$ 映射到 $\\mathbb{R}^M$。观测值为 $y = H u_{\\text{true}} + \\varepsilon$，其中 $\\varepsilon \\sim \\mathcal{N}(0,\\sigma_{\\text{noise}}^2 I_M)$ 且 $I_M$ 是 $M \\times M$ 的单位矩阵。在本问题中，将实现的噪声设置为恒等于零，因此数据恰好为 $y = H u_{\\text{true}}$，但在似然中保留噪声协方差。\n\n先验：\n- 使用一个 Matérn 协方差核，其边际方差为 $\\sigma^2$，平滑度为 $\\nu0$，相关长度为 $\\ell0$。对于点 $x,x' \\in [0,1]$，协方差为\n$$\nk_{\\nu,\\ell,\\sigma}(x,x') = \\sigma^2 \\, \\frac{2^{1-\\nu}}{\\Gamma(\\nu)}\\left(\\frac{\\sqrt{2\\nu}}{\\ell}\\,|x-x'|\\right)^{\\nu} K_{\\nu}\\!\\left(\\frac{\\sqrt{2\\nu}}{\\ell}\\,|x-x'|\\right),\n$$\n并具有连续扩展 $k_{\\nu,\\ell,\\sigma}(x,x)=\\sigma^2$，其中 $K_{\\nu}$ 表示第二类修正贝塞尔函数，$\\Gamma$ 是 Gamma 函数。\n\nKarhunen–Loève 截断：\n- 设 $K \\in \\mathbb{R}^{N\\times N}$ 为协方差矩阵，其元素为 $K_{ij} = k_{\\nu,\\ell,\\sigma}(x_i,x_j)$。\n- 设 $K = Q \\Lambda Q^\\top$ 为一个特征分解，其中 $Q$ 的列是标准正交的，$\\Lambda$ 中的特征值是非负的。对于目标秩 $r \\in \\{0,1,\\dots,N\\}$，定义 KL 截断协方差为 $K_r = Q_r \\Lambda_r Q_r^\\top$，其中 $Q_r$ 包含与 $r$ 个最大特征值相关联的特征向量，$\\Lambda_r$ 是相应的对角矩阵。\n\n后验均值：\n- 设 $m_{\\text{full}}$ 表示使用完整协方差 $K$ 计算的后验均值。\n- 设 $m_r$ 表示使用 KL 截断协方差 $K_r$ 计算的后验均值。\n- 定义截断后验均值在离散欧几里得范数下的相对误差为\n$$\ne_r = \\frac{\\lVert m_{\\text{full}} - m_r \\rVert_2}{\\lVert m_{\\text{full}} \\rVert_2}.\n$$\n\n任务：\n1. 从多元高斯分布的性质和线性高斯模型的贝叶斯法则出发，推导一个关于 $K$、观测算子 $H$、数据向量 $y$ 和噪声方差 $\\sigma_{\\text{noise}}^2$ 的后验均值 $m_{\\text{full}}$ 的可实现表达式。您不得假设任何无法从上述基础知识推导出的快捷公式。\n2. 类似地，使用 $K_r$、相同的 $H$、$y$ 和 $\\sigma_{\\text{noise}}^2$，推导 KL 截断后验均值 $m_r$ 的可实现表达式。\n3. 实现一个程序，该程序从 Matérn 核构造 $K$，通过选择指定的 $M$ 个网格点形成观测算子 $H$，计算 $y$，计算 $m_{\\text{full}}$ 和 $m_r$，并为每个指定的测试用例返回 $e_r$。\n4. 必须对 $K$ 进行特征分解，并且秩-r 近似 $K_r$ 必须使用 $r$ 个最大的特征值。正确处理 $r=0$ 和 $r=N$ 的边界情况。\n5. 对零距离处的任何特殊函数求值进行数值稳定处理，以确保 $k_{\\nu,\\ell,\\sigma}(x,x)=\\sigma^2$。\n\n测试套件：\n为以下每个参数集 $(\\nu,\\ell,\\sigma,\\sigma_{\\text{noise}},r)$ 计算 $e_r$：\n- 情况 1：$(\\nu=0.5,\\ \\ell=0.2,\\ \\sigma=1.0,\\ \\sigma_{\\text{noise}}=0.05,\\ r=10)$。\n- 情况 2：$(\\nu=1.5,\\ \\ell=0.3,\\ \\sigma=1.0,\\ \\sigma_{\\text{noise}}=0.1,\\ r=0)$。\n- 情况 3：$(\\nu=2.5,\\ \\ell=0.4,\\ \\sigma=1.0,\\ \\sigma_{\\text{noise}}=0.1,\\ r=100)$。\n- 情况 4：$(\\nu=0.5,\\ \\ell=0.05,\\ \\sigma=1.0,\\ \\sigma_{\\text{noise}}=0.2,\\ r=5)$。\n- 情况 5：$(\\nu=1.5,\\ \\ell=1.0,\\ \\sigma=1.0,\\ \\sigma_{\\text{noise}}=0.05,\\ r=5)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的浮点数列表，每个浮点数四舍五入到六位小数 (例如：\"[0.123456,0.000001,1.000000,0.543210,0.010000]\")。",
            "solution": "问题的核心是，在给定带噪声的线性观测 $y$ 的情况下，推导并计算潜场 $u$ 的后验均值。对于 $u \\in \\mathbb{R}^N$ 的先验分布是一个零均值高斯过程，由 Matérn 协方差矩阵 $K \\in \\mathbb{R}^{N \\times N}$ 指定，因此 $p(u) = \\mathcal{N}(u; 0, K)$。观测模型是线性的，并受到加性高斯噪声的干扰，$y = Hu + \\varepsilon$，其中 $H \\in \\mathbb{R}^{M \\times N}$ 是观测算子，噪声 $\\varepsilon \\in \\mathbb{R}^M$ 服从分布 $\\mathcal{N}(\\varepsilon; 0, R)$，其中 $R = \\sigma_{\\text{noise}}^2 I_M$。因此，给定场 $u$ 的数据 $y$ 的似然是 $p(y|u) = \\mathcal{N}(y; Hu, R)$。\n\n为了推导后验均值，我们考虑 $u$ 和 $y$ 的联合分布。由于先验和似然都是高斯的，并且 $u$ 和 $y$ 之间的关系是线性的，它们的联合分布也是高斯的。联合分布的均值为零，因为 $u$ 和 $\\varepsilon$ 的均值都为零：\n$$\nE\\begin{pmatrix} u \\\\ y \\end{pmatrix} = \\begin{pmatrix} E[u] \\\\ E[Hu + \\varepsilon] \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ H E[u] + E[\\varepsilon] \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.\n$$\n联合分布的协方差矩阵由下式给出：\n$$\n\\text{Cov}\\begin{pmatrix} u \\\\ y \\end{pmatrix} =\n\\begin{pmatrix} \\text{Cov}(u, u)  \\text{Cov}(u, y) \\\\ \\text{Cov}(y, u)  \\text{Cov}(y, y) \\end{pmatrix}.\n$$\n各分量为 $\\text{Cov}(u, u) = K$，并利用 $u$ 和 $\\varepsilon$ 的独立性：\n$$\n\\text{Cov}(y, y) = E[yy^\\top] = E[(Hu+\\varepsilon)(Hu+\\varepsilon)^\\top] = H E[uu^\\top] H^\\top + E[\\varepsilon \\varepsilon^\\top] = H K H^\\top + R.\n$$\n$$\n\\text{Cov}(u, y) = E[uy^\\top] = E[u(Hu+\\varepsilon)^\\top] = E[uu^\\top]H^\\top + E[u\\varepsilon^\\top] = K H^\\top.\n$$\n并且 $\\text{Cov}(y, u) = \\text{Cov}(u, y)^\\top = (K H^\\top)^\\top = H K^\\top = HK$ 因为 $K$ 是对称的。因此，联合分布为：\n$$\n\\begin{pmatrix} u \\\\ y \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} K  KH^\\top \\\\ HK  HKH^\\top + R \\end{pmatrix} \\right).\n$$\n对于一个划分为 $\\begin{pmatrix} z_1 \\\\ z_2 \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} \\mu_1 \\\\ \\mu_2 \\end{pmatrix}, \\begin{pmatrix} \\Sigma_{11}  \\Sigma_{12} \\\\ \\Sigma_{21}  \\Sigma_{22} \\end{pmatrix} \\right)$ 的一般多元高斯分布，给定 $z_2$ 时 $z_1$ 的条件分布也是高斯的，其均值为 $\\mu_{1|2} = \\mu_1 + \\Sigma_{12} \\Sigma_{22}^{-1} (z_2 - \\mu_2)$。通过将 $z_1=u$ 和 $z_2=y$ 对号入座，将此结果应用于我们的问题，我们发现后验分布 $p(u|y)$ 的均值（表示为 $m_{\\text{full}}$）由下式给出：\n$$\nm_{\\text{full}} = 0 + K H^\\top (H K H^\\top + R)^{-1} (y - 0) = K H^\\top (H K H^\\top + R)^{-1} y.\n$$\n这个表达式在计算上是有利的，因为它需要求一个 $M \\times M$ 矩阵的逆，其中 $M$ 是观测数量，而不是通常大得多的 $N \\times N$ 矩阵 $K$。\n\n接下来，我们考虑 Karhunen–Loève (KL) 截断。协方差矩阵 $K$ 是对称半正定的，这允许进行特征分解 $K = Q \\Lambda Q^\\top$，其中 $Q$ 是特征向量构成的正交矩阵，$\\Lambda$ 是非负特征值构成的对角矩阵。秩-r 的 KL 截断协方差矩阵 $K_r$ 是使用与 $r$ 个最大特征值相对应的 $r$ 个特征向量构造的：\n$$\nK_r = Q_r \\Lambda_r Q_r^\\top,\n$$\n其中 $Q_r \\in \\mathbb{R}^{N \\times r}$ 的列是前 $r$ 个特征向量，$\\Lambda_r \\in \\mathbb{R}^{r \\times r}$ 是对应的前 $r$ 个特征值构成的对角矩阵。使用 $K_r$ 作为先验协方差矩阵，即 $u \\sim \\mathcal{N}(0, K_r)$，我们可以通过在后验均值的表达式中直接用 $K_r$ 替换 $K$ 来推导出相应的后验均值 $m_r$：\n$$\nm_r = K_r H^\\top (H K_r H^\\top + R)^{-1} y.\n$$\n两个边界情况需要注意。对于 $r=0$，截断协方差 $K_0$ 是零矩阵。这对应于一个先验信念，即确信 $u=0$。该公式得出 $m_0 = \\mathbf{0}_{N \\times N} H^\\top (H \\mathbf{0}_{N \\times N} H^\\top + R)^{-1} y = 0$。对于 $r=N$，$K_N$ 是 $K$ 的全秩重构。因此，$K_N = K$ (在数值精度范围内)，这意味着 $m_N = m_{\\text{full}}$。\n\n截断后验均值的相对误差使用指定的离散欧几里得范数 ($L_2$-范数) 进行评估：\n$$\ne_r = \\frac{\\lVert m_{\\text{full}} - m_r \\rVert_2}{\\lVert m_{\\text{full}} \\rVert_2}.\n$$\n对于 $r=0$，$m_0=0$，因此 $e_0=1$。对于 $r=N$，$m_N \\approx m_{\\text{full}}$，因此 $e_N \\approx 0$。\n\n实现过程如下：\n1.  **离散化与数据生成**：将空间域 $[0,1]$ 离散化为 $N=100$ 个点。确定真实场 $u_{\\text{true}}$ 和观测位置。观测算子 $H$ 通过索引选择实现，并形成数据向量 $y = H u_{\\text{true}}$。观测噪声协方差为 $R = \\sigma_{\\text{noise}}^2 I_M$。\n2.  **Matérn 协方差矩阵构造**：计算一个距离矩阵 $D$，其元素为 $D_{ij} = |x_i - x_j|$。对所有非对角元素 ($i \\neq j$)，计算 Matérn 核函数 $k_{\\nu,\\ell,\\sigma}(x_i,x_j)$。对角元素 $K_{ii}$ 设置为 $\\sigma^2$，这与定义以及核函数在 $|x_i - x_j| \\to 0$ 时的极限一致。\n3.  **KL 截断协方差构造**：使用 `numpy.linalg.eigh` 对完整协方差矩阵 $K$ 进行分解，以获得其特征值和特征向量。将特征值按降序排序，并选择前 $r$ 个特征值及其对应的特征向量来构造 $K_r = Q_r \\Lambda_r Q_r^\\top$。对于 $r=0$，$K_r$ 是一个零矩阵；对于 $r=N$，$K_r$ 由全套特征值和特征向量重构而成。\n4.  **后验均值计算**：使用推导出的公式计算均值 $m_{\\text{full}}$ 和 $m_r$。在可能的情况下，使用矩阵-向量积代替显式的矩阵-矩阵积，并使用 `numpy.linalg.solve` 求解线性系统，以获得比直接求逆更好的数值稳定性。具体来说，为了计算像 $A B^{-1} c$ 这样的项，我们求解 $Bx=c$ 得到 $x$，然后计算 $Ax$。\n5.  **误差评估**：根据定义的公式，使用 `numpy.linalg.norm` 计算相对误差 $e_r$。对每个测试用例重复此过程。",
            "answer": "[0.076829,1.000000,0.000000,0.706846,0.001662]"
        }
    ]
}