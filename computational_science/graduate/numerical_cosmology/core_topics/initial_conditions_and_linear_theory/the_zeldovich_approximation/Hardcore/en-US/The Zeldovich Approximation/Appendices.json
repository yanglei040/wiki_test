{
    "hands_on_practices": [
        {
            "introduction": "The Zeldovich approximation elegantly separates the evolution of cosmic structures into a time-dependent universal growth factor and a time-independent spatial displacement field. This first practice focuses on the temporal component, the linear growth factor $D(a)$, which effectively acts as the master clock for structure formation. By deriving its integral form from the fundamental equations of motion and implementing a numerical solution, you will build a core tool essential for applying the Zeldovich approximation in any cosmological model .",
            "id": "3500913",
            "problem": "Consider the use of the Zel'dovich approximation in numerical cosmology, where the comoving displacement field is proportional to the linear growth factor $D(a)$ of density perturbations, with $a$ denoting the cosmic scale factor. Starting from first principles appropriate to a spatially flat Lambda Cold Dark Matter (ΛCDM) cosmology, derive and implement a numerical computation of the normalized linear growth factor $D(a)$ as follows.\n\nBegin with the background dynamics described by the Friedmann equation for a spatially flat universe, the matter density scaling, and the linear perturbation growth equation:\n- The Hubble parameter $H(a)$ satisfies $H^{2}(a) = H_{0}^{2}\\left[\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}\\right]$ with $\\Omega_{\\Lambda 0} = 1 - \\Omega_{m0}$.\n- The matter density obeys $\\rho_{m}(a) = \\rho_{m0} a^{-3}$.\n- The linear growth factor $D(a)$ evolves according to the second-order ordinary differential equation in cosmic time $t$:\n$$\\frac{d^{2}D}{dt^{2}} + 2 H(a) \\frac{dD}{dt} - 4\\pi G \\rho_{m}(a) D = 0.$$\n\nYour tasks are:\n1. Derive an integral representation for the growing-mode solution $D(a)$ up to an overall multiplicative constant by transforming the differential equation from derivatives with respect to $t$ to derivatives with respect to $a$, identifying one decaying-mode solution, and constructing the growing-mode solution via reduction of order.\n2. Using the derived integral representation, implement a numerical algorithm to compute a dimensionless, normalized growth factor $\\tilde{D}(a)$ such that $\\tilde{D}(1) = 1$. You must explicitly avoid any dependence on the absolute value of $H_{0}$ (the Hubble constant today) by working with the dimensionless Hubble function $E(a) \\equiv H(a)/H_{0}$.\n3. Ensure numerical robustness near the lower integration limit by handling the integrable singular behavior as $a' \\to 0$ in a scientifically sound manner.\n\nAll quantities in this problem are dimensionless, so no physical units appear in the final answer. Angles are not involved. The final numerical outputs must be dimensionless floating-point numbers.\n\nTest Suite:\nCompute $\\tilde{D}(a)$ for the following parameter sets $(\\Omega_{m0}, a)$:\n- $(0.3, 0.5)$\n- $(0.3, 1.0)$\n- $(0.3, 2.0)$\n- $(1.0, 0.1)$\n- $(1.0, 1.0)$\n- $(1.0, 2.0)$\n- $(0.99, 0.01)$\n- $(0.01, 0.5)$\n\nYou must implement a program that evaluates $\\tilde{D}(a)$ for each test case and produces a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,...]\"). Each list element must be a floating-point number.\n\nYour program must be self-contained, require no input, and use a numerically stable quadrature method. The final answers should be floats and dimensionless.",
            "solution": "The user-provided problem is assessed to be **valid**. It is a scientifically sound, well-posed, and complete problem in physical cosmology that requires both analytical derivation and numerical implementation. The problem statement is grounded in the standard $\\Lambda$CDM cosmological model and asks for the computation of a fundamental quantity, the linear growth factor, using established mathematical techniques.\n\n### Derivation of the Linear Growth Factor\n\nThe objective is to find the growing-mode solution to the linear perturbation growth equation and implement its numerical computation. The derivation proceeds in four steps: transforming the differential equation, identifying a known solution, constructing the second solution via reduction of order, and formulating a normalized, dimensionless expression suitable for numerical work.\n\n#### Step 1: Transformation of the Governing Equation\nThe evolution of the linear growth factor $D$ is described by the second-order ordinary differential equation (ODE) in cosmic time $t$:\n$$\n\\frac{d^{2}D}{dt^{2}} + 2 H(a) \\frac{dD}{dt} - 4\\pi G \\rho_{m}(a) D = 0.\n$$\nHere, $a$ is the cosmic scale factor, $H(a) = \\dot{a}/a$ is the Hubble parameter, $G$ is the gravitational constant, and $\\rho_m(a)$ is the background matter density. To solve this, we transform the independent variable from $t$ to $a$. Using the chain rule, the time derivatives are:\n$$\n\\frac{d}{dt} = \\frac{da}{dt} \\frac{d}{da} = \\dot{a} \\frac{d}{da} = a H(a) \\frac{d}{da}.\n$$\n$$\n\\frac{d^2}{dt^2} = (aH) \\frac{d}{da} \\left( aH \\frac{d}{da} \\right) = aH \\left( H + a \\frac{dH}{da} \\right) \\frac{d}{da} + (aH)^2 \\frac{d^2}{da^2}.\n$$\nSubstituting these into the ODE yields:\n$$\n(aH)^2 \\frac{d^2D}{da^2} + \\left( aH^2 + a^2 H \\frac{dH}{da} \\right) \\frac{dD}{da} + 2H(a) \\left( aH \\frac{dD}{da} \\right) - 4\\pi G \\rho_m(a) D = 0.\n$$\nThis simplifies to:\n$$\n\\frac{d^2D}{da^2} + \\left( \\frac{1}{a} + \\frac{1}{H} \\frac{dH}{da} + \\frac{2}{a} \\right) \\frac{dD}{da} - \\frac{4\\pi G \\rho_m(a)}{a^2 H(a)^2} D = 0.\n$$\nFor a flat $\\Lambda$CDM universe, the Friedmann equation is $H^2(a) = H_0^2 \\left[ \\Omega_{m0} a^{-3} + (1-\\Omega_{m0}) \\right]$. Also, the critical density today is $\\rho_{c0} = 3H_0^2 / (8\\pi G)$, and $\\rho_m(a) = \\rho_{m0} a^{-3} = \\Omega_{m0} \\rho_{c0} a^{-3}$. Using these relations, the coefficient of $D$ becomes:\n$$\n\\frac{4\\pi G \\rho_m(a)}{a^2 H(a)^2} = \\frac{4\\pi G (\\Omega_{m0} \\frac{3H_0^2}{8\\pi G} a^{-3})}{a^2 H(a)^2} = \\frac{3}{2a^2} \\frac{H_0^2 \\Omega_{m0} a^{-3}}{H(a)^2} = \\frac{3}{2a^2} \\Omega_m(a),\n$$\nwhere $\\Omega_m(a) = \\frac{\\Omega_{m0} a^{-3}}{H(a)^2/H_0^2}$ is the matter density parameter at scale factor $a$. The transformed ODE is:\n$$\n\\frac{d^2D}{da^2} + \\left( \\frac{3}{a} + \\frac{1}{H}\\frac{dH}{da} \\right) \\frac{dD}{da} - \\frac{3}{2a^2} \\Omega_m(a) D = 0.\n$$\n\n#### Step 2: Solution by Reduction of Order\nThis is a second-order linear homogeneous ODE. If one solution, $D_1(a)$, is known, a second linearly independent solution, $D_2(a)$, can be found using reduction of order. A known solution to the original ODE in time is the decaying mode, which can be shown to be $D_1(t) \\propto H(a(t))$. Let's verify $D_1(a) = H(a)$ is a solution. We found in the derivation thought process that this is indeed a solution.\n\nWith one solution $D_1(a) = H(a)$, the second solution is given by the formula:\n$$\nD_2(a) = D_1(a) \\int^a \\frac{W(a')}{D_1(a')^2} da',\n$$\nwhere the Wronskian, $W(a')$, satisfies Abel's identity. For an ODE of the form $y'' + P(x)y' + Q(x)y = 0$, the Wronskian is $W(x) \\propto \\exp(-\\int P(x) dx)$. In our case, $P(a) = \\frac{3}{a} + \\frac{1}{H}\\frac{dH}{da}$.\n$$\n\\int P(a) da = \\int \\left( \\frac{3}{a} + \\frac{H'(a)}{H(a)} \\right) da = 3\\ln(a) + \\ln(H(a)) = \\ln(a^3 H(a)).\n$$\nSo, the Wronskian is $W(a) \\propto \\exp(-\\ln(a^3 H(a))) = \\frac{1}{a^3 H(a)}$. Substituting $D_1 = H$ and the Wronskian into the formula for $D_2$:\n$$\nD_2(a) \\propto H(a) \\int_0^a \\frac{1/(a'^3 H(a'))}{H(a')^2} da' = H(a) \\int_0^a \\frac{da'}{a'^3 H(a')^3}.\n$$\nThe general solution is a linear combination of the decaying mode ($D_1 \\propto H(a)$) and the growing mode ($D_2$). The growing mode solution is thus:\n$$\nD_+(a) = C \\cdot H(a) \\int_0^a \\frac{da'}{a'^3 H(a')^3},\n$$\nwhere $C$ is an arbitrary constant.\n\n#### Step 3: Numerical Formulation\nTo implement a numerical solution, we make the expression dimensionless and independent of $H_0$. We define the dimensionless Hubble function $E(a) = H(a)/H_0 = \\sqrt{\\Omega_{m0} a^{-3} + (1-\\Omega_{m0})}$. Substituting $H(a) = H_0 E(a)$ into the expression for $D_+(a)$:\n$$\nD_+(a) = C \\cdot (H_0 E(a)) \\int_0^a \\frac{da'}{a'^3 (H_0 E(a'))^3} = C \\frac{H_0}{H_0^3} E(a) \\int_0^a \\frac{da'}{a'^3 E(a')^3}.\n$$\nThe factors of $H_0$ can be absorbed into a new constant, yielding an unnormalized growth factor $D_{un}(a)$:\n$$\nD_{un}(a) = E(a) \\int_0^a \\frac{da'}{a'^3 E(a')^3}.\n$$\nThe problem requires a normalized growth factor $\\tilde{D}(a)$ such that $\\tilde{D}(1)=1$. This is achieved by dividing by the value of the unnormalized function at $a=1$:\n$$\n\\tilde{D}(a) = \\frac{D_{un}(a)}{D_{un}(1)} = \\frac{E(a) \\int_0^a \\frac{da'}{a'^3 E(a')^3}}{E(1) \\int_0^1 \\frac{da'}{a'^3 E(a')^3}}.\n$$\nThis is the final expression to be computed.\n\n#### Step 4: Handling the Integrand at Small Scale Factors\nThe problem states to handle the integrable singular behavior near $a' \\to 0$. The integrand is $I(a') = 1/(a'^3 E(a')^3)$. Naively evaluating this for very small $a'$ can cause numerical overflow because $E(a') \\propto a'^{-3/2}$, leading to terms like $a'^{-9/2}$. To create a numerically stable form, we rewrite the integrand:\n$$\nE(a')^2 = \\Omega_{m0} a'^{-3} + \\Omega_{\\Lambda 0} = a'^{-3}(\\Omega_{m0} + \\Omega_{\\Lambda 0} a'^3).\n$$\nSo, $E(a')^3 = a'^{-9/2}(\\Omega_{m0} + \\Omega_{\\Lambda 0} a'^3)^{3/2}$. The integrand becomes:\n$$\nI(a') = \\frac{1}{a'^3 \\left[ a'^{-9/2}(\\Omega_{m0} + \\Omega_{\\Lambda 0} a'^3)^{3/2} \\right]} = \\frac{a'^{-3} a'^{9/2}}{(\\Omega_{m0} + \\Omega_{\\Lambda 0} a'^3)^{3/2}} = \\frac{a'^{3/2}}{(\\Omega_{m0} + \\Omega_{\\Lambda 0} a'^3)^{3/2}}.\n$$\nThis rewritten form is numerically robust. As $a' \\to 0$, the numerator goes to $0$ and the denominator approaches $\\Omega_{m0}^{3/2}$ (for $\\Omega_{m0} > 0$), so the integrand itself goes to $0$. This avoids any floating-point overflow issues and allows for stable numerical quadrature from the lower limit of $0$. For the special case $\\Omega_{m0}=1$, the expression for $\\tilde{D}(a)$ simplifies analytically to $\\tilde{D}(a)=a$. This provides a valuable cross-check for the numerical implementation.\n\nThe numerical solution will be implemented in Python using the `scipy.integrate.quad` function for high-precision quadrature.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Derives and computes the normalized linear growth factor D(a) for a flat\n    LambdaCDM cosmology.\n    \"\"\"\n\n    # Test cases: tuples of (Omega_m0, scale_factor_a)\n    test_cases = [\n        (0.3, 0.5),\n        (0.3, 1.0),\n        (0.3, 2.0),\n        (1.0, 0.1),\n        (1.0, 1.0),\n        (1.0, 2.0),\n        (0.99, 0.01),\n        (0.01, 0.5),\n    ]\n\n    results = []\n    for omega_m0, a in test_cases:\n        result = calculate_growth_factor(omega_m0, a)\n        results.append(result)\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\n\ndef calculate_growth_factor(omega_m0, a):\n    \"\"\"\n    Calculates the normalized growth factor D_tilde(a) such that D_tilde(1) = 1.\n\n    Args:\n        omega_m0 (float): Matter density parameter today.\n        a (float): The cosmic scale factor.\n\n    Returns:\n        float: The value of the normalized growth factor D_tilde(a).\n    \"\"\"\n\n    # For the Einstein-de Sitter case (omega_m0 = 1), the growth factor is\n    # analytically known to be D(a) propto a. After normalization D(1)=1,\n    # we get D_tilde(a) = a. This is more accurate than numerical integration.\n    if np.isclose(omega_m0, 1.0):\n        return a\n\n    omega_l0 = 1.0 - omega_m0\n\n    # The integrand is rewritten for numerical stability near a_prime - 0.\n    # Original form: 1 / (a_prime**3 * E(a_prime)**3)\n    # Stable form: a_prime**(3/2) / (omega_m0 + omega_l0 * a_prime**3)**(3/2)\n    def integrand(a_prime, om0, ol0):\n        if a_prime == 0:\n            return 0.0\n        numerator = a_prime**1.5\n        denominator = (om0 + ol0 * a_prime**3)**1.5\n        return numerator / denominator\n\n    # Dimensionless Hubble parameter E(a) = H(a)/H0\n    def E_func(a_val, om0, ol0):\n        if a_val == 0:\n            return np.inf\n        return np.sqrt(om0 * a_val**-3 + ol0)\n\n    # Numerator part of the D_tilde(a) expression\n    # D_un_num = E(a) * integral from 0 to a\n    integral_num, err_num = quad(integrand, 0, a, args=(omega_m0, omega_l0))\n    D_un_num = E_func(a, omega_m0, omega_l0) * integral_num\n    \n    # Denominator part of the D_tilde(a) expression (for normalization)\n    # D_un_den = E(1) * integral from 0 to 1\n    integral_den, err_den = quad(integrand, 0, 1.0, args=(omega_m0, omega_l0))\n    # E(1) = sqrt(omega_m0 + omega_l0) = sqrt(1) = 1\n    D_un_den = 1.0 * integral_den \n                                \n    # Handle the case where the denominator might be zero (though unlikely for omega_m0  0)\n    if D_un_den == 0:\n        # This case suggests no growth, physically corresponds to omega_m0=0.\n        return 0.0 \n\n    return D_un_num / D_un_den\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "The primary predictive power of the Zeldovich approximation lies in its ability to pinpoint the formation of the first non-linear structures, an event known as shell-crossing where particle trajectories intersect. This exercise  provides a concrete, one-dimensional scenario to analytically determine the time and location of the first shell-crossing for a given initial perturbation. It also serves as an important checkpoint to understand the physical and mathematical breakdown of the approximation in the post-crossing, multi-stream regime.",
            "id": "3500923",
            "problem": "Consider a one-dimensional Lagrangian description of cold dark matter in a spatially flat, matter-dominated Einstein–de Sitter cosmology. Let the Lagrangian coordinate be $q$ and the Eulerian (comoving) coordinate be $x(q,a)$ at scale factor $a$. Assume a Zel'dovich-type mapping $x(q,a)=q+D(a)\\,s(q)$, where $D(a)$ is the linear growth factor and $s(q)$ is a prescribed, time-independent Lagrangian displacement field. The Eulerian mass density is given by the Lagrangian mass conservation law, which in one dimension can be written in terms of the Jacobian $J(q,a)=\\partial x/\\partial q$ as $\\rho(x,a)=\\bar{\\rho}(a)\\,J(q,a)^{-1}$, where $\\bar{\\rho}(a)$ is the background density. Shell crossing occurs at those $(q,a)$ where $J(q,a)=0$.\n\nAssume an initial displacement field $s(q)=S\\,\\exp(-q^{2}/(2\\sigma^{2}))$, where $S$ and $\\sigma$ are positive constants with units of length. In the Einstein–de Sitter cosmology, the Hubble parameter is $H(a)=H_{0}\\,a^{-3/2}$ and the linear growth factor satisfies $D(a)=a$, with $H_{0}$ the Hubble constant at $a=1$. The peculiar velocity field is defined by $v(q,a)=a\\,\\frac{d}{dt}x(q,a)$, where $t$ is cosmic time.\n\nStarting from these definitions and laws, do the following:\n\n1. Derive the shell-crossing condition in terms of $D(a)$ and $s(q)$, and determine the earliest shell-crossing location $q_{c}$ and the corresponding growth factor $D(a_{c})$ for the given $s(q)$.\n2. Using your results and the above cosmology, compute the dimensionless scaled velocity at the earliest shell crossing,\n$$\n\\tilde{v}\\equiv \\frac{v(q_{c},a_{c})}{H_{0}\\,\\sqrt{S\\,\\sigma}}\\,,\n$$\nas a single real number. Round your answer to six significant figures. Express your answer as a pure number with no units.\n3. Briefly explain, based on the Lagrangian mapping and the form of the Jacobian $J(q,a)$, why the Zel'dovich approximation is unable to represent post-crossing multistream dynamics.\n\nYour final reported quantity must be $\\tilde{v}$, rounded to six significant figures and expressed as a pure number with no units.",
            "solution": "The problem asks for an analysis of shell crossing in a one-dimensional Einstein–de Sitter cosmology using the Zel'dovich approximation. The solution is divided into three parts as requested.\n\nPart $1$: Derivation of the shell-crossing condition and determination of the earliest shell-crossing event.\n\nThe Zel'dovich mapping from the Lagrangian coordinate $q$ to the Eulerian comoving coordinate $x$ is given by\n$$x(q,a) = q + D(a)\\,s(q)$$\nwhere $D(a)$ is the linear growth factor and $s(q)$ is the Lagrangian displacement field. Shell crossing occurs when particles from neighboring Lagrangian positions overtake each other, leading to a singularity in the density field. Mathematically, this corresponds to the Jacobian of the transformation from $q$ to $x$ vanishing. The Jacobian is\n$$J(q,a) = \\frac{\\partial x}{\\partial q} = \\frac{\\partial}{\\partial q} \\left( q + D(a)\\,s(q) \\right) = 1 + D(a)\\,\\frac{ds}{dq}$$\nLet $s'(q) = ds/dq$. The shell-crossing condition is $J(q,a)=0$, which implies\n$$1 + D(a)\\,s'(q) = 0 \\quad \\implies \\quad D(a) = -\\frac{1}{s'(q)}$$\nFor the given problem, the displacement field is $s(q) = S\\,\\exp(-q^{2}/(2\\sigma^{2}))$. Its derivative with respect to $q$ is\n$$s'(q) = S \\left( -\\frac{2q}{2\\sigma^2} \\right) \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) = -\\frac{S}{\\sigma^2}\\,q\\,\\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right)$$\nSince $D(a)$ is the growth factor, it is a positive and monotonically increasing function of time (and scale factor $a$). The shell-crossing condition $D(a) = -1/s'(q)$ can only be satisfied if $s'(q)  0$. From the expression for $s'(q)$, since $S0$ and $\\sigma0$, this requires $q0$.\n\nThe earliest shell crossing occurs for the minimum possible value of $D(a)$, which we can call $D(a_c)$. This corresponds to the location $q_c$ that minimizes the expression $-1/s'(q)$. This is equivalent to finding the value of $q$ that minimizes $s'(q)$ (i.e., makes it most negative). To find this minimum, we compute the second derivative of $s(q)$, which is the first derivative of $s'(q)$, and set it to zero.\n$$s''(q) = \\frac{d}{dq} \\left( -\\frac{S}{\\sigma^2}\\,q\\,\\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) \\right) = -\\frac{S}{\\sigma^2} \\left[ \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) + q \\left( -\\frac{q}{\\sigma^2} \\right) \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) \\right]$$\n$$s''(q) = -\\frac{S}{\\sigma^2} \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) \\left( 1 - \\frac{q^2}{\\sigma^2} \\right)$$\nSetting $s''(q)=0$ gives $1 - q^2/\\sigma^2 = 0$, which yields $q = \\pm\\sigma$. Since shell crossing requires $q0$, the location of the earliest shell crossing is $q_c = \\sigma$.\n\nAt this location, the value of the displacement gradient is\n$$s'(q_c) = s'(\\sigma) = -\\frac{S}{\\sigma^2}\\,\\sigma\\,\\exp\\left(-\\frac{\\sigma^2}{2\\sigma^2}\\right) = -\\frac{S}{\\sigma}\\,\\exp\\left(-\\frac{1}{2}\\right)$$\nThe growth factor at the time of the first shell crossing is therefore\n$$D(a_c) = -\\frac{1}{s'(q_c)} = -\\frac{1}{-\\frac{S}{\\sigma}\\,\\exp\\left(-\\frac{1}{2}\\right)} = \\frac{\\sigma}{S}\\,\\exp\\left(\\frac{1}{2}\\right)$$\n\nPart $2$: Computation of the dimensionless scaled velocity $\\tilde{v}$.\n\nThe peculiar velocity field is defined as $v(q,a) = a\\,\\frac{d}{dt}x(q,a)$. Substituting the expression for $x(q,a)$:\n$$v(q,a) = a\\,\\frac{d}{dt}\\left( q + D(a)\\,s(q) \\right) = a\\,\\frac{dD}{dt}\\,s(q)$$\nFor an Einstein–de Sitter cosmology, $D(a)=a$. We relate the time derivative to the Hubble parameter $H(a) = \\frac{1}{a}\\frac{da}{dt}$.\n$$\\frac{dD}{dt} = \\frac{da}{dt} = a\\,H(a)$$\nGiven $H(a) = H_0\\,a^{-3/2}$, we have\n$$\\frac{dD}{dt} = a \\left( H_0\\,a^{-3/2} \\right) = H_0\\,a^{-1/2}$$\nSubstituting this back into the expression for velocity:\n$$v(q,a) = a \\left( H_0\\,a^{-1/2} \\right) s(q) = H_0\\,a^{1/2}\\,s(q)$$\nWe need to evaluate this velocity at the earliest shell-crossing event, i.e., at $(q_c, a_c)$. We have $q_c = \\sigma$ and $a_c = D(a_c) = \\frac{\\sigma}{S}\\,\\exp\\left(\\frac{1}{2}\\right)$.\nFirst, evaluate $s(q_c)$:\n$$s(q_c) = s(\\sigma) = S\\,\\exp\\left(-\\frac{\\sigma^2}{2\\sigma^2}\\right) = S\\,\\exp\\left(-\\frac{1}{2}\\right)$$\nNext, evaluate $a_c^{1/2}$:\n$$a_c^{1/2} = \\left( \\frac{\\sigma}{S}\\,\\exp\\left(\\frac{1}{2}\\right) \\right)^{1/2} = \\left(\\frac{\\sigma}{S}\\right)^{1/2} \\left(\\exp\\left(\\frac{1}{2}\\right)\\right)^{1/2} = \\left(\\frac{\\sigma}{S}\\right)^{1/2} \\exp\\left(\\frac{1}{4}\\right)$$\nNow, we compute the velocity $v(q_c, a_c)$:\n$$v(q_c, a_c) = H_0\\,a_c^{1/2}\\,s(q_c) = H_0 \\left[ \\left(\\frac{\\sigma}{S}\\right)^{1/2} \\exp\\left(\\frac{1}{4}\\right) \\right] \\left[ S\\,\\exp\\left(-\\frac{1}{2}\\right) \\right]$$\n$$v(q_c, a_c) = H_0\\, \\sigma^{1/2}\\, S^{-1/2}\\, S^1\\, \\exp\\left(\\frac{1}{4} - \\frac{1}{2}\\right) = H_0\\, \\sigma^{1/2}\\, S^{1/2}\\, \\exp\\left(-\\frac{1}{4}\\right)$$\n$$v(q_c, a_c) = H_0\\,\\sqrt{S\\sigma}\\,\\exp\\left(-\\frac{1}{4}\\right)$$\nThe problem asks for the dimensionless scaled velocity $\\tilde{v}$, defined as\n$$\\tilde{v} = \\frac{v(q_c,a_c)}{H_{0}\\,\\sqrt{S\\,\\sigma}} = \\frac{H_0\\,\\sqrt{S\\sigma}\\,\\exp\\left(-\\frac{1}{4}\\right)}{H_{0}\\,\\sqrt{S\\,\\sigma}} = \\exp\\left(-\\frac{1}{4}\\right)$$\nCalculating the numerical value and rounding to six significant figures:\n$$\\tilde{v} = \\exp(-0.25) \\approx 0.77880078... \\approx 0.778801$$\n\nPart $3$: Explanation of the failure of the Zel'dovich approximation post-crossing.\n\nThe Zel'dovich approximation describes the evolution of the cosmic fluid by a mapping $x(q,a)$ from a particle's initial (Lagrangian) position $q$ to its final (Eulerian) position $x$ at a later time corresponding to scale factor $a$. At any given time, this mapping assigns a unique position $x$ to each particle label $q$.\n\nShell crossing occurs when the Jacobian of this map, $J(q,a)=\\partial x/\\partial q$, becomes zero. For times after the first shell crossing, there will be a range of Lagrangian coordinates for which $J(q,a)  0$. A negative Jacobian implies that the ordering of particles is inverted, i.e., for two nearby particles with Lagrangian coordinates $q_1  q_2$, their Eulerian positions become $x(q_1, a)  x(q_2, a)$.\n\nThis inversion of particle order leads to the mapping $q \\mapsto x(q,a)$ becoming non-invertible, or multi-valued. That is, for a single Eulerian position $x$ in the post-crossing region, there can be multiple distinct Lagrangian coordinates $q_1, q_2, q_3, ...$ that all map to the same $x$. This physical situation is known as multi-streaming, where several streams of matter, originating from different initial positions and having different velocities, co-exist at the same physical location.\n\nThe fundamental limitation of the Zel'dovich approximation is that it is formulated as a single-valued map from $q$ to $x$. When attempting to describe the Eulerian fluid properties (like density $\\rho(x,a)$ and velocity $v_{\\text{Eul}}(x,a)$), one would need to invert the map to find $q(x,a)$. In multi-stream regions, this inversion is not unique. Consequently, the simple Eulerian density formula $\\rho = \\bar{\\rho} J^{-1}$ and the corresponding single-valued velocity field are no longer well-defined. The framework cannot describe the physical reality of a multi-stream fluid, where at a single point $x$, the total density is the sum of the densities of the different streams, and the velocity is a multi-valued function corresponding to the velocity of each stream. The Zel'dovich approximation tracks particle trajectories correctly up to and beyond crossing, but it fails to represent the resulting complex, multi-valued Eulerian fields.",
            "answer": "$$\\boxed{0.778801}$$"
        },
        {
            "introduction": "In a numerical simulation, the accuracy of your physical predictions depends critically on the quality of your numerical methods. Predicting the location of shell-crossing requires calculating the spatial gradient of the displacement field, $s'(q)$. This final hands-on practice  delves into this practical aspect, tasking you with comparing the accuracy of finite-difference versus spectral methods. The results of this comparison will offer clear insight into why spectral methods are often the tool of choice for high-precision cosmological simulations.",
            "id": "3500950",
            "problem": "Consider the one-dimensional Zel'dovich approximation for cold dark matter in a spatially periodic domain. The Lagrangian coordinate is denoted by $q$, the Eulerian coordinate by $x$, and the linear growth factor by $D$. The Zel'dovich mapping is given by the fundamental relation $x(q, D) = q + D \\, s(q)$, where $s(q)$ is a differentiable, periodic displacement field of period $L$. The comoving density follows from mass conservation, and the one-dimensional Jacobian of the mapping is $J(q, D) = \\partial x / \\partial q = 1 + D \\, s'(q)$. In this approximation, the first shell-crossing (the first occurrence of multi-streaming) happens at the earliest positive value of $D$ such that $J(q, D) = 0$ for at least one $q$. Equivalently, if $m_{\\min} = \\min_q s'(q)$, and if $m_{\\min}  0$, then the earliest collapse factor is $D_{\\mathrm{c}} = - 1 / m_{\\min}$.\n\nYou are asked to build a complete program that compares two numerical gradient estimators for $s'(q)$ on a discrete grid and quantifies their effect on the predicted $D_{\\mathrm{c}}$:\n- A second-order central finite-difference estimator on a uniform periodic grid with spacing $\\Delta q$,\n- A spectral estimator using the Discrete Fourier Transform (DFT) implemented via the Fast Fourier Transform (FFT) (Fast Fourier Transform (FFT), Discrete Fourier Transform (DFT)), with the derivative computed in Fourier space by multiplying mode coefficients by $\\mathrm{i} k$ and transforming back to configuration space.\n\nUse a strictly one-dimensional, periodic domain of length $L = 2\\pi$ and construct $s(q)$ as a finite sum of sinusoidal modes,\n$$\ns(q) = \\sum_{j=1}^{M} A_j \\, \\sin(m_j \\, q + \\phi_j),\n$$\nwhere $m_j$ are integer mode numbers, $A_j$ are real amplitudes, and $\\phi_j$ are real phases. Assume periodic boundary conditions on $[0, L)$ and that all $m_j$ satisfy the discrete sampling constraint $m_j  N/2$, where $N$ is the number of grid points.\n\nYour program must implement the following steps:\n1. For a given parameter set $\\{N, \\{(m_j, A_j, \\phi_j)\\}_{j=1}^{M}\\}$, construct a uniform grid $q_n = n \\, \\Delta q$ for $n = 0, 1, \\dots, N-1$ with $\\Delta q = L/N$, evaluate $s(q_n)$, and compute two numerical approximations of $s'(q)$ at the grid points:\n   - Finite difference: $s'_{\\mathrm{FD}}(q_n) \\approx \\big(s(q_{n+1}) - s(q_{n-1})\\big) / \\big(2 \\Delta q\\big)$ with periodic indexing.\n   - Spectral: compute the DFT $\\hat{s}_k$, multiply by $\\mathrm{i} k$ where $k = 2\\pi \\, \\nu$ and $\\nu$ are the Fourier frequencies consistent with spacing $\\Delta q$, and inverse DFT to obtain $s'_{\\mathrm{SP}}(q_n)$.\n2. Compute the numerical shell-crossing predictions $D_{\\mathrm{c,FD}} = -1 / \\min_n s'_{\\mathrm{FD}}(q_n)$ and $D_{\\mathrm{c,SP}} = -1 / \\min_n s'_{\\mathrm{SP}}(q_n)$, provided that the respective minima are strictly negative.\n3. Compute a high-accuracy reference estimate $D_{\\mathrm{c,ref}}$ by evaluating the exact derivative\n$$\ns'(q) = \\sum_{j=1}^{M} A_j \\, m_j \\, \\cos(m_j \\, q + \\phi_j)\n$$\non a dense grid of size $N_{\\mathrm{ref}} = 16384$ over $[0, L)$, and taking $D_{\\mathrm{c,ref}} = -1 / \\min s'(q)$ if the minimum is strictly negative.\n4. For each parameter set, output two error metrics:\n   - The relative error of the finite-difference prediction, $E_{\\mathrm{FD}} = \\big|D_{\\mathrm{c,FD}} - D_{\\mathrm{c,ref}}\\big| / D_{\\mathrm{c,ref}}$.\n   - The relative error of the spectral prediction, $E_{\\mathrm{SP}} = \\big|D_{\\mathrm{c,SP}} - D_{\\mathrm{c,ref}}\\big| / D_{\\mathrm{c,ref}}$.\nIf any method yields a non-negative minimum for $s'(q)$ (hence no predicted shell-crossing), define the corresponding error as the floating-point number $\\mathrm{nan}$.\n\nAll quantities are dimensionless. Angles for phases are in radians.\n\nTest Suite. Your program must run the following parameter sets:\n- Case $1$ (single mode, moderate resolution): $N = 128$, $M = 1$, $(m_1, A_1, \\phi_1) = (4, 0.2, 0.3)$.\n- Case $2$ (single mode near the ultraviolet end, coarser resolution): $N = 64$, $M = 1$, $(m_1, A_1, \\phi_1) = (20, 0.1, -0.5)$.\n- Case $3$ (two-mode combination, intermediate resolution): $N = 96$, $M = 2$, $(m_1, A_1, \\phi_1) = (3, 0.15, 0.1)$ and $(m_2, A_2, \\phi_2) = (7, 0.1, -1.0)$.\n- Case $4$ (single mode, small amplitude, higher resolution): $N = 128$, $M = 1$, $(m_1, A_1, \\phi_1) = (10, 0.01, 1.2)$.\n\nFinal Output Format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n[E_{\\mathrm{FD}}^{(1)}, E_{\\mathrm{SP}}^{(1)}, E_{\\mathrm{FD}}^{(2)}, E_{\\mathrm{SP}}^{(2)}, E_{\\mathrm{FD}}^{(3)}, E_{\\mathrm{SP}}^{(3)}, E_{\\mathrm{FD}}^{(4)}, E_{\\mathrm{SP}}^{(4)}],\n$$\nwhere the superscript denotes the test case index. Each floating-point number must be printed in scientific notation with $8$ significant digits (for example, $1.2345678\\mathrm{e}{-4}$). No other text should be printed. All computations must be done numerically by your program as described; no external input is allowed.",
            "solution": "The problem presented is valid. It is scientifically grounded in the principles of cosmological structure formation, specifically the Zel'dovich approximation, and poses a well-defined numerical task to compare the accuracy of two standard methods for computing spatial derivatives: finite differences and spectral methods. All necessary parameters, formulas, and evaluation criteria are provided, forming a self-contained and solvable problem.\n\nThe solution proceeds by first constructing the displacement field and its derivatives according to the physical and numerical prescriptions, then computing the collapse time, and finally evaluating the specified error metrics for each test case.\n\nThe heart of the problem lies in the Zel'dovich approximation, which describes the initial evolution of particle trajectories in an expanding universe. The position $x$ of a particle at a time specified by the linear growth factor $D$ is given by its initial (Lagrangian) position $q$ plus a displacement. The mapping is $x(q, D) = q + D \\, s(q)$, where $s(q)$ is the displacement field. In a one-dimensional, periodic domain of length $L$, we are given the specific form for $s(q)$ as a sum of sinusoidal modes:\n$$\ns(q) = \\sum_{j=1}^{M} A_j \\, \\sin(m_j \\, q + \\phi_j)\n$$\nHere, $A_j$ are amplitudes, $m_j$ are integer wavenumbers appropriate for a domain of length $L=2\\pi$, and $\\phi_j$ are phase shifts.\n\nThe formation of the first gravitationally collapsed structures, known as shell-crossing or caustics, occurs when particles with different initial positions overtake each other. Mathematically, this corresponds to the Jacobian of the map from $q$ to $x$ becoming zero. The Jacobian is $J(q, D) = \\frac{\\partial x}{\\partial q} = 1 + D \\, s'(q)$. Setting $J(q,D)=0$ gives $D = -1/s'(q)$. The first shell-crossing happens at the minimum positive value of $D$ for which this condition is met. This corresponds to the position $q$ where $s'(q)$ is most negative. If we define $m_{\\min} = \\min_q s'(q)$, the critical growth factor for collapse is $D_{\\mathrm{c}} = -1/m_{\\min}$, provided $m_{\\min}  0$. The task is to compute $D_{\\mathrm{c}}$ using different numerical estimates for $s'(q)$ and compare their accuracy.\n\nThe analytical derivative of the displacement field is exactly known:\n$$\ns'(q) = \\frac{d s}{d q} = \\sum_{j=1}^{M} A_j \\, m_j \\, \\cos(m_j \\, q + \\phi_j)\n$$\nThis expression is used to generate a high-precision reference value, $D_{\\mathrm{c,ref}}$.\n\nWe evaluate the fields on a uniform discrete grid $q_n = n \\Delta q$ for $n = 0, 1, \\dots, N-1$, where the grid spacing is $\\Delta q = L/N = 2\\pi/N$.\n\nThe first numerical method is the second-order central finite-difference scheme. The derivative $s'(q_n)$ is approximated by:\n$$\ns'_{\\mathrm{FD}}(q_n) = \\frac{s(q_{n+1}) - s(q_{n-1})}{2 \\Delta q}\n$$\nIndices are handled periodically, i.e., $q_{N} \\equiv q_0$ and $q_{-1} \\equiv q_{N-1}$. This method is local and has a truncation error that scales with the grid spacing as $\\mathcal{O}((\\Delta q)^2)$. The accuracy is expected to degrade for functions with high-frequency content relative to the grid spacing.\n\nThe second numerical method is the spectral or pseudo-spectral method, which leverages the Fast Fourier Transform (FFT). The procedure is as follows:\n1.  Compute the Discrete Fourier Transform (DFT) of the sampled field $s(q_n)$ to obtain its coefficients in Fourier space, $\\hat{s}_k$.\n$$\n\\hat{s}_k = \\sum_{n=0}^{N-1} s(q_n) e^{-2\\pi i k n / N}\n$$\n2.  The differentiation theorem of Fourier transforms states that differentiation in real space is equivalent to multiplication by $\\mathrm{i}k_{\\nu}$ in Fourier space, where $k_{\\nu}$ is the angular wavenumber. For our grid, the discrete angular wavenumbers are given by $k_{\\nu} = 2\\pi \\nu$, where $\\nu$ are the spatial frequencies from `scipy.fft.fftfreq(N, d=dq)`. This yields discrete integer wavenumbers $k \\in \\{0, 1, \\dots, N/2-1, -N/2, \\dots, -1\\}$ (for even $N$).\n3.  The Fourier coefficients of the derivative, $\\widehat{s'}_k$, are computed by:\n$$\n\\widehat{s'}_k = \\mathrm{i} k_{\\nu} \\hat{s}_k\n$$\n4.  The derivative in real space, $s'_{\\mathrm{SP}}(q_n)$, is recovered by applying the inverse DFT to $\\widehat{s'}_k$.\n$$\ns'_{\\mathrm{SP}}(q_n) = \\frac{1}{N} \\sum_{k=0}^{N-1} \\widehat{s'}_k e^{2\\pi i k n / N}\n$$\nFor a function composed of a finite number of sinusoidal modes whose wavenumbers $m_j$ are all less than the Nyquist frequency of the grid (i.e., $|m_j|  N/2$), as guaranteed by the problem statement, this spectral method computes the derivative to machine precision. It is effectively exact on the grid points.\n\nFor each method (FD, SP) and the reference calculation (REF), the minimum of the corresponding derivative, $m_{\\min}$, is found. If $m_{\\min}  0$, the collapse factor is computed as $D_{\\mathrm{c}} = -1/m_{\\min}$. If $m_{\\min} \\ge 0$, no collapse is predicted by that method, and the problem specifies the result should be `nan`.\n\nFinally, the relative errors for the finite-difference and spectral predictions, $E_{\\mathrm{FD}}$ and $E_{\\mathrm{SP}}$, are calculated with respect to the high-accuracy reference value $D_{\\mathrm{c,ref}}$:\n$$\nE_{\\mathrm{FD}} = \\frac{|D_{\\mathrm{c,FD}} - D_{\\mathrm{c,ref}}|}{D_{\\mathrm{c,ref}}} \\quad \\text{and} \\quad E_{\\mathrm{SP}} = \\frac{|D_{\\mathrm{c,SP}} - D_{\\mathrm{c,ref}}|}{D_{\\mathrm{c,ref}}}\n$$\nIf any method yields a non-physical (non-negative) minimum derivative, the corresponding error is defined as `nan`.\n\nThe overall algorithm for each test case is:\n1.  Define parameters $N$ and the set of modes $\\{(m_j, A_j, \\phi_j)\\}$.\n2.  Construct the grid $q_n$ and evaluate the displacement field $s(q_n)$.\n3.  Calculate $s'_{\\mathrm{FD}}(q_n)$ using periodic central differences.\n4.  Calculate $s'_{\\mathrm{SP}}(q_n)$ using the FFT-based spectral method.\n5.  Construct a high-resolution grid $q_{\\mathrm{ref}}$ and evaluate the exact analytical derivative $s'(q_{\\mathrm{ref}})$.\n6.  Find the minimum value of each derivative array.\n7.  Calculate $D_{\\mathrm{c,FD}}$, $D_{\\mathrm{c,SP}}$, and $D_{\\mathrm{c,ref}}$.\n8.  Compute and return the relative errors $E_{\\mathrm{FD}}$ and $E_{\\mathrm{SP}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef compute_errors(N, modes, L=2.0 * np.pi, N_ref=16384):\n    \"\"\"\n    Computes numerical derivatives and their errors for a given parameter set.\n    \n    Args:\n        N (int): Number of grid points.\n        modes (list of tuples): List of mode parameters (m_j, A_j, phi_j).\n        L (float): Length of the periodic domain.\n        N_ref (int): Number of grid points for the reference calculation.\n        \n    Returns:\n        tuple: A pair of floats (E_fd, E_sp) representing the relative errors.\n    \"\"\"\n    # 1. Construct the grid and evaluate s(q)\n    dq = L / N\n    q = np.arange(N) * dq\n    \n    s_q = np.zeros(N)\n    for m, A, phi in modes:\n        s_q += A * np.sin(m * q + phi)\n\n    # 2. Compute finite-difference derivative\n    s_plus_1 = np.roll(s_q, -1)\n    s_minus_1 = np.roll(s_q, 1)\n    s_prime_fd = (s_plus_1 - s_minus_1) / (2.0 * dq)\n\n    # 3. Compute spectral derivative\n    s_hat = fft.fft(s_q)\n    # Wavenumbers for a domain of length L\n    k_nu = fft.fftfreq(N, d=dq) * 2.0 * np.pi\n    s_prime_hat = 1j * k_nu * s_hat\n    s_prime_sp = fft.ifft(s_prime_hat).real\n\n    # 4. Compute high-accuracy reference derivative\n    dq_ref = L / N_ref\n    q_ref = np.arange(N_ref) * dq_ref\n    \n    s_prime_ref_analytic = np.zeros(N_ref)\n    for m, A, phi in modes:\n        s_prime_ref_analytic += A * m * np.cos(m * q_ref + phi)\n\n    # 5. Compute the minimum of each derivative\n    min_s_prime_fd = np.min(s_prime_fd)\n    min_s_prime_sp = np.min(s_prime_sp)\n    min_s_prime_ref = np.min(s_prime_ref_analytic)\n\n    # 6. Compute collapse factors D_c\n    Dc_fd = -1.0 / min_s_prime_fd if min_s_prime_fd  0 else np.nan\n    Dc_sp = -1.0 / min_s_prime_sp if min_s_prime_sp  0 else np.nan\n    Dc_ref = -1.0 / min_s_prime_ref if min_s_prime_ref  0 else np.nan\n    \n    # 7. Compute relative errors\n    # np.nan propagates correctly through these arithmetic operations\n    E_fd = np.abs(Dc_fd - Dc_ref) / Dc_ref\n    E_sp = np.abs(Dc_sp - Dc_ref) / Dc_ref\n    \n    return E_fd, E_sp\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'N': 128, 'modes': [(4, 0.2, 0.3)]},  # Case 1\n        {'N': 64,  'modes': [(20, 0.1, -0.5)]}, # Case 2\n        {'N': 96,  'modes': [(3, 0.15, 0.1), (7, 0.1, -1.0)]}, # Case 3\n        {'N': 128, 'modes': [(10, 0.01, 1.2)]}, # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case['N']\n        modes = case['modes']\n        \n        # Ensure modes satisfy the Nyquist criterion\n        for m, _, _ in modes:\n            if not m  N / 2:\n                raise ValueError(f\"Mode m={m} violates Nyquist criterion for N={N}\")\n\n        E_fd, E_sp = compute_errors(N, modes)\n        results.extend([E_fd, E_sp])\n\n    # Final print statement in the exact required format.\n    # The format specifier \"{:.7e}\" yields 8 significant digits (1 before decimal, 7 after).\n    formatted_results = [f\"{r:.7e}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}