{
    "hands_on_practices": [
        {
            "introduction": "To effectively control aliasing, one must first build a concrete intuition for its fundamental mechanism. On a discrete grid, information about frequencies higher than the Nyquist frequency is not lost but is instead \"folded\" back into the observable frequency range, masquerading as lower-frequency modes. This exercise guides you through a direct calculation to trace the journey of a specific out-of-band mode to its aliased location within the principal Brillouin zone, and to quantify the multiplicity of aliasing—the number of distinct high-frequency modes that contaminate a single low-frequency measurement .",
            "id": "3464891",
            "problem": "Consider a three-dimensional periodic cosmological density field in a cubic box of side length $L$, sampled on a uniform Cartesian grid with $N$ points per dimension. Let the grid spacing be $\\Delta x = L/N$. The measured discrete Fourier transform (DFT), computed via the Fast Fourier Transform (FFT), returns Fourier coefficients on the integer wavenumber lattice $\\boldsymbol{r} \\in \\mathbb{Z}^{3}$ restricted to the principal cube $\\boldsymbol{r} \\in [-N/2,N/2)$ in each component for even $N$. The corresponding physical wavevectors are $\\boldsymbol{k} = (2\\pi/L)\\,\\boldsymbol{r}$. Because the field is sampled, the DFT aliases all out-of-band lattice modes $\\boldsymbol{r}_{0} \\notin [-N/2,N/2)$ into the principal cube by identification modulo $N$ along each Cartesian component, a consequence of the sampling theorem and the Poisson summation formula. The mass assignment uses the Cloud-In-Cell (CIC) scheme, and window function deconvolution is performed by dividing the measured spectrum by the Fourier-space CIC window. The CIC window affects amplitudes but does not change the alias mapping between integer lattice indices.\n\nYou are given the following specific setup:\n- The grid has $N = 8$ points in each dimension.\n- The underlying continuous field has support only up to a spherical ultraviolet cutoff $k_{\\mathrm{cut}} = (2\\pi/L)\\,R$ with $R = 10$, i.e., only integer lattice wavevectors $\\boldsymbol{r}_{0}$ with $|\\boldsymbol{r}_{0}|^{2} \\le R^{2}$ can be nonzero, where $|\\cdot|$ denotes the Euclidean norm on the integer lattice.\n- Consider the specific out-of-band mode $\\boldsymbol{k}_{0} = (2\\pi/L)\\,(5,-1,5)$, which lies outside the principal cube because each component $r_{0,i}$ must satisfy $r_{0,i} \\in [-N/2, N/2)$ (with $N/2 = 4$), and here two components are $5$.\n\nTasks:\n1. Using only the foundational facts of DFT sampling and periodic boundary conditions, compute the aliased in-band lattice location $\\boldsymbol{r}_{a}$ to which the integer index $\\boldsymbol{r}_{0}=(5,-1,5)$ maps under aliasing, and hence the physical in-band wavevector $\\boldsymbol{k}_{a} = (2\\pi/L)\\,\\boldsymbol{r}_{a}$.\n2. Within the ultraviolet cutoff $|\\boldsymbol{r}_{0}|^{2} \\le R^{2}$, determine the multiplicity $M$ of distinct out-of-band integer lattice wavevectors $\\boldsymbol{r}_{0}$ that alias to the same $\\boldsymbol{r}_{a}$ when wrapped into the principal cube. Count only out-of-band contributors, i.e., exclude any $\\boldsymbol{r}_{0}$ that already lies in the principal cube.\n3. Express your final answer as a single row matrix containing the three components of $\\boldsymbol{r}_{a}$ followed by the multiplicity $M$.\n\nNo rounding is required. Do not report units in your final answer. The CIC window function and its deconvolution do not alter the mapping of $\\boldsymbol{r}_{0}$ to $\\boldsymbol{r}_{a}$, but they motivate controlling aliasing in numerical cosmology; focus your computations on the alias mapping and multiplicity as defined above.",
            "solution": "The user wants to solve a problem regarding aliasing in the discrete Fourier transform of a cosmological field.\n\n### Problem Validation\n\nFirst, I must validate the problem statement.\n\n**Step 1: Extract Givens**\n-   A three-dimensional periodic cosmological density field is considered in a cubic box of side length $L$.\n-   The field is sampled on a uniform Cartesian grid with $N$ points per dimension.\n-   Grid spacing: $\\Delta x = L/N$.\n-   The DFT is computed via FFT.\n-   Fourier coefficients are on the integer wavenumber lattice $\\boldsymbol{r} \\in \\mathbb{Z}^{3}$.\n-   The principal cube is $\\boldsymbol{r} \\in [-N/2, N/2)$ in each component for even $N$.\n-   Physical wavevectors are $\\boldsymbol{k} = (2\\pi/L)\\,\\boldsymbol{r}$.\n-   Aliasing rule: out-of-band lattice modes $\\boldsymbol{r}_{0} \\notin [-N/2,N/2)$ are mapped into the principal cube by identification modulo $N$ along each Cartesian component.\n-   Mass assignment uses Cloud-In-Cell (CIC), but its effect on amplitudes is to be ignored for this problem.\n-   Grid points per dimension: $N = 8$.\n-   The underlying continuous field has an ultraviolet cutoff $k_{\\mathrm{cut}} = (2\\pi/L)\\,R$ with $R = 10$.\n-   This cutoff means only integer lattice wavevectors $\\boldsymbol{r}_{0}$ with $|\\boldsymbol{r}_{0}|^{2} \\le R^{2}$ can be nonzero.\n-   Specific out-of-band mode to consider: $\\boldsymbol{r}_{0}=(5,-1,5)$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is based on standard, well-established principles of digital signal processing (specifically, the Discrete Fourier Transform) as applied to numerical cosmology. Aliasing, grid sampling, and window functions (like CIC) are fundamental concepts in this field. The setup is scientifically sound.\n-   **Well-Posed:** The problem provides all necessary parameters ($N=8$, $R=10$, and the specific mode $\\boldsymbol{r}_{0}$) and defines all terms (principal cube, aliasing rule) required to find a unique solution. The tasks are specified clearly.\n-   **Objective:** The language is precise and technical, free from subjectivity or ambiguity.\n-   The problem does not violate any of the invalidity criteria listed in the instructions. It is a formalizable and relevant exercise in the specified domain.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with the solution.\n\n### Solution\n\nThe solution is divided into two parts as per the problem tasks.\n\n**Task 1: Compute the aliased in-band lattice location $\\boldsymbol{r}_{a}$**\n\nThe problem states that an out-of-band integer lattice index $\\boldsymbol{r}_{0} = (r_{0,x}, r_{0,y}, r_{0,z})$ is aliased to an in-band index $\\boldsymbol{r}_{a} = (r_{a,x}, r_{a,y}, r_{a,z})$ within the principal cube. The principal cube for an even $N$ is defined as the set of integers in the range $[-N/2, N/2)$ for each component.\n\nGiven $N=8$, the principal range for each component is $[-8/2, 8/2)$, which is $[-4, 4)$. The integers in this range are $\\{-4, -3, -2, -1, 0, 1, 2, 3\\}$.\n\nThe aliasing rule is an identification modulo $N$. An integer $j$ is mapped to a unique integer $j'$ in the range $[-N/2, N/2)$ via the relation $j' = j + mN$ for some integer $m$ that brings the result into the specified range. This is equivalent to finding the remainder of $j$ with respect to $N$ and then adjusting it to the symmetric range. A standard formula for this mapping is $j' = (j + N/2) \\pmod{N} - N/2$. Let's apply this to each component of the given out-of-band mode $\\boldsymbol{r}_{0}=(5,-1,5)$.\n\nFor the x-component, $r_{0,x} = 5$:\n$r_{a,x} = (5 + 8/2) \\pmod{8} - 8/2 = (5+4) \\pmod{8} - 4 = 9 \\pmod{8} - 4 = 1 - 4 = -3$.\nThe value $r_{a,x}=-3$ is in the range $[-4, 3]$.\n\nFor the y-component, $r_{0,y} = -1$:\n$r_{a,y} = (-1 + 8/2) \\pmod{8} - 8/2 = (-1+4) \\pmod{8} - 4 = 3 \\pmod{8} - 4 = 3 - 4 = -1$.\nThe value $r_{a,y}=-1$ is in the range $[-4, 3]$.\n\nFor the z-component, $r_{0,z} = 5$:\nThis is the same as the x-component, so $r_{a,z} = -3$.\nThe value $r_{a,z}=-3$ is in the range $[-4, 3]$.\n\nThus, the aliased in-band lattice location is $\\boldsymbol{r}_{a} = (-3, -1, -3)$. The corresponding physical wavevector is $\\boldsymbol{k}_{a} = (2\\pi/L)(-3, -1, -3)$.\n\n**Task 2: Determine the multiplicity $M$ of out-of-band contributors**\n\nWe need to find the number of distinct integer lattice wavevectors $\\boldsymbol{r}_{0}$ that meet two criteria:\n1.  They alias to $\\boldsymbol{r}_{a}=(-3, -1, -3)$.\n2.  They are within the ultraviolet cutoff, i.e., $|\\boldsymbol{r}_{0}|^{2} \\le R^{2}$, where $R=10$.\n3.  They are \"out-of-band,\" meaning they are not equal to $\\boldsymbol{r}_{a}$ itself.\n\nAny vector $\\boldsymbol{r}_{0}$ that aliases to $\\boldsymbol{r}_{a}$ can be written as $\\boldsymbol{r}_{0} = \\boldsymbol{r}_{a} + N \\boldsymbol{m}$ for some integer vector $\\boldsymbol{m} = (m_x, m_y, m_z) \\in \\mathbb{Z}^{3}$.\nSubstituting the known values, we have:\n$$ \\boldsymbol{r}_{0} = (-3, -1, -3) + 8(m_x, m_y, m_z) = (8m_x - 3, 8m_y - 1, 8m_z - 3) $$\nThe condition that $\\boldsymbol{r}_{0}$ is out-of-band means that $\\boldsymbol{m} \\neq (0, 0, 0)$. If $\\boldsymbol{m}=(0,0,0)$, then $\\boldsymbol{r}_{0} = \\boldsymbol{r}_{a}$, which is in-band.\n\nThe UV cutoff condition is $|\\boldsymbol{r}_{0}|^{2} \\le 10^{2}$, or:\n$$ (8m_x - 3)^2 + (8m_y - 1)^2 + (8m_z - 3)^2 \\le 100 $$\nWe need to find the number of integer vectors $\\boldsymbol{m} \\neq \\mathbf{0}$ that satisfy this inequality. Let's analyze the possible integer values for each component of $\\boldsymbol{m}$ separately.\n\nFor $m_x$: The term $(8m_x - 3)^2$ must be less than or equal to $100$.\n$|8m_x - 3| \\le 10 \\implies -10 \\le 8m_x - 3 \\le 10 \\implies -7 \\le 8m_x \\le 13 \\implies -0.875 \\le m_x \\le 1.625$. The possible integer values for $m_x$ are $0$ and $1$.\n\nFor $m_y$: The term $(8m_y - 1)^2$ must be less than or equal to $100$.\n$|8m_y - 1| \\le 10 \\implies -10 \\le 8m_y - 1 \\le 10 \\implies -9 \\le 8m_y \\le 11 \\implies -1.125 \\le m_y \\le 1.375$. The possible integer values for $m_y$ are $-1$, $0$, and $1$.\n\nFor $m_z$: The constraints are identical to those for $m_x$, so the possible integer values for $m_z$ are $0$ and $1$.\n\nNow, we test all possible combinations of $(m_x, m_y, m_z)$ from the set $\\{0, 1\\} \\times \\{-1, 0, 1\\} \\times \\{0, 1\\}$, excluding $\\boldsymbol{m}=(0,0,0)$, and check if they satisfy the inequality.\nLet $S(\\boldsymbol{m}) = (8m_x - 3)^2 + (8m_y - 1)^2 + (8m_z - 3)^2$.\n\nThe squared terms are:\n-   If $m_x=0$: $(8(0)-3)^2=9$. If $m_x=1$: $(8(1)-3)^2=25$.\n-   If $m_y=-1$: $(8(-1)-1)^2=81$. If $m_y=0$: $(8(0)-1)^2=1$. If $m_y=1$: $(8(1)-1)^2=49$.\n-   If $m_z=0$: $(8(0)-3)^2=9$. If $m_z=1$: $(8(1)-3)^2=25$.\n\nWe enumerate the non-zero integer vectors $\\boldsymbol{m}$ and calculate $S(\\boldsymbol{m})$:\n1.  $\\boldsymbol{m}=(0,0,1)$: $S = 9 + 1 + 25 = 35 \\le 100$. (Valid)\n2.  $\\boldsymbol{m}=(0,1,0)$: $S = 9 + 49 + 9 = 67 \\le 100$. (Valid)\n3.  $\\boldsymbol{m}=(0,1,1)$: $S = 9 + 49 + 25 = 83 \\le 100$. (Valid)\n4.  $\\boldsymbol{m}=(1,0,0)$: $S = 25 + 1 + 9 = 35 \\le 100$. (Valid)\n5.  $\\boldsymbol{m}=(1,0,1)$: $S = 25 + 1 + 25 = 51 \\le 100$. (Valid)\n6.  $\\boldsymbol{m}=(1,1,0)$: $S = 25 + 49 + 9 = 83 \\le 100$. (Valid)\n7.  $\\boldsymbol{m}=(1,1,1)$: $S = 25 + 49 + 25 = 99 \\le 100$. (Valid)\n8.  $\\boldsymbol{m}=(0,-1,0)$: $S = 9 + 81 + 9 = 99 \\le 100$. (Valid)\n9.  $\\boldsymbol{m}=(0,-1,1)$: $S = 9 + 81 + 25 = 115 > 100$. (Invalid)\n10. $\\boldsymbol{m}=(1,-1,0)$: $S = 25 + 81 + 9 = 115 > 100$. (Invalid)\n11. $\\boldsymbol{m}=(1,-1,1)$: $S = 25 + 81 + 25 = 131 > 100$. (Invalid)\n\nThe $\\boldsymbol{m}=(0,0,0)$ case corresponds to the in-band mode $\\boldsymbol{r}_a$ itself, with $S=9+1+9=19 \\le 100$, but is excluded from the count $M$.\nCounting the number of valid non-zero vectors $\\boldsymbol{m}$, we find there are $8$ such vectors. Each corresponds to a unique, distinct out-of-band mode $\\boldsymbol{r}_0$ that aliases to $\\boldsymbol{r}_a$.\nTherefore, the multiplicity is $M=8$.\n\n**Task 3: Final Answer Formulation**\n\nThe final answer is required as a single row matrix containing the three components of $\\boldsymbol{r}_{a}$ followed by the multiplicity $M$.\nThe components of $\\boldsymbol{r}_{a}$ are $(-3, -1, -3)$ and the multiplicity is $M=8$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-3 & -1 & -3 & 8\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building on a mechanical understanding of aliasing, we can develop analytical models to quantify its impact and the effectiveness of mitigation techniques. This practice moves from a single mode to the statistical level of the power spectrum, $P(k)$, challenging you to derive the functional form of the aliasing contamination for a fiducial power-law cosmology. By comparing a standard estimator to one employing interlacing, you will see mathematically how this technique systematically removes the dominant alias contributions after window function deconvolution .",
            "id": "3464881",
            "problem": "A one-dimensional periodic cosmological density field $\\delta(x)$ of comoving length $L$ is sampled onto a uniform grid of $N$ cells of spacing $\\Delta x = L/N$. The grid sampling uses the Cloud-in-Cell (CIC) mass assignment scheme, whose Fourier-space window for one dimension is $W_{\\mathrm{CIC}}(k) = \\mathrm{sinc}(k \\Delta x / 2)^{2}$, where $\\mathrm{sinc}(y) \\equiv \\sin(y)/y$. The Discrete Fourier Transform (DFT) of the gridded field is used to estimate the power spectrum $P(k)$ for wavenumbers $k$ in the range $0 < k \\leq k_{\\mathrm{Ny}}$, where the Nyquist wave number is $k_{\\mathrm{Ny}} = \\pi/\\Delta x$. To remove the effect of the mass assignment window on the measured power, the usual window-function deconvolution is applied by dividing the measured power by $|W_{\\mathrm{CIC}}(k)|^{2}$.\n\nDiscrete sampling produces aliasing: the deconvolved estimator at Fourier mode $k$ contains contributions from the true field at wave numbers $k + 2 m k_{\\mathrm{Ny}}$ for all nonzero integers $m$. Interlacing is performed by averaging the DFT of the original grid with that of a second grid shifted by $\\Delta x/2$, which cancels contributions with odd $m$.\n\nAssume the true underlying power spectrum is a pure power law $P(k) = A k^{-3}$ with constant amplitude $A>0$. Define the dimensionless wavenumber $q \\equiv k/k_{\\mathrm{Ny}}$ with $0 < q \\leq 1$. Neglect shot noise and any effects beyond the leading-order aliasing terms. Under these assumptions and using only the nearest surviving alias images for each case:\n- For the non-interlaced estimator, keep $m = +1$ and $m = -1$.\n- For the interlaced estimator, keep $m = +2$ and $m = -2$ (since odd $m$ cancel).\n\nStarting from the sampling and window definitions above, derive the leading-order residual aliasing fraction $F_{0}(q)$ for the non-interlaced, window-deconvolved estimator, defined as the ratio of the summed alias contribution to the true power at $k$. Similarly, derive $F_{\\mathrm{int}}(q)$ for the interlaced, window-deconvolved estimator. Then, provide the closed-form expression for the ratio\n$$\nS(q) \\equiv \\frac{F_{\\mathrm{int}}(q)}{F_{0}(q)} \\, ,\n$$\nas an explicit analytic function of $q$.\n\nExpress your final answer as a single closed-form analytic expression for $S(q)$ in terms of $q$. No rounding is required. No physical units are required in the final expression. Use radians for any trigonometric quantities implicitly involved in $\\mathrm{sinc}(\\cdot)$.",
            "solution": "The user wants to find the ratio of aliasing fractions for two different power spectrum estimators in numerical cosmology.\n\n### Step 1: Extract Givens\n- **Field:** A one-dimensional periodic cosmological density field $\\delta(x)$ of comoving length $L$.\n- **Grid:** A uniform grid of $N$ cells with spacing $\\Delta x = L/N$.\n- **Mass Assignment:** Cloud-in-Cell (CIC) scheme.\n- **CIC Window Function:** $W_{\\mathrm{CIC}}(k) = \\mathrm{sinc}(k \\Delta x / 2)^{2}$, where $\\mathrm{sinc}(y) \\equiv \\sin(y)/y$.\n- **Wavenumber range:** $0 < k \\leq k_{\\mathrm{Ny}}$.\n- **Nyquist Wavenumber:** $k_{\\mathrm{Ny}} = \\pi/\\Delta x$.\n- **Window Deconvolution:** Division of the measured power by $|W_{\\mathrm{CIC}}(k)|^{2}$.\n- **Aliasing:** The deconvolved estimator at $k$ includes contributions from wavenumbers $k_m = k + 2 m k_{\\mathrm{Ny}}$ for all nonzero integers $m$.\n- **Interlacing:** Averages the DFT of the original grid with a grid shifted by $\\Delta x/2$, which cancels contributions from odd $m$.\n- **True Power Spectrum:** $P(k) = A k^{-3}$ for a constant amplitude $A>0$. As power spectra of real fields must be even, we interpret this as $P(k) = A |k|^{-3}$.\n- **Dimensionless Wavenumber:** $q \\equiv k/k_{\\mathrm{Ny}}$, with $0 < q \\leq 1$.\n- **Approximations:**\n    - Neglect shot noise and effects beyond leading-order aliasing.\n    - Non-interlaced estimator: Keep only alias terms for $m = +1$ and $m = -1$.\n    - Interlaced estimator: Keep only alias terms for $m = +2$ and $m = -2$.\n- **Definitions of Aliasing Fractions:**\n    - $F_{0}(q)$: Ratio of the summed alias contribution to the true power for the non-interlaced estimator.\n    - $F_{\\mathrm{int}}(q)$: Ratio of the summed alias contribution to the true power for the interlaced estimator.\n- **Goal:** Find the ratio $S(q) \\equiv F_{\\mathrm{int}}(q) / F_{0}(q)$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem uses standard concepts and terminology from numerical cosmology (CIC scheme, aliasing, power spectrum estimation, interlacing). The use of a power-law spectrum is a common and valid simplification for analysis. The setup is physically and mathematically coherent.\n- **Well-Posed:** The problem provides all necessary definitions, functions, and constraints to derive a unique analytical solution for the requested ratio $S(q)$.\n- **Objective:** The language is precise and technical, free of subjective or ambiguous statements.\n\nThe problem is self-contained, consistent, and scientifically sound. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will now proceed with the solution.\n\n### Derivation\nThe power spectrum measured from the gridded field, $\\hat{P}_{\\mathrm{meas}}(k)$, includes contributions from the true power spectrum $P(k')$ at all wavenumbers $k'$ that are aliased to $k$. The expected value of the measured power is given by the sum over aliases, with each term weighted by the squared magnitude of the mass assignment window function:\n$$\n\\langle \\hat{P}_{\\mathrm{meas}}(k) \\rangle \\propto \\sum_{m=-\\infty}^{\\infty} |W_{\\mathrm{CIC}}(k_m)|^2 P(k_m)\n$$\nwhere $k_m = k + 2 m k_{\\mathrm{Ny}}$. The window function is given as $W_{\\mathrm{CIC}}(k) = \\mathrm{sinc}^2(k\\Delta x/2)$, which is real and non-negative, so $|W_{\\mathrm{CIC}}(k)| = W_{\\mathrm{CIC}}(k)$.\n\nThe problem states that a window deconvolution is performed by dividing the measured power by $|W_{\\mathrm{CIC}}(k)|^2 = (W_{\\mathrm{CIC}}(k))^2$. The resulting deconvolved power estimator, $P_{\\mathrm{dec}}(k)$, is:\n$$\nP_{\\mathrm{dec}}(k) = \\frac{\\sum_{m=-\\infty}^{\\infty} (W_{\\mathrm{CIC}}(k_m))^2 P(k_m)}{(W_{\\mathrm{CIC}}(k))^2} = P(k) + \\sum_{m \\neq 0} \\left( \\frac{W_{\\mathrm{CIC}}(k_m)}{W_{\\mathrm{CIC}}(k)} \\right)^2 P(k_m)\n$$\nThe first term is the true power, and the sum represents the total contribution from aliasing.\n\nThe aliasing fraction, $F(k)$, is the ratio of the summed alias contribution to the true power:\n$$\nF(k) = \\frac{\\sum_{m \\neq 0} \\left( \\frac{W_{\\mathrm{CIC}}(k_m)}{W_{\\mathrm{CIC}}(k)} \\right)^2 P(k_m)}{P(k)} = \\sum_{m \\neq 0} \\left( \\frac{W_{\\mathrm{CIC}}(k_m)}{W_{\\mathrm{CIC}}(k)} \\right)^2 \\frac{P(k_m)}{P(k)}\n$$\n\nTo proceed, we express all quantities in terms of the dimensionless wavenumber $q = k/k_{\\mathrm{Ny}}$. Note that $k\\Delta x = (q k_{\\mathrm{Ny}})(\\pi/k_{\\mathrm{Ny}}) = q\\pi$.\nThe argument of the sinc function becomes $k \\Delta x / 2 = q \\pi / 2$.\nThe aliased wavenumbers are $k_m = k + 2mk_{\\mathrm{Ny}} = (q+2m)k_{\\mathrm{Ny}}$. Their magnitudes are $|k_m| = |q+2m|k_{\\mathrm{Ny}}$. For $0 < q \\leq 1$, we have $|q+2m| = q+2m$ for $m > 0$ and $|q+2m| = |2m|-q$ for $m < 0$.\n\nThe ratio of the window functions is:\n$$\n\\frac{W_{\\mathrm{CIC}}(k_m)}{W_{\\mathrm{CIC}}(k)} = \\frac{\\mathrm{sinc}^2(k_m \\Delta x / 2)}{\\mathrm{sinc}^2(k \\Delta x / 2)} = \\frac{\\mathrm{sinc}^2((q+2m)\\pi/2)}{\\mathrm{sinc}^2(q\\pi/2)}\n$$\nUsing $\\mathrm{sinc}(y+n\\pi) = \\frac{\\sin(y+n\\pi)}{y+n\\pi} = \\frac{(-1)^n \\sin(y)}{y+n\\pi} = \\frac{(-1)^n y \\mathrm{sinc}(y)}{y+n\\pi}$, we have:\n$\\mathrm{sinc}^2((q+2m)\\pi/2) = \\mathrm{sinc}^2(q\\pi/2 + m\\pi) = \\left(\\frac{\\sin(q\\pi/2 + m\\pi)}{(q+2m)\\pi/2}\\right)^2 = \\left(\\frac{\\sin(q\\pi/2)}{(q+2m)\\pi/2}\\right)^2$.\n$$\n\\frac{W_{\\mathrm{CIC}}(k_m)}{W_{\\mathrm{CIC}}(k)} = \\frac{(\\sin(q\\pi/2) / ((q+2m)\\pi/2))^2}{(\\sin(q\\pi/2) / (q\\pi/2))^2} = \\left(\\frac{q\\pi/2}{(q+2m)\\pi/2}\\right)^2 = \\left(\\frac{q}{q+2m}\\right)^2\n$$\n\nThe ratio of the power spectra is:\n$$\n\\frac{P(k_m)}{P(k)} = \\frac{A|k_m|^{-3}}{A|k|^{-3}} = \\left(\\frac{|k_m|}{|k|}\\right)^{-3} = \\left(\\frac{|q+2m|k_{\\mathrm{Ny}}}{q k_{\\mathrm{Ny}}}\\right)^{-3} = \\left(\\frac{|q+2m|}{q}\\right)^{-3} = \\left(\\frac{q}{|q+2m|}\\right)^3\n$$\n\nThe contribution of a single alias mode $m$ to the aliasing fraction is:\n$$\n\\left( \\frac{W_{\\mathrm{CIC}}(k_m)}{W_{\\mathrm{CIC}}(k)} \\right)^2 \\frac{P(k_m)}{P(k)} = \\left[ \\left(\\frac{q}{q+2m}\\right)^2 \\right]^2 \\left(\\frac{q}{|q+2m|}\\right)^3 = \\frac{q^4}{(q+2m)^4} \\frac{q^3}{|q+2m|^3} = \\frac{q^7}{(q+2m)^4 |q+2m|^3}\n$$\n\n**Non-interlaced case ($F_0(q)$):**\nWe consider the leading-order aliases $m=\\pm 1$.\nFor $m=1$: $q+2m = q+2 > 0$. The contribution is $\\left(\\frac{q}{q+2}\\right)^7$.\nFor $m=-1$: $q+2m = q-2$. Since $0<q\\le1$, $q-2 < 0$ and $|q-2|=2-q$. The contribution is $\\frac{q^7}{(q-2)^4(2-q)^3} = \\frac{q^7}{(2-q)^4(2-q)^3} = \\left(\\frac{q}{2-q}\\right)^7$.\nThe total aliasing fraction is the sum of these two contributions:\n$$\nF_0(q) = \\left(\\frac{q}{q+2}\\right)^7 + \\left(\\frac{q}{2-q}\\right)^7 = q^7 \\left( \\frac{1}{(q+2)^7} + \\frac{1}{(2-q)^7} \\right)\n$$\n\n**Interlaced case ($F_{\\mathrm{int}}(q)$):**\nInterlacing cancels aliasing contributions from odd $m$. We consider the nearest surviving aliases $m=\\pm 2$.\nFor $m=2$: $q+2m = q+4 > 0$. The contribution is $\\left(\\frac{q}{q+4}\\right)^7$.\nFor $m=-2$: $q+2m = q-4$. Since $0<q\\le1$, $q-4 < 0$ and $|q-4|=4-q$. The contribution is $\\frac{q^7}{(q-4)^4(4-q)^3} = \\frac{q^7}{(4-q)^4(4-q)^3} = \\left(\\frac{q}{4-q}\\right)^7$.\nThe total aliasing fraction for the interlaced case is:\n$$\nF_{\\mathrm{int}}(q) = \\left(\\frac{q}{q+4}\\right)^7 + \\left(\\frac{q}{4-q}\\right)^7 = q^7 \\left( \\frac{1}{(q+4)^7} + \\frac{1}{(4-q)^7} \\right)\n$$\n\n**Ratio $S(q)$:**\nThe final step is to compute the ratio $S(q) = F_{\\mathrm{int}}(q) / F_0(q)$.\n$$\nS(q) = \\frac{q^7 \\left( \\frac{1}{(q+4)^7} + \\frac{1}{(4-q)^7} \\right)}{q^7 \\left( \\frac{1}{(q+2)^7} + \\frac{1}{(2-q)^7} \\right)} = \\frac{\\frac{1}{(4+q)^7} + \\frac{1}{(4-q)^7}}{\\frac{1}{(2+q)^7} + \\frac{1}{(2-q)^7}}\n$$\nTo write this as a single rational expression, we combine the fractions in the numerator and denominator:\n$$\nS(q) = \\frac{\\frac{(4-q)^7 + (4+q)^7}{((4-q)(4+q))^7}}{\\frac{(2-q)^7 + (2+q)^7}{((2-q)(2+q))^7}} = \\frac{(4-q)^7 + (4+q)^7}{(16-q^2)^7} \\cdot \\frac{(4-q^2)^7}{(2-q)^7 + (2+q)^7}\n$$\nRearranging gives the final closed-form expression:\n$$\nS(q) = \\frac{(4+q)^7 + (4-q)^7}{(2+q)^7 + (2-q)^7} \\left( \\frac{4-q^2}{16-q^2} \\right)^7\n$$\nThis expression is the complete analytical solution as requested.",
            "answer": "$$\n\\boxed{\\frac{(4+q)^7 + (4-q)^7}{(2+q)^7 + (2-q)^7} \\left( \\frac{4-q^2}{16-q^2} \\right)^7}\n$$"
        },
        {
            "introduction": "Analytical theory provides powerful insights, but practical cosmology relies on robust numerical implementations. This final practice bridges the gap by tasking you with developing a numerical algorithm to compute the total aliasing bias, summing the contributions from a multitude of alias replicas. This coding exercise highlights the critical interplay between the choice of mass assignment scheme (such as NGP, CIC, or TSC) and the underlying spectral index $n$ in determining the final accuracy of a power spectrum measurement .",
            "id": "3464904",
            "problem": "You will study aliasing control and window function deconvolution in an estimator of the isotropic power spectrum $P(k)$ constructed from a density field sampled on a regular $3$-dimensional Cartesian grid of spacing $\\Delta x$. The estimator is implemented using the Fast Fourier Transform (FFT), and the density is assigned to the grid using a separable mass assignment kernel. You will work in the regime where the underlying continuous power spectrum is a pure power law $P(k)\\propto k^n$ with spectral index $n\\in\\mathbb{R}$, and where the field is periodic with a sufficiently large fundamental domain so that finite-volume effects can be neglected for the tasks in this problem.\n\nYour derivation must begin from the following foundational bases:\n- The sampling theorem and the Poisson summation formula for regular sampling, which imply that sampling a continuous field on a regular grid replicates its Fourier transform periodically in wavevector space with period set by the sampling frequency.\n- The convolution theorem, which implies that convolving the field in configuration space by a mass assignment kernel corresponds to multiplying by the kernel’s Fourier transform in wavevector space.\n- The separability of standard mass assignment kernels used in cosmology. Specifically, consider the following real-space mass assignment schemes and their corresponding separable Fourier-space window functions (modulo an overall phase that cancels in the power spectrum):\n  - Nearest Grid Point (NGP): $W_{\\mathrm{NGP}}(\\mathbf{k})=\\prod_{i\\in\\{x,y,z\\}}\\mathrm{sinc}\\!\\left(\\tfrac{1}{2}k_i\\Delta x\\right)$.\n  - Cloud In Cell (CIC): $W_{\\mathrm{CIC}}(\\mathbf{k})=\\prod_{i\\in\\{x,y,z\\}}\\mathrm{sinc}\\!\\left(\\tfrac{1}{2}k_i\\Delta x\\right)^{2}$.\n  - Triangular Shaped Cloud (TSC): $W_{\\mathrm{TSC}}(\\mathbf{k})=\\prod_{i\\in\\{x,y,z\\}}\\mathrm{sinc}\\!\\left(\\tfrac{1}{2}k_i\\Delta x\\right)^{3}$.\n  Here $\\mathrm{sinc}(x)\\equiv \\sin(x)/x$ with $\\mathrm{sinc}(0)=1$.\n\nDefine the Nyquist wave number as $k_{\\mathrm{Nyq}}=\\pi/\\Delta x$, and let the discrete Fourier modes inside the first Brillouin zone satisfy $k_i\\in(-k_{\\mathrm{Nyq}},k_{\\mathrm{Nyq}})$ for each Cartesian component $i\\in\\{x,y,z\\}$.\n\nTasks:\n- Starting from the above bases only, and without invoking any pre-assembled aliasing formula, derive a mathematically explicit expression for the residual fractional aliasing bias in the deconvolved power spectrum estimator at a mode $\\mathbf{k}$ inside the first Brillouin zone. The deconvolved estimator referred to here is the one obtained by dividing the squared modulus of the Fourier-transformed gridded field by the squared modulus of the window function evaluated at $\\mathbf{k}$. The residual fractional aliasing bias is defined as the ratio of the contamination contributed by all Fourier replicas of the spectrum outside the first Brillouin zone to the true power $P(|\\mathbf{k}|)$ at the target mode.\n- Specialize your expression to the isotropic power-law case $P(k)\\propto k^{n}$, and show explicitly how the spectral index $n$ weighs the leakage from $k>k_{\\mathrm{Nyq}}$ into $k<k_{\\mathrm{Nyq}}$ through the sampling-induced replicas.\n- Design an algorithm to evaluate the residual fractional bias numerically by truncating the infinite sum over Fourier replicas to a cube of integer triplets $\\mathbf{m}=(m_x,m_y,m_z)$ with $m_i\\in\\{-M,-M+1,\\dots,M\\}$, excluding $\\mathbf{m}=\\mathbf{0}$, where $M$ is a positive integer. Your implementation must use $M=3$, and you must justify in your derivation why this yields a controlled approximation for the test cases given below.\n- Implement the algorithm and compute the residual fractional bias for the following test suite. Use $\\Delta x=1$ so that $k_{\\mathrm{Nyq}}=\\pi$. Report dimensionless fractional biases as real numbers. For each case, the mode components are provided as fractions of $k_{\\mathrm{Nyq}}$:\n  - Case $1$: window $W_{\\mathrm{NGP}}$, $n=-2$, $\\mathbf{k}=(0.1\\,k_{\\mathrm{Nyq}},\\,0,\\,0)$.\n  - Case $2$: window $W_{\\mathrm{CIC}}$, $n=-2$, $\\mathbf{k}=(0.1\\,k_{\\mathrm{Nyq}},\\,0,\\,0)$.\n  - Case $3$: window $W_{\\mathrm{TSC}}$, $n=-2$, $\\mathbf{k}=(0.1\\,k_{\\mathrm{Nyq}},\\,0,\\,0)$.\n  - Case $4$: window $W_{\\mathrm{NGP}}$, $n=0$, $\\mathbf{k}=(0.7\\,k_{\\mathrm{Nyq}},\\,0,\\,0)$.\n  - Case $5$: window $W_{\\mathrm{CIC}}$, $n=0$, $\\mathbf{k}=(0.7\\,k_{\\mathrm{Nyq}},\\,0,\\,0)$.\n  - Case $6$: window $W_{\\mathrm{TSC}}$, $n=0$, $\\mathbf{k}=(0.7\\,k_{\\mathrm{Nyq}},\\,0,\\,0)$.\n  - Case $7$: window $W_{\\mathrm{CIC}}$, $n=1.5$, $\\mathbf{k}=(0.4\\,k_{\\mathrm{Nyq}},\\,0.4\\,k_{\\mathrm{Nyq}},\\,0.4\\,k_{\\mathrm{Nyq}})$.\n- Your program must implement the definitions of $W_{\\mathrm{NGP}}$, $W_{\\mathrm{CIC}}$, $W_{\\mathrm{TSC}}$ given above, must use $\\mathrm{sinc}(x)=\\sin(x)/x$ with $\\mathrm{sinc}(0)=1$, and must evaluate the bias using the truncation with $M=3$ as specified. The isotropic power spectrum normalization cancels in the requested fractional bias, so you may set the proportionality constant to unity without loss of generality.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results for Cases $1$ through $7$ in order, as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,\\dots,r_7]$), where each $r_j$ is the residual fractional aliasing bias for Case $j$ expressed as a real number (dimensionless).",
            "solution": "The problem is well-posed and scientifically sound, permitting a direct derivation from the foundational principles provided. We shall proceed to derive the expression for the residual fractional aliasing bias, specialize it for a power-law spectrum, and then formulate the algorithm for its numerical evaluation.\n\nLet the continuous, underlying density contrast field be $\\delta(\\mathbf{x})$, and its Fourier transform be $\\tilde{\\delta}(\\mathbf{k})$. The statistical properties of this field are described by the power spectrum, $P(k)$, defined by the two-point correlator in Fourier space:\n$$\n\\langle \\tilde{\\delta}(\\mathbf{k}) \\tilde{\\delta}^*(\\mathbf{k}') \\rangle_E = (2\\pi)^3 \\delta_D(\\mathbf{k}-\\mathbf{k}') P(k)\n$$\nwhere $\\langle \\cdot \\rangle_E$ denotes an ensemble average and $\\delta_D$ is the Dirac delta function.\n\nThe process of constructing a power spectrum estimator from a gridded field involves two main steps: mass assignment and grid sampling.\n\nFirst, the continuous field $\\delta(\\mathbf{x})$ is convolved with a mass assignment kernel, $K(\\mathbf{x})$, to produce a smoothed field $\\delta_K(\\mathbf{x}) = (\\delta * K)(\\mathbf{x})$. By the convolution theorem, this operation corresponds to a multiplication in Fourier space:\n$$\n\\tilde{\\delta}_K(\\mathbf{k}) = \\tilde{\\delta}(\\mathbf{k}) W(\\mathbf{k})\n$$\nwhere $W(\\mathbf{k})$ is the Fourier transform of the kernel $K(\\mathbf{x})$, known as the window function.\n\nSecond, the smoothed field $\\delta_K(\\mathbf{x})$ is sampled on a regular Cartesian grid with spacing $\\Delta x$. The sampled field can be written as:\n$$\n\\delta_g(\\mathbf{x}) = \\sum_{\\mathbf{j} \\in \\mathbb{Z}^3} \\delta_K(\\mathbf{j} \\Delta x) \\delta_D(\\mathbf{x} - \\mathbf{j} \\Delta x)\n$$\nThe Fourier transform of the sampled field, $\\tilde{\\delta}_g(\\mathbf{k})$, is given by the Poisson summation formula, which states that sampling in configuration space results in a periodic summation of the continuous-field Fourier transform in wavevector space. The period of replication is the sampling wavenumber, $k_s = 2\\pi / \\Delta x$. For a mode $\\mathbf{k}$ within the first Brillouin zone ($|k_i| < k_{\\mathrm{Nyq}} = \\pi/\\Delta x$ for $i \\in \\{x,y,z\\}$), the Fourier amplitude measured from the grid, which we denote $\\hat{\\delta}_{\\mathbf{k}}$, is proportional to a sum over all aliases:\n$$\n\\hat{\\delta}_{\\mathbf{k}} \\propto \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3} \\tilde{\\delta}_K(\\mathbf{k} + \\mathbf{m} k_s) = \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3} \\tilde{\\delta}(\\mathbf{k} + \\mathbf{m} k_s) W(\\mathbf{k} + \\mathbf{m} k_s)\n$$\nThe vector $\\mathbf{m} = (m_x, m_y, m_z)$ is a triplet of integers indexing the replicated copies of the original Fourier space.\n\nThe power spectrum estimator on the grid, $\\hat{P}(\\mathbf{k})$, is constructed from the ensemble average of the squared modulus of these Fourier amplitudes. Using the statistical independence of the Fourier modes $\\tilde{\\delta}(\\mathbf{k}')$ at different wavevectors $\\mathbf{k}'$, the cross-terms in the squared sum vanish upon taking the ensemble average:\n$$\n\\hat{P}(\\mathbf{k}) = \\langle |\\hat{\\delta}_{\\mathbf{k}}|^2 \\rangle_E \\propto \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3} \\langle |\\tilde{\\delta}(\\mathbf{k} + \\mathbf{m} k_s)|^2 \\rangle_E |W(\\mathbf{k} + \\mathbf{m} k_s)|^2\n$$\nSubstituting the definition of the power spectrum $P(k)$, we obtain the aliased power spectrum:\n$$\n\\hat{P}(\\mathbf{k}) \\propto \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3} P(|\\mathbf{k} + \\mathbf{m} k_s|) |W(\\mathbf{k} + \\mathbf{m} k_s)|^2\n$$\nThe \"deconvolved\" power spectrum estimator is obtained by dividing $\\hat{P}(\\mathbf{k})$ by the squared modulus of the window function evaluated at the target mode, $|W(\\mathbf{k})|^2$. Let us denote this by $P_{\\text{deconv}}(\\mathbf{k})$:\n$$\nP_{\\text{deconv}}(\\mathbf{k}) = \\frac{\\hat{P}(\\mathbf{k})}{|W(\\mathbf{k})|^2} \\propto \\frac{1}{|W(\\mathbf{k})|^2} \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3} P(|\\mathbf{k} + \\mathbf{m} k_s|) |W(\\mathbf{k} + \\mathbf{m} k_s)|^2\n$$\nWe can separate the sum into the term for $\\mathbf{m}=\\mathbf{0}$ and the sum over all other replicas ($\\mathbf{m}\\neq\\mathbf{0}$):\n$$\nP_{\\text{deconv}}(\\mathbf{k}) \\propto \\frac{P(|\\mathbf{k}|) |W(\\mathbf{k})|^2}{|W(\\mathbf{k})|^2} + \\sum_{\\mathbf{m} \\neq \\mathbf{0}} \\frac{P(|\\mathbf{k} + \\mathbf{m} k_s|) |W(\\mathbf{k} + \\mathbf{m} k_s)|^2}{|W(\\mathbf{k})|^2}\n$$\nThe first term, $P(|\\mathbf{k}|)$, represents the true, unaliased power that we aim to measure. The second term is the contamination from all other Fourier replicas, which is the aliasing error.\n\nThe residual fractional aliasing bias, $B(\\mathbf{k})$, is defined as the ratio of this contamination to the true power $P(|\\mathbf{k}|)$. This gives the explicit expression:\n$$\nB(\\mathbf{k}) = \\frac{1}{P(|\\mathbf{k}|)} \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3, \\mathbf{m} \\neq \\mathbf{0}} P(|\\mathbf{k} + \\mathbf{m} k_s|) \\frac{|W(\\mathbf{k} + \\mathbf{m} k_s)|^2}{|W(\\mathbf{k})|^2}\n$$\nThis can be rewritten as:\n$$\nB(\\mathbf{k}) = \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3, \\mathbf{m} \\neq \\mathbf{0}} \\frac{P(|\\mathbf{k} + \\mathbf{m} k_s|)}{P(|\\mathbf{k}|)} \\frac{|W(\\mathbf{k} + \\mathbf{m} k_s)|^2}{|W(\\mathbf{k})|^2}\n$$\nThis is the general expression for the residual fractional aliasing bias.\n\nNext, we specialize this expression for an isotropic power-law spectrum, $P(k) \\propto k^n$. The proportionality constant cancels in the ratio:\n$$\n\\frac{P(|\\mathbf{k} + \\mathbf{m} k_s|)}{P(|\\mathbf{k}|)} = \\frac{|\\mathbf{k} + \\mathbf{m} k_s|^n}{|\\mathbf{k}|^n} = \\left(\\frac{|\\mathbf{k} + \\mathbf{m} k_s|}{|\\mathbf{k}|}\\right)^n\n$$\nSubstituting this into the expression for $B(\\mathbf{k})$ yields:\n$$\nB(\\mathbf{k}) = \\sum_{\\mathbf{m} \\in \\mathbb{Z}^3, \\mathbf{m} \\neq \\mathbf{0}} \\left(\\frac{|\\mathbf{k} + \\mathbf{m} k_s|}{|\\mathbf{k}|}\\right)^n \\frac{|W(\\mathbf{k} + \\mathbf{m} k_s)|^2}{|W(\\mathbf{k})|^2}\n$$\nThis expression demonstrates that the contribution of each alias mode, located at $\\mathbf{k} + \\mathbf{m} k_s$, is weighted by the power-law index $n$. For spectra that fall with $k$ (e.g., $n<0$, typical in cosmology), the aliasing contributions from high-$k$ modes are suppressed. Conversely, for rising spectra ($n>0$), aliasing effects are amplified.\n\nThe numerical evaluation of this infinite sum requires truncation. We are instructed to sum over a finite cube of integer triplets $\\mathbf{m}=(m_x,m_y,m_z)$ where each component $m_i \\in \\{-M, \\dots, M\\}$ for $M=3$, excluding the central term $\\mathbf{m}=\\mathbf{0}$. The justification for this truncation lies in the rapid decay of the window function term $|W(\\mathbf{k} + \\mathbf{m} k_s)|^2$ as $|\\mathbf{m}|$ increases. The specified window functions are of the form $W_p(\\mathbf{k}) = \\prod_{i\\in\\{x,y,z\\}} \\mathrm{sinc}^p(\\frac{1}{2}k_i\\Delta x)$, where $p=1, 2, 3$ corresponds to NGP, CIC, and TSC, respectively. The term for an alias $\\mathbf{m}$ involves:\n$$\n|W_p(\\mathbf{k} + \\mathbf{m} k_s)|^2 = \\prod_{i\\in\\{x,y,z\\}} \\mathrm{sinc}^{2p}\\left(\\frac{1}{2}(k_i+m_i k_s)\\Delta x\\right) = \\prod_{i\\in\\{x,y,z\\}} \\mathrm{sinc}^{2p}\\left(\\frac{k_i\\Delta x}{2} + m_i \\pi\\right)\n$$\nSince $\\mathrm{sinc}(x) \\sim 1/x$ for large $|x|$, the window function term decays rapidly with increasing $|\\mathbf{m}|$. Specifically, for large $|\\mathbf{m}|$, each term in the product decays at least as fast as $1/|m_i|^{2p}$. The suppression is stronger for higher-order schemes (larger $p$).\nFor CIC ($p=2$) and TSC ($p=3$), this decay is exceptionally fast (as $\\sim |\\mathbf{m}|^{-12}$ and $\\sim |\\mathbf{m}|^{-18}$ in the asymptotic corner of $\\mathbf{m}$-space, respectively), ensuring that contributions from $|\\mathbf{m}|>3$ are negligible for typical spectral indices.\nFor NGP ($p=1$), the convergence is slower. However, with the specified truncation at $M=3$, the algorithm still sums over the $(2M+1)^3 - 1 = 7^3-1 = 342$ nearest and most significant alias vectors. This provides a controlled and sufficient approximation of the total bias for the purposes of this problem, capturing the dominant contributions.\n\nThe algorithm proceeds as follows:\n1. Initialize the total bias $B$ to $0$.\n2. For a given test case (window type $p$, spectral index $n$, vector $\\mathbf{k}$), calculate the denominator terms $|\\mathbf{k}|^n$ and $|W_p(\\mathbf{k})|^2$.\n3. Loop through integer triplets $\\mathbf{m} = (m_x, m_y, m_z)$ where each component ranges from $-M$ to $M$ (with $M=3$).\n4. If $\\mathbf{m} = (0,0,0)$, skip the iteration.\n5. For each $\\mathbf{m} \\neq \\mathbf{0}$, compute the aliased wavevector $\\mathbf{k}' = \\mathbf{k} + \\mathbf{m} k_s$.\n6. Calculate the numerator terms $|\\mathbf{k}'|^n$ and $|W_p(\\mathbf{k}')|^2$.\n7. Compute the summand $\\left(\\frac{|\\mathbf{k}'|}{|\\mathbf{k}|}\\right)^n \\frac{|W_p(\\mathbf{k}')|^2}{|W_p(\\mathbf{k})|^2}$ and add it to the total bias $B$.\n8. After the loops complete, $B$ holds the final value of the residual fractional bias.\nThis procedure is implemented for each of the seven test cases specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the aliasing control and window function deconvolution problem\n    by deriving and implementing a formula for the residual fractional bias.\n    \"\"\"\n\n    def custom_sinc(x):\n        \"\"\"\n        Computes sinc(x) = sin(x)/x, with sinc(0) = 1.\n        The input x can be a scalar or a numpy array.\n        \"\"\"\n        # Ensure x is a numpy array for consistent behavior\n        x = np.asarray(x)\n        # Initialize result with ones for the x=0 case\n        res = np.ones_like(x, dtype=float)\n        # Create a mask for non-zero elements\n        non_zero_mask = (x != 0)\n        # Compute sin(x)/x for non-zero elements\n        res[non_zero_mask] = np.sin(x[non_zero_mask]) / x[non_zero_mask]\n        return res\n\n    def window_function_sq(k_vec, p, delta_x):\n        \"\"\"\n        Calculates the squared modulus of the window function |W(k)|^2.\n        \n        Args:\n            k_vec (np.ndarray): The 3D wavevector.\n            p (int): The order of the window function (1=NGP, 2=CIC, 3=TSC).\n            delta_x (float): The grid spacing.\n        \n        Returns:\n            float: The value of |W(k)|^2.\n        \"\"\"\n        # The argument of the sinc function is k_i * delta_x / 2\n        args = 0.5 * k_vec * delta_x\n        sinc_vals = custom_sinc(args)\n        # The window function is a product over dimensions, raised to power 2p\n        return np.prod(sinc_vals**(2 * p))\n\n    def calculate_bias(window_type, n, k_vec, delta_x, M):\n        \"\"\"\n        Calculates the residual fractional aliasing bias.\n        \n        Args:\n            window_type (str): 'NGP', 'CIC', or 'TSC'.\n            n (float): The spectral index of the power law P(k) ~ k^n.\n            k_vec (np.ndarray): The 3D wavevector for which to calculate the bias.\n            delta_x (float): The grid spacing.\n            M (int): The truncation limit for the sum over aliases.\n        \n        Returns:\n            float: The calculated residual fractional bias.\n        \"\"\"\n        window_map = {'NGP': 1, 'CIC': 2, 'TSC': 3}\n        p = window_map[window_type]\n\n        k_s = 2.0 * np.pi / delta_x\n        k_mag = np.linalg.norm(k_vec)\n        \n        # This case is not in the test suite but is a necessary guard.\n        if k_mag == 0.0:\n            # P(0) needs careful definition, but any k>0 will result in infinite fractional bias.\n            # Returning 0.0 as a practical matter, assuming P(0) is finite and contamination is 0 at k=0.\n            return 0.0\n\n        # Calculate the denominator of the bias term ratio\n        Wk_sq_denom = window_function_sq(k_vec, p, delta_x)\n        if Wk_sq_denom == 0.0:\n            # This would imply infinite deconvolved power, a pathological case.\n            return np.inf\n\n        total_bias = 0.0\n        \n        m_range = range(-M, M + 1)\n        # Loop over the cube of alias indices m = (mx, my, mz)\n        for mx in m_range:\n            for my in m_range:\n                for mz in m_range:\n                    # Exclude the m=0 (non-aliased) term\n                    if mx == 0 and my == 0 and mz == 0:\n                        continue\n                    \n                    m_vec = np.array([mx, my, mz], dtype=float)\n                    k_alias = k_vec + m_vec * k_s\n                    k_alias_mag = np.linalg.norm(k_alias)\n\n                    # Ratio of power spectrum values: ( |k_alias| / |k| )^n\n                    power_ratio = (k_alias_mag / k_mag)**n\n                    \n                    # Ratio of squared window function values: |W(k_alias)|^2 / |W(k)|^2\n                    Wk_alias_sq = window_function_sq(k_alias, p, delta_x)\n                    window_ratio = Wk_alias_sq / Wk_sq_denom\n                    \n                    # Add the contribution from this alias to the total bias\n                    term = power_ratio * window_ratio\n                    total_bias += term\n        \n        return total_bias\n\n    # Define the test cases from the problem statement.\n    delta_x = 1.0\n    k_nyq = np.pi / delta_x\n    M = 3\n    \n    test_cases = [\n        # Case 1: NGP, n=-2, k low\n        ('NGP', -2.0, np.array([0.1, 0.0, 0.0]) * k_nyq),\n        # Case 2: CIC, n=-2, k low\n        ('CIC', -2.0, np.array([0.1, 0.0, 0.0]) * k_nyq),\n        # Case 3: TSC, n=-2, k low\n        ('TSC', -2.0, np.array([0.1, 0.0, 0.0]) * k_nyq),\n        # Case 4: NGP, n=0, k high\n        ('NGP',  0.0, np.array([0.7, 0.0, 0.0]) * k_nyq),\n        # Case 5: CIC, n=0, k high\n        ('CIC',  0.0, np.array([0.7, 0.0, 0.0]) * k_nyq),\n        # Case 6: TSC, n=0, k high\n        ('TSC',  0.0, np.array([0.7, 0.0, 0.0]) * k_nyq),\n        # Case 7: CIC, n=1.5, k diagonal\n        ('CIC',  1.5, np.array([0.4, 0.4, 0.4]) * k_nyq),\n    ]\n\n    results = []\n    for case in test_cases:\n        window_type, n, k_vec = case\n        bias = calculate_bias(window_type, n, k_vec, delta_x, M)\n        results.append(bias)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}