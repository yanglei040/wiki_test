{
    "hands_on_practices": [
        {
            "introduction": "为了掌握树形算法的核心思想，我们首先从最基本的近似——单极子近似——开始。这个练习将引导你通过一个简单的三体系统，亲手计算精确的引力与单极子近似引力之间的差异。通过量化这个误差，你将直观地理解为何以及何时可以用一个质心来代替一个粒子群，并为理解更复杂的树形码打开准则（opening criterion）奠定基础。",
            "id": "3501662",
            "problem": "考虑在协动代码单位下的牛顿引力，其中引力常数 $G=1$。一个模拟 Barnes–Hut (BH) 树中单个遥远单元的简单配置包括：一个质量为 $m_{0}$ 的目标粒子位于原点，以及两个质量分别为 $m_{1}=1$ 和 $m_{2}=1$ 的源粒子，它们的位置在 $\\boldsymbol{r}_{1}=(10,1,0)$ 和 $\\boldsymbol{r}_{2}=(10,-1,0)$。忽略任何宇宙学膨胀因子或周期性镜像，并将相互作用视为三维欧几里得空间中的纯牛顿引力。\n\n从牛顿万有引力定律和质心的定义出发，按顺序完成以下任务：\n\n1. 计算两个源粒子对目标粒子施加的精确引力矢量 $\\boldsymbol{F}_{\\text{exact}}$。\n\n2. 仅使用单极项，将两个源粒子的贡献近似为一个 BH 树单元：用一个位于其质心位置 $\\boldsymbol{R}_{\\text{cm}}$、质量等于其总质量 $M$ 的单个点质量来代替这两个粒子。计算作用在目标粒子上的近似引力矢量 $\\boldsymbol{F}_{\\text{mono}}$。\n\n3. 使用您的结果，计算单极近似的相对误差，其定义为\n$$\n\\varepsilon \\equiv \\frac{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert}{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}\\right\\rvert}.\n$$\n\n为了与 BH 张角判据联系起来，将有效单元尺寸定义为包裹两个源粒子的最小轴对齐正方形的边长 $s$，并令 $d=\\lvert \\boldsymbol{R}_{\\text{cm}}\\rvert$。报告您与此配置关联的张角 $\\theta \\equiv s/d$，并将 $\\varepsilon$ 的数值解释为在该 $\\theta$ 下此几何构型所实现的相对误差。\n\n最终答案仅提供 $\\varepsilon$ 的数值，以无量纲小数形式表示，并四舍五入到四位有效数字。",
            "solution": "由源粒子 $j$（质量为 $m_j$，位置为 $\\boldsymbol{r}_j$）对粒子 $i$（质量为 $m_i$，位置为 $\\boldsymbol{r}_i$）施加的引力 $\\boldsymbol{F}_{ji}$ 由牛顿万有引力定律给出：\n$$\n\\boldsymbol{F}_{ji} = G \\frac{m_j m_i}{\\left\\lvert\\boldsymbol{r}_j - \\boldsymbol{r}_i\\right\\rvert^3} (\\boldsymbol{r}_j - \\boldsymbol{r}_i)\n$$\n在本问题中，引力常数给定为 $G=1$。目标粒子的质量为 $m_0$，位于原点，因此其位置矢量为 $\\boldsymbol{r}_0 = (0,0,0)$。两个源粒子的质量分别为 $m_1=1$ 和 $m_2=1$，位置分别为 $\\boldsymbol{r}_1 = (10,1,0)$ 和 $\\boldsymbol{r}_2 = (10,-1,0)$。\n\n**1. 精确引力**\n\n作用在目标粒子上的总精确引力 $\\boldsymbol{F}_{\\text{exact}}$ 是来自每个源粒子的单个引力的矢量和：\n$$\n\\boldsymbol{F}_{\\text{exact}} = \\boldsymbol{F}_{10} + \\boldsymbol{F}_{20}\n$$\n其中 $\\boldsymbol{F}_{10}$ 是粒子 1 对粒子 0 的作用力，$\\boldsymbol{F}_{20}$ 是粒子 2 对粒子 0 的作用力。\n\n我们计算单个的力矢量：\n从粒子 1 指向粒子 0 的矢量是 $\\boldsymbol{r}_0 - \\boldsymbol{r}_1 = -\\boldsymbol{r}_1$，但作用在粒子 0 上的力指向粒子 1，因此我们使用矢量 $\\boldsymbol{r}_1 - \\boldsymbol{r}_0 = \\boldsymbol{r}_1$。\n$$\n\\boldsymbol{F}_{10} = G \\frac{m_1 m_0}{\\left\\lvert\\boldsymbol{r}_1 - \\boldsymbol{r}_0\\right\\rvert^3} (\\boldsymbol{r}_1 - \\boldsymbol{r}_0) = (1) \\frac{(1) m_0}{\\left\\lvert\\boldsymbol{r}_1\\right\\rvert^3} \\boldsymbol{r}_1\n$$\n$\\boldsymbol{r}_1$ 的模的平方是 $\\left\\lvert\\boldsymbol{r}_1\\right\\rvert^2 = 10^2 + 1^2 + 0^2 = 101$。因此，$\\left\\lvert\\boldsymbol{r}_1\\right\\rvert = \\sqrt{101}$。\n$$\n\\boldsymbol{F}_{10} = \\frac{m_0}{(\\sqrt{101})^3} (10,1,0) = \\frac{m_0}{101\\sqrt{101}} (10,1,0)\n$$\n类似地，对于粒子 2：\n$$\n\\boldsymbol{F}_{20} = G \\frac{m_2 m_0}{\\left\\lvert\\boldsymbol{r}_2 - \\boldsymbol{r}_0\\right\\rvert^3} (\\boldsymbol{r}_2 - \\boldsymbol{r}_0) = (1) \\frac{(1) m_0}{\\left\\lvert\\boldsymbol{r}_2\\right\\rvert^3} \\boldsymbol{r}_2\n$$\n$\\boldsymbol{r}_2$ 的模的平方是 $\\left\\lvert\\boldsymbol{r}_2\\right\\rvert^2 = 10^2 + (-1)^2 + 0^2 = 101$。因此，$\\left\\lvert\\boldsymbol{r}_2\\right\\rvert = \\sqrt{101}$。\n$$\n\\boldsymbol{F}_{20} = \\frac{m_0}{(\\sqrt{101})^3} (10,-1,0) = \\frac{m_0}{101\\sqrt{101}} (10,-1,0)\n$$\n总的精确引力是其和：\n$$\n\\boldsymbol{F}_{\\text{exact}} = \\boldsymbol{F}_{10} + \\boldsymbol{F}_{20} = \\frac{m_0}{101\\sqrt{101}} \\left[ (10,1,0) + (10,-1,0) \\right] = \\frac{m_0}{101\\sqrt{101}} (20,0,0)\n$$\n所以，$\\boldsymbol{F}_{\\text{exact}} = \\left(\\frac{20m_0}{101\\sqrt{101}}, 0, 0\\right)$。\n\n**2. 单极近似力**\n\n在单极近似中，两个源粒子被一个位于其质心 $\\boldsymbol{R}_{\\text{cm}}$ 的单个点质量 $M$ 所取代。\n总质量为 $M = m_1 + m_2 = 1 + 1 = 2$。\n质心位置为：\n$$\n\\boldsymbol{R}_{\\text{cm}} = \\frac{m_1\\boldsymbol{r}_1 + m_2\\boldsymbol{r}_2}{m_1+m_2} = \\frac{(1)(10,1,0) + (1)(10,-1,0)}{2} = \\frac{(10+10, 1-1, 0+0)}{2} = \\frac{(20,0,0)}{2} = (10,0,0)\n$$\n近似力 $\\boldsymbol{F}_{\\text{mono}}$ 是这个单一点质量对目标粒子施加的力：\n$$\n\\boldsymbol{F}_{\\text{mono}} = G \\frac{M m_0}{\\left\\lvert\\boldsymbol{R}_{\\text{cm}} - \\boldsymbol{r}_0\\right\\rvert^3} (\\boldsymbol{R}_{\\text{cm}} - \\boldsymbol{r}_0) = (1) \\frac{(2)m_0}{\\left\\lvert\\boldsymbol{R}_{\\text{cm}}\\right\\rvert^3} \\boldsymbol{R}_{\\text{cm}}\n$$\n$\\boldsymbol{R}_{\\text{cm}}$ 的模为 $\\left\\lvert\\boldsymbol{R}_{\\text{cm}}\\right\\rvert = \\sqrt{10^2+0^2+0^2} = 10$。\n$$\n\\boldsymbol{F}_{\\text{mono}} = \\frac{2m_0}{10^3} (10,0,0) = \\frac{20m_0}{1000} (1,0,0) = \\frac{m_0}{50} (1,0,0) = \\left(\\frac{m_0}{50}, 0, 0\\right)\n$$\n\n**3. 相对误差**\n\n相对误差 $\\varepsilon$ 定义为 $\\varepsilon \\equiv \\frac{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert}{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}\\right\\rvert}$。\n\n首先，我们求差值矢量：\n$$\n\\boldsymbol{F}_{\\text{exact}} - \\boldsymbol{F}_{\\text{mono}} = \\left(\\frac{20m_0}{101\\sqrt{101}} - \\frac{m_0}{50}\\right) (1,0,0) = m_0 \\left(\\frac{20}{101\\sqrt{101}} - \\frac{1}{50}\\right) (1,0,0)\n$$\n该矢量的模为：\n$$\n\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert = \\left\\lvert m_0 \\left(\\frac{20}{101\\sqrt{101}} - \\frac{1}{50}\\right) \\right\\rvert = m_0 \\left\\lvert \\frac{20 \\cdot 50 - 101\\sqrt{101}}{50 \\cdot 101\\sqrt{101}} \\right\\rvert\n$$\n我们注意到 $101\\sqrt{101} = \\sqrt{101^3} = \\sqrt{1030301} \\approx 1015.04$，而 $20 \\cdot 50 = 1000$。因此，绝对值内的项是负的。\n$$\n\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert = m_0 \\left(\\frac{1}{50} - \\frac{20}{101\\sqrt{101}}\\right)\n$$\n精确力的模为：\n$$\n\\left\\lvert \\boldsymbol{F}_{\\text{exact}}\\right\\rvert = \\left\\lvert \\frac{20m_0}{101\\sqrt{101}} (1,0,0) \\right\\rvert = \\frac{20m_0}{101\\sqrt{101}}\n$$\n现在我们计算比率。因子 $m_0$ 被消去。\n$$\n\\varepsilon = \\frac{m_0 \\left(\\frac{1}{50} - \\frac{20}{101\\sqrt{101}}\\right)}{\\frac{20m_0}{101\\sqrt{101}}} = \\frac{\\frac{1}{50}}{\\frac{20}{101\\sqrt{101}}} - 1 = \\frac{101\\sqrt{101}}{50 \\cdot 20} - 1 = \\frac{101\\sqrt{101}}{1000} - 1\n$$\n我们现在计算数值：\n$$\n\\varepsilon = \\frac{101\\sqrt{101}}{1000} - 1 \\approx \\frac{101 \\times 10.0498756}{1000} - 1 \\approx \\frac{1015.0374377}{1000} - 1 = 1.0150374377 - 1 = 0.0150374377\n$$\n四舍五入到四位有效数字，我们得到 $\\varepsilon \\approx 0.01504$。\n\n为了解释这个结果，我们计算张角 $\\theta=s/d$。源粒子位于 $(10,1,0)$ 和 $(10,-1,0)$。包含它们的最小轴对齐框的尺寸为 $\\Delta x=10-10=0$，$\\Delta y=1-(-1)=2$，$\\Delta z=0-0=0$。单元尺寸 $s$ 是最小边界正方形的边长，即这些尺寸的最大值：$s = \\max(0,2,0) = 2$。从原点到质心的距离是 $d = |\\boldsymbol{R}_{\\text{cm}}| = 10$。\n张角为 $\\theta = s/d = 2/10 = 0.2$。计算出的 $\\varepsilon \\approx 1.5\\%$ 是对此特定几何构型应用单极近似时产生的相对力误差，该几何构型对应于 $\\theta=0.2$ 的张角。对于 Barnes-Hut 张角判据的常见选择（例如 $\\theta_{\\text{crit}} \\le 0.5$），这是一个典型的精度水平。\n最终要求的答案是 $\\varepsilon$ 的数值。",
            "answer": "$$\n\\boxed{0.01504}\n$$"
        },
        {
            "introduction": "在理解了单极子近似后，一个自然的问题是如何提高计算的精度。这个练习将我们引向多极展开中的下一个关键项：四极矩。你将为一个粒子集合计算其质心和四极矩张量，并估算在远场由四极矩引起的引力势修正。这个实践不仅加深了你对多极展开物理意义的理解，也为你将来使用或开发高精度引力树形码提供了必要的计算技能。",
            "id": "3501693",
            "problem": "考虑在数值宇宙学中用于引力计算的 Barnes-Hut (BH) 树算法中的一个牛顿 $N$ 体计算的单个树单元。该单元包含四个质点，其位置 $\\mathbf{x}_a$ 和质量 $m_a$ 以无量纲代码单位给出如下：\n$\\mathbf{x}_1 = (1, 0, 0)$，其质量 $m_1 = 3$；$\\mathbf{x}_2 = (0, 2, 0)$，其质量 $m_2 = 2$；$\\mathbf{x}_3 = (-1, -1, 1)$，其质量 $m_3 = 5$；以及 $\\mathbf{x}_4 = (2, -2, -1)$，其质量 $m_4 = 4$。\n使用牛顿引力和多极展开框架，完成以下任务：\n- 计算该单元的质心位置 $\\mathbf{r}_{\\mathrm{cm}}$。\n- 使用相对于质心测量的坐标 $\\mathbf{y}_a = \\mathbf{x}_a - \\mathbf{r}_{\\mathrm{cm}}$，计算由 $Q_{ij} = \\sum_{a} m_a \\left(3\\,y_{a,i}\\,y_{a,j} - \\delta_{ij}\\,|\\mathbf{y}_a|^2\\right)$ 定义的四极张量，其中 $\\delta_{ij}$ 是克罗内克 δ 符号，且 $|\\mathbf{y}_a|^2 = \\mathbf{y}_a \\cdot \\mathbf{y}_a$。\n- 考虑一个场点，该点位于距离 $\\mathbf{r}_{\\mathrm{cm}}$ 为 $d$ 的位置，方向沿向量 $(1, 2, -1)$。令 $\\mathbf{n} = \\frac{1}{\\sqrt{6}}(1, 2, -1)$ 表示相应的单位向量。假设势由单极项近似，请用引力常数 $G$、距离 $d$ 和计算出的四极张量，来估计主截断误差，该误差定义为该场点引力势的远场多极展开中的下一个非零项。\n所有量均采用无量纲代码单位，引力常数 $G$ 保留为符号。将最终答案表示为一个单个行向量，其中依次包含 $\\mathbf{r}_{\\mathrm{cm}}$ 的三个分量、四极张量的六个独立分量 $(Q_{xx}, Q_{yy}, Q_{zz}, Q_{xy}, Q_{xz}, Q_{yz})$，以及标量主截断误差 $\\Delta \\Phi(d)$。报告精确值（不要四舍五入），并且最终答案中不包含单位。",
            "solution": "该解答按照问题陈述的要求分三个阶段进行。\n\n**计算质心位置**\n\n系统的总质量 $M$ 是各个质量的总和：\n$$M = \\sum_{a=1}^{4} m_a = 3 + 2 + 5 + 4 = 14$$\n质心位置 $\\mathbf{r}_{\\mathrm{cm}}$ 是位置 $\\mathbf{x}_a$ 的质量加权平均值：\n$$\\mathbf{r}_{\\mathrm{cm}} = \\frac{1}{M} \\sum_{a=1}^{4} m_a \\mathbf{x}_a$$\n我们计算总和 $\\sum m_a \\mathbf{x}_a$：\n$$\\sum_{a=1}^{4} m_a \\mathbf{x}_a = m_1\\mathbf{x}_1 + m_2\\mathbf{x}_2 + m_3\\mathbf{x}_3 + m_4\\mathbf{x}_4$$\n$$= 3(1, 0, 0) + 2(0, 2, 0) + 5(-1, -1, 1) + 4(2, -2, -1)$$\n$$= (3, 0, 0) + (0, 4, 0) + (-5, -5, 5) + (8, -8, -4)$$\n$$= (3+0-5+8, \\quad 0+4-5-8, \\quad 0+0+5-4)$$\n$$= (6, -9, 1)$$\n因此，质心位置是：\n$$\\mathbf{r}_{\\mathrm{cm}} = \\frac{1}{14}(6, -9, 1) = \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(\\frac{3}{7}, -\\frac{9}{14}, \\frac{1}{14}\\right)$$\n\n**计算四极张量**\n\n首先，我们必须计算每个质量相对于质心 $\\mathbf{r}_{\\mathrm{cm}} = (\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14})$ 的位置向量 $\\mathbf{y}_a$：\n$$\\mathbf{y}_a = \\mathbf{x}_a - \\mathbf{r}_{\\mathrm{cm}}$$\n$$\\mathbf{y}_1 = (1, 0, 0) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(\\frac{8}{14}, \\frac{9}{14}, -\\frac{1}{14}\\right) = \\frac{1}{14}(8, 9, -1)$$\n$$\\mathbf{y}_2 = (0, 2, 0) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(-\\frac{6}{14}, \\frac{37}{14}, -\\frac{1}{14}\\right) = \\frac{1}{14}(-6, 37, -1)$$\n$$\\mathbf{y}_3 = (-1, -1, 1) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(-\\frac{20}{14}, -\\frac{5}{14}, \\frac{13}{14}\\right) = \\frac{1}{14}(-20, -5, 13)$$\n$$\\mathbf{y}_4 = (2, -2, -1) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(\\frac{22}{14}, -\\frac{19}{14}, -\\frac{15}{14}\\right) = \\frac{1}{14}(22, -19, -15)$$\n\n四极张量定义为 $Q_{ij} = \\sum_a m_a (3 y_{a,i} y_{a,j} - \\delta_{ij} |\\mathbf{y}_a|^2)$。这可以从关于质心的转动惯量张量 $I_{ij} = \\sum_a m_a y_{a,i} y_{a,j}$ 计算得出。四极张量则为 $Q_{ij} = 3I_{ij} - \\delta_{ij} \\mathrm{Tr}(I)$，其中 $\\mathrm{Tr}(I) = \\sum_k I_{kk} = \\sum_a m_a |\\mathbf{y}_a|^2$。\n\n让我们计算 $I_{ij}$ 的分量。令 $y_{a,i}' = 14 y_{a,i}$。\n$I_{ij} = \\frac{1}{14^2} \\sum_a m_a y_{a,i}' y_{a,j}' = \\frac{1}{196} \\sum_a m_a y_{a,i}' y_{a,j}'$。\n$I_{xx} = \\frac{1}{196} [3(8^2) + 2(-6)^2 + 5(-20)^2 + 4(22^2)] = \\frac{1}{196}[192 + 72 + 2000 + 1936] = \\frac{4200}{196} = \\frac{150}{7}$。\n$I_{yy} = \\frac{1}{196} [3(9^2) + 2(37^2) + 5(-5)^2 + 4(-19)^2] = \\frac{1}{196}[243 + 2738 + 125 + 1444] = \\frac{4550}{196} = \\frac{325}{14}$。\n$I_{zz} = \\frac{1}{196} [3(-1)^2 + 2(-1)^2 + 5(13^2) + 4(-15)^2] = \\frac{1}{196}[3 + 2 + 845 + 900] = \\frac{1750}{196} = \\frac{125}{14}$。\n$I_{xy} = \\frac{1}{196} [3(8)(9) + 2(-6)(37) + 5(-20)(-5) + 4(22)(-19)] = \\frac{1}{196}[216 - 444 + 500 - 1672] = \\frac{-1400}{196} = -\\frac{50}{7}$。\n$I_{xz} = \\frac{1}{196} [3(8)(-1) + 2(-6)(-1) + 5(-20)(13) + 4(22)(-15)] = \\frac{1}{196}[-24 + 12 - 1300 - 1320] = \\frac{-2632}{196} = -\\frac{94}{7}$。\n$I_{yz} = \\frac{1}{196} [3(9)(-1) + 2(37)(-1) + 5(-5)(13) + 4(-19)(-15)] = \\frac{1}{196}[-27 - 74 - 325 + 1140] = \\frac{714}{196} = \\frac{51}{14}$。\n\n$I$ 的迹是：\n$\\mathrm{Tr}(I) = I_{xx} + I_{yy} + I_{zz} = \\frac{150}{7} + \\frac{325}{14} + \\frac{125}{14} = \\frac{300}{14} + \\frac{450}{14} = \\frac{750}{14} = \\frac{375}{7}$。\n\n现在我们计算 $Q_{ij}$ 的分量：\n$Q_{xx} = 3I_{xx} - \\mathrm{Tr}(I) = 3\\left(\\frac{150}{7}\\right) - \\frac{375}{7} = \\frac{450 - 375}{7} = \\frac{75}{7}$。\n$Q_{yy} = 3I_{yy} - \\mathrm{Tr}(I) = 3\\left(\\frac{325}{14}\\right) - \\frac{375}{7} = \\frac{975}{14} - \\frac{750}{14} = \\frac{225}{14}$。\n$Q_{zz} = 3I_{zz} - \\mathrm{Tr}(I) = 3\\left(\\frac{125}{14}\\right) - \\frac{375}{7} = \\frac{375}{14} - \\frac{750}{14} = -\\frac{375}{14}$。\n作为检验，$Q$ 的迹是 $Q_{xx} + Q_{yy} + Q_{zz} = \\frac{150}{14} + \\frac{225}{14} - \\frac{375}{14} = 0$，这符合此四极张量定义的要求。\n非对角元是：\n$Q_{xy} = 3I_{xy} = 3\\left(-\\frac{50}{7}\\right) = -\\frac{150}{7}$。\n$Q_{xz} = 3I_{xz} = 3\\left(-\\frac{94}{7}\\right) = -\\frac{282}{7}$。\n$Q_{yz} = 3I_{yz} = 3\\left(\\frac{51}{14}\\right) = \\frac{153}{14}$。\n\n对称四极张量 $Q_{ij}$ 的六个独立分量是 $(Q_{xx}, Q_{yy}, Q_{zz}, Q_{xy}, Q_{xz}, Q_{yz})$。\n\n**计算主截断误差**\n\n引力势 $\\Phi$ 在相对于质心的位置 $\\mathbf{r}$ 处的的多极展开为：\n$$\\Phi(\\mathbf{r}) = -G \\left( \\frac{M}{r} + \\frac{\\mathbf{D} \\cdot \\mathbf{n}}{r^2} + \\frac{1}{2r^3} \\sum_{i,j} n_i Q_{ij} n_j + O(r^{-4}) \\right)$$\n其中 $r=|\\mathbf{r}|$，$\\mathbf{n} = \\mathbf{r}/r$，$M$ 是单极矩（总质量），$\\mathbf{D} = \\sum_a m_a \\mathbf{y}_a$ 是偶极矩，$Q_{ij}$ 是无迹四极张量。\n根据构造，在质心参考系中偶极矩 $\\mathbf{D}$ 为零。问题陈述，势由单极项 $\\Phi_{mono} = -GM/r$ 近似。主截断误差是下一个非零项，即四极项 $\\Phi_{quad}$。\n$$\\Delta \\Phi = \\Phi_{quad}(\\mathbf{r}) = -\\frac{G}{2r^3} \\sum_{i,j} n_i Q_{ij} n_j$$\n场点距离质心的距离为 $d$，所以 $r=d$。方向由单位向量 $\\mathbf{n} = \\frac{1}{\\sqrt{6}}(1, 2, -1)$ 给出。\n我们需要计算二次型 $\\sum_{i,j} n_i Q_{ij} n_j = \\mathbf{n}^T Q \\mathbf{n}$。\n$$\\mathbf{n}^T Q \\mathbf{n} = \\frac{1}{(\\sqrt{6})^2} (1, 2, -1) \\begin{pmatrix} Q_{xx}  Q_{xy}  Q_{xz} \\\\ Q_{xy}  Q_{yy}  Q_{yz} \\\\ Q_{xz}  Q_{yz}  Q_{zz} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ -1 \\end{pmatrix}$$\n$$ = \\frac{1}{6} (Q_{xx} \\cdot 1^2 + Q_{yy} \\cdot 2^2 + Q_{zz} \\cdot (-1)^2 + 2Q_{xy} \\cdot 1 \\cdot 2 + 2Q_{xz} \\cdot 1 \\cdot (-1) + 2Q_{yz} \\cdot 2 \\cdot (-1))$$\n$$ = \\frac{1}{6} (Q_{xx} + 4Q_{yy} + Q_{zz} + 4Q_{xy} - 2Q_{xz} - 4Q_{yz})$$\n代入计算出的 $Q_{ij}$ 的值：\n$$ = \\frac{1}{6} \\left( \\frac{75}{7} + 4\\left(\\frac{225}{14}\\right) - \\frac{375}{14} + 4\\left(-\\frac{150}{7}\\right) - 2\\left(-\\frac{282}{7}\\right) - 4\\left(\\frac{153}{14}\\right) \\right)$$\n$$ = \\frac{1}{6} \\left( \\frac{150}{14} + \\frac{900}{14} - \\frac{375}{14} - \\frac{1200}{14} + \\frac{1128}{14} - \\frac{612}{14} \\right)$$\n$$ = \\frac{1}{6} \\cdot \\frac{1}{14} (150 + 900 - 375 - 1200 + 1128 - 612)$$\n$$ = \\frac{1}{84} (2178 - 2187) = \\frac{-9}{84} = -\\frac{3}{28}$$\n那么主截断误差是：\n$$\\Delta \\Phi(d) = -\\frac{G}{2d^3} \\left(-\\frac{3}{28}\\right) = \\frac{3G}{56d^3}$$\n\n最终答案是一个行向量，包含 $\\mathbf{r}_{\\mathrm{cm}}$ 的三个分量、$Q_{ij}$ 的六个独立分量，以及标量 $\\Delta \\Phi(d)$。\n这些分量是：\n1. $\\mathbf{r}_{\\mathrm{cm},x} = \\frac{3}{7}$\n2. $\\mathbf{r}_{\\mathrm{cm},y} = -\\frac{9}{14}$\n3. $\\mathbf{r}_{\\mathrm{cm},z} = \\frac{1}{14}$\n4. $Q_{xx} = \\frac{75}{7}$\n5. $Q_{yy} = \\frac{225}{14}$\n6. $Q_{zz} = -\\frac{375}{14}$\n7. $Q_{xy} = -\\frac{150}{7}$\n8. $Q_{xz} = -\\frac{282}{7}$\n9. $Q_{yz} = \\frac{153}{14}$\n10. $\\Delta\\Phi(d) = \\frac{3G}{56d^3}$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{3}{7}  -\\frac{9}{14}  \\frac{1}{14}  \\frac{75}{7}  \\frac{225}{14}  -\\frac{375}{14}  -\\frac{150}{7}  -\\frac{282}{7}  \\frac{153}{14}  \\frac{3G}{56d^3} \\end{pmatrix} } $$"
        },
        {
            "introduction": "现在，我们将前面学到的概念整合起来，模拟一个完整的Barnes–Hut树遍历过程。在这个练习中，你将扮演一个计算程序，为一个给定的目标粒子“行走”在一个预先构建好的八叉树上。你需要根据打开准则（opening-angle criterion）在每个节点做出决策：是使用该节点的单极子近似，还是继续深入其子节点。这个综合性练习将使你对Barnes–Hut算法的动态决策过程有一个具体而深刻的认识。",
            "id": "3501671",
            "problem": "在一个以无量纲代码单位演化的无碰撞引力系统中，考虑使用Barnes-Hut (BH) 树近似方法计算一个目标测试粒子所受的引力加速度。引力常数 $G=1$。计算域是一个边长为 $8$ 的立方体，每个维度的坐标范围为 $[0,8]$。根节点（单元）的几何中心位于 $(4,4,4)$，边长为 $w_0=8$，它被细分为 $8$ 个边长为 $4$ 的八分象限，其几何中心通常位于 $(2,2,2)$、$(6,2,2)$、$(2,6,2)$、$(6,6,2)$、$(2,2,6)$、$(6,2,6)$、$(2,6,6)$、$(6,6,6)$。八叉树通过递归地细分任何被占据的节点来构建，直到每个叶节点最多只包含 $1$ 个粒子。\n\n这个 $N$ 体系统包含以下粒子，其位置为 $\\mathbf{r}_i$，质量为 $m_i$：\n- 一个粒子位于 $(7,1,1)$，质量 $m=2$，在以 $(6,2,2)$ 为中心的八分象限内。\n- 一个粒子位于 $(1,7,1)$，质量 $m=3$，在以 $(2,6,2)$ 为中心的八分象限内。\n- 一个粒子位于 $(1,1,7)$，质量 $m=4$，在以 $(2,2,6)$ 为中心的八分象限内。\n- 三个粒子在以 $(6,6,6)$ 为中心、边长为 $4$ 的八分象限内形成一个紧凑群组，它们分别位于 $(5.5,5.5,5.5)$（质量 $m=1$）、$(6.5,6.0,6.0)$（质量 $m=1.5$）和 $(6.0,6.5,6.0)$（质量 $m=2$）。这个八分象限被进一步细分，直到这三个粒子中的每一个都单独存在于一个叶节点中。\n\n一个目标测试粒子（不包含在上述六个粒子中）位于 $\\mathbf{r}_{\\mathrm{t}}=(1,1,1)$。使用标准的 Barnes–Hut 张角判据，如果一个边长为 $w$、质心位置为 $\\mathbf{R}_{\\mathrm{com}}$ 的内部节点满足以下条件，则接受该节点：\n$$\n\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{com}}|} \\le \\theta,\n$$\n其中张角 $\\theta=0.5$。如果一个内部节点未被接受，则下降到其子节点。如果到达一个不包含目标的叶节点，则计算其粒子的直接贡献。对于任何被接受的内部节点，将其贡献近似为一个位于其质心的单极子，其总质量等于其组成粒子的质量之和。忽略任何自相互作用；不使用引力软化。\n\n从牛顿万有引力定律和上述树遍历规则出发，通过对接受的节点单极子贡献和直接的叶节点相互作用求和，遍历树来计算目标粒子所受的总引力加速度。使用 $G=1$，并将最终的加速度矢量以代码单位表示为一个行矩阵 $\\begin{pmatrix}a_x  a_y  a_z\\end{pmatrix}$。将最终数值答案四舍五入至四位有效数字。不涉及角度。",
            "solution": "根据牛顿万有引力定律，位于位置 $\\mathbf{R}$、质量为 $M$ 的源对位于 $\\mathbf{r}_{\\mathrm{t}}$ 的目标粒子施加的引力加速度 $\\mathbf{a}$ 为（当 $G=1$ 时）：\n$$\n\\mathbf{a} = \\frac{M (\\mathbf{R} - \\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{R} - \\mathbf{r}_{\\mathrm{t}}|^3}\n$$\n总加速度是由 BH 树遍历确定的所有节点贡献的矢量和。目标粒子位于 $\\mathbf{r}_{\\mathrm{t}}=(1,1,1)$。\n\n遍历从八叉树的根节点开始。\n\n**根节点分析：**\n根节点包含整个计算域，边长为 $w_0=8$。它包含所有 $N=6$ 个粒子。我们必须首先确定这个节点是否可以近似为一个单极子。\n系统的总质量：\n$M_{\\mathrm{root}} = \\sum_{i=1}^{6} m_i = 2+3+4+1+1.5+2 = 13.5$。\n质心 $\\mathbf{R}_{\\mathrm{root}}$ 为：\n$\\mathbf{R}_{\\mathrm{root}} = \\frac{1}{M_{\\mathrm{root}}} \\sum_{i=1}^{6} m_i \\mathbf{r}_i$\n$\\sum m_i \\mathbf{r}_i = 2(7,1,1) + 3(1,7,1) + 4(1,1,7) + 1(5.5,5.5,5.5) + 1.5(6.5,6,6) + 2(6,6.5,6)$\n$= (14,2,2) + (3,21,3) + (4,4,28) + (5.5,5.5,5.5) + (9.75,9,9) + (12,13,12)$\n$= (48.25, 54.5, 59.5)$\n$\\mathbf{R}_{\\mathrm{root}} = \\frac{1}{13.5}(48.25, 54.5, 59.5) \\approx (3.574, 4.037, 4.407)$。\n目标粒子到根节点质心的距离为：\n$|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{root}}| = |(1,1,1) - (3.574, 4.037, 4.407)| = |(-2.574, -3.037, -3.407)|$\n$= \\sqrt{(-2.574)^2 + (-3.037)^2 + (-3.407)^2} \\approx \\sqrt{6.626 + 9.223 + 11.608} = \\sqrt{27.457} \\approx 5.240$。\n应用张角判据：\n$\\frac{w_0}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{root}}|} = \\frac{8}{5.240} \\approx 1.527$。\n由于 $1.527 > \\theta=0.5$，根节点未被接受。我们必须下降到其子节点，即边长为 $w=4$ 的 $8$ 个八分象限。我们只考虑四个被占据的八分象限。\n\n**根节点的子节点（$w=4$ 的八分象限）：**\n\n1.  **包含 P1 的节点：** 此节点对应八分象限 $[4,8]\\times[0,4]\\times[0,4]$，仅包含位于 $\\mathbf{r}_1=(7,1,1)$、质量为 $m_1=2$ 的粒子 P1。该节点的质心为 $\\mathbf{R}_{\\mathrm{com}}=\\mathbf{r}_1$，总质量为 $M=m_1$。\n    距离为 $|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_1| = \\sqrt{(1-7)^2+(1-1)^2+(1-1)^2} = \\sqrt{(-6)^2} = 6$。\n    判据检查：$\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_1|} = \\frac{4}{6} \\approx 0.667 > 0.5$。此节点未被接受。我们必须打开它。\n    该节点的子节点是一个边长为 $w'=2$、仅包含 P1 的更小单元。\n    对子节点的判据检查：$\\frac{w'}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_1|} = \\frac{2}{6} \\approx 0.333 \\le 0.5$。此节点被接受。其贡献相当于一个位于 $\\mathbf{r}_1$、质量为 $m_1$ 的单极子，也就是直接相互作用。\n    $\\mathbf{a}_1 = \\frac{m_1(\\mathbf{r}_1-\\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{r}_1-\\mathbf{r}_{\\mathrm{t}}|^3} = \\frac{2((7,1,1)-(1,1,1))}{6^3} = \\frac{2(6,0,0)}{216} = (\\frac{12}{216}, 0, 0) = (\\frac{1}{18}, 0, 0)$。\n\n2.  **包含 P2 的节点：** 此节点对应八分象限 $[0,4]\\times[4,8]\\times[0,4]$，仅包含位于 $\\mathbf{r}_2=(1,7,1)$、质量为 $m_2=3$ 的粒子 P2。质心为 $\\mathbf{r}_2$。\n    距离为 $|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_2| = \\sqrt{(1-1)^2+(1-7)^2+(1-1)^2} = \\sqrt{(-6)^2} = 6$。\n    判据检查：$\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_2|} = \\frac{4}{6} > 0.5$。未被接受。下降到边长为 $w'=2$ 的子节点。\n    对子节点的判据检查：$\\frac{w'}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_2|} = \\frac{2}{6} \\le 0.5$。被接受。\n    $\\mathbf{a}_2 = \\frac{m_2(\\mathbf{r}_2-\\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{r}_2-\\mathbf{r}_{\\mathrm{t}}|^3} = \\frac{3((1,7,1)-(1,1,1))}{6^3} = \\frac{3(0,6,0)}{216} = (0, \\frac{18}{216}, 0) = (0, \\frac{1}{12}, 0)$。\n\n3.  **包含 P3 的节点：** 此节点对应八分象限 $[0,4]\\times[0,4]\\times[4,8]$，仅包含位于 $\\mathbf{r}_3=(1,1,7)$、质量为 $m_3=4$ 的粒子 P3。质心为 $\\mathbf{r}_3$。\n    距离为 $|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_3| = \\sqrt{(1-1)^2+(1-1)^2+(1-7)^2} = \\sqrt{(-6)^2} = 6$。\n    判据检查：$\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_3|} = \\frac{4}{6} > 0.5$。未被接受。下降到边长为 $w'=2$ 的子节点。\n    对子节点的判据检查：$\\frac{w'}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_3|} = \\frac{2}{6} \\le 0.5$。被接受。\n    $\\mathbf{a}_3 = \\frac{m_3(\\mathbf{r}_3-\\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{r}_3-\\mathbf{r}_{\\mathrm{t}}|^3} = \\frac{4((1,1,7)-(1,1,1))}{6^3} = \\frac{4(0,0,6)}{216} = (0, 0, \\frac{24}{216}) = (0, 0, \\frac{1}{9})$。\n\n4.  **包含群组（P4, P5, P6）的节点：** 这个内部节点对应边长为 $w=4$ 的八分象限 $[4,8]\\times[4,8]\\times[4,8]$。它包含三个粒子。\n    总质量：$M_{\\mathrm{grp}} = m_4+m_5+m_6 = 1+1.5+2 = 4.5$。\n    质心 $\\mathbf{R}_{\\mathrm{grp}} = \\frac{1}{M_{\\mathrm{grp}}}(m_4\\mathbf{r}_4+m_5\\mathbf{r}_5+m_6\\mathbf{r}_6)$。\n    $m_4\\mathbf{r}_4+m_5\\mathbf{r}_5+m_6\\mathbf{r}_6 = 1(5.5,5.5,5.5) + 1.5(6.5,6.0,6.0) + 2(6.0,6.5,6.0)$\n    $= (5.5,5.5,5.5) + (9.75,9.0,9.0) + (12.0,13.0,12.0) = (27.25, 27.5, 26.5)$。\n    $\\mathbf{R}_{\\mathrm{grp}} = \\frac{1}{4.5}(27.25, 27.5, 26.5) = (\\frac{109}{18}, \\frac{55}{9}, \\frac{53}{9}) \\approx (6.0556, 6.1111, 5.8889)$。\n    位移矢量和距离为：\n    $\\mathbf{d}_{\\mathrm{grp}} = \\mathbf{R}_{\\mathrm{grp}} - \\mathbf{r}_{\\mathrm{t}} = (\\frac{109}{18}-1, \\frac{55}{9}-1, \\frac{53}{9}-1) = (\\frac{91}{18}, \\frac{46}{9}, \\frac{44}{9}) \\approx (5.0556, 5.1111, 4.8889)$。\n    $|\\mathbf{d}_{\\mathrm{grp}}| = \\sqrt{(\\frac{91}{18})^2 + (\\frac{46}{9})^2 + (\\frac{44}{9})^2} = \\sqrt{25.5586 + 26.1235 + 23.9012} \\approx \\sqrt{75.5833} \\approx 8.6939$。\n    判据检查：$\\frac{w}{|\\mathbf{d}_{\\mathrm{grp}}|} = \\frac{4}{8.6939} \\approx 0.4601 \\le 0.5$。\n    满足判据。此节点被接受并被视为一个单极子。\n    $\\mathbf{a}_{\\mathrm{grp}} = \\frac{M_{\\mathrm{grp}}\\mathbf{d}_{\\mathrm{grp}}}{|\\mathbf{d}_{\\mathrm{grp}}|^3} = \\frac{4.5}{(8.6939)^3}(5.0556, 5.1111, 4.8889)$。\n    $|\\mathbf{d}_{\\mathrm{grp}}|^3 \\approx 657.07$。\n    $\\mathbf{a}_{\\mathrm{grp}} \\approx \\frac{4.5}{657.07}(5.0556, 5.1111, 4.8889) \\approx 0.0068485 (5.0556, 5.1111, 4.8889)$。\n    $\\mathbf{a}_{\\mathrm{grp}} \\approx (0.034621, 0.034999, 0.033480)$。\n\n**总加速度：**\n总加速度是各个贡献的总和：\n$\\mathbf{a}_{\\mathrm{total}} = \\mathbf{a}_1 + \\mathbf{a}_2 + \\mathbf{a}_3 + \\mathbf{a}_{\\mathrm{grp}}$。\n$\\mathbf{a}_1 = (\\frac{1}{18}, 0, 0) \\approx (0.055556, 0, 0)$。\n$\\mathbf{a}_2 = (0, \\frac{1}{12}, 0) \\approx (0, 0.083333, 0)$。\n$\\mathbf{a}_3 = (0, 0, \\frac{1}{9}) \\approx (0, 0, 0.111111)$。\n将各分量相加：\n$a_x = \\frac{1}{18} + 0.034621 \\approx 0.055556 + 0.034621 = 0.090177$。\n$a_y = \\frac{1}{12} + 0.034999 \\approx 0.083333 + 0.034999 = 0.118332$。\n$a_z = \\frac{1}{9} + 0.033480 \\approx 0.111111 + 0.033480 = 0.144591$。\n总加速度矢量约为 $(0.090177, 0.118332, 0.144591)$。\n\n将每个分量四舍五入到四位有效数字：\n$a_x \\approx 0.09018$。\n$a_y \\approx 0.1183$。\n$a_z \\approx 0.1446$。\n最终结果按要求以行矩阵形式呈现。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.09018  0.1183  0.1446 \\end{pmatrix}}\n$$"
        }
    ]
}