{
    "hands_on_practices": [
        {
            "introduction": "无碰撞玻尔兹曼方程描述了无碰撞粒子分布的演化，其本质是分布函数沿粒子轨迹（特征线）守恒。因此，理解这些轨迹及其守恒量（运动积分）是基础的第一步。本练习将使用一个辛积分器来数值验证这些守恒定律，从而在哈密顿力学和弗拉索夫方程之间建立一座桥梁。",
            "id": "3494458",
            "problem": "考虑牛顿引力下的无碰撞玻尔兹曼（弗拉索夫）方程，描述一个无碰撞系统，其相空间分布函数为 $f(\\mathbf{x},\\mathbf{v},t)$，引力势为不依赖于时间的 $\\Phi(\\mathbf{x})$。$f$ 的演化满足\n$$\n\\frac{\\partial f}{\\partial t} + \\mathbf{v}\\cdot\\nabla_{\\mathbf{x}} f - \\nabla_{\\mathbf{x}}\\Phi(\\mathbf{x})\\cdot\\nabla_{\\mathbf{v}} f = 0,\n$$\n特征线法将该问题简化为求解特征常微分方程组\n$$\n\\frac{d\\mathbf{x}}{dt} = \\mathbf{v},\\qquad \\frac{d\\mathbf{v}}{dt} = -\\nabla_{\\mathbf{x}} \\Phi(\\mathbf{x}).\n$$\n根据第一性原理，任何沿特征线为常数的标量 $Q(\\mathbf{x},\\mathbf{v},t)$，当沿特征方程的解进行计算时，都必须满足 $\\frac{dQ}{dt}=0$。在不依赖于时间的势中，总能量是这种不变量的候选者；当存在适当的对称性时，角动量的分量也是。\n\n您的任务是：\n- 基于特征线法和牛顿第二定律，推导在不依赖于时间的势 $\\Phi(\\mathbf{x})$ 中沿粒子轨迹守恒的解析不变量，以及角动量分量守恒所需的对称性条件。\n- 实现一个辛蛙跳（kick-drift-kick）积分器，用以在给定的不依赖于时间的势中，计算二维空间 $\\mathbf{x}=(x,y)$ 中粒子（速度为 $\\mathbf{v}=(v_x,v_y)$）的轨迹。使用此数值积分器来评估沿数值近似的特征线，不变量的守恒质量。\n\n所有计算均应在无量纲的代码单位中执行（无物理单位）。不直接使用角度。对于任何类似百分比的比较，请以小数形式报告（例如，使用 $0.01$ 而不是带百分号的 $1$）。\n\n使用以下（均为不依赖于时间的）势 $\\Phi(\\mathbf{x})$、其对应的梯度 $\\nabla_{\\mathbf{x}}\\Phi(\\mathbf{x})$ 和初始条件作为测试套件：\n- 测试用例 1（自由粒子）：$\\Phi(\\mathbf{x})=0$。初始条件 $\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,0.5)$。\n- 测试用例 2（中心谐振子）：$\\Phi(\\mathbf{x})=\\tfrac{1}{2}\\,\\omega^2 r^2$，其中 $r=\\sqrt{x^2+y^2}$ 且 $\\omega=0.5$。初始条件 $\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,0.8)$。\n- 测试用例 3（开普勒势）：$\\Phi(\\mathbf{x})=-GM/r$，其中 $GM=1$ 且 $r=\\sqrt{x^2+y^2}$。初始条件 $\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,1)$。\n- 测试用例 4（各向异性谐振子，轴对称性破缺）：$\\Phi(\\mathbf{x})=\\tfrac{1}{2}(\\omega_x^2 x^2+\\omega_y^2 y^2)$，其中 $\\omega_x=1$ 且 $\\omega_y=1.3$。初始条件 $\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,1)$。\n- 测试用例 5（中心谐振子，径向运动）：$\\Phi(\\mathbf{x})=\\tfrac{1}{2}\\,\\omega^2 r^2$，其中 $\\omega=0.5$。初始条件 $\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(-0.5,0)$。\n\n对于每个测试用例，使用 kick-drift-kick 蛙跳法在总时间 $T=30$ 内积分特征方程，固定时间步长为 $\\Delta t=0.005$（即 $N=T/\\Delta t=6000$ 步）。沿每条数值计算出的轨迹，在每一步计算：\n- 总比能 $E$（单位质量的能量）。\n- 比角动量的 $z$ 分量 $L_z$（单位质量的角动量），适用于 $x$–$y$ 平面内的运动。\n\n使用以下度量来量化守恒性：\n- 对于量 $Q\\in\\{E,L_z\\}$，其初始值为 $Q_0$，计算最大漂移 $\\max_t |Q(t)-Q_0|$。如果 $|Q_0|\\ge Q_{\\min}$（其中 $Q_{\\min}=10^{-12}$），则计算相对漂移 $\\max_t |Q(t)-Q_0|/|Q_0|$。如果 $|Q_0|",
            "solution": "所提出的问题是计算物理学中一个明确定义的练习，特别是在数值宇宙学和天体物理学的背景下。它要求分两部分作答：首先，对不依赖于时间的势中粒子运动的守恒量进行理论推导；其次，使用一个辛积分器对几个测试用例中的这些守恒律进行数值验证。\n\n### 问题验证\n\n1.  **提取已知条件**：\n    -   **控制方程**：描述相空间分布函数 $f(\\mathbf{x},\\mathbf{v},t)$ 在不依赖于时间的势 $\\Phi(\\mathbf{x})$ 中的无碰撞玻尔兹曼（弗拉索夫）方程：$\\frac{\\partial f}{\\partial t} + \\mathbf{v}\\cdot\\nabla_{\\mathbf{x}} f - \\nabla_{\\mathbf{x}}\\Phi(\\mathbf{x})\\cdot\\nabla_{\\mathbf{v}} f = 0$。\n    -   **特征方程**：$\\frac{d\\mathbf{x}}{dt} = \\mathbf{v}$，$\\frac{d\\mathbf{v}}{dt} = -\\nabla_{\\mathbf{x}} \\Phi(\\mathbf{x})$。\n    -   **不变量的定义**：如果一个量 $Q$ 的全时间导数 $\\frac{dQ}{dt}$ 沿特征线为零，则它是一个不变量。\n    -   **数值方法**：辛蛙跳（kick-drift-kick）积分器。\n    -   **模拟参数**：总时间 $T=30$，时间步长 $\\Delta t=0.005$，步数 $N=6000$。\n    -   **测试用例（势 $\\Phi(\\mathbf{x})$ 和初始条件 $(\\mathbf{x}_0, \\mathbf{v}_0)$）**：\n        1.  **自由粒子**：$\\Phi(\\mathbf{x})=0$；$\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,0.5)$。\n        2.  **中心谐振子**：$\\Phi(\\mathbf{x})=\\tfrac{1}{2}\\,\\omega^2 r^2$，$\\omega=0.5$；$\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,0.8)$。\n        3.  **开普勒势**：$\\Phi(\\mathbf{x})=-GM/r$，GM=1；$\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,1)$。\n        4.  **各向异性谐振子**：$\\Phi(\\mathbf{x})=\\tfrac{1}{2}(\\omega_x^2 x^2+\\omega_y^2 y^2)$，$\\omega_x=1, \\omega_y=1.3$；$\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(0,1)$。\n        5.  **径向中心谐振子**：$\\Phi(\\mathbf{x})=\\tfrac{1}{2}\\,\\omega^2 r^2$，$\\omega=0.5$；$\\mathbf{x}_0=(1,0)$，$\\mathbf{v}_0=(-0.5,0)$。\n    -   **要监控的量**：比能 $E$，比角动量 $z$ 分量 $L_z$。\n    -   **守恒度量**：最大漂移 $\\max_t |Q(t)-Q_0|$。如果 $|Q_0|\\ge Q_{\\min}=10^{-12}$，则漂移是相对于 $|Q_0|$ 的相对漂移；否则为绝对漂移。\n    -   **守恒阈值**：能量为 $\\varepsilon_E=10^{-4}$，角动量为 $\\varepsilon_L=10^{-4}$。\n    -   **要求输出**：一个包含 10 个布尔值（True/False）的列表，指示 5 个测试用例中每个用例的 $E$ 和 $L_z$ 的守恒情况。\n\n2.  **使用提取的已知条件进行验证**：\n    -   **科学依据**：该问题基于经典力学的基本原理（牛顿引力、能量守恒、角动量守恒）和天体物理学中使用的标准数值方法（辛积分）。所有概念都是标准的，并且在事实上是正确的。\n    -   **适定性**：该问题提供了所有必要信息：微分方程（通过势）、初始条件、积分算法和精确的评估标准。对于每个测试用例，都存在一个唯一且有意义的数值解。\n    -   **客观性**：问题陈述使用了精确、无歧义的数学和计算语言。所有评估标准都是定量的。\n\n3.  **结论与行动**：该问题是有效的。这是一个计算物理学中标准的、适定的问题，结合了理论推导与数值实现和验证。我将继续进行详细解答。\n\n### 第一部分：解析不变量的推导\n\n运动不变量（或运动常数）是相空间坐标的函数 $Q(\\mathbf{x}, \\mathbf{v})$，它在粒子轨迹上保持恒定。其全时间导数必须为零：\n$$\n\\frac{dQ}{dt} = 0\n$$\n使用多变量链式法则，可以展开为：\n$$\n\\frac{dQ}{dt} = \\sum_i \\frac{\\partial Q}{\\partial x_i}\\frac{dx_i}{dt} + \\sum_i \\frac{\\partial Q}{\\partial v_i}\\frac{dv_i}{dt} = \\nabla_{\\mathbf{x}}Q \\cdot \\frac{d\\mathbf{x}}{dt} + \\nabla_{\\mathbf{v}}Q \\cdot \\frac{d\\mathbf{v}}{dt}\n$$\n代入特征方程 $\\frac{d\\mathbf{x}}{dt} = \\mathbf{v}$ 和 $\\frac{d\\mathbf{v}}{dt} = -\\nabla_{\\mathbf{x}}\\Phi$，我们得到不变量的条件：\n$$\n\\nabla_{\\mathbf{x}}Q \\cdot \\mathbf{v} + \\nabla_{\\mathbf{v}}Q \\cdot (-\\nabla_{\\mathbf{x}}\\Phi) = 0\n$$\n\n**1. 比能守恒**\n\n粒子的比能（单位质量的能量）是其比动能和势能之和：\n$$\nE(\\mathbf{x}, \\mathbf{v}) = \\frac{1}{2}|\\mathbf{v}|^2 + \\Phi(\\mathbf{x}) = \\frac{1}{2}\\sum_i v_i^2 + \\Phi(x_1, x_2, \\dots)\n$$\n为了检查 $E$ 是否为不变量，我们计算其全时间导数：\n$$\n\\frac{dE}{dt} = \\nabla_{\\mathbf{x}}E \\cdot \\mathbf{v} + \\nabla_{\\mathbf{v}}E \\cdot (-\\nabla_{\\mathbf{x}}\\Phi)\n$$\n所需的梯度为：\n$$\n\\nabla_{\\mathbf{x}}E = \\nabla_{\\mathbf{x}}\\left(\\frac{1}{2}|\\mathbf{v}|^2 + \\Phi(\\mathbf{x})\\right) = \\nabla_{\\mathbf{x}}\\Phi(\\mathbf{x})\n$$\n$$\n\\nabla_{\\mathbf{v}}E = \\nabla_{\\mathbf{v}}\\left(\\frac{1}{2}\\sum_i v_i^2 + \\Phi(\\mathbf{x})\\right) = \\mathbf{v}\n$$\n将这些梯度代入 $\\frac{dE}{dt}$ 的表达式中：\n$$\n\\frac{dE}{dt} = (\\nabla_{\\mathbf{x}}\\Phi) \\cdot \\mathbf{v} + \\mathbf{v} \\cdot (-\\nabla_{\\mathbf{x}}\\Phi) = (\\nabla_{\\mathbf{x}}\\Phi) \\cdot \\mathbf{v} - \\mathbf{v} \\cdot (\\nabla_{\\mathbf{x}}\\Phi) = 0\n$$\n因此，对于任何不依赖于时间的势 $\\Phi(\\mathbf{x})$，比能 $E$ 都是守恒的。这适用于所有五个给定的测试用例。\n\n**2. 比角动量守恒**\n\n比角动量矢量定义为 $\\mathbf{L} = \\mathbf{x} \\times \\mathbf{v}$。其全时间导数为：\n$$\n\\frac{d\\mathbf{L}}{dt} = \\frac{d}{dt}(\\mathbf{x} \\times \\mathbf{v}) = \\frac{d\\mathbf{x}}{dt} \\times \\mathbf{v} + \\mathbf{x} \\times \\frac{d\\mathbf{v}}{dt}\n$$\n代入特征方程：\n$$\n\\frac{d\\mathbf{L}}{dt} = \\mathbf{v} \\times \\mathbf{v} + \\mathbf{x} \\times (-\\nabla_{\\mathbf{x}}\\Phi)\n$$\n由于任何矢量与其自身的叉积为零（$\\mathbf{v} \\times \\mathbf{v} = \\mathbf{0}$），上式简化为：\n$$\n\\frac{d\\mathbf{L}}{dt} = -\\mathbf{x} \\times \\nabla_{\\mathbf{x}}\\Phi\n$$\n矢量 $\\mathbf{\\tau} = \\mathbf{x} \\times \\mathbf{F}$（其中力为 $\\mathbf{F} = -\\nabla_{\\mathbf{x}}\\Phi$）代表比力矩。要使 $\\mathbf{L}$ 成为运动常数，其导数必须为零，这要求比力矩为零：$\\mathbf{x} \\times \\nabla_{\\mathbf{x}}\\Phi = \\mathbf{0}$。当且仅当势的梯度 $\\nabla_{\\mathbf{x}}\\Phi$ 与位置矢量 $\\mathbf{x}$ 平行时，此条件才满足。这是中心力的定义，它源于球对称势，即仅依赖于径向距离 $r=|\\mathbf{x}|$ 的势，使得 $\\Phi(\\mathbf{x}) = \\Phi(r)$。\n\n对于 $x$-$y$ 平面内的二维运动，我们关心的是角动量的 $z$ 分量，$L_z = x v_y - y v_x$。\n$$\n\\frac{dL_z}{dt} = \\frac{d}{dt}(x v_y - y v_x) = (\\dot{x}v_y + x\\dot{v}_y) - (\\dot{y}v_x + y\\dot{v}_x)\n$$\n代入 $\\dot{x}=v_x$, $\\dot{y}=v_y$, $\\dot{v}_x = -\\partial_x\\Phi$ 和 $\\dot{v}_y=-\\partial_y\\Phi$：\n$$\n\\frac{dL_z}{dt} = (v_x v_y - x \\partial_y\\Phi) - (v_y v_x - y \\partial_x\\Phi) = y \\partial_x\\Phi - x \\partial_y\\Phi\n$$\n如果势是球对称的，该项为零。我们来分析这些测试用例：\n- 用例 1、2、3、5 涉及的势仅为 $r$ 的函数（$\\Phi=0$, $\\Phi=\\tfrac{1}{2}\\omega^2 r^2$, $\\Phi=-GM/r$）。这些势是球对称的，因此 $L_z$ 是一个解析不变量。\n- 用例 4 涉及的势为 $\\Phi(\\mathbf{x})=\\tfrac{1}{2}(\\omega_x^2 x^2+\\omega_y^2 y^2)$。这里，$\\partial_x\\Phi = \\omega_x^2 x$ 且 $\\partial_y\\Phi = \\omega_y^2 y$。$L_z$ 的变化率为：\n  $$ \\frac{dL_z}{dt} = y(\\omega_x^2 x) - x(\\omega_y^2 y) = xy(\\omega_x^2 - \\omega_y^2) $$\n  由于 $\\omega_x \\neq \\omega_y$，除非粒子沿坐标轴之一运动（$x=0$ 或 $y=0$），否则 $L_z$ 不守恒。对于给定的初始条件，轨道是一般性的，因此 $L_z$ 不会守恒。\n\n### 第二部分：数值积分与验证\n\n我们使用 kick-drift-kick (KDK) 蛙跳算法，这是一种二阶辛积分器。给定在时间 $t_n$ 的状态 $(\\mathbf{x}_n, \\mathbf{v}_n)$，在 $t_{n+1} = t_n + \\Delta t$ 的状态计算如下：\n1.  **踢（半步）**：$\\mathbf{v}_{n+1/2} = \\mathbf{v}_n + \\mathbf{a}(\\mathbf{x}_n) \\frac{\\Delta t}{2}$\n2.  **漂移（全步）**：$\\mathbf{x}_{n+1} = \\mathbf{x}_n + \\mathbf{v}_{n+1/2} \\Delta t$\n3.  **踢（半步）**：$\\mathbf{v}_{n+1} = \\mathbf{v}_{n+1/2} + \\mathbf{a}(\\mathbf{x}_{n+1}) \\frac{\\Delta t}{2}$\n其中 $\\mathbf{a}(\\mathbf{x}) = -\\nabla_{\\mathbf{x}}\\Phi(\\mathbf{x})$ 是加速度。此方法非常适用于哈密顿系统，因为它能在长时间内近似地守恒能量（误差有界），并且在中心势中能精确守恒角动量等其他不变量。\n\n我们将为每个测试用例实现此算法，沿轨迹追踪 $E$ 和 $L_z$ 的值，并计算它们相对于初始值的最大漂移。最终的布尔值将指示这些漂移是否在指定容差范围内。对于各向异性情况，正如我们解析推导的那样，我们预计 $L_z$ 守恒检查会失败。对于径向运动情况，初始角动量 $L_{z,0}=0$。问题的对称性将使轨迹保持在 x 轴上，因此 $L_z$ 应在机器精度范围内保持为零。对于这种情况，守恒检查将使用绝对漂移。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    T = 30.0\n    dt = 0.005\n    eps_E = 1e-4\n    eps_L = 1e-4\n    Q_min = 1e-12\n\n    def run_simulation(x0, v0, phi_func, a_func, T, dt, eps_E, eps_L, Q_min):\n        \"\"\"\n        Integrates a particle's trajectory using the leapfrog method\n        and checks for conservation of energy and angular momentum.\n        \"\"\"\n        n_steps = int(T / dt)\n        x = np.copy(x0)\n        v = np.copy(v0)\n\n        # Initial values of invariants\n        E0 = 0.5 * np.dot(v, v) + phi_func(x)\n        Lz0 = x[0] * v[1] - x[1] * v[0]\n        \n        E_hist = [E0]\n        Lz_hist = [Lz0]\n\n        for _ in range(n_steps):\n            # Kick-Drift-Kick Leapfrog\n            v_half = v + a_func(x) * dt / 2.0\n            x = x + v_half * dt\n            v = v_half + a_func(x) * dt / 2.0\n            \n            # Calculate invariants at the end of the step\n            E = 0.5 * np.dot(v, v) + phi_func(x)\n            Lz = x[0] * v[1] - x[1] * v[0]\n            \n            E_hist.append(E)\n            Lz_hist.append(Lz)\n\n        # Convert to numpy arrays for vectorized operations\n        E_hist = np.array(E_hist)\n        Lz_hist = np.array(Lz_hist)\n\n        # --- Energy Conservation Check ---\n        max_abs_drift_E = np.max(np.abs(E_hist - E0))\n        if np.abs(E0) = Q_min:\n            drift_E = max_abs_drift_E / np.abs(E0)\n        else:\n            drift_E = max_abs_drift_E\n        E_preserved = drift_E = eps_E\n\n        # --- Angular Momentum Conservation Check ---\n        max_abs_drift_Lz = np.max(np.abs(Lz_hist - Lz0))\n        if np.abs(Lz0) = Q_min:\n            drift_Lz = max_abs_drift_Lz / np.abs(Lz0)\n        else:\n            drift_Lz = max_abs_drift_Lz\n        Lz_preserved = drift_Lz = eps_L\n\n        return E_preserved, Lz_preserved\n\n    # --- Test Case Definitions ---\n    \n    # Case 1: Free particle\n    phi_free = lambda x: 0.0\n    a_free = lambda x: np.array([0.0, 0.0])\n    \n    # Case 2: Central harmonic\n    omega_ch = 0.5\n    phi_central_harmonic = lambda x: 0.5 * omega_ch**2 * np.dot(x, x)\n    a_central_harmonic = lambda x: -omega_ch**2 * x\n\n    # Case 3: Kepler potential\n    GM = 1.0\n    def phi_kepler(x):\n        r = np.linalg.norm(x)\n        return -GM / r if r  0 else -np.inf\n    def a_kepler(x):\n        r = np.linalg.norm(x)\n        return -GM * x / r**3 if r  0 else np.array([0.0, 0.0])\n\n    # Case 4: Anisotropic harmonic\n    omega_x, omega_y = 1.0, 1.3\n    phi_anisotropic = lambda x: 0.5 * (omega_x**2 * x[0]**2 + omega_y**2 * x[1]**2)\n    a_anisotropic = lambda x: np.array([-omega_x**2 * x[0], -omega_y**2 * x[1]])\n\n    # Case 5: Radial central harmonic (same physics as case 2)\n    \n    test_cases = [\n        # (x0, v0, phi_func, a_func)\n        (np.array([1.0, 0.0]), np.array([0.0, 0.5]), phi_free, a_free),\n        (np.array([1.0, 0.0]), np.array([0.0, 0.8]), phi_central_harmonic, a_central_harmonic),\n        (np.array([1.0, 0.0]), np.array([0.0, 1.0]), phi_kepler, a_kepler),\n        (np.array([1.0, 0.0]), np.array([0.0, 1.0]), phi_anisotropic, a_anisotropic),\n        (np.array([1.0, 0.0]), np.array([-0.5, 0.0]), phi_central_harmonic, a_central_harmonic),\n    ]\n\n    results = []\n    for x0, v0, phi, a in test_cases:\n        E_pres, Lz_pres = run_simulation(x0, v0, phi, a, T, dt, eps_E, eps_L, Q_min)\n        results.append(E_pres)\n        results.append(Lz_pres)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了单个粒子的运动之后，下一步是研究集体现象。本练习探讨了引力双流不稳定性，这是一个经典的例子，说明了自引力系统中的微小扰动如何指数增长。通过对弗拉索夫-泊松（Vlasov-Poisson）系统进行线性化，我们将推导出色散关系，然后编写程序计算增长率，揭示结构开始形成的条件。",
            "id": "3494537",
            "problem": "考虑一个由Vlasov–Poisson方程描述的一维、无碰撞自引力系统。描述相空间分布函数 $f(x,v,t)$ 的Vlasov方程为 $\\,\\partial_t f + v\\,\\partial_x f - \\partial_x \\phi\\,\\partial_v f = 0\\,$，而描述引力势 $\\phi(x,t)$ 的Poisson方程为 $\\,\\partial_{xx} \\phi = 4\\pi G\\left(\\rho(x,t) - \\rho_0\\right)\\,$，其中 $\\rho(x,t)=\\int_{-\\infty}^{\\infty} f(x,v,t)\\,dv$，而 $\\rho_0$ 是均匀背景密度。在均匀背景中初始化两束冷流，其分布函数为 $\\,f(x,v,0)=\\frac{\\rho_0}{2}\\,\\delta(v-v_0)+\\frac{\\rho_0}{2}\\,\\delta(v+v_0)\\,$，其中 $\\delta$ 表示狄拉克δ函数。假设小振幅扰动在空间和时间上呈正弦形式，形如 $\\,\\propto e^{i(kx-\\omega t)}\\,$，其中 $k$ 为波数，$\\omega$ 为复频率。\n\n从上述基本定律和核心定义出发，从第一性原理推导一个合适的线性化描述，以捕捉此冷束流配置下双流增长的引力类似现象。将增长率表示为在给定 $k$ 下增长最快的线性模式所对应的复频率 $\\,\\omega\\,$ 的正虚部。您必须确保您的推导逻辑上一致，从Vlasov–Poisson系统开始，并且不假设或引用目标色散关系。\n\n使用无量纲代码单位（其中 $\\,G=1\\,$，因此所有量均为无量纲），对以下测试套件中的每组参数，数值计算其最大线性增长率。每个测试用例的最终增长率必须以一个实值浮点数返回，表示在这些代码单位下的逆时间。测试套件涵盖了以下代表性情况：\n\n- 情况 $1\\,$（作为退化双流的单流极限）：$\\,\\rho_0=1.0\\,$, $\\,v_0=0.0\\,$, $\\,k=0.1\\,$。\n- 情况 $2\\,$（中等流速，长波长）：$\\,\\rho_0=1.0\\,$, $\\,v_0=0.5\\,$, $\\,k=0.2\\,$。\n- 情况 $3\\,$（强流速，短波长）：$\\,\\rho_0=1.0\\,$, $\\,v_0=2.0\\,$, $\\,k=1.5\\,$。\n- 情况 $4\\,$（判别式边界条件）：选择 $\\,\\rho_0=1.0\\,$, $\\,v_0=1.0\\,$，并设置 $\\,k=\\sqrt{(A/4)/v_0^2}\\,$，其中 $\\,A=2\\pi G\\rho_0\\,$，即 $\\,k=\\sqrt{\\pi/2}\\approx 1.253314\\,$。\n- 情况 $5\\,$（无引力基线）：$\\,\\rho_0=0.0\\,$, $\\,v_0=1.0\\,$, $\\,k=2.0\\,$。\n\n您的程序必须为每种情况计算由您的推导所蕴含的所有线性模式中的最大线性增长率 $\\,\\gamma_{\\max}=\\max\\{\\mathrm{Im}(\\omega)\\}\\,$。如果不存在不稳定模式，则该情况返回 $\\,0.0\\,$。您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，$\\,[$result1,result2,result3$]\\,$），其顺序与上述情况完全一致。不允许外部输入，所有计算必须使用指定的代码单位进行，不得使用任何外部数据。此问题中不涉及角度；请勿引入任何角度单位。所有最终输出必须是在指定的无量纲系统中以逆时间单位表示的浮点数。",
            "solution": "用户提供了一个有效且适定的问题，该问题基于动理学理论和引力动力学的标准原理。任务是从第一性原理推导自引力双流系统的色散关系，然后用它来计算几个特定情况下的最大线性增长率。\n\n### 从第一性原理推导\n\n该系统由一维Vlasov-Poisson方程描述。Vlasov方程控制相空间分布函数 $f(x,v,t)$ 的演化：\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial f}{\\partial v} = 0\n$$\nPoisson方程将引力势 $\\phi(x,t)$ 与质量密度 $\\rho(x,t)$ 联系起来：\n$$\n\\frac{\\partial^2 \\phi}{\\partial x^2} = 4\\pi G \\left( \\rho(x,t) - \\rho_0 \\right)\n$$\n其中质量密度是分布函数的速度积分，$\\rho(x,t) = \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv$。\n\n我们通过将每个量分解为一个均匀的背景分量（下标为 $0$）和一个微小的一阶扰动（下标为 $1$）来对系统进行线性化：\n$f(x,v,t) = f_0(v) + f_1(x,v,t)$\n$\\phi(x,t) = \\phi_0 + \\phi_1(x,t)$\n\n背景分布函数为关于 $v=0$ 对称的两束冷流：\n$$\nf_0(v) = \\frac{\\rho_0}{2} \\left[ \\delta(v-v_0) + \\delta(v+v_0) \\right]\n$$\n背景密度为 $\\int f_0(v) dv = \\rho_0/2 + \\rho_0/2 = \\rho_0$。背景势 $\\phi_0$ 必须满足未扰动的Poisson方程，$\\partial_{xx}\\phi_0 = 4\\pi G(\\rho_0 - \\rho_0) = 0$。这意味着 $\\phi_0$ 是常数，因此背景引力 $-\\partial_x \\phi_0$ 为零。分布函数 $f_0(v)$ 与 $x$ 和 $t$ 无关，因此它是Vlasov方程的一个有效平衡解。\n\n将扰动量代入Vlasov方程并仅保留一阶项，得到线性化的Vlasov方程：\n$$\n\\frac{\\partial f_1}{\\partial t} + v \\frac{\\partial f_1}{\\partial x} - \\frac{\\partial \\phi_1}{\\partial x} \\frac{\\partial f_0}{\\partial v} = 0\n$$\n类似地，线性化的Poisson方程为：\n$$\n\\frac{\\partial^2 \\phi_1}{\\partial x^2} = 4\\pi G \\rho_1\n$$\n其中 $\\rho_1(x,t) = \\int f_1(x,v,t) \\, dv$。\n\n我们假设扰动是波数为 $k$、复频率为 $\\omega$ 的正弦波，形式为 $e^{i(kx-\\omega t)}$。这使我们可以用代数算子替换偏导数：$\\partial_t \\to -i\\omega$ 和 $\\partial_x \\to ik$。将此应用于傅里叶振幅 $\\hat{f}_1(v)$ 和 $\\hat{\\phi}_1$ 的线性化Vlasov方程：\n$$\n-i\\omega \\hat{f}_1 + ikv \\hat{f}_1 - ik\\hat{\\phi}_1 \\frac{\\partial f_0}{\\partial v} = 0\n$$\n求解 $\\hat{f}_1$：\n$$\n-i(\\omega-kv)\\hat{f}_1 = ik\\hat{\\phi}_1 \\frac{\\partial f_0}{\\partial v} \\implies \\hat{f}_1(v) = -\\frac{k}{\\omega-kv}\\hat{\\phi}_1 \\frac{\\partial f_0}{\\partial v}\n$$\n扰动密度振幅 $\\hat{\\rho}_1$ 通过对 $\\hat{f}_1(v)$ 进行速度积分得到：\n$$\n\\hat{\\rho}_1 = \\int_{-\\infty}^{\\infty} \\hat{f}_1(v) \\, dv = -k\\hat{\\phi}_1 \\int_{-\\infty}^{\\infty} \\frac{1}{\\omega-kv} \\frac{\\partial f_0}{\\partial v} \\, dv\n$$\n我们使用分部积分法简化该积分：$\\int u \\, dv' = [uv] - \\int v \\, du'$。令 $u = \\frac{1}{\\omega-kv}$ 且 $dv' = \\frac{\\partial f_0}{\\partial v}dv$。那么 $du = \\frac{k}{(\\omega-kv)^2}dv$ 且 $v' = f_0$。当 $|v| \\to \\infty$ 时 $f_0 \\to 0$，因此边界项 $[uv]$ 消失。\n$$\n\\int_{-\\infty}^{\\infty} \\frac{1}{\\omega-kv} \\frac{\\partial f_0}{\\partial v} \\, dv = - \\int_{-\\infty}^{\\infty} f_0(v) \\frac{k}{(\\omega-kv)^2} \\, dv\n$$\n将此代回 $\\hat{\\rho}_1$ 的表达式中：\n$$\n\\hat{\\rho}_1 = -k\\hat{\\phi}_1 \\left( -k \\int_{-\\infty}^{\\infty} \\frac{f_0(v)}{(\\omega-kv)^2} \\, dv \\right) = k^2\\hat{\\phi}_1 \\int_{-\\infty}^{\\infty} \\frac{f_0(v)}{(\\omega-kv)^2} \\, dv\n$$\n傅里叶变换后的Poisson方程为 $(ik)^2\\hat{\\phi}_1 = 4\\pi G \\hat{\\rho}_1$，或 $-k^2\\hat{\\phi}_1 = 4\\pi G \\hat{\\rho}_1$。\n代入 $\\hat{\\rho}_1$ 的表达式：\n$$\n-k^2\\hat{\\phi}_1 = 4\\pi G \\left( k^2\\hat{\\phi}_1 \\int_{-\\infty}^{\\infty} \\frac{f_0(v)}{(\\omega-kv)^2} \\, dv \\right)\n$$\n对于非平凡解（$\\hat{\\phi}_1 \\neq 0$）且 $k \\neq 0$，我们可以消去 $k^2\\hat{\\phi}_1$ 以获得自引力系统的一般色散关系：\n$$\n-1 = 4\\pi G \\int_{-\\infty}^{\\infty} \\frac{f_0(v)}{(\\omega-kv)^2} \\, dv\n$$\n现在，我们对给定的双流分布 $f_0(v) = \\frac{\\rho_0}{2} [ \\delta(v-v_0) + \\delta(v+v_0) ]$ 计算此表达式。积分为：\n$$\n\\int \\frac{f_0(v)}{(\\omega-kv)^2} dv = \\frac{\\rho_0}{2} \\int \\frac{\\delta(v-v_0) + \\delta(v+v_0)}{(\\omega-kv)^2} dv = \\frac{\\rho_0}{2} \\left[ \\frac{1}{(\\omega-kv_0)^2} + \\frac{1}{(\\omega+kv_0)^2} \\right]\n$$\n色散关系简化为一个关于 $\\omega$ 的代数方程：\n$$\n-1 = 4\\pi G \\cdot \\frac{\\rho_0}{2} \\left[ \\frac{1}{(\\omega-kv_0)^2} + \\frac{1}{(\\omega+kv_0)^2} \\right]\n$$\n令 $\\omega_J^2 = 2\\pi G \\rho_0$。\n$$\n-1 = \\omega_J^2 \\left[ \\frac{(\\omega+kv_0)^2 + (\\omega-kv_0)^2}{((\\omega-kv_0)(\\omega+kv_0))^2} \\right] = \\omega_J^2 \\frac{2\\omega^2 + 2(kv_0)^2}{(\\omega^2-(kv_0)^2)^2}\n$$\n重新整理得到一个关于 $\\omega$ 的四次方程，它是关于 $X = \\omega^2$ 的二次方程：\n$$\n-(\\omega^2 - (kv_0)^2)^2 = 2\\omega_J^2 (\\omega^2 + (kv_0)^2) \\\\\n-\\left(X^2 - 2X(kv_0)^2 + (kv_0)^4\\right) = 2\\omega_J^2 X + 2\\omega_J^2(kv_0)^2 \\\\\nX^2 + 2(\\omega_J^2 - (kv_0)^2)X + ( (kv_0)^4 + 2\\omega_J^2(kv_0)^2 ) = 0\n$$\n求解这个关于 $X = \\omega^2$ 的二次方程：\n$$\n\\omega^2 = -(\\omega_J^2 - (kv_0)^2) \\pm \\sqrt{(\\omega_J^2 - (kv_0)^2)^2 - ((kv_0)^4 + 2\\omega_J^2(kv_0)^2)} \\\\\n\\omega^2 = (kv_0)^2 - \\omega_J^2 \\pm \\sqrt{\\omega_J^4 - 2\\omega_J^2(kv_0)^2 + (kv_0)^4 - (kv_0)^4 - 2\\omega_J^2(kv_0)^2} \\\\\n\\omega^2 = (kv_0)^2 - \\omega_J^2 \\pm \\sqrt{\\omega_J^4 - 4\\omega_J^2(kv_0)^2} \\\\\n\\omega^2 = (kv_0)^2 - \\omega_J^2 \\pm \\omega_J \\sqrt{\\omega_J^2 - 4(kv_0)^2}\n$$\n如果 $\\omega$ 具有正虚部，即 $\\gamma = \\mathrm{Im}(\\omega) > 0$，则存在不稳定性。当 $\\omega^2$ 为负数或复数时会发生这种情况。令 $D = \\omega_J^2 - 4(kv_0)^2$ 为根式内的判别式。\n\n情况 I：$D \\geq 0$（即 $k^2v_0^2 \\leq \\omega_J^2/4$）。\n$\\omega^2$ 的两个解都是实数。可以证明两者均为负，对应于两个纯增长/衰减模式。增长率 $\\gamma$ 由 $\\gamma^2 = -\\omega^2$ 给出。我们寻找最大增长率，它对应于最负的 $\\omega^2$：\n$$\n\\gamma_{\\max}^2 = - \\left( (kv_0)^2 - \\omega_J^2 - \\omega_J \\sqrt{\\omega_J^2 - 4(kv_0)^2} \\right) = \\omega_J^2 - (kv_0)^2 + \\omega_J \\sqrt{\\omega_J^2 - 4(kv_0)^2}\n$$\n\n情况 II：$D  0$（即 $k^2v_0^2 > \\omega_J^2/4$）。\n$\\omega^2$ 的解是一对共轭复数。令 $\\omega = \\omega_r + i\\gamma$。则 $\\omega^2 = (\\omega_r^2 - \\gamma^2) + i(2\\omega_r\\gamma)$。对 $\\omega^2$ 的实部和虚部进行分析表明，在这种情况下总存在不稳定模式。增长率的平方由下式给出：\n$$\n\\gamma^2 = \\frac{1}{2} \\left( \\omega_J^2 - (kv_0)^2 + \\sqrt{((kv_0)^2)^2 + 2(kv_0)^2\\omega_J^2} \\right)\n$$\n在这种情况下，只有一个正增长率，它就是最大值。\n\n特殊情况：\n- 如果 $\\rho_0 = 0$，则 $\\omega_J^2 = 0$。色散关系 $-1=0$ 没有解，意味着没有集体模式且 $\\gamma=0$。\n- 如果 $v_0 = 0$，系统是单束冷流。这属于情况 I。公式给出 $\\gamma_{\\max}^2 = \\omega_J^2 + \\omega_J^2 = 2\\omega_J^2 = 2(2\\pi G \\rho_0) = 4\\pi G \\rho_0$。增长率为 $\\gamma = \\sqrt{4\\pi G \\rho_0}$，这是经典的Jeans不稳定性增长率，它与 $k$ 无关。\n\n我们现在使用这些公式，在 $G=1$ 的条件下，为给定的测试用例计算增长率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the maximum linear growth rate of the gravitational two-stream instability\n    for a series of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (single-stream limit as a degenerate two-stream):\n        {'rho0': 1.0, 'v0': 0.0, 'k': 0.1},\n        # Case 2 (moderate streaming, long wavelength):\n        {'rho0': 1.0, 'v0': 0.5, 'k': 0.2},\n        # Case 3 (strong streaming, short wavelength):\n        {'rho0': 1.0, 'v0': 2.0, 'k': 1.5},\n        # Case 4 (discriminant boundary condition):\n        {'rho0': 1.0, 'v0': 1.0, 'k': np.sqrt(np.pi / 2.0)},\n        # Case 5 (no gravity baseline):\n        {'rho0': 0.0, 'v0': 1.0, 'k': 2.0},\n    ]\n\n    results = []\n    G = 1.0\n\n    for case in test_cases:\n        rho0 = case['rho0']\n        v0 = case['v0']\n        k = case['k']\n\n        # If there is no mass, there is no gravity, and thus no instability.\n        if rho0 == 0.0:\n            results.append(0.0)\n            continue\n        \n        # Calculate key parameters from the derived dispersion relation.\n        # omega_J^2 = 2 * pi * G * rho_0\n        omega_J_sq = 2.0 * np.pi * G * rho0\n        kv0_sq = (k * v0)**2\n\n        # The behavior of the instability is determined by the sign of the discriminant D.\n        # D = omega_J^2 - 4 * (k*v_0)^2\n        discriminant = omega_J_sq - 4.0 * kv0_sq\n\n        if discriminant = 0:\n            # Regime 1: Two purely growing modes exist.\n            # The maximum growth rate corresponds to the most negative omega^2 solution.\n            # gamma_max^2 = omega_J^2 - (kv_0)^2 + omega_J * sqrt(omega_J^2 - 4*(kv_0)^2)\n            gamma_sq = (\n                omega_J_sq - kv0_sq +\n                np.sqrt(omega_J_sq) * np.sqrt(discriminant)\n            )\n        else: # discriminant  0\n            # Regime 2: A pair of complex conjugate modes exists.\n            # gamma^2 = 0.5 * [omega_J^2 - (kv_0)^2 + sqrt(((kv_0)^2)^2 + 2*(kv_0)^2*omega_J^2)]\n            term_under_sqrt = kv0_sq**2 + 2.0 * kv0_sq * omega_J_sq\n            gamma_sq = 0.5 * (omega_J_sq - kv0_sq + np.sqrt(term_under_sqrt))\n\n        # The growth rate gamma is the square root of gamma_sq.\n        # gamma_sq should always be non-negative from the derivation.\n        # We take max(0, ...) as a safeguard against small negative numbers from floating point errors.\n        gamma_max = np.sqrt(max(0.0, gamma_sq))\n        results.append(gamma_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "线性不稳定性最终会增长并进入非线性阶段。本练习模拟了“泽尔多维奇薄饼”（Zel'dovich pancake）的形成，这是宇宙结构形成的一个基础模型，展示了线性近似失效后会发生什么。我们将实现从拉格朗日坐标到欧拉坐标的映射，以追踪冷暗物质片的演化，并开发一种算法来计算壳层穿越后的流数目，从而直接可视化多流区域和密度焦散的出现。",
            "id": "3494498",
            "problem": "您将在一个空间维度下，在由无碰撞玻尔兹曼方程（也称为弗拉索夫方程）和牛顿引力在膨胀背景下所描述的无碰撞冷暗物质框架内进行研究。考虑由拉格朗日坐标 $q$ 中的单值相空间片表示的冷初始条件，使用一阶拉格朗日微扰理论在线性区域内演化到欧拉坐标 $x$，并通过对拉格朗日根的求和将映射延续到壳层穿越之后。假设单位质量的初始本动引力势是单模余弦函数，\n$$\\phi_0(q) = -\\frac{A}{k^2}\\cos(k q),$$\n其振幅参数 $A>0$ 且波数 $k>0$。令 $D$ 表示乘以位移场的线性增长因子。在共动无量纲单位下工作，距离和角度以弧度为单位，并在任意自洽单位中设置背景均匀密度为 $\\rho_0=1$。\n\n从一维的无碰撞玻尔兹曼（弗拉索夫）方程和牛顿动力学出发，\n$$\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{\\partial \\Phi}{\\partial x}\\frac{\\partial f}{\\partial v} = 0,$$\n结合泊松方程和冷初始条件的假设，推导针对此初始势的一维一阶拉格朗日映射 $x(q;D)$ 及其雅可比行列式 $J(q;D)=\\partial x/\\partial q$。解释当映射不再单调时壳层穿越如何发生，并论证在欧拉位置 $x$ 处的流的数量等于满足 $x(q_i;D)=x$ 的不同拉格朗日根 $q_i$ 的数量。论证壳层穿越后一维质量密度由下式给出\n$$\\rho(x;D) = \\sum_{i} \\frac{\\rho_0}{\\left|J(q_i;D)\\right|},$$\n其中求和是对所有满足 $x(q_i;D)=x$ 的根 $q_i$ 进行的。定性解释多流区域如何由于对雅可比行列式倒数的求和以及在折叠焦散处 $J$ 的消失而与 $\\rho(x;D)$ 中的峰值相关联。\n\n然后，设计并实现一个鲁棒的数值算法来：\n- 将拉格朗日域划分为由 $J(q;D)$ 的零点界定的单调段。\n- 对于给定的欧拉位置 $x_\\star$，通过在每个单调段上执行区间套定和二分法来寻找 $x(q;D)=x_\\star$ 的解，从而计算拉格朗日根的数量。\n- 返回流的整数数量 $N_{\\mathrm{streams}}(x_\\star;A,D,k)$。\n\n数值要求：\n- 对拉格朗日域使用基本周期 $q \\in [-\\pi/k,\\pi/k]$，并假设周期性边界条件。\n- 全程使用弧度作为角度单位和无量纲共动单位。\n- 在每个单调拉格朗日段中实现区间套定和二分法。为进行根检测，将绝对值小于 $10^{-12}$ 的函数值视为零，并避免在段边界重复计数根。\n- 您的求解器应是确定性的，不需要任何随机数。\n\n测试套件和要求的输出：\n- 您必须为以下六组参数 $(A,D,k,x_\\star)$ 计算流的整数数量 $N_{\\mathrm{streams}}$：\n  1. $(0.8, 0.9, 1.0, 0.3)$\n  2. $(1.0, 1.2, 1.0, 0.0)$\n  3. $(1.0, 1.2, 1.0, 1.0)$\n  4. $(1.5, 1.2, 1.0, 0.4)$\n  5. $(0.0, 2.0, 1.0, -0.7)$\n  6. $(1.0, 1.0, 1.0, 0.1)$\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含用方括号括起来的、以逗号分隔的整数结果，例如，“[r1,r2,r3,r4,r5,r6]”。\n- 唯一的打印输出必须是这一行。\n\n您的程序必须是使用现代编程语言编写的完整、可运行的实现。所有计算都是无量纲的；不需要进行物理单位转换，所有角度都以弧度为单位。所有测试用例的答案必须是如上所述的整数。",
            "solution": "该问题要求从基本原理出发，对一维冷暗物质的结构形成进行分析，并最终设计一个数值算法来计算给定位置的流的数量。\n\n无碰撞流体（如冷暗物质，CDM）的演化由无碰撞玻尔兹曼方程（也称为弗拉索夫方程）控制：\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{\\partial \\Phi}{\\partial x}\\frac{\\partial f}{\\partial v} = 0\n$$\n其中，$f(x, v, t)$ 是相空间分布函数，$x$ 是共动位置，$v$ 是本动速度，$\\Phi(x, t)$ 是本动引力势。引力势通过泊松方程与质量密度 $\\rho(x, t)$ 耦合。对于CDM，初始条件是“冷的”，意味着速度弥散为零。初始相空间分布是一个由 $f(x, v, t=0) = \\rho_0 \\delta(v - v_0(x))$ 描述的片，其中 $\\delta$ 是狄拉克δ函数。\n\n这种冷片结构在拉格朗日坐标中随时间保持不变。动力学可以通过将初始（拉格朗日）位置 $q$ 映射到稍后时间的最终（欧拉）位置 $x$ 来描述。在一阶拉格朗日微扰理论（LPT）中，也称为泽尔多维奇近似，此映射由下式给出：\n$$\nx(q; D) = q + D(t) s(q)\n$$\n其中 $D(t)$ 是包含时间演化的线性增长因子，$s(q)$ 是初始位移场。在一维中，位移场与初始引力势的梯度成正比。势能最小值必须吸引粒子，因此位于 $q>q_{min}$ 的粒子应有负位移，而位于 $q",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It counts the number of streams for a 1D cold dark matter model.\n    \"\"\"\n    \n    # Test cases defined in the problem statement as (A, D, k, x_star)\n    test_cases = [\n        (0.8, 0.9, 1.0, 0.3),\n        (1.0, 1.2, 1.0, 0.0),\n        (1.0, 1.2, 1.0, 1.0),\n        (1.5, 1.2, 1.0, 0.4),\n        (0.0, 2.0, 1.0, -0.7),\n        (1.0, 1.0, 1.0, 0.1),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = count_streams(*params)\n        results.append(result)\n\n    # Print the final output in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef count_streams(A: float, D: float, k: float, x_star: float) - int:\n    \"\"\"\n    Calculates the number of streams N_streams for a given set of parameters.\n\n    The number of streams is the number of roots of the equation x(q) = x_star,\n    where x(q) = q - (A*D/k) * sin(k*q) is the Lagrangian-to-Eulerian mapping.\n\n    Args:\n        A: Amplitude parameter of the initial potential.\n        D: Linear growth factor.\n        k: Wavenumber of the initial potential.\n        x_star: The Eulerian position to evaluate.\n\n    Returns:\n        The integer number of streams at x_star.\n    \"\"\"\n    \n    # Numerical tolerance for checking if a value is zero.\n    tol = 1.0e-12\n\n    # The mapping function x(q)\n    # x(q) = q - (A*D/k) * sin(k*q)\n    # We need to find the number of roots for f(q) = x(q) - x_star = 0\n    C = A * D\n    \n    def f(q: float) - float:\n        \"\"\"The function whose roots we need to count: f(q) = x(q) - x_star.\"\"\"\n        # Handle the k=0 case to avoid division by zero, though k>0 is assumed.\n        if abs(k)  tol:\n            return q - x_star\n        return q - (C / k) * np.sin(k * q) - x_star\n\n    # The Lagrangian domain is q in [-pi/k, pi/k].\n    q_min = -np.pi / k\n    q_max = np.pi / k\n\n    # Determine monotonic segments based on the value of AD.\n    # Shell crossing occurs if AD > 1.\n    if C = 1.0:\n        # If AD = 1, x(q) is monotonic over the entire domain.\n        # The domain consists of a single segment.\n        segment_boundaries = [q_min, q_max]\n    else:\n        # If AD > 1, shell crossing occurred. x(q) has local extrema.\n        # The extrema are at J(q) = 1 - AD*cos(k*q) = 0.\n        # This gives cos(k*q) = 1/AD.\n        alpha = np.arccos(1.0 / C)\n        q_crit1 = -alpha / k\n        q_crit2 = alpha / k\n        # The domain is split into three monotonic segments.\n        segment_boundaries = [q_min, q_crit1, q_crit2, q_max]\n\n    # Evaluate the function f(q) at the segment boundaries.\n    y_vals = [f(p) for p in segment_boundaries]\n\n    # Count roots within the open intervals (p_i, p_{i+1}).\n    # A root exists if f(p_i) and f(p_{i+1}) have opposite signs.\n    num_internal_roots = 0\n    for i in range(len(segment_boundaries) - 1):\n        if y_vals[i] * y_vals[i+1]  0:\n            num_internal_roots += 1\n\n    # Count roots that fall exactly on the segment boundaries.\n    # Use a set to avoid double-counting if extrema values are identical.\n    boundary_root_indices = set()\n    for i, y_val in enumerate(y_vals):\n        if abs(y_val)  tol:\n            boundary_root_indices.add(i)\n    \n    num_boundary_roots = len(boundary_root_indices)\n\n    # The total number of streams is the sum of internal and boundary roots.\n    total_streams = num_internal_roots + num_boundary_roots\n    \n    return total_streams\n\n# Execute the solver\nsolve()\n```"
        }
    ]
}