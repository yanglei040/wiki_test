{
    "hands_on_practices": [
        {
            "introduction": "这项练习旨在从根本上理解自适应时间步长和均匀时间步长在误差累积上的差异。通过引导学生进行解析推导，您将看到一个根据问题自然时间尺度量身定制的自适应步长，其精度如何超越固定步长。该练习为我们理解自适应方法的强大之处提供了坚实的理论基础。",
            "id": "3464466",
            "problem": "考虑一个空间平坦、由物质主导的弗里德曼-勒梅特-罗伯逊-沃尔克（Friedmann–Lemaître–Robertson–Walker）宇宙学模型，其中标度因子 $a(t)$ 满足 $a(t) \\propto t^{2/3}$，因此其演化满足非自治线性常微分方程 $a'(t) = \\frac{2}{3 t} a(t)$，其中 $t>0$。给定 $a(t_0) = a_0$，并考虑区间 $[t_0, T]$，其中 $0  t_0  T$。您将使用二阶显式中点法对此方程进行积分，这是一种二阶段龙格－库塔（Runge–Kutta）格式，定义为 $y_{n+1} = y_n + h f\\!\\left(t_n + \\frac{h}{2}, y_n + \\frac{h}{2} f(t_n, y_n)\\right)$，其中 $f(t,y) = \\frac{2}{3 t} y$，$h$ 表示步长。\n\n仅使用精确解在单个步长上的泰勒展开以及线性化误差演化的基本解，推导在两种时间步进策略下 $t=T$ 时的领导阶全局误差：\n- 一种自适应策略，其步长随时间变化，$\\Delta t(t) = \\varepsilon t$，其中 $\\varepsilon>0$ 是一个小的无量纲参数。\n- 一种均匀策略，其步长为常数 $\\Delta t = h$，其中 $h$ 的选择使得对于某个整数 $N$，有 $N h \\approx T - t_0$。\n\n执行以下步骤：\n1. 对于应用于 $a'(t) = \\frac{2}{3 t} a(t)$ 的显式中点法，计算在一般时间 $t$ 处的局部截断误差，取到 $\\Delta t(t)$ 的最低非零阶。\n2. 使用从 $a'(t) = \\frac{2}{3 t} a(t)$ 推导出的齐次误差方程的基本解，确定在时间 $s$ 注入的局部误差如何传播到最终时间 $T$。\n3. 累积所有步长的贡献，为自适应和均匀两种策略构建在 $t=T$ 时的领导阶全局误差。将每种误差表示为在 $[t_0, T]$ 上的时间积分。\n4. 最后，给出比值\n$$R \\equiv \\frac{E_{\\mathrm{global}}^{\\mathrm{adaptive}}(T)}{E_{\\mathrm{global}}^{\\mathrm{uniform}}(T)}$$\n的闭式解析表达式，用 $t_0$、$T$、$\\varepsilon$ 和 $h$ 表示。\n\n您的最终答案必须是单个闭式解析表达式。不需要四舍五入。比值 $R$ 是无量纲的，请勿附加单位。",
            "solution": "该问题要求在使用显式中点法对常微分方程（ODE）$a'(t) = \\frac{2}{3t} a(t)$ 进行积分时，两种不同时间步进策略（自适应和均匀）在最终时间 $T$ 的领导阶全局误差之比。解题过程将遵循指定的四个步骤。\n\n该常微分方程为 $a'(t) = f(t, a(t))$，其中 $f(t, a) = \\frac{2}{3t} a$。精确解的形式为 $a(t) = C t^{2/3}$，其中 $C$ 为某个常数。给定初始条件 $a(t_0)=a_0$，常数 $C = a_0 t_0^{-2/3}$，因此精确解为 $a(t) = a_0 (t/t_0)^{2/3}$。\n\n### 步骤1：局部截断误差（LTE）\n\n对于一个 $p$ 阶方法，其局部截断误差 $\\tau(t)$ 是在大小为 $\\Delta t$ 的单步中产生的误差，其领导项形式为 $\\tau(t) \\approx C(t) (\\Delta t)^{p+1}$。对于二阶（$p=2$）显式中点法，我们期望领导误差项为 $(\\Delta t)^3$ 阶。\n\n对于初值问题 $y' = f(t,y)$，显式中点法为：\n$$y_{n+1} = y_n + h f\\left(t_n + \\frac{h}{2}, y_n + \\frac{h}{2} f(t_n, y_n)\\right)$$\n为了求得 LTE，我们将从精确解 $a(t)$ 出发，经过单步计算后的数值解与精确解 $a(t+\\Delta t)$ 的泰勒展开进行比较。\n设从时间 $t$ 开始，取一个大小为 $\\Delta t$ 的单步。数值解 $a_1$ 为：\n$$a_1 = a(t) + \\Delta t \\, f\\left( t + \\frac{\\Delta t}{2}, a(t) + \\frac{\\Delta t}{2} f(t, a(t)) \\right)$$\n代入 $f(t, a) = \\frac{2a}{3t}$：\n$$a_1 = a(t) + \\Delta t \\, \\frac{2}{3(t+\\frac{\\Delta t}{2})} \\left( a(t) + \\frac{\\Delta t}{2} \\frac{2a(t)}{3t} \\right)$$\n$$a_1 = a(t) + \\frac{2\\Delta t}{3t(1+\\frac{\\Delta t}{2t})} a(t) \\left( 1 + \\frac{\\Delta t}{3t} \\right)$$\n我们将各项按 $\\Delta t$ 的幂次展开：\n$$\\frac{1}{1+\\frac{\\Delta t}{2t}} = 1 - \\frac{\\Delta t}{2t} + \\frac{(\\Delta t)^2}{4t^2} - O((\\Delta t)^3)$$\n$$a_1 = a(t) + \\frac{2\\Delta t a(t)}{3t} \\left(1 - \\frac{\\Delta t}{2t} + \\frac{(\\Delta t)^2}{4t^2} - \\dots \\right) \\left( 1 + \\frac{\\Delta t}{3t} \\right)$$\n$$a_1 = a(t) + a'(t) \\Delta t \\left(1 - \\frac{\\Delta t}{2t} + \\frac{\\Delta t}{3t} - \\frac{(\\Delta t)^2}{6t^2} + \\frac{(\\Delta t)^2}{4t^2} + \\dots \\right)$$\n$$a_1 = a(t) + a'(t) \\Delta t \\left(1 - \\frac{\\Delta t}{6t} + \\frac{(\\Delta t)^2}{12t^2} + \\dots \\right)$$\n$$a_1 = a(t) + \\Delta t a'(t) - \\frac{(\\Delta t)^2}{6t} a'(t) + \\frac{(\\Delta t)^3}{12t^2} a'(t) + \\dots$$\n精确解 $a(t+\\Delta t)$ 的泰勒级数为：\n$$a(t+\\Delta t) = a(t) + \\Delta t a'(t) + \\frac{(\\Delta t)^2}{2} a''(t) + \\frac{(\\Delta t)^3}{6} a'''(t) + \\dots$$\nLTE 为 $\\tau(t) = a(t+\\Delta t) - a_1$。$\\Delta t^0$ 和 $\\Delta t^1$ 阶的项相互抵消。$(\\Delta t)^2$ 的系数为 $\\frac{1}{2}a''(t) - (-\\frac{1}{6t}a'(t))$。\n精确解的导数为：$a'(t)=\\frac{2}{3t}a(t)$，$a''(t) = -\\frac{2}{9t^2}a(t) = -\\frac{1}{3t}a'(t)$，以及 $a'''(t) = \\frac{8}{27t^3}a(t)$。\n代入 $a''(t) = -\\frac{1}{3t}a'(t)$，$(\\Delta t)^2$ 项为 $\\frac{(\\Delta t)^2}{2}(-\\frac{1}{3t}a'(t)) + \\frac{(\\Delta t)^2}{6t}a'(t) = 0$，这证实了该方法是二阶的。\n\n最低非零项是 $(\\Delta t)^3$ 阶：\n$$\\tau(t) = \\left( \\frac{1}{6}a'''(t) - \\frac{1}{12t^2}a'(t) \\right) (\\Delta t)^3 + O((\\Delta t)^4)$$\n将导数表达式用 $a(t)$ 表示并代入：\n$$\\tau(t) = \\left( \\frac{1}{6}\\frac{8a(t)}{27t^3} - \\frac{1}{12t^2}\\frac{2a(t)}{3t} \\right) (\\Delta t)^3 + \\dots = \\left( \\frac{4a(t)}{81t^3} - \\frac{a(t)}{18t^3} \\right) (\\Delta t)^3 + \\dots$$\n$$\\tau(t) = a(t) \\left( \\frac{8-9}{162t^3} \\right) (\\Delta t)^3 + \\dots = -\\frac{a(t)}{162t^3} (\\Delta t)^3 + O((\\Delta t)^4)$$\n因此，在时间 $t$ 处，对于步长 $\\Delta t(t)$，其领导阶局部截断误差为：\n$$\\tau(t) = -\\frac{a(t)}{162 t^3} (\\Delta t(t))^3$$\n\n### 步骤2：误差传播\n\n全局误差 $e(t) = a_{\\mathrm{num}}(t) - a(t)$ 遵循一个线性化方程演化。全局误差的变化率是现有误差的传播与新局部误差注入之和。该演化的齐次部分为 $e'(t) \\approx \\frac{\\partial f}{\\partial a} e(t)$。\n对于 $f(t,a) = \\frac{2a}{3t}$，其偏导数为 $\\frac{\\partial f}{\\partial a} = \\frac{2}{3t}$。齐次误差方程为：\n$$e'(t) = \\frac{2}{3t} e(t)$$\n这与 $a(t)$ 的方程相同，因此其解为 $e(t) \\propto t^{2/3}$。基本解 $\\Phi(t,s)$ 描述了在时间 $s$ 注入的单位误差到稍后时间 $t>s$ 的演化。它是方程 $e'(t) = \\frac{2}{3t}e(t)$ 在初始条件 $e(s)=1$ 下的解。该解为 $e(t) = (t/s)^{2/3}$。\n因此，从时间 $s$ 到时间 $T$ 的误差传播的基本解为：\n$$\\Phi(T,s) = \\left(\\frac{T}{s}\\right)^{2/3}$$\n\n### 步骤3：全局误差累积\n\n在时间 $T$ 的领导阶全局误差 $E_{\\mathrm{global}}(T)$ 是所有局部误差的积分，每个局部误差都传播到最终时间 $T$。局部误差以每单位时间 $\\frac{\\tau(t)}{\\Delta t(t)}$ 的速率注入。全局误差是非齐次常微分方程 $e'(t) = \\frac{2}{3t}e(t) + \\frac{\\tau(t)}{\\Delta t(t)}$ 在初始条件 $e(t_0)=0$ 下的解。\n使用常数变易法公式，解为：\n$$E_{\\mathrm{global}}(T) = \\int_{t_0}^T \\Phi(T, s) \\frac{\\tau(s)}{\\Delta t(s)} ds$$\n源项（误差注入率）为：\n$$S(s) = \\frac{\\tau(s)}{\\Delta t(s)} = \\frac{-a(s)/(162s^3) \\cdot (\\Delta t(s))^3}{\\Delta t(s)} = -\\frac{a(s)}{162s^3} (\\Delta t(s))^2$$\n代入 $a(s) = a_0(s/t_0)^{2/3}$ 和 $\\Phi(T,s)=(T/s)^{2/3}$：\n$$E_{\\mathrm{global}}(T) = \\int_{t_0}^T \\left(\\frac{T}{s}\\right)^{2/3} \\left(-\\frac{a_0(s/t_0)^{2/3}}{162s^3} (\\Delta t(s))^2 \\right) ds$$\n$$E_{\\mathrm{global}}(T) = -\\frac{a_0 T^{2/3}}{162 t_0^{2/3}} \\int_{t_0}^T s^{-2/3} \\frac{s^{2/3}}{s^3} (\\Delta t(s))^2 ds$$\n$$E_{\\mathrm{global}}(T) = -\\frac{a_0 T^{2/3}}{162 t_0^{2/3}} \\int_{t_0}^T s^{-3} (\\Delta t(s))^2 ds$$\n\n现在我们针对两种策略计算此积分。\n\n**自适应策略**：$\\Delta t(s) = \\varepsilon s$。\n$$E_{\\mathrm{global}}^{\\mathrm{adaptive}}(T) = -\\frac{a_0 T^{2/3}}{162 t_0^{2/3}} \\int_{t_0}^T s^{-3} (\\varepsilon s)^2 ds = -\\frac{a_0 T^{2/3} \\varepsilon^2}{162 t_0^{2/3}} \\int_{t_0}^T s^{-1} ds$$\n$$E_{\\mathrm{global}}^{\\mathrm{adaptive}}(T) = -\\frac{a_0 T^{2/3} \\varepsilon^2}{162 t_0^{2/3}} [\\ln(s)]_{t_0}^T = -\\frac{a_0 T^{2/3} \\varepsilon^2}{162 t_0^{2/3}} \\ln\\left(\\frac{T}{t_0}\\right)$$\n\n**均匀策略**：$\\Delta t(s) = h$。\n$$E_{\\mathrm{global}}^{\\mathrm{uniform}}(T) = -\\frac{a_0 T^{2/3}}{162 t_0^{2/3}} \\int_{t_0}^T s^{-3} h^2 ds = -\\frac{a_0 T^{2/3} h^2}{162 t_0^{2/3}} \\int_{t_0}^T s^{-3} ds$$\n$$E_{\\mathrm{global}}^{\\mathrm{uniform}}(T) = -\\frac{a_0 T^{2/3} h^2}{162 t_0^{2/3}} \\left[-\\frac{1}{2}s^{-2}\\right]_{t_0}^T = -\\frac{a_0 T^{2/3} h^2}{162 t_0^{2/3}} \\left(-\\frac{1}{2T^2} + \\frac{1}{2t_0^2}\\right)$$\n$$E_{\\mathrm{global}}^{\\mathrm{uniform}}(T) = -\\frac{a_0 T^{2/3} h^2}{324 t_0^{2/3}} \\left(\\frac{1}{t_0^2} - \\frac{1}{T^2}\\right)$$\n\n### 步骤4：全局误差之比\n\n比值 $R$ 定义为 $E_{\\mathrm{global}}^{\\mathrm{adaptive}}(T) / E_{\\mathrm{global}}^{\\mathrm{uniform}}(T)$。\n$$R = \\frac{-\\frac{a_0 T^{2/3} \\varepsilon^2}{162 t_0^{2/3}} \\ln\\left(\\frac{T}{t_0}\\right)}{-\\frac{a_0 T^{2/3} h^2}{324 t_0^{2/3}} \\left(\\frac{1}{t_0^2} - \\frac{1}{T^2}\\right)}$$\n公共的预因子相互抵消：\n$$R = \\frac{\\frac{\\varepsilon^2}{162} \\ln\\left(\\frac{T}{t_0}\\right)}{\\frac{h^2}{324} \\left(\\frac{1}{t_0^2} - \\frac{1}{T^2}\\right)} = \\frac{324}{162} \\frac{\\varepsilon^2}{h^2} \\frac{\\ln\\left(\\frac{T}{t_0}\\right)}{\\frac{1}{t_0^2} - \\frac{1}{T^2}}$$\n$$R = 2 \\frac{\\varepsilon^2}{h^2} \\frac{\\ln\\left(\\frac{T}{t_0}\\right)}{\\frac{T^2-t_0^2}{t_0^2 T^2}}$$\n化简表达式得到最终结果：\n$$R = \\frac{2 \\varepsilon^2 t_0^2 T^2 \\ln\\left(\\frac{T}{t_0}\\right)}{h^2 (T^2 - t_0^2)}$$",
            "answer": "$$\\boxed{\\frac{2 \\varepsilon^2 t_0^2 T^2 \\ln\\left(\\frac{T}{t_0}\\right)}{h^2 \\left(T^2 - t_0^2\\right)}}$$"
        },
        {
            "introduction": "在理论理解的基础上，本实践转向一个实际的编程挑战。您将为一个用于积分宇宙学线性增长方程的自适应时间步长控制器进行设计和编码。其核心思想是将步长与宇宙膨胀历史的变化速率联系起来，这是一种物理上直观且有效的策略。",
            "id": "3464540",
            "problem": "您的任务是设计、实现并评估一个自适应时间步长控制器，用于在不同背景膨胀历史下对宇宙学线性增长方程进行积分。该控制器必须调整物理时间步长 $\\Delta t$，以确保在哈勃膨胀率 $H(z)$ 快速演化的时期，对数尺度因子 $\\Delta \\ln a$ 的变化保持较小，同时在 $H(z)$ 变化缓慢的时期（如物质主导时期）允许较大的 $\\Delta \\ln a$。您将通过将其数值精度和计算成本与均匀步长基准进行比较，来量化您的控制器对增长可观测量的影响。\n\n您可以且必须基于以下基本原理：\n- Friedmann-Lemaître-Robertson-Walker (FLRW) 背景，空间平坦且在晚期辐射可忽略不计，哈勃率表示为 $H(a) = H_0 E(a)$，其中 $H_0$ 是当前的哈勃常数，$E(a)$ 是无量纲的。\n- 定义 $H \\equiv \\dot{a}/a$，等效于 $\\mathrm{d} \\ln a / \\mathrm{d} t = H$，其中上方的点表示对宇宙时间 $t$ 的导数。\n- 冷暗物质加暗能量背景，物质密度参数为 $\\Omega_{\\mathrm{m}0}$，暗能量密度参数为 $\\Omega_{\\mathrm{de}0} = 1 - \\Omega_{\\mathrm{m}0}$。暗能量状态方程可能随时间变化，并由 Chevallier-Polarski-Linder (CPL) 形式 $w(a) = w_0 + w_a (1 - a)$ 参数化，这得到\n$$\nE^2(a) = \\Omega_{\\mathrm{m}0} a^{-3} + \\Omega_{\\mathrm{de}0} \\, a^{-3(1+w_0+w_a)} \\exp\\big(3 w_a (a-1)\\big).\n$$\n- 在亚视界范围内，线性物质密度衬度 $\\delta$ 满足 $\\ddot{\\delta} + 2 H \\dot{\\delta} - 4 \\pi G \\rho_{\\mathrm{m}} \\delta = 0$。通过 $\\delta(\\mathbf{x},a) = D(a) \\, \\delta(\\mathbf{x},a_{\\mathrm{init}})$ 定义线性增长因子 $D(a)$，该增长因子满足相同的二阶常微分方程 (ODE)。\n\n您的任务：\n1. 从给定的基础出发，使用自变量 $x \\equiv \\ln a$ 推导一个关于 $D(a)$ 的一阶系统。您必须将演化表示为一个关于 $D$ 及其对 $x$ 的导数的一阶系统。清晰地指出其对 $E(a)$、$\\Omega_{\\mathrm{m}}(a)$ 和 $\\mathrm{d} \\ln H / \\mathrm{d} \\ln a$ 的依赖关系。所有推导都应在 $H_0 = 1$ 的无量纲单位下完成。\n2. 设计两种时间步进策略来将增长系统从 $a_{\\mathrm{init}}$ 积分到 $a=1$：\n   - 基准控制器：在 $x$ 中采用固定步长，即所有步长的 $\\Delta x \\equiv \\Delta \\ln a$ 均相同。\n   - 自适应控制器：在每一步选择 $\\Delta x$，以同时满足两个约束条件：\n     (i) 每步对数哈勃率的绝对变化有上界，即 $|\\Delta \\ln H| \\le \\varepsilon_H$，以及\n     (ii) 一个绝对上限 $\\Delta x \\le \\Delta x_{\\max}$。\n     您必须使用关系式 $\\mathrm{d} \\ln a / \\mathrm{d} t = H$ 将您选择的 $\\Delta x$ 转换为每步开始时的物理时间步长 $\\Delta t = \\Delta x / H$。设计必须有原则：对 $|\\Delta \\ln H|$ 的约束应使用 $\\left|\\mathrm{d} \\ln H / \\mathrm{d} \\ln a\\right|$ 的瞬时值来强制执行，从而使 $|\\Delta \\ln H| \\approx \\left|\\mathrm{d} \\ln H / \\mathrm{d} \\ln a\\right| \\Delta x$ 不超过 $\\varepsilon_H$。\n3. 将增长系统从 $a_{\\mathrm{init}} = 10^{-3}$ 数值积分到 $a=1$，使用由物质主导所启发的以下初始条件：在 $x_{\\mathrm{init}} = \\ln a_{\\mathrm{init}}$ 处，取 $D(a_{\\mathrm{init}}) = a_{\\mathrm{init}}$ 和 $\\mathrm{d} D / \\mathrm{d} \\ln a|_{a_{\\mathrm{init}}} = D(a_{\\mathrm{init}})$。使用一个在 $x$ 中采用非常小均匀步长的固定步长高精度参考解，作为误差评估的基准真相。\n4. 对于每个模型和控制器，报告在 $a=1$ 时的以下增长可观测量：\n   - 增长因子 $D(1)$（无量纲）。\n   - 对数增长率 $f(1) \\equiv \\mathrm{d} \\ln D / \\mathrm{d} \\ln a \\big|_{a=1}$（无量纲）。\n   同时计算每个可观测量相对于高精度参考解的绝对相对误差以及所用的总步数。\n5. 使用经典的显式四阶 Runge-Kutta 方法，在自变量 $x = \\ln a$ 中实现您的积分器。所有量必须被视为无量纲，并且您必须将最终报告的可观测量和误差表示为无单位的纯数字。\n\n控制器规格：\n- 对于基准控制器，使用均匀的 $\\Delta x_{\\mathrm{base}}$。\n- 对于自适应控制器，同时强制执行 $|\\Delta \\ln H| \\le \\varepsilon_H$ 和 $\\Delta x \\le \\Delta x_{\\max}$。每一步的物理时间步长为 $\\Delta t = \\Delta x / H$，在步长开始时计算。您必须使用在步长开始时计算的 $\\mathrm{d} \\ln H / \\mathrm{d} \\ln a$ 的瞬时幅值来实现对 $|\\Delta \\ln H|$ 的界定。\n\n参考和数值设置：\n- 使用均匀步长 $\\Delta x_{\\mathrm{ref}} = 10^{-4}$ 的高精度参考解。\n- 使用基准均匀步长 $\\Delta x_{\\mathrm{base}} = 5 \\times 10^{-2}$。\n- 对于自适应控制器，使用 $\\varepsilon_H = 3 \\times 10^{-2}$ 和 $\\Delta x_{\\max} = 10^{-1}$。\n\n测试套件：\n为以下三个模型运行您的程序，所有模型均为空间平坦，$\\Omega_{\\mathrm{de}0} = 1 - \\Omega_{\\mathrm{m}0}$ 且无辐射：\n- 测试 A (Einstein-de Sitter): $\\Omega_{\\mathrm{m}0} = 1$, $w_0 = -1$, $w_a = 0$。注意：此模型中没有暗能量；状态方程参数在这里不相关，但您的代码应能接受它们。\n- 测试 B (宇宙学常数): $\\Omega_{\\mathrm{m}0} = 0.3$, $w_0 = -1$, $w_a = 0$。\n- 测试 C (融化暗能量): $\\Omega_{\\mathrm{m}0} = 0.3$, $w_0 = -0.9$, $w_a = 0.8$。\n\n所需输出：\n- 对于每个测试，按此确切顺序生成一个包含十个条目的列表：\n  1. 来自自适应控制器的 $D(1)$。\n  2. 来自自适应控制器的 $f(1)$。\n  3. 自适应控制器 $D(1)$ 相对于参考解的绝对相对误差。\n  4. 自适应控制器 $f(1)$ 相对于参考解的绝对相对误差。\n  5. 自适应控制器所用的总步数。\n  6. 来自基准控制器的 $D(1)$。\n  7. 来自基准控制器的 $f(1)$。\n  8. 基准控制器 $D(1)$ 相对于参考解的绝对相对误差。\n  9. 基准控制器 $f(1)$ 相对于参考解的绝对相对误差。\n  10. 基准控制器所用的总步数。\n- 您的程序应生成单行输出，其中包含三个测试的结果，形式为一个逗号分隔的列表，该列表包含三个按测试分的子列表，并被一对单独的方括号括起来，例如：\n\"[[...测试A的结果...],[...测试B的结果...],[...测试C的结果...]]\"。\n所有报告的数字必须是无量纲的，并酌情以浮点数或整数形式给出。无需用户输入；所有参数都将在程序内定义。",
            "solution": "所述问题具有科学依据、提法恰当，并包含了唯一数值解所需的所有信息。这是一个计算宇宙学中的标准问题，涉及结构线性增长的数值积分。验证成功，我将继续提供完整解决方案。\n\n该问题要求推导和数值求解在由冷暗物质和具有 Chevallier-Polarski-Linder (CPL) 状态方程的暗能量组成的平坦 Friedmann-Lemaître-Robertson-Walker (FLRW) 宇宙中，物质密度衬度 $D(a)$ 的线性增长方程。将使用一个四阶 Runge-Kutta 积分器，采用两种不同的时间步进方案来获得解：一种是在对数尺度因子上采用均匀步长，另一种是基于哈勃参数变化率的自适应步长。\n\n**1. 一阶增长系统的推导**\n\n起点是关于线性增长因子 $D(a)$ 在宇宙时间 $t$ 中的二阶常微分方程 (ODE)：\n$$\n\\ddot{D} + 2 H \\dot{D} - 4 \\pi G \\rho_{\\mathrm{m}} D = 0\n$$\n其中，上方的点表示对 $t$ 的导数，$H(a) = \\dot{a}/a$ 是哈勃参数，$G$ 是引力常数，$\\rho_{\\mathrm{m}}$ 是背景物质密度。\n\n我们将自变量从宇宙时间 $t$ 更改为尺度因子的对数，$x \\equiv \\ln a$。链式法则提供了导数的变换。设撇号表示对 $x$ 的导数，即 $D' \\equiv \\mathrm{d}D/\\mathrm{d}x$。\n\n一阶导数变换如下：\n$$\n\\dot{D} = \\frac{\\mathrm{d}D}{\\mathrm{d}t} = \\frac{\\mathrm{d}D}{\\mathrm{d}x} \\frac{\\mathrm{d}x}{\\mathrm{d}t} = D' \\frac{\\mathrm{d}(\\ln a)}{\\mathrm{d}t} = D' \\left(\\frac{1}{a}\\frac{\\mathrm{d}a}{\\mathrm{d}t}\\right) = H D'\n$$\n\n二阶导数变换如下：\n$$\n\\ddot{D} = \\frac{\\mathrm{d}}{\\mathrm{d}t}(H D') = \\dot{H} D' + H \\dot{D'} = \\left(H \\frac{\\mathrm{d}H}{\\mathrm{d}x}\\right) D' + H \\left(H \\frac{\\mathrm{d}D'}{\\mathrm{d}x}\\right) = H^2 \\frac{\\mathrm{d}\\ln H}{\\mathrm{d}x} D' + H^2 D''\n$$\n注意 $\\mathrm{d}H/\\mathrm{d}t = (\\mathrm{d}H/\\mathrm{d}x)(\\mathrm{d}x/\\mathrm{d}t) = H(\\mathrm{d}H/\\mathrm{d}x)$ 且由于 $x=\\ln a$，$\\mathrm{d}\\ln H/\\mathrm{d}x = \\mathrm{d}\\ln H/\\mathrm{d}\\ln a$。\n\n将这些代入原始 ODE 中得到：\n$$\n\\left(H^2 \\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a} D' + H^2 D''\\right) + 2H (H D') - 4 \\pi G \\rho_{\\mathrm{m}} D = 0\n$$\n除以 $H^2$ 得到：\n$$\nD'' + \\left(2 + \\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a}\\right) D' - \\frac{4 \\pi G \\rho_{\\mathrm{m}}}{H^2} D = 0\n$$\n$D$ 项的系数可以使用空间平坦宇宙的弗里德曼方程来简化：$3H^2 = 8 \\pi G \\rho_{crit}$，其中 $\\rho_{crit}$ 是临界密度。物质密度参数定义为 $\\Omega_{\\mathrm{m}}(a) \\equiv \\rho_{\\mathrm{m}}(a) / \\rho_{crit}(a) = 8 \\pi G \\rho_{\\mathrm{m}}(a) / (3H(a)^2)$。整理后得到：\n$$\n\\frac{4 \\pi G \\rho_{\\mathrm{m}}}{H^2} = \\frac{3}{2} \\Omega_{\\mathrm{m}}(a)\n$$\n最终，关于 $x=\\ln a$ 的 $D$ 的方程是：\n$$\nD'' + \\left(2 + \\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a}\\right) D' - \\frac{3}{2} \\Omega_{\\mathrm{m}}(a) D = 0\n$$\n为了用给定的宇宙学参数表示这些系数，我们使用给定的无量纲哈勃参数表达式 $E(a) = H(a)/H_0$。为进行无量纲计算，设 $H_0=1$，则 $H(a) = E(a)$。物质密度参数为 $\\Omega_{\\mathrm{m}}(a) = \\Omega_{\\mathrm{m}0}a^{-3} / E^2(a)$。对于 $H$ 的对数导数，我们有 $\\mathrm{d}\\ln H/\\mathrm{d}\\ln a = \\mathrm{d}\\ln E/\\mathrm{d}\\ln a$。这可以从 $E^2(a)$ 计算得出：\n$$\n\\frac{\\mathrm{d}\\ln E}{\\mathrm{d}\\ln a} = \\frac{1}{2} \\frac{\\mathrm{d}\\ln E^2}{\\mathrm{d}\\ln a} = \\frac{1}{2E^2} \\frac{\\mathrm{d}E^2}{\\mathrm{d}\\ln a}\n$$\n$E^2(a)$ 对 $\\ln a$ 的导数为：\n$$\n\\frac{\\mathrm{d}E^2}{\\mathrm{d}\\ln a} = -3\\Omega_{\\mathrm{m}0}a^{-3} - 3(1+w(a)) \\left[E^2(a) - \\Omega_{\\mathrm{m}0}a^{-3}\\right]\n$$\n这导出了紧凑形式：\n$$\n\\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a} = -\\frac{3}{2}(1+w(a)) + \\frac{3}{2}w(a)\\Omega_{\\mathrm{m}}(a)\n$$\n其中 $w(a) = w_0 + w_a(1-a)$。\n\n为了进行数值求解，我们将这个二阶 ODE 转换为一个一阶系统。设状态向量为 $\\mathbf{Y}(x) = [Y_1(x), Y_2(x)]^T$，其中 $Y_1 = D$，$Y_2 = D' = \\mathrm{d}D/\\mathrm{d}\\ln a$。该系统是：\n$$\n\\frac{\\mathrm{d}\\mathbf{Y}}{\\mathrm{d}x} = \n\\begin{pmatrix}\n\\mathrm{d}Y_1/\\mathrm{d}x \\\\\n\\mathrm{d}Y_2/\\mathrm{d}x\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nY_2 \\\\\n-\\left(2 + \\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a}\\right) Y_2 + \\frac{3}{2} \\Omega_{\\mathrm{m}}(a) Y_1\n\\end{pmatrix}\n$$\n此系统将从 $x_{\\mathrm{init}} = \\ln(10^{-3})$ 积分到 $x_{\\mathrm{final}} = \\ln(1) = 0$，初始条件为 $Y_1(x_{\\mathrm{init}}) = 10^{-3}$ 和 $Y_2(x_{\\mathrm{init}}) = 10^{-3}$。\n\n**2. 数值实现与步进控制器**\n\n积分是使用经典的四阶 Runge-Kutta (RK4) 方法执行的。对于一个系统 $\\mathrm{d}\\mathbf{Y}/\\mathrm{d}x = \\mathbf{F}(x, \\mathbf{Y})$，从 $x_n$到 $x_{n+1} = x_n + \\Delta x$ 的单步计算如下：\n$$\n\\mathbf{k}_1 = \\mathbf{F}(x_n, \\mathbf{Y}_n) \\\\\n\\mathbf{k}_2 = \\mathbf{F}(x_n + \\frac{\\Delta x}{2}, \\mathbf{Y}_n + \\frac{\\Delta x}{2} \\mathbf{k}_1) \\\\\n\\mathbf{k}_3 = \\mathbf{F}(x_n + \\frac{\\Delta x}{2}, \\mathbf{Y}_n + \\frac{\\Delta x}{2} \\mathbf{k}_2) \\\\\n\\mathbf{k}_4 = \\mathbf{F}(x_n + \\Delta x, \\mathbf{Y}_n + \\Delta x \\mathbf{k}_3) \\\\\n\\mathbf{Y}_{n+1} = \\mathbf{Y}_n + \\frac{\\Delta x}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\n\n实现了两种步长 $\\Delta x$ 的控制器：\n\n- **基准控制器**：固定的步长 $\\Delta x = \\Delta x_{\\mathrm{base}} = 5 \\times 10^{-2}$。\n\n- **自适应控制器**：在每一步开始时选择步长 $\\Delta x$ 以满足两个约束条件。主要约束限制了每步哈勃率对数的变化，即 $|\\Delta \\ln H| \\le \\varepsilon_H$。这被近似为 $|\\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a}|\\Delta x \\le \\varepsilon_H$，这意味着 $\\Delta x \\le \\varepsilon_H / |\\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a}|$。第二个约束是一个硬性上限 $\\Delta x \\le \\Delta x_{\\max}$。因此，步长为：\n$$\n\\Delta x = \\min\\left(\\frac{\\varepsilon_H}{\\left|\\frac{\\mathrm{d}\\ln H}{\\mathrm{d}\\ln a}\\right|}, \\Delta x_{\\max}\\right)\n$$\n其中 $\\varepsilon_H = 3 \\times 10^{-2}$ 和 $\\Delta x_{\\max} = 10^{-1}$。如果 $\\mathrm{d}\\ln H/\\mathrm{d}\\ln a = 0$（在所考虑的模型中不会发生），则步长被 $\\Delta x_{\\max}$ 限制。此策略确保在膨胀历史变化迅速的时期（即当 $|\\mathrm{d}\\ln H/\\mathrm{d}\\ln a|$ 较大时）采用更多步长，而在其变化缓慢时采用较少步长。\n\n**3. 可观测量与误差分析**\n\n对于每个模型，使用一个非常小的均匀步长 $\\Delta x_{\\mathrm{ref}} = 10^{-4}$ 来计算高精度参考解。积分到 $a=1$ ($x=0$) 后，最终状态向量 $\\mathbf{Y}(0) = [Y_1(0), Y_2(0)]^T$ 提供了关键的可观测量：\n- 当前的增长因子：$D(1) = Y_1(0)$。\n- 当前的对数增长率：$f(1) = \\frac{\\mathrm{d}\\ln D}{\\mathrm{d}\\ln a}\\Big|_{a=1} = \\frac{1}{D(1)} \\frac{\\mathrm{d}D}{\\mathrm{d}\\ln a}\\Big|_{a=1} = \\frac{Y_2(0)}{Y_1(0)}$。\n\n通过计算这些可观测量与每个模型的参考解之间的绝对相对误差来评估基准控制器和自适应控制器的精度：\n$$\n\\text{Error}(Q) = \\left| \\frac{Q_{\\text{method}} - Q_{\\text{ref}}}{Q_{\\text{ref}}} \\right|\n$$\n计算成本通过每种方法完成积分所用的总步数来量化。最终代码实现了这一完整过程，运行三个测试模型中的每一个，并报告每个模型指定的十个输出量。",
            "answer": "```python\nimport numpy as np\n\n# This program strictly adheres to the problem specification.\n# It does not use libraries beyond the allowed 'numpy' and Python standard library.\n# The 'scipy' library is permitted but not required for this implementation.\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the numerical integration and reporting of results.\n    \"\"\"\n    # Define test cases as per the problem statement\n    test_cases = [\n        # Test A (Einstein-de Sitter)\n        {'name': 'Test A', 'omega_m0': 1.0, 'w0': -1.0, 'wa': 0.0},\n        # Test B (Lambda-CDM)\n        {'name': 'Test B', 'omega_m0': 0.3, 'w0': -1.0, 'wa': 0.0},\n        # Test C (CPL/thawing dark energy)\n        {'name': 'Test C', 'omega_m0': 0.3, 'w0': -0.9, 'wa': 0.8},\n    ]\n\n    # Numerical settings from the problem statement\n    a_init = 1e-3\n    x_init = np.log(a_init)\n    x_final = 0.0\n    \n    # Initial conditions\n    # Y = [D, dD/dlna]\n    Y_init = np.array([a_init, a_init])\n\n    # Controller parameters\n    dx_ref = 1e-4\n    dx_base = 5e-2\n    eps_H = 3e-2\n    dx_max_adapt = 1e-1\n\n    all_results = []\n\n    for case in test_cases:\n        cosmology = case\n\n        # 1. Generate high-accuracy reference solution\n        Y_ref, _ = integrate(cosmology, Y_init, x_init, x_final, 'fixed', dx_ref)\n        D1_ref = Y_ref[0]\n        f1_ref = Y_ref[1] / Y_ref[0]\n\n        # 2. Run with adaptive controller\n        Y_adapt, steps_adapt = integrate(cosmology, Y_init, x_init, x_final, 'adaptive', {'eps_H': eps_H, 'dx_max': dx_max_adapt})\n        D1_adapt = Y_adapt[0]\n        f1_adapt = Y_adapt[1] / Y_adapt[0]\n        err_D_adapt = abs((D1_adapt - D1_ref) / D1_ref)\n        err_f_adapt = abs((f1_adapt - f1_ref) / f1_ref)\n\n        # 3. Run with baseline controller\n        Y_base, steps_base = integrate(cosmology, Y_init, x_init, x_final, 'fixed', dx_base)\n        D1_base = Y_base[0]\n        f1_base = Y_base[1] / Y_base[0]\n        err_D_base = abs((D1_base - D1_ref) / D1_ref)\n        err_f_base = abs((f1_base - f1_ref) / f1_ref)\n\n        # 4. Collate results in the specified order\n        case_results = [\n            D1_adapt, f1_adapt, err_D_adapt, err_f_adapt, steps_adapt,\n            D1_base, f1_base, err_D_base, err_f_base, steps_base\n        ]\n        all_results.append(case_results)\n\n    # Format output as a single-line string of a nested list\n    # e.g., \"[[...],[...],[...]]\"\n    output_str = \"[\" + \",\".join([\"[\" + \",\".join(map(str, res)) + \"]\" for res in all_results]) + \"]\"\n    print(output_str)\n\n\nclass CosmologyModel:\n    \"\"\"A helper class to encapsulate cosmological calculations for a given model.\"\"\"\n    def __init__(self, omega_m0, w0, wa):\n        self.omega_m0 = omega_m0\n        self.omega_de0 = 1.0 - omega_m0\n        self.w0 = w0\n        self.wa = wa\n\n    def w_of_a(self, a):\n        \"\"\"Dark energy equation of state parameter w(a).\"\"\"\n        return self.w0 + self.wa * (1.0 - a)\n\n    def E_sq(self, a):\n        \"\"\"Squared dimensionless Hubble parameter E^2(a).\"\"\"\n        if self.omega_de0 == 0:\n            return self.omega_m0 * a**-3.0\n            \n        de_term = self.omega_de0 * a**(-3.0 * (1.0 + self.w0 + self.wa)) * \\\n                  np.exp(3.0 * self.wa * (a - 1.0))\n        return self.omega_m0 * a**-3.0 + de_term\n\n    def omega_m_of_a(self, a):\n        \"\"\"Matter density parameter Omega_m(a).\"\"\"\n        return self.omega_m0 * a**-3.0 / self.E_sq(a)\n\n    def dlnH_dlna(self, a):\n        \"\"\"Logarithmic derivative of the Hubble parameter, d(ln H)/d(ln a).\"\"\"\n        w_a = self.w_of_a(a)\n        omega_m_a = self.omega_m_of_a(a)\n        return -1.5 * (1.0 + w_a) + 1.5 * w_a * omega_m_a\n\ndef ode_system(x, Y, cosmo_model: CosmologyModel):\n    \"\"\"\n    Defines the first-order ODE system dY/dx = F(x, Y).\n    x = ln(a)\n    Y = [D, dD/dlna]\n    \"\"\"\n    a = np.exp(x)\n    D, dD_dlna = Y[0], Y[1]\n\n    # Calculate coefficients\n    dlnH = cosmo_model.dlnH_dlna(a)\n    omega_m = cosmo_model.omega_m_of_a(a)\n\n    dY1_dx = dD_dlna\n    dY2_dx = -(2.0 + dlnH) * dD_dlna + 1.5 * omega_m * D\n\n    return np.array([dY1_dx, dY2_dx])\n\ndef rk4_step(x, Y, dx, f, cosmo_model):\n    \"\"\"Performs a single step of the 4th-order Runge-Kutta method.\"\"\"\n    k1 = f(x, Y, cosmo_model)\n    k2 = f(x + 0.5 * dx, Y + 0.5 * dx * k1, cosmo_model)\n    k3 = f(x + 0.5 * dx, Y + 0.5 * dx * k2, cosmo_model)\n    k4 = f(x + dx, Y + dx * k3, cosmo_model)\n    return Y + (dx / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n\ndef integrate(cosmology_params, Y_init, x_init, x_final, controller_type, params):\n    \"\"\"\n    Integrates the ODE system from x_init to x_final using the specified controller.\n    \"\"\"\n    cosmo_model = CosmologyModel(**{k: v for k, v in cosmology_params.items() if k != 'name'})\n    \n    x = x_init\n    Y = np.copy(Y_init)\n    step_count = 0\n\n    while x  x_final:\n        if controller_type == 'fixed':\n            dx = params\n        elif controller_type == 'adaptive':\n            a = np.exp(x)\n            dlnH_val = cosmo_model.dlnH_dlna(a)\n            # Handle the case where dlnH/dlna is zero to avoid division by zero\n            if abs(dlnH_val)  1e-12:\n                dx = params['dx_max']\n            else:\n                dx = min(params['dx_max'], params['eps_H'] / abs(dlnH_val))\n        else:\n            raise ValueError(\"Unknown controller type\")\n\n        # Adjust the last step to land exactly on x_final\n        if x + dx > x_final:\n            dx = x_final - x\n        \n        Y = rk4_step(x, Y, dx, ode_system, cosmo_model)\n        x += dx\n        step_count += 1\n    \n    return Y, step_count\n\n\n# Execute the main function when the script is run\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "真实的宇宙学模拟涉及密度 $\\rho$、速度 $\\mathbf{v}$ 和引力势 $\\Phi$ 等多种相互作用的物理量。本练习旨在解决一个关键的设计问题：如何将来自这些不同变量的误差组合成一个单一且有意义的范数，用于时间步长的控制。通过分析几种备选公式，您将学习到维度一致性和物理加权的基本原则，这对于构建稳健的多物理场代码至关重要。",
            "id": "3464499",
            "problem": "一个自引力、可压缩的非相对论流体在一个牛顿宇宙学代码中进行演化，该代码使用共动坐标，其中标度因子为 $a(t)$，哈勃参数为 $H(t) = \\dot{a}(t)/a(t)$。状态变量为质量密度 $\\rho(\\mathbf{x},t)$、本动速度 $\\mathbf{v}(\\mathbf{x},t)$ 和引力势 $\\Phi(\\mathbf{x},t)$，它们受连续性方程、欧拉方程和泊松方程的支配。在一个线性尺度为 $L$ 的局域控制体积内，代码的内嵌误差估计器对单个试探时间步产生局域截断误差估计 $\\delta \\rho$、$\\delta \\mathbf{v}$ 和 $\\delta \\Phi$。一个自适应时间步长控制器必须将这些误差聚合成一个单一的、无量纲的混合变量误差范数 $E$，以便与用户容差 $\\varepsilon$ 进行比较，并决定接受或拒绝该步。\n\n从第一性原理出发，相关的控制定律和量纲如下：\n- 连续性方程：$\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{v}) + 3 H \\rho = 0$。\n- 欧拉方程：$\\partial_t \\mathbf{v} + (\\mathbf{v}\\cdot\\nabla)\\mathbf{v} = - \\nabla P / \\rho - \\nabla \\Phi - H \\mathbf{v}$，其状态方程给出的声速为 $c_s^2 = \\partial P / \\partial \\rho$。\n- 泊松方程：$\\nabla^2 \\Phi = 4 \\pi G (\\rho - \\bar{\\rho})$，其中 G 是牛顿引力常数，$\\bar{\\rho}$ 是宇宙平均密度。\n- 量纲：$[\\rho] = M L^{-3}$，$[\\mathbf{v}] = L T^{-1}$，$[\\\\Phi] = L^2 T^{-2}$，$[H] = T^{-1}$，$[c_s] = L T^{-1}$。\n\n一个物理上相关的特征速度应该能捕捉到平流、声学和引力运动中最快的信号。一个提议的选择是\n$$\nv_* = \\max\\!\\left( \\lVert \\mathbf{v} \\rVert,\\, c_s,\\, \\sqrt{|\\Phi|} \\right),\n$$\n其动机源于束缚流中的维里标度关系 $|\\Phi| \\sim \\lVert \\mathbf{v} \\rVert^2$ 以及 $c_s$ 控制压缩动力学这一事实。在构造 $E$ 时，其标度必须是量纲一致的，并且能反映在各种机制下（包括超音速流、维里化晕和膨胀主导区域），密度、速度和势的误差对欧拉和泊松动力学的相对影响。\n\n在此宇宙学背景下，基于量纲分析和物理相关性，以下哪个候选混合变量范数 $E$ 最适合用于汇总误差 $\\delta \\rho$、$\\delta \\mathbf{v}$ 和 $\\delta \\Phi$？这里 $\\delta v = \\lVert \\delta \\mathbf{v} \\rVert$。\n\nA. \n$$\nE_A = \\left[ \\left( \\frac{\\delta \\rho}{\\rho} \\right)^2 \\left( \\frac{c_s^2}{v_*^2} \\right) + \\left( \\frac{\\delta v}{v_*} \\right)^2 + \\left( \\frac{\\delta \\Phi}{v_*^2} \\right)^2 \\right]^{1/2}\n$$\n\nB.\n$$\nE_B = \\left[ \\left( \\frac{\\delta \\rho}{\\bar{\\rho}} \\right)^2 + \\left( \\frac{\\delta v}{\\lVert \\mathbf{v} \\rVert} \\right)^2 + \\left( \\frac{\\delta \\Phi}{|\\Phi|} \\right)^2 \\right]^{1/2}\n$$\n\nC.\n$$\nE_C = \\left[ \\delta \\rho^2 + \\delta v^2 + \\delta \\Phi^2 \\right]^{1/2}\n$$\n\nD.\n$$\nE_D = \\left[ \\left( \\frac{\\delta \\rho}{\\rho} \\right)^2 + \\left( \\frac{\\delta v}{H L} \\right)^2 + \\left( \\frac{\\delta \\Phi}{H^2 L^2} \\right)^2 \\right]^{1/2}\n$$\n\n选择唯一最佳选项。你必须通过从控制方程和量纲出发，说明 $E$ 中每一项的标度如何与物理上相关的加速度和时间尺度相关联，并说明为什么你选择的选项在 $c_s$、$\\lVert \\mathbf{v} \\rVert$ 或 $\\sqrt{|\\Phi|}$ 占主导地位的各种机制下仍然适用，以此来证明你的选择是正确的。解释为什么其他选项要么不满足量纲一致性，要么不具备物理相关性。假设没有相对论效应，且空间变化在网格尺度 $L$ 上得到了充分解析。",
            "solution": "用户提供了一个关于在数值宇宙学模拟中为自适应时间步长构建混合变量误差范数的问题。我的任务是首先验证问题陈述的有效性，如果有效，则推导出正确的解并评估所有提供的选项。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n-   **系统：** 一个自引力、可压缩的非相对论流体。\n-   **框架：** 牛顿宇宙学中的共动坐标。\n-   **状态变量：** 质量密度 $\\rho(\\mathbf{x},t)$、本动速度 $\\mathbf{v}(\\mathbf{x},t)$、引力势 $\\Phi(\\mathbf{x},t)$。\n-   **控制方程：**\n    -   连续性方程：$\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{v}) + 3 H \\rho = 0$。\n    -   欧拉方程：$\\partial_t \\mathbf{v} + (\\mathbf{v}\\cdot\\nabla)\\mathbf{v} = - \\nabla P / \\rho - \\nabla \\Phi - H \\mathbf{v}$，其中 $c_s^2 = \\partial P / \\partial \\rho$。\n    -   泊松方程：$\\nabla^2 \\Phi = 4 \\pi G (\\rho - \\bar{\\rho})$。\n-   **输入误差：** 在尺寸为 $L$ 的控制体积内的局域截断误差估计 $\\delta \\rho$、$\\delta \\mathbf{v}$ 和 $\\delta \\Phi$。设 $\\delta v = \\lVert \\delta \\mathbf{v} \\rVert$。\n-   **目标：** 构建一个无量纲的混合变量误差范数 $E$。\n-   **量纲：** $[\\rho] = M L^{-3}$，$[\\mathbf{v}] = L T^{-1}$，$[\\Phi] = L^2 T^{-2}$，$[H] = T^{-1}$，$[c_s] = L T^{-1}$。\n-   **提议的特征速度：** $v_* = \\max\\!\\left( \\lVert \\mathbf{v} \\rVert,\\, c_s,\\, \\sqrt{|\\Phi|} \\right)$。\n-   **对范数 E 的约束：** 必须量纲一致，并且在不同动力学机制（超音速、维里化、膨胀主导）中具有物理相关性。\n\n**步骤2：使用提取的已知条件进行验证**\n\n-   **科学依据：** 所提供的控制方程（共动坐标系下的连续性方程、欧拉方程、泊松方程）是牛顿宇宙学流体动力学的标准基本方程。自适应时间步长、局域截断误差和混合变量误差范数的概念是现代计算天体物理学的核心。给定的量纲是正确的。特征速度 $v_*$ 的定义是物理上合理的，并且在该领域被广泛使用，代表了平流、声传播和引力相互作用的最大局域信号速度。该问题牢固地植根于物理学和数值分析的既定原则。\n-   **良态性：** 该问题要求根据明确的标准（量纲一致性、物理相关性）评估和选择“最合适的”误差范数候选表达式。这是一个在物理推理和数学分析中定义明确的任务，而不是一个寻求数值答案的病态问题。可以在选项中做出一个唯一的、合理的选择。\n-   **客观性：** 问题以精确的技术语言陈述，没有主观性或模糊性。\n\n**步骤3：结论与行动**\n\n该问题陈述在科学上是合理的、良态的、客观的且自洽的。这是一个有效的问题。我现在将进行全面的推导和分析。\n\n### 推导与分析\n\n核心任务是构建一个无量纲的误差范数 $E$，它能恰当地组合误差 $\\delta \\rho$、$\\delta v$ 和 $\\delta \\Phi$。这需要对每个变量的误差进行归一化，并根据其在系统动力学中的物理重要性对其进行加权。动力学由决定流体加速度的欧拉方程控制。\n\n一个鲁棒的误差范数应该被构建成使其每一项都是无量纲的，并且整个表达式在所有预期的机制下都是数值稳定且物理上有意义的。特征速度 $v_* = \\max\\!\\left( \\lVert \\mathbf{v} \\rVert,\\, c_s,\\, \\sqrt{|\\Phi|} \\right)$ 作为动力学的关键局域尺度被提供。它代表了信息可以在局域传播的最快速度，因此它设定了局域动力学时间尺度，例如，通过 Courant-Friedrichs-Lewy (CFL) 条件，$\\Delta t \\lesssim L/v_*$。\n\n让我们构建来自每个变量的无量纲误差贡献：\n\n1.  **速度误差：** 速度误差是 $\\delta v$，其量纲为速度，$[L T^{-1}]$。用于归一化的自然的、物理上自适应的量是特征速度 $v_*$。因此，无量纲速度误差贡献为 $\\left( \\frac{\\delta v}{v_*} \\right)^2$。\n\n2.  **势误差：** 势误差是 $\\delta \\Phi$，其量纲为速度的平方，$[L^2 T^{-2}]$。为了使其无量纲，我们必须用一个具有相同量纲的量来归一化它。与速度归一化一致的逻辑选择是 $v_*^2$。因此，无量纲势误差贡献为 $\\left( \\frac{\\delta \\Phi}{v_*^2} \\right)^2$。\n\n3.  **密度误差：** 密度误差是 $\\delta \\rho$。一个简单的无量纲量是相对误差 $\\frac{\\delta \\rho}{\\rho}$。然而，密度涨落的动力学重要性关键地依赖于流体的可压缩性和温度，由声速 $c_s$ 代表。欧拉方程表明，密度通过压力梯度项 $-\\nabla P/\\rho$ 影响加速度，其大小与 $c_s^2$ 有关。这个压力项相对于惯性项（例如，平流，$\\sim v_*^2$）的重要性由比率 $c_s^2 / v_*^2$ 来表征。在高度超音速流（$v_* \\gg c_s$）中，压力很弱，密度误差对总误差范数的影响应该较小。相反，在亚音速流（$v_* \\approx c_s$）中，压力在动力学上是显著的，密度误差应该被完全加权。\n\n因此，平方相对密度误差 $\\left(\\frac{\\delta \\rho}{\\rho}\\right)^2$ 应该乘以一个捕捉这种物理效应的加权因子。最直接且有物理动机的加权因子恰好是特征压力“能量”与特征动能“能量”之比，即 $w_\\rho = \\frac{c_s^2}{v_*^2}$。\n\n**组合各项：**\n将这些贡献组合成一个单一的L2范数（平方和），我们得到平方误差范数：\n$$\nE^2 = w_\\rho \\left(\\frac{\\delta \\rho}{\\rho}\\right)^2 + w_v \\left(\\frac{\\delta v}{v_*}\\right)^2 + w_\\Phi \\left(\\frac{\\delta \\Phi}{v_*^2}\\right)^2\n$$\n将权重设置为 $w_v = 1$ 和 $w_\\Phi = 1$（因为速度和势已经由主导尺度 $v_*$ 归一化），并使用我们推导出的密度权重 $w_\\rho = c_s^2/v_*^2$，我们得到：\n$$\nE^2 = \\left(\\frac{c_s^2}{v_*^2}\\right) \\left(\\frac{\\delta \\rho}{\\rho}\\right)^2 + \\left(\\frac{\\delta v}{v_*}\\right)^2 + \\left(\\frac{\\delta \\Phi}{v_*^2}\\right)^2\n$$\n这个表达式是量纲一致的，使用了一个物理上自适应的归一化尺度（$v_*$），并根据局域动力学机制正确地对密度误差的贡献进行了加权。\n\n### 逐项分析\n\n**A. $E_A = \\left[ \\left( \\frac{\\delta \\rho}{\\rho} \\right)^2 \\left( \\frac{c_s^2}{v_*^2} \\right) + \\left( \\frac{\\delta v}{v_*} \\right)^2 + \\left( \\frac{\\delta \\Phi}{v_*^2} \\right)^2 \\right]^{1/2}$**\n这个表达式与我们的推导完全匹配。\n-   **量纲分析：** 平方根内的每一项都是无量纲的。该表达式有效。\n-   **物理相关性：** 它使用自适应速度尺度 $v_*$ 进行归一化，确保了在不同机制下的相关性。用 $v_*$ 归一化 $\\delta v$ 和用 $v_*^2$ 归一化 $\\delta \\Phi$ 是正确的。关键是，用 $c_s^2/v_*^2$ 对密度误差项进行加权，正确地反映了以下物理原理：密度涨落的动力学重要性与压力（由 $c_s^2$ 代表）相对于主导动力学（由 $v_*^2$ 代表）的重要性成正比。这使得该范数对于亚音速、超音速和维里化流都是鲁棒的。\n-   **结论：** 正确。\n\n**B. $E_B = \\left[ \\left( \\frac{\\delta \\rho}{\\bar{\\rho}} \\right)^2 + \\left( \\frac{\\delta v}{\\lVert \\mathbf{v} \\rVert} \\right)^2 + \\left( \\frac{\\delta \\Phi}{|\\Phi|} \\right)^2 \\right]^{1/2}$**\n此选项使用单个的局域量进行归一化。\n-   **量纲分析：** 每一项都是具有相同单位的量之比，因此是无量纲的。\n-   **物理相关性：** 该范数有几个关键缺陷。\n    1.  **数值不稳定性：** 分母 $\\lVert \\mathbf{v} \\rVert$ 和 $|\\Phi|$ 在物理上常见的情况下（例如，本动速度为零或引力势涨落为零的区域）可能为零或接近零。这会导致范数发散，从而在时间步长控制器中导致病态行为（例如，迫使时间步无限小）。\n    2.  **不恰当的标度：** 项 $\\delta\\rho/\\bar{\\rho}$ 用*宇宙平均密度* $\\bar{\\rho}$ 来归一化局域密度误差。在一个 $\\rho \\gg \\bar{\\rho}$ 的致密晕中，一个物理上不显著的*相对*误差 $\\delta\\rho/\\rho$ 将被极大地放大，导致效率低下的小时间步。\n    3.  **缺乏物理加权：** 它将每个变量中1%的误差（相对于其自身的大小）视为同等重要，忽略了它们的相对影响随物理机制急剧变化的事实，而欧拉方程正捕捉了这一点。\n-   **结论：** 不正确。\n\n**C. $E_C = \\left[ \\delta \\rho^2 + \\delta v^2 + \\delta \\Phi^2 \\right]^{1/2}$**\n此选项直接将平方误差相加。\n-   **量纲分析：** 这在根本上是错误的。它试图将具有不同物理量纲的量相加：\n    -   $[\\delta \\rho^2] = M^2 L^{-6}$\n    -   $[\\delta v^2] = L^2 T^{-2}$\n    -   $[\\delta \\Phi^2] = L^4 T^{-4}$\n    将这些量相加在数学上和物理上都是无意义的。$E_C$ 的值会根据所使用的单位制（例如，SI 对 cgs）而改变。\n-   **物理相关性：** 由于它量纲不一致，因此不具有物理相关性。\n-   **结论：** 不正确。\n\n**D. $E_D = \\left[ \\left( \\frac{\\delta \\rho}{\\rho} \\right)^2 + \\left( \\frac{\\delta v}{H L} \\right)^2 + \\left( \\frac{\\delta \\Phi}{H^2 L^2} \\right)^2 \\right]^{1/2}$**\n此选项使用从哈勃参数 $H$ 和网格尺度 $L$ 导出的尺度。\n-   **量纲分析：** 速度尺度 $HL$ 的单位是 $[L T^{-1}]$，势尺度 $H^2 L^2$ 的单位是 $[L^2 T^{-2}]$。所有项都是无量纲的。该表达式有效。\n-   **物理相关性：** 尺度 $HL$ 和 $H^2 L^2$ 是在尺度 $L$ 上的哈勃膨胀的特征。虽然这可能适用于哈勃流占主导地位的大尺度、线性机制的空洞，但对于非线性的、引力坍缩的结构（如星系和星系团）来说是完全不合适的。在这些致密区域，本动速度和引力势由局域物理决定，并且通常远大于从哈勃导出的尺度（例如，$\\lVert \\mathbf{v} \\rVert \\gg HL$）。使用 $HL$ 作为归一化会严重低估真实的动力学速度，导致误差范数被人为地夸大，并迫使模拟采取不必要的小而低效的时间步。一个合适的范数必须适应*局域*动力学状态，而此选项未能做到这一点。\n-   **结论：** 不正确。\n\n基于这一全面分析，选项 A 是唯一一个在宇宙学模拟中遇到的各种条件下，同时满足量纲一致、数值稳定和物理上合适的候选者。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}