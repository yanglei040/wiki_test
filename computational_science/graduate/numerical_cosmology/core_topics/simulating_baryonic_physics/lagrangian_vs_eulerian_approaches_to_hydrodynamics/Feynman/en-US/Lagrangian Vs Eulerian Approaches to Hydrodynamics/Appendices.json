{
    "hands_on_practices": [
        {
            "introduction": "To simulate cosmological hydrodynamics, we must first transform the fluid equations into the comoving coordinates of an expanding universe. This process introduces new terms, like the \"Hubble drag\" term $-H(t)\\mathbf{v}$, which physically represents the damping of peculiar velocities due to cosmic expansion. This first exercise  combines a foundational analytical derivation with a numerical experiment to explore how the philosophical differences between Eulerian and Lagrangian methods manifest in the simple, yet crucial, task of time integration for this source term. You will compare a first-order explicit scheme, characteristic of simple grid-based updates, with a second-order time-centered scheme often favored in particle-based codes, revealing their intrinsic differences in accuracy.",
            "id": "3477164",
            "problem": "Consider a Newtonian, non-relativistic, compressible fluid in an expanding, spatially flat universe. Let the physical (proper) coordinate be $\\mathbf{r}$, the comoving coordinate be $\\mathbf{x}$, and the cosmic scale factor be $a(t)$. The mapping between the coordinates is $\\mathbf{r}(t) = a(t)\\,\\mathbf{x}(t)$. Define the physical velocity $\\mathbf{u}(t,\\mathbf{r}) \\equiv d\\mathbf{r}/dt$ and the peculiar velocity $\\mathbf{v}(t,\\mathbf{x}) \\equiv a(t)\\,d\\mathbf{x}/dt$ so that $\\mathbf{u} = H(t)\\,\\mathbf{r} + \\mathbf{v}$ with $H(t) \\equiv \\dot{a}/a$ the Hubble parameter. Starting from conservation of mass and momentum and Newton’s second law for a fluid, derive the comoving form of the Euler equations and explicitly identify the source term proportional to $-H(t)\\,\\mathbf{v}$ (the “Hubble drag” term) in the momentum equation. State all assumptions made and define all variables clearly. You must start from the physical Euler equations and map to comoving variables by applying the chain rule and the definition of peculiar quantities; do not assume the target comoving equations.\n\nAfter completing the derivation, consider the uniform-flow and source-free limit in which spatial derivatives, pressure gradients, and peculiar gravitational forces vanish so that the peculiar velocity obeys a pure ordinary differential equation (ODE) due to Hubble drag:\n$$\n\\frac{d\\mathbf{v}}{dt} = -H(t)\\,\\mathbf{v}.\n$$\nYour task is to implement two time-discretization strategies that differ in spirit between Eulerian and Lagrangian approaches and to quantify the discretization bias of the $-H(t)\\,\\mathbf{v}$ term:\n\n- Eulerian update (grid-based viewpoint): advance the ODE with a first-order forward Euler step evaluated at the start of each step.\n- Lagrangian update (particle-following viewpoint): advance the ODE with a second-order time-centered trapezoidal step that uses $H(t)$ sampled at both the beginning and the end of the step.\n\nFor each strategy, compute the numerical solution for $\\mathbf{v}(t)$ over a finite time interval and compare it with the exact analytical solution for the given $H(t)$. Define the discretization bias for a scalar velocity amplitude $v$ at final time $t_{\\mathrm{f}}$ as the relative error\n$$\n\\epsilon \\equiv \\frac{v_{\\mathrm{num}}(t_{\\mathrm{f}}) - v_{\\mathrm{exact}}(t_{\\mathrm{f}})}{v_{\\mathrm{exact}}(t_{\\mathrm{f}})},\n$$\nexpressed as a decimal (not a percentage). Use the same initial condition $v(t_0) = v_0$ for both strategies.\n\nUnits and numerical specifications:\n- All times must be in seconds ($\\mathrm{s}$), velocities in meters per second ($\\mathrm{m/s}$), and the Hubble parameter in inverse seconds ($\\mathrm{s}^{-1}$).\n- Treat $v$ as a scalar amplitude for simplicity, and report scalar biases for each test.\n\nImplement a single program that computes the Eulerian and Lagrangian discretization biases for the following test suite. For each case, assume a single spatially uniform fluid element and focus solely on the ODE above:\n\n- Case $1$ (constant Hubble parameter, moderate step): $H(t) = H_0$ with $H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$, $t_0 = 0\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 5.0\\times 10^{16}\\,\\mathrm{s}$, $N = 10$ steps. The exact solution is $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp\\!\\left(-H_0\\,N\\,\\Delta t\\right)$.\n- Case $2$ (matter-dominated expansion): $H(t) = \\frac{2}{3\\,t}$, $t_0 = 1.0\\times 10^{16}\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 5.0\\times 10^{15}\\,\\mathrm{s}$, $N = 8$ steps. The exact solution is $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\left(\\frac{t_0}{t_0 + N\\,\\Delta t}\\right)^{2/3}$.\n- Case $3$ (constant Hubble parameter, small step boundary): $H(t) = H_0$ with $H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$, $t_0 = 0\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 1.0\\times 10^{15}\\,\\mathrm{s}$, $N = 10$ steps. The exact solution is $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp\\!\\left(-H_0\\,N\\,\\Delta t\\right)$.\n- Case $4$ (constant Hubble parameter, extreme coarse step): $H(t) = H_0$ with $H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$, $t_0 = 0\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 5.0\\times 10^{18}\\,\\mathrm{s}$, $N = 1$ step. The exact solution is $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp\\!\\left(-H_0\\,N\\,\\Delta t\\right)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each entry must be a two-element list with the Eulerian bias followed by the Lagrangian bias for the corresponding case, in the order given. For example, the output format must be\n$[\\,[\\epsilon_{\\mathrm{E},1},\\epsilon_{\\mathrm{L},1}],\\,[\\epsilon_{\\mathrm{E},2},\\epsilon_{\\mathrm{L},2}],\\,[\\epsilon_{\\mathrm{E},3},\\epsilon_{\\mathrm{L},3}],\\,[\\epsilon_{\\mathrm{E},4},\\epsilon_{\\mathrm{L},4}]\\,]$.",
            "solution": "The problem is first to derive the comoving form of the Euler equations for a Newtonian fluid in an expanding universe, and second, to implement and compare two numerical schemes for solving a simplified version of the peculiar velocity evolution.\n\nThe problem statement will be validated first.\n\n**Step 1: Extract Givens**\n-   Coordinate mapping: $\\mathbf{r}(t) = a(t)\\,\\mathbf{x}(t)$, where $\\mathbf{r}$ is the physical coordinate, $\\mathbf{x}$ is the comoving coordinate, and $a(t)$ is the cosmic scale factor.\n-   Hubble parameter: $H(t) \\equiv \\dot{a}/a$.\n-   Physical velocity: $\\mathbf{u}(t,\\mathbf{r}) \\equiv d\\mathbf{r}/dt$.\n-   Peculiar velocity: $\\mathbf{v}(t,\\mathbf{x}) \\equiv a(t)\\,d\\mathbf{x}/dt$.\n-   Velocity relation: $\\mathbf{u} = H(t)\\,\\mathbf{r} + \\mathbf{v}$.\n-   Simplified ODE for peculiar velocity: $\\frac{d\\mathbf{v}}{dt} = -H(t)\\,\\mathbf{v}$, valid in the uniform-flow, source-free limit.\n-   Discretization bias definition: $\\epsilon \\equiv \\frac{v_{\\mathrm{num}}(t_{\\mathrm{f}}) - v_{\\mathrm{exact}}(t_{\\mathrm{f}})}{v_{\\mathrm{exact}}(t_{\\mathrm{f}})}$.\n-   Eulerian update: First-order forward Euler step.\n-   Lagrangian update: Second-order time-centered trapezoidal step.\n-   Case 1: $H(t) = H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$, $t_0 = 0\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 5.0\\times 10^{16}\\,\\mathrm{s}$, $N = 10$. Exact solution: $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp(-H_0\\,N\\,\\Delta t)$.\n-   Case 2: $H(t) = \\frac{2}{3\\,t}$, $t_0 = 1.0\\times 10^{16}\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 5.0\\times 10^{15}\\,\\mathrm{s}$, $N = 8$. Exact solution: $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\left(\\frac{t_0}{t_0 + N\\,\\Delta t}\\right)^{2/3}$.\n-   Case 3: $H(t) = H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$, $t_0 = 0\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 1.0\\times 10^{15}\\,\\mathrm{s}$, $N = 10$. Exact solution: $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp(-H_0\\,N\\,\\Delta t)$.\n-   Case 4: $H(t) = H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$, $t_0 = 0\\,\\mathrm{s}$, $v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\Delta t = 5.0\\times 10^{18}\\,\\mathrm{s}$, $N = 1$. Exact solution: $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp(-H_0\\,N\\,\\Delta t)$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded**: The problem is set within the standard framework of Newtonian cosmology, using the fluid approximation which is a cornerstone of large-scale structure formation theory. The derivation of the comoving Euler equations is a fundamental and standard exercise in cosmology. The physical constants and parameters are of realistic orders of magnitude.\n-   **Well-Posed**: The derivation part is a standard proof. The numerical part is a well-defined initial value problem for an ODE, with specified initial conditions, time steps, and numerical methods. The exact solutions provided are correct and serve as a solid benchmark.\n-   **Objective**: The problem uses precise mathematical and physical terminology, free from subjective language.\n-   The problem does not exhibit any of the flaws listed in the validation criteria. It is scientifically sound, self-contained, and formalizable.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be provided.\n\n**Part 1: Derivation of the Comoving Euler Equations**\n\nWe begin with the Euler equations for a compressible, non-viscous fluid in physical coordinates $(\\mathbf{r}, t)$. The continuity equation (conservation of mass) and the momentum equation are:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla_{\\mathbf{r}} \\cdot (\\rho \\mathbf{u}) = 0\n$$\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla_{\\mathbf{r}}) \\mathbf{u} = -\\frac{1}{\\rho}\\nabla_{\\mathbf{r}} P - \\nabla_{\\mathbf{r}} \\Phi\n$$\nHere, $\\rho(t,\\mathbf{r})$ is the fluid density, $P(t,\\mathbf{r})$ is the pressure, $\\mathbf{u}(t,\\mathbf{r})$ is the physical velocity field, and $\\Phi(t,\\mathbf{r})$ is the gravitational potential. The operator $\\nabla_{\\mathbf{r}}$ is the gradient with respect to physical coordinates $\\mathbf{r}$.\n\nOur goal is to transform these equations into comoving coordinates $\\mathbf{x}$, related to physical coordinates by $\\mathbf{r} = a(t) \\mathbf{x}$. The scale factor $a(t)$ describes the overall expansion of the universe.\n\nFirst, we establish the transformation rules for derivatives and velocities.\nThe gradient operator transforms as:\n$$\n\\nabla_{\\mathbf{r}} = \\frac{1}{a(t)}\\nabla_{\\mathbf{x}}\n$$\nThe partial time derivative at a fixed physical position $\\mathbf{r}$ is related to the partial time derivative at a fixed comoving position $\\mathbf{x}$. For any field $f(t, \\mathbf{r}(t, \\mathbf{x}))$, the chain rule gives:\n$$\n\\frac{\\partial f}{\\partial t}\\bigg|_{\\mathbf{x}} = \\frac{\\partial f}{\\partial t}\\bigg|_{\\mathbf{r}} + \\left(\\frac{\\partial \\mathbf{r}}{\\partial t}\\bigg|_{\\mathbf{x}}\\right) \\cdot \\nabla_{\\mathbf{r}} f\n$$\nSince $\\mathbf{r} = a(t)\\mathbf{x}$, we have $\\frac{\\partial \\mathbf{r}}{\\partial t}\\big|_{\\mathbf{x}} = \\dot{a}\\mathbf{x} = \\frac{\\dot{a}}{a} (a\\mathbf{x}) = H(t)\\mathbf{r}$. This gives:\n$$\n\\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{r}} = \\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{x}} - H(t)\\mathbf{r} \\cdot \\nabla_{\\mathbf{r}}\n$$\nThe physical velocity $\\mathbf{u}$ is the total time derivative of the physical position of a fluid element:\n$$\n\\mathbf{u} = \\frac{d\\mathbf{r}}{dt} = \\frac{d(a\\mathbf{x})}{dt} = \\dot{a}\\mathbf{x} + a\\dot{\\mathbf{x}} = H(a\\mathbf{x}) + a\\frac{d\\mathbf{x}}{dt} = H\\mathbf{r} + \\mathbf{v}\n$$\nThis matches the provided definition of the peculiar velocity $\\mathbf{v} \\equiv a(t)d\\mathbf{x}/dt$.\n\nNow we transform the continuity equation:\n$$\n\\left(\\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{x}} - H\\mathbf{r} \\cdot \\nabla_{\\mathbf{r}}\\right) \\rho + \\nabla_{\\mathbf{r}} \\cdot (\\rho \\mathbf{u}) = 0\n$$\nSubstituting $\\mathbf{r}=a\\mathbf{x}$, $\\mathbf{u}=H a \\mathbf{x} + \\mathbf{v}$, and $\\nabla_{\\mathbf{r}} = \\frac{1}{a}\\nabla_{\\mathbf{x}}$:\n$$\n\\frac{\\partial \\rho}{\\partial t} - H(a\\mathbf{x}) \\cdot \\left(\\frac{1}{a}\\nabla_{\\mathbf{x}}\\right) \\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho (H a \\mathbf{x} + \\mathbf{v})) = 0\n$$\n$$\n\\frac{\\partial \\rho}{\\partial t} - H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})\\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho H a \\mathbf{x}) + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho \\mathbf{v}) = 0\n$$\nUsing the product rule for divergence, $\\nabla_{\\mathbf{x}} \\cdot (\\rho H a \\mathbf{x}) = H a [(\\nabla_{\\mathbf{x}}\\rho)\\cdot\\mathbf{x} + \\rho(\\nabla_{\\mathbf{x}}\\cdot\\mathbf{x})]$. With $\\nabla_{\\mathbf{x}}\\cdot\\mathbf{x}=3$, this becomes $H a [(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}\\rho) + 3\\rho]$. The equation simplifies to:\n$$\n\\frac{\\partial \\rho}{\\partial t} - H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})\\rho + H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}\\rho) + 3H\\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho \\mathbf{v}) = 0\n$$\nThe $H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})\\rho$ terms cancel, yielding the comoving continuity equation:\n$$\n\\frac{\\partial \\rho}{\\partial t} + 3H\\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho \\mathbf{v}) = 0\n$$\n\nNext, we transform the momentum equation. Let's analyze the left-hand side (LHS):\nLHS = $\\frac{\\partial \\mathbf{u}}{\\partial t}\\big|_{\\mathbf{r}} + (\\mathbf{u} \\cdot \\nabla_{\\mathbf{r}}) \\mathbf{u}$.\nThe first term is:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t}\\bigg|_{\\mathbf{r}} = \\left(\\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{x}} - H\\mathbf{r} \\cdot \\nabla_{\\mathbf{r}}\\right) \\mathbf{u} = \\frac{\\partial \\mathbf{u}}{\\partial t}\\bigg|_{\\mathbf{x}} - H(a\\mathbf{x}) \\cdot \\left(\\frac{1}{a}\\nabla_{\\mathbf{x}}\\right)(H a \\mathbf{x} + \\mathbf{v})\n$$\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t}\\bigg|_{\\mathbf{x}} = \\frac{\\partial}{\\partial t}(Ha\\mathbf{x} + \\mathbf{v}) = (\\dot{H}a + H\\dot{a})\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} = (\\dot{H}+H^2)a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t}\n$$\nSo, $\\frac{\\partial \\mathbf{u}}{\\partial t}\\big|_{\\mathbf{r}} = (\\dot{H}+H^2)a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})(Ha\\mathbf{x} + \\mathbf{v}) = (\\dot{H}+H^2)a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H^2a\\mathbf{x} - H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} = \\dot{H}a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}$.\n\nThe second term, the advective derivative, is:\n$$\n(\\mathbf{u} \\cdot \\nabla_{\\mathbf{r}}) \\mathbf{u} = \\left((Ha\\mathbf{x}+\\mathbf{v}) \\cdot \\frac{1}{a}\\nabla_{\\mathbf{x}}\\right) (Ha\\mathbf{x}+\\mathbf{v})\n$$\n$$\n= \\left(H\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}} + \\frac{1}{a}\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}}\\right) (Ha\\mathbf{x}+\\mathbf{v})\n$$\n$$\n= H\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}(Ha\\mathbf{x}) + H\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}(\\mathbf{v}) + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})(Ha\\mathbf{x}) + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\n$$\nThis evaluates to: $H^2a\\mathbf{x} + H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}$.\n\nCombining all terms on the LHS:\nLHS = $\\left(\\dot{H}a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\\right) + \\left(H^2a\\mathbf{x} + H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\\right)$\n$$\n\\text{LHS} = \\frac{\\partial \\mathbf{v}}{\\partial t} + (\\dot{H}+H^2)a\\mathbf{x} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\n$$\n\nThe right-hand side (RHS) of the momentum equation is transformed as:\nRHS = $-\\frac{1}{\\rho}\\nabla_{\\mathbf{r}} P - \\nabla_{\\mathbf{r}} \\Phi = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}} \\Phi$.\nThe total gravitational potential $\\Phi$ is separated into a background part $\\Phi_b$ due to the mean density $\\bar{\\rho}(t)$, and a peculiar part $\\phi$ due to density fluctuations $\\delta\\rho = \\rho - \\bar{\\rho}$. The background potential satisfies $\\nabla^2_{\\mathbf{r}}\\Phi_b = 4\\pi G \\bar{\\rho}$. By Birkhoff's theorem in the Newtonian limit, the background gravitational force at $\\mathbf{r}$ is $-\\nabla_{\\mathbf{r}}\\Phi_b = -(\\frac{4\\pi G \\bar{\\rho}}{3})\\mathbf{r}$. From the second Friedmann equation for a non-relativistic fluid ($\\ddot{a}/a = \\dot{H}+H^2 = -4\\pi G \\bar{\\rho}/3$), we have $-\\nabla_{\\mathbf{r}}\\Phi_b = (\\dot{H}+H^2)\\mathbf{r} = (\\dot{H}+H^2)a\\mathbf{x}$.\nSo, $-\\frac{1}{a}\\nabla_{\\mathbf{x}}\\Phi = -\\frac{1}{a}\\nabla_{\\mathbf{x}}\\Phi_b - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi = -\\nabla_{\\mathbf{r}}\\Phi_b - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi = (\\dot{H}+H^2)a\\mathbf{x} - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi$.\n\nEquating the full LHS and RHS:\n$$\n\\frac{\\partial \\mathbf{v}}{\\partial t} + (\\dot{H}+H^2)a\\mathbf{x} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P + (\\dot{H}+H^2)a\\mathbf{x} - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\nThe background acceleration term $(\\dot{H}+H^2)a\\mathbf{x}$ cancels from both sides. We are left with the comoving momentum equation:\n$$\n\\frac{\\partial \\mathbf{v}}{\\partial t} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v} \\cdot \\nabla_{\\mathbf{x}})\\mathbf{v} = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\nThe total or convective derivative of the peculiar velocity in comoving coordinates is $d\\mathbf{v}/dt = \\partial \\mathbf{v}/\\partial t + (\\dot{\\mathbf{x}}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} = \\partial \\mathbf{v}/\\partial t + (\\frac{\\mathbf{v}}{a}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}$. Thus, the equation can be written as:\n$$\n\\frac{d\\mathbf{v}}{dt} + H\\mathbf{v} = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\nRearranging to isolate the source terms on the right:\n$$\n\\frac{d\\mathbf{v}}{dt} = -H(t)\\mathbf{v} - \\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\nThe term **$-H(t)\\mathbf{v}$** is explicitly identified as the \"Hubble drag\" term. It acts as a frictional force, damping peculiar velocities as the universe expands.\n\n**Assumptions Made:**\n1.  The fluid is ideal (non-viscous and non-conducting).\n2.  The dynamics are non-relativistic ($v \\ll c$, $P \\ll \\rho c^2$).\n3.  Gravity is described by Newtonian theory on a background FLRW metric. This is valid for scales much smaller than the Hubble radius.\n4.  The universe is spatially flat ($k=0$).\n5.  The gravitational potential is separable into a smooth background component and a peculiar perturbation.\n\n**Part 2: Numerical Calculation of Discretization Bias**\n\nWe are tasked with solving the simplified ODE $\\frac{dv}{dt} = -H(t)v$ for a scalar velocity amplitude $v$ using two different numerical schemes and computing the relative error.\n\n**Eulerian Update (Forward Euler):**\nThis is a first-order explicit method. The velocity at step $n+1$ is updated using values at step $n$:\n$$v_{n+1} = v_n + \\Delta t \\left( \\frac{dv}{dt} \\right)_n = v_n + \\Delta t (-H(t_n)v_n) = v_n(1 - H(t_n)\\Delta t)$$\n\n**Lagrangian Update (Trapezoidal Rule):**\nThis is a second-order implicit method. The update rule averages the derivative at the beginning and end of the time step:\n$$v_{n+1} = v_n + \\frac{\\Delta t}{2}\\left[ \\left(\\frac{dv}{dt}\\right)_n + \\left(\\frac{dv}{dt}\\right)_{n+1} \\right] = v_n + \\frac{\\Delta t}{2}[-H(t_n)v_n - H(t_{n+1})v_{n+1}]$$\nSolving for $v_{n+1}$:\n$$v_{n+1}\\left(1 + \\frac{\\Delta t}{2}H(t_{n+1})\\right) = v_n\\left(1 - \\frac{1}{2}H(t_n)\\Delta t\\right)$$\n$$v_{n+1} = v_n \\frac{1 - \\frac{1}{2}H(t_n)\\Delta t}{1 + \\frac{1}{2}H(t_{n+1})\\Delta t}$$\n\nThe code below implements these two schemes for each test case, calculates the final velocity $v_{\\mathrm{num}}(t_f)$, compares it to the given $v_{\\mathrm{exact}}(t_f)$, and reports the discretization bias $\\epsilon = (v_{\\mathrm{num}} - v_{\\mathrm{exact}})/v_{\\mathrm{exact}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discretization bias for Eulerian (Forward Euler) and\n    Lagrangian (Trapezoidal) schemes for the Hubble drag ODE.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: constant Hubble, moderate step\n        {\n            \"H_func\": lambda t, H0=2.27e-18: H0,\n            \"H0\": 2.27e-18,\n            \"t0\": 0.0,\n            \"v0\": 3.0e5,\n            \"dt\": 5.0e16,\n            \"N\": 10,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * np.exp(-H0 * N * dt)\n        },\n        # Case 2: matter-dominated expansion\n        {\n            \"H_func\": lambda t: 2.0 / (3.0 * t) if t > 0 else np.inf,\n            \"t0\": 1.0e16,\n            \"v0\": 3.0e5,\n            \"dt\": 5.0e15,\n            \"N\": 8,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * (t0 / (t0 + N * dt))**(2.0/3.0)\n        },\n        # Case 3: constant Hubble, small step\n        {\n            \"H_func\": lambda t, H0=2.27e-18: H0,\n            \"H0\": 2.27e-18,\n            \"t0\": 0.0,\n            \"v0\": 3.0e5,\n            \"dt\": 1.0e15,\n            \"N\": 10,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * np.exp(-H0 * N * dt)\n        },\n        # Case 4: constant Hubble, extreme coarse step\n        {\n            \"H_func\": lambda t, H0=2.27e-18: H0,\n            \"H0\": 2.27e-18,\n            \"t0\": 0.0,\n            \"v0\": 3.0e5,\n            \"dt\": 5.0e18,\n            \"N\": 1,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * np.exp(-H0 * N * dt)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        t0 = case[\"t0\"]\n        v0 = case[\"v0\"]\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n        H_func = case[\"H_func\"]\n        H0 = case.get(\"H0\") # Will be None if not applicable\n\n        # Calculate exact solution\n        v_exact = case[\"exact_sol\"](v0, H0, N, dt, t0)\n\n        # Eulerian (Forward Euler) simulation\n        v_euler = v0\n        t_current = t0\n        for _ in range(N):\n            H_current = H_func(t_current)\n            v_euler = v_euler * (1.0 - H_current * dt)\n            t_current += dt\n        \n        bias_eulerian = (v_euler - v_exact) / v_exact\n\n        # Lagrangian (Trapezoidal) simulation\n        v_lagrange = v0\n        t_current = t0\n        for _ in range(N):\n            H_current = H_func(t_current)\n            H_next = H_func(t_current + dt)\n            \n            numerator = 1.0 - 0.5 * H_current * dt\n            denominator = 1.0 + 0.5 * H_next * dt\n            \n            v_lagrange = v_lagrange * (numerator / denominator)\n            t_current += dt\n\n        bias_lagrangian = (v_lagrange - v_exact) / v_exact\n        \n        results.append([bias_eulerian, bias_lagrangian])\n\n    # Format the final output string exactly as required\n    inner_strings = [f\"[{e_E},{e_L}]\" for e_E, e_L in results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "A core challenge in computational hydrodynamics is accurately modeling advection—the transport of quantities by a fluid's velocity field. In an Eulerian framework, the fluid moves across a fixed grid, whereas in a Lagrangian framework, the computational elements (particles) move with the fluid. This exercise  isolates the problem of advection by simulating the transport of a passive scalar. By comparing a classic Eulerian finite-volume scheme to a Lagrangian approach of direct translation and remapping, you will gain hands-on experience with the characteristic numerical artifacts, such as numerical diffusion and dispersion, that are fundamental to understanding the behavior of any hydrodynamics code.",
            "id": "3477134",
            "problem": "Consider the one-dimensional conservative advection of a passive scalar field in a periodic domain, a canonical subproblem that appears in hydrodynamical components of numerical cosmology where advection over fixed spatial meshes may produce spurious phase and amplitude artifacts often referred to as “ghost flow” errors. Let the domain be $[0,L]$ with $L=1$, and let the scalar field be $u(x,t)$ satisfying the linear advection equation\n$$\n\\partial_t u(x,t) + v\\,\\partial_x u(x,t) = 0,\n$$\nwith constant velocity $v$. The initial condition is a smooth periodic pattern specified in radians:\n$$\nu(x,0) = \\sin(2\\pi x) + 0.25\\cos(6\\pi x),\n$$\nwhere the trigonometric functions take their arguments in radians. All quantities are dimensionless.\n\nYou must implement and compare, over long times, the growth of discrete $L_2$ error for two numerical approaches:\n\n- The Eulerian finite-volume method on a uniform mesh with $N$ cells, using an upwind flux consistent with the sign of $v$. The mesh is fixed in space, periodic boundary conditions apply, and stability must be ensured by an appropriate choice of the time step.\n- The Lagrangian translation followed by conservative remapping onto the fixed Eulerian mesh at each step, using the method of characteristics to obtain the field at fixed mesh locations after translation. In practice, at each time step, translate the field by the physical distance $v\\,\\Delta t$ and then remap to the original fixed mesh with linear interpolation that respects periodicity.\n\nTo eliminate commensurability effects between the velocity and the mesh that can mask long-time accumulation of error, impose an irrational Courant–Friedrichs–Lewy (CFL) number. Define the Courant number\n$$\nc \\equiv \\frac{v\\,\\Delta t}{\\Delta x},\n$$\nand set $v = \\sqrt{2}$ and $c = \\frac{\\sqrt{3}}{7}$ for every test case. Here $\\Delta x=L/N$ and $\\Delta t = c\\,\\Delta x / v$.\n\nFor each test case, evolve both schemes for $n$ time steps from $t=0$ to $t = n\\,\\Delta t$, and then compute the discrete $L_2$ error of each scheme with respect to the exact solution\n$$\nu_{\\text{exact}}(x,t) = \\sin\\!\\big(2\\pi (x - v t)\\big) + 0.25\\cos\\!\\big(6\\pi (x - v t)\\big),\n$$\nusing the discrete norm on the cell centers $x_i = (i+0.5)\\Delta x$:\n$$\n\\|e\\|_{2,\\Delta} = \\left(\\Delta x \\sum_{i=0}^{N-1} \\left[u_i - u_{\\text{exact}}(x_i,t)\\right]^2 \\right)^{1/2}.\n$$\n\nImplement both schemes from first principles, starting from the conservation law, without invoking specialized advection black-box routines. The Eulerian update must be derived from flux differences on control volumes, and the Lagrangian step must be derived from characteristics followed by interpolation-based remap consistent with periodic boundaries.\n\nAll outputs are dimensionless floats. Use radians for angles. Your program should evaluate the following test suite, which spans a “happy path,” boundary conditions on the number of steps, and resolution sensitivity:\n\n- Test $1$: $N=64$, $n=1000$.\n- Test $2$: $N=128$, $n=2000$.\n- Test $3$: $N=64$, $n=0$.\n- Test $4$: $N=64$, $n=1$.\n\nFor each test case, return a list containing two floats rounded to $6$ decimal places: the Eulerian discrete $L_2$ error and the Lagrangian discrete $L_2$ error at the final time. Your program should produce a single line of output containing the results for all test cases as a comma-separated list of such lists enclosed in square brackets. For example, the output format must be\n[[e_{E,1},e_{L,1}],[e_{E,2},e_{L,2}],[e_{E,3},e_{L,3}],[e_{E,4},e_{L,4}]],\nwhere each $e_{E,k}$ and $e_{L,k}$ are floats rounded to $6$ decimal places.",
            "solution": "We begin from the conservation statement for passive scalar advection in one spatial dimension,\n$$\n\\partial_t u(x,t) + \\partial_x (F) = 0, \\quad F = v\\,u,\n$$\nwith constant velocity $v$. The analytical solution follows from the method of characteristics. Characteristics satisfy $dx/dt = v$, so the solution is constant along lines $x - v t = \\text{const}$, implying\n$$\nu(x,t) = u_0(x - v t),\n$$\nwhere $u_0(x)$ is the initial condition. With periodic boundary conditions on $[0,L]$, wrapping modulo $L$ preserves this form.\n\nWe define a uniform mesh with $N$ cells, cell width $\\Delta x = L/N$, and cell centers $x_i = (i+0.5)\\Delta x$ for $i \\in \\{0,\\dots,N-1\\}$. The time step is chosen based on the Courant–Friedrichs–Lewy (CFL) number $c$,\n$$\nc \\equiv \\frac{v\\,\\Delta t}{\\Delta x}.\n$$\nWe set $v=\\sqrt{2}$ and $c = \\frac{\\sqrt{3}}{7}$ which is irrational, hence\n$$\n\\Delta t = \\frac{c\\,\\Delta x}{v}.\n$$\nThis guarantees that the per-step translation is an irrational fraction of the cell width, thereby avoiding exact alignment with mesh cells over time and revealing cumulative numerical errors.\n\nEulerian finite-volume upwind scheme:\nWe integrate the conservation law over a control volume $[x_{i-1/2},x_{i+1/2}]$ and apply the divergence theorem, yielding\n$$\n\\frac{d}{dt} \\bar{u}_i(t) = -\\frac{1}{\\Delta x}\\left(F_{i+1/2} - F_{i-1/2}\\right),\n$$\nwhere $\\bar{u}_i$ is the cell-averaged value. With $v>0$, the upwind flux at an interface uses the left state, $F_{i+1/2} = v\\,\\bar{u}_i$, and $F_{i-1/2} = v\\,\\bar{u}_{i-1}$. Discretizing in time by a forward Euler step,\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x}\\left(v\\,\\bar{u}_i^n - v\\,\\bar{u}_{i-1}^n\\right) = \\bar{u}_i^n - c\\left(\\bar{u}_i^n - \\bar{u}_{i-1}^n\\right),\n$$\nfor $v>0$, which is stable for $0 < c \\le 1$. The periodic boundary is enforced by defining $\\bar{u}_{-1}^n \\equiv \\bar{u}_{N-1}^n$. Although we evolve point values at cell centers in practice, this discrete update is consistent with the finite-volume upwind approach for smooth fields and captures the Eulerian advection mechanism on a fixed grid.\n\nLagrangian translation with remap:\nFrom characteristics, the exact continuous solution at time $t^{n+1}$ at location $x$ is $u(x,t^{n+1}) = u(x - v\\,\\Delta t, t^n)$. To evaluate at the fixed mesh points $x_i$, we require the value of $u(\\cdot, t^n)$ at the off-grid position $y_i = x_i - v\\,\\Delta t$. On a discrete mesh, we approximate this via periodic linear interpolation between the nearest cell-centered samples. Let the fractional index corresponding to $y_i$ be\n$$\nj_i = \\frac{y_i}{\\Delta x} - 0.5,\n$$\nwith integer part $k_i = \\lfloor j_i \\rfloor$ and fractional part $\\theta_i = j_i - k_i$. The periodic indices are $k_i \\bmod N$ and $(k_i+1) \\bmod N$. The remapped value at $x_i$ is\n$$\nu_i^{n+1} = (1-\\theta_i) u_{k_i}^n + \\theta_i u_{k_i+1}^n,\n$$\nwith all indices taken modulo $N$ to enforce periodicity. This realizes a Lagrangian step (translation by $v\\,\\Delta t$) followed by a conservative remap to the fixed Eulerian grid at each time step. While the continuous characteristic solution is exact, the discrete interpolation introduces controlled error that differs in character from Eulerian numerical diffusion and dispersion.\n\nExact solution and error metric:\nAt final time $t^n = n\\,\\Delta t$, the exact solution on the mesh is\n$$\nu_{\\text{exact}}(x_i,t^n) = \\sin\\!\\big(2\\pi(x_i - v\\,t^n)\\big) + 0.25\\cos\\!\\big(6\\pi(x_i - v\\,t^n)\\big).\n$$\nWe evaluate the discrete $L_2$ error as\n$$\n\\|e\\|_{2,\\Delta} = \\left(\\Delta x \\sum_{i=0}^{N-1} \\left[u_i^n - u_{\\text{exact}}(x_i,t^n)\\right]^2 \\right)^{1/2}.\n$$\nThis discrete norm is a Riemann-sum approximation to the continuous $L_2$ norm, preserving the correct scaling with resolution.\n\nAlgorithmic design:\n- Initialize the mesh and cell centers $x_i = (i+0.5)\\Delta x$, and set $u_i^0 = \\sin(2\\pi x_i) + 0.25\\cos(6\\pi x_i)$.\n- Compute $\\Delta t = c\\,\\Delta x / v$ with $v=\\sqrt{2}$ and $c=\\sqrt{3}/7$.\n- For Eulerian advection, iterate $n$ times using the upwind update $\\bar{u}_i^{n+1} = \\bar{u}_i^n - c(\\bar{u}_i^n - \\bar{u}_{i-1}^n)$.\n- For Lagrangian translation, iterate $n$ times by periodic linear interpolation of $u^n$ evaluated at $x_i - v\\,\\Delta t$ to obtain $u^{n+1}$.\n- After $n$ steps, compute $t^n = n\\,\\Delta t$, construct $u_{\\text{exact}}(x_i,t^n)$, and evaluate the discrete $L_2$ error for each scheme.\n- Repeat for each test case. The irrational $c$ prevents synchrony between per-step shift and mesh spacing, unveiling long-time accumulation of numerical artifacts.\n\nNumerical considerations:\n- The Eulerian upwind method is first-order accurate and introduces numerical diffusion that accumulates with time, typically manifesting as amplitude damping of advected modes. Its phase error depends on $c$ and resolution.\n- The Lagrangian translation with linear remap preserves amplitude more effectively per step but introduces interpolation errors with different dispersion characteristics. Over long times, the irrational per-step displacement prevents periodic cancellation of remap errors, allowing a clear comparison of growth rates.\n- Using radians for the trigonometric functions ensures consistency with the definition of the initial pattern. All quantities are dimensionless, and no physical unit conversion is required.\n\nOutput specification:\nFor each test case, return a list $[e_E, e_L]$ where $e_E$ is the Eulerian discrete $L_2$ error and $e_L$ is the Lagrangian discrete $L_2$ error, both rounded to $6$ decimal places. Aggregate the four test case results into a single line as\n[[e_{E,1},e_{L,1}],[e_{E,2},e_{L,2}],[e_{E,3},e_{L,3}],[e_{E,4},e_{L,4}]].",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef initial_condition(x):\n    # Trigonometric functions use radians by default in numpy.\n    return np.sin(2.0 * np.pi * x) + 0.25 * np.cos(6.0 * np.pi * x)\n\ndef exact_solution(x, v, t):\n    return np.sin(2.0 * np.pi * (x - v * t)) + 0.25 * np.cos(6.0 * np.pi * (x - v * t))\n\ndef eulerian_upwind(u, c):\n    # v > 0 assumed; upwind uses left neighbor. Periodic wrap.\n    # u_{i}^{n+1} = u_{i}^{n} - c (u_{i}^{n} - u_{i-1}^{n})\n    u_prev = u\n    u_shift_left = np.roll(u_prev, 1)\n    return u_prev - c * (u_prev - u_shift_left)\n\ndef lagrangian_translate_linear(u, shift, dx):\n    # shift is physical distance v*dt. Map u(x - shift) to the fixed grid.\n    # Cell centers at x_i = (i + 0.5) * dx. The fractional index for y_i = x_i - shift is:\n    # j = y / dx - 0.5. Then linear interp between floor(j) and floor(j)+1 with periodic wrap.\n    N = u.size\n    # Indices grid i=0..N-1 corresponds to x_i = (i+0.5)*dx\n    # Compute j for all i in vectorized form: j_i = i - shift/dx\n    # Because j = y/dx - 0.5 = ((i+0.5)dx - shift)/dx - 0.5 = i - shift/dx\n    j = np.arange(N, dtype=float) - (shift / dx)\n    k = np.floor(j).astype(int)\n    theta = j - k\n    k0 = np.mod(k, N)\n    k1 = np.mod(k + 1, N)\n    return (1.0 - theta) * u[k0] + theta * u[k1]\n\ndef discrete_L2(u, u_exact, dx):\n    return np.sqrt(dx * np.sum((u - u_exact) ** 2))\n\ndef run_case(N, n_steps, v, c, L=1.0):\n    dx = L / N\n    dt = c * dx / v\n    x_centers = (np.arange(N, dtype=float) + 0.5) * dx\n    # Initialize\n    u0 = initial_condition(x_centers)\n    # Eulerian evolution\n    u_e = u0.copy()\n    # Lagrangian evolution\n    u_l = u0.copy()\n    # Per-step physical shift\n    shift = v * dt\n    for _ in range(n_steps):\n        u_e = eulerian_upwind(u_e, c)\n        u_l = lagrangian_translate_linear(u_l, shift, dx)\n    t_final = n_steps * dt\n    u_exact = exact_solution(x_centers, v, t_final)\n    err_e = discrete_L2(u_e, u_exact, dx)\n    err_l = discrete_L2(u_l, u_exact, dx)\n    return err_e, err_l\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is (N, n_steps)\n    test_cases = [\n        (64, 1000),\n        (128, 2000),\n        (64, 0),\n        (64, 1),\n    ]\n    # Constants: v = sqrt(2), c = sqrt(3)/7 (irrational Courant number)\n    v = np.sqrt(2.0)\n    c = np.sqrt(3.0) / 7.0\n\n    results = []\n    for N, n_steps in test_cases:\n        err_e, err_l = run_case(N, n_steps, v, c, L=1.0)\n        # Round to 6 decimal places as required\n        results.append([round(err_e, 6), round(err_l, 6)])\n\n    # Final print statement in the exact required format.\n    # Format: [[eE1,eL1],[eE2,eL2],[eE3,eL3],[eE4,eL4]]\n    print(f\"[{','.join('[' + ','.join(map(lambda x: f'{x:.6f}', pair)) + ']' for pair in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond visual inspection or simple error norms, a powerful way to formally analyze the performance of a numerical scheme is by studying its dispersion relation, $\\omega(k)$. This relation acts as a fingerprint, revealing how accurately the scheme propagates waves of different wavenumbers $k$ and quantifying its inherent numerical dissipation and dispersion. This advanced practice  guides you through deriving and comparing the numerical dispersion relations for two state-of-the-art methods: the Lagrangian Smoothed Particle Hydrodynamics (SPH) and an Eulerian finite-volume method with a Riemann solver. By applying this analysis to sound waves in an expanding background—a physically crucial phenomenon in cosmology—you will develop a sophisticated understanding of how these competing frameworks handle the essential wave physics that underpins structure formation.",
            "id": "3477154",
            "problem": "Consider the one-dimensional linearized hydrodynamics of a barotropic gas with constant sound speed $c_s$ in a spatially flat, uniformly expanding Friedmann–Lemaître–Robertson–Walker (FLRW) background. Work in comoving coordinates $x$ and assume the scale factor satisfies $a(t) \\approx 1$ over the time interval of interest and the Hubble expansion rate $H \\equiv \\dot{a}/a$ is constant. Let the background density be $\\rho_0$ and consider small perturbations of density $\\delta \\rho(x,t)$ and peculiar velocity $v(x,t)$ about the uniform state.\n\nFundamental base to use:\n- Linearized continuity and momentum equations in comoving coordinates for an isothermal gas:\n  - $\\partial_t \\delta \\rho + (\\rho_0/a)\\,\\partial_x v = 0$,\n  - $\\partial_t v + H v + (c_s^2/(a\\rho_0))\\,\\partial_x \\delta \\rho = 0$.\n- Plane-wave perturbations $\\propto \\exp(i k x - i \\omega t)$ and the definition of the dispersion relation $\\omega(k)$.\n- Finite-volume flux-difference form with a Riemann solver for linear systems, and Smoothed Particle Hydrodynamics (SPH) with a compact-support kernel for spatial gradients.\n\nTask:\n1. Derive, from the fundamental base, the semi-discrete linear operators in Fourier space that govern the evolution of the vector of perturbations $Q \\equiv [\\delta \\rho, v]^T$ for:\n   - A Lagrangian Smoothed Particle Hydrodynamics (SPH) discretization using the one-dimensional cubic spline kernel with smoothing length parameter $h$ on a uniform particle lattice of spacing $\\Delta x$. Treat the kernel gradient consistently for linear perturbations and uniform particle masses. Restrict interactions to the kernel support.\n   - An Eulerian finite-volume discretization on a uniform grid of spacing $\\Delta x$ using a two-wave approximate Riemann solver consistent with the Harten–Lax–van Leer–Contact (HLLC) family for linear acoustics. Use piecewise constant reconstruction (first order) and periodic boundary conditions. For the linear acoustic system, adopt the flux Jacobian $A = \\begin{bmatrix} 0 & \\rho_0 \\\\ c_s^2/\\rho_0 & 0 \\end{bmatrix}$ and its absolute value $|A|$ in the numerical diffusion term as implied by the solver.\n2. Using the semi-discrete operators, obtain the numerical dispersion relations $\\omega_{\\mathrm{SPH}}(k)$ and $\\omega_{\\mathrm{E}}(k)$ by solving the eigenvalue problem for the spatial operator matrices. Use the relation $-i \\omega = \\lambda$, where $\\lambda$ is a semi-discrete eigenvalue of the spatial operator.\n3. For the continuum baseline at $a=1$, derive the analytic dispersion relation for small-amplitude sound waves in a uniformly expanding background, $\\omega_{\\mathrm{cont}}(k)$, and express it explicitly in terms of $c_s$, $k$, and $H$.\n\nQuantify the kernel bias and consistency of SPH relative to the Eulerian finite-volume method by computing, for a specified test suite of wavenumbers and smoothing lengths, the deviations of the numerical dispersion relations (both real and imaginary components) from the continuum:\n- $\\Delta \\omega_{\\mathrm{SPH,\\,Re}} = \\mathrm{Re}(\\omega_{\\mathrm{SPH}}) - \\mathrm{Re}(\\omega_{\\mathrm{cont}})$,\n- $\\Delta \\omega_{\\mathrm{SPH,\\,Im}} = \\mathrm{Im}(\\omega_{\\mathrm{SPH}}) - \\mathrm{Im}(\\omega_{\\mathrm{cont}})$,\n- $\\Delta \\omega_{\\mathrm{E,\\,Re}} = \\mathrm{Re}(\\omega_{\\mathrm{E}}) - \\mathrm{Re}(\\omega_{\\mathrm{cont}})$,\n- $\\Delta \\omega_{\\mathrm{E,\\,Im}} = \\mathrm{Im}(\\omega_{\\mathrm{E}}) - \\mathrm{Im}(\\omega_{\\mathrm{cont}})$.\n\nAll frequencies must be expressed in $\\mathrm{s}^{-1}$. The imaginary components are damping rates and are typically non-positive. Choose, for each method, the branch of the dispersion relation with non-negative real part of $\\omega$ (the positive-frequency acoustic mode), and report the deviations for that branch.\n\nUse the following globally consistent parameters for all test cases:\n- Domain length $L = 1.0\\,\\mathrm{m}$, number of grid points $N = 64$, hence $\\Delta x = L/N$.\n- Sound speed $c_s = 1000\\,\\mathrm{m/s}$.\n- Background density $\\rho_0 = 1.0\\,\\mathrm{kg/m^3}$.\n- Scale factor $a = 1$ throughout.\n\nDefine the wavenumber set via $k_n = n\\, (2\\pi/L)$ for integer $n$, and also include a high-wavenumber case near the Nyquist limit $k_{\\mathrm{Ny}} = \\pi/\\Delta x$.\n\nTest suite (each case is a tuple $(k, h, H)$):\n- Case 1 (happy path, small $k$, moderate smoothing, no expansion): $k = k_1$, $h = 2.0\\,\\Delta x$, $H = 0\\,\\mathrm{s}^{-1}$.\n- Case 2 (moderate $k$, moderate smoothing, mild expansion): $k = k_{10}$, $h = 2.0\\,\\Delta x$, $H = 100\\,\\mathrm{s}^{-1}$.\n- Case 3 (near-Nyquist, dispersion-dominated regime, moderate smoothing, no expansion): $k = 0.8\\,k_{\\mathrm{Ny}}$, $h = 2.0\\,\\Delta x$, $H = 0\\,\\mathrm{s}^{-1}$.\n- Case 4 (happy path, small $k$, under-smoothed SPH challenging consistency, no expansion): $k = k_1$, $h = 1.2\\,\\Delta x$, $H = 0\\,\\mathrm{s}^{-1}$.\n- Case 5 (moderate $k$, heavy smoothing, mild expansion): $k = k_5$, $h = 3.0\\,\\Delta x$, $H = 50\\,\\mathrm{s}^{-1}$.\n- Case 6 (moderate $k$, moderate smoothing, near-critical expansion damping): $k = k_8$, $h = 2.0\\,\\Delta x$, $H = 0.9\\times 2 c_s k$.\n\nYour program must compute, for each test case, the four deviations defined above and aggregate them into a single output line.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, each inner list ordered as $[\\Delta \\omega_{\\mathrm{SPH,\\,Re}}, \\Delta \\omega_{\\mathrm{SPH,\\,Im}}, \\Delta \\omega_{\\mathrm{E,\\,Re}}, \\Delta \\omega_{\\mathrm{E,\\,Im}}]$, all in $\\mathrm{s}^{-1}$, enclosed in square brackets. For example: $[[x_1,y_1,u_1,v_1],[x_2,y_2,u_2,v_2],\\dots]$.\n\nScientific realism constraints:\n- Use the one-dimensional cubic spline kernel with compact support $2h$ and the standard normalization in one dimension.\n- Use periodicity consistent with uniform lattices and restrict SPH interactions to integer neighbor offsets $m$ satisfying $|m|\\Delta x \\le 2h$.\n- For the Eulerian method, treat the absolute Jacobian $|A|$ as implied by the two-wave Riemann solver for this symmetric linear acoustic system.\n\nYour solution must be a complete, runnable Python program that implements the above and prints the final output in the exact specified format.",
            "solution": "The user wants to validate and solve a problem comparing Lagrangian (SPH) and Eulerian (Finite Volume) numerical methods in the context of one-dimensional linearized hydrodynamics in an expanding universe.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n-   **System**: One-dimensional linearized hydrodynamics of a barotropic gas.\n-   **Background Geometry**: Spatially flat, uniformly expanding Friedmann–Lemaître–Robertson–Walker (FLRW) background.\n-   **Coordinates**: Comoving coordinates $x$.\n-   **Parameters and Approximations**:\n    -   Constant sound speed $c_s$.\n    -   Scale factor $a(t) \\approx 1$.\n    -   Constant Hubble expansion rate $H \\equiv \\dot{a}/a$.\n    -   Background density $\\rho_0$.\n    -   Perturbations: density $\\delta \\rho(x,t)$, peculiar velocity $v(x,t)$.\n-   **Fundamental Equations**:\n    -   Continuity: $\\partial_t \\delta \\rho + (\\rho_0/a)\\,\\partial_x v = 0$.\n    -   Momentum: $\\partial_t v + H v + (c_s^2/(a\\rho_0))\\,\\partial_x \\delta \\rho = 0$.\n-   **Analysis Method**:\n    -   Plane-wave perturbations $\\propto \\exp(i k x - i \\omega t)$.\n    -   Dispersion relation $\\omega(k)$.\n    -   Semi-discrete eigenvalue relation: $-i \\omega = \\lambda$.\n-   **Numerical Schemes**:\n    -   **SPH**: Lagrangian, one-dimensional cubic spline kernel with smoothing length $h$, uniform particle lattice of spacing $\\Delta x$, restricted interactions to kernel support.\n    -   **Eulerian**: Finite-volume, uniform grid of spacing $\\Delta x$, two-wave approximate Riemann solver (HLLC family), piecewise constant reconstruction, periodic boundary conditions.\n    -   **Eulerian Flux Jacobian**: $A = \\begin{bmatrix} 0 & \\rho_0 \\\\ c_s^2/\\rho_0 & 0 \\end{bmatrix}$ and $|A|$ as implied by the solver.\n-   **Task**:\n    1.  Derive semi-discrete linear operators in Fourier space for SPH and Eulerian methods.\n    2.  Obtain numerical dispersion relations $\\omega_{\\mathrm{SPH}}(k)$ and $\\omega_{\\mathrm{E}}(k)$.\n    3.  Derive the analytic continuum dispersion relation $\\omega_{\\mathrm{cont}}(k)$.\n    4.  Compute deviations: $\\Delta \\omega_{\\mathrm{SPH,\\,Re}}$, $\\Delta \\omega_{\\mathrm{SPH,\\,Im}}$, $\\Delta \\omega_{\\mathrm{E,\\,Re}}$, $\\Delta \\omega_{\\mathrm{E,\\,Im}}$.\n-   **Global Parameters**:\n    -   $L = 1.0\\,\\mathrm{m}$.\n    -   $N = 64$.\n    -   $\\Delta x = L/N$.\n    -   $c_s = 1000\\,\\mathrm{m/s}$.\n    -   $\\rho_0 = 1.0\\,\\mathrm{kg/m^3}$.\n    -   $a = 1$.\n-   **Wavenumbers**: $k_n = n\\, (2\\pi/L)$, $k_{\\mathrm{Ny}} = \\pi/\\Delta x$.\n-   **Test Suite**: 6 cases of $(k, h, H)$ are provided.\n-   **Output Format**: Single line, comma-separated list of lists: `[[d_re_sph, d_im_sph, d_re_e, d_im_e], ...]`.\n\n**Step 2: Validate Using Extracted Givens**\n\n1.  **Scientifically Grounded**: The problem is well-grounded in the standard model of cosmology (FLRW metric) and the physics of fluids (hydrodynamic equations). The use of linearized equations for perturbation analysis is a standard, valid technique. The numerical methods (SPH, a Lagrangian method, and Finite Volume, an Eulerian method) are cornerstone techniques in computational astrophysics and cosmology.\n2.  **Well-Posed**: The problem is well-posed. It asks for the derivation and comparison of dispersion relations, a standard technique for analyzing the accuracy and stability of numerical schemes. The given parameters and equations are sufficient to determine unique numerical dispersion relations for each scheme and the analytic continuum baseline.\n3.  **Objective**: The problem is stated in precise, objective mathematical and physical language. The tasks are quantitative and free of subjective interpretation.\n4.  **Completeness**: The problem is self-contained. All necessary equations, parameters, numerical scheme definitions, and test cases are explicitly provided.\n5.  **Consistency**: There are no internal contradictions in the provided data or equations. The parameters are physically consistent.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. It is a standard, albeit complex, theoretical exercise in numerical methods for astrophysics. We will proceed with the solution.\n\n### Principle-Based Solution\n\nThe core of the problem is to derive and compare the dispersion relations for sound waves in an expanding medium, as represented by the continuum equations and two different numerical discretizations. A dispersion relation $\\omega(k)$ connects the temporal frequency $\\omega$ of a plane-wave mode to its spatial wavenumber $k$. For a numerical scheme, this relation reveals how accurately the scheme propagates waves of different length scales and what numerical errors (dispersion and dissipation) it introduces.\n\n**1. Continuum Analytic Dispersion Relation, $\\omega_{\\mathrm{cont}}(k)$**\n\nWe begin with the provided linearized hydrodynamics equations, setting the scale factor $a=1$:\n$$\n\\partial_t \\delta \\rho + \\rho_0\\,\\partial_x v = 0\n$$\n$$\n\\partial_t v + H v + \\frac{c_s^2}{\\rho_0}\\,\\partial_x \\delta \\rho = 0\n$$\nWe seek plane-wave solutions of the form $\\delta\\rho(x,t) = \\delta\\tilde{\\rho} e^{i(kx - \\omega t)}$ and $v(x,t) = \\tilde{v} e^{i(kx - \\omega t)}$. Substituting these into the equations and replacing $\\partial_t$ with $-i\\omega$ and $\\partial_x$ with $ik$ yields a linear system for the amplitudes $\\delta\\tilde{\\rho}$ and $\\tilde{v}$:\n$$\n\\begin{bmatrix} -i\\omega & i k \\rho_0 \\\\ i k c_s^2/\\rho_0 & -i\\omega + H \\end{bmatrix} \\begin{bmatrix} \\delta\\tilde{\\rho} \\\\ \\tilde{v} \\end{bmatrix} = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}\n$$\nFor a non-trivial solution, the determinant of the matrix must be zero:\n$$\n(-i\\omega)(-i\\omega + H) - (i k \\rho_0)\\left(\\frac{i k c_s^2}{\\rho_0}\\right) = 0\n$$\n$$\n-\\omega^2 - i\\omega H + k^2 c_s^2 = 0 \\quad \\implies \\quad \\omega^2 + i\\omega H - (k c_s)^2 = 0\n$$\nThis is a quadratic equation for $\\omega$. Solving for $\\omega$ gives:\n$$\n\\omega = \\frac{-iH \\pm \\sqrt{(iH)^2 - 4(1)(-(k c_s)^2)}}{2} = -\\frac{iH}{2} \\pm \\sqrt{(k c_s)^2 - \\left(\\frac{H}{2}\\right)^2}\n$$\nThe problem specifies selecting the branch with a non-negative real part, which we denote $\\omega_{\\mathrm{cont}}(k)$. This corresponds to the positive-frequency acoustic mode. The solution depends on the sign of the argument of the square root. Let $S_c = (k c_s)^2 - (H/2)^2$.\nIf $S_c \\ge 0$, the waves propagate. We choose the positive root for the real part:\n$$\n\\mathrm{Re}(\\omega_{\\mathrm{cont}}) = \\sqrt{S_c}, \\quad \\mathrm{Im}(\\omega_{\\mathrm{cont}}) = -\\frac{H}{2}\n$$\nIf $S_c < 0$, the waves are overdamped (non-propagating). The square root becomes imaginary, $\\sqrt{S_c} = i\\sqrt{-S_c}$.\n$$\n\\omega_{\\mathrm{cont}} = -\\frac{iH}{2} \\pm i\\sqrt{-S_c} = i \\left( -\\frac{H}{2} \\pm \\sqrt{\\left(\\frac{H}{2}\\right)^2 - (k c_s)^2} \\right)\n$$\nIn this case, $\\mathrm{Re}(\\omega_{\\mathrm{cont}}) = 0$. The imaginary part corresponds to damping. We choose the mode that is least damped (the one with the largest, i.e., least negative, imaginary part), which corresponds to taking the positive sign before the square root.\n$$\n\\mathrm{Re}(\\omega_{\\mathrm{cont}}) = 0, \\quad \\mathrm{Im}(\\omega_{\\mathrm{cont}}) = -\\frac{H}{2} + \\sqrt{-S_c}\n$$\nThe term $-H/2$ represents physical damping due to the cosmic expansion (Hubble drag).\n\n**2. SPH Numerical Dispersion Relation, $\\omega_{\\mathrm{SPH}}(k)$**\n\nSmoothed Particle Hydrodynamics (SPH) discretizes the fluid into a set of particles. For linear perturbations on a uniform lattice, we can derive an effective derivative operator. By linearizing the standard SPH continuity and momentum equations around a uniform state ($\\rho=\\rho_0, v=0, m_j = \\rho_0 \\Delta x$), we find that the spatial derivative operator $\\partial_x$ is approximated by a discrete operator whose action on a plane wave $e^{ikx}$ is multiplication by $i k_{\\mathrm{eff, SPH}}$. The effective wavenumber $k_{\\mathrm{eff, SPH}}$ is given by:\n$$\nk_{\\mathrm{eff, SPH}}(k) = \\Delta x \\sum_{m} \\sin(k m \\Delta x) \\frac{\\partial W(m\\Delta x, h)}{\\partial x}\n$$\nwhere $W(x, h)$ is the SPH smoothing kernel. The sum is over all neighboring particles $m$ within the kernel's compact support. For an even kernel $W$, its derivative $\\partial_x W$ is odd. The sum can be simplified to:\n$$\nk_{\\mathrm{eff, SPH}}(k) = 2 \\Delta x \\sum_{m=1}^{M} \\sin(k m \\Delta x) \\frac{\\partial W(m\\Delta x, h)}{\\partial x}\n$$\nwhere $M = \\lfloor 2h/\\Delta x \\rfloor$.\nFor the 1D cubic spline kernel with support $2h$, we define $u = |x|/h$. The kernel is $W(x, h) = \\frac{2}{3h} \\sigma(u)$, with\n$$\n\\sigma(u) = \\begin{cases} 1 - \\frac{3}{2}u^2 + \\frac{3}{4}u^3 & 0 \\le u \\le 1 \\\\ \\frac{1}{4}(2-u)^3 & 1 < u \\le 2 \\\\ 0 & u > 2 \\end{cases}\n$$\nIts derivative is $\\partial_x W = \\mathrm{sign}(x) \\frac{1}{h} \\frac{\\partial W}{\\partial u} = \\mathrm{sign}(x) \\frac{2}{3h^2} \\sigma'(u)$, where\n$$\n\\sigma'(u) = \\begin{cases} -3u + \\frac{9}{4}u^2 & 0 \\le u \\le 1 \\\\ -\\frac{3}{4}(2-u)^2 & 1 < u \\le 2 \\\\ 0 & u > 2 \\end{cases}\n$$\nThe semi-discrete SPH equations in Fourier space are identical in form to the continuum equations, but with $k$ replaced by $k_{\\mathrm{eff, SPH}}$. This means the dispersion relation $\\omega_{\\mathrm{SPH}}(k)$ has the same functional form as $\\omega_{\\mathrm{cont}}(k)$, with this substitution:\n$$\n\\omega_{\\mathrm{SPH}} = -\\frac{iH}{2} \\pm \\sqrt{(c_s k_{\\mathrm{eff, SPH}})^2 - \\left(\\frac{H}{2}\\right)^2}\n$$\nCrucially, the linearization of the standard momentum-conserving SPH equations for an ideal gas on a uniform lattice introduces no artificial viscosity term. Therefore, the imaginary part of $\\omega_{\\mathrm{SPH}}$ is solely determined by the physical Hubble drag, just like the continuum case: $\\mathrm{Im}(\\omega_{\\mathrm{SPH}}) = -H/2$ in the propagating regime. Any deviation from the continuum is purely dispersive (i.e., in the real part of $\\omega$).\n\n**3. Eulerian Numerical Dispersion Relation, $\\omega_{\\mathrm{E}}(k)$**\n\nThe Eulerian finite-volume scheme discretizes the conservation laws on a fixed grid. The semi-discrete equation for cell $i$ is:\n$$\n\\frac{dQ_i}{dt} = -\\frac{1}{\\Delta x}(\\hat{F}_{i+1/2} - \\hat{F}_{i-1/2}) + S(Q_i)\n$$\nwhere $Q=[\\delta\\rho, v]^T$ and $S(Q)=[0, -Hv]^T$. For piecewise constant data and the specified linear system, a first-order accurate upwind flux (consistent with the HLL family) at the interface $i+1/2$ is:\n$$\n\\hat{F}_{i+1/2} = \\frac{1}{2}(F_i + F_{i+1}) - \\frac{1}{2}|A|(Q_{i+1} - Q_i)\n$$\nwhere $F(Q) = AQ$. The eigenvalues of the flux Jacobian $A = \\begin{bmatrix} 0 & \\rho_0 \\\\ c_s^2/\\rho_0 & 0 \\end{bmatrix}$ are $\\pm c_s$. The matrix absolute value is $|A|=c_s I$.\nSubstituting the flux into the update equation leads to a spatial operator that approximates $\\partial_x A Q$ with a centered difference plus a numerical diffusion term. Applying a plane wave analysis ($Q_j = \\tilde{Q} e^{ikj\\Delta x}$) to the resulting system gives a matrix equation $\\frac{d\\tilde{Q}}{dt} = M_E(k) \\tilde{Q}$. The eigenvalues $\\lambda$ of $M_E(k)$ are related to the numerical frequency by $\\lambda = -i\\omega_E$.\nSolving the eigenvalue problem for $M_E(k)$ yields:\n$$\n\\lambda = -\\left(c_s \\frac{1-\\cos(k\\Delta x)}{\\Delta x}\\right) - \\frac{H}{2} \\pm \\sqrt{\\left(\\frac{H}{2}\\right)^2 - \\left(c_s \\frac{\\sin(k\\Delta x)}{\\Delta x}\\right)^2}\n$$\nUsing $\\lambda = -i\\omega_E$ and $1-\\cos\\theta = 2\\sin^2(\\theta/2)$, we find $\\omega_E$:\n$$\n\\omega_E = i\\left(c_s \\frac{2\\sin^2(k\\Delta x/2)}{\\Delta x} + \\frac{H}{2}\\right) \\pm \\sqrt{\\left(c_s \\frac{\\sin(k\\Delta x)}{\\Delta x}\\right)^2 - \\left(\\frac{H}{2}\\right)^2}\n$$\nThe frequency for the positive-frequency branch is then:\n$$\n\\mathrm{Re}(\\omega_{E}) = \\sqrt{\\left(c_s k_{\\mathrm{eff, E}}\\right)^2 - \\left(\\frac{H}{2}\\right)^2}, \\quad \\mathrm{Im}(\\omega_{E}) = -\\frac{H}{2} - c_s \\frac{2\\sin^2(k\\Delta x/2)}{\\Delta x}\n$$\n(with appropriate modification for the overdamped case, analogous to the continuum derivation). Here, the effective wavenumber is $k_{\\mathrm{eff, E}} = \\sin(k\\Delta x)/\\Delta x$. Unlike SPH, the Eulerian scheme introduces a numerical dissipation term, $-c_s \\frac{2\\sin^2(k\\Delta x/2)}{\\Delta x}$, which adds to the physical damping, causing waves to decay faster than they should, especially at high wavenumbers.\n\n**4. Computation of Deviations**\nThe final step is to implement these derived formulas in code, evaluate them for the parameters in each test case, and compute the four specified deviations: $\\Delta \\omega_{\\mathrm{SPH,\\,Re}}$, $\\Delta \\omega_{\\mathrm{SPH,\\,Im}}$, $\\Delta \\omega_{\\mathrm{E,\\,Re}}$, and $\\Delta \\omega_{\\mathrm{E,\\,Im}}$. The results quantify the dispersive and dissipative errors of each numerical method relative to the exact continuum solution.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes deviations in numerical dispersion relations for SPH and Eulerian\n    methods from the analytical continuum solution for linearized hydrodynamics\n    in an expanding background.\n    \"\"\"\n\n    # Globally consistent parameters from the problem statement\n    L = 1.0  # Domain length in m\n    N = 64  # Number of grid points\n    delta_x = L / N  # Grid/particle spacing in m\n    c_s = 1000.0  # Sound speed in m/s\n    rho_0 = 1.0  # Background density in kg/m^3\n    a = 1.0  # Scale factor\n    \n    # Wavenumber definitions\n    k_n = lambda n: n * (2 * np.pi / L)\n    k_ny = np.pi / delta_x\n\n    # Test suite from the problem statement: (k, h, H)\n    test_cases = [\n        (k_n(1), 2.0 * delta_x, 0.0),\n        (k_n(10), 2.0 * delta_x, 100.0),\n        (0.8 * k_ny, 2.0 * delta_x, 0.0),\n        (k_n(1), 1.2 * delta_x, 0.0),\n        (k_n(5), 3.0 * delta_x, 50.0),\n        (k_n(8), 2.0 * delta_x, 0.9 * 2 * c_s * k_n(8)),\n    ]\n\n    def sigma_prime(u):\n        \"\"\"\n        Derivative of the 1D cubic spline kernel shape function sigma(u).\n        \"\"\"\n        u = np.abs(u)\n        if 0 = u = 1:\n            return -3 * u + (9.0 / 4.0) * u**2\n        elif 1  u = 2:\n            return - (3.0 / 4.0) * (2 - u)**2\n        else:\n            return 0.0\n\n    def get_dispersion_relation(k, H, k_eff, numerical_damping=0.0):\n        \"\"\"\n        Generic function to calculate dispersion relation for a given effective\n        wavenumber and numerical damping.\n        \"\"\"\n        arg_sqrt = (c_s * k_eff)**2 - (H / 2.0)**2\n        \n        if arg_sqrt >= 0:\n            re = np.sqrt(arg_sqrt)\n            im = -H / 2.0 - numerical_damping\n        else: # Overdamped case\n            re = 0.0\n            # Choose the least-damped mode (positive sign before sqrt)\n            im = -H / 2.0 + np.sqrt(-arg_sqrt) - numerical_damping\n            \n        return re, im\n\n    results = []\n    for k, h, H in test_cases:\n        # 1. Continuum Analytic Solution\n        re_cont, im_cont = get_dispersion_relation(k, H, k_eff=k)\n\n        # 2. SPH Numerical Solution\n        # SPH has no intrinsic numerical damping in this formulation.\n        M = int(np.floor(2 * h / delta_x))\n        m_vals = np.arange(1, M + 1)\n        \n        # Calculate SPH effective wavenumber\n        sum_terms = np.sin(k * m_vals * delta_x) * \\\n                    np.array([sigma_prime(m * delta_x / h) for m in m_vals])\n        \n        # Derivative of the kernel: dW/dx = sign(x) * (2/(3*h^2)) * sigma'(|x|/h)\n        # k_eff_sph = 2 * delta_x * sum_{m>0} sin(k*m*dx) * (dW/dx)(m*dx)\n        k_eff_sph = (2 * delta_x) * np.sum(sum_terms * (2.0 / (3.0 * h**2)))\n        \n        re_sph, im_sph = get_dispersion_relation(k, H, k_eff=k_eff_sph)\n\n        # 3. Eulerian Numerical Solution\n        k_eff_e = np.sin(k * delta_x) / delta_x\n        # 1st order upwind scheme has numerical dissipation\n        numerical_damping_e = c_s * (2 * np.sin(k * delta_x / 2.0)**2) / delta_x\n        \n        re_e, im_e = get_dispersion_relation(k, H, k_eff=k_eff_e, \n                                             numerical_damping=numerical_damping_e)\n        \n        # 4. Calculate deviations\n        delta_re_sph = re_sph - re_cont\n        delta_im_sph = im_sph - im_cont\n        delta_re_e = re_e - re_cont\n        delta_im_e = im_e - im_cont\n        \n        results.append([delta_re_sph, delta_im_sph, delta_re_e, delta_im_e])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}