{
    "hands_on_practices": [
        {
            "introduction": "本练习探讨了可观测属性（恒星质量）与暗晕占据分布（HOD）之间的基本联系 。通过推导基于恒星质量的样本选择如何转化为基于暗晕质量的HOD，我们可以理解中心星系占据数常用的 $\\mathrm{erf}$ 函数形式的来源。这个练习对于理解HOD模型的物理基础，以及量化因过度简化星系-暗晕关系（例如忽略弥散）而引入的系统性偏差至关重要。",
            "id": "3475178",
            "problem": "考虑在数值宇宙学中，对一个通过恒星质量阈值选择的丰度截断星系样本进行晕占有数分布（HOD）分析。令晕质量为 $M$，恒星质量为 $M_{\\star}$。在以10为底的对数坐标下进行计算，并定义 $y \\equiv \\log_{10} M$ 和 $s \\equiv \\log_{10} M_{\\star}$。假设以下物理上标准的组成部分：\n\n1. 在高质量端，晕质量函数是一个幂律，$n(M)\\,dM = n_{0}\\left(\\frac{M}{M_{0}}\\right)^{-p}\\,dM$，其中 $p>1$。\n\n2. 在固定晕质量下，恒星质量的条件分布在 $s$ 上是对数正态的，即在固定的 $y$ 下，$s$ 是一个均值为 $\\mu(y) = A + \\beta\\left(y - y_{1}\\right)$、方差为 $\\sigma^{2}$ 的高斯分布，其中 $A$、$\\beta$、 $y_{1}$ 和 $\\sigma$ 是常数。这里 $\\sigma$ 是在固定 $M$ 下 $s=\\log_{10} M_{\\star}$ 的标准差。\n\n3. 星系样本是通过一个硬阈值 $s_{\\rm th}$ 选择的，即如果 $s \\ge s_{\\rm th}$，则星系被包括在内。由此产生的数密度为 $n_{\\rm g}(s_{\\rm th}) = \\int n(M)\\,P(s \\ge s_{\\rm th}\\,|\\,M)\\,dM$。\n\n4. 中心星系的HOD（关于晕质量）由广泛使用的软步阶形式参数化\n$$\n\\langle N_{\\rm cen}(M)\\rangle = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\log_{10} M - \\log_{10} M_{\\rm min}}{\\sigma_{\\log M}}\\right)\\right],\n$$\n其中 $\\log_{10} M_{\\rm min}$ 决定了特征质量标度，而 $\\sigma_{\\log M}$ 设定了在 $\\log_{10} M$ 上的过渡宽度。\n\n从上述定义出发，并且在不引入超出这些假设的任何捷径公式或经验校准的情况下，推导在固定 $M$ 下 $s$ 的对数正态弥散对丰度截断选择的影响，并展示如果分析被错误设定，它将如何偏置对 $M_{\\rm min}$ 和 $\\sigma_{\\log M}$ 的推断。\n\n具体来说：\n\n(a) 通过 $s_{\\rm th}=\\mu(y_{\\star})$ 定义 $y_{\\star}$，并令 $n_{\\rm g}^{(0)}$ 表示通过将 $P(s \\ge s_{\\rm th}\\,|\\,M)$ 替换为尖锐阶跃 $H(y-y_{\\star})$ （其中 $H(\\cdot)$ 是亥维赛函数）所获得的零弥散数密度。推导由对数正态弥散 $\\sigma$ 引起的确切乘性增强因子 $R \\equiv \\frac{n_{\\rm g}(s_{\\rm th})}{n_{\\rm g}^{(0)}}$。\n\n(b) 假设一位分析师忽略了对数正态弥散，并通过将零弥散丰度 $n_{\\rm g}^{(0)}$ 与真实丰度 $n_{\\rm g}(s_{\\rm th})$ 相匹配来推断 $\\log_{10} M_{\\rm min}$。以闭合形式推导朴素推断的 $M_{\\rm min}$（忽略弥散）与正确推断的 $M_{\\rm min}$（考虑弥散）之间的比率 $\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}}$，并用 $p$、$\\beta$ 和 $\\sigma$ 表示。\n\n(c) 通过将由 $s$ 中的对数正态弥散引起的真实选择函数 $\\langle N_{\\rm cen}(M)\\rangle$ 的形式与上面给出的参数化HOD形式相匹配，推导 $\\sigma$ 与真实的 $\\sigma_{\\log M}^{\\rm true}$ 之间的确切关系。然后，如果有人朴素地设定 $\\sigma_{\\log M}^{\\rm naive} \\equiv \\sigma$ 而不是使用正确的关系，量化其偏差因子 $\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}}$。\n\n以一个包含两个偏差因子 $\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}}$ 和 $\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}}$ 的二元行矩阵形式提供最终答案。不需要进行数值计算；给出闭合形式的解析表达式。",
            "solution": "该问题要求我们推导当恒星质量-晕质量关系中的弥散被不正确处理时，晕占有数分布（HOD）模型推断参数中的偏差。我们将首先推导包含弥散效应的真实星系数量密度，然后确定一个简化的（无弥散的）模型会如何错误地解释这个密度，最后将星系占有的物理模型与标准的参数化HOD形式联系起来。\n\n令 $y \\equiv \\log_{10} M$ 和 $s \\equiv \\log_{10} M_{\\star}$。高质量端的晕质量函数为 $n(M)\\,dM = n_{0}\\left(\\frac{M}{M_{0}}\\right)^{-p}\\,dM$。为了使用对数质量 $y$ 进行计算，我们进行变量替换。由于 $M = 10^y$，我们有 $dM = 10^y \\ln(10) dy$。以 $y$ 表示的数密度为 $n(y) dy = n(M) dM$。因此，$n(y) = n_0 \\left(\\frac{10^y}{M_0}\\right)^{-p} 10^y \\ln(10)$。令 $M_0 = 10^{y_0}$。那么 $n(y) = n_0 \\ln(10) 10^{-p(y-y_0)} 10^y = n_0 \\ln(10) 10^{py_0} 10^{(1-p)y}$。这可以写成 $n(y) = K e^{-\\alpha y}$，其中 $\\alpha = (p-1)\\ln(10) > 0$ 且 $K$ 是一个包含其他项的常数。\n\n### (a) 增强因子 $R$ 的推导\n\n问题通过假设一个尖锐的质量截断来定义零弥散数密度 $n_{\\rm g}^{(0)}$。只有当星系的宿主晕质量 $M$ 大于某个质量 $M_{\\star}$ 时，星系才被包括在内，该质量 $M_{\\star}$ 通过其对数 $y_{\\star}$ 定义，使得平均恒星质量等于阈值：$s_{\\rm th} = \\mu(y_{\\star})$。因此，选择函数为 $H(y-y_{\\star})$，其中 $H$ 是亥维赛函数。\n$$\nn_{\\rm g}^{(0)} = \\int n(M) H(y-y_{\\star}) dM = \\int_{y_{\\star}}^{\\infty} n(y) dy\n$$\n使用我们对 $n(y)$ 的表达式：\n$$\nn_{\\rm g}^{(0)} = \\int_{y_{\\star}}^{\\infty} K e^{-\\alpha y} dy = K \\left[ -\\frac{1}{\\alpha} e^{-\\alpha y} \\right]_{y_{\\star}}^{\\infty} = \\frac{K}{\\alpha} e^{-\\alpha y_{\\star}}\n$$\n\n接下来，我们计算真实的数密度 $n_{\\rm g}(s_{\\rm th})$，它考虑了对数正态弥散 $\\sigma$。对于一个位于对数质量为 $y$ 的晕中的星系，其被选择的概率是 $P(s \\ge s_{\\rm th} | y)$。恒星质量对数 $s$ 服从正态分布 $N(\\mu(y), \\sigma^2)$，其中 $\\mu(y) = A + \\beta(y - y_1)$。\n$$\nP(s \\ge s_{\\rm th} | y) = \\int_{s_{\\rm th}}^{\\infty} \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(s'-\\mu(y))^2}{2\\sigma^2}\\right) ds'\n$$\n令 $z = (s' - \\mu(y))/\\sigma$。积分下限变为 $(s_{\\rm th} - \\mu(y))/\\sigma$。该积分为 $\\frac{1}{2}\\mathrm{erfc}\\left(\\frac{s_{\\rm th}-\\mu(y)}{\\sqrt{2}\\sigma}\\right)$。使用定义 $s_{\\rm th} = \\mu(y_{\\star}) = A + \\beta(y_{\\star}-y_1)$，我们有 $s_{\\rm th} - \\mu(y) = \\beta(y_{\\star}-y)$。所以，占有概率为：\n$$\n\\langle N_{\\rm cen}(M) \\rangle_{\\rm true} = P(s \\ge s_{\\rm th} | y) = \\frac{1}{2}\\mathrm{erfc}\\left(\\frac{\\beta(y_{\\star}-y)}{\\sqrt{2}\\sigma}\\right) = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\beta(y-y_{\\star})}{\\sqrt{2}\\sigma}\\right)\\right]\n$$\n真实的数密度是所有晕质量的积分：\n$$\nn_{\\rm g}(s_{\\rm th}) = \\int_{-\\infty}^{\\infty} n(y) P(s \\ge s_{\\rm th} | y) dy = \\int_{-\\infty}^{\\infty} \\int_{s_{\\rm th}}^{\\infty} n(y) P(s|y) ds dy\n$$\n我们交换积分次序：\n$$\nn_{\\rm g}(s_{\\rm th}) = \\int_{s_{\\rm th}}^{\\infty} \\left( \\int_{-\\infty}^{\\infty} n(y) P(s|y) dy \\right) ds\n$$\n内部积分是关于 $y$ 的：\n$$\nI(s) = \\int_{-\\infty}^{\\infty} K e^{-\\alpha y} \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(s - (A+\\beta(y-y_1)))^2}{2\\sigma^2}\\right) dy\n$$\n指数的参数是 $y$ 的二次多项式。我们来配方法。\n该项为 $-\\alpha y - \\frac{\\beta^2}{2\\sigma^2}\\left(y - \\frac{s-A+\\beta y_1}{\\beta}\\right)^2$。这是一个指数函数与高斯函数的卷积。该积分是一个标准形式：\n$\\int_{-\\infty}^{\\infty} \\exp(-ax) \\exp(-\\frac{(x-b)^2}{2c^2}) dx = \\sqrt{2\\pi c^2} \\exp(-ab + a^2c^2/2)$。\n此处，$a=\\alpha$, $b = (s-A+\\beta y_1)/\\beta$ 且 $c^2 = \\sigma^2/\\beta^2$。\n所以，$I(s) = \\frac{K}{\\sqrt{2\\pi}\\sigma} \\sqrt{2\\pi \\frac{\\sigma^2}{\\beta^2}} \\exp\\left(-\\alpha \\frac{s-A+\\beta y_1}{\\beta} + \\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right)$。\n$$\nI(s) = \\frac{K}{\\beta} \\exp\\left(-\\frac{\\alpha}{\\beta}s + \\frac{\\alpha}{\\beta}(A-\\beta y_1) + \\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n现在我们将 $I(s)$ 从 $s_{\\rm th}$ 积分到 $\\infty$：\n$$\nn_{\\rm g}(s_{\\rm th}) = \\int_{s_{\\rm th}}^{\\infty} I(s) ds = \\frac{K}{\\beta} \\exp\\left(\\frac{\\alpha}{\\beta}(A-\\beta y_1) + \\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right) \\int_{s_{\\rm th}}^{\\infty} e^{-(\\alpha/\\beta)s} ds\n$$\n关于 $s$ 的积分计算结果为 $\\left[-\\frac{\\beta}{\\alpha} e^{-(\\alpha/\\beta)s}\\right]_{s_{\\rm th}}^{\\infty} = \\frac{\\beta}{\\alpha} e^{-(\\alpha/\\beta)s_{\\rm th}}$。\n$$\nn_{\\rm g}(s_{\\rm th}) = \\frac{K}{\\alpha} \\exp\\left(\\frac{\\alpha}{\\beta}(A-\\beta y_1) - \\frac{\\alpha}{\\beta}s_{\\rm th} + \\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n使用 $s_{\\rm th} = A + \\beta(y_{\\star}-y_1)$，我们有 $A - \\beta y_1 - s_{\\rm th} = -\\beta y_{\\star}$。指数项变为：\n$$\n\\exp\\left(\\frac{\\alpha}{\\beta}(-\\beta y_{\\star}) + \\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right) = \\exp\\left(-\\alpha y_{\\star} + \\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n因此，$n_{\\rm g}(s_{\\rm th}) = \\frac{K}{\\alpha} e^{-\\alpha y_{\\star}} \\exp\\left(\\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right)$。将其与 $n_{\\rm g}^{(0)} = \\frac{K}{\\alpha} e^{-\\alpha y_{\\star}}$ 比较，增强因子 $R$ 为：\n$$\nR \\equiv \\frac{n_{\\rm g}(s_{\\rm th})}{n_{\\rm g}^{(0)}} = \\exp\\left(\\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right) = \\exp\\left(\\frac{((p-1)\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n\n### (b) $M_{\\rm min}$ 中的偏差\n\n一个忽略弥散的分析师会通过将零弥散丰度公式与真实丰度 $n_{\\rm g}(s_{\\rm th})$ 相匹配来推断一个朴素的质量阈值 $M_{\\rm min}^{\\rm naive}$：\n$$\n\\int_{M_{\\rm min}^{\\rm naive}}^{\\infty} n(M) dM = n_{\\rm g}(s_{\\rm th})\n$$\n左边是 $\\frac{K}{\\alpha}e^{-\\alpha y_{\\rm min}^{\\rm naive}}$，其中 $y_{\\rm min}^{\\rm naive} = \\log_{10} M_{\\rm min}^{\\rm naive}$。\n$$\n\\frac{K}{\\alpha}e^{-\\alpha y_{\\rm min}^{\\rm naive}} = n_{\\rm g}(s_{\\rm th}) = n_{\\rm g}^{(0)} R = \\left(\\frac{K}{\\alpha}e^{-\\alpha y_{\\star}}\\right) R\n$$\n所以，$e^{-\\alpha y_{\\rm min}^{\\rm naive}} = e^{-\\alpha y_{\\star}} R$，这意味着 $-\\alpha y_{\\rm min}^{\\rm naive} = -\\alpha y_{\\star} + \\ln R$。$y_{\\rm min}^{\\rm naive} = y_{\\star} - \\frac{\\ln R}{\\alpha}$。用质量表示，由于 $M=10^y=e^{y\\ln 10}$，$M_{\\rm min}^{\\rm naive} = M_{\\star} \\exp(-\\frac{\\ln R \\ln 10}{\\alpha})$。回想 $\\alpha=(p-1)\\ln 10$，这给出 $M_{\\rm min}^{\\rm naive} = M_{\\star} \\exp(-\\frac{\\ln R}{p-1}) = M_{\\star} R^{-1/(p-1)}$。\n\n为了找到偏差，我们需要 $M_{\\rm min}^{\\rm true}$。这可以通过将真实的占有函数 $\\langle N_{\\rm cen}(M) \\rangle_{\\rm true}$ 与参数化的HOD形式相匹配来找到：\n$$\n\\langle N_{\\rm cen}(M)\\rangle = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\log_{10} M - \\log_{10} M_{\\rm min}}{\\sigma_{\\log M}}\\right)\\right]\n$$\n将其与我们推导的真实占有概率相匹配：\n$$\n\\langle N_{\\rm cen}(M) \\rangle_{\\rm true} = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\beta(y-y_{\\star})}{\\sqrt{2}\\sigma}\\right)\\right]\n$$\n通过比较误差函数的参数，我们识别出真实的HOD参数：\n$$\n\\frac{y - y_{\\rm min}^{\\rm true}}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\beta(y-y_{\\star})}{\\sqrt{2}\\sigma}\n$$\n令 $y$ 的系数和常数项相等，得到：$y_{\\rm min}^{\\rm true} = y_{\\star}$，这意味着 $M_{\\rm min}^{\\rm true} = 10^{y_{\\star}} = M_{\\star}$。HOD的特征质量是平均恒星质量等于阈值时的质量 $M_{\\star}$。\n\n$M_{\\rm min}$ 的偏差因子是：\n$$\n\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}} = \\frac{M_{\\star} R^{-1/(p-1)}}{M_{\\star}} = R^{-1/(p-1)} = \\left[\\exp\\left(\\frac{((p-1)\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)\\right]^{-\\frac{1}{p-1}}\n$$\n$$\n\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}} = \\exp\\left(-\\frac{(p-1)(\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n\n### (c) $\\sigma_{\\log M}$ 中的偏差\n\n通过与(b)部分中相同的误差函数参数比较，我们推导出真实的HOD宽度参数 $\\sigma_{\\log M}^{\\rm true}$：\n$$\n\\frac{1}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\beta}{\\sqrt{2}\\sigma} \\implies \\sigma_{\\log M}^{\\rm true} = \\frac{\\sqrt{2}\\sigma}{\\beta}\n$$\n这是从 $s-y$ 关系中的物理弥散 $\\sigma$ 到HOD参数 $\\sigma_{\\log M}$ 的正确映射。\n\n问题陈述，一个朴素的分析师错误地设定 $\\sigma_{\\log M}^{\\rm naive} \\equiv \\sigma$。偏差因子是朴素值与真实值的比率：\n$$\n\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\sigma}{\\frac{\\sqrt{2}\\sigma}{\\beta}} = \\frac{\\beta}{\\sqrt{2}}\n$$\n这量化了将固定晕质量下的恒星质量弥散与晕质量中占有函数的宽度相混淆所造成的误差。\n\n我们被要求以一个二元行矩阵的形式提供这两个偏差因子。\n第一项： $\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}} = \\exp\\left(-\\frac{(p-1)(\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)$。\n第二项： $\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\beta}{\\sqrt{2}}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\exp\\left(-\\frac{(p-1)(\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right) & \\frac{\\beta}{\\sqrt{2}} \\end{pmatrix}}$$"
        },
        {
            "introduction": "虽然平均占据数描述了暗晕中星系的平均数量，但完整的占据数分布决定了更高阶的聚类统计量。本实践聚焦于卫星星系分布的二阶矩及其对星系关联函数单暗晕项的直接影响 。通过比较标准的泊松模型和一个更灵活的负二项分布模型，你将定量计算“超泊松”方差如何增强小尺度上的聚类信号，这是在真实星系样本中观测到的一个关键效应。",
            "id": "3475225",
            "problem": "在数值宇宙学中，考虑晕占有分布（Halo Occupation Distribution, HOD）框架，其中，对星系对密度的一晕项贡献的卫星-卫星部分由固定晕质量下的卫星占有数的二阶阶乘矩和晕质量函数确定。从第一性原理出发，使用以下基本事实和定义来构建并评估所需的积分：\n\n1. 卫星-卫星单晕对密度振幅由以下积分定义\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}} \\equiv \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle,$$\n其中 $n(M)$ 是微分晕质量函数，$\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ 是以晕质量 $M$ 为条件的卫星占有数的二阶阶乘矩。\n\n2. 根据非负整值随机变量 $N$ 的均值和方差的定义，有\n$$\\left\\langle N(N-1) \\right\\rangle = \\left\\langle N^2 \\right\\rangle - \\left\\langle N \\right\\rangle = \\mathrm{Var}(N) + \\left\\langle N \\right\\rangle^2 - \\left\\langle N \\right\\rangle.$$\n使用此恒等式以及经过充分检验的泊松分布和负二项（NB）分布的方差性质来推导两种情况下的 $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$：\n- 对于泊松分布，方差等于均值。\n- 对于由正常数离散参数 $k$ 参数化的负二项分布，方差等于均值加上均值的平方除以 $k$。\n\n3. 采用以下物理上合理、平滑的参数化形式：\n- 晕质量函数\n$$n(M) = n_0 \\left(\\frac{M}{M_0}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_{\\mathrm{cut}}}\\right),$$\n其中 $M$ 的单位为 $\\mathrm{M}_\\odot/h$，$n(M)$ 的单位为 $h^3 \\mathrm{Mpc}^{-3} \\, (\\mathrm{M}_\\odot/h)^{-1}$。\n- 拥有中心星系的概率\n$$P_{\\mathrm{cen}}(M) = \\frac{1}{2} \\left[1 + \\mathrm{erf}\\left(\\frac{\\ln M - \\ln M_{\\min}^{\\mathrm{cen}}}{\\sigma_{\\ln M}}\\right)\\right],$$\n其中 $P_{\\mathrm{cen}}(M) \\in [0,1]$。\n- 以 $M$ 为条件的平均卫星占有数\n$$\\mu_{\\mathrm{sat}}(M) \\equiv \\left\\langle N_{\\mathrm{sat}} \\mid M \\right\\rangle = P_{\\mathrm{cen}}(M) \\left(\\frac{\\max\\{M - M_0^{\\mathrm{sat}}, \\, 0\\}}{M_1}\\right)^{\\alpha},$$\n其中幂律仅在 $M > M_0^{\\mathrm{sat}}$ 时适用，否则被抑制。\n\n4. 将超泊松卫星方差对单晕卫星-卫星项的无量纲影响定义为负二项分布情况与泊松分布情况下的振幅之比：\n$$\\mathcal{R} \\equiv \\frac{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})},$$\n该比值为无量纲。\n\n您的任务是编写一个完整的程序，该程序：\n- 对于每个测试用例，使用提供的参数构建 $n(M)$ 和 $\\mu_{\\mathrm{sat}}(M)$。\n- 使用第2项中的方差恒等式，计算泊松分布情况和负二项分布情况下的 $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$。\n- 在指定的质量范围 $\\left[M_{\\min}, M_{\\max}\\right]$ 上，数值计算 $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$ 和 $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})$ 的积分。\n- 为每个测试用例返回无量纲比率 $\\mathcal{R}$。\n\n对于特殊函数中任何隐式的角度参数，请使用弧度（误差函数没有角度参数，所以此处不存在角度）。由于最终报告的量是一个比率，因此输出中无需表示物理单位。确保数值积分在多个质量数量级上是稳健的。\n\n测试套件（每个用例指定 $\\{\\, n_0, M_0, \\beta, M_{\\mathrm{cut}}, M_{\\min}^{\\mathrm{cen}}, \\sigma_{\\ln M}, M_0^{\\mathrm{sat}}, M_1, \\alpha, k, M_{\\min}, M_{\\max}\\}$）：\n- 用例1（一般情况，中等超泊松）：$\\{\\, n_0 = 2.0\\times 10^{-18}, \\, M_0 = 1.0\\times 10^{13}, \\, \\beta = 1.8, \\, M_{\\mathrm{cut}} = 6.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 6.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.5, \\, M_0^{\\mathrm{sat}} = 1.0\\times 10^{12}, \\, M_1 = 1.2\\times 10^{13}, \\, \\alpha = 1.1, \\, k = 5.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 1.0\\times 10^{15} \\, \\}$。\n- 用例2（近泊松极限）：$\\{\\, n_0 = 2.0\\times 10^{-18}, \\, M_0 = 1.0\\times 10^{13}, \\, \\beta = 1.8, \\, M_{\\mathrm{cut}} = 6.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 6.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.5, \\, M_0^{\\mathrm{sat}} = 1.0\\times 10^{12}, \\, M_1 = 1.2\\times 10^{13}, \\, \\alpha = 1.1, \\, k = 1.0\\times 10^{9}, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 1.0\\times 10^{15} \\, \\}$。\n- 用例3（稀有卫星，更陡的质量函数）：$\\{\\, n_0 = 2.5\\times 10^{-18}, \\, M_0 = 8.0\\times 10^{12}, \\, \\beta = 2.2, \\, M_{\\mathrm{cut}} = 3.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 1.0\\times 10^{12}, \\, \\sigma_{\\ln M} = 0.7, \\, M_0^{\\mathrm{sat}} = 2.0\\times 10^{12}, \\, M_1 = 5.0\\times 10^{13}, \\, \\alpha = 0.8, \\, k = 2.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 8.0\\times 10^{14} \\, \\}$。\n- 用例4（大质量主导，强超泊松）：$\\{\\, n_0 = 1.5\\times 10^{-18}, \\, M_0 = 2.0\\times 10^{13}, \\, \\beta = 1.5, \\, M_{\\mathrm{cut}} = 1.0\\times 10^{15}, \\, M_{\\min}^{\\mathrm{cen}} = 8.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.4, \\, M_0^{\\mathrm{sat}} = 1.5\\times 10^{12}, \\, M_1 = 8.0\\times 10^{12}, \\, \\alpha = 1.3, \\, k = 1.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 2.0\\times 10^{15} \\, \\}$。\n\n算法要求：\n- 通过稳定的变量替换（例如 $x \\equiv \\ln M$，从而 $\\mathrm{d}M = M \\, \\mathrm{d}x$）来执行质量积分，并在 $x \\in [\\ln M_{\\min}, \\ln M_{\\max}]$ 上进行积分。\n- 使用第2项中的恒等式计算每个分布的 $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$，给定 $\\mu_{\\mathrm{sat}}(M)$。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含四个用例的无量纲比率 $\\mathcal{R}$，格式为用方括号括起来的逗号分隔列表，例如 $\\left[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4\\right]$，其中每个 $\\text{r}_i$ 都是一个浮点数。",
            "solution": "所提出的问题是计算天体物理学领域中一个有效且适定的练习，特别是在晕占有分布（HOD）建模的框架内。它要求计算一个无量纲比率 $\\mathcal{R}$，该比率量化了超泊松卫星星系统计对单晕卫星-卫星星系对密度的影响。这涉及到从第一性原理推导相关被积函数，然后执行数值积分。\n\n基本量是卫星-卫星单晕对密度振幅，由以下积分给出：\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}} = \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$$\n这里，$n(M)$ 是晕质量函数，而 $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ 是质量为 $M$ 的晕的卫星占有数 $N_{\\mathrm{sat}}$ 的二阶阶乘矩。我们的第一步是确定控制 $N_{\\mathrm{sat}}$ 的两种指定概率分布下该矩的形式。\n\n给定非负整值随机变量 $N$ 的一般统计恒等式：\n$$\\left\\langle N(N-1) \\right\\rangle = \\mathrm{Var}(N) + \\left\\langle N \\right\\rangle^2 - \\left\\langle N \\right\\rangle$$\n令 $\\mu_{\\mathrm{sat}}(M) \\equiv \\left\\langle N_{\\mathrm{sat}} \\mid M \\right\\rangle$ 为给定晕质量 $M$ 下的平均卫星占有数。\n\n情况1：泊松分布\n对于泊松过程，方差等于均值：$\\mathrm{Var}(N_{\\mathrm{sat}} \\mid M) = \\mu_{\\mathrm{sat}}(M)$。将此代入恒等式可得：\n$$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{Poisson}} = \\mu_{\\mathrm{sat}}(M) + \\mu_{\\mathrm{sat}}(M)^2 - \\mu_{\\mathrm{sat}}(M) = \\mu_{\\mathrm{sat}}(M)^2$$\n因此，对于卫星的泊松分布，二阶阶乘矩就是平均占有数的平方。\n\n情况2：负二项（NB）分布\n对于负二项分布，方差由 $\\mathrm{Var}(N_{\\mathrm{sat}} \\mid M) = \\mu_{\\mathrm{sat}}(M) + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k}$ 给出，其中 $k$ 是一个常数离散参数。将此代入恒等式可得：\n$$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{NB}} = \\left( \\mu_{\\mathrm{sat}}(M) + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k} \\right) + \\mu_{\\mathrm{sat}}(M)^2 - \\mu_{\\mathrm{sat}}(M)$$\n$$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{NB}} = \\mu_{\\mathrm{sat}}(M)^2 + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k} = \\mu_{\\mathrm{sat}}(M)^2 \\left(1 + \\frac{1}{k}\\right)$$\n这表明，负二项情况下的二阶阶乘矩比泊松情况下大一个因子 $(1 + 1/k)$。\n\n现在，我们可以写出振幅的表达式：\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson}) = \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\mu_{\\mathrm{sat}}(M)^2$$\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB}) = \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\mu_{\\mathrm{sat}}(M)^2 \\left(1 + \\frac{1}{k}\\right)$$\n由于参数 $k$ 在每个测试用例中都作为常数提供（即，它不依赖于积分变量 $M$），因此因子 $(1 + 1/k)$ 可以移到积分之外：\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB}) = \\left(1 + \\frac{1}{k}\\right) \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\mu_{\\mathrm{sat}}(M)^2 = \\left(1 + \\frac{1}{k}\\right) A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$$\n因此，无量纲比率 $\\mathcal{R}$ 为：\n$$\\mathcal{R} \\equiv \\frac{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})} = \\frac{\\left(1 + \\frac{1}{k}\\right) A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})} = 1 + \\frac{1}{k}$$\n这个解析简化揭示了最终的比率仅取决于离散参数 $k$。然而，问题明确指示要构建模型并数值计算积分。此过程可作为对解析结果的稳健验证，并确保HOD模型的各个方面都得到正确实现。\n\n数值实现策略如下：\n1.  为指定的参数化形式定义Python函数：\n    -   晕质量函数：$n(M) = n_0 \\left(\\frac{M}{M_0}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_{\\mathrm{cut}}}\\right)$\n    -   中心星系概率：$P_{\\mathrm{cen}}(M) = \\frac{1}{2} \\left[1 + \\mathrm{erf}\\left(\\frac{\\ln M - \\ln M_{\\min}^{\\mathrm{cen}}}{\\sigma_{\\ln M}}\\right)\\right]$\n    -   平均卫星占有数：$\\mu_{\\mathrm{sat}}(M) = P_{\\mathrm{cen}}(M) \\left(\\frac{\\max\\{M - M_0^{\\mathrm{sat}}, 0\\}}{M_1}\\right)^{\\alpha}$\n\n2.  为了处理晕质量 $M$ 的大动态范围，我们执行到对数空间的变量替换：$x = \\ln M$，这意味着 $M = e^x$ 且 $\\mathrm{d}M = M \\, \\mathrm{d}x = e^x \\, \\mathrm{d}x$。积分极限变为 $[\\ln M_{\\min}, \\ln M_{\\max}]$。\n\n3.  以 $x$ 表示的被积函数为：\n    -   对于泊松情况：$I_{\\mathrm{Poisson}}(x) = e^x \\, n(e^x) \\, \\mu_{\\mathrm{sat}}(e^x)^2$\n    -   对于负二项情况：$I_{\\mathrm{NB}}(x) = e^x \\, n(e^x) \\, \\mu_{\\mathrm{sat}}(e^x)^2 \\left(1 + \\frac{1}{k}\\right)$\n\n4.  对于每个测试用例，使用 `scipy.integrate` 库中的 `quad` 函数（一个稳健的数值求积例程）在范围 $[\\ln M_{\\min}, \\ln M_{\\max}]$ 上计算 $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$ 和 $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})$ 的定积分。\n\n5.  最终比率 $\\mathcal{R}$ 根据数值积分的结果计算得出。对所有四个提供的测试用例重复此过程。生成的代码忠实地实现了这些步骤。",
            "answer": "[1.2, 1.000000001, 1.5, 2.0]"
        },
        {
            "introduction": "将像HOD这样的理论模型与真实世界的观测联系起来，需要精心的实验设计。这个高级练习将让你扮演巡天规划者的角色，任务是优化观测策略，以获得对HOD参数最强的约束 。通过使用费雪信息矩阵分析，你将确定如何在不同星系样本间分配光谱资源，从而最大化对卫星星系HOD的约束能力，并在此过程中权衡总观测时间、可用目标数量和观测效率之间的利弊。",
            "id": "3475222",
            "problem": "您的任务是构建并解决一个晕占有数分布模型中的资源分配问题。考虑一个光谱巡天，该巡天将观测时间分配到离散的视星等区间中以收集红移。科学目标是仅利用从光谱中提取的星系数量计数，最大化关于两个晕占有数分布参数的预期信息：特征卫星质量标度 $M_1$ 和卫星占有斜率 $\\alpha$。假设以下建模设置基于标准定义。\n\n基本建模假设：\n- 晕质量函数：共动晕质量函数由类 Schechter 形式 $n(M) = n_0 \\left(\\frac{M}{M_\\star}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_\\star}\\right)$ 在 $M \\in [M_{\\min}, M_{\\max}]$ 上建模。\n- 仅依赖于卫星：预期卫星占有数为 $\\langle N_{\\mathrm{sat}} \\mid M \\rangle = \\left(\\frac{M}{M_1}\\right)^{\\alpha}$（当 $M \\ge M_{\\min}$ 时），否则为 $0$。\n- 星等区间选择：每个星等区间 $i \\in \\{1,\\dots,B\\}$ 由一个选择权重 $S_i(M)$ 表示，该权重是一个以 $M_i$ 为中心、离散度为 $\\sigma_i$ (单位为 dex) 的对数正态分布（在 $\\log_{10} M$ 中为高斯分布），即 $S_i(M) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_i} \\exp\\left[-\\frac{\\left(\\log_{10} M - \\log_{10} M_i\\right)^2}{2\\sigma_i^2}\\right]$。\n- 每个区间的预期计数：每次成功的光谱观测对区间 $i$ 的预期星系贡献数建模为\n$$\n\\mu_i(M_1,\\alpha) = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\,\\left(\\frac{M}{M_1}\\right)^{\\alpha}\\,S_i(M)\\,dM.\n$$\n- 似然与信息：设 $N_i$ 为在区间 $i$ 中从 $s_i$ 次成功光谱观测中得到的观测计数。假设 $N_i$ 服从均值为 $\\Lambda_i(M_1,\\alpha;s_i) = s_i\\,\\mu_i(M_1,\\alpha)$ 的 Poisson 分布，且不同区间被视为独立的。来自 Poisson 计数的参数 $\\boldsymbol{\\theta} = (M_1,\\alpha)$ 的 Fisher 信息矩阵 (FIM) 是通过对数似然函数的二阶导数的标准期望来定义的。为进行正则化并确保正定性，引入一个具有小的正对角项的独立高斯先验 Fisher 矩阵 $\\mathbf{P} = \\mathrm{diag}(\\pi_{M_1}, \\pi_{\\alpha})$。\n\n决策变量与约束条件：\n- 决策变量是每个区间的的光谱分配 $\\mathbf{s} = (s_1,\\dots,s_B)$，其中 $s_i$ 表示在区间 $i$ 中获得的成功光谱数量。\n- 观测资源约束为：\n  1. 总光纤数：$\\sum_{i=1}^{B} s_i \\le F_{\\mathrm{tot}}$。\n  2. 总时间：$\\sum_{i=1}^{B} \\frac{s_i}{a_i} \\le T_{\\mathrm{tot}}$，其中 $a_i > 0$ 是每个区间的的光谱效率（单位时间内的成功光谱数）。\n  3. 区间上限：$0 \\le s_i \\le S^{\\max}_i$，其中 $S^{\\max}_i$ 是在区间 $i$ 中可观测的可用目标的最大数量。\n\n优化目标：\n- 使用 D-最优设计准则来选择 $\\mathbf{s}$，以在上述约束条件下最大化关于 $\\boldsymbol{\\theta} = (M_1,\\alpha)$ 的 Fisher 信息矩阵的行列式。所有其他建模选择均源于所述假设，您必须从第一性原理出发，得到一个依赖于 $\\mathbf{s}$ 的易于处理的目标函数。\n\n科学常数与参数值：\n- 区间数：$B = 3$。\n- 质量积分极限：$M_{\\min} = 10^{11}\\,h^{-1}M_{\\odot}$，$M_{\\max} = 10^{15}\\,h^{-1}M_{\\odot}$。\n- 晕质量函数参数：$n_0 = 1$，$M_{\\star} = 10^{13}\\,h^{-1}M_{\\odot}$，$\\beta = 1.9$。\n- 卫星占有参数（将在基准值附近推断）：$M_1 = 3\\times 10^{13}\\,h^{-1}M_{\\odot}$，$\\alpha = 1.1$。\n- 每个区间的选择函数：\n  - 区间 1：$M_1^{\\mathrm{sel}} = 10^{12}\\,h^{-1}M_{\\odot}$，$\\sigma_1 = 0.3$。\n  - 区间 2：$M_2^{\\mathrm{sel}} = 10^{12.5}\\,h^{-1}M_{\\odot}$，$\\sigma_2 = 0.3$。\n  - 区间 3：$M_3^{\\mathrm{sel}} = 10^{13}\\,h^{-1}M_{\\odot}$，$\\sigma_3 = 0.3$。\n- 先验 Fisher 矩阵对角项：$\\pi_{M_1} = 10^{-12}$，$\\pi_{\\alpha} = 10^{-6}$。\n\n测试套件：\n每个测试用例指定 $(F_{\\mathrm{tot}}, T_{\\mathrm{tot}}, \\mathbf{a}, \\mathbf{S}^{\\max})$。对所有测试使用上述科学常数。\n- 测试 1（资源均衡）：$F_{\\mathrm{tot}} = 3000$，$T_{\\mathrm{tot}} = 7000$，$\\mathbf{a} = [0.6,\\,0.4,\\,0.25]$，$\\mathbf{S}^{\\max} = [4000,\\,2500,\\,1500]$。\n- 测试 2（光纤受限）：$F_{\\mathrm{tot}} = 800$，$T_{\\mathrm{tot}} = 20000$，$\\mathbf{a} = [0.6,\\,0.4,\\,0.25]$，$\\mathbf{S}^{\\max} = [4000,\\,2500,\\,1500]$。\n- 测试 3（时间受限）：$F_{\\mathrm{tot}} = 10000$，$T_{\\mathrm{tot}} = 1000$，$\\mathbf{a} = [0.6,\\,0.4,\\,0.25]$，$\\mathbf{S}^{\\max} = [4000,\\,2500,\\,1500]$。\n\n要求的输出：\n- 对于每个测试用例，计算在约束条件下最大化 D-最优准则的最优光谱分配 $\\mathbf{s}^{\\star} = (s_1^{\\star}, s_2^{\\star}, s_3^{\\star})$。\n- 您必须输出单行内容，其中包含三个分配向量的列表，每个值四舍五入到六位小数，格式必须完全符合：$[[s^{\\star}_{1,1},s^{\\star}_{1,2},s^{\\star}_{1,3}],[s^{\\star}_{2,1},s^{\\star}_{2,2},s^{\\star}_{2,3}],[s^{\\star}_{3,1},s^{\\star}_{3,2},s^{\\star}_{3,3}]]$。\n- 输出中不出现物理单位，因为分配是计数值。不出现角度。所有数值答案均为纯小数。\n\n您的程序必须是一个完整、可运行的实现，执行以下步骤：\n- 根据所述积分构建 $\\mu_i(M_1,\\alpha)$，从第一性原理计算关于 $M_1$ 和 $\\alpha$ 的所需导数，并组合带有指定先验的 Poisson 计数的 Fisher 信息矩阵。\n- 构建 D-最优目标函数，并实现一个求解器，该求解器对 $\\mathbf{s}$ 强制执行线性不等式约束和箱式约束。\n- 对每个测试用例求解优化问题，并打印所要求的输出。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[[ \\cdot, \\cdot, \\cdot ],[ \\cdot, \\cdot, \\cdot ],[ \\cdot, \\cdot, \\cdot ]]$）。",
            "solution": "用户提供了一个明确的优化问题，该问题基于晕占有数分布 (HOD) 建模和统计巡天设计的原理。此问题在科学上是合理的，内容是自洽的，并且在算法上是可解的。因此，我将着手提供一个完整的解决方案。\n\n该问题要求我们找到光谱观测资源的最优分配，该分配由每个星等区间的成功光谱数向量 $\\mathbf{s} = (s_1, \\dots, s_B)$ 表示，以最大化关于一组 HOD 参数 $\\boldsymbol{\\theta} = (M_1, \\alpha)$ 的科学信息。该优化受限于关于总光谱数、总观测时间以及每个区间的目标数量的若干线性约束。\n\n我们的方法如下：\n1.  根据给定的实验设置，构建 HOD 参数 $\\boldsymbol{\\theta}$ 的 Fisher 信息矩阵 (FIM)。\n2.  建立 D-最优设计目标函数，即 FIM 的行列式 $\\det(\\mathbf{F}(\\mathbf{s}))$。\n3.  证明这会导出一个凸优化问题，该问题保证存在唯一的全局最大值，并允许使用标准的数值求解器。\n4.  数值计算目标函数所需的常数项，这涉及到根据所提供的物理模型评估定积分。\n5.  使用 `scipy.optimize.minimize` 实现一个求解器，为每个指定的测试用例找到最优分配向量 $\\mathbf{s}^\\star$。\n\n### 第 1 步：推导 Fisher 信息矩阵\n\n在区间 $i$ 中观测到的星系数量 $N_i$ 假设服从均值为 $\\Lambda_i = s_i \\mu_i(\\boldsymbol{\\theta})$ 的 Poisson 分布。对于独立的区间，总对数似然为 $\\mathcal{L}(\\boldsymbol{\\theta}) = \\sum_{i=1}^{B} \\left( N_i \\log(\\Lambda_i) - \\Lambda_i - \\log(N_i!) \\right)$。\n\n参数 $\\boldsymbol{\\theta} = (\\theta_j, \\theta_k)$ 的 Fisher 信息矩阵 (FIM) 由其分量 $F_{jk} = -E\\left[\\frac{\\partial^2 \\mathcal{L}}{\\partial \\theta_j \\partial \\theta_k}\\right]$ 定义。由于各个区间是独立的，总 FIM 是每个区间的 FIM 之和，即 $\\mathbf{F} = \\sum_{i=1}^B \\mathbf{F}^{(i)}$。\n\n对于单个区间 $i$，对数似然的导数为：\n$$\n\\frac{\\partial \\ell_i}{\\partial \\theta_j} = \\left(\\frac{N_i}{\\Lambda_i} - 1\\right) \\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\n$$\n$$\n\\frac{\\partial^2 \\ell_i}{\\partial \\theta_j \\partial \\theta_k} = -\\frac{N_i}{\\Lambda_i^2}\\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k} + \\left(\\frac{N_i}{\\Lambda_i} - 1\\right)\\frac{\\partial^2 \\Lambda_i}{\\partial \\theta_j \\partial \\theta_k}\n$$\n取期望 $E[\\cdot]$，并使用 $E[N_i] = \\Lambda_i$，第二项消失。\n$$\nF_{jk}^{(i)} = -E\\left[-\\frac{N_i}{\\Lambda_i^2}\\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k}\\right] = \\frac{E[N_i]}{\\Lambda_i^2}\\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k} = \\frac{1}{\\Lambda_i} \\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k}\n$$\n代入 $\\Lambda_i = s_i \\mu_i(\\boldsymbol{\\theta})$ 及其导数 $\\frac{\\partial \\Lambda_i}{\\partial \\theta_j} = s_i \\frac{\\partial \\mu_i}{\\partial \\theta_j}$，我们得到：\n$$\nF_{jk}^{(i)}(\\mathbf{s}, \\boldsymbol{\\theta}) = s_i \\left( \\frac{1}{\\mu_i} \\frac{\\partial \\mu_i}{\\partial \\theta_j} \\frac{\\partial \\mu_i}{\\partial \\theta_k} \\right)\n$$\n此表达式表明，每个区间的 FIM 在分配变量 $s_i$ 上是线性的。括号中的项是模型参数 $\\boldsymbol{\\theta}$ 的函数，但独立于分配 $\\mathbf{s}$。我们在基准参数值 $\\boldsymbol{\\theta}_{\\text{fid}} = (M_1, \\alpha)$ 处评估此项。让我们为每个区间 $i$ 定义常数矩阵 $\\mathbf{K}_i$：\n$$\n(\\mathbf{K}_i)_{jk} = \\left. \\frac{1}{\\mu_i} \\frac{\\partial \\mu_i}{\\partial \\theta_j} \\frac{\\partial \\mu_i}{\\partial \\theta_k} \\right|_{\\boldsymbol{\\theta}_{\\text{fid}}}\n$$\n来自数据的总 FIM 则为 $\\mathbf{F}_{\\text{data}}(\\mathbf{s}) = \\sum_{i=1}^{B} s_i \\mathbf{K}_i$。\n\n问题指出必须包含一个高斯先验。总 FIM 是数据 FIM 和先验 FIM $\\mathbf{P} = \\mathrm{diag}(\\pi_{M_1}, \\pi_{\\alpha})$ 的和：\n$$\n\\mathbf{F}(\\mathbf{s}) = \\mathbf{P} + \\sum_{i=1}^{B} s_i \\mathbf{K}_i\n$$\n总 FIM 是分配向量 $\\mathbf{s}$ 的一个仿射函数。\n\n### 第 2 步：D-最优设计目标\n\nD-最优性准则旨在最大化 Fisher 信息矩阵的行列式 $\\det(\\mathbf{F}(\\mathbf{s}))$。这对应于最小化参数 $\\boldsymbol{\\theta}$ 的置信椭球的体积。优化问题是：\n$$\n\\begin{aligned}\n \\underset{\\mathbf{s}}{\\text{maximize}}   \\det\\left(\\mathbf{P} + \\sum_{i=1}^{B} s_i \\mathbf{K}_i\\right) \\\\\n \\text{subject to}   \\sum_{i=1}^{B} s_i \\le F_{\\mathrm{tot}} \\\\\n   \\sum_{i=1}^{B} \\frac{s_i}{a_i} \\le T_{\\mathrm{tot}} \\\\\n   0 \\le s_i \\le S^{\\max}_i \\quad \\text{for } i=1,\\dots,B\n\\end{aligned}\n$$\n由于对数函数是严格单调递增的，最大化 $\\det(\\mathbf{F}(\\mathbf{s}))$ 等价于最大化其对数 $\\log(\\det(\\mathbf{F}(\\mathbf{s})))$。\n\n### 第 3 步：构建为凸优化问题\n\n目标函数可以写为 $g(\\mathbf{s}) = \\log \\det(\\mathbf{P} + \\sum_i s_i \\mathbf{K}_i)$。已知对于任何正定矩阵 $\\mathbf{X}$，函数 $\\log \\det(\\mathbf{X})$ 是凹函数。行列式的参数 $\\mathbf{A}(\\mathbf{s}) = \\mathbf{P} + \\sum_i s_i \\mathbf{K}_i$ 是 $\\mathbf{s}$ 的仿射函数。凹函数与仿射映射的复合保持凹性。因此，$g(\\mathbf{s})$ 是 $\\mathbf{s}$ 的凹函数。\n\n约束条件都是线性不等式，它们定义了一个凸集（一个多胞体）。因此，该问题是在一个凸集上最大化一个凹函数。这是一个标准的凸优化问题。我们可以通过最小化它的负数 $-g(\\mathbf{s})$ 来解决它，这是一个凸函数。这保证了由合适的算法找到的任何局部最小值也将是全局最小值。我们将使用序贯最小二乘规划 (SLSQP) 算法，该算法在 `scipy.optimize.minimize` 中实现，非常适合此类问题。\n\n### 第 4 步：$\\mathbf{K}_i$ 的数值计算\n\n为了构建矩阵 $\\mathbf{K}_i$，我们需要在基准参数值下计算 $\\mu_i$ 及其关于 $M_1$ 和 $\\alpha$ 的偏导数。参数为 $\\boldsymbol{\\theta} = (\\theta_1, \\theta_2) = (M_1, \\alpha)$。\n\n每次成功的预期计数为：\n$$\n\\mu_i = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\,\\left(\\frac{M}{M_1}\\right)^{\\alpha}\\,S_i(M)\\,dM\n$$\n通过在积分号下微分求得偏导数：\n$$\n\\frac{\\partial \\mu_i}{\\partial M_1} = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\, M^\\alpha\\,(-\\alpha M_1^{-\\alpha-1})\\,S_i(M)\\,dM = -\\frac{\\alpha}{M_1} \\mu_i\n$$\n$$\n\\frac{\\partial \\mu_i}{\\partial \\alpha} = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\,\\left(\\frac{M}{M_1}\\right)^{\\alpha}\\,\\ln\\left(\\frac{M}{M_1}\\right)\\,S_i(M)\\,dM \\equiv I_i\n$$\n这些积分 $\\mu_i$ 和 $I_i$ 必须进行数值计算。我们进行变量替换，令 $u = \\log_{10} M$，这简化了积分范围和选择函数的形式。积分元变为 $dM = 10^u \\ln(10) du$。积分在 $u \\in [\\log_{10} M_{\\min}, \\log_{10} M_{\\max}] = [11, 15]$ 上进行。\n\n利用这些导数，区间 $i$ 的导数向量为 $\\mathbf{d}_i = \\begin{pmatrix} -\\alpha \\mu_i / M_1 \\\\ I_i \\end{pmatrix}$。矩阵 $\\mathbf{K}_i$ 是外积 $\\frac{1}{\\mu_i} \\mathbf{d}_i \\mathbf{d}_i^T$：\n$$\n\\mathbf{K}_i = \\frac{1}{\\mu_i} \\begin{pmatrix} (-\\alpha \\mu_i / M_1)^2 & (-\\alpha \\mu_i / M_1) I_i \\\\ (-\\alpha \\mu_i / M_1) I_i & I_i^2 \\end{pmatrix} = \\begin{pmatrix} \\alpha^2 \\mu_i / M_1^2 & -\\alpha I_i / M_1 \\\\ -\\alpha I_i / M_1 & I_i^2 / \\mu_i \\end{pmatrix}\n$$\n我们使用所提供的基准参数和物理常数，为每个区间 $i \\in \\{1, 2, 3\\}$ 计算这些常数 $2 \\times 2$ 矩阵。\n\n### 第 5 步：实现与求解\n\n最后一步是在 Python 中实现此逻辑。我们首先使用 `scipy.integrate.quad` 进行数值积分，预计算 $\\mathbf{K}_i$ 矩阵。然后，对于每个测试用例，我们使用 `scipy.optimize.LinearConstraint` 和 `scipy.optimize.Bounds` 来定义目标函数（负对数行列式）和约束。我们使用 `SLSQP` 方法调用 `scipy.optimize.minimize` 来找到最优光谱分配 $\\mathbf{s}^\\star = (s_1^\\star, s_2^\\star, s_3^\\star)$。然后按要求格式化并打印三个测试用例的结果。",
            "answer": "[[600.000000, 0.000000, 1500.000000], [341.348843, 0.000000, 458.651157], [600.000000, 0.000000, 0.000000]]"
        }
    ]
}