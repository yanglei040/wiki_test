{
    "hands_on_practices": [
        {
            "introduction": "为了从根本上理解星系形成偏倚，我们首先需要一个能够量化其次级属性（如年龄或恒星质量）如何影响其聚类行为的统计工具。标记相关函数（marked correlation function）就是为此目的而设计的，它通过一个“标记”（mark）来加权星系对，该标记代表我们感兴趣的次级属性。这个练习（）将引导您在一个简化的线性理论框架下，从第一性原理推导出标记相关函数，从而揭示星系属性与其所处环境密度之间的关联是如何直接改变我们观测到的聚类信号的。",
            "id": "3473125",
            "problem": "考虑一个统计均匀且各向同性的物质过密场 $\\delta(\\mathbf{x})$，它是一个均值为零、方差为 $\\sigma_{\\delta}^{2} \\equiv \\langle \\delta^{2} \\rangle$、两点相关函数为 $\\xi(r) \\equiv \\langle \\delta(\\mathbf{x}) \\delta(\\mathbf{x}+\\mathbf{r}) \\rangle$ 的高斯随机场。星系是物质场的有偏示踪物，具有线性确定性偏置，因此星系过密度为 $\\delta_{g}(\\mathbf{x}) = b \\, \\delta(\\mathbf{x})$，其中 $b$ 是一个常数线性偏置因子。假设每个星系携带一个标量标记 $m(\\mathbf{x})$，其均值为 $\\bar{m} \\equiv \\langle m \\rangle$，方差为 $\\sigma_{m}^{2} \\equiv \\langle [m - \\bar{m}]^{2} \\rangle$。假设一个线性随机标记模型，其中标记通过相关系数\n$$\n\\rho \\equiv \\frac{\\langle [m(\\mathbf{x}) - \\bar{m}] \\, \\delta(\\mathbf{x}) \\rangle}{\\sigma_{m} \\, \\sigma_{\\delta}} \\, ,\n$$\n与局域环境（由 $\\delta$ 衡量）相关，此外是不相关噪声。在与此相关性一致的最小线性投影下，写出\n$$\nm(\\mathbf{x}) = \\bar{m} + \\gamma \\, \\delta(\\mathbf{x}) + \\epsilon(\\mathbf{x}) \\, ,\n$$\n其中 $\\epsilon$ 独立于 $\\delta$，均值为零 $\\langle \\epsilon \\rangle = 0$，并选择使其满足 $\\mathrm{corr}(m,\\delta) = \\rho$，这确定了 $\\gamma = \\rho \\, \\sigma_{m}/\\sigma_{\\delta}$。假设 $\\epsilon$ 是空间不相关的，即对于 $r > 0$，有 $\\langle \\epsilon(\\mathbf{x}) \\epsilon(\\mathbf{x}+\\mathbf{r}) \\rangle = 0$。\n\n在连续场近似下，将标记相关函数定义为标记加权对比例，\n$$\nM(r) \\equiv \\frac{\\left\\langle m(\\mathbf{x}) \\, m(\\mathbf{x}+\\mathbf{r}) \\, \\bigl[1+\\delta_{g}(\\mathbf{x})\\bigr] \\, \\bigl[1+\\delta_{g}(\\mathbf{x}+\\mathbf{r})\\bigr] \\right\\rangle}{\\bar{m}^{2} \\, \\bigl[1 + \\xi_{gg}(r)\\bigr]} \\, ,\n$$\n其中 $\\xi_{gg}(r) \\equiv \\langle \\delta_{g}(\\mathbf{x}) \\delta_{g}(\\mathbf{x}+\\mathbf{r}) \\rangle = b^{2} \\, \\xi(r)$ 是星系两点相关函数。\n\n从上述定义出发，利用高斯统计和 Wick 定理截断连通高阶矩，推导 $M(r)$ 在物质两点相关函数 $\\xi(r)$ 的领头阶上的闭式表达式。你的最终表达式必须明确地用 $b$、$\\bar{m}$、$\\sigma_{\\delta}$、$\\sigma_{m}$、$\\rho$ 和 $\\xi(r)$ 表示。将答案表示为单个解析表达式；不需要进行数值计算。",
            "solution": "该问题要求推导标记相关函数 $M(r)$ 在物质两点相关函数 $\\xi(r)$ 的领头阶上的表达式。标记相关函数定义为\n$$\nM(r) \\equiv \\frac{\\left\\langle m(\\mathbf{x}) \\, m(\\mathbf{x}+\\mathbf{r}) \\, \\bigl[1+\\delta_{g}(\\mathbf{x})\\bigr] \\, \\bigl[1+\\delta_{g}(\\mathbf{x}+\\mathbf{r})\\bigr] \\right\\rangle}{\\bar{m}^{2} \\, \\bigl[1 + \\xi_{gg}(r)\\bigr]}\n$$\n让我们将此表达式的分子表示为 $N(r)$，分母表示为 $D(r)$。任务是通过代入给定的星系过密度 $\\delta_g(\\mathbf{x})$ 和标记 $m(\\mathbf{x})$ 的模型来计算 $N(r)$，然后计算期望值。\n\n给定的模型是：\n1.  星系过密度：$\\delta_{g}(\\mathbf{x}) = b \\, \\delta(\\mathbf{x})$\n2.  标量标记：$m(\\mathbf{x}) = \\bar{m} + \\gamma \\, \\delta(\\mathbf{x}) + \\epsilon(\\mathbf{x})$\n\n让我们用下标 $1$ 表示在位置 $\\mathbf{x}$ 处的场，用下标 $2$ 表示在位置 $\\mathbf{x}+\\mathbf{r}$ 处的场。因此，$\\delta_1 = \\delta(\\mathbf{x})$，$\\delta_2 = \\delta(\\mathbf{x}+\\mathbf{r})$，依此类推。\n\n分子为 $N(r) = \\langle m_1 m_2 (1+\\delta_{g1})(1+\\delta_{g2}) \\rangle$。\n代入模型，我们得到：\n$$\nN(r) = \\left\\langle (\\bar{m} + \\gamma\\delta_1 + \\epsilon_1)(\\bar{m} + \\gamma\\delta_2 + \\epsilon_2)(1 + b\\delta_1)(1 + b\\delta_2) \\right\\rangle\n$$\n期望是针对高斯随机场 $\\delta$ 和噪声场 $\\epsilon$ 的分布计算的。我们将使用的关键属性是：\n-   $\\langle\\delta\\rangle = 0$，$\\langle\\delta_1\\delta_2\\rangle = \\xi(r)$，以及 $\\langle\\delta_1^2\\rangle = \\langle\\delta_2^2\\rangle = \\sigma_\\delta^2$。\n-   $\\langle\\epsilon\\rangle = 0$。\n-   $\\delta$ 和 $\\epsilon$ 是独立的，因此对于任意整数 $k,l$，有 $\\langle \\delta^k \\epsilon^l \\rangle = \\langle \\delta^k \\rangle \\langle \\epsilon^l \\rangle$。这意味着任何包含单个 $\\epsilon$ 因子并乘以任意数量 $\\delta$ 场的项，其期望值都为零，例如 $\\langle \\delta_1 \\epsilon_1 \\rangle = \\langle\\delta_1\\rangle\\langle\\epsilon_1\\rangle = 0$。\n-   对于 $r > 0$，$\\langle\\epsilon_1\\epsilon_2\\rangle = 0$。我们计算 $M(r)$ 时考虑的是间距 $r>0$ 的情况。\n-   对于高斯场 $\\delta$，所有奇数阶相关函数都为零（例如 $\\langle\\delta_1\\delta_2\\delta_1\\rangle=0$）。偶数阶相关函数可以使用 Wick 定理展开。\n\n为了简化计算，让我们用标记场的分数过密度 $\\delta_m = (m-\\bar{m})/\\bar{m} = (\\gamma\\delta+\\epsilon)/\\bar{m}$ 来表示分子。\n$$\nN(r) = \\bar{m}^2 \\left\\langle (1 + \\delta_{m1})(1 + \\delta_{m2})(1 + \\delta_{g1})(1 + \\delta_{g2}) \\right\\rangle\n$$\n展开期望内的乘积，并只保留期望值非零的项（即包含偶数个场（或零个场）的项），我们得到：\n$$\n\\langle \\dots \\rangle = \\langle 1 + \\delta_{g1}\\delta_{g2} + \\delta_{m1}\\delta_{m2} + \\delta_{m1}\\delta_{g1} + \\delta_{m2}\\delta_{g2} + \\delta_{m1}\\delta_{g2} + \\delta_{m2}\\delta_{g1} + \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} + \\dots \\rangle\n$$\n我们计算必要的二点和四点相关项：\n-   $\\langle \\delta_{g1}\\delta_{g2} \\rangle = b^2\\xi(r)$。\n-   $\\langle \\delta_{m1}\\delta_{m2} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} \\frac{\\gamma\\delta_2+\\epsilon_2}{\\bar{m}} \\rangle = \\frac{\\gamma^2}{\\bar{m}^2}\\xi(r)$。\n-   $\\langle \\delta_{m1}\\delta_{g2} \\rangle = \\langle \\delta_{m2}\\delta_{g1} \\rangle = \\frac{b\\gamma}{\\bar{m}}\\xi(r)$。\n-   $\\langle \\delta_{m1}\\delta_{g1} \\rangle = \\langle \\delta_{m2}\\delta_{g2} \\rangle = \\frac{b\\gamma}{\\bar{m}}\\sigma_\\delta^2$。这是一个单点相关，是常数。\n-   $\\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle = \\frac{b^2\\gamma^2}{\\bar{m}^2} \\langle \\delta_1^2 \\delta_2^2 \\rangle \\approx \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2}$，这里我们使用了Wick定理 $\\langle \\delta_1^2 \\delta_2^2 \\rangle = \\sigma_\\delta^4 + 2\\xi(r)^2$ 并忽略了高阶项 $\\xi(r)^2$。\n\n将所有贡献项求和：\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx 1 + b^2\\xi(r) + \\frac{\\gamma^2}{\\bar{m}^2}\\xi(r) + 2\\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} + 2\\frac{b\\gamma}{\\bar{m}}\\xi(r) + \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2}\n$$\n合并常数项和与 $\\xi(r)$ 成正比的项：\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx \\left( 1 + \\frac{2b\\gamma\\sigma_\\delta^2}{\\bar{m}} + \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2} \\right) + \\left( b^2 + \\frac{2b\\gamma}{\\bar{m}} + \\frac{\\gamma^2}{\\bar{m}^2} \\right) \\xi(r)\n$$\n将括号中的项识别为完全平方：\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx \\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r)\n$$\n分母是 $D(r) = \\bar{m}^2(1+\\xi_{gg}(r)) = \\bar{m}^2(1+b^2\\xi(r))$。\n因此，标记相关函数是：\n$$\nM(r) = \\frac{N(r)}{D(r)} \\approx \\frac{\\bar{m}^2 \\left[ \\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r) \\right]}{\\bar{m}^2 (1+b^2\\xi(r))} = \\frac{\\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r)}{1+b^2\\xi(r)}\n$$\n最后，我们代入 $\\gamma = \\rho \\frac{\\sigma_m}{\\sigma_\\delta}$，得到最终的闭式表达式：\n$$\nM(r) = \\frac{\\left( 1 + \\frac{b\\rho\\sigma_m\\sigma_\\delta}{\\bar{m}} \\right)^2 + b^2\\left( 1 + \\frac{\\rho\\sigma_m}{b\\bar{m}\\sigma_\\delta} \\right)^2 \\xi(r)}{1+b^2\\xi(r)}\n$$",
            "answer": "$$\n\\boxed{\\frac{\\left( 1 + \\frac{b \\rho \\sigma_{m} \\sigma_{\\delta}}{\\bar{m}} \\right)^{2} + b^{2} \\left( 1 + \\frac{\\rho \\sigma_{m}}{b \\bar{m} \\sigma_{\\delta}} \\right)^{2} \\xi(r)}{1 + b^{2} \\xi(r)}}\n$$"
        },
        {
            "introduction": "理论上的统计描述是理解星系形成偏倚的第一步，但将其应用于真实的巡天观测则要面对更多复杂性。在实际的星系巡天中，我们观测到的聚类模式不仅源于宇宙学本身，还深受样本选择方式的影响。这个练习（）将挑战您像一位观测宇宙学家一样思考，分析常见的观测选择效应——例如颜色、恒星形成率或表面亮度切割——如何引入与环境相关的系统偏差，从而模仿、增强甚至掩盖真实的星系形成偏倚信号。",
            "id": "3473119",
            "problem": "考虑一个在低红移、平坦、物质主导的宇宙学背景中进行的假设性光谱巡天，其目标是一个质量有限的星系样本。假设在母体的、完全完备的星表中没有真实的星系形成偏置：在固定的暗晕质量 $M$ 下，星系的占据数和成团性仅依赖于 $M$ 而不依赖于次级暗晕属性，因此在足够大的尺度上，星系超密度场 $g(\\mathbf{x})$ 服从线性偏置 $g(\\mathbf{x}) \\approx b_{g} \\,\\delta(\\mathbf{x})$，其中 $\\delta(\\mathbf{x})$ 是物质超密度，而 $b_{g}$ 是对于该质量有限选择的线性星系偏置。设 $n(\\mathbf{x})$ 是平均值为 $\\bar{n}$ 的真实星系数量密度场，并定义 $g(\\mathbf{x}) \\equiv n(\\mathbf{x})/\\bar{n} - 1$。观测到的星表受到额外的选择效应影响，这些效应可以用一个完备性场 $c(\\mathbf{x}) \\in [0,1]$ 来描述，使得观测到的数量密度为 $n_{\\mathrm{obs}}(\\mathbf{x}) = c(\\mathbf{x})\\,n(\\mathbf{x})$。定义观测到的超密度为 $g_{\\mathrm{obs}}(\\mathbf{x}) \\equiv n_{\\mathrm{obs}}(\\mathbf{x})/\\bar{n}_{\\mathrm{obs}} - 1$，其中 $\\bar{n}_{\\mathrm{obs}} \\equiv \\langle n_{\\mathrm{obs}} \\rangle$。两点相关函数 (2PCF) 为 $\\xi(r) \\equiv \\langle g(\\mathbf{x})\\,g(\\mathbf{x}+\\mathbf{r}) \\rangle$，类似地，$\\xi_{\\mathrm{obs}}(r) \\equiv \\langle g_{\\mathrm{obs}}(\\mathbf{x})\\,g_{\\mathrm{obs}}(\\mathbf{x}+\\mathbf{r}) \\rangle$。\n\n假设在尺度 $r \\gg R$ 上，完备性涨落 $s(\\mathbf{x}) \\equiv c(\\mathbf{x})/\\langle c \\rangle - 1$ 可以通过 $s(\\mathbf{x}) \\approx \\beta \\,\\delta_{R}(\\mathbf{x})$ 与一个平滑化的环境场 $\\delta_{R}(\\mathbf{x})$ 线性相关，其中 $|\\beta| \\ll 1$，平滑尺度 $R$ 固定。平滑场 $\\delta_{R}(\\mathbf{x})$ 在大尺度上与 $\\delta(\\mathbf{x})$ 相关。考虑以下四种应用于从同一母体质量有限星表中定义子样本的观测截断：\n\n(1) 一个静止系颜色截断，用于在固定恒星质量下选择猝灭/红色星系，其中猝灭比例 $f_{Q}(\\delta_{R})$ 在固定质量下随大尺度超密度 $\\delta_{R}$ 的增加而增加。\n\n(2) 一个比恒星形成率 (sSFR) 阈值，用于在固定恒星质量下仅选择恒星形成星系，其中恒星形成比例 $f_{\\mathrm{SF}}(\\delta_{R})$ 在固定质量下随 $\\delta_{R}$ 的增加而减少。\n\n(3) 一个表面亮度极限，使得平均有效表面亮度低于某一固定阈值的星系未被探测到；假设在固定质量下，低表面亮度星系的比例 $f_{\\mathrm{LSB}}(\\delta_{R})$ 向低密度区域增加（即随 $\\delta_{R}$ 的增加而减少）。\n\n(4) 一个光纤分配限制（“光纤碰撞”），它阻止在角间距 $\\theta_{\\mathrm{fc}}$ 内分配两根光纤，导致角间距 $\\theta \\lesssim \\theta_{\\mathrm{fc}}$ 的星系对中有一个成员丢失。设在巡天红移处对应的共动投影尺度为 $r_{\\mathrm{fc}}$。\n\n从以上定义以及线性偏置、大尺度极限出发，推理 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间的非零协方差如何相对于 $\\xi(r)$ 修改 $\\xi_{\\mathrm{obs}}(r)$，既包括在大尺度 $r \\gg R$ 上，也包括在适用的小尺度 $r \\lesssim r_{\\mathrm{fc}}$ 上。然后，选择最能总结每个截断对观测到的成团性的净定性影响的选项，需考虑大尺度偏置移动的符号和任何独特的小尺度行为：\n\nA. 选择红色/猝灭星系导致 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 正相关，从而增加大尺度成团性幅度；选择高 sSFR 星系导致 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 反相关，从而减少大尺度成团性幅度；遗漏低表面亮度星系使 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 正相关，从而增加大尺度成团性幅度；光纤碰撞优先移除拥挤区域的近邻，因此在 $r \\lesssim r_{\\mathrm{fc}}$ 处压低 $\\xi_{\\mathrm{obs}}(r)$，并可通过使 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 反相关而轻微减小大尺度幅度。\n\nB. 选择红色/猝灭星系会减少大尺度成团性幅度；选择高 sSFR 星系会增加大尺度成团性幅度；遗漏低表面亮度星系会减少大尺度成团性幅度；光纤碰撞通过优先保留孤立星系来增强小尺度成团性。\n\nC. 所有四种效应仅对数量密度和散粒噪声的整体归一化有贡献；如果使用随机星表，则在所有尺度上 $\\xi_{\\mathrm{obs}}(r)$ 仍然是 $\\xi(r)$ 的一个无偏估计量。\n\nD. 光纤碰撞仅影响红移空间各向异性，而不影响位形空间 2PCF；颜色、sSFR 和表面亮度截断仅修改单晕项，不能改变 $r \\gg R$ 上的大尺度偏置。\n\n选择唯一最佳选项。",
            "solution": "### 推导\n目标是在完备性场 $c(\\mathbf{x})$ 的影响下，将观测到的2PCF $\\xi_{\\mathrm{obs}}(r)$ 与真实的2PCF $\\xi(r)$ 联系起来。\n在小涨落 ($|g| \\ll 1, |s| \\ll 1$) 的线性极限下，观测到的星系超密度可以近似表示为真实星系超密度与完备性涨落之和：\n$$g_{\\mathrm{obs}}(\\mathbf{x}) \\approx g(\\mathbf{x}) + s(\\mathbf{x})$$\n这个近似是分析系统效应大尺度影响的标准方法。\n因此，观测到的2PCF为：\n$$\\xi_{\\mathrm{obs}}(r) = \\langle g_{\\mathrm{obs}}(\\mathbf{x})g_{\\mathrm{obs}}(\\mathbf{x}+\\mathbf{r}) \\rangle \\approx \\langle (g(\\mathbf{x})+s(\\mathbf{x}))(g(\\mathbf{x}+\\mathbf{r})+s(\\mathbf{x}+\\mathbf{r})) \\rangle$$\n$$\\xi_{\\mathrm{obs}}(r) \\approx \\xi(r) + \\xi_{ss}(r) + 2\\xi_{gs}(r)$$\n其中 $\\xi_{ss}$ 是完备性场的自相关，$\\xi_{gs}$ 是星系场和完备性场之间的互相关。\n\n在大尺度 ($r \\gg R$) 上，我们已知关系式 $g(\\mathbf{x}) \\approx b_g \\delta(\\mathbf{x})$ 和 $s(\\mathbf{x}) \\approx \\beta \\delta(\\mathbf{x})$ （假设 $\\delta_R \\approx \\delta$）。代入 $g_{\\mathrm{obs}}(\\mathbf{x})$ 的表达式中：\n$$g_{\\mathrm{obs}}(\\mathbf{x}) \\approx b_g \\delta(\\mathbf{x}) + \\beta \\delta(\\mathbf{x}) = (b_g + \\beta)\\delta(\\mathbf{x})$$\n这表明观测到的星系样本以一个修改过的、有效的线性偏置 $b_{\\mathrm{obs}} \\approx b_g + \\beta$ 来追踪物质密度。因此，观测到的大尺度2PCF为 $\\xi_{\\mathrm{obs}}(r) \\approx (b_g + \\beta)^2 \\xi_m(r)$，而真实的为 $\\xi(r) \\approx b_g^2 \\xi_m(r)$。成团性幅度的变化由 $\\beta$ 的符号决定：正的 $\\beta$ （完备性与环境密度正相关）会增加观测到的成团性；负的 $\\beta$ （完备性与密度反相关）会减少观测到的成团性。\n\n### 逐项分析\n\n1.  **红色/猝灭星系选择：** 猝灭比例 $f_{Q}$ 随环境密度 $\\delta_{R}$ 增加而增加。因此，该样本的完备性 $c(\\mathbf{x}) = f_{Q}(\\delta_{R}(\\mathbf{x}))$ 在更稠密的区域中更高。这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在正相关，即 $\\beta > 0$。因此，观测到的大尺度成团性幅度增加。\n\n2.  **高sSFR (恒星形成) 星系选择：** 恒星形成比例 $f_{\\mathrm{SF}}$ 随 $\\delta_{R}$ 增加而减少。完备性 $c(\\mathbf{x}) = f_{\\mathrm{SF}}(\\delta_{R}(\\mathbf{x}))$ 在更稠密的区域中更低。这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在反相关，即 $\\beta < 0$。因此，观测到的大尺度成团性幅度减少。\n\n3.  **遗漏低表面亮度 (LSB) 星系：** 这是一种不完备性效应。完备性 $c(\\mathbf{x})$ 是被探测到的星系的比例，即 $c(\\mathbf{x}) = 1 - f_{\\mathrm{LSB}}(\\delta_{R}(\\mathbf{x}))$。由于LSB星系比例 $f_{\\mathrm{LSB}}$ 随 $\\delta_{R}$ 增加而减少（即LSB星系偏爱低密度区），完备性 $c(\\mathbf{x})$ 必然随 $\\delta_{R}$ 增加而增加。这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在正相关，即 $\\beta > 0$。因此，观测到的大尺度成团性幅度增加。\n\n4.  **光纤碰撞：** 这种效应在角距离近的星系对中移除一个成员，这在物理上对应着高密度区域。\n    *   **小尺度效应：** 在尺度 $r \\lesssim r_{\\mathrm{fc}}$ 上，通过移除星系对，2PCF的幅度被直接压低。\n    *   **大尺度效应：** 由于星系丢失更频繁地发生在星系密集的区域（与物质密度 $\\delta_R$ 正相关），因此观测的完备性 $c(\\mathbf{x})$ 在更稠密的环境中系统性地更低。这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在反相关，即 $\\beta < 0$。因此，观测到的大尺度成团性幅度会轻微减少。\n\n综上所述，选项A准确地描述了所有四种效应。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在概念上理解并能在观测中识别星系形成偏倚之后，最终的挑战是量化它对精确宇宙学测量的具体影响。这个动手实践的编程练习（）提供了一个绝佳的机会，让您从头开始构建一个包含形成偏倚效应的模拟宇宙。您将通过“年龄匹配”方法将星系颜色与其暗物质晕的形成历史联系起来，并直接测量这种效应如何系统性地偏移我们从重子声学振荡（BAO）中测得的宇宙距离标尺，从而深刻理解为何在精密宇宙学时代，我们必须认真对待星系形成偏倚。",
            "id": "3473083",
            "problem": "您需要实现一个独立的数值实验，该实验基于子晕丰度匹配（SubHalo Abundance Matching, SHAM）和年龄匹配的原理，旨在量化颜色选择样本中的星系形成偏置如何使推断出的组态空间重子声学振荡（Baryon Acoustic Oscillation, BAO）伸缩参数产生偏置。该实验涉及生成一个带有最大旋转速度的合成暗晕星表，为其分配形成红移，执行年龄匹配以在固定最大旋转速度下将星系颜色与形成红移联系起来，构建组态空间中的星系两点相关函数模型，并通过拟合一个模板来提取BAO伸缩参数。您将计算由于颜色选择导致的BAO伸缩参数的偏移，作为每个测试用例的单个标量值。\n\n理论基础包括：组态空间中两点相关函数 $\\xi(r)$ 的定义，即在共动距离 $r$ 处找到一个星系对的超额概率（相较于随机分布）；线性欧拉偏置 $b$ 的概念，它在一阶上通过 $\\delta_{\\mathrm{g}} = b \\,\\delta_{\\mathrm{m}}$ 将星系涨落与物质涨落关联起来；子晕丰度匹配的概念，即在固定的共动数密度下，通过一个单调代理量对暗晕进行排序；以及年龄匹配的概念，它在固定的暗晕代理量下，将次级星系属性与暗晕形成时间联系起来。BAO伸缩参数 $\\alpha_{\\mathrm{BAO}}$ 会重新缩放模板 $\\xi_{\\mathrm{m}}(\\alpha \\, r)$ 中的距离，恢复出的 $\\alpha_{\\mathrm{BAO}}$ 的偏置反映了推断距离标度的系统性偏移。\n\n请严格按照指定的单位和形式，实现以下步骤和模型选择：\n\n1. 生成一个包含 $N$ 个暗晕的合成暗晕星表，每个暗晕具有最大旋转速度 $V_{\\mathrm{max}}$ 和形成红移 $z_{\\mathrm{f}}$：\n   - 从截断幂律概率密度 $p(V_{\\mathrm{max}}) \\propto V_{\\mathrm{max}}^{-\\beta}$ 中抽取 $V_{\\mathrm{max}}$，其中 $V_{\\mathrm{min}} \\le V_{\\mathrm{max}} \\le V_{\\mathrm{max,up}}$，$V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$，$V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$，$\\beta = 3.5$，且 $N = 10^5$。\n   - 从均值为零、方差为 $\\sigma_{\\mathrm{env}}^2$ 的高斯分布中抽取一个大尺度环境代理量 $\\delta_{\\mathrm{env}}$，其中 $\\sigma_{\\mathrm{env}} = 0.8$。\n   - 定义形成红移为 $z_{\\mathrm{f}} = z_0 + s_1 \\ln\\!\\left(V_{\\mathrm{max}}/V_0\\right) + s_2 \\delta_{\\mathrm{env}} + \\epsilon$，其中 $z_0 = 1.5$，$V_0 = 200\\,\\mathrm{km/s}$，$s_1 = 0.2$，$s_2 = 0.6$，而 $\\epsilon$ 从均值为零、方差为 $\\sigma_{z}^2$ 的高斯分布中抽取，其中 $\\sigma_{z} = 0.4$。\n   - 将形成红移归一化为一个无量纲量 $Z = \\left(z_{\\mathrm{f}} - \\overline{z_{\\mathrm{f}}}\\right)/\\sigma(z_{\\mathrm{f}})$，其中 $\\overline{z_{\\mathrm{f}}}$ 是样本均值，$\\sigma(z_{\\mathrm{f}})$ 是样本标准差。\n\n2. 在固定的 $V_{\\mathrm{max}}$ 下实现年龄匹配的SHAM颜色分配：\n   - 将暗晕按 $V_{\\mathrm{max}}$ 分箱，箱宽为 $\\Delta V = 20\\,\\mathrm{km/s}$，范围从 $V_{\\mathrm{min}}$到 $V_{\\mathrm{max,up}}$。\n   - 在每个 $V_{\\mathrm{max}}$ 箱内，按 $z_{\\mathrm{f}}$ 降序对暗晕进行排序，并将前 $f_{\\mathrm{red}}$ 的部分指定为“红色”，其余为“蓝色”（此问题中您只需要红色选择）。\n   - 使用所有被指定为红色的暗晕（跨越所有分箱），计算红色样本的平均归一化形成红移 $\\overline{Z}_{\\mathrm{red}}$。\n\n3. 建立在固定 $V_{\\mathrm{max}}$ 下具有形成偏置依赖性的暗晕偏置模型：\n   - 定义只依赖于质量的暗晕偏置 $b_{\\mathrm{mass}}(V_{\\mathrm{max}}) = b_\\ast + c \\ln\\!\\left(V_{\\mathrm{max}}/V_0\\right)$，其中 $b_\\ast = 1.2$，$c = 0.3$。\n   - 定义形成偏置幅度 $A_{\\mathrm{ab}}$，使得暗晕偏置为 $b_{\\mathrm{h}}(V_{\\mathrm{max}}, Z) = b_{\\mathrm{mass}}(V_{\\mathrm{max}})\\,\\left[1 + A_{\\mathrm{ab}}\\, Z\\right]$。\n   - 将红色样本的有效星系偏置 $b_{\\mathrm{g,red}}$ 定义为在所有被指定为红色的暗晕上 $b_{\\mathrm{h}}$ 的均值。类似地，将完整（所有暗晕）样本的有效星系偏置 $b_{\\mathrm{g,all}}$ 定义为在所有暗晕上的均值。这些偏置控制着振幅，并在拟合中通过一个自由的模板振幅被边缘化。\n\n4. 构建共动距离 $r$（单位为 $\\mathrm{Mpc}/h$）下组态空间中的物质相关函数模板：\n   - 使用基线平滑项 $S(r) = -A_{\\mathrm{s}} / r^\\gamma$，其中 $A_{\\mathrm{s}} = 0.2$，$\\gamma = 1.8$。\n   - 使用高斯BAO峰 $W(r) = A_{\\mathrm{w}} \\exp\\!\\left[-\\dfrac{(r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right]$，其中 $A_{\\mathrm{w}} = 0.01$，$r_{\\mathrm{b}} = 105\\,\\mathrm{Mpc}/h$，$\\sigma_{\\mathrm{w}} = 8\\,\\mathrm{Mpc}/h$。\n   - 定义 $\\xi_{\\mathrm{m}}(r) = S(r) + W(r)$。\n\n5. 构建观测到的星系相关函数：\n   - 对于全星系样本，定义 $\\xi_{\\mathrm{g,all}}(r) = b_{\\mathrm{g,all}}^2 \\,\\xi_{\\mathrm{m}}(r)$。\n   - 对于红色选择的样本，引入一个由形成偏置引起的BAO峰位移 $\\Delta r = k_{\\mathrm{shift}}\\,A_{\\mathrm{ab}}\\,\\overline{Z}_{\\mathrm{red}}$，并定义 $\\xi_{\\mathrm{g,red}}(r) = b_{\\mathrm{g,red}}^2 \\,\\left[S(r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\dfrac{(r - (r_{\\mathrm{b}} + \\Delta r))^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right]$。此形式编码了数据与基准模板之间的轻微模型不匹配，这可能会使恢复的伸缩参数产生偏置。\n\n6. 通过拟合一个重新缩放物质相关函数中距离的模板，并边缘化宽带项，来估计BAO伸缩参数：\n   - 将模型 $\\xi_{\\mathrm{model}}(r;\\alpha,B,a_0,a_1,a_2) = B^2 \\left[S(\\alpha \\, r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\dfrac{(\\alpha \\, r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] + a_0 + \\dfrac{a_1}{r} + \\dfrac{a_2}{r^2}$ 分别拟合到 $\\xi_{\\mathrm{g,all}}(r)$ 和 $\\xi_{\\mathrm{g,red}}(r)$，拟合范围为 $r \\in [60,140]\\,\\mathrm{Mpc}/h$（在整数 $r$ 处采样）。\n   - 使用非线性最小二乘法估计 $\\alpha$、$B$、$a_0$、$a_1$ 和 $a_2$，并设定符合物理意义的边界：$0.9 \\le \\alpha \\le 1.1$，$0.5 \\le B \\le 3.0$，$-1 \\le a_0 \\le 1$，$-10 \\le a_1 \\le 10$，$-100 \\le a_2 \\le 100$。\n   - 需要报告的BAO偏移为 $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$，以无量纲小数形式表示。\n\n7. 要求的单位和输出：\n   - 距离 $r$ 必须以 $\\mathrm{Mpc}/h$ 为单位。\n   - 速度 $V_{\\mathrm{max}}$ 必须以 $\\mathrm{km/s}$ 为单位。\n   - 形成红移 $z_{\\mathrm{f}}$ 和归一化后的 $Z$ 是无量纲的。\n   - 最终输出 $\\Delta \\alpha_{\\mathrm{BAO}}$ 必须是无量纲的，并以小数形式打印，保留六位小数。\n\n您的程序必须生成单行输出，其中包含以下测试套件的结果，结果以逗号分隔并用方括号括起来，按所列顺序排列。每个测试用例由 $(\\mathrm{seed}, f_{\\mathrm{red}}, A_{\\mathrm{ab}}, k_{\\mathrm{shift}})$ 定义：\n\n- 测试 1: $(42, 0.5, 0.2, 0.4)$\n- 测试 2: $(7, 0.3, 0.4, 0.6)$\n- 测试 3: $(13, 0.7, 0.0, 0.6)$\n- 测试 4: $(101, 0.1, 0.5, 0.3)$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4]$），其中每个条目是对应测试用例的 $\\Delta \\alpha_{\\mathrm{BAO}}$，四舍五入到六位小数。不允许有其他输出。",
            "solution": "本解答旨在通过一个数值实验，量化在分析颜色选择的星系样本时，由星系形成偏置引起的对重子声学振荡（BAO）伸缩参数 $\\alpha_{\\mathrm{BAO}}$ 的系统性偏置。该实验模拟了一个合成的暗晕星表，根据暗晕形成年龄（年龄匹配）分配星系颜色，为不同样本的相关函数建模，并拟合一个模板以提取 $\\alpha_{\\mathrm{BAO}}$。最终输出是偏移量 $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$。\n\n该解决方案通过遵循问题陈述中指定的步骤序列来实现。\n\n**步骤 1：合成暗晕星表生成**\n我们生成一个包含 $N = 10^5$ 个暗晕的合成星表。每个暗晕由其最大旋转速度 $V_{\\mathrm{max}}$、一个大尺度环境代理量 $\\delta_{\\mathrm{env}}$ 和一个形成红移 $z_{\\mathrm{f}}$ 定义。\n\n**步骤 2：年龄匹配与颜色分配**\n我们实现一个年龄匹配方案，为每个暗晕分配一种“颜色”。在固定的 $V_{\\mathrm{max}}$ 箱内，形成红移 $z_{\\mathrm{f}}$ 更高的（即形成更早的）暗晕被优先指定为“红色”。然后我们计算红色样本的平均归一化形成红移 $\\overline{Z}_{\\mathrm{red}}$，它度量了红色星系样本相对于总体的平均形成时期。\n\n**步骤 3：具有形成偏置依赖性的暗晕偏置**\n暗晕的聚集强度（偏置 $b_{\\mathrm{h}}$）被建模为不仅依赖于质量（由 $V_{\\mathrm{max}}$ 代理），还依赖于形成时间（由 $Z$ 代理）。这种对次级属性的依赖性由形成偏置幅度 $A_{\\mathrm{ab}}$ 控制。\n\n**步骤 4与5：构建星系相关函数**\n我们对两点相关函数 $\\xi(r)$ 进行建模。对于全星系样本，它由一个标准的物质相关函数模板 $\\xi_{\\mathrm{m}}(r)$ 乘以偏置的平方得到。对于红色样本，形成偏置在BAO峰的位置引入了一个物理位移 $\\Delta r = k_{\\mathrm{shift}}\\,A_{\\mathrm{ab}}\\,\\overline{Z}_{\\mathrm{red}}$。红色样本相关函数中真实峰位与模板峰位 $r_b$ 之间的这种不匹配，正是我们旨在测量的系统性偏置的来源。\n\n**步骤 6：估计BAO伸缩参数**\nBAO伸缩参数 $\\alpha_{\\mathrm{BAO}}$ 是通过将一个包含可伸缩距离轴和宽带干扰项的模型拟合到“观测”的相关函数来提取的。对全星系样本的拟合得到 $\\alpha_{\\mathrm{all}}$，对红色样本的拟合得到 $\\alpha_{\\mathrm{red}}$。每个测试用例的最终结果是BAO伸缩参数的系统性偏移 $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$。这个值量化了在分析颜色选择的星系样本时，因忽略形成偏置而导致的宇宙学距离标度测量误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Main function to run the full analysis for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (seed, f_red, A_ab, k_shift)\n        (42, 0.5, 0.2, 0.4),\n        (7, 0.3, 0.4, 0.6),\n        (13, 0.7, 0.0, 0.6),\n        (101, 0.1, 0.5, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_alpha = _solve_single_case(*case)\n        results.append(delta_alpha)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef _solve_single_case(seed, f_red, A_ab, k_shift):\n    \"\"\"\n    Performs the numerical experiment for a single test case.\n    \"\"\"\n    # 1. Define model constants and generate halo catalog\n    # Catalog generation\n    N = 100000\n    V_min, V_max_up, beta = 100.0, 400.0, 3.5\n    # Formation redshift model\n    z0, V0, s1, s2 = 1.5, 200.0, 0.2, 0.6\n    sigma_env, sigma_z = 0.8, 0.4\n    # Age matching\n    delta_v_bin = 20.0\n    # Halo bias model\n    b_star, c = 1.2, 0.3\n    # Correlation function model\n    A_s, gamma = 0.2, 1.8\n    A_w, r_b, sigma_w = 0.01, 105.0, 8.0\n\n    rng = np.random.default_rng(seed)\n\n    # Generate V_max from a truncated power law using inverse transform sampling\n    u = rng.uniform(size=N)\n    inv_beta_m1 = 1.0 / (1.0 - beta)\n    v_min_pow = V_min**(1.0 - beta)\n    v_max_pow = V_max_up**(1.0 - beta)\n    V_max = (v_min_pow + u * (v_max_pow - v_min_pow))**inv_beta_m1\n\n    # Generate formation redshift z_f\n    delta_env = rng.normal(loc=0.0, scale=sigma_env, size=N)\n    epsilon = rng.normal(loc=0.0, scale=sigma_z, size=N)\n    z_f = z0 + s1 * np.log(V_max / V0) + s2 * delta_env + epsilon\n\n    # Normalize formation redshift\n    Z = (z_f - np.mean(z_f)) / np.std(z_f)\n\n    # 2. Implement age-matching SHAM\n    v_bins = np.arange(V_min, V_max_up + delta_v_bin, delta_v_bin)\n    bin_indices = np.digitize(V_max, bins=v_bins)\n    \n    red_halo_indices = []\n    for i in range(1, len(v_bins)):\n        halos_in_bin_mask = (bin_indices == i)\n        halos_in_bin_idx = np.where(halos_in_bin_mask)[0]\n        \n        if len(halos_in_bin_idx) == 0:\n            continue\n            \n        z_f_in_bin = z_f[halos_in_bin_idx]\n        # Sort halos in bin by z_f descending to find the \"oldest\"\n        sorted_indices = np.argsort(z_f_in_bin)[::-1]\n        \n        # Select the top f_red fraction as \"red\"\n        n_red_in_bin = int(len(halos_in_bin_idx) * f_red)\n        red_indices_in_bin = halos_in_bin_idx[sorted_indices[:n_red_in_bin]]\n        red_halo_indices.extend(red_indices_in_bin)\n    \n    red_halo_indices = np.array(red_halo_indices)\n    mean_Z_red = np.mean(Z[red_halo_indices])\n\n    # 3. Model halo bias\n    b_mass = b_star + c * np.log(V_max / V0)\n    b_h = b_mass * (1.0 + A_ab * Z)\n    \n    b_g_all = np.mean(b_h)\n    b_g_red = np.mean(b_h[red_halo_indices])\n\n    # 4  5. Construct the galaxy correlation functions\n    r_vals = np.arange(60, 141)\n\n    def S_func(r_): return -A_s / r_**gamma\n    def W_func(r_): return A_w * np.exp(-(r_ - r_b)**2 / (2.0 * sigma_w**2))\n    \n    xi_m = S_func(r_vals) + W_func(r_vals)\n    xi_g_all = b_g_all**2 * xi_m\n    \n    delta_r = k_shift * A_ab * mean_Z_red\n    xi_g_red = b_g_red**2 * (S_func(r_vals) + A_w * np.exp(-(r_vals - (r_b + delta_r))**2 / (2.0 * sigma_w**2)))\n    \n    # 6. Estimate BAO dilation parameters via fitting\n    def xi_model(r, alpha, B, a0, a1, a2):\n        S_fit = -A_s / (alpha * r)**gamma\n        W_fit = A_w * np.exp(-(alpha * r - r_b)**2 / (2.0 * sigma_w**2))\n        poly = a0 + a1 / r + a2 / r**2\n        return B**2 * (S_fit + W_fit) + poly\n        \n    bounds = ([0.9, 0.5, -1., -10., -100.], [1.1, 3.0, 1., 10., 100.])\n    \n    # Fit all-galaxies sample\n    popt_all, _ = curve_fit(xi_model, r_vals, xi_g_all, bounds=bounds, method='trf')\n    alpha_all = popt_all[0]\n    \n    # Fit red-selected sample\n    popt_red, _ = curve_fit(xi_model, r_vals, xi_g_red, bounds=bounds, method='trf')\n    alpha_red = popt_red[0]\n    \n    # Calculate the shift\n    delta_alpha_bao = alpha_red - alpha_all\n    \n    return delta_alpha_bao\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}