{
    "hands_on_practices": [
        {
            "introduction": "A powerful method for quantifying the link between galaxy properties and their environment is the use of \"marked statistics.\" In this formalism, each galaxy is assigned a \"mark,\" which can be any observable property such as luminosity, color, or star formation rate. This exercise provides a foundational, first-principles derivation of the marked two-point correlation function. By completing this practice, you will see how a simple, linear correlation between a galaxy's mark and the local matter overdensity translates into a distinct, measurable signal, providing a direct window into the physics of assembly bias. ",
            "id": "3473125",
            "problem": "Consider a statistically homogeneous and isotropic matter overdensity field $\\delta(\\mathbf{x})$ that is a Gaussian random field with zero mean, variance $\\sigma_{\\delta}^{2} \\equiv \\langle \\delta^{2} \\rangle$, and two-point correlation function $\\xi(r) \\equiv \\langle \\delta(\\mathbf{x}) \\delta(\\mathbf{x}+\\mathbf{r}) \\rangle$. Galaxies are biased tracers of the matter field with a linear, deterministic bias so that the galaxy overdensity is $\\delta_{g}(\\mathbf{x}) = b \\, \\delta(\\mathbf{x})$, where $b$ is a constant linear bias factor. Let each galaxy carry a scalar mark $m(\\mathbf{x})$ with mean $\\bar{m} \\equiv \\langle m \\rangle$ and variance $\\sigma_{m}^{2} \\equiv \\langle [m - \\bar{m}]^{2} \\rangle$. Assume a linear stochastic mark model in which the mark is correlated with the local environment (as measured by $\\delta$) via the correlation coefficient\n$$\n\\rho \\equiv \\frac{\\langle [m(\\mathbf{x}) - \\bar{m}] \\, \\delta(\\mathbf{x}) \\rangle}{\\sigma_{m} \\, \\sigma_{\\delta}} \\, ,\n$$\nand is otherwise uncorrelated noise. Under the minimal linear projection consistent with this correlation, write\n$$\nm(\\mathbf{x}) = \\bar{m} + \\gamma \\, \\delta(\\mathbf{x}) + \\epsilon(\\mathbf{x}) \\, ,\n$$\nwith $\\epsilon$ independent of $\\delta$, zero mean $\\langle \\epsilon \\rangle = 0$, and chosen so that $\\mathrm{corr}(m,\\delta) = \\rho$, which fixes $\\gamma = \\rho \\, \\sigma_{m}/\\sigma_{\\delta}$. Assume $\\epsilon$ is spatially uncorrelated, i.e., $\\langle \\epsilon(\\mathbf{x}) \\epsilon(\\mathbf{x}+\\mathbf{r}) \\rangle = 0$ for $r > 0$.\n\nDefine the marked correlation function as the mark-weighted pair ratio in the continuous-field approximation,\n$$\nM(r) \\equiv \\frac{\\left\\langle m(\\mathbf{x}) \\, m(\\mathbf{x}+\\mathbf{r}) \\, \\bigl[1+\\delta_{g}(\\mathbf{x})\\bigr] \\, \\bigl[1+\\delta_{g}(\\mathbf{x}+\\mathbf{r})\\bigr] \\right\\rangle}{\\bar{m}^{2} \\, \\bigl[1 + \\xi_{gg}(r)\\bigr]} \\, ,\n$$\nwhere $\\xi_{gg}(r) \\equiv \\langle \\delta_{g}(\\mathbf{x}) \\delta_{g}(\\mathbf{x}+\\mathbf{r}) \\rangle = b^{2} \\, \\xi(r)$ is the galaxy two-point correlation function.\n\nStarting from the definitions above and using Gaussian statistics together with Wick’s theorem to truncate connected higher-order moments, derive a closed-form expression for $M(r)$ to leading order in the matter two-point correlation function $\\xi(r)$. Your final expression must be written explicitly in terms of $b$, $\\bar{m}$, $\\sigma_{\\delta}$, $\\sigma_{m}$, $\\rho$, and $\\xi(r)$. Express the answer as a single analytic expression; no numerical evaluation is required.",
            "solution": "The problem requires the derivation of the marked correlation function $M(r)$ to leading order in the matter two-point correlation function $\\xi(r)$. The marked correlation function is defined as\n$$\nM(r) \\equiv \\frac{\\left\\langle m(\\mathbf{x}) \\, m(\\mathbf{x}+\\mathbf{r}) \\, \\bigl[1+\\delta_{g}(\\mathbf{x})\\bigr] \\, \\bigl[1+\\delta_{g}(\\mathbf{x}+\\mathbf{r})\\bigr] \\right\\rangle}{\\bar{m}^{2} \\, \\bigl[1 + \\xi_{gg}(r)\\bigr]}\n$$\nLet us denote the numerator of this expression by $N(r)$ and the denominator by $D(r)$. The task is to compute $N(r)$ by substituting the given models for the galaxy overdensity $\\delta_g(\\mathbf{x})$ and the mark $m(\\mathbf{x})$, and then evaluating the expectation value.\n\nThe provided models are:\n1.  Galaxy overdensity: $\\delta_{g}(\\mathbf{x}) = b \\, \\delta(\\mathbf{x})$\n2.  Scalar mark: $m(\\mathbf{x}) = \\bar{m} + \\gamma \\, \\delta(\\mathbf{x}) + \\epsilon(\\mathbf{x})$\n\nLet us denote the fields at position $\\mathbf{x}$ by a subscript $1$ and at position $\\mathbf{x}+\\mathbf{r}$ by a subscript $2$. Thus, $\\delta_1 = \\delta(\\mathbf{x})$, $\\delta_2 = \\delta(\\mathbf{x}+\\mathbf{r})$, and so on.\n\nThe numerator is $N(r) = \\langle m_1 m_2 (1+\\delta_{g1})(1+\\delta_{g2}) \\rangle$. To simplify, we can express the mark in terms of its fractional overdensity, $\\delta_m = (m-\\bar{m})/\\bar{m}$.\n$$\nN(r) = \\bar{m}^2 \\left\\langle (1 + \\delta_{m1})(1 + \\delta_{m2})(1 + \\delta_{g1})(1 + \\delta_{g2}) \\right\\rangle\n$$\nWe expand the product inside the expectation and keep terms that are non-zero under the expectation value. For a Gaussian field $\\delta$ with $\\langle\\delta\\rangle = 0$ and an independent noise field $\\epsilon$ with $\\langle\\epsilon\\rangle = 0$, only terms with an even number of fields contribute. We keep terms up to the four-point correlator and truncate at leading order in $\\xi(r)$.\n$$\n\\frac{N(r)}{\\bar{m}^2} = \\langle (1 + \\delta_{m1} + \\delta_{m2} + \\delta_{g1} + \\delta_{g2} + \\dots) \\rangle \\approx 1 + \\langle\\delta_{m1}\\delta_{m2}\\rangle + \\langle\\delta_{g1}\\delta_{g2}\\rangle + \\langle\\delta_{m1}\\delta_{g2}\\rangle + \\langle\\delta_{m2}\\delta_{g1}\\rangle + \\langle\\delta_{m1}\\delta_{g1}\\rangle + \\langle\\delta_{m2}\\delta_{g2}\\rangle + \\langle\\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2}\\rangle\n$$\nLet's compute the correlation terms:\n-   $\\langle \\delta_{g1}\\delta_{g2} \\rangle = \\langle (b\\delta_1)(b\\delta_2) \\rangle = b^2\\langle\\delta_1\\delta_2\\rangle = b^2\\xi(r)$.\n-   $\\langle \\delta_{m1}\\delta_{m2} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} \\frac{\\gamma\\delta_2+\\epsilon_2}{\\bar{m}} \\rangle = \\frac{1}{\\bar{m}^2} \\left( \\gamma^2\\langle\\delta_1\\delta_2\\rangle \\right) = \\frac{\\gamma^2}{\\bar{m}^2}\\xi(r)$, since $\\langle\\epsilon_1\\epsilon_2\\rangle = 0$ for $r>0$ and $\\delta, \\epsilon$ are independent.\n-   $\\langle \\delta_{m1}\\delta_{g2} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} (b\\delta_2) \\rangle = \\frac{b\\gamma}{\\bar{m}}\\langle\\delta_1\\delta_2\\rangle = \\frac{b\\gamma}{\\bar{m}}\\xi(r)$. Likewise, $\\langle\\delta_{m2}\\delta_{g1}\\rangle = \\frac{b\\gamma}{\\bar{m}}\\xi(r)$.\n-   $\\langle \\delta_{m1}\\delta_{g1} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} (b\\delta_1) \\rangle = \\frac{b\\gamma}{\\bar{m}}\\langle\\delta_1^2\\rangle = \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}}$. This is a one-point correlation, a constant. Likewise, $\\langle\\delta_{m2}\\delta_{g2}\\rangle = \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}}$.\n-   The four-point term is $\\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle = \\langle (\\frac{\\gamma\\delta_1}{\\bar{m}}) (\\frac{\\gamma\\delta_2}{\\bar{m}}) (b\\delta_1)(b\\delta_2) \\rangle = \\frac{b^2\\gamma^2}{\\bar{m}^2} \\langle \\delta_1^2 \\delta_2^2 \\rangle$. Using Wick's theorem for a Gaussian field, $\\langle \\delta_1^2 \\delta_2^2 \\rangle = \\langle\\delta_1\\delta_1\\rangle\\langle\\delta_2\\delta_2\\rangle + 2\\langle\\delta_1\\delta_2\\rangle^2 = \\sigma_\\delta^4 + 2\\xi(r)^2$. To leading order in $\\xi(r)$, we keep only the constant part: $\\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle \\approx \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2}$.\n\nSumming up all contributions to the numerator's expectation:\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx 1 + \\left( \\frac{\\gamma^2}{\\bar{m}^2}\\xi(r) \\right) + \\left( b^2\\xi(r) \\right) + \\left( \\frac{b\\gamma}{\\bar{m}}\\xi(r) \\right) + \\left( \\frac{b\\gamma}{\\bar{m}}\\xi(r) \\right) + \\left( \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right) + \\left( \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right) + \\left( \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2} \\right)\n$$\nCollecting terms that are constant and those proportional to $\\xi(r)$:\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx \\left( 1 + \\frac{2b\\gamma\\sigma_\\delta^2}{\\bar{m}} + \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2} \\right) + \\left( b^2 + \\frac{2b\\gamma}{\\bar{m}} + \\frac{\\gamma^2}{\\bar{m}^2} \\right) \\xi(r)\n$$\nRecognizing the terms in parentheses as perfect squares:\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx \\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r)\n$$\nThe denominator is $D(r) = \\bar{m}^2(1+\\xi_{gg}(r)) = \\bar{m}^2(1+b^2\\xi(r))$.\nThus, the marked correlation function is:\n$$\nM(r) = \\frac{N(r)}{D(r)} = \\frac{\\bar{m}^2 \\left[ \\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r) \\right]}{\\bar{m}^2 (1+b^2\\xi(r))} = \\frac{\\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r)}{1+b^2\\xi(r)}\n$$\nFinally, we substitute $\\gamma = \\rho \\frac{\\sigma_m}{\\sigma_\\delta}$:\nThe constant part of the numerator becomes:\n$1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} = 1 + \\frac{b}{\\bar{m}} \\left(\\rho \\frac{\\sigma_m}{\\sigma_\\delta}\\right) \\sigma_\\delta^2 = 1 + \\frac{b\\rho\\sigma_m\\sigma_\\delta}{\\bar{m}}$\nThe term multiplying $\\xi(r)$ becomes:\n$b + \\frac{\\gamma}{\\bar{m}} = b + \\frac{1}{\\bar{m}} \\left(\\rho \\frac{\\sigma_m}{\\sigma_\\delta}\\right) = b \\left( 1 + \\frac{\\rho\\sigma_m}{b\\bar{m}\\sigma_\\delta} \\right)$\nSubstituting these into the expression for $M(r)$ gives the final expression.\n$$\nM(r) = \\frac{\\left( 1 + \\frac{b\\rho\\sigma_m\\sigma_\\delta}{\\bar{m}} \\right)^2 + b^2\\left( 1 + \\frac{\\rho\\sigma_m}{b\\bar{m}\\sigma_\\delta} \\right)^2 \\xi(r)}{1+b^2\\xi(r)}\n$$\nThis is the closed-form expression for $M(r)$ to leading order in $\\xi(r)$.",
            "answer": "$$\n\\boxed{\\frac{\\left( 1 + \\frac{b \\rho \\sigma_{m} \\sigma_{\\delta}}{\\bar{m}} \\right)^{2} + b^{2} \\left( 1 + \\frac{\\rho \\sigma_{m}}{b \\bar{m} \\sigma_{\\delta}} \\right)^{2} \\xi(r)}{1 + b^{2} \\xi(r)}}\n$$"
        },
        {
            "introduction": "Moving from real space to Fourier space allows us to connect with the modern Effective Field Theory of Large Scale Structure (EFT-LSS). Within this framework, assembly bias—which arises from the dependence of halo formation on the local tidal environment—naturally gives rise to a galaxy bias that is not constant but varies with scale. This exercise guides you through a derivation of this scale-dependent bias, showing how to link nonlocal tidal field physics to the observable galaxy power spectrum, $P_{gg}(k)$, on the quasi-linear scales crucial for cosmological analysis. ",
            "id": "3473062",
            "problem": "Consider a cosmological density field with linear matter overdensity $\\delta(\\boldsymbol{x})$ and peculiar gravitational potential $\\Phi(\\boldsymbol{x})$ related by the linear Poisson equation in comoving coordinates, $\\nabla^{2}\\Phi(\\boldsymbol{x})=\\delta(\\boldsymbol{x})$. Define the Gaussian-smoothed field with window $W_{R}(k)=\\exp\\!\\left(-\\frac{k^{2}R^{2}}{2}\\right)$, and let $\\Phi_{R}$ and $\\delta_{R}$ denote the corresponding smoothed potential and density fields. The traceless tidal tensor is $s_{ij}(\\boldsymbol{x})\\equiv \\partial_{i}\\partial_{j}\\Phi(\\boldsymbol{x})-\\frac{\\delta_{ij}}{3}\\nabla^{2}\\Phi(\\boldsymbol{x})$, and its Gaussian-smoothed version is $s_{ij,R}$. Consider a selection variable $\\alpha(\\boldsymbol{x})$ constructed from the tidal field by its isotropic trace,\n$$\n\\alpha(\\boldsymbol{x})\\equiv R^{2}\\,\\nabla^{2}\\Phi_{R}(\\boldsymbol{x})\\,,\n$$\nwhich, by the Poisson equation, is proportional to the smoothed overdensity $\\delta_{R}$. Assume a nonlocal tidal bias model for a galaxy sample with baseline linear Eulerian bias $b_{1}$, and let the selection on $\\alpha$ modulate the number density through a linear response $c_{\\alpha}$ so that, to leading order, the selected tracer field is\n$$\n\\delta_{g}(\\boldsymbol{x}\\,|\\,\\alpha)\\simeq b_{1}\\,\\delta(\\boldsymbol{x})+c_{\\alpha}\\Big(\\alpha(\\boldsymbol{x})-\\langle \\alpha\\rangle\\Big)\\,.\n$$\nWork in Fourier space with the convention $\\langle\\delta(\\boldsymbol{k})\\,\\delta(\\boldsymbol{k}')\\rangle=(2\\pi)^{3}\\delta_{D}(\\boldsymbol{k}+\\boldsymbol{k}')\\,P_{L}(k)$, where $P_{L}(k)$ is the linear matter power spectrum. At quasi-linear scales with $kR\\ll 1$, treat the effect of the selection on $\\alpha$ within the Effective Field Theory of Large Scale Structure (EFT-LSS) gradient expansion up to second order in derivatives and neglect higher-order nonlinear bias operators.\n\nStarting from the above fundamental relations and assumptions, derive the scale-dependent bias $b(k\\,|\\,\\alpha)$ that multiplies $\\delta(\\boldsymbol{k})$ in $\\delta_{g}(\\boldsymbol{k}\\,|\\,\\alpha)$, and then estimate its impact on the galaxy-galaxy power spectrum $P_{gg}(k)$ at quasi-linear scales, retaining terms up to $\\mathcal{O}\\!\\left((kR)^{2}\\right)$. Express your final answer as a single closed-form analytic expression for $P_{gg}(k)$ in terms of $b_{1}$, $c_{\\alpha}$, $R$, $k$, and $P_{L}(k)$. No numerical evaluation is required. If you make any approximation, it must be rigorously justified by the small-$kR$ expansion. Your final expression must be valid to leading nontrivial order in $(kR)^{2}$.",
            "solution": "The objective is to derive the galaxy-galaxy power spectrum $P_{gg}(k)$ for a tracer population $\\delta_g$ whose density is modulated by a tidal field selection effect. The derivation will be performed in Fourier space and expanded to second order in $k$, consistent with the quasi-linear regime $kR \\ll 1$.\n\nThe starting point is the model for the galaxy overdensity field, $\\delta_g(\\boldsymbol{x}\\,|\\,\\alpha)$. Since cosmological fields are assumed to have zero mean, it follows that $\\langle\\alpha(\\boldsymbol{x})\\rangle=0$. The model simplifies to:\n$$\n\\delta_{g}(\\boldsymbol{x}\\,|\\,\\alpha)\\simeq b_{1}\\,\\delta(\\boldsymbol{x})+c_{\\alpha}\\alpha(\\boldsymbol{x})\n$$\nWe transform this relation into Fourier space. The Fourier transform of a function $f(\\boldsymbol{x})$ is denoted by $f(\\boldsymbol{k})$. Applying the transform yields:\n$$\n\\delta_{g}(\\boldsymbol{k}\\,|\\,\\alpha) \\simeq b_{1}\\,\\delta(\\boldsymbol{k})+c_{\\alpha}\\alpha(\\boldsymbol{k})\n$$\nNext, we express $\\alpha(\\boldsymbol{k})$ in terms of the fundamental matter overdensity field $\\delta(\\boldsymbol{k})$. The selection variable is defined as $\\alpha(\\boldsymbol{x})\\equiv R^{2}\\,\\nabla^{2}\\Phi_{R}(\\boldsymbol{x})$. From the linear Poisson equation, $\\nabla^{2}\\Phi(\\boldsymbol{x})=\\delta(\\boldsymbol{x})$, it follows that $\\nabla^{2}\\Phi_{R}(\\boldsymbol{x}) = \\delta_{R}(\\boldsymbol{x})$. Thus, the selection variable is $\\alpha(\\boldsymbol{x}) = R^{2}\\delta_{R}(\\boldsymbol{x})$. In Fourier space, smoothing corresponds to multiplication by the window function, $\\delta_R(\\boldsymbol{k}) = \\delta(\\boldsymbol{k})W_R(k)$. Therefore:\n$$\n\\alpha(\\boldsymbol{k}) = R^{2}\\delta_{R}(\\boldsymbol{k}) = R^{2}W_{R}(k)\\delta(\\boldsymbol{k}) = R^{2}\\exp\\!\\left(-\\frac{k^{2}R^{2}}{2}\\right)\\delta(\\boldsymbol{k})\n$$\nSubstituting this into the equation for $\\delta_g(\\boldsymbol{k}\\,|\\,\\alpha)$:\n$$\n\\delta_{g}(\\boldsymbol{k}\\,|\\,\\alpha) = b_{1}\\delta(\\boldsymbol{k}) + c_{\\alpha}R^{2}\\exp\\!\\left(-\\frac{k^{2}R^{2}}{2}\\right)\\delta(\\boldsymbol{k})\n$$\nWe factor out $\\delta(\\boldsymbol{k})$ to identify the effective scale-dependent bias, $b(k\\,|\\,\\alpha)$:\n$$\nb(k\\,|\\,\\alpha) = b_{1} + c_{\\alpha}R^{2}\\exp\\!\\left(-\\frac{k^{2}R^{2}}{2}\\right)\n$$\nThe problem requires an analysis on quasi-linear scales where $kR \\ll 1$, so we Taylor-expand the exponential to $\\mathcal{O}((kR)^2)$: $\\exp(-x) \\approx 1 - x$.\n$$\nb(k\\,|\\,\\alpha) \\approx b_{1} + c_{\\alpha}R^{2}\\left(1 - \\frac{k^{2}R^{2}}{2}\\right) = (b_{1} + c_{\\alpha}R^{2}) - \\frac{c_{\\alpha}R^{4}}{2}k^{2}\n$$\nThe galaxy-galaxy power spectrum is $P_{gg}(k) = [b(k\\,|\\,\\alpha)]^{2} P_{L}(k)$. To obtain the final expression valid to $\\mathcal{O}((kR)^2)$, we must square the approximated bias and neglect terms of higher order than $k^2$:\n$$\n[b(k\\,|\\,\\alpha)]^{2} \\approx \\left[ (b_{1} + c_{\\alpha}R^{2}) - \\frac{c_{\\alpha}R^{4}}{2}k^{2} \\right]^2\n$$\nExpanding the square:\n$$\n[b(k\\,|\\,\\alpha)]^{2} \\approx (b_{1} + c_{\\alpha}R^{2})^{2} - 2(b_{1} + c_{\\alpha}R^{2})\\left(\\frac{c_{\\alpha}R^{4}}{2}k^{2}\\right) + \\mathcal{O}(k^4)\n$$\nDiscarding the $\\mathcal{O}(k^4)$ term, we have:\n$$\n[b(k\\,|\\,\\alpha)]^{2} \\approx (b_{1} + c_{\\alpha}R^{2})^{2} - (b_{1} + c_{\\alpha}R^{2})c_{\\alpha}R^{4}k^{2}\n$$\nFinally, we substitute this squared bias into the expression for the galaxy power spectrum:\n$$\nP_{gg}(k) \\approx \\left[ (b_{1} + c_{\\alpha}R^{2})^{2} - c_{\\alpha}(b_{1} + c_{\\alpha}R^{2})R^{4}k^{2} \\right] P_{L}(k)\n$$\nThis expression represents the galaxy-galaxy power spectrum at quasi-linear scales, including the leading-order scale-dependent correction from the assembly bias effect modeled by the selection variable $\\alpha$.",
            "answer": "$$\n\\boxed{\\left[ (b_{1} + c_{\\alpha}R^{2})^{2} - c_{\\alpha}(b_{1} + c_{\\alpha}R^{2})R^{4}k^{2} \\right] P_{L}(k)}\n$$"
        },
        {
            "introduction": "This final practice bridges the gap between theory and observational reality, exploring how assembly bias can introduce significant systematic errors into cosmological parameter estimation. You will conduct a self-contained numerical experiment to quantify one such effect: a bias in the measurement of the Baryon Acoustic Oscillation (BAO) scale. By implementing a Subhalo Abundance Matching (SHAM) model that incorporates \"age matching,\" you will simulate a galaxy catalog where color is tied to formation history, and then measure how this selection systematically shifts the recovered BAO peak, demonstrating a critical challenge for next-generation surveys. ",
            "id": "3473083",
            "problem": "You are to implement a self-contained numerical experiment, grounded in the principles of SubHalo Abundance Matching (SHAM) and age matching, to quantify how galaxy assembly bias in color-selected samples can bias the inferred configuration-space Baryon Acoustic Oscillation (BAO) dilation parameter. The experiment involves generating a synthetic halo catalog with maximum circular velocities, assigning a formation redshift, performing age matching to tie galaxy color to formation redshift at fixed maximum circular velocity, constructing the galaxy two-point correlation function model in configuration space, and extracting the BAO dilation parameter by fitting a template. You will compute the shift in the BAO dilation parameter due to color selection as a single scalar per test case.\n\nThe foundational base consists of: the definition of the two-point correlation function $\\xi(r)$ in configuration space as the excess probability of finding a galaxy pair separated by comoving distance $r$ compared to a random distribution, the concept of linear Eulerian bias $b$ relating galaxy and matter fluctuations via $\\delta_{\\mathrm{g}} = b \\,\\delta_{\\mathrm{m}}$ at leading order, the notion of SubHalo Abundance Matching that ranks halos by a monotonic proxy at fixed comoving number density, and age matching that ties a secondary galaxy property to halo formation time at fixed halo proxy. The BAO dilation parameter $\\alpha_{\\mathrm{BAO}}$ rescales separations in the template $\\xi_{\\mathrm{m}}(\\alpha \\, r)$, and a bias in the recovered $\\alpha_{\\mathrm{BAO}}$ reflects a systematic shift in inferred distance scale.\n\nImplement the following steps and model choices, strictly in the units and forms specified:\n\n1. Generate a synthetic halo catalog of size $N$ halos with maximum circular velocity $V_{\\mathrm{max}}$ and formation redshift $z_{\\mathrm{f}}$:\n   - Draw $V_{\\mathrm{max}}$ from a truncated power-law probability density $p(V_{\\mathrm{max}}) \\propto V_{\\mathrm{max}}^{-\\beta}$ for $V_{\\mathrm{min}} \\le V_{\\mathrm{max}} \\le V_{\\mathrm{max,up}}$, with $V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$, $V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$, $\\beta = 3.5$, and $N = 10^5$.\n   - Draw a large-scale environment proxy $\\delta_{\\mathrm{env}}$ from a Gaussian with zero mean and variance $\\sigma_{\\mathrm{env}}^2$, where $\\sigma_{\\mathrm{env}} = 0.8$.\n   - Define the formation redshift as $z_{\\mathrm{f}} = z_0 + s_1 \\ln\\!\\left(V_{\\mathrm{max}}/V_0\\right) + s_2 \\delta_{\\mathrm{env}} + \\epsilon$, with $z_0 = 1.5$, $V_0 = 200\\,\\mathrm{km/s}$, $s_1 = 0.2$, $s_2 = 0.6$, and $\\epsilon$ drawn from a Gaussian with zero mean and variance $\\sigma_{z}^2$, where $\\sigma_{z} = 0.4$.\n   - Normalize the formation redshift to a dimensionless quantity $Z = \\left(z_{\\mathrm{f}} - \\overline{z_{\\mathrm{f}}}\\right)/\\sigma(z_{\\mathrm{f}})$, where $\\overline{z_{\\mathrm{f}}}$ is the sample mean and $\\sigma(z_{\\mathrm{f}})$ is the sample standard deviation.\n\n2. Implement age-matching SHAM color assignment at fixed $V_{\\mathrm{max}}$:\n   - Partition halos into bins in $V_{\\mathrm{max}}$ of width $\\Delta V = 20\\,\\mathrm{km/s}$ from $V_{\\mathrm{min}}$ to $V_{\\mathrm{max,up}}$.\n   - In each $V_{\\mathrm{max}}$ bin, sort halos by $z_{\\mathrm{f}}$ descending and assign the top fraction $f_{\\mathrm{red}}$ as \"red\" and the remainder as \"blue\" (you will only need the red selection for this problem).\n   - Compute the mean normalized formation redshift for the red sample $\\overline{Z}_{\\mathrm{red}}$ using all red-assigned halos across all bins.\n\n3. Model halo bias with assembly bias dependence at fixed $V_{\\mathrm{max}}$:\n   - Define mass-only halo bias $b_{\\mathrm{mass}}(V_{\\mathrm{max}}) = b_\\ast + c \\ln\\!\\left(V_{\\mathrm{max}}/V_0\\right)$ with $b_\\ast = 1.2$ and $c = 0.3$.\n   - Define assembly bias amplitude $A_{\\mathrm{ab}}$ such that the halo bias is $b_{\\mathrm{h}}(V_{\\mathrm{max}}, Z) = b_{\\mathrm{mass}}(V_{\\mathrm{max}})\\,\\left[1 + A_{\\mathrm{ab}}\\, Z\\right]$.\n   - Define the effective galaxy bias for the red sample $b_{\\mathrm{g,red}}$ as the mean of $b_{\\mathrm{h}}$ over the red-assigned halos. Define the effective galaxy bias for the full (all halos) sample $b_{\\mathrm{g,all}}$ analogously over all halos. These biases control amplitudes and are marginalized in the fit via a free template amplitude.\n\n4. Construct the matter correlation function template in configuration space in comoving distance $r$ in $\\mathrm{Mpc}/h$:\n   - Use a baseline smooth term $S(r) = -A_{\\mathrm{s}} / r^\\gamma$, with $A_{\\mathrm{s}} = 0.2$ and $\\gamma = 1.8$.\n   - Use a Gaussian BAO bump $W(r) = A_{\\mathrm{w}} \\exp\\!\\left[-\\dfrac{(r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right]$, with $A_{\\mathrm{w}} = 0.01$, $r_{\\mathrm{b}} = 105\\,\\mathrm{Mpc}/h$, and $\\sigma_{\\mathrm{w}} = 8\\,\\mathrm{Mpc}/h$.\n   - Define $\\xi_{\\mathrm{m}}(r) = S(r) + W(r)$.\n\n5. Construct the observed galaxy correlation functions:\n   - For the all-galaxies sample, define $\\xi_{\\mathrm{g,all}}(r) = b_{\\mathrm{g,all}}^2 \\,\\xi_{\\mathrm{m}}(r)$.\n   - For the red-selected sample, introduce an assembly-bias-induced BAO bump displacement $\\Delta r = k_{\\mathrm{shift}}\\,A_{\\mathrm{ab}}\\,\\overline{Z}_{\\mathrm{red}}$ and define $\\xi_{\\mathrm{g,red}}(r) = b_{\\mathrm{g,red}}^2 \\,\\left[S(r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\dfrac{(r - (r_{\\mathrm{b}} + \\Delta r))^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right]$. This form encodes a mild model mismatch between the data and the fiducial template that can bias the recovered dilation parameter.\n\n6. Estimate the BAO dilation parameters by fitting a template that rescales separations in the matter correlation while marginalizing broadband terms:\n   - Fit the model $\\xi_{\\mathrm{model}}(r;\\alpha,B,a_0,a_1,a_2) = B^2 \\left[S(\\alpha \\, r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\dfrac{(\\alpha \\, r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] + a_0 + \\dfrac{a_1}{r} + \\dfrac{a_2}{r^2}$ to each of $\\xi_{\\mathrm{g,all}}(r)$ and $\\xi_{\\mathrm{g,red}}(r)$ over the range $r \\in [60,140]\\,\\mathrm{Mpc}/h$ sampled at integer $r$.\n   - Use non-linear least squares to estimate $\\alpha$, $B$, $a_0$, $a_1$, and $a_2$, with physically sensible bounds $0.9 \\le \\alpha \\le 1.1$, $0.5 \\le B \\le 3.0$, $-1 \\le a_0 \\le 1$, $-10 \\le a_1 \\le 10$, $-100 \\le a_2 \\le 100$.\n   - The BAO shift to report is $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$ as a dimensionless decimal fraction.\n\n7. Required units and outputs:\n   - Distances $r$ must be in $\\mathrm{Mpc}/h$.\n   - Velocities $V_{\\mathrm{max}}$ must be in $\\mathrm{km/s}$.\n   - Formation redshift $z_{\\mathrm{f}}$ and normalized $Z$ are dimensionless.\n   - The final output $\\Delta \\alpha_{\\mathrm{BAO}}$ must be dimensionless and printed as a decimal rounded to six decimal places.\n\nYour program must produce a single line of output containing the results for the following test suite as a comma-separated list enclosed in square brackets, in the order listed. Each test case is defined by $(\\mathrm{seed}, f_{\\mathrm{red}}, A_{\\mathrm{ab}}, k_{\\mathrm{shift}})$:\n\n- Test $1$: $(42, 0.5, 0.2, 0.4)$\n- Test $2$: $(7, 0.3, 0.4, 0.6)$\n- Test $3$: $(13, 0.7, 0.0, 0.6)$\n- Test $4$: $(101, 0.1, 0.5, 0.3)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4]$), where each entry is $\\Delta \\alpha_{\\mathrm{BAO}}$ for the corresponding test case, rounded to six decimal places. No other output is permitted.",
            "solution": "The user-provided problem has been analyzed and is deemed valid. It constitutes a well-posed numerical experiment in the field of cosmology, grounded in established principles of large-scale structure analysis. The problem statement is self-contained, with all necessary parameters, models, and procedures specified unambiguously. It is free from scientific inaccuracies, logical contradictions, and subjective claims. We may therefore proceed with a solution.\n\nThe objective is to quantify the systematic bias on the Baryon Acoustic Oscillation (BAO) dilation parameter, $\\alpha_{\\mathrm{BAO}}$, induced by galaxy assembly bias when analyzing color-selected galaxy samples. The experiment simulates a synthetic halo catalog, assigns galaxy color based on halo formation age (age matching), models the correlation functions for different samples, and fits a template to extract $\\alpha_{\\mathrm{BAO}}$. The final output is the shift $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$.\n\nThe solution is implemented by following the sequence of steps specified in the problem statement.\n\n**Step 1: Synthetic Halo Catalog Generation**\n\nWe generate a synthetic catalog of $N = 10^5$ halos. Each halo is defined by its maximum circular velocity $V_{\\mathrm{max}}$, a large-scale environment proxy $\\delta_{\\mathrm{env}}$, and a formation redshift $z_{\\mathrm{f}}$.\n\n- The velocities $V_{\\mathrm{max}}$ are drawn from a truncated power-law probability density function $p(V_{\\mathrm{max}}) \\propto V_{\\mathrm{max}}^{-\\beta}$ over the interval $[V_{\\mathrm{min}}, V_{\\mathrm{max,up}}]$, with parameters $V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$, $V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$, and $\\beta = 3.5$. This is accomplished via inverse transform sampling. For a uniform random variate $u \\in [0, 1]$, the velocity is given by:\n$$ V_{\\mathrm{max}}(u) = \\left[ u \\left(V_{\\mathrm{max,up}}^{1-\\beta} - V_{\\mathrm{min}}^{1-\\beta}\\right) + V_{\\mathrm{min}}^{1-\\beta} \\right]^{\\frac{1}{1-\\beta}} $$\n- The environment proxy $\\delta_{\\mathrm{env}}$ for each halo is drawn from a Gaussian distribution with a mean of $0$ and a standard deviation of $\\sigma_{\\mathrm{env}} = 0.8$.\n- The formation redshift $z_{\\mathrm{f}}$ is then modeled as a function of $V_{\\mathrm{max}}$ and $\\delta_{\\mathrm{env}}$, including a stochastic component $\\epsilon$:\n$$ z_{\\mathrm{f}} = z_0 + s_1 \\ln\\!\\left(\\frac{V_{\\mathrm{max}}}{V_0}\\right) + s_2 \\delta_{\\mathrm{env}} + \\epsilon $$\nHere, $z_0 = 1.5$, $V_0 = 200\\,\\mathrm{km/s}$, $s_1 = 0.2$, and $s_2 = 0.6$. The stochastic term $\\epsilon$ is drawn from a Gaussian distribution with a mean of $0$ and a standard deviation of $\\sigma_{z} = 0.4$.\n- Finally, the formation redshift is normalized to a dimensionless quantity $Z$ for each halo by standardizing the sample:\n$$ Z = \\frac{z_{\\mathrm{f}} - \\overline{z_{\\mathrm{f}}}}{\\sigma(z_{\\mathrm{f}})} $$\nwhere $\\overline{z_{\\mathrm{f}}}$ and $\\sigma(z_{\\mathrm{f}})$ are the mean and standard deviation of the generated $z_{\\mathrm{f}}$ values, respectively.\n\n**Step 2: Age-Matching and Color Assignment**\n\nWe implement an age-matching scheme to assign a \"color\" to each halo, where color is a proxy for formation time.\n- The halo catalog is partitioned into bins of maximum circular velocity $V_{\\mathrm{max}}$, each of width $\\Delta V = 20\\,\\mathrm{km/s}$, from $V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$ to $V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$.\n- Within each $V_{\\mathrm{max}}$ bin, halos are sorted in descending order of their formation redshift $z_{\\mathrm{f}}$. Since older galaxies are typically redder, a higher $z_{\\mathrm{f}}$ (earlier formation) corresponds to a red galaxy.\n- The top fraction $f_{\\mathrm{red}}$ of halos in each bin are designated as \"red\". The value of $f_{\\mathrm{red}}$ is provided by each test case.\n- We then compute the mean normalized formation redshift, $\\overline{Z}_{\\mathrm{red}}$, by averaging the $Z$ values of all halos classified as red across all bins. This quantity, $\\overline{Z}_{\\mathrm{red}}$, measures the average formation epoch of the red galaxy sample relative to the full population.\n\n**Step 3: Halo Bias with Assembly Bias Dependence**\n\nThe clustering strength of halos, quantified by the halo bias $b_{\\mathrm{h}}$, is modeled to depend not only on mass (proxied by $V_{\\mathrm{max}}$) but also on formation time (proxied by $Z$), an effect known as assembly bias.\n- The mass-dependent component of the bias is given by a logarithmic relation:\n$$ b_{\\mathrm{mass}}(V_{\\mathrm{max}}) = b_\\ast + c \\ln\\!\\left(\\frac{V_{\\mathrm{max}}}{V_0}\\right) $$\nwith parameters $b_\\ast = 1.2$, $c = 0.3$, and $V_0 = 200\\,\\mathrm{km/s}$.\n- The full halo bias incorporates assembly bias through a linear dependence on the normalized formation redshift $Z$:\n$$ b_{\\mathrm{h}}(V_{\\mathrm{max}}, Z) = b_{\\mathrm{mass}}(V_{\\mathrm{max}})\\,\\left[1 + A_{\\mathrm{ab}}\\, Z\\right] $$\nwhere $A_{\\mathrm{ab}}$ is the assembly bias amplitude, a parameter specified by each test case.\n- The effective linear bias for the full galaxy sample, $b_{\\mathrm{g,all}}$, is the mean of $b_{\\mathrm{h}}$ over all halos. Similarly, the effective bias for the red galaxy sample, $b_{\\mathrm{g,red}}$, is the mean of $b_{\\mathrm{h}}$ over just the red-selected halos.\n\n**Step 4 & 5: Constructing the Galaxy Correlation Functions**\n\nWe model the two-point correlation function, $\\xi(r)$, which describes the excess probability of finding galaxy pairs at a comoving separation $r$.\n- A fiducial matter correlation function template, $\\xi_{\\mathrm{m}}(r)$, is constructed as the sum of a smooth power-law component $S(r)$ and a Gaussian BAO bump $W(r)$:\n$$ \\xi_{\\mathrm{m}}(r) = S(r) + W(r) = -\\frac{A_{\\mathrm{s}}}{r^\\gamma} + A_{\\mathrm{w}} \\exp\\!\\left[-\\frac{(r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right] $$\nwith parameters $A_{\\mathrm{s}} = 0.2$, $\\gamma = 1.8$, $A_{\\mathrm{w}} = 0.01$, $r_{\\mathrm{b}} = 105\\,\\mathrm{Mpc}/h$, and $\\sigma_{\\mathrm{w}} = 8\\,\\mathrm{Mpc}/h$.\n- The \"observed\" correlation function for the full galaxy sample is modeled using linear bias:\n$$ \\xi_{\\mathrm{g,all}}(r) = b_{\\mathrm{g,all}}^2 \\,\\xi_{\\mathrm{m}}(r) $$\n- For the red sample, assembly bias introduces a physical shift, $\\Delta r$, in the position of the BAO peak. This shift is proportional to the assembly bias strength and the mean age of the sample:\n$$ \\Delta r = k_{\\mathrm{shift}}\\,A_{\\mathrm{ab}}\\,\\overline{Z}_{\\mathrm{red}} $$\nwhere $k_{\\mathrm{shift}}$ is a parameter for each test case. The correlation function for the red sample is thus:\n$$ \\xi_{\\mathrm{g,red}}(r) = b_{\\mathrm{g,red}}^2 \\,\\left[S(r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\frac{(r - (r_{\\mathrm{b}} + \\Delta r))^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] $$\nThis mismatch between the true peak position in $\\xi_{\\mathrm{g,red}}(r)$ and the template peak position $r_b$ is the source of the systematic bias we aim to measure.\n\n**Step 6: Estimation of the BAO Dilation Parameter**\n\nThe BAO dilation parameter $\\alpha_{\\mathrm{BAO}}$ is extracted by fitting a model to the \"observed\" correlation functions, $\\xi_{\\mathrm{g,all}}(r)$ and $\\xi_{\\mathrm{g,red}}(r)$. The fitting model allows for a dilation of the separation axis, an overall amplitude scaling, and broadband nuisance terms to marginalize over uncertainties in the smooth shape:\n$$ \\xi_{\\mathrm{model}}(r;\\alpha,B,a_0,a_1,a_2) = B^2 \\left[S(\\alpha \\, r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\frac{(\\alpha \\, r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] + a_0 + \\frac{a_1}{r} + \\frac{a_2}{r^2} $$\n- Non-linear least squares fitting is performed over the range $r \\in [60, 140]\\,\\mathrm{Mpc}/h$ to find the best-fit parameters $(\\alpha, B, a_0, a_1, a_2)$.\n- The fits yield two dilation parameters: $\\alpha_{\\mathrm{all}}$ from fitting $\\xi_{\\mathrm{g,all}}(r)$, and $\\alpha_{\\mathrm{red}}$ from fitting $\\xi_{\\mathrm{g,red}}(r)$. For an unbiased measurement, we expect $\\alpha_{\\mathrm{all}} \\approx 1$. However, the physical shift $\\Delta r$ in the red sample's correlation function will cause the fit to return $\\alpha_{\\mathrm{red}} \\ne 1$.\n- The final result for each test case is the systematic shift in the BAO dilation parameter:\n$$ \\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}} $$\n\nThis value, a dimensionless decimal fraction, quantifies the error in the cosmological distance scale measurement caused by neglecting assembly bias in the analysis of the color-selected galaxy sample.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Main function to run the full analysis for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (seed, f_red, A_ab, k_shift)\n        (42, 0.5, 0.2, 0.4),\n        (7, 0.3, 0.4, 0.6),\n        (13, 0.7, 0.0, 0.6),\n        (101, 0.1, 0.5, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_alpha = _solve_single_case(*case)\n        results.append(delta_alpha)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef _solve_single_case(seed, f_red, A_ab, k_shift):\n    \"\"\"\n    Performs the numerical experiment for a single test case.\n    \"\"\"\n    # 1. Define model constants and generate halo catalog\n    # Catalog generation\n    N = 100000\n    V_min, V_max_up, beta = 100.0, 400.0, 3.5\n    # Formation redshift model\n    z0, V0, s1, s2 = 1.5, 200.0, 0.2, 0.6\n    sigma_env, sigma_z = 0.8, 0.4\n    # Age matching\n    delta_v_bin = 20.0\n    # Halo bias model\n    b_star, c = 1.2, 0.3\n    # Correlation function model\n    A_s, gamma = 0.2, 1.8\n    A_w, r_b, sigma_w = 0.01, 105.0, 8.0\n\n    rng = np.random.default_rng(seed)\n\n    # Generate V_max from a truncated power law using inverse transform sampling\n    u = rng.uniform(size=N)\n    inv_beta_m1 = 1.0 / (1.0 - beta)\n    v_min_pow = V_min**(1.0 - beta)\n    v_max_pow = V_max_up**(1.0 - beta)\n    V_max = (v_min_pow + u * (v_max_pow - v_min_pow))**inv_beta_m1\n\n    # Generate formation redshift z_f\n    delta_env = rng.normal(loc=0.0, scale=sigma_env, size=N)\n    epsilon = rng.normal(loc=0.0, scale=sigma_z, size=N)\n    z_f = z0 + s1 * np.log(V_max / V0) + s2 * delta_env + epsilon\n\n    # Normalize formation redshift\n    Z = (z_f - np.mean(z_f)) / np.std(z_f)\n\n    # 2. Implement age-matching SHAM\n    v_bins = np.arange(V_min, V_max_up + delta_v_bin, delta_v_bin)\n    bin_indices = np.digitize(V_max, bins=v_bins)\n    \n    red_halo_indices = []\n    for i in range(1, len(v_bins)):\n        halos_in_bin_mask = (bin_indices == i)\n        halos_in_bin_idx = np.where(halos_in_bin_mask)[0]\n        \n        if len(halos_in_bin_idx) == 0:\n            continue\n            \n        z_f_in_bin = z_f[halos_in_bin_idx]\n        # Sort halos in bin by z_f descending to find the \"oldest\"\n        sorted_indices = np.argsort(z_f_in_bin)[::-1]\n        \n        # Select the top f_red fraction as \"red\"\n        n_red_in_bin = int(len(halos_in_bin_idx) * f_red)\n        red_indices_in_bin = halos_in_bin_idx[sorted_indices[:n_red_in_bin]]\n        red_halo_indices.extend(red_indices_in_bin)\n    \n    red_halo_indices = np.array(red_halo_indices)\n    mean_Z_red = np.mean(Z[red_halo_indices])\n\n    # 3. Model halo bias\n    b_mass = b_star + c * np.log(V_max / V0)\n    b_h = b_mass * (1.0 + A_ab * Z)\n    \n    b_g_all = np.mean(b_h)\n    b_g_red = np.mean(b_h[red_halo_indices])\n\n    # 4 & 5. Construct the galaxy correlation functions\n    r_vals = np.arange(60, 141)\n\n    def S_func(r_): return -A_s / r_**gamma\n    def W_func(r_): return A_w * np.exp(-(r_ - r_b)**2 / (2.0 * sigma_w**2))\n    \n    xi_m = S_func(r_vals) + W_func(r_vals)\n    xi_g_all = b_g_all**2 * xi_m\n    \n    delta_r = k_shift * A_ab * mean_Z_red\n    xi_g_red = b_g_red**2 * (S_func(r_vals) + A_w * np.exp(-(r_vals - (r_b + delta_r))**2 / (2.0 * sigma_w**2)))\n    \n    # 6. Estimate BAO dilation parameters via fitting\n    def xi_model(r, alpha, B, a0, a1, a2):\n        S_fit = -A_s / (alpha * r)**gamma\n        W_fit = A_w * np.exp(-(alpha * r - r_b)**2 / (2.0 * sigma_w**2))\n        poly = a0 + a1 / r + a2 / r**2\n        return B**2 * (S_fit + W_fit) + poly\n        \n    bounds = ([0.9, 0.5, -1., -10., -100.], [1.1, 3.0, 1., 10., 100.])\n    \n    # Fit all-galaxies sample\n    popt_all, _ = curve_fit(xi_model, r_vals, xi_g_all, bounds=bounds, method='trf')\n    alpha_all = popt_all[0]\n    \n    # Fit red-selected sample\n    popt_red, _ = curve_fit(xi_model, r_vals, xi_g_red, bounds=bounds, method='trf')\n    alpha_red = popt_red[0]\n    \n    # Calculate the shift\n    delta_alpha_bao = alpha_red - alpha_all\n    \n    return delta_alpha_bao\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}