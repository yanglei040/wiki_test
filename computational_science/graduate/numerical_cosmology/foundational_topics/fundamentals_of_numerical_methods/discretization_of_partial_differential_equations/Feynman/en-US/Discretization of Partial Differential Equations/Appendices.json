{
    "hands_on_practices": [
        {
            "introduction": "Cosmological simulations often involve physical processes with vastly different timescales, leading to \"stiff\" systems of equations that are challenging to solve efficiently. Implicit-Explicit (IMEX) methods are a powerful strategy, treating stiff terms implicitly for stability and non-stiff terms explicitly for speed. This exercise  lays the theoretical groundwork by having you perform a linear stability analysis on a fundamental IMEX scheme, a critical first step in designing any robust time integrator.",
            "id": "3470353",
            "problem": "Consider a semi-discrete method-of-lines approximation to a linearized cosmological fluid mode in comoving coordinates, where a single Fourier mode amplitude $u(t)$ obeys the ordinary differential equation $\\partial_{t} u(t) = -\\lambda u(t) - \\mu u(t)$ with constant rates $\\lambda \\geq 0$ and $\\mu \\geq 0$ measured in $\\mathrm{s}^{-1}$. Here, $\\lambda$ arises from the explicitly treated non-stiff transport operator (e.g., comoving advection or source coupling), and $\\mu$ arises from a stiff damping operator (e.g., Hubble drag or collision term) treated implicitly. Employ a first-order Implicit-Explicit (IMEX) method where the explicit part uses forward Euler for the $\\lambda$ contribution and the implicit part uses backward Euler for the $\\mu$ contribution in a single combined time step of size $\\Delta t$. Assume that the explicit and implicit operators commute on this mode, so that their eigenvalues add, and that the underlying spatial discretization yields real nonnegative spectral rates.\n\nStarting from the semi-discrete evolution law and the described IMEX time discretization, derive the single-step amplification factor and use it to determine the combined linear stability requirement for this IMEX update in terms of $\\lambda$, $\\mu$, and $\\Delta t$. Under the assumption $0 \\leq \\mu < \\lambda$, compute the largest allowable time step $\\Delta t_{\\max}$ such that the update is linearly stable for all $\\Delta t$ in the interval $0 \\leq \\Delta t \\leq \\Delta t_{\\max}$. Express your final answer as a closed-form analytic expression for $\\Delta t_{\\max}$ in seconds. No numerical evaluation is required, and no rounding should be performed.",
            "solution": "The problem will first be validated for scientific and mathematical soundness, completeness, and clarity.\n\n### Step 1: Extract Givens\n- The semi-discrete evolution equation for a single Fourier mode amplitude $u(t)$ is $\\partial_{t} u(t) = -\\lambda u(t) - \\mu u(t)$.\n- The rates $\\lambda$ and $\\mu$ are constants, satisfying $\\lambda \\geq 0$ and $\\mu \\geq 0$, with units of $\\mathrm{s}^{-1}$.\n- The term $-\\lambda u(t)$ arises from a non-stiff operator and is treated explicitly.\n- The term $-\\mu u(t)$ arises from a stiff operator and is treated implicitly.\n- The time-stepping scheme is a first-order Implicit-Explicit (IMEX) method.\n- The explicit part (for $\\lambda$) uses the forward Euler method.\n- The implicit part (for $\\mu$) uses the backward Euler method.\n- The time step size is denoted by $\\Delta t$.\n- It is assumed that the explicit and implicit operators commute.\n- It is assumed that the underlying spatial discretization yields real, non-negative spectral rates.\n- The final calculation is performed under the assumption $0 \\leq \\mu < \\lambda$.\n- The goal is to derive the single-step amplification factor, the linear stability requirement, and the largest allowable stable time step $\\Delta t_{\\max}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically and mathematically sound. It describes the linear stability analysis of a standard first-order IMEX (Forward Euler/Backward Euler) scheme applied to a linear ordinary differential equation, which is a fundamental technique in numerical analysis for solving stiff differential equations. Such equations are common models for physical phenomena, including linearized cosmological perturbations. There are no violations of scientific principles.\n2.  **Non-Formalizable or Irrelevant**: The problem is highly formalizable and is directly relevant to the topic of discretizing partial differential equations, a core concern in numerical cosmology.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained and provides all necessary information to perform the derivation. The ODE, the numerical method, the parameters, and all required assumptions are explicitly stated. There are no internal contradictions.\n4.  **Unrealistic or Infeasible**: The setup is a standard, simplified model (Dahlquist's test equation) used to analyze the stability of numerical methods. It is mathematically feasible and represents a valid idealization of a more complex physical system.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. It asks for a definite mathematical derivation that leads to a unique and meaningful result. All terms are standard in the field of numerical analysis.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem is a standard, non-trivial exercise in numerical stability theory. It requires a correct application of definitions and algebraic manipulation.\n7.  **Outside Scientific Verifiability**: The derivation is purely mathematical and is therefore verifiable by logical and algebraic rules.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will now be provided.\n\n### Derivation of the Solution\nThe semi-discrete ordinary differential equation (ODE) governing the evolution of the mode amplitude $u(t)$ is given by:\n$$\n\\frac{d u}{d t} = -\\lambda u - \\mu u\n$$\nWe discretize this equation in time using a single step of size $\\Delta t$. Let $u^n$ represent the numerical approximation to $u(t_n)$ at time $t_n = n \\Delta t$. The next state is $u^{n+1}$ at time $t_{n+1} = t_n + \\Delta t$.\n\nThe problem specifies a first-order IMEX scheme. The term $-\\lambda u$ is treated explicitly using the forward Euler method, meaning it is evaluated at time $t_n$. The term $-\\mu u$ is treated implicitly using the backward Euler method, meaning it is evaluated at time $t_{n+1}$. Combining these, the finite difference approximation to the ODE is:\n$$\n\\frac{u^{n+1} - u^n}{\\Delta t} = -\\lambda u^n - \\mu u^{n+1}\n$$\nOur first goal is to find the single-step amplification factor, $g(\\lambda, \\mu, \\Delta t)$, which is defined by the relation $u^{n+1} = g \\cdot u^n$. To find $g$, we must rearrange the discretized equation to solve for $u^{n+1}$ in terms of $u^n$.\n\nStarting with the discretized equation:\n$$\nu^{n+1} - u^n = \\Delta t (-\\lambda u^n - \\mu u^{n+1})\n$$\nWe gather all terms involving $u^{n+1}$ on the left side and all terms involving $u^n$ on the right side:\n$$\nu^{n+1} + \\mu \\Delta t u^{n+1} = u^n - \\lambda \\Delta t u^n\n$$\nFactoring out $u^{n+1}$ and $u^n$:\n$$\nu^{n+1} (1 + \\mu \\Delta t) = u^n (1 - \\lambda \\Delta t)\n$$\nSolving for $u^{n+1}$ yields:\n$$\nu^{n+1} = \\left( \\frac{1 - \\lambda \\Delta t}{1 + \\mu \\Delta t} \\right) u^n\n$$\nBy definition, the expression in the parenthesis is the amplification factor $g$:\n$$\ng(\\lambda, \\mu, \\Delta t) = \\frac{1 - \\lambda \\Delta t}{1 + \\mu \\Delta t}\n$$\nFor the numerical method to be linearly stable, the magnitude of the amplification factor must not exceed unity. That is, the stability requirement is:\n$$\n|g| \\leq 1\n$$\nSubstituting the expression for $g$:\n$$\n\\left| \\frac{1 - \\lambda \\Delta t}{1 + \\mu \\Delta t} \\right| \\leq 1\n$$\nThe problem states that $\\mu \\geq 0$ and the time step $\\Delta t$ is non-negative, so $\\Delta t \\geq 0$. Therefore, the denominator $1 + \\mu \\Delta t$ is always positive and greater than or equal to $1$. We can multiply both sides of the inequality by $1 + \\mu \\Delta t$ without changing the direction of the inequality:\n$$\n|1 - \\lambda \\Delta t| \\leq 1 + \\mu \\Delta t\n$$\nThis absolute value inequality is equivalent to the pair of inequalities:\n$$\n-(1 + \\mu \\Delta t) \\leq 1 - \\lambda \\Delta t \\leq 1 + \\mu \\Delta t\n$$\nWe must satisfy both inequalities simultaneously.\n\nLet's analyze the right-hand inequality first:\n$$\n1 - \\lambda \\Delta t \\leq 1 + \\mu \\Delta t\n$$\n$$\n-\\lambda \\Delta t \\leq \\mu \\Delta t\n$$\n$$\n0 \\leq (\\lambda + \\mu) \\Delta t\n$$\nSince $\\lambda \\geq 0$, $\\mu \\geq 0$, and $\\Delta t \\geq 0$, this condition is always satisfied and imposes no upper bound on $\\Delta t$.\n\nNow, let's analyze the left-hand inequality:\n$$\n-(1 + \\mu \\Delta t) \\leq 1 - \\lambda \\Delta t\n$$\n$$\n-1 - \\mu \\Delta t \\leq 1 - \\lambda \\Delta t\n$$\nRearranging the terms to isolate $\\Delta t$:\n$$\n\\lambda \\Delta t - \\mu \\Delta t \\leq 1 + 1\n$$\n$$\n(\\lambda - \\mu) \\Delta t \\leq 2\n$$\nThis is the general linear stability requirement for the IMEX scheme.\n\nThe final part of the problem asks for the largest allowable time step, $\\Delta t_{\\max}$, under the specific assumption that $0 \\leq \\mu < \\lambda$. This assumption implies that the term $(\\lambda - \\mu)$ is strictly positive. Since $(\\lambda - \\mu) > 0$, we can divide the stability inequality by it without changing the direction of the inequality:\n$$\n\\Delta t \\leq \\frac{2}{\\lambda - \\mu}\n$$\nThis inequality must hold for the method to be stable. The problem asks for the largest allowable time step $\\Delta t_{\\max}$ such that the update is linearly stable for all $\\Delta t$ in the interval $0 \\leq \\Delta t \\leq \\Delta t_{\\max}$. This implies that $\\Delta t_{\\max}$ is the upper bound of this stable range.\nTherefore, the largest allowable time step is:\n$$\n\\Delta t_{\\max} = \\frac{2}{\\lambda - \\mu}\n$$\nThe units of $\\lambda$ and $\\mu$ are $\\mathrm{s}^{-1}$, so the units of $\\Delta t_{\\max}$ are $1 / (\\mathrm{s}^{-1}) = \\mathrm{s}$, which is consistent with the problem's request.",
            "answer": "$$\n\\boxed{\\frac{2}{\\lambda - \\mu}}\n$$"
        },
        {
            "introduction": "When simulating cosmological fluids, sharp features like shock fronts can cause standard high-order numerical methods to produce spurious, non-physical oscillations. To capture these features cleanly, Total Variation Diminishing (TVD) schemes are essential. This practice  focuses on a key component of these schemes—the slope limiter—allowing you to directly apply the minmod limiter to prevent the creation of new extrema and understand its role in maintaining physically realistic solutions.",
            "id": "3470385",
            "problem": "Consider the one-dimensional comoving mass conservation law for a pressureless fluid in an expanding Universe, written in conservative form for a generic conserved variable $q(x,t)$ as $\\partial_t q + \\partial_x f(q,t) = 0$, where $x$ is a comoving coordinate and $t$ is cosmic time. On a uniform mesh with spacing $\\Delta x = 1$ (arbitrary units), a second-order finite-volume method reconstructs piecewise-linear profiles inside each cell using a Total Variation Diminishing (TVD) slope limiter to prevent spurious oscillations in the presence of cosmological shocks and rarefactions.\n\nAt a given time, the cell-averaged values in three consecutive cells are $q_{i-1} = 1.00$, $q_i = 1.06$, and $q_{i+1} = 1.09$. You are asked to perform a TVD piecewise-linear reconstruction in cell $i$ using the generalized minmod limiter with parameter $\\theta = \\frac{3}{2}$ and to determine the limited slope $\\sigma_i$ to be used in the linear reconstruction $q_i(x) \\approx q_i + \\sigma_i (x - x_i)$ over cell $i$.\n\nUsing only fundamental principles of conservation laws and the definition of total variation, explain why and how this limiter choice affects the discrete total variation $\\mathrm{TV}(q) = \\sum_j |q_{j+1} - q_j|$ in a high-resolution finite-volume update. Your explanation should clarify whether the reconstruction step can increase the discrete total variation over these three cells and the mechanism by which the limiter prevents the creation of new extrema in the reconstructed interface states.\n\nCompute the limited slope $\\sigma_i$ and provide it as your final numerical answer. Do not include units. No rounding is required.",
            "solution": "The problem is valid. It is scientifically grounded in the theory of numerical methods for hyperbolic conservation laws, is well-posed with sufficient information, and uses objective, formal language. We may proceed with the solution.\n\nThe problem asks for the computation of a limited slope $\\sigma_i$ for a piecewise-linear data reconstruction in a finite-volume scheme and an explanation of the role of the slope limiter in maintaining the Total Variation Diminishing (TVD) property.\n\nFirst, let us address the conceptual part of the problem. The governing equation, $\\partial_t q + \\partial_x f(q,t) = 0$, is a hyperbolic conservation law. Solutions to such equations can develop discontinuities (shocks), even from smooth initial data. Numerical methods of second-order or higher, if not carefully designed, tend to produce spurious, non-physical oscillations near these discontinuities. The Total Variation Diminishing (TVD) property is a crucial design criterion for numerical schemes to capture shocks without introducing such oscillations.\n\nThe total variation of the discrete, cell-averaged data is defined as $\\mathrm{TV}(q) = \\sum_j |q_{j+1} - q_j|$. A numerical scheme is called TVD if the total variation of the solution does not increase from one time step to the next, i.e., $\\mathrm{TV}(q^{n+1}) \\le \\mathrm{TV}(q^n)$, where $q^n$ denotes the vector of cell averages at time step $n$.\n\nHigh-resolution finite-volume methods achieve the TVD property by carefully constraining the data reconstruction step. At this stage, a higher-order, piecewise polynomial representation of the data is constructed within each cell from the cell averages. For the specified piecewise-linear reconstruction, the profile in cell $i$ is given by $q_i(x) \\approx q_i + \\sigma_i (x - x_i)$, where $q_i$ is the cell-averaged value and $\\sigma_i$ is the slope.\n\nThe reconstruction step itself does not alter the cell averages $\\{q_j\\}$, and therefore it does not change the discrete total variation $\\mathrm{TV}(q)$. The role of the slope limiter is prophylactic: it constrains the slope $\\sigma_i$ to ensure that the subsequent evolution step, which uses the reconstructed interface values to compute fluxes, will not increase the total variation.\n\nThe mechanism by which the limiter prevents the eventual increase of total variation is by enforcing a local monotonicity principle. It prevents the creation of new local extrema in the reconstructed data. The reconstructed values at the interfaces of cell $i$, located at $x_{i-1/2}$ and $x_{i+1/2}$, must be bounded by the average values of the cells they separate. The value at the right interface of cell $i$, let's call it $q_{i+1/2}^L$, is computed from the reconstruction in cell $i$ as $q_i(x_{i+1/2}) = q_i + \\sigma_i \\frac{\\Delta x}{2}$. This value is used to compute the flux $f_{i+1/2}$. A new extremum would be created if, for instance, $q_i < q_{i+1}$ but the reconstructed value $q_{i+1/2}^L$ is greater than $q_{i+1}$. This is called an overshoot. A TVD limiter for $\\sigma_i$ is designed precisely to prevent such overshoots and undershoots. By doing so, it guarantees that the numerical fluxes computed from these reconstructed states will lead to a TVD update.\n\nNow, we compute the limited slope $\\sigma_i$. We are given the cell averages $q_{i-1} = 1.00$, $q_i = 1.06$, and $q_{i+1} = 1.09$. The uniform mesh spacing is $\\Delta x = 1$. The reconstruction uses the generalized minmod limiter with parameter $\\theta = \\frac{3}{2}$.\n\nFirst, we define the relevant undivided difference slopes based on the cell-averaged data:\nThe backward difference slope is $\\Delta_b = \\frac{q_i - q_{i-1}}{\\Delta x}$.\nThe forward difference slope is $\\Delta_f = \\frac{q_{i+1} - q_i}{\\Delta x}$.\nThe centered difference slope, which corresponds to an unlimited second-order reconstruction, is $\\Delta_c = \\frac{q_{i+1} - q_{i-1}}{2\\Delta x}$.\n\nLet's compute these values:\n$\\Delta_b = \\frac{1.06 - 1.00}{1} = 0.06$\n$\\Delta_f = \\frac{1.09 - 1.06}{1} = 0.03$\n$\\Delta_c = \\frac{1.09 - 1.00}{2 \\times 1} = \\frac{0.09}{2} = 0.045$\n\nThe generalized minmod limiter is a function that selects a slope based on these candidates. A common form for MUSCL-type schemes, which we adopt here, is to limit the centered slope by the scaled forward and backward slopes:\n$\\sigma_i = \\text{minmod}(\\theta \\Delta_b, \\Delta_c, \\theta \\Delta_f)$\n\nThe minmod function is defined as:\n$\\text{minmod}(a_1, a_2, \\dots, a_n) = \\begin{cases} \\min(a_1, a_2, \\dots, a_n) & \\text{if } a_j > 0 \\text{ for all } j \\\\ \\max(a_1, a_2, \\dots, a_n) & \\text{if } a_j < 0 \\text{ for all } j \\\\ 0 & \\text{otherwise (mixed signs)} \\end{cases}$\n\nWe need to compute the arguments for the minmod function using $\\theta = \\frac{3}{2} = 1.5$:\n$1$. $\\theta \\Delta_b = 1.5 \\times 0.06 = 0.09$\n$2$. $\\Delta_c = 0.045$\n$3$. $\\theta \\Delta_f = 1.5 \\times 0.03 = 0.045$\n\nAll three arguments, $0.09$, $0.045$, and $0.045$, are positive. Therefore, the minmod function will return their minimum value.\n$\\sigma_i = \\min(0.09, 0.045, 0.045)$\n$\\sigma_i = 0.045$\n\nThe unlimited centered slope is $\\Delta_c = 0.045$. The limiting slopes derived from the neighbors are $\\theta\\Delta_b = 0.09$ and $\\theta\\Delta_f = 0.045$. The function selects the slope with the smallest magnitude to ensure the TVD property, which in this case is $0.045$. The resulting limited slope for the reconstruction in cell $i$ is $\\sigma_i = 0.045$.",
            "answer": "$$\\boxed{0.045}$$"
        },
        {
            "introduction": "A major challenge in numerical cosmology is accurately simulating small perturbations on top of a dominant, evolving background. A naive discretization can introduce errors that act as spurious physical sources, a phenomenon known as 'discrete backreaction.' This advanced exercise  tasks you with implementing and testing a 'well-balanced' scheme, a technique designed to exactly preserve known equilibrium solutions and thus eliminate this subtle yet critical source of numerical error.",
            "id": "3470344",
            "problem": "Consider linear scalar perturbations in the Newtonian gauge for a matter-dominated Friedmann–Lemaître–Robertson–Walker (FLRW) universe. Focus on a single Fourier mode with wave number $k$ and the continuity equation for the density contrast $\\delta$ in conformal time $\\tau$,\n$$\n\\delta'(\\tau) = -\\theta(\\tau) + 3\\,\\Phi'(\\tau),\n$$\nwhere $\\theta$ is the velocity divergence and $\\Phi$ is the Bardeen potential. Work in the Einstein–de Sitter limit with scale factor $a(\\tau)\\propto \\tau^2$ and conformal Hubble parameter $\\mathcal{H}(\\tau)=2/\\tau$, and restrict attention to the sub-problem in which the potential is physically constant in time,\n$$\n\\Phi(\\tau) = \\Phi_0,\n$$\nso that the physical source $3\\,\\Phi'(\\tau)$ vanishes identically. Assume the growing mode with an exact density contrast and velocity divergence given by\n$$\n\\delta_{\\text{exact}}(\\tau) = D_0\\,\\tau^2,\\quad \\theta_{\\text{exact}}(\\tau) = -2 D_0\\,\\tau,\n$$\nwhich satisfies the continuity equation with $\\Phi'(\\tau)=0$. All quantities are dimensionless.\n\nYou will investigate discrete backreaction: how a model truncation error corrupting the discrete representation of $\\Phi$ induces spurious growth in $\\delta$ via the coupling $3\\,\\Phi'(\\tau)$, and design a corrective source balancing that eliminates this spurious growth at the discrete level.\n\nModel the discrete representation of $\\Phi$ sampled at grid points $\\tau_n=\\tau_0+n\\,\\Delta \\tau$ by\n$$\n\\Phi^{\\text{num}}(\\tau_n) = \\Phi_0 + \\eta(\\tau_n),\\quad \\eta(\\tau) = C\\,(\\Delta \\tau)^p \\sin(\\omega \\tau),\n$$\nwhere $C$ is an amplitude, $p$ is the formal order of the truncation error, and $\\omega$ is a fixed angular frequency. This $\\eta(\\tau)$ represents a deterministic surrogate of truncation error that decays as a power of the time step $\\Delta \\tau$.\n\nTask 1 (Derivation): Starting from the continuity equation and employing only the fundamental base laws above, derive:\n\n- A consistent second-order-in-time discrete update for $\\delta$ on a uniform grid that uses the midpoint rule for the $-\\theta$ term, and approximates $3\\,\\Phi'$ at the half-step by a centered discrete slope from the noisy samples $\\Phi^{\\text{num}}(\\tau_n)$ and $\\Phi^{\\text{num}}(\\tau_{n+1})$.\n- A corrective, well-balanced source discretization that exactly preserves the steady state associated with $3\\,\\Phi'(\\tau)=0$ even when $\\Phi^{\\text{num}}$ contains the modeled truncation error above. The design must start from a conservation-compatible representation of the integral of $3\\,\\Phi'$ over a time step and must not rely on cancelling errors empirically.\n\nTask 2 (Implementation): Implement both updates over the interval $\\tau\\in[\\tau_0,\\tau_f]$ with initial condition $\\delta(\\tau_0)=\\delta_{\\text{exact}}(\\tau_0)$:\n\n- The naive-midpoint scheme that uses the midpoint rule for $-\\theta$ and a centered difference based on the noisy $\\Phi^{\\text{num}}$ for $3\\,\\Phi'$.\n- The balanced-source scheme that uses the midpoint rule for $-\\theta$ and the conservation-compatible representation from Task 1 for the $3\\,\\Phi'$ contribution that eliminates spurious growth when $\\Phi(\\tau)$ is physically constant.\n\nUse the following parameter values for the cosmological background and truncation-error surrogate:\n$$\n\\tau_0=1.0,\\quad \\tau_f=2.0,\\quad D_0=0.1,\\quad \\Phi_0=10^{-5},\\quad \\omega=5.0.\n$$\n\nFor each run, compute the absolute fractional error at final time,\n$$\nE_{\\text{naive}}=\\frac{\\left|\\delta_{\\text{naive}}(\\tau_f)-\\delta_{\\text{exact}}(\\tau_f)\\right|}{\\left|\\delta_{\\text{exact}}(\\tau_f)\\right|},\\qquad\nE_{\\text{bal}}=\\frac{\\left|\\delta_{\\text{bal}}(\\tau_f)-\\delta_{\\text{exact}}(\\tau_f)\\right|}{\\left|\\delta_{\\text{exact}}(\\tau_f)\\right|}.\n$$\n\nTask 3 (Test Suite): Run your implementation on the following test suite, where each case is specified by $(\\Delta \\tau, p, C)$:\n\n- Case A (coarse step, second-order error): $(\\Delta \\tau, p, C)=(0.1,\\,2,\\,1.0)$.\n- Case B (refined step, second-order error): $(\\Delta \\tau, p, C)=(0.05,\\,2,\\,1.0)$.\n- Case C (refined step, third-order error): $(\\Delta \\tau, p, C)=(0.05,\\,3,\\,1.0)$.\n- Case D (no truncation error): $(\\Delta \\tau, p, C)=(0.05,\\,2,\\,0.0)$.\n\nAll quantities are dimensionless; report numerical results as floating-point numbers with no units. Round all reported errors to $12$ decimal places.\n\nFinal Output Format: Your program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, in the order of the cases above, where each inner list is $[E_{\\text{naive}},E_{\\text{bal}}]$. For example, the format must be exactly\n$$\n\\big[\\,[e_{A}^{\\text{naive}},e_{A}^{\\text{bal}}],[e_{B}^{\\text{naive}},e_{B}^{\\text{bal}}],[e_{C}^{\\text{naive}},e_{C}^{\\text{bal}}],[e_{D}^{\\text{naive}},e_{D}^{\\text{bal}}]\\,\\big].\n$$",
            "solution": "The analysis begins with the validation of the problem statement. All provided information is extracted verbatim and subsequently assessed for scientific consistency, completeness, and objectivity.\n\n### Step 1: Extract Givens\n- **Governing Equation:** The continuity equation for the density contrast $\\delta$ is $\\delta'(\\tau) = -\\theta(\\tau) + 3\\,\\Phi'(\\tau)$.\n- **Cosmological Model:** A matter-dominated FLRW universe in the Einstein–de Sitter limit, where $a(\\tau)\\propto \\tau^2$ and $\\mathcal{H}(\\tau)=2/\\tau$.\n- **Physical State:** The Bardeen potential is physically constant, $\\Phi(\\tau) = \\Phi_0$, implying the physical source term $3\\,\\Phi'(\\tau)$ is zero.\n- **Exact Analytical Solution:** The growing mode solution is given by $\\delta_{\\text{exact}}(\\tau) = D_0\\,\\tau^2$ and $\\theta_{\\text{exact}}(\\tau) = -2 D_0\\,\\tau$.\n- **Numerical Grid:** A uniform time grid with points $\\tau_n = \\tau_0+n\\,\\Delta \\tau$.\n- **Numerical Potential Model:** The potential sampled on the grid is corrupted by a deterministic error surrogate: $\\Phi^{\\text{num}}(\\tau_n) = \\Phi_0 + \\eta(\\tau_n)$, with $\\eta(\\tau) = C\\,(\\Delta \\tau)^p \\sin(\\omega \\tau)$.\n- **Task 1 (Derivation):** Derive a naive-midpoint discrete update and a corrective, well-balanced source update for $\\delta(\\tau)$.\n- **Task 2 (Implementation):** Implement both schemes on the interval $\\tau\\in[\\tau_0,\\tau_f]$ with the initial condition $\\delta(\\tau_0)=\\delta_{\\text{exact}}(\\tau_0)$.\n- **Parameters:** $\\tau_0=1.0$, $\\tau_f=2.0$, $D_0=0.1$, $\\Phi_0=10^{-5}$, $\\omega=5.0$.\n- **Error Metric:** $E = \\frac{\\left|\\delta_{\\text{num}}(\\tau_f)-\\delta_{\\text{exact}}(\\tau_f)\\right|}{\\left|\\delta_{\\text{exact}}(\\tau_f)\\right|}$.\n- **Test Suite:** Case A: $(\\Delta \\tau, p, C)=(0.1,\\,2,\\,1.0)$; Case B: $(\\Delta \\tau, p, C)=(0.05,\\,2,\\,1.0)$; Case C: $(\\Delta \\tau, p, C)=(0.05,\\,3,\\,1.0)$; Case D: $(\\Delta \\tau, p, C)=(0.05,\\,2,\\,0.0)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in standard cosmological perturbation theory and numerical analysis. The concepts of truncation error and well-balanced schemes are central to computational physics. The problem is well-posed, providing a first-order ordinary differential equation with an initial condition and all necessary parameters. The language is precise and objective. The setup is a simplified but conceptually rich model problem designed to illustrate a specific numerical principle, and it is free of any scientific flaws, contradictions, or ambiguities.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\n### Principle-Based Solution and Derivation\n\nThe fundamental equation to be solved is the continuity equation for the density contrast $\\delta$:\n$$\n\\frac{d\\delta}{d\\tau} = -\\theta(\\tau) + 3\\frac{d\\Phi}{d\\tau}\n$$\nTo construct a numerical scheme, we integrate this equation over a single time step from $\\tau_n$ to $\\tau_{n+1} = \\tau_n + \\Delta\\tau$:\n$$\n\\int_{\\tau_n}^{\\tau_{n+1}} \\frac{d\\delta}{d\\tau} d\\tau = \\int_{\\tau_n}^{\\tau_{n+1}} \\left( -\\theta(\\tau) + 3\\frac{d\\Phi}{d\\tau} \\right) d\\tau\n$$\nApplying the fundamental theorem of calculus to the left-hand side and the integral of $\\Phi'$ yields an exact relation:\n$$\n\\delta(\\tau_{n+1}) - \\delta(\\tau_n) = -\\int_{\\tau_n}^{\\tau_{n+1}} \\theta(\\tau) d\\tau + 3\\left[ \\Phi(\\tau_{n+1}) - \\Phi(\\tau_n) \\right]\n$$\nLet $\\delta_n$ denote the numerical approximation of $\\delta(\\tau_n)$. A general, one-step numerical update can be written as:\n$$\n\\delta_{n+1} = \\delta_n - \\left( \\int_{\\tau_n}^{\\tau_{n+1}} \\theta(\\tau) d\\tau \\right)_{\\text{disc}} + \\left( 3\\left[ \\Phi_{n+1} - \\Phi_n \\right] \\right)_{\\text{disc}}\n$$\nwhere the subscript 'disc' indicates a discrete approximation of the term.\n\nThe problem specifies using the second-order midpoint rule for the $\\theta$ integral:\n$$\n\\left( \\int_{\\tau_n}^{\\tau_{n+1}} \\theta(\\tau) d\\tau \\right)_{\\text{disc}} = \\Delta\\tau \\cdot \\theta(\\tau_{n+1/2})\n$$\nwhere $\\tau_{n+1/2} = \\tau_n + \\Delta\\tau/2$. Using the provided exact form $\\theta_{\\text{exact}}(\\tau) = -2 D_0 \\tau$, we have:\n$$\n\\Delta\\tau \\cdot \\theta(\\tau_{n+1/2}) = \\Delta\\tau \\cdot (-2 D_0 (\\tau_n + \\Delta\\tau/2)) = -2 D_0 \\tau_n \\Delta\\tau - D_0 (\\Delta\\tau)^2\n$$\nIt is a crucial observation that this midpoint quadrature is exact for the given $\\theta(\\tau)$, since the exact integral is $\\int_{\\tau_n}^{\\tau_{n+1}} (-2D_0\\tau) d\\tau = -D_0(\\tau_{n+1}^2 - \\tau_n^2) = -D_0((\\tau_n+\\Delta\\tau)^2 - \\tau_n^2) = -2D_0\\tau_n\\Delta\\tau - D_0(\\Delta\\tau)^2$. This implies that the discretization of the $\\theta$ term introduces no error, and the numerical error will be dominated entirely by the treatment of the $\\Phi'$ term.\n\nThe two required schemes differ only in their discretization of the source term $3\\Phi'$.\n\n**Task 1, Part 1: Naive-Midpoint Scheme**\n\nThis scheme follows the interpretation that the full update is a forward Euler step where the right-hand side is evaluated at the midpoint $\\tau_{n+1/2}$. The derivative $\\Phi'(\\tau_{n+1/2})$ is approximated by a centered finite difference using the available noisy data points $\\Phi^{\\text{num}}(\\tau_n)$ and $\\Phi^{\\text{num}}(\\tau_{n+1})$:\n$$\n3\\Phi'(\\tau_{n+1/2}) \\approx 3\\frac{\\Phi^{\\text{num}}(\\tau_{n+1}) - \\Phi^{\\text{num}}(\\tau_n)}{\\Delta\\tau}\n$$\nIntegrating this approximation over the step $\\Delta\\tau$ gives the discrete source contribution:\n$$\nS_{\\text{naive}} = \\Delta\\tau \\cdot \\left( 3\\frac{\\Phi^{\\text{num}}_{n+1} - \\Phi^{\\text{num}}_n}{\\Delta\\tau} \\right) = 3(\\Phi^{\\text{num}}_{n+1} - \\Phi^{\\text{num}}_n)\n$$\nThe full update for the naive-midpoint scheme is therefore:\n$$\n\\delta^{\\text{naive}}_{n+1} = \\delta^{\\text{naive}}_n - \\Delta\\tau \\cdot \\theta(\\tau_{n+1/2}) + 3(\\Phi^{\\text{num}}_{n+1} - \\Phi^{\\text{num}}_n)\n$$\nSubstituting $\\Phi^{\\text{num}}_n = \\Phi_0 + \\eta_n$, the source term becomes $3(\\eta_{n+1}-\\eta_n)$. Although the physical potential is constant, this scheme introduces a spurious source term proportional to the difference in the truncation error surrogate at adjacent time steps.\n\n**Task 1, Part 2: Balanced-Source Scheme**\n\nA well-balanced scheme is designed to exactly preserve known continuous properties at the discrete level. The problem states that the physical potential is constant, $\\Phi(\\tau) = \\Phi_0$, which means the physical source term $3\\Phi'(\\tau)$ is identically zero. A well-balanced scheme must honor this fact.\n\nThe derivation starts from the \"conservation-compatible\" integrated form of the source contribution: $3[\\Phi(\\tau_{n+1}) - \\Phi(\\tau_n)]$. A balanced discretization correctly identifies the physical functions being represented by the numerical data. Here, we are given that the physical potential is $\\Phi(\\tau) = \\Phi_0$. The scheme must use this *a priori* physical information. By substituting the true physical potential into the expression, we obtain the balanced source term:\n$$\nS_{\\text{bal}} = 3\\left[ \\Phi(\\tau_{n+1}) - \\Phi(\\tau_n) \\right] = 3\\left[ \\Phi_0 - \\Phi_0 \\right] = 0\n$$\nThis discretization correctly evaluates to zero, perfectly balancing the source for a constant potential, irrespective of the numerical representation $\\Phi^{\\text{num}}$. The update for the balanced-source scheme is:\n$$\n\\delta^{\\text{bal}}_{n+1} = \\delta^{\\text{bal}}_n - \\Delta\\tau \\cdot \\theta(\\tau_{n+1/2}) + 0\n$$\nSince the discretization of the $\\theta$ term was shown to be exact, and the balanced source term is correctly zero, the balanced scheme exactly reproduces the analytical solution at the grid points. Consequently, the error $E_{\\text{bal}}$ is expected to be zero (or of the order of machine precision). The error in the naive scheme, $\\delta^{\\text{naive}}_N - \\delta^{\\text{exact}}_N$ at the final time step $N$, is the sum of the spurious source terms, which forms a telescoping series:\n$$\n\\sum_{n=0}^{N-1} 3(\\Phi^{\\text{num}}_{n+1} - \\Phi^{\\text{num}}_n) = 3(\\Phi^{\\text{num}}_N - \\Phi^{\\text{num}}_0) = 3(\\Phi^{\\text{num}}(\\tau_f) - \\Phi^{\\text{num}}(\\tau_0))\n$$\nThis provides an analytical prediction for the error of the naive scheme.",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the problem of discrete backreaction in a simplified cosmological setting.\n\n    This function implements and compares two numerical schemes for solving the\n    continuity equation for density contrast perturbations:\n    1. A naive-midpoint scheme that is susceptible to spurious growth from\n       errors in the potential's numerical representation.\n    2. A well-balanced scheme that is designed to exactly preserve the state\n       where the potential is physically constant, thus eliminating spurious growth.\n\n    The function runs a suite of tests with different numerical parameters\n    and computes the final fractional error for both schemes in each case.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    tau0 = 1.0\n    tauf = 2.0\n    d0 = 0.1\n    phi0 = 1.0e-5\n    omega = 5.0\n\n    # Test suite: (delta_tau, p, C)\n    test_cases = [\n        (0.1, 2, 1.0),   # Case A\n        (0.05, 2, 1.0),  # Case B\n        (0.05, 3, 1.0),  # Case C\n        (0.05, 2, 0.0),  # Case D\n    ]\n\n    # --- Exact Solution ---\n    def delta_exact(tau):\n        return d0 * tau**2\n\n    delta_exact_tauf = delta_exact(tauf)\n    \n    # --- Main Loop for Test Cases ---\n    final_results = []\n    for dt, p, C in test_cases:\n\n        # --- Numerical Integration Setup ---\n        # Ensure the number of steps is an integer.\n        # Use round() to handle potential float inaccuracies.\n        num_steps = int(round((tauf - tau0) / dt))\n\n        # Initial conditions from the exact solution\n        delta_naive = delta_exact(tau0)\n        delta_bal = delta_exact(tau0)\n\n        tau = tau0\n        # --- Time-stepping Loop ---\n        for _ in range(num_steps):\n            tau_next = tau + dt\n            \n            # --- Common Term (from theta) ---\n            # Midpoint rule for the integral of -theta(tau).\n            # This discretization is exact for the given quadratic solution.\n            theta_term_integral = 2 * d0 * dt * (tau + dt / 2.0)\n\n            # --- Naive-Midpoint Scheme ---\n            # Source term is derived from a finite difference of noisy potential data.\n            eta_tau = C * (dt**p) * np.sin(omega * tau)\n            eta_tau_next = C * (dt**p) * np.sin(omega * tau_next)\n            phi_num_tau = phi0 + eta_tau\n            phi_num_tau_next = phi0 + eta_tau_next\n            source_naive = 3.0 * (phi_num_tau_next - phi_num_tau)\n            \n            delta_naive += theta_term_integral + source_naive\n\n            # --- Balanced-Source Scheme ---\n            # The source term is known to be zero because the physical potential is\n            # constant. The scheme correctly incorporates this physical knowledge.\n            # source_bal = 0.0\n            \n            delta_bal += theta_term_integral\n            \n            # Update time for the next step\n            tau = tau_next\n\n        # --- Error Calculation ---\n        # The final numerical values are at tau_next, which is tauf.\n        err_naive = abs(delta_naive - delta_exact_tauf) / abs(delta_exact_tauf)\n        err_bal = abs(delta_bal - delta_exact_tauf) / abs(delta_exact_tauf)\n\n        # Round results to 12 decimal places as specified.\n        final_results.append([round(err_naive, 12), round(err_bal, 12)])\n\n    # Format the final output as a list of lists.\n    # e.g., [[err_A_naive, err_A_bal], [err_B_naive, err_B_bal], ...]\n    output_str = \"[\" + \",\".join([f\"[{e_n},{e_b}]\" for e_n, e_b in final_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}