{
    "hands_on_practices": [
        {
            "introduction": "Before constructing complex simulations, we must understand the stability of our time-stepping methods, as an unstable scheme produces physically meaningless results. This is particularly important in cosmology, where equations often contain terms operating on vastly different timescales. This practice guides you through the stability analysis of a first-order Implicit-Explicit (IMEX) scheme, a powerful tool for such \"stiff\" problems, allowing you to derive the exact condition for a stable time step. ",
            "id": "3470353",
            "problem": "Consider a semi-discrete method-of-lines approximation to a linearized cosmological fluid mode in comoving coordinates, where a single Fourier mode amplitude $u(t)$ obeys the ordinary differential equation $\\partial_{t} u(t) = -\\lambda u(t) - \\mu u(t)$ with constant rates $\\lambda \\geq 0$ and $\\mu \\geq 0$ measured in $\\mathrm{s}^{-1}$. Here, $\\lambda$ arises from the explicitly treated non-stiff transport operator (e.g., comoving advection or source coupling), and $\\mu$ arises from a stiff damping operator (e.g., Hubble drag or collision term) treated implicitly. Employ a first-order Implicit-Explicit (IMEX) method where the explicit part uses forward Euler for the $\\lambda$ contribution and the implicit part uses backward Euler for the $\\mu$ contribution in a single combined time step of size $\\Delta t$. Assume that the explicit and implicit operators commute on this mode, so that their eigenvalues add, and that the underlying spatial discretization yields real nonnegative spectral rates.\n\nStarting from the semi-discrete evolution law and the described IMEX time discretization, derive the single-step amplification factor and use it to determine the combined linear stability requirement for this IMEX update in terms of $\\lambda$, $\\mu$, and $\\Delta t$. Under the assumption $0 \\leq \\mu < \\lambda$, compute the largest allowable time step $\\Delta t_{\\max}$ such that the update is linearly stable for all $\\Delta t$ in the interval $0 \\leq \\Delta t \\leq \\Delta t_{\\max}$. Express your final answer as a closed-form analytic expression for $\\Delta t_{\\max}$ in seconds. No numerical evaluation is required, and no rounding should be performed.",
            "solution": "The problem will first be validated for scientific and mathematical soundness, completeness, and clarity.\n\n### Step 1: Extract Givens\n- The semi-discrete evolution equation for a single Fourier mode amplitude $u(t)$ is $\\partial_{t} u(t) = -\\lambda u(t) - \\mu u(t)$.\n- The rates $\\lambda$ and $\\mu$ are constants, satisfying $\\lambda \\geq 0$ and $\\mu \\geq 0$, with units of $\\mathrm{s}^{-1}$.\n- The term $-\\lambda u(t)$ arises from a non-stiff operator and is treated explicitly.\n- The term $-\\mu u(t)$ arises from a stiff operator and is treated implicitly.\n- The time-stepping scheme is a first-order Implicit-Explicit (IMEX) method.\n- The explicit part (for $\\lambda$) uses the forward Euler method.\n- The implicit part (for $\\mu$) uses the backward Euler method.\n- The time step size is denoted by $\\Delta t$.\n- It is assumed that the explicit and implicit operators commute.\n- It is assumed that the underlying spatial discretization yields real, non-negative spectral rates.\n- The final calculation is performed under the assumption $0 \\leq \\mu < \\lambda$.\n- The goal is to derive the single-step amplification factor, the linear stability requirement, and the largest allowable stable time step $\\Delta t_{\\max}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically and mathematically sound. It describes the linear stability analysis of a standard first-order IMEX (Forward Euler/Backward Euler) scheme applied to a linear ordinary differential equation, which is a fundamental technique in numerical analysis for solving stiff differential equations. Such equations are common models for physical phenomena, including linearized cosmological perturbations. There are no violations of scientific principles.\n2.  **Non-Formalizable or Irrelevant**: The problem is highly formalizable and is directly relevant to the topic of discretizing partial differential equations, a core concern in numerical cosmology.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained and provides all necessary information to perform the derivation. The ODE, the numerical method, the parameters, and all required assumptions are explicitly stated. There are no internal contradictions.\n4.  **Unrealistic or Infeasible**: The setup is a standard, simplified model (Dahlquist's test equation) used to analyze the stability of numerical methods. It is mathematically feasible and represents a valid idealization of a more complex physical system.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. It asks for a definite mathematical derivation that leads to a unique and meaningful result. All terms are standard in the field of numerical analysis.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem is a standard, non-trivial exercise in numerical stability theory. It requires a correct application of definitions and algebraic manipulation.\n7.  **Outside Scientific Verifiability**: The derivation is purely mathematical and is therefore verifiable by logical and algebraic rules.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will now be provided.\n\n### Derivation of the Solution\nThe semi-discrete ordinary differential equation (ODE) governing the evolution of the mode amplitude $u(t)$ is given by:\n$$\n\\frac{d u}{d t} = -\\lambda u - \\mu u\n$$\nWe discretize this equation in time using a single step of size $\\Delta t$. Let $u^n$ represent the numerical approximation to $u(t_n)$ at time $t_n = n \\Delta t$. The next state is $u^{n+1}$ at time $t_{n+1} = t_n + \\Delta t$.\n\nThe problem specifies a first-order IMEX scheme. The term $-\\lambda u$ is treated explicitly using the forward Euler method, meaning it is evaluated at time $t_n$. The term $-\\mu u$ is treated implicitly using the backward Euler method, meaning it is evaluated at time $t_{n+1}$. Combining these, the finite difference approximation to the ODE is:\n$$\n\\frac{u^{n+1} - u^n}{\\Delta t} = -\\lambda u^n - \\mu u^{n+1}\n$$\nOur first goal is to find the single-step amplification factor, $g(\\lambda, \\mu, \\Delta t)$, which is defined by the relation $u^{n+1} = g \\cdot u^n$. To find $g$, we must rearrange the discretized equation to solve for $u^{n+1}$ in terms of $u^n$.\n\nStarting with the discretized equation:\n$$\nu^{n+1} - u^n = \\Delta t (-\\lambda u^n - \\mu u^{n+1})\n$$\nWe gather all terms involving $u^{n+1}$ on the left side and all terms involving $u^n$ on the right side:\n$$\nu^{n+1} + \\mu \\Delta t u^{n+1} = u^n - \\lambda \\Delta t u^n\n$$\nFactoring out $u^{n+1}$ and $u^n$:\n$$\nu^{n+1} (1 + \\mu \\Delta t) = u^n (1 - \\lambda \\Delta t)\n$$\nSolving for $u^{n+1}$ yields:\n$$\nu^{n+1} = \\left( \\frac{1 - \\lambda \\Delta t}{1 + \\mu \\Delta t} \\right) u^n\n$$\nBy definition, the expression in the parenthesis is the amplification factor $g$:\n$$\ng(\\lambda, \\mu, \\Delta t) = \\frac{1 - \\lambda \\Delta t}{1 + \\mu \\Delta t}\n$$\nFor the numerical method to be linearly stable, the magnitude of the amplification factor must not exceed unity. That is, the stability requirement is:\n$$\n|g| \\leq 1\n$$\nSubstituting the expression for $g$:\n$$\n\\left| \\frac{1 - \\lambda \\Delta t}{1 + \\mu \\Delta t} \\right| \\leq 1\n$$\nThe problem states that $\\mu \\geq 0$ and the time step $\\Delta t$ is non-negative, so $\\Delta t \\geq 0$. Therefore, the denominator $1 + \\mu \\Delta t$ is always positive and greater than or equal to $1$. We can multiply both sides of the inequality by $1 + \\mu \\Delta t$ without changing the direction of the inequality:\n$$\n|1 - \\lambda \\Delta t| \\leq 1 + \\mu \\Delta t\n$$\nThis absolute value inequality is equivalent to the pair of inequalities:\n$$\n-(1 + \\mu \\Delta t) \\leq 1 - \\lambda \\Delta t \\leq 1 + \\mu \\Delta t\n$$\nWe must satisfy both inequalities simultaneously.\n\nLet's analyze the right-hand inequality first:\n$$\n1 - \\lambda \\Delta t \\leq 1 + \\mu \\Delta t\n$$\n$$\n-\\lambda \\Delta t \\leq \\mu \\Delta t\n$$\n$$\n0 \\leq (\\lambda + \\mu) \\Delta t\n$$\nSince $\\lambda \\geq 0$, $\\mu \\geq 0$, and $\\Delta t \\geq 0$, this condition is always satisfied and imposes no upper bound on $\\Delta t$.\n\nNow, let's analyze the left-hand inequality:\n$$\n-(1 + \\mu \\Delta t) \\leq 1 - \\lambda \\Delta t\n$$\n$$\n-1 - \\mu \\Delta t \\leq 1 - \\lambda \\Delta t\n$$\nRearranging the terms to isolate $\\Delta t$:\n$$\n\\lambda \\Delta t - \\mu \\Delta t \\leq 1 + 1\n$$\n$$\n(\\lambda - \\mu) \\Delta t \\leq 2\n$$\nThis is the general linear stability requirement for the IMEX scheme.\n\nThe final part of the problem asks for the largest allowable time step, $\\Delta t_{\\max}$, under the specific assumption that $0 \\leq \\mu < \\lambda$. This assumption implies that the term $(\\lambda - \\mu)$ is strictly positive. Since $(\\lambda - \\mu) > 0$, we can divide the stability inequality by it without changing the direction of the inequality:\n$$\n\\Delta t \\leq \\frac{2}{\\lambda - \\mu}\n$$\nThis inequality must hold for the method to be stable. The problem asks for the largest allowable time step $\\Delta t_{\\max}$ such that the update is linearly stable for all $\\Delta t$ in the interval $0 \\leq \\Delta t \\leq \\Delta t_{\\max}$. This implies that $\\Delta t_{\\max}$ is the upper bound of this stable range.\nTherefore, the largest allowable time step is:\n$$\n\\Delta t_{\\max} = \\frac{2}{\\lambda - \\mu}\n$$\nThe units of $\\lambda$ and $\\mu$ are $\\mathrm{s}^{-1}$, so the units of $\\Delta t_{\\max}$ are $1 / (\\mathrm{s}^{-1}) = \\mathrm{s}$, which is consistent with the problem's request.",
            "answer": "$$\n\\boxed{\\frac{2}{\\lambda - \\mu}}\n$$"
        },
        {
            "introduction": "Cosmological fluid dynamics involves the formation of sharp structures like shocks and caustics. While high-order numerical methods are desirable for accuracy, they can introduce spurious, non-physical oscillations near these discontinuities. This exercise introduces a cornerstone of modern shock-capturing schemes: the Total Variation Diminishing (TVD) slope limiter. By performing a hands-on calculation of a limited slope, you will learn how to build non-oscillatory data reconstructions within a finite-volume framework, ensuring the physical fidelity of your simulation. ",
            "id": "3470385",
            "problem": "Consider the one-dimensional comoving mass conservation law for a pressureless fluid in an expanding Universe, written in conservative form for a generic conserved variable $q(x,t)$ as $\\partial_t q + \\partial_x f(q,t) = 0$, where $x$ is a comoving coordinate and $t$ is cosmic time. On a uniform mesh with spacing $\\Delta x = 1$ (arbitrary units), a second-order finite-volume method reconstructs piecewise-linear profiles inside each cell using a Total Variation Diminishing (TVD) slope limiter to prevent spurious oscillations in the presence of cosmological shocks and rarefactions.\n\nAt a given time, the cell-averaged values in three consecutive cells are $q_{i-1} = 1.00$, $q_i = 1.06$, and $q_{i+1} = 1.09$. You are asked to perform a TVD piecewise-linear reconstruction in cell $i$ using the generalized minmod limiter with parameter $\\theta = \\frac{3}{2}$ and to determine the limited slope $\\sigma_i$ to be used in the linear reconstruction $q_i(x) \\approx q_i + \\sigma_i (x - x_i)$ over cell $i$.\n\nUsing only fundamental principles of conservation laws and the definition of total variation, explain why and how this limiter choice affects the discrete total variation $\\mathrm{TV}(q) = \\sum_j |q_{j+1} - q_j|$ in a high-resolution finite-volume update. Your explanation should clarify whether the reconstruction step can increase the discrete total variation over these three cells and the mechanism by which the limiter prevents the creation of new extrema in the reconstructed interface states.\n\nCompute the limited slope $\\sigma_i$ and provide it as your final numerical answer. Do not include units. No rounding is required.",
            "solution": "The problem is valid. It is scientifically grounded in the theory of numerical methods for hyperbolic conservation laws, is well-posed with sufficient information, and uses objective, formal language. We may proceed with the solution.\n\nThe problem asks for the computation of a limited slope $\\sigma_i$ for a piecewise-linear data reconstruction in a finite-volume scheme and an explanation of the role of the slope limiter in maintaining the Total Variation Diminishing (TVD) property.\n\nFirst, let us address the conceptual part of the problem. The governing equation, $\\partial_t q + \\partial_x f(q,t) = 0$, is a hyperbolic conservation law. Solutions to such equations can develop discontinuities (shocks), even from smooth initial data. Numerical methods of second-order or higher, if not carefully designed, tend to produce spurious, non-physical oscillations near these discontinuities. The Total Variation Diminishing (TVD) property is a crucial design criterion for numerical schemes to capture shocks without introducing such oscillations.\n\nThe total variation of the discrete, cell-averaged data is defined as $\\mathrm{TV}(q) = \\sum_j |q_{j+1} - q_j|$. A numerical scheme is called TVD if the total variation of the solution does not increase from one time step to the next, i.e., $\\mathrm{TV}(q^{n+1}) \\le \\mathrm{TV}(q^n)$, where $q^n$ denotes the vector of cell averages at time step $n$.\n\nHigh-resolution finite-volume methods achieve the TVD property by carefully constraining the data reconstruction step. At this stage, a higher-order, piecewise polynomial representation of the data is constructed within each cell from the cell averages. For the specified piecewise-linear reconstruction, the profile in cell $i$ is given by $q_i(x) \\approx q_i + \\sigma_i (x - x_i)$, where $q_i$ is the cell-averaged value and $\\sigma_i$ is the slope.\n\nThe reconstruction step itself does not alter the cell averages $\\{q_j\\}$, and therefore it does not change the discrete total variation $\\mathrm{TV}(q)$. The role of the slope limiter is prophylactic: it constrains the slope $\\sigma_i$ to ensure that the subsequent evolution step, which uses the reconstructed interface values to compute fluxes, will not increase the total variation.\n\nThe mechanism by which the limiter prevents the eventual increase of total variation is by enforcing a local monotonicity principle. It prevents the creation of new local extrema in the reconstructed data. The reconstructed values at the interfaces of cell $i$, located at $x_{i-1/2}$ and $x_{i+1/2}$, must be bounded by the average values of the cells they separate. The value at the right interface of cell $i$, let's call it $q_{i+1/2}^L$, is computed from the reconstruction in cell $i$ as $q_i(x_{i+1/2}) = q_i + \\sigma_i \\frac{\\Delta x}{2}$. This value is used to compute the flux $f_{i+1/2}$. A new extremum would be created if, for instance, $q_i < q_{i+1}$ but the reconstructed value $q_{i+1/2}^L$ is greater than $q_{i+1}$. This is called an overshoot. A TVD limiter for $\\sigma_i$ is designed precisely to prevent such overshoots and undershoots. By doing so, it guarantees that the numerical fluxes computed from these reconstructed states will lead to a TVD update.\n\nNow, we compute the limited slope $\\sigma_i$. We are given the cell averages $q_{i-1} = 1.00$, $q_i = 1.06$, and $q_{i+1} = 1.09$. The uniform mesh spacing is $\\Delta x = 1$. The reconstruction uses the generalized minmod limiter with parameter $\\theta = \\frac{3}{2}$.\n\nFirst, we define the relevant undivided difference slopes based on the cell-averaged data:\nThe backward difference slope is $\\Delta_b = \\frac{q_i - q_{i-1}}{\\Delta x}$.\nThe forward difference slope is $\\Delta_f = \\frac{q_{i+1} - q_i}{\\Delta x}$.\nThe centered difference slope, which corresponds to an unlimited second-order reconstruction, is $\\Delta_c = \\frac{q_{i+1} - q_{i-1}}{2\\Delta x}$.\n\nLet's compute these values:\n$\\Delta_b = \\frac{1.06 - 1.00}{1} = 0.06$\n$\\Delta_f = \\frac{1.09 - 1.06}{1} = 0.03$\n$\\Delta_c = \\frac{1.09 - 1.00}{2 \\times 1} = \\frac{0.09}{2} = 0.045$\n\nThe generalized minmod limiter is a function that selects a slope based on these candidates. A common form for MUSCL-type schemes, which we adopt here, is to limit the centered slope by the scaled forward and backward slopes:\n$\\sigma_i = \\text{minmod}(\\theta \\Delta_b, \\Delta_c, \\theta \\Delta_f)$\n\nThe minmod function is defined as:\n$\\text{minmod}(a_1, a_2, \\dots, a_n) = \\begin{cases} \\min(a_1, a_2, \\dots, a_n) & \\text{if } a_j > 0 \\text{ for all } j \\\\ \\max(a_1, a_2, \\dots, a_n) & \\text{if } a_j < 0 \\text{ for all } j \\\\ 0 & \\text{otherwise (mixed signs)} \\end{cases}$\n\nWe need to compute the arguments for the minmod function using $\\theta = \\frac{3}{2} = 1.5$:\n$1$. $\\theta \\Delta_b = 1.5 \\times 0.06 = 0.09$\n$2$. $\\Delta_c = 0.045$\n$3$. $\\theta \\Delta_f = 1.5 \\times 0.03 = 0.045$\n\nAll three arguments, $0.09$, $0.045$, and $0.045$, are positive. Therefore, the minmod function will return their minimum value.\n$\\sigma_i = \\min(0.09, 0.045, 0.045)$\n$\\sigma_i = 0.045$\n\nThe unlimited centered slope is $\\Delta_c = 0.045$. The limiting slopes derived from the neighbors are $\\theta\\Delta_b = 0.09$ and $\\theta\\Delta_f = 0.045$. The function selects the slope with the smallest magnitude to ensure the TVD property, which in this case is $0.045$. The resulting limited slope for the reconstruction in cell $i$ is $\\sigma_i = 0.045$.",
            "answer": "$$\\boxed{0.045}$$"
        },
        {
            "introduction": "A robust numerical scheme must not only be stable and accurate for dynamic solutions but also exactly preserve fundamental physical equilibria. Schemes that achieve this are called \"well-balanced,\" and they are essential for long-term cosmological integrations where small numerical errors can otherwise grow to dominate the solution. In this comprehensive practice, you will design, implement, and test a well-balanced scheme for linear cosmological perturbations, combining spectral methods in space with a strategic variable transformation in time to build a code that respects the physics of the underlying system. ",
            "id": "3470311",
            "problem": "You are asked to design and implement a numerical method that is well-balanced for the one-dimensional linear cosmological perturbation equations in a matter-dominated, spatially flat universe. The method must exactly maintain the trivial solution $ \\delta(x,\\tau)=0 $ and $ \\theta(x,\\tau)=0 $ while accurately resolving the growing and decaying modes of linear perturbations. The objective is to discretize the governing Partial Differential Equations (PDE) in space and time, respecting the cosmological background, and to test the scheme on a set of prescribed initial conditions.\n\nThe fundamental base consists of the Newtonian-limit linear perturbation theory for pressureless matter in an Einstein–de Sitter universe. In conformal time $ \\tau $, with scale factor $ a(\\tau) $ and conformal Hubble parameter $ \\mathcal{H}(\\tau) = a'(\\tau)/a(\\tau) $, the linearized one-dimensional system for the density contrast $ \\delta(x,\\tau) $, the peculiar velocity $ u(x,\\tau) $, and the gravitational potential $ \\phi(x,\\tau) $ is:\n- $ \\partial_{\\tau} \\delta + \\partial_{x} u = 0 $,\n- $ \\partial_{\\tau} u + \\mathcal{H} u = - \\partial_{x} \\phi $,\n- $ \\partial_{x}^{2} \\phi = \\frac{3}{2} \\mathcal{H}^{2} \\delta $.\n\nIn an Einstein–de Sitter background, take units such that $ \\tau_{0} = 1 $ and\n- $ a(\\tau) = \\tau^{2} $,\n- $ \\mathcal{H}(\\tau) = \\frac{2}{\\tau} $,\n- $ \\partial_{x}^{2} \\phi = \\frac{6}{\\tau^{2}} \\delta $.\n\nDefine the velocity divergence $ \\theta = \\partial_{x} u $. The trivial state $ \\delta = 0 $ and $ \\theta = 0 $ is an exact solution. In Fourier space, each mode $ \\delta_{k}(\\tau) $ obeys the linear Ordinary Differential Equation (ODE)\n$$\n\\delta_{k}'' + \\mathcal{H} \\, \\delta_{k}' - \\frac{3}{2} \\mathcal{H}^{2} \\delta_{k} = 0,\n$$\nwhose two independent solutions in this background are the growing mode $ \\delta_{k} \\propto \\tau^{2} $ and the decaying mode $ \\delta_{k} \\propto \\tau^{-3} $.\n\nAlgorithm design requirements:\n- Use a Fourier pseudo-spectral discretization in space on a periodic domain $ x \\in [0, L] $ with $ L = 2\\pi $. For any field $ f(x) $, compute $ \\partial_{x} f $ via the Fast Fourier Transform (FFT) differentiation rule $ \\widehat{\\partial_{x} f}(k) = i k \\hat{f}(k) $, where $ k = \\frac{2\\pi n}{L} $ for integer $ n $.\n- Solve the Poisson equation mode-by-mode in Fourier space using $ \\hat{\\phi}(k) = - \\frac{6}{\\tau^{2}} \\frac{\\hat{\\delta}(k)}{k^{2}} $ for $ k \\neq 0 $ and set $ \\hat{\\phi}(0) = 0 $.\n- To achieve a well-balanced time discretization that exactly preserves $ \\delta = 0 $ and $ \\theta = 0 $, eliminate the linear damping term by introducing the integrating factor variable $ w = a(\\tau) u $. Then the system becomes\n  - $ \\partial_{\\tau} \\delta = - \\frac{1}{a(\\tau)} \\partial_{x} w $,\n  - $ \\partial_{\\tau} w = - a(\\tau) \\, \\partial_{x} \\phi $,\n  - $ \\partial_{x}^{2} \\phi = \\frac{6}{\\tau^{2}} \\delta $,\n  with the background $ a(\\tau) = \\tau^{2} $. This transformation ensures that $ (\\delta, w) \\equiv (0, 0) $ is an exact numerical equilibrium if consistent spatial discretizations are used for flux and source terms.\n- Use a two-stage explicit Runge–Kutta method (Heun’s method) to integrate in conformal time $ \\tau $.\n\nTest suite and parameters:\n- Spatial domain: $ L = 2\\pi $ with $ N = 128 $ equispaced grid points. All quantities are dimensionless; no physical units are required.\n- Initial and final conformal times: $ \\tau_{i} = 1 $ and $ \\tau_{f} = 5 $.\n- Time stepping: use a uniform time step with $ N_{\\text{steps}} = 2000 $.\n- Wavenumber to excite: $ k_{\\star} = 3 $ (an integer compatible with the periodic domain).\n- Tolerance for the well-balanced property: $ \\text{tol}_{0} = 10^{-12} $.\n- Amplitudes for tests: growing amplitude $ A_{g} = 10^{-3} $, decaying amplitude $ A_{d} = 10^{-3} $.\n- Mixture amplitudes: $ A_{g}^{(m)} = 7 \\times 10^{-4} $ and $ A_{d}^{(m)} = 3 \\times 10^{-3} $.\n\nConstruct the following four test cases:\n1. Exact preservation of the trivial state: set $ \\delta(x,\\tau_{i}) \\equiv 0 $ and $ u(x,\\tau_{i}) \\equiv 0 $. Evolve to $ \\tau_{f }$ and compute $ \\max\\{\\|\\delta(\\cdot,\\tau_{f})\\|_{\\infty}, \\|\\theta(\\cdot,\\tau_{f})\\|_{\\infty}\\} $. Report a boolean indicating whether this maximum is $ \\le \\text{tol}_{0} $.\n2. Pure growing mode at $ k_{\\star} $: initialize $ \\delta(x,\\tau_{i}) = A_{g} \\cos(k_{\\star} x) $ and choose $ u(x,\\tau_{i}) $ so that only the growing mode is present. Using $ \\delta(\\tau) = C_{1} \\tau^{2} $ for the growing branch implies $ \\delta'(\\tau_{i}) = 2 C_{1} \\tau_{i} = 2 A_{g} $. Since $ \\theta = -\\delta' $ and $ \\theta = \\partial_{x} u $, set $ u(x,\\tau_{i}) = \\frac{\\theta_{\\text{amp}}}{k_{\\star}} \\sin(k_{\\star} x) $ with $ \\theta_{\\text{amp}} = -2 A_{g} $. After evolution, project the numerical $ \\delta(x,\\tau_{f}) $ onto $ \\cos(k_{\\star} x) $ to obtain the amplitude $ A_{\\text{num}} $. The analytic amplitude is $ A_{\\text{ana}} = A_{g} \\left(\\frac{\\tau_{f}}{\\tau_{i}}\\right)^{2} $. Report the relative error $ \\left| A_{\\text{num}} - A_{\\text{ana}} \\right| / \\left| A_{\\text{ana}} \\right| $ as a float.\n3. Pure decaying mode at $ k_{\\star} $: initialize $ \\delta(x,\\tau_{i}) = A_{d} \\cos(k_{\\star} x) $ and choose $ u(x,\\tau_{i}) $ so that only the decaying mode is present. Using $ \\delta(\\tau) = C_{2} \\tau^{-3} $ implies $ \\delta'(\\tau_{i}) = -3 C_{2} \\tau_{i}^{-4} = -3 A_{d} $. Set $ \\theta_{\\text{amp}} = -\\delta'(\\tau_{i}) = 3 A_{d} $ and $ u(x,\\tau_{i}) = \\frac{\\theta_{\\text{amp}}}{k_{\\star}} \\sin(k_{\\star} x) $. After evolution, project $ \\delta(x,\\tau_{f}) $ onto $ \\cos(k_{\\star} x) $ to get $ A_{\\text{num}} $. The analytic amplitude is $ A_{\\text{ana}} = A_{d} \\left(\\frac{\\tau_{f}}{\\tau_{i}}\\right)^{-3} $. Report the relative error as a float.\n4. Mixed growing and decaying mode at the same $ k_{\\star} $: set $ \\delta(x,\\tau_{i}) = \\left(A_{g}^{(m)} + A_{d}^{(m)}\\right) \\cos(k_{\\star} x) $ and $ u(x,\\tau_{i}) = \\frac{-2 A_{g}^{(m)} + 3 A_{d}^{(m)}}{k_{\\star}} \\sin(k_{\\star} x) $. After evolution, project $ \\delta(x,\\tau_{f}) $ onto $ \\cos(k_{\\star} x) $ to get $ A_{\\text{num}} $. The analytic amplitude is $ A_{\\text{ana}} = A_{g}^{(m)} \\left(\\frac{\\tau_{f}}{\\tau_{i}}\\right)^{2} + A_{d}^{(m)} \\left(\\frac{\\tau_{f}}{\\tau_{i}}\\right)^{-3} $. Report the relative error as a float.\n\nOutput specification:\n- Your program must run these four tests and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order: $ [\\text{wb\\_ok}, \\text{err\\_grow}, \\text{err\\_decay}, \\text{err\\_mix}] $ where $ \\text{wb\\_ok} $ is a boolean and the errors are floats.\n- All quantities are dimensionless; no physical units are required.\n- Angle arguments are in radians.\n\nYour final result must be a complete and runnable program that implements the described discretization and tests, without requiring any user input or external files. The program must use only the specified libraries and print the results in exactly the format described.",
            "solution": "The problem requires the design and implementation of a well-balanced numerical scheme for the one-dimensional linear cosmological perturbation equations in a matter-dominated, Einstein–de Sitter universe. The scheme must be validated against four specific test cases: preservation of the trivial solution, and accurate evolution of pure growing, pure decaying, and mixed perturbation modes.\n\nThe governing equations in conformal time $\\tau$ for the density contrast $\\delta(x,\\tau)$ and the peculiar velocity $u(x,\\tau)$ are:\n$$ \\partial_{\\tau} \\delta + \\partial_{x} u = 0 $$\n$$ \\partial_{\\tau} u + \\mathcal{H} u = - \\partial_{x} \\phi $$\n$$ \\partial_{x}^{2} \\phi = \\frac{3}{2} \\mathcal{H}^{2} \\delta $$\nIn the specified Einstein–de Sitter background, the scale factor is $a(\\tau) = \\tau^2$ and the conformal Hubble parameter is $\\mathcal{H}(\\tau) = 2/\\tau$, simplifying the Poisson equation to $\\partial_{x}^{2} \\phi = (6/\\tau^2) \\delta$. The term $\\mathcal{H} u$ in the Euler equation is a damping term that can introduce numerical errors when trying to preserve the equilibrium state $\\delta=0, u=0$.\n\nA well-balanced scheme is one that exactly, up to machine precision, preserves a known steady-state or equilibrium solution. To achieve this, we follow the problem's prescription and transform the variables. We introduce $w = a(\\tau) u$. The time derivatives of the primitive variables $(\\delta, u)$ are related to the new variable $w$ as follows:\n$\\partial_{\\tau} u = \\partial_{\\tau} (w/a) = (1/a)\\partial_{\\tau} w - (a'/a^2)w = (1/a)\\partial_{\\tau}w - (\\mathcal{H}/a)w$.\nSubstituting this into the Euler equation:\n$$ \\frac{1}{a}\\partial_{\\tau}w - \\frac{\\mathcal{H}}{a}w + \\mathcal{H}u = -\\partial_x \\phi $$\n$$ \\frac{1}{a}\\partial_{\\tau}w - \\frac{\\mathcal{H}}{a}w + \\frac{\\mathcal{H}}{a}w = -\\partial_x \\phi $$\n$$ \\partial_{\\tau}w = -a(\\tau)\\partial_x \\phi $$\nThe continuity equation becomes $\\partial_{\\tau}\\delta = -\\partial_x u = -\\partial_x(w/a) = -(1/a)\\partial_x w$.\nThis yields the transformed system to be solved:\n$$ \\partial_{\\tau} \\delta = - \\frac{1}{a(\\tau)} \\partial_{x} w $$\n$$ \\partial_{\\tau} w = - a(\\tau) \\, \\partial_{x} \\phi $$\n$$ \\partial_{x}^{2} \\phi = \\frac{6}{\\tau^{2}} \\delta $$\nIn this form, if $\\delta=0$ and $w=0$, then $\\phi=0$ (from the Poisson equation), thus the right-hand sides of the evolution equations for $\\delta$ and $w$ are identically zero. This ensures that a numerical scheme that discretizes these equations consistently will preserve the $(\\delta, w) = (0,0)$ state.\n\nThe numerical implementation proceeds as follows:\n\n**1. Spatial Discretization: Fourier Pseudo-spectral Method**\nThe spatial domain is periodic, $x \\in [0, L]$ with $L=2\\pi$, discretized with $N=128$ points $x_j = j L/N$ for $j=0, \\dots, N-1$. This choice makes Fourier methods exceptionally accurate. The spatial derivative $\\partial_x f(x)$ is computed in Fourier space. A function $f(x)$ is transformed using the Fast Fourier Transform (FFT) to get its Fourier coefficients $\\hat{f}(k_n)$. The derivative's Fourier coefficients are then given by $\\widehat{\\partial_x f}(k_n) = i k_n \\hat{f}(k_n)$, where $k_n$ are the discrete wavenumbers. The derivative in real space, $\\partial_x f(x)$, is recovered by applying an inverse FFT. The wavenumbers are $k_n = 2\\pi n / L = n$ since $L=2\\pi$.\n\nThe Poisson equation, $\\partial_{x}^{2} \\phi = (6/\\tau^2) \\delta$, becomes an algebraic equation in Fourier space:\n$$ (i k_n)^2 \\hat{\\phi}(k_n) = -k_n^2 \\hat{\\phi}(k_n) = \\frac{6}{\\tau^2} \\hat{\\delta}(k_n) $$\nFor modes with $k_n \\neq 0$, the potential is solved as $\\hat{\\phi}(k_n) = -\\frac{6}{\\tau^2} \\frac{\\hat{\\delta}(k_n)}{k_n^2}$. For the mean mode $k_n=0$, we set $\\hat{\\phi}(0)=0$ as specified.\n\n**2. Time Discretization: Heun's Method**\nWe use a two-stage explicit Runge–Kutta scheme (Heun's method) to advance the state vector $Y = [\\delta, w]$ from time $\\tau_n$ to $\\tau_{n+1} = \\tau_n + \\Delta\\tau$. Let the right-hand side of our system be $F(Y, \\tau) = [\\dot{\\delta}, \\dot{w}]$.\nThe update rule is:\n1. **Predictor step:** $Y^* = Y_n + \\Delta\\tau F(Y_n, \\tau_n)$\n2. **Corrector step:** $Y_{n+1} = Y_n + \\frac{\\Delta\\tau}{2} \\left[ F(Y_n, \\tau_n) + F(Y^*, \\tau_n + \\Delta\\tau) \\right]$\n\n**3. Algorithm Implementation and Test Cases**\nThe simulation is run from $\\tau_i=1$ to $\\tau_f=5$ with $N_{\\text{steps}}=2000$ steps, giving a time step of $\\Delta\\tau = (\\tau_f - \\tau_i)/N_{\\text{steps}} = 0.002$.\n\n- **Test 1 (Trivial State):** We initialize $\\delta(x, \\tau_i)=0$ and $u(x, \\tau_i)=0$. Since $a(\\tau_i)=\\tau_i^2 = 1$, the initial $w(x, \\tau_i)$ is also $0$. The simulation is evolved to $\\tau_f$. The final velocity divergence $\\theta(\\cdot, \\tau_f) = \\partial_x u(\\cdot, \\tau_f)$ is computed from the final state $w(\\cdot, \\tau_f)$ via $u_f = w_f / a(\\tau_f)$ and spectral differentiation. The result is `True` if $\\max\\{\\|\\delta_f\\|_{\\infty}, \\|\\theta_f\\|_{\\infty}\\} \\le 10^{-12}$.\n\n- **Test 2 (Growing Mode):** The initial conditions are set to a pure growing mode with amplitude $A_g=10^{-3}$ at wavenumber $k_{\\star}=3$. The relation $\\theta = -\\partial_\\tau \\delta$ and the growing mode form $\\delta \\propto \\tau^2$ imply $\\theta(\\tau_i)=-2\\delta(\\tau_i)/\\tau_i = -2A_g$ (since $\\tau_i=1$). The initial state is $\\delta(x, \\tau_i) = A_g \\cos(k_{\\star} x)$ and $u(x, \\tau_i) = \\frac{-2A_g}{k_{\\star}} \\sin(k_{\\star} x)$. The state is evolved to $\\tau_f$. The numerical amplitude $A_{\\text{num}}$ in the final density contrast $\\delta(\\cdot, \\tau_f)$ is found by projecting it onto $\\cos(k_{\\star}x)$. This is efficiently done via FFT: for a real signal, the amplitude of the $\\cos(k_{\\star}x)$ component is given by $\\frac{2}{N}\\text{Re}(\\hat\\delta_f[k_{\\star}])$. The analytical amplitude is $A_{\\text{ana}} = A_g (\\tau_f/\\tau_i)^2$. The relative error is reported.\n\n- **Test 3 (Decaying Mode):** This is analogous to Test 2. For the decaying mode $\\delta \\propto \\tau^{-3}$, we have $\\theta(\\tau_i)=-(-3)\\delta(\\tau_i)/\\tau_i=3A_d$. The initial conditions are $\\delta(x, \\tau_i) = A_d \\cos(k_{\\star} x)$ and $u(x, \\tau_i) = \\frac{3A_d}{k_{\\star}} \\sin(k_{\\star} x)$ with $A_d=10^{-3}$. The analytical final amplitude is $A_{\\text{ana}} = A_d (\\tau_f/\\tau_i)^{-3}$. The relative error is reported.\n\n- **Test 4 (Mixed Mode):** The initial condition is a linear superposition of the growing and decaying modes: $\\delta(x, \\tau_i) = (A_g^{(m)} + A_d^{(m)}) \\cos(k_{\\star}x)$, and $u(x, \\tau_i)$ is set accordingly. The final numerical amplitude is compared with the analytical solution $A_{\\text{ana}} = A_{g}^{(m)} (\\tau_f/\\tau_i)^{2} + A_{d}^{(m)} (\\tau_f/\\tau_i)^{-3}$. The relative error is reported.\n\nThe implementation combines these principles into a single program that runs all four tests and outputs the results in the specified format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear cosmological perturbation equations using a\n    well-balanced Fourier pseudo-spectral scheme and Heun's method for time integration.\n    \"\"\"\n    \n    # Define parameters from the problem statement.\n    L = 2.0 * np.pi\n    N = 128\n    tau_i = 1.0\n    tau_f = 5.0\n    N_steps = 2000\n    k_star = 3\n    tol_0 = 1e-12\n    A_g = 1e-3\n    A_d = 1e-3\n    A_g_m = 7e-4\n    A_d_m = 3e-3\n\n    # Spatial grid and wavenumbers\n    x = np.linspace(0, L, N, endpoint=False)\n    dx = L / N\n    k = 2.0 * np.pi * np.fft.fftfreq(N, d=dx)\n\n    # Time step\n    dt = (tau_f - tau_i) / N_steps\n\n    # Precompute the k^-2 operator for the Poisson solve\n    k_sq_inv = np.zeros_like(k)\n    nonzero_k_mask = k != 0\n    k_sq_inv[nonzero_k_mask] = 1.0 / (k[nonzero_k_mask]**2)\n\n    def get_rhs(delta, w, tau):\n        \"\"\"\n        Computes the right-hand side of the transformed system for (delta, w).\n        d(delta)/d(tau) = - (1/a) * d_x(w)\n        d(w)/d(tau)     = - a * d_x(phi)\n        \"\"\"\n        # Transform state variables to Fourier space\n        delta_hat = np.fft.fft(delta)\n        w_hat = np.fft.fft(w)\n\n        # Solve Poisson equation for phi_hat in Fourier space\n        # phi_hat(k) = - (6/tau^2) * delta_hat(k) / k^2\n        phi_hat = - (6.0 / tau**2) * delta_hat * k_sq_inv\n        \n        # Compute spatial derivatives in Fourier space\n        # d_x(f_hat) = ik * f_hat\n        dx_w_hat = 1j * k * w_hat\n        dx_phi_hat = 1j * k * phi_hat\n\n        # Transform derivatives back to real space\n        dx_w = np.fft.ifft(dx_w_hat).real\n        dx_phi = np.fft.ifft(dx_phi_hat).real\n\n        # Scale factor a(tau) = tau^2\n        a_tau = tau**2\n\n        # Compute time derivatives\n        d_delta_dt = - (1.0 / a_tau) * dx_w\n        d_w_dt = - a_tau * dx_phi\n\n        return d_delta_dt, d_w_dt\n\n    def evolve(delta_0, w_0):\n        \"\"\"\n        Evolves the system from tau_i to tau_f using Heun's method.\n        \"\"\"\n        delta = delta_0.copy()\n        w = w_0.copy()\n        tau = tau_i\n\n        for _ in range(N_steps):\n            # Stage 1 (Predictor)\n            k1_delta, k1_w = get_rhs(delta, w, tau)\n            delta_star = delta + dt * k1_delta\n            w_star = w + dt * k1_w\n            \n            # Stage 2 (Corrector)\n            k2_delta, k2_w = get_rhs(delta_star, w_star, tau + dt)\n            \n            # Update state variables\n            delta += (dt / 2.0) * (k1_delta + k2_delta)\n            w += (dt / 2.0) * (k1_w + k2_w)\n            tau += dt\n            \n        return delta, w\n\n    results = []\n\n    # --- Test 1: Exact preservation of the trivial state ---\n    delta_0_t1 = np.zeros(N)\n    u_0_t1 = np.zeros(N)\n    w_0_t1 = u_0_t1 * (tau_i**2)\n    delta_f, w_f = evolve(delta_0_t1, w_0_t1)\n    \n    # Compute final velocity divergence theta\n    u_f = w_f / (tau_f**2)\n    u_f_hat = np.fft.fft(u_f)\n    theta_f_hat = 1j * k * u_f_hat\n    theta_f = np.fft.ifft(theta_f_hat).real\n    \n    max_err = max(np.max(np.abs(delta_f)), np.max(np.abs(theta_f)))\n    results.append(max_err <= tol_0)\n\n    # --- Function to run a test and compute relative error ---\n    def run_and_get_error(delta_0, u_0, A_ana):\n        w_0 = u_0 * (tau_i**2)\n        delta_f, _ = evolve(delta_0, w_0)\n        delta_f_hat = np.fft.fft(delta_f)\n        # Amplitude of cos(k*x) is (2/N) * Re(fft[k]) for real signals\n        A_num = (2.0 / N) * delta_f_hat[k_star].real\n        return np.abs(A_num - A_ana) / np.abs(A_ana)\n\n    # --- Test 2: Pure growing mode ---\n    delta_0_g = A_g * np.cos(k_star * x)\n    u_0_g = (-2.0 * A_g / k_star) * np.sin(k_star * x)\n    A_ana_g = A_g * (tau_f / tau_i)**2\n    err_grow = run_and_get_error(delta_0_g, u_0_g, A_ana_g)\n    results.append(err_grow)\n\n    # --- Test 3: Pure decaying mode ---\n    delta_0_d = A_d * np.cos(k_star * x)\n    u_0_d = (3.0 * A_d / k_star) * np.sin(k_star * x)\n    A_ana_d = A_d * (tau_f / tau_i)**(-3.0)\n    err_decay = run_and_get_error(delta_0_d, u_0_d, A_ana_d)\n    results.append(err_decay)\n    \n    # --- Test 4: Mixed growing and decaying mode ---\n    delta_0_m = (A_g_m + A_d_m) * np.cos(k_star * x)\n    u_0_m = ((-2.0 * A_g_m + 3.0 * A_d_m) / k_star) * np.sin(k_star * x)\n    A_ana_m = A_g_m * (tau_f / tau_i)**2 + A_d_m * (tau_f / tau_i)**(-3.0)\n    err_mix = run_and_get_error(delta_0_m, u_0_m, A_ana_m)\n    results.append(err_mix)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{results[0]},{results[1]},{results[2]},{results[3]}]\")\n\nsolve()\n```"
        }
    ]
}