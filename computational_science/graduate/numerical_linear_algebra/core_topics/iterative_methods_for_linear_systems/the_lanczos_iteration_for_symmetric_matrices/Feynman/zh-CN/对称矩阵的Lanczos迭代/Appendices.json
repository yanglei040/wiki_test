{
    "hands_on_practices": [
        {
            "introduction": "掌握 Lanczos 迭代机理最有效的方法是在一个简单、结构良好的问题上进行手动计算。本练习  正提供了这样一个机会，它将指导您对一个代表常见物理系统的矩阵完成前两步迭代。通过显式计算基向量和生成的三对角矩阵 $T_2$，您将对该算法如何逐步构建克雷洛夫子空间投影获得具体而深刻的理解。",
            "id": "3421772",
            "problem": "考虑将一维泊松方程 $-u''(x)=f(x)$ 在单位区间上采用齐次狄利克雷边界条件进行中心有限差分格式离散化所产生的线性系统，为简单起见，网格参数的缩放已被吸收到右端项中。由此得到的对称正定矩阵为\n$$\nA=\\begin{pmatrix}\n2  -1  0 \\\\\n-1  2  -1 \\\\\n0  -1  2\n\\end{pmatrix},\n$$\n这是用于偏微分方程数值解的克雷洛夫子空间方法中的一个标准模型问题。在最小残差法 (MINRES) 中，Lanczos 过程为克雷洛夫子空间生成一个标准正交基，并生成 $A$ 的一个对称三对角投影。无转置拟最小残差法 (TFQMR) 是一种用于非对称问题的相关方法，但这里的重点是与 MINRES 相关的对称情形。\n\n从初始猜测 $x_0=\\mathbf{0}$ 和右端向量 $b=\\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}$ 开始，定义初始残差 $r_0=b-Ax_0$ 和第一个 Lanczos 基向量 $v_1=r_0/\\|r_0\\|$。利用克雷洛夫子空间的基本定义以及表征对称矩阵上 Lanczos 过程的三项递推关系，精确执行两次 Lanczos 迭代，以构造标准正交基向量 $v_1$ 和 $v_2$，并组装 $2\\times 2$ 的三对角矩阵 $T_2$，其元素是这些迭代所产生的投影系数。\n\n作为与支撑 MINRES 的谱压缩相关的最终标量诊断值，计算三对角矩阵 $T_2$ 的行列式。将此行列式以单个精确实数的形式提供。无需四舍五入，也不涉及单位。答案必须以单个实数值给出。",
            "solution": "该问题要求计算一个 $2 \\times 2$ 三对角矩阵 $T_2$ 的行列式，该矩阵是通过对给定的对称矩阵 $A$ 执行两次 Lanczos 过程生成的。该过程从一个特定的右端向量 $b$ 和初始猜测 $x_0$ 开始。\n\n给定的矩阵是：\n$$\nA=\\begin{pmatrix}\n2  -1  0 \\\\\n-1  2  -1 \\\\\n0  -1  2\n\\end{pmatrix}\n$$\n右端向量为 $b=\\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}$，初始猜测为 $x_0=\\mathbf{0}=\\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix}$。\n\nLanczos 过程是一种迭代算法，它为克雷洛夫子空间 $\\mathcal{K}_k(A, r_0) = \\text{span}\\{r_0, Ar_0, \\dots, A^{k-1}r_0\\}$ 生成一个标准正交基 $\\{v_j\\}$，并生成一个对称三对角矩阵 $T_k$，其元素是三项递推关系的系数。标准算法流程如下：\n\n1.  初始化：计算初始残差 $r_0 = b - Ax_0$。设 $\\beta_1 = \\|r_0\\|_2$ 且 $v_1 = r_0 / \\beta_1$。设 $v_0 = \\mathbf{0}$。\n2.  对 $j=1, 2, \\dots$ 进行迭代：\n    a. 计算 $w_j = A v_j$。\n    b. 计算对角系数 $\\alpha_j = v_j^T w_j$。\n    c. 计算未归一化的下一个向量 $\\tilde{v}_{j+1} = w_j - \\alpha_j v_j - \\beta_j v_{j-1}$。\n    d. 计算非对角系数 $\\beta_{j+1} = \\|\\tilde{v}_{j+1}\\|_2$。\n    e. 如果 $\\beta_{j+1} \\neq 0$，则归一化以得到下一个基向量 $v_{j+1} = \\tilde{v}_{j+1} / \\beta_{j+1}$。\n\n我们将执行此过程两次迭代，以找到系数 $\\alpha_1$、$\\beta_2$ 和 $\\alpha_2$，它们构成了矩阵 $T_2$。\n\n**初始化步骤：**\n\n首先，我们计算初始残差 $r_0$：\n$$\nr_0 = b - Ax_0 = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} - \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}\n$$\n接下来，我们计算 $r_0$ 的欧几里得范数以求得 $\\beta_1$，然后将 $r_0$ 归一化以得到 $v_1$：\n$$\n\\beta_1 = \\|r_0\\|_2 = \\sqrt{1^2 + 0^2 + 0^2} = 1\n$$\n$$\nv_1 = \\frac{r_0}{\\beta_1} = \\frac{1}{1} \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}\n$$\n问题陈述定义了 $v_1=r_0/\\|r_0\\|$，这与我们的初始化一致。\n\n**第一次 Lanczos 迭代 ($j=1$):**\n\n我们计算 $w_1 = Av_1$：\n$$\nw_1 = Av_1 = \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix}\n$$\n第一个对角系数 $\\alpha_1$ 是 $w_1$ 在 $v_1$ 上的投影：\n$$\n\\alpha_1 = v_1^T w_1 = \\begin{pmatrix}1  0  0\\end{pmatrix} \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix} = (1)(2) + (0)(-1) + (0)(0) = 2\n$$\n现在我们计算下一步的未归一化向量。对于 $j=1$，递推关系为 $\\tilde{v}_2 = w_1 - \\alpha_1 v_1 - \\beta_1 v_0$。由于 $v_0 = \\mathbf{0}$，这简化为：\n$$\n\\tilde{v}_2 = w_1 - \\alpha_1 v_1 = \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix} - 2 \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix}\n$$\n第一个非对角系数 $\\beta_2$ 是这个向量的范数：\n$$\n\\beta_2 = \\|\\tilde{v}_2\\|_2 = \\sqrt{0^2 + (-1)^2 + 0^2} = 1\n$$\n由于 $\\beta_2 \\neq 0$，我们求得第二个标准正交基向量 $v_2$：\n$$\nv_2 = \\frac{\\tilde{v}_2}{\\beta_2} = \\frac{1}{1} \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix}\n$$\n\n**第二次 Lanczos 迭代 ($j=2$):**\n\n我们计算 $w_2 = Av_2$：\n$$\nw_2 = Av_2 = \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ -2 \\\\ 1\\end{pmatrix}\n$$\n第二个对角系数 $\\alpha_2$ 是 $w_2$ 在 $v_2$ 上的投影：\n$$\n\\alpha_2 = v_2^T w_2 = \\begin{pmatrix}0  -1  0\\end{pmatrix} \\begin{pmatrix}1 \\\\ -2 \\\\ 1\\end{pmatrix} = (0)(1) + (-1)(-2) + (0)(1) = 2\n$$\n问题只要求构造 $T_2$，所以我们不需要计算 $\\beta_3$ 或 $v_3$。\n\n**构造和计算 $T_2$：**\n\n由 Lanczos 过程生成的 $k \\times k$ 三对角矩阵 $T_k$ 的形式如下：\n$$\nT_k = \\begin{pmatrix}\n\\alpha_1  \\beta_2   \\\\\n\\beta_2  \\alpha_2  \\ddots  \\\\\n \\ddots  \\ddots  \\beta_k \\\\\n  \\beta_k  \\alpha_k\n\\end{pmatrix}\n$$\n对于 $k=2$，使用我们计算出的系数（$\\alpha_1=2$，$\\beta_2=1$，$\\alpha_2=2$），矩阵 $T_2$ 为：\n$$\nT_2 = \\begin{pmatrix}\n\\alpha_1  \\beta_2 \\\\\n\\beta_2  \\alpha_2\n\\end{pmatrix} = \\begin{pmatrix}\n2  1 \\\\\n1  2\n\\end{pmatrix}\n$$\n最后一步是计算 $T_2$ 的行列式：\n$$\n\\det(T_2) = (\\alpha_1)(\\alpha_2) - (\\beta_2)^2 = (2)(2) - (1)^2 = 4 - 1 = 3\n$$\n三对角矩阵 $T_2$ 的行列式是 $3$。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "Lanczos 算法可能在少于 $n$ 步时终止，这种现象被称为提前终止或“幸运中断”（lucky breakdown）。这未必是算法的失败，反而常常能揭示深刻的结构性信息，即初始向量位于矩阵的一个不变子空间内。本练习  展示了一个精心构建的场景来阐释这一行为，演示了当算法完全探索了该不变子空间后如何自然终止，以及得到的里兹值（Ritz values）如何精确地对应于该子空间内的特征值。",
            "id": "3246897",
            "problem": "考虑一个实对称矩阵 $A \\in \\mathbb{R}^{4 \\times 4}$ 和一个非零初始向量 $b \\in \\mathbb{R}^{4}$，它们由下式给出\n$$\nA \\;=\\; \\begin{pmatrix}\n4  0  0  0 \\\\\n0  6  0  0 \\\\\n0  0  2  0 \\\\\n0  0  0  11\n\\end{pmatrix},\n\\qquad\nb \\;=\\; \\begin{pmatrix}\n2 \\\\ 1 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n子空间 $\\mathcal{S} \\;=\\; \\mathrm{span}\\{e_{1},e_{2}\\}$ 是 $A$ 的一个不变子空间，且 $b \\in \\mathcal{S}$。使用克雷洛夫子空间 $\\mathcal{K}_{k}(A,b)$ 和用于对称矩阵特征值近似的 Lanczos 方法的基本定义，从 $b$ 开始应用 Lanczos 迭代，构造前几个标准正交 Lanczos 向量以及相关的对称三对角投影 $T$，直到由于不变性而发生提前终止。然后确定最大的里兹值，其定义为终止时产生的三对角矩阵 $T$ 的最大特征值。\n\n将您的最终答案以单个实数值的形式提供。无需四舍五入；给出精确值。不要包含单位。",
            "solution": "用于对称矩阵的 Lanczos 方法通过三项递推为克雷洛夫子空间 $\\mathcal{K}_{k}(A,b) = \\mathrm{span}\\{b, Ab, \\dots, A^{k-1}b\\}$ 构造一个标准正交基 $\\{q_{1}, q_{2}, \\dots\\}$。在每一步中，它形成一个对称三对角矩阵 $T$，其元素是递推系数 $\\alpha_{j}$ 和 $\\beta_{j}$，而 $T$ 的特征值就是近似 $A$ 的特征值的里兹值。\n\n我们从不变子空间的观察开始。由于 $A$ 是对角矩阵，\n$$\nA = \\mathrm{diag}(4,6,2,11),\n$$\n子空间 $\\mathcal{S} = \\mathrm{span}\\{e_{1},e_{2}\\}$ 是不变的，因为 $A e_{1} \\in \\mathcal{S}$ 且 $A e_{2} \\in \\mathcal{S}$。因为 $b = \\begin{pmatrix}2 \\\\ 1 \\\\ 0 \\\\ 0\\end{pmatrix}$ 位于 $\\mathcal{S}$ 中，所以 $\\mathcal{K}_{k}(A,b)$ 中的每个向量都保持在 $\\mathcal{S}$ 内。因此，克雷洛夫序列的最大维数最多为 $2$，并且 Lanczos 过程将以 $\\beta_{3} = 0$ 提前终止。\n\n我们现在显式地执行迭代。将 $b$ 标准化以获得 $q_1$：\n$$\n\\|b\\| = \\sqrt{2^{2} + 1^{2} + 0^{2} + 0^{2}} = \\sqrt{5}, \\qquad q_{1} = \\frac{b}{\\|b\\|} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\nLanczos 步骤 1：\n- 计算 $w_1 = A q_{1}$：\n$$\nw_1 = A q_{1} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 4 \\cdot 2 \\\\ 6 \\cdot 1 \\\\ 2 \\cdot 0 \\\\ 11 \\cdot 0 \\end{pmatrix} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 8 \\\\ 6 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n- 计算第一个对角系数 $\\alpha_{1} = q_{1}^{\\top} w_1$：\n$$\n\\alpha_{1} = q_{1}^{\\top} A q_{1} = \\frac{1}{5} \\left(2 \\cdot 8 + 1 \\cdot 6\\right) = \\frac{22}{5}.\n$$\n- 构造残差 $r_{1} = w_1 - \\alpha_{1} q_{1}$：\n$$\nr_{1} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 8 \\\\ 6 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{22}{5} \\cdot \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} 40-44 \\\\ 30-22 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n- 次对角系数 $\\beta_{2} = \\|r_{1}\\|$：\n$$\n\\beta_{2} = \\left\\| \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix} \\right\\| = \\frac{1}{5 \\sqrt{5}} \\sqrt{(-4)^{2} + 8^{2}} = \\frac{1}{5 \\sqrt{5}} \\sqrt{16 + 64} = \\frac{\\sqrt{80}}{5 \\sqrt{5}} = \\frac{4 \\sqrt{5}}{5 \\sqrt{5}} = \\frac{4}{5}.\n$$\n- 标准化以得到 $q_{2} = r_{1} / \\beta_{2}$：\n$$\nq_{2} = \\frac{ \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix} }{ \\frac{4}{5} } = \\frac{1}{4 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n\nLanczos 步骤 2：\n- 计算 $w_2 = A q_{2}$：\n$$\nw_2 = A q_{2} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 4 \\cdot (-1) \\\\ 6 \\cdot 2 \\\\ 2 \\cdot 0 \\\\ 11 \\cdot 0 \\end{pmatrix} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -4 \\\\ 12 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n- 计算第二个对角系数 $\\alpha_{2} = q_{2}^{\\top} w_{2}$：\n$$\n\\alpha_{2} = q_{2}^{\\top} A q_{2} = \\left(\\frac{1}{\\sqrt{5}} \\begin{pmatrix} -1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}\\right)^{\\!\\top} \\left( \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -4 \\\\ 12 \\\\ 0 \\\\ 0 \\end{pmatrix} \\right) = \\frac{1}{5} ((-1)(-4) + 2 \\cdot 12) = \\frac{28}{5}.\n$$\n- 构造残差 $r_{2} = w_2 - \\alpha_{2} q_{2} - \\beta_{2} q_{1}$：\n$$\nr_{2} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -4 \\\\ 12 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{28}{5} \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{4}{5} \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{5\\sqrt{5}} \\left[ \\begin{pmatrix} -20 \\\\ 60 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} -28 \\\\ 56 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 8 \\\\ 4 \\\\ 0 \\\\ 0 \\end{pmatrix} \\right] = \\frac{1}{5\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\mathbf{0}.\n$$\n- 下一个次对角系数 $\\beta_{3} = \\|r_{2}\\| = 0$。\n\n这就是由于初始向量 $b$ 位于不变子空间 $\\mathcal{S}$ 中而导致的提前终止。\n\n终止时的三对角矩阵 $T$ 是一个 $2 \\times 2$ 矩阵 $T_2$：\n$$\nT_2 = \\begin{pmatrix}\n\\alpha_{1}  \\beta_{2} \\\\\n\\beta_{2}  \\alpha_{2}\n\\end{pmatrix} =\n\\begin{pmatrix}\n\\frac{22}{5}  \\frac{4}{5} \\\\\n\\frac{4}{5}  \\frac{28}{5}\n\\end{pmatrix}.\n$$\n里兹值是 $T_2$ 的特征值，通过求解以下方程得到\n$$\n\\det( T_2 - \\lambda I ) = 0\n\\;\\;\\Longleftrightarrow\\;\\;\n\\left(\\frac{22}{5} - \\lambda\\right)\\!\\left(\\frac{28}{5} - \\lambda\\right) - \\left(\\frac{4}{5}\\right)^{2} = 0.\n$$\n展开得到\n$$\n\\lambda^{2} - \\left( \\frac{22}{5} + \\frac{28}{5} \\right) \\lambda + \\frac{22}{5} \\cdot \\frac{28}{5} - \\frac{16}{25}\n= \\lambda^{2} - 10 \\lambda + \\frac{616-16}{25} = \\lambda^{2} - 10 \\lambda + 24 = 0,\n$$\n其因式分解为 $(\\lambda-6)(\\lambda-4)=0$，根为\n$$\n\\lambda \\in \\{4, 6\\}.\n$$\n因此，终止时产生的最大里兹值为 $6$。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "Lanczos 迭代不仅能用于求解线性系统或寻找少数极端特征值，它更是一个探测大型矩阵谱性质的强大计算工具。这个高级实践将数值线性代数与作为现代物理学和数学基石的随机矩阵理论联系起来。您将通过编程实现 Lanczos 算法，从一个大型维格纳矩阵（Wigner matrix）中生成里兹值（Ritz values），并观察它们的分布如何经验性地收敛到著名的维格纳半圆律，从而体验如何将该算法用作科学发现的工具 。",
            "id": "3590628",
            "problem": "构建一个完整的、可运行的程序，用于研究维格纳矩阵 (Wigner matrix) 的兰索斯生成谱测度 (Lanczos-generated spectral measures) 收敛于半圆律 (semicircle law) 的现象。该研究必须基于对称矩阵的数值线性代数第一性原理，并且不得依赖任何预先指定的递推公式。程序必须实现以下组件，并针对指定的测试套件生成包含量化指标的单行输出。\n\n使用的基本原理：\n- 克雷洛夫子空间 (Krylov subspaces) 的概念：给定一个实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和一个起始向量 $v_1 \\in \\mathbb{R}^n$ 且 $\\|v_1\\|_2 = 1$，其 $k$ 阶克雷洛夫子空间为 $K_k(A, v_1) = \\operatorname{span}\\{v_1, Av_1, A^2 v_1, \\dots, A^{k-1} v_1\\}$。\n- 在为 $K_k(A, v_1)$ 构建标准正交基时，正交化和三项递推是对称性和正交性约束的结果。\n- 与单位向量相关的谱测度：对于一个具有谱分解 $A = Q \\Lambda Q^\\top$ 的实对称矩阵 $A$，其相对于单位向量 $v_1$ 的谱测度是一个定义在 $\\mathbb{R}$ 上的概率测度 $\\mu_{v_1}$，定义为 $\\mu_{v_1}(\\{ \\lambda_i \\}) = (q_i^\\top v_1)^2$，其中 $q_i$ 是特征向量，$\\lambda_i$ 是 $A$ 的特征值。\n- 高斯正交系综 (Gaussian Orthogonal Ensemble, GOE) 缩放：一个维格纳矩阵，其元素来自独立的标准正态分布，并经过缩放使得非对角线方差为 $1/n$、对角线方差为 $2/n$，当 $n \\to \\infty$ 时，其经验特征值分布收敛于半圆律。\n- 半圆律：对于GOE缩放，在区间 $[-2, 2]$ 上的极限特征值密度由概率密度函数 $\\rho(x) = \\frac{1}{2\\pi} \\sqrt{4 - x^2}$ 给出（对于 $x \\in [-2, 2]$），其他情况下 $\\rho(x) = 0$。\n\n问题描述：\n1. 使用高斯分布的元素和GOE缩放，构造一个随机的实对称维格纳矩阵 $A \\in \\mathbb{R}^{n \\times n}$。具体地，生成一个矩阵 $G$，其元素是独立同分布的标准正态随机变量，然后定义 $A = \\frac{1}{\\sqrt{2n}} (G + G^\\top)$。这确保了非对角线方差等于 $1/n$，对角线方差等于 $2/n$。\n2. 实现针对对称矩阵的兰索斯迭代 (Lanczos iteration)，起始向量 $v_1$ 从标准正态分布中抽取然后进行归一化。迭代必须为克雷洛夫子空间构建一个标准正交基，并生成一个对称三对角矩阵 $T_k \\in \\mathbb{R}^{k \\times k}$（兰索斯三对角矩阵），使得瑞利-里兹 (Rayleigh-Ritz) 近似将 $A$ 投影到 $K_k(A, v_1)$ 上。该构造必须由正交性和对称性原理驱动，并且必须包含一个数值崩溃保护机制，以防止子空间因有限精度或精确崩溃而不再增长。\n3. 对于给定的 $k$，计算里兹值 (Ritz values)，即三对角矩阵 $T_k$ 的特征值。使用不同的随机起始向量 $v_1$ 进行多次独立的兰索斯运行，并聚合所有里兹值，以形成一个经验里兹值样本集。这近似了由随机起始向量引起的平均谱测度。\n4. 通过在区间 $[-2, 2]$ 上使用指定数量的箱子 (bins) 进行直方图统计，估计这些聚合里兹值的经验密度。设直方图的中点为 $\\{x_j\\}$，箱宽为 $\\Delta x$。将该直方图解释为一个在 $[-2, 2]$ 上积分为 $1$ 的经验概率密度。\n5. 通过在箱格点上近似计算 $L^1$ 差异，来量化经验密度与半圆律密度 $\\rho(x)$ 之间的差异：\n   $$E(k) = \\sum_{j} \\left| \\hat{\\rho}_k(x_j) - \\rho(x_j) \\right| \\, \\Delta x,$$\n   其中 $\\hat{\\rho}_k$ 是由子空间维度为 $k$ 时的聚合里兹值构建的经验直方图密度。\n\n测试套件和参数：\n- 使用单一矩阵大小 $n = 300$。\n- 使用固定的最大兰索斯阶数 $k_{\\max} = 50$，并对每个起始向量进行一次直到 $k_{\\max}$ 的兰索斯运行。对于每个测试用例 $k$，使用 $k$ 阶的前导主子矩阵来获取其里兹值。这确保了在不同 $k$ 值下的计算效率和一致性。\n- 使用 $s = 32$ 个独立的随机起始向量 $v_1$，每个向量都从标准正态分布中抽取并归一化为单位范数。\n- 在区间 $[-2, 2]$ 上使用固定的直方图箱数 $b = 75$。\n- 为了可复现性，使用确定性的随机种子：用 $12345$ 为随机数生成器设定种子。\n- 子空间维度 $k$ 的测试用例：\n  - 用例 1：$k = 3$（边界-小克雷洛夫维度）。\n  - 用例 2：$k = 15$（中等维度）。\n  - 用例 3：$k = 50$（最大维度）。\n\n答案规格：\n- 对每个测试用例 $k$，计算 $E(k)$ 作为一个浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，并按测试用例 $k = 3$, $k = 15$, $k = 50$ 的顺序排列，例如 `[E(3),E(15),E(50)]`。\n- 不涉及物理单位；不涉及角度；不涉及百分比。\n\n科学真实性：\n- 矩阵 $A$ 的构造必须遵循所述的GOE缩放。\n- 兰索斯迭代必须仅使用对称矩阵在克雷洛夫子空间中的正交性原理来实现，不得依赖问题陈述中给出的任何预先指定的递推公式。\n- 直方图必须进行归一化，以在 $[-2, 2]$ 上产生一个有效的概率密度。\n\n实现约束：\n- 最终程序必须是自包含的，不得读取任何输入，并且仅使用指定的运行时环境。",
            "solution": "本问题的目标是数值研究维格纳矩阵 (Wigner matrix) 的谱测度向维格纳半圆律收敛的过程。这是通过从第一性原理实现兰索斯迭代，利用里兹值 (Ritz values) 来近似谱测度来完成的。\n\n首先，我们定义求解所需的数学和算法组件。\n\n**1. 维格纳矩阵的构造**\n我们从高斯正交系综 (Gaussian Orthogonal Ensemble, GOE) 中构造一个实对称维格纳矩阵 $A \\in \\mathbb{R}^{n \\times n}$。问题指定了基于一个矩阵 $G \\in \\mathbb{R}^{n \\times n}$ 的构造方法，其中元素 $G_{ij}$ 是独立同分布 (i.i.d.) 的标准正态随机变量，$G_{ij} \\sim \\mathcal{N}(0, 1)$。维格纳矩阵 $A$ 定义为：\n$$\nA = \\frac{1}{\\sqrt{2n}} (G + G^\\top)\n$$\n这种构造确保了 $A$ 的元素具有正确的方差缩放。对于非对角线元素 ($i \\neq j$)，$A_{ij} = \\frac{1}{\\sqrt{2n}}(G_{ij} + G_{ji})$。由于 $G_{ij}$ 和 $G_{ji}$ 是独立的，其方差为 $\\text{Var}(A_{ij}) = \\frac{1}{2n}(\\text{Var}(G_{ij}) + \\text{Var}(G_{ji})) = \\frac{1}{2n}(1 + 1) = \\frac{1}{n}$。对于对角线元素 ($i = j$)，$A_{ii} = \\frac{1}{\\sqrt{2n}}(G_{ii} + G_{ii}) = \\sqrt{\\frac{2}{n}}G_{ii}$。其方差为 $\\text{Var}(A_{ii}) = \\frac{2}{n}\\text{Var}(G_{ii}) = \\frac{2}{n}$。当矩阵大小 $n \\to \\infty$ 时，这样构造的矩阵的经验特征值分布收敛于半圆律。\n\n**2. 基于第一性原理的兰索斯迭代**\n兰索斯算法是为克雷洛夫子空间 $K_k(A, v_1) = \\operatorname{span}\\{v_1, Av_1, \\dots, A^{k-1}v_1\\}$ 构建一个标准正交基 $\\{v_1, v_2, \\dots, v_k\\}$ 的过程。对于对称矩阵 $A$，兰索斯迭代的一个关键特性是正交化过程简化为一个三项递推关系。这个递推关系生成一个对称三对角矩阵 $T_k$，它是 $A$ 在克雷洛夫子空间 $K_k$ 上的投影。\n\n该算法从给定的单位范数向量 $v_1$ 开始，按如下步骤进行：\n1.  初始化：设 $v_0 = 0 \\in \\mathbb{R}^n$ 和 $\\beta_1 = 0$。\n2.  对 $j = 1, 2, \\dots, k$ 进行迭代：\n    a. 计算下一个克雷洛夫向量：$w_j = A v_j$。\n    b. 将向量 $w_j$ 与先前生成的基向量进行正交化。由于 $A$ 的对称性，$w_j$ 只与 $v_j$ 和 $v_{j-1}$ 相关。$T_k$ 的对角元素 $\\alpha_j$ 是 $w_j$ 在 $v_j$ 上的投影：\n       $$\n       \\alpha_j = v_j^\\top w_j = v_j^\\top A v_j\n       $$\n    c. 通过减去沿 $v_j$ 和 $v_{j-1}$ 的分量来计算残差向量：\n       $$\n       r_j = w_j - \\alpha_j v_j - \\beta_j v_{j-1}\n       $$\n    d. 该残差的范数给出了次对角线元素 $\\beta_{j+1}$：\n       $$\n       \\beta_{j+1} = \\|r_j\\|_2\n       $$\n    e. 如果 $\\beta_{j+1}$ 小于一个数值容差（接近于零），迭代终止。这表示已找到一个不变子空间（发生崩溃）。\n    f. 通过归一化得到下一个标准正交基向量 $v_{j+1}$：\n       $$\n       v_{j+1} = \\frac{r_j}{\\beta_{j+1}}\n       $$\n这个过程生成对称三对角矩阵 $T_k$ 的对角元素 $\\alpha_1, \\dots, \\alpha_k$ 和次对角元素 $\\beta_2, \\dots, \\beta_k$。\n\n**3. 里兹值和谱测度近似**\n三对角矩阵 $T_k$ 的特征值被称为里兹值。它们是原始矩阵 $A$ 特征值的近似。与起始向量 $v_1$ 相关的谱测度 $\\mu_{v_1}$ 是一个支撑在 $A$ 特征值上的离散测度。在随机矩阵理论中，对于大的 $n$，对于一个“典型”的 $v_1$，该测度预计会近似于全局态密度。$T_k$ 的里兹值分布为该谱测度提供了一个有限维近似。通过聚合来自 $s$ 次独立兰索斯运行的里兹值（每次运行都从不同的随机单位向量 $v_1$ 开始），我们获得了一个近似于起始向量选择下的平均谱测度的经验样本。\n\n对于 $s$ 次运行中的每一次，我们都执行兰索斯迭代直到最大阶数 $k_{\\max}=50$，生成一个三对角矩阵 $T_{k_{\\max}}$。对于每个测试用例维度 $k \\in \\{3, 15, 50\\}$，我们使用 $T_{k_{\\max}}$ 的 $k \\times k$ 阶前导主子矩阵来找到相应的里兹值。\n\n**4. 经验密度与差异计算**\n对于给定的 $k$，聚合的里兹值集合被用来构建一个经验概率密度函数 $\\hat{\\rho}_k(x)$。这是通过在区间 $[-2, 2]$ 上创建一个有 $b=75$ 个箱的直方图来完成的。设箱宽为 $\\Delta x = (2 - (-2))/b = 4/b$。如果第 $j$ 个箱中有 $N_j$ 个里兹值，总值为 $N_{\\text{total}} = s \\times k$，则直方图条的归一化高度为：\n$$\n\\hat{\\rho}_k(x_j) = \\frac{N_j}{N_{\\text{total}} \\cdot \\Delta x}\n$$\n其中 $x_j$ 是第 $j$ 个箱的中点。这确保了 $\\sum_j \\hat{\\rho}_k(x_j) \\Delta x \\approx 1$。\n\n理论上的极限分布是维格纳半圆律，其概率密度函数为：\n$$\n\\rho(x) = \\frac{1}{2\\pi} \\sqrt{4 - x^2}, \\quad x \\in [-2, 2]\n$$\n经验密度与理论密度之间的差异使用它们差的 $L^1$ 范数的离散近似来量化：\n$$\nE(k) = \\sum_{j=1}^{b} \\left| \\hat{\\rho}_k(x_j) - \\rho(x_j) \\right| \\Delta x\n$$\n对每个测试用例 $k$ 计算这个值 $E(k)$。\n\n整个过程通过设定随机数生成器的种子来确定性地执行，以确保可复现性。该问题利用数值线性代数的原理，进行了一项植根于随机矩阵理论的计算实验。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Constructs a Wigner matrix, applies Lanczos iteration to investigate\n    convergence of its spectral measure to the semicircle law, and computes\n    the L1 discrepancy for specified Krylov subspace dimensions.\n    \"\"\"\n    # Test suite and parameters\n    n = 300\n    k_max = 50\n    s = 32\n    b = 75\n    seed = 12345\n    test_ks = [3, 15, 50]\n\n    # Initialize random number generator for reproducibility\n    rng = np.random.default_rng(seed)\n\n    # 1. Construct the random real symmetric Wigner matrix A\n    G = rng.standard_normal((n, n))\n    A = (G + G.T) / np.sqrt(2 * n)\n\n    # Store results of the s Lanczos runs\n    all_alphas = []\n    all_betas = []\n\n    def lanczos_iteration(A_matrix, start_vector, max_iter):\n        \"\"\"\n        Performs Lanczos iteration from first principles for a symmetric matrix.\n\n        Args:\n            A_matrix (np.ndarray): The symmetric matrix.\n            start_vector (np.ndarray): The starting unit vector.\n            max_iter (int): The maximum number of iterations.\n\n        Returns:\n            tuple: A tuple containing arrays of diagonal (alphas) and\n                   sub-diagonal (betas) elements of the tridiagonal matrix.\n        \"\"\"\n        dim = A_matrix.shape[0]\n        alphas = np.zeros(max_iter)\n        betas = np.zeros(max_iter - 1)\n        \n        v_prev = np.zeros(dim)\n        v_curr = np.copy(start_vector)\n        beta_prev = 0\n        \n        # Numerical tolerance for breakdown detection\n        breakdown_tol = 1e-12\n\n        for j in range(max_iter):\n            w = A_matrix @ v_curr\n            alpha = np.dot(v_curr, w)\n            alphas[j] = alpha\n            \n            # Orthogonalize against previous two vectors\n            residual = w - alpha * v_curr - beta_prev * v_prev\n            \n            if j  max_iter - 1:\n                beta = np.linalg.norm(residual)\n                if beta  breakdown_tol:\n                    # Premature breakdown, though unlikely for this problem setup\n                    betas[j:] = 0\n                    break\n                \n                betas[j] = beta\n                v_prev = v_curr\n                v_curr = residual / beta\n                beta_prev = beta\n        \n        return alphas, betas\n\n    # 2. Perform s independent Lanczos runs\n    for _ in range(s):\n        # Generate and normalize a random starting vector\n        v1_raw = rng.standard_normal(n)\n        v1 = v1_raw / np.linalg.norm(v1_raw)\n\n        # Run Lanczos up to k_max\n        alphas, betas = lanczos_iteration(A, v1, k_max)\n        all_alphas.append(alphas)\n        all_betas.append(betas)\n    \n    # Store the final error values E(k)\n    error_results = []\n    \n    # Define interval and bin properties for histogram\n    interval = [-2.0, 2.0]\n    bin_width = (interval[1] - interval[0]) / b\n    bins = np.linspace(interval[0], interval[1], b + 1)\n    bin_midpoints = (bins[:-1] + bins[1:]) / 2\n\n    # 3. Process each test case for k\n    for k in test_ks:\n        # Aggregate all Ritz values for the current k\n        all_ritz_values = []\n        for i in range(s):\n            # Extract the leading principal submatrix T_k\n            alpha_k = all_alphas[i][:k]\n            beta_k = all_betas[i][:k-1]\n            \n            # Compute Ritz values (eigenvalues of T_k)\n            ritz_values = eigh_tridiagonal(alpha_k, beta_k, eigvals_only=True)\n            all_ritz_values.extend(ritz_values)\n        \n        # 4. Estimate empirical density via histogram\n        counts, _ = np.histogram(all_ritz_values, bins=bins)\n        \n        total_ritz_values = s * k\n        empirical_density = counts / (total_ritz_values * bin_width)\n\n        # 5. Compute semicircle density and L1 discrepancy\n        # np.sqrt can produce NaN for arguments outside [-2, 2], but bin_midpoints are safe.\n        with np.errstate(invalid='ignore'): # Supress warnings if any value is slightly out\n            semicircle_density = (1 / (2 * np.pi)) * np.sqrt(4 - bin_midpoints**2)\n            semicircle_density = np.nan_to_num(semicircle_density) # Ensure stability\n\n        l1_error = np.sum(np.abs(empirical_density - semicircle_density)) * bin_width\n        error_results.append(l1_error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, error_results))}]\")\n\nsolve()\n```"
        }
    ]
}