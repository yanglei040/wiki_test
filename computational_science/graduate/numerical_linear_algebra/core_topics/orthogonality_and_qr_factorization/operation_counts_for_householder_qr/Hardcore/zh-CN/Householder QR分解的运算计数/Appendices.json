{
    "hands_on_practices": [
        {
            "introduction": "理解 Householder QR 分解的总运算成本，首先需要分析其核心构建模块的成本。本练习将推导将单个 Householder 反射矩阵 $H$ 应用于一个矩阵块所需的基本浮点运算次数。通过这个练习，你将掌握 Householder 变换中主要的计算量来源，即矩阵-向量乘法和秩-1 更新。",
            "id": "3562610",
            "problem": "考虑一个形式为 $H = I - \\tau v v^{T}$ 的单个实数豪斯霍尔德反射矩阵 $H \\in \\mathbb{R}^{m \\times m}$，其中 $v \\in \\mathbb{R}^{m}$ 且 $\\tau \\in \\mathbb{R}$，将其从左侧应用于一个稠密块 $B \\in \\mathbb{R}^{m \\times s}$。从恒等式 $H B = B - \\tau v (v^{T} B)$ 和浮点运算的定义出发，推导计算 $H B$ 的渐近运算量。\n\n采用以下科学上标准且广泛使用的基础线性代数子程序 (BLAS) 的成本模型。在实数算术中：\n- 一个长度为 $m$ 的内积的成本计为 $m$ 次复合的融合乘加（简称 FMA）运算，即每个乘加对计为一次浮点运算，其主导成本为 $m$。\n- 一个大小为 $m \\times s$ 的秩-1 更新的成本计为 $m s$ 次复合的 FMA 运算，即每个元素的乘加对计为一次浮点运算。\n- 对 $k$ 个元素进行的标量-向量和标量-矩阵数乘的成本为 $k$ 次浮点运算。\n\n在此模型下，使用由 $H B = B - \\tau v (v^{T} B)$ 所隐含的最小三步算法，计算评估 $H B$ 所需的浮点运算总数：\n1. 计算行向量 $w^{T} := v^{T} B \\in \\mathbb{R}^{1 \\times s}$。\n2. 对 $w^{T}$ 进行数乘：$w^{T} := \\tau w^{T}$。\n3. 执行秩-1 更新 $B := B - v w^{T}$。\n\n您的答案应为一个关于 $m$ 和 $s$ 的单一闭式表达式，只包含 $m$ 和 $s$ 的主项（即必须省略 $m$ 和 $s$ 的低阶项）。最终答案必须是一个没有单位的单一解析表达式。验证您的结果是否与将单个豪斯霍尔德反射矩阵应用于一个 $m \\times s$ 块时所报告的标准主项相匹配。",
            "solution": "我们从豪斯霍尔德反射矩阵 $H = I - \\tau v v^{T}$ 对矩阵 $B \\in \\mathbb{R}^{m \\times s}$ 的定义性作用开始：\n$$\nH B \\;=\\; B - \\tau v (v^{T} B).\n$$\n该表达式提出了一个自然的三步算法：计算中间行向量 $w^{T} := v^{T} B \\in \\mathbb{R}^{1 \\times s}$，用 $\\tau$ 对其进行数乘，然后执行一个秩-1 修正 $B := B - v w^{T}$。\n\n我们在所述模型下计算浮点运算次数，该模型将每次融合乘加视为单次运算。在推导基于豪斯霍尔德算法的主项运算量时，此模型是标准的，并且与二级基础线性代数子程序 (BLAS) 中的计算组织方式一致，其中主导成本可归因于带有乘加融合的矩阵-向量和秩-1 运算。\n\n分步计算：\n1. 计算 $w^{T} := v^{T} B$。这是一个块形式的左矩阵-向量积，等价于 $w = B^{T} v$，产生一个 $\\mathbb{R}^{s}$ 中的向量。它可实现为 $s$ 个长度为 $m$ 的内积。在复合融合乘加模型下，每个长度为 $m$ 的内积成本为 $m$ 次浮点运算（每个乘加对一次）。因此，这一步的总主导成本是\n$$\nm s.\n$$\n\n2. 对 $w^{T}$ 进行数乘：$w^{T} := \\tau w^{T}$。这是一个对 $s$ 个元素进行的标量-向量数乘，其成本为\n$$\ns.\n$$\n与主导的双线性项相比，这是关于 $m$ 和 $s$ 的低阶项。\n\n3. 执行秩-1 更新 $B := B - v w^{T}$。这将 $B$ 的每个元素更新为 $b_{ij} := b_{ij} - v_{i} w_{j}$。在复合融合乘加模型下，每个元素的每次更新计为一次运算，共有 $m s$ 个元素。因此，这一步的主导成本是\n$$\nm s.\n$$\n\n将三部分的贡献相加，总和为\n$$\nm s \\;+\\; s \\;+\\; m s \\;=\\; 2 m s \\;+\\; s.\n$$\n根据问题要求，只报告关于 $m$ 和 $s$ 的主项，我们省略低阶项 $s$。因此，在所述模型下，将单个豪斯霍尔德反射矩阵应用于一个 $m \\times s$ 块的主项运算量为\n$$\n2 m s.\n$$\n\n这与基于豪斯霍尔德的 QR 分解的运算分析中使用的标准主项计数相匹配，其中将一个反射矩阵应用于一个后续的 $m \\times s$ 块会产生 $2 m s$ 次浮点运算（在复合融合乘加的意义上）的主导成本，并省略了低阶项。为完整起见，我们注意到，在将乘法和加法计为独立运算的替代模型下，详细的计数将是 $(2 m s - s) + s + 2 m s = 4 m s$，这仍然验证了主导的缩放关系是关于 $m$ 和 $s$ 的双线性的，但由于运算模型的不同，其常数前置因子也不同。在问题指定的模型下，主项是 $2 m s$。",
            "answer": "$$\\boxed{2 m s}$$"
        },
        {
            "introduction": "在掌握了单步应用的成本之后，下一步是将其推广到整个 QR 分解过程。本练习要求你对一个 $m \\times n$（其中 $m \\lt n$）的“宽”矩阵，通过对算法的每一步成本进行积分（求和），推导出整个 Householder QR 分解过程的主要运算量。这个过程将展示如何通过对算法迭代的分析，得到一个关于矩阵维度 $m$ 和 $n$ 的三次多项式成本。",
            "id": "3562607",
            "problem": "考虑一个实矩阵 $A \\in \\mathbb{R}^{m \\times n}$，其中 $m  n$。用于正交三角分解（QR分解）的经典 Householder 方法应用 $m$ 次连续的 Householder 反射，将 $A$ 化为 $A = Q R$ 的形式，其中 $Q \\in \\mathbb{R}^{m \\times m}$ 是正交矩阵，$R \\in \\mathbb{R}^{m \\times n}$ 是上梯形矩阵。在第 $k$ 步（$1 \\leq k \\leq m$），构造一个 Householder 向量 $v \\in \\mathbb{R}^{m - k + 1}$ 和一个标量 $\\beta \\in \\mathbb{R}$，使得尾部子块 $A_{k:m,\\,k:n}$ 通过秩一变换 $A_{k:m,\\,k:n} \\leftarrow A_{k:m,\\,k:n} - v \\left( \\beta \\, v^{\\top} A_{k:m,\\,k:n} \\right)$ 进行更新。\n\n仅使用点积和标量-向量乘法加向量运算的基本定义，并将每次浮点加法和乘法计为一次浮点运算（flop），同时忽略构造 Householder 向量所涉及的除法、平方根和小的常数开销，推导出一个关于 $m$ 和 $n$ 的闭式表达式，表示该过程在 $m$ 步后停止时的主导运算计数。你的最终答案必须是一个关于 $m$ 和 $n$ 的单一闭式解析表达式，给出在整个 $m$ 步中更新尾部子块的主导浮点运算计数。最终答案中不要包含任何单位。",
            "solution": "用户希望找到对一个实矩阵 $A \\in \\mathbb{R}^{m \\times n}$（其中 $m  n$）进行 Householder QR 分解时，其更新阶段的主导运算计数。\n\n首先验证问题，以确保其是适定的、有科学依据的和客观的。\n\n### 步骤 1：提取已知条件\n-   矩阵 $A \\in \\mathbb{R}^{m \\times n}$，其中 $m  n$。\n-   算法：使用 $m$ 次连续的 Householder 反射进行正交三角分解（$QR$）。\n-   结果：$A = QR$，其中 $Q \\in \\mathbb{R}^{m \\times m}$ 是正交矩阵，$R \\in \\mathbb{R}^{m \\times n}$ 是上梯形矩阵。\n-   算法步骤（$k$ 从 $1$ 到 $m$）：\n    -   构造一个 Householder 向量 $v \\in \\mathbb{R}^{m-k+1}$ 和一个标量 $\\beta \\in \\mathbb{R}$。\n    -   通过变换 $A_{k:m,\\,k:n} \\leftarrow A_{k:m,\\,k:n} - v \\left( \\beta \\, v^{\\top} A_{k:m,\\,k:n} \\right)$ 更新尾部子矩阵 $A_{k:m,\\,k:n}$。\n-   计数规则：\n    -   每次浮点加法和乘法计为一次浮点运算（flop）。\n    -   忽略构造 Householder 向量 $v$（涉及除法和平方根）的成本以及其他小的开销。\n-   目标：\n    -   推导在所有 $m$ 步中更新过程的主导运算计数的闭式表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题描述了针对行数少于列数的矩阵的标准 Householder QR 算法。更新规则正确地表示了从左侧应用 Householder 变换。这是数值线性代数中的一个基本课题。\n-   **适定性：** 问题陈述清晰。矩阵的维度、步数、确切的更新规则以及运算计数规则都已明确指定。要求“主导运算计数”是算法分析中的一个标准概念，指的是所得多项式表达式中的最高阶项。可以根据给定信息推导出唯一解。\n-   **客观性：** 问题以精确、无歧义的数学语言表述。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 求解推导\n总运算计数是 $k$ 从 $1$ 到 $m$ 的每一步更新成本的总和。我们将首先分析单步 $k$ 的浮点运算计数，然后将结果求和。\n\n在第 $k$ 步，操作是更新子矩阵 $A_{k:m,\\,k:n}$。我们将此子矩阵表示为 $A'$。\n$A'$ 的维度是 $p \\times q$，其中 $p = m - k + 1$ 且 $q = n - k + 1$。\nHouseholder 向量 $v$ 的维度为 $p$，即 $v \\in \\mathbb{R}^{m-k+1}$。\n更新由表达式给出：$A' \\leftarrow A' - v \\left( \\beta \\, v^{\\top} A' \\right)$。\n\n我们可以根据括号的指示将此更新分解为一系列基本运算：\n1.  **计算矩阵-向量乘积 $y^{\\top} = v^{\\top} A'$。**\n    -   $A'$ 是一个 $p \\times q$ 矩阵。$v^{\\top}$ 是一个 $1 \\times p$ 的行向量。结果 $y^{\\top}$ 是一个 $1 \\times q$ 的行向量。\n    -   $y^{\\top}$ 的 $q$ 个分量中的每一个都是向量 $v$（长度为 $p$）与 $A'$ 的一个列向量（长度为 $p$）的点积。\n    -   两个长度为 $p$ 的向量之间的点积需要 $p$ 次乘法和 $p-1$ 次加法。总计为 $p + (p-1) = 2p-1$ 次浮点运算。\n    -   由于 $A'$ 中有 $q$ 个列，此步骤的总浮点运算计数为 $q(2p-1)$ 次。\n\n2.  **计算标量-向量乘积 $u^{\\top} = \\beta y^{\\top}$。**\n    -   这涉及将标量 $\\beta$ 与行向量 $y^{\\top}$ 的 $q$ 个元素中的每一个相乘。\n    -   这需要 $q$ 次乘法，总计为 $q$ 次浮点运算。\n\n3.  **执行秩-1 更新 $A' \\leftarrow A' - v u^{\\top}$。**\n    -   此操作更新 $p \\times q$ 矩阵 $A'$ 的每个元素。\n    -   对于每个元素 $A'_{ij}$，更新为 $A'_{ij} \\leftarrow A'_{ij} - v_i u_j$。这包括一次乘法 ($v_i u_j$) 和一次减法。\n    -   对于 $pq$ 个元素中的每一个，浮点运算总数为 $2$，得出 $2pq$ 次浮点运算。\n\n第 $k$ 步的总浮点运算计数，记为 $C_k$，是这三个操作的浮点运算之和：\n$$C_k = q(2p-1) + q + 2pq = (2pq - q) + q + 2pq = 4pq$$\n将 $p$ 和 $q$ 用 $m$、$n$ 和 $k$ 表示的表达式代入：\n$$C_k = 4(m-k+1)(n-k+1)$$\n这是根据所提供规则，在第 $k$ 步更新的精确浮点运算计数。\n\n接下来，我们将此成本在算法的所有 $m$ 个步骤中（从 $k=1$到 $k=m$）求和。\n总浮点运算次数 $C = \\sum_{k=1}^{m} C_k = \\sum_{k=1}^{m} 4(m-k+1)(n-k+1)$。\n\n为简化此求和，我们引入一个新索引 $j = m-k+1$。\n-   当 $k=1$ 时，$j = m-1+1 = m$。\n-   当 $k=m$ 时，$j = m-m+1 = 1$。\n当 $k$ 从 $1$ 到 $m$ 时，$j$ 从 $m$ 递减到 $1$。求和可以重写为：\n$$C = \\sum_{j=1}^{m} 4j(n-(m-j+1)+1) = \\sum_{j=1}^{m} 4j(n-m+j)$$\n我们可以展开求和内的项：\n$$C = 4 \\sum_{j=1}^{m} (j(n-m) + j^2) = 4 \\left( (n-m) \\sum_{j=1}^{m} j + \\sum_{j=1}^{m} j^2 \\right)$$\n使用前 $m$ 个整数之和与前 $m$ 个平方数之和的标准公式：\n$\\sum_{j=1}^{m} j = \\frac{m(m+1)}{2}$\n$\\sum_{j=1}^{m} j^2 = \\frac{m(m+1)(2m+1)}{6}$\n将这些代入 $C$ 的表达式中：\n$$C = 4 \\left( (n-m)\\frac{m(m+1)}{2} + \\frac{m(m+1)(2m+1)}{6} \\right)$$\n现在，我们简化这个代数表达式：\n$$C = 4 \\left( \\frac{3m(m+1)(n-m)}{6} + \\frac{m(m+1)(2m+1)}{6} \\right)$$\n$$C = \\frac{4m(m+1)}{6} \\left( 3(n-m) + (2m+1) \\right)$$\n$$C = \\frac{2m(m+1)}{3} \\left( 3n - 3m + 2m + 1 \\right)$$\n$$C = \\frac{2m(m+1)(3n - m + 1)}{3}$$\n展开此表达式得到一个关于 $m$ 和 $n$ 的多项式：\n$$C = \\frac{2}{3}(m^2+m)(3n - m + 1) = \\frac{2}{3}(3nm^2 - m^3 + m^2 + 3nm - m^2 + m)$$\n$$C = \\frac{2}{3}(3nm^2 - m^3 + 3nm + m) = 2nm^2 - \\frac{2}{3}m^3 + 2nm + \\frac{2}{3}m$$\n问题要求“主导运算计数”。这对应于总浮点运算多项式表达式中总次数最高的项。项 $c \\cdot n^a m^b$ 的总次数是 $a+b$。\n-   $2nm^2$：次数 $1+2=3$\n-   $-\\frac{2}{3}m^3$：次数 $3$\n-   $2nm$：次数 $1+1=2$\n-   $\\frac{2}{3}m$：次数 $1$\n最高次数为 $3$。因此，主导运算计数由所有次数为 $3$ 的项组成。\n主导运算计数为 $2nm^2 - \\frac{2}{3}m^3$。\n这就是主导浮点运算计数的闭式解析表达式。",
            "answer": "$$\\boxed{2nm^2 - \\frac{2}{3}m^3}$$"
        },
        {
            "introduction": "为了在现代计算机上实现高性能，数值算法通常采用“分块”形式，以最大化利用高速缓存和 Level-3 BLAS（基本线性代数子程序）的效率。本练习将分析分块 Householder QR 分解中关键步驟的运算成本，即应用一个由多个 Householder 向量构成的“面板”变换。通过推导其以矩阵-矩阵乘法为主导的成本表达式，你将理解为什么分块算法在计算上更有效。",
            "id": "3562527",
            "problem": "考虑一个正交面板变换的分块Householder表示，其中面板变换写为紧凑的Watson–Yamaguchi (WY)形式 $Q_{\\text{panel}} = I - V T V^{T}$，其中 $V \\in \\mathbb{R}^{p \\times b}$ 包含 $b$ 个Householder向量，$T \\in \\mathbb{R}^{b \\times b}$ 是一个由这些向量构造的上三角矩阵。设 $C \\in \\mathbb{R}^{p \\times q}$ 表示一个待更新的拖尾矩阵，它通过左乘面板变换进行更新，$C \\leftarrow Q_{\\text{panel}} C$。在实数运算下，使用标准的浮点运算（flop）模型，其中每次标量乘法和每次标量加法计为一次flop。对于维度相容的 $m \\times k$ 和 $k \\times n$ 稠密矩阵-矩阵乘法，假设其成本为 $2 m n k$ flops；对于维度为 $b \\times b$ 的三角（上或下）矩阵与 $b \\times q$ 矩阵的乘法，假设其成本为 $b^{2} q$ flops。对于两个 $p \\times q$ 矩阵的按元素加法或减法，假设其成本为 $p q$ flops。\n\n从这些定义出发，推导将 $Q_{\\text{panel}}$ 左乘到 $C$ 上所需的总flop计数，用 $p$、$q$ 和 $b$ 表示。你的最终答案必须是关于 $p$、$q$ 和 $b$ 的单个闭式解析表达式。此外，请指出哪个3级基本线性代数子程序 (BLAS) 项在成本中占主导地位。仅提供最终表达式；无需舍入。",
            "solution": "该问题陈述经核实是科学合理的、适定的、客观且完整的。它提出了一个数值线性代数中的标准问题，涉及应用分块Householder变换的计算成本。所有必要的定义、维度和成本模型均已提供，从而可以直接且无歧义地进行推导。\n\n任务是确定通过左乘面板变换 $Q_{\\text{panel}}$ 来更新拖尾矩阵 $C \\in \\mathbb{R}^{p \\times q}$ 的总浮点运算（flop）次数。该变换以紧凑的Watson-Yamaguchi (WY)形式给出，$Q_{\\text{panel}} = I - V T V^{T}$，其中 $V \\in \\mathbb{R}^{p \\times b}$，$T \\in \\mathbb{R}^{b \\times b}$ 是一个上三角矩阵。更新操作为 $C \\leftarrow Q_{\\text{panel}} C$。\n\n将 $Q_{\\text{panel}}$ 的定义代入更新规则，得到：\n$$\nC \\leftarrow (I - V T V^{T}) C = I C - (V T V^{T}) C = C - V T V^{T} C\n$$\n为了高效地计算项 $V T V^{T} C$，我们必须使用矩阵乘法的最优结合方式。标准且最高效的方法是最大化地利用高性能的3级BLAS（基本线性代数子程序）例程，即从右到左对运算进行分组：\n$$\nV(T(V^T C))\n$$\n我们现在计算此序列中每一步的flop计数。\n\n步骤1：计算矩阵乘积 $W_1 = V^T C$。\n矩阵的维度为 $V^T \\in \\mathbb{R}^{b \\times p}$ 和 $C \\in \\mathbb{R}^{p \\times q}$。结果矩阵 $W_1$ 的维度为 $b \\times q$。这是一个稠密矩阵-矩阵乘法。根据所提供的成本模型，一个 $m \\times k$ 矩阵乘以一个 $k \\times n$ 矩阵的成本为 $2mnk$ flops，我们设置 $m=b$，$k=p$，$n=q$。\n此步骤的成本为：\n$$\n\\text{Cost}_1 = 2bpq \\text{ flops}\n$$\n此操作对应于BLAS中的`GEMM`（通用矩阵-矩阵乘法）例程。\n\n步骤2：计算矩阵乘积 $W_2 = T W_1$。\n维度为 $T \\in \\mathbb{R}^{b \\times b}$ 和 $W_1 \\in \\mathbb{R}^{b \\times q}$。矩阵 $T$ 被指定为上三角矩阵。结果矩阵 $W_2$ 的维度为 $b \\times q$。问题为这些维度的三角矩阵-矩阵乘法提供了一个特定的成本。\n此步骤的成本为：\n$$\n\\text{Cost}_2 = b^{2}q \\text{ flops}\n$$\n此操作对应于BLAS中的`TRMM`（三角矩阵-矩阵乘法）例程。\n\n步骤3：计算矩阵乘积 $W_3 = V W_2$。\n维度为 $V \\in \\mathbb{R}^{p \\times b}$ 和 $W_2 \\in \\mathbb{R}^{b \\times q}$。结果矩阵 $W_3$ 的维度为 $p \\times q$。这是另一个稠密矩阵-矩阵乘法。我们使用成本模型，其中 $m=p$，$k=b$，$n=q$。\n此步骤的成本为：\n$$\n\\text{Cost}_3 = 2pbq \\text{ flops}\n$$\n这是另一个`GEMM`操作。\n\n步骤4：计算最终更新 $C \\leftarrow C - W_3$。\n此操作是两个大小为 $p \\times q$ 的矩阵的按元素减法。根据问题陈述，这需要 $pq$ flops。\n此步骤的成本为：\n$$\n\\text{Cost}_4 = pq \\text{ flops}\n$$\n\n总flop计数是这四个步骤成本的总和：\n$$\n\\text{Total Flops} = \\text{Cost}_1 + \\text{Cost}_2 + \\text{Cost}_3 + \\text{Cost}_4\n$$\n$$\n\\text{Total Flops} = 2pqb + b^{2}q + 2pqb + pq\n$$\n合并同类项，我们得到总flop计数的最终闭式表达式：\n$$\n\\text{Total Flops} = 4pqb + b^{2}q + pq\n$$\n在分块算法的典型应用中，矩阵维度 $p$ 和 $q$ 远大于块大小 $b$（即 $p \\gg b$ 和 $q \\gg b$）。三个矩阵乘法步骤都是3级BLAS操作。它们的成本分别为 $2pqb$（对于 $V^T C$）、$b^2 q$（对于 $T W_1$）和 $2pqb$（对于 $V W_2$）。两个稠密矩阵-矩阵乘法（`GEMM`操作）的成本与 $pqb$ 成正比，而三角矩阵乘法（`TRMM`）的成本与 $b^2 q$ 成正比。由于 $p \\gg b$，项 $pqb$ 远大于 $b^2 q$。因此，主要成本来自两个`GEMM`操作，它们构成了计算工作的主体。",
            "answer": "$$\n\\boxed{4pqb + b^{2}q + pq}\n$$"
        }
    ]
}