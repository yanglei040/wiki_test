{
    "hands_on_practices": [
        {
            "introduction": "我们分析的第一步是精确计算应用单个豪斯霍尔德变换这一基本构建模块的成本。这个操作是整个QR分解算法的核心，通过  这个练习，我们将基于现代计算中常见的融合乘加（fused multiply-add, FMA）模型来分解计算步骤。这有助于我们理解为何在高级数值代数库中，这类操作被视为一个基本的计算单元，并为其 $2ms$ 的主导项成本提供一个坚实的推导基础。",
            "id": "3562610",
            "problem": "考虑一个形式为 $H = I - \\tau v v^{T}$ 的实 Householder 反射 $H \\in \\mathbb{R}^{m \\times m}$，其中 $v \\in \\mathbb{R}^{m}$ 且 $\\tau \\in \\mathbb{R}$，将其从左侧作用于一个稠密块 $B \\in \\mathbb{R}^{m \\times s}$。从恒等式 $H B = B - \\tau v (v^{T} B)$ 和浮点运算的定义出发，推导计算 $H B$ 的渐进运算量。\n\n对于基础线性代数子程序 (BLAS)，采用以下科学上标准且广泛使用的代价模型。在实数运算中：\n- 长度为 $m$ 的内积的代价为 $m$ 次复合融合乘加（简称 FMA）运算，即每个乘加对计为一次浮点运算，其主导代价为 $m$。\n- 一个大小为 $m \\times s$ 的秩-1 更新的代价为 $m s$ 次复合 FMA 运算，即每个元素的乘加对计为一次浮点运算。\n- 对 $k$ 个元素进行的标量-向量和标量-矩阵缩放的代价为 $k$ 次浮点运算。\n\n在此模型下，使用由 $H B = B - \\tau v (v^{T} B)$ 蕴含的最小三步算法计算评估 $H B$ 所需的总浮点运算次数：\n1. 计算行向量 $w^{T} := v^{T} B \\in \\mathbb{R}^{1 \\times s}$。\n2. 缩放 $w^{T} := \\tau w^{T}$。\n3. 执行秩-1 更新 $B := B - v w^{T}$。\n\n您的答案应为一个关于 $m$ 和 $s$ 的单一闭式表达式，该表达式只包含 $m$ 和 $s$ 的主导阶项（即，必须省略 $m$ 和 $s$ 的低阶项）。您的最终答案必须是一个不带单位的单一解析表达式。请验证您的结果与将单个 Householder 反射应用于一个 $m \\times s$ 块所报告的标准主导项相匹配。",
            "solution": "我们从 Householder 反射 $H = I - \\tau v v^{T}$ 对矩阵 $B \\in \\mathbb{R}^{m \\times s}$ 的定义作用开始：\n$$\nH B \\;=\\; B - \\tau v (v^{T} B).\n$$\n该表达式提出了一个自然的三步算法：计算中间行向量 $w^{T} := v^{T} B \\in \\mathbb{R}^{1 \\times s}$，用 $\\tau$ 对其进行缩放，然后执行秩-1 修正 $B := B - v w^{T}$。\n\n我们在所述模型下计算浮点运算次数，该模型将每次融合乘加视为一次运算。在推导基于 Householder 的算法的主导项运算计数时，此模型是标准的，并且与2级基础线性代数子程序 (BLAS) 中的计算组织方式一致，其中主要代价归因于带有乘加融合的矩阵-向量和秩-1 运算。\n\n分步计数：\n1. 计算 $w^{T} := v^{T} B$。这是一个块形式的左矩阵-向量乘积，等价于 $w = B^{T} v$，产生一个 $\\mathbb{R}^{s}$ 中的向量。它被实现为 $s$ 个长度为 $m$ 的内积。在复合融合乘加模型下，每个长度为 $m$ 的内积代价为 $m$ 次浮点运算（每个乘加对一次）。因此，这一步的总主导代价是\n$$\nm s.\n$$\n\n2. 缩放 $w^{T} := \\tau w^{T}$。这是一个对 $s$ 个元素的标量-向量缩放，其代价为\n$$\ns.\n$$\n与主导的双线性项相比，这是 $m$ 和 $s$ 的低阶项。\n\n3. 执行秩-1 更新 $B := B - v w^{T}$。这将更新 $B$ 的每个元素为 $b_{ij} := b_{ij} - v_{i} w_{j}$。在复合融合乘加模型下，每个元素的每次更新计为一次运算，共有 $m s$ 个元素。因此，这一步的主导代价是\n$$\nm s.\n$$\n\n将三部分的贡献相加，总和为\n$$\nm s \\;+\\; s \\;+\\; m s \\;=\\; 2 m s \\;+\\; s.\n$$\n根据问题中只报告 $m$ 和 $s$ 的主导阶项的指示，我们省略低阶项 $s$。因此，在所述模型下，将单个 Householder 反射应用于一个 $m \\times s$ 块的主导阶运算计数为\n$$\n2 m s.\n$$\n\n这与基于 Householder 的 QR 分解的运算分析中使用的标准主导项计数相匹配，其中将一个反射应用于一个后续的 $m \\times s$ 块会产生 $2 m s$ 次浮点运算的主导代价（在复合融合乘加的意义上），并省略了低阶项。为完整起见，我们注意到，在将乘法和加法计为独立运算的替代模型下，详细计数将是 $(2 m s - s) + s + 2 m s = 4 m s$，这仍然验证了主导的伸缩性在 $m$ 和 $s$ 上是双线性的，但由于运算模型的不同，常数前因子也不同。在问题指定的模型下，主导项是 $2 m s$。",
            "answer": "$$\\boxed{2 m s}$$"
        },
        {
            "introduction": "在理解了单步操作的成本后，我们自然会问：整个算法的成本是多少？ 这个练习将引导我们将单步成本在所有迭代中累加起来，从而推导出非分块豪斯霍尔德QR分解对于一个方阵的总运算量。更重要的是，它将此结果与经典的格拉姆-施密特（Gram-Schmidt）方法进行比较，从运算量的角度揭示豪斯霍尔德方法在计算效率上的一个关键优势。",
            "id": "3562581",
            "problem": "要求您在实数运算中比较三种正交化方法的主要运算量：非分块Householder正交三角(QR)分解、经典格拉姆-施密特(CGS)和修正格拉姆-施密特(MGS)。使用以下建模假设来计算成本：每次浮点运算(FLOP)是计为$1$ FLOP的单次加法或乘法；标量除法和平方根存在，但在确定总成本中$n^3$的系数时可以忽略；不计算内存流量。从每种方法所执行算术运算的逐步、第一性原理分析入手。\n\n对于满秩实矩阵 $A \\in \\mathbb{R}^{m \\times n}$（其中 $m \\ge n$）上的非分块Householder QR，考虑第 $k$ 次迭代，其中从第 $k:m$ 行中的向量形成一个Householder反射，然后将其应用于位于第 $k:m$ 行和第 $k+1:n$ 列的尾随子矩阵。通过计算以下各项来建立运算量计数：\n- 通过长度均为 $m-k+1$ 的点积和缩放后的向量减法，将反射应用于 $n-k$ 个尾随列中每一列的成本，以及\n- 在 $m=n$ 时，形成反射可能对 $n^3$ 项有贡献的任何成本。\n\n然后特化到方阵情况 $m=n$，并确定非分块Householder QR的总FLOP计数中 $n^3$ 的系数。\n\n独立地，在相同模型下，通过对所有列的内积和向量更新所需的算术运算求和，推导CGS和MGS在实 $n \\times n$ 满秩矩阵上的主要（关于 $n$ 的）FLOP计数，并确定相应的 $n^3$ 系数。\n\n对于方阵情况 $m=n$，以下哪个陈述正确报告了这些系数？\n\nA. 在方阵情况 $m=n$ 下，非分块Householder QR的主导$n^3$项系数为 $(4/3)$，而经典格拉姆-施密特和修正格拉姆-施密特的主导$n^3$项系数均为 $2$。\n\nB. 在方阵情况 $m=n$ 下，非分块Householder QR的主导$n^3$项系数为 $2$，而经典格拉姆-施密特和修正格拉姆-施密特的主导$n^3$项系数均为 $(4/3)$。\n\nC. 在方阵情况 $m=n$ 下，所有三种方法的主导$n^3$项系数相同，都等于 $2$。\n\nD. 在方阵情况 $m=n$ 下，非分块Householder QR的主导$n^3$项系数为 $(8/3)$，而经典格拉姆-施密特和修正格拉姆-施密特的主导$n^3$项系数均为 $2$。",
            "solution": "我们从非分块Householder正交三角(QR)分解开始。在第 $k$ 次迭代中，从向量 $A_{k:m,k}$ 构造一个Householder反射 $H_k = I - \\tau v v^{\\top}$。对于每个尾随列 $j \\in \\{k+1,\\dots,n\\}$，通过执行以下操作将反射应用于尾随子矩阵 $A_{k:m,k+1:n}$：\n- 一个长度为 $m-k+1$ 的点积 $w_j = v^{\\top} A_{k:m,j}$，大约耗费 $2(m-k+1)$ FLOPs，以及\n- 一个axpy类型的更新 $A_{k:m,j} \\leftarrow A_{k:m,j} - \\tau v w_j$，大约耗费 $2(m-k+1)$ FLOPs。\n\n因此，将反射应用于单个尾随列大约耗费 $4(m-k+1)$ FLOPs，并且有 $(n-k)$ 个这样的尾随列。因此，每次迭代 $k$ 的应用成本为\n$$\n4\\,(m-k+1)\\,(n-k).\n$$\n在第 $k$ 次迭代中形成反射本身的成本包括计算一个向量范数、几次向量缩放和几个长度为 $m-k+1$ 的内积。当对 $k = 1,\\dots,n$ 求和时，对于 $m=n$ 的情况，这些形成反射的成本尺度为 $\\mathcal{O}(n^2)$，因此对 $n^3$ 的系数没有贡献。\n\n特化到 $m=n$ 的情况，主导成本是求和\n$$\n\\sum_{k=1}^{n} 4\\,(n-k+1)\\,(n-k) \\;=\\; 4 \\sum_{j=0}^{n-1} (j+1)\\,j \\;=\\; 4 \\sum_{j=0}^{n-1} \\big(j^2 + j\\big).\n$$\n使用众所周知的求和公式 $\\sum_{j=0}^{n-1} j = \\tfrac{n(n-1)}{2}$ 和 $\\sum_{j=0}^{n-1} j^2 = \\tfrac{(n-1)n(2n-1)}{6}$，我们得到\n$$\n4 \\left( \\frac{(n-1)n(2n-1)}{6} + \\frac{n(n-1)}{2} \\right)\n= \\frac{4}{6} (n-1)n(2n-1) + 2 n(n-1).\n$$\n此表达式中关于 $n$ 的首项是\n$$\n\\frac{4}{6} \\cdot 2 n^3 \\;=\\; \\frac{4}{3} n^3,\n$$\n因此，在方阵情况下，非分块Householder QR的 $n^3$ 系数为 $(4/3)$。\n\n接下来，考虑用于实 $n \\times n$ 矩阵的经典格拉姆-施密特(CGS)。对于第 $j$ 列，CGS对每个 $i \\in \\{1,\\dots,j-1\\}$ 计算：\n- 一个内积 $r_{i,j} = q_i^{\\top} a_j$，耗费约 $2n$ FLOPs，以及\n- 一个向量更新 $a_j \\leftarrow a_j - q_i r_{i,j}$，耗费约 $2n$ FLOPs。\n\n因此，对于固定的 $j$，对 $j-1$ 个先前的向量进行投影和减法大约耗费 $4n\\,(j-1)$ FLOPs。对 $j=1,\\dots,n$ 求和得到\n$$\n\\sum_{j=1}^{n} 4n\\,(j-1) \\;=\\; 4n \\sum_{j=1}^{n} (j-1) \\;=\\; 4n \\cdot \\frac{n(n-1)}{2} \\;=\\; 2 n^3 - 2 n^2.\n$$\n每列的额外成本，如范数（约 $2n$）和缩放（约 $n$），总体上贡献了 $\\mathcal{O}(n^2)$，并且不改变 $n^3$ 的系数。因此，CGS的 $n^3$ 系数为 $2$。\n\n对于修正格拉姆-施密特(MGS)，对于第 $j$ 列，首先将 $a_j$ 标准化为 $q_j$，耗费 $\\mathcal{O}(n)$ FLOPs，然后对每个 $k \\in \\{j+1,\\dots,n\\}$ 计算：\n- $r_{j,k} = q_j^{\\top} a_k$，成本约为 $2n$，以及\n- $a_k \\leftarrow a_k - q_j r_{j,k}$，成本约为 $2n$。\n\n对于固定的 $j$，有 $(n-j)$ 个这样的更新，大约贡献 $4n\\,(n-j)$ FLOPs。对 $j=1,\\dots,n$ 求和得到\n$$\n\\sum_{j=1}^{n} 4n\\,(n-j) \\;=\\; 4n \\sum_{j=1}^{n} (n-j) \\;=\\; 4n \\cdot \\frac{n(n-1)}{2} \\;=\\; 2 n^3 - 2 n^2.\n$$\n同样，标准化成本为 $\\mathcal{O}(n^2)$ 并且不影响首项系数。因此，MGS的 $n^3$ 系数也为 $2$。\n\n在方阵情况 $m=n$ 下汇总这些结果：\n- 非分块Householder QR：系数 $(4/3)$。\n- 经典格拉姆-施密特：系数 $2$。\n- 修正格拉姆-施密特：系数 $2$。\n\n我们现在来评估各个选项。\n\n选项A指出，Householder的系数为 $(4/3)$，而两种格拉姆-施密特变体的系数均为 $2$。这与我们的推导相符。正确。\n\n选项B指出，Householder的系数为 $2$，而两种格拉姆-施密特变体的系数均为 $(4/3)$。这颠倒了正确的比较；在方阵情况下，Householder的首项要低一个 $3/2$ 的因子。不正确。\n\n选项C指出，所有三种方法的系数都为 $2$。这忽略了Householder QR的严格更小的首项系数 $(4/3)$。不正确。\n\n选项D将Householder的系数定为 $(8/3)$，两种格拉姆-施密特变体的系数定为 $2$。$(8/3)$ 出现在复数运算的上下文中，但在当前模型的实数运算中不会出现；实数情况下的系数是 $(4/3)$。不正确。\n\n因此，正确选项是A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "虽然非分块算法在理论上很清晰，但其性能在现代计算机上受到内存访问瓶颈的限制，因为它主要依赖于矩阵-向量操作（Level-2 BLAS）。为了利用高速缓存和实现更高性能，实际应用中广泛采用分块算法。 这个练习将向你介绍用于分块的紧凑WY表示法，并推导应用一个分块豪斯霍尔德变换的运算量，让你直观地看到算法如何被重构为以矩阵-矩阵乘法（Level-3 BLAS）为主导，从而在实践中获得显著的性能提升。",
            "id": "3562527",
            "problem": "考虑一个正交面板变换的分块Householder表示，其中面板变换以紧凑Watson–Yamaguchi (WY)形式写作 $Q_{\\text{panel}} = I - V T V^{T}$，其中 $V \\in \\mathbb{R}^{p \\times b}$ 包含 $b$ 个Householder向量，$T \\in \\mathbb{R}^{b \\times b}$ 是由这些向量构建的上三角矩阵。令 $C \\in \\mathbb{R}^{p \\times q}$ 表示一个拖尾矩阵，它将通过左乘面板变换进行更新，$C \\leftarrow Q_{\\text{panel}} C$。请在实数运算下，并使用标准的浮点运算 (flop) 模型，其中每次标量乘法和每次标量加法计为一次flop。对于维度相容的 $m \\times k$ 和 $k \\times n$ 的稠密矩阵-矩阵乘法，假设其成本为 $2 m n k$ flops。对于维度为 $b \\times b$ 和 $b \\times q$ 的三角（上或下）矩阵-矩阵乘法，假设其成本为 $b^{2} q$ flops。对于两个 $p \\times q$ 矩阵的按元素加法或减法，假设其成本为 $p q$ flops。\n\n从这些定义出发，推导将 $Q_{\\text{panel}}$ 左乘到 $C$ 所需的总flop计数，以 $p$、$q$ 和 $b$ 表示。你的最终答案必须是关于 $p$、$q$ 和 $b$ 的单个闭式解析表达式。此外，请指出哪个3级基本线性代数子程序 (BLAS) 项在成本中占主导地位。请仅提供最终表达式；无需进行舍入。",
            "solution": "该问题陈述经验证在科学上是合理的、适定的、客观且完整的。它提出了一个数值线性代数中的标准问题，涉及应用分块Householder变换的计算成本。所有必要的定义、维度和成本模型都已提供，从而可以直接、无歧义地进行推导。\n\n任务是确定通过左乘一个面板变换 $Q_{\\text{panel}}$ 来更新拖尾矩阵 $C \\in \\mathbb{R}^{p \\times q}$ 所需的总浮点运算 (flop) 计数。该变换以紧凑Watson-Yamaguchi (WY) 形式给出，即 $Q_{\\text{panel}} = I - V T V^{T}$，其中 $V \\in \\mathbb{R}^{p \\times b}$，$T \\in \\mathbb{R}^{b \\times b}$ 是一个上三角矩阵。更新操作为 $C \\leftarrow Q_{\\text{panel}} C$。\n\n将 $Q_{\\text{panel}}$ 的定义代入更新规则可得：\n$$\nC \\leftarrow (I - V T V^{T}) C = I C - (V T V^{T}) C = C - V T V^{T} C\n$$\n为高效计算 $V T V^{T} C$ 项，我们必须使用最优的矩阵乘法结合顺序。标准且最高效的方法是（该方法能最大化利用高性能的3级BLAS（基本线性代数子程序）例程）从右至左对运算进行分组：\n$$\nV(T(V^T C))\n$$\n我们现在计算此序列中每个步骤的flop计数。\n\n步骤1：计算矩阵乘积 $W_1 = V^T C$。\n矩阵的维度为 $V^T \\in \\mathbb{R}^{b \\times p}$ 和 $C \\in \\mathbb{R}^{p \\times q}$。结果矩阵 $W_1$ 的维度为 $b \\times q$。这是一个稠密矩阵-矩阵乘法。根据所提供的成本模型，一个 $m \\times k$ 矩阵乘以一个 $k \\times n$ 矩阵的成本为 $2mnk$ flops，我们设置 $m=b$，$k=p$，$n=q$。\n此步骤的成本为：\n$$\n\\text{Cost}_1 = 2bpq \\text{ flops}\n$$\n此操作对应于BLAS中的`GEMM`（通用矩阵-矩阵乘法）例程。\n\n步骤2：计算矩阵乘积 $W_2 = T W_1$。\n矩阵的维度为 $T \\in \\mathbb{R}^{b \\times b}$ 和 $W_1 \\in \\mathbb{R}^{b \\times q}$。矩阵 $T$ 被指定为上三角矩阵。结果矩阵 $W_2$ 的维度为 $b \\times q$。问题为这些维度的三角矩阵-矩阵乘法提供了一个特定的成本。\n此步骤的成本为：\n$$\n\\text{Cost}_2 = b^{2}q \\text{ flops}\n$$\n此操作对应于BLAS中的`TRMM`（三角矩阵-矩阵乘法）例程。\n\n步骤3：计算矩阵乘积 $W_3 = V W_2$。\n矩阵的维度为 $V \\in \\mathbb{R}^{p \\times b}$ 和 $W_2 \\in \\mathbb{R}^{b \\times q}$。结果矩阵 $W_3$ 的维度为 $p \\times q$。这是另一次稠密矩阵-矩阵乘法。我们使用成本模型，并设置 $m=p$，$k=b$，$n=q$。\n此步骤的成本为：\n$$\n\\text{Cost}_3 = 2pbq \\text{ flops}\n$$\n这是另一次`GEMM`操作。\n\n步骤4：计算最终更新 $C \\leftarrow C - W_3$。\n此操作是两个大小为 $p \\times q$ 的矩阵的按元素减法。根据问题陈述，此操作的成本为 $pq$ flops。\n此步骤的成本为：\n$$\n\\text{Cost}_4 = pq \\text{ flops}\n$$\n\n总flop计数是这四个步骤成本的总和：\n$$\n\\text{Total Flops} = \\text{Cost}_1 + \\text{Cost}_2 + \\text{Cost}_3 + \\text{Cost}_4\n$$\n$$\n\\text{Total Flops} = 2pqb + b^{2}q + 2pqb + pq\n$$\n合并同类项，我们得到总flop计数的最终闭式表达式：\n$$\n\\text{Total Flops} = 4pqb + b^{2}q + pq\n$$\n在分块算法的典型应用中，矩阵维度 $p$ 和 $q$ 远大于块大小 $b$（即 $p \\gg b$ 和 $q \\gg b$）。三个矩阵乘法步骤都是3级BLAS操作。它们的成本分别为 $2pqb$（对于 $V^T C$）、$b^2 q$（对于 $T W_1$）和 $2pqb$（对于 $V W_2$）。两次稠密矩阵-矩阵乘法（`GEMM`操作）的成本与 $pqb$ 成正比，而三角矩阵乘法（`TRMM`）的成本与 $b^2 q$ 成正比。由于 $p \\gg b$，因此 $pqb$ 项远大于 $b^2 q$ 项。所以，主导成本来自两次`GEMM`操作，它们构成了计算工作的主体部分。",
            "answer": "$$\n\\boxed{4pqb + b^{2}q + pq}\n$$"
        }
    ]
}