## 引言
在科学与工程计算的广阔领域中，求解[广义特征值问题](@entry_id:151614) $A x = \lambda B x$ 是一项基础而又至关重要的任务。尽管表面上可以通过将问题转化为[标准形式](@entry_id:153058) $(B^{-1}A)x = \lambda x$ 来解决，但当矩阵 $B$ 病态或接近奇异时，这种直接求逆的方法在数值上是极其危险的，往往会导致灾难性的精度损失。这构成了一个关键的知识缺口：如何稳健、准确地求解这类问题？

[QZ算法](@entry_id:753987)，作为广义舒尔方法的代名词，为解决这一难题提供了优雅而强大的答案。它通过一系列数值稳定的[酉变换](@entry_id:152599)直接作用于原始矩阵对 $(A,B)$，完全避免了求逆操作，从而保证了计算的可靠性。本文旨在全面剖析[QZ算法](@entry_id:753987)的理论与实践。在接下来的章节中，你将学习到：

- **原理与机制**：我们将深入探讨[广义特征值问题](@entry_id:151614)的数学结构，包括[矩阵束](@entry_id:751760)的正则性、有限与无限[特征值](@entry_id:154894)的概念。在此基础上，我们将揭示[广义舒尔分解](@entry_id:749792)的核心思想，并详细拆解[QZ算法](@entry_id:753987)的两阶段实现过程——从Hessenberg-三角约化到隐式QZ迭代，同时强调[酉变换](@entry_id:152599)在确保数值稳定性中的关键作用。

- **应用与跨学科连接**：我们将展示[QZ算法](@entry_id:753987)如何作为连接抽象理论与具体实践的桥梁，在控制理论（如[系统辨识](@entry_id:201290)和[最优控制](@entry_id:138479)）、计算化学（如求解[Roothaan-Hall方程](@entry_id:146169)）以及[结构力学](@entry_id:276699)（如分析[非保守系统](@entry_id:166237)的稳定性）等多个学科中发挥着不可或缺的作用。

- **动手实践**：通过一系列精心设计的练习，你将有机会亲手操作，从已计算出的广义舒尔型中提取[特征值](@entry_id:154894)，理解算法如何巧妙处理数值挑战，并探索[特征值](@entry_id:154894)敏感度的概念。

通过本次学习，你将不仅掌握[QZ算法](@entry_id:753987)的工作原理，还将深刻理解其为何成为现代数值计算软件库中不可或缺的基石。

## 原理与机制

[广义特征值问题](@entry_id:151614) $A x = \lambda B x$ 的求解是科学与工程计算中的一个核心任务。虽然可以通过将其转化为[标准特征值问题](@entry_id:755346) $(B^{-1}A)x = \lambda x$ 来求解（当 $B$ 可逆时），但这种方法在数值上往往是不稳定的。QZ 算法，也称为广义舒尔方法，提供了一种向后稳定的方法，直接处理矩阵对 $(A,B)$，而无需显式计算[逆矩阵](@entry_id:140380)。本章将深入探讨 QZ 算法的基本原理和核心机制，从问题的数学结构到算法的具体实现步骤和数值稳定性考量。

### [广义特征值问题](@entry_id:151614)的数学结构

在深入研究算法本身之前，我们必须首先精确地定义所要求解的问题的数学框架。这包括广义[特征值](@entry_id:154894)、[矩阵束](@entry_id:751760)及其正则性的概念。

#### [矩阵束](@entry_id:751760)及其正则性

[广义特征值问题](@entry_id:151614)与一个称为**[矩阵束](@entry_id:751760) (matrix pencil)** 的对象密切相关，该对象表示为 $A - \lambda B$。这是一个以 $\lambda$ 为参数的矩阵族。[矩阵束](@entry_id:751760)的性质决定了其[特征值](@entry_id:154894)谱的结构。一个关键的性质是**正则性 (regularity)**。

一个 $n \times n$ 的[矩阵束](@entry_id:751760) $(A,B)$ 被称为**正则的 (regular)**，如果其[特征多项式](@entry_id:150909) $p(\lambda) = \det(A - \lambda B)$ 不恒为零。换言之，至少存在一个复数 $\lambda_0$ 使得矩阵 $A - \lambda_0 B$ 是可逆的。如果 $p(\lambda)$ 对所有 $\lambda \in \mathbb{C}$ 都恒等于零，那么该[矩阵束](@entry_id:751760)被称为**奇异的 (singular)** 。

正则性是[QZ算法](@entry_id:753987)的基本假设。如果一个[矩阵束](@entry_id:751760)是奇异的，那么对于任何复数 $\lambda$，矩阵 $A - \lambda B$ 都是奇异的。这意味着谱是整个复平面，离散的[特征值](@entry_id:154894)概念不再适用。在这种情况下，QZ 算法的迭代过程可能会停滞或失效，因为它试图求解的子问题本身失去了良定义性 。从理论上讲，奇异束的结构由其 Kronecker 典范型 (Kronecker Canonical Form) 描述，其中包含所谓的奇异块。在数值计算中，奇异性表现为算法无法收敛到一个确定的[特征值](@entry_id:154894)，或者在计算中间步骤时遇到不确定的 $0/0$ 形式 。

#### 有限与无限[特征值](@entry_id:154894)

对于一个正则束 $(A,B)$，其**有限广义[特征值](@entry_id:154894) (finite generalized eigenvalues)** 就是特征多项式 $p(\lambda) = \det(A - \lambda B) = 0$ 的根。由于束是正则的， $p(\lambda)$ 是一个次数最多为 $n$ 的非零多项式。

当 $B$ 是[奇异矩阵](@entry_id:148101)时，即 $\det(B)=0$，特征多项式 $p(\lambda)$ 的次数 $d = \deg(p(\lambda))$ 将会严格小于 $n$。这是因为 $p(\lambda)$ 中 $\lambda^n$ 项的系数是 $(-1)^n \det(B)$ 。多项式次数的“损失” $n-d$ 对应于**无限广义[特征值](@entry_id:154894) (infinite generalized eigenvalues)** 的概念。一个正则的 $n \times n$ [矩阵束](@entry_id:751760)在[扩展复平面](@entry_id:165233) $\mathbb{C} \cup \{\infty\}$ 中恰好有 $n$ 个广义[特征值](@entry_id:154894)（计算[代数重数](@entry_id:154240)）。无限[特征值](@entry_id:154894)的[代数重数](@entry_id:154240)定义为 $n - d$ 。

需要强调的是，矩阵 $B$ 的奇异性并不意味着[矩阵束](@entry_id:751760) $(A,B)$ 本身是奇异的。例如，考虑以下 $2 \times 2$ 的矩阵对：
$$
A = \begin{pmatrix} 1  0 \\ 0  0 \end{pmatrix}, \quad B = \begin{pmatrix} 0  0 \\ 0  1 \end{pmatrix}
$$
这里，$\det(B) = 0$，所以 $B$ 是奇异的。然而，其[特征多项式](@entry_id:150909)为：
$$
\det(A - \lambda B) = \det\begin{pmatrix} 1  0 \\ 0  -\lambda \end{pmatrix} = -\lambda
$$
由于 $p(\lambda) = -\lambda$ 不恒为零，该[矩阵束](@entry_id:751760)是正则的。此例中，多项式次数 $d=1$，矩阵尺寸 $n=2$。因此，存在一个[代数重数](@entry_id:154240)为 1 的有限[特征值](@entry_id:154894) $\lambda=0$，以及一个[代数重数](@entry_id:154240)为 $n-d = 2-1=1$ 的无限[特征值](@entry_id:154894) 。QZ 算法的一个主要优势正是其能够稳健地处理和计算这类包含无限[特征值](@entry_id:154894)的正则问题。

### [广义舒尔分解](@entry_id:749792) (QZ 分解)

QZ 算法的核心目标是计算[矩阵束](@entry_id:751760)的**[广义舒尔分解](@entry_id:749792) (Generalized Schur Decomposition)**，也称 QZ 分解。该分解是理解和计算广义[特征值](@entry_id:154894)的关键。

#### 分解定理与[特征值](@entry_id:154894)的提取

[广义舒尔分解](@entry_id:749792)定理指出，对于任意的方阵 $A, B \in \mathbb{C}^{n \times n}$，存在酉矩阵 $Q, Z \in \mathbb{C}^{n \times n}$，使得
$$
S = Q^{*} A Z \quad \text{和} \quad T = Q^{*} B Z
$$
均为[上三角矩阵](@entry_id:150931)。在实数域中，分解的结果是 $S$ 为上准[三角矩阵](@entry_id:636278)（对角线上可能有 $2 \times 2$ 块），$T$ 为[上三角矩阵](@entry_id:150931)。

这个分解是等价变换，意味着[矩阵束](@entry_id:751760) $(S, T)$ 与原始[矩阵束](@entry_id:751760) $(A, B)$ 具有完全相同的广义[特征值](@entry_id:154894)。由于 $S$ 和 $T$ 是[上三角矩阵](@entry_id:150931)，特征多项式变得极易计算：
$$
\det(A - \lambda B) \propto \det(S - \lambda T) = \prod_{i=1}^{n} (s_{ii} - \lambda t_{ii})
$$
要使该[行列式](@entry_id:142978)为零，必须至少有一个对角线因子为零，即 $s_{ii} - \lambda t_{ii} = 0$。因此，广义[特征值](@entry_id:154894)可以直接从 $S$ 和 $T$ 的对角元素中获得。对角元素对 $(s_{ii}, t_{ii})$ 构成了[特征值](@entry_id:154894)的**[齐次坐标](@entry_id:154569)表示 (homogeneous coordinate representation)** $(\alpha_i, \beta_i)$。

- 如果 $t_{ii} \neq 0$，则存在一个有限[特征值](@entry_id:154894) $\lambda_i = s_{ii} / t_{ii}$。
- 如果 $t_{ii} = 0$（对于正则束，此时必有 $s_{ii} \neq 0$），则对应一个无限[特征值](@entry_id:154894) 。

使用[齐次坐标](@entry_id:154569)对 $(\alpha_i, \beta_i)$ 是至关重要的，因为它自然地、稳健地表示了整个特征谱，包括无限[特征值](@entry_id:154894)，并避免了由于 $t_{ii}$ 非常小而导致的除法[溢出](@entry_id:172355)或精度损失问题 。

#### 显式求逆的陷阱

在继续之前，我们必须强调为什么 QZ 算法是必要的，而不是简单地计算 $C = B^{-1}A$ 并求解其[标准特征值问题](@entry_id:755346)。当 $B$ 可逆但在数值上**病态 (ill-conditioned)** 时，即接近奇异时，显式求逆在数值上是极其危险的。

考虑一个矩阵 $B$，其条件数 $\kappa(B) = \|B\| \|B^{-1}\|$ 非常大。这通常发生在矩阵的元素跨越多个[数量级](@entry_id:264888)时，例如，一个对角元为 $10^{-8}$ 而另一个为 $1$。计算 $B^{-1}$ 会将 $B$ 中表示的微小舍入误差放大 $\kappa(B)$ 倍，导致 $B^{-1}$ 的计算结果极不准确。

更糟糕的是，即使 $B^{-1}$ 可以精确计算，后续的矩阵乘法 $B^{-1}A$ 也会导致灾难性的信息丢失。例如，假设 $B^{-1}$ 的元素[数量级](@entry_id:264888)高达 $10^8$，而 $A$ 的元素[数量级](@entry_id:264888)为 $1$。在计算乘积的一个元素时，可能会出现类似 $(... \times 10^8) \times (...) + (... \times 1) \times (...)$ 的加法。在浮点运算中，一个非常大的数与一个非常小的数相加会导致小数字的信息被完全“吞噬”（称为 **swamping**），从而严重污染计算出的矩阵 $C$ 的元素，并导致其[特征值](@entry_id:154894)与真实值大相径庭 。

QZ 算法通过始终直接操作原始矩阵 $A$ 和 $B$ 并使用数值稳定的[酉变换](@entry_id:152599)来完全避免这些问题，从而保证了其结果的可靠性。

### QZ 算法的实现机制

QZ 算法的现代实现通常分两个阶段进行：首先将矩阵对约化为更简单的形式，然后对简化后的形式进行迭代求解。

#### 第一阶段：约化为 Hessenberg-三角形式

直接对稠密的矩阵对 $(A,B)$ 进行迭代的计算成本过高（每步 $O(n^4)$）。因此，第一步是应用一系列[酉变换](@entry_id:152599)将 $(A,B)$ 约化为 **Hessenberg-三角 (Hessenberg-triangular)** 形式，即找到酉矩阵 $Q_0$ 和 $Z_0$，使得
$$
H = Q_0^{*} A Z_0 \quad \text{是上 Hessenberg 矩阵}
$$
$$
R = Q_0^{*} B Z_0 \quad \text{是上三角矩阵}
$$
其中，上 Hessenberg 矩阵是指主对角线下方第一条次对角线之外的元素全为零的矩阵 ($h_{ij} = 0$ for $i > j+1$)。

这个约化过程本身也分为两步 ：
1.  **$B$ 的三角化**：首先，对矩阵 $B$ 进行 QR 分解，即找到一个[酉矩阵](@entry_id:138978) $Q_1$ 使得 $R_0 = Q_1^* B$ 是上三角矩阵。这通常通过一系列 Householder 反射实现。同时，将相同的左变换应用于 $A$：$A_1 = Q_1^* A$。
2.  **$A_1$ 的 Hessenberg 化**：接下来，通过一系列精心设计的左右 Givens 旋转对，将稠密矩阵 $A_1$ 约化为上 Hessenberg 形式，同时保持 $R_0$ 的上三角结构。这个过程通常被称为“追逐凸起 (bulge chasing)”，其核心思想是：每次引入一个左旋转来消除 $A_1$ 中不想要的元素（例如 $a_{j,k}$ with $j>k+1$），这会在 $R_0$ 中产生一个不希望的非零元素（“凸起”）；然后立即引入一个右旋转来消除这个凸起，恢复 $R_0$ 的[三角性](@entry_id:756167)。由于右旋转作用的列索引总是大于或等于 $k+1$，它不会破坏在第 $k$ 列已经引入的零。

整个约化过程的计算复杂度为 $O(n^3)$ 。

#### 第二阶段：隐式 QZ 迭代

Hessenberg-三角形式是进行高效迭代的理想起点。它的[稀疏结构](@entry_id:755138)（$H$ 是几乎三角的，$R$ 是三角的）确保了在迭代的每一步中，计算都局限在一个很小的范围内，从而避免了全局性的[数据填充](@entry_id:748211) 。

迭代阶段的目标是将 Hessenberg 矩阵 $H$ 进一步约化为（准）三角形式 $S$，同时保持 $T$ 的三角形式。这通过一种称为**隐式位移 QZ 迭代**的方法实现，其核心是“追逐凸起”机制。下面我们以一个 $5 \times 5$ 的例子来具体描述这个过程 。

1.  **初始化与位移**：算法首先根据 $H$ 和 $R$ 尾部的 $2 \times 2$ 子块选择一个**位移 (shift)** $\sigma$。这个位移的选择策略（如 Wilkinson 位移）对于加速收敛至关重要。然后，构造一个初始的 Givens 旋转 $Q_1$，它作用于前两行，并由位移 $\sigma$ 隐式定义，其目的是在应用于向量 $(H - \sigma R)e_1$ 时，将其第二个元素置零 。例如，若 $(H-\sigma R)e_1$ 的前两项为 $(x, y)^\top$，则选择旋转参数 $c, s$ 使得 $-sx + cy = 0$。

2.  **引入与追逐凸起**：应用 $Q_1^\top$ 到 $(H, R)$ 会在 $R$ 的 $(2,1)$ 位置产生一个非零元，破坏了其三角结构。为了恢复它，我们应用一个作用于第 1 和第 2 列的右旋转 $Z_1$。这个 $Z_1$ 的作用又会在 $H$ 的 $(3,1)$ 位置产生一个非零元素，即一个“凸起”，它破坏了 Hessenberg 结构。

3.  **追逐序列**：现在开始“追逐”这个凸起，使其沿对角线向下移动并最终消失。这个过程可以概括为一系列步骤，以索引 $k$ 标记：
    *   **步骤 $k$**：假设一个凸起位于 $H$ 的 $(k+2, k)$ 位置。
    *   **左旋转 $G_k$**：应用一个作用于行 $(k+1, k+2)$ 的左 Givens 旋转 $G_k^\top$，其目的是消除 $h_{k+2, k}$。
    *   **填充 $R$**：这个左旋转会在 $R$ 的 $(k+2, k+1)$ 位置产生一个新的非零填充元素。
    *   **右旋转 $J_k$**：应用一个作用于列 $(k+1, k+2)$ 的右 Givens 旋转 $J_k$，其目的是消除刚刚在 $R$ 中产生的填充元素，恢复其[三角性](@entry_id:756167)。
    *   **凸起移动**：这个右旋转 $J_k$ 会将 $H$ 中的凸起移动到新的位置 $(k+3, k+1)$。

    对于一个 $5 \times 5$ 的矩阵，这个追逐序列会从 $k=1$ 开始（凸起从 $(3,1)$ 移动到 $(4,2)$），然后是 $k=2$（从 $(4,2)$ 到 $(5,3)$），最后是 $k=3$（从 $(5,3)$ 移动到矩阵外，即消失）。

由于 Hessenberg-三角结构的特殊性，每一步旋转只影响少数行和列，计算量被严格控制。每一次完整的 QZ 迭代（一次完整的凸起追逐）的计算成本是 $O(n^2)$。通常需要 $O(n)$ 次迭代才能使 $H$ 的一个次对角元收敛到零（从而实现问题规模的缩减，即**缩减 (deflation)**），因此整个迭代阶段的总成本也是 $O(n^3)$ 。

### 数值稳定性与实际考量

QZ 算法的卓越之处不仅在于其巧妙的[代数结构](@entry_id:137052)，更在于其出色的数值稳定性。

#### [正交变换](@entry_id:155650)的关键作用

QZ 算法在所有步骤中都严格使用酉（或正交）变换。这是其数值稳定性的基石。在有限精度[浮点运算](@entry_id:749454)中，理想的正交变换 $Q$ 变成了近似正交的 $\widetilde{Q}$，满足 $\|\widetilde{Q}^\top \widetilde{Q} - I\|_2 = O(u)$，其中 $u$ 是[机器精度](@entry_id:756332)。

[酉变换](@entry_id:152599)的关键性质是它们**保范性**：$\|QX\|_2 = \|X\|_2$ 和 $\|XQ\|_2 = \|X\|_2$。这意味着在变换过程中，[舍入误差](@entry_id:162651)不会被放大。如果使用非[酉变换](@entry_id:152599)（其 [2-范数](@entry_id:636114)可能远大于 1），每一步的局部[舍入误差](@entry_id:162651)都可能被该变换的[条件数](@entry_id:145150)放大，导致误差的灾难性累积。正交性通过将变换的 [2-范数](@entry_id:636114)保持在 1 附近，有效地抑制了误差的增长 。

由于这种性质，QZ 算法是**向后稳定 (backward stable)** 的。这意味着由 QZ 算法计算出的（存在舍入误差的）广义舒尔型 $(\widehat{S}, \widehat{T})$，可以被证明是某个与原始矩阵对 $(A,B)$ 非常接近的矩阵对 $(A+\Delta A, B+\Delta B)$ 的精确广义舒尔型。其中，扰动 $\Delta A$ 和 $\Delta B$ 的范数很小，满足 $\|\Delta A\|_2 \le p(n)u\|A\|_2$ 和 $\|\Delta B\|_2 \le p(n)u\|B\|_2$，这里 $p(n)$ 是一个关于 $n$ 的低次多项式。这种保证是衡量数值算法可靠性的黄金标准 。

#### 处理奇异性与病态问题

在实际计算中，即使理论上[矩阵束](@entry_id:751760)是正则的，它也可能在数值上**接近奇异 (near-singular)**。这会在计算出的舒尔型中表现为某个对角对 $(\alpha_i, \beta_i) = (s_{ii}, t_{ii})$ 同时非常接近于 $(0,0)$。这会导致对应的[特征值](@entry_id:154894) $\lambda_i = \alpha_i/\beta_i$ 对微小扰动极为敏感，即**病态 (ill-conditioned)**。计算结果可能出现虚假的极大或极小值，给解释带来困难 。

类似地，当一个对角元 $|t_{ii}|$ 非常小（但非零）时，对应的有限[特征值](@entry_id:154894) $\lambda_i = s_{ii}/t_{ii}$ 会非常大。这个大的数值本身就是病态的，其值对 $t_{ii}$ 的微小变化极度敏感。因此，任何稳健的 QZ 算法实现都不会直接返回这个可能溢出或不精确的大数值，而是返回[齐次坐标](@entry_id:154569)对 $(s_{ii}, t_{ii})$ 。

为了处理这些情况，高质量的数值库（如 [LAPACK](@entry_id:751137)）采用了一些高级策略：
- **重排序 (Reordering)**：通过额外的[酉变换](@entry_id:152599)，可以对已计算出的舒尔型的对角块进行重排序。这允许将无限或非常大的[特征值](@entry_id:154894)（对应于 $t_{ii}$ 小的块）聚集在一起，例如移动到矩阵的左上角或右下角。
- **缩减与分离**：重排序后，可以将问题有效地分离。如果与大[特征值](@entry_id:154894)相关的子问题被分离出来，就可以对剩余的、行为良好的子问题进行更稳健的处理。对于接近奇异的 $2 \times 2$ 块（即 $S_i$ 和 $T_i$ 块都接近奇异），可能需要更复杂的、揭示秩的分解方法来进行处理 。

需要特别注意的是，试图通过简单地缩放 $T$ 矩阵来“修复”小的 $t_{ii}$ 值是错误的做法。对 $(A,B)$ 的单边缩放，如将其变为 $(A, cB)$，会改变其有限[特征值](@entry_id:154894)（变为 $\lambda_i/c$），这不是一个等价变换，会从根本上改变原问题 。

综上所述，QZ 算法通过其精巧的两阶段结构和对[酉变换](@entry_id:152599)的严格使用，为求解[广义特征值问题](@entry_id:151614)提供了一个既高效又数值稳健的框架。它不仅能够处理包含无限[特征值](@entry_id:154894)的正则问题，而且其设计原则也为诊断和处理接近奇异的病态情况提供了坚实的基础。