{
    "hands_on_practices": [
        {
            "introduction": "间断Galerkin（DG）方法具有高阶精度和几何灵活性，但在实际应用中需要仔细的工程设计抉择。一个常见的权衡是在精确质量矩阵（其求逆计算成本高昂）和对角的“集总”质量矩阵（其求逆过程非常简单）之间做出选择。本练习旨在通过特征分析，定量地探究这一选择所带来的后果，考察其对线性平流方程格式的稳定性、数值色散和耗散产生的影响。",
            "id": "3382546",
            "problem": "考虑一维线性平流方程 $u_t + a\\,u_x = 0$，其定义在周期性域 $[0,L]$ 上，并采用节点式间断伽辽金谱元法 (DGSEM) 进行离散，每个单元上使用 Legendre-Gauss-Lobatto 节点。设域内有 $N_e$ 个均匀单元，每个单元的多项式阶数为 $P$，即每个单元上有 $P+1$ 个节点。用 $\\xi \\in [-1,1]$ 表示参考单元坐标，通过仿射映射 $x = x_c + \\frac{h}{2}\\,\\xi$ 与物理坐标关联，其中 $h = L/N_e$ 是单元尺寸，$x_c$ 是单元中心，雅可比行列式为 $J = h/2$。\n\n在参考单元上，使用基于 Legendre-Gauss-Lobatto 节点的标准节点式拉格朗日基。设 $W_{\\hat{}}$ 为参考单元上 Legendre-Gauss-Lobatto 求积权重的对角矩阵，设 $D$ 为与参考单元上这些节点相关联的重心微分矩阵。对于单元 $e$，采用迎风数值通量的强形式 DGSEM 半离散算子由以下分块关系给出：\n$$\nJ\\,W_{\\hat{}}\\,\\frac{d u_e}{dt} \\;=\\; a\\,\\left( -\\,W_{\\hat{}}\\,D\\,u_e \\;+\\; \\text{取决于迎风通量和周期性连接的表面注入项} \\right).\n$$\n在周期性边界条件下，表面注入项为每个单元的对角块增加一个秩一项，并为每个单元增加一个秩一的单元间耦合项，其具体方向由 $a$ 的符号决定（正速度从左侧邻居单元选取迎风状态；负速度从右侧邻居单元选取迎风状态）。\n\n通过组合体积贡献 $-\\,W_{\\hat{}}\\,D$ 和跨越具有周期性连接的单元的一致性迎风表面注入贡献，定义全局算子 $\\mathbf{K}$。定义两种质量矩阵：精确质量矩阵 $\\mathbf{M}_{\\text{exact}}$ 和集总（对角）质量矩阵 $\\mathbf{M}_{\\text{lumped}} = J\\,W_{\\hat{}}$。精确质量矩阵通过对节点拉格朗日基 $\\ell_i(\\xi)$ 使用足够高阶的 Gauss-Legendre 求积来精确计算积分 $\\int_{-1}^{1} \\ell_i(\\xi)\\,\\ell_j(\\xi)\\,d\\xi$，然后乘以 $J$ 来构建。考虑以下两个半离散生成元：\n$$\n\\mathbf{A}_{\\text{exact}} \\;=\\; a\\,\\mathbf{M}_{\\text{exact}}^{-1}\\,\\mathbf{K}, \n\\qquad\n\\mathbf{A}_{\\text{lumped}} \\;=\\; a\\,\\mathbf{M}_{\\text{lumped}}^{-1}\\,\\mathbf{K}.\n$$\n\n您的任务是实现一个程序，该程序针对测试套件中的每一组参数，构建 $\\mathbf{M}_{\\text{exact}}$、$\\mathbf{M}_{\\text{lumped}}$ 和 $\\mathbf{K}$，计算 $\\mathbf{A}_{\\text{exact}}$ 和 $\\mathbf{A}_{\\text{lumped}}$ 的特征值，并量化由质量集总引起的稳定性和色散变化。具体来说，对每个算子：\n\n1. 计算前向欧拉稳定性极限 $\\,\\Delta t_{\\text{FE}}$，其定义为满足 $\\,|1 + \\Delta t\\,\\lambda| \\le 1\\,$（对于算子的所有特征值 $\\,\\lambda\\,$）的最大非负 $\\,\\Delta t\\,$。对于每个实部 $\\alpha  0$ 的特征值 $\\,\\lambda = \\alpha + i\\beta\\,$，稳定域圆盘的边界得出\n$$\n\\Delta t_{\\lambda} \\;=\\; -\\,\\frac{2\\,\\alpha}{\\alpha^2 + \\beta^2},\n$$\n容许时间步长为 $\\,\\Delta t_{\\text{FE}} = \\min_{\\lambda:\\,\\Re(\\lambda)0} \\Delta t_{\\lambda}$，并约定如果没有特征值具有负实部，则 $\\,\\Delta t_{\\text{FE}} = 0$。\n\n2. 计算低波数色散误差。为此，选取具有最小非零 $|\\operatorname{Im}(\\lambda)|$ 的特征值，并将其虚部大小 $|\\operatorname{Im}(\\lambda)|$ 与连续色散 $|a|\\,k_1$ 进行比较，其中 $k_1 = 2\\pi/L$ 是基本波数。报告相对色散误差\n$$\n\\varepsilon_{\\text{disp}} \\;=\\; \\frac{|\\operatorname{Im}(\\lambda)|}{|a|\\,k_1} \\;-\\; 1.\n$$\n如果所有特征值的虚部均为零，则设 $\\,\\varepsilon_{\\text{disp}} = 0$。\n\n3. 计算最大实部 $\\,\\max_{\\lambda} \\operatorname{Re}(\\lambda)$ 以量化耗散（负实部有助于阻尼；最大实部越大，稳定性越差）。\n\n按以下顺序为每组参数汇集六个度量指标：\n$$\n[\\Delta t_{\\text{FE}}(\\mathbf{A}_{\\text{exact}}),\\;\\Delta t_{\\text{FE}}(\\mathbf{A}_{\\text{lumped}}),\\;\\varepsilon_{\\text{disp}}(\\mathbf{A}_{\\text{exact}}),\\;\\varepsilon_{\\text{disp}}(\\mathbf{A}_{\\text{lumped}}),\\;\\max \\operatorname{Re}(\\mathbf{A}_{\\text{exact}}),\\;\\max \\operatorname{Re}(\\mathbf{A}_{\\text{lumped}})].\n$$\n\n实现要求：\n\n- 使用以下公式在参考单元上构建 Legendre-Gauss-Lobatto 节点、重心权重和重心微分矩阵 $D$：\n$$\nw_j^{\\text{bary}} \\;=\\; \\frac{1}{\\prod_{k\\ne j} (x_j - x_k)}, \n\\qquad\nD_{ij} \\;=\\;\n\\begin{cases}\n\\frac{w_j^{\\text{bary}}}{w_i^{\\text{bary}}}\\,\\frac{1}{x_i - x_j},  i \\ne j, \\\\[6pt]\n-\\sum_{k\\ne i} D_{ik},  i=j.\n\\end{cases}\n$$\n\n- 使用 Legendre-Gauss-Lobatto 求积权重\n$$\n(W_{\\hat{}})_{jj} \\;=\\; w_j^{\\text{LGL}} \\;=\\; \\frac{2}{P(P+1)}\\,\\frac{1}{\\left(L_P(x_j)\\right)^2},\n$$\n其中 $L_P$ 是在 $[-1,1]$ 上的节点 $x_j$ 处求值的 $P$ 阶勒让德多项式。\n\n- 通过使用至少 $P+2$ 个点的 Gauss-Legendre 求积来构建精确单元质量矩阵，以精确积分 $P$ 阶拉格朗日多项式的乘积：\n$$\n(M_{\\text{exact}}^{(e)})_{ij} \\;=\\; J\\,\\sum_{q=1}^{N_q} w_q^{\\text{GL}}\\,\\ell_i(\\xi_q)\\,\\ell_j(\\xi_q),\n$$\n其中 $N_q \\ge P+2$，$(\\xi_q, w_q^{\\text{GL}})$ 是 $[-1,1]$ 上的 Gauss-Legendre 节点和权重，$\\ell_j$ 是与 Legendre-Gauss-Lobatto 节点相关联的节点式拉格朗日基。\n\n- 以分块形式组装具有周期性连接的全局矩阵 $\\mathbf{K}$。对于 $a \\ge 0$（向右平流），单元 $e$ 中的迎风表面注入对其对角块贡献 $+\\,e^- (e^-)^{\\top}$，对从单元 $e-1$ 到 $e$ 的耦合块贡献 $-\\,e^- (e^+)^{\\top}$，其中 $e^-$ 选择左端点节点，$e^+$ 选择右端点节点。对于 $a  0$（向左平流），在对角块上使用 $+\\,e^+ (e^+)^{\\top}$，并从单元 $e+1$ 到 $e$ 使用 $-\\,e^+ (e^-)^{\\top}$。在所有情况下，体积块均为 $-\\,W_{\\hat{}}\\,D$。\n\n测试套件：\n\n- 情况 1 (常规情况)：$L = 1$, $a = 1$, $N_e = 8$, $P = 4$。\n- 情况 2 (低阶边界)：$L = 1$, $a = 1$, $N_e = 2$, $P = 1$。\n- 情况 3 (更高阶数较少单元)：$L = 1$, $a = 1$, $N_e = 4$, $P = 8$。\n- 情况 4 (负速度)：$L = 1$, $a = -0.7$, $N_e = 6$, $P = 3$。\n\n您的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表的列表，每个测试用例一个列表，每个内部列表按以下顺序排列：\n$[\\Delta t_{\\text{FE}}(\\mathbf{A}_{\\text{exact}}),\\;\\Delta t_{\\text{FE}}(\\mathbf{A}_{\\text{lumped}}),\\;\\varepsilon_{\\text{disp}}(\\mathbf{A}_{\\text{exact}}),\\;\\varepsilon_{\\text{disp}}(\\mathbf{A}_{\\text{lumped}}),\\;\\max \\operatorname{Re}(\\mathbf{A}_{\\text{exact}}),\\;\\max \\operatorname{Re}(\\mathbf{A}_{\\text{lumped}})]$。\n例如，输出格式必须与\n$$\n[[r_{11},r_{12},r_{13},r_{14},r_{15},r_{16}],[r_{21},r_{22},r_{23},r_{24},r_{25},r_{26}],\\dots]\n$$\n完全一样，其中每个 $r_{ij}$ 是一个实数（浮点数）。",
            "solution": "用户的请求涉及对一维线性平流方程的间断伽辽金谱元法 (DGSEM) 离散进行特征分析。该问题在科学上是适定的，提供了一套完整且一致的定义、参数和程序。未发现任何事实性错误、模糊不清或矛盾之处。因此，该问题被视为有效，可以提供完整解答。\n\n求解方法包括以下步骤：\n1.  **参考单元构建**：对于给定的多项式阶数 $P$，我们首先在参考单元 $\\xi \\in [-1,1]$ 上构建必要的组件。\n    -   **Legendre-Gauss-Lobatto (LGL) 节点和权重**：$P+1$ 个 LGL 节点是多项式 $(1-\\xi^2)L'_P(\\xi)$ 的根，其中 $L_P(\\xi)$ 是 $P$ 阶勒让德多项式。通过求 $L'_P(\\xi)$ 的根作为内部节点，并附加端点 $\\{-1, 1\\}$ 来计算节点。相应的 LGL 求积权重使用标准公式 $w_j = \\frac{2}{P(P+1)}[L_P(\\xi_j)]^{-2}$ 计算。\n    -   **重心微分矩阵 ($D$)**：使用高效且准确的重心公式为 LGL 节点构建微分矩阵 $D$。对角线元素由常数的导数必须为零的条件确定，即 $\\sum_j D_{ij} = 0$。\n    -   **参考质量矩阵**：在参考单元上考虑两种类型的质量矩阵。\n        -   集总质量矩阵 $W_{\\hat{}}$ 是一个对角矩阵，其对角元是 LGL 求积权重。\n        -   精确质量矩阵 $M_{\\text{exact,ref}}$ 通过精确积分拉格朗日基函数的乘积 $(\\ell_i, \\ell_j) = \\int_{-1}^1 \\ell_i(\\xi)\\ell_j(\\xi)d\\xi$ 来计算。该积分使用具有足够数量的点（$N_q \\ge P+2$）的 Gauss-Legendre 求积法则进行数值计算，以确保对高达 $2P$ 阶的多项式是精确的。\n\n2.  **全局矩阵组装**：通过遍历域中的 $N_e$ 个单元来组装全局矩阵。\n    -   **全局质量矩阵 ($\\mathbf{M}_{\\text{exact}}$, $\\mathbf{M}_{\\text{lumped}}$)**：这些是块对角矩阵。对于每个单元 $e$，相应的参考质量矩阵（$M_{\\text{exact,ref}}$ 或 $W_{\\hat{}}$）乘以变换的雅可比行列式 $J=h/2$，并放置在与该单元相关联的对角块上。\n    -   **全局刚度矩阵 ($\\mathbf{K}$)**：矩阵 $\\mathbf{K}$ 包含体积积分项和面积分项。\n        -   **体积项**：对于每个单元 $e$，对对角块的贡献是 $-W_{\\hat{}} D$。\n        -   **面积项**：在单元交界面使用迎风通量以确保稳定性。这引入了相邻单元之间的耦合。对于周期性边界条件，这导致对矩阵块进行特定的秩一更新。\n            -   对于平流速度 $a \\ge 0$，通量项将单元 $e-1$ 的右边界耦合到单元 $e$ 的左边界。\n            -   对于 $a  0$，单元 $e+1$ 的左边界耦合到单元 $e$ 的右边界。\n        这些耦合根据问题陈述的规定实现，并考虑了域的周期性。\n\n3.  **系统矩阵构建与特征分析**：在组装好全局矩阵后，构建两个半离散系统算子：\n    $$\n    \\mathbf{A}_{\\text{exact}} = a\\,\\mathbf{M}_{\\text{exact}}^{-1}\\,\\mathbf{K} \\qquad \\text{and} \\qquad \\mathbf{A}_{\\text{lumped}} = a\\,\\mathbf{M}_{\\text{lumped}}^{-1}\\,\\mathbf{K}\n    $$\n    稠密矩阵 $\\mathbf{M}_{\\text{exact}}$ 的逆矩阵使用标准线性求解器计算。对角矩阵 $\\mathbf{M}_{\\text{lumped}}$ 的逆矩阵通过取其对角元素的倒数轻易求得。然后计算 $\\mathbf{A}_{\\text{exact}}$ 和 $\\mathbf{A}_{\\text{lumped}}$ 的特征值。\n\n4.  **度量指标计算**：分析计算出的特征值谱，以确定每个算子所需的稳定性和准确性度量指标。\n    -   **前向欧拉稳定性极限 ($\\Delta t_{\\text{FE}}$)**：这是根据具有负实部 ($\\alpha  0$) 的特征值 $\\lambda = \\alpha + i\\beta$ 计算得出的，公式为 $\\Delta t_{\\text{FE}} = \\min (-2\\alpha / |\\lambda|^2)$。根据问题的约定，如果没有特征值具有负实部，则将 $\\Delta t_{\\text{FE}}$ 设为 $0$。\n    -   **色散误差 ($\\varepsilon_{\\text{disp}}$)**：该度量指标量化了最低可分辨波数 $k_1 = 2\\pi/L$ 的波传播速度误差。通过找到具有最小非零虚部的特征值，并将其大小与精确的连续色散关系 $|a|k_1$ 进行比较来计算。\n    -   **最大实部 ($\\max \\operatorname{Re}(\\lambda)$)**：该值表示半离散化的内在稳定性。对于稳定格式，该值应为非正数。任何正值都表示数值不稳定性。\n\n将此完整过程应用于问题中指定的每个测试用例，并收集六个结果度量指标，按要求进行格式化。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import legendre, roots_legendre\n\ndef get_lgl_nodes_weights(P):\n    \"\"\"\n    Computes Legendre-Gauss-Lobatto (LGL) nodes and weights for a given polynomial degree P.\n    The nodes are the roots of (1-x^2) * L_P'(x).\n    \"\"\"\n    if P == 0:\n        return np.array([-1.0]), np.array([2.0])\n    \n    # The interior LGL nodes are roots of the derivative of the P-th Legendre polynomial.\n    # For P=1, there are no interior roots.\n    if P == 1:\n        interior_nodes = np.array([])\n    else:\n        L_P_prime = legendre(P).deriv()\n        interior_nodes = L_P_prime.roots\n    \n    nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n    nodes = np.sort(np.real(nodes)) # Ensure real and sorted\n    \n    # LGL weights\n    L_P = legendre(P)\n    weights = 2.0 / (P * (P + 1) * (L_P(nodes)**2))\n    \n    return nodes, weights\n\ndef get_barycentric_diff_matrix(nodes):\n    \"\"\"\n    Computes the barycentric differentiation matrix for a given set of nodes.\n    \"\"\"\n    N = len(nodes)\n    D = np.zeros((N, N))\n    \n    bary_weights = np.ones(N)\n    for j in range(N):\n        for k in range(N):\n            if k != j:\n                bary_weights[j] /= (nodes[j] - nodes[k])\n\n    for i in range(N):\n        sum_row_i = 0.0\n        for j in range(N):\n            if i != j:\n                D[i, j] = (bary_weights[j] / bary_weights[i]) / (nodes[i] - nodes[j])\n                sum_row_i += D[i, j]\n        D[i, i] = -sum_row_i\n        \n    return D\n\ndef get_reference_exact_mass_matrix(P, lgl_nodes):\n    \"\"\"\n    Computes the reference element exact mass matrix using Gauss-Legendre quadrature.\n    \"\"\"\n    N_nodes = P + 1\n    # Use N_q points for Gauss-Legendre quadrature. Rule is exact for polys of degree 2*N_q-1.\n    # We integrate products of degree P Lagrange polynomials (total degree 2P).\n    # Need 2*N_q-1 = 2P = N_q = P + 1/2.\n    # Problem specifies N_q = P+2, so we use P+2.\n    N_q = P + 2\n    gl_nodes, gl_weights = roots_legendre(N_q)\n    \n    # Vandermonde-like matrix for Lagrange polynomials evaluated at GL quadrature points\n    V = np.ones((N_q, N_nodes))\n    for j in range(N_nodes):\n        for q in range(N_q):\n            val = 1.0\n            for k in range(N_nodes):\n                if k != j:\n                    val *= (gl_nodes[q] - lgl_nodes[k]) / (lgl_nodes[j] - lgl_nodes[k])\n            V[q, j] = val\n            \n    # M_ref = V^T * diag(gl_weights) * V\n    M_ref = V.T @ np.diag(gl_weights) @ V\n    return M_ref\n\ndef analyze_eigenvalues(lambdas, a, L):\n    \"\"\"\n    Calculates the stability and dispersion metrics from a given set of eigenvalues.\n    \"\"\"\n    tol = 1e-12\n\n    # Metric 1: Forward Euler stability limit\n    reals = np.real(lambdas)\n    dissipative_lambdas = lambdas[reals  -tol]\n    \n    if len(dissipative_lambdas) == 0:\n        dt_fe = 0.0\n    else:\n        dt_vals = -2 * np.real(dissipative_lambdas) / (np.abs(dissipative_lambdas)**2)\n        dt_fe = np.min(dt_vals)\n\n    # Metric 2: Low-wavenumber dispersion error\n    imags = np.imag(lambdas)\n    abs_imags = np.abs(imags)\n    nonzero_imags_mask = abs_imags > tol\n    \n    if not np.any(nonzero_imags_mask):\n        eps_disp = 0.0\n    else:\n        min_abs_imag = np.min(abs_imags[nonzero_imags_mask])\n        k1 = 2 * np.pi / L\n        ideal_phase_speed_mag = np.abs(a) * k1\n        if ideal_phase_speed_mag  tol: # handle a=0 case\n            eps_disp = 0.0 # Or undefined, but 0 is a reasonable convention\n        else:\n            eps_disp = min_abs_imag / ideal_phase_speed_mag - 1.0\n\n    # Metric 3: Maximum real part of eigenvalues\n    max_re = np.max(reals)\n    if abs(max_re)  tol:\n        max_re = 0.0\n\n    return dt_fe, eps_disp, max_re\n\ndef solve_case(L, a, Ne, P):\n    # Derived parameters\n    h = L / Ne\n    J = h / 2\n    N_nodes_per_elem = P + 1\n    Ndof = Ne * N_nodes_per_elem\n\n    # 1. Reference element data\n    lgl_nodes, lgl_weights = get_lgl_nodes_weights(P)\n    D_ref = get_barycentric_diff_matrix(lgl_nodes)\n    M_exact_ref = get_reference_exact_mass_matrix(P, lgl_nodes)\n    W_hat_ref_diag = lgl_weights\n\n    # 2. Global matrix assembly\n    M_exact = np.zeros((Ndof, Ndof))\n    M_lumped_diag = np.zeros(Ndof)\n    K = np.zeros((Ndof, Ndof))\n\n    e_minus = np.zeros(N_nodes_per_elem); e_minus[0] = 1.0\n    e_plus = np.zeros(N_nodes_per_elem); e_plus[-1] = 1.0\n\n    K_vol_ref = -np.diag(W_hat_ref_diag) @ D_ref\n\n    for e in range(Ne):\n        s = slice(e * N_nodes_per_elem, (e + 1) * N_nodes_per_elem)\n        \n        M_exact[s, s] = J * M_exact_ref\n        M_lumped_diag[s] = J * W_hat_ref_diag\n\n        K[s, s] += K_vol_ref\n\n        if a >= 0:\n            K[s, s] += np.outer(e_minus, e_minus)\n            e_prev = (e - 1 + Ne) % Ne\n            s_prev = slice(e_prev * N_nodes_per_elem, (e_prev + 1) * N_nodes_per_elem)\n            K[s, s_prev] += -np.outer(e_minus, e_plus)\n        else: # a  0\n            K[s, s] += np.outer(e_plus, e_plus)\n            e_next = (e + 1) % Ne\n            s_next = slice(e_next * N_nodes_per_elem, (e_next + 1) * N_nodes_per_elem)\n            K[s, s_next] += -np.outer(e_plus, e_minus)\n\n    # 3. Construct system matrices A\n    M_exact_inv = np.linalg.inv(M_exact)\n    M_lumped_inv = np.diag(1.0 / M_lumped_diag)\n    \n    A_exact = a * (M_exact_inv @ K)\n    A_lumped = a * (M_lumped_inv @ K)\n\n    # 4. Eigenvalue analysis\n    lambdas_exact = np.linalg.eigvals(A_exact)\n    lambdas_lumped = np.linalg.eigvals(A_lumped)\n    \n    # 5. Compute metrics\n    metrics_exact = analyze_eigenvalues(lambdas_exact, a, L)\n    metrics_lumped = analyze_eigenvalues(lambdas_lumped, a, L)\n\n    return [\n        metrics_exact[0], metrics_lumped[0],\n        metrics_exact[1], metrics_lumped[1],\n        metrics_exact[2], metrics_lumped[2]\n    ]\n\ndef solve():\n    test_cases = [\n        (1.0, 1.0, 8, 4),    # Case 1\n        (1.0, 1.0, 2, 1),    # Case 2\n        (1.0, 1.0, 4, 8),    # Case 3\n        (1.0, -0.7, 6, 3),   # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        L, a, Ne, P = case\n        result_case = solve_case(L, a, Ne, P)\n        results.append(result_case)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "分部求和（SBP）算子与用于处理边界条件的同步近似项（SAT）相结合，为构造可证明稳定性的高阶有限差分格式提供了强大的框架。SBP范数矩阵定义了离散内积，其选择会影响算子的性质。在本练习中，您将比较一个简单的对角范数和一个非对角的“完全”范数，利用特征分析来评估谱半径和稳定性限制，并进一步探讨算子的非正规性——这是理解瞬态误差增长的关键因素。",
            "id": "3382514",
            "problem": "考虑区间 $x \\in [0,1]$ 上的一维线性平流方程 $u_t + a u_x = 0$，当 $a  0$ 时，在 $x=0$ 处具有齐次入流边界条件。设有 $N$ 个等距网格点，间距为 $h = 1/(N-1)$。一个分部求和（SBP）一阶导数离散算子由一个对称正定范数矩阵 $H \\in \\mathbb{R}^{N \\times N}$ 和一个矩阵 $Q \\in \\mathbb{R}^{N \\times N}$ 构成，使得导数近似为 $D = H^{-1} Q$，并且 SBP 性质 $H D + D^{\\top} H = B$ 成立，其中边界矩阵为 $B = \\operatorname{diag}(-1, 0, \\ldots, 0, 1)$。对于 $a  0$ 的平流方程，通过同步近似项（SAT）在 $x=0$ 处施加边界条件，得到半离散系统\n$$\n\\frac{d}{dt} \\mathbf{u} = A \\mathbf{u}, \\quad A = -a D - a H^{-1} \\mathbf{e}_1 \\mathbf{e}_1^{\\top},\n$$\n其中 $\\mathbf{e}_1 = (1,0,\\ldots,0)^{\\top}$。\n\n您将比较两种 SBP 范数选择，以探究谱半径和非正规性之间的权衡，并量化它们对于经典的四阶显式 Runge–Kutta 方法的基于特征值的 Courant–Friedrichs–Lewy (CFL) 时间步长的影响：\n- 对角范数 $H_{\\mathrm{diag}} = h I$（其中 $I$ 是单位矩阵）。\n- 全（三对角）范数 $H_{\\mathrm{full}} = h (I + \\alpha T)$，其中 $T$ 是一个三对角矩阵，其第一副对角线和第一超对角线上的元素为1，其余元素为0，并且 $\\alpha \\in (0, 1/2)$ 是一个可调参数。对于给定的 $\\alpha$ 范围，该矩阵是对称正定的。\n\n使用标准的二阶精度 SBP 选择来构造 $Q$，使其满足 $Q + Q^{\\top} = B$ 并在内部产生中心格式：\n- 对于 $i = 2, \\ldots, N-1$，设置 $Q_{i, i+1} = 1/2$，$Q_{i, i-1} = -1/2$，且第 $i$ 行的所有其他元素为 $0$。\n- 在边界处，设置 $Q_{1,1} = -1/2$，$Q_{1,2} = 1/2$，$Q_{N,N-1} = -1/2$，$Q_{N,N} = 1/2$，且第 $1$ 行和第 $N$ 行的所有其他元素为 $0$。\n\n通过将 $H_{\\mathrm{diag}}$ 和 $H_{\\mathrm{full}}$ 分别代入 $A$ 的定义，可得到两个半离散算子 $A_{\\mathrm{diag}}$ 和 $A_{\\mathrm{full}}$。\n\n对于每个算子 $A$，计算以下量：\n1. 谱半径 $\\rho(A)$，定义为 $\\rho(A) = \\max_{\\lambda \\in \\Lambda(A)} |\\lambda|$，其中 $\\Lambda(A)$ 是 $A$ 的谱。\n2. 使用 $A$ 和 $A^{\\top}$ 的交换子的 Frobenius 范数作为非正规性度量，\n$$\n\\Delta(A) = \\lVert A^{\\top} A - A A^{\\top} \\rVert_F.\n$$\n3. 对于经典的四阶显式 Runge–Kutta 方法，基于特征值估计其最大稳定时间步长。令稳定性多项式为 $R(z) = 1 + z + \\frac{z^2}{2} + \\frac{z^3}{6} + \\frac{z^4}{24}$。定义\n$$\n\\Delta t_{\\max}(A) = \\sup \\left\\{ \\Delta t \\ge 0 \\,:\\, \\max_{\\lambda \\in \\Lambda(A)} \\left| R(\\Delta t \\,\\lambda) \\right| \\le 1 \\right\\}.\n$$\n这是一个必要的（基于特征值的）CFL 估计。然后定义相应的无量纲 CFL 数\n$$\n\\mathrm{CFL}(A) = \\frac{a\\, \\Delta t_{\\max}(A)}{h}.\n$$\n\n假设所有量都已无量纲化，长度以区域长度为单位进行度量，时间以相容的单位进行度量；以这些无量纲时间单位报告时间步长。\n\n实现一个完整的程序，该程序构造 $Q$、$H_{\\mathrm{diag}}$ 和 $H_{\\mathrm{full}}$；形成 $A_{\\mathrm{diag}}$ 和 $A_{\\mathrm{full}}$；计算上述定义的 $\\rho(\\cdot)$、$\\Delta(\\cdot)$、$\\Delta t_{\\max}(\\cdot)$ 和 $\\mathrm{CFL}(\\cdot)$；并对下面指定的每个测试用例汇总结果。\n\n测试套件（每个测试用例是一个三元组 $(N, a, \\alpha)$）：\n- 用例1（一般行为）：$(N, a, \\alpha) = (20, 1.0, 0.25)$。\n- 用例2（小网格和更强的全范数耦合）：$(N, a, \\alpha) = (8, 1.0, 0.45)$。\n- 用例3（更强的平流，中等全范数耦合）：$(N, a, \\alpha) = (40, 2.5, 0.25)$。\n\n对于每个用例，您的程序必须按顺序输出以下八个实数的列表：\n- $\\rho(A_{\\mathrm{diag}})$,\n- $\\rho(A_{\\mathrm{full}})$,\n- $\\Delta(A_{\\mathrm{diag}})$,\n- $\\Delta(A_{\\mathrm{full}})$,\n- $\\Delta t_{\\max}(A_{\\mathrm{diag}})$,\n- $\\Delta t_{\\max}(A_{\\mathrm{full}})$,\n- $\\mathrm{CFL}(A_{\\mathrm{diag}})$,\n- $\\mathrm{CFL}(A_{\\mathrm{full}})$。\n\n最终输出格式：您的程序应生成单行输出，其中包含每个用例结果的列表。每个用例的结果是一个包含八个浮点数的内层列表（按指定顺序），外层列表则按测试套件的顺序汇总所有用例。打印的字符串必须是这种嵌套列表的精确的、由括号括起并以逗号分隔的表示形式（例如，对于两个用例，它看起来像“[[...八个数字...],[...八个数字...]]”）。所有角度（如果存在）必须以弧度为单位，所有时间步长必须以问题陈述所隐含的无量纲时间单位报告。",
            "solution": "该问题是有效的，因为它提出了一个在数值分析领域中适定的、有科学依据的任务。它要求为线性平流方程构造半离散算子并进行特征分析，这些算子源于分部求和（SBP）框架和用于边界条件的同步近似项（SAT）。所有的定义、参数和度量都是标准的且明确指定的。\n\n问题的核心是比较两种不同的 SBP 范数矩阵，一个是对角矩阵（$H_{\\mathrm{diag}}$），另一个是非对角矩阵（$H_{\\mathrm{full}}$），并量化它们对所得系统的稳定性和非正规性的影响。\n\n对每个测试用例 $(N, a, \\alpha)$，求解过程系统地进行。\n\n**1. 系统组件构造**\n首先，我们根据问题的定义构造基本矩阵。令 $N$ 为网格点数。\n- 网格间距为 $h = 1/(N-1)$。\n- 构造矩阵 $Q \\in \\mathbb{R}^{N \\times N}$ 来表示一阶导数的二阶精度有限差分近似。其元素为：\n  $$\n  Q_{i,j} = \n  \\begin{cases} \n  -1/2  \\text{如果 } j=i-1 \\text{ 且 } i=2, \\dots, N-1 \\\\\n  1/2  \\text{如果 } j=i+1 \\text{ 且 } i=2, \\dots, N-1 \\\\\n  -1/2  \\text{如果 } i=1,j=1 \\text{ 或 } i=N,j=N-1 \\\\\n  1/2  \\text{如果 } i=1,j=2 \\text{ 或 } i=N,j=N \\\\\n  0  \\text{其他情况}\n  \\end{cases}\n  $$\n  这种构造确保了 $Q+Q^{\\top} = B = \\operatorname{diag}(-1, 0, \\ldots, 0, 1)$。\n- 两个范数矩阵是：\n  - **对角范数**：$H_{\\mathrm{diag}} = hI$，其中 $I$ 是 $N \\times N$ 单位矩阵。\n  - **全范数**：$H_{\\mathrm{full}} = h(I + \\alpha T)$，其中 $T$ 是一个三对角矩阵，其第一副对角线和第一超对角线上的元素为1。对于 $\\alpha \\in (0, 1/2)$，$H_{\\mathrm{full}}$ 是对称正定的。\n\n**2. 半离散系统矩阵的构建**\n对于范数矩阵 $H$ 的每种选择，构建半离散系统 $\\frac{d}{dt} \\mathbf{u} = A \\mathbf{u}$。\n- SBP 一阶导数算子是 $D = H^{-1}Q$。\n- 系统矩阵 $A$ 包含了平流项 $-a D$ 和用于 $x=0$ 处齐次入流边界条件的 SAT 惩罚项。如题目所给，$A = -a D - a H^{-1} \\mathbf{e}_1 \\mathbf{e}_1^{\\top}$，其中 $\\mathbf{e}_1=(1,0,\\dots,0)^{\\top}$。\n此过程产生用于比较的两个矩阵：$A_{\\mathrm{diag}}$（使用 $H_{\\mathrm{diag}}$）和 $A_{\\mathrm{full}}$（使用 $H_{\\mathrm{full}}$）。\n\n**3. 稳定性与特征值性质**\n这种 SBP-SAT 格式的一个关键性质是其稳定性，这可以通过能量估计来证明。解的范数平方 $||\\mathbf{u}||_H^2 = \\mathbf{u}^{\\top} H \\mathbf{u}$ 的时间导数由下式给出：\n$$ \\frac{d}{dt}||\\mathbf{u}||_H^2 = \\mathbf{u}^{\\top}(A^{\\top} H + H A)\\mathbf{u} $$\n代入 $A$ 的定义并使用 $Q+Q^{\\top}=B$，我们发现：\n$$ A^{\\top} H + H A = -a(Q^{\\top}+Q) - 2a \\mathbf{e}_1 \\mathbf{e}_1^{\\top} = -a B - 2a \\mathbf{e}_1 \\mathbf{e}_1^{\\top} = \\operatorname{diag}(-a, 0, \\dots, 0, -a) $$\n由于当 $a0$ 时该矩阵是负半定的，因此系统是稳定的。由此可推断，$A$ 的特征值 $\\lambda$ 的实部必须是非正的，即 $\\operatorname{Re}(\\lambda) \\le 0$。此外，严格的分析表明，对于这个特定问题，除非 $\\lambda=0$，否则 $\\operatorname{Re}(\\lambda)  0$。\n\n**4. 所需度量的计算**\n对于每个矩阵 $A \\in \\{A_{\\mathrm{diag}}, A_{\\mathrm{full}}\\}$，我们计算指定的量。\n\n- **谱半径 $\\rho(A)$**：我们使用标准的数值特征值求解器计算 $A$ 的全谱 $\\Lambda(A)$。然后谱半径为 $\\rho(A) = \\max_{\\lambda \\in \\Lambda(A)} |\\lambda|$。\n\n- **非正规性 $\\Delta(A)$**：非正规度由 $A$ 与其转置的交换子的 Frobenius 范数来衡量，$\\Delta(A) = \\lVert A^{\\top} A - A A^{\\top} \\rVert_F$。这可以直接计算。\n\n- **最大稳定时间步长 $\\Delta t_{\\max}(A)$**：对于四阶显式 Runge-Kutta (RK4) 方法，其稳定性取决于以下条件：对于 $A$ 的每个特征值 $\\lambda$，值 $z = \\Delta t \\cdot \\lambda$ 必须位于该方法的稳定性区域内。该区域由 $|R(z)| \\le 1$ 定义，其中 $R(z) = 1 + z + \\frac{z^2}{2} + \\frac{z^3}{6} + \\frac{z^4}{24}$ 是稳定性多项式。\n我们寻求找到 $\\Delta t_{\\max}(A) = \\sup \\left\\{ \\Delta t \\ge 0 \\,:\\, \\max_{\\lambda \\in \\Lambda(A)} \\left| R(\\Delta t \\,\\lambda) \\right| \\le 1 \\right\\}$。\n令函数 $g(\\Delta t) = \\max_{\\lambda \\in \\Lambda(A)} |R(\\Delta t \\lambda)| - 1$。由于所有特征值的实部 $\\operatorname{Re}(\\lambda) \\le 0$，对于一个小的 $\\Delta t  0$，所有的 $z = \\Delta t \\lambda$ 都位于原点附近的稳定性区域内，这意味着 $g(\\Delta t) \\le 0$。随着 $\\Delta t$ 的增加，某些 $z$ 将到达稳定性区域的边界，此时 $|R(z)|=1$。因此，$\\Delta t_{\\max}$ 是方程 $g(\\Delta t) = 0$ 的最小正根。这个根可以使用鲁棒的数值算法（如 `scipy.optimize.root_scalar` 中可用的 Brent 方法）找到。可以为根建立一个合适的搜索区间，例如，对于某个常数 `C`，区间为 `[1e-9, C/\\rho(A)]`，因为 $g(1e-9)$ 是负的，而 $g(\\cdot)$ 最终会变为正值。\n\n- **CFL 数 $\\mathrm{CFL}(A)$**：无量纲的 Courant–Friedrichs–Lewy (CFL) 数计算为 $\\mathrm{CFL}(A) = \\frac{a\\, \\Delta t_{\\max}(A)}{h}$。\n\n通过对每个测试用例实施这些步骤，我们为每个用例生成所需的八个度量指标的列表，从而比较对角范数和全范数方法。",
            "answer": "```python\n# language: Python\n# version: 3.12\n# libraries:\n#   - name: numpy\n#     version: 1.23.5\n#   - name: scipy\n#     version: 1.11.4\n\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef build_q_matrix(N):\n    \"\"\"Constructs the second-order SBP Q matrix of size N x N.\"\"\"\n    Q = np.zeros((N, N))\n    if N  2:\n        return Q\n\n    # Interior stencils (rows 1 to N-2 in 0-based indexing)\n    for i in range(1, N - 1):\n        Q[i, i - 1] = -0.5\n        Q[i, i + 1] = 0.5\n\n    # Boundary stencils\n    Q[0, 0] = -0.5\n    Q[0, 1] = 0.5\n    Q[N - 1, N - 2] = -0.5\n    Q[N - 1, N - 1] = 0.5\n    return Q\n\ndef rk4_stability_poly(z):\n    \"\"\"Evaluates the stability polynomial for the classical RK4 method.\"\"\"\n    return 1 + z + z**2 / 2.0 + z**3 / 6.0 + z**4 / 24.0\n\ndef find_max_stable_dt(eigvals):\n    \"\"\"\n    Finds the maximum stable time step for RK4 based on the eigenvalue spectrum.\n    This is achieved by finding the root of g(dt) = max(|R(dt*lambda)|) - 1 = 0.\n    \"\"\"\n    if not eigvals.any():\n        return 0.0\n\n    def g(dt):\n        \"\"\"Objective function for the root-finding problem.\"\"\"\n        # Ensure dt is slightly positive to avoid issues at dt=0 where g(0)=0\n        if dt = 1e-12:\n            return -1.0\n        z = dt * eigvals\n        return np.max(np.abs(rk4_stability_poly(z))) - 1.0\n\n    # Heuristic for search bracket: The RK4 stability region boundary is at a\n    # distance of roughly 2.8 from the origin. A safe upper bound for dt would be\n    # on the order of C / rho(A) for some constant C > 2.8.\n    rho_A = np.max(np.abs(eigvals))\n    upper_bound = 10.0 / rho_A if rho_A > 1e-9 else 10.0\n\n    try:\n        # Use Brent's method to find the root in the bracket [1e-9, upper_bound].\n        # We know g(1e-9)  0 and g(upper_bound) should be > 0 for a stable system.\n        sol = root_scalar(g, bracket=[1e-9, upper_bound], method='brentq')\n        return sol.root\n    except ValueError:\n        # If the upper bound is too small and g(upper_bound) is still negative,\n        # widen the search interval and retry.\n        upper_bound *= 10\n        sol = root_scalar(g, bracket=[1e-9, upper_bound], method='brentq')\n        return sol.root\n\ndef solve_one_case(N, a, alpha):\n    \"\"\"\n    Processes a single test case (N, a, alpha) and returns the 8 required metrics.\n    \"\"\"\n    h = 1.0 / (N - 1)\n    \n    Q = build_q_matrix(N)\n    \n    # Define e1 vector and e1*e1^T matrix for the SAT term\n    e1 = np.zeros(N)\n    e1[0] = 1.0\n    e1e1T = np.outer(e1, e1)\n\n    # --- Diagonal Norm Case ---\n    H_diag = h * np.identity(N)\n    H_diag_inv = (1.0 / h) * np.identity(N)\n    D_diag = H_diag_inv @ Q\n    A_diag = -a * D_diag - a * H_diag_inv @ e1e1T\n\n    eigvals_diag = np.linalg.eigvals(A_diag)\n    rho_diag = np.max(np.abs(eigvals_diag))\n    delta_diag = np.linalg.norm(A_diag.T @ A_diag - A_diag @ A_diag.T, 'fro')\n    dt_max_diag = find_max_stable_dt(eigvals_diag)\n    cfl_diag = a * dt_max_diag / h\n\n    # --- Full Norm Case ---\n    I = np.identity(N)\n    T = np.diag(np.ones(N - 1), k=1) + np.diag(np.ones(N - 1), k=-1)\n    H_full = h * (I + alpha * T)\n    H_full_inv = np.linalg.inv(H_full)\n    D_full = H_full_inv @ Q\n    A_full = -a * D_full - a * H_full_inv @ e1e1T\n\n    eigvals_full = np.linalg.eigvals(A_full)\n    rho_full = np.max(np.abs(eigvals_full))\n    delta_full = np.linalg.norm(A_full.T @ A_full - A_full @ A_full.T, 'fro')\n    dt_max_full = find_max_stable_dt(eigvals_full)\n    cfl_full = a * dt_max_full / h\n    \n    return [\n        rho_diag, rho_full,\n        delta_diag, delta_full,\n        dt_max_diag, dt_max_full,\n        cfl_diag, cfl_full\n    ]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        (20, 1.0, 0.25),\n        (8, 1.0, 0.45),\n        (40, 2.5, 0.25),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N, a, alpha = case\n        case_results = solve_one_case(N, a, alpha)\n        all_results.append(case_results)\n\n    # Convert the nested list of results into the required string format.\n    # e.g., \"[[r1, r2, ...], [r1, r2, ...]]\"\n    result_str = \"[\" + \",\".join([\n        \"[\" + \",\".join(map(str, res)) + \"]\" for res in all_results\n    ]) + \"]\"\n    \n    print(result_str)\n\nsolve()\n```"
        },
        {
            "introduction": "虽然数值实验对于评估算子谱至关重要，但傅里叶分析等解析技术能为我们理解数值格式的行为提供更深刻、更具普适性的见解。本练习将重心从编程转向推导，将傅里叶分析应用于平流方程的DG格式。通过研究算子在奈奎斯特（Nyquist）波数（即网格所能表示的最高频率）下的符号，您将能够从解析上揭示并刻画那些在连续问题中不可见、但对离散系统动力学至关重要的非物理“伪模态”的存在与特性。",
            "id": "3382522",
            "problem": "考虑一维线性平流方程$u_{t} + a u_{x} = 0$，其中速度$a \\in \\mathbb{R}$为常数。该方程定义在一个周期性区间上，此区间被划分为$N$个大小为$h  0$的均匀单元格组成的网格。在每个单元格上，使用多项式次数为$p=1$的间断Galerkin (DG)方法（Discontinuous Galerkin (DG)）来近似$u(x,t)$，在参考单元$\\xi \\in [-1,1]$上使用标准正交的Legendre基函数：$\\phi_{0}(\\xi) = 1/\\sqrt{2}$，$\\phi_{1}(\\xi) = \\sqrt{3/2}\\,\\xi$。使用标准的DG弱形式，并采用中心数值通量，其中物理通量$f(u) = a u$在界面处的数值通量定义为$f^{*} = a U^{*}$，其中$U^{*} = \\frac{1}{2}(u^{-} + u^{+})$。通过$x = x_{j} + (h/2)\\,\\xi$将每个物理单元$I_{j}$映射到参考单元，因此$u_{x} = (2/h)\\,u_{\\xi}$。\n\n从弱形式和所选基函数的标准正交性出发，推导每个单元$I_{j}$中模态系数$u_{j,0}(t)$和$u_{j,1}(t)$的半离散系统。然后，使用傅里叶（平面波）拟设$u_{j,m}(t) = \\hat{u}_{m}\\,\\exp(i \\theta j)\\,\\exp(\\lambda t)$（其中无量纲波数为$\\theta = k h$，未知增长率为$\\lambda$），以获得DG空间算子的$2 \\times 2$符号。在由$\\theta = \\pi$定义的奈奎斯特波数处评估此符号，并计算相关的特征值和右特征向量。通过设置$\\hat{u}_{0} = 1$来归一化每个特征向量，并报告每个特征向量的比率$\\hat{u}_{1}/\\hat{u}_{0}$。\n\n将您的最终答案以单行矩阵的形式给出，该矩阵按顺序包含$\\theta = \\pi$处的两个特征值$\\lambda_{+}$、$\\lambda_{-}$，然后是每个特征值对应的特征向量比率$\\hat{u}_{1}/\\hat{u}_{0}$（首先是$\\lambda_{+}$的，然后是$\\lambda_{-}$的）。不需要四舍五入，您的答案必须以$a$和$h$的符号形式表示。",
            "solution": "用户希望找到线性平流方程在奈奎斯特波数下，其间断Galerkin (DG)空间算子的特征值和特征向量。\n\n### 步骤1：验证问题陈述\n\n**1.1. 提取已知条件**\n- **方程**：一维线性平流方程，$u_{t} + a u_{x} = 0$，其中速度$a \\in \\mathbb{R}$为常数。\n- **域**：一个周期性区间，被划分为$N$个大小为$h  0$的均匀单元格组成的网格。\n- **离散化方法**：多项式次数为$p=1$的间断Galerkin (DG)方法。\n- **基函数**：在参考单元$\\xi \\in [-1,1]$上，标准正交的Legendre基函数为$\\phi_{0}(\\xi) = 1/\\sqrt{2}$和$\\phi_{1}(\\xi) = \\sqrt{3/2}\\,\\xi$。\n- **弱形式**：标准的DG弱形式。\n- **数值通量**：对于$f(u) = a u$的中心通量，定义为$f^{*} = a U^{*}$，其中$U^{*} = \\frac{1}{2}(u^{-} + u^{+})$。\n- **映射**：物理单元$I_{j}$通过$x = x_{j} + (h/2)\\,\\xi$映射到参考单元，这意味着$\\partial_{x} = (2/h)\\,\\partial_{\\xi}$。\n- **分析任务**：\n    1. 推导单元$I_j$中模态系数$u_{j,0}(t)$和$u_{j,1}(t)$的半离散系统。\n    2. 使用拟设$u_{j,m}(t) = \\hat{u}_{m}\\,\\exp(i \\theta j)\\,\\exp(\\lambda t)$（其中$\\theta = k h$）进行傅里叶分析。\n    3. 求出DG算子的$2 \\times 2$符号。\n    4. 在奈奎斯特波数$\\theta = \\pi$处评估该符号。\n    5. 计算所得矩阵的特征值和特征向量。\n    6. 通过设置$\\hat{u}_{0} = 1$来归一化特征向量，并求出比率$\\hat{u}_{1}/\\hat{u}_{0}$。\n\n**1.2. 使用提取的已知条件进行验证**\n- **科学依据**：该问题是偏微分方程数值分析中的一个标准练习，特别关注DG方法的光谱性质。所有概念在应用数学和计算科学中都已成熟。\n- **适定性**：该问题提供了一套完整的定义和约束，可以为指定的特征值和特征向量找到唯一且有意义的解。\n- **客观性**：该问题使用精确的数学语言陈述，没有歧义或主观论断。\n\n**1.3. 结论与行动**\n问题有效。我们开始求解。\n\n### 步骤2：推导半离散系统\n\n我们从平流方程在单元$I_j = [x_{j-1/2}, x_{j+1/2}]$上的弱形式开始：\n$$\n\\int_{I_j} v (u_t + a u_x) dx = 0\n$$\n对于与解近似$u_h$处于相同多项式空间中的任何测试函数$v$。对空间项进行分部积分得到：\n$$\n\\int_{I_j} v u_t dx - a \\int_{I_j} v_x u_h dx + [a v u_h]_{x_{j-1/2}}^{x_{j+1/2}} = 0\n$$\n用数值通量$f^* = a U^*$替换边界项：\n$$\n\\int_{I_j} v u_t dx - a \\int_{I_j} v_x u_h dx + a v(x_{j+1/2}) U^*(x_{j+1/2}) - a v(x_{j-1/2}) U^*(x_{j-1/2}) = 0\n$$\n单元$I_j$中的解$u_h$在基函数中展开为：$u_h(x,t) = u_{j,0}(t)\\phi_0(\\xi(x)) + u_{j,1}(t)\\phi_1(\\xi(x))$。我们选择测试函数$v$为基函数之一，$\\phi_k(\\xi(x))$。\n\n我们使用$x = x_j + \\frac{h}{2}\\xi$将积分映射到参考单元$\\xi \\in [-1,1]$，因此$dx = \\frac{h}{2}d\\xi$且$\\partial_x = \\frac{2}{h}\\partial_\\xi$。\n$$\n\\frac{h}{2}\\int_{-1}^{1} \\phi_k u_{ht} d\\xi - a \\int_{-1}^{1} \\frac{2}{h}\\frac{d\\phi_k}{d\\xi} u_h \\frac{h}{2}d\\xi + a \\phi_k(1) U_{j+1/2}^* - a \\phi_k(-1) U_{j-1/2}^* = 0\n$$\n$$\n\\frac{h}{2}\\int_{-1}^{1} \\phi_k \\sum_{m=0}^{1} \\frac{du_{j,m}}{dt}\\phi_m d\\xi - a \\int_{-1}^{1} \\frac{d\\phi_k}{d\\xi} \\sum_{m=0}^{1} u_{j,m}\\phi_m d\\xi + a \\phi_k(1) U_{j+1/2}^* - a \\phi_k(-1) U_{j-1/2}^* = 0\n$$\n利用基函数的标准正交性，$\\int_{-1}^1 \\phi_k \\phi_m d\\xi = \\delta_{km}$，第一项简化为$\\frac{h}{2}\\frac{du_{j,k}}{dt}$。方程变为：\n$$\n\\frac{h}{2}\\frac{du_{j,k}}{dt} = a \\sum_{m=0}^{1} u_{j,m} \\int_{-1}^{1} \\frac{d\\phi_k}{d\\xi} \\phi_m d\\xi - a \\left( \\phi_k(1)U_{j+1/2}^* - \\phi_k(-1)U_{j-1/2}^* \\right)\n$$\n让我们计算积分和边界值。\n导数为$\\frac{d\\phi_0}{d\\xi} = 0$和$\\frac{d\\phi_1}{d\\xi} = \\sqrt{3/2}$。\n刚度矩阵积分$S_{km} = \\int_{-1}^1 \\frac{d\\phi_k}{d\\xi}\\phi_m d\\xi$为：\n$S_{00}=S_{01}=0$。\n$S_{10} = \\int_{-1}^1 \\sqrt{3/2} (1/\\sqrt{2}) d\\xi = \\sqrt{3}$。\n$S_{11} = \\int_{-1}^1 \\sqrt{3/2} (\\sqrt{3/2}\\xi) d\\xi = 0$。\n\n在单元边界$\\xi=\\pm 1$处的基函数值为：\n$\\phi_0(1) = 1/\\sqrt{2}$，$\\phi_0(-1) = 1/\\sqrt{2}$。\n$\\phi_1(1) = \\sqrt{3/2}$，$\\phi_1(-1) = -\\sqrt{3/2}$。\n\n数值通量$U_{j+1/2}^* = \\frac{1}{2}(u_h(x_{j+1/2}^-) + u_h(x_{j+1/2}^+))$涉及单元$j$和$j+1$的值：\n$u_h(x_{j+1/2}^-) = u_{j,0}\\phi_0(1) + u_{j,1}\\phi_1(1)$，以及$u_h(x_{j+1/2}^+) = u_{j+1,0}\\phi_0(-1) + u_{j+1,1}\\phi_1(-1)$。\n$U_{j-1/2}^*$的情况类似，涉及单元$j-1$和$j$。\n\n对于$k=0$（用$\\phi_0$测试）：\n刚度项为零。\n$$\n\\frac{h}{2}\\frac{du_{j,0}}{dt} = -a \\left( \\phi_0(1)U_{j+1/2}^* - \\phi_0(-1)U_{j-1/2}^* \\right) = -\\frac{a}{\\sqrt{2}} \\left( U_{j+1/2}^* - U_{j-1/2}^* \\right)\n$$\n代入$U^*$和基函数的表达式得到：\n$$\n\\frac{h}{2}\\frac{du_{j,0}}{dt} = -\\frac{a}{4} \\left[ (u_{j+1,0} - u_{j-1,0}) + 2\\sqrt{3}u_{j,1} - \\sqrt{3}(u_{j+1,1} + u_{j-1,1}) \\right]\n$$\n\n对于$k=1$（用$\\phi_1$测试）：\n$$\n\\frac{h}{2}\\frac{du_{j,1}}{dt} = a(u_{j,0}S_{10} + u_{j,1}S_{11}) - a(\\phi_1(1)U_{j+1/2}^* - \\phi_1(-1)U_{j-1/2}^*)\n$$\n$$\n\\frac{h}{2}\\frac{du_{j,1}}{dt} = a\\sqrt{3}u_{j,0} - a\\sqrt{3/2}(U_{j+1/2}^* + U_{j-1/2}^*)\n$$\n代入后得到：\n$$\n\\frac{h}{2}\\frac{du_{j,1}}{dt} = \\frac{a\\sqrt{3}}{2}u_{j,0} - \\frac{a\\sqrt{3}}{4}(u_{j+1,0}+u_{j-1,0}) + \\frac{3a}{4}(u_{j+1,1}-u_{j-1,1})\n$$\n\n### 步骤3：傅里叶分析与符号矩阵\n\n我们应用傅里叶拟设$u_{j,m}(t) = \\hat{u}_m \\exp(i\\theta j)\\exp(\\lambda t)$。这意味着：\n$\\frac{du_{j,m}}{dt} = \\lambda u_{j,m}$，$u_{j+1,m} = e^{i\\theta}u_{j,m}$，$u_{j-1,m} = e^{-i\\theta}u_{j,m}$。\n因此，$u_{j+1,m} - u_{j-1,m} = 2i\\sin(\\theta)u_{j,m}$且$u_{j+1,m} + u_{j-1,m} = 2\\cos(\\theta)u_{j,m}$。\n将这些代入半离散方程并除以$\\exp(i\\theta j)\\exp(\\lambda t)$：\n\n对于$\\hat{u}_0$方程：\n$$\n\\frac{h}{2}\\lambda \\hat{u}_0 = -\\frac{a}{4} \\left[ 2i\\sin(\\theta)\\hat{u}_0 + 2\\sqrt{3}\\hat{u}_1 - \\sqrt{3}(2\\cos(\\theta)\\hat{u}_1) \\right]\n$$\n$$\n\\lambda \\hat{u}_0 = -\\frac{a}{h} \\left[ i\\sin(\\theta)\\hat{u}_0 + \\sqrt{3}(1-\\cos(\\theta))\\hat{u}_1 \\right]\n$$\n\n对于$\\hat{u}_1$方程：\n$$\n\\frac{h}{2}\\lambda \\hat{u}_1 = \\frac{a\\sqrt{3}}{2}\\hat{u}_0 - \\frac{a\\sqrt{3}}{4}(2\\cos(\\theta)\\hat{u}_0) + \\frac{3a}{4}(2i\\sin(\\theta)\\hat{u}_1)\n$$\n$$\n\\lambda \\hat{u}_1 = \\frac{a}{h} \\left[ \\sqrt{3}(1-\\cos(\\theta))\\hat{u}_0 + 3i\\sin(\\theta)\\hat{u}_1 \\right]\n$$\n\n这两个方程构成一个$2 \\times 2$的特征值问题$\\lambda \\mathbf{\\hat{u}} = Z(\\theta) \\mathbf{\\hat{u}}$，其中$\\mathbf{\\hat{u}} = [\\hat{u}_0, \\hat{u}_1]^T$，符号矩阵$Z(\\theta)$为：\n$$\nZ(\\theta) = \\frac{a}{h}\n\\begin{pmatrix}\n-i\\sin(\\theta)  -\\sqrt{3}(1-\\cos(\\theta)) \\\\\n\\sqrt{3}(1-\\cos(\\theta))  3i\\sin(\\theta)\n\\end{pmatrix}\n$$\n\n### 步骤4：在奈奎斯特波数下的特征分析\n\n我们现在在奈奎斯特波数$\\theta = \\pi$处评估该符号。在此波数下，$\\sin(\\pi) = 0$且$\\cos(\\pi) = -1$，所以$1-\\cos(\\pi) = 2$。\n符号矩阵变为：\n$$\nZ(\\pi) = \\frac{a}{h}\n\\begin{pmatrix}\n0  -2\\sqrt{3} \\\\\n2\\sqrt{3}  0\n\\end{pmatrix}\n$$\n\n为了找到特征值$\\lambda$，我们求解特征方程$\\det(Z(\\pi) - \\lambda I) = 0$：\n$$\n\\det \\begin{pmatrix} -\\lambda  -2a\\sqrt{3}/h \\\\ 2a\\sqrt{3}/h  -\\lambda \\end{pmatrix} = (-\\lambda)^2 - \\left(-\\frac{2a\\sqrt{3}}{h}\\right)\\left(\\frac{2a\\sqrt{3}}{h}\\right) = 0\n$$\n$$\n\\lambda^2 + \\frac{4a^2(3)}{h^2} = 0 \\implies \\lambda^2 = -\\frac{12a^2}{h^2}\n$$\n特征值是纯虚数：\n$$\n\\lambda = \\pm i \\sqrt{\\frac{12a^2}{h^2}} = \\pm i \\frac{2a\\sqrt{3}}{h}\n$$\n我们将其表示为$\\lambda_{+} = i \\frac{2a\\sqrt{3}}{h}$和$\\lambda_{-} = -i \\frac{2a\\sqrt{3}}{h}$。\n\n为了找到对应的特征向量$\\mathbf{\\hat{u}} = [\\hat{u}_0, \\hat{u}_1]^T$，我们求解$(Z(\\pi) - \\lambda I)\\mathbf{\\hat{u}} = 0$。使用矩阵方程的第一行：\n$$\n-\\lambda \\hat{u}_0 - \\frac{2a\\sqrt{3}}{h} \\hat{u}_1 = 0\n$$\n这给出了特征向量分量的比率：\n$$\n\\frac{\\hat{u}_1}{\\hat{u}_0} = -\\frac{\\lambda h}{2a\\sqrt{3}}\n$$\n我们通过设置$\\hat{u}_0 = 1$进行归一化。\n\n对于特征值$\\lambda_{+} = i \\frac{2a\\sqrt{3}}{h}$：\n比率为：\n$$\n\\frac{\\hat{u}_1}{\\hat{u}_0} = -\\frac{(i \\frac{2a\\sqrt{3}}{h}) h}{2a\\sqrt{3}} = -i\n$$\n特征向量与$[1, -i]^T$成正比。\n\n对于特征值$\\lambda_{-} = -i \\frac{2a\\sqrt{3}}{h}$：\n比率为：\n$$\n\\frac{\\hat{u}_1}{\\hat{u}_0} = -\\frac{(-i \\frac{2a\\sqrt{3}}{h}) h}{2a\\sqrt{3}} = i\n$$\n特征向量与$[1, i]^T$成正比。\n\n最终答案要求按特定顺序给出两个特征值和两个对应的特征向量比率。\n- $\\lambda_{+} = i \\frac{2a\\sqrt{3}}{h}$\n- $\\lambda_{-} = -i \\frac{2a\\sqrt{3}}{h}$\n- $\\lambda_{+}$的比率：$-i$\n- $\\lambda_{-}$的比率：$i$\n\n这些被组合成一个单行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\ni \\frac{2a\\sqrt{3}}{h}  -i \\frac{2a\\sqrt{3}}{h}  -i  i\n\\end{pmatrix}\n}\n$$"
        }
    ]
}