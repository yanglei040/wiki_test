{
    "hands_on_practices": [
        {
            "introduction": "本练习是后续实践的基础，它聚焦于单个参考单元内部的高阶节点DG方法的构建模块。通过手动构建一个函数的插值多项式并计算由此产生的混叠误差，你将对求积规则和多项式基函数如何相互作用，以及欠积分（质量集中）为何会引入误差有一个具体的理解。这个动手计算的过程将揭开抽象的混叠概念的神秘面纱。",
            "id": "3375706",
            "problem": "对于守恒形式的线性声波方程的间断伽辽金 (DG) 离散，考虑一维参考单元 $[-1,1]$。设多项式阶数为 $p=3$，模态基为前四个 Legendre 多项式 $\\{P_{0}(x),P_{1}(x),P_{2}(x),P_{3}(x)\\}$。对 $N+1=p+1=4$ 个点使用 Legendre–Gauss–Lobatto (LGL) 节点。根据定义，这些节点是 $x_{0}=-1$、$x_{3}=1$，以及等于 $P_{3}'(x)$ 的两个根的 $x_{1}$ 和 $x_{2}$。相关的 LGL 求积对于阶数至多为 $2N-1=5$ 的所有多项式都是精确的。\n\n您将分析当可变系数导致有效被积函数的阶数大于 $5$ 时，DG 体积项中可能出现的欠积分（混叠）现象。为了在一个受控测试中进行此分析，取函数 $f(x)=P_{6}(x)$，即第六阶 Legendre 多项式。请执行以下步骤：\n\n- 构建 Vandermonde 矩阵 $V\\in\\mathbb{R}^{4\\times 4}$，其元素为 $V_{ij}=P_{j}(x_{i})$，其中 $i=0,1,2,3$ 索引 LGL 节点，$j=0,1,2,3$ 索引模态基函数。\n- 在这些 LGL 节点上，以 Legendre 模态基计算 $f(x)$ 的 $3$ 次插值多项式 $p_{3}(x)$，即找到系数 $c_{0},c_{1},c_{2},c_{3}$，使得 $p_{3}(x)=\\sum_{j=0}^{3}c_{j}P_{j}(x)$ 且对所有 $i$ 都有 $p_{3}(x_{i})=f(x_{i})$。\n- 使用这 $4$ 个节点的 LGL 求积，通过对 $p_{3}$ 进行求积来近似计算 $f$ 在 $[-1,1]$ 上的单元平均值，并将其与 $f$ 的精确单元平均值进行比较。将混叠误差定义为基于求积的单元平均值与精确单元平均值之差。\n\n作为您的最终答案，请以单个精确有理数的形式提供单元平均值的混叠误差。最终数值不带单位。",
            "solution": "用户希望我分析间断伽辽金 (DG) 方法中的混叠效应。\n\n计划如下：\n1.  **验证问题陈述**：\n    *   **已知条件**：\n        *   区域：一维参考单元 `[-1, 1]`\n        *   方程：线性声波方程（上下文信息，但未直接使用）\n        *   离散化：DG 方法\n        *   多项式阶数：`p = 3`\n        *   模态基：前四个 Legendre 多项式，`{P_0(x), P_1(x), P_2(x), P_3(x)}`\n        *   求积节点：`N+1 = p+1 = 4` 个点的 Legendre-Gauss-Lobatto (LGL) 节点。\n        *   LGL 节点定义：`x_0 = -1`，`x_3 = 1`，以及 `x_1, x_2` 是 `P_3'(x)` 的根。\n        *   LGL 求积性质：对于阶数至多为 `2N-1 = 2(3)-1 = 5` 的多项式是精确的。\n        *   测试函数：`f(x) = P_6(x)`，第六阶 Legendre 多项式。\n        *   任务1：构建 Vandermonde 矩阵 `V`，其中 `V_ij = P_j(x_i)`。\n        *   任务2：在 LGL 节点上计算 `f(x)` 的3次插值多项式 `p_3(x)`。也就是说，找到系数 `c_j` 使得 `p_3(x) = sum(c_j * P_j(x))` 且 `p_3(x_i) = f(x_i)`。\n        *   任务3：使用 `p_3(x)` 的 LGL 求积来近似 `f(x)` 的单元平均值，并将其与 `f(x)` 的精确单元平均值进行比较。\n        *   定义：混叠误差 = (基于求积的单元平均值) - (精确单元平均值)。\n    *   **验证检查**：\n        *   **科学依据**：是的，这是一个标准的数值分析问题，与 DG 方法和谱方法相关。LGL 节点、Legendre 多项式、Vandermonde 矩阵、插值和求积等概念在计算数学中是公认的。\n        *   **适定性**：是的，问题定义明确。它要求进行具有清晰定义的具体计算。步骤是合乎逻辑的，并能导出一个唯一的数值答案。\n        *   **客观性**：是的，语言精确且技术性强。没有主观因素。\n        *   **缺陷？**：\n            1.  科学/事实不准确性：无。所有定义和性质都是正确的。\n            2.  不可形式化/不相关：不，这是一个数值分析中具体、可形式化的问题。\n            3.  不完整/矛盾：问题提供了所有必要信息。它正确地陈述了 `N+1 = p+1 = 4`，所以 `N=3`。求积对于阶数为 `2N-1 = 5` 的多项式精确的性质也是正确的。\n            4.  不切实际/不可行：这是一个教科书式的分析，完全可行。\n            5.  病态/结构不良：不，存在唯一解。\n            6.  伪深刻/微不足道：不，这需要几个不平凡的计算步骤，并阐释了一个重要的数值概念（混叠）。\n            7.  无法验证：不，计算是可验证的。\n\n    *   **结论**：问题是**有效的**。我可以继续求解。\n\n2.  **解决问题**：\n    *   **步骤A：找到 `p=3` (`N=3`) 的 LGL 节点**\n        *   我们需要 `P_3'(x)` 的根。\n        *   Legendre 多项式：\n            *   `P_0(x) = 1`\n            *   `P_1(x) = x`\n            *   `P_2(x) = (3x^2 - 1) / 2`\n            *   `P_3(x) = (5x^3 - 3x) / 2`\n        *   `P_3(x)` 的导数：`P_3'(x) = (15x^2 - 3) / 2`。\n        *   `P_3'(x) = 0` 的根：`15x^2 - 3 = 0` = `x^2 = 3/15 = 1/5`。\n        *   所以，根是 `x = +/- 1/sqrt(5)`。\n        *   LGL 节点是 `x_0 = -1`, `x_1 = -1/sqrt(5)`, `x_2 = 1/sqrt(5)`, `x_3 = 1`。\n\n    *   **步骤B：构建 Vandermonde 矩阵 `V`**\n        *   `V_ij = P_j(x_i)` 对于 `i,j = 0,1,2,3`。最终答案并不明确需要它，但它定义了待解系统。\n\n    *   **步骤C：找到 `f(x) = P_6(x)` 的插值多项式 `p_3(x)`**\n        *   `p_3(x) = \\sum_{j=0}^3 c_j P_j(x)`\n        *   条件是 `p_3(x_i) = f(x_i) = P_6(x_i)` 对于 `i=0,1,2,3`。\n        *   这构成了线性系统 `V \\mathbf{c} = \\mathbf{f}`，其中 `\\mathbf{c} = [c_0, c_1, c_2, c_3]^T` 且 `\\mathbf{f} = [f(x_0), f(x_1), f(x_2), f(x_3)]^T`。\n        *   首先，我们在 LGL 节点处计算 `f(x) = P_6(x)` 的值。Rodrigues 公式或递推关系给出了标准形式 `P_6(x) = \\frac{1}{16}(231x^6 - 315x^4 + 105x^2 - 5)`。\n        *   在端点处：`f(x_0) = P_6(-1) = (-1)^6 = 1` 且 `f(x_3) = P_6(1) = 1`。\n        *   在内部节点 `x_1` 和 `x_2` 处，我们有 `x^2 = 1/5`。由于 `P_6(x)` 是一个偶函数，所以函数值是相同的。\n            $f(x_{1,2}) = P_6(\\pm 1/\\sqrt{5}) = \\frac{1}{16}\\left(231\\left(\\frac{1}{5}\\right)^3 - 315\\left(\\frac{1}{5}\\right)^2 + 105\\left(\\frac{1}{5}\\right) - 5\\right)$\n            $= \\frac{1}{16}\\left(\\frac{231}{125} - \\frac{315}{25} + \\frac{105}{5} - 5\\right) = \\frac{1}{16}\\left(\\frac{231 - 1575 + 2625 - 625}{125}\\right)$\n            $= \\frac{1}{16}\\left(\\frac{656}{125}\\right) = \\frac{41}{125}$。\n        *   节点处的函数值向量是 $\\mathbf{f} = [1, 41/125, 41/125, 1]^T$。\n        *   线性系统是 $\\sum_{j=0}^{3} c_j P_j(x_i) = f(x_i)$ 对于 $i=0,1,2,3$。\n        *   由于 $f(x)=P_6(x)$ 是一个偶函数，并且 LGL 节点关于 $x=0$ 对称，所以插值多项式 $p_3(x)$ 也必须是偶函数。这意味着奇数基函数 $P_1(x)$ 和 $P_3(x)$ 的系数必须为零。因此，$c_1=0$ 且 $c_3=0$。\n        *   系统简化为关于 $c_0$ 和 $c_2$ 的两个方程：\n            $c_0 P_0(1) + c_2 P_2(1) = f(1) \\implies c_0 + c_2 = 1$\n            $c_0 P_0(1/\\sqrt{5}) + c_2 P_2(1/\\sqrt{5}) = f(1/\\sqrt{5})$\n        *   我们需要 $P_2(x) = \\frac{1}{2}(3x^2 - 1)$。当 $x^2=1/5$ 时，$P_2(1/\\sqrt{5}) = \\frac{1}{2}(3(1/5) - 1) = \\frac{1}{2}(3/5 - 5/5) = -1/5$。\n        *   第二个方程变为：$c_0 (1) + c_2 (-1/5) = 41/125 \\implies c_0 - \\frac{1}{5}c_2 = \\frac{41}{125}$。\n        *   我们现在求解该系统：\n            $c_0 + c_2 = 1$\n            $c_0 - \\frac{1}{5}c_2 = \\frac{41}{125}$\n        *   从第一个方程得到，$c_2 = 1 - c_0$。代入第二个方程：\n            $c_0 - \\frac{1}{5}(1 - c_0) = \\frac{41}{125} \\implies c_0 - \\frac{1}{5} + \\frac{1}{5}c_0 = \\frac{41}{125}$\n            $\\frac{6}{5}c_0 = \\frac{41}{125} + \\frac{1}{5} = \\frac{41+25}{125} = \\frac{66}{125}$\n            $c_0 = \\frac{66}{125} \\cdot \\frac{5}{6} = \\frac{11}{25}$。\n        *   那么 $c_2 = 1 - c_0 = 1 - 11/25 = 14/25$。\n        *   插值多项式为 $p_3(x) = \\frac{11}{25}P_0(x) + \\frac{14}{25}P_2(x)$。\n\n    *   **步骤D：计算 `f(x)` 的精确单元平均值**\n        *   在参考单元 $[-1,1]$ 上，函数 $g(x)$ 的单元平均值定义为 $\\frac{1}{2}\\int_{-1}^{1} g(x) dx$。\n        *   函数是 $f(x) = P_6(x)$。\n        *   精确单元平均值为 $\\frac{1}{2}\\int_{-1}^{1} P_6(x) dx$。\n        *   使用 Legendre 多项式的正交性，$\\int_{-1}^{1} P_m(x) P_n(x) dx = \\frac{2}{2n+1}\\delta_{mn}$，其中 $\\delta_{mn}$ 是 Kronecker delta。\n        *   我们可以将积分写为 $\\int_{-1}^{1} P_6(x) P_0(x) dx$，因为 $P_0(x)=1$。\n        *   因为 $6 \\neq 0$，所以积分为 $0$。\n        *   因此，`f(x)` 的精确单元平均值为 $\\frac{1}{2} \\cdot 0 = 0$。\n\n    *   **步骤E：计算基于求积的 `f(x)` 单元平均值**\n        *   问题指定使用 LGL 求积，它对阶数至多为 $2N-1 = 2(3)-1=5$ 的多项式是精确的。\n        *   求积通过对多项式插值 `p_3(x)` 在求积节点上进行精确积分来近似 `f(x)` 的积分。`p_3(x)` 的阶数是2，小于5，所以求积对 `p_3(x)` 是精确的。\n        *   基于求积的积分：$\\int_{-1}^{1} f(x) dx \\approx \\int_{-1}^{1} p_3(x) dx$。\n        *   让我们计算 `p_3(x)` 的精确积分：\n            $\\int_{-1}^{1} p_3(x) dx = \\int_{-1}^{1} \\left( \\frac{11}{25}P_0(x) + \\frac{14}{25}P_2(x) \\right) dx$\n            $= \\frac{11}{25}\\int_{-1}^{1} P_0(x) dx + \\frac{14}{25}\\int_{-1}^{1} P_2(x) dx$。\n        *   根据正交性，$\\int_{-1}^{1} P_2(x) dx = \\int_{-1}^{1} P_2(x)P_0(x) dx = 0$。\n        *   同样，$\\int_{-1}^{1} P_0(x) dx = \\int_{-1}^{1} 1 dx = 2$。\n        *   所以，近似积分为 $\\frac{11}{25}(2) + \\frac{14}{25}(0) = \\frac{22}{25}$。\n        *   基于求积的单元平均值为 $\\frac{1}{2} \\times \\left(\\frac{22}{25}\\right) = \\frac{11}{25}$。\n        *   注意，Legendre 展开式 $\\sum_j c_j P_j(x)$ 的单元平均值就是 $c_0$。我们的结果证实了这一点。混叠现象导致求积方案将 $P_6(x)$ 的平均值（为0）误解为其插值多项式 $p_3(x)$ 的平均值（为 $c_0 = 11/25$）。\n\n    *   **步骤F：计算混叠误差**\n        *   混叠误差定义为基于求积的单元平均值与精确单元平均值之差。\n        *   混叠误差 $= \\frac{11}{25} - 0 = \\frac{11}{25}$。",
            "answer": "$$\\boxed{\\frac{11}{25}}$$"
        },
        {
            "introduction": "从单个单元扩展到整个网格，本实践将探讨数值通量在处理材料属性空间变化的声波方程问题中所起的关键作用。你将实现并比较一个精确的黎曼通量和一个常见的近似通量，通过分析整个半离散算子的特征值来检验它们的稳定性。这个练习展示了一种强大的稳定性分析技术，并揭示了在非均匀介质中，看似合理的近似可能带来的陷阱。",
            "id": "3375694",
            "problem": "考虑在具有空间变化的密度 $\\rho(x)$ 和体积模量 $\\kappa(x)$ 的介质中，压力 $p(x,t)$ 和质点速度 $u(x,t)$ 的一维线性声学方程：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{1}{\\rho(x)}\\frac{\\partial p}{\\partial x} = 0,\\qquad\n\\frac{\\partial p}{\\partial t} + \\kappa(x)\\frac{\\partial u}{\\partial x} = 0.\n$$\n将声阻抗 $Z(x)$ 定义为 $Z(x) = \\sqrt{\\rho(x)\\kappa(x)}$，声速 $c(x)$ 定义为 $c(x) = \\sqrt{\\kappa(x)/\\rho(x)}$。考虑在周期性域上使用分片常数基函数（零次多项式）的间断 Galerkin (DG) 离散化，该域包含 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元，其中 $L$ 是域长度。设单元常数为 $u_i(t)$ 和 $p_i(t)$，单元索引为 $i \\in \\{0,1,\\dots,N-1\\}$，并周期性地定义左邻居和右邻居为 $i-1$ 和 $i+1$ 模 $N$。\n\n使用与 DG 方法和单元材料系数一致的守恒半离散有限体积形式：\n$$\n\\frac{d}{dt}u_i = -\\frac{1}{\\Delta x\\,\\rho_i}\\left(p^*_{i+\\frac{1}{2}} - p^*_{i-\\frac{1}{2}}\\right),\\qquad\n\\frac{d}{dt}p_i = -\\frac{\\kappa_i}{\\Delta x}\\left(u^*_{i+\\frac{1}{2}} - u^*_{i-\\frac{1}{2}}\\right),\n$$\n其中 $\\rho_i$ 和 $\\kappa_i$ 是单元 $i$ 中的单元常数，而 $p^*_{i+\\frac{1}{2}},u^*_{i+\\frac{1}{2}}$ 是在与界面 $x_{i+\\frac{1}{2}}$ 相邻的左单元 $L$ 和右单元 $R$ 之间计算的界面数值通量状态。将比较两种界面通量的选择：\n\n1. 带有材料跳跃的线性声学的精确 Riemann 通量，使用阻抗 $Z_L=\\sqrt{\\rho_L\\kappa_L}$ 和 $Z_R=\\sqrt{\\rho_R\\kappa_R}$：\n$$\np^*_{i+\\frac{1}{2}} = \\frac{Z_R\\,p_L + Z_L\\,p_R + Z_L Z_R \\left(u_L - u_R\\right)}{Z_L + Z_R},\\qquad\nu^*_{i+\\frac{1}{2}} = \\frac{p_L - p_R + Z_R\\,u_L + Z_L\\,u_R}{Z_L + Z_R}.\n$$\n\n2. 使用算术平均阻抗 $Z_{\\mathrm{avg}} = \\tfrac{1}{2}(Z_L + Z_R)$ 的近似阻抗加权迎风通量：\n$$\np^*_{i+\\frac{1}{2}} = \\tfrac{1}{2}\\left(p_L + p_R\\right) + \\tfrac{1}{2}Z_{\\mathrm{avg}}\\left(u_L - u_R\\right),\\qquad\nu^*_{i+\\frac{1}{2}} = \\tfrac{1}{2}\\left(u_L + u_R\\right) + \\tfrac{1}{2}\\frac{p_L - p_R}{Z_{\\mathrm{avg}}}.\n$$\n\n根据第一性原理，半离散格式的离散能量定义为所有单元上连续能量密度的总和：\n$$\nE_h(t) = \\sum_{i=0}^{N-1}\\left(\\tfrac{1}{2}\\rho_i u_i^2 + \\tfrac{1}{2}\\frac{p_i^2}{\\kappa_i}\\right).\n$$\n已知精确 Riemann 通量对于线性声学界面问题是能量相容的。然而，对于强变化的材料参数，近似阻抗加权通量可能会引入伪能量产生。为了以一种通用的、与编程语言无关的方式评估稳定性，构建线性系统\n$$\n\\frac{d}{dt}\\mathbf{q} = \\mathbf{A}\\,\\mathbf{q},\\qquad \\mathbf{q} = \\begin{bmatrix}u_0  \\cdots  u_{N-1}  p_0  \\cdots  p_{N-1}\\end{bmatrix}^\\top,\n$$\n其中 $\\mathbf{A}$ 是根据上述界面通量和单元更新组装的 $2N\\times 2N$ 半离散算子。对于每种通量选择，计算 $\\mathbf{A}$ 的特征值 $\\lambda_j$，并定义：\n- 谱横坐标 $\\alpha = \\max_j \\operatorname{Re}(\\lambda_j)$。\n- 最大虚部幅值 $\\gamma = \\max_j |\\operatorname{Im}(\\lambda_j)|$。\n\n使用以下决策规则，对于给定的 $(\\rho,\\kappa)$ 分布，确定近似通量是否相对于精确 Riemann 通量降低了稳定性：\n- 定义一个小容差 $\\varepsilon = 10^{-10}$ 和一个刚度余量 $\\delta = 0.05$。\n- 如果近似通量满足 $\\alpha_{\\mathrm{approx}}  \\alpha_{\\mathrm{exact}} + \\varepsilon$ 并且满足 $\\alpha_{\\mathrm{approx}}  \\varepsilon$（伪增长）或 $\\gamma_{\\mathrm{approx}}  (1+\\delta)\\,\\gamma_{\\mathrm{exact}}$（刚度增加）之一，则声明稳定性已降低；否则，不声明。\n\n您的程序必须：\n- 在长度为 $L=1$、均匀网格宽度为 $\\Delta x = 1/N$ 的周期性域上组装 $\\mathbf{A}$。\n- 精确实现上述定义的两种通量。\n- 对于每个测试用例，计算 $(\\alpha_{\\mathrm{exact}},\\gamma_{\\mathrm{exact}})$ 和 $(\\alpha_{\\mathrm{approx}},\\gamma_{\\mathrm{approx}})$，应用决策规则，并返回一个布尔值，指示稳定性是否因近似通量而降低。\n\n测试套件：\n- 案例 1（均匀基线）：$N=8$, $\\rho = [\\,1,1,1,1,1,1,1,1\\,]$, $\\kappa = [\\,1,1,1,1,1,1,1,1\\,]$。\n- 案例 2（轻微变化）：$N=8$, $\\rho = [\\,1,1.2,0.9,1.1,0.8,1.05,1.15,0.95\\,]$, $\\kappa = [\\,1,0.95,1.1,0.9,1.05,0.98,1.02,1.08\\,]$。\n- 案例 3（双层中等对比度）：$N=8$, $\\rho = [\\,1,1,1,1,9,9,9,9\\,]$, $\\kappa = [\\,1,1,1,1,1,1,1,1\\,]$。\n- 案例 4（交替强密度跳跃）：$N=8$, $\\rho = [\\,1,100,1,100,1,100,1,100\\,]$, $\\kappa = [\\,1,1,1,1,1,1,1,1\\,]$。\n- 案例 5（交替强模量跳跃）：$N=8$, $\\rho = [\\,1,1,1,1,1,1,1,1\\,]$, $\\kappa = [\\,1,100,1,100,1,100,1,100\\,]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的布尔值列表，其顺序与测试套件案例的顺序一致（例如，$[\\texttt{False},\\texttt{True},\\texttt{False},\\texttt{False},\\texttt{True}]$）。不应打印任何其他文本。",
            "solution": "我们从一维空间中的一阶线性声学方程开始：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{1}{\\rho(x)}\\frac{\\partial p}{\\partial x} = 0,\\qquad\n\\frac{\\partial p}{\\partial t} + \\kappa(x)\\frac{\\partial u}{\\partial x} = 0,\n$$\n其中 $u$ 是质点速度，$p$ 是声压，$\\rho(x)$ 是质量密度，$\\kappa(x)$ 是体积模量。声阻抗定义为 $Z(x)=\\sqrt{\\rho(x)\\kappa(x)}$，声速定义为 $c(x)=\\sqrt{\\kappa(x)/\\rho(x)}$。这些方程构成一个对称双曲系统，其能量密度为\n$$\ne(x,t) = \\tfrac{1}{2}\\rho(x) u^2(x,t) + \\tfrac{1}{2}\\frac{p^2(x,t)}{\\kappa(x)}.\n$$\n\n对于零次多项式（分片常数）的间断 Galerkin (DG) 方法，半离散格式与一种有限体积形式重合，其中每个单元的更新完全由单元界面处的数值通量驱动。在一个包含 $N$ 个均匀单元的周期性网格上，为每个单元 $i$ 定义未知数 $u_i(t)$ 和 $p_i(t)$，以及单元材料参数 $\\rho_i$、$\\kappa_i$。更新公式为\n$$\n\\frac{d}{dt}u_i = -\\frac{1}{\\Delta x\\,\\rho_i}\\left(p^*_{i+\\frac{1}{2}} - p^*_{i-\\frac{1}{2}}\\right),\\qquad\n\\frac{d}{dt}p_i = -\\frac{\\kappa_i}{\\Delta x}\\left(u^*_{i+\\frac{1}{2}} - u^*_{i-\\frac{1}{2}}\\right),\n$$\n其中 $\\Delta x = L/N$ 且 $L$ 是域长度，而 $p^*, u^*$ 是通过求解或近似局部 Riemann 问题计算出的界面状态。这些界面状态是界面处左右迹线 $(u_L,p_L)$ 和 $(u_R,p_R)$ 以及两侧材料参数的函数。\n\n对于界面处存在材料间断的线性声学中的精确 Riemann 通量，我们在两侧使用特征变量 $w^\\pm = p \\pm Z u$，其波速为 $\\pm c$，阻抗为 $Z_L = \\sqrt{\\rho_L\\kappa_L}$ 和 $Z_R=\\sqrt{\\rho_R\\kappa_R}$。在界面处强加压力和速度的连续性，并匹配传入的特征，可得到显式公式\n$$\np^* = \\frac{Z_R\\,p_L + Z_L\\,p_R + Z_L Z_R (u_L - u_R)}{Z_L + Z_R},\\qquad\nu^* = \\frac{p_L - p_R + Z_R\\,u_L + Z_L\\,u_R}{Z_L + Z_R}.\n$$\n该通量是能量相容的：对于连续问题，它不会在界面处产生伪能量。在半离散设置中，在界面状态中使用此精确 Riemann 通量可确保离散能量率 $dE_h/dt$ 是边界通量的总和，这些通量在周期性边界条件下成对抵消，从而导致能量守恒（不计离散化效应，当 $\\Delta x \\to 0$ 时这些效应消失）。\n\n一种近似的阻抗加权通量用单个算术平均值 $Z_{\\mathrm{avg}} = \\tfrac{1}{2}(Z_L + Z_R)$ 替代了精确的阻抗依赖关系，并使用常系数迎风公式：\n$$\np^* = \\tfrac{1}{2}(p_L + p_R) + \\tfrac{1}{2}Z_{\\mathrm{avg}}(u_L - u_R),\\qquad\nu^* = \\tfrac{1}{2}(u_L + u_R) + \\tfrac{1}{2}\\frac{p_L - p_R}{Z_{\\mathrm{avg}}}.\n$$\n这在 $Z_L=Z_R$ 的均匀介质中是精确的，但对于强阻抗对比，它会错配波在界面处的反射和透射方式，并可能虚假地注入或移除能量。为了诊断稳定性，构建半离散线性算子 $\\mathbf{A}$，使得\n$$\n\\frac{d}{dt}\\mathbf{q} = \\mathbf{A}\\mathbf{q},\\qquad \\mathbf{q} = \\begin{bmatrix}u_0  \\cdots  u_{N-1}  p_0  \\cdots  p_{N-1}\\end{bmatrix}^\\top.\n$$\n$\\mathbf{A}$ 的项由 $p^*,u^*$ 对 $(u_L,p_L,u_R,p_R)$ 的线性依赖关系得出。对于精确通量，写作\n$$\np^* = a_1 p_L + a_2 p_R + b_1 u_L + b_2 u_R,\\qquad\nu^* = c_1 p_L + c_2 p_R + d_1 u_L + d_2 u_R,\n$$\n其中\n$$\na_1 = \\frac{Z_R}{Z_L+Z_R},\\quad a_2 = \\frac{Z_L}{Z_L+Z_R},\\quad b_1 = \\frac{Z_L Z_R}{Z_L+Z_R},\\quad b_2 = -\\frac{Z_L Z_R}{Z_L+Z_R},\n$$\n$$\nc_1 = \\frac{1}{Z_L+Z_R},\\quad c_2 = -\\frac{1}{Z_L+Z_R},\\quad d_1 = \\frac{Z_R}{Z_L+Z_R},\\quad d_2 = \\frac{Z_L}{Z_L+Z_R}.\n$$\n对于近似通量，系数为\n$$\na_1 = \\tfrac{1}{2},\\quad a_2 = \\tfrac{1}{2},\\quad b_1 = \\tfrac{1}{2}Z_{\\mathrm{avg}},\\quad b_2 = -\\tfrac{1}{2}Z_{\\mathrm{avg}},\n$$\n$$\nc_1 = \\frac{1}{2 Z_{\\mathrm{avg}}},\\quad c_2 = -\\frac{1}{2 Z_{\\mathrm{avg}}},\\quad d_1 = \\tfrac{1}{2},\\quad d_2 = \\tfrac{1}{2}.\n$$\n对于每个界面 $(L,R)$（在单元 $i$ 和 $i+1$ 之间），如上计算 $p^*$ 和 $u^*$，然后根据以下公式将贡献组装到 $\\mathbf{A}$ 的第 $i$ 行和第 $i+N$ 行\n$$\n\\frac{d}{dt}u_i = -\\frac{1}{\\Delta x\\,\\rho_i}p^*_{i+\\frac{1}{2}} + \\frac{1}{\\Delta x\\,\\rho_i}p^*_{i-\\frac{1}{2}},\\qquad\n\\frac{d}{dt}p_i = -\\frac{\\kappa_i}{\\Delta x}u^*_{i+\\frac{1}{2}} + \\frac{\\kappa_i}{\\Delta x}u^*_{i-\\frac{1}{2}},\n$$\n其中 $p^*_{i-\\frac{1}{2}},u^*_{i-\\frac{1}{2}}$ 是使用对 $(L=i-1,R=i)$ 计算的。\n\n构建 $\\mathbf{A}$ 后，计算其特征值 $\\lambda_j$。连续时间半离散系统的稳定性由谱横坐标 $\\alpha = \\max_j \\operatorname{Re}(\\lambda_j)$ 表征。如果对于一个小容差 $\\varepsilon$ 有 $\\alpha \\le \\varepsilon$，则系统是非增长的（能量非增），而 $\\alpha  \\varepsilon$ 表示某些模式的指数增长，即不稳定性。与显式时间积分相关的刚度水平由虚部幅值表示：对于为纯虚谱设计的方法（例如，能量守恒的二阶格式），较大的 $|\\operatorname{Im}(\\lambda)|$ 通常需要更小的时间步长。因此，我们为每种通量选择定义两个指标：\n$$\n\\alpha_{\\mathrm{scheme}} = \\max_j \\operatorname{Re}(\\lambda_j),\\qquad \\gamma_{\\mathrm{scheme}} = \\max_j |\\operatorname{Im}(\\lambda_j)|.\n$$\n我们声明，如果近似通量满足以下条件，则它相对于精确通量降低了稳定性\n$$\n\\alpha_{\\mathrm{approx}}  \\alpha_{\\mathrm{exact}} + \\varepsilon\n$$\n并且满足\n$$\n\\alpha_{\\mathrm{approx}}  \\varepsilon\\quad\\text{(伪增长)}\n$$\n或\n$$\n\\gamma_{\\mathrm{approx}}  (1+\\delta)\\,\\gamma_{\\mathrm{exact}}\\quad\\text{(刚度增加)},\n$$\n对于小阈值 $\\varepsilon = 10^{-10}$ 和 $\\delta = 0.05$。\n\n算法步骤：\n- 设置域长度 $L=1$ 和网格尺寸 $\\Delta x = 1/N$。\n- 对于给定的 $(\\rho,\\kappa)$ 分布，计算阻抗 $Z_i = \\sqrt{\\rho_i \\kappa_i}$。\n- 遍历界面以计算两种通量选择的通量系数矩阵。\n- 使用更新公式和周期性连接性为两种通量组装半离散算子 $\\mathbf{A}$。\n- 通过标准线性代数程序计算特征值，并为两种格式提取 $(\\alpha,\\gamma)$。\n- 应用决策规则，为每个测试用例生成一个指示稳定性是否降低的布尔值。\n\n关于近似在何时降低稳定性的讨论：\n- 在 $Z_L = Z_R$ 的均匀介质中，两种通量重合，产生相同的谱，且没有稳定性降低。\n- 对于 $Z_L \\approx Z_R$ 的轻微变化，近似通量引入小的扰动，这通常不会引起增长（$\\alpha$ 接近零），且仅轻微增加 $\\gamma$（边际刚度增加）。\n- 对于强阻抗对比，例如 $Z_L \\ll Z_R$ 或 $Z_L \\gg Z_R$ 的交替层，算术平均值 $Z_{\\mathrm{avg}}$ 不能很好地表示界面物理。\n- 特征加权的不匹配可能导致离散界面能量通量的不平衡，在 $\\mathbf{A}$ 中产生非零的对称部分和潜在的正 $\\alpha$（伪能量增长）。\n- 即使 $\\alpha$ 保持非正（耗散性），$\\gamma$ 也可能显著增加，从而减小显式格式的最大稳定时间步长，进而降低稳定性余量。\n- 具有单侧极值（单次高对比度跳跃）的界面特别敏感：精确 Riemann 通量能正确平衡反射和透射系数，从而保持能量，而近似通量可能会过阻尼或欠阻尼，这可能表现为刚度增加，或者在病态对比下表现为增长。\n\n该程序为指定的测试套件实现此分析，并根据决策规则为每个案例报告一个布尔值，指示近似阻抗加权通量是否相对于精确 Riemann 通量降低了稳定性。",
            "answer": "```python\nimport numpy as np\n\ndef build_operator(rho, kappa, flux_type):\n    \"\"\"\n    Build the semi-discrete operator A for the 1D linear acoustics DG scheme with p=0 (FV equivalent).\n    rho, kappa: arrays of length N with positive entries.\n    flux_type: 'exact' or 'approx' selecting the interface flux.\n    Returns: A (2N x 2N) numpy array.\n    \"\"\"\n    N = len(rho)\n    L = 1.0\n    dx = L / N\n    Z = np.sqrt(rho * kappa)\n    A = np.zeros((2 * N, 2 * N), dtype=float)\n\n    for i in range(N):\n        # Right interface between i (L) and r=(i+1)%N (R)\n        r = (i + 1) % N\n        ZL_right, ZR_right = Z[i], Z[r]\n        if flux_type == 'exact':\n            denom = ZL_right + ZR_right\n            a1, a2 = ZR_right / denom, ZL_right / denom\n            b1, b2 = (ZL_right * ZR_right) / denom, -(ZL_right * ZR_right) / denom\n            c1, c2 = 1.0 / denom, -1.0 / denom\n            d1, d2 = ZR_right / denom, ZL_right / denom\n        else: # approx\n            Zavg = 0.5 * (ZL_right + ZR_right)\n            a1, a2 = 0.5, 0.5\n            b1, b2 = 0.5 * Zavg, -0.5 * Zavg\n            c1, c2 = 0.5 / Zavg, -0.5 / Zavg\n            d1, d2 = 0.5, 0.5\n        \n        # Contribution to u_i' from right face: -(1/(dx*rho_i)) * p*\n        # p* depends on u_L=u_i, u_R=u_r, p_L=p_i, p_R=p_r\n        factor_u_right = -1.0 / (dx * rho[i])\n        A[i, i] += factor_u_right * b1\n        A[i, r] += factor_u_right * b2\n        A[i, N + i] += factor_u_right * a1\n        A[i, N + r] += factor_u_right * a2\n\n        # Contribution to p_i' from right face: -(kappa_i/dx) * u*\n        # u* depends on u_L=u_i, u_R=u_r, p_L=p_i, p_R=p_r\n        factor_p_right = -kappa[i] / dx\n        A[N + i, i] += factor_p_right * d1\n        A[N + i, r] += factor_p_right * d2\n        A[N + i, N + i] += factor_p_right * c1\n        A[N + i, N + r] += factor_p_right * c2\n\n        # Left interface between l=(i-1)%N (L) and i (R)\n        l = (i - 1) % N\n        ZL_left, ZR_left = Z[l], Z[i]\n        if flux_type == 'exact':\n            denom = ZL_left + ZR_left\n            a1, a2 = ZR_left / denom, ZL_left / denom\n            b1, b2 = (ZL_left * ZR_left) / denom, -(ZL_left * ZR_left) / denom\n            c1, c2 = 1.0 / denom, -1.0 / denom\n            d1, d2 = ZR_left / denom, ZL_left / denom\n        else: # approx\n            Zavg = 0.5 * (ZL_left + ZR_left)\n            a1, a2 = 0.5, 0.5\n            b1, b2 = 0.5 * Zavg, -0.5 * Zavg\n            c1, c2 = 0.5 / Zavg, -0.5 / Zavg\n            d1, d2 = 0.5, 0.5\n\n        # Contribution to u_i' from left face: +(1/(dx*rho_i)) * p*\n        # p* depends on u_L=u_l, u_R=u_i, p_L=p_l, p_R=p_i\n        factor_u_left = 1.0 / (dx * rho[i])\n        A[i, l] += factor_u_left * b1\n        A[i, i] += factor_u_left * b2\n        A[i, N + l] += factor_u_left * a1\n        A[i, N + i] += factor_u_left * a2\n        \n        # Contribution to p_i' from left face: +(kappa_i/dx) * u*\n        # u* depends on u_L=u_l, u_R=u_i, p_L=p_l, p_R=p_i\n        factor_p_left = kappa[i] / dx\n        A[N + i, l] += factor_p_left * d1\n        A[N + i, i] += factor_p_left * d2\n        A[N + i, N + l] += factor_p_left * c1\n        A[N + i, N + i] += factor_p_left * c2\n        \n    return A\n\ndef spectral_metrics(A):\n    \"\"\"\n    Compute spectral abscissa alpha and maximal imaginary magnitude gamma of matrix A.\n    \"\"\"\n    eigvals = np.linalg.eigvals(A)\n    alpha = np.max(np.real(eigvals))\n    gamma = np.max(np.abs(np.imag(eigvals)))\n    return float(alpha), float(gamma)\n\ndef analyze_case(rho, kappa):\n    \"\"\"\n    Build operators for exact and approximate fluxes, compute metrics, and decide degradation.\n    Returns: boolean indicating whether approximate flux degrades stability.\n    \"\"\"\n    A_exact = build_operator(np.array(rho), np.array(kappa), 'exact')\n    A_approx = build_operator(np.array(rho), np.array(kappa), 'approx')\n    alpha_e, gamma_e = spectral_metrics(A_exact)\n    alpha_a, gamma_a = spectral_metrics(A_approx)\n    \n    eps = 1e-10\n    delta = 0.05\n    \n    # Check for near-zero gamma_e to avoid division by zero or huge relative error\n    gamma_e_is_zero = np.abs(gamma_e)  eps\n    \n    stiffness_increase = False\n    if not gamma_e_is_zero:\n        if gamma_a > (1.0 + delta) * gamma_e:\n            stiffness_increase = True\n    elif gamma_a > eps: # If exact has no dynamics, any dynamics is an increase\n        stiffness_increase = True\n\n    degraded = (alpha_a > alpha_e + eps) and ((alpha_a > eps) or stiffness_increase)\n    return degraded\n\ndef solve():\n    test_cases = [\n        (8, [1.0]*8, [1.0]*8),\n        (8, [1.0, 1.2, 0.9, 1.1, 0.8, 1.05, 1.15, 0.95], [1.0, 0.95, 1.1, 0.9, 1.05, 0.98, 1.02, 1.08]),\n        (8, [1.0, 1.0, 1.0, 1.0, 9.0, 9.0, 9.0, 9.0], [1.0]*8),\n        (8, [1.0, 100.0]*4, [1.0]*8),\n        (8, [1.0]*8, [1.0, 100.0]*4),\n    ]\n\n    results = []\n    for N, rho, kap in test_cases:\n        result = analyze_case(rho, kap)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "一个完整的数值模型不仅需要精确的内部离散，还需要稳定且物理上正确的边界条件。本问题旨在解决声学中常见的阻抗（Robin）边界条件的施加。你将首先通过保证稳定性的特征分析推导出离散反射系数，然后在一个程序中实现该逻辑，观察其在从完美匹配到硬/软边界等不同物理情景下的表现。",
            "id": "3375740",
            "problem": "考虑一维空间中的线性一阶声波系统，其压力和速度的守恒形式写作\n$$\n\\frac{\\partial p}{\\partial t} + \\kappa \\frac{\\partial u}{\\partial x} = 0,\\qquad\n\\rho \\frac{\\partial u}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0,\n$$\n其中$p$是压力，$u$是$x$方向的速度，$\\rho$是密度（单位为$\\mathrm{kg/m^3}$），$\\kappa$是体积模量（单位为$\\mathrm{Pa}$）。波速为$c = \\sqrt{\\kappa/\\rho}$，比声阻抗为$Z = \\rho c = \\sqrt{\\rho \\kappa}$，两者均采用国际单位制。在边界$x=0$处，假设一个阻抗（Robin）边界条件\n$$\np = Z_b\\, u,\n$$\n其中$Z_b$是给定的实数边界阻抗（单位为$\\mathrm{Pa\\cdot s/m}$）。我们关注在半直线$x \\in [0,h]$上截断的单个边界单元上的间断Galerkin（DG）谱元离散化，该单元使用Gauss–Lobatto–Legendre节点，并且其微分算子满足分部求和（SBP）性质。边界条件将通过仅作用于入射特征变量的同步近似项（SAT）罚方法来施加。\n\n从能量法和SBP性质的第一性原理出发，推导在$x=0$处基于特征变量的SAT罚项，该罚项确保当$Z_b \\ge 0$时能量稳定，并清晰地在入射特征上施加阻抗关系。使用特征变量\n$$\nw^{\\pm} = p \\pm Z u,\n$$\n它们以速度$\\pm c$传播，并证明可以设计SAT，使得它将入射特征$w^{+}$替换为边界兼容值，同时保持出射特征$w^{-}$不变。对于一个在$x=0$处垂直入射的时谐平面波，其内部迹分解为入射和出射分量，推导离散反射系数$R_d$，该系数关联了边界处出射波与入射波的振幅。\n\n你的推导应从以下几点开始：\n- 声学系统的守恒形式及其二次能量密度，\n- DG谱元算子的SBP恒等式，以及它如何将内部导数贡献转移到边界项，\n- 仅作用于入射模式的特征罚算子的构造，\n并进而进行边界法向分析，得出反射关系。不要假设或引用$R_d$的目标公式；从特征分解和阻抗关系中推导出它。\n\n然后，实现一个Python程序，为几个物理上一致的测试案例评估离散反射系数$R_d$。使用推导出的、适用于在$x=0$处进行特征SAT/迎风处理的公式。程序必须使用指定的单位硬编码以下测试套件参数，为每个案例计算$R_d$作为实数浮点数，并以描述的精确格式生成单行输出。\n\n测试套件：\n1. 阻抗匹配介质（理想情况）：$\\rho = 1.2\\,\\mathrm{kg/m^3}$，$\\kappa = 1.44\\times 10^{5}\\,\\mathrm{Pa}$，$Z_b = \\rho \\sqrt{\\kappa/\\rho}$ in $\\mathrm{Pa\\cdot s/m}$。\n2. 软墙边界（边界情况）：$\\rho = 1.2\\,\\mathrm{kg/m^3}$，$\\kappa = 1.44\\times 10^{5}\\,\\mathrm{Pa}$，$Z_b = 0\\,\\mathrm{Pa\\cdot s/m}$。\n3. 刚性墙近似（边界情况）：$\\rho = 1.2\\,\\mathrm{kg/m^3}$，$\\kappa = 1.44\\times 10^{5}\\,\\mathrm{Pa}$，$Z_b = 10^{12}\\,\\mathrm{Pa\\cdot s/m}$。\n4. 中等阻抗失配：$\\rho = 1.0\\,\\mathrm{kg/m^3}$，$\\kappa = 4.0\\,\\mathrm{Pa}$，$Z_b = 1.0\\,\\mathrm{Pa\\cdot s/m}$。\n5. 另一个失配情况：$\\rho = 2.0\\,\\mathrm{kg/m^3}$，$\\kappa = 8.0\\,\\mathrm{Pa}$，$Z_b = 3.0\\,\\mathrm{Pa\\cdot s/m}$。\n\n所有答案必须表示为无量纲浮点数。你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中$r_i$是为测试案例$i$计算的离散反射系数。",
            "solution": "该问题要求推导一个离散反射系数$R_d$，该系数适用于使用间断Galerkin（DG）谱元方法离散化的一维声波系统。在$x=0$处的边界条件是一个阻抗条件，通过基于特征的同步近似项（SAT）来施加。推导必须基于第一性原理，包括能量法和分部求和（SBP）性质，并且必须保证能量稳定性。\n\n一维线性声波系统由以下方程给出：\n$$\n\\frac{\\partial p}{\\partial t} + \\kappa \\frac{\\partial u}{\\partial x} = 0,\n$$\n$$\n\\rho \\frac{\\partial u}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0.\n$$\n这里，$p(x,t)$是声压，$u(x,t)$是质点速度，$\\rho$是恒定的环境密度，$\\kappa$是恒定的体积模量。该系统可以写成向量形式$\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{q}}{\\partial x} = \\mathbf{0}$，其中$\\mathbf{q} = [p, u]^T$，通量雅可比矩阵为：\n$$\n\\mathbf{A} = \\begin{pmatrix} 0  \\kappa \\\\ 1/\\rho  0 \\end{pmatrix}.\n$$\n\n该系统的物理能量密度为$E_{dens} = \\frac{1}{2} \\left( \\frac{1}{\\kappa} p^2 + \\rho u^2 \\right)$。在区域$[a, b]$内的总能量为$E(t) = \\int_a^b E_{dens} \\,dx$。能量的时间变化率为：\n$$\n\\frac{dE}{dt} = \\int_a^b \\left( \\frac{p}{\\kappa} \\frac{\\partial p}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial t} \\right) \\,dx.\n$$\n代入$\\partial p/\\partial t$和$\\partial u/\\partial t$的控制方程：\n$$\n\\frac{dE}{dt} = \\int_a^b \\left( \\frac{p}{\\kappa} \\left(-\\kappa \\frac{\\partial u}{\\partial x}\\right) + \\rho u \\left(-\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right) \\right) \\,dx = -\\int_a^b \\left( p \\frac{\\partial u}{\\partial x} + u \\frac{\\partial p}{\\partial x} \\right) \\,dx.\n$$\n被积函数是乘积$pu$的导数，因此根据微积分基本定理：\n$$\n\\frac{dE}{dt} = -\\int_a^b \\frac{\\partial}{\\partial x}(pu) \\,dx = -[pu]_a^b = p(a,t)u(a,t) - p(b,t)u(b,t).\n$$\n这表明$F_E = pu$是能量通量。对于半无限域$x \\in [0, \\infty)$，能量变化由边界$x=0$处的通量控制，$\\frac{dE}{dt} = p(0,t)u(0,t)$，假设解在无穷远处衰减。一个稳定、被动的边界条件必须确保能量不会自发地进入区域，这意味着在$x=0$处进入区域的通量必须是非正的。通量指向传播方向，因此*在*边界表面指向区域$[0, \\infty)$内部的通量是$F_E(0) = p(0,t)u(0,t)$。一个稳定的边界条件将确保此项对应于离开区域的能量，或者如果我们相对于区域的向外法线定义通量方向，则为$p(0,t)u(0,t) \\le 0$。让我们分析$pu$本身的符号：如果一个边界条件所引导的数值能量通量导致总能量不增加，那么它就是稳定的。来自边界$x=0$对$dE/dt$的贡献是$p_0 u_0$。为保证稳定性，如果此项代表从外部进入的能量，则必须为非正。或者，如果SBP公式导出一个形式为$-p_0 u_0$的边界项，我们要求$p_0 u_0 \\ge 0$以保证稳定性。我们采用后一种约定，要求边界处的能量耗散/提取为非负。\n\n为了分析边界条件，我们使用特征变量。矩阵$\\mathbf{A}$的特征值为$\\lambda_{\\pm} = \\pm \\sqrt{\\kappa/\\rho} = \\pm c$，其中$c$是波速。相应的特征变量是$p$和$u$的线性组合，它们使系统对角化。我们定义它们为：\n$$\nw^{\\pm} = p \\pm Z u,\n$$\n其中$Z = \\rho c = \\sqrt{\\rho \\kappa}$是介质的比声阻抗。用这些变量表示，控制方程解耦为两个平流方程：\n$$\n\\frac{\\partial w^+}{\\partial t} + c \\frac{\\partial w^+}{\\partial x} = 0 \\quad (\\text{沿 }+x \\text{方向传播}),\n$$\n$$\n\\frac{\\partial w^-}{\\partial t} - c \\frac{\\partial w^-}{\\partial x} = 0 \\quad (\\text{沿 }-x \\text{方向传播}).\n$$\n在区域$[0, \\infty)$的边界$x=0$处，$w^+$是入射波，$w^-$是出射波。出射波$w^-$的信息来自区域内部。入射波$w^+$必须由边界条件指定。\n\n问题指定了在$x=0$处的阻抗边界条件：\n$$\np(0,t) = Z_b u(0,t),\n$$\n其中$Z_b \\ge 0$是边界阻抗。DG-SAT方法必须施加这个条件。问题陈述SAT被设计为“用边界兼容值替换入射特征$w^{+}$，同时保持出射特征$w^{-}$不变”。这是一个强施加，是迎风数值通量的特征。\n\n在边界$x=0$处，数值格式提供了来自内部解的迹，它决定了出射特征$w^-_0 = p_0 - Z u_0$。边界上的值$p_0$和$u_0$必须既满足物理边界条件，又与这个出射信息一致。我们有一个包含两个未知数$p_0$和$u_0$的两个方程的系统：\n1. $p_0 = Z_b u_0$ (边界条件)\n2. $p_0 - Z u_0 = w^-_0$ (来自内部的出射特征)\n\n我们求解这个系统，用已知的$w^-_0$表示$p_0$和$u_0$：\n将(1)代入(2):\n$$\nZ_b u_0 - Z u_0 = w^-_0 \\implies (Z_b - Z) u_0 = w^-_0 \\implies u_0 = \\frac{w_0^-}{Z_b - Z}.\n$$\n然后，使用(1)求$p_0$：\n$$\np_0 = Z_b u_0 = \\frac{Z_b w_0^-}{Z_b - Z}.\n$$\n这些是与内部解和物理边界条件都一致的边界状态值$(p_0, u_0)$。\n\n施加机制用从这个一致状态计算出的值替换数值入射特征$w_0^+$：\n$$\nw_0^+ = p_0 + Z u_0 = \\frac{Z_b w_0^-}{Z_b - Z} + Z \\left( \\frac{w_0^-}{Z_b - Z} \\right) = \\frac{Z_b + Z}{Z_b - Z} w_0^-.\n$$\n这个方程提供了数值格式在边界处施加的入射和出射特征之间的离散关系。\n\n离散反射系数$R_d$定义为边界处出射波与入射波振幅之比。从上述关系可得：\n$$\nR_d = \\frac{w_0^-}{w_0^+} = \\frac{Z_b - Z}{Z_b + Z}.\n$$\n这个公式与连续平面波在阻抗边界上的解析反射系数相同，考虑到所规定的特征施加的性质，这是预料之中的。\n\n最后，我们验证$Z_b \\ge 0$时的能量稳定性。一个稳定格式的SBP-SAT框架要求边界项不向区域注入能量。$x=0$处的能量通量是$p_0 u_0$。它对能量变化率的贡献必须为非正。对于我们选择的SBP，这意味着数值通量$p_0 u_0$必须为非负。\n使用我们关于$p_0$和$u_0$的表达式（用$w_0^-$表示）：\n$$\np_0 u_0 = \\left( \\frac{Z_b w_0^-}{Z_b - Z} \\right) \\left( \\frac{w_0^-}{Z_b - Z} \\right) = \\frac{Z_b (w_0^-)^2}{(Z_b - Z)^2}.\n$$\n项$(w_0^-)^2$和$(Z_b - Z)^2$总是非负的。因此，能量通量的符号完全由边界阻抗$Z_b$的符号决定。如果$Z_b \\ge 0$，则$p_0 u_0 \\ge 0$。这意味着能量要么从区域中提取（如果$Z_b  0$），要么守恒（如果$Z_b=0$），满足数值稳定性的条件。因此，推导是完整且自洽的。\n\n推导出的离散反射系数公式为$R_d = \\frac{Z_b - Z}{Z_b + Z}$，其中$Z=\\sqrt{\\rho\\kappa}$。我们现在将此应用于给定的测试案例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_reflection_coefficient(rho, kappa, Z_b):\n    \"\"\"\n    Calculates the discrete reflection coefficient R_d for the 1D acoustic wave equation.\n    \n    The discrete reflection coefficient R_d is derived from a characteristic-based \n    boundary condition enforcement (e.g., via an upwind flux or SAT penalty) for\n    the impedance boundary condition p = Z_b * u.\n    \n    The formula is R_d = (Z_b - Z) / (Z_b + Z), where Z is the specific\n    acoustic impedance of the medium.\n    \n    Args:\n        rho (float): Density of the medium in kg/m^3.\n        kappa (float): Bulk modulus of the medium in Pa.\n        Z_b (float): Boundary impedance in Pa*s/m.\n        \n    Returns:\n        float: The dimensionless discrete reflection coefficient R_d.\n    \"\"\"\n    # Calculate the specific acoustic impedance of the medium, Z = sqrt(rho * kappa).\n    # Z has units of Pa*s/m.\n    if rho = 0 or kappa = 0:\n        raise ValueError(\"Density and bulk modulus must be positive.\")\n        \n    Z = np.sqrt(rho * kappa)\n    \n    # The denominator (Z_b + Z) can be zero only if Z_b = -Z.\n    # Since Z > 0 and the problem assumes Z_b >= 0, the denominator is always positive.\n    if Z_b + Z == 0:\n        # This case is not physically expected under problem constraints\n        # but is handled to prevent division by zero.\n        return np.inf\n        \n    # Calculate the discrete reflection coefficient R_d.\n    R_d = (Z_b - Z) / (Z_b + Z)\n    \n    return R_d\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite and prints the results.\n    \"\"\"\n    # Test suite parameters: (rho, kappa, Z_b)\n    # Units: rho in kg/m^3, kappa in Pa, Z_b in Pa*s/m.\n    test_cases = [\n        # 1. Matched impedance medium\n        (1.2, 1.44e5, 1.2 * np.sqrt(1.44e5 / 1.2)),\n        \n        # 2. Soft wall boundary\n        (1.2, 1.44e5, 0.0),\n        \n        # 3. Rigid wall approximation\n        (1.2, 1.44e5, 1.0e12),\n        \n        # 4. Moderate impedance mismatch\n        (1.0, 4.0, 1.0),\n        \n        # 5. Another mismatch case\n        (2.0, 8.0, 3.0),\n    ]\n\n    results = []\n    for rho, kappa, Z_b in test_cases:\n        # Calculate the result for one case.\n        result = calculate_reflection_coefficient(rho, kappa, Z_b)\n        results.append(result)\n\n    # Format the output as a comma-separated list of floats in square brackets.\n    # Using a format specifier like 'g' can help control output style.\n    formatted_results = [f\"{r:.15g}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the solver function.\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}