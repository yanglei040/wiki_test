{
    "hands_on_practices": [
        {
            "introduction": "精确的数值积分是许多科学计算方法的核心。本练习将引导你从基本原理出发，构建一个高斯-克龙罗德 (Gauss-Kronrod) 求积法则 。通过推导这种嵌套式求积法则的构造，你将理解自适应求积算法背后的思想，即如何利用不同阶数的求积结果来估计和控制积分误差。这项实践不仅能加深你对求积理论的理解，还能让你掌握一种在实际计算中高效评估积分精度的基本技能。",
            "id": "3361974",
            "problem": "考虑在一维间断伽辽金(DG)方法的数值组装中，对参考单元 $E=[-1,1]$ 上带单位权重的体积分。令 $P_{n}(x)$ 表示 $n$ 次勒让德多项式，并回顾 $n$ 点高斯-勒让德求积使用 $P_{n}(x)$ 的 $n$ 个不同零点作为节点，并对最高为 $2n-1$ 次的多项式达到精确。\n\n1) 从勒让德多项式在 $[-1,1]$ 上关于权重 $w(x)=1$ 的正交性以及高斯求积精确性的定义出发，推导 Kronrod 扩展的构建原理，该扩展通过增加 $n+1$ 个新节点，同时保留原有的 $n$ 个高斯节点，将一个 $n$ 点高斯-勒让德法则扩充为一个 $(2n+1)$ 点法则。您的推导必须仅基于以下基本原理：(i)作为矩匹配条件的求积精确性，(ii) 对于 $w(x)=1$ 的法则的对称性，以及(iii) 由正交性所蕴含的节点交错。解释精确性条件如何确定新节点和所有权重，以及为什么所得法则能达到严格高于 $2n-1$ 的精确度阶。\n\n2) 将您的推导特化到 $E=[-1,1]$ 上 $n=1$ 的情况。通过求解由偶次单项式的精确性所蕴含的矩方程，显式地确定 Kronrod 扩充法则的 $(2n+1)=3$ 个节点和权重。证明该扩充法则包含原始高斯节点且是对称的。\n\n3) 在自适应DG积分中，每个单元上的嵌入式后验误差估计器可以构建为应用于同一被积函数的高阶法则与其嵌入的低阶子法则之间的绝对差。将 $E$ 上的嵌入式估计器 $\\varepsilon(f)$ 定义为 $\\varepsilon(f)=\\left|Q_{K}(f)-Q_{G}(f)\\right|$，其中 $Q_{K}$ 是第2部分的 Kronrod 扩充 $(2n+1)$ 点法则，$Q_{G}$ 是原始的 $n$ 点高斯法则。对被积函数 $f(x)=x^{4}$ 在 $E=[-1,1]$ 上计算此估计器。将您的最终答案表示为一个精确数。不要包含任何单位。需要提交的最终答案是 $\\varepsilon(x^{4})$ 在 $[-1,1]$ 上的值。",
            "solution": "问题陈述已经过验证，被认为是可靠的。它在科学上基于数值求积理论，问题提法良好，有通往唯一解的清晰路径，并以客观的数学语言表达。我们可以开始求解。\n\n问题分三部分解决：首先，推导高斯-Kronrod求积的原理；其次，显式构造3点高斯-Kronrod法则；最后，使用该法则计算一个误差估计器。\n\n**1) Kronrod 扩展的构建原理**\n\n目标是通过增加 $n+1$ 个新节点并重用原有的 $n$ 个节点，将一个 $n$ 点高斯-勒让德法则 $Q_G(f)$ 扩充为一个更高阶的 $(2n+1)$ 点法则 $Q_K(f)$。原始高斯节点，记为 $\\{x_i\\}_{i=1}^n$，是勒让德多项式 $P_n(x)$ 的根。原始法则 $Q_G(f) = \\sum_{i=1}^n w_i f(x_i)$ 对最高为 $2n-1$ 次的所有多项式都是精确的。\n\n新的 $(2n+1)$ 点 Kronrod 法则 $Q_K(f)$ 定义为：\n$$\nQ_K(f) = \\sum_{i=1}^n a_i f(x_i) + \\sum_{j=1}^{n+1} b_j f(y_j)\n$$\n其中 $\\{x_i\\}_{i=1}^n$ 是固定的高斯节点，$\\{y_j\\}_{j=1}^{n+1}$ 是新的 Kronrod 节点，$\\{a_i\\}_{i=1}^n$ 和 $\\{b_j\\}_{j=1}^{n+1}$ 是相应的权重。需要确定的参数总数为 $(n+1)$ 个节点 $y_j$，$n$ 个权重 $a_i$ 和 $(n+1)$ 个权重 $b_j$，总共有 $3n+2$ 个自由参数。\n\n(i) **作为矩匹配条件的精确性**：高斯求积构造的原理是利用可用的自由度来对尽可能高次的多项式强制实现精确性。利用 $3n+2$ 个参数，我们可以施加 $3n+2$ 个约束。这些约束是求积法则精确地积分单项式 $x^k$ (对于 $k=0, 1, \\dots, 3n+1$)。这就建立了一个包含 $3n+2$ 个方程的方程组：\n$$\n\\int_{-1}^1 x^k \\, dx = \\sum_{i=1}^n a_i x_i^k + \\sum_{j=1}^{n+1} b_j y_j^k, \\quad \\text{for } k = 0, 1, \\dots, 3n+1\n$$\n这是一个关于未知数 $\\{y_j\\}$、$\\{a_i\\}$ 和 $\\{b_j\\}$ 的非线性方程组。\n\n(ii) **对于 $w(x)=1$ 的对称性**：对于对称区间 $E=[-1,1]$ 上的权重函数 $w(x)=1$，求积法则也必须是对称的。这意味着如果 $z$ 是一个节点，那么 $-z$ 也是一个节点，并且它们的权重相等。原始高斯节点 $\\{x_i\\}$ 是 $P_n(x)$ 的根，关于 $x=0$ 对称。我们强制新节点 $\\{y_j\\}$ 也关于 $x=0$ 对称。这一对称性自动满足了所有奇次幂 $k$ 的矩方程，因为对于奇数 $k$，$\\int_{-1}^1 x^k dx = 0$，而右侧的和由于节点对 $(\\pm z, \\pm z, ...)$ 之间的抵消也为零。这大大简化了方程组，只留下偶数值 $k$ 的方程需要求解。唯一未知数（非负节点及其权重）的数量与偶次矩方程的数量相匹配，从而得到一个可解的（尽管仍是非线性的）系统。\n\n(iii) **节点的交错**：求解矩方程组揭示了更深层次的结构。新节点 $\\{y_j\\}$ 是一个 $n+1$ 次多项式的根，该多项式通常记为 $E_{n+1}(x)$。发现该多项式在 $[-1,1]$ 上与 $P_n(x)$ 正交，即 $\\int_{-1}^1 E_{n+1}(x) P_n(x) dx = 0$。关于正交多项式根的一个基本定理指出，一个正交序列中两个连续多项式的根是相互交错的。虽然 $\\{P_n(x), E_{n+1}(x)\\}$ 不构成一个标准正交序列，但它们的正交性质确保了其根的交错性。因此，每两个连续高斯节点 $(x_i, x_{i+1})$ 之间的区间恰好包含一个 Kronrod 节点 $y_j$，并且区间 $(-\\infty, x_{\\min})$ 和 $(x_{\\max}, \\infty)$ 也各包含一个 Kronrod 节点。\n\n**精确度阶**：原始的 $n$ 点法则对最高为 $2n-1$ 次的多项式是精确的。通过引入 $n+1$ 个新节点并拥有总共 $3n+2$ 个参数，我们可以对最高 $3n+1$ 次的多项式强制实现精确性。由于 $n \\ge 1$，我们有 $3n+1 > 2n-1$，这意味着 Kronrod 扩展达到了比原始高斯法则严格更高的精确度阶。事实上，由于对称性，当 $n$ 为奇数时，该法则通常对 $3n+2$ 次多项式也是精确的。\n\n**2) 特化到 $n=1$ 的情况**\n\n对于 $n=1$，高斯-勒让德法则有一个点。节点是 $P_1(x)=x$ 的根，所以 $x_1=0$。权重 $w_1$ 通过积分 $f(x)=1$ 求得：$\\int_{-1}^1 1 dx = 2 = w_1 \\cdot 1$，所以 $w_1=2$。1点高斯法则是 $Q_G(f) = 2f(0)$。它对最高为 $2(1)-1=1$ 次的多项式是精确的。\n\n我们寻求通过增加 $n+1=2$ 个节点，将其扩充为一个 $(2n+1)=3$ 点的 Kronrod 法则。设该法则为 $Q_K(f) = a_1 f(x_1) + b_1 f(y_1) + b_2 f(y_2)$。\n由于 $x_1=0$，我们有 $Q_K(f) = a_1 f(0) + b_1 f(y_1) + b_2 f(y_2)$。\n根据对称性，我们必须有 $y_2 = -y_1$ 和 $b_2=b_1$。令 $y_1=y$ 且 $b_1=b_2=b$。法则变为：\n$$\nQ_K(f) = a_1 f(0) + b f(y) + b f(-y)\n$$\n有3个未知数：$a_1$、 $b$ 和 $y$。我们强制对最高至少为 $3n+1=4$ 次的多项式是精确的。由于对称性，我们只需要考虑偶次幂 $k=0, 2, 4$ 的矩方程。\n\n对于 $k=0$ ($f(x)=1$):\n$\\int_{-1}^1 1 dx = 2$。\n$Q_K(1) = a_1(1) + b(1) + b(1) = a_1+2b$。\n方程(1)：$a_1+2b=2$。\n\n对于 $k=2$ ($f(x)=x^2$):\n$\\int_{-1}^1 x^2 dx = \\frac{2}{3}$。\n$Q_K(x^2) = a_1(0)^2 + b(y)^2 + b(-y)^2 = 2by^2$。\n方程(2)：$2by^2 = \\frac{2}{3} \\implies by^2 = \\frac{1}{3}$。\n\n对于 $k=4$ ($f(x)=x^4$):\n$\\int_{-1}^1 x^4 dx = \\frac{2}{5}$。\n$Q_K(x^4) = a_1(0)^4 + b(y)^4 + b(-y)^4 = 2by^4$。\n方程(3)：$2by^4 = \\frac{2}{5} \\implies by^4 = \\frac{1}{5}$。\n\n我们解这个方程组。将方程(3)除以方程(2)：\n$\\frac{by^4}{by^2} = \\frac{1/5}{1/3} \\implies y^2 = \\frac{3}{5}$。\n所以，新节点是 $y = \\pm\\sqrt{\\frac{3}{5}}$。\n将 $y^2 = 3/5$ 代入方程(2)：\n$b \\left(\\frac{3}{5}\\right) = \\frac{1}{3} \\implies b = \\frac{5}{9}$。\n将 $b=5/9$ 代入方程(1)：\n$a_1 + 2\\left(\\frac{5}{9}\\right) = 2 \\implies a_1 = 2 - \\frac{10}{9} = \\frac{8}{9}$。\n\n得到的3点高斯-Kronrod法则具有：\n- 节点：$-\\sqrt{\\frac{3}{5}}, 0, \\sqrt{\\frac{3}{5}}$\n- 权重：$\\frac{5}{9}, \\frac{8}{9}, \\frac{5}{9}$\n该法则包含了原始高斯节点($0$)并且是对称的，符合要求。\n\n**3) 误差估计器的计算**\n\n嵌入式误差估计器定义为 $\\varepsilon(f) = |Q_K(f) - Q_G(f)|$。我们对被积函数 $f(x)=x^4$ 在 $E=[-1,1]$ 上计算这个值。\n\n首先，应用低阶的1点高斯法则 $Q_G(f) = 2f(0)$:\n$$\nQ_G(x^4) = 2 \\cdot (0)^4 = 0\n$$\n\n接着，应用高阶的3点Kronrod法则 $Q_K(f) = \\frac{8}{9}f(0) + \\frac{5}{9}f(-\\sqrt{3/5}) + \\frac{5}{9}f(\\sqrt{3/5})$:\n$$\nQ_K(x^4) = \\frac{8}{9}(0)^4 + \\frac{5}{9}\\left(-\\sqrt{\\frac{3}{5}}\\right)^4 + \\frac{5}{9}\\left(\\sqrt{\\frac{3}{5}}\\right)^4\n$$\n$$\nQ_K(x^4) = 0 + \\frac{5}{9}\\left(\\frac{3}{5}\\right)^2 + \\frac{5}{9}\\left(\\frac{3}{5}\\right)^2 = 2 \\cdot \\frac{5}{9} \\cdot \\frac{9}{25} = 2 \\cdot \\frac{5}{25} = \\frac{10}{25} = \\frac{2}{5}\n$$\n注意，这与精确积分 $\\int_{-1}^{1} x^4 dx = \\frac{2}{5}$ 相匹配，正如我们构造所预期的那样。\n\n最后，计算估计器的值：\n$$\n\\varepsilon(x^4) = |Q_K(x^4) - Q_G(x^4)| = \\left|\\frac{2}{5} - 0\\right| = \\frac{2}{5}\n$$",
            "answer": "$$\n\\boxed{\\frac{2}{5}}\n$$"
        },
        {
            "introduction": "高阶数值方法的稳定性通常依赖于其离散算子对连续微积分性质的精确模拟，其中分部求和 (Summation-By-Parts, SBP) 特性尤为关键。本练习探讨了高斯求积的阶数如何直接影响离散算子是否满足 SBP 特性 。你将首先验证在求积阶数足够高时，该代数恒等式精确成立，然后通过具体计算来量化当求积阶数不足（即“欠积分”）时所产生的误差，从而深刻理解求积误差如何破坏数值格式的内在结构。",
            "id": "3361955",
            "problem": "考虑参考单元 $[-1,1]$ 和模态勒让德多项式基 $\\{P_{i}(x)\\}_{i=0}^{p}$，其中 $P_{i}(x)$ 表示 $i$ 次勒让德多项式，其归一化满足 $\\int_{-1}^{1} P_{i}(x) P_{j}(x) \\,\\mathrm{d}x = \\frac{2}{2i+1} \\delta_{ij}$ 且 $P_{i}(1)=1$，$P_{i}(-1)=(-1)^{i}$。令 $p=4$。定义 $[-1,1]$ 上具有 $n$ 个节点的 高斯-洛巴托-勒让德求积 为一种唯一的对称求积法则，它包含端点 $x=\\pm 1$，并将内部节点置于 $P_{n-1}'(x)$ 的零点处，其正权重 $\\{w_{k}\\}_{k=1}^{n}$ 的选择使得该法则对于 $[-1,1]$ 上次数至多为 $2n-3$ 的任意多项式都是精确的。\n\n对于给定的 $n$，定义离散质量矩阵和离散导数内积矩阵为\n$$\n\\widetilde{M}_{ij} := \\sum_{k=1}^{n} w_{k}\\, P_{i}(x_{k}) P_{j}(x_{k}), \n\\qquad\n\\widetilde{S}_{ij} := \\sum_{k=1}^{n} w_{k}\\, P_{i}'(x_{k}) P_{j}(x_{k}),\n$$\n并定义边界矩阵\n$$\nB_{ij} := P_{i}(1) P_{j}(1) - P_{i}(-1) P_{j}(-1) = 1 - (-1)^{i+j}.\n$$\n分部求和（SBP）恒等式陈述了分部积分的离散模拟，\n$$\n\\widetilde{S} + \\widetilde{S}^{\\top} = B,\n$$\n其中上标 ${\\top}$ 表示转置。\n\n任务：\n- 仅使用勒让德多项式性质和高斯-洛巴托-勒让德求积的精确性，对于 $p=4$ 和 $n=p+1=5$ 个节点的情况，验证离散质量矩阵 $\\widetilde{M}$ 是对角的，并且 SBP 恒等式 $\\widetilde{S}+\\widetilde{S}^{\\top}=B$ 是精确成立的。\n- 现在取 $n=4  p+1$ (即欠积分)，计算亏格 $\\Delta_{34} = (\\widetilde{S}+\\widetilde{S}^{\\top} - B)_{34}$。",
            "solution": "此问题已经过验证，被认为是有效的。它在数值分析领域有其科学依据，特别涉及谱方法和分部求和（SBP）算子。此问题表述清晰、客观，并包含推导唯一解所需的所有信息。\n\n问题包括两部分。第一部分是在完全积分情况下对性质进行验证，第二部分是在欠积分情况下计算一个误差项。\n\n首先，我们验证当多项式次数 $p=4$ 且高斯-洛巴托-勒让德（GLL）求积法则使用 $n=p+1=5$ 个节点时的结论。具有 $n$ 个节点的 GLL 求积法则对于 $[-1,1]$ 上次数至多为 $2n-3$ 的任意多项式都是精确的。对于 $n=5$，该法则对次数最高为 $2(5)-3=7$ 的多项式是精确的。\n\n离散质量矩阵由 $\\widetilde{M}_{ij} = \\sum_{k=1}^{5} w_k P_i(x_k) P_j(x_k)$ 给出。这是积分 $M_{ij} = \\int_{-1}^{1} P_i(x) P_j(x) dx$ 的求积近似。被积函数是多项式 $P_i(x) P_j(x)$，其次数为 $i+j$。对于次数最高为 $p=4$ 的基函数，我们考虑索引 $0 \\le i, j \\le 4$。对于一个非对角元素，$i \\ne j$，被积函数的最大次数出现在 $(i,j)=(3,4)$ 时，为 $3+4=7$。由于 GLL 法则对于次数最高为 $7$ 的多项式是精确的，对于任何满足 $i \\ne j$ 且 $i+j \\le 7$ 的情况，我们有 $\\widetilde{M}_{ij} = \\int_{-1}^{1} P_i(x) P_j(x) dx$。根据勒让德多项式的正交性，该积分为零。条件 $i+j \\le 7$ 覆盖了 $5 \\times 5$ 矩阵 $\\widetilde{M}$（索引从 $0$ 到 $4$）的所有非对角元素。因此，$\\widetilde{M}$ 是一个对角矩阵。\n\nSBP 恒等式为 $\\widetilde{S} + \\widetilde{S}^{\\top} = B$。左侧的 $(i,j)$-元素是 $\\widetilde{S}_{ij} + \\widetilde{S}_{ji} = \\sum_{k=1}^{5} w_k (P_i'(x_k) P_j(x_k) + P_j'(x_k) P_i(x_k))$。求和项是乘积的导数，即 $(P_i(x)P_j(x))'$。这是一个次数为 $i+j-1$ 的多项式。对于 $0 \\le i, j \\le 4$，最大次数为 $4+4-1=7$。具有 $n=5$ 个节点的 GLL 法则对这些多项式是精确的。因此，\n$$ \\widetilde{S}_{ij} + \\widetilde{S}_{ji} = \\int_{-1}^{1} \\frac{d}{dx} (P_i(x)P_j(x)) dx $$\n根据微积分基本定理，该积分计算结果为\n$$ [P_i(x)P_j(x)]_{x=-1}^{x=1} = P_i(1)P_j(1) - P_i(-1)P_j(-1). $$\n使用给定的性质 $P_k(1)=1$ 和 $P_k(-1)=(-1)^k$，上式变为 $1 \\cdot 1 - (-1)^i (-1)^j = 1 - (-1)^{i+j}$，这正是 $B_{ij}$ 的定义。因此，对于 $n=p+1=5$，SBP 恒等式 $\\widetilde{S}+\\widetilde{S}^{\\top}=B$ 精确成立。\n\n现在，我们处理第二个任务：在 $p=4$ 的欠积分情况（即 $n=4$ 个节点）下，计算亏格 $\\Delta_{34}$。需要计算的量是\n$$ \\Delta_{34} = (\\widetilde{S}+\\widetilde{S}^{\\top} - B)_{34} = (\\widetilde{S}_{34} + \\widetilde{S}_{43}) - B_{34}. $$\n具有 $n=4$ 个节点的 GLL 求积对于次数至多为 $2n-3 = 2(4)-3=5$ 的多项式是精确的。项 $\\widetilde{S}_{34} + \\widetilde{S}_{43}$ 是 $\\int_{-1}^1 (P_3(x)P_4(x))' dx$ 的求积近似。被积函数 $(P_3P_4)'$ 是一个次数为 $3+4-1=6$ 的多项式。由于次数 $6$ 大于 $5$，该求积不是精确的，我们预期会有一个非零的亏格 $\\Delta_{34}$。\n\n首先，我们确定 $n=4$ 时的 GLL 节点和权重。节点是端点 $\\{-1, 1\\}$ 以及 $P'_{n-1}(x) = P'_3(x)$ 的零点。归一化为 $P_i(1)=1$ 的勒让德多项式是：\n$P_3(x) = \\frac{1}{2}(5x^3-3x)$\n$P_4(x) = \\frac{1}{8}(35x^4-30x^2+3)$\n$P_3(x)$ 的导数是 $P'_3(x) = \\frac{1}{2}(15x^2-3)$。令 $P'_3(x)=0$ 得到 $15x^2=3$，所以 $x^2=1/5$。内部节点是 $x = \\pm 1/\\sqrt{5}$。\n四个 GLL 节点是 $x_1=-1$，$x_2=-1/\\sqrt{5}$，$x_3=1/\\sqrt{5}$，$x_4=1$。\nGLL 权重由 $w_k = \\frac{2}{n(n-1)[P_{n-1}(x_k)]^2} = \\frac{2}{4(3)[P_3(x_k)]^2} = \\frac{1}{6[P_3(x_k)]^2}$ 给出。\n对于端点 $x=\\pm 1$，我们有 $P_3(1)=1$ 和 $P_3(-1)=-1$，所以 $[P_3(\\pm 1)]^2=1$。端点权重为 $w_1=w_4=\\frac{1}{6}$。\n对于内部节点 $x=\\pm 1/\\sqrt{5}$：\n$P_3(1/\\sqrt{5}) = \\frac{1}{2}(5(1/\\sqrt{5})^3-3(1/\\sqrt{5})) = \\frac{1}{2\\sqrt{5}}(1-3) = -1/\\sqrt{5}$。\n$P_3(-1/\\sqrt{5}) = 1/\\sqrt{5}$。\n所以，$[P_3(\\pm 1/\\sqrt{5})]^2 = 1/5$。内部权重为 $w_2=w_3=\\frac{1}{6(1/5)} = \\frac{5}{6}$。\n\n接下来，我们计算项 $\\widetilde{S}_{34} + \\widetilde{S}_{43} = \\sum_{k=1}^{4} w_{k} (P_{3}'(x_{k}) P_{4}(x_{k}) + P_{4}'(x_{k}) P_{3}(x_{k}))$。令 $g(x) = P_3'(x)P_4(x) + P_4'(x)P_3(x)$。所需的导数是：\n$P'_3(x) = \\frac{3}{2}(5x^2-1)$\n$P'_4(x) = \\frac{1}{8}(140x^3-60x) = \\frac{5}{2}(7x^3-3x)$\n函数 $g(x)$ 是偶函数，因为 $P_3$ 是奇函数，$P_4$ 是偶函数，$P_3'$ 是偶函数，而 $P_4'$ 是奇函数，这使得 $P_3'P_4$ 是偶函数， $P_4'P_3$ 也是偶函数。所以 $g(-x)=g(x)$。求和为 $\\sum_{k=1}^4 w_k g(x_k) = 2w_1 g(1) + 2w_2 g(1/\\sqrt{5})$。\n\n我们在正节点处计算 $g(x)$ 的值：\n在 $x=1$ 处：\n$P_3(1)=1$, $P_4(1)=1$\n$P'_3(1) = \\frac{3}{2}(5-1) = 6$\n$P'_4(1) = \\frac{5}{2}(7-3) = 10$\n$g(1) = P'_3(1)P_4(1) + P'_4(1)P_3(1) = 6(1) + 10(1) = 16$。\n\n在 $x=1/\\sqrt{5}$ 处：\n$P_3(1/\\sqrt{5}) = -1/\\sqrt{5}$\n$P_4(1/\\sqrt{5}) = \\frac{1}{8}(35(1/25) - 30(1/5) + 3) = \\frac{1}{8}(7/5 - 6 + 3) = \\frac{1}{8}(7/5 - 15/5) = -1/5$。\n$P'_3(1/\\sqrt{5}) = \\frac{3}{2}(5(1/5)-1) = 0$（正如所料，因为它是一个节点）。\n$P'_4(1/\\sqrt{5}) = \\frac{5}{2}(7(1/5\\sqrt{5}) - 3(1/\\sqrt{5})) = \\frac{5}{2\\sqrt{5}}(7/5 - 3) = \\frac{5}{2\\sqrt{5}}(-8/5) = -4/\\sqrt{5}$。\n$g(1/\\sqrt{5}) = P'_3 P_4 + P'_4 P_3 = 0 \\cdot (-1/5) + (-4/\\sqrt{5})(-1/\\sqrt{5}) = 4/5$。\n\n现在我们计算这个和：\n$\\widetilde{S}_{34} + \\widetilde{S}_{43} = 2w_1 g(1) + 2w_2 g(1/\\sqrt{5}) = 2(\\frac{1}{6})(16) + 2(\\frac{5}{6})(\\frac{4}{5}) = \\frac{16}{3} + \\frac{10}{6}\\frac{4}{5} = \\frac{16}{3} + \\frac{40}{30} = \\frac{16}{3} + \\frac{4}{3} = \\frac{20}{3}$。\n\n最后，我们计算边界项 $B_{34}$：\n$B_{34} = P_3(1)P_4(1) - P_3(-1)P_4(-1) = 1 \\cdot 1 - (-1)^3 (-1)^4 = 1 - (-1)(1) = 2$。\n\n亏格是其差值：\n$\\Delta_{34} = (\\widetilde{S}_{34} + \\widetilde{S}_{43}) - B_{34} = \\frac{20}{3} - 2 = \\frac{20-6}{3} = \\frac{14}{3}$。",
            "answer": "$$\\boxed{\\frac{14}{3}}$$"
        },
        {
            "introduction": "对于守恒律方程的数值模拟，保证离散守恒性是至关重要的。在间断伽辽金 (Discontinuous Galerkin, DG) 方法中，这依赖于跨单元交界面的数值通量的精确抵消。本编程练习将让你亲手构建一个 DG 格式，并探究当交界面两侧使用不一致或不精确的求积法则时，离散守恒性是如何被破坏的 。更重要的是，你将实现一种基于提升算子 (lifting operator) 的修正方法，这是一种恢复守恒性的标准技术，从而在实践中掌握处理复杂网格或非协调离散化中常见问题的能力。",
            "id": "3362018",
            "problem": "为二维空间中的标量守恒律构建并分析一种间断 Galerkin (DG) 离散格式，该格式使用精确体积求积和非精确面求积，并提出一种基于提升的修正来恢复离散守恒性。考虑线性平流方程 $u_t + \\nabla \\cdot (\\mathbf{a} u) = 0$，其定义在由两个轴对齐单元 $K_L = [0,1/2] \\times [0,1]$ 和 $K_R = [1/2,1] \\times [0,1]$ 组成的矩形网格上。平流速度 $\\mathbf{a} = (a_x,a_y)$ 是一个常数。间断 Galerkin (DG) 方法在每个单元中用 $p$ 次多项式来近似 $u$，这些多项式在参考正方形 $[-1,1]^2$ 上的张量积勒让德基中展开，并通过仿射映射到每个物理单元上。设 $P_i(\\hat{x})$ 表示 $[-1,1]$ 上的 $i$ 次勒让德多项式，其标准归一化为 $\\int_{-1}^1 P_i(\\hat{x}) P_j(\\hat{x}) \\, d\\hat{x} = \\frac{2}{2i+1} \\delta_{ij}$。\n\n每个单元 $K$ 上的 DG 弱形式为：寻找 $u_h$，使得对于局部多项式空间中的任意测试函数 $\\phi_h$，有\n$$\\int_K \\phi_h \\, \\partial_t u_h \\, dx \\, dy + \\int_K \\nabla \\phi_h \\cdot \\mathbf{a} \\, u_h \\, dx \\, dy - \\int_{\\partial K} \\phi_h \\, \\hat{f}(u_h^-,u_h^+;\\mathbf{n}) \\, ds = 0,$$\n其中 $\\hat{f}$ 是一致的一维数值通量，$u_h^-$ 是内部迹，$u_h^+$ 是来自相邻单元的外部迹，$\\mathbf{n}$ 是单位外法向量。对于常数平流，使用迎风通量 $\\hat{f}(u^-,u^+;\\mathbf{n}) = (\\mathbf{a} \\cdot \\mathbf{n}) u^\\text{up}$，其中，若 $\\mathbf{a} \\cdot \\mathbf{n} \\ge 0$，则 $u^\\text{up} = u^-$，否则 $u^\\text{up} = u^+$。\n\n通过选取测试函数 $\\phi_h = 1$ 来检验质量的离散守恒性。当 $\\phi_h = 1$ 时，体积项简化为 $\\int_K \\nabla \\cdot (\\mathbf{a} u_h) \\, dx \\, dy$，并且经过分部积分后，单元平均值的半离散演化由面通量决定。在共享的垂直界面 $\\Gamma = \\{(x,y) \\mid x = 1/2, \\, y \\in [0,1]\\}$ 上，精确守恒要求来自两个面的贡献（来自 $K_L$ 的 $\\mathbf{n}=(1,0)$ 和来自 $K_R$ 的 $\\mathbf{n}=(-1,0)$）之和正好抵消：\n$$ \\int_{\\Gamma} (a_x) u^\\text{up} \\, ds + \\int_{\\Gamma} (-a_x) u^\\text{up} \\, ds = 0. $$\n\n在数值格式中，假设体积积分使用足够高阶的张量积高斯-勒让德求积计算，从而使得对达到所需次数的多项式的体积积分是精确的。相比之下，每个单元侧的面积分则使用在每侧局部选择的 $N_f$ 阶高斯-勒让德求积进行近似，$\\Gamma$ 两侧的阶数可能不同。$[-1,1]$ 上的 $N$ 点高斯求积对于次数至多为 $2N-1$ 的多项式是精确的。如果沿 $\\Gamma$ 的 $u^\\text{up}$ 的多项式迹的次数 $p_\\text{trace}$ 超过了任意一侧的精确度阈值，那么两个独立计算的面积分就不必匹配，两两抵消就会失败。将界面守恒误差定义为两个离散面贡献之和的绝对值，\n$$ \\mathcal{E}_\\Gamma = \\left| \\int_{\\Gamma}^{(L)} (a_x) u^\\text{up} \\, ds + \\int_{\\Gamma}^{(R)} (-a_x) u^\\text{up} \\, ds \\right|, $$\n其中上标表示在左侧和右侧使用的单元局部求积阶数和节点。\n\n在 $\\Gamma$ 上提出一种基于提升的修正，通过计算一个单一、共同且足够高阶 $N_m$ 的面求积来近似 $\\int_{\\Gamma} (a_x) u^\\text{up} \\, ds$ 来强制实现离散守恒，然后将大小相等、方向相反的贡献分配给相邻单元，从而使得\n$$ \\int_{\\Gamma}^{(L)} (a_x) u^\\text{up} \\, ds \\gets I_\\Gamma, \\quad \\int_{\\Gamma}^{(R)} (-a_x) u^\\text{up} \\, ds \\gets -I_\\Gamma, $$\n其中 $I_\\Gamma$ 是共同的求积近似值。这等价于应用一个提升算子，该算子将一个一致的界面残差投影到体积自由度上，从而保证对于常数测试函数，$\\mathcal{E}_\\Gamma = 0$。\n\n实现一个程序，该程序：\n- 在每个单元中构建次数最高为 $p$ 的勒让德张量积基。\n- 使用足够高阶的张量积高斯-勒让德体积求积，将一个构造的多项式 $u(x,y)$ 投影到每个单元的基上，以确保对于所选的 $u$ 和多项式次数，该投影是精确的（在浮点舍入误差范围内）。\n- 沿共享界面 $\\Gamma$ 从左单元计算迎风迹 $u^\\text{up}$，并使用独立的 $N_{f,L}$ 和 $N_{f,R}$ 阶单元局部高斯-勒让德求积计算两个面积分。\n- 计算未经修正的界面守恒误差 $\\mathcal{E}_\\Gamma$。\n- 应用基于提升的修正，使用单一的 $N_m$ 阶共同面求积，并重新计算修正后的界面守恒误差。\n\n使用构造的多项式\n$$ u(x,y) = 1 + x^2 y^7 + \\frac{3}{10} x y^5 + \\frac{1}{5} y^8, $$\n其中 $x$ 和 $y$ 在 $[0,1]$ 内。使用 $\\mathbf{a} = (1,0)$，这样只有垂直面有贡献。\n\n测试套件和参数覆盖范围：\n- 情况 A（理想路径，精确面求积）：$p_L = 3$，$p_R = 3$，$N_{f,L} = 4$，$N_{f,R} = 4$，$N_m = 8$。预期 $\\mathcal{E}_\\Gamma$ 在舍入误差内为零。\n- 情况 B（不一致次数，非精确面求积）：$p_L = 6$，$p_R = 3$，$N_{f,L} = 3$，$N_{f,R} = 2$，$N_m = 16$。预期 $\\mathcal{E}_\\Gamma$ 严格为正。\n- 情况 C（对情况 B 应用提升修正）：$p_L$、$p_R$、$N_{f,L}$、$N_{f,R}$ 与情况 B 相同，$N_m = 16$。预期修正后的 $\\mathcal{E}_\\Gamma$ 在舍入误差内为零。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，三个条目依次是情况 A、未经修正的情况 B 和经过修正的情况 C 的浮点值 $\\mathcal{E}_\\Gamma$（例如，“[$e_A$,$e_B$,$e_C$]”）。不涉及物理单位或角度，结果必须以十进制小数形式报告。",
            "solution": "该问题要求分析二维线性平流方程 $u_t + \\nabla \\cdot (\\mathbf{a} u) = 0$ 的间断 Galerkin (DG) 离散格式的离散质量守恒性。我们关注两个单元 $K_L = [0,1/2] \\times [0,1]$ 和 $K_R = [1/2,1] \\times [0,1]$ 之间的界面，DG 解在该界面上可能不连续。分析的核心在于如何使用数值求积来近似面积分，以及其对守恒性质产生的影响。\n\n首先，我们建立 DG 框架。在每个单元 $K$ 中，解 $u$ 由一个来自最高次数为 $p$ 的多项式空间的函数 $u_h$ 近似。具体来说，我们在参考单元 $\\hat{K} = [-1,1]^2$ 上使用勒让德多项式的张量积基。物理单元 $K$ 上的任意多项式 $u_h$ 表示为 $\\hat{u}_h(\\hat{x},\\hat{y}) = \\sum_{i=0}^p \\sum_{j=0}^p c_{ij} P_i(\\hat{x}) P_j(\\hat{y})$，其中 $(x,y)$ 通过仿射变换映射到 $(\\hat{x},\\hat{y})$，而 $P_k$ 是 $k$ 次勒让德多项式。\n\n单元 $K$ 的半离散 DG 弱形式为：\n$$\n\\int_K \\phi_h \\, \\partial_t u_h \\, d\\mathbf{x} - \\int_K \\mathbf{a} u_h \\cdot \\nabla \\phi_h \\, d\\mathbf{x} + \\int_{\\partial K} \\phi_h \\, \\hat{f}(u_h^-, u_h^+; \\mathbf{n}) \\, ds = 0\n$$\n此式必须对同一多项式空间中的所有测试函数 $\\phi_h$ 成立。这里，我们对平流项使用了分部积分。项 $\\hat{f}(u_h^-, u_h^+; \\mathbf{n})$ 是数值通量，它将相邻单元耦合起来。我们使用迎风通量：$\\hat{f}(u^-, u^+; \\mathbf{n}) = (\\mathbf{a} \\cdot \\mathbf{n}) u^\\text{up}$，其中 $u^\\text{up}$ 是来自面“迎风”侧的 $u_h$ 值，由 $\\mathbf{a} \\cdot \\mathbf{n}$ 的符号决定。\n\n通过选择测试函数 $\\phi_h = 1$ 来评估离散守恒性。选择此函数后，$\\nabla \\phi_h = 0$，弱形式简化为：\n$$\n\\frac{d}{dt} \\int_K u_h \\, d\\mathbf{x} + \\int_{\\partial K} \\hat{f}(u_h^-, u_h^+; \\mathbf{n}) \\, ds = 0\n$$\n对于共享一个公共界面 $\\Gamma$ 的两个相邻单元 $K_L$ 和 $K_R$，全局守恒要求跨 $\\Gamma$ 的通量贡献之和为零。设 $\\mathbf{n}_L$ 为从 $K_L$ 指出的外法向量，$\\mathbf{n}_R = -\\mathbf{n}_L$ 为从 $K_R$ 指出的外法向量。通量之和为 $\\int_\\Gamma \\hat{f}_L \\, ds + \\int_\\Gamma \\hat{f}_R \\, ds = 0$。\n给定恒定的平流速度 $\\mathbf{a} = (1,0)$，界面 $\\Gamma$ 位于 $x=1/2$。\n从 $K_L$ 的角度看，法向量是 $\\mathbf{n}_L = (1,0)$，因此 $\\mathbf{a} \\cdot \\mathbf{n}_L = 1 > 0$。迎风值 $u^\\text{up}$ 是内部迹 $u_h^- = u_{h,L}|_\\Gamma$。通量为 $(1) u_{h,L}|_\\Gamma$。\n从 $K_R$ 的角度看，法向量是 $\\mathbf{n}_R = (-1,0)$，因此 $\\mathbf{a} \\cdot \\mathbf{n}_R = -1  0$。迎风值 $u^\\text{up}$ 是外部迹 $u_h^+ = u_{h,L}|_\\Gamma$。通量为 $(-1) u_{h,L}|_\\Gamma$。\n在这两种情况下，通量计算都依赖于左侧单元解的迹 $u_{h,L}$。精确守恒成立：$\\int_\\Gamma (1) u_{h,L}|_\\Gamma \\, ds + \\int_\\Gamma (-1) u_{h,L}|_\\Gamma \\, ds = 0$。\n\n当这些面积分被数值近似时，问题就出现了。如果单元 $K_L$ 使用阶为 $N_{f,L}$ 的高斯求积法则，而 $K_R$ 使用阶为 $N_{f,R}$ 的，那么计算出的通量是：\n$$\nI_L = (a_x) \\left( \\int_\\Gamma u_{h,L}|_\\Gamma \\, ds \\right)_{N_{f,L}} \\quad \\text{and} \\quad I_R = (-a_x) \\left( \\int_\\Gamma u_{h,L}|_\\Gamma \\, ds \\right)_{N_{f,R}}\n$$\n其中 $(\\cdot)_N$ 表示用 $N$ 点求积法则进行的近似。如果 $N_{f,L} \\neq N_{f,R}$，或者任一法则对多项式迹 $u_{h,L}|_\\Gamma$ 不是精确的，那么 $I_L + I_R \\neq 0$。界面守恒误差定义为 $\\mathcal{E}_\\Gamma = |I_L + I_R|$。\n\n实现过程如下：\n1.  **投影构造解**：对于每个测试案例，我们首先通过对给定的构造解 $u(x,y) = 1 + x^2 y^7 + \\frac{3}{10} x y^5 + \\frac{1}{5} y^8$ 进行 $L^2$-投影，来找到单元 $K_L$ 中的 DG 近似解 $u_{h,L}$。由于迎风通量仅依赖于 $u_{h,L}$，因此计算中不需要 $K_R$ 的参数（如 $p_R$）。该投影找到展开式 $\\hat{u}_{h,L}(\\hat{x},\\hat{y}) = \\sum_{i=0}^{p_L} \\sum_{j=0}^{p_L} c_{ij} P_i(\\hat{x}) P_j(\\hat{y})$ 中的系数 $c_{ij}$，使得对于所有 $\\phi_h$，$\\int_{K_L} (u-u_{h,L})\\phi_h \\, d\\mathbf{x} = 0$ 成立。由于勒让德基在参考单元上的正交性，系数可通过以下方式找到：\n    $$\n    c_{ij} = \\frac{(2i+1)(2j+1)}{4} \\int_{-1}^1 \\int_{-1}^1 u(x(\\hat{x}), y(\\hat{y})) P_i(\\hat{x}) P_j(\\hat{y}) \\, d\\hat{x} d\\hat{y}\n    $$\n    此积分使用高阶张量积高斯-勒让德求积进行计算，以确保其有效精确。我们使用求积阶数 $N_v = 15$，这对于所涉及的多项式是足够的。\n\n2.  **计算迹**：$u_{h,L}$ 在界面 $\\Gamma$（$x=1/2$）上的迹对应于 $K_L$ 的参考单元上 $\\hat{x}=1$ 处的迹。由于对所有 $i$ 都有 $P_i(1)=1$，迹多项式是关于 $\\hat{y}$ 的一维多项式：\n    $$\n    g(\\hat{y}) = \\hat{u}_{h,L}(1, \\hat{y}) = \\sum_{j=0}^{p_L} \\left( \\sum_{i=0}^{p_L} c_{ij} \\right) P_j(\\hat{y}) = \\sum_{j=0}^{p_L} d_j P_j(\\hat{y})\n    $$\n    其中 $d_j = \\sum_{i=0}^{p_L} c_{ij}$。该迹多项式的次数最高为 $p_L$。\n\n3.  **计算积分和误差**：面积分是 $\\int_0^1 g(y) \\, dy$，在参考区间上转换为 $\\frac{1}{2} \\int_{-1}^1 g(\\hat{y}) \\, d\\hat{y}$。我们使用 $N_{f,L}$ 点和 $N_{f,R}$ 点的高斯-勒让德求积来近似该积分，设结果为 $\\mathcal{I}_{N_{f,L}}$ 和 $\\mathcal{I}_{N_{f,R}}$。当 $a_x=1$ 时，未修正的守恒误差为：\n    $$\n    \\mathcal{E}_\\Gamma = | (1) \\mathcal{I}_{N_{f,L}} + (-1) \\mathcal{I}_{N_{f,R}} | = |\\mathcal{I}_{N_{f,L}} - \\mathcal{I}_{N_{f,R}}|\n    $$\n\n4.  **应用提升修正**：为强制守恒，使用阶为 $N_m$ 的求积计算一个单一、高精度的共同积分 $I_\\Gamma = (a_x) \\mathcal{I}_{N_m}$。然后将此值以相反的符号分配给两个单元。$K_L$ 的通量贡献变为 $I_\\Gamma$，$K_R$ 的通量贡献变为 $-I_\\Gamma$。其和为 $I_\\Gamma - I_\\Gamma = 0$，修正后的守恒误差 $\\mathcal{E}_{\\Gamma, \\text{corr}}$ 根据构造为零。\n\n现在我们将此过程应用于三个测试案例：\n*   **情况 A**：$p_L=3$，$N_{f,L}=4$，$N_{f,R}=4$。迹多项式的次数最高为 3。一个 $N_f=4$ 的求积法则对于次数最高为 $2 \\times 4 - 1 = 7$ 的多项式是精确的。由于 $3 \\le 7$，两个求积都是精确的。因此，$\\mathcal{I}_{N_{f,L}} = \\mathcal{I}_{N_{f,R}}$，$\\mathcal{E}_\\Gamma$ 应在浮点精度内为零。\n*   **情况 B**：$p_L=6$，$N_{f,L}=3$，$N_{f,R}=2$。迹多项式的次数最高为 6。$N_{f,L}=3$ 的法则仅对最高次数为 5 的多项式精确，而 $N_{f,R}=2$ 的法则仅对最高次数为 3 的多项式精确。两者都是非精确的，并且使用不同的节点/权重，因此我们预计 $\\mathcal{I}_{N_{f,L}} \\neq \\mathcal{I}_{N_{f,R}}$，从而导致一个非零的 $\\mathcal{E}_\\Gamma$。\n*   **情况 C**：参数与情况 B 相同，但应用了 $N_m=16$ 的提升修正。计算修正后的误差，根据基于提升的修正的设计，该误差将精确为零。",
            "answer": "$$\n\\boxed{\\text{[0.0,0.02116402116402113,0.0]}}\n$$"
        }
    ]
}