## 引言
在求解守恒律[偏微分方程](@entry_id:141332)的现代数值方法中，例如间断伽辽金（DG）方法或[有限体积法](@entry_id:749372)，核心挑战之一是如何处理单元间不连续的界面。由于解在这些界面上是多值的，我们不能直接应用物理通量，而必须引入一个“[数值通量](@entry_id:752791)”来连接相邻单元。然而，这个数值通量的设计并非任意，它必须遵循严格的数学和物理原则，以保证最终的数值解是稳定、准确且收敛到真实物理过程的。本文旨在系统性地阐明这些指导性原则，重点关注**一致性 (consistency)** 和**守恒性 (conservation)** 这两大基石。

本文将带领读者深入理解这些看似抽象的原则如何具体地塑造[数值格式](@entry_id:752822)的行为。
- 在**“原理与机制”**一章中，我们将建立数值通量所需满足的公理化框架，详细剖析一致性与守恒性的数学定义、物理内涵以及违反它们的后果。
- 接着，在**“应用与跨学科连接”**一章中，我们将展示这些核心原则如何在[流体力学](@entry_id:136788)、电磁学等不同物理系统中得到应用，并探讨它们如何演化以应对弯曲网格、平衡律等更复杂的计算挑战。
- 最后，**“动手实践”**部分提供了一系列精心设计的问题，旨在通过实际推导加深读者对这些理论概念的理解。

通过本次学习，您将掌握评估和设计高性能[数值通量](@entry_id:752791)的理论基础，为解决前沿科学与工程问题打下坚实的基础。

## 原理与机制

在离散化[守恒律的数值方法](@entry_id:752804)，尤其是间断伽辽金 (Discontinuous Galerkin, DG) 和谱方法中，单元之间的边界通量处理是核心挑战。由于解在单元边界上是多值的，我们无法直接使用物理通量函数 $f(u)$。取而代之，我们必须引入一个**数值通量** (numerical flux) 函数，记为 $\widehat{F}(u^-, u^+; \boldsymbol{n})$。该函数依赖于界面两侧的状态（从单元内部看为 $u^-$，从相邻单元看为 $u^+$）以及界面的[单位法向量](@entry_id:178851) $\boldsymbol{n}$。这个[数值通量](@entry_id:752791)的设计并非随意的，它必须遵循若干基本原理，以确保最终的[数值格式](@entry_id:752822)是稳定、准确且物理上可靠的。本章将系统地阐述这些核心原理，特别是**一致性** (consistency) 和**守恒性** (conservation)，并探讨它们在数值格式设计中的具体体现和深远影响。

### [数值通量](@entry_id:752791)的基本公理

任何一个设计良好的数值通量都必须满足一系列公理化的性质。这些性质确保了离散格式在数学上是合理的，并且能够在离散极限下收敛到原始[偏微分方程](@entry_id:141332)的真实解。

#### 一致性：与物理定律的吻合

**一致性**是连接数值通量与原始物理定律的桥梁。其核心思想是：如果数值解在某个界面上恰好是连续的，即 $u^- = u^+ = u$，那么数值通量就应该退化为真实的物理通量穿过该界面的法向分量。这个要求是数值格式能够被称为是原 PDE 的一个逼近的最低标准。

形式上，对于一个标量或向量守恒律 $\partial_t \boldsymbol{u} + \nabla \cdot \boldsymbol{f}(\boldsymbol{u}) = 0$，其[数值通量](@entry_id:752791) $\widehat{F}(u^-, u^+; \boldsymbol{n})$ 必须满足以下**一致性条件**：
$$
\widehat{F}(u, u; \boldsymbol{n}) = \boldsymbol{f}(u) \cdot \boldsymbol{n}
$$
对于任意状态 $u$ 和任意[单位法向量](@entry_id:178851) $\boldsymbol{n}$ 都成立。

一致性的一个直接推论是，一个正确构造的数值格式能够精确地保持空间均匀的定常解。考虑一个初始状态为常数 $U^\star$ 的情况，此时所有单元的解均为 $U^\star$。在任意一个单元交界面上，$u^- = u^+ = U^\star$。根据一致性，数值通量 $\widehat{F}(U^\star, U^\star; \boldsymbol{n}) = \boldsymbol{f}(U^\star) \cdot \boldsymbol{n}$。因此，一个有限体积或 DG 格式的半离散形式，如 $\frac{d}{dt} U_i(t) = -\frac{1}{\Delta x} ( \hat F_{i+1/2} - \hat F_{i-1/2} )$，其右端项将变为 $-\frac{1}{\Delta x} ( \boldsymbol{f}(U^\star) \cdot \boldsymbol{n} - \boldsymbol{f}(U^\star) \cdot \boldsymbol{n} ) = 0$。这意味着数值解将保持为常数，这与原 PDE 的行为完全一致。

违反一致性会带来严重的后果，它会导致[数值格式](@entry_id:752822)收敛到一个错误的解，甚至是一个完全不同的[偏微分方程](@entry_id:141332)的解。让我们通过两个思想实验来揭示其影响。

第一个例子考虑一维无粘 Burgers 方程 $u_{t} + (\frac{1}{2} u^{2})_{x} = 0$。其激波（间断解）的传播速度由 Rankine-Hugoniot 条件决定：$s = \frac{[f(u)]}{[u]} = \frac{f(u_R) - f(u_L)}{u_R - u_L}$，其中 $[q]$ 表示间断左右两侧的跳跃量 $q_R - q_L$。对于 Burgers 方程，这给出了真实激[波速](@entry_id:186208)度 $s = \frac{1}{2}(u_L + u_R)$。现在，假设我们使用一个不满足一致性的数值通量，例如 $\hat{f}(u_L, u_R) = \frac{1}{2} u_L^2 + \frac{\beta}{2} (u_L + u_R)$，其中 $\beta \neq 0$ 是一个常数。这个格式所模拟的等效守恒律的通量是 $g(u) := \hat{f}(u,u) = \frac{1}{2}u^2 + \beta u$。此格式产生的数值激[波速](@entry_id:186208)度将是 $s_\beta = \frac{[g(u)]}{[u]} = \frac{1}{2}(u_L + u_R) + \beta$。与真实速度相比，其误差 $\Delta s = s_\beta - s = \beta$。这表明，不一致性直接导致了对激波物理[传播速度](@entry_id:189384)的系统性错误预测，误差大小恰好等于通量不一致的程度。

第二个例子从波传播的角度考察线性[平流方程](@entry_id:144869) $u_t + a u_x = 0$ ($a>0$)。其解是以速度 $a$ 传播的波。假设我们采用一个不一致的数值通量，例如 $\widehat{f}(u_L, u_R) = (1+\varepsilon) a u_L$，其中 $\varepsilon \neq 0$。通过傅里叶分析可以证明，采用此通量的 $P^0$ DG 格式，其数值相速度 $c_{\mathrm{num}}(k,h)$ 在网格加密极限下 ($h \to 0$) 并不收敛于真实的相速度 $a$，而是收敛于 $(1+\varepsilon)a$。这意味着，整个数值解将以错误的速度传播。这两个例子清晰地表明，一致性是确保数值解在物理上和数学上都有意义的绝对先决条件。

#### 守恒性：确保全局量的平衡

**守恒性**是另一个至关重要的公理。它要求在一个内部界面上，从一个单元流出的通量必须精确地等于流入相邻单元的通量。这一性质确保了在整个计算区域内部，被守恒的量（如质量、动量、能量）不会凭空产生或消失。

对于共享一个公共界面 $F$ 的两个相邻单元 $K^-$ 和 $K^+$，它们在界面 $F$ 上的单位外[法向量](@entry_id:264185)方向相反，即 $\boldsymbol{n}^+ = -\boldsymbol{n}^-$。守恒性要求数值通量满足如下的[反对称关系](@entry_id:261979)：
$$
\widehat{F}(u^-, u^+; \boldsymbol{n}^-) = - \widehat{F}(u^+, u^-; \boldsymbol{n}^+)
$$
其中，对于 $K^-$ 单元，其内部状态为 $u^-$，外部状态为 $u^+$；而对于 $K^+$ 单元，其内部状态为 $u^+$，外部状态为 $u^-$。

这个属性的价值在于，当我们将所有单元的离散方程相加来考察一个宏观区域的总量变化时，所有内部界面的通量贡献都会成对抵消。例如，在一个有限体积格式中，对所有单元求和会得到一个伸缩求和 (telescoping sum)，总量的变化率仅由计算区域最外边界的通量决定，这精确地模拟了宏观物理守恒律。

一个优雅的例子是在周期性边界条件的区域上。在这种情况下，计算区域没有真正的“外部”边界。区域的左右端点被视为一个内部界面。由于守恒[数值通量](@entry_id:752791)的性质，这个界面上的通量贡献也会相互抵消。因此，对于任何满足守恒性的 DG 或 FV 格式，在周期性区域上，被积物理量的总量（例如总质量 $M(t) = \int_{0}^{L} u_{h}(x,t)\\,dx$）随时间的变化率为零，即 $\frac{dM}{dt} = 0$。这意味着总质量是精确守恒的。值得注意的是，这个结论与[数值通量](@entry_id:752791)内部耗散项的具体形式和大小完全无关，它仅仅依赖于通量的[单值性](@entry_id:174849)和守恒性这一结构属性。

#### 稳定性：对扰动的鲁棒性

除了满足一致性和守恒性，一个实用的[数值通量](@entry_id:752791)还必须是**稳定**的，这意味着对输入状态的微小扰动不应引起通量值的剧烈变化。这种性质通常通过要求数值通量函数对其状态参数是**利普希茨连续 (Lipschitz continuous)** 来保证。

形式上，这意味着存在一个常数 $L \ge 0$，使得对于所有状态 $u_L, u_R, v_L, v_R$ 和任意法向量 $\boldsymbol{n}$，以下不等式成立：
$$
\big|\widehat{F}(u_L,u_R;\boldsymbol{n}) - \widehat{F}(v_L,v_R;\boldsymbol{n})\big| \le L\big(|u_L - v_L| + |u_R - v_R|\big)
$$
这个条件保证了[数值格式](@entry_id:752822)的鲁棒性，是证明格式稳定性和收敛性的关键一环。需要强调的是，[利普希茨连续性](@entry_id:142246)是一个分析性质，与一致性和守恒性这些代数性质是[相互独立](@entry_id:273670)的。例如，一个通量可以是非守恒的，但仍然是[利普希茨连续的](@entry_id:267396)。

### [数值通量](@entry_id:752791)的设计实例

上述公理为我们设计和评估[数值通量](@entry_id:752791)提供了理论框架。下面我们通过实例来说明这些原理如何应用于实践。

#### 线性平流的[中心通量](@entry_id:747204)

考虑最简单的一维线性[平流方程](@entry_id:144869) $u_t + a u_x = 0$，其物理通量为 $f(u) = au$。我们可以构建一个参数化的线性[数值通量](@entry_id:752791)族：
$$
\widehat{f}_{\alpha}(u^{-},u^{+};a) = a\left(\alpha\,u^{-} + (1-\alpha)\\,u^{+}\right)
$$
其中 $\alpha \in \mathbb{R}$ 是一个待定参数。

首先，我们检验一致性。当 $u^- = u^+ = u$ 时，$\widehat{f}_{\alpha}(u,u;a) = a(\alpha u + (1-\alpha)u) = au = f(u)$。可见，对于任意 $\alpha$，该通量族都满足一致性。其次，由于它对任意一对 $(u^-, u^+)$ 都给出一个唯一确定的值，它也满足守恒性的结构要求。

那么，如何确定参数 $\alpha$ 的值呢？我们可以引入一个额外的、基于物理对称性的要求。对于线性[平流](@entry_id:270026)，如果我们将平流速度反向（$a \to -a$）并交换左右状态（$u^- \leftrightarrow u^+$），那么通量的大小应该不变，方向相反。这个“翻转不变性”(flip-invariance) 可以表示为：
$$
\widehat{f}_{\alpha}(u^{-},u^{+};a) = - \widehat{f}_{\alpha}(u^{+},u^{-};-a)
$$
将通量表达式代入上式两侧，我们得到：
$$
a\left(\alpha\,u^{-} + (1-\alpha)\\,u^{+}\right) = - \left[ (-a)\left(\alpha\,u^{+} + (1-\alpha)\,u^{-}\right) \right] = a\left(\alpha\,u^{+} + (1-\alpha)\,u^{-}\right)
$$
对于 $a \neq 0$，化简后得到 $(2\alpha - 1)(u^- - u^+) = 0$。由于该式必须对任意 $u^-$ 和 $u^+$ 成立，我们必须有 $2\alpha - 1 = 0$，即 $\alpha = \frac{1}{2}$。

这个结果表明，附加的对称性要求唯一地确定了[通量形式](@entry_id:273811)，即**[中心通量](@entry_id:747204) (central flux)**：
$$
\widehat{f}(u^-, u^+) = a \frac{u^- + u^+}{2}
$$
这个简单的例子展示了基本原理如何指导和约束数值通量的具体设计。

#### [欧拉方程](@entry_id:177914)的 Roe 通量

对于像欧拉方程这样的[非线性方程组](@entry_id:178110)，[数值通量](@entry_id:752791)的设计要复杂得多，但基本原理依然适用。一个广泛使用的通量是 **Roe 通量**，它是一种[近似黎曼求解器](@entry_id:267136)。对于一维[欧拉方程](@entry_id:177914)，Roe 通量的形式为：
$$
\hat f(u_L,u_R) = \tfrac{1}{2}\big(f(u_L) + f(u_R)\big) - \tfrac{1}{2}\big|A(\tilde u)\big|\,(u_R - u_L)
$$
其中 $A(\tilde u)$ 是在特殊的 **Roe 平均态** $\tilde u$下计算的通量[雅可比矩阵](@entry_id:264467)，而 $|A|$ 表示矩阵的[绝对值](@entry_id:147688)。

我们来检验 Roe 通量是否满足基本公理：
1.  **一致性**：当 $u_L = u_R = u$ 时，跳跃项 $u_R - u_L$ 为零。因此，耗散项 $\tfrac{1}{2}|A(\tilde u)|(u_R - u_L)$ 消失，通量退化为 $\hat f(u,u) = \tfrac{1}{2}(f(u) + f(u)) = f(u)$。所以 Roe 通量是一致的。
2.  **守恒性**：对于给定的左右状态 $u_L$ 和 $u_R$，Roe 通量函数给出一个唯一的通量值。因此，在任何采用单值通量的 DG 或 FV 格式中，它都满足守恒性的结构要求。

Roe 通量的精妙之处在于 Roe 平均态 $\tilde u$ 的构造。这个平均态（通过对左右状态进行特定的加权平均得到，例如速度 $\tilde v = \frac{\sqrt{\rho_L}v_L + \sqrt{\rho_R}v_R}{\sqrt{\rho_L} + \sqrt{\rho_R}}$）使得通量差可以被精确地线性化，即满足所谓的 **Roe 性质**：$f(u_R) - f(u_L) = A(\tilde u)(u_R - u_L)$。正是这一性质使得 Roe 通量能够精确捕捉线性间断（如接触间断），从而成为一个高效且准确的工具。

### 超越守恒：[熵稳定性](@entry_id:749023)

对于[非线性](@entry_id:637147)守恒律，仅满足一致性和守恒性还不足以保证解收敛到物理上唯一的弱解。可能存在多个满足 Rankine-Hugoniot 条件的解，其中一些是“非物理的”（例如，在 Burgers 方程中出现膨胀激波）。为了排除这些非物理的解，需要引入一个附加的**[熵条件](@entry_id:166346)**。

在数值格式的层面上，这对应于研究**[熵稳定性](@entry_id:749023) (entropy stability)**。给定一个凸熵函数 $U(u)$ 及其对应的熵通量 $F(u)$，我们可以定义一个**[熵变](@entry_id:138294)量** $v(u) = \frac{dU}{du}$ 和一个**熵势** $\psi(u) = v(u)f(u) - F(u)$。一个数值通量 $\hat f$ 在界面上的[熵产](@entry_id:141771)出由下式给出：
$$
P(u_L, u_R) = \llbracket v \rrbracket \hat{f}(u_L, u_R) - \llbracket \psi \rrbracket = (v(u_R) - v(u_L))\hat{f} - (\psi(u_R) - \psi(u_L))
$$
- 如果对所有状态对 $(u_L, u_R)$ 都有 $P(u_L, u_R) = 0$，则称该通量是**[熵守恒](@entry_id:749018)的 (entropy conservative)**。
- 如果对所有状态对 $(u_L, u_R)$ 都有 $P(u_L, u_R) \le 0$，则称该通量是**熵稳定的 (entropy stable)**。

[熵稳定性](@entry_id:749023)是一个比[熵守恒](@entry_id:749018)更宽泛的条件，它允许数值格式产生耗散，以抑制非物理的[振荡](@entry_id:267781)并确保解趋向于满足[熵条件](@entry_id:166346)的弱解。

以 Burgers 方程 $f(u) = \frac{1}{2}u^2$ 和熵 $U(u) = \frac{1}{2}u^2$ 为例，可以推导出 $v(u) = u$ 和 $\psi(u) = \frac{1}{6}u^3$。基于此，我们可以分析具体的[数值通量](@entry_id:752791)：
- 通量 $\hat f(u_L,u_R) = \frac{u_L^2 + u_L u_R + u_R^2}{6}$ 满足 $P(u_L, u_R) = (u_R-u_L)\hat f - \frac{1}{6}(u_R^3 - u_L^3) = 0$，因此它是[熵守恒](@entry_id:749018)的。
- 在[熵守恒通量](@entry_id:749013)的基础上增加一个耗散项，例如 $\hat f(u_L,u_R) = \frac{u_L^2 + u_L u_R + u_R^2}{6} - \frac{\alpha}{2}(u_R - u_L)$，其中 $\alpha \ge 0$。其[熵产](@entry_id:141771)出为 $P(u_L, u_R) = -\frac{\alpha}{2}(u_R - u_L)^2$。由于 $\alpha \ge 0$ 且 $(u_R-u_L)^2 \ge 0$，熵产出总是非正的。因此，这个通量是熵稳定的。

总而言之，一致性和守恒性构成了设计任何可靠[数值通量](@entry_id:752791)的基石，而[熵稳定性](@entry_id:749023)等更高级的性质则为处理复杂的[非线性](@entry_id:637147)问题提供了必要的理论保障。理解这些原理是掌握现代数值方法，并在此基础上进行创新和发展的关键。