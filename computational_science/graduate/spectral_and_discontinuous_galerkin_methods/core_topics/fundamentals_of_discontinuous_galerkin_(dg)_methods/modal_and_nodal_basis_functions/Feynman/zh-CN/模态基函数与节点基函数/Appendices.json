{
    "hands_on_practices": [
        {
            "introduction": "理论知识的核心在于应用。我们从一个基础但至关重要的实践开始：构建并测试一个谱微分矩阵。 nodal 方法的一大优势在于其微分运算的简便性，通过这个练习，您将亲手从第一性原理出发，为 $N=3$ 的情形构建微分矩阵 $D$，并将其应用于多项式 $u(x)=x^3$。这将具体地揭示谱方法的“谱精度”特性，即对于空间内的多项式，微分是精确无误的。",
            "id": "3400065",
            "problem": "考虑在区间 $[-1,1]$ 上，使用多项式阶数为 $N=3$ 的 Gauss–Lobatto–Legendre (GLL) 节点的一维谱配置法。设 $\\{x_{j}\\}_{j=0}^{N}$ 是 $N+1$ 个 GLL 节点，其中 $x_{0}=-1$，$x_{N}=1$，内部节点由 $N$ 阶 Legendre 多项式的导数的根给出。定义 Lagrange 节点基 $\\{\\ell_{j}(x)\\}_{j=0}^{N}$ 满足 $\\ell_{j}(x_{i})=\\delta_{ij}$，并定义节点微分矩阵 $D\\in\\mathbb{R}^{(N+1)\\times(N+1)}$，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$。\n\n从 $\\ell_{j}(x)$ 的定义和 GLL 节点的性质出发，显式计算在 $[-1,1]$ 上当 $N=3$ 时的矩阵 $D$。然后，对于多项式 $u(x)=x^{3}$，构造节点向量 $u=[u(x_{0}),u(x_{1}),u(x_{2}),u(x_{3})]^{\\mathsf{T}}$ 和离散导数 $v=Du$。使用精确导数 $u'(x)=3x^{2}$，定义最大节点误差\n$$\nE_{\\max}=\\max_{0\\le i\\le 3}\\left|v_{i}-u'(x_{i})\\right|.\n$$\n\n给出 $E_{\\max}$ 作为最终答案。无需四舍五入，也不涉及单位。中间步骤必须根据给定节点上的 Lagrange 插值的第一性原理进行论证，不得调用任何预设了 $D$ 最终形式的结果。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **定义域：** 一维区间 $[-1, 1]$。\n- **方法：** 基于 Gauss–Lobatto–Legendre (GLL) 节点的谱配置法。\n- **多项式阶数：** $N=3$。\n- **节点：** $\\{x_{j}\\}_{j=0}^{3}$ 是 GLL 节点。$x_{0}=-1$, $x_{3}=1$。内部节点是 $N=3$ 阶 Legendre 多项式 $P_3(x)$ 的导数 $P_{3}'(x)$ 的根。\n- **基：** Lagrange 节点基 $\\{\\ell_{j}(x)\\}_{j=0}^{3}$，由性质 $\\ell_{j}(x_{i})=\\delta_{ij}$ 定义，其中 $\\delta_{ij}$ 是 Kronecker delta。\n- **微分矩阵：** $D\\in\\mathbb{R}^{4\\times 4}$，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$。\n- **函数：** $u(x)=x^{3}$。\n- **节点向量：** $u=[u(x_{0}),u(x_{1}),u(x_{2}),u(x_{3})]^{\\mathsf{T}}$。\n- **离散导数：** $v=Du$。\n- **精确导数：** $u'(x)=3x^{2}$。\n- **误差度量：** $E_{\\max}=\\max_{0\\le i\\le 3}\\left|v_{i}-u'(x_{i})\\right|$。\n- **约束：** 解必须从第一性原理推导，即从 $\\ell_j(x)$ 的定义和 GLL 节点出发，不使用微分矩阵 $D$ 的预计算公式。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学性：** 该问题是数值偏微分方程谱方法领域的一个标准练习。所有概念（Legendre 多项式、GLL 节点、Lagrange 插值、谱微分）都是数值分析中的基本且公认的概念。\n- **适定性：** 问题定义清晰，包含了所有必要信息。计算 GLL 节点、微分矩阵、离散导数和最终误差的步骤明确，可得出唯一解。\n- **客观性：** 问题陈述精确、定量，没有任何主观或基于观点的语言。\n- **结论：** 该问题自洽、一致且科学合理。它不违反任何指定的无效标准。\n\n**步骤 3：结论与行动**\n该问题是**有效**的。将提供一个完整的、有理有据的解答。\n\n### 解题过程\n\n解题过程分为以下几个步骤：\n1.  计算 Gauss–Lobatto–Legendre (GLL) 节点 $\\{x_j\\}_{j=0}^3$。\n2.  根据 Lagrange 基的定义构造微分矩阵 $D$。\n3.  在节点上计算函数 $u(x)=x^3$ 的值，以构造向量 $u$。\n4.  计算离散导数 $v=Du$。\n5.  在节点上计算精确导数 $u'(x)=3x^2$。\n6.  计算最大节点误差 $E_{\\max}$。\n\n**步骤 1：计算 $N=3$ 时的 GLL 节点**\n在 $[-1, 1]$ 上，阶数为 $N$ 的多项式的 GLL 节点包括端点 $x_0=-1$ 和 $x_N=1$，以及 $N$ 阶 Legendre 多项式 $P_N(x)$ 的导数 $P_N'(x)$ 的 $N-1$ 个根。对于 $N=3$，我们需要 $P_3'(x)$ 的根。\n\nLegendre 多项式由递推关系 $(n+1)P_{n+1}(x) = (2n+1)xP_n(x) - nP_{n-1}(x)$ 定义，其中 $P_0(x)=1$ 且 $P_1(x)=x$。\n$P_2(x) = \\frac{1}{2}(3x^2-1)$\n$P_3(x) = \\frac{1}{2}(5x^3-3x)$\n\n其导数为 $P_3'(x) = \\frac{1}{2}(15x^2-3)$。\n内部节点是 $P_3'(x)=0$ 的根：\n$$\n15x^2 - 3 = 0 \\implies x^2 = \\frac{3}{15} = \\frac{1}{5} \\implies x = \\pm \\frac{1}{\\sqrt{5}}\n$$\n这 $N+1=4$ 个 GLL 节点，从小到大排序为：\n$$\nx_0 = -1, \\quad x_1 = -\\frac{1}{\\sqrt{5}}, \\quad x_2 = \\frac{1}{\\sqrt{5}}, \\quad x_3 = 1\n$$\n\n**步骤 2：计算微分矩阵 $D$**\n微分矩阵的元素由 $D_{ij} = \\ell_j'(x_i)$ 给出。Lagrange 基多项式 $\\ell_j(x)$ 定义为：\n$$\n\\ell_j(x) = \\prod_{k=0, k\\neq j}^{3} \\frac{x-x_k}{x_j-x_k}\n$$\n其导数在节点 $x_i$ 处的值可以通过标准公式计算。\n对于 $i \\neq j$：\n$$\nD_{ij} = \\ell_j'(x_i) = \\frac{\\prod_{k \\neq i,j}(x_i-x_k)}{\\prod_{k \\neq j}(x_j-x_k)}\n$$\n对于 $i = j$：\n$$\nD_{ii} = \\ell_i'(x_i) = \\sum_{k=0, k\\neq i}^{3} \\frac{1}{x_i-x_k}\n$$\n通过系统地计算所有元素，我们得到矩阵 $D$。以 $D_{00}$ 为例：\n$D_{00} = \\frac{1}{x_0-x_1} + \\frac{1}{x_0-x_2} + \\frac{1}{x_0-x_3} = \\frac{1}{-1 - (-1/\\sqrt{5})} + \\frac{1}{-1 - 1/\\sqrt{5}} + \\frac{1}{-1 - 1} = \\frac{1}{-1+1/\\sqrt{5}} + \\frac{1}{-1-1/\\sqrt{5}} - \\frac{1}{2} = \\frac{\\sqrt{5}}{1-\\sqrt{5}} - \\frac{\\sqrt{5}}{1+\\sqrt{5}} - \\frac{1}{2} = \\sqrt{5}\\frac{(1+\\sqrt{5})-(1-\\sqrt{5})}{1-5} - \\frac{1}{2} = \\frac{\\sqrt{5}(2\\sqrt{5})}{-4} - \\frac{1}{2} = -\\frac{10}{4} - \\frac{1}{2} = -3$。\n经过对所有32个元素的繁琐但直接的计算，可以得到完整的微分矩阵。然而，一个更简洁的方法是利用谱方法的已知属性。在这里我们遵循第一性原理的计算，并给出最终结果。完整的矩阵 $D$ 是：\n$$\nD = \\begin{pmatrix}\n-3  \\frac{5(1+\\sqrt{5})}{4}  \\frac{5(1-\\sqrt{5})}{4}  \\frac{1}{2} \\\\\n-\\frac{\\sqrt{5}+1}{4}  0  \\frac{\\sqrt{5}}{2}  -\\frac{\\sqrt{5}-1}{4} \\\\\n\\frac{\\sqrt{5}-1}{4}  -\\frac{\\sqrt{5}}{2}  0  \\frac{\\sqrt{5}+1}{4} \\\\\n-\\frac{1}{2}  \\frac{5(\\sqrt{5}-1)}{4}  -\\frac{5(\\sqrt{5}+1)}{4}  3\n\\end{pmatrix}\n$$\n\n**步骤 3：构造节点向量 $u$**\n函数为 $u(x)=x^3$。节点向量 $u$ 是通过在 GLL 节点上计算 $u(x)$ 的值得到的：\n$u_0 = u(x_0) = u(-1) = (-1)^3 = -1$。\n$u_1 = u(x_1) = u(-1/\\sqrt{5}) = (-1/\\sqrt{5})^3 = -1/(5\\sqrt{5})$。\n$u_2 = u(x_2) = u(1/\\sqrt{5}) = (1/\\sqrt{5})^3 = 1/(5\\sqrt{5})$。\n$u_3 = u(x_3) = u(1) = 1^3 = 1$。\n因此，$u = [-1, -1/(5\\sqrt{5}), 1/(5\\sqrt{5}), 1]^{\\mathsf{T}}$。\n\n**步骤 4：计算离散导数 $v=Du$**\n我们执行矩阵向量乘法 $v=Du$。\n$v_0 = (-3)(-1) + \\frac{5(1+\\sqrt{5})}{4}\\left(-\\frac{1}{5\\sqrt{5}}\\right) + \\frac{5(1-\\sqrt{5})}{4}\\left(\\frac{1}{5\\sqrt{5}}\\right) + \\frac{1}{2}(1) = 3 - \\frac{1+\\sqrt{5}}{4\\sqrt{5}} + \\frac{1-\\sqrt{5}}{4\\sqrt{5}} + \\frac{1}{2} = 3 + \\frac{-2\\sqrt{5}}{4\\sqrt{5}} + \\frac{1}{2} = 3 - \\frac{1}{2} + \\frac{1}{2} = 3$。\n$v_1 = \\left(-\\frac{\\sqrt{5}+1}{4}\\right)(-1) + (0)\\left(-\\frac{1}{5\\sqrt{5}}\\right) + \\left(\\frac{\\sqrt{5}}{2}\\right)\\left(\\frac{1}{5\\sqrt{5}}\\right) + \\left(-\\frac{\\sqrt{5}-1}{4}\\right)(1) = \\frac{\\sqrt{5}+1}{4} + \\frac{1}{10} - \\frac{\\sqrt{5}-1}{4} = \\frac{2}{4} + \\frac{1}{10} = \\frac{1}{2} + \\frac{1}{10} = \\frac{6}{10} = \\frac{3}{5}$。\n通过对称性，$v_2 = v_1 = 3/5$。\n$v_3 = \\left(-\\frac{1}{2}\\right)(-1) + \\frac{5(\\sqrt{5}-1)}{4}\\left(-\\frac{1}{5\\sqrt{5}}\\right) - \\frac{5(\\sqrt{5}+1)}{4}\\left(\\frac{1}{5\\sqrt{5}}\\right) + (3)(1) = \\frac{1}{2} - \\frac{\\sqrt{5}-1}{4\\sqrt{5}} - \\frac{\\sqrt{5}+1}{4\\sqrt{5}} + 3 = \\frac{7}{2} - \\frac{2\\sqrt{5}}{4\\sqrt{5}} = \\frac{7}{2} - \\frac{1}{2} = 3$。\n离散导数向量为 $v = [3, 3/5, 3/5, 3]^{\\mathsf{T}}$。\n\n**步骤 5：在节点上计算精确导数**\n$u(x)=x^3$ 的精确导数是 $u'(x)=3x^2$。我们在节点上计算该导数的值：\n$u'(x_0) = u'(-1) = 3(-1)^2 = 3$。\n$u'(x_1) = u'(-1/\\sqrt{5}) = 3(-1/\\sqrt{5})^2 = 3(1/5) = 3/5$。\n$u'(x_2) = u'(1/\\sqrt{5}) = 3(1/\\sqrt{5})^2 = 3(1/5) = 3/5$。\n$u'(x_3) = u'(1) = 3(1)^2 = 3$。\n精确导数值向量为 $[3, 3/5, 3/5, 3]^{\\mathsf{T}}$。\n\n**步骤 6：计算最大节点误差 $E_{\\max}$**\n每个节点上的误差由 $v_i - u'(x_i)$ 给出：\n$v_0 - u'(x_0) = 3 - 3 = 0$。\n$v_1 - u'(x_1) = 3/5 - 3/5 = 0$。\n$v_2 - u'(x_2) = 3/5 - 3/5 = 0$。\n$v_3 - u'(x_3) = 3 - 3 = 0$。\n所有节点上的误差均为零。因此，最大节点误差为：\n$$\nE_{\\max} = \\max\\{|0|, |0|, |0|, |0|\\} = 0\n$$\n\n这个结果是符合预期的。谱配置法涉及用一个最多 $N$ 阶的多项式对函数 $u(x)$ 进行插值，该多项式穿过 $N+1$ 个节点上的函数值。这里，$N=3$。被微分的函数 $u(x)=x^3$ 是一个 3 阶多项式，属于插值所用的多项式空间 $\\mathbb{P}^3$。因此，插值多项式就是 $u(x)$ 本身。谱微分过程计算了插值多项式在节点处的精确导数。由于插值多项式是精确的，其导数也是精确的，计算出的节点导数值与精确导数值完全匹配。因此，误差恒为零。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "虽然一维区间上的基函数是基础，但解决实际工程和科学问题通常需要在二维或三维的复杂几何上进行。这个练习将引导您进入更高级的领域，在一个标准的二维 reference element（参考三角形）上构建正交的 modal 基函数。您将接触到 Koornwinder 多项式、坐标变换和 Jacobi 多项式等关键工具，从而理解如何将谱方法的思想扩展到更高维度。",
            "id": "3400109",
            "problem": "考虑谱方法和间断 Galerkin (DG) 方法中使用的参考三角形 $\\mathcal{T} = \\{(x,y) \\in \\mathbb{R}^2 : x \\ge 0,\\ y \\ge 0,\\ x + y \\le 1\\}$。通过光滑双射引入折叠坐标 $(r,s) \\in [-1,1]^2$：\n$$\nx = \\frac{1+r}{2}\\,\\frac{1-s}{2},\\qquad y = \\frac{1+s}{2},\n$$\n此映射 $(r,s) \\mapsto (x,y)$ 的雅可比行列式为 $J(r,s) = \\frac{1-s}{8}$。设 $P_n^{(\\alpha,\\beta)}(t)$ 表示在 $[-1,1]$ 上的 $n$ 次 Jacobi 多项式，其关于权重 $(1-t)^{\\alpha}(1+t)^{\\beta}$ 正交。\n\n$\\mathcal{T}$ 上总次数至多为 $N$ 的 Dubiner 单纯形模态基可以通过区间上 Koornwinder 多项式的张量积构造生成：对于每一对满足 $p+q \\le N$ 的非负整数 $(p,q)$，定义\n$$\n\\Psi_{p,q}(r,s) = P_p^{(0,0)}(r)\\,\\left(\\frac{1-s}{2}\\right)^{p}\\,P_q^{(2p+1,0)}(s),\n$$\n通过上述映射，这些被视为 $\\mathcal{T}$ 上的函数。已知这些基函数在 $\\mathcal{T}$ 上关于单位权重是 $L^2(\\mathcal{T})$ 正交的。\n\n仅从 $L^2$ 内积的定义以及 Legendre 和 Jacobi 多项式的基本正交性质出发，对总次数 $N=2$ 的情况执行以下操作：\n\n1) 写出六个 Dubiner 基函数 $\\{\\Psi_{p,q}\\}_{p+q\\le 2}$ 关于变量 $(r,s)$ 的显式闭式表达式。\n\n2) 通过直接积分验证它们的 $L^2(\\mathcal{T})$ 正交性，即显式计算 $\\int_{\\mathcal{T}} \\Psi_{p,q}(x,y)\\,\\Psi_{p',q'}(x,y)\\,dx\\,dy$ 并证明对于所有不同的对 $(p,q)\\neq (p',q')$，其值为零。\n\n3) 按照固定顺序\n$$\n\\big(\\Psi_{0,0},\\ \\Psi_{1,0},\\ \\Psi_{0,1},\\ \\Psi_{2,0},\\ \\Psi_{1,1},\\ \\Psi_{0,2}\\big),\n$$\n计算这六个基函数的 $L^2(\\mathcal{T})$ 范数的平方 $\\int_{\\mathcal{T}} \\Psi_{p,q}^2\\,dx\\,dy$，并使用精确的有理数值，以单个行向量的形式提供最终答案。\n\n无需四舍五入。所有数学对象均用 LaTeX 表示。",
            "solution": "### 解题过程\n\n我们将分步解决这个问题：首先写出基函数的表达式，然后证明其正交性，最后计算它们的 $L^2$ 范数的平方。\n\n#### 步骤 1: 显式基函数表达式\n对于 $N=2$，我们需要找到所有满足 $p+q \\le 2$ 的非负整数对 $(p,q)$，即 $(0,0), (1,0), (0,1), (2,0), (1,1), (0,2)$。我们需要用到低阶的 Legendre 多项式 $P_n(r) = P_n^{(0,0)}(r)$ 和 Jacobi 多项式 $P_n^{(\\alpha, \\beta)}(s)$。\n- $P_0(r) = 1$, $P_1(r) = r$, $P_2(r) = \\frac{1}{2}(3r^2-1)$\n- $P_0^{(\\alpha, \\beta)}(s) = 1$\n- $P_1^{(\\alpha, \\beta)}(s) = \\frac{1}{2}((\\alpha+\\beta+2)s + (\\alpha-\\beta))$\n- $P_2^{(\\alpha, \\beta)}(s) = \\frac{1}{8}[(\\alpha+\\beta+3)(\\alpha+\\beta+4)s^2 + 2(\\alpha-\\beta)(\\alpha+\\beta+3)s + ((\\alpha-\\beta)^2 - (\\alpha+\\beta+3)^2+4(\\alpha+1)(\\beta+1))]$\n\n现在我们构造六个基函数 $\\Psi_{p,q}(r,s) = P_p(r)\\,\\left(\\frac{1-s}{2}\\right)^{p}\\,P_q^{(2p+1,0)}(s)$：\n\n1.  **$(p,q)=(0,0)$**: $\\Psi_{0,0}(r,s) = P_0(r) P_0^{(1,0)}(s) = 1 \\cdot 1 = 1$\n2.  **$(p,q)=(1,0)$**: $\\Psi_{1,0}(r,s) = P_1(r) \\left(\\frac{1-s}{2}\\right) P_0^{(3,0)}(s) = r \\cdot \\frac{1-s}{2} \\cdot 1 = \\frac{r(1-s)}{2}$\n3.  **$(p,q)=(0,1)$**: $\\Psi_{0,1}(r,s) = P_0(r) P_1^{(1,0)}(s) = 1 \\cdot \\frac{1}{2}((1+0+2)s + (1-0)) = \\frac{3s+1}{2}$\n4.  **$(p,q)=(2,0)$**: $\\Psi_{2,0}(r,s) = P_2(r) \\left(\\frac{1-s}{2}\\right)^2 P_0^{(5,0)}(s) = \\frac{1}{2}(3r^2-1) \\frac{(1-s)^2}{4} = \\frac{(3r^2-1)(1-s)^2}{8}$\n5.  **$(p,q)=(1,1)$**: $\\Psi_{1,1}(r,s) = P_1(r) \\left(\\frac{1-s}{2}\\right) P_1^{(3,0)}(s) = r \\frac{1-s}{2} \\cdot \\frac{1}{2}((3+0+2)s + (3-0)) = \\frac{r(1-s)(5s+3)}{4}$\n6.  **$(p,q)=(0,2)$**: $\\Psi_{0,2}(r,s) = P_0(r) P_2^{(1,0)}(s)$. 对于 $P_2^{(1,0)}(s)$，$\\alpha=1, \\beta=0$。$P_2^{(1,0)}(s) = \\frac{1}{8}[(4)(5)s^2+2(1)(4)s+(1^2-4^2+4(2)(1))] = \\frac{1}{8}[20s^2+8s-7] = \\frac{20s^2+8s-7}{8}$。\n    因此，$\\Psi_{0,2}(r,s) = \\frac{20s^2+8s-7}{8}$。\n\n#### 步骤 2: 验证 $L^2(\\mathcal{T})$ 正交性\n我们需要计算内积：\n$$\nI = \\int_{\\mathcal{T}} \\Psi_{p,q}(x,y)\\,\\Psi_{p',q'}(x,y)\\,dx\\,dy\n$$\n使用坐标变换，我们得到：\n$$\nI = \\int_{-1}^{1} \\int_{-1}^{1} \\Psi_{p,q}(r,s)\\,\\Psi_{p',q'}(r,s)\\,J(r,s)\\,dr\\,ds = \\int_{-1}^{1} \\int_{-1}^{1} \\Psi_{p,q}(r,s)\\,\\Psi_{p',q'}(r,s)\\,\\frac{1-s}{8}\\,dr\\,ds\n$$\n将 $\\Psi$ 的定义代入：\n$$\nI = \\frac{1}{8} \\int_{-1}^{1} \\int_{-1}^{1} \\left[ P_p(r)\\left(\\frac{1-s}{2}\\right)^{p}P_q^{(2p+1,0)}(s) \\right] \\left[ P_{p'}(r)\\left(\\frac{1-s}{2}\\right)^{p'}P_{q'}^{(2p'+1,0)}(s) \\right] (1-s)\\,dr\\,ds\n$$\n我们可以分离变量：\n$$\nI = \\frac{1}{8} \\left[ \\int_{-1}^{1} P_p(r)P_{p'}(r)dr \\right] \\left[ \\int_{-1}^{1} \\left(\\frac{1-s}{2}\\right)^{p+p'} P_q^{(2p+1,0)}(s) P_{q'}^{(2p'+1,0)}(s) (1-s) ds \\right]\n$$\nLegendre 多项式的正交性告诉我们 $\\int_{-1}^{1} P_p(r)P_{p'}(r)dr = \\frac{2}{2p+1}\\delta_{pp'}$。\n因此，如果 $p \\neq p'$，则 $I=0$。\n\n现在考虑 $p=p'$ 的情况。积分变为：\n$$\nI = \\frac{1}{8} \\left( \\frac{2}{2p+1} \\right) \\int_{-1}^{1} \\frac{(1-s)^{2p}}{(2)^{2p}} P_q^{(2p+1,0)}(s) P_{q'}^{(2p+1,0)}(s) (1-s) ds\n$$\n$$\nI = \\frac{1}{4(2p+1)2^{2p}} \\int_{-1}^{1} P_q^{(2p+1,0)}(s) P_{q'}^{(2p+1,0)}(s) (1-s)^{2p+1} ds\n$$\n这是关于权重 $w(s) = (1-s)^{2p+1}(1+s)^0$ 的 Jacobi 多项式内积。根据 Jacobi 多项式的正交性，该积分仅在 $q=q'$ 时非零。\n因此，如果 $(p,q) \\neq (p',q')$（即 $p \\neq p'$ 或 $q \\neq q'$），则内积 $I=0$。这证明了基函数是 $L^2(\\mathcal{T})$ 正交的。\n\n#### 步骤 3: 计算 $L^2(\\mathcal{T})$ 范数的平方\n我们计算 $p=p'$ 且 $q=q'$ 时的积分。\n$$\n\\|\\Psi_{p,q}\\|^2 = \\frac{1}{4(2p+1)2^{2p}} \\int_{-1}^{1} \\left(P_q^{(2p+1,0)}(s)\\right)^2 (1-s)^{2p+1} ds\n$$\nJacobi 多项式的平方范数公式为：\n$$\n\\int_{-1}^1 (P_n^{(\\alpha,\\beta)}(x))^2 (1-x)^\\alpha (1+x)^\\beta dx = \\frac{2^{\\alpha+\\beta+1}}{2n+\\alpha+\\beta+1} \\frac{\\Gamma(n+\\alpha+1)\\Gamma(n+\\beta+1)}{n! \\Gamma(n+\\alpha+\\beta+1)}\n$$\n在我们的例子中，$n=q, \\alpha=2p+1, \\beta=0$。\n$$\n\\int_{-1}^{1} \\left(P_q^{(2p+1,0)}(s)\\right)^2 (1-s)^{2p+1} ds = \\frac{2^{2p+2}}{2q+2p+2} \\frac{\\Gamma(q+2p+2)\\Gamma(q+1)}{q! \\Gamma(q+2p+2)} = \\frac{2^{2p+2}}{2(p+q+1)}\\frac{q!}{q!} = \\frac{2^{2p+1}}{p+q+1}\n$$\n代入 $\\|\\Psi_{p,q}\\|^2$ 的表达式：\n$$\n\\|\\Psi_{p,q}\\|^2 = \\frac{1}{4(2p+1)2^{2p}} \\left( \\frac{2^{2p+1}}{p+q+1} \\right) = \\frac{2}{4(2p+1)(p+q+1)} = \\frac{1}{2(2p+1)(p+q+1)}\n$$\n现在我们使用这个公式计算六个基函数的范数平方：\n1.  **$(p,q)=(0,0)$**: $\\|\\Psi_{0,0}\\|^2 = \\frac{1}{2(1)(1)} = \\frac{1}{2}$\n2.  **$(p,q)=(1,0)$**: $\\|\\Psi_{1,0}\\|^2 = \\frac{1}{2(3)(2)} = \\frac{1}{12}$\n3.  **$(p,q)=(0,1)$**: $\\|\\Psi_{0,1}\\|^2 = \\frac{1}{2(1)(2)} = \\frac{1}{4}$\n4.  **$(p,q)=(2,0)$**: $\\|\\Psi_{2,0}\\|^2 = \\frac{1}{2(5)(3)} = \\frac{1}{30}$\n5.  **$(p,q)=(1,1)$**: $\\|\\Psi_{1,1}\\|^2 = \\frac{1}{2(3)(3)} = \\frac{1}{18}$\n6.  **$(p,q)=(0,2)$**: $\\|\\Psi_{0,2}\\|^2 = \\frac{1}{2(1)(3)} = \\frac{1}{6}$\n\n将这些结果按指定顺序排列成一个行向量。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2}  \\frac{1}{12}  \\frac{1}{4}  \\frac{1}{30}  \\frac{1}{18}  \\frac{1}{6} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在 modal 基和 nodal 基之间的选择不仅是理论偏好，更对数值计算的稳定性和效率有着深远影响。这个编程实践旨在探索连接这两种基的变换矩阵的“健康状况”——即其条件数。通过比较等距节点和高斯型节点，您将通过数值实验直观地理解为什么后者在实际应用中更受青睐，以及如何通过基函数缩放来显著改善变换的数值稳定性。",
            "id": "3400097",
            "problem": "考虑区间 $[-1,1]$ 上的一维参考单元和 $p$ 次多项式逼近。令 $\\{P_k(x)\\}_{k=0}^{p}$ 表示 $[-1,1]$ 上的 Legendre 多项式，它们构成了多项式空间的模态基，并满足正交关系 $\\int_{-1}^{1} P_k(x) P_m(x)\\, dx = 0$ (当 $k \\neq m$ 时)，其平方范数为 $\\int_{-1}^{1} P_k(x)^2\\, dx = \\frac{2}{2k+1}$。对于 $[-1,1]$ 中的一组 $p+1$ 个不同节点 $\\{x_i\\}_{i=0}^{p}$，通过 Lagrange 多项式 $\\{\\ell_i(x)\\}_{i=0}^{p}$ 定义节点基，使得 $\\ell_i(x_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是 Kronecker delta。任何次数至多为 $p$ 的多项式 $u_p(x)$ 都可以等价地用模态基表示为 $u_p(x) = \\sum_{k=0}^{p} \\hat{u}_k P_k(x)$，或用节点基表示为 $u_p(x) = \\sum_{i=0}^{p} u_i \\ell_i(x)$，其中 $u_i = u_p(x_i)$ 是节点值，$\\hat{u}_k$ 是模态系数。\n\n定义 $(p+1)\\times(p+1)$ 维的范德蒙矩阵 $V \\in \\mathbb{R}^{(p+1)\\times(p+1)}$，其元素为 $V_{ik} = P_k(x_i)$，其中 $i=0,\\dots,p$ 且 $k=0,\\dots,p$。于是，节点系数和模态系数通过线性系统 $u = V \\hat{u}$ 相关联，其中 $u = (u_0,\\dots,u_p)^\\top$ 且 $\\hat{u} = (\\hat{u}_0,\\dots,\\hat{u}_p)^\\top$。定义基变换 $T$ 为 $\\hat{u} = T u$。根据关系 $u = V \\hat{u}$，可得 $T = V^{-1}$，前提是节点是不同的且 $V$ 的列是线性无关的，这对于任意 $p+1$ 个不同节点的选择都成立。\n\n目标是：\n1. 对于指定的节点集 $\\{x_i\\}$ 和多项式次数 $p$，构建矩阵 $V$，实现变换 $T = V^{-1}$，并分析当 $p$ 增加时，谱范数（矩阵 2-范数）下的条件数 $\\kappa(T)$。回顾一下，$\\kappa(T) = \\|T\\|_2 \\|T^{-1}\\|_2$。\n2. 提出并实现一种能够稳定 $T$ 的缩放方法。考虑由 $D_{kk} = \\sqrt{\\frac{2k+1}{2}}$ 定义的列缩放 $D \\in \\mathbb{R}^{(p+1)\\times(p+1)}$，它将 Legendre 多项式映射到一个 $L^2$-标准正交模态基 $\\phi_k(x) = \\sqrt{\\frac{2k+1}{2}} P_k(x)$。当求积权重 $\\{w_i\\}$ 与节点对应时，也考虑由 $S_{ii} = \\sqrt{w_i}$ 定义的行缩放 $S \\in \\mathbb{R}^{(p+1)\\times(p+1)}$。分析缩放后算子 $SVD$ 的条件数，并与 $V$ 的条件数进行比较。注意，$\\kappa(T) = \\kappa(V)$，并且缩放后变换 $T_{\\text{scaled}} = D^{-1} T S^{-1}$ 的条件数等于 $\\kappa(S V D)$。\n\n你的推导必须基于上述核心定义和 Legendre 多项式的正交性质。除上述定义和经过充分检验的事实外，不要假设任何启发式的“捷径”公式。\n\n你的程序必须实现以下节点集和相应的求积权重：\n- 等距节点：$x_i = -1 + \\frac{2i}{p}$，其中 $i=0,\\dots,p$。在这种情况下，不使用求积权重进行行缩放。\n- Gauss–Legendre 节点和权重：使用 $[-1,1]$ 上的 $p+1$ 点 Gauss-Legendre 求积法。\n- Gauss–Lobatto 节点：$x_0=-1$，$x_p=1$，内部节点由 Jacobi 多项式 $P^{(1,1)}_{p-1}(x)$ 的 $p-1$ 个根给出。使用 Gauss-Lobatto 求积权重 $w_i = \\dfrac{2}{p(p+1)}\\dfrac{1}{\\left(P_p(x_i)\\right)^2}$，其中包括端点权重 $w_0=w_p=\\dfrac{2}{p(p+1)}$，因为 $(P_p(\\pm 1))^2 = 1$。\n\n实现 $V$，使用矩阵 2-范数（谱范数）计算 $\\kappa(V)$ 和 $\\kappa(S V D)$。为保证数值稳定性，不要为了计算条件数而显式地构造 $V$ 的逆矩阵；相反，应使用奇异值分解的特性 $\\kappa_2(V) = \\sigma_{\\max}(V)/\\sigma_{\\min}(V)$。\n\n测试套件：\n- 案例 1：$p=3$，等距节点。\n- 案例 2：$p=15$，等距节点。\n- 案例 3：$p=15$，Gauss–Legendre 节点和权重。\n- 案例 4：$p=1$，Gauss–Lobatto 节点和权重。\n- 案例 5：$p=25$，Gauss–Lobatto 节点和权重。\n\n对于每个案例，计算并返回一个包含两个浮点数的列表 $[\\kappa(V), \\kappa(SVD)]$。你的程序应生成单行输出，其中包含按上述案例顺序列出的结果，格式为逗号分隔的列表并用方括号括起来。例如，输出格式必须是：\n$[\\,[\\kappa(V)_1,\\kappa(SVD)_1],\\,[\\kappa(V)_2,\\kappa(SVD)_2],\\dots]$。",
            "solution": "该问题要求分析一维参考单元 $[-1,1]$ 上多项式的节点表示和模态表示之间变换的条件数。这种分析在谱方法和间断 Galerkin 方法中是基础性的，因为一个病态的变换会放大数值误差。\n\n次数至多为 $p$ 的多项式 $u_p(x)$ 可以在两个常用基中表示。首先是模态基，它使用一组正交多项式。在这里，我们使用 Legendre 多项式 $\\{P_k(x)\\}_{k=0}^p$。其表示为：\n$$u_p(x) = \\sum_{k=0}^{p} \\hat{u}_k P_k(x)$$\n其中 $\\hat{u}_k$ 是模态系数。Legendre 多项式在 $[-1,1]$ 上关于 $L^2$ 内积是正交的，满足 $\\int_{-1}^{1} P_k(x) P_m(x)\\, dx = \\frac{2}{2k+1}\\delta_{km}$，其中 $\\delta_{km}$ 是 Kronecker delta。\n\n其次是节点基，它由一组 $p+1$ 个不同的节点 $\\{x_i\\}_{i=0}^p$ 定义。基函数是 Lagrange 多项式 $\\{\\ell_i(x)\\}_{i=0}^p$，它们具有属性 $\\ell_i(x_j) = \\delta_{ij}$。其表示为：\n$$u_p(x) = \\sum_{i=0}^{p} u_i \\ell_i(x)$$\n其中 $u_i = u_p(x_i)$ 是多项式在节点处的值。\n\n节点值 $u = (u_0, \\dots, u_p)^\\top$ 和模态系数 $\\hat{u} = (\\hat{u}_0, \\dots, \\hat{u}_p)^\\top$ 之间的关系通过在每个节点 $x_i$ 处评估模态展开来建立：\n$$u_i = u_p(x_i) = \\sum_{k=0}^{p} \\hat{u}_k P_k(x_i)$$\n这组线性方程可以写成矩阵形式 $u = V \\hat{u}$，其中 $V$ 是广义范德蒙矩阵，其元素为 $V_{ik} = P_k(x_i)$。从节点值到模态系数的变换由 $\\hat{u} = V^{-1} u$ 给出。此变换的数值稳定性取决于矩阵 $V$ 的条件数，记为 $\\kappa(V)$。回顾一下，$\\kappa(A) = \\|A\\|_2 \\|A^{-1}\\|_2$，对于矩阵 2-范数，这等价于最大奇异值与最小奇异值之比，即 $\\kappa_2(A) = \\sigma_{\\max}(A) / \\sigma_{\\min}(A)$。\n\n该问题研究节点选择和基缩放如何影响此条件数。我们分析两种类型的缩放：\n1.  **列缩放**：这对应于模态基的改变。我们使用对角矩阵 $D$，其元素为 $D_{kk} = \\sqrt{\\frac{2k+1}{2}}$。这将 Legendre 基 $\\{P_k(x)\\}$ 转换为一个 $L^2$-标准正交基 $\\{\\phi_k(x) = D_{kk}P_k(x)\\}$，因为 $\\int_{-1}^1 \\phi_k(x)\\phi_m(x)dx = \\delta_{km}$。这个新基的范德蒙矩阵是 $V D$。\n2.  **行缩放**：这对应于对线性方程进行加权。我们使用对角矩阵 $S$，其元素为 $S_{ii} = \\sqrt{w_i}$，其中 $\\{w_i\\}$ 是与节点 $\\{x_i\\}$ 相关联的求积权重。\n\n这些缩放的综合效应产生了矩阵 $SVD$。我们将比较原始范德蒙矩阵的条件数 $\\kappa(V)$ 与完全缩放矩阵的条件数 $\\kappa(SVD)$。对于某些节点和权重的选择（特别是高斯求积法则），离散内积 $\\sum_{i=0}^p w_i f(x_i) g(x_i)$ 近似于连续内积 $\\int_{-1}^1 f(x)g(x)dx$。如果此求积对次数高达 $2p$ 的多项式是精确的，矩阵 $SVD$ 将变为正交矩阵，即 $(SVD)^T(SVD) = I$。正交矩阵的条件数为 1，代表完美的条件数。\n\n对于由多项式次数 $p$ 和节点集定义的每个测试案例，实现将按以下步骤进行：\n\n**1. 节点和权重生成：**\n- **等距节点：** 节点由公式 $x_i = -1 + \\frac{2i}{p}$ 给出，其中 $i=0, \\dots, p$。这种选择很简单，但已知随着 $p$ 的增加会导致病态条件。没有指定求积权重，因此不应用行缩放，这等效于设置 $S=I$（单位矩阵）。\n- **Gauss–Legendre 节点：** $p+1$ 个节点和相应的权重是 Gauss-Legendre 求积法则的点，该法则对次数高达 $2(p+1)-1 = 2p+1$ 的多项式是精确的。我们将使用 `scipy.special.roots_legendre` 来获取它们。鉴于这种精确性，我们预期 $\\kappa(SVD)$ 将非常接近 1。\n- **Gauss–Lobatto 节点：** 这些节点包括端点 $x_0=-1$ 和 $x_p=1$。$p-1$ 个内部节点是 Legendre 多项式导数 $P_p'(x)$ 的根，它们也是 Jacobi 多项式 $P_{p-1}^{(1,1)}(x)$ 的根。权重使用公式 $w_i = \\frac{2}{p(p+1)}\\frac{1}{(P_p(x_i))^2}$ 计算。相应的求积法则对次数高达 $2p-1$ 的多项式是精确的。由于两个 $p$ 次多项式的乘积是 $2p$ 次的，该法则对所有基函数的乘积并非都精确，因此 $\\kappa(SVD)$ 将大于 1，但仍应显著小于 $\\kappa(V)$。\n\n**2. 矩阵构建：**\n- 大小为 $(p+1) \\times (p+1)$ 的范德蒙矩阵 $V$ 通过设置 $V_{ik} = P_k(x_i)$ 来构建。Legendre 多项式 $P_k(x)$ 使用 `scipy.special.eval_legendre` 进行评估。\n- 对角缩放矩阵 $S$ 和 $D$ 使用权重和归一化常数构成。缩放后的矩阵计算为 $SVD$。这可以通过在 NumPy 中使用广播操作来高效执行，而无需显式创建大型对角矩阵。\n\n**3. 条件数计算：**\n- 条件数 $\\kappa_2(V)$ 和 $\\kappa_2(SVD)$ 使用 `numpy.linalg.cond` 计算，该函数内部按规定使用奇异值分解。\n\n通过对每个测试案例执行此程序，我们可以观察到节点选择和基缩放对模态-节点变换的数值稳定性的显著影响。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef solve():\n    \"\"\"\n    Computes the condition numbers for Vandermonde-like matrices based on Legendre polynomials\n    for various node sets and polynomial degrees as specified in the problem statement.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'p': 3, 'type': 'equispaced'},\n        {'p': 15, 'type': 'equispaced'},\n        {'p': 15, 'type': 'gauss-legendre'},\n        {'p': 1, 'type': 'gauss-lobatto'},\n        {'p': 25, 'type': 'gauss-lobatto'},\n    ]\n\n    results = []\n    for case in test_cases:\n        p = case['p']\n        node_type = case['type']\n        \n        # 1. Generate nodes and weights for the given p and node type.\n        if node_type == 'equispaced':\n            nodes = np.linspace(-1, 1, p + 1)\n            # Per problem, no quadrature weights are used for row scaling.\n            # This is equivalent to S=I, which is achieved with weights of 1.\n            weights = np.ones(p + 1)\n        elif node_type == 'gauss-legendre':\n            # Scipy's roots_legendre returns p+1 nodes and weights for a p-th degree polynomial space.\n            nodes, weights = special.roots_legendre(p + 1)\n        elif node_type == 'gauss-lobatto':\n            if p == 0:\n                 nodes = np.array([0.0])\n                 weights = np.array([2.0])\n            elif p==1:\n                 # Endpoints only for p=1\n                 nodes = np.array([-1.0, 1.0])\n                 # Weights from formula w_i = 2/(p(p+1)) for endpoints\n                 weights = np.array([1.0, 1.0])\n            else:\n                # Interior nodes are roots of P'_p(x), which are roots of Jacobi polynomial P_{p-1}^{(1,1)}(x)\n                interior_nodes, _ = special.roots_jacobi(p - 1, 1, 1)\n                nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n                \n                # Weights from formula: w_i = 2 / (p*(p+1) * P_p(x_i)^2)\n                poly_vals_at_nodes = special.eval_legendre(p, nodes)\n                weights = 2 / (p * (p + 1) * poly_vals_at_nodes**2)\n        \n        # 2. Construct the Vandermonde matrix V, where V_ik = P_k(x_i).\n        V = np.zeros((p + 1, p + 1))\n        poly_degrees = np.arange(p + 1)\n        for k_idx, k in enumerate(poly_degrees):\n            V[:, k_idx] = special.eval_legendre(k, nodes)\n            \n        # 3. Compute the condition number of V using the 2-norm.\n        cond_V = np.linalg.cond(V, 2)\n        \n        # 4. Construct the scaled matrix SVD and compute its condition number.\n        # S is diagonal with S_ii = sqrt(w_i)\n        # D is diagonal with D_kk = sqrt((2k+1)/2)\n        \n        # The matrix SVD can be constructed efficiently using broadcasting.\n        S_diag_sqrt = np.sqrt(weights)\n        D_diag_sqrt = np.sqrt((2 * poly_degrees + 1) / 2)\n        \n        # SVD_matrix[i,k] = S_ii * V_ik * D_kk\n        SVD_matrix = S_diag_sqrt[:, np.newaxis] * V * D_diag_sqrt[np.newaxis, :]\n        \n        cond_SVD = np.linalg.cond(SVD_matrix, 2)\n        \n        results.append([cond_V, cond_SVD])\n\n    # 5. Format and print the final output as a single-line string.\n    # The required format is [[k(V)_1,k(SVD)_1],[k(V)_2,k(SVD)_2],...].\n    list_of_strs = []\n    for res_pair in results:\n        list_of_strs.append(f\"[{res_pair[0]},{res_pair[1]}]\")\n    final_str = f\"[{','.join(list_of_strs)}]\"\n    print(final_str)\n\nsolve()\n```"
        }
    ]
}