{
    "hands_on_practices": [
        {
            "introduction": "The mass matrix is a fundamental object in finite and spectral element methods, representing the inner product of basis functions. For an orthogonal basis like Legendre polynomials, the mass matrix becomes diagonal, which dramatically simplifies computations. This exercise  reinforces the connection between the abstract property of orthogonality and the concrete, computationally advantageous structure of the mass matrix, providing a deeper understanding of why basis choice is critical in spectral methods.",
            "id": "3398525",
            "problem": "Consider the one-dimensional reference element $[-1,1]$ used in spectral methods and Discontinuous Galerkin (DG) methods. Let $\\{P_{n}(x)\\}_{n=0}^{p}$ denote the Legendre modal basis on $[-1,1]$, where $P_{n}(x)$ is the Legendre polynomial of degree $n$ normalized so that $P_{n}(1)=1$. The mass matrix $\\mathbf{M}$ associated with this basis is defined by the entries\n$$\nM_{mn} \\equiv \\int_{-1}^{1} P_{m}(x)\\,P_{n}(x)\\,\\mathrm{d}x,\n$$\nfor $0 \\le m,n \\le p$. Starting from the fundamental characterization of Legendre polynomials as eigenfunctions of a self-adjoint Sturm–Liouville operator with unit weight on $[-1,1]$, and using the Rodrigues’ formula,\n$$\nP_{n}(x) = \\frac{1}{2^{n} n!}\\,\\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\big( x^{2}-1 \\big)^{n},\n$$\nderive the exact symbolic expression for $M_{mn}$ in closed form. Your final answer must be a single analytic expression that gives $M_{mn}$ explicitly as a function of $m$ and $n$ (and may involve the Kronecker delta). No numerical approximation or rounding is required.",
            "solution": "The task is to derive the closed-form expression for the entries of the mass matrix $\\mathbf{M}$, defined as\n$$\nM_{mn} \\equiv \\int_{-1}^{1} P_{m}(x)\\,P_{n}(x)\\,\\mathrm{d}x\n$$\nwhere $P_n(x)$ are the Legendre polynomials on the interval $[-1,1]$, normalized such that $P_n(1)=1$. The derivation will proceed by considering two cases: $m \\neq n$ and $m = n$.\n\nThe problem statement directs us to use the characterization of Legendre polynomials as eigenfunctions of a Sturm-Liouville operator. The Legendre polynomials $P_n(x)$ are solutions to Legendre's differential equation:\n$$\n(1-x^2)\\frac{\\mathrm{d}^2 y}{\\mathrm{d}x^2} - 2x\\frac{\\mathrm{d}y}{\\mathrm{d}x} + n(n+1)y = 0\n$$\nThis equation can be written in the self-adjoint Sturm-Liouville form:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left[ (1-x^2)\\frac{\\mathrm{d}y}{\\mathrm{d}x} \\right] + n(n+1)y = 0\n$$\nThis corresponds to a Sturm-Liouville problem on the interval $[-1,1]$ with the operator $\\mathcal{L}[y] = \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left[ (1-x^2)\\frac{\\mathrm{d}y}{\\mathrm{d}x} \\right]$, weight function $w(x)=1$, and eigenvalues $\\lambda_n = -n(n+1)$. The Legendre polynomials $P_n(x)$ are the eigenfunctions of this operator.\n\nA fundamental property of self-adjoint Sturm-Liouville operators is that eigenfunctions corresponding to distinct eigenvalues are orthogonal with respect to the weight function. For the Legendre polynomials $P_m(x)$ and $P_n(x)$ with $m \\neq n$, their corresponding eigenvalues $\\lambda_m = -m(m+1)$ and $\\lambda_n = -n(n+1)$ are distinct. Therefore, they are orthogonal on $[-1,1]$ with weight $w(x)=1$. This directly implies that their inner product is zero:\n$$\nM_{mn} = \\int_{-1}^{1} P_{m}(x)\\,P_{n}(x)\\,\\mathrm{d}x = 0 \\quad \\text{for } m \\neq n\n$$\n\nNext, we consider the case where $m=n$. The integral becomes:\n$$\nM_{nn} = \\int_{-1}^{1} \\left( P_{n}(x) \\right)^2 \\,\\mathrm{d}x\n$$\nTo evaluate this integral, we use the provided Rodrigues' formula for Legendre polynomials:\n$$\nP_{n}(x) = \\frac{1}{2^{n} n!}\\,\\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\big( (x^{2}-1)^{n} \\big)\n$$\nSubstituting one of the $P_n(x)$ factors in the integral with its Rodrigues' formula representation gives:\n$$\nM_{nn} = \\int_{-1}^{1} P_{n}(x) \\left( \\frac{1}{2^{n} n!} \\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\big( (x^{2}-1)^{n} \\big) \\right) \\,\\mathrm{d}x\n$$\nWe apply integration by parts $n$ times. The general formula is $\\int_{a}^{b} u \\,\\mathrm{d}v = [uv]_{a}^{b} - \\int_{a}^{b} v \\,\\mathrm{d}u$. Let $u = P_n(x)$ and $\\mathrm{d}v = \\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\big( (x^{2}-1)^{n} \\big) \\,\\mathrm{d}x$. Then $v = \\frac{\\mathrm{d}^{n-1}}{\\mathrm{d}x^{n-1}}\\big( (x^{2}-1)^{n} \\big)$.\nThe boundary term is $\\left[ P_n(x) \\frac{\\mathrm{d}^{n-1}}{\\mathrm{d}x^{n-1}}\\big( (x^{2}-1)^{n} \\big) \\right]_{-1}^{1}$. The function $(x^2-1)^n$ and its first $n-1$ derivatives are zero at the endpoints $x=\\pm 1$. This is because $(x^2-1)^n=(x-1)^n(x+1)^n$, so for any $k<n$, the $k$-th derivative $\\frac{\\mathrm{d}^k}{\\mathrm{d}x^k}(x^2-1)^n$ will contain factors of $(x-1)^{n-k}$ and $(x+1)^{n-k}$, making it vanish at $x=\\pm 1$. Thus, the boundary term is zero.\nAfter one integration by parts, we have:\n$$\nM_{nn} = \\frac{1}{2^n n!} \\left( -\\int_{-1}^{1} \\frac{\\mathrm{d}P_{n}(x)}{\\mathrm{d}x} \\frac{\\mathrm{d}^{n-1}}{\\mathrm{d}x^{n-1}}\\big( (x^{2}-1)^{n} \\big) \\,\\mathrm{d}x \\right)\n$$\nRepeating this process $n$ times, where the boundary term vanishes at each step, yields:\n$$\nM_{nn} = \\frac{(-1)^{n}}{2^n n!} \\int_{-1}^{1} \\frac{\\mathrm{d}^{n}P_{n}(x)}{\\mathrm{d}x^{n}} \\big( (x^{2}-1)^{n} \\big) \\,\\mathrm{d}x\n$$\n$P_n(x)$ is a polynomial of degree $n$. Its $n$-th derivative, $\\frac{\\mathrm{d}^{n}P_{n}(x)}{\\mathrm{d}x^{n}}$, is a constant. To find this constant, we find the leading term of $P_n(x)$ from the Rodrigues' formula:\n$$\nP_{n}(x) = \\frac{1}{2^{n} n!} \\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\big( x^{2n} - n x^{2n-2} + \\dots \\big) = \\frac{1}{2^{n} n!} \\left( \\frac{(2n)!}{n!} x^n - \\dots \\right)\n$$\nThe leading coefficient of $P_n(x)$ is $\\frac{(2n)!}{2^n (n!)^2}$. The $n$-th derivative of $P_n(x)$ is therefore:\n$$\n\\frac{\\mathrm{d}^{n}P_{n}(x)}{\\mathrm{d}x^{n}} = \\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}} \\left( \\frac{(2n)!}{2^n (n!)^2} x^n \\right) = \\frac{(2n)!}{2^n (n!)^2} n! = \\frac{(2n)!}{2^n n!}\n$$\nSubstituting this constant back into the integral for $M_{nn}$:\n$$\nM_{nn} = \\frac{(-1)^{n}}{2^n n!} \\left( \\frac{(2n)!}{2^n n!} \\right) \\int_{-1}^{1} (x^{2}-1)^{n} \\,\\mathrm{d}x = \\frac{(-1)^{n} (2n)!}{(2^n n!)^2} \\int_{-1}^{1} (x^{2}-1)^{n} \\,\\mathrm{d}x\n$$\nThe remaining integral is $I_n = \\int_{-1}^{1} (x^2-1)^n \\,\\mathrm{d}x$. We can evaluate this using a recurrence relation derived from integration by parts:\n$I_n = \\int_{-1}^{1} (x^2-1)^n \\cdot 1 \\,\\mathrm{d}x$. Let $u=(x^2-1)^n$ and $\\mathrm{d}v=\\mathrm{d}x$. Then $\\mathrm{d}u=n(x^2-1)^{n-1}(2x)\\,\\mathrm{d}x$ and $v=x$.\n$$\nI_n = \\left[x(x^2-1)^n\\right]_{-1}^1 - \\int_{-1}^1 x \\cdot n(x^2-1)^{n-1}(2x)\\,\\mathrm{d}x = 0 - 2n \\int_{-1}^1 x^2(x^2-1)^{n-1}\\,\\mathrm{d}x\n$$\nWe rewrite $x^2$ as $(x^2-1)+1$:\n$$\nI_n = -2n \\int_{-1}^1 ((x^2-1)+1)(x^2-1)^{n-1}\\,\\mathrm{d}x = -2n \\left( \\int_{-1}^1 (x^2-1)^n\\,\\mathrm{d}x + \\int_{-1}^1 (x^2-1)^{n-1}\\,\\mathrm{d}x \\right)\n$$\n$$\nI_n = -2n (I_n + I_{n-1}) \\implies (1+2n)I_n = -2n I_{n-1} \\implies I_n = -\\frac{2n}{2n+1} I_{n-1}\n$$\nThe base case is $I_0 = \\int_{-1}^{1} (x^2-1)^0\\,\\mathrm{d}x = \\int_{-1}^{1} 1\\,\\mathrm{d}x = 2$.\nUnrolling the recurrence:\n$$\nI_n = \\left(-\\frac{2n}{2n+1}\\right)\\left(-\\frac{2(n-1)}{2n-1}\\right) \\cdots \\left(-\\frac{2(1)}{3}\\right) I_0 = (-1)^n \\frac{2^n n!}{(2n+1)!!} \\cdot 2\n$$\nUsing $(2n+1)!! = \\frac{(2n+1)!}{(2n)!!} = \\frac{(2n+1)!}{2^n n!}$:\n$$\nI_n = (-1)^n \\frac{2^{n+1} n! (2^n n!)}{(2n+1)!} = (-1)^n \\frac{2^{2n+1} (n!)^2}{(2n+1)!}\n$$\nNow substitute this result for $I_n$ back into the expression for $M_{nn}$:\n$$\nM_{nn} = \\frac{(-1)^{n} (2n)!}{(2^n n!)^2} \\left( (-1)^n \\frac{2^{2n+1} (n!)^2}{(2n+1)!} \\right) = \\frac{(-1)^{2n} (2n)!}{2^{2n} (n!)^2} \\frac{2^{2n+1} (n!)^2}{(2n+1)!}\n$$\n$$\nM_{nn} = \\frac{(2n)!}{(2n+1)!} \\cdot \\frac{2^{2n+1}}{2^{2n}} = \\frac{1}{2n+1} \\cdot 2 = \\frac{2}{2n+1}\n$$\nCombining both cases ($m \\neq n$ and $m=n$) using the Kronecker delta, $\\delta_{mn}$, which is $1$ if $m=n$ and $0$ if $m \\neq n$, we obtain the final expression for the mass matrix entries:\n$$\nM_{mn} = \\frac{2}{2n+1}\\,\\delta_{mn}\n$$\nSince the matrix is symmetric, the expression is also equal to $\\frac{2}{2m+1}\\delta_{mn}$. Both are equivalent as the term is non-zero only when $m=n$.",
            "answer": "$$ \\boxed{ \\frac{2}{2n+1}\\,\\delta_{mn} } $$"
        },
        {
            "introduction": "Following the mass matrix, the stiffness matrix is the next crucial component, typically arising from the discretization of second-order differential operators like the Laplacian. The stiffness matrix entries involve integrals of the products of the derivatives of basis functions, capturing the operator's differential nature. This hands-on calculation for a low-degree polynomial basis  makes the abstract definition of the stiffness matrix tangible, offering direct practice in assembling this key operator.",
            "id": "3398573",
            "problem": "Consider the one-dimensional Poisson operator with unit diffusion coefficient on the reference element $[-1,1]$. In a spectral/discontinuous Galerkin formulation, the local stiffness matrix $\\mathbf{K}$ associated with a polynomial basis $\\{\\phi_{i}(x)\\}_{i=0}^{p}$ is defined from the bilinear form of the weak statement as $K_{ij} = \\int_{-1}^{1} \\frac{d \\phi_{i}}{d x}(x) \\frac{d \\phi_{j}}{d x}(x) \\, dx$. Let $\\{\\phi_{0}, \\phi_{1}, \\phi_{2}\\}$ be the degree-$p$ Legendre basis on $[-1,1]$ with $p=2$, where $\\phi_{n}(x) = P_{n}(x)$ and $P_{n}(x)$ denotes the standard Legendre polynomial of degree $n$ on $[-1,1]$ satisfying the orthogonality relation $\\int_{-1}^{1} P_{m}(x) P_{n}(x) \\, dx = \\frac{2}{2n+1} \\delta_{mn}$. Using exact quadrature (i.e., exact evaluation of the defining integrals), compute the local stiffness matrix $\\mathbf{K}$ and list its entries in the order $\\{P_{0}, P_{1}, P_{2}\\}$. Your final answer must be the full $3 \\times 3$ matrix as a single closed-form analytic expression. No rounding is required.",
            "solution": "The task is to compute the local stiffness matrix $\\mathbf{K}$ for the one-dimensional Poisson operator on the reference element $[-1, 1]$. The entries of the stiffness matrix are defined by the integral:\n$$\nK_{ij} = \\int_{-1}^{1} \\frac{d \\phi_{i}}{d x}(x) \\frac{d \\phi_{j}}{d x}(x) \\, dx\n$$\nThe basis functions $\\{\\phi_{i}\\}_{i=0}^{2}$ are chosen to be the standard Legendre polynomials $\\{P_{i}\\}_{i=0}^{2}$ on the interval $[-1, 1]$. We are considering the basis set for $p=2$, which consists of $\\{P_{0}(x), P_{1}(x), P_{2}(x)\\}$.\n\nFirst, we list the required Legendre polynomials and their derivatives. The first three standard Legendre polynomials are:\n$$\n\\phi_{0}(x) = P_{0}(x) = 1\n$$\n$$\n\\phi_{1}(x) = P_{1}(x) = x\n$$\n$$\n\\phi_{2}(x) = P_{2}(x) = \\frac{1}{2}(3x^2 - 1)\n$$\nNext, we compute the derivatives of these basis functions with respect to $x$:\n$$\n\\frac{d \\phi_{0}}{d x} = \\frac{d P_{0}}{d x} = 0\n$$\n$$\n\\frac{d \\phi_{1}}{d x} = \\frac{d P_{1}}{d x} = 1\n$$\n$$\n\\frac{d \\phi_{2}}{d x} = \\frac{d P_{2}}{d x} = \\frac{d}{dx} \\left( \\frac{1}{2}(3x^2 - 1) \\right) = \\frac{1}{2}(6x) = 3x\n$$\n\nNow, we can compute the $3 \\times 3$ entries of the stiffness matrix $\\mathbf{K}$ using the integral definition. The matrix is symmetric, i.e., $K_{ij} = K_{ji}$, so we only need to compute the upper triangular entries.\n\nFor $i=0$:\nSince $\\frac{d \\phi_{0}}{dx} = 0$, all entries in the first row and first column of the matrix will be zero.\n$$\nK_{00} = \\int_{-1}^{1} (0)(0) \\, dx = 0\n$$\n$$\nK_{01} = \\int_{-1}^{1} (0)(1) \\, dx = 0\n$$\n$$\nK_{02} = \\int_{-1}^{1} (0)(3x) \\, dx = 0\n$$\nBy symmetry, $K_{10} = K_{01} = 0$ and $K_{20} = K_{02} = 0$.\n\nFor $i=1$:\n$$\nK_{11} = \\int_{-1}^{1} \\left( \\frac{d \\phi_{1}}{d x} \\right)^2 \\, dx = \\int_{-1}^{1} (1)^2 \\, dx = \\int_{-1}^{1} 1 \\, dx = [x]_{-1}^{1} = 1 - (-1) = 2\n$$\n$$\nK_{12} = \\int_{-1}^{1} \\frac{d \\phi_{1}}{d x} \\frac{d \\phi_{2}}{d x} \\, dx = \\int_{-1}^{1} (1)(3x) \\, dx = 3 \\int_{-1}^{1} x \\, dx = 3 \\left[ \\frac{x^2}{2} \\right]_{-1}^{1} = 3 \\left( \\frac{1^2}{2} - \\frac{(-1)^2}{2} \\right) = 0\n$$\nBy symmetry, $K_{21} = K_{12} = 0$.\n\nFor $i=2$:\n$$\nK_{22} = \\int_{-1}^{1} \\left( \\frac{d \\phi_{2}}{d x} \\right)^2 \\, dx = \\int_{-1}^{1} (3x)^2 \\, dx = 9 \\int_{-1}^{1} x^2 \\, dx = 9 \\left[ \\frac{x^3}{3} \\right]_{-1}^{1} = 9 \\left( \\frac{1^3}{3} - \\frac{(-1)^3}{3} \\right) = 9 \\left( \\frac{1}{3} - \\left(-\\frac{1}{3}\\right) \\right) = 9 \\left( \\frac{2}{3} \\right) = 6\n$$\nAlternatively, for $K_{22}$, we can use the orthogonality property of Legendre polynomials. Note that $\\frac{d \\phi_{2}}{dx} = 3x = 3P_{1}(x)$.\n$$\nK_{22} = \\int_{-1}^{1} (3 P_{1}(x))(3 P_{1}(x)) \\, dx = 9 \\int_{-1}^{1} P_{1}(x) P_{1}(x) \\, dx\n$$\nUsing the given orthogonality relation $\\int_{-1}^{1} P_{m}(x) P_{n}(x) \\, dx = \\frac{2}{2n+1} \\delta_{mn}$, with $m=n=1$:\n$$\n\\int_{-1}^{1} P_{1}(x) P_{1}(x) \\, dx = \\frac{2}{2(1)+1} = \\frac{2}{3}\n$$\nTherefore, $K_{22} = 9 \\times \\frac{2}{3} = 6$, which confirms our direct integration result.\n\nAssembling the matrix $\\mathbf{K}$ with the computed entries:\n$$\n\\mathbf{K} =\n\\begin{pmatrix}\nK_{00} & K_{01} & K_{02} \\\\\nK_{10} & K_{11} & K_{12} \\\\\nK_{20} & K_{21} & K_{22}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 & 0 & 0 \\\\\n0 & 2 & 0 \\\\\n0 & 0 & 6\n\\end{pmatrix}\n$$\nThis is the local stiffness matrix for the basis $\\{P_0, P_1, P_2\\}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & 0 \\\\\n0 & 2 & 0 \\\\\n0 & 0 & 6\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving beyond static operators, we now consider discretizing time-dependent problems like the advection equation, which introduces the convection matrix. The stability of such numerical schemes is deeply tied to algebraic properties like skew-symmetry, which can be broken by inexact numerical quadrature in a phenomenon known as aliasing. This coding practice  demonstrates how computational shortcuts—like using an insufficient quadrature rule—can violate fundamental conservation laws and lead to non-physical results, a critical lesson in the interplay between numerical theory and implementation.",
            "id": "3398522",
            "problem": "Consider the one-dimensional linear advection equation on the interval $[-1,1]$ with periodic boundary conditions,\n$$\n\\partial_t u(x,t) + \\partial_x u(x,t) = 0,\n$$\nand its spectral Galerkin semi-discretization in a modal Legendre basis $\\{\\phi_i(x)\\}_{i=0}^p$, where $\\phi_i(x)$ is the $i$-th Legendre polynomial on $[-1,1]$. Let $u_h(x,t) = \\sum_{j=0}^p \\hat{u}_j(t)\\,\\phi_j(x)$ denote the spectral approximation with coefficients $\\hat{u}_j(t)$.\n\nDefine the mass matrix $M \\in \\mathbb{R}^{(p+1)\\times(p+1)}$ and the convection (stiffness) matrix $K\\in \\mathbb{R}^{(p+1)\\times(p+1)}$ by the Galerkin weak form\n$$\nM_{ij} = \\int_{-1}^{1} \\phi_i(x)\\,\\phi_j(x)\\,dx,\\qquad\nK_{ij} = \\int_{-1}^{1} \\phi_i(x)\\,\\partial_x \\phi_j(x)\\,dx,\n$$\nand set the semi-discrete operator $C = M^{-1}K$. The semi-discrete system reads\n$$\n\\frac{d\\hat{\\mathbf{u}}}{dt} + C\\,\\hat{\\mathbf{u}} = 0,\\quad \\hat{\\mathbf{u}}(0) = \\hat{\\mathbf{u}}_0.\n$$\n\nIn exact arithmetic with exact integration of $M$ and $K$, periodic boundary conditions imply the $M$-skew property\n$$\nM C + C^\\top M = \\mathbf{0},\n$$\nand hence the discrete $L^2$ energy $E(t) = \\tfrac{1}{2}\\,\\hat{\\mathbf{u}}(t)^\\top M\\,\\hat{\\mathbf{u}}(t)$ is conserved, i.e., $\\frac{dE}{dt} = 0$. However, if $K$ is assembled using an inexact quadrature rule, the $M$-skew property generally fails, which can lead to spurious growth or decay of the discrete energy.\n\nYour task is to demonstrate quadrature aliasing in the spectral Galerkin method by assembling $M$ with an exact quadrature rule of order $Q_M = p+1$ (Gauss–Legendre) and assembling $K$ with a possibly inexact quadrature rule of order $Q_K \\in \\mathbb{N}$. Use the following steps:\n\n- Use Gauss–Legendre quadrature of order $Q$ to approximate any integral $\\int_{-1}^1 f(x)\\,dx$ by $\\sum_{q=1}^{Q} w_q\\,f(x_q)$, where $\\{x_q,w_q\\}_{q=1}^Q$ are the Gauss–Legendre nodes and weights.\n- Assemble $M$ using $Q_M = p+1$ to ensure exactness for the polynomial mass integrals.\n- Assemble $K$ using a variable rule $Q_K$ (which may be less than $p+1$), to purposefully introduce inexactness and hence aliasing in the convection operator.\n- Define $C = M^{-1}K$.\n- Choose the initial condition $u(x,0) = \\sin(\\pi x)$ and compute its $L^2$ projection coefficients $\\hat{\\mathbf{u}}_0$ by solving $M\\,\\hat{\\mathbf{u}}_0 = \\mathbf{b}$ with $b_i = \\int_{-1}^1 \\phi_i(x)\\,u(x,0)\\,dx$. Use a sufficiently high quadrature order $Q_{\\text{proj}} = 2p+5$ to approximate these projection integrals.\n- Evolve the ordinary differential equation system in time with the explicit fourth-order Runge-Kutta (RK4) method up to final time $T$. Choose a time step $\\Delta t$ based on the spectral radius $\\rho(C)$ such that $\\Delta t = \\text{CFL}/\\max(\\rho(C),\\varepsilon)$ with $\\text{CFL} = 0.1$ and $\\varepsilon = 10^{-14}$; use a fixed number of steps $N = \\lceil T/\\Delta t \\rceil$ and adjust $\\Delta t$ to exactly reach $T$.\n- Measure the relative energy error at time $T$ using a high-order energy evaluation mass matrix $M_{\\text{en}}$ assembled with $Q_{\\text{en}}=2p+5$ and the formula\n$$\n\\mathcal{E}_{\\text{rel}} = \\frac{\\tfrac{1}{2}\\,\\hat{\\mathbf{u}}(T)^\\top M_{\\text{en}}\\,\\hat{\\mathbf{u}}(T) - \\tfrac{1}{2}\\,\\hat{\\mathbf{u}}(0)^\\top M_{\\text{en}}\\,\\hat{\\mathbf{u}}(0)}{\\tfrac{1}{2}\\,\\hat{\\mathbf{u}}(0)^\\top M_{\\text{en}}\\,\\hat{\\mathbf{u}}(0)}.\n$$\n\nImplement a program that, for each test case $(p,Q_K,T)$ below, constructs $M$ with $Q_M=p+1$, constructs $K$ with the specified $Q_K$, forms $C=M^{-1}K$, projects the initial data, advances the system with the fourth-order Runge–Kutta method to time $T$, and returns $\\mathcal{E}_{\\text{rel}}$ as a floating-point number.\n\nUse the following test suite:\n- Test $1$: $(p,Q_K,T) = (0,1,0.1)$.\n- Test $2$: $(p,Q_K,T) = (3,2,0.2)$.\n- Test $3$: $(p,Q_K,T) = (7,5,0.2)$.\n- Test $4$: $(p,Q_K,T) = (7,8,0.2)$.\n- Test $5$: $(p,Q_K,T) = (9,6,0.15)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[\\text{result}_1,\\text{result}_2,\\dots]$, where each entry is the value of $\\mathcal{E}_{\\text{rel}}$ for the corresponding test case listed in order. No additional text should be printed.",
            "solution": "We begin from the Galerkin weak form for the one-dimensional advection equation $\\partial_t u + \\partial_x u = 0$ on the interval $[-1,1]$ with periodic boundary conditions. Using a modal Legendre basis $\\{\\phi_i\\}_{i=0}^p$, the semi-discrete approximation $u_h(x,t) = \\sum_{j=0}^p \\hat{u}_j(t)\\,\\phi_j(x)$ enforces\n$$\n\\int_{-1}^{1} \\phi_i(x)\\,\\partial_t u_h(x,t)\\,dx + \\int_{-1}^{1} \\phi_i(x)\\,\\partial_x u_h(x,t)\\,dx = 0,\\quad \\forall i\\in\\{0,\\dots,p\\}.\n$$\nUsing linearity and defining the mass and convection matrices,\n$$\nM_{ij} = \\int_{-1}^{1} \\phi_i(x)\\,\\phi_j(x)\\,dx,\\qquad\nK_{ij} = \\int_{-1}^{1} \\phi_i(x)\\,\\partial_x \\phi_j(x)\\,dx,\n$$\nwe find the ordinary differential equation for the coefficient vector $\\hat{\\mathbf{u}}(t)$:\n$$\nM\\,\\frac{d\\hat{\\mathbf{u}}}{dt} + K\\,\\hat{\\mathbf{u}} = 0\\quad\\Longleftrightarrow\\quad \\frac{d\\hat{\\mathbf{u}}}{dt} + C\\,\\hat{\\mathbf{u}} = 0,\\quad C = M^{-1}K.\n$$\nWhen $M$ and $K$ are computed with exact integration and periodic boundary conditions, integration by parts yields $K = -S$ with $S_{ij}=\\int_{-1}^1 \\partial_x \\phi_i(x)\\,\\phi_j(x)\\,dx$, hence\n$$\n(M C + C^\\top M) = (K + K^\\top) = \\left(\\int \\phi_i\\,\\partial_x\\phi_j + \\int \\phi_j\\,\\partial_x\\phi_i\\right)_{ij} = \\left(\\int \\partial_x(\\phi_i\\,\\phi_j)\\right)_{ij} = \\mathbf{0},\n$$\nwhich implies $M$-skew-adjointness of $C$ and discrete energy conservation in the $M$-inner product. The discrete energy $E(t) = \\tfrac{1}{2}\\hat{\\mathbf{u}}^\\top M \\hat{\\mathbf{u}}$ then satisfies\n$$\n\\frac{dE}{dt} = \\hat{\\mathbf{u}}^\\top M \\frac{d\\hat{\\mathbf{u}}}{dt} = -\\hat{\\mathbf{u}}^\\top M C \\hat{\\mathbf{u}} = -\\tfrac{1}{2}\\,\\hat{\\mathbf{u}}^\\top (M C + C^\\top M)\\,\\hat{\\mathbf{u}} = 0.\n$$\nHowever, if $K$ is assembled with an inexact quadrature, $K$ is perturbed to $\\tilde{K}$ and $C$ to $\\tilde{C} = M^{-1}\\tilde{K}$; the exact $M$-skew property is generally lost:\n$$\nM \\tilde{C} + \\tilde{C}^\\top M = \\tilde{K} + \\tilde{K}^\\top \\neq \\mathbf{0},\n$$\nso that\n$$\n\\frac{dE}{dt} = -\\tfrac{1}{2}\\,\\hat{\\mathbf{u}}^\\top \\left(M \\tilde{C} + \\tilde{C}^\\top M\\right)\\,\\hat{\\mathbf{u}} \\neq 0,\n$$\nwhich yields spurious growth or decay of energy. This is the essence of quadrature aliasing: nonlinear or mixed products evaluated with insufficient quadrature inject components outside the finite-dimensional polynomial space, which re-enter the discrete space incorrectly upon projection, breaking invariants tied to exact adjointness or symmetry.\n\nAlgorithmic construction:\n\n- Basis and quadrature. We choose the Legendre basis $\\phi_i = P_i$, where $P_i$ is the $i$-th Legendre polynomial on $[-1,1]$. For any quadrature order $Q$, the Gauss–Legendre nodes and weights $\\{x_q,w_q\\}_{q=1}^Q$ integrate polynomials of degree up to $2Q-1$ exactly.\n\n- Mass matrix. To ensure an invertible and accurate mass matrix, we assemble $M$ with $Q_M = p+1$, so that any product $\\phi_i\\,\\phi_j$ (degree at most $2p$) is integrated exactly. Numerically,\n$$\nM_{ij} \\approx \\sum_{q=1}^{Q_M} w_q\\,\\phi_i(x_q)\\,\\phi_j(x_q).\n$$\n\n- Convection matrix. We introduce inexactness by assembling $K$ with a potentially lower quadrature order $Q_K$:\n$$\nK_{ij} \\approx \\sum_{q=1}^{Q_K} w_q\\,\\phi_i(x_q)\\,\\partial_x \\phi_j(x_q).\n$$\nIf $Q_K < p+1$, then the degree-$2p-1$ integrands in $K$ are not integrated exactly, and aliasing errors arise.\n\n- Semi-discrete operator. We form $C = M^{-1}K$ by solving $M C = K$ for $C$.\n\n- Initial condition and projection. We set $u(x,0)=\\sin(\\pi x)$ and compute its $L^2$ projection onto the span of $\\{\\phi_i\\}_{i=0}^p$:\n$$\nb_i = \\int_{-1}^1 \\phi_i(x)\\,u(x,0)\\,dx\\approx \\sum_{q=1}^{Q_{\\text{proj}}} w_q\\,\\phi_i(x_q)\\,u(x_q,0),\n$$\nwith $Q_{\\text{proj}}=2p+5$, and then solve $M\\,\\hat{\\mathbf{u}}_0 = \\mathbf{b}$.\n\n- Time stepping. We solve $\\frac{d\\hat{\\mathbf{u}}}{dt} = -C\\,\\hat{\\mathbf{u}}$ using the fourth-order explicit Runge–Kutta method. To mitigate time discretization error and avoid instability, we select a step size based on the spectral radius $\\rho(C)$:\n$$\n\\Delta t = \\frac{\\text{CFL}}{\\max(\\rho(C),\\varepsilon)},\\quad \\text{CFL} = 0.1,\\ \\varepsilon=10^{-14},\n$$\ntake $N=\\lceil T/\\Delta t\\rceil$ steps, and adjust $\\Delta t=T/N$ to reach the final time exactly.\n\n- Energy measurement. To quantify energy drift robustly, we evaluate the energy with a high-order mass matrix $M_{\\text{en}}$ assembled using $Q_{\\text{en}}=2p+5$:\n$$\nE(0) = \\tfrac{1}{2}\\,\\hat{\\mathbf{u}}_0^\\top M_{\\text{en}}\\,\\hat{\\mathbf{u}}_0,\\quad E(T) = \\tfrac{1}{2}\\,\\hat{\\mathbf{u}}(T)^\\top M_{\\text{en}}\\,\\hat{\\mathbf{u}}(T),\n$$\nand report the relative error $\\mathcal{E}_{\\text{rel}} = \\frac{E(T)-E(0)}{E(0)}$.\n\nTest design and coverage:\n\n- Test $1$: $(p,Q_K,T)=(0,1,0.1)$. Here $\\phi_0$ is constant, $\\partial_x \\phi_0=0$, thus $K=\\mathbf{0}$ regardless of $Q_K$ and $\\mathcal{E}_{\\text{rel}}=0$ up to round-off, serving as a boundary case.\n\n- Test $2$: $(p,Q_K,T)=(3,2,0.2)$. The mass is exact, while $K$ is under-integrated ($Q_K<p+1$), yielding non-$M$-skew operator and visible energy drift.\n\n- Test $3$: $(p,Q_K,T)=(7,5,0.2)$. Higher degree with stronger aliasing effects; expect noticeable energy growth or decay.\n\n- Test $4$: $(p,Q_K,T)=(7,8,0.2)$. Exactness restored ($Q_K=p+1$) so that $M C + C^\\top M \\approx \\mathbf{0}$; expect $\\mathcal{E}_{\\text{rel}}$ near machine and time-stepping error levels.\n\n- Test $5$: $(p,Q_K,T)=(9,6,0.15)$. High degree with substantial under-integration, demonstrating increased sensitivity to quadrature aliasing.\n\nThe program constructs all matrices, performs the projection and time stepping, and prints a single line containing $[\\mathcal{E}_{\\text{rel}}^{(1)},\\dots,\\mathcal{E}_{\\text{rel}}^{(5)}]$ in that order, thereby measuring energy error versus quadrature order and demonstrating that inexact quadrature for the convection matrix destroys the $M$-skew property and induces spurious energy drift.",
            "answer": "```python\nimport numpy as np\n\ndef gauss_legendre(n):\n    # Gauss-Legendre nodes and weights on [-1,1]\n    x, w = np.polynomial.legendre.leggauss(n)\n    return x, w\n\ndef legendre_and_derivative_values(p, x):\n    # Evaluate Legendre polynomials P_0..P_p and their derivatives at points x\n    # Returns arrays of shape (p+1, len(x))\n    x = np.asarray(x)\n    vals = np.zeros((p + 1, x.size))\n    ders = np.zeros((p + 1, x.size))\n    for i in range(p + 1):\n        P = np.polynomial.legendre.Legendre.basis(i)\n        dP = P.deriv()\n        vals[i, :] = P(x)\n        ders[i, :] = dP(x)\n    return vals, ders\n\ndef assemble_mass(p, Q):\n    # Assemble mass matrix M using Gauss-Legendre quadrature of order Q\n    xq, wq = gauss_legendre(Q)\n    V, _ = legendre_and_derivative_values(p, xq)\n    # M = V W V^T\n    M = V @ (wq[:, None] * V.T)\n    return M\n\ndef assemble_stiffness_K(p, QK):\n    # Assemble convection (stiffness) matrix K_ij = ∫ phi_i * d(phi_j)/dx dx\n    xq, wq = gauss_legendre(QK)\n    V, dV = legendre_and_derivative_values(p, xq)\n    K = V @ (wq[:, None] * dV.T)\n    return K\n\ndef project_initial_condition(p, Qproj, u_func):\n    # Compute L2 projection coefficients of u_func onto span{phi_0..phi_p}\n    xq, wq = gauss_legendre(Qproj)\n    V, _ = legendre_and_derivative_values(p, xq)\n    uvals = u_func(xq)\n    # b_i = ∫ phi_i * u dx ≈ sum wq * phi_i(xq) * u(xq)\n    b = V @ (wq * uvals)\n    # Mass matrix for projection (exact for polynomials if Qproj large)\n    Mproj = V @ (wq[:, None] * V.T)\n    coeffs = np.linalg.solve(Mproj, b)\n    return coeffs\n\ndef rk4_linear(C, u0, dt, nsteps):\n    u = u0.copy()\n    for _ in range(nsteps):\n        k1 = -C @ u\n        k2 = -C @ (u + 0.5 * dt * k1)\n        k3 = -C @ (u + 0.5 * dt * k2)\n        k4 = -C @ (u + dt * k3)\n        u = u + (dt / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n    return u\n\ndef energy(u, M):\n    return 0.5 * float(u.T @ (M @ u))\n\ndef solve_case(p, QK, T):\n    # Assemble mass with exact quadrature QM = p+1\n    QM = p + 1\n    M = assemble_mass(p, QM)\n    # Assemble stiffness with possibly inexact quadrature QK\n    K = assemble_stiffness_K(p, QK)\n    # Operator C = M^{-1} K\n    C = np.linalg.solve(M, K)\n    # Initial condition u(x,0) = sin(pi x)\n    u_func = lambda x: np.sin(np.pi * x)\n    Qproj = max(2 * p + 5, 10)\n    u0 = project_initial_condition(p, Qproj, u_func)\n    # Energy evaluation mass matrix with high-order quadrature\n    Men = assemble_mass(p, Qproj)\n    E0 = energy(u0, Men)\n    # Time step based on spectral radius\n    if p == 0:\n        rho = 0.0\n    else:\n        eigvals = np.linalg.eigvals(C)\n        rho = float(np.max(np.abs(eigvals))) if eigvals.size > 0 else 0.0\n    CFL = 0.1\n    eps = 1e-14\n    dt = CFL / max(rho, eps)\n    nsteps = max(1, int(np.ceil(T / dt)))\n    dt = T / nsteps\n    # Time integration\n    uT = rk4_linear(C, u0, dt, nsteps)\n    ET = energy(uT, Men)\n    rel_err = (ET - E0) / E0 if E0 != 0.0 else 0.0\n    return rel_err\n\ndef solve():\n    # Define the test cases (p, QK, T)\n    test_cases = [\n        (0, 1, 0.1),\n        (3, 2, 0.2),\n        (7, 5, 0.2),\n        (7, 8, 0.2),\n        (9, 6, 0.15),\n    ]\n    results = []\n    for p, QK, T in test_cases:\n        rel_err = solve_case(p, QK, T)\n        results.append(rel_err)\n    # Print in exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}