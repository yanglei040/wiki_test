{
    "hands_on_practices": [
        {
            "introduction": "我们从任何显式时间积分方案最基本的问题开始：如何选择一个稳定的时间步长。本练习将引导您对应用于线性平流问题的间断伽辽金 (DG) 方法进行一次经典的稳定性分析 。通过从第一性原理推导 Courant–Friedrichs–Lewy (CFL) 条件，您将深刻理解空间离散的属性（如多项式阶数 $p$ 和网格尺寸 $h$）如何与时间积分器的稳定域相互作用，从而对时间步长 $\\Delta t$ 施加约束。",
            "id": "3385750",
            "problem": "考虑周期区间 $[0,L]$ 上的一维线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中平流速度 $a \\in \\mathbb{R}\\setminus\\{0\\}$ 为常数。在尺寸为 $h = L/N$ 的均匀网格上，使用次数为 $p \\ge 0$ 的多项式，通过间断 Galerkin (DG) 方法进行空间离散，并采用迎风数值通量。将 DG 半离散解记为 $u_{h}(x,t)$，块对角质量矩阵和全局空间算子分别记为 $M$ 和 $A$，这样半离散系统可以写作 $M\\,\\dot{\\mathbf{u}} = A\\,\\mathbf{u}$，或者等价地写作 $\\dot{\\mathbf{u}} = \\mathcal{L}\\,\\mathbf{u}$，其中 $\\mathcal{L} = M^{-1}A$。\n\n从 DG 弱形式以及通过在每个单元上选择测试函数 $v = u_{h}$ 得到的 $L^{2}$ 能量恒等式出发，使用均匀网格上多项式的标准一维迹不等式和反不等式（特别是在每个单元 $K$ 上的迹反不等式，形式为 $|v(x_{K}^{\\pm})|^{2} \\le \\frac{2p+1}{h}\\,\\|v\\|_{L^{2}(K)}^{2}$，其中 $v \\in \\mathbb{P}_{p}(K)$），来证明在 $L^{2}$ 诱导范数下，算子范数界的形式为 $\\|\\mathcal{L}\\| \\lesssim \\frac{(2p+1)|a|}{h}$。结论是，为了满足线性稳定性，显式时间步长 $\\Delta t$ 必须满足 $\\Delta t \\le \\frac{C}{(2p+1)}\\frac{h}{|a|}$ 的尺度关系，其中无量纲常数 $C$ 仅由所选显式时间积分器的线性稳定区域的形状决定。\n\n现在选择经典的显式四阶 Runge-Kutta 方法（也称为 RK4），其线性稳定函数为多项式 $R(z) = 1 + z + \\frac{z^{2}}{2} + \\frac{z^{3}}{6} + \\frac{z^{4}}{24}$。使用测试方程 $y' = \\lambda y$ 的线性稳定性定义，以及对于迎风 DG 平流，谱 $\\Delta t\\,\\mathcal{L}$ 的相关部分包含于闭左半平面这一事实，确定最大的实数 $C > 0$，使得在负实轴上的区间 $[-C, 0]$ 内，均有 $|R(z)| \\le 1$。这个 $C$ 是保证由 RK4 推进的 DG 半离散格式线性稳定的精确（sharp）实轴常数，此时 $\\Delta t \\le C\\,\\frac{h}{(2p+1)|a|}$。\n\n这个常数 $C$ 的数值是多少？将您的答案四舍五入到六位有效数字。仅报告 $C$ 的值（无量纲）。",
            "solution": "用户提供了一个分为两部分的问题。第一部分，证明线性平流方程的间断 Galerkin (DG) 离散格式的稳定性约束。第二部分，计算与此问题相关的四阶 Runge-Kutta (RK4) 方法稳定性的一个特定常数。\n\n该问题被认为是有效的，因为它在偏微分方程数值分析领域有科学依据，是适定的且具有唯一答案，并使用清晰、客观的语言。所有提供的信息要么是标准的，要么是作为推导中使用的前提给出的。\n\n### 第 1 部分：时间步长尺度关系的证明\n\n给定在周期域上的一维线性平流方程 $u_t + a u_x = 0$，它在尺寸为 $h$ 的均匀网格上使用次数为 $p$ 的多项式通过 DG 方法进行空间离散。其半离散系统为 $\\dot{\\mathbf{u}} = \\mathcal{L}\\mathbf{u}$。\n\n为使显式时间步进格式稳定，必须选择时间步长 $\\Delta t$，以使得对于空间算子 $\\mathcal{L}$ 的所有特征值 $\\lambda$，数值 $z = \\Delta t \\lambda$ 都位于时间积分器的线性稳定区域内。这施加了一个形式为 $\\Delta t |\\lambda|_{\\max} \\le C_S$ 的约束，其中 $|\\lambda|_{\\max}$ 是 $\\mathcal{L}$ 的谱半径，而 $C_S$ 是由稳定区域边界决定的常数。谱半径受算子范数限制，即 $|\\lambda|_{\\max} \\le \\|\\mathcal{L}\\|$。因此，稳定性的一个充分条件是 $\\Delta t \\le C_S / \\|\\mathcal{L}\\|$。\n\n问题要求在 $L^2$ 诱导范数下证明尺度关系 $\\|\\mathcal{L}\\| \\lesssim \\frac{(2p+1)|a|}{h}$。我们来简要论证一下。算子 $\\mathcal{L}$ 是通过 DG 弱形式定义的。对于 DG 空间中的任意函数 $u_h, v_h$，与空间算子部分相关的双线性形式为：\n$$ (\\mathcal{A} u_h, v_h) = \\sum_{j} \\left( \\int_{K_j} a u_h (v_h)_x dx - \\left[ a \\hat{u}_h v_h \\right]_{\\partial K_j} \\right) $$\n其中 $\\mathbf{u}$ 是 $u_h$ 的系数，$A$ 是 $\\mathcal{A}$ 的矩阵表示，且 $\\mathcal{L} = M^{-1}A$。$\\mathcal{L}$ 的 $L^2$ 诱导范数为 $\\|\\mathcal{L}\\| = \\sup_{u_h \\neq 0} \\frac{\\|\\mathcal{L}u_h\\|_{L^2}}{\\|u_h\\|_{L^2}}$。为了界定这个范数，我们界定双线性形式 $|(\\mathcal{A} u_h, v_h)|$。对单元求和进行分部积分，将表达式转换为涉及 $u_h$ 的导数和 $u_h$ 在界面处跳跃的形式。对于迎风通量，这会得到：\n$$ (\\mathcal{A} u_h, v_h) = -a \\sum_j \\left( \\int_{K_j} (u_h)_x v_h dx + [u_h]_{j-1/2} v_h(x_{j-1/2}^+) \\right) $$\n其中 $[u_h] = u_h^+ - u_h^-$ 是跳跃。我们使用 Cauchy-Schwarz 不等式、标准的导数反不等式以及给定的迹不等式来界定其绝对值。\n\n第一项使用导数的反不等式 $\\|(u_h)_x\\|_{L^2(K_j)} \\le C_I \\frac{p^2}{h} \\|u_h\\|_{L^2(K_j)}$ 来界定，其贡献了一个 $\\mathcal{O}(p^2/h)$ 阶的项。第二项，即界面上的求和，使用对求和的 Cauchy-Schwarz 不等式和给定的迹不等式 $|w(x_{K}^{\\pm})|^{2} \\le \\frac{2p+1}{h}\\|w\\|_{L^{2}(K)}^{2}$ 来界定。\n$$ \\left| \\sum_j [u_h]_{j-1/2} v_h(x_{j-1/2}^+) \\right| \\le \\left(\\sum_j |[u_h]|^2\\right)^{1/2} \\left(\\sum_j |v_h^+|^2\\right)^{1/2} $$\n迹不等式给出 $\\sum_j |v_h(x_{j-1/2}^+)|^2 \\le \\frac{2p+1}{h} \\|v_h\\|^2_{L^2}$。跳跃项 $\\sum_j |[u_h]|^2$ 也可以被某个常数 $C$ 界定为 $C \\frac{2p+1}{h} \\|u_h\\|^2_{L^2}$。将这些结合起来表明，边界项对 $|(\\mathcal{A}u_h, v_h)|$ 的贡献被一个与 $|a| \\frac{2p+1}{h} \\|u_h\\|_{L^2}\\|v_h\\|_{L^2}$ 成正比的量所界定。\n\n尽管完整的证明显示了导数项带来的 $p^2/h$ 依赖关系，但对于线性平流问题，算子范数由来自单元间通量耦合的低阶项主导。因此，尺度关系 $\\|\\mathcal{L}\\| \\lesssim \\frac{(2p+1)|a|}{h}$ 由给定的迹不等式证明是合理的，该不等式直接引入了因子 $(2p+1)/h$。因此，稳定性约束变为 $\\Delta t \\lesssim \\frac{h}{(2p+1)|a|}$，这与问题中给出的形式相匹配。\n\n### 第 2 部分：RK4 稳定性常数的计算\n\n给定经典的 RK4 方法，其稳定函数为 $R(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!}$。为了线性稳定，我们需要对 $z=\\Delta t \\lambda$ 满足 $|R(z)| \\le 1$，其中 $\\lambda$ 是 $\\mathcal{L}$ 的任意特征值。问题指出，相关谱位于负实轴上。因此，我们必须确定 RK4 在负实轴上的稳定区间，即最大的区间 $[ -C, 0 ]$，使得对于所有 $x \\in [-C, 0]$，都有 $|R(x)| \\le 1$。我们需要找到这个值 $C$。\n\n令 $x = -y$，其中 $y \\ge 0$。我们需要找到最大的 $C>0$，使得对所有 $y \\in [0, C]$，都有 $|R(-y)| \\le 1$。我们来分析函数 $f(y) = R(-y)$：\n$$ f(y) = 1 - y + \\frac{y^2}{2} - \\frac{y^3}{6} + \\frac{y^4}{24} $$\n条件是对于 $y \\in [0, C]$，有 $|f(y)| \\le 1$。\n在 $y=0$ 处，$f(0)=1$，因此条件成立。我们来研究当 $y>0$ 时 $f(y)$ 的行为。其一阶导数为：\n$$ f'(y) = -1 + y - \\frac{y^2}{2} + \\frac{y^3}{6} $$\n其二阶导数为：\n$$ f''(y) = 1 - y + \\frac{y^2}{2} $$\n二次式 $f''(y)$ 的判别式为 $(-1)^2 - 4(\\frac{1}{2})(1) = 1-2 = -1  0$。由于首项系数为正，所以对于所有 $y \\in \\mathbb{R}$，$f''(y)  0$。这意味着 $f(y)$ 是一个严格凸函数。\n\n由于 $f(0)=1$ 且 $f'(0)=-1$，函数初始时是递减的。因为 $f(y)$ 是凸函数，它将递减到一个唯一的全局最小值，然后递增。我们来求这个最小值。最小值出现在 $f'(y)=0$ 处，这等价于求解 $y^3 - 3y^2 + 6y - 6 = 0$。数值求解可得根 $y_0 \\approx 1.596$。在这一点，函数值为 $f(y_0) \\approx 0.180$。由于最小值为正，所以对于所有 $y \\ge 0$，$f(y)  0$。因此，稳定性条件 $|f(y)| \\le 1$ 简化为 $f(y) \\le 1$。\n\n我们知道 $f(0)=1$。函数从这一点开始递减，然后递增。稳定极限 $C$ 将是使 $f(y)$ 返回到 $1$ 的第一个正值 $y$。我们需要求解 $f(C)=1$：\n$$ 1 - C + \\frac{C^2}{2} - \\frac{C^3}{6} + \\frac{C^4}{24} = 1 $$\n$$ - C + \\frac{C^2}{2} - \\frac{C^3}{6} + \\frac{C^4}{24} = 0 $$\n因为我们寻找的是 $C0$，我们可以用 $C$ 除以上式：\n$$ -1 + \\frac{C}{2} - \\frac{C^2}{6} + \\frac{C^3}{24} = 0 $$\n两边乘以 $24$ 以消去分母，得到关于 $C$ 的多项式方程：\n$$ C^3 - 4C^2 + 12C - 24 = 0 $$\n这个方程有一个实根。我们可以通过数值方法找到它。使用牛顿法或计算求解器，我们找到根为：\n$$ C \\approx 2.78529156... $$\n问题要求将此值四舍五入到六位有效数字。\n\n因此，使得对于所有 $y \\in [0,C]$ 都有 $|R(-y)| \\le 1$ 的最大实数 $C$ 约为 $2.78529$。这个值是经典 RK4 方法的实轴稳定极限。",
            "answer": "$$\\boxed{2.78529}$$"
        },
        {
            "introduction": "隐式方法提供了无条件稳定性的优势，但这一优势的代价是在每个时间步中求解一个庞大（且通常为非线性）的方程组。本练习将通过让您构建隐式求解器的核心组件——残差向量和雅可比矩阵——来揭开这一过程的神秘面纱 。通过处理非线性 Burgers 方程的细节，您将学习如何将 DG 格式线性化，这是使用牛顿法实现稳健的隐式求解器的一项关键技能。",
            "id": "3385786",
            "problem": "考虑由一维无粘伯格斯方程 $u_{t} + \\frac{1}{2}\\left(u^{2}\\right)_{x} = 0$ 给出的标量守恒律，定义在周期性区间 $[0, 1]$ 上。使用间断伽辽金 (DG) 方法对空间域进行离散化，网格包含 $2$ 个均匀单元，每个单元上的多项式次数为 $1$。在参考单元 $\\xi \\in [-1, 1]$ 上使用由 $\\phi_{0}(\\xi) = 1$ 和 $\\phi_{1}(\\xi) = \\xi$ 给出的模态基，以及雅可比行列式为 $\\frac{h}{2}$ 的仿射映射 $x(\\xi)$，其中 $h$ 是单元长度。将单元 $j \\in \\{1, 2\\}$ 在时间层 $n+1$ 的自由度 (DOF) 向量表示为 $\\boldsymbol{u}_{j}^{n+1} = (u_{j0}, u_{j1})$，因此局部多项式为 $u_{h}(\\xi) = u_{j0} + u_{j1}\\,\\xi$。令物理通量为 $f(u) = \\frac{1}{2}u^{2}$。施加周期性边界条件。\n\n使用时间步长为 $\\Delta t  0$ 的后向欧拉法，在时间层 $n+1$ 构造全离散残差，即定义残差 $\\boldsymbol{R}(\\boldsymbol{U}^{n+1}) = \\boldsymbol{0}$，使得在每个单元 $j$ 上以及对于每个测试基函数 $\\phi_{q}$（其中 $q \\in \\{0, 1\\}$），DG 弱形式都得以强制执行。使用标准的 DG 公式，该公式通过将守恒律乘以一个测试函数，在每个单元上进行分部积分，并在界面处使用数值通量来获得。\n\n对于数值通量，使用基于标量伯格斯方程的 Roe 线性化的迎风通量：在一个具有左迹 $u^{-}$ 和右迹 $u^{+}$ 的界面上，定义 Roe 速度 $\\tilde{a} = \\frac{u^{-} + u^{+}}{2}$，如果 $\\tilde{a}  0$ 则选择左侧状态作为迎风状态，如果 $\\tilde{a}  0$ 则选择右侧状态，因此数值通量为 $f^{\\ast} = f(u^{\\text{up}})$。假设在所求的解 $\\boldsymbol{U}^{n+1}$ 处，两个周期性界面上的 Roe 速度都严格为正，因此 $f^{\\ast}$ 在两个界面上都使用左迹。\n\n仅根据以上定义，完成以下所有任务：\n- 推导逐单元的全离散残差贡献，用自由度 $(u_{j0}, u_{j1})$ 及其在周期性识别下的相邻自由度，明确地表示出体积分、右界面通量贡献和左界面通量贡献。\n- 对残差关于自由度求导，以获得非线性系统的雅可比矩阵，明确地指出体积分项和界面通量项对每个相关自由度的导数。\n\n最后，利用你的推导并保持上述假设，给出雅可比矩阵中某个元素的闭式解析表达式，该元素对应于单元 $1$ 上与 $\\phi_{1}$ 相关的残差分量关于自由度 $u_{21}$（即时间层 $n+1$ 上单元 $2$ 的 $\\phi_{1}$ 系数）的导数。你的最终答案必须是单一的解析表达式，不带单位。请勿近似或四舍五入。",
            "solution": "该问题经验证具有科学依据、良定、客观且自洽。它代表了使用间断伽辽金 (DG) 方法对偏微分方程进行数值分析的一个标准练习。我们将开始推导。\n\n一维无粘伯格斯方程由下式给出：\n$$\nu_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0\n$$\n其中通量为 $f(u) = \\frac{1}{2}u^{2}$。我们使用 DG 方法在周期性域 $[0, 1]$ 上离散化该方程。该域被划分为 $2$ 个均匀单元，$K_1 = [0, 0.5]$ 和 $K_2 = [0.5, 1]$。单元长度为 $h=0.5$。\n\n单元 $K_j$ 的半离散 DG 弱形式是通过将偏微分方程乘以测试函数 $\\phi_q$ 并在 $K_j$ 上积分得到的。这得出：\n$$\n\\int_{K_j} (u_h)_t \\phi_q \\, dx + \\int_{K_j} (f(u_h))_x \\phi_q \\, dx = 0\n$$\n其中 $u_h$ 是解的多项式近似。对通量项进行分部积分得到：\n$$\n\\int_{K_j} (u_h)_t \\phi_q \\, dx - \\int_{K_j} f(u_h) (\\phi_q)_x \\, dx + [f(u_h) \\phi_q]_{x_{j-1/2}}^{x_{j+1/2}} = 0\n$$\n边界通量项被数值通量 $f^*$ 替代：\n$$\n\\int_{K_j} (u_h)_t \\phi_q \\, dx - \\int_{K_j} f(u_h) (\\phi_q)_x \\, dx + f^*(x_{j+1/2}) \\phi_q(x_{j+1/2}) - f^*(x_{j-1/2}) \\phi_q(x_{j-1/2}) = 0\n$$\n我们使用仿射映射 $x(\\xi) = x_j + \\frac{h}{2}\\xi$ 将其转换到参考单元 $\\xi \\in [-1, 1]$ 上，其中 $x_j$ 是单元 $K_j$ 的中心。此映射的雅可比行列式为 $J = \\frac{dx}{d\\xi} = \\frac{h}{2}$。单元 $j$ 上的局部解在模态基 $\\phi_0(\\xi)=1, \\phi_1(\\xi)=\\xi$ 中表示为 $u_h(\\xi) = u_{j0} \\phi_0(\\xi) + u_{j1} \\phi_1(\\xi) = u_{j0} + u_{j1}\\xi$。弱形式变为：\n$$\n\\frac{h}{2} \\int_{-1}^{1} (\\frac{\\partial u_h}{\\partial t}) \\phi_q \\, d\\xi - \\int_{-1}^{1} f(u_h(\\xi)) \\phi_q'(\\xi) \\, d\\xi + f^*(x_{j+1/2}) \\phi_q(1) - f^*(x_{j-1/2}) \\phi_q(-1) = 0\n$$\n将 $u_h$ 的模态展开代入，并使用后向欧拉法 $\\frac{\\partial u_h}{\\partial t} \\approx \\frac{u_h^{n+1} - u_h^n}{\\Delta t}$ 进行时间离散化，得到单元 $j$ 和测试函数 $\\phi_q$ 的全离散残差，我们将其表示为 $R_{jq}$。为简化符号，我们省略未知自由度的上标 $n+1$。\n$$\nR_{jq}(\\boldsymbol{U}) = \\frac{1}{\\Delta t} \\sum_{p=0}^{1} M_{qp} (u_{jp} - u_{jp}^n) - \\int_{-1}^{1} f(u_{j0} + u_{j1}\\xi) \\phi_q'(\\xi) \\, d\\xi + f^*(x_{j+1/2}) \\phi_q(1) - f^*(x_{j-1/2}) \\phi_q(-1)\n$$\n其中质量矩阵项为 $M_{qp} = \\frac{h}{2} \\int_{-1}^{1} \\phi_p \\phi_q \\, d\\xi$。相关的质量矩阵项为：\n$M_{00} = \\frac{h}{2} \\int_{-1}^{1} 1 \\cdot 1 \\, d\\xi = h = 0.5$。\n$M_{11} = \\frac{h}{2} \\int_{-1}^{1} \\xi \\cdot \\xi \\, d\\xi = \\frac{h}{3} = \\frac{0.5}{3} = \\frac{1}{6}$。\n$M_{01} = M_{10} = 0$。\n\n我们需要推导单元 $j=1$ 和测试函数 $q=1$（即 $\\phi_1(\\xi)=\\xi$）的残差 $R_{11}$。\n单元 $1$ 的界面位于 $x_{1/2}=0$（左）和 $x_{3/2}=0.5$（右）。由于周期性，单元 $1$ 的左邻居是单元 $2$，单元 $1$ 的右邻居也是单元 $2$。\n\n界面上的解的迹为：\n- $K_1$ 在 $x=0.5$ 的右界面：左迹为 $K_1$ 上的 $u_1^- = u_h(\\xi=1)$，所以 $u_1^- = u_{10} + u_{11}$。\n- $K_1$ 在 $x=0$ 的左界面：左迹（来自周期性邻居 $K_2$）为 $K_2$ 上的 $u_2^- = u_h(\\xi=1)$，所以 $u_2^- = u_{20} + u_{21}$。\n\n问题假设 Roe 速度为正，因此迎风通量取左侧状态：$f^*(u^-, u^+) = f(u^-) = \\frac{1}{2}(u^-)^2$。\n- $K_1$ 右界面（$x=0.5$）的数值通量：$f^*(x_{3/2}) = f(u_1^-) = \\frac{1}{2}(u_{10} + u_{11})^2$。\n- $K_1$ 左界面（$x=0$）的数值通量：$f^*(x_{1/2}) = f(u_2^-) = \\frac{1}{2}(u_{20} + u_{21})^2$。\n\n现在我们构造残差分量 $R_{11}$。\n时间导数项为：\n$\\frac{1}{\\Delta t} (M_{10}(u_{10}-u_{10}^n) + M_{11}(u_{11}-u_{11}^n)) = \\frac{h}{3\\Delta t}(u_{11}-u_{11}^n)$。\n\n体积分贡献为，使用 $\\phi_1'(\\xi)=1$：\n$V_{11} = -\\int_{-1}^{1} f(u_{10} + u_{11}\\xi) \\cdot 1 \\, d\\xi = -\\frac{1}{2} \\int_{-1}^{1} (u_{10} + u_{11}\\xi)^2 d\\xi$。\n$V_{11} = -\\frac{1}{2} \\left[ \\frac{(u_{10} + u_{11}\\xi)^3}{3u_{11}} \\right]_{-1}^{1} = -\\frac{1}{6u_{11}} \\left[ (u_{10}+u_{11})^3 - (u_{10}-u_{11})^3 \\right]$。\n展开立方项：$(a+b)^3 - (a-b)^3 = 2b^3+6a^2b$。这里 $a=u_{10}, b=u_{11}$。\n$V_{11} = -\\frac{1}{6u_{11}} (2u_{11}^3 + 6u_{10}^2u_{11}) = -\\left( u_{10}^2 + \\frac{1}{3}u_{11}^2 \\right)$。\n\n界面通量贡献为：\n- 右界面：$F_{11,R} = f^*(x_{3/2}) \\phi_1(1) = \\frac{1}{2}(u_{10} + u_{11})^2 \\cdot (1) = \\frac{1}{2}(u_{10} + u_{11})^2$。\n- 左界面：$F_{11,L} = -f^*(x_{1/2}) \\phi_1(-1) = -\\frac{1}{2}(u_{20} + u_{21})^2 \\cdot (-1) = \\frac{1}{2}(u_{20} + u_{21})^2$。\n\n结合所有项，残差 $R_{11}$ 的完整表达式为：\n$$\nR_{11}(u_{10}, u_{11}, u_{20}, u_{21}) = \\frac{h}{3\\Delta t}(u_{11}-u_{11}^n) - \\left(u_{10}^2 + \\frac{1}{3}u_{11}^2\\right) + \\frac{1}{2}(u_{10} + u_{11})^2 + \\frac{1}{2}(u_{20} + u_{21})^2\n$$\n\n最后一步是求雅可比矩阵项 $\\frac{\\partial R_{11}}{\\partial u_{21}}$。我们将 $R_{11}$ 的表达式对自由度 $u_{21}$ 求导。变量 $u_{10}, u_{11}, u_{20}, u_{21}$ 是时间层 $n+1$ 的未知数。\n\n- 时间项的导数：$\\frac{\\partial}{\\partial u_{21}} \\left( \\frac{h}{3\\Delta t}(u_{11}-u_{11}^n) \\right) = 0$。\n- 体积分项的导数：$\\frac{\\partial}{\\partial u_{21}} \\left( - (u_{10}^2 + \\frac{1}{3}u_{11}^2) \\right) = 0$。\n- 右界面通量项的导数：$\\frac{\\partial}{\\partial u_{21}} \\left( \\frac{1}{2}(u_{10} + u_{11})^2 \\right) = 0$。\n- 左界面通量项的导数：$\\frac{\\partial}{\\partial u_{21}} \\left( \\frac{1}{2}(u_{20} + u_{21})^2 \\right) = \\frac{1}{2} \\cdot 2(u_{20} + u_{21}) \\cdot \\frac{\\partial}{\\partial u_{21}}(u_{20} + u_{21}) = u_{20} + u_{21}$。\n\n将这些导数相加，得到雅可比矩阵项：\n$$\n\\frac{\\partial R_{11}}{\\partial u_{21}} = 0 + 0 + 0 + (u_{20} + u_{21}) = u_{20} + u_{21}\n$$\n该结果表示从单元 $2$ 上线性基函数的系数到单元 $1$ 上与线性基函数相关的残差之间的耦合。这种耦合完全通过单元间界面上的数值通量产生。",
            "answer": "$$\\boxed{u_{20} + u_{21}}$$"
        },
        {
            "introduction": "许多物理问题涉及在截然不同的时间尺度上发生的现象，这导致了“刚性”系统，其计算成本高昂。本练习介绍隐式-显式 (IMEX) 时间步进法，这是一种强大的策略，它对快（刚性）动力学进行隐式处理以保证稳定性，并对慢（非刚性）动力学进行显式处理以提高效率 。您将为一个弛豫问题推导并实现一个“渐近保持”(asymptotic-preserving) 的 IMEX 格式，并展示当系统的刚性参数 $\\epsilon$ 趋于零时，如何统一地保持计算的准确性和稳定性。",
            "id": "3385703",
            "problem": "考虑一个周期性一维域上的标量松弛方程，采用间断 Galerkin (DG) 空间离散化和隐式-显式 (IMEX) 时间步进方法。其演化方程为\n$$\nu_t + f(u)_x \\;=\\; \\frac{1}{\\epsilon}\\,\\bigl(g(u) - u\\bigr),\n$$\n该方程定义在域 $[0,1]$ 上，具有周期性边界条件和初始数据 $u(x,0) = u_0(x)$。假设通量为线性 $f(u) = c\\,u$，其中平流速度 $c \\in \\mathbb{R}$ 为常数，松弛映射为线性 $g(u) = \\alpha\\,u$，其中 $\\alpha \\in (0,1)$ 为固定值。因此，刚度参数为 $\\epsilon  0$，线性松弛率为 $\\lambda := \\frac{1-\\alpha}{\\epsilon}  0$。\n\n您的任务如下。\n\n- 从每个单元上的弱形式出发，推导针对分段常数（多项式次数 $p=0$）的半离散间断 Galerkin (DG) 格式，其中线性平流项使用迎风数值通量。明确写出每个宽度为 $h$ 的单元的单元平均演化方程，包括单元界面处的数值通量。您必须从第一性原理出发：守恒形式 $u_t + (f(u))_x = \\text{源项}$，在每个单元上对分段常数测试函数进行积分，以及适用于常速 $c$ 线性平流的迎风数值通量的定义。\n\n- 为该半离散 DG 系统构建一个一阶隐式-显式 (IMEX) 欧拉时间步进方法，其中平流项被显式处理，松弛项被隐式处理。展示如何根据当前时间 $t^n$ 的状态和参数 $(c,\\alpha,\\epsilon)$，得到下一个时间层 $t^{n+1} = t^n + \\Delta t$ 处单元平均值的封闭更新形式。\n\n- 证明渐近保持 (AP) 性质，并推导当 $\\epsilon \\to 0$ 时的有效极限格式。具体来说，假设 $\\alpha \\in (0,1)$，证明全离散 IMEX DG 格式在仅依赖于显式平流部分的 Courant–Friedrichs–Lewy (CFL) 限制下保持稳定（即 $\\Delta t = \\mathcal{O}(h)$ 且与 $\\epsilon$ 无关），并确定当 $\\epsilon \\to 0$ 时数值更新的极限。指出极限格式及其对应的极限偏微分方程。\n\n- 对于特定的线性配置 $f(u)=c\\,u$ 和 $g(u) = \\alpha\\,u$，初始条件为 $u_0(x) = \\sin(2\\pi x)$，在 $[0,1]$ 上具有周期性边界条件，计算您的 IMEX DG 格式在固定的最终时间 $T0$ 时的离散 $L^2$ 误差，使用线性平流-衰减问题的精确解：精确解是在环面上的平流和衰减剖面 $u(x,T) = \\exp(-\\lambda T)\\,u_0(x - cT)$。对于分段常数 DG，将数值单元平均值与时间 $T$ 时的精确单元平均值进行比较，并计算离散 $L^2$ 范数\n  $$\n  \\|e\\|_{L^2_h} \\;=\\; \\biggl(\\sum_{i=0}^{N-1} h\\,\\bigl(u_i^{\\text{num}}(T) - u_i^{\\text{exact}}(T)\\bigr)^2\\biggr)^{1/2},\n  $$\n  其中 $N$ 是均匀单元的数量，$h = 1/N$。\n\n- 实现一个完整、可运行的程序，该程序：\n  - 使用分段常数间断 Galerkin (DG) 空间离散化，以及所推导的迎风数值通量和一阶隐式-显式 (IMEX) 欧拉时间步长。\n  - 在 $[0,1]$ 上使用初始条件 $u_0(x) = \\sin(2\\pi x)$ 和周期性边界条件进行初始化。\n  - 推进到时间 $T$，时间步长 $\\Delta t$ 根据平流的 Courant–Friedrichs–Lewy (CFL) 数选择，即当 $|c|0$ 时 $\\Delta t = \\mathrm{CFL}\\,\\frac{h}{|c|}$，当 $c=0$ 时使用固定的步数。\n  - 使用精确的单元内积分计算精确单元平均值，从而计算上面定义的离散 $L^2$ 误差。\n\n- 为以下测试套件提供结果，以展示关于刚度参数 $\\epsilon$ 的一致精度：\n  - 情况 1 (常规路径): $N=100$, $c=1.0$, $\\alpha=0.5$, $\\epsilon=1.0$, $T=0.5$, $\\mathrm{CFL}=0.4$。\n  - 情况 2 (刚性): $N=100$, $c=1.0$, $\\alpha=0.5$, $\\epsilon=10^{-3}$, $T=0.5$, $\\mathrm{CFL}=0.4$。\n  - 情况 3 (非常刚性): $N=100$, $c=1.0$, $\\alpha=0.5$, $\\epsilon=10^{-6}$, $T=0.5$, $\\mathrm{CFL}=0.4$。\n  - 情况 4 (边界，无平流): $N=100$, $c=0.0$, $\\alpha=0.5$, $\\epsilon=10^{-3}$, $T=0.5$，选择 $\\Delta t$ 为 $T$ 除以一个固定的整数步数。\n\n- 您的程序应生成单行输出，其中包含情况 1-4 的 $L^2$ 误差，格式为方括号内以逗号分隔的列表，顺序与情况一致，例如 $[e_1,e_2,e_3,e_4]$，其中每个 $e_k$ 是一个浮点数。\n\n在这个无量纲设置中不使用物理单位。按照惯例，三角函数中出现的角度以弧度为单位。最终的数值输出必须是实数。",
            "solution": "该问题要求对一个标量线性松弛方程推导、分析并实现一个一阶隐式-显式 (IMEX) 间断 Galerkin (DG) 方法。整个过程分为四个主要的理论部分，然后是一个数值实现。\n\n### 第一部分：半离散间断 Galerkin (DG) 格式\n\n控制偏微分方程 (PDE) 是一个在周期域 $[0,1]$ 上的标量松弛方程：\n$$\nu_t + f(u)_x \\;=\\; \\frac{1}{\\epsilon}\\,\\bigl(g(u) - u\\bigr)\n$$\n给定线性通量 $f(u) = c\\,u$ 和线性松弛 $g(u) = \\alpha\\,u$，方程变为：\n$$\nu_t + (c\\,u)_x = \\frac{\\alpha - 1}{\\epsilon} u = -\\lambda u, \\quad \\text{其中 } \\lambda = \\frac{1-\\alpha}{\\epsilon}  0.\n$$\n我们将空间域 $[0,1]$ 离散化为 $N$ 个均匀单元 $I_i = [x_{i-1/2}, x_{i+1/2}]$，其中 $i=0, \\dots, N-1$。每个单元的宽度为 $h = 1/N$。单元界面位于 $x_{i+1/2} = (i+1)h$。对于分段常数 ($p=0$) DG 近似，解 $u_h(x,t)$ 在每个单元 $I_i$ 内表示为一个常数值 $u_i(t)$。\n$$\nu_h(x,t) = \\sum_{i=0}^{N-1} u_i(t) \\phi_i(x),\n$$\n其中 $\\phi_i(x)$ 是单元 $I_i$ 的特征函数。\n\n通过将 PDE 乘以来自相同近似空间（即分段常数）的测试函数 $v_h(x)$，并在单元 $I_i$ 上积分，可以得到弱形式。对于单元 $i$，我们选择测试函数为 $\\phi_i(x)$。\n$$\n\\int_{I_i} (u_h)_t \\phi_i(x) \\,dx + \\int_{I_i} (c u_h)_x \\phi_i(x) \\,dx = \\int_{I_i} (-\\lambda u_h) \\phi_i(x) \\,dx\n$$\n我们逐项计算：\n1.  **时间导数项**：由于在 $I_i$ 上 $u_h(x,t) = u_i(t)$ 且 $\\phi_i(x)=1$，该项变为：\n    $$\n    \\int_{I_i} \\frac{d u_i}{dt} \\cdot 1 \\,dx = h \\frac{d u_i}{dt}\n    $$\n2.  **平流项**：我们进行分部积分：\n    $$\n    \\int_{I_i} (c u_h)_x \\,dx = [c u_h(x,t)]_{x_{i-1/2}}^{x_{i+1/2}} = c u_h(x_{i+1/2}^-, t) - c u_h(x_{i-1/2}^+, t)\n    $$\n    $u_h$ 的间断性要求将界面上的点值替换为数值通量，记为 $\\hat{f}(u_L, u_R)$。该项变为：\n    $$\n    \\hat{f}(u_i, u_{i+1}) - \\hat{f}(u_{i-1}, u_i)\n    $$\n    其中索引是周期性处理的。对于线性平流 $f(u) = cu$，迎风通量为：\n    $$\n    \\hat{f}(u_L, u_R) = \\begin{cases} c u_L  \\text{若 } c \\geq 0 \\\\ c u_R  \\text{若 } c  0 \\end{cases}\n    $$\n    - 若 $c \\geq 0$：通量差为 $c u_i - c u_{i-1} = c(u_i - u_{i-1})$。\n    - 若 $c  0$：通量差为 $c u_{i+1} - c u_i = c(u_{i+1} - u_i)$。\n\n3.  **松弛项**：\n    $$\n    \\int_{I_i} (-\\lambda u_h) \\,dx = \\int_{I_i} (-\\lambda u_i) \\,dx = -h \\lambda u_i\n    $$\n\n合并这些项并除以单元宽度 $h$，我们得到每个单元平均值 $u_i$ 的半离散常微分方程 (ODE)：\n$$\n\\frac{d u_i}{dt} + \\frac{1}{h} \\left( \\hat{f}_{i+1/2} - \\hat{f}_{i-1/2} \\right) = -\\lambda u_i,\n$$\n其中 $\\hat{f}_{i+1/2} = \\hat{f}(u_i, u_{i+1})$。具体地：\n- 对于 $c \\geq 0$:\n$$\n\\frac{d u_i}{dt} + \\frac{c}{h}(u_i - u_{i-1}) = -\\lambda u_i\n$$\n- 对于 $c  0$:\n$$\n\\frac{d u_i}{dt} + \\frac{c}{h}(u_{i+1} - u_i) = -\\lambda u_i\n$$\n\n### 第二部分：一阶隐式-显式 (IMEX) 欧拉格式\n\n该半离散系统是一个 ODE 系统，形式为 $\\frac{d\\mathbf{u}}{dt} = \\mathcal{L}(\\mathbf{u}) + \\mathcal{S}(\\mathbf{u})$，其中 $\\mathcal{L}$ 表示平流的 DG 空间算子，$\\mathcal{S}$ 是松弛算子。\n$$\n\\mathcal{L}_i(\\mathbf{u}) = -\\frac{1}{h} (\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2}), \\quad \\mathcal{S}_i(\\mathbf{u}) = -\\lambda u_i\n$$\n我们通过将平流项 $\\mathcal{L}$ 显式处理（前向欧拉）并将刚性松弛项 $\\mathcal{S}$ 隐式处理（后向欧拉）来构建一阶 IMEX 格式。对于时间步长 $\\Delta t = t^{n+1} - t^n$：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = \\mathcal{L}_i(\\mathbf{u}^n) + \\mathcal{S}_i(\\mathbf{u}^{n+1})\n$$\n代入算子：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = -\\frac{1}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n) - \\lambda u_i^{n+1}\n$$\n其中 $\\hat{f}^n$ 是根据时间 $t^n$ 的解 $\\mathbf{u}^n$ 计算的。我们可以解出 $u_i^{n+1}$：\n$$\nu_i^{n+1} + \\Delta t \\lambda u_i^{n+1} = u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n)\n$$\n$$\nu_i^{n+1} (1 + \\Delta t \\lambda) = u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n)\n$$\n这得到了最终的更新公式：\n$$\nu_i^{n+1} = \\frac{1}{1 + \\Delta t \\lambda} \\left[ u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n) \\right]\n$$\n其中 $\\lambda = (1-\\alpha)/\\epsilon$。\n\n### 第三部分：渐近保持 (AP) 性质和极限格式\n\n一个 IMEX 格式是渐近保持 (AP) 的，如果：\n1.  它对于根据显式部分选择的时间步长 $\\Delta t$ 是稳定的，并且该步长与刚度参数 $\\epsilon$ 无关。\n2.  当 $\\epsilon \\to 0$ 时，数值格式成为极限 PDE 的一个相容且稳定的离散化。\n\n**稳定性**：该格式的显式部分是标准的平流迎风方法，在 Courant-Friedrichs-Lewy (CFL) 条件 $|c| \\frac{\\Delta t}{h} \\le 1$ 下是稳定的。隐式部分涉及算子 $(I + \\Delta t \\lambda)^{-1}$，其范数为 $(1+\\Delta t \\lambda)^{-1}$。由于 $\\Delta t  0$ 且 $\\lambda  0$，这是一个幅值小于 1 的阻尼因子。因此，整体稳定性由显式平流部分的 CFL 条件决定，所以 $\\Delta t = \\mathcal{O}(h)$ 且与 $\\epsilon$ 无关。这满足了第一个 AP 要求。\n\n**极限格式**：我们研究当 $\\epsilon \\to 0$ 时格式的行为。\n原始 PDE 为 $u_t + c u_x = -\\lambda u$。当 $\\epsilon \\to 0$ 时，松弛率 $\\lambda = (1-\\alpha)/\\epsilon \\to \\infty$（因为 $\\alpha \\in (0,1)$）。精确解为 $u(x,t) = e^{-\\lambda t} u_0(x-ct)$。对于任何 $t  0$，有 $u(x,t) \\to 0$。因此，极限 PDE 仅为 $u(x,t) = 0$（对于 $t0$）。\n\n现在考虑数值格式在 $\\epsilon \\to 0$ 时的极限：\n$$\nu_i^{n+1} = \\frac{1}{1 + \\Delta t \\frac{1-\\alpha}{\\epsilon}} \\left[ u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n) \\right]\n$$\n当 $\\epsilon \\to 0$ 时，分母 $1 + \\Delta t \\frac{1-\\alpha}{\\epsilon} \\to \\infty$。方括号中的项保持有界（因为它对应于稳定 CFL 条件下的显式平流格式的一个步骤）。因此，前置因子 $\\frac{1}{1 + \\Delta t \\lambda} \\to 0$。\n这给出了数值更新的极限：\n$$\n\\lim_{\\epsilon \\to 0} u_i^{n+1} = 0\n$$\n极限格式为 $u_i^{n+1} = 0$，这是极限 PDE $u=0$ 的一个相容（且平凡稳定）的离散化。因此，该 IMEX 格式是渐近保持的。\n\n### 第四部分：离散 $L^2$ 误差计算\n\n该问题要求计算在最终时间 $T$ 时数值解与精确解之间的离散 $L^2$ 误差。\n- **数值解**：单元平均值 $u_i^{\\text{num}}(T)$ 是通过使用推导出的 IMEX 格式对初始条件平均值进行时间演化直到时间 $T$ 得到的。\n- **精确解**：对于线性 PDE $u_t+cu_x=-\\lambda u$，解为 $u(x,T) = e^{-\\lambda T} u_0(x-cT)$。对于 $u_0(x) = \\sin(2\\pi x)$，这是：\n  $$\n  u(x,T) = e^{-\\lambda T} \\sin(2\\pi(x-cT))\n  $$\n- **精确单元平均值**：为了与数值单元平均值进行比较，我们必须计算在时间 $T$ 时的精确单元平均值：\n  $$\n  u_i^{\\text{exact}}(T) = \\frac{1}{h} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,T) dx = \\frac{1}{h} \\int_{ih}^{(i+1)h} e^{-\\lambda T} \\sin(2\\pi(x-cT)) dx\n  $$\n  该积分可以通过对每个单元使用数值积分来精确计算。\n- **初始条件**：初始单元平均值 $u_i(0)$ 同样通过对每个单元上的 $u_0(x)$进行平均来计算：\n  $$\n  u_i(0) = \\frac{1}{h} \\int_{ih}^{(i+1)h} \\sin(2\\pi x) dx\n  $$\n- **误差范数**：离散 $L^2$ 误差则计算为：\n  $$\n  \\|e\\|_{L^2_h} = \\biggl(\\sum_{i=0}^{N-1} h\\,\\bigl(u_i^{\\text{num}}(T) - u_i^{\\text{exact}}(T)\\bigr)^2\\biggr)^{1/2}\n  $$\n\n实现将遵循这些推导来计算数值解以及指定测试用例的相应误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef run_simulation(N, c, alpha, epsilon, T, CFL, num_steps_c0=125):\n    \"\"\"\n    Runs a single simulation of the DG-IMEX scheme.\n\n    Args:\n        N (int): Number of cells.\n        c (float): Advection speed.\n        alpha (float): Relaxation parameter.\n        epsilon (float): Stiffness parameter.\n        T (float): Final time.\n        CFL (float): CFL number for time step selection.\n        num_steps_c0 (int): Number of time steps for the c=0 case.\n\n    Returns:\n        float: The discrete L2 error at the final time T.\n    \"\"\"\n    h = 1.0 / N\n    lambda_val = (1.0 - alpha) / epsilon\n\n    # 1. Initialize cell averages u_i(0)\n    # u_i(0) = (1/h) * integral_{I_i} sin(2*pi*x) dx\n    u0_func = lambda x: np.sin(2.0 * np.pi * x)\n    u = np.zeros(N)\n    for i in range(N):\n        x_left, x_right = i * h, (i + 1) * h\n        # quad returns a tuple (integral, error_estimate)\n        integral_val, _ = quad(u0_func, x_left, x_right)\n        u[i] = integral_val / h\n\n    # 2. Set up time stepping\n    if abs(c)  1e-15:\n        dt = CFL * h / abs(c)\n        num_steps = int(np.ceil(T / dt))\n        # Adjust dt to hit T exactly\n        dt = T / num_steps\n    else:\n        num_steps = num_steps_c0\n        dt = T / num_steps\n\n    # 3. Time integration loop\n    for _ in range(num_steps):\n        # Explicit step for advection (L(u^n))\n        # Note: np.roll(u, 1) shifts to right, u_i - u_{i-1}\n        #       np.roll(u, -1) shifts to left, u_i - u_{i+1}\n        if c = 0:\n            # Upwind flux yields L_i = -(c/h) * (u_i - u_{i-1})\n            explicit_part = -(c / h) * (u - np.roll(u, 1))\n        else: # c  0\n            # Upwind flux yields L_i = -(c/h) * (u_{i+1} - u_i)\n            explicit_part = -(c / h) * (np.roll(u, -1) - u)\n\n        # Forward Euler for explicit part\n        u_star = u + dt * explicit_part\n        \n        # Backward Euler for implicit part\n        u = u_star / (1.0 + dt * lambda_val)\n\n    u_num = u\n\n    # 4. Compute exact cell averages at time T\n    # u_exact(x,T) = exp(-lambda*T) * sin(2*pi*(x-c*T))\n    exact_sol_func = lambda x: np.exp(-lambda_val * T) * np.sin(2.0 * np.pi * (x - c * T))\n    u_exact = np.zeros(N)\n    for i in range(N):\n        x_left, x_right = i * h, (i + 1) * h\n        integral_val, _ = quad(exact_sol_func, x_left, x_right)\n        u_exact[i] = integral_val / h\n\n    # 5. Compute discrete L2 error\n    error = np.sqrt(h * np.sum((u_num - u_exact)**2))\n    \n    return error\n\ndef solve():\n    \"\"\"\n    Defines test cases, runs simulations, and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path)\n        {'N': 100, 'c': 1.0, 'alpha': 0.5, 'epsilon': 1.0, 'T': 0.5, 'CFL': 0.4},\n        # Case 2 (stiff)\n        {'N': 100, 'c': 1.0, 'alpha': 0.5, 'epsilon': 1e-3, 'T': 0.5, 'CFL': 0.4},\n        # Case 3 (very stiff)\n        {'N': 100, 'c': 1.0, 'alpha': 0.5, 'epsilon': 1e-6, 'T': 0.5, 'CFL': 0.4},\n        # Case 4 (boundary, no advection)\n        {'N': 100, 'c': 0.0, 'alpha': 0.5, 'epsilon': 1e-3, 'T': 0.5, 'CFL': 0.4}\n    ]\n\n    results = []\n    \n    # Determine num_steps for c=0 case based on a representative c=1 case\n    c1_h = 1.0 / test_cases[0]['N']\n    c1_dt = test_cases[0]['CFL'] * c1_h / abs(test_cases[0]['c'])\n    num_steps_for_c0 = int(np.ceil(test_cases[0]['T'] / c1_dt))\n\n    for case in test_cases:\n        error = run_simulation(\n            case['N'],\n            case['c'],\n            case['alpha'],\n            case['epsilon'],\n            case['T'],\n            case['CFL'],\n            num_steps_c0=num_steps_for_c0\n        )\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}