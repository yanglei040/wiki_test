{
    "hands_on_practices": [
        {
            "introduction": "Mastering mass matrix formulations begins with understanding their construction at the element level. This exercise provides a foundational walkthrough of this process for a standard $2D$ bilinear quadrilateral element. By deriving both the mathematically rigorous consistent mass matrix and its computationally efficient lumped counterpart, you will practice the essential skill of applying numerical quadrature and gain a clear insight into how these two fundamental schemes distribute an element's mass among its nodes .",
            "id": "3540965",
            "problem": "Consider a single four-node bilinear quadrilateral finite element used to model a homogeneous soil domain in plane strain within the Finite Element Method (FEM). The element occupies a rectangle in physical coordinates with nodes at $(0,0)$, $(L_{x},0)$, $(L_{x},L_{y})$, and $(0,L_{y})$, where $L_{x} > 0$ and $L_{y} > 0$. The soil has uniform mass density $\\rho$ and a uniform out-of-plane thickness $b$. Let the isoparametric parent coordinates be $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$, and adopt the standard bilinear shape functions\n$$\nN_{1}(\\xi,\\eta) = \\frac{1}{4}(1 - \\xi)(1 - \\eta), \\quad\nN_{2}(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi)(1 - \\eta), \\quad\nN_{3}(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi)(1 + \\eta), \\quad\nN_{4}(\\xi,\\eta) = \\frac{1}{4}(1 - \\xi)(1 + \\eta).\n$$\nStart from the dynamic equilibrium statement and its Galerkin projection to identify the element-level consistent mass matrix $\\mathbf{M}^{\\mathrm{c}}$ with entries $M_{ij}^{\\mathrm{c}} = \\int_{\\Omega_{e}} \\rho\\, b\\, N_{i}\\, N_{j}\\, \\mathrm{d}\\Omega$ for $i,j \\in \\{1,2,3,4\\}$. Using the $2 \\times 2$ Gaussian quadrature rule with points $(\\xi,\\eta) = \\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$ and weights all equal to $1$, evaluate the consistent mass matrix $\\mathbf{M}^{\\mathrm{c}}$ exactly for this rectangular element. Then construct the row-sum lumped diagonal matrix by defining $m_{i}^{\\mathrm{L}} = \\sum_{j=1}^{4} M_{ij}^{\\mathrm{c}}$ and forming a diagonal matrix $\\mathbf{M}^{\\mathrm{L}} = \\mathrm{diag}(m_{1}^{\\mathrm{L}}, m_{2}^{\\mathrm{L}}, m_{3}^{\\mathrm{L}}, m_{4}^{\\mathrm{L}})$. Finally, quantify the comparison of the nodal mass distribution by computing the ratio\n$$\nr \\;=\\; \\frac{m_{1}^{\\mathrm{L}}}{M_{11}^{\\mathrm{c}}}.\n$$\nExpress the final answer as an exact simplified fraction with no units.",
            "solution": "The consistent mass matrix for a finite element is derived from the kinetic energy term in the principle of virtual work. Its entries are given by\n$$\nM_{ij}^{\\mathrm{c}} = \\int_{\\Omega_{e}} \\rho\\, b\\, N_{i}\\, N_{j}\\, \\mathrm{d}\\Omega\n$$\nwhere $\\rho$ is the mass density, $b$ is the thickness, $N_i$ and $N_j$ are the shape functions, and the integral is taken over the element domain $\\Omega_e$. To evaluate this integral, we transform it into the isoparametric parent domain $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$. The differential area element transforms as $\\mathrm{d}\\Omega = \\det(\\mathbf{J})\\, \\mathrm{d}\\xi\\, \\mathrm{d}\\eta$, where $\\mathbf{J}$ is the Jacobian of the coordinate mapping.\n\nThe physical coordinates $(x,y)$ are mapped from the parent coordinates $(\\xi,\\eta)$ using the shape functions:\n$$\nx(\\xi,\\eta) = \\sum_{k=1}^{4} N_{k}(\\xi,\\eta) x_{k} \\quad \\text{and} \\quad y(\\xi,\\eta) = \\sum_{k=1}^{4} N_{k}(\\xi,\\eta) y_{k}\n$$\nThe nodal coordinates are $(x_1, y_1) = (0,0)$, $(x_2, y_2) = (L_x, 0)$, $(x_3, y_3) = (L_x, L_y)$, and $(x_4, y_4) = (0, L_y)$. Substituting these gives:\n$$\nx(\\xi,\\eta) = N_2(\\xi,\\eta)L_x + N_3(\\xi,\\eta)L_x = \\frac{1}{4}(1+\\xi)(1-\\eta)L_x + \\frac{1}{4}(1+\\xi)(1+\\eta)L_x = \\frac{L_x}{4}(1+\\xi)(1-\\eta+1+\\eta) = \\frac{L_x}{2}(1+\\xi)\n$$\n$$\ny(\\xi,\\eta) = N_3(\\xi,\\eta)L_y + N_4(\\xi,\\eta)L_y = \\frac{1}{4}(1+\\xi)(1+\\eta)L_y + \\frac{1}{4}(1-\\xi)(1+\\eta)L_y = \\frac{L_y}{4}(1+\\eta)(1+\\xi+1-\\xi) = \\frac{L_y}{2}(1+\\eta)\n$$\nThe Jacobian matrix $\\mathbf{J}$ is\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{L_x}{2} & 0 \\\\ 0 & \\frac{L_y}{2} \\end{pmatrix}\n$$\nThe determinant of the Jacobian is constant for this rectangular element:\n$$\n\\det(\\mathbf{J}) = \\frac{L_x L_y}{4}\n$$\nThe integral for the mass matrix entries becomes\n$$\nM_{ij}^{\\mathrm{c}} = \\rho\\, b\\, \\frac{L_x L_y}{4} \\int_{-1}^{1}\\int_{-1}^{1} N_{i}(\\xi,\\eta) N_{j}(\\xi,\\eta)\\, \\mathrm{d}\\xi\\, \\mathrm{d}\\eta\n$$\nThe problem specifies using a $2 \\times 2$ Gaussian quadrature rule. The integral of a function $f(\\xi,\\eta)$ is approximated as\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} f(\\xi,\\eta)\\, \\mathrm{d}\\xi\\, \\mathrm{d}\\eta \\approx \\sum_{k=1}^{4} w_k f(\\xi_k, \\eta_k)\n$$\nThe Gauss points are $(\\xi_k, \\eta_k) = \\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$ and the weights are $w_k = 1$ for all $k \\in \\{1,2,3,4\\}$. Since the integrand $N_i N_j$ is a polynomial of degree at most $2$ in $\\xi$ and $2$ in $\\eta$, this rule (which is exact for polynomials up to degree $3$) provides the exact value of the integral.\nLet $C = \\rho b \\frac{L_x L_y}{4}$. Then,\n$$\nM_{ij}^{\\mathrm{c}} = C \\sum_{k=1}^{4} N_{i}(\\xi_k, \\eta_k) N_{j}(\\xi_k, \\eta_k)\n$$\nFirst, we compute the diagonal entry $M_{11}^{\\mathrm{c}}$:\n$$\nM_{11}^{\\mathrm{c}} = C \\sum_{k=1}^{4} [N_{1}(\\xi_k, \\eta_k)]^2\n$$\nNext, we determine the lumped mass at node $1$, $m_{1}^{\\mathrm{L}}$, using the row-sum lumping method:\n$$\nm_{1}^{\\mathrm{L}} = \\sum_{j=1}^{4} M_{1j}^{\\mathrm{c}} = \\sum_{j=1}^{4} C \\sum_{k=1}^{4} N_{1}(\\xi_k, \\eta_k) N_{j}(\\xi_k, \\eta_k) = C \\sum_{k=1}^{4} N_{1}(\\xi_k, \\eta_k) \\left( \\sum_{j=1}^{4} N_{j}(\\xi_k, \\eta_k) \\right)\n$$\nA fundamental property of these shape functions is that they form a partition of unity, i.e., $\\sum_{j=1}^{4} N_{j}(\\xi,\\eta) = 1$ for all $(\\xi,\\eta)$. Thus, the expression for the lumped mass simplifies to\n$$\nm_{1}^{\\mathrm{L}} = C \\sum_{k=1}^{4} N_{1}(\\xi_k, \\eta_k)\n$$\nLet $\\alpha = \\frac{1}{\\sqrt{3}}$. The four Gauss points are $p_1=(-\\alpha, -\\alpha)$, $p_2=(\\alpha, -\\alpha)$, $p_3=(\\alpha, \\alpha)$, and $p_4=(-\\alpha, \\alpha)$. We evaluate $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$ at these points:\n$N_1(p_1) = N_1(-\\alpha, -\\alpha) = \\frac{1}{4}(1+\\alpha)^2$\n$N_1(p_2) = N_1(\\alpha, -\\alpha) = \\frac{1}{4}(1-\\alpha)(1+\\alpha) = \\frac{1}{4}(1-\\alpha^2)$\n$N_1(p_3) = N_1(\\alpha, \\alpha) = \\frac{1}{4}(1-\\alpha)^2$\n$N_1(p_4) = N_1(-\\alpha, \\alpha) = \\frac{1}{4}(1+\\alpha)(1-\\alpha) = \\frac{1}{4}(1-\\alpha^2)$\n\nNow we can compute $m_{1}^{\\mathrm{L}}$:\n$$\nm_{1}^{\\mathrm{L}} = C \\left[ \\frac{1}{4}(1+\\alpha)^2 + \\frac{1}{4}(1-\\alpha^2) + \\frac{1}{4}(1-\\alpha)^2 + \\frac{1}{4}(1-\\alpha^2) \\right]\n$$\n$$\nm_{1}^{\\mathrm{L}} = \\frac{C}{4} \\left[ (1+2\\alpha+\\alpha^2) + (1-\\alpha^2) + (1-2\\alpha+\\alpha^2) + (1-\\alpha^2) \\right] = \\frac{C}{4} [1+1+1+1] = \\frac{C}{4}(4) = C\n$$\nSo, $m_{1}^{\\mathrm{L}} = C = \\rho b \\frac{L_x L_y}{4}$. This is expected, as row-sum lumping allocates one-quarter of the total element mass ($\\rho b L_x L_y$) to each node for a rectangular element.\n\nNext, we compute $M_{11}^{\\mathrm{c}}$:\n$$\nM_{11}^{\\mathrm{c}} = C \\left( [N_1(p_1)]^2 + [N_1(p_2)]^2 + [N_1(p_3)]^2 + [N_1(p_4)]^2 \\right)\n$$\n$$\nM_{11}^{\\mathrm{c}} = C \\left[ \\left(\\frac{1}{4}(1+\\alpha)^2\\right)^2 + \\left(\\frac{1}{4}(1-\\alpha^2)\\right)^2 + \\left(\\frac{1}{4}(1-\\alpha)^2\\right)^2 + \\left(\\frac{1}{4}(1-\\alpha^2)\\right)^2 \\right]\n$$\n$$\nM_{11}^{\\mathrm{c}} = \\frac{C}{16} \\left[ (1+\\alpha)^4 + 2(1-\\alpha^2)^2 + (1-\\alpha)^4 \\right]\n$$\nWe use the identity $(1+\\alpha)^4 + (1-\\alpha)^4 = 2(1+6\\alpha^2+\\alpha^4)$.\n$$\nM_{11}^{\\mathrm{c}} = \\frac{C}{16} \\left[ 2(1+6\\alpha^2+\\alpha^4) + 2(1-2\\alpha^2+\\alpha^4) \\right] = \\frac{C}{8} \\left[ (1+6\\alpha^2+\\alpha^4) + (1-2\\alpha^2+\\alpha^4) \\right] = \\frac{C}{8} [2+4\\alpha^2+2\\alpha^4] = \\frac{C}{4} [1+2\\alpha^2+\\alpha^4]\n$$\nSubstituting $\\alpha^2 = \\left(\\frac{1}{\\sqrt{3}}\\right)^2 = \\frac{1}{3}$ and $\\alpha^4 = \\frac{1}{9}$:\n$$\nM_{11}^{\\mathrm{c}} = \\frac{C}{4} \\left[ 1 + 2\\left(\\frac{1}{3}\\right) + \\frac{1}{9} \\right] = \\frac{C}{4} \\left[ 1 + \\frac{2}{3} + \\frac{1}{9} \\right] = \\frac{C}{4} \\left[ \\frac{9+6+1}{9} \\right] = \\frac{C}{4} \\left( \\frac{16}{9} \\right) = \\frac{4}{9}C\n$$\nFinally, we compute the required ratio $r$:\n$$\nr = \\frac{m_{1}^{\\mathrm{L}}}{M_{11}^{\\mathrm{c}}} = \\frac{C}{\\frac{4}{9}C} = \\frac{1}{\\frac{4}{9}} = \\frac{9}{4}\n$$\nThe ratio of the lumped mass at a node to the diagonal entry of the consistent mass matrix for a bilinear rectangular element is $\\frac{9}{4}$.",
            "answer": "$$\n\\boxed{\\frac{9}{4}}\n$$"
        },
        {
            "introduction": "Building upon the $2D$ case, this next practice extends the concept into three dimensions using a linear tetrahedral element, a workhorse of $3D$ geomechanical modeling. The exercise introduces a common computational shortcut used in large-scale explicit dynamic simulations: one-point quadrature at the element's centroid. This practice illuminates the practical trade-offs between accuracy and efficiency and challenges you to construct a physically meaningful lumped mass matrix that correctly preserves the total element mass .",
            "id": "3541000",
            "problem": "Consider a four-node tetrahedral finite element with linear shape functions in a small-strain elastodynamic formulation used in computational geomechanics. Assume a homogeneous and isotropic solid with constant mass density $\\rho$ over the element domain and neglect body forces for the purpose of isolating inertial contributions. Using the Finite Element Method (FEM), begin from the conservation of linear momentum and its weak form, and restrict attention to a single translational component of motion (i.e., one scalar degree of freedom per node). Derive the element-level expression for the consistent mass matrix entries in terms of the shape functions and the mass density. Then, using one-point integration at the element centroid, evaluate the consistent mass matrix for this four-node tetrahedral element as a function of the element volume $V_{e}$ and $\\rho$.\n\nNext, propose a lumped diagonal mass matrix for the same element that preserves symmetry and the total element mass per translational component, and express its diagonal entries in terms of $V_{e}$ and $\\rho$.\n\nFinally, define the ratio $r$ as the quotient of the diagonal entry of the one-point integrated consistent mass matrix to the corresponding diagonal entry of your proposed lumped mass matrix (both per scalar degree of freedom). Compute $r$. Provide $r$ as a single number with no units.",
            "solution": "The starting point for an elastodynamic problem is the conservation of linear momentum. For a continuum with domain $\\Omega$, neglecting body forces, this is given by:\n$$ \\nabla \\cdot \\boldsymbol{\\sigma} = \\rho \\ddot{\\mathbf{u}} $$\nwhere $\\boldsymbol{\\sigma}$ is the Cauchy stress tensor, $\\rho$ is the mass density, and $\\ddot{\\mathbf{u}}$ is the acceleration vector.\n\nTo derive the finite element equations, we use the method of weighted residuals to formulate the weak form. We multiply the momentum equation by a vector-valued test function $\\mathbf{w}$ and integrate over the element volume $V_e$:\n$$ \\int_{V_e} \\mathbf{w} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma} - \\rho \\ddot{\\mathbf{u}}) \\, dV = 0 $$\nApplying integration by parts to the stress term yields:\n$$ \\int_{V_e} (\\nabla \\mathbf{w}) : \\boldsymbol{\\sigma} \\, dV - \\int_{\\partial V_e} \\mathbf{w} \\cdot (\\boldsymbol{\\sigma} \\cdot \\mathbf{n}) \\, dS - \\int_{V_e} \\mathbf{w} \\cdot (\\rho \\ddot{\\mathbf{u}}) \\, dV = 0 $$\nThe problem states we are to consider only a single translational component of motion, which simplifies the vector fields $\\mathbf{u}$ and $\\mathbf{w}$ to scalar fields $u$ and $w$, respectively. The equation governing this single DOF is:\n$$ \\int_{V_e} \\nabla w \\cdot \\nabla \\sigma_{comp} \\, dV - \\int_{\\partial V_e} w (\\nabla \\sigma_{comp} \\cdot \\mathbf{n}) \\, dS - \\int_{V_e} w (\\rho \\ddot{u}) \\, dV = 0 $$\nwhere $\\sigma_{comp}$ represents the relevant stress components. The inertial term, which is the focus of the mass matrix derivation, simplifies to:\n$$ \\int_{V_e} \\rho w \\ddot{u} \\, dV $$\nIn the Finite Element Method, the displacement field $u$ within an element is approximated by interpolating the nodal displacements $u_i$ using shape functions $N_i(x)$:\n$$ u(x, t) \\approx \\sum_{i=1}^{4} N_i(x) u_i(t) = \\mathbf{N}(x) \\mathbf{u}(t) $$\nThe acceleration is similarly approximated:\n$$ \\ddot{u}(x, t) \\approx \\sum_{i=1}^{4} N_i(x) \\ddot{u}_i(t) = \\mathbf{N}(x) \\ddot{\\mathbf{u}}(t) $$\nUsing the Galerkin method, the test functions $w$ are chosen from the same basis as the shape functions. For the $j$-th equation, we take $w = N_j(x)$. Substituting these approximations into the inertial term gives the $j$-th component of the inertial force vector:\n$$ \\int_{V_e} \\rho N_j(x) \\left( \\sum_{i=1}^{4} N_i(x) \\ddot{u}_i(t) \\right) dV = \\sum_{i=1}^{4} \\left( \\int_{V_e} \\rho N_j(x) N_i(x) dV \\right) \\ddot{u}_i(t) $$\nThis expression defines the element-level consistent mass matrix, $\\mathbf{M}^e$, whose entries $M_{ji}^e$ are given by:\n$$ M_{ji}^e = \\int_{V_e} \\rho N_j(x) N_i(x) dV $$\nThis is the general expression for the entries of the consistent mass matrix.\n\nNext, we evaluate this expression for a four-node tetrahedral element using one-point quadrature at the element centroid. The formula for numerical integration with one point is:\n$$ \\int_{V_e} f(x) dV \\approx f(x_c) V_e $$\nwhere $x_c$ is the centroid of the tetrahedron and $V_e$ is its volume. For a linear tetrahedral element, the shape functions $N_i$ are identical to the barycentric coordinates $L_i$. The centroid of a tetrahedron is the point where the barycentric coordinates are all equal:\n$$ N_i(x_c) = L_i(x_c) = \\frac{1}{4} \\quad \\text{for } i = 1, 2, 3, 4 $$\nApplying the one-point integration rule to the mass matrix entry, and assuming constant density $\\rho$:\n$$ M_{ji}^e \\approx \\rho N_j(x_c) N_i(x_c) V_e $$\nSubstituting the values of the shape functions at the centroid:\n$$ M_{ji}^e \\approx \\rho \\left(\\frac{1}{4}\\right) \\left(\\frac{1}{4}\\right) V_e = \\frac{\\rho V_e}{16} $$\nThis result is independent of the indices $j$ and $i$. Therefore, every entry in the $4 \\times 4$ one-point integrated consistent mass matrix is $\\frac{\\rho V_e}{16}$. The matrix is:\n$$ \\mathbf{M}^e_{\\text{cons, 1pt}} = \\frac{\\rho V_e}{16} \\begin{pmatrix} 1 & 1 & 1 & 1 \\\\ 1 & 1 & 1 & 1 \\\\ 1 & 1 & 1 & 1 \\\\ 1 & 1 & 1 & 1 \\end{pmatrix} $$\nThe diagonal entry of this matrix is $(M^e_{\\text{cons, 1pt}})_{ii} = \\frac{\\rho V_e}{16}$.\n\nNext, we propose a lumped diagonal mass matrix, $\\mathbf{M}^e_{\\text{lumped}}$, that preserves the total element mass and is symmetric. The total mass of the element is $m_{total} = \\rho V_e$. A standard and physically intuitive lumping scheme for a linear element with geometrically symmetric nodes is to distribute the total mass equally among the nodes. For a $4$-node tetrahedron, this means assigning $1/4$ of the total mass to each node's diagonal entry in the mass matrix. This ensures symmetry. The diagonal entries are:\n$$ (M^e_{\\text{lumped}})_{ii} = \\frac{m_{total}}{4} = \\frac{\\rho V_e}{4} $$\nAll off-diagonal entries are zero. The resulting lumped mass matrix is:\n$$ \\mathbf{M}^e_{\\text{lumped}} = \\frac{\\rho V_e}{4} \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 0 \\\\ 0 & 0 & 0 & 1 \\end{pmatrix} $$\nThe sum of its entries is $4 \\times \\frac{\\rho V_e}{4} = \\rho V_e$, confirming that total mass is preserved.\n\nFinally, we compute the ratio $r$, defined as the quotient of the diagonal entry of the one-point integrated consistent mass matrix to the corresponding diagonal entry of the proposed lumped mass matrix.\n$$ r = \\frac{(M^e_{\\text{cons, 1pt}})_{ii}}{(M^e_{\\text{lumped}})_{ii}} $$\nSubstituting the derived values:\n$$ r = \\frac{\\frac{\\rho V_e}{16}}{\\frac{\\rho V_e}{4}} = \\frac{\\rho V_e}{16} \\cdot \\frac{4}{\\rho V_e} = \\frac{4}{16} = \\frac{1}{4} $$\nAs a single number, this is $0.25$.",
            "answer": "$$\\boxed{0.25}$$"
        },
        {
            "introduction": "Theoretical concepts are best understood when their practical consequences are observed. This capstone practice is a numerical experiment designed to reveal a critical, and often subtle, pitfall in finite element implementations: the violation of physical conservation laws. By simulating the simple free-fall of a single distorted element, you will demonstrate how an inconsistent pairing of a simplified lumped mass matrix with a consistent force vector can generate nonphysical energy, powerfully reinforcing the importance of formulation consistency .",
            "id": "3541036",
            "problem": "Consider the semi-discrete dynamics of a two-dimensional continuum in free fall under a uniform gravitational acceleration. Start from Newton’s second law and its Galerkin weak form for a body of density $\\rho$ and out-of-plane unit thickness, under gravity $g$ acting in the negative $y$-direction. With a Finite Element Method (FEM) discretization using bilinear isoparametric quadrilateral shape functions $\\{N_i\\}_{i=1}^{4}$ and nodal vertical positions $\\mathbf{y} = [y_1,y_2,y_3,y_4]^T$, the semi-discrete equations for vertical motion read\n$$\n\\mathbf{M}\\,\\mathbf{a} = \\mathbf{f},\n$$\nwhere $\\mathbf{M}$ is the mass matrix and $\\mathbf{f}$ is the gravitational load vector. The consistent mass matrix is defined by\n$$\n\\mathbf{M}_\\text{cons} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^T \\mathbf{N}\\, \\mathrm{d}\\Omega,\n$$\nwith $\\mathbf{N} = [N_1, N_2, N_3, N_4]$ and the element domain $\\Omega_e$, and the consistent body force vector (gravity in the negative $y$ direction with upward-positive coordinate convention) is\n$$\n\\mathbf{f}_\\text{cons} = - \\int_{\\Omega_e} \\rho\\, g\\, \\mathbf{N}^T \\,\\mathrm{d}\\Omega.\n$$\nLet $\\mathbf{r} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^T \\,\\mathrm{d}\\Omega$ denote the vector of consistent “row masses,” so that $\\mathbf{f}_\\text{cons} = - g \\mathbf{r}$. Consider also a diagonal “lumped” mass matrix $\\mathbf{M}_\\text{lump} = \\mathrm{diag}(m_1,m_2,m_3,m_4)$ obtained by equally distributing the total element mass to its four nodes, $m_i = (\\int_{\\Omega_e} \\rho\\, \\mathrm{d}\\Omega)/4$, regardless of shape distortion. The free-fall initial conditions are $\\mathbf{y}(0) = \\mathbf{y}_0$ (the initial nodal coordinates in meters), and $\\mathbf{v}(0) = \\mathbf{0}$ (initial velocities), with no displacement constraints and no internal stiffness (pure rigid-body free fall of a deformable discretization).\n\nDefine the physical total mechanical energy as the sum of kinetic energy and gravitational potential energy,\n$$\nE(t) = \\tfrac{1}{2}\\, \\mathbf{v}(t)^T\\, \\mathbf{M}_\\text{cons}\\, \\mathbf{v}(t) \\;+\\; g\\, \\mathbf{r}^T \\mathbf{y}(t),\n$$\nwhich corresponds to the continuum energy discretized consistently (note the potential energy $g\\,\\mathbf{r}^T\\mathbf{y}$ equals $\\int_{\\Omega_e} \\rho\\, g\\, y\\, \\mathrm{d}\\Omega$ for upward-positive $y$). Under exact rigid-body free fall, $E(t)$ must remain constant in time.\n\nYou are to construct a counterexample showing that using the diagonal equal-node “lumped” mass matrix $\\mathbf{M}_\\text{lump}$ together with the consistent gravitational load vector $\\mathbf{f}_\\text{cons}$ can inject nonphysical rigid-body energy in a distorted element, even though the consistent formulation $\\mathbf{M}_\\text{cons}$ with the same $\\mathbf{f}_\\text{cons}$ preserves the correct energy balance.\n\nAlgorithmic task:\n- For each element below, compute $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$ by $2\\times 2$ Gauss integration over the parent square in isoparametric coordinates, using bilinear shape functions with the standard mapping to the given physical-node coordinates.\n- Form $\\mathbf{M}_\\text{lump}$ by distributing the total element mass equally to the four nodes, $m_i = (\\sum_j r_j)/4$.\n- Compute the nodal accelerations for the consistent and lumped formulations, respectively,\n  $$\n  \\mathbf{a}_\\text{cons} = \\mathbf{M}_\\text{cons}^{-1} \\mathbf{f}_\\text{cons},\\quad\n  \\mathbf{a}_\\text{lump} = \\mathbf{M}_\\text{lump}^{-1} \\mathbf{f}_\\text{cons}.\n  $$\n- Using the exact constant-acceleration kinematics with $\\mathbf{v}(0)=\\mathbf{0}$, advance to time $t$:\n  $$\n  \\mathbf{v}(t) = \\mathbf{a}\\, t,\\qquad \\mathbf{y}(t) = \\mathbf{y}_0 + \\tfrac{1}{2}\\,\\mathbf{a}\\, t^2.\n  $$\n  Do this separately for $\\mathbf{a}_\\text{cons}$ and $\\mathbf{a}_\\text{lump}$ to obtain $\\mathbf{v}_\\text{cons}(t), \\mathbf{y}_\\text{cons}(t)$ and $\\mathbf{v}_\\text{lump}(t), \\mathbf{y}_\\text{lump}(t)$.\n- Compute the energy change relative to the initial energy $E(0)$ for both formulations,\n  $$\n  \\Delta E_\\text{cons}(t) = E_\\text{cons}(t) - E(0),\\qquad\n  \\Delta E_\\text{lump}(t) = E_\\text{lump}(t) - E(0),\n  $$\n  with $E_\\text{cons}(t)$ and $E_\\text{lump}(t)$ both evaluated using the same physical energy definition $E(t) = \\tfrac{1}{2}\\mathbf{v}^T \\mathbf{M}_\\text{cons}\\mathbf{v} + g \\mathbf{r}^T \\mathbf{y}$. Use the SI unit Joules (J) for energies.\n\nTest suite and parameters:\n- Material density $\\rho = 1700$ kg/m$^3$, gravitational acceleration $g = 9.81$ m/s$^2$, time $t = 0.2$ s, and unit out-of-plane thickness. Upward-positive $y$-coordinate.\n- Three single-element cases (each case is one bilinear isoparametric quadrilateral with four nodes in counterclockwise order, given as $(x_i, y_i)$ in meters):\n  1. Rectangular (baseline, constant Jacobian): $\\big[(0,0),(2,0),(2,1),(0,1)\\big]$.\n  2. Mildly distorted trapezoid: $\\big[(0,0),(2,0.2),(2,1.2),(0,1)\\big]$.\n  3. Strongly distorted trapezoid: $\\big[(0,0),(2,0.8),(2,1.6),(0,1)\\big]$.\n\nComputational requirements:\n- Implement robust numerical quadrature (exact for bilinear mapping under $2\\times 2$ Gauss rule) to assemble $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$.\n- Use the consistent energy definition for both formulations when computing $E(t)$.\n\nDeliverables and final output format:\n- For each test case, output the pair of floats $\\big[\\Delta E_\\text{cons}(t), \\Delta E_\\text{lump}(t)\\big]$ in Joules, rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list of these pairs enclosed in square brackets (e.g., \"[[e1_cons,e1_lump],[e2_cons,e2_lump],[e3_cons,e3_lump]]\").\n\nNotes:\n- The counterexample is established if the mildly and strongly distorted cases exhibit $\\Delta E_\\text{lump}(t) > 0$ while $\\Delta E_\\text{cons}(t)$ remains numerically near zero, both reported in Joules. The rectangular case serves as a boundary condition where both should be numerically near zero due to exact equivalence.",
            "solution": "The fundamental physical principle at stake is the conservation of total mechanical energy for a system moving under the influence of a conservative force field. For a body in free fall under uniform gravity, the sum of its kinetic and potential energy must remain constant. The semi-discrete equation of motion derived from a Galerkin finite element formulation is given by:\n$$\n\\mathbf{M}\\,\\mathbf{a} = \\mathbf{f}\n$$\nwhere $\\mathbf{M}$ is the mass matrix, $\\mathbf{a}$ is the vector of nodal accelerations, and $\\mathbf{f}$ is the vector of nodal forces.\n\nThe consistent mass matrix, $\\mathbf{M}_\\text{cons}$, arises directly from the Galerkin procedure and is defined as:\n$$\n\\mathbf{M}_\\text{cons} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^T \\mathbf{N}\\, \\mathrm{d}\\Omega\n$$\nwhere $\\rho$ is the material density, $\\mathbf{N} = [N_1, N_2, N_3, N_4]$ is the vector of bilinear shape functions, and the integral is taken over the element domain $\\Omega_e$. This matrix correctly represents the kinetic energy of the velocity field interpolated by the shape functions.\n\nSimilarly, the consistent body force vector for gravity acting in the negative $y$-direction is:\n$$\n\\mathbf{f}_\\text{cons} = - \\int_{\\Omega_e} \\rho\\, g\\, \\mathbf{N}^T \\,\\mathrm{d}\\Omega = -g \\mathbf{r}\n$$\nwhere $g$ is the gravitational acceleration and $\\mathbf{r} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^T \\,\\mathrm{d}\\Omega$ is the vector of consistent nodal mass contributions.\n\nA common simplification is to use a diagonal, or \"lumped,\" mass matrix, $\\mathbf{M}_\\text{lump}$, for computational efficiency. The problem specifies a particular lumping scheme where the total element mass, $M_{tot} = \\int_{\\Omega_e} \\rho\\, \\mathrm{d}\\Omega = \\sum_i r_i$, is distributed equally among the four nodes:\n$$\n\\mathbf{M}_\\text{lump} = \\mathrm{diag}\\left(\\frac{M_{tot}}{4}, \\frac{M_{tot}}{4}, \\frac{M_{tot}}{4}, \\frac{M_{tot}}{4}\\right)\n$$\nThe core of this investigation lies in analyzing the \"inconsistent\" system $\\mathbf{M}_\\text{lump} \\mathbf{a} = \\mathbf{f}_\\text{cons}$ and comparing its energy behavior to the consistent system $\\mathbf{M}_\\text{cons} \\mathbf{a} = \\mathbf{f}_\\text{cons}$.\n\nThe total mechanical energy of the discretized system is defined consistently as:\n$$\nE(t) = \\frac{1}{2}\\, \\mathbf{v}(t)^T\\, \\mathbf{M}_\\text{cons}\\, \\mathbf{v}(t) \\;+\\; g\\, \\mathbf{r}^T \\mathbf{y}(t)\n$$\nGiven the initial conditions of rest, $\\mathbf{v}(0) = \\mathbf{0}$, the initial energy is purely potential: $E(0) = g\\, \\mathbf{r}^T \\mathbf{y}_0$. Using constant acceleration kinematics, we have $\\mathbf{v}(t) = \\mathbf{a}t$ and $\\mathbf{y}(t) = \\mathbf{y}_0 + \\frac{1}{2}\\mathbf{a}t^2$. The change in energy from $t=0$ to a later time $t$ is:\n$$\n\\Delta E(t) = E(t) - E(0) = \\left( \\frac{1}{2}(\\mathbf{a}t)^T \\mathbf{M}_\\text{cons} (\\mathbf{a}t) + g\\mathbf{r}^T (\\mathbf{y}_0 + \\frac{1}{2}\\mathbf{a}t^2) \\right) - g\\mathbf{r}^T\\mathbf{y}_0\n$$\n$$\n\\Delta E(t) = \\frac{1}{2}t^2 \\mathbf{a}^T \\mathbf{M}_\\text{cons} \\mathbf{a} + \\frac{1}{2}t^2 g\\mathbf{r}^T \\mathbf{a}\n$$\nSubstituting $\\mathbf{f}_\\text{cons} = -g\\mathbf{r}$, we obtain a compact expression for the energy change:\n$$\n\\Delta E(t) = \\frac{1}{2}t^2 \\left( \\mathbf{a}^T \\mathbf{M}_\\text{cons} \\mathbf{a} - \\mathbf{f}_\\text{cons}^T \\mathbf{a} \\right)\n$$\nFor the consistent formulation, $\\mathbf{a} = \\mathbf{a}_\\text{cons} = \\mathbf{M}_\\text{cons}^{-1} \\mathbf{f}_\\text{cons}$. This implies $\\mathbf{M}_\\text{cons} \\mathbf{a}_\\text{cons} = \\mathbf{f}_\\text{cons}$. Since $\\mathbf{M}_\\text{cons}$ is symmetric, $\\mathbf{a}_\\text{cons}^T \\mathbf{M}_\\text{cons} = \\mathbf{f}_\\text{cons}^T$. Substituting this into the energy change equation yields $\\Delta E_\\text{cons}(t) = \\frac{1}{2}t^2 (\\mathbf{f}_\\text{cons}^T \\mathbf{a}_\\text{cons} - \\mathbf{f}_\\text{cons}^T \\mathbf{a}_\\text{cons}) = 0$. Thus, the consistent formulation exactly conserves energy.\n\nFor the lumped formulation specified, $\\mathbf{a} = \\mathbf{a}_\\text{lump} = \\mathbf{M}_\\text{lump}^{-1} \\mathbf{f}_\\text{cons}$. In general, $\\mathbf{M}_\\text{cons} \\mathbf{a}_\\text{lump} \\neq \\mathbf{f}_\\text{cons}$, so the term in the parenthesis for $\\Delta E_\\text{lump}(t)$ will not be zero, leading to a nonphysical change in energy.\n\nThe computational procedure is as follows:\n1.  For each element geometry, the integrals for $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$ are computed numerically using a $2 \\times 2$ Gauss quadrature rule over the isoparametric parent element domain $[-1,1] \\times [-1,1]$. This rule is exact for the integrands encountered with bilinear elements, as they are at most cubic polynomials in each parent coordinate $\\xi$ and $\\eta$.\n2.  The Jacobian of the isoparametric mapping, $J(\\xi, \\eta) = \\det(\\mathbf{J})$, is evaluated at each Gauss point. The differential area element is $\\mathrm{d}\\Omega = J(\\xi, \\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$.\n3.  $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$ are assembled by summing their respective integrands evaluated at the four Gauss points, multiplied by the material density $\\rho$ and the local Jacobian determinant $J_k$. Since all Gauss weights are $1$, the assembly is:\n    $$\n    \\mathbf{M}_\\text{cons} = \\rho \\sum_{k=1}^{4} \\mathbf{N}(\\xi_k, \\eta_k)^T \\mathbf{N}(\\xi_k, \\eta_k) J_k, \\quad \\mathbf{r} = \\rho \\sum_{k=1}^{4} \\mathbf{N}(\\xi_k, \\eta_k)^T J_k\n    $$\n4.  The lumped mass matrix $\\mathbf{M}_\\text{lump}$ and consistent force vector $\\mathbf{f}_\\text{cons}$ are constructed.\n5.  Nodal accelerations $\\mathbf{a}_\\text{cons}$ and $\\mathbf{a}_\\text{lump}$ are calculated by solving the respective linear systems.\n6.  The energy changes $\\Delta E_\\text{cons}(t)$ and $\\Delta E_\\text{lump}(t)$ are computed using the derived formula for a time step of $t=0.2\\,\\text{s}$ with the given material parameters.\n\nThis procedure is implemented for the three specified element geometries. The results are expected to show that for the undistorted rectangular element, both formulations conserve energy. However, for the distorted trapezoidal elements, the inconsistent lumped formulation will inject a spurious, positive amount of energy into the system, with the effect being more pronounced for stronger distortion. This demonstrates the potential for numerical error and instability when consistency between mass and force representations is broken.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares the energy conservation of consistent versus\n    inconsistent (lumped mass, consistent force) FEM formulations for\n    a 2D element in free fall.\n    \"\"\"\n    #\n    # --- Problem Parameters ---\n    #\n    rho = 1700.0  # kg/m^3\n    g = 9.81      # m/s^2\n    t = 0.2       # s\n\n    #\n    # --- Test Cases: Nodal coordinates (x, y) in meters ---\n    # Node ordering is counter-clockwise starting from bottom-left.\n    #\n    test_cases = [\n        # Case 1: Rectangular element (baseline)\n        np.array([(0.0, 0.0), (2.0, 0.0), (2.0, 1.0), (0.0, 1.0)]),\n        # Case 2: Mildly distorted trapezoid\n        np.array([(0.0, 0.0), (2.0, 0.2), (2.0, 1.2), (0.0, 1.0)]),\n        # Case 3: Strongly distorted trapezoid\n        np.array([(0.0, 0.0), (2.0, 0.8), (2.0, 1.6), (0.0, 1.0)])\n    ]\n\n    all_results = []\n\n    #\n    # --- Numerical Integration Setup (2x2 Gauss Quadrature) ---\n    #\n    gauss_p = 1.0 / np.sqrt(3.0)\n    gauss_points = [\n        (-gauss_p, -gauss_p), (gauss_p, -gauss_p),\n        (gauss_p, gauss_p), (-gauss_p, gauss_p)\n    ]\n    # Weights for 2x2 Gauss quadrature are all 1.0\n    gauss_weights = [1.0, 1.0, 1.0, 1.0]\n\n    #\n    # --- Main Calculation Loop ---\n    #\n    for nodes in test_cases:\n        #\n        # Step 1: Compute Consistent Mass Matrix (M_cons) and Row-Mass Vector (r_vec)\n        #\n        M_cons = np.zeros((4, 4))\n        r_vec = np.zeros(4)\n\n        for i in range(len(gauss_points)):\n            xi, eta = gauss_points[i]\n            weight = gauss_weights[i]\n\n            # Bilinear shape functions N(xi, eta) at the current Gauss point\n            N = 0.25 * np.array([\n                (1 - xi) * (1 - eta),\n                (1 + xi) * (1 - eta),\n                (1 + xi) * (1 + eta),\n                (1 - xi) * (1 + eta)\n            ])\n\n            # Derivatives of N w.r.t. parent coordinates (xi, eta)\n            dN_dxi = 0.25 * np.array([-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)])\n            dN_deta = 0.25 * np.array([-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)])\n\n            # Jacobian matrix of the isoparametric mapping\n            J_mat = np.array([\n                [np.dot(dN_dxi, nodes[:, 0]), np.dot(dN_dxi, nodes[:, 1])],\n                [np.dot(dN_deta, nodes[:, 0]), np.dot(dN_deta, nodes[:, 1])]\n            ])\n\n            # Jacobian determinant\n            det_J = np.linalg.det(J_mat)\n            if det_J <= 0:\n                raise ValueError(\"Jacobian is non-positive. Element is degenerate or inverted.\")\n\n            # Accumulate contributions to M_cons and r_vec integrals\n            # Unit thickness is assumed (h=1)\n            M_cons += rho * np.outer(N, N) * det_J * weight\n            r_vec += rho * N * det_J * weight\n\n        #\n        # Step 2: Form other matrices and vectors\n        #\n        # Consistent gravitational force vector\n        f_cons = -g * r_vec\n\n        # Lumped mass matrix (equal distribution of total mass)\n        total_mass = np.sum(r_vec)\n        m_lump_diag_val = total_mass / 4.0\n        M_lump = np.diag([m_lump_diag_val] * 4)\n\n        #\n        # Step 3: Compute nodal accelerations for both formulations\n        #\n        # a_cons = inv(M_cons) * f_cons\n        a_cons = np.linalg.solve(M_cons, f_cons)\n        \n        # a_lump = inv(M_lump) * f_cons\n        a_lump = f_cons / m_lump_diag_val\n\n        #\n        # Step 4: Compute the change in total mechanical energy for both cases\n        # Delta_E = 0.5 * t^2 * (a.T @ M_cons @ a - f_cons.T @ a)\n        #\n        \n        # Consistent formulation\n        delta_E_cons = 0.5 * t**2 * (a_cons.T @ M_cons @ a_cons - f_cons.T @ a_cons)\n\n        # Inconsistent \"lumped\" formulation (energy is still measured via M_cons)\n        delta_E_lump = 0.5 * t**2 * (a_lump.T @ M_cons @ a_lump - f_cons.T @ a_lump)\n        \n        # Store results rounded to 6 decimal places\n        all_results.append([round(delta_E_cons, 6), round(delta_E_lump, 6)])\n\n    #\n    # --- Final Output ---\n    #\n    output_str = \"[\" + \",\".join([f\"[{e_c},{e_l}]\" for e_c, e_l in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}