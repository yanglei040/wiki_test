{
    "hands_on_practices": [
        {
            "introduction": "This exercise grounds your understanding of stability in a discrete multi-degree-of-freedom system, a common idealization in geomechanics. You will derive the stability condition for the explicit central difference method from first principles, connecting the critical time step, $\\Delta t_{\\text{crit}}$, directly to the system's highest natural frequency, $\\omega_{\\max}$. This practice reinforces the core principle that numerical stability in explicit dynamics is governed by the fastest dynamics the discretized system can represent .",
            "id": "3562330",
            "problem": "An undamped, linear, two-degree-of-freedom (DOF) shear model of a soil column is represented by mass matrix $\\mathbf{M}$ and stiffness matrix $\\mathbf{K}$ obtained from a consistent discretization of a one-dimensional shear continuum. Let the translational DOFs be collected in the displacement vector $\\mathbf{u}(t) \\in \\mathbb{R}^{2}$. Neglect external forces and consider free vibration governed by Newton’s second law.\n\nThe data are:\n- Mass matrix $\\mathbf{M} = \\mathrm{diag}(m_{1}, m_{2})$ with $m_{1} = 2000~\\mathrm{kg}$ and $m_{2} = 1000~\\mathrm{kg}$.\n- Stiffness matrix $\\mathbf{K} = \\begin{bmatrix} k_{1}+k_{2}  -k_{2} \\\\ -k_{2}  k_{2} \\end{bmatrix}$ with $k_{1} = 1.0 \\times 10^{7}~\\mathrm{N/m}$ and $k_{2} = 5.0 \\times 10^{6}~\\mathrm{N/m}$.\n\nYou discretize in time using the central difference method, where the second time derivative is approximated by the centered finite difference on a uniform time step $\\Delta t$.\n\nTasks:\n1. Starting from $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}$ and the central difference approximation of $\\ddot{\\mathbf{u}}(t)$, write the explicit two-step recurrence for $\\mathbf{u}_{n+1}$ in terms of $\\mathbf{u}_{n}$ and $\\mathbf{u}_{n-1}$, and form the $4 \\times 4$ amplification matrix $\\mathbf{G}(\\Delta t)$ associated with the state vector $\\mathbf{y}_{n} = \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}$.\n2. By transforming to the modal basis of the generalized eigenproblem $\\mathbf{K}\\boldsymbol{\\phi} = \\omega^{2}\\mathbf{M}\\boldsymbol{\\phi}$, compute the eigenvalues of $\\mathbf{G}(\\Delta t)$ in terms of the modal circular frequencies $\\omega_{j}$ and the time step $\\Delta t$. Clearly state the resulting two eigenvalues per mode.\n3. Using the provided $\\mathbf{M}$ and $\\mathbf{K}$, compute the modal circular frequencies $\\omega_{1}$ and $\\omega_{2}$ and identify the largest circular frequency $\\omega_{\\max}$.\n4. From first principles of the central difference stability condition, determine the critical time step $\\Delta t_{\\text{crit}}$ as a function of $\\omega_{\\max}$, and then evaluate it numerically for the given system.\n\nRound your final answer for $\\Delta t_{\\text{crit}}$ to four significant figures and express it in seconds. Provide only the numerical value of $\\Delta t_{\\text{crit}}$ as your final answer.",
            "solution": "The user provided a problem that requires an analysis of the numerical stability for a two-degree-of-freedom ($2$-DOF) system discretized in time using the central difference method.\n\n### Step 1: Validation of the Problem Statement\nThe problem is well-posed and scientifically sound.\n*   **Givens Extracted:**\n    *   Governing equation: $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}$ for an undamped, linear $2$-DOF system.\n    *   Mass matrix: $\\mathbf{M} = \\mathrm{diag}(m_{1}, m_{2})$ with $m_{1} = 2000~\\mathrm{kg}$ and $m_{2} = 1000~\\mathrm{kg}$.\n    *   Stiffness matrix: $\\mathbf{K} = \\begin{bmatrix} k_{1}+k_{2}  -k_{2} \\\\ -k_{2}  k_{2} \\end{bmatrix}$ with $k_{1} = 1.0 \\times 10^{7}~\\mathrm{N/m}$ and $k_{2} = 5.0 \\times 10^{6}~\\mathrm{N/m}$.\n    *   Time discretization method: Central difference method with uniform time step $\\Delta t$.\n    *   State vector: $\\mathbf{y}_{n} = \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}$.\n*   **Validation Verdict:**\n    *   The problem is scientifically grounded, rooted in classical mechanics and standard numerical analysis for differential equations.\n    *   It is well-posed, with all necessary data provided for a unique solution.\n    *   The language is objective and precise.\n    *   Therefore, the problem is deemed **valid**.\n\n### Step 2: Detailed Solution\nThe solution will proceed by addressing the four tasks outlined in the problem statement.\n\n**Task 1: Explicit Recurrence and Amplification Matrix**\n\nThe governing equation of motion for the system is:\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}\n$$\nWe discretize in time, letting $t = t_n = n \\Delta t$, where $\\Delta t$ is the time step. The displacement vector at time $t_n$ is denoted as $\\mathbf{u}_n = \\mathbf{u}(t_n)$. The second time derivative, $\\ddot{\\mathbf{u}}(t_n) = \\ddot{\\mathbf{u}}_n$, is approximated using the second-order central difference formula:\n$$\n\\ddot{\\mathbf{u}}_n \\approx \\frac{\\mathbf{u}_{n+1} - 2\\mathbf{u}_n + \\mathbf{u}_{n-1}}{(\\Delta t)^2}\n$$\nSubstituting this approximation into the governing equation yields:\n$$\n\\mathbf{M} \\left( \\frac{\\mathbf{u}_{n+1} - 2\\mathbf{u}_n + \\mathbf{u}_{n-1}}{(\\Delta t)^2} \\right) + \\mathbf{K}\\,\\mathbf{u}_n = \\mathbf{0}\n$$\nTo find the explicit recurrence for $\\mathbf{u}_{n+1}$, we rearrange the terms:\n$$\n\\mathbf{M}\\,\\mathbf{u}_{n+1} - 2\\mathbf{M}\\,\\mathbf{u}_n + \\mathbf{M}\\,\\mathbf{u}_{n-1} + (\\Delta t)^2 \\mathbf{K}\\,\\mathbf{u}_n = \\mathbf{0}\n$$\n$$\n\\mathbf{M}\\,\\mathbf{u}_{n+1} = (2\\mathbf{M} - (\\Delta t)^2 \\mathbf{K})\\,\\mathbf{u}_n - \\mathbf{M}\\,\\mathbf{u}_{n-1}\n$$\nSince $\\mathbf{M}$ is a diagonal matrix, it is invertible. Pre-multiplying by $\\mathbf{M}^{-1}$ gives the explicit two-step recurrence relation:\n$$\n\\mathbf{u}_{n+1} = \\mathbf{M}^{-1}(2\\mathbf{M} - (\\Delta t)^2 \\mathbf{K})\\,\\mathbf{u}_n - \\mathbf{M}^{-1}\\mathbf{M}\\,\\mathbf{u}_{n-1}\n$$\n$$\n\\mathbf{u}_{n+1} = (2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K})\\,\\mathbf{u}_n - \\mathbf{I}\\,\\mathbf{u}_{n-1}\n$$\nwhere $\\mathbf{I}$ is the $2 \\times 2$ identity matrix.\n\nNext, we form the $4 \\times 4$ amplification matrix $\\mathbf{G}(\\Delta t)$. The state vector at step $n$ is $\\mathbf{y}_{n} = \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}$. The state vector at step $n+1$ is $\\mathbf{y}_{n+1} = \\begin{bmatrix} \\mathbf{u}_{n+1} \\\\ \\mathbf{u}_{n} \\end{bmatrix}$. We seek the matrix $\\mathbf{G}$ such that $\\mathbf{y}_{n+1} = \\mathbf{G}\\,\\mathbf{y}_{n}$.\nUsing the derived recurrence for the top block of $\\mathbf{y}_{n+1}$ and an identity for the bottom block, we can write:\n$$\n\\begin{bmatrix} \\mathbf{u}_{n+1} \\\\ \\mathbf{u}_{n} \\end{bmatrix} = \\begin{bmatrix} 2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K}  -\\mathbf{I} \\\\ \\mathbf{I}  \\mathbf{0} \\end{bmatrix} \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}\n$$\nThus, the amplification matrix is:\n$$\n\\mathbf{G}(\\Delta t) = \\begin{bmatrix} 2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K}  -\\mathbf{I} \\\\ \\mathbf{I}  \\mathbf{0} \\end{bmatrix}\n$$\n\n**Task 2: Eigenvalues of the Amplification Matrix**\n\nTo find the eigenvalues of the $4 \\times 4$ matrix $\\mathbf{G}$, we transform to the modal basis. The generalized eigenproblem is $\\mathbf{K}\\boldsymbol{\\phi}_j = \\omega_j^2 \\mathbf{M}\\boldsymbol{\\phi}_j$, where $\\omega_j$ and $\\boldsymbol{\\phi}_j$ are the $j$-th natural circular frequency and mode shape, respectively. This can be rewritten as $\\mathbf{M}^{-1}\\mathbf{K}\\boldsymbol{\\phi}_j = \\omega_j^2 \\boldsymbol{\\phi}_j$.\nLet us decouple the system by expressing the displacement in terms of modal coordinates $q_j(t)$, such that $\\mathbf{u}(t) = \\sum_{j=1}^{2} \\boldsymbol{\\phi}_j q_j(t)$. For a single mode $j$, the recurrence becomes:\n$$\n\\boldsymbol{\\phi}_j q_{j, n+1} = (2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K})\\boldsymbol{\\phi}_j q_{j, n} - \\mathbf{I}\\boldsymbol{\\phi}_j q_{j, n-1}\n$$\nUsing the eigenvalue property $\\mathbf{M}^{-1}\\mathbf{K}\\boldsymbol{\\phi}_j = \\omega_j^2 \\boldsymbol{\\phi}_j$:\n$$\n\\boldsymbol{\\phi}_j q_{j, n+1} = (2\\boldsymbol{\\phi}_j - (\\Delta t)^2 \\omega_j^2 \\boldsymbol{\\phi}_j) q_{j, n} - \\boldsymbol{\\phi}_j q_{j, n-1}\n$$\nSince $\\boldsymbol{\\phi}_j \\neq \\mathbf{0}$, we can divide by it to obtain the scalar recurrence for the $j$-th modal coordinate:\n$$\nq_{j, n+1} = (2 - (\\omega_j \\Delta t)^2) q_{j, n} - q_{j, n-1}\n$$\nThe state vector for this mode is $\\mathbf{z}_{j,n} = \\begin{bmatrix} q_{j,n} \\\\ q_{j,n-1} \\end{bmatrix}$, and the recurrence is governed by the $2 \\times 2$ modal amplification matrix $\\mathbf{G}_j$:\n$$\n\\mathbf{z}_{j, n+1} = \\begin{bmatrix} q_{j, n+1} \\\\ q_{j, n} \\end{bmatrix} = \\begin{bmatrix} 2 - (\\omega_j \\Delta t)^2  -1 \\\\ 1  0 \\end{bmatrix} \\begin{bmatrix} q_{j, n} \\\\ q_{j, n-1} \\end{bmatrix} = \\mathbf{G}_j \\mathbf{z}_{j,n}\n$$\nThe eigenvalues $\\lambda$ of $\\mathbf{G}_j$ are found from its characteristic equation, $\\det(\\mathbf{G}_j - \\lambda\\mathbf{I}) = 0$:\n$$\n\\det \\begin{pmatrix} 2 - (\\omega_j \\Delta t)^2 - \\lambda  -1 \\\\ 1  -\\lambda \\end{pmatrix} = (-\\lambda)(2 - (\\omega_j \\Delta t)^2 - \\lambda) - (-1)(1) = 0\n$$\n$$\n\\lambda^2 - (2 - (\\omega_j \\Delta t)^2) \\lambda + 1 = 0\n$$\nSolving this quadratic equation for $\\lambda$ gives the two eigenvalues for mode $j$:\n$$\n\\lambda_{j,1,2} = \\frac{(2 - (\\omega_j \\Delta t)^2) \\pm \\sqrt{(2 - (\\omega_j \\Delta t)^2)^2 - 4}}{2}\n$$\nThis expression can be simplified as:\n$$\n\\lambda_{j,1,2} = \\frac{2 - (\\omega_j \\Delta t)^2 \\pm \\sqrt{(\\omega_j \\Delta t)^4 - 4(\\omega_j \\Delta t)^2}}{2}\n$$\n\n**Task 3: Modal Frequencies**\n\nWe need to solve the generalized eigenproblem $\\det(\\mathbf{K} - \\omega^2 \\mathbf{M}) = 0$.\nThe given matrices are:\n$$\n\\mathbf{M} = \\begin{bmatrix} 2000  0 \\\\ 0  1000 \\end{bmatrix}~\\text{kg}\n$$\n$$\n\\mathbf{K} = \\begin{bmatrix} 1.0 \\times 10^7 + 5.0 \\times 10^6  -5.0 \\times 10^6 \\\\ -5.0 \\times 10^6  5.0 \\times 10^6 \\end{bmatrix}~\\text{N/m} = \\begin{bmatrix} 15 \\times 10^6  -5 \\times 10^6 \\\\ -5 \\times 10^6  5 \\times 10^6 \\end{bmatrix}~\\text{N/m}\n$$\nLet $\\lambda_{eig} = \\omega^2$. The characteristic equation is:\n$$\n\\det \\begin{pmatrix} 15 \\times 10^6 - 2000\\lambda_{eig}  -5 \\times 10^6 \\\\ -5 \\times 10^6  5 \\times 10^6 - 1000\\lambda_{eig} \\end{pmatrix} = 0\n$$\n$$\n(15 \\times 10^6 - 2000\\lambda_{eig})(5 \\times 10^6 - 1000\\lambda_{eig}) - (5 \\times 10^6)^2 = 0\n$$\n$75 \\times 10^{12} - 15 \\times 10^9 \\lambda_{eig} - 10 \\times 10^9 \\lambda_{eig} + 2 \\times 10^6 \\lambda_{eig}^2 - 25 \\times 10^{12} = 0$\n$2 \\times 10^6 \\lambda_{eig}^2 - 25 \\times 10^9 \\lambda_{eig} + 50 \\times 10^{12} = 0$\nDividing by $2 \\times 10^6$:\n$$\n\\lambda_{eig}^2 - 12500 \\lambda_{eig} + 25 \\times 10^6 = 0\n$$\nSolving this quadratic equation for $\\lambda_{eig} = \\omega^2$:\n$$\n\\omega^2 = \\frac{12500 \\pm \\sqrt{(-12500)^2 - 4(1)(25 \\times 10^6)}}{2} = \\frac{12500 \\pm \\sqrt{156.25 \\times 10^6 - 100 \\times 10^6}}{2}\n$$\n$$\n\\omega^2 = \\frac{12500 \\pm \\sqrt{56.25 \\times 10^6}}{2} = \\frac{12500 \\pm 7500}{2}\n$$\nThe two solutions for $\\omega^2$ are:\n$$\n\\omega_1^2 = \\frac{12500 - 7500}{2} = \\frac{5000}{2} = 2500~(\\text{rad/s})^2\n$$\n$$\n\\omega_2^2 = \\frac{12500 + 7500}{2} = \\frac{20000}{2} = 10000~(\\text{rad/s})^2\n$$\nThe corresponding circular frequencies are:\n$$\n\\omega_1 = \\sqrt{2500} = 50~\\text{rad/s}\n$$\n$$\n\\omega_2 = \\sqrt{10000} = 100~\\text{rad/s}\n$$\nThe largest circular frequency is $\\omega_{\\max} = \\omega_2 = 100~\\text{rad/s}$.\n\n**Task 4: Critical Time Step**\n\nThe central difference method is numerically stable if and only if the spectral radius of the amplification matrix $\\mathbf{G}$ is less than or equal to $1$, i.e., $\\rho(\\mathbf{G}) \\le 1$. The spectral radius is the maximum absolute value of the eigenvalues of $\\mathbf{G}$. The eigenvalues of $\\mathbf{G}$ are the collection of the eigenvalues of the modal amplification matrices $\\mathbf{G}_j$.\nLet's analyze the magnitude of $\\lambda_{j,1,2}$.\nIf the term under the square root in the expression for $\\lambda_j$ is negative, i.e., $(\\omega_j \\Delta t)^2 - 4  0 \\implies \\omega_j \\Delta t  2$, the eigenvalues are a complex conjugate pair. Their magnitude is:\n$$\n|\\lambda_j|^2 = \\left(\\frac{2 - (\\omega_j \\Delta t)^2}{2}\\right)^2 + \\left(\\frac{\\sqrt{4 - (\\omega_j \\Delta t)^2}}{2}\\right)^2 = \\frac{4 - 4(\\omega_j \\Delta t)^2 + (\\omega_j \\Delta t)^4 + 4 - (\\omega_j \\Delta t)^2}{4} = 1\n$$\nIn this case, $|\\lambda_j| = 1$, and the scheme is stable.\nIf $(\\omega_j \\Delta t)^2 - 4 \\ge 0 \\implies \\omega_j \\Delta t \\ge 2$, the eigenvalues are real. At $\\omega_j \\Delta t = 2$, the eigenvalues are $\\lambda_{j,1,2} = -1$. For $\\omega_j \\Delta t  2$, the product of the eigenvalues is $\\lambda_{j,1}\\lambda_{j,2} = 1$. Since they are real and distinct, one must have magnitude greater than $1$, causing exponential growth and numerical instability.\nTherefore, the stability condition requires that for all modes $j$:\n$$\n\\omega_j \\Delta t \\le 2\n$$\nThis condition must hold for the highest frequency in the system to ensure it holds for all frequencies. Thus, the stability is governed by $\\omega_{\\max}$:\n$$\n\\omega_{\\max} \\Delta t \\le 2\n$$\nThe critical time step, $\\Delta t_{\\text{crit}}$, is the maximum possible value of $\\Delta t$ for which the method remains stable. This is found at the limit of the inequality:\n$$\n\\Delta t_{\\text{crit}} = \\frac{2}{\\omega_{\\max}}\n$$\nUsing the value of $\\omega_{\\max} = 100~\\text{rad/s}$ calculated in Task $3$:\n$$\n\\Delta t_{\\text{crit}} = \\frac{2}{100} = 0.02~\\text{s}\n$$\nThe problem asks for the answer to be rounded to four significant figures. This is $0.02000~\\text{s}$. In standard scientific notation, this value is $2.000 \\times 10^{-2}$.",
            "answer": "$$\n\\boxed{2.000 \\times 10^{-2}}\n$$"
        },
        {
            "introduction": "Building on the concept of $\\omega_{\\max}$, we now explore how choices in the Finite Element formulation impact stability. This problem asks you to analyze a one-dimensional elastic bar to understand the trade-offs between a consistent mass matrix and a computationally cheaper lumped mass matrix. By performing a dispersion analysis, you will discover why mass lumping, despite reducing accuracy for certain wave modes, is often favored in explicit dynamics for its beneficial effect on the maximum stable time step .",
            "id": "3562349",
            "problem": "A one-dimensional elastic bar of length $L$ is modeled by the Finite Element Method (FEM) using $N$ uniform, two-node linear elements of size $h = L/N$, with Young’s modulus $E$, mass density $\\rho$, and cross-sectional area $A$. The bar is idealized as an infinite periodic lattice by invoking periodic boundary conditions on the mesh (i.e., the mesh repeats indefinitely), so that the semi-discrete equations of motion take the form\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\nwhere $\\mathbf{K}$ is the assembled stiffness matrix from standard linear bar elements, and $\\mathbf{M}$ is either the assembled consistent mass matrix $\\mathbf{M}_{\\mathrm{c}}$ or a lumped (row-sum) mass matrix $\\mathbf{M}_{\\mathrm{l}}$. You are to analyze the effect of mass lumping on the largest natural circular frequency $\\omega_{\\max}$ of the semi-discrete system and, from first principles, infer the implication for the explicit central-difference stability limit.\n\nStarting only from first principles and core definitions applicable to the stated context, proceed as follows: use a Bloch-wave ansatz $u_j(t) = U(t)\\,\\mathrm{e}^{\\mathrm{i}k j h}$ for node index $j \\in \\mathbb{Z}$ to write the generalized eigenvalue problem for the discrete wavenumber $k \\in [0,\\pi/h]$. Obtain the dispersion relations $\\omega(k)$ associated with $\\mathbf{M}_{\\mathrm{c}}$ and with $\\mathbf{M}_{\\mathrm{l}}$, and determine the corresponding $\\omega_{\\max}$ over the first Brillouin zone. Then, derive the stability condition of the explicit central-difference scheme for a single undamped mode of frequency $\\omega$ and infer how replacing $\\mathbf{M}_{\\mathrm{c}}$ by $\\mathbf{M}_{\\mathrm{l}}$ modifies the explicit critical time step $\\Delta t_{\\mathrm{cr}}$.\n\nWhich statement is correct?\n\nA. Replacing $\\mathbf{M}_{\\mathrm{c}}$ by $\\mathbf{M}_{\\mathrm{l}}$ strictly increases $\\omega_{\\max}$ by a factor $\\sqrt{3}$, thereby decreasing $\\Delta t_{\\mathrm{cr}}$ by the same factor.\n\nB. Replacing $\\mathbf{M}_{\\mathrm{c}}$ by $\\mathbf{M}_{\\mathrm{l}}$ strictly decreases $\\omega_{\\max}$ from $\\sqrt{12}\\,c/h$ to $2\\,c/h$ in the periodic bar, thereby increasing $\\Delta t_{\\mathrm{cr}}$ by a factor $\\sqrt{3}$, where $c = \\sqrt{E/\\rho}$ is the elastic wave speed.\n\nC. $\\omega_{\\max}$ is unchanged by mass lumping; however, the implicit Newmark method becomes unstable unless $\\Delta t \\le 2/\\omega_{\\max}$.\n\nD. Mass lumping reduces both $\\omega_{\\max}$ and the critical time step because diagonal dominance makes the system stiffer.",
            "solution": "The problem statement is valid as it deals with a standard, well-posed problem in computational mechanics and is scientifically sound. We proceed with the derivation from first principles as instructed.\n\nA two-node linear elastic bar element of length $h$, Young's modulus $E$, density $\\rho$, and area $A$ has the following element stiffness and mass matrices. The stiffness matrix is:\n$$ \\mathbf{K}^e = \\frac{EA}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} $$\nThe consistent mass matrix is derived from the element shape functions and is given by:\n$$ \\mathbf{M}_{\\mathrm{c}}^e = \\frac{\\rho A h}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix} $$\nThe lumped mass matrix is obtained by summing the rows of the consistent mass matrix and placing the result on the diagonal (row-sum lumping), which is equivalent to equally distributing the element mass $\\rho A h$ to its two nodes:\n$$ \\mathbf{M}_{\\mathrm{l}}^e = \\frac{\\rho A h}{2} \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix} $$\n\nFor an infinite periodic lattice of such elements, the equation of motion for a generic node $j$ is assembled from the contributions of element $(j-1, j)$ and element $(j, j+1)$.\nThe governing semi-discrete equation is $\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}$. For node $j$, this translates to:\n$$ \\sum_l M_{jl} \\ddot{u}_l(t) + \\sum_l K_{jl} u_l(t) = 0 $$\nAssembling the stiffness terms for node $j$:\n$$ (K u)_j = \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1}) $$\nAssembling the inertia terms for node $j$ with the consistent mass matrix $\\mathbf{M}_{\\mathrm{c}}$:\n$$ (M_c \\ddot{u})_j = \\frac{\\rho A h}{6}(\\ddot{u}_{j-1} + 4\\ddot{u}_j + \\ddot{u}_{j+1}) $$\nAnd with the lumped mass matrix $\\mathbf{M}_{\\mathrm{l}}$:\n$$ (M_l \\ddot{u})_j = (\\frac{\\rho A h}{2} + \\frac{\\rho A h}{2})\\ddot{u}_j = \\rho A h \\ddot{u}_j $$\n\nWe seek plane wave solutions (Bloch waves) of the form $u_j(t) = U_0 \\mathrm{e}^{\\mathrm{i}(k j h - \\omega t)}$. Substituting this ansatz into the equations of motion for node $j$ and canceling the common factor $U_0 \\mathrm{e}^{\\mathrm{i}(k j h - \\omega t)}$ yields the dispersion relation $\\omega(k)$.\nNote that $u_{j\\pm 1}(t) = u_j(t) \\mathrm{e}^{\\pm \\mathrm{i} k h}$ and $\\ddot{u}_j(t) = -\\omega^2 u_j(t)$.\n\nFor the consistent mass case ($\\mathbf{M}_{\\mathrm{c}}$):\n$$ -\\omega_{\\mathrm{c}}^2 \\frac{\\rho A h}{6}(\\mathrm{e}^{-\\mathrm{i}kh} + 4 + \\mathrm{e}^{\\mathrm{i}kh}) + \\frac{EA}{h}(-\\mathrm{e}^{-\\mathrm{i}kh} + 2 - \\mathrm{e}^{\\mathrm{i}kh}) = 0 $$\nUsing $\\mathrm{e}^{\\mathrm{i}\\theta} + \\mathrm{e}^{-\\mathrm{i}\\theta} = 2\\cos(\\theta)$, we get:\n$$ -\\omega_{\\mathrm{c}}^2 \\frac{\\rho A h}{6}(4 + 2\\cos(kh)) + \\frac{EA}{h}(2 - 2\\cos(kh)) = 0 $$\n$$ \\omega_{\\mathrm{c}}^2 \\frac{\\rho A h}{3}(2 + \\cos(kh)) = \\frac{2EA}{h}(1 - \\cos(kh)) $$\nSolving for $\\omega_{\\mathrm{c}}^2$ and using the definition of the continuum elastic wave speed, $c = \\sqrt{E/\\rho}$:\n$$ \\omega_{\\mathrm{c}}^2(k) = \\frac{6EA}{\\rho A h^2} \\frac{1 - \\cos(kh)}{2 + \\cos(kh)} = \\frac{6c^2}{h^2} \\frac{1 - \\cos(kh)}{2 + \\cos(kh)} $$\nThe maximum frequency $\\omega_{\\max}$ occurs at the edge of the first Brillouin zone, where $k = \\pi/h$. At this wavenumber, $kh=\\pi$ and $\\cos(kh)=-1$.\n$$ \\omega_{\\mathrm{c},\\max}^2 = \\frac{6c^2}{h^2} \\frac{1 - (-1)}{2 + (-1)} = \\frac{6c^2}{h^2} \\frac{2}{1} = \\frac{12c^2}{h^2} $$\n$$ \\omega_{\\mathrm{c},\\max} = \\sqrt{12} \\frac{c}{h} $$\n\nFor the lumped mass case ($\\mathbf{M}_{\\mathrm{l}}$):\n$$ -\\omega_{\\mathrm{l}}^2 (\\rho A h) + \\frac{EA}{h}(-\\mathrm{e}^{-\\mathrm{i}kh} + 2 - \\mathrm{e}^{\\mathrm{i}kh}) = 0 $$\n$$ -\\omega_{\\mathrm{l}}^2 \\rho A h + \\frac{2EA}{h}(1 - \\cos(kh)) = 0 $$\n$$ \\omega_{\\mathrm{l}}^2(k) = \\frac{2EA}{\\rho A h^2}(1 - \\cos(kh)) = \\frac{2c^2}{h^2}(1 - \\cos(kh)) $$\nAgain, evaluating at $k=\\pi/h$:\n$$ \\omega_{\\mathrm{l},\\max}^2 = \\frac{2c^2}{h^2}(1 - (-1)) = \\frac{4c^2}{h^2} $$\n$$ \\omega_{\\mathrm{l},\\max} = 2 \\frac{c}{h} $$\n\nComparing the maximum frequencies, we see that replacing the consistent mass matrix with the lumped mass matrix decreases the maximum natural frequency of the semi-discrete system.\nThe ratio of the frequencies is $\\omega_{\\mathrm{c},\\max} / \\omega_{\\mathrm{l},\\max} = (\\sqrt{12}c/h) / (2c/h) = \\sqrt{12}/2 = 2\\sqrt{3}/2 = \\sqrt{3}$.\nThus, mass lumping reduces $\\omega_{\\max}$ by a factor of $\\sqrt{3}$.\n\nNext, we analyze the stability of the explicit central-difference scheme. For a single degree of freedom oscillator $\\ddot{u} + \\omega^2 u = 0$, the scheme is stable if and only if $\\omega \\Delta t \\le 2$. For a system of equations, the stability is governed by the highest frequency mode $\\omega_{\\max}$. The critical time step $\\Delta t_{\\mathrm{cr}}$ is therefore:\n$$ \\Delta t_{\\mathrm{cr}} = \\frac{2}{\\omega_{\\max}} $$\nThis is the Courant-Friedrichs-Lewy (CFL) condition for the semi-discretized system.\n\nUsing the derived values for $\\omega_{\\max}$:\nFor consistent mass: $\\Delta t_{\\mathrm{cr,c}} = \\frac{2}{\\omega_{\\mathrm{c},\\max}} = \\frac{2}{\\sqrt{12}c/h} = \\frac{2h}{2\\sqrt{3}c} = \\frac{h}{\\sqrt{3}c}$.\nFor lumped mass: $\\Delta t_{\\mathrm{cr,l}} = \\frac{2}{\\omega_{\\mathrm{l},\\max}} = \\frac{2}{2c/h} = \\frac{h}{c}$.\n\nComparing the critical time steps, we find the change when replacing $\\mathbf{M}_{\\mathrm{c}}$ with $\\mathbf{M}_{\\mathrm{l}}$:\n$$ \\frac{\\Delta t_{\\mathrm{cr,l}}}{\\Delta t_{\\mathrm{cr,c}}} = \\frac{h/c}{h/(\\sqrt{3}c)} = \\sqrt{3} $$\nTherefore, replacing the consistent mass matrix with the lumped mass matrix increases the critical time step by a factor of $\\sqrt{3}$.\n\nNow we evaluate the given options:\n\nA. Replacing $\\mathbf{M}_{\\mathrm{c}}$ by $\\mathbf{M}_{\\mathrm{l}}$ strictly increases $\\omega_{\\max}$ by a factor $\\sqrt{3}$, thereby decreasing $\\Delta t_{\\mathrm{cr}}$ by the same factor.\nThis statement is incorrect. Replacing $\\mathbf{M}_{\\mathrm{c}}$ by $\\mathbf{M}_{\\mathrm{l}}$ *decreases* $\\omega_{\\max}$ and consequently *increases* $\\Delta t_{\\mathrm{cr}}$.\n\nB. Replacing $\\mathbf{M}_{\\mathrm{c}}$ by $\\mathbf{M}_{\\mathrm{l}}$ strictly decreases $\\omega_{\\max}$ from $\\sqrt{12}\\,c/h$ to $2\\,c/h$ in the periodic bar, thereby increasing $\\Delta t_{\\mathrm{cr}}$ by a factor $\\sqrt{3}$, where $c = \\sqrt{E/\\rho}$ is the elastic wave speed.\nThis statement accurately reflects all our findings. The maximum frequency decreases from $\\omega_{\\mathrm{c},\\max} = \\sqrt{12}c/h$ to $\\omega_{\\mathrm{l},\\max} = 2c/h$. This leads to an increase in the critical time step, $\\Delta t_{\\mathrm{cr}}$, by a factor of $\\sqrt{3}$. The definition of $c$ is also correct.\n\nC. $\\omega_{\\max}$ is unchanged by mass lumping; however, the implicit Newmark method becomes unstable unless $\\Delta t \\le 2/\\omega_{\\max}$.\nThis statement is incorrect. First, $\\omega_{\\max}$ is changed by mass lumping. Second, the stability condition $\\Delta t \\le 2/\\omega_{\\max}$ applies to the explicit central difference scheme, not to common implicit methods like the unconditionally stable Newmark average acceleration method.\n\nD. Mass lumping reduces both $\\omega_{\\max}$ and the critical time step because diagonal dominance makes the system stiffer.\nThis statement is incorrect. While mass lumping does reduce $\\omega_{\\max}$, it *increases* the critical time step $\\Delta t_{\\mathrm{cr}}$. The reasoning provided is also flawed; a system with a lower $\\omega_{\\max}$ is considered spectrally \"softer\", not \"stiffer\", allowing for a larger time step.\n\nFinal verdict based on the analysis: Option B is the only correct statement.\n\nFinal Answer based on the above derivation:\n- Replacing $\\mathbf{M}_{\\mathrm{c}}$ with $\\mathbf{M}_{\\mathrm{l}}$ changes $\\omega_{\\max}$ from $\\sqrt{12}\\,c/h$ to $2\\,c/h$. This is a decrease.\n- This change increases $\\Delta t_{\\mathrm{cr}}$ by a factor of $\\sqrt{3}$.\n- Option B correctly states these facts.\n\nFinal verification:\n- $\\omega_{\\mathrm{c},\\max} = \\sqrt{12}\\,c/h$\n- $\\omega_{\\mathrm{l},\\max} = 2\\,c/h$\n- $\\omega_{\\mathrm{l},\\max}  \\omega_{\\mathrm{c},\\max}$ (decrease)\n- $\\Delta t_{\\mathrm{cr,l}} / \\Delta t_{\\mathrm{cr,c}} = \\omega_{\\mathrm{c},\\max} / \\omega_{\\mathrm{l},\\max} = \\sqrt{3}$ (increase by factor $\\sqrt{3}$)\nThe analysis and conclusion are robust. Option B is correct.",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "This final practice moves from analysis to implementation, a crucial step in computational engineering. You will design a stability-aware adaptive mesh refinement strategy that balances the need for local accuracy with the global constraint of the Courant–Friedrichs–Lewy (CFL) condition. This exercise addresses a real-world challenge: how to refine a mesh for accuracy without causing the global time step to \"collapse\" and make the simulation impractically slow .",
            "id": "3562397",
            "problem": "You are asked to design and implement a stability-aware mesh refinement strategy for one-dimensional linear elastodynamics, representative of computational geomechanics, that selects where to refine the mesh while adaptively choosing the time step to ensure stable explicit time integration without global time step collapse. The fundamental base consists of Newton’s Second Law, the one-dimensional wave propagation model, and the Courant–Friedrichs–Lewy (CFL) stability concept for explicit time integration. In a one-dimensional mesh with cells indexed by $i$, each cell has length $h_i$ (in meters), wave speed $c_i$ (in meters per second), and a non-dimensional refinement score $s_i$ indicating the desirability of refining that cell. The local Courant number is defined as $\\theta_i = c_i \\Delta t / h_i$ for a global time step $\\Delta t$ (in seconds). The condition for explicit stability is that there exists an upper bound on $\\theta_i$ for all $i$, and the strategy must choose the largest $\\Delta t$ consistent with this bound. To avoid global time step collapse, you will enforce a constraint that limits how small the smallest local time scale $\\tau_i = h_i / c_i$ can be relative to the mesh-wide median time scale. The refinement operation on a cell halves $h_i$ once at most (one split per cell), and each accepted refinement consumes one unit from a given refinement budget. The algorithmic requirements are as follows:\n\n- Inputs per test case: lists $[h_i]$ (meters), $[c_i]$ (meters per second), $[s_i]$ (dimensionless refinement scores), a maximum allowed Courant number $\\theta_{\\max}$ (dimensionless), a collapse-avoidance ratio threshold $\\beta$ (dimensionless), and an integer refinement budget $B \\ge 0$.\n\n- Definitions used by the algorithm:\n  - The local time scale is $\\tau_i = h_i / c_i$ (seconds).\n  - The collapse ratio is $r = \\min_i \\tau_i \\, / \\, \\operatorname{median}_i \\tau_i$ (dimensionless).\n  - Refinement of a cell $i$ replaces $h_i$ by $h_i/2$ (at most once per cell).\n  - The largest stable explicit time step is the maximum $\\Delta t$ such that for all $i$, the chosen $\\Delta t$ does not violate the per-cell explicit stability bound on $\\theta_i$; choose the largest such $\\Delta t$ consistent with the bound and with all refined $h_i$.\n\n- Greedy refinement strategy:\n  - Sort candidate cells in descending order of $s_i$.\n  - Iterate through this order and tentatively refine a cell if it has not yet been refined and there is remaining budget.\n  - After a tentative refinement, recompute $r$ using the updated $h_i$ and accept the refinement only if the resulting $r$ remains greater than or equal to $\\beta$; otherwise, reject this refinement.\n  - Continue until the budget is exhausted or no more acceptable refinements exist.\n\n- Time step selection:\n  - After the refinement stage, select a global $\\Delta t$ in seconds as the largest value such that the per-cell Courant numbers $\\theta_i = c_i \\Delta t / h_i$ do not exceed $\\theta_{\\max}$ for any cell $i$.\n  - Report the final collapse ratio $r$ using the refined $h_i$.\n\nYour program must implement the above refinement strategy and time step selection and then apply it to the following test suite. In all cases, express $\\Delta t$ in seconds. Values for $[h_i]$ are given in meters, and values for $[c_i]$ are given in meters per second.\n\n- Test case A (happy path):\n  - $[h_i] = [\\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0 \\,]$\n  - $[c_i] = [\\, 200.0, \\, 300.0, \\, 400.0, \\, 250.0, \\, 350.0, \\, 150.0 \\,]$\n  - $[s_i] = [\\, 0.1, \\, 0.9, \\, 0.8, \\, 0.2, \\, 0.7, \\, 0.3 \\,]$\n  - $\\theta_{\\max} = 0.9$\n  - $\\beta = 0.4$\n  - $B = 2$\n\n- Test case B (boundary: zero budget, no refinement allowed):\n  - $[h_i] = [\\, 2.0, \\, 0.5, \\, 1.0, \\, 1.5 \\,]$\n  - $[c_i] = [\\, 300.0, \\, 600.0, \\, 200.0, \\, 400.0 \\,]$\n  - $[s_i] = [\\, 0.5, \\, 0.7, \\, 0.1, \\, 0.2 \\,]$\n  - $\\theta_{\\max} = 0.95$\n  - $\\beta = 0.5$\n  - $B = 0$\n\n- Test case C (edge: aggressive score on the cell that would collapse the time step; strict ratio blocks refinement):\n  - $[h_i] = [\\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0 \\,]$\n  - $[c_i] = [\\, 500.0, \\, 100.0, \\, 100.0, \\, 100.0, \\, 100.0 \\,]$\n  - $[s_i] = [\\, 1.0, \\, 0.2, \\, 0.2, \\, 0.2, \\, 0.2 \\,]$\n  - $\\theta_{\\max} = 0.9$\n  - $\\beta = 0.3$\n  - $B = 1$\n\n- Test case D (edge: low wave speeds make local time scales large; multiple refinements accepted without collapse):\n  - $[h_i] = [\\, 0.8, \\, 0.8, \\, 0.8, \\, 0.8 \\,]$\n  - $[c_i] = [\\, 100.0, \\, 110.0, \\, 90.0, \\, 95.0 \\,]$\n  - $[s_i] = [\\, 0.5, \\, 0.6, \\, 0.9, \\, 0.4 \\,]$\n  - $\\theta_{\\max} = 0.85$\n  - $\\beta = 0.5$\n  - $B = 3$\n\nFor each test case, your program must output a list with three entries:\n- The selected $\\Delta t$ in seconds, rounded to six decimal places.\n- The final collapse ratio $r$ rounded to six decimal places.\n- The number of refined cells as an integer.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list in the order specified above. For example, the overall format is\n\"[ [dt_A,r_A,nref_A], [dt_B,r_B,nref_B], [dt_C,r_C,nref_C], [dt_D,r_D,nref_D] ]\"\nwith no extra text.",
            "solution": "The problem requires the design and implementation of a stability-aware adaptive mesh refinement strategy for one-dimensional linear elastodynamics. The core of the problem lies in balancing the desire for mesh refinement in specific regions, as indicated by refinement scores, with the need to maintain numerical stability for an explicit time integration scheme without causing a drastic reduction in the global time step, an issue known as time step collapse. The governing physical and numerical principles are Newton's Second Law, which leads to the one-dimensional wave equation, and the Courant–Friedrichs–Lewy (CFL) condition, which dictates the stability of explicit numerical schemes for hyperbolic partial differential equations.\n\nThe algorithm proceeds in two main stages: a greedy mesh refinement stage constrained by a collapse-avoidance criterion, followed by the selection of the largest possible stable time step based on the final mesh configuration.\n\nFirst, we define the key quantities provided and derived in the problem. The mesh consists of cells indexed by $i$, each with a given length $h_i$, a material-dependent wave propagation speed $c_i$, and a non-dimensional refinement score $s_i$.\n\nThe local time scale, $\\tau_i$, for each cell is defined as the time it takes for a wave to traverse the cell:\n$$\n\\tau_i = \\frac{h_i}{c_i}\n$$\nThis quantity is fundamental, as it represents the characteristic time of the fastest physical phenomena within that cell.\n\nThe stability of an explicit time integration scheme, such as the one considered here, is governed by the Courant number, $\\theta_i$. For a global time step $\\Delta t$, the local Courant number is:\n$$\n\\theta_i = \\frac{c_i \\Delta t}{h_i} = \\frac{\\Delta t}{\\tau_i}\n$$\nThe CFL condition for stability requires that the Courant number be bounded by a certain value, $\\theta_{\\max}$, for all cells in the mesh. That is, $\\theta_i \\le \\theta_{\\max}$ for all $i$. To find the largest permissible global time step $\\Delta t$, we must satisfy this condition for every cell:\n$$\n\\Delta t \\le \\theta_{\\max} \\cdot \\frac{h_i}{c_i} \\implies \\Delta t \\le \\theta_{\\max} \\cdot \\tau_i \\quad \\forall i\n$$\nThis implies that the global time step is constrained by the cell with the minimum local time scale:\n$$\n\\Delta t \\le \\min_i (\\theta_{\\max} \\cdot \\tau_i) = \\theta_{\\max} \\cdot \\min_i (\\tau_i)\n$$\nTo maximize computational efficiency, we select the largest possible stable time step, which is:\n$$\n\\Delta t = \\theta_{\\max} \\cdot \\min_i(\\tau_i)\n$$\nMesh refinement involves reducing a cell's length, typically by halving it ($h_i \\to h_i/2$). This action also halves the local time scale ($\\tau_i \\to \\tau_i/2$), which can drastically reduce the minimum time scale across the mesh and thus lead to a collapse of the global time step $\\Delta t$. To prevent this, the problem introduces a collapse-avoidance constraint based on the collapse ratio, $r$:\n$$\nr = \\frac{\\min_i \\tau_i}{\\operatorname{median}_i \\tau_i}\n$$\nThis ratio measures how small the minimum time scale is relative to the median time scale of the mesh. A very small value of $r$ indicates that one or a few cells are imposing a much stricter time step constraint than the bulk of the mesh. The algorithm must ensure that any refinement operation does not cause this ratio to fall below a given threshold, $\\beta$.\n\nThe mesh refinement strategy is implemented as a greedy algorithm:\n1.  **Initialization**: We begin with the initial arrays of cell lengths $[h_i]$, wave speeds $[c_i]$, and refinement scores $[s_i]$, along with the parameters $\\theta_{\\max}$, $\\beta$, and the refinement budget $B$. We also initialize a counter for refined cells, $n_{ref}$, to $0$ and a set to track the indices of already refined cells.\n\n2.  **Candidate Sorting**: The cells are considered for refinement in descending order of their refinement scores $s_i$. This constitutes the greedy aspect of the algorithm, prioritizing cells deemed most in need of refinement.\n\n3.  **Iterative Refinement**: The algorithm iterates through the sorted list of candidate cells. For each candidate cell $j$:\n    a. We check if the budget $B > 0$ and if cell $j$ has not already been refined.\n    b. If so, we perform a *tentative refinement*. A temporary copy of the mesh's cell lengths is created, in which $h_j$ is replaced by $h_j/2$.\n    c. Using this tentative mesh, we recompute the array of local time scales $[\\tau_i]$ and then calculate the prospective collapse ratio, $r_{new}$.\n    d. This tentative refinement is *accepted* only if the resulting collapse ratio satisfies the constraint $r_{new} \\ge \\beta$.\n    e. If the refinement is accepted, the change to $h_j$ is made permanent, the budget $B$ is decremented by $1$, the refined cell count $n_{ref}$ is incremented by $1$, and the index $j$ is recorded as refined.\n    f. If the refinement is rejected (because $r_{new}  \\beta$), the cell length $h_j$ is reverted to its previous value, and the algorithm proceeds to the next candidate cell.\n\n4.  **Termination**: The refinement process terminates when the budget $B$ is exhausted or when all candidate cells have been considered.\n\n5.  **Final Calculations**: After the refinement stage concludes, the final set of cell lengths $[h_i]$ is established.\n    a. The final local time scales $[\\tau_i = h_i/c_i]$ are computed.\n    b. The final stable time step is calculated as $\\Delta t = \\theta_{\\max} \\cdot \\min_i(\\tau_i)$.\n    c. The final collapse ratio is calculated as $r = \\min_i(\\tau_i) / \\operatorname{median}_i(\\tau_i)$.\n    d. The total number of successful refinements, $n_{ref}$, is recorded.\n\nThis procedure ensures that refinements are applied strategically, improving mesh resolution where desired, while the collapse-avoidance constraint ensures that the numerical stability of the simulation is not unduly compromised. The final outputs for each test case are the computed $\\Delta t$, the final collapse ratio $r$, and the total number of refined cells $n_{ref}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a stability-aware mesh refinement strategy for 1D linear elastodynamics.\n    \"\"\"\n    \n    test_cases = [\n        # Test case A (happy path)\n        {\n            \"h\": [1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            \"c\": [200.0, 300.0, 400.0, 250.0, 350.0, 150.0],\n            \"s\": [0.1, 0.9, 0.8, 0.2, 0.7, 0.3],\n            \"theta_max\": 0.9,\n            \"beta\": 0.4,\n            \"B\": 2,\n        },\n        # Test case B (boundary: zero budget)\n        {\n            \"h\": [2.0, 0.5, 1.0, 1.5],\n            \"c\": [300.0, 600.0, 200.0, 400.0],\n            \"s\": [0.5, 0.7, 0.1, 0.2],\n            \"theta_max\": 0.95,\n            \"beta\": 0.5,\n            \"B\": 0,\n        },\n        # Test case C (edge: aggressive score, strict ratio)\n        {\n            \"h\": [1.0, 1.0, 1.0, 1.0, 1.0],\n            \"c\": [500.0, 100.0, 100.0, 100.0, 100.0],\n            \"s\": [1.0, 0.2, 0.2, 0.2, 0.2],\n            \"theta_max\": 0.9,\n            \"beta\": 0.3,\n            \"B\": 1,\n        },\n        # Test case D (edge: multiple refinements accepted)\n        {\n            \"h\": [0.8, 0.8, 0.8, 0.8],\n            \"c\": [100.0, 110.0, 90.0, 95.0],\n            \"s\": [0.5, 0.6, 0.9, 0.4],\n            \"theta_max\": 0.85,\n            \"beta\": 0.5,\n            \"B\": 3,\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        h_initial = np.array(case[\"h\"], dtype=float)\n        c = np.array(case[\"c\"], dtype=float)\n        s = np.array(case[\"s\"], dtype=float)\n        theta_max = case[\"theta_max\"]\n        beta = case[\"beta\"]\n        budget = case[\"B\"]\n        \n        h_current = np.copy(h_initial)\n        \n        # Create a list of candidates (score, index)\n        candidates = sorted(enumerate(s), key=lambda x: x[1], reverse=True)\n        \n        refined_indices = set()\n        refined_count = 0\n        \n        for idx, score in candidates:\n            if budget = 0:\n                break\n            \n            if idx not in refined_indices:\n                # Tentatively refine the cell\n                h_tentative = np.copy(h_current)\n                h_tentative[idx] /= 2.0\n                \n                # Recompute tau and the collapse ratio r\n                tau_tentative = h_tentative / c\n                min_tau = np.min(tau_tentative)\n                median_tau = np.median(tau_tentative)\n\n                if median_tau == 0:\n                    r_tentative = 0.0\n                else:\n                    r_tentative = min_tau / median_tau\n                \n                # Check if the refinement is acceptable\n                if r_tentative >= beta:\n                    # Accept the refinement\n                    h_current = h_tentative\n                    budget -= 1\n                    refined_count += 1\n                    refined_indices.add(idx)\n\n        # After refinement loop, perform final calculations\n        final_tau = h_current / c\n        min_final_tau = np.min(final_tau)\n        \n        # Calculate final delta_t\n        delta_t = theta_max * min_final_tau\n        \n        # Calculate final collapse ratio r\n        median_final_tau = np.median(final_tau)\n        if median_final_tau == 0:\n            final_r = 0.0\n        else:\n            final_r = min_final_tau / median_final_tau\n            \n        # Store results for this test case\n        results.append([delta_t, final_r, refined_count])\n\n    # Format the final output string\n    formatted_sublists = []\n    for dt, r, nref in results:\n        sublist_str = f\"[{dt:.6f},{r:.6f},{nref}]\"\n        formatted_sublists.append(sublist_str)\n    \n    final_output = f\"[[{','.join(formatted_sublists)}]]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}