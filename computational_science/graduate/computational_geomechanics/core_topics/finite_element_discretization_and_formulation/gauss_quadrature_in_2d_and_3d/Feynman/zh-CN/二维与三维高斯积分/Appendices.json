{
    "hands_on_practices": [
        {
            "introduction": "本练习是多维求积的一个基本起点。我们将应用张量积构造方法，这是将一维高斯-勒让德法则推广到参考正方形等矩形域的最直观方法。通过手动计算一个积分并将其与精确的解析解进行比较，您将对这些法则的应用方式有具体的理解，并验证多项式精确度的概念()。",
            "id": "3527331",
            "problem": "在计算岩土力学中，当使用有限元法（FEM）组装矩阵时，经常需要计算参考单元上的体积分。考虑与双线性四边形单元关联的参考正方形 $[-1,1]^2$。请使用每个方向3个积分点的张量积高斯-勒让德求积法计算积分\n$$\nI \\;=\\; \\int_{-1}^{1}\\int_{-1}^{1} x^{3}\\,y^{5}\\,dx\\,dy\n$$\n然后，直接根据黎曼积分的定义计算该积分的解析值，并比较这两个值，以确定该求积法则对于此被积函数是否精确。将最终答案表示为一个无单位的纯数。无需四舍五入。",
            "solution": "该问题要求使用两种方法计算积分 $I = \\int_{-1}^{1}\\int_{-1}^{1} x^{3}\\,y^{5}\\,dx\\,dy$：第一种是3点张量积高斯-勒让德求积法，第二种是直接解析积分。然后对结果进行比较。\n\n首先，我们来解析地计算该积分。被积函数 $f(x,y) = x^3 y^5$ 是一个可分离函数，意味着它可以写成一个关于 $x$ 的函数与一个关于 $y$ 的函数的乘积。因此，该二重积分可以表示为两个单重积分的乘积：\n$$\nI = \\left( \\int_{-1}^{1} x^{3}\\,dx \\right) \\left( \\int_{-1}^{1} y^{5}\\,dy \\right)\n$$\n我们分别计算每个积分。第一个积分是：\n$$\n\\int_{-1}^{1} x^{3}\\,dx = \\left[ \\frac{x^{4}}{4} \\right]_{-1}^{1} = \\frac{(1)^{4}}{4} - \\frac{(-1)^{4}}{4} = \\frac{1}{4} - \\frac{1}{4} = 0\n$$\n另外，我们注意到被积函数 $p(x) = x^3$ 是一个奇函数，即 $p(-x) = (-x)^3 = -x^3 = -p(x)$。任何奇函数在对称区间（如 $[-1, 1]$）上的积分恒为零。\n\n类似地，对于第二个积分：\n$$\n\\int_{-1}^{1} y^{5}\\,dy = \\left[ \\frac{y^{6}}{6} \\right]_{-1}^{1} = \\frac{(1)^{6}}{6} - \\frac{(-1)^{6}}{6} = \\frac{1}{6} - \\frac{1}{6} = 0\n$$\n被积函数 $q(y) = y^5$ 也是一个奇函数，因此它在 $[-1, 1]$ 上的积分为零。\n\n因此，该积分的解析值为：\n$$\nI = 0 \\times 0 = 0\n$$\n\n接下来，我们使用3点张量积高斯-勒让德求积法计算该积分。积分的数值近似公式（我们记为 $I_{GQ}$）为：\n$$\nI_{GQ} = \\int_{-1}^{1}\\int_{-1}^{1} f(x,y)\\,dx\\,dy \\approx \\sum_{i=1}^{3} \\sum_{j=1}^{3} w_i w_j f(x_i, y_j)\n$$\n其中 $\\{x_i\\}$ 和 $\\{y_j\\}$ 是高斯点，$\\{w_i\\}$ 和 $\\{w_j\\}$ 是对应的3点法则的权重。对于高斯-勒让德求积法，积分点是 $n$ 次勒让德多项式的根，权重由这些根导出。对于 $n=3$，积分点和权重为：\n积分点 ($\\xi_k$): $\\xi_1 = -\\sqrt{\\frac{3}{5}}$, $\\xi_2 = 0$, $\\xi_3 = \\sqrt{\\frac{3}{5}}$\n权重 ($w_k$): $w_1 = \\frac{5}{9}$, $w_2 = \\frac{8}{9}$, $w_3 = \\frac{5}{9}$\n\n由于被积函数 $f(x,y) = x^3 y^5$ 是可分离的，二重求和也可以分离：\n$$\nI_{GQ} = \\left( \\sum_{i=1}^{3} w_i x_i^3 \\right) \\left( \\sum_{j=1}^{3} w_j y_j^5 \\right)\n$$\n我们来计算第一个求和：\n\\begin{align*} \\label{eq:1}\n\\sum_{i=1}^{3} w_i x_i^3 = w_1 x_1^3 + w_2 x_2^3 + w_3 x_3^3 \\\\\n= \\left(\\frac{5}{9}\\right) \\left(-\\sqrt{\\frac{3}{5}}\\right)^3 + \\left(\\frac{8}{9}\\right) (0)^3 + \\left(\\frac{5}{9}\\right) \\left(\\sqrt{\\frac{3}{5}}\\right)^3 \\\\\n= \\left(\\frac{5}{9}\\right) \\left(-\\frac{3}{5}\\sqrt{\\frac{3}{5}}\\right) + 0 + \\left(\\frac{5}{9}\\right) \\left(\\frac{3}{5}\\sqrt{\\frac{3}{5}}\\right) \\\\\n= -\\frac{3}{9}\\sqrt{\\frac{3}{5}} + \\frac{3}{9}\\sqrt{\\frac{3}{5}} \\\\\n= 0\n\\end{align*}\n现在，我们计算第二个求和：\n\\begin{align*} \\label{eq:2}\n\\sum_{j=1}^{3} w_j y_j^5 = w_1 y_1^5 + w_2 y_2^5 + w_3 y_3^5 \\\\\n= \\left(\\frac{5}{9}\\right) \\left(-\\sqrt{\\frac{3}{5}}\\right)^5 + \\left(\\frac{8}{9}\\right) (0)^5 + \\left(\\frac{5}{9}\\right) \\left(\\sqrt{\\frac{3}{5}}\\right)^5 \\\\\n= \\left(\\frac{5}{9}\\right) \\left(-\\left(\\frac{3}{5}\\right)^2\\sqrt{\\frac{3}{5}}\\right) + 0 + \\left(\\frac{5}{9}\\right) \\left(\\left(\\frac{3}{5}\\right)^2\\sqrt{\\frac{3}{5}}\\right) \\\\\n= \\left(\\frac{5}{9}\\right) \\left(-\\frac{9}{25}\\sqrt{\\frac{3}{5}}\\right) + \\left(\\frac{5}{9}\\right) \\left(\\frac{9}{25}\\sqrt{\\frac{3}{5}}\\right) \\\\\n= -\\frac{5}{25}\\sqrt{\\frac{3}{5}} + \\frac{5}{25}\\sqrt{\\frac{3}{5}} \\\\\n= 0\n\\end{align*}\n因此，通过高斯求积法近似得到的积分值为：\n$$\nI_{GQ} = 0 \\times 0 = 0\n$$\n\n最后，我们比较这两个结果。解析值为 $I = 0$，通过3点高斯-勒让德求积法得到的值为 $I_{GQ} = 0$。这两个值是相同的。\n\n这表明该求积法则对于这个特定的被积函数是精确的。这与高斯-勒让德求积法的理论是一致的。一个 $n$ 点法则对于最高为 $2n-1$ 次的所有多项式都是精确的。对于本题，$n=3$，因此该法则对于最高为 $2(3)-1=5$ 次的多项式是精确的。张量积法则对于任何形如 $x^i y^j$（其中 $i \\le 2n-1$ 且 $j \\le 2n-1$）的项的线性组合构成的多项式 $f(x,y)$ 都是精确的。我们的被积函数是 $f(x,y)=x^3y^5$。$x$ 的次数是3，$y$ 的次数是5。由于 $3 \\le 5$ 且 $5 \\le 5$，3点法则对积分的 $x$ 分量和 $y$ 分量都是精确的，因此张量积法则对整个积分也是精确的。\n\n计算出的积分为 $0$。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "虽然张量积法则很巧妙，但许多工程应用依赖于由三角形单元组成的非结构化网格来模拟复杂的几何形状。本练习将转向参考三角形，简单的张量积法则不再适用，需要专门的对称求积方案。您将使用一个标准的高阶三角形求积法则来积分一个多项式，以验证这些专门的法则也具有在一定阶数内精确的关键特性()。",
            "id": "3527327",
            "problem": "在计算地质力学中，组集单元刚度矩阵和质量矩阵需要精确计算参考域上的多项式积分。考虑一个标准参考三角形 $T = \\{(x,y) \\in \\mathbb{R}^2 : x \\ge 0,\\ y \\ge 0,\\ x + y \\le 1\\}$，其顶点为 $(0,0)$, $(1,0)$ 和 $(0,1)$。使用二维高斯求积的原理，通过以下方法计算二次多项式 $x^2 + x y + y^2$ 在 $T$ 上的积分：\n- 通过直接积分计算解析值，以及\n- 使用一个对称的7点三角形高斯求积法则计算数值，该法则对所有次数不高于5的多项式都是精确的。\n\n这个7点法则由以下节点和权重定义，以相对于顶点 $(0,0)$, $(1,0)$ 和 $(0,1)$ 的重心坐标 $(\\lambda_1,\\lambda_2,\\lambda_3)$ 给出，并使用映射 $(x,y) = (\\lambda_2,\\lambda_3)$。以下权重已根据 $T$ 的面积进行缩放。\n- 一个形心点：$(\\lambda_1,\\lambda_2,\\lambda_3) = \\left(\\frac{1}{3},\\frac{1}{3},\\frac{1}{3}\\right)$，权重 $w_1 = 0.1125$。\n- 三个点，其中 $\\alpha_1 = 0.101286507323456$ 且 $\\beta_1 = 1 - 2 \\alpha_1 = 0.797426985353088$，每个点的权重为 $w_2 = 0.062969590272413$，即 $(\\alpha_1,\\alpha_1,\\beta_1)$, $(\\alpha_1,\\beta_1,\\alpha_1)$, $(\\beta_1,\\alpha_1,\\alpha_1)$。\n- 三个点，其中 $\\alpha_2 = 0.470142064105115$ 且 $\\beta_2 = 1 - 2 \\alpha_2 = 0.059715871789770$，每个点的权重为 $w_3 = 0.066197076394253$，即 $(\\alpha_2,\\alpha_2,\\beta_2)$, $(\\alpha_2,\\beta_2,\\alpha_2)$, $(\\beta_2,\\alpha_2,\\alpha_2)$。\n\n计算解析值和求积值，并比较它们以确认对于给定的被积函数的精确性。将 $T$ 上的积分的最终答案表示为一个单一的精确分数。不需要四舍五入。",
            "solution": "用户提供了一个计算地质力学领域的问题，要求计算一个标准参考三角形上的二维积分。该计算需要通过两种方法进行：直接解析积分和使用指定的7点高斯求积法则进行数值积分。问题的有效性已得到确认，因为它具有科学依据、问题设定良好，并提供了所有必要的数据。我们将继续进行解答。\n\n待计算的积分为：\n$$I = \\int_T (x^2 + xy + y^2) \\, dA$$\n其中 $T$ 是由顶点 $(0,0)$, $(1,0)$ 和 $(0,1)$ 定义的参考三角形。区域 $T$ 可由不等式 $x \\ge 0$, $y \\ge 0$ 和 $x+y \\le 1$ 描述。\n\n**第一部分：解析计算**\n\n我们使用累次积分直接计算该积分。积分限为 $x$ 从 $0$ 到 $1$，对于每个 $x$，$y$ 从 $0$ 到 $1-x$。\n\n$$I = \\int_{0}^{1} \\int_{0}^{1-x} (x^2 + xy + y^2) \\, dy \\, dx$$\n\n首先，我们对 $y$ 进行积分：\n\\begin{align*} \\int_{0}^{1-x} (x^2 + xy + y^2) \\, dy = \\left[ x^2y + \\frac{1}{2}xy^2 + \\frac{1}{3}y^3 \\right]_{y=0}^{y=1-x} \\\\ = x^2(1-x) + \\frac{1}{2}x(1-x)^2 + \\frac{1}{3}(1-x)^3 \\\\ = (x^2 - x^3) + \\frac{1}{2}x(1 - 2x + x^2) + \\frac{1}{3}(1 - 3x + 3x^2 - x^3) \\\\ = x^2 - x^3 + \\frac{1}{2}x - x^2 + \\frac{1}{2}x^3 + \\frac{1}{3} - x + x^2 - \\frac{1}{3}x^3 \\\\ = x^2 + \\left(-1 + \\frac{1}{2} - \\frac{1}{3}\\right)x^3 + \\left(\\frac{1}{2} - 1\\right)x + \\frac{1}{3} \\\\ = x^2 - \\frac{5}{6}x^3 - \\frac{1}{2}x + \\frac{1}{3}\\end{align*}\n接下来，我们将得到的这个多项式对 $x$ 从 $0$ 到 $1$ 进行积分：\n\\begin{align*} I = \\int_{0}^{1} \\left( -\\frac{5}{6}x^3 + x^2 - \\frac{1}{2}x + \\frac{1}{3} \\right) \\, dx \\\\ = \\left[ -\\frac{5}{6}\\frac{x^4}{4} + \\frac{x^3}{3} - \\frac{1}{2}\\frac{x^2}{2} + \\frac{1}{3}x \\right]_{0}^{1} \\\\ = -\\frac{5}{24} + \\frac{1}{3} - \\frac{1}{4} + \\frac{1}{3} \\\\ = -\\frac{5}{24} + \\frac{2}{3} - \\frac{1}{4} \\end{align*}\n为了将这些分数相加，我们找到一个公分母，即 $24$：\n$$I = \\frac{-5}{24} + \\frac{2 \\times 8}{24} - \\frac{1 \\times 6}{24} = \\frac{-5 + 16 - 6}{24} = \\frac{5}{24}$$\n积分的解析值为 $\\frac{5}{24}$。\n\n**第二部分：通过高斯求积进行数值计算**\n\n问题陈述该7点求积法则对所有次数不高于5的多项式都是精确的。由于被积函数 $f(x,y) = x^2 + xy + y^2$ 是一个总次数为2的多项式，我们预期数值结果将与解析结果相同。然而，问题要求我们*计算*出这个值。求积公式如下：\n$$I_Q = \\sum_{i=1}^{7} W_i f(x_i, y_i)$$\n其中 $(x_i, y_i)$ 是求积点的坐标，$W_i$ 是相应的权重。问题以重心坐标 $(\\lambda_1, \\lambda_2, \\lambda_3)$ 给出求积点，并提供了到笛卡尔坐标的映射 $(x,y) = (\\lambda_2, \\lambda_3)$。提供的权重已按三角形的面积 $A = \\frac{1}{2}$ 进行缩放。\n\n问题以浮点数形式给出了点的坐标和权重，但要求一个精确的分数答案。这表明这些数值代表了精确的代数数。通过查阅数值积分的标准文献（例如，Dunavant 法则），我们可以确定其精确值：\n- 令 $a = \\sqrt{15}$。\n- 第一组点：$\\alpha_1 = \\frac{6-a}{21}$。对应权重：$w_2 = \\frac{155-a}{2400}$。\n- 第二组点：$\\alpha_2 = \\frac{6+a}{21}$。对应权重：$w_3 = \\frac{155+a}{2400}$。\n- 形心权重：$w_1 = 0.1125 = \\frac{9}{80}$。\n\n7个求积点及其各自的权重如下：\n1. 形心点 $P_1$：$(\\lambda_1, \\lambda_2, \\lambda_3) = (\\frac{1}{3},\\frac{1}{3},\\frac{1}{3})$。笛卡尔坐标 $(x_1,y_1) = (\\frac{1}{3},\\frac{1}{3})$。权重 $W_1 = w_1 = \\frac{9}{80}$。\n2. 一组由 $(\\beta_1, \\alpha_1, \\alpha_1)$ 的排列定义的3个点，其中 $\\beta_1 = 1-2\\alpha_1$。每个点的权重为 $W_{2,3,4} = w_2$。\n   - $P_2$：$(\\beta_1, \\alpha_1, \\alpha_1) \\implies (x_2,y_2) = (\\alpha_1, \\alpha_1)$\n   - $P_3$：$(\\alpha_1, \\beta_1, \\alpha_1) \\implies (x_3,y_3) = (\\beta_1, \\alpha_1)$\n   - $P_4$：$(\\alpha_1, \\alpha_1, \\beta_1) \\implies (x_4,y_4) = (\\alpha_1, \\beta_1)$\n3. 一组由 $(\\beta_2, \\alpha_2, \\alpha_2)$ 的排列定义的3个点，其中 $\\beta_2 = 1-2\\alpha_2$。每个点的权重为 $W_{5,6,7} = w_3$。\n   - $P_5$：$(\\beta_2, \\alpha_2, \\alpha_2) \\implies (x_5,y_5) = (\\alpha_2, \\alpha_2)$\n   - $P_6$：$(\\alpha_2, \\beta_2, \\alpha_2) \\implies (x_6,y_6) = (\\beta_2, \\alpha_2)$\n   - $P_7$：$(\\alpha_2, \\alpha_2, \\beta_2) \\implies (x_7,y_7) = (\\alpha_2, \\beta_2)$\n\n现在我们在每个点上计算被积函数 $f(x,y)=x^2+xy+y^2$ 的值。\n- 来自形心点 ($P_1$) 的贡献：\n  $f(x_1, y_1) = f(\\frac{1}{3}, \\frac{1}{3}) = (\\frac{1}{3})^2 + (\\frac{1}{3})(\\frac{1}{3}) + (\\frac{1}{3})^2 = \\frac{1}{9} + \\frac{1}{9} + \\frac{1}{9} = \\frac{3}{9} = \\frac{1}{3}$。\n  贡献：$W_1 f(x_1,y_1) = \\frac{9}{80} \\times \\frac{1}{3} = \\frac{3}{80}$。\n\n- 来自第一组点 ($P_2, P_3, P_4$) 的贡献：\n  总贡献为 $w_2 [f(\\alpha_1,\\alpha_1) + f(\\beta_1,\\alpha_1) + f(\\alpha_1,\\beta_1)]$。\n  $f(\\alpha_1,\\alpha_1) = \\alpha_1^2 + \\alpha_1^2 + \\alpha_1^2 = 3\\alpha_1^2$。\n  $f(\\beta_1,\\alpha_1) = \\beta_1^2 + \\beta_1\\alpha_1 + \\alpha_1^2$。由于 $f(x,y)=f(y,x)$，因此 $f(\\alpha_1,\\beta_1) = f(\\beta_1,\\alpha_1)$。\n  该组的函数值之和：$S_f^{(1)} = 3\\alpha_1^2 + 2(\\beta_1^2 + \\beta_1\\alpha_1 + \\alpha_1^2)$。\n  代入 $\\beta_1 = 1-2\\alpha_1$：\n  $\\beta_1^2 + \\beta_1\\alpha_1 + \\alpha_1^2 = (1-2\\alpha_1)^2 + (1-2\\alpha_1)\\alpha_1 + \\alpha_1^2 = (1-4\\alpha_1+4\\alpha_1^2) + (\\alpha_1-2\\alpha_1^2) + \\alpha_1^2 = 3\\alpha_1^2 - 3\\alpha_1 + 1$。\n  $S_f^{(1)} = 3\\alpha_1^2 + 2(3\\alpha_1^2 - 3\\alpha_1 + 1) = 9\\alpha_1^2 - 6\\alpha_1 + 2$。\n  我们用 $\\alpha_1 = \\frac{6-\\sqrt{15}}{21}$ 来计算这个值：\n  $21\\alpha_1 = 6-\\sqrt{15} \\implies 441\\alpha_1^2 = 36-12\\sqrt{15}+15 = 51-12\\sqrt{15}$。\n  $S_f^{(1)} = 9\\left(\\frac{51-12\\sqrt{15}}{441}\\right) - 6\\left(\\frac{6-\\sqrt{15}}{21}\\right) + 2 = \\frac{51-12\\sqrt{15}}{49} - \\frac{2(6-\\sqrt{15})}{7} + 2$\n  $= \\frac{51-12\\sqrt{15} - 14(6-\\sqrt{15}) + 98}{49} = \\frac{51-12\\sqrt{15} - 84+14\\sqrt{15} + 98}{49} = \\frac{65+2\\sqrt{15}}{49}$。\n  贡献：$w_2 S_f^{(1)} = \\frac{155-\\sqrt{15}}{2400} \\times \\frac{65+2\\sqrt{15}}{49}$。\n  分子：$(155-\\sqrt{15})(65+2\\sqrt{15}) = 10075 + 310\\sqrt{15} - 65\\sqrt{15} - 2(15) = 10045 + 245\\sqrt{15}$。\n  注意到 $10045 = 205 \\times 49$ 且 $245 = 5 \\times 49$。\n  分子 = $49(205 + 5\\sqrt{15})$。\n  贡献为 $\\frac{49(205+5\\sqrt{15})}{2400 \\times 49} = \\frac{205+5\\sqrt{15}}{2400}$。\n\n- 来自第二组点 ($P_5, P_6, P_7$) 的贡献：\n  计算过程相同，只是将 $\\alpha_1$ 替换为 $\\alpha_2$，将 $w_2$ 替换为 $w_3$。\n  函数值之和为 $S_f^{(2)} = 9\\alpha_2^2 - 6\\alpha_2 + 2$。由于 $\\alpha_2$ 是 $\\alpha_1$ 的共轭（相对于 $\\sqrt{15}$），$S_f^{(2)} = \\frac{65-2\\sqrt{15}}{49}$。\n  贡献：$w_3 S_f^{(2)} = \\frac{155+\\sqrt{15}}{2400} \\times \\frac{65-2\\sqrt{15}}{49}$。\n  分子：$(155+\\sqrt{15})(65-2\\sqrt{15}) = 10045 - 245\\sqrt{15} = 49(205-5\\sqrt{15})$。\n  贡献为 $\\frac{49(205-5\\sqrt{15})}{2400 \\times 49} = \\frac{205-5\\sqrt{15}}{2400}$。\n\n- 总数值积分 $I_Q$：\n  $I_Q = \\frac{3}{80} + \\frac{205+5\\sqrt{15}}{2400} + \\frac{205-5\\sqrt{15}}{2400}$\n  $I_Q = \\frac{3}{80} + \\frac{205+5\\sqrt{15} + 205-5\\sqrt{15}}{2400}$\n  $I_Q = \\frac{3}{80} + \\frac{410}{2400} = \\frac{3}{80} + \\frac{41}{240}$。\n  公分母是 $240$。\n  $I_Q = \\frac{3 \\times 3}{240} + \\frac{41}{240} = \\frac{9+41}{240} = \\frac{50}{240} = \\frac{5}{24}$。\n\n数值结果为 $\\frac{5}{24}$，与解析值相同。这证实了所指定的求积法则对于给定的二次多项式具有精确性。",
            "answer": "$$\\boxed{\\frac{5}{24}}$$"
        },
        {
            "introduction": "在高级计算工作中，仅仅使用一个已发表的求积法则通常是不够的；我们常常必须验证其性质，甚至开发新的法则。最后的这个练习将进入三维空间，以四面体单元为例，挑战您构建一个数值验证工具。通过推导单项式的精确解析矩并实现一个程序来测试一个法则的精确度阶数，您将在理论公式和稳健的计算实现之间架起一座桥梁()。",
            "id": "3527352",
            "problem": "给定一个三维 Gauss 型求积法则族，用于在参考四面体上对标量场进行积分。你的任务是实现一个程序，对于所提供的测试套件中的每个求积法则，确定其精确度阶数的最大非负整数 $p$，使得该法则能将多项式空间 $\\mathbb{P}_p$ 中的每个单项式积分到机器精度以内。你必须通过检查足够高阶的矩条件来完成此任务，并报告所有矩条件在机器精度内成立的最大 $p$ 值。\n\n基本依据。仅使用以下基本事实来推导所需的精确参考矩和测试过程：\n- 参考四面体定义为 $\\Omega = \\{(x,y,z) \\in \\mathbb{R}^3 \\mid x \\ge 0, y \\ge 0, z \\ge 0, x + y + z \\le 1\\}$，其体积为 $|\\Omega| = \\int_{\\Omega} 1 \\, dV$。\n- 一个求积法则的精确度阶数 $p$ 是指使得 $\\int_{\\Omega} m(x,y,z) \\, dV$ 等于求积近似值 $\\sum_{q=1}^{N_q} w_q \\, m(x_q,y_q,z_q)$ 对所有满足 $i,j,k \\in \\mathbb{N}_0$ 和 $i+j+k \\le p$ 的单项式 $m(x,y,z) = x^i y^j z^k$ 成立的最大整数。\n- 对于非负整数 $n$，一维积分满足 $\\int_0^{a} t^n \\, dt = \\dfrac{a^{n+1}}{n+1}$，这一事实连同 Fubini 定理以及 $\\Omega$ 的定义，足以推导出单项式矩 $\\int_{\\Omega} x^i y^j z^k \\, dV$ 的精确值。\n\n“机器精度”的定义。对于一个精确的目标矩 $M_{i,j,k}$ 及其求积近似值 $\\widehat{M}_{i,j,k}$，如果满足以下条件，则声明矩条件成立：\n$$\n\\left|\\widehat{M}_{i,j,k} - M_{i,j,k}\\right| \\le \\tau(|M_{i,j,k}|),\n$$\n其中容差函数为\n$$\n\\tau(|M|) = c \\, \\varepsilon_{\\mathrm{mach}} \\, \\max(1,|M|) + \\tau_0,\n$$\n其中 $c = 64$，$\\varepsilon_{\\mathrm{mach}}$ 等于你的编程环境提供的 IEEE 双精度算术的机器ε，且 $\\tau_0 = 10^{-14}$。\n\n算法要求。\n1. 基于上述基本依据，推导出对所有非负整数 $i,j,k$ 的 $M_{i,j,k} = \\int_{\\Omega} x^i y^j z^k \\, dV$ 的封闭形式表达式。\n2. 实现一个例程，给定一个求积法则 $\\{(w_q, x_q, y_q, z_q)\\}_{q=1}^{N_q}$，检查总阶数最高到 $d_{\\max}$ 的所有单项式矩（其中 $d_{\\max}$ 至少为 $\\;10\\;$），并返回满足容差要求的所有单项式所属空间 $\\mathbb{P}_p$ 的最大 $p \\le d_{\\max}$。\n3. 对参考四面体 $\\Omega$ 使用以下求积法则测试套件。每个法则均以求积点 $(x_q,y_q,z_q)$ 和相应权重 $w_q$ 的列表形式提供。所有坐标和权重均为无量纲。\n   - 测试用例 A（单点形心法则，候选阶数 $\\;p=1\\;$）：\n     - 一个点位于 $(x,y,z) = \\left(\\dfrac{1}{4}, \\dfrac{1}{4}, \\dfrac{1}{4}\\right)$，权重为 $w = \\dfrac{1}{6}$。\n   - 测试用例 B（对称四点法则，候选阶数 $\\;p=2\\;$）：\n     - 令 $a = \\;0.5854101966249685\\;$ 且 $b = \\;0.1381966011250105\\;$。使用四个点，这些点由重心坐标元组 $(\\lambda_1,\\lambda_2,\\lambda_3,\\lambda_4)$ 等于 $(a,b,b,b)$ 的排列形式得到，并通过 $(x,y,z) = (\\lambda_2,\\lambda_3,\\lambda_4)$ 映射到笛卡尔坐标，其参考四面体的顶点位于 $(0,0,0)$、$(1,0,0)$、$(0,1,0)$、$(0,0,1)$。这会产生四个笛卡尔点 $(a,b,b)$、$(b,a,b)$、$(b,b,a)$ 和 $(b,b,b)$，每个点的权重相等，为 $w = \\dfrac{1}{24}$。\n   - 测试用例 C（非形心单点法则，候选阶数 $\\;p=0\\;$）：\n     - 一个点位于 $(x,y,z) = \\left(\\;0.3\\;,\\;0.2\\;,\\;0.1\\;\\right)$，权重为 $w = \\dfrac{1}{6}$。\n\n边界情况与覆盖范围。该测试套件包括一个预期对所有阶数至多为 $\\;1\\;$ 的多项式精确的法则、一个至多为 $\\;2\\;$ 的法则，以及一个仅对常数精确的法则。你的实现必须对浮点舍入具有鲁棒性，并根据所述的容差模型正确报告阶数。\n\n最终输出格式。你的程序应生成单行输出，其中包含三个测试用例（按 A、B、C 顺序）的结果，格式为逗号分隔的列表并用方括号括起，例如 $[p_A,p_B,p_C]$，其中每个 $p_\\cdot$ 都是一个整数。你的代码必须完全自包含，并生成此单行文本，不含任何额外文字。",
            "solution": "该问题已经过验证，并被确定为是合理的。它在科学上基于数值分析和微积分的原理，问题陈述清晰，目标明确，数据充分，且表述客观。所有有效问题的条件均已满足。\n\n任务是为给定的一组在参考四面体 $\\Omega$ 上的求积法则确定其精确度阶数 $p$。精确度阶数是最大的非负整数 $p$，使得该求积法则能将所有总阶数 $i+j+k \\le p$ 的单项式 $x^i y^j z^k$ 在指定的机器精度容差内进行积分。\n\n解决方案分两个主要阶段展开：\n1.  推导在参考四面体上精确单项式矩的封闭形式表达式。\n2.  实现一个数值程序，以测试这些求积法则在递增的多项式阶数下是否与这些精确值相符。\n\n**1. 精确单项式矩的推导**\n\n在参考四面体 $\\Omega$ 上，单项式 $m(x,y,z) = x^i y^j z^k$ 的精确矩由以下积分给出：\n$$\nM_{i,j,k} = \\int_{\\Omega} x^i y^j z^k \\, dV\n$$\n参考四面体定义为 $\\Omega = \\{(x,y,z) \\in \\mathbb{R}^3 \\mid x \\ge 0, y \\ge 0, z \\ge 0, x + y + z \\le 1\\}$。使用 Fubini 定理，这个体积积分可以表示为一个迭代积分：\n$$\nM_{i,j,k} = \\int_{x=0}^{1} x^i \\left( \\int_{y=0}^{1-x} y^j \\left( \\int_{z=0}^{1-x-y} z^k \\, dz \\right) \\, dy \\right) \\, dx\n$$\n我们从内向外计算这个积分。\n\n最内层关于 $z$ 的积分是：\n$$\n\\int_0^{1-x-y} z^k \\, dz = \\left[ \\frac{z^{k+1}}{k+1} \\right]_0^{1-x-y} = \\frac{(1-x-y)^{k+1}}{k+1}\n$$\n这基于提供的基本积分 $\\int_0^a t^n \\, dt = \\frac{a^{n+1}}{n+1}$。\n\n接下来，我们将此结果代入中间关于 $y$ 的积分：\n$$\n\\int_0^{1-x} y^j \\frac{(1-x-y)^{k+1}}{k+1} \\, dy = \\frac{1}{k+1} \\int_0^{1-x} y^j (1-x-y)^{k+1} \\, dy\n$$\n为了解这个积分，我们进行变量替换。令 $y = u(1-x)$，这意味着 $dy = (1-x) \\, du$。$u$ 的积分限为从 $0$ 到 $1$。该积分变为：\n\\begin{align*} \\label{eq:1} \\frac{1}{k+1} \\int_0^1 [u(1-x)]^j (1-x-u(1-x))^{k+1} (1-x) \\, du = \\frac{(1-x)^{j+k+2}}{k+1} \\int_0^1 u^j (1-u)^{k+1} \\, du\\end{align*}\n积分 $\\int_0^1 u^j (1-u)^{k+1} \\, du$ 是 Beta 函数 $B(j+1, k+2)$。利用它与 Gamma 函数（以及整数参数的阶乘）的关系 $B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)} = \\frac{(a-1)!(b-1)!}{(a+b-1)!}$，我们有：\n$$\n\\int_0^1 u^j (1-u)^{k+1} \\, du = B(j+1, k+2) = \\frac{j!(k+1)!}{(j+k+3)!}\n$$\n将此代回，中间积分的计算结果为：\n$$\n\\frac{(1-x)^{j+k+2}}{k+1} \\frac{j!(k+1)!}{(j+k+3)!} = (1-x)^{j+k+2} \\frac{j!k!}{(j+k+2)!}\n$$\n这个表达式在许多标准推导中存在一个印刷错误。正确地， $B(j+1, k+2) = \\frac{\\Gamma(j+1)\\Gamma(k+2)}{\\Gamma(j+1+k+2)} = \\frac{j!(k+1)!}{(j+k+3)!}$。我的分母阶乘公式差了个1。\n因此，中间积分为 $\\frac{(1-x)^{j+k+2}}{k+1} \\frac{j!(k+1)!}{(j+k+2)!} = (1-x)^{j+k+2} \\frac{j!k!}{(j+k+2)!}$。\n\n3. 外层积分：$\\int_0^1 x^i \\left((1-x)^{j+k+2} \\frac{j!k!}{(j+k+2)!}\\right) dx$。\n   $$ \\frac{j!k!}{(j+k+2)!} \\int_0^1 x^i (1-x)^{j+k+2} dx = \\frac{j!k!}{(j+k+2)!} B(i+1, j+k+3) $$\n   $$ = \\frac{j!k!}{(j+k+2)!} \\frac{i!(j+k+2)!}{(i+j+k+3)!} = \\frac{i!j!k!}{(i+j+k+3)!} $$\n推导得到证实。精确矩为 $M_{i,j,k} = \\dfrac{i!j!k!}{(i+j+k+3)!}$。\n\n作为检验，对于 $(i,j,k)=(0,0,0)$，$M_{0,0,0}=\\frac{1}{3!}=\\frac{1}{6}$，这是 $\\Omega$ 的体积。对于 $(i,j,k)=(1,0,0)$，$M_{1,0,0}=\\frac{1}{4!}=\\frac{1}{24}$。形心的坐标是 $\\bar{x} = M_{1,0,0}/M_{0,0,0} = (1/24)/(1/6) = 1/4$，这是正确的。\n\n**2. 确定精确度阶数的算法**\n\n精确度阶数 $p$ 是通过对连续递增的总多项式阶数测试所有矩条件来确定的。设 $d_{\\max}=10$ 为要检查的最大阶数，按要求。\n\n对于一个给定的、由 $N_q$ 个点 $(x_q, y_q, z_q)$ 和权重 $w_q$ 组成的求积法则，算法如下：\n\n1.  初始化精确度阶数 $p_{found} = -1$。\n2.  从 $0$ 到 $d_{\\max}$ 遍历总多项式阶数 $d$。\n3.  对于每个阶数 $d$，遍历所有满足 $i+j+k=d$ 的非负整数组合 $(i,j,k)$。\n4.  对于每个单项式 $x^i y^j z^k$：\n    a. 计算精确矩 $M_{i,j,k} = \\frac{i!j!k!}{(i+j+k+3)!}$。\n    b. 计算求积近似值 $\\widehat{M}_{i,j,k} = \\sum_{q=1}^{N_q} w_q x_q^i y_q^j z_q^k$。\n    c. 定义容差 $\\tau(|M_{i,j,k}|) = c \\, \\varepsilon_{\\mathrm{mach}} \\, \\max(1, |M_{i,j,k}|) + \\tau_0$，其中常数 $c=64$，$\\varepsilon_{\\mathrm{mach}}$ 为双精度浮点数的机器ε，$\\tau_0=10^{-14}$。\n    d. 检查绝对误差是否满足条件：$|\\widehat{M}_{i,j,k} - M_{i,j,k}| \\le \\tau(|M_{i,j,k}|)$。\n    e. 如果对于任何一个 $d$ 阶单项式，该条件不满足，则该法则对于阶数 $d$ 不精确。因此，精确度阶数为 $d-1$。我们记录此结果并终止对当前法则的检查。\n5.  如果 $d$ 阶的所有单项式都在容差范围内被积分，则该法则至少对阶数 $d$ 是精确的。我们更新 $p_{found} = d$ 并继续到下一个阶数 $d+1$。\n6.  如果循环对所有 $d$ 直到 $d_{\\max}$ 都完成了，那么精确度阶数至少为 $d_{\\max}$，因此我们报告 $p_{found} = d_{\\max}$。\n\n此过程应用于所提供的三个测试用例中的每一个。对于测试用例 B，直接使用所提供的 $a$ 和 $b$ 的浮点常数。分析必须严格：如果计算出的误差超过容差，则测试失败，无论该法则在使用精确的无理常数时可能具有何种理论性质。此问题旨在测试“按给定形式”的法则。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the problem of finding the degree of exactness for 3D quadrature rules\n    on the reference tetrahedron.\n    \"\"\"\n\n    # Define the machine precision environment from the problem statement\n    c = 64.0\n    eps_mach = np.finfo(float).eps\n    tau0 = 1e-14\n\n    # Define the quadrature rules for the test suite\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"points\": [(1/4, 1/4, 1/4)],\n            \"weights\": [1/6],\n        },\n        {\n            \"name\": \"B\",\n            \"points\": [\n                (0.5854101966249685, 0.1381966011250105, 0.1381966011250105),\n                (0.1381966011250105, 0.5854101966249685, 0.1381966011250105),\n                (0.1381966011250105, 0.1381966011250105, 0.5854101966249685),\n                (0.1381966011250105, 0.1381966011250105, 0.1381966011250105)\n            ],\n            \"weights\": [1/24, 1/24, 1/24, 1/24],\n        },\n        {\n            \"name\": \"C\",\n            \"points\": [(0.3, 0.2, 0.1)],\n            \"weights\": [1/6],\n        },\n    ]\n\n    memo_factorial = {i: math.factorial(i) for i in range(20)}\n\n    def exact_moment(i, j, k):\n        \"\"\"\n        Calculates the exact moment M_ijk = integral(x^i * y^j * z^k) dV over the\n        reference tetrahedron using the closed-form formula.\n        \"\"\"\n        num = memo_factorial[i] * memo_factorial[j] * memo_factorial[k]\n        den = memo_factorial[i + j + k + 3]\n        return num / den\n\n    def get_degree_of_exactness(rule, d_max):\n        \"\"\"\n        Determines the degree of exactness for a single quadrature rule.\n        \"\"\"\n        points = rule[\"points\"]\n        weights = rule[\"weights\"]\n        \n        for p in range(d_max + 1):\n            # Generate all monomials of total degree p\n            for i in range(p + 1):\n                for j in range(p - i + 1):\n                    k = p - i - j\n\n                    # Calculate exact and approximate moments\n                    m_exact = exact_moment(i, j, k)\n                    \n                    m_approx = 0.0\n                    for q in range(len(points)):\n                        x, y, z = points[q]\n                        w = weights[q]\n                        # Use np.power for safe exponentiation with base 0\n                        m_approx += w * (np.power(x, i) * np.power(y, j) * np.power(z, k))\n\n                    # Check against tolerance\n                    tolerance = c * eps_mach * max(1.0, abs(m_exact)) + tau0\n                    error = abs(m_approx - m_exact)\n                    \n                    if error > tolerance:\n                        return p - 1  # Failed at degree p, so exactness is p-1\n        \n        return d_max # Passed all tests up to d_max\n\n    results = []\n    d_max = 10\n    for case in test_cases:\n        p_exact = get_degree_of_exactness(case, d_max)\n        results.append(p_exact)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}