{
    "hands_on_practices": [
        {
            "introduction": "The distinction between drained and undrained behavior is fundamentally a question of time scales: the duration of loading versus the time required for pore fluid to dissipate. This practice grounds this concept in theory by guiding you through the derivation of the governing consolidation equation to reveal the critical dimensionless time factor, $T_v$. Mastering this analysis provides a foundational tool for predicting whether a geotechnical system will respond in a drained, undrained, or partially drained manner, which is the first step in any realistic analysis .",
            "id": "3569637",
            "problem": "A saturated clay layer is subjected to a vertical surface loading that ramps from zero to its final value over a finite application time. The clay is laterally confined and drains vertically to permeable boundaries at which the excess pore pressure is zero. The characteristic vertical drainage length is given as $H_{d}=2\\,\\mathrm{m}$, and the vertical coefficient of consolidation is constant with value $c_{v}=1\\times 10^{-6}\\,\\mathrm{m}^2/\\mathrm{s}$. The load application time is $t_{\\mathrm{load}}=30\\,\\mathrm{s}$. \n\nStarting from fluid mass conservation and Darcy’s law for a fully saturated, compressible porous medium under one-dimensional conditions, derive the governing linear diffusion equation for excess pore pressure and then non-dimensionalize it using a characteristic pore-pressure scale, the drainage length $H_{d}$, and an unknown characteristic time scale. Identify the single non-dimensional time factor that controls the evolution of excess pore pressure and thereby the drained versus undrained character of the response. Using asymptotic reasoning, propose a dimensionless criterion in terms of this non-dimensional time factor that separates undrained, partially drained, and drained regimes. Evaluate the non-dimensional time factor for the given data at $t=t_{\\mathrm{load}}$ and, based on your criterion, state whether the loading over $t_{\\mathrm{load}}$ produces an undrained, partially drained, or drained response.\n\nReport only the computed value of the non-dimensional time factor at $t=t_{\\mathrm{load}}$ as your final answer. Express this value in scientific notation with two significant figures. No units are required for the reported quantity.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of soil mechanics (Terzaghi's consolidation theory), well-posed, and objective. All necessary data are provided to perform the required derivation and calculation.\n\nThe solution proceeds in four stages: (1) derivation of the governing one-dimensional consolidation equation, (2) non-dimensionalization of the equation to identify the controlling parameter, (3) establishing a criterion for distinguishing between undrained, partially drained, and drained responses based on this parameter, and (4) calculating the value of the parameter for the given problem conditions to classify the response.\n\n**1. Derivation of the Governing Equation**\n\nThe derivation combines the principles of fluid mass conservation (continuity), fluid flow (Darcy's law), and soil skeleton deformation (effective stress principle and a constitutive law). We consider one-dimensional vertical flow and deformation in a saturated soil element, with $z$ as the vertical coordinate.\n\nThe principle of mass conservation for an incompressible pore fluid ($\\rho_w = \\text{constant}$) within a deforming soil skeleton requires that the rate of fluid volume leaving the element equals the rate of volume change of the element. This can be expressed as:\n$$\n\\frac{\\partial v_z}{\\partial z} = -\\frac{\\partial \\epsilon_v}{\\partial t}\n$$\nwhere $v_z$ is the Darcian seepage velocity in the $z$-direction relative to the solid skeleton and $\\epsilon_v$ is the volumetric strain of the soil skeleton (compression is positive). For one-dimensional conditions, the volumetric strain $\\epsilon_v$ is equal to the vertical strain $\\epsilon_{zz}$, so:\n$$\n\\frac{\\partial v_z}{\\partial z} = -\\frac{\\partial \\epsilon_{zz}}{\\partial t}\n$$\nDarcy's law relates the seepage velocity to the gradient of excess pore pressure, $u_e$.\n$$\nv_z = -\\frac{k_v}{\\gamma_w} \\frac{\\partial u_e}{\\partial z}\n$$\nwhere $k_v$ is the coefficient of permeability in the vertical direction and $\\gamma_w$ is the unit weight of water. Differentiating with respect to $z$ yields:\n$$\n\\frac{\\partial v_z}{\\partial z} = -\\frac{k_v}{\\gamma_w} \\frac{\\partial^2 u_e}{\\partial z^2}\n$$\nassuming $k_v$ is constant.\n\nThe deformation of the soil skeleton is governed by the effective stress principle, $\\sigma'_{zz} = \\sigma_{zz} - u_e$, where $\\sigma'_{zz}$ is the effective vertical stress and $\\sigma_{zz}$ is the total vertical stress. For linear elasticity, the change in vertical strain is related to the change in effective stress by the coefficient of volume compressibility, $m_v$:\n$$\nd\\epsilon_{zz} = m_v d\\sigma'_{zz}\n$$\nTaking the time derivative, we get the strain rate:\n$$\n\\frac{\\partial \\epsilon_{zz}}{\\partial t} = m_v \\frac{\\partial \\sigma'_{zz}}{\\partial t} = m_v \\left( \\frac{\\partial \\sigma_{zz}}{\\partial t} - \\frac{\\partial u_e}{\\partial t} \\right)\n$$\nEquating the two expressions for $\\frac{\\partial v_z}{\\partial z}$ (one from continuity/strain and one from Darcy's law) and substituting the expression for the strain rate gives:\n$$\n-\\frac{k_v}{\\gamma_w} \\frac{\\partial^2 u_e}{\\partial z^2} = -m_v \\left( \\frac{\\partial \\sigma_{zz}}{\\partial t} - \\frac{\\partial u_e}{\\partial t} \\right)\n$$\nRearranging and defining the coefficient of consolidation, $c_v = \\frac{k_v}{m_v \\gamma_w}$, we obtain the one-dimensional consolidation equation:\n$$\n\\frac{\\partial u_e}{\\partial t} = c_v \\frac{\\partial^2 u_e}{\\partial z^2} + \\frac{\\partial \\sigma_{zz}}{\\partial t}\n$$\nThe problem asks for the linear diffusion equation governing the evolution (i.e., dissipation) of excess pore pressure. This corresponds to the homogeneous part of the equation, which governs the process once the total stress is constant ($\\frac{\\partial \\sigma_{zz}}{\\partial t} = 0$). This is the classical Terzaghi consolidation equation:\n$$\n\\frac{\\partial u_e}{\\partial t} = c_v \\frac{\\partial^2 u_e}{\\partial z^2}\n$$\n\n**2. Non-dimensionalization and Identification of the Time Factor**\n\nWe introduce the following non-dimensional variables:\n-   Dimensionless coordinate: $z^* = \\frac{z}{H_d}$\n-   Dimensionless time: $t^* = \\frac{t}{t_{char}}$, where $t_{char}$ is a characteristic time scale for the process, which we take to be the time $t$ itself.\n-   Dimensionless excess pore pressure: $u_e^* = \\frac{u_e}{U_c}$, where $U_c$ is a characteristic pressure scale.\n\nWe transform the derivatives in the diffusion equation:\n$$\n\\frac{\\partial u_e}{\\partial t} = U_c \\frac{\\partial u_e^*}{\\partial t} = U_c \\frac{\\partial u_e^*}{\\partial t^*} \\frac{\\partial t^*}{\\partial t} = \\frac{U_c}{t_{char}} \\frac{\\partial u_e^*}{\\partial t^*}\n$$\n$$\n\\frac{\\partial^2 u_e}{\\partial z^2} = \\frac{U_c}{H_d^2} \\frac{\\partial^2 u_e^*}{\\partial (z^*)^2}\n$$\nSubstituting these into the diffusion equation gives:\n$$\n\\frac{U_c}{t_{char}} \\frac{\\partial u_e^*}{\\partial t^*} = c_v \\frac{U_c}{H_d^2} \\frac{\\partial^2 u_e^*}{\\partial (z^*)^2}\n$$\nRearranging the terms to group all parameters:\n$$\n\\frac{\\partial u_e^*}{\\partial t^*} = \\left( \\frac{c_v t_{char}}{H_d^2} \\right) \\frac{\\partial^2 u_e^*}{\\partial (z^*)^2}\n$$\nThe quantity in the parentheses is a dimensionless group that controls the non-dimensional form of the equation. This is the non-dimensional time factor, commonly denoted as $T_v$. It is a function of the dimensional time $t$ (which we used as $t_{char}$):\n$$\nT_v(t) = \\frac{c_v t}{H_d^2}\n$$\nThis single factor determines the extent of consolidation and thus governs the drained versus undrained character of the soil response.\n\n**3. Asymptotic Criterion for Response Regimes**\n\nThe time factor $T_v$ can be interpreted as the ratio of the elapsed time $t$ to the characteristic time required for consolidation, which is $T_c = H_d^2 / c_v$.\n-   **Undrained Response**: If the load is applied over a time $t$ that is much shorter than the characteristic consolidation time $T_c$, then $t \\ll T_c$, which implies $T_v \\ll 1$. In this case, there is insufficient time for pore water to drain, and the fluid pressure rises to support the applied load. This is the undrained limit.\n-   **Drained Response**: If the load is applied over a time $t$ that is much longer than $T_c$, then $t \\gg T_c$, which implies $T_v \\gg 1$. In this case, pore water drains freely as the load is applied, preventing any significant excess pore pressure from building up. The soil skeleton supports the load. This is the drained limit.\n-   **Partially Drained Response**: If the loading time $t$ is of the same order of magnitude as $T_c$, then $t \\approx T_c$, which implies $T_v \\approx 1$. Both pore pressure generation and dissipation occur simultaneously.\n\nBased on this asymptotic reasoning, we can establish a practical criterion using orders of magnitude around $T_v=1$:\n-   Undrained: $T_v < 0.1$\n-   Partially Drained: $0.1 \\le T_v \\le 10$\n-   Drained: $T_v > 10$\n\n**4. Evaluation for the Given Data**\n\nWe are given the following data:\n-   Vertical coefficient of consolidation: $c_v = 1 \\times 10^{-6}\\,\\mathrm{m}^2/\\mathrm{s}$\n-   Characteristic vertical drainage length: $H_d = 2\\,\\mathrm{m}$\n-   Load application time: $t_{\\mathrm{load}} = 30\\,\\mathrm{s}$\n\nWe evaluate the non-dimensional time factor at the end of the loading period, $t = t_{\\mathrm{load}}$:\n$$\nT_v = \\frac{c_v t_{\\mathrm{load}}}{H_d^2} = \\frac{(1 \\times 10^{-6}\\,\\mathrm{m}^2/\\mathrm{s}) \\cdot (30\\,\\mathrm{s})}{(2\\,\\mathrm{m})^2}\n$$\n$$\nT_v = \\frac{30 \\times 10^{-6}}{4} = 7.5 \\times 10^{-6}\n$$\nThe computed value is $T_v = 7.5 \\times 10^{-6}$. Comparing this value to our established criterion:\n$$\n7.5 \\times 10^{-6} \\ll 0.1\n$$\nThe value falls deep within the undrained regime. Therefore, the response of the clay layer to the loading applied over $30\\,\\mathrm{s}$ is undrained. The problem asks only for the numerical value of the non-dimensional time factor.",
            "answer": "$$\\boxed{7.5 \\times 10^{-6}}$$"
        },
        {
            "introduction": "Understanding the time-dependent nature of drainage is the first step; the next is to see its direct impact on the mechanical stress path of the material. This exercise simulates a classic triaxial test where the drainage valve is suddenly closed, forcing a transition from a drained to an undrained state. By deriving the stress path slopes for both conditions, you will quantify the instantaneous \"kink\" in the material's response, providing a clear illustration of the coupling between pore pressure and effective stress .",
            "id": "3569667",
            "problem": "A cylindrical porous specimen is subjected to axisymmetric triaxial loading under small-strain, linear, isotropic poroelasticity. The porous skeleton follows linear elasticity and the pore fluid obeys mass conservation. The specimen is initially loaded under a drained condition where boundary pore pressure is fixed, and at a specified closure time the drainage valve is shut, switching to an undrained condition with zero mass flux across the boundary. The objective is to quantify the instantaneous change in the stress–path direction in mean effective stress–deviatoric stress space when the boundary condition switches from drained to undrained. All quantities must use the soil mechanics sign convention: compression positive.\n\nFundamental base to be used:\n- Small-strain, linear, isotropic elasticity of the porous skeleton with bulk modulus $K$ and shear modulus $G$. The effective Cauchy stress tensor $\\boldsymbol{\\sigma}'$ relates to strains via\n$$\n\\boldsymbol{\\sigma}' = 2 G \\,\\mathbf{e} + K\\, \\epsilon_v\\, \\mathbf{I},\n$$\nwhere $\\mathbf{e}$ is the deviatoric strain tensor, $\\epsilon_v$ is the volumetric strain, and $\\mathbf{I}$ is the identity tensor. Under axisymmetric triaxial conditions with axial strain $\\epsilon_a$ and radial strain $\\epsilon_r$, the deviatoric stress and mean effective stress invariants are\n$$\nq = \\sigma_1' - \\sigma_3' = 2 G \\left(\\epsilon_a - \\epsilon_r\\right), \\quad p' = \\frac{\\sigma_1' + 2 \\sigma_3'}{3} = K\\,\\epsilon_v, \\quad \\epsilon_v = \\epsilon_a + 2 \\epsilon_r.\n$$\n- Biot poroelastic coupling with Biot coefficient $\\alpha$ governing the relation between total stress $\\boldsymbol{\\sigma}$, effective stress $\\boldsymbol{\\sigma}'$, and pore pressure $p$:\n$$\n\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}' + \\alpha p\\, \\mathbf{I}, \\quad \\text{so that}\\quad \\sigma_3' = \\sigma_3 - \\alpha p,\n$$\nfor confining stress $\\sigma_3$ held constant.\n- Lumped (spatially uniform) mass conservation for average pore pressure $p(t)$ with storage coefficient $S$:\n$$\nS \\,\\dot{p} + \\alpha\\, \\dot{\\epsilon}_v = 0 \\quad \\text{(undrained, valve closed)},\n$$\nand the drained boundary condition (valve open) enforces\n$$\np(t) = 0 \\quad \\text{(drained, valve open)}.\n$$\n\nLoading protocol:\n- The axial strain rate is prescribed and constant, $\\dot{\\epsilon}_a = \\text{const} > 0$.\n- The confining total stress $\\sigma_3$ is held constant throughout.\n- The boundary is drained for $t < t_c$, then undrained for $t \\ge t_c$ (valve closure at time $t_c$).\n\nTask:\n1. Starting only from the fundamental base stated above, derive the kinematic relation between the radial strain and the axial strain in the drained stage (for $p(t)=0$) as a linear mapping $\\epsilon_r = B_d \\epsilon_a + C_d$, and from this derive the drained-stage stress–path slope in mean effective stress–deviatoric stress space,\n$$\n\\left(\\frac{dq}{dp'}\\right)_{\\text{drained}} = s_d,\n$$\nexpressed purely in terms of $K$ and $G$ (no dependence on $\\sigma_3$, $\\epsilon_a$, or $t$).\n2. Using only the fundamental base above, derive the rate relation between the radial and axial strains immediately after valve closure in the undrained stage (for $S \\dot{p} + \\alpha \\dot{\\epsilon}_v = 0$), obtain a constant ratio $\\dot{\\epsilon}_r = B_u \\dot{\\epsilon}_a$, and from it derive the undrained-stage stress–path slope\n$$\n\\left(\\frac{dq}{dp'}\\right)_{\\text{undrained}} = s_u,\n$$\nexpressed in terms of $K$, $G$, $\\alpha$, and $S$ (no dependence on $\\sigma_3$, $\\epsilon_a$, or $t$).\n3. Define the instantaneous kink angle at valve closure as the change in the path direction in the $(p', q)$ plane,\n$$\n\\Delta \\theta = \\arctan\\!\\left(s_u\\right) - \\arctan\\!\\left(s_d\\right),\n$$\nexpressed in radians.\n\nYour program must:\n- Take a fixed test suite of parameter sets and, for each set, compute three floats: the drained slope $s_d$, the undrained slope $s_u$, and the kink angle $\\Delta \\theta$ (in radians).\n- Use the following test suite (units in kilopascals for $K$, $G$, and stresses; storage $S$ in $1/\\text{kPa}$; angles in radians):\n    1. Case A (happy path): $K = 10000\\,\\text{kPa}$, $G = 5000\\,\\text{kPa}$, $\\alpha = 0.9$, $S = 2.7\\times 10^{-5}\\,\\text{kPa}^{-1}$.\n    2. Case B (boundary condition: no coupling): $K = 10000\\,\\text{kPa}$, $G = 5000\\,\\text{kPa}$, $\\alpha = 0$, $S = 1.0\\times 10^{-5}\\,\\text{kPa}^{-1}$.\n    3. Case C (edge case: near-incompressible fluid): $K = 10000\\,\\text{kPa}$, $G = 5000\\,\\text{kPa}$, $\\alpha = 1.0$, $S = 1.0\\times 10^{-7}\\,\\text{kPa}^{-1}$.\n- Return the results rounded to six decimal places.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, one per test case, each inner list ordered as $[s_d, s_u, \\Delta \\theta]$, for example: $[[s_{d,A}, s_{u,A}, \\Delta \\theta_A],[s_{d,B}, s_{u,B}, \\Delta \\theta_B],[s_{d,C}, s_{u,C}, \\Delta \\theta_C]]$.",
            "solution": "The user-provided problem statement is subjected to validation prior to any attempt at a solution.\n\n### Step 1: Extract Givens\n- **Porous Skeleton Constitutive Law**: Linear, isotropic elasticity.\n    - Bulk modulus: $K$.\n    - Shear modulus: $G$.\n    - Effective stress-strain relation: $\\boldsymbol{\\sigma}' = 2 G \\,\\mathbf{e} + K\\, \\epsilon_v\\, \\mathbf{I}$, where $\\mathbf{e}$ is the deviatoric strain tensor, $\\epsilon_v$ is the volumetric strain, and $\\mathbf{I}$ is the identity tensor.\n    - Axisymmetric stress and strain invariants (compression positive):\n        - Deviatoric stress: $q = \\sigma_1' - \\sigma_3' = 2 G \\left(\\epsilon_a - \\epsilon_r\\right)$.\n        - Mean effective stress: $p' = \\frac{\\sigma_1' + 2 \\sigma_3'}{3} = K\\,\\epsilon_v$.\n        - Volumetric strain: $\\epsilon_v = \\epsilon_a + 2 \\epsilon_r$.\n- **Poroelastic Coupling**:\n    - Biot coefficient: $\\alpha$.\n    - Total and effective stress relation: $\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}' + \\alpha p\\, \\mathbf{I}$.\n    - Radial stress relation: $\\sigma_3' = \\sigma_3 - \\alpha p$.\n- **Pore Fluid Mass Conservation**:\n    - Storage coefficient: $S$.\n    - Undrained condition (valve closed, $t \\ge t_c$): $S \\,\\dot{p} + \\alpha\\, \\dot{\\epsilon}_v = 0$.\n    - Drained condition (valve open, $t < t_c$): $p(t) = 0$.\n- **Loading Protocol**:\n    - Constant axial strain rate: $\\dot{\\epsilon}_a = \\text{const} > 0$.\n    - Constant total confining stress: $\\sigma_3 = \\text{const}$.\n    - Transition from drained to undrained at closure time $t_c$.\n- **Objective**:\n    1. Derive the drained stress-path slope $s_d = (dq/dp')_{\\text{drained}}$ in terms of $K$ and $G$.\n    2. Derive the undrained stress-path slope $s_u = (dq/dp')_{\\text{undrained}}$ in terms of $K$, $G$, $\\alpha$, and $S$.\n    3. Compute the kink angle $\\Delta \\theta = \\arctan(s_u) - \\arctan(s_d)$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is formulated within the established framework of linear poroelasticity (Biot theory), a fundamental theory in geomechanics. All provided equations are standard representations of the theory. The problem is scientifically sound.\n- **Well-Posedness**: The problem provides a complete set of governing equations, boundary conditions, and loading protocols. It requests the derivation of specific quantities ($s_d$, $s_u$, $\\Delta \\theta$) which are uniquely determined by the provided information. The problem is well-posed.\n- **Objectivity**: The problem is stated using precise, objective, and formal mathematical and physical language, devoid of any subjective or ambiguous terminology.\n- **Conclusion**: The problem statement is free of scientific flaws, inconsistencies, or ambiguities. It is a valid, well-posed problem in continuum mechanics.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\n### Derivation of Stress-Path Slopes\n\nThe objective is to determine the direction of the stress path in the mean effective stress–deviatoric stress ($(p', q)$) plane for both drained and undrained conditions. The slope of this path is given by the ratio of the rates of change of the stress invariants, $dq/dp' = \\dot{q}/\\dot{p}'$.\n\n**1. Drained Stage Slope ($s_d$)**\n\nFor the drained stage ($t < t_c$), two conditions are prescribed: the pore pressure is zero, $p(t) = 0$, and the total confining stress is constant, $\\sigma_3 = \\text{const}$.\n\nFrom the effective stress definition, $\\sigma_3' = \\sigma_3 - \\alpha p$. With $p(t)=0$, this simplifies to $\\sigma_3'(t) = \\sigma_3 = \\text{const}$. Consequently, the time rate of change of the radial effective stress is zero:\n$$\n\\dot{\\sigma}_3' = 0\n$$\nThe principal effective stresses are related to the invariants $p'$ and $q$ by the standard transformation for axisymmetric conditions:\n$$\n\\sigma_3' = p' - \\frac{1}{3}q\n$$\nTaking the time derivative of this expression yields a relationship between the rates of the stress invariants:\n$$\n\\dot{\\sigma}_3' = \\dot{p}' - \\frac{1}{3}\\dot{q}\n$$\nSubstituting the condition $\\dot{\\sigma}_3' = 0$ into this equation gives:\n$$\n0 = \\dot{p}' - \\frac{1}{3}\\dot{q} \\implies \\dot{q} = 3\\dot{p}'\n$$\nThe slope of the stress path in the drained stage is therefore a constant:\n$$\ns_d = \\left(\\frac{dq}{dp'}\\right)_{\\text{drained}} = \\frac{\\dot{q}}{\\dot{p}'} = 3\n$$\nThis result is remarkably simple and, as requested, depends only on constants (and is thus independent of the material parameters $K$ and $G$). The first part of the task, deriving the kinematic relation $\\epsilon_r = B_d \\epsilon_a + C_d$, is an intermediate step that is bypassed by this more direct invariant-based approach, which is sufficient to find $s_d$.\n\n**2. Undrained Stage Slope ($s_u$)**\n\nFor the undrained stage ($t \\ge t_c$), the drainage valve is closed. The governing conditions are the constant total confining stress, $\\sigma_3 = \\text{const}$, and the mass conservation law, $S\\dot{p} + \\alpha\\dot{\\epsilon}_v = 0$.\n\nThe derivation proceeds in several steps:\nFirst, we relate the rates of change of total and effective confining stress. As $\\sigma_3$ is constant, its time rate of change is zero:\n$$\n\\dot{\\sigma}_3 = \\frac{d}{dt}(\\sigma_3' + \\alpha p) = \\dot{\\sigma}_3' + \\alpha\\dot{p} = 0\n$$\nThis gives a direct link between the effective stress rate and the pore pressure rate:\n$$\n\\dot{\\sigma}_3' = -\\alpha\\dot{p}\n$$\nSecond, the undrained flow rule relates the pore pressure rate to the volumetric strain rate:\n$$\n\\dot{p} = -\\frac{\\alpha}{S}\\dot{\\epsilon}_v\n$$\nSubstituting this into the expression for $\\dot{\\sigma}_3'$ yields:\n$$\n\\dot{\\sigma}_3' = -\\alpha \\left(-\\frac{\\alpha}{S}\\dot{\\epsilon}_v\\right) = \\frac{\\alpha^2}{S}\\dot{\\epsilon}_v\n$$\nThird, the constitutive law for the porous skeleton relates the mean effective stress rate $\\dot{p}'$ to the volumetric strain rate $\\dot{\\epsilon}_v$:\n$$\n\\dot{p}' = K\\dot{\\epsilon}_v \\implies \\dot{\\epsilon}_v = \\frac{\\dot{p}'}{K}\n$$\nSubstituting this expression for $\\dot{\\epsilon}_v$ into the equation for $\\dot{\\sigma}_3'$ establishes a relationship between the rates of the two effective stress measures, $\\dot{\\sigma}_3'$ and $\\dot{p}'$:\n$$\n\\dot{\\sigma}_3' = \\frac{\\alpha^2}{S} \\left(\\frac{\\dot{p}'}{K}\\right) = \\frac{\\alpha^2}{KS}\\dot{p}'\n$$\nFinally, we again use the relationship between the stress invariant rates, $\\dot{\\sigma}_3' = \\dot{p}' - \\frac{1}{3}\\dot{q}$, and equate it with the expression just derived:\n$$\n\\dot{p}' - \\frac{1}{3}\\dot{q} = \\frac{\\alpha^2}{KS}\\dot{p}'\n$$\nRearranging to solve for the ratio $\\dot{q}/\\dot{p}'$:\n$$\n\\frac{1}{3}\\dot{q} = \\dot{p}' - \\frac{\\alpha^2}{KS}\\dot{p}' = \\left(1 - \\frac{\\alpha^2}{KS}\\right)\\dot{p}'\n$$\nThis gives the slope of the stress path in the undrained stage:\n$$\ns_u = \\left(\\frac{dq}{dp'}\\right)_{\\text{undrained}} = \\frac{\\dot{q}}{\\dot{p}'} = 3\\left(1 - \\frac{\\alpha^2}{KS}\\right)\n$$\nThis expression depends on $K$, $\\alpha$, and $S$, as requested. The result is notably independent of the shear modulus $G$. This is not an error; it arises because the combination of axisymmetric loading, the constant total confining stress constraint, and the undrained flow rule is sufficient to determine the ratio of stress invariant rates without involving the deviatoric part of the constitutive law.\n\n**3. Instantaneous Kink Angle ($\\Delta\\theta$)**\n\nThe instantaneous change in the stress-path direction upon valve closure is the difference between the angles of the undrained and drained path slopes relative to the $p'$-axis.\n$$\n\\Delta\\theta = \\theta_u - \\theta_d = \\arctan(s_u) - \\arctan(s_d)\n$$\nSubstituting the derived expressions for $s_d$ and $s_u$:\n$$\n\\Delta\\theta = \\arctan\\left(3\\left(1 - \\frac{\\alpha^2}{KS}\\right)\\right) - \\arctan(3)\n$$\nThe angle is expressed in radians. These derived formulae are now implemented to compute the results for the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the drained and undrained stress path slopes and the resulting\n    kink angle for different sets of poroelastic parameters.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (K, G, alpha, S)\n    # Units: K, G in kPa; S in 1/kPa; alpha is dimensionless.\n    test_cases = [\n        # Case A (happy path)\n        (10000.0, 5000.0, 0.9, 2.7e-5),\n        # Case B (boundary condition: no coupling)\n        (10000.0, 5000.0, 0.0, 1.0e-5),\n        # Case C (edge case: near-incompressible fluid)\n        (10000.0, 5000.0, 1.0, 1.0e-7),\n    ]\n\n    results = []\n    for case in test_cases:\n        K, G, alpha, S = case\n\n        # 1. Calculate the drained slope (s_d)\n        # As derived, s_d = 3 for a standard triaxial compression test\n        # with constant confining total stress.\n        s_d = 3.0\n\n        # 2. Calculate the undrained slope (s_u)\n        # As derived, s_u = 3 * (1 - alpha^2 / (K * S))\n        # The product KS is the inverse of the unjacketed pore pressure coefficient B.\n        # This term cannot be zero for the given physical parameters.\n        ks_product = K * S\n        s_u = 3.0 * (1 - alpha**2 / ks_product)\n\n        # 3. Calculate the kink angle (Delta_theta) in radians\n        # Delta_theta = arctan(s_u) - arctan(s_d)\n        delta_theta = np.arctan(s_u) - np.arctan(s_d)\n\n        # Round results to six decimal places as required.\n        rounded_s_d = round(s_d, 6)\n        rounded_s_u = round(s_u, 6)\n        rounded_delta_theta = round(delta_theta, 6)\n        \n        results.append([rounded_s_d, rounded_s_u, rounded_delta_theta])\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists.\n    # The join operation on string representations of the inner lists\n    # produces the requested comma-separated output.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Simulating the nearly incompressible behavior of soil under undrained conditions poses a significant challenge for standard finite element formulations. This computational practice dives into the numerical pathology known as 'volumetric locking,' where displacement-only elements yield overly stiff results and spurious pressure fields. By implementing and contrasting a standard element with a stable mixed displacement-pressure ($u-p$) formulation, you will gain firsthand experience with a critical issue in computational geomechanics and learn the standard technique to ensure accurate and robust simulations .",
            "id": "3569644",
            "problem": "Design and implement a convergence study to numerically demonstrate volumetric locking and pressure oscillations of displacement-only finite elements under undrained conditions, and to contrast them with a mixed displacement–pressure formulation that remains robust as the undrained limit is approached. The study must be performed in the context of two-dimensional, small-strain, quasi-static linear elasticity on the unit square domain, with a uniform shear-type Dirichlet boundary condition. The governing starting point is the principle of virtual work coupled with the kinematics of small strains, isotropic linear elastic constitutive equations, and the definition of bulk modulus and pressure from volumetric strain. Specifically, use the following fundamental base:\n\n- Kinematics: the symmetric small-strain tensor is defined by $\\varepsilon(\\mathbf{u}) = \\tfrac{1}{2}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}}\\right)$ and the divergence is $\\nabla\\cdot\\mathbf{u} = \\partial u_x/\\partial x + \\partial u_y/\\partial y$.\n- Isotropic linear elasticity: the Cauchy stress is $\\boldsymbol{\\sigma} = 2\\mu\\,\\varepsilon(\\mathbf{u}) + \\lambda\\,\\mathrm{tr}(\\varepsilon(\\mathbf{u}))\\mathbf{I}$, where $\\mu$ is the shear modulus and $\\lambda$ is the first Lamé parameter. The bulk modulus is $\\kappa = \\lambda + \\tfrac{2}{3}\\mu$ and the pressure is defined by $p = -\\kappa\\,\\mathrm{tr}(\\varepsilon(\\mathbf{u}))$.\n- Quasi-static equilibrium in the absence of body forces: $\\nabla\\cdot\\boldsymbol{\\sigma} = \\mathbf{0}$ in $\\Omega$ with Dirichlet boundary conditions prescribed on $\\partial\\Omega$.\n\nIn the undrained limit of poroelastic media, the undrained Poisson’s ratio tends to $0.5$ and the skeleton behaves nearly incompressibly. In the purely elastic surrogate adopted here, this is modeled by the limit $\\kappa \\to \\infty$ at fixed $\\mu$, making $\\lambda$ large and inducing locking in displacement-only discretizations. You must implement two formulations:\n\n1. A standard displacement-only formulation (denoted $u$-only) with bilinear quadrilateral finite elements, where the constitutive stiffness uses $\\lambda = \\kappa - \\tfrac{2}{3}\\mu$ and $\\mu$ as given. This discretization is known to volumetrically lock as $\\kappa \\to \\infty$.\n2. A mixed displacement–pressure formulation (denoted $u$–$p$) with bilinear $Q_1$ displacement and piecewise-constant $P_0$ pressure unknowns, using the deviatoric elastic energy and a pressure–divergence coupling. The weak form is\n$$\n\\int_{\\Omega} 2\\mu\\,\\varepsilon(\\mathbf{u}):\\varepsilon(\\mathbf{v})\\,\\mathrm{d}\\Omega - \\int_{\\Omega} p\\,(\\nabla\\cdot\\mathbf{v})\\,\\mathrm{d}\\Omega + \\int_{\\Omega} q\\,(\\nabla\\cdot\\mathbf{u})\\,\\mathrm{d}\\Omega - \\int_{\\Omega} \\tfrac{1}{\\kappa}\\,p\\,q\\,\\mathrm{d}\\Omega = 0,\n$$\nfor all admissible virtual displacements $\\mathbf{v}$ and test pressures $q$. The last term weakly relaxes incompressibility at finite $\\kappa$ and tends to an incompressibility constraint as $\\kappa \\to \\infty$.\n\nGeometric and loading setup:\n- Domain $\\Omega = [0,1]\\times[0,1]$ discretized by a uniform $Q_1$ mesh with $n_x\\times n_y$ elements. Let $h_x = 1/n_x$ and $h_y = 1/n_y$.\n- Prescribe a uniform shear-type boundary condition: on the bottom edge $y=0$, set $u_x=0$ and $u_y=0$; on the top edge $y=1$, set $u_x=\\gamma$ and $u_y=0$; on the left and right edges, no Dirichlet constraints are applied. Use $\\gamma$ as a dimensionless shear parameter.\n- Use the shear modulus $\\mu = 1$ (dimensionless) and vary the bulk modulus $\\kappa$ as specified in the test suite.\n\nPressure oscillation metric:\n- For the $u$-only formulation, compute an elementwise pressure proxy using $p_e = -\\kappa\\,\\overline{\\nabla\\cdot\\mathbf{u}}_e$, where $\\overline{\\nabla\\cdot\\mathbf{u}}_e$ is the element-averaged divergence computed by quadrature. For the $u$–$p$ formulation, the elementwise pressure is the discrete unknown $p_e$.\n- Define the dimensionless root-mean-square (RMS) pressure oscillation as\n$$\n\\Pi = \\frac{\\sqrt{\\tfrac{1}{N_e}\\sum_{e=1}^{N_e}\\left(p_e - \\overline{p}\\right)^2}}{\\mu\\,\\gamma},\n$$\nwhere $N_e$ is the number of elements and $\\overline{p}$ is the mean pressure over all elements. This gives a dimensionless measure of spurious pressure fluctuation under nominally isochoric shear. The final answers have no physical units.\n\nAlgorithmic constraints and numerical details:\n- Implement bilinear $Q_1$ elements with $2\\times 2$ Gauss quadrature for all element integrals. For the $u$–$p$ coupling, use piecewise-constant $P_0$ pressure and exact elementwise divergence integration by the same quadrature.\n- Assemble global sparse matrices and solve linear systems using direct sparse solvers. Enforce Dirichlet boundary conditions strongly by elimination.\n- Use $\\gamma = 10^{-2}$ and $\\mu = 1$ fixed for all tests. Use the plane strain form as implied by the adopted $2$D constitutive equations.\n\nTest suite:\nProvide results for the following four test cases, each specified by the tuple $(n_x, n_y, \\kappa)$:\n- Case A (happy path, moderately compressible): $(4,4,10^3)$.\n- Case B (nearly undrained): $(4,4,10^6)$.\n- Case C (mesh refinement under undrained conditions): $(8,8,10^6)$.\n- Case D (coarse mesh under undrained conditions): $(2,2,10^6)$.\n\nFor each case, compute and return the pair $[\\Pi_{u\\text{-only}}, \\Pi_{u\\text{-}p}]$ as floating-point numbers.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each item is a two-element list for the corresponding test case, in the order A, B, C, D. For example, the output must look like\n\"[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]\"\nwith each $a_i$ and $b_i$ being floating-point numbers representing $\\Pi_{u\\text{-only}}$ and $\\Pi_{u\\text{-}p}$ respectively. No units are required, and angles do not appear. All numbers in the output are pure floats. The program must not read any input.",
            "solution": "The problem presented is a well-posed and scientifically sound exercise in computational solid mechanics, specifically addressing the numerical pathology of volumetric locking in nearly incompressible elasticity. A convergence study is to be designed to contrast a standard low-order displacement-only finite element formulation, which is known to lock, with a stable mixed displacement-pressure formulation.\n\nThe analysis is based on established principles of continuum mechanics and the finite element method (FEM). The governing equations stem from quasi-static equilibrium, $\\nabla\\cdot\\boldsymbol{\\sigma} = \\mathbf{0}$, combined with small-strain kinematics, $\\varepsilon(\\mathbf{u}) = \\tfrac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}})$, and a linear isotropic elastic constitutive law, $\\boldsymbol{\\sigma} = 2\\mu\\,\\varepsilon(\\mathbf{u}) + \\lambda\\,\\mathrm{tr}(\\varepsilon(\\mathbf{u}))\\mathbf{I}$. The nearly incompressible, or undrained, limit is introduced by letting the bulk modulus $\\kappa = \\lambda + \\tfrac{2}{3}\\mu$ become very large, which implies a large Lamé parameter $\\lambda$.\n\n### Formulation 1: Displacement-Only ($u$-only)\n\nThe standard weak form is derived from the principle of virtual work, which states that for any kinematically admissible virtual displacement $\\mathbf{v}$ that vanishes on the Dirichlet boundary, the internal virtual work must equal the external virtual work. In the absence of body forces and with prescribed displacements, this leads to:\n$$\n\\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{u}) : \\varepsilon(\\mathbf{v}) \\,\\mathrm{d}\\Omega = 0\n$$\nSubstituting the constitutive relation gives:\n$$\n\\int_{\\Omega} \\left( 2\\mu\\,\\varepsilon(\\mathbf{u}):\\varepsilon(\\mathbf{v}) + \\lambda\\,\\mathrm{tr}(\\varepsilon(\\mathbf{u}))\\,\\mathrm{tr}(\\varepsilon(\\mathbf{v})) \\right) \\,\\mathrm{d}\\Omega = 0\n$$\nThis equation is discretized using bilinear ($Q_1$) finite elements for the displacement field $\\mathbf{u}$. A linear system $\\mathbf{K}\\mathbf{U} = \\mathbf{F}$ is assembled, where $\\mathbf{U}$ is the vector of nodal displacements and $\\mathbf{K}$ is the global stiffness matrix. The element stiffness matrix is given by:\n$$\n\\mathbf{K}^e = \\int_{\\Omega_e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{C} \\mathbf{B} \\,\\mathrm{d}\\Omega\n$$\nwhere $\\mathbf{B}$ is the discrete strain-displacement matrix and $\\mathbf{C}$ is the plane strain material stiffness matrix based on the given $\\mu$ and $\\lambda = \\kappa - \\frac{2}{3}\\mu$.\n\nAs $\\kappa \\to \\infty$, so does $\\lambda$. The term $\\lambda\\,\\mathrm{tr}(\\varepsilon(\\mathbf{u}))\\,\\mathrm{tr}(\\varepsilon(\\mathbf{v}))$ acts as a penalty term enforcing the incompressibility constraint $\\nabla\\cdot\\mathbf{u} = 0$. However, the $Q_1$ element's displacement field is too simple to satisfy this constraint without being overly constrained. For a single element, a bilinear displacement field results in a divergence that is linear, $\\nabla\\cdot\\mathbf{u} = c_1 + c_2 x + c_3 y$. Enforcing this to be zero everywhere in the element imposes three constraints on the element's eight displacement degrees of freedom. This disparity in the richness of the displacement space versus the constraint space leads to an artificially stiff response known as volumetric locking. A consequence of this is that the pressure field, which is proportional to the divergence, becomes non-physical and highly oscillatory.\n\n### Formulation 2: Mixed Displacement-Pressure ($u-p$)\n\nTo circumvent locking, a mixed formulation is employed where pressure $p$ is introduced as an independent field variable. The problem specifies the following weak form for all admissible virtual displacements $\\mathbf{v}$ and test pressures $q$:\n$$\n\\int_{\\Omega} 2\\mu\\,\\varepsilon(\\mathbf{u}):\\varepsilon(\\mathbf{v})\\,\\mathrm{d}\\Omega - \\int_{\\Omega} p\\,(\\nabla\\cdot\\mathbf{v})\\,\\mathrm{d}\\Omega + \\int_{\\Omega} q\\,(\\nabla\\cdot\\mathbf{u})\\,\\mathrm{d}\\Omega - \\int_{\\Omega} \\tfrac{1}{\\kappa}\\,p\\,q\\,\\mathrm{d}\\Omega = 0\n$$\nHere, the displacement field $\\mathbf{u}$ is discretized with bilinear $Q_1$ elements and the pressure field $p$ with piecewise-constant $P_0$ elements (one pressure unknown per element). This discretization results in a saddle-point linear system of the form:\n$$\n\\begin{pmatrix} \\mathbf{K} & -\\mathbf{G} \\\\ \\mathbf{G}^{\\mathsf{T}} & -\\mathbf{M} \\end{pmatrix} \\begin{pmatrix} \\mathbf{U} \\\\ \\mathbf{P} \\end{pmatrix} = \\begin{pmatrix} \\mathbf{F} \\\\ \\mathbf{0} \\end{pmatrix}\n$$\nThe matrices are derived from the terms in the weak form:\n- $\\mathbf{K}$ arises from $\\int 2\\mu\\,\\varepsilon(\\mathbf{u}):\\varepsilon(\\mathbf{v})\\,\\mathrm{d}\\Omega$.\n- $\\mathbf{G}$ (the gradient-divergence operator) from $-\\int p(\\nabla\\cdot\\mathbf{v})\\,\\mathrm{d}\\Omega$.\n- $\\mathbf{G}^{\\mathsf{T}}$ from $\\int q(\\nabla\\cdot\\mathbf{u})\\,\\mathrm{d}\\Omega$.\n- $\\mathbf{M}$ (the pressure mass matrix) from $-\\int \\frac{1}{\\kappa}pq\\,\\mathrm{d}\\Omega$. This term is diagonal since the $P_0$ basis functions have disjoint support.\n\nThe $Q_1/P_0$ element pair is known to be LBB-stable (satisfying the inf-sup or Ladyzhenskaya-Babuška-Brezzi condition), which guarantees existence, uniqueness, and stability of the solution to the mixed problem. The number of pressure constraints is appropriately balanced with the displacement degrees of freedom, preventing locking and yielding a stable, meaningful pressure field even as $\\kappa \\to \\infty$.\n\n### Algorithmic Implementation\n\nA Python script is designed to implement both formulations and compute the pressure oscillation metric $\\Pi$.\n\n1.  **Meshing**: A structured quadrilateral mesh is generated for the unit square $\\Omega = [0,1]\\times[0,1]$. Node and element connectivity are established.\n2.  **FEM Assembly**: For each element, local matrices are computed using $2\\times 2$ Gauss quadrature.\n    - The strain-displacement matrix $\\mathbf{B}$ is formed from the derivatives of the $Q_1$ shape functions.\n    - For the $u$-only case, the element stiffness $\\mathbf{K}^e$ is computed using the standard isotropic plane strain constitutive matrix $\\mathbf{C}$.\n    - For the $u-p$ case, the stiffness block $\\mathbf{K}^e$, coupling block $\\mathbf{G}^e$, and mass block $\\mathbf{M}^e$ are computed according to the specified weak form.\n    - These local matrices are assembled into a global sparse matrix system. For the $u-p$ system, displacement DOFs are ordered first, followed by pressure DOFs.\n3.  **Boundary Conditions**: Dirichlet boundary conditions are enforced strongly by elimination. This is implemented by partitioning the global system into free and constrained degrees of freedom. A reduced system involving only the free DOFs is solved, and the full solution vector is reconstructed.\n4.  **Linear Solve**: The resulting sparse linear system is solved using a direct solver (`scipy.sparse.linalg.spsolve`).\n5.  **Post-processing**:\n    - For the $u$-only case, element-wise pressure $p_e$ is calculated by averaging the divergence over each element, $p_e = -\\kappa\\,\\overline{\\nabla\\cdot\\mathbf{u}}_e$.\n    - For the $u-p$ case, the element-wise pressures $p_e$ are the solution values corresponding to the pressure DOFs.\n    - The pressure oscillation metric $\\Pi$ is computed as the standard deviation of element pressures, normalized by the characteristic shear stress $\\mu\\gamma$.\n\nThis systematic approach allows for a direct numerical comparison of the two formulations under the conditions specified in the test suite, demonstrating the robustness of the mixed method in the nearly incompressible limit where the standard displacement method fails.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef get_q1_shape_functions_and_derivs(xi, eta):\n    \"\"\"\n    Computes Q1 shape functions and their derivatives w.r.t. local coords (xi, eta).\n    Nodes are ordered counter-clockwise starting from (-1, -1).\n    \"\"\"\n    N = 0.25 * np.array([\n        (1 - xi) * (1 - eta),\n        (1 + xi) * (1 - eta),\n        (1 + xi) * (1 + eta),\n        (1 - xi) * (1 + eta)\n    ])\n    \n    dN_dxi = 0.25 * np.array([\n        -(1 - eta),\n        (1 - eta),\n        (1 + eta),\n        -(1 + eta)\n    ])\n\n    dN_deta = 0.25 * np.array([\n        -(1 - xi),\n        -(1 + xi),\n        (1 + xi),\n        (1 - xi)\n    ])\n    \n    return N, dN_dxi, dN_deta\n\ndef solve_fem(nx, ny, kappa, mu, gamma, formulation):\n    \"\"\"\n    Solves the 2D elasticity problem on the unit square using FEM.\n    \"\"\"\n    # 1. Mesh generation\n    nnx, nny = nx + 1, ny + 1\n    n_nodes = nnx * nny\n    n_elem = nx * ny\n    \n    hx, hy = 1.0 / nx, 1.0 / ny\n    \n    node_coords = np.zeros((n_nodes, 2))\n    for j in range(nny):\n        for i in range(nnx):\n            node_idx = i + j * nnx\n            node_coords[node_idx] = [i * hx, j * hy]\n\n    elem_conn = np.zeros((n_elem, 4), dtype=int)\n    for j in range(ny):\n        for i in range(nx):\n            elem_idx = i + j * nx\n            n0 = i + j * nnx\n            elem_conn[elem_idx] = [n0, n0 + 1, n0 + 1 + nnx, n0 + nnx]\n\n    # 2. Quadrature points and weights for 2x2 Gauss\n    gp_coords = [-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)]\n    gp_weight = 1.0\n    \n    # 3. System assembly\n    u_dofs = 2 * n_nodes\n    p_dofs = n_elem if formulation == 'u-p' else 0\n    total_dofs = u_dofs + p_dofs\n    \n    K_global = lil_matrix((total_dofs, total_dofs))\n    F_global = np.zeros(total_dofs)\n\n    det_J = (hx / 2.0) * (hy / 2.0)\n\n    if formulation == 'u-only':\n        lam = kappa - (2.0/3.0) * mu\n        C_mat = np.array([[lam + 2*mu, lam, 0],\n                          [lam, lam + 2*mu, 0],\n                          [0, 0, mu]])\n    elif formulation == 'u-p':\n        C_mat_up = np.array([[2*mu, 0, 0],\n                             [0, 2*mu, 0],\n                             [0, 0, mu]])\n\n    for e in range(n_elem):\n        node_indices = elem_conn[e]\n        dof_indices = np.ravel([[2*n, 2*n+1] for n in node_indices])\n        \n        Ke = np.zeros((8, 8))\n        if formulation == 'u-p':\n            Ge = np.zeros(8)\n            Me_val = hx * hy / kappa\n\n        for xi in gp_coords:\n            for eta in gp_coords:\n                _, dN_dxi, dN_deta = get_q1_shape_functions_and_derivs(xi, eta)\n                \n                # Jacobian for rectangular elements is constant\n                dN_dx = dN_dxi * 2.0 / hx\n                dN_dy = dN_deta * 2.0 / hy\n\n                B_mat = np.zeros((3, 8))\n                for i in range(4):\n                    B_mat[0, 2*i]     = dN_dx[i]\n                    B_mat[1, 2*i+1]   = dN_dy[i]\n                    B_mat[2, 2*i]     = dN_dy[i]\n                    B_mat[2, 2*i+1]   = dN_dx[i]\n                \n                if formulation == 'u-only':\n                    Ke += B_mat.T @ C_mat @ B_mat * gp_weight * gp_weight * det_J\n                elif formulation == 'u-p':\n                    Ke += B_mat.T @ C_mat_up @ B_mat * gp_weight * gp_weight * det_J\n                    div_N_vec = np.ravel([[dN_dx[i], dN_dy[i]] for i in range(4)])\n                    Ge += div_N_vec * gp_weight * gp_weight * det_J\n\n        K_global[np.ix_(dof_indices, dof_indices)] += Ke\n        if formulation == 'u-p':\n            p_idx = u_dofs + e\n            K_global[dof_indices, p_idx] = -Ge\n            K_global[p_idx, dof_indices] = Ge\n            K_global[p_idx, p_idx] = -Me_val\n            \n    # 4. Apply Boundary Conditions\n    bottom_nodes = np.arange(nnx)\n    top_nodes = np.arange(n_nodes - nnx, n_nodes)\n\n    constrained_dofs = []\n    constrained_vals = []\n    \n    # Bottom edge: u_x = 0, u_y = 0\n    for node in bottom_nodes:\n        constrained_dofs.extend([2*node, 2*node + 1])\n        constrained_vals.extend([0.0, 0.0])\n    \n    # Top edge: u_x = gamma, u_y = 0\n    for node in top_nodes:\n        constrained_dofs.extend([2*node, 2*node + 1])\n        constrained_vals.extend([gamma, 0.0])\n        \n    all_dofs = np.arange(total_dofs)\n    free_dofs = np.setdiff1d(all_dofs, constrained_dofs)\n    \n    K_free = K_global[np.ix_(free_dofs, free_dofs)].tocsc()\n    \n    F_mod = F_global[free_dofs] - K_global[free_dofs, :][:, constrained_dofs] @ np.array(constrained_vals)\n\n    # 5. Solve linear system\n    sol_free = spsolve(K_free, F_mod)\n    \n    solution = np.zeros(total_dofs)\n    solution[free_dofs] = sol_free\n    solution[constrained_dofs] = constrained_vals\n\n    # 6. Post-processing and metric calculation\n    if formulation == 'u-only':\n        pressures = np.zeros(n_elem)\n        for e in range(n_elem):\n            node_indices = elem_conn[e]\n            dof_indices = np.ravel([[2*n, 2*n+1] for n in node_indices])\n            u_e = solution[dof_indices]\n            \n            div_u_avg = 0.0\n            for xi in gp_coords:\n                for eta in gp_coords:\n                    _, dN_dxi, dN_deta = get_q1_shape_functions_and_derivs(xi, eta)\n                    dN_dx = dN_dxi * 2.0 / hx\n                    dN_dy = dN_deta * 2.0 / hy\n                    \n                    div_u_at_gp = 0.0\n                    for i in range(4):\n                        div_u_at_gp += dN_dx[i] * u_e[2*i] + dN_dy[i] * u_e[2*i+1]\n                    div_u_avg += div_u_at_gp * gp_weight * gp_weight * det_J\n\n            area = hx * hy\n            pressures[e] = -kappa * div_u_avg / area\n    else: # u-p\n        pressures = solution[u_dofs:]\n        \n    p_mean = np.mean(pressures)\n    p_std = np.sqrt(np.mean((pressures - p_mean)**2))\n    \n    pi_metric = p_std / (mu * gamma)\n    \n    return pi_metric\n\ndef solve():\n    test_cases = [\n        (4, 4, 10**3),  # Case A\n        (4, 4, 10**6),  # Case B\n        (8, 8, 10**6),  # Case C\n        (2, 2, 10**6)   # Case D\n    ]\n    mu = 1.0\n    gamma = 1e-2\n\n    results = []\n    for nx, ny, kappa in test_cases:\n        pi_u_only = solve_fem(nx, ny, kappa, mu, gamma, 'u-only')\n        pi_u_p = solve_fem(nx, ny, kappa, mu, gamma, 'u-p')\n        results.append([pi_u_only, pi_u_p])\n\n    # Format output to match specification \"[[a_1,b_1],[a_2,b_2],...]\"\n    result_str = \",\".join([f\"[{v[0]},{v[1]}]\" for v in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}