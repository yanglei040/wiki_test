{
    "hands_on_practices": [
        {
            "introduction": "The core of any adaptive finite element method is the `SOLVE -> ESTIMATE -> MARK -> REFINE` cycle. This exercise focuses on the \"MARK\" step, where a decision is made about which elements to refine based on local error indicators. The Dörfler marking strategy provides a mathematically robust and provably efficient criterion for selecting a minimal set of elements that captures a significant fraction of the total estimated error, guiding the mesh adaptation process where it is most needed. Practicing this fundamental algorithm helps build intuition for how local error contributions drive global adaptive refinement. ",
            "id": "3571719",
            "problem": "In a two-dimensional plane-strain linear elastic analysis using the Finite Element Method (FEM), consider an adaptive refinement strategy that combines element subdivision ($h$-refinement) and polynomial degree elevation ($p$-refinement), commonly referred to as $hp$-adaptivity. Let a posteriori error estimation be employed to guide refinement by assigning nonnegative element-wise indicators $\\{\\eta_{i}\\}$ that estimate the local contribution to the energy norm of the discretization error. A common selection strategy is Dörfler marking, which prescribes selecting a minimal subset of elements such that the sum of their indicators reaches a specified fraction of the total indicator sum. Suppose that for a mesh with five elements, the element indicators are given by the multiset $\\{0.5, 0.3, 0.1, 0.05, 0.05\\}$, and the Dörfler marking parameter is $\\theta = 0.5$. Under the assumption that the error indicators are additive with respect to the global energy norm proxy and that marking is performed to satisfy the Dörfler criterion with minimal cardinality, determine the minimal number of elements that must be marked. Provide your final answer as a single integer. No rounding is needed, and no units are required.",
            "solution": "The user has provided a problem statement concerning an adaptive refinement strategy in the Finite Element Method (FEM). This response will first validate the problem's integrity and then, if valid, proceed to a complete solution.\n\n### Step 1: Extract Givens\n- **Analysis Type**: Two-dimensional plane-strain linear elastic analysis using the Finite Element Method (FEM).\n- **Refinement Strategy**: $hp$-adaptivity.\n- **Error Estimation**: A posteriori, with element-wise error indicators $\\{\\eta_{i}\\}$.\n- **Marking Strategy**: Dörfler marking.\n- **Dörfler Criterion**: Select a minimal subset of elements such that the sum of their indicators reaches a specified fraction, defined by a parameter $\\theta$, of the total indicator sum.\n- **Mesh Data**: The mesh consists of $5$ elements.\n- **Error Indicators**: The multiset of element indicators is $\\{\\eta_{i}\\} = \\{0.5, 0.3, 0.1, 0.05, 0.05\\}$.\n- **Dörfler Parameter**: $\\theta = 0.5$.\n- **Assumption**: The error indicators are additive with respect to the global energy norm proxy.\n- **Objective**: Determine the minimal number of elements that must be marked to satisfy the Dörfler criterion.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is evaluated against the established validation criteria.\n- **Scientific Grounding**: The problem is well-grounded in the theory of adaptive finite element methods, a standard and important topic in computational mechanics and numerical analysis. Dörfler marking (also known as bulk chasing) is a cornerstone of provably optimal adaptive algorithms. All concepts are scientifically sound.\n- **Well-Posedness**: The problem is well-posed. It provides a complete set of data (indicators, marking parameter) and a clear, unambiguous rule (Dörfler criterion with minimal cardinality) which leads to a unique solution.\n- **Objectivity**: The language is precise, quantitative, and free of any subjectivity or bias.\n\nThe problem statement does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or ambiguity. It presents a standard, well-defined task in computational science.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A solution will be derived.\n\n### Solution Derivation\nThe problem requires the application of the Dörfler marking strategy to a given set of element error indicators. The goal is to identify the smallest subset of elements for refinement whose summed error indicators meet a certain threshold.\n\nLet the set of all elements in the mesh be denoted by $\\mathcal{T}$. The number of elements is $|\\mathcal{T}| = 5$.\nThe element-wise error indicators are given by the multiset $\\{\\eta_i\\} = \\{0.5, 0.3, 0.1, 0.05, 0.05\\}$.\nThe Dörfler marking parameter is $\\theta = 0.5$.\n\nThe Dörfler marking criterion requires finding a subset of marked elements, $\\mathcal{M} \\subseteq \\mathcal{T}$, such that two conditions are met:\n$1$. The sum of the indicators of the marked elements is at least a fraction $\\theta$ of the total sum of all indicators. Mathematically, this is expressed as:\n$$ \\sum_{\\eta \\in \\mathcal{M}} \\eta \\ge \\theta \\sum_{\\eta_i \\in \\{\\eta_i\\}} \\eta_i $$\n$2$. The cardinality of the set $\\mathcal{M}$, denoted $|\\mathcal{M}|$, must be minimal.\n\nFirst, we calculate the total sum of the error indicators for all elements in the mesh:\n$$ \\sum_{i=1}^{5} \\eta_i = 0.5 + 0.3 + 0.1 + 0.05 + 0.05 = 1.0 $$\n\nNext, we calculate the target sum required by the Dörfler criterion. This is the fraction $\\theta$ of the total sum:\n$$ \\text{Target Sum} = \\theta \\sum_{i=1}^{5} \\eta_i = 0.5 \\times 1.0 = 0.5 $$\n\nTo satisfy the criterion with the minimal number of elements, we must adopt a greedy strategy. This involves sorting the elements by their error indicators in descending order and accumulating their sum until the target sum is reached or exceeded. This procedure guarantees that the threshold is met with the fewest possible elements.\n\nThe error indicators sorted in descending order are: $\\{0.5, 0.3, 0.1, 0.05, 0.05\\}$.\n\nWe now iteratively select elements with the highest indicators and add them to our marked set $\\mathcal{M}$ until their cumulative sum meets the target of $0.5$.\n\n- **Step 1**: Select the element with the largest indicator, $\\eta_1 = 0.5$.\n  - The cumulative sum is $0.5$.\n  - The number of marked elements is $1$.\n  - We check if the cumulative sum meets the criterion: $0.5 \\ge 0.5$. The condition is satisfied.\n\nSince the condition is met with the very first element (the one with the largest error indicator), we do not need to mark any other elements. The minimal number of elements to be marked is therefore $1$. The minimal subset of elements to be marked corresponds to the single indicator $\\eta = 0.5$.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "When an $hp$-adaptive strategy marks an element for polynomial enrichment ($p$-refinement), a potential mismatch in polynomial degrees arises at the interface with its neighbors. To ensure the global solution remains continuous ($C^0$ conformity), we must enforce constraints on the degrees of freedom along these non-conforming edges. This is achieved by defining the higher-order displacement trace as an interpolation, or \"prolongation,\" of the lower-order one. This hands-on derivation of the constraint matrix from first principles illuminates the essential mechanics of handling \"hanging nodes\" in the polynomial space, a critical implementation detail for robust $hp$-FEM codes. ",
            "id": "3571687",
            "problem": "Consider two two-dimensional finite elements in a computational solid mechanics mesh that share a straight edge. Adopt the usual reference parametrization of the shared edge by the coordinate $s \\in [-1,1]$, with $s=-1$ and $s=1$ corresponding to the left and right vertices of the edge in the global orientation. The left element is a polynomial degree $p=3$ element and the right element is a polynomial degree $p=1$ element. Assume that along the shared edge, the degree of freedom representation is purely scalar and corresponds to the trace of the displacement field.\n\nOn the degree $p=3$ element, assume the edge trace space is the full polynomial space of degree at most three and that edge degrees of freedom are defined by nodal values at the four Legendre–Gauss–Lobatto points along the edge. By the standard definition, the Legendre–Gauss–Lobatto nodes for degree $p=3$ are the endpoints $s=\\pm 1$ and the two interior points at the roots of $(1-s^{2}) P_{3}'(s)$, where $P_{3}(s)$ is the degree-$3$ Legendre polynomial. On the degree $p=1$ element, assume the edge trace space is the polynomial space of degree at most one with degrees of freedom given by nodal values at $s=-1$ and $s=1$.\n\nEnforce $C^{0}$ continuity of the displacement trace across the shared edge by requiring that the trace on the degree $p=3$ side is the prolongation of the degree $p=1$ trace into the higher-order nodal space along the edge. Specifically, let the restriction operator map the degree $p=3$ nodal trace to the unique degree $\\leq 1$ polynomial by retaining the endpoint values, and let the prolongation operator map the degree $p=1$ nodal trace to the degree $p=3$ nodal trace by evaluating the degree $\\leq 1$ interpolant at the four Legendre–Gauss–Lobatto nodes.\n\nDerive the explicit $4 \\times 2$ constraint (prolongation) matrix $\\mathbf{P}$ such that, if $\\mathbf{u}^{(1)} = \\begin{pmatrix} u(-1) \\\\ u(1) \\end{pmatrix}$ denotes the degree $p=1$ edge degrees of freedom and $\\mathbf{u}^{(3)} = \\begin{pmatrix} u(s_{1}) \\\\ u(s_{2}) \\\\ u(s_{3}) \\\\ u(s_{4}) \\end{pmatrix}$ denotes the degree $p=3$ edge degrees of freedom ordered by the four Legendre–Gauss–Lobatto nodes $s_{1}, s_{2}, s_{3}, s_{4}$ from left to right, then $\\mathbf{u}^{(3)} = \\mathbf{P}\\,\\mathbf{u}^{(1)}$.\n\nYour derivation must begin from the definitions of the Legendre polynomial $P_{3}(s)$, the Legendre–Gauss–Lobatto nodes as the set $\\{-1,1\\}$ union the roots of $(1-s^{2})P_{3}'(s)$, and the degree $\\leq 1$ Lagrange shape functions along the edge. Provide the final matrix $\\mathbf{P}$ in exact form. No rounding is required. The final answer must be expressed as the single matrix $\\mathbf{P}$ using exact radicals where they occur.",
            "solution": "We begin by formalizing the trace spaces and the nodes. The shared edge is parametrized by $s \\in [-1,1]$. The degree $p=3$ trace space is the polynomial space $\\mathcal{P}_{3}([-1,1])$ and the edge degrees of freedom are nodal values at the Legendre–Gauss–Lobatto nodes. By definition, for a polynomial degree $p$, the Legendre–Gauss–Lobatto nodes consist of the endpoints $s=\\pm 1$ and the $p-1$ internal points given by the roots of $(1-s^{2}) P_{p}'(s)$, where $P_{p}(s)$ is the degree-$p$ Legendre polynomial.\n\nFor $p=3$, we first write the Legendre polynomial\n$$\nP_{3}(s) = \\frac{1}{2}\\left(5 s^{3} - 3 s\\right).\n$$\nIts derivative is\n$$\nP_{3}'(s) = \\frac{1}{2}\\left(15 s^{2} - 3\\right) = \\frac{3}{2}\\left(5 s^{2} - 1\\right).\n$$\nThe interior Legendre–Gauss–Lobatto nodes are the roots of $(1-s^{2}) P_{3}'(s) = 0$ that lie strictly inside $(-1,1)$. Excluding the endpoints $s=\\pm 1$ (which are also zeros of $(1-s^{2})$), the interior nodes satisfy $P_{3}'(s)=0$, which gives\n$$\n\\frac{3}{2}\\left(5 s^{2} - 1\\right) = 0 \\quad \\Rightarrow \\quad 5 s^{2} - 1 = 0 \\quad \\Rightarrow \\quad s^{2} = \\frac{1}{5} \\quad \\Rightarrow \\quad s = \\pm \\frac{1}{\\sqrt{5}}.\n$$\nThus, the Legendre–Gauss–Lobatto nodes for degree $p=3$ are\n$$\ns_{1} = -1, \\quad s_{2} = -\\frac{1}{\\sqrt{5}}, \\quad s_{3} = \\frac{1}{\\sqrt{5}}, \\quad s_{4} = 1.\n$$\n\nOn the degree $p=1$ element, the trace space is $\\mathcal{P}_{1}([-1,1])$. A displacement trace $u^{(1)}(s) \\in \\mathcal{P}_{1}([-1,1])$ is uniquely determined by its values at the endpoints. Using the standard degree-$1$ Lagrange shape functions associated with the endpoints, we have\n$$\nN_{L}(s) = \\frac{1-s}{2}, \\qquad N_{R}(s) = \\frac{1+s}{2},\n$$\nso that for given nodal values $u(-1)$ and $u(1)$, the linear interpolant is\n$$\nu^{(1)}(s) = u(-1)\\,N_{L}(s) + u(1)\\,N_{R}(s) = u(-1)\\,\\frac{1-s}{2} + u(1)\\,\\frac{1+s}{2}.\n$$\n\nThe prolongation operator from degree $p=1$ to degree $p=3$ along the edge is defined by evaluating this linear interpolant at the degree $p=3$ nodes. Denote the $p=1$ edge degrees of freedom vector by\n$$\n\\mathbf{u}^{(1)} = \\begin{pmatrix} u(-1) \\\\ u(1) \\end{pmatrix},\n$$\nand the $p=3$ edge degrees of freedom vector (in nodal form) by\n$$\n\\mathbf{u}^{(3)} = \\begin{pmatrix} u(s_{1}) \\\\ u(s_{2}) \\\\ u(s_{3}) \\\\ u(s_{4}) \\end{pmatrix}.\n$$\nBy definition of prolongation, we have\n$$\nu(s_{i}) = u^{(1)}(s_{i}) = u(-1)\\,N_{L}(s_{i}) + u(1)\\,N_{R}(s_{i}), \\quad i=1,2,3,4.\n$$\nTherefore, the prolongation matrix $\\mathbf{P}$ has rows given by the pairs $\\big(N_{L}(s_{i}),\\,N_{R}(s_{i})\\big)$. We evaluate these explicitly at the nodes $s_{1}=-1$, $s_{2}=-1/\\sqrt{5}$, $s_{3}=1/\\sqrt{5}$, $s_{4}=1$.\n\nFor $s_{1}=-1$:\n$$\nN_{L}(-1) = \\frac{1-(-1)}{2} = 1, \\qquad N_{R}(-1) = \\frac{1+(-1)}{2} = 0.\n$$\n\nFor $s_{2}=-\\frac{1}{\\sqrt{5}}$:\n$$\nN_{L}\\!\\left(-\\frac{1}{\\sqrt{5}}\\right) = \\frac{1+\\frac{1}{\\sqrt{5}}}{2} = \\frac{1}{2}\\left(1 + \\frac{1}{\\sqrt{5}}\\right), \\qquad\nN_{R}\\!\\left(-\\frac{1}{\\sqrt{5}}\\right) = \\frac{1-\\frac{1}{\\sqrt{5}}}{2} = \\frac{1}{2}\\left(1 - \\frac{1}{\\sqrt{5}}\\right).\n$$\n\nFor $s_{3}=\\frac{1}{\\sqrt{5}}$:\n$$\nN_{L}\\!\\left(\\frac{1}{\\sqrt{5}}\\right) = \\frac{1-\\frac{1}{\\sqrt{5}}}{2} = \\frac{1}{2}\\left(1 - \\frac{1}{\\sqrt{5}}\\right), \\qquad\nN_{R}\\!\\left(\\frac{1}{\\sqrt{5}}\\right) = \\frac{1+\\frac{1}{\\sqrt{5}}}{2} = \\frac{1}{2}\\left(1 + \\frac{1}{\\sqrt{5}}\\right).\n$$\n\nFor $s_{4}=1$:\n$$\nN_{L}(1) = \\frac{1-1}{2} = 0, \\qquad N_{R}(1) = \\frac{1+1}{2} = 1.\n$$\n\nCollecting these rows, the prolongation (constraint) matrix $\\mathbf{P}$ satisfying $\\mathbf{u}^{(3)} = \\mathbf{P}\\,\\mathbf{u}^{(1)}$ is\n$$\n\\mathbf{P} =\n\\begin{pmatrix}\n1 & 0 \\\\\n\\dfrac{1}{2}\\left(1 + \\dfrac{1}{\\sqrt{5}}\\right) & \\dfrac{1}{2}\\left(1 - \\dfrac{1}{\\sqrt{5}}\\right) \\\\\n\\dfrac{1}{2}\\left(1 - \\dfrac{1}{\\sqrt{5}}\\right) & \\dfrac{1}{2}\\left(1 + \\dfrac{1}{\\sqrt{5}}\\right) \\\\\n0 & 1\n\\end{pmatrix}.\n$$\n\nThis matrix enforces the $C^{0}$ continuity constraint by expressing the four degree $p=3$ edge nodal values as the prolongation of the unique degree $\\leq 1$ edge trace determined by the two endpoint degrees of freedom on the neighboring degree $p=1$ element. The restriction operator consistent with this construction is the map that retains only the endpoint values; in nodal coordinates it is the $2 \\times 4$ matrix that selects entries $1$ and $4$. However, the requested constraint matrix that ties the degree $p=3$ trace to the degree $p=1$ trace is the prolongation matrix $\\mathbf{P}$ computed above.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2}\\left(1 + \\frac{1}{\\sqrt{5}}\\right) & \\frac{1}{2}\\left(1 - \\frac{1}{\\sqrt{5}}\\right) \\\\\n\\frac{1}{2}\\left(1 - \\frac{1}{\\sqrt{5}}\\right) & \\frac{1}{2}\\left(1 + \\frac{1}{\\sqrt{5}}\\right) \\\\\n0 & 1\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "The true power of $hp$-adaptivity lies in its ability to select the optimal type of refinement based on the local character of the solution. The choice between subdividing an element ($h$-refinement) or increasing its polynomial order ($p$-refinement) is crucial for efficiency. This decision is guided by the local smoothness of the solution: exponential convergence under $p$-refinement is expected for analytic (smooth) solutions, whereas $h$-refinement is more effective at resolving singularities or sharp gradients. This coding practice explores the modal decay indicator, a powerful technique that analyzes the solution's spectral content to automatically distinguish between regions requiring $h$- or $p$-refinement. ",
            "id": "3571718",
            "problem": "Consider a one-dimensional linear elastic bar of length $L=1$ with constant cross-sectional area $A=1$ subjected to an axial body force field $f(x)$ and traction-free right boundary. The bar is composed of two homogeneous layers with piecewise constant Young's modulus $E(x)$ given by $E(x)=E_1$ for $0 \\le x &lt; x_I$ and $E(x)=E_2$ for $x_I \\le x \\le 1$, where $0&lt;x_I&lt;1$ is the interface position. The governing equilibrium equation for small-strain elasticity with linear constitutive relation is\n$$\\frac{d}{dx}\\left(E(x)A\\frac{du}{dx}\\right)=f(x),$$\nwith boundary conditions $u(0)=0$ and $E(1)A\\,u'(1)=0$. Assume $f(x)=f_0$ is a positive constant.\n\nFor a given mesh consisting of non-overlapping elements $\\{[x_{e,\\mathrm{L}},x_{e,\\mathrm{R}}]\\}$ that partition $[0,1]$, define for each element the modal decay indicator based on the Legendre polynomial expansion of the element-wise displacement field $u(x)$. Let $\\xi \\in [-1,1]$ be the reference coordinate and $x(\\xi)=\\frac{x_{e,\\mathrm{R}}-x_{e,\\mathrm{L}}}{2}(\\xi+1)+x_{e,\\mathrm{L}}$ be the affine map. The reference-field $u_e(\\xi)$ is $u_e(\\xi)=u(x(\\xi))$. Let $P_\\ell(\\xi)$ be the Legendre polynomial of degree $\\ell$, orthogonal on $[-1,1]$ with unit weight. Define the $L^2$ projection coefficients $a_\\ell$ by\n$$a_\\ell=\\frac{2\\ell+1}{2}\\int_{-1}^{1}u_e(\\xi)P_\\ell(\\xi)\\,d\\xi,\\quad \\ell=0,1,\\dots,p,$$\nwhere $p$ is the maximum local polynomial degree to be considered for the indicator. The modal decay slope $m_e$ for element $e$ is given by the least-squares linear fit of $\\log_{10}(|a_\\ell|)$ versus $\\ell$ for $\\ell=1,\\dots,p$, that is, compute $m_e$ such that\n$$\\log_{10}(|a_\\ell|)\\approx m_e\\,\\ell + b_e,$$\nin the least-squares sense, with a small regularization $\\varepsilon$ added inside the logarithm to avoid singularity at $a_\\ell=0$.\n\nDecision rule: If $m_e\\le m_{\\mathrm{crit}}$ (more negative slope indicating faster decay), choose $p$-enrichment on element $e$; otherwise, choose $h$-refinement on element $e$.\n\nTasks:\n1. Starting from the equilibrium equation and boundary conditions, derive the piecewise closed-form solution $u(x)$ for $f(x)=f_0$ and piecewise constant $E(x)$ with a single interface at $x_I$, ensuring continuity of displacement and continuity of axial force $E(x)A\\,u'(x)$ at $x_I$.\n2. Using Gaussian-Legendre quadrature of order $Q$, approximate $a_\\ell$ for $\\ell=0,\\dots,p$ in each element via the above integral. Then compute the slope $m_e$ via least-squares for $\\ell=1,\\dots,p$ using $\\log_{10}(|a_\\ell|+\\varepsilon)$ with a regularization defined as $\\varepsilon=\\max_{\\ell}|a_\\ell|\\times 10^{-14}+10^{-30}$.\n3. Apply the decision rule with a specified critical slope $m_{\\mathrm{crit}}$ and output, for each element in each test case, a boolean indicating $p$-enrichment (True) or $h$-refinement (False).\n\nUnits: Physical parameters $E_1$ and $E_2$ are in Pascals, and $f_0$ is in Newtons per cubic meter. The final program output is unitless booleans. No unit conversions are required.\n\nTest suite:\n- Test case 1 (single element, interface inside element, moderate contrast): $E_1=200\\times 10^9$, $E_2=50\\times 10^9$, $x_I=0.35$, $f_0=10^6$, elements $[(0.0,1.0)]$, $p=8$, $Q=64$, $m_{\\mathrm{crit}}=-0.8$.\n- Test case 2 (two elements aligned with interface, moderate contrast): same $E_1$, $E_2$, $x_I$, and $f_0$ as Test case 1; elements $[(0.0,0.35),(0.35,1.0)]$, $p=8$, $Q=64$, $m_{\\mathrm{crit}}=-0.8$.\n- Test case 3 (two elements misaligned with interface, moderate contrast): same $E_1$, $E_2$, $x_I$, and $f_0$ as Test case 1; elements $[(0.0,0.5),(0.5,1.0)]$, $p=8$, $Q=64$, $m_{\\mathrm{crit}}=-0.8$.\n- Test case 4 (single element, interface inside element, higher contrast, boundary-degree case): $E_1=200\\times 10^9$, $E_2=5\\times 10^9$, $x_I=0.65$, $f_0=10^6$, elements $[(0.0,1.0)]$, $p=3$, $Q=24$, $m_{\\mathrm{crit}}=-0.8$.\n\nYour program should produce a single line of output containing the decisions for all elements across the four test cases in order, as a comma-separated list enclosed in square brackets. The order is element-wise within each test case, and test cases are processed in the order given above. For example, the output format must be exactly like $[b_1,b_2,\\dots,b_6]$ where each $b_k$ is either True or False.",
            "solution": "The problem is valid as it is scientifically grounded in linear elasticity, mathematically well-posed, objective, and contains all necessary data for deriving a unique solution and performing the specified numerical tasks.\n\nThe solution proceeds in three stages: first, the derivation of the analytical expression for the displacement field $u(x)$; second, the description of the numerical procedure to compute the modal decay indicator $m_e$ for each element; and third, the application of the decision rule to determine the appropriate mesh adaptation strategy.\n\n**1. Derivation of the Analytical Displacement Field $u(x)$**\n\nThe governing equilibrium equation for the one-dimensional elastic bar is given as:\n$$\n\\frac{d}{dx}\\left(E(x)A\\frac{du}{dx}\\right) = f(x)\n$$\nGiven a constant cross-sectional area $A=1$ and a constant body force $f(x)=f_0$, the equation simplifies. The domain $[0, 1]$ is composed of two materials with a piecewise constant Young's modulus, $E(x) = E_1$ for $0 \\le x < x_I$ and $E(x) = E_2$ for $x_I \\le x \\le 1$. We solve the equation in each region.\n\nFor region $1$ ($0 \\le x < x_I$):\n$$\nE_1 \\frac{d^2u_1}{dx^2} = f_0\n$$\nIntegrating twice with respect to $x$ yields the general solution for the displacement $u_1(x)$:\n$$\nu_1(x) = \\frac{f_0}{2E_1}x^2 + C_1 x + C_2\n$$\n\nFor region $2$ ($x_I \\le x \\le 1$):\n$$\nE_2 \\frac{d^2u_2}{dx^2} = f_0\n$$\nIntegrating twice yields the general solution for the displacement $u_2(x)$:\n$$\nu_2(x) = \\frac{f_0}{2E_2}x^2 + C_3 x + C_4\n$$\nThere are $4$ unknown constants of integration ($C_1, C_2, C_3, C_4$) which are determined by applying the boundary and interface conditions.\n\nThe boundary conditions are:\n1.  Fixed displacement at the left end: $u(0)=0$. Applying this to $u_1(x)$:\n    $u_1(0) = C_2 = 0$.\n2.  Traction-free at the right end: $E(1)A u'(1)=0$. With $A=1$ and $E(1)=E_2$, this simplifies to $E_2 u_2'(1)=0$.\n    The derivative of $u_2(x)$ is $u_2'(x) = \\frac{f_0}{E_2}x + C_3$.\n    $E_2 \\left(\\frac{f_0}{E_2}(1) + C_3\\right) = 0 \\implies f_0 + E_2 C_3 = 0 \\implies C_3 = -\\frac{f_0}{E_2}$.\n\nThe interface conditions at $x=x_I$ ensure compatibility between the two material layers:\n3.  Continuity of displacement: $u_1(x_I) = u_2(x_I)$.\n4.  Continuity of axial force: $E_1 A u_1'(x_I) = E_2 A u_2'(x_I)$. With $A=1$:\n    $E_1 \\left(\\frac{f_0}{E_1}x_I + C_1\\right) = E_2 \\left(\\frac{f_0}{E_2}x_I + C_3\\right)$.\n    Substituting $C_3 = -f_0/E_2$:\n    $f_0 x_I + E_1 C_1 = E_2 \\left(\\frac{f_0}{E_2}x_I - \\frac{f_0}{E_2}\\right) = f_0 x_I - f_0$.\n    $E_1 C_1 = -f_0 \\implies C_1 = -\\frac{f_0}{E_1}$.\n\nFinally, we use the displacement continuity condition (3) to find $C_4$.\n$u_1(x_I) = \\frac{f_0}{2E_1}x_I^2 - \\frac{f_0}{E_1}x_I = \\frac{f_0}{E_1}\\left(\\frac{x_I^2}{2} - x_I\\right)$.\n$u_2(x_I) = \\frac{f_0}{2E_2}x_I^2 - \\frac{f_0}{E_2}x_I + C_4 = \\frac{f_0}{E_2}\\left(\\frac{x_I^2}{2} - x_I\\right) + C_4$.\nEquating them gives:\n$C_4 = \\frac{f_0}{E_1}\\left(\\frac{x_I^2}{2} - x_I\\right) - \\frac{f_0}{E_2}\\left(\\frac{x_I^2}{2} - x_I\\right) = f_0\\left(\\frac{1}{E_1} - \\frac{1}{E_2}\\right)\\left(\\frac{x_I^2}{2} - x_I\\right)$.\n\nThe complete piecewise analytical solution for the displacement field $u(x)$ is:\n$$\nu(x) =\n\\begin{cases}\nu_1(x) = \\frac{f_0}{E_1}\\left(\\frac{x^2}{2} - x\\right) & \\text{for } 0 \\le x < x_I \\\\\nu_2(x) = \\frac{f_0}{E_2}\\left(\\frac{x^2}{2} - x\\right) + f_0\\left(\\frac{1}{E_1} - \\frac{1}{E_2}\\right)\\left(\\frac{x_I^2}{2} - x_I\\right) & \\text{for } x_I \\le x \\le 1\n\\end{cases}\n$$\nThis solution is continuous, but its derivative $u'(x)$ is discontinuous at $x=x_I$ when $E_1 \\neq E_2$, creating a \"kink\" in the displacement profile. This lack of smoothness is a key feature that the modal decay indicator is designed to detect.\n\n**2. Numerical Computation of the Modal Decay Indicator $m_e$**\n\nThe indicator $m_e$ quantifies the rate of decay of Legendre spectral coefficients of the solution within an element. A rapid decay (large negative $m_e$) implies the solution is smooth and well-approximated by polynomials, making it suitable for $p$-enrichment (increasing polynomial degree). A slow decay (less negative $m_e$) suggests the presence of a singularity or sharp feature, for which $h$-refinement (subdividing the element) is more effective.\n\nFor each element $e = [x_{e,\\mathrm{L}}, x_{e,\\mathrm{R}}]$, the procedure is as follows:\n1.  **Compute Legendre Coefficients $a_\\ell$**: The coefficient $a_\\ell$ is the projection of the element's reference displacement field $u_e(\\xi)$ onto the Legendre polynomial $P_\\ell(\\xi)$. The integral is approximated using a $Q$-point Gaussian-Legendre quadrature rule, whose points $\\xi_q$ and weights $w_q$ are defined on the reference interval $[-1, 1]$.\n    $$\n    a_\\ell \\approx \\frac{2\\ell+1}{2} \\sum_{q=1}^{Q} u(x(\\xi_q)) P_\\ell(\\xi_q) w_q\n    $$\n    The physical coordinates $x(\\xi_q)$ are obtained via the affine map $x(\\xi)=\\frac{x_{e,\\mathrm{R}}-x_{e,\\mathrm{L}}}{2}(\\xi+1)+x_{e,\\mathrm{L}}$. The coefficients are computed for $\\ell=0, 1, \\dots, p$.\n\n2.  **Regularization**: To avoid issues with $\\log(0)$ for coefficients that are numerically zero, a small positive value $\\varepsilon$ is added. First, a vector of coefficients $[a_0, a_1, \\dots, a_p]$ is computed. Then, the regularization term is calculated as $\\varepsilon=\\max_{\\ell=0,\\dots,p}|a_\\ell|\\times 10^{-14}+10^{-30}$.\n\n3.  **Least-Squares Fit**: We seek the slope $m_e$ of the line that best fits the data points $(\\ell, \\log_{10}(|a_\\ell|+\\varepsilon))$ for $\\ell=1, \\dots, p$. This is a standard linear regression problem. The slope $m_e$ is computed by finding the least-squares solution to the linear system representing the fit. This is readily accomplished using numerical libraries.\n\n**3. Decision Logic and Implementation**\n\nThe final step is to apply the decision rule for each element in each test case.\nFor a given critical slope $m_{\\mathrm{crit}}$, the adaptivity decision is:\n-   If $m_e \\le m_{\\mathrm{crit}}$: The spectral decay is fast. Choose $p$-enrichment (output `True`).\n-   If $m_e > m_{\\mathrm{crit}}$: The spectral decay is slow. Choose $h$-refinement (output `False`).\n\nThis entire procedure is implemented in Python. A function generates the analytical solution $u(x)$ based on the material parameters. Another function orchestrates the numerical computation of $m_e$ for a given element, utilizing `numpy` for array operations, `numpy.polynomial.legendre.leggauss` for quadrature, `scipy.special.legendre` for polynomial evaluation, and `numpy.polyfit` for the least-squares fitting. The main loop iterates through the provided test cases, calculates the indicator for each element, applies the decision rule, and aggregates the boolean results for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import legendre\nfrom numpy.polynomial.legendre import leggauss\n\ndef get_analytical_solution_u(E1, E2, xI, f0):\n    \"\"\"\n    Creates and returns the analytical solution function u(x) for the given parameters.\n    \"\"\"\n    # Constant C4 is derived from continuity of displacement at x=xI\n    C4 = f0 * (1/E1 - 1/E2) * (xI**2 / 2 - xI)\n\n    def u(x):\n        \"\"\"\n        Calculates the displacement u at position(s) x.\n        x can be a single float or a numpy array.\n        \"\"\"\n        x_arr = np.asarray(x)\n        res = np.zeros_like(x_arr, dtype=float)\n        \n        # Region 1: 0 <= x < xI\n        mask1 = x_arr < xI\n        res[mask1] = (f0 / E1) * (x_arr[mask1]**2 / 2 - x_arr[mask1])\n\n        # Region 2: xI <= x <= 1\n        mask2 = x_arr >= xI\n        res[mask2] = (f0 / E2) * (x_arr[mask2]**2 / 2 - x_arr[mask2]) + C4\n        \n        return res\n        \n    return u\n\ndef compute_modal_decay_slope(u_func, element_bounds, p, Q):\n    \"\"\"\n    Computes the modal decay slope m_e for a single element.\n    \"\"\"\n    x_L, x_R = element_bounds\n    \n    # Get Gaussian quadrature points and weights for interval [-1, 1]\n    xi_q, w_q = leggauss(Q)\n    \n    # Map reference coordinates xi_q to physical coordinates x_q\n    x_q = (x_R - x_L) / 2 * (xi_q + 1) + x_L\n    \n    # Evaluate solution at physical quadrature points\n    u_q = u_func(x_q)\n    \n    # Compute Legendre projection coefficients a_l for l=0,...,p\n    a_coeffs = np.zeros(p + 1)\n    for l_val in range(p + 1):\n        P_l = legendre(l_val)\n        integrand = u_q * P_l(xi_q)\n        integral = np.sum(w_q * integrand)\n        a_coeffs[l_val] = (2 * l_val + 1) / 2 * integral\n        \n    # Compute regularization term epsilon\n    epsilon = np.max(np.abs(a_coeffs)) * 1e-14 + 1e-30\n    \n    # Prepare data for least-squares fit for l=1,...,p\n    l_vals = np.arange(1, p + 1)\n    y_vals = np.log10(np.abs(a_coeffs[1:]) + epsilon)\n    \n    # Perform linear least-squares fit to find the slope m_e\n    m_e, _ = np.polyfit(l_vals, y_vals, 1)\n    \n    return m_e\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'E1': 200e9, 'E2': 50e9, 'xI': 0.35, 'f0': 1e6, 'elements': [(0.0, 1.0)], 'p': 8, 'Q': 64, 'm_crit': -0.8},\n        {'E1': 200e9, 'E2': 50e9, 'xI': 0.35, 'f0': 1e6, 'elements': [(0.0, 0.35), (0.35, 1.0)], 'p': 8, 'Q': 64, 'm_crit': -0.8},\n        {'E1': 200e9, 'E2': 50e9, 'xI': 0.35, 'f0': 1e6, 'elements': [(0.0, 0.5), (0.5, 1.0)], 'p': 8, 'Q': 64, 'm_crit': -0.8},\n        {'E1': 200e9, 'E2': 5e9, 'xI': 0.65, 'f0': 1e6, 'elements': [(0.0, 1.0)], 'p': 3, 'Q': 24, 'm_crit': -0.8}\n    ]\n\n    results = []\n    for case in test_cases:\n        # Generate the analytical solution function for the current case\n        u_func = get_analytical_solution_u(case['E1'], case['E2'], case['xI'], case['f0'])\n        \n        # Process each element in the test case's mesh\n        for element in case['elements']:\n            m_e = compute_modal_decay_slope(u_func, element, case['p'], case['Q'])\n            # Apply the decision rule\n            decision = m_e <= case['m_crit']\n            results.append(decision)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}