{
    "hands_on_practices": [
        {
            "introduction": "亥姆霍兹自由能势最基本的应用之一是推导材料的应力-应变关系。这个练习  提供了一个热弹性力学的经典案例，展示了如何通过对自由能势函数求导来获得应力张量。通过这个实践，您将深刻理解热力学势与材料力学响应之间的直接联系，并掌握从给定的能量函数出发，求解一个完整边值问题的方法。",
            "id": "3569898",
            "problem": "一根细长的棱柱杆，在其参考构型中占据区间 $x \\in [0,L]$，具有恒定的横截面积 $A$，由各向同性的小应变热弹性固体制成。杆的侧面无面力，且无体力。杆受到轴向约束，使得 $u(0)=0$ 和 $u(L)=0$，其中 $u(x)$ 是轴向位移。绝对温度场是给定且稳态的：$T(x)=T_{\\mathrm{ref}}+\\theta_{0}+b\\,x+c\\,x^{2}$，其中 $T_{\\mathrm{ref}}$ 是参考温度，$\\theta_{0}$、$b$ 和 $c$ 是给定的常数。\n\n材料的单位参考体积亥姆霍兹自由能为\n$$\n\\psi(\\boldsymbol{\\varepsilon},T)\n=\\frac{1}{2}\\,\\lambda\\left(\\operatorname{tr}\\boldsymbol{\\varepsilon}-3\\,\\alpha\\,[T-T_{\\mathrm{ref}}]\\right)^{2}\n+\\mu\\left(\\boldsymbol{\\varepsilon}-\\alpha\\,[T-T_{\\mathrm{ref}}]\\boldsymbol{I}\\right):\\left(\\boldsymbol{\\varepsilon}-\\alpha\\,[T-T_{\\mathrm{ref}}]\\boldsymbol{I}\\right),\n$$\n其中 $\\boldsymbol{\\varepsilon}$ 是小（无穷小）应变张量，$\\lambda$ 和 $\\mu$ 是 Lamé 模量，$\\alpha$ 是常数线性热膨胀系数，$\\boldsymbol{I}$ 是单位张量。假设在所关心的温度范围内，$\\lambda$、$\\mu$ 和 $\\alpha$ 对温度的依赖性可以忽略不计。\n\n从该自由能和超弹性热力学结构出发，推导在给定的热场和力学约束下，杆中的轴向 Cauchy 应力 $\\sigma_{11}(x)$ 的表达式。使用 $(\\lambda,\\mu)$ 和 $(E,\\nu)$ 之间的标准关系，将最终答案用杨氏模量 $E$、泊松比 $\\nu$、$\\alpha$、$\\theta_{0}$、$b$、$c$ 和 $L$ 表示。以帕斯卡为单位陈述最终的轴向应力。您的最终答案必须是单一的闭式解析表达式。如果需要进行任何数值计算，请四舍五入到四位有效数字；然而，对于此问题，请提供一个无需四舍五入的精确表达式。",
            "solution": "首先验证问题，以确保其科学上合理、自洽且适定。\n\n**步骤 1：提取已知条件**\n- **几何与构型：** 一根位于 $x \\in [0,L]$ 上的细长棱柱杆，具有恒定的横截面积 $A$。\n- **材料模型：** 各向同性、小应变热弹性固体。\n- **亥姆霍兹自由能：** $\\psi(\\boldsymbol{\\varepsilon},T) = \\frac{1}{2}\\,\\lambda\\left(\\operatorname{tr}\\boldsymbol{\\varepsilon}-3\\,\\alpha\\,[T-T_{\\mathrm{ref}}]\\right)^{2} + \\mu\\left(\\boldsymbol{\\varepsilon}-\\alpha\\,[T-T_{\\mathrm{ref}}]\\boldsymbol{I}\\right):\\left(\\boldsymbol{\\varepsilon}-\\alpha\\,[T-T_{\\mathrm{ref}}]\\boldsymbol{I}\\right)$。\n- **力学边界条件：** $u(0)=0$ 和 $u(L)=0$。\n- **热场：** $T(x)=T_{\\mathrm{ref}}+\\theta_{0}+b\\,x+c\\,x^{2}$。\n- **载荷/面力：** 侧面无面力，且无体力。\n- **常数：** Lamé 模量 $\\lambda, \\mu$；线性热膨胀系数 $\\alpha$；参考温度 $T_{\\mathrm{ref}}$；以及热场系数 $\\theta_{0}, b, c$。\n- **任务：** 用杨氏模量 $E$、泊松比 $\\nu$、$\\alpha$、$\\theta_{0}$、$b$、$c$ 和 $L$ 表示轴向 Cauchy 应力 $\\sigma_{11}(x)$。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于标准的线性热弹性理论。所提供的亥姆霍兹自由能势是各向同性热弹性材料的有效且标准的表示形式。\n- **适定性：** 问题指定了几何形状、材料本构、边界条件（$u(0)$ 和 $u(L)$）以及热载荷。这构成了一个适定的一维边值问题。\n- **客观性：** 问题使用连续介质力学中精确、客观和标准的术语进行陈述。\n- **结论：** 该问题被认为是有效的，因为它是自洽的、科学上合理的且适定的。\n\n**步骤 3：进行求解**\n\nCauchy 应力张量 $\\boldsymbol{\\sigma}$ 通过热力学关系 $\\boldsymbol{\\sigma} = \\frac{\\partial\\psi}{\\partial\\boldsymbol{\\varepsilon}}$ 与单位参考体积的亥姆霍兹自由能 $\\psi$ 相关。令 $\\theta(x) = T(x)-T_{\\mathrm{ref}} = \\theta_{0}+b\\,x+c\\,x^{2}$。给定的自由能为：\n$$\n\\psi(\\boldsymbol{\\varepsilon}, \\theta) = \\frac{1}{2}\\,\\lambda\\left(\\operatorname{tr}\\boldsymbol{\\varepsilon}-3\\,\\alpha\\,\\theta\\right)^{2} + \\mu\\left(\\boldsymbol{\\varepsilon}-\\alpha\\,\\theta\\boldsymbol{I}\\right):\\left(\\boldsymbol{\\varepsilon}-\\alpha\\,\\theta\\boldsymbol{I}\\right)\n$$\n使用张量指标符号进行微分，得到应力张量的分量 $\\sigma_{ij}$：\n$$\n\\sigma_{ij} = \\frac{\\partial\\psi}{\\partial\\varepsilon_{ij}} = \\lambda\\left(\\operatorname{tr}\\boldsymbol{\\varepsilon}-3\\,\\alpha\\,\\theta\\right)\\delta_{ij} + 2\\mu\\left(\\varepsilon_{ij}-\\alpha\\,\\theta\\delta_{ij}\\right)\n$$\n这可以重排为更标准的 Duhamel-Neumann 本构关系形式：\n$$\n\\sigma_{ij} = \\lambda\\varepsilon_{kk}\\delta_{ij} + 2\\mu\\varepsilon_{ij} - (3\\lambda+2\\mu)\\alpha\\theta\\delta_{ij}\n$$\n对于侧面无面力的细长杆，垂直于杆轴的应力分量为零，即 $\\sigma_{22}=0$ 和 $\\sigma_{33}=0$。由于载荷和几何形状的轴对称性，我们还有 $\\varepsilon_{22} = \\varepsilon_{33}$。\n设 $\\sigma_{22}=0$：\n$$\n\\sigma_{22} = \\lambda(\\varepsilon_{11}+2\\varepsilon_{22}) + 2\\mu\\varepsilon_{22} - (3\\lambda+2\\mu)\\alpha\\theta = 0\n$$\n$$\n\\lambda\\varepsilon_{11} + (2\\lambda+2\\mu)\\varepsilon_{22} = (3\\lambda+2\\mu)\\alpha\\theta\n$$\n由此，我们可以解出横向应变 $\\varepsilon_{22}$：\n$$\n\\varepsilon_{22} = \\frac{(3\\lambda+2\\mu)\\alpha\\theta - \\lambda\\varepsilon_{11}}{2(\\lambda+\\mu)}\n$$\n现在，我们写出轴向应力 $\\sigma_{11}$ 的表达式：\n$$\n\\sigma_{11} = \\lambda(\\varepsilon_{11}+2\\varepsilon_{22}) + 2\\mu\\varepsilon_{11} - (3\\lambda+2\\mu)\\alpha\\theta\n$$\n代入 $\\varepsilon_{22}$ 的表达式：\n$$\n\\sigma_{11} = (\\lambda+2\\mu)\\varepsilon_{11} + 2\\lambda\\left(\\frac{(3\\lambda+2\\mu)\\alpha\\theta - \\lambda\\varepsilon_{11}}{2(\\lambda+\\mu)}\\right) - (3\\lambda+2\\mu)\\alpha\\theta\n$$\n按 $\\varepsilon_{11}$ 和 $\\alpha\\theta$ 对项进行分组：\n$$\n\\sigma_{11} = \\left(\\lambda+2\\mu - \\frac{\\lambda^2}{\\lambda+\\mu}\\right)\\varepsilon_{11} + \\left(\\frac{\\lambda(3\\lambda+2\\mu)}{\\lambda+\\mu} - (3\\lambda+2\\mu)\\right)\\alpha\\theta\n$$\n$\\varepsilon_{11}$ 的系数简化为杨氏模量 $E$：\n$$\n\\lambda+2\\mu - \\frac{\\lambda^2}{\\lambda+\\mu} = \\frac{(\\lambda+2\\mu)(\\lambda+\\mu)-\\lambda^2}{\\lambda+\\mu} = \\frac{\\lambda^2+3\\lambda\\mu+2\\mu^2-\\lambda^2}{\\lambda+\\mu} = \\frac{\\mu(3\\lambda+2\\mu)}{\\lambda+\\mu} = E\n$$\n$\\alpha\\theta$ 的系数简化为 $-E$：\n$$\n\\frac{\\lambda(3\\lambda+2\\mu) - (3\\lambda+2\\mu)(\\lambda+\\mu)}{\\lambda+\\mu} = \\frac{(3\\lambda+2\\mu)(\\lambda - \\lambda - \\mu)}{\\lambda+\\mu} = \\frac{-\\mu(3\\lambda+2\\mu)}{\\lambda+\\mu} = -E\n$$\n因此，我们得到轴向应力的一维本构关系：\n$$\n\\sigma_{11} = E\\varepsilon_{11} - E\\alpha\\theta = E(\\varepsilon_{11} - \\alpha\\theta)\n$$\n注意，泊松比 $\\nu = \\frac{\\lambda}{2(\\lambda+\\mu)}$ 没有出现在这个轴向关系式中，这是该应力状态的一个关键结果。该问题是静力平衡问题。在没有体力的情况下，一维平衡方程为：\n$$\n\\frac{d\\sigma_{11}}{dx} = 0\n$$\n这意味着 $\\sigma_{11}$ 沿杆的长度必须是一个常数。设该常数为 $\\sigma_0$。\n$$\n\\sigma_0 = E\\left(\\frac{du}{dx} - \\alpha\\theta(x)\\right)\n$$\n其中 $\\varepsilon_{11} = du/dx$。对应变梯度进行重排：\n$$\n\\frac{du}{dx} = \\frac{\\sigma_0}{E} + \\alpha\\theta(x)\n$$\n为了求出常数应力 $\\sigma_0$，我们将此表达式对 $x$ 从 $0$ 到 $L$ 进行积分：\n$$\n\\int_0^L \\frac{du}{dx}\\,dx = \\int_0^L \\left(\\frac{\\sigma_0}{E} + \\alpha\\theta(x)\\right)dx\n$$\n左边是 $u(L)-u(0)$。应用边界条件 $u(0)=0$ 和 $u(L)=0$：\n$$\n0 = \\int_0^L \\frac{\\sigma_0}{E}\\,dx + \\int_0^L \\alpha\\theta(x)\\,dx\n$$\n由于 $\\sigma_0$、$E$ 和 $\\alpha$ 是常数：\n$$\n0 = \\frac{\\sigma_0 L}{E} + \\alpha\\int_0^L \\theta(x)\\,dx\n$$\n求解 $\\sigma_0$（即我们所求的应力 $\\sigma_{11}$）：\n$$\n\\sigma_{11} = -\\frac{E\\alpha}{L}\\int_0^L \\theta(x)\\,dx\n$$\n现在我们计算温度偏差 $\\theta(x)$ 的积分：\n$$\n\\int_0^L \\theta(x)\\,dx = \\int_0^L (\\theta_{0}+b\\,x+c\\,x^{2})\\,dx = \\left[\\theta_{0}x + \\frac{1}{2}bx^2 + \\frac{1}{3}cx^3\\right]_0^L\n$$\n$$\n\\int_0^L \\theta(x)\\,dx = \\theta_{0}L + \\frac{1}{2}bL^2 + \\frac{1}{3}cL^3\n$$\n将此结果代入 $\\sigma_{11}$ 的表达式中：\n$$\n\\sigma_{11} = -\\frac{E\\alpha}{L}\\left(\\theta_{0}L + \\frac{1}{2}bL^2 + \\frac{1}{3}cL^3\\right)\n$$\n通过分配 $1/L$ 项进行简化：\n$$\n\\sigma_{11} = -E\\alpha\\left(\\theta_{0} + \\frac{1}{2}bL + \\frac{1}{3}cL^2\\right)\n$$\n这是杆中轴向应力的最终表达式。它沿杆的长度是恒定的，与静力平衡一致。该表达式的单位是应力单位，在国际单位制中是帕斯卡。",
            "answer": "$$\n\\boxed{-E\\alpha\\left(\\theta_{0} + \\frac{1}{2}bL + \\frac{1}{3}cL^2\\right)}\n$$"
        },
        {
            "introduction": "在掌握了如何从能量势中解析推导应力之后，我们将进入计算实现领域。在非线性有限元分析中，我们不仅需要应力（亥姆霍兹自由能 $\\psi$ 的一阶导数），还需要算法切线刚度（$\\psi$ 的二阶导数）。本练习  将指导您构建一个数值基准测试，用以验证本构模型代码中导数的正确性，并检查其是否满足对称性和正定性等基本数学性质，这对于保证数值求解的收敛性至关重要。",
            "id": "3569882",
            "problem": "您的任务是构建一个计算基准，该基准从第一性原理出发，评估一个超弹性固体的算法切线的对称性和正定性。该固体的亥姆霍兹自由能被指定为变形梯度的函数。该基准还必须通过检查小微扰路径上的能量一致性来诊断数值病态。所有计算都应在无量纲环境下进行；无需物理单位。\n\n该问题的基本依据包括以下定义和经过充分检验的事实：\n\n- 对于超弹性材料，单位参考体积的亥姆霍兹自由能（记为 $\\psi$）是变形梯度 $\\mathbf{F} \\in \\mathbb{R}^{3 \\times 3}$ 的标量函数。\n- 第一 Piola–Kirchhoff 应力 $\\mathbf{P}$ 定义为 $\\mathbf{P} = \\partial \\psi / \\partial \\mathbf{F}$。\n- 算法切线（一个四阶张量）是自由能相对于变形梯度的 Hessian 矩阵，其分量形式定义为 $\\mathbb{C}_{ij,kl} = \\partial^2 \\psi / \\partial F_{ij} \\partial F_{kl}$。\n- 对于一个二次连续可微的势，其 Hessian 矩阵在交换求导顺序时是对称的，这意味着 $\\mathbb{C}_{ij,kl} = \\mathbb{C}_{kl,ij}$。\n- 在某一状态下，$\\psi$ 的 Hessian 矩阵的正定性表明势的局部凸性，并且是牛顿类求解器实现二次收敛的必要条件。\n\n使用以下适用于可压缩 Neo-Hookean 材料的亥姆霍兹自由能：\n$$\n\\psi(\\mathbf{F}) = \\frac{\\mu}{2}\\left( I_1 - 3 - 2 \\ln J \\right) + \\frac{\\kappa}{2} \\left(\\ln J\\right)^2,\n$$\n其中 $I_1 = \\mathrm{tr}(\\mathbf{F}^\\top \\mathbf{F})$ 且 $J = \\det(\\mathbf{F})$，材料参数 $\\mu > 0$ 和 $\\kappa > 0$。$\\psi$ 的定义域限制在 $J>0$。\n\n您的程序必须：\n1. 使用有限差分法（FDM）数值近似梯度 $\\partial \\psi / \\partial \\mathbf{F}$ 和 Hessian 矩阵 $\\partial^2 \\psi / \\partial \\mathbf{F}^2$，不使用解析导数。您必须通过堆叠其元素将 $\\mathbf{F}$ 视为一个 9 维向量。\n2. 根据所选的堆叠约定，构建与四阶张量 $\\mathbb{C}$ 对应的 $9 \\times 9$ Hessian 矩阵 $H$。对称性检查应测量 $H - H^\\top$ 的最大绝对值元素，如果该最大值小于或等于用户定义的容差 $\\varepsilon_{\\text{sym}}$，则声明对称性可接受。\n3. 通过计算对称化 Hessian 矩阵 $(H + H^\\top)/2$ 的特征值来测试正定性，如果最小特征值大于或等于用户定义的阈值 $\\varepsilon_{\\text{pd}}$，则声明正定性可接受。\n4. 沿小微扰路径 $\\mathbf{F}(t) = \\mathbf{F} + t \\, \\Delta \\mathbf{F}$ 执行能量一致性检查，其中 $\\Delta \\mathbf{F}$ 是一个单位 Frobenius 范数的方向。使用关于 $\\mathbf{F}$ 的二阶泰勒展开，\n$$\n\\Delta \\psi_{\\text{pred}}(t) = \\left\\langle \\frac{\\partial \\psi}{\\partial \\mathbf{F}}, \\Delta \\mathbf{F} \\right\\rangle t + \\frac{1}{2} \\, \\mathrm{vec}(\\Delta \\mathbf{F})^\\top H \\, \\mathrm{vec}(\\Delta \\mathbf{F}) \\, t^2,\n$$\n将 $\\Delta \\psi_{\\text{pred}}(t)$ 与实际增量 $\\Delta \\psi_{\\text{act}}(t) = \\psi(\\mathbf{F} + t \\, \\Delta \\mathbf{F}) - \\psi(\\mathbf{F})$ 进行比较，对于一组小步长 $t$。如果对于所有指定的 $t$，相对误差\n$$\n\\mathrm{rel\\_err}(t) = \\frac{\\left| \\Delta \\psi_{\\text{pred}}(t) - \\Delta \\psi_{\\text{act}}(t) \\right|}{\\left| \\Delta \\psi_{\\text{act}}(t) \\right| + \\delta}\n$$\n小于或等于用户定义的容差 $\\varepsilon_{\\text{eng}}$，则声明能量检查可接受，其中 $\\delta$ 是一个小的正则化常数，以避免除以零。\n\n如果在任何对 $\\psi(\\mathbf{F})$ 的求值或有限差分采样中遇到 $\\det(\\mathbf{F}) \\le 0$，则能量未定义。在这种情况下，对于相应的测试用例，所有三个检查（对称性、正定性、能量一致性）都必须标记为不可接受。\n\n为该基准使用以下参数：\n- 材料参数：$\\mu = 1.0$ 和 $\\kappa = 1000.0$ (无量纲)。\n- 用于梯度和 Hessian 矩阵的有限差分步长：$h = 10^{-6}$。\n- 对称性容差：$\\varepsilon_{\\text{sym}} = 10^{-6}$。\n- 正定性阈值：$\\varepsilon_{\\text{pd}} = 10^{-9}$。\n- 能量一致性容差：$\\varepsilon_{\\text{eng}} = 0.05$ 及正则化常数 $\\delta = 10^{-12}$。\n- 微扰步长：$t \\in \\{10^{-4}, 10^{-3}, 10^{-2}\\}$。\n- 微扰方向 $\\Delta \\mathbf{F}$ 应具有单位 Frobenius 范数且可复现；使用固定的随机种子 $42$ 来构造它。\n\n测试套件（每个测试用例是一个 $3 \\times 3$ 矩阵）：\n- 用例 1 (参考构型): $\\mathbf{F} = \\mathrm{diag}(1,1,1)$。\n- 用例 2 (中等剪切, 近乎等容): $\\mathbf{F} = \\begin{bmatrix} 1.2  0.5  0 \\\\ 0.2  0.9  0 \\\\ 0  0  1 \\end{bmatrix}$。\n- 用例 3 (体积压缩): $\\mathbf{F} = \\mathrm{diag}(0.6,0.6,0.6)$。\n- 用例 4 (反转方向; 无效): $\\mathbf{F} = \\mathrm{diag}(-0.9,1.0,1.0)$。\n\n您的程序必须为每个用例实现检查，并在一行中生成一个用方括号括起来的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个按 $[\\text{symmetry\\_ok}, \\text{positive\\_definite\\_ok}, \\text{energy\\_consistency\\_ok}]$ 顺序排列的包含三个布尔值的列表。例如，输出格式应如下所示\n$$\n[\\,[\\text{True},\\text{True},\\text{True}],\\,[\\text{True},\\text{True},\\text{False}],\\,\\ldots\\,].\n$$\n除了必要的逗号和括号外，不得有任何额外的文本或空白。",
            "solution": "该问题已经过验证，并被确定为自洽的、有科学依据的、且适定的。任务是为指定的超弹性材料模型构建一个数值基准，评估其数值计算出的算法切线的属性。这涉及实现材料模型，使用有限差分计算其关于变形梯度的一阶和二阶导数，然后执行一系列关于对称性、正定性和能量一致性的检查。\n\n解决方案将首先详细介绍其背后的连续介质力学原理和将要采用的数值方法，然后介绍所需检查的实现逻辑。\n\n### 1. 超弹性本构模型\n\n材料响应由亥姆霍兹自由能势 $\\psi$ 控制，它是变形梯度 $\\mathbf{F} \\in \\mathbb{R}^{3 \\times 3}$ 的一个标量值函数。提供的具体形式是针对可压缩 Neo-Hookean 材料的：\n$$\n\\psi(\\mathbf{F}) = \\frac{\\mu}{2}\\left( I_1 - 3 - 2 \\ln J \\right) + \\frac{\\kappa}{2} \\left(\\ln J\\right)^2\n$$\n此势中的各项定义如下：\n- $I_1 = \\mathrm{tr}(\\mathbf{C}) = \\mathrm{tr}(\\mathbf{F}^\\top \\mathbf{F})$ 是右 Cauchy-Green 变形张量 $\\mathbf{C} = \\mathbf{F}^\\top \\mathbf{F}$ 的第一不变量。\n- $J = \\det(\\mathbf{F})$ 是变形梯度的行列式，表示局部体积变化。\n- $\\mu > 0$ 和 $\\kappa > 0$ 是材料参数，分别类似于剪切模量和体积模量。对于本问题，其无量纲值给定为 $\\mu = 1.0$ 和 $\\kappa = 1000.0$。\n\n一个基本的物理约束是体积必须保持为正，这转化为数学要求 $J > 0$。任何导致 $J \\le 0$ 的变形都被认为是物理上不可接受的，此时能量势未定义。我们的实现将严格执行此规定，在函数求值期间检测任何此类情况，并将整个测试用例标记为无效。\n\n### 2. 使用有限差分法（FDM）进行数值微分\n\n该问题要求对 $\\psi$ 的导数进行数值近似，禁止使用解析（闭式）表达式。这是代码验证中的常见做法，用于测试数值实现针对已知势的鲁棒性。\n\n为了对多变量标量函数应用标准数值微分技术，我们首先将 $3 \\times 3$ 的变形梯度 $\\mathbf{F}$ 向量化为一个 9 维向量 $\\mathbf{f}$。我们将采用行主序堆叠约定，这与像 NumPy 这样的库的默认行为一致。\n\n能量势对变形梯度的一阶导数产生第一 Piola-Kirchhoff 应力张量 $\\mathbf{P}$：\n$$\n\\mathbf{P} = \\frac{\\partial \\psi}{\\partial \\mathbf{F}}\n$$\n在向量化形式中，梯度向量 $\\mathbf{p} = \\mathrm{vec}(\\mathbf{P})$ 的每个分量都使用二阶中心差分公式计算，以提高精度：\n$$\np_i = \\frac{\\partial \\psi}{\\partial f_i} \\approx \\frac{\\psi(\\mathbf{f} + h \\mathbf{e}_i) - \\psi(\\mathbf{f} - h \\mathbf{e}_i)}{2h}\n$$\n其中 $\\mathbf{f}$ 是 $\\mathbf{F}$ 的向量化形式，$\\mathbf{e}_i$ 是 $\\mathbb{R}^9$ 中的第 $i$ 个标准基向量，而 $h = 10^{-6}$ 是指定的小步长。\n\n能量势的二阶导数是四阶算法切线张量 $\\mathbb{C}$：\n$$\n\\mathbb{C}_{ij,kl} = \\frac{\\partial^2 \\psi}{\\partial F_{ij} \\partial F_{kl}}\n$$\n在我们的向量化框架中，这对应于 $9 \\times 9$ 的 Hessian 矩阵 $H$，其中 $H_{ij} = \\partial^2 \\psi / \\partial f_i \\partial f_j$。我们使用混合偏导数的中心差分公式来计算其分量：\n$$\nH_{ij} \\approx \\frac{\\psi(\\mathbf{f}+h\\mathbf{e}_i+h\\mathbf{e}_j) - \\psi(\\mathbf{f}+h\\mathbf{e}_i-h\\mathbf{e}_j) - \\psi(\\mathbf{f}-h\\mathbf{e}_i+h\\mathbf{e}_j) + \\psi(\\mathbf{f}-h\\mathbf{e}_i-h\\mathbf{e}_j)}{4h^2}\n$$\n该公式应用于所有对 $(i, j)$ 以构建完整的 Hessian 矩阵 $H$。\n\n### 3. 基准标准与验证\n\n计算出的数值导数需经过三个不同的检查。\n\n**a) 对称性检查：**\n对于一个二次连续可微的势，微分的顺序无关紧要（Clairaut 定理），这意味着对称性 $\\mathbb{C}_{ij,kl} = \\mathbb{C}_{kl,ij}$。在矩阵形式下，这意味着 Hessian 矩阵 $H$ 必须是对称的，即 $H = H^\\top$。数值 FDM 计算会引入浮点误差，因此我们在指定的容差 $\\varepsilon_{\\text{sym}} = 10^{-6}$ 内验证此属性：\n$$\n\\text{如果 } \\max_{i,j} |H_{ij} - H_{ji}| \\le \\varepsilon_{\\text{sym}} \\text{，则对称性可接受}\n$$\n\n**b) 正定性检查：**\nHessian 矩阵的正定性是能量势局部凸性的一个条件。这对于材料响应的稳定性和确保有限元模拟中使用的 Newton-Raphson 算法的二次收敛至关重要。检查在对称化的 Hessian 矩阵 $H_{\\text{sym}} = \\frac{1}{2}(H + H^\\top)$ 上进行，以确保计算出的特征值为实数。条件是最小特征值必须大于或等于一个小的阈值 $\\varepsilon_{\\text{pd}} = 10^{-9}$：\n$$\n\\text{如果 } \\min \\lambda_i(H_{\\text{sym}}) \\ge \\varepsilon_{\\text{pd}} \\text{，则正定性可接受}\n$$\n\n**c) 能量一致性检查：**\n此检查可作为对计算出的梯度和 Hessian 矩阵正确性的综合测试。它将沿小微扰路径的实际能量变化与二阶泰勒级数展开预测的变化进行比较。\n微扰路径为 $\\mathbf{F}(t) = \\mathbf{F} + t \\Delta \\mathbf{F}$，其中 $\\Delta \\mathbf{F}$ 是一个具有单位 Frobenius 范数的固定微扰方向。\n实际能量增量为：\n$$\n\\Delta \\psi_{\\text{act}}(t) = \\psi(\\mathbf{F}(t)) - \\psi(\\mathbf{F})\n$$\n泰勒展开预测的能量增量为：\n$$\n\\Delta \\psi_{\\text{pred}}(t) = \\left\\langle \\frac{\\partial \\psi}{\\partial \\mathbf{F}}, \\Delta \\mathbf{F} \\right\\rangle t + \\frac{1}{2} \\, \\mathrm{vec}(\\Delta \\mathbf{F})^\\top H \\, \\mathrm{vec}(\\Delta \\mathbf{F}) \\, t^2\n$$\n如果对于所有指定的步长 $t \\in \\{10^{-4}, 10^{-3}, 10^{-2}\\}$，相对误差低于容差 $\\varepsilon_{\\text{eng}} = 0.05$，则一致性可接受：\n$$\n\\frac{\\left| \\Delta \\psi_{\\text{pred}}(t) - \\Delta \\psi_{\\text{act}}(t) \\right|}{\\left| \\Delta \\psi_{\\text{act}}(t) \\right| + \\delta} \\le \\varepsilon_{\\text{eng}}\n$$\n其中 $\\delta = 10^{-12}$ 是一个小的正则化常数，以防止除以零。\n\n### 4. 计算工作流\n\n对于每个测试用例 $\\mathbf{F}$，执行以下过程：\n1. 建立一个顶层 `try-except` 块来捕获在求值中出现 $J \\le 0$ 时引发的任何 `DomainError`。这可能发生在初始求值期间，或在有限差分或能量一致性检查的微扰期间。如果在任何阶段捕获到此类错误，该测试用例的所有三个检查都将立即标记为 `False`。\n2. 如果初始变形状态有效，则使用 FDM 例程计算梯度向量 $\\mathbf{p}$ 和 Hessian 矩阵 $H$。\n3. 使用指定的数值参数和容差，对计算出的量执行对称性、正定性和能量一致性检查。\n4. 每个测试用例的结果都以布尔值三元组的形式存储：$[\\text{symmetry\\_ok}, \\text{positive\\_definite\\_ok}, \\text{energy\\_consistency\\_ok}]$。\n5. 最后，将所有测试用例的收集结果按要求格式化为单行字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and runs a computational benchmark for a hyperelastic model.\n    \"\"\"\n    # Define problem parameters\n    MU = 1.0\n    KAPPA = 1000.0\n    H_FD = 1e-6\n    EPS_SYM = 1e-6\n    EPS_PD = 1e-9\n    EPS_ENG = 0.05\n    DELTA_ENG = 1e-12\n    T_STEPS = [1e-4, 1e-3, 1e-2]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        np.diag([1.0, 1.0, 1.0]),  # Case 1: Reference configuration\n        np.array([[1.2, 0.5, 0.0], [0.2, 0.9, 0.0], [0.0, 0.0, 1.0]]),  # Case 2: Shear\n        np.diag([0.6, 0.6, 0.6]),  # Case 3: Compression\n        np.diag([-0.9, 1.0, 1.0]), # Case 4: Invalid (inverted)\n    ]\n\n    # Reproducible perturbation direction\n    np.random.seed(42)\n    dF = np.random.rand(3, 3)\n    dF /= np.linalg.norm(dF) # Normalize to unit Frobenius norm\n\n    class DomainError(Exception):\n        \"\"\"Custom exception for invalid deformations (det(F) = 0).\"\"\"\n        pass\n\n    def psi(F, mu, kappa):\n        \"\"\"Computes the Helmholtz free energy for a compressible Neo-Hookean material.\"\"\"\n        J = np.linalg.det(F)\n        if J = 0:\n            raise DomainError(\"Determinant of F is not positive.\")\n        \n        # Invariants\n        I1 = np.trace(F.T @ F)\n        lnJ = np.log(J)\n        \n        # Energy calculation\n        energy = (mu / 2.0) * (I1 - 3.0 - 2.0 * lnJ) + (kappa / 2.0) * (lnJ**2)\n        return energy\n\n    def compute_gradient_fdm(psi_func, f_vec, h):\n        \"\"\"Computes gradient via central differences.\"\"\"\n        grad = np.zeros_like(f_vec)\n        dim = f_vec.shape[0]\n        \n        for i in range(dim):\n            e_i = np.zeros(dim)\n            e_i[i] = 1.0\n            \n            f_plus = f_vec + h * e_i\n            f_minus = f_vec - h * e_i\n            \n            psi_plus = psi_func(f_plus)\n            psi_minus = psi_func(f_minus)\n            \n            grad[i] = (psi_plus - psi_minus) / (2.0 * h)\n        \n        return grad\n\n    def compute_hessian_fdm(psi_func, f_vec, h):\n        \"\"\"Computes Hessian via central differences.\"\"\"\n        dim = f_vec.shape[0]\n        hess = np.zeros((dim, dim))\n        \n        for i in range(dim):\n            for j in range(i, dim): # Exploit symmetry for efficiency\n                p_i = np.zeros(dim); p_i[i] = h\n                p_j = np.zeros(dim); p_j[j] = h\n                \n                psi_pp = psi_func(f_vec + p_i + p_j)\n                psi_pm = psi_func(f_vec + p_i - p_j)\n                psi_mp = psi_func(f_vec - p_i + p_j)\n                psi_mm = psi_func(f_vec - p_i - p_j)\n                \n                hess_val = (psi_pp - psi_pm - psi_mp - psi_mm) / (4.0 * h**2)\n                hess[i, j] = hess_val\n                if i != j:\n                    hess[j, i] = hess_val\n        \n        return hess\n\n    results = []\n    for F_mat in test_cases:\n        symm_ok, pd_ok, eng_ok = False, False, False\n        \n        try:\n            # Define a lambda that takes a vector and computes energy\n            psi_vec = lambda fv: psi(fv.reshape(3, 3), MU, KAPPA)\n\n            # Check base state first\n            psi_base = psi(F_mat, MU, KAPPA)\n            \n            # Vectorize F\n            f_vec = F_mat.flatten()\n\n            # 1. Compute Gradient and Hessian\n            grad_vec = compute_gradient_fdm(psi_vec, f_vec, H_FD)\n            hess_mat = compute_hessian_fdm(psi_vec, f_vec, H_FD)\n            \n            # 2. Perform Checks\n            # Symmetry Check\n            symm_err = np.max(np.abs(hess_mat - hess_mat.T))\n            symm_ok = symm_err = EPS_SYM\n            \n            # Positive-Definiteness Check\n            hess_symm = (hess_mat + hess_mat.T) / 2.0\n            eigenvalues = np.linalg.eigvalsh(hess_symm)\n            min_eig = np.min(eigenvalues)\n            pd_ok = min_eig >= EPS_PD\n            \n            # Energy Consistency Check\n            is_consistent = True\n            grad_mat = grad_vec.reshape(3, 3)\n            dF_vec = dF.flatten()\n            \n            for t in T_STEPS:\n                F_pert = F_mat + t * dF\n                psi_pert = psi(F_pert, MU, KAPPA)\n                \n                delta_psi_act = psi_pert - psi_base\n                \n                grad_term = np.sum(grad_mat * dF)\n                hess_term = 0.5 * dF_vec @ hess_mat @ dF_vec\n                delta_psi_pred = grad_term * t + hess_term * t**2\n                \n                rel_err = abs(delta_psi_pred - delta_psi_act) / (abs(delta_psi_act) + DELTA_ENG)\n                \n                if rel_err > EPS_ENG:\n                    is_consistent = False\n                    break\n            \n            eng_ok = is_consistent\n\n        except DomainError:\n            # If det(F) = 0 at any point, all checks are False.\n            # The default False values are used.\n            pass\n\n        results.append([symm_ok, pd_ok, eng_ok])\n\n    # Final print statement in the exact required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "在学会了如何推导和验证本构关系后，最后一个练习将探讨在有限元框架中使用这些关系时可能出现的问题。本练习  聚焦于数值积分的关键作用，它将演示对非凸能量势进行不恰当的积分（即降阶积分）如何导致非物理的结果，例如伪软化 (spurious softening)。理解并避免这类数值病态是进行稳健可靠的模拟分析所必需的核心技能。",
            "id": "3569902",
            "problem": "考虑一个一维等参二次有限元，其三个节点位于位置 $x_1=0$、$x_2=L/2$ 和 $x_3=L$，其中 $L$ 是以米为单位的单元长度。设横截面积为 $A$（平方米）。该单元在父域 $\\xi \\in [-1,1]$ 上使用二次形函数 $N_i(\\xi)$ 插值位移场 $u(x)$，其线性映射为 $x(\\xi) = \\frac{L}{2}(\\xi+1)$，Jacobian 为 $J = \\frac{L}{2}$。这三个节点的二次形函数为 $N_1(\\xi) = \\frac{\\xi(\\xi-1)}{2}$、$N_2(\\xi) = 1 - \\xi^2$ 和 $N_3(\\xi) = \\frac{\\xi(\\xi+1)}{2}$。位移梯度和小应变定义为 $u(x) = \\sum_{i=1}^3 N_i(\\xi) u_i$ 和 $\\varepsilon(\\xi) = \\frac{du}{dx} = \\sum_{i=1}^3 \\frac{dN_i}{dx}(\\xi) u_i$，其中 $\\frac{dN_i}{dx}(\\xi) = \\frac{dN_i}{d\\xi}(\\xi) \\frac{d\\xi}{dx}$ 且 $\\frac{d\\xi}{dx} = \\frac{2}{L}$。\n\n采用以下形式的单位体积 Helmholtz 自由能（HFE）密度（单位为帕斯卡）：\n$$\n\\psi(\\varepsilon) = G \\, \\frac{(\\varepsilon^2 - \\varepsilon_c^2)^2}{4},\n$$\n其中 $G$ 是一个单位为帕斯卡的材料参数，$\\varepsilon_c$ 是一个无量纲应变标度。第一 Piola-Kirchhoff 应力（在一维小应变情况下简化为 Cauchy 应力）由本构关系定义：\n$$\n\\sigma(\\varepsilon) = \\frac{d\\psi}{d\\varepsilon},\n$$\n且一致切线模量为：\n$$\nC(\\varepsilon) = \\frac{d^2\\psi}{d\\varepsilon^2}.\n$$\n在有限元法（FEM）中，单元 Helmholtz 自由能（单位为焦耳）和单元一致切线剛度矩阵（单位为牛顿每米）分别为：\n$$\n\\Pi = \\int_{-1}^{1} \\psi(\\varepsilon(\\xi)) \\, A \\, J \\, d\\xi,\n\\quad\n\\mathbf{K} = \\int_{-1}^{1} \\mathbf{B}(\\xi)^\\top C(\\varepsilon(\\xi)) \\mathbf{B}(\\xi) \\, A \\, J \\, d\\xi,\n$$\n其中 $\\mathbf{B}(\\xi) = \\left[\\frac{dN_1}{dx}(\\xi), \\frac{dN_2}{dx}(\\xi), \\frac{dN_3}{dx}(\\xi)\\right]$。\n\n您必须研究积分阶数对单元 Helmholtz 自由能和单元一致切线刚度数值精度的影响，并展示当对非凸自由能密度 $\\psi$ 进行欠积分时出现伪软化的可能性。非凸性的产生是因为对于低于某个依赖于 $\\varepsilon_c$ 的阈值的应变 $|\\varepsilon|$，$C(\\varepsilon) = \\frac{d^2\\psi}{d\\varepsilon^2}$ 可能为负，这意味着 $\\psi$ 的局部凸性丧失。\n\n仅从以下几点出发：\n- 上述 Helmholtz 自由能密度 $\\psi(\\varepsilon)$ 的定义以及本构关系 $\\sigma(\\varepsilon) = \\frac{d\\psi}{d\\varepsilon}$ 和 $C(\\varepsilon) = \\frac{d^2\\psi}{d\\varepsilon^2}$，\n- 小应变运动学 $\\varepsilon(\\xi) = \\sum_i \\frac{dN_i}{dx}(\\xi) u_i$，以及带有 Jacobian $J$ 的等参映射 $x(\\xi)$，\n- $[-1,1]$ 上的标准 Gaussian 积分法则，\n\n推导适用于数值计算的 $\\Pi$ 和 $\\mathbf{K}$ 的表达式，并使用不同的 Gaussian 积分阶数实现它们。使用 $1$、$2$、$3$ 和 $5$ 阶 Gaussian 积分来近似积分。使用高阶 Gaussian 积分（取 $200$ 个点）作为基准参考，以近似“精确”积分。对于每个积分阶数，计算：\n- 绝对能量误差 $|\\Pi_{\\text{approx}} - \\Pi_{\\text{baseline}}|$（单位为焦耳）。\n- 刚度矩阵的最小特征值 $\\lambda_{\\min}(\\mathbf{K})$（单位为牛顿每米）。\n\n将某一积分阶数下的伪软化定义为以下情况：基准单元刚度的最小特征值为非负（即 $\\lambda_{\\min}(\\mathbf{K}_{\\text{baseline}}) \\ge 0$），而该积分阶数下近似刚度的最小特征值为负（即 $\\lambda_{\\min}(\\mathbf{K}_{\\text{approx}})  0$）。\n\n使用以下物理上合理的参数和测试套件：\n- 单元长度 $L = 1.0$ 米。\n- 横截面积 $A = 0.01$ 平方米。\n- 材料参数 $G = 2.0 \\times 10^8$ 帕斯卡。\n- 非凸性标度 $\\varepsilon_c = 0.01$ (无量纲)。\n- 位移测试用例（节点位移，单位为米）：\n    1. 用例1（通用“理想路径”）：$[u_1,u_2,u_3] = [0.0, \\, 0.02, \\, 0.04]$。\n    2. 用例2（非凸穿越；旨在显示 $1$ 点积分下的伪軟化）：$[u_1,u_2,u_3] = [0.008, \\, 0.006, \\, 0.009]$。\n    3. 用例3（边界条件；精确线性位移场）：$[u_1,u_2,u_3] = [0.0, \\, 0.01, \\, 0.02]$。\n\n对于每个测试用例，您必须计算：\n- 积分阶数为 $1, 2, 3, 5$ 时的绝对能量误差（单位为焦耳）。\n- 如上定义的 $1$ 点积分下是否发生伪软化的布尔值。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按测试用例排序，且每个用例内按上述项目排序。具体来说，输出格式必须为：\n$$\n[\\Delta \\Pi^{(1)}_{\\text{case 1}}, \\Delta \\Pi^{(2)}_{\\text{case 1}}, \\Delta \\Pi^{(3)}_{\\text{case 1}}, \\Delta \\Pi^{(5)}_{\\text{case 1}}, \\text{soft}^{(1)}_{\\text{case 1}},\n\\Delta \\Pi^{(1)}_{\\text{case 2}}, \\Delta \\Pi^{(2)}_{\\text{case 2}}, \\Delta \\Pi^{(3)}_{\\text{case 2}}, \\Delta \\Pi^{(5)}_{\\text{case 2}}, \\text{soft}^{(1)}_{\\text{case 2}},\n\\Delta \\Pi^{(1)}_{\\text{case 3}}, \\Delta \\Pi^{(2)}_{\\text{case 3}}, \\Delta \\Pi^{(3)}_{\\text{case 3}}, \\Delta \\Pi^{(5)}_{\\text{case 3}}, \\text{soft}^{(1)}_{\\text{case 3}}]\n$$\n其中 $\\Delta \\Pi^{(q)}_{\\text{case i}}$ 表示积分阶数为 $q$、测试用例为 $i$ 时的绝对能量误差（单位为焦耳），而 $\\text{soft}^{(1)}_{\\text{case i}}$ 是指示测试用例 $i$ 在 $1$ 点积分下是否出现伪软化的布尔值。\n\n所有能量必须以焦耳表示，所有刚度矩阵特征值必须以牛顿每米表示。此问题不涉及角度，因此不需要角度单位。不使用百分比；任何分数数量必须表示为小数。\n\n解决方案应说明单元能量和一致切线是什么，为什么这些公式可以从基本定义推导得出，以及如何通过 Gaussian 积分实现它们，并强调逻辑推导过程。然后，编写一个完整、可运行的程序，为上述测试套件计算并输出所需的列表。",
            "solution": "该问题要求研究数值积分阶数对一个由非凸 Helmholtz 自由能势控制的系统的有限元近似产生的影响。具体而言，我们的任务是计算一维二次杆单元在不同位移情景下的总自由能 $\\Pi$ 及其一致切线刚度矩阵 $\\mathbf{K}$。我们将使用不同点数的 Gaussian 积分，并将结果与高精度基准进行比较，以量化积分误差并识别潜在的数值僞影，例如伪软化。\n\n首先，我们建立理论基础，从本构模型和运动学关系开始。\n\n单位体积的 Helmholtz 自由能密度 $\\psi$ 是一个关于小应变 $\\varepsilon$ 的非凸函数：\n$$\n\\psi(\\varepsilon) = G \\, \\frac{(\\varepsilon^2 - \\varepsilon_c^2)^2}{4}\n$$\n其中 $G$ 是一个材料模量，$\\varepsilon_c$ 是一个应变标度参数。这种形式是一个双阱势，在特定的应变范围内表现出非凸性。一维 Cauchy 应力 $\\sigma$ 和一致切线模量 $C$ 的本构关系通过对 $\\psi$ 求关于 $\\varepsilon$ 的逐次导数得到：\n$$\n\\sigma(\\varepsilon) = \\frac{d\\psi}{d\\varepsilon} = \\frac{G}{4} \\cdot 2(\\varepsilon^2 - \\varepsilon_c^2) \\cdot (2\\varepsilon) = G \\varepsilon (\\varepsilon^2 - \\varepsilon_c^2)\n$$\n$$\nC(\\varepsilon) = \\frac{d^2\\psi}{d\\varepsilon^2} = \\frac{d\\sigma}{d\\varepsilon} = G \\left[ 1 \\cdot (\\varepsilon^2 - \\varepsilon_c^2) + \\varepsilon \\cdot (2\\varepsilon) \\right] = G(3\\varepsilon^2 - \\varepsilon_c^2)\n$$\n当 $3\\varepsilon^2  \\varepsilon_c^2$ 或 $|\\varepsilon|  \\varepsilon_c/\\sqrt{3}$ 时，切线模量 $C(\\varepsilon)$ 为负。在此区间内，能量密度函数 $\\psi(\\varepsilon)$ 是局部凹的，这对应于材料不稳定性。\n\n接下来，我们使用等参格式定义单元运动学。单元中的物理坐标 $x$ 通过形函数和节点坐标从父坐标 $\\xi \\in [-1, 1]$ 映射而来。然而，对于线性间隔的节点集，此映射是线性的：$x(\\xi) = \\frac{L}{2}(\\xi+1)$，其中 $L$ 是单元长度。该变换的 Jacobian 是一个常数：\n$$\nJ = \\frac{dx}{d\\xi} = \\frac{L}{2}\n$$\n位移场 $u$ 使用二次形函数 $N_i(\\xi)$ 和节点位移 $\\mathbf{u} = [u_1, u_2, u_3]^\\top$ 在单元内插值：\n$$\nu(\\xi) = \\sum_{i=1}^3 N_i(\\xi) u_i\n$$\n应变 $\\varepsilon = du/dx$ 使用链式法则求得：\n$$\n\\varepsilon(\\xi) = \\frac{du}{dx} = \\frac{du}{d\\xi} \\frac{d\\xi}{dx} = \\left(\\sum_{i=1}^3 \\frac{dN_i}{d\\xi} u_i\\right) \\frac{1}{J}\n$$\n这可以写成矩阵形式 $\\varepsilon(\\xi) = \\mathbf{B}(\\xi)\\mathbf{u}$，其中 $\\mathbf{B}(\\xi)$ 是应变-位移矩阵（在此一维情况下为 $1 \\times 3$ 的行向量）：\n$$\n\\mathbf{B}(\\xi) = \\left[ \\frac{dN_1}{dx}(\\xi), \\frac{dN_2}{dx}(\\xi), \\frac{dN_3}{dx}(\\xi) \\right] = \\frac{1}{J} \\left[ \\frac{dN_1}{d\\xi}(\\xi), \\frac{dN_2}{d\\xi}(\\xi), \\frac{dN_3}{d\\xi}(\\xi) \\right]\n$$\n使用给定的形函数 $N_1(\\xi) = \\frac{\\xi(\\xi-1)}{2}$、$N_2(\\xi) = 1 - \\xi^2$ 和 $N_3(\\xi) = \\frac{\\xi(\\xi+1)}{2}$，它们关于 $\\xi$ 的导数为：\n$$\n\\frac{dN_1}{d\\xi} = \\xi - \\frac{1}{2}, \\quad \\frac{dN_2}{d\\xi} = -2\\xi, \\quad \\frac{dN_3}{d\\xi} = \\xi + \\frac{1}{2}\n$$\n将这些代入 $\\mathbf{B}(\\xi)$ 的表达式并使用 $J=L/2$，得到：\n$$\n\\mathbf{B}(\\xi) = \\frac{2}{L} \\left[ \\xi - \\frac{1}{2}, -2\\xi, \\xi + \\frac{1}{2} \\right]\n$$\n单元的总 Helmholtz 自由能 $\\Pi$ 和切线刚度矩阵 $\\mathbf{K}$ 是通过在单元体积上对能量密度和切线模量进行积分得到的。将积分变换到父域可得：\n$$\n\\Pi = \\int_{0}^{L} \\psi(\\varepsilon(x)) A \\, dx = \\int_{-1}^{1} \\psi(\\varepsilon(\\xi)) A J \\, d\\xi\n$$\n$$\n\\mathbf{K} = \\int_{-1}^{1} \\mathbf{B}(\\xi)^\\top C(\\varepsilon(\\xi)) \\mathbf{B}(\\xi) A J \\, d\\xi\n$$\n其中 $A$ 是横截面积。这些积分通常使用 Gaussian 积分进行数值计算：\n$$\n\\int_{-1}^{1} f(\\xi) \\, d\\xi \\approx \\sum_{k=1}^{q} w_k f(\\xi_k)\n$$\n其中 $q$ 是积分阶数，$\\{\\xi_k, w_k\\}$ 是积分点和权重。将此应用于我们的积分：\n$$\n\\Pi_{\\text{approx}} = A J \\sum_{k=1}^{q} w_k \\psi(\\mathbf{B}(\\xi_k)\\mathbf{u})\n$$\n$$\n\\mathbf{K}_{\\text{approx}} = A J \\sum_{k=1}^{q} w_k \\mathbf{B}(\\xi_k)^\\top C(\\mathbf{B}(\\xi_k)\\mathbf{u}) \\mathbf{B}(\\xi_k)\n$$\n此近似的精度取决于阶数 $q$ 和被积函数的多项式次数。应变 $\\varepsilon(\\xi) = \\mathbf{B}(\\xi)\\mathbf{u}$ 是 $\\xi$ 的线性函数。\n能量的被积函数 $\\psi(\\varepsilon(\\xi)) = \\frac{G}{4}((\\varepsilon(\\xi))^2 - \\varepsilon_c^2)^2$ 是 $\\xi$ 的八次多项式。一个 $q$ 点的 Gaussian 积分法则能精确地积分最高 $2q-1$ 次的多项式。因此，为精确积分 $\\Pi$，我们需要 $2q-1 \\ge 8 \\implies q \\ge 4.5$。需要一个 $5$ 点法则。\n刚度的被积函数 $\\mathbf{B}(\\xi)^\\top C(\\varepsilon(\\xi)) \\mathbf{B}(\\xi)$ 涉及 $C(\\varepsilon(\\xi))$（一个关于 $\\xi$ 的二次多项式）和矩阵 $\\mathbf{B}(\\xi)^\\top \\mathbf{B}(\\xi)$（其元素是关于 $\\xi$ 的二次多项式）的乘积。最终的被积函数包含四次多项式。为精确积分，我们需要 $2q-1 \\ge 4 \\implies q \\ge 2.5$。需要一个 $3$ 点法则。\n使用更少的点（欠积分）会导致显著误差。对于非凸势，欠积分可能无法捕捉到负切线模量的区域，可能在真实矩阵非正定时产生一个正定刚度矩阵，反之亦然（伪软化）。\n\n指定的问题将积分阶数 $q$ 下的伪软化定义为以下情况：基准刚度矩阵 $\\mathbf{K}_{\\text{baseline}}$（用 $q=200$ 近似）具有非负的最小特征值 $\\lambda_{\\min}(\\mathbf{K}_{\\text{baseline}}) \\ge 0$，而近似矩阵 $\\mathbf{K}_{\\text{approx}}$ 具有负的最小特征值 $\\lambda_{\\min}(\\mathbf{K}_{\\text{approx}})  0$。\n\n实现过程將首先定义一个函数，用于根据给定的位移向量 $\\mathbf{u}$ 和积分阶数 $q$ 计算 $\\Pi$ 和 $\\mathbf{K}$。该函数将遍历 Gaussian 点，计算每个点的应变 $\\varepsilon(\\xi_k)$、能量密度 $\\psi(\\varepsilon(\\xi_k))$ 和切线模量 $C(\\varepsilon(\\xi_k))$，并根据积分求和组装最终的能量和刚度矩阵。对每个测试用例以及积分阶数 $q \\in \\{1, 2, 3, 5\\}$ 和基准阶数 $q=200$ 重复此过程。然后，对每个用例评估并报告绝对能量误差 $|\\Pi_{\\text{approx}} - \\Pi_{\\text{baseline}}|$ 和 $q=1$ 时的伪软化条件。",
            "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Solves the computational solid mechanics problem as defined.\n    \"\"\"\n    # Physical parameters\n    L = 1.0  # meters\n    A = 0.01  # square meters\n    G = 2.0e8  # Pascals\n    Ec = 0.01  # dimensionless\n\n    # Jacobian of the transformation\n    J = L / 2.0\n\n    # Displacement test cases (u1, u2, u3) in meters\n    test_cases = [\n        np.array([0.0, 0.02, 0.04]),    # Case 1\n        np.array([0.008, 0.006, 0.009]), # Case 2\n        np.array([0.0, 0.01, 0.02]),    # Case 3\n    ]\n\n    # Quadrature orders to test\n    quad_orders = [1, 2, 3, 5]\n    baseline_order = 200\n\n    # Cache for Gaussian quadrature points and weights\n    gauss_cache = {}\n\n    def get_gauss_points(q_order):\n        if q_order not in gauss_cache:\n            points, weights = leggauss(q_order)\n            gauss_cache[q_order] = (points, weights)\n        return gauss_cache[q_order]\n\n    def B_matrix(xi, length):\n        \"\"\"Computes the strain-displacement matrix B(xi).\"\"\"\n        return (2.0 / length) * np.array([xi - 0.5, -2.0 * xi, xi + 0.5])\n\n    def psi(epsilon, g_mod, eps_c):\n        \"\"\"Computes Helmholtz free energy density.\"\"\"\n        return g_mod * ((epsilon**2 - eps_c**2)**2) / 4.0\n\n    def C_tangent(epsilon, g_mod, eps_c):\n        \"\"\"Computes the consistent tangent modulus.\"\"\"\n        return g_mod * (3.0 * epsilon**2 - eps_c**2)\n\n    def compute_energy_stiffness(u_nodes, q_order):\n        \"\"\"\n        Computes the element Helmholtz free energy and consistent tangent stiffness matrix.\n        \"\"\"\n        gauss_points, gauss_weights = get_gauss_points(q_order)\n        \n        pi_element = 0.0\n        K_element = np.zeros((3, 3))\n\n        for xi, w in zip(gauss_points, gauss_weights):\n            B = B_matrix(xi, L)\n            epsilon = B @ u_nodes\n            \n            # Energy calculation\n            psi_val = psi(epsilon, G, Ec)\n            pi_element += psi_val * w\n            \n            # Stiffness calculation\n            C_val = C_tangent(epsilon, G, Ec)\n            K_element += (np.outer(B, B) * C_val) * w\n            \n        pi_element *= A * J\n        K_element *= A * J\n        \n        return pi_element, K_element\n\n    results = []\n    for u_vec in test_cases:\n        # Compute baseline results\n        pi_baseline, K_baseline = compute_energy_stiffness(u_vec, baseline_order)\n        # For a real symmetric matrix, eigh is preferred. Eigenvalues are sorted.\n        lambda_min_baseline = np.linalg.eigh(K_baseline)[0][0]\n\n        # Compute results for specified quadrature orders\n        pi_approx_1, K_approx_1 = compute_energy_stiffness(u_vec, 1)\n\n        for q in quad_orders:\n            pi_approx, _ = compute_energy_stiffness(u_vec, q)\n            \n            # Absolute energy error\n            delta_pi = abs(pi_approx - pi_baseline)\n            results.append(delta_pi)\n\n        # Check for spurious softening for q=1\n        lambda_min_approx_1 = np.linalg.eigh(K_approx_1)[0][0]\n        spurious_softening = (lambda_min_baseline >= 0) and (lambda_min_approx_1  0)\n        \n        results.append(spurious_softening)\n\n    # Format output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}