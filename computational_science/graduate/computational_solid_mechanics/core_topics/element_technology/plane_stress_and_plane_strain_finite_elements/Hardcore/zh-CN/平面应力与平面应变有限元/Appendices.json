{
    "hands_on_practices": [
        {
            "introduction": "单元刚度矩阵 $K^e$ 是任何有限元分析的核心，它将单元的节点位移与其节点力联系起来。本练习将引导您从第一性原理出发，推导平面应力状态下四节点四边形 (Q4) 单元的刚度矩阵。掌握这一推导过程对于深刻理解单元行为的数学表述至关重要。",
            "id": "3588803",
            "problem": "考虑一个厚度为 $t$ 的均匀四节点双线性等参四边形（$\\mathrm{Q4}$）有限元，用于模拟处于平面应力状态下的均匀、线弹性、各向同性材料。节点按逆时针顺序排列，该单元在物理坐标系中占据一个矩形区域，在 $x$ 和 $y$ 方向的边长均为 $a$。从母空间 $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ 到物理空间 $(x,y)$ 的映射是无畸变且仿射的。泊松比为 $\\nu$，杨氏模量为 $E$。使用有限元法（FEM），从虚功原理和小应变运动学出发，采用母空间中的 $2\\times 2$ 高斯求积，推导平面应力下的 $\\mathrm{Q4}$ 单元刚度矩阵。清晰阐述对于一个无畸变等参四边形，在何种条件下 $2\\times 2$ 高斯求积能够精确积分其刚度矩阵。\n\n最后，对于同一个无畸变方形单元，报告通过 $2\\times 2$ 高斯求积得到的单元刚度矩阵的第 $(1,1)$ 项（对应于节点1的 $x$ 方向位移自由度）的闭式符号表达式。最终答案仅用 $E$、$\\nu$ 和 $t$ 表示。无需进行数值计算。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤 1：提取已知条件\n- 单元类型：四节点双线性等参四边形（$\\mathrm{Q4}$）\n- 几何形状：物理坐标系中的矩形区域，在 $x$ 和 $y$ 方向的边长均为 $a$。\n- 厚度：均匀，记为 $t$。\n- 材料属性：均匀、线弹性、各向同性，杨氏模量为 $E$，泊松比为 $\\nu$。\n- 应力状态：平面应力。\n- 映射：从母空间 $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$ 到物理空间 $(x,y)$ 是无畸变且仿射的。\n- 节点排序：逆时针。\n- 数值积分：$2 \\times 2$ 高斯求积。\n- 任务1：推导平面应力下的 $\\mathrm{Q4}$ 单元刚度矩阵。\n- 任务2：阐述对于一个无畸变等参四边形，使用 $2 \\times 2$ 高斯求积精确积分其刚度矩阵的条件。\n- 任务3：报告指定方形单元的单元刚度矩阵第 $(1,1)$ 项 $k_{11}$ 的闭式符号表达式。答案应仅用 $E$、$\\nu$ 和 $t$ 表示。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学性：** 该问题是计算固体力学和有限元法（FEM）领域的一个标准、典型问题。所有概念，包括平面应力、线弹性、等参格式和高斯求积，都是基础且科学合理的。\n- **适定性：** 该问题定义明确。它提供了所有必要的材料属性（$E, \\nu$）、几何参数（$a, t$）和程序细节（平面应力、$\\mathrm{Q4}$ 单元、$2 \\times 2$ 高斯求积），足以推导出刚度矩阵及其特定分量的唯一且有意义的解。\n- **客观性：** 该问题以精确、客观的语言陈述，没有任何主观或模糊的术语。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它科学合理、适定且客观。它没有违反任何指定的无效标准。因此，将提供一个合理的解答。\n\n***\n\n对于一个二维连续介质单元，其单元刚度矩阵 $\\mathbf{K}^e$ 是从虚功原理推导出来的。它由应变-位移矩阵 $\\mathbf{B}$、本构矩阵 $\\mathbf{D}$ 和应变-位移矩阵的转置 $\\mathbf{B}^T$ 的乘积在单元体积 $V^e$ 上的积分给出。对于厚度为 $t$ 的均匀单元，该积分变为：\n$$ \\mathbf{K}^e = \\int_{V^e} \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dV = t \\int_{A^e} \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dA $$\n其中 $A^e$ 是单元在物理 $(x,y)$ 坐标系中的面积。\n\n等参格式将此积分映射到母域 $(\\xi, \\eta) \\in [-1, 1] \\times [-1, 1]$ 中：\n$$ \\mathbf{K}^e = t \\int_{-1}^{1} \\int_{-1}^{1} \\mathbf{B}^T \\mathbf{D} \\mathbf{B} J \\, d\\xi \\, d\\eta $$\n其中 $J$ 是雅可比矩阵 $\\mathbf{J}$ 的行列式。\n\n该公式的各组成部分如下：\n\n**1. 本构矩阵 ($\\mathbf{D}$):**\n对于平面应力条件下的线弹性、各向同性材料，关联应力向量 $\\boldsymbol{\\sigma} = \\{\\sigma_x, \\sigma_y, \\tau_{xy}\\}^T$ 与应变向量 $\\boldsymbol{\\epsilon} = \\{\\epsilon_x, \\epsilon_y, \\gamma_{xy}\\}^T$ 的本构矩阵为：\n$$ \\mathbf{D} = \\frac{E}{1-\\nu^2} \\begin{pmatrix} 1  \\nu  0 \\\\ \\nu  1  0 \\\\ 0  0  \\frac{1-\\nu}{2} \\end{pmatrix} $$\n\n**2. 应变-位移矩阵 ($\\mathbf{B}$):**\n应变通过应变-位移矩阵 $\\mathbf{B}$ 与节点位移 $\\mathbf{d}^e = \\{u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4\\}^T$ 相关联，其中 $\\boldsymbol{\\epsilon} = \\mathbf{B} \\mathbf{d}^e$。$\\mathbf{B}$ 矩阵由各节点的贡献 $\\mathbf{B}_i$ 组装而成：\n$$ \\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4], \\quad \\text{其中} \\quad \\mathbf{B}_i = \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y}  \\frac{\\partial N_i}{\\partial x} \\end{pmatrix} $$\n量 $N_i$ 是 $\\mathrm{Q4}$ 单元的双线性形函数：\n$$ N_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta) \\quad N_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta) $$\n$$ N_3(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta) \\quad N_4(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta) $$\n\n**3. 变换的雅可比矩阵 ($\\mathbf{J}$):**\n形函数相对于物理坐标 $(x,y)$ 的导数是使用链式法则求得的，这涉及到雅可比矩阵 $\\mathbf{J}$：\n$$ \\begin{Bmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{Bmatrix} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} \\begin{Bmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{Bmatrix} = \\mathbf{J} \\begin{Bmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{Bmatrix} $$\n$\\mathbf{J}$ 的分量由单元几何 $x(\\xi, \\eta) = \\sum_i N_i(\\xi, \\eta) x_i$ 和 $y(\\xi, \\eta) = \\sum_i N_i(\\xi, \\eta) y_i$ 计算得出。对于指定的边长为 $a$ 的方形单元，我们可以将其中心置于原点，得到节点坐标：$P_1(-a/2, -a/2)$、$P_2(a/2, -a/2)$、$P_3(a/2, a/2)$ 和 $P_4(-a/2, a/2)$。映射变为：\n$$ x = \\frac{a}{2}\\xi \\quad \\text{和} \\quad y = \\frac{a}{2}\\eta $$\n因此，雅可比矩阵是常数：\n$$ \\mathbf{J} = \\begin{pmatrix} a/2  0 \\\\ 0  a/2 \\end{pmatrix} $$\n雅可比行列式为 $J = \\det(\\mathbf{J}) = \\frac{a^2}{4}$，它也是一个常数。逆雅可比矩阵为：\n$$ \\mathbf{J}^{-1} = \\begin{pmatrix} 2/a  0 \\\\ 0  2/a \\end{pmatrix} $$\n\n**精确积分的条件：**\n刚度矩阵使用数值求积进行计算：\n$$ \\mathbf{K}^e = t \\sum_{i=1}^{n} \\sum_{j=1}^{n} w_i w_j \\left[ \\mathbf{B}^T \\mathbf{D} \\mathbf{B} J \\right]_{(\\xi_i, \\eta_j)} $$\n其中 $(\\xi_i, \\eta_j)$ 是高斯点，$w_i, w_j$ 是对应的权重。一个 $2 \\times 2$ 的高斯求积方案（$n=2$）对于每个变量 $\\xi$ 和 $\\eta$ 中最高为 $2n-1 = 3$ 次的多项式是精确的。\n我们来考察被积函数 $\\mathbf{F}(\\xi, \\eta) = \\mathbf{B}^T \\mathbf{D} \\mathbf{B} J$。矩阵 $\\mathbf{D}$ 是常数。对于几何形状为平行四边形（包括矩形、菱形等）的单元，其映射是仿射的，雅可比矩阵 $\\mathbf{J}$ 及其行列式 $J$ 都是常数。\n形函数相对于母坐标的导数（例如 $\\frac{\\partial N_i}{\\partial \\xi}$）是另一个母坐标的线性函数。由于 $\\mathbf{J}^{-1}$ 是常数，因此相对于物理坐标的导数（例如 $\\frac{\\partial N_i}{\\partial x}$）也同样是 $\\xi$ 或 $\\eta$ 的线性函数。\n因此，$\\mathbf{B}$ 矩阵的项是 $\\xi$ 和 $\\eta$ 的线性函数。乘积 $\\mathbf{B}^T \\mathbf{D} \\mathbf{B}$ 的项将是关于 $\\xi$ 和 $\\eta$ 的最高为 $2$ 次的多项式（例如，形如 $\\xi^2, \\eta^2, \\xi\\eta, \\xi, \\eta$ 的项）。\n由于被积函数是一个最高为 $2$ 次的多项式，而 $2 \\times 2$ 高斯求积对于最高 $3$ 次的多项式是精确的，因此它将能精确地积分刚度矩阵。\n**因此，对于一个等参四边形单元，使用 $2 \\times 2$ 高斯求积能够精确积分其刚度矩阵的条件是：该单元在物理坐标系中的几何形状必须是平行四边形，这能确保雅可比矩阵 $\\mathbf{J}$ 为常数。**\n\n**刚度矩阵分量 $k_{11}$ 的计算：**\n我们需要求解单元刚度矩阵 $\\mathbf{K}^e$ 的第 $(1,1)$ 项，该项对应于自由度 $u_1$（节点1的 $x$ 方向位移）。它由子矩阵 $\\mathbf{k}_{11} = t \\int_{A^e} \\mathbf{B}_1^T \\mathbf{D} \\mathbf{B}_1 dA$ 的第 $(1,1)$ 项给出。\n设 $\\mathbf{B}_1$ 的列向量为 $\\mathbf{b}_{1u}$ 和 $\\mathbf{b}_{1v}$。所求项为：\n$$ k_{11} = t \\int_{A^e} \\mathbf{b}_{1u}^T \\mathbf{D} \\mathbf{b}_{1u} \\, dA = t \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{b}_{1u}^T \\mathbf{D} \\mathbf{b}_{1u} J \\, d\\xi d\\eta $$\n内积为：\n$$ \\mathbf{b}_{1u}^T \\mathbf{D} \\mathbf{b}_{1u} = \\begin{pmatrix} \\frac{\\partial N_1}{\\partial x}  0  \\frac{\\partial N_1}{\\partial y} \\end{pmatrix} \\frac{E}{1-\\nu^2} \\begin{pmatrix} 1  \\nu  0 \\\\ \\nu  1  0 \\\\ 0  0  \\frac{1-\\nu}{2} \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial N_1}{\\partial x} \\\\ 0 \\\\ \\frac{\\partial N_1}{\\partial y} \\end{pmatrix} = \\frac{E}{1-\\nu^2} \\left[ \\left(\\frac{\\partial N_1}{\\partial x}\\right)^2 + \\frac{1-\\nu}{2}\\left(\\frac{\\partial N_1}{\\partial y}\\right)^2 \\right] $$\n我们求 $N_1$ 的导数：\n$$ \\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta), \\quad \\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi) $$\n$$ \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial x} \\\\ \\frac{\\partial N_1}{\\partial y} \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial \\xi} \\\\ \\frac{\\partial N_1}{\\partial \\eta} \\end{Bmatrix} = \\begin{pmatrix} 2/a  0 \\\\ 0  2/a \\end{pmatrix} \\begin{Bmatrix} -\\frac{1}{4}(1-\\eta) \\\\ -\\frac{1}{4}(1-\\xi) \\end{Bmatrix} = \\begin{Bmatrix} -\\frac{1}{2a}(1-\\eta) \\\\ -\\frac{1}{2a}(1-\\xi) \\end{Bmatrix} $$\n将这些以及 $J=a^2/4$ 代入 $k_{11}$ 的表达式中：\n$$ k_{11} = t \\int_{-1}^{1}\\int_{-1}^{1} \\frac{E}{1-\\nu^2} \\left[ \\left(\\frac{-(1-\\eta)}{2a}\\right)^2 + \\frac{1-\\nu}{2} \\left(\\frac{-(1-\\xi)}{2a}\\right)^2 \\right] \\frac{a^2}{4} \\, d\\xi d\\eta $$\n$$ k_{11} = \\frac{Et}{1-\\nu^2} \\frac{a^2}{4} \\frac{1}{4a^2} \\int_{-1}^{1}\\int_{-1}^{1} \\left[ (1-\\eta)^2 + \\frac{1-\\nu}{2} (1-\\xi)^2 \\right] \\, d\\xi d\\eta $$\n$$ k_{11} = \\frac{Et}{16(1-\\nu^2)} \\int_{-1}^{1}\\int_{-1}^{1} \\left[ (1-2\\eta+\\eta^2) + \\frac{1-\\nu}{2} (1-2\\xi+\\xi^2) \\right] \\, d\\xi d\\eta $$\n由于 $2 \\times 2$ 高斯求积是精确的，我们可以进行解析积分。我们使用标准积分 $\\int_{-1}^{1} 1\\,dz = 2$、$\\int_{-1}^{1} z\\,dz = 0$ 和 $\\int_{-1}^{1} z^2\\,dz = 2/3$。\n$$ \\int_{-1}^{1}\\int_{-1}^{1} (1-2\\eta+\\eta^2) \\, d\\xi d\\eta = \\int_{-1}^{1} d\\xi \\int_{-1}^{1} (1-2\\eta+\\eta^2) \\, d\\eta = (2) \\left(2-0+\\frac{2}{3}\\right) = 2 \\cdot \\frac{8}{3} = \\frac{16}{3} $$\n$$ \\int_{-1}^{1}\\int_{-1}^{1} \\frac{1-\\nu}{2} (1-2\\xi+\\xi^2) \\, d\\xi d\\eta = \\frac{1-\\nu}{2} \\int_{-1}^{1} d\\eta \\int_{-1}^{1} (1-2\\xi+\\xi^2) \\, d\\xi = \\frac{1-\\nu}{2} (2) \\left(\\frac{8}{3}\\right) = \\frac{8(1-\\nu)}{3} $$\n将结果相加：\n$$ k_{11} = \\frac{Et}{16(1-\\nu^2)} \\left[ \\frac{16}{3} + \\frac{8(1-\\nu)}{3} \\right] = \\frac{Et}{16(1-\\nu^2)} \\frac{8}{3} [2 + (1-\\nu)] $$\n$$ k_{11} = \\frac{Et}{6(1-\\nu^2)} (3-\\nu) $$\n这就是刚度矩阵第 $(1,1)$ 项的符号表达式。",
            "answer": "$$\\boxed{\\frac{Et(3-\\nu)}{6(1-\\nu^2)}}$$"
        },
        {
            "introduction": "除了刚度，有限元模型还必须精确地计算施加的载荷。本练习的重点是将连续分布的体力（如重力）转化为一组等效的节点力，即所谓的“一致载荷向量”。遵循虚功原理可以确保节点力在能量上与原始分布载荷等效，这是组装全局方程组的关键一步。",
            "id": "3588779",
            "problem": "考虑一个用于有限元法 (FEM) 二维平面应力分析的四节点双线性四边形有限元 (Q4)。该单元具有均匀厚度 $t$，并承受分量为 $b_x$ 和 $b_y$（单位体积的力）的均匀体力场作用。该单元在物理 $(x,y)$ 平面中的节点坐标为\n$$\n(x_1,y_1)=(0,0),\\quad (x_2,y_2)=(3,1),\\quad (x_3,y_3)=(5,4),\\quad (x_4,y_4)=(2,3),\n$$\n其局部节点编号 $(1,2,3,4)$ 对应于在母单元正方形 $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ 上定义的标准双线性形函数。\n\n从虚功原理和等参有限元列式出发，推导该单元的一致节点体力荷载向量。使用能确保本案例精确积分的适当二维高斯求积法则计算所需积分，并按以下顺序给出最终的八分量节点荷载向量\n$$\n[F_{1x},\\,F_{1y},\\,F_{2x},\\,F_{2y},\\,F_{3x},\\,F_{3y},\\,F_{4x},\\,F_{4y}],\n$$\n以 $b_x$、$b_y$ 和 $t$ 的单个闭合形式表达式表示。最终的节点力以牛顿为单位表示。无需四舍五入。",
            "solution": "在有限元法 (FEM) 中，二维单元的一致节点体力向量可由虚功原理导出。对于分量为 $b_x$ 和 $b_y$ 的单位体积均匀体力以及均匀厚度 $t$，在单元域 $\\Omega_e$ 上的虚外功为\n$$\n\\delta W_{\\text{ext}} \\;=\\; \\int_{\\Omega_e} t\\,\\delta \\boldsymbol{u}^{\\mathsf{T}}\\,\\boldsymbol{b}\\,\\mathrm{d}\\Omega,\n$$\n其中 $\\boldsymbol{b}=\\begin{pmatrix}b_x\\\\ b_y\\end{pmatrix}$，$\\delta \\boldsymbol{u}$ 是虚位移向量场。通过标准等参插值，位移场可近似为\n$$\n\\boldsymbol{u}(\\xi,\\eta) \\;=\\; \\boldsymbol{N}(\\xi,\\eta)\\,\\boldsymbol{d},\\quad \\delta \\boldsymbol{u}(\\xi,\\eta) \\;=\\; \\boldsymbol{N}(\\xi,\\eta)\\,\\delta \\boldsymbol{d},\n$$\n其中 $\\boldsymbol{d}$ 是节点位移自由度向量，$\\boldsymbol{N}(\\xi,\\eta)$ 是由标量形函数 $N_i(\\xi,\\eta)$ 构成的 $2\\times 8$ 形函数矩阵，形式如下\n$$\n\\boldsymbol{N}(\\xi,\\eta) \\;=\\;\n\\begin{pmatrix}\nN_1  0  N_2  0  N_3  0  N_4  0\\\\\n0  N_1  0  N_2  0  N_3  0  N_4\n\\end{pmatrix}.\n$$\n代入 $\\delta W_{\\text{ext}}$ 并利用 $\\delta \\boldsymbol{d}$ 的任意性，可得到一致单元体力向量\n$$\n\\boldsymbol{f}_e \\;=\\; t \\int_{\\Omega_e} \\boldsymbol{N}^{\\mathsf{T}}(\\xi,\\eta)\\,\\boldsymbol{b}\\,\\mathrm{d}\\Omega \\;=\\; t \\int_{-1}^{1}\\int_{-1}^{1} \\boldsymbol{N}^{\\mathsf{T}}(\\xi,\\eta)\\,\\boldsymbol{b}\\,\\det\\boldsymbol{J}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta,\n$$\n其中 $\\det\\boldsymbol{J}(\\xi,\\eta)$ 是从 $(\\xi,\\eta)$ 到 $(x,y)$ 的等参映射的雅可比矩阵的行列式。\n\n母单元域上的标量双线性形函数为\n$$\n\\begin{aligned}\nN_1(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1-\\eta),\\\\\nN_2(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1-\\eta),\\\\\nN_3(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1+\\eta),\\\\\nN_4(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1+\\eta).\n\\end{aligned}\n$$\n根据给定的节点坐标，该单元是一个平行四边形，因为其边向量满足\n$$\n\\boldsymbol{a} = \\begin{pmatrix}x_2-x_1\\\\ y_2-y_1\\end{pmatrix} = \\begin{pmatrix}3\\\\1\\end{pmatrix},\\qquad\n\\boldsymbol{b} = \\begin{pmatrix}x_4-x_1\\\\ y_4-y_1\\end{pmatrix} = \\begin{pmatrix}2\\\\3\\end{pmatrix},\n$$\n且对边具有相同的方向向量：\n$$\n\\begin{pmatrix}x_3-x_2\\\\ y_3-y_2\\end{pmatrix} = \\boldsymbol{b},\\qquad\n\\begin{pmatrix}x_3-x_4\\\\ y_3-y_4\\end{pmatrix} = \\boldsymbol{a}.\n$$\n对于仿射（平行四边形）映射，雅可比行列式 $\\det\\boldsymbol{J}$ 在整个母单元域上是常数，单元的物理面积为\n$$\nA_e \\;=\\; |\\boldsymbol{a}_x \\boldsymbol{b}_y - \\boldsymbol{a}_y \\boldsymbol{b}_x| \\;=\\; |(3)(3) - (1)(2)| \\;=\\; 7,\n$$\n而常数雅可比行列式等于\n$$\n\\det\\boldsymbol{J} \\;=\\; \\frac{A_e}{4} \\;=\\; \\frac{7}{4},\n$$\n因为对于常数 $\\det\\boldsymbol{J}$，面积的换算关系为 $A_e = \\int_{-1}^{1}\\int_{-1}^{1} \\det\\boldsymbol{J}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = 4\\,\\det\\boldsymbol{J}$。\n\n因此，每对节点体力分量为\n$$\n\\begin{pmatrix}F_{ix}\\\\ F_{iy}\\end{pmatrix}\n\\;=\\; t \\int_{-1}^{1}\\int_{-1}^{1}\n\\begin{pmatrix}N_i(\\xi,\\eta)\\,b_x\\\\ N_i(\\xi,\\eta)\\,b_y\\end{pmatrix}\n\\,\\det\\boldsymbol{J}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n\\;=\\; t\\,\\det\\boldsymbol{J}\\,\n\\begin{pmatrix}b_x\\\\ b_y\\end{pmatrix}\n\\int_{-1}^{1}\\int_{-1}^{1} N_i(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta.\n$$\n我们现在在每个方向上使用两点高斯求积来计算 $\\int_{-1}^{1}\\int_{-1}^{1} N_i(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$，这种方法对于在母单元正方形上积分双线性函数是精确的。一维高斯点和权重为\n$$\n\\xi_k = \\pm \\frac{1}{\\sqrt{3}},\\quad \\eta_\\ell = \\pm \\frac{1}{\\sqrt{3}},\\qquad w_\\xi = 1,\\quad w_\\eta = 1,\n$$\n因此，二维求积近似于（在本例中是精确等于）\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} N_i(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n\\;=\\; \\sum_{k=1}^{2}\\sum_{\\ell=1}^{2} w_\\xi w_\\eta\\,N_i(\\xi_k,\\eta_\\ell)\n\\;=\\; \\sum_{(\\xi,\\eta)\\in\\{\\pm 1/\\sqrt{3}\\}^2} N_i(\\xi,\\eta).\n$$\n直接计算表明，对于每个 $i=1,2,3,4$，该和都等于 $1$。或者，通过解析积分，\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} N_i(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n\\;=\\; \\frac{1}{4}\\left(\\int_{-1}^{1}(1\\pm \\xi)\\,\\mathrm{d}\\xi\\right)\n\\left(\\int_{-1}^{1}(1\\pm \\eta)\\,\\mathrm{d}\\eta\\right)\n\\;=\\; \\frac{1}{4}\\cdot 2\\cdot 2 \\;=\\; 1,\n$$\n这证实了求积的结果。因此，对于每个节点 $i$，\n$$\n\\begin{pmatrix}F_{ix}\\\\ F_{iy}\\end{pmatrix}\n\\;=\\; t\\,\\det\\boldsymbol{J}\\,\\begin{pmatrix}b_x\\\\ b_y\\end{pmatrix}\n\\;=\\; t\\,\\frac{A_e}{4}\\,\\begin{pmatrix}b_x\\\\ b_y\\end{pmatrix}\n\\;=\\; t\\,\\frac{7}{4}\\,\\begin{pmatrix}b_x\\\\ b_y\\end{pmatrix}.\n$$\n将各分量按规定顺序组合，得到一致单元体力向量\n$$\n\\boldsymbol{f}_e \\;=\\; \\left[\nt\\,\\frac{7}{4}\\,b_x,\\;\\;t\\,\\frac{7}{4}\\,b_y,\\;\\;\nt\\,\\frac{7}{4}\\,b_x,\\;\\;t\\,\\frac{7}{4}\\,b_y,\\;\\;\nt\\,\\frac{7}{4}\\,b_x,\\;\\;t\\,\\frac{7}{4}\\,b_y,\\;\\;\nt\\,\\frac{7}{4}\\,b_x,\\;\\;t\\,\\frac{7}{4}\\,b_y\n\\right],\n$$\n当 $b_x$ 和 $b_y$ 的单位是牛顿/立方米，$t$ 的单位是米时，该向量的单位是牛顿。",
            "answer": "$$\\boxed{\\begin{pmatrix}\n\\frac{7}{4}tb_x  \\frac{7}{4}tb_y  \\frac{7}{4}tb_x  \\frac{7}{4}tb_y  \\frac{7}{4}tb_x  \\frac{7}{4}tb_y  \\frac{7}{4}tb_x  \\frac{7}{4}tb_y\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "有限元分析产生的应力场通常在单元边界处不连续且精度较低。这个高级编程练习要求您实现 Zienkiewicz-Zhu (ZZ) 单元-节点恢复法，这是一种功能强大的后处理技术，用于获得更精确、更连续的应力场。本练习将理论与实践相结合，展示了如何通过先进的数值方法提高仿真结果的质量。",
            "id": "3588781",
            "problem": "您的任务是为平面应变有限元网格实现 Zienkiewicz–Zhu (ZZ) 斑片恢复法，并推导将线性应力场与高斯点数据进行拟合的局部最小二乘代数系统。请从计算固体力学的基本原理出发。使用小应变运动学、线性弹性本构律以及等参双线性四节点四边形有限元。对于每个网格节点，ZZ 恢复法在最小二乘意义下，构建一个多项式应力场，以最佳拟合该节点的单元斑片上的高斯点应力采样值。\n\n基本出发点：\n- 运动学：无穷小应变-位移关系 $\\boldsymbol{\\varepsilon} = \\nabla^{s} \\mathbf{u}$，其中 $\\nabla^{s}$ 表示对称梯度。在二维笛卡尔坐标 $x$ 和 $y$ 中，Voigt 标记法下的应变向量为 $\\boldsymbol{\\varepsilon} = [ \\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy} ]^{\\mathsf{T}}$，其中 $\\gamma_{xy} = \\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_y}{\\partial x}$。\n- 平面应变下的线性弹性本构律：$\\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon}$，其中 $\\boldsymbol{\\sigma} = [ \\sigma_{xx}, \\sigma_{yy}, \\tau_{xy} ]^{\\mathsf{T}}$ 且\n$$\n\\mathbf{D} =\n\\begin{bmatrix}\n\\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)}  \\frac{E\\nu}{(1+\\nu)(1-2\\nu)}  0 \\\\\n\\frac{E\\nu}{(1+\\nu)(1-2\\nu)}  \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)}  0 \\\\\n0  0  \\frac{E}{2(1+\\nu)}\n\\end{bmatrix},\n$$\n其中杨氏模量为 $E$，泊松比为 $\\nu$。\n- 等参双线性四边形单元：在父域 $[-1,1]\\times[-1,1]$ 上，节点 $i=1,\\dots,4$ 的形函数为 $N_i(\\xi,\\eta)$；雅可比矩阵 $\\mathbf{J}$ 将导数从父坐标 $(\\xi,\\eta)$ 映射到物理坐标 $(x,y)$；应变-位移矩阵 $\\mathbf{B}$ 通过 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}_e$ 将节点位移与应变联系起来，其中 $\\mathbf{u}_e$ 是单元节点位移向量。\n\n待推导的局部最小二乘拟合模型：\n- 对每个应力分量，假设在物理坐标系下存在一个线性多项式模型：\n$$\ns(x,y) = a_0 + a_1 x + a_2 y,\n$$\n其中 $s$ 代表 $\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}$ 中的一个，而 $\\mathbf{a} = [a_0, a_1, a_2]^{\\mathsf{T}}$ 是斑片的未知系数。给定高斯点数据 $\\{(x_i, y_i, s_i, w_i)\\}_{i=1}^{n}$，构建加权最小二乘问题 $\\min_{\\mathbf{a}} \\sum_{i=1}^{n} w_i ( a_0 + a_1 x_i + a_2 y_i - s_i )^2$ 并推导正规方程组。\n\n编程任务：\n1. 在方形域 $[0,2] \\times [0,2]$ 上构建一个 $2 \\times 2$ 的单元网格，九个节点位于整数坐标 $(x,y) \\in \\{0,1,2\\} \\times \\{0,1,2\\}$。四个双线性四边形单元连接这些节点：\n   - 单元 $e_0$：节点 $(0,0)\\text{-}(1,0)\\text{-}(1,1)\\text{-}(0,1)$，\n   - 单元 $e_1$：节点 $(1,0)\\text{-}(2,0)\\text{-}(2,1)\\text{-}(1,1)$，\n   - 单元 $e_2$：节点 $(0,1)\\text{-}(1,1)\\text{-}(1,2)\\text{-}(0,2)$，\n   - 单元 $e_3$：节点 $(1,1)\\text{-}(2,1)\\text{-}(2,2)\\text{-}(1,2)$。\n2. 使用材料参数 $E = 210 \\times 10^9$ (帕斯卡) 和 $\\nu = 0.3$ (无量纲)。\n3. 根据双线性场采样来指定节点位移\n   $$\n   u_x(x,y) = a x + b y + c x y, \\quad u_y(x,y) = d x + e y + f x y,\n   $$\n   使用网格节点的物理坐标，系数为 $a = 1.0 \\times 10^{-3}, b = 2.0 \\times 10^{-3}, c = 3.0 \\times 10^{-3}, d = -1.0 \\times 10^{-3}, e = 1.5 \\times 10^{-3}, f = -2.0 \\times 10^{-3}$ (单位：米)。\n4. 对每个单元，在标准的 $2 \\times 2$ 高斯点 $(\\xi,\\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$ (单位权重) 处，计算 $\\boldsymbol{\\sigma}(\\xi,\\eta) = \\mathbf{D} \\mathbf{B}(\\xi,\\eta) \\mathbf{u}_e$，并通过 $(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta) (x_i,y_i)$ 记录每个高斯点的物理坐标 $(x,y)$。\n5. 实现 Zienkiewicz–Zhu (ZZ) 斑片恢复法：对于给定的节点 $n$，收集所有共享节点 $n$ 的单元的高斯点数据 $(x_i, y_i, s_i, w_i)$。对于每个应力分量 $s \\in \\{ \\sigma_{xx}, \\sigma_{yy}, \\tau_{xy} \\}$，使用加权最小二乘法将线性模型 $s(x,y) = a_0 + a_1 x + a_2 y$ 拟合到高斯数据，其中权重 $w_i = \\det(\\mathbf{J}(\\xi_i,\\eta_i))$ 是每个高斯点上从父坐标到物理坐标映射的雅可比行列式。求解正规方程组，并在节点坐标 $(x_n,y_n)$ 处评估恢复应力，即 $s^{\\text{rec}}(x_n,y_n) = a_0 + a_1 x_n + a_2 y_n$。\n6. 为测试数值鲁棒性，仅向单元 $e_0$ 的高斯点应力注入一个小的确定性噪声：将 $\\delta$ 添加到 $e_0$ 中的每个高斯点应力分量上，其中 $\\delta = \\alpha s$ 且该点该分量的 $\\alpha = 5.0 \\times 10^{-3}$。所有其他单元保持无噪声。使用与第 5 项中相同的权重 $w_i$。\n\n测试套件：\n- 情况 1 (内部斑片)：节点 $(1,1)$ 属于四个单元；恢复并报告在 $(1,1)$ 处计算的三个应力分量 $\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}$。\n- 情况 2 (边缘斑片)：节点 $(0,1)$ 属于两个单元；恢复并报告在 $(0,1)$ 处计算的 $\\sigma_{xx}$。\n- 情况 3 (带噪声数据的角点斑片)：节点 $(0,0)$ 属于一个单元 ($e_0$)；恢复并报告在 $(0,0)$ 处计算的 $\\tau_{xy}$。\n\n答案规格：\n- 所有报告的应力必须以帕斯卡 $(\\text{Pa})$ 为单位。\n- 最终程序输出必须是单行，包含一个用方括号括起来的逗号分隔列表，顺序如下\n$$\n[\\sigma_{xx}(1,1), \\sigma_{yy}(1,1), \\tau_{xy}(1,1), \\sigma_{xx}(0,1), \\tau_{xy}(0,0)].\n$$\n不应打印任何其他文本。\n\n您的程序必须是自包含的，不得读取任何输入，并且必须实现完整的工作流程：高斯点上的单元应力计算、斑片组装、每个节点的加权最小二乘恢复以及在指定节点处的求值。请严格按照指定的执行环境和库来使用。",
            "solution": "该问题是有效的。它提出了一个在计算固体力学领域中定义明确、有科学依据的任务，该任务是完整且可验证的。所有必需的参数、方程和步骤都已明确定义。\n\n任务是为有限元网格实现 Zienkiewicz–Zhu (ZZ) 斑片恢复法。该方法是一种后处理技术，用于从有限元法（FEM）通常计算出的不连续、精度较低的应力场中获得更精确、更连续的应力场。其核心思想是将一个单一、连续的多项式函数拟合到特定节点周围单元“斑片”内高斯求积点上的高精度应力值。\n\n### 1. 双线性四边形单元的有限元公式\n\n我们从平面应变条件下等参四节点四边形单元的标准公式开始。\n\n#### 1.1. 等参映射与形函数\n单元内的几何形状和位移场使用同一组形函数 $N_i$ 从节点值插值得到。对于定义在父域 $(\\xi, \\eta) \\in [-1,1]\\times[-1,1]$ 上的双线性单元，其形函数为：\n$$\nN_i(\\xi, \\eta) = \\frac{1}{4}(1+\\xi_i\\xi)(1+\\eta_i\\eta), \\quad i=1, \\dots, 4\n$$\n其中 $(\\xi_i, \\eta_i)$ 是单元的局部节点坐标（例如 $(-1,-1), (1,-1), (1,1), (-1,1)$）。\n\n单元内任意点的物理坐标 $(x,y)$ 通过这些形函数和单元的节点坐标 $(x_i, y_i)$ 从父坐标 $(\\xi,\\eta)$ 映射得到：\n$$\nx(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) x_i, \\quad y(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) y_i\n$$\n\n#### 1.2. 雅可比矩阵与应变-位移矩阵\n为计算应变，我们需要位移对物理坐标 $(x,y)$ 的导数。通过微分链式法则，这些导数可通过雅可比矩阵 $\\mathbf{J}$ 与父域中的导数联系起来：\n$$\n\\mathbf{J} = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} \\sum_i \\frac{\\partial N_i}{\\partial \\xi} x_i  \\sum_i \\frac{\\partial N_i}{\\partial \\xi} y_i \\\\ \\sum_i \\frac{\\partial N_i}{\\partial \\eta} x_i  \\sum_i \\frac{\\partial N_i}{\\partial \\eta} y_i \\end{bmatrix}\n$$\n对于函数 $f$ 的导数，其关系为：\n$$\n\\begin{Bmatrix} \\frac{\\partial f}{\\partial x} \\\\ \\frac{\\partial f}{\\partial y} \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\frac{\\partial f}{\\partial \\xi} \\\\ \\frac{\\partial f}{\\partial \\eta} \\end{Bmatrix}\n$$\n位移场 $\\mathbf{u}(x,y) = [u_x(x,y), u_y(x,y)]^{\\mathsf{T}}$ 也是插值得到的：$\\mathbf{u}(\\xi,\\eta) = \\sum_{i=1}^4 N_i(\\xi,\\eta)\\mathbf{u}_i$，其中 $\\mathbf{u}_i = [u_{ix}, u_{iy}]^{\\mathsf{T}}$ 是节点位移。应变-位移关系 $\\boldsymbol{\\varepsilon} = \\nabla^s \\mathbf{u}$ 以矩阵形式表示为 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}_e$，其中 $\\mathbf{u}_e$ 是所有单元节点位移的向量。矩阵 $\\mathbf{B}$ 由形函数对物理坐标的导数构成：\n$$\n\\mathbf{B}_i = \\begin{bmatrix}\n\\frac{\\partial N_i}{\\partial x}  0 \\\\\n0  \\frac{\\partial N_i}{\\partial y} \\\\\n\\frac{\\partial N_i}{\\partial y}  \\frac{\\partial N_i}{\\partial x}\n\\end{bmatrix}, \\quad \\text{且} \\quad \\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4]\n$$\n导数 $\\frac{\\partial N_i}{\\partial x}$ 和 $\\frac{\\partial N_i}{\\partial y}$ 使用 $\\mathbf{J}^{-1}$ 以及导数 $\\frac{\\partial N_i}{\\partial \\xi}$ 和 $\\frac{\\partial N_i}{\\partial \\eta}$ 计算得出。\n\n#### 1.3. 应力计算\n在高斯点计算出应变向量 $\\boldsymbol{\\varepsilon}$ 后，相应的应力向量 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^{\\mathsf{T}}$ 可通过平面应变的线性弹性本构律 $\\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon}$ 求得。矩阵 $\\mathbf{D}$ 如下所示：\n$$\n\\mathbf{D} =\n\\frac{E}{(1+\\nu)(1-2\\nu)}\n\\begin{bmatrix}\n1-\\nu  \\nu  0 \\\\\n\\nu  1-\\nu  0 \\\\\n0  0  \\frac{1-2\\nu}{2}\n\\end{bmatrix}\n$$\n其中 $E$ 是杨氏模量，$\\nu$ 是泊松比。这些在高斯点计算出的应力是恢复过程的输入。\n\n### 2. 用于斑片恢复的加权最小二乘法\n\n对于一个给定节点，我们汇集所有与其相连的单元组成一个斑片。然后，我们收集该斑片内所有高斯点 $i=1, \\dots, n$ 处某个应力分量（例如 $\\sigma_{xx}$）的应力值 $s_i$。每个高斯点都关联其物理坐标 $(x_i, y_i)$ 和一个权重 $w_i$。\n\n#### 2.1. 局部应力模型与最小化\n我们假设一个局部的、恢复后的应力场 $s^{\\text{rec}}(x,y)$ 是物理坐标系下的一个线性多项式：\n$$\ns^{\\text{rec}}(x,y) = a_0 + a_1 x + a_2 y = \\mathbf{P}(x,y) \\mathbf{a}\n$$\n其中 $\\mathbf{P}(x,y) = [1, x, y]$ 且 $\\mathbf{a} = [a_0, a_1, a_2]^{\\mathsf{T}}$ 是未知系数向量。ZZ 方法通过最小化恢复场与高斯点应力之间的加权残差平方和来找到最佳拟合系数 $\\mathbf{a}$：\n$$\n\\min_{\\mathbf{a}} F(\\mathbf{a}) = \\min_{\\mathbf{a}} \\sum_{i=1}^{n} w_i \\left( s^{\\text{rec}}(x_i, y_i) - s_i \\right)^2 = \\min_{\\mathbf{a}} \\sum_{i=1}^{n} w_i \\left( a_0 + a_1 x_i + a_2 y_i - s_i \\right)^2\n$$\n问题指定权重 $w_i$ 为对应高斯点的雅可比矩阵行列式 $w_i = \\det(\\mathbf{J}_i)$。\n\n#### 2.2. 正规方程组的推导\n为求最小值，我们计算 $F(\\mathbf{a})$ 对每个系数 $a_j$ 的偏导数，并令其为零：\n$$\n\\frac{\\partial F}{\\partial a_0} = \\sum_{i=1}^{n} 2 w_i (a_0 + a_1 x_i + a_2 y_i - s_i) = 0\n$$\n$$\n\\frac{\\partial F}{\\partial a_1} = \\sum_{i=1}^{n} 2 w_i (a_0 + a_1 x_i + a_2 y_i - s_i) x_i = 0\n$$\n$$\n\\frac{\\partial F}{\\partial a_2} = \\sum_{i=1}^{n} 2 w_i (a_0 + a_1 x_i + a_2 y_i - s_i) y_i = 0\n$$\n整理这些方程可以得到一个 $3 \\times 3$ 的对称线性正规方程组 $\\mathbf{M} \\mathbf{a} = \\mathbf{f}$：\n$$\n\\left[ \\sum_{i=1}^{n} w_i\n\\begin{bmatrix}\n1  x_i  y_i \\\\\nx_i  x_i^2  x_i y_i \\\\\ny_i  x_i y_i  y_i^2\n\\end{bmatrix} \\right]\n\\begin{Bmatrix} a_0 \\\\ a_1 \\\\ a_2 \\end{Bmatrix} =\n\\left[ \\sum_{i=1}^{n} w_i s_i\n\\begin{Bmatrix} 1 \\\\ x_i \\\\ y_i \\end{Bmatrix} \\right]\n$$\n该系统可以简写为 $(\\sum_{i=1}^n w_i \\mathbf{P}_i^{\\mathsf{T}} \\mathbf{P}_i) \\mathbf{a} = (\\sum_{i=1}^n w_i \\mathbf{P}_i^{\\mathsf{T}} s_i)$。求解该方程组即可得到系数 $\\mathbf{a}$。随后，在任意点 $(x_n, y_n)$（例如目标节点）的恢复应力即为 $s^{\\text{rec}}(x_n, y_n) = a_0 + a_1 x_n + a_2 y_n$。\n\n### 3. 实现策略\n\n求解过程如下：\n1.  **初始化**：定义材料常数、网格几何（节点和单元连接关系）以及指定的位移场系数。\n2.  **位移计算**：在 9 个网格节点上计算解析位移函数，以获得节点位移向量。\n3.  **高斯点数据生成**：对四个单元中的每一个：\n    *   遍历四个 $2 \\times 2$ 高斯点 $(\\xi, \\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$。\n    *   计算形函数 $N_i$ 及其导数 $\\partial N_i/\\partial\\xi, \\partial N_i/\\partial\\eta$。\n    *   计算雅可比矩阵 $\\mathbf{J}$、其行列式 $\\det(\\mathbf{J})$ 及其逆矩阵 $\\mathbf{J}^{-1}$。\n    *   使用 $\\mathbf{J}^{-1}$ 构建应变-位移矩阵 $\\mathbf{B}$。\n    *   计算应变向量 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}_e$。\n    *   计算应力向量 $\\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon}$。\n    *   对于单元 $e_0$，应用乘性噪声：$\\sigma_{ij}^{\\text{noisy}} = \\sigma_{ij}(1 + \\alpha)$。\n    *   存储每个高斯点的物理坐标 $(x,y)$、（可能带噪声的）应力分量和权重 $w = \\det(\\mathbf{J})$。\n4.  **测试用例的斑片恢复**：对每个指定节点：\n    *   识别构成节点周围斑片的单元。\n    *   聚合来自斑片中所有单元的已存储的高斯点数据。\n    *   对每个所需的应力分量，组装并求解关于系数 $\\mathbf{a}$ 的 $3 \\times 3$ 正规方程组。\n    *   在节点的坐标处计算恢复应力 $s^{\\text{rec}}$。\n5.  **输出**：收集所有测试用例计算出的应力值，并以指定的逗号分隔格式打印。\n\n由于指定的位移场是双线性的，且网格由矩形单元组成，因此等参映射是线性的。这意味着通过有限元程序计算出的应变在每个单元内将是 $(x,y)$ 的线性函数。由于精确应力场也是线性的，并且 ZZ 恢复法拟合的是线性多项式，所以在无噪声的情况下，恢复应力预计将非常精确，与解析解的匹配精度可达浮点数精度。带噪声的情况则可以观察该方法在数据受扰动时的行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the Zienkiewicz-Zhu (ZZ) patch recovery method for a 2x2\n    plane strain finite element mesh.\n    \"\"\"\n    # Define problem parameters\n    E = 210e9  # Young's modulus in Pascals\n    nu = 0.3   # Poisson's ratio\n    \n    # Coefficients for the prescribed displacement field\n    a, b, c = 1.0e-3, 2.0e-3, 3.0e-3\n    d, e, f = -1.0e-3, 1.5e-3, -2.0e-3\n    \n    # Noise factor for element e0\n    alpha_noise = 5.0e-3\n\n    # Define mesh geometry\n    nodes = np.array([\n        [0.0, 0.0], [1.0, 0.0], [2.0, 0.0],\n        [0.0, 1.0], [1.0, 1.0], [2.0, 1.0],\n        [0.0, 2.0], [1.0, 2.0], [2.0, 2.0]\n    ])\n    \n    elements = {\n        0: [0, 1, 4, 3],  # Element e0\n        1: [1, 2, 5, 4],  # Element e1\n        2: [3, 4, 7, 6],  # Element e2\n        3: [4, 5, 8, 7]   # Element e3\n    }\n    \n    # Define a function for the analytical displacement field\n    def get_displacements(x, y):\n        ux = a * x + b * y + c * x * y\n        uy = d * x + e * y + f * x * y\n        return np.array([ux, uy])\n\n    # Calculate displacements at each node\n    nodal_displacements = np.array([get_displacements(x, y) for x, y in nodes])\n\n    # Constitutive matrix D for plane strain\n    d_factor = E / ((1 + nu) * (1 - 2 * nu))\n    D = d_factor * np.array([\n        [1 - nu, nu, 0],\n        [nu, 1 - nu, 0],\n        [0, 0, (1 - 2 * nu) / 2]\n    ])\n\n    # Define 2x2 Gauss quadrature points in parent coordinates\n    gp_val = 1.0 / np.sqrt(3.0)\n    gauss_points = [\n        (-gp_val, -gp_val), (gp_val, -gp_val),\n        (gp_val, gp_val), (-gp_val, gp_val)\n    ]\n    \n    # Helper functions for Q4 element shape functions and their derivatives\n    def shape_functions(xi, eta):\n        N = 0.25 * np.array([\n            (1 - xi) * (1 - eta),\n            (1 + xi) * (1 - eta),\n            (1 + xi) * (1 + eta),\n            (1 - xi) * (1 + eta)\n        ])\n        return N\n\n    def shape_derivatives(xi, eta):\n        # Derivatives with respect to parent coordinates (xi, eta)\n        dNd_xi_eta = 0.25 * np.array([\n            [-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)],  # dN/d_xi\n            [-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)]    # dN/d_eta\n        ])\n        return dNd_xi_eta\n\n    # Store computed Gauss point data (stresses, coordinates, weights) for all elements\n    gauss_data = {}\n\n    for elem_id, node_indices in elements.items():\n        gauss_data[elem_id] = []\n        elem_coords = nodes[node_indices]\n        elem_disps_vec = nodal_displacements[node_indices].flatten()\n\n        for xi, eta in gauss_points:\n            dNd_xi_eta = shape_derivatives(xi, eta)\n            \n            # Jacobian matrix\n            J = dNd_xi_eta @ elem_coords\n            detJ = np.linalg.det(J)\n            invJ = np.linalg.inv(J)\n\n            # Derivatives of shape functions w.r.t. physical coordinates (x, y)\n            dNd_xy = invJ @ dNd_xi_eta\n            \n            # Strain-displacement matrix B\n            B = np.zeros((3, 8))\n            for i in range(4):\n                B[0, 2 * i] = dNd_xy[0, i]\n                B[1, 2 * i + 1] = dNd_xy[1, i]\n                B[2, 2 * i] = dNd_xy[1, i]\n                B[2, 2 * i + 1] = dNd_xy[0, i]\n            \n            # Compute strains and then stresses at the Gauss point\n            strains = B @ elem_disps_vec\n            stresses = D @ strains\n\n            # Apply deterministic noise for element e0 as specified\n            if elem_id == 0:\n                stresses_with_noise = stresses * (1.0 + alpha_noise)\n            else:\n                stresses_with_noise = stresses\n\n            # Map Gauss point to physical coordinates\n            N_vals = shape_functions(xi, eta)\n            physical_coords = N_vals @ elem_coords\n\n            gauss_data[elem_id].append({\n                'coords': physical_coords,\n                'stresses': stresses_with_noise,\n                'weight': detJ # Weight for least-squares is det(J)\n            })\n\n    def perform_zz_recovery(patch_data, target_node_coord, stress_index):\n        \"\"\"Performs weighted least-squares fit for one stress component.\"\"\"\n        # stress_index: 0 for sigma_xx, 1 for sigma_yy, 2 for tau_xy\n\n        # Assemble the normal equations for the least-squares system M*a = f\n        M = np.zeros((3, 3))\n        f = np.zeros(3)\n\n        for gp in patch_data:\n            x, y = gp['coords']\n            s_val = gp['stresses'][stress_index]\n            w = gp['weight']\n            p = np.array([1, x, y])\n            \n            M += w * np.outer(p, p)\n            f += w * s_val * p\n\n        # Solve for coefficients a = [a0, a1, a2]\n        a_coeffs = np.linalg.solve(M, f)\n        \n        # Evaluate recovered stress at the target node coordinates\n        p_node = np.array([1, target_node_coord[0], target_node_coord[1]])\n        recovered_stress = p_node @ a_coeffs\n        \n        return recovered_stress\n\n    final_results = []\n    \n    # Case 1: Interior patch at node (1,1)\n    node_coord_1 = (1.0, 1.0)\n    patch_elements_1 = [0, 1, 2, 3] # All four elements\n    patch_data_1 = []\n    for elem_id in patch_elements_1:\n        patch_data_1.extend(gauss_data[elem_id])\n    \n    s_xx_1 = perform_zz_recovery(patch_data_1, node_coord_1, 0)\n    s_yy_1 = perform_zz_recovery(patch_data_1, node_coord_1, 1)\n    t_xy_1 = perform_zz_recovery(patch_data_1, node_coord_1, 2)\n    final_results.extend([s_xx_1, s_yy_1, t_xy_1])\n\n    # Case 2: Edge patch at node (0,1)\n    node_coord_2 = (0.0, 1.0)\n    patch_elements_2 = [0, 2] # Elements e0 and e2\n    patch_data_2 = []\n    for elem_id in patch_elements_2:\n        patch_data_2.extend(gauss_data[elem_id])\n        \n    s_xx_2 = perform_zz_recovery(patch_data_2, node_coord_2, 0)\n    final_results.append(s_xx_2)\n    \n    # Case 3: Corner patch (with noise) at node (0,0)\n    node_coord_3 = (0.0, 0.0)\n    patch_elements_3 = [0] # Only element e0\n    patch_data_3 = []\n    for elem_id in patch_elements_3:\n        patch_data_3.extend(gauss_data[elem_id])\n\n    t_xy_3 = perform_zz_recovery(patch_data_3, node_coord_3, 2)\n    final_results.append(t_xy_3)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}