{
    "hands_on_practices": [
        {
            "introduction": "要为一般的非线性系统构建能够精确保持能量的数值积分器，我们必须用一个特殊的离散对应物来取代连续的势能梯度。本练习旨在为此奠定理论基础，引入“离散梯度”这一核心概念 。您将亲自定义这个关键工具，并用它构建一个基本的保能量算法，然后严格证明该算法确实具有保持能量和二阶精度的优良性质。",
            "id": "3562093",
            "problem": "考虑一个有限维保守力学系统，其广义坐标为 $q \\in \\mathbb{R}^{n}$，质量矩阵 $M \\in \\mathbb{R}^{n \\times n}$ 为对称正定矩阵，势能 $V:\\mathbb{R}^{n} \\to \\mathbb{R}$ 为光滑函数。该系统的运动由二阶常微分方程 $M \\ddot{q} + \\nabla V(q) = 0$ 描述。系统的连续总能量为 $H(q,\\dot{q}) = \\frac{1}{2} \\dot{q}^{\\top} M \\dot{q} + V(q)$，该能量在精确轨迹上是守恒的。\n\n你的任务是：\n1. 从牛顿第二定律和总能量的定义出发，引入一个离散梯度 $\\bar{\\nabla} V(q_{k},q_{k+1})$，使其满足离散链式法则 $V(q_{k+1}) - V(q_{k}) = \\bar{\\nabla} V(q_{k},q_{k+1})^{\\top} (q_{k+1} - q_{k})$，并且在 $\\bar{\\nabla} V(q,q) = \\nabla V(q)$ 的意义上是一致的。以闭合形式定义一个这样的 $\\bar{\\nabla} V$。\n2. 使用该离散梯度，为 $(q_{k},v_{k})$（其中 $v_{k} \\approx \\dot{q}(t_{k})$）构造一个单步、二阶精确、时间可逆的更新格式，该格式能精确保守离散总能量 $H(q_{k},v_{k}) = \\frac{1}{2} v_{k}^{\\top} M v_{k} + V(q_{k})$。\n3. 从第一性原理出发，证明所构造的方法能够保守离散总能量并且具有二阶时间精度。你的推导必须明确使用离散链式法则和基于泰勒级数的局部截断误差展开。\n4. 对于一个一维系统（$n=1$），其中质量 $M = 1$，势能为 $V(q) = \\frac{1}{3} q^{4} + \\frac{1}{3} q^{2}$，计算在 $q_{k} = 1$ 和 $q_{k+1} = 2$ 处你的离散梯度 $\\bar{\\nabla} V(q_{k},q_{k+1})$ 的值。以无舍入、无单位的精确形式给出最终数值答案。",
            "solution": "该问题在科学上基于经典力学和数值分析，信息充分，问题适定，且陈述客观，因此是有效的。我们按顺序完成这四项任务来给出解答。\n\n所考虑的系统是一个有限维保守力学系统，其广义坐标为 $q \\in \\mathbb{R}^{n}$，质量矩阵 $M \\in \\mathbb{R}^{n \\times n}$ 为对称正定矩阵，势能函数 $V(q)$ 为光滑函数。其动力学由第二类拉格朗日方程描述，该方程具有牛顿第二定律的形式：\n$$ M \\ddot{q} + \\nabla V(q) = 0 $$\n系统的总能量 $H(q, \\dot{q}) = \\frac{1}{2} \\dot{q}^{\\top} M \\dot{q} + V(q)$ 是精确解的一个守恒量。\n\n**1. 离散梯度的定义**\n\n离散梯度，记作 $\\bar{\\nabla} V(q_{k}, q_{k+1})$，是一个向量值函数，它近似于连续梯度 $\\nabla V$，并被设计用来满足链式法则的离散模拟。其所需性质如下：\n1.  **离散链式法则：** $V(q_{k+1}) - V(q_{k}) = \\bar{\\nabla} V(q_{k}, q_{k+1})^{\\top} (q_{k+1} - q_{k})$\n2.  **一致性：** $\\bar{\\nabla} V(q, q) = \\nabla V(q)$\n\n一种定义此类梯度的通用且强大的方法是通过中值定理，这导出了**中值离散梯度**：\n$$ \\bar{\\nabla} V(q_{a}, q_{b}) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right) d\\xi $$\n让我们验证这个定义是否满足所需性质。\n对于离散链式法则，考虑参数化线段 $q(\\xi) = (1 - \\xi)q_{a} + \\xi q_{b}$，其中 $\\xi \\in [0, 1]$。$q(\\xi)$ 关于 $\\xi$ 的导数是 $q'(\\xi) = q_{b} - q_{a}$。根据微积分基本定理和多变量函数的链式法则：\n$$ V(q_{b}) - V(q_{a}) = V(q(1)) - V(q(0)) = \\int_{0}^{1} \\frac{d}{d\\xi} V(q(\\xi)) d\\xi $$\n$$ \\frac{d}{d\\xi} V(q(\\xi)) = \\nabla V(q(\\xi))^{\\top} q'(\\xi) = \\nabla V(q(\\xi))^{\\top} (q_{b} - q_{a}) $$\n将此代入积分可得：\n$$ V(q_{b}) - V(q_{a}) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right)^{\\top} (q_{b} - q_{a}) d\\xi $$\n由于 $(q_{b} - q_{a})$ 相对于 $\\xi$ 是常数，我们可以将其移到积分符号外：\n$$ V(q_{b}) - V(q_{a}) = \\left( \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right) d\\xi \\right)^{\\top} (q_{b} - q_{a}) $$\n这与我们定义的 $\\bar{\\nabla} V(q_{a}, q_{b})$ 所满足的离散链式法则相符。\n\n为验证一致性，我们令 $q_a = q_b = q$：\n$$ \\bar{\\nabla} V(q, q) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q + \\xi q\\right) d\\xi = \\int_{0}^{1} \\nabla V(q) d\\xi = \\nabla V(q) \\int_{0}^{1} d\\xi = \\nabla V(q) $$\n该定义是一致的。这就是我们将使用的闭合形式定义。对于多项式势能，该积分可以被解析地计算。\n\n**2. 保能量积分器的构造**\n\n我们寻求一个单步、二阶精确、时间可逆的更新格式。被称为 Störmer-Verlet 或 Newmark 族的积分器为此提供了基础。我们使用一种特定的隐式形式，常被称为平均速度法或 Gonzalez 积分器，已知当与离散梯度配合使用时，该方法是保能量的。设时间步长为 $\\Delta t = t_{k+1} - t_k$。给定状态 $(q_k, v_k)$，该积分器由以下关于状态 $(q_{k+1}, v_{k+1})$ 的方程组定义：\n\n1.  **位置更新：** 这是对位置的中点法则：\n    $$ \\frac{q_{k+1} - q_k}{\\Delta t} = \\frac{v_{k+1} + v_k}{2} $$\n2.  **动量更新：** 此式使用离散梯度对力项进行处理，从而离散化牛顿第二定律：\n    $$ M \\frac{v_{k+1} - v_k}{\\Delta t} = - \\bar{\\nabla} V(q_k, q_{k+1}) $$\n\n这个系统是隐式的，因为 $\\bar{\\nabla} V$ 依赖于未知的 $q_{k+1}$，并且第一个方程耦合了 $q_{k+1}$ 和 $v_{k+1}$。在每个时间步，必须求解该系统（通常使用像牛顿法这样的非线性求解器）来找到 $(q_{k+1}, v_{k+1})$。该方法从构造上就是时间可逆的，这可以通过交换下标 $k \\leftrightarrow k+1$，替换 $\\Delta t \\to -\\Delta t$ 和 $v \\to -v$ 来证明，这些操作可以恢复原始方程。\n\n**3. 能量守恒和二阶精度的证明**\n\n**能量守恒：**\n我们必须证明离散总能量 $H(q_k, v_k) = \\frac{1}{2} v_k^{\\top} M v_k + V(q_k)$ 是精确保守的，即 $H(q_{k+1}, v_{k+1}) = H(q_k, v_k)$。能量的变化为：\n$$ H_{k+1} - H_k = \\left(\\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} + V(q_{k+1})\\right) - \\left(\\frac{1}{2} v_k^{\\top} M v_k + V(q_k)\\right) $$\n$$ = \\left(\\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} - \\frac{1}{2} v_k^{\\top} M v_k\\right) + \\left(V(q_{k+1}) - V(q_k)\\right) $$\n让我们首先分析动能项。使用恒等式 $a^{\\top}Ma - b^{\\top}Mb = (a-b)^{\\top}M(a+b)/2 + (a+b)^{\\top}M(a-b)/2$，并且由于 $M$ 是对称的：\n$$ \\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} - \\frac{1}{2} v_k^{\\top} M v_k = \\frac{1}{2} (v_{k+1} - v_k)^{\\top} M (v_{k+1} + v_k) $$\n从积分器方程中，我们代入 $(v_{k+1} - v_k)$ 和 $(v_{k+1} + v_k)$ 的表达式：\n-   从动量更新： $v_{k+1} - v_k = -\\Delta t M^{-1} \\bar{\\nabla} V(q_k, q_{k+1})$\n-   从位置更新： $v_{k+1} + v_k = \\frac{2}{\\Delta t} (q_{k+1} - q_k)$\n\n将这些代入动能变化中：\n$$ \\frac{1}{2} \\left(-\\Delta t M^{-1} \\bar{\\nabla} V(q_k, q_{k+1})\\right)^{\\top} M \\left(\\frac{2}{\\Delta t} (q_{k+1} - q_k)\\right) $$\n$$ = \\frac{1}{2} (-\\Delta t) (\\bar{\\nabla} V)^{\\top} (M^{-1})^{\\top} M \\frac{2}{\\Delta t} (q_{k+1} - q_k) $$\n由于 $M$ 是对称的，$M^{-1}$ 也是对称的，因此 $(M^{-1})^{\\top} = M^{-1}$。\n$$ = -(\\bar{\\nabla} V(q_k, q_{k+1}))^{\\top} M^{-1} M (q_{k+1} - q_k) = -(\\bar{\\nabla} V(q_k, q_{k+1}))^{\\top} (q_{k+1} - q_k) $$\n现在，考虑势能变化 $V(q_{k+1}) - V(q_k)$。根据离散梯度的定义性质（离散链式法则）：\n$$ V(q_{k+1}) - V(q_k) = \\bar{\\nabla} V(q_k, q_{k+1})^{\\top} (q_{k+1} - q_k) $$\n结合动能和势能的变化：\n$$ H_{k+1} - H_k = \\left(- \\bar{\\nabla} V^{\\top} (q_{k+1} - q_k)\\right) + \\left(\\bar{\\nabla} V^{\\top} (q_{k+1} - q_k)\\right) = 0 $$\n因此，$H_{k+1} = H_k$，该方法精确保守离散总能量。\n\n**二阶精度：**\n为证明二阶精度，我们通过将精确解 $q(t)$ 代入离散方程来分析局部截断误差。设 $q_k = q(t_k)$ 和 $v_k = \\dot{q}(t_k)$。\n位置更新的截断误差为 $\\tau_q$：\n$$ \\tau_q = \\frac{q(t_k+\\Delta t) - q(t_k)}{\\Delta t} - \\frac{\\dot{q}(t_k+\\Delta t) + \\dot{q}(t_k)}{2} $$\n将 $q(t_k+\\Delta t)$ 和 $\\dot{q}(t_k+\\Delta t)$ 在 $t_k$ 附近作泰勒级数展开：\n$$ q(t_k+\\Delta t) = q_k + \\dot{q}_k \\Delta t + \\frac{1}{2} \\ddot{q}_k \\Delta t^2 + \\frac{1}{6} \\dddot{q}_k \\Delta t^3 + O(\\Delta t^4) $$\n$$ \\dot{q}(t_k+\\Delta t) = \\dot{q}_k + \\ddot{q}_k \\Delta t + \\frac{1}{2} \\dddot{q}_k \\Delta t^2 + O(\\Delta t^3) $$\n将这些代入 $\\tau_q$：\n$$ \\tau_q = \\left(\\dot{q}_k + \\frac{1}{2} \\ddot{q}_k \\Delta t + \\frac{1}{6} \\dddot{q}_k \\Delta t^2\\right) - \\left(\\dot{q}_k + \\frac{1}{2} \\ddot{q}_k \\Delta t + \\frac{1}{4} \\dddot{q}_k \\Delta t^2\\right) + O(\\Delta t^3) $$\n$$ \\tau_q = -\\frac{1}{12}\\dddot{q}_k \\Delta t^2 + O(\\Delta t^3) = O(\\Delta t^2) $$\n动量更新的截断误差为 $\\tau_v$：\n$$ \\tau_v = M \\frac{\\dot{q}(t_k+\\Delta t) - \\dot{q}(t_k)}{\\Delta t} + \\bar{\\nabla} V(q(t_k), q(t_k+\\Delta t)) $$\n我们将两项都在 $t_k$ 附近展开。\n$$ M\\frac{\\dot{q}_{k+1}-\\dot{q}_k}{\\Delta t} = M(\\ddot{q}_k + \\frac{1}{2}\\dddot{q}_k \\Delta t + O(\\Delta t^2)) $$\n对于离散梯度，我们在 $q_k$ 附近展开：\n$$ \\bar{\\nabla} V(q_k, q_{k+1}) = \\int_0^1 \\nabla V(q_k + \\xi(q_{k+1}-q_k)) d\\xi $$\n$$ q_{k+1}-q_k = \\dot{q}_k \\Delta t + O(\\Delta t^2) $$\n$$ \\bar{\\nabla} V = \\int_0^1 \\left(\\nabla V(q_k) + \\xi \\nabla^2 V(q_k)(q_{k+1}-q_k) + O(\\Delta t^2)\\right) d\\xi $$\n$$ = \\nabla V(q_k) + \\frac{1}{2} \\nabla^2 V(q_k)(\\dot{q}_k \\Delta t) + O(\\Delta t^2) $$\n将这些展开式代入 $\\tau_v$：\n$$ \\tau_v = \\left(M\\ddot{q}_k + \\frac{1}{2}M\\dddot{q}_k \\Delta t\\right) + \\left(\\nabla V(q_k) + \\frac{1}{2}\\nabla^2 V(q_k)\\dot{q}_k \\Delta t\\right) + O(\\Delta t^2) $$\n$$ = (M\\ddot{q}_k + \\nabla V(q_k)) + \\frac{\\Delta t}{2} (M\\dddot{q}_k + \\nabla^2 V(q_k)\\dot{q}_k) + O(\\Delta t^2) $$\n精确解满足 $M\\ddot{q} + \\nabla V(q) = 0$。对此式关于时间求导得到 $M\\dddot{q} + \\nabla^2 V(q)\\dot{q} = 0$。因此，$\\tau_v$ 表达式中的 $O(1)$ 和 $O(\\Delta t)$ 项均为零。这意味着 $\\tau_v = O(\\Delta t^2)$。\n由于两个定义方程的局部截断误差均为 $O(\\Delta t^2)$，该方法是二阶精确的。\n\n**4. 离散梯度的计算**\n\n给定一个一维系统（$n=1$），其质量 $M=1$，势能为 $V(q) = \\frac{1}{3} q^{4} + \\frac{1}{3} q^{2}$。连续梯度为 $\\nabla V(q) = V'(q) = \\frac{4}{3} q^3 + \\frac{2}{3} q$。我们需要计算当 $q_k=1$ 和 $q_{k+1}=2$ 时离散梯度 $\\bar{\\nabla} V(q_k, q_{k+1})$ 的值。\n\n使用中值离散梯度的定义：\n$$ \\bar{\\nabla} V(q_k, q_{k+1}) = \\int_0^1 V'((1-\\xi)q_k + \\xi q_{k+1}) d\\xi $$\n代入 $q_k=1$ 和 $q_{k+1}=2$。$V'$ 的自变量为 $(1-\\xi) \\cdot 1 + \\xi \\cdot 2 = 1 - \\xi + 2\\xi = 1 + \\xi$。\n$$ \\bar{\\nabla} V(1, 2) = \\int_0^1 V'(1+\\xi) d\\xi = \\int_0^1 \\left(\\frac{4}{3}(1+\\xi)^3 + \\frac{2}{3}(1+\\xi)\\right) d\\xi $$\n我们进行定积分计算：\n$$ \\bar{\\nabla} V(1, 2) = \\left[ \\frac{4}{3} \\frac{(1+\\xi)^4}{4} + \\frac{2}{3} \\frac{(1+\\xi)^2}{2} \\right]_0^1 $$\n$$ = \\left[ \\frac{1}{3}(1+\\xi)^4 + \\frac{1}{3}(1+\\xi)^2 \\right]_0^1 $$\n在上限（$\\xi=1$）处求值：\n$$ \\frac{1}{3}(1+1)^4 + \\frac{1}{3}(1+1)^2 = \\frac{1}{3}(2)^4 + \\frac{1}{3}(2)^2 = \\frac{16}{3} + \\frac{4}{3} = \\frac{20}{3} $$\n在下限（$\\xi=0$）处求值：\n$$ \\frac{1}{3}(1+0)^4 + \\frac{1}{3}(1+0)^2 = \\frac{1}{3}(1)^4 + \\frac{1}{3}(1)^2 = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3} $$\n积分的值是两者的差：\n$$ \\bar{\\nabla} V(1, 2) = \\frac{20}{3} - \\frac{2}{3} = \\frac{18}{3} = 6 $$\n离散梯度的值为 $6$。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "上一个练习中构建的保能量算法是隐式的，这意味着在每个时间步都需要求解一个非线性代数方程。本练习将从理论转向实际应用，聚焦于如何应对这一挑战 。您将针对一个具体的非线性振子，推导出其特定的“算法内力”，以及更关键的“算法切线”，后者是使用牛顿法高效求解该隐式系统所必需的关键要素。",
            "id": "3562051",
            "problem": "考虑一个单自由度保守非线性弹性振子，其广义坐标为 $q$，质量为 $m$，储存的能量（势能）$V(q)$ 由 $V(q)=\\tfrac{1}{2} k q^{2}+\\tfrac{1}{4} \\beta q^{4}$ 给出，其中 $k \\ge 0$ 且 $\\beta \\ge 0$。不存在外力。根据 Hamilton 原理，控制运动方程为 $m \\ddot{q} + \\partial V/\\partial q = 0$。我们寻求一个步长为 $\\Delta t$ 的时间步进格式，该格式能在离散层面上同时守恒总线动量和总机械能。对惯性项使用中点运动学，并强制实施一个时间步内的精确离散能量平衡，这与计算固体力学中的能量动量守恒时间积分方法一致。\n\n从这些原理出发，且不使用任何预先给定的离散力公式，执行以下操作：\n\n- 通过在时间步 $[t_{k},t_{k+1}]$ 上施加精确的离散能量平衡，推导离散内力 $f_{\\text{int}}^{\\text{alg}}(q_{k},q_{k+1})$。\n- 构建牛顿迭代所需的算法切线 $K_{\\text{alg}}=\\partial f_{\\text{int}}^{\\text{alg}}/\\partial q_{k+1}$，并以 $k$、$\\beta$、$q_{k}$ 和 $q_{k+1}$ 的闭式形式表示。\n- 简要讨论该模型中 $K_{\\text{alg}}$ 的对称性和正定性，并将其与 $V$ 的凸性联系起来。\n\n你的最终答案必须是 $K_{\\text{alg}}(q_{k},q_{k+1})$ 关于 $k$、$\\beta$、$q_{k}$ 和 $q_{k+1}$ 的显式闭式解析表达式。最终答案中不要包含单位。无需进行数值四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据、适定、客观，并包含了在计算固体力学框架内获得唯一解所需的所有必要信息。它为一种基础的能量动量守恒算法提供了一个标准且不平凡的推导过程。\n\n该系统是一个单自由度保守振子，广义坐标为 $q$，质量为 $m$，势能为 $V(q)$。运动方程为 $m\\ddot{q} + f_{\\text{int}}(q) = 0$，其中连续内力为 $f_{\\text{int}}(q) = \\partial V/\\partial q$。总机械能为 $E = T+V = \\frac{1}{2}m\\dot{q}^2 + V(q)$。\n\n我们寻求一种能够精确守恒能量的离散时间步进算法。我们在一个持续时间为 $\\Delta t = t_{k+1}-t_k$ 的时间步 $[t_k, t_{k+1}]$ 上，对动力学使用中点法则框架。设 $q_k = q(t_k)$ 和 $p_k = m\\dot{q}(t_k)$ 分别为时间 $t_k$ 时的坐标和线动量。\n\n位置和动量的离散更新由下式给出：\n1. 位置的中心差分更新，与“中点运动学”一致：\n$$ \\frac{q_{k+1} - q_k}{\\Delta t} = \\frac{\\dot{q}_{k+1} + \\dot{q}_k}{2} = \\frac{p_{k+1} + p_k}{2m} $$\n2. 牛顿第二定律的离散形式，它定义了离散算法内力 $f_{\\text{int}}^{\\text{alg}}$：\n$$ \\frac{p_{k+1} - p_k}{\\Delta t} = -f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) $$\n该公式确保了线动量的离散守恒。\n\n为确保离散能量守恒，算法力在一个步长内所做的功必须精确地平衡势能的变化，即 $\\Delta T + \\Delta V = 0$。动能的变化为：\n$$ \\Delta T = T_{k+1} - T_k = \\frac{p_{k+1}^2}{2m} - \\frac{p_k^2}{2m} = \\frac{1}{2m}(p_{k+1} - p_k)(p_{k+1} + p_k) $$\n根据上述离散运动学和动力学方程，我们可以替换项 $(p_{k+1} - p_k)$ 和 $(p_{k+1} + p_k)$：\n$$ p_{k+1} - p_k = -\\Delta t f_{\\text{int}}^{\\text{alg}} $$\n$$ p_{k+1} + p_k = \\frac{2m}{\\Delta t}(q_{k+1} - q_k) $$\n将这些代入 $\\Delta T$ 的表达式中：\n$$ \\Delta T = \\frac{1}{2m} (-\\Delta t f_{\\text{int}}^{\\text{alg}}) \\left( \\frac{2m}{\\Delta t}(q_{k+1} - q_k) \\right) = -f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) (q_{k+1} - q_k) $$\n动能的变化等于算法内力所做的功。总能量守恒要求 $\\Delta T + \\Delta V = 0$ 于是变为：\n$$ -f_{\\text{int}}^{\\text{alg}}(q_{k+1} - q_k) + (V(q_{k+1}) - V(q_k)) = 0 $$\n这就给出了能量守恒算法力的基本定义方程。\n\n**离散内力 $f_{\\text{int}}^{\\text{alg}}$ 的推导**\n从离散能量平衡出发，假设 $q_{k+1} \\neq q_k$，我们有：\n$$ f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) = \\frac{V(q_{k+1}) - V(q_k)}{q_{k+1} - q_k} $$\n如果 $q_{k+1} = q_k$，则该力在极限情况下恢复为连续力，$f_{\\text{int}}(q_k) = V'(q_k)$。\n给定的势能为 $V(q) = \\frac{1}{2} k q^{2} + \\frac{1}{4} \\beta q^{4}$。\n势能的变化为：\n$$ V(q_{k+1}) - V(q_k) = \\left(\\frac{1}{2} k q_{k+1}^{2} + \\frac{1}{4} \\beta q_{k+1}^{4}\\right) - \\left(\\frac{1}{2} k q_k^{2} + \\frac{1}{4} \\beta q_k^{4}\\right) $$\n$$ = \\frac{1}{2} k (q_{k+1}^{2} - q_k^{2}) + \\frac{1}{4} \\beta (q_{k+1}^{4} - q_k^{4}) $$\n使用代数恒等式 $a^2-b^2=(a-b)(a+b)$ 和 $a^4-b^4=(a-b)(a+b)(a^2+b^2)$：\n$$ V(q_{k+1}) - V(q_k) = \\frac{1}{2} k (q_{k+1} - q_k)(q_{k+1} + q_k) + \\frac{1}{4} \\beta (q_{k+1} - q_k)(q_{k+1} + q_k)(q_{k+1}^{2} + q_k^{2}) $$\n除以 $(q_{k+1} - q_k)$ 得到算法内力：\n$$ f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) = \\frac{1}{2} k (q_k + q_{k+1}) + \\frac{1}{4} \\beta (q_k + q_{k+1})(q_k^2 + q_{k+1}^2) $$\n\n**算法切线 $K_{\\text{alg}}$ 的构建**\n在使用 Newton-Raphson 方法求解时间步的非线性代数方程时，需要算法切线 $K_{\\text{alg}}$。它被定义为算法力相对于步末坐标 $q_{k+1}$ 的导数：\n$$ K_{\\text{alg}}(q_k, q_{k+1}) = \\frac{\\partial f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1})}{\\partial q_{k+1}} $$\n为了计算它，我们将 $f_{\\text{int}}^{\\text{alg}}$ 的表达式对 $q_{k+1}$ 求导，并将 $q_k$ 视为常数。\n我们展开项 $(q_k + q_{k+1})(q_k^2 + q_{k+1}^2) = q_k^3 + q_k q_{k+1}^2 + q_{k+1} q_k^2 + q_{k+1}^3$。\n因此，$f_{\\text{int}}^{\\text{alg}} = \\frac{k}{2}(q_k + q_{k+1}) + \\frac{\\beta}{4}(q_k^3 + q_k q_{k+1}^2 + q_{k+1} q_k^2 + q_{k+1}^3)$。\n现在，我们逐项求导：\n$$ \\frac{\\partial}{\\partial q_{k+1}} \\left[ \\frac{k}{2}(q_k + q_{k+1}) \\right] = \\frac{k}{2} $$\n$$ \\frac{\\partial}{\\partial q_{k+1}} \\left[ \\frac{\\beta}{4}(q_k^3 + q_k q_{k+1}^2 + q_{k+1} q_k^2 + q_{k+1}^3) \\right] = \\frac{\\beta}{4} (0 + 2q_k q_{k+1} + q_k^2 + 3q_{k+1}^2) $$\n合并这些结果，得到算法切线：\n$$ K_{\\text{alg}} = \\frac{k}{2} + \\frac{\\beta}{4}(q_k^2 + 2q_k q_{k+1} + 3q_{k+1}^2) $$\n\n**关于对称性和正定性的讨论**\n对于单自由度系统，算法切线 $K_{\\text{alg}}$ 是一个标量。因此，对称性是平凡的。在多自由度情况下，算法切线刚度矩阵的对称性是提高计算效率的一个理想属性，如果算法力可从一个离散势函数推导得出，那么该性质成立，这对于这类积分器是正确的。\n\n对于正定性，我们必须检查是否 $K_{\\text{alg}} > 0$。已知 $k \\ge 0$ 和 $\\beta \\ge 0$。\n涉及 $\\beta$ 的项包含二次表达式 $Q(q_k, q_{k+1}) = q_k^2 + 2q_k q_{k+1} + 3q_{k+1}^2$。我们可以通过配方法来分析其符号：\n$$ Q(q_k, q_{k+1}) = (q_k^2 + 2q_k q_{k+1} + q_{k+1}^2) + 2q_{k+1}^2 = (q_k + q_{k+1})^2 + 2q_{k+1}^2 $$\n由于 $(q_k + q_{k+1})^2 \\ge 0$ 且 $2q_{k+1}^2 \\ge 0$，它们的和 $Q$ 总是非负的。$Q=0$ 当且仅当 $q_{k+1}=0$ 且 $q_k+q_{k+1}=0$，这意味着 $q_k=q_{k+1}=0$。\n因此，$K_{\\text{alg}} = \\frac{k}{2} + \\frac{\\beta}{4}((q_k + q_{k+1})^2 + 2q_{k+1}^2) \\ge 0$。\n如果 $k>0$，则对于所有 $q_k, q_{k+1}$，$K_{\\text{alg}} > 0$。如果 $k=0$ 且 $\\beta>0$，则 $K_{\\text{alg}} > 0$ 除非 $q_k=q_{k+1}=0$。算法切线是半正定的，并且在远离平凡状态时通常是正定的。\n\n此性质与势函数 $V(q)$ 的凸性直接相关。如果一个函数的二阶导数非负，则该函数是凸函数。对于我们的势函数 $V(q) = \\frac{1}{2} k q^2 + \\frac{1}{4} \\beta q^4$，其二阶导数为：\n$$ V''(q) = \\frac{\\partial^2 V}{\\partial q^2} = k + 3\\beta q^2 $$\n已知 $k \\ge 0$ 和 $\\beta \\ge 0$，显然对于所有 $q$，$V''(q) \\ge 0$。因此，势函数 $V(q)$ 是凸函数。对于这类能量守恒格式，算法切线的正定性是底层势能函数凸性的直接结果。这确保了求解 $q_{k+1}$ 的 Newton-Raphson 迭代是在求解一个凸优化问题，从而保证了解的唯一性和稳健的收敛性。",
            "answer": "$$\n\\boxed{\\frac{k}{2} + \\frac{\\beta}{4}(q_{k}^{2} + 2q_{k}q_{k+1} + 3q_{k+1}^{2})}\n$$"
        },
        {
            "introduction": "在面对真实世界的复杂性时，理论上的守恒性质往往是脆弱的。当从简单的模型问题过渡到大规模有限元模拟时，许多实施细节都可能在不经意间破坏我们希望保持的不变量。最后的这个练习将作为一个高层次的诊断挑战 。您将扮演一名调试模拟程序的开发者，在空间离散和本构模型等环节中，找出那些违反能量-动量守恒核心原则的致命缺陷。",
            "id": "3562042",
            "problem": "考虑一个通过有限元方法（Finite Element Method (FEM)）离散化的有限应变超弹性固体，得到其半离散运动方程\n$$\n\\mathbf{M}(\\mathbf{q})\\,\\ddot{\\mathbf{q}} + \\mathbf{f}_{\\text{int}}(\\mathbf{q}) = \\mathbf{0},\n$$\n其中 $\\mathbf{q}$ 汇集了节点位置，$\\mathbf{M}(\\mathbf{q})$ 是由单元贡献组装而成的（可能与构型相关的）质量矩阵，$\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ 是内力向量。对于一个没有外部载荷和约束的封闭系统，其精确解守恒总线性动量\n$$\n\\mathbf{P} = \\mathbf{M}(\\mathbf{q})\\,\\dot{\\mathbf{q}},\n$$\n和总机械能\n$$\nE(\\mathbf{q},\\dot{\\mathbf{q}}) = \\tfrac{1}{2}\\,\\dot{\\mathbf{q}}^{\\mathsf{T}} \\mathbf{M}(\\mathbf{q}) \\dot{\\mathbf{q}} + U(\\mathbf{q}),\n$$\n其中 $U(\\mathbf{q})$ 是从超弹性应变能密度导出的离散内能。能量-动量守恒时间积分器可以从离散变分原理中导出；当离散拉格朗日量具有所需的对称性（时间平移和空间平移/旋转不变性）时，由此产生的方法可以精确地保持相应的离散不变量，其精度可达非线性求解的容差范围。\n\n一位开发人员为上述没有外部载荷、阻尼和约束的半离散系统实现了一种能量-动量守恒的中点型格式。尽管使用了很小的均匀时间步长 $h$，该开发人员观察到总机械能的单调漂移和总线性动量的缓慢增长。以下实现细节已得到确认：\n\n- 为了节省成本，内力采用 $1$ 点 Gauss 积分对 $8$ 节点三线性六面体单元进行组装，而质量矩阵则使用完全的 $2\\times 2\\times 2$ Gauss 积分。\n- Cauchy 应力通过一种客观的共旋（基于 Jaumann 率）算法进行更新，该算法并非显式地从应变能函数对应变度量的梯度导出。\n- 构型更新对 $\\mathbf{q}$ 使用中点法则，但在每个时间步内，速度更新对 $\\dot{\\mathbf{q}}$ 使用前向 Euler 法。\n- Newton–Raphson 求解器在每一步的相对残差范数低于 $10^{-3}$ 时停止。\n\n假设使用周期性边界，因此不会出现外部反作用力，并且没有人工阻尼。\n\n以下哪个选项正确地指出了破坏能量和/或动量守恒的具体实现错误，并附带了适当的诊断方法和修正措施，以将不变量恢复到求解器容差范围内？选择所有适用选项。\n\nA. 错误：对 $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ 使用 $1$ 点积分而对 $\\mathbf{M}(\\mathbf{q})$ 使用完全的 $2\\times 2\\times 2$ 积分，破坏了离散功共轭性和内力在刚体运动下的精确零空间性质。诊断：运行刚体平移/旋转测试，验证组装的内力合力 $\\sum_{a} \\mathbf{f}_{\\text{int},a}$ 精确为 $\\mathbf{0}$，且 $E$ 在机器精度内为常数。修正：使用一致的积分方案从同一个离散拉格朗日量中组装 $\\mathbf{M}(\\mathbf{q})$ 和 $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$，或使用匹配的减缩积分和稳定化技术，以使离散刚体模式不做内功。\n\nB. 错误：使用非应变能函数梯度的客观 Jaumann 率应力更新方法，在算法层面违反了超弹性假设，破坏了变分积分器所需的势结构。诊断：检查算法切线是否对称，以及内力是否为在时间步的功共轭构型下评估的离散势 $U(\\mathbf{q})$ 的精确梯度；同时验证 $U$ 的路径无关性。修正：根据在中点构型下评估的超弹性应变能密度计算应力和内力，并使用一致的算法切线将 $\\mathbf{f}_{\\text{int}}$ 组装为 $\\partial U/\\partial \\mathbf{q}$。\n\nC. 错误：无；任何观察到的漂移都与非线性求解器容差无关。诊断：无需诊断。修正：无；只要格式名义上是守恒的，无论 Newton 容差如何，能量-动量守恒都应成立。\n\nD. 错误：用前向 Euler 法更新 $\\dot{\\mathbf{q}}$，同时用中点法则更新 $\\mathbf{q}$，这破坏了离散变分结构，并使步进能量平衡中的精确抵消失效。诊断：将离散能量增量 $\\Delta E$ 与一个步长内计算的内力功进行比较；系统性的非零差值表明违反了中点功共轭性。修正：用中点法则更新动量，以便 $\\mathbf{q}$ 和 $\\dot{\\mathbf{q}}$ 的推进与能量-动量格式保持一致。\n\nE. 错误：缺少数值阻尼。诊断：观察到加入少量 Rayleigh 阻尼可将能量漂移减少到一个稳定水平。修正：加入少量与质量和刚度成比例的阻尼以消除漂移，同时保持动量和能量守恒特性。",
            "solution": "在进行求解之前，对问题陈述的有效性进行严格评估。\n\n### 步骤 1：提取已知条件\n-   **控制方程：** 有限应变超弹性固体的半离散运动方程为 $\\mathbf{M}(\\mathbf{q})\\,\\ddot{\\mathbf{q}} + \\mathbf{f}_{\\text{int}}(\\mathbf{q}) = \\mathbf{0}$。\n-   **变量：** $\\mathbf{q}$ 是节点位置向量，$\\mathbf{M}(\\mathbf{q})$ 是构型相关的质量矩阵，$\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ 是内力向量。\n-   **系统条件：** 系统是封闭的，无外部载荷、无约束、无人工阻尼。使用周期性边界。\n-   **守恒量（精确）：** 总线性动量 $\\mathbf{P} = \\mathbf{M}(\\mathbf{q})\\,\\dot{\\mathbf{q}}$ 和总机械能 $E(\\mathbf{q},\\dot{\\mathbf{q}}) = \\tfrac{1}{2}\\,\\dot{\\mathbf{q}}^{\\mathsf{T}} \\mathbf{M}(\\mathbf{q}) \\dot{\\mathbf{q}} + U(\\mathbf{q})$，其中 $U(\\mathbf{q})$ 是从超弹性应变能密度导出的离散内能。\n-   **数值方法：** 意图实现一个能量-动量守恒的中点型格式。\n-   **观察到的现象：** 使用一个小的均匀时间步长 $h$ 时，观察到总机械能的单调漂移和总线性动量的缓慢增长。\n-   **实现细节：**\n    1.  内力向量 $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ 对 $8$ 节点三线性六面体单元使用 $1$ 点 Gauss 积分进行组装，而质量矩阵 $\\mathbf{M}(\\mathbf{q})$ 使用完全的 $2\\times 2\\times 2$ Gauss 积分。\n    2.  Cauchy 应力通过一个非由应变能函数导出的共旋 Jaumann 率算法进行更新。\n    3.  对 $\\mathbf{q}$ 的构型更新使用中点法则，但对 $\\dot{\\mathbf{q}}$ 的速度更新在每个时间步内使用前向 Euler 法。\n    4.  Newton–Raphson 求解器的容差为相对残差范数低于 $10^{-3}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题陈述科学合理、适定且客观。它牢固地植根于计算固体力学这一成熟领域，特别是关于非线性动力学数值积分器的理论和实践。所有概念——有限元法（FEM）、超弹性、能量-动量守恒、变分积分器、Gauss 积分和本构更新——在该领域都是标准概念。该问题提出了一个现实的诊断挑战：识别数值实现中导致其违反理论守恒特性的缺陷。所提供的细节描述了常见且关键的实现错误。问题是自洽的，其术语定义足够精确以供分析。没有矛盾、伪科学主张或主观因素。\n\n### 步骤 3：结论和行动\n问题是**有效的**。将通过对照能量-动量守恒积分器的原理来分析所提供的实现细节，从而推导出解决方案。\n\n### 求解推导\n\n对于方程 $\\mathbf{M}(\\mathbf{q})\\,\\ddot{\\mathbf{q}} + \\nabla U(\\mathbf{q}) = \\mathbf{0}$，一个能量-动量守恒积分器是从离散变分原理中导出的。由此产生的离散运动方程被构造为精确地保持能量和动量的离散对应物，由于拉格朗日量的时间平移和空间平移不变性（Noether 定理），这些量在连续系统中是守恒的。观察到的能量和动量漂移表明，一个或多个所需的对称性或结构在实现层面被破坏了。我们分析报告中的每一个实现细节。\n\n1.  **积分不匹配：** 动量守恒源于离散拉格朗日量对刚体平移的不变性。这要求势能 $U(\\mathbf{q})$ 是不变的，因此内力 $\\mathbf{f}_{\\text{int}} = -\\nabla U(\\mathbf{q})$ 对于任何刚体运动，其合力为零且合力矩为零。这些力是通过对单元进行数值积分计算的。定义动能的质量矩阵 $\\mathbf{M}(\\mathbf{q})$ 也通过积分计算。如果用于 $\\mathbf{f}_{\\text{int}}$（从 $U(\\mathbf{q})$ 导出）的积分规则与用于 $\\mathbf{M}(\\mathbf{q})$ 的规则不同，离散对称性就可能被破坏。对刚度项使用 $1$ 点积分，对质量项使用 $2\\times 2\\times 2$ 积分，会造成不一致。众所周知，$8$ 节点六面体的 $1$ 点积分会引入伪零能（“沙漏”）模式。虽然对应于这些模式的内力为零，但质量矩阵（使用完全积分）会为它们赋予动能。如果这些模式被激发，动量和能量可能会被虚假地产生，导致漂移。这违反了离散变分公式所需的一致性。\n\n2.  **非保守本构律：** 变分积分器中的能量守恒是建立在存在一个势能函数 $U(\\mathbf{q})$ 的基础上的，使得内力是其负梯度，即 $\\mathbf{f}_{\\text{int}}(\\mathbf{q}) = -\\nabla U(\\mathbf{q})$。如果材料是超弹性的，即其应力响应可从一个应变能密度函数 $W$ 导出，则此条件得到满足。基于 Jaumann 率的客观应力更新是一种次弹性而非超弹性的本构律。在有限变形路径上对此类率形式的本构律进行积分，通常会导致功与路径相关；在封闭的变形循环中所做的功不为零。这意味着不存在一个底层的势能函数 $U(\\mathbf{q})$。实现这样的本构律破坏了能量守恒格式的基本假设，从而不可避免地导致能量不守恒，并产生观察到的单调漂移。\n\n3.  **不一致的时间积分格式：** 中点型能量-动量格式是一种特定的、精心构造的算法，通常是隐式的。例如，一个标准的中点法则使用在中点构型 $\\mathbf{q}_{n+1/2} = (\\mathbf{q}_n + \\mathbf{q}_{n+1})/2$ 处评估的力来求解时间 $t_{n+1}$ 的状态。位置和动量的更新是耦合的，例如 $\\mathbf{p}_{n+1} - \\mathbf{p}_n = -h \\mathbf{f}_{\\text{int}}(\\mathbf{q}_{n+1/2})$ 和 $\\mathbf{q}_{n+1} - \\mathbf{q}_n = h \\dot{\\mathbf{q}}_{n+1/2}$。对位置更新使用中点法则，但对速度更新使用前向 Euler 法（例如 $\\dot{\\mathbf{q}}_{n+1} = \\dot{\\mathbf{q}}_n + h \\ddot{\\mathbf{q}}_n$），构成了一种混合格式，它不对应于单一离散拉格朗日量的离散 Euler-Lagrange 方程。前向 Euler 法是显式的，并且是耗散的（或不稳定的），它的引入破坏了中点法则的时间可逆性和辛结构，而这些对于长期能量守恒至关重要。离散能量平衡证明中各项的精确抵消将不再成立。\n\n4.  **求解器容差：** 守恒在“非线性求解容差范围内”成立。$10^{-3}$ 的宽松容差意味着离散运动方程在每一步都没有被精确求解。这必然会在每个时间步给守恒量引入误差。这些误差会累积，导致漂移。虽然这是一个促成因素，但其他三点是算法公式中的根本性结构缺陷，即使在非常严格的容差下也会导致漂移。\n\n### 逐项分析选项\n\n**A. 错误：对 $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ 使用 $1$ 点积分而对 $\\mathbf{M}(\\mathbf{q})$ 使用完全的 $2\\times 2\\times 2$ 积分...**\n该选项正确地指出了上述第（1）点中讨论的积分不匹配问题。不一致的积分破坏了拉格朗日量的离散对称性，而这是动量守恒所必需的。“离散功共轭性”和“零空间性质”是恰当的术语。诊断方法，即刚体运动测试，是检查动量守恒违规的标准程序。修正措施，即使用一致的积分或适当稳定的减缩积分方案，是正确的补救方法。\n**结论：正确**\n\n**B. 错误：使用非应变能函数梯度的客观 Jaumann 率应力更新方法...**\n该选项正确地指出了使用非保守本构模型的问题，如第（2）点所讨论。变分积分器的能量守恒特性取决于机械系统是基于势的（超弹性）。使用次弹性定律违反了这一核心要求。检查切线对称性和路径无关性的诊断是正确的，同样正确的还有修正措施，即使用一个恰当的超弹性模型，其中力从一个应变能函数导出。\n**结论：正确**\n\n**C. 错误：无；任何观察到的漂移都与非线性求解器容差无关...**\n这个选项在两点上是错误的。首先，它声称没有错误，但细节（1）、（2）和（3）都是严重的实现错误。其次，它声称漂移与求解器容差无关。正如问题陈述本身和我们的分析第（4）点所指出的，守恒的准确性直接受非线性求解器容差的限制。$10^{-3}$ 的宽松容差肯定会导致误差累积并形成漂移。因此，该选项的前提是错误的。\n**结论：错误**\n\n**D. 错误：用前向 Euler 法更新 $\\dot{\\mathbf{q}}$，同时用中点法则更新 $\\mathbf{q}$...**\n该选项正确地指出了混合积分格式的缺陷，如第（3）点所讨论。这种“临时拼凑”的组合破坏了离散变分结构，而这正是积分器守恒特性的根基。依赖于位置和动量中点更新的特定对称结构的能量平衡被破坏了。建议的诊断方法正确地指出了这种违规的症状（离散功能量平衡中的缺陷）。修正措施，即对动量也使用一致的中点更新，是恰当的修复方法。\n**结论：正确**\n\n**E. 错误：缺少数值阻尼...**\n这个选项从根本上误解了问题。目标是实现能量和动量的*守恒*，而不是耗散。观察到的漂移是由有缺陷的实现引起的数值假象，而不是需要阻尼掉的物理现象。添加阻尼（例如 Rayleigh 阻尼）是一种*有意地从系统中移除*能量的方法。关于添加阻尼“保持”了能量和动量守恒特性的说法本身就是矛盾的。根据定义，阻尼使系统相对于能量是非守恒的。\n**结论：错误**",
            "answer": "$$\\boxed{ABD}$$"
        }
    ]
}