{
    "hands_on_practices": [
        {
            "introduction": "本章节的第一个练习将我们的研究置于牛顿-拉夫逊方法的基本力学原理之上。通过为一个材料非线性杆推导切线刚度并计算单步迭代更新，您将巩固对残差和雅可比矩阵如何构建并用于求解平衡问题的理解 。在转向更复杂的策略之前，这项实践对于建立直观认识至关重要。",
            "id": "3582791",
            "problem": "一根长度为 $L$、横截面积恒为 $A$ 的直棱柱一维杆，用一个具有节点位移 $u_{1}$ 和 $u_{2}$ 的双节点线性有限元进行建模。该杆在节点1处固定，因此 $u_{1}=0$，并在节点2处承受集中的轴向载荷 $f$。假设为小应变运动学，轴向应变为 $\\varepsilon = du/dx$，位移场由线性形函数 $N_{1}(x)=1-x/L$ 和 $N_{2}(x)=x/L$ 插值得到，因此 $u(x)=N_{1}(x)\\,u_{1}+N_{2}(x)\\,u_{2}$ 且 $\\varepsilon(x)=B\\,u_{e}$，其中 $B=\\left[-1/L,\\;1/L\\right]$ 且 $u_{e}=\\begin{pmatrix}u_{1}\\\\u_{2}\\end{pmatrix}$。材料是超弹性的，其一维本构关系为 $\\sigma(\\varepsilon)=E\\,\\varepsilon+\\alpha\\,\\varepsilon^{3}$，其中 $E$ 和 $\\alpha$ 是正常数。\n\n从节点2处自由度的有限元残差表达式 $R(u)=\\int_{0}^{L}B^{\\top}\\,\\sigma(Bu)\\,A\\,dx - f$ 出发，推导一致标量切向刚度 $K(u)=dR/du$（用 $E$, $\\alpha$, $L$, $A$ 和当前标量位移 $u:=u_{2}$ 表示）。然后，对于具体数据 $L=1.0$ m, $A=2.0\\times 10^{-4}$ m$^{2}$, $E=2.0\\times 10^{9}$ Pa, $\\alpha=1.0\\times 10^{10}$ Pa, 外加载荷 $f=1.0\\times 10^{5}$ N, 以及当前牛顿迭代值 $u_{k}=0.20$ m，计算 $K(u_{k})$ 的数值和牛顿更新量 $\\Delta u=-R(u_{k})/K(u_{k})$。将最终的更新量 $\\Delta u$ 以毫米为单位表示，并四舍五入到四位有效数字。",
            "solution": "该问题被验证为具有科学依据、适定且客观，尽管在残差的定义上存在轻微的模糊性，但这可以从第一性原理解决。在一个会产生大应变值（$20\\%$）的背景下使用小应变运动学模型，被解释为学术问题中的有意简化，而非根本性缺陷。\n\n该问题要求推导一致切向刚度，并为一个一维材料非线性有限元模型计算牛顿-拉夫逊更新量。\n\n首先，我们建立自由度的标量残差方程 $R(u)$，该自由度是节点2的位移，记为 $u := u_2$。边界条件是 $u_1=0$。残差是节点2处的内力 $F_{int,2}$ 与外部施加的力 $f$ 之间的差值。\n$$R(u) = F_{int,2}(u) - f$$\n内力由应力在单元域上的积分导出，并由形函数的相应导数加权。对于节点2，即为：\n$$F_{int,2}(u) = \\int_{0}^{L} N_{2,x}(x) \\, \\sigma(\\varepsilon(u)) \\, A \\, dx$$\n位移场为 $u(x) = N_1(x)u_1 + N_2(x)u_2 = (1-x/L)u_1 + (x/L)u_2$。给定 $u_1=0$ 和 $u_2=u$，则变为 $u(x) = (x/L)u$。\n轴向应变 $\\varepsilon$ 定义为 $\\varepsilon = du/dx$。\n$$\\varepsilon = \\frac{d}{dx}\\left(\\frac{x}{L}u\\right) = \\frac{u}{L}$$\n或者，使用给定的应变-位移矩阵 $B = [-1/L, 1/L]$ 和节点位移向量 $u_e = \\begin{pmatrix} u_1 \\\\ u_2 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ u \\end{pmatrix}$：\n$$\\varepsilon = B u_e = \\begin{pmatrix} -1/L  1/L \\end{pmatrix} \\begin{pmatrix} 0 \\\\ u \\end{pmatrix} = \\frac{u}{L}$$\n由于应变 $\\varepsilon$ 在整个单元中是恒定的，应力 $\\sigma$ 也是恒定的。本构关系为 $\\sigma(\\varepsilon) = E\\varepsilon + \\alpha\\varepsilon^3$。代入 $\\varepsilon = u/L$：\n$$\\sigma(u) = E\\left(\\frac{u}{L}\\right) + \\alpha\\left(\\frac{u}{L}\\right)^3$$\n第二个形函数的导数为 $N_{2,x}(x) = d/dx(x/L) = 1/L$。\n现在我们可以计算内力积分：\n$$F_{int,2}(u) = \\int_{0}^{L} \\frac{1}{L} \\left[ E\\left(\\frac{u}{L}\\right) + \\alpha\\left(\\frac{u}{L}\\right)^3 \\right] A \\, dx$$\n由于被积函数中的所有项相对于 $x$ 都是常数：\n$$F_{int,2}(u) = \\frac{A}{L} \\left[ E\\frac{u}{L} + \\alpha\\frac{u^3}{L^3} \\right] \\int_{0}^{L} dx = \\frac{A}{L} \\left[ E\\frac{u}{L} + \\alpha\\frac{u^3}{L^3} \\right] L$$\n$$F_{int,2}(u) = A \\left[ \\frac{E}{L}u + \\frac{\\alpha}{L^3}u^3 \\right]$$\n因此，标量残差方程为：\n$$R(u) = \\frac{AE}{L}u + \\frac{A\\alpha}{L^3}u^3 - f$$\n接下来，我们通过对残差 $R(u)$ 关于位移 $u$ 求导，来推导一致标量切向刚度 $K(u)$。\n$$K(u) = \\frac{dR}{du} = \\frac{d}{du}\\left( \\frac{AE}{L}u + \\frac{A\\alpha}{L^3}u^3 - f \\right)$$\n$$K(u) = \\frac{AE}{L} + 3\\frac{A\\alpha}{L^3}u^2$$\n这是切向刚度的符号表达式。\n\n现在我们代入给定的数值来计算 $K(u_k)$ 和牛顿更新量 $\\Delta u$。\n给定的数据是：\n$L = 1.0$ m\n$A = 2.0 \\times 10^{-4}$ m$^2$\n$E = 2.0 \\times 10^9$ Pa\n$\\alpha = 1.0 \\times 10^{10}$ Pa\n$f = 1.0 \\times 10^5$ N\n当前位移迭代值：$u_k = 0.20$ m\n\n首先，我们计算在 $u_k = 0.20$ m 处的切向刚度 $K(u_k)$。\n$$K(u_k) = \\frac{(2.0 \\times 10^{-4})(2.0 \\times 10^9)}{1.0} + \\frac{3(2.0 \\times 10^{-4})(1.0 \\times 10^{10})}{(1.0)^3}(0.20)^2$$\n第一项是线性刚度：\n$$K_{linear} = (2.0 \\times 10^{-4})(2.0 \\times 10^9) = 4.0 \\times 10^5 \\, \\text{N/m}$$\n第二项是非线性贡献：\n$$K_{nonlinear} = 3(2.0 \\times 10^{-4})(1.0 \\times 10^{10})(0.04) = (6.0 \\times 10^{-4})(1.0 \\times 10^{10})(0.04) = (6.0 \\times 10^6)(0.04) = 2.4 \\times 10^5 \\, \\text{N/m}$$\n总切向刚度为：\n$$K(u_k) = 4.0 \\times 10^5 + 2.4 \\times 10^5 = 6.4 \\times 10^5 \\, \\text{N/m}$$\n接下来，我们计算在 $u_k = 0.20$ m 处的残差 $R(u_k)$。\n$$R(u_k) = \\frac{(2.0 \\times 10^{-4})(2.0 \\times 10^9)}{1.0}(0.20) + \\frac{(2.0 \\times 10^{-4})(1.0 \\times 10^{10})}{(1.0)^3}(0.20)^3 - 1.0 \\times 10^5$$\n$$R(u_k) = (4.0 \\times 10^5)(0.20) + (2.0 \\times 10^6)(0.008) - 1.0 \\times 10^5$$\n$$R(u_k) = 8.0 \\times 10^4 + 1.6 \\times 10^4 - 1.0 \\times 10^5$$\n$$R(u_k) = 9.6 \\times 10^4 - 1.0 \\times 10^5 = -0.04 \\times 10^5 = -4000 \\, \\text{N}$$\n牛顿更新量 $\\Delta u$ 由公式 $\\Delta u = -R(u_k) / K(u_k)$ 给出。\n$$\\Delta u = - \\frac{-4000 \\, \\text{N}}{6.4 \\times 10^5 \\, \\text{N/m}} = \\frac{4000}{640000} \\, \\text{m} = \\frac{4}{640} \\, \\text{m} = \\frac{1}{160} \\, \\text{m}$$\n$$\\Delta u = 0.00625 \\, \\text{m}$$\n问题要求答案以毫米（mm）为单位，并四舍五入到四位有效数字。\n$$\\Delta u = 0.00625 \\, \\text{m} \\times \\frac{1000 \\, \\text{mm}}{1 \\, \\text{m}} = 6.25 \\, \\text{mm}$$\n四舍五入到四位有效数字得到 $6.250$ mm。",
            "answer": "$$\\boxed{6.250}$$"
        },
        {
            "introduction": "虽然全牛顿法提供快速收敛，但其每次迭代的计算成本可能很高。本实践针对一个真实的多步分析，对全牛顿法和修正牛顿法进行了定量比较 。通过分析迭代次数与矩阵分解成本之间的权衡，您将深入了解在大型模拟中采用修正牛顿策略的实际动机。",
            "id": "3582866",
            "problem": "一个通过有限元法 (FEM) 离散化的三维弹塑性块，在具有$8$个相等增量步的单调、位移控制加载路径下驱动。每个增量步的非线性平衡问题通过牛顿-拉夫逊 (NR) 法求解，该方法旨在寻找 $\\mathbf{u}$ 使得残差 $\\mathbf{R}(\\mathbf{u}) = \\mathbf{0}$，其中 $\\mathbf{R}(\\mathbf{u}) = \\mathbf{f}^{\\text{ext}} - \\mathbf{f}^{\\text{int}}(\\mathbf{u})$。在全牛顿法中，一致切线刚度 $\\mathbf{K}_{T}(\\mathbf{u}^{(k)})$ 在每次迭代 $k$ 时都会进行组装和分解。在修正牛顿法中，切线刚度 $\\mathbf{K}_{T}$ 仅在每个加载增量步开始时组装和分解一次，并为该增量步内的所有后续迭代重用。\n\n在整个分析过程中，自由度 (DOF) 保持不变。假设每次迭代进行一次线性系统回代求解，且无线搜索、无约束求解、无接触迭代。在此问题上，所使用的稀疏求解器和单元例程的实测计算成本如下：\n- 每次组装的切线组装时间 $t_{a} = 0.90$ 秒。\n- 每次分解的稀疏分解时间 $t_{f} = 2.80$ 秒。\n- 每次迭代的单个右端项回代求解时间 $t_{s} = 0.14$ 秒。\n\n全牛顿法（记为 $N_{i}$）和修正牛顿法（记为 $M_{i}$）每个加载增量步的记录迭代次数如下：\n- 加载增量步 1：$N_{1} = 4$， $M_{1} = 5$。\n- 加载增量步 2：$N_{2} = 3$， $M_{2} = 4$。\n- 加载增量步 3：$N_{3} = 3$， $M_{3} = 5$。\n- 加载增量步 4：$N_{4} = 5$， $M_{4} = 7$。\n- 加载增量步 5：$N_{5} = 6$， $M_{5} = 8$。\n- 加载增量步 6：$N_{6} = 7$， $M_{6} = 9$。\n- 加载增量步 7：$N_{7} = 7$， $M_{7} = 10$。\n- 加载增量步 8：$N_{8} = 8$， $M_{8} = 11$。\n\n任务：\n1. 相对于全牛顿法，计算修正牛顿法在整个加载路径上实现的总分解重用次数。\n2. 相对于全牛顿法，计算修正牛顿法所需的额外总迭代次数。\n3. 使用给定的计算成本模型，估算修正牛顿法相对于全牛顿法在整个加载路径上的净运行时间节省。\n\n将最终答案表示为以秒为单位的净运行时间节省。将您的答案四舍五入到四位有效数字。对任何中间结果和最终报告的量都使用秒作为单位。",
            "solution": "首先根据指定标准对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n- 分析类型：通过有限元法离散化的三维弹塑性块。\n- 加载：单调、位移控制，具有 $n_{\\text{inc}} = 8$ 个相等增量步。\n- 非线性求解器：牛顿-拉夫逊 (NR) 法求解 $\\mathbf{R}(\\mathbf{u}) = \\mathbf{0}$。\n- 全牛顿 (FN) 法：切线刚度 $\\mathbf{K}_{T}$ 在每次迭代时进行组装和分解。\n- 修正牛顿 (MN) 法：$\\mathbf{K}_{T}$ 仅在每个加载增量步开始时组装和分解一次。\n- 计算成本：\n  - 切线组装时间：$t_{a} = 0.90$ 秒。\n  - 稀疏分解时间：$t_{f} = 2.80$ 秒。\n  - 回代求解时间：$t_{s} = 0.14$ 秒。\n- 假设：每次迭代进行一次回代求解，无线搜索、无约束求解、无接触迭代。\n- 每个增量步 $i$ 的 FN ($N_{i}$) 和 MN ($M_{i}$) 迭代次数：\n  - $N_1 = 4$, $M_1 = 5$。\n  - $N_2 = 3$, $M_2 = 4$。\n  - $N_3 = 3$, $M_3 = 5$。\n  - $N_4 = 5$, $M_4 = 7$。\n  - $N_5 = 6$, $M_5 = 8$。\n  - $N_6 = 7$, $M_6 = 9$。\n  - $N_7 = 7$, $M_7 = 10$。\n  - $N_8 = 8$, $M_8 = 11$。\n- 要求输出：MN 相对于 FN 的净运行时间节省，四舍五入到四位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 问题牢固地植根于计算固体力学领域，特别涉及有限元法产生的非线性系统的数值解。全牛顿法和修正牛顿法、切线刚度组装、分解、回代替换及其相关的计算成本等概念都是标准且成熟的。\n- **适定性：** 所有必要的数据（原子操作的计算时间、增量步数以及两种方法的迭代次数）均已提供。任务具体且可计算，可得出唯一的数值解。这些假设简化了成本模型，但并未使其失效；它们创建了一个清晰、自洽的问题。\n- **客观性：** 问题使用精确、客观的技术语言和数值数据进行描述。它没有歧义和主观性陈述。\n- **结论：** 该问题在科学上是合理的、适定的、完整的和客观的。它不违反任何无效标准。\n\n**步骤 3：判定和行动**\n问题有效。将提供完整解答。\n\n**解题推导**\n\n主要目标是计算使用修正牛顿 (MN) 法替代全牛顿 (FN) 法所实现的净运行时间节省 $\\Delta T$。这个节省量是两种方法总计算时间的差值：\n$$ \\Delta T = T_{\\text{FN}} - T_{\\text{MN}} $$\n\n令 $n_{\\text{inc}} = 8$ 为加载增量步的数量。我们通过对所有增量步的成本求和来为每种方法建立总计算时间模型。\n\n**全牛顿 (FN) 法的成本模型**\n在全牛顿-拉夫逊法中，切线刚度矩阵在每次迭代时都会进行组装和分解。因此，单次迭代的成本是组装时间 $t_a$、分解时间 $t_f$ 和回代求解时间 $t_s$ 的总和。对于需要 $N_i$ 次迭代的加载增量步 $i$，其计算成本为：\n$$ T_{\\text{FN},i} = N_i (t_a + t_f + t_s) $$\n所有 $n_{\\text{inc}}$ 个增量步的总成本是每个增量步成本的总和：\n$$ T_{\\text{FN}} = \\sum_{i=1}^{n_{\\text{inc}}} T_{\\text{FN},i} = \\sum_{i=1}^{8} N_i (t_a + t_f + t_s) = \\left(\\sum_{i=1}^{8} N_i\\right) (t_a + t_f + t_s) $$\n\n**修正牛顿 (MN) 法的成本模型**\n在修正牛顿法中，切线刚度矩阵仅在每个加载增量步开始时组装和分解一次。这个成本 $(t_a + t_f)$ 在每个增量步中只产生一次。增量步 $i$ 内的 $M_i$ 次迭代每次都需要一次回代求解。因此，增量步 $i$ 的计算成本是：\n$$ T_{\\text{MN},i} = (t_a + t_f) + M_i t_s $$\n所有 $n_{\\text{inc}}$ 个增量步的总成本是：\n$$ T_{\\text{MN}} = \\sum_{i=1}^{n_{\\text{inc}}} T_{\\text{MN},i} = \\sum_{i=1}^{8} ((t_a + t_f) + M_i t_s) = n_{\\text{inc}}(t_a + t_f) + \\left(\\sum_{i=1}^{8} M_i\\right) t_s $$\n\n**计算**\n\n首先，我们计算每种方法的总迭代次数。\nFN 的总迭代次数，$N_{\\text{total}}$：\n$$ N_{\\text{total}} = \\sum_{i=1}^{8} N_i = 4 + 3 + 3 + 5 + 6 + 7 + 7 + 8 = 43 $$\nMN 的总迭代次数，$M_{\\text{total}}$：\n$$ M_{\\text{total}} = \\sum_{i=1}^{8} M_i = 5 + 4 + 5 + 7 + 8 + 9 + 10 + 11 = 59 $$\n\n现在，为了完整性，我们处理中间任务。\n1.  **总分解重用次数：** 在 MN 法中，每个增量步执行一次分解。对于有 $M_i$ 次迭代的增量步，分解被重用了 $M_i - 1$ 次。总重用次数为 $\\sum_{i=1}^{8} (M_i - 1) = M_{\\text{total}} - 8 = 59 - 8 = 51$。\n2.  **总额外迭代次数：** MN 相对于 FN 所需的额外迭代次数为 $M_{\\text{total}} - N_{\\text{total}} = 59 - 43 = 16$。\n\n接下来，我们使用给定的成本数据计算总运行时间：$t_a = 0.90 \\, \\text{s}$，$t_f = 2.80 \\, \\text{s}$，$t_s = 0.14 \\, \\text{s}$。\n\n计算 $T_{\\text{FN}}$：\n$$ T_{\\text{FN}} = N_{\\text{total}} (t_a + t_f + t_s) = 43 \\times (0.90 + 2.80 + 0.14) \\, \\text{s} $$\n$$ T_{\\text{FN}} = 43 \\times 3.84 \\, \\text{s} = 165.12 \\, \\text{s} $$\n\n计算 $T_{\\text{MN}}$：\n$$ T_{\\text{MN}} = n_{\\text{inc}}(t_a + t_f) + M_{\\text{total}} t_s = 8 \\times (0.90 + 2.80) \\, \\text{s} + 59 \\times 0.14 \\, \\text{s} $$\n$$ T_{\\text{MN}} = 8 \\times 3.70 \\, \\text{s} + 8.26 \\, \\text{s} $$\n$$ T_{\\text{MN}} = 29.60 \\, \\text{s} + 8.26 \\, \\text{s} = 37.86 \\, \\text{s} $$\n\n最后，我们计算净运行时间节省 $\\Delta T$。\n$$ \\Delta T = T_{\\text{FN}} - T_{\\text{MN}} = 165.12 \\, \\text{s} - 37.86 \\, \\text{s} = 127.26 \\, \\text{s} $$\n\n问题要求答案四舍五入到四位有效数字。数值 $127.26$ 四舍五入到四位有效数字是 $127.3$。",
            "answer": "$$\\boxed{127.3}$$"
        },
        {
            "introduction": "超越简单的修正方法，像L-BFGS这样的拟牛顿法通过近似计算海森矩阵而非显式构造，在收敛性和效率之间实现了精妙的平衡。这项高级实践要求您实现核心的L-BFGS两环递归算法，这是许多现代优化和有限元求解器的中心环节 。成功完成此练习表明您对这些强大迭代方法在底层如何工作的深刻且实践性的掌握。",
            "id": "3582815",
            "problem": "在一个最小化小型非线性弹簧网络有限元势能 $\\phi(u)$ 的场景下，实现一个内存受限的 Broyden–Fletcher–Goldfarb–Shanno (L-BFGS) 双循环递归。该递归将逆 Hessian 矩阵近似 $H_k$ 应用于一个向量，而无需显式地构建 $H_k$。从计算固体力学的基本原理出发：离散系统的平衡是通过最小化势能泛函 $\\phi(u)$ 得到的，其一阶最优性条件表示为残差 $g(u) = \\nabla \\phi(u) = 0$。牛顿法源于 $\\phi(u)$ 的泰勒展开，其中 Hessian 矩阵 $K(u) = \\nabla^2 \\phi(u)$ 作为切线刚度。为了降低构建和分解 $K(u)$ 的成本，拟牛顿策略构建一个近似 $B_k \\approx K(u_k)$，其中 $H_k = B_k^{-1}$，并强制满足割线条件 $B_{k+1}s_k = y_k$，其中 $s_k = u_{k+1} - u_k$ 且 $y_k = g_{k+1} - g_k$。Broyden–Fletcher–Goldfarb–Shanno 更新是在曲率条件 $s_k^\\top y_k > 0$ 下经过充分测试的正定更新，其内存受限变体仅存储最近的 $m$ 对 $(s_i, y_i)$，并通过双循环递归将 $H_k$ 应用于一个向量。\n\n为一个双自由度离散弹簧网络定义一个无量纲势能\n$$\n\\phi(u) = \\sum_{i=1}^2 \\left( \\tfrac{1}{2} k_i (a_i^\\top u)^2 + \\tfrac{1}{4} c_i (a_i^\\top u)^4 \\right) - f^\\top u,\n$$\n其中 $u \\in \\mathbb{R}^2$, $a_1 = [1,\\,0]^\\top$, $a_2 = [1,\\,1]^\\top$, $k = [k_1,\\,k_2]^\\top$, $c = [c_1,\\,c_2]^\\top$, 且 $f \\in \\mathbb{R}^2$。梯度为\n$$\ng(u) = \\nabla \\phi(u) = \\sum_{i=1}^2 \\left( k_i (a_i^\\top u) + c_i (a_i^\\top u)^3 \\right) a_i - f.\n$$\n此模型仅用于为测试套件生成一致的 $(s_i, y_i)$ 向量对。您的程序必须实现：\n\n- 一个函数，给定最多 $m$ 个存储的向量对 $\\{(s_i, y_i)\\}$ 的列表、一个向量 $q$ 和一个定义了 $H_0 = \\gamma_k I$ 的初始标量 $ \\gamma_k > 0$，该函数使用标准的双循环递归计算 $r = H_k q$，而不显式构建 $H_k$。\n- 曲率筛选：跳过任何满足 $s_i^\\top y_i \\le \\delta$ 的向量对，其中 $\\delta = \\varepsilon \\|s_i\\| \\, \\|y_i\\|$ 且 $\\varepsilon = 10^{-12}$。\n- 初始缩放 $ \\gamma_k$ 的设置：如果至少有一个有效的存储向量对，则设为 $ \\gamma_k = \\dfrac{s_{k-1}^\\top y_{k-1}}{y_{k-1}^\\top y_{k-1}}$，否则设为 $ \\gamma_k = 1$。\n\n构建以下测试套件。所有量均为无量纲；无需物理单位。\n\n- 测试 $1$ (力学一致的向量对并将 $H_k$ 应用于当前梯度)：设 $k_1 = 10$, $k_2 = 5$, $c_1 = 1$, $c_2 = 0.5$, $f = [1,\\,0.2]^\\top$, $u_0 = [0,\\,0]^\\top$, $u_1 = [0.1,\\,-0.05]^\\top$, $u_2 = [0.18,\\,-0.06]^\\top$。计算 $j \\in \\{0,1,2\\}$ 的 $g(u_j)$，以及 $s_0 = u_1 - u_0$, $s_1 = u_2 - u_1$, $y_0 = g(u_1) - g(u_0)$, $y_1 = g(u_2) - g(u_1)$。在应用曲率筛选后，按时间顺序存储最近的 $m = 2$ 个向量对 $(s_0,y_0)$, $(s_1,y_1)$。设置 $q = g(u_2)$。使用如上定义的 $ \\gamma_k$ 通过双循环递归计算 $r^{(1)} = H_k q$。将 $r^{(1)}$ 的两个分量作为包含两个浮点数的列表返回。\n- 测试 $2$ (通用向量应用)：使用与测试 $1$ 中相同的存储向量对和相同的 $ \\gamma_k$，设置 $q = [1,\\,-1]^\\top$ 并计算 $r^{(2)} = H_k q$。将 $r^{(2)}$ 的两个分量作为包含两个浮点数的列表返回。\n- 测试 $3$ (空内存边界情况)：使用 $m = 0$ (无存储向量对)，$ \\gamma_k = 1$ 和 $q = [0.3,\\,-0.4]^\\top$。计算 $r^{(3)} = H_k q$。将 $r^{(3)}$ 的两个分量作为包含两个浮点数的列表返回。\n- 测试 $4$ (曲率筛选边界情况)：使用一个向量对 $s = [10^{-8},\\,0]^\\top$, $y = [-10^{-8},\\,0]^\\top$, $m = 1$, $q = [0.2,\\,0.5]^\\top$。由于 $s^\\top y \\le 0$，此向量对必须被筛选规则跳过；由于没有剩余的有效向量对，使用 $ \\gamma_k = 1$。计算 $r^{(4)} = H_k q$。将 $r^{(4)}$ 的两个分量作为包含两个浮点数的列表返回。\n- 测试 $5$ (下降属性检查)：使用测试 $1$ 中的有效向量对和 $ \\gamma_k$，设置 $q = g(u_2)$，计算 $p = - H_k q$，并返回语句 $q^\\top p  0$ 的布尔值。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[r^{(1)}, r^{(2)}, r^{(3)}, r^{(4)}, \\text{descent}]$，其中每个 $r^{(i)}$ (对于 $i \\in \\{1,2,3,4\\}$) 本身是一个包含两个浮点数的列表，而 $\\text{descent}$ 是一个布尔值。例如，一个有效的输出形状为 $[[x_1, x_2],[y_1, y_2],[z_1, z_2],[w_1, w_2],\\text{True}]$，其中实际计算出的数字将替换 $x_1$, $x_2$, $y_1$, $y_2$, $z_1$, $z_2$, $w_1$ 和 $w_2$。",
            "solution": "基本原理是，离散固体力学系统的平衡源于最小化势能 $\\phi(u)$，从而满足一阶条件 $g(u) = \\nabla \\phi(u) = 0$。求解 $g(u) = 0$ 的牛顿迭代来自泰勒展开 $g(u + \\Delta u) \\approx g(u) + K(u) \\Delta u$，其中 $K(u) = \\nabla^2 \\phi(u)$，因此 $K(u) \\Delta u = -g(u)$。在非线性有限元中，显式地组装和分解 $K(u)$ 的计算成本可能很高。拟牛顿法构建一个近似 $B_k \\approx K(u_k)$，使得割线条件 $B_{k+1} s_k = y_k$ 成立，其中 $s_k = u_{k+1} - u_k$ 且 $y_k = g_{k+1} - g_k$。Broyden–Fletcher–Goldfarb–Shanno 更新是一个经过充分测试的正定更新，定义为\n$$\nB_{k+1} = B_k - \\frac{B_k s_k s_k^\\top B_k}{s_k^\\top B_k s_k} + \\frac{y_k y_k^\\top}{s_k^\\top y_k},\n$$\n在曲率条件 $s_k^\\top y_k  0$ 下。其逆矩阵 $H_{k+1} = B_{k+1}^{-1}$ 可以通过以下方式更新\n$$\nH_{k+1} = \\left(I - \\rho_k s_k y_k^\\top\\right) H_k \\left(I - \\rho_k y_k s_k^\\top\\right) + \\rho_k s_k s_k^\\top, \\quad \\rho_k = \\frac{1}{y_k^\\top s_k},\n$$\n并且如果 $H_k$ 是正定的且 $s_k^\\top y_k  0$，则 $H_{k+1}$ 保持正定。正定性意味着对于任何非零向量 $q$，$q^\\top H_k q  0$，因此方向 $p_k = - H_k g_k$ 是一个严格下降方向，因为 $g_k^\\top p_k = - g_k^\\top H_k g_k  0$。\n\n内存受限版本避免了显式存储 $H_k$ 或 $B_k$。相反，它存储最近的 $m$ 个向量对 $\\{(s_i, y_i)\\}$，并通过双循环递归将 $H_k$ 应用于向量 $q$。按时间顺序标记向量对，其中 $i = 0$ 对应最旧的向量对，$i = \\ell - 1$ 对应最新的向量对，$\\ell \\le m$。计算 $r = H_k q$ 的双循环递归如下：\n1. 设置 $q_0 \\leftarrow q$。对于 $i = \\ell - 1, \\ell - 2, \\dots, 0$，计算 $\\rho_i = 1/(y_i^\\top s_i)$、$\\alpha_i = \\rho_i \\, s_i^\\top q_0$，并更新 $q_0 \\leftarrow q_0 - \\alpha_i y_i$。\n2. 选择初始近似 $H_0 = \\gamma_k I$，其中 $\\gamma_k$ 是一个正标量。一个标准且有效的缩放方法是 $\\gamma_k = \\dfrac{s_{\\ell-1}^\\top y_{\\ell-1}}{y_{\\ell-1}^\\top y_{\\ell-1}}$，使用最新的有效向量对；如果没有可用的向量对，则设置 $\\gamma_k = 1$。\n3. 设置 $r \\leftarrow H_0 q_0 = \\gamma_k q_0$。\n4. 对于 $i = 0, 1, \\dots, \\ell - 1$，计算 $\\rho_i = 1/(y_i^\\top s_i)$、$\\beta_i = \\rho_i \\, y_i^\\top r$，并更新 $r \\leftarrow r + s_i (\\alpha_i - \\beta_i)$。\n\n曲率条件 $s_i^\\top y_i  0$ 对于保持正定性至关重要。在有限精度计算中，我们强制执行一个筛选规则，以跳过任何曲率不够正的向量对。具体来说，对于一个小的容差 $\\varepsilon = 10^{-12}$，我们只接受满足 $s_i^\\top y_i  \\delta$ 的向量对 $(s_i, y_i)$，其中 $\\delta = \\varepsilon \\|s_i\\| \\, \\|y_i\\|$。被跳过的向量对会直接在双循环递归中被忽略。\n\n为了为测试套件生成力学一致的向量对，我们定义无量纲势能\n$$\n\\phi(u) = \\sum_{i=1}^2 \\left( \\tfrac{1}{2} k_i (a_i^\\top u)^2 + \\tfrac{1}{4} c_i (a_i^\\top u)^4 \\right) - f^\\top u,\n$$\n其中 $a_1 = [1,\\,0]^\\top$, $a_2 = [1,\\,1]^\\top$, $k = [k_1,\\,k_2]^\\top$, $c = [c_1,\\,c_2]^\\top$, 且 $f \\in \\mathbb{R}^2$。相应的梯度为\n$$\ng(u) = \\sum_{i=1}^2 \\left( k_i (a_i^\\top u) + c_i (a_i^\\top u)^3 \\right) a_i - f.\n$$\n对于测试 $1$，给定 $k_1 = 10$, $k_2 = 5$, $c_1 = 1$, $c_2 = 0.5$, $f = [1,\\,0.2]^\\top$，以及迭代点 $u_0 = [0,\\,0]^\\top$, $u_1 = [0.1,\\,-0.05]^\\top$, $u_2 = [0.18,\\,-0.06]^\\top$，我们为 $j \\in \\{0,1,2\\}$ 计算 $g(u_j)$，并构成 $s_0 = u_1 - u_0$, $s_1 = u_2 - u_1$, $y_0 = g(u_1) - g(u_0)$ 和 $y_1 = g(u_2) - g(u_1)$。在进行曲率筛选后，我们按时间顺序保留有效的向量对，设置 $\\gamma_k = \\dfrac{s_1^\\top y_1}{y_1^\\top y_1}$，令 $q = g(u_2)$，并运行双循环递归以获得 $r^{(1)} = H_k q$。测试 $2$ 重复相同的过程，但使用 $q = [1,\\,-1]^\\top$。测试 $3$ 使用 $m = 0$，因此 $H_k = I$，所以 $r^{(3)} = q$。测试 $4$ 通过提供一个 $s^\\top y \\le 0$ 的向量对来演示曲率筛选，该向量对被跳过，因此 $H_k = I$ 且 $r^{(4)} = q$。测试 $5$ 通过计算 $p = - H_k g(u_2)$ 并验证 $g(u_2)^\\top p  0$ 来检查下降属性，这必须成立，因为当所有包含的向量对都满足曲率要求时，双循环递归会产生一个正定的 $H_k$。\n\n从算法上讲，实现包括以下步骤：\n- 根据给定的 $\\phi(u)$ 实现 $g(u)$。\n- 计算 $u_0$, $u_1$, $u_2$、它们的梯度以及带筛选的向量对 $(s_i, y_i)$。\n- 按照规定实现带有初始缩放 $\\gamma_k$ 的 L-BFGS 双循环递归。\n- 执行四个向量应用和下降检查，并按要求的单行、括号括起的列表格式打印结果。\n\n这种设计是基于原理的：它从计算固体力学中的平衡条件和牛顿法开始，解释了拟牛顿近似和割线条件，详细说明了正定性和曲率条件，并最终实现了内存受限的双循环递归来计算 $H_k q$ 而无需显式矩阵。这些测试涵盖了力学一致的应用、通用向量应用、无内存时的边界行为、曲率筛选下的鲁棒性以及基本的下降属性。",
            "answer": "[[-0.02000523214580327,0.011270271630130986],[0.1813134316715694,-0.22818783492728956],[0.3,-0.4],[0.2,0.5],True]"
        }
    ]
}