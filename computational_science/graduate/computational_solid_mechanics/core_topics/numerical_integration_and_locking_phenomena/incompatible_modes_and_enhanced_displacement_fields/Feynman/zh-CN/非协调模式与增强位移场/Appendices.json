{
    "hands_on_practices": [
        {
            "introduction": "非协调模式若要有效，就必须不能引入虚假的刚度或破坏单元的一致性。为了满足这些要求，它们必须在单元边界上为零，并且与刚体运动正交。本练习将通过一个具体的例子，让你亲手分析并证明一个精心设计的多项式模式函数是如何满足这些关键的数学特性的，从而加深对非协调模式理论基础的理解。",
            "id": "3573667",
            "problem": "考虑在小应变线性弹性分析的有限元法 (FEM) 中使用的一个$4$节点等参双线性四边形单元 ($Q4$)。为了增强单元的弯曲性能，同时保持与虚功原理的一致性，在标准双线性位移插值的基础上增加了一个内部（单元级）不协调位移场。为防止与刚体运动产生伪耦合以及避免单元间不协调，该增强位移场必须在整个单元边界上为零，并在参考单元上与所有刚体运动$L^{2}$正交。\n\n设参考域为 $\\Omega = [-1,1] \\times [-1,1]$，局部坐标为 $(\\xi,\\eta)$。使用反映 $\\xi(1-\\eta^{2})$ 和 $\\eta(1-\\xi^{2})$ 结构的多项式项来定义向量值的增强位移模式（不协调模式），并再乘以单元边界泡状函数以确保其在 $\\partial\\Omega$ 上为零：\n$$\n\\widetilde{\\mathbf{u}}(\\xi,\\eta) \\;=\\; c\n\\begin{pmatrix}\n\\xi\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\\\\n\\eta\\,(1-\\xi^{2})\\,(1-\\eta^{2})\n\\end{pmatrix},\n$$\n其中 $c>0$ 是一个待确定的标量归一化常数。\n\n使用在 $\\Omega$ 上定义的 $L^{2}$ 内积\n$$\n\\langle \\mathbf{a},\\mathbf{b}\\rangle \\;=\\; \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{a}(\\xi,\\eta)\\cdot\\mathbf{b}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta.\n$$\n设 $\\Omega$ 上的刚体运动由常数平移 $\\mathbf{t}_{x} = (1,0)^{\\mathsf{T}}$、$\\mathbf{t}_{y} = (0,1)^{\\mathsf{T}}$ 和绕原点的面内旋转 $\\mathbf{r}(\\xi,\\eta) = (-\\eta,\\xi)^{\\mathsf{T}}$ 表示。\n\n仅从这些定义以及不协调模式在刚体运动下不产生伪能量的要求出发，完成以下任务：\n\n$1.$ 证明 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 在整个边界 $\\partial\\Omega$ 上为零。\n\n$2.$ 证明正交性条件\n$$\n\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle \\;=\\; \\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle \\;=\\; \\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle \\;=\\; 0\n$$\n成立。\n\n$3.$ 确定唯一的正常数归一化因子 $c$，使得增强模式具有单位 $L^{2}$ 范数，\n$$\n\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)} \\;=\\; \\left(\\int_{-1}^{1}\\int_{-1}^{1} \\|\\widetilde{\\mathbf{u}}(\\xi,\\eta)\\|^{2}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\\right)^{1/2} \\;=\\; 1.\n$$\n\n您的最终答案必须是 $c$ 的精确闭式表达式（无单位，不进行四舍五入）。",
            "solution": "在给出解答之前，首先对问题进行验证。\n\n### 第 1 步：提取已知条件\n-   单元类型：用于小应变线性弹性分析的$4$节点等参双线性四边形单元 ($Q4$)。\n-   参考域：$\\Omega = [-1,1] \\times [-1,1]$，局部坐标为 $(\\xi,\\eta)$。\n-   不协调位移模式：$\\widetilde{\\mathbf{u}}(\\xi,\\eta) \\;=\\; c \\begin{pmatrix} \\xi\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\\\ \\eta\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\end{pmatrix}$，其中 $c>0$ 为标量归一化常数。\n-   $L^{2}$ 内积：$\\langle \\mathbf{a},\\mathbf{b}\\rangle \\;=\\; \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{a}(\\xi,\\eta)\\cdot\\mathbf{b}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。\n-   刚体运动：\n    -   $x$ 方向平移：$\\mathbf{t}_{x} = (1,0)^{\\mathsf{T}}$\n    -   $y$ 方向平移：$\\mathbf{t}_{y} = (0,1)^{\\mathsf{T}}$\n    -   面内旋转：$\\mathbf{r}(\\xi,\\eta) = (-\\eta,\\xi)^{\\mathsf{T}}$\n-   任务：\n    1.  证明 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 在整个边界 $\\partial\\Omega$ 上为零。\n    2.  证明正交性条件 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle \\;=\\; 0$，$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle \\;=\\; 0$ 和 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle \\;=\\; 0$ 成立。\n    3.  确定唯一的正常数 $c$ 使得 $\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)} \\;=\\; 1$。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题在计算固体力学领域，特别是在有限元法中，具有坚实的科学基础。不协调模式（或增强假设应变）的概念及其所需性质（在边界上为零，与刚体运动正交）是为避免闭锁现象而开发稳健有限元的完善原理。该问题是适定的，提供了所有必要的数学定义。语言客观而精确。问题是自洽、一致的，并且要求一系列明确的数学证明和一次计算，所有这些都是可验证的。未发现任何缺陷。\n\n### 第 3 步：结论与行动\n该问题有效。将提供完整解答。\n\n***\n\n### 解答\n\n该问题要求证明给定的不协调位移模式 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 的某些性质，并计算其归一化常数 $c$。我们将按指定顺序处理这些任务。\n\n**1. 证明在边界上为零**\n\n不协调位移场由下式给出：\n$$\n\\widetilde{\\mathbf{u}}(\\xi,\\eta) = c\n\\begin{pmatrix}\n\\xi\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\\\\n\\eta\\,(1-\\xi^{2})\\,(1-\\eta^{2})\n\\end{pmatrix}\n$$\n参考域是正方形 $\\Omega = [-1,1] \\times [-1,1]$。其边界 $\\partial\\Omega$ 由四条边组成：\n-   $\\xi = 1$ 且 $\\eta \\in [-1,1]$ 的线段。\n-   $\\xi = -1$ 且 $\\eta \\in [-1,1]$ 的线段。\n-   $\\eta = 1$ 且 $\\xi \\in [-1,1]$ 的线段。\n-   $\\eta = -1$ 且 $\\xi \\in [-1,1]$ 的线段。\n\n任何点 $(\\xi,\\eta) \\in \\partial\\Omega$ 都必须满足 $|\\xi| = 1$ 或 $|\\eta| = 1$。\n\n让我们检查 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 两个分量中的公因子 $(1-\\xi^{2})(1-\\eta^{2})$。\n-   如果一个点位于 $|\\xi|=1$ 的边界上，则 $(1-\\xi^{2})$ 项变为 $(1 - (\\pm 1)^{2}) = 1-1=0$。这使得整个乘积 $(1-\\xi^{2})(1-\\eta^{2})$ 等于 $0$。\n-   如果一个点位于 $|\\eta|=1$ 的边界上，则 $(1-\\eta^{2})$ 项变为 $(1 - (\\pm 1)^{2}) = 1-1=0$。这也使得整个乘积 $(1-\\xi^{2})(1-\\eta^{2})$ 等于 $0$。\n\n由于对于 $\\partial\\Omega$ 上的任何点，这些条件中至少有一个成立，所以因子 $(1-\\xi^{2})(1-\\eta^{2})$ 对于所有 $(\\xi,\\eta) \\in \\partial\\Omega$ 恒等于零。因此，$\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 的两个分量在边界上都为零。\n$$\n\\widetilde{\\mathbf{u}}(\\xi,\\eta) = \\mathbf{0} \\quad \\forall (\\xi,\\eta) \\in \\partial\\Omega\n$$\n证明完毕。\n\n**2. 证明与刚体运动的正交性**\n\n我们必须证明 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = 0$，$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle = 0$ 和 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle = 0$。\n\n-   **与 $\\mathbf{t}_{x}$ 的正交性：**\n    内积为 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = \\int_{-1}^{1}\\int_{-1}^{1} \\widetilde{\\mathbf{u}}(\\xi,\\eta) \\cdot \\mathbf{t}_{x} \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。点积为：\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{t}_{x} = c \\begin{pmatrix} \\xi(1-\\xi^2)(1-\\eta^2) \\\\ \\eta(1-\\xi^2)(1-\\eta^2) \\end{pmatrix} \\cdot \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = c \\xi(1-\\xi^2)(1-\\eta^2)\n    $$\n    积分为：\n    $$\n    \\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = c \\int_{-1}^{1}\\int_{-1}^{1} \\xi(1-\\xi^2)(1-\\eta^2) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = c \\left( \\int_{-1}^{1} \\xi(1-\\xi^2)\\,\\mathrm{d}\\xi \\right) \\left( \\int_{-1}^{1} (1-\\eta^2)\\,\\mathrm{d}\\eta \\right)\n    $$\n    第一个积分的被积函数 $f(\\xi) = \\xi - \\xi^3$ 是一个奇函数，因为 $f(-\\xi) = (-\\xi) - (-\\xi)^3 = -\\xi + \\xi^3 = -f(\\xi)$。奇函数在对称区间 $[-1,1]$ 上的积分为零。\n    $$\n    \\int_{-1}^{1} \\xi(1-\\xi^2)\\,\\mathrm{d}\\xi = 0\n    $$\n    因此，$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = c \\cdot 0 \\cdot \\left( \\int_{-1}^{1} (1-\\eta^2)\\,\\mathrm{d}\\eta \\right) = 0$。\n\n-   **与 $\\mathbf{t}_{y}$ 的正交性：**\n    类似地，点积为：\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{t}_{y} = c \\begin{pmatrix} \\xi(1-\\xi^2)(1-\\eta^2) \\\\ \\eta(1-\\xi^2)(1-\\eta^2) \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = c \\eta(1-\\xi^2)(1-\\eta^2)\n    $$\n    积分为：\n    $$\n    \\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle = c \\int_{-1}^{1}\\int_{-1}^{1} \\eta(1-\\xi^2)(1-\\eta^2) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = c \\left( \\int_{-1}^{1} (1-\\xi^2)\\,\\mathrm{d}\\xi \\right) \\left( \\int_{-1}^{1} \\eta(1-\\eta^2)\\,\\mathrm{d}\\eta \\right)\n    $$\n    第二个积分的被积函数 $g(\\eta) = \\eta - \\eta^3$ 是一个奇函数。因此，其在 $[-1,1]$ 上的积分为零。\n    $$\n    \\int_{-1}^{1} \\eta(1-\\eta^2)\\,\\mathrm{d}\\eta = 0\n    $$\n    因此，$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle = 0$。\n\n-   **与 $\\mathbf{r}$ 的正交性：**\n    与旋转模式 $\\mathbf{r}(\\xi,\\eta) = (-\\eta, \\xi)^{\\mathsf{T}}$ 的点积为：\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{r} = c \\begin{pmatrix} \\xi(1-\\xi^2)(1-\\eta^2) \\\\ \\eta(1-\\xi^2)(1-\\eta^2) \\end{pmatrix} \\cdot \\begin{pmatrix} -\\eta \\\\ \\xi \\end{pmatrix}\n    $$\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{r} = c \\left( -\\eta\\xi(1-\\xi^2)(1-\\eta^2) + \\xi\\eta(1-\\xi^2)(1-\\eta^2) \\right) = 0\n    $$\n    由于被积函数在域 $\\Omega$ 中处处恒等于零，所以积分为零。\n    $$\n    \\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle = \\int_{-1}^{1}\\int_{-1}^{1} 0 \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = 0\n    $$\n    正交性证明完毕。\n\n**3. 确定归一化常数 $c$**\n\n归一化条件为 $\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)} = 1$，这等价于 $\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)}^{2} = 1$。\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} \\|\\widetilde{\\mathbf{u}}(\\xi,\\eta)\\|^{2}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = 1\n$$\n首先，计算向量 $\\widetilde{\\mathbf{u}}$ 的欧几里得范数的平方：\n$$\n\\|\\widetilde{\\mathbf{u}}\\|^{2} = \\left(c\\xi(1-\\xi^2)(1-\\eta^2)\\right)^2 + \\left(c\\eta(1-\\xi^2)(1-\\eta^2)\\right)^2\n$$\n$$\n\\|\\widetilde{\\mathbf{u}}\\|^{2} = c^2\\xi^2(1-\\xi^2)^2(1-\\eta^2)^2 + c^2\\eta^2(1-\\xi^2)^2(1-\\eta^2)^2\n$$\n$$\n\\|\\widetilde{\\mathbf{u}}\\|^{2} = c^2(\\xi^2 + \\eta^2)(1-\\xi^2)^2(1-\\eta^2)^2\n$$\n现在，我们将此表达式在域 $\\Omega$ 上积分：\n$$\n1 = c^2 \\int_{-1}^{1}\\int_{-1}^{1} (\\xi^2 + \\eta^2)(1-\\xi^2)^2(1-\\eta^2)^2 \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n$$\n我们可以将该积分分成两部分：\n$$\n\\frac{1}{c^2} = \\int_{-1}^{1}\\int_{-1}^{1} \\xi^2(1-\\xi^2)^2(1-\\eta^2)^2\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta + \\int_{-1}^{1}\\int_{-1}^{1} \\eta^2(1-\\xi^2)^2(1-\\eta^2)^2\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n$$\n这两个积分可以分解为一维积分的乘积：\n$$\n\\frac{1}{c^2} = \\left( \\int_{-1}^{1} \\xi^2(1-\\xi^2)^2\\,\\mathrm{d}\\xi \\right)\\left( \\int_{-1}^{1} (1-\\eta^2)^2\\,\\mathrm{d}\\eta \\right) + \\left( \\int_{-1}^{1} (1-\\xi^2)^2\\,\\mathrm{d}\\xi \\right)\\left( \\int_{-1}^{1} \\eta^2(1-\\eta^2)^2\\,\\mathrm{d}\\eta \\right)\n$$\n让我们定义两个辅助积分，注意被积函数是偶函数：\n$$\nJ_1 = \\int_{-1}^{1} (1-x^2)^2\\,\\mathrm{d}x = \\int_{-1}^{1} (1 - 2x^2 + x^4)\\,\\mathrm{d}x = 2 \\left[ x - \\frac{2}{3}x^3 + \\frac{1}{5}x^5 \\right]_0^1 = 2\\left(1 - \\frac{2}{3} + \\frac{1}{5}\\right) = 2\\left(\\frac{15-10+3}{15}\\right) = \\frac{16}{15}\n$$\n$$\nJ_2 = \\int_{-1}^{1} x^2(1-x^2)^2\\,\\mathrm{d}x = \\int_{-1}^{1} (x^2 - 2x^4 + x^6)\\,\\mathrm{d}x = 2 \\left[ \\frac{1}{3}x^3 - \\frac{2}{5}x^5 + \\frac{1}{7}x^7 \\right]_0^1 = 2\\left(\\frac{1}{3} - \\frac{2}{5} + \\frac{1}{7}\\right) = 2\\left(\\frac{35-42+15}{105}\\right) = \\frac{16}{105}\n$$\n将这些结果代回关于 $c$ 的方程中：\n$$\n\\frac{1}{c^2} = (J_2)(J_1) + (J_1)(J_2) = 2 J_1 J_2\n$$\n$$\n\\frac{1}{c^2} = 2 \\left( \\frac{16}{15} \\right) \\left( \\frac{16}{105} \\right) = \\frac{2 \\cdot 256}{15 \\cdot 105} = \\frac{512}{1575}\n$$\n解出 $c^2$：\n$$\nc^2 = \\frac{1575}{512}\n$$\n由于题目规定 $c>0$，我们取正平方根：\n$$\nc = \\sqrt{\\frac{1575}{512}}\n$$\n为了化简表达式，我们找到质因数：\n$1575 = 3^2 \\cdot 5^2 \\cdot 7 = 225 \\cdot 7$\n$512 = 2^9 = 256 \\cdot 2$\n$$\nc = \\sqrt{\\frac{225 \\cdot 7}{256 \\cdot 2}} = \\frac{\\sqrt{225}\\sqrt{7}}{\\sqrt{256}\\sqrt{2}} = \\frac{15\\sqrt{7}}{16\\sqrt{2}}\n$$\n对分母进行有理化：\n$$\nc = \\frac{15\\sqrt{7}}{16\\sqrt{2}} \\cdot \\frac{\\sqrt{2}}{\\sqrt{2}} = \\frac{15\\sqrt{14}}{16 \\cdot 2} = \\frac{15\\sqrt{14}}{32}\n$$\n这就是归一化常数 $c$ 的最终表达式。",
            "answer": "$$\\boxed{\\frac{15\\sqrt{14}}{32}}$$"
        },
        {
            "introduction": "“单元检验” (Patch Test) 是检验有限元方法收敛性的基本基准。一个合格的单元必须能够精确地再现常应变状态，这是保证计算结果可靠性的前提。本编程练习将指导你实现一个增强假设应变 (Enhanced Assumed Strain, EAS) 单元，并通过数值方法验证它能够成功通过单元检验，从而确认其一致性。",
            "id": "3573610",
            "problem": "设计并实现一个程序，在小应变线弹性力学中，通过测试当节点位移对应于精确的线性位移场时，增强参数是否携带零能量，来数值验证一个增强假设应变 (EAS) 四边形单元的线性完备性。该检验必须针对一组指定的测试用例进行。\n\n从以下基本原理开始：\n- 在小应变线弹性力学中，对称应变张量由 $ \\boldsymbol{\\varepsilon} = \\frac{1}{2}\\left( \\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{T} \\right) $ 给出，柯西应力满足线性本构定律 $ \\boldsymbol{\\sigma} = \\mathbf{C} \\, \\boldsymbol{\\varepsilon} $，其中 $ \\mathbf{C} $ 是四阶弹性张量，以 Voigt 形式表示为对称正定矩阵。\n- 对于一个在平面应变条件下的各向同性材料的二维问题，定义 $ E $ (杨氏模量，单位为帕斯卡) 和 $ \\nu $ (泊松比，无量纲)，并使用拉梅常数 $ \\lambda = \\dfrac{E \\nu}{(1+\\nu)(1-2\\nu)} $ 和 $ \\mu = \\dfrac{E}{2(1+\\nu)} $ 来构建 Voigt 记法下的材料矩阵 $ \\mathbf{C} \\in \\mathbb{R}^{3\\times 3} $，如下所示\n$$\n\\mathbf{C} = \\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2 \\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix}.\n$$\n- 在增强假设应变格式中，总应变分解为 $ \\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^{c} + \\boldsymbol{\\varepsilon}^{E} $，其中 $ \\boldsymbol{\\varepsilon}^{c} $ 是从位移插值中获得的协调应变，$ \\boldsymbol{\\varepsilon}^{E} = \\mathbf{G}(\\xi,\\eta) \\, \\boldsymbol{\\alpha} $ 是带有内部参数 $ \\boldsymbol{\\alpha} $ 的增强应变。对于一个静态势能，关于 $ \\boldsymbol{\\alpha} $ 的一阶变分得到单元级的线性系统\n$$\n\\mathbf{H}\\, \\boldsymbol{\\alpha} + \\mathbf{q} = \\mathbf{0}, \\quad \\text{其中} \\quad\n\\mathbf{H} = \\int_{\\Omega_e} \\mathbf{G}^{T} \\mathbf{C} \\, \\mathbf{G} \\, \\mathrm{d}\\Omega, \\quad\n\\mathbf{q} = \\int_{\\Omega_e} \\mathbf{G}^{T} \\mathbf{C} \\, \\boldsymbol{\\varepsilon}^{c} \\, \\mathrm{d}\\Omega.\n$$\n- 对于物理坐标系中的线性位移场 $ u(x,y) = a x + b y $ 和 $ v(x,y) = c x + d y $，协调应变在单元内是空间常数，且等于\n$$\n\\boldsymbol{\\varepsilon}^{c} = \\begin{bmatrix}\n\\varepsilon_{xx} \\\\\n\\varepsilon_{yy} \\\\\n\\gamma_{xy}\n\\end{bmatrix} = \\begin{bmatrix}\na \\\\\nd \\\\\nb + c\n\\end{bmatrix}.\n$$\n- 选择一个通过构造使其与常协调应变正交的增强应变拟设。具体来说，在参考正方形 $ (\\xi,\\eta)\\in[-1,1]\\times[-1,1] $ 上定义一个标量气泡函数为 $ b(\\xi,\\eta) = (1-\\xi^{2})(1-\\eta^{2}) $。通过设置\n$$\n\\psi(\\xi,\\eta) = b(\\xi,\\eta) - \\overline{b}, \\quad \\text{其中} \\quad \\overline{b} = \\dfrac{\\int_{-1}^{1}\\int_{-1}^{1} b(\\xi,\\eta)\\, J(\\xi,\\eta)\\, \\mathrm{d}\\xi \\mathrm{d}\\eta}{\\int_{-1}^{1}\\int_{-1}^{1} J(\\xi,\\eta)\\, \\mathrm{d}\\xi \\mathrm{d}\\eta},\n$$\n来构造一个关于物理测度的零均值函数，其中 $ J(\\xi,\\eta) = \\det \\mathbf{J}(\\xi,\\eta) $ 是从参考正方形到物理四边形 $ \\Omega_e $ 的等参双线性映射的雅可比行列式。将增强应变矩阵定义为\n$$\n\\mathbf{G}(\\xi,\\eta) = \\psi(\\xi,\\eta) \\, \\mathbf{I}_{3},\n$$\n因此 $ \\boldsymbol{\\varepsilon}^{E} = \\psi(\\xi,\\eta)\\, \\boldsymbol{\\alpha} $，其中 $ \\boldsymbol{\\alpha} \\in \\mathbb{R}^{3} $。这种选择保证了对于任何常协调应变 $ \\boldsymbol{\\varepsilon}^{c} $，都有 $ \\int_{\\Omega_e} \\mathbf{G} \\, \\mathrm{d}\\Omega = \\mathbf{0} $，因此 $ \\mathbf{q} = \\mathbf{0} $。\n\n你的任务是实现一个程序，该程序：\n- 使用参考正方形 $ \\left[-1,1\\right]\\times\\left[-1,1\\right] $ 上的等参双线性形函数，映射到一个凸物理四边形单元，其节点按逆时针顺序给出。\n- 使用每个方向上 $ n = 5 $ 阶（即 $ 5\\times 5 $ 个点）的张量积 Gauss–Legendre 求积法计算加权平均值 $ \\overline{b} $，并相应地构造 $ \\psi(\\xi,\\eta) $。\n- 使用相同的求积方法数值组装 $ \\mathbf{H} $ 和 $ \\mathbf{q} $，并从 $ \\mathbf{H}\\boldsymbol{\\alpha} + \\mathbf{q} = \\mathbf{0} $ 中求解 $ \\boldsymbol{\\alpha} $。\n- 计算增强能量\n$$\n\\mathcal{E}_{E} = \\dfrac{1}{2}\\, \\boldsymbol{\\alpha}^{T} \\mathbf{H}\\, \\boldsymbol{\\alpha}.\n$$\n- 如果 $ \\mathcal{E}_{E} $ 相对于由单元面积和协调应变能密度设定的一个尺度在数值上是可忽略的，则声明测试通过。使用四边形的面积 $ A_e $ 和能量密度尺度 $ \\frac{1}{2}\\, \\boldsymbol{\\varepsilon}^{c\\,T} \\mathbf{C} \\boldsymbol{\\varepsilon}^{c} $。将容差定义为\n$$\n\\mathrm{tol} = \\max\\!\\left(10^{-12},\\, 10^{-12} \\times \\dfrac{1}{2}\\, A_e\\, \\boldsymbol{\\varepsilon}^{c\\,T} \\mathbf{C} \\boldsymbol{\\varepsilon}^{c}\\right),\n$$\n并报告布尔值 $ \\left| \\mathcal{E}_{E} \\right| \\le \\mathrm{tol} $。\n\n假设为平面应变，各向同性材料属性 $ E $ 和 $ \\nu $ 对所有情况通用，其中 $ E = 210\\times 10^{9} $ (帕斯卡) 且 $ \\nu = 0.3 $ (无量纲)。所有非无量纲的物理量必须采用国际单位制 (SI)。不涉及角度，也不需要百分比量。\n\n等参双线性映射使用标准形函数\n$$\n\\begin{aligned}\nN_{1}(\\xi,\\eta) &= \\tfrac{1}{4}(1-\\xi)(1-\\eta), \\quad\nN_{2}(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1-\\eta),\\\\\nN_{3}(\\xi,\\eta) &= \\tfrac{1}{4}(1+\\xi)(1+\\eta), \\quad\nN_{4}(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1+\\eta).\n\\end{aligned}\n$$\n\n对于每个测试用例，施加与在节点坐标 $ (x_i,y_i) $ 处计算的线性位移场 $ u(x,y)=a x + b y $ 和 $ v(x,y)=c x + d y $ 一致的节点位移。虽然对于此场，$ \\boldsymbol{\\varepsilon}^{c} $ 的计算与节点插值无关，但构造节点值可以确保测试遵循施加线性分片检验的协议。\n\n测试套件：\n- 案例 1：节点 $ (0,0),(1,0),(1,1),(0,1) $，参数 $ a=1, b=2, c=3, d=4 $。\n- 案例 2：节点 $ (1,1),(3,1),(3,2.5),(1,2.5) $，参数 $ a=0.5, b=-1.2, c=2.3, d=0.7 $。\n- 案例 3：节点 $ (0,0),(2,0.2),(2.2,1.8),(0.1,1.6) $，参数 $ a=-1.0, b=0.3, c=0.0, d=1.5 $。\n- 案例 4：节点 $ (0,0),(1,0),(1.0,0.05),(0.0,0.05) $，参数 $ a=10.0, b=-5.0, c=4.0, d=-2.0 $。\n- 案例 5：节点 $ (0,0),(2,0),(2.5,1.0),(-0.1,1.2) $，参数 $ a=0, b=0, c=0, d=0 $。\n\n你的程序必须为每个案例计算布尔测试结果，该结果指示 $ \\mathcal{E}_{E} $ 是否低于指定的容差，并生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $ [\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4},\\mathrm{result5}] $，其中每个条目为 $ \\mathrm{True} $ 或 $ \\mathrm{False} $。",
            "solution": "用户要求设计并实现一个程序，用以数值验证一个特定的增强假设应变 (EAS) 四边形单元的线性完备性。此验证是计算力学中分片检验 (patch test) 的基石，确保单元格式能够精确再现恒定应变状态，这是收敛的必要条件。该问题在科学上是有效的且是适定的 (well-posed)，为完整的解决方案提供了所有必要的理论基础和数值数据。\n\n验证过程包括以下结构化步骤：\n\n1.  **定义材料和几何属性**：对于每个测试用例，我们通过等参映射建立材料本构模型和单元的几何形状。\n2.  **构造增强应变场**：我们基于零均值函数定义增强应变场，这是确保与恒定应变场正交性的关键步骤。\n3.  **组装和求解 EAS 系统**：我们数值组装控制增强参数的矩阵，并求解这些参数。\n4.  **评估能量并验证**：我们计算来自增强应变场的能量贡献，并检查其是否如理论预测的那样在数值上可忽略。\n\n### 步骤 1：材料和几何公式\n\n分析在二维平面应变条件下，使用线性各向同性弹性材料进行。材料行为由四阶弹性张量描述，该张量在 Voigt 记法中表示为一个 $3 \\times 3$ 的矩阵 $ \\mathbf{C} $。给定杨氏模量 $ E $ 和泊松比 $ \\nu $，我们首先计算拉梅常数 $ \\lambda $ 和 $ \\mu $：\n$$\n\\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)}, \\quad \\mu = \\frac{E}{2(1+\\nu)}\n$$\n那么平面应变本构矩阵为：\n$$\n\\mathbf{C} = \\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2 \\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix}\n$$\n单元的几何形状由从母参考正方形 $ (\\xi, \\eta) \\in [-1, 1] \\times [-1, 1] $ 到 $ (x, y) $ 平面中物理四边形的等参映射定义。映射由下式给出：\n$$\n\\mathbf{x}(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) \\mathbf{x}_i,\n$$\n其中 $ \\mathbf{x}_i = (x_i, y_i) $ 是节点坐标，$ N_i $ 是标准的双线性形函数。变换的局部行为由雅可比矩阵 $ \\mathbf{J} $ 捕捉：\n$$\n\\mathbf{J}(\\xi, \\eta) = \\frac{\\partial(x, y)}{\\partial(\\xi, \\eta)} = \\begin{bmatrix} \\partial x / \\partial \\xi & \\partial y / \\partial \\xi \\\\ \\partial x / \\partial \\eta & \\partial y / \\partial \\eta \\end{bmatrix} = \\begin{bmatrix}\n\\sum \\frac{\\partial N_i}{\\partial \\xi} x_i & \\sum \\frac{\\partial N_i}{\\partial \\xi} y_i \\\\\n\\sum \\frac{\\partial N_i}{\\partial \\eta} x_i & \\sum \\frac{\\partial N_i}{\\partial \\eta} y_i\n\\end{bmatrix}\n$$\n微分面积元变换为 $ \\mathrm{d}\\Omega = J(\\xi, \\eta) \\mathrm{d}\\xi \\mathrm{d}\\eta $，其中 $ J(\\xi, \\eta) = \\det(\\mathbf{J}) $ 是雅可比行列式。在物理单元域 $ \\Omega_e $ 上的所有积分都是在参考正方形上使用 $ 5 \\times 5 $ 张量积 Gauss-Legendre 求积法则进行数值计算的。\n\n### 步骤 2：构造增强应变场\n\n在 EAS 方法中，应变张量被加性分解为一个协调部分 $ \\boldsymbol{\\varepsilon}^c $（源自节点位移）和一个增强部分 $ \\boldsymbol{\\varepsilon}^E $。通过分片检验的一个关键属性是，对于线性位移场，增强应变场必须携带零能量。这可以通过构造一个与常协调应变正交的增强插值来实现。\n\n线性位移场 $ u(x,y) = ax+by $, $ v(x,y) = cx+dy $ 导致一个空间上恒定的协调应变场：\n$$\n\\boldsymbol{\\varepsilon}^{c} = \\begin{bmatrix} a \\\\ d \\\\ b+c \\end{bmatrix}.\n$$\n增强应变场被定义为 $ \\boldsymbol{\\varepsilon}^E = \\mathbf{G}(\\xi, \\eta) \\boldsymbol{\\alpha} $，其中 $ \\boldsymbol{\\alpha} \\in \\mathbb{R}^3 $ 是内部参数。所选的插值矩阵为 $ \\mathbf{G}(\\xi, \\eta) = \\psi(\\xi, \\eta) \\mathbf{I}_3 $，其中 $ \\mathbf{I}_3 $ 是 $ 3 \\times 3 $ 的单位矩阵，而 $ \\psi(\\xi, \\eta) $ 是一个设计为在单元域上与常数正交的标量函数。我们通过从气泡函数 $ b(\\xi, \\eta) = (1-\\xi^2)(1-\\eta^2) $ 中减去其加权平均值 $ \\overline{b} $ 来构造 $ \\psi $：\n$$\n\\psi(\\xi, \\eta) = b(\\xi, \\eta) - \\overline{b}, \\quad \\text{其中} \\quad \\overline{b} = \\frac{\\int_{\\Omega_e} b(\\xi, \\eta) \\mathrm{d}\\Omega}{\\int_{\\Omega_e} 1 \\mathrm{d}\\Omega} = \\frac{\\int_{-1}^{1}\\int_{-1}^{1} b(\\xi, \\eta) J(\\xi, \\eta) \\mathrm{d}\\xi \\mathrm{d}\\eta}{\\int_{-1}^{1}\\int_{-1}^{1} J(\\xi, \\eta) \\mathrm{d}\\xi \\mathrm{d}\\eta}.\n$$\n这个构造保证了 $ \\int_{\\Omega_e} \\psi(\\xi, \\eta) \\mathrm{d}\\Omega = 0 $，这是一个至关重要的属性。\n\n### 步骤 3：EAS 系统的组装和求解\n\n内部参数 $ \\boldsymbol{\\alpha} $ 通过求解局部系统 $ \\mathbf{H} \\boldsymbol{\\alpha} + \\mathbf{q} = \\mathbf{0} $ 来确定，该系统源于势能相对于 $ \\boldsymbol{\\alpha} $ 的驻定性。矩阵 $ \\mathbf{H} $ 和向量 $ \\mathbf{q} $ 由下式给出：\n$$\n\\mathbf{H} = \\int_{\\Omega_e} \\mathbf{G}^{T} \\mathbf{C} \\mathbf{G} \\, \\mathrm{d}\\Omega = \\int_{-1}^{1}\\int_{-1}^{1} \\psi^2(\\xi, \\eta) \\mathbf{C} \\, J(\\xi, \\eta) \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n$$\n\\mathbf{q} = \\int_{\\Omega_e} \\mathbf{G}^{T} \\mathbf{C} \\boldsymbol{\\varepsilon}^c \\, \\mathrm{d}\\Omega = \\int_{-1}^{1}\\int_{-1}^{1} \\psi(\\xi, \\eta) (\\mathbf{C} \\boldsymbol{\\varepsilon}^c) \\, J(\\xi, \\eta) \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n由于 $ \\boldsymbol{\\varepsilon}^c $ 和 $ \\mathbf{C} $ 是常数，向量 $ \\mathbf{C} \\boldsymbol{\\varepsilon}^c $ 可以从 $ \\mathbf{q} $ 的积分中提出来。由于 $ \\psi $ 的构造，剩余的积分 $ \\int \\psi J \\mathrm{d}\\xi\\mathrm{d}\\eta $ 为零。因此，理论预测 $ \\mathbf{q} = \\mathbf{0} $。系统简化为 $ \\mathbf{H} \\boldsymbol{\\alpha} = \\mathbf{0} $。由于 $ \\mathbf{C} $ 是正定的且 $ \\psi^2 \\ge 0 $，$ \\mathbf{H} $ 也是对称正定的（对于任何非退化单元）。因此，唯一的解是 $ \\boldsymbol{\\alpha} = \\mathbf{0} $。\n\n### 步骤 4：通过能量计算进行验证\n\n目标是数值验证 $ \\boldsymbol{\\alpha} $ 确实为零（在数值精度范围内）。我们通过计算与增强应变场相关的能量来实现这一点：\n$$\n\\mathcal{E}_{E} = \\frac{1}{2} \\boldsymbol{\\alpha}^{T} \\mathbf{H} \\boldsymbol{\\alpha}\n$$\n理论上，$ \\mathcal{E}_E $ 必须为零。由于浮点运算和数值求积，计算出的 $ \\mathbf{q} $ 会非常接近于零，但不会精确为零。这导致一个非零但非常小的 $ \\boldsymbol{\\alpha} $，从而得到一个很小的 $ \\mathcal{E}_E $。如果这个能量可以忽略不计，则认为测试通过。此项检查的容差是相对于单元中的协调应变能 $ \\mathcal{E}_c = \\frac{1}{2} A_e \\boldsymbol{\\varepsilon}^{c\\,T} \\mathbf{C} \\boldsymbol{\\varepsilon}^c $ 定义的，其中 $ A_e $ 是单元面积。如果 $ |\\mathcal{E}_E| \\le \\mathrm{tol} $，则测试通过，其中：\n$$\n\\mathrm{tol} = \\max\\left(10^{-12}, 10^{-12} \\times \\mathcal{E}_c\\right)\n$$\n这个相对容差处理了不同应变大小的情况，而 $ 10^{-12} $ 的绝对下限则处理了零应变的情况。\n\n实现过程是通过循环遍历每个测试用例，执行这些数值积分和矩阵运算，并评估最终的布尔条件。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the verification for all test cases.\n    \"\"\"\n    \n    # Global material parameters: E in Pascals, nu is dimensionless.\n    E = 210e9\n    nu = 0.3\n\n    # Prescribed test cases: (Nodal coordinates, displacement field parameters)\n    test_cases = [\n        {'nodes': np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n         'params': {'a': 1.0, 'b': 2.0, 'c': 3.0, 'd': 4.0}},\n        {'nodes': np.array([[1.0, 1.0], [3.0, 1.0], [3.0, 2.5], [1.0, 2.5]]),\n         'params': {'a': 0.5, 'b': -1.2, 'c': 2.3, 'd': 0.7}},\n        {'nodes': np.array([[0.0, 0.0], [2.0, 0.2], [2.2, 1.8], [0.1, 1.6]]),\n         'params': {'a': -1.0, 'b': 0.3, 'c': 0.0, 'd': 1.5}},\n        {'nodes': np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 0.05], [0.0, 0.05]]),\n         'params': {'a': 10.0, 'b': -5.0, 'c': 4.0, 'd': -2.0}},\n        {'nodes': np.array([[0.0, 0.0], [2.0, 0.0], [2.5, 1.0], [-0.1, 1.2]]),\n         'params': {'a': 0.0, 'b': 0.0, 'c': 0.0, 'd': 0.0}},\n    ]\n\n    results = []\n    for case in test_cases:\n        test_passed = verify_linear_completeness(case['nodes'], case['params'], E, nu)\n        results.append(test_passed)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef get_material_matrix_plane_strain(E, nu):\n    \"\"\"Computes the plane strain isotropic elasticity matrix in Voigt notation.\"\"\"\n    lame_lambda = E * nu / ((1 + nu) * (1 - 2 * nu))\n    lame_mu = E / (2 * (1 + nu))\n    \n    C = np.array([\n        [lame_lambda + 2 * lame_mu, lame_lambda, 0],\n        [lame_lambda, lame_lambda + 2 * lame_mu, 0],\n        [0, 0, lame_mu]\n    ])\n    return C\n\ndef get_shape_functions(xi, eta):\n    \"\"\"\n    Computes bilinear shape functions and their derivatives at a point (xi, eta).\n    Returns (N, dN_dxi, dN_deta).\n    \"\"\"\n    N = 0.25 * np.array([\n        (1 - xi) * (1 - eta),\n        (1 + xi) * (1 - eta),\n        (1 + xi) * (1 + eta),\n        (1 - xi) * (1 + eta)\n    ])\n    \n    dN_dxi = 0.25 * np.array([\n        -(1 - eta),\n        (1 - eta),\n        (1 + eta),\n        -(1 + eta)\n    ])\n    \n    dN_deta = 0.25 * np.array([\n        -(1 - xi),\n        -(1 + xi),\n        (1 + xi),\n        (1 - xi)\n    ])\n    \n    return N, dN_dxi, dN_deta\n\ndef verify_linear_completeness(nodes, params, E, nu):\n    \"\"\"\n    Performs the numerical verification for a single element case.\n    \"\"\"\n    # 1. Setup material matrix and compatible strain\n    C = get_material_matrix_plane_strain(E, nu)\n    a, b, c, d = params['a'], params['b'], params['c'], params['d']\n    epsilon_c = np.array([a, d, b + c])\n\n    # 2. Get Gauss quadrature points and weights (5x5)\n    n_gauss = 5\n    xi_g, w_g = np.polynomial.legendre.leggauss(n_gauss)\n    gauss_points_2d = []\n    for i in range(n_gauss):\n        for j in range(n_gauss):\n            gauss_points_2d.append(((xi_g[i], xi_g[j]), w_g[i] * w_g[j]))\n\n    # 3. Compute the mean of the bubble function, b_bar\n    integral_bJ = 0.0\n    area = 0.0\n    for (xi, eta), w in gauss_points_2d:\n        _, dN_dxi, dN_deta = get_shape_functions(xi, eta)\n        \n        # Jacobian matrix J_mat = [[dx/dxi, dy/dxi], [dx/deta, dy/deta]]\n        J_mat = np.stack((dN_dxi, dN_deta)) @ nodes\n        \n        J_det = np.linalg.det(J_mat)\n        \n        bubble_func = (1 - xi**2) * (1 - eta**2)\n        integral_bJ += bubble_func * J_det * w\n        area += J_det * w\n\n    if abs(area)  1e-15: # Avoid division by zero for a collapsed element\n        b_bar = 0.0\n    else:\n        b_bar = integral_bJ / area\n        \n    # 4. Assemble H matrix and q vector\n    H = np.zeros((3, 3))\n    q = np.zeros(3)\n\n    for (xi, eta), w in gauss_points_2d:\n        _, dN_dxi, dN_deta = get_shape_functions(xi, eta)\n        J_mat = np.stack((dN_dxi, dN_deta)) @ nodes\n        J_det = np.linalg.det(J_mat)\n        \n        bubble_func = (1 - xi**2) * (1 - eta**2)\n        psi = bubble_func - b_bar\n        \n        # G(xi, eta) = psi(xi, eta) * I_3\n        # H += G.T @ C @ G * J_det * w = (psi**2 * C) * J_det * w\n        H += (psi**2 * C) * J_det * w\n        # q += G.T @ C @ epsilon_c * J_det * w = (psi * C @ epsilon_c) * J_det * w\n        q += (psi * (C @ epsilon_c)) * J_det * w\n\n    # 5. Solve for alpha and compute enhanced energy\n    try:\n        # H is symmetric positive definite for non-degenerate elements\n        alpha = np.linalg.solve(H, -q)\n    except np.linalg.LinAlgError:\n        # Should not happen for the given test cases\n        return False\n\n    E_e = 0.5 * alpha.T @ H @ alpha\n\n    # 6. Define tolerance and perform the check\n    # Compatible strain energy density\n    if np.allclose(epsilon_c, 0):\n        U_c_density = 0.0\n    else:    \n        U_c_density = 0.5 * epsilon_c.T @ C @ epsilon_c\n    \n    # Total compatible strain energy in the element\n    E_c = area * U_c_density\n    \n    # Tolerance definition from problem statement\n    tol = max(1e-12, 1e-12 * E_c)\n    \n    return abs(E_e) = tol\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "在有限元分析中，我们常常需要在计算效率和精度之间做出权衡，这催生了减缩积分技术，但也带来了“沙漏模式”（即伪零能模式）的稳定性问题。本练习将使用特征值分析这一强大的诊断工具，让你直观地看到这种不稳定性。更重要的是，它将演示如何通过引入一个目标明确的增强位移场来“治愈”沙漏模式，在不牺牲减缩积分优势的同时，恢复单元的稳定性。",
            "id": "3573623",
            "problem": "您需要实现一个小规模的特征值分析，以精确且可验证的方式揭示二维弹性力学中四节点双线性四边形单元的减缩数值积分如何产生伪零能模式（沙漏模式），以及一种仅针对沙漏子空间的增强方法如何在不影响刚体模态的情况下恢复矫顽性。您的推导和算法必须从虚功原理和标准等参有限元定义出发。最终产品必须是一个完整的程序，该程序能够构建单元刚度矩阵、执行特征分析、识别伪零能模式，并通过一个精心设计的增强位移场贡献来演示其消除过程。\n\n使用以下基础和定义。\n\n- 在单元层面，小应变线性弹性力学的虚功原理可表示为 $\\,\\delta \\Pi_{e} = \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{K}_{e} \\boldsymbol{u}_{e} - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0\\,$，此式对所有容许的虚位移 $\\,\\delta \\boldsymbol{u}_{e}\\,$ 均成立。其中，单元刚度矩阵为 $\\,\\boldsymbol{K}_{e} = \\int_{\\Omega_{e}} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\,\\mathrm{d}\\Omega\\,$。$\\,\\boldsymbol{B}\\,$ 是应变-位移矩阵，$\\,\\boldsymbol{C}\\,$ 是本构（材料）矩阵。\n- 考虑一个标准的等参四节点双线性四边形（常简写为 $\\,\\mathrm{Q4}\\,$），其节点坐标为 $\\,\\{(x_{i},y_{i})\\}_{i=1}^{4}\\,$，节点位移向量为 $\\,\\boldsymbol{u}_{e} \\in \\mathbb{R}^{8}\\,$，按 $\\,\\boldsymbol{u}_{e} = [u_{1x},u_{1y},u_{2x},u_{2y},u_{3x},u_{3y},u_{4x},u_{4y}]^{\\mathsf{T}}\\,$ 排序。在母域 $\\,(\\xi,\\eta)\\in[-1,1]^{2}\\,$ 中的双线性形函数为 $\\,N_{1}(\\xi,\\eta)=\\tfrac{1}{4}(1-\\xi)(1-\\eta)\\,$、$\\,N_{2}(\\xi,\\eta)=\\tfrac{1}{4}(1+\\xi)(1-\\eta)\\,$、$\\,N_{3}(\\xi,\\eta)=\\tfrac{1}{4}(1+\\xi)(1+\\eta)\\,$、$\\,N_{4}(\\xi,\\eta)=\\tfrac{1}{4}(1-\\xi)(1+\\eta)\\,$。到物理空间的映射为 $\\,\\boldsymbol{x}(\\xi,\\eta)=\\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,\\boldsymbol{x}_{i}\\,$，其雅可比矩阵为 $\\,\\boldsymbol{J}=\\partial \\boldsymbol{x}/\\partial(\\xi,\\eta)\\,$，且 $\\,\\mathrm{d}\\Omega = \\det(\\boldsymbol{J})\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\\,$。形函数在物理坐标系下的梯度通过 $\\,\\nabla N_{i} = \\boldsymbol{J}^{-1}\\,\\nabla_{\\xi,\\eta} N_{i}\\,$ 获得。\n- 对于二维平面应变，本构矩阵为 $\\,\\boldsymbol{C}=\\dfrac{E}{(1+\\nu)(1-2\\nu)}\\begin{bmatrix}1-\\nu  \\nu  0\\\\ \\nu  1-\\nu  0\\\\ 0  0  \\tfrac{1}{2}(1-2\\nu)\\end{bmatrix}\\,$，其中 $\\,E\\,$ 是杨氏模量，$\\,\\nu\\,$ 是泊松比。应变-位移矩阵 $\\,\\boldsymbol{B}\\,$ 根据 $\\,\\partial N_{i}/\\partial x\\,$ 和 $\\,\\partial N_{i}/\\partial y\\,$ 的分量以标准方式构建。\n\n您必须实现三种单元刚度构建方法：\n- 减缩积分：在 $\\,[-1,1]^{2}\\,$ 上使用位于 $\\,(\\xi,\\eta)=(0,0)\\,$ 的单个 `Gauss` 点，权重为 $\\,w=4\\,$，因此 $\\,\\boldsymbol{K}_{\\mathrm{red}}=\\boldsymbol{B}(0,0)^{\\mathsf{T}}\\boldsymbol{C}\\,\\boldsymbol{B}(0,0)\\,\\det(\\boldsymbol{J}(0,0))\\,w\\,$。这会产生超出刚体模态的秩亏，从而导致伪零能模式。\n- 完全积分：使用具有点 $\\,(\\pm 1/\\sqrt{3},\\pm 1/\\sqrt{3})\\,$ 和权重 $\\,w=1\\,$ 的 $\\,2\\times 2\\,$ `Gauss` 法则，求和得到 $\\,\\boldsymbol{K}_{\\mathrm{full}}\\,$。这在常规设置下会消除伪零能模式，仅保留刚体模态。\n- 在减缩积分基础上进行增强位移稳定：令 $\\,\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}})\\,$ 表示 $\\,\\boldsymbol{K}_{\\mathrm{red}}\\,$ 的零空间。令 $\\,\\mathcal{R}\\,$ 为刚体模态子空间，由两个平移和一个绕形心 $\\,\\boldsymbol{x}_{c}\\,$ 的平面内旋转所张成，即 $\\,\\boldsymbol{r}_{1}=[1,0,1,0,1,0,1,0]^{\\mathsf{T}}\\,$、$\\,\\boldsymbol{r}_{2}=[0,1,0,1,0,1,0,1]^{\\mathsf{T}}\\,$ 和 $\\,\\boldsymbol{r}_{3}=[-y_{1}^{c},x_{1}^{c},-y_{2}^{c},x_{2}^{c},-y_{3}^{c},x_{3}^{c},-y_{4}^{c},x_{4}^{c}]^{\\mathsf{T}}\\,$，其中 $\\,\\boldsymbol{x}_{i}^{c}=\\boldsymbol{x}_{i}-\\boldsymbol{x}_{c}\\,$ 且 $\\,\\boldsymbol{x}_{c}=\\tfrac{1}{4}\\sum_{i=1}^{4}\\boldsymbol{x}_{i}\\,$。定义沙漏子空间 $\\,\\mathcal{H}=\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}})\\ominus\\mathcal{R}\\,$。构造 $\\,\\mathcal{H}\\,$ 的一个标准正交基 $\\,\\boldsymbol{H}\\in\\mathbb{R}^{8\\times n_{h}}\\,$，其中 $\\,n_{h}\\,$ 是 $\\,\\mathcal{H}\\,$ 的维数。添加一个增强位移稳定项 $\\,\\boldsymbol{K}_{\\mathrm{enh}}=\\beta\\,\\boldsymbol{H}\\boldsymbol{H}^{\\mathsf{T}}\\,$，其中 $\\,\\beta=\\alpha\\,\\mu\\,L\\,$，$\\,\\mu=\\dfrac{E}{2(1+\\nu)}\\,$ 是剪切模量，$\\,L=\\sqrt{A}\\,$（$\\,A\\,$ 为单元面积），$\\,\\alpha=1\\,$ 是一个无量纲缩放因子。增强刚度为 $\\,\\boldsymbol{K}_{\\mathrm{red+enh}}=\\boldsymbol{K}_{\\mathrm{red}}+\\boldsymbol{K}_{\\mathrm{enh}}\\,$。此构造必须使刚体模态不受惩罚，且仅提升沙漏模态，从而消除伪零能模式。\n\n您必须按如下方式诊断伪零能模式。给定一个对称矩阵 $\\,\\boldsymbol{K}\\,$，计算其特征值 $\\,\\{\\lambda_{i}\\}\\,$。令 $\\,\\lambda_{\\max}=\\max_{i}|\\lambda_{i}|\\,$ 并定义一个相对阈值 $\\,\\varepsilon=\\max(10^{-8},10^{-8}\\lambda_{\\max})\\,$。计算 $\\,n_{0}\\,$，即满足 $\\,|\\lambda_{i}|  \\varepsilon\\,$ 的特征值数量。伪零能模式的数量为 $\\,n_{\\mathrm{spur}}=\\max(0, n_{0}-3)\\,$，因为对于一个自由单元，二维弹性力学中有 $\\,3\\,$ 个刚体模态。\n\n实现以上内容，并将其应用于以下测试套件。使用平面应变，参数为 $\\,E=210\\times 10^{9}\\,$ 和 $\\,\\nu=0.30\\,$。定义两种几何形状：\n- 几何形状 $\\,\\mathcal{G}_{1}\\,$ (正方形)：节点位于 $\\,\\boldsymbol{x}_{1}=(0,0)\\,$、$\\,\\boldsymbol{x}_{2}=(1,0)\\,$、$\\,\\boldsymbol{x}_{3}=(1,1)\\,$、$\\,\\boldsymbol{x}_{4}=(0,1)\\,$（单位：米）。\n- 几何形状 $\\,\\mathcal{G}_{2}\\,$ (扭曲的平行四边形)：节点位于 $\\,\\boldsymbol{x}_{1}=(0,0)\\,$、$\\,\\boldsymbol{x}_{2}=(2,0)\\,$、$\\,\\boldsymbol{x}_{3}=(2.2,1)\\,$、$\\,\\boldsymbol{x}_{4}=(0.2,1)\\,$（单位：米）。\n\n设置六种情况，并为每种情况报告 $\\,n_{\\mathrm{spur}}\\,$ 的整数值：\n- 情况 $\\,1\\,$: 对 $\\,\\mathcal{G}_{1}\\,$ 使用减缩积分。\n- 情况 $\\,2\\,$: 对 $\\,\\mathcal{G}_{1}\\,$ 使用减缩积分加增强。\n- 情况 $\\,3\\,$: 对 $\\,\\mathcal{G}_{1}\\,$ 使用完全积分。\n- 情况 $\\,4\\,$: 对 $\\,\\mathcal{G}_{2}\\,$ 使用减缩积分。\n- 情况 $\\,5\\,$: 对 $\\,\\mathcal{G}_{2}\\,$ 使用减缩积分加增强。\n- 情况 $\\,6\\,$: 对 $\\,\\mathcal{G}_{2}\\,$ 使用完全积分。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，即 $\\,\\big[ n_{\\mathrm{spur}}^{(1)}, n_{\\mathrm{spur}}^{(2)}, n_{\\mathrm{spur}}^{(3)}, n_{\\mathrm{spur}}^{(4)}, n_{\\mathrm{spur}}^{(5)}, n_{\\mathrm{spur}}^{(6)} \\big]\\,$，其中每个条目是按指定情况顺序排列的整数。输出中不需要物理单位，因为最终要求的量是纯粹的计数。",
            "solution": "该问题要求在计算固体力学领域实现并验证一种数值技术，具体涉及二维线性弹性力学中的四节点双线性四边形（$\\mathrm{Q4}$）单元。核心任务是演示在减缩积分下伪零能模式（沙漏）的出现，以及随后使用增强位移场方法消除这些模式。该分析将通过计算不同单元刚度矩阵的特征值来执行。\n\n推导从虚功原理开始，该原理指出，对于处于平衡状态的物体，在任何容许的虚位移下，外力所做的虚功等于内应变能的变化。对于单个有限元，这表示为 $\\delta \\Pi_{e} = \\int_{\\Omega_e} \\delta\\boldsymbol{\\varepsilon}^{\\mathsf{T}}\\boldsymbol{\\sigma} \\,\\mathrm{d}\\Omega - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0$，其中 $\\boldsymbol{\\sigma}$ 是应力张量，$\\boldsymbol{\\varepsilon}$ 是应变张量，$\\boldsymbol{u}_e$ 是节点位移向量，$\\boldsymbol{f}_e$ 是节点力向量。\n\n使用线性弹性本构关系 $\\boldsymbol{\\sigma} = \\boldsymbol{C}\\boldsymbol{\\varepsilon}$ 和应变-位移关系 $\\boldsymbol{\\varepsilon} = \\boldsymbol{B} \\boldsymbol{u}_e$，其中 $\\boldsymbol{C}$ 是材料本构矩阵，$\\boldsymbol{B}$ 是应变-位移矩阵，虚功原理可以改写为：\n$$ \\delta \\Pi_{e} = \\int_{\\Omega_e} (\\delta(\\boldsymbol{B}\\boldsymbol{u}_e))^{\\mathsf{T}}\\boldsymbol{C}(\\boldsymbol{B}\\boldsymbol{u}_e) \\,\\mathrm{d}\\Omega - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0 $$\n$$ \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\left( \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\,\\mathrm{d}\\Omega \\right) \\boldsymbol{u}_{e} - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0 $$\n由于此式必须对任意虚位移 $\\delta \\boldsymbol{u}_e$ 均成立，我们可识别出单元刚度矩阵 $\\boldsymbol{K}_e$ 为：\n$$ \\boldsymbol{K}_e = \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\,\\mathrm{d}\\Omega $$\n该积分在单元的物理域 $\\Omega_e$ 上进行。对于等参单元，我们使用几何映射的雅可比矩阵 $\\boldsymbol{J}$ 将此积分映射到母域，通常是 $(\\xi, \\eta) \\in [-1, 1]^2$：$\\mathrm{d}\\Omega = \\det(\\boldsymbol{J}) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。刚度矩阵变为：\n$$ \\boldsymbol{K}_e = \\int_{-1}^{1}\\int_{-1}^{1} \\boldsymbol{B}(\\xi, \\eta)^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B}(\\xi, \\eta) \\det(\\boldsymbol{J}(\\xi, \\eta)) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta $$\n应变-位移矩阵 $\\boldsymbol{B}$ 由形函数 $N_i$ 的物理梯度构建。对于节点 $i$，其贡献 $\\boldsymbol{B}_i$ 为 $\\boldsymbol{B}_i = \\begin{bmatrix} \\partial N_i/\\partial x  0 \\\\ 0  \\partial N_i/\\partial y \\\\ \\partial N_i/\\partial y  \\partial N_i/\\partial x \\end{bmatrix}$。完整的矩阵为 $\\boldsymbol{B} = [\\boldsymbol{B}_1, \\boldsymbol{B}_2, \\boldsymbol{B}_3, \\boldsymbol{B}_4]$。物理梯度通过链式法则从母空间梯度中求得：$\\nabla_{\\boldsymbol{x}} N_i = \\boldsymbol{J}^{-1} \\nabla_{\\boldsymbol{\\xi}} N_i$。\n\n$\\boldsymbol{K}_e$ 的这个积分使用 `Gauss` 求积进行数值计算。求积法则的选择至关重要。\n1.  **完全积分 ($\\boldsymbol{K}_{\\mathrm{full}}$)**：使用 $2\\times 2$ `Gauss` 法则。它有 $4$ 个积分点 $(\\xi_{gp}, \\eta_{gp})$，权重为 $w_{gp}=1$。对于矩形或平行四边形单元，此积分阶数足以精确积分刚度矩阵，并为一般四边形提供正确的秩，确保没有伪零能模式。矩阵的秩为 $n_{dof} - n_{rbm} = 8 - 3 = 5$，其中 $n_{dof}$ 是自由度数， $n_{rbm}$ 是刚体模态数。$\\boldsymbol{K}_{\\mathrm{full}}$ 的零空间维数为 $3$，由刚体模态张成。\n\n2.  **减缩积分 ($\\boldsymbol{K}_{\\mathrm{red}}$)**：使用位于单元中心 $(\\xi, \\eta) = (0, 0)$ 的单个 `Gauss` 点，权重为 $w=4$。这种方法计算效率高。然而，仅在这一点计算的应变-位移矩阵 $\\boldsymbol{B}(0,0)$ 可能无法捕捉所有可能的变形模式。某些变形模式，称为沙漏模式，会在单元中心产生零应变，即对于沙漏节点位移向量 $\\boldsymbol{u}_{hg}$，有 $\\boldsymbol{B}(0,0)\\boldsymbol{u}_{hg} = \\boldsymbol{0}$。因此，这些模式的应变能为零（$\\frac{1}{2}\\boldsymbol{u}_{hg}^{\\mathsf{T}}\\boldsymbol{K}_{\\mathrm{red}}\\boldsymbol{u}_{hg}=0$），并作为额外的向量出现在 $\\boldsymbol{K}_{\\mathrm{red}}$ 的零空间中。$\\boldsymbol{K}_{\\mathrm{red}}$ 的秩低于 $5$，导致秩亏和过度柔性的单元公式，这在全局分析中可能不稳定。对于矩形单元，存在两个这样的沙漏模式，因此 $\\mathrm{rank}(\\boldsymbol{K}_{\\mathrm{red}})=3$ 且 $\\mathrm{dim}(\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}}))=5$。对于一般的平行四边形，存在一个沙漏模式，因此 $\\mathrm{rank}(\\boldsymbol{K}_{\\mathrm{red}})=4$ 且 $\\mathrm{dim}(\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}}))=4$。\n\n3.  **带增强的减缩积分 ($\\boldsymbol{K}_{\\mathrm{red+enh}}$)**：为了恢复减缩积分单元的稳定性，会添加一个稳定项 $\\boldsymbol{K}_{\\mathrm{enh}}$。该项必须仅惩罚伪沙漏模式，同时不影响刚体模态和其他有效变形。这是通过定义一个修正的势能 $\\Pi_{e, \\text{enh}} = \\Pi_{e, \\text{red}} + \\Pi_{e, \\text{stab}}$ 实现的，其中 $\\Pi_{e, \\text{stab}}$ 是与沙漏变形相关的惩罚能。我们将沙漏子空间 $\\mathcal{H}$ 定义为 $\\boldsymbol{K}_{\\mathrm{red}}$ 零空间中与刚体子空间 $\\mathcal{R}$ 正交的部分，即 $\\mathcal{H} = \\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}}) \\ominus \\mathcal{R}$。令 $\\boldsymbol{H}$ 为一个矩阵，其列构成 $\\mathcal{H}$ 的一个标准正交基。沙漏惩罚能定义为 $\\Pi_{e, \\text{stab}} = \\frac{1}{2}\\beta \\| \\boldsymbol{H}^{\\mathsf{T}}\\boldsymbol{u}_e \\|_2^2 = \\frac{1}{2}\\beta \\boldsymbol{u}_e^{\\mathsf{T}}\\boldsymbol{H}\\boldsymbol{H}^{\\mathsf{T}}\\boldsymbol{u}_e$。对 $\\boldsymbol{u}_e$ 取二次变分，得到稳定刚度 $\\boldsymbol{K}_{\\mathrm{enh}} = \\beta \\boldsymbol{H}\\boldsymbol{H}^{\\mathsf{T}}$。总刚度为 $\\boldsymbol{K}_{\\mathrm{red+enh}} = \\boldsymbol{K}_{\\mathrm{red}} + \\boldsymbol{K}_{\\mathrm{enh}}$。稳定参数 $\\beta$ 根据材料（$\\mu$）和几何（$L$）属性选择，以提供适当的刚度。关键是，如果 $\\boldsymbol{u}_e$ 是一个刚体模态，它与 $\\boldsymbol{H}$ 的列正交，因此 $\\boldsymbol{H}^{\\mathsf{T}}\\boldsymbol{u}_e=\\boldsymbol{0}$，不施加惩罚。如果 $\\boldsymbol{u}_e$ 是一个沙漏模式，它位于 $\\boldsymbol{H}$ 的张成空间中，惩罚项提供了必要的能量以防止伪行为。\n\n识别沙漏基 $\\boldsymbol{H}$ 的算法如下：\n- 找到 $\\boldsymbol{K}_{\\mathrm{red}}$ 零空间的一个标准正交基，用矩阵 $\\boldsymbol{N}_{\\text{basis}}$ 的列表示。\n- 构造刚体模态 $\\boldsymbol{r}_1, \\boldsymbol{r}_2, \\boldsymbol{r}_3$，并找到它们所张成的空间 $\\mathcal{R}$ 的一个标准正交基，用 $\\boldsymbol{R}_{\\text{basis}}$ 的列表示。\n- 如果一个向量 $\\boldsymbol{v}$ 在 $\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}})$ 中且与 $\\mathcal{R}$ 正交，则它是一个沙漏模式。这意味着对于某个系数向量 $\\boldsymbol{c}$，有 $\\boldsymbol{v} = \\boldsymbol{N}_{\\text{basis}}\\boldsymbol{c}$，且 $\\boldsymbol{R}_{\\text{basis}}^{\\mathsf{T}}\\boldsymbol{v} = \\boldsymbol{0}$。这导出条件 $(\\boldsymbol{R}_{\\text{basis}}^{\\mathsf{T}}\\boldsymbol{N}_{\\text{basis}})\\boldsymbol{c} = \\boldsymbol{0}$。\n- 我们求解矩阵 $(\\boldsymbol{R}_{\\text{basis}}^{\\mathsf{T}}\\boldsymbol{N}_{\\text{basis}})$ 的零空间以找到容许的系数 $\\boldsymbol{c}$。设此零空间基为 $\\boldsymbol{Z}$。\n- 那么沙漏子空间的标准正交基为 $\\boldsymbol{H} = \\boldsymbol{N}_{\\text{basis}}\\boldsymbol{Z}$。\n\n最后一步是为每个刚度矩阵诊断伪模式的数量 $n_{\\mathrm{spur}}$。我们计算矩阵的特征值 $\\{\\lambda_i\\}$。零能模式的数量 $n_0$ 是小于数值阈值 $\\varepsilon$ 的特征值的计数。由于一个自由单元有 $3$ 个物理零能模式（刚体模态），伪模式的数量为 $n_{\\mathrm{spur}}=\\max(0, n_0-3)$。此过程允许对每种积分和稳定方案的有效性进行定量验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import null_space, orth\n\nclass Q4Element:\n    \"\"\"\n    Represents a 4-node bilinear quadrilateral element in 2D elasticity.\n    \"\"\"\n    def __init__(self, nodes, E, nu):\n        \"\"\"\n        Initializes the element.\n        :param nodes: A list of 4 tuples, each with (x, y) coordinates of the nodes.\n        :param E: Young's modulus.\n        :param nu: Poisson's ratio.\n        \"\"\"\n        self.nodes = np.array(nodes)  # 4x2 array of (x,y) coords\n        if self.nodes.shape != (4, 2):\n            raise ValueError(\"Nodes must be a 4x2 array.\")\n        self.E = E\n        self.nu = nu\n        # Pre-compute the constitutive matrix for plane strain\n        self.C = self._get_constitutive_matrix()\n\n    def _get_constitutive_matrix(self):\n        \"\"\"Computes the plane strain constitutive matrix C.\"\"\"\n        factor = self.E / ((1 + self.nu) * (1 - 2 * self.nu))\n        C = factor * np.array([\n            [1 - self.nu, self.nu, 0],\n            [self.nu, 1 - self.nu, 0],\n            [0, 0, (1 - 2 * self.nu) / 2]\n        ])\n        return C\n\n    def get_shape_func_grads_parent(self, xi, eta):\n        \"\"\"Computes gradients of shape functions w.r.t. parent coordinates (xi, eta).\"\"\"\n        dN_dxi = 0.25 * np.array([-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)])\n        dN_deta = 0.25 * np.array([-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)])\n        return dN_dxi, dN_deta\n\n    def get_B_matrix_and_jacobian_det(self, xi, eta):\n        \"\"\"Computes the strain-displacement matrix B and Jacobian determinant.\"\"\"\n        dN_dxi, dN_deta = self.get_shape_func_grads_parent(xi, eta)\n\n        # Jacobian matrix J = [[dx/dxi, dy/dxi], [dx/deta, dy/deta]]\n        J = np.zeros((2, 2))\n        J[0, 0] = np.dot(dN_dxi, self.nodes[:, 0])  # dx/dxi\n        J[0, 1] = np.dot(dN_dxi, self.nodes[:, 1])  # dy/dxi\n        J[1, 0] = np.dot(dN_deta, self.nodes[:, 0]) # dx/deta\n        J[1, 1] = np.dot(dN_deta, self.nodes[:, 1]) # dy/deta\n        \n        detJ = np.linalg.det(J)\n        if detJ = 0:\n            raise ValueError(\"Jacobian determinant is non-positive, check node ordering.\")\n        \n        invJ = np.linalg.inv(J)\n\n        # Gradients of N w.r.t. physical coordinates (x, y)\n        dN_dxy = invJ @ np.vstack((dN_dxi, dN_deta))\n        dN_dx, dN_dy = dN_dxy[0, :], dN_dxy[1, :]\n\n        # Strain-displacement matrix B\n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2 * i] = dN_dx[i]\n            B[1, 2 * i + 1] = dN_dy[i]\n            B[2, 2 * i] = dN_dy[i]\n            B[2, 2 * i + 1] = dN_dx[i]\n            \n        return B, detJ\n\n    def get_stiffness_matrix_reduced(self):\n        \"\"\"Computes the stiffness matrix using 1-point reduced integration.\"\"\"\n        xi, eta, w = 0.0, 0.0, 4.0\n        B, detJ = self.get_B_matrix_and_jacobian_det(xi, eta)\n        K = B.T @ self.C @ B * detJ * w\n        return K\n\n    def get_stiffness_matrix_full(self):\n        \"\"\"Computes the stiffness matrix using 2x2 full integration.\"\"\"\n        gp_coord = 1.0 / np.sqrt(3)\n        gauss_points = [(-gp_coord, -gp_coord), (gp_coord, -gp_coord),\n                        (gp_coord, gp_coord), (-gp_coord, gp_coord)]\n        weights = [1.0, 1.0, 1.0, 1.0]\n\n        K = np.zeros((8, 8))\n        for (xi, eta), w in zip(gauss_points, weights):\n            B, detJ = self.get_B_matrix_and_jacobian_det(xi, eta)\n            K += B.T @ self.C @ B * detJ * w\n        return K\n\n    def get_stiffness_matrix_enhanced(self):\n        \"\"\"Computes the stiffness matrix with reduced integration plus hourglass control.\"\"\"\n        K_red = self.get_stiffness_matrix_reduced()\n        \n        # 1. Find an orthonormal basis for the null space of K_red\n        N_basis = null_space(K_red)\n\n        # 2. Construct rigid body modes and find an orthonormal basis for their span\n        centroid = np.mean(self.nodes, axis=0)\n        nodes_c = self.nodes - centroid\n        \n        r1 = np.tile([1, 0], 4)\n        r2 = np.tile([0, 1], 4)\n        r3 = np.zeros(8)\n        for i in range(4):\n            r3[2*i] = -nodes_c[i, 1]\n            r3[2*i+1] = nodes_c[i, 0]\n            \n        R_matrix = np.vstack([r1, r2, r3]).T\n        R_basis = orth(R_matrix)\n        \n        # 3. Find hourglass subspace basis H\n        if N_basis.shape[1] > R_basis.shape[1]:\n            M = R_basis.T @ N_basis\n            Z = null_space(M)\n            H = N_basis @ Z\n        else:\n            # The null space of K_red only contains rigid body modes (or fewer).\n            return K_red\n\n        if H.shape[1] == 0:  # No non-rigid-body modes found in the null space\n            return K_red\n        \n        # 4. Calculate stabilization matrix K_enh\n        # Area A using shoelace formula\n        x, y = self.nodes[:, 0], self.nodes[:, 1]\n        A = 0.5 * np.abs(np.dot(x, np.roll(y, -1)) - np.dot(y, np.roll(x, -1)))\n        \n        L = np.sqrt(A)\n        mu = self.E / (2 * (1 + self.nu))\n        alpha = 1.0\n        beta = alpha * mu * L\n        \n        K_enh = beta * (H @ H.T)\n        \n        return K_red + K_enh\n\ndef count_spurious_modes(K):\n    \"\"\"\n    Counts spurious zero-energy modes from a stiffness matrix K.\n    A mode is considered zero-energy if its eigenvalue is close to zero.\n    There are 3 rigid-body modes, so any zero-energy modes beyond 3 are spurious.\n    \"\"\"\n    # Use eigvalsh for symmetric matrices for better performance and stability\n    eigenvalues = np.linalg.eigvalsh(K)\n    \n    if len(eigenvalues) == 0:\n        return 0\n        \n    lambda_max = np.max(np.abs(eigenvalues))\n    # Epsilon threshold as per problem specification\n    epsilon = max(1e-8, 1e-8 * lambda_max) if lambda_max > 0 else 1e-8\n    \n    # Count eigenvalues whose absolute value is less than the threshold\n    n0 = np.sum(np.abs(eigenvalues)  epsilon)\n    \n    # Number of spurious modes is the number of zero modes minus 3 rigid body modes\n    n_spur = max(0, n0 - 3)\n    return int(n_spur)\n\ndef solve():\n    # Define material properties and test geometries\n    E = 210e9\n    nu = 0.30\n\n    nodes_g1 = [(0, 0), (1, 0), (1, 1), (0, 1)]  # Square\n    nodes_g2 = [(0, 0), (2, 0), (2.2, 1), (0.2, 1)] # Distorted parallelogram\n\n    # Define test cases: (geometry_nodes, stiffness_matrix_method_name)\n    test_cases = [\n        (nodes_g1, 'reduced'),\n        (nodes_g1, 'enhanced'),\n        (nodes_g1, 'full'),\n        (nodes_g2, 'reduced'),\n        (nodes_g2, 'enhanced'),\n        (nodes_g2, 'full'),\n    ]\n\n    results = []\n    for nodes, method in test_cases:\n        element = Q4Element(nodes, E, nu)\n        \n        if method == 'reduced':\n            K = element.get_stiffness_matrix_reduced()\n        elif method == 'enhanced':\n            K = element.get_stiffness_matrix_enhanced()\n        elif method == 'full':\n            K = element.get_stiffness_matrix_full()\n        \n        n_spur = count_spurious_modes(K)\n        results.append(n_spur)\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}