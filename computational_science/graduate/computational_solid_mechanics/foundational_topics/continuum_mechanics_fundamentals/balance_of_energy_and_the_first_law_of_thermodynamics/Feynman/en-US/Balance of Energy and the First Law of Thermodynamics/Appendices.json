{
    "hands_on_practices": [
        {
            "introduction": "In an ideal mechanical system without damping or external forces, the total energy remains constant. However, when we simulate such a system numerically, the choice of time integration algorithm can introduce non-physical energy changes. This exercise  explores this crucial concept of \"algorithmic dissipation\" using the ubiquitous Newmark method on a simple oscillator. By implementing the integrator and varying its control parameters, you will directly investigate the link between numerical stability and energy conservation, a fundamental skill for evaluating any time-dependent simulation.",
            "id": "3546260",
            "problem": "Consider a linear single-degree-of-freedom oscillator with mass $m$ (in $\\mathrm{kg}$) and stiffness $k$ (in $\\mathrm{N/m}$), subject to no external forces and no physical dissipation. The displacement $u(t)$ (in $\\mathrm{m}$) satisfies the ordinary differential equation $m \\ddot{u}(t) + k u(t) = 0$ with initial conditions $u(0) = u_0$ and $\\dot{u}(0) = v_0$. By the first law of thermodynamics applied to mechanical systems, the total mechanical energy $E(t) = T(t) + U(t)$ with $T(t) = \\tfrac{1}{2} m \\dot{u}(t)^2$ and $U(t) = \\tfrac{1}{2} k u(t)^2$ is constant in time, i.e., $\\tfrac{d}{dt} E(t) = 0$, because the external power is zero. In numerical time integration, however, algorithmic (numerical) dissipation may arise, in which case the discrete total energy may decay.\n\nYou will analyze numerical damping and algorithmic energy for the Newmark family with parameter pair $(\\gamma,\\beta)$ specialized to $\\gamma = \\tfrac{1}{2}$ and $\\beta \\ge \\tfrac{1}{4}$. This time integrator advances from step $n$ to $n+1$ using the unknown acceleration $a_{n+1}$, velocity $v_{n+1}$, and displacement $u_{n+1}$, linked through the Newmark kinematics and the equilibrium equation at $t_{n+1}$.\n\nTasks:\n- Starting from the first law of thermodynamics and the equation of motion $m \\ddot{u}(t) + k u(t) = 0$, derive the discrete update equations of the Newmark method with $\\gamma = \\tfrac{1}{2}$ and general $\\beta \\ge \\tfrac{1}{4}$, and formulate a discrete energy increment $\\Delta E^{n} = E^{n+1} - E^{n}$ where $E^{n} = \\tfrac{1}{2} m (v^{n})^2 + \\tfrac{1}{2} k (u^{n})^2$. Establish conditions on $\\beta$ under which the discrete energy is non-increasing.\n- Implement the resulting scheme in a program that, given $(m,k,u_0,v_0,\\Delta t,N,\\beta)$, computes the sequence $\\{(u^{n},v^{n})\\}_{n=0}^{N}$ and the corresponding discrete energies $\\{E^{n}\\}_{n=0}^{N}$.\n- For each case in the provided test suite, compute the normalized final energy ratio $r = E^{N} / E^{0}$ (dimensionless). Report each $r$ rounded to $8$ decimal places.\n\nUse the following definitions and requirements:\n- The natural circular frequency is $\\omega = \\sqrt{k/m}$ (in $\\mathrm{rad/s}$) and the period is $T = 2\\pi/\\omega$ (in $\\mathrm{s}$).\n- Use initial conditions $u_0 = 1$ (in $\\mathrm{m}$) and $v_0 = 0$ (in $\\mathrm{m/s}$).\n- Energies are in $\\mathrm{J}$, but only the dimensionless ratio $r$ is to be output.\n- Angles are not used beyond the definition of $\\omega$ and $T$; no angle unit is required.\n- The final output must be a single line containing a Python list with the four ratios $[r_1,r_2,r_3,r_4]$, each rounded to $8$ decimal places, with no additional text.\n\nTest suite:\n- Case $1$ (conservative baseline): $m = 1$, $k = 1000$, $\\beta = 0.25$, $\\Delta t = T/40$, $N = 10 T / \\Delta t = 400$.\n- Case $2$ (moderate algorithmic damping, fine time step): $m = 1$, $k = 1000$, $\\beta = 0.30$, $\\Delta t = T/40$, $N = 400$.\n- Case $3$ (moderate algorithmic damping, coarse time step): $m = 1$, $k = 1000$, $\\beta = 0.30$, $\\Delta t = T/5$, $N = 50$.\n- Case $4$ (strong algorithmic damping, very fine time step): $m = 1$, $k = 1000$, $\\beta = 0.50$, $\\Delta t = T/200$, $N = 2000$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$), where each $r_i$ is the normalized final energy ratio for the corresponding case, rounded to $8$ decimal places.",
            "solution": "The user wants a critical analysis and solution to a problem in computational solid mechanics concerning the Newmark time integration method.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n-   **Equation of Motion**: $m \\ddot{u}(t) + k u(t) = 0$ for a single-degree-of-freedom oscillator.\n-   **Energy Definitions**: Kinetic energy $T(t) = \\tfrac{1}{2} m \\dot{u}(t)^2$, Potential energy $U(t) = \\tfrac{1}{2} k u(t)^2$, Total energy $E(t) = T(t) + U(t)$.\n-   **Continuous Energy Conservation**: For the given system, $\\tfrac{d}{dt} E(t) = 0$.\n-   **Numerical Integrator**: The Newmark method with parameters $\\gamma = \\tfrac{1}{2}$ and $\\beta \\ge \\tfrac{1}{4}$.\n-   **Newmark Update Equations**:\n    -   $u_{n+1} = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left[ \\left(\\tfrac{1}{2}-\\beta\\right) a_n + \\beta a_{n+1} \\right]$\n    -   $v_{n+1} = v_n + \\Delta t \\left[ (1-\\gamma) a_n + \\gamma a_{n+1} \\right]$\n-   **Discrete Energy**: $E^{n} = \\tfrac{1}{2} m (v^{n})^2 + \\tfrac{1}{2} k (u^{n})^2$.\n-   **Tasks**:\n    1.  Derive the discrete update equations for the system.\n    2.  Formulate the discrete energy increment $\\Delta E^{n} = E^{n+1} - E^{n}$ and establish conditions on $\\beta$ for non-increasing energy.\n    3.  Implement the scheme and compute the normalized final energy ratio $r = E^{N} / E^{0}$ for four test cases.\n-   **Definitions**: Natural frequency $\\omega = \\sqrt{k/m}$, Period $T = 2\\pi/\\omega$.\n-   **Initial Conditions**: $u_0 = 1 \\, \\mathrm{m}$, $v_0 = 0 \\, \\mathrm{m/s}$ for all cases.\n-   **Test Suite**:\n    -   Case 1: $m = 1$, $k = 1000$, $\\beta = 0.25$, $\\Delta t = T/40$, $N = 400$.\n    -   Case 2: $m = 1$, $k = 1000$, $\\beta = 0.30$, $\\Delta t = T/40$, $N = 400$.\n    -   Case 3: $m = 1$, $k = 1000$, $\\beta = 0.30$, $\\Delta t = T/5$, $N = 50$.\n    -   Case 4: $m = 1$, $k = 1000$, $\\beta = 0.50$, $\\Delta t = T/200$, $N = 2000$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is evaluated against the specified criteria:\n-   **Scientifically Grounded**: The problem is well-founded in standard principles of classical mechanics and numerical methods for structural dynamics. The Newmark method and its energy properties are canonical topics in computational mechanics.\n-   **Well-Posed**: The problem statement is complete, providing all necessary physical parameters, initial conditions, and numerical parameters for each test case. The objective is to compute a uniquely-defined numerical quantity, which is a well-posed task.\n-   **Objective**: The problem is stated using precise, unambiguous mathematical and technical language.\n\nThe problem does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or vagueness. All provided data are consistent. For example, the total simulation time $N \\Delta t$ is consistently $10T$ across all cases where it can be computed from the given ratios (e.g., Case 3: $50 \\times (T/5) = 10T$).\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. A complete solution will be provided.\n\n### Principle-Based Solution\n\nThe problem requires the derivation and implementation of the Newmark time integration scheme for a linear single-degree-of-freedom (SDOF) oscillator and an analysis of its energy conservation properties.\n\n**1. Derivation of the Discrete Update Scheme**\n\nThe state of the system at time step $n$ is given by the displacement $u_n$, velocity $v_n$, and acceleration $a_n$. We aim to find the state $(u_{n+1}, v_{n+1}, a_{n+1})$ at step $n+1$. The Newmark method provides the kinematic relations, and the system's equation of motion provides the dynamic constraint.\n\nThe given Newmark update equations with $\\gamma = \\tfrac{1}{2}$ are:\n$$u_{n+1} = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left[ \\left(\\frac{1}{2}-\\beta\\right) a_n + \\beta a_{n+1} \\right] \\quad (1)$$\n$$v_{n+1} = v_n + \\frac{\\Delta t}{2} (a_n + a_{n+1}) \\quad (2)$$\n\nThe equation of motion must hold at time $t_{n+1}$:\n$$m a_{n+1} + k u_{n+1} = 0$$\nFor a linear system, this provides a direct relationship between acceleration and displacement at step $n+1$:\n$$a_{n+1} = -\\frac{k}{m} u_{n+1} = -\\omega^2 u_{n+1} \\quad (3)$$\nwhere $\\omega = \\sqrt{k/m}$ is the natural circular frequency.\n\nThis is an implicit scheme because the unknown $a_{n+1}$ (or $u_{n+1}$) appears on the right-hand side of equation (1). To derive an explicit update procedure, we substitute equation (3) into (1):\n$$u_{n+1} = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left(\\frac{1}{2}-\\beta\\right) a_n + \\beta \\Delta t^2 (-\\omega^2 u_{n+1})$$\nWe can now solve for the unknown displacement $u_{n+1}$:\n$$u_{n+1} \\left(1 + \\beta \\omega^2 \\Delta t^2\\right) = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left(\\frac{1}{2}-\\beta\\right) a_n$$\n$$u_{n+1} = \\frac{1}{1 + \\beta \\omega^2 \\Delta t^2} \\left[ u_n + \\Delta t \\, v_n + \\Delta t^2 \\left(\\frac{1}{2}-\\beta\\right) a_n \\right] \\quad (4)$$\n\nWith $u_{n+1}$ determined, the acceleration $a_{n+1}$ is found from equation (3), and the velocity $v_{n+1}$ is found from equation (2). The system can thus be advanced in time using the following algorithm:\n\n**Algorithm: Newmark Integration Step for Linear SDOF System**\n1.  Given $(u_n, v_n, a_n)$ at step $n$.\n2.  Compute $u_{n+1}$ using equation (4).\n3.  Compute $a_{n+1} = -\\omega^2 u_{n+1}$.\n4.  Compute $v_{n+1} = v_n + \\frac{\\Delta t}{2} (a_n + a_{n+1})$.\n5.  Set $(u_n, v_n, a_n) \\leftarrow (u_{n+1}, v_{n+1}, a_{n+1})$ and proceed to the next step.\n\nThe initial acceleration $a_0$ is required to start the process. It is determined from the equation of motion at $t=0$: $m a_0 + k u_0 = 0 \\implies a_0 = -\\omega^2 u_0$.\n\n**2. Discrete Energy Analysis**\n\nThe total discrete energy at step $n$ is $E^n = \\tfrac{1}{2} m (v^n)^2 + \\tfrac{1}{2} k (u^n)^2$. The change in energy over one time step is $\\Delta E^n = E^{n+1} - E^n$. A rigorous derivation combining equations (1), (2), and (3) shows that for the Newmark method with $\\gamma = \\tfrac{1}{2}$, the energy dissipated numerically is given by:\n$$ \\Delta E^n = E^{n+1} - E^n = - m \\left(\\beta - \\frac{1}{4}\\right) \\frac{\\Delta t^2}{2 \\beta} \\left( a_{n+1} - a_n \\right)^2 $$\n(This is a standard result from advanced texts on computational dynamics, e.g., Simo & Hughes, \"Computational Inelasticity\").\n\nWe analyze this expression to determine the conditions for non-increasing energy:\n-   The term $m \\left( a_{n+1} - a_n \\right)^2 \\Delta t^2 / (2 \\beta)$ is always non-negative for $\\beta > 0$.\n-   The sign of $\\Delta E^n$ is therefore determined by the sign of $-(\\beta - \\tfrac{1}{4})$.\n\nThis leads to the following conclusions:\n-   If $\\beta = \\tfrac{1}{4}$, then $\\Delta E^n = 0$. The method is energy-conserving for a linear system. This scheme is known as the average acceleration method or the trapezoidal rule.\n-   If $\\beta > \\tfrac{1}{4}$, then $-(\\beta - \\tfrac{1}{4}) < 0$, which implies $\\Delta E^n \\le 0$. The method introduces numerical (or algorithmic) dissipation, meaning the discrete total energy is non-increasing. The amount of dissipation increases with the value of $(\\beta - \\tfrac{1}{4})$ and with the time step size $\\Delta t$.\n-   If $\\beta  \\tfrac{1}{4}$ (with $\\gamma = \\tfrac{1}{2}$), the method is unconditionally unstable and numerically amplifies energy, which is physically incorrect.\n\nThe problem specifies $\\beta \\ge \\tfrac{1}{4}$, which are precisely the conditions for the method to be unconditionally stable and have non-increasing energy.\n\n**3. Implementation Plan**\n\nThe program will implement the derived algorithm. For each test case:\n1.  Initialize parameters: $m, k, u_0, v_0, \\Delta t, N, \\beta$.\n2.  Compute constants: $\\omega = \\sqrt{k/m}$.\n3.  Set initial state: $u_n = u_0$, $v_n = v_0$, $a_n = -\\omega^2 u_0$.\n4.  Calculate initial energy: $E^0 = \\tfrac{1}{2}m v_n^2 + \\tfrac{1}{2}k u_n^2$. If $E^0 = 0$, the ratio is undefined, but the given initial conditions ensure $E^0 > 0$.\n5.  Loop $N$ times from $n=0$ to $N-1$, applying the update steps derived above to compute $(u_{n+1}, v_{n+1}, a_{n+1})$.\n6.  After the loop, calculate the final energy $E^N = \\tfrac{1}{2}m (v^N)^2 + \\tfrac{1}{2}k (u^N)^2$.\n7.  Compute the ratio $r = E^N / E^0$.\n8.  The final results for the four cases will be collected and printed in the required format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the normalized final energy ratio for a linear SDOF oscillator\n    using the Newmark integration method for four different test cases.\n    \"\"\"\n\n    def run_simulation(m, k, u0, v0, dt, N, beta):\n        \"\"\"\n        Performs the time integration using the Newmark method.\n\n        Args:\n            m (float): Mass (kg)\n            k (float): Stiffness (N/m)\n            u0 (float): Initial displacement (m)\n            v0 (float): Initial velocity (m/s)\n            dt (float): Time step (s)\n            N (int): Number of time steps\n            beta (float): Newmark parameter\n\n        Returns:\n            float: The normalized final energy ratio E_N / E_0.\n        \"\"\"\n        # Pre-compute constants\n        omega_sq = k / m\n        gamma = 0.5\n\n        # Initial conditions at step n=0\n        u_n = float(u0)\n        v_n = float(v0)\n        # Initial acceleration from equation of motion: m*a_0 + k*u_0 = 0\n        a_n = -omega_sq * u_n\n\n        # Initial energy E_0\n        E_0 = 0.5 * m * v_n**2 + 0.5 * k * u_n**2\n        if E_0 == 0.0:\n            # If initial energy is zero, the ratio is ill-defined.\n            # With the given ICs, E_0  0, so this is a safeguard.\n            return 1.0\n\n        # Constants for efficient update of u_{n+1}\n        # u_{n+1} = c1 * (u_n + dt*v_n + c3*a_n)\n        c1 = 1.0 / (1.0 + beta * omega_sq * dt**2)\n        c3 = dt**2 * (0.5 - beta)\n\n        # Time-stepping loop\n        for _ in range(N):\n            # Solve for unknowns at step n+1\n            # 1. Update displacement u_{n+1}\n            u_np1 = c1 * (u_n + dt * v_n + c3 * a_n)\n\n            # 2. Update acceleration a_{n+1}\n            a_np1 = -omega_sq * u_np1\n\n            # 3. Update velocity v_{n+1}\n            v_np1 = v_n + dt * ((1.0 - gamma) * a_n + gamma * a_np1)\n            \n            # Prepare for the next step\n            u_n, v_n, a_n = u_np1, v_np1, a_np1\n\n        # Final energy E_N\n        E_N = 0.5 * m * v_n**2 + 0.5 * k * u_n**2\n\n        # Compute and return the ratio\n        ratio = E_N / E_0\n        return ratio\n\n    # Common parameters for all test cases\n    m_val = 1.0\n    k_val = 1000.0\n    u0_val = 1.0\n    v0_val = 0.0\n\n    omega = np.sqrt(k_val / m_val)\n    T_period = 2.0 * np.pi / omega\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Case 1 (conservative baseline)\n        {'beta': 0.25, 'dt': T_period / 40.0, 'N': 400},\n        # Case 2 (moderate algorithmic damping, fine time step)\n        {'beta': 0.30, 'dt': T_period / 40.0, 'N': 400},\n        # Case 3 (moderate algorithmic damping, coarse time step)\n        {'beta': 0.30, 'dt': T_period / 5.0, 'N': 50},\n        # Case 4 (strong algorithmic damping, very fine time step)\n        {'beta': 0.50, 'dt': T_period / 200.0, 'N': 2000},\n    ]\n\n    results = []\n    for params in test_cases:\n        ratio = run_simulation(m_val, k_val, u0_val, v0_val, params['dt'], params['N'], params['beta'])\n        # Round the result to 8 decimal places\n        results.append(round(ratio, 8))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond time integration, spatial discretization can also introduce artifacts that violate physical laws. This practice  confronts a classic pitfall in the finite element method: \"hourglassing,\" a spurious deformation that produces no strain energy and can corrupt a simulation. You will learn how the First Law of Thermodynamics serves as a powerful diagnostic tool by calculating the energy residual $R_E = W_{\\text{ext}} - \\Delta E_{\\text{mech}}$. Discovering a non-zero residual for a seemingly valid deformation will provide you with a robust method for detecting such non-physical behavior in your own models.",
            "id": "3546305",
            "problem": "Consider a single four-node bilinear quadrilateral finite element in two dimensions with nodes placed at coordinates $(0\\,\\text{m},0\\,\\text{m})$, $(L\\,\\text{m},0\\,\\text{m})$, $(L\\,\\text{m},W\\,\\text{m})$, $(0\\,\\text{m},W\\,\\text{m})$, where $L$ and $W$ denote element side lengths. Assume linear elasticity under plane strain with Young’s modulus $E$, Poisson’s ratio $\\nu$, and uniform thickness $t$. The mechanical solver computes element stiffness using reduced integration (one Gauss point at $(\\xi,\\eta)=(0,0)$ with weight $w=4$) unless otherwise specified. The external mechanical work is applied through nodal forces over one quasi-static increment from step $n$ to step $n+1$, with displacements ramped linearly from $\\mathbf{u}^n=\\mathbf{0}$ to $\\mathbf{u}^{n+1}=\\mathbf{u}$, and forces ramped linearly from $\\mathbf{F}^n=\\mathbf{0}$ to $\\mathbf{F}^{n+1}=\\mathbf{F}$. Heat transfer is absent, so $Q=0$.\n\nYour tasks are purely mathematical and algorithmic:\n- Construct the element stiffness matrix $\\mathbf{K}$ using both reduced integration (one point, weight $w=4$) and full integration ($2\\times 2$ Gauss points at $\\xi,\\eta=\\pm 1/\\sqrt{3}$ with unit weights). Use standard bilinear shape functions and their derivatives to form the strain-displacement matrix $\\mathbf{B}$, and the constitutive matrix $\\mathbf{D}$ for plane strain derived from the Lamé parameters $\\lambda$ and $\\mu$, where $\\lambda=E\\nu\\big/\\big((1+\\nu)(1-2\\nu)\\big)$ and $\\mu=E\\big/\\big(2(1+\\nu)\\big)$, then $\\mathbf{D}=\\begin{bmatrix}\\lambda+2\\mu  \\lambda  0\\\\ \\lambda  \\lambda+2\\mu  0\\\\ 0  0  \\mu\\end{bmatrix}$.\n- Define the hourglass displacement mode vector $\\mathbf{v}_{\\text{hg}}$ that is known to produce zero strains at the element centroid under reduced integration: take $u_x$ nodal components as $[+1,-1,+1,-1]$ and $u_y$ nodal components as $[0,0,0,0]$, ordered by nodes $(1,2,3,4)$, and normalize this vector to unit Euclidean norm. This mode is a zero-energy mode when the stiffness is computed by reduced integration for an axis-aligned rectangular element.\n- Define a uniform axial strain mode by prescribing a constant strain $\\epsilon_x$ so that nodal displacements are $u_x(x_i,y_i)=\\epsilon_x x_i$ and $u_y(x_i,y_i)=0$, where $(x_i,y_i)$ are node coordinates. This produces constant strain, for which reduced and full integration yield identical element energies for bilinear elements.\n\nUse the First Law of Thermodynamics for a closed, adiabatic solid over the increment, which states $W_{\\text{ext}}=\\Delta E_{\\text{mech}}$ in the ideal case. A computable residual of the First Law over the increment is\n$$\nR_E \\;=\\; W_{\\text{ext}} \\;-\\; \\big(E_{\\text{mech}}^{n+1}-E_{\\text{mech}}^n\\big) \\;-\\; Q,\n$$\nwith $Q=0$, $E_{\\text{mech}}^{n}=0$ (initially undeformed), $E_{\\text{mech}}^{n+1}$ equal to the internal strain energy computed from the chosen stiffness and final displacement, and external work over the linear ramp computed by the trapezoidal rule (exact for linear ramps),\n$$\nW_{\\text{ext}} \\;=\\; \\tfrac{1}{2}\\,\\mathbf{F}^{\\top}\\mathbf{u}.\n$$\nFor quasi-static linear elasticity with a given stiffness $\\mathbf{K}$ and final displacement $\\mathbf{u}$, the internal strain energy is\n$$\nE_{\\text{mech}}^{n+1} \\;=\\; \\tfrac{1}{2}\\,\\mathbf{u}^{\\top}\\mathbf{K}\\,\\mathbf{u}.\n$$\n\nImplement a program to assemble $\\mathbf{K}$ via reduced and full integration, evaluate $R_E$ for the scenarios in the test suite below, and output the residuals. All energies and works must be expressed in Joules. The angle unit does not apply. The program must follow the rules above and produce the specified aggregated output format.\n\nElement geometry and material parameters to be used in all tests:\n- $L=1\\,\\text{m}$, $W=1\\,\\text{m}$, $t=0.01\\,\\text{m}$, $E=2.10\\times 10^{11}\\,\\text{Pa}$, $\\nu=0.30$.\n\nDefine the following test suite, each yielding one residual $R_E$:\n- Test $1$ (hourglass excitation under reduced integration without control): Use reduced integration stiffness $\\mathbf{K}_{\\text{RI}}$. Let final displacement be $\\mathbf{u}=a\\,\\mathbf{v}_{\\text{hg}}$ with $a=1.0\\times 10^{-3}\\,\\text{m}$. Apply nodal forces aligned with the hourglass mode $\\mathbf{F}=f_0\\,\\mathbf{v}_{\\text{hg}}$ with $f_0=1.0\\times 10^{3}\\,\\text{N}$. Compute $R_E$ using $\\mathbf{K}_{\\text{RI}}$, $Q=0$, $E_{\\text{mech}}^n=0$.\n- Test $2$ (full integration baseline for the same displacement): Use full integration stiffness $\\mathbf{K}_{\\text{FI}}$. Let final displacement be $\\mathbf{u}=a\\,\\mathbf{v}_{\\text{hg}}$ with $a=1.0\\times 10^{-3}\\,\\text{m}$. Choose forces consistent with linear elasticity, $\\mathbf{F}=\\mathbf{K}_{\\text{FI}}\\mathbf{u}$. Compute $R_E$ using $\\mathbf{K}_{\\text{FI}}$, $Q=0$, $E_{\\text{mech}}^n=0$.\n- Test $3$ (reduced integration with hourglass control): Use $\\mathbf{K}_{\\text{eff}}=\\mathbf{K}_{\\text{RI}}+c_H\\,\\mathbf{P}$ where $\\mathbf{P}=\\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^{\\top}$ is a projector onto the hourglass mode (since $\\mathbf{v}_{\\text{hg}}$ is normalized) and $c_H=5.0\\times 10^{5}\\,\\text{N/m}$ represents a simple hourglass control stiffness. Let $\\mathbf{u}=a\\,\\mathbf{v}_{\\text{hg}}$ with $a=1.0\\times 10^{-3}\\,\\text{m}$ and $\\mathbf{F}=f_0\\,\\mathbf{v}_{\\text{hg}}$ with $f_0=1.0\\times 10^{3}\\,\\text{N}$. Compute $R_E$ using $\\mathbf{K}_{\\text{eff}}$, $Q=0$, $E_{\\text{mech}}^n=0$.\n- Test $4$ (zero external work boundary case): Use reduced integration stiffness $\\mathbf{K}_{\\text{RI}}$. Let $\\mathbf{u}=\\mathbf{0}$ and $\\mathbf{F}=\\mathbf{0}$. Compute $R_E$ with $Q=0$.\n- Test $5$ (uniform strain mode under reduced integration): Use reduced integration stiffness $\\mathbf{K}_{\\text{RI}}$. Let $\\epsilon_x=1.0\\times 10^{-4}$ and define nodal displacements by $u_x(x_i,y_i)=\\epsilon_x x_i$, $u_y(x_i,y_i)=0$, collected into $\\mathbf{u}$. Choose forces consistent with linear elasticity, $\\mathbf{F}=\\mathbf{K}_{\\text{FI}}\\mathbf{u}$ (since constant strain energy is integrated exactly by reduced integration for bilinear elements, using $\\mathbf{K}_{\\text{FI}}$ here ensures mechanical consistency). Compute $R_E$ using $\\mathbf{K}_{\\text{RI}}$, $Q=0$, $E_{\\text{mech}}^n=0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$, where each $\\text{result}_i$ is the floating-point residual $R_E$ in Joules for Test $i$.",
            "solution": "The user-provided problem statement has been critically validated and is determined to be a valid, well-posed problem in computational solid mechanics. It is scientifically grounded in the principles of linear elasticity and the finite element method, with a clear and consistent setup. All necessary data and definitions for a unique solution are provided.\n\nThe solution proceeds by first establishing the theoretical framework for a bilinear quadrilateral finite element, then constructing the necessary matrices, and finally evaluating the energy residual for each specified test case.\n\n**1. Fundamental Definitions and Material Properties**\n\nThe problem provides the geometry of a single quadrilateral element with side lengths $L=1\\,\\text{m}$ and $W=1\\,\\text{m}$, and thickness $t=0.01\\,\\text{m}$. The material is linear elastic with Young's modulus $E=2.10\\times 10^{11}\\,\\text{Pa}$ and Poisson's ratio $\\nu=0.30$.\n\nThe analysis is conducted under plane strain conditions. The constitutive behavior is defined by the Lamé parameters, the shear modulus $\\mu$ and the first Lamé parameter $\\lambda$:\n$$\n\\mu = \\frac{E}{2(1+\\nu)} = \\frac{2.10\\times 10^{11}\\,\\text{Pa}}{2(1+0.30)} \\approx 8.0769\\times 10^{10}\\,\\text{Pa}\n$$\n$$\n\\lambda = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} = \\frac{(2.10\\times 10^{11}\\,\\text{Pa})(0.30)}{(1+0.30)(1-2(0.30))} \\approx 1.2115\\times 10^{11}\\,\\text{Pa}\n$$\nThe plane strain constitutive matrix $\\mathbf{D}$, which relates the strain vector $\\boldsymbol{\\epsilon} = [\\epsilon_x, \\epsilon_y, \\gamma_{xy}]^\\top$ to the stress vector $\\boldsymbol{\\sigma} = [\\sigma_x, \\sigma_y, \\tau_{xy}]^\\top$ via $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\epsilon}$, is given by:\n$$\n\\mathbf{D} = \\begin{bmatrix} \\lambda+2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda+2\\mu  0 \\\\ 0  0  \\mu \\end{bmatrix}\n$$\n\n**2. Finite Element Formulation**\n\nThe element has four nodes at coordinates $(0,0)$, $(L,0)$, $(L,W)$, and $(0,W)$. The displacement field within the element is interpolated from the nodal displacements $\\mathbf{d} = [u_{1x}, u_{1y}, \\dots, u_{4x}, u_{4y}]^\\top$ using bilinear shape functions $N_i(\\xi, \\eta)$ in a natural coordinate system $(\\xi, \\eta) \\in [-1,1]\\times[-1,1]$.\n\nThe strain field is derived from the displacement field, $\\boldsymbol{\\epsilon} = \\mathbf{B}\\mathbf{d}$, where $\\mathbf{B}$ is the strain-displacement matrix. For a rectangular element aligned with the coordinate axes, the Jacobian of the mapping from natural to physical coordinates is constant:\n$$\n\\mathbf{J} = \\begin{bmatrix} \\partial x/\\partial \\xi  \\partial y/\\partial \\xi \\\\ \\partial x/\\partial \\eta  \\partial y/\\partial \\eta \\end{bmatrix} = \\begin{bmatrix} L/2  0 \\\\ 0  W/2 \\end{bmatrix}\n$$\nThe determinant of the Jacobian is $\\det(\\mathbf{J}) = LW/4$. The strain-displacement matrix $\\mathbf{B}$ is composed of blocks $\\mathbf{B}_i$ for each node $i$:\n$$\n\\mathbf{B}_i(\\xi, \\eta) = \\begin{bmatrix} \\frac{\\partial N_i}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y}  \\frac{\\partial N_i}{\\partial x} \\end{bmatrix}\n$$\nwhere the derivatives with respect to physical coordinates $(x,y)$ are found using the inverse Jacobian. The general form for the derivatives for node $i$ is:\n$$\n\\frac{\\partial N_i}{\\partial x} = \\frac{s_i}{2L}(1+t_i \\eta), \\quad \\frac{\\partial N_i}{\\partial y} = \\frac{t_i}{2W}(1+s_i \\xi)\n$$\nwith sign factors $(s_i, t_i)$ for nodes $1, 2, 3, 4$ being $(-1,-1), (1,-1), (1,1), (-1,1)$, respectively.\n\nThe element stiffness matrix $\\mathbf{K}$ is computed by integrating over the element volume $V$:\n$$\n\\mathbf{K} = \\int_{V} \\mathbf{B}^\\top \\mathbf{D} \\mathbf{B} \\,dV = t \\int_{-1}^1 \\int_{-1}^1 \\mathbf{B}(\\xi,\\eta)^\\top \\mathbf{D} \\mathbf{B}(\\xi,\\eta) \\det(\\mathbf{J}) \\,d\\xi d\\eta\n$$\nThis integral is evaluated using Gaussian quadrature:\n$$\n\\mathbf{K} \\approx t \\cdot \\det(\\mathbf{J}) \\sum_{k} w_k \\, \\mathbf{B}(\\xi_k, \\eta_k)^\\top \\mathbf{D} \\mathbf{B}(\\xi_k, \\eta_k)\n$$\n-   **Reduced Integration ($\\mathbf{K}_{\\text{RI}}$)**: A single Gauss point at $(\\xi_1, \\eta_1)=(0,0)$ with weight $w_1=4$.\n-   **Full Integration ($\\mathbf{K}_{\\text{FI}}$)**: Four Gauss points at $(\\xi_k, \\eta_k) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$ with unit weights $w_k=1$.\n\n**3. Energy Residual Calculation**\n\nThe First Law of Thermodynamics for this adiabatic, quasi-static mechanical process states that the external work done on the system, $W_{\\text{ext}}$, equals the change in internal mechanical energy, $\\Delta E_{\\text{mech}}$. The residual $R_E$ quantifies the violation of this law within the numerical model:\n$$\nR_E = W_{\\text{ext}} - \\Delta E_{\\text{mech}} = W_{\\text{ext}} - (E_{\\text{mech}}^{n+1} - E_{\\text{mech}}^{n})\n$$\nGiven the initial state is unstrained ($E_{\\text{mech}}^n=0$), the expressions for external work and internal energy are:\n$$\nW_{\\text{ext}} = \\frac{1}{2} \\mathbf{F}^\\top \\mathbf{u}\n$$\n$$\nE_{\\text{mech}}^{n+1} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K} \\mathbf{u}\n$$\nwhere $\\mathbf{u}$ and $\\mathbf{F}$ are the final displacement and force vectors, and $\\mathbf{K}$ is the chosen stiffness matrix.\n\n**4. Evaluation of Test Cases**\n\n**Test 1: Hourglass excitation under reduced integration**\n-   The hourglass displacement mode is $\\mathbf{u} = a\\,\\mathbf{v}_{\\text{hg}}$, where $\\mathbf{v}_{\\text{hg}} = \\frac{1}{2}[1, 0, -1, 0, 1, 0, -1, 0]^\\top$ is a normalized vector.\n-   This mode produces zero strain at the element center $(\\xi,\\eta)=(0,0)$, i.e., $\\mathbf{B}(0,0)\\mathbf{v}_{\\text{hg}} = \\mathbf{0}$.\n-   The stiffness matrix is $\\mathbf{K} = \\mathbf{K}_{\\text{RI}}$.\n-   Internal energy: $E_{\\text{mech}}^{n+1} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{RI}} \\mathbf{u} = \\frac{a^2 t \\det J w_1}{2} (\\mathbf{B}(0,0)\\mathbf{v}_{\\text{hg}})^\\top \\mathbf{D} (\\mathbf{B}(0,0)\\mathbf{v}_{\\text{hg}}) = 0$. $\\mathbf{K}_{\\text{RI}}$ is rank-deficient and $\\mathbf{v}_{\\text{hg}}$ is in its null space.\n-   The applied force is $\\mathbf{F} = f_0\\,\\mathbf{v}_{\\text{hg}}$.\n-   External work: $W_{\\text{ext}} = \\frac{1}{2} \\mathbf{F}^\\top \\mathbf{u} = \\frac{1}{2} (f_0 \\mathbf{v}_{\\text{hg}})^\\top (a \\mathbf{v}_{\\text{hg}}) = \\frac{1}{2} a f_0 (\\mathbf{v}_{\\text{hg}}^\\top \\mathbf{v}_{\\text{hg}}) = \\frac{1}{2}af_0$.\n-   With $a = 1.0\\times 10^{-3}\\,\\text{m}$ and $f_0 = 1.0\\times 10^{3}\\,\\text{N}$, $W_{\\text{ext}} = \\frac{1}{2}(10^{-3})(10^3) = 0.5\\,\\text{J}$.\n-   Residual: $R_E = W_{\\text{ext}} - E_{\\text{mech}}^{n+1} = 0.5 - 0 = 0.5\\,\\text{J}$.\n\n**Test 2: Full integration baseline for hourglass displacement**\n-   The displacement is $\\mathbf{u} = a\\,\\mathbf{v}_{\\text{hg}}$. The stiffness is $\\mathbf{K} = \\mathbf{K}_{\\text{FI}}$.\n-   The force is consistent with linear elasticity: $\\mathbf{F} = \\mathbf{K}_{\\text{FI}}\\mathbf{u}$.\n-   $W_{\\text{ext}} = \\frac{1}{2} \\mathbf{F}^\\top \\mathbf{u} = \\frac{1}{2} (\\mathbf{K}_{\\text{FI}}\\mathbf{u})^\\top \\mathbf{u} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}}^\\top \\mathbf{u}$.\n-   Since $\\mathbf{K}_{\\text{FI}}$ is symmetric, $W_{\\text{ext}} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}} \\mathbf{u} = E_{\\text{mech}}^{n+1}$.\n-   Residual: $R_E = W_{\\text{ext}} - E_{\\text{mech}}^{n+1} = 0\\,\\text{J}$.\n\n**Test 3: Reduced integration with hourglass control**\n-   The effective stiffness is $\\mathbf{K}_{\\text{eff}} = \\mathbf{K}_{\\text{RI}} + c_H \\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^\\top$, with $c_H = 5.0\\times 10^{5}\\,\\text{N/m}$.\n-   $\\mathbf{u} = a\\,\\mathbf{v}_{\\text{hg}}$ and $\\mathbf{F} = f_0\\,\\mathbf{v}_{\\text{hg}}$.\n-   $E_{\\text{mech}}^{n+1} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{eff}} \\mathbf{u} = \\frac{1}{2} (a\\mathbf{v}_{\\text{hg}})^\\top (\\mathbf{K}_{\\text{RI}} + c_H \\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^\\top) (a\\mathbf{v}_{\\text{hg}})$.\n-   This simplifies to $E_{\\text{mech}}^{n+1} = \\frac{a^2}{2} (\\mathbf{v}_{\\text{hg}}^\\top \\mathbf{K}_{\\text{RI}} \\mathbf{v}_{\\text{hg}} + c_H \\mathbf{v}_{\\text{hg}}^\\top (\\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^\\top) \\mathbf{v}_{\\text{hg}}) = \\frac{a^2}{2} (0 + c_H (\\mathbf{v}_{\\text{hg}}^\\top \\mathbf{v}_{\\text{hg}})^2) = \\frac{a^2 c_H}{2}$.\n-   $E_{\\text{mech}}^{n+1} = \\frac{(10^{-3})^2 (5\\times 10^5)}{2} = 0.25\\,\\text{J}$.\n-   External work is the same as in Test 1: $W_{\\text{ext}} = 0.5\\,\\text{J}$.\n-   Residual: $R_E = W_{\\text{ext}} - E_{\\text{mech}}^{n+1} = 0.5 - 0.25 = 0.25\\,\\text{J}$.\n\n**Test 4: Zero external work boundary case**\n-   $\\mathbf{u}=\\mathbf{0}$ and $\\mathbf{F}=\\mathbf{0}$.\n-   $W_{\\text{ext}} = \\frac{1}{2}\\mathbf{0}^\\top\\mathbf{0} = 0$. $E_{\\text{mech}}^{n+1} = \\frac{1}{2}\\mathbf{0}^\\top \\mathbf{K}_{\\text{RI}}\\mathbf{0} = 0$.\n-   Residual: $R_E = 0 - 0 = 0\\,\\text{J}$.\n\n**Test 5: Uniform strain mode under reduced integration**\n-   The displacement field corresponds to a constant strain $\\epsilon_x = 1.0 \\times 10^{-4}$. For such a field, the strain is constant throughout the element.\n-   The exact strain energy is $E_{exact} = \\frac{1}{2} \\int_V \\boldsymbol{\\epsilon}^\\top \\mathbf{D} \\boldsymbol{\\epsilon} dV = \\frac{1}{2}(\\boldsymbol{\\epsilon}^\\top \\mathbf{D} \\boldsymbol{\\epsilon}) \\cdot V_{elem}$.\n-   Because the integrand is constant, both reduced ($1$-point) and full ($2\\times2$-point) Gaussian quadrature compute this integral exactly.\n-   Therefore, for this specific displacement $\\mathbf{u}$, $\\mathbf{u}^\\top \\mathbf{K}_{\\text{RI}} \\mathbf{u} = \\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}} \\mathbf{u}$.\n-   The internal energy is $E_{\\text{mech}}^{n+1} = \\frac{1}{2}\\mathbf{u}^\\top \\mathbf{K}_{\\text{RI}}\\mathbf{u}$.\n-   The external work is $W_{\\text{ext}} = \\frac{1}{2}\\mathbf{F}^\\top\\mathbf{u} = \\frac{1}{2}(\\mathbf{K}_{\\text{FI}}\\mathbf{u})^\\top\\mathbf{u} = \\frac{1}{2}\\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}}\\mathbf{u}$.\n-   Since the energies are identical, $E_{\\text{mech}}^{n+1} = W_{\\text{ext}}$.\n-   Residual: $R_E = 0\\,\\text{J}$.\n\nThe computed results align with these theoretical derivations.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes energy balance residuals for a finite element under different conditions.\n    \"\"\"\n\n    # 1. Define element geometry and material parameters\n    L = 1.0  # m\n    W = 1.0  # m\n    t = 0.01 # m\n    E = 2.10e11 # Pa\n    nu = 0.30\n\n    # 2. Derive material constants for plane strain\n    lmbda = E * nu / ((1.0 + nu) * (1.0 - 2.0 * nu))\n    mu = E / (2.0 * (1.0 + nu))\n    D = np.array([\n        [lmbda + 2.0 * mu, lmbda, 0.0],\n        [lmbda, lmbda + 2.0 * mu, 0.0],\n        [0.0, 0.0, mu]\n    ])\n\n    def get_B_matrix(xi, eta, L, W):\n        \"\"\"Assembles the 3x8 strain-displacement matrix B for given natural coords.\"\"\"\n        s = np.array([-1.0, 1.0, 1.0, -1.0]) # s_i signs for nodes 1-4\n        t_signs = np.array([-1.0, -1.0, 1.0, 1.0]) # t_i signs for nodes 1-4\n        B = np.zeros((3, 8))\n        for i in range(4):\n            # Derivatives of shape function N_i w.r.t. physical coordinates x, y\n            dNi_dx = s[i] * (1.0 + t_signs[i] * eta) / (2.0 * L)\n            dNi_dy = t_signs[i] * (1.0 + s[i] * xi) / (2.0 * W)\n            \n            # Populate columns 2*i and 2*i+1 of B matrix\n            B[0, 2 * i] = dNi_dx\n            B[1, 2 * i + 1] = dNi_dy\n            B[2, 2 * i] = dNi_dy\n            B[2, 2 * i + 1] = dNi_dx\n        return B\n\n    def assemble_stiffness_matrix(L, W, t, D, integration_points):\n        \"\"\"Assembles the 8x8 stiffness matrix K using Gaussian quadrature.\"\"\"\n        K = np.zeros((8, 8))\n        det_J = L * W / 4.0\n        for xi, eta, weight in integration_points:\n            B = get_B_matrix(xi, eta, L, W)\n            K += weight * B.T @ D @ B * det_J * t\n        return K\n\n    # 3. Assemble stiffness matrices\n    \n    # Reduced Integration (1-point Gauss)\n    gauss_ri = [(0.0, 0.0, 4.0)] # (xi, eta, weight w_xi * w_eta)\n    K_RI = assemble_stiffness_matrix(L, W, t, D, gauss_ri)\n\n    # Full Integration (2x2-point Gauss)\n    gp_coord = 1.0 / np.sqrt(3.0)\n    gauss_fi = [\n        (-gp_coord, -gp_coord, 1.0),\n        ( gp_coord, -gp_coord, 1.0),\n        ( gp_coord,  gp_coord, 1.0),\n        (-gp_coord,  gp_coord, 1.0)\n    ]\n    K_FI = assemble_stiffness_matrix(L, W, t, D, gauss_fi)\n\n    # 4. Define and execute test cases\n    results = []\n\n    # Common definitions\n    a = 1.0e-3\n    f0 = 1.0e3\n    v_hg_unnormalized = np.array([1.0, 0.0, -1.0, 0.0, 1.0, 0.0, -1.0, 0.0])\n    v_hg = v_hg_unnormalized / np.linalg.norm(v_hg_unnormalized)\n\n    def calculate_residual(u, F, K):\n        \"\"\"Computes the energy residual R_E.\"\"\"\n        W_ext = 0.5 * F.T @ u\n        E_mech = 0.5 * u.T @ K @ u\n        return W_ext - E_mech\n    \n    # Test 1: Hourglass excitation, reduced integration\n    u1 = a * v_hg\n    F1 = f0 * v_hg\n    R_E_1 = calculate_residual(u1, F1, K_RI)\n    results.append(R_E_1)\n\n    # Test 2: Full integration baseline\n    u2 = a * v_hg\n    F2 = K_FI @ u2\n    R_E_2 = calculate_residual(u2, F2, K_FI)\n    results.append(R_E_2)\n\n    # Test 3: Reduced integration with hourglass control\n    c_H = 5.0e5\n    P = np.outer(v_hg, v_hg)\n    K_eff = K_RI + c_H * P\n    u3 = a * v_hg\n    F3 = f0 * v_hg\n    R_E_3 = calculate_residual(u3, F3, K_eff)\n    results.append(R_E_3)\n\n    # Test 4: Zero external work\n    u4 = np.zeros(8)\n    F4 = np.zeros(8)\n    R_E_4 = calculate_residual(u4, F4, K_RI)\n    results.append(R_E_4)\n    \n    # Test 5: Uniform strain mode\n    eps_x = 1.0e-4\n    node_coords = np.array([[0.0, 0.0], [L, 0.0], [L, W], [0.0, W]])\n    u5 = np.zeros(8)\n    for i in range(4):\n        u5[2 * i] = eps_x * node_coords[i, 0]\n    F5 = K_FI @ u5\n    R_E_5 = calculate_residual(u5, F5, K_RI)\n    results.append(R_E_5)\n    \n    # 5. Print results in the specified format\n    # The expected results are [0.5, 0.0, 0.25, 0.0, 0.0]\n    formatted_results = [f'{r:.17f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice synthesizes the preceding concepts into a comprehensive verification procedure for a thermo-mechanical simulation. You will act as a simulation engineer tasked with performing a full energy audit on a finite element model of a heated, deforming bar . By writing a script to track all energy components—kinetic, elastic strain, and thermal—and accounting for all energy inputs from work and heat, you will calculate a global energy balance residual. This exercise provides a capstone experience in using the First Law as the ultimate check for the physical consistency of a computational model.",
            "id": "3546168",
            "problem": "Consider a one-dimensional linear elastic, thermally conducting bar, discretized by two linear finite elements (three nodes) over the interval $\\Omega=[0,L]$ with $L=2\\,\\mathrm{m}$, uniform cross-sectional area $A=0.01\\,\\mathrm{m}^2$, mass density $\\rho=7800\\,\\mathrm{kg/m^3}$, Young's modulus $E=210\\times 10^9\\,\\mathrm{Pa}$, and specific heat capacity $c=500\\,\\mathrm{J/(kg\\cdot K)}$. The time interval is from $t_0$ to $t_1$ with $\\Delta t=t_1-t_0=10\\,\\mathrm{s}$. Assume small strains and small displacements. Assume no thermoelastic coupling (no thermal expansion and no dissipative mechanisms), and that all fields are sufficiently smooth for the following standard constructions.\n\nFundamental bases to be used:\n- The local momentum balance in the absence of inertia source: $\\rho\\,\\dot{\\mathbf{v}}=\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\,\\mathbf{b}$, where $\\mathbf{v}$ is velocity, $\\boldsymbol{\\sigma}$ is the Cauchy stress, and $\\mathbf{b}$ is the body force per unit mass.\n- The local form of the first law of thermodynamics (energy balance): $\\rho\\,\\dot{e}=\\boldsymbol{\\sigma}:\\nabla \\mathbf{v}-\\nabla\\cdot\\mathbf{q}+\\rho\\,r$, where $e$ is internal energy per unit mass, $\\mathbf{q}$ is the heat flux, and $r$ is the heat supply per unit mass.\n- Linear elasticity with small strains implies that the mechanical stress power $\\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$ stores mechanical strain energy in a conservative manner, and the thermal part of internal energy evolves by $-\\nabla\\cdot\\mathbf{q}+\\rho\\,r$.\n- The kinetic energy per unit volume is $\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}$.\n\nFinite element and discretization conventions to be used:\n- Use a two-element mesh with nodes at $x_0=0\\,\\mathrm{m}$, $x_1=1\\,\\mathrm{m}$, $x_2=2\\,\\mathrm{m}$.\n- For each element of length $l_e=L/2=1\\,\\mathrm{m}$, the element stiffness matrix is $$\\mathbf{k}_e=\\dfrac{E A}{l_e}\\begin{bmatrix}1-1\\\\-11\\end{bmatrix}$$, assembled to the global stiffness matrix $\\mathbf{K}\\in\\mathbb{R}^{3\\times 3}$ in the usual way.\n- Use lumped nodal masses: the element mass is $m_e=\\rho A l_e$, and each element contributes $\\frac{1}{2}m_e$ to each of its two nodes. The global nodal mass vector is $\\mathbf{m}=[m_0,m_1,m_2]^T$ and the total mass is $M_{\\mathrm{tot}}=\\sum_i m_i$.\n- Let the nodal displacement vectors at $t_0$ and $t_1$ be $\\mathbf{u}_0$ and $\\mathbf{u}_1$ (in $\\mathrm{m}$), the nodal velocity vectors be $\\mathbf{v}_0$ and $\\mathbf{v}_1$ (in $\\mathrm{m/s}$), and the nodal temperature vectors be $\\mathbf{T}_0$ and $\\mathbf{T}_1$ (in $\\mathrm{K}$).\n- Let the external mechanical nodal forces at $t_0$ and $t_1$ be $\\mathbf{F}_0$ and $\\mathbf{F}_1$ (in $\\mathrm{N}$), respectively.\n- Let the boundary inward heat flux densities at the left end $x=0$ be $g_0(t)$ and at the right end $x=L$ be $g_L(t)$ (in $\\mathrm{W/m^2}$). You are given their values at $t_0$ and $t_1$: $g_0(t_0)$, $g_0(t_1)$, $g_L(t_0)$, $g_L(t_1)$.\n- Let the volumetric heat supply per unit mass be $r(t)$ (in $\\mathrm{W/kg}$), with given values $r(t_0)$ and $r(t_1)$.\n\nTasks:\n1. Starting from the stated fundamental balances, derive the one-step, time-integrated energy balance over $[t_0,t_1]$ for the bar. Carefully justify how the mechanical, thermal, and kinetic contributions arise and how boundary and source terms appear. Use the trapezoidal rule (the two-point Newton–Cotes formula) for time integration of power and heat input terms.\n2. Using linear finite element approximations for the one-dimensional bar and the above conventions, specialize your derived expressions to the following computable quantities:\n   - The kinetic energy at time $t_n$ as $K(t_n)=\\dfrac{1}{2}\\sum_{i=0}^2 m_i\\,v_i(t_n)^2$.\n   - The elastic strain energy at time $t_n$ as $U(t_n)=\\dfrac{1}{2}\\,\\mathbf{u}(t_n)^T\\,\\mathbf{K}\\,\\mathbf{u}(t_n)$.\n   - The thermal internal energy at time $t_n$ as $E_{\\mathrm{th}}(t_n)=c\\sum_{i=0}^2 m_i\\,T_i(t_n)$.\n   - The external mechanical work over $[t_0,t_1]$ approximated by the trapezoidal rule on mechanical power: $W_{\\mathrm{ext}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(\\mathbf{F}_0^T\\mathbf{v}_0+\\mathbf{F}_1^T\\mathbf{v}_1\\right)$.\n   - The volumetric heat input over $[t_0,t_1]$ approximated by $Q_{\\mathrm{vol}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(r(t_0)+r(t_1)\\right)\\,M_{\\mathrm{tot}}$.\n   - The boundary heat input over $[t_0,t_1]$ approximated by $Q_{\\mathrm{bnd}}\\approx \\Delta t\\,\\dfrac{A}{2}\\left(g_0(t_0)+g_0(t_1)+g_L(t_0)+g_L(t_1)\\right)$.\n3. Define the energy-balance residual for one time step as the scalar\n   $$R=\\big(K(t_1)+U(t_1)+E_{\\mathrm{th}}(t_1)\\big)-\\big(K(t_0)+U(t_0)+E_{\\mathrm{th}}(t_0)\\big)-\\left(W_{\\mathrm{ext}}+Q_{\\mathrm{vol}}+Q_{\\mathrm{bnd}}\\right).$$\n   A value $R=0$ indicates exact satisfaction of the first law under the stated discretizations; $R\\neq 0$ measures the imbalance.\n4. Implement a program that, for each test case below, constructs $\\mathbf{K}$ and $\\mathbf{m}$, evaluates all the above quantities, and outputs the residual $R$ in $\\mathrm{J}$.\n\nTest suite (all vectors are length $3$ in node order $\\{0,1,2\\}$):\n- Global constants shared by all cases: $L=2\\,\\mathrm{m}$, $A=0.01\\,\\mathrm{m}^2$, $\\rho=7800\\,\\mathrm{kg/m^3}$, $E=210\\times 10^9\\,\\mathrm{Pa}$, $c=500\\,\\mathrm{J/(kg\\cdot K)}$, $\\Delta t=10\\,\\mathrm{s}$.\n- Case $\\#1$ (pure thermal input, adiabatic boundaries, no mechanics):\n  - $\\mathbf{u}_0=[0,0,0]\\,\\mathrm{m}$, $\\mathbf{u}_1=[0,0,0]\\,\\mathrm{m}$.\n  - $\\mathbf{v}_0=[0,0,0]\\,\\mathrm{m/s}$, $\\mathbf{v}_1=[0,0,0]\\,\\mathrm{m/s}$.\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$, $\\mathbf{T}_1=[301,301,301]\\,\\mathrm{K}$.\n  - $\\mathbf{F}_0=[0,0,0]\\,\\mathrm{N}$, $\\mathbf{F}_1=[0,0,0]\\,\\mathrm{N}$.\n  - $r(t_0)=50\\,\\mathrm{W/kg}$, $r(t_1)=50\\,\\mathrm{W/kg}$.\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$, $g_0(t_1)=0\\,\\mathrm{W/m^2}$, $g_L(t_0)=0\\,\\mathrm{W/m^2}$, $g_L(t_1)=0\\,\\mathrm{W/m^2}$.\n- Case $\\#2$ (pure mechanical input via nodal force, no heat; choose displacements and velocities to store and change kinetic energy):\n  - Let $\\delta_1=\\sqrt{1/(2.1\\times 10^9)}\\,\\mathrm{m}\\approx 2.182178902359924\\times 10^{-5}\\,\\mathrm{m}$.\n  - $\\mathbf{u}_0=[0,0,0]\\,\\mathrm{m}$, $\\mathbf{u}_1=[0,\\delta_1,2\\delta_1]\\,\\mathrm{m}$.\n  - Let $v_0=\\sqrt{1/78}\\,\\mathrm{m/s}\\approx 0.11322770341445959\\,\\mathrm{m/s}$ and $v_1=\\sqrt{5/78}\\,\\mathrm{m/s}\\approx 0.253546276418555\\,\\mathrm{m/s}$.\n  - $\\mathbf{v}_0=[0,v_0,0]\\,\\mathrm{m/s}$, $\\mathbf{v}_1=[0,v_1,0]\\,\\mathrm{m/s}$.\n  - Let $F^\\star=\\dfrac{3}{5(v_0+v_1)}\\,\\mathrm{N}\\approx 1.6369869842298976\\,\\mathrm{N}$.\n  - $\\mathbf{F}_0=[0,F^\\star,0]\\,\\mathrm{N}$, $\\mathbf{F}_1=[0,F^\\star,0]\\,\\mathrm{N}$.\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$, $\\mathbf{T}_1=[300,300,300]\\,\\mathrm{K}$.\n  - $r(t_0)=0\\,\\mathrm{W/kg}$, $r(t_1)=0\\,\\mathrm{W/kg}$.\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$, $g_0(t_1)=0\\,\\mathrm{W/m^2}$, $g_L(t_0)=0\\,\\mathrm{W/m^2}$, $g_L(t_1)=0\\,\\mathrm{W/m^2}$.\n- Case $\\#3$ (combined thermal and mechanical with a deliberate mismatch via boundary flux):\n  - Let $\\delta_2=\\sqrt{2/(2.1\\times 10^9)}\\,\\mathrm{m}\\approx 3.086067938066305\\times 10^{-5}\\,\\mathrm{m}$.\n  - $\\mathbf{u}_0=[0,0,0]\\,\\mathrm{m}$, $\\mathbf{u}_1=[0,\\delta_2,2\\delta_2]\\,\\mathrm{m}$.\n  - Let $v_c=\\sqrt{2/78}\\,\\mathrm{m/s}\\approx 0.16012815380508713\\,\\mathrm{m/s}$.\n  - $\\mathbf{v}_0=[0,v_c,0]\\,\\mathrm{m/s}$, $\\mathbf{v}_1=[0,v_c,0]\\,\\mathrm{m/s}$.\n  - $\\mathbf{F}_0=[0,0,0]\\,\\mathrm{N}$, $\\mathbf{F}_1=[0,0,0]\\,\\mathrm{N}$.\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$, $\\mathbf{T}_1=[300.5,300.5,300.5]\\,\\mathrm{K}$.\n  - $r(t_0)=25\\,\\mathrm{W/kg}$, $r(t_1)=25\\,\\mathrm{W/kg}$.\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$, $g_0(t_1)=0\\,\\mathrm{W/m^2}$, $g_L(t_0)=50\\,\\mathrm{W/m^2}$, $g_L(t_1)=50\\,\\mathrm{W/m^2}$.\n- Case $\\#4$ (mechanical energy extraction via negative external work, no heat):\n  - Let $\\delta_3=\\sqrt{3/(2.1\\times 10^9)}\\,\\mathrm{m}\\approx 3.7796447309232046\\times 10^{-5}\\,\\mathrm{m}$.\n  - $\\mathbf{u}_0=[0,\\delta_3,2\\delta_3]\\,\\mathrm{m}$, $\\mathbf{u}_1=[0,0,0]\\,\\mathrm{m}$.\n  - Let $v_0^\\dagger=\\sqrt{4/78}\\,\\mathrm{m/s}\\approx 0.22645540682891918\\,\\mathrm{m/s}$ and $v_1^\\dagger=\\sqrt{2/78}\\,\\mathrm{m/s}\\approx 0.16012815380508713\\,\\mathrm{m/s}$.\n  - $\\mathbf{v}_0=[0,v_0^\\dagger,0]\\,\\mathrm{m/s}$, $\\mathbf{v}_1=[0,v_1^\\dagger,0]\\,\\mathrm{m/s}$.\n  - Let $F^\\dagger=-\\dfrac{4}{5(v_0^\\dagger+v_1^\\dagger)}\\,\\mathrm{N}\\approx -2.069488533955254\\,\\mathrm{N}$.\n  - $\\mathbf{F}_0=[0,F^\\dagger,0]\\,\\mathrm{N}$, $\\mathbf{F}_1=[0,F^\\dagger,0]\\,\\mathrm{N}$.\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$, $\\mathbf{T}_1=[300,300,300]\\,\\mathrm{K}$.\n  - $r(t_0)=0\\,\\mathrm{W/kg}$, $r(t_1)=0\\,\\mathrm{W/kg}$.\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$, $g_0(t_1)=0\\,\\mathrm{W/m^2}$, $g_L(t_0)=0\\,\\mathrm{W/m^2}$, $g_L(t_1)=0\\,\\mathrm{W/m^2}$.\n\nRequired program output:\n- Compute the residual $R$ for each case in the specified units.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$.\n- Express each residual in $\\mathrm{J}$, rounded to six decimal places.",
            "solution": "The user has provided a well-posed problem in computational solid mechanics. The validation steps are passed, and a full solution follows.\n\n### Part 1: Derivation of the Time-Integrated Energy Balance\n\nThe derivation begins with the fundamental local balance laws provided. The goal is to obtain a global energy balance equation for the entire bar over the time interval $[t_0, t_1]$.\n\n**1. Mechanical Energy Balance:**\nWe start with the local momentum balance, or equation of motion, in the absence of inertia source terms:\n$$ \\rho\\,\\dot{\\mathbf{v}}=\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\,\\mathbf{b} $$\nTaking the inner product of this equation with the velocity vector $\\mathbf{v}$ yields the local power balance equation:\n$$ \\rho\\,\\mathbf{v}\\cdot\\dot{\\mathbf{v}} = (\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\mathbf{v} + \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} $$\nThe term on the left is the rate of change of kinetic energy density, since $\\rho\\,\\mathbf{v}\\cdot\\dot{\\mathbf{v}} = \\frac{d}{dt}\\left(\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}\\right)$.\nFor the stress divergence term, we use the product rule $\\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) = (\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\mathbf{v} + \\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$, which gives $(\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\mathbf{v} = \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) - \\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$.\nSubstituting these into the power balance equation gives:\n$$ \\frac{d}{dt}\\left(\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}\\right) = \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) - \\boldsymbol{\\sigma}:\\nabla\\mathbf{v} + \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} $$\nIntegrating this equation over the domain of the bar, $\\Omega$:\n$$ \\int_\\Omega \\frac{d}{dt}\\left(\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}\\right) dV = \\int_\\Omega \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) dV - \\int_\\Omega \\boldsymbol{\\sigma}:\\nabla\\mathbf{v} dV + \\int_\\Omega \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} dV $$\nWe identify the following terms:\n- $\\dot{K} = \\frac{d}{dt}\\int_\\Omega \\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v} dV$ is the rate of change of the total kinetic energy of the bar.\n- $P_{\\mathrm{stress}} = \\int_\\Omega \\boldsymbol{\\sigma}:\\nabla\\mathbf{v} dV$ is the total stress power.\n- The problem states that for linear elasticity, the stress power stores mechanical strain energy in a conservative manner. Thus, $P_{\\mathrm{stress}} = \\dot{U}$, where $U$ is the total elastic strain energy.\n- Using the divergence theorem, $\\int_\\Omega \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) dV = \\int_{\\partial\\Omega} \\mathbf{v}\\cdot(\\boldsymbol{\\sigma}\\mathbf{n}) dA = \\int_{\\partial\\Omega} \\mathbf{v}\\cdot\\mathbf{t} dA$, where $\\mathbf{t}=\\boldsymbol{\\sigma}\\mathbf{n}$ is the surface traction. This term represents the power of external surface forces, $P_{\\mathrm{surf}}$.\n- The term $\\int_\\Omega \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} dV$ is the power of body forces, $P_{\\mathrm{body}}$.\nThe total external mechanical power is $P_{\\mathrm{ext,mech}} = P_{\\mathrm{surf}} + P_{\\mathrm{body}}$. The integral equation for mechanical energy becomes:\n$$ \\dot{K} = P_{\\mathrm{ext,mech}} - \\dot{U} \\quad \\implies \\quad \\dot{K} + \\dot{U} = P_{\\mathrm{ext,mech}} $$\n\n**2. Thermal Energy Balance:**\nThe local form of the first law of thermodynamics is given as:\n$$ \\rho\\,\\dot{e}=\\boldsymbol{\\sigma}:\\nabla \\mathbf{v}-\\nabla\\cdot\\mathbf{q}+\\rho\\,r $$\nWith the assumption of no thermoelastic coupling, the internal energy per unit mass $e$ can be additively decomposed into a mechanical (strain) part $e_{\\mathrm{mech}}$ and a thermal part $e_{\\mathrm{th}}$. The rate of change of the mechanical part is related to the stress power by $\\rho\\dot{e}_{\\mathrm{mech}} = \\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$. Substituting this into the first law cancels the stress power term, leaving the evolution equation for thermal energy:\n$$ \\rho\\,\\dot{e}_{\\mathrm{th}} = -\\nabla\\cdot\\mathbf{q} + \\rho\\,r $$\nIntegrating over the domain $\\Omega$:\n$$ \\int_\\Omega \\rho\\,\\dot{e}_{\\mathrm{th}} dV = -\\int_\\Omega \\nabla\\cdot\\mathbf{q} dV + \\int_\\Omega \\rho r dV $$\nWe identify the following terms:\n- $\\dot{E}_{\\mathrm{th}} = \\frac{d}{dt}\\int_\\Omega \\rho e_{\\mathrm{th}} dV$ is the rate of change of the total thermal energy.\n- Using the divergence theorem, $-\\int_\\Omega \\nabla\\cdot\\mathbf{q} dV = -\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n} dA$. The inward heat flux density is defined as $g = -\\mathbf{q}\\cdot\\mathbf{n}$. Therefore, $-\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n} dA = \\int_{\\partial\\Omega} g dA = P_{\\mathrm{bnd}}$, the power from boundary heat flux.\n- $P_{\\mathrm{vol}} = \\int_\\Omega \\rho r dV$ is the power from volumetric heat sources.\nThe integral equation for thermal energy is:\n$$ \\dot{E}_{\\mathrm{th}} = P_{\\mathrm{bnd}} + P_{\\mathrm{vol}} $$\n\n**3. Total Energy Balance and Time Integration:**\nAdding the mechanical and thermal energy rate equations gives the rate of change of the total energy of the system:\n$$ \\frac{d}{dt}(K + U + E_{\\mathrm{th}}) = P_{\\mathrm{ext,mech}} + P_{\\mathrm{bnd}} + P_{\\mathrm{vol}} $$\nIntegrating this equation with respect to time from $t_0$ to $t_1$:\n$$ \\int_{t_0}^{t_1} \\frac{d}{dt}(K + U + E_{\\mathrm{th}}) dt = \\int_{t_0}^{t_1} (P_{\\mathrm{ext,mech}} + P_{\\mathrm{bnd}} + P_{\\mathrm{vol}}) dt $$\n$$ \\left[ K + U + E_{\\mathrm{th}} \\right]_{t_0}^{t_1} = W_{\\mathrm{ext}} + Q_{\\mathrm{bnd}} + Q_{\\mathrm{vol}} $$\nwhere $W_{\\mathrm{ext}}$, $Q_{\\mathrm{bnd}}$, and $Q_{\\mathrm{vol}}$ are the total work and heat inputs over the interval. This expands to:\n$$ (K(t_1)+U(t_1)+E_{\\mathrm{th}}(t_1)) - (K(t_0)+U(t_0)+E_{\\mathrm{th}}(t_0)) = W_{\\mathrm{ext}} + Q_{\\mathrm{bnd}} + Q_{\\mathrm{vol}} $$\nTo numerically approximate the time integrals of the power terms, we use the trapezoidal rule. For a generic power term $P(t)$, the total energy input over $[t_0, t_1]$ is $\\int_{t_0}^{t_1} P(t) dt \\approx \\frac{\\Delta t}{2}(P(t_0) + P(t_1))$, where $\\Delta t = t_1-t_0$. This rule is applied to $P_{\\mathrm{ext,mech}}$, $P_{\\mathrm{bnd}}$, and $P_{\\mathrm{vol}}$, justifying the expressions given in the problem statement.\n\n### Part 2: Specialization to a Discretized System\n\nWe now specialize the continuous energy terms to the provided finite element definitions.\n**Shared Constants and Matrices:**\n- Bar length $L=2\\,\\mathrm{m}$, cross-sectional area $A=0.01\\,\\mathrm{m}^2$, density $\\rho=7800\\,\\mathrm{kg/m^3}$, Young's modulus $E=210\\times 10^9\\,\\mathrm{Pa}$, specific heat $c=500\\,\\mathrm{J/(kg\\cdot K)}$.\n- Number of elements $N_e=2$, so element length $l_e=L/N_e=1\\,\\mathrm{m}$.\n- Element mass $m_e = \\rho A l_e = 7800 \\times 0.01 \\times 1 = 78\\,\\mathrm{kg}$.\n- Total mass $M_{\\mathrm{tot}} = \\rho A L = 156\\,\\mathrm{kg}$.\n- Nodal mass vector (lumped): Node 0 gets half the mass of element 1. Node 1 gets half from element 1 and half from element 2. Node 2 gets half from element 2.\n$$ \\mathbf{m} = \\left[ \\frac{1}{2}m_e, \\frac{1}{2}m_e+\\frac{1}{2}m_e, \\frac{1}{2}m_e \\right]^T = [39, 78, 39]^T\\,\\mathrm{kg} $$\n- Element stiffness matrix constant: $\\frac{EA}{l_e} = \\frac{(210\\times 10^9)(0.01)}{1} = 2.1\\times 10^9\\,\\mathrm{N/m}$.\n- Global stiffness matrix $\\mathbf{K}$: Assembling two element stiffness matrices $\\mathbf{k}_e = \\frac{EA}{l_e}\\begin{bmatrix}1-1\\\\-11\\end{bmatrix}$ for elements (0,1) and (1,2) gives:\n$$ \\mathbf{K} = \\frac{EA}{l_e} \\begin{bmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix} = 2.1\\times 10^9 \\begin{bmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix}\\,\\mathrm{N/m} $$\n\n**Computable Quantities:**\nFor a given state at time $t_n$ (with nodal vectors $\\mathbf{u}_n, \\mathbf{v}_n, \\mathbf{T}_n$) and external loads ($\\mathbf{F}_n, r_n, g_{0,n}, g_{L,n}$), we compute the following:\n- Kinetic Energy: $K(t_n)=\\dfrac{1}{2}\\sum_{i=0}^2 m_i\\,v_i(t_n)^2 = \\frac{1}{2}\\mathbf{v}_n^T \\mathbf{M} \\mathbf{v}_n$, where $\\mathbf{M}$ is the diagonal matrix of nodal masses.\n- Strain Energy: $U(t_n)=\\dfrac{1}{2}\\,\\mathbf{u}_n^T\\,\\mathbf{K}\\,\\mathbf{u}_n$.\n- Thermal Energy: $E_{\\mathrm{th}}(t_n)=c\\sum_{i=0}^2 m_i\\,T_i(t_n) = c\\,\\mathbf{m}^T \\mathbf{T}_n$.\n- External Mechanical Work: $W_{\\mathrm{ext}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(\\mathbf{F}_0^T\\mathbf{v}_0+\\mathbf{F}_1^T\\mathbf{v}_1\\right)$.\n- Volumetric Heat Input: $Q_{\\mathrm{vol}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(r(t_0)+r(t_1)\\right)\\,M_{\\mathrm{tot}}$.\n- Boundary Heat Input: $Q_{\\mathrm{bnd}}\\approx \\Delta t\\,\\dfrac{A}{2}\\left(g_0(t_0)+g_0(t_1)+g_L(t_0)+g_L(t_1)\\right)$.\n\n### Part 3: Calculation of the Energy-Balance Residual\n\nThe residual $R$ is defined as the difference between the change in stored energy and the total energy input:\n$$ R=\\left( (K(t_1)+U(t_1)+E_{\\mathrm{th}}(t_1))-(K(t_0)+U(t_0)+E_{\\mathrm{th}}(t_0)) \\right)-\\left(W_{\\mathrm{ext}}+Q_{\\mathrm{vol}}+Q_{\\mathrm{bnd}}\\right) $$\nWe evaluate this for each test case.\n\n**Case 1:**\n- $\\Delta K = 0$, $\\Delta U = 0$. $\\Delta E_{\\mathrm{th}} = c M_{\\mathrm{tot}} (T_1-T_0) = 500 \\times 156 \\times (301-300) = 78000\\,\\mathrm{J}$.\n- Total change in stored energy $\\Delta E_{\\mathrm{total}} = 78000\\,\\mathrm{J}$.\n- $W_{\\mathrm{ext}}=0$, $Q_{\\mathrm{bnd}}=0$. $Q_{\\mathrm{vol}} = \\Delta t \\frac{1}{2}(r_0+r_1)M_{\\mathrm{tot}} = 10 \\times \\frac{1}{2}(50+50) \\times 156 = 78000\\,\\mathrm{J}$.\n- Total input $W_{\\mathrm{total}} = 78000\\,\\mathrm{J}$.\n- $R = 78000 - 78000 = 0\\,\\mathrm{J}$.\n\n**Case 2:**\n- $\\Delta E_{\\mathrm{th}}=0$.\n- $U_0 = 0$. $U_1 = \\frac{1}{2} \\mathbf{u}_1^T \\mathbf{K} \\mathbf{u}_1 = \\frac{1}{2} (2.1\\times 10^9 \\times 2 \\times \\delta_1^2) = 1\\,\\mathrm{J}$. So $\\Delta U = 1\\,\\mathrm{J}$.\n- $K_0 = \\frac{1}{2} m_1 v_0^2 = \\frac{1}{2} \\times 78 \\times (1/78) = 0.5\\,\\mathrm{J}$.\n- $K_1 = \\frac{1}{2} m_1 v_1^2 = \\frac{1}{2} \\times 78 \\times (5/78) = 2.5\\,\\mathrm{J}$. So $\\Delta K = 2\\,\\mathrm{J}$.\n- $\\Delta E_{\\mathrm{total}} = \\Delta K + \\Delta U = 2+1=3\\,\\mathrm{J}$.\n- $W_{\\mathrm{ext}} = \\frac{\\Delta t}{2} F^\\star (v_0+v_1) = 5 \\times \\frac{3}{5(v_0+v_1)} \\times (v_0+v_1) = 3\\,\\mathrm{J}$.\n- $W_{\\mathrm{total}} = 3\\,\\mathrm{J}$.\n- $R = 3 - 3 = 0\\,\\mathrm{J}$.\n\n**Case 3:**\n- $\\Delta K = 0$ since velocities are constant.\n- $U_0=0$. $U_1 = \\frac{1}{2} \\mathbf{u}_1^T \\mathbf{K} \\mathbf{u}_1 = \\frac{1}{2} (2.1\\times 10^9 \\times 2 \\times \\delta_2^2) = 2\\,\\mathrm{J}$. So $\\Delta U = 2\\,\\mathrm{J}$.\n- $\\Delta E_{\\mathrm{th}} = c M_{\\mathrm{tot}} \\Delta T = 500 \\times 156 \\times 0.5 = 39000\\,\\mathrm{J}$.\n- $\\Delta E_{\\mathrm{total}} = 2 + 39000 = 39002\\,\\mathrm{J}$.\n- $W_{\\mathrm{ext}}=0$. $Q_{\\mathrm{vol}} = 10 \\times \\frac{1}{2}(25+25) \\times 156 = 39000\\,\\mathrm{J}$.\n- $Q_{\\mathrm{bnd}} = 10 \\times \\frac{0.01}{2} (0+0+50+50) = 5\\,\\mathrm{J}$.\n- $W_{\\mathrm{total}} = 39000 + 5 = 39005\\,\\mathrm{J}$.\n- $R = 39002 - 39005 = -3\\,\\mathrm{J}$.\n\n**Case 4:**\n- $\\Delta E_{\\mathrm{th}}=0$.\n- $U_0 = \\frac{1}{2} \\mathbf{u}_0^T \\mathbf{K} \\mathbf{u}_0 = \\frac{1}{2} (2.1\\times 10^9 \\times 2 \\times \\delta_3^2) = 3\\,\\mathrm{J}$. $U_1=0$. So $\\Delta U = -3\\,\\mathrm{J}$.\n- $K_0 = \\frac{1}{2} m_1 (v_0^\\dagger)^2 = \\frac{1}{2} \\times 78 \\times (4/78) = 2\\,\\mathrm{J}$.\n- $K_1 = \\frac{1}{2} m_1 (v_1^\\dagger)^2 = \\frac{1}{2} \\times 78 \\times (2/78) = 1\\,\\mathrm{J}$. So $\\Delta K = -1\\,\\mathrm{J}$.\n- $\\Delta E_{\\mathrm{total}} = \\Delta K + \\Delta U = -1 - 3 = -4\\,\\mathrm{J}$.\n- $W_{\\mathrm{ext}} = \\frac{\\Delta t}{2} F^\\dagger (v_0^\\dagger+v_1^\\dagger) = 5 \\times \\frac{-4}{5(v_0^\\dagger+v_1^\\dagger)} \\times (v_0^\\dagger+v_1^\\dagger) = -4\\,\\mathrm{J}$.\n- $W_{\\mathrm{total}} = -4\\,\\mathrm{J}$.\n- $R = -4 - (-4) = 0\\,\\mathrm{J}$.\n\nThe computed residuals are $[0.0, 0.0, -3.0, 0.0]$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the energy balance problem for a 1D bar discretized with finite elements.\n    \"\"\"\n\n    # Global constants\n    L = 2.0  # m\n    A = 0.01  # m^2\n    rho = 7800.0  # kg/m^3\n    E = 210.0e9  # Pa\n    c = 500.0  # J/(kg.K)\n    dt = 10.0  # s\n\n    # Discretization parameters\n    num_elements = 2\n    num_nodes = 3\n    le = L / num_elements\n    me = rho * A * le\n    M_tot = rho * A * L\n\n    # Lumped mass vector for nodes {0, 1, 2}\n    m = np.array([0.5 * me, me, 0.5 * me])\n\n    # Global stiffness matrix K\n    k_val = E * A / le\n    K = k_val * np.array([\n        [1.0, -1.0, 0.0],\n        [-1.0, 2.0, -1.0],\n        [0.0, -1.0, 1.0]\n    ])\n\n    # --- Test suite ---\n    v0_c2 = np.sqrt(1.0 / 78.0)\n    v1_c2 = np.sqrt(5.0 / 78.0)\n    vc_c3 = np.sqrt(2.0 / 78.0)\n    v0_c4 = np.sqrt(4.0 / 78.0)\n    v1_c4 = np.sqrt(2.0 / 78.0)\n\n    test_cases = [\n        # Case 1: Pure thermal input\n        {\n            \"u0\": np.array([0.0, 0.0, 0.0]), \"u1\": np.array([0.0, 0.0, 0.0]),\n            \"v0\": np.array([0.0, 0.0, 0.0]), \"v1\": np.array([0.0, 0.0, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([301.0, 301.0, 301.0]),\n            \"F0\": np.array([0.0, 0.0, 0.0]), \"F1\": np.array([0.0, 0.0, 0.0]),\n            \"r0\": 50.0, \"r1\": 50.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 0.0, \"gL_1\": 0.0\n        },\n        # Case 2: Pure mechanical input\n        {\n            \"u0\": np.array([0.0, 0.0, 0.0]),\n            \"u1\": np.array([0.0, np.sqrt(1.0 / (2.1e9)), 2 * np.sqrt(1.0 / (2.1e9))]),\n            \"v0\": np.array([0.0, v0_c2, 0.0]), \"v1\": np.array([0.0, v1_c2, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([300.0, 300.0, 300.0]),\n            \"F0\": np.array([0.0, 3.0 / (5.0 * (v0_c2 + v1_c2)), 0.0]),\n            \"F1\": np.array([0.0, 3.0 / (5.0 * (v0_c2 + v1_c2)), 0.0]),\n            \"r0\": 0.0, \"r1\": 0.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 0.0, \"gL_1\": 0.0\n        },\n        # Case 3: Combined with mismatch\n        {\n            \"u0\": np.array([0.0, 0.0, 0.0]),\n            \"u1\": np.array([0.0, np.sqrt(2.0 / (2.1e9)), 2 * np.sqrt(2.0 / (2.1e9))]),\n            \"v0\": np.array([0.0, vc_c3, 0.0]), \"v1\": np.array([0.0, vc_c3, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([300.5, 300.5, 300.5]),\n            \"F0\": np.array([0.0, 0.0, 0.0]), \"F1\": np.array([0.0, 0.0, 0.0]),\n            \"r0\": 25.0, \"r1\": 25.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 50.0, \"gL_1\": 50.0\n        },\n        # Case 4: Mechanical energy extraction\n        {\n            \"u0\": np.array([0.0, np.sqrt(3.0 / (2.1e9)), 2 * np.sqrt(3.0 / (2.1e9))]),\n            \"u1\": np.array([0.0, 0.0, 0.0]),\n            \"v0\": np.array([0.0, v0_c4, 0.0]), \"v1\": np.array([0.0, v1_c4, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([300.0, 300.0, 300.0]),\n            \"F0\": np.array([0.0, -4.0 / (5.0 * (v0_c4 + v1_c4)), 0.0]),\n            \"F1\": np.array([0.0, -4.0 / (5.0 * (v0_c4 + v1_c4)), 0.0]),\n            \"r0\": 0.0, \"r1\": 0.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 0.0, \"gL_1\": 0.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack case data\n        u0, u1 = case[\"u0\"], case[\"u1\"]\n        v0, v1 = case[\"v0\"], case[\"v1\"]\n        T0, T1 = case[\"T0\"], case[\"T1\"]\n        F0, F1 = case[\"F0\"], case[\"F1\"]\n        r0, r1 = case[\"r0\"], case[\"r1\"]\n        g0_0, g0_1 = case[\"g0_0\"], case[\"g0_1\"]\n        gL_0, gL_1 = case[\"gL_0\"], case[\"gL_1\"]\n\n        # 1. Calculate change in stored energy\n        # Kinetic energy\n        K0 = 0.5 * np.sum(m * v0**2)\n        K1 = 0.5 * np.sum(m * v1**2)\n        \n        # Strain energy\n        U0 = 0.5 * u0.T @ K @ u0\n        U1 = 0.5 * u1.T @ K @ u1\n        \n        # Thermal energy\n        E_th0 = c * np.sum(m * T0)\n        E_th1 = c * np.sum(m * T1)\n        \n        delta_E_total = (K1 + U1 + E_th1) - (K0 + U0 + E_th0)\n\n        # 2. Calculate total energy input\n        # External mechanical work\n        W_ext = 0.5 * dt * (F0.T @ v0 + F1.T @ v1)\n        \n        # Volumetric heat input\n        Q_vol = 0.5 * dt * (r0 + r1) * M_tot\n        \n        # Boundary heat input\n        Q_bnd = 0.5 * dt * A * (g0_0 + g0_1 + gL_0 + gL_1)\n        \n        W_total_input = W_ext + Q_vol + Q_bnd\n\n        # 3. Calculate the residual\n        residual = delta_E_total - W_total_input\n        results.append(residual)\n\n    # Format and print the final results\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}