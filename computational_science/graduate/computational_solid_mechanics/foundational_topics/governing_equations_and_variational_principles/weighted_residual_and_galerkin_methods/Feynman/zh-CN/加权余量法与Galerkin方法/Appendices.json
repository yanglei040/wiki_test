{
    "hands_on_practices": [
        {
            "introduction": "将连续的弱形式方程转化为离散的代数方程组，是应用伽辽金方法的首要步骤。本练习将引导你完成二维泊松方程的这一基本过程。通过推导线性三角形单元的单元刚度矩阵，并将其组装成一个简单的全局系统，你将亲手体验有限元方法的核心机制。",
            "id": "3610256",
            "problem": "考虑在一个多边形域 $\\Omega \\subset \\mathbb{R}^{2}$ 上，对于一个标量场 $u(x,y)$ 的稳态二维泊松方程，其传导系数 $k>0$ 为常数且各向同性：\n$$ -\\nabla \\cdot \\left( k \\nabla u \\right) = f \\quad \\text{in } \\Omega, $$\n在边界 $\\partial \\Omega$ 上有适当的本质边界条件。从加权余量陈述出发，并使用伽辽金检验函数选择（即检验空间和试探空间由相同的有限元基函数张成），推导三角形单元 $e$ 上的单元刚度矩阵表达式，其形式为如下积分：\n$$ K^{(e)} = \\int_{\\Omega_e} B^{T} k B \\, d\\Omega, $$\n其中 $B$ 由单元上线性形函数的空间梯度构成。证明对于线性三角形单元，$B$ 在整个单元上是常数，并根据节点坐标显式地计算该积分。\n\n然后，考虑方形域 $\\Omega = [0,1] \\times [0,1]$，它被从 $(0,0)$ 到 $(1,1)$ 的对角线离散为两个不重叠的线性三角形单元：\n- 单元 $e_1$ 的全局节点为 $\\{1,2,3\\}$，坐标为 $(x_1,y_1)=(0,0)$，$(x_2,y_2)=(1,0)$，$(x_3,y_3)=(1,1)$。\n- 单元 $e_2$ 的全局节点为 $\\{1,3,4\\}$，坐标为 $(x_1,y_1)=(0,0)$，$(x_3,y_3)=(1,1)$，$(x_4,y_4)=(0,1)$。\n\n使用推导出的 $B$ 和常数传导系数 $k$，通过在每个单元上计算 $\\int_{\\Omega_e} B^{T} k B \\, d\\Omega$ 来显式地计算 $K^{(e_1)}$ 和 $K^{(e_2)}$。根据全局节点编号 $\\{1,2,3,4\\}$，使用标准的有限元组装程序将这两个单元矩阵组装成 $4 \\times 4$ 的全局刚度矩阵 $K$。\n\n组装后的全局刚度矩阵项 $K_{23}$ 是什么，用 $k$ 精确表示？请以单个关于 $k$ 的精确符号表达式给出你的最终答案（无单位，无近似值）。",
            "solution": "过程始于对问题陈述的验证。\n\n### 第1步：提取已知条件\n- **控制方程**：稳态二维泊松方程由 $-\\nabla \\cdot (k \\nabla u) = f$ 在域 $\\Omega \\subset \\mathbb{R}^{2}$ 中给出。\n- **传导系数**：$k$ 是一个正的常数 ($k>0$) 且各向同性。\n- **方法**：推导应从加权余量陈述开始，并采用伽辽金法，其中检验函数和试探函数来自同一由有限元基函数张成的空间。\n- **目标表达式**：单元刚度矩阵 $K^{(e)}$ 必须以 $K^{(e)} = \\int_{\\Omega_e} B^{T} k B \\, d\\Omega$ 的形式推导。\n- **单元类型**：使用线性三角形单元。\n- **特定域**：方形域 $\\Omega = [0,1] \\times [0,1]$。\n- **离散化**：该域被从 $(0,0)$ 到 $(1,1)$ 的对角线分为两个不重叠的线性三角形单元 $e_1$ 和 $e_2$。\n- **单元连接性与坐标**：\n    - 单元 $e_1$：全局节点 $\\{1,2,3\\}$，坐标为 $(x_1,y_1)=(0,0)$，$(x_2,y_2)=(1,0)$，以及 $(x_3,y_3)=(1,1)$。\n    - 单元 $e_2$：全局节点 $\\{1,3,4\\}$，坐标为 $(x_1,y_1)=(0,0)$，$(x_3,y_3)=(1,1)$，以及 $(x_4,y_4)=(0,1)$。\n- **目标**：计算单元刚度矩阵 $K^{(e_1)}$ 和 $K^{(e_2)}$，将它们组装成全局刚度矩阵 $K$，并确定特定矩阵项 $K_{23}$。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题基于泊松方程（物理学和工程学中的一个基本偏微分方程）及其使用有限元法（FEM）的求解，这是一种标准的、成熟的数值技术。其原理是正确的，并且是计算固体力学和传热学领域的主流方法。\n- **适定性**：问题陈述清晰，提供了所有必要的信息。域、单元类型、节点坐标和连接性都已明确定义。这种设置确保了所求刚度矩阵项有唯一、稳定且有意义的解。\n- **客观性**：问题使用精确的数学和技术语言表述，没有任何主观性或模糊性。\n\n该问题没有任何无效性缺陷。它是科学合理的、适定的、完整的和可形式化的。\n\n### 第3步：结论与行动\n该问题是有效的。将提供完整的解答。\n\n### 解答推导\n\n推导从给定泊松方程的加权余量陈述开始。设 $w$ 为任意检验函数。加权余量陈述为：\n$$ \\int_{\\Omega} w \\left[ -\\nabla \\cdot (k \\nabla u) - f \\right] d\\Omega = 0 $$\n对散度项应用分部积分（格林第一恒等式）可得：\n$$ \\int_{\\Omega} \\nabla w \\cdot (k \\nabla u) d\\Omega - \\int_{\\partial \\Omega} w (k \\nabla u \\cdot \\mathbf{n}) ds - \\int_{\\Omega} w f d\\Omega = 0 $$\n这是问题的弱形式。对于刚度矩阵，我们关心的是涉及 $u$ 和 $w$ 的双线性形式。在有限元法中，域 $\\Omega$ 被离散化为单元 $\\Omega_e$。解 $u$ 在每个单元 $e$ 内通过形函数 $N_i$ 和节点值 $d_i^{(e)}$ 近似为 $u_h^{(e)}$：\n$$ u_h^{(e)}(x,y) = \\sum_{i=1}^{n_{en}} N_i^{(e)}(x,y) d_i^{(e)} = \\mathbf{N}^{(e)} \\mathbf{d}^{(e)} $$\n其中 $n_{en}$ 是每个单元的节点数（这里，$n_{en}=3$）。在伽辽金法中，检验函数 $w$ 从与试探（形）函数相同的空间中选取。因此，我们可以写出 $w_h = \\sum_{j=1}^{n_{en}} c_j N_j^{(e)}$，其中 $c_j$ 是任意系数。这要求弱形式对每个基函数 $N_j$ 单独成立。一个单元对方程组的贡献由一个矩阵给出，称为单元刚度矩阵 $K^{(e)}$，其矩阵项为：\n$$ K_{ji}^{(e)} = \\int_{\\Omega_e} k (\\nabla N_j) \\cdot (\\nabla N_i) d\\Omega $$\n近似解 $u_h^{(e)}$ 的梯度为：\n$$ \\nabla u_h^{(e)} = \\begin{pmatrix} \\frac{\\partial u_h^{(e)}}{\\partial x} \\\\ \\frac{\\partial u_h^{(e)}}{\\partial y} \\end{pmatrix} = \\sum_{i=1}^{n_{en}} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix} d_i^{(e)} = \\mathbf{B}^{(e)} \\mathbf{d}^{(e)} $$\n其中矩阵 $\\mathbf{B}^{(e)}$ 定义为：\n$$ \\mathbf{B}^{(e)} = \\begin{pmatrix} \\frac{\\partial N_1}{\\partial x}  \\frac{\\partial N_2}{\\partial x}  \\dots  \\frac{\\partial N_{n_{en}}}{\\partial x} \\\\ \\frac{\\partial N_1}{\\partial y}  \\frac{\\partial N_2}{\\partial y}  \\dots  \\frac{\\partial N_{n_{en}}}{\\partial y} \\end{pmatrix} $$\n刚度矩阵的被积函数可以用矩阵表示为 $k (\\nabla N_j)^T (\\nabla N_i)$。完整的矩阵变为：\n$$ K^{(e)} = \\int_{\\Omega_e} k \\mathbf{B}^{(e)T} \\mathbf{B}^{(e)} d\\Omega $$\n由于 $k$ 是一个标量常数，这等价于所要求的形式 $K^{(e)} = \\int_{\\Omega_e} \\mathbf{B}^{(e)T} k \\mathbf{B}^{(e)} d\\Omega$。\n\n对于一个三节点线性三角形单元，形函数是坐标的线性函数：$N_i(x,y) = a_i + b_i x + c_i y$。其导数是常数：$\\frac{\\partial N_i}{\\partial x} = b_i$ 和 $\\frac{\\partial N_i}{\\partial y} = c_i$。因此，矩阵 $\\mathbf{B}^{(e)}$ 在整个单元上是常数。系数 $b_i$ 和 $c_i$ 由下式给出：\n$$ b_i = \\frac{y_j - y_k}{2A_e}, \\quad c_i = \\frac{x_k - x_j}{2A_e} $$\n其中 $(i,j,k)$ 是 $(1,2,3)$ 的一个循环置换，$A_e$ 是单元的面积。$\\mathbf{B}^{(e)}$ 矩阵为：\n$$ \\mathbf{B}^{(e)} = \\frac{1}{2A_e} \\begin{pmatrix} y_2-y_3  y_3-y_1  y_1-y_2 \\\\ x_3-x_2  x_1-x_3  x_2-x_1 \\end{pmatrix} $$\n由于 $k$ 和 $\\mathbf{B}^{(e)}$ 在单元上是常数， $K^{(e)}$ 的积分简化为：\n$$ K^{(e)} = k \\mathbf{B}^{(e)T} \\mathbf{B}^{(e)} \\int_{\\Omega_e} d\\Omega = k A_e \\mathbf{B}^{(e)T} \\mathbf{B}^{(e)} $$\n\n现在，我们计算两个指定单元的刚度矩阵。\n\n**单元 $e_1$**：\n节点（局部 1, 2, 3）是全局节点（1, 2, 3），坐标为：$(x_1,y_1)=(0,0)$，$(x_2,y_2)=(1,0)$，$(x_3,y_3)=(1,1)$。\n面积 $A_{e_1} = \\frac{1}{2} |x_1(y_2-y_3)+x_2(y_3-y_1)+x_3(y_1-y_2)| = \\frac{1}{2}|0(0-1)+1(1-0)+1(0-0)| = \\frac{1}{2}$。\n$\\mathbf{B}^{(1)}$ 矩阵的分量为：\n$y_2-y_3 = 0-1 = -1$\n$y_3-y_1 = 1-0 = 1$\n$y_1-y_2 = 0-0 = 0$\n$x_3-x_2 = 1-1 = 0$\n$x_1-x_3 = 0-1 = -1$\n$x_2-x_1 = 1-0 = 1$\n由于 $2A_{e_1}=1$，$\\mathbf{B}^{(1)}$ 矩阵为：\n$$ \\mathbf{B}^{(1)} = \\frac{1}{1} \\begin{pmatrix} -1  1  0 \\\\ 0  -1  1 \\end{pmatrix} = \\begin{pmatrix} -1  1  0 \\\\ 0  -1  1 \\end{pmatrix} $$\n单元刚度矩阵 $K^{(e_1)}$ 是：\n$$ K^{(e_1)} = k A_{e_1} \\mathbf{B}^{(1)T} \\mathbf{B}^{(1)} = k \\left(\\frac{1}{2}\\right) \\begin{pmatrix} -1  0 \\\\ 1  -1 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} -1  1  0 \\\\ 0  -1  1 \\end{pmatrix} = \\frac{k}{2} \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix} $$\n该矩阵的行和列对应于全局节点 $\\{1, 2, 3\\}$。\n\n**单元 $e_2$**：\n局部节点（1, 2, 3）映射到全局节点（1, 3, 4）。坐标为：$(x_1,y_1)=(0,0)$ [全局节点1]，$(x_2,y_2)=(1,1)$ [全局节点3]，$(x_3,y_3)=(0,1)$ [全局节点4]。\n面积 $A_{e_2} = \\frac{1}{2}|0(1-1)+1(1-0)+0(0-1)| = \\frac{1}{2}$。\n$\\mathbf{B}^{(2)}$ 矩阵的分量（使用局部节点坐标）为：\n$y_2-y_3 = 1-1 = 0$\n$y_3-y_1 = 1-0 = 1$\n$y_1-y_2 = 0-1 = -1$\n$x_3-x_2 = 0-1 = -1$\n$x_1-x_3 = 0-0 = 0$\n$x_2-x_1 = 1-0 = 1$\n由于 $2A_{e_2}=1$，$\\mathbf{B}^{(2)}$ 矩阵为：\n$$ \\mathbf{B}^{(2)} = \\frac{1}{1} \\begin{pmatrix} 0  1  -1 \\\\ -1  0  1 \\end{pmatrix} = \\begin{pmatrix} 0  1  -1 \\\\ -1  0  1 \\end{pmatrix} $$\n单元刚度矩阵 $K^{(e_2)}$ 是：\n$$ K^{(e_2)} = k A_{e_2} \\mathbf{B}^{(2)T} \\mathbf{B}^{(2)} = k \\left(\\frac{1}{2}\\right) \\begin{pmatrix} 0  -1 \\\\ 1  0 \\\\ -1  1 \\end{pmatrix} \\begin{pmatrix} 0  1  -1 \\\\ -1  0  1 \\end{pmatrix} = \\frac{k}{2} \\begin{pmatrix} 1  0  -1 \\\\ 0  1  -1 \\\\ -1  -1  2 \\end{pmatrix} $$\n该矩阵的行和列对应于其局部节点 $\\{1, 2, 3\\}$，它们映射到全局节点 $\\{1, 3, 4\\}$。\n\n**全局刚度矩阵的组装与 $K_{23}$ 的求解**\n全局刚度矩阵 $K$ 是一个 $4 \\times 4$ 的矩阵。矩阵项 $K_{IJ}$ 是所有同时包含全局节点 $I$ 和全局节点 $J$ 的单元贡献的总和。\n$$ K_{IJ} = \\sum_{e} K_{ij}^{(e)} \\quad \\text{其中局部节点 } i \\to \\text{全局 } I \\text{ 且局部节点 } j \\to \\text{全局 } J $$\n我们需要找到矩阵项 $K_{23}$。该项表示全局节点 2 和全局节点 3 之间的相互作用。\n我们检查单元连接性：\n- 单元 $e_1$ 包含全局节点 $\\{1, 2, 3\\}$。它同时包含节点 2 和节点 3。\n- 单元 $e_2$ 包含全局节点 $\\{1, 3, 4\\}$。它不包含节点 2。\n因此，只有单元 $e_1$ 对全局刚度矩阵的 $K_{23}$ 项有贡献。\n$e_1$ 的局部编号为 $\\{1,2,3\\}$，这直接对应于全局编号 $\\{1,2,3\\}$。因此，来自 $e_1$ 对全局 $K_{23}$ 项的贡献就是矩阵项 $K^{(e_1)}_{23}$。\n根据我们对 $K^{(e_1)}$ 的计算：\n$$ K^{(e_1)} = \\frac{k}{2} \\begin{pmatrix} K^{(e_1)}_{11}  K^{(e_1)}_{12}  K^{(e_1)}_{13} \\\\ K^{(e_1)}_{21}  K^{(e_1)}_{22}  K^{(e_1)}_{23} \\\\ K^{(e_1)}_{31}  K^{(e_1)}_{32}  K^{(e_1)}_{33} \\end{pmatrix} = \\frac{k}{2} \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix} $$\n第2行第3列的矩阵项是 $K^{(e_1)}_{23} = \\frac{k}{2}(-1) = -\\frac{k}{2}$。\n由于没有其他单元对此项有贡献，组装后的全局刚度矩阵项为：\n$$ K_{23} = K^{(e_1)}_{23} = -\\frac{k}{2} $$\n最终答案是该矩阵项的符号表达式。",
            "answer": "$$\\boxed{-\\frac{k}{2}}$$"
        },
        {
            "introduction": "在有限元实践中，为了追求计算效率，常采用如减缩积分等近似方法，但这可能导致非物理的数值行为。本练习聚焦于其中最著名的一个问题：欠积分单元中的“沙漏”现象。通过分析一个典型的沙漏变形模式，你将理解为何它在单元中心不产生应变能（因而残差为零），并学会如何设计一个稳定项来恢复方法的正确性。",
            "id": "3610216",
            "problem": "在用于小应变、线性、各向同性、平面应变弹性问题的有限元（FE）方法中，考虑一个单一的双线性四边形单元（$\\mathrm{Q4}$）。母单元坐标为 $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$，该单元映射为一个边长为 $L$ 的正方形，其雅可比行列式为常数 $\\det J = L^{2}/4$。设双线性形函数为 $N_{1}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$，$N_{2}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$，$N_{3}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$，以及 $N_{4}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$。取拉梅参数为 $\\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)}$ 和 $G = \\frac{E}{2(1+\\nu)}$，其中 $E$ 为杨氏模量，$\\nu$ 为泊松比。在标准的伽辽金加权残差格式中，线性动量平衡的弱形式为 $\\int_{\\Omega} \\boldsymbol{\\varepsilon}(\\boldsymbol{v}) : \\mathbb{C} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\boldsymbol{v} \\cdot \\boldsymbol{b} \\, \\mathrm{d}\\Omega + \\int_{\\Gamma_{t}} \\boldsymbol{v} \\cdot \\boldsymbol{t} \\, \\mathrm{d}\\Gamma$，其中 $\\boldsymbol{u}$ 是位移场，$\\boldsymbol{v}$ 是检验函数，$\\boldsymbol{\\varepsilon}(\\cdot)$ 是小应变算子，$\\mathbb{C}$ 是由 $\\lambda$ 和 $G$ 表征的平面应变弹性张量，$\\boldsymbol{b}$ 是体力，$\\boldsymbol{t}$ 是面力。使用在 $(\\xi,\\eta)=(0,0)$ 处的单点高斯积分（减缩积分），内残差和刚度仅在单元中心处进行评估。这种减缩积分会产生非平凡的零残差方向（沙漏模式），这些模式在中心点产生零应变，因此内部虚功为零，从而导致秩亏。\n\n关注以下典型的沙漏模式：节点位移仅在 $x$ 方向有非零分量，为 $(u_{1x},u_{2x},u_{3x},u_{4x}) = (a,-a,a,-a)$，而 $(u_{1y},u_{2y},u_{3y},u_{4y}) = (0,0,0,0)$，其中 $a$ 是一个实数振幅。这种位移模式引起的应变 $\\varepsilon_{xx}$ 和 $\\varepsilon_{xy}$ 在 $(\\xi,\\eta)=(0,0)$ 处为零，因此用单点高斯积分计算的伽辽金残差沿此方向为零。\n\n你将构建一个基于残差的稳定化方法，通过增加一个仅限于沙漏零残差子空间的项来恢复秩，而不会导致过度刚化。令 $e(\\xi,\\eta)$ 表示Voigt标记法中的应变向量，其第三个分量取为张量剪应变的两倍，即 $e = [\\varepsilon_{xx}, \\varepsilon_{yy}, 2\\varepsilon_{xy}]^\\mathsf{T}$，因此应力向量 $s = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^\\mathsf{T}$ 满足 $s = \\mathbf{D} \\, e$，其中平面应变弹性矩阵为\n$$\n\\mathbf{D} = \\begin{bmatrix}\n\\lambda + 2 G  \\lambda  0 \\\\\n\\lambda  \\lambda + 2 G  0 \\\\\n0  0  G\n\\end{bmatrix}.\n$$\n定义限制在沙漏子空间内的稳定化能量泛函为\n$$\nU_{\\mathrm{stab}}(u_{h}) = \\frac{1}{2} \\, \\alpha \\sum_{q=1}^{4} e_{h}(\\xi_{q},\\eta_{q})^{\\mathsf{T}} \\, \\mathbf{D} \\, e_{h}(\\xi_{q},\\eta_{q}) \\, \\det J,\n$$\n其中 $(\\xi_{q},\\eta_{q})$ 是 $2 \\times 2$ 积分规则的四个高斯点，$\\det J = L^{2}/4$，$e_{h}$ 是由沙漏位移 $u_{h}$ 引起的应变（假设到沙漏零残差子空间上的投影是精确的，因此在该子空间之外没有稳定化作用），而 $\\alpha$ 是一个待确定的无量纲稳定化系数。\n\n从伽辽金弱形式和双线性形函数出发，并使用加权残差的观点，执行以下步骤：\n\n- 证明所选的 $u_{h}$ 在单点高斯积分下是一个零残差方向，即证明 $e_{h}(0,0) = \\boldsymbol{0}$，因此在中心点计算的内部虚功为零。\n- 使用完全的 $2 \\times 2$ 高斯积分计算此沙漏模式的精确伽辽金应变能 $U_{\\mathrm{full}}(u_{h})$，并用 $a$、$\\lambda$ 和 $G$ 表示结果。\n- 施加恢复秩且不过度刚化的校准条件 $U_{\\mathrm{stab}}(u_{h}) = U_{\\mathrm{full}}(u_{h})$，并求解稳定化系数 $\\alpha$。\n\n你的最终答案必须是 $\\alpha$ 的单个实数或封闭形式表达式。无需四舍五入，$\\alpha$ 无需单位。",
            "solution": "问题陈述经过严格验证，被认为是自洽的、有科学依据且定义明确的。它代表了计算固体力学领域中关于减缩积分有限元沙漏稳定化的一个标准问题。所有必要的数据和定义都已提供。\n\n解题过程按问题陈述的要求分三步进行。首先，我们将推导给定沙漏位移模式的应变场，并验证其在单元中心处为零。其次，我们将使用完全积分计算此模式的精确应变能。第三，我们将评估稳定化能量泛函，并使用校准条件来确定稳定化系数 $\\alpha$。\n\n步骤1：沙漏模式的应变场及零残差方向的验证。\n\n单元内的位移场 $\\boldsymbol{u}(\\xi, \\eta)$ 是通过双线性形函数 $N_i(\\xi, \\eta)$ 从节点位移插值得到的：\n$$\n\\boldsymbol{u}(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) \\boldsymbol{u}_i\n$$\n问题指定了一个特定的沙漏模式，我们将其表示为 $\\boldsymbol{u}_h$。该模式的节点位移由下式给出 $(u_{1x}, u_{2x}, u_{3x}, u_{4x}) = (a, -a, a, -a)$ 和 $(u_{1y}, u_{2y}, u_{3y}, u_{4y}) = (0, 0, 0, 0)$。\n\n$x$方向的位移场分量为：\n$$\nu_x(\\xi, \\eta) = N_1(\\xi, \\eta) a + N_2(\\xi, \\eta) (-a) + N_3(\\xi, \\eta) a + N_4(\\xi, \\eta) (-a)\n$$\n代入形函数：\n$$\nu_x(\\xi, \\eta) = \\frac{a}{4} [ (1-\\xi)(1-\\eta) - (1+\\xi)(1-\\eta) + (1+\\xi)(1+\\eta) - (1-\\xi)(1+\\eta) ]\n$$\n$$\nu_x(\\xi, \\eta) = \\frac{a}{4} [ (1-\\eta)(1-\\xi-1-\\xi) + (1+\\eta)(1+\\xi-1+\\xi) ]\n$$\n$$\nu_x(\\xi, \\eta) = \\frac{a}{4} [ (1-\\eta)(-2\\xi) + (1+\\eta)(2\\xi) ] = \\frac{a}{4} [-2\\xi + 2\\xi\\eta + 2\\xi + 2\\xi\\eta] = \\frac{a}{4} [4\\xi\\eta] = a\\xi\\eta\n$$\n$y$方向的位移场分量为 $u_y(\\xi, \\eta) = 0$。因此，沙漏位移场为 $\\boldsymbol{u}_h(\\xi, \\eta) = [a\\xi\\eta, 0]^{\\mathsf{T}}$。\n\n为了计算应变，我们需要从母单元坐标 $(\\xi, \\eta)$ 到物理坐标 $(x, y)$ 的映射。对于边长为 $L$ 且雅可比行列式为常数 $\\det \\mathbf{J} = L^2/4$ 的正方形单元，一个合适的映射是 $x = \\frac{L}{2}\\xi$ 和 $y = \\frac{L}{2}\\eta$。该映射的雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} L/2  0 \\\\ 0  L/2 \\end{bmatrix}\n$$\n其逆矩阵为 $\\mathbf{J}^{-1} = \\begin{bmatrix} 2/L  0 \\\\ 0  2/L \\end{bmatrix}$。梯度算子的变换关系为 $\\begin{pmatrix} \\partial/\\partial x \\\\ \\partial/\\partial y \\end{pmatrix} = \\mathbf{J}^{-1} \\begin{pmatrix} \\partial/\\partial \\xi \\\\ \\partial/\\partial \\eta \\end{pmatrix}$。因此，$\\frac{\\partial}{\\partial x} = \\frac{2}{L}\\frac{\\partial}{\\partial \\xi}$ 且 $\\frac{\\partial}{\\partial y} = \\frac{2}{L}\\frac{\\partial}{\\partial \\eta}$。\n\n小应变张量的分量为：\n$$\n\\varepsilon_{xx} = \\frac{\\partial u_x}{\\partial x} = \\frac{2}{L} \\frac{\\partial}{\\partial \\xi}(a\\xi\\eta) = \\frac{2a}{L}\\eta\n$$\n$$\n\\varepsilon_{yy} = \\frac{\\partial u_y}{\\partial y} = \\frac{2}{L} \\frac{\\partial}{\\partial \\eta}(0) = 0\n$$\n$$\n\\varepsilon_{xy} = \\frac{1}{2}\\left(\\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_y}{\\partial x}\\right) = \\frac{1}{2}\\left(\\frac{2}{L}\\frac{\\partial}{\\partial \\eta}(a\\xi\\eta) + 0\\right) = \\frac{a}{L}\\xi\n$$\n在指定的Voigt标记法中，应变向量 $e_h = [\\varepsilon_{xx}, \\varepsilon_{yy}, 2\\varepsilon_{xy}]^{\\mathsf{T}}$ 为：\n$$\ne_h(\\xi, \\eta) = \\left[ \\frac{2a}{L}\\eta, \\, 0, \\, \\frac{2a}{L}\\xi \\right]^{\\mathsf{T}}\n$$\n在单元中心 $(\\xi, \\eta) = (0, 0)$ 处计算应变向量：\n$$\ne_h(0, 0) = \\left[ \\frac{2a}{L}(0), \\, 0, \\, \\frac{2a}{L}(0) \\right]^{\\mathsf{T}} = [0, 0, 0]^{\\mathsf{T}} = \\boldsymbol{0}\n$$\n由于应变在中心点为零，使用单点高斯积分（其值仅依赖于中心点）计算的内部虚功为零。这证实了 $\\boldsymbol{u}_h$ 是减缩积分单元的一个零残差方向（沙漏模式）。\n\n步骤2：精确伽辽金应变能 $U_{\\mathrm{full}}(u_h)$ 的计算。\n\n总应变能由 $U = \\frac{1}{2} \\int_{\\Omega} e^{\\mathsf{T}} \\mathbf{D} e \\, d\\Omega$ 给出。面积微元为 $d\\Omega = \\det \\mathbf{J} \\, d\\xi \\, d\\eta = \\frac{L^2}{4} d\\xi \\, d\\eta$。\n首先，我们计算应变能密度项 $e_h^{\\mathsf{T}} \\mathbf{D} e_h$：\n$$\ne_h^{\\mathsf{T}} \\mathbf{D} e_h = \\begin{bmatrix} \\frac{2a}{L}\\eta  0  \\frac{2a}{L}\\xi \\end{bmatrix} \\begin{bmatrix} \\lambda + 2 G  \\lambda  0 \\\\ \\lambda  \\lambda + 2 G  0 \\\\ 0  0  G \\end{bmatrix} \\begin{bmatrix} \\frac{2a}{L}\\eta \\\\ 0 \\\\ \\frac{2a}{L}\\xi \\end{bmatrix}\n$$\n$$\ne_h^{\\mathsf{T}} \\mathbf{D} e_h = \\begin{bmatrix} \\frac{2a}{L}\\eta  0  \\frac{2a}{L}\\xi \\end{bmatrix} \\begin{bmatrix} (\\lambda + 2G)\\frac{2a}{L}\\eta \\\\ \\lambda\\frac{2a}{L}\\eta \\\\ G\\frac{2a}{L}\\xi \\end{bmatrix} = (\\lambda + 2G)\\left(\\frac{2a}{L}\\eta\\right)^2 + G\\left(\\frac{2a}{L}\\xi\\right)^2\n$$\n$$\ne_h^{\\mathsf{T}} \\mathbf{D} e_h = \\frac{4a^2}{L^2} \\left[ (\\lambda + 2G)\\eta^2 + G\\xi^2 \\right]\n$$\n现在，我们将此密度在单元域上积分以求得总能量 $U_{\\mathrm{full}}(u_h)$。问题要求使用完全的 $2 \\times 2$ 高斯积分计算能量。由于被积函数是关于 $\\xi$ 和 $\\eta$ 的二次函数，这等价于在母单元域 $[-1,1] \\times [-1,1]$ 上的精确解析积分。\n$$\nU_{\\mathrm{full}}(u_h) = \\frac{1}{2} \\int_{-1}^{1} \\int_{-1}^{1} \\left( \\frac{4a^2}{L^2} \\left[ (\\lambda + 2G)\\eta^2 + G\\xi^2 \\right] \\right) \\left( \\frac{L^2}{4} \\right) d\\xi \\, d\\eta\n$$\n$$\nU_{\\mathrm{full}}(u_h) = \\frac{a^2}{2} \\int_{-1}^{1} \\int_{-1}^{1} \\left[ (\\lambda + 2G)\\eta^2 + G\\xi^2 \\right] d\\xi \\, d\\eta\n$$\n我们计算积分：\n$$\n\\int_{-1}^{1} \\int_{-1}^{1} \\eta^2 d\\xi \\, d\\eta = \\int_{-1}^{1} d\\xi \\int_{-1}^{1} \\eta^2 d\\eta = [\\xi]_{-1}^{1} \\left[\\frac{\\eta^3}{3}\\right]_{-1}^{1} = (2)\\left(\\frac{1}{3} - \\left(-\\frac{1}{3}\\right)\\right) = \\frac{4}{3}\n$$\n$$\n\\int_{-1}^{1} \\int_{-1}^{1} \\xi^2 d\\xi \\, d\\eta = \\int_{-1}^{1} d\\eta \\int_{-1}^{1} \\xi^2 d\\xi = [\\eta]_{-1}^{1} \\left[\\frac{\\xi^3}{3}\\right]_{-1}^{1} = (2)\\left(\\frac{2}{3}\\right) = \\frac{4}{3}\n$$\n将这些结果代回能量表达式中：\n$$\nU_{\\mathrm{full}}(u_h) = \\frac{a^2}{2} \\left[ (\\lambda + 2G)\\frac{4}{3} + G\\frac{4}{3} \\right] = \\frac{a^2}{2} \\frac{4}{3} (\\lambda + 2G + G)\n$$\n$$\nU_{\\mathrm{full}}(u_h) = \\frac{2}{3} a^2 (\\lambda + 3G)\n$$\n\n步骤3：稳定化系数 $\\alpha$ 的确定。\n\n稳定化能量泛函定义为：\n$$\nU_{\\mathrm{stab}}(u_{h}) = \\frac{1}{2} \\, \\alpha \\sum_{q=1}^{4} e_{h}(\\xi_{q},\\eta_{q})^{\\mathsf{T}} \\, \\mathbf{D} \\, e_{h}(\\xi_{q},\\eta_{q}) \\, \\det J\n$$\n求和是在 $2 \\times 2$ 积分规则的四个高斯点上进行的，这些点是 $(\\xi_q, \\eta_q) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$。在每个点上，$\\xi_q^2 = 1/3$ 且 $\\eta_q^2 = 1/3$。\n让我们在任意一个高斯点 $q$ 处计算被加数：\n$$\ne_{h}(\\xi_{q},\\eta_{q})^{\\mathsf{T}} \\, \\mathbf{D} \\, e_{h}(\\xi_{q},\\eta_{q}) = \\frac{4a^2}{L^2} \\left[ (\\lambda + 2G)\\eta_q^2 + G\\xi_q^2 \\right]\n$$\n$$\n= \\frac{4a^2}{L^2} \\left[ (\\lambda + 2G)\\frac{1}{3} + G\\frac{1}{3} \\right] = \\frac{4a^2}{3L^2} (\\lambda + 3G)\n$$\n对于所有四个高斯点，这个值是恒定的。求和号内的项是这个量乘以 $\\det J = L^2/4$：\n$$\n\\text{Summand} = \\left( \\frac{4a^2}{3L^2} (\\lambda + 3G) \\right) \\left( \\frac{L^2}{4} \\right) = \\frac{a^2}{3} (\\lambda + 3G)\n$$\n总和是四个相同项的和：\n$$\n\\sum_{q=1}^{4} (\\dots) = 4 \\times \\frac{a^2}{3} (\\lambda + 3G)\n$$\n现在我们计算稳定化能量：\n$$\nU_{\\mathrm{stab}}(u_h) = \\frac{1}{2} \\alpha \\left( \\frac{4a^2}{3} (\\lambda + 3G) \\right) = \\frac{2}{3} \\alpha a^2 (\\lambda + 3G)\n$$\n校准条件为 $U_{\\mathrm{stab}}(u_h) = U_{\\mathrm{full}}(u_h)$。\n$$\n\\frac{2}{3} \\alpha a^2 (\\lambda + 3G) = \\frac{2}{3} a^2 (\\lambda + 3G)\n$$\n假设沙漏振幅非平凡 ($a \\neq 0$) 且材料是物理上现实的（$\\lambda > 0$, $G > 0$，因此 $\\lambda + 3G \\neq 0$），我们可以消去两边的公因子，得到：\n$$\n\\alpha = 1\n$$\n稳定化参数 $\\alpha$ 是一个无量纲值 $1$。这个结果表明，所选形式的稳定化能量，在校准以匹配沙漏模式的精确能量时，恰好等于应变场高阶部分贡献的能量，这部分能量能被 $2 \\times 2$ 高斯求积正确捕捉，但被单点积分规则所忽略。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "加权残量法的威力远不止于求解静态空间问题。本练习通过构建一个时空不连续伽辽金方法，展示了其在处理含不连续性（如冲击）的动力学问题中的应用。你将看到，在时间域上进行分部积分会自然地产生跳跃项，而这些跳跃项恰能精确地施加冲击过程中的动量守恒等物理定律。",
            "id": "3610230",
            "problem": "考虑一个由线性动量守恒控制的一维单自由度线性弹性动力学系统。设广义位移为 $u(t)$，速度为 $\\dot{u}(t)$，质量为 $m>0$，刚度为 $k\\ge 0$，且外载荷分解为一个时间上正则的部分 $f_{\\mathrm{reg}}(t)$ 和一组由狄拉克δ分布表示的有限个脉冲作用。其强形式为\n$$\nm\\,\\ddot{u}(t) + k\\,u(t) = f_{\\mathrm{reg}}(t) + \\sum_{i=1}^{N_{\\mathrm{imp}}} J_i\\,\\delta(t - t_i),\n$$\n对于 $t\\in(0,T)$，给定初始数据 $u(0)=u_0$ 和 $\\dot{u}(0)=v_0$。在此，$J_i$ 是冲量的大小，物理单位为牛顿·秒 (N·s)，作用于时间 $t_i\\in[0,T]$。狄拉克分布 $\\delta(t - t_i)$ 满足 $\\int_{t_i-\\varepsilon}^{t_i+\\varepsilon} \\delta(t - t_i)\\,\\mathrm{d}t = 1$ 对于任何 $\\varepsilon>0$。\n\n仅从牛顿第二定律和上述定义出发，目标是构建一种时空加权余量法，其中允许时间检验函数在各个时间层（time slabs）之间是不连续的。空间离散化是平凡的（单自由度），因此重点完全在于时间维度。将时间区间 $[0,T]$ 划分为多个时间层 $[t_n,t_{n+1}]$，并使有限维时间检验函数空间允许在 $t_n$ 处存在不连续性。采用时间上的伽辽金加权余量法（即试探函数和检验函数属于相容的空间），在需要时进行时间上的分部积分，并获得一个弱形式，其中在时间层界面上的边界项是显式的。这些界面项必须被解释为跳跃项。您必须证明，当适当选择检验函数以检测跳跃时，脉冲载荷会产生跳跃残差，该残差在冲击时刻强制执行精确的动量守恒。\n\n您的任务分为三个部分：\n\n1) 推导该问题的时间不连续伽辽金弱形式，清楚地指出由时间分部积分产生的时间层界面上的跳跃项。仅使用基本定律和定义，解释如何将跳跃项解释为冲量残差。对于冲击时间 $t^\\star$ 周围一个无限小的邻域，形式上证明该弱形式能得出精确的动量跳跃关系\n$$\nm\\left(\\dot{u}(t^\\star{}^+) - \\dot{u}(t^\\star{}^-)\\right) = J^\\star,\n$$\n其中 $J^\\star$ 是在 $t^\\star$ 处的净冲量，$\\dot{u}(t^\\star{}^-)$ 和 $\\dot{u}(t^\\star{}^+)$ 表示在 $t^\\star$ 处速度的左极限和右极限，并且对于有限冲量，$u(t)$ 在冲击前后保持连续。\n\n2) 从该弱形式出发，为每个时间层 $[t_n, t_{n+1}]$ 上的正则时间动态构建一个对称、二阶精度的单步时间步进格式，过程中不使用任何提供给您的快捷公式。在时间上使用伽辽金方法，采用多项式试探函数和相容的（但不连续的）检验函数。最终得到的二方程系统必须在每个时间层上，根据该层上 $u$ 和 $f_{\\mathrm{reg}}(t)$ 的积分，一致地更新 $u$ 和 $\\dot{u}$。在任何作为时间层界面的冲击时间 $t_i$ 处，强制执行上述动量跳跃关系，并确保 $u$ 是连续的。如果冲击发生在时间层内部，则通过将 $t_i$ 插入为附加节点来细化时间分区，从而在 $t_i$ 周围创建两个子层，并在 $t_i$ 处精确应用跳跃条件。\n\n3) 实现一个程序，该程序针对一组给定的参数，构建包含所有 $t_i$ 的细化时间网格，在非脉冲子层上通过推导的对称伽辽金时间步进格式推进求解，并在每个 $t_i$ 处应用精确的跳跃更新。对于每个测试用例，计算每次冲击时的冲量残差，\n$$\nr_i = m\\left(\\dot{u}(t_i{}^+) - \\dot{u}(t_i{}^-)\\right) - J_i,\n$$\n并为该测试用例返回所有冲量 $i$ 的残差绝对值的最大值，\n$$\nR_{\\max} = \\max_i |r_i|.\n$$\n以牛顿·秒 (N·s) 为单位，将 $R_{\\max}$ 表示为十进制数。程序必须将所有测试用例的结果汇总到单行输出中，该行包含按顺序排列的 $R_{\\max}$ 值，形式为用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3]$）。\n\n使用以下测试套件，它们共同探测了一般情况、存在刚度的情况、多次冲击、边界冲击以及跨越冲击的粗时间步长。在所有情况下，以牛顿·秒 (N·s) 为单位报告 $R_{\\max}$。\n\n测试用例 A（纯脉冲，无刚度，内部冲击）：\n- $m=2\\,\\mathrm{kg}$，$k=0\\,\\mathrm{N/m}$，$u_0=0\\,\\mathrm{m}$，$v_0=0\\,\\mathrm{m/s}$，$T=1.0\\,\\mathrm{s}$，$N=4$ 个均匀时间层，$f_{\\mathrm{reg}}(t)\\equiv 0\\,\\mathrm{N}$，在 $t_1=0.7\\,\\mathrm{s}$ 处有单次冲量，大小为 $J_1=3.0\\,\\mathrm{N\\cdot s}$。\n\n测试用例 B（带刚度和光滑正则载荷的脉冲）：\n- $m=1.0\\,\\mathrm{kg}$，$k=100\\,\\mathrm{N/m}$，$u_0=0\\,\\mathrm{m}$，$v_0=0\\,\\mathrm{m/s}$，$T=1.0\\,\\mathrm{s}$，$N=10$ 个均匀时间层，$f_{\\mathrm{reg}}(t)=10\\sin(\\pi t)\\,\\mathrm{N}$，在 $t_1=0.4\\,\\mathrm{s}$ 处有单次冲量，大小为 $J_1=1.0\\,\\mathrm{N\\cdot s}$。\n\n测试用例 C（两次脉冲，线性时间正则载荷）：\n- $m=1.5\\,\\mathrm{kg}$，$k=50\\,\\mathrm{N/m}$，$u_0=0\\,\\mathrm{m}$，$v_0=0\\,\\mathrm{m/s}$，$T=1.0\\,\\mathrm{s}$，$N=8$ 个均匀时间层，$f_{\\mathrm{reg}}(t)=5 t\\,\\mathrm{N}$，在 $t_1=0.25\\,\\mathrm{s}$ 处有冲量 $J_1=0.5\\,\\mathrm{N\\cdot s}$，在 $t_2=0.75\\,\\mathrm{s}$ 处有冲量 $J_2=-0.2\\,\\mathrm{N\\cdot s}$。\n\n测试用例 D（初始时刻的脉冲）：\n- $m=1.0\\,\\mathrm{kg}$，$k=0\\,\\mathrm{N/m}$，$u_0=0\\,\\mathrm{m}$，$v_0=0\\,\\mathrm{m/s}$，$T=0.5\\,\\mathrm{s}$，$N=5$ 个均匀时间层，$f_{\\mathrm{reg}}(t)\\equiv 0\\,\\mathrm{N}$，在 $t_1=0.0\\,\\mathrm{s}$ 处有单次冲量，大小为 $J_1=2.0\\,\\mathrm{N\\cdot s}$。\n\n测试用例 E（包含内部冲击和刚度的粗时间分区）：\n- $m=3.0\\,\\mathrm{kg}$，$k=200\\,\\mathrm{N/m}$，$u_0=0\\,\\mathrm{m}$，$v_0=0\\,\\mathrm{m/s}$，$T=1.0\\,\\mathrm{s}$，$N=2$ 个均匀时间层，$f_{\\mathrm{reg}}(t)\\equiv 0\\,\\mathrm{N}$，在 $t_1=0.33\\,\\mathrm{s}$ 处有单次冲量，大小为 $J_1=4.0\\,\\mathrm{N\\cdot s}$。\n\n您的程序应生成一行输出，其中包含以牛顿·秒 (N·s) 为单位的结果 $[R_{\\max}^{(A)},R_{\\max}^{(B)},R_{\\max}^{(C)},R_{\\max}^{(D)},R_{\\max}^{(E)}]$，以十进制数表示。不应打印任何其他文本。",
            "solution": "该问题要求对一个带脉冲载荷的单自由度线性弹性动力学系统，进行时间不连续伽辽金方法的推导、公式化和实现。解决方案按要求分为三个部分呈现。\n\n### 第1部分：弱形式和跳跃条件的推导\n\n系统的线性动量守恒的强形式由下式给出：\n$$\nm\\,\\ddot{u}(t) + k\\,u(t) = f_{\\mathrm{reg}}(t) + \\sum_{i=1}^{N_{\\mathrm{imp}}} J_i\\,\\delta(t - t_i), \\quad t \\in (0, T)\n$$\n初始条件为 $u(0)=u_0$ 和 $\\dot{u}(0)=v_0$。\n\n让我们首先从第一性原理出发，确定脉冲载荷的物理后果。考虑在时间 $t^\\star$ 的单个冲量 $J^\\star$。我们将控制方程在一个无穷小的时间区间 $[t^\\star - \\varepsilon, t^\\star + \\varepsilon]$ 上积分：\n$$\n\\int_{t^\\star-\\varepsilon}^{t^\\star+\\varepsilon} \\left( m\\,\\ddot{u}(t) + k\\,u(t) \\right) \\mathrm{d}t = \\int_{t^\\star-\\varepsilon}^{t^\\star+\\varepsilon} \\left( f_{\\mathrm{reg}}(t) + J^\\star\\,\\delta(t - t^\\star) \\right) \\mathrm{d}t\n$$\n对加速度项应用微积分基本定理，并利用狄拉克δ分布的筛选性质，我们得到：\n$$\n\\left[ m\\,\\dot{u}(t) \\right]_{t^\\star-\\varepsilon}^{t^\\star+\\varepsilon} + \\int_{t^\\star-\\varepsilon}^{t^\\star+\\varepsilon} k\\,u(t)\\,\\mathrm{d}t = \\int_{t^\\star-\\varepsilon}^{t^\\star+\\varepsilon} f_{\\mathrm{reg}}(t)\\,\\mathrm{d}t + J^\\star\n$$\n对于有限大小的冲量 $J^\\star$，动量的变化必须是有限的。这意味着速度 $\\dot{u}(t)$ 可以有跳跃不连续性，但位移 $u(t)$ 必须保持连续。如果 $u(t)$ 不连续，那么 $\\dot{u}(t)$ 将包含一个狄拉克δ函数，而 $\\ddot{u}(t)$ 将是其导数，这无法与方程中的其他项相平衡。因此，$u(t)$ 在 $t^\\star$ 两侧是连续的。\n\n当我们取极限 $\\varepsilon \\to 0$ 时，涉及正则力 $f_{\\mathrm{reg}}(t)$ 和刚度项 $k\\,u(t)$ 的积分会消失，因为它们的被积函数是有界的。我们得到动量的精确跳跃条件：\n$$\nm\\,\\dot{u}(t^\\star{}^+) - m\\,\\dot{u}(t^\\star{}^-) = J^\\star\n$$\n其中 $\\dot{u}(t^\\star{}^+)$ 和 $\\dot{u}(t^\\star{}^-)$ 是速度在冲击时刻的右极限和左极限。这证实了问题中所述的关系。\n\n现在，我们推导时间不连续伽辽金弱形式。我们将时间域 $[0, T]$ 划分成 $N$ 个时间层 $I_n = (t_n, t_{n+1})$。试探函数 $u(t)$ 和检验函数 $w(t)$ 被允许在时间层界面 $t_n$ 上不连续。我们从控制方程出发，但我们将通过上面推导的跳跃条件来处理脉冲部分，而不是在弱形式中保留狄拉克δ函数。正则动力学的残差为：\n$$\nR(t) = m\\,\\ddot{u}(t) + k\\,u(t) - f_{\\mathrm{reg}}(t) = 0\n$$\n在单个时间层 $I_n$ 上的加权残差陈述为：\n$$\n\\int_{t_n}^{t_{n+1}} w(t) \\left( m\\,\\ddot{u}(t) + k\\,u(t) - f_{\\mathrm{reg}}(t) \\right) \\mathrm{d}t = 0\n$$\n对于在合适空间中的所有检验函数 $w(t)$。我们对加速度项进行一次分部积分，以降低试探函数 $u(t)$ 的导数阶数：\n$$\n\\int_{t_n}^{t_{n+1}} w(t) m\\,\\ddot{u}(t)\\,\\mathrm{d}t = \\left[ w(t) m\\,\\dot{u}(t) \\right]_{t_n^+}^{t_{n+1}^-} - \\int_{t_n}^{t_{n+1}} \\dot{w}(t) m\\,\\dot{u}(t)\\,\\mathrm{d}t\n$$\n其中边界项作为从时间层 $(t_n, t_{n+1})$ 内部取极限来计算。将其代回，时间层 $I_n$ 上的弱形式为：\n$$\n\\int_{t_n}^{t_{n+1}} \\left( -\\dot{w} m \\dot{u} + w k u \\right) \\mathrm{d}t + w(t_{n+1}^-)m\\dot{u}(t_{n+1}^-) - w(t_n^+)m\\dot{u}(t_n^+) = \\int_{t_n}^{t_{n+1}} w f_{\\mathrm{reg}} \\mathrm{d}t\n$$\n该方程在每个时间层上都成立。总的弱形式是这些方程在所有时间层上的总和，并与界面上的条件耦合。对所有时间层 $n=0, \\dots, N-1$ 求和：\n$$\n\\sum_{n=0}^{N-1} \\int_{I_n} \\left( -\\dot{w} m \\dot{u} + w k u \\right) \\mathrm{d}t + \\sum_{n=0}^{N-1} \\left( w_{n+1}^-m\\dot{u}_{n+1}^- - w_n^+m\\dot{u}_n^+ \\right) = \\sum_{n=0}^{N-1} \\int_{I_n} w f_{\\mathrm{reg}} \\mathrm{d}t\n$$\n这里我们使用简写 $w_{n+1}^- = w(t_{n+1}^-)$ 等。边界项之和可以重新排列：\n$$\n\\sum_{n=0}^{N-1} (\\dots) = w_N^-m\\dot{u}_N^- - w_0^+m\\dot{u}_0^+ + \\sum_{n=1}^{N-1} (w_n^-m\\dot{u}_n^- - w_n^+m\\dot{u}_n^+)\n$$\n使用跳跃符号 $\\llbracket \\phi \\rrbracket_n = \\phi_n^+ - \\phi_n^-$，内部节点上的和为 $-\\sum_{n=1}^{N-1} m \\llbracket w\\dot{u} \\rrbracket_n$。由于 $w$ 和 $\\dot{u}$ 都可能不连续，我们可以写出 $\\llbracket w\\dot{u} \\rrbracket_n = w_n^+ \\dot{u}_n^+ - w_n^- \\dot{u}_n^-$。所以边界项之和确实是 $-\\sum_{n=1}^{N-1} m (w_n^+ \\dot{u}_n^+ - w_n^- \\dot{u}_n^-)$。\n\n冲量残差源于这些跳跃项。如果我们将δ函数包含在全局弱形式中，这些跳跃项将恰好平衡它们。假设在时间 $t_n$ 有一个冲量 $J_n$。选择一个在 $t_n$ 附近连续且局部化的检验函数 $w(t)$（例如，一个帽子函数），弱形式将导致 $m( \\dot{u}_n^+ - \\dot{u}_n^- ) = J_n$。这表明弱形式中的跳跃项是吸收冲量的机制。实现时不会从弱形式推导此关系，而是直接强制执行它，这在计算上是等效且稳健的。\n\n### 第2部分：时间步进格式的构建\n\n为了推导一个对称、二阶精度的格式，我们首先将二阶常微分方程（ODE）转换为一个一阶系统。令 $v(t) = \\dot{u}(t)$。\n$$\n\\begin{cases}\n\\dot{u}(t) = v(t) \\\\\n\\dot{v}(t) = \\frac{1}{m} \\left( f_{\\mathrm{reg}}(t) - k\\,u(t) \\right)\n\\end{cases}\n$$\n我们构建一个数值格式，用于在一个持续时间为 $\\Delta t = t_{n+1} - t_n$ 的时间层 $[t_n, t_{n+1}]$ 上，将解从时间 $t_n$ 的状态 $(u_n^+, v_n^+)$ 推进到时间 $t_{n+1}$ 的状态 $(u_{n+1}^-, v_{n+1}^-)$。在该时间层上积分该系统得到：\n$$\nu(t_{n+1}) - u(t_n) = \\int_{t_n}^{t_{n+1}} v(t)\\,\\mathrm{d}t\n$$\n$$\nv(t_{n+1}) - v(t_n) = \\frac{1}{m} \\left( \\int_{t_n}^{t_{n+1}} f_{\\mathrm{reg}}(t)\\,\\mathrm{d}t - k \\int_{t_n}^{t_{n+1}} u(t)\\,\\mathrm{d}t \\right)\n$$\n为了获得一个对称的二阶格式，我们使用梯形法则来近似这些积分：\n$$\n\\int_{t_n}^{t_{n+1}} g(t)\\,\\mathrm{d}t \\approx \\frac{\\Delta t}{2} \\left( g(t_n) + g(t_{n+1}) \\right)\n$$\n将此应用于我们的积分方程，我们得到以下单步格式，即该系统的梯形法则或Crank-Nicolson方法：\n$$\nu_{n+1}^- - u_n^+ = \\frac{\\Delta t}{2} (v_n^+ + v_{n+1}^-)\n$$\n$$\nv_{n+1}^- - v_n^+ = \\frac{1}{m} \\left( \\int_{t_n}^{t_{n+1}} f_{\\mathrm{reg}}(t)\\,\\mathrm{d}t - k \\frac{\\Delta t}{2} (u_n^+ + u_{n+1}^-) \\right)\n$$\n这是一个关于未知数 $(u_{n+1}^-, v_{n+1}^-)$ 的隐式格式。我们可以将其重新排列成一个 $2 \\times 2$ 的线性系统：\n$$\n\\begin{pmatrix} 1  -\\frac{\\Delta t}{2} \\\\ \\frac{k\\,\\Delta t}{2}  m \\end{pmatrix} \\begin{pmatrix} u_{n+1}^- \\\\ v_{n+1}^- \\end{pmatrix} = \\begin{pmatrix} u_n^+ + \\frac{\\Delta t}{2} v_n^+ \\\\ m\\,v_n^+ - \\frac{k\\,\\Delta t}{2} u_n^+ + \\int_{t_n}^{t_{n+1}} f_{\\mathrm{reg}}(t)\\,\\mathrm{d}t \\end{pmatrix}\n$$\n系统矩阵的行列式为 $m + k(\\Delta t/2)^2$，对于 $m>0, k\\ge 0$ 是严格为正的。因此，对于 $(u_{n+1}^-, v_{n+1}^-)$ 总存在唯一解。该格式同时更新 $u$ 和 $\\dot{u}=v$，并且是众所周知的对称和二阶精度的。所需力积分 $\\int_{t_n}^{t_{n+1}} f_{\\mathrm{reg}}(t)\\,\\mathrm{d}t$ 将对所提供的简单函数进行解析计算。\n\n在任何对应于冲量 $J_i$ 的时间节点 $t_i$ 处，在从左侧时间层求解得到状态 $(u_i^-, v_i^-)$ 后，我们强制执行跳跃条件：\n$$\nu_i^+ = u_i^-\n$$\n$$\nv_i^+ = v_i^- + \\frac{J_i}{m}\n$$\n这些值 $(u_i^+, v_i^+)$ 接着作为下一个时间层的初始条件。如果冲量发生在 $t=0$ 时刻，初始条件 $v_0$ 被视为 $v(0^-)$ 并更新为 $v(0^+) = v_0 + J(0)/m$。时间网格被细化以包含所有冲量时刻作为节点，确保冲量在时间层界面处被精确处理。\n\n### 第3部分：实现与结果\n\n实现过程为每个测试用例执行以下步骤：\n1.  定义物理参数、初始条件和冲量数据。\n2.  通过从均匀分区开始并插入所有指定的脉冲时间来构建一个细化的时间网格。移除重复项并对网格点进行排序。\n3.  将状态变量 $(u, v)$ 初始化为 $(u_0, v_0)$。\n4.  检查在 $t=0$ 处是否有冲量。如果存在，则对初始速度应用动量跳跃，并计算相应的冲量残差。\n5.  遍历由细化网格定义的时间层。在每一步中：\n    a. 组装并求解用于梯形法则的 $2 \\times 2$ 线性系统，以找到时间层末端的状态 $(u_{\\mathrm{next}}, v_{\\mathrm{next}})$。力积分进行解析计算。\n    b. 检查时间层末端是否为冲量时刻。如果是，则对速度应用动量跳跃，并计算冲量残差 $r_i = m(v_i^+ - v_i^-) - J_i$。\n6.  遍历所有时间层后，确定该测试用例的最大绝对冲量残差 $R_{\\max}$。\n7.  最终输出汇总所有测试用例的 $R_{\\max}$ 值。\n\n根据构造，冲量残差的计算 $r_i = m((v_i^- + J_i/m) - v_i^-) - J_i$ 应得出零。数值结果证实了这一点，任何非零值都可归因于浮点精度限制。\n```python\nimport numpy as np\nfrom collections import namedtuple\n\n# Define the data structure for a test case\nTestCase = namedtuple('TestCase', ['m', 'k', 'u0', 'v0', 'T', 'N', 'f_reg_str', \n                                   'f_reg', 'f_reg_int', 'impulses'])\n\ndef solve():\n    \"\"\"\n    Solves the elastodynamic problem for all specified test cases and computes\n    the maximum impulsive residual for each.\n    \"\"\"\n    \n    # Define test cases as per the problem statement\n    test_cases = [\n        TestCase(\n            m=2.0, k=0.0, u0=0.0, v0=0.0, T=1.0, N=4,\n            f_reg_str=\"0\",\n            f_reg=lambda t: 0.0,\n            f_reg_int=lambda t1, t2: 0.0,\n            impulses=[(0.7, 3.0)] # (time, magnitude)\n        ),\n        TestCase(\n            m=1.0, k=100.0, u0=0.0, v0=0.0, T=1.0, N=10,\n            f_reg_str=\"10*sin(pi*t)\",\n            f_reg=lambda t: 10.0 * np.sin(np.pi * t),\n            f_reg_int=lambda t1, t2: 10.0 * (-np.cos(np.pi * t2) / np.pi + np.cos(np.pi * t1) / np.pi),\n            impulses=[(0.4, 1.0)]\n        ),\n        TestCase(\n            m=1.5, k=50.0, u0=0.0, v0=0.0, T=1.0, N=8,\n            f_reg_str=\"5*t\",\n            f_reg=lambda t: 5.0 * t,\n            f_reg_int=lambda t1, t2: 5.0 * (0.5 * t2**2 - 0.5 * t1**2),\n            impulses=[(0.25, 0.5), (0.75, -0.2)]\n        ),\n        TestCase(\n            m=1.0, k=0.0, u0=0.0, v0=0.0, T=0.5, N=5,\n            f_reg_str=\"0\",\n            f_reg=lambda t: 0.0,\n            f_reg_int=lambda t1, t2: 0.0,\n            impulses=[(0.0, 2.0)]\n        ),\n        TestCase(\n            m=3.0, k=200.0, u0=0.0, v0=0.0, T=1.0, N=2,\n            f_reg_str=\"0\",\n            f_reg=lambda t: 0.0,\n            f_reg_int=lambda t1, t2: 0.0,\n            impulses=[(0.33, 4.0)]\n        )\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        m, k, u0, v0, T, N, _, _, f_int, impulses = case\n        \n        # Create a dictionary for impulses for quick lookup\n        impulse_dict = {t: J for t, J in impulses}\n        \n        # 1. Construct the refined time grid\n        # Start with uniform grid and add impulse times\n        time_nodes = set(np.linspace(0, T, N + 1))\n        for t_imp, _ in impulses:\n            time_nodes.add(t_imp)\n        \n        time_grid = sorted(list(time_nodes))\n        # Ensure floating point issues don't create tiny steps near T\n        if time_grid[-1] > T:\n             time_grid[-1] = T\n        time_grid = np.unique(np.round(time_grid, 15))\n\n\n        # 2. Initialization\n        u_curr = u0\n        v_curr = v0\n        impulsive_residuals = []\n\n        # 3. Handle impulse at t=0\n        if 0.0 in impulse_dict:\n            J0 = impulse_dict[0.0]\n            v_minus = v_curr\n            v_plus = v_minus + J0 / m\n            \n            # Calculate and store residual\n            residual = m * (v_plus - v_minus) - J0\n            impulsive_residuals.append(residual)\n            \n            # Update velocity for the start of the simulation\n            v_curr = v_plus\n\n        # 4. Time stepping loop\n        for i in range(len(time_grid) - 1):\n            t_n = time_grid[i]\n            t_n1 = time_grid[i+1]\n            dt = t_n1 - t_n\n            \n            if dt == 0: continue\n\n            # Parameters for the current step (from t_n^+ state)\n            u_n_plus = u_curr\n            v_n_plus = v_curr\n\n            # Calculate integral of the regular force\n            F_integral = f_int(t_n, t_n1)\n\n            # Assemble the 2x2 linear system for trapezoidal rule\n            # A * x = b, where x = [u_{n+1}^-, v_{n+1}^-]\n            A = np.array([\n                [1.0, -dt / 2.0],\n                [k * dt / 2.0, m]\n            ])\n            \n            b = np.array([\n                u_n_plus + dt / 2.0 * v_n_plus,\n                m * v_n_plus - k * dt / 2.0 * u_n_plus + F_integral\n            ])\n            \n            # Solve for state at t_{n+1}^-\n            u_n1_minus, v_n1_minus = np.linalg.solve(A, b)\n            \n            # Update current state for the next step (provisional)\n            u_curr = u_n1_minus\n            v_curr = v_n1_minus\n\n            # 5. Handle impulse at t_{n+1}\n            if t_n1 in impulse_dict:\n                J_n1 = impulse_dict[t_n1]\n                v_plus = v_n1_minus + J_n1 / m\n                \n                # Calculate and store residual\n                residual = m * (v_plus - v_n1_minus) - J_n1\n                impulsive_residuals.append(residual)\n                \n                # Update velocity for the start of the next step\n                v_curr = v_plus\n        \n        # 6. Compute R_max for the test case\n        if not impulsive_residuals:\n            R_max = 0.0\n        else:\n            R_max = np.max(np.abs(impulsive_residuals))\n            \n        results.append(f\"{R_max:.1f}\")\n\n    # Final print statement in the exact required format\n    # print(f\"[{','.join(results)}]\")\n\n# The final answer is the output of the code, which is [0.0, 0.0, 0.0, 0.0, 0.0]\n# due to the direct enforcement of the jump condition.\n```",
            "answer": "$$\\boxed{[0.0, 0.0, 0.0, 0.0, 0.0]}$$"
        }
    ]
}