{
    "hands_on_practices": [
        {
            "introduction": "邻位耦合常数 ($^{3}J_{HH}$) 与二面角之间的关系是构象分析的基石。Karplus 方程为我们提供了将这一几何参数与可测量的核磁共振谱图特征联系起来的定量工具。通过在理想化的构象（如旁式和反式）中应用此方程，您可以亲手计算出预期的耦合常数值，从而深入理解为何 $^{3}J_{HH}$ 是鉴定分子立体化学的有力探针 。",
            "id": "3705678",
            "problem": "在液相核磁共振 (NMR) 中，饱和烃片段 $\\mathrm{H{-}C{-}C{-}H}$ 中邻位质子-质子对的各向同性标量自旋-自旋耦合常数 $^{3}J_{HH}$ 通过一个经过充分验证的Karplus型经验关系式依赖于二面角 $\\phi$。考虑一个在各向同性介质中、$T=298\\,\\mathrm{K}$ 下构象固定的片段。在关于 $\\phi$ 的典型Karplus依赖关系中，使用一个标准的Haasnoot–Altona参数化方案来描述邻位 $\\mathrm{H{-}C{-}C{-}H}$ 耦合，其特征系数为 $A=7.09\\,\\mathrm{Hz}$、$B=-1.01\\,\\mathrm{Hz}$ 和 $C=0.62\\,\\mathrm{Hz}$。\n\n估算当二面角 $\\phi=60^{\\circ}$、$\\phi=180^{\\circ}$ 和 $\\phi=300^{\\circ}$ (角度以度为单位指定) 时的 $^{3}J_{HH}$ 值，然后根据构象标记（例如，反式与旁式）和预期的相对耦合强度，对您获得的数值大小进行简要的立体化学解释。\n\n将每个 $^{3}J_{HH}$ 值以 $\\mathrm{Hz}$ 表示，并将您的数值结果四舍五入到四位有效数字。您的最终答案必须是一个行向量，其中包含与 $\\phi=60^{\\circ}$、$\\phi=180^{\\circ}$ 和 $\\phi=300^{\\circ}$ 顺序对应的三个值。",
            "solution": "首先将对问题进行验证，以确保其具有科学依据、定义明确且客观。\n\n### 步骤1：提取已知条件\n\n-   **体系**：一个构象固定的饱和烃片段 $\\mathrm{H{-}C{-}C{-}H}$。\n-   **实验**：在各向同性介质中、$T=298\\,\\mathrm{K}$ 下的液相核磁共振 (NMR)。\n-   **关注参数**：邻位质子-质子标量耦合常数 $^{3}J_{HH}$。\n-   **函数依赖关系**：$^{3}J_{HH}$ 与二面角 $\\phi$ 之间的Karplus型关系。\n-   **模型**：典型的Karplus依赖关系 $^{3}J_{HH}(\\phi) = A \\cos^2(\\phi) + B \\cos(\\phi) + C$。\n-   **系数 (Haasnoot–Altona参数化)**：\n    -   $A = 7.09\\,\\mathrm{Hz}$\n    -   $B = -1.01\\,\\mathrm{Hz}$\n    -   $C = 0.62\\,\\mathrm{Hz}$\n-   **待评估的二面角**：$\\phi = 60^{\\circ}$、$\\phi = 180^{\\circ}$ 和 $\\phi = 300^{\\circ}$。\n-   **要求输出**：\n    1.  针对给定角度估算的 $^{3}J_{HH}$ 值，四舍五入到四位有效数字。\n    2.  简要的立体化学解释。\n    3.  最终答案为包含三个数值的单个行向量。\n\n### 步骤2：使用提取的已知条件进行验证\n\n-   **科学依据（关键）**：该问题牢固地植根于核磁共振波谱学的原理。将邻位耦合常数与二面角相关联的Karplus关系，是用于有机分子立体化学分析的基础性且经经验充分验证的工具。指定的参数值在物理上是现实的。该问题具有科学合理性。\n-   **定义明确**：该问题提供了一个特定的数学模型（典型的三项Karplus方程）以及计算 $^{3}J_{HH}$ 唯一解集所需的所有参数（$A$、$B$、$C$）和自变量（$\\phi$）。对解释的要求也是标准且明确定义的。\n-   **客观性（关键）**：该问题使用精确、无歧义的科学术语进行陈述。它要求基于既定模型进行计算和解释，而非主观意见。\n\n该问题不存在任何诸如科学上不合理、不完整、矛盾或模棱两可的缺陷。提及“Haasnoot–Altona参数化”是为了指明特定系数$A$、$B$和$C$的来源，而短语“在典型的Karplus依赖关系中”则明确规定了使用标准的三项方程。因此，该问题是自洽的，可以进行求解。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效的**。现在将提供完整的解答。\n\n### 解答\n\n邻位质子-质子耦合常数 $^{3}J_{HH}$ 可使用典型的Karplus方程进行估算，该方程将耦合常数与两个质子之间的二面角 $\\phi$ 联系起来。该方程如下：\n\n$$\n^{3}J_{HH}(\\phi) = A \\cos^2(\\phi) + B \\cos(\\phi) + C\n$$\n\n问题为通用的 $\\mathrm{H{-}C{-}C{-}H}$ 片段提供了具体系数：$A = 7.09\\,\\mathrm{Hz}$、$B = -1.01\\,\\mathrm{Hz}$ 和 $C = 0.62\\,\\mathrm{Hz}$。我们将把这些值和给定的二面角代入方程中。在大多数计算系统中，三角函数需要将角度转换为弧度，但 $60^{\\circ}$、$180^{\\circ}$ 和 $300^{\\circ}$ 的余弦值是精确且众所周知的。\n\n**1. 计算 $\\phi = 60^{\\circ}$ 的情况**\n\n二面角为 $\\phi = 60^{\\circ}$。该角度的余弦值为：\n$$\n\\cos(60^{\\circ}) = \\frac{1}{2} = 0.5\n$$\n将此值代入Karplus方程：\n$$\n^{3}J_{HH}(60^{\\circ}) = (7.09\\,\\mathrm{Hz}) \\cdot (\\cos(60^{\\circ}))^2 + (-1.01\\,\\mathrm{Hz}) \\cdot \\cos(60^{\\circ}) + 0.62\\,\\mathrm{Hz}\n$$\n$$\n^{3}J_{HH}(60^{\\circ}) = (7.09) \\cdot (0.5)^2 + (-1.01) \\cdot (0.5) + 0.62\n$$\n$$\n^{3}J_{HH}(60^{\\circ}) = (7.09) \\cdot (0.25) - 0.505 + 0.62\n$$\n$$\n^{3}J_{HH}(60^{\\circ}) = 1.7725 - 0.505 + 0.62 = 1.8875\\,\\mathrm{Hz}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n^{3}J_{HH}(60^{\\circ}) \\approx 1.888\\,\\mathrm{Hz}\n$$\n\n**2. 计算 $\\phi = 180^{\\circ}$ 的情况**\n\n二面角为 $\\phi = 180^{\\circ}$。该角度的余弦值为：\n$$\n\\cos(180^{\\circ}) = -1\n$$\n将此值代入Karplus方程：\n$$\n^{3}J_{HH}(180^{\\circ}) = (7.09\\,\\mathrm{Hz}) \\cdot (\\cos(180^{\\circ}))^2 + (-1.01\\,\\mathrm{Hz}) \\cdot \\cos(180^{\\circ}) + 0.62\\,\\mathrm{Hz}\n$$\n$$\n^{3}J_{HH}(180^{\\circ}) = (7.09) \\cdot (-1)^2 + (-1.01) \\cdot (-1) + 0.62\n$$\n$$\n^{3}J_{HH}(180^{\\circ}) = (7.09) \\cdot (1) + 1.01 + 0.62\n$$\n$$\n^{3}J_{HH}(180^{\\circ}) = 7.09 + 1.01 + 0.62 = 8.72\\,\\mathrm{Hz}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n^{3}J_{HH}(180^{\\circ}) = 8.720\\,\\mathrm{Hz}\n$$\n\n**3. 计算 $\\phi = 300^{\\circ}$ 的情况**\n\n二面角为 $\\phi = 300^{\\circ}$。该角度与 $-60^{\\circ}$ 共终边。余弦函数是偶函数，因此 $\\cos(300^{\\circ}) = \\cos(-60^{\\circ}) = \\cos(60^{\\circ})$。\n$$\n\\cos(300^{\\circ}) = \\cos(60^{\\circ}) = \\frac{1}{2} = 0.5\n$$\n因此，计算过程与 $\\phi = 60^{\\circ}$ 的情况相同：\n$$\n^{3}J_{HH}(300^{\\circ}) = (7.09) \\cdot (0.5)^2 + (-1.01) \\cdot (0.5) + 0.62\n$$\n$$\n^{3}J_{HH}(300^{\\circ}) = 1.8875\\,\\mathrm{Hz}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n^{3}J_{HH}(300^{\\circ}) \\approx 1.888\\,\\mathrm{Hz}\n$$\n\n### 立体化学解释\n\n计算出的邻位耦合常数 $^{3}J_{HH}$ 的值具有直接的立体化学意义：\n\n-   **$\\phi = 180^{\\circ}$（反式共平面构象）：** 计算出的耦合常数为 $8.720\\,\\mathrm{Hz}$。这个相对较大的值是邻位质子呈*反式*排列的特征。在这种几何构型中，参与耦合路径的轨道（一个质子的$\\mathrm{C-H}$成键轨道和另一个质子的$\\mathrm{C-H}$反键轨道）具有最佳重叠，从而导致强标量耦合。在饱和、无应变的体系中，反式耦合的典型实验值在 $8$–$13\\,\\mathrm{Hz}$ 范围内，这与我们的计算结果一致。\n\n-   **$\\phi = 60^{\\circ}$ 和 $\\phi = 300^{\\circ}$（顺-斜向/旁式构象）：** 这两个角度计算出的耦合常数均为 $1.888\\,\\mathrm{Hz}$。这个较小的值是邻位质子呈*旁式*排列的特征。在这些二面角下，相关sigma轨道之间的重叠远不如反式情况，导致耦合显著减弱。旁式耦合的典型实验值在 $1$–$5\\,\\mathrm{Hz}$ 范围内，这也与我们的计算结果一致。\n\n总而言之，Karplus关系正确地预测了 $^{3}J_{HH}$ 耦合在反式共平面几何构型（$\\phi=180^{\\circ}$）时达到最大值，而在旁式几何构型（$\\phi \\approx \\pm 60^{\\circ}$）时则显著减小，从而为通过核磁共振谱确定分子构象提供了一种强有力的方法。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.888 & 8.720 & 1.888 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "现实中的分子，尤其是在溶液中，并非静止不动，而是作为多种构象的集合体存在。实验观测到的耦合常数实际上是这些构象根据其能量在玻尔兹曼分布下的加权平均值。本练习将指导您构建一个计算工作流程，将构象采样（例如，来自能量计算）与 Karplus 关系相结合，从而预测柔性分子的系综平均耦合常数 。这体现了连接理论计算与实验核磁共振数据的现代研究方法。",
            "id": "3705662",
            "problem": "一个柔性有机分子的邻位氢-氢耦合会表现出依赖于构象的核磁共振（NMR）自旋-自旋耦合常数。特别地，邻位耦合常数 $^{3}J_{HH}$ 依赖于耦合氢原子之间的二面角 $\\phi$。一个经过充分检验的邻位氢-氢耦合经验关系是卡普勒斯方程（Karplus equation），它通过一个三角函数将 $^{3}J_{HH}$ 与二面角 $\\phi$ 关联起来。在从分子动力学（MD）采样的构象系综中，系综平均耦合 $\\langle ^{3}J_{HH} \\rangle$ 必须通过在绝对温度 $T$ 下，根据每个采样构象的正则系综概率对其进行加权来计算。\n\n使用以下基本原理：\n- 在绝对温度 $T$ 下，一个摩尔势能为 $E_i$ 的状态的正则系综概率与玻尔兹曼因子 $\\exp\\!\\left(-\\dfrac{E_i}{R T}\\right)$ 成正比，其中 $R$ 是摩尔气体常数。归一化概率为 $p_i = \\dfrac{\\exp\\!\\left(-\\dfrac{E_i}{R T}\\right)}{\\sum_j \\exp\\!\\left(-\\dfrac{E_j}{R T}\\right)}$。\n- 任何可观测量 $X$ 在离散采样状态上的系综平均值为 $\\langle X \\rangle = \\sum_i p_i X_i$。\n- 一种标准的卡普勒斯形式为 $J(\\phi) = A \\cos^2(\\phi) + B \\cos(\\phi) + C$，其中 $A$、$B$ 和 $C$ 是经验系数，$\\phi$ 是二面角。该关系在核磁共振（NMR）波谱学中被认为是一个经过充分检验的公式。\n\n你必须实现一个程序，该程序在给定一组以度为单位的二面角 $\\{\\phi_i\\}$、相应的以 $\\mathrm{kJ/mol}$ 为单位的摩尔能量 $\\{E_i\\}$ 以及卡普勒斯系数 $(A,B,C)$ 的情况下，计算系综平均耦合 $$\\langle ^{3}J_{HH} \\rangle = \\frac{\\sum_i J(\\phi_i)\\,\\exp\\!\\left(-\\dfrac{E_i^{(\\mathrm{kJ/mol})}\\cdot 1000}{R\\,T}\\right)}{\\sum_i \\exp\\!\\left(-\\dfrac{E_i^{(\\mathrm{kJ/mol})}\\cdot 1000}{R\\,T}\\right)},$$ 其中 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，并且在应用余弦函数之前，角度必须从度转换为弧度。所有输出必须以 $\\mathrm{Hz}$ 表示，并四舍五入到三位小数。\n\n角度单位：提供的是度；在内部转换为弧度以进行三角函数求值。能量单位：输入的 $E_i$ 以 $\\mathrm{kJ/mol}$ 为单位；通过乘以 $1000$ 转换为 $\\mathrm{J/mol}$。温度单位：输入的 $T$ 以 $\\mathrm{K}$（开尔文）为单位。耦合输出单位：$\\mathrm{Hz}$。\n\n测试套件：\n- 案例1（环境温度下典型的反式/邻交叉式布局）：卡普勒斯系数 $(A,B,C) = (7.6,-1.3,1.0)$；二面角（度）$\\phi_i = [60,180]$；摩尔能量（$\\mathrm{kJ/mol}$）$E_i = [1.5,0.0]$；绝对温度 $T = 298\\,\\mathrm{K}$。预期行为：一个偏向于 $\\phi = 180^\\circ$ 附近较低能量反式构象异构体的加权平均值。\n- 案例2（对六个能量相等的交错角进行均匀采样）：$(A,B,C) = (7.6,-1.3,1.0)$；$\\phi_i = [0,60,120,180,240,300]$；$E_i = [0,0,0,0,0,0]$；$T = 298\\,\\mathrm{K}$。预期行为：六个角度的算术平均值。\n- 案例3（强调最低能量构象异构体的低温极限）：$(A,B,C) = (7.6,-1.3,1.0)$；$\\phi_i = [60,180]$；$E_i = [1.5,0.0]$；$T = 50\\,\\mathrm{K}$。预期行为：一个接近最低能量构象异构体耦合值的平均值。\n- 案例4（接近等权重的高温极限）：$(A,B,C) = (7.6,-1.3,1.0)$；$\\phi_i = [60,180]$；$E_i = [1.5,0.0]$；$T = 50000\\,\\mathrm{K}$。预期行为：一个接近两个耦合值算术平均值的平均值。\n- 案例5（单个构象异构体的边界情况）：$(A,B,C) = (7.6,-1.3,1.0)$；$\\phi_i = [60]$；$E_i = [0.0]$；$T = 298\\,\\mathrm{K}$。预期行为：输出等于 $J(60^\\circ)$。\n\n你的程序应该生成一行输出，其中包含以上述顺序排列的结果，以逗号分隔并用方括号括起来，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_k$ 是一个以 $\\mathrm{Hz}$ 为单位、四舍五入到三位小数的浮点数。",
            "solution": "该问题要求计算柔性分子的系综平均核磁共振（NMR）邻位耦合常数 $\\langle ^{3}J_{HH} \\rangle$。该平均是在一组从模拟中采样的离散构象上进行的，其中每个构象 $i$ 由一个二面角 $\\phi_i$ 和一个摩尔势能 $E_i$ 表征。计算必须在给定的绝对温度 $T$ 下进行。\n\n此计算的理论框架植根于统计力学，特别是正则系综。任何可观测量 $X$ 的系综平均值由所有状态（构象）$i$ 的加权和给出：\n$$ \\langle X \\rangle = \\sum_i p_i X_i $$\n其中 $p_i$ 是在状态 $i$ 中找到系统的概率。\n\n在正则系综中，在绝对温度 $T$ 下，具有摩尔能量 $E_i$ 的状态的概率 $p_i$ 由玻尔兹曼分布给出：\n$$ p_i = \\frac{\\exp\\left(-\\frac{E_i}{R T}\\right)}{\\sum_j \\exp\\left(-\\frac{E_j}{R T}\\right)} $$\n这里，$R$ 是摩尔气体常数，项 $\\exp(-E_i / (RT))$ 是状态 $i$ 的玻尔兹曼权重，我们可以表示为 $w_i$。分母 $Z = \\sum_j w_j$ 是正则配分函数，它是一个归一化因子。\n\n我们感兴趣的可观测量 $X_i$ 是构象 $i$ 的邻位耦合常数 $^{3}J_{HH}$。该值由二面角 $\\phi_i$ 通过经验性的卡普勒斯方程确定：\n$$ J(\\phi_i) = A \\cos^2(\\phi_i) + B \\cos(\\phi_i) + C $$\n其中 $A$、$B$ 和 $C$ 是给定的系数。\n\n将 $p_i$ 和 $X_i = J(\\phi_i)$ 的表达式代入系综平均公式，我们得到要实现的表达式：\n$$ \\langle ^{3}J_{HH} \\rangle = \\sum_i \\left( \\frac{\\exp\\left(-\\frac{E_i}{R T}\\right)}{\\sum_j \\exp\\left(-\\frac{E_j}{R T}\\right)} \\right) J(\\phi_i) = \\frac{\\sum_i J(\\phi_i) \\exp\\left(-\\frac{E_i}{R T}\\right)}{\\sum_i \\exp\\left(-\\frac{E_i}{R T}\\right)} $$\n这是系综中所有构象的耦合常数的玻尔兹曼加权平均值。\n\n每个测试案例的计算过程包括以下步骤：\n1.  **准备输入**：获取二面角列表 $\\{\\phi_i\\}$ 和摩尔能量列表 $\\{E_i\\}$、卡普勒斯系数 $(A, B, C)$ 以及温度 $T$。\n2.  **单位转换**：\n    - 将所有二面角 $\\phi_i$ 从度转换为弧度，以便在三角函数中使用：$\\phi_{i, \\mathrm{rad}} = \\phi_{i, \\mathrm{deg}} \\times \\frac{\\pi}{180}$。\n    - 将所有摩尔能量 $E_i$ 从 $\\mathrm{kJ/mol}$ 转换为 $\\mathrm{J/mol}$，以与摩尔气体常数 $R$ 的单位保持一致：$E_{i, \\mathrm{J/mol}} = E_{i, \\mathrm{kJ/mol}} \\times 1000$。\n3.  **计算单个耦合**：对于每个角度 $\\phi_{i, \\mathrm{rad}}$，使用卡普勒斯方程计算相应的耦合常数 $J(\\phi_i)$。\n4.  **计算玻尔兹曼权重**：对于每个能量 $E_{i, \\mathrm{J/mol}}$，计算指数中的项 $\\beta E_i = E_{i, \\mathrm{J/mol}} / (RT)$，其中 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。每个状态的玻尔兹曼权重为 $w_i = \\exp(-\\beta E_i)$。为提高数值稳定性，尤其是在处理大能量值时，明智的做法是在计算权重之前从所有能量中减去最小能量 $E_{\\min}$：$E'_i = E_i - E_{\\min}$。然后权重为 $w_i = \\exp(-(E'_i)/(RT))$。这在数学上是等效的，因为产生的常数因子 $\\exp(E_{\\min}/(RT))$ 在分子和分母之间抵消了，但它可以防止数值下溢或上溢。\n5.  **计算加权和**：计算平均值的分子，即每个耦合常数与其相应玻尔兹曼权重的乘积之和：$\\mathrm{Num} = \\sum_i J(\\phi_i) w_i$。\n6.  **计算配分函数**：计算分母，即所有玻尔兹曼权重的总和（配分函数）：$\\mathrm{Den} = \\sum_i w_i$。\n7.  **计算最终平均值**：系综平均耦合是分子与分母的比值：$\\langle ^{3}J_{HH} \\rangle = \\frac{\\mathrm{Num}}{\\mathrm{Den}}$。\n8.  **格式化输出**：每个案例的最终结果必须四舍五入到三位小数。\n\n此过程将应用于所提供的五个测试案例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the ensemble-averaged NMR vicinal coupling constant based on\n    the Karplus equation and Boltzmann weighting for a series of test cases.\n    \"\"\"\n    \n    # Define the molar gas constant in J mol^-1 K^-1\n    R = 8.31446261815324\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: ((A, B, C), phi_deg, E_kj_mol, T_k)\n    test_cases = [\n        # Case 1: Typical anti/gauche population at ambient temperature\n        ((7.6, -1.3, 1.0), [60.0, 180.0], [1.5, 0.0], 298.0),\n        # Case 2: Uniform sampling over six staggered angles with equal energy\n        ((7.6, -1.3, 1.0), [0.0, 60.0, 120.0, 180.0, 240.0, 300.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 298.0),\n        # Case 3: Low-temperature limit emphasizing the minimum-energy conformer\n        ((7.6, -1.3, 1.0), [60.0, 180.0], [1.5, 0.0], 50.0),\n        # Case 4: High-temperature limit approaching equal weighting\n        ((7.6, -1.3, 1.0), [60.0, 180.0], [1.5, 0.0], 50000.0),\n        # Case 5: Single conformer boundary case\n        ((7.6, -1.3, 1.0), [60.0], [0.0], 298.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        karplus_coeffs, phi_deg, E_kj_mol, T_k = case\n        A, B, C = karplus_coeffs\n\n        # Convert inputs to NumPy arrays for vectorized operations\n        phi_deg_arr = np.array(phi_deg)\n        E_kj_mol_arr = np.array(E_kj_mol)\n\n        # Step 1: Convert units\n        # Angles from degrees to radians\n        phi_rad_arr = np.deg2rad(phi_deg_arr)\n        # Energies from kJ/mol to J/mol\n        E_j_mol_arr = E_kj_mol_arr * 1000.0\n\n        # Step 2: Calculate J(phi) for each conformation\n        # J(phi) = A*cos^2(phi) + B*cos(phi) + C\n        cos_phi = np.cos(phi_rad_arr)\n        J_values = A * cos_phi**2 + B * cos_phi + C\n\n        # Step 3: Calculate Boltzmann weights with numerical stability\n        # The term RT in the denominator\n        RT = R * T_k\n        \n        # Avoid underflow/overflow by shifting energies relative to the minimum\n        if E_j_mol_arr.size > 0:\n            E_min = np.min(E_j_mol_arr)\n            relative_E = E_j_mol_arr - E_min\n        else:\n            relative_E = np.array([])\n        \n        # The exponent can be zero, which is safe.\n        with np.errstate(divide='ignore', invalid='ignore'):\n            if RT == 0:\n                # If T=0, only the lowest energy state is populated.\n                # All exponents for E > E_min are -inf, weights are 0.\n                # Exponent for E = E_min is 0, weight is 1.\n                exponents = np.full_like(relative_E, -np.inf)\n                min_energy_indices = np.where(relative_E == 0)[0]\n                if min_energy_indices.size > 0:\n                    exponents[min_energy_indices] = 0\n            else:\n                 exponents = -relative_E / RT\n        \n        boltzmann_weights = np.exp(exponents)\n\n        # Step 4: Calculate the ensemble average\n        numerator = np.sum(J_values * boltzmann_weights)\n        denominator = np.sum(boltzmann_weights)\n\n        if denominator == 0:\n            # Fallback for empty inputs or cases where all weights are zero\n            avg_J = 0.0 if J_values.size == 0 else J_values[0]\n        else:\n            avg_J = numerator / denominator\n        \n        results.append(avg_J)\n\n    # Step 5: Format and print the final results as requested\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n```"
        },
        {
            "introduction": "在前面的练习中，我们从已知的结构出发来预测耦合常数。然而，在实际的光谱解析中，我们常常面临相反的挑战：如何从复杂的谱图中提取精确的结构参数。当耦合质子之间的化学位移差与耦合常数大小相当时，会产生“二级效应”，使得谱线的分裂值不再直接等于耦合常数 $J$。本练习将引导您分析一个典型的 ABX 自旋体系的谱图，从一组已解析的谱线位置出发，反向推导出潜在的化学位移差，这是在处理真实、复杂的核磁共振数据时一项至关重要的技能 。",
            "id": "3705715",
            "problem": "一个非对映异构的亚甲基 $\\,\\mathrm{CH_{2}}\\,$，临近一个手性中心 $X$，在一维质子核磁共振 (NMR) 谱中产生一个 $\\,\\mathrm{ABX}\\,$ 谱图。将该体系视为三个自旋-$\\tfrac{1}{2}$ 的原子核 $\\,(A,B,X)\\,$，它们具有各向同性标量耦合，并假设相对于塞曼项采用了强场久期近似。各向同性标量耦合 $\\,{}^{2}J_{AB}\\,$ (偕偶) 和 $\\,{}^{3}J_{AX},\\,{}^{3}J_{BX}\\,$ (邻偶) 通过独立分析已知为 $\\,{}^{2}J_{AB} = 14.0\\,\\mathrm{Hz},\\,{}^{3}J_{AX} = 8.0\\,\\mathrm{Hz},\\,{}^{3}J_{BX} = 4.0\\,\\mathrm{Hz}$。波谱仪频率足够高，因此可以不失一般性地以 $\\mathrm{Hz}$ 为单位处理频率。$\\,\\mathrm{ABX}\\,$ 谱图中八条可分辨谱线的位置，参考 A 和 B 跃迁的总体重心（即所有八条谱线位置的平均值为 $0$）作为偏移量（单位为 $\\mathrm{Hz}$），测量得到\n$\\{\\, -21.401754,\\; -17.038405,\\; -7.401754,\\; -3.038405,\\; 1.401754,\\; 9.038405,\\; 15.401754,\\; 23.038405 \\,\\}$。\n定义化学位移差 $\\,\\Delta\\nu_{AB} \\equiv \\nu_{A}-\\nu_{B}\\,$，单位为 $\\mathrm{Hz}$。\n\n从三个耦合的自旋-$\\tfrac{1}{2}$ 原子核的自旋哈密顿量（具有各向同性标量耦合和强磁场下的久期近似）出发，推导一个程序，当 $\\,{}^{2}J_{AB},\\,{}^{3}J_{AX},\\,{}^{3}J_{BX}\\,$ 已知时，从上述观测到的 $\\,\\mathrm{ABX}\\,$ 谱线位置中提取 $\\,\\Delta\\nu_{AB}\\,$。你的推导必须从哈密顿量层面的描述开始，简化为在 $m_{X}=\\pm \\tfrac{1}{2}$ 流形中的有效双自旋-$\\mathrm{AB}$ 子谱，然后将每个子谱内可观测的内、外间距与 $\\,\\Delta\\nu_{AB}\\,$ 联系起来。然后应用你推导的程序到所提供的数据上，计算出 $\\,\\Delta\\nu_{AB}\\,$ 的单个数值，单位为 $\\mathrm{Hz}$。\n\n在立体化学背景下，假设在该分子骨架中，与 $X$ 表现出较大邻偶耦合的亚甲基质子，根据 Cahn–Ingold–Prelog (CIP) 约定，对应于 pro-$R$ 氢。使用此假设以及已知的 $\\,{}^{3}J_{AX}\\,$ 和 $\\,{}^{3}J_{BX}\\,$ 值，在你的推导中简要说明非对映异构对中的哪个成员是 pro-$R$，哪个是 pro-$S$。\n\n最终答案只报告 $\\,\\Delta\\nu_{AB}\\,$ 的数值，单位为 $\\mathrm{Hz}$，四舍五入到四位有效数字。最终的方框答案中不要包含单位；但是，所有中间讨论都应使用 $\\mathrm{Hz}$作为频率和耦合常数的单位。",
            "solution": "该问题是有效的，因为它科学地基于核磁共振 (NMR) 波谱学原理，特别是二级 ABX 自旋体系的分析。这个问题提取得当，提供了所有必要的数据和定义（耦合常数、谱线位置），以确定化学位移差 $\\Delta\\nu_{AB}$ 的唯一值。所使用的语言客观、精确，物理参数也符合实际。\n\n第一步是为强场久期近似下的 ABX 自旋体系建立理论框架。三个耦合的自旋-$\\frac{1}{2}$ 原子核 (A, B, X) 的自旋哈密顿量 $\\hat{H}$ 由塞曼项和标量耦合项之和给出。频率以 $\\mathrm{Hz}$ 表示，因此哈密顿量的单位是能量（隐式乘以普朗克常数 $h$）。\n$$ \\hat{H} = \\nu_A \\hat{I}_{zA} + \\nu_B \\hat{I}_{zB} + \\nu_X \\hat{I}_{zX} - J_{AB} \\hat{\\mathbf{I}}_A \\cdot \\hat{\\mathbf{I}}_B - J_{AX} \\hat{\\mathbf{I}}_A \\cdot \\hat{\\mathbf{I}}_X - J_{BX} \\hat{\\mathbf{I}}_B \\cdot \\hat{\\mathbf{I}}_X $$\n在强场（或久期）近似下，对于一个 ABX 体系，其中 $\\Delta\\nu_{AB}$ 可能与 $J_{AB}$ 相当，但 $\\Delta\\nu_{AX}$ 和 $\\Delta\\nu_{BX}$ 很大，哈密顿量得以简化。AX 和 BX 耦合的非久期部分被截断，而 AB 对的完整标量耦合被保留：\n$$ \\hat{H}_{\\text{sec}} = \\nu_A \\hat{I}_{zA} + \\nu_B \\hat{I}_{zB} + \\nu_X \\hat{I}_{zX} - J_{AB}(\\hat{I}_{zA}\\hat{I}_{zB} + \\frac{1}{2}(\\hat{I}_{+A}\\hat{I}_{-B} + \\hat{I}_{-A}\\hat{I}_{+B})) - J_{AX} \\hat{I}_{zA} \\hat{I}_{zX} - J_{BX} \\hat{I}_{zB} \\hat{I}_{zX} $$\n这个哈密顿量与 $\\hat{I}_{zX}$ 对易，意味着原子核 X 的自旋 z-分量 $m_X$ 是一个好量子数。这使得问题可以分解为两个独立的子问题，分别对应 X 的两种自旋态：$m_X = +\\frac{1}{2}$ 和 $m_X = -\\frac{1}{2}$。\n\n对于 $m_X = +\\frac{1}{2}$ 的态流形，我们可以用其本征值 $+\\frac{1}{2}$ 替换算符 $\\hat{I}_{zX}$。AB 部分的有效哈密顿量变为：\n$$ \\hat{H}' = (\\nu_A - \\frac{1}{2}J_{AX}) \\hat{I}_{zA} + (\\nu_B - \\frac{1}{2}J_{BX}) \\hat{I}_{zB} - J_{AB}(\\hat{I}_{zA}\\hat{I}_{zB} + \\frac{1}{2}(\\dots)) + (\\text{const}) $$\n这是一个有效 AB 体系的哈密顿量，其有效化学位移为 $\\nu'_A = \\nu_A - \\frac{1}{2}J_{AX}$ 和 $\\nu'_B = \\nu_B - \\frac{1}{2}J_{BX}$。该子谱的有效化学位移差为：\n$$ \\Delta\\nu' = \\nu'_A - \\nu'_B = (\\nu_A - \\nu_B) - \\frac{1}{2}(J_{AX} - J_{BX}) = \\Delta\\nu_{AB} - \\frac{1}{2}(J_{AX} - J_{BX}) $$\n\n对于 $m_X = -\\frac{1}{2}$ 的流形，我们用其本征值 $-\\frac{1}{2}$ 替换 $\\hat{I}_{zX}$。有效哈密顿量为：\n$$ \\hat{H}'' = (\\nu_A + \\frac{1}{2}J_{AX}) \\hat{I}_{zA} + (\\nu_B + \\frac{1}{2}J_{BX}) \\hat{I}_{zB} - J_{AB}(\\hat{I}_{zA}\\hat{I}_{zB} + \\frac{1}{2}(\\dots)) + (\\text{const}) $$\n这对应于第二个有效 AB 体系，其有效化学位移为 $\\nu''_A = \\nu_A + \\frac{1}{2}J_{AX}$ 和 $\\nu''_B = \\nu_B + \\frac{1}{2}J_{BX}$。有效化学位移差为：\n$$ \\Delta\\nu'' = \\nu''_A - \\nu''_B = (\\nu_A - \\nu_B) + \\frac{1}{2}(J_{AX} - J_{BX}) = \\Delta\\nu_{AB} + \\frac{1}{2}(J_{AX} - J_{BX}) $$\n\n因此，观测到的 ABX 谱的 8 条谱线构成了两个独立的 4 线 AB 四重峰。每个 AB 四重峰的中心是其有效化学位移的平均值。令 $\\nu_0 = \\frac{1}{2}(\\nu_A+\\nu_B)$。两个子谱的中心是：\n$$ \\nu'_0 = \\frac{1}{2}(\\nu'_A + \\nu'_B) = \\nu_0 - \\frac{1}{4}(J_{AX} + J_{BX}) $$\n$$ \\nu''_0 = \\frac{1}{2}(\\nu''_A + \\nu''_B) = \\nu_0 + \\frac{1}{4}(J_{AX} + J_{BX}) $$\n问题说明谱线位置是相对于总重心 $\\nu_0$ 的。因此我们可以设置 $\\nu_0=0$。\n\n使用给定的耦合常数 $J_{AX}=8.0\\,\\mathrm{Hz}$ 和 $J_{BX}=4.0\\,\\mathrm{Hz}$：\n$$ J_{AX}+J_{BX} = 12.0\\,\\mathrm{Hz} $$\n两个子谱的中心位于：\n$$ \\nu'_0 = -\\frac{1}{4}(12.0\\,\\mathrm{Hz}) = -3.0\\,\\mathrm{Hz} $$\n$$ \\nu''_0 = +\\frac{1}{4}(12.0\\,\\mathrm{Hz}) = +3.0\\,\\mathrm{Hz} $$\n\n一个标准 AB 子谱的四条谱线，其中心为 $\\nu_{\\text{qcenter}}$，频率由 $\\nu_{\\text{qcenter}} \\pm \\frac{N}{2} \\pm \\frac{J_{AB}}{2}$ 给出，其中 $N = \\sqrt{(\\Delta\\nu_{\\text{q}})^2 + J_{AB}^2}$。重要的是，这四条谱线的平均值即为子谱中心 $\\nu_{\\text{qcenter}}$。这为我们将八条观测谱线划分到两个子谱中提供了依据。\n\n给定的谱线位置是：\n$L = \\{ -21.401754, -17.038405, -7.401754, -3.038405, 1.401754, 9.038405, 15.401754, 23.038405 \\}\\,\\mathrm{Hz}$。\n让我们找到以 $\\nu''_0=+3.0\\,\\mathrm{Hz}$ 为中心的子谱，其谱线总和必须为 $4 \\times 3.0 = 12.0\\,\\mathrm{Hz}$。通过观察和尝试，我们发现集合 $S''$ 为：\n$S'' = \\{ -17.038405, -3.038405, 9.038405, 23.038405 \\}$。\n$S''$ 的和 $= -17.038405 - 3.038405 + 9.038405 + 23.038405 = 12.0\\,\\mathrm{Hz}$。\n剩余的谱线构成集合 $S'$：\n$S' = \\{ -21.401754, -7.401754, 1.401754, 15.401754 \\}$。\n$S'$ 的和 $= -21.401754 - 7.401754 + 1.401754 + 15.401754 = -12.0\\,\\mathrm{Hz}$。\n平均值为 $-3.0\\,\\mathrm{Hz}$，即 $\\nu'_0$。划分是正确的。\n\n现在，我们为每个子谱提取参数 $N$。对于任何 AB 四重峰，其中谱线按频率排序为 $\\nu_1 > \\nu_2 > \\nu_3 > \\nu_4$，裂分 $N$ 可以通过 $N = \\frac{1}{2}[(\\nu_1-\\nu_4) + (\\nu_2-\\nu_3)]$ 计算得出。\n对于 $S''=\\{23.038405, 9.038405, -3.038405, -17.038405\\}$，排序后：\n$\\nu_1=23.038405$, $\\nu_2=9.038405$, $\\nu_3=-3.038405$, $\\nu_4=-17.038405$。\n$N'' = \\frac{1}{2}[ (23.038405 - (-17.038405)) + (9.038405 - (-3.038405)) ]$\n$N'' = \\frac{1}{2}[ 40.07681 + 12.07681 ] = \\frac{1}{2}[52.15362] = 26.07681\\,\\mathrm{Hz}$。\n\n对于 $S'=\\{-21.401754, -7.401754, 1.401754, 15.401754\\}$，排序后：\n$\\nu_1=15.401754$, $\\nu_2=1.401754$, $\\nu_3=-7.401754$, $\\nu_4=-21.401754$。\n$N' = \\frac{1}{2}[ (15.401754 - (-21.401754)) + (1.401754 - (-7.401754)) ]$\n$N' = \\frac{1}{2}[ 36.803508 + 8.803508 ] = \\frac{1}{2}[45.607016] = 22.803508\\,\\mathrm{Hz}$。\n\n现在我们可以使用关系式 $|\\Delta\\nu_{\\text{q}}| = \\sqrt{N^2 - J_{AB}^2}$ 和给定的 $J_{AB}=14.0\\,\\mathrm{Hz}$，计算有效化学位移差的绝对值 $|\\Delta\\nu'|$ 和 $|\\Delta\\nu''|$：\n$|\\Delta\\nu'| = \\sqrt{(N')^2 - J_{AB}^2} = \\sqrt{(22.803508)^2 - (14.0)^2} = \\sqrt{520.00 - 196.00} = \\sqrt{324.00} = 18.0\\,\\mathrm{Hz}$。\n$|\\Delta\\nu''| = \\sqrt{(N'')^2 - J_{AB}^2} = \\sqrt{(26.07681)^2 - (14.0)^2} = \\sqrt{680.00 - 196.00} = \\sqrt{484.00} = 22.0\\,\\mathrm{Hz}$。\n\n我们有两个将这些值与 $\\Delta\\nu_{AB}$ 相关联的方程。令 $K = \\frac{1}{2}(J_{AX}-J_{BX}) = \\frac{1}{2}(8.0-4.0) = 2.0\\,\\mathrm{Hz}$。\n$|\\Delta\\nu'| = |\\Delta\\nu_{AB} - K| \\implies 18.0 = |\\Delta\\nu_{AB} - 2.0|$\n$|\\Delta\\nu''| = |\\Delta\\nu_{AB} + K| \\implies 22.0 = |\\Delta\\nu_{AB} + 2.0|$\n将这些方程平方得到：\n$(\\Delta\\nu')^2 = (\\Delta\\nu_{AB} - 2.0)^2 = \\Delta\\nu_{AB}^2 - 4.0\\Delta\\nu_{AB} + 4.0 = 18.0^2 = 324.0$\n$(\\Delta\\nu'')^2 = (\\Delta\\nu_{AB} + 2.0)^2 = \\Delta\\nu_{AB}^2 + 4.0\\Delta\\nu_{AB} + 4.0 = 22.0^2 = 484.0$\n用第二个方程减去第一个方程得到：\n$8.0\\Delta\\nu_{AB} = 484.0 - 324.0 = 160.0$\n$$ \\Delta\\nu_{AB} = \\frac{160.0}{8.0} = 20.0\\,\\mathrm{Hz} $$\n\n立体化学归属基于所提供的规则：具有较大邻偶耦合的质子是 pro-$R$。我们已知 ${}^{3}J_{AX} = 8.0\\,\\mathrm{Hz}$ 和 ${}^{3}J_{BX} = 4.0\\,\\mathrm{Hz}$。由于 ${}^{3}J_{AX} > {}^{3}J_{BX}$，质子 A 是亚甲基的 pro-$R$ 氢，质子 B 是 pro-$S$ 氢。\n\n化学位移差的最终值是 $\\Delta\\nu_{AB} = 20.0\\,\\mathrm{Hz}$。问题要求答案四舍五入到四位有效数字，即 $20.00$。",
            "answer": "$$\\boxed{20.00}$$"
        }
    ]
}