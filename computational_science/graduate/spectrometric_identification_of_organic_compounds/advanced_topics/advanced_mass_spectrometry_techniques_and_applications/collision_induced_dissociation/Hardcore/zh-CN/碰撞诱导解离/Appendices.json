{
    "hands_on_practices": [
        {
            "introduction": "在碰撞诱导解离（CID）中，真正决定分子是否以及如何碎裂的，并非离子在实验室坐标系下的动能（$E_{\\mathrm{lab}}$），而是碰撞质心系中的能量（$E_{\\mathrm{cm}}$）。这个能量才是可用于激发离子内能、使其断裂的有效能量。通过这个练习，你将从第一性原理出发，推导$E_{\\mathrm{cm}}$的表达式，并亲手计算不同碰撞气体（如氩气和氦气）对有效碰撞能量的显著影响，从而深刻理解为何选择合适的碰撞气体对于质谱实验至关重要。",
            "id": "3697131",
            "problem": "在碰撞诱导解离 (CID) 中，碎裂效率取决于加速离子与静止中性气体原子之间的质心 (COM) 碰撞能量。考虑一个单质子化的肽阳离子，其质荷比为 $m/z = 500$ (Th)，电荷态为 $z=+1$，因此其质量 $m_{\\mathrm{ion}} \\approx 500$ 统一原子质量单位 (u)。该离子被加速到实验室坐标系动能 $E_{\\mathrm{lab}} = 50$ 电子伏特 (eV)，并与静止的惰性气体原子发生双体碰撞。\n\n从动能和双体系统折合质量的基本定义出发，推导以 $E_{\\mathrm{lab}}$、$m_{\\mathrm{ion}}$ 和靶气体质量 $m_{\\mathrm{gas}}$ 表示的质心碰撞能量 $E_{\\mathrm{cm}}$ 的表达式。然后，使用此表达式计算与氩和氦碰撞时的 $E_{\\mathrm{cm}}$。使用 $m_{\\mathrm{Ar}} = 39.948$ u 和 $m_{\\mathrm{He}} = 4.002602$ u。最后，通过计算差值 $E_{\\mathrm{cm}}(\\mathrm{Ar}) - E_{\\mathrm{cm}}(\\mathrm{He})$ 来量化当氩被氦替代时 $E_{\\mathrm{cm}}$ 的变化。\n\n所有能量均以电子伏特 (eV) 表示，并将您的数值结果四舍五入到四位有效数字。",
            "solution": "该问题已经过验证，被认为是有效的。它在科学上基于经典碰撞力学原理，问题阐述清晰，提供了所有必要信息，并且表述客观。未发现任何缺陷。我们可以开始求解。\n\n该问题要求推导一个双体系统的质心 (COM) 碰撞能量 $E_{\\mathrm{cm}}$，其中一个粒子初始运动而另一个粒子静止。随后，该表达式将用于数值计算。\n\n设加速离子的质量为 $m_{\\mathrm{ion}}$，其在实验室坐标系中的速度为 $\\vec{v}_{\\mathrm{ion}}$。设静止靶气体原子的质量为 $m_{\\mathrm{gas}}$，其在实验室坐标系中的速度为 $\\vec{v}_{\\mathrm{gas}} = \\vec{0}$。\n\n离子在实验室坐标系中的动能 $E_{\\mathrm{lab}}$ 由下式给出：\n$$E_{\\mathrm{lab}} = \\frac{1}{2} m_{\\mathrm{ion}} v_{\\mathrm{ion}}^2$$\n由于靶是静止的，实验室坐标系中的总动能等于 $E_{\\mathrm{lab}}$。\n\n质心能量 $E_{\\mathrm{cm}}$ 对应于双体系统的内动能。这是可用于激发或碎裂等过程的能量，等效于一个质量为折合质量 $\\mu$、以两个碰撞伙伴的相对速度 $\\vec{v}_{\\mathrm{rel}}$ 运动的假想粒子的动能。\n\n相对速度定义为两个粒子速度之差：\n$$\\vec{v}_{\\mathrm{rel}} = \\vec{v}_{\\mathrm{ion}} - \\vec{v}_{\\mathrm{gas}}$$\n给定 $\\vec{v}_{\\mathrm{gas}} = \\vec{0}$，相对速度的大小就是离子速度的大小：\n$$v_{\\mathrm{rel}} = |\\vec{v}_{\\mathrm{ion}}| = v_{\\mathrm{ion}}$$\n\n双体系统的折合质量 $\\mu$ 定义为：\n$$\\mu = \\frac{m_{\\mathrm{ion}} m_{\\mathrm{gas}}}{m_{\\mathrm{ion}} + m_{\\mathrm{gas}}}$$\n\n质心能量 $E_{\\mathrm{cm}}$ 于是表示为：\n$$E_{\\mathrm{cm}} = \\frac{1}{2} \\mu v_{\\mathrm{rel}}^2$$\n将 $\\mu$ 和 $v_{\\mathrm{rel}}$ 的表达式代入此方程，我们得到：\n$$E_{\\mathrm{cm}} = \\frac{1}{2} \\left( \\frac{m_{\\mathrm{ion}} m_{\\mathrm{gas}}}{m_{\\mathrm{ion}} + m_{\\mathrm{gas}}} \\right) v_{\\mathrm{ion}}^2$$\n\n为了将 $E_{\\mathrm{cm}}$ 与 $E_{\\mathrm{lab}}$ 联系起来，我们重新整理 $E_{\\mathrm{lab}}$ 的表达式以求解 $v_{\\mathrm{ion}}^2$：\n$$v_{\\mathrm{ion}}^2 = \\frac{2 E_{\\mathrm{lab}}}{m_{\\mathrm{ion}}}$$\n现在，我们将其代入 $E_{\\mathrm{cm}}$ 的表达式：\n$$E_{\\mathrm{cm}} = \\frac{1}{2} \\left( \\frac{m_{\\mathrm{ion}} m_{\\mathrm{gas}}}{m_{\\mathrm{ion}} + m_{\\mathrm{gas}}} \\right) \\left( \\frac{2 E_{\\mathrm{lab}}}{m_{\\mathrm{ion}}} \\right)$$\n项 $\\frac{1}{2}$、 $2$ 和 $m_{\\mathrm{ion}}$ 消去，得到静止靶的最终表达式：\n$$E_{\\mathrm{cm}} = E_{\\mathrm{lab}} \\left( \\frac{m_{\\mathrm{gas}}}{m_{\\mathrm{ion}} + m_{\\mathrm{gas}}} \\right)$$\n这就是推导出的质心能量、实验室坐标系能量以及入射粒子和靶的质量之间的关系。\n\n现在我们进行数值计算。给定值为：\n离子质量，$m_{\\mathrm{ion}} = 500~\\mathrm{u}$。\n实验室坐标系动能，$E_{\\mathrm{lab}} = 50~\\mathrm{eV}$。\n氩原子质量，$m_{\\mathrm{Ar}} = 39.948~\\mathrm{u}$。\n氦原子质量，$m_{\\mathrm{He}} = 4.002602~\\mathrm{u}$。\n\n首先，我们计算与氩碰撞的质心能量 ($m_{\\mathrm{gas}} = m_{\\mathrm{Ar}}$)：\n$$E_{\\mathrm{cm}}(\\mathrm{Ar}) = E_{\\mathrm{lab}} \\left( \\frac{m_{\\mathrm{Ar}}}{m_{\\mathrm{ion}} + m_{\\mathrm{Ar}}} \\right)$$\n$$E_{\\mathrm{cm}}(\\mathrm{Ar}) = 50~\\mathrm{eV} \\times \\left( \\frac{39.948}{500 + 39.948} \\right)$$\n$$E_{\\mathrm{cm}}(\\mathrm{Ar}) = 50~\\mathrm{eV} \\times \\left( \\frac{39.948}{539.948} \\right)$$\n$$E_{\\mathrm{cm}}(\\mathrm{Ar}) \\approx 50~\\mathrm{eV} \\times 0.0739845 \\approx 3.699225~\\mathrm{eV}$$\n四舍五入到四位有效数字，我们得到 $E_{\\mathrm{cm}}(\\mathrm{Ar}) \\approx 3.699~\\mathrm{eV}$。\n\n接下来，我们计算与氦碰撞的质心能量 ($m_{\\mathrm{gas}} = m_{\\mathrm{He}}$)：\n$$E_{\\mathrm{cm}}(\\mathrm{He}) = E_{\\mathrm{lab}} \\left( \\frac{m_{\\mathrm{He}}}{m_{\\mathrm{ion}} + m_{\\mathrm{He}}} \\right)$$\n$$E_{\\mathrm{cm}}(\\mathrm{He}) = 50~\\mathrm{eV} \\times \\left( \\frac{4.002602}{500 + 4.002602} \\right)$$\n$$E_{\\mathrm{cm}}(\\mathrm{He}) = 50~\\mathrm{eV} \\times \\left( \\frac{4.002602}{504.002602} \\right)$$\n$$E_{\\mathrm{cm}}(\\mathrm{He}) \\approx 50~\\mathrm{eV} \\times 0.00794164 \\approx 0.397082~\\mathrm{eV}$$\n四舍五入到四位有效数字，我们得到 $E_{\\mathrm{cm}}(\\mathrm{He}) \\approx 0.3971~\\mathrm{eV}$。\n\n最后，我们通过计算差值来量化 $E_{\\mathrm{cm}}$ 的变化：\n$$\\Delta E_{\\mathrm{cm}} = E_{\\mathrm{cm}}(\\mathrm{Ar}) - E_{\\mathrm{cm}}(\\mathrm{He})$$\n$$\\Delta E_{\\mathrm{cm}} \\approx 3.699225~\\mathrm{eV} - 0.397082~\\mathrm{eV} \\approx 3.302143~\\mathrm{eV}$$\n将最终结果四舍五入到四位有效数字，我们得到 $\\Delta E_{\\mathrm{cm}} \\approx 3.302~\\mathrm{eV}$。\n\n计算出的值为 $E_{\\mathrm{cm}}(\\mathrm{Ar}) \\approx 3.699~\\mathrm{eV}$，$E_{\\mathrm{cm}}(\\mathrm{He}) \\approx 0.3971~\\mathrm{eV}$，差值约为 $3.302~\\mathrm{eV}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.699  0.3971  3.302 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论概念与仪器操作之间往往存在一道鸿沟。在实际的质谱分析中，我们不直接设置$E_{\\mathrm{lab}}$，而是通过一个称为“归一化碰撞能量”（Normalized Collision Energy, NCE）的参数来控制碎裂。这个练习旨在揭开NCE的神秘面纱，指导你推导其与离子质荷比（$m/z$）及实验室系能量之间的数学关系。完成这个练习后，你将理解仪器是如何通过NCE这一简化参数，来尝试为不同分析物提供可比较的碎裂条件的。",
            "id": "3697140",
            "problem": "在用于有机化合物光谱鉴定的束流型碰撞诱导解离 (CID) 中，碎裂结果由离子的实验室坐标系动能决定，该动能产生于离子通过静电势差的加速过程。实验室坐标系动能由一个基本关系给出：电荷通过电势差加速所获得的动能等于该电荷与电势差的乘积。用符号表示，一个电荷为 $z$ 的离子通过电势 $V$ 加速，获得的实验室坐标系动能为 $E_{\\mathrm{lab}} = z e V$，其中 $e$ 是元电荷，$V$ 的单位是伏特；等效地，当 $V$ 的单位是伏特时，$E_{\\mathrm{lab}}$ 以电子伏特 (eV) 为单位表示为 $E_{\\mathrm{lab}} = z V$。为了在不同质荷比 $m/z$ 和电荷 $z$ 的离子间保持近似恒定的质心碰撞能量，许多仪器采用一个称为归一化碰撞能量 (NCE) 的控制参数，该参数根据 $m/z$ 来调节加速电压。假设 NCE 的操作定义如下：在固定的 NCE 下，加速电压与 $m/z$ 成正比，并且其参考标准为：当一个电荷为 $z=1$、参考质荷比为 $m_{\\ast}$ 的单电荷离子的无量纲 NCE 设置为 $\\eta = 1$ 时，加速电压等于参考值 $V_{\\ast}$。在这些假设下，请从第一性原理出发，推导出一个通用表达式，用于计算电荷为 $z$、质荷比为 $m/z$ 的离子达到目标实验室坐标系动能 $E_{\\mathrm{lab}}$ 所需的 NCE 设置 $\\eta$。然后，使用您推导的表达式，计算在一台参考参数为 $V_{\\ast} = 100$ V 和 $m_{\\ast} = 200$ 的仪器上，使一个 $z=1$、$m/z = 400$ 的单电荷离子达到 $E_{\\mathrm{lab}} = 35$ eV 所需的具体 NCE 值。将归一化碰撞能量表示为无量纲分数（而非百分比），并将最终数值结果四舍五入至三位有效数字。",
            "solution": "该问题是有效的，因为它科学地基于质谱学的原理，问题提出得很好，信息充分且一致，并且其表述是客观的。\n\n目标是首先推导归一化碰撞能量 (NCE) 设置（用 $\\eta$ 表示）的通用表达式，然后为一组给定的参数计算其具体值。\n\n推导过程从所提供的第一性原理和定义出发。\n\n首先，我们得到了实验室坐标系动能 $E_{\\mathrm{lab}}$、离子电荷数 $z$ 以及其加速所通过的静电势差 $V$ 之间的关系。问题提供了一种方便的形式，其中 $E_{\\mathrm{lab}}$ 以电子伏特 (eV) 表示，$V$ 以伏特 (V) 表示：\n$$E_{\\mathrm{lab}} = z V$$\n这个方程可以重排，用来表示以期望的实验室坐标系动能表示的电势 $V$：\n$$V = \\frac{E_{\\mathrm{lab}}}{z}$$\n\n其次，我们得到了 NCE 设置 $\\eta$ 的操作定义。该定义指出，在固定的 NCE 值下，加速电压 $V$ 与质荷比 $m/z$ 成正比。“归一化碰撞能量”这个术语意味着电势与设置 $\\eta$ 之间存在线性缩放关系。因此，我们可以将电势 $V$ 表示为与 $\\eta$ 和 $m/z$ 共同成正比：\n$$V \\propto \\eta \\left(\\frac{m}{z}\\right)$$\n我们引入一个比例常数 $k$，来构成一个方程：\n$$V = k \\cdot \\eta \\cdot \\left(\\frac{m}{z}\\right)$$\n\n为了确定常数 $k$，我们使用提供的参考条件：当一个电荷为 $z=1$、参考质荷比为 $m_{\\ast}$ 的单电荷离子的 $\\eta = 1$ 时，电势为参考值 $V_{\\ast}$。对于这个特定的离子，其质荷比 $m/z$ 等于 $m_{\\ast}$。将这些值代入我们的 $V$ 方程：\n$$V_{\\ast} = k \\cdot (1) \\cdot m_{\\ast}$$\n求解 $k$ 可得：\n$$k = \\frac{V_{\\ast}}{m_{\\ast}}$$\n\n现在，我们将 $k$ 的这个表达式代回电势 $V$ 的通用方程：\n$$V = \\left(\\frac{V_{\\ast}}{m_{\\ast}}\\right) \\eta \\left(\\frac{m}{z}\\right)$$\n该方程定义了在具有参考参数 $V_{\\ast}$ 和 $m_{\\ast}$ 的仪器上，对于任何质荷比为 $m/z$ 的离子，在任何 NCE 设置 $\\eta$ 下的加速电压 $V$。\n\n为了推导 $\\eta$ 的通用表达式，我们将电势 $V$ 的两个表达式相等：\n$$\\frac{E_{\\mathrm{lab}}}{z} = \\left(\\frac{V_{\\ast}}{m_{\\ast}}\\right) \\eta \\left(\\frac{m}{z}\\right)$$\n我们的目标是求解 $\\eta$。我们可以通过消去两边分母中的电荷数 $z$ 来简化方程：\n$$E_{\\mathrm{lab}} = \\left(\\frac{V_{\\ast}}{m_{\\ast}}\\right) \\eta \\cdot m$$\n这个中间结果表明，对于给定的 NCE 设置 $\\eta$，实验室坐标系动能 $E_{\\mathrm{lab}}$ 与离子的质量 $m$ 成正比，而不是其质荷比。这与 NCE 的目标一致，即实现近似恒定的质心碰撞能量。\n\n为了获得所需的 $\\eta$ 表达式，我们重排该方程。我们还用给定的量 $m/z$ 和 $z$ 来表示质量 $m$，其中 $m = (m/z) \\cdot z$：\n$$E_{\\mathrm{lab}} = \\frac{V_{\\ast}}{m_{\\ast}} \\eta \\left( \\left(\\frac{m}{z}\\right) z \\right)$$\n现在，我们求解 $\\eta$：\n$$\\eta = \\frac{E_{\\mathrm{lab}} \\cdot m_{\\ast}}{V_{\\ast} \\cdot (m/z) \\cdot z}$$\n这就是对于一个电荷为 $z$、质荷比为 $m/z$ 的离子，要达到目标实验室坐标系动能 $E_{\\mathrm{lab}}$ 所需的 NCE 设置 $\\eta$ 的通用表达式。\n\n接下来，我们使用这个推导出的公式来计算给定参数下的具体 NCE 值：\n- 目标实验室坐标系动能, $E_{\\mathrm{lab}} = 35 \\text{ eV}$\n- 离子电荷数, $z=1$\n- 离子质荷比, $m/z = 400$\n- 参考电势, $V_{\\ast} = 100 \\text{ V}$\n- 参考质荷比, $m_{\\ast} = 200$\n\n将这些值代入我们的 $\\eta$ 表达式：\n$$\\eta = \\frac{35 \\cdot 200}{100 \\cdot 400 \\cdot 1}$$\n$$\\eta = \\frac{7000}{40000}$$\n$$\\eta = \\frac{7}{40}$$\n$$\\eta = 0.175$$\n问题要求将答案四舍五入至三位有效数字。计算出的值 $0.175$ 已经恰好是三位有效数字。作为一个无量纲分数，这就是最终的数值答案。",
            "answer": "$$\\boxed{0.175}$$"
        },
        {
            "introduction": "真实的CID过程并非单次碰撞的简单叠加，而是一个复杂的随机过程，离子在碰撞室中会经历多次碰撞。为了更精确地描述和预测CID的结果，我们需要从单次碰撞的视角，提升到对整个碰撞过程进行统计建模的层面。这个高级练习将引导你基于泊松过程和随机能量增量的基本物理假设，构建一个逐步多次碰撞模型。你将推导出离子离开碰撞室时内能分布的平均值和方差，这为你深入理解CID的统计物理本质提供了宝贵的量化工具。",
            "id": "3697144",
            "problem": "要求您在有机化合物的质谱鉴定背景下，实现一个基于物理学的、逐步多重碰撞模型的碰撞诱导解离（Collision Induced Dissociation, CID）模型。目标是从第一性原理出发，预测离子离开碰撞室时的内能的均值和方差。该模型必须从以下基本基础开始：\n\n- 理想气体数密度：对于压力为 $P$、温度为 $T$ 的背景气体，其数密度为 $n = \\dfrac{P}{k_{\\mathrm{B}} T}$，其中 $k_{\\mathrm{B}}$ 是 Boltzmann 常数。\n- 碰撞截面：单位长度内的离子-中性粒子碰撞率与乘积 $n \\sigma$ 成正比，其中 $\\sigma$ 是有效碰撞截面。\n- 稀有、独立碰撞：在示踪极限下（离子相对于气体是稀释的）且对于不相关的相遇，沿长度为 $L$ 的路径发生的碰撞可被建模为平均计数为 $\\lambda = n \\sigma L$ 的泊松过程（Poisson process）。\n- 每次碰撞的能量转移：对于给定的单次碰撞，随机的内能增量是一个独立同分布的随机变量，其均值为 $\\mu_{\\Delta}$，方差为 $\\sigma_{\\Delta}^2$（两者均以电子伏特为单位，其中 $\\sigma_{\\Delta}^2$ 的单位为平方电子伏特）。离子的初始内能为 $E_0$。\n\n基于这些基础，推导您的程序用于计算离子在压力为 $P$ 的条件下穿过长度为 $L$ 的碰撞室后其内能均值和方差的表达式。您的推导不得使用超出上述基本事实的任何捷径。\n\n您的程序必须：\n- 使用上述原理计算预期的碰撞次数，并传播内能增量的统计数据，以获得在碰撞室出口处的平均内能及其方差。\n- 将 $E_0$、$L$、$P$、$T$、$\\sigma$、$\\mu_{\\Delta}$ 和 $\\sigma_{\\Delta}^2$ 视为必需的参数。\n- 以电子伏特（eV）表示平均内能，以平方电子伏特（eV$^2$）表示方差。\n- 将所有数值输出四舍五入至六位小数。\n\n使用的物理单位和常数：\n- 压力 $P$ 单位为帕斯卡 (Pa)。\n- 长度 $L$ 单位为米 (m)。\n- 温度 $T$ 单位为开尔文 (K)。\n- 截面 $\\sigma$ 单位为平方米 (m$^2$)。\n- 能量单位为电子伏特 (eV)，方差单位为 eV$^2$。\n- 使用 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}$ J/K。\n\n本问题不涉及角度单位。如果出现任何概率或分数，必须表示为小数。\n\n测试集（每个元组为 $(E_0, L, P, T, \\sigma, \\mu_{\\Delta}, \\sigma_{\\Delta}^2)$）：\n- 案例A（常规CID条件）：$(0.20, 0.10, 0.50, 300, 1.50 \\times 10^{-18}, 0.050, 0.00250)$。\n- 案例B（无碰撞边界）：$(1.00, 0.10, 0.00, 300, 1.50 \\times 10^{-18}, 0.050, 0.00250)$。\n- 案例C（高压、长碰撞室）：$(0.10, 0.50, 5.00, 300, 2.00 \\times 10^{-18}, 0.020, 0.00040)$。\n- 案例D（净冷却、稀有碰撞）：$(2.00, 0.20, 1.00, 300, 1.00 \\times 10^{-21}, -0.00500, 0.00010)$。\n- 案例E（确定性单次碰撞增量）：$(1.00, 1.00, 1.00, 300, 1.00 \\times 10^{-20}, 0.10000, 0.00000)$。\n- 案例F（温度对数密度的影响）：$(0.50, 0.10, 1.00, 600, 1.50 \\times 10^{-18}, 0.03000, 0.00090)$。\n\n对于每个案例，计算：\n- 预测的出口处平均内能（eV）。\n- 预测的出口处内能方差（eV$^2$）。\n\n最终输出格式：\n- 您的程序应生成单行输出，该输出是一个包含六个内部列表的列表，每个测试案例对应一个内部列表，其中每个内部列表包含两个浮点数：$[\\text{均值}, \\text{方差}]$。\n- 该行必须是单个类似JSON的数组，不含额外注释，例如：\n  - $[[m_1,v_1],[m_2,v_2],\\ldots,[m_6,v_6]]$\n- 所有数字必须四舍五入到六位小数。",
            "solution": "问题陈述已经过严格验证，被认为是有效的。它具有科学依据，问题设定良好且客观。所提供的物理模型基于碰撞的泊松统计（Poisson statistics）和能量转移的统计性质，是化学物理学中用于模拟碰撞诱导解离（CID）的标准且恰当的简化模型。所有必需的参数、常数和条件均已提供，不存在内部矛盾或含糊之处。\n\n该问题要求推导离子穿过碰撞室后最终内能 $E_{final}$ 的均值和方差的表达式。让我们从所提供的基本原理出发，进行逐步推导。\n\n设 $E_0$ 为离子的初始内能，它是一个确定性常数。\n设 $N$ 为离子在穿过碰撞室时经历的碰撞次数。根据问题陈述，碰撞遵循泊松过程。因此，$N$ 是一个服从泊松分布的随机变量，其均值为 $\\lambda = n \\sigma L$。其概率质量函数为 $P(N=k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$，其中 $k=0, 1, 2, \\dots$。\n服从泊松分布的随机变量的均值和方差都等于其参数，因此：\n$$E[N] = \\lambda$$\n$$\\text{Var}(N) = \\lambda$$\n\n设 $\\Delta E_i$ 为第 $i$ 次碰撞期间的内能变化量。对于 $i = 1, 2, \\ldots, N$，这些是独立同分布（i.i.d.）的随机变量。问题陈述了它们的均值和方差为：\n$$E[\\Delta E_i] = \\mu_{\\Delta}$$\n$$\\text{Var}(\\Delta E_i) = \\sigma_{\\Delta}^2$$\n\n最终内能 $E_{final}$ 是初始能量与所有碰撞产生的能量增量之和：\n$$E_{final} = E_0 + \\sum_{i=1}^{N} \\Delta E_i$$\n这是一个加法和，其中项数 $N$ 本身就是一个随机变量。这种结构被称为复合随机变量或随机和。\n\n**1. 最终平均内能 $\\mu_{final}$ 的推导**\n\n我们旨在求出 $E_{final}$ 的期望值，记为 $\\mu_{final} = E[E_{final}]$。\n利用期望算子的线性性质：\n$$E[E_{final}] = E\\left[ E_0 + \\sum_{i=1}^{N} \\Delta E_i \\right] = E[E_0] + E\\left[ \\sum_{i=1}^{N} \\Delta E_i \\right]$$\n由于 $E_0$ 是一个常数，所以 $E[E_0] = E_0$。\n为了评估随机和的期望，我们使用全期望定律（也称为 Wald's identity for the first moment）：$E[X] = E[E[X|Y]]$。我们将随机变量设为以碰撞次数 $N$ 为条件的和。\n$$E\\left[ \\sum_{i=1}^{N} \\Delta E_i \\right] = E_N\\left[ E\\left[ \\sum_{i=1}^{N} \\Delta E_i \\;\\middle|\\; N=n_{coll} \\right] \\right]$$\n内部期望是固定碰撞次数 $n_{coll}$ 下的和的期望。由于 $\\Delta E_i$ 是独立同分布的，和的期望等于期望的和：\n$$E\\left[ \\sum_{i=1}^{n_{coll}} \\Delta E_i \\right] = \\sum_{i=1}^{n_{coll}} E[\\Delta E_i] = \\sum_{i=1}^{n_{coll}} \\mu_{\\Delta} = n_{coll} \\mu_{\\Delta}$$\n现在，我们将其代回，并对随机变量 $N$ 取期望：\n$$E_N[N \\mu_{\\Delta}] = \\mu_{\\Delta} E[N]$$\n我们知道 $E[N] = \\lambda$。因此：\n$$E\\left[ \\sum_{i=1}^{N} \\Delta E_i \\right] = \\lambda \\mu_{\\Delta}$$\n合并各项，最终平均能量为：\n$$\\mu_{final} = E_0 + \\lambda \\mu_{\\Delta}$$\n\n**2. 最终内能方差 $\\sigma^2_{final}$ 的推导**\n\n我们旨在求出 $E_{final}$ 的方差，记为 $\\sigma^2_{final} = \\text{Var}(E_{final})$。\n一个变量加上一个常数后的方差等于该变量本身的方差：\n$$\\text{Var}(E_{final}) = \\text{Var}\\left( E_0 + \\sum_{i=1}^{N} \\Delta E_i \\right) = \\text{Var}\\left( \\sum_{i=1}^{N} \\Delta E_i \\right)$$\n为了求出随机和的方差，我们使用全方差定律（也称为 Blackwell-Girshick equation 或 Eve's Law）：$\\text{Var}(X) = E[\\text{Var}(X|Y)] + \\text{Var}(E[X|Y])$。\n$$\\text{Var}\\left(\\sum_{i=1}^{N} \\Delta E_i\\right) = E_N\\left[ \\text{Var}\\left(\\sum_{i=1}^{N} \\Delta E_i \\;\\middle|\\; N=n_{coll}\\right) \\right] + \\text{Var}_N\\left(E\\left[\\sum_{i=1}^{N} \\Delta E_i \\;\\middle|\\; N=n_{coll}\\right]\\right)$$\n我们分别计算这两项。\n\n第一项：$E_N\\left[ \\text{Var}\\left(\\sum_{i=1}^{N} \\Delta E_i \\;\\middle|\\; N=n_{coll}\\right) \\right]$\n内部方差是 $n_{coll}$ 个独立同分布随机变量之和的方差。因为它们是独立的，所以和的方差等于方差的和：\n$$\\text{Var}\\left(\\sum_{i=1}^{n_{coll}} \\Delta E_i\\right) = \\sum_{i=1}^{n_{coll}} \\text{Var}(\\Delta E_i) = \\sum_{i=1}^{n_{coll}} \\sigma_{\\Delta}^2 = n_{coll} \\sigma_{\\Delta}^2$$\n对 $N$ 取期望：\n$$E_N[N \\sigma_{\\Delta}^2] = \\sigma_{\\Delta}^2 E[N] = \\lambda \\sigma_{\\Delta}^2$$\n\n第二项：$\\text{Var}_N\\left(E\\left[\\sum_{i=1}^{N} \\Delta E_i \\;\\middle|\\; N=n_{coll}\\right]\\right)$\n内部条件期望已经求得为 $n_{coll} \\mu_{\\Delta}$。现在我们求这个量关于 $N$ 的方差：\n$$\\text{Var}_N(N \\mu_{\\Delta}) = \\mu_{\\Delta}^2 \\text{Var}(N)$$\n由于 $N$ 服从泊松分布，所以 $\\text{Var}(N) = \\lambda$。\n$$\\text{Var}_N(N \\mu_{\\Delta}) = \\mu_{\\Delta}^2 \\lambda$$\n\n合并这两项，最终能量的方差为：\n$$\\sigma^2_{final} = \\lambda \\sigma_{\\Delta}^2 + \\lambda \\mu_{\\Delta}^2 = \\lambda (\\mu_{\\Delta}^2 + \\sigma_{\\Delta}^2)$$\n\n**3. 最终算法表达式**\n\n推导出的表达式依赖于平均碰撞次数 $\\lambda$。我们必须用给定的物理参数 $P$、$L$、$T$ 和 $\\sigma$ 来表示 $\\lambda$。\n平均碰撞次数由 $\\lambda = n \\sigma L$ 给出。\n理想背景气体的数密度为 $n = \\frac{P}{k_{\\mathrm{B}} T}$。\n将 $n$ 代入 $\\lambda$ 的表达式中：\n$$\\lambda = \\frac{P \\sigma L}{k_{\\mathrm{B}} T}$$\n\n因此，要在程序中实现的最终表达式为：\n平均最终能量：\n$$\\mu_{final} = E_0 + \\left(\\frac{P \\sigma L}{k_{\\mathrm{B}} T}\\right) \\mu_{\\Delta}$$\n最终能量的方差：\n$$\\sigma^2_{final} = \\left(\\frac{P \\sigma L}{k_{\\mathrm{B}} T}\\right)(\\mu_{\\Delta}^2 + \\sigma_{\\Delta}^2)$$\n这些方程提供了基于问题陈述中概述的原理的完整解析解。程序将对提供的测试案例实施这些公式，并使用常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\, \\text{J/K}$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the mean and variance of an ion's internal energy after\n    traversing a collision cell, based on a stepwise multiple-collision model.\n    \"\"\"\n\n    # Boltzmann constant in J/K.\n    K_B = 1.380649e-23\n\n    # Test suite: (E0, L, P, T, sigma, mu_delta, sigma_delta_sq)\n    # Units: E0 (eV), L (m), P (Pa), T (K), sigma (m^2),\n    #        mu_delta (eV), sigma_delta_sq (eV^2)\n    test_cases = [\n        (0.20, 0.10, 0.50, 300, 1.50e-18, 0.050, 0.00250), # Case A\n        (1.00, 0.10, 0.00, 300, 1.50e-18, 0.050, 0.00250), # Case B\n        (0.10, 0.50, 5.00, 300, 2.00e-18, 0.020, 0.00040), # Case C\n        (2.00, 0.20, 1.00, 300, 1.00e-21, -0.00500, 0.00010), # Case D\n        (1.00, 1.00, 1.00, 300, 1.00e-20, 0.10000, 0.00000), # Case E\n        (0.50, 0.10, 1.00, 600, 1.50e-18, 0.03000, 0.00090), # Case F\n    ]\n\n    results_as_strings = []\n\n    for case in test_cases:\n        E0, L, P, T, sigma, mu_delta, sigma_delta_sq = case\n\n        # The term k_B * T in the denominator can be non-zero as T  0.\n        # If P = 0, there is no gas, so the number of collisions is zero.\n        if P == 0.0:\n            lambda_collisions = 0.0\n        else:\n            # Calculate the mean number of collisions (lambda)\n            # lambda = n * sigma * L = (P / (k_B * T)) * sigma * L\n            lambda_collisions = (P * sigma * L) / (K_B * T)\n\n        # Calculate the mean final internal energy\n        # mu_final = E0 + lambda * mu_delta\n        mean_final_energy = E0 + lambda_collisions * mu_delta\n\n        # Calculate the variance of the final internal energy\n        # sigma_sq_final = lambda * (mu_delta^2 + sigma_delta^2)\n        variance_final_energy = lambda_collisions * (mu_delta**2 + sigma_delta_sq)\n\n        # Format the results for the final output string.\n        # This ensures the output format is exactly `[m,v]` with no spaces\n        # and with numbers rounded to 6 decimal places.\n        results_as_strings.append(f\"[{mean_final_energy:.6f},{variance_final_energy:.6f}]\")\n\n    # Construct the final JSON-like output string.\n    final_output = f\"[{','.join(results_as_strings)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}