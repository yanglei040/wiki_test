{
    "hands_on_practices": [
        {
            "introduction": "To truly master an advanced NMR technique like INADEQUATE, it's essential to understand its operation from first principles. This practice guides you through a simulation of the experiment using the density matrix formalism, the bedrock of modern NMR theory . By applying unitary transformations for pulses and free evolution, you will trace the state of a two-spin system through the entire pulse sequence, providing a concrete view of how double-quantum coherence is created and detected.",
            "id": "3707870",
            "problem": "You are asked to verify the feasibility of the Incredible Natural Abundance Double Quantum Transfer Experiment (INADEQUATE) for direct carbon-13 to carbon-13 correlation using a first-principles simulation based on the density matrix formalism of Nuclear Magnetic Resonance (NMR). Implement a program that simulates a two-spin system representing two spin-$\\tfrac{1}{2}$ carbon-$13$ nuclei, with scalar coupling and chemical shift offsets, and evaluates the observable signal produced by a simplified INADEQUATE pulse sequence. The simulation must be carried out using unitary evolution of the density matrix under a time-independent Hamiltonian and nonselective radiofrequency pulses applied as rotations.\n\nBegin from the following fundamental base:\n\n- The Liouville–von Neumann equation for a closed quantum system dictates that the density operator $\\rho$ evolves under unitary propagators as $\\rho(t) = U(t)\\,\\rho(0)\\,U(t)^\\dagger$, where $U(t)$ is generated by the Hamiltonian $H$ via $U(t) = \\exp\\!\\left(-i\\,H\\,t\\right)$.\n- For two spin-$\\tfrac{1}{2}$ nuclei, the Cartesian spin angular momentum operators are $I_x = \\tfrac{1}{2}\\sigma_x$, $I_y = \\tfrac{1}{2}\\sigma_y$, $I_z = \\tfrac{1}{2}\\sigma_z$, where $\\sigma_x$, $\\sigma_y$, and $\\sigma_z$ are Pauli matrices. Two-spin operators are formed as Kronecker products, e.g., $I_x^{(1)} \\otimes \\mathbb{1}^{(2)}$ and $\\mathbb{1}^{(1)} \\otimes I_x^{(2)}$, which will be abbreviated as $I_x^{(1)}$ and $I_x^{(2)}$ respectively when unambiguous.\n- Under the weak coupling and high-field approximations, the internal Hamiltonian in angular frequency units for two spins is $H = 2\\pi\\left(\\omega_1 I_z^{(1)} + \\omega_2 I_z^{(2)} + J\\, I_z^{(1)} I_z^{(2)}\\right)$, where $\\omega_1$ and $\\omega_2$ are the resonance offsets in hertz, and $J$ is the scalar coupling in hertz. The identity operator is implicitly included via tensor products when needed.\n- A nonselective radiofrequency pulse about the $x$-axis by angle $\\theta$ is represented by the unitary operator $U_x(\\theta) = \\exp\\!\\left(-i\\,\\theta\\,\\left(I_x^{(1)} + I_x^{(2)}\\right)\\right)$. Angles must be specified in radians.\n\nConsider the following simplified INADEQUATE pulse sequence designed to create and reconvert double quantum (DQ) coherence:\n\n1. Initialize the density operator as $\\rho_0 = I_z^{(1)} + I_z^{(2)}$.\n2. Apply a nonselective $90^\\circ$ pulse about $x$: $\\rho_1 = U_x(\\pi/2)\\,\\rho_0\\,U_x(\\pi/2)^\\dagger$.\n3. Free evolution under $H$ for a delay $\\tau$: $\\rho_2 = U(\\tau)\\,\\rho_1\\,U(\\tau)^\\dagger$, with $U(\\tau) = \\exp\\!\\left(-i\\,H\\,\\tau\\right)$.\n4. Apply a second nonselective $90^\\circ$ pulse about $x$: $\\rho_3 = U_x(\\pi/2)\\,\\rho_2\\,U_x(\\pi/2)^\\dagger$.\n5. Free evolution under $H$ for an indirect evolution time $t_1$: $\\rho_4 = U(t_1)\\,\\rho_3\\,U(t_1)^\\dagger$.\n6. Apply a third nonselective $90^\\circ$ pulse about $x$ to reconvert coherence: $\\rho_5 = U_x(\\pi/2)\\,\\rho_4\\,U_x(\\pi/2)^\\dagger$.\n\nAt the point of detection, define the transverse detection operator as $A = I_x^{(1)} + I_x^{(2)}$. Compute the dimensionless, normalized observable signal amplitude $S$ at acquisition time $t_2 = 0$ via the Hilbert–Schmidt inner product:\n$$\nS = \\mathrm{Re}\\left(\\frac{\\mathrm{Tr}\\!\\left(A\\,\\rho_5\\right)}{\\sqrt{\\mathrm{Tr}\\!\\left(A^2\\right)\\,\\mathrm{Tr}\\!\\left(\\rho_5^2\\right)}}\\right).\n$$\nThis normalization ensures that $S \\in [-1,1]$.\n\nPhysical units and conventions:\n- Frequencies $\\omega_1$, $\\omega_2$, and $J$ must be provided in hertz.\n- Evolution delays $\\tau$ and $t_1$ must be provided in seconds.\n- Pulse flip angles must be in radians.\n- The final result $S$ must be dimensionless.\n\nImplement the above simulation and compute $S$ for each of the following test cases, which together form the test suite:\n\n- Case 1 (general happy path): $(\\omega_1, \\omega_2, J, \\tau, t_1) = (100, 120, 50, 0.01, 0.004)$.\n- Case 2 (no coupling boundary): $(\\omega_1, \\omega_2, J, \\tau, t_1) = (100, 120, 0, 0.01, 0.004)$.\n- Case 3 (no evolution boundary): $(\\omega_1, \\omega_2, J, \\tau, t_1) = (100, 120, 50, 0.0, 0.004)$.\n- Case 4 (large offset edge case): $(\\omega_1, \\omega_2, J, \\tau, t_1) = (500, 1000, 35, 1/(2\\cdot 35), 0.003)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[$s_1$,$s_2$,$s_3$,$s_4$]\"), where each $s_k$ is the computed float value of $S$ for the corresponding test case.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of Nuclear Magnetic Resonance (NMR) spectroscopy, well-posed with all necessary information provided, and objective in its language. The task is to simulate a simplified Incredible Natural Abundance Double Quantum Transfer Experiment (INADEQUATE) for a two-spin system using the density matrix formalism.\n\nThe solution is developed by first constructing the mathematical operators representing the spin system and its interactions, and then simulating the evolution of the system's density matrix through the specified pulse sequence.\n\n**1. Mathematical Framework for a Two-Spin-1/2 System**\n\nThe system consists of two spin-$\\frac{1}{2}$ nuclei. The quantum state of such a system is described within a Hilbert space of dimension $2 \\times 2 = 4$, which is the tensor product of the individual spin spaces: $\\mathbb{C}^2 \\otimes \\mathbb{C}^2$. All operators are represented as $4 \\times 4$ complex matrices.\n\nThe fundamental single-spin operators are defined using the Pauli matrices:\n$$\n\\sigma_x = \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}, \\quad\n\\sigma_y = \\begin{pmatrix} 0 & -i \\\\ i & 0 \\end{pmatrix}, \\quad\n\\sigma_z = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\end{pmatrix}, \\quad\n\\mathbb{1}_2 = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\nThe Cartesian spin angular momentum operators are given by $I_k = \\frac{1}{2}\\sigma_k$ for $k \\in \\{x, y, z\\}$.\n\nFor the two-spin system, operators for spin $1$ are formed by the Kronecker product $I_k^{(1)} = I_k \\otimes \\mathbb{1}_2$, and for spin $2$ by $I_k^{(2)} = \\mathbb{1}_2 \\otimes I_k$. For example:\n$$\nI_x^{(1)} = \\frac{1}{2} \\sigma_x \\otimes \\mathbb{1}_2 = \\frac{1}{2} \\begin{pmatrix} 0 & 0 & 1 & 0 \\\\ 0 & 0 & 0 & 1 \\\\ 1 & 0 & 0 & 0 \\\\ 0 & 1 & 0 & 0 \\end{pmatrix}, \\quad\nI_z^{(2)} = \\mathbb{1}_2 \\otimes \\frac{1}{2} \\sigma_z = \\frac{1}{2} \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & -1 & 0 & 0 \\\\ 0 & 0 & 1 & 0 \\\\ 0 & 0 & 0 & -1 \\end{pmatrix}\n$$\nTwo-spin interaction terms are formed by products of these operators, for instance, $I_z^{(1)}I_z^{(2)} = (I_z \\otimes \\mathbb{1}_2)(\\mathbb{1}_2 \\otimes I_z) = I_z \\otimes I_z$.\n\n**2. Hamiltonian and Propagators**\n\nThe internal Hamiltonian $H$, governing the free evolution of the spin system in the rotating frame, is given in angular frequency units as:\n$$\nH = 2\\pi \\left(\\omega_1 I_z^{(1)} + \\omega_2 I_z^{(2)} + J\\, I_z^{(1)} I_z^{(2)}\\right)\n$$\nwhere $\\omega_1$ and $\\omega_2$ are the chemical shift offsets in hertz, and $J$ is the scalar coupling constant in hertz. The factor of $2\\pi$ converts frequencies from Hz to rad/s.\n\nThe evolution of the density matrix $\\rho$ over a time interval $t$ is described by the Liouville-von Neumann equation, whose solution for a time-independent Hamiltonian is a unitary transformation:\n$$\n\\rho(t) = U(t) \\, \\rho(0) \\, U(t)^\\dagger\n$$\nwhere the propagator $U(t)$ is the matrix exponential of the Hamiltonian:\n$$\nU(t) = \\exp(-i H t)\n$$\nRadiofrequency (RF) pulses are also unitary transformations. A nonselective pulse of angle $\\theta$ about the $x$-axis is represented by the operator:\n$$\nU_x(\\theta) = \\exp\\left(-i \\theta \\left(I_x^{(1)} + I_x^{(2)}\\right)\\right)\n$$\n\n**3. Simulation of the INADEQUATE Pulse Sequence**\n\nThe simulation proceeds step-by-step, applying the appropriate propagator at each stage to the density matrix.\n\n1.  **Initial State**: The system starts from thermal equilibrium, which, in the high-temperature approximation, is proportional to the net longitudinal magnetization.\n    $$\n    \\rho_0 = I_z^{(1)} + I_z^{(2)}\n    $$\n\n2.  **First Pulse**: A nonselective $90^\\circ$ ($\\pi/2$ radians) pulse is applied about the $x$-axis.\n    $$\n    \\rho_1 = U_x(\\pi/2) \\, \\rho_0 \\, U_x(\\pi/2)^\\dagger\n    $$\n\n3.  **First Evolution Period**: The system evolves freely under the Hamiltonian $H$ for a duration $\\tau$.\n    $$\n    \\rho_2 = U(\\tau) \\, \\rho_1 \\, U(\\tau)^\\dagger, \\quad \\text{where } U(\\tau) = \\exp(-iH\\tau)\n    $$\n\n4.  **Second Pulse**: Another nonselective $90^\\circ$ pulse is applied about the $x$-axis. This step is crucial for converting antiphase coherence into double-quantum coherence.\n    $$\n    \\rho_3 = U_x(\\pi/2) \\, \\rho_2 \\, U_x(\\pi/2)^\\dagger\n    $$\n\n5.  **Second Evolution Period**: The system evolves for the indirect evolution time $t_1$. Double-quantum coherence evolves with the sum of the chemical shifts, $(\\omega_1 + \\omega_2)$.\n    $$\n    \\rho_4 = U(t_1) \\, \\rho_3 \\, U(t_1)^\\dagger, \\quad \\text{where } U(t_1) = \\exp(-iHt_1)\n    $$\n\n6.  **Third Pulse**: A final $90^\\circ$ pulse about the $x$-axis converts the double-quantum coherence back into observable single-quantum coherence.\n    $$\n    \\rho_5 = U_x(\\pi/2) \\, \\rho_4 \\, U_x(\\pi/2)^\\dagger\n    $$\n\n**4. Calculation of the Observable Signal**\n\nThe observable signal $S$ at the beginning of acquisition ($t_2=0$) is the expectation value of the transverse detection operator, $A = I_x^{(1)} + I_x^{(2)}$, projected onto the final state of the density matrix, $\\rho_5$. The problem defines a specific normalization for this signal:\n$$\nS = \\mathrm{Re}\\left(\\frac{\\mathrm{Tr}(A\\,\\rho_5)}{\\sqrt{\\mathrm{Tr}(A^2)\\,\\mathrm{Tr}(\\rho_5^2)}}\\right)\n$$\nThe trace operation $\\mathrm{Tr}(X)$ computes the sum of the diagonal elements of a matrix $X$. The term $\\mathrm{Tr}(A\\rho_5)$ is the Hilbert-Schmidt inner product of the two operators.\n\nThe normalization factor in the denominator can be simplified. First, consider $\\mathrm{Tr}(A^2)$:\n$$\n\\mathrm{Tr}(A^2) = \\mathrm{Tr}\\left((I_x^{(1)} + I_x^{(2)})^2\\right) = \\mathrm{Tr}((I_x^{(1)})^2) + \\mathrm{Tr}((I_x^{(2)})^2) + 2\\mathrm{Tr}(I_x^{(1)}I_x^{(2)})\n$$\nFor any spin-$\\frac{1}{2}$ operator $I_k$, $(I_k)^2 = \\frac{1}{4}\\mathbb{1}_2$. Thus, $\\mathrm{Tr}((I_k^{(1)})^2) = \\mathrm{Tr}(\\frac{1}{4}\\mathbb{1}_4) = 1$. Similarly, $\\mathrm{Tr}((I_k^{(2)})^2) = 1$. Also, $\\mathrm{Tr}(I_x^{(1)}I_x^{(2)}) = \\mathrm{Tr}(I_x \\otimes I_x) = \\mathrm{Tr}(I_x)\\mathrm{Tr}(I_x) = 0 \\cdot 0 = 0$.\nTherefore, $\\mathrm{Tr}(A^2) = 1 + 1 + 0 = 2$.\n\nNext, consider $\\mathrm{Tr}(\\rho_5^2)$. Since all transformations in the pulse sequence are unitary, the trace of the squared density matrix is a conserved quantity: $\\mathrm{Tr}(\\rho_k^2) = \\mathrm{Tr}(\\rho_0^2)$ for all $k$.\n$$\n\\mathrm{Tr}(\\rho_0^2) = \\mathrm{Tr}\\left((I_z^{(1)} + I_z^{(2)})^2\\right) = \\mathrm{Tr}((I_z^{(1)})^2) + \\mathrm{Tr}((I_z^{(2)})^2) + 2\\mathrm{Tr}(I_z^{(1)}I_z^{(2)}) = 1 + 1 + 0 = 2\n$$\nThus, the normalization constant is $\\sqrt{\\mathrm{Tr}(A^2)\\mathrm{Tr}(\\rho_5^2)} = \\sqrt{2 \\cdot 2} = 2$.\n\nThe final expression for the observable signal simplifies to:\n$$\nS = \\frac{1}{2} \\mathrm{Re}\\left(\\mathrm{Tr}\\left(A\\,\\rho_5\\right)\\right)\n$$\nThe computational implementation will construct the necessary matrices and propagators, execute the sequence of matrix multiplications to find $\\rho_5$, and then compute $S$ using this simplified formula for each of the provided test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Simulates a simplified INADEQUATE NMR experiment for a two-spin-1/2 system.\n    The simulation uses the density matrix formalism and computes the final observable signal.\n    \"\"\"\n    \n    # Define test cases as tuples: (w1, w2, J, tau, t1)\n    # w1, w2, J are in Hz; tau, t1 are in seconds.\n    test_cases = [\n        (100.0, 120.0, 50.0, 0.01, 0.004),\n        (100.0, 120.0, 0.0, 0.01, 0.004),\n        (100.0, 120.0, 50.0, 0.0, 0.004),\n        (500.0, 1000.0, 35.0, 1.0 / (2.0 * 35.0), 0.003),\n    ]\n\n    results = []\n\n    # Define base spin-1/2 operators (Pauli matrices / 2) and identity\n    I2 = np.identity(2, dtype=complex)\n    Sx = 0.5 * np.array([[0, 1], [1, 0]], dtype=complex)\n    Sy = 0.5 * np.array([[0, -1j], [1j, 0]], dtype=complex)\n    Sz = 0.5 * np.array([[1, 0], [0, -1]], dtype=complex)\n\n    # Construct two-spin operators using the Kronecker product\n    # Spin 1 operators\n    Ix1 = np.kron(Sx, I2)\n    Iy1 = np.kron(Sy, I2)\n    Iz1 = np.kron(Sz, I2)\n    \n    # Spin 2 operators\n    Ix2 = np.kron(I2, Sx)\n    Iy2 = np.kron(I2, Sy)\n    Iz2 = np.kron(I2, Sz)\n    \n    # Two-spin interaction term\n    Iz1z2 = np.kron(Sz, Sz)\n\n    # Total operators for pulses and detection\n    Ix_tot = Ix1 + Ix2\n    Iz_tot = Iz1 + Iz2\n\n    # Initial density operator rho_0 = Iz_tot\n    rho_0 = Iz_tot\n    \n    # Detection operator A = Ix_tot\n    A = Ix_tot\n    \n    # Pre-calculate the propagator for a 90-degree pulse about x\n    theta_90 = np.pi / 2.0\n    Ux_90 = expm(-1j * theta_90 * Ix_tot)\n    Ux_90_dag = Ux_90.conj().T\n\n    for case in test_cases:\n        w1, w2, J, tau, t1 = case\n\n        # 1. Construct the Hamiltonian for the current case (in rad/s)\n        H = 2.0 * np.pi * (w1 * Iz1 + w2 * Iz2 + J * Iz1z2)\n\n        # 2. Simulate the pulse sequence\n        # rho_0 is the initial state\n        \n        # Step 1: 90-degree pulse about x\n        rho_1 = Ux_90 @ rho_0 @ Ux_90_dag\n        \n        # Step 2: Free evolution for time tau\n        U_tau = expm(-1j * H * tau)\n        U_tau_dag = U_tau.conj().T\n        rho_2 = U_tau @ rho_1 @ U_tau_dag\n        \n        # Step 3: Second 90-degree pulse about x\n        rho_3 = Ux_90 @ rho_2 @ Ux_90_dag\n        \n        # Step 4: Free evolution for time t1\n        U_t1 = expm(-1j * H * t1)\n        U_t1_dag = U_t1.conj().T\n        rho_4 = U_t1 @ rho_3 @ U_t1_dag\n        \n        # Step 5: Third 90-degree pulse about x (reconversion)\n        rho_5 = Ux_90 @ rho_4 @ Ux_90_dag\n        \n        # 3. Calculate the observable signal S\n        # S = Re( Tr(A * rho_5) / sqrt(Tr(A*A) * Tr(rho_5*rho_5)) )\n        # As derived, the denominator sqrt(Tr(A^2) * Tr(rho_0^2)) is sqrt(2*2) = 2.\n        \n        numerator = np.trace(A @ rho_5)\n        # Denominator is constant, but can be calculated for verification:\n        # tr_A2 = np.trace(A @ A)\n        # tr_rho5_2 = np.trace(rho_5 @ rho_5) # Should be equal to Tr(rho_0^2)\n        # denominator = np.sqrt(tr_A2 * tr_rho5_2)\n        denominator = 2.0\n        \n        S = np.real(numerator / denominator)\n        results.append(S)\n\n    # Format the final output as specified\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The theoretical efficiency of the INADEQUATE experiment is highly dependent on the choice of the evolution delay $\\tau$ relative to the carbon-carbon scalar coupling constant $J$. This practice provides a quantitative exercise in experimental optimization . You will apply the principles of coherence transfer to select a delay $\\tau$ that maximizes the signal for a desired one-bond correlation while simultaneously suppressing potential artifacts from weaker, long-range couplings.",
            "id": "3707882",
            "problem": "A homonuclear two-spin system of adjacent carbons, $\\mathrm{C}_1$ and $\\mathrm{C}_2$, in a small organic molecule is probed by the Incredible Natural Abundance Double Quantum Transfer Experiment (INADEQUATE) to establish carbon–carbon connectivities at natural abundance. In an idealized setting, consider only a single isolated $\\mathrm{C}_1$–$\\mathrm{C}_2$ pair evolving under the isotropic scalar coupling Hamiltonian $H_{J} = 2\\pi J\\,\\mathbf{I}_1\\cdot \\mathbf{I}_2$ during two identical evolution delays of duration $\\tau$ used to generate and reconvert double-quantum coherence. Assume high-field conditions such that chemical shift evolution is refocused by the pulsed sequence and can be neglected during each $\\tau$ period for the purpose of analyzing the scalar-coupling-mediated coherence transfer. Use the standard product-operator formalism and properties of the scalar coupling Hamiltonian to:\n\n1. Derive the functional dependence of the net transfer amplitude for the observable single-quantum coherence (after reconversion from double-quantum coherence) on the scalar coupling $J$ and the delay $\\tau$, starting from in-phase transverse magnetization and considering that each $\\tau$ period effects evolution under $H_{J}$.\n\n2. Consider two coupling pathways observed in the same experiment: a one-bond carbon–carbon coupling with $J_{1} = 45.0\\ \\mathrm{Hz}$ and a two-bond carbon–carbon coupling with $J_{2} = 5.0\\ \\mathrm{Hz}$. Choose $\\tau$ to maximize the one-bond transfer amplitude while ensuring that the two-bond transfer amplitude is suppressed such that its intensity (proportional to the square of the amplitude) does not exceed $0.04$. Among all positive $\\tau$ satisfying both requirements, determine the smallest such $\\tau$.\n\nReport the value of $\\tau$ in milliseconds and round your answer to four significant figures.",
            "solution": "The problem is evaluated as valid, as it is scientifically grounded in the principles of Nuclear Magnetic Resonance (NMR) spectroscopy, specifically the INADEQUATE experiment. The parameters given are physically realistic, and the problem is well-posed, leading to a unique solution.\n\n### Part 1: Derivation of the Net Transfer Amplitude\n\nThe INADEQUATE experiment establishes carbon-carbon connectivities by creating and detecting double-quantum coherence (DQC) between a pair of coupled $^{13}\\text{C}$ nuclei. The process involves two critical evolution periods, each of duration $\\tau$, governed by the scalar coupling Hamiltonian, $H_J$.\n\nThe problem states that the evolution during these delays is solely under the isotropic scalar coupling Hamiltonian, $H_{J} = 2\\pi J\\,\\mathbf{I}_1\\cdot \\mathbf{I}_2$. Under high-field conditions, this Hamiltonian is well-approximated by its secular component, $H_{J} \\approx 2\\pi J I_{1z}I_{2z}$. This simplification is justified as the non-secular terms do not mediate the required coherence transfers between in-phase and anti-phase coherences.\n\nThe overall transfer from initial equilibrium magnetization to a final observable signal can be broken down into steps. A simplified, yet conceptually correct, pathway is:\n1.  **Preparation**: A pulse sequence generates in-phase transverse magnetization, e.g., $I_{1x} + I_{2x}$.\n2.  **DQC Generation (First $\\tau$ period)**: The in-phase magnetization evolves under $H_J$ for a duration $\\tau$. This process converts in-phase coherence into anti-phase coherence. For instance, the evolution of an initial term $I_{1x}$ is given by:\n    $$I_{1x} \\xrightarrow{H_J, \\tau} I_{1x}\\cos(\\pi J \\tau) + 2I_{1y}I_{2z}\\sin(\\pi J \\tau)$$\n    The amplitude of the generated anti-phase term, $2I_{1y}I_{2z}$, is thus proportional to $\\sin(\\pi J \\tau)$. A subsequent pulse converts this anti-phase coherence into DQC. The amount of DQC created is therefore proportional to $\\sin(\\pi J \\tau)$.\n3.  **DQC Reconversion (Second $\\tau$ period)**: After some time, the DQC is converted back into anti-phase coherence by another pulse. This anti-phase coherence then evolves under $H_J$ for a second identical period $\\tau$. This evolution converts the anti-phase coherence into observable in-phase magnetization. The efficiency of this second conversion step is also proportional to $\\sin(\\pi J \\tau)$. For example:\n    $$2I_{1y}I_{2z} \\xrightarrow{H_J, \\tau} 2I_{1y}I_{2z}\\cos(\\pi J \\tau) - I_{1x}\\sin(\\pi J \\tau)$$\n    The amplitude of the observable in-phase term, $I_{1x}$, is proportional to $\\sin(\\pi J \\tau)$.\n\nThe net transfer amplitude, which we denote as $A(J, \\tau)$, for the entire process (in-phase $\\rightarrow$ DQC $\\rightarrow$ in-phase) is the product of the efficiencies of the generation and reconversion steps. Since both delays have the same duration $\\tau$, the functional dependence is:\n$$A(J, \\tau) \\propto \\sin(\\pi J \\tau) \\times \\sin(\\pi J \\tau) = \\sin^2(\\pi J \\tau)$$\nFor the purpose of this problem, we can define the normalized amplitude as $A(J, \\tau) = \\sin^2(\\pi J \\tau)$.\n\n### Part 2: Optimization of $\\tau$\n\nWe are given two coupling pathways:\n- One-bond coupling: $J_{1} = 45.0\\ \\mathrm{Hz}$\n- Two-bond coupling: $J_{2} = 5.0\\ \\mathrm{Hz}$\n\nThe transfer amplitudes for these two pathways are:\n- $A_1(\\tau) = \\sin^2(\\pi J_1 \\tau) = \\sin^2(45.0 \\pi \\tau)$\n- $A_2(\\tau) = \\sin^2(\\pi J_2 \\tau) = \\sin^2(5.0 \\pi \\tau)$\n\nWe are tasked to find the smallest positive delay $\\tau$ that satisfies two conditions:\n1.  The one-bond transfer amplitude $A_1(\\tau)$ is maximized.\n2.  The intensity of the two-bond transfer does not exceed $0.04$.\n\n**Condition 1: Maximizing $A_1(\\tau)$**\nThe function $A_1(\\tau) = \\sin^2(45.0 \\pi \\tau)$ reaches its maximum value of $1$ when:\n$$\\sin(45.0 \\pi \\tau) = \\pm 1$$\nThis occurs when the argument of the sine function is an odd multiple of $\\frac{\\pi}{2}$:\n$$45.0 \\pi \\tau = \\frac{(2k+1)\\pi}{2} = (k + \\frac{1}{2})\\pi, \\quad \\text{for } k \\in \\{0, 1, 2, \\dots\\}$$\nSolving for $\\tau$, we get a set of candidate values that maximize the one-bond transfer:\n$$\\tau_k = \\frac{k + 0.5}{45.0}$$\nWe seek the smallest positive $\\tau$, so we will test non-negative integer values of $k$ starting from $k=0$.\n\n**Condition 2: Suppressing the Two-Bond Transfer**\nThe problem states that the intensity is proportional to the square of the amplitude. Let the intensity be $I(\\tau)$. Then $I(\\tau) \\propto [A(\\tau)]^2$. For the two-bond coupling, this means $I_2(\\tau) \\propto [A_2(\\tau)]^2 = [\\sin^2(5.0 \\pi \\tau)]^2 = \\sin^4(5.0 \\pi \\tau)$.\nThe maximum possible intensity corresponds to the case where the amplitude $A_2(\\tau)$ is maximal, i.e., $A_2(\\tau)=1$. We can thus normalize the intensity such that the maximum intensity is $1$. The constraint is then:\n$$I_2(\\tau) = \\sin^4(5.0 \\pi \\tau) \\le 0.04$$\nTaking the square root of both sides, we get:\n$$\\sin^2(5.0 \\pi \\tau) \\le \\sqrt{0.04}$$\n$$\\sin^2(5.0 \\pi \\tau) \\le 0.2$$\n\n**Finding the Optimal $\\tau$**\nWe must find the smallest $\\tau_k = \\frac{k+0.5}{45.0}$ (for $k=0, 1, 2, \\dots$) that satisfies the inequality $\\sin^2(5.0 \\pi \\tau_k) \\le 0.2$. Let's test values of $k$ sequentially.\n\nFor $k=0$:\n$$\\tau_0 = \\frac{0 + 0.5}{45.0} = \\frac{0.5}{45.0} = \\frac{1}{90.0}\\ \\mathrm{s}$$\nNow we check if this value of $\\tau$ satisfies Condition 2:\n$$ \\sin^2(5.0 \\pi \\tau_0) = \\sin^2\\left(5.0 \\pi \\times \\frac{1}{90.0}\\right) = \\sin^2\\left(\\frac{5.0 \\pi}{90.0}\\right) = \\sin^2\\left(\\frac{\\pi}{18}\\right) $$\nThe angle $\\frac{\\pi}{18}$ radians is equal to $10^{\\circ}$.\n$$ \\sin^2\\left(\\frac{\\pi}{18}\\right) \\approx (0.1736)^2 \\approx 0.03015 $$\nWe compare this value to the constraint:\n$$ 0.03015 \\le 0.2 $$\nThe condition is satisfied. Since we started with the smallest possible non-negative integer $k=0$ to find the smallest positive $\\tau$ that maximizes $A_1$, this value $\\tau_0 = \\frac{1}{90.0}\\ \\mathrm{s}$ is the desired solution.\n\nLet's check $k=1$ for completeness:\n$$\\tau_1 = \\frac{1 + 0.5}{45.0} = \\frac{1.5}{45.0} = \\frac{1}{30.0}\\ \\mathrm{s}$$\nChecking Condition 2:\n$$ \\sin^2(5.0 \\pi \\tau_1) = \\sin^2\\left(5.0 \\pi \\times \\frac{1}{30.0}\\right) = \\sin^2\\left(\\frac{5.0 \\pi}{30.0}\\right) = \\sin^2\\left(\\frac{\\pi}{6}\\right) = (0.5)^2 = 0.25 $$\nSince $0.25 > 0.2$, this value is not allowed.\n\nThus, the smallest positive $\\tau$ satisfying both requirements is $\\tau = \\frac{1}{90.0}\\ \\mathrm{s}$.\n\nFinally, we convert this value to milliseconds and round to four significant figures:\n$$ \\tau = \\frac{1}{90.0}\\ \\mathrm{s} = \\frac{1000}{90.0}\\ \\mathrm{ms} \\approx 11.111\\dots\\ \\mathrm{ms} $$\nRounding to four significant figures, we get $11.11\\ \\mathrm{ms}$.",
            "answer": "$$\\boxed{11.11}$$"
        },
        {
            "introduction": "The final step in any spectroscopic analysis is interpreting the data to elucidate a chemical structure. For the INADEQUATE experiment, this means translating a list of spectral peaks into a carbon-carbon connectivity graph . This computational exercise challenges you to develop an algorithm that automates this process by assigning observed cross-peaks to specific pairs of carbon atoms based on the unique frequency relationships inherent to the experiment. This practice directly simulates the logic used in modern NMR software to build molecular structures from spectral data.",
            "id": "3707887",
            "problem": "Consider a set of Carbon-13 nuclear magnetic resonance chemical shifts and cross-peaks recorded by the Incredible Natural Abundance Double Quantum Transfer Experiment (INADEQUATE). In the INADEQUATE experiment, a two-spin system composed of two directly bonded Carbon-13 nuclei with Larmor angular frequencies $\\omega_i$ and $\\omega_j$ evolves under the scalar coupling Hamiltonian such that a double-quantum coherence accumulates phase proportional to $(\\omega_i + \\omega_j) t$. Consequently, cross-peaks are observed at coordinates whose indirect dimension corresponds to the sum of the single-quantum frequencies and whose direct dimension corresponds to one of the single-quantum frequencies. Translating this into chemical shift language (in parts-per-million, $\\mathrm{ppm}$), an observed cross-peak with coordinates $(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$ is consistent with a directly bonded pair $(i, j)$ if the following hold within specified tolerances: the double-quantum dimension approximately equals the sum $\\delta_i + \\delta_j$ and the single-quantum dimension approximately equals either $\\delta_i$ or $\\delta_j$.\n\nLet there be $n$ distinct Carbon-13 sites with chemical shifts $\\Delta = [\\delta_1, \\delta_2, \\ldots, \\delta_n]$ (in $\\mathrm{ppm}$), and a set of $m$ observed INADEQUATE cross-peaks $P = \\{(\\delta_{\\mathrm{DQ}}^{(k)}, \\delta_{\\mathrm{SQ}}^{(k)})\\}_{k=1}^m$ (in $\\mathrm{ppm}$). Let $\\epsilon_{\\mathrm{sum}}$ and $\\epsilon_{\\mathrm{sq}}$ be nonnegative tolerances (in $\\mathrm{ppm}$). Construct the undirected graph $G$ whose vertices are the Carbon-13 sites and whose edges represent directly bonded pairs inferred from INADEQUATE. Encode $G$ by its adjacency matrix $A \\in \\{0,1\\}^{n \\times n}$, with $A_{ii} = 0$ and $A_{ij} = A_{ji} = 1$ if and only if there exists at least one cross-peak $(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}}) \\in P$ such that:\n- $|\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| \\le \\epsilon_{\\mathrm{sum}}$,\n- $\\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\} \\le \\epsilon_{\\mathrm{sq}}$,\n- $i \\neq j$.\n\nIf multiple candidate pairs $(i,j)$ satisfy a given cross-peak, choose the pair that minimizes the scalar criterion $r = |\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| + \\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\}$, subject to the above thresholds. Each accepted cross-peak contributes at most one edge $(i,j)$, and duplicate cross-peaks for the same pair do not change the adjacency values beyond $1$.\n\nYour task is to implement a program that, given a test suite of parameter sets $(\\Delta, P, \\epsilon_{\\mathrm{sum}}, \\epsilon_{\\mathrm{sq}})$, constructs the adjacency matrix $A$ for each case and returns its row-major flattened representation as a list of integers.\n\nAll chemical shifts and tolerances are expressed in $\\mathrm{ppm}$. No angles or other physical units are involved in the outputs. The outputs are unitless integers.\n\nTest Suite:\n- Case $1$ (happy path chain):\n  - $\\Delta = [\\,40.0,\\,30.0,\\,20.0\\,]$ $\\mathrm{ppm}$,\n  - $P = [\\,(70.0,\\,40.0),\\,(50.0,\\,30.0),\\,(60.0,\\,25.0)\\,]$ $\\mathrm{ppm}$,\n  - $\\epsilon_{\\mathrm{sum}} = 0.2$ $\\mathrm{ppm}$, $\\epsilon_{\\mathrm{sq}} = 0.2$ $\\mathrm{ppm}$.\n- Case $2$ (ambiguity resolved by single-quantum coordinate):\n  - $\\Delta = [\\,100.0,\\,50.0,\\,25.0,\\,75.0\\,]$ $\\mathrm{ppm}$,\n  - $P = [\\,(150.0,\\,50.0),\\,(175.0,\\,75.0),\\,(125.0,\\,25.0),\\,(125.0,\\,75.0)\\,]$ $\\mathrm{ppm}$,\n  - $\\epsilon_{\\mathrm{sum}} = 0.3$ $\\mathrm{ppm}$, $\\epsilon_{\\mathrm{sq}} = 0.3$ $\\mathrm{ppm}$.\n- Case $3$ (boundary tolerance acceptance and rejection):\n  - $\\Delta = [\\,80.0,\\,30.0,\\,50.0\\,]$ $\\mathrm{ppm}$,\n  - $P = [\\,(110.4,\\,80.0),\\,(130.6,\\,50.0),\\,(80.0,\\,30.0)\\,]$ $\\mathrm{ppm}$,\n  - $\\epsilon_{\\mathrm{sum}} = 0.5$ $\\mathrm{ppm}$, $\\epsilon_{\\mathrm{sq}} = 0.2$ $\\mathrm{ppm}$.\n- Case $4$ (duplicate and orientation symmetry):\n  - $\\Delta = [\\,60.0,\\,40.0,\\,20.0,\\,10.0\\,]$ $\\mathrm{ppm}$,\n  - $P = [\\,(100.0,\\,60.0),\\,(100.0,\\,40.0),\\,(60.0,\\,40.0),\\,(60.0,\\,20.0),\\,(100.0,\\,60.0)\\,]$ $\\mathrm{ppm}$,\n  - $\\epsilon_{\\mathrm{sum}} = 0.2$ $\\mathrm{ppm}$, $\\epsilon_{\\mathrm{sq}} = 0.2$ $\\mathrm{ppm}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing a list of results, one per test case, where each result is the row-major flattened adjacency matrix represented as a list of integers. The entire output must be a single comma-separated aggregate enclosed in square brackets with no spaces, for example $[[0,1,0],[1,0,1]]$.",
            "solution": "The problem requires the construction of an adjacency matrix, $A$, representing the connectivity graph of carbon atoms in a molecule. This graph is inferred from spectroscopic data obtained from a $^{13}$C INADEQUATE NMR experiment. The solution is thus an algorithmic interpretation of the rules for assigning observed spectral cross-peaks to pairs of directly bonded carbon atoms.\n\nThe inputs for each case are a list of $n$ carbon chemical shifts $\\Delta = [\\delta_1, \\delta_2, \\ldots, \\delta_n]$, a list of $m$ observed cross-peaks $P = \\{(\\delta_{\\mathrm{DQ}}^{(k)}, \\delta_{\\mathrm{SQ}}^{(k)})\\}_{k=1}^m$, and two tolerances, $\\epsilon_{\\mathrm{sum}}$ and $\\epsilon_{\\mathrm{sq}}$. The output is the $n \\times n$ adjacency matrix $A$ flattened into a row-major list.\n\nThe fundamental principle of the INADEQUATE experiment dictates that a cross-peak $(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$ arises from a pair of directly bonded $^{13}$C nuclei, say site $i$ and site $j$, with chemical shifts $\\delta_i$ and $\\delta_j$. The coordinates of the cross-peak are related to the individual chemical shifts by the approximate relations:\n$1$. The double-quantum frequency, $\\delta_{\\mathrm{DQ}}$, is the sum of the individual chemical shifts: $\\delta_{\\mathrm{DQ}} \\approx \\delta_i + \\delta_j$.\n$2$. The single-quantum frequency, $\\delta_{\\mathrm{SQ}}$, corresponds to the chemical shift of one of the two coupled nuclei: $\\delta_{\\mathrm{SQ}} \\approx \\delta_i$ or $\\delta_{\\mathrm{SQ}} \\approx \\delta_j$.\n\nThe problem formalizes these physical principles into a set of precise mathematical conditions. An edge is established between vertices $i$ and $j$ in the graph (i.e., $A_{ij} = A_{ji} = 1$) if there is at least one cross-peak $(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$ that can be confidently assigned to the pair $(i, j)$. The assignment is governed by the following criteria for $i \\neq j$:\n- $|\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| \\le \\epsilon_{\\mathrm{sum}}$\n- $\\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\} \\le \\epsilon_{\\mathrm{sq}}$\n\nA crucial aspect of the problem is handling ambiguity. A single cross-peak might satisfy the tolerance conditions for multiple pairs of atoms. To resolve this, a scalar criterion, $r$, is defined to measure the quality of a match:\n$$r = |\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| + \\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\}$$\nFor each cross-peak, we must find the pair $(i, j)$ that not only satisfies the tolerance conditions but also minimizes this value of $r$. Each cross-peak is assigned to at most one such best-fitting pair.\n\nThe overall algorithm to construct the adjacency matrix $A$ is as follows:\n\n1.  **Initialization**: Given the list of $n$ chemical shifts $\\Delta$, initialize an $n \\times n$ matrix $A$ with all elements set to $0$. This matrix will represent the graph's adjacency, where $A_{ii}$ is defined to be $0$.\n\n2.  **Iterate Through Cross-Peaks**: Process each cross-peak $(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$ from the set $P$ one by one. For each peak, the goal is to find the single best-matching pair of atoms $(i, j)$.\n\n3.  **Find the Best Match for each Peak**: For the current cross-peak, iterate through all possible unique pairs of distinct atoms $(i, j)$ where $0 \\le i < j < n$. For each pair:\n    a.  Let $\\delta_i$ and $\\delta_j$ be the chemical shifts from $\\Delta$ at indices $i$ and $j$.\n    b.  Calculate the sum difference, $\\Delta\\delta_{\\mathrm{sum}} = |\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)|$.\n    c.  Calculate the single-quantum difference, $\\Delta\\delta_{\\mathrm{sq}} = \\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\}$.\n    d.  Check if the pair is a valid candidate by testing if $\\Delta\\delta_{\\mathrm{sum}} \\le \\epsilon_{\\mathrm{sum}}$ and $\\Delta\\delta_{\\mathrm{sq}} \\le \\epsilon_{\\mathrm{sq}}$.\n    e.  If the pair is a valid candidate, calculate its matching score $r = \\Delta\\delta_{\\mathrm{sum}} + \\Delta\\delta_{\\mathrm{sq}}$. Keep track of the pair with the minimum $r$ value found so far for the current peak.\n\n4.  **Update Adjacency Matrix**: After checking all possible pairs for a given cross-peak, if a best-matching pair $(i^*, j^*)$ with the minimum score $r_{\\min}$ has been identified, this assignment is considered confirmed. Update the adjacency matrix to reflect this bond by setting $A_{i^*j^*} = 1$ and $A_{j^*i^*} = 1$. If no pair satisfies the tolerance criteria for the current peak, the peak is considered unassigned noise, and the matrix remains unchanged. The use of an adjacency matrix naturally handles cases where multiple peaks confirm the same bond; setting an element that is already $1$ to $1$ has no effect.\n\n5.  **Finalization**: After all cross-peaks in $P$ have been processed, the matrix $A$ is complete. The final step is to convert this $n \\times n$ matrix into its row-major flattened representation, which is a one-dimensional list of $n^2$ integers.\n\nThis procedure ensures that each cross-peak contributes, at most, one edge to the graph, ambiguities are resolved deterministically, and the resulting connectivity is a direct and logical consequence of the provided data and physical model. The use of NumPy arrays for matrix operations provides an efficient implementation of this algorithm.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the INADEQUATE adjacency matrix construction problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path chain)\n        (\n            [40.0, 30.0, 20.0],\n            [(70.0, 40.0), (50.0, 30.0), (60.0, 25.0)],\n            0.2, 0.2\n        ),\n        # Case 2 (ambiguity resolved by single-quantum coordinate)\n        (\n            [100.0, 50.0, 25.0, 75.0],\n            [(150.0, 50.0), (175.0, 75.0), (125.0, 25.0), (125.0, 75.0)],\n            0.3, 0.3\n        ),\n        # Case 3 (boundary tolerance acceptance and rejection)\n        (\n            [80.0, 30.0, 50.0],\n            [(110.4, 80.0), (130.6, 50.0), (80.0, 30.0)],\n            0.5, 0.2\n        ),\n        # Case 4 (duplicate and orientation symmetry)\n        (\n            [60.0, 40.0, 20.0, 10.0],\n            [(100.0, 60.0), (100.0, 40.0), (60.0, 40.0), (60.0, 20.0), (100.0, 60.0)],\n            0.2, 0.2\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        delta, peaks, eps_sum, eps_sq = case\n        adj_matrix = build_adjacency_matrix(delta, peaks, eps_sum, eps_sq)\n        # Flatten the matrix to a row-major list of integers.\n        flat_list = adj_matrix.flatten().astype(int).tolist()\n        results.append(flat_list)\n\n    # Format the final output string as a list of lists without spaces.\n    result_strings = [f\"[{','.join(map(str, res))}]\" for res in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\ndef build_adjacency_matrix(delta, peaks, eps_sum, eps_sq):\n    \"\"\"\n    Constructs the adjacency matrix from INADEQUATE NMR data.\n\n    Args:\n        delta (list of float): List of chemical shifts.\n        peaks (list of tuple): List of (delta_DQ, delta_SQ) cross-peaks.\n        eps_sum (float): Tolerance for the sum of chemical shifts.\n        eps_sq (float): Tolerance for the single-quantum chemical shift.\n\n    Returns:\n        numpy.ndarray: The n x n adjacency matrix.\n    \"\"\"\n    n = len(delta)\n    adj_matrix = np.zeros((n, n), dtype=int)\n\n    for delta_dq, delta_sq in peaks:\n        min_r = np.inf\n        best_pair = None\n\n        # Iterate through all unique pairs of atoms (i, j) with i < j\n        for i in range(n):\n            for j in range(i + 1, n):\n                delta_i = delta[i]\n                delta_j = delta[j]\n\n                # Calculate differences from experimental values\n                sum_diff = np.abs(delta_dq - (delta_i + delta_j))\n                sq_diff = min(np.abs(delta_sq - delta_i), np.abs(delta_sq - delta_j))\n\n                # Check if the pair is a valid candidate within tolerances\n                if sum_diff <= eps_sum and sq_diff <= eps_sq:\n                    # Calculate the matching criterion 'r'\n                    r = sum_diff + sq_diff\n                    if r < min_r:\n                        min_r = r\n                        best_pair = (i, j)\n        \n        # If a best-matching pair was found, update the adjacency matrix\n        if best_pair is not None:\n            i, j = best_pair\n            adj_matrix[i, j] = 1\n            adj_matrix[j, i] = 1\n            \n    return adj_matrix\n\nsolve()\n```"
        }
    ]
}