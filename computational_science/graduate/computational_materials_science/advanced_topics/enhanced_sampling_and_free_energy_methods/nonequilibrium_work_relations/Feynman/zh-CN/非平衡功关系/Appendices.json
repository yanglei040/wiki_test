{
    "hands_on_practices": [
        {
            "introduction": "本练习提供了一个具体的模型——一个受驱动的谐振子——来阐明非平衡过程中功、热和能量的基本概念。通过分析一个包含突然和连续变化的过程，您将学习如何在轨迹层面应用热力学第一定律，并理解为何功和耗散热等量依赖于过程路径。这个实践加强了路径依赖量与仅依赖于初末平衡态的状态函数（如自由能）之间的关键区别 。",
            "id": "3428950",
            "problem": "考虑一个质量为 $m$ 的一维过阻尼布朗粒子，与一个固定温度为 $T$ 的热库接触。该粒子被一个谐波势 $U(x;k) = \\frac{1}{2} k x^{2}$ 所约束，其刚度参数 $k$ 受外部控制，并根据一个分段协议随时间变化。系统初始时在参数为 $k_{0}$ 和温度为 $T$ 的条件下处于正则平衡态。该协议包括以下几个部分：\n\n1. 在时间 $t=0$ 时，参数从 $k_{0}$ 突变到 $k_{1}$，使得微观状态 $x$ 在跳变期间不发生改变，随后在固定的 $k=k_{1}$ 下完全弛豫，回到与热库的正则平衡态。\n\n2. 在 $t \\in [0,\\tau]$ 的一个连续时间段内，$k(t)$ 从 $k_{1}$ 确定性地、单调地变化到 $k_{2}$，随后在固定的 $k=k_{2}$ 下完全弛豫，回到与热库的正则平衡态。\n\n假设参数更新之间的动力学满足热力学第一定律在轨迹层面成立，其中功由 $U(x;k)$ 的参数变化定义，热由在固定参数下与热库的能量交换定义。\n\na) 将对系统所做的总功 $W_{\\text{tot}}$ 写成跳变功 $W_{\\text{jump}}$ 和协议功 $W_{\\text{prot}}$ 的和，每一项都用 $U(x;k)$ 和参数变化来表示，除了过阻尼弛豫外，不假设 $x(t)$ 的任何特定动力学。\n\nb) 对于从 $k_{0}$ 到 $k_{1}$ 跳变后的弛豫过程，计算在固定 $k=k_{1}$ 下弛豫期间与热库交换的平均热量 $Q_{\\text{relax},1}$。将 $Q_{\\text{relax},1}$ 用 $k_{0}$、$k_{1}$、$k_{B}$ 和 $T$ 表示，其中 $k_{B}$ 是玻尔兹曼常数。\n\nc) 对于在 $k_{2}$ 处结束的连续段后的弛豫过程，用弛豫前瞬间的平均位移平方 $\\langle x^{2} \\rangle_{\\text{end}}$ 和 $k_{2}$ 来表示平均热量 $Q_{\\text{relax},2}$，并说明在什么条件下 $Q_{\\text{relax},2}$ 为零。\n\nd) 使用协议的结构和适用于分子动力学的非平衡功定理（在问题陈述中不具体说明任何定理），计算初始态（$k_{0}$）和最终态（$k_{2}$）之间的平衡自由能差 $\\Delta F$，并将其表示为关于 $k_{0}$、$k_{2}$、$k_{B}$ 和 $T$ 的闭式表达式。最终的自由能差以焦耳为单位表示。最终答案必须是单一的闭式解析表达式。不需要数值，也不需要四舍五入。",
            "solution": "对问题陈述进行分析后，认定其是有效的。它描述了应用于谐波势中过阻尼布朗粒子的一系列热力学过程。其表述虽然在不同阶段的时间变量上存在微小歧义，但与一个包含参数跳变、弛豫期、连续参数变化和最终弛豫期的顺序协议是一致的。这种解释使得问题的所有部分都是适定的，并且可以使用统计力学和随机热力学的既定原理解答。\n\n系统是一个处于谐波势 $U(x;k) = \\frac{1}{2} k x^2$ 中的一维粒子。该粒子与一个恒定温度为 $T$ 的热浴接触。对于这样一个处于正则平衡的系统，能量均分定理指出，平均势能为 $\\langle U \\rangle_{eq} = \\frac{1}{2} k_B T$，其中 $k_B$ 是玻尔兹曼常数。由此，我们可以求出均方位移：$\\langle \\frac{1}{2} k x^2 \\rangle = \\frac{1}{2} k_B T$，这意味着 $\\langle x^2 \\rangle_{eq} = \\frac{k_B T}{k}$。\n\n该协议被解释为一个序列：\n1.  系统最初处于平衡状态，势参数设置为 $k_0$。\n2.  在时间 $t=0$ 时，参数从 $k_0$ 瞬时变为 $k_1$。对系统做功。\n3.  然后系统在固定参数 $k=k_1$ 下弛豫，直到达到新的平衡态。与热库交换热量。\n4.  从 $k_1$ 的平衡态开始，在持续时间为 $\\tau$ 的时间间隔内，参数从 $k_1$ 连续变化到 $k_2$。对系统做功。\n5.  最后，在参数固定为 $k_2$ 的情况下，系统弛豫到其最终的平衡态。与热库交换热量。\n\n微观状态 $x$ 的能量由其势能 $U(x;k)$ 给出。单个轨迹的热力学第一定律是 $dE = dW + dQ$，其中 $E=U$。功 $dW$ 与控制参数 $k$ 的变化相关，$dW = \\frac{\\partial U}{\\partial k} dk$。热量 $dQ$ 是在固定参数下与热库交换的能量，可以证明 $dQ = \\frac{\\partial U}{\\partial x} dx$。\n\na) 总功 $W_{\\text{tot}}$ 是在参数 $k$ 变化的两个阶段中所做功的总和。设从 $k_0$ 处的平衡分布中抽取的粒子初始位置为 $x_0$。设在连续协议段期间粒子的轨迹表示为 $x(t)$，其中 $t$ 在该协议段的时间间隔内。\n\n从 $k_0$ 到 $k_1$ 的突变过程中所做的功称为 $W_{\\text{jump}}$。由于跳变是瞬时的，粒子的位置 $x_0$ 不变。功是在固定位置下由参数变化引起的势能变化：\n$$W_{\\text{jump}} = U(x_0; k_1) - U(x_0; k_0) = \\frac{1}{2} k_1 x_0^2 - \\frac{1}{2} k_0 x_0^2 = \\frac{1}{2} (k_1 - k_0) x_0^2$$\n\n从 $k_1$ 到 $k_2$ 的连续协议期间所做的功称为 $W_{\\text{prot}}$。这个功是通过在协议持续时间内对无穷小功 $dW$ 进行积分得到的，我们可以将时钟重新归零后，取 $t \\in [0, \\tau]$。\n$$W_{\\text{prot}} = \\int_{\\text{protocol}} dW = \\int_0^\\tau \\frac{\\partial U(x(t); k(t))}{\\partial k} \\frac{dk}{dt} dt = \\int_0^\\tau \\frac{1}{2} x(t)^2 \\dot{k}(t) dt$$\n总功是这两个贡献之和：\n$$W_{\\text{tot}} = W_{\\text{jump}} + W_{\\text{prot}} = \\frac{1}{2} (k_1 - k_0) x_0^2 + \\int_0^\\tau \\frac{1}{2} x(t)^2 \\dot{k}(t) dt$$\n\nb) 我们需要计算在恒定参数 $k=k_1$ 下弛豫期间交换的平均热量 $\\langle Q_{\\text{relax},1} \\rangle$。这个过程在跳变后立即开始。该弛豫过程的初始状态是粒子在势 $U(x; k_1)$ 中位于位置 $x_0$。最终状态是在温度 $T$ 和参数 $k_1$ 下的正则平衡态。\n在恒定 $k$ 下弛豫期间，没有做功（$dk=0$，所以 $dW=0$）。根据第一定律，沿一条轨迹交换的热量等于能量的变化：$Q_{\\text{relax},1} = \\Delta U = U_{\\text{final}} - U_{\\text{initial}}$。\n我们需要平均热量，$\\langle Q_{\\text{relax},1} \\rangle = \\langle U_{\\text{final}} \\rangle - \\langle U_{\\text{initial}} \\rangle$。\n\n平均初始能量 $\\langle U_{\\text{initial}} \\rangle$ 是 $U(x_0; k_1) = \\frac{1}{2} k_1 x_0^2$ 的平均值，其中平均值是针对参数 $k_0$ 下 $x_0$ 的初始平衡分布计算的。\n$$\\langle U_{\\text{initial}} \\rangle = \\left\\langle \\frac{1}{2} k_1 x_0^2 \\right\\rangle_{k_0} = \\frac{1}{2} k_1 \\langle x_0^2 \\rangle_{k_0}$$\n使用能量均分结果 $\\langle x_0^2 \\rangle_{k_0} = k_B T / k_0$，我们得到：\n$$\\langle U_{\\text{initial}} \\rangle = \\frac{1}{2} k_1 \\frac{k_B T}{k_0}$$\n\n平均最终能量 $\\langle U_{\\text{final}} \\rangle$ 是参数为 $k_1$ 的新平衡态下的平均势能。根据能量均分定理：\n$$\\langle U_{\\text{final}} \\rangle = \\left\\langle \\frac{1}{2} k_1 x^2 \\right\\rangle_{k_1} = \\frac{1}{2} k_B T$$\n\n因此，平均热量为：\n$$\\langle Q_{\\text{relax},1} \\rangle = \\frac{1}{2} k_B T - \\frac{1}{2} k_1 \\frac{k_B T}{k_0} = \\frac{1}{2} k_B T \\left(1 - \\frac{k_1}{k_0}\\right)$$\n\nc) 类似地，对于在恒定 $k=k_2$ 下的弛豫，交换的平均热量为 $\\langle Q_{\\text{relax},2} \\rangle = \\langle U_{\\text{final}} \\rangle - \\langle U_{\\text{initial}} \\rangle$。\n此过程的初始状态是连续协议结束时系统的状态，即粒子在势 $U(x; k_2)$ 中位于位置 $x_{\\text{end}}$。问题给出了此时的平均位移平方为 $\\langle x^2 \\rangle_{\\text{end}}$。\n平均初始能量为：\n$$\\langle U_{\\text{initial}} \\rangle = \\left\\langle \\frac{1}{2} k_2 x_{\\text{end}}^2 \\right\\rangle = \\frac{1}{2} k_2 \\langle x^2 \\rangle_{\\text{end}}$$\n最终状态是在参数 $k_2$ 下的平衡态，所以平均最终能量为 $\\langle U_{\\text{final}} \\rangle = \\frac{1}{2} k_B T$。\n平均热量为：\n$$\\langle Q_{\\text{relax},2} \\rangle = \\frac{1}{2} k_B T - \\frac{1}{2} k_2 \\langle x^2 \\rangle_{\\text{end}}$$\n如果 $\\frac{1}{2} k_B T = \\frac{1}{2} k_2 \\langle x^2 \\rangle_{\\text{end}}$，则此平均热量为零，$\\langle Q_{\\text{relax},2} \\rangle = 0$。这个条件意味着在连续驱动协议结束时的平均势能必须等于参数 $k_2$ 下的平衡平均势能。一个充分条件是系统在整个连续驱动过程中保持平衡，这在协议准静态执行（即无限缓慢，$\\tau \\to \\infty$）时发生。\n\nd) 初始态（在 $k_0$ 处的平衡态）和最终态（在 $k_2$ 处的平衡态）之间的平衡自由能差 $\\Delta F$ 是一个状态函数。它仅取决于初始和最终的平衡态，而与它们之间的路径无关。非平衡功定理，例如 Jarzynski 等式 $\\langle \\exp(-\\beta W) \\rangle = \\exp(-\\beta \\Delta F)$，证实了 $\\Delta F$ 原则上可以从连接两个状态的任何非平衡过程中找到。然而，这些定理也强调了 $\\Delta F$ 的值是唯一的且与路径无关。\n\n因此，我们可以用最直接的方法来计算 $\\Delta F$，即通过亥姆霍兹自由能的统计力学定义 $F = -k_B T \\ln Z$，其中 $Z$ 是配分函数。对于一维谐振子，配分函数为：\n$$Z(k, T) = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{U(x;k)}{k_B T}\\right) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{k x^2}{2 k_B T}\\right) dx$$\n这是一个标准的高斯积分，其计算结果为：\n$$Z(k, T) = \\sqrt{\\frac{2 \\pi k_B T}{k}}$$\n$k$ 和 $T$ 的函数形式的自由能为：\n$$F(k, T) = -k_B T \\ln(Z(k, T)) = -k_B T \\ln\\left(\\sqrt{\\frac{2 \\pi k_B T}{k}}\\right) = -\\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T}{k}\\right)$$\n自由能差 $\\Delta F = F(k_2, T) - F(k_0, T)$ 则为：\n$$\\Delta F = -\\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T}{k_2}\\right) - \\left(-\\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T}{k_0}\\right)\\right)$$\n$$\\Delta F = \\frac{1}{2} k_B T \\left[ \\ln\\left(\\frac{2 \\pi k_B T}{k_0}\\right) - \\ln\\left(\\frac{2 \\pi k_B T}{k_2}\\right) \\right]$$\n使用对数的性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$：\n$$\\Delta F = \\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T/k_0}{2 \\pi k_B T/k_2}\\right) = \\frac{1}{2} k_B T \\ln\\left(\\frac{k_2}{k_0}\\right)$$\n这个表达式给出了以能量单位（国际单位制中为焦耳）表示的自由能差，是所要求的最终答案。",
            "answer": "$$\\boxed{\\frac{1}{2} k_{B} T \\ln\\left(\\frac{k_{2}}{k_{0}}\\right)}$$"
        },
        {
            "introduction": "Crooks 涨落定理揭示了正向和反向非平衡过程之间深刻的对称性。本问题使用一个模型化学反应和高斯功分布这一强大假设，来解析地推导这种联系。更重要的是，它揭示了应用功定理的一个关键要求：系统必须从一个真正的平衡态开始。通过一个假想情景，您将量化因初始系综制备不当而导致的自由能差估计误差，这是模拟和实验中常见的陷阱 。",
            "id": "2659399",
            "problem": "考虑一个最小化学反应网络，其中包含两种化学物质 $A$ 和 $B$。它们在温度为 $T$ 的充分搅拌的恒温化学恒化器中通过 $A \\rightleftharpoons B$ 相互转化。一个标量控制参数 $\\lambda(t)$ 在一个有限时间窗口 $t \\in [0,\\tau]$ 内驱动 $A$ 和 $B$ 之间的标准化学势差 $\\Delta \\mu(\\lambda)$。将正向协议记为 $\\lambda_{F}: 0 \\to 1$，反向协议记为 $\\lambda_{R}: 1 \\to 0$。假设随机反应动力学遵循局域细致平衡且微观可逆，并且对于一个中等速率的协议，累积功是许多弱相关贡献的总和，因此沿一条轨迹实现的功 $W$ 近似服从高斯分布。\n\n你进行了多次正向实验的重复，每次正向实现都从对应于 $\\lambda_{F}(0)=0$ 的平衡分布开始，并进行了多次反向实验的重复。在正确初始化的情形下，反向实现必须从对应于 $\\lambda_{R}(0)=1$ 的平衡分布开始。假设当两个系综都正确初始化时，正向功分布的均值为 $\\mu_{F}$，方差为 $\\sigma^{2}$，反向功分布的均值为 $\\mu_{R}$，方差同样为 $\\sigma^{2}$，且逆热能为 $\\beta = 1/(k_{B}T)$。\n\n(a) 从反应网络的微观可逆性和局域细致平衡出发，将正向路径概率与时间反演路径概率之比与热力学量联系起来，从而推导出正向功分布和反向功分布之间的关系。使用具有共同方差 $\\sigma^{2}$ 的高斯形式，推导出连接 $\\mu_{F}$、$\\mu_{R}$、$\\sigma^{2}$、$\\beta$ 以及平衡自由能差 $\\Delta F = F(\\lambda=1) - F(\\lambda=0)$ 的线性约束。\n\n(b) 现在考虑在制备反向初始系综时的一个错误：反向实现从一个非平衡稳态混合物开始，这使得反向功均值产生了一个加性偏移 $\\delta$（而方差 $\\sigma^{2}$ 基本保持不变），因此测得的反向均值为 $\\mu_{R}^{\\mathrm{wrong}} = \\mu_{R} + \\delta$。如果有人天真地应用在(a)部分推导出的高斯正向-反向匹配公式，使用 $\\mu_{F}$ 和 $\\mu_{R}^{\\mathrm{wrong}}$ 来估计 $\\Delta F$，那么当 $\\beta = 1$（即功以 $k_{B}T$ 为单位表示）、$\\sigma^{2} = 2$、$\\mu_{F} = 1.5$ 和 $\\delta = 0.6$ 时，这个天真的估计量会得到什么值？请以 $k_{B}T$ 为单位表示你的最终答案，并将答案四舍五入到四位有效数字。最终答案必须是一个数字。",
            "solution": "该问题是有效的，因为它在科学上基于非平衡统计力学的原理，提法恰当且信息充分，并以客观、正式的语言陈述。我们开始解答。\n\n(a)部分：推导约束条件\n\n非平衡功关系的基础是微观可逆性原理。对于一个在随时间变化的协议 $\\lambda(t)$ 下演化的系统，在时间反演协议 $\\lambda_R(t) = \\lambda_F(\\tau-t)$ 下，观测到正向轨迹 $\\Gamma = \\{x(t)\\}_{t=0}^{\\tau}$ 的概率与观测到其时间反演 $\\tilde{\\Gamma} = \\{x(\\tau-t)\\}_{t=0}^{\\tau}$ 的概率之比，与沿正向路径产生的熵有关。路径概率既考虑了动力学，也考虑了初始平衡分布。设正向过程从 $\\lambda(0)=0$ 处的平衡分布开始，其自由能为 $F(\\lambda=0)$；反向过程从 $\\lambda(\\tau)=1$ 处的平衡分布开始，其自由能为 $F(\\lambda=1)$。Crooks 涨落定理陈述了对系统做功 $W$ 的概率分布之间的关系。对于正向 ($P_F(W)$) 和反向 ($P_R(W)$) 过程，该定理为：\n$$\n\\frac{P_F(W)}{P_R(-W)} = \\exp(\\beta(W - \\Delta F))\n$$\n此处，$\\beta = 1/(k_B T)$ 是逆热能，$\\Delta F = F(\\lambda=1) - F(\\lambda=0)$ 是协议最终态和初始态之间的平衡自由能差。在时间反演轨迹中所做的功是在正向轨迹中所做功的负值，即 $W_{\\text{reverse}}(\\tilde{\\Gamma}) = -W_{\\text{forward}}(\\Gamma)$。\n\n问题陈述功分布近似为具有共同方差 $\\sigma^2$ 的高斯分布。正向功的概率密度函数为：\n$$\nP_F(W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W-\\mu_F)^2}{2\\sigma^2}\\right)\n$$\n对于反向功，其概率密度函数为：\n$$\nP_R(W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W-\\mu_R)^2}{2\\sigma^2}\\right)\n$$\n为了使用 Crooks 关系，我们需要概率密度 $P_R(-W)$：\n$$\nP_R(-W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(-W-\\mu_R)^2}{2\\sigma^2}\\right) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W+\\mu_R)^2}{2\\sigma^2}\\right)\n$$\n将这些高斯形式代入 Crooks 关系：\n$$\n\\frac{\\exp\\left(-\\frac{(W-\\mu_F)^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(W+\\mu_R)^2}{2\\sigma^2}\\right)} = \\exp(\\beta(W - \\Delta F))\n$$\n对两边取自然对数：\n$$\n-\\frac{(W-\\mu_F)^2}{2\\sigma^2} + \\frac{(W+\\mu_R)^2}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n展开分子中的平方项：\n$$\n\\frac{-(W^2 - 2W\\mu_F + \\mu_F^2) + (W^2 + 2W\\mu_R + \\mu_R^2)}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n$W$ 的二次项相互抵消：\n$$\n\\frac{2W\\mu_F - \\mu_F^2 + 2W\\mu_R + \\mu_R^2}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n重新整理左边，按 $W$ 的幂次对各项进行分组：\n$$\n\\frac{W(2\\mu_F + 2\\mu_R) + (\\mu_R^2 - \\mu_F^2)}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n为使此等式对所有 $W$ 值都成立，两边 $W$ 相应幂次的系数必须相等。\n\n令 $W^1$ 的系数相等：\n$$\n\\frac{2(\\mu_F + \\mu_R)}{2\\sigma^2} = \\beta \\implies \\mu_F + \\mu_R = \\beta \\sigma^2\n$$\n这是第一个线性约束，它将平均功之和与方差及温度联系起来。这是涨落-耗散定理的一种形式。\n\n令常数项 ($W^0$) 相等：\n$$\n\\frac{\\mu_R^2 - \\mu_F^2}{2\\sigma^2} = -\\beta \\Delta F \\implies \\mu_F^2 - \\mu_R^2 = 2\\sigma^2 \\beta \\Delta F\n$$\n我们可以对左边进行因式分解：$(\\mu_F - \\mu_R)(\\mu_F + \\mu_R) = 2\\sigma^2 \\beta \\Delta F$。代入第一个约束 $\\mu_F + \\mu_R = \\beta \\sigma^2$：\n$$\n(\\mu_F - \\mu_R)(\\beta \\sigma^2) = 2\\sigma^2 \\beta \\Delta F\n$$\n假设 $\\beta \\neq 0$ 且 $\\sigma^2 \\neq 0$，我们可以两边同除以 $\\beta \\sigma^2$ 得到第二个线性约束：\n$$\n\\mu_F - \\mu_R = 2\\Delta F\n$$\n这个约束直接将平均功之差与平衡自由能变化联系起来。\n\n(b)部分：计算 $\\Delta F$ 的天真估计量\n\n问题指明，在制备反向协议的初始系综时的一个错误导致测得的平均反向功为 $\\mu_{R}^{\\mathrm{wrong}} = \\mu_{R} + \\delta$，而方差 $\\sigma^2$ 保持不变。$\\Delta F$ 的天真估计量是通过应用(a)部分推导的公式 $\\Delta F = (\\mu_F - \\mu_R)/2$ 得到的，但是用错误测量的 $\\mu_{R}^{\\mathrm{wrong}}$ 值代替了正确的 $\\mu_R$ 值。\n这个天真估计量，我们记为 $\\Delta F_{\\text{naive}}$，因此是：\n$$\n\\Delta F_{\\text{naive}} = \\frac{\\mu_F - \\mu_{R}^{\\mathrm{wrong}}}{2}\n$$\n为了计算 $\\Delta F_{\\text{naive}}$ 的数值，我们必须首先确定反向均值的正确值 $\\mu_R$，这个值本应在具有正确初始化的理想实验中获得。我们使用(a)部分推导的第一个约束，以及为正确执行的实验所提供的参数：$\\mu_F + \\mu_R = \\beta \\sigma^2$。\n给定值为：\n$\\beta = 1$（单位为 $(k_B T)^{-1}$）\n$\\sigma^2 = 2$（单位为 $(k_B T)^2$）\n$\\mu_F = 1.5$（单位为 $k_B T$）\n$\\delta = 0.6$（单位为 $k_B T$）\n\n首先，我们求解真实的反向均值 $\\mu_R$：\n$$\n\\mu_R = \\beta \\sigma^2 - \\mu_F\n$$\n代入数值：\n$$\n\\mu_R = (1)(2) - 1.5 = 2 - 1.5 = 0.5\n$$\n$\\mu_R$ 的值为 $0.5$（单位为 $k_B T$）。\n\n接下来，我们计算测得的错误的反向均值：\n$$\n\\mu_{R}^{\\mathrm{wrong}} = \\mu_R + \\delta = 0.5 + 0.6 = 1.1\n$$\n$\\mu_{R}^{\\mathrm{wrong}}$ 的值为 $1.1$（单位为 $k_B T$）。\n\n最后，我们使用 $\\mu_F$ 和 $\\mu_{R}^{\\mathrm{wrong}}$ 计算自由能差的天真估计值：\n$$\n\\Delta F_{\\text{naive}} = \\frac{\\mu_F - \\mu_{R}^{\\mathrm{wrong}}}{2} = \\frac{1.5 - 1.1}{2} = \\frac{0.4}{2} = 0.2\n$$\n自由能差的天真估计值为 $0.2$（单位为 $k_B T$）。问题要求将答案四舍五入到四位有效数字，即 $0.2000$。\n为了完整起见，真实的自由能差本应是 $\\Delta F = (\\mu_F - \\mu_R)/2 = (1.5 - 0.5)/2 = 0.5$ $k_B T$。初始化中的错误导致了对自由能变化的显著低估。",
            "answer": "$$\n\\boxed{0.2000}\n$$"
        },
        {
            "introduction": "使用 Jarzynski 等式 $\\langle \\exp(-\\beta W) \\rangle = \\exp(-\\beta \\Delta F)$ 计算自由能差面临着一个重大的计算挑战，因为该平均值通常由具有低功值的罕见轨迹主导。这个动手编码练习直接解决了这个抽样问题。您将实现一个重要性抽样方案，以偏向性地探索这些关键的罕见事件，然后使用重加权来恢复一个无偏且高效收敛的自由能差估计，这是非平衡功关系实际应用中至关重要的一项技术 。",
            "id": "3469440",
            "problem": "考虑一个一维过阻尼谐振子，其势能由 $U(x; k(t)) = \\frac{1}{2} k(t) x^2$ 给出，其中 $x$ 是位置， $k(t)$ 是一个随时间变化的刚度。系统初始处于逆温度为 $\\beta$ 的平衡（正则系综）态。刚度通过一个包含 $M$ 个离散步骤的协议，从初始值 $k_0$ 线性变化到最终值 $k_1$，其恒定增量为 $\\Delta k = (k_1 - k_0)/M$。在步骤索引 $n \\in \\{0, 1, \\dots, M-1\\}$ 处，刚度为 $k_n = k_0 + n \\Delta k$。\n\n假设在每个离散步骤中，位置在当前刚度 $k_n$ 下瞬时达到平衡；也就是说，$x_n$ 是从正则分布 $p_n(x) \\propto \\exp\\left(-\\beta U(x; k_n)\\right)$ 中采样的，这是一个均值为零、方差为 $\\sigma_n^2 = 1/(\\beta k_n)$ 的正态分布。沿协议的一次实现所做的离散功定义为\n$$\nW = \\sum_{n=0}^{M-1} \\left( \\frac{\\partial U(x_n; k)}{\\partial k} \\bigg|_{k = k_n} \\right) \\Delta k\n= \\sum_{n=0}^{M-1} \\left( \\frac{1}{2} x_n^2 \\right) \\Delta k\n= \\frac{\\Delta k}{2} \\sum_{n=0}^{M-1} x_n^2.\n$$\n目标是使用非平衡功关系，特别是功的指数平均，来估计刚度 $k_0$ 和 $k_1$ 之间的平衡自由能差 $\\Delta F$。然而，对于大的刚度变化或低温（大的 $\\beta$），随机变量 $W$ 可能有一个稀有事件尾部，该尾部主导了 $\\langle e^{-\\beta W} \\rangle$，导致在朴素采样下收敛性差。\n\n为解决此问题，请实现一个重要性采样方案，该方案将每一步的正则分布向低 $|x|$ 值倾斜。具体来说，在每一步 $n$，不要从 $p_n$ 中采样 $x_n$，而是从一个倾斜的正态分布 $q_n$ 中采样 $x_n$。该分布具有相同的零均值，但对于用户选择的倾斜参数 $s \\geq 1$，其方差减小为 $\\sigma_n^2/s$。通过每一步的密度变化比进行精确重加权，以构建在倾斜测度下 $\\langle e^{-\\beta W} \\rangle$ 的无偏估计量，然后计算 $\\Delta F$ 的相应估计值。\n\n您的程序必须：\n- 生成 $N$ 条独立的轨迹，每条轨迹包含 $M$ 步。\n- 在每条轨迹的第 $n$ 步，从方差为 $\\sigma_n^2/s$ 的倾斜分布 $q_n$ 中采样 $x_n$。\n- 使用上述离散化定义计算每条轨迹的功 $W$。\n- 计算沿轨迹的每步密度比 $p_n(x_n)/q_n(x_n)$ 的乘积，以构成该轨迹的总体重要性权重。\n- 通过对轨迹的加权平均，在重要性采样下估计 $\\langle e^{-\\beta W} \\rangle$，然后以热能 $k_{\\mathrm{B}}T$ 为单位输出自由能差，即无量纲量 $\\beta \\Delta F = -\\ln \\langle e^{-\\beta W} \\rangle$。\n\n所有随机采样必须通过为伪随机数生成器使用固定种子来保证可复现性。所有最终答案都表示为对应于 $\\beta \\Delta F$ 的无量纲浮点数。\n\n实现该程序以处理以下参数集测试套件：\n1. $(\\beta, k_0, k_1, M, N, s) = (1.0, 1.0, 4.0, 100, 5000, 1.0)$\n2. $(\\beta, k_0, k_1, M, N, s) = (1.0, 1.0, 4.0, 100, 5000, 2.0)$\n3. $(\\beta, k_0, k_1, M, N, s) = (2.0, 0.5, 8.0, 120, 8000, 2.5)$\n4. $(\\beta, k_0, k_1, M, N, s) = (1.0, 2.0, 2.0, 80, 6000, 3.0)$\n\n你的程序应该生成单行输出，其中包含这四个测试用例的结果，格式为方括号括起来的逗号分隔列表，例如“[r1,r2,r3,r4]”。每个 $r_i$ 必须是为相应参数集估计的无量纲浮点数 $\\beta \\Delta F$，并按上面列出的顺序排列。不应打印任何附加文本。\n\n确保建模和计算中的科学真实性和内部一致性。所有能量必须以 $k_{\\mathrm{B}}T$ 为单位报告，即作为无量纲乘积 $\\beta \\Delta F$。",
            "solution": "问题陈述已经过分析，并被认为是有效的。它具有统计力学的科学基础，是适定的，提供了所有必要的参数和定义，并且呈现方式客观。该问题要求使用 Jarzynski 等式和重要性采样方案来计算自由能差，这是计算物理学中一个标准且不平凡的任务。\n\n目标是计算一维谐振子的无量纲平衡自由能差 $\\beta \\Delta F$，其刚度 $k$ 从 $k_0$ 变为 $k_1$。系统的势能为 $U(x; k) = \\frac{1}{2} k x^2$。对于一个处于逆温度 $\\beta$ 的正则系综中的系统，其 Helmholtz 自由能为 $F = - \\frac{1}{\\beta} \\ln Z$，其中 $Z$ 是配分函数。谐振子的配分函数是 $Z(k) = \\int_{-\\infty}^{\\infty} e^{-\\beta U(x;k)} dx = \\sqrt{2\\pi/(\\beta k)}$。因此，精确的自由能差是解析已知的：\n$$\n\\beta \\Delta F = \\beta (F(k_1) - F(k_0)) = \\ln\\left(\\frac{Z(k_0)}{Z(k_1)}\\right) = \\ln\\left(\\sqrt{\\frac{k_1}{k_0}}\\right) = \\frac{1}{2}\\ln\\left(\\frac{k_1}{k_0}\\right).\n$$\n这个解析结果将作为我们数值估计的基准。\n\n该问题要求使用 Jarzynski 等式，这是非平衡统计力学的一个基石，它将自由能差与在非平衡轨迹上对系统所做的功 $W$ 联系起来：\n$$\n\\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta F}.\n$$\n尖括号表示对协议所有可能实现的平均。对于离散化协议的单次实现，功 $W$ 由下式给出：\n$$\nW = \\frac{\\Delta k}{2} \\sum_{n=0}^{M-1} x_n^2, \\quad \\text{其中} \\quad \\Delta k = \\frac{k_1 - k_0}{M}.\n$$\n在每一步 $n$，位置 $x_n$ 从一个概率分布中抽取。在朴素模拟中，这将是刚度为 $k_n = k_0 + n\\Delta k$ 时的平衡 Boltzmann 分布 $p_n(x)$。该分布是一个均值为 $0$、方差为 $\\sigma_n^2 = 1/(\\beta k_n)$ 的高斯分布：\n$$\np_n(x) = \\frac{1}{\\sqrt{2\\pi \\sigma_n^2}} \\exp\\left(-\\frac{x^2}{2\\sigma_n^2}\\right) = \\sqrt{\\frac{\\beta k_n}{2\\pi}} \\exp\\left(-\\frac{\\beta k_n x^2}{2}\\right).\n$$\n对 $\\langle e^{-\\beta W} \\rangle$ 的直接数值估计可能会因为收敛性差而受到影响，因为平均值可能由具有大功值的稀有轨迹主导。为了解决这个问题，我们采用重要性采样。我们不从 $p_n(x)$ 采样，而是从一个有偏或“倾斜”的分布 $q_n(x)$ 中采样，并通过重加权来校正偏差。问题指定了一个倾斜分布 $q_n(x)$，它也是一个均值为 $0$ 的高斯分布，但对于倾斜参数 $s \\geq 1$，其方差减小为 $\\sigma_{q,n}^2 = \\sigma_n^2/s = 1/(s \\beta k_n)$：\n$$\nq_n(x) = \\frac{1}{\\sqrt{2\\pi \\sigma_{q,n}^2}} \\exp\\left(-\\frac{x^2}{2\\sigma_{q,n}^2}\\right) = \\sqrt{\\frac{s \\beta k_n}{2\\pi}} \\exp\\left(-\\frac{s \\beta k_n x^2}{2}\\right).\n$$\nJarzynski 平均是对轨迹的真实概率分布 $P$ 的期望，可以写成对倾斜分布 $Q$ 的期望：\n$$\n\\langle e^{-\\beta W} \\rangle_P = \\left\\langle e^{-\\beta W} \\mathcal{W}_{\\text{IS}} \\right\\rangle_Q,\n$$\n其中 $\\mathcal{W}_{\\text{IS}}$ 是整个轨迹的重要性采样权重。这个权重是每一步概率比的乘积：\n$$\n\\mathcal{W}_{\\text{IS}}(\\{x_n\\}) = \\prod_{n=0}^{M-1} \\frac{p_n(x_n)}{q_n(x_n)}.\n$$\n单步 $n$ 的比率为：\n$$\n\\frac{p_n(x_n)}{q_n(x_n)} = \\frac{\\sqrt{\\beta k_n / 2\\pi}}{\\sqrt{s \\beta k_n / 2\\pi}} \\frac{\\exp(-\\beta k_n x_n^2 / 2)}{\\exp(-s \\beta k_n x_n^2 / 2)} = \\frac{1}{\\sqrt{s}} \\exp\\left(\\frac{(s-1)\\beta k_n x_n^2}{2}\\right).\n$$\n对于一条完整的轨迹，总权重是这些项的乘积。为了数值稳定性，最好使用对数进行计算。对每条轨迹 $i$ 需要平均的量是 $Y_i = \\mathcal{W}_{\\text{IS}}^{(i)} e^{-\\beta W^{(i)}}$。它的对数是：\n$$\n\\ln Y_i = \\ln \\mathcal{W}_{\\text{IS}}^{(i)} - \\beta W^{(i)} = \\sum_{n=0}^{M-1} \\ln\\left(\\frac{p_n(x_n^{(i)})}{q_n(x_n^{(i)})}\\right) - \\beta \\sum_{n=0}^{M-1} \\frac{\\Delta k}{2} (x_n^{(i)})^2.\n$$\n代入对数比和功的表达式：\n$$\n\\ln Y_i = \\sum_{n=0}^{M-1} \\left( -\\frac{1}{2}\\ln s + \\frac{(s-1)\\beta k_n (x_n^{(i)})^2}{2} \\right) - \\sum_{n=0}^{M-1} \\frac{\\beta \\Delta k}{2} (x_n^{(i)})^2.\n$$\n合并项得到一个计算上高效的表达式：\n$$\n\\ln Y_i = -\\frac{M}{2}\\ln s + \\frac{\\beta}{2} \\sum_{n=0}^{M-1} (x_n^{(i)})^2 \\left( (s-1)k_n - \\Delta k \\right).\n$$\nJarzynski 平均从 $N$ 条轨迹中估计为 $\\overline{Y} = \\frac{1}{N}\\sum_{i=1}^N Y_i = \\frac{1}{N}\\sum_{i=1}^N e^{\\ln Y_i}$。期望的自由能则为 $\\beta \\Delta F = -\\ln \\overline{Y}$。为了鲁棒地计算这个值，特别是当 $\\ln Y_i$ 的值范围很大时，我们使用 log-sum-exp 技巧：\n$$\n\\ln \\overline{Y} = L_{\\text{max}} + \\ln\\left(\\frac{1}{N} \\sum_{i=1}^N e^{\\ln Y_i - L_{\\text{max}}}\\right), \\quad \\text{其中} \\quad L_{\\text{max}} = \\max_i(\\ln Y_i).\n$$\n算法通过生成 $N$ 条轨迹来进行，其中每条轨迹包含从相应倾斜分布 $\\{q_n\\}$ 中采样的 $M$ 个位置 $\\{x_n\\}$。对于每条轨迹，计算 $\\ln Y_i$，最后使用 log-sum-exp 方法从这些值的平均值中计算出 $\\beta \\Delta F$。$s=1$ 的情况对应于没有重要性权重的朴素采样，因为权重 $\\mathcal{W}_{\\text{IS}}$ 变为 $1$。\n\n实现将使用 NumPy 进行向量化以提高效率。对于每个测试用例，我们计算刚度协议 $k_n$，从适当的正态分布中为所有 $N$ 条轨迹采样所有位置 $x_n$，计算 $\\ln Y_i$ 值的数组，然后计算 $\\beta \\Delta F$ 的最终估计。固定的随机种子确保了可复现性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the dimensionless free energy difference beta * DeltaF for a driven\n    harmonic oscillator using the Jarzynski equality with importance sampling.\n    \"\"\"\n    # Fixed seed for the pseudorandom number generator for reproducibility.\n    SEED = 12345\n    rng = np.random.default_rng(SEED)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (beta, k0, k1, M, N, s)\n        (1.0, 1.0, 4.0, 100, 5000, 1.0),\n        (1.0, 1.0, 4.0, 100, 5000, 2.0),\n        (2.0, 0.5, 8.0, 120, 8000, 2.5),\n        (1.0, 2.0, 2.0, 80, 6000, 3.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        beta, k0, k1, M, N, s = case\n\n        # Calculate protocol parameters.\n        # delta_k is the stiffness increment per step.\n        delta_k = (k1 - k0) / M\n        # k_n is an array of stiffness values for each step n of the protocol.\n        k_n = k0 + np.arange(M) * delta_k\n\n        # Calculate terms for the logarithm of the estimator Y.\n        # ln(Y) = log_prefactor + (beta/2) * sum_term\n        if s == 1.0:\n            # Special case for naive sampling (s=1). The importance weight is 1.\n            # log_prefactor = 0, and the term in the sum simplifies.\n            log_prefactor = 0.0\n            term_multiplier = -delta_k\n        else:\n            # General case for importance sampling (s > 1).\n            log_prefactor = -0.5 * M * np.log(s)\n            term_multiplier = (s - 1) * k_n - delta_k\n\n        # Perform the simulation in a vectorized manner over N trajectories.\n\n        # Calculate the standard deviations of the tilted sampling distributions q_n.\n        # Variances are 1 / (s * beta * k_n).\n        # We must handle the case k_n=0, but given the problem parameters k_n > 0.\n        tilted_sigmas = np.sqrt(1.0 / (s * beta * k_n))\n\n        # Sample positions x_n for all N trajectories and M steps.\n        # The scale parameter broadcasts to generate an (N, M) array where each\n        # column j is sampled with standard deviation tilted_sigmas[j].\n        x_samples = rng.normal(loc=0.0, scale=tilted_sigmas, size=(N, M))\n\n        # Calculate the sum term in the ln(Y) expression for each trajectory.\n        # This involves a broadcasted element-wise multiplication followed by a sum over steps (axis=1).\n        sum_term = np.sum(x_samples**2 * term_multiplier, axis=1)\n\n        # Compute the array of ln(Y_i) values for all N trajectories.\n        log_Y_values = log_prefactor + 0.5 * beta * sum_term\n\n        # Estimate the Jarzynski average using the log-sum-exp trick for numerical stability.\n        # We want to compute log(mean(exp(log_Y_values))).\n        max_log_Y = np.max(log_Y_values)\n        log_jarzynski_avg = max_log_Y + np.log(np.mean(np.exp(log_Y_values - max_log_Y)))\n\n        # The free energy difference is the negative of the log-average.\n        beta_delta_F = -log_jarzynski_avg\n        results.append(beta_delta_F)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}