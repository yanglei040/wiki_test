## 引言
[机器学习原子间势](@entry_id:751582)（MLIP）正迅速成为[计算材料科学](@entry_id:145245)的基石，它在量子力学的精度与[经典力场](@entry_id:747367)的效率之间取得了前所未有的平衡，使得以往难以实现的大规模、长时间尺度[原子模拟](@entry_id:199973)成为可能。然而，这些强大的数据驱动模型也带来了一个核心挑战：我们如何确保它们的预测不仅是数学上的拟合，更是物理上真实可靠的？一个MLIP的价值不在于它能多好地复现训练数据，而在于它在面对未知原子构型时，是否依然能够遵循物理规律并给出可信的预测。

本文旨在系统性地解决这一知识鸿沟，为构建和部署稳健的MLIPs提供一个全面的指南。我们将穿越从理论构建到实际应用的完整流程，揭示如何将基本的物理原理内嵌于模型之中，以及如何通过严格的验证和先进的工作流来管理其内在的局限性。

在接下来的内容中，读者将首先在“原理与机制”一章中学习构建MLIP的基石，包括必须遵守的物理对称性、生成高质量训练数据的策略，以及平衡多重目标的训练[范式](@entry_id:161181)。随后，“应用与跨学科交叉”一章将[焦点](@entry_id:174388)转向实践，探讨如何通过与第一性原理计算的基准比较来验证模型，并介绍如何利用适用性域、不确定性量化和主动学习等先进技术来驾驭和扩展模型的能力。最后，“动手实践”部分将提供具体的编程练习，将理论知识转化为实践技能。本指南将从确保物理实在性的基本原理出发，引导您深入了解MLIPs的训练与验证。

## 原理与机制

本章旨在阐述构建、训练和验证[机器学习原子间势](@entry_id:751582)（MLIP）所依据的核心物理原理和计算机制。[机器学习原子间势](@entry_id:751582)的目标是创建一个计算上高效的函数，该函数能够准确地预测给定原子构型的系统势能，并由此推导出[原子间作用力](@entry_id:158182)、应力张量等物理量。一个成功的MLIP不仅要在已知数据上表现出高精度，更关键的是，它必须内在地遵循支配原子尺度系统行为的基本物理定律。本章将系统性地探讨确保MLIP物理实在性的基本对称性要求、生成高质量训练数据的策略、处理真实数据中固有挑战的先进技术，以及优化模型以平衡多重性能目标的训练[范式](@entry_id:161181)。

### 基本[对称性与守恒律](@entry_id:160300)

任何一个旨在描述物理系统的[原子间势](@entry_id:177673)，无论其数学形式如何，都必须服从宇宙的[基本对称性](@entry_id:161256)。这些对称性并非可选项，而是构建有效模型的基石。对于原子系统而言，最重要的对称性包括空间平移和[旋转不变性](@entry_id:137644)、以及同类[粒子不可区分性](@entry_id:152187)所要求的[置换不变性](@entry_id:753356)。

#### 刚体运动下的不变性与[等变性](@entry_id:636671)

我们所处的空间是均匀且各向同性的。这意味着物理定律不应依赖于我们观察系统的位置或朝向。这一基本原则对[势能函数](@entry_id:200753) $E$ 及其导数（如力 $\mathbf{F}$）施加了严格的约束。考虑一个由 $N$ 个原子组成的系统，其位置为 $\{\mathbf{r}_i\}$。一个刚体运动（属于欧几里得群 $E(3)$）可以将每个原子的位置通过一个[旋转矩阵](@entry_id:140302) $\mathbf{R} \in SO(3)$ 和一个平移向量 $\mathbf{t} \in \mathbb{R}^3$ 进行变换，得到新的位置 $\mathbf{r}'_i = \mathbf{R}\mathbf{r}_i + \mathbf{t}$。

物理实在性要求势能（一个标量）在刚体运动下保持**[不变性](@entry_id:140168)（invariance）**。这是因为系统的内在能量仅取决于原子间的相对位置，而非其在空间中的绝对位置或整体朝向。因此，一个有效的势函数必须满足：
$$
E(\{\mathbf{r}'_i\}) = E(\{\mathbf{R}\mathbf{r}_i + \mathbf{t}\}) = E(\{\mathbf{r}_i\})
$$
许多MLIP通过使用原子间距离 $r_{ij} = \|\mathbf{r}_i - \mathbf{r}_j\|$ 等内部坐标作为输入特征来天然地满足这一要求，因为距离在刚体运动下是不变的。

与能量不同，力是一个矢量，它必须表现出**[等变性](@entry_id:636671)（equivariance）**。这意味着如果整个原子系统被旋转，那么每个原子上的力矢量也必须以完全相同的方式旋转。数学上，这表示：
$$
\mathbf{F}'_i = \mathbf{F}(\{\mathbf{r}'_k\}) = \mathbf{R} \mathbf{F}(\{\mathbf{r}_k\}) = \mathbf{R} \mathbf{F}_i
$$
平移则不改变力，因为力仅依赖于相对位置。这些性质可以通过设计一个验证测试来严格检验 。例如，我们可以从一个基础构型出发，对其施加一系列随机的旋转和平移，然后计算变换后构型的能量和力。对于一个正确的势函数，如[Lennard-Jones势](@entry_id:143105)，其能量在变换前后应保持不变（在[数值精度](@entry_id:173145)范围内），而新计算出的力矢量应等于原力矢量经过相同[旋转矩阵](@entry_id:140302)变换后的结果。

相反，如果一个势函数包含了一个依赖于实验室坐标系的项，例如一个与特定方向 $\mathbf{n}$ 相关的惩罚项 $E_{\mathrm{orient}} = \alpha \sum_{i=1}^{N} ((\mathbf{r}_i - \bar{\mathbf{r}}) \cdot \mathbf{n})^2$，其中 $\bar{\mathbf{r}}$ 是系统质心，那么它将在旋转下不再保持不变。这样的模型是违反物理原理的，我们的验证测试能够准确地识别出这种对称性的破坏，表现为能量[不变性](@entry_id:140168)误差 $\delta_E$ 和力[等变性](@entry_id:636671)误差 $\delta_F$ 的显著增加。

#### [置换不变性](@entry_id:753356)

量子力学的基本原理指出，同种类的基本粒子（如电子）或[复合粒子](@entry_id:150176)（如[原子核](@entry_id:167902)）是不可区分的。这意味着，如果我们交换系统中两个化学性质完全相同的原子的标签或索引，系统的总能量绝不能发生任何改变。这一性质被称为**[置换不变性](@entry_id:753356)（permutation invariance）**。

对于一个包含 $N$ 个原子，其物种标签为 $\{s_i\}$ 的系统，如果一个[置换](@entry_id:136432)操作 $P$ 仅交换相同物种原子的索引（即，对于所有 $i$，有 $s_{P(i)} = s_i$），那么[势能函数](@entry_id:200753)必须满足：
$$
E(\{\mathbf{r}_{P(i)}\}, \{s_{P(i)}\}) = E(\{\mathbf{r}_i\}, \{s_i\})
$$
MLIP的设计必须从一开始就考虑到这一要求。通常，这是通过将总[能量表示](@entry_id:202173)为各个原子能量之和 $E = \sum_i E_i$ 来实现的，其中每个原子的能量 $E_i$ 是其周围邻域环境的一个函数，而这个函数本身对邻近原子的[置换](@entry_id:136432)是不变的。

我们可以通过一个直接的计算测试来验证MLIP是否满足[置换不变性](@entry_id:753356) 。该测试的算法步骤如下：
1.  **识别物种群组**：对于一个给定的原子构型，将原子索引根据其化学物种进行分组。
2.  **生成[置换](@entry_id:136432)**：在每个包含多个原子的物种群组内部，生成一系列确定性的[置换](@entry_id:136432)操作，例如反转索引顺序或[循环移位](@entry_id:177315)。
3.  **计算并比较能量**：计算原始构型的能量 $E_0$。然后，对每一个生成的[置换](@entry_id:136432)，应用该[置换](@entry_id:136432)重新[排列](@entry_id:136432)原子坐标和物种列表，并计算[新构型](@entry_id:199611)的能量 $E_p$。
4.  **验证**：检查 $|E_p - E_0|$ 是否在一个极小的数值容差 $\varepsilon$ 范围内。如果对于所有测试的[置换](@entry_id:136432)都成立，则模型在该构型下通过了[置换不变性](@entry_id:753356)测试。

例如，一个设计良好的势能模型，其原子能量贡献依赖于物种相关的权重 $w_{s_i}$，通常能够通过此测试。而一个被故意设计为非[置换](@entry_id:136432)不变的模型，例如其能量贡献依赖于原子在列表中的绝对索引 $i$（如 $\alpha_i = i$），则会在原子标签被交换时预测出不同的总能量，从而无法通过测试。

#### 守恒律的实施

根据[诺特定理](@entry_id:145690)，物理系统的连续对称性对应着一个[守恒量](@entry_id:150267)。[平移不变性](@entry_id:195885)意味着总线性动量的守恒，而[旋转不变性](@entry_id:137644)则意味着总角动量的守恒。对于一个[孤立系统](@entry_id:159201)（不受外力或外力矩作用），这些[守恒定律](@entry_id:269268)要求系统内所有原子受到的力的总和以及总力矩均为零：
$$
\sum_{i=1}^N \mathbf{F}_i = \mathbf{0} \quad \text{(总力为零)}
$$
$$
\sum_{i=1}^N \mathbf{r}_i \times \mathbf{F}_i = \mathbf{0} \quad \text{(总力矩为零)}
$$
虽然一个精确满足 $E(3)$ 不变性的[势函数](@entry_id:176105)所推导出的力会自动满足这些条件，但在机器学习的实践中，由于模型近似和有限的训练数据，学习到的[力场](@entry_id:147325)可能不会完美地遵守这些约束。这些微小的违反会导致在分子动力学（MD）模拟中出现[能量漂移](@entry_id:748982)或系统整体平移（“[飞行冰块](@entry_id:203187)”效应）等非物理行为。

为了缓解这一问题，可以在MLIP的训练过程中主动加入这些物理约束。一种有效的方法是在损失函数中引入**软约束（soft constraints）**或惩罚项 。假设MLIP是一个以参数 $\mathbf{w}$ 为权重的[线性模型](@entry_id:178302)，其预测的力为 $\mathbf{F}_i^{\text{pred}}(\mathbf{w})$，则可以在标准的力匹配损失函数基础上，增加两个惩罚项：
$$
\mathcal{L}(\mathbf{w}) = \left\| \mathbf{F}^{\text{pred}} - \mathbf{F}^{\text{true}} \right\|^2 + \lambda_f \left\| \sum_i \mathbf{F}_i^{\text{pred}} \right\|^2 + \lambda_\tau \left\| \sum_i \mathbf{r}_i \times \mathbf{F}_i^{\text{pred}} \right\|^2
$$
其中，$\lambda_f$ 和 $\lambda_\tau$ 是控制惩罚强度的超参数。这些惩罚项会驱动优化过程去寻找一个既能很好地拟合训练数据，又能使总力和总力矩接近于零的参数解 $\mathbf{w}$。实验表明，加入这些约束可以显著改善模型的物理真实性，例如，可以提高预测的[维里应力张量](@entry_id:756505)的准确性，并增强由该[势函数](@entry_id:176105)驱动的MD模拟的长期稳定性。

### 训练语料库：生成与管理

MLIP的性能在很大程度上取决于其所学习的训练数据的质量、多样性和范围。一个理想的训练集应该能够全面地代表材料在目标应用场景（如特定的温度和压力范围）下可能经历的所有相关原子构型。本节将探讨生成和管理这些数据的关键策略。

#### 构型空间采样

为了让MLIP能够泛化到未见过的构型，训练数据必须充分探索[势能面](@entry_id:147441)的相关区域。一个系统化的[采样策略](@entry_id:188482)通常结合多种方法来生成涵盖平衡态附近、受压/拉伸以及热致波动的构型 。

1.  **热采样（Thermal Sampling）**：为了模拟材料在有限温度下的行为，我们需要包含原子因热运动而偏离其理想[晶格](@entry_id:196752)位置的构型。在[谐振子近似](@entry_id:268588)下，我们可以利用[统计力](@entry_id:194984)学中的能量均分定理来确定原子位移的合理幅度。该定理指出，在温度 $T$ 下，每个二次自由度的平均能量为 $\frac{1}{2}k_B T$，其中 $k_B$ 是玻尔兹曼常数。对于一个在三维谐波势 $V(\mathbf{u}) = \frac{1}{2} k_{\mathrm{eff}} \|\mathbf{u}\|^2$ 中[振动](@entry_id:267781)的原子，其平均[势能](@entry_id:748988)为 $\langle V(\mathbf{u}) \rangle = \frac{3}{2}k_B T$。如果我们将位移分量 $u_k$ 建模为来自均值为零、[方差](@entry_id:200758)为 $\sigma_T^2$ 的高斯分布，则 $\langle \|\mathbf{u}\|^2 \rangle = 3\sigma_T^2$。联立可得：
    $$
    \frac{1}{2} k_{\mathrm{eff}} (3\sigma_T^2) = \frac{3}{2} k_B T \implies \sigma_T^2 = \frac{k_B T}{k_{\mathrm{eff}}}
    $$
    此关系式为在给定温度 $T$ 下，通过从高斯分布 $\mathcal{N}(0, \sigma_T^2)$ 采样生成原子随机位移提供了物理依据。一种合理的策略是在多个不同温度下进行采样，并将更多的计算资源（即生成更多的构型）分配给高温，因为高温对应更大的位移[方差](@entry_id:200758)，探索了更广阔的构型空间。

2.  **应变采样（Strain Sampling）**：为了让模型能够准确预测材料的弹性性质和对机械载荷的响应，训练集中必须包含经历均匀应变的构型。一个均匀[应变张量](@entry_id:193332) $\boldsymbol{\varepsilon}$ 可以施加于一个[晶胞](@entry_id:143489)的[晶格](@entry_id:196752)矩阵 $\mathbf{L}_0$，得到新的[晶格](@entry_id:196752)矩阵 $\mathbf{L}' = (\mathbf{I} + \boldsymbol{\varepsilon}) \mathbf{L}_0$。[应变张量](@entry_id:193332)可以分解为引起体积变化的**静水应变**[部分和](@entry_id:162077)引起形状变化的**[偏应变](@entry_id:201263)**部分。通过系统地在一定的范围内对这两种应变模式进行采样，可以确保训练数据覆盖了材料的弹性响应区域。

3.  **覆盖度量化**：为了评估一个采样方案的有效性，我们需要量化其对构型空间的覆盖程度。常见的度量包括：
    *   **[对分布函数](@entry_id:145441)覆盖率**：将所有构型中的原子间对距离收集起来，统计其[分布](@entry_id:182848)。通过将距离范围划分成若干个小区间（bins），计算非空区间的比例，可以评估模型在不同原子间距上的训练情况。
    *   **[应变不变量](@entry_id:190518)覆盖率**：对于应变构型，可以计算应变张量的[不变量](@entry_id:148850)，如第一[不变量](@entry_id:148850) $I_1 = \mathrm{tr}(\boldsymbol{\varepsilon})$（与体积变化相关）和第二偏[应变[不变](@entry_id:190518)量](@entry_id:148850) $J_2$（与[剪切变形](@entry_id:170920)的大小相关）。通过检查这些[不变量](@entry_id:148850)在预定范围内的[分布](@entry_id:182848)，可以评估弹性变形空间的覆盖情况。

一个全面的采样计划会结合上述方法，并利用这些覆盖度量来迭代地改进数据集，确保最终的MLIP在整个目标相空间内都是可靠的。

#### 多保真度[数据融合](@entry_id:141454)

[第一性原理计算](@entry_id:198754)（如[密度泛函理论](@entry_id:139027)DFT）虽然准确，但计算成本高昂，特别是对于高精度方法如[随机相位近似](@entry_id:754035)（RPA）或[耦合簇理论](@entry_id:141746)（[CCSD(T)](@entry_id:271595)）。这使得完全依赖高精度方法生成大规模[训练集](@entry_id:636396)变得不切实际。一个高效的策略是采用**[多保真度学习](@entry_id:752239)**，即融合大量低成本、低精度的数据（如来自[PBE泛函](@entry_id:140699)的DFT计算）和少量高成本、高精度的数据 。

这种方法的核心思想是，低保真度计算虽然可能存在系统性偏差（bias），但它们能以较低成本捕捉到[势能面](@entry_id:147441)的大部分拓扑特征。高保真度数据则用于校正这些偏差。我们可以构建一个[统计模型](@entry_id:165873)来 formalize 这个过程。假设低保真度标签 $y_L$ 和高保真度标签 $y_H$ 与真实值 $\phi^\top \beta_{\mathrm{true}}$ 之间存在不同的系统偏差（$b_L$, $b_H$）和随机噪声[方差](@entry_id:200758)（$\sigma_L^2$, $\sigma_H^2$）。我们可以通过一个混合参数 $\lambda$ 来构建一个“融合”标签：
$$
y_i^{\mathrm{blend}} = y_L(i) + c_i \lambda (y_H(i) - y_L(i))
$$
其中 $c_i=1$ 表示样本 $i$ 拥有高保真度标签。这个融合标签的有效偏差和噪声[方差](@entry_id:200758)会依赖于 $\lambda$ 和 $c_i$。

为了在回归中正确处理这种异[方差](@entry_id:200758)（heteroscedastic）和有偏的数据，我们采用**[加权最小二乘法](@entry_id:177517)（Weighted Least Squares, WLS）**。权重 $w_i$ 的选择至关重要，理想的权重应与噪声的逆[方差](@entry_id:200758)成正比。此外，我们可以引入一个“信任”参数 $\alpha$ 来调整权重，该参数考虑了高、低保真度方法之间的系统偏差差异 $(b_L - b_H)^2$。权重可以定义为：
$$
w_i(\alpha) = \frac{1}{\mathrm{Var}[\eta_i] + \alpha \, c_i \, (b_L - b_H)^2}
$$
其中 $\mathrm{Var}[\eta_i]$ 是融合标签的噪声[方差](@entry_id:200758)。当 $\alpha > 0$ 时，如果两种方法之间的偏差差距很大，拥有高保真度标签的点的权重就会被调低，这反映了我们对融合这两种差异巨大的预测所带来的不确定性的审慎态度。

通过这个框架，我们可以推导出学习到的参数 $\hat{\beta}$ 的统计[偏差和[方](@entry_id:170697)差](@entry_id:200758)，并最终得到对新构型预测的[均方误差](@entry_id:175403)（MSE）。这个过程使得我们能够在[偏差和方差](@entry_id:170697)之间进行权衡，并通过调整 $\lambda$ 和 $\alpha$ 等超参数，系统地优化MLIP的训练过程，以最经济的方式达到最高的预测精度。

#### [数据管理](@entry_id:635035)与诊断

原始的计算数据可能包含异常值或不希望的结构相似性，这些都会对模型训练产生负面影响。因此，对训练数据进行严格的管理和诊断是不可或缺的环节。

##### 检测影响力大的异常值

训练数据中的个别标签可能因为计算收敛问题或其他错误而成为异常值。这些点，特别是那些在描述符空间中位置独特（[高杠杆点](@entry_id:167038)）的异常值，可能对拟合出的[势能面](@entry_id:147441)产生不成比例的巨大影响。**[库克距离](@entry_id:175103)（Cook's distance）**是一种标准的统计诊断工具，用于衡量删除某个数据点后，模型参数发生的整体变化 。其定义为：
$$
D_i = \frac{e_i^2}{p \cdot \hat{\sigma}^2} \cdot \frac{h_{ii}}{(1 - h_{ii})^2}
$$
这里，$e_i$ 是数据点 $i$ 的残差（预测值与标签之差），$p$ 是模型参数数量，$\hat{\sigma}^2$ 是模型的残差[方差估计](@entry_id:268607)，而 $h_{ii}$ 是该点的杠杆值（leverage），衡量了其在描述符空间中的孤立程度。[库克距离](@entry_id:175103)同时考虑了点的残差大小和杠杆值，因此能有效识别出既是异常值又是[高杠杆点](@entry_id:167038)的那种最具“影响力”的数据点。

在实践中，我们可以计算所有训练点的[库克距离](@entry_id:175103)，并将 $D_i$ 值最高的少数几个点识别为潜在的有害异常值。通过将这些点从[训练集](@entry_id:636396)中移除并重新训练模型，我们往往可以获得一个泛化能力更强、物理性质更合理的[势函数](@entry_id:176105)。例如，移除一个会严重扭曲[势能面](@entry_id:147441)局部曲率的异[常点](@entry_id:164624)后，重新训练得到的模型不仅在独立的[验证集](@entry_id:636445)上[均方根误差](@entry_id:170440)（RMSE）更低，而且其预测的[势能面](@entry_id:147441)曲率（与[振动频率](@entry_id:199185)和MD稳定性直接相关）也更接近物理真实值，从而提高了模型的MD模拟稳定性。

##### 防止[数据泄漏](@entry_id:260649)

评估MLIP性能的一个关键步骤是在一个独立的测试集上进行测试。然而，如果测试集中的某些构型与[训练集](@entry_id:636396)中的构型“过于相似”，那么测试结果将无法真实反映模型对未知情况的泛化能力，这种现象称为**[数据泄漏](@entry_id:260649)（data leakage）**。

简单地检查坐标是否重复是不够的，因为微小的原子扰动或整体的旋转平移就会产生一个坐标不同但物理上几乎相同的构型。一个更鲁棒的方法是在MLIP所见的**描述符空间（descriptor space）**中衡量构型间的相似性 。然而，直接使用欧几里得距离来衡量描述符向量的相似性也存在问题，因为描述符的不同分量可能具有不同的尺度和相关性。

正确的做法是使用**[马氏距离](@entry_id:269828)（Mahalanobis distance）**，它等价于在一个“白化（whitened）”的描述符空间中计算[欧几里得距离](@entry_id:143990)。这个[白化变换](@entry_id:637327)通过训练集的[均值向量](@entry_id:266544) $\mu$ 和[协方差矩阵](@entry_id:139155) $\Sigma$ 来定义，它对描述符进行中心化和缩放，消除了分量间的线形相关性，使得所有维度上的距离贡献都具有同等意义。变换公式为 $y = L^{-1}(x - \mu)$，其中 $L$ 是 $\Sigma$（经过适当正则化后）的[Cholesky分解](@entry_id:147066)因子。

为了判断一个测试点是否“过于相似”，我们需要一个阈值。一个固定的、凭经验选择的阈值缺乏普适性。更合理的方法是基于训练数据自身的内在尺度来设定一个自适应阈值。具体来说，我们可以计算训练集中每个点到其最近邻居的（白化空间）距离，得到一个距离[分布](@entry_id:182848)。然后，我们将泄漏阈值 $T$ 定义为这个[分布](@entry_id:182848)的一个低[分位数](@entry_id:178417)（例如，10%分位数）。这意味着，如果一个测试点与某个训练点的距离小于[训练集](@entry_id:636396)中10%的内部最近邻距离，我们就有理由认为这个测试点与训练集存在泄漏嫌疑，应将其从测试集中移除或标记出来。

### 模型架构与训练[范式](@entry_id:161181)

除了数据本身，MLIP的数学形式（架构）和训练它的优化策略也同样关键。本节讨论两个核心方面：几乎所有MLIP都依赖的局域性假设，以及在多个性能目标间取得平衡的训练方法。

#### 局域性原则与截断函数

原子间的相互作用强度通常随距离的增加而减弱。为了[计算效率](@entry_id:270255)，绝大多数MLIP都引入了**局域性假设（locality assumption）**，即一个原子的能量仅由其邻近一定范围内的原子（邻域）所决定。这个范围由一个**[截断半径](@entry_id:136708)（cutoff radius, $r_c$）**来定义。

这个假设的合理性及 $r_c$ 的选择对模型精度有深远影响 。对于不同类型的材料，相互作用的程（range）有很大差异。例如，在绝缘体或离子晶体中，长程的库仑相互作用衰减很慢（如 $1/r$），使用一个较小的 $r_c$ 会引入显著的截断误差。相比之下，在金属中，由于导电电子的屏蔽效应，有效相互作用衰减得更快（如Yukawa势 $\exp(-\kappa r)/r$）。因此，对于一个给定的 $r_c$，[截断误差](@entry_id:140949)在金属中通常比在绝缘体中小得多。这意味着，为绝缘体构建精确的局域MLIP需要比金属大得多的[截断半径](@entry_id:136708)，这直接影响了模型的计算成本。

在模型中实现截断并非简单地在 $r_c$ 处硬性切断相互作用。这样做会导致势能函数在 $r_c$ 处连续但其导数（力）不连续，这会在MD模拟中导致[能量不守恒](@entry_id:276143)和[数值不稳定性](@entry_id:137058)。为了解决这个问题，我们必须使用一个**平滑截断函数（smooth cutoff function）**，通常记作 $S(r)$ 。这个函数的作用是让[势能](@entry_id:748988)在接近 $r_c$ 的一个区间内平滑地过渡到零。一个优秀的截断函数应该至少是二阶连续可微的（$C^2$），以确保力和力的导数（与[声子谱](@entry_id:753408)和热导率等性质相关）都是连续的。一个常用的选择是[五次多项式](@entry_id:753983)，它在 $[r_{\mathrm{on}}, r_c]$ 区间内从1平滑地变为0，并且在两个端点处的一阶和[二阶导数](@entry_id:144508)均为零。例如：
$$
S(r) = 1 - 10x^3 + 15x^4 - 6x^5, \quad \text{其中} \quad x = \frac{r - r_{\mathrm{on}}}{r_c - r_{\mathrm{on}}}
$$
一个完整的[势函数](@entry_id:176105) $U(r)$ 通常被写成基础势 $U_{\text{base}}(r)$ 与截断函数 $S(r)$ 的乘积：$U(r) = S(r) U_{\text{base}}(r)$。其对应的力则通过[乘法法则](@entry_id:144424)求导得到：
$$
F(r) = - \frac{d}{dr}[S(r) U_{\text{base}}(r)] = - \left[ \frac{dS(r)}{dr} U_{\text{base}}(r) + S(r) \frac{dU_{\text{base}}(r)}{dr} \right]
$$
对这些解析导数进行精确的编程实现是构建可靠MLIP的关键一步。通过与数值[有限差分](@entry_id:167874)导数进行比较，可以严格验证导数代码的正确性，这是模型开发中一个必不可少的健全性检查。

#### [多目标优化](@entry_id:637420)

一个MLIP通常需要同时准确地预测多个物理量，最常见的是能量（$E$）、力（$\mathbf{F}$）和[维里应力张量](@entry_id:756505)（$\boldsymbol{\sigma}$）。然而，这三个目标之间可能存在竞争关系。例如，一个极力优化能量拟合的模型可能会以牺牲力的精度为代价，反之亦然。因此，MLIP的训练本质上是一个**[多目标优化](@entry_id:637420)（multi-objective optimization）**问题 。

解决这个问题的一个常用方法是**[标量化](@entry_id:634761)（scalarization）**，即通过加权和将多个损失函数组合成一个单一的标量损失函数 $\mathcal{L}$：
$$
\mathcal{L}(\boldsymbol{\theta}) = w_E \mathcal{L}_E + w_F \mathcal{L}_F + w_S \mathcal{L}_S + \lambda \|\boldsymbol{\theta}\|^2
$$
其中，$\mathcal{L}_E, \mathcal{L}_F, \mathcal{L}_S$ 分别是能量、力和应力的均方误差，而 $w_E, w_F, w_S$ 是控制各项相对重要性的非负权重（通常归一化为和为1）。$\lambda \|\boldsymbol{\theta}\|^2$ 是一个正则化项，用于[防止过拟合](@entry_id:635166)。

通过系统地改变权重向量 $\mathbf{w} = (w_E, w_F, w_S)$（例如，从只关注能量的 $(1,0,0)$ 到均衡的 $(\frac{1}{3},\frac{1}{3},\frac{1}{3})$），我们可以训练出一系列不同的模型。这些模型在三维误差空间 $(\ell_E, \ell_F, \ell_S)$ 中构成一个**帕累托前沿（Pareto front）**。帕累托前沿上的每一个点都代表一个“最优”的权衡方案：不可能在不增加至少一个其他误差的情况下，减少任何一个误差。

最终模型的选择取决于具体的应用需求。帕累托前沿为我们提供了一系列最佳候选模型，而不是单一的“最佳”模型。如果我们的主要目标是进行精确的[结构优化](@entry_id:176910)，我们可能会选择一个在力误差方面表现最好的模型（即权重 $w_F$ 较大的模型）。如果目标是计算准确的[相图](@entry_id:144015)，那么能量精度至关重要，我们可能会选择一个 $w_E$ 较大的模型。这种基于帕累托分析的决策过程，使得我们能够根据特定的科学问题，有原则地、定量地选择最适合的MLIP。