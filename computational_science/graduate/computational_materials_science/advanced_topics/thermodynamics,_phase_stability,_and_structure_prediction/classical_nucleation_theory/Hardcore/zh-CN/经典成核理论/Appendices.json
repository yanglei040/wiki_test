{
    "hands_on_practices": [
        {
            "introduction": "经典成核理论的核心在于理解新相形成所必须克服的能量壁垒。本练习将提供一个基础实践，引导你从第一性原理出发，推导临界核半径（$r^*$）和相应的成核势垒（$\\Delta G^*$），从而阐明表面能与体驱动力之间的根本性竞争关系。此外，本练习还介绍了误差传播这一关键技能，使你能够评估界面能等关键物理参数的不确定性如何影响预测的势垒高度。",
            "id": "3437248",
            "problem": "考虑如经典成核理论（CNT）所述的，从熔体中均匀等温成核形成球形固相核的过程。形成半径为 $r$ 的团簇的可逆吉布斯自由能变，被建模为一个与面积成正比的表面项和一个与体积成正比的能量驱动项之和。设各向同性的固液界面自由能为 $\\gamma$，单位体积的体吉布斯自由能变（对于有利相为负值）为 $\\Delta g_{v}$。将核视作完美球体，并忽略弹性、各向异性以及与曲率相关的校正。\n\n给定以下与深度过冷金属熔体在科学上一致的参数：\n- 界面自由能：$\\gamma = 0.25\\,\\mathrm{J\\,m^{-2}}$，具有 $10\\%$ 的相对不确定度（即标准不确定度为 $0.10 \\times \\gamma$）。\n- 体驱动自由能密度：$\\Delta g_{v} = -8.0 \\times 10^{8}\\,\\mathrm{J\\,m^{-3}}$。\n\n从球形团簇自由能模型的第一性原理出发，推导临界半径 $r^{*}$ 和相应的成核能垒 $\\Delta G^{*}$ 的表达式，解释它们的物理来源，然后使用给定的 $\\gamma$ 和 $\\Delta g_{v}$ 对它们进行数值计算。接下来，假设 $\\Delta g_{v}$ 没有不确定度，使用一阶微分误差传播法评估 $\\gamma$ 中 $10\\%$ 的不确定度对 $\\Delta G^{*}$ 的影响。报告 $\\Delta G^{*}$ 中传播的绝对不确定度。\n\n答案规格：\n- 以 $\\mathrm{nm}$ 为单位表示 $r^{*}$。\n- 以 $\\mathrm{J}$ 为单位表示 $\\Delta G^{*}$ 及其传播的绝对不确定度。\n- 将报告的每个量四舍五入至四位有效数字。\n- 以行矩阵的形式提供最终答案，依次包含 $r^{*}$、$\\Delta G^{*}$ 以及由 $\\gamma$ 的 $10\\%$ 不确定度引起的 $\\Delta G^{*}$ 的传播绝对不确定度。",
            "solution": "该问题是有效的，因为它在科学上基于经典成核理论（CNT），在数学上是适定的，并使用客观、精确的语言和物理上合理的参数。所有必要的信息都已提供，不存在矛盾。\n\n从熔体中形成半径为 $r$ 的球形核的可逆吉布斯自由能变 $\\Delta G$ 是一个正的表面能项和一个负的体能量项之和。表面项代表创建新的固液界面所需的能量成本，而体能量项代表将一定体积的高能液相转变为低能固相所获得的能量。\n\n1.  **临界半径 ($r^*$) 和成核能垒 ($\\Delta G^*$) 的推导**\n\n球形核的表面积为 $A = 4\\pi r^2$，其体积为 $V = \\frac{4}{3}\\pi r^3$。给定各向同性的固液界面自由能 $\\gamma$ 和单位体积的体吉布斯自由能变 $\\Delta g_{v}$，总自由能变 $\\Delta G(r)$ 为：\n$$\n\\Delta G(r) = (\\text{表面积}) \\times \\gamma + (\\text{体积}) \\times \\Delta g_{v}\n$$\n$$\n\\Delta G(r) = 4\\pi r^2 \\gamma + \\frac{4}{3}\\pi r^3 \\Delta g_{v}\n$$\n正的 $r^2$ 项和负的 $r^3$ 项（因为 $\\Delta g_v  0$）之间的竞争导致了一个能垒。这个能垒的峰值对应于临界核尺寸 $r^*$ 和成核能垒 $\\Delta G^*$。为了找到临界半径，我们通过对 $\\Delta G(r)$ 函数关于 $r$ 求导并将其设为零来找到其最大值。\n$$\n\\frac{d(\\Delta G(r))}{dr} = \\frac{d}{dr} \\left( 4\\pi r^2 \\gamma + \\frac{4}{3}\\pi r^3 \\Delta g_{v} \\right) = 8\\pi r \\gamma + 4\\pi r^2 \\Delta g_{v}\n$$\n令 $r = r^*$ 处的导数为零：\n$$\n8\\pi r^* \\gamma + 4\\pi (r^*)^2 \\Delta g_{v} = 0\n$$\n由于 $r^*=0$ 对应于初始状态（没有核），我们通过除以 $4\\pi r^*$ 来寻找非平凡解：\n$$\n2\\gamma + r^* \\Delta g_{v} = 0\n$$\n求解 $r^*$，我们得到临界半径的表达式：\n$$\nr^* = -\\frac{2\\gamma}{\\Delta g_{v}}\n$$\n物理上，$r^*$ 是核处于不稳定平衡状态的半径。小于 $r^*$ 的核倾向于收缩以减少表面能，而大于 $r^*$ 的核倾向于生长以减少体自由能。\n\n成核能垒 $\\Delta G^*$ 是 $\\Delta G(r)$ 在 $r=r^*$ 处的值：\n$$\n\\Delta G^* = \\Delta G(r^*) = 4\\pi (r^*)^2 \\gamma + \\frac{4}{3}\\pi (r^*)^3 \\Delta g_{v}\n$$\n代入 $r^*$ 的表达式：\n$$\n\\Delta G^* = 4\\pi \\left(-\\frac{2\\gamma}{\\Delta g_{v}}\\right)^2 \\gamma + \\frac{4}{3}\\pi \\left(-\\frac{2\\gamma}{\\Delta g_{v}}\\right)^3 \\Delta g_{v}\n$$\n$$\n\\Delta G^* = 4\\pi \\left(\\frac{4\\gamma^2}{(\\Delta g_{v})^2}\\right) \\gamma + \\frac{4}{3}\\pi \\left(-\\frac{8\\gamma^3}{(\\Delta g_{v})^3}\\right) \\Delta g_{v}\n$$\n$$\n\\Delta G^* = \\frac{16\\pi\\gamma^3}{(\\Delta g_{v})^2} - \\frac{32\\pi\\gamma^3}{3(\\Delta g_{v})^2}\n$$\n$$\n\\Delta G^* = \\left( \\frac{48-32}{3} \\right) \\frac{\\pi\\gamma^3}{(\\Delta g_{v})^2} = \\frac{16\\pi\\gamma^3}{3(\\Delta g_{v})^2}\n$$\n这是要形成一个稳定核所必须通过热涨落克服的能垒。\n\n2.  **数值计算**\n\n给定参数：\n$\\gamma = 0.25\\,\\mathrm{J\\,m^{-2}}$\n$\\Delta g_{v} = -8.0 \\times 10^{8}\\,\\mathrm{J\\,m^{-3}}$\n\n我们计算 $r^*$：\n$$\nr^* = -\\frac{2 \\times 0.25}{-8.0 \\times 10^{8}} = \\frac{0.5}{8.0 \\times 10^{8}} = 0.625 \\times 10^{-9}\\,\\mathrm{m}\n$$\n转换为纳米（$1\\,\\mathrm{nm} = 10^{-9}\\,\\mathrm{m}$）并四舍五入到四位有效数字：\n$$\nr^* = 0.6250\\,\\mathrm{nm}\n$$\n接下来，我们计算 $\\Delta G^*$：\n$$\n\\Delta G^* = \\frac{16\\pi (0.25)^3}{3(-8.0 \\times 10^{8})^2} = \\frac{16\\pi (0.015625)}{3(64 \\times 10^{16})} = \\frac{0.25\\pi}{192 \\times 10^{16}} \\approx 4.090615 \\times 10^{-19}\\,\\mathrm{J}\n$$\n四舍五入到四位有效数字：\n$$\n\\Delta G^* = 4.091 \\times 10^{-19}\\,\\mathrm{J}\n$$\n\n3.  **不确定度传播**\n\n我们需要找到由 $\\gamma$ 中 $10\\%$ 的相对不确定度导致的 $\\Delta G^*$ 的绝对不确定度，记为 $u(\\Delta G^*)$。我们假设 $\\Delta g_v$ 的不确定度为零。关系式为 $\\Delta G^* = C\\gamma^3$，其中 $C = \\frac{16\\pi}{3(\\Delta g_v)^2}$ 是一个常数。\n\n对于形式为 $f(x) = ax^n$ 的函数，其相对不确定度的一阶传播由以下公式给出：\n$$\n\\frac{u(f)}{|f|} = |n| \\frac{u(x)}{|x|}\n$$\n在我们的例子中，$f = \\Delta G^*$，$x = \\gamma$，$n=3$。给定 $\\gamma$ 的相对不确定度为 $10\\%$，即 $\\frac{u(\\gamma)}{\\gamma} = 0.10$。\n因此，$\\Delta G^*$ 的相对不确定度为：\n$$\n\\frac{u(\\Delta G^*)}{\\Delta G^*} = 3 \\times \\frac{u(\\gamma)}{\\gamma} = 3 \\times 0.10 = 0.30\n$$\n绝对不确定度 $u(\\Delta G^*)$ 是计算出的 $\\Delta G^*$ 值的 $30\\%$：\n$$\nu(\\Delta G^*) = 0.30 \\times \\Delta G^* = 0.30 \\times (4.090615 \\times 10^{-19}\\,\\mathrm{J}) \\approx 1.227185 \\times 10^{-19}\\,\\mathrm{J}\n$$\n四舍五入到四位有效数字：\n$$\nu(\\Delta G^*) = 1.227 \\times 10^{-19}\\,\\mathrm{J}\n$$\n最终需要报告的结果是 $r^* = 0.6250\\,\\mathrm{nm}$，$\\Delta G^* = 4.091 \\times 10^{-19}\\,\\mathrm{J}$，以及 $u(\\Delta G^*) = 1.227 \\times 10^{-19}\\,\\mathrm{J}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6250  4.091 \\times 10^{-19}  1.227 \\times 10^{-19}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然经典成核理论提供了一个强大的理论框架，但其在实际中的应用常常涉及将其作为模型来解释来自实验或模拟的数据。本练习将让你扮演计算研究者的角色，任务是将经典成核理论的自由能模型与一组关于冰成核的假设性分子动力学数据进行拟合。通过这一过程，你将提取一个关键的物理参数——界面自由能（$\\gamma$），并学会如何对照独立方法验证你的发现，这是计算材料科学中的一个典型工作流程。",
            "id": "3437207",
            "problem": "给定过冷液态水的三个热力学状态点，在这些状态点上，通过分子动力学约束方法得到了可逆形成功，该功表示为作为晶簇尺寸函数的自由能剖面，记作 $\\Delta G(n)$。您的任务是从经典成核理论的基础出发，即晶核的总自由能包含体（体积）贡献和表面（界面）贡献，并且对于一个包含 $n$ 个分子的球形核，这些贡献分别与 $n$ 和表面积成比例。假设核是不可压缩的，具有恒定的分子体积和球形几何形状。仅使用这些基础和基本几何关系，推导出提取表征 $\\Delta G(n)$ 参数所需的函数形式，确定热力学临界尺寸 $n^\\*$，计算可逆势垒高度 $\\Delta G^\\* = \\Delta G(n^\\*)$，评估 Zeldovich 因子 $Z$，将表面项中出现的界面系数映射到物理固-液界面自由能 $\\gamma$（单位为 $\\mathrm{J/m^2}$），并验证独立提供的籽晶法推导的临界尺寸是否与 $\\Delta G(n)$ 分析一致。最后，评估籽晶法推导的 $\\gamma$ 值是否在不同温度下保持一致。\n\n本问题中所有自由能 $\\Delta G(n)$ 均以 $k_{\\mathrm{B}} T$ 为单位（无量纲），其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度（单位：开尔文）。\n\n使用以下常数和定义：\n- 玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380\\,649 \\times 10^{-23} \\ \\mathrm{J/K}$。\n- 每个水分子的分子体积 $v_{\\mathrm{m}} = 3.0 \\times 10^{-29} \\ \\mathrm{m^3}$。\n- 将面积与分子数量关联所需的球形几何因子为 $(36 \\pi)^{1/3}$。\n- 数据集以 $k_{\\mathrm{B}} T$ 为单位提供了作为 $n$ 函数的 $\\Delta G(n)$；每个分子的化学势驱动力 $\\Delta \\mu$ 以 $k_{\\mathrm{B}} T$ 为单位提供（无量纲）。您必须推导的经典成核理论模型将 $\\Delta G(n)$、$\\Delta \\mu$ 和一个通过几何形状和 $k_{\\mathrm{B}} T$ 与 $\\gamma$ 相关联的表面系数联系起来。\n\n对于每个状态点 $i \\in \\{1,2,3\\}$，给定：\n- 温度 $T_i$（单位：$\\mathrm{K}$）。\n- 驱动力 $\\Delta \\mu_i$（单位：$k_{\\mathrm{B}} T_i$，无量纲）。\n- 一组数据对 $(n, \\Delta G_i(n))$，其中 $n \\in \\{20,40,60,80,100,120,140,160,180,200\\}$，$\\Delta G_i(n)$ 以 $k_{\\mathrm{B}} T_i$ 为单位（无量纲）。\n- 通过籽晶模拟独立估算的临界尺寸 $n^{\\mathrm{seed}}_i$（无量纲）。\n\n您推导和实现的步骤必须：\n1. 从经典成核理论基础和球形几何出发，推导出一个适用于回归的形式，该形式使用与 $n$ 成比例的体积项和与核表面积成比例的表面项，来对每个状态点的给定数据 $\\{(n, \\Delta G(n))\\}$ 拟合控制 $\\Delta G(n)$ 的两个参数。使用无截距的线性最小二乘拟合来确定乘以体积和表面基函数的系数。\n2. 使用拟合得到的参数，计算热力学临界尺寸 $n^\\*_i$ 和势垒高度 $\\Delta G^\\*_i$。\n3. 使用您推导的基于 $\\Delta G(n)$ 在 $n^\\*_i$ 处曲率的连续介质表达式，计算每个状态点的 Zeldovich 因子 $Z_i$。\n4. 使用球形几何和基本常数，将拟合的表面系数映射到每个温度 $T_i$ 下的物理界面自由能 $\\gamma^{\\mathrm{fit}}_i$（单位：$\\mathrm{J/m^2}$）。\n5. 独立地，通过反演您推导的 $n^\\*$ 关系式，使用给定的 $\\Delta \\mu_i$ 和 $n^{\\mathrm{seed}}_i$，计算一个基于籽晶法的估算值 $\\gamma^{\\mathrm{seed}}_i$（单位：$\\mathrm{J/m^2}$）。\n6. 通过检查每个状态点是否满足 $|n^\\*_i - n^{\\mathrm{seed}}_i| \\le \\tau_n$（绝对容差 $\\tau_n = 3.0$）来验证临界尺寸。为每个状态点报告一个布尔值。\n7. 通过计算集合 $\\{\\gamma^{\\mathrm{seed}}_i\\}$ 的变异系数（总体标准差除以平均值）并检查其是否小于 $r_{\\mathrm{tol}} = 0.05$，来评估该集合在不同温度下是否一致。为三个状态点的集合报告一个最终的布尔值。\n\n数值数据（所有 $\\Delta G(n)$ 值均以 $k_{\\mathrm{B}} T$ 为单位，即无量纲）：\n\n状态点 1：\n- $T_1 = 235$ $\\mathrm{K}$，$\\Delta \\mu_1 = 0.50$。\n- $\\{(n,\\Delta G_1(n))\\}$:\n  - $(20, \\ 12.104)$\n  - $(40, \\ 15.118)$\n  - $(60, \\ 15.966)$\n  - $(80, \\ 15.716)$\n  - $(100, \\ 14.632)$\n  - $(120, \\ 12.999)$\n  - $(140, \\ 8.378)$\n  - $(160, \\ 8.476)$\n  - $(180, \\ 5.619)$\n  - $(200, \\ 2.600)$\n- 籽晶法临界尺寸：$n^{\\mathrm{seed}}_1 = 64.00$。\n\n状态点 2：\n- $T_2 = 240$ $\\mathrm{K}$，$\\Delta \\mu_2 = 0.45$。\n- $\\{(n,\\Delta G_2(n))\\}$:\n  - $(20, \\ 12.3672)$\n  - $(40, \\ 15.9474)$\n  - $(60, \\ 17.4338)$\n  - $(80, \\ 17.8588)$\n  - $(100, \\ 17.4776)$\n  - $(120, \\ 16.5657)$\n  - $(140, \\ 12.7654)$\n  - $(160, \\ 13.5268)$\n  - $(180, \\ 11.4317)$\n  - $(200, \\ 9.1800)$\n- 籽晶法临界尺寸：$n^{\\mathrm{seed}}_2 = 79.34$。\n\n状态点 3：\n- $T_3 = 245$ $\\mathrm{K}$，$\\Delta \\mu_3 = 0.40$。\n- $\\{(n,\\Delta G_3(n))\\}$:\n  - $(20, \\ 12.6304)$\n  - $(40, \\ 16.7768)$\n  - $(60, \\ 18.9016)$\n  - $(80, \\ 20.0016)$\n  - $(100, \\ 20.3232)$\n  - $(120, \\ 20.1324)$\n  - $(140, \\ 17.1528)$\n  - $(160, \\ 18.5776)$\n  - $(180, \\ 17.2444)$\n  - $(200, \\ 15.7600)$\n- 籽晶法临界尺寸：$n^{\\mathrm{seed}}_3 = 101.63$。\n\n数值和输出要求：\n- 以 $\\mathrm{J/m^2}$ 为单位表示 $\\gamma$。\n- 使用 $n^\\*$ 和 $n^{\\mathrm{seed}}$ 作为无量纲计数。\n- 使用 $\\Delta G^\\*$ 以 $k_{\\mathrm{B}} T$ 为单位（无量纲）。\n- 本问题不涉及角度单位。\n- 舍入和格式化：\n  - 报告 $n^\\*$，四舍五入到 $2$ 位小数。\n  - 报告 $\\Delta G^\\*$，四舍五入到 $3$ 位小数。\n  - 报告 $Z$，四舍五入到 $4$ 位小数。\n  - 报告 $\\gamma^{\\mathrm{fit}}$ 和 $\\gamma^{\\mathrm{seed}}$，以 $\\mathrm{J/m^2}$ 为单位，四舍五入到 $6$ 位小数。\n  - 报告 $n^{\\mathrm{seed}}$，四舍五入到 $2$ 位小数。\n  - 验证布尔值必须是字面布尔值。\n- 最终输出格式：\n  - 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。前三个元素对应三个状态点；每个元素本身都是一个列表，按以下顺序包含以下字段：\n    - $n^\\*$,\n    - $\\Delta G^\\*$,\n    - $Z$,\n    - $\\gamma^{\\mathrm{fit}}$（单位：$\\mathrm{J/m^2}$）,\n    - $n^{\\mathrm{seed}}$,\n    - $\\gamma^{\\mathrm{seed}}$（单位：$\\mathrm{J/m^2}$）,\n    -一个指示 $|n^\\* - n^{\\mathrm{seed}}| \\le \\tau_n$ 是否成立的布尔值。\n  - 顶级列表的最后一个元素是一个布尔值，指示 $\\{\\gamma^{\\mathrm{seed}}_i\\}_{i=1}^3$ 的变异系数是否小于 $r_{\\mathrm{tol}}$。\n  - 例如，整体打印结构必须是 $[[\\dots],[\\dots],[\\dots],True]$ 的形式，不含空格。\n\n覆盖率测试套件摘要：\n- 状态点 1 提供了一个具有中等势垒和临界尺寸接近所提供 $n$ 范围中心的“理想路径”。\n- 状态点 2 检查对稍小驱动力的敏感性，并测试当势垒更宽时的拟合稳定性。\n- 状态点 3 探索了一个驱动力更小、 $n^\\*$ 更大的边界情况，测试了基于曲率的 $Z$ 计算和到 $\\gamma$ 映射的数值稳定性。",
            "solution": "该问题被认为是有效的，因为它科学上基于经典成核理论，问题明确、客观且自洽。所有必要的数据、常数和步骤都已提供，足以推导和计算出唯一且可验证的解。我们将首先推导必要的理论表达式，然后将它们应用于所提供的三个状态点的数据。\n\n### 1. 用于回归的经典成核理论 (CNT) 模型的推导\n\n根据经典成核理论，从母液相中形成一个包含 $n$ 个分子的晶核的吉布斯自由能变 $\\Delta G(n)$ 是体自由能项和表面自由能项之和：\n$$\n\\Delta G(n) = \\Delta G_{\\text{bulk}}(n) + \\Delta G_{\\text{surface}}(n)\n$$\n体项与分子数 $n$ 以及固相和液相之间的单位分子化学势差 $\\Delta \\mu_{\\text{phys}}$ 成正比。为使成核有利，固相必须更稳定，因此 $\\Delta \\mu_{\\text{phys}}  0$。体项为：\n$$\n\\Delta G_{\\text{bulk}}(n) = n \\Delta \\mu_{\\text{phys}} = -n |\\Delta \\mu_{\\text{phys}}|\n$$\n表面项与核的表面积 $A(n)$ 和固-液界面自由能 $\\gamma$ 成正比：\n$$\n\\Delta G_{\\text{surface}}(n) = A(n) \\gamma\n$$\n假设一个由不可压缩分子组成的球形核，每个分子的体积为 $v_m$，则总体积为 $V = n v_m$。核的半径 $r$ 由 $V = \\frac{4}{3}\\pi r^3$ 给出，从而得到：\n$$\nr(n) = \\left( \\frac{3 n v_m}{4 \\pi} \\right)^{1/3}\n$$\n表面积 $A(n) = 4\\pi r(n)^2$ 可以表示为 $n$ 的函数：\n$$\nA(n) = 4\\pi \\left( \\left( \\frac{3 v_m}{4 \\pi} \\right)^{1/3} n^{1/3} \\right)^2 = 4\\pi \\left( \\frac{3 v_m}{4 \\pi} \\right)^{2/3} n^{2/3} = (4\\pi)^{1/3} (3v_m)^{2/3} n^{2/3} = (36 \\pi v_m^2)^{1/3} n^{2/3}\n$$\n问题通过用 $k_{\\mathrm{B}} T$ 对能量进行归一化，以无量纲形式提供了数据和参数。将完整的 $\\Delta G(n)$ 表达式除以 $k_{\\mathrm{B}} T$：\n$$\n\\frac{\\Delta G(n)}{k_{\\mathrm{B}} T} = -n \\frac{|\\Delta \\mu_{\\text{phys}}|}{k_{\\mathrm{B}} T} + \\frac{(36 \\pi v_m^2)^{1/3} \\gamma}{k_{\\mathrm{B}} T} n^{2/3}\n$$\n我们定义两个通过拟合确定的无量纲参数 $a$ 和 $b$：\n-   $a = \\frac{|\\Delta \\mu_{\\text{phys}}|}{k_{\\mathrm{B}} T}$ (无量纲驱动力)\n-   $b = \\frac{(36 \\pi v_m^2)^{1/3} \\gamma}{k_{\\mathrm{B}} T}$ (无量纲表面能系数)\n\n因此，用于拟合所提供的无量纲 $\\Delta G(n)$ 数据的 CNT 模型为：\n$$\n\\Delta G_{\\text{fit}}(n) = -a n + b n^{2/3}\n$$\n该方程对系数 $a$ 和 $b$ 是线性的。给定一组数据点 $(n_j, \\Delta G(n_j))$，我们可以使用基函数 $f_1(n) = -n$ 和 $f_2(n) = n^{2/3}$ 且无截距的线性最小二乘回归来确定最佳拟合参数 $\\hat{a}$ 和 $\\hat{b}$。\n\n### 2. 临界性质的计算\n\n临界核尺寸 $n^\\*$ 对应于自由能剖面的最大值，通过将 $\\Delta G_{\\text{fit}}(n)$ 对 $n$ 的一阶导数设为零来找到：\n$$\n\\frac{d(\\Delta G_{\\text{fit}}(n))}{dn} = -\\hat{a} + \\frac{2}{3}\\hat{b}n^{-1/3} = 0 \\implies n^\\* = \\left(\\frac{2\\hat{b}}{3\\hat{a}}\\right)^3\n$$\n成核势垒高度 $\\Delta G^\\*$ 是在临界尺寸处评估的自由能，即 $\\Delta G_{\\text{fit}}(n^\\*)$：\n$$\n\\Delta G^\\* = -\\hat{a}n^\\* + \\hat{b}(n^\\*)^{2/3} = -\\hat{a}\\left(\\frac{2\\hat{b}}{3\\hat{a}}\\right)^3 + \\hat{b}\\left(\\frac{2\\hat{b}}{3\\hat{a}}\\right)^2 = \\frac{4\\hat{b}^3}{27\\hat{a}^2}\n$$\n\n### 3. Zeldovich 因子\n\nZeldovich 因子 $Z$ 表征了自由能垒顶部的曲率。当 $\\Delta G(n)$ 以 $k_{\\mathrm{B}} T$ 为单位时，它由以下公式给出：\n$$\nZ = \\left( -\\frac{1}{2\\pi} \\frac{d^2(\\Delta G_{\\text{fit}}(n))}{dn^2} \\bigg|_{n=n^\\*} \\right)^{1/2}\n$$\n二阶导数为：\n$$\n\\frac{d^2(\\Delta G_{\\text{fit}}(n))}{dn^2} = -\\frac{2}{9}\\hat{b}n^{-4/3}\n$$\n在 $n=n^\\*$ 处评估：\n$$\n\\frac{d^2(\\Delta G_{\\text{fit}}(n^\\*))}{dn^2} = -\\frac{2}{9}\\hat{b}(n^\\*)^{-4/3} = -\\frac{2}{9}\\hat{b}\\left(\\left(\\frac{2\\hat{b}}{3\\hat{a}}\\right)^3\\right)^{-4/3} = -\\frac{9\\hat{a}^4}{8\\hat{b}^3}\n$$\n代入 $Z$ 的表达式：\n$$\nZ = \\left( -\\frac{1}{2\\pi} \\left( -\\frac{9\\hat{a}^4}{8\\hat{b}^3} \\right) \\right)^{1/2} = \\frac{3\\hat{a}^2}{4\\sqrt{\\pi}\\hat{b}^{3/2}}\n$$\n\n### 4. 映射到物理界面自由能 $\\gamma$\n\n对于每个状态点 $i$，拟合的无量纲表面系数 $\\hat{b}_i$ 可以使用 $b$ 的定义映射到物理界面自由能 $\\gamma_i^{\\mathrm{fit}}$：\n$$\n\\hat{b}_i = \\frac{(36 \\pi v_m^2)^{1/3} \\gamma_i^{\\mathrm{fit}}}{k_{\\mathrm{B}} T_i} \\implies \\gamma_i^{\\mathrm{fit}} = \\frac{\\hat{b}_i k_{\\mathrm{B}} T_i}{(36 \\pi v_m^2)^{1/3}}\n$$\n\n### 5. 从籽晶数据独立计算 $\\gamma$\n\n通过反演 $n^\\*$ 的 CNT 表达式，使用提供的籽晶法推导的临界尺寸 $n_i^{\\mathrm{seed}}$ 和驱动力 $\\Delta \\mu_i$，可以计算出独立的估算值 $\\gamma_i^{\\mathrm{seed}}$：\n$$\nn_i^{\\mathrm{seed}} = \\left(\\frac{2 b_i}{3 a_i}\\right)^3\n$$\n这里，我们使用给定的 $a_i = \\Delta \\mu_i$ 来求解相应的 $b_i$，我们称之为 $b_i^{\\mathrm{seed}}$：\n$$\nb_i^{\\mathrm{seed}} = \\frac{3 \\Delta \\mu_i (n_i^{\\mathrm{seed}})^{1/3}}{2}\n$$\n然后我们将 $b_i^{\\mathrm{seed}}$ 映射到 $\\gamma_i^{\\mathrm{seed}}$：\n$$\n\\gamma_i^{\\mathrm{seed}} = \\frac{b_i^{\\mathrm{seed}} k_{\\mathrm{B}} T_i}{(36 \\pi v_m^2)^{1/3}} = \\frac{3 \\Delta \\mu_i (n_i^{\\mathrm{seed}})^{1/3} k_{\\mathrm{B}} T_i}{2(36 \\pi)^{1/3} v_m^{2/3}}\n$$\n\n### 6. 验证和一致性检查\n\n最后，将按规定执行两个验证检查：\n1.  **临界尺寸验证**：对于每个状态点 $i$，我们检查是否 $|n^\\*_i - n^{\\mathrm{seed}}_i| \\le \\tau_n$，其中容差为 $\\tau_n = 3.0$。\n2.  **$\\gamma^{\\mathrm{seed}}$ 一致性**：我们计算集合 $\\{\\gamma_1^{\\mathrm{seed}}, \\gamma_2^{\\mathrm{seed}}, \\gamma_3^{\\mathrm{seed}}\\}$ 的变异系数 (CV)，即总体标准差除以平均值。然后检查此 CV 是否小于容差 $r_{\\mathrm{tol}} = 0.05$。\n\n以下实现对给定的三个状态点执行这些步骤。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the classical nucleation theory problem based on the provided data.\n    \"\"\"\n    # Constants and definitions\n    KB = 1.380649e-23  # Boltzmann constant in J/K\n    VM = 3.0e-29       # Molecular volume in m^3\n    TAU_N = 3.0        # Tolerance for critical size validation\n    R_TOL = 0.05       # Tolerance for gamma consistency\n\n    # State point data\n    state_points = [\n        {\n            \"T\": 235, \"delta_mu\": 0.50, \"ns_seed\": 64.00,\n            \"data\": np.array([\n                (20, 12.104), (40, 15.118), (60, 15.966), (80, 15.716),\n                (100, 14.632), (120, 12.999), (140, 8.378), (160, 8.476),\n                (180, 5.619), (200, 2.600)\n            ])\n        },\n        {\n            \"T\": 240, \"delta_mu\": 0.45, \"ns_seed\": 79.34,\n            \"data\": np.array([\n                (20, 12.3672), (40, 15.9474), (60, 17.4338), (80, 17.8588),\n                (100, 17.4776), (120, 16.5657), (140, 12.7654), (160, 13.5268),\n                (180, 11.4317), (200, 9.1800)\n            ])\n        },\n        {\n            \"T\": 245, \"delta_mu\": 0.40, \"ns_seed\": 101.63,\n            \"data\": np.array([\n                (20, 12.6304), (40, 16.7768), (60, 18.9016), (80, 20.0016),\n                (100, 20.3232), (120, 20.1324), (140, 17.1528), (160, 18.5776),\n                (180, 17.2444), (200, 15.7600)\n            ])\n        }\n    ]\n\n    all_results = []\n    gamma_seed_values = []\n\n    for sp in state_points:\n        T = sp[\"T\"]\n        delta_mu_given = sp[\"delta_mu\"]\n        ns_seed = sp[\"ns_seed\"]\n        n_data = sp[\"data\"][:, 0]\n        delta_g_data = sp[\"data\"][:, 1]\n\n        # 1. Linear least squares fit for a and b\n        # Model: dG = -a*n + b*n^(2/3)\n        # We solve y = A * x where y=dG, A = [-n, n^(2/3)], x = [a, b]^T\n        A = np.vstack([-n_data, n_data**(2.0/3.0)]).T\n        coeffs, _, _, _ = np.linalg.lstsq(A, delta_g_data, rcond=None)\n        a_fit, b_fit = coeffs[0], coeffs[1]\n\n        # 2. Compute n*, dG_star\n        n_star = (2 * b_fit / (3 * a_fit))**3\n        delta_g_star = (4 * b_fit**3) / (27 * a_fit**2)\n\n        # 3. Compute Zeldovich factor Z\n        z_factor = (3 * a_fit**2) / (4 * np.sqrt(np.pi) * b_fit**(3.0/2.0))\n\n        # 4. Compute gamma_fit\n        # b_fit = (36*pi*vm^2)^(1/3) * gamma_fit / (k_B*T)\n        geom_factor = (36 * np.pi * VM**2)**(1.0/3.0)\n        gamma_fit = (b_fit * KB * T) / geom_factor\n        \n        # 5. Compute gamma_seed\n        # Invert n_star = (2b/3a)^3 using given delta_mu and ns_seed\n        # First find b_seed\n        b_seed = (3 * delta_mu_given * ns_seed**(1.0/3.0)) / 2\n        gamma_seed = (b_seed * KB * T) / geom_factor\n        gamma_seed_values.append(gamma_seed)\n\n        # 6. Validate critical size\n        n_star_validation = abs(n_star - ns_seed) = TAU_N\n        \n        # Assemble results for this state point\n        sp_results = [\n            round(n_star, 2),\n            round(delta_g_star, 3),\n            round(z_factor, 4),\n            round(gamma_fit, 6),\n            round(ns_seed, 2),\n            round(gamma_seed, 6),\n            n_star_validation\n        ]\n        all_results.append(sp_results)\n\n    # 7. Assess gamma_seed consistency\n    gamma_seed_np = np.array(gamma_seed_values)\n    mean_gamma_seed = np.mean(gamma_seed_np)\n    std_dev_gamma_seed = np.std(gamma_seed_np, ddof=0) # Population standard deviation\n    coeff_of_variation = std_dev_gamma_seed / mean_gamma_seed\n    gamma_consistency = coeff_of_variation  R_TOL\n    \n    all_results.append(gamma_consistency)\n\n    # Final print statement\n    result_str = \",\".join([f\"[{','.join(map(str, r))}]\" if isinstance(r, list) else str(r) for r in all_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "超越静态的自由能形貌，许多成核研究的最终目标是量化稳定核形成的动力学速率（$J$）。这项高级练习将向你介绍前向通量采样（Forward-Flux Sampling, FFS），这是一种为有效模拟此类稀有事件并直接测量其速率而设计的强大计算技术。你不仅将根据原始 FFS 数据计算成核速率，还将学习如何构建具有统计严谨性的置信区间，这是报告可靠计算测量结果的关键步骤。",
            "id": "3437239",
            "problem": "要求您设计并实现一个完整的计算程序，以使用前向通量采样（FFS）估算成核速率，并构建具有统计学依据的置信区间。背景设定为经典成核理论（CNT），其中成核速率定义为单位时间单位体积内成功成核事件的期望数。\n\n请从以下基础出发：\n- 在CNT中，成核速率 $J$ 是指从亚稳盆到稳相的成功转变在单位时间单位体积内的期望数。\n- 在FFS中，一个序参量 $\\lambda$ 定义了亚稳盆和稳相之间的嵌套界面 $\\lambda_0  \\lambda_1  \\cdots  \\lambda_K$。亚稳盆对应于 $\\lambda  \\lambda_0$，成功成核对应于到达 $\\lambda_K$ 而不返回亚稳盆。\n- 当事件稀有且无记忆时，从亚稳盆穿越第一个界面的过程可以建模为时间上的泊松过程。\n- 给定穿越了界面 $\\lambda_i$ 的情况下，从该界面 $\\lambda_i$ 到 $\\lambda_{i+1}$ 的条件性前进可以建模为独立的伯努利试验，从而为穿越概率生成二项数据。\n- 泊松过程的总暴露量是观测时间和采样体积的乘积。\n\n您的任务是：\n1.  从这些基本原则出发，推导出一个逻辑上有效的表达式，该表达式用可测量的穿过 $\\lambda_0$ 的通量和一系列连续界面之间的条件穿越概率来表示 $J$。从陈述的基础出发，论证每一步推断，不使用任何捷径公式或预先给定的目标表达式。\n2.  提出一种为 $J$ 构建双边置信区间的方法，总体覆盖水平为 $1 - \\alpha$，其中 $\\alpha = 0.05$。该方法需结合通量测量和穿越概率的不确定性。您的区间构建必须：\n    -   基于观测到的计数值和总暴露量，对穿过 $\\lambda_0$ 的泊松率使用精确的双边置信区间。\n    -   对连续界面之间每次条件穿越的二项比例使用精确的双边置信区间。\n    -   使用一种原则性的多重比较方法来分配 $\\alpha$，将各分量区间组合成 $J$ 的总体区间，以确保总体覆盖水平至少为 $1 - \\alpha$，且不假设任何特殊情况的简化。\n3.  实现一个程序，对于下面提供的每个测试用例，计算：\n    -   基于观测到的通量和穿越比例的点估计 $\\hat{J}$。\n    -   一个总体覆盖水平为 $0.95$ 的双边置信区间 $[J_{\\mathrm{low}}, J_{\\mathrm{up}}]$，单位为“事件数/纳秒/立方纳米”（写作“per ns per nm$^3$”）。\n    程序不得要求任何输入，并且必须将所有测试用例的汇总结果打印在单行上，形式为由方括号括起来的逗号分隔列表，其中每个测试用例表示为一个包含三个浮点数的列表 $[\\hat{J}, J_{\\mathrm{low}}, J_{\\mathrm{up}}]$。\n\n统计构建和单位的规范：\n- 通量测量由在观测时间 $T$ 和采样体积 $V$ 内观测到的穿过 $\\lambda_0$ 的穿越次数 $C_0$ 给出。单位时间单位体积的通量定义为 $C_0$ 除以总暴露量 $T \\times V$。请以“per ns per nm$^3$”为单位表示 $J$。\n- 对每个暴露量 $T \\times V$ 中 $C_0$ 个事件的泊松率，使用精确的双边区间。\n- 对于每个界面 $i$，基于 $N_i$ 次试验中的 $S_i$ 次成功，对二项比例 $p_i$ 使用精确的双边区间。\n- 使用一种原则性的多重比较方法，在通量和所有穿越概率分量之间分配 $\\alpha$，使得 $J$ 的组合区间的总体覆盖水平至少为 $0.95$。\n- 您的程序必须计算并输出点估计和区间作为原始浮点数。不要在输出中包含单位；单位已在本问题陈述中指定。\n\n参数值测试套件：\n- 案例A（一般情况）：$V = 1000$ nm$^3$，$T = 500$ ns，$C_0 = 120$，$K = 3$，$(N_1,N_2,N_3) = (200,150,100)$，$(S_1,S_2,S_3) = (60,45,20)$。\n- 案例B（最后一个界面成功次数为零的边界情况）：$V = 10000$ nm$^3$，$T = 1000$ ns，$C_0 = 300$，$K = 3$，$(N_1,N_2,N_3) = (100,50,20)$，$(S_1,S_2,S_3) = (40,10,0)$。\n- 案例C（小通量下接近确定性的穿越）：$V = 500$ nm$^3$，$T = 100$ ns，$C_0 = 3$，$K = 2$，$(N_1,N_2) = (10,10)$，$(S_1,S_2) = (10,10)$。\n- 案例D（通量计数为零）：$V = 2000$ nm$^3$，$T = 200$ ns，$C_0 = 0$，$K = 3$，$(N_1,N_2,N_3) = (50,50,50)$，$(S_1,S_2,S_3) = (25,10,5)$。\n- 案例E（大计数和多样的概率）：$V = 750$ nm$^3$，$T = 1000$ ns，$C_0 = 5000$，$K = 4$，$(N_1,N_2,N_3,N_4) = (1000,1000,1000,1000)$，$(S_1,S_2,S_3,S_4) = (900,500,100,20)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个测试用例一个条目，每个条目是一个包含三个浮点数的列表，代表该案例的 $[\\hat{J}, J_{\\mathrm{low}}, J_{\\mathrm{up}}]$。例如：“[[0.00123,0.00085,0.00180],[...],...]”。",
            "solution": "估算成核速率 $J$ 及其在前向通量采样（FFS）数据下的置信区间的问题，可通过首先从基本原理推导 $J$ 的表达式，然后通过组合FFS过程中所有随机步骤的不确定性来构建统计上严谨的置信区间来解决。\n\n### 步骤 1：成核速率表达式的推导\n\n成核速率 $J$ 被定义为单位时间单位体积内成功成核事件的期望数。在FFS的背景下，一个成功事件是指一条轨迹起源于亚稳盆（$\\lambda  \\lambda_0$），穿过第一个界面 $\\lambda_0$，随后到达最终界面 $\\lambda_K$ 而不返回亚稳盆。\n\n令 $\\Phi_0$ 为穿过第一个界面 $\\lambda_0$ 的通量，定义为单位时间和单位体积内的穿越速率。令 $P(\\lambda_K | \\lambda_0)$ 为一条轨迹在刚刚穿过 $\\lambda_0$ 后成功到达 $\\lambda_K$ 的条件概率。成功事件的总速率 $J$ 是初始通量与成功概率的乘积：\n$$J = \\Phi_0 \\times P(\\lambda_K | \\lambda_0)$$\n\nFFS方法依赖于一系列界面 $\\lambda_0  \\lambda_1  \\cdots  \\lambda_K$。概率 $P(\\lambda_K | \\lambda_0)$ 可以使用概率的链式法则进行分解。一条轨迹从 $\\lambda_0$ 到达 $\\lambda_K$ 是通过相继穿过每个中间界面来实现的。令 $E_i$ 为到达界面 $\\lambda_i$ 的事件。成功概率为 $P(E_K | E_0)$。\n$$P(E_K | E_0) = P(E_1 | E_0) \\times P(E_2 | E_1, E_0) \\times \\cdots \\times P(E_K | E_{K-1}, \\dots, E_0)$$\n\n问题陈述指出，界面之间的条件性前进被建模为独立的伯努利试验。这意味着一种无记忆性或马尔可夫性质，即从 $\\lambda_i$ 前进到 $\\lambda_{i+1}$ 的概率仅取决于系统在 $\\lambda_i$ 时的状态，而与其之前的历史无关。因此，$P(E_{i+1} | E_i, \\dots, E_0) = P(E_{i+1} | E_i)$。我们定义从界面 $\\lambda_{i-1}$ 到 $\\lambda_i$ 的条件穿越概率为 $p_i = P(E_i | E_{i-1})$，其中 $i=1, \\dots, K$。链式法则简化为这些独立概率的乘积：\n$$P(\\lambda_K | \\lambda_0) = P(E_1 | E_0) \\times P(E_2 | E_1) \\times \\cdots \\times P(E_K | E_{K-1}) = \\prod_{i=1}^{K} p_i$$\n\n将此代入 $J$ 的表达式中，我们得到了以可测量的FFS量表示的成核速率的完整表达式：\n$$J = \\Phi_0 \\prod_{i=1}^{K} p_i$$\n\n### 步骤 2：点估计\n\n$J$ 的点估计，记为 $\\hat{J}$，由其构成参数的点估计构建而成。\n1.  通量 $\\Phi_0$ 是根据在总体积 $V$ 中、总时间 $T$ 内观测到 $C_0$ 次穿越 $\\lambda_0$ 的事件来估计的。总暴露量为 $E = T \\times V$。通量的估计量为：\n    $$\\hat{\\Phi}_0 = \\frac{C_0}{T \\times V}$$\n2.  每个条件概率 $p_i$ 是根据从 $\\lambda_{i-1}$ 开始的 $N_i$ 次试验中，有 $S_i$ 次成功前进到 $\\lambda_i$ 来估计的。这个二项比例的估计量为：\n    $$\\hat{p}_i = \\frac{S_i}{N_i}$$\n\n结合这些，成核速率的点估计为：\n$$\\hat{J} = \\frac{C_0}{T \\times V} \\prod_{i=1}^{K} \\frac{S_i}{N_i}$$\n\n### 步骤 3：置信区间的构建\n\n要求为 $J$ 构建一个总体覆盖水平为 $1 - \\alpha$ 的双边置信区间。速率 $J$ 是 $K+1$ 个独立估计参数的乘积：通量 $\\Phi_0$ 和 $K$ 个概率 $p_1, \\dots, p_K$。为确保总体覆盖水平，我们使用Bonferroni校正，这是一种用于多重比较的原则性方法。\n\n总显著性水平 $\\alpha$ 被分配给 $m = K+1$ 个参数。每个参数的置信区间将在更严格的置信水平 $1 - \\alpha'$ 下构建，其中 $\\alpha' = \\alpha / m$。令 $[L_0, U_0]$ 为 $\\Phi_0$ 的 $(1 - \\alpha')$ 置信区间，$[L_i, U_i]$ 为每个 $p_i$ 的 $(1 - \\alpha')$ 置信区间。由于 $J$ 是非负量的乘积，组合置信区间 $[J_{\\mathrm{low}}, J_{\\mathrm{up}}]$ 通过将各个区间的相应下界和上界相乘来构建：\n$$J_{\\mathrm{low}} = L_0 \\prod_{i=1}^{K} L_i$$\n$$J_{\\mathrm{up}} = U_0 \\prod_{i=1}^{K} U_i$$\n\n这种构建方法保证了总体置信水平至少为 $1 - \\alpha$。\n\n#### 3.1. 泊松率 $\\Phi_0$ 的精确置信区间\n\n在总暴露量 $E = T \\times V$ 中，初始穿越次数 $C_0$ 服从均值为 $\\mu = \\Phi_0 \\times E$ 的泊松分布。我们首先根据观测值 $C_0$ 找到 $\\mu$ 的一个精确的 $(1 - \\alpha')$ 置信区间。该区间，称为Garwood区间，基于泊松分布和卡方($\\chi^2$)分布之间的关系。\n$\\mu$ 的下界和上界为：\n$$\\mu_{\\mathrm{low}} = \\frac{1}{2} \\chi^2_{2C_0}\\left(\\frac{\\alpha'}{2}\\right)$$\n$$\\mu_{\\mathrm{up}} = \\frac{1}{2} \\chi^2_{2(C_0+1)}\\left(1 - \\frac{\\alpha'}{2}\\right)$$\n其中 $\\chi^2_{\\nu}(q)$ 是具有 $\\nu$ 个自由度的卡方分布的 $q$-分位数。对于 $C_0=0$ 的特殊情况，$\\mu_{\\mathrm{low}} = 0$。\n然后，通过除以暴露量 $E$ 得到速率 $\\Phi_0$ 的置信区间：\n$$[L_0, U_0] = \\left[\\frac{\\mu_{\\mathrm{low}}}{E}, \\frac{\\mu_{\\mathrm{up}}}{E}\\right]$$\n\n#### 3.2. 二项比例 $p_i$ 的精确置信区间\n\n对于每个条件概率 $p_i$，我们在 $N_i$ 次试验中有 $S_i$ 次成功。二项比例 $p_i$ 的一个精确的 $(1 - \\alpha')$ 置信区间由Clopper-Pearson区间给出。该区间通过反演两个单边二项检验推导得出，并可以用Beta分布的分位数来表示。\n$p_i$ 的下界和上界为：\n$$L_i = \\mathrm{Beta}\\left(\\frac{\\alpha'}{2}; S_i, N_i - S_i + 1\\right)$$\n$$U_i = \\mathrm{Beta}\\left(1 - \\frac{\\alpha'}{2}; S_i + 1, N_i - S_i\\right)$$\n其中 $\\mathrm{Beta}(q; a, b)$ 是具有形状参数 $a$ 和 $b$ 的Beta分布的 $q$-分位数。\n特殊情况处理如下：\n- 如果 $S_i = 0$，则下界 $L_i = 0$。\n- 如果 $S_i = N_i$，则上界 $U_i = 1$。\n\n通过计算这些单独的区间并如上所述组合它们的界限，我们为成核速率 $J$ 的合理值范围得到了一个统计上合理的估计。指定的总体覆盖水平 $0.95$ 对应于 $\\alpha = 0.05$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2, beta\n\ndef solve():\n    \"\"\"\n    Main function to compute nucleation rates and confidence intervals for all test cases.\n    \"\"\"\n    # Test suite of parameter values\n    # Each case: (V, T, C0, K, N_tuple, S_tuple)\n    # V: volume (nm^3)\n    # T: time (ns)\n    # C0: initial flux count\n    # K: number of subsequent interfaces\n    # N_tuple: tuple of trial counts (N1, N2, ...)\n    # S_tuple: tuple of success counts (S1, S2, ...)\n    test_cases = [\n        # Case A: general case\n        (1000, 500, 120, 3, (200, 150, 100), (60, 45, 20)),\n        # Case B: edge case with zero successes on last interface\n        (10000, 1000, 300, 3, (100, 50, 20), (40, 10, 0)),\n        # Case C: near-deterministic crossings with small flux\n        (500, 100, 3, 2, (10, 10), (10, 10)),\n        # Case D: zero flux count\n        (2000, 200, 0, 3, (50, 50, 50), (25, 10, 5)),\n        # Case E: large counts and diverse probabilities\n        (750, 1000, 5000, 4, (1000, 1000, 1000, 1000), (900, 500, 100, 20)),\n    ]\n\n    results = []\n    for case in test_cases:\n        V, T, C0, K, N_arr, S_arr = case\n        result_tuple = calculate_j_and_ci(V, T, C0, K, N_arr, S_arr)\n        results.append(list(result_tuple))\n\n    # Print the aggregated results in the specified format without spaces\n    print(f\"[{','.join([f'[{r[0]},{r[1]},{r[2]}]' for r in results])}]\")\n\ndef calculate_j_and_ci(V, T, C0, K, N_arr, S_arr, alpha=0.05):\n    \"\"\"\n    Calculates the point estimate and confidence interval for the nucleation rate J.\n\n    Args:\n        V (float): Sampling volume in nm^3.\n        T (float): Observation time in ns.\n        C0 (int): Observed crossing count for the first interface.\n        K (int): Number of subsequent interfaces (len(N_arr)).\n        N_arr (tuple): Tuple of trial counts for each interface.\n        S_arr (tuple): Tuple of success counts for each interface.\n        alpha (float): Overall significance level for the confidence interval.\n\n    Returns:\n        tuple: (J_hat, J_low, J_up) for the nucleation rate.\n    \"\"\"\n    # Total exposure\n    exposure = V * T\n\n    # --- Point Estimate ---\n    if exposure == 0:\n        phi0_hat = 0.0\n    else:\n        phi0_hat = C0 / exposure\n    \n    p_hat_prod = 1.0\n    for S, N in zip(S_arr, N_arr):\n        if N == 0:\n             # This case should not happen with valid inputs but good practice to handle.\n            p_hat_prod = 0.0\n            break\n        p_hat_prod *= S / N\n    \n    J_hat = phi0_hat * p_hat_prod\n\n    # --- Confidence Interval ---\n    # Bonferroni correction for multiple comparisons\n    # There are K+1 parameters: one for the flux, K for the probabilities\n    m = K + 1\n    alpha_prime = alpha / m\n\n    # 1. Confidence interval for the flux rate phi0\n    if exposure == 0:\n        phi0_L, phi0_U = 0.0, float('inf')\n    else:\n        # Exact interval for Poisson mean mu = phi0 * exposure\n        if C0 == 0:\n            mu_L = 0.0\n        else:\n            mu_L = 0.5 * chi2.ppf(alpha_prime / 2, 2 * C0)\n        \n        mu_U = 0.5 * chi2.ppf(1 - alpha_prime / 2, 2 * (C0 + 1))\n        \n        phi0_L = mu_L / exposure\n        phi0_U = mu_U / exposure\n\n    # 2. Confidence intervals for the product of probabilities\n    p_prod_L = 1.0\n    p_prod_U = 1.0\n\n    for S, N in zip(S_arr, N_arr):\n        # Exact Clopper-Pearson interval for binomial proportion p\n        if S == 0:\n            p_L = 0.0\n        else:\n            p_L = beta.ppf(alpha_prime / 2, S, N - S + 1)\n        \n        if S == N:\n            p_U = 1.0\n        else:\n            p_U = beta.ppf(1 - alpha_prime / 2, S + 1, N - S)\n        \n        p_prod_L *= p_L\n        p_prod_U *= p_U\n        \n    # 3. Combine intervals for the final J interval\n    J_low = phi0_L * p_prod_L\n    J_up = phi0_U * p_prod_U\n\n    return J_hat, J_low, J_up\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}