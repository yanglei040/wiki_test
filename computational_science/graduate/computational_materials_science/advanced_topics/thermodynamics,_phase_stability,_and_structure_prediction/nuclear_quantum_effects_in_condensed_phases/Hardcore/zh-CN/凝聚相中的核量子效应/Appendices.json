{
    "hands_on_practices": [
        {
            "introduction": "我们将从量子力学中最简单但最重要的模型之一——谐振子——开始。该模型是理解和计算核量子效应的基础基准。本练习将在最简洁的背景下介绍路径积分形式，并演示如何计算动能和势能等关键量子可观测量。通过这个练习，你将建立一个基准，理解与经典图像相比，量子力学如何改变能量的分配。",
            "id": "3430032",
            "problem": "凝聚相中的一维核自由度通常可以局域地近似为一个谐波环境，其势能为 $V(q)=\\frac{1}{2}k q^{2}$，其中 $q$ 是核坐标，$k$ 是有效弹簧常数，核质量为 $m$。在路径积分分子动力学 (PIMD) 中，核量子效应由一个经典同构系统表示，该系统包含 $P$ 个由频率为 $\\omega_{P}=\\frac{P}{\\beta \\hbar}$ 的谐波弹簧连接的珠子，其中 $\\beta=\\frac{1}{k_{\\mathrm{B}}T}$，$T$ 是温度，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\hbar$ 是约化普朗克常数。量子动能的质心维里估计量源于应用于环形聚合物表示的维里定理，它在有限 $P$ 值下提供了一个无偏估计量，并在 $P \\to \\infty$ 时收敛到精确的量子动能。\n\n从具有哈密顿量 $\\hat{H}=\\frac{\\hat{p}^{2}}{2m}+V(\\hat{q})$ 的一维单个粒子的正则配分函数 $Z=\\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ 出发，利用路径积分表示和环形聚合物同构中的维里定理，推导在谐波势 $V(q)=\\frac{1}{2}k q^{2}$ 特殊情况下动能的质心维里估计量的表达式。然后，展示该估计量如何与谐振子的精确量子期望值相关联，并给出动能、势能和总能量的相应闭合形式表达式。仔细处理自由粒子极限 $k\\to 0$ 的情况，并提供其极限表达式。\n\n你的任务是实现一个完整的、可运行的程序，对下面测试套件中的每一组参数，计算：\n- 使用专门针对谐波势的质心维里估计量计算的量子动能，\n- 量子势能，\n- 量子总能。\n\n所有能量必须以焦耳 (J) 为单位表示。对于自由粒子极限 ($k=0$)，使用正确的极限表达式。程序不得读取任何输入；它应在内部包含参数集。\n\n测试套件（每个案例以 $(m,k,T)$ 形式给出）：\n- 案例 1：$(m=\\;1.67262192369\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;500\\;\\mathrm{N/m},\\;T=\\;300\\;\\mathrm{K})$\n- 案例 2：$(m=\\;3.343583719\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;500\\;\\mathrm{N/m},\\;T=\\;300\\;\\mathrm{K})$\n- 案例 3：$(m=\\;1.67262192369\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;0\\;\\mathrm{N/m},\\;T=\\;300\\;\\mathrm{K})$\n- 案例 4：$(m=\\;1.67262192369\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;500\\;\\mathrm{N/m},\\;T=\\;5000\\;\\mathrm{K})$\n\n覆盖性设计：\n- 案例1探测了在环境温度下、处于刚性谐波环境中、核量子效应强的轻核。\n- 案例2增加了质量（近似于氘核）以减少量子效应，同时保持 $k$ 和 $T$ 不变。\n- 案例3是自由粒子极限 ($k=0$)，用于测试估计量的极限行为。\n- 案例4是接近经典极限的高温区。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试案例，并且本身是一个由方括号括起来的逗号分隔子列表，按 $[\\text{动能},\\text{势能},\\text{总能}]$ 的顺序包含三个以焦耳为单位的能量。例如：$[[E_{K}^{(1)},E_{V}^{(1)},E_{\\mathrm{tot}}^{(1)}],[E_{K}^{(2)},E_{V}^{(2)},E_{\\mathrm{tot}}^{(2)}],\\ldots]$。",
            "solution": "该问题要求推导并实现用于计算质量为 $m$ 的单个粒子在温度 $T$ 下、处于一维諧波势 $V(q)=\\frac{1}{2}k q^{2}$ 中的量子动能、势能和总能的公式。该推导是在路径积分分子动力学 (PIMD) 框架的背景下进行的，特别要求得出动能的质心维里估计量，及其与精确量子期望值的关系。\n\n所述问题具有科学依据、是良定的且客观的。所有参数都具有物理意义，而 PIMD、质心维里估计量和量子谐振子的概念是现代凝聚相量子动力学的基石。因此，该问题被视为 **有效的**。\n\n解决方案首先推导一维量子谐振子 (QHO) 能量分量的精确量子统计力学期望值。然后，我们根据谐波系统中质心维里估计量的性质，证明使用这些精确公式的合理性。最后，我们仔细处理弹簧常数 $k=0$ 的自由粒子的特殊情况。\n\n**1. 量子谐振子的能量期望值 ($k > 0$)**\n\n一维量子谐振子的哈密顿量由下式给出：\n$$ \\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2}k\\hat{q}^2 $$\n该系统的能量本征值是量子化的：\n$$ E_n = \\hbar \\omega \\left(n + \\frac{1}{2}\\right), \\quad n = 0, 1, 2, \\dots $$\n其中 $\\omega = \\sqrt{k/m}$ 是振子的角频率，$\\hbar$ 是约化普朗克常数。\n\n在逆温 $\\beta = 1/(k_{\\mathrm{B}}T)$ 下，正则配分函数 $Z$ 是对所有态的求和：\n$$ Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right] = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta \\hbar \\omega (n + 1/2)} $$\n$$ Z = e^{-\\beta \\hbar \\omega / 2} \\sum_{n=0}^{\\infty} \\left(e^{-\\beta \\hbar \\omega}\\right)^n $$\n这是一个几何级数，其和为：\n$$ Z = e^{-\\beta \\hbar \\omega / 2} \\frac{1}{1 - e^{-\\beta \\hbar \\omega}} = \\frac{1}{e^{\\beta \\hbar \\omega / 2} - e^{-\\beta \\hbar \\omega / 2}} = \\frac{1}{2 \\sinh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)} $$\n总能量的期望值 $\\langle E_{\\mathrm{tot}} \\rangle$ 可由配分函数求得：\n$$ \\langle E_{\\mathrm{tot}} \\rangle = - \\frac{\\partial \\ln Z}{\\partial \\beta} = - \\frac{\\partial}{\\partial \\beta} \\left[-\\ln\\left(2 \\sinh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)\\right)\\right] $$\n$$ \\langle E_{\\mathrm{tot}} \\rangle = \\frac{1}{\\sinh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)} \\cdot \\cosh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) \\cdot \\frac{\\hbar \\omega}{2} = \\frac{\\hbar \\omega}{2} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) $$\n对于谐振子，维里定理指出动能的期望值 $\\langle K \\rangle$ 等于势能的期望值 $\\langle V \\rangle$：\n$$ \\langle K \\rangle = \\langle V \\rangle $$\n由于 $\\langle E_{\\mathrm{tot}} \\rangle = \\langle K \\rangle + \\langle V \\rangle$，我们有：\n$$ \\langle K \\rangle = \\langle V \\rangle = \\frac{1}{2}\\langle E_{\\mathrm{tot}} \\rangle = \\frac{\\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) $$\n该问题要求动能的质心维里估计量。PIMD 中的一个关键结果是，对于谐波势，质心维里估计量对于任意数量的珠子 $P \\ge 2$ 都是精确的，这意味着它能得出动能的真实量子力学期望值。因此，上面推导出的 $\\langle K \\rangle$ 表达式正是质心维里估计量将产生的值。\n\n**2. 自由粒子的能量期望值 ($k = 0$)**\n\n$k=0$ 的情况必须分开处理。此时，势能 $V(q)=0$，系统是一个自由粒子。哈密顿量纯粹是动能：\n$$ \\hat{H} = \\frac{\\hat{p}^2}{2m} $$\n总能量的期望值纯粹是动能，即 $\\langle E_{\\mathrm{tot}} \\rangle = \\langle K \\rangle$。在一维系统的正则系综中，自由粒子的量子力学平均动能与经典结果相同：\n$$ \\langle K \\rangle = \\frac{1}{2} k_{\\mathrm{B}} T $$\n根据定义，势能为零：\n$$ \\langle V \\rangle = 0 $$\n因此，总能量为：\n$$ \\langle E_{\\mathrm{tot}} \\rangle = \\frac{1}{2} k_{\\mathrm{B}} T $$\n需要注意的是，不能直接对谐振子公式取 $k \\to 0$ 的极限。这样做会得到 $\\langle E_{\\mathrm{tot}} \\rangle \\to k_{\\mathrm{B}}T$，其中 $\\langle K \\rangle \\to \\frac{1}{2} k_{\\mathrm{B}}T$ 且 $\\langle V \\rangle \\to \\frac{1}{2} k_{\\mathrm{B}}T$。这个极限描述的是一个处于无限浅、宽的諧波阱中的粒子（经典振子极限），这与势能在任何地方都严格为零的真实自由粒子是物理上不同的系统。$k=0$ 的明确情况对应于真实的自由粒子。\n\n**计算公式摘要：**\n\n计算根据 $k$ 的值分为两种情况。\n\n**情况1：谐振子 ($k > 0$)**\n- 角频率：$\\omega = \\sqrt{k/m}$\n- 总能量：$E_{\\mathrm{tot}} = \\frac{\\hbar \\omega}{2} \\coth\\left(\\frac{\\hbar \\omega}{2 k_{\\mathrm{B}} T}\\right)$\n- 动能：$E_{K} = \\frac{1}{2} E_{\\mathrm{tot}}$\n- 势能：$E_{V} = \\frac{1}{2} E_{\\mathrm{tot}}$\n\n**情况2：自由粒子 ($k = 0$)**\n- 动能：$E_{K} = \\frac{1}{2} k_{\\mathrm{B}} T$\n- 势能：$E_{V} = 0$\n- 总能量：$E_{\\mathrm{tot}} = \\frac{1}{2} k_{\\mathrm{B}} T$\n\n计算中将使用以下物理常数：\n- 玻尔兹曼常数，$k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}$ J/K\n- 约化普朗克常数，$\\hbar = 1.054571817 \\times 10^{-34}$ J·s",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the quantum kinetic, potential, and total energies for a 1D particle\n    in a harmonic potential for several test cases, including the free-particle limit.\n    \"\"\"\n\n    # Physical constants in SI units\n    K_B = 1.380649e-23  # Boltzmann constant in J/K\n    HBAR = 1.054571817e-34 # Reduced Planck constant in J*s\n\n    # Test suite: each tuple is (m, k, T)\n    # m in kg, k in N/m, T in K\n    test_cases = [\n        (1.67262192369e-27, 500.0, 300.0), # Case 1: Proton in a stiff potential\n        (3.343583719e-27,   500.0, 300.0), # Case 2: Deuteron, reduced quantum effects\n        (1.67262192369e-27, 0.0,   300.0), # Case 3: Free particle limit\n        (1.67262192369e-27, 500.0, 5000.0), # Case 4: High-temperature classical limit\n    ]\n\n    results = []\n    for m, k, T in test_cases:\n        if k == 0.0:\n            # Free particle case (k=0)\n            # The potential is zero, total energy is purely kinetic.\n            # The quantum and classical results for average kinetic energy are the same.\n            E_K = 0.5 * K_B * T\n            E_V = 0.0\n            E_tot = E_K\n        else:\n            # Quantum Harmonic Oscillator case (k>0)\n            # Angular frequency\n            omega = np.sqrt(k / m)\n            \n            # Argument for the hyperbolic cotangent function\n            x = (HBAR * omega) / (2.0 * K_B * T)\n            \n            # coth(x) = 1/tanh(x). Numerically stable for positive x.\n            coth_x = 1.0 / np.tanh(x)\n            \n            # Total energy for the QHO\n            E_tot = (HBAR * omega / 2.0) * coth_x\n            \n            # From the virial theorem for a harmonic oscillator, K = V\n            E_K = 0.5 * E_tot\n            E_V = 0.5 * E_tot\n            \n        results.append([E_K, E_V, E_tot])\n\n    # Format the final output string as per the problem specification.\n    # e.g., [[E_K1,E_V1,E_tot1],[E_K2,E_V2,E_tot2],...]\n    formatted_cases = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在简单一维模型的基础上，本练习将探讨一个更真实的情景：液体中分子振动所引起的三维各向异性限制。本练习将引入量子动能张量的概念，并揭示核量子效应的一个关键特征：动能并非在所有方向上都均匀分布。它突出了势能面的形状如何决定原子核的量子运动。",
            "id": "3430079",
            "problem": "你的任务是，在路径积分分子动力学的环状聚合物表述中，使用质心维里估计量来推导、实现并测试凝聚相中原子核的量子动能张量的计算。重点关注与液氨中 Nitrogen–Hydrogen 振动相关的核量子效应，该振动被理想化为沿三个正交实验室坐标轴的各向异性谐波限制，其中一个轴与 Nitrogen–Hydrogen 键方向重合。从第一性原理出发，从正则配分函数和将每个原子核映射为具有 $P$ 个副本（珠子）的经典环状聚合物的路径积分开始。将珠子位置定义为 $\\mathbf{r}_{i,s}$，其中珠子索引 $s \\in \\{1,\\dots,P\\}$，原子核索引 $i \\in \\{1,\\dots,N\\}$。质心位置为 $\\mathbf{r}_{i,c} \\equiv \\frac{1}{P} \\sum_{s=1}^{P} \\mathbf{r}_{i,s}$。珠子上的力 $\\mathbf{F}_{i,s}$ 由物理势导出，即 $\\mathbf{F}_{i,s} \\equiv - \\nabla_{\\mathbf{r}_{i,s}} U(\\mathbf{r}_{1,s},\\dots,\\mathbf{r}_{N,s})$。质心维里估计量产生一个张量形式的动能，其形式为笛卡尔张量 $\\mathbf{K}$，分量为 $K_{\\alpha\\beta}$，关联了热运动和力-位移相关性；你的推导必须展示当物理势 $U$ 是谐波且各向异性时，如何根据热力学参数和限制特性获得一个可计算的表达式。\n\n假设液氨中的 Nitrogen–Hydrogen 振动由每个 Nitrogen–Hydrogen 自由度的各向异性谐波势表示，即 $U = \\frac{1}{2} m \\sum_{\\alpha \\in \\{x,y,z\\}} \\omega_{\\alpha}^{2} r_{\\alpha}^{2}$，其中 $m$ 是 Nitrogen–Hydrogen 模式的有效约化质量，$\\omega_{\\alpha}$ 是指定沿 $x, y, z$ 轴限制的角频率（单位：弧度/秒）；在正交的限制主轴下，由于对称性，将非对角张量分量视为零。使用质心维里估计量框架，推导在温度 $T$（单位：开尔文）的热力学平衡下量子动能张量的对角分量 $K_{\\alpha\\alpha}$。提供一个从路径积分映射和维里定理出发的完整而严谨的推理链，最终得到一个适合数值计算的表达式，该表达式将 $\\{\\omega_{x},\\omega_{y},\\omega_{z}\\}$ 中的各向异性与 $\\{K_{xx},K_{yy},K_{zz}\\}$ 中的各向异性联系起来。\n\n在 Python 语言中实现一个完整的、可运行的程序，该程序针对一小组测试用例，计算并报告对角项 $K_{xx}$、$K_{yy}$ 和 $K_{zz}$（单位：千焦耳/摩尔）。该程序必须仅依赖于指定的库，并且不得接受任何用户输入。你的程序应生成单行输出，其中包含所有测试用例的结果，格式为逗号分隔的列表的列表（每个内部列表按 $[K_{xx},K_{yy},K_{zz}]$ 顺序排列），并用方括号括起来，顺序如下。使用国际单位制 (SI) 中的物理常数，其值如下：Boltzmann 常数 $k_{\\mathrm{B}}$、约化 Planck 常数 $\\hbar$ 和 Avogadro 常数 $N_{\\mathrm{A}}$。确保单位转换正确，以千焦耳/摩尔为单位返回能量。\n\n测试套件：\n- 案例 1（液氨，各向异性限制，中等温度）：$T = 273$ 开尔文；$\\omega_{x} = 6.20 \\times 10^{14}$ 弧度/秒，$\\omega_{y} = 2.50 \\times 10^{14}$ 弧度/秒，$\\omega_{z} = 1.00 \\times 10^{14}$ 弧度/秒。\n- 案例 2（各向同性限制检验）：$T = 273$ 开尔文；$\\omega_{x} = 2.00 \\times 10^{14}$ 弧度/秒，$\\omega_{y} = 2.00 \\times 10^{14}$ 弧度/秒，$\\omega_{z} = 2.00 \\times 10^{14}$ 弧度/秒。\n- 案例 3（通过极弱限制达到的经典极限边缘）：$T = 273$ 开尔文；$\\omega_{x} = 1.00 \\times 10^{12}$ 弧度/秒，$\\omega_{y} = 1.00 \\times 10^{12}$ 弧度/秒，$\\omega_{z} = 1.00 \\times 10^{12}$ 弧度/秒。\n- 案例 4（较低温度，增强的量子各向异性，仍处于凝聚相）：$T = 220$ 开尔文；$\\omega_{x} = 6.20 \\times 10^{14}$ 弧度/秒，$\\omega_{y} = 2.50 \\times 10^{14}$ 弧度/秒，$\\omega_{z} = 1.00 \\times 10^{14}$ 弧度/秒。\n\n要求的最终输出格式：\n你的程序应生成单行输出，其中包含四个案例的对角动能张量列表，格式为逗号分隔的列表的列表，并用方括号括起来，例如，$[[K_{xx}^{(1)},K_{yy}^{(1)},K_{zz}^{(1)}],[K_{xx}^{(2)},K_{yy}^{(2)},K_{zz}^{(2)}],[K_{xx}^{(3)},K_{yy}^{(3)},K_{zz}^{(3)}],[K_{xx}^{(4)},K_{yy}^{(4)},K_{zz}^{(4)}]]$，其中每个数值都表示为以千焦耳/摩尔为单位的浮点数。",
            "solution": "### 第 1 步：提取已知条件\n- **任务**：在路径积分分子动力学中使用质心维里估计量计算原子核的量子动能张量 $\\mathbf{K}$。\n- **系统**：液氨中的 Nitrogen–Hydrogen 振动。\n- **模型势**：各向异性谐波势，$U = \\frac{1}{2} m \\sum_{\\alpha \\in \\{x,y,z\\}} \\omega_{\\alpha}^{2} r_{\\alpha}^{2}$，其中 $m$ 为有效约化质量，$\\omega_{\\alpha}$ 为正交轴 $\\{x,y,z\\}$ 的角频率。$\\mathbf{K}$ 的非对角分量因对称性假定为零。\n- **估计量**：质心维里估计量。\n- **定义**：\n    - 副本（珠子）数量：$P$。\n    - 珠子位置：$\\mathbf{r}_{i,s}$，对应原子核 $i$ 和珠子 $s$。\n    - 质心位置：$\\mathbf{r}_{i,c} \\equiv \\frac{1}{P} \\sum_{s=1}^{P} \\mathbf{r}_{i,s}$。\n    - 珠子力：$\\mathbf{F}_{i,s} \\equiv - \\nabla_{\\mathbf{r}_{i,s}} U(\\mathbf{r}_{1,s},\\dots,\\mathbf{r}_{N,s})$。\n- **目标**：推导并实现一个可计算的表达式，用于计算在温度 $T$ 下热平衡时动能张量的对角分量 $K_{\\alpha\\alpha}$。结果应以千焦耳/摩尔为单位。\n- **物理常数**：Boltzmann 常数 $k_{\\mathrm{B}}$、约化 Planck 常数 $\\hbar$、Avogadro 常数 $N_{\\mathrm{A}}$。\n- **测试套件**：\n    - 案例 1：$T = 273 \\, \\text{K}$；$\\omega_{x} = 6.20 \\times 10^{14} \\, \\text{rad/s}$，$\\omega_{y} = 2.50 \\times 10^{14} \\, \\text{rad/s}$，$\\omega_{z} = 1.00 \\times 10^{14} \\, \\text{rad/s}$。\n    - 案例 2：$T = 273 \\, \\text{K}$；$\\omega_{x} = 2.00 \\times 10^{14} \\, \\text{rad/s}$，$\\omega_{y} = 2.00 \\times 10^{14} \\, \\text{rad/s}$，$\\omega_{z} = 2.00 \\times 10^{14} \\, \\text{rad/s}$。\n    - 案例 3：$T = 273 \\, \\text{K}$；$\\omega_{x} = 1.00 \\times 10^{12} \\, \\text{rad/s}$，$\\omega_{y} = 1.00 \\times 10^{12} \\, \\text{rad/s}$，$\\omega_{z} = 1.00 \\times 10^{12} \\, \\text{rad/s}$。\n    - 案例 4：$T = 220 \\, \\text{K}$；$\\omega_{x} = 6.20 \\times 10^{14} \\, \\text{rad/s}$，$\\omega_{y} = 2.50 \\times 10^{14} \\, \\text{rad/s}$，$\\omega_{z} = 1.00 \\times 10^{14} \\, \\text{rad/s}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据既定标准对问题陈述进行评估。\n\n- **科学依据充分**：该问题植根于计算统计力学这一成熟领域，特别是路径积分分子动力学（PIMD）。使用质心维里估计量计算量子动能是一种标准且严谨的技术。各向异性谐波势中的量子粒子模型是量子力学中一个基本的、可精确求解的问题，是理解更复杂系统的基石。所有概念都基于坚实的科学原理。\n- **问题定义明确**：问题定义清晰。它要求在明确定义的模型势下，对特定物理系统进行推导和计算。提供了测试用例的所有必要参数，并明确了所需的输出格式。其底层的物理学保证了唯一且有意义的解。\n- **客观性**：语言精确且无偏见。所有参数均以客观数值给出。\n\n该问题没有任何无效性缺陷。它是凝聚态物理/物理化学中的一个标准理论和计算练习。它在科学上是合理的、可形式化的、完整的、现实的（在模型问题的背景下），并且结构良好。\n\n### 第 3 步：结论与行动\n问题是**有效**的。将提供一个完整的、有理有据的解决方案。\n\n### 推导与求解\n\n目标是在路径积分框架内，使用质心维里估计量，为质量为 $m$ 的粒子在三维各向异性谐波势中的量子动能张量的对角分量 $K_{\\alpha\\alpha}$ 推导一个表达式。\n\n1.  **路径积分表述**：在逆温 $\\beta = 1/(k_{\\mathrm{B}}T)$ 下，单个量子粒子的正则配分函数为 $Z = \\text{Tr}(e^{-\\beta \\hat{H}})$。路径积分形式主义将这个单量子粒子映射到一个由 $P$ 个珠子组成的经典环状聚合物上。珠子 $s$ 的位置是 $\\mathbf{r}_s$。对于单个粒子，我们省略索引 $i$。这个经典同构系统的有效势能为：\n    $$\n    U_{\\text{eff}}(\\mathbf{r}_1, \\dots, \\mathbf{r}_P) = \\sum_{s=1}^{P} \\left[ \\frac{1}{2} m \\omega_P^2 (\\mathbf{r}_{s} - \\mathbf{r}_{s+1})^2 + U(\\mathbf{r}_s) \\right]\n    $$\n    其中 $\\mathbf{r}_{P+1} \\equiv \\mathbf{r}_1$，连接珠子的谐波弹簧频率为 $\\omega_P = P/(\\beta\\hbar)$。项 $U(\\mathbf{r}_s)$ 是每个珠子所受的物理势。\n\n2.  **质心维里估计量**：质心维里估计量提供了一种计算动能期望值的方法。对于单个粒子，动能张量 $\\mathbf{K}$ 的分量 $K_{\\alpha\\beta}$ 由下式给出：\n    $$\n    K_{\\alpha\\beta} = \\frac{\\delta_{\\alpha\\beta}}{2\\beta} + \\frac{1}{2P} \\sum_{s=1}^{P} \\left\\langle (r_{s,\\alpha} - r_{c,\\alpha}) F_{s,\\beta} \\right\\rangle\n    $$\n    此处，$r_{s,\\alpha}$ 是珠子 $s$ 位置的 $\\alpha$ 分量，$r_{c,\\alpha} = \\frac{1}{P}\\sum_{s=1}^{P} r_{s,\\alpha}$ 是质心位置的 $\\alpha$ 分量，$F_{s,\\beta}$ 是来自*物理*势 $U$ 作用在珠子 $s$ 上的力的 $\\beta$ 分量。尖括号 $\\langle \\cdot \\rangle$ 表示对环状聚合物构型的热平均。\n\n3.  **应用谐波势**：问题指定了各向异性谐波势 $U(\\mathbf{r}) = \\frac{1}{2} m \\sum_{\\gamma=x,y,z} \\omega_{\\gamma}^{2} r_{\\gamma}^{2}$。沿 $\\beta$ 轴作用在珠子 $s$ 上的力是：\n    $$\n    F_{s,\\beta} = - \\frac{\\partial U(\\mathbf{r}_s)}{\\partial r_{s,\\beta}} = - \\frac{\\partial}{\\partial r_{s,\\beta}} \\left( \\frac{1}{2} m \\sum_{\\gamma} \\omega_{\\gamma}^{2} r_{s,\\gamma}^{2} \\right) = -m \\omega_{\\beta}^{2} r_{s,\\beta}\n    $$\n    由于势是可分离的，并且实验室坐标轴与限制主轴对齐，因此沿一个轴的力仅取决于沿同一轴的位置。这意味着期望值的非对角分量为零，即 $\\langle (r_{s,\\alpha} - r_{c,\\alpha}) F_{s,\\beta} \\rangle = 0$ 对 $\\alpha \\neq \\beta$ 成立。因此，动能张量是对角的，正如问题所述。\n\n4.  **对角分量的表达式**：我们将力代入对角分量 $K_{\\alpha\\alpha}$ 的表达式中：\n    $$\n    K_{\\alpha\\alpha} = \\frac{1}{2\\beta} + \\frac{1}{2P} \\sum_{s=1}^{P} \\left\\langle (r_{s,\\alpha} - r_{c,\\alpha}) (-m \\omega_{\\alpha}^{2} r_{s,\\alpha}) \\right\\rangle\n    $$\n    $$\n    K_{\\alpha\\alpha} = \\frac{1}{2\\beta} - \\frac{m \\omega_{\\alpha}^{2}}{2P} \\sum_{s=1}^{P} \\left\\langle r_{s,\\alpha}^2 - r_{c,\\alpha} r_{s,\\alpha} \\right\\rangle\n    $$\n    我们可以简化期望值内的求和：\n    $$\n    \\frac{1}{P} \\sum_{s=1}^{P} (r_{s,\\alpha}^2 - r_{c,\\alpha} r_{s,\\alpha}) = \\left(\\frac{1}{P} \\sum_{s=1}^{P} r_{s,\\alpha}^2\\right) - r_{c,\\alpha} \\left(\\frac{1}{P} \\sum_{s=1}^{P} r_{s,\\alpha}\\right) = \\left(\\frac{1}{P} \\sum_{s=1}^{P} r_{s,\\alpha}^2\\right) - r_{c,\\alpha}^2\n    $$\n    这个量是环状聚合物沿 $\\alpha$ 轴的均方回转半径。让我们将其表示为 $\\langle R_{g,\\alpha}^2 \\rangle$。表达式变为：\n    $$\n    K_{\\alpha\\alpha} = \\frac{1}{2\\beta} - \\frac{m \\omega_{\\alpha}^{2}}{2} \\left\\langle R_{g,\\alpha}^2 \\right\\rangle\n    $$\n\n5.  **谐振子的解析评估**：对于一个只受谐波力作用的系统（包括 PIMD 弹簧和物理势），路径积分是可精确求解的，因为它对应于一个耦合高斯变量系统。估计量所需的期望值可以解析计算。在珠子数量无限的极限下（$P \\rightarrow \\infty$），任何有效估计量的 PIMD 结果都必须收敛到精确的量子力学期望值。\n\n6.  **精确量子结果**：沿 $\\alpha$ 轴的一维量子谐振子的哈密顿量为 $\\hat{H}_{\\alpha} = -\\frac{\\hbar^2}{2m}\\frac{d^2}{dr_\\alpha^2} + \\frac{1}{2}m\\omega_\\alpha^2 r_\\alpha^2$。能量本征值为 $E_n = \\hbar\\omega_\\alpha(n + 1/2)$。正则配分函数为 $Z_\\alpha = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\frac{1}{2\\sinh(\\beta\\hbar\\omega_\\alpha/2)}$。总平均能量为 $\\langle E_\\alpha \\rangle = -\\frac{\\partial \\ln Z_\\alpha}{\\partial \\beta} = \\frac{\\hbar\\omega_\\alpha}{2}\\coth(\\frac{\\beta\\hbar\\omega_\\alpha}{2})$。根据谐振子的维里定理，平均动能等于平均势能，即 $\\langle K_\\alpha \\rangle = \\langle V_\\alpha \\rangle$。由于 $\\langle E_\\alpha \\rangle = \\langle K_\\alpha \\rangle + \\langle V_\\alpha \\rangle$，我们有：\n    $$\n    \\langle K_{\\alpha\\alpha} \\rangle = \\frac{1}{2}\\langle E_\\alpha \\rangle = \\frac{\\hbar \\omega_{\\alpha}}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega_{\\alpha}}{2}\\right)\n    $$\n    这就是沿 $\\alpha$ 轴的谐振子的精确量子力学动能。\n\n7.  **最终可计算表达式**：从质心维里估计量开始，并应用于可精确求解的谐波势的推导，得出了确定的解析结果。势中的各向异性，由 $\\{\\omega_x, \\omega_y, \\omega_z\\}$ 表示，通过此公式直接转化为动能分量 $\\{K_{xx}, K_{yy}, K_{zz}\\}$ 中的各向异性：\n    $$\n    K_{\\alpha\\alpha} = \\frac{\\hbar \\omega_{\\alpha}}{4} \\coth\\left(\\frac{\\hbar \\omega_{\\alpha}}{2 k_{\\mathrm{B}} T}\\right)\n    $$\n    此表达式将用于计算。为了得到以千焦耳/摩尔为单位的结果，焦耳（每个粒子）单位的值必须乘以 Avogadro 常数 $N_{\\mathrm{A}}$ 和因子 $10^{-3}$。\n    $$\n    K_{\\alpha\\alpha} \\, [\\text{kJ/mol}] = \\frac{\\hbar \\omega_{\\alpha} N_{\\mathrm{A}}}{4000} \\coth\\left(\\frac{\\hbar \\omega_{\\alpha}}{2 k_{\\mathrm{B}} T}\\right)\n    $$\n\n8.  **极限情况**：\n    - **经典极限**：对于高温或低频，$\\hbar \\omega_{\\alpha} \\ll k_{\\mathrm{B}} T$。令 $x = \\frac{\\hbar \\omega_{\\alpha}}{2 k_{\\mathrm{B}} T} \\ll 1$。那么 $\\coth(x) \\approx 1/x$。\n      $$ K_{\\alpha\\alpha} \\approx \\frac{\\hbar \\omega_{\\alpha}}{4} \\left(\\frac{2 k_{\\mathrm{B}} T}{\\hbar \\omega_{\\alpha}}\\right) = \\frac{1}{2} k_{\\mathrm{B}} T $$\n      这正确地恢复了单个二次自由度的经典能量均分定理。\n    - **量子极限**：对于低温或高频，$\\hbar \\omega_{\\alpha} \\gg k_{\\mathrm{B}} T$。令 $x \\gg 1$。那么 $\\coth(x) \\approx 1$。\n      $$ K_{\\alpha\\alpha} \\approx \\frac{\\hbar \\omega_{\\alpha}}{4} $$\n      这是零点动能。\n\n所提供的公式正确地连接了经典和量子体系，并且是将指定的 PIMD 估计量应用于给定模型系统的结果。",
            "answer": "```python\nimport numpy as np\n\n# Python 3 code for computing the quantum kinetic energy tensor.\n\ndef solve():\n    \"\"\"\n    Derives, implements, and tests a computation of the quantum kinetic energy\n    tensor for nuclei using the centroid virial estimator for an anisotropic\n    harmonic potential model.\n    \"\"\"\n\n    # --- Physical Constants (SI units) ---\n    # Reduced Planck constant (Joule-second)\n    HBAR = 1.054571817e-34\n    # Boltzmann constant (Joule/Kelvin)\n    KB = 1.380649e-23\n    # Avogadro constant (1/mol)\n    NA = 6.02214076e+23\n\n    # --- Test Suite ---\n    test_cases = [\n        # Case 1: liquid ammonia, anisotropic confinement, moderate temperature\n        {'T': 273.0, 'omegas_rad_s': [6.20e14, 2.50e14, 1.00e14]},\n        # Case 2: isotropic confinement check\n        {'T': 273.0, 'omegas_rad_s': [2.00e14, 2.00e14, 2.00e14]},\n        # Case 3: classical-limit edge via very weak confinement\n        {'T': 273.0, 'omegas_rad_s': [1.00e12, 1.00e12, 1.00e12]},\n        # Case 4: lower temperature, enhanced quantum anisotropy\n        {'T': 220.0, 'omegas_rad_s': [6.20e14, 2.50e14, 1.00e14]},\n    ]\n\n    def calculate_K_alpha_alpha(T, omega_alpha):\n        \"\"\"\n        Calculates a diagonal component of the quantum kinetic energy tensor.\n\n        Args:\n            T (float): Temperature in Kelvin.\n            omega_alpha (float): Angular frequency in radians per second.\n\n        Returns:\n            float: The kinetic energy component K_alpha_alpha in kJ/mol.\n        \"\"\"\n        if T = 0 or omega_alpha = 0:\n            raise ValueError(\"Temperature and frequency must be positive.\")\n        \n        # Dimensionless argument for the coth function\n        x = (HBAR * omega_alpha) / (2 * KB * T)\n        \n        # For very small x (classical limit), coth(x) ~ 1/x.\n        # The formula K ~ (hbar*omega/4) * (1/x) gives 0.5*kB*T.\n        # For very large x (quantum limit), coth(x) ~ 1.\n        # The formula gives K ~ hbar*omega/4 (zero-point energy).\n        # np.coth is not a standard function, so we implement it.\n        coth_x = np.cosh(x) / np.sinh(x) if x > 1e-8 else 1.0/x\n\n        # Calculate kinetic energy in Joules per particle\n        K_joules = (HBAR * omega_alpha / 4.0) * coth_x\n        \n        # Convert to kJ/mol\n        K_kj_per_mol = K_joules * NA / 1000.0\n        \n        return K_kj_per_mol\n\n    results = []\n    for case in test_cases:\n        T = case['T']\n        omegas = case['omegas_rad_s']\n        \n        K_tensor_diag = [\n            calculate_K_alpha_alpha(T, omegas[0]),  # K_xx\n            calculate_K_alpha_alpha(T, omegas[1]),  # K_yy\n            calculate_K_alpha_alpha(T, omegas[2]),  # K_zz\n        ]\n        results.append(K_tensor_diag)\n    \n    # Format the final output string exactly as requested.\n    # The formatted string should be a list of lists of floats.\n    formatted_results = [f\"[{','.join(f'{val:.10f}' for val in res)}]\" for res in results]\n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output)\n\nsolve()\n\n```"
        },
        {
            "introduction": "路径积分方法是一种近似，只有在“珠子”（或副本）数量 $P$ 趋于无穷时才变得精确。本练习旨在解决一个至关重要的实践问题：对于一个可靠的模拟，需要多少珠子才足够？通过本练习，你将亲手研究路径积分计算的收敛性，并检验一个常用的经验法则，从而为设置准确高效的量子模拟提供必要的洞察。",
            "id": "3430035",
            "problem": "您必须编写一个完整且可运行的程序，使用振动模式的谐振子近似，对凝聚相中核量子效应的路径积分珠子数进行第一性原理收敛性研究。该程序必须实现一个基于不等式 $P_{\\text{beads}} \\gtrsim \\beta \\hbar \\omega_{\\max}$ 的判据，并测试该判据在代表液态水和甲烷的非均匀模式谱上的充分性。该研究必须基于以下基本原理和要求构建。\n\n从一组角频率为 $\\{\\omega_i\\}$ 的独立一维谐振子的正则量子配分函数 $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ 开始。每个模式的精确量子平均能量可以从量子统计力学的公认原理中获得。对于使用路径积分分子动力学 (PIMD) 的收敛路径积分离散化，珠子数 $P_{\\text{beads}}$ 控制着 Trotter 分解误差。使用虚时路径积分在 $P$ 个切片中的原始 Trotter 分解和环状聚合物表示。谐振子的离散化配分函数可以表示为珠子坐标下的多维高斯函数，该函数可通过对角化为环状聚合物简正模式来精确积分。对于有限的 $P$ 值，平均能量必须通过对离散化配分函数关于 $\\beta$ 求导来计算，而不得采用随机抽样方法。除了二次型的对角化以及对 $\\ln Z$ 关于 $\\beta$ 求导的法则外，不得假设任何快捷公式。您必须使用国际单位制 (SI) 单位下的常数 $\\hbar$ 和玻尔兹曼常数 $k_{\\mathrm{B}}$。\n\n您的程序必须为每个测试用例执行以下步骤。\n1. 使用公式 $\\omega = 2\\pi c \\tilde{\\nu}$ 将所有以 $\\mathrm{cm}^{-1}$ 为单位的振动模式输入波数转换为以 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 为单位的角频率，其中 $c$ 的单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$。\n2. 对于给定的开尔文温度 $T$，计算 $\\beta = 1/(k_{\\mathrm{B}} T)$，单位为 $\\mathrm{J}^{-1}$。\n3. 通过对所有模式的精确谐振子能量求和，计算独立模式系统的精确总量子平均能量 $E_{\\text{exact,tot}}$。\n4. 通过计算环状聚合物表示的离散高斯积分并对 $-\\partial \\ln Z_P/\\partial \\beta$ 求导，计算总能量的有限 $P$ 值离散近似 $E_{P,\\text{tot}}$。您必须对任何正整数 $P$ 确定性地获得 $E_{P,\\text{tot}}$，而无需使用蒙特卡洛抽样。\n5. 将经验珠子数定义为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是模式集中的最大角频率，$\\lceil \\cdot \\rceil$ 表示向上取整到下一个整数。强制要求 $P_{\\text{rule}} \\ge 1$。\n6. 对于指定的总相对误差容差 $\\delta_{\\text{tot}}$ 和最差单模式相对误差容差 $\\delta_{\\text{single}}$，确定：\n   a. 满足 $\\left|E_{P,\\text{tot}} - E_{\\text{exact,tot}}\\right|/E_{\\text{exact,tot}} \\le \\delta_{\\text{tot}}$ 的最小珠子数 $P_{\\text{tot}}$。\n   b. 满足 $\\max_i \\left( \\left|E_{P}(\\omega_i) - E_{\\text{exact}}(\\omega_i)\\right|/E_{\\text{exact}}(\\omega_i) \\right) \\le \\delta_{\\text{single}}$ 的最小珠子数 $P_{\\text{worst}}$。\n7. 通过检查在 $P = P_{\\text{rule}}$ 时的相应相对误差，评估两个布尔值：经验珠子数 $P_{\\text{rule}}$ 是否满足总误差标准以及是否满足最差模式误差标准。\n8. 以浮点数形式报告一个过量因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$。\n\n所有物理常数必须使用国际单位制 (SI) 单位：$\\hbar$ 的单位为 $\\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}}$ 的单位为 $\\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c$ 的单位为 $\\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。输入中的所有频率均以 $\\mathrm{cm}^{-1}$ 给出，在使用前必须转换为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 为单位的角频率。温度以开尔文为单位。\n\n测试套件由四个案例组成，每个案例由一个元组 $(T, \\{\\tilde{\\nu}_i\\}, \\delta_{\\text{tot}}, \\delta_{\\text{single}})$ 定义，其中 $T$ 是开尔文温度，$\\{\\tilde{\\nu}_i\\}$ 是以 $\\mathrm{cm}^{-1}$ 为单位的波数列表，容差是无量纲小数。\n1. 案例 1 (300 开尔文下的类液态水): $T = 300$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n2. 案例 2 (300 开尔文下的类甲烷): $T = 300$, $\\{\\tilde{\\nu}_i\\} = [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n3. 案例 3 (100 开尔文下的类液态水): $T = 100$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n4. 案例 4 (300 开尔文下的低频边界): $T = 300$, $\\{\\tilde{\\nu}_i\\} = [100, 200, 300, 400, 500, 600]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表。对于每个测试用例，按顺序 $[P_{\\text{tot}}, P_{\\text{worst}}, P_{\\text{rule}}, \\text{pass}_{\\text{tot}}, \\text{pass}_{\\text{worst}}, \\mathcal{O}]$ 输出包含六个元素的列表，其中前三个是整数，后两个是布尔值，最后一个是浮点数。因此，总输出应是针对四个测试用例的四个此类列表的列表，打印为单行，例如 $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$。不应打印任何额外文本。根据构造，所有角度均以弧度为单位，输出中不出现其他单位，因为报告的量是无量纲的或计数值。所有百分比类型的比较必须按规定以小数处理（例如，百分之一为 $0.01$）。",
            "solution": "该解决方案围绕量子统计力学原理和量子系统的路径积分表述构建。问题的核心是确定独立谐振子系统的路径积分表示相对于离散化中使用的珠子数 $P$ 的收敛性。\n\n**1. 基本理论**\n\n**1.1. 谐振子的精确量子能量**\n\n对于角频率为 $\\omega$ 的单个量子谐振子，其能级由 $E_n = \\hbar\\omega(n + 1/2)$ 给出，其中 $n=0, 1, 2, \\dots$。在逆温 $\\beta = 1/(k_B T)$ 下，正则配分函数 $Z_{\\text{exact}}$ 是对所有状态的求和：\n$$ Z_{\\text{exact}}(\\omega) = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta\\hbar\\omega(n+1/2)} = \\frac{e^{-\\beta\\hbar\\omega/2}}{1 - e^{-\\beta\\hbar\\omega}} = \\frac{1}{2\\sinh(\\beta\\hbar\\omega/2)} $$\n平均能量 $E_{\\text{exact}}(\\omega)$ 通过对配分函数的对数关于 $\\beta$ 求导得到：\n$$ E_{\\text{exact}}(\\omega) = -\\frac{\\partial \\ln Z_{\\text{exact}}(\\omega)}{\\partial \\beta} = \\frac{\\hbar\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) $$\n该表达式给出了单个谐振子模式的精确量子力学平均能量。对于具有频率 $\\{\\omega_i\\}$ 的独立谐振子系统，总精确能量就是对所有模式的求和：\n$$ E_{\\text{exact,tot}} = \\sum_i E_{\\text{exact}}(\\omega_i) $$\n\n**1.2. 路径积分离散化能量**\n\n路径积分表述将一个量子粒子表示为一个由 $P$ 个珠子组成的经典“环状聚合物”。使用谐振子的原始 Trotter 分解，离散化配分函数 $Z_P$ 可以写成关于珠子位置 $\\mathbf{x} = (x_1, \\dots, x_P)$ 的多维高斯积分。该积分可以通过对指数中的二次型进行对角化来精确求解，这对应于向环状聚合物简正模式的变换。\n\n按照要求，推导过程是通过对得到的 $\\ln Z_P$ 的闭式表达式进行微分。质量为 $m$ 的粒子在谐势中的离散化配分函数为：\n$$ Z_P = \\left( \\frac{mP}{2\\pi\\beta\\hbar^2} \\right)^{P/2} \\int d\\mathbf{x} \\exp\\left( -\\sum_{s=1}^P \\left[ \\frac{mP}{2\\beta\\hbar^2}(x_s - x_{s+1})^2 + \\frac{\\beta m\\omega^2}{2P}x_s^2 \\right] \\right) $$\n其中 $x_{P+1} \\equiv x_1$。指数中的项是一个二次型 $-\\frac{1}{2}\\mathbf{x}^T \\mathbf{A} \\mathbf{x}$。矩阵 $\\mathbf{A}$ 是一个循环矩阵，其特征值 $\\lambda_k$（对于 $k=0, \\dots, P-1$）为：\n$$ \\lambda_k = \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} $$\n该积分的计算结果为 $(2\\pi)^{P/2}(\\det \\mathbf{A})^{-1/2} = (2\\pi)^{P/2} (\\prod_k \\lambda_k)^{-1/2}$。这导出了配分函数的表达式：\n$$ Z_P = \\left(\\frac{mP}{\\beta\\hbar^2}\\right)^{P/2} \\left(\\prod_{k=0}^{P-1} \\lambda_k\\right)^{-1/2} $$\n取对数得到：\n$$ \\ln Z_P = \\frac{P}{2}\\ln\\left(\\frac{mP}{\\beta\\hbar^2}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\ln\\left( \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} \\right) $$\n能量 $E_P(\\omega)$ 通过计算 $-\\partial(\\ln Z_P)/\\partial\\beta$ 求得。在进行微分和简化后，可以得到“热力学”能量估计量：\n$$ E_P(\\omega) = \\frac{P}{2\\beta} + \\frac{1}{2} \\sum_{k=0}^{P-1} \\frac{\\frac{\\omega^2}{P} - \\frac{4P}{\\beta^2\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)}{\\frac{\\beta \\omega^2}{P} + \\frac{4P}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)} $$\n注意，质量 $m$ 被消去了，这与谐振子性质仅依赖于 $\\omega$ 的预期相符。此公式是确定性的，允许在不使用随机抽样的情况下计算任何有限珠子数 $P$ 的能量。一组模式的总能量是求和 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$。\n\n**2. 算法实现**\n\n程序实现了上述理论框架，以执行所要求的收敛性研究。\n\n**步骤 1：初始化**\n物理常数按照规定以国际单位制 (SI) 定义：$\\hbar = 1.054571817 \\times 10^{-34} \\, \\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c = 2.99792458 \\times 10^{10} \\, \\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。\n\n**步骤 2：输入转换**\n对于每个测试用例，使用温度 $T$ 计算 $\\beta = 1/(k_B T)$。振动波数 $\\{\\tilde{\\nu}_i\\}$ (单位 $\\mathrm{cm}^{-1}$) 使用关系式 $\\omega = 2\\pi c \\tilde{\\nu}$ 转换为角频率 $\\{\\omega_i\\}$ (单位 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$)。\n\n**步骤 3：精确与近似能量计算**\n使用推导出的公式实现计算 $E_{\\text{exact}}(\\omega)$ 和 $E_P(\\omega)$ 的函数。这些函数使用 `numpy` 进行矢量化，以高效地同时计算整个频率集 $\\{\\omega_i\\}$ 的能量。\n\n**步骤 4：收敛性分析**\n从 $P=1$ 开始启动一个搜索循环。在每次迭代中，程序计算总 PIMD 能量 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$ 和单个模式能量 $E_P(\\omega_i)$。然后计算相对误差：\n- 总相对误差：$\\epsilon_{\\text{tot}}(P) = |E_{P,\\text{tot}} - E_{\\text{exact,tot}}| / E_{\\text{exact,tot}}$\n- 最差模式相对误差：$\\epsilon_{\\text{worst}}(P) = \\max_i(|E_P(\\omega_i) - E_{\\text{exact}}(\\omega_i)| / E_{\\text{exact}}(\\omega_i))$\n\n循环继续，递增 $P$，直到找到满足 $\\epsilon_{\\text{tot}}(P_{\\text{tot}}) \\le \\delta_{\\text{tot}}$ 和 $\\epsilon_{\\text{worst}}(P_{\\text{worst}}) \\le \\delta_{\\text{single}}$ 的最小 $P_{\\text{tot}}$ 和 $P_{\\text{worst}}$ 值为止。\n\n**步骤 5：经验法则评估**\n启发式珠子数 $P_{\\text{rule}}$ 按 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$ 计算，其中 $\\omega_{\\max}$ 是集合中的最高频率。强制最小值为 1。然后通过计算 $P=P_{\\text{rule}}$ 时的总相对误差和最差模式相对误差，并检查它们是否满足指定的容差（$\\delta_{\\text{tot}}$ 和 $\\delta_{\\text{single}}$）来测试该规则的性能。\n\n**步骤 6：报告**\n最后，收集每个测试用例的结果——$P_{\\text{tot}}$、$P_{\\text{worst}}$、$P_{\\text{rule}}$、两个布尔通过/失败检查以及过量因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$——并将其格式化为最终输出所需的列表的列表结构。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to run the PIMD convergence study for all test cases.\n    \"\"\"\n    \n    # Physical constants in SI units, except for c as specified\n    HBAR = 1.054571817e-34  # J.s\n    KB = 1.380649e-23        # J/K\n    C_CMS = 2.99792458e10   # cm/s\n\n    test_cases = [\n        # Case 1 (water-like at 300 K)\n        (300, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 2 (methane-like at 300 K)\n        (300, [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200], 0.01, 0.01),\n        # Case 3 (water-like at 100 K)\n        (100, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 4 (low-frequency at 300 K)\n        (300, [100, 200, 300, 400, 500, 600], 0.01, 0.01),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        T_kelvin, nu_cm_inv, delta_tot, delta_single = case\n        \n        # 1. Convert inputs\n        beta = 1.0 / (KB * T_kelvin)\n        omegas = 2.0 * np.pi * C_CMS * np.array(nu_cm_inv)\n        \n        # 3. Compute exact energies\n        def calc_E_exact(omega_arr, beta_val, hbar_val):\n            x = beta_val * hbar_val * omega_arr / 2.0\n            # Handle potential overflow in np.exp(2*x) for coth(x)\n            large_x_mask = x > 35\n            coth_x = np.zeros_like(x)\n            # For large x, coth(x) is 1\n            coth_x[large_x_mask] = 1.0\n            # For other x, use standard definition\n            non_large_x = ~large_x_mask\n            \n            x_safe = x[non_large_x]\n            # Use 1/x for small x, standard formula otherwise, to avoid division by zero in sinh\n            small_x_in_safe_mask = x_safe  1e-8\n            \n            # Create a temporary array for calculations on the non-large subset\n            coth_safe = np.zeros_like(x_safe)\n            \n            # Where x is small, coth(x) approx 1/x\n            if np.any(small_x_in_safe_mask):\n                coth_safe[small_x_in_safe_mask] = 1.0 / x_safe[small_x_in_safe_mask]\n\n            # Where x is not small and not large\n            mid_x_in_safe_mask = ~small_x_in_safe_mask\n            if np.any(mid_x_in_safe_mask):\n                 coth_safe[mid_x_in_safe_mask] = np.cosh(x_safe[mid_x_in_safe_mask]) / np.sinh(x_safe[mid_x_in_safe_mask])\n            \n            coth_x[non_large_x] = coth_safe\n\n            return (hbar_val * omega_arr / 2.0) * coth_x\n\n        E_exact_per_mode = calc_E_exact(omegas, beta, HBAR)\n        E_exact_tot = np.sum(E_exact_per_mode)\n\n        # 4. PIMD energy calculator\n        def calc_E_P(omega_arr, beta_val, P, hbar_val):\n            k = np.arange(P)\n            sin_k = np.sin(np.pi * k / P)\n            sin_k_sq = sin_k**2\n            \n            omega_arr_sq = omega_arr[:, np.newaxis]**2\n\n            num_part1 = omega_arr_sq / P\n            num_part2 = (4 * P / (beta_val**2 * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            numerator = num_part1 - num_part2\n            \n            den_part1 = (beta_val / P) * omega_arr_sq\n            den_part2 = (4 * P / (beta_val * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            denominator = den_part1 + den_part2\n            \n            sum_term = np.sum(numerator / denominator, axis=1)\n            \n            E_p_per_mode = P / (2 * beta_val) + 0.5 * sum_term\n            return E_p_per_mode, np.sum(E_p_per_mode)\n\n        # 5. Rule-of-thumb bead count\n        omega_max = np.max(omegas) if omegas.size > 0 else 0\n        P_rule_float = beta * HBAR * omega_max\n        P_rule = max(1, math.ceil(P_rule_float))\n\n        # 6. Find minimal P_tot and P_worst\n        P = 1\n        P_tot, P_worst = None, None\n        \n        while P_tot is None or P_worst is None:\n            E_p_per_mode, E_p_tot = calc_E_P(omegas, beta, P, HBAR)\n            \n            if P_tot is None:\n                rel_err_tot = np.abs(E_p_tot - E_exact_tot) / E_exact_tot\n                if rel_err_tot = delta_tot:\n                    P_tot = P\n            \n            if P_worst is None:\n                rel_err_per_mode = np.abs(E_p_per_mode - E_exact_per_mode) / E_exact_per_mode\n                max_rel_err = np.max(rel_err_per_mode)\n                if max_rel_err = delta_single:\n                    P_worst = P\n\n            P += 1\n            if P > 500:\n                 if P_tot is None: P_tot = -1\n                 if P_worst is None: P_worst = -1\n                 break\n\n        # 7. Evaluate P_rule\n        E_prule_per_mode, E_prule_tot = calc_E_P(omegas, beta, P_rule, HBAR)\n        \n        err_tot_at_prule = np.abs(E_prule_tot - E_exact_tot) / E_exact_tot\n        pass_tot = err_tot_at_prule = delta_tot\n        \n        err_worst_at_prule = np.max(np.abs(E_prule_per_mode - E_exact_per_mode) / E_exact_per_mode)\n        pass_worst = err_worst_at_prule = delta_single\n        \n        # 8. Overkill factor\n        overkill = float(P_rule) / P_tot if P_tot != 0 and P_tot != -1 else float('inf')\n\n        all_results.append([P_tot, P_worst, P_rule, pass_tot, pass_worst, overkill])\n\n    # Format output string manually to match the exact requirement\n    list_of_list_strs = []\n    for res_list in all_results:\n        # Convert boolean to lowercase 'true'/'false' as often seen in programming contexts\n        formatted_list = [str(item).lower() if isinstance(item, bool) else str(item) for item in res_list]\n        list_str = \"[\" + \",\".join(formatted_list) + \"]\"\n        list_of_list_strs.append(list_str)\n    final_output_str = \"[\" + \",\".join(list_of_list_strs) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}