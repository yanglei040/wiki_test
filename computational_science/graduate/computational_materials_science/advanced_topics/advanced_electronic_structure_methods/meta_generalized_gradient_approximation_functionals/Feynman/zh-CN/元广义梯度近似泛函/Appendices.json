{
    "hands_on_practices": [
        {
            "introduction": "Meta-GGA泛函的进步源于其包含了动能密度 $\\tau(\\mathbf{r})$，从而能够区分不同的化学环境。这个练习旨在通过一个基础但重要的推导，揭示等轨道指示因子 $\\alpha$ 的一个关键物理特性 。通过证明对于任何单轨道系统，$\\alpha$ 恒为零，您将亲身体会到现代meta-GGA泛函如何利用这一特性来识别共价键和原子尾部等区域。",
            "id": "163484",
            "problem": "在密度泛函理论 (DFT) 中，meta-广义梯度近似 (meta-GGA) 交换相关泛函通过引入 Kohn-Sham 动能密度 $\\tau(\\mathbf{r})$ 作为除电子密度 $n(\\mathbf{r})$ 及其梯度 $\\nabla n(\\mathbf{r})$ 之外的附加成分，改进了 GGA。\n\n对于一个包含 $N$ 个电子的体系，其总电子密度和动能密度由对占据的 Kohn-Sham 轨道 $\\psi_i(\\mathbf{r})$ 的求和给出：\n$$ n(\\mathbf{r}) = \\sum_{i=1}^{N} f_i |\\psi_i(\\mathbf{r})|^2 $$\n$$ \\tau(\\mathbf{r}) = \\frac{1}{2} \\sum_{i=1}^{N} f_i |\\nabla\\psi_i(\\mathbf{r})|^2 $$\n其中 $f_i$ 是占据数。\n\n在诸如强约束和适当范数 (SCAN) 泛函等现代 meta-GGA 中，一个关键的无量纲量是等轨道指标 $\\alpha(\\mathbf{r})$。其定义为：\n$$ \\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_W(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})} $$\n此处，$\\tau_W(\\mathbf{r})$ 是 von Weizsäcker 动能密度，它是任何单电子体系的精确动能密度，由下式给出：\n$$ \\tau_W(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|^2}{8n(\\mathbf{r})} $$\n而 $\\tau_{\\text{unif}}(\\mathbf{r})$ 是密度为 $n(\\mathbf{r})$ 的均匀电子气的动能密度：\n$$ \\tau_{\\text{unif}}(\\mathbf{r}) = C_F n(\\mathbf{r})^{5/3} $$\n其中 $C_F$ 是一个与费米动量相关的常数。$\\alpha$ 的值有助于区分不同的化学环境：$\\alpha=0$ 表示单轨道区域（如共价键或原子尾部），而 $\\alpha=1$ 对应于均匀电子气。\n\n考虑一个可以由单个、实的、双占据的 Kohn-Sham 轨道 $\\psi(\\mathbf{r})$ 描述的通用电子体系。假设该轨道及其梯度不为零，计算该体系的等轨道指标 $\\alpha(\\mathbf{r})$ 的值。",
            "solution": "1. 对于一个双占据的实轨道 $\\psi(\\mathbf{r})$，其电子密度为：\n$$n(\\mathbf{r}) = 2|\\psi(\\mathbf{r})|^2.$$\n2. Kohn–Sham 动能密度：\n$$\\tau(\\mathbf{r}) = \\frac{1}{2}\\sum_i f_i|\\nabla\\psi_i|^2 = \\frac{1}{2}\\cdot2\\,|\\nabla\\psi|^2 = |\\nabla\\psi|^2.$$\n3. 密度的梯度：\n$$\\nabla n(\\mathbf{r}) = \\nabla\\bigl(2\\psi^2\\bigr) = 4\\,\\psi\\,\\nabla\\psi.$$\n4. von Weizsäcker 动能密度：\n$$\\tau_W(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|^2}{8n(\\mathbf{r})} = \\frac{(4\\psi\\,\\nabla\\psi)^2}{8\\cdot2\\psi^2} = \\frac{16\\psi^2|\\nabla\\psi|^2}{16\\psi^2} = |\\nabla\\psi|^2.$$\n5. 等轨道指标中的差值：\n$$\\tau(\\mathbf{r}) - \\tau_W(\\mathbf{r}) = |\\nabla\\psi|^2 - |\\nabla\\psi|^2 = 0.$$\n6. 因此：\n$$\\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_W(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})} = \\frac{0}{\\tau_{\\text{unif}}(\\mathbf{r})} = 0.$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "一个物理上合理的泛函必须满足特定的不变性原理，以确保其预测与任意选择的数学描述无关。本练习将引导您通过编程，检验一个关键的“规范不变性”：交换相关能量对于动能密度 $\\tau(\\mathbf{r})$ 的一个均匀平移应该是无响应的 。您将构建并测试两种模型泛函，一种满足此不变性，另一种则不满足，从而深刻理解在泛函开发中，如何确保能量和力的计算在物理上是一致的。",
            "id": "3465779",
            "problem": "考虑在密度泛函理论（DFT）框架内构建和验证一个亚广义梯度近似（meta-GGA）类型的模型，其中交换相关能量密度取决于电子密度和动能密度。设计算域为长度为 $L$ 的一维周期性区域，并将其均匀离散为 $N$ 个网格点，网格间距为 $\\Delta x = L/N$。定义一个模型电子密度 $n(x)$，它是由中心位于位置 $R_i$、宽度为 $\\sigma_i$、权重为 $w_i$ 的高斯分量叠加而成，具体由下式给出：\n$$\nn(x) = \\sum_{i=1}^{M} \\frac{w_i}{\\sqrt{2\\pi}\\sigma_i} \\exp\\left(-\\frac{(x - R_i)^2}{2\\sigma_i^2}\\right),\n$$\n其中，通过将 $x$ 视为在周长为 $L$ 的圆上，来施加周期性边界条件。梯度通过中心有限差分法在周期性边界条件下计算。\n\n使用 Thomas-Fermi 项和 Weizsäcker 项的混合来定义模型轨道动能密度 $\\tau(x)$，\n$$\n\\tau(x) = c_{\\mathrm{TF}} n(x)^{5/3} + \\lambda_{\\mathrm{W}} \\frac{|\\nabla n(x)|^2}{8\\left(n(x) + n_{\\mathrm{floor}}\\right)},\n$$\n其中 $c_{\\mathrm{TF}} = \\frac{3}{10}(3\\pi^2)^{2/3}$，$\\lambda_{\\mathrm{W}}$ 是一个无量纲混合参数，$n_{\\mathrm{floor}}$ 是为防止除以零而添加到分母的一个小的正数下限值。梯度 $|\\nabla n(x)|$ 通过周期性中心差分法计算。\n\n构建两种类 meta-GGA 的能量密度：\n1. 一种规范敏感形式，\n$$\ne_{\\mathrm{sens}}(x) = a \\frac{\\tau(x)}{n(x) + n_{\\mathrm{floor}}},\n$$\n2. 一种对均匀平移规范不变的形式，它仅依赖于 $\\tau(x)$ 的空间变化，\n$$\ne_{\\mathrm{inv}}(x) = a \\frac{|\\nabla \\tau(x)|^2}{\\left(n(x) + n_{\\mathrm{floor}}\\right)^q},\n$$\n其中 $a$ 和 $q$ 是无量纲参数，$\\nabla \\tau(x)$ 通过周期性中心差分法计算。总能量为\n$$\nE = \\int_0^L e(x)\\, dx,\n$$\n该积分通过离散求和 $E \\approx \\sum_{j=0}^{N-1} e(x_j)\\,\\Delta x$ 进行数值计算。\n\n定义动能密度输入的均匀微扰为\n$$\n\\tau(x) \\rightarrow \\tau'(x) = \\tau(x) + \\delta,\n$$\n其中 $\\delta$ 是一个小常数。在理想的物理构造下，如果泛函对此类平移是规范不变的，那么 $\\tau(x)$ 的均匀平移不应改变物理可测量的总量；否则，将出现诊断性变化。\n\n将高斯中心 $R_i$ 上的力定义为总能量相对于 $R_i$ 的负导数，\n$$\nF_i = -\\frac{\\partial E}{\\partial R_i}.\n$$\n通过位移为 $h$ 的对称有限差分近似来数值计算力，\n$$\nF_i \\approx -\\frac{E(R_i + h) - E(R_i - h)}{2h},\n$$\n同时保持所有其他参数固定。\n\n您的任务是编写一个程序，对于下面指定的每个测试用例，计算未受扰动的 $\\tau(x)$ 和受扰动的 $\\tau'(x) = \\tau(x) + \\delta$ 情况下的总能量和力，然后通过检查能量绝对差是否小于或等于阈值 $\\varepsilon_E$ 以及力的分量的最大绝对差是否小于或等于阈值 $\\varepsilon_F$ 来评估不变性。\n\n除非在测试用例中被覆盖，否则请使用以下固定参数值：\n- $c_{\\mathrm{TF}} = \\frac{3}{10}(3\\pi^2)^{2/3}$,\n- $\\lambda_{\\mathrm{W}} = 1$,\n- $n_{\\mathrm{floor}} = 10^{-3}$,\n- $a = 0.5$,\n- $q = 1$,\n- 有限差分力位移 $h = 10^{-3}$。\n\n测试套件：\n- 用例 1（规范敏感，理想路径）：$L = 10$, $N = 4096$, $M = 2$, $R = [3.2, 6.9]$, $\\sigma = [0.25, 0.25]$, $w = [1.0, 0.8]$, $\\delta = 10^{-3}$, $\\varepsilon_E = 10^{-6}$, $\\varepsilon_F = 10^{-6}$，能量密度 $e_{\\mathrm{sens}}(x)$。\n- 用例 2（对均匀平移规范不变）：与用例 1 相同，但使用 $e_{\\mathrm{inv}}(x)$，其中 $q = 1$, $\\delta = 10^{-3}$, $\\varepsilon_E = 10^{-8}$, $\\varepsilon_F = 10^{-8}$。\n- 用例 3（零微扰边界检查）：与用例 1 相同，但 $\\delta = 0$, $\\varepsilon_E = 10^{-12}$, $\\varepsilon_F = 10^{-12}$，能量密度 $e_{\\mathrm{sens}}(x)$。\n- 用例 4（靠近边界的边缘位置，对均匀平移规范不变）：$L = 10$, $N = 2048$, $M = 2$, $R = [0.1, 9.9]$, $\\sigma = [0.20, 0.30]$, $w = [1.2, 0.6]$, $\\delta = 10^{-3}$, $\\varepsilon_E = 10^{-8}$, $\\varepsilon_F = 10^{-8}$，能量密度 $e_{\\mathrm{inv}}(x)$，$q = 1$。\n\n对于每个测试用例，输出两个布尔值：第一个表示能量是否在指定阈值内保持不变，第二个表示所有力的分量是否在指定阈值内保持不变。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，排序如下\n$$\n[\\text{E\\_inv}^{(1)}, \\text{F\\_inv}^{(1)}, \\text{E\\_inv}^{(2)}, \\text{F\\_inv}^{(2)}, \\text{E\\_inv}^{(3)}, \\text{F\\_inv}^{(3)}, \\text{E\\_inv}^{(4)}, \\text{F\\_inv}^{(4)}],\n$$\n其中 $\\text{E\\_inv}^{(k)}$ 和 $\\text{F\\_inv}^{(k)}$ 是用例 $k$ 的能量和力的不变性布尔值。不需要物理单位；所有量均视为无量纲。不出现角度。不使用百分比。",
            "solution": "问题陈述是有效的。它提出了一个基于密度泛函理论（DFT）和数值分析原理的良定计算任务。所有必需的定义、参数和步骤都已明确，并且没有科学或逻辑上的矛盾。\n\n问题的核心是研究两种模型亚广义梯度近似（meta-GGA）能量泛函相对于动能密度 $\\tau(x)$ 均匀平移的“规范不变性”。解决方案涉及在一维周期性网格上实现一个数值模型，并计算在此微扰下总能量和粒子间力的变化。\n\n算法设计遵循以下步骤：\n\n1.  **域离散化**：将长度为 $L$ 的连续一维周期性域离散为 $N$ 个网格点 $x_j = j \\Delta x$，$j = 0, \\dots, N-1$，其中网格间距为 $\\Delta x = L/N$。\n\n2.  **电子密度计算**：电子密度 $n(x)$ 被构造为 $M$ 个高斯函数的叠加。对于周期性边界条件，网格点 $x$ 和高斯中心 $R_i$ 之间的距离 $(x - R_i)$ 使用最小镜像约定来计算。在周长为 $L$ 的圆上的周期性距离 $d_p(x, R_i)$ 由 $d_p = d - L \\cdot \\text{round}(d/L)$ 给出，其中 $d = x - R_i$。然后使用以下公式计算每个网格点 $x_j$ 处的密度：\n    $$\n    n(x_j) = \\sum_{i=1}^{M} \\frac{w_i}{\\sqrt{2\\pi}\\sigma_i} \\exp\\left(-\\frac{d_p(x_j, R_i)^2}{2\\sigma_i^2}\\right)\n    $$\n\n3.  **梯度计算**：空间梯度，如 $\\nabla n(x)$ 和 $\\nabla \\tau(x)$，使用带周期性边界条件的二阶中心有限差分格式进行数值近似。对于在网格上离散为 $f_j = f(x_j)$ 的函数 $f(x)$，在点 $j$ 的导数为：\n    $$\n    (\\nabla f)_j \\approx \\frac{f_{j+1} - f_{j-1}}{2\\Delta x}\n    $$\n    索引进行周期性处理，即 $f_N = f_0$ 和 $f_{-1} = f_{N-1}$。这可以通过使用数组滚动操作来高效实现。\n\n4.  **动能密度计算**：模型动能密度 $\\tau(x)$ 是 Thomas-Fermi 项和 Weizsäcker 项之和。前者对于均匀电子气是精确的，后者对于单轨道系统是精确的，并提供了领头阶梯度修正。它在每个网格点上计算如下：\n    $$\n    \\tau(x_j) = c_{\\mathrm{TF}} n(x_j)^{5/3} + \\lambda_{\\mathrm{W}} \\frac{|\\nabla n(x_j)|^2}{8\\left(n(x_j) + n_{\\mathrm{floor}}\\right)}\n    $$\n    其中 $c_{\\mathrm{TF}} = \\frac{3}{10}(3\\pi^2)^{2/3}$。$n_{\\mathrm{floor}}$ 项是添加到分母的一个小的正常数，以确保在 $n(x)$ 趋近于零的区域具有数值稳定性。\n\n5.  **总能量计算**：该程序实现了两种形式的类 meta-GGA 能量密度 $e(x)$。\n    *   规范敏感形式 $e_{\\mathrm{sens}}(x) = a \\frac{\\tau(x)}{n(x) + n_{\\mathrm{floor}}}$ 显式地依赖于 $\\tau(x)$ 的绝对值。一个均匀平移 $\\tau(x) \\to \\tau(x) + \\delta$ 将直接改变 $e_{\\mathrm{sens}}(x)$，从而导致总能量的改变。\n    *   规范不变形式 $e_{\\mathrm{inv}}(x) = a \\frac{|\\nabla \\tau(x)|^2}{(n(x) + n_{\\mathrm{floor}})^q}$ 仅依赖于 $\\tau(x)$ 的梯度。由于常数的梯度为零，$\\nabla(\\tau(x) + \\delta) = \\nabla\\tau(x)$，因此根据其构造，该泛函形式对 $\\tau(x)$ 的均匀平移是不变的。\n\n    总能量 $E$ 是通过使用简单的黎曼和对适当的能量密度 $e(x)$ 在域上进行数值积分来计算的：\n    $$\n    E = \\int_0^L e(x)\\, dx \\approx \\sum_{j=0}^{N-1} e(x_j)\\,\\Delta x\n    $$\n\n6.  **力计算**：第 $i$ 个高斯中心 $R_i$ 上的力 $F_i$ 是总能量的负梯度，$F_i = -\\frac{\\partial E}{\\partial R_i}$。该导数使用位移为 $h$ 的对称有限差分格式进行数值近似：\n    $$\n    F_i \\approx -\\frac{E(R_1, \\dots, R_i + h, \\dots, R_M) - E(R_1, \\dots, R_i - h, \\dots, R_M)}{2h}\n    $$\n    这需要为每个力的分量 $F_i$ 重新计算总能量 $E$ 两次。\n\n7.  **不变性分析**：对于每个测试用例，程序执行以下序列：\n    a. 使用未受扰动的动能密度 $\\tau(x)$ 计算参考总能量 $E_0$ 和力 $\\vec{F}_0$。\n    b. 使用 $\\tau'(x) = \\tau(x) + \\delta$ 计算受扰动的总能量 $E_\\delta$ 和力 $\\vec{F}_\\delta$。\n    c. 通过检查绝对差 $|E_\\delta - E_0|$ 是否小于或等于指定的阈值 $\\varepsilon_E$ 来评估能量不变性。\n    d. 通过检查所有力的分量中的最大绝对差 $\\max_i |F_{i, \\delta} - F_{i, 0}|$ 是否小于或等于指定的阈值 $\\varepsilon_F$ 来评估力的不变性。\n    e. 将每个测试用例的两个布尔值结果收集并格式化以用于最终输出。\n\n这个全面的程序允许对设计到模型泛函中的规范不变性特性进行直接的数值测试。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n\n    # Fixed parameters as defined in the problem statement\n    C_TF = (3.0 / 10.0) * (3.0 * np.pi**2)**(2.0 / 3.0)\n    LAMBDA_W = 1.0\n    N_FLOOR = 1e-3\n    A_PARAM = 0.5\n    H_FORCE = 1e-3\n\n    # Test cases from the problem statement\n    test_cases = [\n        {'case': 1, 'L': 10, 'N': 4096, 'M': 2, 'R': [3.2, 6.9], 'sigma': [0.25, 0.25], 'w': [1.0, 0.8],\n         'delta': 1e-3, 'eps_E': 1e-6, 'eps_F': 1e-6, 'type': 'sens', 'q': 1.0},\n        {'case': 2, 'L': 10, 'N': 4096, 'M': 2, 'R': [3.2, 6.9], 'sigma': [0.25, 0.25], 'w': [1.0, 0.8],\n         'delta': 1e-3, 'eps_E': 1e-8, 'eps_F': 1e-8, 'type': 'inv', 'q': 1.0},\n        {'case': 3, 'L': 10, 'N': 4096, 'M': 2, 'R': [3.2, 6.9], 'sigma': [0.25, 0.25], 'w': [1.0, 0.8],\n         'delta': 0.0, 'eps_E': 1e-12, 'eps_F': 1e-12, 'type': 'sens', 'q': 1.0},\n        {'case': 4, 'L': 10, 'N': 2048, 'M': 2, 'R': [0.1, 9.9], 'sigma': [0.20, 0.30], 'w': [1.2, 0.6],\n         'delta': 1e-3, 'eps_E': 1e-8, 'eps_F': 1e-8, 'type': 'inv', 'q': 1.0},\n    ]\n\n    def get_total_energy(params, R_vec, tau_shift):\n        \"\"\"\n        Computes the total energy for a given set of parameters and a tau shift.\n        \"\"\"\n        L, N, M, sigma, w = params['L'], params['N'], params['M'], params['sigma'], params['w']\n        q, e_type = params['q'], params['type']\n        \n        dx = L / N\n        x_grid = np.linspace(0, L, N, endpoint=False)\n\n        # 1. Calculate electron density n(x) with periodic boundary conditions\n        n = np.zeros(N)\n        for i in range(M):\n            dist = x_grid - R_vec[i]\n            periodic_dist = dist - L * np.round(dist / L)\n            gaussian = (w[i] / (np.sqrt(2 * np.pi) * sigma[i])) * \\\n                       np.exp(-periodic_dist**2 / (2 * sigma[i]**2))\n            n += gaussian\n\n        n_plus_floor = n + N_FLOOR\n\n        # 2. Calculate gradient of n(x)\n        grad_n = (np.roll(n, -1) - np.roll(n, 1)) / (2 * dx)\n\n        # 3. Calculate kinetic energy density tau(x)\n        term_tf = C_TF * n**(5.0 / 3.0)\n        term_w = LAMBDA_W * grad_n**2 / (8.0 * n_plus_floor)\n        tau = term_tf + term_w\n        \n        # 4. Apply perturbation\n        tau_perturbed = tau + tau_shift\n\n        # 5. Calculate energy density e(x)\n        if e_type == 'sens':\n            e_density = A_PARAM * tau_perturbed / n_plus_floor\n        elif e_type == 'inv':\n            grad_tau_perturbed = (np.roll(tau_perturbed, -1) - np.roll(tau_perturbed, 1)) / (2 * dx)\n            e_density = A_PARAM * grad_tau_perturbed**2 / (n_plus_floor**q)\n        else:\n            raise ValueError(\"Unknown energy density type\")\n\n        # 6. Calculate total energy E\n        total_energy = np.sum(e_density) * dx\n        return total_energy\n\n    def calculate_forces(params, R_vec, tau_shift):\n        \"\"\"\n        Calculates forces on each Gaussian center via finite differences.\n        \"\"\"\n        M = params['M']\n        forces = np.zeros(M)\n        for i in range(M):\n            R_plus = np.copy(R_vec)\n            R_plus[i] += H_FORCE\n            E_plus = get_total_energy(params, R_plus, tau_shift)\n\n            R_minus = np.copy(R_vec)\n            R_minus[i] -= H_FORCE\n            E_minus = get_total_energy(params, R_minus, tau_shift)\n\n            forces[i] = -(E_plus - E_minus) / (2 * H_FORCE)\n        return forces\n\n    results = []\n    for params in test_cases:\n        R_vec = np.array(params['R'])\n        \n        # Calculate for unperturbed case (tau_shift = 0)\n        E0 = get_total_energy(params, R_vec, 0.0)\n        F0 = calculate_forces(params, R_vec, 0.0)\n\n        # Calculate for perturbed case (tau_shift = delta)\n        delta = params['delta']\n        Ed = get_total_energy(params, R_vec, delta)\n        Fd = calculate_forces(params, R_vec, delta)\n\n        # Perform invariance checks\n        is_E_inv = np.abs(Ed - E0) = params['eps_E']\n        is_F_inv = np.max(np.abs(Fd - F0)) = params['eps_F']\n\n        results.extend([is_E_inv, is_F_inv])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然meta-GGA泛函的准确性更高，但它们对动能密度 $\\tau$ 的依赖性也可能引入数值不稳定性，尤其是在自洽场（SCF）迭代收敛过程中。这个计算练习将让您通过一个简化的线性响应模型，来分析SCF收敛性与meta-GGA泛函对 $\\tau$ 敏感度之间的直接联系 。通过计算收敛映射的谱半径，您将量化这种依赖性如何影响收敛，并理解在实际计算中可能遇到的挑战。",
            "id": "3465724",
            "problem": "考虑一个原子单位制下的一维周期性体系，该体系在 Kohn–Sham 密度泛函理论 (DFT) 框架内通过自洽场 (SCF) 迭代进行求解。交换相关势由meta-广义梯度近似 (meta-GGA) 建模，它同时依赖于电子密度 $n(x)$ 和动能密度 $\\tau(x)$。我们研究强非均匀的电荷密度波，将自洽场密度更新映射在一个稳态解周围进行线性化，并分析雅可比矩阵的谱半径以确定线性混合下的收敛性。\n\n基本定义和假设：\n- SCF 更新在密度上使用线性混合，混合参数为 $m \\in (0,1)$。对于一个小的密度微扰 $\\delta n(x)$，其在波矢 $q$ 处的傅里叶分量记为 $\\delta n(q)$。\n- 在 Kohn–Sham 响应下，诱导的密度变化由 $\\delta n_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$ 给出，其中 $\\chi_0(q)$ 是静态无相互作用密度-密度响应函数（磁化率），$\\delta v_{\\mathrm{eff}}(q)$ 是有效势变分，包含哈特里（库仑）贡献和交换相关贡献。\n- 有效势变分为 $\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta n(q) + \\delta v_{xc}(q)$，其中 $v_c(q)$ 是屏蔽库仑核函数，$\\delta v_{xc}(q)$ 是交换相关变分。\n- 对于 meta-GGA，交换相关变分满足链式法则 $\\delta v_{xc}(q) = \\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)\\delta n(q) + \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)\\delta \\tau(q)$，该式在稳态解处求值，其中 $\\frac{\\partial v_{xc}}{\\partial n}$ 和 $\\frac{\\partial v_{xc}}{\\partial \\tau}$ 被视为相对于稳态周围小微扰的常数。\n- 对于具有傅里叶分量 $q$ 的电荷密度波，动能密度变分被建模为 $\\delta \\tau(q) = \\gamma\\,q^2\\,\\delta n(q)$，其中 $\\gamma0$ 是一个模型系数，用于捕捉 $\\tau$ 随 Kohn–Sham 轨道中空间梯度的标度关系。\n\n密度的线性混合更新为 $ \\delta n_{\\mathrm{new}}(q) = (1-m)\\,\\delta n_{\\mathrm{in}}(q) + m\\,\\delta n_{\\mathrm{out}}(q) $。这定义了一个线性化映射，其雅可比矩阵 $J$ 在傅里叶基 $\\{q\\}$ 中是对角的，其特征值 $\\lambda(q)$ 依赖于系统参数。在线性混合下，SCF 迭代的收敛条件是谱半径 $\\rho = \\max_q |\\lambda(q)|$ 满足 $ \\rho  1 $。\n\n本问题中使用的模型核函数：\n- 对无相互作用磁化率使用类 Thomas–Fermi 模型\n$$\n\\chi_0(q) = -\\frac{\\chi_{\\rm amp}}{1 + \\left(\\frac{q}{q_0}\\right)^2},\n$$\n其中 $\\chi_{\\rm amp}0$ 且 $q_00$。\n- 使用 Yukawa 屏蔽库仑核函数\n$$\nv_c(q) = \\frac{\\alpha_c}{q^2 + \\kappa^2},\n$$\n其中 $\\alpha_c0$ 且 $\\kappa0$。\n- 将 $\\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)=c_n$ 和 $\\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)=s$ 视为每个测试用例指定的常数。meta-GGA 贡献通过上述链式法则建模，其中 $\\delta \\tau(q)=\\gamma q^2 \\delta n(q)$。\n\n设 $L$ 为系统长度，$N$ 为实空间格点数。使用离散傅里叶模式 $q_k = \\frac{2\\pi}{L}k$，其中整数索引 $k$ 的范围是 $k = 0, 1, \\dots, \\lfloor \\frac{N}{2} \\rfloor$，这覆盖了直至奈奎斯特频率的非负波数。对于每个测试用例，在这些模式上构建线性化映射的特征值，计算谱半径 $\\rho$，并确定实现该谱半径的最大化模式 $q^\\star$。为量化对 meta-GGA 动能密度依赖性的敏感度，计算在最大化模式 $q^\\star$ 处的偏导数 $\\left.\\frac{\\partial \\lambda(q)}{\\partial s}\\right|_{q=q^\\star}$。\n\n您的程序必须：\n1. 对于每个测试用例，根据 $L$ 和 $N$ 的规定生成非负傅里叶模式 $q_k$ 的集合。\n2. 使用基本定义和模型核函数，推导并计算线性化 SCF 映射的特征值 $\\lambda(q_k)$、谱半径 $\\rho = \\max_k |\\lambda(q_k)|$、最大化波矢 $q^\\star$ 以及敏感度 $\\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$。\n3. 生成单行输出，按顺序包含每个测试用例的谱半径和在 $q^\\star$ 处评估的敏感度，形式为方括号内的逗号分隔列表。将每个数字表示为四舍五入到六位小数的浮点数。不需要物理单位；在原子单位制中所有量均为无量纲。\n\n测试套件：\n- 情况 1（常规情况）：$L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.1$。\n- 情况 2（更大的 meta-GGA 敏感度）：$L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.6$。\n- 情况 3（负的 meta-GGA 敏感度）：$L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=-0.2$。\n- 情况 4（接近不稳定的临界混合）：$L=20$, $N=512$, $m=0.9$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.3$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为方括号内的逗号分隔列表，顺序为 $[\\rho_1, S_1, \\rho_2, S_2, \\rho_3, S_3, \\rho_4, S_4]$，其中 $\\rho_i$ 是情况 $i$ 的谱半径，$S_i$ 是情况 $i$ 的敏感度 $\\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$，每个值都四舍五入到六位小数。",
            "solution": "首先对问题进行严格的验证过程。\n\n### 步骤 1：提取给定条件\n- **SCF 更新规则**：对密度微扰使用线性混合，混合参数为 $m \\in (0,1)$：$\\delta n_{\\mathrm{new}}(q) = (1-m)\\,\\delta n_{\\mathrm{in}}(q) + m\\,\\delta n_{\\mathrm{out}}(q)$。\n- **Kohn–Sham 响应**：诱导的密度变化为 $\\delta n_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$，其中 $\\chi_0(q)$ 是静态无相互作用磁化率。\n- **有效势变分**：$\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta n(q) + \\delta v_{xc}(q)$，其中 $v_c(q)$ 是屏蔽库仑核函数。\n- **meta-GGA 交换相关变分**：$\\delta v_{xc}(q) = \\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)\\delta n(q) + \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)\\delta \\tau(q)$。对于给定的稳态，偏导数是常数，记为 $c_n = \\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)$ 和 $s = \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)$。\n- **动能密度变分模型**：$\\delta \\tau(q) = \\gamma\\,q^2\\,\\delta n(q)$，模型系数 $\\gamma0$。\n- **SCF 收敛条件**：线性化映射的雅可比矩阵的谱半径 $\\rho = \\max_q |\\lambda(q)|$ 必须满足 $\\rho  1$。\n- **磁化率模型**：$\\chi_0(q) = -\\frac{\\chi_{\\rm amp}}{1 + \\left(\\frac{q}{q_0}\\right)^2}$，其中 $\\chi_{\\rm amp}0$ 且 $q_00$。\n- **库仑核函数模型**：$v_c(q) = \\frac{\\alpha_c}{q^2 + \\kappa^2}$，其中 $\\alpha_c0$ 且 $\\kappa0$。\n- **离散傅里叶模式**：波矢为 $q_k = \\frac{2\\pi}{L}k$，其中整数索引 $k = 0, 1, \\dots, \\lfloor \\frac{N}{2} \\rfloor$。\n- **任务**：计算谱半径 $\\rho$、最大化模式 $q^\\star$ 和敏感度 $\\left.\\frac{\\partial \\lambda(q)}{\\partial s}\\right|_{q=q^\\star}$。\n- **测试用例 1**：$L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.1$。\n- **测试用例 2**：$L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.6$。\n- **测试用例 3**：$L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=-0.2$。\n- **测试用例 4**：$L=20$, $N=512$, $m=0.9$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.3$。\n\n### 步骤 2：使用提取的给定条件进行验证\n根据指定标准对问题进行评估：\n- **科学基础**：该问题基于 Kohn-Sham 密度泛函理论 (DFT) 的既定原理，特别是自洽场 (SCF) 收敛性的线性响应分析。对磁化率和库仑相互作用使用简化模型是理论固态物理学中分析一般趋势的标准做法。meta-GGA 泛函的模型与其定义一致。该问题在科学上是合理的。\n- **适定性**：问题陈述明确无误。它提供了所有必要的数学公式、参数和明确定义的计算任务。对于给定的离散波矢集合，保证存在唯一的谱半径 $\\rho$。\n- **客观性**：问题以精确、客观的数学和物理语言陈述，没有主观或定性的论断。\n\n该问题没有任何无效标志。它在科学上是合理的，形式上是明确的，完整的，一致的，并且在计算上是可行的。\n\n### 步骤 3：结论与行动\n问题是**有效的**。将开发一个解决方案。\n\n### 基于原理的设计\n该解决方案需要两个主要步骤：首先，推导所需量的解析表达式；其次，基于这些表达式实现数值计算。\n\n**1. 雅可比特征值 $\\lambda(q)$ 的推导**\n目标是找到将输入密度微扰 $\\delta n_{\\mathrm{in}}(q)$ 转换为经过一步带线性混合的 SCF 后的新微扰 $\\delta n_{\\mathrm{new}}(q)$ 的线性映射的特征值 $\\lambda(q)$。更新规则是：\n$$\n\\delta n_{\\mathrm{new}}(q) = (1-m)\\,\\delta n_{\\mathrm{in}}(q) + m\\,\\delta n_{\\mathrm{out}}(q)\n$$\n在线性区域，特征值 $\\lambda(q)$ 是比率 $\\delta n_{\\mathrm{new}}(q) / \\delta n_{\\mathrm{in}}(q)$：\n$$\n\\lambda(q) = 1 - m + m \\frac{\\delta n_{\\mathrm{out}}(q)}{\\delta n_{\\mathrm{in}}(q)}\n$$\n$\\delta n_{\\mathrm{out}}(q)$ 是 Kohn-Sham 系统对输入微扰 $\\delta n_{\\mathrm{in}}(q)$ 的响应。为了在接下来的步骤中更清晰，我们记 $\\delta n(q) \\equiv \\delta n_{\\mathrm{in}}(q)$。Kohn-Sham 响应是 $\\delta n_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$。有效势变分 $\\delta v_{\\mathrm{eff}}(q)$ 是由 $\\delta n(q)$ 引起的：\n$$\n\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta n(q) + \\delta v_{xc}(q)\n$$\n对于 meta-GGA 泛函，交换相关势变分 $\\delta v_{xc}(q)$ 由链式法则给出，使用提供的常数导数和 $\\delta\\tau(q)$ 的模型：\n$$\n\\delta v_{xc}(q) = c_n\\,\\delta n(q) + s\\,\\delta \\tau(q) = c_n\\,\\delta n(q) + s(\\gamma\\,q^2\\,\\delta n(q)) = (c_n + s \\gamma q^2) \\, \\delta n(q)\n$$\n将此代入 $\\delta v_{\\mathrm{eff}}(q)$ 的表达式中：\n$$\n\\delta v_{\\mathrm{eff}}(q) = \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\delta n(q)\n$$\n输出密度微扰则为：\n$$\n\\delta n_{\\mathrm{out}}(q) = \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\delta n(q)\n$$\n由此，我们得到 $\\lambda(q)$ 所需的比率：\n$$\n\\frac{\\delta n_{\\mathrm{out}}(q)}{\\delta n_{\\mathrm{in}}(q)} = \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right)\n$$\n最后，将此代入 $\\lambda(q)$ 的表达式，并插入 $\\chi_0(q)$ 和 $v_c(q)$ 的模型核函数，得到完整公式：\n$$\n\\lambda(q) = 1 - m + m \\left( -\\frac{\\chi_{\\rm amp} q_0^2}{q^2 + q_0^2} \\right) \\left( \\frac{\\alpha_c}{q^2 + \\kappa^2} + c_n + s \\gamma q^2 \\right)\n$$\n这是需要进行数值计算的核心表达式。\n\n**2. 敏感度 $\\frac{\\partial \\lambda(q)}{\\partial s}$ 的推导**\n特征值对 meta-GGA 参数 $s$ 的敏感度是其偏导数 $\\frac{\\partial \\lambda(q)}{\\partial s}$。我们对 $\\lambda(q)$ 的表达式关于 $s$ 求导，将所有其他参数和 $q$ 视为常数：\n$$\n\\frac{\\partial \\lambda(q)}{\\partial s} = \\frac{\\partial}{\\partial s} \\left[ 1 - m + m \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\right]\n$$\n唯一依赖于 $s$ 的项是 $m \\chi_0(q) s \\gamma q^2$。它对 $s$ 的导数是 $m \\chi_0(q) \\gamma q^2$。\n$$\n\\frac{\\partial \\lambda}{\\partial s}(q) = m \\chi_0(q) (\\gamma q^2) = m \\left( -\\frac{\\chi_{\\rm amp} q_0^2}{q^2 + q_0^2} \\right) (\\gamma q^2) = - \\frac{m \\gamma \\chi_{\\rm amp} q_0^2 q^2}{q^2 + q_0^2}\n$$\n这个表达式将在使 $|\\lambda(q)|$ 最大化的特定波矢 $q^\\star$ 处进行求值。\n\n**3. 计算算法**\n对于每个具有给定参数集 $\\{L, N, m, \\alpha_c, \\kappa, \\chi_{\\rm amp}, q_0, \\gamma, c_n, s\\}$ 的测试用例：\n1.  生成离散波矢网格：$q_k = \\frac{2\\pi}{L}k$，其中 $k \\in \\{0, 1, \\dots, \\lfloor N/2 \\rfloor\\}$。\n2.  对于网格上的每个 $q_k$，使用推导的公式计算特征值 $\\lambda(q_k)$。\n3.  计算所有 $k$ 的绝对值 $|\\lambda(q_k)|$。\n4.  谱半径为 $\\rho = \\max_k |\\lambda(q_k)|$。\n5.  找到产生此最大值的索引 $k^\\star$，即 $|\\lambda(q_{k^\\star})| = \\rho$。最大化波矢为 $q^\\star = q_{k^\\star}$。\n6.  使用在 $q = q^\\star$ 处求值的推导公式计算敏感度 $S = \\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$。\n7.  存储数值对 $(\\rho, S)$，并对所有测试用例重复此过程。\n8.  将最终结果格式化为指定的单行字符串。\n整个过程在提供的 Python 代码中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DFT SCF convergence problem for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.1},\n        # Case 2: larger meta-GGA sensitivity\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.6},\n        # Case 3: negative meta-GGA sensitivity\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': -0.2},\n        # Case 4: edge mixing close to instability\n        {'L': 20, 'N': 512, 'm': 0.9, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.3},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        L = case['L']\n        N = case['N']\n        m = case['m']\n        alpha_c = case['alpha_c']\n        kappa = case['kappa']\n        chi_amp = case['chi_amp']\n        q0 = case['q0']\n        gamma = case['gamma']\n        cn = case['cn']\n        s = case['s']\n\n        # 1. Generate the set of nonnegative Fourier modes q_k\n        k_indices = np.arange(0, N // 2 + 1)\n        q = (2 * np.pi / L) * k_indices\n\n        # 2. Derive and compute the eigenvalues lambda(q_k)\n        \n        # Model for susceptibility chi_0(q)\n        q_sq = q**2\n        chi0_q = -chi_amp * q0**2 / (q_sq + q0**2)\n        \n        # Model for Coulomb kernel v_c(q)\n        vc_q = alpha_c / (q_sq + kappa**2)\n        \n        # Expression for the eigenvalue lambda(q)\n        # lambda(q) = 1 - m + m * chi_0(q) * (v_c(q) + c_n + s * gamma * q^2)\n        lambda_q = 1.0 - m + m * chi0_q * (vc_q + cn + s * gamma * q_sq)\n\n        # Compute the spectral radius rho = max_k |lambda(q_k)|\n        abs_lambda_q = np.abs(lambda_q)\n        rho = np.max(abs_lambda_q)\n\n        # Identify the maximizing wavevector q_star\n        idx_star = np.argmax(abs_lambda_q)\n        q_star = q[idx_star]\n        q_star_sq = q_star**2\n\n        # Compute the sensitivity d(lambda)/ds at q_star\n        # d(lambda)/ds = m * chi_0(q) * gamma * q^2\n        # d(lambda)/ds = - m * gamma * chi_amp * q0^2 * q^2 / (q^2 + q0^2)\n        sensitivity = - (m * gamma * chi_amp * q0**2 * q_star_sq) / (q_star_sq + q0**2)\n        \n        # Append results for this case, formatted to six decimal places\n        results.append(f\"{rho:.6f}\")\n        results.append(f\"{sensitivity:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}