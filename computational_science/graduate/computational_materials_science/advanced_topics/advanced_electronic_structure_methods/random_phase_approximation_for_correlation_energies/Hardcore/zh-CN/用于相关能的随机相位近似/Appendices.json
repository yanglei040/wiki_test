{
    "hands_on_practices": [
        {
            "introduction": "在随机相位近似（RPA）的计算中，相关能的计算涉及到对所有可能的电子跃迁（从占据态到非占据态）进行求和。在实际操作中，我们只能包含有限数量的非占据（或“空”）能带，这会引入基组截断误差。本练习将探讨如何系统地处理这一限制。您将首先推导相关能误差与所包含的空能带数量 $N_b$ 之间的数学关系，然后利用此关系建立一个外推方案，以估算在完备基组极限下的能量。这项实践对于从有限的计算资源中获得高精度的RPA结果至关重要。",
            "id": "3484848",
            "problem": "要求您从独立粒子极化率出发，分析并实现一种用于随机相近似 (RPA) 关联能的外推方案。请使用虚频轴上独立粒子极化率的表达式（Adler–Wiser 形式）作为基本依据，并结合随机相近似 (RPA) 中的关联能公式。从第一性原理出发，论证高能空态对关联能的渐近贡献，推导截断误差随空带数量变化的标度关系，并实现一个稳健的外推算法。\n\n基本出发点是：\n- 虚频轴上以态求和形式表示的独立粒子极化率（也称不可约极化率），\n$$\n\\chi_0(\\mathbf{r},\\mathbf{r}';i\\omega) \\;=\\; \\sum_{n,m} \\left[f_n - f_m\\right]\\,\n\\frac{\\psi_n(\\mathbf{r})\\psi_m^\\ast(\\mathbf{r})\\,\\psi_m(\\mathbf{r}')\\psi_n^\\ast(\\mathbf{r}')\\;2\\left(\\varepsilon_m - \\varepsilon_n\\right)}\n{\\left(\\varepsilon_m - \\varepsilon_n\\right)^2 + \\omega^2}\\,,\n$$\n其中 $\\psi_n$ 是单粒子轨道，$\\varepsilon_n$ 是相应的本征值， $f_n$ 是零温下的占据数 ($f_n \\in \\{0,1\\}$)。\n- RPA 关联能，\n$$\nE_c^{\\text{RPA}} \\;=\\; \\frac{1}{2\\pi}\\int_{0}^{\\infty} \\mathrm{d}\\omega\\ \\mathrm{Tr}\\left[\\ln\\left(1 - v\\,\\chi_0(i\\omega)\\right) + v\\,\\chi_0(i\\omega)\\right],\n$$\n其中 $v$ 是库仑核，$\\mathrm{Tr}$ 表示对空间自由度的迹（例如，对于平面波基组，是对倒格矢求迹）。\n\n任务 A（推导）：\n- 考虑一个三维（$3$维）有隙系统，其高能导带态具有抛物线色散，单粒子态密度 (DOS) 在大能量 $E$ 时满足 $g(E)\\propto \\sqrt{E}$。假设在大跃迁能量下，跃迁矩阵元随能量变化缓慢或以幂律形式衰减，您必须根据态求和表达式的结构证明这一点。从上述表达式出发，利用物理上合理的渐近近似，推导截断误差 $\\Delta E_c^{\\text{RPA}}(N_b)$ 作为所包含空带数量 $N_b$ 的函数的主导阶标度关系。\n- 根据您的推导，提出一个形式为\n$$\nE_c^{\\text{RPA}}(N_b) \\;=\\; E_{\\infty} \\;+\\; A\\,N_b^{-\\beta},\n$$\n的外推模型，并确定三维抛物线色散情况下的指数 $\\beta$。\n\n任务 B（算法设计）：\n- 设计一个数值稳定的算法。给定一组数据点 $\\{(N_b^{(i)}, E_c^{\\text{RPA}}(N_b^{(i)}))\\}_{i=1}^M$ 和一个理论上合理的固定指数 $\\beta$，通过对以下模型进行最小二乘拟合来估计 $E_{\\infty}$ 和 $A$：\n$$\nE_c^{\\text{RPA}}(N_b) \\;=\\; E_{\\infty} \\;+\\; A\\,N_b^{-\\beta}.\n$$\n- 解释您如何处理条件数问题，以及为什么对变换后的回归量 $x_i = N_b^{-\\beta}$ 进行线性回归是合适的。\n\n任务 C（实现与测试）：\n- 实现一个完整、可运行的程序，该程序：\n  - 使用任务 A 中推导出的指数值 $\\beta$。\n  - 对于下方的每个测试用例，使用精确模型生成 $E_c^{\\text{RPA}}(N_b)$ 值的合成数据集：\n    $$\n    E_c^{\\text{RPA}}(N_b) \\;=\\; E_{\\infty}^{\\text{(true)}} \\;+\\; A^{\\text{(true)}}\\,N_b^{-\\beta},\n    $$\n    不添加额外噪声。\n  - 将模型拟合回合成数据，通过最小二乘法估计 $E_{\\infty}$。\n  - 输出每个测试用例估计出的 $E_{\\infty}$。\n\n- 物理单位：关联能必须以电子伏特/电子 (eV/electron) 为单位处理和报告。您的程序必须以 eV/electron 为单位打印估计的 $E_{\\infty}$ 值，并四舍五入到 $6$ 位小数。\n\n- 角度单位不适用。百分比不适用。\n\n测试套件：\n- 使用以下四个测试用例。在每个用例中，程序必须生成合成数据，然后执行拟合：\n  - 用例 1：$E_{\\infty}^{\\text{(true)}} = -1.500000$ eV/electron， $A^{\\text{(true)}} = 0.900000$ eV/electron，其中 $N_b \\in [8,16,32,64,128,256]$。\n  - 用例 2：$E_{\\infty}^{\\text{(true)}} = -0.750000$ eV/electron， $A^{\\text{(true)}} = 0.300000$ eV/electron，其中 $N_b \\in [10,20,40,80,160]$。\n  - 用例 3：$E_{\\infty}^{\\text{(true)}} = -2.345678$ eV/electron， $A^{\\text{(true)}} = 0.050000$ eV/electron，其中 $N_b \\in [50,100,200,400,800,1600]$。\n  - 用例 4（立即收敛的边界情况）：$E_{\\infty}^{\\text{(true)}} = -1.000000$ eV/electron， $A^{\\text{(true)}} = 0.000000$ eV/electron，其中 $N_b \\in [16,32,64]$。\n\n要求的最终输出格式：\n- 您的程序应产生单行输出，其中包含四个用例估计出的 $E_{\\infty}$ 值，格式为逗号分隔的列表并用方括号括起，例如 $[x_1,x_2,x_3,x_4]$，其中每个 $x_i$ 是一个以 eV/electron 为单位、四舍五入到 $6$ 位小数的浮点数。不应打印其他任何文本。",
            "solution": "该问题的解决方案分为三部分，分别对应推导、算法设计和实现这三个任务。\n\n### 任务 A：外推模型及指数 $\\beta$ 的推导\n\n目标是确定随机相近似 (RPA) 关联能中截断误差 $\\Delta E_c^{\\text{RPA}}(N_b)$ 作为所包含空（导）带数量 $N_b$ 的函数的主导阶标度关系。该误差定义为 $\\Delta E_c^{\\text{RPA}}(N_b) = E_c^{\\text{RPA}}(N_b) - E_c^{\\text{RPA}}(\\infty)$，其中 $E_c^{\\text{RPA}}(\\infty)$ 是完全收敛的关联能。对于用 $N_b$ 个能带计算的能量，提出的模型是 $E_c^{\\text{RPA}}(N_b) = E_{\\infty} + A\\,N_b^{-\\beta}$。我们的目标是推导出指数 $\\beta$。\n\n**1. 基本方程**\n\n我们从已知的 RPA 关联能表达式开始：\n$$\nE_c^{\\text{RPA}} = \\frac{1}{2\\pi}\\int_{0}^{\\infty} \\mathrm{d}\\omega\\ \\mathrm{Tr}\\left[\\ln\\left(1 - v\\,\\chi_0(i\\omega)\\right) + v\\,\\chi_0(i\\omega)\\right],\n$$\n以及虚频轴上的独立粒子极化率：\n$$\n\\chi_0(i\\omega) = \\sum_{v,c}\n\\frac{ M_{vc} \\; 2(\\varepsilon_c - \\varepsilon_v)}\n{(\\varepsilon_c - \\varepsilon_v)^2 + \\omega^2},\n$$\n其中，求和遍历占据态（价带，$v$）和空态（导带，$c$），$\\varepsilon_i$ 是单粒子能量，$v$ 是库仑核，$M_{vc}$ 代表跃迁矩阵元乘积。在 $N_b$ 个空带处截断意味着对 $c$ 的求和仅限于前 $N_b$ 个导带。误差源于忽略了到导带 $c > N_b$ 的跃迁。\n\n**2. 渐近行为与微扰分析**\n\n向高能空态跃迁的贡献很小。对于小宗量 $X$，能量表达式的被积函数可以展开：$\\ln(1-X) + X = -\\frac{1}{2}X^2 - \\frac{1}{3}X^3 - \\dots$。高能下对关联能的主导贡献来自二阶项，通常称为二阶交换加屏蔽交换 (SOX) 能。因此，截断误差可以在此理论层次上进行分析。这种方法是分析量子化学和固态物理中基组和截断收敛性的标准方法。\n\n关联能的收敛性已知由用于表示波函数和极化率的基组的收敛性决定。在平面波计算中，该基组在某个动能截断 $E_{\\text{cut}}$ 处被截断。一个完整、严格的推导是复杂的，但已有结果表明，对于三维电子气，RPA 关联能的截断误差随能量截断的变化关系为：\n$$\n\\Delta E_c^{\\text{RPA}} \\propto E_{\\text{cut}}^{-3/2}\n$$\n这个标度关系是通过分析二阶 Møller-Plesset (MP2) 或 SOX 能量表达式得出的，其中对高能未占据态的求和被转换成动量空间中的积分。结果取决于维度（3D）和库仑相互作用的性质。根据问题建议，我们接受此关系作为渐近分析的物理上合理的出发点。\n\n**3. 关联能量截断与能带数**\n\n问题指定了按空带数 $N_b$ 进行截断，而不是能量截断 $E_{\\text{cut}}$。我们需要将这两个量联系起来。问题指出我们处理的是一个三维系统，其高能导带态是抛物线的，其态密度 (DOS) 在大能量 $E$ 时由 $g(E) \\propto \\sqrt{E}$ 给出。\n\n在某个能量截断 $E_{\\text{cut}}$（从导带底算起）以下包含的空带数 $N_b$，可以通过对 DOS 积分得到：\n$$\nN_b(E_{\\text{cut}}) = \\int_{0}^{E_{\\text{cut}}} g(E) \\,dE.\n$$\n使用给定的 DOS 标度关系，我们有：\n$$\nN_b(E_{\\text{cut}}) \\propto \\int_{0}^{E_{\\text{cut}}} E^{1/2} \\,dE \\propto [E^{3/2}]_{0}^{E_{\\text{cut}}} \\propto E_{\\text{cut}}^{3/2}.\n$$\n这给了我们能量截断和能带数之间的关系：\n$$\nE_{\\text{cut}} \\propto N_b^{2/3}.\n$$\n\n**4. 推导标度指数 $\\beta$**\n\n现在，我们可以将截断误差随能量截断的标度关系与能量截断和能带数之间的关系结合起来。将 $E_{\\text{cut}} \\propto N_b^{2/3}$ 代入误差标度关系 $\\Delta E_c^{\\text{RPA}} \\propto E_{\\text{cut}}^{-3/2}$，我们得到：\n$$\n\\Delta E_c^{\\text{RPA}}(N_b) \\propto (N_b^{2/3})^{-3/2} = N_b^{(2/3) \\times (-3/2)} = N_b^{-1}.\n$$\n因此，截断误差，即差值 $E_c^{\\text{RPA}}(N_b) - E_{\\infty}$，与 $N_b^{-1}$ 成正比。这与所提出的外推模型相符：\n$$\nE_c^{\\text{RPA}}(N_b) = E_{\\infty} + A\\,N_b^{-\\beta},\n$$\n指数为 $\\beta = 1$。常数 $A$ 代表此主导阶误差项的系数。\n\n### 任务 B：算法设计\n\n任务是设计一个数值稳定的算法，从一组计算数据点 $\\{(N_b^{(i)}, E_c^{(i)})\\}_{i=1}^M$ 出发，在给定理论推导出的固定指数 $\\beta=1$ 的情况下，估计参数 $E_{\\infty}$ 和 $A$。\n\n待拟合的模型为：\n$$\nE_c^{(i)} = E_{\\infty} + A \\cdot (N_b^{(i)})^{-\\beta}.\n$$\n我们定义 $y_i = E_c^{(i)}$ 和变换后的回归量 $x_i = (N_b^{(i)})^{-\\beta}$。通过这些定义，模型变为：\n$$\ny_i = E_{\\infty} + A x_i.\n$$\n这是一个关于参数 $E_{\\infty}$ 和 $A$ 的线性模型。因此，线性最小二乘回归是合适的方法。自变量 $N_b$ 到 $x_i$ 的变换是非线性的，但这不影响模型对其参数的线性。\n\n算法步骤如下：\n\n1.  **数据变换**：给定输入数据 $(N_b^{(i)}, y_i)$ 和固定指数 $\\beta$，为每个数据点 $i = 1, \\dots, M$ 计算变换后的自变量 $x_i = (N_b^{(i)})^{-\\beta}$。\n\n2.  **构建线性系统**：最小二乘拟合的目标是找到使残差平方和 $S = \\sum_{i=1}^M (y_i - (E_{\\infty} + A x_i))^2$ 最小化的参数 $(E_{\\infty}, A)$。这导出了著名的正规方程，可以写成矩阵形式：\n    $$\n    X^T X \\mathbf{p} = X^T \\mathbf{y}\n    $$\n    其中：\n    - $\\mathbf{p} = \\begin{pmatrix} E_{\\infty} \\\\ A \\end{pmatrix}$ 是待确定的参数向量。\n    - $\\mathbf{y} = \\begin{pmatrix} y_1 \\\\ y_2 \\\\ \\vdots \\\\ y_M \\end{pmatrix}$ 是观测到的能量值向量。\n    - $X = \\begin{pmatrix} 1 & x_1 \\\\ 1 & x_2 \\\\ \\vdots & \\vdots \\\\ 1 & x_M \\end{pmatrix}$ 是设计矩阵。第一列全为 1，对应于截距项 $E_{\\infty}$；第二列包含回归量 $x_i$ 的值。\n\n3.  **求解系统**：为确保数值稳定性，特别是如果 $X$ 的列近似共线（此处不成问题，因为 $N_b^{(i)}$ 的值是不同的），最好使用稳健的线性代数程序，而不是显式计算 $X^T X$ 的逆。标准数值库提供了解决最小二乘问题的函数，通常通过对矩阵 $X$ 进行 QR 分解或奇异值分解 (SVD) 来实现。例如，在 NumPy 中，`numpy.linalg.lstsq` 函数就是为此目的设计的。它以对不良条件数稳健的方式求解 $\\mathbf{p}$。\n\n求解器的输出将是估计的参数向量 $\\hat{\\mathbf{p}}$，我们从中提取第一个分量作为收敛关联能 $E_{\\infty}$ 的估计值。\n\n### 任务 C：实现与测试\n\n实现工作涉及编写一个 Python 脚本，该脚本使用任务 A 中推导出的指数 $\\beta=1$ 和任务 B 中的最小二乘算法。该脚本将首先为几个测试用例生成合成数据，然后应用拟合程序来恢复原始参数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes and implements an extrapolation scheme for RPA correlation energy.\n\n    This function performs the following steps for a series of test cases:\n    1. Sets the theoretically derived exponent beta for the extrapolation model\n       E_c(N_b) = E_infinity + A * N_b**(-beta). Based on the analysis of a 3D\n       gapped system with parabolic bands, beta is determined to be 1.\n    2. For each test case, it generates a synthetic dataset of RPA correlation\n       energies (E_c) for a given set of empty band numbers (N_b) using\n       the true parameters E_infinity_true and A_true.\n    3. It then fits the extrapolation model to this synthetic data using linear\n       least-squares regression to estimate the E_infinity parameter.\n    4. The estimated E_infinity values for all test cases are collected and\n       printed in the specified format.\n    \"\"\"\n\n    # From the derivation in Task A, the exponent beta is 1.\n    beta = 1.0\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary containing the true parameters and N_b values.\n    test_cases = [\n        {\n            \"E_inf_true\": -1.500000,\n            \"A_true\": 0.900000,\n            \"N_b_values\": np.array([8, 16, 32, 64, 128, 256]),\n        },\n        {\n            \"E_inf_true\": -0.750000,\n            \"A_true\": 0.300000,\n            \"N_b_values\": np.array([10, 20, 40, 80, 160]),\n        },\n        {\n            \"E_inf_true\": -2.345678,\n            \"A_true\": 0.050000,\n            \"N_b_values\": np.array([50, 100, 200, 400, 800, 1600]),\n        },\n        {\n            \"E_inf_true\": -1.000000,\n            \"A_true\": 0.000000,\n            \"N_b_values\": np.array([16, 32, 64]),\n        },\n    ]\n\n    estimated_energies = []\n    \n    for case in test_cases:\n        N_b = case[\"N_b_values\"]\n        E_inf_true = case[\"E_inf_true\"]\n        A_true = case[\"A_true\"]\n\n        # 1. Generate synthetic data using the exact model\n        # E_c(N_b) = E_infinity_true + A_true * N_b**(-beta)\n        # This is the 'y' vector in our linear regression.\n        E_c_values = E_inf_true + A_true * N_b**(-beta)\n\n        # 2. Prepare for least-squares fitting.\n        # The model is y = E_inf + A * x, where x = N_b**(-beta).\n        # We need to solve a linear system based on this model.\n        \n        # Construct the regressor 'x' vector.\n        x_regressor = N_b**(-beta)\n\n        # Construct the design matrix X. The first column of ones is for the\n        # intercept (E_infinity), and the second is for the slope (A).\n        # The shape of X will be (M, 2) where M is the number of data points.\n        X_design_matrix = np.vstack([np.ones(len(x_regressor)), x_regressor]).T\n        \n        # 3. Perform linear least-squares regression.\n        # np.linalg.lstsq solves the equation X * p = y for the parameter\n        # vector p = [E_infinity, A] in a least-squares sense.\n        # It is numerically more stable than direct matrix inversion.\n        # The 'rcond=None' argument is to use the machine-precision default.\n        params, residuals, rank, s = np.linalg.lstsq(X_design_matrix, E_c_values, rcond=None)\n\n        # The estimated E_infinity is the first element of the solution vector.\n        E_inf_estimated = params[0]\n        \n        # 4. Store the result.\n        estimated_energies.append(E_inf_estimated)\n\n    # Final print statement in the exact required format.\n    # The results are rounded to 6 decimal places as specified.\n    # Since the synthetic data has no noise, the estimated parameters\n    # should be extremely close to the true ones.\n    print(f\"[{','.join([f'{e:.6f}' for e in estimated_energies])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了单粒子态的基组外，诸如密度响应函数 $\\chi_0$ 这类物理量的空间表示也需要一个基组。在使用平面波的固态计算中，该基组被一个动能截断能所截断，通常通过最大倒格矢模长 $G_{\\mathrm{cut}}$ 来表示。本练习将演示如何分析和修正由该平面波截断所引入的误差。您将学习到响应函数在大波矢下的渐近衰减行为如何决定总相关能的收敛性，并基于此原理实现一个两步外推程序。掌握此技术对于确保您的计算结果在平面波基组下收敛是必不可少的。",
            "id": "3484810",
            "problem": "你的任务是设计并实现一种计算策略，通过分析无相互作用密度响应 $\\chi_{0}^{\\mathbf{G}\\mathbf{G}'}$ 在高-$\\mathbf{G}$ 时的衰减行为，将随机相近似 (RPA) 相关能（记为 $E_{c}^{\\mathrm{RPA}}$）外推到无限平面波截断极限。你的推导和算法必须从基本原理出发，并且必须适用于任何现代编程语言。数值目标是为高等研究生水平的分析提供一组模拟高-$\\mathbf{G}$ 行为的综合、自洽输入，所有操作都应以数学上通用的术语来表达和证明。\n\n从绝热连接涨落-耗散 (ACFD) 形式下，平面波基组中 RPA 相关能的已知数学表示开始，其中倒易空间中的库仑核为 $v(\\mathbf{G})$，单粒子密度响应为 $\\chi_{0}^{\\mathbf{G}\\mathbf{G}'}(i\\omega)$。假设在 $|\\mathbf{G}|$ 足够大时，$\\chi_{0}^{\\mathbf{G}\\mathbf{G}'}(i\\omega)$ 的高-$\\mathbf{G}$ 块是对角占优的，并遵循 $\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega) \\sim C(i\\omega) \\, |\\mathbf{G}|^{-s}$ 形式的幂律衰减，其中 $s$ 为某个正衰减指数，且库仑核在原子单位下为 $v(\\mathbf{G}) = 4\\pi/|\\mathbf{G}|^{2}$。仅使用基本定律和定义，以及解析函数的标准数学展开，来推导 $E_{c}^{\\mathrm{RPA}}$ 中的截断误差如何随平面波截断 $G_{\\mathrm{cut}} = |\\mathbf{G}|_{\\max}$ 变化。据此，确定一个通用策略，用于从 $\\chi_{0}^{\\mathbf{G}\\mathbf{G}}$ 的高-$|\\mathbf{G}|$ 数据中估计指数 $s$，然后用它将 $E_{c}^{\\mathrm{RPA}}$ 外推到 $G_{\\mathrm{cut}} \\to \\infty$ 的极限。\n\n你必须实现一个程序，对每个测试用例执行以下步骤：\n- 在一个固定的虚频 $i\\omega$ 下，使用提供的 $|\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega)|$ 相对于 $|\\mathbf{G}|$ 的综合高-$G$ 样本，通过在对数-对数尺度上进行线性回归来估计高-$|\\mathbf{G}|$ 衰减指数 $s$。你必须将 $i\\omega$ 视为一个固定参数，并可以假设在提供的 $|\\mathbf{G}|$ 样本范围内 $C(i\\omega)$ 是恒定的。\n- 根据你的推导，计算将平面波截断误差与 $G_{\\mathrm{cut}}$ 联系起来的标度指数 $\\mu$，其中误差以 $G_{\\mathrm{cut}}^{-\\mu}$ 的形式衰减。\n- 使用同一测试用例提供的有限截断相关能 $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}})$，对 $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}}) \\approx E_{\\infty} + B \\, G_{\\mathrm{cut}}^{-\\mu}$ 形式进行线性拟合以估计 $E_{\\infty}$，该值近似了 RPA 相关能的无限截断极限。你的拟合必须使用最小二乘法求解 $E_{\\infty}$ 和 $B$。\n- 报告每个测试用例的 $E_{\\infty}$。\n\n物理单位：所有能量必须以 Hartree 为单位处理和报告。所有倒易矢量 $|\\mathbf{G}|$ 和截断 $G_{\\mathrm{cut}}$ 必须以 bohr$^{-1}$ 为单位处理和报告。不存在任何角度量。最终答案为浮点数，其值以 Hartree 为单位。\n\n测试套件：使用以下三个案例。对每个案例，元组提供（$G_{\\mathrm{cut}}$ 列表, $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}})$ 列表, 用于 $\\chi_{0}$ 的 $G$ 样本列表, $|\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega)|$ 列表）。\n\n- 案例 A:\n  - $G_{\\mathrm{cut}}$: $[6, 8, 10, 12]$。\n  - $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}})$ 单位：Hartree: $[-0.34989712, -0.3499755859375, -0.349992, -0.349996786270021]$。\n  - 用于 $\\chi_{0}$ 的高-$G$ 样本: $G = [20, 24, 28, 32]$, $|\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega)| = [0.00125, 0.0008680555555555555, 0.0006377551020408163, 0.00048828125]$。\n\n- 案例 B:\n  - $G_{\\mathrm{cut}}$: $[10, 14, 18, 22, 26]$。\n  - $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}})$ 单位：Hartree: $[-1.2315, -1.2330918367346939, -1.2335714285714286, -1.233765262669429, -1.2338578199052133]$。\n  - 用于 $\\chi_{0}$ 的高-$G$ 样本: $G = [15, 18, 21, 24]$, $|\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega)| = [0.08, 0.06666666666666667, 0.05714285714285714, 0.05]$。\n\n- 案例 C:\n  - $G_{\\mathrm{cut}}$: $[20, 30, 40]$。\n  - $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}})$ 单位：Hartree: $[-0.02, -0.03, -0.035]$。\n  - 用于 $\\chi_{0}$ 的高-$G$ 样本: $G = [40, 50, 60, 70]$, $|\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega)| = [0.3, 0.3, 0.3, 0.3]$。\n\n你的程序必须计算每个案例的 $E_{\\infty}$（以 Hartree 为单位），并将结果聚合为用方括号括起来的、以逗号分隔的 Python 风格列表，打印在单行上。每个数字必须四舍五入到六位小数。例如，输出格式必须与 $[x_{A},x_{B},x_{C}]$ 完全一样，其中每个 $x$ 是一个小数点后恰有六位数字的十进制浮点数，并且该行中不包含单位。",
            "solution": "该问题要求推导一种策略，将随机相近似 (RPA) 相关能 $E_{c}^{\\mathrm{RPA}}$ 外推至无限平面波截断极限。推导必须从绝热连接涨落-耗散 (ACFD) 公式开始，并将用于实现一个数值算法。\n\nRPA 相关能的 ACFD 公式由下式给出：\n$$E_{c}^{\\mathrm{RPA}} = \\frac{1}{2\\pi} \\int_{0}^{\\infty} d\\omega \\, \\mathrm{Tr}\\left[ \\ln\\left(1 - v \\chi_{0}(i\\omega)\\right) + v \\chi_{0}(i\\omega) \\right]$$\n此处，$v$ 是库仑核，$\\chi_{0}(i\\omega)$ 是在虚频 $i\\omega$ 处的无相互作用密度响应函数。迹，$\\mathrm{Tr}$，是在基组上计算的，在此问题中，该基组是由倒易晶格矢量 $\\mathbf{G}$ 表示的平面波集合。\n\n对于大波矢 $|\\mathbf{G}|$，乘积 $v \\chi_0$ 变小。在平面波基组中，库仑核是对角的，其元素为 $v(\\mathbf{G}) = 4\\pi/|\\mathbf{G}|^2$。问题陈述，对于高 $|\\mathbf{G}|$，响应函数 $\\chi_0$ 是对角占优的，且 $\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega) \\sim C(i\\omega) |\\mathbf{G}|^{-s}$。因此，乘积 $(v\\chi_0)_{\\mathbf{G}\\mathbf{G}}$ 的矩阵元近似为 $v(\\mathbf{G})\\chi_{0}^{\\mathbf{G}\\mathbf{G}} \\sim (4\\pi/|\\mathbf{G}|^2)(C(i\\omega)|\\mathbf{G}|^{-s}) \\sim |\\mathbf{G}|^{-(2+s)}$，对于任何正数 $s$，当 $|\\mathbf{G}| \\to \\infty$ 时，该值趋于零。\n\n这允许对小的 $x$ 进行对数展开，$\\ln(1-x) = -x - \\frac{1}{2}x^2 - \\frac{1}{3}x^3 - \\dots$。将此代入 ACFD 公式可得：\n$$E_{c}^{\\mathrm{RPA}} = \\frac{1}{2\\pi} \\int_{0}^{\\infty} d\\omega \\, \\mathrm{Tr}\\left[ -\\frac{1}{2}\\left(v \\chi_{0}\\right)^2 - \\frac{1}{3}\\left(v \\chi_{0}\\right)^3 - \\dots \\right]$$\n总能量是整个倒易空间上的积分。使用有限平面波截断 $G_{\\mathrm{cut}}$ 计算的能量仅包含来自 $|\\mathbf{G}| \\le G_{\\mathrm{cut}}$ 的贡献。截断误差 $\\Delta E_c = E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}}) - E_{c}^{\\mathrm{RPA}}(\\infty)$，是所有 $|\\mathbf{G}| > G_{\\mathrm{cut}}$ 矢量贡献的负值。展开式中的领头项，由于收敛最慢，将主导截断误差。这便是二阶项：\n$$\\Delta E_c \\approx \\frac{1}{4\\pi} \\int_{0}^{\\infty} d\\omega \\, \\mathrm{Tr}\\left[ \\left(v \\chi_{0}\\right)^2 \\right]_{|\\mathbf{G}| > G_{\\mathrm{cut}}}$$\n在指定的 $\\chi_0$ 对角占优近似以及平面波基组中 $v$ 的对角性质下，$(v\\chi_0)^2$ 的迹为：\n$$\\mathrm{Tr}\\left[ (v\\chi_0)^2 \\right] \\approx \\sum_{\\mathbf{G}} \\left( v(\\mathbf{G})\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega) \\right)^2$$\n误差是尾部的总和，即对 $|\\mathbf{G}| > G_{\\mathrm{cut}}$ 求和。我们已知 $v(\\mathbf{G}) = 4\\pi/|\\mathbf{G}|^2$ 且 $\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega) \\sim C(i\\omega) |\\mathbf{G}|^{-s}$。因此，被加数的变化规律如下：\n$$\\left( v(\\mathbf{G})\\chi_{0}^{\\mathbf{G}\\mathbf{G}}\\right)^2 \\sim \\left(\\frac{4\\pi}{|\\mathbf{G}|^2}\\right)^2 \\left(C(i\\omega)|\\mathbf{G}|^{-s}\\right)^2 \\propto |\\mathbf{G}|^{-4} |\\mathbf{G}|^{-2s} = |\\mathbf{G}|^{-(4+2s)}$$\n对于大的 $G_{\\mathrm{cut}}$，我们可以用倒易空间上的连续积分来近似对 $\\mathbf{G}$ 矢量的离散求和。在半径为 $G$、厚度为 $dG$ 的球壳中的态数正比于 $4\\pi G^2 dG$。因此，误差贡献为：\n$$\\Delta E_c \\propto \\int_{0}^{\\infty} d\\omega \\int_{G_{\\mathrm{cut}}}^{\\infty} G^{-(4+2s)} G^2 dG = \\int_{0}^{\\infty} d\\omega \\int_{G_{\\mathrm{cut}}}^{\\infty} G^{-(2+2s)} dG$$\n假设 $2+2s > 1$ (即 $1+2s > 0$，对于 $s \\ge 0$ 为真)，该积分的计算结果为：\n$$\\int_{G_{\\mathrm{cut}}}^{\\infty} G^{-(2+2s)} dG = \\left[ \\frac{G^{-(1+2s)}}{-(1+2s)} \\right]_{G_{\\mathrm{cut}}}^{\\infty} = \\frac{G_{\\mathrm{cut}}^{-(1+2s)}}{1+2s}$$\n因此误差的变化规律为 $\\Delta E_c \\propto G_{\\mathrm{cut}}^{-(1+2s)}$。我们有 $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}}) = E_{\\infty} + \\Delta E_c$，这导出了拟合形式 $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}}) \\approx E_{\\infty} + B G_{\\mathrm{cut}}^{-\\mu}$，其中标度指数为 $\\mu = 1+2s$。\n\n因此，对于每个测试用例，计算策略包括三个步骤：\n1.  **确定衰减指数 $s$**：高动量响应函数的模型是 $|\\chi_{0}^{\\mathbf{G}\\mathbf{G}}(i\\omega)| \\sim C |G|^{-s}$。对两边取自然对数得到 $\\ln|\\chi_{0}| \\sim \\ln(C) - s\\ln|G|$。这是一个 $y = c + mx$ 形式的线性方程，其中 $y=\\ln|\\chi_{0}|$，$x=\\ln|G|$，截距 $c=\\ln(C)$，斜率 $m=-s$。我们对提供的高-$G$ 数据 $(\\ln|G|, \\ln|\\chi_{0}|)$ 进行线性回归以找到斜率 $m$，然后计算 $s = -m$。\n\n2.  **计算外推指数 $\\mu$**：使用上一步得到的 $s$ 值，我们利用推导出的关系式 $\\mu = 1+2s$ 计算能量外推的指数。\n\n3.  **外推至无限截断能量 $E_{\\infty}$**：我们使用模型 $E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}}) = E_{\\infty} + B G_{\\mathrm{cut}}^{-\\mu}$。这是一个 $y = c + Bx$ 形式的线性方程，其中 $y = E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}})$，$x = G_{\\mathrm{cut}}^{-\\mu}$，截距为 $c = E_{\\infty}$。我们对提供的 $(G_{\\mathrm{cut}}^{-\\mu}, E_{c}^{\\mathrm{RPA}}(G_{\\mathrm{cut}}))$ 数据进行第二次线性回归，以找到截距，该截距就是我们对无限截断极限下相关能 $E_{\\infty}$ 的估计值。\n\n将此程序应用于每个测试用例，以确定其各自的 $E_{\\infty}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Solves the problem of extrapolating RPA correlation energy to the \n    infinite cutoff limit for a given set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        (\n            [6, 8, 10, 12],  # G_cut\n            [-0.34989712, -0.3499755859375, -0.349992, -0.349996786270021],  # E_c(G_cut)\n            [20, 24, 28, 32],  # High-G samples for chi0\n            [0.00125, 0.0008680555555555555, 0.0006377551020408163, 0.00048828125]  # |chi0(G,G)|\n        ),\n        # Case B\n        (\n            [10, 14, 18, 22, 26], # G_cut\n            [-1.2315, -1.2330918367346939, -1.2335714285714286, -1.233765262669429, -1.2338578199052133], # E_c(G_cut)\n            [15, 18, 21, 24], # High-G samples for chi0\n            [0.08, 0.06666666666666667, 0.05714285714285714, 0.05] # |chi0(G,G)|\n        ),\n        # Case C\n        (\n            [20, 30, 40], # G_cut\n            [-0.02, -0.03, -0.035], # E_c(G_cut)\n            [40, 50, 60, 70], # High-G samples for chi0\n            [0.3, 0.3, 0.3, 0.3] # |chi0(G,G)|\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        G_cuts, Ec_vals, G_chi, chi0_vals = case\n\n        # Step 1: Estimate the high-|G| decay exponent s\n        # The model is |chi_0| ~ C*|G|^-s\n        # => log|chi_0| ~ log(C) - s * log|G|\n        # This is a linear relationship y = c + m*x where y=log|chi_0|, x=log|G|, m=-s\n        log_G_chi = np.log(np.array(G_chi))\n        log_chi0 = np.log(np.array(chi0_vals))\n        \n        # Perform linear regression to find the slope m\n        s_fit_result = linregress(log_G_chi, log_chi0)\n        s = -s_fit_result.slope\n\n        # Step 2: From the derivation, compute the scaling exponent mu\n        # The error scales as G_cut^-(1+2s), so mu = 1+2s\n        mu = 1 + 2 * s\n\n        # Step 3: Perform a linear fit to estimate E_infinity\n        # The model is E_c(G_cut) ≈ E_infinity + B * G_cut^-mu\n        # This is a linear relationship y = c + m*x where y=E_c, x=G_cut^-mu, and c=E_infinity\n        x_data = np.array(G_cuts, dtype=float) ** (-mu)\n        y_data = np.array(Ec_vals)\n        \n        # Perform linear regression to find the intercept c\n        E_inf_fit_result = linregress(x_data, y_data)\n        E_infinity = E_inf_fit_result.intercept\n        \n        results.append(E_infinity)\n\n    # Final print statement in the exact required format.\n    # Each number is rounded to six decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "RPA数值计算的最后一块拼图是在绝热连接涨落耗散定理（ACFD）公式中对虚频 $\\omega$ 的积分，其积分区间从零到无穷大。直接计算该积分是不可能的，因此需要一种稳健的数值策略。本练习介绍了一种强大且广泛使用的方法：在有限频率 $\\Omega$ 处截断积分，并应用高阶数值积分方法，如高斯-勒让德积分。您不仅将实现该积分方法，还将推导一个关于截断的先验误差估计，从而能够系统地控制积分精度。这项实践为处理RPA及其他多体方法中的频率积分问题提供了一个完整的工具包。",
            "id": "3484811",
            "problem": "考虑一个标量被积函数，它是在随机相位近似中，将绝热连接涨落-耗散定理投影到库仑核的本征模上时产生的。设虚频率轴上的独立粒子密度-密度响应函数被建模为一个有理函数，其离散极点表示带间跃迁，具体形式为\n$$\n\\chi_0(i\\omega) = -\\sum_{j=1}^{M} \\frac{S_j}{\\omega^2 + \\Delta_j^2},\n$$\n其中 $S_j > 0$ 是振子强度，$\\Delta_j > 0$ 是跃迁能。对于一个固定的标量耦合 $\\,\\alpha > 0\\,$，它代表此模式下库仑核的本征值，定义模式分辨的随机相位近似被积函数\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) = \\ln\\!\\big(1 - \\alpha\\, \\chi_0(i\\omega)\\big) + \\alpha\\, \\chi_0(i\\omega).\n$$\n此模式对应的相关能贡献为\n$$\nE_c = \\frac{1}{2\\pi}\\int_{0}^{\\infty} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega.\n$$\n请设计一种在虚轴上的高斯-勒让德求积方法来近似该积分。为了使积分在数值上可处理，引入一个有限的上界 $\\,\\Omega > 0\\,$ 并近似为\n$$\nE_c \\approx \\frac{1}{2\\pi}\\int_{0}^{\\Omega} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega,\n$$\n使用一个从 $[-1,1]$ 映射到 $[0,\\Omega]$ 的 $\\,N\\,$ 阶高斯-勒让德法则。提供一个先验误差估计，该估计由 $\\,\\chi_0(i\\omega)\\,$ 在大 $\\,\\omega\\,$ 时的渐近衰减导出。具体来说，假设渐近行为为 $\\,\\chi_0(i\\omega) \\sim -S_{\\mathrm{tot}}/\\omega^2\\,$，其中 $\\,S_{\\mathrm{tot}} = \\sum_{j=1}^{M} S_j\\,$，并使用领头阶近似来证明对于 $\\omega \\ge \\Omega$，\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\approx -\\frac{1}{2}\\big(\\alpha\\,\\chi_0(i\\omega)\\big)^2 \\sim -\\frac{1}{2}\\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{\\omega^4}.\n$$\n由此推导出积分截断误差的先验界：\n$$\n\\left| E_c - \\frac{1}{2\\pi}\\int_{0}^{\\Omega} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega \\right| \\le \\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{12\\pi \\,\\Omega^3}.\n$$\n实现一个程序，该程序：\n- 使用在区间 $[0,\\Omega]$ 上有 $\\,N\\,$ 个节点的高斯-勒让德求积法，计算函数 $\\,f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\})\\,$ 的 $\\,E_c\\,$ 值。\n- 仅基于 $\\,\\chi_0(i\\omega)\\,$ 的渐近衰减，计算先验截断误差界 $\\,\\alpha^2 S_{\\mathrm{tot}}^2/(12\\pi \\,\\Omega^3)\\,$。\n- 对每个测试用例，输出一个包含计算得到的相关能 $\\,E_c\\,$（单位为哈特里）和相应先验误差界（单位为哈特里）的对。\n\n使用以下参数集 $(\\alpha,\\{S_j\\},\\{\\Delta_j\\},\\Omega,N)$ 的测试套件：\n1. $\\alpha = 0.5$, $\\{S_j\\} = [1.0]$, $\\{\\Delta_j\\} = [1.0]$, $\\Omega = 20.0$, $N = 200$。\n2. $\\alpha = 1.2$, $\\{S_j\\} = [0.8, 0.5]$, $\\{\\Delta_j\\} = [0.5, 2.0]$, $\\Omega = 30.0$, $N = 300$。\n3. $\\alpha = 0.1$, $\\{S_j\\} = [2.0, 0.5, 0.3]$, $\\{\\Delta_j\\} = [1.5, 4.0, 10.0]$, $\\Omega = 15.0$, $N = 150$。\n4. $\\alpha = 2.5$, $\\{S_j\\} = [1.5, 0.7, 0.2]$, $\\{\\Delta_j\\} = [0.8, 3.0, 12.0]$, $\\Omega = 5.0$, $N = 80$。\n\n所有能量必须以哈特里表示。您的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的对列表，每个对都用方括号括起来，不含空格，例如 $[ [E_1,\\varepsilon_1], [E_2,\\varepsilon_2], \\dots ]$，但没有空格。具体来说，输出格式必须为 $[[E_1,\\varepsilon_1],[E_2,\\varepsilon_2],[E_3,\\varepsilon_3],[E_4,\\varepsilon_4]]$，其中 $E_k$ 是测试用例 $k$ 计算得到的相关能，$\\varepsilon_k$ 是该测试用例的先验误差界，二者均为哈特里单位的浮点数。",
            "solution": "绝热连接涨落-耗散定理 (ACFDT) 将相关能表示为响应函数在不同耦合强度下的频率积分。在随机相位近似 (RPA) 中，相互作用响应是通过戴森方程由独立粒子响应构建的，当库仑核被对角化时，迹对数简化为来自各本征模的独立贡献。对于具有标量耦合的单个本征模，相关能变为一个对标量函数的虚频率 $\\omega$ 积分，该标量函数由独立粒子密度-密度响应函数 $\\chi_0(i\\omega)$ 构建。在不使用超出这些基本原理的任何快捷公式的情况下，我们考虑一个标准的、具有良好物理动机的 $\\chi_0(i\\omega)$ 模型，该模型能捕捉到有能隙系统和绝缘体中的渐近行为。\n\n我们采用模型\n$$\n\\chi_0(i\\omega) = -\\sum_{j=1}^{M} \\frac{S_j}{\\omega^2 + \\Delta_j^2},\n$$\n其中 $S_j > 0$ 且 $\\Delta_j > 0$，这反映了虚轴响应是光滑、为负，并且在大 $\\omega$ 时按 $\\omega^{-2}$ 衰减。对于耦合为 $\\alpha > 0$ 的本征模，其标量被积函数则为\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) = \\ln\\!\\big(1 - \\alpha\\, \\chi_0(i\\omega)\\big) + \\alpha\\, \\chi_0(i\\omega).\n$$\n对于大的 $\\omega$，$\\chi_0(i\\omega)$ 的渐近衰减为\n$$\n\\chi_0(i\\omega) \\sim -\\frac{S_{\\mathrm{tot}}}{\\omega^2}, \\quad S_{\\mathrm{tot}} = \\sum_{j=1}^{M} S_j.\n$$\n对于小的 $|\\alpha \\chi_0(i\\omega)|$，对数项的泰勒展开得到\n$$\n\\ln(1 - \\alpha \\chi_0) + \\alpha \\chi_0 = -\\frac{1}{2}\\big(\\alpha \\chi_0\\big)^2 - \\frac{1}{3}\\big(\\alpha \\chi_0\\big)^3 - \\cdots,\n$$\n其中领头项在 $\\omega$ 很大时占主导地位。使用领头阶项和 $\\chi_0(i\\omega)$ 的渐近形式，\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\approx -\\frac{1}{2}\\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{\\omega^4} \\quad \\text{当 } \\omega \\to \\infty \\text{ 时}.\n$$\n因此，在有限上界 $\\Omega$ 处截断积分，可以通过对领头阶尾部的绝对值进行积分，得到一个先验误差界：\n$$\n\\left| E_c - \\frac{1}{2\\pi}\\int_{0}^{\\Omega} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega \\right|\n\\le \\frac{1}{2\\pi}\\int_{\\Omega}^{\\infty} \\frac{1}{2}\\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{\\omega^4} \\, d\\omega\n= \\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{12\\pi \\,\\Omega^3}.\n$$\n该估计除了 $\\alpha$、$S_{\\mathrm{tot}}$ 和 $\\Omega$ 之外，不依赖于任何未知量，并且它与 $\\chi_0(i\\omega)$ 的渐近行为直接相关。在 $[0,\\Omega]$ 上的高斯-勒让德求积是通过将节点和权重从标准区间 $[-1,1]$ 映射过来进行的。设 $\\{x_k, w_k\\}_{k=1}^{N}$ 为 $[-1,1]$ 上的高斯-勒让德节点和权重。仿射变换 $\\omega = \\frac{\\Omega}{2}(x+1)$ 将 $[-1,1]$ 映射到 $[0,\\Omega]$，积分近似为\n$$\n\\int_{0}^{\\Omega} f(\\omega) \\, d\\omega \\approx \\sum_{k=1}^{N} \\left( \\frac{\\Omega}{2} w_k \\right) f\\!\\left(\\frac{\\Omega}{2}(x_k + 1)\\right).\n$$\n将其与前置因子 $1/(2\\pi)$ 结合，得到\n$$\nE_c \\approx \\frac{1}{2\\pi} \\sum_{k=1}^{N} \\left( \\frac{\\Omega}{2} w_k \\right) f\\!\\left(\\frac{\\Omega}{2}(x_k + 1)\\right).\n$$\n对于光滑、解析的被积函数，在 $[0,\\Omega]$ 上使用高斯-勒让德求积的离散化误差通常非常小，并随 $\\,N\\,$ 快速衰减，对于在包含 $[-1,1]$ 的区域内解析的函数，该误差通常相对于 $\\,N\\,$ 呈指数级衰减。在此设计中，我们确保求积阶数 $\\,N\\,$ 足够大，以使离散化误差与从渐近行为导出的先验截断误差界相比可以忽略不计。报告的总先验误差是截断界\n$$\n\\varepsilon(\\alpha,\\{S_j\\},\\Omega) = \\frac{\\alpha^2}{12\\pi \\,\\Omega^3} \\left(\\sum_{j=1}^{M} S_j\\right)^2,\n$$\n以哈特里表示，与能量积分的单位一致。\n\n算法步骤：\n1. 对每个测试用例，计算 $S_{\\mathrm{tot}} = \\sum_j S_j$。\n2. 构建函数 $\\chi_0(i\\omega) = -\\sum_j S_j/(\\omega^2 + \\Delta_j^2)$。\n3. 在映射到 $[0,\\Omega]$ 的高斯-勒让德节点上计算被积函数 $f(\\omega) = \\ln(1 - \\alpha \\chi_0(i\\omega)) + \\alpha \\chi_0(i\\omega)$ 的值，并累加加权和以近似 $\\int_0^{\\Omega} f(\\omega) \\, d\\omega$。\n4. 乘以 $1/(2\\pi)$ 以获得以哈特里为单位的 $E_c$。\n5. 计算以哈特里为单位的先验截断误差界 $\\varepsilon = \\alpha^2 S_{\\mathrm{tot}}^2/(12\\pi \\Omega^3)$。\n6. 对每个测试用例，按指定格式输出对 $[E_c, \\varepsilon]$。\n\n提供的测试套件探索了多种情况：单极点的“理想路径”、中等耦合的双极点情况、小耦合的多极点情况，以及一个具有相对强耦合和较小上界 $\\Omega$ 以强调截断误差重要性的边界情况。按要求，所有结果均以哈特里为单位打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef chi0_imag(omega, S_list, Delta_list):\n    \"\"\"\n    Independent-particle polarizability on the imaginary axis:\n    chi0(i*omega) = - sum_j S_j / (omega^2 + Delta_j^2)\n    \"\"\"\n    omega2 = omega * omega\n    denom = omega2 + np.array(Delta_list, dtype=float)**2\n    return -np.sum(np.array(S_list, dtype=float) / denom)\n\ndef integrand_f(omega, alpha, S_list, Delta_list):\n    \"\"\"\n    f(omega) = ln(1 - alpha * chi0(i*omega)) + alpha * chi0(i*omega)\n    \"\"\"\n    chi0 = chi0_imag(omega, S_list, Delta_list)\n    return np.log(1.0 - alpha * chi0) + alpha * chi0\n\ndef rpa_energy_gl(alpha, S_list, Delta_list, Omega, N):\n    \"\"\"\n    Compute E_c ≈ (1/(2*pi)) ∫_0^Omega f(omega) dω using Gauss–Legendre quadrature with N nodes.\n    \"\"\"\n    # Gauss-Legendre nodes and weights on [-1, 1]\n    x, w = np.polynomial.legendre.leggauss(N)\n    # Map to [0, Omega]: omega = (Omega/2)*(x+1), dω = (Omega/2) dx\n    omega_nodes = 0.5 * Omega * (x + 1.0)\n    weights = 0.5 * Omega * w\n    fvals = np.array([integrand_f(om, alpha, S_list, Delta_list) for om in omega_nodes], dtype=float)\n    integral_0_Omega = np.dot(weights, fvals)\n    return (1.0 / (2.0 * np.pi)) * integral_0_Omega\n\ndef tail_error_bound(alpha, S_list, Omega):\n    \"\"\"\n    A priori truncation error bound based on asymptotic decay:\n    |E_tail| = alpha^2 * (sum S_j)^2 / (12 * pi * Omega^3)\n    \"\"\"\n    S_tot = float(np.sum(np.array(S_list, dtype=float)))\n    return (alpha**2 * S_tot**2) / (12.0 * np.pi * Omega**3)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (alpha, S_list, Delta_list, Omega, N)\n    test_cases = [\n        (0.5, [1.0], [1.0], 20.0, 200),\n        (1.2, [0.8, 0.5], [0.5, 2.0], 30.0, 300),\n        (0.1, [2.0, 0.5, 0.3], [1.5, 4.0, 10.0], 15.0, 150),\n        (2.5, [1.5, 0.7, 0.2], [0.8, 3.0, 12.0], 5.0, 80),\n    ]\n\n    results = []\n    for alpha, S_list, Delta_list, Omega, N in test_cases:\n        E_c = rpa_energy_gl(alpha, S_list, Delta_list, Omega, N)\n        err_bound = tail_error_bound(alpha, S_list, Omega)\n        results.append([E_c, err_bound])\n\n    # Format the output exactly as required: no spaces, nested list of pairs.\n    def format_results_no_spaces(res):\n        parts = []\n        for pair in res:\n            # Ensure standard float string conversion without spaces\n            parts.append(f\"[{pair[0]},{pair[1]}]\")\n        return \"[\" + \",\".join(parts) + \"]\"\n\n    print(format_results_no_spaces(results))\n\nsolve()\n```"
        }
    ]
}