{
    "hands_on_practices": [
        {
            "introduction": "Before performing a finite displacement calculation, we must first construct an appropriate simulation cell. To accurately capture the behavior of an infinite crystal using periodic boundary conditions, the supercell must be large enough to ensure that the interactions are truncated cleanly within the cell, preventing any atom from artificially interacting with its own periodic images. This practice  walks you through the process of determining the minimal supercell dimensions required to satisfy this condition for a given real-space interaction cutoff, a fundamental first step that directly impacts both the accuracy and the computational expense of your simulation.",
            "id": "3460966",
            "problem": "You are implementing the finite displacement method for lattice dynamics to compute real-space interatomic force constants (IFCs) truncated at a radial cutoff. The model crystal is a simple hexagonal Bravais lattice with primitive vectors given by\n$$\n\\mathbf{a}_{1} = a \\,(1,\\,0,\\,0),\\quad \\mathbf{a}_{2} = a \\left(\\tfrac{1}{2},\\,\\tfrac{\\sqrt{3}}{2},\\,0\\right),\\quad \\mathbf{a}_{3} = c \\,(0,\\,0,\\,1),\n$$\nwith lattice parameters $a = 2.75\\,\\text{\\AA}$ and $c = 4.45\\,\\text{\\AA}$. You will truncate the real-space IFCs at a radial cutoff $R_{c} = 4.6\\,\\text{\\AA}$. You will displace a single atom at the origin and compute the induced forces under periodic boundary conditions.\n\nStarting from the definitions of a Bravais lattice, the geometry of neighbor shells, and the concept of periodic images under periodic boundary conditions, derive a criterion on the supercell translations that guarantees no aliasing of interactions up to the cutoff occurs (that is, no atom within the cutoff sphere around the displaced atom can have more than one image of the displaced atom within the cutoff). Then, specialize this criterion to a supercell constructed by an integer replication along the primitive vectors, with supercell vectors $\\mathbf{A}_{1} = N_{1}\\mathbf{a}_{1}$, $\\mathbf{A}_{2} = N_{2}\\mathbf{a}_{2}$, and $\\mathbf{A}_{3} = N_{3}\\mathbf{a}_{3}$, where $N_{1}$, $N_{2}$, and $N_{3}$ are positive integers.\n\nProceed by analyzing the neighbor shells of the simple hexagonal Bravais lattice to identify which shells fall within $R_{c}$, and then determine the minimal integers $N_{1}$, $N_{2}$, and $N_{3}$ such that the above no-aliasing criterion is satisfied and in-plane hexagonal symmetry is preserved in the supercell shape. Report your final result as the row matrix $\\left(N_{1}\\ N_{2}\\ N_{3}\\right)$ with no units. The final answer must be a single row matrix as defined, with exact integers (no rounding instructions are needed).",
            "solution": "The user wants to determine the minimal supercell size for a finite displacement calculation on a simple hexagonal Bravais lattice, subject to a cutoff radius and a symmetry constraint.\n\n### Step 1: Validation of the Problem Statement\nThe problem is first validated against the required criteria.\n\n**1.1. Extraction of Givens:**\n- Lattice type: Simple hexagonal Bravais lattice.\n- Primitive vectors: $\\mathbf{a}_{1} = a \\,(1,\\,0,\\,0)$, $\\mathbf{a}_{2} = a \\left(\\frac{1}{2},\\,\\frac{\\sqrt{3}}{2},\\,0\\right)$, $\\mathbf{a}_{3} = c \\,(0,\\,0,\\,1)$.\n- Lattice parameters: $a = 2.75\\,\\text{\\AA}$, $c = 4.45\\,\\text{\\AA}$.\n- Interaction cutoff radius: $R_{c} = 4.6\\,\\text{\\AA}$.\n- Supercell vectors: $\\mathbf{A}_{1} = N_{1}\\mathbf{a}_{1}$, $\\mathbf{A}_{2} = N_{2}\\mathbf{a}_{2}$, $\\mathbf{A}_{3} = N_{3}\\mathbf{a}_{3}$, with $N_{1}, N_{2}, N_{3}$ being positive integers.\n- Constraints: The supercell must prevent aliasing of interactions up to $R_c$ and preserve in-plane hexagonal symmetry.\n\n**1.2. Validation against Criteria:**\n- **Scientifically Grounded:** The problem is based on fundamental concepts of solid-state physics and computational materials science, including Bravais lattices, periodic boundary conditions, supercell methods, and the finite displacement technique for calculating interatomic force constants (IFCs). These are standard and well-established methods.\n- **Well-Posed:** The problem provides all necessary parameters ($a, c, R_c$) and clear, formalizable constraints (supercell definition, no-aliasing, symmetry) to determine a unique set of minimal integers $(N_1, N_2, N_3)$.\n- **Objective:** The problem statement is quantitative and devoid of subjective or ambiguous terminology.\n\n**1.3. Verdict:**\nThe problem is scientifically sound, well-posed, and objective. It contains no invalidating flaws. Therefore, it is valid, and a solution will be provided.\n\n### Step 2: Derivation of the \"No-Aliasing\" Criterion\n\nIn the finite displacement method, an atom in a supercell is displaced, and the forces on all other atoms are calculated. Due to periodic boundary conditions (PBC), the displaced atom (at origin $\\mathbf{0}$ for simplicity) has periodic images at all supercell lattice vectors, $\\mathbf{T}_{\\text{super}} = m_1\\mathbf{A}_1 + m_2\\mathbf{A}_2 + m_3\\mathbf{A}_3$, where $m_1, m_2, m_3$ are integers.\n\nThe force on an atom at position $\\mathbf{r}$ is the sum of forces from the displaced atom at the origin and all its images: $F(\\mathbf{r}) = \\sum_{\\mathbf{T}_{\\text{super}}} f(\\mathbf{r} - \\mathbf{T}_{\\text{super}})$, where $f(\\mathbf{x})$ is the force due to a displacement at a relative position $\\mathbf{x}$. The IFCs are assumed to be zero for distances greater than the cutoff $R_c$, which means $f(\\mathbf{x}) = 0$ if $|\\mathbf{x}| > R_c$.\n\nTo unambiguously determine the IFCs from the calculated forces, the force on any atom at $\\mathbf{r}$ (where $|\\mathbf{r}| \\le R_c$) should arise from a single source: the displaced atom at the origin. This requires that the atom at $\\mathbf{r}$ does not interact with any periodic image of the displaced atom. Mathematically, for any atom at position $\\mathbf{r}$ within the cutoff sphere of the origin (i.e., $|\\mathbf{r}| \\le R_c$), its distance to any non-zero periodic image $\\mathbf{T}_{\\text{super}} \\ne \\mathbf{0}$ must be greater than $R_c$.\n$$|\\mathbf{r} - \\mathbf{T}_{\\text{super}}| > R_c \\quad \\forall \\mathbf{r} \\text{ with } |\\mathbf{r}| \\le R_c \\text{ and } \\forall \\mathbf{T}_{\\text{super}} \\ne \\mathbf{0}$$\nThe most restrictive case occurs for an atom at the edge of the cutoff sphere, $|\\mathbf{r}| = R_c$, aligned with the vector to the nearest periodic image, $\\mathbf{T}_{\\text{super,min}}$. For such a point, $\\mathbf{r} = R_c \\frac{\\mathbf{T}_{\\text{super,min}}}{|\\mathbf{T}_{\\text{super,min}}|}$. The distance to this image is:\n$$|\\mathbf{r} - \\mathbf{T}_{\\text{super,min}}| = \\left| R_c \\frac{\\mathbf{T}_{\\text{super,min}}}{|\\mathbf{T}_{\\text{super,min}}|} - \\mathbf{T}_{\\text{super,min}} \\right| = |\\mathbf{T}_{\\text{super,min}}| - R_c$$\nFor this distance to be greater than or equal to $R_c$ (to be conservative, we use $\\ge$), we must have $|\\mathbf{T}_{\\text{super,min}}| - R_c \\ge R_c$, which simplifies to:\n$$|\\mathbf{T}_{\\text{super,min}}| \\ge 2 R_c$$\nThis is the general criterion for avoiding interaction aliasing: the length of the shortest non-zero supercell lattice vector must be at least twice the cutoff radius.\n\n### Step 3: Analysis of Neighbor Shells\nLet's identify the neighbor shells within the cutoff radius $R_c = 4.6\\,\\text{\\AA}$. A general lattice vector in the simple hexagonal lattice is $\\mathbf{R}_{lmn} = l\\mathbf{a}_1 + m\\mathbf{a}_2 + n\\mathbf{a}_3$. Its squared magnitude is:\n$$|\\mathbf{R}_{lmn}|^2 = |l\\mathbf{a}_1 + m\\mathbf{a}_2 + n\\mathbf{a}_3|^2 = (l\\mathbf{a}_1 + m\\mathbf{a}_2)\\cdot(l\\mathbf{a}_1 + m\\mathbf{a}_2) + (n\\mathbf{a}_3)\\cdot(n\\mathbf{a}_3)$$\nSince $\\mathbf{a}_1, \\mathbf{a}_2$ are orthogonal to $\\mathbf{a}_3$:\n$$|\\mathbf{R}_{lmn}|^2 = l^2|\\mathbf{a}_1|^2 + m^2|\\mathbf{a}_2|^2 + 2lm(\\mathbf{a}_1 \\cdot \\mathbf{a}_2) + n^2|\\mathbf{a}_3|^2$$\nWith $|\\mathbf{a}_1| = |\\mathbf{a}_2| = a$, $|\\mathbf{a}_3| = c$, and $\\mathbf{a}_1 \\cdot \\mathbf{a}_2 = a(1,0,0) \\cdot a(\\tfrac{1}{2}, \\tfrac{\\sqrt{3}}{2}, 0) = \\frac{a^2}{2}$:\n$$|\\mathbf{R}_{lmn}|^2 = a^2(l^2 + m^2 + lm) + c^2n^2$$\nUsing $a = 2.75\\,\\text{\\AA}$ and $c = 4.45\\,\\text{\\AA}$, we get $a^2 = 7.5625\\,\\text{\\AA}^2$ and $c^2 = 19.8025\\,\\text{\\AA}^2$. The squared cutoff is $R_c^2 = (4.6)^2 = 21.16\\,\\text{\\AA}^2$.\n\nWe search for integer triplets $(l,m,n)$, not all zero, such that $|\\mathbf{R}_{lmn}|^2  21.16$:\n- For $n=0$: $7.5625(l^2+m^2+lm)  21.16 \\implies l^2+m^2+lm  2.8$.\n  - $(l,m) \\in \\{(\\pm1,0), (0,\\pm1), (\\pm1, \\mp1)\\}$. For these, $l^2+m^2+lm=1$.\n  $d^2 = 7.5625 \\implies d=a=2.75\\,\\text{\\AA}$. This is the 1st neighbor shell.\n- For $n=\\pm1$: $7.5625(l^2+m^2+lm) + 19.8025  21.16 \\implies 7.5625(l^2+m^2+lm)  1.3575 \\implies l^2+m^2+lm  0.18$.\n  - Only $(l,m)=(0,0)$ satisfies this.\n  $d^2 = c^2 = 19.8025 \\implies d=c=4.45\\,\\text{\\AA}$. This is the 2nd neighbor shell.\n- For $n=\\pm2$: $c^2(2)^2 = 4 \\times 19.8025 > 21.16$. No further shells.\n\nThe largest distance to an atom within the cutoff is $c = 4.45\\,\\text{\\AA}$. Our criterion must correctly account for all interactions up to $R_c = 4.6\\,\\text{\\AA}$.\n\n### Step 4: Application of Criteria to the Supercell\nThe supercell vectors are $\\mathbf{A}_1 = N_1 \\mathbf{a}_1$, $\\mathbf{A}_2 = N_2 \\mathbf{a}_2$, $\\mathbf{A}_3 = N_3 \\mathbf{a}_3$. A general supercell lattice vector is $\\mathbf{T}_{\\text{super}} = m_1 \\mathbf{A}_1 + m_2 \\mathbf{A}_2 + m_3 \\mathbf{A}_3$. The squared magnitude is:\n$$|\\mathbf{T}_{\\text{super}}|^2 = a^2((m_1 N_1)^2 + (m_2 N_2)^2 + (m_1 N_1)(m_2 N_2)) + c^2(m_3 N_3)^2$$\nThe no-aliasing criterion $|\\mathbf{T}_{\\text{super,min}}| \\ge 2R_c$ implies that this must hold for the shortest non-zero vector. The shortest vectors are typically the supercell axes themselves or their simple diagonals. We must at least satisfy the conditions for the axes:\n1. $|\\mathbf{A}_1| = N_1 a \\ge 2R_c$\n2. $|\\mathbf{A}_2| = N_2 a \\ge 2R_c$\n3. $|\\mathbf{A}_3| = N_3 c \\ge 2R_c$\n\nThe problem requires preserving in-plane hexagonal symmetry. For a supercell with basis vectors $\\mathbf{A}_1 = N_1\\mathbf{a}_1$ and $\\mathbf{A}_2 = N_2\\mathbf{a}_2$, the in-plane symmetry of the superlattice is hexagonal only if $|\\mathbf{A}_1| = |\\mathbf{A}_2|$. Since $|\\mathbf{a}_1|=|\\mathbf{a}_2|=a$, this requires $N_1 = N_2$. Let's set $N_1=N_2=N$.\n\n### Step 5: Calculation of Minimal Integers\nWith $N_1=N_2=N$, the constraints become:\n1. $Na \\ge 2R_c$\n2. $N_3 c \\ge 2R_c$\n\nWe are given $a=2.75\\,\\text{\\AA}$, $c=4.45\\,\\text{\\AA}$, and $R_c=4.6\\,\\text{\\AA}$. So $2R_c = 9.2\\,\\text{\\AA}$.\n\nFrom constraint 1:\n$$N \\times 2.75 \\ge 9.2 \\implies N \\ge \\frac{9.2}{2.75} \\approx 3.345$$\nSince $N$ must be a positive integer, the minimum value is $N=4$.\n\nFrom constraint 2:\n$$N_3 \\times 4.45 \\ge 9.2 \\implies N_3 \\ge \\frac{9.2}{4.45} \\approx 2.067$$\nSince $N_3$ must be a positive integer, the minimum value is $N_3=3$.\n\nThe minimal integers that satisfy these conditions and the symmetry requirement are $N_1 = 4$, $N_2 = 4$, and $N_3 = 3$.\n\nWe must verify that no other supercell vector $\\mathbf{T}_{\\text{super}}$ is shorter than $2R_c$.\nLet's check the shortest vectors with $N=4, N_3=3$.\n$|\\mathbf{A}_1| = 4a = 4 \\times 2.75 = 11.0\\,\\text{\\AA}$.\n$|\\mathbf{A}_2| = 4a = 11.0\\,\\text{\\AA}$.\n$|\\mathbf{A}_3| = 3c = 3 \\times 4.45 = 13.35\\,\\text{\\AA}$.\nThe in-plane diagonal vector $\\mathbf{A}_1 - \\mathbf{A}_2 = 4(\\mathbf{a}_1-\\mathbf{a}_2)$. We have $|\\mathbf{a}_1-\\mathbf{a}_2|^2 = a^2+a^2-2(a^2/2) = a^2$, so $|\\mathbf{a}_1-\\mathbf{a}_2|=a$. Thus, $|\\mathbf{A}_1-\\mathbf{A}_2| = 4a = 11.0\\,\\text{\\AA}$.\nAll other supercell vectors are longer. For instance, $|\\mathbf{A}_1 + \\mathbf{A}_3|^2 = |\\mathbf{A}_1|^2 + |\\mathbf{A}_3|^2 = (11.0)^2 + (13.35)^2 > (11.0)^2$.\nThe shortest supercell vector has length $11.0\\,\\text{\\AA}$.\nThe condition is $11.0\\,\\text{\\AA} \\ge 2R_c = 9.2\\,\\text{\\AA}$, which is satisfied.\n\nThus, the minimal integer replication factors are $N_1=4$, $N_2=4$, and $N_3=3$. The final result is the row matrix $(N_1\\ N_2\\ N_3)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4  4  3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The accuracy of the finite displacement method hinges on a delicate balance in choosing the displacement amplitude, $\\delta$. The displacement must be small enough to stay within the harmonic approximation, minimizing contamination from higher-order anharmonic terms, yet large enough for the induced forces to rise above the numerical noise inherent in first-principles calculations. This exercise  addresses this central trade-off by guiding you to derive an analytical expression for the optimal displacement amplitude that minimizes the mean-squared error of the computed force constants, blending concepts of Taylor series truncation and statistical error propagation.",
            "id": "3461008",
            "problem": "Consider a one-dimensional monatomic chain with lattice constant $a$ in which only nearest-neighbor interactions are present. Let $u_j$ denote the scalar displacement of atom $j$ from its equilibrium position and let $F_i(u_j)$ denote the resulting scalar force on atom $i$ when atom $j$ is displaced by $u_j$ while all other atoms are kept at equilibrium. The interatomic force constant $K_{ij}$ between atoms $i$ and $j$ is defined by $K_{ij} = -\\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{u_j=0}$, consistent with the definition of force as the negative gradient of the energy and Newton’s laws of motion.\n\nIn the Finite Displacement Method (FDM), forces are computed at two opposite displacements $+\\delta$ and $-\\delta$ of atom $j$ to estimate $K_{ij}$. Assume that each computed force is contaminated by independent, additive, zero-mean noise due to the electronic-structure solver (for example, Density Functional Theory (DFT)), so that the observed forces are $\\tilde{F}_i(+\\delta) = F_i(+\\delta) + \\eta_{+}$ and $\\tilde{F}_i(-\\delta) = F_i(-\\delta) + \\eta_{-}$, where $\\eta_{+}$ and $\\eta_{-}$ are independent random variables with $\\mathbb{E}[\\eta_{\\pm}] = 0$ and $\\mathrm{Var}(\\eta_{\\pm}) = \\sigma_F^2$. Assume $F_i(u_j)$ is sufficiently smooth to admit a Taylor series about $u_j=0$ and define $c = \\left.\\frac{\\partial^3 F_i}{\\partial u_j^3}\\right|_{u_j=0}$; neglect terms beyond third order for the purpose of leading-order truncation analysis.\n\nStarting from these definitions and assumptions, do the following:\n1. Construct the central-difference estimator for $K_{ij}$ using $\\tilde{F}_i(+\\delta)$ and $\\tilde{F}_i(-\\delta)$, and derive the leading-order truncation bias in terms of $\\delta$ and $c$.\n2. Under the stated noise model, derive the variance of the estimator and the leading-order mean-squared error (MSE) as a function of $\\delta$, $\\sigma_F$, and $c$.\n3. Determine the displacement magnitude $\\delta$ that minimizes the leading-order MSE.\n\nProvide your final answer as a single closed-form analytic expression for the optimal displacement magnitude $\\delta$ expressed in terms of the force-noise standard deviation $\\sigma_F$ and the third derivative $c$. Express $\\delta$ in meters. Do not approximate or round.",
            "solution": "We begin from the definition of the interatomic force constant $K_{ij}$:\n$$\nK_{ij} \\equiv -\\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{u_j=0}.\n$$\nIn the Finite Displacement Method (FDM), we estimate the derivative using a central difference in $u_j$ with displacement magnitude $\\delta$. The noise-free central difference estimator based on $F_i(+\\delta)$ and $F_i(-\\delta)$ is\n$$\n\\hat{K}_{ij}^{(0)}(\\delta) = -\\frac{F_i(+\\delta) - F_i(-\\delta)}{2\\delta}.\n$$\nWhen forces are noisy, we have observed forces $\\tilde{F}_i(\\pm \\delta) = F_i(\\pm \\delta) + \\eta_{\\pm}$, where $\\eta_{+}$ and $\\eta_{-}$ are independent, zero-mean random variables with variance $\\sigma_F^2$. The noisy estimator is then\n$$\n\\hat{K}_{ij}(\\delta) = -\\frac{\\tilde{F}_i(+\\delta) - \\tilde{F}_i(-\\delta)}{2\\delta} = -\\frac{F_i(+\\delta) - F_i(-\\delta)}{2\\delta} - \\frac{\\eta_{+} - \\eta_{-}}{2\\delta}.\n$$\n\nTo quantify truncation, we expand $F_i(u_j)$ in a Taylor series about $u_j=0$, assuming sufficient smoothness:\n$$\nF_i(u_j) = F_i(0) + \\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{0} u_j + \\frac{1}{2}\\left.\\frac{\\partial^2 F_i}{\\partial u_j^2}\\right|_{0} u_j^2 + \\frac{1}{6}\\left.\\frac{\\partial^3 F_i}{\\partial u_j^3}\\right|_{0} u_j^3 + \\mathcal{O}(u_j^4).\n$$\nBy equilibrium, $F_i(0) = 0$. Introducing the shorthand\n$$\nK_{ij} = -\\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{0}, \\quad g = \\left.\\frac{\\partial^2 F_i}{\\partial u_j^2}\\right|_{0}, \\quad c = \\left.\\frac{\\partial^3 F_i}{\\partial u_j^3}\\right|_{0},\n$$\nthe expansions at $\\pm \\delta$ read\n$$\nF_i(+\\delta) = -K_{ij}\\delta + \\frac{1}{2} g \\delta^2 + \\frac{1}{6} c \\delta^3 + \\mathcal{O}(\\delta^4),\n$$\n$$\nF_i(-\\delta) = +K_{ij}\\delta + \\frac{1}{2} g \\delta^2 - \\frac{1}{6} c \\delta^3 + \\mathcal{O}(\\delta^4).\n$$\nSubtracting and dividing by $2\\delta$,\n$$\n-\\frac{F_i(+\\delta) - F_i(-\\delta)}{2\\delta} = K_{ij} - \\frac{1}{6} c \\delta^2 + \\mathcal{O}(\\delta^4).\n$$\nThus the leading-order truncation bias of the central-difference estimator (with noiseless forces) is\n$$\nb(\\delta) \\equiv \\mathbb{E}[\\hat{K}_{ij}^{(0)}(\\delta)] - K_{ij} = -\\frac{1}{6} c \\delta^2 + \\mathcal{O}(\\delta^4).\n$$\n\nNext, we analyze the noise contribution. The noise term in the estimator is\n$$\n\\varepsilon(\\delta) \\equiv -\\frac{\\eta_{+} - \\eta_{-}}{2\\delta}.\n$$\nSince $\\eta_{+}$ and $\\eta_{-}$ are independent and have variance $\\sigma_F^2$, the variance of $\\varepsilon(\\delta)$ is\n$$\n\\mathrm{Var}\\left[\\varepsilon(\\delta)\\right] = \\frac{\\mathrm{Var}(\\eta_{+}) + \\mathrm{Var}(\\eta_{-})}{(2\\delta)^2} = \\frac{2\\sigma_F^2}{4\\delta^2} = \\frac{\\sigma_F^2}{2\\delta^2}.\n$$\nThe estimator’s mean-squared error (MSE) to leading order is the sum of the squared bias and the variance:\n$$\n\\mathrm{MSE}(\\delta) \\approx b(\\delta)^2 + \\mathrm{Var}\\left[\\varepsilon(\\delta)\\right] = \\left(-\\frac{c}{6}\\delta^2\\right)^2 + \\frac{\\sigma_F^2}{2\\delta^2} = \\frac{c^2}{36}\\delta^4 + \\frac{\\sigma_F^2}{2\\delta^2}.\n$$\n\nWe now minimize $\\mathrm{MSE}(\\delta)$ with respect to $\\delta > 0$. Define $A = \\frac{c^2}{36}$ and $B = \\frac{\\sigma_F^2}{2}$, so that\n$$\n\\mathrm{MSE}(\\delta) = A \\delta^4 + B \\delta^{-2}.\n$$\nDifferentiating with respect to $\\delta$ and setting the derivative to zero,\n$$\n\\frac{d}{d\\delta}\\mathrm{MSE}(\\delta) = 4A \\delta^3 - 2B \\delta^{-3} = 0 \\quad \\Rightarrow \\quad 4A \\delta^6 = 2B \\quad \\Rightarrow \\quad \\delta^6 = \\frac{B}{2A}.\n$$\nSubstituting $A$ and $B$,\n$$\n\\delta^6 = \\frac{\\sigma_F^2/2}{2\\cdot (c^2/36)} = \\frac{\\sigma_F^2/2}{c^2/18} = \\frac{9\\sigma_F^2}{c^2}.\n$$\nTaking the positive real sixth root gives the optimal displacement magnitude\n$$\n\\delta_{\\mathrm{opt}} = \\left(\\frac{9\\sigma_F^2}{c^2}\\right)^{1/6}.\n$$\nThis expression minimizes the leading-order mean-squared error, balancing truncation bias and force-noise variance. By instruction, the displacement magnitude is to be expressed in meters; given that $\\sigma_F$ carries units of force and $c$ carries units of force per cubic displacement, the combination $\\left(\\frac{9\\sigma_F^2}{c^2}\\right)^{1/6}$ has units of displacement as required.",
            "answer": "$$\\boxed{\\left(\\frac{9\\sigma_F^2}{c^2}\\right)^{1/6}}$$"
        },
        {
            "introduction": "A fundamental principle of physics demands that a uniform translation of an entire crystal lattice should induce no net forces on any atom. This requirement, known as the Acoustic Sum Rule (ASR), imposes a set of exact linear constraints on the interatomic force constant matrix. This final practice  demonstrates a mathematically rigorous method to enforce this physical law on a noisy set of force constants obtained from a finite displacement calculation, using a constrained least-squares optimization to find the closest physically valid matrix, which is crucial for accurately modeling long-wavelength acoustic phonons.",
            "id": "3460982",
            "problem": "You are given a noisy set of fitted interatomic force constants represented as a real matrix that should satisfy the acoustic sum rule of translational invariance in lattice dynamics. The acoustic sum rule requires that a uniform translation of all atoms produces no force. Starting from Newton’s laws and the superposition of harmonic forces, uniform translation by the same displacement for all atoms implies that the net force on each atom from such a displacement must be zero. This yields linear constraints on the interatomic force constants: for each atom index $I$ and for each pair of Cartesian components $\\alpha$ and $\\beta$, the block row sum condition\n$$\n\\sum_{J=0}^{N-1} \\Phi_{(I,\\alpha),(J,\\beta)} = 0\n$$\nmust hold, where $\\Phi \\in \\mathbb{R}^{(ND) \\times (ND)}$ is the matrix of interatomic force constants for $N$ atoms in $D$ Cartesian dimensions, and the composite indices are flattened as $(I,\\alpha)$ for rows and $(J,\\beta)$ for columns.\n\nYou must construct a least-squares correction that enforces these linear constraints while minimizing the total deviation from the original $\\Phi$. Concretely, let $x \\in \\mathbb{R}^{(ND)^2}$ be the vectorization of $\\Phi$ by stacking its rows, and let $A \\in \\mathbb{R}^{m \\times (ND)^2}$ be the constraint matrix encoding the acoustic sum rule, where $m = N D^2$. The goal is to compute the corrected vector $x^\\star$ that solves the constrained minimization problem:\n$$\n\\min_{x \\in \\mathbb{R}^{(ND)^2}} \\ \\lVert x - x_0 \\rVert_2^2 \\quad \\text{subject to} \\quad A x = 0,\n$$\nwhere $x_0$ is the vectorization of the given noisy $\\Phi$. Your program must implement the construction of $A$ for arbitrary $N$ and $D$, form and solve the above least-squares projection using the Moore–Penrose pseudoinverse so that it is well-defined even when $A A^\\top$ is singular, and then reshape $x^\\star$ back to the matrix form $\\Phi^\\star$.\n\nTo allow validation of correctness, use the following test suite of four cases. In every case, $N$ is the number of atoms, $D$ is the number of Cartesian components, $\\Phi_0$ is an exactly sum-rule-satisfying matrix, and $\\Delta$ is an additive noise. The noisy input is $\\Phi = \\Phi_0 + \\Delta$.\n\n- Case $1$ (happy path, $N=2$, $D=1$):\n  - $\\Phi_0 = \\begin{bmatrix} 10  -10 \\\\ -10  10 \\end{bmatrix}$,\n  - $\\Delta = \\begin{bmatrix} 0.3  -0.2 \\\\ 0.1  -0.05 \\end{bmatrix}$.\n\n- Case $2$ (multi-atom, $N=3$, $D=1$):\n  - Let $k_{12} = 5$ and $k_{23} = 7$,\n  - $\\Phi_0 = \\begin{bmatrix} 5  -5  0 \\\\ -5  12  -7 \\\\ 0  -7  7 \\end{bmatrix}$,\n  - $\\Delta = \\begin{bmatrix} 0.2  0.05  -0.1 \\\\ 0.12  -0.18  0.07 \\\\ 0.09  -0.04  0.02 \\end{bmatrix}$.\n\n- Case $3$ (vectorial degrees of freedom, $N=2$, $D=2$):\n  - Let $A = \\begin{bmatrix} 12  1 \\\\ 1  9 \\end{bmatrix}$ and construct $\\Phi_0$ as the block matrix\n    $\n    \\Phi_0 = \\begin{bmatrix} A  -A \\\\ -A  A \\end{bmatrix}\n    $ of size $4 \\times 4$,\n  - $\\Delta$ is the $4 \\times 4$ matrix obtained by reshaping, in row-major order, the sequence\n    $\n    [0.05, -0.03, 0.02, 0.01, -0.02, 0.04, -0.05, 0.03, 0.01, -0.02, 0.03, -0.01, -0.04, 0.02, -0.03, 0.05].\n    $\n\n- Case $4$ (edge case, already satisfies the sum rule, $N=2$, $D=1$):\n  - $\\Phi_0 = \\begin{bmatrix} 3  -3 \\\\ -3  3 \\end{bmatrix}$,\n  - $\\Delta = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix}$.\n\nFor each test case, your program must:\n- Construct $A$ for the given $N$ and $D$ such that each constraint row corresponds to a fixed $(I,\\alpha,\\beta)$ triple and sets to $1$ every variable $\\Phi_{(I,\\alpha),(J,\\beta)}$ for all $J$ in that row sum.\n- Compute the optimal correction $x^\\star = x_0 - A^\\top (A A^\\top)^+ A x_0$, where $(\\cdot)^+$ is the Moore–Penrose pseudoinverse, and reshape $x^\\star$ into $\\Phi^\\star$.\n- As a competitor, form a naive feasible correction $\\widetilde{\\Phi}$ by, for each fixed $(I,\\alpha,\\beta)$, adjusting only the diagonal element $(J=I,\\beta)$ to annihilate the corresponding row sum, that is, subtract the current sum from $\\Phi_{(I,\\alpha),(I,\\beta)}$.\n- Report, for each case, three values:\n  $r = \\lVert A \\,\\mathrm{vec}(\\Phi^\\star) \\rVert_2$ as a float, $m$ as a boolean indicating whether $\\lVert \\mathrm{vec}(\\Phi^\\star) - x_0 \\rVert_2 \\le \\lVert \\mathrm{vec}(\\widetilde{\\Phi}) - x_0 \\rVert_2$ up to a numerical tolerance of $10^{-10}$, and $i$ as a boolean indicating whether the correction leaves the input unchanged when the input already satisfies the constraints, that is, $i$ is true if both $\\lVert A x_0 \\rVert_2 \\le 10^{-12}$ and $\\lVert \\mathrm{vec}(\\Phi^\\star) - x_0 \\rVert_2 \\le 10^{-12}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, where each case result is itself a three-element list in the order $[r, m, i]$. For example, a syntactically valid format is\n  $\n  [[r_1,m_1,i_1],[r_2,m_2,i_2],[r_3,m_3,i_3],[r_4,m_4,i_4]].\n  $\nNo physical units are required, and no angles or percentages appear in this problem. All computations should use the Euclidean norm for vectors. The program must be self-contained and require no user input.",
            "solution": "The user wants to solve a constrained least-squares problem to enforce the acoustic sum rule (ASR) on a noisy matrix of interatomic force constants, $\\Phi$.\n\n### Step 1: Problem Validation\n\n#### Extracted Givens\n1.  **Problem Domain**: Lattice dynamics, computational materials science.\n2.  **Physical Principle**: The acoustic sum rule states that a uniform translation of all atoms results in zero net force on any atom.\n3.  **Mathematical Expression of ASR**: For an interatomic force constant matrix $\\Phi \\in \\mathbb{R}^{(ND) \\times (ND)}$ with $N$ atoms in $D$ dimensions, the ASR is given by the linear constraints:\n    $$ \\sum_{J=0}^{N-1} \\Phi_{(I,\\alpha),(J,\\beta)} = 0 $$\n    for each atom index $I \\in \\{0, \\dots, N-1\\}$ and for each pair of Cartesian components $\\alpha, \\beta \\in \\{0, \\dots, D-1\\}$.\n4.  **Optimization Problem**: Given a noisy force constant matrix $\\Phi$ (vectorized as $x_0$), find the corrected vector $x^\\star$ that solves:\n    $$ \\min_{x \\in \\mathbb{R}^{(ND)^2}} \\ \\lVert x - x_0 \\rVert_2^2 \\quad \\text{subject to} \\quad A x = 0 $$\n    where $A$ is the matrix encoding the ASR constraints.\n5.  **Solution Formula**: The optimal solution is given by $x^\\star = x_0 - A^\\top (A A^\\top)^+ A x_0$, where $(\\cdot)^+$ denotes the Moore-Penrose pseudoinverse.\n6.  **Task Requirements**:\n    a.  Implement a procedure to construct the constraint matrix $A$ for arbitrary $N$ and $D$.\n    b.  Implement the solution formula to find the optimally corrected matrix $\\Phi^\\star$.\n    c.  Implement a \"naive\" correction $\\widetilde{\\Phi}$ where, for each constraint, only the diagonal element $\\Phi_{(I,\\alpha),(I,\\beta)}$ is adjusted to satisfy the sum rule.\n    d.  For four specific test cases, report three values:\n        i.  $r = \\lVert A \\,\\mathrm{vec}(\\Phi^\\star) \\rVert_2$: The residual error in satisfying the constraint.\n        ii. $m$: A boolean, true if $\\lVert \\mathrm{vec}(\\Phi^\\star) - x_0 \\rVert_2 \\le \\lVert \\mathrm{vec}(\\widetilde{\\Phi}) - x_0 \\rVert_2$ within a tolerance of $10^{-10}$.\n        iii. $i$: A boolean, true if the input already satisfies the ASR and the correction is zero (within tolerance $10^{-12}$).\n7.  **Test Cases**: Four detailed test cases are provided with specific values for $N$, $D$, an ideal matrix $\\Phi_0$, and an additive noise matrix $\\Delta$.\n    -   Case 1: $N=2, D=1$.\n    -   Case 2: $N=3, D=1$.\n    -   Case 3: $N=2, D=2$.\n    -   Case 4: $N=2, D=1$ (zero noise).\n\n#### Validation Using Extracted Givens\n*   **Scientifically Grounded**: The problem is based on the acoustic sum rule, a fundamental theorem in lattice dynamics derived from translational invariance. The mathematical formulation is a standard application of constrained optimization. The problem is scientifically sound.\n*   **Well-Posed**: The problem is a convex optimization problem (minimizing a squared norm subject to linear constraints), which has a unique solution. The provided solution formula, $x^\\star = x_0 - A^\\top (A A^\\top)^+ A x_0$, corresponds to projecting the initial vector $x_0$ onto the null space of the constraint matrix $A$. This is the standard and correct solution. The use of the Moore-Penrose pseudoinverse ensures the solution is well-defined even if the constraint matrix $A$ is not of full rank. All terms, variables, and objectives are clearly defined. The problem is well-posed.\n*   **Objective**: The problem statement is written in precise, objective mathematical and scientific language. It is free from ambiguity and subjective claims.\n*   **Self-Contained and Consistent**: The problem provides all necessary data ($\\Phi_0$, $\\Delta$, $N$, $D$), definitions (ASR, optimization problem), and evaluation criteria ($r, m, i$). There are no internal contradictions.\n\n#### Verdict and Action\nThe problem is valid. It is a well-defined, scientifically grounded exercise in numerical optimization applied to a real-world physics problem. A full solution will be provided.\n\n### Step 2: Principled Solution Design\n\nThe core task is to implement the projection of a vector $x_0$ onto the null space of a matrix $A$. This projection, $x^\\star$, is the vector in the null space of $A$ (i.e., satisfying $Ax=0$) that is closest to $x_0$ in the Euclidean norm sense.\n\n#### 1. Constructing the Constraint Matrix $A$\n\nThe constraint matrix $A$ maps the vectorized force constant matrix $x \\in \\mathbb{R}^{(ND)^2}$ to the vector of constraint violations. The total number of variables is $(ND)^2$. The total number of constraints is $m = N D^2$. Thus, $A$ is an $m \\times (ND)^2$ matrix.\n\nEach row of $A$ corresponds to one specific constraint, identified by the triplet $(I, \\alpha, \\beta)$. The constraint is $\\sum_{J=0}^{N-1} \\Phi_{(I,\\alpha),(J,\\beta)} = 0$.\nThe matrix $\\Phi$ has row and column indices that are composite: a row is indexed by $(I, \\alpha)$, a column by $(J, \\beta)$. We map these to simple integer indices $i = I \\cdot D + \\alpha$ and $j = J \\cdot D + \\beta$.\nThe vector $x$ is the row-major flattened version of $\\Phi$. The element $\\Phi_{i,j}$ corresponds to the element $x_k$ where $k = i \\cdot (ND) + j$.\n\nFor a constraint given by $(I, \\alpha, \\beta)$:\n-   The row index in $\\Phi$ is fixed: $i_{\\text{row}} = I \\cdot D + \\alpha$.\n-   The column index in $\\Phi$ varies with $J$: $j_{\\text{col}} = J \\cdot D + \\beta$ for $J \\in \\{0, \\dots, N-1\\}$.\nThe constraint sums over the elements $\\Phi_{i_{\\text{row}}, j_{\\text{col}}}$.\nA row in $A$ corresponding to $(I, \\alpha, \\beta)$ will have entries equal to $1$ at the positions in $x$ that correspond to these elements, and $0$ otherwise.\n\nThe algorithm to construct $A$ is as follows:\n1. Initialize an $m \\times (ND)^2$ zero matrix $A$.\n2. Iterate through each constraint, indexed by `c_idx` from $0$ to $m-1$. This corresponds to iterating through $I \\in \\{0, \\dots, N-1\\}$, $\\alpha \\in \\{0, \\dots, D-1\\}$, and $\\beta \\in \\{0, \\dots, D-1\\}$.\n3. For each constraint $(I, \\alpha, \\beta)$, determine the fixed row index of $\\Phi$: $i_{\\text{row}} = I \\cdot D + \\alpha$.\n4. Iterate through $J \\in \\{0, \\dots, N-1\\}$.\n5. For each $J$, determine the column index of $\\Phi$: $j_{\\text{col}} = J \\cdot D + \\beta$.\n6. Calculate the corresponding index in the flattened vector $x$: $k = i_{\\text{row}} \\cdot (N \\cdot D) + j_{\\text{col}}$.\n7. Set $A[\\text{c\\_idx}, k] = 1$.\n\n#### 2. Calculating the Optimal Correction $\\Phi^\\star$\n\nGiven the noisy matrix $\\Phi = \\Phi_0 + \\Delta$, we first vectorize it to obtain $x_0 = \\mathrm{vec}(\\Phi)$. The optimal corrected vector $x^\\star$ is calculated using the provided formula:\n$$ x^\\star = x_0 - A^\\top (A A^\\top)^+ A x_0 $$\nThis can be implemented using matrix operations:\n1. Compute the matrix product $M = A A^\\top$.\n2. Compute the Moore-Penrose pseudoinverse $M^+ = (A A^\\top)^+$. `numpy.linalg.pinv` is suitable for this.\n3. Compute the correction term: $\\delta x = A^\\top M^+ A x_0$. This involves a sequence of matrix-vector and matrix-matrix multiplications.\n4. Compute the corrected vector: $x^\\star = x_0 - \\delta x$.\n5. Reshape $x^\\star$ back into a matrix $\\Phi^\\star$ of size $(ND) \\times (ND)$.\n\n#### 3. Calculating the Naive Correction $\\widetilde{\\Phi}$\n\nThe naive method provides a feasible, but not optimal, solution. For each constraint $(I, \\alpha, \\beta)$, it adjusts only the \"diagonal\" force constant $\\Phi_{(I,\\alpha),(I,\\beta)}$ to satisfy the sum rule.\n1. Create a copy of the noisy matrix: $\\widetilde{\\Phi} = \\Phi$.\n2. Iterate through each constraint $(I, \\alpha, \\beta)$.\n3. Calculate the current sum for this constraint: $S = \\sum_{J=0}^{N-1} \\Phi_{(I,\\alpha),(J,\\beta)}$. Note that this sum is computed from the original noisy matrix $\\Phi$.\n4. Identify the diagonal element for this constraint: its indices are $(I,\\alpha)$ and $(I,\\beta)$.\n5. Subtract the sum $S$ from this element in the copied matrix: $\\widetilde{\\Phi}_{(I,\\alpha),(I,\\beta)} = \\widetilde{\\Phi}_{(I,\\alpha),(I,\\beta)} - S$.\nAfter iterating through all constraints, $\\widetilde{\\Phi}$ will satisfy the ASR.\n\n#### 4. Computing the Reportable Metrics $r, m, i$\n\nWith $\\Phi^\\star$, $\\widetilde{\\Phi}$, and the original $\\Phi$ (and their vectorizations $x^\\star, \\widetilde{x}, x_0$), we compute the required metrics.\n-   **Residual $r$**: $r = \\lVert A x^\\star \\rVert_2$. This measures how well the optimal solution satisfies the constraints. Theoretically, it should be zero; practically, it will be a small value due to floating-point precision.\n-   **Optimality check $m$**: This boolean metric verifies that the least-squares solution is indeed optimal (i.e., minimal distance to the original). We calculate the Euclidean distances $d^\\star = \\lVert x^\\star - x_0 \\rVert_2$ and $\\widetilde{d} = \\lVert \\widetilde{x} - x_0 \\rVert_2$, and check if $d^\\star \\le \\widetilde{d} + \\epsilon_{\\text{tol}}$, where $\\epsilon_{\\text{tol}} = 10^{-10}$.\n-   **Idempotency check $i$**: This boolean metric checks if the correction process is idempotent. If the input $x_0$ already satisfies the ASR, the correction should be zero. This is true if both $\\lVert A x_0 \\rVert_2 \\le 10^{-12}$ and $\\lVert x^\\star - x_0 \\rVert_2 \\le 10^{-12}$.\n\nThe implementation will process each of the four test cases through these steps and format the results as specified.",
            "answer": "[[4.9960036108132044e-16, True, False],[2.220446049250313e-16, True, False],[4.163336342344337e-16, True, False],[0.0, True, True]]"
        }
    ]
}