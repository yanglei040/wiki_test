{
    "hands_on_practices": [
        {
            "introduction": "当温度从零温升高时，熵的贡献变得不可或缺。本实践将探讨正规溶体模型，这是一个简洁而深刻的理论框架，它将理想混合熵与一个焓相互作用项结合起来。通过分析吉布斯自由能曲线的形状，您将推导出相分离的条件，并学习使用切平面距离作为检验热力学稳定性的严格判据 ()。",
            "id": "3464582",
            "problem": "考虑一个总摩尔数固定的等温、等压、多组分混合物。单位摩尔的摩尔吉布斯自由能，经过通用气体常数与温度乘积的无量纲化处理后，记为 $g$。对于受正则溶液型相互作用扰动的理想置换固溶体，一个广泛使用且经过充分检验的组分 $\\mathrm{A}$ 和 $\\mathrm{B}$ 的二元混合物模型为\n$$\ng(x) \\equiv x \\ln x + (1 - x)\\ln(1 - x) + w\\,x(1-x),\n$$\n其中 $x \\in (0,1)$ 是组分 $\\mathrm{A}$ 的摩尔分数，$w \\equiv \\Omega/(R T)$ 是一个无量纲相互作用参数，由正则溶液参数 $\\Omega$ 以及通用气体常数 $R$ 与温度 $T$ 的乘积构成。本问题中所有量均为无量纲量（即以 $R T$ 为单位进行测量），因此答案必须以不带物理单位的纯数字形式报告。\n\n本问题要求您从基本定义出发，完成两项计算任务：\n- 对可能分解为两相的受约束二元混合物进行吉布斯自由能最小化。\n- 进行切平面距离（TPD）稳定性评估，作为对 $g$ 的全局非凸性检验。\n\n您必须从以下基础出发，推导出算法所需的目标构造：\n- 在平衡状态下，一个封闭、等温、等压系统的吉布斯自由能最小。\n- 对于满足约束 $x \\in [0,1]$ 的一维成分变量 $x$，一个两相状态可以由成分 $x_\\alpha$ 和 $x_\\beta$ 以及相分数 $\\lambda \\in [0,1]$ 表示，使得总成分满足 $z = \\lambda x_\\alpha + (1-\\lambda) x_\\beta$，且混合物的自由能为 $g_{\\text{mix}} = \\lambda g(x_\\alpha) + (1-\\lambda) g(x_\\beta)$。\n- 在参考成分 $z$ 处的切平面距离（TPD）是自由能曲面与锚定在 $z$ 处的切平面之间的最小有符号垂直距离；对于一维成分变量，这是在所有允许的 $y$ 上，$g(y)$ 减去 $g$ 关于 $z$ 的一阶泰勒展开式的最小值。\n\n基于此，请在不使用任何预先提供的简化公式的情况下推导：\n- 用于求解 $x_\\alpha$ 和 $x_\\beta$ 的两相共存平衡条件，表示为一对联立方程（公切线条件）。\n- 一维切平面距离函数的表达式，其在 $y \\in [0,1]$ 上的全局最小值指示了参考成分 $z$ 相对于相分离的稳定性（$\\ge 0$）或不稳定性（$ 0$）。\n\n然后，实现一个算法来：\n1) 通过在杠杆定则约束下最小化总吉布斯自由能，求解二元正则溶液模型的两相平衡，并返回平衡连接线成分和最小化的混合物自由能。\n2) 通过在闭区间 $[0,1]$ 上对相应的一维 TPD 函数进行全局最小化，评估指定参考成分处的最小切平面距离。\n\n测试套件和要求的输出：\n- 案例 1（吉布斯自由能最小化）：使用 $w = 2.5$ 和总成分 $z = 0.5$。计算两相平衡成分 $x_\\alpha$ 和 $x_\\beta$（其中 $x_\\alpha  x_\\beta$）、$\\alpha$ 相的相分数 $\\lambda$，以及最小化的混合物自由能 $g_{\\text{mix}}$。\n- 案例 2（不稳定成分处的 TPD）：对于 $w = 2.5$ 的相同模型，通过在 $y \\in [0,1]$ 上进行最小化，评估 $z = 0.5$ 处的最小切平面距离。\n- 案例 3（稳定成分处的 TPD）：对于 $w = 2.5$ 的相同模型，通过在 $y \\in [0,1]$ 上进行最小化，评估 $z = 0.05$ 处的最小切平面距离。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。第一个元素是案例 1 的四个浮点数列表，顺序为 $[x_\\alpha, x_\\beta, \\lambda, g_{\\text{mix}}]$。第二个元素是案例 2 TPD 最小值的单个浮点数。第三个元素是案例 3 TPD 最小值的单个浮点数。例如，您的程序应打印一行形式为\n$[ [x_\\alpha,x_\\beta,\\lambda,g_{\\text{mix}}], \\mathrm{TPD}_{z=0.5}, \\mathrm{TPD}_{z=0.05} ]$\n并用数值替换，不含其他文本。",
            "solution": "该问题要求推导二元正则溶液的平衡条件和稳定性判据，然后实现一个算法来解决特定情况下的相平衡和切平面距离（TPD）问题。整个分析基于所提供的无量纲化摩尔吉布斯自由能模型：\n$$\ng(x) = x \\ln x + (1 - x)\\ln(1 - x) + w\\,x(1-x)\n$$\n其中 $x$ 是组分 A 的摩尔分数，$w$ 是无量纲相互作用参数。\n\n### 第 1 部分：平衡条件的推导\n\n等温等压系统在平衡状态下的基本原理是总吉布斯自由能最小化。对于一个总成分固定为 $z$ 并已相分离成两相（$\\alpha$ 和 $\\beta$，成分分别为 $x_\\alpha$ 和 $x_\\beta$）的系统，其状态由这些成分和 $\\alpha$ 相的摩尔分数 $\\lambda \\in [0,1]$ 描述。\n\n这个两相混合物的摩尔吉布斯自由能 $g_{\\text{mix}}$ 由各组成相自由能的加权平均值给出：\n$$\ng_{\\text{mix}} = \\lambda g(x_\\alpha) + (1-\\lambda) g(x_\\beta)\n$$\n质量守恒（杠杆定则）提供了一个将相分数 $\\lambda$ 与各相成分联系起来的约束条件：\n$$\nz = \\lambda x_\\alpha + (1-\\lambda) x_\\beta\n$$\n根据杠杆定则，我们可以将 $\\lambda$ 表示为各相成分的函数：\n$$\n\\lambda = \\frac{x_\\beta - z}{x_\\beta - x_\\alpha}\n$$\n将此代入 $g_{\\text{mix}}$ 的表达式中，使其在 $z$ 固定时仅成为 $x_\\alpha$ 和 $x_\\beta$ 的函数：\n$$\ng_{\\text{mix}}(x_\\alpha, x_\\beta) = \\frac{x_\\beta - z}{x_\\beta - x_\\alpha} g(x_\\alpha) + \\frac{z - x_\\alpha}{x_\\beta - x_\\alpha} g(x_\\beta)\n$$\n该表达式定义了连接自由能曲线上点 $(x_\\alpha, g(x_\\alpha))$ 和 $(x_\\beta, g(x_\\beta))$ 的线段。通过对变量 $x_\\alpha$ 和 $x_\\beta$ 最小化 $g_{\\text{mix}}$ 来找到平衡点。这需要将偏导数设为零：$\\frac{\\partial g_{\\text{mix}}}{\\partial x_\\alpha} = 0$ 和 $\\frac{\\partial g_{\\text{mix}}}{\\partial x_\\beta} = 0$。\n\n对 $g_{\\text{mix}}$ 关于 $x_\\alpha$（以及通过对称性，关于 $x_\\beta$）求导，得到“公切线”条件：\n$$\ng'(x_\\alpha) = \\frac{g(x_\\beta) - g(x_\\alpha)}{x_\\beta - x_\\alpha} \\quad \\text{和} \\quad g'(x_\\beta) = \\frac{g(x_\\beta) - g(x_\\alpha)}{x_\\beta - x_\\alpha}\n$$\n将这些结合起来，得到定义平衡成分 $x_\\alpha$ 和 $x_\\beta$ 的两个方程组：\n1. $g'(x_\\alpha) = g'(x_\\beta)$\n2. $g(x_\\beta) - g(x_\\alpha) = (x_\\beta - x_\\alpha)g'(x_\\alpha)$\n\n一种等效的方法是基于共存相中各组分化学势相等。化学势 $\\mu_A$ 和 $\\mu_B$ 由下式给出：\n$$\n\\mu_A(x) = g(x) + (1-x)g'(x)\n$$\n$$\n\\mu_B(x) = g(x) - xg'(x)\n$$\n平衡条件为 $\\mu_A(x_\\alpha) = \\mu_A(x_\\beta)$ 和 $\\mu_B(x_\\alpha) = \\mu_B(x_\\beta)$。可以证明，这个方程组与公切线条件完全等效。对于指定的正则溶液模型，化学势为：\n$$\n\\mu_A(x) = \\ln x + w(1-x)^2 \\quad (\\text{经 } RT \\text{ 无量纲化后})\n$$\n$$\n\\mu_B(x) = \\ln(1-x) + wx^2 \\quad (\\text{经 } RT \\text{ 无量纲化后})\n$$\n$g(x)$ 函数关于 $x=0.5$ 对称。这种结构对称性意味着平衡成分 $x_\\alpha$ 和 $x_\\beta$ 也必须是对称的，即 $x_\\beta = 1 - x_\\alpha$。将此代入化学势相等条件，可将两个方程组成的方程组简化为关于 $x_\\alpha$ 的单个方程。例如，从 $\\mu_A(x_\\alpha) = \\mu_A(1-x_\\alpha)$ 可得：\n$$\n\\ln(x_\\alpha) + w(1-x_\\alpha)^2 = \\ln(1-x_\\alpha) + w(1-(1-x_\\alpha))^2\n$$\n$$\n\\ln\\left(\\frac{x_\\alpha}{1-x_\\alpha}\\right) = w(x_\\alpha^2 - (1-x_\\alpha)^2) = w(2x_\\alpha - 1)\n$$\n这个单一的非线性方程可以通过数值方法求解 $x_\\alpha \\in (0, 0.5)$。\n\n### 第 2 部分：切平面距离（TPD）函数的推导\n\nTPD 是热力学稳定性的一个度量。在参考成分 $z$ 处，TPD 是自由能曲线 $g(y)$ 与在 $g(z)$ 处该曲线的切线之间的最小有符号垂直距离。在成分 $z$ 处的切线方程 $T_z(y)$ 是 $g$ 在 $z$ 附近的一阶泰勒展开：\n$$\nT_z(y) = g(z) + g'(z)(y-z)\n$$\n在任意成分 $y$ 处，自由能曲线与该切线之间的垂直距离即为 TPD 函数 $\\Delta_z(y)$：\n$$\n\\Delta_z(y) = g(y) - T_z(y) = g(y) - g(z) - g'(z)(y-z)\n$$\n切平面距离 $\\text{TPD}(z)$ 是该函数在整个成分范围 $y \\in [0,1]$ 上的全局最小值：\n$$\n\\text{TPD}(z) = \\min_{y \\in [0,1]} \\Delta_z(y)\n$$\n根据构造，$\\Delta_z(z)=0$，因此 TPD 总是小于或等于零。如果 $\\text{TPD}(z) = 0$，则成分 $z$ 相对于相分离是稳定或亚稳的。如果 $\\text{TPD}(z)  0$，则成分 $z$ 是不稳定的，并且存在一个具有更低自由能的状态。\n\n### 第 3 部分：算法实现\n\n**案例 1：吉布斯自由能最小化（$w = 2.5, z = 0.5$）**\n1.  设置 $w=2.5$。平衡成分 $x_\\alpha$ 和 $x_\\beta$ 关于 $0.5$ 对称。\n2.  求解 $x_\\alpha  0.5$ 的双节线方程：$\\ln\\left(\\frac{x}{1-x}\\right) - w(2x - 1) = 0$。这通过在区间 $(0, 0.5)$ 上使用数值求根算法（例如，Brent 方法）来完成。\n3.  计算 $x_\\beta = 1 - x_\\alpha$。\n4.  对于总成分 $z=0.5$，根据对称性，相分数相等：$\\lambda = 0.5$。\n5.  最小化的混合物自由能 $g_{\\text{mix}}$ 位于公切线上。根据对称性，$g(x_\\alpha) = g(x_\\beta)$，因此 $g_{\\text{mix}} = \\lambda g(x_\\alpha) + (1-\\lambda)g(x_\\beta) = g(x_\\alpha)$。\n\n**案例 2：不稳定成分处的 TPD（$w = 2.5, z = 0.5$）**\n1.  设置 $w=2.5$ 和 $z=0.5$。$g(x)$ 在 $z=0.5$ 处的导数为 $g'(0.5) = \\ln(1) + w(1-1) = 0$。\n2.  TPD 函数简化为 $\\Delta_{0.5}(y) = g(y) - g(0.5)$。\n3.  我们必须找到该函数在 $y \\in [0,1]$ 上的全局最小值。这等价于找到 $g(y)$ 的全局最小值。对于 $w > 2$，$g(y)$ 有两个最小值，它们围绕在 $y=0.5$ 处的局部最大值对称分布。\n4.  $g(y)$ 的最小值出现在其导数为零的地方：$g'(y) = 0$。我们求解 $g'(y) = \\ln\\left(\\frac{y}{1-y}\\right) + w(1-2y) = 0$ 的根。一个根是 $y=0.5$（最大值）。另外两个根给出最小值。\n5.  我们通过数值方法找到其中一个根 $y_{min}  0.5$。\n6.  TPD 随后计算为 $\\text{TPD}(0.5) = g(y_{min}) - g(0.5)$。\n\n**案例 3：稳定成分处的 TPD（$w = 2.5, z = 0.05$）**\n1.  设置 $w=2.5$ 和 $z=0.05$。成分 $z=0.05$ 位于单相区，因为它小于案例 1 中找到的双节线成分 $x_\\alpha \\approx 0.119$。\n2.  在该区域，自由能曲线 $g(x)$ 是凸的（$g''(x) > 0$），系统是热力学稳定的。\n3.  对于一个稳定相，在 $z$ 处的切线对于所有 $y \\neq z$ 都完全位于自由能曲线 $g(y)$ 的下方。因此，对于所有 $y$，都有 $\\Delta_z(y) = g(y) - T_z(y) \\geq 0$。\n4.  由于 $\\Delta_z(z)=0$，$\\Delta_z(y)$ 在 $y \\in [0,1]$ 上的最小值恰好为 $0$。\n5.  算法通过在区间 $y \\in [0,1]$ 上对函数 $\\Delta_{0.05}(y) = g(y) - g(0.05) - g'(0.05)(y-0.05)$ 进行数值最小化来证实这一点。预期结果为 $0$（或一个在机器精度量级的值）。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq, minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the computational materials thermodynamics problem for a binary regular solution.\n    \"\"\"\n\n    # --- Model Definition ---\n    \n    def gibbs_g(x, w):\n        \"\"\"\n        Calculates the non-dimensional molar Gibbs free energy g(x).\n        Handles x=0 and x=1 cases where x*ln(x) - 0.\n        \"\"\"\n        # np.log(0) gives -inf, and 0 * -inf is nan. We must handle this limit.\n        term1 = x * np.log(x) if x > 0 else 0.0\n        term2 = (1 - x) * np.log(1 - x) if x  1 else 0.0\n        return term1 + term2 + w * x * (1 - x)\n\n    def gibbs_g_prime(x, w):\n        \"\"\"Calculates the derivative of g(x) with respect to x.\"\"\"\n        # This will diverge at x=0 and x=1, which is physically correct.\n        # Callers must use intervals that exclude the endpoints.\n        return np.log(x / (1 - x)) + w * (1 - 2 * x)\n\n    # --- Case 1: Gibbs Energy Minimization ---\n\n    def solve_case1(w, z):\n        \"\"\"\n        Solves for two-phase equilibrium for a given w and overall composition z.\n        \"\"\"\n        # For symmetric g(x), equilibrium phase compositions are symmetric around 0.5.\n        # This simplifies the two common tangent equations to a single equation.\n        # f(x) = ln(x/(1-x)) - w*(2x-1) = 0\n        def binodal_eq(x, w_val):\n            return np.log(x / (1 - x)) - w_val * (2 * x - 1)\n\n        # Solve for x_alpha in the interval (0, 0.5)\n        # The interval needs to be slightly inset to avoid log(0)\n        x_alpha = brentq(binodal_eq, 1e-9, 0.5 - 1e-9, args=(w,))\n        \n        # x_beta is symmetric\n        x_beta = 1 - x_alpha\n        \n        # For z=0.5, by symmetry, phase fraction is 0.5\n        lambda_alpha = 0.5\n\n        # Minimized mixture free energy is the value on the common tangent,\n        # which for a symmetric decomposition is simply g(x_alpha).\n        g_mix = gibbs_g(x_alpha, w)\n\n        return [x_alpha, x_beta, lambda_alpha, g_mix]\n\n    # --- Case 2: TPD at Unstable Composition ---\n    \n    def solve_case2(w, z):\n        \"\"\"\n        Calculates the Tangent Plane Distance at an unstable composition z.\n        \"\"\"\n        # TPD(z) = min_y{ g(y) - g(z) - g'(z)(y-z) }\n        # At z=0.5, g'(0.5) = 0.\n        # So, TPD(0.5) = min_y{ g(y) - g(0.5) }\n        \n        # We need to find the global minimum of g(y). For w  2, the minima\n        # are symmetric around 0.5 and are solutions to g'(y) = 0.\n        def g_prime_eq(y, w_val):\n            return gibbs_g_prime(y, w_val)\n\n        # Find the minimum y_min in (0, 0.5)\n        # The function g'(y) changes sign in this interval. A safe upper bound is  0.5\n        y_min = brentq(g_prime_eq, 1e-9, 0.5 - 1e-9, args=(w,))\n        \n        g_at_ymin = gibbs_g(y_min, w)\n        g_at_z = gibbs_g(z, w)\n        \n        tpd_min = g_at_ymin - g_at_z\n        return tpd_min\n\n    # --- Case 3: TPD at Stable Composition ---\n\n    def solve_case3(w, z):\n        \"\"\"\n        Calculates the Tangent Plane Distance at a stable composition z.\n        \"\"\"\n        # Define the TPD function to be minimized\n        g_at_z = gibbs_g(z, w)\n        g_prime_at_z = gibbs_g_prime(z, w)\n        \n        def tpd_func(y, w_val, z_val, g_z, gp_z):\n            return gibbs_g(y, w_val) - g_z - gp_z * (y - z_val)\n\n        # Minimize the TPD function over the domain [0, 1]\n        res = minimize_scalar(tpd_func, bounds=(0, 1), method='bounded', \n                              args=(w, z, g_at_z, g_prime_at_z))\n        \n        # For a stable phase, TPD is 0. Numerical result might be a very small number.\n        tpd_min = res.fun\n        # Return 0.0 if the result is smaller than a reasonable tolerance\n        return 0.0 if np.abs(tpd_min)  1e-9 else tpd_min\n\n\n    # --- Test Suite Execution ---\n    \n    # Case 1 parameters\n    w1, z1 = 2.5, 0.5\n    results_case1 = solve_case1(w1, z1)\n\n    # Case 2 parameters\n    w2, z2 = 2.5, 0.5\n    results_case2 = solve_case2(w2, z2)\n\n    # Case 3 parameters\n    w3, z3 = 2.5, 0.05\n    results_case3 = solve_case3(w3, z3)\n    \n    # --- Final Output Formatting ---\n    \n    final_results = [results_case1, results_case2, results_case3]\n    \n    # Convert all numbers to strings for the final output string\n    # Custom string formatting for nested list\n    str_results = []\n    for item in final_results:\n        if isinstance(item, list):\n            # Format numbers inside the list with sufficient precision\n            str_results.append(f\"[{','.join(f'{v:.15f}' for v in item)}]\")\n        else:\n            str_results.append(f\"{item:.15f}\")\n            \n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实材料，特别是像玻璃这样的无序相，具有复杂的自由能形貌。本实践将超越简单的解析模型，从更基本的物理贡献出发来构建亥姆霍兹自由能，这些贡献包括固有结构的势能、量子化的振动自由能，以及源于非晶态多样性的构型熵。通过比较非晶相与其晶体对应物的自由能，您将能够预测它们相对稳定性发生反转的温度 ()。",
            "id": "3464555",
            "problem": "要求您通过编程方式，使用一个包含谐振动和构型贡献的固有结构枚举模型，构建非晶相随温度变化的亥姆霍兹自由能 $F(T)$，并将其与晶相的自由能进行比较，以预测玻璃-晶体交叉点。计算需在正则系综和谐振子近似的框架内进行。推导必须从正则配分函数、谐振子能级以及热力学势的标准定义开始。所有量都必须按单个原子计算，并使用精确的物理单位表示。\n\n使用的基本原理：\n- 具有离散微观状态的系统的正则配分函数 $Z$。\n- 亥姆霍兹自由能 $F(T)$ 的定义为 $F(T) = -k_{\\mathrm{B}} T \\ln Z$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n- 角频率为 $\\omega$ 的量子谐振子的能级：$\\epsilon_n = \\hbar \\omega \\left(n + \\tfrac{1}{2}\\right)$，其中 $\\hbar$ 是约化普朗克常数。\n- 独立谐振模式的振动配分函数及其与热力学势的关系。\n\n需实现的模型假设：\n- 晶相由单个固有结构表示，其每个原子的能量为 $E_{\\mathrm{c}}$，并具有一组以太赫兹 (THz) 为单位的每个原子的谐振动模式频率 $\\{f_{\\mathrm{c},j}\\}$。每个原子的晶相自由能是固有结构能量和谐振动自由能之和。\n- 非晶相由一组有限的、按 $i$ 索引的独特固有结构枚举表示，每个结构具有每个原子的能量 $E_i$、一个整数简并度 $g_i$（无量纲，考虑构型多样性）以及一组以太赫兹 (THz) 为单位的每个原子的谐振动模式频率 $\\{f_{i,j}\\}$。总配分函数是所有固有结构的加权和，每个原子的非晶相自由能由该配分函数的正则定义给出。\n- 对每个模式的谐振动贡献必须进行量子力学处理，包括零点能。\n\n所需单位：\n- 温度 $T$ 单位为开尔文 (K)。\n- 能量单位为电子伏特每原子 (eV/atom)。\n- 频率单位为太赫兹 (THz)。使用 $\\omega = 2\\pi f$（其中 $f$ 单位为赫兹）将频率转换为弧度每秒的角频率。\n\n计算任务：\n- 实现一个函数，用于在给定温度 $T$ 下，为一组给定的模式 $\\{\\omega_j\\}$ 计算每个原子的谐振动自由能，包括零点能。\n- 实现每个原子的晶相自由能 $F_{\\mathrm{cryst}}(T)$，作为固有结构能量加上振动自由能。\n- 使用在配分和中带有简并度权重的固有结构枚举，实现每个原子的非晶相自由能 $F_{\\mathrm{amorph}}(T)$。\n- 对于每个测试用例，在指定的温度区间 $[T_{\\min}, T_{\\max}]$ 内，计算交叉温度 $T_{\\times}$（单位为开尔文），在该温度下 $F_{\\mathrm{amorph}}(T) - F_{\\mathrm{cryst}}(T) = 0$。如果在 $[T_{\\min}, T_{\\max}]$ 上没有发生符号变化，则报告 $T_{\\times} = -1.0$。\n- 对于每个测试用例，计算在 $300\\,\\mathrm{K}$ 时的自由能差 $\\Delta F(300\\,\\mathrm{K}) = F_{\\mathrm{amorph}}(300\\,\\mathrm{K}) - F_{\\mathrm{cryst}}(300\\,\\mathrm{K})$，单位为 eV/atom。\n- 对于每个测试用例，计算稳定性标志 $S_{\\mathrm{low}}$ 和 $S_{\\mathrm{high}}$。如果 $F_{\\mathrm{amorph}}(T_{\\min})  F_{\\mathrm{cryst}}(T_{\\min})$，则 $S_{\\mathrm{low}} = 1$；如果 $F_{\\mathrm{amorph}}(T_{\\max})  F_{\\mathrm{cryst}}(T_{\\max})$，则 $S_{\\mathrm{high}} = 1$；否则将相应的标志设置为 $0$。\n\n数值和算法要求：\n- 当检测到符号变化时，使用稳健的求根方法来定位 $T_{\\times}$，采用区间法后跟一维求解器。\n- 在低温下谨慎处理振动自由能以避免数值问题；明确包含零点能。\n- 将 $T_{\\times}$ 四舍五入到一位小数（单位 K），并将 $\\Delta F(300\\,\\mathrm{K})$ 四舍五入到六位小数（单位 eV/atom）。稳定性标志为整数。\n- 物理常数必须使用电子伏特单位制：$k_{\\mathrm{B}} = 8.617333262\\times 10^{-5}\\ \\mathrm{eV/K}$ 和 $\\hbar = 6.582119569\\times 10^{-16}\\ \\mathrm{eV\\cdot s}$。\n\n测试套件：\n- 案例 1（理想情况，预计在范围内有交叉点）：\n  - $T_{\\min} = 1.0\\ \\mathrm{K}$， $T_{\\max} = 1500.0\\ \\mathrm{K}$。\n  - 晶相：$E_{\\mathrm{c}} = -3.200\\ \\mathrm{eV/atom}$，$f_{\\mathrm{c}} = [8.0, 6.0, 4.0]\\ \\mathrm{THz}$。\n  - 非晶结构：\n    - $E_1 = -3.180\\ \\mathrm{eV/atom}$，$g_1 = 50$，$f_1 = [7.5, 5.5, 3.8]\\ \\mathrm{THz}$。\n    - $E_2 = -3.150\\ \\mathrm{eV/atom}$，$g_2 = 200$，$f_2 = [6.2, 4.5, 2.8]\\ \\mathrm{THz}$。\n    - $E_3 = -3.140\\ \\mathrm{eV/atom}$，$g_3 = 500$，$f_3 = [5.8, 4.0, 2.5]\\ \\mathrm{THz}$。\n- 案例 2（预计在范围内没有交叉点）：\n  - $T_{\\min} = 1.0\\ \\mathrm{K}$，$T_{\\max} = 1500.0\\ \\mathrm{K}$。\n  - 晶相：$E_{\\mathrm{c}} = -3.220\\ \\mathrm{eV/atom}$，$f_{\\mathrm{c}} = [8.5, 6.5, 4.5]\\ \\mathrm{THz}$。\n  - 非晶结构：\n    - $E_1 = -3.100\\ \\mathrm{eV/atom}$，$g_1 = 10$，$f_1 = [7.0, 5.0, 3.0]\\ \\mathrm{THz}$。\n    - $E_2 = -3.080\\ \\mathrm{eV/atom}$，$g_2 = 20$，$f_2 = [6.5, 4.7, 2.9]\\ \\mathrm{THz}$。\n- 案例 3（边界情况，交叉点接近范围上限）：\n  - $T_{\\min} = 1.0\\ \\mathrm{K}$，$T_{\\max} = 1200.0\\ \\mathrm{K}$。\n  - 晶相：$E_{\\mathrm{c}} = -3.205\\ \\mathrm{eV/atom}$，$f_{\\mathrm{c}} = [7.2, 5.2, 3.6]\\ \\mathrm{THz}$。\n  - 非晶结构：\n    - $E_1 = -3.190\\ \\mathrm{eV/atom}$，$g_1 = 20$，$f_1 = [6.8, 5.0, 3.5]\\ \\mathrm{THz}$。\n    - $E_2 = -3.180\\ \\mathrm{eV/atom}$，$g_2 = 120$，$f_2 = [6.1, 4.6, 3.1]\\ \\mathrm{THz}$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个测试用例贡献一个包含四个值的列表 $[T_{\\times}, \\Delta F(300\\,\\mathrm{K}), S_{\\mathrm{low}}, S_{\\mathrm{high}}]$，因此最终输出必须是这些列表的列表，例如：“[[T1,DF1,S1_low,S1_high],[T2,DF2,S2_low,S2_high],[T3,DF3,S3_low,S3_high]]”。确保 $T_{\\times}$ 四舍五入到一位小数，$\\Delta F(300\\,\\mathrm{K})$ 四舍五入到六位小数，标志为整数。",
            "solution": "任务是计算并比较一种材料的晶相和非晶相的亥姆霍兹自由能 $F(T)$，以找到它们的交叉温度 $T_{\\times}$。该模型基于固有结构形式，并对振动贡献采用谐振子近似。\n\n推导始于正则系综统计力学的基本原理。亥姆霍兹自由能 $F$ 通过正则配分函数 $Z$ 定义为 $F = -k_{\\mathrm{B}} T \\ln Z$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数， $T$ 是温度。\n\n**1. 从量子谐振子计算振动自由能**\n\n角频率为 $\\omega$ 的单个量子谐振子的能级由下式给出：\n$$ \\epsilon_n = \\hbar \\omega \\left(n + \\frac{1}{2}\\right), \\quad n = 0, 1, 2, \\dots $$\n其中 $\\hbar$ 是约化普朗克常数。此单模式的配分函数 $z_{\\text{vib}}$ 是对其所有能态的求和：\n$$ z_{\\text{vib}}(\\omega, T) = \\sum_{n=0}^{\\infty} e^{-\\epsilon_n / (k_{\\mathrm{B}} T)} = \\sum_{n=0}^{\\infty} e^{-\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\left(n + \\frac{1}{2}\\right)} $$\n将零点能项因子提出并识别出几何级数，我们得到：\n$$ z_{\\text{vib}}(\\omega, T) = e^{-\\frac{\\hbar \\omega}{2 k_{\\mathrm{B}} T}} \\sum_{n=0}^{\\infty} \\left(e^{-\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}}\\right)^n = \\frac{e^{-\\frac{\\hbar \\omega}{2 k_{\\mathrm{B}} T}}}{1 - e^{-\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}}} $$\n该单模式的自由能贡献则为：\n$$ F_{\\text{vib}}(\\omega, T) = -k_{\\mathrm{B}} T \\ln z_{\\text{vib}}(\\omega, T) = -k_{\\mathrm{B}} T \\left( -\\frac{\\hbar \\omega}{2 k_{\\mathrm{B}} T} - \\ln\\left(1 - e^{-\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}}\\right) \\right) $$\n$$ F_{\\text{vib}}(\\omega, T) = \\frac{\\hbar \\omega}{2} + k_{\\mathrm{B}} T \\ln\\left(1 - e^{-\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}}\\right) $$\n第一项 $\\frac{\\hbar \\omega}{2}$ 是与温度无关的零点能 (ZPE)。第二项是热贡献。对于与一个原子相关的一组独立模式 $\\{\\omega_j\\}$，每个原子的振动自由能 $F_{\\text{vib}}^{\\text{atom}}$ 是各贡献之和：\n$$ F_{\\text{vib}}^{\\text{atom}}(\\{\\omega_j\\}, T) = \\sum_j F_{\\text{vib}}(\\omega_j, T) = \\sum_j \\left( \\frac{\\hbar \\omega_j}{2} + k_{\\mathrm{B}} T \\ln\\left(1 - e^{-\\frac{\\hbar \\omega_j}{k_{\\mathrm{B}} T}}\\right) \\right) $$\n输入的频率 $f_j$ 单位为太赫兹 ($1\\ \\text{THz} = 10^{12}\\ \\text{Hz}$)，通过 $\\omega_j = 2\\pi f_j \\times 10^{12}\\ \\text{rad/s}$ 转换为角频率。\n\n**2. 晶相自由能**\n\n晶相被建模为单个固有结构，其每个原子的势能为 $E_{\\mathrm{c}}$。其每个原子的总自由能是此静态晶格能量与其模式 $\\{\\omega_{\\mathrm{c},j}\\}$ 的振动自由能之和：\n$$ F_{\\mathrm{cryst}}^{\\text{atom}}(T) = E_{\\mathrm{c}} + F_{\\text{vib}}^{\\text{atom}}(\\{\\omega_{\\mathrm{c},j}\\}, T) $$\n此表达式源于配分函数 $Z_{\\mathrm{cryst}} = e^{-E_{\\mathrm{c}}/(k_{\\mathrm{B}}T)} \\times Z_{\\text{vib,cryst}}$，其中 $Z_{\\text{vib,cryst}} = \\prod_j z_{\\text{vib}}(\\omega_{\\mathrm{c},j}, T)$。\n\n**3. 非晶相自由能**\n\n非晶相被描述为一系列独特的固有结构，以 $i$ 为索引。每个结构都有一个每个原子的势能 $E_i$、一个简并度 $g_i$ 和一组独特的振动模式 $\\{\\omega_{i,j}\\}$。非晶相的总正则配分函数是所有结构的总和：\n$$ Z_{\\mathrm{amorph}} = \\sum_i g_i Z_i $$\n其中 $Z_i$ 是与固有结构 $i$ 相关联的状态子系统的配分函数。它由以下公式给出：\n$$ Z_i = e^{-E_i / (k_{\\mathrm{B}} T)} Z_{\\text{vib},i} = e^{-E_i / (k_{\\mathrm{B}} T)} \\prod_j z_{\\text{vib}}(\\omega_{i,j}, T) $$\n结构 $i$ 的自由能为 $F_i(T) = -k_{\\mathrm{B}} T \\ln Z_i = E_i + F_{\\text{vib}}^{\\text{atom}}(\\{\\omega_{i,j}\\}, T)$。我们可以将 $Z_i$ 重写为 $Z_i = e^{-F_i(T) / (k_{\\mathrm{B}} T)}$。总配分函数变为：\n$$ Z_{\\mathrm{amorph}} = \\sum_i g_i e^{-F_i(T) / (k_{\\mathrm{B}} T)} $$\n非晶相的每个原子的总自由能则为：\n$$ F_{\\mathrm{amorph}}^{\\text{atom}}(T) = -k_{\\mathrm{B}} T \\ln Z_{\\mathrm{amorph}} = -k_{\\mathrm{B}} T \\ln \\left( \\sum_i g_i e^{-F_i(T) / (k_{\\mathrm{B}} T)} \\right) $$\n为了数值稳定性，特别是当指数函数的参数是大的负数时，采用 log-sum-exp 技巧。设 $x_i(T) = \\ln(g_i) - F_i(T) / (k_{\\mathrm{B}} T)$。则：\n$$ \\ln(Z_{\\mathrm{amorph}}) = \\ln \\left( \\sum_i e^{x_i(T)} \\right) = x_{\\text{max}}(T) + \\ln \\left( \\sum_i e^{x_i(T) - x_{\\text{max}}(T)} \\right) $$\n其中 $x_{\\text{max}}(T) = \\max_i \\{x_i(T)\\}$。这避免了浮点溢出并最大限度地减少了因下溢造成的精度损失。\n\n**4. 计算算法**\n\n解决方案被实现为一系列函数，用于为每个测试用例计算所需的量。\n- 函数 `harmonic_vibrational_free_energy` 接收一组频率（单位 THz）和温度 $T$，以计算 $F_{\\text{vib}}^{\\text{atom}}$。它使用指定的基于电子伏特单位的物理常数 $k_{\\mathrm{B}}$ 和 $\\hbar$。\n- 为每个测试用例构建 `F_cryst` 和 `F_amorph` 函数。它们以温度 $T$ 作为输入，使用 `harmonic_vibrational_free_energy` 函数和特定案例的模型参数来计算各自的每原子自由能。`F_amorph` 函数实现了数值稳定的 log-sum-exp 方法。\n- 自由能差函数定义为 $\\Delta F(T) = F_{\\mathrm{amorph}}^{\\text{atom}}(T) - F_{\\mathrm{cryst}}^{\\text{atom}}(T)$。\n- 为了找到交叉温度 $T_{\\times}$，我们寻求 $\\Delta F(T) = 0$ 的根。首先检查 $\\Delta F(T_{\\min})$ 和 $\\Delta F(T_{\\max})$ 的符号。如果它们不同，则保证在区间 $[T_{\\min}, T_{\\max}]$ 内存在一个根。使用 `scipy.optimize.brentq` 求解器（一种稳健的区间求根算法）来寻找 $T_{\\times}$。如果符号相同，则在区间内未检测到交叉点，并将 $T_{\\times}$ 设置为 $-1.0$。\n- 在 $T=300\\ \\text{K}$ 时的自由能差 $\\Delta F(300\\ \\text{K})$ 通过直接评估计算得出。\n- 稳定性标志 $S_{\\mathrm{low}}$ 和 $S_{\\mathrm{high}}$ 分别由 $\\Delta F(T)$ 在 $T_{\\min}$ 和 $T_{\\max}$ 处的符号决定。如果非晶相更稳定（即 $\\Delta F  0$），则 $S=1$，否则 $S=0$。\n- 每个测试用例的最终结果——$T_{\\times}$、$\\Delta F(300\\ \\text{K})$、$S_{\\mathrm{low}}$ 和 $S_{\\mathrm{high}}$——被收集并按照问题规范格式化为单个输出字符串。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the materials thermodynamics problem for the given test cases.\n    \"\"\"\n    \n    # Physical constants in specified units\n    KB_EV_K = 8.617333262e-5  # Boltzmann constant in eV/K\n    HBAR_EV_S = 6.582119569e-16 # Reduced Planck constant in eV*s\n\n    test_cases = [\n        {\n            \"T_min\": 1.0, \"T_max\": 1500.0,\n            \"cryst\": {\"E_c\": -3.200, \"freqs\": np.array([8.0, 6.0, 4.0])},\n            \"amorph\": [\n                {\"E_i\": -3.180, \"g_i\": 50, \"freqs\": np.array([7.5, 5.5, 3.8])},\n                {\"E_i\": -3.150, \"g_i\": 200, \"freqs\": np.array([6.2, 4.5, 2.8])},\n                {\"E_i\": -3.140, \"g_i\": 500, \"freqs\": np.array([5.8, 4.0, 2.5])},\n            ]\n        },\n        {\n            \"T_min\": 1.0, \"T_max\": 1500.0,\n            \"cryst\": {\"E_c\": -3.220, \"freqs\": np.array([8.5, 6.5, 4.5])},\n            \"amorph\": [\n                {\"E_i\": -3.100, \"g_i\": 10, \"freqs\": np.array([7.0, 5.0, 3.0])},\n                {\"E_i\": -3.080, \"g_i\": 20, \"freqs\": np.array([6.5, 4.7, 2.9])},\n            ]\n        },\n        {\n            \"T_min\": 1.0, \"T_max\": 1200.0,\n            \"cryst\": {\"E_c\": -3.205, \"freqs\": np.array([7.2, 5.2, 3.6])},\n            \"amorph\": [\n                {\"E_i\": -3.190, \"g_i\": 20, \"freqs\": np.array([6.8, 5.0, 3.5])},\n                {\"E_i\": -3.180, \"g_i\": 120, \"freqs\": np.array([6.1, 4.6, 3.1])},\n            ]\n        },\n    ]\n\n    results = []\n\n    def harmonic_vibrational_free_energy(freqs_thz, T):\n        \"\"\"\n        Computes the per-atom harmonic vibrational free energy.\n        freqs_thz are in THz, T is in K.\n        Returns energy in eV/atom.\n        \"\"\"\n        if T == 0:\n            # At T=0, F_vib is just the ZPE\n            omegas = 2 * np.pi * freqs_thz * 1e12\n            hbar_omegas = HBAR_EV_S * omegas\n            return np.sum(hbar_omegas / 2.0)\n\n        omegas = 2 * np.pi * freqs_thz * 1e12  # rad/s\n        hbar_omegas = HBAR_EV_S * omegas  # eV\n        \n        # Zero-point energy contribution\n        zpe = np.sum(hbar_omegas / 2.0)\n        \n        # Thermal contribution\n        arg = hbar_omegas / (KB_EV_K * T)\n        # np.exp(-large_number) safely underflows to 0.\n        thermal_term = KB_EV_K * T * np.sum(np.log(1.0 - np.exp(-arg)))\n\n        return zpe + thermal_term\n\n    for case in test_cases:\n        \n        # Crystalline Free Energy Function\n        def F_cryst(T):\n            E_c = case[\"cryst\"][\"E_c\"]\n            freqs_c = case[\"cryst\"][\"freqs\"]\n            F_vib_c = harmonic_vibrational_free_energy(freqs_c, T)\n            return E_c + F_vib_c\n\n        # Amorphous Free Energy Function\n        def F_amorph(T):\n            if T == 0: # Handle T=0 case by calculating sum of lowest energy states\n                min_energy_struct = min(case[\"amorph\"], key=lambda s: s[\"E_i\"])\n                F_vib_min = harmonic_vibrational_free_energy(min_energy_struct[\"freqs\"], T)\n                return min_energy_struct[\"E_i\"] + F_vib_min\n            \n            F_i_list = []\n            for struct in case[\"amorph\"]:\n                E_i = struct[\"E_i\"]\n                freqs_i = struct[\"freqs\"]\n                F_vib_i = harmonic_vibrational_free_energy(freqs_i, T)\n                F_i_list.append(E_i + F_vib_i)\n\n            g_i_list = np.array([s[\"g_i\"] for s in case[\"amorph\"]])\n            F_i_array = np.array(F_i_list)\n\n            # Log-Sum-Exp for numerical stability\n            x_i = np.log(g_i_list) - F_i_array / (KB_EV_K * T)\n            x_max = np.max(x_i)\n            log_sum = x_max + np.log(np.sum(np.exp(x_i - x_max)))\n\n            return -KB_EV_K * T * log_sum\n\n        # Free Energy Difference Function\n        def delta_F(T):\n            return F_amorph(T) - F_cryst(T)\n\n        T_min, T_max = case[\"T_min\"], case[\"T_max\"]\n\n        # Calculate values at boundaries\n        delta_F_min = delta_F(T_min)\n        delta_F_max = delta_F(T_max)\n\n        # Determine stability flags\n        S_low = 1 if delta_F_min  0 else 0\n        S_high = 1 if delta_F_max  0 else 0\n\n        # Find crossover temperature\n        T_cross = -1.0\n        if delta_F_min * delta_F_max = 0: # Sign change or root at boundary\n            try:\n                T_cross = brentq(delta_F, T_min, T_max)\n            except ValueError:\n                # Should not happen due to the check, but as a safeguard.\n                T_cross = -1.0\n        \n        # Calculate free energy difference at 300 K\n        delta_F_300K = delta_F(300.0)\n        \n        # Collect results for this case\n        results.append([T_cross, delta_F_300K, S_low, S_high])\n\n    # Format the final output string\n    final_str_parts = []\n    for res in results:\n        part = f\"[{res[0]:.1f},{res[1]:.6f},{res[2]},{res[3]}]\"\n        final_str_parts.append(part)\n    \n    final_output = f\"[{','.join(final_str_parts)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}