{
    "hands_on_practices": [
        {
            "introduction": "态密度（DOS）在能带边的具体形态并非普适的，而是很大程度上取决于系统的维度。这项实践提供了一个“数值实验室”，用于验证一维、二维和三维系统中这些基本的幂律依赖关系。通过这个练习，你将抽象的DOS概念与载流子浓度等可观测量直接联系起来。",
            "id": "3443154",
            "problem": "考虑一个维度 $d\\in\\{1,2,3\\}$ 的单一各向同性抛物线型导带，其色散关系为 $E(\\mathbf{k}) = E_c + \\alpha \\|\\mathbf{k}\\|^2$，其中 $E_c$ 是导带底能量，$\\alpha0$ 是一个常数。在无量纲单位下进行计算，其中 $E_c=0$ 且 $\\alpha=1$，因此 $E(\\mathbf{k}) = \\|\\mathbf{k}\\|^2$。在这些单位中，能量是无量纲的，温度由 $\\theta = k_B T$ 表示，单位与无量纲能量单位相同。态密度 (DOS) $N(E)$ 和电子浓度 $n(T)$ 的定义如下。\n\n基本原理：\n- 态密度 (DOS) 定义为 $N(E) = \\int \\delta(E - E(\\mathbf{k}))\\, d^d\\mathbf{k}$。\n- 电子浓度定义为 $n(T) = \\int_{0}^{\\infty} N(E)\\, f(E;E_f,\\theta)\\, dE$，其中 $f(E;E_f,\\theta) = \\frac{1}{1+\\exp\\left(\\frac{E - E_f}{\\theta}\\right)}$ 是费米-狄拉克分布，$E_f$ 是费米能级，$\\theta$ 是无量纲热能。\n\n您的任务是数值验证带边附近态密度 $N(E)$ 的维度依赖性，并分析其对带边附近电子浓度 $n(T)$ 的影响。具体而言：\n\n1. 对于每个 $d\\in\\{1,2,3\\}$，在低能窗口 $E\\in[E_{\\min},E_{\\max}]$ 内估计幂律指数 $\\alpha_d$，使得 $N(E)\\propto (E - E_c)^{\\alpha_d}$。使用 $E_{\\min}=10^{-6}$ 和 $E_{\\max}=5\\times 10^{-2}$。通过变换到超球坐标并在 $r\\in[r_{\\min},r_{\\max}]$ 的均匀网格上离散化径向坐标来数值计算 $N(E)$，其中 $r_{\\min}=10^{-4}$，$r_{\\max}=2.0$。在指定的能量窗口内，通过拟合 $\\ln N(E)$ 相对于 $\\ln(E-E_c)$ 的斜率来获得 $\\alpha_d$。以浮点数形式返回三个估计的指数，保留三位小数。\n\n2. 对于每个 $d\\in\\{1,2,3\\}$，分析当 $E_f=E_c$ 时带边附近电子浓度 $n(T)$ 的温度依赖性。使用与第1部分相同的径向离散化方法，通过k空间积分（即通过对d维k空间测度上的占据数进行积分）计算三个温度 $\\theta\\in\\{0.005,0.01,0.02\\}$ 下的 $n(T)$。通过拟合 $\\ln n$ 相对于 $\\ln \\theta$ 的斜率 $\\beta_d$ 来表征带边处的幂律依赖关系 $n(T)\\propto \\theta^{\\beta_d}$。以浮点数形式返回三个估计的斜率 $\\beta_d$，保留三位小数。\n\n3. 对于每个 $d\\in\\{1,2,3\\}$，设置 $E_f=E_c-\\Delta$（其中 $\\Delta=0.2$），并根据低温下 $n(T)$ 的温度依赖性估计有效激活能。使用k空间积分计算两个温度 $\\theta_1=0.005$ 和 $\\theta_2=0.01$ 下的 $n(T)$。通过有限差分近似\n$$\n\\Delta_d \\approx -\\frac{\\ln n(\\theta_2)-\\ln n(\\theta_1)}{\\frac{1}{\\theta_2}-\\frac{1}{\\theta_1}}.\n$$\n来估计 $\\Delta_d$。以浮点数形式返回三个估计的激活能 $\\Delta_d$，保留三位小数。\n\n实现要求：\n- 仅使用无量纲单位。无需物理单位。\n- 角度不出现；无需指定角度单位。\n- 对于第2和第3部分的积分，使用k空间测度计算 $n(T)$，其中径向积分 $\\int_0^{r_{\\max}} r^{d-1} f(r^2;E_f,\\theta)\\, dr$ 在与之前相同的均匀网格 $r\\in[r_{\\min},r_{\\max}]$ 上离散化，其中 $r_{\\min}=10^{-4}$，$r_{\\max}=2.0$。使用数值稳定的积分法则。\n- 将您的程序设计为完全独立，无需外部输入。\n\n测试套件：\n- DOS指数估计：维度 $d=1,2,3$，使用指定的能量窗口和径向网格，以获得 $\\alpha_1,\\alpha_2,\\alpha_3$。\n- 带边处的温度标度：维度 $d=1,2,3$，使用 $E_f=E_c$ 和温度 $\\theta=\\{0.005,0.01,0.02\\}$，以获得 $\\beta_1,\\beta_2,\\beta_3$。\n- 激活能估计：维度 $d=1,2,3$，使用 $E_f=E_c-\\Delta$，$\\Delta=0.2$ 和温度 $\\theta_1=0.005$, $\\theta_2=0.01$，以获得 $\\Delta_1,\\Delta_2,\\Delta_3$。\n\n最终输出格式：\n您的程序应生成单行输出，包含九个结果，形式为方括号括起来的逗号分隔列表：\n$[\\alpha_1,\\alpha_2,\\alpha_3,\\beta_1,\\beta_2,\\beta_3,\\Delta_1,\\Delta_2,\\Delta_3]$，\n其中每个条目都是保留三位小数的浮点数。",
            "solution": "该问题要求对一个简化的半导体导带模型进行态密度(DOS)和电子浓度的数值研究。分析将在维度 $d \\in \\{1, 2, 3\\}$ 下进行。该问题在科学上是适定的，并为数值求解提供了所有必要的参数。解决方案按规定分为三个部分进行开发。\n\n### 第1部分：态密度 (DOS) 指数 $\\alpha_d$\n\n能量色散关系在无量綱单位下给出为 $E(\\mathbf{k}) = \\|\\mathbf{k}\\|^2$。我们用 $k$ 表示波矢 $\\|\\mathbf{k}\\|$ 的大小，因此 $E(k) = k^2$。态密度 $N(E)$ 的定义是，$N(E)dE$ 给出能量区间 $[E, E+dE]$ 内的态数。能量最高为 $E$ 的总态数，称为积分态密度 $\\mathcal{N}(E)$，与k空间中半径为 $k=\\sqrt{E}$ 的 $d$ 维超球体的体积成正比。半径为 $k$ 的 $d$ 维球体的体积与 $k^d$ 成正比。\n\n因此，积分态密度为：\n$$\n\\mathcal{N}(E) \\propto k^d = (E^{1/2})^d = E^{d/2}\n$$\n态密度是积分态密度对能量的导数：\n$$\nN(E) = \\frac{d\\mathcal{N}(E)}{dE} \\propto \\frac{d}{dE}(E^{d/2}) = \\frac{d}{2} E^{d/2 - 1}\n$$\n这预测了幂律关系 $N(E) \\propto E^{\\alpha_d}$，其中理论指数为 $\\alpha_d = \\frac{d}{2} - 1$。预期值为 $\\alpha_1 = -0.5$，$\\alpha_2 = 0$ 和 $\\alpha_3 = 0.5$。\n\n为了按要求进行数值验证，我们将径向坐标 $k$（在问题中表示为 $r$）在一个均匀网格上离散化。位于半径 $k_1$ 和 $k_2$ 之间的薄壳中的态数 $\\Delta\\mathcal{N}$ 与该壳的体积成正比，即 $\\Delta\\mathcal{N} \\propto k_2^d - k_1^d$。相应的能量区间为 $\\Delta E = k_2^2 - k_1^2$。中点能量 $E \\approx (k_1^2+k_2^2)/2$ 处的态密度可以通过有限差分近似：\n$$\nN(E) \\approx \\frac{\\Delta\\mathcal{N}}{\\Delta E} \\propto \\frac{k_2^d - k_1^d}{k_2^2 - k_1^2}\n$$\n我们在指定的径向网格上计算这些值。然后，我们对计算出的态密度的对数与能量的对数（即 $\\ln N(E)$ vs. $\\ln E$）进行线性拟合。这条线的斜率提供了指数 $\\alpha_d$ 的数值估计。\n\n### 第2部分：带边处的温度标度 ($\\beta_d$)\n\n电子浓度 $n(T)$ 由态密度与费米-狄拉克分布 $f(E;E_f,\\theta)$ 的乘积对所有能量的积分给出。\n$$\nn(T) = \\int_0^\\infty N(E) f(E; E_f, \\theta) dE\n$$\n该积分可以变换为对k空间的积分：\n$$\nn(T) = \\int f(E(\\mathbf{k});E_f,\\theta) \\, d^d\\mathbf{k}\n$$\n切换到超球坐标，其中体积元为 $d^d\\mathbf{k} \\propto k^{d-1}dk$， $n(T)$ 的表达式变为（不计常数前置因子）：\n$$\nn(T) \\propto \\int_0^\\infty k^{d-1} f(k^2; E_f, \\theta) dk\n$$\n在这一部分，我们将费米能级设置在带底，$E_f=E_c=0$。该积分使用梯形法则在指定的离散径向网格 $r \\in [r_{\\min}, r_{\\max}]$ 上进行数值计算。我们为三个温度 $\\theta \\in \\{0.005, 0.01, 0.02\\}$ 计算 $n(T)$。幂律依赖关系 $n(T) \\propto \\theta^{\\beta_d}$ 通过对 $\\ln n(T)$ 与 $\\ln \\theta$ 进行线性拟合来确定。这条线的斜率就是所求的指数 $\\beta_d$。\n\n### 第3部分：激活能估计 ($\\Delta_d$)\n\n这部分研究当费米能级位于带隙内，$E_f = E_c - \\Delta = -0.2$ 时的低温行为。在这种非简并极限下，其中 $(E-E_f) \\gg \\theta$，费米-狄拉克分布可以近似为麦克斯韦-玻尔兹曼分布：\n$$\nf(E; E_f, \\theta) \\approx \\exp\\left(-\\frac{E-E_f}{\\theta}\\right) = \\exp\\left(\\frac{E_f}{\\theta}\\right)\\exp\\left(-\\frac{E}{\\theta}\\right)\n$$\n将此代入 $n(T)$ 的积分中，得到一个主要由类阿伦尼乌斯项决定的温度依赖关系：\n$$\nn(T) \\propto \\exp\\left(\\frac{E_f}{\\theta}\\right) \\propto \\exp\\left(-\\frac{\\Delta}{\\theta}\\right)\n$$\n$\\ln n(T)$ 相对于 $1/\\theta$ 的阿伦尼乌斯图将产生一条斜率为 $-\\Delta$ 的直线。问题指定了一个两点有限差分公式来估计该斜率，这等效于计算阿伦尼乌斯图上两点之间的斜率：\n$$\n\\Delta_d \\approx -\\frac{\\ln n(\\theta_2)-\\ln n(\\theta_1)}{\\frac{1}{\\theta_2}-\\frac{1}{\\theta_1}}\n$$\n我们使用与第2部分相同的数值积分方法，为 $\\theta_1=0.005$ 和 $\\theta_2=0.01$ 计算 $n(T)$，然后应用该公式求出每个维度的估计激活能 $\\Delta_d$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the three-part problem to determine dimensionality-dependent\n    properties of a parabolic band model. The results are collected and\n    printed in the specified format.\n    \"\"\"\n\n    # --- Global numerical parameters ---\n    r_min = 1e-4\n    r_max = 2.0\n    # A high number of points ensures accuracy for both finite difference and integration.\n    num_r_points = 500000 \n\n    # --- Result storage ---\n    all_results = []\n\n    # =================================================================\n    # Part 1: Estimate DOS power-law exponent alpha_d\n    # =================================================================\n    E_min_fit = 1e-6\n    E_max_fit = 5e-2\n    \n    # Generate a fine, uniform radial grid in k-space (denoted as r)\n    r = np.linspace(r_min, r_max, num_r_points)\n    r_inner = r[:-1]\n    r_outer = r[1:]\n    \n    # Energy grid corresponding to the midpoints of the r-grid shells\n    E_mid = (r_outer**2 + r_inner**2) / 2.0\n    \n    # Energy width of each shell\n    dE = r_outer**2 - r_inner**2\n    \n    with np.errstate(divide='ignore', invalid='ignore'):\n        for d in [1, 2, 3]:\n            # Number of states in a k-space shell is proportional to its volume.\n            # Volume of a hyperspherical shell is proportional to (k_outer^d - k_inner^d).\n            dN = r_outer**d - r_inner**d\n            \n            # DOS N(E) is d(NumStates)/dE, approximated by finite differences.\n            N_E = dN / dE\n            \n            # For d=2, dN is proportional to (r_outer^2 - r_inner^2), so N_E is a constant.\n            # Handle this case explicitly to avoid potential floating point issues.\n            if d == 2:\n                N_E = np.ones_like(E_mid)\n\n            # Filter data to the specified energy fitting window\n            fit_mask = (E_mid >= E_min_fit)  (E_mid = E_max_fit)\n            E_fit = E_mid[fit_mask]\n            N_fit = N_E[fit_mask]\n\n            # Perform linear regression on log-log data to find the exponent\n            log_E = np.log(E_fit)\n            log_N = np.log(N_fit)\n            \n            # np.polyfit(x, y, 1) returns [slope, intercept]\n            alpha_d, _ = np.polyfit(log_E, log_N, 1)\n            all_results.append(alpha_d)\n\n    # =================================================================\n    # Part 2: Estimate temperature scaling exponent beta_d\n    # =================================================================\n    thetas_beta = np.array([0.005, 0.01, 0.02])\n    E_f_beta = 0.0  # Fermi level at the band edge\n\n    for d in [1, 2, 3]:\n        n_vals = []\n        for theta in thetas_beta:\n            # Integrand: k^(d-1) * f(E(k); E_f, theta)\n            exp_arg = (r**2 - E_f_beta) / theta\n            fermi_dirac = 1.0 / (1.0 + np.exp(exp_arg))\n            integrand = r**(d-1) * fermi_dirac\n            \n            # Numerically integrate using the trapezoidal rule\n            n_val = np.trapz(integrand, r)\n            n_vals.append(n_val)\n        \n        # Perform linear regression on log-log data\n        log_n = np.log(n_vals)\n        log_theta = np.log(thetas_beta)\n        \n        beta_d, _ = np.polyfit(log_theta, log_n, 1)\n        all_results.append(beta_d)\n\n    # =================================================================\n    # Part 3: Estimate activation energy Delta_d\n    # =================================================================\n    E_f_delta = -0.2\n    theta1_delta = 0.005\n    theta2_delta = 0.01\n\n    for d in [1, 2, 3]:\n        # Calculate n(theta1)\n        exp_arg1 = (r**2 - E_f_delta) / theta1_delta\n        fermi_dirac1 = 1.0 / (1.0 + np.exp(exp_arg1))\n        integrand1 = r**(d-1) * fermi_dirac1\n        n1 = np.trapz(integrand1, r)\n        \n        # Calculate n(theta2)\n        exp_arg2 = (r**2 - E_f_delta) / theta2_delta\n        fermi_dirac2 = 1.0 / (1.0 + np.exp(exp_arg2))\n        integrand2 = r**(d-1) * fermi_dirac2\n        n2 = np.trapz(integrand2, r)\n        \n        # Apply the finite-difference formula for activation energy\n        delta_d = -(np.log(n2) - np.log(n1)) / (1.0/theta2_delta - 1.0/theta1_delta)\n        all_results.append(delta_d)\n    \n    # --- Final Output ---\n    # Format the results to three decimal places as required by the problem statement\n    formatted_results = [f\"{x:.3f}\" for x in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "正确确定材料性质的前提是必须找到能给出正确电子总数的化学势 $\\mu$。这项实践旨在构建一个鲁棒的数值求解器，以在给定温度下找到化学势 $\\mu$，这是任何自洽场计算或有限温度模拟中的关键组成部分。这个练习将巩固你对费米-狄拉克统计和布里渊区积分的理解。",
            "id": "3443117",
            "problem": "实现一个有限温度化学势求解器，该求解器通过调整化学势 $\\,\\mu\\,$ 来满足电子数约束\n$$\nN_e(\\mu,T) \\;=\\; \\int_{-\\infty}^{+\\infty} N(E)\\, f(E,\\mu,T)\\, dE \\,,\n$$\n其中 $\\,N(E)\\,$ 是电子态密度，$\\,f(E,\\mu,T)\\,$ 是费米–狄拉克分布。您的实现必须基于紧束缚模型，并使用离散的 $\\,k\\,$ 点采样以在计算上现实的方式近似该积分。\n\n使用以下物理上真实且自洽的设置，这是计算材料科学电子结构工作流程中的标准配置：\n- 一维单原子链，每个原胞有一个 $\\,s\\,$ 轨道，最近邻跃迁参数 $\\,t = 1.0\\,\\mathrm{eV}\\,$，晶格常数 $\\,a = 1.0\\,\\mathrm{\\AA}\\,$，自旋简并度 $\\,g_s = 2$。\n- 单带紧束缚色散关系为\n$$\nE(k) \\;=\\; -2t \\cos(ka)\\,,\n$$\n布里渊区为 $\\,k \\in [-\\pi/a,\\pi/a)\\,$。这产生一个能量范围为 $\\,E \\in [-2t,2t]$ 的单能带。\n- 有限温度 $\\,T\\,$ 下的费米–狄拉克分布为\n$$\nf(E,\\mu,T) \\;=\\; \\frac{1}{1 + \\exp\\!\\big( \\frac{E-\\mu}{k_B T} \\big)}\\,,\n$$\n其中 $\\,k_B\\,$ 是玻尔兹曼常数，单位为电子伏特每开尔文。\n- 每个原胞电子数的离散 $\\,k\\,$ 点近似为\n$$\nN_e(\\mu,T;N_k) \\;=\\; \\frac{g_s}{N_k}\\,\\sum_{j=1}^{N_k} f\\!\\big(E(k_j),\\mu,T\\big)\\,,\n$$\n其中 $\\,\\{k_j\\}\\,$ 是在布里渊区上均匀分布的 $\\,N_k\\,$ 个 $\\,k\\,$ 点。这将连续的态密度积分替换为对采样能带能量的黎曼和，这与现代密度泛函理论 (DFT) 的实现方式一致。\n\n您的任务：\n1. 在给定的 $\\,T\\,$ 和目标电子数 $\\,N_e^{\\mathrm{target}}\\,$ 条件下，为 $\\,\\mu\\,$ 实现一个稳健、单调的求根程序，以求解\n$$\nF(\\mu) \\;=\\; N_e(\\mu,T;N_k) - N_e^{\\mathrm{target}} \\;=\\; 0\\,.\n$$\n利用 $\\,F(\\mu)\\,$ 在有限温度 $\\,T\\,$ 下随 $\\,\\mu\\,$ 严格递增这一事实，设计一个区间求解器。您的方法必须在低至 $\\,10\\,\\mathrm{K}\\,$ 高至 $\\,1500\\,\\mathrm{K}\\,$ 的温度下保持数值稳定，并且必须能处理能带边缘附近的占据情况。玻尔兹曼常数必须为 $\\,k_B = 8.617333262\\times 10^{-5}\\,\\mathrm{eV/K}\\,$。\n2. 通过将每个计算出的化学势与使用稠密网格 $\\,N_k^{\\mathrm{ref}}\\,$ 为相同温度和目标电子数计算出的高分辨率参考值进行比较，分析关于 $\\,k\\,$ 点采样的收敛性。在所有计算中，能量（包括 $\\,\\mu\\,$）以 $\\mathrm{eV}$ 表示，温度以 $\\mathrm{K}$ 表示。您的程序必须在内部使用 $\\,N_k^{\\mathrm{ref}} = 20001\\,$ 为相同模型计算稠密网格参考值。\n\n输入规范：\n- 没有外部输入。您必须在代码中硬编码以下模型和测试套件。\n\n测试套件：\n对每种情况，使用指定的 $\\,N_k\\,$、温度 $\\,T\\,$ 和目标电子数 $\\,N_e^{\\mathrm{target}}\\,$，计算收敛的化学势 $\\,\\mu\\,$（单位 $\\,\\mathrm{eV}\\,$），并计算与稠密网格参考值 $\\,\\mu_{\\mathrm{ref}}\\,$ 的绝对偏差（单位 $\\,\\mathrm{eV}\\,$）：\n- 情况 $\\,1\\,$ （一般情况，对称能带，半填充）：$\\,N_k = 31\\,$, $\\,T = 300\\,\\mathrm{K}\\,$, $\\,N_e^{\\mathrm{target}} = 1.0\\,$.\n- 情况 $\\,2\\,$ （粗糙网格影响）：$\\,N_k = 11\\,$, $\\,T = 300\\,\\mathrm{K}\\,$, $\\,N_e^{\\mathrm{target}} = 1.0\\,$.\n- 情况 $\\,3\\,$ （更精细网格）：$\\,N_k = 201\\,$, $\\,T = 300\\,\\mathrm{K}\\,$, $\\,N_e^{\\mathrm{target}} = 1.0\\,$.\n- 情况 $\\,4\\,$ （能带边缘，低温，低填充）：$\\,N_k = 401\\,$, $\\,T = 10\\,\\mathrm{K}\\,$, $\\,N_e^{\\mathrm{target}} = 0.1\\,$.\n- 情况 $\\,5\\,$ （高温，接近能带顶）：$\\,N_k = 201\\,$, $\\,T = 1500\\,\\mathrm{K}\\,$, $\\,N_e^{\\mathrm{target}} = 1.9\\,$.\n\n最终输出规范：\n- 您的程序应生成单行输出，该行包含一个方括号内的逗号分隔列表，按顺序为每种情况提供两个浮点数：以 $\\mathrm{eV}$ 为单位的 $\\mu$ 和以 $\\mathrm{eV}$ 为单位的绝对偏差 $\\lvert \\mu - \\mu_{\\mathrm{ref}} \\rvert$。因此，最终输出必须是一个包含 $\\,10\\,$ 个数字的扁平列表：\n$$\n[\\mu_1, \\Delta\\mu_1, \\mu_2, \\Delta\\mu_2, \\mu_3, \\Delta\\mu_3, \\mu_4, \\Delta\\mu_4, \\mu_5, \\Delta\\mu_5]\\,,\n$$\n其中 $\\,\\Delta\\mu_i = \\lvert \\mu_i - \\mu_{\\mathrm{ref},i} \\rvert\\,$. 所有能量必须以 $\\,\\mathrm{eV}\\,$ 为单位，温度以 $\\,\\mathrm{K}\\,$ 为单位。$\\,k\\,$ 空间中的角度是无量纲的，因为使用 $\\,a = 1.0\\,\\mathrm{\\AA}\\,$ 对 $\\,ka\\,$ 进行了无量纲化。输出中的所有数值必须是浮点数。",
            "solution": "用户的要求是为一维紧束缚模型实现一个有限温度化学势求解器。这是计算材料科学中的一个标准问题。我将首先验证问题陈述，然后提供详细的解决方案。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n- **控制方程**: 每个原胞的目标电子数 $N_e^{\\mathrm{target}}$ 必须满足以下关系：\n  $$N_e(\\mu,T) \\;=\\; \\int_{-\\infty}^{+\\infty} N(E)\\, f(E,\\mu,T)\\, dE$$\n- **模型系统**: 具有一个 s 轨道的一维单原子链。\n  - 跃迁参数: $t = 1.0\\,\\mathrm{eV}$。\n  - 晶格常数: $a = 1.0\\,\\mathrm{\\AA}$。\n  - 自旋简并度: $g_s = 2$。\n- **色散关系**: 单带能量色散关系由下式给出：\n  $$E(k) \\;=\\; -2t \\cos(ka)$$\n  覆盖布里渊区 $k \\in [-\\pi/a, \\pi/a)$，产生的能带能量范围为 $E \\in [-2t, 2t]$。\n- **统计力学**: 占据数由费米-狄拉克分布描述：\n  $$f(E,\\mu,T) \\;=\\; \\frac{1}{1 + \\exp\\!\\big( \\frac{E-\\mu}{k_B T} \\big)}$$\n- **物理常数**: 玻尔兹曼常数为 $k_B = 8.617333262\\times 10^{-5}\\,\\mathrm{eV/K}$。\n- **数值近似**: 电子数的积分被离散、均匀的 k 点网格上的求和所取代：\n  $$N_e(\\mu,T;N_k) \\;=\\; \\frac{g_s}{N_k}\\,\\sum_{j=1}^{N_k} f\\!\\big(E(k_j),\\mu,T\\big)$$\n- **计算任务**: 使用稳健的区间求根方法，从方程 $F(\\mu) = N_e(\\mu,T;N_k) - N_e^{\\mathrm{target}} = 0$ 求解化学势 $\\mu$。\n- **收敛性分析**: 必须使用 $N_k^{\\mathrm{ref}} = 20001$ 个 k 点计算高分辨率的参考化学势 $\\mu_{\\mathrm{ref}}$，以评估主要计算的收敛性。\n- **测试套件**:\n  - 情况 1: $N_k = 31$, $T = 300\\,\\mathrm{K}$, $N_e^{\\mathrm{target}} = 1.0$。\n  - 情况 2: $N_k = 11$, $T = 300\\,\\mathrm{K}$, $N_e^{\\mathrm{target}} = 1.0$。\n  - 情况 3: $N_k = 201$, $T = 300\\,\\mathrm{K}$, $N_e^{\\mathrm{target}} = 1.0$。\n  - 情况 4: $N_k = 401$, $T = 10\\,\\mathrm{K}$, $N_e^{\\mathrm{target}} = 0.1$。\n  - 情况 5: $N_k = 201$, $T = 1500\\,\\mathrm{K}$, $N_e^{\\mathrm{target}} = 1.9$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n- **科学依据**: 该问题在根本上是合理的。它描述了固态物理学中的一个经典模型——一维紧束缚链——并提出了一个标准的计算任务：确定在有限温度下达到目标载流子浓度所需的化学势。使用 k 点采样来近似布里渊区积分是现代电子结构计算（例如，密度泛函理论）中的一项基石技术。所有参数都是物理上真实的。\n- **适定性**: 该问题是适定的。待求解的函数 $F(\\mu) = N_e(\\mu,T;N_k) - N_e^{\\mathrm{target}}$，对于任何有限温度 $T  0$ 都是一个关于 $\\mu$ 的连续且严格单调递增的函数。这是因为费米-狄拉克函数 $f(E,\\mu,T)$ 随 $\\mu$ 严格递增。$N_e(\\mu,T;N_k)$ 的范围从 $0$（当 $\\mu \\to -\\infty$ 时）到 $g_s=2$（当 $\\mu \\to +\\infty$ 时）。由于所有指定的目标占据数 $N_e^{\\mathrm{target}}$ 都在区间 $(0, 2)$ 内，根据介值定理，保证存在唯一的 $\\mu$ 解。\n- **客观性**: 问题陈述以精确、客观的数学和物理术语表达，没有歧义或主观解释。\n\n**步骤 3：结论与行动**\n该问题在科学上是有效的、适定的且自洽的。我将继续制定并实现解决方案。\n\n### 基于原理的解决方案设计\n\n这个问题的解决方案涉及固态物理和统计力学基本概念的数值实现。核心任务是找到化学势 $\\mu$，使得在给定温度 $T$ 下，它能自洽地产生每个原胞中指定的电子数 $N_e^{\\mathrm{target}}$。\n\n**1. 电子结构：紧束缚模型**\n\n我们从系统的电子结构开始，它由单粒子能量本征值 $E(k)$ 定义。对于具有最近邻跃迁 $t$ 的一维链，其色散关系为 $E(k) = -2t \\cos(ka)$。由于这是一个周期性系统，物理上不同的状态由第一布里渊区（BZ）内的波矢 $k$ 定义，$k \\in [-\\pi/a, \\pi/a)$。能带从 $E_{min} = E(k=0) = -2t$ 连续延伸到 $E_{max} = E(k=\\pm\\pi/a) = +2t$。当 $t = 1.0\\,\\mathrm{eV}$ 时，能带范围为 $-2.0\\,\\mathrm{eV}$ 到 $2.0\\,\\mathrm{eV}$。\n\n**2. 从连续积分到离散求和：k 点采样**\n\n在计算环境中，对连续 BZ 的积分通过对离散的 $k$ 点网格求和来近似。该问题指定了一个包含 $N_k$ 个点的均匀网格。这将总电子数的积分转换为了一个黎曼和。每个原胞的电子数 $N_e$ 是 $\\mu$ 和 $T$ 的函数，由下式给出：\n$$N_e(\\mu,T;N_k) \\;=\\; \\frac{g_s}{N_k}\\,\\sum_{j=1}^{N_k} f\\!\\big(E(k_j),\\mu,T\\big)$$\n这里，$\\{k_j\\}$ 是 BZ 中的 $N_k$ 个采样点集，$E(k_j)$ 是相应的能量本征值，$g_s=2$ 是自旋简并度，$f$ 是费米-狄拉克分布。这个离散公式就是我们将要实现的函数。\n\n**3. 化学势的求根**\n\n问题现在变成了找到以下函数的根：\n$$F(\\mu) \\;=\\; N_e(\\mu,T;N_k) - N_e^{\\mathrm{target}} \\;=\\; 0$$\n如前所述，对于 $T0$，$F(\\mu)$ 是一个关于 $\\mu$ 的连续且严格单调的函数。这个属性非常适合使用区间求根算法，如果能找到一个区间 $[\\mu_a, \\mu_b]$ 使得 $F(\\mu_a)$ 和 $F(\\mu_b)$ 异号，该算法保证收敛。Brent 方法是一个绝佳的选择，因为它结合了二分法的稳健性与割线法和逆二次插值的速度。它在 `scipy.optimize` 库中以 `brentq` 的形式提供。\n\n为了确定根的区间，我们注意到化学势 $\\mu$ 通常位于材料的能带附近。通过取离散能带的最小和最大能量 $[E_{min}, E_{max}]$，并将此区间扩展一个热余量（例如，几个 $k_B T$ 的单位），可以构建一个安全且稳健的括号区间。这确保了对于任何有效的 $N_e^{\\mathrm{target}}$，括号端点处的函数值都具有相反的符号。\n\n**4. 算法实现**\n\n实现将按以下方式构建：\n\n- 一个辅助函数 `calculate_energies(Nk)` 将通过首先在区间 $[-\\pi/a, \\pi/a)$ 中创建 $k$ 点的均匀网格，然后应用色散关系，来生成 $N_k$ 个能量本征值 $\\{E(k_j)\\}$ 的集合。\n- 第二个函数 `calculate_Ne(mu, T, energies)` 将为给定的 $\\mu$、`T` 和预先计算的能量集计算 $N_e(\\mu,T;N_k)$。该函数将是我们求根器目标函数的核心。\n- 一个求解器函数 `find_chemical_potential(T, Ne_target, energies)` 将定义目标函数 $F(\\mu)$，并使用 `scipy.optimize.root_scalar` 的 `brentq` 方法来找到其根 $\\mu$。\n- 主脚本将遍历所提供的测试套件。对于每种情况，它将：\n    1.  使用稠密的 $k$ 点网格（$N_k^{\\mathrm{ref}} = 20001$）计算参考化学势 $\\mu_{\\mathrm{ref}}$。\n    2.  使用指定的 $N_k$ 计算特定情况的化学势 $\\mu$。\n    3.  计算绝对偏差 $\\Delta\\mu = |\\mu - \\mu_{\\mathrm{ref}}|$。\n    4.  将 $\\mu$ 和 $\\Delta\\mu$ 都追加到结果列表中。\n- 最后，程序将以指定格式打印收集到的结果。此过程直接解决了问题中关于分析 $k$ 点采样收敛性的要求。\n\n这种系统化的方法保证了一个稳健、正确的解决方案，该方案牢固地植根于凝聚态物理的原理。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Solves for the chemical potential in a 1D tight-binding model for various test cases\n    and computes the deviation from a high-resolution reference calculation.\n    \"\"\"\n    # Model and physical constants\n    T_PARAM = 1.0  # Hopping parameter in eV\n    A_PARAM = 1.0  # Lattice constant in Angstrom\n    GS = 2.0       # Spin degeneracy\n    KB = 8.617333262e-5  # Boltzmann constant in eV/K\n    NK_REF = 20001 # Number of k-points for reference calculation\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (Nk, T in K, Ne_target)\n        (31, 300.0, 1.0),\n        (11, 300.0, 1.0),\n        (201, 300.0, 1.0),\n        (401, 10.0, 0.1),\n        (201, 1500.0, 1.9),\n    ]\n\n    results = []\n\n    def calculate_energies(Nk, t, a):\n        \"\"\"\n        Calculates the single-particle energy eigenvalues for a given k-point grid.\n        The grid is uniform in the 1st Brillouin Zone k in [-pi/a, pi/a).\n        \"\"\"\n        k_points = np.linspace(-np.pi / a, np.pi / a, Nk, endpoint=False)\n        energies = -2.0 * t * np.cos(k_points * a)\n        return energies\n\n    def calculate_Ne(mu, T, energies, gs, kB):\n        \"\"\"\n        Calculates the number of electrons per unit cell for a given chemical potential and temperature\n        using the discrete k-point summation.\n        \"\"\"\n        if T = 1e-9: # Treat very low T as T=0 to avoid numerical issues\n            return gs * np.sum(energies = mu) / len(energies)\n        \n        kBT = kB * T\n        # The argument of the exponential can be large, but numpy handles it robustly.\n        # np.exp will overflow to `inf` for large positive arguments, which correctly\n        # yields a Fermi-Dirac value of 0.\n        arg = (energies - mu) / kBT\n        fermi_dirac = 1.0 / (1.0 + np.exp(arg))\n        \n        # Total electron number is the mean occupancy multiplied by spin degeneracy\n        return gs * np.mean(fermi_dirac)\n        \n    def find_chemical_potential(T, Ne_target, energies, gs, kB):\n        \"\"\"\n        Solves for the chemical potential mu using a robust root-finding algorithm.\n        \"\"\"\n        # Define the objective function F(mu) = N_e(mu) - N_e_target, whose root we seek.\n        objective_func = lambda mu: calculate_Ne(mu, T, energies, gs, kB) - Ne_target\n        \n        # Establish a safe bracket for the root search. The energy band is [-2t, 2t].\n        # A wider bracket, extended by a thermal margin, ensures robustness.\n        E_min, E_max = np.min(energies), np.max(energies)\n        margin = max(2.0, 20.0 * kB * T) # Generous margin\n        bracket = [E_min - margin, E_max + margin]\n        \n        # Use scipy's `root_scalar` with the brentq method for robust and efficient\n        # bracketed root-finding.\n        try:\n            solution = root_scalar(objective_func, bracket=bracket, method='brentq')\n            return solution.root\n        except ValueError:\n            # This should not happen for this well-posed problem, but is good practice.\n            return np.nan # Error indicator\n            \n    # --- Main processing loop ---\n    for Nk, T, Ne_target in test_cases:\n        \n        # --- 1. Reference Calculation ---\n        energies_ref = calculate_energies(NK_REF, T_PARAM, A_PARAM)\n        mu_ref = find_chemical_potential(T, Ne_target, energies_ref, GS, KB)\n        \n        # --- 2. Test Case Calculation ---\n        energies_case = calculate_energies(Nk, T_PARAM, A_PARAM)\n        mu_case = find_chemical_potential(T, Ne_target, energies_case, GS, KB)\n        \n        # --- 3. Compute Deviation ---\n        # The deviation measures the error due to the coarser k-point grid.\n        delta_mu = abs(mu_case - mu_ref)\n        \n        # --- 4. Store Results ---\n        results.extend([mu_case, delta_mu])\n\n    # Final print statement in the exact required format.\n    # Format to 12 decimal places for sufficient precision.\n    print(f\"[{','.join(f'{x:.12f}' for x in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "从总态密度（DOS）到投影态密度（PDOS）的分析是理解材料化学性质的关键。然而，在计算代码常用的非正交基组中，PDOS的计算存在微妙之处。这项实践将直面一个潜在的陷阱——非物理的“负”PDOS，并指导你实现正确的、严格的Löwdin正交化方法，以确保得到有物理意义的解释。",
            "id": "3443144",
            "problem": "考虑一个晶体固体的有限基电子结构模型，在非相对论、单粒子近似下，系统由一个以局域原子轨道为基矢表示的厄米哈密顿矩阵 $H$ 和一个对称正定重叠矩阵 $S$ 来表示，后者描述了基矢的非正交性。其广义本征值问题为\n$$\nH \\mathbf{c}_n = E_n\\, S \\mathbf{c}_n,\n$$\n其中本征值为 $E_n$，本征矢量为 $\\mathbf{c}_n$。在非正交基中，通过欧几里得分量 $|c_{n,\\alpha}|^2$ 将一个态投影到特定轨道指标 $\\alpha$ 上的朴素做法，并未定义一个严格的投影算符，并且可能产生不符合物理的分波态密度（Partial Density of States (PDOS)），包括违反积分占据数的求和规则。一种数学上一致的构造轨道投影的方法是，使用 Löwdin 变换（由矩阵平方根 $S^{1/2}$ 及其逆 $S^{-1/2}$ 定义）来构建一个对称正交归一基，然后在该正交归一基中进行投影。\n\n需要使用的基本定义和事实：\n- 总态密度由本征值处的狄拉克δ分布谱定义：$D(E) = \\sum_n \\delta(E - E_n)$。\n- 费米-狄拉克分布为 $f(E) = \\frac{1}{1 + \\exp\\!\\left(\\frac{E - E_F}{k_{\\mathrm{B}} T}\\right)}$，其中玻尔兹曼常数 $k_{\\mathrm{B}}$ 的单位是电子伏特/开尔文。\n- 在温度 $T$ 和费米能级 $E_F$ 下，总能带占据数（该自旋通道中的电子数）为 $N_{\\mathrm{e}} = \\sum_n f(E_n)$。\n- 在正交归一基中，通过 $|u_{n,\\alpha}|^2$ 将一个归一化态投影到轨道 $\\alpha$ 上，可以得到一个对轨道求和的严格单位分解，且对每个 $n$ 都满足 $\\sum_{\\alpha} |u_{n,\\alpha}|^2 = 1$。\n\n你的任务是为每个轨道指标 $\\alpha$ 实现两种基于 PDOS 的占据数积分：\n1. 一种使用来自广义本征矢量的原始系数 $c_{n,\\alpha}$ 的朴素非正交 PDOS 积分：\n$$\nN_{\\alpha}^{\\mathrm{naive}} = \\sum_{n} \\left| c_{n,\\alpha} \\right|^2\\, f(E_n).\n$$\n2. 一种使用对称正交归一基中投影的 Löwdin 正交化 PDOS 积分：\n$$\nN_{\\alpha}^{\\mathrm{L}} = \\sum_{n} \\left| d_{n,\\alpha} \\right|^2\\, f(E_n),\n\\quad \\text{其中} \\quad \\mathbf{d}_n = S^{1/2} \\mathbf{c}_n.\n$$\n然后，对每个测试用例，计算两个诊断量来量化 PDOS 投影的物理性：\n- 朴素投影的占据数求和规则误差，定义为\n$$\n\\Delta_{\\mathrm{naive}} = \\left(\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{naive}}\\right) - N_{\\mathrm{e}} \\quad \\text{(单位：电子数)}.\n$$\n- Löwdin 正交化投影的占据数求和规则误差，定义为\n$$\n\\Delta_{\\mathrm{L}} = \\left(\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{L}}\\right) - N_{\\mathrm{e}} \\quad \\text{(单位：电子数)}.\n$$\n同时，对每个测试用例，计算朴素占据数和 Löwdin 占据数之间轨道分辨的最大绝对偏差：\n$$\n\\Delta_{\\max} = \\max_{\\alpha} \\left| N_{\\alpha}^{\\mathrm{naive}} - N_{\\alpha}^{\\mathrm{L}} \\right| \\quad \\text{(单位：电子数)}.\n$$\n\n使用以下常数和单位：\n- 能量 $E$、$E_F$ 和 $H$ 的矩阵元单位为电子伏特 (eV)。\n- 温度 $T$ 单位为开尔文 (K)。\n- 玻尔兹曼常数 $k_{\\mathrm{B}} = 8.617333262145 \\times 10^{-5}\\ \\mathrm{eV/K}$。\n- 占据数和误差必须以电子数（无量纲计数）报告，形式为浮点数。\n\n数值实现要求：\n- 通过求解广义厄米本征问题 $H \\mathbf{c}_n = E_n S \\mathbf{c}_n$（其中 $S$ 对称正定）来获得 $(E_n, \\mathbf{c}_n)$。选择的本征矢量需满足 $S$ 度规下的归一化条件 $\\mathbf{c}_n^{\\dagger} S \\mathbf{c}_m = \\delta_{nm}$。\n- 通过谱分解 $S = U \\Lambda U^{\\top}$（其中 $\\Lambda$ 为正对角矩阵）构建 $S^{1/2}$，并设 $S^{1/2} = U \\Lambda^{1/2} U^{\\top}$。\n- 使用费米-狄拉克分布计算 $f(E_n)$。通过使用数值稳定的逻辑函数实现，小心处理极端参数以避免浮点溢出。\n- 对于每个轨道指标 $\\alpha$，计算 $N_{\\alpha}^{\\mathrm{naive}}$ 和 $N_{\\alpha}^{\\mathrm{L}}$，然后计算 $\\Delta_{\\mathrm{naive}}$、$\\Delta_{\\mathrm{L}}$ 和 $\\Delta_{\\max}$。\n\n测试套件：\n- 用例 1（单位重叠，基线一致性）：\n  $$\n  H = \\begin{bmatrix} 0.0  -1.0 \\\\ -1.0  0.5 \\end{bmatrix}\\ \\mathrm{eV},\\quad\n  S = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix},\\quad\n  E_F = 0.0\\ \\mathrm{eV},\\quad T = 300\\ \\mathrm{K}.\n  $$\n- 用例 2（中度非正交性）：\n  $$\n  H = \\begin{bmatrix} 0.0  -1.0 \\\\ -1.0  0.5 \\end{bmatrix}\\ \\mathrm{eV},\\quad\n  S = \\begin{bmatrix} 1.0  0.3 \\\\ 0.3  1.0 \\end{bmatrix},\\quad\n  E_F = 0.0\\ \\mathrm{eV},\\quad T = 300\\ \\mathrm{K}.\n  $$\n- 用例 3（具有强近邻重叠的三轨道链）：\n  $$\n  H = \\begin{bmatrix}\n  0.0  -1.0  0.0 \\\\\n  -1.0  0.3  -1.0 \\\\\n  0.0  -1.0  0.6\n  \\end{bmatrix}\\ \\mathrm{eV},\\quad\n  S = \\begin{bmatrix}\n  1.0  0.6  0.0 \\\\\n  0.6  1.0  0.6 \\\\\n  0.0  0.6  1.0\n  \\end{bmatrix},\\quad\n  E_F = 0.2\\ \\mathrm{eV},\\quad T = 1000\\ \\mathrm{K}.\n  $$\n- 用例 4（近奇异的双轨道重叠）：\n  $$\n  H = \\begin{bmatrix} 0.2  -0.4 \\\\ -0.4  -0.1 \\end{bmatrix}\\ \\mathrm{eV},\\quad\n  S = \\begin{bmatrix} 1.0  0.9 \\\\ 0.9  1.0 \\end{bmatrix},\\quad\n  E_F = 0.1\\ \\mathrm{eV},\\quad T = 1\\ \\mathrm{K}.\n  $$\n\n最终输出格式：\n你的程序应生成一行输出，其中包含一个逗号分隔的列表，并用方括号括起来。对于每个测试用例，按此顺序输出三个浮点数：$\\Delta_{\\mathrm{naive}}$、$\\Delta_{\\mathrm{L}}$ 和 $\\Delta_{\\max}$。将所有四个测试用例的结果连接成一个扁平列表。例如，输出必须具有以下形式：\n$$\n[\\Delta_{\\mathrm{naive}}^{(1)},\\Delta_{\\mathrm{L}}^{(1)},\\Delta_{\\max}^{(1)},\\Delta_{\\mathrm{naive}}^{(2)},\\Delta_{\\mathrm{L}}^{(2)},\\Delta_{\\max}^{(2)},\\Delta_{\\mathrm{naive}}^{(3)},\\Delta_{\\mathrm{L}}^{(3)},\\Delta_{\\max}^{(3)},\\Delta_{\\mathrm{naive}}^{(4)},\\Delta_{\\mathrm{L}}^{(4)},\\Delta_{\\max}^{(4)}].\n$$\n所有条目必须是代表电子数的浮点数。",
            "solution": "该问题要求在一个有限、非正交基矢集合的晶体固体模型中，分析和比较两种计算轨道投影电子占据数的不同方法。这项任务在计算材料科学中至关重要，用于解释电子结构计算的结果，例如，将电子数分配给特定的原子或轨道。问题的核心在于在非正交矢量空间中定义投影的数学精妙之处。\n\n我们从描述单粒子系统在局域原子轨道基矢 $|\\phi_{\\alpha}\\rangle$ 中定态的广义本征值问题开始：\n$$\nH \\mathbf{c}_n = E_n S \\mathbf{c}_n\n$$\n在这里，$H$ 是哈密顿矩阵，其矩阵元为 $H_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\hat{H} | \\phi_{\\beta} \\rangle$；$S$ 是重叠矩阵，其矩阵元为 $S_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\phi_{\\beta} \\rangle$；$E_n$ 是能量本征值；$\\mathbf{c}_n$ 是本征矢量，包含了将第 $n$ 个本征态 $|\\psi_n\\rangle$ 表示为基轨道的线性组合的系数：$|\\psi_n\\rangle = \\sum_{\\alpha} c_{n,\\alpha} |\\phi_{\\alpha}\\rangle$。矩阵 $H$ 和 $S$ 是厄米矩阵；由于给定的矩阵是实数，它们是对称的。基矢的非正交性意味着 $S_{\\alpha\\beta}$ 通常不是克罗内克δ函数 $\\delta_{\\alpha\\beta}$，且 $S$ 不是单位矩阵 $I$。然而，$S$ 是对称且正定的。本征矢量被选择为在 $S$ 度规下是归一化的，即 $\\mathbf{c}_n^\\dagger S \\mathbf{c}_m = \\delta_{nm}$。\n\n在有限温度 $T$ 和给定的费米能级 $E_F$ 下，系统中的总电子数（对于单个自旋通道）是通过对每个能级 $E_n$ 的占据数求和来确定的。占据数由费米-狄拉克分布 $f(E)$ 给出：\n$$\nf(E) = \\frac{1}{1 + \\exp\\!\\left(\\frac{E - E_F}{k_{\\mathrm{B}} T}\\right)}\n$$\n其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。因此，总电子数为：\n$$\nN_{\\mathrm{e}} = \\sum_n f(E_n)\n$$\n一个具有物理意义的将 $N_{\\mathrm{e}}$ 分解为每个轨道 $\\alpha$ 的贡献（表示为 $N_{\\alpha}$）的方法，必须满足求和规则 $\\sum_{\\alpha} N_{\\alpha} = N_{\\mathrm{e}}$。\n\n问题提出了两种计算这些轨道占据数 $N_{\\alpha}$ 的方法。\n\n1.  **“朴素”投影**：这种方法错误地将系数 $c_{n,\\alpha}$ 当作它们属于正交归一基来处理。投影占据数定义为：\n    $$\n    N_{\\alpha}^{\\mathrm{naive}} = \\sum_{n} \\left| c_{n,\\alpha} \\right|^2\\, f(E_n)\n    $$\n    这些朴素占据数对所有轨道的求和是 $\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{naive}} = \\sum_n f(E_n) (\\mathbf{c}_n^\\dagger \\mathbf{c}_n)$。由于 $\\mathbf{c}_n^\\dagger S \\mathbf{c}_n = 1$，且 $S \\neq I$，通常情况下 $\\mathbf{c}_n^\\dagger \\mathbf{c}_n \\neq 1$。因此，求和规则被违反：$\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{naive}} \\neq N_{\\mathrm{e}}$。\n\n2.  **Löwdin 正交化投影**：这是一种数学上严谨的方法。它首先通过 Löwdin 对称正交化过程将非正交基 $\\{|\\phi_{\\alpha}\\rangle\\}$ 转换为一个正交归一基 $\\{|\\chi_{\\alpha}\\rangle\\}$。变换矩阵是重叠矩阵的逆平方根 $S^{-1/2}$。一个本征态 $|\\psi_n\\rangle$ 可以在这个新基中表示为 $|\\psi_n\\rangle = \\sum_\\alpha d_{n,\\alpha} |\\chi_\\alpha\\rangle$。新系数 $\\mathbf{d}_n$ 与原系数 $\\mathbf{c}_n$ 通过变换 $\\mathbf{d}_n = S^{1/2} \\mathbf{c}_n$ 相关联。因为 $\\{|\\chi_\\alpha\\rangle\\}$ 基是正交归一的，对轨道 $\\alpha$ 的投影由 $|d_{n,\\alpha}|^2$ 给出，并且这些投影对所有轨道求和正确地等于1：对于每个本征态 $n$，$\\sum_\\alpha |d_{n,\\alpha}|^2 = 1$。证明很直接：\n    $$\n    \\sum_{\\alpha} |d_{n,\\alpha}|^2 = \\mathbf{d}_n^\\dagger \\mathbf{d}_n = (S^{1/2}\\mathbf{c}_n)^\\dagger(S^{1/2}\\mathbf{c}_n) = \\mathbf{c}_n^\\dagger (S^{1/2})^\\dagger S^{1/2} \\mathbf{c}_n = \\mathbf{c}_n^\\dagger S \\mathbf{c}_n = 1\n    $$\n    其中最后一步使用了本征矢量 $\\mathbf{c}_n$ 的 $S$ 度规归一化。因此，Löwdin 占据数定义为：\n    $$\n    N_{\\alpha}^{\\mathrm{L}} = \\sum_{n} \\left| d_{n,\\alpha} \\right|^2\\, f(E_n)\n    $$\n    将其对所有轨道求和得到：\n    $$\n    \\sum_{\\alpha} N_{\\alpha}^{\\mathrm{L}} = \\sum_{\\alpha} \\sum_n |d_{n,\\alpha}|^2 f(E_n) = \\sum_n f(E_n) \\left(\\sum_{\\alpha} |d_{n,\\alpha}|^2\\right) = \\sum_n f(E_n) \\cdot 1 = N_{\\mathrm{e}}\n    $$\n    因此，Löwdin 投影方法严格满足电子数求和规则。误差 $\\Delta_{\\mathrm{L}} = (\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{L}}) - N_{\\mathrm{e}}$ 应为零（在数值浮点精度范围内）。而当 $S \\neq I$ 时，朴素误差 $\\Delta_{\\mathrm{naive}}$ 预计为非零。\n\n对于每个测试用例，数值实现将按以下步骤进行：\n1.  **求解广义本征问题**：给定矩阵 $H$ 和 $S$，求解 $H \\mathbf{c}_n = E_n S \\mathbf{c}_n$ 以获得本征值 $E_n$ 和 $S$ 度规归一化的本征矢量 $\\mathbf{c}_n$。这将使用 `scipy.linalg.eigh` 完成。\n2.  **计算矩阵平方根 $S^{1/2}$**：这通过 $S$ 的谱分解来完成。首先，将 $S$ 对角化为 $S = U \\Lambda U^{\\top}$，其中 $U$ 是本征矢量的正交矩阵，$\\Lambda$ 是本征值的对角矩阵。然后，通过 $S^{1/2} = U \\Lambda^{1/2} U^{\\top}$ 构建 $S^{1/2}$，其中 $\\Lambda^{1/2}$ 是一个对角矩阵，其对角元是 $S$ 的本征值的平方根。\n3.  **计算费米-狄拉克分布**：对于每个本征值 $E_n$，使用给定的 $E_F$、$T$ 和 $k_B$ 计算占据因子 $f(E_n)$。一个数值稳定的实现对于避免当指数 $(E_n - E_F)/(k_B T)$ 很大时发生浮点溢出至关重要。\n4.  **计算占据数**：\n    -   计算总电子数 $N_{\\mathrm{e}} = \\sum_n f(E_n)$。\n    -   计算朴素投影权重矩阵 $W^{\\mathrm{naive}}_{n\\alpha} = |c_{n,\\alpha}|^2$。朴素轨道占据数则为 $N_{\\alpha}^{\\mathrm{naive}} = \\sum_n W^{\\mathrm{naive}}_{n\\alpha} f(E_n)$。\n    -   变换本征矢量：$\\mathbf{d}_n = S^{1/2} \\mathbf{c}_n$。\n    -   计算 Löwdin 投影权重矩阵 $W^{\\mathrm{L}}_{n\\alpha} = |d_{n,\\alpha}|^2$。Löwdin 占据数则为 $N_{\\alpha}^{\\mathrm{L}} = \\sum_n W^{\\mathrm{L}}_{n\\alpha} f(E_n)$。\n5.  **计算诊断量**：\n    -   $\\Delta_{\\mathrm{naive}} = \\left(\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{naive}}\\right) - N_{\\mathrm{e}}$。\n    -   $\\Delta_{\\mathrm{L}} = \\left(\\sum_{\\alpha} N_{\\alpha}^{\\mathrm{L}}\\right) - N_{\\mathrm{e}}$。\n    -   $\\Delta_{\\max} = \\max_{\\alpha} \\left| N_{\\alpha}^{\\mathrm{naive}} - N_{\\alpha}^{\\mathrm{L}} \\right|$。\n\n此过程将应用于每个测试用例，以量化朴素投影的误差以及两种方案之间的差异，预计该差异会随着非正交性（即 $S$ 的非对角元素）的增加而增大。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\nfrom scipy.special import expit\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the results.\n    \"\"\"\n    \n    # Define the Boltzmann constant in eV/K.\n    k_B = 8.617333262145e-5\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (identity overlap)\n        {\n            \"H\": np.array([[0.0, -1.0], [-1.0, 0.5]]),\n            \"S\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"E_F\": 0.0,\n            \"T\": 300.0\n        },\n        # Case 2 (moderate non-orthogonality)\n        {\n            \"H\": np.array([[0.0, -1.0], [-1.0, 0.5]]),\n            \"S\": np.array([[1.0, 0.3], [0.3, 1.0]]),\n            \"E_F\": 0.0,\n            \"T\": 300.0\n        },\n        # Case 3 (three-orbital chain with strong overlap)\n        {\n            \"H\": np.array([[0.0, -1.0, 0.0], [-1.0, 0.3, -1.0], [0.0, -1.0, 0.6]]),\n            \"S\": np.array([[1.0, 0.6, 0.0], [0.6, 1.0, 0.6], [0.0, 0.6, 1.0]]),\n            \"E_F\": 0.2,\n            \"T\": 1000.0\n        },\n        # Case 4 (near-singular two-orbital overlap)\n        {\n            \"H\": np.array([[0.2, -0.4], [-0.4, -0.1]]),\n            \"S\": np.array([[1.0, 0.9], [0.9, 1.0]]),\n            \"E_F\": 0.1,\n            \"T\": 1.0\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        H = case[\"H\"]\n        S = case[\"S\"]\n        E_F = case[\"E_F\"]\n        T = case[\"T\"]\n\n        # Step 1: Solve the generalized eigenvalue problem Hc = ESc\n        # scipy.linalg.eigh returns S-normalized eigenvectors.\n        # Eigenvectors are returned as columns of C.\n        E_n, C = eigh(H, S)\n\n        # Step 2: Construct the matrix square root S^(1/2)\n        # S is real symmetric, so its eigenvectors are real and U.T = U_inv.\n        s_eigvals, U = np.linalg.eigh(S)\n        # Check for positive definiteness\n        if np.any(s_eigvals = 0):\n            # This should not happen for the given valid problem cases.\n            raise ValueError(\"Overlap matrix S is not positive definite.\")\n        s_sqrt_eigvals = np.sqrt(s_eigvals)\n        S_sqrt = U @ np.diag(s_sqrt_eigvals) @ U.T\n\n        # Step 3: Evaluate the Fermi-Dirac distribution for each energy level\n        # f(E) = 1 / (1 + exp((E - E_F) / (k_B * T)))\n        # We use scipy.special.expit(x) = 1 / (1 + exp(-x))\n        # So f(E) corresponds to expit(-x) where x = (E - E_F) / (k_B * T)\n        if T > 0:\n            beta = 1.0 / (k_B * T)\n            x = beta * (E_n - E_F)\n            f_E_n = expit(-x)\n        else: # Zero temperature limit (step function)\n            f_E_n = np.where(E_n = E_F, 1.0, 0.0)\n            f_E_n[E_n == E_F] = 0.5 # Convention for equality\n\n        # Step 4: Compute occupancies\n        \n        # Total electron count\n        N_e = np.sum(f_E_n)\n\n        # The eigenvectors C are arranged column-wise.\n        # c_{n,alpha} is C[alpha, n].\n        # The sum is over n (axis=1 for row-wise operations).\n        c_n_alpha_sq = np.abs(C)**2\n        N_alpha_naive = np.sum(c_n_alpha_sq * f_E_n, axis=1)\n\n        # Transform coefficients to the Löwdin basis: d = S^(1/2) * c\n        D = S_sqrt @ C\n        d_n_alpha_sq = np.abs(D)**2\n        N_alpha_L = np.sum(d_n_alpha_sq * f_E_n, axis=1)\n\n        # Step 5: Calculate diagnostics\n\n        # Sum of naive projected occupancies\n        sum_N_alpha_naive = np.sum(N_alpha_naive)\n        \n        # Sum of Löwdin projected occupancies\n        sum_N_alpha_L = np.sum(N_alpha_L)\n\n        # Occupancy sum rule errors\n        delta_naive = sum_N_alpha_naive - N_e\n        delta_L = sum_N_alpha_L - N_e\n\n        # Maximum absolute orbital-wise deviation\n        delta_max = np.max(np.abs(N_alpha_naive - N_alpha_L))\n\n        results.extend([delta_naive, delta_L, delta_max])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}