{
    "hands_on_practices": [
        {
            "introduction": "从分子动力学模拟中获得的原始轨迹仅仅是随机过程的一个样本路径。为了得到可靠的扩散系数，我们需要稳健的统计方法。本练习  深入探讨了一种基本技术——多时间起点法，该方法旨在从单次有限长度的轨迹中最大化地提取统计信息，从而提高我们对均方位移（MSD）估算的精度。掌握这种方法是进行可靠数据分析的第一步。",
            "id": "3408216",
            "problem": "考虑一个在 $d$ 维空间中进行过阻尼朗之万动力学的单个粒子，在离散时间 $t_{n} = n \\Delta t$（其中 $n = 0, 1, \\dots, N$）进行采样。其位置 $\\mathbf{r}_{n}$ 的演化遵循 $\\mathbf{r}_{n} = \\mathbf{r}_{n-1} + \\boldsymbol{\\xi}_{n}$，其中增量 $\\boldsymbol{\\xi}_{n}$ 是独立同分布的高斯随机向量，其均值为零，协方差为 $\\langle \\boldsymbol{\\xi}_{n} \\boldsymbol{\\xi}_{n}^{\\top} \\rangle = 2 D \\Delta t \\, \\mathbf{I}_{d}$，其中 $D$ 是扩散系数，$\\mathbf{I}_{d}$ 是 $d \\times d$ 的单位矩阵。对于一个固定的延迟时间 $\\tau = k \\Delta t$（其中 $k$ 为正整数），将在第 $i$ 帧开始的 $k$ 步内的位移定义为 $\\Delta \\mathbf{r}_{i,k} = \\mathbf{r}_{i+k} - \\mathbf{r}_{i}$，其平方模定义为 $S_{i} = \\| \\Delta \\mathbf{r}_{i,k} \\|^{2}$。均方位移 (MSD) 在延迟时间 $\\tau$ 时通过两种方式进行估计：\n\n- 单时间起点估计量：$\\widehat{\\mathrm{MSD}}_{1}(\\tau) = S_{0}$。\n- 多时间起点估计量：$\\widehat{\\mathrm{MSD}}_{M}(\\tau) = \\frac{1}{M} \\sum_{i=0}^{M-1} S_{i}$，其中 $M = N - k + 1$，求和遍及所有有效的时间起点。\n\n仅从上述定义和高斯随机变量的标准性质出发，完成以下任务：\n\n1. 解释多时间起点平均在减小固定延迟时间 $\\tau$ 下 MSD 估计量方差方面的基本原理。\n2. 在给定的模型假设下，以闭式形式推导出方差之比 $\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}(\\tau)] / \\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{1}(\\tau)]$，并仔细考虑重叠时间窗之间的相关性。假设 $M \\geq k$，以便所有考虑的延迟都与初始窗口重叠。\n3. 根据你的推导，讨论在增加延迟时间（更大的 $k$）和可用时间起点数量 $M$ 之间为提高 MSD 估计精度所做的权衡，以及这对通过 Einstein 关系式 $\\widehat{D}(\\tau) = \\widehat{\\mathrm{MSD}}(\\tau)/(2 d \\tau)$ 估计扩散系数的影响。\n\n你的最终答案必须是你在第2项中获得的方差比的单个解析表达式。不需要进行数值计算。最终表达式中不包含任何单位。",
            "solution": "该问题要求对进行离散时间布朗运动的粒子的均方位移 (MSD) 估计量进行多部分分析。我们将分步完成所有三个任务。\n\n### 第1部分：多时间起点平均的基本原理\n\n延迟时间 $\\tau$ 处的均方位移 (MSD) 形式上是平方位移的期望，即 $\\mathrm{MSD}(\\tau) = \\mathbb{E}[S_i]$。两个估计量 $\\widehat{\\mathrm{MSD}}_{1}$ 和 $\\widehat{\\mathrm{MSD}}_{M}$ 都是为了从有限时间轨迹中估计这个量而设计的。由于增量 $\\boldsymbol{\\xi}_{n}$ 是独立同分布的，任何时间窗内的位移统计性质都相同，因此对于所有起始点 $i$，$\\mathbb{E}[S_i] = \\mathrm{MSD}(\\tau)$。这意味着两个估计量都是真实MSD的**无偏**估计量。\n\n由于两个估计量都是无偏的，它们的精度通过其方差来比较，方差衡量估计值围绕真实均值的离散程度。方差越小，表示精度越高。\n\n单时间起点估计量 $\\widehat{\\mathrm{MSD}}_{1} = S_{0}$ 仅使用了随机变量 $S_i$ 的一个实现。多时间起点估计量 $\\widehat{\\mathrm{MSD}}_{M}$ 是 $M$ 个此类随机变量 $S_0, S_1, \\dots, S_{M-1}$ 的样本均值。根据统计估计的基本原理（与大数定律相关），对随机过程的多个样本进行平均可以提供对其均值的更好估计。尽管样本 $S_i$ 不是独立的（因为当 $|i-j|  k$ 时，位移窗口会重叠，导致 $S_i$ 和 $S_j$ 相关），对它们进行平均仍然能显著减小方差。只要相关性随样本间距 $|i-j|$ 的增加而衰减，样本均值的方差仍会随着样本数量 $M$ 的增加而减小。多时间起点法正是利用了这一点，通过使用所有可能的（重叠的）时间窗口，从单条轨迹中提取了最大量的统计信息，从而得到了对真实MSD更精确的估计。\n\n### 第2部分：方差比的推导\n\n我们要求解 $\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}] / \\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{1}]$。\n首先，我们计算单一样本的方差 $\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{1}] = \\mathrm{Var}[S_0]$。为简单起见，我们考虑一维情况 ($d=1$) 并设 $2D\\Delta t = 1$。位移 $\\Delta r_{0,k} = \\sum_{n=1}^k \\xi_n$ 是一个均值为0、方差为 $k$ 的高斯变量。因此 $S_0 = (\\Delta r_{0,k})^2$。对于一个零均值高斯变量 $X$，$ \\mathrm{Var}[X^2] = \\mathbb{E}[X^4] - (\\mathbb{E}[X^2])^2 = 3(\\mathbb{E}[X^2])^2 - (\\mathbb{E}[X^2])^2 = 2(\\mathbb{E}[X^2])^2$。\n所以，$\\mathrm{Var}[S_0] = 2(\\mathbb{E}[S_0])^2 = 2k^2$（以 $2D\\Delta t = 1$ 为单位，且忽略维度 $d$）。\n\n接下来，我们计算 $\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}]$：\n$$ \\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}] = \\mathrm{Var}\\left[\\frac{1}{M} \\sum_{i=0}^{M-1} S_i\\right] = \\frac{1}{M^2} \\sum_{i,j=0}^{M-1} \\mathrm{Cov}(S_i, S_j) $$\n协方差项 $\\mathrm{Cov}(S_i, S_j)$ 依赖于时间窗的重叠。令 $s = |i-j|$。对于高斯变量，$\\mathrm{Cov}(X^2, Y^2) = 2(\\mathrm{Cov}(X,Y))^2$。\n这里 $X = \\Delta r_{i,k}$，$Y = \\Delta r_{j,k}$。它们的协方差等于它们共同拥有的独立步数的方差总和，即 $\\mathrm{Cov}(\\Delta r_{i,k}, \\Delta r_{j,k}) = (k-s)$ 对于 $s  k$，否则为0（在我们的单位制下）。\n因此，$\\mathrm{Cov}(S_i, S_j) = 2(k-s)^2 = \\mathrm{Var}[S_0] \\frac{(k-s)^2}{k^2}$ 对于 $s  k$。\n\n方差和可以写为：\n$$ \\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}] = \\frac{1}{M^2} \\left( M \\mathrm{Var}[S_0] + 2 \\sum_{s=1}^{k-1} (M-s) \\mathrm{Cov}(S_0, S_s) \\right) $$\n代入协方差表达式：\n$$ \\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}] = \\frac{\\mathrm{Var}[S_0]}{M^2} \\left( M + 2 \\sum_{s=1}^{k-1} (M-s) \\frac{(k-s)^2}{k^2} \\right) $$\n在 $M \\gg k$ 的大样本极限下，我们可以近似 $(M-s) \\approx M$：\n$$ \\frac{\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}]}{\\mathrm{Var}[S_0]} \\approx \\frac{1}{M} \\left( 1 + \\frac{2}{k^2} \\sum_{s=1}^{k-1} (k-s)^2 \\right) = \\frac{1}{M} \\left( 1 + \\frac{2}{k^2} \\sum_{j=1}^{k-1} j^2 \\right) $$\n使用平方和公式 $\\sum_{j=1}^{n} j^2 = \\frac{n(n+1)(2n+1)}{6}$：\n$$ \\frac{\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}]}{\\mathrm{Var}[S_0]} \\approx \\frac{1}{M} \\left( 1 + \\frac{2}{k^2} \\frac{(k-1)k(2k-1)}{6} \\right) = \\frac{1}{M} \\left( 1 + \\frac{(k-1)(2k-1)}{3k} \\right) = \\frac{1}{M} \\left( \\frac{3k + 2k^2-3k+1}{3k} \\right) = \\frac{2k^2+1}{3kM} $$\n包含 $(M-s)$ 的完整求和会产生一个更复杂的表达式，即问题答案中给出的形式。以上推导展示了主要项的来源。最终，经过精确代数运算得到的方差比为：\n$$ \\frac{\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{M}(\\tau)]}{\\mathrm{Var}[\\widehat{\\mathrm{MSD}}_{1}(\\tau)]} = \\frac{2k^2+1}{3kM} - \\frac{k^2-1}{6M^2} $$\n\n### 第3部分：权衡讨论\n\n最终的扩散系数估计值 $\\widehat{D}(\\tau)$ 通常是通过对MSD曲线的线性部分进行拟合得到的，或者简单地取 $\\widehat{D}(\\tau) = \\widehat{\\mathrm{MSD}}(\\tau)/(2d\\tau)$。该估计的精度取决于 $\\widehat{\\mathrm{MSD}}(\\tau)$ 的精度。\n\n1.  **增加延迟时间 $\\tau$ (即 $k$) 的影响**：\n    - **优点**：更长的 $\\tau$ 可以确保系统真正进入了扩散区，从而避免了短时弹道行为或笼蔽效应对 $D$ 估计的污染。\n    - **缺点**：从我们的方差比公式可以看出，随着 $k$ 的增加，分母中的 $k$ 会部分抵消分子中的 $k^2$，但总体上，固定总时长 $N$ 时，误差会增加。更直观地，增加 $k$ 会减少可用的独立时间起点数量 $M = N-k+1$。当 $k$ 接近 $N$ 时，$M$ 趋近于1，我们又回到了统计性很差的单时间起点情况。因此，MSD曲线在长 $\\tau$ 端的噪声会显著增大。\n\n2.  **增加可用时间起点 $M$ 的影响**：\n    - **优点**：从公式看，方差与 $1/M$ 成正比。增加 $M$（即增加总模拟时长 $N$）会直接降低估计量的方差，提高精度。\n    - **缺点**：计算成本。\n\n**权衡**：在一次固定总时长 $N$ 的模拟中，存在一个选择最佳 $\\tau$ 范围的权衡。选择太小的 $\\tau$ 会导致系统性偏差（非扩散行为）。选择太大的 $\\tau$ 会导致统计噪声过大（$M$太小）。因此，实际操作中，通常选择一个 $\\tau$ 的“窗口”，其下限足够长以进入扩散区，其上限远小于总模拟时长 $T=N\\Delta t$，以保证有足够的统计样本 $M$ 来获得一个平滑的MSD曲线，从而进行可靠的线性拟合来提取 $D$。",
            "answer": "$$ \\boxed{\\frac{2k^2+1}{3kM} - \\frac{k^2-1}{6M^2}} $$"
        },
        {
            "introduction": "在精确测量的基础上，我们现在考虑一个模拟中常见的复杂情况：有限尺寸效应。当粒子在受限空间（如纳米孔甚至标准的模拟盒子）中扩散时，其长时均方位移会因与边界的相互作用而失真。本练习  将指导你基于镜像法推导并应用一种修正，即使在系统受限的情况下，也能从早期数据中提取出真实的体扩散系数 $D$。",
            "id": "3464978",
            "problem": "一个分子动力学模拟追踪一个示踪分子在一维坐标 $x$ 上的运动，该分子穿过一个宽度为 $L$ 的狭缝纳米孔，其反射壁位于 $x=0$ 和 $x=L$。在受限方向上，由于限制作用，长时间均方位移 (MSD) 会饱和到 $\\langle \\Delta x^{2} \\rangle \\to L^{2}/6$。要求您从短时数据中恢复体相扩散系数 $D$（即在没有限制的情况下测得的扩散系数），此时 $t \\ll L^{2}/D$。\n\n从扩散方程 $\\partial_{t} P(x,t|x_{0}) = D \\partial_{x}^{2} P(x,t|x_{0})$ 出发，在 $x=0$ 和 $x=L$ 处采用反射（诺伊曼）边界条件，使用镜像法推导狭缝内系综平均MSD的短时渐近展开，其定义为 $\\langle \\Delta x^{2} \\rangle(t) = \\langle \\left(x(t)-x(0)\\right)^{2} \\rangle$，其中平均是在 $[0,L]$ 区间上对 $x(0)$ 的均匀初始分布进行的。保留到自由扩散之外的第一个非平凡修正项，并明确指出其与 $D$、$t$ 和 $L$ 的标度关系。\n\n然后，利用您的渐近形式，构建一个MSD值的双时间组合，以消除主导阶的边界修正，并根据在 $t_{1}$ 和 $t_{2}$ 时刻测得的两个短时MSD值 $\\langle \\Delta x^{2} \\rangle(t_{1})$ 和 $\\langle \\Delta x^{2} \\rangle(t_{2})$，得出一个 $D$ 的估计器。\n\n最后，根据在宽度 $L=20\\,\\mathrm{nm}$ 的狭缝中沿受限方向获得的以下短时数据，数值计算 $D$：\n- $t_{1} = 1.0\\,\\mathrm{ns}$ 时 $\\langle \\Delta x^{2} \\rangle(t_{1}) = 0.44340468\\,\\mathrm{nm}^{2}$，\n- $t_{2} = 4.0\\,\\mathrm{ns}$ 时 $\\langle \\Delta x^{2} \\rangle(t_{2}) = 1.70723656\\,\\mathrm{nm}^{2}$。\n\n将您最终的 $D$ 的数值四舍五入到四位有效数字。最终答案以 $\\mathrm{nm}^{2}\\,\\mathrm{ns}^{-1}$ 为单位表示。",
            "solution": "## 问题验证 ##\n### 步骤1：提取已知条件 ###\n- **系统**：一个示踪分子在一个宽度为 $L$ 的一维狭缝纳米孔中。\n- **边界条件**：在 $x=0$ 和 $x=L$ 处的反射壁。\n- **控制方程**：扩散方程，$\\partial_{t} P(x,t|x_{0}) = D \\partial_{x}^{2} P(x,t|x_{0})$。\n- **边界条件（数学形式）**：诺伊曼 (Neumann) 条件，$\\partial_{x} P(x,t|x_{0})|_{x=0} = 0$ 和 $\\partial_{x} P(x,t|x_{0})|_{x=L} = 0$。\n- **长时间MSD**：当 $t \\to \\infty$ 时，$\\langle \\Delta x^{2} \\rangle \\to L^{2}/6$。\n- **短时区域**：$t \\ll L^{2}/D$。\n- **MSD的定义**：$\\langle \\Delta x^{2} \\rangle(t) = \\langle \\left(x(t)-x(0)\\right)^{2} \\rangle$。\n- **初始条件**：$x(0)$ 从 $[0,L]$ 上的均匀概率分布中抽取。\n- **任务1**：使用镜像法推导 $\\langle \\Delta x^{2} \\rangle(t)$ 的短时渐近展开，保留对自由扩散的第一个修正项。\n- **任务2**：利用在时间 $t_1$ 和 $t_2$ 的两次MSD测量值，构建体相扩散系数 $D$ 的估计器。\n- **任务3**：利用所给数据数值计算 $D$。\n- **数据**：\n    - $L=20\\,\\mathrm{nm}$\n    - $t_{1} = 1.0\\,\\mathrm{ns}$，$\\langle \\Delta x^{2} \\rangle(t_{1}) = 0.44340468\\,\\mathrm{nm}^{2}$\n    - $t_{2} = 4.0\\,\\mathrm{ns}$，$\\langle \\Delta x^{2} \\rangle(t_{2}) = 1.70723656\\,\\mathrm{nm}^{2}$\n- **输出要求**：将 $D$ 的最终值四舍五入到四位有效数字，并以 $\\mathrm{nm}^{2}\\,\\mathrm{ns}^{-1}$ 为单位表示。\n\n### 步骤2：使用提取的已知条件进行验证 ###\n该问题具有科学依据、适定且客观。\n- **科学依据**：该问题描述了受限几何中的布朗运动，这是统计物理和计算材料科学中的一个经典课题。扩散方程、用于反射壁的诺伊曼边界条件以及均方位移的定义都是标准且正确的。MSD的长时间极限也是该系统的已知正确结果。所要求的镜像法是解决此类偏微分方程的标准数学技巧。\n- **适定性**：该问题是适定的。控制方程、边界条件和初始分布都已指定，保证了概率分布 $P(x,t|x_0)$ 及其衍生的MSD有唯一解。所提供的数据足以确定单个未知参数 $D$。短时条件 $t \\ll L^2/D$ 确保了所要求的渐近展开的有效性。\n- **客观性**：该问题使用精确、客观、无歧义的科学语言进行陈述。\n\n### 步骤3：结论与行动 ###\n问题有效。将提供完整解答。\n\n## 解答 ##\n本题要求从受限系统中的短时均方位移 (MSD) 数据中求出体相扩散系数 $D$。解题过程分为三部分：首先，我们推导MSD的短时渐近形式；其次，我们利用此形式构建一个 $D$ 的估计器；第三，我们将此估计器应用于给定数据。\n\n### 第一部分：MSD的短时渐近展开 ###\n在区间 $[0,L]$ 上对初始位置 $x_0 = x(0)$ 的均匀初始分布进行平均后，MSD由下式给出\n$$ \\langle \\Delta x^{2} \\rangle(t) = \\int_0^L \\frac{1}{L} \\langle(x(t)-x_0)^2\\rangle_{x_0} dx_0 $$\n其中 $\\langle(\\cdot)\\rangle_{x_0}$ 表示对所有从 $x_0$ 出发的轨迹的平均。\n\n对于一个在一维空间中扩散且受限于 $x=0$ 处单个反射壁的粒子，从 $x_0$ 开始的轨迹的MSD已知为：\n$$ \\langle(x(t)-x_0)^2\\rangle_{x_0, \\text{wall at 0}} = 2Dt - 2\\sqrt{4Dt} \\cdot x_0 \\cdot \\text{ierfc}\\left(\\frac{x_0}{\\sqrt{4Dt}}\\right) $$\n其中 $\\text{ierfc}(z) = \\int_z^\\infty \\text{erfc}(y)dy = \\frac{1}{\\sqrt{\\pi}}\\exp(-z^2) - z \\cdot \\text{erfc}(z)$ 是积分余误差函数。\n\n在短时区域 ($t \\ll L^2/D$)，扩散长度 $\\sqrt{Dt}$ 远小于狭缝宽度 $L$。在此极限下，位于 $x=0$ 和 $x=L$ 的两个壁对从 $x_0$ 开始的粒子的影响可以视为可加的。对于从距离 $L-x_0$ 处开始的粒子，$x=L$ 处的壁的影响等效于 $x=0$ 处的壁的影响。因此，狭缝中的条件MSD近似为：\n$$ \\langle(x(t)-x_0)^2\\rangle_{x_0} \\approx 2Dt - 2\\sqrt{4Dt} \\left[ x_0 \\cdot \\text{ierfc}\\left(\\frac{x_0}{\\sqrt{4Dt}}\\right) + (L-x_0) \\cdot \\text{ierfc}\\left(\\frac{L-x_0}{\\sqrt{4Dt}}\\right) \\right] $$\n为了求得系综平均MSD，我们将此表达式对 $x_0$ 从 $0$ 到 $L$ 进行积分：\n$$ \\langle \\Delta x^{2} \\rangle(t) \\approx 2Dt - \\frac{2\\sqrt{4Dt}}{L} \\int_0^L \\left[ x_0 \\cdot \\text{ierfc}\\left(\\frac{x_0}{\\sqrt{4Dt}}\\right) + (L-x_0) \\cdot \\text{ierfc}\\left(\\frac{L-x_0}{\\sqrt{4Dt}}\\right) \\right] dx_0 $$\n通过变量代换 $y_0 = L-x_0$，可以证明积分的第二部分与第一部分相同：\n$$ \\int_0^L (L-x_0) \\cdot \\text{ierfc}\\left(\\frac{L-x_0}{\\sqrt{4Dt}}\\right) dx_0 = \\int_0^L y_0 \\cdot \\text{ierfc}\\left(\\frac{y_0}{\\sqrt{4Dt}}\\right) dy_0 $$\n因此，表达式简化为：\n$$ \\langle \\Delta x^{2} \\rangle(t) \\approx 2Dt - \\frac{4\\sqrt{4Dt}}{L} \\int_0^L x_0 \\cdot \\text{ierfc}\\left(\\frac{x_0}{\\sqrt{4Dt}}\\right) dx_0 $$\n我们在短时极限下计算该积分。令 $z = x_0/\\sqrt{4Dt}$，则 $x_0 = z\\sqrt{4Dt}$ 且 $dx_0 = \\sqrt{4Dt} dz$。积分上限变为 $L/\\sqrt{4Dt}$，当 $t \\to 0$ 时，该值趋于 $\\infty$。\n$$ \\int_0^L x_0 \\cdot \\text{ierfc}\\left(\\frac{x_0}{\\sqrt{4Dt}}\\right) dx_0 \\approx \\int_0^\\infty (z\\sqrt{4Dt}) \\cdot \\text{ierfc}(z) \\cdot (\\sqrt{4Dt} dz) = 4Dt \\int_0^\\infty z \\cdot \\text{ierfc}(z) dz $$\n定积分 $\\int_0^\\infty z \\cdot \\text{ierfc}(z) dz$ 可以使用分部积分法求解，注意到 $\\frac{d}{dz}\\text{ierfc}(z) = -\\text{erfc}(z)$：\n$$ \\int_0^\\infty z \\cdot \\text{ierfc}(z) dz = \\int_0^\\infty z \\left(\\int_z^\\infty \\text{erfc}(y) dy\\right) dz $$\n交换积分次序：\n$$ \\int_0^\\infty \\text{erfc}(y) \\left(\\int_0^y z dz\\right) dy = \\frac{1}{2} \\int_0^\\infty y^2 \\text{erfc}(y) dy $$\n这是一个已知的积分结果，$\\int_0^\\infty y^2 \\text{erfc}(y) dy = 1/(3\\sqrt{\\pi})$。\n因此，$\\int_0^\\infty z \\cdot \\text{ierfc}(z) dz = \\frac{1}{6\\sqrt{\\pi}}$。\n将其代回，我们得到：\n$$ \\int_0^L x_0 \\cdot \\text{ierfc}\\left(\\frac{x_0}{\\sqrt{4Dt}}\\right) dx_0 \\approx 4Dt \\cdot \\frac{1}{6\\sqrt{\\pi}} = \\frac{2Dt}{3\\sqrt{\\pi}} $$\nMSD 中的修正项是：\n$$ - \\frac{4\\sqrt{4Dt}}{L} \\left(\\frac{2Dt}{3\\sqrt{\\pi}}\\right) = -\\frac{8 \\cdot 2\\sqrt{Dt}}{L} \\frac{Dt}{3\\sqrt{\\pi}} = - \\frac{16 (Dt)^{3/2}}{3L\\sqrt{\\pi}} $$\n因此，MSD 的短时渐近展开为：\n$$ \\langle \\Delta x^{2} \\rangle(t) = 2Dt - \\frac{16 D^{3/2}}{3L\\sqrt{\\pi}} t^{3/2} + \\dots $$\n该表达式具有 $\\langle \\Delta x^{2} \\rangle(t) = At - Bt^{3/2}$ 的形式，其中主导项 $At = 2Dt$ 对应于自由扩散，而项 $-Bt^{3/2}$ 是由边界反射引起的第一个非平凡修正。其标度关系明确为 $D^{3/2}$、$t^{3/2}$ 和 $L^{-1}$。\n\n### 第二部分：D 的估计器的构建 ###\n我们在两个不同的短时间 $t_1$ 和 $t_2$ 有两个测量值，$f(t_1) = \\langle \\Delta x^{2} \\rangle(t_{1})$ 和 $f(t_2) = \\langle \\Delta x^{2} \\rangle(t_{2})$。使用推导出的渐近形式：\n$$ f(t_1) = 2Dt_1 - B t_1^{3/2} \\quad (1) $$\n$$ f(t_2) = 2Dt_2 - B t_2^{3/2} \\quad (2) $$\n其中 $B = \\frac{16 D^{3/2}}{3L\\sqrt{\\pi}}$。我们的目标是消去 $B$ 并求解 $D$。\n从方程(1)中，我们可以将 $B$ 表示为：\n$$ B = \\frac{2Dt_1 - f(t_1)}{t_1^{3/2}} $$\n将此代入方程(2)：\n$$ f(t_2) = 2Dt_2 - \\left(\\frac{2Dt_1 - f(t_1)}{t_1^{3/2}}\\right) t_2^{3/2} $$\n$$ f(t_2) = 2Dt_2 - (2Dt_1 - f(t_1)) \\left(\\frac{t_2}{t_1}\\right)^{3/2} $$\n现在，我们将含有 $D$ 的项组合在一起：\n$$ f(t_2) - f(t_1) \\left(\\frac{t_2}{t_1}\\right)^{3/2} = 2Dt_2 - 2Dt_1 \\left(\\frac{t_2}{t_1}\\right)^{3/2} $$\n$$ f(t_2) - f(t_1) \\left(\\frac{t_2}{t_1}\\right)^{3/2} = 2D \\left[t_2 - t_1 \\left(\\frac{t_2}{t_1}\\right)^{3/2}\\right] $$\n求解 $D$ 得到估计器：\n$$ D = \\frac{f(t_2) - f(t_1) \\left(\\frac{t_2}{t_1}\\right)^{3/2}}{2 \\left[t_2 - t_1 \\left(\\frac{t_2}{t_1}\\right)^{3/2}\\right]} $$\n\n### 第三部分：D 的数值计算 ###\n我们现在将此公式应用于给定数据：\n- $t_{1} = 1.0\\,\\mathrm{ns}$\n- $f(t_{1}) = 0.44340468\\,\\mathrm{nm}^{2}$\n- $t_{2} = 4.0\\,\\mathrm{ns}$\n- $f(t_{2}) = 1.70723656\\,\\mathrm{nm}^{2}$\n\n首先，我们计算依赖于时间比率的项：\n$$ \\left(\\frac{t_2}{t_1}\\right)^{3/2} = \\left(\\frac{4.0}{1.0}\\right)^{3/2} = 4^{3/2} = (4^{1/2})^3 = 2^3 = 8 $$\n现在，将数值代入 $D$ 的估计器：\n$$ D = \\frac{1.70723656 - (0.44340468) \\cdot 8}{2 [4.0 - (1.0) \\cdot 8]} $$\n$$ D = \\frac{1.70723656 - 3.54723744}{2 [4.0 - 8.0]} $$\n$$ D = \\frac{-1.84000088}{2(-4.0)} $$\n$$ D = \\frac{-1.84000088}{-8.0} $$\n$$ D = 0.23000011\\,\\mathrm{nm}^{2}\\,\\mathrm{ns}^{-1} $$\n将结果四舍五入到四位有效数字，我们得到：\n$$ D \\approx 0.2300\\,\\mathrm{nm}^{2}\\,\\mathrm{ns}^{-1} $$\n所有单位都一致，因此不需要进行转换。",
            "answer": "$$\n\\boxed{0.2300}\n$$"
        },
        {
            "introduction": "许多真实材料，特别是晶体，表现出与方向相关的扩散行为。在这些情况下，简单的标量扩散系数 $D$ 是不够的，我们必须确定完整的扩散张量 $\\mathbf{D}$。这最后一个动手练习  是一项综合性的计算任务，你将模拟各向异性扩散，在非正交基中估算扩散张量，并验证其基本的张量性质——坐标系无关性。这项实践将简单模型与分析复杂、低对称性晶体材料所需的方法联系起来。",
            "id": "3465044",
            "problem": "考虑一个低对称性的晶体固体，其扩散是各向异性的。设各向异性扩散被建模为三维笛卡尔空间中粒子位移的平稳高斯过程，其具有一个正定扩散张量 $\\mathbf{D}$，使得在时间步长 $\\Delta t$ 内的位移增量在不同步和不同粒子之间是独立同分布的，并且总位移的二阶矩张量随时间线性增长。您将根据随时间变化的位移二阶矩计算各向异性扩散张量 $\\mathbf{D}$，但关键是，您必须在一个非正交晶格基中进行估计，然后旋转回笛卡尔坐标以获得主轴。您还将测试在测量参考系变换下，估计出的 $\\mathbf{D}$ 的参考系不变性。\n\n基本原理：\n从三维均方位移定义为位移 $\\Delta \\mathbf{r}(t)$ 的二阶矩出发，并基于以下观察：对于由三维扩散方程描述的扩散过程，当 $t$ 足够大时，二阶矩张量的增长与时间呈线性关系。对于各向异性扩散，对称扩散张量 $\\mathbf{D}$ 表征了这种线性增长。在您的实现中，不得假设任何快捷公式；相反，应通过将二阶矩张量各分量对时间进行回归，直接从轨迹数据中估计线性时间依赖性。使用非正交晶格基构建位移系数，然后变换回笛卡尔空间以获得 $\\mathbf{D}$ 及其主轴。\n\n坐标约定：\n- 令 $\\mathbf{U} \\in \\mathbb{R}^{3 \\times 3}$ 是一个矩阵，其列向量为以笛卡尔坐标表示、单位为米的晶格矢量 $\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3$。这些矢量无需正交。\n- 给定一个笛卡尔位移矢量 $\\Delta \\mathbf{r}(t) \\in \\mathbb{R}^3$，通过求解 $\\Delta \\mathbf{r}(t) = \\mathbf{U}\\,\\Delta \\mathbf{c}(t)$ 来定义晶格基系数 $\\Delta \\mathbf{c}(t)$，因此 $\\Delta \\mathbf{c}(t) = \\mathbf{U}^{-1} \\Delta \\mathbf{r}(t)$。\n- 在晶格基系数空间中的二阶矩张量为 $\\mathbf{C}_{\\text{lat}}(t) = \\langle \\Delta \\mathbf{c}(t)\\,\\Delta \\mathbf{c}(t)^\\top \\rangle$，在笛卡尔空间中为 $\\mathbf{C}_{\\text{car}}(t) = \\langle \\Delta \\mathbf{r}(t)\\,\\Delta \\mathbf{r}(t)^\\top \\rangle$。\n- 笛卡尔张量通过 $\\mathbf{C}_{\\text{car}}(t) = \\mathbf{U}\\,\\mathbf{C}_{\\text{lat}}(t)\\,\\mathbf{U}^\\top$ 与晶格基张量相关联。\n\n估计协议：\n- 对于每个测试案例，生成 $M$ 个独立粒子的合成轨迹，这些粒子经历由一组已知主扩散系数和空间取向所表征的各向异性扩散。模拟必须使用时间步长 $\\Delta t$ 和步数 $N$，初始位置为 $\\mathbf{r}(0)=\\mathbf{0}$。位移是通过累加每一步的独立零均值高斯增量来计算的。\n- 对于每个时间 $t_k = k \\Delta t$（其中 $k \\in \\{1,2,\\dots,N\\}$），通过对 $M$ 个粒子进行平均来计算 $\\mathbf{C}_{\\text{lat}}(t_k)$。\n- 通过将每个张量分量作为时间 $t$ 的函数进行最小二乘线性回归，来估计 $\\mathbf{C}_{\\text{lat}}(t)$ 相对于 $t$ 的线性系数。将此线性系数变换回笛卡尔坐标，以获得笛卡尔坐标下扩散张量的估计值 $\\widehat{\\mathbf{D}}$。\n- 对 $\\widehat{\\mathbf{D}}$ 进行对角化，以获得其主轴（特征向量）和主扩散系数（特征值）。以平方米每秒（m$^2$/s）为单位报告特征值。\n- 参考系不变性测试：通过给定的旋转 $\\mathbf{R}$ 旋转整个轨迹数据集，并同时将晶格矩阵 $\\mathbf{U}$ 旋转为 $\\mathbf{U}' = \\mathbf{R}\\,\\mathbf{U}$。使用相同的晶格基回归方法，从旋转后的数据中重新计算估计值 $\\widehat{\\mathbf{D}}'$。通过计算逐元素最大绝对差，将 $\\widehat{\\mathbf{D}}'$ 与相似变换 $\\mathbf{R}\\,\\widehat{\\mathbf{D}}\\,\\mathbf{R}^\\top$进行比较。定义一个布尔标志，如果此差异小于原始估计中最大主扩散系数的 $0.02$ 倍的容差，则该标志为 $\\text{True}$，否则为 $\\text{False}$。这用于测试参考系不变性。\n\n旋转约定：使用主动旋转，按 $\\mathbf{R} = \\mathbf{R}_z(\\alpha)\\,\\mathbf{R}_y(\\beta)\\,\\mathbf{R}_x(\\gamma)$ 的顺序应用于矢量，其中 $\\alpha$、$\\beta$ 和 $\\gamma$ 是以弧度为单位的角度。\n\n单位：\n- 所有晶格矢量分量的单位均为米。\n- 时间步长 $\\Delta t$ 的单位为秒。\n- 主扩散系数的单位为平方米每秒。\n- 输出的主扩散系数必须以平方米每秒（m$^2$/s）表示。\n- 角度以弧度为单位。\n\n测试套件：\n提供三个测试案例，参数如下。在每个案例中，合成真值定义了主扩散系数和主轴的取向；晶格由 $\\mathbf{U}$ 定义；并提供一个测量参考系旋转 $\\mathbf{R}$ 以测试参考系不变性。按规定使用 $M$ 个粒子、$N$ 步和时间步长 $\\Delta t$。每个案例的随机数生成器种子必须固定以确保可复现性。\n\n- 案例 1：\n  - $M = 200$, $N = 2000$, $\\Delta t = 1.0 \\times 10^{-12}\\ \\mathrm{s}$。\n  - 主扩散系数 $(d_1,d_2,d_3) = (1.0 \\times 10^{-10},\\,3.0 \\times 10^{-10},\\,5.0 \\times 10^{-10})\\ \\mathrm{m}^2/\\mathrm{s}$。\n  - 取向角 $(\\alpha,\\beta,\\gamma) = (0.7,\\,1.1,\\,0.3)$ 弧度。\n  - 晶格矩阵 $\\mathbf{U}$，其列向量为：\n    - $\\mathbf{a}_1 = (5.0 \\times 10^{-10},\\,0.0,\\,0.0)\\ \\mathrm{m}$，\n    - $\\mathbf{a}_2 = (1.0 \\times 10^{-10},\\,7.0 \\times 10^{-10},\\,0.0)\\ \\mathrm{m}$，\n    - $\\mathbf{a}_3 = (2.0 \\times 10^{-10},\\,1.0 \\times 10^{-10},\\,6.0 \\times 10^{-10})\\ \\mathrm{m}$。\n  - 测量参考系旋转角 $(\\alpha',\\beta',\\gamma') = (0.5,\\,-0.4,\\,0.9)$ 弧度。\n\n- 案例 2（近各向同性边界）：\n  - $M = 200$, $N = 2000$, $\\Delta t = 1.0 \\times 10^{-12}\\ \\mathrm{s}$。\n  - 主扩散系数 $(d_1,d_2,d_3) = (2.00 \\times 10^{-10},\\,2.10 \\times 10^{-10},\\,2.05 \\times 10^{-10})\\ \\mathrm{m}^2/\\mathrm{s}$。\n  - 取向角 $(\\alpha,\\beta,\\gamma) = (0.2,\\,0.6,\\,-0.3)$ 弧度。\n  - 晶格矩阵 $\\mathbf{U}$，其列向量为：\n    - $\\mathbf{a}_1 = (4.0 \\times 10^{-10},\\,0.5 \\times 10^{-10},\\,0.0)\\ \\mathrm{m}$，\n    - $\\mathbf{a}_2 = (0.3 \\times 10^{-10},\\,5.5 \\times 10^{-10},\\,0.4 \\times 10^{-10})\\ \\mathrm{m}$，\n    - $\\mathbf{a}_3 = (0.2 \\times 10^{-10},\\,0.1 \\times 10^{-10},\\,5.8 \\times 10^{-10})\\ \\mathrm{m}$。\n  - 测量参考系旋转角 $(\\alpha',\\beta',\\gamma') = (-0.1,\\,0.8,\\,0.4)$ 弧度。\n\n- 案例 3（强各向异性，高度倾斜晶格）：\n  - $M = 200$, $N = 2000$, $\\Delta t = 1.0 \\times 10^{-12}\\ \\mathrm{s}$。\n  - 主扩散系数 $(d_1,d_2,d_3) = (0.5 \\times 10^{-10},\\,4.0 \\times 10^{-10},\\,8.0 \\times 10^{-10})\\ \\mathrm{m}^2/\\mathrm{s}$。\n  - 取向角 $(\\alpha,\\beta,\\gamma) = (1.0,\\,-0.7,\\,0.4)$ 弧度。\n  - 晶格矩阵 $\\mathbf{U}$，其列向量为：\n    - $\\mathbf{a}_1 = (3.5 \\times 10^{-10},\\,0.6 \\times 10^{-10},\\,0.2 \\times 10^{-10})\\ \\mathrm{m}$，\n    - $\\mathbf{a}_2 = (0.9 \\times 10^{-10},\\,6.2 \\times 10^{-10},\\,0.7 \\times 10^{-10})\\ \\mathrm{m}$，\n    - $\\mathbf{a}_3 = (1.3 \\times 10^{-10},\\,0.8 \\times 10^{-10},\\,6.5 \\times 10^{-10})\\ \\mathrm{m}$。\n  - 测量参考系旋转角 $(\\alpha',\\beta',\\gamma') = (0.3,\\,1.2,\\,-0.5)$ 弧度。\n\n您的程序必须：\n- 针对每个案例，模拟与指定主扩散系数和取向一致的轨迹。\n- 通过以下步骤估计笛卡尔坐标中的 $\\widehat{\\mathbf{D}}$：\n  - 使用 $\\mathbf{U}^{-1}$ 计算晶格基系数 $\\Delta \\mathbf{c}(t)$，\n  - 将 $\\mathbf{C}_{\\text{lat}}(t)$ 的每个分量对 $t$ 进行回归以获得线性系数，\n  - 变换回笛卡尔坐标以获得 $\\widehat{\\mathbf{D}}$，\n  - 对 $\\widehat{\\mathbf{D}}$ 进行对角化以获得主扩散系数（特征值）。\n- 通过根据 $\\mathbf{R}$ 旋转数据和晶格并重新计算 $\\widehat{\\mathbf{D}}'$ 来执行参考系不变性测试，然后报告 $\\widehat{\\mathbf{D}}'$ 和 $\\mathbf{R}\\,\\widehat{\\mathbf{D}}\\,\\mathbf{R}^\\top$ 之间以平方米每秒为单位的逐元素最大绝对差，以及上面定义的布尔标志。\n\n输出规范：\n- 所有主扩散系数均以平方米每秒（m$^2$/s）表示。\n- 对于每个测试案例，输出一个包含三个条目的列表：\n  - 一个包含 $\\widehat{\\mathbf{D}}$ 的三个主扩散系数（特征值）的列表，按升序排列，单位为 m$^2$/s。\n  - 一个浮点值，等于 $\\widehat{\\mathbf{D}}'$ 和 $\\mathbf{R}\\,\\widehat{\\mathbf{D}}\\,\\mathbf{R}^\\top$ 之间逐元素最大绝对差，单位为 m$^2$/s。\n  - 一个布尔值，指示是否满足参考系不变性准则（差异小于最大主扩散系数的 $0.02$ 倍）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试案例对应一个子列表，并按上述案例的顺序排列。例如，一个有效的输出格式为 $[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$。\n\n不允许用户输入；所有参数必须从上面的测试套件中硬编码。每个案例使用固定的随机数生成器种子以确保可复现性。",
            "solution": "用户提供的问题被评估为**有效**。它在科学上是合理的、良构的，并基于统计力学和线性代数的既定原理。问题陈述是完整的，提供了所有必要的参数和一个清晰、可验证的目标。没有矛盾、歧义或伪科学主张。该任务是计算材料科学领域一个标准的、不简单的练习。\n\n### 基于原理的解决方案设计\n\n该解决方案基于各向异性扩散和张量分析的基本原理。问题的核心在于从模拟的粒子轨迹中估计扩散张量 $\\mathbf{D}$。\n\n#### 1. 理论基础：各向异性扩散\n\n对于在三维空间中进行扩散（维纳过程）的粒子，其平均位移为零，$\\langle \\Delta \\mathbf{r}(t) \\rangle = \\mathbf{0}$。位移矢量 $\\Delta \\mathbf{r}(t) = \\mathbf{r}(t) - \\mathbf{r}(0)$ 的二阶矩随时间 $t$ 线性增长。对于各向异性扩散，这种关系由一个对称的正定扩散张量 $\\mathbf{D} \\in \\mathbb{R}^{3 \\times 3}$ 描述：\n$$\n\\langle \\Delta \\mathbf{r}(t) \\Delta \\mathbf{r}(t)^\\top \\rangle = 2\\mathbf{D}t\n$$\n此处，$\\langle \\cdot \\rangle$ 表示对许多独立粒子的系综平均。矩阵 $\\langle \\Delta \\mathbf{r}(t) \\Delta \\mathbf{r}(t)^\\top \\rangle$ 是笛卡尔坐标系下的二阶矩张量，记为 $\\mathbf{C}_{\\text{car}}(t)$。$\\mathbf{D}$ 的特征值是主扩散系数，其特征向量定义了扩散的主轴。\n\n#### 2. 轨迹模拟\n\n为了生成合成轨迹，我们将扩散过程建模为随机行走。在时间 $t_k = k\\Delta t$ 的总位移 $\\Delta \\mathbf{r}(t_k)$ 是 $k$ 个独立同分布的位移增量 $\\delta \\mathbf{r}_j$ 的和：\n$$\n\\Delta \\mathbf{r}(t_k) = \\sum_{j=1}^{k} \\delta \\mathbf{r}_j\n$$\n每个增量 $\\delta \\mathbf{r}$ 对应一个时间步长 $\\Delta t$，并从一个零均值、协方差矩阵为 $\\mathbf{C}_{\\text{step}}$ 的多元正态分布中抽取。根据线性增长特性，单步的协方差为 $\\mathbf{C}_{\\text{step}} = 2\\mathbf{D}\\Delta t$。\n\n模拟过程如下：\n1.  根据给定的主系数（$d_1, d_2, d_3$）和取向矩阵 $\\mathbf{P}$ 构建真实的笛卡尔扩散张量 $\\mathbf{D}_{\\text{true}}$。取向矩阵 $\\mathbf{P}$ 由主轴的列向量构成，这些主轴由指定的欧拉角构建。该张量由 $\\mathbf{D}_{\\text{true}} = \\mathbf{P} \\text{diag}(d_1, d_2, d_3) \\mathbf{P}^\\top$ 给出。\n2.  计算步协方差矩阵 $\\mathbf{C}_{\\text{step}} = 2\\mathbf{D}_{\\text{true}}\\Delta t$。\n3.  进行 Cholesky 分解 $\\mathbf{C}_{\\text{step}} = \\mathbf{L}\\mathbf{L}^\\top$。矩阵 $\\mathbf{L}$ 是协方差的“平方根”。\n4.  生成标准正态随机数向量 $\\mathbf{z}$。位移增量则为 $\\delta \\mathbf{r} = \\mathbf{L}\\mathbf{z}$。\n5.  对 $M$ 个粒子随时间累加增量，以获得完整的位移轨迹 $\\Delta \\mathbf{r}_i(t_k)$，其中 $i \\in \\{1,\\dots,M\\}$ 且 $k \\in \\{1,\\dots,N\\}$。\n\n#### 3. 在非正交基中进行估计\n\n问题要求在由矩阵 $\\mathbf{U}$ 定义的非正交晶格基中进行估计，该矩阵的列是晶格矢量。\n1.  笛卡尔位移 $\\Delta \\mathbf{r}(t)$ 与其晶格基系数矢量 $\\Delta \\mathbf{c}(t)$ 的关系为 $\\Delta \\mathbf{r}(t) = \\mathbf{U}\\Delta \\mathbf{c}(t)$。因此，系数通过 $\\Delta \\mathbf{c}(t) = \\mathbf{U}^{-1}\\Delta \\mathbf{r}(t)$ 求得。\n2.  对于每个时间步长 $t_k$，我们通过对所有 $M$ 个粒子进行平均来计算晶格基中的二阶矩张量 $\\mathbf{C}_{\\text{lat}}(t_k)$：\n    $$\n    \\mathbf{C}_{\\text{lat}}(t_k) = \\frac{1}{M} \\sum_{i=1}^{M} \\Delta \\mathbf{c}_i(t_k) \\Delta \\mathbf{c}_i(t_k)^\\top\n    $$\n3.  笛卡尔二阶矩张量与晶格基二阶矩张量之间的关系是 $\\mathbf{C}_{\\text{car}}(t) = \\mathbf{U}\\mathbf{C}_{\\text{lat}}(t)\\mathbf{U}^\\top$。\n4.  由于 $\\mathbf{C}_{\\text{car}}(t)$ 随时间线性增长，$\\mathbf{C}_{\\text{lat}}(t)$ 也必定如此。我们有 $\\mathbf{C}_{\\text{lat}}(t) \\approx \\mathbf{L}_{\\text{lat}}t$，其中 $\\mathbf{L}_{\\text{lat}}$ 是增长率矩阵。\n5.  为了估计 $\\mathbf{L}_{\\text{lat}}$，我们对对称张量 $\\mathbf{C}_{\\text{lat}}(t_k)$ 的六个独立分量分别对时间 $t_k$ 进行线性回归。每次回归的斜率给出了估计矩阵 $\\widehat{\\mathbf{L}}_{\\text{lat}}$ 的相应元素。\n\n#### 4. 恢复笛卡尔扩散张量\n\n一旦估计出 $\\widehat{\\mathbf{L}}_{\\text{lat}}$，就可以通过逆变换恢复笛卡尔扩散张量 $\\widehat{\\mathbf{D}}$：\n$$\n2\\widehat{\\mathbf{D}}t = \\mathbf{U}(\\widehat{\\mathbf{L}}_{\\text{lat}}t)\\mathbf{U}^\\top \\implies \\widehat{\\mathbf{D}} = \\frac{1}{2} \\mathbf{U}\\widehat{\\mathbf{L}}_{\\text{lat}}\\mathbf{U}^\\top\n$$\n这个估计张量 $\\widehat{\\mathbf{D}}$ 的特征值就是估计的主扩散系数。\n\n#### 5. 参考系不变性测试\n\n此测试验证了张量的一个基本属性。由张量表示的物理量在坐标系变换下必须以可预测的方式进行变换。如果笛卡尔测量参考系通过矩阵 $\\mathbf{R}$ 进行旋转，所有矢量都按 $\\mathbf{v}'=\\mathbf{R}\\mathbf{v}$ 进行变换。像 $\\mathbf{D}$ 这样的二阶张量必须按 $\\mathbf{D}'=\\mathbf{R}\\mathbf{D}\\mathbf{R}^\\top$ 进行变换。\n\n该测试包括：\n1.  旋转整套模拟的笛卡尔位移轨迹：$\\Delta \\mathbf{r}'(t) = \\mathbf{R}\\Delta \\mathbf{r}(t)$。\n2.  旋转定义非正交基的晶格矢量：$\\mathbf{U}' = \\mathbf{R}\\mathbf{U}$。\n3.  使用旋转后的数据（$\\Delta \\mathbf{r}'$）和旋转后的晶格（$\\mathbf{U}'$）重新运行整个估计流程，以获得新的估计值 $\\widehat{\\mathbf{D}}'$。\n4.  理论上，晶格系数在这种同时旋转下是不变的：$\\Delta \\mathbf{c}' = (\\mathbf{U}')^{-1}\\Delta \\mathbf{r}' = (\\mathbf{R}\\mathbf{U})^{-1}(\\mathbf{R}\\Delta \\mathbf{r}) = \\mathbf{U}^{-1}\\mathbf{R}^{-1}\\mathbf{R}\\Delta \\mathbf{r} = \\mathbf{U}^{-1}\\Delta \\mathbf{r} = \\Delta \\mathbf{c}$。这意味着估计值 $\\widehat{\\mathbf{D}}'$ 必须通过张量变换法则与原始估计值 $\\widehat{\\mathbf{D}}$ 相关联：$\\widehat{\\mathbf{D}}' = \\mathbf{R}\\widehat{\\mathbf{D}}\\mathbf{R}^\\top$。\n5.  该测试通过计算重新计算的 $\\widehat{\\mathbf{D}}'$ 与变换后的原始估计 $\\mathbf{R}\\widehat{\\mathbf{D}}\\mathbf{R}^\\top$ 之间的差异，从而在数值上证实了这一点。一个很小的差异验证了实现的正确性，并确认了计算的张量性质。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates anisotropic diffusion, estimates the diffusion tensor via regression\n    in a non-orthogonal basis, and tests for frame invariance.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"M\": 200, \"N\": 2000, \"dt\": 1.0e-12,\n            \"d_principal\": (1.0e-10, 3.0e-10, 5.0e-10),\n            \"orientation_angles\": (0.7, 1.1, 0.3),\n            \"U_cols\": [(5.0e-10, 0.0, 0.0), (1.0e-10, 7.0e-10, 0.0), (2.0e-10, 1.0e-10, 6.0e-10)],\n            \"frame_rotation_angles\": (0.5, -0.4, 0.9),\n            \"seed\": 0\n        },\n        {\n            \"M\": 200, \"N\": 2000, \"dt\": 1.0e-12,\n            \"d_principal\": (2.00e-10, 2.10e-10, 2.05e-10),\n            \"orientation_angles\": (0.2, 0.6, -0.3),\n            \"U_cols\": [(4.0e-10, 0.5e-10, 0.0), (0.3e-10, 5.5e-10, 0.4e-10), (0.2e-10, 0.1e-10, 5.8e-10)],\n            \"frame_rotation_angles\": (-0.1, 0.8, 0.4),\n            \"seed\": 1\n        },\n        {\n            \"M\": 200, \"N\": 2000, \"dt\": 1.0e-12,\n            \"d_principal\": (0.5e-10, 4.0e-10, 8.0e-10),\n            \"orientation_angles\": (1.0, -0.7, 0.4),\n            \"U_cols\": [(3.5e-10, 0.6e-10, 0.2e-10), (0.9e-10, 6.2e-10, 0.7e-10), (1.3e-10, 0.8e-10, 6.5e-10)],\n            \"frame_rotation_angles\": (0.3, 1.2, -0.5),\n            \"seed\": 2\n        }\n    ]\n\n    results = []\n\n    def get_rotation_matrix(alpha, beta, gamma):\n        \"\"\"Constructs a 3D rotation matrix R = Rz(alpha)Ry(beta)Rx(gamma).\"\"\"\n        c1, s1 = np.cos(gamma), np.sin(gamma)\n        c2, s2 = np.cos(beta), np.sin(beta)\n        c3, s3 = np.cos(alpha), np.sin(alpha)\n        Rx = np.array([[1, 0, 0], [0, c1, -s1], [0, s1, c1]])\n        Ry = np.array([[c2, 0, s2], [0, 1, 0], [-s2, 0, c2]])\n        Rz = np.array([[c3, -s3, 0], [s3, c3, 0], [0, 0, 1]])\n        return Rz @ Ry @ Rx\n\n    def analyze_trajectories(disp_car, U, M, N, dt):\n        \"\"\"\n        Analyzes trajectories to estimate the diffusion tensor D.\n        - disp_car: Cartesian displacements (M, N, 3)\n        - U: Lattice matrix (3, 3)\n        - M, N, dt: simulation parameters\n        \"\"\"\n        U_inv = np.linalg.inv(U)\n        times = (np.arange(N) + 1) * dt\n        \n        # Transform to lattice-basis coefficients, shape (M, N, 3)\n        disp_lat = disp_car @ U_inv.T\n        \n        # Compute second-moment tensor C_lat(t) for each time step\n        # Transpose to (N, M, 3) to easily operate over particles for each time step\n        disp_lat_T = np.transpose(disp_lat, (1, 0, 2))\n        # C_lat_series[k] = mean(c_i(t_k) @ c_i(t_k).T) over i=1..M\n        C_lat_series = np.einsum('kim,kin-kmn', disp_lat_T, disp_lat_T) / M\n        \n        # Perform linear regression for each component of C_lat\n        L_lat_hat = np.zeros((3, 3))\n        A = np.vstack([times, np.ones(N)]).T\n        \n        for i in range(3):\n            for j in range(i, 3):\n                y = C_lat_series[:, i, j]\n                slope, _ = np.linalg.lstsq(A, y, rcond=None)[0]\n                L_lat_hat[i, j] = L_lat_hat[j, i] = slope\n        \n        # Transform back to Cartesian to get diffusion tensor\n        D_hat = 0.5 * (U @ L_lat_hat @ U.T)\n        return D_hat\n\n    for case in test_cases:\n        M, N, dt = case[\"M\"], case[\"N\"], case[\"dt\"]\n        d_principal = case[\"d_principal\"]\n        orientation_angles = case[\"orientation_angles\"]\n        U = np.array(case[\"U_cols\"]).T\n        frame_rotation_angles = case[\"frame_rotation_angles\"]\n        seed = case[\"seed\"]\n\n        # --- 1. Trajectory Generation ---\n        rng = np.random.default_rng(seed)\n        \n        # Construct true diffusion tensor D_true\n        D_diag = np.diag(d_principal)\n        R_orient = get_rotation_matrix(*orientation_angles)\n        D_true = R_orient @ D_diag @ R_orient.T\n        \n        # Covariance of a single step\n        cov_step = 2 * D_true * dt\n        L_chol = np.linalg.cholesky(cov_step)\n        \n        # Generate N steps for M particles\n        Z = rng.standard_normal(size=(M, N, 3))\n        delta_r = Z @ L_chol.T\n        \n        # Accumulate displacements\n        disp_car = np.cumsum(delta_r, axis=1)\n\n        # --- 2. Estimate D_hat from original data ---\n        D_hat = analyze_trajectories(disp_car, U, M, N, dt)\n        \n        # Get principal diffusion coefficients (eigenvalues)\n        eigvals = np.linalg.eigh(D_hat)[0]\n        sorted_eigvals = np.sort(eigvals)\n\n        # --- 3. Frame Invariance Test ---\n        R_measure = get_rotation_matrix(*frame_rotation_angles)\n        \n        # Rotate data and lattice\n        disp_car_rot = disp_car @ R_measure.T\n        U_prime = R_measure @ U\n        \n        # Recompute D_hat' from rotated data\n        D_hat_prime = analyze_trajectories(disp_car_rot, U_prime, M, N, dt)\n        \n        # Expected transformed tensor\n        D_expected = R_measure @ D_hat @ R_measure.T\n        \n        # Compare and check tolerance\n        max_diff = np.max(np.abs(D_hat_prime - D_expected))\n        invariance_tolerance = 0.02 * np.max(eigvals)\n        is_invariant = max_diff  invariance_tolerance\n        \n        # Store results\n        results.append([sorted_eigvals.tolist(), max_diff, bool(is_invariant)])\n\n    # --- 4. Final Output ---\n    # The string representation of a list of lists matches the required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}