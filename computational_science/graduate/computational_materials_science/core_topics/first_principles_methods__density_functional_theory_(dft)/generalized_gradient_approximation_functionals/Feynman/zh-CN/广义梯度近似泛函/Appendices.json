{
    "hands_on_practices": [
        {
            "introduction": "广义梯度近似（GGA）的核心思想是引入对电子密度梯度的依赖，以超越局域密度近似（LDA）。其中关键的无量纲量是约化密度梯度 $s$。这个练习将通过一个解析模型，帮助你深入理解 $s$ 的物理意义，并练习如何在给定一个简单的周期性密度波的情况下推导出 $s$ 的表达式 。",
            "id": "3454011",
            "problem": "在Kohn–Sham密度泛函理论中，一个自旋非极化系统的广义梯度近似 (GGA) 泛函使用交换约化梯度，其定义为 $s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2\\,k_{F}(n(\\mathbf{r}))\\,n(\\mathbf{r})}$，其中 $k_{F}(n) \\equiv \\left(3\\pi^{2} n\\right)^{1/3}$ 是局域费米波矢。考虑一个由 $n(x) = n_{0}\\left(1+\\delta \\cos(k x)\\right)$（其中 $\\delta \\ll 1$）给出的均匀电子密度的一维调制。从所述定义出发，并一致地保留到$\\delta$的一阶项，推导$s(x)$关于$n_{0}$、$\\delta$和$k$的显式表达式。根据所得表达式，在一个空间周期内确定$s(x)$在何处最小，在何处最大。将您的最终答案表示为$s(x)$的单个闭合形式解析表达式；无需进行数值计算，也不应包含单位。对区域的定性确定应出现在您的推导过程中，而不是在最终的方框答案中。",
            "solution": "该问题已被验证，并被确定为计算材料科学领域内一个适定的、具有科学依据的问题。推导过程如下。\n\n问题要求对于一个特定的一维电子密度调制，给出交换约化梯度$s(\\mathbf{r})$的表达式。给定的定义是：\n1. 自旋非极化系统的约化梯度：\n$$s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2\\,k_{F}(n(\\mathbf{r}))\\,n(\\mathbf{r})}$$\n2. 局域费米波矢：\n$$k_{F}(n) \\equiv \\left(3\\pi^{2} n\\right)^{1/3}$$\n3. 一维电子密度调制：\n$$n(x) = n_{0}\\left(1+\\delta \\cos(k x)\\right)$$\n条件 $\\delta \\ll 1$ 意味着我们可以使用线性近似（泰勒级数展开到$\\delta$的一阶）。\n\n首先，我们将$s(\\mathbf{r})$的一般三维定义应用于给定的一维情况。对于一个仅沿$x$方向变化的函数$n(x)$，其梯度$\\nabla n(x)$简化为$\\frac{dn(x)}{dx}\\hat{\\mathbf{x}}$。因此，梯度的模为$|\\nabla n(x)| = \\left|\\frac{dn(x)}{dx}\\right|$。$s(x)$的表达式变为：\n$$s(x) = \\dfrac{\\left|\\frac{dn(x)}{dx}\\right|}{2\\,k_{F}(n(x))\\,n(x)}$$\n\n接下来，我们计算分子，即密度梯度的模。我们对$n(x)$求关于$x$的导数：\n$$\\frac{dn(x)}{dx} = \\frac{d}{dx} \\left[ n_{0}\\left(1+\\delta \\cos(k x)\\right) \\right] = n_{0} \\left( -\\delta k \\sin(k x) \\right) = -n_{0}\\delta k \\sin(k x)$$\n其模为：\n$$\\left|\\frac{dn(x)}{dx}\\right| = |-n_{0}\\delta k \\sin(k x)| = n_{0}\\delta k |\\sin(k x)|$$\n这里，我们假设$n_{0} > 0$、$\\delta > 0$和$k > 0$，因为它们分别代表背景密度、一个小的正振幅和波矢的模。\n\n现在，我们分析分母$2\\,k_{F}(n(x))\\,n(x)$。将$k_{F}(n)$的定义代入此表达式，得到：\n$$2\\,k_{F}(n(x))\\,n(x) = 2 \\left(3\\pi^{2} n(x)\\right)^{1/3} n(x) = 2 \\left(3\\pi^{2}\\right)^{1/3} n(x)^{1/3} n(x) = 2 \\left(3\\pi^{2}\\right)^{1/3} n(x)^{4/3}$$\n接下来，我们代入$n(x)$的表达式：\n$$n(x)^{4/3} = \\left[n_{0}\\left(1+\\delta \\cos(k x)\\right)\\right]^{4/3} = n_{0}^{4/3} \\left(1+\\delta \\cos(k x)\\right)^{4/3}$$\n由于$\\delta \\ll 1$，对于小的$u$，我们可以使用二项式近似$(1+u)^{p} \\approx 1+pu$。这里，$u = \\delta \\cos(k x)$且$p = 4/3$。\n$$\\left(1+\\delta \\cos(k x)\\right)^{4/3} \\approx 1 + \\frac{4}{3}\\delta \\cos(k x)$$\n因此，分母近似为：\n$$2\\,k_{F}(n(x))\\,n(x) \\approx 2 \\left(3\\pi^{2}\\right)^{1/3} n_{0}^{4/3} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)$$\n\n现在我们组合出$s(x)$的完整表达式：\n$$s(x) \\approx \\dfrac{n_{0}\\delta k |\\sin(k x)|}{2 \\left(3\\pi^{2}\\right)^{1/3} n_{0}^{4/3} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)}$$\n我们可以简化包含$n_{0}$的项：\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 \\left(3\\pi^{2}\\right)^{1/3} n_{0}^{1/3}} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)^{-1}$$\n分母中的项可以改写为均匀密度的费米波矢$k_{F}(n_{0}) = (3\\pi^2 n_{0})^{1/3}$的形式：\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)^{-1}$$\n我们再次使用二项式近似，这次是$(1+v)^{-1} \\approx 1-v$，对于小的$v$，其中$v = \\frac{4}{3}\\delta \\cos(k x)$。\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})} \\left(1 - \\frac{4}{3}\\delta \\cos(k x)\\right)$$\n问题要求一致地保留到$\\delta$的一阶项。我们展开表达式：\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})} - \\dfrac{4}{3} \\dfrac{\\delta^2 k |\\sin(k x)|\\cos(k x)}{2 k_{F}(n_{0})}$$\n第一项是$\\mathcal{O}(\\delta)$阶，而第二项是$\\mathcal{O}(\\delta^2)$阶。为了一致地保留到$\\delta$的一阶，我们必须舍去第二项。因此，$s(x)$的最终表达式为：\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})}$$\n将$k_{F}(n_{0})$的显式形式代入，得到用所要求的参数$n_{0}$、$\\delta$和$k$表示的表达式：\n$$s(x) = \\dfrac{\\delta k |\\sin(k x)|}{2 \\left(3\\pi^{2} n_{0}\\right)^{1/3}}$$\n请注意，在一阶项的解析表达式中，近似关系变成了等式关系。\n\n最后，我们确定$s(x)$在一个空间周期内（例如$x \\in [0, 2\\pi/k]$）何处最大和最小。$s(x)$的值与$|\\sin(k x)|$成正比。\n- 当$|\\sin(k x)|$最小时，$s(x)$最小。$|\\sin(k x)|$的最小值为$0$，这发生在$k x = m\\pi$时，其中$m$为任意整数。对于区间$x \\in [0, 2\\pi/k]$，这对应于$x=0$、$x=\\pi/k$和$x=2\\pi/k$。在这些点，密度$n(x) = n_{0}(1 \\pm \\delta)$处于其最大值或最小值，且密度梯度$\\frac{dn}{dx}$为零。\n- 当$|\\sin(k x)|$最大时，$s(x)$最大。$|\\sin(k x)|$的最大值为$1$，这发生在$k x = \\frac{\\pi}{2} + m\\pi$时，其中$m$为任意整数。对于区间$x \\in [0, 2\\pi/k]$，这对应于$x=\\pi/(2k)$和$x=3\\pi/(2k)$。在这些点，$\\cos(kx)=0$，所以密度$n(x)=n_{0}$等于其平均值。这些是密度梯度最陡峭的位置。",
            "answer": "$$\\boxed{\\frac{\\delta k |\\sin(kx)|}{2 \\left(3\\pi^{2} n_{0}\\right)^{1/3}}}$$"
        },
        {
            "introduction": "理解了约化梯度 $s$ 的定义后，下一步是探究它如何修正总能量。这个练习将引导你从纯理论分析过渡到数值计算，通过实现一个二阶梯度展开（GE2）近似，并将其与一个完整的 Perdew–Burke–Ernzerhof (PBE) GGA 计算结果进行比较 。通过这种方式，你不仅能掌握 GGA 修正的摂动本质，还能亲手验证简单近似在何种情况下有效，在何种情况下失效。",
            "id": "3453981",
            "problem": "您的任务是推导并实现一个关于约化梯度 $s$ 的二阶微扰理论，用于估算在密度泛函理论 (DFT) 中，广义梯度近似 (GGA) 相对于局域密度近似 (LDA) 的交换贡献修正。推导必须从均匀电子气 (UEG) 和 Kohn-Sham DFT 的公认事实出发，而实现部分必须通过与使用广泛接受的增强因子的完整 GGA 交换计算进行对比，来验证该微扰估算。\n\n使用的基本原理和核心定义：\n- 在 Kohn-Sham 密度泛函理论 (DFT) 中，局域密度近似 (LDA) 下的交换能为 $E_{x}^{\\mathrm{LDA}} = \\int e_{x}^{\\mathrm{LDA}}(\\rho(\\mathbf r)) \\, d\\mathbf r$，其中 LDA 单位体积的交换能密度为 $e_{x}^{\\mathrm{LDA}}(\\rho) = -A_x \\rho^{4/3}$，且 $A_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$。\n- 约化梯度为 $s(\\mathbf r) = \\frac{|\\nabla \\rho(\\mathbf r)|}{2 k_F(\\mathbf r) \\rho(\\mathbf r)}$，其中 $k_F(\\mathbf r) = \\left(3\\pi^2 \\rho(\\mathbf r)\\right)^{1/3}$ 是局域费米波矢。\n- 对于弱非均匀密度，交换能密度的二阶梯度展开得出 $e_x^{\\mathrm{GE2}}(\\rho, s) \\approx e_x^{\\mathrm{LDA}}(\\rho)\\left(1 + \\mu_{\\mathrm{GE}} s^2\\right)$，其中梯度展开系数 $\\mu_{\\mathrm{GE}} = \\frac{10}{81}$。这导出了微扰修正 $\\Delta E_x^{\\mathrm{GE2}} \\approx \\int C s^2 \\rho^{4/3} \\, d\\mathbf r$，其中 $C = -A_x \\mu_{\\mathrm{GE}}$。\n- 一个经过充分检验的完整 GGA 交换修正可通过应用 Perdew-Burke-Ernzerhof (PBE) 交换增强因子获得，该因子定义为 $F_x^{\\mathrm{PBE}}(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu_{\\mathrm{PBE}} s^2 / \\kappa}$，参数为 $\\mu_{\\mathrm{PBE}} = 0.21951$ 和 $\\kappa = 0.804$。完整的 GGA 交换修正则为 $\\Delta e_x^{\\mathrm{PBE}}(\\rho, s) = e_x^{\\mathrm{LDA}}(\\rho)\\left(F_x^{\\mathrm{PBE}}(s) - 1\\right)$ 且 $\\Delta E_x^{\\mathrm{PBE}} = \\int \\Delta e_x^{\\mathrm{PBE}}(\\rho, s) \\, d\\mathbf r$。\n\n您的任务：\n1. 从以上定义出发，为弱非均匀晶体构建一个关于 $s$ 的二阶微扰理论，以得到估算式 $\\Delta E_x^{\\mathrm{GE2}} \\approx \\int C s^2 \\rho^{4/3} \\, d\\mathbf r$。\n2. 在一个周期性立方晶胞中，使用具有小振幅调制的傅里叶模式电子密度，实现一个数值验证，与完整的 PBE 交换计算进行对比。\n3. 使用带有周期性边界条件的离散均匀网格，通过带周期性环绕的中心差分来近似空间积分和梯度。\n4. 对于电子密度，使用物理上合理的周期性模型\n$$\n\\rho(\\mathbf r) = \\rho_0 \\left[1 + \\alpha \\cos(k_x x)\\cos(k_y y)\\cos(k_z z)\\right],\n$$\n其中 $k_i = \\frac{2\\pi n_i}{L}$ 且 $\\rho_0 = \\frac{3}{4\\pi r_s^3}$（使用原子单位，长度为玻尔，能量为哈特里）。Wigner-Seitz 半径 $r_s$ 用于参数化平均电子密度。\n5. 为每个测试案例计算以下量：\n- 微扰估算值 $\\Delta E_x^{\\mathrm{GE2}}$，单位为哈特里。\n- 完整的 PBE 交换修正 $\\Delta E_x^{\\mathrm{PBE}}$，单位为哈特里。\n- 相对误差，定义为 $\\frac{|\\Delta E_x^{\\mathrm{GE2}} - \\Delta E_x^{\\mathrm{PBE}}|}{|\\Delta E_x^{\\mathrm{PBE}}|}$，以小数值表示。\n\n科学真实性和单位：\n- 使用原子单位：能量单位为哈特里，长度单位为玻尔。\n- 能量以哈特里表示，并四舍五入到六位小数；相对误差四舍五入到六位小数。\n\n测试套件：\n实现程序以计算上述各量，使用以下参数集，这些参数集共同覆盖了一个正常路径、一个近均匀边界和一个显著的边缘情况：\n- 案例1（正常路径）：$L = 20$，$N = 64$，$r_s = 2.0$，$\\alpha = 0.05$，$(n_x,n_y,n_z) = (1,1,1)$。\n- 案例2（近均匀边界）：$L = 20$，$N = 64$，$r_s = 2.0$，$\\alpha = 10^{-4}$，$(n_x,n_y,n_z) = (1,1,1)$。\n- 案例3（边缘情况，波长更短且调制更大）：$L = 10$，$N = 64$，$r_s = 2.0$，$\\alpha = 0.30$，$(n_x,n_y,n_z) = (4,4,4)$。\n\n数值方法要求：\n- 在边长为 $L$ 的立方域上使用一个 $N \\times N \\times N$ 的网格，间距为 $\\Delta x = \\Delta y = \\Delta z = \\frac{L}{N}$。\n- 使用周期性中心差分来近似 $\\nabla \\rho$，即\n$\n\\partial_x \\rho \\approx \\frac{\\rho(x+\\Delta x, y, z) - \\rho(x-\\Delta x, y, z)}{2\\Delta x}\n$\n，对 $\\partial_y \\rho$ 和 $\\partial_z \\rho$ 也是如此，并在边界处使用周期性环绕。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中条目按案例1、2、3的顺序排列为\n$\n[\\Delta E_x^{\\mathrm{GE2}}(1), \\Delta E_x^{\\mathrm{PBE}}(1), \\mathrm{relerr}(1), \\Delta E_x^{\\mathrm{GE2}}(2), \\Delta E_x^{\\mathrm{PBE}}(2), \\mathrm{relerr}(2), \\Delta E_x^{\\mathrm{GE2}}(3), \\Delta E_x^{\\mathrm{PBE}}(3), \\mathrm{relerr}(3)]\n$\n，其中每个能量值都以哈特里为单位，并四舍五入到六位小数，每个相对误差都是一个四舍五入到六位小数的小数。",
            "solution": "该问题是有效的，因为它在科学上基于密度泛函理论 (DFT)，定义和参数完整，问题阐述清晰且客观。它提出了一个计算材料科学中标准的、可验证的问题，没有任何逻辑或事实上的不一致。\n\n主要目标是推导交换能修正的二阶梯度展开 (GE2)，并使用 Perdew-Burke-Ernzerhof (PBE) 泛函，通过与完整的广义梯度近似 (GGA) 计算进行对比，来数值验证其准确性。\n\n**1. 理论推导**\n\n在 Kohn-Sham DFT 中，一个通用 GGA 泛函的交换能表示为对全空间 $\\mathbf{r}$ 的积分：\n$$\nE_x^{\\mathrm{GGA}}[\\rho] = \\int e_x^{\\mathrm{LDA}}(\\rho(\\mathbf{r})) F_x(s(\\mathbf{r})) \\, d\\mathbf{r}\n$$\n其中 $e_x^{\\mathrm{LDA}}(\\rho) = -A_x \\rho^{4/3}$ 是局域密度近似 (LDA) 的交换能密度，且 $A_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$。$F_x(s)$ 是无量纲的增强因子，它依赖于约化密度梯度 $s(\\mathbf{r})$。约化梯度是衡量电子密度 $\\rho(\\mathbf{r})$ 局域非均匀性的一个指标：\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla \\rho(\\mathbf{r})|}{2 k_F(\\mathbf{r}) \\rho(\\mathbf{r})}\n$$\n其中 $k_F(\\mathbf{r}) = (3\\pi^2 \\rho(\\mathbf{r}))^{1/3}$ 是局域费米波矢。\n\nGGA 泛函相对于 LDA 提供的交换能修正是：\n$$\n\\Delta E_x^{\\mathrm{GGA}} = E_x^{\\mathrm{GGA}} - E_x^{\\mathrm{LDA}} = \\int e_x^{\\mathrm{LDA}}(\\rho) [F_x(s) - 1] \\, d\\mathbf{r}\n$$\n对于一个具有弱非均匀电子密度的体系，例如简单金属，约化梯度 $s$ 在各处都很小 ($s \\ll 1$)。这一物理条件为增强因子 $F_x(s)$ 在 $s=0$ 附近的泰勒级数展开提供了依据：\n$$\nF_x(s) = F_x(0) + \\left.\\frac{dF_x}{ds}\\right|_{s=0} s + \\frac{1}{2} \\left.\\frac{d^2F_x}{ds^2}\\right|_{s=0} s^2 + O(s^3)\n$$\n任何合理的 GGA 泛函都必须满足几个精确的约束条件。首先，在均匀电子气的极限下，$\\nabla\\rho=0$，这意味着 $s=0$。在此极限下，GGA 能量必须精确地恢复到 LDA 能量。这施加了条件 $F_x(0) = 1$。其次，由于空间反演对称性 $(\\mathbf{r} \\to -\\mathbf{r})$，梯度变换为 $\\nabla\\rho \\to -\\nabla\\rho$，但其大小 $|\\nabla\\rho|$ 及 $s$ 保持不变。更正式地说，能量作为一个标量，在反演下必须保持不变，这要求它是梯度的偶函数。因此，展开式中 $s$ 的线性项（以及所有奇次幂项）必须为零。这施加了条件 $\\left.\\frac{dF_x}{ds}\\right|_{s=0} = 0$。\n\n应用这些约束后，泰勒展开简化为：\n$$\nF_x(s) \\approx 1 + \\mu s^2\n$$\n其中系数 $\\mu = \\frac{1}{2} F_x''(0)$ 定义了增强因子在 $s=0$ 处的曲率。这个在 $s$ 的二阶截断的近似被称为二阶梯度展开 (GE2)。对于交换作用，该系数可以从第一性原理推导出来，其值为 $\\mu_{\\mathrm{GE}} = \\frac{10}{81}$。\n\n因此，GE2 交换能密度由 $e_x^{\\mathrm{GE2}}(\\rho, s) \\approx e_x^{\\mathrm{LDA}}(\\rho)(1 + \\mu_{\\mathrm{GE}} s^2)$ 给出。相对于 LDA 的能量修正为：\n$$\n\\Delta E_x^{\\mathrm{GE2}} = \\int e_x^{\\mathrm{LDA}}(\\rho) \\mu_{\\mathrm{GE}} s^2 \\, d\\mathbf{r}\n$$\n代入 $e_x^{\\mathrm{LDA}}(\\rho)$ 的表达式并定义常数 $C = -A_x \\mu_{\\mathrm{GE}}$，我们得到问题中指定的微扰估算式：\n$$\n\\Delta E_x^{\\mathrm{GE2}} \\approx \\int -A_x \\rho^{4/3} \\mu_{\\mathrm{GE}} s^2 \\, d\\mathbf{r} = \\int C s^2 \\rho^{4/3} \\, d\\mathbf{r}\n$$\n此推导将 GE2 修正确立为对于弱变化密度，超越 LDA 的领头阶贡献。\n\n作为对比，PBE 增强因子为 $F_x^{\\mathrm{PBE}}(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu_{\\mathrm{PBE}} s^2 / \\kappa}$。对小 $s$ 进行泰勒展开得到 $F_x^{\\mathrm{PBE}}(s) \\approx 1 + \\mu_{\\mathrm{PBE}} s^2$。因此，PBE 泛函被设计为在小 $s$ 时恢复 GE2 的二次行为，但它使用了不同的系数 $\\mu_{\\mathrm{PBE}} = 0.21951$，这与精确的 GE2 系数 $\\mu_{\\mathrm{GE}} \\approx 0.12345$ 不同。这种重新参数化使 PBE 能够满足其他物理约束，例如 Lieb-Oxford 界。完整的 PBE 修正是无需泰勒展开计算的：\n$$\n\\Delta E_x^{\\mathrm{PBE}} = \\int e_x^{\\mathrm{LDA}}(\\rho) [F_x^{\\mathrm{PBE}}(s) - 1] \\, d\\mathbf{r}\n$$\n\n**2. 数值实现**\n\n通过为一个模型电子密度计算 $\\Delta E_x^{\\mathrm{GE2}}$ 和 $\\Delta E_x^{\\mathrm{PBE}}$ 并进行比较，来进行数值验证。\n空间域是一个边长为 $L$ 的立方晶胞，被离散化为一个均匀的 $N \\times N \\times N$ 网格。网格间距为 $\\Delta x = L/N$，积分的体积元为 $dV = (\\Delta x)^3$。积分 $\\int f(\\mathbf{r}) d\\mathbf{r}$ 通过对所有网格点求和 $\\sum_{i,j,k} f(x_i, y_j, z_k) dV$ 来近似。\n\n模型电子密度由 $\\rho(\\mathbf{r}) = \\rho_0 [1 + \\alpha \\cos(k_x x)\\cos(k_y y)\\cos(k_z z)]$ 给出，其中 $\\rho_0$ 是平均密度。此函数在每个网格点上求值，以获得离散表示 $\\rho_{ijk}$。\n\n每个网格点上的梯度 $\\nabla \\rho$ 使用二阶周期性中心差分格式计算。对于网格索引 $(i,j,k)$ 处的 $x$ 分量：\n$$\n(\\partial_x \\rho)_{ijk} \\approx \\frac{\\rho_{i+1, j, k} - \\rho_{i-1, j, k}}{2 \\Delta x}\n$$\n其中索引是周期性环绕的（例如，$i+1=N$ 变为 $0$，$i-1=-1$ 变为 $N-1$）。类似的表达式适用于 $\\partial_y \\rho$ 和 $\\partial_z \\rho$。根据这些分量，可以计算出梯度的模平方 $|\\nabla \\rho_{ijk}|^2 = (\\partial_x \\rho)_{ijk}^2 + (\\partial_y \\rho)_{ijk}^2 + (\\partial_z \\rho)_{ijk}^2$。\n\n有了 $\\rho_{ijk}$ 和 $|\\nabla \\rho_{ijk}|^2$ 的离散值，就可以在每个网格点上计算约化梯度的平方 $s_{ijk}^2$：\n$$\ns_{ijk}^2 = \\frac{|\\nabla \\rho_{ijk}|^2}{4 (k_{F,ijk})^2 \\rho_{ijk}^2} = \\frac{|\\nabla \\rho_{ijk}|^2}{4 (3\\pi^2 \\rho_{ijk})^{2/3} \\rho_{ijk}^2} = \\frac{|\\nabla \\rho_{ijk}|^2}{4(3\\pi^2)^{2/3} \\rho_{ijk}^{8/3}}\n$$\n最后，在每个网格点上计算 GE2 和 PBE 修正的被积函数 $\\Delta e_{x, ijk}^{\\mathrm{GE2}} = C s_{ijk}^2 \\rho_{ijk}^{4/3}$ 和 $\\Delta e_{x, ijk}^{\\mathrm{PBE}} = e_x^{\\mathrm{LDA}}(\\rho_{ijk}) [F_x^{\\mathrm{PBE}}(s_{ijk}) - 1]$。通过将这些局域能量密度在整个网格上求和，并乘以体积元 $dV$，得到总能量修正 $\\Delta E_x^{\\mathrm{GE2}}$ 和 $\\Delta E_x^{\\mathrm{PBE}}$。然后根据这些积分能量计算相对误差。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main driver function to solve the problem for all test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {'L': 20.0, 'N': 64, 'r_s': 2.0, 'alpha': 0.05, 'n_vec': (1, 1, 1)},\n        # Case 2 (near-uniform boundary)\n        {'L': 20.0, 'N': 64, 'r_s': 2.0, 'alpha': 1e-4, 'n_vec': (1, 1, 1)},\n        # Case 3 (edge case)\n        {'L': 10.0, 'N': 64, 'r_s': 2.0, 'alpha': 0.30, 'n_vec': (4, 4, 4)},\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_E_ge2, delta_E_pbe, rel_err = calculate_corrections(**case)\n        results.extend([delta_E_ge2, delta_E_pbe, rel_err])\n\n    # Format the final output string as required.\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\ndef calculate_corrections(L, N, r_s, alpha, n_vec):\n    \"\"\"\n    Calculates the GE2 and PBE exchange corrections for a single parameter set.\n    \"\"\"\n    # Define constants in atomic units.\n    A_x = (3.0 / 4.0) * (3.0 / np.pi)**(1.0/3.0)\n    MU_GE = 10.0 / 81.0\n    C_GE2 = -A_x * MU_GE\n    \n    # PBE parameters\n    KAPPA_PBE = 0.804\n    MU_PBE = 0.21951\n\n    # Grid setup\n    dx = L / N\n    dV = dx**3\n    grid_1d = np.linspace(0, L, N, endpoint=False)\n    x, y, z = np.meshgrid(grid_1d, grid_1d, grid_1d, indexing='ij')\n\n    # Electron density model\n    rho_0 = 3.0 / (4.0 * np.pi * r_s**3)\n    k_x = 2.0 * np.pi * n_vec[0] / L\n    k_y = 2.0 * np.pi * n_vec[1] / L\n    k_z = 2.0 * np.pi * n_vec[2] / L\n    \n    rho = rho_0 * (1.0 + alpha * np.cos(k_x * x) * np.cos(k_y * y) * np.cos(k_z * z))\n    \n    # Check for non-positive density, though problem constraints prevent this.\n    if np.any(rho = 0):\n        raise ValueError(\"Electron density must be positive everywhere.\")\n\n    # Gradient calculation using periodic central differences\n    grad_rho_x = (np.roll(rho, -1, axis=0) - np.roll(rho, 1, axis=0)) / (2.0 * dx)\n    grad_rho_y = (np.roll(rho, -1, axis=1) - np.roll(rho, 1, axis=1)) / (2.0 * dx)\n    grad_rho_z = (np.roll(rho, -1, axis=2) - np.roll(rho, 1, axis=2)) / (2.0 * dx)\n    \n    grad_rho_mag_sq = grad_rho_x**2 + grad_rho_y**2 + grad_rho_z**2\n    \n    # Reduced gradient s^2 calculation\n    # s^2 = |nabla rho|^2 / (4 * (3*pi^2*rho)^(2/3) * rho^2)\n    # Denominator = 4 * (3*pi^2)^(2/3) * rho^(8/3)\n    c_kf_sq = 4.0 * (3 * np.pi**2)**(2.0/3.0)\n    rho_8_3 = rho**(8.0/3.0)\n    \n    # Avoid division by zero, although not expected for given parameters.\n    s_squared = np.zeros_like(rho)\n    nonzero_mask = rho_8_3 > 0\n    s_squared[nonzero_mask] = grad_rho_mag_sq[nonzero_mask] / (c_kf_sq * rho_8_3[nonzero_mask])\n\n    # LDA exchange energy density\n    rho_4_3 = rho**(4.0/3.0)\n    e_x_lda = -A_x * rho_4_3\n    \n    # GE2 correction calculation\n    integrand_ge2 = C_GE2 * s_squared * rho_4_3\n    delta_E_ge2 = np.sum(integrand_ge2) * dV\n\n    # PBE correction calculation\n    pbe_enhancement_minus_1 = KAPPA_PBE - KAPPA_PBE / (1.0 + MU_PBE * s_squared / KAPPA_PBE)\n    integrand_pbe = e_x_lda * pbe_enhancement_minus_1\n    delta_E_pbe = np.sum(integrand_pbe) * dV\n\n    # Relative error calculation\n    if np.abs(delta_E_pbe) > 1e-15:\n        rel_err = np.abs(delta_E_ge2 - delta_E_pbe) / np.abs(delta_E_pbe)\n    else:\n        # Handle the case where the PBE correction is effectively zero.\n        # If GE2 is also zero, error is 0. Otherwise, infinite.\n        rel_err = 0.0 if np.abs(delta_E_ge2)  1e-15 else np.inf\n\n    return delta_E_ge2, delta_E_pbe, rel_err\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们将把 GGA 泛函的理论和计算知识应用于一个实际的物理问题：预测金属的功函数。功函数是材料表面一个极其重要的性质，它对金属-真空界面的交换相关势非常敏感，因此是检验密度泛函性能的绝佳平台。这个练习将使用一个物理上合理的表面模型，让你能够计算不同晶面的功函数，并理解不同 GGA 泛函如何通过其对梯度修正的不同处理，来预测可测量的材料性质及其各向异性 。",
            "id": "3454004",
            "problem": "您将实现一个基于物理原理、与取向相关的、仅包含交换作用的广义梯度近似（GGA）模型，用以估算钨和铝特定米勒指数表面的金属功函数。任务是计算每个测试用例的预测功函数 $\\Phi_{hkl}$（以电子伏特为单位），并量化各向异性是如何由表面层约化梯度分布 $s(z)$ 以及交换相关势 $v_{xc}(z)$ 向真空中的衰减所产生的。\n\n出发点与建模假设：\n- 使用仅交换的广义梯度近似（GGA）水平的 Kohn–Sham 密度泛函理论（DFT）。本练习中忽略相关作用；这一点必须明确说明并在整个过程中保持一致。\n- 将表面建模为一维半无限均匀电子气，其平面界面位于 $z = 0$：\n  - 对于 $z  0$ 的区域，体电子密度 $n_b$ 为常数。\n  - 对于 $z \\ge 0$ 的区域，电子密度呈指数衰减，由 $n(z) = n_b e^{-\\kappa z}$ 给出，其中 $\\kappa$ 是一个与取向相关的衰减参数。\n- 通过仅交换关系式近似金属功函数：\n  $$ \\Phi_{hkl} \\approx \\varepsilon_F(n_b) + v_{x}^{\\mathrm{eff}}, $$\n  其中 $\\varepsilon_F(n_b)$ 是体均匀电子气的费米能（以原子单位计），$v_x^{\\mathrm{eff}}$ 是与表面层密度尾部相关的有效仅交换 Kohn–Sham 势降。\n- 在原子单位（哈特里原子单位）中，费米能为：\n  $$ \\varepsilon_F(n) = \\frac{1}{2} \\left(3 \\pi^2 n\\right)^{2/3}. $$\n- 使用局域密度近似（LDA）的交换势：\n  $$ v_x^{\\mathrm{LDA}}(n) = - C_x n^{1/3}, \\quad C_x = \\left(\\frac{3}{\\pi}\\right)^{1/3}. $$\n- 使用约化梯度：\n  $$ s(z) = \\frac{|\\nabla n(z)|}{2 k_F(z) n(z)}, \\quad k_F(z) = \\left(3 \\pi^2 n(z)\\right)^{1/3}. $$\n- 将仅交换的 GGA 势近似为：\n  $$ v_x^{\\mathrm{GGA}}(n, s) \\approx v_x^{\\mathrm{LDA}}(n) \\, F_x(s), $$\n  其中 $F_x(s)$ 是 GGA 交换增强因子。\n- 将有效交换势降定义为表面层加权平均值：\n  $$ v_{x}^{\\mathrm{eff}} = \\frac{\\displaystyle \\int_0^{z_{\\max}} w(z) \\, v_x^{\\mathrm{GGA}}\\!\\left(n(z), s(z)\\right) \\, dz}{\\displaystyle \\int_0^{z_{\\max}} w(z) \\, dz}, \\quad w(z) = \\kappa e^{-\\kappa z}, $$\n  其中 $z_{\\max} = 12/\\kappa$ 以确保尾部积分的数值收敛。\n\n与取向相关的衰减参数：\n- 对于晶格常数为 $a$（以玻尔半径为单位）的立方晶格，米勒指数为 $(hkl)$ 的晶面间距为：\n  $$ d_{hkl} = \\frac{a}{\\sqrt{h^2 + k^2 + l^2}}. $$\n- 使用材料特定的比例因子 $\\alpha$ 来设定：\n  $$ \\kappa_{hkl} = \\frac{\\alpha}{d_{hkl}}, $$\n  其中 $\\kappa$ 的单位为玻尔半径的倒数。\n\nGGA 交换增强因子：\n- 实现以下增强因子族，其满足小 $s$ 展开式 $F_x(s) = 1 + \\mu s^2 + O(s^4)$ 并在 $s \\to \\infty$ 时饱和至 $1 + \\kappa$：\n  $$ F_x(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu s^2 / \\kappa}. $$\n- 所选泛函的参数：\n  - Perdew–Burke–Ernzerhof (PBE): 使用 $\\mu = 0.21951$，$\\kappa = 0.804$。\n  - Perdew–Wang 1991 (PW91): 使用 $\\mu = 0.19645$，$\\kappa = 0.804$。\n  - Revised Perdew–Burke–Ernzerhof for solids (PBEsol): 使用 $\\mu = 10/81$，$\\kappa = 0.804$。\n\n材料参数：\n- 晶格常数（单位为埃），需转换为玻尔半径 ($1 \\, \\mathrm{\\AA} = 1.889726125 \\, a_0$)：\n  - 钨 (W): $a_{\\mathrm{W}} = 3.165 \\, \\mathrm{\\AA}$。\n  - 铝 (Al): $a_{\\mathrm{Al}} = 4.049 \\, \\mathrm{\\AA}$。\n- 用于计算体电子密度 $n_b$ 的均匀电子气密度参数（Wigner–Seitz 半径，单位为玻尔半径）：\n  $$ n_b = \\frac{3}{4 \\pi r_s^3}. $$\n  - 钨 (W): $r_{s,\\mathrm{W}} = 2.30$。\n  - 铝 (Al): $r_{s,\\mathrm{Al}} = 2.07$。\n- 用于指数衰减尾部的表面衰减比例因子（无量纲）：\n  - 钨 (W): $\\alpha_{\\mathrm{W}} = 2.0$。\n  - 铝 (Al): $\\alpha_{\\mathrm{Al}} = 1.2$。\n\n单位与数值细节：\n- 所有内部量均以原子单位计算，然后使用 $1 \\, \\mathrm{Hartree} = 27.211386245988 \\, \\mathrm{eV}$ 将最终的 $\\Phi_{hkl}$ 转换为电子伏特。\n- 对 $z \\in [0, z_{\\max}]$ 使用均匀网格，数值积分时至少采用 $N = 4096$ 个点。\n- 对每个测试用例，报告以 eV 为单位的功函数，结果四舍五入到三位小数。\n\n测试组：\n- 用例 1: W, $(110)$, PBE。\n- 用例 2: W, $(100)$, PBEsol。\n- 用例 3: W, $(111)$, PW91。\n- 用例 4: W, $(210)$, PBE。\n- 用例 5: Al, $(111)$, PBEsol。\n- 用例 6: Al, $(100)$, PBE。\n- 用例 7: Al, $(110)$, PW91。\n- 用例 8: Al, $(311)$, PBE。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含八个计算出的功函数（以 eV 为单位），形式为用方括号括起来的逗号分隔列表，并按照上述测试组的顺序排列。例如，输出行必须如下所示：\n  $$ [\\phi_1,\\phi_2,\\phi_3,\\phi_4,\\phi_5,\\phi_6,\\phi_7,\\phi_8] $$\n  其中每个 $\\phi_i$ 是一个四舍五入到三位的小数值。该输出必须是唯一打印的行。",
            "solution": "所提出的问题是计算材料物理学中一个有效的练习。它定义了一个自洽、简化的模型，该模型基于仅交换的密度泛函理论（DFT）框架下的广义梯度近似（GGA），用于计算金属表面的功函数。所有必需的物理参数、数学公式和计算指令都已提供，构成了一个适定问题。使用单个符号 $\\kappa$ 来表示两个不同的物理量——密度衰减参数和 GGA 泛函参数——是一个微小的符号歧义，可以通过上下文和谨慎的实现来解决。我们将着手进行详细的求解。\n\n目标是使用所提供的模型计算特定金属表面的功函数 $\\Phi_{hkl}$。求解过程是通过在原子单位（哈特里单位：$\\hbar=m_e=e=4\\pi\\epsilon_0=1$）中系统地评估模型的每个组成部分，然后将最终结果转换为电子伏特（eV）来构建的。\n\n在此模型中，功函数近似为：\n$$ \\Phi_{hkl} \\approx \\varepsilon_F(n_b) + v_{x}^{\\mathrm{eff}} $$\n此处，$\\varepsilon_F(n_b)$ 是体材料的费米能，它取决于体电子密度 $n_b$。项 $v_x^{\\mathrm{eff}}$ 是一个有效表面势，代表了金属-真空界面处势阶的仅交换贡献。该项通过表面电子密度分布引入了功函数的取向依赖性。请注意，根据问题陈述，相关效应被明确忽略。\n\n计算按以下步骤进行：\n\n1.  **材料和几何参数的确定**：\n    模型的各向异性源于电子密度向真空中与取向相关的衰减。这由衰减参数 $\\kappa_{hkl}$ 控制，该参数取决于给定米勒指数 $(h,k,l)$ 的晶面间距 $d_{hkl}$。对于晶格常数为 $a$ 的立方晶格，该间距为：\n    $$ d_{hkl} = \\frac{a}{\\sqrt{h^2 + k^2 + l^2}} $$\n    衰减参数随之定义为：\n    $$ \\kappa_{hkl} = \\frac{\\alpha}{d_{hkl}} $$\n    其中 $\\alpha$ 是一个特定于材料的无量纲比例因子。晶格常数 $a$ 必须使用转换因子 $1 \\, \\mathrm{\\AA} = 1.889726125 \\, a_0$ 从埃（$\\mathrm{\\AA}$）转换为玻尔半径（$a_0$）。\n\n2.  **体电子性质的计算**：\n    体性质由 Wigner-Seitz 半径 $r_s$ 确定，它在均匀电子气模型中定义了体电子密度 $n_b$：\n    $$ n_b = \\frac{3}{4 \\pi r_s^3} $$\n    根据体密度，我们计算体费米波矢 $k_{F,b}$ 和相应的费米动能 $\\varepsilon_F(n_b)$：\n    $$ k_{F,b} = (3 \\pi^2 n_b)^{1/3} $$\n    $$ \\varepsilon_F(n_b) = \\frac{1}{2} k_{F,b}^2 $$\n\n3.  **表面密度和梯度的建模**：\n    电子密度 $n(z)$ 在体内（$z  0$）被建模为常数，并向真空中（$z \\ge 0$）指数衰减：\n    $$ n(z) = n_b e^{-\\kappa_{hkl} z} $$\n    GGA 泛函的一个关键要素是约化密度梯度 $s(z)$。其定义为：\n    $$ s(z) = \\frac{|\\nabla n(z)|}{2 k_F(z) n(z)} $$\n    其中 $k_F(z) = (3 \\pi^2 n(z))^{1/3}$。对于我们的指数密度分布，梯度大小为 $|\\nabla n(z)| = \\kappa_{hkl} n(z)$。局域费米波矢变为 $k_F(z) = k_{F,b} e^{-\\kappa_{hkl} z / 3}$。将这些代入 $s(z)$ 的定义，得到一个随离表面距离 $z$ 指数增长的简化表达式：\n    $$ s(z) = \\frac{\\kappa_{hkl} n(z)}{2 (k_{F,b} e^{-\\kappa_{hkl} z/3}) n(z)} = \\frac{\\kappa_{hkl}}{2 k_{F,b}} e^{\\kappa_{hkl} z / 3} $$\n\n4.  **交换势的计算**：\n    GGA 交换势 $v_x^{\\mathrm{GGA}}$ 是通过将增强因子 $F_x(s)$ 应用于局域密度近似（LDA）势 $v_x^{\\mathrm{LDA}}$ 来构建的。LDA 势仅取决于局域密度：\n    $$ v_x^{\\mathrm{LDA}}(n) = -C_x n^{1/3}, \\quad \\text{其中} \\quad C_x = \\left(\\frac{3}{\\pi}\\right)^{1/3} $$\n    对于我们的表面分布，这变为 $v_x^{\\mathrm{LDA}}(z) = v_x^{\\mathrm{LDA}}(n_b) e^{-\\kappa_{hkl} z / 3}$。\n\n    增强因子 $F_x(s)$ 引入了梯度修正。问题指定了以下函数形式，其中我们使用 $\\kappa_{GGA}$ 表示 GGA 参数，以区别于衰减常数 $\\kappa_{hkl}$：\n    $$ F_x(s) = 1 + \\kappa_{GGA} - \\frac{\\kappa_{GGA}}{1 + \\mu s^2 / \\kappa_{GGA}} $$\n    参数 $\\mu$ 和 $\\kappa_{GGA}$ 特定于所选的泛函（PBE、PW91 或 PBEsol）。作为 $z$ 的函数的完整 GGA 交换势则为：\n    $$ v_x^{\\mathrm{GGA}}(z) = v_x^{\\mathrm{LDA}}(n(z)) \\, F_x(s(z)) $$\n\n5.  **有效表面势的计算**：\n    项 $v_x^{\\mathrm{eff}}$ 定义为 GGA 交换势在表面区域（从 $z=0$ 到截断距离 $z_{\\max} = 12/\\kappa_{hkl}$）上的加权平均：\n    $$ v_{x}^{\\mathrm{eff}} = \\frac{\\displaystyle \\int_0^{z_{\\max}} w(z) \\, v_x^{\\mathrm{GGA}}(z) \\, dz}{\\displaystyle \\int_0^{z_{\\max}} w(z) \\, dz} $$\n    权重函数由 $w(z) = \\kappa_{hkl} e^{-\\kappa_{hkl} z}$ 给出。分母中的积分可以解析地计算：\n    $$ \\int_0^{z_{\\max}} \\kappa_{hkl} e^{-\\kappa_{hkl} z} \\, dz = \\left[-e^{-\\kappa_{hkl} z}\\right]_0^{z_{\\max}} = 1 - e^{-\\kappa_{hkl} z_{\\max}} = 1 - e^{-12} $$\n    分子中的积分包含复杂的 $v_x^{\\mathrm{GGA}}(z)$ 项，必须进行数值计算。我们在区间 $[0, z_{\\max}]$ 上为 $z$ 建立一个包含 $N=4096$ 个点的均匀网格，并使用梯形法则进行积分。\n\n6.  **最终组装与单位转换**：\n    在所有分量都以原子单位计算完毕后，功函数为：\n    $$ \\Phi_{hkl} [\\text{Hartree}] = \\varepsilon_F(n_b) + v_x^{\\mathrm{eff}} $$\n    最终结果使用转换因子 $1 \\, \\text{Hartree} = 27.211386245988 \\, \\text{eV}$ 转换为电子伏特。然后按要求将该值四舍五入到三位小数。对八个测试用例中的每一个都重复整个过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the metallic work function for specified surfaces using a simplified\n    exchange-only GGA model.\n    \"\"\"\n\n    # --- Constants and Conversion Factors (in atomic units) ---\n    A_to_BOHR = 1.889726125\n    HARTREE_to_EV = 27.211386245988\n    \n    # --- Material and Functional Parameters ---\n    \n    # Material properties\n    MATERIALS = {\n        'W': {'a_A': 3.165, 'rs': 2.30, 'alpha': 2.0},\n        'Al': {'a_A': 4.049, 'rs': 2.07, 'alpha': 1.2},\n    }\n\n    # GGA functional parameters (mu, kappa_gga)\n    # Using 'kappa_gga' to distinguish from the density decay parameter 'kappa_decay'.\n    FUNCTIONALS = {\n        'PBE': {'mu': 0.21951, 'kappa_gga': 0.804},\n        'PW91': {'mu': 0.19645, 'kappa_gga': 0.804},\n        'PBEsol': {'mu': 10.0 / 81.0, 'kappa_gga': 0.804},\n    }\n\n    # --- Test Suite ---\n    test_cases = [\n        # (Material, Miller indices (h,k,l), Functional name)\n        ('W', (1, 1, 0), 'PBE'),\n        ('W', (1, 0, 0), 'PBEsol'),\n        ('W', (1, 1, 1), 'PW91'),\n        ('W', (2, 1, 0), 'PBE'),\n        ('Al', (1, 1, 1), 'PBEsol'),\n        ('Al', (1, 0, 0), 'PBE'),\n        ('Al', (1, 1, 0), 'PW91'),\n        ('Al', (3, 1, 1), 'PBE'),\n    ]\n\n    # --- Numerical Parameters ---\n    N_POINTS = 4096\n\n    results = []\n    \n    for material, hkl, functional_name in test_cases:\n        \n        # 1. Select parameters for the current case\n        mat_props = MATERIALS[material]\n        func_params = FUNCTIONALS[functional_name]\n        \n        a_bohr = mat_props['a_A'] * A_to_BOHR\n        rs = mat_props['rs']\n        alpha = mat_props['alpha']\n        mu = func_params['mu']\n        kappa_gga = func_params['kappa_gga']\n        \n        h, k, l = hkl\n        \n        # 2. Calculate geometric and decay parameters\n        if h == 0 and k == 0 and l == 0:\n            # Avoid division by zero, though not present in test cases\n            d_hkl = np.inf \n        else:\n            d_hkl = a_bohr / np.sqrt(h**2 + k**2 + l**2)\n\n        kappa_decay = alpha / d_hkl\n        \n        # 3. Calculate bulk electronic properties\n        n_b = 3.0 / (4.0 * np.pi * rs**3)\n        kF_b = (3.0 * np.pi**2 * n_b)**(1.0 / 3.0)\n        epsilon_F = 0.5 * kF_b**2\n        \n        # 4. Set up numerical integration grid\n        z_max = 12.0 / kappa_decay\n        z = np.linspace(0, z_max, N_POINTS)\n        \n        # 5. Define and evaluate z-dependent functions on the grid\n        \n        # Reduced density gradient, s(z)\n        s_z = (kappa_decay / (2.0 * kF_b)) * np.exp(kappa_decay * z / 3.0)\n        \n        # LDA exchange potential, v_x^LDA(z)\n        C_x = (3.0 / np.pi)**(1.0 / 3.0)\n        vx_lda_z = -C_x * (n_b)**(1.0 / 3.0) * np.exp(-kappa_decay * z / 3.0)\n        \n        # GGA enhancement factor, F_x(s)\n        Fx_s = 1.0 + kappa_gga - kappa_gga / (1.0 + mu * s_z**2 / kappa_gga)\n        \n        # GGA exchange potential, v_x^GGA(z)\n        vx_gga_z = vx_lda_z * Fx_s\n        \n        # 6. Calculate the effective exchange potential v_x^eff\n        \n        # Weighting function w(z)\n        w_z = kappa_decay * np.exp(-kappa_decay * z)\n        \n        # Numerator of v_x^eff is the integral of w(z) * v_x^GGA(z)\n        numerator_integral = np.trapz(w_z * vx_gga_z, z)\n        \n        # Denominator of v_x^eff is the integral of w(z)\n        denominator_integral = 1.0 - np.exp(-12.0)\n        \n        vx_eff = numerator_integral / denominator_integral\n        \n        # 7. Calculate the work function and convert to eV\n        phi_hkl_hartree = epsilon_F + vx_eff\n        phi_hkl_ev = phi_hkl_hartree * HARTREE_to_EV\n        \n        results.append(round(phi_hkl_ev, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}