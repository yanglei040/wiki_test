{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a foundational look at the structure of the Dual Weighted Residual (DWR) error estimator. By working through a simple one-dimensional problem, you will see how the total error in a quantity of interest is precisely decomposed into a sum of local residuals over element interiors and jumps across element faces, each weighted by the corresponding value of the dual solution. Completing this practice will build a concrete understanding of the anatomy of the DWR error representation formula .",
            "id": "3400751",
            "problem": "Consider the second-order elliptic model problem in one spatial dimension. Let the domain be $\\Omega=(0,1)$ and consider the primal boundary value problem\n$$-u'' = f \\quad \\text{in } \\Omega,\\qquad u(0)=0,\\quad u(1)=0,$$\nwith load $f(x)=1$. Let $V:=H^{1}_{0}(\\Omega)$ and let $V_{h}\\subset V$ be the conforming piecewise-linear finite element space associated with the uniform partition $\\mathcal{T}_{h}=\\{[0,\\tfrac{1}{3}],[\\tfrac{1}{3},\\tfrac{2}{3}],[\\tfrac{2}{3},1]\\}$, having nodes at $x_{0}=0$, $x_{1}=\\tfrac{1}{3}$, $x_{2}=\\tfrac{2}{3}$, $x_{3}=1$. Denote by $\\mathcal{E}_{h}$ the set of interior faces (in one dimension, the interior nodes) $\\{\\tfrac{1}{3},\\tfrac{2}{3}\\}$. Let $u_{h}\\in V_{h}$ be the Galerkin finite element solution of the primal problem.\n\nDefine the goal functional $J:V\\to\\mathbb{R}$ by $J(v)=v(\\tfrac{1}{2})$. Consider the adjoint (dual) problem: find $z\\in V$ such that\n$$\\int_{0}^{1} w'(x)\\,z'(x)\\,dx=J(w)\\quad\\text{for all } w\\in V.$$\nThis adjoint admits the strong form $-z''=\\delta_{\\tfrac{1}{2}}$ in $\\Omega$ with $z(0)=0$ and $z(1)=0$, where $\\delta_{\\tfrac{1}{2}}$ is the Dirac distribution at $x=\\tfrac{1}{2}$.\n\nFrom first principles, using the residual and jump decomposition on the mesh $\\mathcal{T}_{h}$, define local dual weights $\\tilde{z}_{h}$ restricted to elements and faces as follows:\n- For each element $K\\in\\mathcal{T}_{h}$, take $\\tilde{z}_{h}|_{K}:=z|_{K}$.\n- For each interior face $E\\in\\mathcal{E}_{h}$, take $\\tilde{z}_{h}|_{E}:=z(E)$.\n\nConstruct local goal-oriented indicators for elements and faces using the Dual Weighted Residuals (DWR) principle:\n- For each element $K\\in\\mathcal{T}_{h}$, set $\\eta_{K}:=\\int_{K}\\left(f+u_{h}''\\right)\\,\\tilde{z}_{h}\\,dx$.\n- For each interior face $E\\in\\mathcal{E}_{h}$, set $\\eta_{E}:=-\\left[\\!\\left[u_{h}'\\right]\\!\\right]_{E}\\,\\tilde{z}_{h}|_{E}$, where $\\left[\\!\\left[u_{h}'\\right]\\!\\right]_{E}$ denotes the jump of the derivative across $E$ oriented by outward normals of adjacent elements.\n\nAssuming the exact dual $z$ is used to define the local dual weights as above, compute the global estimator\n$$\\eta:=\\sum_{K\\in\\mathcal{T}_{h}}\\eta_{K}+\\sum_{E\\in\\mathcal{E}_{h}}\\eta_{E},$$\nfully from the given data, and provide its exact value as a single real number. No rounding is required; provide the exact result.",
            "solution": "The user wants me to compute the value of a goal-oriented error estimator, $\\eta$, for a one-dimensional elliptic boundary value problem solved with the finite element method.\n\nThe problem is deemed valid as it is scientifically grounded in the theory of numerical analysis for PDEs, specifically a posteriori error estimation using Dual Weighted Residuals (DWR). It is well-posed, objective, and contains all necessary information to compute a unique solution.\n\nThe global estimator $\\eta$ is defined as the sum of local element indicators $\\eta_K$ and local face indicators $\\eta_E$:\n$$\n\\eta = \\sum_{K\\in\\mathcal{T}_{h}}\\eta_{K}+\\sum_{E\\in\\mathcal{E}_{h}}\\eta_{E}\n$$\nwhere\n$$\n\\eta_{K}:=\\int_{K}\\left(f+u_{h}''\\right)\\,\\tilde{z}_{h}\\,dx \\quad \\text{and} \\quad \\eta_{E}:=-\\left[\\!\\left[u_{h}'\\right]\\!\\right]_{E}\\,\\tilde{z}_{h}|_{E}\n$$\nThe calculation proceeds in several steps:\n1.  Find the exact dual solution $z(x)$.\n2.  Find the finite element solution $u_h(x)$.\n3.  Compute the element indicators $\\eta_K$.\n4.  Compute the face indicators $\\eta_E$.\n5.  Sum all indicators to find $\\eta$.\n\n**Step 1: Determine the exact dual solution $z(x)$**\nThe dual problem is given in strong form as:\n$$\n-z'' = \\delta_{\\frac{1}{2}} \\quad \\text{in } \\Omega=(0,1), \\qquad z(0)=0, \\quad z(1)=0\n$$\nwhere $\\delta_{\\frac{1}{2}}$ is the Dirac distribution centered at $x=\\frac{1}{2}$. This is the Green's function for the negative second derivative operator on $(0,1)$ with homogeneous Dirichlet boundary conditions. The solution is continuous and piecewise linear.\n\nFor $x \\neq \\frac{1}{2}$, we have $z''(x)=0$, so $z(x)$ is linear on each subinterval $(0, \\frac{1}{2})$ and $(\\frac{1}{2}, 1)$.\nApplying the boundary conditions:\n-   For $x \\in [0, \\frac{1}{2}]$, $z(x) = C_1 x$.\n-   For $x \\in [\\frac{1}{2}, 1]$, $z(x) = C_2(1-x)$.\n\nContinuity at $x=\\frac{1}{2}$ requires $C_1(\\frac{1}{2}) = C_2(1-\\frac{1}{2})$, which implies $C_1=C_2$.\n\nThe jump condition on the first derivative at $x=\\frac{1}{2}$ is obtained by integrating $-z''=\\delta_{\\frac{1}{2}}$ over a small interval $[\\frac{1}{2}-\\epsilon, \\frac{1}{2}+\\epsilon]$:\n$$\n\\int_{\\frac{1}{2}-\\epsilon}^{\\frac{1}{2}+\\epsilon} -z'' dx = 1 \\implies [-z']_{\\frac{1}{2}-\\epsilon}^{\\frac{1}{2}+\\epsilon} = 1 \\implies z'(\\tfrac{1}{2}^{-}) - z'(\\tfrac{1}{2}^{+}) = 1\n$$\nThe derivatives are $z'(x) = C_1$ for $x < \\frac{1}{2}$ and $z'(x) = -C_2$ for $x > \\frac{1}{2}$.\nThe jump condition becomes $C_1 - (-C_2) = 1$, so $C_1 + C_2 = 1$.\nWith $C_1=C_2$, we get $2C_1 = 1$, so $C_1=C_2=\\frac{1}{2}$.\nThe dual solution is:\n$$\nz(x) = \\begin{cases} \\frac{1}{2}x & \\text{if } 0 \\le x \\le \\frac{1}{2} \\\\ \\frac{1}{2}(1-x) & \\text{if } \\frac{1}{2} \\le x \\le 1 \\end{cases}\n$$\n\n**Step 2: Determine the finite element solution $u_h(x)$**\nThe space $V_h$ consists of continuous piecewise linear functions on the uniform mesh with nodes $x_0=0$, $x_1=\\frac{1}{3}$, $x_2=\\frac{2}{3}$, $x_3=1$. The solution is $u_h(x) = U_1\\phi_1(x) + U_2\\phi_2(x)$, where $\\phi_1, \\phi_2$ are the hat basis functions at the interior nodes $x_1, x_2$, and $U_i = u_h(x_i)$. The Galerkin system is $A\\mathbf{U}=\\mathbf{b}$, where $h = \\frac{1}{3}$ is the mesh size.\nThe stiffness matrix $A$ and load vector $\\mathbf{b}$ are:\n$$\nA = \\frac{1}{h}\\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix} = 3\\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix} = \\begin{pmatrix} 6 & -3 \\\\ -3 & 6 \\end{pmatrix}\n$$\n$$\nb_i = \\int_0^1 f(x)\\phi_i(x) dx = \\int_0^1 \\phi_i(x) dx = \\text{Area}(\\phi_i) = h = \\frac{1}{3}\n$$\nThe system to solve is:\n$$\n\\begin{pmatrix} 6 & -3 \\\\ -3 & 6 \\end{pmatrix} \\begin{pmatrix} U_1 \\\\ U_2 \\end{pmatrix} = \\begin{pmatrix} 1/3 \\\\ 1/3 \\end{pmatrix}\n$$\nBy symmetry, $U_1=U_2$. The first equation gives $6U_1 - 3U_1 = \\frac{1}{3}$, so $3U_1 = \\frac{1}{3}$, which yields $U_1 = \\frac{1}{9}$.\nThus, $u_h(\\frac{1}{3})=\\frac{1}{9}$ and $u_h(\\frac{2}{3})=\\frac{1}{9}$.\nThe finite element solution $u_h(x)$ is given by the points $(0,0), (\\frac{1}{3}, \\frac{1}{9}), (\\frac{2}{3}, \\frac{1}{9}), (1,0)$. The first derivative $u_h'(x)$ is piecewise constant:\n$$\nu_h'(x) = \\begin{cases} \\frac{1/9}{1/3} = \\frac{1}{3} & \\text{if } x \\in (0, 1/3) \\\\ \\frac{1/9 - 1/9}{1/3} = 0 & \\text{if } x \\in (1/3, 2/3) \\\\ \\frac{0 - 1/9}{1/3} = -\\frac{1}{3} & \\text{if } x \\in (2/3, 1) \\end{cases}\n$$\n\n**Step 3: Compute the element indicators $\\eta_K$**\nThe local dual weight on an element is $\\tilde{z}_h|_K = z|_K$. Since $u_h$ is linear on each element $K$, $u_h''=0$ inside $K$. With $f=1$, the element indicator is:\n$$\n\\eta_{K} = \\int_{K} (1+0) z(x) dx = \\int_K z(x) dx\n$$\n-   For $K_1=[0, \\frac{1}{3}]$:\n    $\\eta_{K_1} = \\int_0^{1/3} \\frac{1}{2}x dx = \\left[\\frac{x^2}{4}\\right]_0^{1/3} = \\frac{1}{4}\\left(\\frac{1}{3}\\right)^2 = \\frac{1}{36}$.\n-   For $K_2=[\\frac{1}{3}, \\frac{2}{3}]$:\n    $\\eta_{K_2} = \\int_{1/3}^{2/3} z(x) dx = \\int_{1/3}^{1/2} \\frac{1}{2}x dx + \\int_{1/2}^{2/3} \\frac{1}{2}(1-x) dx$\n    $= \\left[\\frac{x^2}{4}\\right]_{1/3}^{1/2} + \\left[\\frac{x}{2}-\\frac{x^2}{4}\\right]_{1/2}^{2/3}$\n    $= \\left(\\frac{1}{16}-\\frac{1}{36}\\right) + \\left(\\left(\\frac{1}{3}-\\frac{1}{9}\\right) - \\left(\\frac{1}{4}-\\frac{1}{16}\\right)\\right)$\n    $= \\frac{5}{144} + \\left(\\frac{2}{9} - \\frac{3}{16}\\right) = \\frac{5}{144} + \\frac{32-27}{144} = \\frac{5}{144} + \\frac{5}{144} = \\frac{10}{144} = \\frac{5}{72}$.\n-   For $K_3=[\\frac{2}{3}, 1]$: By symmetry with $K_1$, $\\eta_{K_3}=\\eta_{K_1}=\\frac{1}{36}$.\n\nThe sum of element indicators is:\n$$\n\\sum_{K\\in\\mathcal{T}_{h}}\\eta_K = \\frac{1}{36} + \\frac{5}{72} + \\frac{1}{36} = \\frac{2}{72} + \\frac{5}{72} + \\frac{2}{72} = \\frac{9}{72} = \\frac{1}{8}\n$$\n\n**Step 4: Compute the face indicators $\\eta_E$**\nThe interior faces are $E_1=\\{\\frac{1}{3}\\}$ and $E_2=\\{\\frac{2}{3}\\}$. The local dual weight on a face is $\\tilde{z}_h|_E = z(E)$. The jump $\\left[\\!\\left[u_h'\\right]\\!\\right]_{E}$ is specified as \"oriented by outward normals\". For a face $E=x_i$ between elements $K_L$ and $K_R$, this defines the jump as $\\left[\\!\\left[v\\right]\\!\\right]_{x_i} = v(x_i^-)n_L + v(x_i^+)n_R = v(x_i^-)(+1) + v(x_i^+)(-1) = v(x_i^-) - v(x_i^+)$.\n\n-   For $E_1=\\{\\frac{1}{3}\\}$:\n    $z(\\frac{1}{3}) = \\frac{1}{2}(\\frac{1}{3}) = \\frac{1}{6}$.\n    $\\left[\\!\\left[u_h'\\right]\\!\\right]_{1/3} = u_h'(\\tfrac{1}{3}^-) - u_h'(\\tfrac{1}{3}^+) = \\frac{1}{3} - 0 = \\frac{1}{3}$.\n    $\\eta_{E_1} = - \\left[\\!\\left[u_h'\\right]\\!\\right]_{1/3} z(\\tfrac{1}{3}) = -\\left(\\frac{1}{3}\\right)\\left(\\frac{1}{6}\\right) = -\\frac{1}{18}$.\n-   For $E_2=\\{\\frac{2}{3}\\}$:\n    $z(\\frac{2}{3}) = \\frac{1}{2}(1-\\frac{2}{3}) = \\frac{1}{6}$.\n    $\\left[\\!\\left[u_h'\\right]\\!\\right]_{2/3} = u_h'(\\tfrac{2}{3}^-) - u_h'(\\tfrac{2}{3}^+) = 0 - (-\\frac{1}{3}) = \\frac{1}{3}$.\n    $\\eta_{E_2} = - \\left[\\!\\left[u_h'\\right]\\!\\right]_{2/3} z(\\tfrac{2}{3}) = -\\left(\\frac{1}{3}\\right)\\left(\\frac{1}{6}\\right) = -\\frac{1}{18}$.\n\nThe sum of face indicators is:\n$$\n\\sum_{E\\in\\mathcal{E}_{h}}\\eta_E = -\\frac{1}{18} - \\frac{1}{18} = -\\frac{2}{18} = -\\frac{1}{9}\n$$\n\n**Step 5: Compute the global estimator $\\eta$**\nThe global estimator is the sum of the element and face contributions:\n$$\n\\eta = \\sum_{K\\in\\mathcal{T}_{h}}\\eta_K + \\sum_{E\\in\\mathcal{E}_{h}}\\eta_E = \\frac{1}{8} + \\left(-\\frac{1}{9}\\right) = \\frac{1}{8} - \\frac{1}{9} = \\frac{9-8}{72} = \\frac{1}{72}\n$$\nThis result is consistent with the DWR identity, which states that for this choice of weights, the estimator $\\eta$ is equal to the error in the goal functional, $J(u) - J(u_h)$. The exact solution is $u(x)=\\frac{1}{2}x(1-x)$, so $J(u)=u(\\frac{1}{2})=\\frac{1}{8}$. The FE solution is $u_h(x)=\\frac{1}{9}$ on the middle element, so $J(u_h)=u_h(\\frac{1}{2})=\\frac{1}{9}$. The error is $J(u)-J(u_h) = \\frac{1}{8}-\\frac{1}{9}=\\frac{1}{72}$.",
            "answer": "$$\\boxed{\\frac{1}{72}}$$"
        },
        {
            "introduction": "Beyond estimating numerical discretization error, the adjoint methodology is a powerful and general tool for sensitivity analysis. This practice explores how the dual solution quantifies the impact of perturbations in the problem's input data—such as an uncertain source term—on a specific output functional. This exercise demonstrates that the adjoint solution acts as a sensitivity map, revealing the broader utility of the dual problem in fields like optimal design, control, and uncertainty quantification .",
            "id": "3400748",
            "problem": "Consider the scalar diffusion model problem on the interval $\\Omega=(0,1)$ with homogeneous Dirichlet boundary conditions: find $u(f) \\in V := H_{0}^{1}(0,1)$ such that\n$$\n\\int_{0}^{1} u'(x)\\, v'(x)\\, dx \\;=\\; \\int_{0}^{1} f(x)\\, v(x)\\, dx\n\\quad \\text{for all } v \\in V.\n$$\nLet the goal functional be the spatial average of the state,\n$$\nJ(u) \\;=\\; \\int_{0}^{1} u(x)\\, dx,\n$$\nand suppose the right-hand side data $f$ is uncertain and can be written as $f = \\widehat{f} + \\delta f$, where $\\widehat{f}$ is a fixed reference and the data perturbation $\\delta f$ is given by\n$$\n\\delta f(x) \\;=\\; \\beta \\;+\\; \\eta \\, \\sin(\\pi x),\n$$\nwith $\\beta,\\eta \\in \\mathbb{R}$.\n\nUsing first principles of linearization, treat $J(u(f))$ as a functional of $f$ through the state equation, and derive the first-order variation of the goal, $\\delta J_{\\mathrm{data}}$, with respect to the data perturbation $\\delta f$. Introduce the adjoint $z \\in V$ through the variational identity\n$$\n\\int_{0}^{1} v'(x)\\, z'(x)\\, dx \\;=\\; J'(u(\\widehat{f}))[v]\n\\quad \\text{for all } v \\in V,\n$$\nand express $\\delta J_{\\mathrm{data}}$ in terms of $\\delta f$ and $z$ by systematically eliminating the state variation via the adjoint. Then, compute $\\delta J_{\\mathrm{data}}$ in closed form for the specified $\\delta f(x) = \\beta + \\eta \\sin(\\pi x)$ by solving the adjoint problem explicitly.\n\nProvide your final answer as a single closed-form analytic expression in terms of $\\beta$ and $\\eta$. Do not include units. No rounding is required.",
            "solution": "The user wants me to critically validate and then solve a problem from the field of numerical analysis of partial differential equations, specifically concerning goal-oriented error control with dual weighted residuals.\n\n### Step 1: Extract Givens\n- **Domain**: $\\Omega=(0,1)$.\n- **Function Space**: $V := H_{0}^{1}(0,1)$, the Sobolev space of functions with square-integrable first weak derivatives that are zero at the boundary.\n- **State Equation (Weak Form)**: Find $u(f) \\in V$ such that $\\int_{0}^{1} u'(x)\\, v'(x)\\, dx = \\int_{0}^{1} f(x)\\, v(x)\\, dx$ for all $v \\in V$.\n- **Goal Functional**: $J(u) = \\int_{0}^{1} u(x)\\, dx$.\n- **Data Perturbation**: The right-hand side data is $f = \\widehat{f} + \\delta f$, where $\\widehat{f}$ is a reference and $\\delta f(x) = \\beta + \\eta \\sin(\\pi x)$ with $\\beta, \\eta \\in \\mathbb{R}$.\n- **Adjoint Equation (Weak Form)**: Find $z \\in V$ such that $\\int_{0}^{1} v'(x)\\, z'(x)\\, dx = J'(u(\\widehat{f}))[v]$ for all $v \\in V$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically and mathematically sound. It describes a standard application of the adjoint method (specifically, the dual weighted residual method) to determine the sensitivity of a functional output (the goal) with respect to perturbations in the input data of a boundary value problem. The equations provided are the standard weak forms for the primal problem (Poisson's equation) and the corresponding dual (adjoint) problem.\n2.  **Non-Formalizable or Irrelevant**: The problem is highly formal and directly pertains to the topic *goal-oriented error control with dual weighted residuals* within the field *numerical solution of pdes*.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained. It provides the state equation, the goal functional, the specific form of the data perturbation, and the definition of the adjoint problem needed for the derivation. There are no contradictions.\n4.  **Unrealistic or Infeasible**: The problem is a standard model problem in the analysis of PDEs and is entirely feasible to solve.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. The Poisson problem with homogeneous Dirichlet conditions is well-posed, as is the adjoint problem. The derivation requested leads to a unique, meaningful result.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem is not trivial. It requires a multi-step derivation involving concepts from functional analysis (Fréchet derivatives, weak formulations) and calculus of variations, followed by the solution of a differential equation and evaluation of definite integrals. These steps test a core understanding of the adjoint method.\n7.  **Outside Scientific Verifiability**: The derivation and final result are mathematically verifiable.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed to provide a complete, reasoned solution.\n\nThe problem asks for the first-order variation of the goal functional, $\\delta J_{\\mathrm{data}}$, due to a perturbation $\\delta f$ in the a data. The solution process involves three main steps:\n1.  Derive a general expression for $\\delta J_{\\mathrm{data}}$ in terms of the adjoint state $z$ and the data perturbation $\\delta f$.\n2.  Solve the adjoint problem explicitly to find the adjoint state $z(x)$.\n3.  Substitute the solutions for $z(x)$ and the given $\\delta f(x)$ into the general expression and compute the result.\n\nLet us define the bilinear form $a: V \\times V \\to \\mathbb{R}$ and the linear functional $L_f: V \\to \\mathbb{R}$ corresponding to the weak formulation of the state equation:\n$$\na(w, v) := \\int_{0}^{1} w'(x)\\, v'(x)\\, dx\n$$\n$$\nL_f(v) := \\int_{0}^{1} f(x)\\, v(x)\\, dx\n$$\nThe state equation for a given source $f$ is to find $u(f) \\in V$ such that $a(u(f), v) = L_f(v)$ for all $v \\in V$.\n\nLet $\\widehat{u} = u(\\widehat{f})$ be the solution corresponding to the reference data $\\widehat{f}$, and $u = u(\\widehat{f} + \\delta f)$ be the solution for the perturbed data. The first-order variation of the state, $\\delta u$, is defined by the approximation $u \\approx \\widehat{u} + \\delta u$. We can find the equation governing $\\delta u$ by linearizing the state equation.\n$$\na(\\widehat{u} + \\delta u, v) = L_{\\widehat{f} + \\delta f}(v)\n$$\nBy the linearity of $a(\\cdot, \\cdot)$ in its first argument and the linearity of $L_{(\\cdot)}(v)$, we have:\n$$\na(\\widehat{u}, v) + a(\\delta u, v) = L_{\\widehat{f}}(v) + L_{\\delta f}(v)\n$$\nSince $\\widehat{u}$ satisfies the state equation for data $\\widehat{f}$, i.e., $a(\\widehat{u}, v) = L_{\\widehat{f}}(v)$, we can subtract this from the previous equation to obtain the linearized state equation for the state variation $\\delta u$:\n$$\na(\\delta u, v) = L_{\\delta f}(v) \\quad \\text{for all } v \\in V.\n$$\nThe first-order variation of the goal functional, $\\delta J_{\\mathrm{data}}$, is given by the linearization of $J(u)$ around $\\widehat{u}$:\n$$\n\\delta J_{\\mathrm{data}} = J(u) - J(\\widehat{u}) \\approx J'(\\widehat{u})[\\delta u]\n$$\nThe goal functional is $J(u) = \\int_{0}^{1} u(x) dx$. This is a linear functional, so its Fréchet derivative $J'(u)$ is independent of $u$ and is given by $J'(u)[v] = \\int_{0}^{1} v(x) dx = J(v)$. Thus, the variation of the goal is exactly:\n$$\n\\delta J_{\\mathrm{data}} = J(\\delta u) = \\int_{0}^{1} \\delta u(x) dx = J'(\\widehat{u})[\\delta u]\n$$\nThe adjoint problem is defined by seeking $z \\in V$ such that $a(v, z) = J'(\\widehat{u})[v]$ for all $v \\in V$. The bilinear form $a(\\cdot, \\cdot)$ is symmetric, i.e., $a(w,v) = a(v,w)$, so the adjoint equation can be written as $a(z, v) = J'(\\widehat{u})[v]$.\n\nNow, we use the adjoint solution $z$ to express $\\delta J_{\\mathrm{data}}$ in terms of the data perturbation $\\delta f$.\nWe start with the expression for the goal variation and set the test function $v$ in the adjoint equation to be the state variation $\\delta u \\in V$:\n$$\n\\delta J_{\\mathrm{data}} = J'(\\widehat{u})[\\delta u] = a(\\delta u, z)\n$$\nNext, we use the linearized state equation for $\\delta u$ and set its test function $v$ to be the adjoint solution $z \\in V$:\n$$\na(\\delta u, z) = L_{\\delta f}(z)\n$$\nCombining these two results gives the desired relationship:\n$$\n\\delta J_{\\mathrm{data}} = L_{\\delta f}(z) = \\int_{0}^{1} \\delta f(x) z(x) dx\n$$\nThis expression relates the variation in the output functional directly to the input data perturbation, mediated by the adjoint solution $z$, which acts as a sensitivity function.\n\nTo compute the value of $\\delta J_{\\mathrm{data}}$, we must find the explicit form of $z(x)$. The adjoint problem in weak form is:\n$$\n\\int_{0}^{1} z'(x)\\, v'(x)\\, dx = \\int_{0}^{1} v(x)\\, dx \\quad \\text{for all } v \\in V=H_0^1(0,1).\n$$\nThis is the weak formulation of the strong-form two-point boundary value problem:\n$$\n-z''(x) = 1, \\quad x \\in (0,1)\n$$\n$$\nz(0) = 0, \\quad z(1) = 0\n$$\nIntegrating the differential equation twice yields:\n$$\n-z'(x) = x + C_1\n$$\n$$\n-z(x) = \\frac{1}{2}x^2 + C_1 x + C_2\n$$\nApplying the boundary conditions to find the constants $C_1$ and $C_2$:\n$z(0) = 0 \\implies -(\\frac{1}{2}(0)^2 + C_1(0) + C_2) = 0 \\implies C_2=0$.\n$z(1) = 0 \\implies -(\\frac{1}{2}(1)^2 + C_1(1) + 0) = 0 \\implies -\\frac{1}{2} - C_1 = 0 \\implies C_1 = -\\frac{1}{2}$.\nSubstituting the constants back gives the adjoint solution:\n$$\nz(x) = -\\left(\\frac{1}{2}x^2 - \\frac{1}{2}x\\right) = \\frac{1}{2}(x - x^2)\n$$\nFinally, we compute $\\delta J_{\\mathrm{data}}$ by substituting $z(x) = \\frac{1}{2}(x - x^2)$ and $\\delta f(x) = \\beta + \\eta \\sin(\\pi x)$ into the integral expression:\n$$\n\\delta J_{\\mathrm{data}} = \\int_{0}^{1} \\left(\\beta + \\eta \\sin(\\pi x)\\right) \\left(\\frac{1}{2}(x - x^2)\\right) dx\n$$\nWe can split the integral into two parts:\n$$\n\\delta J_{\\mathrm{data}} = \\frac{\\beta}{2} \\int_{0}^{1} (x - x^2) dx + \\frac{\\eta}{2} \\int_{0}^{1} (x - x^2) \\sin(\\pi x) dx\n$$\nThe first integral is:\n$$\n\\int_{0}^{1} (x - x^2) dx = \\left[ \\frac{x^2}{2} - \\frac{x^3}{3} \\right]_{0}^{1} = \\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}\n$$\nThe second integral requires integration by parts twice. Let $I = \\int_{0}^{1} (x - x^2) \\sin(\\pi x) dx$.\nFirst integration by parts: let $u_1 = x - x^2$ and $dv_1 = \\sin(\\pi x) dx$. Then $du_1 = (1 - 2x) dx$ and $v_1 = -\\frac{1}{\\pi}\\cos(\\pi x)$.\n$$\nI = \\left[ -\\frac{1}{\\pi}(x - x^2)\\cos(\\pi x) \\right]_{0}^{1} - \\int_{0}^{1} \\left(-\\frac{1}{\\pi}\\cos(\\pi x)\\right)(1 - 2x) dx\n$$\nThe boundary term is zero at both $x=0$ and $x=1$.\n$$\nI = \\frac{1}{\\pi} \\int_{0}^{1} (1 - 2x)\\cos(\\pi x) dx\n$$\nSecond integration by parts: let $u_2 = 1 - 2x$ and $dv_2 = \\cos(\\pi x) dx$. Then $du_2 = -2 dx$ and $v_2 = \\frac{1}{\\pi}\\sin(\\pi x)$.\n$$\nI = \\frac{1}{\\pi} \\left( \\left[ \\frac{1}{\\pi}(1 - 2x)\\sin(\\pi x) \\right]_{0}^{1} - \\int_{0}^{1} \\frac{1}{\\pi}\\sin(\\pi x)(-2) dx \\right)\n$$\nThe boundary term is again zero at both limits, as $\\sin(0) = \\sin(\\pi) = 0$.\n$$\nI = \\frac{1}{\\pi} \\left( \\frac{2}{\\pi} \\int_{0}^{1} \\sin(\\pi x) dx \\right) = \\frac{2}{\\pi^2} \\left[ -\\frac{1}{\\pi}\\cos(\\pi x) \\right]_{0}^{1}\n$$\n$$\nI = -\\frac{2}{\\pi^3} [\\cos(\\pi x)]_{0}^{1} = -\\frac{2}{\\pi^3} (\\cos(\\pi) - \\cos(0)) = -\\frac{2}{\\pi^3} (-1 - 1) = \\frac{4}{\\pi^3}\n$$\nNow, we combine the results for the two parts of $\\delta J_{\\mathrm{data}}$:\n$$\n\\delta J_{\\mathrm{data}} = \\frac{\\beta}{2} \\left(\\frac{1}{6}\\right) + \\frac{\\eta}{2} \\left(\\frac{4}{\\pi^3}\\right) = \\frac{\\beta}{12} + \\frac{2\\eta}{\\pi^3}\n$$\nThis is the closed-form first-order variation of the goal with respect to the specified data perturbation.",
            "answer": "$$\\boxed{\\frac{\\beta}{12} + \\frac{2\\eta}{\\pi^3}}$$"
        },
        {
            "introduction": "Moving from simple error estimation to rigorous certification is the ultimate goal of goal-oriented error control. This final practice guides you through a complete, practical workflow to compute guaranteed upper and lower bounds for a goal functional, which is essential for building trust in simulation results. You will implement a multi-level method that uses a hierarchy of meshes and a standard saturation assumption to bound the unknown higher-order error terms, thus transforming the DWR estimator into a powerful tool for certification .",
            "id": "3400752",
            "problem": "Consider the one-dimensional, linear, second-order, coercive boundary value problem on the unit interval with homogeneous Dirichlet boundary conditions: find $u \\in H_0^1(0,1)$ such that\n$$\n\\int_0^1 u'(x)\\,v'(x)\\,dx = \\int_0^1 f(x)\\,v(x)\\,dx \\quad \\text{for all } v \\in H_0^1(0,1).\n$$\nLet the goal functional be linear and bounded on $H_0^1(0,1)$, given by\n$$\nJ(u) = \\int_0^1 g(x)\\,u(x)\\,dx.\n$$\nIntroduce the dual (adjoint) problem: find $z \\in H_0^1(0,1)$ such that\n$$\n\\int_0^1 w'(x)\\,z'(x)\\,dx = \\int_0^1 g(x)\\,w(x)\\,dx \\quad \\text{for all } w \\in H_0^1(0,1).\n$$\nDiscretize the primal and dual problems with continuous, piecewise linear finite elements on a uniform mesh of $N$ elements (mesh size $h = 1/N$), and denote the corresponding finite element approximations on mesh sizes $h$ and $h/2$ by $u_h$, $u_{h/2}$ (for the primal) and $z_{h/2}$, $z_{h/4}$ (for the dual), respectively. Use standard Gaussian quadrature (two-point Gauss rule) for element integrations. For the residual of the discrete primal solution $u_h$, define\n$$\nR(u_h)(v) := \\int_0^1 f(x)\\,v(x)\\,dx - \\int_0^1 u_h'(x)\\,v'(x)\\,dx,\n$$\nwhich is well-defined for $v \\in H_0^1(0,1)$.\n\nA user requires certification that the exact goal value $J(u)$ lies within a prescribed interval $[L,U]$. Your task is to formulate and implement a computable certification procedure based on dual weighted residuals that yields two-sided, goal-oriented bounds on $J(u)$ and decides if the constraint $J(u) \\in [L,U]$ is guaranteed.\n\nYour procedure must adhere to the following principles, starting from the fundamental variational definitions above:\n\n1. Construct a practical dual weighted residual estimator on the mesh hierarchy by evaluating the primal residual on a dual weight that is enriched relative to the primal discretization (use $z_{h/2}$ against $u_h$, and $z_{h/4}$ against $u_{h/2}$), and eliminate contamination by the discrete dual space via subtraction of the nodal interpolant onto the corresponding primal space.\n2. Adopt a mathematically explicit saturation model for the high-order remainder that is standard in goal-oriented a posteriori error analysis. The model must use a user-specified saturation factor $q \\in (0,1)$ applied to the remainder terms when passing from mesh size $h$ to $h/2$. The factor $q$ must enter your final computable two-sided bounds explicitly.\n3. From these ingredients, derive two computable numbers $\\underline{J}$ and $\\overline{J}$ (lower and upper bounds) satisfying $J(u) \\in [\\underline{J}, \\overline{J}]$ under the saturation model, based solely on $u_h$, $u_{h/2}$, $z_{h/2}$, $z_{h/4}$, the data $f$, $g$, and $q$.\n4. Based on the computed $\\underline{J}$ and $\\overline{J}$, certify the constraint by returning a boolean value that is `True` if $[\\underline{J}, \\overline{J}] \\subseteq [L, U]$ and `False` otherwise.\n\nImplementation requirements:\n- Use a uniform mesh and standard continuous, piecewise-linear finite elements.\n- Enforce homogeneous Dirichlet boundary conditions at $x=0$ and $x=1$.\n- For all element-level integrations, use the two-point Gaussian quadrature rule on the reference segment mapped to each element.\n- The numerical program must be self-contained and require no user input.\n\nTest suite:\nImplement and run your certification procedure on the following four test cases. For each case, the functions $f$ and $g$, the coarse mesh size $N$, the saturation factor $q$, and the target interval $[L,U]$ are specified. Use $x \\in [0,1]$. Trigonometric functions use the angle unit in radians.\n\n- Case A (general happy path):\n  - $f(x) = 1$,\n  - $g(x) = x(1-x)$,\n  - $N = 16$,\n  - $q = 0.5$,\n  - Interval $[L,U] = [0.03, 0.06]$.\n\n- Case B (influence of larger saturation factor):\n  - $f(x) = 1$,\n  - $g(x) = x(1-x)$,\n  - $N = 16$,\n  - $q = 0.9$,\n  - Interval $[L,U] = [0.03, 0.06]$.\n\n- Case C (different data with oscillatory solution and goal):\n  - $f(x) = \\pi^2 \\sin(\\pi x)$,\n  - $g(x) = \\sin(\\pi x)$,\n  - $N = 24$,\n  - $q = 0.5$,\n  - Interval $[L,U] = [0.3, 0.7]$.\n\n- Case D (narrow interval unlikely to be certifiable):\n  - $f(x) = \\pi^2 \\sin(\\pi x)$,\n  - $g(x) = x(1-x)$,\n  - $N = 24$,\n  - $q = 0.5$,\n  - Interval $[L,U] = [0.0, 0.01]$.\n\nFinal output specification:\n- For each case, compute the certification boolean that is `True` if the certified bounds produced by your DWR-based procedure lie entirely within the target interval, and `False` otherwise.\n- Your program should produce a single line of output containing the four booleans as a comma-separated list enclosed in square brackets, e.g., \"[True,False,True,False]\".\n- No physical units are involved.\n\nYour derivation must start from the variational formulations above and the definition of the residual. Do not assume or quote any specialized, ready-made goal-error bounding formula beyond what can be derived from these bases and the saturation model. All mathematical entities, including numbers, must be written in LaTeX in your derivation.",
            "solution": "The problem requires the formulation and implementation of a goal-oriented error certification procedure for a one-dimensional boundary value problem using the dual weighted residual (DWR) method. The procedure must compute guaranteed two-sided bounds $[\\underline{J}, \\overline{J}]$ for a linear goal functional $J(u)$ under a specified saturation assumption, and then verify if these bounds lie within a given target interval $[L, U]$.\n\nWe begin by establishing the theoretical foundation for the computable bounds.\n\nThe primal problem is to find $u \\in H_0^1(0,1)$ such that $a(u, v) = \\ell(v)$ for all test functions $v \\in H_0^1(0,1)$, where the bilinear form $a(\\cdot, \\cdot)$ and linear form $\\ell(\\cdot)$ are given by:\n$$\na(w, v) = \\int_0^1 w'(x) v'(x) dx\n$$\n$$\n\\ell(v) = \\int_0^1 f(x) v(x) dx\n$$\nThe goal functional of interest is $J(u) = \\int_0^1 g(x) u(x) dx$. The associated dual problem seeks a solution $z \\in H_0^1(0,1)$ such that $a(w, z) = J(w)$ for all $w \\in H_0^1(0,1)$. Due to the symmetry of $a(\\cdot, \\cdot)$, we can write this as $a(z, w) = J(w)$.\n\nThe error in the goal functional for a finite element approximation $u_h \\in V_h \\subset H_0^1(0,1)$ is $J(u) - J(u_h) = J(u-u_h)$. Let $e_u = u - u_h$ be the primal error. Using the definition of the dual solution $z$, we have the fundamental error identity:\n$$\nJ(u) - J(u_h) = J(e_u) = a(e_u, z) = a(u-u_h, z)\n$$\nUsing the linearity of $a(\\cdot, \\cdot)$ and the fact that $a(u,v)=\\ell(v)$ for all $v$, we set $v=z$ to get $a(u,z) = \\ell(z)$. This yields the DWR error representation formula:\n$$\nJ(u) - J(u_h) = a(u,z) - a(u_h, z) = \\ell(z) - a(u_h, z) =: R(u_h)(z)\n$$\nwhere $R(u_h)(v) = \\ell(v) - a(u_h, v)$ is the primal residual. This formula is exact but not computable, as it depends on the unknown dual solution $z$.\n\nTo derive a computable estimator, we replace $z$ with a more accurate, yet computable, approximation. The problem specifies using a hierarchy of meshes with sizes $h$, $h/2$, and $h/4$. Let $u_h, u_{h/2}$ be primal solutions on meshes of size $h$ and $h/2$, and $z_{h/2}, z_{h/4}$ be dual solutions on meshes of size $h/2$ and $h/4$. Let $V_H$ be the finite element space on a mesh of size $H$.\n\nBy Galerkin orthogonality, $R(u_h)(v_h) = 0$ for any $v_h \\in V_h$. We can thus write:\n$$\nJ(u) - J(u_h) = R(u_h)(z) = R(u_h)(z - v_h) \\quad \\text{for any } v_h \\in V_h\n$$\nThe problem states we should use an enriched dual approximation and subtract its nodal interpolant to avoid contamination. Let $I_h: V_{h/2} \\to V_h$ be the nodal interpolation operator. Choosing $v_h = I_h z_{h/2}$, we have:\n$$\nJ(u) - J(u_h) = R(u_h)(z - I_h z_{h/2}) = R(u_h)(z_{h/2} - I_h z_{h/2}) + R(u_h)(z - z_{h/2})\n$$\nThe first term, $\\eta_h := R(u_h)(z_{h/2} - I_h z_{h/2})$, is a fully computable error estimator. The second term, $R(u_h)(z-z_{h/2})$, involves the unknown $z$ and constitutes the remainder of the approximation.\n\nLet us define the error in the goal functional on two consecutive mesh levels:\n$$\n\\mathcal{E}_h = J(u) - J(u_h)\n$$\n$$\n\\mathcal{E}_{h/2} = J(u) - J(u_{h/2})\n$$\nUsing the estimator $\\eta$ and a remainder term $\\mathcal{R}$, we can write these errors as:\n$$\n\\mathcal{E}_h = \\eta_h + \\mathcal{R}_h \\quad \\text{where } \\eta_h = R(u_h)(z_{h/2} - I_h z_{h/2})\n$$\n$$\n\\mathcal{E}_{h/2} = \\eta_{h/2} + \\mathcal{R}_{h/2} \\quad \\text{where } \\eta_{h/2} = R(u_{h/2})(z_{h/4} - I_{h/2} z_{h/4})\n$$\nThe remainder terms $\\mathcal{R}_h$ and $\\mathcal{R}_{h/2}$ represent higher-order effects. Subtracting the two error representations gives:\n$$\n\\mathcal{E}_h - \\mathcal{E}_{h/2} = (\\eta_h - \\eta_{h/2}) + (\\mathcal{R}_h - \\mathcal{R}_{h/2})\n$$\nThe left side is also equal to $(J(u) - J(u_h)) - (J(u) - J(u_{h/2})) = J(u_{h/2}) - J(u_h)$. Therefore, we can write an equation for the remainders:\n$$\n\\mathcal{R}_h - \\mathcal{R}_{h/2} = (J(u_{h/2}) - J(u_h)) - (\\eta_h - \\eta_{h/2})\n$$\nLet $\\Delta = (J(u_{h/2}) - J(u_h)) - (\\eta_h - \\eta_{h/2})$. The quantity $\\Delta$ is fully computable from the discrete solutions.\n\nWe now invoke the saturation assumption, as required by the problem. We assume that the magnitude of the remainder term decreases by at least a factor of $q \\in (0,1)$ when the mesh is refined:\n$$\n|\\mathcal{R}_{h/2}| \\le q |\\mathcal{R}_h|\n$$\nFrom $\\mathcal{R}_h - \\mathcal{R}_{h/2} = \\Delta$, we have $\\mathcal{R}_h = \\mathcal{R}_{h/2} + \\Delta$. Substituting this into the saturation inequality:\n$$\n|\\mathcal{R}_{h/2}| \\le q |\\mathcal{R}_{h/2} + \\Delta| \\le q (|\\mathcal{R}_{h/2}| + |\\Delta|)\n$$\nRearranging this inequality for $|\\mathcal{R}_{h/2}|$:\n$$\n|\\mathcal{R}_{h/2}| (1-q) \\le q |\\Delta| \\implies |\\mathcal{R}_{h/2}| \\le \\frac{q}{1-q} |\\Delta|\n$$\nThis provides a computable bound on the remainder term for the finer mesh, which we denote $E_{bound} = \\frac{q}{1-q} |\\Delta|$.\n\nWe can now establish bounds on the true error $\\mathcal{E}_{h/2} = J(u) - J(u_{h/2})$. Since $\\mathcal{E}_{h/2} = \\eta_{h/2} + \\mathcal{R}_{h/2}$, we have:\n$$\n\\eta_{h/2} - |\\mathcal{R}_{h/2}| \\le \\mathcal{E}_{h/2} \\le \\eta_{h/2} + |\\mathcal{R}_{h/2}|\n$$\nSubstituting the bound on $|\\mathcal{R}_{h/2}|$:\n$$\n\\eta_{h/2} - E_{bound} \\le J(u) - J(u_{h/2}) \\le \\eta_{h/2} + E_{bound}\n$$\nFinally, we obtain the desired two-sided bounds $[\\underline{J}, \\overline{J}]$ for the exact goal functional value $J(u)$ by adding $J(u_{h/2})$ to all parts of the inequality:\n$$\n\\underline{J} = J(u_{h/2}) + \\eta_{h/2} - E_{bound}\n$$\n$$\n\\overline{J} = J(u_{h/2}) + \\eta_{h/2} + E_{bound}\n$$\nwhere $E_{bound} = \\frac{q}{1-q} |(J(u_{h/2}) - J(u_h)) - (\\eta_h - \\eta_{h/2})|$.\n\nThe certification procedure is then to compute $\\underline{J}$ and $\\overline{J}$ and check if $[\\underline{J}, \\overline{J}] \\subseteq [L, U]$, which is equivalent to testing if $\\underline{J} \\ge L$ and $\\overline{J} \\le U$.\n\nThe implementation will consist of:\n1.  A finite element solver for the primal and dual problems on uniform meshes, using piecewise linear basis functions and handling homogeneous Dirichlet boundary conditions.\n2.  Functions to compute the goal functional $J(\\cdot)$ and the residual-based estimators $\\eta_h$ and $\\eta_{h/2}$. All integrations must use the two-point Gaussian quadrature rule.\n3.  A main routine to orchestrate the computation of all required discrete solutions ($u_h, u_{h/2}, z_{h/2}, z_{h/4}$), calculate the bounds $[\\underline{J}, \\overline{J}]$, and perform the certification for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve_bvp(N_elements, rhs_func):\n    \"\"\"\n    Solves the 1D Poisson problem -u'' = f on [0,1] with u(0)=u(1)=0\n    using piecewise linear finite elements on a uniform mesh.\n\n    Args:\n        N_elements (int): Number of elements in the mesh.\n        rhs_func (callable): The function f(x) on the right-hand side.\n\n    Returns:\n        A tuple (coeffs, nodes) where:\n        - coeffs (np.ndarray): Nodal solution values, including boundaries.\n        - nodes (np.ndarray): Coordinates of the mesh nodes.\n    \"\"\"\n    h = 1.0 / N_elements\n    num_nodes = N_elements + 1\n    num_unknowns = num_nodes - 2\n    nodes = np.linspace(0.0, 1.0, num_nodes)\n\n    # Assemble stiffness matrix A (tridiagonal)\n    A = np.zeros((num_unknowns, num_unknowns))\n    diag = 2.0 / h\n    off_diag = -1.0 / h\n    np.fill_diagonal(A, diag)\n    if num_unknowns > 1:\n        np.fill_diagonal(A[1:], off_diag)\n        np.fill_diagonal(A[:, 1:], off_diag)\n\n    # Assemble load vector b using 2-point Gaussian quadrature\n    b = np.zeros(num_unknowns)\n    # Gauss points and weights for reference interval [0, 1]\n    gauss_pts = 0.5 * (1.0 + np.array([-1.0, 1.0]) / np.sqrt(3.0))\n    gauss_wts = np.array([0.5, 0.5])\n    \n    basis_vals = np.array([1.0 - gauss_pts, gauss_pts]) # Shape (2, 2): [phi_i(xi_k)]\n\n    for i in range(N_elements):\n        x_i, x_i1 = nodes[i], nodes[i+1]\n        \n        # Quadrature points in physical element\n        quad_pts_phys = x_i + h * gauss_pts\n        f_vals = rhs_func(quad_pts_phys)\n\n        # Contribution to local load vector [b_i, b_{i+1}]\n        local_b = h * np.sum(gauss_wts * f_vals * basis_vals, axis=1)\n\n        if i > 0:\n            b[i - 1] += local_b[0]\n        if i < N_elements - 1:\n            b[i] += local_b[1]\n\n    # Solve linear system Au = b\n    if num_unknowns > 0:\n        u_internal = np.linalg.solve(A, b)\n    else:\n        u_internal = np.array([])\n        \n    # Combine with boundary values\n    coeffs = np.concatenate(([0.0], u_internal, [0.0]))\n    return coeffs, nodes\n\ndef calculate_J(solution, g_func):\n    \"\"\"Computes J(u) = integral(g(x) * u(x) dx).\"\"\"\n    u_coeffs, u_nodes = solution\n    N_elements = len(u_nodes) - 1\n    total_integral = 0.0\n\n    gauss_pts = 0.5 * (1.0 + np.array([-1.0, 1.0]) / np.sqrt(3.0))\n    gauss_wts = np.array([0.5, 0.5])\n    basis_vals = np.array([1.0 - gauss_pts, gauss_pts])\n\n    for i in range(N_elements):\n        h = u_nodes[i+1] - u_nodes[i]\n        local_u_coeffs = u_coeffs[i:i+2]\n        \n        quad_pts_phys = u_nodes[i] + h * gauss_pts\n        g_vals = g_func(quad_pts_phys)\n        u_vals_at_quad = local_u_coeffs @ basis_vals\n\n        elem_integral = h * np.sum(gauss_wts * g_vals * u_vals_at_quad)\n        total_integral += elem_integral\n        \n    return total_integral\n\ndef calculate_residual(u_sol, z_fine_sol, f_func):\n    \"\"\"Computes eta = R(u)(z_fine - I(z_fine)).\"\"\"\n    u_coeffs, u_nodes = u_sol\n    z_coeffs_fine, z_nodes_fine = z_fine_sol\n    \n    N_coarse = len(u_nodes) - 1\n    N_fine = len(z_nodes_fine) - 1\n\n    # Nodal interpolant of z_fine onto coarse mesh\n    Iz_coeffs = z_coeffs_fine[::(N_fine // N_coarse)]\n\n    # 1. Compute a(u, z_fine - Iz)\n    a_term = 0.0\n    h_coarse = 1.0 / N_coarse\n    h_fine = 1.0 / N_fine\n\n    for i in range(N_coarse):\n        u_deriv = (u_coeffs[i+1] - u_coeffs[i]) / h_coarse\n        Iz_deriv_coarse = (Iz_coeffs[i+1] - Iz_coeffs[i]) / h_coarse\n        \n        # Loop over the sub-elements of the coarse element\n        for j_sub in range(N_fine // N_coarse):\n            j_fine = i * (N_fine // N_coarse) + j_sub\n            z_deriv_fine = (z_coeffs_fine[j_fine+1] - z_coeffs_fine[j_fine]) / h_fine\n            h_deriv = z_deriv_fine - Iz_deriv_coarse\n            a_term += u_deriv * h_deriv * h_fine\n\n    # 2. Compute l(z_fine - Iz) = integral(f * (z_fine - Iz))\n    l_term = 0.0\n    gauss_pts = 0.5 * (1.0 + np.array([-1.0, 1.0]) / np.sqrt(3.0))\n    gauss_wts = np.array([0.5, 0.5])\n    basis_vals_fine = np.array([1.0 - gauss_pts, gauss_pts])\n\n    for j in range(N_fine):\n        # Fine element info\n        h_fine = z_nodes_fine[j+1] - z_nodes_fine[j]\n        local_z_coeffs = z_coeffs_fine[j:j+2]\n        \n        # Corresponding coarse element info\n        i_coarse = j // (N_fine // N_coarse)\n        h_coarse = u_nodes[i_coarse+1] - u_nodes[i_coarse]\n        local_Iz_coeffs = Iz_coeffs[i_coarse:i_coarse+2]\n\n        # Quadrature points\n        quad_pts_phys = z_nodes_fine[j] + h_fine * gauss_pts\n        f_vals = f_func(quad_pts_phys)\n        \n        # Evaluate z_fine at quad points\n        z_vals_at_quad = local_z_coeffs @ basis_vals_fine\n        \n        # Evaluate Iz at quad points\n        xi_coarse = (quad_pts_phys - u_nodes[i_coarse]) / h_coarse\n        basis_vals_coarse_at_quad = np.array([1.0 - xi_coarse, xi_coarse])\n        Iz_vals_at_quad = local_Iz_coeffs @ basis_vals_coarse_at_quad\n\n        h_vals_at_quad = z_vals_at_quad - Iz_vals_at_quad\n        elem_integral = h_fine * np.sum(gauss_wts * f_vals * h_vals_at_quad)\n        l_term += elem_integral\n\n    return l_term - a_term\n\ndef run_certification(f_func, g_func, N, q, L, U):\n    \"\"\"\n    Performs the full DWR certification procedure for one case.\n    \"\"\"\n    # 1. Solve for all required discrete solutions\n    u_h = solve_bvp(N, f_func)\n    u_h2 = solve_bvp(2 * N, f_func)\n    z_h2 = solve_bvp(2 * N, g_func)\n    z_h4 = solve_bvp(4 * N, g_func)\n\n    # 2. Compute goal functional values\n    J_uh = calculate_J(u_h, g_func)\n    J_uh2 = calculate_J(u_h2, g_func)\n\n    # 3. Compute DWR error estimators\n    eta_h = calculate_residual(u_h, z_h2, f_func)\n    eta_h2 = calculate_residual(u_h2, z_h4, f_func)\n\n    # 4. Compute bounds\n    delta = (J_uh2 - J_uh) - (eta_h - eta_h2)\n    e_bound = (q / (1.0 - q)) * np.abs(delta)\n\n    # Improved goal value from the fine mesh\n    J_improved = J_uh2 + eta_h2\n    \n    J_lower = J_improved - e_bound\n    J_upper = J_improved + e_bound\n\n    # 5. Certify\n    is_certified = (J_lower >= L) and (J_upper <= U)\n    return is_certified\n    \ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    # Definition of test cases\n    def f_A(x): return np.ones_like(x) if isinstance(x, np.ndarray) else 1.0\n    def g_A(x): return x * (1.0 - x)\n    def f_C(x): return np.pi**2 * np.sin(np.pi * x)\n    def g_C(x): return np.sin(np.pi * x)\n\n    test_cases = [\n        {'f': f_A, 'g': g_A, 'N': 16, 'q': 0.5, 'L': 0.03, 'U': 0.06},\n        {'f': f_A, 'g': g_A, 'N': 16, 'q': 0.9, 'L': 0.03, 'U': 0.06},\n        {'f': f_C, 'g': g_C, 'N': 24, 'q': 0.5, 'L': 0.3, 'U': 0.7},\n        {'f': f_C, 'g': g_A, 'N': 24, 'q': 0.5, 'L': 0.0, 'U': 0.01},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_certification(case['f'], case['g'], case['N'], case['q'], case['L'], case['U'])\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}