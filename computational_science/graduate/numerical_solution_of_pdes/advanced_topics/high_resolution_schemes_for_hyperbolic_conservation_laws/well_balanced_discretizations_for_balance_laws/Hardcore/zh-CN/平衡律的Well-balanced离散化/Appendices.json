{
    "hands_on_practices": [
        {
            "introduction": "本章的第一个练习将带您直击良好平衡格式的核心。通过直接计算一个简单的“静止湖泊”情景下的数值残差，我们将揭示一个设计不当的格式如何产生虚假运动，而一个良好平衡的格式又如何完美地维持平衡状态。这种代数分析是理解和设计此类方法的关键第一步。",
            "id": "3462989",
            "problem": "考虑如下守恒形式的含底部地形的一维浅水偏微分方程 (PDE)：\n$$\nh_{t} + (hu)_{x} = 0, \\qquad (hu)_{t} + \\left(hu^{2} + \\tfrac{1}{2} g h^{2}\\right)_{x} = - g h b_{x},\n$$\n其中 $h$ 是水深，$u$ 是速度，$g$ 是重力加速度，$b(x)$ 是底部高程。静止湖泊稳态定义为 $u(x) \\equiv 0$ 和 $\\eta(x) \\equiv h(x) + b(x) \\equiv H$，其中 $H$ 为常数。\n\n在一个单元中心为 $x_{i}$、间距为 $\\Delta x$ 的均匀网格上，考虑动量方程的有限体积离散化。在静止湖泊条件下（即 $u \\equiv 0$），对分片常数单元状态求得的静水压力项的界面数值通量如下：\n$$\nF_{i+\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right), \\qquad F_{i-\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right),\n$$\n并将单元 $i$ 中动量方程的离散残差定义为\n$\nR_{i} = -\\dfrac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i},\n$\n其中有两种不同的源项离散化方法：\n- 朴素的逐点源项计算：\n$$\nS_{i}^{\\mathrm{naive}} = - g \\, h_{i} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}.\n$$\n- 一种良好平衡的离散化方法，它使用相邻水深的中心平均值乘以底部斜率的中心差分：\n$$\nS_{i}^{\\mathrm{wb}} = - g \\, \\frac{h_{i+1} + h_{i-1}}{2} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}.\n$$\n\n假设处于静止湖泊状态，对于所有 $j \\in \\{i-1, i, i+1\\}$ 都有 $h_{j} = H - b_{j}$。请推导离散残差 $R_{i}^{\\mathrm{naive}}$ 和 $R_{i}^{\\mathrm{wb}}$，用 $g$、$\\Delta x$ 以及局部底部高程样本 $b_{i-1}$、$b_{i}$、$b_{i+1}$ 来表示。将您的最终结果以行矩阵 $\\bigl(R_{i}^{\\mathrm{naive}} \\;\\; R_{i}^{\\mathrm{wb}}\\bigr)$ 的形式给出，并尽可能简化。不要包含任何单位，也不要进行近似；给出精确的解析表达式。",
            "solution": "在尝试求解之前，对问题陈述进行了严格验证。\n\n### 步骤 1：提取已知条件\n- **控制方程（浅水方程）：**\n$$\nh_{t} + (hu)_{x} = 0\n$$\n$$\n(hu)_{t} + \\left(hu^{2} + \\tfrac{1}{2} g h^{2}\\right)_{x} = - g h b_{x}\n$$\n- **变量：** $h$ 为水深，$u$ 为速度，$g$ 为重力加速度，$b(x)$ 为底部高程。\n- **稳态条件（静止湖泊）：** $u(x) \\equiv 0$ 且 $\\eta(x) \\equiv h(x) + b(x) \\equiv H$，其中 $H$ 为常数。\n- **离散化：** 均匀网格，单元中心为 $x_{i}$，间距为 $\\Delta x$。\n- **界面通量（静水压力项）：**\n$$\nF_{i+\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right)\n$$\n$$\nF_{i-\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right)\n$$\n- **离散残差：**\n$$\nR_{i} = -\\dfrac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}\n$$\n- **源项离散化：**\n  - 朴素法：$S_{i}^{\\mathrm{naive}} = - g \\, h_{i} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$\n  - 良好平衡法：$S_{i}^{\\mathrm{wb}} = - g \\, \\frac{h_{i+1} + h_{i-1}}{2} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$\n- **求值条件：** 静止湖泊条件在离散层面上成立，即对于所有相关的单元索引 $j$，都有 $h_{j} = H - b_{j}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n评估问题的有效性。\n- **科学依据：** 该问题使用浅水方程，这是流体动力学中的一个标准模型。所提出的数值方法（有限体积法、良好平衡格式）是计算物理和偏微分方程数值分析中的既定概念。该问题是验证格式的良好平衡特性的一个标准练习。它在科学上和数学上都是合理的。\n- **适定性：** 该任务是基于一套完整的给定公式和条件的直接代数推导。保证能得到唯一的结果。\n- **客观性：** 该问题使用精确的数学语言表述，没有歧义或主观因素。\n\n### 步骤 3：结论与行动\n该问题是 **有效的**。将提供完整的解答。\n\n### 解题推导\n目标是在静止湖泊条件下计算离散残差 $R_{i}^{\\mathrm{naive}}$ 和 $R_{i}^{\\mathrm{wb}}$。两种残差共享相同的通量散度项，但源项离散化不同。\n\n首先，我们分析对两种情况都共同的通量散度对残差的贡献。该项离散化了压力梯度 $\\left(\\frac{1}{2}gh^2\\right)_x$，由下式给出：\n$$\n-\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} = -\\frac{1}{\\Delta x} \\left[ \\frac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right) - \\frac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right) \\right]\n$$\n简化方括号内的表达式：\n$$\n-\\frac{g}{4\\Delta x} \\left[ (h_{i}^{2} + h_{i+1}^{2}) - (h_{i-1}^{2} + h_{i}^{2}) \\right] = -\\frac{g}{4\\Delta x} \\left(h_{i+1}^{2} - h_{i-1}^{2}\\right)\n$$\n该项表示作用在单元 $i$ 上的净压力。\n\n现在，我们在静止湖泊条件下（对任意索引 $j$，$h_{j} = H - b_{j}$）计算此表达式。\n$$\nh_{i+1}^{2} - h_{i-1}^{2} = (H - b_{i+1})^{2} - (H - b_{i-1})^{2}\n$$\n展开平方项：\n$$\n= (H^{2} - 2Hb_{i+1} + b_{i+1}^{2}) - (H^{2} - 2Hb_{i-1} + b_{i-1}^{2})\n$$\n$$\n= 2H(b_{i-1} - b_{i+1}) + b_{i+1}^{2} - b_{i-1}^{2}\n$$\n对平方差 $b_{i+1}^{2} - b_{i-1}^{2} = (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1})$ 进行因式分解，并注意到 $b_{i-1} - b_{i+1} = -(b_{i+1} - b_{i-1})$：\n$$\n= -2H(b_{i+1} - b_{i-1}) + (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1})\n$$\n$$\n= (b_{i+1} - b_{i-1}) (b_{i+1} + b_{i-1} - 2H)\n$$\n将此结果代回通量散度项：\n$$\n-\\frac{g}{4\\Delta x}(h_{i+1}^{2} - h_{i-1}^{2}) = -\\frac{g}{4\\Delta x} (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1} - 2H)\n$$\n\n现在我们准备好计算每种情况的总残差。\n\n**1. 朴素离散化 ($R_{i}^{\\mathrm{naive}}$)**\n残差为 $R_{i}^{\\mathrm{naive}} = -\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}^{\\mathrm{naive}}$。\n朴素源项为 $S_{i}^{\\mathrm{naive}} = - g h_{i} \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$。\n在静止湖泊条件下，$h_{i} = H - b_{i}$，因此源项变为：\n$$\nS_{i}^{\\mathrm{naive}} = -g(H - b_{i}) \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}\n$$\n结合通量项和源项：\n$$\nR_{i}^{\\mathrm{naive}} = -\\frac{g(b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1} - 2H)}{4\\Delta x} - \\frac{g(H - b_{i})(b_{i+1} - b_{i-1})}{2 \\Delta x}\n$$\n提出公因式 $\\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x}$：\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left[ -(b_{i+1} + b_{i-1} - 2H) - 2(H - b_{i}) \\right]\n$$\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left[ -b_{i+1} - b_{i-1} + 2H - 2H + 2b_{i} \\right]\n$$\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left( 2b_{i} - b_{i+1} - b_{i-1} \\right)\n$$\n这个表达式可以更有启发性地写为：\n$$\nR_{i}^{\\mathrm{naive}} = -\\frac{g(b_{i+1} - b_{i-1})(b_{i+1} - 2b_{i} + b_{i-1})}{4\\Delta x}\n$$\n对于非平坦的底部，此残差不为零，这表明朴素格式在静止时会产生伪动量，这是一个已知的数值伪影。\n\n**2. 良好平衡离散化 ($R_{i}^{\\mathrm{wb}}$)**\n残差为 $R_{i}^{\\mathrm{wb}} = -\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}^{\\mathrm{wb}}$。\n良好平衡源项为 $S_{i}^{\\mathrm{wb}} = -g \\frac{h_{i+1} + h_{i-1}}{2} \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x} = -\\frac{g(h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1})}{4 \\Delta x}$。\n总残差为：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1}^{2} - h_{i-1}^{2})}{4\\Delta x} - \\frac{g(h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1})}{4\\Delta x}\n$$\n提出公因式 $-\\frac{g}{4\\Delta x}$：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g}{4\\Delta x} \\left[ (h_{i+1}^{2} - h_{i-1}^{2}) + (h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1}) \\right]\n$$\n使用恒等式 $h_{i+1}^{2} - h_{i-1}^{2} = (h_{i+1} - h_{i-1})(h_{i+1} + h_{i-1})$：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g}{4\\Delta x} \\left[ (h_{i+1} - h_{i-1})(h_{i+1} + h_{i-1}) + (h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1}) \\right]\n$$\n提出公因式 $(h_{i+1} + h_{i-1})$：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1} + h_{i-1})}{4\\Delta x} \\left[ (h_{i+1} - h_{i-1}) + (b_{i+1} - b_{i-1}) \\right]\n$$\n现在，我们将静止湖泊条件 $h_j = H - b_j$ 应用于方括号中的项：\n$$\n(h_{i+1} - h_{i-1}) + (b_{i+1} - b_{i-1}) = \\left( (H - b_{i+1}) - (H - b_{i-1}) \\right) + (b_{i+1} - b_{i-1})\n$$\n$$\n= (-b_{i+1} + b_{i-1}) + (b_{i+1} - b_{i-1}) = 0\n$$\n由于该项恰好为零，整个残差也变为零：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1} + h_{i-1})}{4\\Delta x} \\times 0 = 0\n$$\n这表明“良好平衡”的离散化完美地保持了静止湖泊稳态，因为其残差恒为零。\n\n最终结果是包含 $R_{i}^{\\mathrm{naive}}$ 和 $R_{i}^{\\mathrm{wb}}$ 简化表达式的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\dfrac{g(b_{i+1}-b_{i-1})(b_{i+1}-2b_{i}+b_{i-1})}{4\\Delta x} & 0 \\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一旦我们为计算域内部设计了良好平衡的格式，就必须确保边界条件也同样是“良好平衡的”。本练习探讨了固壁反射这一常见情况，我们将验证一个标准的“虚拟单元”方法，当与内部的良好平衡格式相结合时，能够正确地在区域边缘维持静止状态。这确保了数值解在整个计算域内的完整性和准确性。",
            "id": "3462951",
            "problem": "考虑带底部地形的一维浅水方程，这是一种自由表面流的原型平衡律，\n$$\n\\partial_{t} U(x,t) + \\partial_{x} F\\!\\left(U(x,t)\\right) = S\\!\\left(U(x,t),\\partial_{x} z(x)\\right),\n$$\n其中守恒变量为 $U=(h,\\,q)^{\\top}$，包含水深 $h(x,t)$ 和流量 $q(x,t)=h(x,t)\\,u(x,t)$，物理通量为\n$$\nF(U) = \\begin{pmatrix} q \\\\ \\dfrac{q^{2}}{h} + \\dfrac{1}{2}\\,g\\,h^{2} \\end{pmatrix},\n$$\n而模拟地形 $z(x)$ 上重力的源项为\n$$\nS(U,\\partial_{x}z) = \\begin{pmatrix} 0 \\\\ -\\,g\\,h\\,\\partial_{x} z \\end{pmatrix},\n$$\n其中 $g>0$ 是重力加速度。静湖状态定义为具有恒定的自由表面高程 $\\eta(x)=h(x)+z(x)\\equiv H$ 和零速度 $u(x,t)\\equiv 0$。空间域为河道 $[a,b]$，在 $x=a$ 和 $x=b$ 处有反射（固壁）边界，意味着两个边界处的法向速度均为零。\n\n将区域离散为 $N$ 个宽度为 $\\Delta x$ 的均匀有限体积，网格中心为 $x_{i}$，$i=1,\\dots,N$，并采用一阶有限体积半离散格式\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} U_{i}(t) = -\\,\\frac{1}{\\Delta x}\\,\\Big(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\Big) + S_{i},\n$$\n其中 $F_{i+\\frac{1}{2}}$ 是网格 $i$ 和 $i+1$ 之间界面上的两点数值通量，$S_{i}$ 是一个相容的离散源项。数值通量采用 Harten–Lax–van Leer (HLL) 通量，对于左右状态 $U_{L},U_{R}$ 定义如下\n$$\nF_{\\mathrm{HLL}}(U_{L},U_{R})=\n\\begin{cases}\nF(U_{L}), & S_{L}\\ge 0, \\\\[0.5em]\n\\dfrac{S_{R}\\,F(U_{L}) - S_{L}\\,F(U_{R}) + S_{L}\\,S_{R}\\,\\big(U_{R}-U_{L}\\big)}{S_{R}-S_{L}}, & S_{L}<0<S_{R}, \\\\[0.5em]\nF(U_{R}), & S_{R}\\le 0\n\\end{cases}\n$$\n其中信号速度 $S_{L}$ 和 $S_{R}$ 使用带 Roe 平均值的 Einfeldt–Batten 估计：$S_{L} = \\tilde{u} - \\tilde{c}$，$S_{R} = \\tilde{u} + \\tilde{c}$。此处 $\\tilde{u}$ 和 $\\tilde{c}$ 是 Roe 平均速度和声速。我们使用虚拟网格来处理边界条件：在左边界 $x=a$ 处，虚拟网格 $i=0$ 的状态设置为 $U_{0}=(h_{1}, -q_{1})^{\\top}$；在右边界 $x=b$ 处，虚拟网格 $i=N+1$ 的状态设置为 $U_{N+1}=(h_{N}, -q_{N})^{\\top}$。\n\n假设系统以静湖状态初始化（即对所有 $i=1,\\dots,N$ 都有 $u_{i}=0$ 和 $h_{i}+z_{i}=H$）。请定量验证这些边界条件，与一个对于内部网格来说是良态平衡的离散格式相结合时，不会在初始时刻在计算域的边缘（即 $x_1$ 和 $x_N$）产生伪运动。将你的答案以一个四分量的行矩阵形式给出，包含 $(F_{1/2})_q$, $(F_{1/2})_{q^2/h + gh^2/2}$, $(F_{N+1/2})_q$, $(F_{N+1/2})_{q^2/h + gh^2/2}$。",
            "solution": "该问题是适定的，并且在双曲平衡律的数值方法理论中有其科学依据。所有必需的定义和条件都已提供，足以进行完整的分析。\n\n分析按要求分为两部分：首先，在静湖初始条件下计算区域边界处的数值通量；其次，验证这些边界条件与良态平衡的内部离散相结合时，不会在初始时刻在邻近边界的网格中产生伪运动。\n\n**第1部分：边界数值通量的计算**\n\n我们的任务是计算在 $t=0$ 时刻的数值通量 $F_{1/2} = F_{\\mathrm{HLL}}(U_{0}, U_{1})$ 和 $F_{N+1/2} = F_{\\mathrm{HLL}}(U_{N}, U_{N+1})$。初始条件为静湖状态，意味着速度 $u(x,0) \\equiv 0$，这表明流量 $q(x,0) = h(x,0)u(x,0) \\equiv 0$。对于离散状态，这意味着对于所有 $i=1, \\dots, N$，$q_{i}(0) = 0$。\n\n**$F_{1/2}$的计算**\n左边界界面 $x_{1/2}$ 处的通量由 $F_{1/2} = F_{\\mathrm{HLL}}(U_{L}, U_{R})$ 给出，其中左状态 $U_{L}$ 是虚拟状态 $U_{0}$，右状态 $U_{R}$ 是第一个网格中的状态 $U_{1}$。\n\n虚拟状态由反射边界条件定义：$U_{0} = (h_{1}, -q_{1})^{\\top}$。网格 1 中的状态为 $U_{1} = (h_{1}, q_{1})^{\\top}$。\n\n在初始时刻 $t=0$，我们有 $q_{1}(0) = 0$。因此，$x_{1/2}$ 处的黎曼问题的状态为：\n$$\nU_{L} = U_{0}(0)=\\begin{pmatrix} h_{1} \\\\ -0 \\end{pmatrix} = \\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\n$$\n$$\nU_{R} = U_{1}(0)=\\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\n$$\n左右状态是相同的：$U_{L} = U_{R} = U_{1}(0)$。\n\n当 HLL 通量的输入状态相同时，即 $U_{L}=U_{R}=U$，HLL 通量是相容的，并简化为物理通量 $F(U)$。我们可以从定义中证明这一点。信号速度为 $S_{L} = \\min(u-c, u-c) = u-c$ 和 $S_{R} = \\max(u+c, u+c) = u+c$。只要流是亚临界的（$|u|<c$），我们就有 $S_L < 0 < S_R$，所以使用中间的 HLL 公式。当 $U_L=U_R$ 时，该公式变为\n$$\n\\frac{S_{R}\\,F(U) - S_{L}\\,F(U) + S_{L}\\,S_{R}\\,\\big(U-U\\big)}{S_{R}-S_{L}} = \\frac{(S_R - S_L)F(U)}{S_R-S_L} = F(U).\n$$\n对于静止状态（$u=0$），我们有 $c=\\sqrt{gh}>0$，因此 $S_L = -c < 0$ 和 $S_R = c > 0$，此条件成立。\n\n因此，\n$$\nF_{1/2} = F(U_{1}(0)) = F\\left(\\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\\right) = \\begin{pmatrix} 0 \\\\ \\dfrac{0^{2}}{h_{1}} + \\dfrac{1}{2}\\,g\\,h_{1}^{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\dfrac{1}{2}\\,g\\,h_{1}^{2} \\end{pmatrix}.\n$$\n\n**$F_{N+1/2}$的计算**\n类似地，右边界界面 $x_{N+1/2}$ 处的通量由 $F_{N+1/2} = F_{\\mathrm{HLL}}(U_{N}, U_{N+1})$ 给出。\n左状态为 $U_L = U_N(0) = (h_N, 0)^\\top$。\n右状态为虚拟状态 $U_R = U_{N+1}(0) = (h_N, -q_N(0))^\\top = (h_N, 0)^\\top$。\n\n同样，$U_{L} = U_{R} = U_{N}(0)$。因此，\n$$\nF_{N+1/2} = F(U_{N}(0)) = F\\left(\\begin{pmatrix} h_{N} \\\\ 0 \\end{pmatrix}\\right) = \\begin{pmatrix} 0 \\\\ \\dfrac{1}{2}\\,g\\,h_{N}^{2} \\end{pmatrix}.\n$$\n\n**第2部分：无伪运动的验证**\n问题要求验证在边缘网格 $i=1$ 和 $i=N$ 中没有产生伪运动，即 $\\frac{\\mathrm{d}}{\\mathrm{d}t} U_{1}(0) = 0$ 和 $\\frac{\\mathrm{d}}{\\mathrm{d}t} U_{N}(0) = 0$。\n\n对于一个适定的内部格式，对于静湖状态有 $(F_{i+1/2} - F_{i-1/2})/\\Delta x = S_{i}$ 对所有内部单元格 $i$ 成立。特别地，对于单元格 $i=1$ 和 $i=N$，这个条件也必须成立才能使整个格式是适定的。该问题本质上是询问这些特定的边界条件是否与内部的适定性相容。\n\n适定格式的设计使得在静湖状态下，$F_{i+1/2}$ 的数值通量精确地模拟了物理通量 $F(U_{i+1/2})$，其中 $U_{i+1/2}$ 是一个在界面 $x_{i+1/2}$ 上的中间状态。对于一个一阶格式，可以取 $U_{i+1/2} = U_i$ 或 $U_{i+1/2} = U_{i+1}$，或者某种平均。无论如何，对于静湖状态 $u=0$，动量通量在界面 $x_{i+1/2}$ 处为 $F_{mom, i+1/2} = \\frac{1}{2}gh_{i+1/2}^2$。适定源项 $S_i$ 的设计就是为了平衡这些通量。\n\n对于 $i=1$，更新为 $\\frac{\\mathrm{d}}{\\mathrm{d}t} U_{1} = -\\frac{1}{\\Delta x}(F_{3/2} - F_{1/2}) + S_{1}$。\n我们已经计算出 $F_{1/2} = (0, \\frac{1}{2}gh_1^2)^\\top$。\n由于内部格式是适定的，数值通量 $F_{3/2}$ 将是一个与源项 $S_1$ 和 $S_2$ 相平衡的值。更确切地说，内部格式的适定性意味着，当给定静湖剖面时，它产生的通量和源项满足离散平衡。我们在这里应用的边界条件（通过虚拟单元）确保了在物理边界 $x_{1/2}$ 和 $x_{N+1/2}$ 上的通量就是静水压力通量。这正是内部适定格式在内部界面上所做的。因此，所选的边界条件与内部格式是一致的，整个格式在静湖状态下是适定的。因此，时间导数为零。\n\n问题的定量部分是计算通量本身。\n$$ (F_{1/2})_q = 0 $$\n$$ (F_{1/2})_{q^2/h + gh^2/2} = \\frac{1}{2} g h_{1}^{2} $$\n$$ (F_{N+1/2})_q = 0 $$\n$$ (F_{N+1/2})_{q^2/h + gh^2/2} = \\frac{1}{2} g h_{N}^{2} $$\n将这些值组合成一个行矩阵，就得到了答案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & \\frac{1}{2} g h_{1}^{2} & 0 & \\frac{1}{2} g h_{N}^{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "这是一个高级练习，揭示了良好平衡格式在处理更复杂的非凸物理问题时一个引人入胜的特性。当物理状态与守恒量之间的关系不是一对一时，一个良好平衡的格式可能允许多个定常解的存在。这个动手编程问题将向您展示，数值重构的选择如何充当一种“选择原则”，从而决定模拟将收敛到哪一个可能的物理现实。",
            "id": "3462931",
            "problem": "考虑一维偏微分方程 (PDE) 的标量守恒律\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = a(x),\n$$\n其中 $f$ 为光滑通量函数，$a$ 为源项。如果一个适定有限体积离散格式对于某一族目标稳态是精确的，那么当该族连续稳态条件成立时，其离散更新会精确地消失，而不会引入虚假的瞬态过程。特别地，对于满足\n$$\n\\partial_x f(u(x)) = a(x),\n$$\n的稳态，原始量 $w(x) \\equiv f(u(x))$ 服从\n$$\n\\partial_x w(x) = a(x),\n$$\n因此 $w$ 可通过对 $a$ 积分确定（相差一个可加常数）。在具有均匀间距 $\\Delta x$ 的离散网格中，通过将离散通量与 $a$ 的离散反导数相匹配，可以实现该族稳态的精确适定，从而使得关于单元平均值 $\\{\\bar u_i\\}$ 的离散方程可以伸缩求和。这将稳态条件从 $u$ 提升到 $w=f(u)$，并且在非凸通量 $f$ 的情况下，引入了从 $w$ 回到 $u$ 的多值反演。\n\n你需要构造性地、定量地证明，对于一类非凸通量，精确适定机制可以通过用于反演 $w=f(u)$ 的重构方法的选择，在多个稳态之间进行挑选。你的任务分为三个部分：\n\n1) 从上述定义和稳态条件出发，推导为何对于非凸通量 $f$，在给定 $Q(x)$ 的情况下，条件 $w(x)=f(u(x))=Q(x)$ 可以容许多个逐点解 $u(x)$。并解释为何一个在 $w$ 上精确适定的离散格式对于在每个网格点选择反函数 $f^{-1}$ 的哪个分支是无差异的。说明重构方法的选择如何构成一种在容许稳态中的选择机制。\n\n2) 对于特定的非凸通量\n$$\nf(u) = u^3 - u,\n$$\n和源项\n$$\na(x) \\equiv 0,\n$$\n稳态满足 $f(u(x)) \\equiv Q(x)$，其中 $Q$ 为常数或空间变化的函数。对于此通量，当 $Q$ 位于区间\n$$\n\\left(-\\frac{2}{3\\sqrt{3}}, \\frac{2}{3\\sqrt{3}}\\right)\n$$\n内时，代数方程 $u^3 - u = Q$ 有三个不同的实根，而在此区间外，它只有一个唯一的实根。定义两个重构算子，将给定的 $Q$ 映射到一个逐点稳态 $u$：\n- $\\mathcal{R}_{\\mathrm{L}}(Q)$ 选择 $u^3 - u = Q$ 的最小实根。\n- $\\mathcal{R}_{\\mathrm{R}}(Q)$ 选择 $u^3 - u = Q$ 的最大实根。\n当只有一个实根时，$\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$ 都返回该唯一根。\n\n3) 实现一个完整的、可运行的程序，对于区间 $[0,1]$ 上包含 $N$ 个单元的均匀网格（单元中心为 $x_i = (i+1/2)\\Delta x$，$\\Delta x = 1/N$），构建以下四个稳态测试（角度必须以弧度为单位）：\n- 测试 A（理想情况，最大非唯一性）：$Q(x)\\equiv 0$。\n- 测试 B（多根但有偏）：$Q(x)\\equiv 0.3$。\n- 测试 C（单根区域）：$Q(x)\\equiv 0.5$。\n- 测试 D（在多根区域内空间变化）：$Q(x)=0.35\\sin(2\\pi x)$。\n\n对每个测试，计算两个重构的稳态\n$$\nu^{\\mathrm{L}}_i = \\mathcal{R}_{\\mathrm{L}}(Q(x_i)), \\quad u^{\\mathrm{R}}_i = \\mathcal{R}_{\\mathrm{R}}(Q(x_i)),\n$$\n然后报告以下三个浮点数：\n- 算术平均值 $\\overline{u}^{\\mathrm{L}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{L}}_i$。\n- 算术平均值 $\\overline{u}^{\\mathrm{R}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{R}}_i$。\n- 差分的离散 $L^2$-范数，定义为\n$$\n\\left\\|u^{\\mathrm{L}} - u^{\\mathrm{R}}\\right\\|_{2,\\Delta x} = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} \\left(u^{\\mathrm{L}}_i - u^{\\mathrm{R}}_i\\right)^2}.\n$$\n\n你的程序必须：\n- 使用 $N=200$。\n- 通过稳健的三次方程代数公式精确计算 $u^3-u=Q$ 的实根（无外部网络访问或文件）。\n- 实现上文定义的 $\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$。\n- 生成单行输出，按顺序包含测试 A、B、C 和 D 的结果，每个测试按上述指定顺序贡献三个浮点数，并汇集成一个扁平列表。也就是说，最终输出必须是形如\n$$\n[\\overline{u}^{\\mathrm{L}}_{\\mathrm{A}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{A}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{A}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{B}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{B}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{B}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{C}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{C}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{C}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{D}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{D}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{D}}]\n$$\n的单行文本，不含空格，其中所有角度都以弧度为单位，所有量均为无量纲实数。\n\n设计实现时要确保每个测试都是可复现且数值稳定的。最终打印的列表必须是程序的唯一输出。输出值为浮点数，不涉及单位。程序不得接受任何输入。数值结果应反映由 $\\mathcal{R}_{\\mathrm{L}}$ 与 $\\mathcal{R}_{\\mathrm{R}}$ 引起的分支选择差异，包括在单根区域的一致性以及在存在三个实根时的分歧。",
            "solution": "所述问题在科学上是合理的，数学上是适定的，并为定量演示提供了一套完整的规范。它基于双曲守恒律数值方法的既有理论，特别是关于适定格式和非凸通量函数所带来的挑战。定义是精确的，参数是明确的，所需的计算也有清晰的定义。因此，该问题是有效的，下面给出完整解法。\n\n问题的核心在于连续偏微分方程理论与离散数值近似的交叉点。我们被要求演示一个为一族稳态设计的“适定”数值格式，如何能够矛盾地容许多个不同的离散解，以及这种模糊性是如何被解决的。\n\n### 第一部分：适定性原理与非凸性\n\n我们从一维标量守恒律开始：\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = a(x)\n$$\n在这里，$u(x,t)$ 是一个守恒量，$f(u)$ 是通量函数，$a(x)$ 是一个依赖于空间的源项。根据定义，稳态是一个不随时间变化的解，即 $\\partial_t u = 0$。一个解要成为稳态，必须满足以下常微分方程：\n$$\n\\partial_x f(u(x)) = a(x)\n$$\n对这个方程关于 $x$ 积分，得到解 $u(x)$ 的一个代数条件：\n$$\nf(u(x)) = \\int a(x) \\, dx + C \\equiv Q(x)\n$$\n其中 $Q(x)$ 是源项 $a(x)$ 的任意一个反导数，积分常数 $C$ 由边界条件确定。这意味着任何稳态解 $u(x)$ 都必须满足 $f(u(x)) = Q(x)$，其中函数 $Q(x)$ 的导数是 $a(x)$。\n\n求解该偏微分方程的有限体积法将区域离散为单元，并对单元平均值 $u_i(t)$ 进行演化。一个通用的更新公式是：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} + \\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = A_i\n$$\n其中 $F_{i\\pm1/2}$ 是单元界面上的数值通量，$A_i$ 是单元 $i$ 中源项的离散表示。如果一个格式在用满足 $\\partial_x f(u) = a(x)$ 的稳态初始化时，其离散更新会精确地消失，那么该格式就被称为对该族稳态是**适定**的。也就是说，通量的离散散度必须精确地抵消离散源项：\n$$\n\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = A_i\n$$\n实现这一点的一个强大技术被称为**精确适定**，即围绕原始量 $w(x) = f(u(x))$ 来构造格式。数值通量和源项被设计成使得离散守恒关系是连续守恒关系的完美模拟。例如，数值通量 $F_{i+1/2}$ 可以被定义为包含值 $Q(x_{i+1/2})$，以确保通量差分可以伸缩求和，并与源项的一致离散化相匹配，通常为 $A_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} a(x) dx = \\frac{Q(x_{i+1/2}) - Q(x_{i-1/2})}{\\Delta x}$。\n\n当通量函数 $f(u)$ 是**非凸**的，即其导数 $f'(u)$ 不是单调的时，问题的症结就出现了。在这种情况下，反函数 $u = f^{-1}(w)$ 可能是多值的。对于给定的 $w = Q(x)$ 值，可能存在多个不同的 $u$ 值满足 $f(u) = w$。\n\n根据其构造，适定格式只关心 $w=f(u)$ 的平衡。它确保 $\\partial_x w$ 的离散表示与离散源项相匹配。因此，任何满足对所有 $i$ 都有 $f(u_i) = Q(x_i)$ 的离散解 $\\{u_i\\}$ 都将被完美地保持为稳态。该格式对于在每个网格点 $i$ 选择方程 $u_i = f^{-1}(Q(x_i))$ 的哪个可能根是无差异的。\n\n这种无差异性为单个剖面 $Q(x)$ 创造了一族容许稳态。一个特定的稳态只能通过施加一个额外的**选择原则**来唯一确定。在数值格式的背景下，这种选择是通过重构过程进行的，该过程将底层的平衡数据 $Q(x)$ 映射到一个特定的解剖面 $u(x)$。问题定义了两个这样的重构算子，$\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$，它们分别选择最小和最大的实根。这些算子解决了模糊性，并从多种可能性中选择一个唯一的、全局定义的稳态。\n\n### 第二部分：特定通量 $f(u) = u^3 - u$ 的分析\n\n问题提供了特定的非凸通量 $f(u) = u^3 - u$。为了找到非可逆区域，我们通过求其导数的根来检验其临界点：\n$$\nf'(u) = \\frac{d}{du}(u^3 - u) = 3u^2 - 1 = 0\n$$\n临界点是 $u = \\pm 1/\\sqrt{3}$。在这些局部极值点上的通量值为：\n$$\nf\\left(\\frac{1}{\\sqrt{3}}\\right) = \\left(\\frac{1}{\\sqrt{3}}\\right)^3 - \\frac{1}{\\sqrt{3}} = \\frac{1}{3\\sqrt{3}} - \\frac{1}{\\sqrt{3}} = -\\frac{2}{3\\sqrt{3}}\n$$\n$$\nf\\left(-\\frac{1}{\\sqrt{3}}\\right) = \\left(-\\frac{1}{\\sqrt{3}}\\right)^3 - \\left(-\\frac{1}{\\sqrt{3}}\\right) = -\\frac{1}{3\\sqrt{3}} + \\frac{1}{\\sqrt{3}} = \\frac{2}{3\\sqrt{3}}\n$$\n因此，对于开区间 $(-\\frac{2}{3\\sqrt{3}}, \\frac{2}{3\\sqrt{3}})$ 内的任何给定值 $Q$，水平线 $w=Q$ 与 $f(u)$ 的图像相交三次。这意味着方程 $u^3 - u = Q$ 有三个不同的实根。对于 $|Q| > \\frac{2}{3\\sqrt{3}}$，只有一个实根。对于 $|Q| = \\frac{2}{3\\sqrt{3}}$，有两个不同的实根，其中一个的重数为二。\n\n重构算子 $\\mathcal{R}_{\\mathrm{L}}(Q)$ 和 $\\mathcal{R}_{\\mathrm{R}}(Q)$ 被定义为选择 $u^3 - u - Q = 0$ 的最小和最大实根。当存在三个不同的实根时，$\\mathcal{R}_{\\mathrm{L}}(Q) \\neq \\mathcal{R}_{\\mathrm{R}}(Q)$，导致对于相同的平衡剖面 $Q(x)$，存在两个不同的稳态解 $u^{\\mathrm{L}}(x)$ 和 $u^{\\mathrm{R}}(x)$。当只有一个实根时，$\\mathcal{R}_{\\mathrm{L}}(Q) = \\mathcal{R}_{\\mathrm{R}}(Q)$，并且得到的稳态是唯一的。\n\n### 第三部分：计算实现策略\n\n该任务要求为四个测试案例实现这种选择机制。总体的计算流程如下：\n\n1.  **离散化**：空间域 $[0, 1]$ 使用 $N=200$ 个宽度为 $\\Delta x = 1/N$ 的均匀单元进行离散化。单元中心为 $x_i = (i+1/2)\\Delta x$，其中 $i=0, 1, \\dots, N-1$。\n\n2.  **平衡剖面生成**：对于四个测试（A, B, C, D）中的每一个，根据指定的 $Q(x)$ 公式生成一个包含 $N$ 个值的向量 $\\{Q_i\\} = \\{Q(x_i)\\}$。\n\n3.  **三次方程求根**：一个核心组件是为每个 $Q_i$ 求解降次三次方程 $u^3 - u - Q_i = 0$ 实根的稳健求解器。这通过实现标准解析公式来完成。该方法取决于与判别式相关的项 $D = Q_i^2/4 - 1/27$ 的符号：\n    -   若 $D > 0$，对应于 $|Q_i| > 2/(3\\sqrt{3})$，则有一个实根，使用卡尔达诺公式求得。\n    -   若 $D < 0$，对应于 $|Q_i| < 2/(3\\sqrt{3})$，则有三个不同的实根，使用三角函数/韦达替换法求得。\n    -   若 $D = 0$，对应于 $|Q_i| = 2/(3\\sqrt{3})$，则存在重根，可以直接计算。\n\n4.  **重构**：对于每个 $i$，计算并排序方程 $u^3 - u - Q_i = 0$ 的实根列表。通过分别选择排序后列表的第一个（最小）和最后一个（最大）元素来应用重构算子 $\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$。这将产生两个大小为 $N$ 的解值向量 $u^{\\mathrm{L}}$ 和 $u^{\\mathrm{R}}$。\n\n5.  **分析**：对于每个测试案例，从重构的解向量中计算以下三个量：\n    -   ‘左’状态的算术平均值：$\\overline{u}^{\\mathrm{L}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{L}}_i$。\n    -   ‘右’状态的算术平均值：$\\overline{u}^{\\mathrm{R}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{R}}_i$。\n    -   差分的离散 $L^2$-范数：$\\|u^{\\mathrm{L}} - u^{\\mathrm{R}}\\|_{2,\\Delta x} = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} (u^{\\mathrm{L}}_i - u^{\\mathrm{R}}_i)^2}$。\n\n6.  **输出**：将得到的十二个浮点数（四个测试中的每个测试对应一个三元组）收集到一个列表中，并以指定格式打印。结果将定量地展示选择机制：对于测试 A、B 和 D，其中 $Q(x)$ 进入多根区域，两个重构解将不同，从而产生非零范数。对于测试 C，其中 $Q(x)$ 处于单根区域，解将相同，其差分的范数将为零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of reconstructing steady states for a balance law with a nonconvex flux.\n    \"\"\"\n\n    N = 200\n    DX = 1.0 / N\n    x = (np.arange(N) + 0.5) * DX\n    \n    # Define the four test cases for the equilibrium profile Q(x).\n    test_cases = [\n        (\"A\", lambda x_vals: np.full_like(x_vals, 0.0)),\n        (\"B\", lambda x_vals: np.full_like(x_vals, 0.3)),\n        (\"C\", lambda x_vals: np.full_like(x_vals, 0.5)),\n        (\"D\", lambda x_vals: 0.35 * np.sin(2 * np.pi * x_vals)),\n    ]\n\n    all_results = []\n\n    def solve_cubic_real_roots(q_val):\n        \"\"\"\n        Computes the real roots of u^3 - u - q = 0 using analytical formulas.\n        The equation is in depressed cubic form u^3 + p*u + q' = 0 with p=-1, q'=-q_val.\n        \n        The method selection is based on the sign of the discriminant.\n        \"\"\"\n        # Using the formulation for x^3 + px + q = 0\n        p, q_prime = -1.0, -q_val\n        \n        # Discriminant term from Cardano's formula: D = (q'/2)^2 + (p/3)^3\n        d = (q_prime / 2.0)**2 + (p / 3.0)**3\n        \n        # Machine epsilon for floating point comparison\n        epsilon = 1e-12\n\n        if d > epsilon:\n            # One real root\n            term = np.sqrt(d)\n            root = np.cbrt(-q_prime / 2.0 + term) + np.cbrt(-q_prime / 2.0 - term)\n            return [root]\n        elif d  -epsilon:\n            # Three distinct real roots (trigonometric solution)\n            # Roots are 2*sqrt(-p/3)*cos((1/3)*acos((3q')/(2p*sqrt(-p/3))) - 2*pi*k/3) for k=0,1,2\n            term_mul = 2.0 * np.sqrt(-p / 3.0) # 2/sqrt(3)\n            arg_acos = (3.0 * q_prime) / (2.0 * p * np.sqrt(-p / 3.0))\n            \n            # Clip argument to arccos to handle potential floating point inaccuracies\n            arg_acos = np.clip(arg_acos, -1.0, 1.0)\n            \n            phi = np.arccos(arg_acos)\n            \n            root1 = term_mul * np.cos(phi / 3.0)\n            root2 = term_mul * np.cos((phi - 2.0 * np.pi) / 3.0)\n            root3 = term_mul * np.cos((phi + 2.0 * np.pi) / 3.0)\n            \n            return sorted([root1, root2, root3])\n        else: # d is close to zero\n            # Three real roots with at least two equal\n            if abs(q_val)  epsilon: # q_prime is also zero\n                return [-1.0, 0.0, 1.0]\n\n            # For D=0, q_val^2 = 4/27\n            # Roots are 2*A, -A, -A where A = sgn(q_val)/sqrt(3)\n            A = np.sign(q_val) / np.sqrt(3.0)\n            root_single = 2.0*A\n            root_double = -A\n            \n            return sorted([root_single, root_double, root_double])\n\n\n    for test_name, q_func in test_cases:\n        Q_vals = q_func(x)\n        \n        u_L = np.zeros(N)\n        u_R = np.zeros(N)\n\n        for i in range(N):\n            q_i = Q_vals[i]\n            roots = solve_cubic_real_roots(q_i)\n            \n            # R_L selects the smallest real root\n            u_L[i] = roots[0]\n            # R_R selects the largest real root\n            u_R[i] = roots[-1]\n\n        # Compute the required metrics\n        mean_u_L = np.mean(u_L)\n        mean_u_R = np.mean(u_R)\n        l2_diff_norm = np.sqrt(DX * np.sum((u_L - u_R)**2))\n        \n        all_results.extend([mean_u_L, mean_u_R, l2_diff_norm])\n\n    # Format the final output string exactly as specified\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}