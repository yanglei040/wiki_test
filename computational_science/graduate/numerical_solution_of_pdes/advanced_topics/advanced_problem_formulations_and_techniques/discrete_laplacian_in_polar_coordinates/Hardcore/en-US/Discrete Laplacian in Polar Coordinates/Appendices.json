{
    "hands_on_practices": [
        {
            "introduction": "This first practice is a fundamental step in developing any numerical solver: verification. We will implement the standard finite-difference approximation for the Laplacian in polar coordinates and test its consistency. By applying our discrete operator to known exact solutions of the continuous equation, we can verify that our code is correct and gain insight into the nature of its truncation error .",
            "id": "3379318",
            "problem": "Consider the Laplace operator in polar coordinates acting on a sufficiently smooth scalar field $u(r,\\theta)$, defined on a ring domain with inner radius strictly positive to avoid the coordinate singularity at $r=0$. The target of this task is to verify the consistency of a discrete approximation of the polar Laplacian when applied to exact harmonic functions constructed in Cartesian variables and mapped to polar coordinates via $x=r\\cos\\theta$ and $y=r\\sin\\theta$. Consistency means that when the discrete operator is applied to an exact solution of the continuous equation, the resulting discrete residual tends to zero as the discretization is refined.\n\nFundamental base: The Laplace operator in Cartesian coordinates is defined by $\\nabla^2 u = \\partial^2 u/\\partial x^2 + \\partial^2 u/\\partial y^2$, and its expression in polar coordinates $(r,\\theta)$ is a well-tested fact given by $\\nabla^2 u = \\partial^2 u/\\partial r^2 + (1/r)\\,\\partial u/\\partial r + (1/r^2)\\,\\partial^2 u/\\partial \\theta^2$. A standard approach in the numerical solution of Partial Differential Equations (PDE) is to replace spatial derivatives by finite differences computed on a grid, while observing the structure dictated by the coordinate system.\n\nTask: Implement a program that constructs a uniform tensor-product grid in $(r,\\theta)$ with $N_r$ radial nodes on $[r_{\\min},R]$ and $N_\\theta$ angular nodes on $[0,2\\pi)$, where angles must be interpreted in radians. The angular direction must be treated as periodic with period $2\\pi$. The inner radius must satisfy $r_{\\min}>0$ to avoid the singular $(1/r)$ and $(1/r^2)$ factors at $r=0$. On this grid, define the discrete polar Laplacian by consistently approximating the three derivative terms by second-order centered finite differences in $r$ and in $\\theta$. Apply this discrete operator to the following exact harmonic functions written originally in Cartesian variables and mapped to polar coordinates through $x=r\\cos\\theta$ and $y=r\\sin\\theta$:\n- $u_1(x,y) = x^2 - y^2$, which maps to $u_1(r,\\theta) = r^2 \\cos(2\\theta)$.\n- $u_2(x,y) = x$, which maps to $u_2(r,\\theta) = r \\cos(\\theta)$.\n- $u_3(x,y) = \\operatorname{Re}\\big((x+\\mathrm{i}y)^3\\big)$, which maps to $u_3(r,\\theta) = r^3 \\cos(3\\theta)$.\n- $u_4(x,y) = c$ for a constant $c$, which maps to $u_4(r,\\theta) = c$.\n\nFor each test case, compute the discrete residual of the Laplacian as the pointwise application of the discrete operator to the exact function values on the grid, and report the maximum absolute residual over all interior radial indices $i\\in\\{1,\\dots,N_r-2\\}$ and all angular indices $j\\in\\{0,\\dots,N_\\theta-1\\}$. Do not include boundary radial points at $i=0$ and $i=N_r-1$ in the residual, so that only interior second-order stencils are used. The angular direction must be treated with periodic neighbors at $j=-1$ and $j=N_\\theta$ identified with $j=N_\\theta-1$ and $j=0$, respectively.\n\nAngle unit requirement: All angles $\\theta$ must be expressed and interpreted in radians.\n\nYou must implement the program to evaluate the following test suite, where all quantities are dimensionless:\n- Test case $1$: $N_r=64$, $N_\\theta=64$, $r_{\\min}=0.1$, $R=1.0$, function $u(r,\\theta)=r^2\\cos(2\\theta)$.\n- Test case $2$: $N_r=8$, $N_\\theta=16$, $r_{\\min}=0.1$, $R=1.0$, function $u(r,\\theta)=r^2\\cos(2\\theta)$.\n- Test case $3$: $N_r=64$, $N_\\theta=64$, $r_{\\min}=10^{-3}$, $R=1.0$, function $u(r,\\theta)=r\\cos(\\theta)$.\n- Test case $4$: $N_r=100$, $N_\\theta=80$, $r_{\\min}=0.05$, $R=2.0$, function $u(r,\\theta)=r^3\\cos(3\\theta)$.\n- Test case $5$: $N_r=64$, $N_\\theta=64$, $r_{\\min}=0.1$, $R=1.0$, function $u(r,\\theta)=2$.\n\nFor each test case, the program must compute a single floating-point number: the maximum absolute discrete residual over the specified interior set. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,r_3,r_4,r_5]$), where $r_k$ is the result for test case $k$, in the order given above.\n\nThe solution is expected to demonstrate, by computation, that the discrete residual tends to be smaller for finer grids and remains bounded near small $r_{\\min}$, confirming the consistency of the discrete polar Laplacian with the continuous operator for smooth harmonic functions. No physical units are involved in the output beyond the specified angle unit condition; all reported values are pure numbers.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\n- **Laplace Operator (Cartesian)**: $\\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2}$.\n- **Laplace Operator (Polar)**: $\\nabla^2 u = \\frac{\\partial^2 u}{\\partial r^2} + \\frac{1}{r}\\frac{\\partial u}{\\partial r} + \\frac{1}{r^2}\\frac{\\partial^2 u}{\\partial \\theta^2}$.\n- **Domain**: A ring with inner radius $r_{\\min} > 0$ and outer radius $R$.\n- **Grid**: A uniform tensor-product grid in $(r,\\theta)$ with $N_r$ radial nodes on $[r_{\\min}, R]$ and $N_\\theta$ angular nodes on $[0, 2\\pi)$.\n- **Angular Periodicity**: The angular direction is periodic with period $2\\pi$. All angles are in radians.\n- **Discrete Operator**: Second-order centered finite differences for all three derivative terms.\n- **Harmonic Test Functions**: The discrete Laplacian is to be applied to the following exact harmonic functions, mapped to polar coordinates:\n    1.  $u_1(x,y) = x^2 - y^2 \\implies u_1(r,\\theta) = r^2 \\cos(2\\theta)$.\n    2.  $u_2(x,y) = x \\implies u_2(r,\\theta) = r \\cos(\\theta)$.\n    3.  $u_3(x,y) = \\operatorname{Re}\\big((x+\\mathrm{i}y)^3\\big) \\implies u_3(r,\\theta) = r^3 \\cos(3\\theta)$.\n    4.  $u_4(x,y) = c \\implies u_4(r,\\theta) = c$.\n- **Residual Calculation**: The quantity to be computed is the maximum absolute value of the pointwise discrete residual, defined as the application of the discrete operator to the exact function values. This maximum is taken over all interior radial indices $i \\in \\{1, \\dots, N_r-2\\}$ and all angular indices $j \\in \\{0, \\dots, N_\\theta-1\\}$.\n- **Test Suite**:\n    - **Case 1**: $N_r=64$, $N_\\theta=64$, $r_{\\min}=0.1$, $R=1.0$, $u(r,\\theta)=r^2\\cos(2\\theta)$.\n    - **Case 2**: $N_r=8$, $N_\\theta=16$, $r_{\\min}=0.1$, $R=1.0$, $u(r,\\theta)=r^2\\cos(2\\theta)$.\n    - **Case 3**: $N_r=64$, $N_\\theta=64$, $r_{\\min}=10^{-3}$, $R=1.0$, $u(r,\\theta)=r\\cos(\\theta)$.\n    - **Case 4**: $N_r=100$, $N_\\theta=80$, $r_{\\min}=0.05$, $R=2.0$, $u(r,\\theta)=r^3\\cos(3\\theta)$.\n    - **Case 5**: $N_r=64$, $N_\\theta=64$, $r_{\\min}=0.1$, $R=1.0$, $u(r,\\theta)=2$.\n- **Output Format**: A single line of output with a comma-separated list of results for each test case, enclosed in square brackets. Example: `[r_1,r_2,r_3,r_4,r_5]`.\n\n### Step 2: Validate Using Extracted Givens\n\n1.  **Scientifically Grounded**: The problem is fundamentally sound. The expressions for the Laplacian in both Cartesian and polar coordinates are correct and standard in vector calculus and physics. The test functions provided are indeed harmonic (i.e., $\\nabla^2 u = 0$ in Cartesian coordinates), which is a key requirement for a Method of Manufactured Solutions verification test. The use of finite differences to approximate derivatives is a cornerstone of numerical methods for PDEs.\n2.  **Well-Posed**: The problem is well-posed. All parameters and procedures required to compute a unique result for each test case are explicitly defined. The grid generation, the finite difference stencils, the handling of periodic boundary conditions, and the domain for computing the final residual are all specified unambiguously. This ensures that a single, stable, and meaningful numerical answer exists for each test case.\n3.  **Objective**: The problem statement is written in precise, objective mathematical language. It is free of any ambiguity, subjectivity, or opinion-based claims.\n4.  **Completeness**: The problem is self-contained. It provides all necessary information, including grid parameters ($N_r, N_\\theta, r_{\\min}, R$), the exact form of the test functions, and the precise definition of the quantity to be computed.\n5.  **No Other Flaws**: The problem does not exhibit any other flaws such as being non-formalizable, contradictory, unrealistic, ill-posed, trivial, or unverifiable. It is a standard and well-formulated problem in the field of numerical analysis.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined task in computational mathematics to verify the consistency of a numerical scheme. I will now proceed with the solution.\n\n## Solution\n\nThe task is to compute the consistency of a finite-difference approximation to the polar Laplacian operator. Consistency is tested by applying the discrete operator to known analytical solutions of the continuous equation ($\\nabla^2 u = 0$) and verifying that the resulting discrete residual approaches zero as the grid is refined. The residual is simply the value of the discrete Laplacian applied to the function, since the continuous Laplacian is zero.\n\n### 1. Grid and Function Discretization\nA discrete grid in $(r,\\theta)$ coordinates is constructed. The grid points are $(r_i, \\theta_j)$ where:\n- $r_i = r_{\\min} + i \\cdot \\Delta r$ for $i \\in \\{0, 1, \\dots, N_r-1\\}$. The radial step size is $\\Delta r = \\frac{R - r_{\\min}}{N_r - 1}$.\n- $\\theta_j = j \\cdot \\Delta \\theta$ for $j \\in \\{0, 1, \\dots, N_\\theta-1\\}$. The angular step size is $\\Delta \\theta = \\frac{2\\pi}{N_\\theta}$. The domain for $\\theta$ is $[0, 2\\pi)$.\n\nThe value of a function $u(r,\\theta)$ on this grid is denoted by $u_{i,j} = u(r_i, \\theta_j)$.\n\n### 2. Finite Difference Approximation\nThe polar Laplacian is $\\nabla^2 u = \\frac{\\partial^2 u}{\\partial r^2} + \\frac{1}{r}\\frac{\\partial u}{\\partial r} + \\frac{1}{r^2}\\frac{\\partial^2 u}{\\partial \\theta^2}$. We approximate each term at an interior grid point $(r_i, \\theta_j)$ using second-order centered differences:\n\n1.  **Second radial derivative**:\n    $$ \\left. \\frac{\\partial^2 u}{\\partial r^2} \\right|_{i,j} \\approx \\frac{u_{i+1, j} - 2u_{i, j} + u_{i-1, j}}{(\\Delta r)^2} $$\n\n2.  **First radial derivative**:\n    $$ \\left. \\frac{1}{r} \\frac{\\partial u}{\\partial r} \\right|_{i,j} \\approx \\frac{1}{r_i} \\frac{u_{i+1, j} - u_{i-1, j}}{2 \\Delta r} $$\n\n3.  **Second angular derivative**:\n    $$ \\left. \\frac{1}{r^2} \\frac{\\partial^2 u}{\\partial \\theta^2} \\right|_{i,j} \\approx \\frac{1}{r_i^2} \\frac{u_{i, j+1} - 2u_{i, j} + u_{i, j-1}}{(\\Delta \\theta)^2} $$\n    The angular indices are handled periodically. For an index $j$, the neighbors are $(j-1 \\pmod{N_\\theta})$ and $(j+1 \\pmod{N_\\theta})$.\n\n### 3. Discrete Laplacian Operator\nThe discrete Laplacian $(\\nabla^2_d u)_{i,j}$ at an interior point $(i, j)$ where $i \\in \\{1, \\dots, N_r-2\\}$ is the sum of these three approximations:\n$$ (\\nabla^2_d u)_{i,j} = \\frac{u_{i+1, j} - 2u_{i, j} + u_{i-1, j}}{(\\Delta r)^2} + \\frac{1}{r_i} \\frac{u_{i+1, j} - u_{i-1, j}}{2 \\Delta r} + \\frac{1}{r_i^2} \\frac{u_{i, j+1 \\pmod{N_\\theta}} - 2u_{i, j} + u_{i, j-1 \\pmod{N_\\theta}}}{(\\Delta \\theta)^2} $$\n\n### 4. Computation of the Maximum Residual\nThe residual is defined as $(\\nabla^2_d u)_{i,j}$, as the exact continuous Laplacian of the given test functions is zero. The program will execute the following steps for each test case:\n1.  Set up the grid parameters $N_r, N_\\theta, r_{\\min}, R$.\n2.  Compute the grid step sizes $\\Delta r$ and $\\Delta \\theta$.\n3.  Create the 2D grid of coordinates $(r_i, \\theta_j)$ and evaluate the specified harmonic function $u(r, \\theta)$ at each grid point to obtain the matrix $U = [u_{i,j}]$.\n4.  Compute the discrete Laplacian matrix $(\\nabla^2_d U)$ for all interior radial points, i.e., for $i \\in \\{1, \\dots, N_r-2\\}$. This can be done efficiently using vectorized array operations.\n5.  Find the maximum absolute value over all elements of the resulting interior residual matrix. This single floating-point number is the result for the test case.\n\nThis procedure is repeated for all five test cases, and the results are collected and formatted as specified. For example, for the constant function $u=c$, all finite differences are identically zero, so the residual is expected to be $0.0$. For other functions, the residual is the truncation error of the approximation, which should decrease with grid refinement (i.e., as $\\Delta r, \\Delta \\theta \\to 0$), confirming the consistency of the scheme.",
            "answer": "```python\nimport numpy as np\n\ndef compute_max_residual(Nr, Ntheta, r_min, R, func_name):\n    \"\"\"\n    Computes the maximum absolute residual of a discrete polar Laplacian operator.\n\n    Args:\n        Nr (int): Number of radial grid points.\n        Ntheta (int): Number of angular grid points.\n        r_min (float): Inner radius.\n        R (float): Outer radius.\n        func_name (str): The name of the harmonic function to test ('u1', 'u2', 'u3', 'u4').\n\n    Returns:\n        float: The maximum absolute residual over the interior grid points.\n    \"\"\"\n    # 1. Grid and Function Discretization\n    # Define grid spacing\n    dr = (R - r_min) / (Nr - 1)\n    dtheta = 2 * np.pi / Ntheta\n\n    # Create grid coordinates\n    # r includes both endpoints. Shape: (Nr,)\n    r = np.linspace(r_min, R, Nr)\n    # theta is exclusive of 2*pi. Shape: (Ntheta,)\n    theta = np.linspace(0, 2 * np.pi, Ntheta, endpoint=False)\n\n    # Create a 2D meshgrid. R_grid and T_grid have shape (Nr, Ntheta)\n    R_grid, T_grid = np.meshgrid(r, theta, indexing='ij')\n\n    # Evaluate the test function on the grid\n    U = None\n    if func_name == 'u1':\n        # u(r,θ) = r^2 * cos(2θ)\n        U = R_grid**2 * np.cos(2 * T_grid)\n    elif func_name == 'u2':\n        # u(r,θ) = r * cos(θ)\n        U = R_grid * np.cos(T_grid)\n    elif func_name == 'u3':\n        # u(r,θ) = r^3 * cos(3θ)\n        U = R_grid**3 * np.cos(3 * T_grid)\n    elif func_name == 'u4':\n        # u(r,θ) = 2\n        U = np.full_like(R_grid, 2.0)\n\n    # 2. Finite Difference Approximation on Interior Grid\n    # The residual is only computed on interior radial points i = 1, ..., Nr-2.\n    # We use array slicing to select these points.\n    \n    # Slices of U for neighbor points\n    # U_interior has shape (Nr-2, Ntheta)\n    U_interior = U[1:-1, :]\n    # U_ip1 (i+1) and U_im1 (i-1) also have shape (Nr-2, Ntheta)\n    U_ip1 = U[2:, :]\n    U_im1 = U[:-2, :]\n\n    # Radial grid points corresponding to the interior\n    # r_interior has shape (Nr-2,). We reshape for broadcasting.\n    r_interior = r[1:-1]\n    r_interior_col = r_interior[:, np.newaxis]\n\n    # Calculate radial derivative terms\n    d2u_dr2 = (U_ip1 - 2 * U_interior + U_im1) / (dr**2)\n    du_dr_term = (1 / r_interior_col) * (U_ip1 - U_im1) / (2 * dr)\n    \n    # Calculate angular derivative term with periodic boundary conditions\n    # np.roll handles periodicity efficiently. axis=1 is the theta dimension.\n    U_jp1 = np.roll(U_interior, -1, axis=1)\n    U_jm1 = np.roll(U_interior, 1, axis=1)\n    d2u_dtheta2_term = (1 / r_interior_col**2) * (U_jp1 - 2 * U_interior + U_jm1) / (dtheta**2)\n\n    # 3. Sum terms to get the discrete Laplacian (residual)\n    residual_matrix = d2u_dr2 + du_dr_term + d2u_dtheta2_term\n    \n    # 4. Find the maximum absolute residual\n    max_abs_residual = np.max(np.abs(residual_matrix))\n    \n    return max_abs_residual\n\ndef solve():\n    \"\"\"\n    Executes the defined test suite for the discrete polar Laplacian.\n    \"\"\"\n    # (Nr, Ntheta, r_min, R, function_name)\n    test_cases = [\n        (64, 64, 0.1, 1.0, 'u1'),  # Test case 1\n        (8, 16, 0.1, 1.0, 'u1'),   # Test case 2\n        (64, 64, 1e-3, 1.0, 'u2'), # Test case 3\n        (100, 80, 0.05, 2.0, 'u3'),# Test case 4\n        (64, 64, 0.1, 1.0, 'u4'),  # Test case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        Nr, Ntheta, r_min, R, func_name = case\n        result = compute_max_residual(Nr, Ntheta, r_min, R, func_name)\n        results.append(result)\n\n    # Format the output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Standard uniform grids can be inefficient for problems with sharp gradients or singularities. This exercise explores a powerful technique to improve accuracy by adapting the grid to the solution's behavior through a coordinate transformation. You will derive, implement, and compare a discretization based on a logarithmic radial coordinate, $\\rho = \\ln(r)$, against a standard uniform grid, quantifying the significant resolution gains near the origin for functions with steep radial profiles .",
            "id": "3379306",
            "problem": "You are to study the discrete approximation of the two-dimensional Laplacian in polar coordinates for a scalar field $u(r,\\theta)$ on an annular domain. The goal is to compare uniform radial spacing in $r$ against uniform spacing in the logarithmic radial coordinate $\\rho=\\ln r$ for resolving steep gradients near the inner boundary $r\\to 0$. Your analysis and program must be based on first principles and must not rely on pre-given discretization formulas beyond fundamental calculus and coordinate definitions.\n\nThe fundamental base you may use is the definition of the Laplacian in two dimensions and the polar coordinate transformation, together with the chain rule from calculus. Let the annulus be defined by $r\\in[r_\\min,r_\\max]$ with $r_\\min>0$, and let $\\theta\\in[0,2\\pi)$ in radians. You will consider a smooth but steep function near $r=r_\\min$ of the form $u(r,\\theta)=r^\\gamma\\cos(k\\theta)$ where $\\gamma\\in(0,1)$ and $k\\in\\mathbb{N}$.\n\nYou must start from the continuous Laplacian in polar coordinates derived from the Cartesian Laplacian using standard coordinate transformations and the chain rule, and then derive consistent second-order central difference approximations in two settings:\n- A uniform grid in the radial coordinate $r$ and a uniform grid in the angular coordinate $\\theta$ with periodic boundary conditions in $\\theta$.\n- A uniform grid in the logarithmic radial coordinate $\\rho=\\ln r$ and a uniform grid in the angular coordinate $\\theta$, again with periodic boundary conditions in $\\theta$.\n\nIn both settings, you should compute the discrete Laplacian operator at the interior radial nodes only (exclude the first and last radial nodes from the stencil to avoid boundary closure complications). Along $\\theta$, use periodicity to form centered stencils at all angular nodes. The angle unit is radians.\n\nTo quantify accuracy, compare the discrete Laplacian against the exact continuous Laplacian of $u(r,\\theta)$ obtained analytically. Use an area-weighted $L^2$ relative error over the interior radial nodes and all angular nodes, with the weight given by the polar area element $r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta$ approximated on the grid. Explicitly, if $D_h u$ denotes the discrete Laplacian and $D u$ denotes the exact Laplacian, your relative error should be\n$$\nE = \\frac{\\left(\\sum_{i,j} w_{i,j}\\,\\left(D_h u(r_i,\\theta_j)-D u(r_i,\\theta_j)\\right)^2\\right)^{1/2}}{\\left(\\sum_{i,j} w_{i,j}\\,\\left(D u(r_i,\\theta_j)\\right)^2\\right)^{1/2}},\n$$\nwhere $w_{i,j}$ approximates the area element $r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta$ at the node $(r_i,\\theta_j)$, using a consistent interior-node radial spacing $\\mathrm{d}r_i$ (for example, $\\mathrm{d}r_i=\\frac{1}{2}(r_{i+1}-r_{i-1})$ at interior nodes). In the uniform $\\rho$ case, you should apply the coordinate transform consistently and still weight the error in physical space using $r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta$.\n\nAdditionally, report a resolution metric that captures the near-origin refinement benefit of logarithmic spacing. Define the near-origin resolution gain $G$ as\n$$\nG=\\frac{\\Delta r_{\\min}^{\\text{uniform-}r}}{\\Delta r_{\\min}^{\\text{uniform-}\\rho}},\n$$\nwhere $\\Delta r_{\\min}^{\\text{uniform-}r}$ is the smallest radial spacing between the first two radial nodes for the uniform $r$ grid and $\\Delta r_{\\min}^{\\text{uniform-}\\rho}$ is the smallest radial spacing between the first two radial nodes for the grid that is uniform in $\\rho$. This ratio $G$ should be computed for each test case.\n\nImplement both discretizations and compute:\n- $E_r$: the area-weighted $L^2$ relative error of the discrete Laplacian on the uniform $r$ grid,\n- $E_\\rho$: the area-weighted $L^2$ relative error of the discrete Laplacian on the uniform $\\rho$ grid,\n- $Q=E_\\rho/E_r$: the error ratio comparing the two discretizations,\n- $G$: the near-origin resolution gain defined above.\n\nYour program must evaluate the following test suite of parameter sets, which cover a range of behaviors including a general case, steep near-origin gradients, coarse resolution, and high angular frequency. Angles are in radians.\n\nTest Suite:\n- Case $1$: $r_\\min=1\\times 10^{-3}$, $r_\\max=1$, $N_r=200$, $N_\\theta=128$, $\\gamma=0.2$, $k=3$.\n- Case $2$: $r_\\min=1\\times 10^{-6}$, $r_\\max=1$, $N_r=200$, $N_\\theta=128$, $\\gamma=0.2$, $k=3$.\n- Case $3$: $r_\\min=1\\times 10^{-3}$, $r_\\max=1$, $N_r=50$, $N_\\theta=64$, $\\gamma=0.2$, $k=3$.\n- Case $4$: $r_\\min=1\\times 10^{-3}$, $r_\\max=10$, $N_r=200$, $N_\\theta=128$, $\\gamma=0.2$, $k=8$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the four values $[E_r,E_\\rho,Q,G]$ for Case $1$ first, followed by Case $2$, Case $3$, and Case $4$ in order, flattened into a single list. For example, the output format must be\n$[E_{r,1},E_{\\rho,1},Q_1,G_1,E_{r,2},E_{\\rho,2},Q_2,G_2,E_{r,3},E_{\\rho,3},Q_3,G_3,E_{r,4},E_{\\rho,4},Q_4,G_4]$.",
            "solution": "The objective of this problem is to derive and compare two finite difference-based numerical approximations for the Laplacian operator in polar coordinates, applied to a function exhibiting steep gradients near the origin. The comparison will be performed on an annular domain defined by $r \\in [r_\\min, r_\\max]$ and $\\theta \\in [0, 2\\pi)$. The two schemes are based on a grid that is uniform in the $(r, \\theta)$ coordinates and a grid that is uniform in the logarithmic-polar $(\\rho, \\theta)$ coordinates, where $\\rho = \\ln r$.\n\n### 1. Continuous Laplacian Operator\n\nThe analysis begins with the Laplacian operator, $\\nabla^2$, in Cartesian coordinates $(x, y)$:\n$$\n\\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2}\n$$\nThe transformation to polar coordinates is given by $x = r\\cos\\theta$ and $y = r\\sin\\theta$. Using the chain rule to transform the partial derivatives, one obtains the well-known expression for the Laplacian in polar coordinates:\n$$\n\\nabla^2 u(r, \\theta) = \\frac{\\partial^2 u}{\\partial r^2} + \\frac{1}{r} \\frac{\\partial u}{\\partial r} + \\frac{1}{r^2} \\frac{\\partial^2 u}{\\partial \\theta^2}\n$$\nThis form is suitable for discretizations on a grid with uniform spacing in $r$.\n\nFor the second case, we introduce the logarithmic radial coordinate $\\rho = \\ln r$, which implies $r = e^\\rho$. We transform the radial derivatives using the chain rule:\n$$\n\\frac{\\partial u}{\\partial r} = \\frac{\\partial u}{\\partial \\rho} \\frac{\\mathrm{d}\\rho}{\\mathrm{d}r} = \\frac{\\partial u}{\\partial \\rho} \\frac{1}{r}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial r^2} = \\frac{\\partial}{\\partial r}\\left(\\frac{1}{r} \\frac{\\partial u}{\\partial \\rho}\\right) = -\\frac{1}{r^2}\\frac{\\partial u}{\\partial \\rho} + \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left(\\frac{\\partial u}{\\partial \\rho}\\right) = -\\frac{1}{r^2}\\frac{\\partial u}{\\partial \\rho} + \\frac{1}{r^2}\\frac{\\partial^2 u}{\\partial \\rho^2}\n$$\nSubstituting these into the polar Laplacian formula yields:\n$$\n\\nabla^2 u = \\left(-\\frac{1}{r^2}\\frac{\\partial u}{\\partial \\rho} + \\frac{1}{r^2}\\frac{\\partial^2 u}{\\partial \\rho^2}\\right) + \\frac{1}{r}\\left(\\frac{1}{r} \\frac{\\partial u}{\\partial \\rho}\\right) + \\frac{1}{r^2}\\frac{\\partial^2 u}{\\partial \\theta^2}\n$$\nThe first-derivative terms in $\\rho$ cancel, resulting in a remarkably simple form:\n$$\n\\nabla^2 u(\\rho, \\theta) = \\frac{1}{r^2} \\left( \\frac{\\partial^2 u}{\\partial \\rho^2} + \\frac{\\partial^2 u}{\\partial \\theta^2} \\right) = e^{-2\\rho} \\left( \\frac{\\partial^2 u}{\\partial \\rho^2} + \\frac{\\partial^2 u}{\\partial \\theta^2} \\right)\n$$\nThis form is advantageous because the differential operator within the parentheses is the standard Cartesian Laplacian in $(\\rho, \\theta)$ coordinates, which is naturally suited for a grid with uniform spacing in $\\rho$ and $\\theta$.\n\n### 2. Analytical Laplacian of the Test Function\n\nThe problem specifies the test function $u(r,\\theta) = r^\\gamma\\cos(k\\theta)$. We compute its exact Laplacian, denoted as $D u$, using the polar coordinate formulation. The required partial derivatives are:\n$$\n\\frac{\\partial u}{\\partial r} = \\gamma r^{\\gamma-1} \\cos(k\\theta)\n$$\n$$\n\\frac{\\partial^2 u}{\\partial r^2} = \\gamma(\\gamma-1) r^{\\gamma-2} \\cos(k\\theta)\n$$\n$$\n\\frac{\\partial^2 u}{\\partial \\theta^2} = -k^2 r^\\gamma \\cos(k\\theta)\n$$\nSubstituting these into the polar Laplacian equation:\n$$\nD u = \\nabla^2 u = \\gamma(\\gamma-1) r^{\\gamma-2} \\cos(k\\theta) + \\frac{1}{r} (\\gamma r^{\\gamma-1} \\cos(k\\theta)) + \\frac{1}{r^2} (-k^2 r^\\gamma \\cos(k\\theta))\n$$\n$$\nD u = (\\gamma(\\gamma-1) + \\gamma - k^2) r^{\\gamma-2} \\cos(k\\theta) = (\\gamma^2 - k^2) r^{\\gamma-2} \\cos(k\\theta)\n$$\nThis is the analytical expression against which the numerical approximations will be compared.\n\n### 3. Grid Generation and Discretization\n\nWe define two types of grids over the domain, both having $N_r$ points in the radial direction and $N_\\theta$ points in the angular direction. The angular grid is uniform in both cases: $\\theta_j = j \\Delta\\theta$ for $j=0, 1, \\dots, N_\\theta-1$, with $\\Delta\\theta = 2\\pi/N_\\theta$.\n\n#### 3.1. Uniform $(r, \\theta)$ Grid\nThe radial nodes are spaced uniformly: $r_i = r_\\min + i \\Delta r$ for $i=0, 1, \\dots, N_r-1$, where $\\Delta r = (r_\\max - r_\\min)/(N_r-1)$. We apply second-order central difference formulas to the polar Laplacian at an interior node $(r_i, \\theta_j)$:\n$$\n(D_h u)_{i,j} = \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{(\\Delta r)^2} + \\frac{1}{r_i}\\frac{u_{i+1,j} - u_{i-1,j}}{2\\Delta r} + \\frac{1}{r_i^2}\\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{(\\Delta\\theta)^2}\n$$\nThis formula is evaluated for interior radial nodes $i=1, \\dots, N_r-2$. For the angular derivative, periodicity implies $u_{i,N_\\theta} = u_{i,0}$ and $u_{i,-1} = u_{i,N_\\theta-1}$.\n\n#### 3.2. Uniform $(\\rho, \\theta)$ Grid\nThe logarithmic radial nodes are spaced uniformly: $\\rho_i = \\rho_\\min + i \\Delta\\rho$ for $i=0, 1, \\dots, N_r-1$, where $\\rho_\\min = \\ln r_\\min$, $\\rho_\\max = \\ln r_\\max$, and $\\Delta\\rho = (\\rho_\\max - \\rho_\\min)/(N_r-1)$. The physical radial nodes are then $r_i = e^{\\rho_i}$. Using the simplified Laplacian form in $(\\rho, \\theta)$ coordinates, the discrete operator at $(r_i, \\theta_j)$ is:\n$$\n(D_h u)_{i,j} = \\frac{1}{r_i^2} \\left(\\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{(\\Delta\\rho)^2} + \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{(\\Delta\\theta)^2}\\right)\n$$\nThis is also evaluated for $i=1, \\dots, N_r-2$, with periodic handling of the $\\theta$ indices.\n\n### 4. Error and Resolution Metrics\n\nThe accuracy of each discretization is quantified by the area-weighted $L^2$ relative error, $E$:\n$$\nE = \\frac{\\left(\\sum_{i,j} w_{i,j}\\,\\left(D_h u(r_i,\\theta_j)-D u(r_i,\\theta_j)\\right)^2\\right)^{1/2}}{\\left(\\sum_{i,j} w_{i,j}\\,\\left(D u(r_i,\\theta_j)\\right)^2\\right)^{1/2}}\n$$\nThe sum is taken over the interior radial nodes ($i=1, \\dots, N_r-2$) and all angular nodes ($j=0, \\dots, N_\\theta-1$). The area weight $w_{i,j}$ approximates the polar area element $r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta$ at node $(r_i, \\theta_j)$. It is given by $w_{i,j} = r_i \\Delta r_i \\Delta\\theta$, where $\\Delta r_i = \\frac{1}{2}(r_{i+1}-r_{i-1})$ is the centered radial cell width.\n- For the uniform $r$ grid, $\\Delta r_i = \\Delta r$.\n- For the uniform $\\rho$ grid, $\\Delta r_i = \\frac{1}{2}(e^{\\rho_i+\\Delta\\rho} - e^{\\rho_i-\\Delta\\rho}) = r_i \\sinh(\\Delta\\rho)$.\n\nTo compare the grids, we compute the error ratio $Q = E_\\rho / E_r$, where $E_r$ and $E_\\rho$ are the errors for the uniform-$r$ and uniform-$\\rho$ grids, respectively.\n\nThe near-origin resolution gain, $G$, is defined as the ratio of the first radial cell width for the two grids:\n$$\nG = \\frac{\\Delta r_{\\min}^{\\text{uniform-}r}}{\\Delta r_{\\min}^{\\text{uniform-}\\rho}} = \\frac{r_1^{\\text{uniform}}-r_0^{\\text{uniform}}}{r_1^{\\text{log}}-r_0^{\\text{log}}} = \\frac{\\Delta r}{r_\\min (e^{\\Delta\\rho}-1)}\n$$\nThis metric quantifies how much finer the logarithmic grid is near the inner boundary $r=r_\\min$. These derived formulas form the basis of the numerical implementation.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n\n    def calculate_metrics_for_case(r_min, r_max, N_r, N_theta, gamma, k):\n        \"\"\"\n        Calculates the error and resolution metrics for a single test case.\n\n        Args:\n            r_min (float): Minimum radius of the annulus.\n            r_max (float): Maximum radius of the annulus.\n            N_r (int): Number of radial grid points.\n            N_theta (int): Number of angular grid points.\n            gamma (float): Exponent in the radial part of the test function.\n            k (int): Wavenumber in the angular part of the test function.\n\n        Returns:\n            list: A list containing [E_r, E_rho, Q, G].\n        \"\"\"\n        # Define the exact analytical functions\n        u_exact_func = lambda r, theta: (r**gamma) * np.cos(k * theta)\n        Du_exact_func = lambda r, theta: (gamma**2 - k**2) * (r**(gamma - 2)) * np.cos(k * theta)\n        \n        # --- Grid Parameters ---\n        theta = np.linspace(0, 2*np.pi, N_theta, endpoint=False)\n        delta_theta = 2 * np.pi / N_theta\n\n        # --- Grid 1: Uniform in r ---\n        \n        # Grid setup\n        r_uniform = np.linspace(r_min, r_max, N_r)\n        delta_r = (r_max - r_min) / (N_r - 1)\n        R_uniform, THETA = np.meshgrid(r_uniform, theta, indexing='ij')\n\n        # Evaluate function on the grid\n        U_r_grid = u_exact_func(R_uniform, THETA)\n\n        # Compute discrete Laplacian (interior radial nodes only)\n        # Slicing extracts interior points: i from 1 to N_r-2\n        U_r_interior = U_r_grid[1:-1, :]\n        u_im1 = U_r_grid[:-2, :]\n        u_ip1 = U_r_grid[2:, :]\n        # np.roll handles periodic boundary conditions in theta\n        u_jm1 = np.roll(U_r_grid, 1, axis=1)[1:-1, :]\n        u_jp1 = np.roll(U_r_grid, -1, axis=1)[1:-1, :]\n        \n        R_interior_2d = R_uniform[1:-1, :]\n        \n        d2u_dr2 = (u_ip1 - 2*U_r_interior + u_im1) / delta_r**2\n        du_dr = (u_ip1 - u_im1) / (2 * delta_r)\n        d2u_dtheta2 = (u_jp1 - 2*U_r_interior + u_jm1) / delta_theta**2\n        \n        DhU_r_grid = d2u_dr2 + (1/R_interior_2d) * du_dr + (1/R_interior_2d**2) * d2u_dtheta2\n        \n        # Error calculation for uniform-r grid\n        Du_r_grid = Du_exact_func(R_interior_2d, THETA[1:-1, :])\n        w_r = R_interior_2d[:, 0] * delta_r * delta_theta\n        w_r_2d = w_r[:, np.newaxis]\n\n        err_norm_sq_r = np.sum(w_r_2d * (DhU_r_grid - Du_r_grid)**2)\n        exact_norm_sq_r = np.sum(w_r_2d * Du_r_grid**2)\n        E_r = np.sqrt(err_norm_sq_r / exact_norm_sq_r)\n\n        # --- Grid 2: Uniform in rho = ln(r) ---\n        \n        # Grid setup\n        rho_min, rho_max = np.log(r_min), np.log(r_max)\n        rho_uniform = np.linspace(rho_min, rho_max, N_r)\n        delta_rho = (rho_max - rho_min) / (N_r - 1)\n        r_log = np.exp(rho_uniform)\n        R_log, THETA_log = np.meshgrid(r_log, theta, indexing='ij')\n\n        # Evaluate function on the grid\n        U_rho_grid = u_exact_func(R_log, THETA_log)\n\n        # Compute discrete Laplacian (interior radial nodes only)\n        U_rho_interior = U_rho_grid[1:-1, :]\n        u_im1_rho = U_rho_grid[:-2, :]\n        u_ip1_rho = U_rho_grid[2:, :]\n        u_jm1_rho = np.roll(U_rho_grid, 1, axis=1)[1:-1, :]\n        u_jp1_rho = np.roll(U_rho_grid, -1, axis=1)[1:-1, :]\n\n        R_log_interior_2d = R_log[1:-1, np.newaxis]\n\n        d2u_drho2 = (u_ip1_rho - 2*U_rho_interior + u_im1_rho) / delta_rho**2\n        d2u_dtheta2_rho = (u_jp1_rho - 2*U_rho_interior + u_jm1_rho) / delta_theta**2\n\n        DhU_rho_grid = (1/R_log_interior_2d**2) * (d2u_drho2 + d2u_dtheta2_rho)\n\n        # Error calculation for uniform-rho grid\n        Du_rho_grid = Du_exact_func(R_log_interior_2d, THETA_log[1:-1, :])\n        dr_i_log = 0.5 * (r_log[2:] - r_log[:-2]) # dr_i = 0.5 * (r_{i+1} - r_{i-1})\n        w_rho = r_log[1:-1] * dr_i_log * delta_theta\n        w_rho_2d = w_rho[:, np.newaxis]\n\n        err_norm_sq_rho = np.sum(w_rho_2d * (DhU_rho_grid - Du_rho_grid)**2)\n        exact_norm_sq_rho = np.sum(w_rho_2d * Du_rho_grid**2)\n        E_rho = np.sqrt(err_norm_sq_rho / exact_norm_sq_rho)\n\n        # --- Final Metrics Q and G ---\n        Q = E_rho / E_r\n        \n        delta_r_min_uniform = delta_r\n        delta_r_min_log = r_log[1] - r_log[0]\n        G = delta_r_min_uniform / delta_r_min_log\n        \n        return [E_r, E_rho, Q, G]\n\n    # Test suite defined in the problem statement\n    test_cases = [\n        # (r_min, r_max, N_r, N_theta, gamma, k)\n        (1e-3, 1.0, 200, 128, 0.2, 3),\n        (1e-6, 1.0, 200, 128, 0.2, 3),\n        (1e-3, 1.0, 50, 64, 0.2, 3),\n        (1e-3, 10.0, 200, 128, 0.2, 8),\n    ]\n\n    results = []\n    for case in test_cases:\n        case_results = calculate_metrics_for_case(*case)\n        results.extend(case_results)\n\n    # Format the final output as a single comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The discretization of a PDE results in a large system of linear equations, and the efficiency of solving this system is determined by the structure of the system matrix. This practice moves from the local stencil to the global matrix, asking you to analyze the sparsity pattern and bandwidth of the discrete polar Laplacian. Understanding this structure is a critical skill for selecting appropriate linear solvers and predicting the computational cost and memory requirements of your simulation .",
            "id": "3379323",
            "problem": "Consider the scalar Laplace operator in plane polar coordinates, defined by the partial differential equation (PDE) $$\\Delta u = \\frac{\\partial^{2} u}{\\partial r^{2}} + \\frac{1}{r}\\frac{\\partial u}{\\partial r} + \\frac{1}{r^{2}} \\frac{\\partial^{2} u}{\\partial \\theta^{2}},$$ on the annular domain $$\\{(r,\\theta): r_{0} \\le r \\le R,\\; 0 \\le \\theta < 2\\pi\\},$$ with Dirichlet boundary conditions imposed at $$r=r_{0} \\text{ and } r=R,$$ and periodic boundary conditions in the angular direction $$\\theta.$$ Discretize the domain using a uniform radial grid with $$N_{r}$$ interior points and a uniform angular grid with $$N_{\\theta}$$ points. Use the standard second-order Finite Difference Method (FDM) to approximate each derivative with central differences at interior points, and enforce the boundary conditions by eliminating boundary unknowns in the assembled linear system.\n\nAssemble the resulting sparse linear system $$A \\boldsymbol{u} = \\boldsymbol{f}$$ for the unknown vector $$\\boldsymbol{u}$$ of length $$N_{r}N_{\\theta},$$ ordered lexicographically by $$(i,j)$$ with the mapping $$p(i,j) = i + (j-1) N_{r},$$ where $$i \\in \\{1,2,\\dots,N_{r}\\}$$ indexes the radial nodes and $$j \\in \\{1,2,\\dots,N_{\\theta}\\}$$ indexes the angular nodes. Starting from the definition of $$\\Delta$$ in polar coordinates and the central-difference approximations for the radial and angular derivatives, reason from first principles to identify which grid neighbors couple to a given interior point $$(i,j).$$ Using this, characterize the qualitative sparsity pattern of the matrix $$A$$ under the given ordering, and then determine the full bandwidth of $$A,$$ defined as $$2k+1$$ where $$k$$ is the maximum integer such that $$A_{p,q}=0$$ whenever $$|p-q|>k.$$\n\nProvide your final answer as a single closed-form analytic expression for the full bandwidth in terms of $$N_{r}$$ and $$N_{\\theta}.$$ No rounding is required.",
            "solution": "The problem statement has been validated and is deemed scientifically grounded, well-posed, and objective. It represents a standard problem in the numerical solution of partial differential equations. We may proceed with the solution.\n\nThe problem asks for the full bandwidth of the matrix $A$ that arises from the finite difference discretization of the Laplace operator in polar coordinates on an annular domain. The bandwidth is determined by the coupling between grid points and the chosen ordering of the unknowns in the solution vector $\\boldsymbol{u}$.\n\nFirst, we establish the discretization of the domain and the governing equation. The domain is discretized by a uniform grid in $r$ and $\\theta$. The radial coordinates of the interior grid points are $r_i = r_0 + i \\Delta r$ for $i \\in \\{1, 2, \\dots, N_r\\}$, where $\\Delta r = (R - r_0) / (N_r + 1)$. The angular coordinates are $\\theta_j = (j-1) \\Delta \\theta$ for $j \\in \\{1, 2, \\dots, N_\\theta\\}$, where $\\Delta \\theta = 2\\pi / N_\\theta$. The unknown at a grid point $(r_i, \\theta_j)$ is denoted by $u_{i,j}$.\n\nThe Laplace operator in polar coordinates is given as:\n$$ \\Delta u = \\frac{\\partial^{2} u}{\\partial r^{2}} + \\frac{1}{r}\\frac{\\partial u}{\\partial r} + \\frac{1}{r^{2}} \\frac{\\partial^{2} u}{\\partial \\theta^{2}} $$\nWe use second-order central difference approximations for the derivatives at an interior grid point $(r_i, \\theta_j)$:\n$$ \\frac{\\partial^{2} u}{\\partial r^{2}} \\bigg|_{(i,j)} \\approx \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{(\\Delta r)^2} $$\n$$ \\frac{\\partial u}{\\partial r} \\bigg|_{(i,j)} \\approx \\frac{u_{i+1,j} - u_{i-1,j}}{2 \\Delta r} $$\n$$ \\frac{\\partial^{2} u}{\\partial \\theta^{2}} \\bigg|_{(i,j)} \\approx \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{(\\Delta \\theta)^2} $$\nSubstituting these approximations into the homogeneous Laplace equation, $\\Delta u = 0$, and grouping terms for each unknown, we find that the discrete equation at point $(i,j)$ has the form:\n$$ c_{i,j}^{(0)} u_{i,j} + c_{i,j}^{(r+)} u_{i+1,j} + c_{i,j}^{(r-)} u_{i-1,j} + c_{i,j}^{(\\theta+)} u_{i,j+1} + c_{i,j}^{(\\theta-)} u_{i,j-1} = f_{i,j} $$\nwhere the coefficients $c$ depend on the grid spacing and the radial coordinate $r_i$, and $f_{i,j}$ incorporates any source terms and the known values from the Dirichlet boundary conditions at $r=r_0$ and $r=R$. The crucial observation is that the value $u_{i,j}$ at a grid point $(i,j)$ is coupled only to its immediate neighbors: $(i+1, j)$, $(i-1, j)$, $(i, j+1)$, and $(i, j-1)$. This defines a 5-point computational stencil.\n\nThe problem specifies that the unknowns $u_{i,j}$ are arranged into a single vector $\\boldsymbol{u}$ of length $N_r N_\\theta$ using a lexicographical ordering with the mapping $p(i,j) = i + (j-1) N_{r}$. Here, the radial index $i$ is the \"fast\" index, and the angular index $j$ is the \"slow\" index. The resulting linear system is $A \\boldsymbol{u} = \\boldsymbol{f}$, where $A$ is a sparse matrix of size $(N_r N_\\theta) \\times (N_r N_\\theta)$. A non-zero entry $A_{p,q}$ exists if and only if the unknowns corresponding to indices $p$ and $q$ are coupled in the discrete equations.\n\nWe need to find the full bandwidth of $A$, defined as $2k+1$, where $k$ is the maximum value of $|p-q|$ for which $A_{p,q}$ can be non-zero. Let's analyze the index differences for all coupled points.\n\nConsider a generic interior point $(i,j)$ (i.e., not adjacent to a boundary). Its index is $p_c = p(i,j) = i + (j-1)N_r$. The indices of its neighbors are:\n\\begin{itemize}\n    \\item Radial neighbor $(i-1, j)$: $p_1 = p(i-1, j) = (i-1) + (j-1)N_r = p_c - 1$. The index difference is $|p_c - p_1| = 1$.\n    \\item Radial neighbor $(i+1, j)$: $p_2 = p(i+1, j) = (i+1) + (j-1)N_r = p_c + 1$. The index difference is $|p_c - p_2| = 1$.\n    \\item Angular neighbor $(i, j-1)$: $p_3 = p(i, j-1) = i + (j-2)N_r = p_c - N_r$. The index difference is $|p_c - p_3| = N_r$.\n    \\item Angular neighbor $(i, j+1)$: $p_4 = p(i, j+1) = i + (j)N_r = p_c + N_r$. The index difference is $|p_c - p_4| = N_r$.\n\\end{itemize}\nFor interior points, the maximum index difference is $N_r$. This standard coupling creates a block-tridiagonal matrix structure where the main diagonal blocks are tridiagonal (from radial coupling) and the off-diagonal blocks are diagonal (from angular coupling). The bandwidth from these couplings would be determined by $N_r$.\n\nHowever, we must also consider the periodic boundary conditions in the $\\theta$ direction. These conditions state that the domain \"wraps around\" such that the line $\\theta=2\\pi$ is identified with $\\theta=0$. In our discrete grid, this means that for any radial index $i$, the point $(i, j=N_\\theta)$ is adjacent to $(i, j=1)$, and $(i, j=1)$ is adjacent to $(i, j=N_\\theta)$. This introduces additional couplings that are typically far apart in the matrix structure.\n\nLet's analyze the index difference for this \"wrap-around\" coupling:\nConsider a point $(i, 1)$ on the $j=1$ angular boundary. Its index is $p_a = p(i,1) = i + (1-1)N_r = i$. Due to periodicity, it is coupled with the point $(i, N_\\theta)$. The index of this neighboring point is $p_b = p(i,N_\\theta) = i + (N_\\theta-1)N_r$.\nThe absolute difference in their indices is:\n$$ |p_a - p_b| = |i - (i + (N_\\theta-1)N_r)| = (N_\\theta-1)N_r $$\nThis coupling creates non-zero entries in the matrix at positions $(p_a, p_b)$ and $(p_b, p_a)$, which correspond to the top-right and bottom-left \"corners\" of the block-structured matrix $A$.\n\nThe half-bandwidth, $k$, is the maximum of all possible index differences. The set of non-zero off-diagonal index differences is $\\{1, N_r, (N_\\theta-1)N_r\\}$. To find $k$, we must find the maximum of these values.\n$$ k = \\max\\{1, N_r, (N_\\theta-1)N_r\\} $$\nFor a meaningful discretization, we must have $N_r \\ge 1$ and $N_\\theta \\ge 2$.\nIf $N_\\theta = 2$, then $(N_\\theta-1)N_r = (2-1)N_r = N_r$. In this case, $k = \\max\\{1, N_r, N_r\\} = N_r$.\nIf $N_\\theta > 2$, then $N_\\theta-1 > 1$, which implies $(N_\\theta-1)N_r > N_r$.\nSince $N_r \\ge 1$, it is always true that $(N_\\theta-1)N_r \\ge N_r \\ge 1$ for $N_\\theta \\ge 2$. Therefore, the maximum value is always given by the wrap-around coupling term:\n$$ k = (N_\\theta-1)N_r $$\nThe problem asks for the full bandwidth, which is defined as $2k+1$. Substituting our expression for $k$:\n$$ \\text{Full Bandwidth} = 2k+1 = 2(N_\\theta-1)N_r + 1 $$\nThis expression characterizes the bandwidth of the resulting sparse matrix $A$ under the specified lexicographical ordering.",
            "answer": "$$\\boxed{2(N_{\\theta}-1)N_{r} + 1}$$"
        }
    ]
}