{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基础但至关重要的问题开始：线性平流方程的质量守恒。这个练习旨在阐明守恒型有限体积格式的核心思想，即通过精确追踪通量在单元边界的流入和流出，来保证离散总质量在周期性边界下的精确守恒。掌握这一基本原理是构建更复杂物理系统结构保持算法的基石。",
            "id": "3450230",
            "problem": "考虑线性平流偏微分方程 (PDE) $u_{t} + (a u)_{x} = 0$，定义在周期性域 $[0, 2\\pi]$ 上，其中平流速度 $a \\in \\mathbb{R}$ 为常数。设该域被划分为 $N \\in \\mathbb{N}$ 个宽度为 $h = \\frac{2\\pi}{N}$ 的均匀控制体积，单元中心为 $x_{i} = \\left(i + \\frac{1}{2}\\right) h$，$i = 0, 1, \\dots, N-1$。记 $u_{i}^{n}$ 为在时间层 $t^{n} = n \\,\\Delta t$（其中 $\\Delta t > 0$ 是一个固定的时间步长）上对单元 $i$ 内 $u$ 的单元平均值的近似。\n\n从该偏微分方程的积分守恒形式和守恒通量的定义出发，在每个单元界面 $x_{i+1/2} = x_{i} + \\frac{h}{2}$ 处构造一个数值通量 $F_{i+1/2}$，该通量与物理通量 $f(u) = a u$ 相容，并能导出一个守恒的全离散有限体积更新格式。然后，利用周期性边界条件和您得到的离散更新格式，推导离散质量\n$$\nM^{n} = h \\sum_{i=0}^{N-1} u_{i}^{n}\n$$\n的演化规律，并判断 $M^{n}$ 是否不随 $n$ 变化。\n\n最后，取正弦初始条件\n$$\nu_{i}^{0} = \\sin\\!\\big(m x_{i}\\big)\n$$\n其中 $m \\in \\mathbb{N}$，并计算所有 $n \\geq 0$ 的 $M^{n}$ 的值，将其显式地表示为一个实数。假设 $N \\geq 1$ 是任意但固定的，并且时间积分使用与您构造的通量相容的单步显式方法。您的最终答案无需单位。不要求四舍五入；请给出精确值。",
            "solution": "该问题是适定的且具有科学依据，为偏微分方程数值方法分析提供了一个标准练习。所有数据和条件足以得到唯一解。\n\n线性平流方程为 $u_{t} + (a u)_{x} = 0$，可以写成守恒律形式 $u_{t} + f(u)_{x} = 0$，其中物理通量为 $f(u) = a u$。\n\n我们首先应用有限体积法。将该偏微分方程在控制体积 $C_{i} = [x_{i-1/2}, x_{i+1/2}]$ 上从时间 $t^{n}$ 到 $t^{n+1}$ 进行积分，得到：\n$$\n\\int_{t^{n}}^{t^{n+1}} \\int_{x_{i-1/2}}^{x_{i+1/2}} u_{t} \\,dx\\,dt + \\int_{t^{n}}^{t^{n+1}} \\int_{x_{i-1/2}}^{x_{i+1/2}} (a u)_{x} \\,dx\\,dt = 0\n$$\n两次应用微积分基本定理，得到：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( u(x, t^{n+1}) - u(x, t^{n}) \\right) \\,dx + \\int_{t^{n}}^{t^{n+1}} \\left( f(u(x_{i+1/2}, t)) - f(u(x_{i-1/2}, t)) \\right) \\,dt = 0\n$$\n设 $u_{i}(t) = \\frac{1}{h} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x, t) \\,dx$ 为 $u$ 在单元 $C_i$ 上的精确单元平均值。方程变为：\n$$\nh \\left( u_{i}(t^{n+1}) - u_{i}(t^{n}) \\right) + \\int_{t^{n}}^{t^{n+1}} \\left( f(u(x_{i+1/2}, t)) - f(u(x_{i-1/2}, t)) \\right) \\,dt = 0\n$$\n通过用 $u_i^n$ 近似单元平均值 $u_i(t^n)$，并用在时间 $t^n$ 计算的数值通量差乘以 $\\Delta t$ 来近似通量差的时间积分，我们得到一个全离散的有限体积格式。数值通量 $F_{i+1/2}$ 是一个在单元界面 $x_{i+1/2}$ 处近似物理通量 $f(u)$ 的函数。为使格式是守恒的，它必须能表示为以下形式：\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{h} \\left( F_{i+1/2}^{n} - F_{i-1/2}^{n} \\right)\n$$\n其中 $F_{i+1/2}^{n}$ 是在时间 $t^n$ 界面 $x_{i+1/2}$ 处的数值通量。该通量使用相邻单元的单元平均数据（例如，$u_{i}^{n}$ 和 $u_{i+1}^{n}$）计算。为使通量与物理通量 $f(u) = a u$ 相容，它必须满足 $F(u, u, \\dots) = f(u) = a u$。\n该问题不要求指定通量的确切形式（例如，迎风格式、Lax-Friedrichs格式等），只要求它是相容的并且是一个守恒更新法则的一部分。质量守恒的分析仅依赖于更新的守恒形式和周期性边界条件。\n\n在时间 $t^{n}$ 的总离散质量定义为 $M^{n} = h \\sum_{i=0}^{N-1} u_{i}^{n}$。\n为求得 $M^{n}$ 的演化规律，我们计算 $M^{n+1}$：\n$$\nM^{n+1} = h \\sum_{i=0}^{N-1} u_{i}^{n+1}\n$$\n代入 $u_{i}^{n+1}$ 的守恒更新公式：\n$$\nM^{n+1} = h \\sum_{i=0}^{N-1} \\left[ u_{i}^{n} - \\frac{\\Delta t}{h} \\left( F_{i+1/2}^{n} - F_{i-1/2}^{n} \\right) \\right]\n$$\n分配求和符号：\n$$\nM^{n+1} = h \\sum_{i=0}^{N-1} u_{i}^{n} - \\Delta t \\sum_{i=0}^{N-1} \\left( F_{i+1/2}^{n} - F_{i-1/2}^{n} \\right)\n$$\n第一项正是时间 $t^n$ 的质量 $M^n$。第二项是一个伸缩求和：\n$$\n\\sum_{i=0}^{N-1} \\left( F_{i+1/2}^{n} - F_{i-1/2}^{n} \\right) = (F_{1/2}^{n} - F_{-1/2}^{n}) + (F_{3/2}^{n} - F_{1/2}^{n}) + \\dots + (F_{N-1/2}^{n} - F_{N-3/2}^{n})\n$$\n该和可以裂项相消为 $F_{N-1/2}^{n} - F_{-1/2}^{n}$。\n问题指定了在域 $[0, 2\\pi]$ 上的周期性边界条件。单元的索引从 $i=0$ 到 $i=N-1$。周期性意味着单元 $i=N$ 的状态与单元 $i=0$ 的状态相同，而单元 $i=-1$ 的状态与单元 $i=N-1$ 的状态相同。\n数值通量 $F_{i+1/2}^n$ 是界面 $x_{i+1/2}$ 周围单元状态的函数，通常是 $u_i^n$ 和 $u_{i+1}^n$。也就是说，$F_{i+1/2}^n = F(u_i^n, u_{i+1}^n)$。\n在域的右边界处的通量是 $F_{N-1/2}^n = F(u_{N-1}^n, u_N^n)$。由于周期性，$u_N^n = u_0^n$，所以 $F_{N-1/2}^n = F(u_{N-1}^n, u_0^n)$。\n在域的左边界处（对应于单元 $i=0$ 的左边缘）的通量是 $F_{-1/2}^n = F(u_{-1}^n, u_0^n)$。由于周期性，$u_{-1}^n = u_{N-1}^n$，所以 $F_{-1/2}^n = F(u_{N-1}^n, u_0^n)$。\n因此，由于周期性边界条件，$F_{N-1/2}^{n} = F_{-1/2}^{n}$。\n伸缩求和的结果为零：\n$$\n\\sum_{i=0}^{N-1} \\left( F_{i+1/2}^{n} - F_{i-1/2}^{n} \\right) = F_{N-1/2}^{n} - F_{-1/2}^{n} = 0\n$$\n因此，离散质量的演化规律是：\n$$\nM^{n+1} = M^{n} - \\Delta t \\cdot 0 = M^{n}\n$$\n这表明离散质量 $M^{n}$ 是该数值格式的一个不变量。这意味着对于所有 $n \\geq 0$，$M^{n}$ 是常数，其值由初始条件决定，$M^{n} = M^{0}$。\n\n我们现在为给定的初始条件 $u_{i}^{0} = \\sin(m x_{i})$（其中 $m \\in \\mathbb{N}$）计算 $M^0$ 的值。\n$$\nM^{0} = h \\sum_{i=0}^{N-1} u_{i}^{0} = h \\sum_{i=0}^{N-1} \\sin(m x_{i})\n$$\n代入 $x_{i}$ 和 $h$ 的定义：\n$x_{i} = \\left(i + \\frac{1}{2}\\right) h$ 且 $h = \\frac{2\\pi}{N}$。\n$$\nM^{0} = \\frac{2\\pi}{N} \\sum_{i=0}^{N-1} \\sin\\left(m \\left(i + \\frac{1}{2}\\right) \\frac{2\\pi}{N}\\right) = \\frac{2\\pi}{N} \\sum_{i=0}^{N-1} \\sin\\left(\\frac{2\\pi m i}{N} + \\frac{\\pi m}{N}\\right)\n$$\n为了计算这个和，我们使用欧拉公式 $\\sin(\\theta) = \\operatorname{Im}(\\exp(j \\theta))$，其中 $j^2=-1$。\n令 $S = \\sum_{i=0}^{N-1} \\exp\\left(j \\left(\\frac{2\\pi m i}{N} + \\frac{\\pi m}{N}\\right)\\right)$。正弦和是 $\\operatorname{Im}(S)$。\n$$\nS = \\sum_{i=0}^{N-1} \\exp\\left(j \\frac{2\\pi m i}{N}\\right) \\exp\\left(j \\frac{\\pi m}{N}\\right) = \\exp\\left(j \\frac{\\pi m}{N}\\right) \\sum_{i=0}^{N-1} \\left(\\exp\\left(j \\frac{2\\pi m}{N}\\right)\\right)^{i}\n$$\n这是一个公比为 $r = \\exp(j \\frac{2\\pi m}{N})$ 的几何级数。\n\n情况1：$m$ 是 $N$ 的倍数。\n设 $m = k N$，其中 $k \\in \\mathbb{N}$ 为某个整数。那么 $r = \\exp(j \\frac{2\\pi k N}{N}) = \\exp(j 2\\pi k) = 1$。\n求和变为 $\\sum_{i=0}^{N-1} 1^{i} = N$。\n在这种情况下，$S = \\exp(j \\frac{\\pi k N}{N}) \\cdot N = N \\exp(j \\pi k) = N (\\cos(k\\pi) + j\\sin(k\\pi)) = N(-1)^{k}$。\n因为 $S$ 是一个实数，其虚部为 $\\operatorname{Im}(S) = 0$。\n\n情况2：$m$ 不是 $N$ 的倍数。\n在这种情况下，$r \\neq 1$。几何级数的和是 $\\frac{1-r^{N}}{1-r}$。\n项 $r^{N}$ 是：\n$$\nr^{N} = \\left(\\exp\\left(j \\frac{2\\pi m}{N}\\right)\\right)^{N} = \\exp(j 2\\pi m) = 1\n$$\n因为 $m$ 是一个整数。分子是 $1 - 1 = 0$，所以级数的和为 $0$。\n那么 $S = \\exp(j \\frac{\\pi m}{N}) \\cdot 0 = 0$。\n虚部是 $\\operatorname{Im}(S) = 0$。\n\n在两种情况下，正弦项的和均为 $0$。\n$$\n\\sum_{i=0}^{N-1} \\sin\\left(m \\left(i + \\frac{1}{2}\\right) \\frac{2\\pi}{N}\\right) = 0\n$$\n因此，初始质量为：\n$$\nM^{0} = h \\cdot 0 = 0\n$$\n因为离散质量是不变的，所以对所有 $n \\geq 0$ 都有 $M^{n} = M^{0}$。我们得出结论，对所有 $n \\geq 0$ 都有 $M^{n} = 0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在处理非线性问题，尤其是那些会产生激波或间断的物理现象时，守恒格式的重要性愈发凸显。本练习通过比较粘性伯格斯方程（viscous Burgers' equation）的守恒与非守恒离散格式，直观地揭示了非守恒格式在计算激波速度和保持系统总质量方面的缺陷。通过亲手实现并对比，你将深刻理解为何“守恒性”是模拟冲击主导流动的关键属性。",
            "id": "3450238",
            "problem": "考虑周期性域 $[0,2\\pi]$ 上的粘性伯格斯偏微分方程，\n$$ u_t + \\frac{1}{2}(u^2)_x = \\nu u_{xx}, $$\n初始条件为 $u(x,0)=\\sin(x)$，粘性参数 $\\nu>0$。重点是数值比较两种空间离散化方法对平流项在激波主导区域和光滑区域下的表现，并量化它们在质量守恒、能量平衡和熵产生方面的差异。此比较必须在一致的时间积分框架和周期性边界条件下进行。\n\n平流项有两种空间离散化选择：\n\n- 使用单调数值通量对物理通量 $f(u)=\\frac{1}{2}u^2$ 进行守恒有限体积离散，并有两种重构选择：\n  1. 分段常数重构（一阶）。\n  2. 使用 minmod 斜率限制器的分段线性重构（MUSCL）。\n- 对非守恒形式 $u u_x$ 中的平流项进行非守恒有限差分离散，其中 $u_x$ 由中心差分近似。\n\n粘性项使用 $u_{xx}$ 的二阶中心差分近似进行离散。时间积分必须使用两阶段强稳定性保持（SSP）龙格-库塔方法，并采用满足显式稳定性约束的恒定时间步长。\n\n推导的基本依据：\n- 对于足够光滑的解，粘性伯格斯方程在周期性边界条件下允许存在一个质量不变量，即空间积分 $M(t)=\\int_0^{2\\pi} u(x,t)\\,dx$ 不随时间变化。\n- 二次能量 $E(t)=\\int_0^{2\\pi}\\frac{1}{2}u(x,t)^2\\,dx$ 在周期性边界条件下满足以下平衡关系\n$$ \\frac{d}{dt}E(t) = -\\nu \\int_0^{2\\pi} u_x(x,t)^2\\,dx, $$\n这也是凸熵 $\\eta(u)=\\frac{1}{2}u^2$ 和熵通量 $q(u)=\\frac{1}{3}u^3$ 的一个熵不等式；特别地，熵产生是非负的，且等于 $\\nu\\int_0^{2\\pi}u_x^2\\,dx$。\n- 当与一致的数值通量和周期性边界条件一起使用时，平流项通量的守恒离散化会保持一个离散质量不变量，并允许一个离散熵平衡。非守恒离散化通常不保持质量，并且可能在激波附近破坏熵平衡。\n\n您必须设计并实现一个完整的程序，该程序：\n1. 将空间域 $[0,2\\pi]$ 离散为 $N$ 个均匀单元，具有单元中心和周期性索引。\n2. 实现平流项的守恒有限体积离散，在单元面上使用 Engquist–Osher 单调通量计算 $f(u)=\\frac{1}{2}u^2$，并有两种重构选择：\n   - 分段常数重构。\n   - 使用 minmod 斜率限制器的分段线性重构。minmod 限制器定义为\n     $$ \\operatorname{minmod}(a,b) = \\frac{1}{2}\\left(\\operatorname{sign}(a)+\\operatorname{sign}(b)\\right)\\min\\{|a|,|b|\\}。$$\n     面 $i+\\frac{1}{2}$ 处的左右界面状态必须使用此受限斜率从相邻单元平均值重构。\n3. 实现 $u u_x$ 的非守恒有限差分离散，其中 $u_x$ 由中心差分近似\n   $$ (u_x)_i \\approx \\frac{u_{i+1}-u_{i-1}}{2\\Delta x}。$$\n4. 使用中心二阶差分对粘性项 $u_{xx}$ 进行离散\n   $$ (u_{xx})_i \\approx \\frac{u_{i+1}-2u_i+u_{i-1}}{\\Delta x^2}。$$\n5. 使用两阶段强稳定性保持（SSP）龙格-库塔方法将解推进到最终时间 $T$，时间步长 $\\Delta t$ 为常数，其选择需满足显式稳定性约束\n   $$ \\Delta t \\le C \\min\\left(\\frac{\\Delta x}{\\max|u|},\\frac{\\Delta x^2}{\\nu}\\right), $$\n   其中 $C=0.4$，并通过设置均匀步数和使用 $\\Delta t=T/\\text{steps}$ 来精确达到 $T$。\n6. 在结束时间 $T$ 为每次运行计算以下诊断量：\n   - 离散质量 $M^n=\\Delta x\\sum_i u_i^n$ 和绝对质量误差 $|M^N - M^0|$。\n   - 离散能量 $E^n=\\Delta x\\sum_i \\frac{1}{2}(u_i^n)^2$。\n   - 时间积分的熵产生的一个数值近似\n     $$ \\mathcal{D}_{\\text{num}} = \\nu \\int_0^T \\int_0^{2\\pi} u_x(x,t)^2\\,dx\\,dt, $$\n     通过将 $u_x$ 替换为 $u_x$ 的中心差分并在每个时间步的每个 SSP 阶段上使用梯形法则来计算。\n   - 能量平衡残差\n     $$ R = \\left(E^0 - E^N\\right) - \\mathcal{D}_{\\text{num}}, $$\n     以及指示能量单调性的布尔值 $E^N \\le E^0$。\n7. 在所有空间离散化中使用周期性边界条件。\n\n测试套件和覆盖范围：\n- 情况1：守恒平流离散，分段常数重构，$N=256$，$\\nu=10^{-3}$，$T=0.4$。\n- 情况2：守恒平流离散，使用 minmod 限制器的分段线性 MUSCL 重构，$N=256$，$\\nu=10^{-3}$，$T=0.4$。\n- 情况3：非守恒平流离散（$u u_x$），$N=256$，$\\nu=10^{-3}$，$T=0.4$。\n- 情况4：在粗网格上进行非守恒平流离散，以测试激波附近的分辨率不足情况，$N=64$，$\\nu=10^{-3}$，$T=0.4$。\n- 情况5：守恒平流离散，在光滑区域进行分段常数重构，$N=128$，$\\nu=10^{-1}$，$T=0.4$。\n\n对于每种情况，您的程序必须计算并返回一个列表，其中按顺序包含四个条目：\n- 绝对质量误差 $|M^N - M^0|$，作为浮点数。\n- 能量平衡残差 $R$，作为浮点数。\n- 布尔能量单调性指示符，如果 $E^N \\le E^0$ 则为 $\\text{True}$，否则为 $\\text{False}$。\n- 数值熵产生 $\\mathcal{D}_{\\text{num}}$，作为浮点数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含所有情况的结果，格式为由方括号括起来的、以逗号分隔的各情况结果列表，例如 $[\\,[m_1,r_1,b_1,d_1],\\,[m_2,r_2,b_2,d_2],\\,\\dots\\,]$。不允许有其他输出。角度不出现，也不需要物理单位，因此不需要单位说明。所有返回的值必须是如上所述的基本类型（浮点数和布尔值）。",
            "solution": "该问题要求在周期性域 $[0, 2\\pi]$ 上，对粘性伯格斯方程 $u_t + \\frac{1}{2}(u^2)_x = \\nu u_{xx}$（初始条件为 $u(x,0)=\\sin(x)$）实现并比较几种数值格式。比较的重点是平流项的不同空间离散化方法在质量守恒、能量平衡和熵产生方面的表现。\n\n首先，我们建立数值框架。空间域 $[0, 2\\pi]$ 被离散化为 $N$ 个宽度为 $\\Delta x = 2\\pi/N$ 的均匀单元。单元中心位于 $x_i = i \\Delta x$，其中 $i=0, \\dots, N-1$。解由单元平均值向量 $u = [u_0, u_1, \\dots, u_{N-1}]^T$ 表示。强制执行周期性边界条件，意味着索引按模 $N$ 处理。\n\n该偏微分方程的半离散化形式是一个常微分方程（ODE）系统，$\\frac{d\\vec{u}}{dt} = \\vec{L}(\\vec{u})$，其中 $\\vec{L}$ 是空间算子。该算子是粘性部分和平流部分之和：$L(u)_i = L_{visc}(u)_i + L_{adv}(u)_i$。\n\n粘性项 $\\nu u_{xx}$ 使用标准的二阶中心有限差分近似进行离散，该方法对所有测试用例都适用：\n$$ L_{visc}(u)_i = \\nu \\frac{u_{i+1} - 2u_i + u_{i-1}}{\\Delta x^2} $$\n周期性通过取 $u_{N}=u_0$ 和 $u_{-1}=u_{N-1}$ 来处理。\n\n平流项 $-\\frac{1}{2}(u^2)_x = -u u_x$ 按规定使用三种不同的方法进行离散：\n\n1.  **非守恒有限差分**：该项以其非守恒形式 $-u u_x$ 处理。空间导数 $u_x$ 通过二阶中心差分近似：\n    $$ L_{adv}(u)_i = -u_i \\frac{u_{i+1} - u_{i-1}}{2\\Delta x} $$\n    该格式简单，但已知会违反质量守恒，这可能导致在弱解极限下出现不正确的激波速度。\n\n2.  **守恒有限体积（分段常数）**：这种一阶格式基于守恒律的积分形式。单元 $i$ 的更新由其边界处的数值通量 $\\hat{f}_{i-1/2}$ 和 $\\hat{f}_{i+1/2}$ 驱动：\n    $$ L_{adv}(u)_i = -\\frac{1}{\\Delta x} (\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2}) $$\n    界面 $i+1/2$ 左右的状态分别为 $u_L = u_i$ 和 $u_R = u_{i+1}$。对于 $f(u)=\\frac{1}{2}u^2$，使用 Engquist–Osher (EO) 单调通量。由于 $f'(u)=u$，通量根据 $u$ 的符号分裂。EO 通量为 $\\hat{f}^{EO}(u_L, u_R) = f^+(u_L) + f^-(u_R)$，其中如果 $u>0$ 则 $f^+(u) = f(u)$ 否则为 $0$，如果 $u \\le 0$ 则 $f^-(u) = f(u)$ 否则为 $0$。\n\n3.  **守恒有限体积（MUSCL）**：这种二阶扩展在每个单元内使用分段线性重构以获得更高精度。为防止在陡峭梯度附近产生伪振荡，使用 `minmod` 限制器计算单元斜率 $\\delta_i$：\n    $$ \\delta_i = \\operatorname{minmod}\\left(\\frac{u_{i+1}-u_i}{\\Delta x}, \\frac{u_i-u_{i-1}}{\\Delta x}\\right) $$\n    其中 $\\operatorname{minmod}(a,b) = \\frac{1}{2}(\\operatorname{sign}(a)+\\operatorname{sign}(b))\\min(|a|,|b|)$。界面 $i+1/2$ 处的重构状态为：\n    $$ u^L_{i+1/2} = u_i + \\delta_i \\frac{\\Delta x}{2}, \\quad u^R_{i+1/2} = u_{i+1} - \\delta_{i+1} \\frac{\\Delta x}{2} $$\n    然后，这些状态如前所述用于 Engquist–Osher 通量计算。\n\n时间积分使用两阶段强稳定性保持（SSP）龙格-库塔方法（也称为休恩方法）进行：\n$$ u^{(1)} = u^n + \\Delta t L(u^n) $$\n$$ u^{n+1} = \\frac{1}{2}u^n + \\frac{1}{2}\\left(u^{(1)} + \\Delta t L(u^{(1)})\\right) $$\n时间步长 $\\Delta t$ 是常数，在模拟开始时选择，以满足 CFL 稳定性条件 $\\Delta t \\le C \\min(\\frac{\\Delta x}{\\max|u|}, \\frac{\\Delta x^2}{\\nu})$，其中 $C=0.4$。由于粘性伯格斯方程满足最大值原理，任何时刻的 $\\max|u|$ 都受其初始最大值的限制。计算步数以精确达到最终时间 $T$。\n\n为了评估每种格式的性能，计算了几个诊断量：\n-   **绝对质量误差**：$|M^N - M^0|$，其中离散质量为 $M^n = \\Delta x \\sum_i u_i^n$。对于具有周期性边界的连续偏微分方程，质量 $M(t)=\\int_0^{2\\pi} u(x,t) dx$ 是守恒的。对于初始条件 $u(x,0)=\\sin(x)$，初始质量为 $M^0=0$。\n-   **能量平衡残差**：$R = (E^0 - E^N) - \\mathcal{D}_{\\text{num}}$。离散能量为 $E^n = \\Delta x \\sum_i \\frac{1}{2}(u_i^n)^2$。连续能量平衡为 $\\frac{dE}{dt} = - \\nu \\int_0^{2\\pi} u_x^2 dx$。残差 $R$ 衡量数值格式保持此平衡的程度。$\\mathcal{D}_{\\text{num}}$ 是时间积分的数值熵产生，计算如下：\n    $$ \\mathcal{D}_{\\text{num}} = \\int_0^T \\left( \\nu \\Delta x \\sum_i \\left(\\frac{u_{i+1}(t)-u_{i-1}(t)}{2\\Delta x}\\right)^2 \\right) dt $$\n    该时间积分使用与 SSP-RK2 积分器一致的求积法则进行近似，在每个时间步的两个阶段上应用梯形法则。\n-   **能量单调性**：一个布尔标志，指示是否 $E^N \\le E^0$，这与连续能量平衡的预期相符。\n\n实现使用 NumPy 进行了向量化，其中周期性索引通过 `np.roll` 高效处理。一个主函数遍历五个指定的测试用例，为每个用例运行模拟，计算诊断量，并格式化输出。",
            "answer": "[[1.2750130985834863e-16, -1.970119934149697e-05, True, 0.3541577950587786], [2.148118991617411e-16, -2.147250269784381e-05, True, 0.3541604929424843], [0.03847290947701542, -0.0003050186178305786, True, 0.3544621946401662], [0.15418181656828598, -0.0019623862276535567, True, 0.3562629737525381], [3.2723689366657966e-16, -4.957581109968434e-06, True, 1.2520330559648937]]"
        },
        {
            "introduction": "接下来，我们将挑战一个更复杂的系统：二维理想流体动力学的核心模型——欧拉方程（Euler equations）。此练习的目标是设计并实现一个能够保持二次不变量——离散拟涡能（enstrophy）的数值格式。你将学习如何通过构建一个反对称的离散雅可比算子（Jacobian operator），结合保持二次不变量的时间积分方法，来精确地捕捉理想湍流中的关键统计特性。",
            "id": "3450191",
            "problem": "设计并实现一个在周期性方形域上求解涡量-流函数形式的不可压缩二维欧拉方程的结构保持有限差分解算器。其控制偏微分方程 (PDE) 为涡量输运方程\n$$\n\\frac{\\partial \\omega}{\\partial t} + J(\\psi,\\omega) = 0,\n$$\n及其流函数-涡量关系\n$$\n\\nabla^2 \\psi = -\\omega,\n$$\n其中 $\\omega(x,y,t)$ 是标量涡量，$\\psi(x,y,t)$ 是流函数，而 $J(\\psi,\\omega) = \\frac{\\partial \\psi}{\\partial x}\\frac{\\partial \\omega}{\\partial y} - \\frac{\\partial \\psi}{\\partial y}\\frac{\\partial \\omega}{\\partial x}$ 是雅可比行列式。速度场为 $\\mathbf{u} = \\nabla^\\perp \\psi = \\left(\\frac{\\partial \\psi}{\\partial y}, -\\frac{\\partial \\psi}{\\partial x}\\right)$。考虑周期性区域 $\\Omega = [0,2\\pi)\\times[0,2\\pi)$。\n\n你的任务是构建一个空间上的有限差分半离散化格式，它能够在半离散层面上保持离散拟涡能，并将其与一个能够保持二次不变量的时间积分器相结合。具体要求如下：\n\n- 使用均匀网格，在 $x$ 方向有 $N_x$ 个点，在 $y$ 方向有 $N_y$ 个点，网格间距 $h = \\frac{2\\pi}{N_x} = \\frac{2\\pi}{N_y}$，并在两个方向上使用周期性边界条件。\n- 定义离散内积和离散拟涡能为\n$$\n\\langle a,b\\rangle_h = h^2 \\sum_{i=0}^{N_y-1} \\sum_{j=0}^{N_x-1} a_{i,j} b_{i,j}, \\qquad Z_h(\\omega) = \\frac{1}{2}\\langle \\omega,\\omega\\rangle_h.\n$$\n- 在网格上使用一个二阶、中心、斜对称的双线性形式来离散化雅可比行列式 $J(\\psi,\\omega)$，该形式能够保持半离散的离散拟涡能，也就是说，它必须满足\n$$\n\\langle \\omega, J_h(\\psi,\\omega)\\rangle_h = 0\n$$\n对网格上所有的离散场 $\\psi,\\omega$ 成立。该构造必须与连续雅可比行列式和周期性边界条件相一致。\n- 使用一种能够为由此产生的常微分方程组保持二次不变量的方法进行时间推进（例如，隐式中点格式）。时间积分器所需的非线性求解必须在足够小的容差下完成，以便在要求的精度内观察到不变量。\n\n在每个阶段，通过使用快速傅里叶变换 (FFT) 的谱方法求解周期性泊松方程 $\\nabla^2 \\psi = -\\omega$ 来计算 $\\psi$，并强制执行 $\\psi$ 的零均值条件。\n\n验证要求：对于几种初始条件和参数选择，在多个时间步长上数值验证离散拟涡能 $Z_h$ 的演化。对于每个测试用例，报告拟涡能是否在指定的容差内得以保持。如果初始拟涡能非零，将相对变化 $\\left|\\frac{Z_h^{\\text{final}} - Z_h^{\\text{initial}}}{Z_h^{\\text{initial}}}\\right|$ 与给定的容差进行比较。如果初始拟涡能为零，将绝对变化 $\\left|Z_h^{\\text{final}} - Z_h^{\\text{initial}}\\right|$ 与给定的绝对容差进行比较。\n\n使用以下固定的域和模板：\n\n- 域：$[0,2\\pi)\\times[0,2\\pi)$.\n- 模板：均匀周期性网格上的二阶中心差分。\n- 离散泊松求解必须使用基于 FFT 的谱反演方法处理具有周期性边界条件的拉普拉斯算子。\n\n测试套件和要求输出：\n\n实现你的程序以运行以下测试用例，每个用例指定为一个元组 $(N_x, N_y, \\Delta t, \\text{steps}, \\text{ic}, \\text{rtol}, \\text{atol})$：\n\n- 用例 1（稳定剪切流，平凡雅可比行列式）：$(32, 32, 0.5, 10, \\text{\"shear\"}, 10^{-10}, 10^{-12})$。初始涡量 $\\omega_0(x,y) = \\sin(y)$。\n- 用例 2（非平凡动力学）：$(40, 40, 0.01, 20, \\text{\"mix\"}, 5\\times 10^{-7}, 10^{-12})$。初始涡量 $\\omega_0(x,y) = \\sin(x) + \\sin(y) + 0.25\\cos(2x - y)$。\n- 用例 3（零涡量）：$(16, 16, 0.2, 5, \\text{\"zero\"}, 10^{-10}, 10^{-14})$。初始涡量 $\\omega_0(x,y) \\equiv 0$。\n\n三角函数中的角度参数以弧度为单位。\n\n你的程序应产生单行输出，其中包含结果，格式为逗号分隔的 Python 布尔值列表，并用方括号括起来，顺序与测试用例相同。例如，要求的格式为\n\"[result1,result2,result3]\".\n\n不允许用户输入；所有参数均由本规范固定。实现必须完全自包含，且不得读取或写入任何外部文件。最终打印的行是你的程序应产生的唯一输出。",
            "solution": "用户要求一个在周期性域上求解涡量-流函数形式的二维不可压缩欧拉方程的结构保持数值解算器。该解算器必须保持拟涡能的离散模拟量。\n\n### 1. 问题验证\n该问题在科学和数学上是合理的。它描述了二维欧拉方程，这是流体动力学中的一个基本模型。数值任务涉及构建一个结构保持的半离散化格式，这是几何数值积分中的一个关键课题。所有参数、方程、边界条件和验证标准都得到了明确的规定。该问题是适定的、客观的、自包含的。因此，它被认为是有效的。\n\n### 2. 方法论\n\n解决方案是通过将一个保持拟涡能的空间离散算子与一个保持二次不变量的时间积分器相结合来构建的。\n\n#### 2.1. 空间离散化与网格\n域 $\\Omega = [0,2\\pi) \\times [0,2\\pi)$ 使用一个包含 $N_x \\times N_y$ 个点的均匀网格进行离散化。网格间距为 $h_x = 2\\pi/N_x$ 和 $h_y = 2\\pi/N_y$。问题说明 $h_x=h_y$，意味着 $N_x=N_y=N$。像涡量 $\\omega$ 和流函数 $\\psi$ 这样的离散场在此网格上表示为数组 $\\omega_{i,j}$ 和 $\\psi_{i,j}$。\n\n#### 2.2. 谱方法泊松解算器\n流函数 $\\psi$ 是通过求解具有周期性边界条件的泊松方程 $\\nabla^2 \\psi = -\\omega$ 从涡量 $\\omega$ 中获得的。由于其高精度和高效率，此任务采用了使用快速傅里叶变换 (FFT) 的谱方法。\n1.  对该方程进行二维离散傅里叶变换 (DFT)：$\\widehat{\\nabla^2 \\psi} = -\\hat{\\omega}$。\n2.  在 DFT 下，拉普拉斯算子 $\\nabla^2$ 的符号是 $-(k_x^2 + k_y^2)$，其中 $k_x$ 和 $k_y$ 是整数波数。因此，傅里叶空间中的方程变为 $-(k_x^2+k_y^2)\\hat{\\psi}_{k_x,k_y} = -\\hat{\\omega}_{k_x,k_y}$。\n3.  流函数的傅里叶系数则为 $\\hat{\\psi}_{k_x,k_y} = \\frac{\\hat{\\omega}_{k_x,k_y}}{k_x^2+k_y^2}$。\n4.  对于零波数模式（$k_x=k_y=0$），分母为零。这对应于解在相差一个常数的情况下的非唯一性。问题指定了 $\\psi$ 的零均值条件，即设置 $\\hat{\\psi}_{0,0} = 0$。这是自洽的，因为控制方程保持总涡量守恒，意味着 $\\hat{\\omega}_{0,0}$（与平均涡量成正比）保持不变（对于给定的初始条件，其值为零）。\n5.  通过对 $\\hat{\\psi}$ 应用二维逆 DFT，可以恢复物理空间中的流函数 $\\psi$。\n\n#### 2.3. 保持拟涡能的雅可比行列式\n涡量输运方程为 $\\frac{\\partial \\omega}{\\partial t} + J(\\psi, \\omega) = 0$。在平流形式下，使用 $\\mathbf{u} = \\nabla^\\perp\\psi = (\\partial_y\\psi, -\\partial_x\\psi)$，这等价于 $\\frac{\\partial \\omega}{\\partial t} + \\mathbf{u} \\cdot \\nabla\\omega = 0$。对于无散速度场 $\\mathbf{u}$，由于 $\\int_\\Omega \\omega(\\mathbf{u}\\cdot\\nabla\\omega) \\,dA = 0$，连续拟涡能 $Z = \\frac{1}{2}\\int_\\Omega \\omega^2 \\,dA$ 是守恒的。\n\n为了保持离散拟涡能 $Z_h = \\frac{1}{2}\\langle \\omega,\\omega\\rangle_h$，平流项的离散化，我们称之为 $\\text{Adv}_h(\\psi, \\omega)$，必须是斜对称的，即满足 $\\langle \\omega, \\text{Adv}_h(\\psi, \\omega) \\rangle_h = 0$。\n\n通过将 $\\text{Adv}_h$ 定义为两种二阶中心差分离散化的平均值，可以实现这一特性：\n1.  **平流形式**: $(\\mathbf{u} \\cdot \\nabla\\omega)_h = u_h (\\delta_x \\omega) + v_h (\\delta_y \\omega)$，其中 $\\mathbf{u}_h = (\\delta_y\\psi, -\\delta_x\\psi)$ 且 $\\delta_x, \\delta_y$ 是中心差分算子。\n2.  **通量形式**: $(\\nabla \\cdot (\\omega\\mathbf{u}))_h = \\delta_x(\\omega u_h) + \\delta_y(\\omega v_h)$。\n\n在周期性网格上使用分部求和法，可以证明 $\\langle \\omega, (\\nabla \\cdot (\\omega\\mathbf{u}))_h \\rangle_h = - \\langle \\omega, (\\mathbf{u} \\cdot \\nabla\\omega)_h \\rangle_h$。因此，算子 $\\text{Adv}_h = \\frac{1}{2}[(\\mathbf{u} \\cdot \\nabla\\omega)_h + (\\nabla \\cdot (\\omega\\mathbf{u}))_h]$ 满足所要求的斜对称性 $\\langle \\omega, \\text{Adv}_h \\rangle_h = 0$。半离散系统为 $\\frac{d\\omega_h}{dt} = -\\text{Adv}_h(\\psi_h(\\omega_h), \\omega_h)$。\n\n#### 2.4. 时间积分\n半离散系统 $\\dot{\\omega} = F(\\omega)$，其中 $F(\\omega) = -\\text{Adv}_h(\\psi(\\omega), \\omega)$，是一个保持二次不变量 $Z_h = \\frac{1}{2}\\|\\omega\\|_h^2$ 的常微分方程(ODE)系统。为了在全离散层面上保持这个不变量，需要一个能够保持二次不变量的时间积分器。隐式中点法是一个合适的选择：\n$$\n\\frac{\\omega^{n+1} - \\omega^n}{\\Delta t} = F\\left(\\frac{\\omega^{n+1} + \\omega^n}{2}\\right)\n$$\n这为新状态 $\\omega^{n+1}$ 定义了一个非线性方程。我们使用不动点迭代法来求解它：\n$$\n\\omega^{(k+1)} = \\omega^n + \\Delta t \\, F\\left(\\frac{\\omega^{(k)} + \\omega^n}{2}\\right)\n$$\n其中 $\\omega^{(k)}$ 是 $\\omega^{n+1}$ 的第 $k$ 次迭代值。迭代从 $\\omega^{(0)} = \\omega^n$ 开始，一直持续到变化量 $\\|\\omega^{(k+1)} - \\omega^{(k)}\\|$ 小于一个严格的容差，从而确保不变量的精确保持。\n\n### 3. 验证\n实现将通过三个测试用例进行验证。对每个用例，分别计算初始时刻 ($Z_h^{\\text{initial}}$) 和指定时间步数之后 ($Z_h^{\\text{final}}$) 的离散拟涡能。然后根据初始拟涡能是否为零，将守恒性与所提供的相对容差 ($\\text{rtol}$) 或绝对容差 ($\\text{atol}$) 进行核对。\n\n- **用例1（稳定剪切流）：** $\\omega_0(x,y) = \\sin(y)$。连续雅可比行列式为零，因此流场是稳定的。离散雅可比行列式也为零，所以数值解是静止的，拟涡能在机器精度内守恒。\n- **用例2（非平凡动力学）：** 一个更复杂的初始条件导致了非平凡的动力学行为。数值格式的结构保持特性确保了拟涡能以高精度守恒，其精度受限于时间步长和非线性解算器的容差。\n- **用例3（零涡量）：** 平凡初始条件 $\\omega_0=0$。拟涡能初始为零，并且必须保持为零，误差最多为浮点舍入误差。",
            "answer": "[True, True, True]"
        }
    ]
}