{
    "hands_on_practices": [
        {
            "introduction": "为了有效解决不可压缩流问题，有限元法的速度和压力空间必须满足离散inf-sup（或LBB）条件。当使用等阶单元（如$Q_1-Q_1$）时，这个条件被违反，导致非物理的、振荡的压力解。本练习旨在通过亲手构造一个这样的伪解——即所谓的“棋盘”压力模式，来具体揭示这种不稳定性。通过这个实践，你将直观地理解为何压力稳定化方法是不可或缺的。",
            "id": "3401415",
            "problem": "考虑在单位正方形区域 $\\Omega = (0,1) \\times (0,1)$ 上的定常不可压缩斯托克斯问题，其速度满足齐次狄利克雷边界条件：求 $(u,p)$ 使得\n$$\n-\\nu \\Delta u + \\nabla p = 0 \\quad \\text{in } \\Omega,\\qquad \\nabla \\cdot u = 0 \\quad \\text{in } \\Omega,\\qquad u=0 \\quad \\text{on } \\partial\\Omega,\n$$\n其中 $\\nu>0$ 是运动粘度。其弱形式使用标准的双线性形式\n$$\na(u,v) := \\nu \\int_{\\Omega} \\nabla u : \\nabla v \\, dx,\\qquad b(v,q) := - \\int_{\\Omega} q \\, \\nabla \\cdot v \\, dx,\n$$\n其中 $v$ 属于一个 $H^{1}$协调的速度测试空间，$q$ 属于一个 $L^{2}$协调的压力测试空间。令 $\\mathcal{T}_h$ 为 $\\Omega$ 的一个均匀剖分，将其划分为 $2 \\times 2$ 个全等的轴对齐正方形。令 $V_h \\subset H^{1}_{0}(\\Omega)^{2}$ 为速度的协调连续双线性空间（一维线性多项式的张量积），$Q_h \\subset L^{2}_{0}(\\Omega)$ 为压力的协调连续双线性空间，两者都定义在 $\\mathcal{T}_h$上（即等阶 $Q_1$–$Q_1$）。假设压力-速度耦合双线性形式在每个单元上使用单点（单元中心）求积法则进行组装，而扩散双线性形式 $a(\\cdot,\\cdot)$ 则被精确组装。不使用 grad-div 稳定化和压力稳定Petrov-Galerkin (PSPG) 稳定化。\n\n1. 仅使用上述基础（变分形式、有限元定义和指定的求积方法），构造一个显式的非平凡离散压力 $p_h \\in Q_h$ 和一个离散速度 $v_h \\in V_h$，它们求解离散齐次斯托克斯方程\n$$\na(v_h,w_h) + b(w_h,p_h) = 0 \\quad \\forall\\, w_h \\in V_h,\\qquad b(v_h,q_h)=0 \\quad \\forall\\, q_h \\in Q_h,\n$$\n从而证明其违反了离散inf-sup条件。您的构造必须在具有节点 $(i/2,j/2)$（其中 $i,j \\in \\{0,1,2\\}$）的 $2 \\times 2$ 均匀网格上是显式的，并且应仅依赖于 $Q_1$ 形函数的性质和所述的求积方法。\n\n2. 在没有稳定化的情况下，将振荡压力误差定义为所构造的 $p_h$ 的 $L^{2}$范数（齐次问题的精确压力恒为零）。计算\n$$\n\\|p_h\\|_{L^{2}(\\Omega)}.\n$$\n的精确值。\n\n将第二部分的最终答案表示为一个无单位的精确值。如果您选择用一个常数振幅来缩放您构造的 $p_h$，请将该振幅设为 $1$，以使最终值是唯一确定的。",
            "solution": "该问题要求在一个特定的有限元设置下，构造离散斯托克斯方程的一个伪解，并计算该伪解压力分量的 $L^2$范数。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **控制方程：** 单位正方形区域 $\\Omega = (0,1) \\times (0,1)$ 上的定常不可压缩斯托克斯方程。\n  $$-\\nu \\Delta u + \\nabla p = 0 \\quad \\text{in } \\Omega$$\n  $$\\nabla \\cdot u = 0 \\quad \\text{in } \\Omega$$\n- **边界条件：** 速度的齐次狄利克雷边界条件，$u=0$ on $\\partial\\Omega$。\n- **弱形式：**\n  - 求 $(u,p)$ 使得：\n    $$a(u,v) + b(v,p) = 0 \\quad \\text{对所有测试函数 } v$$\n    $$b(u,q) = 0 \\quad \\text{对所有测试函数 } q$$\n  - 双线性形式：\n    $$a(u,v) := \\nu \\int_{\\Omega} \\nabla u : \\nabla v \\, dx$$\n    $$b(v,q) := - \\int_{\\Omega} q \\, \\nabla \\cdot v \\, dx$$\n- **离散化：**\n  - **网格 $\\mathcal{T}_h$：** $\\Omega$ 的均匀剖分，划分为 $2 \\times 2$ 个全等的正方形单元。节点坐标为 $(i/2, j/2)$，其中 $i,j \\in \\{0,1,2\\}$。每个单元的边长为 $h=1/2$。\n  - **速度空间 $V_h$：** 每个速度分量均为连续双线性函数 ($Q_1$)，满足齐次边界条件。$V_h \\subset H^{1}_{0}(\\Omega)^{2}$。\n  - **压力空间 $Q_h$：** 具有零均值约束的连续双线性函数 ($Q_1$)。$Q_h \\subset L^{2}_{0}(\\Omega)$。\n- **数值积分：**\n  - 扩散形式 $a(\\cdot,\\cdot)$ 被精确组装。\n  - 压力-速度耦合形式 $b(\\cdot,\\cdot)$ 在每个单元的中心使用单点求积法则进行近似。我们将其记为 $b_h(\\cdot, \\cdot)$。\n- **稳定化：** 无。不使用 grad-div 或 PSPG 稳定化。\n- **任务：**\n  1. 构造离散齐次系统的一个非平凡解 $(v_h, p_h)$：\n     $$a(v_h,w_h) + b_h(w_h,p_h) = 0 \\quad \\forall\\, w_h \\in V_h$$\n     $$b_h(v_h,q_h) = 0 \\quad \\forall\\, q_h \\in Q_h$$\n  2. 对构造的压力，在其振幅常数设为 $1$ 的情况下，计算 $\\|p_h\\|_{L^2(\\Omega)}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n这是一个标准的教科书例子，用来说明斯托克斯问题中等阶 $Q_1-Q_1$ 有限元配对的不稳定性，尤其是在使用降阶积分时。\n- **科学依据：** 该问题牢固地植根于偏微分方程数值方法的理论中，是数值不稳定的一个经典例子。它在科学和数学上是合理的。\n- **适定的：** 问题陈述是精确的，提供了所有必要的定义、空间和数值程序来构造所需的解并进行计算。问题本身是适定的。\n- **客观性：** 语言是正式和客观的。\n\n问题陈述是有效的。\n\n### 解答\n\n**第 1 部分：伪解的构造**\n\n齐次离散斯托克斯方程的一个非平凡解，特别是一个具有非零压力分量的解，证明了离散 inf-sup (Ladyzhenskaya-Babuška-Brezzi) 条件的违反。这样的压力 $p_h$ 位于离散散度算子转置的核空间中。我们寻求一个非零的 $p_h \\in Q_h$ 和一个 $v_h \\in V_h$ 以满足离散系统。\n\n关键因素是对双线性形式 $b(v,q)$ 使用了单点求积。由此产生的离散形式 $b_h(v,q)$ 为：\n$$b_h(v,q) = - \\sum_{K \\in \\mathcal{T}_h} |K| q(x_K) (\\nabla \\cdot v)(x_K)$$\n其中 $K$ 表示一个单元， $|K|$ 是其面积， $x_K$ 是其中心。\n\n我们提出一个被称为“棋盘格”模式的压力场 $p_h \\in Q_h$。设网格的节点为 $(x_i, y_j) = (i/2, j/2)$，其中 $i,j \\in \\{0,1,2\\}$。我们通过其节点值 $P_{i,j}$ 来定义 $p_h$：\n$$P_{i,j} = (-1)^{i+j}$$\n根据题目要求，振幅常数设为 $1$。则压力场为 $p_h(x,y) = \\sum_{i,j=0}^2 P_{i,j} \\phi_{i,j}(x,y)$，其中 $\\phi_{i,j}$ 是标准的 $Q_1$ 基函数。\n\n对于一个双线性 ($Q_1$) 单元，函数在单元中心的值是其在四个角节点处值的平均值。让我们对 $2 \\times 2$ 网格中的四个单元逐一验证这一点。\n- **单元 $K_1 = [0, 1/2] \\times [0, 1/2]$:** 节点位于 $(0,0), (1/2,0), (0,1/2), (1/2,1/2)$。节点索引为 $(0,0), (1,0), (0,1), (1,1)$。\n$p_h$ 的节点值为 $P_{0,0}=1, P_{1,0}=-1, P_{0,1}=-1, P_{1,1}=1$。\n在中心点 $x_{K_1}=(1/4, 1/4)$ 处的值为 $p_h(x_{K_1}) = \\frac{1}{4}(P_{0,0} + P_{1,0} + P_{0,1} + P_{1,1}) = \\frac{1}{4}(1 - 1 - 1 + 1) = 0$。\n- **单元 $K_2 = [1/2, 1] \\times [0, 1/2]$:** 节点位于 $(1/2,0), (1,0), (1/2,1/2), (1,1/2)$。节点索引为 $(1,0), (2,0), (1,1), (2,1)$。\n节点值: $P_{1,0}=-1, P_{2,0}=1, P_{1,1}=1, P_{2,1}=-1$。\n在中心点 $x_{K_2}=(3/4, 1/4)$ 处的值: $p_h(x_{K_2}) = \\frac{1}{4}(-1 + 1 + 1 - 1) = 0$。\n- **单元 $K_3 = [0, 1/2] \\times [1/2, 1]$:** 节点位于 $(0,1/2), (1/2,1/2), (0,1), (1/2,1)$。节点索引为 $(0,1), (1,1), (0,2), (1,2)$。\n节点值: $P_{0,1}=-1, P_{1,1}=1, P_{0,2}=1, P_{1,2}=-1$。\n在中心点 $x_{K_3}=(1/4, 3/4)$ 处的值: $p_h(x_{K_3}) = \\frac{1}{4}(-1 + 1 + 1 - 1) = 0$。\n- **单元 $K_4 = [1/2, 1] \\times [1/2, 1]$:** 节点位于 $(1/2,1/2), (1,1/2), (1/2,1), (1,1)$。节点索引为 $(1,1), (2,1), (1,2), (2,2)$。\n节点值: $P_{1,1}=1, P_{2,1}=-1, P_{1,2}=-1, P_{2,2}=1$。\n在中心点 $x_{K_4}=(3/4, 3/4)$ 处的值: $p_h(x_{K_4}) = \\frac{1}{4}(1 - 1 - 1 + 1) = 0$。\n\n由于对所有四个单元 $K$ 都有 $p_h(x_K) = 0$，离散的压力-速度耦合项变为：\n$$b_h(w_h, p_h) = - \\sum_{K \\in \\mathcal{T}_h} |K| \\underbrace{p_h(x_K)}_{0} (\\nabla \\cdot w_h)(x_K) = 0$$\n这对任何测试函数 $w_h \\in V_h$ 都成立。\n\n现在我们必须验证这个 $p_h$ 是 $Q_h$ 的一个有效成员，即 $p_h \\in L^2_0(\\Omega)$ 或 $\\int_\\Omega p_h dx = 0$。\n一个 $Q_1$ 基函数 $\\phi_{i,j}$ 在区域 $\\Omega$ 上的积分与其周围的单元有关。令 $|K|=(1/2)^2=1/4$ 为一个单元的面积。\n- 角节点 (例如 $(0,0)$): $\\int_\\Omega \\phi_{0,0} dx = \\frac{1}{4}|K| = \\frac{1}{16}$。\n- 边节点 (例如 $(1/2,0)$): $\\int_\\Omega \\phi_{1,0} dx = \\frac{1}{4}|K| + \\frac{1}{4}|K| = \\frac{1}{2}|K| = \\frac{1}{8}$。\n- 中心节点 ($(1/2,1/2)$): $\\int_\\Omega \\phi_{1,1} dx = 4 \\times (\\frac{1}{4}|K|) = |K| = \\frac{1}{4}$。\n$p_h$ 的均值为：\n$$\\int_\\Omega p_h dx = \\sum_{i,j=0}^2 P_{i,j} \\int_\\Omega \\phi_{i,j} dx$$\n有 $4$ 个角节点 (_c_)，$4$ 个边节点 (_e_)，和 $1$ 个中心节点 (_m_)。\n$$P_c = P_{0,0}=P_{2,0}=P_{0,2}=P_{2,2}=1$$\n$$P_e = P_{1,0}=P_{0,1}=P_{2,1}=P_{1,2}=-1$$\n$$P_m = P_{1,1}=1$$\n$$\\int_\\Omega p_h dx = 4 \\cdot P_c \\cdot \\frac{1}{16} + 4 \\cdot P_e \\cdot \\frac{1}{8} + 1 \\cdot P_m \\cdot \\frac{1}{4} = 4(1)\\frac{1}{16} + 4(-1)\\frac{1}{8} + 1(1)\\frac{1}{4} = \\frac{1}{4} - \\frac{1}{2} + \\frac{1}{4} = 0$$\n所以，$p_h \\in Q_h$。\n\n有了这个 $p_h$，第一个离散斯托克斯方程变为：\n$$a(v_h, w_h) + b_h(w_h, p_h) = a(v_h, w_h) + 0 = 0 \\quad \\forall w_h \\in V_h$$\n我们选择 $v_h = 0$。那么 $a(0, w_h) = 0$，满足该方程。\n第二个离散斯托克斯方程是：\n$$b_h(v_h, q_h) = b_h(0, q_h) = 0 \\quad \\forall q_h \\in Q_h$$\n这也同样满足。\n因此，配对 $(v_h, p_h) = (0, \\text{棋盘格模式})$ 是离散齐次系统的一个非平凡解。$p_h$ 是非零的（因为它的节点值不全为零），而 $v_h$ 是零。这个构造证明了离散 inf-sup 条件的违反。\n\n**第 2 部分：$\\|p_h\\|_{L^2(\\Omega)}$ 的计算**\n\n我们需要计算 $\\|p_h\\|_{L^2(\\Omega)} = \\left(\\int_{\\Omega} p_h(x,y)^2 dx dy\\right)^{1/2}$。我们可以通过对四个单元上的积分求和来计算它：\n$$\\|p_h\\|^2_{L^2(\\Omega)} = \\sum_{e=1}^4 \\int_{K_e} p_h(x,y)^2 dx dy$$\n让我们找出一个单元上 $p_h$ 的解析形式。在一个坐标为 $(\\hat{x}, \\hat{y})$ 的参考单元 $[0,1]^2$ 上，一个双线性函数由 $f(\\hat{x},\\hat{y}) = \\sum_{i,j=0}^1 f_{ij} (1-|\\hat{x}-i|)(1-|\\hat{y}-j|)$ 给出。在单元 $K_1=[0,1/2]\\times[0,1/2]$ 上，局部坐标是 $\\hat{x}=2x, \\hat{y}=2y$。节点值为 $P_{0,0}=1, P_{1,0}=-1, P_{0,1}=-1, P_{1,1}=1$。\n在参考单元 $[0,1]^2$ 上的函数是：\n$$p_h(\\hat{x},\\hat{y}) = (1-\\hat{x})(1-\\hat{y})(1) + \\hat{x}(1-\\hat{y})(-1) + (1-\\hat{x})\\hat{y}(-1) + \\hat{x}\\hat{y}(1)$$\n$$= (1-\\hat{y})(1-\\hat{x}-\\hat{x}) + \\hat{y}(-1+\\hat{x}+\\hat{x}) = (1-\\hat{y})(1-2\\hat{x}) + \\hat{y}(2\\hat{x}-1) = (1-2\\hat{y})(1-2\\hat{x})$$\n代回 $\\hat{x}=2x, \\hat{y}=2y$，我们得到对于 $(x,y) \\in K_1$，$p_h(x,y) = (1-4x)(1-4y)$。\n在 $K_1$ 上的积分是：\n$$\\int_{K_1} p_h^2 dx dy = \\int_0^{1/2} \\int_0^{1/2} (1-4x)^2 (1-4y)^2 dx dy$$\n该积分是可分的：\n$$\\left( \\int_0^{1/2} (1-4x)^2 dx \\right) \\left( \\int_0^{1/2} (1-4y)^2 dy \\right)$$\n让我们计算其中一个积分。令 $u = 1-4x$，则 $du = -4dx$。\n$$\\int_0^{1/2} (1-4x)^2 dx = \\int_1^{-1} u^2 \\left(-\\frac{1}{4}\\right) du = \\frac{1}{4} \\int_{-1}^1 u^2 du = \\frac{1}{4} \\left[ \\frac{u^3}{3} \\right]_{-1}^1 = \\frac{1}{4} \\left( \\frac{1}{3} - \\frac{-1}{3} \\right) = \\frac{1}{4} \\cdot \\frac{2}{3} = \\frac{1}{6}$$\n因此，在 $K_1$ 上的积分是 $\\frac{1}{6} \\times \\frac{1}{6} = \\frac{1}{36}$。\n\n通过对称性，四个单元上各自的积分是相同的。例如，在 $K_4=[1/2,1]\\times[1/2,1]$ 上，$\\hat{x}=2x-1, \\hat{y}=2y-1$。节点值为 $(1,-1,-1,1)$，与 $K_1$ 相同。所以 $p_h(x,y) = (1-2\\hat{x})(1-2\\hat{y}) = (1-2(2x-1))(1-2(2y-1)) = (3-4x)(3-4y)$。积分 $\\int_{1/2}^1(3-4x)^2 dx$ 的计算结果也是 $1/6$。\n在 $K_2$ 和 $K_3$ 上，节点值模式是 $(-1,1,1,-1)$，这是 $K_1$ 上模式的负值。函数是 $p_h(\\hat{x},\\hat{y})=(2\\hat{x}-1)(1-2\\hat{y})$。将此函数平方后积分，会得到相同的结果。\n因此，总积分是单个单元上积分的四倍：\n$$\\|p_h\\|^2_{L^2(\\Omega)} = 4 \\times \\frac{1}{36} = \\frac{1}{9}$$\n$L^2$范数是这个值的平方根：\n$$\\|p_h\\|_{L^2(\\Omega)} = \\sqrt{\\frac{1}{9}} = \\frac{1}{3}$$\n这是振幅为 $1$ 的指定棋盘格压力模式的范数的精确值。",
            "answer": "$$\\boxed{\\frac{1}{3}}$$"
        },
        {
            "introduction": "在认识到不稳定的根源后，下一步是设计一种“疗法”。压力稳定化Petrov-Galerkin（PSPG）方法通过在弱形式中添加一个基于残差的项来抑制伪压力模式。这个练习的核心是推导PSPG方法的关键——稳定化参数$\\tau_{K}$。你将学习如何通过将其与一个“理想的”稳定化算子（即单元格林算子）进行比较，来合理地确定$\\tau_{K}$的表达式，从而揭示其与物理粘性$\\nu$和网格尺寸$h_{K}$的内在联系。",
            "id": "3401450",
            "problem": "考虑在单位正方形 $\\Omega=(0,1)^{2}$ 上的稳态斯托克斯方程，其运动粘度 $\\nu>0$ 为常数，并带有齐次狄利克雷速度边界条件。令 $\\mathcal{T}_{h}$ 为 $\\Omega$ 的一个拟一致剖分，其单元为边长是 $h_{K}$ 的轴对齐正方形（因此对于所有 $K\\in\\mathcal{T}_{h}$ 都有 $h_{K}=h$），并考虑用于速度和压力的同阶连续双线性有限元空间。用 $a(\\boldsymbol{u},\\boldsymbol{v})=\\nu\\int_{\\Omega}\\nabla \\boldsymbol{u}:\\nabla \\boldsymbol{v}\\,dx$ 和 $b(\\boldsymbol{v},q)=-\\int_{\\Omega}q\\,\\nabla\\cdot \\boldsymbol{v}\\,dx$ 表示标准的双线性形式。一种基于残差的压力稳定化/Petrov-Galerkin (PSPG) 稳定化方法通过为压力测试函数 $q_{h}$ 添加逐单元项来增强混合方法\n$$\ns_{h}\\big((\\boldsymbol{u}_{h},p_{h}),(0,q_{h})\\big)\\;=\\;\\sum_{K\\in\\mathcal{T}_{h}}\\tau_{K}\\,\\big(-\\nu\\Delta \\boldsymbol{u}_{h}+\\nabla p_{h}-\\boldsymbol{f},\\,\\nabla q_{h}\\big)_{K},\n$$\n其中 $(\\cdot,\\cdot)_{K}$ 表示 $L^{2}(K)$ 内积，$\\tau_{K}>0$ 是一个逐单元选择的标量参数。推导 $\\tau_{K}$ 的一种方法是，将 $s_{h}$ 与一种“理想”的局部稳定化进行比较，该稳定化使用单元格林算子 $G_{K}:L^{2}(K)^{2}\\to H_{0}^{1}(K)^{2}$，其定义为在 $K$ 中 $-\\Delta \\boldsymbol{w}= \\boldsymbol{\\phi}$，在 $\\partial K$ 上 $\\boldsymbol{w}=\\boldsymbol{0}$。特别地，对于 $\\boldsymbol{\\phi}=\\nabla q_{h}$ 和 $K$ 上的狄利克雷拉普拉斯特征对 $\\{-\\Delta \\varphi_{m}=\\lambda_{m}\\varphi_{m}\\}$，谱表示可推导出如下界：\n$$\n\\frac{1}{\\lambda_{\\max}(K)}\\,\\|\\nabla q_{h}\\|_{0,K}^{2}\\ \\le\\ \\big(\\nabla q_{h},\\,G_{K}\\,\\nabla q_{h}\\big)_{K}\\ \\le\\ \\frac{1}{\\lambda_{1}(K)}\\,\\|\\nabla q_{h}\\|_{0,K}^{2},\n$$\n其中 $\\lambda_{1}(K)$ 是作用于 $\\nabla q_{h}$ 的相关有限维内容上的最小特征值，$\\lambda_{\\max}(K)$ 是最大特征值。在一个边长为 $h_{K}$、带有零狄利克雷边界条件的正方形单元 $K$ 上，狄利克雷拉普拉斯特征值为 $\\lambda_{m,n}(K)=\\pi^{2}(m^{2}+n^{2})/h_{K}^{2}$（对于整数 $m,n\\ge 1$），因此 $\\lambda_{1}(K)=2\\pi^{2}/h_{K}^{2}$。\n\n将基于残差的 PSPG 项视为在 $\\nabla q_{h}$ 上的二次型中用 $\\tau_{K} I$ 替代 $G_{K}$，选择 $\\tau_{K}$ 使得代数稳定化项主导理想稳定化项（从而确保压力的一个网格无关的稳定性下界）。仅使用上述基本事实和定义，推导出一个用 $h_{K}$、$\\nu$ 和普适常数表示的 $\\tau_{K}$ 的闭式表达式。以单一解析表达式的形式给出最终的 $\\tau_{K}$。不需要进行数值舍入，最终表达式中不应包含任何单位。",
            "solution": "该问题要求为稳态斯托克斯方程推导压力稳定化/Petrov-Galerkin (PSPG) 稳定化参数 $\\tau_K$ 的闭式表达式。该推导应基于与一种“理想”稳定化方法的比较。\n\n问题陈述了在区域 $\\Omega=(0,1)^2$ 上考虑具有恒定运动粘度 $\\nu>0$ 的稳态斯托克斯方程。动量方程的残差为 $R_{\\boldsymbol{u}} = -\\nu\\Delta \\boldsymbol{u}_{h}+\\nabla p_{h}-\\boldsymbol{f}$。PSPG 稳定化项由下式给出：\n$$\ns_{h}\\big((\\boldsymbol{u}_{h},p_{h}),(0,q_{h})\\big)\\;=\\;\\sum_{K\\in\\mathcal{T}_{h}}\\tau_{K}\\,\\big(R_{\\boldsymbol{u}},\\,\\nabla q_{h}\\big)_{K}\n$$\n此项被加到连续性方程的弱形式中。该项中作用于压力试探函数 $p_h$ 和测试函数 $q_h$ 的部分可以由双线性形式 $\\sum_{K \\in \\mathcal{T}_h} (\\tau_K \\nabla p_h, \\nabla q_h)_K$ 表示。在一个单元 $K$ 上的相关二次型为 $\\tau_K (\\nabla p_h, \\nabla p_h)_K = \\tau_K \\|\\nabla p_h\\|_{0,K}^2$。\n\n选择 $\\tau_K$ 的动机是，将此代数稳定化与一种“理想”的局部稳定化进行比较。理想稳定化源于在每个单元上对动量残差内的微分算子求逆的想法。作用于速度的相关微分算子是 $-\\nu\\Delta$。因此，理想稳定化将涉及逆算子 $(-\\nu\\Delta_K)^{-1}$，其中 $\\Delta_K$ 是在单元 $K$ 上带有齐次狄利克雷边界条件的拉普拉斯算子。该逆算子是算子 $-\\nu\\Delta$ 的单元格林算子，我们将其表示为 $G_{K,\\nu}$。\n\n问题陈述为典则拉普拉斯算子 $-\\Delta$ 定义了一个格林算子 $G_K$，使得 $-\\Delta \\boldsymbol{w} = \\boldsymbol{\\phi}$ 的解为 $\\boldsymbol{w}=G_K\\boldsymbol{\\phi}$。$G_{K,\\nu}$ 和 $G_K$ 之间的关系由它们的定义推导得出：\n如果 $-\\nu\\Delta \\boldsymbol{w} = \\boldsymbol{\\phi}$，则 $\\boldsymbol{w} = (-\\nu\\Delta_K)^{-1}\\boldsymbol{\\phi} = \\frac{1}{\\nu}(-\\Delta_K)^{-1}\\boldsymbol{\\phi} = \\frac{1}{\\nu}G_K\\boldsymbol{\\phi}$。因此，$G_{K,\\nu} = \\frac{1}{\\nu}G_K$。虽然问题陈述提到用 $\\tau_K I$ 替代 $G_K$，但寻找作为 $\\nu$ 函数的 $\\tau_K$ 的要求以及稳定化的物理起源意味着，必须与物理上正确的理想算子 $G_{K,\\nu}$ 进行比较。\n\n与理想稳定化相关的二次型（作用于残差的压力部分）是 $(\\nabla p_h, G_{K,\\nu} \\nabla p_h)_K$。代入关系式 $G_{K,\\nu} = \\frac{1}{\\nu}G_K$，这变成：\n$$\n(\\nabla p_h, G_{K,\\nu} \\nabla p_h)_K = \\frac{1}{\\nu}(\\nabla p_h, G_K \\nabla p_h)_K\n$$\n问题提供了涉及 $G_K$ 的二次型的谱界：\n$$\n\\frac{1}{\\lambda_{\\max}(K)}\\,\\|\\nabla q_{h}\\|_{0,K}^{2}\\ \\le\\ \\big(\\nabla q_{h},\\,G_{K}\\,\\nabla q_{h}\\big)_{K}\\ \\le\\ \\frac{1}{\\lambda_{1}(K)}\\,\\|\\nabla q_{h}\\|_{0,K}^{2}\n$$\n其中 $\\lambda_1(K)$ 是 $K$ 上狄利克雷拉普拉斯算子的最小特征值。将这些界应用于理想稳定化形式可得：\n$$\n\\frac{1}{\\nu\\lambda_{\\max}(K)}\\,\\|\\nabla p_{h}\\|_{0,K}^{2}\\ \\le\\ (\\nabla p_{h},\\,G_{K,\\nu}\\,\\nabla p_{h}\\big)_{K}\\ \\le\\ \\frac{1}{\\nu\\lambda_{1}(K)}\\,\\|\\nabla p_{h}\\|_{0,K}^{2}\n$$\n任务是选择 $\\tau_K$ 使得代数稳定化项 $\\tau_K \\|\\nabla p_h\\|_{0,K}^2$ “主导”理想稳定化项。这被解释为选择 $\\tau_K$ 与理想算子关于 $\\nabla p_h$ 范数的谱半径的上界同阶。理想算子的瑞利商的上确界由 $\\frac{1}{\\nu\\lambda_1(K)}$ 限定。\n$$\n\\sup_{p_h \\ne const.} \\frac{(\\nabla p_{h},\\,G_{K,\\nu}\\,\\nabla p_{h}\\big)_{K}}{\\|\\nabla p_h\\|_{0,K}^2} \\le \\frac{1}{\\nu\\lambda_1(K)}\n$$\n稳定化参数的一个标准且稳健的选择是将其设置为此上界，以确保稳定化足够强但又不过度。\n$$\n\\tau_K = \\frac{1}{\\nu\\lambda_{1}(K)}\n$$\n问题指明，对于边长为 $h_K$ 的正方形单元 $K$，狄利克雷拉普拉斯算子的最小特征值为：\n$$\n\\lambda_1(K) = \\frac{2\\pi^2}{h_K^2}\n$$\n将此代入 $\\tau_K$ 的表达式中，得到最终的闭式表达式：\n$$\n\\tau_K = \\frac{1}{\\nu \\left( \\frac{2\\pi^2}{h_K^2} \\right)} = \\frac{h_K^2}{2\\pi^2\\nu}\n$$\n此表达式根据单元尺寸 $h_K$、运动粘度 $\\nu$ 和普适常数 $\\pi$ 定义了稳定化参数 $\\tau_K$，符合要求。",
            "answer": "$$\\boxed{\\frac{h_{K}^{2}}{2\\pi^{2}\\nu}}$$"
        },
        {
            "introduction": "前面的练习展示了不稳定性并推导了稳定化参数，但稳定化究竟是如何在整个离散系统中起作用的？本练习提供了一个强大的定量分析工具——离散傅里叶分析——来审视PSPG稳定化的全局效果。通过推导并计算压力舒尔补算子的符号，你将能够精确地识别出无稳定化时存在的伪零模，并验证PSPG如何消除它们，同时显著改善系统的条件数，从而将理论与计算结果直接联系起来。",
            "id": "3401461",
            "problem": "考虑单位周期性方形域上的稳态不可压缩 Stokes 方程，其形式为 $-\\nu\\,\\Delta \\mathbf{u} + \\nabla p = \\mathbf{f}$ 和 $\\nabla\\cdot\\mathbf{u} = 0$，其中运动粘度 $\\nu>0$ 为常数，边界条件在 $[0,1]^2$ 上是周期性的，并带有零均值压力约束。假设速度 $\\mathbf{u}$ 和压力 $p$ 在同一个具有 $N_x\\times N_y$ 个点的均匀网格上进行离散，网格间距在 $x$ 方向为 $h=1/N_x$，在 $y$ 方向为 $h=1/N_y$（为简单起见，假设 $N_x=N_y$），并且周期性边界条件通过标准中心差分实现。离散线性系统可以写成分块形式：\n$A\\mathbf{u} + Gp = \\mathbf{b}$ 和 $D\\mathbf{u} - Cp = 0$，其中 $A$ 是由 $\\nu$ 缩放的离散向量拉普拉斯算子，$G$ 是离散梯度，$D$ 是离散散度，$C$ 是压力稳定 Petrov-Galerkin (PSPG) 稳定化算子，定义为 $C=\\tau L_p$，其中 $\\tau\\ge 0$ 是一个稳定化参数，$L_p$ 是作用于压力场的离散标量拉普拉斯算子。$C$ 项应被理解为源于基于残差的压力稳定 Petrov-Galerkin (PSPG) 方法，该方法添加了一个与压力梯度成正比的弱一致性项，以稳定等阶速度-压力离散。\n\n您的任务是：\n- 基于速度的分块消元，在周期性边界条件下，使用均匀网格上的离散中心差分梯度、散度和拉普拉斯算子，推导压力 Schur 补的离散傅里叶符号。角度必须以弧度处理。\n- 使用此符号，确定在周期性边界条件下，采用 PSPG 稳定化时的离散压力零空间结构。从第一性原理出发证明，当 $\\tau>0$ 时，常数压力模是唯一的零模，并指出当 $\\tau=0$ 时，由于同位中心差分而产生的任何额外零模。\n- 通过为每个参数集计算所有非零傅里叶模上离散压力 Schur 补符号的条件数，来量化 PSPG 带来的条件数改善。条件数定义为所有离散模中（排除精确零模或接近零的模，使用 $10^{-12}$ 的数值阈值来分类接近零的值）最大正符号值与最小正符号值之比。\n\n实现要求：\n- 在均匀周期性网格的离散傅里叶空间中工作。设 $\\theta_x = 2\\pi j_x/N_x$ 和 $\\theta_y = 2\\pi j_y/N_y$，其中整数索引 $j_x\\in\\{0,1,\\dots,N_x-1\\}$ 和 $j_y\\in\\{0,1,\\dots,N_y-1\\}$，以弧度度量。使用梯度、散度和拉普拉斯符号的中心差分定义，并通过分块消元组装压力 Schur 补符号。不要假设或导入任何预先推导的目标公式；相反，应从您推导的基本离散算子计算它。\n- 对于每个测试用例，计算：\n    1. 无 PSPG ($\\tau=0$) 时的离散零模数量，计为 Schur 补符号低于 $10^{-12}$ 的傅里叶模的数量。\n    2. 有 PSPG ($\\tau>0$) 时的离散零模数量。\n    3. 无 PSPG 时的条件数，定义为所有模上最大严格正符号值与最小严格正符号值之比。\n    4. 有 PSPG 时的条件数，定义类似。\n- 角度必须以弧度处理，所有输出均为无量纲实数或整数。\n\n测试套件：\n- 情况 1：$N_x=N_y=32$，$\\nu=1.0$，$\\tau=0.05$。\n- 情况 2：$N_x=N_y=32$，$\\nu=1.0$，$\\tau=10^{-6}$。\n- 情况 3：$N_x=N_y=16$，$\\nu=0.1$，$\\tau=0.02$。\n- 情况 4：$N_x=N_y=16$，$\\nu=1.0$，$\\tau=0.0$。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个由逗号分隔的列表，该列表被方括号括起，其中每个元素对应一个测试用例，并且本身是一个包含四个值的逗号分隔列表 $[n_0,n_{\\mathrm{PSPG}},\\kappa_0,\\kappa_{\\mathrm{PSPG}}]$，其中 $n_0$ 是无 PSPG 时的零模数量，$n_{\\mathrm{PSPG}}$ 是有 PSPG 时的零模数量，$\\kappa_0$ 是无 PSPG 时的条件数，$\\kappa_{\\mathrm{PSPG}}$ 是有 PSPG 时的条件数。例如，输出应类似于 $[[n_0,n_{\\mathrm{PSPG}},\\kappa_0,\\kappa_{\\mathrm{PSPG}}],[\\dots],[\\dots],[\\dots]]$。",
            "solution": "该问题是有效的，因为它在偏微分方程的数值分析方面有科学依据，是适定的，有足够的信息得到唯一解，并且以客观、正式的语言表述。我们开始求解。\n\n任务是在周期性域上，分析带有压力稳定 Petrov-Galerkin (PSPG) 稳定化的 Stokes 方程的离散压力 Schur 补。分析在离散傅里叶空间中进行。\n\n离散化的 Stokes 系统为：\n$$\nA\\mathbf{u} + Gp = \\mathbf{b} \\\\\nD\\mathbf{u} - Cp = 0\n$$\n其中 $\\mathbf{u}$ 是离散速度向量，$p$ 是离散压力标量，$A$ 是由粘度 $\\nu$ 缩放的离散向量拉普拉斯算子，$G$ 是离散梯度，$D$ 是离散散度，$C = \\tau L_p$ 是 PSPG 稳定化算子，其中 $L_p$ 是离散标量拉普拉斯算子。\n\n我们在离散傅里叶域中进行分析。在一个具有 $N_x=N_y=N$ 个点和网格间距 $h=1/N$ 的均匀周期性网格上，一个网格函数 $\\phi_{j_x,j_y}$ 被变换为其傅里叶模 $\\hat{\\phi}(\\theta_x, \\theta_y)$，其中 $\\theta_x = 2\\pi m_x/N$ 和 $\\theta_y = 2\\pi m_y/N$，整数波数 $m_x, m_y \\in \\{0, 1, \\dots, N-1\\}$。一个线性差分算子 $L$ 在此空间中由其符号 $\\hat{L}(\\theta_x, \\theta_y)$ 表示，使得 $\\widehat{L\\phi} = \\hat{L}\\hat{\\phi}$。\n\n首先，我们基于标准的二阶中心差分推导离散算子的符号。\n\n$x$ 方向一阶导数的中心差分算子是 $(\\delta_{2x} f)_j = (f_{j+1} - f_{j-1})/(2h)$。应用一个傅里叶模 $e^{i j \\theta_x}$，其符号为：\n$$\n\\widehat{\\delta_{2x}}(\\theta_x) = \\frac{e^{i\\theta_x} - e^{-i\\theta_x}}{2h} = \\frac{2i\\sin(\\theta_x)}{2h} = \\frac{i\\sin(\\theta_x)}{h}\n$$\n作用于标量压力场 $p$ 的离散梯度算子 $G$ 的符号是一个向量：\n$$\n\\hat{G}(\\theta_x, \\theta_y) = \\begin{pmatrix} \\widehat{\\delta_{2x}}(\\theta_x) \\\\ \\widehat{\\delta_{2y}}(\\theta_y) \\end{pmatrix} = \\frac{i}{h} \\begin{pmatrix} \\sin(\\theta_x) \\\\ \\sin(\\theta_y) \\end{pmatrix}\n$$\n作用于向量速度场 $\\mathbf{u}$ 的离散散度算子 $D$ 的符号是一个行向量：\n$$\n\\hat{D}(\\theta_x, \\theta_y) = \\begin{bmatrix} \\widehat{\\delta_{2x}}(\\theta_x)  \\widehat{\\delta_{2y}}(\\theta_y) \\end{bmatrix} = \\frac{i}{h} \\begin{bmatrix} \\sin(\\theta_x)  \\sin(\\theta_y) \\end{bmatrix}\n$$\n标准的五点中心差分标量拉普拉斯算子是 $L_p \\phi = (\\phi_{j+1,k} + \\phi_{j-1,k} + \\phi_{j,k+1} + \\phi_{j,k-1} - 4\\phi_{j,k})/h^2$。其符号为：\n$$\n\\hat{L}_p(\\theta_x, \\theta_y) = \\frac{e^{i\\theta_x} + e^{-i\\theta_x} + e^{i\\theta_y} + e^{-i\\theta_y} - 4}{h^2} = \\frac{2\\cos(\\theta_x) + 2\\cos(\\theta_y) - 4}{h^2}\n$$\n使用恒等式 $1 - \\cos(\\alpha) = 2\\sin^2(\\alpha/2)$，可简化为：\n$$\n\\hat{L}_p(\\theta_x, \\theta_y) = -\\frac{4}{h^2} \\left( \\sin^2\\left(\\frac{\\theta_x}{2}\\right) + \\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\right)\n$$\n该符号是非正的。离散向量拉普拉斯算子 $A$ 逐分量作用于 $\\mathbf{u}$ 并由 $-\\nu$ 缩放，因此 $A = -\\nu L_p I$，其中 $I$ 是 $2 \\times 2$ 单位矩阵。其符号是一个对角矩阵：\n$$\n\\hat{A}(\\theta_x, \\theta_y) = -\\nu \\hat{L}_p(\\theta_x, \\theta_y) I = \\frac{4\\nu}{h^2} \\left( \\sin^2\\left(\\frac{\\theta_x}{2}\\right) + \\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\right) I\n$$\nPSPG 稳定化算子 $C=\\tau L_p$ 的符号为：\n$$\n\\hat{C}(\\theta_x, \\theta_y) = \\tau \\hat{L}_p(\\theta_x, \\theta_y) = -\\frac{4\\tau}{h^2} \\left( \\sin^2\\left(\\frac{\\theta_x}{2}\\right) + \\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\right)\n$$\n为了求 Schur 补，我们将分块系统变换到傅里叶空间：\n$$\n\\hat{A} \\hat{\\mathbf{u}} + \\hat{G} \\hat{p} = \\hat{\\mathbf{b}} \\\\\n\\hat{D} \\hat{\\mathbf{u}} - \\hat{C} \\hat{p} = 0\n$$\n从第一个方程，我们对 $\\hat{A}$ 可逆的模（即所有非零波向量）形式上求解 $\\hat{\\mathbf{u}}$：\n$$\n\\hat{\\mathbf{u}} = \\hat{A}^{-1}(\\hat{\\mathbf{b}} - \\hat{G} \\hat{p})\n$$\n将此代入第二个方程得到：\n$$\n\\hat{D} \\hat{A}^{-1}(\\hat{\\mathbf{b}} - \\hat{G} \\hat{p}) - \\hat{C} \\hat{p} = 0 \\implies (\\hat{D} \\hat{A}^{-1} \\hat{G} + \\hat{C}) \\hat{p} = \\hat{D} \\hat{A}^{-1} \\hat{\\mathbf{b}}\n$$\n压力 Schur 补符号是 $\\hat{S}(\\theta_x, \\theta_y) = \\hat{D} \\hat{A}^{-1} \\hat{G} + \\hat{C}$。根据问题的符号约定，该符号似乎是负半定的。为了进行条件数分析，我们使用正定算子 $-\\hat{S}$。这对应于一个 Schur 补为正定的标准提法。我们将此正定符号记为 $\\hat{S}_{\\text{pd}}$。\n$$\n\\hat{S}_{\\text{pd}}(\\theta_x, \\theta_y) = -(\\hat{D} \\hat{A}^{-1} \\hat{G} + \\hat{C}) = - \\hat{D}\\hat{A}^{-1}\\hat{G} - \\hat{C}\n$$\n我们来计算各项。第一项是：\n$$\n-\\hat{D}\\hat{A}^{-1}\\hat{G} = - \\left( \\frac{i}{h} \\begin{bmatrix} s_x  s_y \\end{bmatrix} \\right) \\left( \\frac{h^2}{4\\nu(s_{x/2}^2+s_{y/2}^2)} I \\right) \\left( \\frac{i}{h} \\begin{pmatrix} s_x \\\\ s_y \\end{pmatrix} \\right)\n$$\n其中 $s_{\\alpha} = \\sin(\\alpha)$ 且 $s^2_{\\alpha/2} = \\sin^2(\\alpha/2)$。\n$$\n-\\hat{D}\\hat{A}^{-1}\\hat{G} = \\frac{s_x^2 + s_y^2}{4\\nu(s_{x/2}^2+s_{y/2}^2)}\n$$\n使用 $s_x^2 = (2s_{x/2}c_{x/2})^2 = 4s_{x/2}^2c_{x/2}^2$，其中 $c_{\\alpha}=\\cos(\\alpha)$：\n$$\n-\\hat{D}\\hat{A}^{-1}\\hat{G} = \\frac{4s_{x/2}^2c_{x/2}^2 + 4s_{y/2}^2c_{y/2}^2}{4\\nu(s_{x/2}^2+s_{y/2}^2)} = \\frac{1}{\\nu} \\frac{s_{x/2}^2c_{x/2}^2 + s_{y/2}^2c_{y/2}^2}{s_{x/2}^2+s_{y/2}^2}\n$$\n第二项是 $-\\hat{C} = -\\tau \\hat{L}_p$：\n$$\n-\\hat{C}(\\theta_x, \\theta_y) = \\frac{4\\tau}{h^2} \\left( s_{x/2}^2 + s_{y/2}^2 \\right)\n$$\n所以，完整的正定 Schur 补符号是：\n$$\n\\hat{S}_{\\text{pd}}(\\theta_x, \\theta_y) = \\frac{1}{\\nu} \\frac{\\sin^2(\\frac{\\theta_x}{2})\\cos^2(\\frac{\\theta_x}{2}) + \\sin^2(\\frac{\\theta_y}{2})\\cos^2(\\frac{\\theta_y}{2})}{\\sin^2(\\frac{\\theta_x}{2}) + \\sin^2(\\frac{\\theta_y}{2})} + \\frac{4\\tau}{h^2}\\left(\\sin^2\\left(\\frac{\\theta_x}{2}\\right) + \\sin^2\\left(\\frac{\\theta_y}{2}\\right)\\right)\n$$\n该表达式对除 $(\\theta_x, \\theta_y)=(0,0)$ 之外的所有模都有效，在 $(\\theta_x, \\theta_y)=(0,0)$ 处第一项的分母为零。对于这个常数模，算子 $\\hat{G}, \\hat{D}, \\hat{L}_p$ 均为零，使得压力无约束。这代表了物理上的常数压力零模。根据定义，我们认为 $\\hat{S}_{\\text{pd}}(0,0)=0$。\n\n现在我们分析 $\\hat{S}_{\\text{pd}}$ 的零空间：如果 $\\hat{S}_{\\text{pd}}(\\theta_x, \\theta_y)=0$，则模 $(\\theta_x, \\theta_y)$ 是一个零模。由于 $\\hat{S}_{\\text{pd}}$ 中的两项都是非负的，其和为零当且仅当两项都为零。\n\n情况 $\\tau > 0$ (有 PSPG):\n第二项 $\\frac{4\\tau}{h^2}(\\sin^2(\\frac{\\theta_x}{2}) + \\sin^2(\\frac{\\theta_y}{2}))$ 仅在 $\\sin(\\theta_x/2)=0$ 且 $\\sin(\\theta_y/2)=0$ 时为零。考虑到 $\\theta_x, \\theta_y \\in [0, 2\\pi)$，这只在 $(\\theta_x, \\theta_y)=(0,0)$ 时发生。在此模下，第一项根据定义也为零。因此，对于 $\\tau > 0$，唯一的零模是常数压力模 $(0,0)$。\n\n情况 $\\tau = 0$ (无 PSPG):\n第二项恒为零。零模仅由第一项决定。如果分子 $\\sin^2(\\frac{\\theta_x}{2})\\cos^2(\\frac{\\theta_x}{2}) + \\sin^2(\\frac{\\theta_y}{2})\\cos^2(\\frac{\\theta_y}{2})$ 为零，则该项为零。由于每一部分都是非负的，这要求 $\\sin(\\theta_x/2)\\cos(\\theta_x/2)=0$ 和 $\\sin(\\theta_y/2)\\cos(\\theta_y/2)=0$ 同时成立。这等价于 $\\sin(\\theta_x)=0$ 和 $\\sin(\\theta_y)=0$。\n对于 $\\theta_x = 2\\pi m_x / N$，其中 $m_x \\in \\{0, \\dots, N-1\\}$，$\\sin(\\theta_x)=0$ 在 $m_x=0$ 和 $m_x=N/2$（如果 $N$ 是偶数）处成立。$m_y$ 也类似。\n由于所有测试用例都使用偶数 $N$，零模出现在 $(m_x, m_y)$ 值为 $(0,0), (0,N/2), (N/2,0), (N/2,N/2)$ 的地方。这些对应于傅里叶角 $(\\theta_x, \\theta_y)$ 为 $(0,0), (0,\\pi), (\\pi,0), (\\pi,\\pi)$。这四个模包括常数模和三个高频棋盘模，它们是等阶同位离散已知的伪影。\n\n条件数：\n无 PSPG ($\\tau=0$) 时，对于接近棋盘模 $(\\theta_x, \\theta_y) \\approx (\\pi, \\pi)$ 的模，符号值很小，但对于长波模 $(\\theta_x, \\theta_y) \\approx (0,0)$，符号值很大。当 $(\\theta_x, \\theta_y) \\to (0,0)$ 时，第一项的极限是 $1/\\nu$。最小非零值出现在棋盘模附近，其尺度为 $O(h^2) = O(1/N^2)$。这导致条件数 $\\kappa_0 \\propto N^2$。\n有 PSPG ($\\tau > 0$) 时，第二项 $\\frac{4\\tau}{h^2}(\\dots)$ “抬升”了棋盘模附近的小值。例如，在 $(\\pi, \\pi)$ 处，第一项为 $0$，但第二项是 $8\\tau/h^2 = 8\\tau N^2$。这个大值阻止了符号变得很小，从而正则化了算子并显著改善了条件数，使其在适当选择 $\\tau$ 的情况下对 $N$ 的依赖性减小。\n\n现在，数值实现将为指定的测试用例计算这些量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite.\n    Derives the pressure Schur complement symbol and computes null mode counts and condition numbers.\n    \"\"\"\n    test_cases = [\n        # (N, nu, tau)\n        (32, 1.0, 0.05),\n        (32, 1.0, 1e-6),\n        (16, 0.1, 0.02),\n        (16, 1.0, 0.0),\n    ]\n\n    all_results = []\n    \n    for N, nu, tau in test_cases:\n        # The function to compute metrics for a single case\n        results = compute_metrics(N, nu, tau)\n        all_results.append(results)\n\n    # Format the final output string as specified\n    # Use f-string with formatting for floating point numbers to ensure consistency\n    formatted_results = [f\"[{r[0]},{r[1]},{r[2]:.10e},{r[3]:.10e}]\" for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef compute_metrics(N, nu, tau):\n    \"\"\"\n    Computes the required metrics for a given set of parameters (N, nu, tau).\n    \n    Returns a list [n_0, n_PSPG, kappa_0, kappa_PSPG].\n    \"\"\"\n    h = 1.0 / N\n    # Create grid of integer mode indices\n    m = np.arange(N)\n    mx, my = np.meshgrid(m, m, indexing='ij')\n\n    # Calculate grid of Fourier angles\n    theta_x = 2 * np.pi * mx / N\n    theta_y = 2 * np.pi * my / N\n    \n    # Pre-calculate sine terms for efficiency and clarity\n    sin_sq_half_x = np.sin(theta_x / 2)**2\n    sin_sq_half_y = np.sin(theta_y / 2)**2\n    \n    # Denominator of the first term of the symbol\n    denom_term1 = sin_sq_half_x + sin_sq_half_y\n    \n    # Numerator of the first term of the symbol\n    cos_sq_half_x = np.cos(theta_x / 2)**2\n    cos_sq_half_y = np.cos(theta_y / 2)**2\n    num_term1_times_nu = (sin_sq_half_x * cos_sq_half_x + sin_sq_half_y * cos_sq_half_y)\n    \n    # Calculate the first term of the symbol (from DA^{-1}G)\n    # This corresponds to the case tau=0\n    # The symbol is S_pd = (1/nu) * num / den\n    symbol_tau_0 = np.zeros_like(denom_term1)\n    \n    # Avoid division by zero at the (0,0) mode\n    # A mask for all non-zero wavevectors\n    non_zero_mode = denom_term1 > 1e-15\n    symbol_tau_0[non_zero_mode] = (1 / nu) * num_term1_times_nu[non_zero_mode] / denom_term1[non_zero_mode]\n    # The (0,0) mode is a null mode by definition\n    # Its symbol's value is 0.\n\n    # Calculate the second term of the symbol (from PSPG stabilization)\n    term2_given = (4 * tau / h**2) * denom_term1\n    \n    # The full symbol for the given tau\n    symbol_tau_given = symbol_tau_0 + term2_given\n\n    # Numerical threshold for identifying null modes\n    threshold = 1e-12\n\n    # 1. Count null modes for tau=0\n    n_0 = np.sum(symbol_tau_0.flatten()  threshold)\n\n    # 2. Count null modes for the given tau\n    n_pspg = np.sum(symbol_tau_given.flatten()  threshold)\n    \n    # 3. Compute condition number for tau=0\n    positive_symbols_0 = symbol_tau_0[symbol_tau_0 > threshold]\n    if len(positive_symbols_0) > 0:\n        kappa_0 = np.max(positive_symbols_0) / np.min(positive_symbols_0)\n    else: \n        kappa_0 = 1.0\n\n    # 4. Compute condition number for the given tau\n    positive_symbols_pspg = symbol_tau_given[symbol_tau_given > threshold]\n    if len(positive_symbols_pspg) > 0:\n        kappa_pspg = np.max(positive_symbols_pspg) / np.min(positive_symbols_pspg)\n    else:\n        kappa_pspg = 1.0\n        \n    # For case 4, tau=0, so the PSPG result is the same as the no-PSPG result.\n    if tau == 0.0:\n        n_pspg = n_0\n        kappa_pspg = kappa_0\n        \n    return [int(n_0), int(n_pspg), kappa_0, kappa_pspg]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}