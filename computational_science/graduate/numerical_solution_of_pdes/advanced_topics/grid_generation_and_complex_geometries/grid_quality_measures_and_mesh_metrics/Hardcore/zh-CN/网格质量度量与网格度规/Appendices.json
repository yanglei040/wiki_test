{
    "hands_on_practices": [
        {
            "introduction": "理论概念只有在能够量化时才真正有用。本练习将带领您亲手计算两个最基本的网格质量度量——正交性和偏斜度，帮助您深入理解这些指标是如何从网格单元的几何构型中直接推导出来的。通过这个基础计算，您将为分析和改进更复杂的网格打下坚实的基础。",
            "id": "3402357",
            "problem": "考虑一个标量场 $\\phi$ 的稳态扩散，其遵循守恒律 $\\nabla \\cdot \\left( \\Gamma \\nabla \\phi \\right) = 0$，其中 $\\Gamma$ 是一个正常数扩散系数。在单元中心的有限体积（FV）离散化中，穿过两个相邻控制体 $P$ 和 $N$ 共享的内面 $f$ 的扩散通量，是通过对面 $\\Gamma \\nabla \\phi \\cdot \\boldsymbol{n}_f$ 的面积分得到的，其中面面积矢量为 $\\boldsymbol{S}_f = \\boldsymbol{n}_f \\, |\\boldsymbol{S}_f|$。在非正交网格上，经典的两点近似可以通过将 $\\boldsymbol{S}_f$ 分解为平行和垂直于连接单元中心线的两个分量来理解，这直接引出了与正交性和偏斜度相关的网格质量度量。\n\n从以下基本依据出发：\n- 扩散通量定义、散度定理和点积，不假定任何特定的离散公式。\n- 对于任意矢量 $\\boldsymbol{a}$ 和单位矢量 $\\hat{\\boldsymbol{e}}$ 的矢量分解恒等式 $\\boldsymbol{a} = \\left( \\boldsymbol{a} \\cdot \\hat{\\boldsymbol{e}} \\right) \\hat{\\boldsymbol{e}} + \\left[ \\boldsymbol{a} - \\left( \\boldsymbol{a} \\cdot \\hat{\\boldsymbol{e}} \\right) \\hat{\\boldsymbol{e}} \\right]$。\n\n对于二维空间中的一个特定内面 $f$，给定：\n- 单元中心位置 $\\boldsymbol{x}_P = (0, 0)$ 和 $\\boldsymbol{x}_N = \\left(1, \\frac{1}{\\sqrt{3}}\\right)$。\n- 面单位法向量 $\\boldsymbol{n}_f = (1, 0)$ 和面面积大小 $|\\boldsymbol{S}_f| = 1$，所以 $\\boldsymbol{S}_f = (1, 0)$。\n- 面中心 $\\boldsymbol{x}_f = \\left(\\frac{1}{2}, \\frac{1}{10}\\right)$。\n- 令 $\\boldsymbol{d} = \\boldsymbol{x}_N - \\boldsymbol{x}_P$ 且 $\\hat{\\boldsymbol{d}} = \\boldsymbol{d} / |\\boldsymbol{d}|$。\n\n仅使用上述基本依据和所提供的几何信息，完成以下任务：\n1) 将面 $f$ 的正交性因子 $O$ 定义为 $\\boldsymbol{n}_f$ 和 $\\hat{\\boldsymbol{d}}$ 之间夹角的余弦，即 $O = \\left| \\boldsymbol{n}_f \\cdot \\hat{\\boldsymbol{d}} \\right|$，并根据数据推导出其值。\n2) 将偏斜矢量 $\\boldsymbol{s}$ 定义为从穿过 $\\boldsymbol{x}_P$ 和 $\\boldsymbol{x}_N$ 的直线与面的正交交点到实际面中心 $\\boldsymbol{x}_f$ 的矢量。精确地说，令 $\\boldsymbol{x}_I$ 为连接 $\\boldsymbol{x}_P$ 和 $\\boldsymbol{x}_N$ 的线段上具有与 $\\boldsymbol{x}_f$ 相同的面法向坐标的唯一点；则 $\\boldsymbol{s} = \\boldsymbol{x}_f - \\boldsymbol{x}_I$。定义归一化偏斜度度量 $K = \\frac{|\\boldsymbol{s}|}{|\\boldsymbol{d}|}$，并根据数据推导出其值。\n3) 结合这些结果构成无量纲网格质量指数\n$$\nM \\;=\\; \\frac{O^2}{\\,1 + K^2\\,}.\n$$\n使用步骤1-2的结果，从第一性原理计算 $M$。\n\n将 $M$ 的最终值报告为一个无量纲数，四舍五入到四位有效数字。最终答案中不要包含任何单位。",
            "solution": "首先根据提供的标准对问题进行验证。\n\n**第1步：提取已知条件**\n-   控制方程：$\\nabla \\cdot \\left( \\Gamma \\nabla \\phi \\right) = 0$。\n-   离散化方法：单元中心有限体积（FV）。\n-   单元中心位置：$\\boldsymbol{x}_P = (0, 0)$ 和 $\\boldsymbol{x}_N = \\left(1, \\frac{1}{\\sqrt{3}}\\right)$。\n-   面单位法向量：$\\boldsymbol{n}_f = (1, 0)$。\n-   面面积大小：$|\\boldsymbol{S}_f| = 1$。\n-   面面积矢量：$\\boldsymbol{S}_f = (1, 0)$。\n-   面中心：$\\boldsymbol{x}_f = \\left(\\frac{1}{2}, \\frac{1}{10}\\right)$。\n-   单元中心之间的矢量：$\\boldsymbol{d} = \\boldsymbol{x}_N - \\boldsymbol{x}_P$。\n-   沿 $\\boldsymbol{d}$ 的单位矢量：$\\hat{\\boldsymbol{d}} = \\boldsymbol{d} / |\\boldsymbol{d}|$。\n-   正交性因子：$O = \\left| \\boldsymbol{n}_f \\cdot \\hat{\\boldsymbol{d}} \\right|$。\n-   偏斜矢量：$\\boldsymbol{s} = \\boldsymbol{x}_f - \\boldsymbol{x}_I$，其中 $\\boldsymbol{x}_I$ 是线段 $\\overline{\\boldsymbol{x}_P \\boldsymbol{x}_N}$ 上的点，使得 $(\\boldsymbol{x}_I - \\boldsymbol{x}_f) \\cdot \\boldsymbol{n}_f = 0$。\n-   归一化偏斜度度量：$K = \\frac{|\\boldsymbol{s}|}{|\\boldsymbol{d}|}$。\n-   网格质量指数：$M = \\frac{O^2}{\\,1 + K^2\\,}$。\n\n**第2步：使用提取的已知条件进行验证**\n该问题在计算流体动力学和偏微分方程数值方法领域内定义良好。正交性和偏斜度的概念是标准的网格质量度量。所有需要的数据都已提供，待计算量（$O$、$K$、$M$）的定义在数学上是精确且无歧义的。该问题有科学依据、客观、完整且适定。没有矛盾或不切实际的假设。\n\n**第3步：结论与行动**\n该问题被认为是有效的。将提供完整的解答。\n\n**解答推导**\n\n解答过程按要求分为三部分：计算正交性因子 $O$，计算归一化偏斜度度量 $K$，最后计算网格质量指数 $M$。\n\n**1. 计算正交性因子 $O$**\n\n首先，我们确定连接单元中心 $\\boldsymbol{x}_P$ 和 $\\boldsymbol{x}_N$ 的矢量 $\\boldsymbol{d}$：\n$$\n\\boldsymbol{d} = \\boldsymbol{x}_N - \\boldsymbol{x}_P = \\left(1, \\frac{1}{\\sqrt{3}}\\right) - (0, 0) = \\left(1, \\frac{1}{\\sqrt{3}}\\right)\n$$\n接下来，我们计算 $\\boldsymbol{d}$ 的模长：\n$$\n|\\boldsymbol{d}| = \\sqrt{1^2 + \\left(\\frac{1}{\\sqrt{3}}\\right)^2} = \\sqrt{1 + \\frac{1}{3}} = \\sqrt{\\frac{4}{3}} = \\frac{2}{\\sqrt{3}}\n$$\n那么，沿 $\\boldsymbol{d}$ 方向的单位矢量 $\\hat{\\boldsymbol{d}}$ 是：\n$$\n\\hat{\\boldsymbol{d}} = \\frac{\\boldsymbol{d}}{|\\boldsymbol{d}|} = \\frac{\\left(1, \\frac{1}{\\sqrt{3}}\\right)}{\\frac{2}{\\sqrt{3}}} = \\frac{\\sqrt{3}}{2} \\left(1, \\frac{1}{\\sqrt{3}}\\right) = \\left(\\frac{\\sqrt{3}}{2}, \\frac{1}{2}\\right)\n$$\n正交性因子 $O$ 定义为面单位法向量 $\\boldsymbol{n}_f$ 和单位矢量 $\\hat{\\boldsymbol{d}}$ 的点积的绝对值：\n$$\nO = |\\boldsymbol{n}_f \\cdot \\hat{\\boldsymbol{d}}| = \\left| (1, 0) \\cdot \\left(\\frac{\\sqrt{3}}{2}, \\frac{1}{2}\\right) \\right| = \\left| 1 \\cdot \\frac{\\sqrt{3}}{2} + 0 \\cdot \\frac{1}{2} \\right| = \\frac{\\sqrt{3}}{2}\n$$\n\n**2. 计算归一化偏斜度度量 $K$**\n\n点 $\\boldsymbol{x}_I$ 位于穿过 $\\boldsymbol{x}_P$ 和 $\\boldsymbol{x}_N$ 的直线上。该直线上的任意点可以参数化为 $\\boldsymbol{x}(t) = \\boldsymbol{x}_P + t(\\boldsymbol{x}_N - \\boldsymbol{x}_P) = t \\boldsymbol{d}$，其中 $t$ 为标量参数。因此，对于某个特定的值 $t_I$，有 $\\boldsymbol{x}_I = t_I \\boldsymbol{d}$。\n\n$\\boldsymbol{x}_I$ 的定义条件是它具有与面中心 $\\boldsymbol{x}_f$ 相同的面法向坐标。在数学上，这表示为 $\\boldsymbol{x}_I \\cdot \\boldsymbol{n}_f = \\boldsymbol{x}_f \\cdot \\boldsymbol{n}_f$。我们代入 $\\boldsymbol{x}_I$ 的表达式和给定的矢量：\n$$\n(t_I \\boldsymbol{d}) \\cdot \\boldsymbol{n}_f = \\boldsymbol{x}_f \\cdot \\boldsymbol{n}_f\n$$\n$$\nt_I (\\boldsymbol{d} \\cdot \\boldsymbol{n}_f) = \\boldsymbol{x}_f \\cdot \\boldsymbol{n}_f\n$$\n我们计算所需的点积：\n$$\n\\boldsymbol{d} \\cdot \\boldsymbol{n}_f = \\left(1, \\frac{1}{\\sqrt{3}}\\right) \\cdot (1, 0) = 1\n$$\n$$\n\\boldsymbol{x}_f \\cdot \\boldsymbol{n}_f = \\left(\\frac{1}{2}, \\frac{1}{10}\\right) \\cdot (1, 0) = \\frac{1}{2}\n$$\n将这些值代回关于 $t_I$ 的方程中：\n$$\nt_I (1) = \\frac{1}{2} \\implies t_I = \\frac{1}{2}\n$$\n由于 $t_I = \\frac{1}{2}$ 介于 0 和 1 之间，点 $\\boldsymbol{x}_I$ 按要求位于线段 $\\overline{\\boldsymbol{x}_P \\boldsymbol{x}_N}$ 上。现在我们求 $\\boldsymbol{x}_I$ 的坐标：\n$$\n\\boldsymbol{x}_I = \\frac{1}{2} \\boldsymbol{d} = \\frac{1}{2} \\left(1, \\frac{1}{\\sqrt{3}}\\right) = \\left(\\frac{1}{2}, \\frac{1}{2\\sqrt{3}}\\right)\n$$\n偏斜矢量 $\\boldsymbol{s}$ 是面中心 $\\boldsymbol{x}_f$ 和交点 $\\boldsymbol{x}_I$ 之间的差：\n$$\n\\boldsymbol{s} = \\boldsymbol{x}_f - \\boldsymbol{x}_I = \\left(\\frac{1}{2}, \\frac{1}{10}\\right) - \\left(\\frac{1}{2}, \\frac{1}{2\\sqrt{3}}\\right) = \\left(0, \\frac{1}{10} - \\frac{1}{2\\sqrt{3}}\\right)\n$$\n偏斜矢量的模长是：\n$$\n|\\boldsymbol{s}| = \\left| \\frac{1}{10} - \\frac{1}{2\\sqrt{3}} \\right| = \\left| \\frac{\\sqrt{3} - 5}{10\\sqrt{3}} \\right|\n$$\n由于 $\\sqrt{3} \\approx 1.732  5$，绝对值内的项为负。因此：\n$$\n|\\boldsymbol{s}| = \\frac{5 - \\sqrt{3}}{10\\sqrt{3}} = \\frac{\\sqrt{3}(5 - \\sqrt{3})}{10 \\cdot 3} = \\frac{5\\sqrt{3} - 3}{30}\n$$\n归一化偏斜度度量 $K$ 是 $|\\boldsymbol{s}|$ 与 $|\\boldsymbol{d}|$ 的比值：\n$$\nK = \\frac{|\\boldsymbol{s}|}{|\\boldsymbol{d}|} = \\frac{\\frac{5\\sqrt{3} - 3}{30}}{\\frac{2}{\\sqrt{3}}} = \\frac{(5\\sqrt{3} - 3)\\sqrt{3}}{30 \\cdot 2} = \\frac{5 \\cdot 3 - 3\\sqrt{3}}{60} = \\frac{15 - 3\\sqrt{3}}{60} = \\frac{5 - \\sqrt{3}}{20}\n$$\n\n**3. 计算网格质量指数 $M$**\n\n网格质量指数 $M$ 由公式 $M = \\frac{O^2}{1 + K^2}$ 给出。\n我们有 $O = \\frac{\\sqrt{3}}{2}$，所以 $O^2 = \\left(\\frac{\\sqrt{3}}{2}\\right)^2 = \\frac{3}{4}$。\n我们有 $K = \\frac{5 - \\sqrt{3}}{20}$，所以 $K^2$ 是：\n$$\nK^2 = \\left(\\frac{5 - \\sqrt{3}}{20}\\right)^2 = \\frac{5^2 - 2(5)\\sqrt{3} + (\\sqrt{3})^2}{20^2} = \\frac{25 - 10\\sqrt{3} + 3}{400} = \\frac{28 - 10\\sqrt{3}}{400} = \\frac{14 - 5\\sqrt{3}}{200}\n$$\n现在我们计算 $1 + K^2$：\n$$\n1 + K^2 = 1 + \\frac{14 - 5\\sqrt{3}}{200} = \\frac{200 + 14 - 5\\sqrt{3}}{200} = \\frac{214 - 5\\sqrt{3}}{200}\n$$\n最后，我们将这些表达式代入 $M$ 的公式中：\n$$\nM = \\frac{O^2}{1 + K^2} = \\frac{\\frac{3}{4}}{\\frac{214 - 5\\sqrt{3}}{200}} = \\frac{3}{4} \\cdot \\frac{200}{214 - 5\\sqrt{3}} = \\frac{3 \\cdot 50}{214 - 5\\sqrt{3}} = \\frac{150}{214 - 5\\sqrt{3}}\n$$\n为了获得最终的数值，我们使用近似值 $\\sqrt{3} \\approx 1.73205$：\n$$\nM \\approx \\frac{150}{214 - 5(1.73205)} = \\frac{150}{214 - 8.66025} = \\frac{150}{205.33975} \\approx 0.730504\n$$\n四舍五入到四位有效数字，我们得到 $M = 0.7305$。",
            "answer": "$$\n\\boxed{0.7305}\n$$"
        },
        {
            "introduction": "优秀的网格不仅质量高，而且计算效率也高。本练习将探讨在自适应网格剖分中，如何在插值误差（质量）和单元数量（成本）之间进行权衡。您将通过最小化一个复合目标函数，推导出最优的网格各向异性比率，从而掌握在计算资源有限的情况下设计高效网格的核心思想。",
            "id": "3402345",
            "problem": "考虑一个矩形域 $\\Omega \\subset \\mathbb{R}^{2}$ 上的标量场 $u(x,y)$，其边长为 $L_{x}  0$ 和 $L_{y}  0$，其中 $u$ 是一个二阶椭圆偏微分方程 (PDE) 的解。假设 $u$ 的黑塞矩阵在空间上是常数，并且在坐标基中是对角的，即 $\\nabla^{2} u = \\operatorname{diag}(\\alpha, \\beta)$，其中 $\\alpha  0$ 且 $\\beta  0$。你将设计一个结构化的、轴对齐的矩形网格，在 $x$ 方向有 $n_{x}$ 个子划分，在 $y$ 方向有 $n_{y}$ 个子划分。单元边长为 $h_{x} = L_{x}/n_{x}$ 和 $h_{y} = L_{y}/n_{y}$，总单元数为 $N = n_{x} n_{y} = A/(h_{x} h_{y})$，其中 $A = L_{x} L_{y}$ 是域的面积。\n\n作为网格质量的度量，考虑在轴对齐矩形上的分片线性有限元的领先阶插值误差代理，该代理从具有常数黑塞矩阵的 $u$ 的泰勒余项获得。该代理具有以下形式\n$$\nE(h_{x}, h_{y}) = c \\, A \\left(\\alpha \\, h_{x}^{2} + \\beta \\, h_{y}^{2}\\right),\n$$\n其中 $c  0$ 是一个仅取决于范数选择和参考单元缩放的常数。作为计算成本模型，考虑单元数量，\n$$\nC(h_{x}, h_{y}) = N = \\frac{A}{h_{x} h_{y}}.\n$$\n为了阐明自适应网格划分中的质量-成本权衡，定义复合目标\n$$\nJ(h_{x}, h_{y}) = E(h_{x}, h_{y}) + \\mu \\, C(h_{x}, h_{y}) = c \\, A \\left(\\alpha \\, h_{x}^{2} + \\beta \\, h_{y}^{2}\\right) + \\mu \\, \\frac{A}{h_{x} h_{y}},\n$$\n其中 $\\mu  0$ 是一个固定参数，表示每个单元的计算成本，其单位与 $E$ 一致。\n\n从矩形上插值误差的泰勒余项表征、结构化网格上离散单元尺寸与单元数量之间的关系以及上述复合目标的定义出发，推导最优各向异性比\n$$\nr^{\\star} = \\frac{h_{y}}{h_{x}},\n$$\n该比率在 $h_{x}  0$ 和 $h_{y}  0$ 上最小化 $J(h_{x}, h_{y})$。将你的最终答案表示为仅含 $\\alpha$ 和 $\\beta$ 的闭式解析表达式。不需要进行数值四舍五入。提供 $r^{\\star}$ 的公式作为最终答案，不带单位。",
            "solution": "目标是关于单元边长 $h_{x}  0$ 和 $h_{y}  0$ 最小化复合目标函数 $J(h_{x}, h_{y})$。目标函数为\n$$\nJ(h_{x}, h_{y}) = c \\, A \\left(\\alpha \\, h_{x}^{2} + \\beta \\, h_{y}^{2}\\right) + \\mu \\, \\frac{A}{h_{x} h_{y}}。\n$$\n为了找到最小值，我们计算 $J$ 关于 $h_{x}$ 和 $h_{y}$ 的偏导数，并令它们为零。这给出了最小值的的一阶必要条件。偏导数是：\n$$\n\\frac{\\partial J}{\\partial h_{x}} = c \\, A (2 \\alpha h_{x}) - \\mu \\frac{A}{h_{x}^{2} h_{y}}\n$$\n$$\n\\frac{\\partial J}{\\partial h_{y}} = c \\, A (2 \\beta h_{y}) - \\mu \\frac{A}{h_{x} h_{y}^{2}}\n$$\n将两个偏导数都设为零，我们得到以下方程组：\n$$\nc \\, A (2 \\alpha h_{x}) = \\mu \\frac{A}{h_{x}^{2} h_{y}}\n$$\n$$\nc \\, A (2 \\beta h_{y}) = \\mu \\frac{A}{h_{x} h_{y}^{2}}\n$$\n我们可以从两个方程中消去公因子 $A$ (因为 $A0$)：\n$$\n2 c \\alpha h_{x} = \\frac{\\mu}{h_{x}^{2} h_{y}} \\quad \\implies \\quad \\mu = 2 c \\alpha h_{x}^{3} h_{y}\n$$\n$$\n2 c \\beta h_{y} = \\frac{\\mu}{h_{x} h_{y}^{2}} \\quad \\implies \\quad \\mu = 2 c \\beta h_{x} h_{y}^{3}\n$$\n由于右侧的两个表达式都等于 $\\mu$，它们必然彼此相等：\n$$\n2 c \\alpha h_{x}^{3} h_{y} = 2 c \\beta h_{x} h_{y}^{3}\n$$\n我们可以消去公因子 $2c$、$h_{x}$ 和 $h_{y}$ (因为 $c0, h_x0, h_y0$)：\n$$\n\\alpha h_{x}^{2} = \\beta h_{y}^{2}\n$$\n现在，我们可以求解各向异性比 $r = h_{y}/h_{x}$。重新整理方程得到：\n$$\n\\frac{h_{y}^{2}}{h_{x}^{2}} = \\frac{\\alpha}{\\beta}\n$$\n$$\n\\left(\\frac{h_{y}}{h_{x}}\\right)^{2} = \\frac{\\alpha}{\\beta}\n$$\n对两边取平方根（并且由于 $h_x, h_y  0$，它们的比率 $r$ 必须为正）得到最优比率：\n$$\nr^{\\star} = \\frac{h_{y}}{h_{x}} = \\sqrt{\\frac{\\alpha}{\\beta}}\n$$\n为了确认这是一个最小值，可以进行二阶导数检验。在此临界点，$J$ 的黑塞矩阵必须是正定的。考虑到问题的结构（对于 $h_x, h_y  0$，误差项和成本项是凸的），该临界点对应于全局最小值。最终答案仅取决于 $\\alpha$ 和 $\\beta$，符合题目要求。",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{\\alpha}{\\beta}}}\n$$"
        },
        {
            "introduction": "网格质量差究竟会对数值解产生什么影响？本练习提供了一个具体的计算实验来回答这个问题，重点关注对流主导问题中的伪振荡现象。您将通过编写代码来检验一个核心假设：将网格边缘与解的梯度方向对齐可以有效抑制数值误差，从而直观地感受网格度量与求解精度之间的深刻联系。",
            "id": "3402349",
            "problem": "要求您设计并实现一个数值实验，以检验在对流主导问题中，将网格边与梯度方向对齐可以减少伪振荡的假设。考虑在具有周期性边界的单位正方形域上的二维线性平流偏微分方程 (PDE)：\n$$\n\\frac{\\partial u}{\\partial t} + \\boldsymbol{a}\\cdot\\nabla u = 0,\n$$\n其中 $u=u(x,y,t)$，$\\boldsymbol{a}=(a_x,a_y)$ 是一个恒定的平流速度，$\\nabla u$ 是 $u$ 的空间梯度。初始数据是一个沿着单位方向向量 $\\boldsymbol{n}=(\\cos\\alpha,\\sin\\alpha)$ 对齐的不连续亥维赛阶跃：\n$$\nu(x,y,0) = \\begin{cases}\n1,  \\text{if } x\\cos\\alpha + y\\sin\\alpha \\ge 0.5, \\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\n该实验在 $[0,1]\\times[0,1]$ 上使用一个具有 $N_x=N_y$ 个点的均匀笛卡尔网格，并采用周期性边界条件。使用单个带有中心差分的前向欧拉时间步将解从 $t=0$ 推进到 $t=\\Delta t$：\n$$\nu^{1}_{i,j} = u^{0}_{i,j} - \\Delta t\\left( a_x \\frac{u^{0}_{i,j+1}-u^{0}_{i,j-1}}{2\\Delta x} + a_y \\frac{u^{0}_{i+1,j}-u^{0}_{i-1,j}}{2\\Delta y} \\right),\n$$\n其中 $(i,j)$ 为网格节点的索引，$\\Delta x = 1/N_x$，且 $\\Delta y = 1/N_y$。通过取 $\\boldsymbol{a} = \\boldsymbol{n} = (\\cos\\alpha,\\sin\\alpha)$ 和单位速率 $\\|\\boldsymbol{a}\\|=1$，将平流速度设置为与初始数据的梯度方向对齐。角度必须以弧度表示。\n\n定义点 $x$ 处的未对齐度量为 $\\nabla u$ 与最近的网格边方向之间的锐角。由于初始条件具有恒定的梯度方向 $\\boldsymbol{n}$，这简化为一个全局未对齐标量\n$$\n\\phi = \\min\\left\\{|\\alpha-0|,\\left|\\frac{\\pi}{2}-\\alpha\\right|\\right\\},\n$$\n即 $\\boldsymbol{n}$ 与最近的坐标轴方向之间的锐角。定义网格函数 $U_{i,j}$ 的二维离散全变分为\n$$\n\\mathrm{TV}(U) = \\sum_{i,j}\\left( \\left|U_{i,j+1} - U_{i,j}\\right| + \\left|U_{i+1,j} - U_{i,j}\\right| \\right),\n$$\n使用周期性索引。从 $u^0$ 推进一个时间步到 $u^1$ 后，计算全变分的相对变化\n$$\n\\Delta \\mathrm{TV} = \\frac{\\mathrm{TV}(u^1)-\\mathrm{TV}(u^0)}{\\mathrm{TV}(u^0)}.\n$$\n为本实验之目的，我们称该格式在此单步上表现出全变分递减 (TVD) 行为，当且仅当 $\\mathrm{TV}(u^1)\\le \\mathrm{TV}(u^0)$ 并且 $u^1$ 在网格上处处保持在 $[0,1]$ 界限内。\n\n您的任务是实现上述过程，并针对一组测试角度，计算未对齐度量 $\\phi$、全变分的相对变化 $\\Delta \\mathrm{TV}$ 以及布尔型 TVD 标志。此外，计算测试套件中未对齐度量值列表 $\\{\\phi_k\\}$ 与相应的全变分相对变化列表 $\\{\\Delta \\mathrm{TV}_k\\}$ 之间的皮尔逊相关系数。\n\n所有测试案例均使用以下参数值：\n- 网格尺寸：$N_x=N_y=200$，因此 $\\Delta x=\\Delta y=1/200$。\n- 时间步长：$\\Delta t = 0.4\\,\\Delta x$。\n- 平流速度：$\\boldsymbol{a} = (\\cos\\alpha,\\sin\\alpha)$，单位模长。\n- 边界条件：在 $[0,1]\\times[0,1]$ 上为周期性。\n\n测试套件包含以下角度（以弧度为单位）：\n- 案例 1: $\\alpha = 0$。\n- 案例 2: $\\alpha = \\pi/8$。\n- 案例 3: $\\alpha = \\pi/4$。\n- 案例 4: $\\alpha = 3\\pi/8$。\n- 案例 5: $\\alpha = \\pi/2$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序如下：\n$$\n[\\rho, \\phi_1, \\Delta \\mathrm{TV}_1, \\text{TVD}_1, \\phi_2, \\Delta \\mathrm{TV}_2, \\text{TVD}_2, \\phi_3, \\Delta \\mathrm{TV}_3, \\text{TVD}_3, \\phi_4, \\Delta \\mathrm{TV}_4, \\text{TVD}_4, \\phi_5, \\Delta \\mathrm{TV}_5, \\text{TVD}_5],\n$$\n其中 $\\rho$ 是 $\\{\\phi_k\\}$ 和 $\\{\\Delta \\mathrm{TV}_k\\}$ 之间的皮尔逊相关系数，每个 $\\phi_k$ 和 $\\Delta \\mathrm{TV}_k$ 是浮点数，每个 $\\text{TVD}_k$ 是布尔值。角度必须以弧度报告。不得打印任何其他文本。输出使用所选编程语言中浮点数和布尔值的默认字符串表示。",
            "solution": "问题陈述已经过验证，被认为是一个适定且有科学依据的数值实验。它是自包含的，所有必要的参数、方程和度量都有明确定义。其目标是研究在求解线性平流方程时，计算网格与解的梯度的对齐情况与伪振荡的产生之间的关系。\n\n该数值实验的方法如下：\n\n1.  **域和初始条件的离散化**：将连续域 $[0,1]\\times[0,1]$ 离散化为一个大小为 $N_x \\times N_y$ 的均匀笛卡尔网格，其中 $N_x = N_y = 200$。网格点 $(x_j, y_i)$ 由 $x_j=j\\Delta x$ 和 $y_i=i\\Delta y$ 给出，其中 $i,j \\in \\{0, 1, ..., N-1\\}$，$N=200$ 且 $\\Delta x = \\Delta y = 1/N$。初始条件是由下式定义的亥维赛阶跃函数\n    $$\n    u(x,y,0) = u^0(x,y) = \\begin{cases} 1,  \\text{if } x\\cos\\alpha + y\\sin\\alpha \\ge 0.5 \\\\ 0,  \\text{otherwise}. \\end{cases}\n    $$\n    此初始条件的梯度垂直于不连续线 $x\\cos\\alpha+y\\sin\\alpha=0.5$，因此具有由向量 $\\boldsymbol{n} = (\\cos\\alpha, \\sin\\alpha)$ 给出的恒定方向。在每个网格点 $(x_j, y_i)$ 上评估此初始条件，以生成离散初始数据数组 $u^0_{i,j}$。\n\n2.  **数值时间演化**：使用前向欧拉方法进行时间积分和二阶中心差分格式进行空间求导，将解从时间 $t=0$ 推进到 $t=\\Delta t$。这被称为前向时间中心空间 (FTCS) 格式。更新公式明确给出为\n    $$\n    u^{1}_{i,j} = u^{0}_{i,j} - \\Delta t\\left( a_x \\frac{u^{0}_{i,j+1}-u^{0}_{i,j-1}}{2\\Delta x} + a_y \\frac{u^{0}_{i+1,j}-u^{0}_{i-1,j}}{2\\Delta y} \\right).\n    $$\n    平流速度 $\\boldsymbol{a}=(a_x, a_y)$ 被选择为与初始梯度对齐，因此 $\\boldsymbol{a}=\\boldsymbol{n}=(\\cos\\alpha, \\sin\\alpha)$。强制施加周期性边界条件，这意味着索引按模 $N$ 处理。例如，$u^0_{i,N}$ 与 $u^0_{i,0}$ 等同，$u^0_{N,j}$ 与 $u^0_{0,j}$ 等同。这在计算上通过对数据数组使用循环移位操作来实现。\n\n3.  **未对齐度和数值误差的量化**：\n    *   **未对齐度量 ($\\phi$)**：解的梯度（具有恒定方向 $\\boldsymbol{n}$）与笛卡尔网格之间的未对齐程度，通过 $\\boldsymbol{n}$ 与最近的坐标轴（$\\boldsymbol{e}_x=(1,0)$ 或 $\\boldsymbol{e}_y=(0,1)$）之间的锐角 $\\phi$ 来量化。对于给定的角度 $\\alpha \\in [0, \\pi/2]$，其计算公式为 $\\phi = \\min\\left\\{|\\alpha|,\\left|\\frac{\\pi}{2}-\\alpha\\right|\\right\\}$。$\\phi=0$ 的值表示完全对齐，而 $\\phi=\\pi/4$ 表示最大未对齐。\n    *   **全变分 (TV)**：通过测量数值解全变分的变化来量化伪振荡。网格函数 $U_{i,j}$ 的离散全变分定义为\n      $$\n      \\mathrm{TV}(U) = \\sum_{i,j}\\left( \\left|U_{i,j+1} - U_{i,j}\\right| + \\left|U_{i+1,j} - U_{i,j}\\right| \\right).\n      $$\n      一个理想的、用于标量平流的非振荡格式应是全变分递减 (TVD) 的，即 $\\mathrm{TV}(u^{n+1}) \\le \\mathrm{TV}(u^n)$。所选的 FTCS 格式不是 TVD 的，预计会产生非物理振荡，这将增加全变分。\n    *   **TV 的相对变化 ($\\Delta \\mathrm{TV}$)**: TV 的变化通过初始 TV 进行归一化，以提供一个时间步内产生的误差的相对度量：\n      $$\n      \\Delta \\mathrm{TV} = \\frac{\\mathrm{TV}(u^1)-\\mathrm{TV}(u^0)}{\\mathrm{TV}(u^0)}.\n      $$\n      $\\Delta \\mathrm{TV}$ 的正值表示产生了新的振荡。\n    *   **TVD 标志**：计算一个布尔标志以检查该格式在此单步中是否表现出 TVD 行为。这需要满足两个条件：首先，全变分不得增加 ($\\mathrm{TV}(u^1)\\le \\mathrm{TV}(u^0)$)；其次，不得产生新的极值（即，$u^1$ 必须保持在初始最小值和最大值 $[0,1]$ 的界限内）。\n\n4.  **假设检验**：针对一系列角度 $\\alpha_k$ 执行该实验。对每个角度，计算出数据对 $(\\phi_k, \\Delta \\mathrm{TV}_k)$。“增加的未对齐度导致更显著的振荡”这一假设意味着 $\\phi_k$ 和 $\\Delta \\mathrm{TV}_k$ 之间存在正相关。通过计算未对齐度量值集合 $\\{\\phi_k\\}$ 和相应的 TV 相对变化集合 $\\{\\Delta \\mathrm{TV}_k\\}$ 之间的皮尔逊相关系数 $\\rho$ 来量化此相关性。在此特定数值实验的背景下，一个接近 $+1$ 的 $\\rho$ 值将强有力地支持该假设。\n\n提供的最终代码为每个指定角度实现了此过程，收集了结果度量，计算了相关系数，并按要求格式化了结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the numerical experiment to test the effect of mesh alignment\n    on spurious oscillations for the 2D linear advection equation.\n    \"\"\"\n    # Define parameters from the problem statement.\n    N = 200\n    dx = 1.0 / N\n    dy = 1.0 / N  # N_x = N_y, so dx = dy\n    dt = 0.4 * dx\n\n    # Define the test cases (angles in radians) from the problem statement.\n    test_cases = [\n        0.0,\n        np.pi / 8.0,\n        np.pi / 4.0,\n        3.0 * np.pi / 8.0,\n        np.pi / 2.0,\n    ]\n\n    # Pre-compute the grid coordinates\n    x_coords = np.arange(N) * dx\n    y_coords = np.arange(N) * dy\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='xy')\n\n    def calculate_total_variation(U):\n        \"\"\"Computes the 2D discrete total variation with periodic boundaries.\"\"\"\n        # Sum of absolute differences in x-direction (along axis 1)\n        tv_x = np.sum(np.abs(np.roll(U, -1, axis=1) - U))\n        # Sum of absolute differences in y-direction (along axis 0)\n        tv_y = np.sum(np.abs(np.roll(U, -1, axis=0) - U))\n        return tv_x + tv_y\n\n    # Lists to store results for all cases\n    case_results = []\n    phi_values = []\n    delta_tv_values = []\n\n    for alpha in test_cases:\n        # Main logic to calculate the result for one case goes here.\n\n        # 1. Define initial condition u^0 based on angle alpha\n        ax, ay = np.cos(alpha), np.sin(alpha)\n        projection = xx * ax + yy * ay\n        u0 = np.zeros_like(xx, dtype=float)\n        u0[projection >= 0.5] = 1.0\n\n        # 2. Calculate Total Variation of the initial condition\n        tv0 = calculate_total_variation(u0)\n\n        # 3. Advance one time step using Forward Euler and Centered Differences\n        # Spatial derivative in x (using np.roll for periodic boundaries)\n        du0_dx = (np.roll(u0, -1, axis=1) - np.roll(u0, 1, axis=1)) / (2 * dx)\n        # Spatial derivative in y\n        du0_dy = (np.roll(u0, -1, axis=0) - np.roll(u0, 1, axis=0)) / (2 * dy)\n        \n        # Advection velocity a is (ax, ay)\n        u1 = u0 - dt * (ax * du0_dx + ay * du0_dy)\n\n        # 4. Compute metrics for the current case\n        # Total Variation of the new state u^1\n        tv1 = calculate_total_variation(u1)\n        \n        # Misalignment metric phi\n        phi = min(abs(alpha - 0.0), abs(np.pi / 2.0 - alpha))\n        \n        # Fractional change in Total Variation\n        delta_tv = (tv1 - tv0) / tv0 if tv0 != 0 else 0.0\n\n        # TVD flag\n        is_bounded = np.all((u1 >= 0.0)  (u1 = 1.0))\n        is_diminishing = tv1 = tv0\n        tvd_flag = is_bounded and is_diminishing\n\n        # Append individual results for this case to be part of the final output\n        case_results.extend([phi, delta_tv, tvd_flag])\n        \n        # Collect values separately for correlation calculation\n        phi_values.append(phi)\n        delta_tv_values.append(delta_tv)\n\n    # 5. Compute the Pearson correlation coefficient rho\n    # np.corrcoef returns the correlation matrix. The value at [0, 1] is rho(X, Y).\n    if len(phi_values) > 1:\n        rho = np.corrcoef(phi_values, delta_tv_values)[0, 1]\n    else:\n        # Correlation is undefined for a single data point.\n        rho = 0.0\n\n    # 6. Assemble the final list in the specified order\n    results = [rho] + case_results\n\n    # Final print statement in the exact required format.\n    # The default string representation of floats and booleans is used as requested.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}