{
    "hands_on_practices": [
        {
            "introduction": "Our exploration begins with the fundamental building blocks of an isoparametric element. This first practice focuses on constructing a 9-node biquadratic ($Q_2$) quadrilateral element, a cornerstone of many finite element simulations. By deriving the Lagrange basis functions and applying the isoparametric principle, you will compute the Jacobian of the mapping, a crucial quantity that links the physical and reference domains. This foundational exercise  reinforces the core mechanics of how complex, curved geometries are represented using simple polynomial functions.",
            "id": "3411570",
            "problem": "Consider the Finite Element Method (FEM) for solving Partial Differential Equations (PDEs) on quadrilateral elements using an isoparametric quadratic mapping. The reference element is the square $[-1,1]^2$ with local coordinates $(\\xi,\\eta)$. The quadratic Lagrange ($Q_2$) interpolation is defined on the tensor-product grid with nodes at $(\\xi,\\eta)\\in\\{-1,0,1\\}\\times\\{-1,0,1\\}$. Using the fundamental definition of Lagrange interpolation polynomials on a uniform grid, derive the one-dimensional quadratic Lagrange basis functions on $[-1,1]$ associated with the nodes $\\xi=-1$, $\\xi=0$, and $\\xi=1$. Then, form the two-dimensional $Q_2$ basis functions on $[-1,1]^2$ as tensor products of the one-dimensional polynomials. List the nine basis functions $\\{N_i(\\xi,\\eta)\\}_{i=1}^9$ associated with the nodes ordered as follows:\n$1:(-1,-1)$, $2:(0,-1)$, $3:(1,-1)$, $4:(1,0)$, $5:(1,1)$, $6:(0,1)$, $7:(-1,1)$, $8:(-1,0)$, $9:(0,0)$.\n\nUsing the isoparametric mapping principle, write the quadratic geometric mapping\n$$x(\\xi,\\eta)=\\sum_{i=1}^{9}N_i(\\xi,\\eta)\\,x_i,\\qquad y(\\xi,\\eta)=\\sum_{i=1}^{9}N_i(\\xi,\\eta)\\,y_i,$$\nwhere $(x_i,y_i)$ are the physical coordinates of the mapped nodes. Consider the following physical nodal coordinates:\n$$(x_1,y_1)=(0,0),\\quad (x_2,y_2)=(1,-0.1),\\quad (x_3,y_3)=(2,0),$$\n$$(x_4,y_4)=(2.1,0.5),\\quad (x_5,y_5)=(2,1),\\quad (x_6,y_6)=(1,1.05),$$\n$$(x_7,y_7)=(0,1),\\quad (x_8,y_8)=(-0.1,0.5),\\quad (x_9,y_9)=(1,0.5).$$\n\nCompute the determinant of the Jacobian of the mapping at the element center $(\\xi,\\eta)=(0,0)$,\n$$J(0,0)=\\det\\left(\\begin{pmatrix}\\dfrac{\\partial x}{\\partial \\xi}  \\dfrac{\\partial x}{\\partial \\eta} \\\\ \\dfrac{\\partial y}{\\partial \\xi}  \\dfrac{\\partial y}{\\partial \\eta}\\end{pmatrix}\\Bigg|_{(\\xi,\\eta)=(0,0)}\\right),$$\nand provide its value rounded to four significant figures. Express the final answer as a pure number without units.",
            "solution": "First, we derive the one-dimensional quadratic Lagrange basis functions, denoted as $L_k(\\xi)$, on the interval $[-1,1]$ for the nodes $\\xi_j \\in \\{-1, 0, 1\\}$. These basis functions must satisfy the property $L_k(\\xi_j) = \\delta_{kj}$, where $\\delta_{kj}$ is the Kronecker delta.\nThe basis function for the node at $\\xi=-1$, which we denote $L_{-1}(\\xi)$, must be zero at $\\xi=0$ and $\\xi=1$. It can be constructed as:\n$$L_{-1}(\\xi) = \\frac{(\\xi-0)(\\xi-1)}{(-1-0)(-1-1)} = \\frac{\\xi(\\xi-1)}{2} = \\frac{1}{2}(\\xi^2-\\xi)$$\nThe basis function for the node at $\\xi=0$, denoted $L_0(\\xi)$, must be zero at $\\xi=-1$ and $\\xi=1$:\n$$L_0(\\xi) = \\frac{(\\xi-(-1))(\\xi-1)}{(0-(-1))(0-1)} = \\frac{(\\xi+1)(\\xi-1)}{-1} = 1-\\xi^2$$\nThe basis function for the node at $\\xi=1$, denoted $L_1(\\xi)$, must be zero at $\\xi=-1$ and $\\xi=0$:\n$$L_1(\\xi) = \\frac{(\\xi-(-1))(\\xi-0)}{(1-(-1))(1-0)} = \\frac{\\xi(\\xi+1)}{2} = \\frac{1}{2}(\\xi^2+\\xi)$$\n\nThe two-dimensional $Q_2$ basis functions, $N_i(\\xi, \\eta)$, are formed by the tensor product of the one-dimensional basis functions. For a node $i$ with local coordinates $(\\xi_k, \\eta_l)$, where $\\xi_k, \\eta_l \\in \\{-1, 0, 1\\}$, the basis function is $N_i(\\xi, \\eta) = L_k(\\xi) L_l(\\eta)$.\n\nThe isoparametric mapping from the reference coordinates $(\\xi, \\eta)$ to the physical coordinates $(x, y)$ is given by:\n$$x(\\xi,\\eta)=\\sum_{i=1}^{9}N_i(\\xi,\\eta)x_i, \\quad y(\\xi,\\eta)=\\sum_{i=1}^{9}N_i(\\xi,\\eta)y_i$$\nThe Jacobian matrix of this mapping is:\n$$J(\\xi, \\eta) = \\begin{pmatrix} \\dfrac{\\partial x}{\\partial \\xi}  \\dfrac{\\partial x}{\\partial \\eta} \\\\ \\dfrac{\\partial y}{\\partial \\xi}  \\dfrac{\\partial y}{\\partial \\eta} \\end{pmatrix}$$\nThe entries of the Jacobian matrix are computed as:\n$$ \\frac{\\partial x}{\\partial \\xi} = \\sum_{i=1}^{9} \\frac{\\partial N_i}{\\partial \\xi} x_i, \\quad \\frac{\\partial x}{\\partial \\eta} = \\sum_{i=1}^{9} \\frac{\\partial N_i}{\\partial \\eta} x_i $$\n$$ \\frac{\\partial y}{\\partial \\xi} = \\sum_{i=1}^{9} \\frac{\\partial N_i}{\\partial \\xi} y_i, \\quad \\frac{\\partial y}{\\partial \\eta} = \\sum_{i=1}^{9} \\frac{\\partial N_i}{\\partial \\eta} y_i $$\nWe need to evaluate these derivatives at the center of the element, $(\\xi, \\eta) = (0, 0)$. This requires the derivatives of the basis functions at $(0,0)$.\n\nFirst, let's evaluate the 1D basis functions and their derivatives at $\\xi=0$:\n$L_{-1}(0) = 0, \\quad L_0(0) = 1, \\quad L_1(0) = 0$.\n$\\frac{d L_{-1}}{d\\xi}|_{\\xi=0} = (\\xi-\\frac{1}{2})|_{\\xi=0} = -\\frac{1}{2}$\n$\\frac{d L_0}{d\\xi}|_{\\xi=0} = (-2\\xi)|_{\\xi=0} = 0$\n$\\frac{d L_1}{d\\xi}|_{\\xi=0} = (\\xi+\\frac{1}{2})|_{\\xi=0} = \\frac{1}{2}$\nDue to symmetry, the same values hold for the derivatives with respect to $\\eta$ at $\\eta=0$.\n\nThe partial derivative of a 2D basis function $N_i(\\xi, \\eta) = L_k(\\xi) L_l(\\eta)$ with respect to $\\xi$ at $(0,0)$ is:\n$$\\frac{\\partial N_i}{\\partial \\xi}(0,0) = \\frac{dL_k}{d\\xi}(0) L_l(0)$$\nThis expression is non-zero only if $L_l(0) \\neq 0$ (which implies $l=0$) and $\\frac{dL_k}{d\\xi}(0) \\neq 0$ (which implies $k=\\pm 1$).\nThe nodes corresponding to these conditions are $(\\xi,\\eta)=(-1,0)$ (node $8$) and $(\\xi,\\eta)=(1,0)$ (node $4$).\nFor node $8$, $(\\xi_k,\\eta_l)=(-1,0)$: $\\frac{\\partial N_8}{\\partial \\xi}(0,0) = \\frac{dL_{-1}}{d\\xi}(0)L_0(0) = (-\\frac{1}{2})(1) = -\\frac{1}{2}$.\nFor node $4$, $(\\xi_k,\\eta_l)=(1,0)$: $\\frac{\\partial N_4}{\\partial \\xi}(0,0) = \\frac{dL_1}{d\\xi}(0)L_0(0) = (\\frac{1}{2})(1) = \\frac{1}{2}$.\nAll other $\\frac{\\partial N_i}{\\partial \\xi}(0,0)$ are zero.\n\nSimilarly, the partial derivative with respect to $\\eta$ at $(0,0)$ is:\n$$\\frac{\\partial N_i}{\\partial \\eta}(0,0) = L_k(0) \\frac{dL_l}{d\\eta}(0)$$\nThis is non-zero only if $L_k(0) \\neq 0$ (i.e., $k=0$) and $\\frac{dL_l}{d\\eta}(0) \\neq 0$ (i.e., $l=\\pm 1$).\nThe nodes are $(\\xi,\\eta)=(0,-1)$ (node $2$) and $(\\xi,\\eta)=(0,1)$ (node $6$).\nFor node $2$, $(\\xi_k,\\eta_l)=(0,-1)$: $\\frac{\\partial N_2}{\\partial \\eta}(0,0) = L_0(0)\\frac{dL_{-1}}{d\\eta}(0) = (1)(-\\frac{1}{2}) = -\\frac{1}{2}$.\nFor node $6$, $(\\xi_k,\\eta_l)=(0,1)$: $\\frac{\\partial N_6}{\\partial \\eta}(0,0) = L_0(0)\\frac{dL_1}{d\\eta}(0) = (1)(\\frac{1}{2}) = \\frac{1}{2}$.\nAll other $\\frac{\\partial N_i}{\\partial \\eta}(0,0)$ are zero.\n\nNow we can compute the entries of the Jacobian matrix at $(\\xi, \\eta) = (0,0)$ using the given physical coordinates:\n$\\frac{\\partial x}{\\partial \\xi}(0,0) = \\frac{\\partial N_4}{\\partial \\xi}(0,0)x_4 + \\frac{\\partial N_8}{\\partial \\xi}(0,0)x_8 = \\frac{1}{2}x_4 - \\frac{1}{2}x_8 = \\frac{1}{2}(x_4 - x_8) = \\frac{1}{2}(2.1 - (-0.1)) = \\frac{1}{2}(2.2) = 1.1$.\n$\\frac{\\partial x}{\\partial \\eta}(0,0) = \\frac{\\partial N_2}{\\partial \\eta}(0,0)x_2 + \\frac{\\partial N_6}{\\partial \\eta}(0,0)x_6 = -\\frac{1}{2}x_2 + \\frac{1}{2}x_6 = \\frac{1}{2}(x_6 - x_2) = \\frac{1}{2}(1 - 1) = 0$.\n$\\frac{\\partial y}{\\partial \\xi}(0,0) = \\frac{\\partial N_4}{\\partial \\xi}(0,0)y_4 + \\frac{\\partial N_8}{\\partial \\xi}(0,0)y_8 = \\frac{1}{2}y_4 - \\frac{1}{2}y_8 = \\frac{1}{2}(y_4 - y_8) = \\frac{1}{2}(0.5 - 0.5) = 0$.\n$\\frac{\\partial y}{\\partial \\eta}(0,0) = \\frac{\\partial N_2}{\\partial \\eta}(0,0)y_2 + \\frac{\\partial N_6}{\\partial \\eta}(0,0)y_6 = -\\frac{1}{2}y_2 + \\frac{1}{2}y_6 = \\frac{1}{2}(y_6 - y_2) = \\frac{1}{2}(1.05 - (-0.1)) = \\frac{1}{2}(1.15) = 0.575$.\n\nThe Jacobian matrix at $(0,0)$ is:\n$$J(0,0) = \\begin{pmatrix} 1.1  0 \\\\ 0  0.575 \\end{pmatrix}$$\nThe determinant of this matrix is:\n$$\\det(J(0,0)) = (1.1)(0.575) - (0)(0) = 0.6325$$\nThe problem asks for the value rounded to four significant figures. The calculated value $0.6325$ already has exactly four significant figures.",
            "answer": "$$\\boxed{0.6325}$$"
        },
        {
            "introduction": "A valid finite element mapping must be invertible, a condition ensured by a strictly positive Jacobian determinant. This practice moves from construction to verification, challenging you to analyze a 6-node quadratic triangular ($P_2$) element with a curved boundary. By parameterizing the element's geometry, you will determine the precise conditions under which the mapping becomes degenerate, or non-invertible. This exercise  highlights the practical importance of the Jacobian in ensuring a robust and physically meaningful finite element model.",
            "id": "3411542",
            "problem": "Consider the isoparametric quadratic ($P_2$) triangular finite element used in the numerical solution of partial differential equations (PDE). Let the reference triangle be the set of points $(\\xi,\\eta)$ with $\\xi \\ge 0$, $\\eta \\ge 0$, and $\\xi + \\eta \\le 1$. Denote by $L_1 = 1 - \\xi - \\eta$, $L_2 = \\xi$, and $L_3 = \\eta$ the barycentric coordinates on the reference triangle. The isoparametric mapping to physical space $(x,y)$ is defined by using the same quadratic Lagrange shape functions for geometry as for fields: if $\\{N_i\\}_{i=1}^6$ are the quadratic Lagrange shape functions associated with the three vertices and the three edge midpoints, then $x(\\xi,\\eta) = \\sum_{i=1}^6 N_i(\\xi,\\eta) X_i$ and $y(\\xi,\\eta) = \\sum_{i=1}^6 N_i(\\xi,\\eta) Y_i$ for prescribed nodal coordinates $(X_i,Y_i)$.\n\nLet the physical nodal coordinates be chosen as follows to produce a curved side controlled by a nonnegative parameter $a \\ge 0$:\n- Vertex nodes: $(X_1,Y_1) = (0,0)$, $(X_2,Y_2) = (2,0)$, $(X_3,Y_3) = (0,1)$.\n- Edge-midpoint nodes: $(X_4,Y_4) = (1,a)$ on the edge between nodes $1$ and $2$, $(X_5,Y_5) = (1,\\tfrac{1}{2})$ on the edge between nodes $2$ and $3$, and $(X_6,Y_6) = (0,\\tfrac{1}{2})$ on the edge between nodes $3$ and $1$.\n\nStarting only from the definitions of isoparametric mapping, barycentric coordinates, and quadratic Lagrange shape functions on the reference triangle, derive the Jacobian matrix $J(\\xi,\\eta) = \\partial(x,y)/\\partial(\\xi,\\eta)$ and compute its determinant at the three reference edge midpoints $(\\tfrac{1}{2},0)$, $(\\tfrac{1}{2},\\tfrac{1}{2})$, and $(0,\\tfrac{1}{2})$. Then, under the assumption $a \\ge 0$, determine the minimum of these three determinant values as an explicit function of $a$. This minimum provides the sharpest necessary edge-midpoint check for positivity of the Jacobian and indicates the onset of mapping degeneracy at those points.\n\nExpress your final answer as a single closed-form analytic expression in $a$. Do not include units. No rounding is required.",
            "solution": "The solution proceeds by first defining the quadratic shape functions, then constructing the specific isoparametric mapping based on the given nodal coordinates, deriving the Jacobian matrix and its determinant, evaluating the determinant at the specified points, and finally determining the minimum of these values.\n\n**1. Quadratic Lagrange Shape Functions**\nThe quadratic shape functions for a 6-node triangle are defined in terms of the barycentric coordinates $L_1, L_2, L_3$. The vertices correspond to nodes $1, 2, 3$ and the edge midpoints to nodes $4, 5, 6$.\n-   Vertex shape functions:\n    $N_1 = L_1(2L_1-1)$\n    $N_2 = L_2(2L_2-1)$\n    $N_3 = L_3(2L_3-1)$\n-   Edge-midpoint shape functions:\n    $N_4 = 4L_1L_2$ (edge 1-2)\n    $N_5 = 4L_2L_3$ (edge 2-3)\n    $N_6 = 4L_3L_1$ (edge 3-1)\n\n**2. Isoparametric Mapping**\nThe mapping from the reference domain $(\\xi, \\eta)$ to the physical domain $(x, y)$ is given by:\n$x(\\xi, \\eta) = \\sum_{i=1}^6 N_i X_i$\n$y(\\xi, \\eta) = \\sum_{i=1}^6 N_i Y_i$\n\nSubstituting the given nodal coordinates $(X_i, Y_i)$:\n$x(\\xi, \\eta) = X_1 N_1 + X_2 N_2 + X_3 N_3 + X_4 N_4 + X_5 N_5 + X_6 N_6$\n$x(\\xi, \\eta) = (0)N_1 + (2)N_2 + (0)N_3 + (1)N_4 + (1)N_5 + (0)N_6 = 2N_2 + N_4 + N_5$\n\n$y(\\xi, \\eta) = Y_1 N_1 + Y_2 N_2 + Y_3 N_3 + Y_4 N_4 + Y_5 N_5 + Y_6 N_6$\n$y(\\xi, \\eta) = (0)N_1 + (0)N_2 + (1)N_3 + (a)N_4 + (\\frac{1}{2})N_5 + (\\frac{1}{2})N_6 = N_3 + aN_4 + \\frac{1}{2}N_5 + \\frac{1}{2}N_6$\n\n**3. Expressing the Mapping in Terms of $\\xi$ and $\\eta$**\nWe use the fact that $L_1+L_2+L_3=1$.\nFor $x(\\xi, \\eta)$:\n$x = 2 L_2(2L_2 - 1) + 4L_1L_2 + 4L_2L_3 = 2L_2(2L_2 - 1 + 2L_1 + 2L_3)$\n$x = 2L_2(2(L_1+L_2+L_3) - 1) = 2L_2(2(1) - 1) = 2L_2$\nUsing $L_2 = \\xi$, we get a simplified expression for $x$:\n$x(\\xi, \\eta) = 2\\xi$\n\nFor $y(\\xi, \\eta)$:\n$y = L_3(2L_3-1) + a(4L_1L_2) + \\frac{1}{2}(4L_2L_3) + \\frac{1}{2}(4L_3L_1)$\n$y = 2L_3^2 - L_3 + 4aL_1L_2 + 2L_2L_3 + 2L_3L_1$\n$y = 2L_3^2 - L_3 + 4aL_1L_2 + 2L_3(L_1+L_2)$\nUsing $L_1+L_2 = 1-L_3$:\n$y = 2L_3^2 - L_3 + 4aL_1L_2 + 2L_3(1-L_3) = 2L_3^2 - L_3 + 4aL_1L_2 + 2L_3 - 2L_3^2$\n$y = L_3 + 4aL_1L_2$\nUsing $L_1=1-\\xi-\\eta$, $L_2=\\xi$, and $L_3=\\eta$:\n$y(\\xi, \\eta) = \\eta + 4a(1-\\xi-\\eta)\\xi = \\eta + 4a\\xi - 4a\\xi^2 - 4a\\xi\\eta$\n\nThe complete mapping is $(x(\\xi, \\eta), y(\\xi, \\eta)) = (2\\xi, \\eta + 4a\\xi - 4a\\xi^2 - 4a\\xi\\eta)$.\n\n**4. Jacobian Matrix and its Determinant**\nThe Jacobian matrix of the transformation is $J(\\xi,\\eta) = \\begin{pmatrix} \\partial x/\\partial \\xi  \\partial x/\\partial \\eta \\\\ \\partial y/\\partial \\xi  \\partial y/\\partial \\eta \\end{pmatrix}$.\nWe compute the partial derivatives:\n$\\frac{\\partial x}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi}(2\\xi) = 2$\n$\\frac{\\partial x}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta}(2\\xi) = 0$\n$\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi}(\\eta + 4a\\xi - 4a\\xi^2 - 4a\\xi\\eta) = 4a - 8a\\xi - 4a\\eta = 4a(1 - 2\\xi - \\eta)$\n$\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta}(\\eta + 4a\\xi - 4a\\xi^2 - 4a\\xi\\eta) = 1 - 4a\\xi$\n\nThe Jacobian matrix is:\n$J(\\xi, \\eta) = \\begin{pmatrix} 2  0 \\\\ 4a(1 - 2\\xi - \\eta)  1 - 4a\\xi \\end{pmatrix}$\n\nThe determinant of the Jacobian is:\n$\\det(J) = (2)(1 - 4a\\xi) - (0)(4a(1 - 2\\xi - \\eta)) = 2(1 - 4a\\xi)$\n\n**5. Evaluation of the Determinant at Midpoints**\nThe problem requires evaluating $\\det(J)$ at the three reference edge midpoints:\n-   Point for edge 1-2: $(\\xi, \\eta) = (\\frac{1}{2}, 0)$.\n    $\\det(J(\\tfrac{1}{2}, 0)) = 2(1 - 4a(\\frac{1}{2})) = 2(1 - 2a) = 2 - 4a$.\n-   Point for edge 2-3: $(\\xi, \\eta) = (\\frac{1}{2}, \\frac{1}{2})$.\n    $\\det(J(\\tfrac{1}{2}, \\tfrac{1}{2})) = 2(1 - 4a(\\frac{1}{2})) = 2(1 - 2a) = 2 - 4a$.\n-   Point for edge 3-1: $(\\xi, \\eta) = (0, \\frac{1}{2})$.\n    $\\det(J(0, \\tfrac{1}{2})) = 2(1 - 4a(0)) = 2(1) = 2$.\n\nThe three determinant values are $\\{2 - 4a, 2 - 4a, 2\\}$.\n\n**6. Minimum Determinant Value**\nWe need to find the minimum of the set $\\{2-4a, 2\\}$ under the given constraint $a \\ge 0$.\nLet's compare the two distinct values, $2-4a$ and $2$.\nThe inequality $2-4a \\le 2$ is equivalent to $-4a \\le 0$, which simplifies to $4a \\ge 0$, and finally $a \\ge 0$.\nSince the problem specifies that $a \\ge 0$, the inequality $2-4a \\le 2$ always holds.\nTherefore, the minimum value in the set $\\{2-4a, 2\\}$ is $2-4a$.\n\nThe minimum of the three determinant values provides the sharpest necessary condition for positivity of the Jacobian at these specific check points. It indicates that the mapping will become degenerate first at the midpoints of edges 1-2 and 2-3 (in the reference space) as the parameter $a$ increases.",
            "answer": "$$\n\\boxed{2 - 4a}\n$$"
        },
        {
            "introduction": "We now investigate the behavior of subparametric elements, where the geometry is interpolated at a lower order than the field variables. While computationally efficient, this mismatch can lead to inaccuracies. This problem guides you through a computational patch test , a standard procedure for verifying element formulation. By applying a linear displacement field to an element with a bilinear geometry and a quadratic field, you will observe firsthand how geometric inconsistencies on curved domains can prevent the element from reproducing a constant strain state, a critical test of element fidelity.",
            "id": "3411587",
            "problem": "You are asked to construct a subparametric quadrilateral element for the Finite Element Method (FEM) in two dimensions that uses linear geometry order and quadratic field order, and to design and compute a patch test that reveals failure modes in reproducing constant strain states due to geometric inconsistency in the mapping. The mapping is the geometric transformation $F:\\hat{\\Omega}\\to\\Omega$ from the reference square $\\hat{\\Omega}=[-1,1]^2$ to the physical element $\\Omega\\subset\\mathbb{R}^2$. In subparametric elements, the geometry interpolation order $p_g$ is strictly lower than the field interpolation order $p_u$; here you must take $p_g=1$ (a bilinear mapping built from the $4$ corner nodes only) and $p_u=2$ (a quadratic field built from $8$ serendipity nodes, namely $4$ corners and $4$ mid-edge nodes).\n\nYour task is to implement a program that assembles a patch test based on the following principle. Given a physically linear displacement field in Cartesian physical coordinates\n$$\n\\mathbf{u}(x,y)=\\begin{bmatrix}u_1(x,y)\\\\u_2(x,y)\\end{bmatrix}=\\begin{bmatrix}\\alpha x+\\beta y + c_1\\\\ \\gamma x+\\delta y + c_2\\end{bmatrix},\n$$\nthe exact infinitesimal strain tensor is constant:\n$$\n\\boldsymbol{\\varepsilon}_{\\text{exact}}=\\frac{1}{2}\\left(\\nabla\\mathbf{u}+(\\nabla\\mathbf{u})^\\top\\right)=\\begin{bmatrix}\\varepsilon_{xx}  \\varepsilon_{xy}\\\\ \\varepsilon_{xy}  \\varepsilon_{yy}\\end{bmatrix},\n$$\nwith\n$$\n\\varepsilon_{xx}=\\alpha,\\quad \\varepsilon_{yy}=\\delta,\\quad \\varepsilon_{xy}=\\frac{\\beta+\\gamma}{2}.\n$$\nA constant-strain patch test is considered passed if the element reproduces this constant strain exactly at all quadrature points when the nodal values are set to the exact field values. In an isoparametric formulation ($p_g=p_u$), this is guaranteed for affine mappings. In a subparametric element with a curved boundary represented by a linear geometry mapping $F$, the mapping inconsistency can cause a failure of the constant-strain patch test.\n\nYou must use the following foundational constructions and facts:\n- The geometric mapping $F$ is defined by the bilinear interpolation of the $4$ corner nodes $\\{\\mathbf{x}_a\\}_{a=1}^4$ using the $4$-node quadrilateral shape functions $\\{N_a^{(g)}(\\xi,\\eta)\\}_{a=1}^4$:\n$$\n\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a^{(g)}(\\xi,\\eta)\\,\\mathbf{x}_a,\\quad (\\xi,\\eta)\\in[-1,1]^2.\n$$\n- The quadratic field interpolation uses the $8$-node serendipity shape functions $\\{N_i(\\xi,\\eta)\\}_{i=1}^8$ on $\\hat{\\Omega}$ to interpolate nodal values $\\{\\mathbf{u}_i\\}_{i=1}^8$:\n$$\n\\mathbf{u}^h(\\xi,\\eta)=\\sum_{i=1}^8 N_i(\\xi,\\eta)\\,\\mathbf{u}_i.\n$$\n- The chain rule gives the physical gradients of the shape functions as\n$$\n\\nabla_{\\mathbf{x}} N_i = \\mathbf{J}^{-1}\\,\\nabla_{\\hat{\\boldsymbol{\\xi}}} N_i,\\quad \\mathbf{J}=\\frac{\\partial \\mathbf{x}}{\\partial\\hat{\\boldsymbol{\\xi}}}=\\begin{bmatrix}\\dfrac{\\partial x}{\\partial \\xi}  \\dfrac{\\partial x}{\\partial \\eta} \\\\ \\dfrac{\\partial y}{\\partial \\xi}  \\dfrac{\\partial y}{\\partial \\eta}\\end{bmatrix}.\n$$\n- The displacement gradient is\n$$\n\\nabla \\mathbf{u}^h=\\sum_{i=1}^8 \\mathbf{u}_i\\otimes \\nabla_{\\mathbf{x}}N_i,\n$$\nand the computed small-strain tensor is\n$$\n\\boldsymbol{\\varepsilon}^h=\\frac{1}{2}\\left(\\nabla\\mathbf{u}^h+(\\nabla\\mathbf{u}^h)^\\top\\right).\n$$\n\nYou must implement the following three test cases (angles in radians), each yielding a scalar error measuring the failure or success of the constant-strain patch test:\n1. A curved boundary element: a curvilinear quadrilateral given by a circular sector with inner radius $R_1=1$, outer radius $R_2=2$, and angle $\\varphi=\\pi/2$. The $4$ corner nodes are the endpoints of the two radial lines at angles $\\theta_1=-\\varphi/2$ and $\\theta_2=\\varphi/2$ and radii $R_1$ and $R_2$. The $4$ mid-edge nodes lie at the geometric midpoints of each edge, with the two arc-edge midpoints at angle $\\theta=0$ and radii $R_1$ and $R_2$, and the two radial-edge midpoints at radius $(R_1+R_2)/2$ at angles $\\theta_1$ and $\\theta_2$. Use a subparametric element: the geometry mapping $F$ uses only the $4$ corner nodes (bilinear), while the field uses all $8$ nodes (quadratic). Set the nodal displacements to the exact linear field values. Compute the area-weighted root-mean-square error\n$$\nE=\\left(\\frac{\\sum_{q} w_q\\,\\left|\\det\\mathbf{J}(\\xi_q,\\eta_q)\\right|\\,\\left\\|\\boldsymbol{\\varepsilon}^h(\\xi_q,\\eta_q)-\\boldsymbol{\\varepsilon}_{\\text{exact}}\\right\\|_F^2}{\\sum_{q} w_q\\,\\left|\\det\\mathbf{J}(\\xi_q,\\eta_q)\\right|}\\right)^{1/2},\n$$\nusing a tensor Frobenius norm $\\|\\cdot\\|_F$ and a $3\\times 3$ Gauss tensor-product quadrature on $\\hat{\\Omega}$.\n2. A straight-sided square element: the unit square with corner nodes at $(0,0)$, $(1,0)$, $(1,1)$, $(0,1)$ and mid-edge nodes at the standard edge midpoints. Use the same subparametric setup (bilinear geometry with $4$ corners; quadratic field with $8$ nodes) and the same error measure $E$.\n3. A slightly curved boundary element: a circular sector with inner radius $R_1=10$, outer radius $R_2=11$, and angle $\\varphi=\\pi/18$. Use the same subparametric setup and the same computation of $E$.\n\nFor all three cases, take the physical linear displacement field parameters\n$$\n\\alpha=0.01,\\quad \\beta=0.02,\\quad \\gamma=0.03,\\quad \\delta=0.04,\\quad c_1=0.1,\\quad c_2=-0.2,\n$$\nand report the area-weighted root-mean-square error $E$ for each case. The element passes the constant-strain patch test if $E$ is numerically zero (up to rounding); otherwise it fails. Angles must be in radians. No physical units are needed.\n\nYour program must produce a single line of output containing the three errors as a comma-separated list enclosed in square brackets, in scientific notation with $10$ significant digits, in the order of the test cases described above. For example, the output format must be\n\"[x1,x2,x3]\"\nwhere each $x_k$ is a float in scientific notation with $10$ significant digits.\n\nThe program must be self-contained, must not require any input, and must implement the complete computation described above without referencing external files. The final outputs are the three floats for the corresponding test cases, in the specified format. The test suite thus consists of the parameter triples $(R_1,R_2,\\varphi)=(1,2,\\pi/2)$, the unit square, and $(10,11,\\pi/18)$ respectively, with the exact strain defined by $(\\alpha,\\beta,\\gamma,\\delta)$ as above.",
            "solution": "The analysis and solution of this problem are predicated on the principles of the Finite Element Method (FEM), specifically concerning the formulation and validation of mixed-order elements. The problem requires the implementation of a constant-strain patch test for a subparametric quadrilateral element.\n\nA patch test is a fundamental numerical experiment designed to verify an element's ability to reproduce exact solutions for simple, polynomial fields. For linear elasticity, a crucial requirement is the ability to represent a constant strain state exactly. Failure to pass this test indicates a flawed element formulation that may lead to non-convergence of the numerical solution.\n\nThe element under consideration is subparametric, meaning the order of polynomial interpolation for the geometry, $p_g$, is lower than that for the displacement field, $p_u$. The problem specifies a bilinear geometry interpolation ($p_g=1$) and a quadratic field interpolation ($p_u=2$).\n\n**Formulation of the Subparametric Element**\n\nThe geometry of the element, which describes the mapping from the canonical reference square $\\hat{\\Omega}=[-1,1]^2$ with coordinates $(\\xi, \\eta)$ to the physical element $\\Omega$ with coordinates $(x,y)$, is defined using only the $4$ corner nodes of the element, $\\{\\mathbf{x}_a\\}_{a=1}^4$. The mapping $\\mathbf{x}(\\xi, \\eta)$ is given by the bilinear shape functions $\\{N_a^{(g)}(\\xi,\\eta)\\}_{a=1}^4$:\n$$\n\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a^{(g)}(\\xi,\\eta)\\,\\mathbf{x}_a\n$$\nThe functions $N_a^{(g)}$ are given by $N_a^{(g)}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi_a\\xi)(1+\\eta_a\\eta)$, where $(\\xi_a, \\eta_a)$ are the coordinates of the corners of the reference square.\n\nThe displacement field, $\\mathbf{u}$, is approximated using a higher-order interpolation over the same reference element. It employs the $8$-node serendipity shape functions, $\\{N_i(\\xi,\\eta)\\}_{i=1}^8$, which correspond to the $4$ corner nodes and $4$ mid-edge nodes. The interpolated displacement field $\\mathbf{u}^h$ is:\n$$\n\\mathbf{u}^h(\\xi,\\eta)=\\sum_{i=1}^8 N_i(\\xi,\\eta)\\,\\mathbf{u}_i\n$$\nwhere $\\{\\mathbf{u}_i\\}_{i=1}^8$ are the displacement values at the $8$ physical nodes.\n\n**The Source of Inconsistency**\n\nThe core of the problem lies in the potential inconsistency of this subparametric formulation. For the patch test, the nodal displacements $\\mathbf{u}_i$ are set to the exact values of a prescribed linear displacement field, $\\mathbf{u}(x,y)$, evaluated at the true physical locations of the $8$ nodes, $\\mathbf{x}_i$:\n$$\n\\mathbf{u}_i = \\begin{bmatrix}\\alpha x_i+\\beta y_i + c_1\\\\ \\gamma x_i+\\delta y_i + c_2\\end{bmatrix}\n$$\nFor elements with curved boundaries, the true mid-edge nodes lie on the curves. However, the bilinear geometry map $\\mathbf{x}(\\xi,\\eta)$ describes a quadrilateral with straight sides connecting the four corners. The locations of the mid-edges according to this map do not coincide with the true mid-edge node locations. This geometric discrepancy is the fundamental reason why a subparametric element may fail the patch test on curved geometries.\n\n**Strain Calculation and the Patch Test**\n\nThe infinitesimal strain tensor $\\boldsymbol{\\varepsilon}^h$ is computed from the gradient of the interpolated displacement field. The gradient in physical coordinates, $\\nabla_{\\mathbf{x}}$, is obtained from the gradient in reference coordinates, $\\nabla_{\\boldsymbol{\\xi}}$, using the chain rule, which involves the inverse of the geometric Jacobian matrix $\\mathbf{J}$:\n$$\n\\mathbf{J}=\\frac{\\partial \\mathbf{x}}{\\partial\\boldsymbol{\\xi}}=\\begin{bmatrix}\\dfrac{\\partial x}{\\partial \\xi}  \\dfrac{\\partial x}{\\partial \\eta}\\\\ \\dfrac{\\partial y}{\\partial \\xi}  \\dfrac{\\partial y}{\\partial \\eta}\\end{bmatrix} \\quad \\implies \\quad \\nabla_{\\mathbf{x}} N_i = \\mathbf{J}^{-1}\\,\\nabla_{\\boldsymbol{\\xi}} N_i\n$$\nThe displacement gradient tensor is calculated as a sum over all $8$ nodes:\n$$\n\\nabla \\mathbf{u}^h=\\sum_{i=1}^8 \\mathbf{u}_i\\otimes \\nabla_{\\mathbf{x}}N_i\n$$\nThe computed strain tensor is the symmetric part of the displacement gradient:\n$$\n\\boldsymbol{\\varepsilon}^h=\\frac{1}{2}\\left(\\nabla\\mathbf{u}^h+(\\nabla\\mathbf{u}^h)^\\top\\right)\n$$\nThe patch test succeeds if this computed strain $\\boldsymbol{\\varepsilon}^h$ is exactly equal to the constant strain tensor $\\boldsymbol{\\varepsilon}_{\\text{exact}}$ derived from the linear displacement field, where $\\varepsilon_{xx}=\\alpha$, $\\varepsilon_{yy}=\\delta$, and $\\varepsilon_{xy}=(\\beta+\\gamma)/2$.\n\nThe error is quantified by the area-weighted root-mean-square of the difference between the computed and exact strains, integrated over the element domain using a $3\\times 3$ Gauss quadrature:\n$$\nE=\\left(\\frac{\\sum_{q} w_q\\,\\left|\\det\\mathbf{J}(\\xi_q,\\eta_q)\\right|\\,\\left\\|\\boldsymbol{\\varepsilon}^h(\\xi_q,\\eta_q)-\\boldsymbol{\\varepsilon}_{\\text{exact}}\\right\\|_F^2}{\\sum_{q} w_q\\,\\left|\\det\\mathbf{J}(\\xi_q,\\eta_q)\\right|}\\right)^{1/2}\n$$\nA non-zero value of $E$ signifies a failure of the patch test.\n\n**Analysis of Test Cases**\n\n1.  **Case 1 (Curved Element):** The element is a sector of an annulus with significant curvature ($R_1=1$, $R_2=2$, $\\varphi=\\pi/2$). The bilinear geometry map produces a straight-sided quadrilateral, which is a poor approximation of the true curved geometry. The Jacobian $\\mathbf{J}$ is non-constant and reflects this incorrect geometry. The resulting strain field $\\boldsymbol{\\varepsilon}^h$ will not be constant and will deviate from $\\boldsymbol{\\varepsilon}_{\\text{exact}}$, leading to a significant non-zero error $E$.\n\n2.  **Case 2 (Square Element):** The element is a unit square. The geometry is affine. The bilinear map $\\mathbf{x}(\\xi,\\eta)$ exactly represents this geometry, and the Jacobian $\\mathbf{J}$ is constant. The geometric inconsistency vanishes. A linear displacement field in $(x,y)$ transforms into a polynomial in $(\\xi,\\eta)$ that the quadratic serendipity basis can represent exactly. Therefore, $\\boldsymbol{\\varepsilon}^h$ will be exactly equal to $\\boldsymbol{\\varepsilon}_{\\text{exact}}$ at all points, and the error $E$ will be zero (within machine precision). This demonstrates that the subparametric element is valid for affine geometries.\n\n3.  **Case 3 (Slightly Curved Element):** This element has very little curvature ($R_1=10$, $R_2=11$, $\\varphi=\\pi/18$). The geometric mismatch is present but small. The error $E$ is expected to be non-zero but substantially smaller than in Case $1$. This illustrates that the error is directly related to the degree of geometric inconsistency.\n\nThe following program implements this entire procedure.",
            "answer": "```python\nimport numpy as np\n\ndef get_shape_func_derivs_N4(xi, eta):\n    \"\"\"\n    Computes the derivatives of the 4-node bilinear shape functions\n    with respect to the reference coordinates (xi, eta).\n    Returns a (4, 2) numpy array where row i corresponds to N_i\n    and columns are [dN_i/dxi, dN_i/deta].\n    Node ordering: (-1,-1), (1,-1), (1,1), (-1,1).\n    \"\"\"\n    dN_dxi = 0.25 * np.array([-(1.0 - eta), (1.0 - eta), (1.0 + eta), -(1.0 + eta)])\n    dN_deta = 0.25 * np.array([-(1.0 - xi), -(1.0 + xi), (1.0 + xi), (1.0 - xi)])\n    return np.vstack((dN_dxi, dN_deta)).T\n\ndef get_shape_func_derivs_N8(xi, eta):\n    \"\"\"\n    Computes the derivatives of the 8-node serendipity shape functions.\n    Node ordering: 4 corners then 4 midsides.\n    (-1,-1), (1,-1), (1,1), (-1,1), (0,-1), (1,0), (0,1), (-1,0).\n    Returns a (8, 2) numpy array.\n    \"\"\"\n    derivs = np.zeros((8, 2))\n    \n    # Corner nodes (i=0 to 3)\n    xi_co = np.array([-1.0, 1.0, 1.0, -1.0])\n    eta_co = np.array([-1.0, -1.0, 1.0, 1.0])\n    for i in range(4):\n        xii, etai = xi_co[i], eta_co[i]\n        derivs[i, 0] = 0.25 * xii * (1.0 + etai * eta) * (2.0 * xii * xi + etai * eta)\n        derivs[i, 1] = 0.25 * etai * (1.0 + xii * xi) * (xii * xi + 2.0 * etai * eta)\n\n    # Midside nodes (i=4 to 7)\n    # Node 4: (0, -1)\n    derivs[4, 0] = -xi * (1.0 - eta)\n    derivs[4, 1] = -0.5 * (1.0 - xi**2)\n    \n    # Node 5: (1, 0)\n    derivs[5, 0] = 0.5 * (1.0 - eta**2)\n    derivs[5, 1] = -eta * (1.0 + xi)\n    \n    # Node 6: (0, 1)\n    derivs[6, 0] = -xi * (1.0 + eta)\n    derivs[6, 1] = 0.5 * (1.0 - xi**2)\n    \n    # Node 7: (-1, 0)\n    derivs[7, 0] = -0.5 * (1.0 - eta**2)\n    derivs[7, 1] = -eta * (1.0 - xi)\n    \n    return derivs\n\ndef generate_nodes(case_params):\n    \"\"\"\n    Generates the physical coordinates for the 8 nodes of the element.\n    Returns:\n    - corner_nodes_phys: (4, 2) array for geometry.\n    - field_nodes_phys: (8, 2) array for field interpolation.\n    \"\"\"\n    case_type = case_params['type']\n    \n    if case_type == 'square':\n        nodes = np.array([\n            [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0],  # Corners P1-P4\n            [0.5, 0.0], [1.0, 0.5], [0.5, 1.0], [0.0, 0.5]   # Midsides P5-P8\n        ])\n        return nodes[0:4, :], nodes\n\n    elif case_type == 'curved':\n        R1, R2, phi = case_params['R1'], case_params['R2'], case_params['phi']\n        th1, th2 = -phi / 2.0, phi / 2.0\n        \n        nodes = np.zeros((8, 2))\n        \n        # Corner nodes P1, P2, P3, P4\n        nodes[0, :] = [R1 * np.cos(th1), R1 * np.sin(th1)]\n        nodes[1, :] = [R2 * np.cos(th1), R2 * np.sin(th1)]\n        nodes[2, :] = [R2 * np.cos(th2), R2 * np.sin(th2)]\n        nodes[3, :] = [R1 * np.cos(th2), R1 * np.sin(th2)]\n\n        # Midside nodes P5, P6, P7, P8\n        nodes[4, :] = [(R1 + R2) / 2.0 * np.cos(th1), (R1 + R2) / 2.0 * np.sin(th1)]\n        nodes[5, :] = [R2, 0.0]\n        nodes[6, :] = [(R1 + R2) / 2.0 * np.cos(th2), (R1 + R2) / 2.0 * np.sin(th2)]\n        nodes[7, :] = [R1, 0.0]\n        \n        return nodes[0:4, :], nodes\n\ndef compute_patch_test_error(case_params, disp_params):\n    \"\"\"\n    Performs the patch test for a given element configuration.\n    \"\"\"\n    alpha, beta, gamma, delta, c1, c2 = disp_params\n    \n    corner_nodes_phys, field_nodes_phys = generate_nodes(case_params)\n    \n    # Nodal displacements from exact field\n    u_nodes = np.zeros((8, 2))\n    u_nodes[:, 0] = alpha * field_nodes_phys[:, 0] + beta * field_nodes_phys[:, 1] + c1\n    u_nodes[:, 1] = gamma * field_nodes_phys[:, 0] + delta * field_nodes_phys[:, 1] + c2\n    \n    # Exact strain tensor (constant)\n    eps_exact = np.array([\n        [alpha, 0.5 * (beta + gamma)],\n        [0.5 * (beta + gamma), delta]\n    ])\n\n    # 3-point Gauss quadrature\n    gp_loc = np.array([-np.sqrt(3.0/5.0), 0.0, np.sqrt(3.0/5.0)])\n    gp_wgt = np.array([5.0/9.0, 8.0/9.0, 5.0/9.0])\n    \n    numerator = 0.0\n    denominator = 0.0\n    \n    for i in range(3):\n        for j in range(3):\n            xi, eta = gp_loc[i], gp_loc[j]\n            weight = gp_wgt[i] * gp_wgt[j]\n            \n            # Jacobian from 4-node geometry map\n            dN4_dxieta = get_shape_func_derivs_N4(xi, eta)\n            J = dN4_dxieta.T @ corner_nodes_phys\n            detJ = np.linalg.det(J)\n            invJ = np.linalg.inv(J)\n            \n            # Displacement gradient from 8-node field\n            dN8_dxieta = get_shape_func_derivs_N8(xi, eta)\n            grad_N_phys = dN8_dxieta @ invJ\n            \n            grad_u_h = np.zeros((2, 2))\n            for k in range(8):\n                grad_u_h += np.outer(u_nodes[k, :], grad_N_phys[k, :])\n\n            # Computed strain\n            eps_h = 0.5 * (grad_u_h + grad_u_h.T)\n            \n            # Strain error\n            strain_error = eps_h - eps_exact\n            frob_norm_sq = strain_error[0, 0]**2 + strain_error[1, 1]**2 + 2 * strain_error[0, 1]**2\n            \n            # Area-weighted sum\n            d_area = abs(detJ) * weight\n            numerator += frob_norm_sq * d_area\n            denominator += d_area\n            \n    if denominator == 0.0:\n        return 0.0\n        \n    return np.sqrt(numerator / denominator)\n\ndef solve():\n    # Test cases defined in the problem\n    test_cases = [\n        {'type': 'curved', 'R1': 1.0, 'R2': 2.0, 'phi': np.pi / 2.0},\n        {'type': 'square'},\n        {'type': 'curved', 'R1': 10.0, 'R2': 11.0, 'phi': np.pi / 18.0}\n    ]\n    \n    # Physical linear displacement field parameters\n    disp_params = (0.01, 0.02, 0.03, 0.04, 0.1, -0.2)\n\n    results = []\n    for case in test_cases:\n        error = compute_patch_test_error(case, disp_params)\n        results.append(f\"{error:.9e}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}