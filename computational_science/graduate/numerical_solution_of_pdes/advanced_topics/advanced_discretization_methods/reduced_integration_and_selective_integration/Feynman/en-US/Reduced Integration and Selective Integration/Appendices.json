{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp the mechanics of selective integration, it is essential to analyze its effect at the most fundamental level: a single element. This exercise provides a concrete, hands-on calculation comparing the strain energy of a bilinear element computed with full versus selective quadrature for a specific deformation mode. By working through this problem , you will gain a precise understanding of how this technique alters the element's energetic response and effective stiffness.",
            "id": "3439222",
            "problem": "Consider isotropic linear elasticity in plane strain on a single isoparametric bilinear quadrilateral ($Q_1$) finite element. The element occupies the physical square $\\Omega_e = [0,L] \\times [0,L]$ with $L>0$. Use the standard reference square $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$ with affine mapping $x = \\frac{L}{2}(\\xi+1)$, $y = \\frac{L}{2}(\\eta+1)$, so the Jacobian determinant is $|J| = \\frac{L^2}{4}$.\n\nLet the four $Q_1$ shape functions be\n$$\nN_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta),\\quad\nN_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta).\n$$\nAssume the displacement field is interpolated as $u(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,u_i$ and $v(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,v_i$, where $(u_i,v_i)$ are the nodal values in the $x$- and $y$-directions, respectively. Consider the specific nodal vector where only the $x$-displacement at node $1$ is nonzero: $u_1=1$, $v_1=0$, and $u_2=u_3=u_4=v_2=v_3=v_4=0$.\n\nUse the small-strain definition $\\varepsilon = \\frac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top})$ so that $\\varepsilon_{xx} = \\partial u/\\partial x$, $\\varepsilon_{yy} = \\partial v/\\partial y$, and $\\varepsilon_{xy} = \\frac{1}{2}(\\partial u/\\partial y + \\partial v/\\partial x)$. Adopt the volumetric-deviatoric split in two dimensions: $\\varepsilon_{\\text{dev}} = \\varepsilon - \\frac{1}{2}(\\operatorname{tr}\\varepsilon)\\,\\mathbf{I}$, with energy density\n$$\nw(\\varepsilon) = \\mu\\,\\varepsilon_{\\text{dev}}:\\varepsilon_{\\text{dev}} + \\frac{\\kappa}{2}\\,(\\operatorname{tr}\\varepsilon)^2,\n$$\nwhere $\\mu>0$ is the shear modulus and $\\kappa = \\lambda + \\mu$ is the two-dimensional bulk modulus expressed in terms of the Lamé parameter $\\lambda>0$ and $\\mu$.\n\nDefine the element energy for a given displacement field as $E = \\int_{\\Omega_e} w(\\varepsilon)\\, d\\Omega$. Compute the following two energies for the given nodal vector:\n- $E_{\\text{full}}$, using the standard full $2\\times 2$ Gaussian quadrature on the reference element for both the deviatoric and volumetric contributions.\n- $E_{\\text{sel}}$, using selective integration: apply full $2\\times 2$ Gaussian quadrature for the deviatoric contribution and reduced $1\\times 1$ Gaussian quadrature (evaluation at $(\\xi,\\eta)=(0,0)$ with weight $4$ on the reference element) for the volumetric contribution.\n\nFrom first principles and the definitions above, derive $E_{\\text{full}}$ and $E_{\\text{sel}}$ and report the single closed-form analytic expression for the ratio\n$$\nr \\equiv \\frac{E_{\\text{sel}}}{E_{\\text{full}}}\n$$\nas a function of $\\lambda$ and $\\mu$. No numerical rounding is required. Express the final answer as a single analytic expression.",
            "solution": "The user wants to compute the ratio of elastic energies for a single finite element under a specific deformation, calculated with two different numerical integration schemes: full quadrature and selective-reduced quadrature.\n\nFirst, we must validate the problem statement.\n1.  **Extract Givens**: The problem provides the geometry of a bilinear quadrilateral element, the mapping from a reference element, the shape functions $N_i$, a specific nodal displacement vector, the definitions for strain and a volumetric-deviatoric split of the strain energy density, material parameters $\\mu$ and $\\kappa = \\lambda + \\mu$, and the definition of two integration schemes (full $2 \\times 2$ Gaussian quadrature and selective $2 \\times 2 / 1 \\times 1$ quadrature).\n2.  **Validate**: The problem is scientifically grounded in the theory of linear elasticity and the finite element method. All definitions and constants are standard in this field. The problem is well-posed, with a clear objective and all necessary information provided. There are no contradictions, ambiguities, or pseudoscientific claims.\n3.  **Verdict**: The problem is valid.\n\nWe now proceed to derive the solution.\n\nThe displacement field $(\\,u(\\xi,\\eta), v(\\xi,\\eta)\\,)$ within the element is interpolated from the nodal values $(u_i,v_i)$ using the shape functions $N_i(\\xi,\\eta)$. Given the nodal displacement vector $u_1=1$ and all other $u_i, v_i$ are zero, the displacement field simplifies to:\n$$\nu(\\xi,\\eta) = N_1(\\xi,\\eta) \\cdot u_1 = N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)\n$$\n$$\nv(\\xi,\\eta) = 0\n$$\n\nTo compute the strain tensor $\\varepsilon$, we need the spatial derivatives of the displacement field. The mapping from the reference coordinates $(\\xi,\\eta)$ to physical coordinates $(x,y)$ is given by $x = \\frac{L}{2}(\\xi+1)$ and $y = \\frac{L}{2}(\\eta+1)$. The Jacobian matrix of this transformation is:\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{L}{2} & 0 \\\\ 0 & \\frac{L}{2} \\end{pmatrix}\n$$\nThe determinant of the Jacobian is $|J| = \\frac{L^2}{4}$, which is constant. The inverse Jacobian is:\n$$\n\\mathbf{J}^{-1} = \\begin{pmatrix} \\frac{2}{L} & 0 \\\\ 0 & \\frac{2}{L} \\end{pmatrix}\n$$\nThe gradient operator in physical coordinates is related to the gradient in reference coordinates by $\\begin{pmatrix} \\partial/\\partial x \\\\ \\partial/\\partial y \\end{pmatrix} = \\mathbf{J}^{-1} \\begin{pmatrix} \\partial/\\partial \\xi \\\\ \\partial/\\partial \\eta \\end{pmatrix}$.\nThe derivatives of the displacement components are:\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{2}{L} \\frac{\\partial u}{\\partial \\xi} = \\frac{2}{L} \\left( -\\frac{1}{4}(1-\\eta) \\right) = -\\frac{1}{2L}(1-\\eta) = \\frac{1}{2L}(\\eta-1)\n$$\n$$\n\\frac{\\partial u}{\\partial y} = \\frac{2}{L} \\frac{\\partial u}{\\partial \\eta} = \\frac{2}{L} \\left( -\\frac{1}{4}(1-\\xi) \\right) = -\\frac{1}{2L}(1-\\xi) = \\frac{1}{2L}(\\xi-1)\n$$\n$$\n\\frac{\\partial v}{\\partial x} = 0, \\quad \\frac{\\partial v}{\\partial y} = 0\n$$\nThe components of the small-strain tensor $\\varepsilon$ are:\n$$\n\\varepsilon_{xx} = \\frac{\\partial u}{\\partial x} = \\frac{1}{2L}(\\eta-1)\n$$\n$$\n\\varepsilon_{yy} = \\frac{\\partial v}{\\partial y} = 0\n$$\n$$\n\\varepsilon_{xy} = \\frac{1}{2}\\left(\\frac{\\partial u}{\\partial y} + \\frac{\\partial v}{\\partial x}\\right) = \\frac{1}{2} \\frac{1}{2L}(\\xi-1) = \\frac{1}{4L}(\\xi-1)\n$$\nThe trace of the strain tensor is $\\operatorname{tr}\\varepsilon = \\varepsilon_{xx} + \\varepsilon_{yy} = \\frac{1}{2L}(\\eta-1)$.\n\nThe element's total strain energy $E$ is the integral of the energy density $w(\\varepsilon)$ over the element's area $\\Omega_e$. The energy density is split into deviatoric and volumetric parts: $w(\\varepsilon) = w_{\\text{dev}} + w_{\\text{vol}}$.\n$$\nw_{\\text{vol}} = \\frac{\\kappa}{2}(\\operatorname{tr}\\varepsilon)^2 = \\frac{\\kappa}{2} \\left(\\frac{1}{2L}(\\eta-1)\\right)^2 = \\frac{\\kappa}{8L^2}(1-\\eta)^2\n$$\nThe deviatoric strain tensor components are $\\varepsilon_{\\text{dev}} = \\varepsilon - \\frac{1}{2}(\\operatorname{tr}\\varepsilon)\\mathbf{I}$:\n$$\n\\varepsilon_{\\text{dev},xx} = \\varepsilon_{xx} - \\frac{1}{2}\\operatorname{tr}\\varepsilon = \\frac{1}{2L}(\\eta-1) - \\frac{1}{4L}(\\eta-1) = \\frac{1}{4L}(\\eta-1)\n$$\n$$\n\\varepsilon_{\\text{dev},yy} = \\varepsilon_{yy} - \\frac{1}{2}\\operatorname{tr}\\varepsilon = 0 - \\frac{1}{4L}(\\eta-1) = -\\frac{1}{4L}(\\eta-1)\n$$\n$$\n\\varepsilon_{\\text{dev},xy} = \\varepsilon_{xy} = \\frac{1}{4L}(\\xi-1)\n$$\nThe deviatoric energy density is $w_{\\text{dev}} = \\mu\\,\\varepsilon_{\\text{dev}}:\\varepsilon_{\\text{dev}} = \\mu ((\\varepsilon_{\\text{dev},xx})^2 + (\\varepsilon_{\\text{dev},yy})^2 + 2(\\varepsilon_{\\text{dev},xy})^2)$:\n$$\nw_{\\text{dev}} = \\mu \\left[ \\left(\\frac{\\eta-1}{4L}\\right)^2 + \\left(-\\frac{\\eta-1}{4L}\\right)^2 + 2\\left(\\frac{\\xi-1}{4L}\\right)^2 \\right] = \\frac{\\mu}{16L^2} \\left[ 2(1-\\eta)^2 + 2(1-\\xi)^2 \\right] = \\frac{\\mu}{8L^2} \\left[ (1-\\xi)^2 + (1-\\eta)^2 \\right]\n$$\nThe total energy is $E = \\int_{\\Omega_e} w(\\varepsilon) d\\Omega = \\int_{-1}^{1}\\int_{-1}^{1} w(\\varepsilon(\\xi,\\eta)) |J| d\\xi d\\eta$. We define the integrands over the reference element:\n$$\nI_{\\text{dev}}(\\xi,\\eta) = w_{\\text{dev}} |J| = \\frac{\\mu}{8L^2} \\left[ (1-\\xi)^2 + (1-\\eta)^2 \\right] \\frac{L^2}{4} = \\frac{\\mu}{32} \\left[ (1-\\xi)^2 + (1-\\eta)^2 \\right]\n$$\n$$\nI_{\\text{vol}}(\\xi,\\eta) = w_{\\text{vol}} |J| = \\frac{\\kappa}{8L^2}(1-\\eta)^2 \\frac{L^2}{4} = \\frac{\\kappa}{32}(1-\\eta)^2\n$$\nSince the integrands are quadratic polynomials, the $2 \\times 2$ Gaussian quadrature is exact. Let's compute the exact integrals, which will correspond to the full integration scheme.\nThe deviatoric energy is:\n$$\nE_{\\text{dev}} = \\int_{-1}^{1}\\int_{-1}^{1} I_{\\text{dev}}(\\xi,\\eta) d\\xi d\\eta = \\frac{\\mu}{32} \\int_{-1}^{1}\\int_{-1}^{1} \\left[ (1-\\xi)^2 + (1-\\eta)^2 \\right] d\\xi d\\eta\n$$\nWe use the fact that $\\int_{-1}^{1} (1-t)^2 dt = \\left[-\\frac{(1-t)^3}{3}\\right]_{-1}^{1} = 0 - (-\\frac{8}{3}) = \\frac{8}{3}$.\n$$\nE_{\\text{dev}} = \\frac{\\mu}{32} \\left[ \\left(\\frac{8}{3}\\right) \\cdot \\int_{-1}^1 d\\eta + \\left(\\frac{8}{3}\\right) \\cdot \\int_{-1}^1 d\\xi \\right] = \\frac{\\mu}{32} \\left[ \\frac{8}{3} \\cdot 2 + \\frac{8}{3} \\cdot 2 \\right] = \\frac{\\mu}{32} \\left(\\frac{32}{3}\\right) = \\frac{\\mu}{3}\n$$\nThe volumetric energy under full integration is:\n$$\nE_{\\text{vol,full}} = \\int_{-1}^{1}\\int_{-1}^{1} I_{\\text{vol}}(\\xi,\\eta) d\\xi d\\eta = \\frac{\\kappa}{32} \\int_{-1}^{1}\\int_{-1}^{1} (1-\\eta)^2 d\\xi d\\eta = \\frac{\\kappa}{32} \\left(\\frac{8}{3}\\right) \\cdot 2 = \\frac{\\kappa}{32} \\left(\\frac{16}{3}\\right) = \\frac{\\kappa}{6}\n$$\nTherefore, the total energy with full integration is:\n$$\nE_{\\text{full}} = E_{\\text{dev}} + E_{\\text{vol,full}} = \\frac{\\mu}{3} + \\frac{\\kappa}{6} = \\frac{2\\mu+\\kappa}{6}\n$$\nNow we compute the energy using selective integration, $E_{\\text{sel}}$. The deviatoric part uses full $2 \\times 2$ quadrature, so $E_{\\text{sel,dev}} = E_{\\text{dev}} = \\frac{\\mu}{3}$. The volumetric part uses reduced $1 \\times 1$ quadrature (point $(\\xi,\\eta)=(0,0)$, weight $w=4$).\n$$\nE_{\\text{sel,vol}} = w \\cdot I_{\\text{vol}}(0,0) = 4 \\cdot \\left[ \\frac{\\kappa}{32}(1-0)^2 \\right] = \\frac{4\\kappa}{32} = \\frac{\\kappa}{8}\n$$\nThe total energy with selective integration is:\n$$\nE_{\\text{sel}} = E_{\\text{sel,dev}} + E_{\\text{sel,vol}} = \\frac{\\mu}{3} + \\frac{\\kappa}{8} = \\frac{8\\mu+3\\kappa}{24}\n$$\nFinally, we compute the ratio $r = E_{\\text{sel}} / E_{\\text{full}}$.\n$$\nr = \\frac{\\frac{8\\mu+3\\kappa}{24}}{\\frac{2\\mu+\\kappa}{6}} = \\frac{8\\mu+3\\kappa}{24} \\cdot \\frac{6}{2\\mu+\\kappa} = \\frac{8\\mu+3\\kappa}{4(2\\mu+\\kappa)}\n$$\nThe problem requires the answer in terms of Lamé parameters $\\lambda$ and $\\mu$. We substitute $\\kappa = \\lambda + \\mu$:\n$$\nr = \\frac{8\\mu+3(\\lambda+\\mu)}{4(2\\mu+(\\lambda+\\mu))} = \\frac{8\\mu+3\\lambda+3\\mu}{4(3\\mu+\\lambda)} = \\frac{11\\mu+3\\lambda}{4(3\\mu+\\lambda)}\n$$",
            "answer": "$$\n\\boxed{\\frac{3\\lambda + 11\\mu}{4(\\lambda + 3\\mu)}}\n$$"
        },
        {
            "introduction": "A critical benchmark for any finite element formulation is its ability to exactly reproduce a constant strain state, a property verified by the patch test. Although selective integration is a form of \"variational crime,\" it must not violate this fundamental consistency requirement to ensure convergence. This practice  guides you through an analytical proof, demonstrating that the selectively integrated bilinear element correctly passes the patch test, ensuring its reliability for general analysis.",
            "id": "3439226",
            "problem": "Consider the two-dimensional linear elasticity Partial Differential Equation (PDE) in weak form: find a displacement field $\\boldsymbol{u} \\in \\mathcal{V}$ such that for all virtual displacements $\\boldsymbol{v} \\in \\mathcal{V}$,\n$$\n\\int_{\\Omega} \\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{v}) \\,\\mathrm{d}\\Omega \\;=\\; \\int_{\\Omega} \\boldsymbol{b} \\cdot \\boldsymbol{v} \\,\\mathrm{d}\\Omega \\;+\\; \\int_{\\Gamma_t} \\boldsymbol{t} \\cdot \\boldsymbol{v} \\,\\mathrm{d}\\Gamma,\n$$\nwhere $\\Omega \\subset \\mathbb{R}^2$ is a patch comprised of four quadrilateral elements with affine isoparametric maps, $\\Gamma_t$ is the traction boundary, $\\boldsymbol{b}$ is the body force, $\\boldsymbol{t}$ is the boundary traction, $\\boldsymbol{\\varepsilon}(\\boldsymbol{w}) = \\tfrac{1}{2}(\\nabla \\boldsymbol{w} + \\nabla \\boldsymbol{w}^{\\top})$ is the small-strain tensor, and $\\boldsymbol{\\sigma}(\\boldsymbol{u})$ is the Cauchy stress. Assume a standard linear elastic, isotropic, plane strain constitutive law with Lamé parameters $\\lambda > 0$ and $\\mu > 0$,\n$$\n\\boldsymbol{\\sigma}(\\boldsymbol{u}) \\;=\\; 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) \\;+\\; \\kappa \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\,\\boldsymbol{I},\n$$\nwhere $\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) = \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) - \\tfrac{1}{2}\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\boldsymbol{I}$ in two dimensions, $\\kappa = \\lambda + \\mu$ is the bulk modulus, and $\\boldsymbol{I}$ is the identity tensor. The patch is meshed with $Q_1$ (bilinear) isoparametric elements whose element maps from the reference square $\\widehat{\\Omega}_e = [-1,1]^2$ to the physical element $\\Omega_e$ are affine, i.e., $\\boldsymbol{x} = \\boldsymbol{A}_e \\boldsymbol{\\xi} + \\boldsymbol{b}_e$ with constant $\\boldsymbol{A}_e \\in \\mathbb{R}^{2\\times 2}$ and $\\boldsymbol{b}_e \\in \\mathbb{R}^2$. There are no body forces and no applied tractions, i.e., $\\boldsymbol{b} = \\boldsymbol{0}$ and $\\boldsymbol{t} = \\boldsymbol{0}$, and Dirichlet boundary conditions enforce a known displacement on the outer boundary of the patch.\n\nYou will use the Finite Element Method (FEM) with selective integration: the volumetric term $\\kappa\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\cdot))\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\cdot))$ is evaluated by one-point Gauss quadrature at the element center, while the deviatoric term $2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\cdot):\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\cdot)$ is evaluated by $2\\times 2$ Gauss quadrature.\n\nConstruct a linear displacement field on $\\Omega$ of the form\n$$\n\\boldsymbol{u}(\\boldsymbol{x}) \\;=\\; \\boldsymbol{c} \\;+\\; \\boldsymbol{G}\\,\\boldsymbol{x},\n$$\nwhere $\\boldsymbol{c} \\in \\mathbb{R}^2$ and $\\boldsymbol{G} \\in \\mathbb{R}^{2\\times 2}$ is constant with symmetric part $\\tfrac{1}{2}(\\boldsymbol{G} + \\boldsymbol{G}^{\\top}) \\neq \\boldsymbol{0}$. Let the virtual displacement be chosen equal to the displacement, i.e., $\\boldsymbol{v} = \\boldsymbol{u}$. Using the above setting, define the exact internal virtual work\n$$\nW_{\\mathrm{exact}} \\;=\\; \\int_{\\Omega} \\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) \\,\\mathrm{d}\\Omega,\n$$\nand the discretely computed internal virtual work with selective integration\n$$\nW_{\\mathrm{SI}} \\;=\\; \\sum_{e} \\left( \\int_{\\Omega_e}^{\\mathrm{SI}} 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}_h) : \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}_h) \\,\\mathrm{d}\\Omega \\;+\\; \\int_{\\Omega_e}^{\\mathrm{SI}} \\kappa\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h))\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h)) \\,\\mathrm{d}\\Omega \\right),\n$$\nwhere $\\boldsymbol{u}_h$ is the $Q_1$ finite element interpolant that equals the prescribed boundary displacement at the patch boundary and uses nodal interpolation on each element, the superscript $\\mathrm{SI}$ indicates the selective quadrature rules stated above, and the sum runs over the four elements of the patch. The mesh being affine means that each element map is affine (constant Jacobian and metric).\n\nCompute the scalar ratio\n$$\nQ \\;=\\; \\frac{W_{\\mathrm{SI}}}{W_{\\mathrm{exact}}},\n$$\nand provide its value. Express the final answer as a pure number without units. No rounding is required.",
            "solution": "The user wants to find the ratio $Q = W_{\\mathrm{SI}} / W_{\\mathrm{exact}}$, where $W_{\\mathrm{exact}}$ is the exact internal virtual work for a given displacement field and $W_{\\mathrm{SI}}$ is the same quantity computed numerically using a Finite Element Method with selective integration.\n\nFirst, let's analyze the exact internal virtual work, $W_{\\mathrm{exact}}$. The problem specifies the virtual displacement to be equal to the displacement, $\\boldsymbol{v} = \\boldsymbol{u}$. The internal virtual work is therefore the strain energy stored in the body, which is given by:\n$$\nW_{\\mathrm{exact}} = \\int_{\\Omega} \\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) \\,\\mathrm{d}\\Omega\n$$\nThe displacement field is given as a linear function of position $\\boldsymbol{x}$:\n$$\n\\boldsymbol{u}(\\boldsymbol{x}) = \\boldsymbol{c} + \\boldsymbol{G}\\,\\boldsymbol{x}\n$$\nwhere $\\boldsymbol{c}$ is a constant vector and $\\boldsymbol{G}$ is a constant matrix.\nThe gradient of the displacement field is $\\nabla \\boldsymbol{u} = \\boldsymbol{G}$.\nThe small-strain tensor $\\boldsymbol{\\varepsilon}(\\boldsymbol{u})$ is the symmetric part of the displacement gradient:\n$$\n\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\frac{1}{2}(\\nabla \\boldsymbol{u} + (\\nabla \\boldsymbol{u})^{\\top}) = \\frac{1}{2}(\\boldsymbol{G} + \\boldsymbol{G}^{\\top})\n$$\nSince $\\boldsymbol{G}$ is a constant matrix, the strain tensor $\\boldsymbol{\\varepsilon}(\\boldsymbol{u})$ is a constant tensor over the entire domain $\\Omega$. Let's denote this constant strain tensor as $\\boldsymbol{E}$. The problem states that $\\boldsymbol{E} \\neq \\boldsymbol{0}$.\n\nThe integrand $\\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})$ can be expressed in terms of the strain $\\boldsymbol{\\varepsilon}$. The constitutive law is given as $\\boldsymbol{\\sigma}(\\boldsymbol{u}) = 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) + \\kappa \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\,\\boldsymbol{I}$. We compute the inner product:\n$$\n\\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\left( 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) + \\kappa \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\,\\boldsymbol{I} \\right) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\n$$\nWe can decompose the strain tensor $\\boldsymbol{\\varepsilon}(\\boldsymbol{u})$ into its deviatoric and spherical (volumetric) parts. In $2$D, this is $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) + \\frac{1}{2}\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\boldsymbol{I}$. The deviatoric part is traceless, i.e., $\\mathrm{tr}(\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}))=0$, which implies $\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}):\\boldsymbol{I}=0$.\nUsing this property, the inner product simplifies:\n$$\n\\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) : \\left(\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) + \\frac{1}{2}\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\boldsymbol{I}\\right) + \\kappa \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\,\\boldsymbol{I} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\n$$\n$$\n\\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) + \\mu\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u})) (\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}):\\boldsymbol{I}) + \\kappa \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\n$$\nSince $\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}):\\boldsymbol{I} = 0$, the middle term vanishes. The integrand is:\n$$\n\\boldsymbol{\\sigma}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}) + \\kappa\\,(\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u})))^2\n$$\nSince $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\boldsymbol{E}$ is a constant tensor, the entire integrand is a constant value, let's call it $C$.\n$$\nC = 2\\mu\\,\\boldsymbol{E}_{\\mathrm{dev}} : \\boldsymbol{E}_{\\mathrm{dev}} + \\kappa\\,(\\mathrm{tr}(\\boldsymbol{E}))^2\n$$\nwhere $\\boldsymbol{E}_{\\mathrm{dev}} = \\boldsymbol{E} - \\frac{1}{2}\\mathrm{tr}(\\boldsymbol{E})\\boldsymbol{I}$.\nThe exact internal work is the integral of this constant $C$ over the domain $\\Omega$:\n$$\nW_{\\mathrm{exact}} = \\int_{\\Omega} C \\,\\mathrm{d}\\Omega = C \\cdot \\mathrm{Area}(\\Omega)\n$$\n\nNext, let's analyze the numerically computed internal work, $W_{\\mathrm{SI}}$. It is calculated as a sum over the four elements of the mesh:\n$$\nW_{\\mathrm{SI}} = \\sum_{e} \\left( \\int_{\\Omega_e}^{\\mathrm{SI}} 2\\mu\\,\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}_h) : \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}(\\boldsymbol{u}_h) \\,\\mathrm{d}\\Omega + \\int_{\\Omega_e}^{\\mathrm{SI}} \\kappa\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h))^2 \\,\\mathrm{d}\\Omega \\right)\n$$\nHere, $\\boldsymbol{u}_h$ is the $Q_1$ (bilinear) finite element interpolant of the exact displacement field $\\boldsymbol{u}$. The problem states that the element maps from the reference square $\\widehat{\\Omega}_e = [-1,1]^2$ to the physical element $\\Omega_e$ are affine. A linear displacement field $\\boldsymbol{u}(\\boldsymbol{x})$ is of the form $\\sum_{i=1}^2 (c_i + G_{ij}x_j)\\boldsymbol{e}_i$. The $Q_1$ finite element space on the reference element is spanned by the basis functions $\\{1, \\xi, \\eta, \\xi\\eta\\}$. A linear function in physical coordinates $\\boldsymbol{x}$ remains linear in reference coordinates $\\boldsymbol{\\xi}$ under an affine map $\\boldsymbol{x}(\\boldsymbol{\\xi})$, as $\\boldsymbol{u}(\\boldsymbol{\\xi}) = \\boldsymbol{c} + \\boldsymbol{G}(\\boldsymbol{A}_e\\boldsymbol{\\xi} + \\boldsymbol{b}_e)$, which is linear in $\\boldsymbol{\\xi}$. The space of linear functions in $\\boldsymbol{\\xi}$ is a subspace of the $Q_1$ space. Therefore, the nodal interpolant $\\boldsymbol{u}_h$ of a linear function $\\boldsymbol{u}$ is identical to the function itself, i.e., $\\boldsymbol{u}_h(\\boldsymbol{x}) = \\boldsymbol{u}(\\boldsymbol{x})$ for all $\\boldsymbol{x} \\in \\Omega$.\n\nThis implies that the strain tensor computed from the finite element solution, $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h)$, is identical to the exact strain tensor $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\boldsymbol{E}$.\n$$\n\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h) = \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\boldsymbol{E}\n$$\nConsequently, the integrands in the expression for $W_{\\mathrm{SI}}$ are constant over each element. The deviatoric integrand is $2\\mu\\,\\boldsymbol{E}_{\\mathrm{dev}} : \\boldsymbol{E}_{\\mathrm{dev}}$, and the volumetric integrand is $\\kappa\\,(\\mathrm{tr}(\\boldsymbol{E}))^2$.\n\nThe selective integration scheme uses a $2\\times 2$ Gauss quadrature for the deviatoric term and a $1$-point Gauss quadrature for the volumetric term. Let's analyze the accuracy of these rules for integrating a constant function $f(\\boldsymbol{x}) = K$ over an element $\\Omega_e$.\nA numerical quadrature rule approximates an integral as $\\int_{\\Omega_e} f(\\boldsymbol{x}) \\,\\mathrm{d}\\Omega \\approx \\sum_{i} w_i^{\\text{phys}} f(\\boldsymbol{x}_i)$. For isoparametric elements, this is $\\int_{\\widehat{\\Omega}_e} f(\\boldsymbol{x}(\\boldsymbol{\\xi})) |J(\\boldsymbol{\\xi})| \\,\\mathrm{d}\\boldsymbol{\\xi} \\approx \\sum_{i} w_i f(\\boldsymbol{x}(\\boldsymbol{\\xi}_i))|J(\\boldsymbol{\\xi}_i)|$.\nFor an affine map, the Jacobian determinant $|J|$ is constant. Let it be $|J_e|$.\nThe integral of a constant $K$ is:\nExact integral: $\\int_{\\Omega_e} K \\,\\mathrm{d}\\Omega = K \\cdot \\mathrm{Area}(\\Omega_e) = K \\cdot |J_e| \\cdot \\mathrm{Area}(\\widehat{\\Omega}_e) = K \\cdot |J_e| \\cdot 4$.\nNumerical integral: $\\sum_{i} w_i K |J_e| = K |J_e| \\sum_i w_i$.\nFor any Gauss quadrature rule on $[-1,1]^2$, the sum of the weights $\\sum_i w_i$ is equal to the area of the reference domain, which is $4$.\nThis means that any Gauss quadrature rule (including $1$-point and $2\\times 2$ rules) will integrate a constant function exactly over an element with an affine map.\n\nSince both integrands are constant, both the $1$-point and $2\\times 2$ Gauss quadrature schemes yield the exact value of the integral for each term over each element.\nFor each element $e$:\n$$\n\\int_{\\Omega_e}^{\\mathrm{SI:2x2}} 2\\mu\\,\\boldsymbol{E}_{\\mathrm{dev}} : \\boldsymbol{E}_{\\mathrm{dev}} \\,\\mathrm{d}\\Omega = (2\\mu\\,\\boldsymbol{E}_{\\mathrm{dev}} : \\boldsymbol{E}_{\\mathrm{dev}}) \\cdot \\mathrm{Area}(\\Omega_e)\n$$\n$$\n\\int_{\\Omega_e}^{\\mathrm{SI:1x1}} \\kappa\\,(\\mathrm{tr}(\\boldsymbol{E}))^2 \\,\\mathrm{d}\\Omega = \\kappa\\,(\\mathrm{tr}(\\boldsymbol{E}))^2 \\cdot \\mathrm{Area}(\\Omega_e)\n$$\nSumming these gives the contribution from element $e$:\n$$\nW_{e, \\mathrm{SI}} = \\left( 2\\mu\\,\\boldsymbol{E}_{\\mathrm{dev}} : \\boldsymbol{E}_{\\mathrm{dev}} + \\kappa\\,(\\mathrm{tr}(\\boldsymbol{E}))^2 \\right) \\cdot \\mathrm{Area}(\\Omega_e) = C \\cdot \\mathrm{Area}(\\Omega_e)\n$$\nThe total numerically computed work $W_{\\mathrm{SI}}$ is the sum over all elements:\n$$\nW_{\\mathrm{SI}} = \\sum_e W_{e, \\mathrm{SI}} = \\sum_e C \\cdot \\mathrm{Area}(\\Omega_e) = C \\cdot \\sum_e \\mathrm{Area}(\\Omega_e)\n$$\nSince the elements form a partition of the domain $\\Omega$, $\\sum_e \\mathrm{Area}(\\Omega_e) = \\mathrm{Area}(\\Omega)$.\nTherefore,\n$$\nW_{\\mathrm{SI}} = C \\cdot \\mathrm{Area}(\\Omega)\n$$\nWe have found that $W_{\\mathrm{SI}} = W_{\\mathrm{exact}}$. The condition $\\frac{1}{2}(\\boldsymbol{G} + \\boldsymbol{G}^{\\top}) \\neq \\boldsymbol{0}$ ensures that $\\boldsymbol{E} \\neq \\boldsymbol{0}$. Since $\\mu>0$ and $\\kappa>0$, $W_{\\mathrm{exact}}$ is the integral of a non-negative quantity and will be non-zero unless $\\boldsymbol{E}_{\\mathrm{dev}}=\\boldsymbol{0}$ and $\\mathrm{tr}(\\boldsymbol{E})=0$, which would imply $\\boldsymbol{E}=\\boldsymbol{0}$, a case excluded by the problem statement. Thus, $W_{\\mathrm{exact}} \\neq 0$ and the ratio is well-defined.\n\nThe desired ratio is:\n$$\nQ = \\frac{W_{\\mathrm{SI}}}{W_{\\mathrm{exact}}} = \\frac{C \\cdot \\mathrm{Area}(\\Omega)}{C \\cdot \\mathrm{Area}(\\Omega)} = 1\n$$\nThe use of selective integration has no effect in this specific case because the strain field is constant, which makes the integrands constant. Any standard quadrature rule would have produced the exact result. The problem beautifully illustrates the conditions under which numerical integration is exact in FEM.",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "The primary motivation for using selective integration is to combat numerical pathologies like volumetric locking in nearly incompressible materials. This computational exercise  brings the concept to life by having you implement and compare full and selective integration schemes for a problem with a known analytical solution. You will quantify the dramatic improvement in displacement accuracy achieved by mitigating locking and also observe the trade-offs by analyzing the error in the volumetric strain.",
            "id": "3439252",
            "problem": "Consider two-dimensional, static, small-strain, homogeneous, isotropic linear elasticity on the unit square domain $\\Omega = [0,1] \\times [0,1]$ with Lamé parameters $(\\lambda,\\mu)$ in plane strain. Let the displacement field be $u: \\Omega \\to \\mathbb{R}^2$, with components $u_1$ and $u_2$. The governing equations are the equilibrium law $-\\nabla \\cdot \\sigma = f$ and the constitutive relation $\\sigma = 2\\mu\\,\\nabla^s u + \\lambda\\,(\\nabla \\cdot u)\\,I$, where $\\nabla^s u = \\tfrac{1}{2}(\\nabla u + \\nabla u^\\top)$ is the symmetric gradient. Consider the weak form in the standard Sobolev space where $u$ is constrained by Dirichlet boundary conditions on the entire boundary $\\partial\\Omega$.\n\nTo study the numerical effects of reduced integration and selective integration in the nearly incompressible regime, use the Finite Element Method (FEM) with bilinear (four-node) quadrilateral elements ($Q_1$) on a structured grid of the unit square. Employ a manufactured solution for the displacement field,\n$$\nu_{\\text{exact}}(x,y) = \\begin{bmatrix}\n\\sin(\\pi x)\\sin(\\pi y) \\\\\n\\sin(\\pi x)\\sin(\\pi y)\n\\end{bmatrix},\n$$\nand enforce Dirichlet boundary conditions $u = u_{\\text{exact}}$ on $\\partial\\Omega$. Derive the corresponding body force $f$ consistent with the partial differential equation so that $u_{\\text{exact}}$ is an exact solution of the strong form. Assemble and solve the discrete linear systems for two formulations:\n- Full integration: integrate both the deviatoric term $\\int_{\\Omega} 2\\mu\\,\\nabla^s u : \\nabla^s v\\,\\mathrm{d}\\Omega$ and the volumetric term $\\int_{\\Omega} \\lambda\\,(\\nabla \\cdot u)(\\nabla \\cdot v)\\,\\mathrm{d}\\Omega$ using the $2\\times 2$ Gaussian quadrature on the reference square.\n- Selective integration: integrate the deviatoric term using the $2\\times 2$ Gaussian quadrature but integrate the volumetric term using a $1$-point Gaussian quadrature at the element center on the reference square.\n\nStarting from the weak form derived from the equilibrium law and constitutive relation, construct the discrete system using the bilinear shape functions and standard isoparametric mapping. For both formulations, compute the numerical solution $u_h$ and quantify:\n1. The displacement $L^2$-norm error,\n$$\nE_u = \\left( \\int_{\\Omega} \\|u_h - u_{\\text{exact}}\\|^2 \\,\\mathrm{d}\\Omega \\right)^{1/2}.\n$$\n2. The volumetric $L^2$-norm error,\n$$\nE_{\\nabla\\cdot u} = \\left( \\int_{\\Omega} \\left( \\nabla \\cdot u_h - \\nabla \\cdot u_{\\text{exact}} \\right)^2 \\,\\mathrm{d}\\Omega \\right)^{1/2}.\n$$\n\nUse the $2\\times 2$ Gaussian quadrature to evaluate these errors. Define the locking mitigation factor as the ratio $R_{\\text{lock}} = E_u^{\\text{full}} / E_u^{\\text{sel}}$; values greater than $1$ indicate that selective integration reduces the displacement error relative to full integration (mitigates locking). Define the volumetric error factor as $R_{\\text{vol}} = E_{\\nabla\\cdot u}^{\\text{sel}} / E_{\\nabla\\cdot u}^{\\text{full}}$; values greater than $1$ indicate that selective integration increases the volumetric error relative to full integration.\n\nYour program must:\n- Derive and implement the body force $f$ consistent with $u_{\\text{exact}}$ using the strong form $-\\nabla\\cdot\\sigma=f$ with $\\sigma = 2\\mu\\,\\nabla^s u + \\lambda(\\nabla\\cdot u) I$.\n- Assemble the stiffness matrices for both full and selective integration schemes exactly as described.\n- Assemble the load vector using the $2\\times 2$ Gaussian quadrature.\n- Enforce Dirichlet boundary conditions $u=u_{\\text{exact}}$ on $\\partial\\Omega$.\n- Solve both discrete systems and compute $E_u$ and $E_{\\nabla\\cdot u}$ for each.\n\nTest suite:\nProvide four test cases as tuples $(N_x,N_y,\\lambda,\\mu)$, where $N_x$ and $N_y$ are the number of elements in the $x$ and $y$ directions:\n1. $(8,8,1,1)$: compressible baseline.\n2. $(8,8,10^3,1)$: moderately nearly incompressible.\n3. $(8,8,10^6,1)$: strongly nearly incompressible.\n4. $(4,4,10^6,1)$: coarse mesh under strong near-incompressibility.\n\nFor each test case, compute and return the list\n$$\n\\left[ E_u^{\\text{full}},\\, E_u^{\\text{sel}},\\, R_{\\text{lock}},\\, E_{\\nabla\\cdot u}^{\\text{full}},\\, E_{\\nabla\\cdot u}^{\\text{sel}},\\, R_{\\text{vol}} \\right].\n$$\n\nFinal output format:\nYour program should produce a single line of output containing the results for all test cases as a comma-separated list of lists enclosed in square brackets, for example, \n$[ [\\text{case1\\_results}], [\\text{case2\\_results}], [\\text{case3\\_results}], [\\text{case4\\_results}] ]$.\nNo physical units are involved in this problem. Angles, if any appear, must be measured in radians. All numerical answers must be floats.",
            "solution": "The user-provided problem is validated as scientifically grounded, well-posed, and objective. It is a standard verification problem in computational solid mechanics designed to analyze volumetric locking in the Finite Element Method (FEM) and the efficacy of selective integration as a remedy. The solution proceeds as follows.\n\n### 1. Governing Equations and Weak Form\nThe problem concerns two-dimensional, static, linear elasticity on the unit square domain $\\Omega = [0,1] \\times [0,1]$. The governing equations consist of the equilibrium law and the constitutive relation for a homogeneous, isotropic material under plane strain conditions:\n$$-\\nabla \\cdot \\sigma = f \\quad \\text{in } \\Omega$$\n$$\\sigma = 2\\mu\\,\\nabla^s u + \\lambda\\,(\\nabla \\cdot u)\\,I$$\nwhere $u$ is the displacement field, $f$ is the body force per unit volume, $\\sigma$ is the Cauchy stress tensor, $\\lambda$ and $\\mu$ are the Lamé parameters, $\\nabla^s u = \\frac{1}{2}(\\nabla u + (\\nabla u)^T)$ is the symmetric gradient (engineering strain tensor), and $I$ is the identity tensor.\n\nThe weak form is derived by multiplying the equilibrium equation by a vector-valued test function $v$ (from a suitable function space where $v=0$ on the Dirichlet boundary) and integrating over $\\Omega$. Applying integration by parts (Green's identity) and substituting the constitutive relation yields the bilinear form $a(u,v)$ and linear form $L(v)$:\n$$a(u,v) = \\int_{\\Omega} \\sigma(u) : \\nabla^s v \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\left( 2\\mu\\,\\nabla^s u : \\nabla^s v + \\lambda\\,(\\nabla \\cdot u)(\\nabla \\cdot v) \\right) \\mathrm{d}\\Omega$$\n$$L(v) = \\int_{\\Omega} f \\cdot v \\, \\mathrm{d}\\Omega$$\nThe task is to find the trial function $u$ satisfying the Dirichlet boundary conditions such that $a(u,v) = L(v)$ for all admissible test functions $v$. The bilinear form $a(u,v)$ is naturally decomposed into a deviatoric part (related to shape change at constant volume) and a volumetric part (related to volume change):\n$$a_{dev}(u,v) = \\int_{\\Omega} 2\\mu\\,\\nabla^s u : \\nabla^s v \\,\\mathrm{d}\\Omega$$\n$$a_{vol}(u,v) = \\int_{\\Omega} \\lambda\\,(\\nabla \\cdot u)(\\nabla \\cdot v)\\,\\mathrm{d}\\Omega$$\n\n### 2. Body Force Derivation\nA manufactured solution $u_{\\text{exact}}(x,y) = [\\sin(\\pi x)\\sin(\\pi y), \\sin(\\pi x)\\sin(\\pi y)]^T$ is used for verification. The corresponding body force $f$ is derived by inserting $u_{\\text{exact}}$ into the strong form of the equilibrium equation, $f = -\\nabla \\cdot \\sigma(u_{\\text{exact}})$.\n\nFirst, we compute the gradient and divergence of $u_{\\text{exact}}$:\n$$\\nabla u_{\\text{exact}} = \\pi \\begin{bmatrix} \\cos(\\pi x)\\sin(\\pi y) & \\sin(\\pi x)\\cos(\\pi y) \\\\ \\cos(\\pi x)\\sin(\\pi y) & \\sin(\\pi x)\\cos(\\pi y) \\end{bmatrix}$$\n$$\\nabla \\cdot u_{\\text{exact}} = \\pi\\cos(\\pi x)\\sin(\\pi y) + \\pi\\sin(\\pi x)\\cos(\\pi y) = \\pi\\sin(\\pi(x+y))$$\nThe stress tensor components are then:\n$$\\sigma_{11} = 2\\mu (\\nabla^s u)_{11} + \\lambda (\\nabla \\cdot u) = 2\\mu \\frac{\\partial u_1}{\\partial x} + \\lambda (\\nabla \\cdot u) = 2\\mu\\pi\\cos(\\pi x)\\sin(\\pi y) + \\lambda\\pi\\sin(\\pi(x+y)) $$\n$$ \\sigma_{22} = 2\\mu (\\nabla^s u)_{22} + \\lambda (\\nabla \\cdot u) = 2\\mu \\frac{\\partial u_2}{\\partial y} + \\lambda (\\nabla \\cdot u) = 2\\mu\\pi\\sin(\\pi x)\\cos(\\pi y) + \\lambda\\pi\\sin(\\pi(x+y)) $$\n$$ \\sigma_{12} = 2\\mu (\\nabla^s u)_{12} = \\mu \\left( \\frac{\\partial u_1}{\\partial y} + \\frac{\\partial u_2}{\\partial x} \\right) = \\mu\\pi(\\sin(\\pi x)\\cos(\\pi y) + \\cos(\\pi x)\\sin(\\pi y)) = \\mu\\pi\\sin(\\pi(x+y))$$\nFinally, taking the negative divergence of the stress tensor $\\sigma$:\n$$f_1 = -(\\frac{\\partial\\sigma_{11}}{\\partial x} + \\frac{\\partial\\sigma_{12}}{\\partial y}) = 2\\mu\\pi^2\\sin(\\pi x)\\sin(\\pi y) - (\\lambda+\\mu)\\pi^2\\cos(\\pi(x+y))$$\n$$f_2 = -(\\frac{\\partial\\sigma_{21}}{\\partial x} + \\frac{\\partial\\sigma_{22}}{\\partial y}) = 2\\mu\\pi^2\\sin(\\pi x)\\sin(\\pi y) - (\\lambda+\\mu)\\pi^2\\cos(\\pi(x+y))$$\nThe body force is $f = [f_1, f_2]^T$.\n\n### 3. Finite Element Discretization\nThe domain $\\Omega$ is discretized into a structured mesh of $N_x \\times N_y$ bilinear quadrilateral ($Q_1$) elements. Within each element, the displacement field is approximated as $u_h(x,y) = \\sum_{a=1}^{4} N_a(\\xi,\\eta) d_a$, where $d_a$ is the nodal displacement vector at node $a$, and $N_a$ are the bilinear shape functions on the reference square $[-1,1] \\times [-1,1]$.\n\nThe discrete system of equations is $Kd=F$, where $K$ is the global stiffness matrix, $F$ is the global force vector, and $d$ is the vector of all nodal displacements. The element stiffness matrix $K^e$ and force vector $F^e$ are computed via numerical integration (Gaussian quadrature) over the element domain $\\Omega_e$:\n$$K^e_{ij} = a(v_j, v_i)|_{\\Omega_e}, \\quad F^e_i = L(v_i)|_{\\Omega_e}$$\nwhere $v_i$ are the basis functions associated with the element's degrees of freedom. Using Voigt notation for strains $\\varepsilon = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$, the element stiffness matrix can be written as $K^e = \\int_{\\Omega_e} B^T D B \\, \\mathrm{d}\\Omega$, where $B$ is the standard strain-displacement matrix and $D$ is the constitutive matrix for plane strain.\n\nThe key to this problem lies in the integration scheme for $K^e$. The stiffness matrix is additively decomposed, $K^e = K^e_{dev} + K^e_{vol}$, corresponding to the deviatoric and volumetric parts of the weak form.\n- $K^e_{dev}$ arises from $a_{dev}(u,v)$ and is integrated using $2\\mu \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1/2 \\end{pmatrix}$ as the deviatoric part of the constitutive matrix.\n- $K^e_{vol}$ arises from $a_{vol}(u,v)$ and is integrated from $\\lambda \\begin{pmatrix} 1 & 1 & 0 \\\\ 1 & 1 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}$ as the volumetric part.\n\nTwo integration schemes are implemented:\n1.  **Full Integration**: Both $K^e_{dev}$ and $K^e_{vol}$ are computed by numerically integrating their respective integrands using a $2 \\times 2$ Gaussian quadrature rule on the reference element.\n2.  **Selective Integration**: $K^e_{dev}$ is computed using $2 \\times 2$ Gaussian quadrature, but $K^e_{vol}$ is computed using a single-point ($1 \\times 1$) Gaussian quadrature at the element center $(\\xi=0, \\eta=0)$. This under-integration of the volumetric term is a standard technique to alleviate volumetric locking in nearly incompressible materials ($\\lambda \\gg \\mu$).\n\nThe load vector $F$ is assembled using a $2 \\times 2$ Gaussian quadrature for all cases.\n\n### 4. System Solution and Error Computation\nDirichlet boundary conditions $u_h = u_{\\text{exact}}$ are enforced for all nodes on the boundary $\\partial\\Omega$. The global system $Kd=F$ is partitioned into interior and boundary degrees of freedom. The system is modified to solve for the unknown interior displacements, after which the full solution vector is reconstructed.\n\nWith the numerical solution $u_h$ obtained for both integration schemes, the following errors are computed using a $2 \\times 2$ Gaussian quadrature:\n-   Displacement $L^2$-norm error: $E_u = \\left( \\sum_e \\int_{\\Omega_e} \\|u_h - u_{\\text{exact}}\\|^2 \\,\\mathrm{d}\\Omega \\right)^{1/2}$\n-   Volumetric $L^2$-norm error: $E_{\\nabla\\cdot u} = \\left( \\sum_e \\int_{\\Omega_e} \\left( \\nabla \\cdot u_h - \\nabla \\cdot u_{\\text{exact}} \\right)^2 \\,\\mathrm{d}\\Omega \\right)^{1/2}$\n\nFinally, the locking mitigation factor $R_{\\text{lock}} = E_u^{\\text{full}} / E_u^{\\text{sel}}$ and the volumetric error factor $R_{\\text{vol}} = E_{\\nabla\\cdot u}^{\\text{sel}} / E_{\\nabla\\cdot u}^{\\text{full}}$ are calculated to quantify the performance of selective integration.",
            "answer": "```python\nimport numpy as np\nimport scipy.linalg\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified FEM problem for all test cases.\n    \"\"\"\n    # Test cases: (Nx, Ny, lambda, mu)\n    test_cases = [\n        (8, 8, 1.0, 1.0),\n        (8, 8, 1e3, 1.0),\n        (8, 8, 1e6, 1.0),\n        (4, 4, 1e6, 1.0)\n    ]\n\n    # Gauss quadrature points and weights\n    # 2x2 Gauss quadrature\n    gp_2x2_coords = np.array([-1.0/np.sqrt(3.0), 1.0/np.sqrt(3.0)])\n    gp_2x2_weights = np.array([1.0, 1.0])\n\n    # 1-point Gauss quadrature (at center)\n    gp_1x1_coords = np.array([0.0])\n    gp_1x1_weights = np.array([2.0])\n\n    def shape_functions_quad4(xi, eta):\n        \"\"\"\n        Computes shape functions and their derivatives for a 4-node quad element.\n        N: shape function values (4,)\n        dNdxi_eta: derivatives w.r.t. xi, eta (2, 4)\n        \"\"\"\n        N = 0.25 * np.array([\n            (1.0 - xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 + eta),\n            (1.0 - xi) * (1.0 + eta)\n        ])\n        \n        dNdxi_eta = 0.25 * np.array([\n            [-(1.0 - eta), (1.0 - eta), (1.0 + eta), -(1.0 + eta)],  # d/dxi\n            [-(1.0 - xi), -(1.0 + xi), (1.0 + xi), (1.0 - xi)]   # d/deta\n        ])\n        \n        return N, dNdxi_eta\n\n    def get_b_matrix_and_jacobian_det(dNdxi_eta, el_nodes_coords):\n        \"\"\"\n        Computes the Jacobian, its determinant, and the B matrix.\n        \"\"\"\n        J = dNdxi_eta @ el_nodes_coords # Jacobian matrix (2, 2)\n        detJ = np.linalg.det(J)\n        \n        if detJ = 0.0:\n            raise ValueError(\"Jacobian determinant is non-positive.\")\n        \n        J_inv = np.linalg.inv(J)\n        dNdx_dy = J_inv @ dNdxi_eta # (2, 4)\n        \n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2*i] = dNdx_dy[0, i]\n            B[1, 2*i+1] = dNdx_dy[1, i]\n            B[2, 2*i] = dNdx_dy[1, i]\n            B[2, 2*i+1] = dNdx_dy[0, i]\n            \n        return B, detJ\n\n    def u_exact(x, y):\n        val = np.sin(np.pi * x) * np.sin(np.pi * y)\n        return np.array([val, val])\n\n    def div_u_exact(x, y):\n        return np.pi * np.sin(np.pi * (x + y))\n\n    def body_force(x, y, lam, mu):\n        pi2 = np.pi**2\n        sxy = np.sin(np.pi * x) * np.sin(np.pi * y)\n        cxy_sum = np.cos(np.pi * (x + y))\n        f_val = 2.0 * mu * pi2 * sxy - (lam + mu) * pi2 * cxy_sum\n        return np.array([f_val, f_val])\n\n    def run_fem_analysis(Nx, Ny, lam, mu):\n        # 1. Mesh Generation\n        num_nodes_x = Nx + 1\n        num_nodes_y = Ny + 1\n        num_nodes = num_nodes_x * num_nodes_y\n        num_elements = Nx * Ny\n        \n        x_coords = np.linspace(0.0, 1.0, num_nodes_x)\n        y_coords = np.linspace(0.0, 1.0, num_nodes_y)\n        \n        nodes = np.array([[x, y] for y in y_coords for x in x_coords])\n        \n        elements = np.zeros((num_elements, 4), dtype=int)\n        for ey in range(Ny):\n            for ex in range(Nx):\n                el_idx = ey * Nx + ex\n                n1 = ey * num_nodes_x + ex             # Bottom-left\n                n2 = ey * num_nodes_x + (ex + 1)       # Bottom-right\n                n3 = (ey + 1) * num_nodes_x + (ex + 1) # Top-right\n                n4 = (ey + 1) * num_nodes_x + ex       # Top-left\n                elements[el_idx] = [n1, n2, n3, n4]\n                \n        # 2. Constitutive Matrices (for integration)\n        D_vol = lam * np.array([[1.0, 1.0, 0.0], [1.0, 1.0, 0.0], [0.0, 0.0, 0.0]])\n        D_dev = 2.0 * mu * np.array([[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 0.5]])\n        \n        # 3. Assembly\n        num_dofs = 2 * num_nodes\n        K_full = np.zeros((num_dofs, num_dofs))\n        K_sel = np.zeros((num_dofs, num_dofs))\n        F = np.zeros(num_dofs)\n        \n        for el_idx in range(num_elements):\n            el_node_indices = elements[el_idx]\n            el_nodes_coords = nodes[el_node_indices]\n            dofs = np.ravel([[2*n, 2*n+1] for n in el_node_indices])\n            \n            Ke_dev = np.zeros((8, 8))\n            Ke_vol_full = np.zeros((8, 8))\n            \n            # 2x2 Quadrature for dev, vol_full and Force\n            for w_eta, eta in zip(gp_2x2_weights, gp_2x2_coords):\n                for w_xi, xi in zip(gp_2x2_weights, gp_2x2_coords):\n                    N, dNdxi_eta = shape_functions_quad4(xi, eta)\n                    B, detJ = get_b_matrix_and_jacobian_det(dNdxi_eta, el_nodes_coords)\n                    weight = w_xi * w_eta * detJ\n                    \n                    Ke_dev += B.T @ D_dev @ B * weight\n                    Ke_vol_full += B.T @ D_vol @ B * weight\n                    \n                    x_gp, y_gp = N @ el_nodes_coords\n                    f_gp = body_force(x_gp, y_gp, lam, mu)\n                    for i in range(4):\n                        F[dofs[2*i]]   += N[i] * f_gp[0] * weight\n                        F[dofs[2*i+1]] += N[i] * f_gp[1] * weight\n            \n            # 1-point Quadrature for vol_sel\n            xi_c, eta_c = gp_1x1_coords[0], gp_1x1_coords[0]\n            w_c = gp_1x1_weights[0] * gp_1x1_weights[0]\n            N_c, dNdxi_eta_c = shape_functions_quad4(xi_c, eta_c)\n            B_c, detJ_c = get_b_matrix_and_jacobian_det(dNdxi_eta_c, el_nodes_coords)\n            Ke_vol_sel = B_c.T @ D_vol @ B_c * (w_c * detJ_c)\n            \n            ix = np.ix_(dofs, dofs)\n            K_full[ix] += Ke_dev + Ke_vol_full\n            K_sel[ix] += Ke_dev + Ke_vol_sel\n\n        # 4. Boundary Conditions\n        b_nodes = set(np.concatenate([\n            np.arange(num_nodes_x), # Bottom\n            np.arange(num_nodes - num_nodes_x, num_nodes), # Top\n            np.arange(0, num_nodes, num_nodes_x), # Left\n            np.arange(num_nodes_x - 1, num_nodes, num_nodes_x) # Right\n        ]))\n        \n        boundary_dofs = np.ravel([[2*n, 2*n+1] for n in sorted(list(b_nodes))])\n        interior_dofs = np.setdiff1d(np.arange(num_dofs), boundary_dofs)\n        \n        d_B = np.array([u_exact(nodes[dof//2, 0], nodes[dof//2, 1])[dof%2] for dof in boundary_dofs])\n        \n        def solve_system(K):\n            K_II = K[np.ix_(interior_dofs, interior_dofs)]\n            K_IB = K[np.ix_(interior_dofs, boundary_dofs)]\n            F_I = F[interior_dofs]\n            F_mod = F_I - K_IB @ d_B\n            d_I = scipy.linalg.solve(K_II, F_mod, assume_a='sym')\n            d = np.zeros(num_dofs)\n            d[interior_dofs] = d_I\n            d[boundary_dofs] = d_B\n            return d\n\n        d_full = solve_system(K_full)\n        d_sel = solve_system(K_sel)\n\n        # 5. Error Calculation\n        def calculate_errors(d_sol):\n            err_u_sq, err_div_u_sq = 0.0, 0.0\n            for el_idx in range(num_elements):\n                el_node_indices, el_nodes_coords = elements[el_idx], nodes[elements[el_idx]]\n                d_elem = d_sol[np.ravel([[2*n, 2*n+1] for n in el_node_indices])]\n                \n                for w_eta, eta in zip(gp_2x2_weights, gp_2x2_coords):\n                    for w_xi, xi in zip(gp_2x2_weights, gp_2x2_coords):\n                        N, dNdxi_eta = shape_functions_quad4(xi, eta)\n                        B, detJ = get_b_matrix_and_jacobian_det(dNdxi_eta, el_nodes_coords)\n                        weight = w_xi * w_eta * detJ\n                        \n                        x_gp, y_gp = N @ el_nodes_coords\n                        u_h_gp = np.array([N @ d_elem[0::2], N @ d_elem[1::2]])\n                        err_u_sq += np.sum((u_h_gp - u_exact(x_gp, y_gp))**2) * weight\n                        \n                        strain_h_gp = B @ d_elem\n                        err_div_u_sq += (strain_h_gp[0] + strain_h_gp[1] - div_u_exact(x_gp, y_gp))**2 * weight\n            return np.sqrt(err_u_sq), np.sqrt(err_div_u_sq)\n\n        Eu_full, Edivu_full = calculate_errors(d_full)\n        Eu_sel, Edivu_sel = calculate_errors(d_sel)\n        \n        R_lock = Eu_full / Eu_sel if Eu_sel > 1e-15 else 0.0\n        R_vol = Edivu_sel / Edivu_full if Edivu_full > 1e-15 else 0.0\n        \n        return [Eu_full, Eu_sel, R_lock, Edivu_full, Edivu_sel, R_vol]\n\n    all_results = [run_fem_analysis(*case) for case in test_cases]\n    \n    # Format the final output string\n    result_str = \"[\" + \", \".join([str(res) for res in all_results]) + \"]\"\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}