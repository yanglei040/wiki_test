{
    "hands_on_practices": [
        {
            "introduction": "理解任何数值方法的第一步，是在简单的模型问题上分析其基本行为。本练习  采用傅里叶分析方法，深入剖析了使用分片线性多项式（$p=1$）的间断伽辽金（DG）格式在求解线性平流方程时的性质。通过推导和比较迎风通量与中心通量的色散与耗散误差，我们可以清晰地看到数值通量的选择对计算结果准确性和稳定性的决定性影响。",
            "id": "3377316",
            "problem": "考虑一维线性平流方程 $\\partial_t u + a \\,\\partial_x u = 0$，其中平流速度 $a0$ 为常数，定义在由大小为 $h$ 的均匀单元构成的周期性域上。使用间断伽辽金（DG）方法，每个单元采用 $p=1$ 次多项式，并在参考单元 $\\xi \\in [-1,1]$ 上使用由 $\\phi_0(\\xi)=1$ 和 $\\phi_1(\\xi)=\\xi$ 定义的模态基，通过 $x=x_j+(h/2)\\,\\xi$ 映射到每个物理单元 $I_j=[x_{j-1/2},x_{j+1/2}]$。通量函数为 $f(u)=a\\,u$。将比较两种数值通量：$a0$ 时的迎风通量和中心通量。周期性边界条件意味着来自相邻单元的值在域的边界处回绕。\n\n从 DG 弱形式出发，通过使用 $v=\\phi_0$ 和 $v=\\phi_1$ 作为测试函数，推导每个单元 $I_j$ 上的半离散系统，并仔细处理所选基和映射下的体项和边界项。将半离散系统表示为 $M\\,\\partial_t \\mathbf{u}_j = \\mathcal{L}_j(\\mathbf{u}_{j-1},\\mathbf{u}_j,\\mathbf{u}_{j+1})$ 的形式，其中 $M$ 是局部质量矩阵，$\\mathbf{u}_j=(u_{j,0},u_{j,1})^\\top$ 是单元 $j$ 中的模态系数。然后应用离散傅里叶（Bloch）拟设 $\\mathbf{u}_j(t)=\\hat{\\mathbf{u}}(t)\\,e^{i k x_j}$，其中 $k$ 是空间波数（单位为弧度/米），以获得一个 $2\\times 2$ 的傅里叶符号矩阵 $A(k)$，使得对于两种通量选择，都有 $\\partial_t \\hat{\\mathbf{u}} = A(k)\\,\\hat{\\mathbf{u}}$。半离散傅里叶符号由 $A(k)$ 的特征值 $\\lambda(k)$ 定义；选择在极限 $k\\to 0$ 时趋近于 $-i\\,a\\,k$ 的特征值作为物理分支。\n\n将色散误差定义为 $E_{\\mathrm{disp}}(k) = \\operatorname{Im}(\\lambda(k))/(-a) - k$（单位为弧度/米），将耗散率定义为 $E_{\\mathrm{diss}}(k) = \\operatorname{Re}(\\lambda(k))$（单位为 1/秒）。实现一个程序，该程序为迎风通量和中心通量构建 $A(k)$，计算它们的特征值，选择物理分支，并评估 $E_{\\mathrm{disp}}(k)$ 和 $E_{\\mathrm{diss}}(k)$。\n\n使用以下测试套件，$a=1.0$ 米/秒，$h=1.0$ 米，波数单位为弧度/米（角度单位为弧度）：\n- $k_1 = 0.0$\n- $k_2 = 0.2\\,\\pi$\n- $k_3 = 0.5\\,\\pi$\n- $k_4 = 0.9\\,\\pi$\n\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果。对于每个测试用例 $k_i$，输出一个包含四个浮点数的列表 $[E_{\\mathrm{disp}}^{\\mathrm{up}}, E_{\\mathrm{diss}}^{\\mathrm{up}}, E_{\\mathrm{disp}}^{\\mathrm{cen}}, E_{\\mathrm{diss}}^{\\mathrm{cen}}]$，其中上标表示通量选择。将四个测试用例的结果汇总到一个列表中。最终要求的格式为\n$[[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2]]$\n所有条目均为浮点数，其中每个方括号组内的条目顺序为：迎风色散误差、迎风耗散率、中心色散误差、中心耗散率。不应打印单位；所有角度必须以弧度处理，色散误差以弧度/米表示，耗散率以 1/秒 表示。",
            "solution": "出发点是一维线性平流方程 $\\partial_t u + a \\,\\partial_x u = 0$，其中速度 $a0$ 为常数。间断伽辽金（DG）方法通过在每个单元 $I_j=[x_{j-1/2},x_{j+1/2}]$ 中使用参考单元 $\\xi \\in [-1,1]$ 上的模态基 $\\phi_0(\\xi)=1$ 和 $\\phi_1(\\xi)=\\xi$ 来近似 $u$，该基通过 $x=x_j+(h/2)\\,\\xi$ 进行映射。单元 $j$ 中的局部近似为 $u_h(x,t) = u_{j,0}(t)\\,\\phi_0(\\xi(x)) + u_{j,1}(t)\\,\\phi_1(\\xi(x))$。对于测试函数 $v$，DG 弱形式为\n$$\n\\int_{I_j} \\partial_t u_h\\, v\\, dx \\;-\\; \\int_{I_j} f(u_h)\\,\\partial_x v\\, dx \\;+\\; \\widehat{f}\\big(u_h^{-},u_h^{+}\\big)\\, v\\big|_{x_{j+1/2}} \\;-\\; \\widehat{f}\\big(u_h^{-},u_h^{+}\\big)\\, v\\big|_{x_{j-1/2}} \\;=\\; 0,\n$$\n其中 $f(u)=a\\,u$，$\\widehat{f}$ 是界面上的数值通量。对于 $p=1$，我们用 $v=\\phi_0$ 和 $v=\\phi_1$ 进行测试。映射的导数为 $\\partial_x v = (2/h)\\,\\partial_\\xi v$，雅可比行列式为 $dx=(h/2)\\,d\\xi$。质量矩阵的项为\n$$\nM_{mn} = \\int_{I_j} \\phi_m \\phi_n\\, dx = \\frac{h}{2}\\int_{-1}^1 \\phi_m(\\xi)\\,\\phi_n(\\xi)\\, d\\xi,\n$$\n这得到 $M=\\mathrm{diag}(h, h/3)$，因为 $\\int_{-1}^1 1\\,d\\xi=2$，$\\int_{-1}^1 \\xi\\,d\\xi=0$ 和 $\\int_{-1}^1 \\xi^2\\,d\\xi=2/3$。\n\n体项包含 $-\\int_{I_j} a\\,u_h\\,\\partial_x v\\,dx$。对于 $v=\\phi_0$，$\\partial_x \\phi_0=0$，所以体项为零。对于 $v=\\phi_1$，$\\partial_x \\phi_1 = 2/h$，因此\n$$\n-\\int_{I_j} a\\,u_h\\,\\partial_x \\phi_1\\,dx \\;=\\; -\\frac{2a}{h}\\int_{I_j} u_h\\,dx \\;=\\; -\\frac{2a}{h}\\frac{h}{2}\\int_{-1}^1 \\big(u_{j,0}\\,\\phi_0(\\xi) + u_{j,1}\\,\\phi_1(\\xi)\\big)\\, d\\xi \\;=\\; -2a\\,u_{j,0},\n$$\n因为 $\\int_{-1}^1 \\phi_1(\\xi)\\,d\\xi=0$。\n\n边界项计算单元端点处的测试函数值。在 $x_{j+1/2}$ 处，外法线方向为 $+1$，且 $\\phi_0(1)=1$，$\\phi_1(1)=1$。在 $x_{j-1/2}$ 处，外法线方向为 $-1$，且 $\\phi_0(-1)=1$，$\\phi_1(-1)=-1$。因此，$v=\\phi_0$ 和 $v=\\phi_1$ 的边界贡献分别为 $\\widehat{f}_{j+1/2} - \\widehat{f}_{j-1/2}$ 和 $\\widehat{f}_{j+1/2} + \\widehat{f}_{j-1/2}$。单元界面上的迹值为：在 $x_{j+1/2}$ 处为 $u_j^{+}=u_{j,0}+u_{j,1}$，在 $x_{j-1/2}$ 处为 $u_j^{-}=u_{j,0}-u_{j,1}$。\n\n对于 $a0$ 的迎风通量，$\\widehat{f}=a\\,u^{-}$，因此 $\\widehat{f}_{j+1/2} = a\\,(u_{j,0}+u_{j,1})$ 且 $\\widehat{f}_{j-1/2} = a\\,(u_{j-1,0}+u_{j-1,1})$。结合所有项，半离散方程变为\n$$\nh\\,\\partial_t u_{j,0} \\;+\\; a\\big[(u_{j,0}+u_{j,1}) - (u_{j-1,0}+u_{j-1,1})\\big] \\;=\\; 0,\n$$\n$$\n\\frac{h}{3}\\,\\partial_t u_{j,1} \\;-\\; 2a\\,u_{j,0} \\;+\\; a\\big[(u_{j,0}+u_{j,1}) + (u_{j-1,0}+u_{j-1,1})\\big] \\;=\\; 0.\n$$\n\n对于中心通量，$\\widehat{f}=\\tfrac{a}{2}\\,(u^{-}+u^{+})$，得到 $\\widehat{f}_{j+1/2} = \\tfrac{a}{2}\\big((u_{j,0}+u_{j,1}) + (u_{j+1,0}-u_{j+1,1})\\big)$ 和 $\\widehat{f}_{j-1/2} = \\tfrac{a}{2}\\big((u_{j-1,0}+u_{j-1,1}) + (u_{j,0}-u_{j,1})\\big)$。半离散方程为\n$$\nh\\,\\partial_t u_{j,0} \\;+\\; \\frac{a}{2}\\Big[\\big(u_{j,0}+u_{j,1}\\big) + \\big(u_{j+1,0}-u_{j+1,1}\\big) - \\big(u_{j-1,0}+u_{j-1,1}\\big) - \\big(u_{j,0}-u_{j,1}\\big)\\Big] \\;=\\; 0,\n$$\n$$\n\\frac{h}{3}\\,\\partial_t u_{j,1} \\;-\\; 2a\\,u_{j,0} \\;+\\; \\frac{a}{2}\\Big[\\big(u_{j,0}+u_{j,1}\\big) + \\big(u_{j+1,0}-u_{j+1,1}\\big) + \\big(u_{j-1,0}+u_{j-1,1}\\big) + \\big(u_{j,0}-u_{j,1}\\big)\\Big] \\;=\\; 0.\n$$\n\n为了获得傅里叶符号，应用 Bloch 拟设 $\\mathbf{u}_j(t)=\\hat{\\mathbf{u}}(t)\\,e^{i k x_j}$，其中 $k$ 是波数，$x_{j\\pm 1}=x_j\\pm h$。于是 $u_{j\\pm1,m}= \\hat{u}_m\\,e^{\\pm i k h}\\,e^{i k x_j}$。提出因子 $e^{i k x_j}$，并将关于 $\\hat{\\mathbf{u}}=(\\hat{u}_0,\\hat{u}_1)^\\top$ 的半离散系统写为 $\\partial_t \\hat{\\mathbf{u}} = A(k)\\,\\hat{\\mathbf{u}}$。对于迎风通量，引入 $z=e^{-i k h}=\\cos(kh)-i\\sin(kh)$，得到\n$$\nA_{\\mathrm{up}}(k) \\;=\\; -\\frac{a}{h}\n\\begin{pmatrix}\n1 - z  1 - z\\\\\n3(z - 1)  3(1 + z)\n\\end{pmatrix}.\n$$\n对于中心通量，使用三角恒等式，得到\n$$\nA_{\\mathrm{cen}}(k) \\;=\\; -\\frac{a}{h}\n\\begin{pmatrix}\ni\\,\\sin(kh)  1 - \\cos(kh)\\\\\n3\\big(\\cos(kh)-1\\big)  -\\,3\\,i\\,\\sin(kh)\n\\end{pmatrix}.\n$$\n半离散傅里叶符号由 $A(k)$ 的特征值 $\\lambda(k)$ 给出。物理分支满足 $\\lambda(k)\\to -i\\,a\\,k$ 当 $k\\to 0$ 时，而第二个分支对应一个大小为 $O(a/h)$ 的伪模。\n\n将色散误差定义为 $E_{\\mathrm{disp}}(k) = \\operatorname{Im}(\\lambda(k))/(-a) - k$，它比较了数值相速度与精确关系 $\\lambda_{\\mathrm{exact}}(k)=-i\\,a\\,k$，并将耗散率定义为 $E_{\\mathrm{diss}}(k) = \\operatorname{Re}(\\lambda(k))$，对于精确的连续平流，该值为零，而对于耗散离散化，该值非零。算法如下：\n1. 对于给定的 $(a,h,k)$，如上构造 $A_{\\mathrm{up}}(k)$ 和 $A_{\\mathrm{cen}}(k)$。\n2. 计算它们的特征值。\n3. 通过在计算出的特征值中最小化 $|\\operatorname{Im}(\\lambda)+a\\,k|$ 来选择物理特征值；如果需要，通过选择模 $|\\lambda|$ 较小的特征值来打破平局。\n4. 计算两种通量的 $E_{\\mathrm{disp}}(k)$ 和 $E_{\\mathrm{diss}}(k)$。\n\n使用 $a=1.0$ 米/秒和 $h=1.0$ 米，以及测试波数 $k_1=0.0$, $k_2=0.2\\,\\pi$, $k_3=0.5\\,\\pi$, $k_4=0.9\\,\\pi$（单位为弧度/米），程序对每个 $k_i$ 生成四个浮点数 $[E_{\\mathrm{disp}}^{\\mathrm{up}}, E_{\\mathrm{diss}}^{\\mathrm{up}}, E_{\\mathrm{disp}}^{\\mathrm{cen}}, E_{\\mathrm{diss}}^{\\mathrm{cen}}]$，并汇总到一个列表中。定性地看，中心通量产生纯虚数特征值，因此对所有 $k$ 都有 $E_{\\mathrm{diss}}^{\\mathrm{cen}}(k)=0$，这反映了半离散设置中的能量守恒，而迎风通量在 $\\lambda(k)$ 中引入了负实部，因此除了 $k=0$ 外，$E_{\\mathrm{diss}}^{\\mathrm{up}}(k)  0$，这反映了数值耗散。两种通量的色散误差量化了随 $kh$ 增加而增加的相位不准确性；物理分支在 $k\\to 0$ 时趋近于精确的 $-i\\,a\\,k$，因此两种通量的 $E_{\\mathrm{disp}}(0)=0$。",
            "answer": "```python\nimport numpy as np\n\ndef A_upwind(a, h, k):\n    \"\"\"\n    Construct the 2x2 Fourier symbol matrix A(k) for P1 DG with upwind flux (a  0).\n    Uses z = exp(-i k h).\n    \"\"\"\n    z = np.exp(-1j * k * h)\n    factor = -a / h\n    A11 = (1 - z)\n    A12 = (1 - z)\n    A21 = 3 * (z - 1)\n    A22 = 3 * (1 + z)\n    A = factor * np.array([[A11, A12],\n                           [A21, A22]], dtype=complex)\n    return A\n\ndef A_central(a, h, k):\n    \"\"\"\n    Construct the 2x2 Fourier symbol matrix A(k) for P1 DG with central flux.\n    Uses trig form with sin(kh) and cos(kh).\n    \"\"\"\n    kh = k * h\n    s = np.sin(kh)\n    c = np.cos(kh)\n    factor = -a / h\n    A11 = 1j * s\n    A12 = (1 - c)\n    A21 = 3 * (c - 1)\n    A22 = -3j * s\n    A = factor * np.array([[A11, A12],\n                           [A21, A22]], dtype=complex)\n    return A\n\ndef physical_branch_eigenvalue(eigs, a, k):\n    \"\"\"\n    Select the physical branch eigenvalue: the one whose imaginary part\n    is closest to -a*k. Break ties by smaller magnitude.\n    \"\"\"\n    target_im = -a * k\n    # Compute closeness and magnitude\n    closeness = [abs(np.imag(lam) - target_im) for lam in eigs]\n    # Find indices sorted by closeness then by magnitude\n    indices = sorted(range(len(eigs)),\n                     key=lambda i: (closeness[i], abs(eigs[i])))\n    return eigs[indices[0]]\n\ndef compute_errors(a, h, k, flux_type):\n    \"\"\"\n    Compute dispersion and dissipation errors for given a, h, k, and flux type.\n    flux_type: 'upwind' or 'central'\n    Returns (E_disp, E_diss).\n    \"\"\"\n    if flux_type == 'upwind':\n        A = A_upwind(a, h, k)\n    elif flux_type == 'central':\n        A = A_central(a, h, k)\n    else:\n        raise ValueError(\"Unknown flux type\")\n    eigs = np.linalg.eigvals(A)\n    lam = physical_branch_eigenvalue(eigs, a, k)\n    \n    # For k=0, a might be 0, handle division by zero\n    if abs(a)  1e-12:\n        E_disp = 0.0\n    else:\n        E_disp = (np.imag(lam) / (-a)) - k  # radians per meter\n\n    E_diss = np.real(lam)               # inverse seconds\n    \n    # For k=0, floating point noise can lead to tiny non-zero results\n    if abs(k)  1e-12:\n        E_disp = 0.0\n        E_diss = 0.0\n\n    return float(E_disp), float(E_diss)\n\ndef solve():\n    # Define parameters\n    a = 1.0  # m/s\n    h = 1.0  # m\n    # Test suite wavenumbers in radians per meter (angles in radians)\n    test_cases = [\n        0.0,\n        0.2 * np.pi,\n        0.5 * np.pi,\n        0.9 * np.pi,\n    ]\n\n    results = []\n    for k in test_cases:\n        disp_up, diss_up = compute_errors(a, h, k, 'upwind')\n        disp_cen, diss_cen = compute_errors(a, h, k, 'central')\n        results.append([disp_up, diss_up, disp_cen, diss_cen])\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists with floats.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在掌握了基本原理之后，下一步是将方法应用于实际的非线性问题。本练习  使用零阶间断伽辽金（DG0，等价于有限体积法）格式来模拟真实的交通流现象。这引入了新的挑战，例如处理非线性通量、模拟复杂的边界条件（如匝道车流汇合），以及追踪相关的物理量（如排队长度），充分展示了DG框架在解决工程问题上的强大能力。",
            "id": "3377321",
            "problem": "考虑单车道链路上的车辆交通流的一维标量双曲守恒律，\n$$\\partial_t \\rho(x,t) + \\partial_x \\big( \\rho(x,t)\\,V(\\rho(x,t)) \\big) = 0,$$\n其中 $\\rho(x,t)$ 是交通密度（单位：辆/公里），$V(\\rho)$ 是速度（单位：公里/秒），通量 $f(\\rho)$ 定义为 $f(\\rho) = \\rho V(\\rho)$（单位：辆/秒）。假设采用 Greenshields 基本图，即\n$$V(\\rho) = V_{\\max}\\left(1 - \\frac{\\rho}{\\rho_{\\max}}\\right),\\qquad f(\\rho) = V_{\\max}\\left(\\rho - \\frac{\\rho^2}{\\rho_{\\max}}\\right),$$\n其中 $V_{\\max}  0$（单位：公里/秒），$\\rho_{\\max}  0$（单位：辆/公里）。设空间域为 $x \\in [0,L]$，$L$ 的单位为公里。位于 $x=0$ 的左边界模拟一个有两条汇入车流的交叉口：上游主线，其特征为外部上游密度 $\\rho_{\\mathrm{up}}$（单位：辆/公里）；以及一个匝道，其提供的外生需求为 $q_{\\mathrm{r}}$（单位：辆/秒）。位于 $x=L$ 的右边界连接到一个外部下游状态，其特征为密度 $\\rho_{\\mathrm{down}}$（单位：辆/公里）。\n\n您的任务是为上述守恒律推导、实现并执行一个零阶（每个单元上为分片常数表示）间断 Galerkin (DG) 方法。您必须从每个单元上的积分弱形式出发，应用分部积分，并通过界面数值通量来封闭半离散系统。对于内部界面，请使用适用于严格凹通量函数的单调 Godunov 通量。对于左边界，请实现一个合流黎曼求解器，该求解器在固定的优先级分配下，结合上游主线需求和匝道需求，并受限于区域边界的供给。对于右边界，请使用 Godunov 通量与外部下游密度。\n\n定义由 Greenshields 模型引出的临界密度和通行能力。将 Godunov 求解器中使用的需求和供给函数纯粹用基本图和这些临界量来表示，并在内部界面和边界处一致地使用它们。匝道队列 $Q(t)$（单位：辆）遵循水库动态模型\n$$\\frac{dQ}{dt} = q_{\\mathrm{r}} - F_{\\mathrm{r}}(t),$$\n其中 $F_{\\mathrm{r}}(t)$ 是由 $x=0$ 处的边界黎曼求解器决定的准入匝道流量（单位：辆/秒）。物理队列长度 $\\ell_{\\mathrm{q}}(t)$（单位：公里）为\n$$\\ell_{\\mathrm{q}}(t) = \\frac{Q(t)}{\\rho_{\\mathrm{j,r}}},$$\n其中 $\\rho_{\\mathrm{j,r}}$ 是匝道拥堵密度（单位：辆/公里）。如果在时间 $t$ 时 $\\ell_{\\mathrm{q}}(t) \\ge L_{\\mathrm{ramp}}$，则称发生队列溢出，其中 $L_{\\mathrm{ramp}}$ 是有限的匝道存储长度（单位：公里）。\n\n在数值上，将 $[0,L]$ 离散为 $N$ 个均匀单元，并使用基于您从 $f'(\\rho)$ 推导出的最大特征速度的 Courant-Friedrichs-Lewy (CFL) 条件来强制执行显式时间积分；使用一个小于 $1$ 的固定 CFL 数。如果需要，将密度裁剪到物理上允许的区间 $[0,\\rho_{\\max}]$ 内。假设初始密度均匀，为 $\\rho(x,0)=\\rho_{\\mathrm{init}}$（单位：辆/公里）。$x=0$ 处的合流优先级由分配给上游主线的固定比例 $p \\in (0,1)$ 指定；匝道获得互补的比例 $(1-p)$，这受限于需求和供给的约束。除了边界合流外，不应包含任何松弛项或额外的源项。\n\n使用以下三个参数集的测试套件，每个都指定了如上所示的一致单位。在所有情况下，速度单位为公里/秒，密度单位为辆/公里，通量单位为辆/秒，长度单位为公里，时间单位为秒，不涉及角度。\n\n- 测试用例 $1$（正常情况，预计无溢出）：\n  - $L = 1.0$, $N = 200$, $T = 200.0$, $\\mathrm{CFL} = 0.9$。\n  - $V_{\\max} = 0.03$, $\\rho_{\\max} = 180.0$, $\\rho_{\\mathrm{init}} = 40.0$。\n  - $\\rho_{\\mathrm{up}} = 60.0$, $\\rho_{\\mathrm{down}} = 40.0$。\n  - $q_{\\mathrm{r}} = 0.10$, $p = 0.70$, $L_{\\mathrm{ramp}} = 0.50$, $\\rho_{\\mathrm{j,r}} = 150.0$。\n\n- 测试用例 $2$（拥堵伴随队列增长，但无溢出）：\n  - $L = 1.0$, $N = 200$, $T = 200.0$, $\\mathrm{CFL} = 0.9$。\n  - $V_{\\max} = 0.03$, $\\rho_{\\max} = 180.0$, $\\rho_{\\mathrm{init}} = 40.0$。\n  - $\\rho_{\\mathrm{up}} = 80.0$, $\\rho_{\\mathrm{down}} = 160.0$。\n  - $q_{\\mathrm{r}} = 0.60$, $p = 0.70$, $L_{\\mathrm{ramp}} = 1.00$, $\\rho_{\\mathrm{j,r}} = 150.0$。\n\n- 测试用例 $3$（拥堵并发生溢出）：\n  - $L = 1.0$, $N = 200$, $T = 200.0$, $\\mathrm{CFL} = 0.9$。\n  - $V_{\\max} = 0.03$, $\\rho_{\\max} = 180.0$, $\\rho_{\\mathrm{init}} = 40.0$。\n  - $\\rho_{\\mathrm{up}} = 80.0$, $\\rho_{\\mathrm{down}} = 160.0$。\n  - $q_{\\mathrm{r}} = 1.20$, $p = 0.70$, $L_{\\mathrm{ramp}} = 0.20$, $\\rho_{\\mathrm{j,r}} = 150.0$。\n\n对于每个测试用例，运行 DG 求解器并确定在 $[0,T]$ 时间内是否发生队列溢出。将溢出结果表示为 $0$（“无溢出”）或 $1$（“发生溢出”）。您的程序应生成一行输出，其中包含三个测试用例的结果，格式为方括号括起来的逗号分隔列表，例如 $[0,1,1]$。您的计算所隐含的所有数值答案均采用上述单位；最终打印的输出是无单位符号的整数。",
            "solution": "该问题要求为一维标量双曲守恒律（即 Lighthill-Whitham-Richards (LWR) 模型）开发并应用一种零阶间断 Galerkin (DG) 方法，该模型用于描述交通流。\n\n控制偏微分方程 (PDE) 是：\n$$\n\\partial_t \\rho(x,t) + \\partial_x f(\\rho(x,t)) = 0\n$$\n其中 $\\rho(x,t)$ 是交通密度，$f(\\rho)$ 是交通通量。空间域为 $x \\in [0,L]$。问题指定了 Greenshields 模型作为基本图：\n$$\nV(\\rho) = V_{\\max}\\left(1 - \\frac{\\rho}{\\rho_{\\max}}\\right)\n$$\n$$\nf(\\rho) = \\rho V(\\rho) = V_{\\max}\\left(\\rho - \\frac{\\rho^2}{\\rho_{\\max}}\\right)\n$$\n该通量函数 $f(\\rho)$ 是一个严格凹的抛物线，其根在 $\\rho=0$ 和 $\\rho=\\rho_{\\max}$ 处。\n\n首先，我们建立基本图的关键属性。特征速度由 $c(\\rho) = f'(\\rho)$ 给出：\n$$\nf'(\\rho) = V_{\\max}\\left(1 - \\frac{2\\rho}{\\rho_{\\max}}\\right)\n$$\nCFL 条件所需的最大绝对特征速度为 $\\max_{\\rho \\in [0, \\rho_{\\max}]} |f'(\\rho)| = V_{\\max}$，这在 $\\rho=0$ 和 $\\rho=\\rho_{\\max}$ 时取得。\n\n临界密度 $\\rho_c$ 是使通量最大化的密度。这在 $f'(\\rho_c) = 0$ 时发生：\n$$\nV_{\\max}\\left(1 - \\frac{2\\rho_c}{\\rho_{\\max}}\\right) = 0 \\implies \\rho_c = \\frac{\\rho_{\\max}}{2}\n$$\n通行能力 $C$（或 $f_{\\max}$）是在临界密度下达到的最大通量：\n$$\nC = f(\\rho_c) = V_{\\max}\\left(\\frac{\\rho_{\\max}}{2} - \\frac{(\\rho_{\\max}/2)^2}{\\rho_{\\max}}\\right) = \\frac{V_{\\max}\\rho_{\\max}}{4}\n$$\n对于黎曼问题，定义需求和供给函数是很有用的。需求 $D(\\rho)$ 是密度为 $\\rho$ 的上游区域可以发送的最大流量，而供给 $S(\\rho)$ 是密度为 $\\rho$ 的下游区域可以接收的最大流量。对于凹通量函数：\n$$\nD(\\rho) = \\begin{cases} f(\\rho)  \\text{若 } \\rho \\le \\rho_c \\\\ C  \\text{若 } \\rho  \\rho_c \\end{cases}\n$$\n$$\nS(\\rho) = \\begin{cases} C  \\text{若 } \\rho \\le \\rho_c \\\\ f(\\rho)  \\text{若 } \\rho  \\rho_c \\end{cases}\n$$\n\n采用零阶 DG 方法 (DG0)。将域 $[0,L]$ 划分为 $N$ 个均匀单元（元素）$I_j = [x_{j-1/2}, x_{j+1/2}]$，其中 $j=1, \\dots, N$，每个单元的宽度为 $\\Delta x = L/N$。在 DG0 中，解 $\\rho(x,t)$ 由分片常数函数近似：\n$$\n\\rho_h(x,t) = \\sum_{j=1}^{N} \\rho_j(t) \\phi_j(x), \\quad \\text{其中} \\quad \\phi_j(x) = \\begin{cases} 1  \\text{若 } x \\in I_j \\\\ 0  \\text{否则} \\end{cases}\n$$\n通过将 PDE 乘以检验函数 $v(x)$ 并在单元 $I_j$ 上积分，得到弱形式。对于 DG0，检验函数也是分片常数，$v(x) = \\phi_j(x)$。\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} \\partial_t \\rho_h(x,t) \\phi_j(x) \\,dx + \\int_{x_{j-1/2}}^{x_{j+1/2}} \\partial_x f(\\rho_h(x,t)) \\phi_j(x) \\,dx = 0\n$$\n在 $I_j$ 内代入 $\\rho_h(x,t) = \\rho_j(t)$ 并对第一项积分，得到 $\\Delta x \\frac{d\\rho_j}{dt}$。对第二项，我们应用分部积分：\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} \\partial_x f(\\rho_h) \\,dx = f(\\rho_h(x_{j+1/2}^-,t)) - f(\\rho_h(x_{j-1/2}^+,t))\n$$\n其中 $x_{j \\pm 1/2}^\\pm$ 表示从单元内部/外部的极限。单元界面处的 $f(\\rho_h)$ 值是不连续的，必须用一个单值的数值通量 $\\hat{f}$ 代替。单元 $j$ 的半离散格式变为：\n$$\n\\Delta x \\frac{d\\rho_j}{dt} + \\hat{f}_{j+1/2} - \\hat{f}_{j-1/2} = 0 \\implies \\frac{d\\rho_j}{dt} = -\\frac{1}{\\Delta x}(\\hat{f}_{j+1/2} - \\hat{f}_{j-1/2})\n$$\n这与一阶有限体积格式相同，这对于 DG0 是预期的。时间使用显式前向欧拉法离散，固定时间步长 $\\Delta t$ 由 CFL 条件确定：\n$$\n\\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\max|f'(\\rho)|} = \\mathrm{CFL} \\frac{\\Delta x}{V_{\\max}}, \\quad \\text{其中 } \\mathrm{CFL}  1\n$$\n全离散更新为：\n$$\n\\rho_j^{n+1} = \\rho_j^n - \\frac{\\Delta t}{\\Delta x}(\\hat{f}_{j+1/2}^n - \\hat{f}_{j-1/2}^n)\n$$\n\n数值通量 $\\hat{f}$ 定义如下：\n1.  **内部界面** ($j=1, \\dots, N-1$)：使用 Godunov 通量。对于凹通量函数，它由状态 $\\rho_j$ 和 $\\rho_{j+1}$ 之间的黎曼问题的解给出，简化为：\n    $$\n    \\hat{f}_{j+1/2} = F_G(\\rho_j, \\rho_{j+1}) = \\min(D(\\rho_j), S(\\rho_{j+1}))\n    $$\n2.  **右边界** ($x=L$)：通量 $\\hat{f}_{N+1/2}$ 由内部状态 $\\rho_N$ 和外部下游状态 $\\rho_{\\mathrm{down}}$ 之间的黎曼问题确定：\n    $$\n    \\hat{f}_{N+1/2} = F_G(\\rho_N, \\rho_{\\mathrm{down}}) = \\min(D(\\rho_N), S(\\rho_{\\mathrm{down}}))\n    $$\n3.  **左边界** ($x=0$)：通量 $\\hat{f}_{1/2}$ 模拟合流。它是进入区域的总流量，由上游主线需求 $d_m = D(\\rho_{\\mathrm{up}})$ 和匝道需求 $d_r = q_{\\mathrm{r}}$ 组合而成，并受第一个单元的供给 $S_1 = S(\\rho_1)$ 的限制。问题指定了主线占比例 $p$、匝道占 $1-p$ 的优先级分配。这通过首先根据这些比例分配可用供给 $S_1$，计算临时流量，然后允许一个流使用另一个流未使用的任何供给来建模。主线 ($F_m$) 和匝道 ($F_r$) 的准入流量计算如下：\n    a. 基于分配的供给的临时流量：\n    $$ F'_m = \\min(d_m, p \\cdot S_1) \\quad \\text{和} \\quad F'_r = \\min(d_r, (1-p) \\cdot S_1) $$\n    b. 每个分配中未使用的供给：\n    $$ S_{m,\\text{rem}} = p \\cdot S_1 - F'_m \\quad \\text{和} \\quad S_{r,\\text{rem}} = (1-p) \\cdot S_1 - F'_r $$\n    c. 重新分配未使用供给后的最终流量：\n    $$ F_m = F'_m + \\min(d_m - F'_m, S_{r,\\text{rem}}) $$\n    $$ F_r = F'_r + \\min(d_r - F'_r, S_{m,\\text{rem}}) $$\n    边界处的数值通量是总进入流量：\n    $$\n    \\hat{f}_{1/2} = F_m + F_r\n    $$\n\n匝道队列动态遵循水库模型。队列大小 $Q(t)$（单位：辆）根据以下公式演化：\n$$\n\\frac{dQ}{dt} = q_{\\mathrm{r}} - F_{\\mathrm{r}}(t)\n$$\n其中 $F_r(t)$ 是来自由合流求解器得到的准入匝道流量。使用前向欧拉法离散化：\n$$\nQ^{n+1} = \\max(0, Q^n + \\Delta t (q_{\\mathrm{r}} - F^n_{\\mathrm{r}}))\n$$\n队列的物理长度为 $\\ell_{\\mathrm{q}}(t) = Q(t)/\\rho_{\\mathrm{j,r}}$。如果在任何时间 $t \\in [0,T]$ 内，$\\ell_{\\mathrm{q}}(t) \\ge L_{\\mathrm{ramp}}$，则发生溢出。\n\n为确保物理真实性，计算出的密度在每个时间步后被裁剪到 $[0, \\rho_{\\max}]$ 范围内。模拟以均匀的初始密度 $\\rho(x,0) = \\rho_{\\mathrm{init}}$ 和空的匝道队列 $Q(0)=0$ 开始。对于每个测试用例，我们将模拟运行到时间 $T$，并记录是否满足溢出条件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the DG0 traffic flow solver.\n    \"\"\"\n    test_cases = [\n        # Test Case 1 (happy path, no spillback expected)\n        {\n            'L': 1.0, 'N': 200, 'T': 200.0, 'CFL': 0.9,\n            'V_max': 0.03, 'rho_max': 180.0, 'rho_init': 40.0,\n            'rho_up': 60.0, 'rho_down': 40.0,\n            'q_r': 0.10, 'p': 0.70, 'L_ramp': 0.50, 'rho_j_r': 150.0\n        },\n        # Test Case 2 (congestion with queue growth, but no spillback)\n        {\n            'L': 1.0, 'N': 200, 'T': 200.0, 'CFL': 0.9,\n            'V_max': 0.03, 'rho_max': 180.0, 'rho_init': 40.0,\n            'rho_up': 80.0, 'rho_down': 160.0,\n            'q_r': 0.60, 'p': 0.70, 'L_ramp': 1.00, 'rho_j_r': 150.0\n        },\n        # Test Case 3 (congestion with spillback)\n        {\n            'L': 1.0, 'N': 200, 'T': 200.0, 'CFL': 0.9,\n            'V_max': 0.03, 'rho_max': 180.0, 'rho_init': 40.0,\n            'rho_up': 80.0, 'rho_down': 160.0,\n            'q_r': 1.20, 'p': 0.70, 'L_ramp': 0.20, 'rho_j_r': 150.0\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(**params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(L, N, T, CFL, V_max, rho_max, rho_init, \n                   rho_up, rho_down, q_r, p, L_ramp, rho_j_r):\n    \"\"\"\n    Executes the DG0 simulation for one set of parameters.\n\n    Returns:\n        int: 1 if spillback occurs, 0 otherwise.\n    \"\"\"\n    # Derived parameters\n    dx = L / N\n    dt = CFL * dx / V_max\n    rho_c = rho_max / 2.0\n    C = V_max * rho_max / 4.0\n\n    # Helper functions for the fundamental diagram\n    def f(rho):\n        return V_max * (rho - rho**2 / rho_max)\n\n    def D(rho):\n        return np.where(rho = rho_c, f(rho), C)\n\n    def S(rho):\n        return np.where(rho = rho_c, C, f(rho))\n\n    # Initialization\n    rho = np.full(N, rho_init, dtype=float)\n    Q = 0.0\n    t = 0.0\n    spillback_occurred = False\n    \n    num_steps = int(np.ceil(T / dt))\n\n    for _ in range(num_steps):\n        # Calculate fluxes at all N+1 interfaces\n        fluxes = np.zeros(N + 1, dtype=float)\n        \n        # --- Left boundary (x=0, interface j=1/2) ---\n        # Merge Riemann solver\n        d_m = D(np.array([rho_up]))[0] # D expects array, get scalar\n        d_r = q_r\n        s_1 = S(np.array([rho[0]]))[0]   # S expects array, get scalar\n        \n        # Provisional flows based on priority split of supply\n        F_m_prov = min(d_m, p * s_1)\n        F_r_prov = min(d_r, (1.0 - p) * s_1)\n\n        # Unused supply\n        s_m_rem = p * s_1 - F_m_prov\n        s_r_rem = (1.0 - p) * s_1 - F_r_prov\n\n        # Final flows with redistribution of unused supply\n        F_m = F_m_prov + min(d_m - F_m_prov, s_r_rem)\n        F_r = F_r_prov + min(d_r - F_r_prov, s_m_rem)\n\n        fluxes[0] = F_m + F_r\n        \n        # Store admitted ramp flow for queue update\n        F_r_admitted = F_r\n\n        # --- Interior interfaces (j=3/2 to N-1/2) ---\n        D_interior = D(rho[:-1])\n        S_interior = S(rho[1:])\n        fluxes[1:N] = np.minimum(D_interior, S_interior)\n\n        # --- Right boundary (x=L, interface j=N+1/2) ---\n        fluxes[N] = min(D(np.array([rho[-1]]))[0], S(np.array([rho_down]))[0])\n\n        # DG0/FVM update step (explicit Euler)\n        rho = rho - (dt / dx) * (fluxes[1:] - fluxes[:-1])\n        \n        # Clip densities to physical bounds\n        rho = np.clip(rho, 0.0, rho_max)\n\n        # Update queue dynamics\n        Q = max(0.0, Q + dt * (q_r - F_r_admitted))\n\n        # Check for spillback\n        if not spillback_occurred and (Q / rho_j_r) >= L_ramp:\n            spillback_occurred = True\n            # Optimization: if problem only asks for occurrence, not time, we can stop.\n            break\n\n        t += dt\n    \n    return 1 if spillback_occurred else 0\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "前面的练习分别展示了高阶精度和非线性应用，而本练习  则将二者联系起来。虽然高阶格式（如练习一中的P1 DG）精度更高，但在应用于包含激波的非线性问题（如练习二中的交通流模型）时，可能会产生非物理的数值振荡。本练习探讨了斜率限制器这一关键技术，它被构建为一个约束优化问题，旨在抑制这些振荡同时保持方法的优良特性，是高阶DG方法走向实用的重要一环。",
            "id": "3377299",
            "problem": "考虑周期性区域上的一维标量双曲守恒律 $u_{t} + \\partial_{x} f(u) = 0$，该区域被均匀划分为宽度为 $h  0$ 的单元 $K_{i} = [x_{i} - h/2, x_{i} + h/2]$。一个一次多项式的间断 Galerkin (DG) 方法将单元 $K_{i}$ 上的近似解表示为 $u_{h}(x) = \\bar{u}_{i} + s_{i} (x - x_{i})$，其中 $\\bar{u}_{i}$ 是单元平均值，$s_{i}$ 是单元斜率。假设未限制的 DG 更新产生一个原始多项式 $u_{h}^{*}(x) = \\bar{u}_{i} + s_{i}^{*} (x - x_{i})$。\n\n我们寻求一个表示为约束变分投影的限制器：在满足守恒性和弱总变差递减 (TVD) 约束的条件下，找到 $u_{h}$ 以最小化其在 $K_{i}$ 上到 $u_{h}^{*}$ 的局部 $L^{2}$ 距离。具体而言，确定求解以下问题的 $u_{h} \\in \\mathbb{P}_{1}(K_{i})$：\n$$\n\\min_{u_{h}} \\int_{K_{i}} \\big(u_{h}(x) - u_{h}^{*}(x)\\big)^{2} \\, \\mathrm{d}x\n$$\n约束条件如下：\n- 单元平均值守恒，$\\frac{1}{h} \\int_{K_{i}} u_{h}(x) \\, \\mathrm{d}x = \\bar{u}_{i}$，\n- 弱 TVD 约束，形式为 $\\int_{K_{i}} \\big| \\partial_{x} u_{h}(x) \\big| \\, \\mathrm{d}x \\leq \\beta V_{i}$，其中 $V_{i} = \\big|\\bar{u}_{i+1} - \\bar{u}_{i}\\big| + \\big|\\bar{u}_{i} - \\bar{u}_{i-1}\\big|$ 且 $0  \\beta \\leq 1$ 是一个给定参数，\n- 面上的弱无新极值约束，要求重构的面值位于相邻单元平均值的范围内：$u_{h}(x_{i} - h/2) \\in [\\min(\\bar{u}_{i-1}, \\bar{u}_{i}), \\max(\\bar{u}_{i-1}, \\bar{u}_{i})]$ 和 $u_{h}(x_{i} + h/2) \\in [\\min(\\bar{u}_{i}, \\bar{u}_{i+1}), \\max(\\bar{u}_{i}, \\bar{u}_{i+1})]$。\n\n假设以下具体数据：$h = 0.1$，$\\bar{u}_{i-1} = 0.6$，$\\bar{u}_{i} = 0.8$，$\\bar{u}_{i+1} = 1.1$，$\\beta = 0.6$ 以及 $s_{i}^{*} = 3.4$。从上述基本定义出发，用斜率变量 $s_{i}$ 明确地建立约束最小化问题，推导最优性的 Karush–Kuhn–Tucker 条件，确定由这些约束导出的 $s_{i}$ 的可行区间，并计算最小值点。\n\n请给出单元 $K_{i}$ 的受限斜率 $s_{i}$ 作为最终答案。无需单位。如果需要四舍五入，请将答案保留到四位有效数字；否则，给出精确值。",
            "solution": "用户要求我求解一个约束最小化问题，以找到一个间断 Galerkin (DG) 方法的受限斜率。\n\n### 步骤1：问题验证\n\n第一步是验证问题陈述。\n\n#### 1.1. 提取已知条件\n- **偏微分方程和区域**：周期性区域上的 $u_{t} + \\partial_{x} f(u) = 0$。\n- **离散化**：宽度为 $h$ 的均匀单元 $K_{i} = [x_{i} - h/2, x_{i} + h/2]$。\n- **近似**：单元 $K_{i}$ 上的分片线性多项式 $u_{h}(x) = \\bar{u}_{i} + s_{i} (x - x_{i})$，其中 $\\bar{u}_{i}$ 是单元平均值，$s_{i}$ 是斜率。\n- **原始更新**：未限制的 DG 更新提供 $u_{h}^{*}(x) = \\bar{u}_{i} + s_{i}^{*} (x - x_{i})$。\n- **最小化问题**：找到 $u_{h} \\in \\mathbb{P}_{1}(K_{i})$ 以求解 $\\min_{u_{h}} \\int_{K_{i}} \\big(u_{h}(x) - u_{h}^{*}(x)\\big)^{2} \\, \\mathrm{d}x$。\n- **约束条件**：\n    1. **守恒性**：$\\frac{1}{h} \\int_{K_{i}} u_{h}(x) \\, \\mathrm{d}x = \\bar{u}_{i}$。\n    2. **弱 TVD**：$\\int_{K_{i}} \\big| \\partial_{x} u_{h}(x) \\big| \\, \\mathrm{d}x \\leq \\beta V_{i}$，其中 $V_{i} = \\big|\\bar{u}_{i+1} - \\bar{u}_{i}\\big| + \\big|\\bar{u}_{i} - \\bar{u}_{i-1}\\big|$ 且 $0  \\beta \\leq 1$。\n    3. **无新极值**：\n        - $u_{h}(x_{i} - h/2) \\in [\\min(\\bar{u}_{i-1}, \\bar{u}_{i}), \\max(\\bar{u}_{i-1}, \\bar{u}_{i})]$。\n        - $u_{h}(x_{i} + h/2) \\in [\\min(\\bar{u}_{i}, \\bar{u}_{i+1}), \\max(\\bar{u}_{i}, \\bar{u}_{i+1})]$。\n- **已知数据**：\n    - $h = 0.1$\n    - $\\bar{u}_{i-1} = 0.6$\n    - $\\bar{u}_{i} = 0.8$\n    - $\\bar{u}_{i+1} = 1.1$\n    - $\\beta = 0.6$\n    - $s_{i}^{*} = 3.4$\n\n#### 1.2. 使用提取的已知条件进行验证\n- **科学依据**：该问题在偏微分方程数值方法领域，特别是在双曲守恒律的 DG 格式的斜率限制技术方面，有坚实的理论基础。$L^2$ 投影、TVD 约束和防止新极值的概念都是标准概念。\n- **适定性**：该问题是一个带线性不等式约束的二次规划问题。目标函数是严格凸的，可行集是一个闭凸集（如下所示，是一个区间）。这保证了唯一最小值点的存在。\n- **客观性**：语言正式且无歧义。所有术语均按领域内的惯例定义。\n- **完整性和一致性**：问题提供了所有必要的数据和定义。没有明显的矛盾。\n\n#### 1.3. 结论与行动\n问题是**有效**的。我们继续进行求解。\n\n### 步骤2：求解推导\n\n目标是通过求解给定的约束最小化问题来找到受限斜率 $s_i$。优化变量是函数 $u_h$，但其形式 $u_h(x) = \\bar{u}_i + s_i(x-x_i)$ 使得单元平均值 $\\bar{u}_i$ 是固定的。因此，问题简化为寻找最优斜率 $s_i$。\n\n#### 用斜率 $s_i$ 进行公式化\n\n**目标函数**：\n令 $J(s_i)$ 为目标函数。\n$$ J(s_i) = \\int_{K_{i}} \\big(u_{h}(x) - u_{h}^{*}(x)\\big)^{2} \\, \\mathrm{d}x $$\n代入 $u_h$ 和 $u_h^*$ 的表达式：\n$$ u_{h}(x) - u_{h}^{*}(x) = \\left(\\bar{u}_{i} + s_{i} (x - x_{i})\\right) - \\left(\\bar{u}_{i} + s_{i}^{*} (x - x_{i})\\right) = (s_i - s_i^{*})(x-x_i) $$\n积分变为：\n$$ J(s_i) = \\int_{x_i-h/2}^{x_i+h/2} \\left((s_i - s_i^{*})(x-x_i)\\right)^2 \\, \\mathrm{d}x = (s_i - s_i^{*})^2 \\int_{x_i-h/2}^{x_i+h/2} (x-x_i)^2 \\, \\mathrm{d}x $$\n该积分的计算结果为：\n$$ \\int_{-h/2}^{h/2} y^2 \\, \\mathrm{d}y = \\left[\\frac{y^3}{3}\\right]_{-h/2}^{h/2} = \\frac{(h/2)^3}{3} - \\frac{(-h/2)^3}{3} = 2 \\frac{h^3}{24} = \\frac{h^3}{12} $$\n所以，目标函数是：\n$$ J(s_i) = \\frac{h^3}{12} (s_i - s_i^{*})^2 $$\n由于 $h  0$，最小化 $J(s_i)$ 等价于最小化 $(s_i - s_i^{*})^2$，这又等价于在可行集中找到最接近 $s_i^*$ 的 $s_i$ 值。\n\n**约束条件**：\n1.  **守恒性**：我们验证该约束对于我们选择的 $u_h(x)$ 是自动满足的。\n    $$ \\frac{1}{h} \\int_{K_{i}} u_{h}(x) \\, \\mathrm{d}x = \\frac{1}{h} \\int_{x_i-h/2}^{x_i+h/2} (\\bar{u}_{i} + s_{i} (x - x_{i})) \\, \\mathrm{d}x = \\frac{1}{h} \\left[ \\bar{u}_i x + s_i \\frac{(x-x_i)^2}{2} \\right]_{x_i-h/2}^{x_i+h/2} = \\frac{1}{h} (\\bar{u}_i h) = \\bar{u}_i $$\n    该约束对 $s_i$ 的任何选择都满足，并且不施加任何限制。\n\n2.  **弱 TVD**：我们将此约束用 $s_i$ 表示。\n    $$ \\int_{K_i} |\\partial_x u_h(x)| \\, \\mathrm{d}x = \\int_{x_i-h/2}^{x_i+h/2} |s_i| \\, \\mathrm{d}x = |s_i| h $$\n    约束为 $|s_i| h \\leq \\beta V_i$。首先，我们计算 $V_i$：\n    $$ V_i = |\\bar{u}_{i+1} - \\bar{u}_i| + |\\bar{u}_i - \\bar{u}_{i-1}| = |1.1 - 0.8| + |0.8 - 0.6| = 0.3 + 0.2 = 0.5 $$\n    现在，代入 $h$、$\\beta$ 和 $V_i$ 的给定值：\n    $$ |s_i| (0.1) \\leq (0.6)(0.5) \\implies 0.1 |s_i| \\leq 0.3 \\implies |s_i| \\leq 3 $$\n    这给出了区间 $s_i \\in [-3, 3]$。\n\n3.  **无新极值**：我们分析两个面上的约束。\n    -   在左侧面 $x_L = x_i - h/2$，值为 $u_h(x_L) = \\bar{u}_i - s_i \\frac{h}{2}$。该值必须位于 $[\\min(\\bar{u}_{i-1}, \\bar{u}_i), \\max(\\bar{u}_{i-1}, \\bar{u}_i)] = [\\min(0.6, 0.8), \\max(0.6, 0.8)] = [0.6, 0.8]$。\n        $$ 0.6 \\leq \\bar{u}_i - s_i \\frac{h}{2} \\leq 0.8 $$\n        $$ 0.6 \\leq 0.8 - s_i \\frac{0.1}{2} \\leq 0.8 \\implies 0.6 \\leq 0.8 - 0.05 s_i \\leq 0.8 $$\n        这产生两个不等式：\n        a) $0.8 - 0.05 s_i \\leq 0.8 \\implies -0.05 s_i \\leq 0 \\implies s_i \\geq 0$。\n        b) $0.6 \\leq 0.8 - 0.05 s_i \\implies 0.05 s_i \\leq 0.2 \\implies s_i \\leq 4$。\n        该约束意味着 $s_i \\in [0, 4]$。\n    -   在右侧面 $x_R = x_i + h/2$，值为 $u_h(x_R) = \\bar{u}_i + s_i \\frac{h}{2}$。该值必须位于 $[\\min(\\bar{u}_i, \\bar{u}_{i+1}), \\max(\\bar{u}_i, \\bar{u}_{i+1})] = [\\min(0.8, 1.1), \\max(0.8, 1.1)] = [0.8, 1.1]$。\n        $$ 0.8 \\leq \\bar{u}_i + s_i \\frac{h}{2} \\leq 1.1 $$\n        $$ 0.8 \\leq 0.8 + s_i \\frac{0.1}{2} \\leq 1.1 \\implies 0.8 \\leq 0.8 + 0.05 s_i \\leq 1.1 $$\n        这产生两个不等式：\n        a) $0.8 \\leq 0.8 + 0.05 s_i \\implies 0 \\leq 0.05 s_i \\implies s_i \\geq 0$。\n        b) $0.8 + 0.05 s_i \\leq 1.1 \\implies 0.05 s_i \\leq 0.3 \\implies s_i \\leq 6$。\n        该约束意味着 $s_i \\in [0, 6]$。\n\n#### 确定 $s_i$ 的可行区间\n$s_i$ 的可行集是所有约束导出的区间的交集：\n$$ [-3, 3] \\cap [0, 4] \\cap [0, 6] $$\n$[0, 4]$ 和 $[0, 6]$ 的交集是 $[0, 4]$。\n$[-3, 3]$ 和 $[0, 4]$ 的交集是 $[0, 3]$。\n所以，斜率的可行区间是 $s_i \\in [0, 3]$。我们用 $I = [s_{\\min}, s_{\\max}] = [0, 3]$ 表示这个区间。\n\n#### 计算最小值点\n问题简化为在 $[0, 3]$ 中找到 $s_i$ 以最小化到 $s_i^* = 3.4$ 的距离。这是一个将点 $s_i^*$ 投影到区间 $I$ 上的问题。\n解 $s_i$ 由下式给出：\n$$ s_i = \\text{proj}_I(s_i^*) = \\begin{cases} s_{\\min}  \\text{if } s_i^*  s_{\\min} \\\\ s_i^*  \\text{if } s_{\\min} \\leq s_i^* \\leq s_{\\max} \\\\ s_{\\max}  \\text{if } s_i^*  s_{\\max} \\end{cases} $$\n当 $s_i^* = 3.4$ 且 $I = [0, 3]$ 时，我们有 $s_i^*  s_{\\max}$。\n因此，最小值点是 $s_i = s_{\\max} = 3$。\n\n#### 通过 Karush–Kuhn–Tucker (KKT) 条件推导\n这个结果可以通过该问题的 KKT 条件进行形式上的证明：最小化 $f(s_i) = \\frac{h^3}{12}(s_i - s_i^*)^2$，约束条件为 $g_1(s_i) = s_i - 3 \\leq 0$ 和 $g_2(s_i) = -s_i \\leq 0$。\n拉格朗日函数为 $\\mathcal{L}(s_i, \\mu_1, \\mu_2) = f(s_i) + \\mu_1 g_1(s_i) + \\mu_2 g_2(s_i)$。\nKKT 条件要求平稳性、原始可行性、对偶可行性 ($\\mu_1, \\mu_2 \\geq 0$) 和互补松弛性 ($\\mu_1 g_1(s_i) = 0$, $\\mu_2 g_2(s_i) = 0$)。\n\n我们检验解 $s_i = 3$。\n- **原始可行性**：$s_i = 3$ 在 $[0, 3]$ 内。满足。\n- **互补松弛性**：\n  - $g_1(3) = 3 - 3 = 0$。约束是激活的，因此 $\\mu_1$ 可以非零。\n  - $g_2(3) = -3  0$。约束是非激活的，因此 $\\mu_2$ 必须为 $0$。\n- **平稳性**：拉格朗日函数关于 $s_i$ 的梯度必须为零。\n  $$ \\frac{\\partial \\mathcal{L}}{\\partial s_i} = f'(s_i) + \\mu_1 g_1'(s_i) + \\mu_2 g_2'(s_i) = \\frac{h^3}{6}(s_i - s_i^*) + \\mu_1(1) + \\mu_2(-1) = 0 $$\n  当 $s_i=3$, $s_i^*=3.4$, $h=0.1$, 且 $\\mu_2=0$ 时，我们有：\n  $$ \\frac{(0.1)^3}{6}(3 - 3.4) + \\mu_1 = 0 \\implies \\frac{0.001}{6}(-0.4) + \\mu_1 = 0 \\implies \\mu_1 = \\frac{0.0004}{6}  0 $$\n- **对偶可行性**：$\\mu_1  0$ 和 $\\mu_2 = 0$ 得到满足。\n由于所有 KKT 条件都得到满足，$s_i=3$ 确实是最优解。\n\n单元 $K_i$ 的最终受限斜率为 $s_i = 3$。这是一个精确值。",
            "answer": "$$\n\\boxed{3}\n$$"
        }
    ]
}