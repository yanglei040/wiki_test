{
    "hands_on_practices": [
        {
            "introduction": "A crucial step in understanding any numerical method for wave equations is analyzing how it propagates waves of different frequencies. This exercise guides you through the process of performing a Fourier analysis on a Discontinuous Galerkin (DG) scheme for the linear advection equation . By deriving the semi-discrete Fourier symbol, you will quantify the scheme's dispersion and dissipation errors and see firsthand how the choice of numerical flux—upwind versus central—fundamentally alters the stability and accuracy of the solution.",
            "id": "3377316",
            "problem": "Consider the one-dimensional linear advection equation $\\partial_t u + a \\,\\partial_x u = 0$ with a constant advection speed $a > 0$ on a periodic domain discretized by a uniform mesh of cells of size $h$. Use the Discontinuous Galerkin (DG) method with polynomial degree $p=1$ per element, and the modal basis on the reference element $\\xi \\in [-1,1]$ defined by $\\phi_0(\\xi)=1$ and $\\phi_1(\\xi)=\\xi$, mapped to each physical cell $I_j=[x_{j-1/2},x_{j+1/2}]$ by $x=x_j+(h/2)\\,\\xi$. The flux function is $f(u)=a\\,u$. Two numerical fluxes are to be compared: the upwind flux for $a > 0$, and the central flux. Periodic boundary conditions imply that the values from the neighboring cells wrap around the domain.\n\nStarting from the DG weak formulation, derive the semi-discrete system on each cell $I_j$ by testing with $v=\\phi_0$ and $v=\\phi_1$, carefully accounting for volume and surface terms under the chosen basis and mapping. Formulate the semi-discrete system in the form $M\\,\\partial_t \\mathbf{u}_j = \\mathcal{L}_j(\\mathbf{u}_{j-1},\\mathbf{u}_j,\\mathbf{u}_{j+1})$, where $M$ is the local mass matrix and $\\mathbf{u}_j=(u_{j,0},u_{j,1})^\\top$ are the modal coefficients in cell $j$. Then apply the discrete Fourier (Bloch) ansatz $\\mathbf{u}_j(t)=\\hat{\\mathbf{u}}(t)\\,e^{i k x_j}$, where $k$ is the spatial wavenumber in radians per meter, to obtain a $2\\times 2$ Fourier symbol matrix $A(k)$ such that $\\partial_t \\hat{\\mathbf{u}} = A(k)\\,\\hat{\\mathbf{u}}$ for each of the two flux choices. The semi-discrete Fourier symbol is defined by the eigenvalues $\\lambda(k)$ of $A(k)$; select the physical branch as the eigenvalue that approaches $-i\\,a\\,k$ in the limit $k\\to 0$.\n\nDefine the dispersion error as $E_{\\mathrm{disp}}(k) = \\operatorname{Im}(\\lambda(k))/(-a) - k$ in radians per meter, and the dissipation rate as $E_{\\mathrm{diss}}(k) = \\operatorname{Re}(\\lambda(k))$ in inverse seconds. Implement a program that constructs $A(k)$ for both the upwind and central fluxes, computes their eigenvalues, selects the physical branch, and evaluates $E_{\\mathrm{disp}}(k)$ and $E_{\\mathrm{diss}}(k)$.\n\nUse the following test suite with $a=1.0$ meters per second and $h=1.0$ meters, and the wavenumbers in radians per meter (angles in radians):\n- $k_1 = 0.0$\n- $k_2 = 0.2\\,\\pi$\n- $k_3 = 0.5\\,\\pi$\n- $k_4 = 0.9\\,\\pi$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case $k_i$, output a list of four floats $[E_{\\mathrm{disp}}^{\\mathrm{up}}, E_{\\mathrm{diss}}^{\\mathrm{up}}, E_{\\mathrm{disp}}^{\\mathrm{cen}}, E_{\\mathrm{diss}}^{\\mathrm{cen}}]$, where superscripts indicate the flux choice. Aggregate the four test case results into a single list. The required final format is\n$[[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2]]$\nwith all entries as floating-point numbers, where for each bracketed group the entries are in the order upwind dispersion error, upwind dissipation rate, central dispersion error, central dissipation rate. No units should be printed; all angles must be treated in radians and the dispersion error expressed in radians per meter, the dissipation rate in inverse seconds.",
            "solution": "The starting point is the one-dimensional linear advection equation $\\partial_t u + a \\,\\partial_x u = 0$ with constant speed $a > 0$. The Discontinuous Galerkin (DG) method is constructed by approximating $u$ in each cell $I_j=[x_{j-1/2},x_{j+1/2}]$ using the modal basis on the reference element $\\xi \\in [-1,1]$, $\\phi_0(\\xi)=1$ and $\\phi_1(\\xi)=\\xi$, mapped by $x=x_j+(h/2)\\,\\xi$. The local approximation in cell $j$ is $u_h(x,t) = u_{j,0}(t)\\,\\phi_0(\\xi(x)) + u_{j,1}(t)\\,\\phi_1(\\xi(x))$. The DG weak form for a test function $v$ is\n$$\n\\int_{I_j} \\partial_t u_h\\, v\\, dx \\;-\\; \\int_{I_j} f(u_h)\\,\\partial_x v\\, dx \\;+\\; \\widehat{f}\\big(u_h^{-},u_h^{+}\\big)\\, v\\big|_{x_{j+1/2}} \\;-\\; \\widehat{f}\\big(u_h^{-},u_h^{+}\\big)\\, v\\big|_{x_{j-1/2}} \\;=\\; 0,\n$$\nwhere $f(u)=a\\,u$, and $\\widehat{f}$ is a numerical flux at interfaces. For $p=1$, we test with $v=\\phi_0$ and $v=\\phi_1$. The mapping derivative is $\\partial_x v = (2/h)\\,\\partial_\\xi v$, and the Jacobian is $dx=(h/2)\\,d\\xi$. The mass matrix entries are\n$$\nM_{mn} = \\int_{I_j} \\phi_m \\phi_n\\, dx = \\frac{h}{2}\\int_{-1}^1 \\phi_m(\\xi)\\,\\phi_n(\\xi)\\, d\\xi,\n$$\nwhich yield $M=\\operatorname{diag}(h, h/3)$ because $\\int_{-1}^1 1\\,d\\xi=2$, $\\int_{-1}^1 \\xi\\,d\\xi=0$, and $\\int_{-1}^1 \\xi^2\\,d\\xi=2/3$.\n\nThe volume term involves $-\\int_{I_j} a\\,u_h\\,\\partial_x v\\,dx$. For $v=\\phi_0$, $\\partial_x \\phi_0=0$, so the volume term vanishes. For $v=\\phi_1$, $\\partial_x \\phi_1 = 2/h$, hence\n$$\n-\\int_{I_j} a\\,u_h\\,\\partial_x \\phi_1\\,dx \\;=\\; -\\frac{2a}{h}\\int_{I_j} u_h\\,dx \\;=\\; -\\frac{2a}{h}\\frac{h}{2}\\int_{-1}^1 \\big(u_{j,0}\\,\\phi_0(\\xi) + u_{j,1}\\,\\phi_1(\\xi)\\big)\\, d\\xi \\;=\\; -2a\\,u_{j,0},\n$$\nbecause $\\int_{-1}^1 \\phi_1(\\xi)\\,d\\xi=0$.\n\nThe surface terms evaluate the test function at cell endpoints. At $x_{j+1/2}$, the outward normal is $+1$ and $\\phi_0(1)=1$, $\\phi_1(1)=1$. At $x_{j-1/2}$, the outward normal is $-1$ and $\\phi_0(-1)=1$, $\\phi_1(-1)=-1$. Therefore the boundary contributions for $v=\\phi_0$ and $v=\\phi_1$ are $\\widehat{f}_{j+1/2} - \\widehat{f}_{j-1/2}$ and $\\widehat{f}_{j+1/2} + \\widehat{f}_{j-1/2}$, respectively. The trace values at cell interfaces are $u_j^{+}=u_{j,0}+u_{j,1}$ at $x_{j+1/2}$ and $u_j^{-}=u_{j,0}-u_{j,1}$ at $x_{j-1/2}$.\n\nFor the upwind flux with $a>0$, $\\widehat{f}=a\\,u^{-}$ so that $\\widehat{f}_{j+1/2} = a\\,(u_{j,0}+u_{j,1})$ and $\\widehat{f}_{j-1/2} = a\\,(u_{j-1,0}+u_{j-1,1})$. Combining all terms, the semi-discrete equations become\n$$\nh\\,\\partial_t u_{j,0} \\;+\\; a\\big[(u_{j,0}+u_{j,1}) - (u_{j-1,0}+u_{j-1,1})\\big] \\;=\\; 0,\n$$\n$$\n\\frac{h}{3}\\,\\partial_t u_{j,1} \\;-\\; 2a\\,u_{j,0} \\;+\\; a\\big[(u_{j,0}+u_{j,1}) + (u_{j-1,0}+u_{j-1,1})\\big] \\;=\\; 0.\n$$\n\nFor the central flux, $\\widehat{f}=\\tfrac{a}{2}\\,(u^{-}+u^{+})$, giving $\\widehat{f}_{j+1/2} = \\tfrac{a}{2}\\big((u_{j,0}+u_{j,1}) + (u_{j+1,0}-u_{j+1,1})\\big)$ and $\\widehat{f}_{j-1/2} = \\tfrac{a}{2}\\big((u_{j-1,0}+u_{j-1,1}) + (u_{j,0}-u_{j,1})\\big)$. The semi-discrete equations are\n$$\nh\\,\\partial_t u_{j,0} \\;+\\; \\frac{a}{2}\\Big[\\big(u_{j,0}+u_{j,1}\\big) + \\big(u_{j+1,0}-u_{j+1,1}\\big) - \\big(u_{j-1,0}+u_{j-1,1}\\big) - \\big(u_{j,0}-u_{j,1}\\big)\\Big] \\;=\\; 0,\n$$\n$$\n\\frac{h}{3}\\,\\partial_t u_{j,1} \\;-\\; 2a\\,u_{j,0} \\;+\\; \\frac{a}{2}\\Big[\\big(u_{j,0}+u_{j,1}\\big) + \\big(u_{j+1,0}-u_{j+1,1}\\big) + \\big(u_{j-1,0}+u_{j-1,1}\\big) + \\big(u_{j,0}-u_{j,1}\\big)\\Big] \\;=\\; 0.\n$$\n\nTo obtain the Fourier symbol, apply the Bloch ansatz $\\mathbf{u}_j(t)=\\hat{\\mathbf{u}}(t)\\,e^{i k x_j}$ with $k$ the wavenumber and $x_{j\\pm 1}=x_j\\pm h$. Then $u_{j\\pm1,m}= \\hat{u}_m\\,e^{\\pm i k h}\\,e^{i k x_j}$. Factor $e^{i k x_j}$ and write the semi-discrete system for $\\hat{\\mathbf{u}}=(\\hat{u}_0,\\hat{u}_1)^\\top$ as $\\partial_t \\hat{\\mathbf{u}} = A(k)\\,\\hat{\\mathbf{u}}$. For the upwind flux, introduce $z=e^{-i k h}=\\cos(kh)-i\\sin(kh)$, and obtain\n$$\nA_{\\mathrm{up}}(k) \\;=\\; -\\frac{a}{h}\n\\begin{pmatrix}\n1 - z & \\;1 - z\\\\\n3(z - 1) & \\;3(1 + z)\n\\end{pmatrix}.\n$$\nFor the central flux, using trigonometric identities, obtain\n$$\nA_{\\mathrm{cen}}(k) \\;=\\; -\\frac{a}{h}\n\\begin{pmatrix}\ni\\,\\sin(kh) & \\;1 - \\cos(kh)\\\\\n3\\big(\\cos(kh)-1\\big) & \\;-\\,3\\,i\\,\\sin(kh)\n\\end{pmatrix}.\n$$\nThe semi-discrete Fourier symbol is given by the eigenvalues $\\lambda(k)$ of $A(k)$. The physical branch satisfies $\\lambda(k)\\to -i\\,a\\,k$ as $k\\to 0$, while the second branch corresponds to a spurious mode with magnitude $O(a/h)$.\n\nDefine the dispersion error as $E_{\\mathrm{disp}}(k) = \\operatorname{Im}(\\lambda(k))/(-a) - k$, which compares the numerical phase speed to the exact relation $\\lambda_{\\mathrm{exact}}(k)=-i\\,a\\,k$, and the dissipation rate as $E_{\\mathrm{diss}}(k) = \\operatorname{Re}(\\lambda(k))$, which is zero for the exact continuous advection and non-zero for dissipative discretizations. The algorithm is:\n1. For given $(a,h,k)$, construct $A_{\\mathrm{up}}(k)$ and $A_{\\mathrm{cen}}(k)$ as above.\n2. Compute their eigenvalues.\n3. Select the physical eigenvalue by minimizing $|\\operatorname{Im}(\\lambda)+a\\,k|$ among the computed eigenvalues; if needed, break ties by choosing the eigenvalue with the smaller magnitude $|\\lambda|$.\n4. Compute $E_{\\mathrm{disp}}(k)$ and $E_{\\mathrm{diss}}(k)$ for both fluxes.\n\nWith $a=1.0$ meters per second and $h=1.0$ meters, and the test wavenumbers $k_1=0.0$, $k_2=0.2\\,\\pi$, $k_3=0.5\\,\\pi$, $k_4=0.9\\,\\pi$ (radians per meter), the program produces, for each $k_i$, the four floats $[E_{\\mathrm{disp}}^{\\mathrm{up}}, E_{\\mathrm{diss}}^{\\mathrm{up}}, E_{\\mathrm{disp}}^{\\mathrm{cen}}, E_{\\mathrm{diss}}^{\\mathrm{cen}}]$, aggregated into a single list. Qualitatively, the central flux yields purely imaginary eigenvalues, hence $E_{\\mathrm{diss}}^{\\mathrm{cen}}(k)=0$ for all $k$, reflecting energy conservation in the semi-discrete setting, while the upwind flux introduces negative real parts in $\\lambda(k)$, hence $E_{\\mathrm{diss}}^{\\mathrm{up}}(k)<0$ except at $k=0$, reflecting numerical dissipation. The dispersion errors for both fluxes quantify phase inaccuracies that increase with $kh$; the physical branch approaches the exact $-i\\,a\\,k$ as $k\\to 0$, so $E_{\\mathrm{disp}}(0)=0$ for both fluxes.",
            "answer": "```python\nimport numpy as np\n\ndef A_upwind(a, h, k):\n    \"\"\"\n    Construct the 2x2 Fourier symbol matrix A(k) for P1 DG with upwind flux (a > 0).\n    Uses z = exp(-i k h).\n    \"\"\"\n    z = np.exp(-1j * k * h)\n    factor = -a / h\n    A11 = (1 - z)\n    A12 = (1 - z)\n    A21 = 3 * (z - 1)\n    A22 = 3 * (1 + z)\n    A = factor * np.array([[A11, A12],\n                           [A21, A22]], dtype=complex)\n    return A\n\ndef A_central(a, h, k):\n    \"\"\"\n    Construct the 2x2 Fourier symbol matrix A(k) for P1 DG with central flux.\n    Uses trig form with sin(kh) and cos(kh).\n    \"\"\"\n    kh = k * h\n    s = np.sin(kh)\n    c = np.cos(kh)\n    factor = -a / h\n    A11 = 1j * s\n    A12 = (1 - c)\n    A21 = 3 * (c - 1)\n    A22 = -3j * s\n    A = factor * np.array([[A11, A12],\n                           [A21, A22]], dtype=complex)\n    return A\n\ndef physical_branch_eigenvalue(eigs, a, k):\n    \"\"\"\n    Select the physical branch eigenvalue: the one whose imaginary part\n    is closest to -a*k. Break ties by smaller magnitude.\n    \"\"\"\n    target_im = -a * k\n    # Compute closeness and magnitude\n    closeness = [abs(np.imag(lam) - target_im) for lam in eigs]\n    # Find indices sorted by closeness then by magnitude\n    indices = sorted(range(len(eigs)),\n                     key=lambda i: (closeness[i], abs(eigs[i])))\n    return eigs[indices[0]]\n\ndef compute_errors(a, h, k, flux_type):\n    \"\"\"\n    Compute dispersion and dissipation errors for given a, h, k, and flux type.\n    flux_type: 'upwind' or 'central'\n    Returns (E_disp, E_diss).\n    \"\"\"\n    if flux_type == 'upwind':\n        A = A_upwind(a, h, k)\n    elif flux_type == 'central':\n        A = A_central(a, h, k)\n    else:\n        raise ValueError(\"Unknown flux type\")\n    eigs = np.linalg.eigvals(A)\n    lam = physical_branch_eigenvalue(eigs, a, k)\n    E_disp = (np.imag(lam) / (-a)) - k  # radians per meter\n    E_diss = np.real(lam)               # inverse seconds\n    return float(E_disp), float(E_diss)\n\ndef solve():\n    # Define parameters\n    a = 1.0  # m/s\n    h = 1.0  # m\n    # Test suite wavenumbers in radians per meter (angles in radians)\n    test_cases = [\n        0.0,\n        0.2 * np.pi,\n        0.5 * np.pi,\n        0.9 * np.pi,\n    ]\n\n    results = []\n    for k in test_cases:\n        disp_up, diss_up = compute_errors(a, h, k, 'upwind')\n        disp_cen, diss_cen = compute_errors(a, h, k, 'central')\n        results.append([disp_up, diss_up, disp_cen, diss_cen])\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists with floats.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "While linear model problems are essential for analysis, the power of DG methods truly shines when applied to nonlinear, real-world systems. This practice challenges you to model vehicular traffic flow using the Lighthill-Whitham-Richards (LWR) conservation law, a classic example of a nonlinear hyperbolic system . You will implement a DG scheme to simulate traffic density, handle complex boundary conditions like on-ramps using a Riemann solver, and analyze emergent phenomena such as queue formation and spillback.",
            "id": "3377321",
            "problem": "Consider the one-dimensional scalar hyperbolic conservation law for vehicular traffic flow on a single lane link,\n$$\\partial_t \\rho(x,t) + \\partial_x \\big( \\rho(x,t)\\,V(\\rho(x,t)) \\big) = 0,$$\nwhere $\\rho(x,t)$ is the traffic density in vehicles per kilometer, $V(\\rho)$ is the velocity in kilometers per second, and the flux $f(\\rho)$ is defined by $f(\\rho) = \\rho V(\\rho)$ in vehicles per second. Assume the Greenshields fundamental diagram, namely\n$$V(\\rho) = V_{\\max}\\left(1 - \\frac{\\rho}{\\rho_{\\max}}\\right),\\qquad f(\\rho) = V_{\\max}\\left(\\rho - \\frac{\\rho^2}{\\rho_{\\max}}\\right),$$\nwith $V_{\\max} > 0$ in kilometers per second and $\\rho_{\\max} > 0$ in vehicles per kilometer. Let the spatial domain be $x \\in [0,L]$ with $L$ in kilometers. The left boundary at $x=0$ models a junction with two incoming streams: the upstream mainline characterized by an external upstream density $\\rho_{\\mathrm{up}}$ in vehicles per kilometer, and an on-ramp delivering an exogenous demand $q_{\\mathrm{r}}$ in vehicles per second. The right boundary at $x=L$ is connected to an external downstream state characterized by a density $\\rho_{\\mathrm{down}}$ in vehicles per kilometer.\n\nYour task is to derive, implement, and execute a Discontinuous Galerkin (DG) method of degree zero (piecewise constant representation per element) for the above conservation law. You must start from the integral weak formulation on each element, apply integration by parts, and close the semi-discrete system with interface numerical fluxes. For interior interfaces use the monotone Godunov flux for strictly concave flux functions. For the left boundary implement a merge Riemann solver that combines the upstream mainline demand and the on-ramp demand under a fixed priority split, constrained by the domain’s boundary supply. For the right boundary use the Godunov flux with the external downstream density.\n\nDefine the critical density and capacity induced by the Greenshields model. Express the demand and supply functions used in the Godunov solver purely in terms of the fundamental diagram and these critical quantities, and use them consistently both at interior interfaces and at boundaries. The on-ramp queue $Q(t)$ in vehicles obeys the reservoir dynamics\n$$\\frac{dQ}{dt} = q_{\\mathrm{r}} - F_{\\mathrm{r}}(t),$$\nwhere $F_{\\mathrm{r}}(t)$ is the admitted on-ramp flow in vehicles per second determined by the boundary Riemann solver at $x=0$. The physical queue length $\\ell_{\\mathrm{q}}(t)$ in kilometers is\n$$\\ell_{\\mathrm{q}}(t) = \\frac{Q(t)}{\\rho_{\\mathrm{j,r}}},$$\nwhere $\\rho_{\\mathrm{j,r}}$ is the ramp jam density in vehicles per kilometer. Queue spillback is said to occur at time $t$ if $\\ell_{\\mathrm{q}}(t) \\ge L_{\\mathrm{ramp}}$, where $L_{\\mathrm{ramp}}$ is the finite ramp storage length in kilometers.\n\nNumerically, discretize $[0,L]$ into $N$ uniform elements, and enforce an explicit time integration with a Courant-Friedrichs-Lewy (CFL) condition based on the maximum characteristic speed you derive from $f'(\\rho)$; use a fixed CFL number less than $1$. Clip densities to the physically admissible interval $[0,\\rho_{\\max}]$ if needed. Assume a uniform initial density $\\rho(x,0)=\\rho_{\\mathrm{init}}$ in vehicles per kilometer. The merge priority at $x=0$ is specified by a fixed fraction $p \\in (0,1)$ assigned to the upstream mainline; the on-ramp receives the complementary fraction $(1-p)$, subject to demand-limited and supply-limited constraints. No relaxation terms or additional source terms aside from the boundary merge are to be included.\n\nUse the following test suite of three parameter sets, each specified with consistent units as indicated. In all cases, velocities are in kilometers per second, densities are in vehicles per kilometer, fluxes are in vehicles per second, lengths are in kilometers, times are in seconds, and angles are not involved.\n\n- Test Case $1$ (happy path, no spillback expected):\n  - $L = 1.0$, $N = 200$, $T = 200.0$, $\\mathrm{CFL} = 0.9$.\n  - $V_{\\max} = 0.03$, $\\rho_{\\max} = 180.0$, $\\rho_{\\mathrm{init}} = 40.0$.\n  - $\\rho_{\\mathrm{up}} = 60.0$, $\\rho_{\\mathrm{down}} = 40.0$.\n  - $q_{\\mathrm{r}} = 0.10$, $p = 0.70$, $L_{\\mathrm{ramp}} = 0.50$, $\\rho_{\\mathrm{j,r}} = 150.0$.\n\n- Test Case $2$ (congestion with queue growth, but no spillback):\n  - $L = 1.0$, $N = 200$, $T = 200.0$, $\\mathrm{CFL} = 0.9$.\n  - $V_{\\max} = 0.03$, $\\rho_{\\max} = 180.0$, $\\rho_{\\mathrm{init}} = 40.0$.\n  - $\\rho_{\\mathrm{up}} = 80.0$, $\\rho_{\\mathrm{down}} = 160.0$.\n  - $q_{\\mathrm{r}} = 0.60$, $p = 0.70$, $L_{\\mathrm{ramp}} = 1.00$, $\\rho_{\\mathrm{j,r}} = 150.0$.\n\n- Test Case $3$ (congestion with spillback):\n  - $L = 1.0$, $N = 200$, $T = 200.0$, $\\mathrm{CFL} = 0.9$.\n  - $V_{\\max} = 0.03$, $\\rho_{\\max} = 180.0$, $\\rho_{\\mathrm{init}} = 40.0$.\n  - $\\rho_{\\mathrm{up}} = 80.0$, $\\rho_{\\mathrm{down}} = 160.0$.\n  - $q_{\\mathrm{r}} = 1.20$, $p = 0.70$, $L_{\\mathrm{ramp}} = 0.20$, $\\rho_{\\mathrm{j,r}} = 150.0$.\n\nFor each test case, run the DG solver and determine whether queue spillback occurs at any time within $[0,T]$. Represent the spillback outcome as $0$ for “no spillback” and $1$ for “spillback occurs.” Your program should produce a single line of output containing the results for the three test cases as a comma-separated list enclosed in square brackets, for example $[0,1,1]$. All numerical answers implied by your computation are in the units specified above; the final printed outputs are integers without unit symbols.",
            "solution": "The problem requires the development and application of a Discontinuous Galerkin (DG) method of degree zero for the one-dimensional scalar hyperbolic conservation law governing traffic flow, known as the Lighthill-Whitham-Richards (LWR) model.\n\nThe governing partial differential equation (PDE) is:\n$$\n\\partial_t \\rho(x,t) + \\partial_x f(\\rho(x,t)) = 0\n$$\nwhere $\\rho(x,t)$ is the traffic density and $f(\\rho)$ is the traffic flux. The spatial domain is $x \\in [0,L]$. The problem specifies the Greenshields model for the fundamental diagram:\n$$\nV(\\rho) = V_{\\max}\\left(1 - \\frac{\\rho}{\\rho_{\\max}}\\right)\n$$\n$$\nf(\\rho) = \\rho V(\\rho) = V_{\\max}\\left(\\rho - \\frac{\\rho^2}{\\rho_{\\max}}\\right)\n$$\nThis flux function $f(\\rho)$ is a strictly concave parabola with roots at $\\rho=0$ and $\\rho=\\rho_{\\max}$.\n\nFirst, we establish key properties of the fundamental diagram. The characteristic speed is given by $c(\\rho) = f'(\\rho)$:\n$$\nf'(\\rho) = V_{\\max}\\left(1 - \\frac{2\\rho}{\\rho_{\\max}}\\right)\n$$\nThe maximum absolute characteristic speed, required for the CFL condition, is $\\max_{\\rho \\in [0, \\rho_{\\max}]} |f'(\\rho)| = V_{\\max}$, which occurs at $\\rho=0$ and $\\rho=\\rho_{\\max}$.\n\nThe critical density, $\\rho_c$, is the density at which the flux is maximized. This occurs when $f'(\\rho_c) = 0$:\n$$\nV_{\\max}\\left(1 - \\frac{2\\rho_c}{\\rho_{\\max}}\\right) = 0 \\implies \\rho_c = \\frac{\\rho_{\\max}}{2}\n$$\nThe capacity, $C$ (or $f_{\\max}$), is the maximum flux, achieved at the critical density:\n$$\nC = f(\\rho_c) = V_{\\max}\\left(\\frac{\\rho_{\\max}}{2} - \\frac{(\\rho_{\\max}/2)^2}{\\rho_{\\max}}\\right) = \\frac{V_{\\max}\\rho_{\\max}}{4}\n$$\nFor Riemann problems, it is useful to define demand and supply functions. The demand $D(\\rho)$ is the maximum flow an upstream region with density $\\rho$ can send, while the supply $S(\\rho)$ is the maximum flow a downstream region with density $\\rho$ can receive. For a concave flux function:\n$$\nD(\\rho) = \\begin{cases} f(\\rho) & \\text{if } \\rho \\le \\rho_c \\\\ C & \\text{if } \\rho > \\rho_c \\end{cases}\n$$\n$$\nS(\\rho) = \\begin{cases} C & \\text{if } \\rho \\le \\rho_c \\\\ f(\\rho) & \\text{if } \\rho > \\rho_c \\end{cases}\n$$\n\nThe DG method of degree zero (DG0) is employed. The domain $[0,L]$ is partitioned into $N$ uniform cells (elements) $I_j = [x_{j-1/2}, x_{j+1/2}]$ for $j=1, \\dots, N$, each of width $\\Delta x = L/N$. In DG0, the solution $\\rho(x,t)$ is approximated by a piecewise constant function:\n$$\n\\rho_h(x,t) = \\sum_{j=1}^{N} \\rho_j(t) \\phi_j(x), \\quad \\text{where} \\quad \\phi_j(x) = \\begin{cases} 1 & \\text{if } x \\in I_j \\\\ 0 & \\text{otherwise} \\end{cases}\n$$\nThe weak formulation is obtained by multiplying the PDE by a test function $v(x)$ and integrating over an element $I_j$. For DG0, the test function is also piecewise constant, $v(x) = \\phi_j(x)$.\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} \\partial_t \\rho_h(x,t) \\phi_j(x) \\,dx + \\int_{x_{j-1/2}}^{x_{j+1/2}} \\partial_x f(\\rho_h(x,t)) \\phi_j(x) \\,dx = 0\n$$\nSubstituting $\\rho_h(x,t) = \\rho_j(t)$ within $I_j$ and integrating the first term gives $\\Delta x \\frac{d\\rho_j}{dt}$. For the second term, we apply integration by parts:\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} \\partial_x f(\\rho_h) \\,dx = f(\\rho_h(x_{j+1/2}^-,t)) - f(\\rho_h(x_{j-1/2}^+,t))\n$$\nwhere $x_{j \\pm 1/2}^\\pm$ denotes the limit from inside/outside the cell. The values $f(\\rho_h)$ at the cell interfaces are discontinuous and must be replaced by a single-valued numerical flux, $\\hat{f}$. The semi-discrete scheme for cell $j$ becomes:\n$$\n\\Delta x \\frac{d\\rho_j}{dt} + \\hat{f}_{j+1/2} - \\hat{f}_{j-1/2} = 0 \\implies \\frac{d\\rho_j}{dt} = -\\frac{1}{\\Delta x}(\\hat{f}_{j+1/2} - \\hat{f}_{j-1/2})\n$$\nThis is identical to a first-order finite volume scheme, which is expected for DG0. Time is discretized using an explicit forward Euler method with a fixed time step $\\Delta t$ determined by the CFL condition:\n$$\n\\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\max|f'(\\rho)|} = \\mathrm{CFL} \\frac{\\Delta x}{V_{\\max}}, \\quad \\text{with } \\mathrm{CFL} < 1\n$$\nThe fully discrete update is:\n$$\n\\rho_j^{n+1} = \\rho_j^n - \\frac{\\Delta t}{\\Delta x}(\\hat{f}_{j+1/2}^n - \\hat{f}_{j-1/2}^n)\n$$\n\nThe numerical fluxes $\\hat{f}$ are defined as follows:\n1.  **Interior Interfaces** ($j=1, \\dots, N-1$): The Godunov flux is used. For a concave flux function, it is given by the solution to the Riemann problem between states $\\rho_j$ and $\\rho_{j+1}$, which simplifies to:\n    $$\n    \\hat{f}_{j+1/2} = F_G(\\rho_j, \\rho_{j+1}) = \\min(D(\\rho_j), S(\\rho_{j+1}))\n    $$\n2.  **Right Boundary** ($x=L$): The flux $\\hat{f}_{N+1/2}$ is determined by the Riemann problem between the interior state $\\rho_N$ and the external downstream state $\\rho_{\\mathrm{down}}$:\n    $$\n    \\hat{f}_{N+1/2} = F_G(\\rho_N, \\rho_{\\mathrm{down}}) = \\min(D(\\rho_N), S(\\rho_{\\mathrm{down}}))\n    $$\n3.  **Left Boundary** ($x=0$): The flux $\\hat{f}_{1/2}$ models a merge. It is the total flow entering the domain, resulting from combining the upstream mainline demand $d_m = D(\\rho_{\\mathrm{up}})$ and the on-ramp demand $d_r = q_{\\mathrm{r}}$, constrained by the supply of the first cell $S_1 = S(\\rho_1)$. The problem specifies a priority split with fraction $p$ for the mainline and $1-p$ for the ramp. This is modeled by first allocating the available supply $S_1$ according to these fractions, calculating provisional flows, and then allowing one stream to use any supply unused by the other. The admitted flows for mainline ($F_m$) and ramp ($F_r$) are calculated as:\n    a. Provisional flows based on allocated supply:\n    $$ F'_m = \\min(d_m, p \\cdot S_1) \\quad \\text{and} \\quad F'_r = \\min(d_r, (1-p) \\cdot S_1) $$\n    b. Unused supply from each allocation:\n    $$ S_{m,\\text{rem}} = p \\cdot S_1 - F'_m \\quad \\text{and} \\quad S_{r,\\text{rem}} = (1-p) \\cdot S_1 - F'_r $$\n    c. Final flows after redistributing unused supply:\n    $$ F_m = F'_m + \\min(d_m - F'_m, S_{r,\\text{rem}}) $$\n    $$ F_r = F'_r + \\min(d_r - F'_r, S_{m,\\text{rem}}) $$\n    The numerical flux at the boundary is the total incoming flow:\n    $$\n    \\hat{f}_{1/2} = F_m + F_r\n    $$\n\nThe on-ramp queue dynamics follow a reservoir model. The queue size $Q(t)$ (in vehicles) evolves according to:\n$$\n\\frac{dQ}{dt} = q_{\\mathrm{r}} - F_{\\mathrm{r}}(t)\n$$\nwhere $F_r(t)$ is the admitted ramp flow from the merge solver. Discretizing with forward Euler:\n$$\nQ^{n+1} = \\max(0, Q^n + \\Delta t (q_{\\mathrm{r}} - F^n_{\\mathrm{r}}))\n$$\nThe physical length of the queue is $\\ell_{\\mathrm{q}}(t) = Q(t)/\\rho_{\\mathrm{j,r}}$. Spillback occurs if $\\ell_{\\mathrm{q}}(t) \\ge L_{\\mathrm{ramp}}$ at any time $t \\in [0,T]$.\n\nTo ensure physical realism, the computed densities are clipped to the range $[0, \\rho_{\\max}]$ after each time step. The simulation starts with a uniform initial density $\\rho(x,0) = \\rho_{\\mathrm{init}}$ and an empty ramp queue $Q(0)=0$. For each test case, we run the simulation up to time $T$ and record if the spillback condition is ever met.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the DG0 traffic flow solver.\n    \"\"\"\n    test_cases = [\n        # Test Case 1 (happy path, no spillback expected)\n        {\n            'L': 1.0, 'N': 200, 'T': 200.0, 'CFL': 0.9,\n            'V_max': 0.03, 'rho_max': 180.0, 'rho_init': 40.0,\n            'rho_up': 60.0, 'rho_down': 40.0,\n            'q_r': 0.10, 'p': 0.70, 'L_ramp': 0.50, 'rho_j_r': 150.0\n        },\n        # Test Case 2 (congestion with queue growth, but no spillback)\n        {\n            'L': 1.0, 'N': 200, 'T': 200.0, 'CFL': 0.9,\n            'V_max': 0.03, 'rho_max': 180.0, 'rho_init': 40.0,\n            'rho_up': 80.0, 'rho_down': 160.0,\n            'q_r': 0.60, 'p': 0.70, 'L_ramp': 1.00, 'rho_j_r': 150.0\n        },\n        # Test Case 3 (congestion with spillback)\n        {\n            'L': 1.0, 'N': 200, 'T': 200.0, 'CFL': 0.9,\n            'V_max': 0.03, 'rho_max': 180.0, 'rho_init': 40.0,\n            'rho_up': 80.0, 'rho_down': 160.0,\n            'q_r': 1.20, 'p': 0.70, 'L_ramp': 0.20, 'rho_j_r': 150.0\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(**params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(L, N, T, CFL, V_max, rho_max, rho_init, \n                   rho_up, rho_down, q_r, p, L_ramp, rho_j_r):\n    \"\"\"\n    Executes the DG0 simulation for one set of parameters.\n\n    Returns:\n        int: 1 if spillback occurs, 0 otherwise.\n    \"\"\"\n    # Derived parameters\n    dx = L / N\n    dt = CFL * dx / V_max\n    rho_c = rho_max / 2.0\n    C = V_max * rho_max / 4.0\n\n    # Helper functions for the fundamental diagram\n    def f(rho):\n        return V_max * (rho - rho**2 / rho_max)\n\n    def D(rho):\n        return np.where(rho <= rho_c, f(rho), C)\n\n    def S(rho):\n        return np.where(rho <= rho_c, C, f(rho))\n\n    # Initialization\n    rho = np.full(N, rho_init, dtype=float)\n    Q = 0.0\n    t = 0.0\n    spillback_occurred = False\n    \n    num_steps = int(np.ceil(T / dt))\n\n    for _ in range(num_steps):\n        # Calculate fluxes at all N+1 interfaces\n        fluxes = np.zeros(N + 1, dtype=float)\n        \n        # --- Left boundary (x=0, interface j=1/2) ---\n        # Merge Riemann solver\n        d_m = D(np.array([rho_up]))[0] # D expects array, get scalar\n        d_r = q_r\n        s_1 = S(np.array([rho[0]]))[0]   # S expects array, get scalar\n        \n        # Provisional flows based on priority split of supply\n        F_m_prov = min(d_m, p * s_1)\n        F_r_prov = min(d_r, (1.0 - p) * s_1)\n\n        # Unused supply\n        s_m_rem = p * s_1 - F_m_prov\n        s_r_rem = (1.0 - p) * s_1 - F_r_prov\n\n        # Final flows with redistribution of unused supply\n        F_m = F_m_prov + min(d_m - F_m_prov, s_r_rem)\n        F_r = F_r_prov + min(d_r - F_r_prov, s_m_rem)\n\n        fluxes[0] = F_m + F_r\n        \n        # Store admitted ramp flow for queue update\n        F_r_admitted = F_r\n\n        # --- Interior interfaces (j=3/2 to N-1/2) ---\n        D_interior = D(rho[:-1])\n        S_interior = S(rho[1:])\n        fluxes[1:N] = np.minimum(D_interior, S_interior)\n\n        # --- Right boundary (x=L, interface j=N+1/2) ---\n        fluxes[N] = min(D(np.array([rho[-1]]))[0], S(np.array([rho_down]))[0])\n\n        # DG0/FVM update step (explicit Euler)\n        rho = rho - (dt / dx) * (fluxes[1:] - fluxes[:-1])\n        \n        # Clip densities to physical bounds\n        rho = np.clip(rho, 0.0, rho_max)\n\n        # Update queue dynamics\n        Q = max(0.0, Q + dt * (q_r - F_r_admitted))\n\n        # Check for spillback\n        if not spillback_occurred and (Q / rho_j_r) >= L_ramp:\n            spillback_occurred = True\n            # Optimization: if problem only asks for occurrence, not time, we can stop.\n            break\n\n        t += dt\n    \n    return 1 if spillback_occurred else 0\n\nsolve()\n```"
        },
        {
            "introduction": "Many important hyperbolic systems, such as the shallow water equations, include source terms that balance flux gradients to create steady-state equilibria. A standard discretization can fail to preserve these delicate balances, leading to spurious oscillations. This exercise introduces the concept of a \"well-balanced\" scheme, a critical feature for robustly modeling such systems . Your task is to derive a specific form of the source term discretization that ensures a DG method can perfectly maintain a \"lake at rest\"—a fundamental hydrostatic equilibrium.",
            "id": "3377340",
            "problem": "Consider the one-dimensional shallow water equations over a fixed bathymetry for height $h(x,t)$, velocity $u(x,t)$, and bed elevation $b(x)$, with gravitational acceleration $g>0$,\n$$\n\\partial_{t} h + \\partial_{x} (h u) = 0, \\qquad \\partial_{t} (h u) + \\partial_{x}\\!\\left(h u^{2} + \\frac{g}{2} h^{2}\\right) = - g h \\,\\partial_{x} b.\n$$\nA lake-at-rest state is defined by $u(x,t) = 0$ and free-surface elevation $H(x) = h(x,t) + b(x)$ equal to a spatial constant $H_{0}$, so that $h(x,t) = H_{0} - b(x)$.\n\nIn a Discontinuous Galerkin (DG) method for the hyperbolic system above, consider the weak formulation for the momentum equation on an element $K = [x_{L}, x_{R}]$ with a test function $\\varphi(x)$, where the hydrostatic pressure flux $\\frac{g}{2} h^{2}$ is integrated by parts and replaced at the element boundary by a consistent numerical flux, while the source $-g h\\,\\partial_{x} b$ is discretized using a path-conservative interface contribution derived from the nonconservative product formalism. Specifically, the face source contribution at an interface with left and right traces $(b_{L}, h_{L})$ and $(b_{R}, h_{R})$ is taken as\n$$\nS_{\\text{face}} = g\\,\\varphi(x_{f})\\,n_{f}\\,\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s),\n$$\nwhere $x_{f}$ is the interface location, $n_{f} \\in \\{-1,+1\\}$ is the outward unit normal of the element at the face, and the straight-line path connects the left and right face states via $b(s) = (1-s)\\,b_{L} + s\\,b_{R}$, with the lake-at-rest relation enforced pointwise along the path, $h(s) = H_{0} - b(s)$.\n\nStarting only from the shallow water model, the lake-at-rest characterization, and the DG weak-form construction above, derive the closed-form analytic expression of the face source contribution for the straight-line path,\n$$\nS_{\\text{face}} = g\\,\\varphi(x_{f})\\,n_{f}\\,\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s),\n$$\nexpressed purely in terms of $g$, $H_{0}$, $b_{L}$, and $b_{R}$. Your final answer must be the single analytical expression for $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$; do not include $\\varphi(x_{f})$ or $n_{f}$ in the final expression. No numerical rounding is required, and no units should be reported in the final answer.",
            "solution": "The problem is valid. It is a well-posed mathematical problem grounded in the established theory of numerical methods for hyperbolic partial differential equations. All information required for the derivation is provided.\n\nThe objective is to derive a closed-form analytical expression for the face source contribution term, specifically for the quantity $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$. This term arises in path-conservative Discontinuous Galerkin schemes for the shallow water equations.\n\nThe problem provides the following definitions for the path connecting the left state $(b_{L}, h_{L})$ and right state $(b_{R}, h_{R})$ at a cell interface:\n1.  A straight-line path for the bed elevation $b(s)$ parameterized by $s \\in [0, 1]$:\n    $$b(s) = (1-s)b_{L} + s\\,b_{R}$$\n2.  The water height $h(s)$ along this path is determined by the lake-at-rest condition, $h(s) + b(s) = H_{0}$, where $H_{0}$ is the constant free-surface elevation. This gives:\n    $$h(s) = H_{0} - b(s)$$\n\nThe quantity to be calculated is the path integral $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$. This is formally a Riemann-Stieltjes integral. We can evaluate it by changing the variable of integration from the parameter $s$ to the bathymetry variable $b$.\n\nThe path for $b(s)$ starts at $s=0$ and ends at $s=1$. Let us evaluate the corresponding values of $b$:\n-   At $s=0$, the starting point of the path is $b(0) = (1-0)b_{L} + (0)b_{R} = b_{L}$.\n-   At $s=1$, the ending point of the path is $b(1) = (1-1)b_{L} + (1)b_{R} = b_{R}$.\n\nThe integrand is $h(s)$, which is defined in terms of $b(s)$ as $h(s) = H_{0} - b(s)$. Since the integration is with respect to $b$, we can express the integrand directly as a function of $b$, namely $H_{0} - b$.\n\nWith these substitutions, the integral transforms from a Riemann-Stieltjes integral over the parameter $s \\in [0, 1]$ to a standard Riemann integral over the variable $b$ from $b_{L}$ to $b_{R}$:\n$$ \\int_{0}^{1} h(s)\\,\\mathrm{d}b(s) = \\int_{b_{L}}^{b_{R}} (H_{0} - b)\\,\\mathrm{d}b $$\n\nWe now compute this definite integral. The antiderivative of the integrand $(H_{0} - b)$ with respect to $b$ is:\n$$ \\int (H_{0} - b)\\,\\mathrm{d}b = H_{0}b - \\frac{1}{2}b^{2} $$\n\nEvaluating this antiderivative at the upper and lower limits of integration, $b_{R}$ and $b_{L}$, yields:\n$$ \\left[ H_{0}b - \\frac{1}{2}b^{2} \\right]_{b_{L}}^{b_{R}} = \\left(H_{0}b_{R} - \\frac{1}{2}b_{R}^{2}\\right) - \\left(H_{0}b_{L} - \\frac{1}{2}b_{L}^{2}\\right) $$\n\nWe can group terms by $H_{0}$ and the quadratic terms:\n$$ H_{0}(b_{R} - b_{L}) - \\frac{1}{2}(b_{R}^{2} - b_{L}^{2}) $$\n\nTo obtain a more compact form, we use the difference of squares factorization, $b_{R}^{2} - b_{L}^{2} = (b_{R} - b_{L})(b_{R} + b_{L})$:\n$$ H_{0}(b_{R} - b_{L}) - \\frac{1}{2}(b_{R} - b_{L})(b_{R} + b_{L}) $$\n\nFactoring out the common term $(b_{R} - b_{L})$ gives:\n$$ (b_{R} - b_{L}) \\left[ H_{0} - \\frac{1}{2}(b_{R} + b_{L}) \\right] = (b_{R} - b_{L}) \\left( H_{0} - \\frac{b_{L} + b_{R}}{2} \\right) $$\nThis expression represents the value of the integral $\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$.\n\nThe problem asks for the complete expression for the face source contribution term, which is $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$. We multiply the result of the integral by the gravitational acceleration $g$:\n$$ g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s) = g(b_{R} - b_{L})\\left(H_{0} - \\frac{b_{L} + b_{R}}{2}\\right) $$\nThis is the final analytical expression in terms of the specified variables $g$, $H_{0}$, $b_{L}$, and $b_{R}$.",
            "answer": "$$\\boxed{g(b_{R} - b_{L})\\left(H_{0} - \\frac{b_{L} + b_{R}}{2}\\right)}$$"
        }
    ]
}