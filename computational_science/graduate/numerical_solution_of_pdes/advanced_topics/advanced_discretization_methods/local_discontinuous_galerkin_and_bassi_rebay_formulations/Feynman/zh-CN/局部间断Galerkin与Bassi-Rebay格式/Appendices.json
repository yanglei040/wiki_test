{
    "hands_on_practices": [
        {
            "introduction": "不同数值格式的一个关键区别在于它们如何处理高频振荡，这直接影响到解的光滑性和稳定性。本练习提供了一种具体的分析方法，用于量化局部间断Galerkin（LDG）和Bassi-Rebay 2（BR2）格式在处理这些振荡时的差异。通过为一个简单的一维热方程算例构建并分析系统矩阵，我们将直接比较这两种格式对最具挑战性的高频模式的内在阻尼特性。",
            "id": "3417382",
            "problem": "考虑一维热方程 $u_{t} = \\nu u_{xx}$，定义在周期性区域 $x \\in [0,2]$ 上，其中扩散系数为常数 $\\nu = 1$。使用包含两个尺寸为 $h=1$ 的单元的均匀网格对该区域进行离散化，并在每个单元上使用阶数为 $p=2$ 的 Gauss–Lobatto–Legendre 基 $\\{\\phi_{0},\\phi_{1},\\phi_{2}\\}$，其节点位于 $\\xi=-1,0,1$ (映射到物理单元上)，并采用标准的 3 点 Gauss–Lobatto 权重 $\\{w_{1},w_{2},w_{3}\\}=\\{\\tfrac{1}{3},\\tfrac{4}{3},\\tfrac{1}{3}\\}$。采用对角质量集中后，单元质量矩阵为 $M_{e}=\\tfrac{h}{2}\\operatorname{diag}(w_{1},w_{2},w_{3})$，且全局质量矩阵是块对角的。\n\n从弱形式以及针对扩散问题的 Local Discontinuous Galerkin (LDG) 和 Bassi–Rebay 2 (BR2) 格式的定义出发。对于 BR2，采用对称内部罚函数表示，其稳定化参数为 $\\sigma_{\\mathrm{BR2}}$，界面双线性形式为\n$$\na_{e}(u,v) \\;=\\; - \\nu \\left\\{ \\partial_{n} u \\right\\} [v] \\;-\\; \\nu \\left\\{ \\partial_{n} v \\right\\} [u] \\;+\\; \\nu \\,\\frac{\\sigma_{\\mathrm{BR2}}}{h}\\,[u]\\,[v],\n$$\n其中 $[u]=u^{-}-u^{+}$ 表示界面上的跳跃，而 $\\{\\partial_{n} u\\}=\\tfrac{1}{2}(\\partial_{n}u^{-}+\\partial_{n}u^{+})$ 是平均法向导数。对于 LDG，使用交替通量 LDG 格式，并通过静态凝聚辅助梯度变量来获得一个具有相同结构类型和稳定化参数 $\\sigma_{\\mathrm{LDG}}$ 的凝聚双线性形式。\n\n在给定的网格和基上，显式写出 BR2 的全局刚度贡献，该贡献被限制在高频界面子空间中。在此子空间中，只有单元边界处的端点自由度是激活的（即，在 $\\xi= \\pm 1$ 处的节点值可能为非零，而在 $\\xi=0$ 处的内部节点值为零）。在此子空间中，BR2 刚度简化为两个形式如下的 $2\\times 2$ 界面块之和\n$$\nK^{(\\mathrm{int})}_{\\mathrm{BR2}} \\;=\\; \\nu \\,\\frac{\\sigma_{\\mathrm{BR2}}}{h}\n\\begin{pmatrix}\n1  &-1\\\\\n-1  &1\n\\end{pmatrix}\n$$\n这两个界面块分别位于两个界面上，并被组装到与自由度排序 $(u_{0,1},u_{0,2},u_{0,3},u_{1,1},u_{1,2},u_{1,3})$ 相对应的 $6\\times 6$ 全局布局中，其中 $u_{e,i}$ 表示单元 $e$ 上的第 $i$ 个节点值。使用每个节点矩阵元为 $\\tfrac{h}{2} w_{i}$ 的对角全局质量矩阵，对限制在界面子空间内的半离散算子 $A_{\\mathrm{BR2}} = M^{-1} K_{\\mathrm{BR2}}$ 进行特征分解，并找出最大阻尼率（即 $A_{\\mathrm{BR2}}$ 的最大特征值），该值表征了高频耗散。\n\n类似地，构建带有稳定化参数 $\\sigma_{\\mathrm{LDG}}$ 的 LDG 凝聚界面刚度 $K^{(\\mathrm{int})}_{\\mathrm{LDG}}$，并在相同的界面子空间上计算 $A_{\\mathrm{LDG}}=M^{-1}K_{\\mathrm{LDG}}$ 的相应最大特征值。对于 Bassi–Rebay 2 格式，取 $\\sigma_{\\mathrm{BR2}}=6$；对于采用交替通量和标准选择以得到凝聚算子的 Local Discontinuous Galerkin 格式，取 $\\sigma_{\\mathrm{LDG}}=2$。\n\n最后，通过计算最大特征值的比率来量化高频阻尼的差异，\n$$\n\\mathcal{R} \\;=\\; \\frac{\\lambda_{\\max}(A_{\\mathrm{BR2}})}{\\lambda_{\\max}(A_{\\mathrm{LDG}})}.\n$$\n将最终答案表示为单个实数。无需单位，也无需四舍五入。",
            "solution": "用户希望我验证问题陈述的有效性，如果有效，则解决它。\n\n### 第 1 步：提取已知条件\n- **控制方程**：一维热方程，$u_{t} = \\nu u_{xx}$。\n- **区域**：$x \\in [0,2]$，周期性边界条件。\n- **扩散系数**：$\\nu = 1$。\n- **网格**：均匀网格，包含两个单元，每个单元尺寸 $h=1$。单元为 $E_0 = [0,1]$ 和 $E_1 = [1,2]$。\n- **离散化基**：每个单元上采用阶数为 $p=2$ 的 Gauss–Lobatto–Legendre 基。\n- **节点**：参考单元 $[-1,1]$ 上的节点位于 $\\xi=-1, 0, 1$。\n- **求积/集中权重**：3 点 Gauss–Lobatto 权重为 $\\{w_{1}, w_{2}, w_{3}\\} = \\{\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3}\\}$。\n- **质量矩阵**：使用对角质量集中。单元质量矩阵为 $M_{e} = \\frac{h}{2} \\operatorname{diag}(w_{1}, w_{2}, w_{3})$。\n- **BR2 格式**：对称内部罚函数表示，界面双线性形式为 $a_{e}(u,v) = - \\nu \\{ \\partial_{n} u \\} [v] - \\nu \\{ \\partial_{n} v \\} [u] + \\nu \\frac{\\sigma_{\\mathrm{BR2}}}{h}\\,[u]\\,[v]$。界面刚度块给定为 $K^{(\\mathrm{int})}_{\\mathrm{BR2}} = \\nu \\frac{\\sigma_{\\mathrm{BR2}}}{h} \\begin{pmatrix} 1  &-1\\\\ -1  &1 \\end{pmatrix}$。\n- **LDG 格式**：交替通量格式，静态凝聚以得到与 BR2 结构类型相同的界面刚度，稳定化参数为 $\\sigma_{\\mathrm{LDG}}$。\n- **关注的子空间**：高频界面子空间，其中内部节点值为零。这意味着只有单元边界处 ($\\xi = \\pm 1$) 的自由度为非零。\n- **自由度 (DoF) 排序**：全局自由度排序为 $(u_{0,1}, u_{0,2}, u_{0,3}, u_{1,1}, u_{1,2}, u_{1,3})$，其中 $u_{e,i}$ 是单元 $e$ 上的第 $i$ 个节点值。\n- **稳定化参数**：$\\sigma_{\\mathrm{BR2}} = 6$ 和 $\\sigma_{\\mathrm{LDG}} = 2$。\n- **用于分析的算子**：对于每种格式，$A = M^{-1} K$。\n- **目标**：计算最大特征值的比率，$\\mathcal{R} = \\frac{\\lambda_{\\max}(A_{\\mathrm{BR2}})}{\\lambda_{\\max}(A_{\\mathrm{LDG}})}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了偏微分方程 (PDE) 数值分析中的一个标准流程，特别是间断 Galerkin (DG) 方法的比较。问题是适定的，提供了所有必要的参数、定义和明确的目标。语言精确且客观。其设置，包括简化到界面子空间和所提供的刚度块结构，是分析 DG 格式高频耗散的常用有效技术。该问题自洽、一致且计算上可行。不存在矛盾、歧义或无效的科学前提。\n\n### 第 3 步：结论与行动\n问题有效。我现在开始求解。\n\n这个问题要求分析限制在特定子空间内的半离散算子 $A = M^{-1}K$。我们首先来定义这个子空间和相应的矩阵。\n\n网格由两个单元 $E_0 = [0,1]$ 和 $E_1 = [1,2]$ 组成。对于每个单元，我们使用 $p=2$ 的基函数，节点位于 $\\xi=-1,0,1$。\n- 对于单元 $E_0$：节点对应于物理坐标 $x=0, 0.5, 1$。自由度为 $u_{0,1}, u_{0,2}, u_{0,3}$。\n- 对于单元 $E_1$：节点对应于物理坐标 $x=1, 1.5, 2$。自由度为 $u_{1,1}, u_{1,2}, u_{1,3}$。\n\n分析被限制在“高频界面子空间”内，其中内部节点值为零。内部节点位于 $\\xi=0$，对应于自由度 $u_{0,2}$ 和 $u_{1,2}$。因此，我们设置 $u_{0,2}=0$ 和 $u_{1,2}=0$。\n激活的自由度是单元边界处的节点值：\n- $u_{0,1}$ 在 $x=0$ 处\n- $u_{0,3}$ 在 $x=1$ 处\n- $u_{1,1}$ 在 $x=1$ 处\n- $u_{1,3}$ 在 $x=2$ 处\n\n区域是周期性的，因此 $x=2$ 处的界面连接到 $x=0$。我们有两个界面：一个在 $x=1$ 处，一个在 $x=0 \\equiv 2$ 处。\n在我们受限的 4 维子空间中，根据全局索引排序的未知数向量是 $U_{sub} = (u_{0,1}, u_{0,3}, u_{1,1}, u_{1,3})^T$。\n\n首先，我们为这个子空间构建质量矩阵 $M_{sub}$。问题陈述使用了集中质量矩阵，其中 $M_e = \\frac{h}{2}\\operatorname{diag}(w_{1},w_{2},w_{3})$。当 $h=1$ 且权重为 $\\{w_1, w_2, w_3\\} = \\{\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3}\\}$ 时，单元质量矩阵为 $M_e = \\frac{1}{2}\\operatorname{diag}(\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3}) = \\operatorname{diag}(\\frac{1}{6}, \\frac{2}{3}, \\frac{1}{6})$。\n激活的自由度 ($u_{0,1}, u_{0,3}, u_{1,1}, u_{1,3}$) 对应于单元的端点（$\\xi = \\pm 1$），其权重为 $w_1 = w_3 = \\frac{1}{3}$。这些自由度中每一个的质量矩阵元是 $\\frac{h}{2}w_1 = \\frac{1}{2} \\cdot \\frac{1}{3} = \\frac{1}{6}$。\n因此，子空间质量矩阵 $M_{sub}$ 是一个 $4 \\times 4$ 的对角矩阵：\n$$\nM_{sub} = \\frac{1}{6} \\begin{pmatrix} 1  &0  &0  &0 \\\\ 0  &1  &0  &0 \\\\ 0  &0  &1  &0 \\\\ 0  &0  &0  &1 \\end{pmatrix} = \\frac{1}{6} I_4\n$$\n其逆矩阵是 $M_{sub}^{-1} = 6 I_4$。\n\n接下来，我们构建子空间中的刚度矩阵 $K_{sub}$。问题陈述这由界面贡献的总和形成。单个界面的贡献由下式给出 $K^{(\\mathrm{int})} = \\nu \\frac{\\sigma}{h} \\begin{pmatrix} 1  &-1 \\\\ -1  &1 \\end{pmatrix}$。\n\n对于 Bassi-Rebay 2 (BR2) 格式，我们有 $\\nu=1$，$h=1$，以及 $\\sigma_{\\mathrm{BR2}}=6$。\n$$\nK^{(\\mathrm{int})}_{\\mathrm{BR2}} = 1 \\cdot \\frac{6}{1} \\begin{pmatrix} 1  &-1\\\\ -1  &1 \\end{pmatrix} = 6 \\begin{pmatrix} 1  &-1\\\\ -1  &1 \\end{pmatrix}\n$$\n我们从两个界面组装全局子空间刚度矩阵 $K_{\\mathrm{BR2}, sub}$：\n1. 在 $x=1$ 处的界面：它连接自由度 $u_{0,3}$ 和 $u_{1,1}$。\n2. 在 $x=0 \\equiv 2$ 处的界面（周期性）：它连接 $u_{1,3}$（在 $x=2$ 处）和 $u_{0,1}$（在 $x=0$ 处）。\n\n将这些贡献组装到与 $U_{sub} = (u_{0,1}, u_{0,3}, u_{1,1}, u_{1,3})^T$ 对应的 $4 \\times 4$ 矩阵中：\n$$\nK_{\\mathrm{BR2}, sub} = \\begin{pmatrix}\n6  &0  &0  &-6 \\\\\n0  &6  &-6  &0 \\\\\n0  &-6  &6  &0 \\\\\n-6  &0  &0  &6\n\\end{pmatrix} = 6 \\begin{pmatrix}\n1  &0  &0  &-1 \\\\\n0  &1  &-1  &0 \\\\\n0  &-1  &1  &0 \\\\\n-1  &0  &0  &1\n\\end{pmatrix}\n$$\nBR2 格式的算子是 $A_{\\mathrm{BR2}} = M_{sub}^{-1} K_{\\mathrm{BR2}, sub}$：\n$$\nA_{\\mathrm{BR2}} = (6 I_4) \\left( 6 \\begin{pmatrix}\n1  &0  &0  &-1 \\\\\n0  &1  &-1  &0 \\\\\n0  &-1  &1  &0 \\\\\n-1  &0  &0  &1\n\\end{pmatrix} \\right) = 36 \\begin{pmatrix}\n1  &0  &0  &-1 \\\\\n0  &1  &-1  &0 \\\\\n0  &-1  &1  &0 \\\\\n-1  &0  &0  &1\n\\end{pmatrix}\n$$\n为了求 $A_{\\mathrm{BR2}}$ 的特征值，我们求其矩阵部分的特征值。通过置换行和列，该矩阵与一个块对角矩阵相似：\n$$\n\\begin{pmatrix}\n1  &-1  &0  &0 \\\\\n-1  &1  &0  &0 \\\\\n0  &0  &1  &-1 \\\\\n0  &0  &-1  &1\n\\end{pmatrix}\n$$\n每个块是 $J = \\begin{pmatrix} 1  &-1 \\\\ -1  &1 \\end{pmatrix}$。$J$ 的特征值由 $\\det(J - \\lambda I) = (1-\\lambda)^2 - 1 = \\lambda^2 - 2\\lambda = \\lambda(\\lambda-2) = 0$ 给出。$J$ 的特征值为 $0$ 和 $2$。\n因此，$A_{\\mathrm{BR2}}$ 矩阵部分的特征值为 $\\{0, 2, 0, 2\\}$。$A_{\\mathrm{BR2}}$ 的特征值为 $36 \\times \\{0, 2, 0, 2\\} = \\{0, 72, 0, 72\\}$。\n最大特征值为 $\\lambda_{\\max}(A_{\\mathrm{BR2}}) = 72$。\n\n我们对 Local Discontinuous Galerkin (LDG) 格式重复此过程。问题陈述其具有相同的结构形式，但 $\\sigma_{\\mathrm{LDG}} = 2$。\nLDG 的界面刚度块是：\n$$\nK^{(\\mathrm{int})}_{\\mathrm{LDG}} = \\nu \\frac{\\sigma_{\\mathrm{LDG}}}{h} \\begin{pmatrix} 1  &-1\\\\ -1  &1 \\end{pmatrix} = 1 \\cdot \\frac{2}{1} \\begin{pmatrix} 1  &-1\\\\ -1  &1 \\end{pmatrix} = 2 \\begin{pmatrix} 1  &-1\\\\ -1  &1 \\end{pmatrix}\n$$\n子空间刚度矩阵 $K_{\\mathrm{LDG}, sub}$ 是：\n$$\nK_{\\mathrm{LDG}, sub} = 2 \\begin{pmatrix}\n1  &0  &0  &-1 \\\\\n0  &1  &-1  &0 \\\\\n0  &-1  &1  &0 \\\\\n-1  &0  &0  &1\n\\end{pmatrix}\n$$\nLDG 格式的算子是 $A_{\\mathrm{LDG}} = M_{sub}^{-1} K_{\\mathrm{LDG}, sub}$：\n$$\nA_{\\mathrm{LDG}} = (6 I_4) \\left( 2 \\begin{pmatrix}\n1  &0  &0  &-1 \\\\\n0  &1  &-1  &0 \\\\\n0  &-1  &1  &0 \\\\\n-1  &0  &0  &1\n\\end{pmatrix} \\right) = 12 \\begin{pmatrix}\n1  &0  &0  &-1 \\\\\n0  &1  &-1  &0 \\\\\n0  &-1  &1  &0 \\\\\n-1  &0  &0  &1\n\\end{pmatrix}\n$$\n$A_{\\mathrm{LDG}}$ 的特征值为 $12 \\times \\{0, 2, 0, 2\\} = \\{0, 24, 0, 24\\}$。\n最大特征值为 $\\lambda_{\\max}(A_{\\mathrm{LDG}}) = 24$。\n\n最后，我们计算比率 $\\mathcal{R}$：\n$$\n\\mathcal{R} = \\frac{\\lambda_{\\max}(A_{\\mathrm{BR2}})}{\\lambda_{\\max}(A_{\\mathrm{LDG}})} = \\frac{72}{24} = 3\n$$\n这个比率量化了在给定参数下两种格式之间高频阻尼的差异，表明在此网格的最高频率模式下，BR2 提供的阻尼是 LDG 的三倍。",
            "answer": "$$\n\\boxed{3}\n$$"
        },
        {
            "introduction": "在从纯扩散问题过渡到更复杂的对流占优问题时，格式的稳定性成为一个首要问题。本练习将通过一个计算实验，探讨如何通过调整LDG数值通量（通过上游偏置参数 $\\theta$）来增强稳定性。我们将量化这种调整在稳定高频分量的同时，是否会对解的光滑部分产生过度阻尼的副作用，从而揭示稳定性和精度之间的权衡。",
            "id": "3417437",
            "problem": "考虑一个周期性域上的一维线性对流扩散方程，通过引入一个辅助梯度变量，将其写成一阶形式：求标量场 $u(x,t)$ 和辅助场 $q(x,t)$，使得\n$$\nu_t + b\\,u_x = \\nu\\,u_{xx}, \\quad x \\in [0,L], \\ t \\ge 0,\n$$\n等价地，\n$$\nu_t + b\\,u_x = \\nu\\,q_x, \\qquad q - u_x = 0,\n$$\n边界条件为周期性的 $u(0,t) = u(L,t)$ 和 $q(0,t) = q(L,t)$。此处 $b$ 是恒定的对流速度，$\\nu$ 是恒定的扩散系数。本题的目标是在局部不连续伽辽金 (LDG) 通量族内，研究在用于定义辅助梯度变量的数值通量中引入一个轻微的迎风偏置，是否可以在扩散主导的情况下提高稳定性，而不过度阻尼平滑模态。作为背景，Bassi–Rebay (BR) 类格式，如 Bassi–Rebay 2 (BR2)，是用于扩散项的 LDG 方法的广泛替代方案；我们将引入一个反映此类方法特点的、类似内部罚的简单基准进行比较。\n\n您将在一个由 $N$ 个等长 $h = L/N$ 的单元组成的均匀网格上，使用分片常数近似（零次多项式）。单元中心为 $x_i = (i+\\tfrac{1}{2})h$，其中 $i=0,\\dots,N-1$。用 $u_i(t)$ 表示 $u$ 在单元 $i$ 上的近似，用 $q_i(t)$ 表示 $q$ 在单元 $i$ 上的近似，两者在每个单元上均被视为常数。设单元 $i$ 和单元 $i+1$ 之间的界面索引为 $i+\\tfrac{1}{2}$，并考虑周期性环绕。\n\n上述系统针对分片常数的守恒形式半离散 LDG 格式如下：\n- 对于辅助方程，对每个单元 $i$：\n$$\nh\\, q_i - \\big(\\widehat{u}^{\\text{diff}}_{i+\\frac{1}{2}} - \\widehat{u}^{\\text{diff}}_{i-\\frac{1}{2}}\\big) = 0,\n$$\n其中 $\\widehat{u}^{\\text{diff}}_{i+\\frac{1}{2}}$ 是界面上 $u$ 的单值数值通量，仅用于 $q$ 方程。\n- 对于主方程，对每个单元 $i$：\n$$\nh\\, \\frac{d u_i}{d t} + \\Big( b\\,\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}} - \\nu\\,\\widehat{q}_{i+\\frac{1}{2}} \\Big) - \\Big( b\\,\\widehat{u}^{\\text{conv}}_{i-\\frac{1}{2}} - \\nu\\,\\widehat{q}_{i-\\frac{1}{2}} \\Big) = 0,\n$$\n其中 $\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}}$ 是对流的标准迎风数值通量，而 $\\widehat{q}_{i+\\frac{1}{2}}$ 是在 $u$ 方程中使用的 $q$ 的单值数值通量。\n\n通过迎风格式定义对流数值通量\n$$\n\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}} =\n\\begin{cases}\nu_i, & b \\ge 0,\\\\\nu_{i+1}, & b  0,\n\\end{cases}\n$$\n并将扩散 $q$-通量定义为中心平均\n$$\n\\widehat{q}_{i+\\frac{1}{2}} = \\tfrac{1}{2}(q_i + q_{i+1}).\n$$\n在用于 $q$ 方程的 $u$-通量中引入一个迎风偏置参数 $\\theta \\in [0,1]$，设置\n$$\n\\widehat{u}^{\\text{diff}}_{i+\\frac{1}{2}} = (1-\\theta)\\,\\tfrac{1}{2}\\,(u_i + u_{i+1}) + \\theta\\,u_i,\n$$\n这对应于中心平均和左迹（一个固定方向）的凸组合，从而当 $\\theta$ 是小的正数时，以一种轻微的迎风方式使离散梯度产生偏置。从半离散系统中消去 $q_i$ 会得到一个形式如下的封闭常微分方程线性系统\n$$\n\\frac{d\\mathbf{u}}{dt} = A\\,\\mathbf{u},\n$$\n其中 $\\mathbf{u} \\in \\mathbb{R}^{N}$ 是单元平均值向量，$A \\in \\mathbb{R}^{N \\times N}$ 是依赖于 $b$、$\\nu$、$L$、$N$ 和 $\\theta$ 的半离散算子。\n\n为与类似 Bassi–Rebay 的基准进行比较，考虑一个直接对未知数 $u$ 定义的类似内部罚的格式（它在一维空间和分片常数下反映了 Bassi–Rebay 类的特点）\n$$\n\\frac{d u_i}{dt} = -\\frac{b}{h}\\,\\Big(\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}} - \\widehat{u}^{\\text{conv}}_{i-\\frac{1}{2}}\\Big) + \\nu\\,\\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2},\n$$\n同样具有周期性环绕，并使用与上面相同的迎风对流通量 $\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}}$。这会得到另一个形式如下的线性系统\n$$\n\\frac{d\\mathbf{u}}{dt} = A\\,\\mathbf{u},\n$$\n其中的矩阵 $A$ 不同。\n\n您的任务：\n1. 从上述积分形式中，通过在半离散层面上消去辅助变量 $q$，推导并实现一个函数，该函数根据参数 $N$、$L$、$b$、$\\nu$ 和 $\\theta$ 组装 LDG 格式的矩阵 $A$。使用周期性边界条件。\n2. 实现上述指定的、对应于 Bassi–Rebay 类的类似内部罚的基准算子 $A$。\n3. 对于任何给定的算子 $A$，定义以下诊断量：\n   - 谱横坐标裕度 $m = -\\max\\{\\Re(\\lambda): \\lambda \\in \\sigma(A)\\}$，其中 $\\sigma(A)$ 表示谱。当且仅当 $\\max\\{\\Re(\\lambda)\\} \\le 10^{-10}$ 时，将格式报告为稳定，并将 $m$ 报告为非负浮点数。\n   - 平滑模态阻尼比 $r = \\frac{-\\Re(\\lambda_{\\text{eff}})}{\\nu\\,k^2}$，其中 $k=1$ 是长度为 $L = 2\\pi$ 的周期区间上的基波波数，而 $\\lambda_{\\text{eff}}$ 是 $A$ 相对于离散正弦模态 $v_i = \\sin(k x_i)$ 使用欧几里得内积的瑞利商，即 $\\lambda_{\\text{eff}} = \\frac{v^\\top (A v)}{v^\\top v}$。该比率量化了最平滑的非平凡模态相对于连续介质速率 $-\\nu k^2$ 的过度阻尼。\n4. 您的程序必须构建 $A$，计算特征值，并为下面指定的套件中的每个测试用例返回布尔稳定性判断、裕度 $m$ 和比率 $r$。\n\n使用以下测试套件（所有参数均为无量纲，其中 $L$ 的单位与 $x$ 相同，$b$ 的单位为每单位时间的 $x$，$ \\nu$ 的单位为每单位时间的 $x^2$）：\n- 用例 1：LDG，$N=40$, $L=2\\pi$, $b=0.2$, $\\nu=1.0$, $\\theta=0.0$。\n- 用例 2：LDG，$N=40$, $L=2\\pi$, $b=0.2$, $\\nu=1.0$, $\\theta=0.1$。\n- 用例 3：LDG，$N=40$, $L=2\\pi$, $b=0.2$, $\\nu=1.0$, $\\theta=0.5$。\n- 用例 4：LDG，$N=40$, $L=2\\pi$, $b=0.2$, $\\nu=1.0$, $\\theta=1.0$。\n- 用例 5：LDG，$N=10$, $L=2\\pi$, $b=-0.2$, $\\nu=1.0$, $\\theta=0.1$。\n- 用例 6：类似 BR 的基准，$N=40$, $L=2\\pi$, $b=0.2$, $\\nu=1.0$（忽略 $\\theta$）。\n- 用例 7：LDG，$N=4$, $L=2\\pi$, $b=0.2$, $\\nu=1.0$, $\\theta=0.1$。\n\n您的程序应按用例 1 到 7 的顺序，生成单行输出，其中包含一个列表的列表\n$$\n\\big[\\,[\\text{stable}_1, m_1, r_1], \\ [\\text{stable}_2, m_2, r_2], \\ \\dots, \\ [\\text{stable}_7, m_7, r_7]\\,\\big],\n$$\n其中每个 $\\text{stable}_j$ 是一个布尔值，每个 $m_j$ 和 $r_j$ 是浮点数。整个列表必须打印在一行上，格式化为用方括号括起来的逗号分隔列表，内部列表均按所述顺序包含三个条目。",
            "solution": "用户要求我为一维线性对流扩散方程实现并分析两种数值格式：\n1. 一种带有可调迎风参数 $\\theta$ 的局部不连续伽辽金 (LDG) 格式。\n2. 一种基准的类似内部罚的格式，称为类 Bassi-Rebay (BR) 格式。\n\n方程为 $u_t + b u_x = \\nu u_{xx}$，定义在周期性域 $[0, L]$ 上。\n这被重写为一个一阶系统：\n$u_t + b u_x = \\nu q_x$\n$q - u_x = 0$\n\n区域被离散化为 $N$ 个大小为 $h=L/N$ 的单元。未知数是单元 $i$ 上的分片常数单元平均值 $u_i(t)$ 和 $q_i(t)$。单元中心为 $x_i = (i + 1/2)h$，其中 $i=0, \\dots, N-1$。\n\n让我们将问题分解为几个步骤。\n\n**第 1 部分：半离散算子的推导**\n\n目标是为 LDG 和类 BR 格式推导系统 $\\frac{d\\mathbf{u}}{dt} = A\\mathbf{u}$ 的矩阵 $A$。由于周期性边界条件，所有索引都被视为模 $N$。\n\n**1. LDG 格式算子**\n\n我们必须从系统中消去辅助变量 $q$。\n首先，我们使用辅助方程将 $q_i$ 表示为 $u_j$ 的函数：\n$$h\\, q_i = \\widehat{u}^{\\text{diff}}_{i+\\frac{1}{2}} - \\widehat{u}^{\\text{diff}}_{i-\\frac{1}{2}}$$\n通量 $\\widehat{u}^{\\text{diff}}$ 定义为：\n$$\\widehat{u}^{\\text{diff}}_{i+\\frac{1}{2}} = (1-\\theta)\\,\\frac{1}{2}\\,(u_i + u_{i+1}) + \\theta\\,u_i = \\frac{1+\\theta}{2}u_i + \\frac{1-\\theta}{2}u_{i+1}$$\n将此代入 $q_i$ 的方程：\n$$h q_i = \\left(\\frac{1+\\theta}{2}u_i + \\frac{1-\\theta}{2}u_{i+1}\\right) - \\left(\\frac{1+\\theta}{2}u_{i-1} + \\frac{1-\\theta}{2}u_i\\right) = -\\frac{1+\\theta}{2}u_{i-1} + \\theta u_i + \\frac{1-\\theta}{2}u_{i+1}$$\n因此，$q_i$ 是 $u_x$ 的一个离散近似：\n$$q_i = \\frac{1}{h} \\left(-\\frac{1+\\theta}{2}u_{i-1} + \\theta u_i + \\frac{1-\\theta}{2}u_{i+1}\\right)$$\n接下来，我们将其代入主方程：\n$$h \\frac{d u_i}{d t} = -\\left( b\\,\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}} - \\nu\\,\\widehat{q}_{i+\\frac{1}{2}} \\right) + \\left( b\\,\\widehat{u}^{\\text{conv}}_{i-\\frac{1}{2}} - \\nu\\,\\widehat{q}_{i-\\frac{1}{2}} \\right)$$\n整理可得：\n$$\\frac{d u_i}{dt} = -\\frac{b}{h}\\left(\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}} - \\widehat{u}^{\\text{conv}}_{i-\\frac{1}{2}}\\right) + \\frac{\\nu}{h}\\left(\\widehat{q}_{i+\\frac{1}{2}} - \\widehat{q}_{i-\\frac{1}{2}}\\right)$$\n让我们分别分析对流部分和扩散部分。\n\n对流部分取决于 $b$ 的符号。对于 $b \\ge 0$，$\\widehat{u}^{\\text{conv}}_{i+1/2} = u_i$，其贡献为 $-\\frac{b}{h}(u_i - u_{i-1})$。对于 $b  0$，$\\widehat{u}^{\\text{conv}}_{i+1/2} = u_{i+1}$，其贡献为 $-\\frac{b}{h}(u_{i+1} - u_i)$。\n\n扩散部分使用通量 $\\widehat{q}_{i+1/2} = \\frac{1}{2}(q_i + q_{i+1})$。其贡献为：\n$$\\frac{\\nu}{h}\\left(\\frac{1}{2}(q_i + q_{i+1}) - \\frac{1}{2}(q_{i-1} + q_i)\\right) = \\frac{\\nu}{2h}(q_{i+1} - q_{i-1})$$\n我们将 $q_j$ 用 $u_k$ 表示的表达式代入：\n$$q_{i+1} - q_{i-1} = \\frac{1}{h}\\left(-\\frac{1+\\theta}{2}u_{i} + \\theta u_{i+1} + \\frac{1-\\theta}{2}u_{i+2}\\right) - \\frac{1}{h}\\left(-\\frac{1+\\theta}{2}u_{i-2} + \\theta u_{i-1} + \\frac{1-\\theta}{2}u_{i}\\right)$$\n$$q_{i+1} - q_{i-1} = \\frac{1}{h}\\left(\\frac{1+\\theta}{2}u_{i-2} - \\theta u_{i-1} - u_i + \\theta u_{i+1} + \\frac{1-\\theta}{2}u_{i+2}\\right)$$\n因此，对 $\\frac{du_i}{dt}$ 的扩散贡献为：\n$$\\frac{\\nu}{2h^2}\\left(\\frac{1+\\theta}{2}u_{i-2} - \\theta u_{i-1} - u_i + \\theta u_{i+1} + \\frac{1-\\theta}{2}u_{i+2}\\right)$$\n结合对流和扩散部分，我们得到算子 $A$ 的模板。模板系数 $s_k$ 是 $(A\\mathbf{u})_i = \\frac{du_i}{dt}$ 表达式中 $u_{i+k}$ 的系数。\n对于 $b \\ge 0$：\n$s_{-2} = \\frac{\\nu(1+\\theta)}{4h^2}$，$s_{-1} = \\frac{b}{h} - \\frac{\\nu\\theta}{2h^2}$，$s_0 = -\\frac{b}{h} - \\frac{\\nu}{2h^2}$，$s_1 = \\frac{\\nu\\theta}{2h^2}$，$s_2 = \\frac{\\nu(1-\\theta)}{4h^2}$。\n对于 $b  0$：\n$s_{-2} = \\frac{\\nu(1+\\theta)}{4h^2}$，$s_{-1} = -\\frac{\\nu\\theta}{2h^2}$，$s_0 = \\frac{b}{h} - \\frac{\\nu}{2h^2}$，$s_1 = -\\frac{b}{h} + \\frac{\\nu\\theta}{2h^2}$，$s_2 = \\frac{\\nu(1-\\theta)}{4h^2}$。\n这为循环矩阵 $A$ 定义了一个 $5$ 点模板。\n\n**2. 类 BR 基准算子**\n\n该格式直接给出：\n$$\\frac{d u_i}{dt} = -\\frac{b}{h}\\left(\\widehat{u}^{\\text{conv}}_{i+\\frac{1}{2}} - \\widehat{u}^{\\text{conv}}_{i-\\frac{1}{2}}\\right) + \\nu\\,\\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2}$$\n对流项与 LDG 格式相同。扩散项是 $\\nu u_{xx}$ 的标准中心有限差分近似。\n合并各项，我们得到一个 $3$ 点模板。\n对于 $b \\ge 0$：\n$$s_{-1} = \\frac{b}{h} + \\frac{\\nu}{h^2}, \\quad s_0 = -\\frac{b}{h} - \\frac{2\\nu}{h^2}, \\quad s_1 = \\frac{\\nu}{h^2}$$\n对于 $b  0$：\n$$s_{-1} = \\frac{\\nu}{h^2}, \\quad s_0 = \\frac{b}{h} - \\frac{2\\nu}{h^2}, \\quad s_1 = -\\frac{b}{h} + \\frac{\\nu}{h^2}$$\n这为循环矩阵 $A$ 定义了一个 $3$ 点模板。\n\n**3. 诊断量计算**\n\n对于每个构建的矩阵 $A$，我们计算指定的诊断量：\n- **稳定性和谱横坐标裕度 ($m$)**: 我们计算 $A$ 的特征值 $\\lambda_j$。谱横坐标为 $\\alpha = \\max_j\\{\\Re(\\lambda_j)\\}$。如果 $\\alpha \\le 10^{-10}$，则格式是稳定的。裕度为 $m = -\\alpha$。\n- **平滑模态阻尼比 ($r$)**: 定义为 $r = \\frac{-\\Re(\\lambda_{\\text{eff}})}{\\nu\\,k^2}$。对于给定的参数，$L=2\\pi$ 且 $k=1$。测试向量是 $\\mathbf{v}$，其分量为 $v_i = \\sin(k x_i) = \\sin(x_i)$，其中 $x_i = (i+1/2)h$。有效特征值 $\\lambda_{\\text{eff}}$ 是瑞利商 $\\lambda_{\\text{eff}} = \\frac{\\mathbf{v}^\\top (A \\mathbf{v})}{\\mathbf{v}^\\top \\mathbf{v}}$。该比率变为 $r = \\frac{-\\Re(\\lambda_{\\text{eff}})}{\\nu}$。\n\n实现将使用推导出的模板为每个测试用例构建矩阵 $A$，然后计算这些诊断量。周期性边界条件意味着 $A$ 是一个循环矩阵。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import circulant\n\ndef assemble_A_LDG(N, L, b, nu, theta):\n    \"\"\"Assembles the LDG operator matrix A.\"\"\"\n    h = L / N\n    h2 = h * h\n\n    if b = 0:\n        s_m2 = nu * (1 + theta) / (4 * h2)\n        s_m1 = b / h - nu * theta / (2 * h2)\n        s_0 = -b / h - nu / (2 * h2)\n        s_p1 = nu * theta / (2 * h2)\n        s_p2 = nu * (1 - theta) / (4 * h2)\n    else:  # b  0\n        s_m2 = nu * (1 + theta) / (4 * h2)\n        s_m1 = -nu * theta / (2 * h2)\n        s_0 = b / h - nu / (2 * h2)\n        s_p1 = -b / h + nu * theta / (2 * h2)\n        s_p2 = nu * (1 - theta) / (4 * h2)\n\n    A = np.zeros((N, N), dtype=float)\n    # Applying the 5-point stencil with periodic wrap-around\n    for i in range(N):\n        A[i, (i - 2 + N) % N] += s_m2\n        A[i, (i - 1 + N) % N] += s_m1\n        A[i, i] += s_0\n        A[i, (i + 1) % N] += s_p1\n        A[i, (i + 2) % N] += s_p2\n        \n    return A\n\ndef assemble_A_BR(N, L, b, nu):\n    \"\"\"Assembles the Bassi-Rebay-like operator matrix A.\"\"\"\n    h = L / N\n    h2 = h * h\n\n    if b = 0:\n        s_m1 = b / h + nu / h2\n        s_0 = -b / h - 2 * nu / h2\n        s_p1 = nu / h2\n    else:  # b  0\n        s_m1 = nu / h2\n        s_0 = b / h - 2 * nu / h2\n        s_p1 = -b / h + nu / h2\n        \n    A = np.zeros((N, N), dtype=float)\n    # Applying the 3-point stencil with periodic wrap-around\n    for i in range(N):\n        A[i, (i - 1 + N) % N] += s_m1\n        A[i, i] += s_0\n        A[i, (i + 1) % N] += s_p1\n        \n    return A\n\ndef analyze_scheme(A, N, L, b, nu):\n    \"\"\"Computes stability, margin, and damping ratio for a given operator A.\"\"\"\n    # 1. Stability and margin m\n    eigvals = np.linalg.eigvals(A)\n    max_re = np.max(np.real(eigvals))\n    stable = bool(max_re = 1e-10)\n    m = -max_re\n\n    # 2. Smooth-mode damping ratio r\n    h = L / N\n    k = 1.0\n    x = (np.arange(N) + 0.5) * h\n    v = np.sin(k * x)\n    \n    lambda_eff = (v.T @ A @ v) / (v.T @ v)\n    \n    # Continuum damping rate for denominator\n    continuum_damping = nu * k**2\n    r = -np.real(lambda_eff) / continuum_damping\n    \n    return [stable, m, r]\n\ndef solve():\n    \"\"\"Main function to run test cases and print results.\"\"\"\n    test_cases = [\n        # Case 1: LDG, N=40, L=2pi, b=0.2, nu=1.0, theta=0.0\n        ('LDG', 40, 2 * np.pi, 0.2, 1.0, 0.0),\n        # Case 2: LDG, N=40, L=2pi, b=0.2, nu=1.0, theta=0.1\n        ('LDG', 40, 2 * np.pi, 0.2, 1.0, 0.1),\n        # Case 3: LDG, N=40, L=2pi, b=0.2, nu=1.0, theta=0.5\n        ('LDG', 40, 2 * np.pi, 0.2, 1.0, 0.5),\n        # Case 4: LDG, N=40, L=2pi, b=0.2, nu=1.0, theta=1.0\n        ('LDG', 40, 2 * np.pi, 0.2, 1.0, 1.0),\n        # Case 5: LDG, N=10, L=2pi, b=-0.2, nu=1.0, theta=0.1\n        ('LDG', 10, 2 * np.pi, -0.2, 1.0, 0.1),\n        # Case 6: BR-like, N=40, L=2pi, b=0.2, nu=1.0\n        ('BR', 40, 2 * np.pi, 0.2, 1.0, None),\n        # Case 7: LDG, N=4, L=2pi, b=0.2, nu=1.0, theta=0.1\n        ('LDG', 4, 2 * np.pi, 0.2, 1.0, 0.1),\n    ]\n\n    results = []\n    for case in test_cases:\n        scheme_type, N, L, b, nu, theta = case\n        \n        if scheme_type == 'LDG':\n            A = assemble_A_LDG(N, L, b, nu, theta)\n        elif scheme_type == 'BR':\n            A = assemble_A_BR(N, L, b, nu)\n        else:\n            raise ValueError(f\"Unknown scheme type: {scheme_type}\")\n\n        analysis_result = analyze_scheme(A, N, L, b, nu)\n        results.append(analysis_result)\n    \n    # Format the final output string as a list of lists.\n    # The str() representation of a list includes the required spaces.\n    # Joining with ',' gives a compact representation.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "为了更全面地理解格式特性，我们将分析从一维瞬态问题扩展到二维稳态问题。本练习引入了离散格林函数的概念，这是一个强大的工具，能够可视化并量化格式对局部源的响应。通过计算并比较LDG（非对称）和BR2（对称）格式的离散格林函数，我们将研究它们在结构上的差异如何体现在数值解的空间衰减和各向异性模式上。",
            "id": "3417428",
            "problem": "考虑单位正方形域上的标量扩散偏微分方程，其齐次狄利克雷边界条件如下：\n$$\n-\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla u(x,y) \\right) = f(x,y), \\quad (x,y) \\in (0,1) \\times (0,1), \\quad u|_{\\partial \\Omega} = 0,\n$$\n其中 $\\mathbf{K} = \\mathrm{diag}(k_x, k_y)$ 是一个常数对称正定扩散张量，其元素 $k_x \\gt 0$ 和 $k_y \\gt 0$。设该域被划分为一个均匀的笛卡尔网格，在 $x$ 方向有 $N_x$ 个元素，在 $y$ 方向有 $N_y$ 个元素，每个元素都是一个尺寸为 $h_x = 1/N_x$ 和 $h_y = 1/N_y$ 的矩形。考虑每个元素上使用分片常数基函数。将离散格林函数定义为离散线性系统的解 $\\mathbf{g}$：\n$$\n\\mathbf{A} \\, \\mathbf{g} = \\mathbf{e}_{i_0,j_0},\n$$\n其中 $\\mathbf{A}$ 是由间断伽辽金离散化产生的全局刚度矩阵，$\\mathbf{e}_{i_0,j_0}$ 是克罗内克δ向量，除了在对应于元素 $(i_0,j_0)$ 的索引处为1外，其余位置均为0。离散格林函数表示位于元素 $(i_0,j_0)$ 的点源的离散响应。\n\n您必须计算并比较两种间断伽辽金公式的离散格林函数：\n\n- 局部间断伽辽金（LDG）方法，通过基于面的罚算子实现，其方向性通量偏置由参数 $\\alpha \\in [0,1)$ 和全局方向向量 $\\boldsymbol{\\beta} \\in \\mathbb{R}^2$ 控制。对于每个内部面，其单位法向量 $\\mathbf{n}$ 从左侧元素 $\\mathcal{L}$ 指向右侧元素 $\\mathcal{R}$，定义面稳定化系数为\n$$\ns(\\mathbf{n}) = \\tau \\, \\frac{\\mathbf{n}^\\top \\mathbf{K} \\, \\mathbf{n}}{h_n},\n$$\n其中 $\\tau \\gt 0$ 是一个稳定化参数，$h_n$ 是垂直于面的方向上的网格尺寸，对于垂直面（法向量为 $\\pm(1,0)$）等于 $h_x$，对于水平面（法向量为 $\\pm(0,1)$）等于 $h_y$。LDG 方向性分裂根据 $\\mathrm{sign}(\\boldsymbol{\\beta} \\cdot \\mathbf{n})$ 将 $s(\\mathbf{n})$ 的一部分分配给每一侧，具体为\n$$\ns_{\\mathcal{L}}(\\mathbf{n}) = \\frac{1+\\alpha}{2} \\, s(\\mathbf{n}) \\quad \\text{和} \\quad s_{\\mathcal{R}}(\\mathbf{n}) = \\frac{1-\\alpha}{2} \\, s(\\mathbf{n}) \\quad \\text{如果 } \\boldsymbol{\\beta} \\cdot \\mathbf{n} \\ge 0,\n$$\n如果 $\\boldsymbol{\\beta} \\cdot \\mathbf{n}  0$，则交换分配。一个内部面的局部组装贡献为\n$$\n\\begin{aligned}\n\\mathbf{A}_{\\mathcal{L},\\mathcal{L}} \\mathrel{+}= s_{\\mathcal{L}}(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{L},\\mathcal{R}} \\mathrel{-}= s_{\\mathcal{L}}(\\mathbf{n}),\\\\\n\\mathbf{A}_{\\mathcal{R},\\mathcal{R}} \\mathrel{+}= s_{\\mathcal{R}}(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{R},\\mathcal{L}} \\mathrel{-}= s_{\\mathcal{R}}(\\mathbf{n}),\n\\end{aligned}\n$$\n而对于边界面，组装简化为\n$$\n\\mathbf{A}_{\\mathcal{E},\\mathcal{E}} \\mathrel{+}= s(\\mathbf{n}),\n$$\n以施加齐次狄利克雷边界条件。当 $\\alpha \\ne 0$ 时，这种 LDG 变体产生一个通常非对称的算子，并通过 $\\boldsymbol{\\beta}$ 引入方向性偏置。\n\n- Bassi-Rebay 2 (BR2) 方法，实现为针对分片常数基函数的类对称内部罚分面算子。对于每个内部面，使用与上述相同的 $s(\\mathbf{n})$，其对称组装贡献为\n$$\n\\mathbf{A}_{\\mathcal{L},\\mathcal{L}} \\mathrel{+}= s(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{R},\\mathcal{R}} \\mathrel{+}= s(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{L},\\mathcal{R}} \\mathrel{-}= s(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{R},\\mathcal{L}} \\mathrel{-}= s(\\mathbf{n}),\n$$\n对于边界面\n$$\n\\mathbf{A}_{\\mathcal{E},\\mathcal{E}} \\mathrel{+}= s(\\mathbf{n}).\n$$\n当 $\\tau$ 足够大时，这种 BR2 变体产生一个对称正定算子，在均匀网格上，当 $k_x$ 和 $k_y$ 是主扩散系数时，它与各向异性拉普拉斯算子的一致五点离散格式重合。\n\n给定位于 $(i_0,j_0)$ 的点源，通过求解相应的线性系统来计算离散格林函数 $\\mathbf{g}^{\\mathrm{LDG}}$ 和 $\\mathbf{g}^{\\mathrm{BR2}}$。通过以下量化指标研究它们的衰减和方向各向异性，这些指标是根据离散格林函数在相邻单元格上的值定义的：\n\n- 定义轴对齐的一阶邻居为 $(i_0+1,j_0)$、$(i_0-1,j_0)$、$(i_0,j_0+1)$、$(i_0,j_0-1)$，沿正 $x$ 轴的二阶邻居为 $(i_0+2,j_0)$。定义一阶对角邻居为 $(i_0+1,j_0+1)$。设 $\\mathbf{g}$ 表示一个离散格林函数向量，$g_{i,j}$ 是其在单元格 $(i,j)$ 中的值。然后计算：\n    - 左右各向异性指数\n    $$\n    \\mathrm{AI}_{\\mathrm{LR}}(\\mathbf{g}) = \\frac{\\left| g_{i_0+1,j_0} - g_{i_0-1,j_0} \\right|}{\\max\\left( \\left| g_{i_0+1,j_0} \\right|, \\left| g_{i_0-1,j_0} \\right| \\right)}.\n    $$\n    - 上下各向异性指数\n    $$\n    \\mathrm{AI}_{\\mathrm{TB}}(\\mathbf{g}) = \\frac{\\left| g_{i_0,j_0+1} - g_{i_0,j_0-1} \\right|}{\\max\\left( \\left| g_{i_0,j_0+1} \\right|, \\left| g_{i_0,j_0-1} \\right| \\right)}.\n    $$\n    - 轴向衰减比\n    $$\n    \\mathrm{DR}_{\\mathrm{axis}}(\\mathbf{g}) = \\frac{\\left| g_{i_0+1,j_0} \\right|}{\\left| g_{i_0+2,j_0} \\right|},\n    $$\n    前提是所有索引都在界内。\n    - 对角线与轴向比\n    $$\n    \\mathrm{RAR}_{\\mathrm{diag/axis}}(\\mathbf{g}) = \\frac{\\left| g_{i_0+1,j_0+1} \\right|}{\\left| g_{i_0+1,j_0} \\right|}.\n    $$\n\n对于每个测试用例，计算 $\\mathbf{g}^{\\mathrm{LDG}}$ 和 $\\mathbf{g}^{\\mathrm{BR2}}$ 的上述四个指标，每个测试用例按固定顺序产生八个浮点数\n$$\n\\left[ \\mathrm{AI}_{\\mathrm{LR}}(\\mathbf{g}^{\\mathrm{LDG}}), \\mathrm{AI}_{\\mathrm{LR}}(\\mathbf{g}^{\\mathrm{BR2}}), \\mathrm{AI}_{\\mathrm{TB}}(\\mathbf{g}^{\\mathrm{LDG}}), \\mathrm{AI}_{\\mathrm{TB}}(\\mathbf{g}^{\\mathrm{BR2}}), \\mathrm{DR}_{\\mathrm{axis}}(\\mathbf{g}^{\\mathrm{LDG}}), \\mathrm{DR}_{\\mathrm{axis}}(\\mathbf{g}^{\\mathrm{BR2}}), \\mathrm{RAR}_{\\mathrm{diag/axis}}(\\mathbf{g}^{\\mathrm{LDG}}), \\mathrm{RAR}_{\\mathrm{diag/axis}}(\\mathbf{g}^{\\mathrm{BR2}}) \\right].\n$$\n\n您的程序必须按照上述规定实现 $\\mathbf{A}^{\\mathrm{LDG}}$ 和 $\\mathbf{A}^{\\mathrm{BR2}}$ 的组装，使用直接稀疏求解器求解离散格林函数的线性系统，并计算这些指标。\n\n测试套件：\n使用以下测试用例，其参数涵盖一般情况、受边界影响的情况以及物理各向异性的情况：\n\n1. 测试用例1（一般情况，各向同性物理，LDG方向性偏置）：\n   - $N_x = 25$, $N_y = 25$, $i_0 = 12$, $j_0 = 12$, $k_x = 1$, $k_y = 1$, $\\tau = 1$, $\\alpha = 0.8$, $\\boldsymbol{\\beta} = (1,1)$.\n\n2. 测试用例2（较小网格，源靠近边界，x方向LDG偏置更强）：\n   - $N_x = 9$, $N_y = 9$, $i_0 = 2$, $j_0 = 2$, $k_x = 1$, $k_y = 1$, $\\tau = 1.2$, $\\alpha = 0.9$, $\\boldsymbol{\\beta} = (1,0)$.\n\n3. 测试用例3（物理各向异性扩散张量）：\n   - $N_x = 33$, $N_y = 33$, $i_0 = 16$, $j_0 = 16$, $k_x = 10$, $k_y = 1$, $\\tau = 1$, $\\alpha = 0.5$, $\\boldsymbol{\\beta} = (1,1)$.\n\n所有量均为无量纲。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，该列表按1、2、3的顺序连接每个测试用例的八个指标，总共24个浮点数：\n$$\n\\left[ \\text{metrics}_{\\text{TC1}}, \\text{metrics}_{\\text{TC2}}, \\text{metrics}_{\\text{TC3}} \\right].\n$$",
            "solution": "该问题要求计算和分析单位正方形上标量扩散方程的离散格林函数。这是通过求解由两种不同的间断伽辽金（DG）公式产生的控制线性系统来实现的：一种非对称的局部间断伽辽金（LDG）方法和一种对称的 Bassi-Rebay 2（BR2）方法。在均匀的笛卡尔网格上选择分片常数基函数。\n\n对于每个测试用例，整个过程包括三个主要阶段：\n$1$. 全局刚度矩阵 $\\mathbf{A}^{\\mathrm{LDG}}$ 和 $\\mathbf{A}^{\\mathrm{BR2}}$ 的组装。\n$2$. 求解线性系统 $\\mathbf{A}^{\\mathrm{LDG}} \\mathbf{g}^{\\mathrm{LDG}} = \\mathbf{e}_{i_0,j_0}$ 和 $\\mathbf{A}^{\\mathrm{BR2}} \\mathbf{g}^{\\mathrm{BR2}} = \\mathbf{e}_{i_0,j_0}$ 以找到离散格林函数 $\\mathbf{g}^{\\mathrm{LDG}}$ 和 $\\mathbf{g}^{\\mathrm{BR2}}$。\n$3$. 计算指定的指标以量化所计算的格林函数的各向异性和衰减特性。\n\n一个关键步骤是构建全局刚度矩阵 $\\mathbf{A}$。域 $\\Omega = (0,1) \\times (0,1)$ 被离散化为 $N_x \\times N_y$ 个矩形元素的网格。总自由度数为 $N = N_x N_y$。元素由 $(i,j)$ 索引，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_y-1\\}$，这些索引被映射到单个线性索引 $k = i N_y + j$。矩阵 $\\mathbf{A}$ 是一个 $N \\times N$ 的稀疏矩阵。\n\n矩阵组装是通过遍历所有元素面来执行的。每个面的贡献被加到 $\\mathbf{A}$ 的相应条目中。\n\n让我们考虑一个分隔两个元素的内部垂直面，$\\mathcal{L}$ 位于 $(i,j)$，$\\mathcal{R}$ 位于 $(i+1,j)$。从 $\\mathcal{L}$ 指向 $\\mathcal{R}$ 的单位法向量是 $\\mathbf{n} = (1,0)^\\top$。法向上的网格尺寸为 $h_n = h_x = 1/N_x$。面稳定化系数定义为：\n$$\ns(\\mathbf{n}) = \\tau \\frac{\\mathbf{n}^\\top \\mathbf{K} \\, \\mathbf{n}}{h_n} = \\tau \\frac{k_x}{h_x}\n$$\n类似地，对于 $(i,j)$ 和 $(i,j+1)$ 之间的水平面，法向量是 $\\mathbf{n} = (0,1)^\\top$，系数是 $s(\\mathbf{n}) = \\tau k_y / h_y$。\n\n对于 BR2 方法，这是一种对称内部罚方法，$\\mathcal{L}$ 和 $\\mathcal{R}$ 之间的面的贡献是：\n$$\n\\mathbf{A}_{\\mathcal{L},\\mathcal{L}} \\mathrel{+}= s(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{R},\\mathcal{R}} \\mathrel{+}= s(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{L},\\mathcal{R}} \\mathrel{-}= s(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{R},\\mathcal{L}} \\mathrel{-}= s(\\mathbf{n})\n$$\n这个组装规则是对称的，从而得到一个对称矩阵 $\\mathbf{A}^{\\mathrm{BR2}}$。\n\n对于 LDG 方法，其公式引入了非对称的、方向性的偏置。稳定化系数 $s(\\mathbf{n})$ 被分成两部分，$s_{\\mathcal{L}}(\\mathbf{n})$ 和 $s_{\\mathcal{R}}(\\mathbf{n})$，这取决于点积 $\\boldsymbol{\\beta} \\cdot \\mathbf{n}$ 的符号，其中 $\\boldsymbol{\\beta}$ 是全局方向向量，$\\alpha \\in [0,1)$ 是偏置参数。\n如果 $\\boldsymbol{\\beta} \\cdot \\mathbf{n} \\ge 0$：\n$$\ns_{\\mathcal{L}}(\\mathbf{n}) = \\frac{1+\\alpha}{2} s(\\mathbf{n}), \\quad s_{\\mathcal{R}}(\\mathbf{n}) = \\frac{1-\\alpha}{2} s(\\mathbf{n})\n$$\n如果 $\\boldsymbol{\\beta} \\cdot \\mathbf{n}  0$，$\\mathcal{L}$ 和 $\\mathcal{R}$ 的角色互换，意味着：\n$$\ns_{\\mathcal{L}}(\\mathbf{n}) = \\frac{1-\\alpha}{2} s(\\mathbf{n}), \\quad s_{\\mathcal{R}}(\\mathbf{n}) = \\frac{1+\\alpha}{2} s(\\mathbf{n})\n$$\nLDG 方法的矩阵组装贡献为：\n$$\n\\begin{aligned}\n\\mathbf{A}_{\\mathcal{L},\\mathcal{L}} \\mathrel{+}= s_{\\mathcal{L}}(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{L},\\mathcal{R}} \\mathrel{-}= s_{\\mathcal{L}}(\\mathbf{n}),\\\\\n\\mathbf{A}_{\\mathcal{R},\\mathcal{R}} \\mathrel{+}= s_{\\mathcal{R}}(\\mathbf{n}), \\quad \\mathbf{A}_{\\mathcal{R},\\mathcal{L}} \\mathrel{-}= s_{\\mathcal{R}}(\\mathbf{n})\n\\end{aligned}\n$$\n由于当 $\\alpha \\ne 0$ 时 $s_{\\mathcal{L}} \\ne s_{\\mathcal{R}}$，所得矩阵 $\\mathbf{A}^{\\mathrm{LDG}}$ 通常是非对称的。\n\n对于域 $\\partial\\Omega$ 边界上的面，弱施加齐次狄利克雷条件。对于带有边界面元的元素 $\\mathcal{E}$，一个罚项被加到其对角线元素上：\n$$\n\\mathbf{A}_{\\mathcal{E},\\mathcal{E}} \\mathrel{+}= s(\\mathbf{n})\n$$\n这适用于 BR2 和 LDG 方法，其中 $\\mathbf{n}$ 是边界面的外指向法向量。\n\n线性系统的右侧项 $\\mathbf{e}_{i_0,j_0}$ 是一个向量，除了在对应于源元素 $(i_0,j_0)$ 的线性索引处值为 1 外，其余所有元素都为零。这表示一个离散的狄拉克δ函数。\n\n矩阵 $\\mathbf{A}^{\\mathrm{LDG}}$ 和 $\\mathbf{A}^{\\mathrm{BR2}}$ 被组装成稀疏矩阵，具体来说，使用 `scipy.sparse.lil_matrix` 进行高效构建，然后转换为 `scipy.sparse.csr_matrix` 以进行快速算术运算和求解。线性系统使用直接稀疏求解器 `scipy.sparse.linalg.spsolve` 求解。\n\n得到的解向量 $\\mathbf{g}^{\\mathrm{LDG}}$ 和 $\\mathbf{g}^{\\mathrm{BR2}}$ 被重塑为 $N_x \\times N_y$ 的数组。使用这些数组中的值 $g_{i,j}$，为每种方法计算以下四个指标：\n- 左右各向异性指数：$\\mathrm{AI}_{\\mathrm{LR}}(\\mathbf{g}) = \\frac{\\left| g_{i_0+1,j_0} - g_{i_0-1,j_0} \\right|}{\\max\\left( \\left| g_{i_0+1,j_0} \\right|, \\left| g_{i_0-1,j_0} \\right| \\right)}$\n- 上下各向异性指数：$\\mathrm{AI}_{\\mathrm{TB}}(\\mathbf{g}) = \\frac{\\left| g_{i_0,j_0+1} - g_{i_0,j_0-1} \\right|}{\\max\\left( \\left| g_{i_0,j_0+1} \\right|, \\left| g_{i_0,j_0-1} \\right| \\right)}$\n- 轴向衰减比：$\\mathrm{DR}_{\\mathrm{axis}}(\\mathbf{g}) = \\frac{\\left| g_{i_0+1,j_0} \\right|}{\\left| g_{i_0+2,j_0} \\right|}$\n- 对角线与轴向比：$\\mathrm{RAR}_{\\mathrm{diag/axis}}(\\mathbf{g}) = \\frac{\\left| g_{i_0+1,j_0+1} \\right|}{\\left| g_{i_0+1,j_0} \\right|}$\n\n这些指标为每种 DG 方案的数值耗散和方向性偏置，以及扩散张量 $\\mathbf{K}$ 的物理各向异性如何在离散解中体现，提供了量化洞察。最终输出是为所提供的三个测试用例中的每一个，将这八个指标平铺成一个列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef assemble_matrix(Nx, Ny, kx, ky, tau, alpha, beta, method):\n    \"\"\"\n    Assembles the sparse stiffness matrix for the given DG method.\n    \"\"\"\n    N = Nx * Ny\n    hx = 1.0 / Nx\n    hy = 1.0 / Ny\n    A = lil_matrix((N, N), dtype=np.float64)\n\n    def idx(i, j):\n        # Maps 2D element index (i, j) to 1D linear index.\n        return i * Ny + j\n\n    # Process vertical interior faces\n    sx = tau * kx / hx\n    for i in range(Nx - 1):\n        for j in range(Ny):\n            kL = idx(i, j)\n            kR = idx(i + 1, j)\n\n            if method == 'BR2':\n                A[kL, kL] += sx\n                A[kR, kR] += sx\n                A[kL, kR] -= sx\n                A[kR, kL] -= sx\n            elif method == 'LDG':\n                n = np.array([1.0, 0.0])\n                beta_dot_n = np.dot(beta, n)\n                if beta_dot_n = 0:\n                    sL = 0.5 * (1.0 + alpha) * sx\n                    sR = 0.5 * (1.0 - alpha) * sx\n                else:\n                    sL = 0.5 * (1.0 - alpha) * sx\n                    sR = 0.5 * (1.0 + alpha) * sx\n                \n                A[kL, kL] += sL\n                A[kL, kR] -= sL\n                A[kR, kR] += sR\n                A[kR, kL] -= sR\n\n    # Process horizontal interior faces\n    sy = tau * ky / hy\n    for i in range(Nx):\n        for j in range(Ny - 1):\n            kL = idx(i, j)      # Bottom element\n            kR = idx(i, j + 1)  # Top element\n\n            if method == 'BR2':\n                A[kL, kL] += sy\n                A[kR, kR] += sy\n                A[kL, kR] -= sy\n                A[kR, kL] -= sy\n            elif method == 'LDG':\n                n = np.array([0.0, 1.0])\n                beta_dot_n = np.dot(beta, n)\n                if beta_dot_n = 0:\n                    sL = 0.5 * (1.0 + alpha) * sy\n                    sR = 0.5 * (1.0 - alpha) * sy\n                else:\n                    sL = 0.5 * (1.0 - alpha) * sy\n                    sR = 0.5 * (1.0 + alpha) * sy\n                \n                A[kL, kL] += sL\n                A[kL, kR] -= sL\n                A[kR, kR] += sR\n                A[kR, kL] -= sR\n\n    # Process boundary faces (penalty enforcement)\n    # Left boundary (i=0)\n    for j in range(Ny):\n        A[idx(0, j), idx(0, j)] += sx\n    # Right boundary (i=Nx-1)\n    for j in range(Ny):\n        A[idx(Nx - 1, j), idx(Nx - 1, j)] += sx\n    # Bottom boundary (j=0)\n    for i in range(Nx):\n        A[idx(i, 0), idx(i, 0)] += sy\n    # Top boundary (j=Ny-1)\n    for i in range(Ny):\n        A[idx(i, Ny - 1), idx(i, Ny - 1)] += sy\n\n    return A.tocsr()\n\ndef compute_metrics(g, i0, j0):\n    \"\"\"\n    Computes the four specified metrics from the discrete Green's function.\n    \"\"\"\n    g_ip1_j0 = g[i0 + 1, j0]\n    g_im1_j0 = g[i0 - 1, j0]\n    g_i0_jp1 = g[i0, j0 + 1]\n    g_i0_jm1 = g[i0, j0 - 1]\n    g_ip2_j0 = g[i0 + 2, j0]\n    g_ip1_jp1 = g[i0 + 1, j0 + 1]\n\n    # AI_LR\n    num_lr = np.abs(g_ip1_j0 - g_im1_j0)\n    den_lr = np.max([np.abs(g_ip1_j0), np.abs(g_im1_j0)])\n    ai_lr = num_lr / den_lr if den_lr  1e-15 else 0.0\n\n    # AI_TB\n    num_tb = np.abs(g_i0_jp1 - g_i0_jm1)\n    den_tb = np.max([np.abs(g_i0_jp1), np.abs(g_i0_jm1)])\n    ai_tb = num_tb / den_tb if den_tb  1e-15 else 0.0\n\n    # DR_axis\n    num_dr = np.abs(g_ip1_j0)\n    den_dr = np.abs(g_ip2_j0)\n    dr_axis = num_dr / den_dr if den_dr  1e-15 else 0.0\n\n    # RAR_diag/axis\n    num_rar = np.abs(g_ip1_jp1)\n    den_rar = np.abs(g_ip1_j0)\n    rar_diag_axis = num_rar / den_rar if den_rar  1e-15 else 0.0\n\n    return {\n        'AI_LR': ai_lr, 'AI_TB': ai_tb, \n        'DR_axis': dr_axis, 'RAR_diag/axis': rar_diag_axis\n    }\n\ndef solve_case(case_params):\n    \"\"\"\n    Solves one test case: assembles matrices, solves systems, computes metrics.\n    \"\"\"\n    Nx, Ny, i0, j0, kx, ky, tau, alpha, beta_tuple = case_params\n    beta = np.array(beta_tuple, dtype=np.float64)\n    \n    A_ldg = assemble_matrix(Nx, Ny, kx, ky, tau, alpha, beta, 'LDG')\n    A_br2 = assemble_matrix(Nx, Ny, kx, ky, tau, alpha, beta, 'BR2')\n\n    N = Nx * Ny\n    rhs = np.zeros(N)\n    source_idx = i0 * Ny + j0\n    rhs[source_idx] = 1.0\n\n    g_ldg_flat = spsolve(A_ldg, rhs)\n    g_br2_flat = spsolve(A_br2, rhs)\n\n    g_ldg = g_ldg_flat.reshape((Nx, Ny))\n    g_br2 = g_br2_flat.reshape((Nx, Ny))\n\n    metrics_ldg = compute_metrics(g_ldg, i0, j0)\n    metrics_br2 = compute_metrics(g_br2, i0, j0)\n\n    results = [\n        metrics_ldg['AI_LR'], metrics_br2['AI_LR'],\n        metrics_ldg['AI_TB'], metrics_br2['AI_TB'],\n        metrics_ldg['DR_axis'], metrics_br2['DR_axis'],\n        metrics_ldg['RAR_diag/axis'], metrics_br2['RAR_diag/axis']\n    ]\n    return results\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, i0, j0, kx, ky, tau, alpha, beta)\n        (25, 25, 12, 12, 1.0, 1.0, 1.0, 0.8, (1.0, 1.0)),\n        (9, 9, 2, 2, 1.0, 1.0, 1.2, 0.9, (1.0, 0.0)),\n        (33, 33, 16, 16, 10.0, 1.0, 1.0, 0.5, (1.0, 1.0)),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        case_results = solve_case(case)\n        all_results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}