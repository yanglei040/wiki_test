{
    "hands_on_practices": [
        {
            "introduction": "我们的第一个练习将回归基础，探讨偏微分方程中的源项在离散系统中的表示方式。通过在一个极其简单的网格上比较两种常见的处理方法——$L^2$投影和节点插值——你将亲手计算并理解数据近似对解的影响 ()。这是理解离散化误差来源的关键一步，并为更复杂的分析奠定了基础。",
            "id": "3441979",
            "problem": "考虑空间域 $\\Omega=(0,1)$ 上的一维热方程（一种抛物型偏微分方程(PDE)），其具有齐次狄利克雷边界条件和零初始条件：\n$$\n\\partial_t u(x,t) - \\partial_{xx} u(x,t) = f(x), \\quad x \\in (0,1), \\ t>0,\n$$\n$$\nu(0,t)=0, \\quad u(1,t)=0, \\quad t>0,\n$$\n$$\nu(x,0)=0, \\quad x \\in (0,1).\n$$\n其变分（弱）形式建立在索博列夫空间 $H_0^1(0,1)$ 和 $L^2$ 内积之上。设有限元法(FEM)半离散化使用协调有限元子空间 $V_h^0 \\subset H_0^1(0,1)$，该子空间由网格上节点位于 $x=0$、$x=\\tfrac{1}{2}$ 和 $x=1$ 处的连续分段线性函数组成，并且在边界上为零。用 $\\varphi \\in V_h^0$ 表示与内部节点 $x=\\tfrac{1}{2}$ 相关联的唯一节点基函数。\n通过用 $v_h=\\varphi$ 测试半离散弱形式，对于拟设 $u_h(x,t)=U(t)\\,\\varphi(x)$ 中的单个未知系数 $U(t)$，其半离散常微分方程(ODE)具有以下结构\n$$\nm\\,U'(t) + k\\,U(t) = F,\n$$\n其中 $m$ 是质量系数，$k$ 是刚度系数，$F$ 是由数据 $f$ 产生的载荷项。\n现在考虑对载荷项的两种数据处理方法：\n- 精确数据：使用 $F=(f,\\varphi)$，即 $f$ 与 $\\varphi$ 的 $L^2$ 内积。\n- 插值数据：将 $f$ 替换为其在 $V_h^0$ 中的节点插值，即 $I_h f = f\\!\\left(\\tfrac{1}{2}\\right)\\varphi$，并使用 $F_h=(I_h f,\\varphi)$。\n假设 $f(x)=\\exp(x)$ 并回顾根据初始条件有 $U(0)=0$。从弱形式和上述定义出发，分别推导对应于精确数据和插值数据处理的初始时间导数 $U'_{\\text{exact}}(0)$ 和 $U'_{\\text{interp}}(0)$，然后计算标量差值\n$$\n\\Delta \\equiv U'_{\\text{exact}}(0) - U'_{\\text{interp}}(0).\n$$\n将您的最终答案表示为一个只包含标准常数和指数函数的单一闭式解析表达式。不需要数值舍入，也不需要报告单位。",
            "solution": "我们从 $H_0^1(0,1)$ 上的热方程的弱形式开始：对于所有 $v \\in H_0^1(0,1)$ 和所有 $t>0$，\n$$\n(\\partial_t u(t), v)_{L^2(0,1)} + (\\partial_x u(t), \\partial_x v)_{L^2(0,1)} = (f, v)_{L^2(0,1)}.\n$$\n我们通过将试验空间和测试空间限制在由与内部节点 $x=\\tfrac{1}{2}$ 相关联的单个帽子函数 $\\varphi$ 所张成的协调有限元子空间 $V_h^0$ 中，来进行空间上的半离散化。半离散拟设为 $u_h(x,t) = U(t)\\,\\varphi(x)$，我们用 $v_h=\\varphi$ 进行测试。这得到\n$$\n(\\partial_t u_h(t), \\varphi) + (\\partial_x u_h(t), \\partial_x \\varphi) = (f, \\varphi).\n$$\n利用线性和 $u_h$ 的定义，我们设\n$$\nm \\equiv (\\varphi, \\varphi), \\quad k \\equiv (\\partial_x \\varphi, \\partial_x \\varphi), \\quad F \\equiv (f, \\varphi),\n$$\n这给出了标量常微分方程(ODE)\n$$\nm\\,U'(t) + k\\,U(t) = F.\n$$\n根据齐次初始条件 $u(x,0)=0$，我们有 $U(0)=0$。在 $t=0$ 处求值得到\n$$\nm\\,U'(0) + k\\,U(0) = F \\quad \\Rightarrow \\quad m\\,U'(0) = F \\quad \\Rightarrow \\quad U'(0) = m^{-1} F.\n$$\n因此，对于精确数据处理，我们有\n$$\nU'_{\\text{exact}}(0) = m^{-1} (f,\\varphi).\n$$\n对于插值数据处理，我们将 $f$ 替换为 $I_h f \\in V_h^0$，其中 $I_h f = f\\!\\left(\\tfrac{1}{2}\\right)\\,\\varphi$（到张成空间 $\\{\\varphi\\}$ 上的节点插值）。载荷项于是变为\n$$\nF_h = (I_h f, \\varphi) = f\\!\\left(\\tfrac{1}{2}\\right) (\\varphi,\\varphi) = f\\!\\left(\\tfrac{1}{2}\\right) m,\n$$\n并且相应的初始导数为\n$$\nU'_{\\text{interp}}(0) = m^{-1} F_h = m^{-1} \\big(f\\!\\left(\\tfrac{1}{2}\\right) m\\big) = f\\!\\left(\\tfrac{1}{2}\\right).\n$$\n因此，差值为\n$$\n\\Delta \\equiv U'_{\\text{exact}}(0) - U'_{\\text{interp}}(0) = m^{-1} (f,\\varphi) - f\\!\\left(\\tfrac{1}{2}\\right).\n$$\n剩下的任务是对于给定的网格和 $f(x)=\\exp(x)$ 显式地计算 $m$ 和 $(f,\\varphi)$。\n\n在节点位于 $x=0$、$x=\\tfrac{1}{2}$ 和 $x=1$ 的网格上，帽子函数 $\\varphi$ 为\n$$\n\\varphi(x) = \n\\begin{cases}\n2x,  x \\in [0,\\tfrac{1}{2}], \\\\\n2(1-x),  x \\in [\\tfrac{1}{2},1], \\\\\n0,  \\text{否则}.\n\\end{cases}\n$$\n首先，计算质量系数\n$$\nm = \\int_0^1 \\varphi(x)^2 \\, dx = \\int_0^{1/2} \\big(2x\\big)^2 \\, dx + \\int_{1/2}^1 \\big(2(1-x)\\big)^2 \\, dx.\n$$\n根据对称性，\n$$\n\\int_0^{1/2} \\big(2x\\big)^2 \\, dx = \\int_{1/2}^1 \\big(2(1-x)\\big)^2 \\, dx = 4 \\int_0^{1/2} x^2 \\, dx = 4 \\cdot \\frac{(1/2)^3}{3} = \\frac{1}{6},\n$$\n所以\n$$\nm = \\frac{1}{6} + \\frac{1}{6} = \\frac{1}{3}.\n$$\n接下来，计算 $f(x)=\\exp(x)$ 的精确载荷项：\n$$\n(f,\\varphi) = \\int_0^1 \\exp(x)\\,\\varphi(x)\\,dx = 2 \\int_0^{1/2} x \\exp(x)\\,dx + 2 \\int_{1/2}^1 (1-x)\\exp(x)\\,dx.\n$$\n使用不定积分\n$$\n\\int x \\exp(x)\\,dx = (x-1)\\exp(x) + C, \\quad \\int (1-x)\\exp(x)\\,dx = (2 - x)\\exp(x) + C.\n$$\n因此，\n$$\n2 \\int_0^{1/2} x \\exp(x)\\,dx = 2 \\Big[(x-1)\\exp(x)\\Big]_{0}^{1/2} = 2\\Big(\\big(\\tfrac{1}{2}-1\\big)\\exp(\\tfrac{1}{2}) - (-1)\\exp(0)\\Big) = 2 - \\exp\\!\\big(\\tfrac{1}{2}\\big),\n$$\n和\n$$\n2 \\int_{1/2}^{1} (1-x)\\exp(x)\\,dx = 2 \\Big[(2-x)\\exp(x)\\Big]_{1/2}^{1} = 2\\Big(\\exp(1) - \\tfrac{3}{2}\\exp\\!\\big(\\tfrac{1}{2}\\big)\\Big) = 2\\exp(1) - 3\\exp\\!\\big(\\tfrac{1}{2}\\big).\n$$\n求和得，\n$$\n(f,\\varphi) = \\big(2 - \\exp\\!\\big(\\tfrac{1}{2}\\big)\\big) + \\big(2\\exp(1) - 3\\exp\\!\\big(\\tfrac{1}{2}\\big)\\big) = 2\\exp(1) + 2 - 4\\exp\\!\\big(\\tfrac{1}{2}\\big).\n$$\n于是，\n$$\nU'_{\\text{exact}}(0) = m^{-1} (f,\\varphi) = 3\\big(2\\exp(1) + 2 - 4\\exp\\!\\big(\\tfrac{1}{2}\\big)\\big) = 6\\exp(1) + 6 - 12\\exp\\!\\big(\\tfrac{1}{2}\\big),\n$$\n和\n$$\nU'_{\\text{interp}}(0) = f\\!\\left(\\tfrac{1}{2}\\right) = \\exp\\!\\big(\\tfrac{1}{2}\\big).\n$$\n因此，所求的差值为\n$$\n\\Delta = U'_{\\text{exact}}(0) - U'_{\\text{interp}}(0) = \\big(6\\exp(1) + 6 - 12\\exp\\!\\big(\\tfrac{1}{2}\\big)\\big) - \\exp\\!\\big(\\tfrac{1}{2}\\big) = 6\\exp(1) + 6 - 13\\exp\\!\\big(\\tfrac{1}{2}\\big).\n$$\n这是一个只含指数函数的单一闭式解析表达式，符合要求。",
            "answer": "$$\\boxed{6\\exp(1)+6-13\\exp\\!\\left(\\tfrac{1}{2}\\right)}$$"
        },
        {
            "introduction": "一个表现良好的数值方法理应继承原偏微分方程的物理特性，例如热方程的极值原理。本练习 () 将通过一个具体的反例，展示如果网格质量不佳（特别是使用包含钝角的三角形），有限元方法可能会失去这一重要性质。你将通过计算一个关键的刚度矩阵项来证明这一失效，从而将抽象的矩阵属性与具体的网格几何形状联系起来。",
            "id": "3441983",
            "problem": "考虑使用连续分片线性基函数（也称为 $P_1$ 元）通过有限元法（FEM）在空间上半离散化的热传导方程。空间双线性形式为 $a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, dx$，刚度矩阵 $\\boldsymbol{K}$ 由 $K_{ij} = a(\\varphi_{j},\\varphi_{i})$ 定义，其中 $\\{\\varphi_{i}\\}$ 为全局节点基。众所周知，对于半离散线方法系统 $\\boldsymbol{M} \\,\\dot{\\boldsymbol{u}} + \\boldsymbol{K} \\boldsymbol{u} = \\boldsymbol{f}$，离散极值原理（DMP）的一个必要条件是刚度矩阵 $\\boldsymbol{K}$ 具有非正的非对角元（即 $M$-矩阵的符号模式）。\n\n请按如下方式构造一个反例网格片，以表明此符号条件不成立。设区域 $\\Omega$ 是共享节点坐标为 $\\boldsymbol{p}_{1} = (0,0)$ 和 $\\boldsymbol{p}_{2} = (1,0)$ 之间边的两个三角形的并集：\n- 三角形 $\\mathcal{T}_{1}$ 的顶点为 $\\boldsymbol{p}_{1} = (0,0)$，$\\boldsymbol{p}_{2} = (1,0)$ 和 $\\boldsymbol{p}_{3} = \\left(\\tfrac{1}{2}, \\tfrac{1}{10}\\right)$。\n- 三角形 $\\mathcal{T}_{2}$ 的顶点为 $\\boldsymbol{p}_{1} = (0,0)$，$\\boldsymbol{p}_{2} = (1,0)$ 和 $\\boldsymbol{p}_{4} = \\left(\\tfrac{1}{2}, -\\tfrac{1}{4}\\right)$。\n\n在此网格上，使用 $P_1$ 基函数，计算组装后的非对角刚度元 $K_{12} = \\sum_{\\mathcal{T} \\in \\{\\mathcal{T}_{1},\\mathcal{T}_{2}\\}} \\int_{\\mathcal{T}} \\nabla \\varphi_{2} \\cdot \\nabla \\varphi_{1} \\, dx$。请给出 $K_{12}$ 的精确值，表示为一个简化的实数。无需四舍五入。\n\n然后，简要解释 $K_{12}$ 的符号是否与半离散抛物型问题中离散极值原理（DMP）对 $\\boldsymbol{K}$ 的非对角元的非正性要求相符。",
            "solution": "该问题是有效的，因为它具有科学依据、是适定的、客观的，并包含了得到唯一解所需的所有信息。这是使用有限元法（FEM）进行偏微分方程数值分析的一个标准练习。\n\n目标是计算全局刚度矩阵 $\\boldsymbol{K}$ 的非对角元 $K_{12}$，该元是由共享连接节点1和2的边的两个三角形 $\\mathcal{T}_{1}$ 和 $\\mathcal{T}_{2}$ 的局部贡献组装而成的。$K_{ij}$ 的定义由 $K_{ij} = a(\\varphi_j, \\varphi_i)$ 给出，其中 $a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, dx$ 且 $\\{\\varphi_i\\}$ 是 $P_1$ 节点基函数。\n\n组装后的刚度元 $K_{12}$ 是共享节点1和2之间边的每个三角形的局部刚度元之和：\n$$\nK_{12} = K_{12}^{\\mathcal{T}_1} + K_{12}^{\\mathcal{T}_2} = \\int_{\\mathcal{T}_1} \\nabla \\varphi_2 \\cdot \\nabla \\varphi_1 \\, d\\boldsymbol{x} + \\int_{\\mathcal{T}_2} \\nabla \\varphi_2 \\cdot \\nabla \\varphi_1 \\, d\\boldsymbol{x}\n$$\n对于顶点为 $\\boldsymbol{p}_i, \\boldsymbol{p}_j, \\boldsymbol{p}_k$ 的三角形单元 $\\mathcal{T}$，局部刚度矩阵元 $K_{ij}^{\\mathcal{T}}$ 由著名公式给出：\n$$\nK_{ij}^{\\mathcal{T}} = -\\frac{1}{2} \\cot(\\theta_k)\n$$\n其中 $\\theta_k$ 是三角形在顶点 $\\boldsymbol{p}_k$ 处的内角，该顶点与连接 $\\boldsymbol{p}_i$ 和 $\\boldsymbol{p}_j$ 的边相对。\n\n在我们的问题中，需要计算 $K_{12}$。连接节点1和2的边是三角形 $\\mathcal{T}_1$ 和 $\\mathcal{T}_2$ 共有的。\n对于顶点为 $\\boldsymbol{p}_1, \\boldsymbol{p}_2, \\boldsymbol{p}_3$ 的三角形 $\\mathcal{T}_1$，与边 $\\boldsymbol{p}_1\\boldsymbol{p}_2$ 相对的顶点是 $\\boldsymbol{p}_3$。设 $\\theta_3$ 是 $\\boldsymbol{p}_3$ 处的角。\n对于顶点为 $\\boldsymbol{p}_1, \\boldsymbol{p}_2, \\boldsymbol{p}_4$ 的三角形 $\\mathcal{T}_2$，与边 $\\boldsymbol{p}_1\\boldsymbol{p}_2$ 相对的顶点是 $\\boldsymbol{p}_4$。设 $\\theta_4$ 是 $\\boldsymbol{p}_4$ 处的角。\n\n因此，全局刚度元为：\n$$\nK_{12} = K_{12}^{\\mathcal{T}_1} + K_{12}^{\\mathcal{T}_2} = -\\frac{1}{2} \\cot(\\theta_3) - \\frac{1}{2} \\cot(\\theta_4)\n$$\n\n我们接下来计算 $\\cot(\\theta_3)$ 和 $\\cot(\\theta_4)$。\n\n首先，对于顶点为 $\\boldsymbol{p}_{1} = (0,0)$、$\\boldsymbol{p}_{2} = (1,0)$ 和 $\\boldsymbol{p}_{3} = \\left(\\frac{1}{2}, \\frac{1}{10}\\right)$ 的三角形 $\\mathcal{T}_1$。\n角 $\\theta_3$ 是向量 $\\boldsymbol{v}_{31} = \\boldsymbol{p}_1 - \\boldsymbol{p}_3$ 和 $\\boldsymbol{v}_{32} = \\boldsymbol{p}_2 - \\boldsymbol{p}_3$ 之间的夹角。\n$$\n\\boldsymbol{v}_{31} = (0,0) - \\left(\\frac{1}{2}, \\frac{1}{10}\\right) = \\left(-\\frac{1}{2}, -\\frac{1}{10}\\right)\n$$\n$$\n\\boldsymbol{v}_{32} = (1,0) - \\left(\\frac{1}{2}, \\frac{1}{10}\\right) = \\left(\\frac{1}{2}, -\\frac{1}{10}\\right)\n$$\n点积为：\n$$\n\\boldsymbol{v}_{31} \\cdot \\boldsymbol{v}_{32} = \\left(-\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + \\left(-\\frac{1}{10}\\right)\\left(-\\frac{1}{10}\\right) = -\\frac{1}{4} + \\frac{1}{100} = -\\frac{25}{100} + \\frac{1}{100} = -\\frac{24}{100} = -\\frac{6}{25}\n$$\n模长的平方为：\n$$\n|\\boldsymbol{v}_{31}|^2 = \\left(-\\frac{1}{2}\\right)^2 + \\left(-\\frac{1}{10}\\right)^2 = \\frac{1}{4} + \\frac{1}{100} = \\frac{26}{100}\n$$\n$$\n|\\boldsymbol{v}_{32}|^2 = \\left(\\frac{1}{2}\\right)^2 + \\left(-\\frac{1}{10}\\right)^2 = \\frac{1}{4} + \\frac{1}{100} = \\frac{26}{100}\n$$\n所以，$|\\boldsymbol{v}_{31}| = |\\boldsymbol{v}_{32}| = \\frac{\\sqrt{26}}{10}$。\n角 $\\theta_3$ 的余弦为：\n$$\n\\cos(\\theta_3) = \\frac{\\boldsymbol{v}_{31} \\cdot \\boldsymbol{v}_{32}}{|\\boldsymbol{v}_{31}| |\\boldsymbol{v}_{32}|} = \\frac{-6/25}{26/100} = -\\frac{6}{25} \\cdot \\frac{100}{26} = -\\frac{6 \\cdot 4}{26} = -\\frac{12}{13}\n$$\n由于 $\\theta_3$ 是三角形的一个内角，所以 $0  \\theta_3  \\pi$，因此 $\\sin(\\theta_3) > 0$。\n$$\n\\sin(\\theta_3) = \\sqrt{1 - \\cos^2(\\theta_3)} = \\sqrt{1 - \\left(-\\frac{12}{13}\\right)^2} = \\sqrt{1 - \\frac{144}{169}} = \\sqrt{\\frac{25}{169}} = \\frac{5}{13}\n$$\n余切为：\n$$\n\\cot(\\theta_3) = \\frac{\\cos(\\theta_3)}{\\sin(\\theta_3)} = \\frac{-12/13}{5/13} = -\\frac{12}{5}\n$$\n由于 $\\cot(\\theta_3)$ 为负，角 $\\theta_3$ 是一个钝角。\n\n其次，对于顶点为 $\\boldsymbol{p}_{1} = (0,0)$、$\\boldsymbol{p}_{2} = (1,0)$ 和 $\\boldsymbol{p}_{4} = \\left(\\frac{1}{2}, -\\frac{1}{4}\\right)$ 的三角形 $\\mathcal{T}_2$。\n角 $\\theta_4$ 是向量 $\\boldsymbol{v}_{41} = \\boldsymbol{p}_1 - \\boldsymbol{p}_4$ 和 $\\boldsymbol{v}_{42} = \\boldsymbol{p}_2 - \\boldsymbol{p}_4$ 之间的夹角。\n$$\n\\boldsymbol{v}_{41} = (0,0) - \\left(\\frac{1}{2}, -\\frac{1}{4}\\right) = \\left(-\\frac{1}{2}, \\frac{1}{4}\\right)\n$$\n$$\n\\boldsymbol{v}_{42} = (1,0) - \\left(\\frac{1}{2}, -\\frac{1}{4}\\right) = \\left(\\frac{1}{2}, \\frac{1}{4}\\right)\n$$\n点积为：\n$$\n\\boldsymbol{v}_{41} \\cdot \\boldsymbol{v}_{42} = \\left(-\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{4}\\right)\\left(\\frac{1}{4}\\right) = -\\frac{1}{4} + \\frac{1}{16} = -\\frac{4}{16} + \\frac{1}{16} = -\\frac{3}{16}\n$$\n模长的平方为：\n$$\n|\\boldsymbol{v}_{41}|^2 = \\left(-\\frac{1}{2}\\right)^2 + \\left(\\frac{1}{4}\\right)^2 = \\frac{1}{4} + \\frac{1}{16} = \\frac{5}{16}\n$$\n$$\n|\\boldsymbol{v}_{42}|^2 = \\left(\\frac{1}{2}\\right)^2 + \\left(\\frac{1}{4}\\right)^2 = \\frac{1}{4} + \\frac{1}{16} = \\frac{5}{16}\n$$\n所以，$|\\boldsymbol{v}_{41}| = |\\boldsymbol{v}_{42}| = \\frac{\\sqrt{5}}{4}$。\n角 $\\theta_4$ 的余弦为：\n$$\n\\cos(\\theta_4) = \\frac{\\boldsymbol{v}_{41} \\cdot \\boldsymbol{v}_{42}}{|\\boldsymbol{v}_{41}| |\\boldsymbol{v}_{42}|} = \\frac{-3/16}{5/16} = -\\frac{3}{5}\n$$\n$$\n\\sin(\\theta_4) = \\sqrt{1 - \\cos^2(\\theta_4)} = \\sqrt{1 - \\left(-\\frac{3}{5}\\right)^2} = \\sqrt{1 - \\frac{9}{25}} = \\sqrt{\\frac{16}{25}} = \\frac{4}{5}\n$$\n余切为：\n$$\n\\cot(\\theta_4) = \\frac{\\cos(\\theta_4)}{\\sin(\\theta_4)} = \\frac{-3/5}{4/5} = -\\frac{3}{4}\n$$\n由于 $\\cot(\\theta_4)$ 为负，角 $\\theta_4$ 也是一个钝角。\n\n最后，我们组装 $K_{12}$ 的值：\n$$\nK_{12} = -\\frac{1}{2} \\cot(\\theta_3) - \\frac{1}{2} \\cot(\\theta_4) = -\\frac{1}{2}\\left(-\\frac{12}{5}\\right) - \\frac{1}{2}\\left(-\\frac{3}{4}\\right)\n$$\n$$\nK_{12} = \\frac{12}{10} + \\frac{3}{8} = \\frac{6}{5} + \\frac{3}{8}\n$$\n$$\nK_{12} = \\frac{6 \\cdot 8}{40} + \\frac{3 \\cdot 5}{40} = \\frac{48 + 15}{40} = \\frac{63}{40}\n$$\n计算出的值为 $K_{12} = \\frac{63}{40}$，这是一个正数。\n\n半离散系统的离散极值原理（DMP）要求刚度矩阵 $\\boldsymbol{K}$ 是一个 $M$-矩阵，这是一个必要条件。$M$-矩阵的一个性质是其所有非对角元都是非正的，即对于所有 $i \\neq j$ 都有 $K_{ij} \\le 0$。\n我们对给定网格的计算得出 $K_{12} = \\frac{63}{40} > 0$。这违反了非正性条件。因此，$K_{12}$ 的符号与 DMP 的要求不符。这个例子表明，包含钝角的三角剖分会导致刚度矩阵不是 $M$-矩阵，因此离散极值原理（DMP）无法得到保证。",
            "answer": "$$\n\\boxed{\\frac{63}{40}}\n$$"
        },
        {
            "introduction": "对数值方法理解的最终检验是能够亲手实现并验证它。这个实践 () 将指导你完成为热方程编写一个有限元求解器的全过程，并使用“人造解方法”(Method of Manufactured Solutions, MMS)来验证其正确性。这是一个将理论矩阵方程与可工作的、可信赖的仿真工具连接起来的宝贵练习，综合了前面练习中的理论与计算技能。",
            "id": "3442012",
            "problem": "设计并实现一个程序，使用人造解法来验证求解抛物型偏微分方程 (PDE) 的半离散有限元法 (FEM)。在一维空间开区间 $\\left(0, 1\\right)$ 和时间区间 $\\left(0, T\\right]$ 上进行计算。考虑带源项的线性热传导方程\n$$\nu_t - \\left(k\\, u_x\\right)_x = s \\quad \\text{in } \\left(0, 1\\right)\\times\\left(0, T\\right],\n$$\n具有齐次狄利克雷边界条件\n$$\nu\\left(0, t\\right) = 0,\\quad u\\left(1, t\\right) = 0 \\quad \\text{for } t \\in \\left[0, T\\right],\n$$\n和初始条件\n$$\nu\\left(x, 0\\right) = u_0\\left(x\\right) \\quad \\text{for } x \\in \\left[0, 1\\right].\n$$\n将扩散系数设为常数 $k\\left(x\\right) = 1$。在空间上使用 Galerkin 半离散化，在具有 $N$ 个区间的均匀网格上采用连续分片线性基函数，从而得到一个关于时间的常微分方程组。将与节点 $x_i = i\\,h$（其中 $h = 1/N$ 且 $i \\in \\left\\{0, 1, \\dots, N\\right\\}$）相关联的分片线性基记为 $\\left\\{\\varphi_i\\right\\}_{i=0}^{N}$。由于齐次狄利克雷边界条件，半离散解在有限维空间 $V_h = \\text{span}\\left\\{\\varphi_i\\right\\}_{i=1}^{N-1}$ 中求解。\n\n从弱形式出发，该弱形式通过将 PDE 乘以一个测试函数 $v \\in H_0^1\\left(0, 1\\right)$ 并在空间域上积分得到。推导直线法半离散系统的矩阵形式\n$$\nM\\, \\dot{\\mathbf{U}}\\left(t\\right) + K\\, \\mathbf{U}\\left(t\\right) = \\mathbf{F}\\left(t\\right),\n$$\n其中 $M$ 是质量矩阵，其元素为 $M_{ij} = \\int_0^1 \\varphi_i \\varphi_j \\, dx$；$K$ 是刚度矩阵，其元素为 $K_{ij} = \\int_0^1 \\varphi_i' \\varphi_j' \\, dx$；$\\mathbf{U}\\left(t\\right)$ 汇集了内部节点上半离散解的节点值；$\\mathbf{F}\\left(t\\right)$ 是载荷向量，其元素为 $F_i\\left(t\\right) = \\int_0^1 s\\left(x, t\\right)\\, \\varphi_i\\left(x\\right)\\, dx$。不要使用质量集中。使用精确、一致的质量矩阵。\n\n使用人造解进行验证。对于下面每一个人造精确解，通过将精确解代入 $k\\left(x\\right) = 1$ 的 PDE 并重新整理来定义相应的源项 $s\\left(x, t\\right)$。使用精确的初始条件 $u_0\\left(x\\right) = u\\left(x, 0\\right)$ 并施加齐次狄利克雷边界条件 $u\\left(0, t\\right) = u\\left(1, t\\right) = 0$。人造精确解如下：\n- 人造解 A: $u_A\\left(x, t\\right) = \\sin\\left(\\pi x\\right)\\, e^{-t}$。\n- 人造解 B: $u_B\\left(x, t\\right) = x\\left(1-x\\right) \\cos\\left(2 t\\right)$。\n\n你的程序必须：\n- 根据上述在具有 $N$ 个区间的均匀网格上的双线性形式，从第一性原理出发组装 $M$ 和 $K$。\n- 对每个 $t$，通过使用足够精确的高斯求积法则对给定的 $s\\left(x, t\\right)$ 与基函数进行数值积分来构建 $\\mathbf{F}\\left(t\\right)$，以确保空间离散误差远大于求积误差。\n- 消除边界自由度以强施加齐次狄利克雷边界条件，从而得到关于内部未知数的系统。\n- 使用科学计算库中的隐式、变步长常微分方程 (ODE) 求解器，将半离散系统从 $t=0$ 演化到 $t=T$。设置相对容差为 $10^{-10}$，绝对容差为 $10^{-12}$，以使时间误差与空间误差相比可以忽略不计。使用内部节点上精确初始条件的节点插值作为 ODE 的初始向量。\n- 在最终时间 $T$，计算精确解 $u\\left(\\cdot, T\\right)$ 和半离散有限元解 $u_h\\left(\\cdot, T\\right)$ 之间误差的 $L^2\\left(0, 1\\right)$ 范数：\n$$\n\\left\\|u\\left(\\cdot, T\\right) - u_h\\left(\\cdot, T\\right)\\right\\|_{L^2\\left(0, 1\\right)} = \\left(\\int_0^1 \\left(u\\left(x, T\\right) - u_h\\left(x, T\\right)\\right)^2 dx\\right)^{1/2}.\n$$\n使用具有足够多点的高斯求积，以确保求积误差相对于有限元离散误差可以忽略不计。\n\n测试套件。你的程序必须为以下四个测试用例计算上述 $L^2$ 误差。每个测试用例由一对参数 $\\left(N, T\\right)$ 以及要使用的人造解来定义。没有用户输入。\n\n- 测试 1 (正常路径，中等细化): $N = 16$, $T = 0.1$, 人造解 A。\n- 测试 2 (细化研究): $N = 32$, $T = 0.1$, 人造解 A。\n- 测试 3 (不同时间行为): $N = 16$, $T = 0.25$, 人造解 B。\n- 测试 4 (边缘情况，非常粗的网格): $N = 2$, $T = 0.05$, 人造解 A。\n\n输出规格。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，元素按 $\\left[\\text{测试 1 的误差},\\text{测试 2 的误差},\\text{测试 3 的误差},\\text{测试 4 的误差}\\right]$ 的顺序排列。每个误差必须以浮点数形式输出。例如，格式必须与下面完全一样：\n$$\n\\left[\\text{float}_1,\\text{float}_2,\\text{float}_3,\\text{float}_4\\right].\n$$\n\n角度单位和物理单位。本问题中没有物理单位。三角函数中的所有角度都以弧度为单位。\n\n你的实现必须是一个在指定语言和环境下的完整、可运行的程序，并且必须严格遵守输出格式。",
            "solution": "用户提供的问题是有效的，代表了有限元法 (FEM) 实现的一个标准验证练习。该问题在偏微分方程 (PDE) 的数值分析方面有科学依据，是适定、客观的，并为计算求解提供了一个完整且一致的设置。我们接下来进行推导和实现。\n\n问题的核心是使用半离散化方法求解一维热传导方程，这是一个抛物型偏微分方程。该方法首先对空间域进行离散化，将偏微分方程转换为一个关于时间的常微分方程组 (ODEs)，然后使用数值 ODE 积分器求解该方程组。\n\n**1. 弱形式**\n\n给定的 PDE 是带源项 $s(x,t)$、常数扩散系数 $k=1$ 和齐次狄利克雷边界条件的线性热传导方程：\n$$\nu_t - u_{xx} = s(x,t) \\quad \\text{for } x \\in (0, 1), t \\in (0, T]\n$$\n$$\nu(0, t) = u(1, t) = 0\n$$\n$$\nu(x, 0) = u_0(x)\n$$\n为了推导弱形式，我们将 PDE 乘以一个来自适当函数空间的测试函数 $v(x)$，这里是索博列夫空间 $H_0^1(0, 1)$，该空间由平方可积、具有平方可积弱导数且在边界 $x=0$ 和 $x=1$ 处为零的函数组成。在空间域 $\\Omega = (0, 1)$ 上积分得到：\n$$\n\\int_0^1 u_t v \\, dx - \\int_0^1 u_{xx} v \\, dx = \\int_0^1 s v \\, dx\n$$\n对第二项应用分部积分，并利用 $v(0) = v(1) = 0$ 的事实，得到：\n$$\n-\\int_0^1 u_{xx} v \\, dx = -[u_x v]_0^1 + \\int_0^1 u_x v_x \\, dx = \\int_0^1 u_x v_x \\, dx\n$$\n将此代回，我们得到弱形式：寻找 $u(\\cdot, t) \\in H_0^1(0, 1)$（对于 $t  0$），使得对于所有 $v \\in H_0^1(0, 1)$：\n$$\n\\int_0^1 u_t v \\, dx + \\int_0^1 u_x v_x \\, dx = \\int_0^1 s v \\, dx\n$$\n时间导数可以移到积分号外，得到用于半离散化的最终形式：\n$$\n\\frac{d}{dt} \\int_0^1 u v \\, dx + \\int_0^1 u_x v_x \\, dx = \\int_0^1 s v \\, dx\n$$\n\n**2. Galerkin 半离散化**\n\n我们在有限维子空间 $V_h \\subset H_0^1(0, 1)$ 中近似解 $u(x,t)$。区域 $(0, 1)$ 被划分为 $N$ 个长度为 $h=1/N$ 的均匀区间。节点为 $x_i = i h$，其中 $i=0, \\dots, N$。我们使用连续分片线性基函数（“帽”函数）$\\varphi_i(x)$，其中 $\\varphi_i(x_j) = \\delta_{ij}$（克罗内克 δ）。由于边界条件是齐次狄利克雷条件，与边界节点 $\\varphi_0$ 和 $\\varphi_N$ 相关联的基函数被排除在解空间之外。因此，$V_h = \\text{span}\\{\\varphi_i\\}_{i=1}^{N-1}$。\n\n近似解 $u_h(x,t)$ 写为这些基函数与含时系数的线性组合：\n$$\nu_h(x,t) = \\sum_{j=1}^{N-1} U_j(t) \\varphi_j(x)\n$$\n在 Galerkin 方法中，测试函数选自与基函数相同的空间，即 $v = \\varphi_i(x)$，其中 $i=1, \\dots, N-1$。将 $u_h$ 和 $v=\\varphi_i$ 代入弱形式，得到一个包含 $N-1$ 个常微分方程的方程组：\n$$\n\\sum_{j=1}^{N-1} \\left( \\int_0^1 \\varphi_i \\varphi_j \\, dx \\right) \\frac{d U_j}{dt} + \\sum_{j=1}^{N-1} \\left( \\int_0^1 \\varphi_i' \\varphi_j' \\, dx \\right) U_j(t) = \\int_0^1 s(x,t) \\varphi_i(x) \\, dx\n$$\n这就是直线法系统，可以表示为矩阵形式：\n$$\nM \\mathbf{\\dot{U}}(t) + K \\mathbf{U}(t) = \\mathbf{F}(t)\n$$\n其中 $\\mathbf{U}(t) = [U_1(t), \\dots, U_{N-1}(t)]^T$ 是内部节点上未知节点值的向量。矩阵 $M$（质量矩阵）和 $K$（刚度矩阵），以及向量 $\\mathbf{F}(t)$（载荷向量）的元素定义如下：\n- $M_{ij} = \\int_0^1 \\varphi_i \\varphi_j \\, dx$\n- $K_{ij} = \\int_0^1 \\varphi_i' \\varphi_j' \\, dx$\n- $F_i(t) = \\int_0^1 s(x,t) \\varphi_i(x) \\, dx$\n（其中索引 $i, j$ 的范围从 1 到 $N-1$）。\n\n**3. 矩阵组装**\n\n$M$ 和 $K$ 的元素仅在 $\\varphi_i$ 和 $\\varphi_j$ 的支集重叠时才为非零，对于帽函数，这仅在 $|i-j| \\le 1$ 时发生。直接积分可得到步长为 $h$ 的均匀网格上众所周知的三对角结构：\n- 区间 $[x_k, x_{k+1}]$ 上的质量矩阵元素为：$\\frac{h}{6}\\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$。为内部节点组装后得到 $(N-1) \\times (N-1)$ 矩阵：\n$$\nM = \\frac{h}{6} \\begin{pmatrix} 4  1  0  \\dots \\\\ 1  4  1  \\dots \\\\  \\ddots  \\ddots  \\ddots \\\\ \\dots  0  1  4 \\end{pmatrix}\n$$\n- 区间 $[x_k, x_{k+1}]$ 上的刚度矩阵元素为：$\\frac{1}{h}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。组装后得到 $(N-1) \\times (N-1)$ 矩阵：\n$$\nK = \\frac{1}{h} \\begin{pmatrix} 2  -1  0  \\dots \\\\ -1  2  -1  \\dots \\\\  \\ddots  \\ddots  \\ddots \\\\ \\dots  0  -1  2 \\end{pmatrix}\n$$\n\n**4. 人造解法**\n\n为了验证实现，我们使用人造解。我们指定一个满足边界条件的光滑函数 $u(x,t)$，然后通过将 $u(x,t)$ 代入 PDE 算子来推导源项 $s(x,t)$：$s = u_t - u_{xx}$。\n- **解 A**: $u_A(x,t) = \\sin(\\pi x) e^{-t}$。\n$s_A(x,t) = \\frac{\\partial u_A}{\\partial t} - \\frac{\\partial^2 u_A}{\\partial x^2} = -\\sin(\\pi x)e^{-t} - (-\\pi^2 \\sin(\\pi x)e^{-t}) = (\\pi^2-1)\\sin(\\pi x)e^{-t}$。\n- **解 B**: $u_B(x,t) = x(1-x) \\cos(2t)$。\n$s_B(x,t) = \\frac{\\partial u_B}{\\partial t} - \\frac{\\partial^2 u_B}{\\partial x^2} = -2x(1-x)\\sin(2t) - (-2\\cos(2t)) = 2\\cos(2t) - 2x(1-x)\\sin(2t)$。\nODE 系统的初始条件是 $t=0$ 时精确解的节点投影，即 $U_j(0) = u(x_j, 0)$。\n\n**5. 数值实现**\n\n- **载荷向量和误差计算**：载荷向量 $\\mathbf{F}(t)$ 和最终 $L^2$ 误差范数的积分采用数值方法计算。我们在每个单元上使用高斯求积。选择一个高阶法则（例如，5点）以确保求积误差与空间离散误差相比可以忽略不计，对于线性元，空间离散误差为 $O(h^2)$。\n- **时间积分**：将 ODE 系统重新排列为 $\\mathbf{\\dot{U}}(t) = M^{-1}(\\mathbf{F}(t) - K \\mathbf{U}(t))$。这是一个刚性系统，因此需要使用隐式、高阶、自适应步长的时间积分方法。我们使用 `scipy.integrate.solve_ivp` 提供的 `Radau` 求解器，并设置非常严格的容差（$rtol=10^{-10}$, $atol=10^{-12}$），以使时间误差微不足道。质量矩阵 $M$ 是常数，因此其 LU 分解只计算一次，并在每次计算 ODE 右端项时重复使用，以高效求解线性系统 $M\\mathbf{y} = \\mathbf{b}$。\n- **$L^2$ 误差范数**：在最终时间 $T$，误差计算为 $\\|e(\\cdot,T)\\|_{L^2} = \\left(\\int_0^1 (u(x,T) - u_h(x,T))^2 dx\\right)^{1/2}$。该积分通过将每个单元上的积分求和来计算，每个积分都使用高斯求积进行评估：\n$$\n\\|e(\\cdot,T)\\|_{L^2}^2 = \\sum_{k=0}^{N-1} \\int_{x_k}^{x_{k+1}} (u(x,T) - u_h(x,T))^2 dx\n$$\n\n该实现封装了这整个过程，为四个指定的测试用例中的每一个运行它，并报告计算出的 $L^2$ 误差。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.linalg import lu_factor, lu_solve\n# numpy.polynomial is part of numpy.\nfrom numpy.polynomial.legendre import leggauss\n\n# Manufactured solution A\ndef u_A(x, t):\n    \"\"\"Manufactured solution A: u(x,t) = sin(pi*x) * exp(-t)\"\"\"\n    return np.sin(np.pi * x) * np.exp(-t)\n\ndef s_A(x, t):\n    \"\"\"Source term corresponding to manufactured solution A.\"\"\"\n    return (np.pi**2 - 1) * np.sin(np.pi * x) * np.exp(-t)\n\n# Manufactured solution B\ndef u_B(x, t):\n    \"\"\"Manufactured solution B: u(x,t) = x(1-x)cos(2t)\"\"\"\n    return x * (1 - x) * np.cos(2 * t)\n\ndef s_B(x, t):\n    \"\"\"Source term corresponding to manufactured solution B.\"\"\"\n    return 2 * np.cos(2 * t) - 2 * x * (1 - x) * np.sin(2 * t)\n\ndef run_case(N, T, u_exact, s_func):\n    \"\"\"\n    Solves the heat equation for a single test case using FEM.\n\n    Args:\n        N (int): Number of spatial intervals.\n        T (float): Final time.\n        u_exact (callable): Function for the exact solution u(x,t).\n        s_func (callable): Function for the source term s(x,t).\n\n    Returns:\n        float: The L2 error at the final time T.\n    \"\"\"\n    h = 1.0 / N\n    x_nodes = np.linspace(0, 1, N + 1)\n    num_interior_nodes = N - 1\n\n    # Assemble Mass (M) and Stiffness (K) matrices for interior nodes\n    diag_M = np.full(num_interior_nodes, 2.0 * h / 3.0)\n    offdiag_M = np.full(num_interior_nodes - 1, h / 6.0)\n    M = np.diag(diag_M) + np.diag(offdiag_M, k=1) + np.diag(offdiag_M, k=-1)\n\n    diag_K = np.full(num_interior_nodes, 2.0 / h)\n    offdiag_K = np.full(num_interior_nodes - 1, -1.0 / h)\n    K = np.diag(diag_K) + np.diag(offdiag_K, k=1) + np.diag(offdiag_K, k=-1)\n\n    # Pre-compute LU factorization of M for efficiency\n    M_lu = lu_factor(M)\n\n    # Gaussian quadrature setup (sufficiently high order)\n    num_gauss_points = 5\n    gauss_pts_ref, gauss_wts_ref = leggauss(num_gauss_points)\n\n    def F_vec(t):\n        \"\"\"Computes the load vector F(t) using Gaussian quadrature.\"\"\"\n        f = np.zeros(num_interior_nodes)\n        for j_idx in range(num_interior_nodes):\n            j_node = j_idx + 1  # Node index (1 to N-1)\n\n            # Support of phi_j is [x_{j-1}, x_{j+1}]\n            # Integral over left element [x_{j-1}, x_j]\n            x_L, x_R = x_nodes[j_node - 1], x_nodes[j_node]\n            q_pts = 0.5 * (x_R - x_L) * gauss_pts_ref + 0.5 * (x_R + x_L)\n            q_wts = 0.5 * (x_R - x_L) * gauss_wts_ref\n            phi_j_vals = (q_pts - x_L) / h\n            integral_L = np.sum(q_wts * s_func(q_pts, t) * phi_j_vals)\n            \n            # Integral over right element [x_j, x_{j+1}]\n            x_L, x_R = x_nodes[j_node], x_nodes[j_node + 1]\n            q_pts = 0.5 * (x_R - x_L) * gauss_pts_ref + 0.5 * (x_R + x_L)\n            q_wts = 0.5 * (x_R - x_L) * gauss_wts_ref\n            phi_j_vals = (x_R - q_pts) / h\n            integral_R = np.sum(q_wts * s_func(q_pts, t) * phi_j_vals)\n            \n            f[j_idx] = integral_L + integral_R\n        return f\n\n    def rhs(t, U):\n        \"\"\"Right-hand side of the ODE system dU/dt = M^{-1}(F(t) - K*U).\"\"\"\n        b = F_vec(t) - K @ U\n        return lu_solve(M_lu, b)\n\n    # Nodal interpolation for the initial condition\n    U0 = u_exact(x_nodes[1:-1], 0)\n\n    # Solve the system of ODEs\n    sol = solve_ivp(\n        rhs, (0, T), U0, method='Radau',\n        rtol=1e-10, atol=1e-12, t_eval=[T]\n    )\n    U_final = sol.y[:, -1]\n    \n    # Full solution vector including boundaries\n    U_full = np.concatenate(([0], U_final, [0]))\n\n    # Compute L2 error at final time T\n    total_err_sq = 0.0\n    for i in range(N):  # Loop over elements [x_i, x_{i+1}]\n        x_L, x_R = x_nodes[i], x_nodes[i+1]\n        \n        q_pts = 0.5 * (x_R - x_L) * gauss_pts_ref + 0.5 * (x_R + x_L)\n        q_wts = 0.5 * (x_R - x_L) * gauss_wts_ref\n        \n        u_exact_vals = u_exact(q_pts, T)\n        \n        # On element i, u_h(x) = U_i * phi_i(x) + U_{i+1} * phi_{i+1}(x)\n        phi_i_vals = (x_R - q_pts) / h\n        phi_i_plus_1_vals = (q_pts - x_L) / h\n        u_h_vals = U_full[i] * phi_i_vals + U_full[i+1] * phi_i_plus_1_vals\n        \n        total_err_sq += np.sum(q_wts * (u_exact_vals - u_h_vals)**2)\n    \n    return np.sqrt(total_err_sq)\n\n\ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    test_cases = [\n        {'N': 16, 'T': 0.1, 'u': u_A, 's': s_A},\n        {'N': 32, 'T': 0.1, 'u': u_A, 's': s_A},\n        {'N': 16, 'T': 0.25, 'u': u_B, 's': s_B},\n        {'N': 2, 'T': 0.05, 'u': u_A, 's': s_A}\n    ]\n\n    results = []\n    for case in test_cases:\n        error = run_case(case['N'], case['T'], case['u'], case['s'])\n        results.append(error)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}