{
    "hands_on_practices": [
        {
            "introduction": "本实践旨在通过一个经典的结构动力学问题——计算杆的固有振动频率——来具体展示一致质量矩阵和集中质量矩阵的核心差异。通过从头开始构建有限元模型，您将亲手实现这两种质量矩阵，并求解广义特征值问题。这个练习不仅能加深您对有限元基本原理的理解，还能让您直观地比较两种方法在不同网格密度和单元阶次下对计算精度的影响，从而为在实际工程问题中选择合适的质量矩阵提供实践依据。",
            "id": "3589685",
            "problem": "考虑一根长度为 $L$、横截面积为 $A$、杨氏模量为 $E$、质量密度为 $\\rho$ 的均匀直棱柱杆的轴向振动。其小振幅轴向运动的控制方程是一维线性动量平衡方程，$E A \\, \\frac{\\partial^2 u}{\\partial x^2} + \\rho A \\, \\frac{\\partial^2 u}{\\partial t^2} = 0$，并带有齐次 Dirichlet 边界条件 $u(0,t)=0$ 和 $u(L,t)=0$。目标是使用有限元法 (FEM) 和多项式插值形函数来近似计算该杆的前三个固有频率，并严格比较使用一致质量矩阵与通过行和法或节点积分法得到的对角集中质量矩阵所带来的影响。\n\n从轴向波动方程和加权残差法出发，选择与形函数相等的权函数（即 Galerkin 方法），推导出离散特征值问题 $K \\mathbf{u} = \\omega^2 M \\mathbf{u}$，其中 $K$ 是全局刚度矩阵，$M$ 是全局质量矩阵，$\\mathbf{u}$ 是离散振型向量，$\\omega$ 是固有圆频率。在均匀网格上，使用一次（线性）和二次（二次）的一维 Lagrange 多项式插值形函数来构建 $K$ 和 $M$。对于质量矩阵，计算：\n- 通过在每个单元上进行精确多项式积分得到的一致质量矩阵。\n- 通过对全局一致质量矩阵的行求和（行和集中法）得到的对角集中质量矩阵。你也可以选择在单元级别通过节点积分法实现质量集中，只要它能产生相同的对角线元素。\n\n在均匀网格上执行组装过程，通过消除边界自由度来施加齐次 Dirichlet 边界条件，并求解广义对称特征值问题以获得前三个振型。将结果与两端固定轴向杆的精确连续解进行比较，其固有圆频率为 $\\omega_n = \\frac{n \\pi}{L} \\sqrt{\\frac{E}{\\rho}}$，其中整数 $n \\ge 1$。\n\n报告每个振型 $n$ 的相对误差，定义为 $(\\omega_{n}^{\\text{FE}} - \\omega_{n}^{\\text{exact}})/\\omega_{n}^{\\text{exact}}$，以不带百分号的小数值表示。应分别给出使用一致质量矩阵和集中质量矩阵的比较结果。尽管固有频率的单位是弧度/秒，但所要求的输出是无量纲的相对误差。\n\n使用以下科学上一致的参数集作为测试套件，涵盖不同的插值阶数和网格密度：\n- 案例 1：线性单元，单元数量 $N_e=4$，$L=1.0\\,\\text{m}$，$A=1.0 \\times 10^{-4}\\,\\text{m}^2$，$E=2.00\\times 10^{11}\\,\\text{Pa}$，$\\rho=7800\\,\\text{kg/m}^3$。\n- 案例 2：线性单元，单元数量 $N_e=20$，$L=1.0\\,\\text{m}$，$A=1.0 \\times 10^{-4}\\,\\text{m}^2$，$E=2.00\\times 10^{11}\\,\\text{Pa}$，$\\rho=7800\\,\\text{kg/m}^3$。\n- 案例 3：二次单元，单元数量 $N_e=2$，$L=1.0\\,\\text{m}$，$A=1.0 \\times 10^{-4}\\,\\text{m}^2$，$E=2.00\\times 10^{11}\\,\\text{Pa}$，$\\rho=7800\\,\\text{kg/m}^3$。\n- 案例 4：二次单元，单元数量 $N_e=5$，$L=1.0\\,\\text{m}$，$A=1.0 \\times 10^{-4}\\,\\text{m}^2$，$E=2.00\\times 10^{11}\\,\\text{Pa}$，$\\rho=7800\\,\\text{kg/m}^3$。\n\n你的程序必须为每个案例计算一个包含六个小数值的列表 $[\\varepsilon_{c,1}, \\varepsilon_{l,1}, \\varepsilon_{c,2}, \\varepsilon_{l,2}, \\varepsilon_{c,3}, \\varepsilon_{l,3}]$，其中 $\\varepsilon_{c,n}$ 是使用一致质量矩阵时振型 $n$ 的相对误差，而 $\\varepsilon_{l,n}$ 是使用集中质量矩阵时振型 $n$ 的相对误差。最终输出必须将四个案例各自的列表聚合为单行，打印为由方括号括起来的逗号分隔列表，例如 $[[\\ldots],[\\ldots],[\\ldots],[\\ldots]]$。\n\n不允许用户输入；所有参数都内嵌在程序中。数值结果应是可复现且科学合理的。确保形函数、单元矩阵的构建以及组装过程是从多项式插值和能量一致离散化的第一性原理推导出来的。",
            "solution": "确定轴向振动杆的固有频率是结构动力学中的一个经典特征值问题。所给问题是适定的、科学合理的，并包含了使用有限元法 (FEM) 求解所需的所有必要信息。\n\n轴向位移 $u(x,t)$ 的控制偏微分方程是一维波动方程：\n$$ E A \\frac{\\partial^2 u}{\\partial x^2} = \\rho A \\frac{\\partial^2 u}{\\partial t^2} $$\n假设简谐响应的形式为 $u(x,t) = \\tilde{u}(x)e^{i\\omega t}$，其中 $\\tilde{u}(x)$ 是振型，$\\omega$ 是固有圆频率，问题简化为一个不含时的常微分方程：\n$$ E A \\frac{d^2 \\tilde{u}}{dx^2} + \\rho A \\omega^2 \\tilde{u} = 0 $$\n并带有齐次 Dirichlet 边界条件 $\\tilde{u}(0) = 0$ 和 $\\tilde{u}(L) = 0$。\n\n为了建立有限元模型，我们从加权残差法开始。将控制常微分方程乘以一个权函数 $w(x)$ 并在定义域 $[0, L]$ 上积分，得到：\n$$ \\int_0^L w \\left( E A \\frac{d^2 \\tilde{u}}{dx^2} + \\rho A \\omega^2 \\tilde{u} \\right) dx = 0 $$\n对刚度项使用分部积分，得到弱形式：\n$$ -\\int_0^L E A \\frac{dw}{dx} \\frac{d\\tilde{u}}{dx} dx + \\left[ w E A \\frac{d\\tilde{u}}{dx} \\right]_0^L + \\omega^2 \\int_0^L \\rho A w \\tilde{u} dx = 0 $$\n在 Galerkin 方法中，权函数 $w(x)$ 从与 $\\tilde{u}(x)$ 的试函数相同的空间中选取。为满足在 $x=0$ 和 $x=L$ 处的本质边界条件，我们要求 $w(0)=0$ 和 $w(L)=0$，这使得边界项 $\\left[ w E A d\\tilde{u}/dx \\right]_0^L$ 为零。待求解的弱形式为：\n求 $\\tilde{u}(x)$ 使得对于所有容许的 $w(x)$：\n$$ \\int_0^L E A \\frac{dw}{dx} \\frac{d\\tilde{u}}{dx} dx = \\omega^2 \\int_0^L \\rho A w \\tilde{u} dx $$\n\n将定义域离散为 $N_e$ 个单元。在每个单元 $\\Omega_e$ 内，位移场使用多项式形函数 $\\mathbf{N}^{(e)}$ 和节点位移 $\\mathbf{d}^{(e)}$ 进行近似表示：\n$$ \\tilde{u}^{(e)}(x) = \\mathbf{N}^{(e)}(x) \\mathbf{d}^{(e)} $$\n应用 Galerkin 原理，即依次将每个形函数作为 $w$，并对所有单元的贡献求和，得到全局离散系统，这是一个广义特征值问题：\n$$ K \\mathbf{d} = \\omega^2 M \\mathbf{d} $$\n其中 $\\mathbf{d}$ 是全局节点位移向量，全局刚度矩阵 $K$ 和质量矩阵 $M$ 由单元矩阵 $K^{(e)}$ 和 $M^{(e)}$ 组装而成：\n$$ K^{(e)} = \\int_{\\Omega_e} E A (\\mathbf{B}^{(e)})^T \\mathbf{B}^{(e)} dx \\quad , \\quad M^{(e)} = \\int_{\\Omega_e} \\rho A (\\mathbf{N}^{(e)})^T \\mathbf{N}^{(e)} dx $$\n此处，$\\mathbf{B}^{(e)} = d\\mathbf{N}^{(e)}/dx$ 是应变-位移矩阵。\n\n积分通常在具有局部坐标 $\\xi \\in [-1, 1]$ 的标准父单元上进行计算。对于单元长度为 $h_e = L/N_e$ 的均匀网格，从 $\\xi$ 到 $x$ 的坐标变换的雅可比是 $J = h_e/2$。单元矩阵变为：\n$$ K^{(e)} = \\frac{EA}{h_e} \\int_{-1}^{1} \\left(\\frac{d\\mathbf{N}}{d\\xi}\\right)^T \\frac{d\\mathbf{N}}{d\\xi} d\\xi $$\n$$ M^{(e)} = \\frac{\\rho A h_e}{2} \\int_{-1}^{1} \\mathbf{N}^T \\mathbf{N} d\\xi $$\n\n**一维线性单元（2个节点）**\n单元在 $\\xi = -1$ 和 $\\xi = 1$ 处有两个节点。线性 Lagrange 形函数为：\n$$ N_1(\\xi) = \\frac{1-\\xi}{2}, \\quad N_2(\\xi) = \\frac{1+\\xi}{2} $$\n单元刚度矩阵为：\n$$ K^{(e)} = \\frac{EA}{h_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} $$\n单元一致质量矩阵为：\n$$ M_c^{(e)} = \\frac{\\rho A h_e}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix} $$\n对角集中质量矩阵通过对 $M_c^{(e)}$ 的行求和并将总和置于对角线上得到。这等效于将单元质量的一半集中在每个节点上：\n$$ M_l^{(e)} = \\frac{\\rho A h_e}{2} \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix} $$\n\n**一维二次单元（3个节点）**\n单元在 $\\xi = -1, 0, 1$ 处有三个节点。二次 Lagrange 形函数为：\n$$ N_1(\\xi) = \\frac{\\xi(\\xi-1)}{2}, \\quad N_2(\\xi) = 1-\\xi^2, \\quad N_3(\\xi) = \\frac{\\xi(\\xi+1)}{2} $$\n单元刚度矩阵为：\n$$ K^{(e)} = \\frac{EA}{3h_e} \\begin{bmatrix} 7  -8  1 \\\\ -8  16  -8 \\\\ 1  -8  7 \\end{bmatrix} $$\n单元一致质量矩阵为：\n$$ M_c^{(e)} = \\frac{\\rho A h_e}{30} \\begin{bmatrix} 4  2  -1 \\\\ 2  16  2 \\\\ -1  2  4 \\end{bmatrix} $$\n通过行求和得到的对角集中质量矩阵为：\n$$ M_l^{(e)} = \\frac{\\rho A h_e}{30} \\begin{bmatrix} 5  0  0 \\\\ 0  20  0 \\\\ 0  0  5 \\end{bmatrix} = \\frac{\\rho A h_e}{6} \\begin{bmatrix} 1  0  0 \\\\ 0  4  0 \\\\ 0  0  1 \\end{bmatrix} $$\n\n**组装与边界条件**\n全局矩阵 $K$ 和 $M$ 是通过遍历每个单元并将其贡献添加到相应的全局自由度 (DOFs) 上来构建的。对于线性单元，有 $N_n = N_e+1$ 个节点。对于二次单元，有 $N_n = 2N_e+1$ 个节点。通过从全局矩阵中消除对应于第一个和最后一个节点的行和列来施加齐次 Dirichlet 边界条件 $u(0)=u(L)=0$。这会得到大小为 $(N_n-2) \\times (N_n-2)$ 的缩减矩阵 $K_{red}$ 和 $M_{red}$。\n\n**特征值问题与误差计算**\n我们对一致质量矩阵和集中质量矩阵分别求解缩减后的广义特征值问题：\n$$ K_{red} \\mathbf{d}_{red} = \\omega_c^2 M_{c,red} \\mathbf{d}_{red} \\quad \\text{和} \\quad K_{red} \\mathbf{d}_{red} = \\omega_l^2 M_{l,red} \\mathbf{d}_{red} $$\n计算出特征值 $\\omega^2$，然后通过取平方根得到固有频率。将计算出的前三个频率 $\\omega_{n}^{\\text{FE}}$ 与两端固定杆的精确解析解进行比较：\n$$ \\omega_n^{\\text{exact}} = \\frac{n \\pi}{L} \\sqrt{\\frac{E}{\\rho}}, \\quad n=1, 2, 3, \\dots $$\n每个振型 $n$ 的相对误差计算如下：\n$$ \\varepsilon_n = \\frac{\\omega_{n}^{\\text{FE}} - \\omega_{n}^{\\text{exact}}}{\\omega_{n}^{\\text{exact}}} $$\n对四个指定的测试案例均重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef compute_errors(elem_type, N_e, L, A, E, rho):\n    \"\"\"\n    Computes the relative errors for the first three natural frequencies of an axial bar\n    using the Finite Element Method.\n\n    Args:\n        elem_type (str): 'linear' or 'quadratic'.\n        N_e (int): Number of elements.\n        L (float): Length of the bar.\n        A (float): Cross-sectional area.\n        E (float): Young's modulus.\n        rho (float): Mass density.\n\n    Returns:\n        list: A list of six float values representing the relative errors:\n              [err_c1, err_l1, err_c2, err_l2, err_c3, err_l3]\n              'c' for consistent mass, 'l' for lumped mass.\n    \"\"\"\n    \n    h_e = L / N_e\n    \n    if elem_type == 'linear':\n        n_nodes_elem = 2\n        n_dof_total = N_e + 1\n        \n        # Element stiffness matrix\n        K_e = (E * A / h_e) * np.array([[1, -1], [-1, 1]])\n        \n        # Element consistent mass matrix\n        M_c_e = (rho * A * h_e / 6.0) * np.array([[2, 1], [1, 2]])\n        \n        # Element lumped mass matrix (row-sum technique)\n        M_l_e = np.diag(M_c_e.sum(axis=1))\n        \n    elif elem_type == 'quadratic':\n        n_nodes_elem = 3\n        n_dof_total = 2 * N_e + 1\n        \n        # Element stiffness matrix\n        K_e = (E * A / (3.0 * h_e)) * np.array([\n            [7, -8, 1],\n            [-8, 16, -8],\n            [1, -8, 7]\n        ])\n        \n        # Element consistent mass matrix\n        M_c_e = (rho * A * h_e / 30.0) * np.array([\n            [4, 2, -1],\n            [2, 16, 2],\n            [-1, 2, 4]\n        ])\n        \n        # Element lumped mass matrix (row-sum technique)\n        M_l_e = np.diag(M_c_e.sum(axis=1))\n        \n    else:\n        raise ValueError(\"Invalid element type specified.\")\n\n    # Initialize global matrices\n    K_global = np.zeros((n_dof_total, n_dof_total))\n    M_c_global = np.zeros((n_dof_total, n_dof_total))\n    M_l_global = np.zeros((n_dof_total, n_dof_total))\n\n    # Assembly\n    nodes_per_elem_minus_1 = n_nodes_elem - 1\n    for i in range(N_e):\n        # Determine global indices for the current element's nodes\n        if elem_type == 'linear': # P1 elements\n            start_idx = i\n        else: # P2 elements\n            start_idx = i * 2\n        \n        dof_map = slice(start_idx, start_idx + n_nodes_elem)\n        \n        K_global[dof_map, dof_map] += K_e\n        M_c_global[dof_map, dof_map] += M_c_e\n        M_l_global[dof_map, dof_map] += M_l_e\n\n    # Apply homogeneous Dirichlet boundary conditions (u(0)=0, u(L)=0)\n    # by removing first and last rows/columns\n    internal_dofs = slice(1, n_dof_total - 1)\n    K_red = K_global[internal_dofs, internal_dofs]\n    M_c_red = M_c_global[internal_dofs, internal_dofs]\n    M_l_red = M_l_global[internal_dofs, internal_dofs]\n\n    # Solve generalized eigenvalue problems\n    # scipy.linalg.eigh returns eigenvalues in ascending order\n    # eigenvalues are omega^2\n    \n    # Consistent mass\n    eigvals_c = eigh(K_red, M_c_red, eigvals_only=True)\n    omega_fe_c = np.sqrt(eigvals_c)\n\n    # Lumped mass\n    eigvals_l = eigh(K_red, M_l_red, eigvals_only=True)\n    omega_fe_l = np.sqrt(eigvals_l)\n\n    # Calculate exact frequencies\n    c = np.sqrt(E / rho)\n    n_modes = 3\n    omega_exact = [(n + 1) * np.pi * c / L for n in range(n_modes)]\n    \n    # Calculate relative errors\n    errors = []\n    for i in range(n_modes):\n        # For small problems (3 DOFs), we only get 3 frequencies.\n        # For larger problems, ensure we don't index out of bounds.\n        if i  len(omega_fe_c):\n            err_c = (omega_fe_c[i] - omega_exact[i]) / omega_exact[i]\n            err_l = (omega_fe_l[i] - omega_exact[i]) / omega_exact[i]\n            errors.extend([err_c, err_l])\n        else:\n            # Should not happen for the given test cases\n            errors.extend([np.nan, np.nan])\n            \n    return errors\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {'elem_type': 'linear', 'N_e': 4, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800},\n        {'elem_type': 'linear', 'N_e': 20, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800},\n        {'elem_type': 'quadratic', 'N_e': 2, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800},\n        {'elem_type': 'quadratic', 'N_e': 5, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = compute_errors(\n            elem_type=case['elem_type'],\n            N_e=case['N_e'],\n            L=case['L'],\n            A=case['A'],\n            E=case['E'],\n            rho=case['rho']\n        )\n        all_results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在显式时间积分方法中，计算效率很大程度上取决于允许的最大稳定时间步长。本练习将通过对二维热传导方程的稳定性分析，揭示集中质量矩阵在此方面的关键优势。您将推导并比较在使用集中质量矩阵和（近似的）一致质量矩阵时，显式欧拉法的最大稳定时间步长。这个理论实践将帮助您深刻理解为什么在许多瞬态动力学或波传播问题中，工程师们宁愿牺牲部分精度也要选择集中质量矩阵，因为它能极大地提高计算效率。",
            "id": "3456072",
            "problem": "考虑一个在平坦二维环面上的单位热扩散系数热方程 $u_t = \\Delta u$，该方程使用有限元法 (FEM) 进行空间离散。离散化采用连续分片线性形函数，建立在由边长为 $\\ell$ 的全等等边三角形构成的均匀、周期性平面三角剖分上。令 $K$ 表示组装后的刚度矩阵，其元素为 $K_{ij} = \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, \\mathrm{d}x$；令 $M$ 表示一致质量矩阵，其元素为 $M_{ij} = \\int_{\\Omega} \\phi_i \\phi_j \\, \\mathrm{d}x$。将集总质量矩阵 $M_L$ 定义为通过对 $M$ 进行行求和（row-summing）得到的对角矩阵。考虑半离散系统 $M \\dot{u} + K u = 0$ 的显式前向欧拉时间离散，即 $u^{n+1} = u^n - \\Delta t \\, B K u^n$，其中 $B$ 要么是 $M_L^{-1}$（集总质量），要么是通过从零初始猜测开始执行单次 Jacobi 迭代获得的 $M^{-1}$ 的近似，即 $B = D^{-1}$，其中 $D = \\operatorname{diag}(M)$。\n\n仅使用上述基本定义和关于线性系统前向欧拉方法稳定性的公认事实，计算以下情况的最大线性稳定时间步长 $\\Delta t_{\\max}$：\n- 集总质量情况 $B = M_L^{-1}$，\n- 单次 Jacobi 迭代求逆的一致质量情况 $B = D^{-1}$，\n在此周期性等边三角形网格上。将这两个值表示为仅含边长 $\\ell$ 的闭式解析表达式，并按 $(\\Delta t_{\\max}^{\\mathrm{lump}}, \\Delta t_{\\max}^{\\mathrm{Jacobi}})$ 的顺序给出。\n\n最终答案必须是包含这两个表达式的单行矩阵。无需四舍五入，也无需在最终答案中报告物理单位。",
            "solution": "用户希望找到热方程 $u_t = \\Delta u$ 在等边三角形周期性网格上进行有限元近似后，采用前向欧拉时间离散时的最大稳定时间步长。显式格式 $u^{n+1} = (I - \\Delta t \\, B K) u^n$ 的稳定性由矩阵 $BK$ 的谱半径决定。对于对称半正定刚度矩阵 $K$ 和对称正定矩阵 $B$，矩阵 $B^{1/2} K B^{1/2}$ 也是对称半正定的，因此其特征值为非负实数。由于 $BK$ 与 $B^{1/2} K B^{1/2}$ 相似，其特征值 $\\lambda_j(BK)$ 也是非负实数。\n\n前向欧拉方法的稳定性条件要求放大矩阵 $G = I - \\Delta t B K$ 的所有特征值 $\\mu_j$ 都满足 $|\\mu_j| \\le 1$。$G$ 的特征值为 $\\mu_j = 1 - \\Delta t \\lambda_j(BK)$。该条件变为 $|1 - \\Delta t \\lambda_j| \\le 1$，对于非负实数 $\\lambda_j$，这可简化为 $-1 \\le 1 - \\Delta t \\lambda_j \\le 1$。这意味着 $0 \\le \\Delta t \\lambda_j \\le 2$。关键约束由最大特征值 $\\lambda_{\\max}(BK)$ 决定，从而得出稳定性极限：\n$$ \\Delta t \\le \\frac{2}{\\lambda_{\\max}(BK)} $$\n我们的任务是计算两种给定 $B$ 选择下的 $\\lambda_{\\max}(BK)$。这需要计算刚度矩阵 $K$ 和与质量相关的矩阵 $B$ 的元素。\n\n首先，我们计算单个边长为 $\\ell$ 的等边三角形的局部单元矩阵。这样一个三角形的面积是 $A = \\frac{\\sqrt{3}}{4}\\ell^2$。对于线性形函数 $\\phi_i$，局部刚度矩阵 $K^e$ 和一致质量矩阵 $M^e$ 由标准公式给出：\n$$ K^e_{ij} = \\int_e \\nabla\\phi_i \\cdot \\nabla\\phi_j \\, \\mathrm{d}x, \\quad M^e_{ij} = \\int_e \\phi_i \\phi_j \\, \\mathrm{d}x $$\n对于一个等边三角形，这些矩阵是：\n$$ K^e = \\frac{1}{2\\sqrt{3}} \\begin{pmatrix} 2  -1  -1 \\\\ -1  2  -1 \\\\ -1  -1  2 \\end{pmatrix}, \\quad M^e = \\frac{A}{12} \\begin{pmatrix} 2  1  1 \\\\ 1  2  1 \\\\ 1  1  2 \\end{pmatrix} = \\frac{\\sqrt{3}\\ell^2}{48} \\begin{pmatrix} 2  1  1 \\\\ 1  2  1 \\\\ 1  1  2 \\end{pmatrix} $$\n环面的均匀三角剖分意味着每个节点在拓扑上都是相同的。每个节点是 $6$ 个全等等边三角形的顶点，并有 $6$ 个邻居。我们可以通过对共享一个节点的单元的贡献求和来确定全局矩阵 $K$ 和 $M$ 的模板（stencils）。让我们考虑一个节点 $i$。\n\n对角元素 $K_{ii}$ 是来自 $K^e$ 的 $6$ 个对角贡献之和：\n$K_{ii} = 6 \\times \\left(K^e\\right)_{\\text{diag}} = 6 \\times \\frac{2}{2\\sqrt{3}} = 2\\sqrt{3}$。\n对于一个邻居 $j$ 的非对角元素 $K_{ij}$ 是来自共享边 $(i, j)$ 的两个单元的 $2$ 个非对角贡献之和：\n$K_{ij} = 2 \\times \\left(K^e\\right)_{\\text{off-diag}} = 2 \\times \\left(-\\frac{1}{2\\sqrt{3}}\\right) = -\\frac{1}{\\sqrt{3}}$。\n\n质量矩阵 $M$ 也类似：\n$M_{ii} = 6 \\times \\frac{2A}{12} = A = \\frac{\\sqrt{3}}{4}\\ell^2$。\n$M_{ij} = 2 \\times \\frac{A}{12} = \\frac{A}{6} = \\frac{\\sqrt{3}}{24}\\ell^2$。\n\n由于网格的周期性和均匀性，$K$ 和 $M$ 的特征向量是离散平面波 $u_j = \\exp(i\\mathbf{k} \\cdot \\mathbf{x}_j)$，其中 $\\mathbf{x}_j$ 是节点 $j$ 的位置。相应的特征值（傅里叶符号）是波矢量 $\\mathbf{k}=(k_x, k_y)$ 的函数。\n设节点 $i$ 位于原点。其邻居位于位置 $\\mathbf{x}_1 = (\\ell, 0)$、$\\mathbf{x}_2 = (\\ell/2, \\ell\\sqrt{3}/2)$、$\\mathbf{x}_3 = (-\\ell/2, \\ell\\sqrt{3}/2)$ 及其相反位置。具有此模板结构的矩阵的特征值可以通过将其应用于特征向量来找到：\n$\\hat{K}(\\mathbf{k}) = K_{ii} + \\sum_{j \\in N(i)} K_{ij} e^{i\\mathbf{k}\\cdot\\mathbf{x}_j} = 2\\sqrt{3} - \\frac{1}{\\sqrt{3}} \\sum_{j=1}^6 e^{i\\mathbf{k}\\cdot\\mathbf{x}_j}$。\n该和的计算结果为 $\\sum_{j=1}^6 e^{i\\mathbf{k}\\cdot\\mathbf{x}_j} = 2\\cos(k_x \\ell) + 4\\cos(k_x \\ell / 2)\\cos(k_y \\ell \\sqrt{3} / 2)$。我们定义 $C(\\mathbf{k}) = \\cos(k_x \\ell) + 2\\cos(k_x \\ell/2)\\cos(k_y \\ell\\sqrt{3}/2)$。那么 $\\hat{K}(\\mathbf{k}) = 2\\sqrt{3} - \\frac{2}{\\sqrt{3}} C(\\mathbf{k}) = \\frac{2}{\\sqrt{3}}(3 - C(\\mathbf{k}))$。\n\n为了找到 $BK$ 的最大特征值，我们需要找到 $\\hat{B}(\\mathbf{k})\\hat{K}(\\mathbf{k})$ 在所有 $\\mathbf{k}$ 上的最大值。这需要找到 $C(\\mathbf{k})$ 的最小值。令 $\\alpha = k_x\\ell/2$ 和 $\\beta = k_y\\ell\\sqrt{3}/2$。则 $C(\\mathbf{k})$ 变为 $f(\\alpha, \\beta) = \\cos(2\\alpha) + 2\\cos(\\alpha)\\cos(\\beta) = 2\\cos^2(\\alpha) - 1 + 2\\cos(\\alpha)\\cos(\\beta)$。通过分析该函数，可以发现其最小值为 $-\\frac{3}{2}$。\n\n现在我们分析 $B$ 的两种情况。\n\n**情况1：集总质量 ($B = M_L^{-1}$)**\n集总质量矩阵 $M_L$ 是对角矩阵，其元素为 $(M_L)_{ii} = \\sum_j M_{ij}$。\n$(M_L)_{ii} = M_{ii} + 6 \\times M_{ij} = A + 6 \\times \\frac{A}{6} = 2A = \\frac{\\sqrt{3}}{2}\\ell^2$。\n因此，$M_L = \\frac{\\sqrt{3}}{2}\\ell^2 I$，其中 $I$ 是单位矩阵。\n于是，$B = M_L^{-1} = \\frac{2}{\\sqrt{3}\\ell^2} I$。该矩阵是单位矩阵的标量倍，所以其符号 $\\hat{B}$ 是一个常数。\n$BK$ 的特征值为 $\\lambda(\\mathbf{k}) = \\hat{B} \\hat{K}(\\mathbf{k}) = \\frac{2}{\\sqrt{3}\\ell^2} \\cdot \\frac{2}{\\sqrt{3}}(3 - C(\\mathbf{k})) = \\frac{4}{3\\ell^2}(3 - C(\\mathbf{k}))$。\n最大特征值 $\\lambda_{\\max}$ 在 $C(\\mathbf{k})$ 取最小值时出现，即 $C(\\mathbf{k}) = -3/2$。\n$\\lambda_{\\max}(M_L^{-1}K) = \\frac{4}{3\\ell^2}\\left(3 - \\left(-\\frac{3}{2}\\right)\\right) = \\frac{4}{3\\ell^2}\\left(\\frac{9}{2}\\right) = \\frac{6}{\\ell^2}$。\n集总质量情况下的最大稳定时间步长是：\n$\\Delta t_{\\max}^{\\mathrm{lump}} = \\frac{2}{\\lambda_{\\max}} = \\frac{2}{6/\\ell^2} = \\frac{\\ell^2}{3}$。\n\n**情况2：单次 Jacobi 迭代 ($B = D^{-1}$)**\n此处，$D = \\operatorname{diag}(M)$。对角元素为 $D_{ii} = M_{ii} = A = \\frac{\\sqrt{3}}{4}\\ell^2$。\n因此，$D = \\frac{\\sqrt{3}}{4}\\ell^2 I$。\n于是，$B = D^{-1} = \\frac{4}{\\sqrt{3}\\ell^2} I$。这同样是一个标量矩阵。\n$BK$ 的特征值为 $\\lambda(\\mathbf{k}) = \\hat{B} \\hat{K}(\\mathbf{k}) = \\frac{4}{\\sqrt{3}\\ell^2} \\cdot \\frac{2}{\\sqrt{3}}(3 - C(\\mathbf{k})) = \\frac{8}{3\\ell^2}(3 - C(\\mathbf{k}))$。\n最大特征值同样对应于 $C(\\mathbf{k})$ 的最小值：\n$\\lambda_{\\max}(D^{-1}K) = \\frac{8}{3\\ell^2}\\left(3 - \\left(-\\frac{3}{2}\\right)\\right) = \\frac{8}{3\\ell^2}\\left(\\frac{9}{2}\\right) = \\frac{12}{\\ell^2}$。\n单次 Jacobi 求逆情况下的最大稳定时间步长是：\n$\\Delta t_{\\max}^{\\mathrm{Jacobi}} = \\frac{2}{\\lambda_{\\max}} = \\frac{2}{12/\\ell^2} = \\frac{\\ell^2}{6}$。\n\n所求的两个值是 $\\Delta t_{\\max}^{\\mathrm{lump}} = \\frac{\\ell^2}{3}$ 和 $\\Delta t_{\\max}^{\\mathrm{Jacobi}} = \\frac{\\ell^2}{6}$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{\\ell^2}{3}  \\frac{\\ell^2}{6} \\end{pmatrix} } $$"
        },
        {
            "introduction": "本高级练习探讨了质量集中化一个更精妙的应用：在混合有限元方法中抑制伪数值模式。在某些有限元格式中，尤其是对不同物理场（如压力和速度）采用同阶插值时，可能会出现非物理的振荡解，即“伪模式”。通过分析一维声学问题中的“棋盘格”压力模式，您将研究压力质量矩阵的集中化如何影响这些伪模式的衰减率。这个练习展示了质量集中不仅是简化计算的技巧，更可以作为一种有效的数值稳定化工具。",
            "id": "3456088",
            "problem": "考虑一个周期性域上的一维线性声学系统，其一阶形式由以下耦合偏微分方程表示\n$$\n\\rho \\,\\frac{\\partial u}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0, \\qquad \\kappa^{-1}\\,\\frac{\\partial p}{\\partial t} + \\frac{\\partial u}{\\partial x} = 0,\n$$\n其中，$u$ 是速度，$p$ 是压力，$\\rho$ 是密度，$\\kappa$ 是体积模量。我们将分析在单位区间上具有周期性边界条件的均匀网格（包含 $N$ 个节点）上的稳定等阶混合离散化方法。未知量 $u$ 和 $p$ 均使用相同的连续分段线性基（等阶）进行离散化，并通过在压力方程中增加一个对称的类扩散项来稳定系统，从而得到半离散形式\n$$\nM_u \\,\\frac{d\\mathbf{u}}{dt} + G\\,\\mathbf{p} = \\mathbf{0}, \\qquad M_p \\,\\frac{d\\mathbf{p}}{dt} + D\\,\\mathbf{u} + \\eta\\,K\\,\\mathbf{p} = \\mathbf{0},\n$$\n其中 $\\mathbf{u}$ 和 $\\mathbf{p}$ 分别是 $u$ 和 $p$ 的系数向量，$M_u$ 和 $M_p$ 是速度和压力质量矩阵，$G$ 近似梯度算子，$D$ 近似散度算子，$K$ 是与双线性形式 $(\\nabla p,\\nabla q)$ 相关联的标准刚度矩阵，$\\eta \\ge 0$ 是稳定化参数。考虑两种版本的压力质量矩阵：通过精确的单元级积分获得的一致质量矩阵 $M_p$，以及通过对 $M_p$ 进行行和对角近似获得的集中压力质量矩阵 $M_\\ell$。\n\n从 Galerkin 方法的基础（弱形式、单元级积分）以及均匀周期网格上梯度和散度的标准中心差分表示出发，执行以下任务：\n\n1. 在具有 $N$ 个节点和均匀间距 $h = 1/N$ 的周期性网格上，通过中心差分构造作用于节点压力的离散梯度算子 $G$，即，\n$$\n(G\\mathbf{p})_i = \\frac{\\mathbf{p}_{i+1} - \\mathbf{p}_{i-1}}{2h},\n$$\n使用周期性索引。以相同方式构造散度算子 $D$。\n\n2. 在具有周期性边界条件的均匀网格上，使用标准的连续分段线性有限元，通过在每个单元上积分基函数的乘积，来组装一维一致压力质量矩阵 $M_p$。通过对 $M_p$ 进行对角行和集中，来组装相应的集中压力质量矩阵 $M_\\ell$。\n\n3. 在均匀周期网格上，使用标准的连续分段线性有限元，通过在每个单元上积分 $(\\partial_x \\phi_i)(\\partial_x \\phi_j)$，来组装压力的一维刚度矩阵 $K$。\n\n4. 对于节点索引 $i=0,1,\\dots,N-1$，定义棋盘格压力模式 $\\mathbf{p}^{\\mathrm{cb}}$ 为 $\\mathbf{p}^{\\mathrm{cb}}_i = (-1)^i$。通过计算离散量 $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2$ 并评估其是否在数值上为零，来证明在等阶配置的中心差分格式中，该模式与速度更新解耦。\n\n5. 对于由棋盘格模式解耦引起的稳定化纯压力子动力学，考虑以下线性常微分方程\n$$\nM \\,\\frac{d\\mathbf{p}}{dt} + \\eta \\,K\\,\\mathbf{p} = \\mathbf{0},\n$$\n其中 $M$ 为 $M_p$（一致）或 $M_\\ell$（集中）。对于棋盘格模式，通过瑞利商计算衰减率\n$$\n\\lambda(M) = \\eta\\,\\frac{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} K\\,\\mathbf{p}^{\\mathrm{cb}}}{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} M\\,\\mathbf{p}^{\\mathrm{cb}}}.\n$$\n以实数形式返回衰减率 $\\lambda(M_p)$ 和 $\\lambda(M_\\ell)$。\n\n您的程序必须实现上述组装和计算，并评估以下参数值测试套件：\n- 情况 1 (理想情况): $N=4$, $\\eta=1.0$。\n- 情况 2 (细化网格): $N=8$, $\\eta=1.0$。\n- 情况 3 (边界网格尺寸): $N=2$, $\\eta=1.0$。\n- 情况 4 (较弱稳定化): $N=8$, $\\eta=0.25$。\n\n对于每种情况，生成一个由以下三部分组成的结果三元组：\n- 一个布尔值，指示 $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2$ 是否小于阈值 $10^{-12}$（如果为真，则解释为解耦）。\n- 使用一致压力质量矩阵计算的衰减率 $\\lambda(M_p)$。\n- 使用集中压力质量矩阵计算的衰减率 $\\lambda(M_\\ell)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个由逗号分隔的四个三元组列表，每个三元组用方括号括起来，整个列表也用方括号括起来，不含任何额外文本。例如，一个有效的输出行格式如下\n$$\n[\\,[\\text{bool},\\text{float},\\text{float}],\\,[\\text{bool},\\text{float},\\text{float}],\\,[\\text{bool},\\text{float},\\text{float}],\\,[\\text{bool},\\text{float},\\text{float}]\\,].\n$$",
            "solution": "对问题的有效性进行分析。\n\n### 步骤 1：提取已知条件\n- **控制方程**：\n  $$\n  \\rho \\,\\frac{\\partial u}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0, \\qquad \\kappa^{-1}\\,\\frac{\\partial p}{\\partial t} + \\frac{\\partial u}{\\partial x} = 0\n  $$\n- **域**：具有周期性边界条件的一维单位区间。\n- **离散化**：速度 $u$ 和压力 $p$ 采用等阶连续分段线性基。均匀网格，包含 $N$ 个节点，间距为 $h = 1/N$。\n- **半离散形式**：\n  $$\n  M_u \\,\\frac{d\\mathbf{u}}{dt} + G\\,\\mathbf{p} = \\mathbf{0}, \\qquad M_p \\,\\frac{d\\mathbf{p}}{dt} + D\\,\\mathbf{u} + \\eta\\,K\\,\\mathbf{p} = \\mathbf{0}\n  $$\n- **矩阵/向量定义**：\n  - $\\mathbf{u}, \\mathbf{p}$：速度和压力的系数向量。\n  - $M_u, M_p$：速度和压力的一致质量矩阵。\n  - $M_\\ell$：通过对 $M_p$ 进行行和运算得到的集中压力质量矩阵。\n  - $G$：离散梯度算子，定义为 $(G\\mathbf{p})_i = \\frac{\\mathbf{p}_{i+1} - \\mathbf{p}_{i-1}}{2h}$，采用周期性索引。\n  - $D$：离散散度算子，构造方式与 $G$ 相同。\n  - $K$：由双线性形式 $(\\nabla p, \\nabla q)$ 得到的刚度矩阵。\n  - $\\eta \\ge 0$：稳定化参数。\n- **棋盘格模式**：$\\mathbf{p}^{\\mathrm{cb}}$ 定义为 $\\mathbf{p}^{\\mathrm{cb}}_i = (-1)^i$，其中 $i=0, \\dots, N-1$。\n- **衰减率**：\n  $$\n  \\lambda(M) = \\eta\\,\\frac{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} K\\,\\mathbf{p}^{\\mathrm{cb}}}{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} M\\,\\mathbf{p}^{\\mathrm{cb}}}\n  $$\n  其中 $M$ 为 $M_p$ 或 $M_\\ell$。\n- **任务**：\n  1. 构造 $G$ 和 $D$。\n  2. 组装 $M_p$ 和 $M_\\ell$。\n  3. 组装 $K$。\n  4. 计算 $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2$ 以检查解耦情况。\n  5. 计算衰减率 $\\lambda(M_p)$ 和 $\\lambda(M_\\ell)$。\n- **测试用例**：\n  - 情况 1: $N=4$, $\\eta=1.0$。\n  - 情况 2: $N=8$, $\\eta=1.0$。\n  - 情况 3: $N=2$, $\\eta=1.0$。\n  - 情况 4: $N=8$, $\\eta=0.25$。\n- **输出格式**：对于每种情况，一个三元组：$[\\text{解耦的布尔值}, \\lambda(M_p), \\lambda(M_\\ell)]$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了一种用于线性声学方程的标准稳定化混合有限元方法，这是计算物理和工程领域的一个基础课题。等阶单元、棋盘格模式、拉普拉斯稳定化（$\\eta K$）和质量集中的使用都是偏微分方程数值方法中的既定概念。该问题在科学上和数学上都是合理的。\n- **适定的**：这些任务是明确定义的数学运算（矩阵组装、范数计算、瑞利商计算）。输入（$N$, $\\eta$）已指定，所需的输出是明确的。每个任务都存在唯一、稳定且有意义的解。\n- **客观的**：问题以精确的数学语言陈述。没有主观或基于观点的陈述。\n- **无导致无效的缺陷**：\n  1. **科学/事实不成立**：无。所涉物理和数值方法均为标准内容。\n  2. **无法形式化/不相关**：问题是形式化的，并且与数值偏微分方程解的主题直接相关。\n  3. **不完整/矛盾的设置**：问题是自洽的。构造矩阵和执行计算所需的所有必要定义均已提供，或者是该领域的标准定义（例如，分段线性基函数）。周期性索引的定义阐明了边界条件。\n  4. **不切实际/不可行**：该设置为一个标准模型问题，而非对具有复杂约束的真实物理系统的模拟。所有计算都是可行的。\n  5. **不适定/结构不良**：任务定义明确。\n  6. **伪深刻/琐碎**：该问题要求对周期域上的有限元矩阵组装以及特定数值模式的行为有扎实的理解。虽然可以用标准技术解决，但它并非无足轻重，并且考验了核心概念。\n  7. **科学上无法验证**：所有结果在数学上都是可计算和可验证的。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解决方案。\n\n---\n\n解决方案需要在一个具有 $N$ 个节点 $\\{x_i\\}_{i=0}^{N-1}$ 和均匀间距 $h=1/N$ 的一维周期域上构造几个离散算子（矩阵）。由于周期性和均匀间距的特性，所有生成的矩阵都将是循环矩阵。循环矩阵完全由其第一行定义。\n\n**1. 离散梯度算子 ($G$)**\n离散梯度算子 $G$ 由中心差分公式 $(G\\mathbf{p})_i = (\\mathbf{p}_{i+1} - \\mathbf{p}_{i-1})/(2h)$ 指定。索引是周期性的，意味着 $\\mathbf{p}_{N} = \\mathbf{p}_0$ 和 $\\mathbf{p}_{-1} = \\mathbf{p}_{N-1}$。对于第 $i$ 行，矩阵 $G$ 在第 $i+1$ 列（模 $N$）有一个非零项 $1/(2h)$，在第 $i-1$ 列（模 $N$）有一个非零项 $-1/(2h)$。对应于 $i=0$ 的 $G$ 的第一行，将在第 $j=1$ 列和第 $j=-1 \\equiv N-1$ 列有值。因此，第一行向量为 $[0, 1/(2h), 0, \\dots, 0, -1/(2h)]$。这种结构定义了一个斜对称循环矩阵。由于散度算子 $D$ 要以相同的方式构造，它将具有相同的形式。在弱形式中，$D$ 通常是 $-G^\\top$，而由于 $G$ 是斜对称的（$G^\\top = -G$），这意味着 $D=G$。\n\n**2. 一致和集中压力质量矩阵 ($M_p$, $M_\\ell$)**\n一致质量矩阵 $M_p$ 的项为 $M_{p,ij} = \\int_0^1 \\phi_i(x) \\phi_j(x) dx$，其中 $\\phi_i(x)$ 是标准的分段线性“帽”状基函数。对于均匀的一维网格，在长度为 $h$ 的单元上的局部单元质量矩阵为 $\\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$。在周期性网格上组装这些贡献：\n- 对角线项 $M_{p,ii}$ 从其右侧单元接收 $\\frac{2h}{6}$，从其左侧单元接收 $\\frac{2h}{6}$，总计为 $\\frac{4h}{6}$。\n- 非对角线项 $M_{p,i,i+1}$ 从节点 $i$ 和 $i+1$ 共享的单个单元接收 $\\frac{h}{6}$。\n因此，对称循环矩阵 $M_p$ 的第一行为 $\\frac{h}{6}[4, 1, 0, \\dots, 0, 1]$。集中质量矩阵 $M_\\ell$ 是通过行和技术获得的：$M_{\\ell,ii} = \\sum_j M_{p,ij}$。对于任何行，其和为 $\\frac{h}{6}(1+4+1) = h$。因此，$M_\\ell$ 是一个对角矩阵，所有对角线项都等于 $h$，即 $M_\\ell = hI$。\n\n**3. 刚度矩阵 ($K$)**\n刚度矩阵 $K$ 的项为 $K_{ij} = \\int_0^1 \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} dx$。局部单元刚度矩阵为 $\\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。在周期性网格上组装：\n- 对角线项 $K_{ii}$ 从其右侧单元接收 $\\frac{1}{h}$，从其左侧单元接收 $\\frac{1}{h}$，总计为 $\\frac{2}{h}$。\n- 非对角线项 $K_{i,i+1}$ 从共享单元接收 $-\\frac{1}{h}$。\n因此，对称循环矩阵 $K$ 的第一行为 $\\frac{1}{h}[2, -1, 0, \\dots, 0, -1]$。\n\n**4. 棋盘格模式解耦**\n棋盘格模式为 $\\mathbf{p}^{\\mathrm{cb}}_i = (-1)^i$。我们测试它在 $G$ 作用下的效果：\n$$(G\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{1}{2h}(\\mathbf{p}^{\\mathrm{cb}}_{i+1} - \\mathbf{p}^{\\mathrm{cb}}_{i-1}) = \\frac{1}{2h}((-1)^{i+1} - (-1)^{i-1})$$\n由于 $(-1)^{i+1} = -(-1)^i$ 和 $(-1)^{i-1} = -(-1)^i$，这变为：\n$$(G\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{1}{2h}(-(-1)^i - (-(-1)^i)) = 0$$\n只要周期性索引是一致的，这对所有 $i$ 都成立，而对于任何偶数 $N$ 这都是成立的。由于所有测试用例的 $N$ 都是偶数，所以 $G\\mathbf{p}^{\\mathrm{cb}} = \\mathbf{0}$，意味着该模式在 $G$ 的零空间中。因此，$\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2 = 0$，该模式与速度方程完全解耦。\n\n**5. 衰减率计算**\n衰减率为 $\\lambda(M) = \\eta \\frac{(\\mathbf{p}^{\\mathrm{cb}})^\\top K \\mathbf{p}^{\\mathrm{cb}}}{(\\mathbf{p}^{\\mathrm{cb}})^\\top M \\mathbf{p}^{\\mathrm{cb}}}$。我们必须评估这个二次型。可以证明，对于偶数 $N$，$\\mathbf{p}^{\\mathrm{cb}}$ 是所有构造的循环矩阵 $K$ 和 $M_p$ 的一个特征向量。\n- 对于刚度矩阵 $K$：$(K\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{1}{h}(-p_{i-1} + 2p_i - p_{i+1}) = \\frac{1}{h}(-(-1)^{i-1} + 2(-1)^i - (-1)^{i+1}) = \\frac{1}{h}((-1)^i + 2(-1)^i + (-1)^i) = \\frac{4}{h}(-1)^i$。所以 $K\\mathbf{p}^{\\mathrm{cb}} = \\frac{4}{h}\\mathbf{p}^{\\mathrm{cb}}$。二次型为 $(\\mathbf{p}^{\\mathrm{cb}})^\\top K \\mathbf{p}^{\\mathrm{cb}} = \\frac{4}{h} \\|\\mathbf{p}^{\\mathrm{cb}}\\|_2^2 = \\frac{4}{h}N = 4N^2$。\n- 对于一致质量矩阵 $M_p$：$(M_p\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{h}{6}(p_{i-1} + 4p_i + p_{i+1}) = \\frac{h}{6}((-1)^{i-1} + 4(-1)^i + (-1)^{i+1}) = \\frac{h}{6}(-(-1)^i + 4(-1)^i - (-1)^i) = \\frac{2h}{6}(-1)^i = \\frac{h}{3}(-1)^i$。所以 $M_p\\mathbf{p}^{\\mathrm{cb}} = \\frac{h}{3}\\mathbf{p}^{\\mathrm{cb}}$。二次型为 $(\\mathbf{p}^{\\mathrm{cb}})^\\top M_p \\mathbf{p}^{\\mathrm{cb}} = \\frac{h}{3} \\|\\mathbf{p}^{\\mathrm{cb}}\\|_2^2 = \\frac{h}{3}N = \\frac{1}{3}$。\n- 对于集中质量矩阵 $M_\\ell = hI$：二次型为 $(\\mathbf{p}^{\\mathrm{cb}})^\\top (hI) \\mathbf{p}^{\\mathrm{cb}} = h \\|\\mathbf{p}^{\\mathrm{cb}}\\|_2^2 = hN=1$。\n\n解析衰减率为：\n$$ \\lambda(M_p) = \\eta \\frac{4N^2}{1/3} = 12 \\eta N^2 $$\n$$ \\lambda(M_\\ell) = \\eta \\frac{4N^2}{1} = 4 \\eta N^2 $$\n实现将以数值方式构造这些矩阵并计算这些量，以验证给定测试用例的理论。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef assemble_matrices(N):\n    \"\"\"\n    Assembles the discrete operators G, K, M_p, and M_l for a 1D periodic\n    domain with N nodes.\n    \"\"\"\n    if N % 2 != 0:\n        raise ValueError(\"N must be an even number for the checkerboard mode analysis.\")\n\n    h = 1.0 / N\n\n    # 1. Gradient operator G\n    # First row of circulant matrix for (p_{i+1} - p_{i-1})/(2h)\n    g_row = np.zeros(N)\n    if N > 2:\n        g_row[1] = 1.0 / (2.0 * h)\n        g_row[N - 1] = -1.0 / (2.0 * h)\n    # For N=2, (p_{i+1}-p_{i-1}) is (p_{i+1}-p_{i+1})=0, so G is the zero matrix.\n    G = linalg.circulant(g_row)\n\n    # 2. Stiffness matrix K\n    # First row of circulant matrix for (1/h) * (-p_{i-1} + 2*p_i - p_{i+1})\n    k_row = np.zeros(N)\n    k_row[0] = 2.0 / h\n    if N > 1:\n      # For N=2, i=0, j=1 and j=N-1=1 are the same neighbor\n      k_row[1] = -1.0 / h\n      if N > 2:\n        k_row[N - 1] = -1.0 / h\n      else: # N=2 needs the other contribution to k_row[1]\n        k_row[1] += -1.0 / h\n    K = linalg.circulant(k_row)\n\n    # 3. Consistent Mass matrix M_p\n    # First row of circulant matrix for (h/6) * (p_{i-1} + 4*p_i + p_{i+1})\n    mp_row = np.zeros(N)\n    mp_row[0] = 4.0 / 6.0\n    if N > 1:\n      # Similar to K, for N=2, neighbor i+1 and i-1 are the same node\n      mp_row[1] = 1.0 / 6.0\n      if N > 2:\n        mp_row[N-1] = 1.0 / 6.0\n      else: # N=2\n        mp_row[1] += 1.0/6.0\n        \n    M_p = h * linalg.circulant(mp_row)\n\n    # 4. Lumped Mass matrix M_l\n    # Row-sum lumping of M_p. For a uniform periodic grid, this is h*I.\n    M_l = np.diag(np.sum(M_p, axis=1))\n\n    return G, K, M_p, M_l\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and compute the required triplets.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (4, 1.0),   # Case 1: happy path\n        (8, 1.0),   # Case 2: refined grid\n        (2, 1.0),   # Case 3: boundary grid size\n        (8, 0.25),  # Case 4: weaker stabilization\n    ]\n\n    results = []\n    decoupling_threshold = 1e-12\n\n    for N, eta in test_cases:\n        # Assemble all required matrices for the given N\n        G, K, M_p, M_l = assemble_matrices(N)\n\n        # Define the checkerboard pressure mode\n        p_cb = np.array([(-1)**i for i in range(N)], dtype=float)\n\n        # Task 4: Check for checkerboard mode decoupling\n        Gp_cb = G @ p_cb\n        norm_Gp_cb = np.linalg.norm(Gp_cb)\n        is_decoupled = norm_Gp_cb  decoupling_threshold\n\n        # Task 5: Compute decay rates via Rayleigh quotient\n        # Numerator is common for both rates\n        p_cb_T_K_p_cb = p_cb.T @ K @ p_cb\n\n        # Denominator for consistent mass matrix\n        p_cb_T_Mp_p_cb = p_cb.T @ M_p @ p_cb\n        lambda_Mp = eta * p_cb_T_K_p_cb / p_cb_T_Mp_p_cb\n\n        # Denominator for lumped mass matrix\n        p_cb_T_Ml_p_cb = p_cb.T @ M_l @ p_cb\n        lambda_Ml = eta * p_cb_T_K_p_cb / p_cb_T_Ml_p_cb\n\n        # Store the results as a triplet\n        # Using np.bool_ to ensure the boolean serializes as 'True' or 'False'\n        # which Python's str() does by default for standard bools.\n        result_triplet = [is_decoupled, lambda_Mp, lambda_Ml]\n        results.append(result_triplet)\n\n    # Format the final output string as specified\n    formatted_results = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nsolve()\n```"
        }
    ]
}