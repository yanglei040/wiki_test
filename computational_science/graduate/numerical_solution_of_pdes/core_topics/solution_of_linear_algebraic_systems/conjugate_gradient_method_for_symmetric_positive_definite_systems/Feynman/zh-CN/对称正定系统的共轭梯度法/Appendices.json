{
    "hands_on_practices": [
        {
            "introduction": "要想真正掌握一个算法，就必须从第一性原理理解其推导过程。本练习将引导你直接从最小化二次能量函数的目标出发，推导共轭梯度法（CG）的核心公式——步长 $\\alpha_k$ 和残差更新。这个过程将加深你对CG作为一种优化方法的理解，并为后续更深入的分析打下坚实的理论基础。",
            "id": "3373168",
            "problem": "考虑线性系统 $A x = b$，该系统由区间 $(0,1)$ 上的一维泊松算子在齐次狄利克雷边界条件下使用中心有限差分格式离散化得到，其系数矩阵为一个对称正定（SPD）的刚度矩阵。令相关的二次泛函为 $J(x) = \\tfrac{1}{2} x^{\\mathsf{T}} A x - b^{\\mathsf{T}} x$。共轭梯度（CG）法（Conjugate Gradient (CG)）沿搜索方向 $\\{p_k\\}$ 生成迭代序列 $\\{x_k\\}$，其残差为 $r_k = b - A x_k$。\n\n从第 $k$ 次迭代时线搜索最小化的基本定义出发，即最小化 $J(x_k + \\alpha p_k)$（其中 $\\alpha \\in \\mathbb{R}$），并且只使用以下事实：$A$ 是对称正定的，$J$ 是可微的且其梯度为 $\\nabla J(x) = A x - b$，以及共轭梯度法搜索方向的标准正交性和 $A$-共轭性。请完成以下任务：\n\n1. 推导使 $J(x_k + \\alpha p_k)$ 最小化的步长 $\\alpha_k$ 的闭式表达式，将结果明确地用 $r_k$ 和 $p_k$ 表示，且不使用任何未从给定前提中推导出的结果。\n\n2. 仅使用残差的定义 $r_k = b - A x_k$，推导沿 $p_k$ 方向进行最小化步长更新后，新残差 $r_{k+1}$ 的显式表达式。\n\n然后，对于一个具体的 $4 \\times 4$ 对称正定系统：\n$$\nA \\;=\\; \\begin{pmatrix}\n2  -1  0  0 \\\\\n-1  2  -1  0 \\\\\n0  -1  2  -1 \\\\\n0  0  -1  2\n\\end{pmatrix},\n\\qquad\nb \\;=\\; \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix},\n$$\n其初始值为 $x_0 = 0$（因此 $r_0 = b$），并采用标准共轭梯度法的选择 $p_0 = r_0$。请根据你推导出的公式，计算步长 $\\alpha_0$ 的精确值。以精确形式（无四舍五入）提供最终数值，不带单位。",
            "solution": "我们从在对称正定（SPD）设定下最小化二次泛函的基本框架开始。二次泛函为 $J(x) = \\tfrac{1}{2} x^{\\mathsf{T}} A x - b^{\\mathsf{T}} x$，其中 $A$ 是对称正定的。其梯度为 $\\nabla J(x) = A x - b$。在共轭梯度（CG）法的第 $k$ 次迭代中，我们考虑直线 $x(\\alpha) = x_k + \\alpha p_k$ 并定义标量函数 $\\phi(\\alpha) = J(x_k + \\alpha p_k)$。我们寻求在 $\\alpha \\in \\mathbb{R}$ 上的最小化子。\n\n1. 推导步长 $\\alpha_k$：\n\n我们显式地计算 $\\phi(\\alpha)$：\n$$\n\\phi(\\alpha) \\;=\\; \\tfrac{1}{2} (x_k + \\alpha p_k)^{\\mathsf{T}} A (x_k + \\alpha p_k) \\;-\\; b^{\\mathsf{T}} (x_k + \\alpha p_k).\n$$\n对 $\\alpha$ 求导得到\n$$\n\\phi'(\\alpha) \\;=\\; p_k^{\\mathsf{T}} A (x_k + \\alpha p_k) \\;-\\; b^{\\mathsf{T}} p_k\n\\;=\\; p_k^{\\mathsf{T}} (A x_k - b) \\;+\\; \\alpha \\, p_k^{\\mathsf{T}} A p_k.\n$$\n使用残差定义 $r_k = b - A x_k$，我们有 $A x_k - b = - r_k$，因此\n$$\n\\phi'(\\alpha) \\;=\\; - p_k^{\\mathsf{T}} r_k \\;+\\; \\alpha \\, p_k^{\\mathsf{T}} A p_k.\n$$\n最小化步长 $\\alpha_k$ 满足一阶最优性条件 $\\phi'(\\alpha_k)=0$，所以\n$$\n- p_k^{\\mathsf{T}} r_k \\;+\\; \\alpha_k \\, p_k^{\\mathsf{T}} A p_k \\;=\\; 0,\n\\qquad\\Rightarrow\\qquad\n\\alpha_k \\;=\\; \\frac{p_k^{\\mathsf{T}} r_k}{p_k^{\\mathsf{T}} A p_k}.\n$$\n对于标准 CG 递推关系，搜索方向为 $p_k = r_k + \\beta_{k-1} p_{k-1}$，其中 $r_k$ 在欧几里得内积下与 $p_{k-1}$ 正交，这意味着\n$$\np_k^{\\mathsf{T}} r_k \\;=\\; (r_k + \\beta_{k-1} p_{k-1})^{\\mathsf{T}} r_k \\;=\\; r_k^{\\mathsf{T}} r_k \\;+\\; \\beta_{k-1} \\, p_{k-1}^{\\mathsf{T}} r_k \\;=\\; r_k^{\\mathsf{T}} r_k.\n$$\n因此，在标准 CG 法下，\n$$\n\\alpha_k \\;=\\; \\frac{r_k^{\\mathsf{T}} r_k}{p_k^{\\mathsf{T}} A p_k}.\n$$\n\n2. 推导残差更新 $r_{k+1}$：\n\n根据定义，\n$$\nr_{k+1} \\;=\\; b - A x_{k+1} \\;=\\; b - A(x_k + \\alpha_k p_k) \\;=\\; (b - A x_k) \\;-\\; \\alpha_k A p_k \\;=\\; r_k \\;-\\; \\alpha_k A p_k.\n$$\n这就将更新后的残差直接用当前残差、步长以及矩阵与方向向量的乘积表示出来。\n\n3. 对给定系统的具体计算：\n\n给定\n$$\nA \\;=\\; \\begin{pmatrix}\n2  -1  0  0 \\\\\n-1  2  -1  0 \\\\\n0  -1  2  -1 \\\\\n0  0  -1  2\n\\end{pmatrix},\n\\qquad\nb \\;=\\; \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix},\n\\qquad\nx_0 \\;=\\; \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n因此 $r_0 = b - A x_0 = b$，并且根据标准 CG 初始化，$p_0 = r_0 = b$。使用推导出的公式，\n$$\n\\alpha_0 \\;=\\; \\frac{r_0^{\\mathsf{T}} r_0}{p_0^{\\mathsf{T}} A p_0}\n\\;=\\; \\frac{b^{\\mathsf{T}} b}{b^{\\mathsf{T}} A b}.\n$$\n计算 $b^{\\mathsf{T}} b$：\n$$\nb^{\\mathsf{T}} b \\;=\\; 1^2 + 0^2 + 0^2 + 1^2 \\;=\\; 2.\n$$\n计算 $A b$：\n$$\nA b \\;=\\; \\begin{pmatrix}\n2  -1  0  0 \\\\\n-1  2  -1  0 \\\\\n0  -1  2  -1 \\\\\n0  0  -1  2\n\\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n2 \\cdot 1 + (-1) \\cdot 0 + 0 \\cdot 0 + 0 \\cdot 1 \\\\\n-1 \\cdot 1 + 2 \\cdot 0 + (-1) \\cdot 0 + 0 \\cdot 1 \\\\\n0 \\cdot 1 + (-1) \\cdot 0 + 2 \\cdot 0 + (-1) \\cdot 1 \\\\\n0 \\cdot 1 + 0 \\cdot 0 + (-1) \\cdot 0 + 2 \\cdot 1\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\\\ 2 \\end{pmatrix}.\n$$\n那么\n$$\nb^{\\mathsf{T}} A b \\;=\\; \\begin{pmatrix} 1  0  0  1 \\end{pmatrix}\n\\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\\\ 2 \\end{pmatrix}\n\\;=\\; 2 + 0 + 0 + 2 \\;=\\; 4.\n$$\n因此\n$$\n\\alpha_0 \\;=\\; \\frac{2}{4} \\;=\\; \\frac{1}{2}.\n$$\n这个值是精确的，所以不需要四舍五入。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "共轭梯度法的理论收敛速度与矩阵的条件数 $\\kappa$ 密切相关。这个动手编程练习为你提供了一个直接见证这种关系的机会。通过构建一个具有特定特征值分布的矩阵，你将比较实际观测到的迭代次数与著名的理论上界，从而对条件数如何影响算法性能获得一个实践性的直观感受。",
            "id": "3373133",
            "problem": "您需要设计并实现一个程序，使用共轭梯度法求解由一个特意构造的、具有几何分布谱的对角矩阵产生的对称正定线性系统。其目标是经验性地说明与标准能量范数误差界一致的缓慢收敛行为，并量化达到预定误差缩减所需的迭代次数。\n\n构造一个对角对称正定矩阵 $A \\in \\mathbb{R}^{n \\times n}$，其特征值从 $\\lambda_{\\min}$ 到 $\\lambda_{\\max}$ 按等比数列分布，条件数为 $\\kappa = \\lambda_{\\max}/\\lambda_{\\min}$。具体地，设\n$$\n\\lambda_i = \\lambda_{\\min} \\, q^{\\,i-1}, \\quad i = 1,2,\\dots,n, \\quad q = \\left(\\frac{\\lambda_{\\max}}{\\lambda_{\\min}}\\right)^{\\frac{1}{n-1}},\n$$\n并取 $A = \\mathrm{diag}(\\lambda_1, \\lambda_2, \\dots, \\lambda_n)$。设右端项为 $b = A x^\\star$，其中 $x^\\star$ 是 $\\mathbb{R}^n$ 中全为1的向量，并将共轭梯度法的初始值设为 $x_0 = 0$。设误差为 $e_k = x_k - x^\\star$，并将其能量范数缩减因子定义为\n$$\n\\rho_k = \\frac{\\|e_k\\|_A}{\\|e_0\\|_A}, \\quad \\text{其中 } \\|y\\|_A = \\sqrt{y^\\top A y}.\n$$\n\n您的任务是：\n- 为指定的 $A$ 和 $b$ 实现共轭梯度算法，当 $\\rho_k \\le r$（其中 $r \\in (0,1)$ 是一个预设的缩减目标）或迭代次数达到 $n$ 时停止。\n- 从对称正定系统上共轭梯度法的标准能量范数误差界的第一性原理推导中，根据条件数 $\\kappa$ 和目标缩减率 $r$ 推导出一个充分的迭代次数 $k_{\\mathrm{bound}}$，使得该界能保证 $\\rho_{k_{\\mathrm{bound}}} \\le r$。\n- 对于每个测试用例，计算并报告达到 $\\rho_k \\le r$ 所需的观测迭代次数 $k_{\\mathrm{obs}}$，以及从理论界推导出的充分迭代次数 $k_{\\mathrm{bound}}$。\n\n使用以下参数集 $(n,\\kappa,r)$ 的测试套件：\n1. $(n,\\kappa,r) = (512, 10^4, 10^{-3})$ 作为具有显著条件数和中等缩减目标的通用情况。\n2. $(n,\\kappa,r) = (64, 1.2, 10^{-6})$ 作为一个应能快速收敛的近似单位阵情况。\n3. $(n,\\kappa,r) = (2048, 10^6, 10^{-2})$ 作为一个极端条件数情况，用以说明非常缓慢的收敛以及当 $k_{\\mathrm{bound}}$ 超过 $n$ 时理论界的悲观性。\n4. $(n,\\kappa,r) = (1024, 500, 10^{-4})$ 作为一个中等病态条件的情况。\n\n本问题中所有量均为无量纲，不涉及物理单位。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含每个测试用例的数对 $(k_{\\mathrm{obs}}, k_{\\mathrm{bound}})$，并展开为两个连续的整数。因此，最终的输出格式为\n$$\n[ k_{\\mathrm{obs}}^{(1)}, k_{\\mathrm{bound}}^{(1)}, k_{\\mathrm{obs}}^{(2)}, k_{\\mathrm{bound}}^{(2)}, k_{\\mathrm{obs}}^{(3)}, k_{\\mathrm{bound}}^{(3)}, k_{\\mathrm{obs}}^{(4)}, k_{\\mathrm{bound}}^{(4)} ].\n$$\n不应打印任何其他文本。程序必须是自包含的，并且不需要用户输入。",
            "solution": "经评估，此问题是有效的。它在科学上基于数值线性代数的成熟理论，特别是共轭梯度法的分析。该问题是适定的，所有参数、定义和目标都以清晰、明确的语言进行了规定。它呈现了一个标准的数值实验，旨在说明理论收敛特性，这是该领域中一个常见且有意义的练习。\n\n解决方案分三部分展开：首先，推导理论迭代界限 $k_{\\mathrm{bound}}$；其次，详细说明数值实验，包括共轭梯度算法及其实际停止准则的评估；最后，为给定的测试用例实现完整的程序。\n\n### 1. 理论迭代界限的推导\n\n应用于对称正定（SPD）线性系统 $Ax = b$ 的共轭梯度（CG）方法的标准能量范数误差界为：\n$$\n\\frac{\\|e_k\\|_A}{\\|e_0\\|_A} \\le 2 \\left( \\frac{\\sqrt{\\kappa}-1}{\\sqrt{\\kappa}+1} \\right)^k\n$$\n这里，$e_k = x_k - x^\\star$ 是第 $k$ 次迭代时的误差，$x^\\star$ 是精确解，$\\|y\\|_A = \\sqrt{y^\\top A y}$ 是 A-范数或能量范数，$\\kappa = \\lambda_{\\max}/\\lambda_{\\min}$ 是矩阵 $A$ 的谱条件数。问题将误差缩减因子定义为 $\\rho_k = \\|e_k\\|_A / \\|e_0\\|_A$。\n\n我们的任务是找到一个充分的迭代次数 $k_{\\mathrm{bound}}$，它能保证误差缩减至少为 $r$，即 $\\rho_{k_{\\mathrm{bound}}} \\le r$。该次数是满足基于该界的不等式的最小整数 $k$：\n$$\n2 \\left( \\frac{\\sqrt{\\kappa}-1}{\\sqrt{\\kappa}+1} \\right)^k \\le r\n$$\n为了解出 $k$，我们首先整理不等式：\n$$\n\\left( \\frac{\\sqrt{\\kappa}-1}{\\sqrt{\\kappa}+1} \\right)^k \\le \\frac{r}{2}\n$$\n对两边取自然对数。由于 $\\kappa > 1$，幂的底数 $(\\sqrt{\\kappa}-1)/(\\sqrt{\\kappa}+1)$ 介于 $0$ 和 $1$ 之间，因此其对数为负。因此，在除以它时必须反转不等号：\n$$\nk \\ln\\left( \\frac{\\sqrt{\\kappa}-1}{\\sqrt{\\kappa}+1} \\right) \\le \\ln\\left( \\frac{r}{2} \\right)\n$$\n$$\nk \\ge \\frac{\\ln(r/2)}{\\ln\\left( \\frac{\\sqrt{\\kappa}-1}{\\sqrt{\\kappa}+1} \\right)}\n$$\n使用恒等式 $\\ln(1/x) = -\\ln(x)$，我们可以将其写成一个分子和分母均为正的更方便的形式：\n$$\nk \\ge \\frac{\\ln(2/r)}{\\ln\\left( \\frac{\\sqrt{\\kappa}+1}{\\sqrt{\\kappa}-1} \\right)}\n$$\n满足此条件的最小整数 $k$ 是其向上取整。因此，迭代次数的理论界限为：\n$$\nk_{\\mathrm{bound}} = \\left\\lceil \\frac{\\ln(2/r)}{\\ln\\left( \\frac{\\sqrt{\\kappa}+1}{\\sqrt{\\kappa}-1} \\right)} \\right\\rceil\n$$\n此公式将用于计算每个测试用例的 $k_{\\mathrm{bound}}$。注意，如果 $\\kappa = 1$，分母未定义。在这种情况下，CG 在一次迭代中收敛，因此 $k_{\\mathrm{bound}}=1$。当 $\\kappa \\to 1^+$ 时，该表达式的极限为 $0$，其向上取整为 $1$，与此事实一致。\n\n### 2. 数值实验设计\n\n该实验要求实现 CG 算法，并将其应用于一个特定构造的 SPD 系统。\n\n**矩阵和向量的构造：**\n矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 是对角的，其特征值由一个等比数列给出。设 $\\lambda_{\\min} = 1$。这一选择不影响条件数 $\\kappa$，因此也不影响与之相关的收敛行为。因此，$\\lambda_{\\max} = \\kappa$。特征值为：\n$$\n\\lambda_i = 1 \\cdot q^{i-1}, \\quad i=1, \\dots, n, \\quad \\text{where } q = \\kappa^{\\frac{1}{n-1}}\n$$\n因此，$A = \\mathrm{diag}(\\lambda_1, \\dots, \\lambda_n)$。精确解是 $x^\\star$，即全为1的向量。右端向量 $b$ 则是 $b = Ax^\\star$，这意味着对每个 $i$ 都有 $b_i = \\lambda_i$。\n\n**共轭梯度算法：**\n给定系统 $Ax=b$，一个初始猜测 $x_0$，最大迭代次数 $n$，以及一个容差 $r$：\n1.  初始化：\n    $k = 0$\n    $x_0 = 0$ (零向量)\n    $r_0 = b - Ax_0 = b$\n    $p_0 = r_0$\n    $\\delta_0 = r_0^\\top r_0$\n2.  对 $k = 0, 1, 2, \\dots, n-1$ 进行迭代：\n    a. 计算 $Ap_k$。由于 $A$ 是对角矩阵，这是一个逐元素相乘的操作。\n    b. $\\alpha_k = \\frac{\\delta_k}{p_k^\\top A p_k}$\n    c. $x_{k+1} = x_k + \\alpha_k p_k$\n    d. $r_{k+1} = r_k - \\alpha_k A p_k$\n    e. 检查 $x_{k+1}$ 的停止准则。如果满足，则设 $k_{\\mathrm{obs}} = k+1$ 并终止。\n    f. $\\delta_{k+1} = r_{k+1}^\\top r_{k+1}$\n    g. $\\beta_k = \\frac{\\delta_{k+1}}{\\delta_k}$\n    h. $p_{k+1} = r_{k+1} + \\beta_k p_k$\n    i. $\\delta_k \\leftarrow \\delta_{k+1}$\n3.  如果循环完成，则设 $k_{\\mathrm{obs}} = n$。\n\n**停止准则的评估：**\n停止准则为 $\\rho_k = \\|e_k\\|_A / \\|e_0\\|_A \\le r$。直接计算 $e_k = x_k-x^\\star$ 是可能的，但在 CG 循环内部并不常用。一种更标准且计算上更优雅的方法是利用误差 $e_k$ 和残差 $r_k$ 之间的关系：\n$$\nr_k = b - Ax_k = Ax^\\star - Ax_k = A(x^\\star - x_k) = -Ae_k \\implies e_k = -A^{-1}r_k\n$$\n将此代入能量范数的定义中：\n$$\n\\|e_k\\|_A^2 = e_k^\\top A e_k = (-A^{-1}r_k)^\\top A (-A^{-1}r_k) = r_k^\\top (A^{-1})^\\top A A^{-1} r_k\n$$\n由于 $A$ 是 SPD 矩阵，$(A^{-1})^\\top = A^{-1}$。这可以简化为：\n$$\n\\|e_k\\|_A^2 = r_k^\\top A^{-1} r_k = \\|r_k\\|_{A^{-1}}^2\n$$\n对于对角矩阵 $A=\\mathrm{diag}(\\lambda_i)$，$A^{-1}=\\mathrm{diag}(1/\\lambda_i)$，所以 $\\|e_k\\|_A^2 = \\sum_{i=1}^n (r_k)_i^2 / \\lambda_i$。\n\n初始误差为 $e_0 = x_0 - x^\\star = -x^\\star$ (因为 $x_0=0$)。初始能量范数的平方为：\n$$\n\\|e_0\\|_A^2 = (-x^\\star)^\\top A (-x^\\star) = (x^\\star)^\\top A x^\\star = \\mathbf{1}^\\top A \\mathbf{1} = \\sum_{i=1}^n \\lambda_i\n$$\n因此，在第 $k+1$ 次迭代时的停止准则是通过计算以下表达式来检查的：\n$$\n\\rho_{k+1} = \\sqrt{\\frac{\\sum_{i=1}^n (r_{k+1})_i^2 / \\lambda_i}{\\sum_{i=1}^n \\lambda_i}} \\le r\n$$\n在每一步计算此表达式以确定 $k_{\\mathrm{obs}}$。\n\n### 3. 实现\n最终的实现将把这些推导封装到一个 Python 脚本中，使用 `numpy` 库进行数值计算。一个函数将处理每个测试用例 $(n, \\kappa, r)$，首先计算 $k_{\\mathrm{bound}}$，然后设置并运行 CG 算法以找到 $k_{\\mathrm{obs}}$，最后收集结果以进行格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases, calculating k_obs and k_bound.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (512, 1e4, 1e-3),   # (n, kappa, r)\n        (64, 1.2, 1e-6),\n        (2048, 1e6, 1e-2),\n        (1024, 500, 1e-4),\n    ]\n\n    results = []\n    for n, kappa, r in test_cases:\n        # --- Task: Calculate theoretical iteration bound k_bound ---\n        if kappa == 1.0:\n            k_bound = 1\n        else:\n            sqrt_kappa = np.sqrt(kappa)\n            # Bound formula: ceil( log(2/r) / log((sqrt(k)+1)/(sqrt(k)-1)) )\n            numerator = np.log(2.0 / r)\n            denominator = np.log((sqrt_kappa + 1.0) / (sqrt_kappa - 1.0))\n            k_bound = int(np.ceil(numerator / denominator))\n        \n        # --- Task: Implement Conjugate Gradient to find k_obs ---\n\n        # 1. Construct the matrix A (as a vector of eigenvalues) and vector b\n        if n == 1:\n            lambdas = np.array([1.0])\n        else:\n            # Set lambda_min = 1.0, so lambda_max = kappa\n            q = kappa**(1.0 / (n - 1.0))\n            # Eigenvalues: lambda_i = q^(i-1) for i=1,...,n\n            indices = np.arange(n, dtype=np.float64)\n            lambdas = q**indices\n        \n        # b = A * x_star, where x_star is all ones. For diagonal A, b_i = lambda_i.\n        b = lambdas\n\n        # 2. Initialize CG algorithm\n        x = np.zeros(n, dtype=np.float64)\n        residual = b.copy()  # r_0 = b - A*x_0 = b\n        direction = residual.copy()  # p_0 = r_0\n        rs_old_sq = residual @ residual\n\n        # 3. Calculate initial energy norm for stopping criterion\n        # ||e_0||_A^2 = x_star^T * A * x_star = 1^T * A * 1 = sum(diag(A)) = sum(lambdas)\n        e0_A_sq = np.sum(lambdas)\n        \n        k_obs = n  # Default if convergence is not met within n iterations\n        for k_iter in range(n):\n            # A is diagonal, so A*p is an element-wise product\n            A_p = lambdas * direction\n            \n            alpha = rs_old_sq / (direction @ A_p)\n            \n            x += alpha * direction\n            residual -= alpha * A_p\n            \n            # Check stopping criterion: rho_k = ||e_k||_A / ||e_0||_A = r\n            # ||e_k||_A^2 = r_k^T * A^-1 * r_k = sum(r_k[i]^2 / lambda[i])\n            ek_A_sq = np.sum(residual**2 / lambdas)\n            rho_k = np.sqrt(ek_A_sq / e0_A_sq)\n\n            if rho_k = r:\n                k_obs = k_iter + 1\n                break\n\n            # Update for next iteration\n            rs_new_sq = residual @ residual\n            beta = rs_new_sq / rs_old_sq\n            direction = residual + beta * direction\n            rs_old_sq = rs_new_sq\n\n        results.extend([k_obs, k_bound])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际应用中，尤其是在求解偏微分方程（PDEs）时，知道何时停止迭代求解器至关重要。这个思维练习将挑战你超越简单的残差减小，思考哪种停止准则对于控制解的物理误差真正有意义。它突出了抽象的线性代数与底层科学问题之间的关键联系，这是将数值方法成功应用于实际问题的核心。",
            "id": "3373126",
            "problem": "考虑一个线性系统 $A x^\\ast = b$，该系统源于在一个有界利普希茨域上，对带有齐次狄利克雷边界条件的二阶、标量、线性椭圆偏微分方程 (PDE) 进行相容有限元法 (FEM) 离散化。刚度矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 是对称正定的 (SPD)。应用共轭梯度 (CG) 法（及其预处理变体）来计算迭代解 $x_k$。定义代数误差 $e_k = x_k - x^\\ast$ 和残差 $r_k = b - A x_k$。设 $M$ 是用于预处理共轭梯度 (PCG) 法的 SPD 预处理器，并假设 $M$ 与 $A$ 谱等价，即存在独立于网格的正常数 $\\alpha$ 和 $\\beta$，使得 $\\alpha\\, A \\preceq M \\preceq \\beta\\, A$，其中 $\\preceq$ 表示 SPD 矩阵上的 Loewner 偏序。\n\n对于 PDE 误差控制，一个具有物理意义的范数是由 $A$ 诱导的能量范数，定义为 $\\|v\\|_A = \\sqrt{v^\\top A v}$。在椭圆问题的相容 FEM 离散化中，$\\|v\\|_A$ 与误差的连续 $H^1$-半范数等价（在相差独立于网格的常数的意义下）。通常考虑三种实用的停止准则：\n\n$1.$ 当 $\\|r_k\\|_2/\\|b\\|_2 \\le \\tau$ 时停止，其中 $\\tau > 0$ 是选定的容差。\n\n$2.$ 当 $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$ 时停止，其中 $\\|v\\|_{M^{-1}} = \\sqrt{v^\\top M^{-1} v}$。\n\n$3.$ 当相对能量范数误差的后验估计满足 $\\|e_k\\|_A/\\|x^\\ast\\|_A \\le \\tau$ 时停止。\n\n仅使用给定的假设以及 SPD 线性代数和基于 FEM 的 PDE 离散化的基本原理，评估以下关于这些停止准则对 PDE 误差控制和独立于网格的容差选择的适用性的陈述。选择所有正确的陈述。\n\nA. 准则 $\\|r_k\\|_2/\\|b\\|_2 \\le \\tau$ 是独立于网格的，并且直接控制能量范数误差 $\\|e_k\\|_A$；因此它对于 PDE 误差控制最有意义。\n\nB. 如果 $M$ 与 $A$ 谱等价且谱等价常数独立于网格，那么强制 $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$ 可以在相差独立于网格的固定常数的意义下控制相对能量范数误差，使其成为 PDE 误差控制的一个实用替代指标。\n\nC. $\\|e_k\\|_A/\\|x^\\ast\\|_A$ 的后验估计是概念上最有意义的停止准则，因为对于椭圆问题，$A$-范数（在等价常数的意义下）与物理能量范数一致；然而，这样的估计器需要超出原始残差范数的额外计算。\n\nD. 所有三个准则是等价的，无论条件数、离散化或预处理如何；因此它们中任何一个都同样适用于 PDE 误差控制。\n\nE. 准则 $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$ 仅在 $M = A$ 精确成立时有意义；否则它无法与能量范数误差关联起来。",
            "solution": "用户提供了一个关于求解源于椭圆偏微分方程的有限元法(FEM)离散化的线性系统的共轭梯度(CG)法停止准则的问题陈述。我将首先验证该问题陈述，然后进行详细解答。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   线性系统: $A x^\\ast = b$。\n-   矩阵 $A$: $A \\in \\mathbb{R}^{n \\times n}$ 是对称正定 (SPD) 的。\n-   背景: $A$ 和 $b$ 源于在一个有界利普希茨域上，对带有齐次狄利克雷边界条件的二阶、标量、线性椭圆偏微分方程 (PDE) 进行相容有限元法 (FEM) 离散化。\n-   算法: 共轭梯度 (CG) 法或预处理共轭梯度 (PCG) 法计算迭代解 $x_k$。\n-   误差与残差: 代数误差 $e_k = x_k - x^\\ast$；残差 $r_k = b - A x_k$。\n-   预处理器: $M$ 是一个 SPD 矩阵。\n-   谱等价：存在独立于网格的正常数 $\\alpha$ 和 $\\beta$ 使得 $\\alpha\\, A \\preceq M \\preceq \\beta\\, A$，其中 $\\preceq$ 是 SPD 矩阵上的 Loewner 偏序。\n-   能量范数: $\\|v\\|_A = \\sqrt{v^\\top A v}$。\n-   FEM 等价性质: $\\|v\\|_A$ 与误差的连续 $H^1$-半范数等价（在相差独立于网格的常数的意义下）。\n-   待评估的停止准则:\n    1.  $\\|r_k\\|_2/\\|b\\|_2 \\le \\tau$，其中容差 $\\tau > 0$。\n    2.  $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$，其中 $\\|v\\|_{M^{-1}} = \\sqrt{v^\\top M^{-1} v}$。\n    3.  $\\|e_k\\|_A/\\|x^\\ast\\|_A \\le \\tau$ 的后验估计。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学上合理:** 该问题牢固地植根于偏微分方程数值分析的标准理论，特别是有限元法和迭代线性代数。所有概念——SPD 矩阵、CG 法、预处理、谱等价、能量范数及其与索博列夫空间范数 ($H^1$) 的联系——都是完善且陈述正确的。\n-   **适定的:** 问题要求基于所提供的理论框架对几个陈述进行评估。它的定义清晰，并允许进行决定性的逻辑和数学分析。\n-   **客观的:** 语言是技术性的、精确的，并且没有主观或模糊的术语。\n\n问题陈述没有科学缺陷、矛盾或歧义。它提出了一个数值分析中标准的、适定的问题。\n\n**步骤3：结论与行动**\n该问题是有效的。我现在将进行推导和对选项的评估。\n\n### 解答推导\n\n主要目标是控制能量范数中的相对误差 $\\frac{\\|e_k\\|_A}{\\|x^\\ast\\|_A}$，因为该量等价于底层 PDE 的自然能量范数中的相对误差。我们将分析每个停止准则如何与这个目标量相关联。\n\n首先，让我们建立误差 $e_k$ 和残差 $r_k$ 之间的基本关系。\n根据定义，$r_k = b - A x_k$。由于 $b = A x^\\ast$，我们有：\n$$r_k = A x^\\ast - A x_k = A (x^\\ast - x_k) = -A e_k$$\n这意味着 $e_k = -A^{-1} r_k$。\n\n利用这一点，我们可以用残差来表示误差的能量范数：\n$$\\|e_k\\|_A^2 = e_k^\\top A e_k = (-A^{-1} r_k)^\\top A (-A^{-1} r_k) = r_k^\\top (A^{-1})^\\top A A^{-1} r_k$$\n由于 $A$ 是对称的，$A^{-1}$ 也是对称的，所以 $(A^{-1})^\\top = A^{-1}$。因此：\n$$\\|e_k\\|_A^2 = r_k^\\top A^{-1} A A^{-1} r_k = r_k^\\top A^{-1} r_k = \\|r_k\\|_{A^{-1}}^2$$\n因此，误差的能量范数精确地等于残差的 $A^{-1}$-范数：\n$$\\|e_k\\|_A = \\|r_k\\|_{A^{-1}}$$\n这个恒等式是分析的核心。\n\n现在，我们分析每个停止准则。\n\n**A. 准则 $\\|r_k\\|_2/\\|b\\|_2 \\le \\tau$ 是独立于网格的，并且直接控制能量范数误差 $\\|e_k\\|_A$；因此它对于 PDE 误差控制最有意义。**\n\n为了评估这一点，我们必须将欧几里得范数 $\\|r_k\\|_2$ 与能量范数 $\\|e_k\\|_A = \\|r_k\\|_{A^{-1}}$ 联系起来。这两个范数之间的关系由矩阵 $A^{-1}$ 的特征值决定。设 $\\lambda_{\\min}(A)$ 和 $\\lambda_{\\max}(A)$ 是 $A$ 的最小和最大特征值。$A^{-1}$ 的特征值是 $1/\\lambda_{\\max}(A)$ 和 $1/\\lambda_{\\min}(A)$。\n根据瑞利-里兹定理，对于任何向量 $v \\in \\mathbb{R}^n$：\n$$\\lambda_{\\min}(A^{-1}) \\|v\\|_2^2 \\le \\|v\\|_{A^{-1}}^2 \\le \\lambda_{\\max}(A^{-1}) \\|v\\|_2^2$$\n代入 $v=r_k$ 和 $A^{-1}$ 的特征值：\n$$\\frac{1}{\\lambda_{\\max}(A)} \\|r_k\\|_2^2 \\le \\|r_k\\|_{A^{-1}}^2 \\le \\frac{1}{\\lambda_{\\min}(A)} \\|r_k\\|_2^2$$\n取平方根并使用 $\\|e_k\\|_A = \\|r_k\\|_{A^{-1}}$：\n$$\\frac{1}{\\sqrt{\\lambda_{\\max}(A)}} \\|r_k\\|_2 \\le \\|e_k\\|_A \\le \\frac{1}{\\sqrt{\\lambda_{\\min}(A)}} \\|r_k\\|_2$$\n对于典型的二阶椭圆 PDE 的 FEM 离散化，当网格尺寸 $h$ 趋于零时，$\\lambda_{\\min}(A)$ 由一个正常数从下方界定，但 $\\lambda_{\\max}(A)$ 会增长，通常为 $O(h^{-2})$。这意味着条件数 $\\kappa(A) = \\lambda_{\\max}(A)/\\lambda_{\\min}(A)$ 随网格细化而增长。因此，关联 $\\|r_k\\|_2$ 和 $\\|e_k\\|_A$ 的因子是依赖于网格的。一个小的相对残差 $\\|r_k\\|_2/\\|b\\|_2 \\le \\tau$ 不能以独立于网格的方式保证一个小的相对能量误差。对于细网格（即大的 $\\lambda_{\\max}(A)$），即使残差的欧几里得范数很小，能量误差也可能很大。因此，该陈述是错误的。\n\n结论：**错误**。\n\n**B. 如果 $M$ 与 $A$ 谱等价且谱等价常数独立于网格，那么强制 $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$ 可以在相差独立于网格的固定常数的意义下控制相对能量范数误差，使其成为 PDE 误差控制的一个实用替代指标。**\n\n假设是存在独立于网格的正常数 $\\alpha$ 和 $\\beta$ 使得 $\\alpha A \\preceq M \\preceq \\beta A$。这等价于陈述对于任何非零向量 $v$，有 $\\alpha v^\\top A v \\le v^\\top M v \\le \\beta v^\\top A v$。通过取逆（这会反转 Loewner 序），我们得到 $\\beta^{-1} A^{-1} \\preceq M^{-1} \\preceq \\alpha^{-1} A^{-1}$。让我们为 $A^{-1}$ 重新整理：\n$$\\alpha M^{-1} \\preceq A^{-1} \\preceq \\beta M^{-1}$$\n这意味着对于任何向量 $v$，有 $\\alpha v^\\top M^{-1} v \\le v^\\top A^{-1} v \\le \\beta v^\\top M^{-1} v$，这可以转化为：\n$$\\alpha \\|v\\|_{M^{-1}}^2 \\le \\|v\\|_{A^{-1}}^2 \\le \\beta \\|v\\|_{M^{-1}}^2$$\n设 $v = r_k$ 并回顾 $\\|e_k\\|_A = \\|r_k\\|_{A^{-1}}$：\n$$\\alpha \\|r_k\\|_{M^{-1}}^2 \\le \\|e_k\\|_A^2 \\le \\beta \\|r_k\\|_{M^{-1}}^2$$\n$$\\sqrt{\\alpha} \\|r_k\\|_{M^{-1}} \\le \\|e_k\\|_A \\le \\sqrt{\\beta} \\|r_k\\|_{M^{-1}}$$\n这表明准则的分子 $\\|r_k\\|_{M^{-1}}$ 与误差的能量范数 $\\|e_k\\|_A$ 等价，其等价常数为独立于网格的 $\\sqrt{\\alpha}$ 和 $\\sqrt{\\beta}$。\n\n接下来，我们分析分母 $\\|b\\|_{M^{-1}}$。我们将其与 $\\|x^\\ast\\|_A$ 关联起来。\n$$\\|b\\|_{M^{-1}}^2 = b^\\top M^{-1} b = (A x^\\ast)^\\top M^{-1} (A x^\\ast) = (x^\\ast)^\\top A M^{-1} A x^\\ast$$\n谱等价 $\\alpha A \\preceq M \\preceq \\beta A$ 等价于 $\\beta^{-1} A^{-1} \\preceq M^{-1} \\preceq \\alpha^{-1} A^{-1}$。因此\n$\\beta^{-1} \\|b\\|_{A^{-1}}^2 \\le \\|b\\|_{M^{-1}}^2 \\le \\alpha^{-1} \\|b\\|_{A^{-1}}^2$。\n我们知道 $\\|x^\\ast\\|_A^2 = (x^\\ast)^\\top A x^\\ast = (A^{-1}b)^\\top A (A^{-1}b) = b^\\top A^{-1} b = \\|b\\|_{A^{-1}}^2$。\n所以，$\\beta^{-1} \\|x^\\ast\\|_{A}^2 \\le \\|b\\|_{M^{-1}}^2 \\le \\alpha^{-1} \\|x^\\ast\\|_{A}^2$。\n取平方根：$\\frac{1}{\\sqrt{\\beta}} \\|x^\\ast\\|_A \\le \\|b\\|_{M^{-1}} \\le \\frac{1}{\\sqrt{\\alpha}} \\|x^\\ast\\|_A$。\n\n现在我们组合分子和分母的界来估计比率 $\\frac{\\|e_k\\|_A}{\\|x^\\ast\\|_A}$：\n从 $\\sqrt{\\alpha} \\|r_k\\|_{M^{-1}} \\le \\|e_k\\|_A \\le \\sqrt{\\beta} \\|r_k\\|_{M^{-1}}$ 和 $\\frac{1}{\\sqrt{\\beta}} \\|x^\\ast\\|_A \\le \\|b\\|_{M^{-1}}$ 可得\n$$ \\frac{\\|e_k\\|_A}{\\|x^\\ast\\|_A} \\le \\frac{\\sqrt{\\beta} \\|r_k\\|_{M^{-1}}}{(1) \\|x^\\ast\\|_A} \\le \\frac{\\sqrt{\\beta} \\|r_k\\|_{M^{-1}}}{(\\sqrt{\\alpha} \\|b\\|_{M^{-1}})} = \\sqrt{\\frac{\\beta}{\\alpha}} \\frac{\\|r_k\\|_{M^{-1}}}{\\|b\\|_{M^{-1}}} $$\n类似地，从 $\\|e_k\\|_A \\ge \\sqrt{\\alpha} \\|r_k\\|_{M^{-1}}$ 和 $\\|x^\\ast\\|_A \\le \\sqrt{\\beta} \\|b\\|_{M^{-1}}$ 可得\n$$ \\frac{\\|e_k\\|_A}{\\|x^\\ast\\|_A} \\ge \\frac{\\sqrt{\\alpha} \\|r_k\\|_{M^{-1}}}{\\sqrt{\\beta} \\|b\\|_{M^{-1}}} = \\sqrt{\\frac{\\alpha}{\\beta}} \\frac{\\|r_k\\|_{M^{-1}}}{\\|b\\|_{M^{-1}}} $$\n因此，我们有双边不等式：\n$$ \\sqrt{\\frac{\\alpha}{\\beta}} \\left( \\frac{\\|r_k\\|_{M^{-1}}}{\\|b\\|_{M^{-1}}} \\right) \\le \\frac{\\|e_k\\|_A}{\\|x^\\ast\\|_A} \\le \\sqrt{\\frac{\\beta}{\\alpha}} \\left( \\frac{\\|r_k\\|_{M^{-1}}}{\\|b\\|_{M^{-1}}} \\right) $$\n由于 $\\alpha$ 和 $\\beta$ 是独立于网格的正常数，常数 $\\sqrt{\\beta/\\alpha}$ 也是一个独立于网格的正常数。强制 $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$ 保证了 $\\|e_k\\|_A/\\|x^\\ast\\|_A \\le \\tau \\sqrt{\\beta/\\alpha}$。这表明该准则在相差一个固定的、独立于网格的常数的意义下控制了相对能量范数误差。此外，范数 $\\|r_k\\|_{M^{-1}}$ 在 PCG 算法中通常可以廉价地获得，因为在每一步中都会求解一个系统 $Mz_k=r_k$，此时 $\\|r_k\\|_{M^{-1}}^2 = r_k^\\top z_k$。分母 $\\|b\\|_{M^{-1}}$ 只需要计算一次。这使其成为一个实用的替代指标。\n\n结论：**正确**。\n\n**C. $\\|e_k\\|_A/\\|x^\\ast\\|_A$ 的后验估计是概念上最有意义的停止准则，因为对于椭圆问题，$A$-范数（在等价常数的意义下）与物理能量范数一致；然而，这样的估计器需要超出原始残差范数的额外计算。**\n\n问题陈述明确指出，$\\|v\\|_A$ 与连续 $H^1$-半范数等价，后者是连续椭圆 PDE 的自然能量范数。因此，在此范数下控制数值解的误差是最直接且物理意义最明确的目标。一个直接针对相对误差 $\\|e_k\\|_A/\\|x^\\ast\\|_A$ 的停止准则，根据定义，是概念上最相关的。\n然而，在迭代过程中，$\\|e_k\\|_A$ 和 $\\|x^\\ast\\|_A$ 都不能直接计算，因为它们都依赖于未知的精确解 $x^\\ast=A^{-1}b$。\n-   $\\|e_k\\|_A = \\|x_k - x^\\ast\\|_A$\n-   $\\|x^\\ast\\|_A = \\|A^{-1}b\\|_A = \\sqrt{(A^{-1}b)^\\top A (A^{-1}b)} = \\sqrt{b^\\top A^{-1} b} = \\|b\\|_{A^{-1}}$\n要使用这个准则，必须采用*后验误差估计*技术。这些方法通过计算（例如）可用的迭代解 $x_k$ 的单元内残差和单元间通量跳跃来近似 $\\|e_k\\|_A$ 等量。这些计算比计算代数残差向量 $r_k$ 或预处理残差向量 $z_k$ 的范数要复杂得多。因此，这个准则虽然在概念上是理想的，但比基于简单向量范数的准则具有更高的计算成本。该陈述准确地抓住了这种权衡。\n\n结论：**正确**。\n\n**D. 所有三个准则是等价的，无论条件数、离散化或预处理如何；因此它们中任何一个都同样适用于 PDE 误差控制。**\n\n这个陈述显然是错误的。我们对选项 A 的分析表明，准则 1 是依赖于网格的，并且随着网格细化导致矩阵 $A$ 的条件数变差，其有效性会降低。我们对选项 B 的分析表明，准则 2 是独立于网格且鲁棒的，*当且仅当*使用了一个合适的（与 $A$ 谱等价的）预处理器 $M$。准则 3 是理想但计算成本高昂的目标。它们的行为和效用有根本的不同，并且严重依赖于条件数、离散化和预处理。\n\n结论：**错误**。\n\n**E. 准则 $\\|r_k\\|_{M^{-1}}/\\|b\\|_{M^{-1}} \\le \\tau$ 仅在 $M = A$ 精确成立时有意义；否则它无法与能量范数误差关联起来。**\n\n这是一个过于严格且不正确的断言。我们对选项 B 的分析表明，只要 $M$ 与 $A$ *谱等价*且谱等价常数独立于网格，该准则就是有意义的，并能提供对能量范数误差的鲁棒控制。$M=A$ 的情况是谱等价的一个特例，其中 $\\alpha = \\beta = 1$，此时准则 $\\|r_k\\|_{A^{-1}}/\\|b\\|_{A^{-1}} \\le \\tau$ 精确地变为 $\\|e_k\\|_A/\\|x^\\ast\\|_A \\le \\tau$。然而，该准则的效用并不局限于这种理想但不切实际的情况（如果我们知道如何廉价地应用 $A^{-1}$，我们就能直接解决问题了）。预处理的全部意义就在于找到一个与 $A$ 谱等价且易于求逆的矩阵 $M$。许多实用的预处理器（例如，多重网格法、区域分解法）都满足这个性质，但并不等于 $A$。\n\n结论：**错误**。",
            "answer": "$$\\boxed{BC}$$"
        }
    ]
}