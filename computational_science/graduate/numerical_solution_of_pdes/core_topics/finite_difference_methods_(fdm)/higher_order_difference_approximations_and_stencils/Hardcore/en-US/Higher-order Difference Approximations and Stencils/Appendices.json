{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of creating custom finite difference formulas is the method of undetermined coefficients. This powerful technique involves using Taylor series expansions to set up a system of linear equations for the stencil weights, ensuring the discrete operator matches the continuous derivative up to a desired order of accuracy. This practice will guide you through the foundational process of deriving a sixth-order central difference stencil, providing deep insight into the structure of truncation error and the role of stencil symmetry. ",
            "id": "3403244",
            "problem": "Consider a smooth function $u$ with at least $7$ continuous derivatives on an open interval containing $x$. In the numerical solution of Partial Differential Equations (PDE), spatial derivatives are often approximated by finite difference stencils. Let $h0$ denote a uniform mesh spacing and consider the linear discrete operator\n$$\nD_h u(x) \\equiv \\frac{1}{h} \\sum_{m \\in \\{-3,-2,-1,1,2,3\\}} c_m\\, u(x + m h),\n$$\nwhere the $c_m$ are dimensionless weights to be determined. Starting from the Taylor expansion of $u(x+mh)$ about $x$ and without assuming any pre-known stencil, derive the weights $c_m$ that produce a sixth-order accurate central difference approximation to $u'(x)$ using the nodes $x\\pm h$, $x\\pm 2h$, and $x\\pm 3h$. Explicitly solve for the weights and verify the order conditions implied by the Taylor expansion matching through the highest order possible for this stencil. Then compute the truncation error constant $\\tau$ defined by\n$$\nD_h u(x) - u'(x) = \\tau\\, h^{6}\\, u^{(7)}(x) + \\mathcal{O}(h^{8}).\n$$\nReport the weights in the order corresponding to the nodes $x-3h$, $x-2h$, $x-h$, $x+h$, $x+2h$, $x+3h$, followed by the single scalar $\\tau$. Your final answer must be a single analytical expression containing only these seven quantities.",
            "solution": "The problem requires the derivation of the weights $c_m$ for a sixth-order accurate central difference approximation to the first derivative $u'(x)$ using a specified stencil, and the calculation of the leading truncation error constant.\n\nThe discrete operator is given by\n$$\nD_h u(x) = \\frac{1}{h} \\sum_{m \\in S} c_m u(x + m h),\n$$\nwhere the set of stencil indices is $S = \\{-3, -2, -1, 1, 2, 3\\}$. We seek to approximate $u'(x)$ by matching the Taylor series expansion of $D_h u(x)$ with that of $u'(x)$.\n\nThe Taylor series expansion of $u(x+mh)$ around $x$ is\n$$\nu(x+mh) = \\sum_{k=0}^{\\infty} \\frac{(mh)^k}{k!} u^{(k)}(x),\n$$\nwhere $u^{(k)}(x)$ is the $k$-th derivative of $u$ at $x$. Substituting this into the operator expression gives\n$$\nD_h u(x) = \\frac{1}{h} \\sum_{m \\in S} c_m \\left( \\sum_{k=0}^{\\infty} \\frac{(mh)^k}{k!} u^{(k)}(x) \\right).\n$$\nBy interchanging the order of summation, we obtain\n$$\nD_h u(x) = \\sum_{k=0}^{\\infty} \\left( \\frac{h^{k-1}}{k!} \\sum_{m \\in S} c_m m^k \\right) u^{(k)}(x).\n$$\nExpanding this sum, we have\n$$\nD_h u(x) = \\frac{1}{h}\\left(\\sum_m c_m\\right) u(x) + \\left(\\sum_m c_m m\\right) u'(x) + \\frac{h}{2}\\left(\\sum_m c_m m^2\\right) u''(x) + \\frac{h^2}{6}\\left(\\sum_m c_m m^3\\right) u'''(x) + \\dots\n$$\nFor $D_h u(x)$ to be a consistent approximation of $u'(x)$ with a truncation error of $\\mathcal{O}(h^6)$, we must match the coefficients of $u^{(k)}(x)$ in the expansion of $D_h u(x)$ with those in the expansion of $u'(x)$ (which are all zero except for a $1$ for $u'(x)$) up to the highest possible order. This yields a system of linear equations for the six unknown coefficients $c_m$:\n\\begin{align*}\n\\sum_{m \\in S} c_m m^0 = 0 \\quad (\\text{coefficient of } u(x)) \\\\\n\\sum_{m \\in S} c_m m^1 = 1 \\quad (\\text{coefficient of } u'(x)) \\\\\n\\sum_{m \\in S} c_m m^2 = 0 \\quad (\\text{coefficient of } u''(x)) \\\\\n\\sum_{m \\in S} c_m m^3 = 0 \\quad (\\text{coefficient of } u'''(x)) \\\\\n\\sum_{m \\in S} c_m m^4 = 0 \\quad (\\text{coefficient of } u^{(4)}(x)) \\\\\n\\sum_{m \\in S} c_m m^5 = 0 \\quad (\\text{coefficient of } u^{(5)}(x))\n\\end{align*}\nThis constitutes a system of six linear equations for the six unknowns $\\{c_{-3}, c_{-2}, c_{-1}, c_1, c_2, c_3\\}$.\n\nLet us analyze the system by exploiting the symmetry of the stencil. We can separate the equations based on the parity of the power of $m$.\nFor even powers $k=0, 2, 4$:\n\\begin{align*}\n(c_1 + c_{-1}) + (c_2 + c_{-2}) + (c_3 + c_{-3}) = 0 \\\\\n(c_1 + c_{-1}) + 4(c_2 + c_{-2}) + 9(c_3 + c_{-3}) = 0 \\\\\n(c_1 + c_{-1}) + 16(c_2 + c_{-2}) + 81(c_3 + c_{-3}) = 0\n\\end{align*}\nLet $S_j = c_j + c_{-j}$ for $j=1,2,3$. This is a homogeneous linear system for $(S_1, S_2, S_3)$. The determinant of the coefficient matrix is\n$$\n\\det \\begin{pmatrix} 1  1  1 \\\\ 1  4  9 \\\\ 1  16  81 \\end{pmatrix} = 1(4 \\cdot 81 - 9 \\cdot 16) - 1(1 \\cdot 81 - 9) + 1(16 - 4) = 180 - 72 + 12 = 120,\n$$\nwhich is non-zero. Therefore, the only solution is the trivial one: $S_1=S_2=S_3=0$. This implies $c_j + c_{-j} = 0$, or $c_{-j} = -c_j$ for $j=1,2,3$. This establishes the anti-symmetry of the coefficients, a characteristic property of central difference approximations for the first derivative.\n\nFor odd powers $k=1, 3, 5$:\n\\begin{align*}\n(c_1 - c_{-1}) + 2(c_2 - c_{-2}) + 3(c_3 - c_{-3}) = 1 \\\\\n(c_1 - c_{-1}) + 8(c_2 - c_{-2}) + 27(c_3 - c_{-3}) = 0 \\\\\n(c_1 - c_{-1}) + 32(c_2 - c_{-2}) + 243(c_3 - c_{-3}) = 0\n\\end{align*}\nUsing the anti-symmetry property $c_{-j} = -c_j$, we have $c_j - c_{-j} = 2c_j$. The system becomes a $3 \\times 3$ system for $\\{c_1, c_2, c_3\\}$:\n\\begin{align*}\n2c_1 + 4c_2 + 6c_3 = 1 \\\\\n2c_1 + 16c_2 + 54c_3 = 0 \\\\\n2c_1 + 64c_2 + 486c_3 = 0\n\\end{align*}\nSubtracting the first equation from the second, and the second from the third:\n\\begin{align*}\n12c_2 + 48c_3 = -1 \\\\\n48c_2 + 432c_3 = 0\n\\end{align*}\nFrom the second of these new equations, $48c_2 = -432c_3$, which simplifies to $c_2 = -9c_3$. Substituting this into the first new equation:\n$$\n12(-9c_3) + 48c_3 = -1 \\implies -108c_3 + 48c_3 = -1 \\implies -60c_3 = -1 \\implies c_3 = \\frac{1}{60}.\n$$\nNow we find $c_2$:\n$$\nc_2 = -9c_3 = -9 \\left(\\frac{1}{60}\\right) = -\\frac{9}{60} = -\\frac{3}{20}.\n$$\nFinally, we find $c_1$ using the first equation of the $3 \\times 3$ system:\n$$\n2c_1 + 4\\left(-\\frac{3}{20}\\right) + 6\\left(\\frac{1}{60}\\right) = 1 \\implies 2c_1 - \\frac{12}{20} + \\frac{6}{60} = 1 \\implies 2c_1 - \\frac{3}{5} + \\frac{1}{10} = 1.\n$$\n$$\n2c_1 - \\frac{6}{10} + \\frac{1}{10} = 1 \\implies 2c_1 - \\frac{5}{10} = 1 \\implies 2c_1 - \\frac{1}{2} = 1 \\implies 2c_1 = \\frac{3}{2} \\implies c_1 = \\frac{3}{4}.\n$$\nThe six coefficients are therefore:\n$c_1 = \\frac{3}{4}$, $c_2 = -\\frac{3}{20}$, $c_3 = \\frac{1}{60}$.\n$c_{-1} = -c_1 = -\\frac{3}{4}$, $c_{-2} = -c_2 = \\frac{3}{20}$, $c_{-3} = -c_3 = -\\frac{1}{60}$.\n\nWith these coefficients, the sums $\\sum_m c_m m^k$ are zero for $k=0,2,3,4,5$, and one for $k=1$. The truncation error is the first non-zero term in the series expansion of $D_h u(x) - u'(x)$:\n$$\nD_h u(x) - u'(x) = \\sum_{k=2}^{\\infty} \\left( \\frac{h^{k-1}}{k!} \\sum_{m \\in S} c_m m^k \\right) u^{(k)}(x).\n$$\nThe first potential non-zero term after satisfying the system up to $k=5$ corresponds to $k=6$:\n$$\n\\frac{h^{5}}{6!} \\left(\\sum_m c_m m^6\\right) u^{(6)}(x).\n$$\nHowever, due to the anti-symmetry $c_{-j}=-c_j$, the sum for any even power of $m$ is zero:\n$$\n\\sum_m c_m m^6 = \\sum_{j=1}^3 (c_j j^6 + c_{-j}(-j)^6) = \\sum_{j=1}^3 (c_j j^6 - c_j j^6) = 0.\n$$\nThus, the term with $u^{(6)}(x)$ vanishes, and the accuracy is higher than $\\mathcal{O}(h^4)$. The scheme is at least $\\mathcal{O}(h^6)$. The leading error term is the coefficient of $u^{(7)}(x)$:\n$$\nD_h u(x) - u'(x) = \\frac{h^{6}}{7!} \\left(\\sum_m c_m m^7\\right) u^{(7)}(x) + \\mathcal{O}(h^8).\n$$\nThe problem defines the truncation error constant $\\tau$ such that this leading term is $\\tau h^6 u^{(7)}(x)$. Therefore,\n$$\n\\tau = \\frac{1}{7!} \\sum_{m \\in S} c_m m^7.\n$$\nThe sum for an odd power $k=7$ is:\n$$\n\\sum_m c_m m^7 = \\sum_{j=1}^3 (c_j j^7 + c_{-j}(-j)^7) = \\sum_{j=1}^3 (c_j - c_{-j}) j^7 = \\sum_{j=1}^3 2c_j j^7.\n$$\n$$\n\\sum_m c_m m^7 = 2\\left(\\frac{3}{4}\\right)(1)^7 + 2\\left(-\\frac{3}{20}\\right)(2)^7 + 2\\left(\\frac{1}{60}\\right)(3)^7.\n$$\n$$\n\\sum_m c_m m^7 = \\frac{3}{2} - \\frac{3}{10}(128) + \\frac{1}{30}(2187) = \\frac{3}{2} - \\frac{384}{10} + \\frac{2187}{30}.\n$$\nUsing a common denominator of $30$:\n$$\n\\sum_m c_m m^7 = \\frac{45}{30} - \\frac{1152}{30} + \\frac{2187}{30} = \\frac{45 - 1152 + 2187}{30} = \\frac{1080}{30} = 36.\n$$\nNow we compute $\\tau$:\n$$\n\\tau = \\frac{1}{7!} (36) = \\frac{36}{5040}.\n$$\nTo simplify the fraction, we can divide the numerator and denominator by $36$:\n$$\n\\tau = \\frac{1}{5040/36} = \\frac{1}{140}.\n$$\nThe seven requested quantities are the weights $\\{c_{-3}, c_{-2}, c_{-1}, c_1, c_2, c_3\\}$ and the error constant $\\tau$.\n$c_{-3} = -1/60$, $c_{-2} = 3/20$, $c_{-1} = -3/4$, $c_1 = 3/4$, $c_2 = -3/20$, $c_3 = 1/60$, $\\tau = 1/140$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{1}{60}  \\frac{3}{20}  -\\frac{3}{4}  \\frac{3}{4}  -\\frac{3}{20}  \\frac{1}{60}  \\frac{1}{140} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Beyond deriving stencils from scratch, we can also systematically improve the accuracy of existing approximations. Richardson extrapolation is an elegant and widely applicable technique that combines results from a lower-order method computed on different grid scales to cancel leading error terms. This exercise demonstrates how to elevate a standard second-order central difference scheme to fourth-order accuracy, offering a practical tool for achieving higher precision with minimal added complexity. ",
            "id": "3403257",
            "problem": "Consider a smooth function $u(x)$ with at least five continuous derivatives in a neighborhood of a point $x$, and suppose you approximate the first derivative $u'(x)$ using a second-order accurate central difference scheme on a uniform grid of spacing $h$, defined by\n$$D(h) \\equiv \\frac{u(x+h) - u(x-h)}{2 h}.$$\nStarting from the Taylor series expansion of $u(x\\pm h)$ about $x$, derive the leading-order truncation error for $D(h)$. Using these expansions as the fundamental base, construct a Richardson extrapolation that elevates the approximation to fourth order by combining the approximations $D(h)$ and $D(h/2)$ linearly. Specifically, determine the constant $q$ in the ansatz\n$$D_{\\mathrm{R}}(h) \\equiv D\\!\\left(\\frac{h}{2}\\right) + q\\left[D\\!\\left(\\frac{h}{2}\\right) - D(h)\\right],$$\nsuch that $D_{\\mathrm{R}}(h)$ achieves fourth-order accuracy. Then, compute the coefficient $C$ of the leading truncation error term in the resulting fourth-order scheme, defined by\n$$D_{\\mathrm{R}}(h) = u'(x) + C\\,h^{4}\\,u^{(5)}(x) + \\mathcal{O}\\!\\left(h^{6}\\right).$$\nYou must derive both $q$ and $C$ explicitly from first principles. Express your final answer as a pair $\\left(q,\\,C\\right)$ in exact analytic form with no rounding and no units.",
            "solution": "The problem asks for the derivation of the constant $q$ and the leading error coefficient $C$ for a fourth-order approximation of the first derivative $u'(x)$ constructed via Richardson extrapolation. The problem is well-posed, scientifically sound, and contains all necessary information for a unique solution.\n\nFirst, we analyze the truncation error of the second-order central difference approximation, $D(h)$. We begin by writing the Taylor series expansions for $u(x+h)$ and $u(x-h)$ around the point $x$. The function $u(x)$ is assumed to have at least five continuous derivatives, allowing us to expand to the necessary order. To determine the error term of the fourth-order scheme, which is proportional to $h^4$, we must carry terms in the initial expansion up to at least $h^5$. For full rigor, we will expand up to terms of order $h^7$ to see the structure of the subsequent error terms.\n\nThe Taylor series expansions are:\n$$u(x+h) = u(x) + h u'(x) + \\frac{h^2}{2!} u''(x) + \\frac{h^3}{3!} u'''(x) + \\frac{h^4}{4!} u^{(4)}(x) + \\frac{h^5}{5!} u^{(5)}(x) + \\frac{h^6}{6!} u^{(6)}(x) + \\frac{h^7}{7!} u^{(7)}(x) + \\mathcal{O}(h^8)$$\n$$u(x-h) = u(x) - h u'(x) + \\frac{h^2}{2!} u''(x) - \\frac{h^3}{3!} u'''(x) + \\frac{h^4}{4!} u^{(4)}(x) - \\frac{h^5}{5!} u^{(5)}(x) + \\frac{h^6}{6!} u^{(6)}(x) - \\frac{h^7}{7!} u^{(7)}(x) + \\mathcal{O}(h^8)$$\n\nSubtracting the second expansion from the first yields:\n$$u(x+h) - u(x-h) = 2h u'(x) + 2\\frac{h^3}{3!} u'''(x) + 2\\frac{h^5}{5!} u^{(5)}(x) + 2\\frac{h^7}{7!} u^{(7)}(x) + \\mathcal{O}(h^9)$$\n$$u(x+h) - u(x-h) = 2h u'(x) + \\frac{h^3}{3} u'''(x) + \\frac{h^5}{60} u^{(5)}(x) + \\frac{h^7}{2520} u^{(7)}(x) + \\mathcal{O}(h^9)$$\n\nNow, we substitute this result into the definition of the central difference operator $D(h) \\equiv \\frac{u(x+h) - u(x-h)}{2h}$:\n$$D(h) = \\frac{1}{2h} \\left( 2h u'(x) + \\frac{h^3}{3} u'''(x) + \\frac{h^5}{60} u^{(5)}(x) + \\frac{h^7}{2520} u^{(7)}(x) + \\mathcal{O}(h^9) \\right)$$\n$$D(h) = u'(x) + \\frac{h^2}{6} u'''(x) + \\frac{h^4}{120} u^{(5)}(x) + \\frac{h^6}{5040} u^{(7)}(x) + \\mathcal{O}(h^8)$$\nThe leading-order truncation error for $D(h)$ is $\\frac{h^2}{6} u'''(x)$, which confirms that $D(h)$ is a second-order accurate approximation, i.e., $D(h) = u'(x) + \\mathcal{O}(h^2)$.\n\nNext, we construct the Richardson extrapolation. We need the expression for $D(h/2)$, which is obtained by substituting $h/2$ for $h$ in the expansion for $D(h)$:\n$$D\\left(\\frac{h}{2}\\right) = u'(x) + \\frac{(h/2)^2}{6} u'''(x) + \\frac{(h/2)^4}{120} u^{(5)}(x) + \\frac{(h/2)^6}{5040} u^{(7)}(x) + \\mathcal{O}(h^8)$$\n$$D\\left(\\frac{h}{2}\\right) = u'(x) + \\frac{h^2}{24} u'''(x) + \\frac{h^4}{1920} u^{(5)}(x) + \\frac{h^6}{322560} u^{(7)}(x) + \\mathcal{O}(h^8)$$\n\nThe Richardson extrapolation formula is given as $D_{\\mathrm{R}}(h) \\equiv D(h/2) + q[D(h/2) - D(h)]$. To apply this, we first compute the difference term:\n$$D\\left(\\frac{h}{2}\\right) - D(h) = \\left( \\frac{h^2}{24} - \\frac{h^2}{6} \\right) u'''(x) + \\left( \\frac{h^4}{1920} - \\frac{h^4}{120} \\right) u^{(5)}(x) + \\mathcal{O}(h^6)$$\n$$D\\left(\\frac{h}{2}\\right) - D(h) = \\left( \\frac{1-4}{24} \\right) h^2 u'''(x) + \\left( \\frac{1-16}{1920} \\right) h^4 u^{(5)}(x) + \\mathcal{O}(h^6)$$\n$$D\\left(\\frac{h}{2}\\right) - D(h) = -\\frac{3}{24} h^2 u'''(x) - \\frac{15}{1920} h^4 u^{(5)}(x) + \\mathcal{O}(h^6)$$\n$$D\\left(\\frac{h}{2}\\right) - D(h) = -\\frac{1}{8} h^2 u'''(x) - \\frac{1}{128} h^4 u^{(5)}(x) + \\mathcal{O}(h^6)$$\n\nNow, substitute this into the formula for $D_{\\mathrm{R}}(h)$:\n$$D_{\\mathrm{R}}(h) = \\left( u'(x) + \\frac{h^2}{24} u'''(x) + \\frac{h^4}{1920} u^{(5)}(x) \\right) + q \\left( -\\frac{h^2}{8} u'''(x) - \\frac{h^4}{128} u^{(5)}(x) \\right) + \\mathcal{O}(h^6)$$\nCombine terms with the same power of $h$:\n$$D_{\\mathrm{R}}(h) = u'(x) + \\left( \\frac{1}{24} - \\frac{q}{8} \\right) h^2 u'''(x) + \\left( \\frac{1}{1920} - \\frac{q}{128} \\right) h^4 u^{(5)}(x) + \\mathcal{O}(h^6)$$\n\nFor $D_{\\mathrm{R}}(h)$ to be fourth-order accurate, the coefficient of the $h^2$ term must be zero.\n$$\\frac{1}{24} - \\frac{q}{8} = 0$$\n$$\\frac{q}{8} = \\frac{1}{24}$$\n$$q = \\frac{8}{24} = \\frac{1}{3}$$\n\nWith $q=1/3$, the approximation becomes fourth-order accurate. The leading truncation error is now the term proportional to $h^4$. The coefficient of this term is denoted by $C$.\n$$C = \\frac{1}{1920} - \\frac{q}{128} = \\frac{1}{1920} - \\frac{1/3}{128} = \\frac{1}{1920} - \\frac{1}{3 \\times 128} = \\frac{1}{1920} - \\frac{1}{384}$$\nTo subtract the fractions, we find a common denominator, which is $1920$. Note that $1920 = 5 \\times 384$.\n$$C = \\frac{1}{1920} - \\frac{5}{1920} = \\frac{1-5}{1920} = -\\frac{4}{1920}$$\nSimplifying the fraction gives:\n$$C = -\\frac{1}{480}$$\nThus, the fourth-order accurate approximation and its leading error term are:\n$$D_{\\mathrm{R}}(h) = u'(x) - \\frac{1}{480} h^{4} u^{(5)}(x) + \\mathcal{O}(h^{6})$$\n\nThe required values are $q=1/3$ and $C=-1/480$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1}{3}  -\\frac{1}{480} \\end{pmatrix}}$$"
        },
        {
            "introduction": "For applications demanding exceptional accuracy, we can move beyond explicit stencils to compact, or Hermite, formulations. These implicit methods achieve a very high order of accuracy on a minimal stencil width by treating derivative values themselves as coupled unknowns, resulting in a matrix system to be solved. This advanced practice bridges theory and computation, challenging you to design an eighth-order scheme, implement it for a periodic problem, and analyze its numerical conditioning, reflecting the complete workflow of a computational scientist. ",
            "id": "3403277",
            "problem": "You will design and implement compact Hermite stencils for a one-dimensional, periodic grid to approximate the second derivative $u_{xx}$ with eighth-order accuracy, using both the function values $u$ and first derivative values $u_x$ as unknowns to minimize stencil bandwidth. Your starting point must be the Taylor expansion about a grid point and periodicity. You must build a pair of coupled linear systems whose unknowns are the discrete approximations of $u_x$ and $u_{xx}$ and whose right-hand sides involve only sampled values of $u$. You must study the conditioning of the second-derivative linear system. All angles in trigonometric functions must be in radians.\n\nConsider a uniform grid on the interval $[0, 2\\pi)$ with $N$ points, grid spacing $h = \\frac{2\\pi}{N}$, and periodic boundary conditions. At each grid point $x_j = j h$, let $u_j = u(x_j)$ and define $u'_j \\approx u_x(x_j)$ and $u''_j \\approx u_{xx}(x_j)$. Construct two compact Hermite stencils:\n\n- An eighth-order compact Hermite stencil for $u_x$ with minimal bandwidth using the symmetric unknown stencil:\n$$\nd_0 u'_j + d_1 \\left(u'_{j-1} + u'_{j+1}\\right) + d_2 \\left(u'_{j-2} + u'_{j+2}\\right)\n= \\frac{1}{h}\\left[ e_1 \\left(u_{j+1} - u_{j-1}\\right) + e_2 \\left(u_{j+2} - u_{j-2}\\right) \\right]\n$$\nwhere $d_0 = 1$ and the coefficients $d_1, d_2, e_1, e_2$ must be determined by matching Taylor expansions about $x_j$ so that the truncation error is $\\mathcal{O}(h^8)$.\n\n- An eighth-order compact Hermite stencil for $u_{xx}$ with minimal bandwidth using both $u$ and $u_x$ unknowns:\n$$\na_0 u''_j + a_1 \\left(u''_{j-1} + u''_{j+1}\\right) + a_2 \\left(u''_{j-2} + u''_{j+2}\\right)\n= \\frac{1}{h^2}\\left[ b_0 u_j + b_1 \\left(u_{j-1} + u_{j+1}\\right) + b_2 \\left(u_{j-2} + u_{j+2}\\right) \\right]\n+ \\frac{1}{h}\\left[ c_1 \\left(u'_{j+1} - u'_{j-1}\\right) + c_2 \\left(u'_{j+2} - u'_{j-2}\\right) \\right]\n$$\nFix $a_0 = 1$ and select $a_1 = \\frac{1}{3}$ and $a_2 = \\frac{1}{6}$ to ensure a strictly positive denominator symbol for all grid wavenumbers. Determine $b_0, b_1, b_2, c_1, c_2$ by matching Taylor expansions about $x_j$ so that the truncation error is $\\mathcal{O}(h^8)$ and the $\\mathcal{O}(h^{-2})$ term in $u$ cancels.\n\nAlgorithmic tasks:\n\n1. Starting from the Taylor series of $u(x)$ and its derivatives about $x_j$, derive linear systems for the coefficients $d_1, d_2, e_1, e_2$ and $b_0, b_1, b_2, c_1, c_2$ by enforcing equality of series coefficients up to and including the terms that guarantee eighth-order accuracy. Do not introduce any formulas beyond series identities implied by Taylor expansion and periodicity.\n\n2. Build the corresponding periodic circulant matrices for the left-hand sides and right-hand sides of each stencil. The first derivative system must be solved to obtain discrete $u'_j$, which then feeds the second derivative system to obtain $u''_j$.\n\n3. Use the function $u(x) = \\sin(k x)$, with $x$ in radians, and exact derivatives $u_x(x) = k \\cos(k x)$ and $u_{xx}(x) = -k^2 \\sin(k x)$, to validate the scheme. Compute the relative $\\ell^2$ error in the second derivative approximation:\n$$\nE(N, k) = \\frac{\\| q - u_{xx}^{\\text{exact}} \\|_2}{\\| u_{xx}^{\\text{exact}} \\|_2},\n$$\nwhere $q$ is the computed vector of $u''_j$.\n\n4. Study conditioning by computing the two-norm condition number of the $u_{xx}$ left-hand-side matrix:\n$$\n\\kappa_2(A_2) = \\|A_2\\|_2 \\cdot \\|A_2^{-1}\\|_2.\n$$\n\nTest suite and output specification:\n\n- Use the following test cases to produce five numerical results:\n    - Case $1$: $N = 64$, $k = 2$; return $E(64, 2)$ as a float.\n    - Case $2$: $N = 16$, $k = 2$; return $E(16, 2)$ as a float.\n    - Case $3$: $N = 64$, $k = \\frac{N}{4}$; return $E(64, 16)$ as a float.\n    - Case $4$: $N = 64$; return $\\kappa_2(A_2)$ as a float.\n    - Case $5$: $N = 512$; return $\\kappa_2(A_2)$ as a float.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5]$). All angles must be in radians, and all numerical outputs must be unitless floating-point numbers.",
            "solution": "The user's problem has been validated and is determined to be a well-posed, scientifically grounded problem in numerical analysis. It is free of any invalidating flaws. We may proceed with the solution.\n\n### 1. Derivation of Stencil Coefficients\n\nThe core of the problem is to determine the coefficients of two compact Hermite stencils by matching Taylor series expansions to achieve eighth-order accuracy. Taylor series for a function $u(x)$ and its derivatives $u^{(n)}(x)$ around a point $x_j$ are given by:\n$u(x_j \\pm m h) = \\sum_{k=0}^{\\infty} \\frac{(\\pm m h)^k}{k!} u^{(k)}(x_j)$\n$u_x(x_j \\pm m h) = \\sum_{k=0}^{\\infty} \\frac{(\\pm m h)^k}{k!} u^{(k+1)}(x_j)$\n$u_{xx}(x_j \\pm m h) = \\sum_{k=0}^{\\infty} \\frac{(\\pm m h)^k}{k!} u^{(k+2)}(x_j)$\n\nHere, $h$ is the grid spacing, $m$ is an integer, and $u^{(k)}(x_j)$ is the $k$-th derivative of $u$ at $x_j$. We denote $u^{(k)}(x_j)$ by $u_j^{(k)}$.\n\n#### 1.1 First Derivative Stencil ($u_x$)\n\nThe stencil for the first derivative approximation $u'_j$ is:\n$$\nd_0 u'_j + d_1 (u'_{j-1} + u'_{j+1}) + d_2 (u'_{j-2} + u'_{j+2}) = \\frac{1}{h}\\left[ e_1 (u_{j+1} - u_{j-1}) + e_2 (u_{j+2} - u_{j-2}) \\right]\n$$\nWe replace the discrete values $u'_j$ and $u_j$ with their exact counterparts $u_j^{(1)}$ and $u_j$ and expand all terms around $x_j$.\n\nThe left-hand side (LHS) expansion is:\n$LHS = (d_0 + 2d_1 + 2d_2)u_j^{(1)} + h^2(d_1 + 4d_2)u_j^{(3)} + \\frac{h^4}{12}(d_1 + 16d_2)u_j^{(5)} + \\frac{h^6}{360}(d_1 + 64d_2)u_j^{(7)} + \\frac{h^8}{20160}(d_1 + 256d_2)u_j^{(9)} + \\mathcal{O}(h^{10})$\n\nThe right-hand side (RHS) expansion is:\n$RHS = 2(e_1 + 2e_2)u_j^{(1)} + \\frac{h^2}{3}(e_1 + 8e_2)u_j^{(3)} + \\frac{h^4}{60}(e_1 + 32e_2)u_j^{(5)} + \\frac{h^6}{2520}(e_1 + 128e_2)u_j^{(7)} + \\frac{h^8}{181440}(e_1 + 512e_2)u_j^{(9)} + \\mathcal{O}(h^{10})$\n\nTo achieve eighth-order accuracy, the truncation error must be $\\mathcal{O}(h^8)$. This requires the coefficients of $u_j^{(1)}, u_j^{(3)}, u_j^{(5)}, u_j^{(7)}$ to match between the LHS and RHS. With the normalization $d_0=1$, we obtain a system of four linear equations for $d_1, d_2, e_1, e_2$:\n\n1.  $1 + 2d_1 + 2d_2 = 2e_1 + 4e_2$\n2.  $d_1 + 4d_2 = \\frac{1}{3}(e_1 + 8e_2)$\n3.  $\\frac{1}{12}(d_1 + 16d_2) = \\frac{1}{60}(e_1 + 32e_2) \\implies 5(d_1 + 16d_2) = e_1 + 32e_2$\n4.  $\\frac{1}{360}(d_1 + 64d_2) = \\frac{1}{2520}(e_1 + 128e_2) \\implies 7(d_1 + 64d_2) = e_1 + 128e_2$\n\nSolving this system yields the unique rational coefficients:\n$d_1 = \\frac{4}{9}$, $d_2 = \\frac{1}{36}$, $e_1 = \\frac{20}{27}$, $e_2 = \\frac{25}{216}$.\n\n#### 1.2 Second Derivative Stencil ($u_{xx}$)\n\nThe stencil for the second derivative approximation $u''_j$ is:\n$$\na_0 u''_j + a_1 \\left(u''_{j-1} + u''_{j+1}\\right) + a_2 \\left(u''_{j-2} + u''_{j+2}\\right) = \\frac{1}{h^2}\\left[ b_0 u_j + b_1 \\left(u_{j-1} + u_{j+1}\\right) + b_2 \\left(u_{j-2} + u_{j+2}\\right) \\right] + \\frac{1}{h}\\left[ c_1 \\left(u'_{j+1} - u'_{j-1}\\right) + c_2 \\left(u'_{j+2} - u'_{j-2}\\right) \\right]\n$$\nWe are given $a_0 = 1, a_1 = \\frac{1}{3}, a_2 = \\frac{1}{6}$. The procedure is analogous. We expand the operator form $A_h u_{xx} - \\frac{1}{h^2}B_h u - \\frac{1}{h}C_h u_x = \\text{Truncation Error}$ and require the error to be $\\mathcal{O}(h^8)$. This means coefficients of $u_j^{(k)}$ for $k=0, 2, 4, 6, 8$ in the resulting expansion must be zero, after dividing by any overall prefactors.\n\nThe term in $u_j^{(0)}$ must vanish, which implies $b_0 + 2b_1 + 2b_2 = 0$. Equating coefficients for $u_j^{(2)}, u_j^{(4)}, u_j^{(6)}, u_j^{(8)}$ gives a system for the remaining four unknowns $b_1, b_2, c_1, c_2$.\n\n1.  $u_j^{(2)}: a_0+2a_1+2a_2 = (b_1+4b_2) + 2(c_1+2c_2) \\implies 2 = b_1+4b_2+2c_1+4c_2$\n2.  $u_j^{(4)}: a_1+4a_2 = \\frac{1}{12}(b_1+16b_2) + \\frac{1}{3}(c_1+8c_2) \\implies 12 = b_1+16b_2+4c_1+32c_2$\n3.  $u_j^{(6)}: \\frac{1}{12}(a_1+16a_2) = \\frac{1}{360}(b_1+64b_2) + \\frac{1}{60}(c_1+32c_2) \\implies 90 = b_1+64b_2+6c_1+192c_2$\n4.  $u_j^{(8)}: \\frac{1}{360}(a_1+64a_2) = \\frac{1}{20160}(b_1+256b_2) + \\frac{1}{2520}(c_1+128c_2) \\implies 616 = b_1+256b_2+8c_1+1024c_2$\n\nSolving this system gives:\n$b_1 = \\frac{16}{27}$, $b_2 = -\\frac{70}{27}$, $c_1 = \\frac{31}{9}$, $c_2 = \\frac{11}{9}$.\nFrom $b_0 = -2b_1 - 2b_2$, we find $b_0 = -2(\\frac{16}{27}) - 2(-\\frac{70}{27}) = \\frac{-32+140}{27} = \\frac{108}{27} = 4$.\n\nThe coefficients are:\n$a_0=1, a_1=\\frac{1}{3}, a_2=\\frac{1}{6}$\n$b_0=4, b_1=\\frac{16}{27}, b_2=-\\frac{70}{27}, c_1=\\frac{31}{9}, c_2=\\frac{11}{9}$\n\n### 2. Numerical Implementation\n\nOn a periodic grid with $N$ points, the stencils give rise to linear systems involving circulant matrices.\n\n#### 2.1 First Derivative System\n$A_1 \\vec{u}' = \\vec{r}_1$ where $\\vec{u}'$ is the vector of unknown derivatives $[u'_0, \\dots, u'_{N-1}]^T$. $A_1$ is the symmetric circulant matrix defined by coefficients $d_0, d_1, d_2$. The first row of $A_1$ is $[d_0, d_1, d_2, 0, \\dots, 0, d_2, d_1]$. The right-hand side vector $\\vec{r}_1$ is computed by applying the right-hand side operator to the vector of function values $\\vec{u} = [u_0, \\dots, u_{N-1}]^T$:\n$(\\vec{r}_1)_j = \\frac{1}{h} \\left[ e_1(u_{j+1} - u_{j-1}) + e_2(u_{j+2} - u_{j-2}) \\right]$.\n\n#### 2.2 Second Derivative System\nOnce $\\vec{u}'$ is found, we solve for the second derivative $\\vec{u}''$:\n$A_2 \\vec{u}'' = \\vec{r}_2$, where $A_2$ is the symmetric circulant matrix from coefficients $a_0, a_1, a_2$. The right-hand side $\\vec{r}_2$ is a combination of operations on $\\vec{u}$ and the computed $\\vec{u}'$:\n$(\\vec{r}_2)_j = \\frac{1}{h^2} \\left[ b_0 u_j + b_1(u_{j-1} + u_{j+1}) + b_2(u_{j-2} + u_{j+2}) \\right] + \\frac{1}{h} \\left[ c_1(u'_{j+1} - u'_{j-1}) + c_2(u'_{j+2} - u'_{j-2}) \\right]$.\nThese circulant systems can be solved efficiently, for instance using `scipy.linalg.solve_circulant`.\n\n### 3. Error and Conditioning Analysis\n\nThe relative $\\ell^2$ error is computed as specified:\n$E(N, k) = \\frac{\\| \\vec{u}_{comp}'' - \\vec{u}_{xx}^{\\text{exact}} \\|_2}{\\| \\vec{u}_{xx}^{\\text{exact}} \\|_2}$.\n\nThe two-norm condition number $\\kappa_2(A_2)$ of the symmetric circulant matrix $A_2$ is the ratio of its largest to its smallest absolute eigenvalues. The eigenvalues of a symmetric circulant matrix with first row $(c_0, c_1, \\dots, c_{N-1})$ where $c_i=c_{N-i}$ are given by the real-valued formula:\n$\\lambda_j = c_0 + 2 \\sum_{l=1}^{\\lfloor (N-1)/2 \\rfloor} c_l \\cos\\left(\\frac{2\\pi jl}{N}\\right)$.\nFor matrix $A_2$, the eigenvalues are:\n$\\lambda_j = a_0 + 2a_1\\cos\\left(\\frac{2\\pi j}{N}\\right) + 2a_2\\cos\\left(\\frac{4\\pi j}{N}\\right)$, for $j = 0, \\dots, N-1$.\nThe condition number is then $\\kappa_2(A_2) = \\frac{\\max_j |\\lambda_j|}{\\min_j |\\lambda_j|}$. Given the specified coefficients, the eigenvalues are always positive, so the absolute value is redundant.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_circulant\n\ndef solve():\n    \"\"\"\n    Designs and implements 8th-order compact Hermite stencils for the second derivative,\n    validates the scheme, and analyzes its conditioning.\n    \"\"\"\n    \n    # Coefficients for the first derivative stencil (u_x)\n    # d0*u'_j + d1*(u'_{j-1}+u'_{j+1}) + d2*(u'_{j-2}+u'_{j+2}) = 1/h * [e1*(u_{j+1}-u_{j-1}) + e2*(u_{j+2}-u_{j-2})]\n    # d0 is normalized to 1.\n    d0_1 = 1.0\n    d1_1 = 4.0 / 9.0\n    d2_1 = 1.0 / 36.0\n    e1_1 = 20.0 / 27.0\n    e2_1 = 25.0 / 216.0\n\n    # Coefficients for the second derivative stencil (u_xx)\n    # LHS: a0*u''_j + a1*(u''_{j-1}+u''_{j+1}) + a2*(u''_{j-2}+u''_{j+2})\n    # RHS: 1/h^2 * [b0*u_j + b1*(u_{j-1}+u_{j+1}) + b2*(u_{j-2}+u_{j+2})] + 1/h * [c1*(u'_{j+1}-u'_{j-1}) + c2*(u'_{j+2}-u'_{j-2})]\n    # a0, a1, a2 are given.\n    a0_2 = 1.0\n    a1_2 = 1.0 / 3.0\n    a2_2 = 1.0 / 6.0\n    # b_i and c_i are derived.\n    b0_2 = 4.0\n    b1_2 = 16.0 / 27.0\n    b2_2 = -70.0 / 27.0\n    c1_2 = 31.0 / 9.0\n    c2_2 = 11.0 / 9.0\n\n    # Test cases as specified in the problem statement\n    test_cases = [\n        {'type': 'error', 'N': 64, 'k': 2},\n        {'type': 'error', 'N': 16, 'k': 2},\n        {'type': 'error', 'N': 64, 'k': 64 / 4},\n        {'type': 'cond', 'N': 64},\n        {'type': 'cond', 'N': 512}\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case['N']\n        \n        if case['type'] == 'error':\n            k = float(case['k'])\n            h = 2.0 * np.pi / N\n            x = np.arange(N) * h\n            \n            # Test function and its exact derivatives\n            u = np.sin(k * x)\n            u_xx_exact = -k**2 * np.sin(k * x)\n\n            # --- System 1: Solve for the first derivative u' ---\n            \n            # Build the circulant matrix A1 (as its first row)\n            A1_row = np.zeros(N)\n            A1_row[0] = d0_1\n            A1_row[1] = d1_1\n            A1_row[N-1] = d1_1\n            A1_row[2] = d2_1\n            A1_row[N-2] = d2_1\n\n            # Build the RHS for the u' system\n            u_jp1 = np.roll(u, -1)\n            u_jm1 = np.roll(u, 1)\n            u_jp2 = np.roll(u, -2)\n            u_jm2 = np.roll(u, 2)\n            rhs1 = (e1_1 * (u_jp1 - u_jm1) + e2_1 * (u_jp2 - u_jm2)) / h\n            \n            # Solve the circulant system A1 * u_prime = rhs1\n            u_prime = solve_circulant(A1_row, rhs1)\n            \n            # --- System 2: Solve for the second derivative u'' ---\n            \n            # Build the circulant matrix A2 (as its first row)\n            A2_row = np.zeros(N)\n            A2_row[0] = a0_2\n            A2_row[1] = a1_2\n            A2_row[N-1] = a1_2\n            A2_row[2] = a2_2\n            A2_row[N-2] = a2_2\n            \n            # Build the RHS for the u'' system\n            B2_u_term = b0_2 * u + b1_2 * (u_jm1 + u_jp1) + b2_2 * (u_jm2 + u_jp2)\n            \n            up_jp1 = np.roll(u_prime, -1)\n            up_jm1 = np.roll(u_prime, 1)\n            up_jp2 = np.roll(u_prime, -2)\n            up_jm2 = np.roll(u_prime, 2)\n            C2_up_term = c1_2 * (up_jp1 - up_jm1) + c2_2 * (up_jp2 - up_jm2)\n            \n            rhs2 = B2_u_term / h**2 + C2_up_term / h\n\n            # Solve the circulant system A2 * q = rhs2\n            q = solve_circulant(A2_row, rhs2)\n            \n            # --- Error Calculation ---\n            norm_q_diff = np.linalg.norm(q - u_xx_exact)\n            norm_u_xx_exact = np.linalg.norm(u_xx_exact)\n            \n            if norm_u_xx_exact  1e-15:\n                # Handle cases where the exact solution is zero\n                error = norm_q_diff\n            else:\n                error = norm_q_diff / norm_u_xx_exact\n            \n            results.append(error)\n\n        elif case['type'] == 'cond':\n            # --- Condition Number Calculation ---\n            j = np.arange(N)\n            # Eigenvalues of the circulant matrix A2\n            theta_j = 2.0 * np.pi * j / N\n            eigenvalues = a0_2 + 2.0 * a1_2 * np.cos(theta_j) + 2.0 * a2_2 * np.cos(2.0 * theta_j)\n            \n            # Compute the 2-norm condition number\n            cond_num = np.max(np.abs(eigenvalues)) / np.min(np.abs(eigenvalues))\n            results.append(cond_num)\n\n    # Format and print the final results\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}