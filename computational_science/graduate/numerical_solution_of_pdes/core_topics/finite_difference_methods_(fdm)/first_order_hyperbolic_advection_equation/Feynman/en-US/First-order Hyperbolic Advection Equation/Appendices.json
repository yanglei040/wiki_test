{
    "hands_on_practices": [
        {
            "introduction": "A numerical scheme for a hyperbolic equation is only useful if it is stable, meaning that errors introduced during computation do not grow without bound. This first exercise introduces the foundational tool for analyzing stability: von Neumann analysis. By deriving the amplification factor for the classic Lax-Friedrichs scheme, you will determine its stability limit and gain insight into how the scheme's averaging component introduces the numerical dissipation necessary to control high-frequency error modes .",
            "id": "3394452",
            "problem": "Consider the linear constant-coefficient first-order hyperbolic advection equation $u_{t} + a\\,u_{x} = 0$ with constant wave speed $a \\in \\mathbb{R}$ discretized on a uniform grid with spatial step $\\,\\Delta x\\,$ and time step $\\,\\Delta t\\,$. Define the Courant number $\\lambda = a\\,\\Delta t/\\Delta x$. Consider the classic Lax–Friedrichs method\n$$\nu_{j}^{n+1} = \\tfrac{1}{2}\\big(u_{j+1}^{n} + u_{j-1}^{n}\\big) - \\tfrac{\\lambda}{2}\\big(u_{j+1}^{n} - u_{j-1}^{n}\\big),\n$$\nwhere $j \\in \\mathbb{Z}$ indexes spatial nodes and $n \\in \\mathbb{N}$ indexes time levels. Using the definition of von Neumann stability for linear constant-coefficient schemes (i.e., Fourier mode analysis on modes of the form $u_{j}^{n} = \\hat{u}^{n}\\exp(i j \\theta)$ for wavenumber $\\theta \\in [-\\pi,\\pi]$), derive the amplification factor $G(\\theta,\\lambda)$ and determine the largest Courant number $\\lambda_{\\max}$ such that the scheme is stable in the von Neumann sense, meaning $\\sup_{\\theta \\in [-\\pi,\\pi]} |G(\\theta,\\lambda)| \\le 1$. Assume $a  0$ so that $\\lambda \\ge 0$. As part of your derivation, explain how the averaging term $\\tfrac{1}{2}(u_{j+1}^{n} + u_{j-1}^{n})$ contributes to damping of grid-resolved high-frequency modes. Provide your final answer as the single real number $\\lambda_{\\max}$. No rounding is required.",
            "solution": "The problem statement is evaluated as valid. It presents a well-posed, scientifically grounded, and standard problem in the field of numerical analysis for partial differential equations. All necessary information, including the governing equation, the numerical scheme, and the definition of stability, is provided explicitly and consistently. The task is to perform a von Neumann stability analysis, which is the canonical method for the given context.\n\nThe analysis proceeds in three parts: first, the derivation of the amplification factor $G(\\theta, \\lambda)$; second, the application of the stability condition to find $\\lambda_{\\max}$; and third, an explanation of the role of the averaging term.\n\nTo derive the amplification factor, we substitute a single Fourier mode, $u_{j}^{n} = \\hat{u}^{n}\\exp(i j \\theta)$, into the Lax–Friedrichs scheme:\n$$\nu_{j}^{n+1} = \\frac{1}{2}\\big(u_{j+1}^{n} + u_{j-1}^{n}\\big) - \\frac{\\lambda}{2}\\big(u_{j+1}^{n} - u_{j-1}^{n}\\big)\n$$\nSubstituting the Fourier mode for each term yields:\n$u_{j}^{n+1} = \\hat{u}^{n+1}\\exp(i j \\theta)$\n$u_{j+1}^{n} = \\hat{u}^{n}\\exp(i (j+1) \\theta) = \\hat{u}^{n}\\exp(i j \\theta)\\exp(i \\theta)$\n$u_{j-1}^{n} = \\hat{u}^{n}\\exp(i (j-1) \\theta) = \\hat{u}^{n}\\exp(i j \\theta)\\exp(-i \\theta)$\n\nPlugging these into the scheme gives:\n$$\n\\hat{u}^{n+1}\\exp(i j \\theta) = \\frac{1}{2}\\left(\\hat{u}^{n}\\exp(i j \\theta)\\exp(i \\theta) + \\hat{u}^{n}\\exp(i j \\theta)\\exp(-i \\theta)\\right) - \\frac{\\lambda}{2}\\left(\\hat{u}^{n}\\exp(i j \\theta)\\exp(i \\theta) - \\hat{u}^{n}\\exp(i j \\theta)\\exp(-i \\theta)\\right)\n$$\nThe amplification factor is defined as $G(\\theta, \\lambda) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}}$. Dividing the entire equation by $\\hat{u}^{n}\\exp(i j \\theta)$ gives:\n$$\nG(\\theta, \\lambda) = \\frac{1}{2}\\left(\\exp(i \\theta) + \\exp(-i \\theta)\\right) - \\frac{\\lambda}{2}\\left(\\exp(i \\theta) - \\exp(-i \\theta)\\right)\n$$\nUsing Euler's formulas, $\\cos(\\theta) = \\frac{1}{2}(\\exp(i \\theta) + \\exp(-i \\theta))$ and $\\sin(\\theta) = \\frac{1}{2i}(\\exp(i \\theta) - \\exp(-i \\theta))$, we simplify the expression for $G(\\theta, \\lambda)$:\n$$\nG(\\theta, \\lambda) = \\cos(\\theta) - \\frac{\\lambda}{2}(2i\\sin(\\theta)) = \\cos(\\theta) - i\\lambda\\sin(\\theta)\n$$\nThis is the amplification factor for the Lax-Friedrichs scheme.\n\nNext, we apply the von Neumann stability condition, which states that the magnitude of the amplification factor must not exceed $1$ for any wavenumber $\\theta \\in [-\\pi, \\pi]$:\n$$\n|G(\\theta, \\lambda)| \\le 1\n$$\nWe compute the squared magnitude of $G(\\theta, \\lambda)$, which is a complex number with real part $\\cos(\\theta)$ and imaginary part $-\\lambda\\sin(\\theta)$:\n$$\n|G(\\theta, \\lambda)|^2 = (\\cos(\\theta))^2 + (-\\lambda\\sin(\\theta))^2 = \\cos^2(\\theta) + \\lambda^2\\sin^2(\\theta)\n$$\nThe stability condition is therefore:\n$$\n\\cos^2(\\theta) + \\lambda^2\\sin^2(\\theta) \\le 1\n$$\nUsing the identity $\\cos^2(\\theta) = 1 - \\sin^2(\\theta)$, we can rewrite the inequality as:\n$$\n1 - \\sin^2(\\theta) + \\lambda^2\\sin^2(\\theta) \\le 1\n$$\n$$\n(\\lambda^2 - 1)\\sin^2(\\theta) \\le 0\n$$\nFor any real wavenumber $\\theta$, the term $\\sin^2(\\theta)$ is always non-negative (i.e., $\\sin^2(\\theta) \\ge 0$).\nIf $\\sin^2(\\theta) = 0$ (for $\\theta = 0, \\pm\\pi$), the inequality becomes $0 \\le 0$, which is trivially true for any value of $\\lambda$.\nIf $\\sin^2(\\theta)  0$ (for all other $\\theta \\in [-\\pi, \\pi]$), we must satisfy the condition $\\lambda^2 - 1 \\le 0$ for the overall product to be non-positive.\nThis implies $\\lambda^2 \\le 1$.\nThe problem specifies that $a  0$, $\\Delta t  0$, and $\\Delta x  0$, so the Courant number $\\lambda = a \\Delta t/\\Delta x$ is non-negative, $\\lambda \\ge 0$.\nCombining $\\lambda^2 \\le 1$ with $\\lambda \\ge 0$ gives the stability constraint:\n$$\n0 \\le \\lambda \\le 1\n$$\nThe largest value of the Courant number $\\lambda$ that satisfies this condition for all $\\theta$ is $\\lambda_{\\max} = 1$. This is the CFL (Courant-Friedrichs-Lewy) condition for this scheme.\n\nFinally, we address the role of the averaging term $\\frac{1}{2}(u_{j+1}^{n} + u_{j-1}^{n})$. This term introduces numerical dissipation (or artificial viscosity), which is what stabilizes the scheme. The unstable Forward-Time Centered-Space (FTCS) scheme for this PDE is $u_{j}^{n+1} = u_{j}^{n} - \\frac{\\lambda}{2}(u_{j+1}^{n} - u_{j-1}^{n})$. The Lax-Friedrichs scheme replaces the $u_{j}^{n}$ term with the spatial average $\\frac{1}{2}(u_{j+1}^{n} + u_{j-1}^{n})$.\n\nFrom the perspective of the amplification factor, the FTCS scheme would have $G_{FTCS} = 1 - i\\lambda\\sin(\\theta)$, leading to $|G_{FTCS}|^2 = 1 + \\lambda^2\\sin^2(\\theta)  1$ for $\\sin(\\theta) \\neq 0$, which is unconditionally unstable. The averaging in Lax-Friedrichs replaces the '$1$' in $G_{FTCS}$'s real part with $\\cos(\\theta)$. This results in $|G_{LF}|^2 = \\cos^2(\\theta) + \\lambda^2\\sin^2(\\theta)$. Since $\\cos^2(\\theta) \\le 1$, this term counteracts the growth from the imaginary part. For any mode with $\\sin(\\theta) \\neq 0$ and a stable Courant number $\\lambda  1$, we have $|G_{LF}|^2  \\cos^2(\\theta) + \\sin^2(\\theta) = 1$. This shows that all non-constant modes are damped, a key feature for suppressing high-frequency numerical oscillations.\n\nFrom the perspective of modified partial differential equations, we can analyze the scheme using Taylor series expansions. The term $u_j^n$ is being approximated by:\n$$\n\\frac{1}{2}\\left(u(x_j+\\Delta x, t_n) + u(x_j-\\Delta x, t_n)\\right) \\approx \\frac{1}{2}\\left(u + u_x\\Delta x + \\frac{u_{xx}}{2}\\Delta x^2 + u - u_x\\Delta x + \\frac{u_{xx}}{2}\\Delta x^2 \\right) = u + \\frac{\\Delta x^2}{2}u_{xx}\n$$\nSubstituting this into the full scheme's Taylor expansion shows that the Lax-Friedrichs method is a consistent approximation not of the original PDE $u_t+a u_x=0$, but of the advection-diffusion equation:\n$$\nu_t + a u_x = \\frac{\\Delta x^2}{2\\Delta t} u_{xx}\n$$\nThe term on the right-hand side represents numerical diffusion with a diffusion coefficient $\\nu = \\frac{\\Delta x^2}{2\\Delta t}$. Diffusion equations are known to damp high-frequency modes more strongly than low-frequency modes. This artificial viscosity introduced by the averaging term is precisely what damps the high-frequency numerical errors that would otherwise grow and render the solution unstable. The amount of damping is given by $1 - |G|^2 = (1-\\lambda^2)\\sin^2(\\theta)$, which is maximized for modes with wavenumber $\\theta=\\pm\\pi/2$ (wavelength of $4\\Delta x$), a high-frequency component.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "Building upon the basics of stability analysis, we now turn to the more powerful and flexible Method of Lines (MOL) framework. In this approach, we first discretize in space to obtain a large system of ordinary differential equations (ODEs), which is then solved using a standard time integrator like a Runge-Kutta method. This practice challenges you to analyze the stability of such a combined scheme, requiring you to find the eigenvalues of the spatial operator and relate them to the stability region of the time integrator to derive a concrete stability constraint .",
            "id": "3394389",
            "problem": "Consider the linear advection equation $u_{t} + a\\,u_{x} = 0$ on a periodic domain, where $a \\in \\mathbb{R}\\setminus\\{0\\}$ is a constant advection speed. Let space be discretized on a uniform grid with spacing $\\Delta x$ using the standard second-order centered finite difference for the spatial derivative, and let time be advanced with the classical explicit $4$-stage, $4$-th order Runge–Kutta method (often denoted “classical RK$4$”). Assume that the initial data are sufficiently smooth and that periodic boundary conditions hold so that discrete Fourier analysis applies.\n\nStarting from first principles, use the definition of the discrete Fourier symbol of the centered finite difference operator and the definition of the absolute stability region of a Runge–Kutta method (the set of complex $z$ such that the method’s stability function $R(z)$ satisfies $|R(z)| \\leq 1$) to:\n\n- Derive the semi-discrete eigenvalues of the spatial operator as a function of the discrete Fourier wavenumber.\n- Derive the stability function $R(z)$ of the classical RK$4$ method without assuming any pre-tabulated formula for $R(z)$.\n- Determine the largest interval on the imaginary axis, $\\{ i y : |y| \\leq y_{\\star} \\}$, that is contained in the absolute stability region of the classical RK$4$ method by solving the exact boundary condition $|R(i y)| = 1$.\n- Use this to obtain the maximum allowable time step $\\Delta t_{\\max}$ ensuring linear stability of the fully discrete scheme for all resolvable Fourier modes on the grid.\n\nExpress your final answer as a closed-form symbolic expression in terms of $\\Delta x$ and $a$. Do not introduce any numerical approximations; no rounding is required. The final answer should be a single analytic expression for $\\Delta t_{\\max}$ (without units).",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. We proceed by following the steps outlined in the problem statement.\n\nThe governing partial differential equation is the linear advection equation, $u_{t} + a\\,u_{x} = 0$, which can be rewritten as $u_{t} = -a\\,u_{x}$. The spatial domain is periodic, and the advection speed $a$ is a non-zero real constant.\n\n**1. Semi-discrete Eigenvalue Analysis**\n\nThe spatial derivative $u_x$ is discretized using a standard second-order centered finite difference on a uniform grid with spacing $\\Delta x$. Let $U_j(t)$ be the numerical approximation of $u(x_j, t)$ at the grid point $x_j = j \\Delta x$. The semi-discrete equation is:\n$$ \\frac{dU_j}{dt} = -a \\frac{U_{j+1}(t) - U_{j-1}(t)}{2 \\Delta x} $$\nThis is a system of ordinary differential equations (ODEs), which can be written in vector form as $\\frac{d\\boldsymbol{U}}{dt} = L\\boldsymbol{U}$, where $L$ is the spatial discretization operator. To find the eigenvalues of $L$, we perform a discrete Fourier analysis by considering a single Fourier mode as the solution:\n$$ U_j(t) = \\hat{U}(t, k) \\exp(i k x_j) = \\hat{U}(t, k) \\exp(i k j \\Delta x) $$\nwhere $k$ is the wavenumber. Substituting this into the semi-discrete equation gives:\n$$ \\frac{d\\hat{U}}{dt} \\exp(i k j \\Delta x) = -a \\frac{\\hat{U} \\exp(i k (j+1) \\Delta x) - \\hat{U} \\exp(i k (j-1) \\Delta x)}{2 \\Delta x} $$\nDividing by $\\hat{U} \\exp(i k j \\Delta x)$ (assuming $\\hat{U} \\neq 0$):\n$$ \\frac{1}{\\hat{U}} \\frac{d\\hat{U}}{dt} = -a \\frac{\\exp(i k \\Delta x) - \\exp(-i k \\Delta x)}{2 \\Delta x} $$\nUsing Euler's formula, $\\exp(i\\theta) - \\exp(-i\\theta) = 2i\\sin(\\theta)$, we get:\n$$ \\frac{d\\hat{U}}{dt} = -a \\frac{2i \\sin(k \\Delta x)}{2 \\Delta x} \\hat{U} = \\left( -i \\frac{a}{\\Delta x} \\sin(k \\Delta x) \\right) \\hat{U} $$\nThis is a first-order ODE for the Fourier coefficient $\\hat{U}$, of the form $\\frac{d\\hat{U}}{dt} = \\lambda \\hat{U}$. The eigenvalues $\\lambda$ of the semi-discrete operator $L$ are therefore given by:\n$$ \\lambda(k) = -i \\frac{a}{\\Delta x} \\sin(k \\Delta x) $$\nLetting $\\xi = k \\Delta x$ be the scaled wavenumber, which for resolvable modes on the grid lies in the interval $[-\\pi, \\pi]$, the eigenvalues are:\n$$ \\lambda(\\xi) = -i \\frac{a}{\\Delta x} \\sin(\\xi), \\quad \\xi \\in [-\\pi, \\pi] $$\nThese eigenvalues are purely imaginary.\n\n**2. Stability Function of the Classical RK4 Method**\n\nThe classical $4$-stage, $4$-th order Runge-Kutta (RK$4$) method for solving the ODE $y' = f(y)$ is given by:\n\\begin{align*}\n k_1 = f(y_n) \\\\\n k_2 = f(y_n + \\frac{\\Delta t}{2} k_1) \\\\\n k_3 = f(y_n + \\frac{\\Delta t}{2} k_2) \\\\\n k_4 = f(y_n + \\Delta t k_3) \\\\\n y_{n+1} = y_n + \\frac{\\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n\\end{align*}\nTo find the stability function $R(z)$, we apply the method to the linear test equation $y' = \\lambda y$, for which $f(y)=\\lambda y$. Let $z = \\lambda \\Delta t$.\n\\begin{align*}\n k_1 = \\lambda y_n \\\\\n k_2 = \\lambda(y_n + \\frac{\\Delta t}{2} (\\lambda y_n)) = \\lambda y_n (1 + \\frac{z}{2}) \\\\\n k_3 = \\lambda(y_n + \\frac{\\Delta t}{2} k_2) = \\lambda(y_n + \\frac{\\Delta t}{2} \\lambda y_n(1+\\frac{z}{2})) = \\lambda y_n (1 + \\frac{z}{2} + \\frac{z^2}{4}) \\\\\n k_4 = \\lambda(y_n + \\Delta t k_3) = \\lambda(y_n + \\Delta t \\lambda y_n(1 + \\frac{z}{2} + \\frac{z^2}{4})) = \\lambda y_n (1 + z + \\frac{z^2}{2} + \\frac{z^3}{4})\n\\end{align*}\nSubstituting these into the update formula for $y_{n+1}$:\n$$ y_{n+1} = y_n + \\frac{\\Delta t}{6} \\left[ \\lambda y_n + 2\\lambda y_n(1+\\frac{z}{2}) + 2\\lambda y_n(1+\\frac{z}{2}+\\frac{z^2}{4}) + \\lambda y_n(1+z+\\frac{z^2}{2}+\\frac{z^3}{4}) \\right] $$\n$$ y_{n+1} = y_n \\left( 1 + \\frac{z}{6} \\left[ 1 + 2(1+\\frac{z}{2}) + 2(1+\\frac{z}{2}+\\frac{z^2}{4}) + (1+z+\\frac{z^2}{2}+\\frac{z^3}{4}) \\right] \\right) $$\nSimplifying the expression in the square brackets:\n$$ [\\dots] = 1 + (2+z) + (2+z+\\frac{z^2}{2}) + (1+z+\\frac{z^2}{2}+\\frac{z^3}{4}) = 6 + 3z + z^2 + \\frac{z^3}{4} $$\nThus,\n$$ y_{n+1} = y_n \\left( 1 + \\frac{z}{6} \\left( 6 + 3z + z^2 + \\frac{z^3}{4} \\right) \\right) = y_n \\left( 1 + z + \\frac{z^2}{2} + \\frac{z^3}{6} + \\frac{z^4}{24} \\right) $$\nThe stability function $R(z) = y_{n+1}/y_n$ is the Taylor series expansion of $\\exp(z)$ up to the term of order $4$:\n$$ R(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!} $$\n\n**3. Imaginary Axis Stability Interval**\n\nThe absolute stability region is the set of complex numbers $z$ for which $|R(z)| \\le 1$. We need to find the largest interval on the imaginary axis, $\\{iy : |y| \\le y_\\star\\}$, contained in this region. This requires finding the non-zero values of $y$ for which $|R(iy)| = 1$.\nLet $z = iy$. The stability function becomes:\n$$ R(iy) = 1 + iy + \\frac{(iy)^2}{2} + \\frac{(iy)^3}{6} + \\frac{(iy)^4}{24} = \\left(1 - \\frac{y^2}{2} + \\frac{y^4}{24}\\right) + i\\left(y - \\frac{y^3}{6}\\right) $$\nThe magnitude squared is:\n$$ |R(iy)|^2 = \\left(1 - \\frac{y^2}{2} + \\frac{y^4}{24}\\right)^2 + \\left(y - \\frac{y^3}{6}\\right)^2 $$\nExpanding the terms:\n$$ |R(iy)|^2 = \\left(1 - y^2 + \\frac{y^4}{4} + \\frac{y^4}{12} - \\frac{y^6}{24} + \\frac{y^8}{576}\\right) + \\left(y^2 - \\frac{y^4}{3} + \\frac{y^6}{36}\\right) $$\nCombining terms with like powers of $y$:\n$$ |R(iy)|^2 = 1 + y^4\\left(\\frac{1}{4} + \\frac{1}{12} - \\frac{1}{3}\\right) + y^6\\left(-\\frac{1}{24} + \\frac{1}{36}\\right) + \\frac{y^8}{576} $$\nThe coefficient of $y^4$ is $\\frac{3+1-4}{12} = 0$. The coefficient of $y^6$ is $\\frac{-3+2}{72} = -\\frac{1}{72}$.\nThe expression simplifies to:\n$$ |R(iy)|^2 = 1 - \\frac{y^6}{72} + \\frac{y^8}{576} $$\nSetting $|R(iy)|^2 = 1$ to find the boundary of the stability region:\n$$ 1 - \\frac{y^6}{72} + \\frac{y^8}{576} = 1 \\implies \\frac{y^8}{576} = \\frac{y^6}{72} $$\nFor non-zero $y$, we can divide by $y^6$:\n$$ y^2 = \\frac{576}{72} = 8 $$\nThe solutions are $y = \\pm\\sqrt{8} = \\pm 2\\sqrt{2}$. For $|y|  2\\sqrt{2}$, we have $y^2  8$, which makes $|R(iy)|^2 = 1 + \\frac{y^6}{576}(y^2 - 8)  1$. Thus, the stability interval along the imaginary axis is $[-i2\\sqrt{2}, i2\\sqrt{2}]$, and we have $y_\\star = 2\\sqrt{2}$.\n\n**4. Maximum Allowable Time Step**\n\nFor the fully discrete scheme to be stable, the quantity $z = \\lambda \\Delta t$ must lie within the absolute stability region of the RK$4$ method for all eigenvalues $\\lambda$ of the semi-discrete operator.\n$$ z(\\xi) = \\lambda(\\xi) \\Delta t = -i \\frac{a \\Delta t}{\\Delta x} \\sin(\\xi) $$\nSince these values are purely imaginary, the stability condition requires that they lie within the imaginary stability interval we just found:\n$$ |z(\\xi)| \\le y_\\star \\quad \\forall \\xi \\in [-\\pi, \\pi] $$\n$$ \\left| -i \\frac{a \\Delta t}{\\Delta x} \\sin(\\xi) \\right| \\le 2\\sqrt{2} $$\n$$ \\frac{|a| \\Delta t}{\\Delta x} |\\sin(\\xi)| \\le 2\\sqrt{2} $$\nThis inequality must hold for all supported wavenumbers, so we must consider the \"worst case\" where $|\\sin(\\xi)|$ is maximized. Over the interval $\\xi \\in [-\\pi, \\pi]$, the maximum value of $|\\sin(\\xi)|$ is $1$ (occurring at $\\xi = \\pm \\pi/2$).\nTherefore, the stability condition becomes:\n$$ \\frac{|a| \\Delta t}{\\Delta x} \\cdot 1 \\le 2\\sqrt{2} $$\nSolving for the time step $\\Delta t$:\n$$ \\Delta t \\le \\frac{2\\sqrt{2} \\Delta x}{|a|} $$\nThe maximum allowable time step $\\Delta t_{\\max}$ is the upper bound of this inequality.\n$$ \\Delta t_{\\max} = \\frac{2\\sqrt{2} \\Delta x}{|a|} $$\nThis is the Courant-Friedrichs-Lewy (CFL) condition for this specific numerical scheme.",
            "answer": "$$\\boxed{\\frac{2\\sqrt{2} \\Delta x}{|a|}}$$"
        },
        {
            "introduction": "Beyond stability, a critical property for numerical methods is the conservation of physical quantities like mass, momentum, or energy. This exercise shifts focus to the principle of discrete conservation, contrasting two different families of methods. You will explore why finite volume methods written in a flux-difference form are inherently conservative, whereas pointwise methods like the semi-Lagrangian scheme are not, and then devise a correction to enforce this vital property .",
            "id": "3394397",
            "problem": "Consider the linear advection equation $u_{t} + a\\,u_{x} = 0$ on the periodic domain $x \\in [0,L]$ with constant velocity $a \\neq 0$. Let the domain be partitioned into $N$ uniform control volumes (cells) of width $\\Delta x = L/N$ and centers $\\{x_{i}\\}_{i=1}^{N}$. Denote by $u_{i}^{n}$ the cell average of $u(x,t)$ over cell $i$ at time $t^{n}$, and define the discrete total mass at time $t^{n}$ as $M^{n} = \\Delta x \\sum_{i=1}^{N} u_{i}^{n}$.\n\n1) Starting from the integral conservation law for a control volume and periodic boundary conditions, explain why any consistent finite volume (FV) discretization written in flux-difference form must conserve the discrete total mass $M^{n}$ exactly. In particular, argue that the standard upwind FV method (with numerical flux chosen consistently with the sign of $a$) preserves $M^{n}$ for all $n$.\n\n2) Consider a semi-Lagrangian (SL) update that computes provisional values $\\tilde{u}_{i}^{n+1}$ at cell centers by tracing characteristics backward from $x_{i}$ to departure points $x_{i}^{\\mathrm{d}} = x_{i} - a\\,\\Delta t$ and interpolating $u(\\cdot,t^{n})$ from the known discrete data. Using the conservation law as the fundamental base, explain why such a pointwise interpolation-based SL step generally fails to conserve the discrete total mass $\\tilde{M}^{n+1} = \\Delta x \\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1}$, even when the underlying continuous equation conserves the true mass.\n\n3) To enforce exact discrete mass conservation while retaining the SL transport step, propose a single global multiplicative correction applied uniformly to all cells, $\\alpha \\in \\mathbb{R}$, such that the corrected update $u_{i}^{n+1} = \\alpha\\,\\tilde{u}_{i}^{n+1}$ satisfies $M^{n+1} = M^{n}$ on the periodic mesh. Derive the closed-form expression for $\\alpha$ in terms of $\\{u_{i}^{n}\\}_{i=1}^{N}$ and $\\{\\tilde{u}_{i}^{n+1}\\}_{i=1}^{N}$.\n\nYour final answer must be the expression for the scalar $\\alpha$ only, written in closed form. Do not include any additional commentary. If you choose to simplify by canceling common factors, do so explicitly. No rounding is required, and no units are needed.",
            "solution": "The problem is divided into three parts. We will address each sequentially.\n\n1) Let's analyze the conservation property of finite volume (FV) methods in flux-difference form.\nThe linear advection equation is $u_t + a u_x = 0$. Since $a$ is a constant, this equation is already in conservation form, $u_t + F(u)_x=0$, with a linear flux function $F(u) = au$. The integral form of this conservation law over a control volume $C_i = [x_{i-1/2}, x_{i+1/2}]$ is obtained by integrating the PDE with respect to $x$:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} u_t(x,t) \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} (au(x,t))_x \\,dx = 0 $$\nUsing the Leibniz integral rule for the first term and the Fundamental Theorem of Calculus for the second, we get:\n$$ \\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx + au(x_{i+1/2},t) - au(x_{i-1/2},t) = 0 $$\nWe define the cell average of $u$ over cell $i$ as $u_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx$. Substituting this definition, the equation becomes a semi-discrete ordinary differential equation for the cell average $u_i(t)$:\n$$ \\Delta x \\frac{du_i(t)}{dt} + F(u(x_{i+1/2},t)) - F(u(x_{i-1/2},t)) = 0 $$\nA finite volume method discretizes this by replacing the exact fluxes at the cell interfaces, $F(u(x_{i\\pm 1/2},t))$, with a numerical flux function, $\\hat{F}_{i\\pm 1/2}$, which depends on the state of the solution in neighboring cells. Applying a forward Euler time-stepping scheme for simplicity, we get the fully discrete update:\n$$ \\frac{u_i^{n+1} - u_i^n}{\\Delta t} + \\frac{\\hat{F}_{i+1/2}^n - \\hat{F}_{i-1/2}^n}{\\Delta x} = 0 $$\nThis can be rearranged into the so-called flux-difference form:\n$$ u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} (\\hat{F}_{i+1/2}^n - \\hat{F}_{i-1/2}^n) $$\nTo check for a conserved quantity, we sum this update rule over all $N$ cells in the domain:\n$$ \\sum_{i=1}^{N} u_i^{n+1} = \\sum_{i=1}^{N} u_i^n - \\frac{\\Delta t}{\\Delta x} \\sum_{i=1}^{N} (\\hat{F}_{i+1/2}^n - \\hat{F}_{i-1/2}^n) $$\nThe second term on the right-hand side is a telescoping sum:\n$$ \\sum_{i=1}^{N} (\\hat{F}_{i+1/2}^n - \\hat{F}_{i-1/2}^n) = (\\hat{F}_{3/2}^n - \\hat{F}_{1/2}^n) + (\\hat{F}_{5/2}^n - \\hat{F}_{3/2}^n) + \\dots + (\\hat{F}_{N-1/2}^n - \\hat{F}_{N-3/2}^n) + (\\hat{F}_{N+1/2}^n - \\hat{F}_{N-1/2}^n) = \\hat{F}_{N+1/2}^n - \\hat{F}_{1/2}^n $$\nThe problem specifies periodic boundary conditions on the domain $x \\in [0, L]$. This means that cell $N$ is adjacent to cell $1$. The interface at $x_{N+1/2}$ is identified with the interface at $x_{1/2}$. Consequently, the numerical flux, which depends on the local data, must be periodic as well: $\\hat{F}_{N+1/2}^n = \\hat{F}_{1/2}^n$. This causes the telescoping sum to be exactly zero:\n$$ \\sum_{i=1}^{N} (\\hat{F}_{i+1/2}^n - \\hat{F}_{i-1/2}^n) = 0 $$\nTherefore, the sum of the cell averages is conserved:\n$$ \\sum_{i=1}^{N} u_i^{n+1} = \\sum_{i=1}^{N} u_i^n $$\nMultiplying by the constant cell width $\\Delta x$, we prove that the discrete total mass $M^n = \\Delta x \\sum_{i=1}^{N} u_i^n$ is exactly conserved for any time step $n$:\n$$ M^{n+1} = M^n $$\nThis argument holds for any consistent finite volume method written in flux-difference form, as it only relies on the algebraic structure of the update and the periodicity of the domain. The standard upwind FV method is a specific instance of such a scheme. Its numerical flux is defined as $\\hat{F}_{i+1/2} = a u_i$ if $a0$, and $\\hat{F}_{i+1/2} = a u_{i+1}$ if $a0$. Since this fits the flux-difference form, the upwind method conserves the discrete total mass $M^n$ exactly.\n\n2) Now we consider a semi-Lagrangian (SL) method and its conservation properties. The SL method is based on the method of characteristics. The exact solution to $u_t + a u_x = 0$ is $u(x,t) = u_0(x-at)$, which means the solution is constant along characteristic curves $x - at = \\text{constant}$. This leads to the update rule $u(x_i, t^{n+1}) = u(x_i - a\\Delta t, t^n)$. The point $x_i^{\\mathrm{d}} = x_i - a\\Delta t$ is the departure point.\nIn a numerical implementation, we only have discrete cell-average data $\\{u_j^n\\}$ at time $t^n$. The SL scheme approximates the value at the departure point by first reconstructing a continuous profile from $\\{u_j^n\\}$ and then evaluating (interpolating) it at $x_i^{\\mathrm{d}}$. Let's denote the interpolation operator by $\\mathcal{I}$, so the provisional update is:\n$$ \\tilde{u}_i^{n+1} = \\mathcal{I}[\\{u_j^n\\}](x_i^{\\mathrm{d}}) $$\nThe total mass of these provisional values is $\\tilde{M}^{n+1} = \\Delta x \\sum_{i=1}^{N} \\tilde{u}_i^{n+1}$.\nThe fundamental reason for the failure to conserve mass lies in the mismatch between the integral nature of a conservation law and the pointwise nature of the SL update.\nThe discrete mass at time $t^n$, $M^n = \\Delta x \\sum_i u_i^n$, represents a numerical quadrature of the total integral $\\int_0^L u(x,t^n)\\,dx$. The scheme is conservative if $\\tilde{M}^{n+1} = M^n$. This requires $\\sum_i \\tilde{u}_i^{n+1} = \\sum_i u_i^n$.\nThe SL update calculates $\\sum_i \\tilde{u}_i^{n+1}$ by summing a set of interpolated point values. An interpolation, such as linear or cubic, computes each $\\tilde{u}_i^{n+1}$ as a linear combination of a few neighboring values $\\{u_j^n\\}$. The sum $\\sum_i \\tilde{u}_i^{n+1}$ is therefore a grand linear combination of all $\\{u_j^n\\}$. For conservation, the sum of the coefficients for each $u_j^n$ in this grand sum must be exactly $1$.\nThis is generally not the case. The interpolation process does not inherently respect the integral property of the data. For instance, a common mistake is to treat the cell-average data $u_j^n$ as point values $u(x_j,t^n)$ for the purpose of interpolation, which is an inconsistent approximation. Even with more sophisticated reconstruction methods that preserve cell averages, the sum of point values sampled at a shifted set of points $\\{x_i^\\mathrm{d}\\}$ does not generally equal the sum of the original cell-averages.\nIn short, the SL method is not formulated as a balance of fluxes. It bypasses the algebraic structure (the telescoping sum of fluxes) that guarantees exact conservation in FV methods. As a result, there is no built-in mechanism to ensure that $\\sum_i \\tilde{u}_i^{n+1} = \\sum_i u_i^n$, and thus the discrete mass is not conserved.\n\n3) We are asked to derive a global multiplicative correction factor $\\alpha$ to enforce mass conservation.\nThe uncorrected, provisional update from the SL step gives values $\\{\\tilde{u}_i^{n+1}\\}_{i=1}^N$. The corresponding uncorrected discrete total mass is:\n$$ \\tilde{M}^{n+1} = \\Delta x \\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1} $$\nWe want to find a single scalar $\\alpha$ to define a corrected update $u_i^{n+1} = \\alpha \\tilde{u}_i^{n+1}$ for all $i \\in \\{1, \\dots, N\\}$. The correction must be such that the new discrete total mass, $M^{n+1}$, is equal to the mass at the previous step, $M^n$.\nThe corrected mass at time $t^{n+1}$ is:\n$$ M^{n+1} = \\Delta x \\sum_{i=1}^{N} u_{i}^{n+1} $$\nSubstituting the proposed correction:\n$$ M^{n+1} = \\Delta x \\sum_{i=1}^{N} (\\alpha\\,\\tilde{u}_{i}^{n+1}) $$\nSince $\\alpha$ is a global constant, it can be factored out of the summation:\n$$ M^{n+1} = \\alpha \\left( \\Delta x \\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1} \\right) = \\alpha \\tilde{M}^{n+1} $$\nThe conservation constraint is $M^{n+1} = M^n$. Therefore, we must have:\n$$ M^n = \\alpha \\tilde{M}^{n+1} $$\nSolving for $\\alpha$, assuming $\\tilde{M}^{n+1} \\neq 0$:\n$$ \\alpha = \\frac{M^n}{\\tilde{M}^{n+1}} $$\nNow, we substitute the definitions of $M^n$ and $\\tilde{M}^{n+1}$ in terms of the cell-average values:\n$$ M^n = \\Delta x \\sum_{i=1}^{N} u_{i}^{n} $$\n$$ \\tilde{M}^{n+1} = \\Delta x \\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1} $$\nThe expression for $\\alpha$ becomes:\n$$ \\alpha = \\frac{\\Delta x \\sum_{i=1}^{N} u_{i}^{n}}{\\Delta x \\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1}} $$\nThe factor $\\Delta x$ appears in both the numerator and the denominator, so it can be canceled. This yields the final closed-form expression for the correction factor $\\alpha$:\n$$ \\alpha = \\frac{\\sum_{i=1}^{N} u_{i}^{n}}{\\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1}} $$\nThis factor is the ratio of the total mass (up to a factor of $\\Delta x$) before the time step to the total mass produced by the non-conservative SL update. Applying it uniformly scales the provisional solution to restore the correct total mass.",
            "answer": "$$\n\\boxed{\\frac{\\sum_{i=1}^{N} u_{i}^{n}}{\\sum_{i=1}^{N} \\tilde{u}_{i}^{n+1}}}\n$$"
        }
    ]
}