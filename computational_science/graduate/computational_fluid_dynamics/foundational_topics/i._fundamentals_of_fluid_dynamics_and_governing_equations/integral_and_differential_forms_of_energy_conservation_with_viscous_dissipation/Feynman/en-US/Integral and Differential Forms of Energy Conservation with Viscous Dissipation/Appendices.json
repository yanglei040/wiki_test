{
    "hands_on_practices": [
        {
            "introduction": "To master the energy conservation principle in fluid dynamics, we must first understand its constituent parts. This initial practice focuses on the viscous dissipation function, $\\Phi$, which represents the irreversible rate at which mechanical energy is converted into internal energy due to viscous stresses. By deriving $\\Phi$ from first principles and applying it to two canonical flows—an incompressible shear flow and a compressible dilatational flow—you will develop a concrete understanding of how different modes of fluid deformation generate heat . This exercise solidifies the physical meaning and mathematical structure of a term that is central to thermal analysis in viscous flows.",
            "id": "3335382",
            "problem": "A Newtonian fluid with constant shear viscosity $\\mu$ and constant bulk viscosity $\\lambda$ occupies a region in three-dimensional space. Consider two canonical steady flows frequently used in computational fluid dynamics: (i) plane Couette flow between two very large, parallel plates separated by a gap $H$, where the top plate translates uniformly with speed $U$ in the $x$-direction while the bottom plate is stationary, inducing a linear velocity field $u(y)=Uy/H$, $v=0$, $w=0$; and (ii) uniform isotropic dilation characterized by $u=\\alpha x$, $v=\\alpha y$, $w=\\alpha z$, where $\\alpha$ is a constant dilation rate.\n\nStarting from the first law of thermodynamics applied to a fixed control volume and the Cauchy momentum equation, and using the linear Newtonian constitutive relation for the viscous Cauchy stress tensor with shear viscosity $\\mu$ and bulk viscosity $\\lambda$, derive the local form of the viscous dissipation per unit volume, denoted $\\Phi$, in terms of the velocity gradient. Then, evaluate $\\Phi$ for both flows described above. Finally, form the ratio of their magnitudes.\n\nAssumptions and instructions:\n- Treat the fluid as continuum, Newtonian, with constant $\\mu$ and $\\lambda$, and ignore body forces and volumetric heating.\n- You may assume that the heat flux enters only through the standard Fourier law, but you should not assume any special heat transfer simplifications beyond what is necessary to identify the viscous dissipation contribution.\n- Express the final $\\Phi$ values as analytic expressions in terms of $\\mu$, $\\lambda$, $U$, $H$, and $\\alpha$. Report the ratio as a single analytic expression in these parameters.\n- Interpret $\\Phi$ as a pointwise quantity with physical units of watts per cubic meter. You do not need to supply any numerical values.\n- Provide your final answer as a single row vector containing, in order, the three analytic expressions: the $\\Phi$ for plane Couette flow, the $\\Phi$ for uniform dilation, and the ratio of the dilation $\\Phi$ to the Couette $\\Phi$. No rounding is required.",
            "solution": "The user wants me to solve the following problem:\nA Newtonian fluid with constant shear viscosity $\\mu$ and constant bulk viscosity $\\lambda$ occupies a region in three-dimensional space. Consider two canonical steady flows frequently used in computational fluid dynamics (Computational Fluid Dynamics): (i) plane Couette flow between two very large, parallel plates separated by a gap $H$, where the top plate translates uniformly with speed $U$ in the $x$-direction while the bottom plate is stationary, inducing a linear velocity field $u(y)=Uy/H$, $v=0$, $w=0$; and (ii) uniform isotropic dilation characterized by $u=\\alpha x$, $v=\\alpha y$, $w=\\alpha z$, where $\\alpha$ is a constant dilation rate.\n\nStarting from the first law of thermodynamics applied to a fixed control volume and the Cauchy momentum equation, and using the linear Newtonian constitutive relation for the viscous Cauchy stress tensor with shear viscosity $\\mu$ and bulk viscosity $\\lambda$, derive the local form of the viscous dissipation per unit volume, denoted $\\Phi$, in terms of the velocity gradient. Then, evaluate $\\Phi$ for both flows described above. Finally, form the ratio of their magnitudes.\n\nAssumptions and instructions:\n- Treat the fluid as continuum, Newtonian, with constant $\\mu$ and $\\lambda$, and ignore body forces and volumetric heating.\n- You may assume that the heat flux enters only through the standard Fourier law, but you should not assume any special heat transfer simplifications beyond what is necessary to identify the viscous dissipation contribution.\n- Express the final $\\Phi$ values as analytic expressions in terms of $\\mu$, $\\lambda$, $U$, $H$, and $\\alpha$. Report the ratio as a single analytic expression in these parameters.\n- Interpret $\\Phi$ as a pointwise quantity with physical units of watts per cubic meter. You do not need to supply any numerical values.\n- Provide your final answer as a single row vector containing, in order, the three analytic expressions: the $\\Phi$ for plane Couette flow, the $\\Phi$ for uniform dilation, and the ratio of the dilation $\\Phi$ to the Couette $\\Phi$. No rounding is required.\n\n### Step 1: Extract Givens\n- **Fluid Properties**: Newtonian fluid, constant shear viscosity $\\mu$, constant bulk viscosity $\\lambda$.\n- **Flow (i) - Plane Couette**: Velocity field $\\mathbf{u} = (u, v, w)$ given by $u(y) = \\frac{Uy}{H}$, $v=0$, $w=0$. The plates are separated by a distance $H$, and the top plate moves with speed $U$.\n- **Flow (ii) - Uniform Isotropic Dilation**: Velocity field $\\mathbf{u} = (u, v, w)$ given by $u = \\alpha x$, $v = \\alpha y$, $w = \\alpha z$. The dilation rate is $\\alpha$.\n- **Governing Principles**: First law of thermodynamics, Cauchy momentum equation, linear Newtonian constitutive relation.\n- **Assumptions**: Continuum model, body forces are ignored, volumetric heating is ignored.\n- **Task**:\n  1. Derive the viscous dissipation per unit volume, $\\Phi$.\n  2. Evaluate $\\Phi$ for plane Couette flow, $\\Phi_{\\text{Couette}}$.\n  3. Evaluate $\\Phi$ for uniform isotropic dilation, $\\Phi_{\\text{dilation}}$.\n  4. Compute the ratio $\\frac{\\Phi_{\\text{dilation}}}{\\Phi_{\\text{Couette}}}$.\n- **Output Format**: Final answer as a single row vector with the three analytic expressions.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, objective, and self-contained.\n- **Scientific Soundness**: The problem statement is based on fundamental principles of continuum mechanics and fluid dynamics (first law of thermodynamics, Cauchy momentum equation, Newtonian constitutive model). The two flow fields described are classical, exact solutions or theoretical models used widely in the field. There are no violations of scientific principles.\n- **Well-Posedness**: The problem is clearly defined and provides all necessary information to derive the required quantities. The derivation of the viscous dissipation function is a standard textbook procedure, and its application to the given velocity fields leads to unique, meaningful results.\n- **Objectivity**: The problem is stated in precise, mathematical language. It contains no subjective or opinion-based statements.\n- **Completeness**: All required constants ($\\mu$, $\\lambda$, $U$, $H$, $\\alpha$) and velocity fields are explicitly defined. The assumptions (no body forces, etc.) are clearly listed. The problem is not underspecified or overconstrained.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A complete, reasoned solution will be provided.\n\n**Derivation of the Viscous Dissipation Function $\\Phi$**\n\nThe derivation starts from the local (differential) form of the first law of thermodynamics for the total energy per unit mass, $E = e + \\frac{1}{2} |\\mathbf{u}|^2$, where $e$ is the internal energy per unit mass and $\\mathbf{u}$ is the velocity vector. For a continuum, the evolution of the total energy density $\\rho E$ is given by:\n$$ \\frac{\\partial (\\rho E)}{\\partial t} + \\nabla \\cdot (\\rho E \\mathbf{u}) = -\\nabla \\cdot \\mathbf{q} + \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\mathbf{u}) + \\rho \\mathbf{f} \\cdot \\mathbf{u} + \\rho \\dot{q}_{vol} $$\nwhere $\\rho$ is the density, $\\mathbf{q}$ is the heat flux vector, $\\boldsymbol{\\sigma}$ is the Cauchy stress tensor, $\\mathbf{f}$ is the body force per unit mass, and $\\dot{q}_{vol}$ is any volumetric heat source per unit mass. The problem states to ignore body forces ($\\mathbf{f}=0$) and volumetric heating ($\\dot{q}_{vol}=0$). Using the continuity equation, $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u})=0$, the energy equation can be written in terms of the material derivative $D/Dt = \\partial/\\partial t + \\mathbf{u} \\cdot \\nabla$ as:\n$$ \\rho \\frac{DE}{Dt} = -\\nabla \\cdot \\mathbf{q} + \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\mathbf{u}) $$\nTo isolate the internal energy, we subtract the equation for the rate of change of kinetic energy. The Cauchy momentum equation with no body forces is $\\rho \\frac{D\\mathbf{u}}{Dt} = \\nabla \\cdot \\boldsymbol{\\sigma}$. Taking the dot product with $\\mathbf{u}$ gives the kinetic energy equation:\n$$ \\rho \\frac{D}{Dt}\\left(\\frac{1}{2} |\\mathbf{u}|^2 \\right) = \\mathbf{u} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma}) $$\nSubtracting the kinetic energy equation from the total energy equation gives the internal energy equation:\n$$ \\rho \\frac{De}{Dt} = \\rho \\frac{DE}{Dt} - \\rho \\frac{D}{Dt}\\left(\\frac{1}{2} |\\mathbf{u}|^2 \\right) = \\left[-\\nabla \\cdot \\mathbf{q} + \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\mathbf{u})\\right] - \\left[\\mathbf{u} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma})\\right] $$\nUsing the identity for the divergence of a tensor-vector product, $\\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\mathbf{u}) = (\\nabla \\cdot \\boldsymbol{\\sigma}) \\cdot \\mathbf{u} + \\boldsymbol{\\sigma} : \\nabla\\mathbf{u}$, the equation simplifies to:\n$$ \\rho \\frac{De}{Dt} = -\\nabla \\cdot \\mathbf{q} + \\boldsymbol{\\sigma} : \\nabla\\mathbf{u} $$\nThe term $\\boldsymbol{\\sigma} : \\nabla\\mathbf{u}$ represents the rate of work done by stresses on the fluid element per unit volume. For a Newtonian fluid, the Cauchy stress tensor is given by $\\boldsymbol{\\sigma} = -p\\mathbf{I} + \\boldsymbol{\\tau}$, where $p$ is the thermodynamic pressure, $\\mathbf{I}$ is the identity tensor, and $\\boldsymbol{\\tau}$ is the viscous stress tensor. Substituting this into the work term:\n$$ \\boldsymbol{\\sigma} : \\nabla\\mathbf{u} = (-p\\mathbf{I} + \\boldsymbol{\\tau}) : \\nabla\\mathbf{u} = -p(\\mathbf{I} : \\nabla\\mathbf{u}) + \\boldsymbol{\\tau} : \\nabla\\mathbf{u} = -p(\\nabla \\cdot \\mathbf{u}) + \\boldsymbol{\\tau} : \\nabla\\mathbf{u} $$\nThe term $-p(\\nabla \\cdot \\mathbf{u})$ is the reversible work of compression. The term $\\boldsymbol{\\tau} : \\nabla\\mathbf{u}$ is the irreversible rate at which mechanical energy is converted into internal energy by viscous action. This is the viscous dissipation function per unit volume, $\\Phi$.\n$$ \\Phi = \\boldsymbol{\\tau} : \\nabla\\mathbf{u} $$\nThe constitutive relation for the viscous stress tensor $\\boldsymbol{\\tau}$ for a linear Newtonian fluid is:\n$$ \\boldsymbol{\\tau} = 2\\mu\\mathbf{S} + \\lambda (\\nabla \\cdot \\mathbf{u}) \\mathbf{I} $$\nwhere $\\mu$ is the shear viscosity, $\\lambda$ is the bulk viscosity, and $\\mathbf{S}$ is the symmetric rate-of-strain tensor:\n$$ \\mathbf{S} = \\frac{1}{2}\\left(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T\\right) $$\nSubstituting the constitutive relation for $\\boldsymbol{\\tau}$ into the expression for $\\Phi$:\n$$ \\Phi = \\left(2\\mu\\mathbf{S} + \\lambda (\\nabla \\cdot \\mathbf{u}) \\mathbf{I}\\right) : \\nabla\\mathbf{u} = 2\\mu(\\mathbf{S} : \\nabla\\mathbf{u}) + \\lambda(\\nabla \\cdot \\mathbf{u})(\\mathbf{I} : \\nabla\\mathbf{u}) $$\nThe velocity gradient tensor can be decomposed as $\\nabla\\mathbf{u} = \\mathbf{S} + \\mathbf{A}$, where $\\mathbf{A}$ is the anti-symmetric spin tensor. The double dot product of a symmetric tensor ($\\mathbf{S}$) with an anti-symmetric tensor ($\\mathbf{A}$) is zero, so $\\mathbf{S} : \\mathbf{A} = 0$. Thus, $\\mathbf{S} : \\nabla\\mathbf{u} = \\mathbf{S} : (\\mathbf{S} + \\mathbf{A}) = \\mathbf{S} : \\mathbf{S}$. Also, $\\mathbf{I} : \\nabla\\mathbf{u} = \\text{tr}(\\nabla\\mathbf{u}) = \\nabla \\cdot \\mathbf{u}$. The general expression for viscous dissipation is therefore:\n$$ \\Phi = 2\\mu(\\mathbf{S} : \\mathbf{S}) + \\lambda (\\nabla \\cdot \\mathbf{u})^2 $$\n\n**Evaluation for Plane Couette Flow**\n\nThe velocity field is $\\mathbf{u} = (\\frac{Uy}{H}, 0, 0)$. The velocity gradient tensor $\\nabla\\mathbf{u}$ is:\n$$ \\nabla\\mathbf{u} = \\begin{pmatrix} \\frac{\\partial u}{\\partial x} & \\frac{\\partial u}{\\partial y} & \\frac{\\partial u}{\\partial z} \\\\ \\frac{\\partial v}{\\partial x} & \\frac{\\partial v}{\\partial y} & \\frac{\\partial v}{\\partial z} \\\\ \\frac{\\partial w}{\\partial x} & \\frac{\\partial w}{\\partial y} & \\frac{\\partial w}{\\partial z} \\end{pmatrix} = \\begin{pmatrix} 0 & \\frac{U}{H} & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} $$\nThe divergence of the velocity field is $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0$. The flow is incompressible.\nThe rate-of-strain tensor $\\mathbf{S}$ is:\n$$ \\mathbf{S} = \\frac{1}{2}\\left(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T\\right) = \\frac{1}{2} \\left[ \\begin{pmatrix} 0 & \\frac{U}{H} & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} + \\begin{pmatrix} 0 & 0 & 0 \\\\ \\frac{U}{H} & 0 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} \\right] = \\begin{pmatrix} 0 & \\frac{U}{2H} & 0 \\\\ \\frac{U}{2H} & 0 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} $$\nThe term $\\mathbf{S}:\\mathbf{S}$ is the sum of the squares of the components of $\\mathbf{S}$:\n$$ \\mathbf{S}:\\mathbf{S} = \\sum_{i,j} S_{ij}^2 = \\left(\\frac{U}{2H}\\right)^2 + \\left(\\frac{U}{2H}\\right)^2 = 2\\frac{U^2}{4H^2} = \\frac{U^2}{2H^2} $$\nThe viscous dissipation for Couette flow, $\\Phi_{\\text{Couette}}$, is:\n$$ \\Phi_{\\text{Couette}} = 2\\mu\\left(\\frac{U^2}{2H^2}\\right) + \\lambda(0)^2 = \\mu \\frac{U^2}{H^2} $$\n\n**Evaluation for Uniform Isotropic Dilation**\n\nThe velocity field is $\\mathbf{u} = (\\alpha x, \\alpha y, \\alpha z)$. The velocity gradient tensor $\\nabla\\mathbf{u}$ is:\n$$ \\nabla\\mathbf{u} = \\begin{pmatrix} \\alpha & 0 & 0 \\\\ 0 & \\alpha & 0 \\\\ 0 & 0 & \\alpha \\end{pmatrix} = \\alpha\\mathbf{I} $$\nThe divergence of the velocity field is $\\nabla \\cdot \\mathbf{u} = \\text{tr}(\\alpha\\mathbf{I}) = 3\\alpha$.\nThe rate-of-strain tensor $\\mathbf{S}$ is:\n$$ \\mathbf{S} = \\frac{1}{2}\\left(\\alpha\\mathbf{I} + (\\alpha\\mathbf{I})^T\\right) = \\frac{1}{2}(\\alpha\\mathbf{I} + \\alpha\\mathbf{I}) = \\alpha\\mathbf{I} $$\nThe term $\\mathbf{S}:\\mathbf{S}$ is:\n$$ \\mathbf{S}:\\mathbf{S} = (\\alpha\\mathbf{I}) : (\\alpha\\mathbf{I}) = \\alpha^2 (\\mathbf{I}:\\mathbf{I}) = \\alpha^2 \\sum_{i,j} \\delta_{ij}\\delta_{ij} = \\alpha^2(1^2+1^2+1^2) = 3\\alpha^2 $$\nThe viscous dissipation for uniform dilation, $\\Phi_{\\text{dilation}}$, is:\n$$ \\Phi_{\\text{dilation}} = 2\\mu(3\\alpha^2) + \\lambda(3\\alpha)^2 = 6\\mu\\alpha^2 + 9\\lambda\\alpha^2 = (6\\mu + 9\\lambda)\\alpha^2 $$\n\n**Ratio of Magnitudes**\n\nThe ratio of the viscous dissipation for dilation to that for Couette flow is:\n$$ \\frac{\\Phi_{\\text{dilation}}}{\\Phi_{\\text{Couette}}} = \\frac{(6\\mu + 9\\lambda)\\alpha^2}{\\mu \\frac{U^2}{H^2}} = \\frac{(6\\mu + 9\\lambda)\\alpha^2 H^2}{\\mu U^2} $$\nThe final results are the expressions for $\\Phi_{\\text{Couette}}$, $\\Phi_{\\text{dilation}}$, and their ratio.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\mu \\frac{U^2}{H^2} & (6\\mu + 9\\lambda)\\alpha^2 & \\frac{(6\\mu + 9\\lambda)\\alpha^2 H^2}{\\mu U^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having isolated the viscous dissipation term, we now place it within the context of the full internal energy equation. This exercise introduces the Method of Manufactured Solutions (MMS), a cornerstone of verification in computational fluid dynamics. You will start with prescribed velocity and temperature fields and work backwards to compute the source term, $S(x,y)$, required to perfectly satisfy the governing equation . This process forces a meticulous evaluation of every term—convection, heat conduction, and viscous dissipation—providing invaluable hands-on experience in manipulating the differential energy balance, a critical skill for developing and debugging CFD codes.",
            "id": "3335339",
            "problem": "Consider a two-dimensional, steady, incompressible, Newtonian fluid in the context of Computational Fluid Dynamics (CFD), with constant density $\\rho$, dynamic viscosity $\\mu$, thermal conductivity $k$, and specific heat at constant volume $c_v$. Let the velocity and temperature fields be prescribed by\n$$\n\\mathbf{u}(x,y) = \\begin{pmatrix} \\gamma\\, y \\\\ 0 \\end{pmatrix}, \\qquad T(x,y) = T_0 + a\\,x^2 + b\\,y^2,\n$$\nwhere $T_0$, $a$, $b$, and $\\gamma$ are given constants. Starting from the first law of thermodynamics for a continuum in integral form and using the standard constitutive relations for Fourier heat conduction $\\mathbf{q} = -k\\,\\nabla T$ and a Newtonian stress with Stokes hypothesis $\\boldsymbol{\\tau} = 2\\,\\mu\\,\\mathbf{E}$, where $\\mathbf{E}$ is the symmetric rate-of-strain tensor, derive the differential internal energy balance with viscous dissipation for this flow. Then, determine the volumetric internal energy source term per unit volume, $S(x,y)$, required so that the internal energy equation is satisfied exactly, pointwise, for the specified fields. Express your final answer as a single closed-form analytical expression in terms of $x$, $y$, and the constants $\\rho$, $\\mu$, $k$, $c_v$, $\\gamma$, $a$, and $b$. No numerical substitution is required, and no rounding is needed. Do not include units in your final expression.",
            "solution": "The problem is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Flow conditions**: Two-dimensional ($2$D), steady, incompressible, Newtonian fluid.\n- **Physical constants**: Density $\\rho$, dynamic viscosity $\\mu$, thermal conductivity $k$, specific heat at constant volume $c_v$.\n- **Field constants**: $T_0$, $a$, $b$, $\\gamma$.\n- **Velocity field**: $\\mathbf{u}(x,y) = \\begin{pmatrix} \\gamma y \\\\ 0 \\end{pmatrix}$.\n- **Temperature field**: $T(x,y) = T_0 + ax^2 + by^2$.\n- **Constitutive relations**:\n  - Heat flux (Fourier's Law): $\\mathbf{q} = -k \\nabla T$.\n  - Viscous stress tensor (Newtonian fluid): $\\boldsymbol{\\tau} = 2 \\mu \\mathbf{E}$, where $\\mathbf{E}$ is the symmetric rate-of-strain tensor, $\\mathbf{E} = \\frac{1}{2}(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined within the framework of continuum mechanics and computational fluid dynamics.\n- **Scientifically Grounded**: The problem uses the standard conservation laws (first law of thermodynamics) and constitutive relations (Newtonian fluid, Fourier's law) that are fundamental to fluid dynamics and heat transfer. The specified velocity field, $\\mathbf{u} = (\\gamma y, 0)$, represents a simple shear flow, which is a classic, physically relevant model. The condition $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial(\\gamma y)}{\\partial x} + \\frac{\\partial(0)}{\\partial y} = 0$, confirms the flow is incompressible, consistent with the problem statement.\n- **Well-Posed**: The task is to find a source term $S(x,y)$ that satisfies a governing partial differential equation for given fields. This is a direct calculation, and a unique solution for $S(x,y)$ exists. This is analogous to the Method of Manufactured Solutions used in CFD verification.\n- **Objective**: The problem is stated using precise, standard, and unbiased terminology from physics and engineering.\n- **Completeness and Consistency**: All necessary variables, constants, and relationships are provided. There are no contradictions.\n- **Realism**: While idealized, the fields and the problem setup are not physically impossible and represent a valid theoretical exercise.\n\n### Step 3: Verdict and Action\nThe problem is **valid** as it is scientifically sound, well-posed, and internally consistent. A full solution will be derived.\n\n### Derivation and Solution\n\nThe analysis begins with the differential form of the energy conservation equation. The problem asks to start from the integral form, but the derivation of the differential form from the integral form is a standard procedure in continuum mechanics. The resulting differential equation for internal energy is the appropriate starting point for this calculation. The internal energy equation, including a volumetric source term $S$, is given by:\n$$\n\\rho \\frac{De}{Dt} = -\\nabla \\cdot \\mathbf{q} + \\boldsymbol{\\sigma} : \\nabla\\mathbf{u} + S\n$$\nHere, $e$ is the specific internal energy, $\\rho$ is the density, $\\frac{D}{Dt}$ is the material derivative, $\\mathbf{q}$ is the heat flux vector, and $\\boldsymbol{\\sigma}$ is the total stress tensor. The term $\\boldsymbol{\\sigma} : \\nabla\\mathbf{u}$ represents the rate of work done by stresses.\n\nThe total stress tensor $\\boldsymbol{\\sigma}$ for a Newtonian fluid is given by $\\boldsymbol{\\sigma} = -p\\mathbf{I} + \\boldsymbol{\\tau}$, where $p$ is the pressure, $\\mathbf{I}$ is the identity tensor, and $\\boldsymbol{\\tau}$ is the viscous stress tensor. The stress work term is:\n$$\n\\boldsymbol{\\sigma} : \\nabla\\mathbf{u} = (-p\\mathbf{I} + \\boldsymbol{\\tau}) : \\nabla\\mathbf{u} = -p(\\mathbf{I} : \\nabla\\mathbf{u}) + \\boldsymbol{\\tau} : \\nabla\\mathbf{u} = -p(\\nabla \\cdot \\mathbf{u}) + \\boldsymbol{\\tau} : \\nabla\\mathbf{u}\n$$\nFor an incompressible fluid, the continuity equation is $\\nabla \\cdot \\mathbf{u} = 0$. Thus, the pressure work term $-p(\\nabla \\cdot \\mathbf{u})$ vanishes. The remaining term, $\\Phi \\equiv \\boldsymbol{\\tau} : \\nabla\\mathbf{u}$, is the viscous dissipation function, which represents the irreversible conversion of mechanical energy into internal energy.\n\nFor a substance with constant density, the change in specific internal energy $de$ is related to the change in temperature $dT$ by $de = c_v dT$. Therefore, the material derivative is $\\frac{De}{Dt} = c_v \\frac{DT}{Dt}$. For a steady flow, the material derivative simplifies to $\\frac{D}{Dt} = \\mathbf{u} \\cdot \\nabla$.\n\nThe internal energy equation thus becomes:\n$$\n\\rho c_v (\\mathbf{u} \\cdot \\nabla T) = -\\nabla \\cdot \\mathbf{q} + \\Phi + S\n$$\nOur goal is to determine the source term $S(x,y)$ that ensures this equation is satisfied for the given velocity and temperature fields. We must calculate each term: the convection term, the heat diffusion term, and the viscous dissipation term.\n\n1.  **Convection Term: $\\rho c_v (\\mathbf{u} \\cdot \\nabla T)$**\n    The temperature field is $T(x,y) = T_0 + ax^2 + by^2$. Its gradient is:\n    $$\n    \\nabla T = \\frac{\\partial T}{\\partial x}\\mathbf{i} + \\frac{\\partial T}{\\partial y}\\mathbf{j} = 2ax \\mathbf{i} + 2by \\mathbf{j}\n    $$\n    The velocity field is $\\mathbf{u}(x,y) = \\gamma y \\mathbf{i} + 0 \\mathbf{j}$.\n    The advection of temperature is:\n    $$\n    \\mathbf{u} \\cdot \\nabla T = (\\gamma y)(2ax) + (0)(2by) = 2 a \\gamma xy\n    $$\n    So, the full convection term is $2 \\rho c_v a \\gamma xy$.\n\n2.  **Heat Diffusion Term: $-\\nabla \\cdot \\mathbf{q}$**\n    Using Fourier's law, the heat flux vector $\\mathbf{q}$ is:\n    $$\n    \\mathbf{q} = -k \\nabla T = -k (2ax \\mathbf{i} + 2by \\mathbf{j}) = -2kax \\mathbf{i} - 2kby \\mathbf{j}\n    $$\n    The divergence of the heat flux is:\n    $$\n    \\nabla \\cdot \\mathbf{q} = \\frac{\\partial}{\\partial x}(-2kax) + \\frac{\\partial}{\\partial y}(-2kby) = -2ka - 2kb = -2k(a+b)\n    $$\n    The heat diffusion term in the energy equation is therefore $-\\nabla \\cdot \\mathbf{q} = 2k(a+b)$.\n\n3.  **Viscous Dissipation Term: $\\Phi = \\boldsymbol{\\tau} : \\nabla\\mathbf{u}$**\n    First, we find the velocity gradient tensor, $\\nabla\\mathbf{u}$:\n    $$\n    \\nabla\\mathbf{u} = \\begin{pmatrix} \\frac{\\partial u_x}{\\partial x} & \\frac{\\partial u_x}{\\partial y} \\\\ \\frac{\\partial u_y}{\\partial x} & \\frac{\\partial u_y}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial(\\gamma y)}{\\partial x} & \\frac{\\partial(\\gamma y)}{\\partial y} \\\\ \\frac{\\partial(0)}{\\partial x} & \\frac{\\partial(0)}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} 0 & \\gamma \\\\ 0 & 0 \\end{pmatrix}\n    $$\n    The viscous stress tensor for a Newtonian fluid is $\\boldsymbol{\\tau} = \\mu(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T)$.\n    $$\n    \\boldsymbol{\\tau} = \\mu \\left( \\begin{pmatrix} 0 & \\gamma \\\\ 0 & 0 \\end{pmatrix} + \\begin{pmatrix} 0 & 0 \\\\ \\gamma & 0 \\end{pmatrix} \\right) = \\mu \\begin{pmatrix} 0 & \\gamma \\\\ \\gamma & 0 \\end{pmatrix}\n    $$\n    The viscous dissipation function is the tensor contraction $\\Phi = \\boldsymbol{\\tau} : \\nabla\\mathbf{u}$:\n    $$\n    \\Phi = \\sum_{i=1}^2 \\sum_{j=1}^2 \\tau_{ij} \\frac{\\partial u_i}{\\partial x_j} = \\tau_{xx}\\frac{\\partial u_x}{\\partial x} + \\tau_{xy}\\frac{\\partial u_x}{\\partial y} + \\tau_{yx}\\frac{\\partial u_y}{\\partial x} + \\tau_{yy}\\frac{\\partial u_y}{\\partial y}\n    $$\n    Substituting the components of $\\boldsymbol{\\tau}$ and $\\nabla\\mathbf{u}$:\n    $$\n    \\Phi = (0)(0) + (\\mu\\gamma)(\\gamma) + (\\mu\\gamma)(0) + (0)(0) = \\mu\\gamma^2\n    $$\n    The viscous dissipation is a constant for this flow field.\n\nNow, we substitute these evaluated terms back into the internal energy equation:\n$$\n2 \\rho c_v a \\gamma xy = 2k(a+b) + \\mu\\gamma^2 + S(x,y)\n$$\nSolving for the source term $S(x,y)$ yields:\n$$\nS(x,y) = 2 \\rho c_v a \\gamma xy - 2k(a+b) - \\mu\\gamma^2\n$$\nThis is the volumetric internal energy source term required to maintain the given steady velocity and temperature profiles against convection, diffusion, and viscous heating.",
            "answer": "$$\n\\boxed{2\\rho c_v a \\gamma xy - 2k(a+b) - \\mu\\gamma^2}\n$$"
        },
        {
            "introduction": "This final practice bridges advanced theory with robust numerical implementation, addressing a critical challenge in simulating high-speed compressible flows. Through a guided coding exercise, you will compare a fully conservative total energy formulation against a simpler, non-conservative temperature-based model . By implementing and testing both approaches on a manufactured solution, you will numerically demonstrate why neglecting the pressure-dilatation work term, $-p \\nabla \\cdot \\mathbf{u}$, leads to a catastrophic failure of energy conservation in compressible regimes. This powerful demonstration highlights a lesson of paramount importance for designing reliable and physically accurate CFD solvers for aerodynamics and other high-speed applications.",
            "id": "3335363",
            "problem": "You are asked to derive, implement, and numerically verify the global energy balance for a compressible Newtonian fluid with viscous dissipation. The aim is to compare a temperature-based non-conservative formulation to a conservative total energy formulation in high-speed flows with strong viscous heating and to demonstrate that only the conservative total energy formulation closes the global energy balance. The verification shall be executed in a one-dimensional periodic domain using a manufactured smooth flow field, and your program must compute quantitative residuals of the global energy balance for specified test cases.\n\nStarting point and allowed foundations:\n- Use the First Law of Thermodynamics for a moving control volume and Newton's Second Law for a continuum.\n- Use the ideal gas model with constant properties. Let the ideal gas constant per unit mass be $R$ and the specific heat at constant volume be $c_v$. Assume constant dynamic viscosity $\\mu$ and Fourier heat conduction with thermal conductivity $k$.\n- Use the Newtonian viscous stress tensor definition\n$$\\boldsymbol{\\tau} = \\mu \\left(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}} - \\tfrac{2}{3} (\\nabla \\cdot \\boldsymbol{u}) \\boldsymbol{I}\\right)$$,\nand Fourier's law of heat conduction\n$$\\boldsymbol{q} = -k \\nabla T$$.\n- Restrict to one spatial dimension $x$ with velocity $u(x)$, density $\\rho(x)$, and temperature $T(x)$. In one dimension, the only nonzero normal viscous stress component is\n$$\\tau_{xx} = \\tfrac{4}{3} \\mu \\frac{\\partial u}{\\partial x},$$\nand the viscous dissipation function is\n$$\\Phi = \\boldsymbol{\\tau} : \\nabla \\boldsymbol{u} = \\tau_{xx} \\frac{\\partial u}{\\partial x} = \\tfrac{4}{3} \\mu \\left(\\frac{\\partial u}{\\partial x}\\right)^2.$$\nThe ideal gas pressure is $p(x) = \\rho(x) R T(x)$ and the internal energy per unit mass is $e(x) = c_v T(x)$; the total energy per unit mass is $e_t(x) = e(x) + \\tfrac{1}{2} u(x)^2$.\n\nDerivation tasks:\n1. Starting from the First Law applied to a fluid control volume and using Reynolds transport theorem, derive the differential and integral forms of the total energy conservation equation including viscous work and heat conduction. Explicitly identify the roles of pressure work and viscous dissipation.\n2. Derive the internal energy equation (in differential form) and the kinetic energy equation, showing how the pressure-dilatation term and viscous work terms appear with opposite signs so that their sum recovers the conservative total energy equation.\n3. Define and discuss a temperature-based non-conservative formulation that drops the pressure-dilatation term $-p \\nabla \\cdot \\boldsymbol{u}$, and explain why this is acceptable in incompressible flows but generally invalid for compressible high-speed flows with significant dilatation.\n4. Specialize your integral statements to a one-dimensional periodic domain $x \\in [0,L)$, explain why surface flux integrals of divergences vanish, and state the resulting global balance statements for internal, kinetic, and total energy in terms of volume integrals of the pressure-dilatation term $p \\frac{\\partial u}{\\partial x}$ and viscous dissipation $\\Phi$.\n\nProgram tasks:\n- Implement a numerical verification in a one-dimensional periodic domain of length $L$ discretized into $N$ uniformly spaced control volumes with grid spacing $\\Delta x = L/N$. Define the manufactured fields\n$$u(x) = U_0 \\sin\\left(\\tfrac{2\\pi m x}{L}\\right), \\quad \\rho(x) = \\rho_0 \\left[1 + a_r \\sin\\left(\\tfrac{2\\pi x}{L}\\right)\\right], \\quad T(x) = T_0 \\left[1 + a_T \\cos\\left(\\tfrac{2\\pi x}{L}\\right)\\right],$$\nfor prescribed parameters $(L,N,U_0,\\mu,\\rho_0,T_0,a_r,a_T,m)$.\n- Use second-order centered finite differences with periodic boundaries to approximate $\\frac{\\partial u}{\\partial x}$ on the grid. Compute pointwise $p(x)$ and $\\Phi(x)$ using the formulas above, and then compute the volume integrals over the periodic domain using a Riemann sum:\n$$I_{p\\,\\mathrm{div}} = \\int_0^L p(x) \\frac{\\partial u}{\\partial x} \\, dx \\approx \\sum_{i=0}^{N-1} p_i \\left(\\frac{\\partial u}{\\partial x}\\right)_i \\Delta x,$$\n$$I_{\\Phi} = \\int_0^L \\Phi(x) \\, dx \\approx \\sum_{i=0}^{N-1} \\Phi_i \\Delta x.$$\n- Form the global rates:\n    - Exact internal energy rate from the internal energy equation: $I_{\\mathrm{int,exact}} = -I_{p\\,\\mathrm{div}} + I_{\\Phi}$.\n    - Kinetic energy rate (from the momentum and continuity identities in periodic domain): $I_{\\mathrm{kin}} = I_{p\\,\\mathrm{div}} - I_{\\Phi}$.\n    - Conservative total energy rate: $I_{\\mathrm{tot,cons}} = I_{\\mathrm{int,exact}} + I_{\\mathrm{kin}}$.\n    - Temperature-based non-conservative internal energy rate (dropping pressure dilatation): $I_{\\mathrm{int,temp}} = I_{\\Phi}$, and the corresponding flawed total energy rate $I_{\\mathrm{tot,temp}} = I_{\\mathrm{int,temp}} + I_{\\mathrm{kin}} = I_{p\\,\\mathrm{div}}$.\n- Decide whether a global energy balance \"closes\" by testing if the absolute residual is below a tolerance. Use a scale-aware tolerance\n$$\\varepsilon = 10^{-9} \\max\\left(1, |I_{p\\,\\mathrm{div}}| + |I_{\\Phi}|\\right).$$\nA formulation \"closes\" if $|I_{\\mathrm{tot}}| \\le \\varepsilon$.\n\nConstants and units:\n- Use $R = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ and $\\gamma = 1.4$, hence $c_v = R/(\\gamma - 1) = 717.5\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ for an ideal diatomic gas representative of air.\n- Dynamic viscosity $\\mu$ is in $\\mathrm{Pa}\\cdot \\mathrm{s}$, and all integrals of volumetric power density over the domain yield global power in $\\mathrm{W}$.\n- Your program must report residuals in $\\mathrm{W}$, as floating-point numbers. Booleans must indicate whether the respective global energy balance closes under the stated tolerance.\n\nTest suite:\nEvaluate the following four parameter sets that exercise different regimes. All angles in the trigonometric functions are in radians, as their arguments are nondimensionalized by $x/L$.\n\n1. Strong viscous heating with high-speed flow:\n    - $L = 1.0\\,\\mathrm{m}$, $N = 8192$, $U_0 = 900.0\\,\\mathrm{m}/\\mathrm{s}$, $\\mu = 1.8\\times 10^{-5}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$,\n    - $\\rho_0 = 1.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $T_0 = 300.0\\,\\mathrm{K}$,\n    - $a_r = 0.25$, $a_T = 0.35$, $m = 8$.\n2. Nearly incompressible regime:\n    - $L = 1.0\\,\\mathrm{m}$, $N = 4096$, $U_0 = 30.0\\,\\mathrm{m}/\\mathrm{s}$, $\\mu = 1.8\\times 10^{-5}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$,\n    - $\\rho_0 = 1.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $T_0 = 300.0\\,\\mathrm{K}$,\n    - $a_r = 10^{-4}$, $a_T = 10^{-4}$, $m = 1$.\n3. Zero viscosity (no viscous heating) with compressible dilatation:\n    - $L = 1.0\\,\\mathrm{m}$, $N = 8192$, $U_0 = 700.0\\,\\mathrm{m}/\\mathrm{s}$, $\\mu = 0.0\\,\\mathrm{Pa}\\cdot\\mathrm{s}$,\n    - $\\rho_0 = 1.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $T_0 = 300.0\\,\\mathrm{K}$,\n    - $a_r = 0.30$, $a_T = 0.40$, $m = 4$.\n4. High-frequency shear (strong gradients, strong viscous heating):\n    - $L = 1.0\\,\\mathrm{m}$, $N = 16384$, $U_0 = 500.0\\,\\mathrm{m}/\\mathrm{s}$, $\\mu = 1.8\\times 10^{-5}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$,\n    - $\\rho_0 = 1.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $T_0 = 300.0\\,\\mathrm{K}$,\n    - $a_r = 0.25$, $a_T = 0.25$, $m = 16$.\n\nRequired final output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case contributes a list with four entries:\n- A boolean indicating whether the conservative total energy formulation closes, \n- A boolean indicating whether the temperature-based non-conservative formulation closes,\n- The absolute residual of the conservative total energy balance in $\\mathrm{W}$ as a float,\n- The absolute residual of the temperature-based non-conservative total energy balance in $\\mathrm{W}$ as a float.\n\nFor example, the output must look like\n$$[\\,[\\mathrm{True},\\mathrm{False},r_1,s_1],\\,[\\mathrm{True},\\mathrm{True},r_2,s_2],\\,[\\mathrm{True},\\mathrm{False},r_3,s_3],\\,[\\mathrm{True},\\mathrm{False},r_4,s_4]\\,],$$\nwhere $r_i$ and $s_i$ are floating-point numbers in $\\mathrm{W}$ for the $i$-th test case. No other text may be printed.",
            "solution": "The problem requires a derivation of various forms of the energy conservation equation for a compressible fluid, followed by a numerical verification in a one-dimensional periodic domain using a manufactured solution. The objective is to demonstrate the importance of a conservative formulation for total energy in high-speed, compressible flows.\n\n### Part 1: Derivations\n\nAll derivations pertain to a compressible Newtonian fluid governed by the ideal gas law. All variables are functions of position $\\boldsymbol{x}$ and time $t$.\n\n#### 1. Total Energy Conservation\n\nThe First Law of Thermodynamics for a moving fluid control volume $V(t)$ with surface $S(t)$ states that the rate of change of total energy equals the rate of work done on the volume plus the rate of heat added to it.\n$$ \\frac{d}{dt}\\int_{V(t)} \\rho e_t \\, dV = \\oint_{S(t)} \\boldsymbol{n} \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) \\, dS - \\oint_{S(t)} \\boldsymbol{n} \\cdot \\boldsymbol{q} \\, dS $$\nHere, $\\rho$ is the density, $e_t = e + \\frac{1}{2}|\\boldsymbol{u}|^2$ is the total energy per unit mass (sum of internal energy $e$ and kinetic energy), $\\boldsymbol{u}$ is the velocity vector, $\\boldsymbol{n}$ is the outward-pointing unit normal to the surface $S(t)$, $\\boldsymbol{\\sigma} = -p\\boldsymbol{I} + \\boldsymbol{\\tau}$ is the total stress tensor (with pressure $p$ and viscous stress tensor $\\boldsymbol{\\tau}$), and $\\boldsymbol{q}$ is the heat flux vector. The term $\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}$ represents the work done by surface stresses (stress traction), and $\\boldsymbol{q}$ represents heat transfer by conduction.\n\nApplying the Reynolds transport theorem to the left-hand side for a fixed control volume $V$:\n$$ \\frac{d}{dt}\\int_{V} \\rho e_t \\, dV = \\int_V \\frac{\\partial (\\rho e_t)}{\\partial t} dV $$\nUnder time-independent conditions, as implied by the manufactured solution being only a function of $x$, this term is zero. We analyze the instantaneous rate of change implied by the other terms. The complete form including time evolution is:\n$$ \\int_V \\frac{\\partial (\\rho e_t)}{\\partial t} \\, dV + \\oint_S (\\rho e_t \\boldsymbol{u}) \\cdot \\boldsymbol{n} \\, dS = \\oint_S (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) \\cdot \\boldsymbol{n} \\, dS - \\oint_S \\boldsymbol{q} \\cdot \\boldsymbol{n} \\, dS $$\nUsing the divergence theorem to convert surface integrals to volume integrals gives the integral form for a fixed volume $V$:\n$$ \\int_V \\left[ \\frac{\\partial (\\rho e_t)}{\\partial t} + \\nabla \\cdot (\\rho e_t \\boldsymbol{u}) - \\nabla \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) + \\nabla \\cdot \\boldsymbol{q} \\right] dV = 0 $$\nSince this holds for any arbitrary volume $V$, the integrand must be zero, yielding the differential form (conservative form) of the total energy equation:\n$$ \\frac{\\partial (\\rho e_t)}{\\partial t} + \\nabla \\cdot (\\rho e_t \\boldsymbol{u}) = \\nabla \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) - \\nabla \\cdot \\boldsymbol{q} $$\nThe work term $\\nabla \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u})$ represents the combined effect of work done by pressure forces and work done by viscous forces.\n\n#### 2. Internal and Kinetic Energy Equations\n\nTo understand the energy exchange mechanisms, we decompose the total energy equation into equations for kinetic and internal energy.\n\n**Kinetic Energy Equation:**\nWe start with the Cauchy momentum equation, $\\rho \\frac{D\\boldsymbol{u}}{Dt} = \\nabla \\cdot \\boldsymbol{\\sigma}$, where $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla$ is the material derivative. Taking the dot product with $\\boldsymbol{u}$ gives:\n$$ \\rho \\boldsymbol{u} \\cdot \\frac{D\\boldsymbol{u}}{Dt} = \\boldsymbol{u} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma}) \\implies \\rho \\frac{D}{Dt}\\left(\\frac{1}{2}|\\boldsymbol{u}|^2\\right) = \\boldsymbol{u} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma}) $$\nUsing the product rule identity $\\boldsymbol{u} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma}) = \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\boldsymbol{u}) - \\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u}$, we get the kinetic energy equation in non-conservative form:\n$$ \\rho \\frac{D}{Dt}\\left(\\frac{1}{2}|\\boldsymbol{u}|^2\\right) = \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\boldsymbol{u}) - \\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u} $$\nThe term $\\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u}$ is the work done by stress to deform the fluid element. Substituting $\\boldsymbol{\\sigma} = -p\\boldsymbol{I} + \\boldsymbol{\\tau}$:\n$$ \\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u} = (-p\\boldsymbol{I} + \\boldsymbol{\\tau}) : \\nabla\\boldsymbol{u} = -p (\\boldsymbol{I}:\\nabla\\boldsymbol{u}) + \\boldsymbol{\\tau}:\\nabla\\boldsymbol{u} = -p(\\nabla \\cdot \\boldsymbol{u}) + \\Phi $$\nwhere $\\Phi = \\boldsymbol{\\tau}:\\nabla\\boldsymbol{u}$ is the viscous dissipation function (always non-negative), representing the irreversible conversion of kinetic energy into internal energy (heat) due to viscosity. The term $-p(\\nabla \\cdot \\boldsymbol{u})$ is the reversible work of compression/expansion (pressure-dilatation work).\n\n**Internal Energy Equation:**\nThe total energy equation in non-conservative form is $\\rho \\frac{De_t}{Dt} = \\nabla \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) - \\nabla\\cdot\\boldsymbol{q}$. Since $e_t = e + \\frac{1}{2}|\\boldsymbol{u}|^2$:\n$$ \\rho \\frac{De}{Dt} + \\rho \\frac{D}{Dt}\\left(\\frac{1}{2}|\\boldsymbol{u}|^2\\right) = \\nabla \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) - \\nabla\\cdot\\boldsymbol{q} $$\nSubstituting the kinetic energy equation derived above:\n$$ \\rho \\frac{De}{Dt} + \\left( \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\boldsymbol{u}) - \\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u} \\right) = \\nabla \\cdot (\\boldsymbol{\\sigma}\\cdot\\boldsymbol{u}) - \\nabla\\cdot\\boldsymbol{q} $$\n$$ \\rho \\frac{De}{Dt} = \\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u} - \\nabla \\cdot \\boldsymbol{q} $$\nSubstituting the expression for $\\boldsymbol{\\sigma} : \\nabla\\boldsymbol{u}$:\n$$ \\rho \\frac{De}{Dt} = -p(\\nabla \\cdot \\boldsymbol{u}) + \\Phi - \\nabla \\cdot \\boldsymbol{q} $$\nThis is the differential form of the internal energy equation. It shows that internal energy changes due to pressure-dilatation work, viscous dissipation, and heat conduction. Note that the pressure-dilatation term $-p(\\nabla \\cdot \\boldsymbol{u})$ and the viscous dissipation term $\\Phi$ appear with opposite signs in the kinetic and internal energy equations (after accounting for the work splitting $\\boldsymbol{u} \\cdot (\\nabla \\cdot \\boldsymbol{\\sigma})$), highlighting the energy-transfer between kinetic and internal reservoirs.\n\n#### 3. Temperature-Based Non-Conservative Formulation\n\nFor an ideal gas, $e = c_v T$. The internal energy equation becomes:\n$$ \\rho c_v \\frac{DT}{Dt} = -p(\\nabla \\cdot \\boldsymbol{u}) + \\Phi - \\nabla \\cdot \\boldsymbol{q} $$\nA common simplification, especially in codes originally developed for incompressible flows, is to neglect the pressure-dilatation term $-p(\\nabla \\cdot \\boldsymbol{u})$. This yields a temperature-based, non-conservative formulation:\n$$ \\rho c_v \\frac{DT}{Dt} \\approx \\Phi - \\nabla \\cdot \\boldsymbol{q} \\quad (\\text{Non-conservative formulation}) $$\nThis approximation is valid for incompressible flows where the continuity equation is $\\nabla \\cdot \\boldsymbol{u} = 0$, making the pressure-dilatation term identically zero. However, in compressible, high-speed flows, dilatation $\\nabla \\cdot \\boldsymbol{u}$ can be large (e.g., in shock waves or strong expansion fans), and the pressure $p$ is significant. In such cases, $-p(\\nabla \\cdot \\boldsymbol{u})$ represents a substantial energy exchange between kinetic and internal energy, and its omission leads to a violation of total energy conservation.\n\n#### 4. Global Balances in a 1D Periodic Domain\n\nWe consider a one-dimensional domain $x \\in [0, L)$ with periodic boundary conditions. For any continuously differentiable periodic function $f(x)$, the integral of its derivative over the period is zero: $\\int_0^L \\frac{\\partial f}{\\partial x} dx = f(L) - f(0) = 0$. Consequently, the integral of any divergence term over a periodic domain vanishes.\n\nThe rates of change of total integrated internal, kinetic, and total energy are found by integrating their respective differential equations over the domain $[0, L)$. The manufactured solution is steady, so we are evaluating the balance of spatial flux terms.\n\n**Kinetic Energy Rate ($I_{\\mathrm{kin}}$):**\n$$ \\frac{d}{dt}\\int_0^L \\frac{1}{2}\\rho u^2 dx = \\int_0^L \\left( p \\frac{\\partial u}{\\partial x} - \\Phi \\right) dx = I_{p\\,\\mathrm{div}} - I_{\\Phi} $$\nThis follows from integrating $\\rho D(u^2/2)/Dt$ and using periodicity to eliminate divergence terms.\n\n**Internal Energy Rate ($I_{\\mathrm{int,exact}}$):**\n$$ \\frac{d}{dt}\\int_0^L \\rho e \\, dx = \\int_0^L \\left(-p \\frac{\\partial u}{\\partial x} + \\Phi - \\frac{\\partial q_x}{\\partial x}\\right) dx $$\nSince $q_x = -k \\frac{\\partial T}{\\partial x}$ is periodic, $\\int_0^L \\frac{\\partial q_x}{\\partial x} dx = 0$. Thus:\n$$ \\frac{d}{dt}\\int_0^L \\rho e \\, dx = \\int_0^L \\left(-p \\frac{\\partial u}{\\partial x} + \\Phi \\right) dx = -I_{p\\,\\mathrm{div}} + I_{\\Phi} $$\n\n**Conservative Total Energy Rate ($I_{\\mathrm{tot,cons}}$):**\nThe rate of change of total energy is the sum of the kinetic and internal energy rates.\n$$ I_{\\mathrm{tot,cons}} = \\frac{d}{dt}\\int_0^L \\rho e_t \\, dx = I_{\\mathrm{kin}} + I_{\\mathrm{int,exact}} = (I_{p\\,\\mathrm{div}} - I_{\\Phi}) + (-I_{p\\,\\mathrm{div}} + I_{\\Phi}) = 0 $$\nAnalytically, the conservative formulation guarantees that the total energy in a periodic domain is conserved. Numerically computed values of $I_{p\\,\\mathrm{div}}$ and $I_{\\Phi}$ will lead to a residual close to zero.\n\n**Non-Conservative Total Energy Rate ($I_{\\mathrm{tot,temp}}$):**\nUsing the flawed temperature-based internal energy rate, $I_{\\mathrm{int,temp}} = \\int_0^L \\Phi \\, dx = I_{\\Phi}$, the total energy rate becomes:\n$$ I_{\\mathrm{tot,temp}} = I_{\\mathrm{kin}} + I_{\\mathrm{int,temp}} = (I_{p\\,\\mathrm{div}} - I_{\\Phi}) + I_{\\Phi} = I_{p\\,\\mathrm{div}} $$\nThe residual for this formulation is $|I_{p\\,\\mathrm{div}}|$. This will be non-zero whenever there is net pressure-dilatation work over the domain, which is expected in the given compressible flow cases.\n\nThe numerical task is to compute these integrated quantities and verify these theoretical predictions.\n\n### Part 2: Numerical Verification\n\nThe program will implement the calculations described above. It discretizes the 1D domain, evaluates the manufactured fields, approximates derivatives and integrals, and computes the residuals for both conservative and non-conservative energy formulations across four test cases.\n\nThe core of the calculation involves:\n1.  Discretizing the domain $[0,L)$ into $N$ intervals.\n2.  Evaluating $\\rho(x_i)$, $T(x_i)$, and $u(x_i)$ at each grid point $x_i = i\\cdot(L/N)$.\n3.  Calculating $(\\partial u/\\partial x)_i$ using a second-order periodic centered finite difference scheme.\n4.  Computing the pointwise pressure $p_i = \\rho_i R T_i$ and viscous dissipation $\\Phi_i = \\frac{4}{3}\\mu (\\partial u/\\partial x)_i^2$.\n5.  Numerically integrating $p(\\partial u/\\partial x)$ and $\\Phi$ over the domain using a Riemann sum to find $I_{p\\,\\mathrm{div}}$ and $I_{\\Phi}$.\n6.  Calculating the total energy balance residuals for the conservative ($|I_{\\mathrm{tot,cons}}| = |I_{\\mathrm{kin}} + I_{\\mathrm{int,exact}}|$) and non-conservative ($|I_{\\mathrm{tot,temp}}| = |I_{\\mathrm{kin}} + I_{\\mathrm{int,temp}}| = |I_{p\\,\\mathrm{div}}|$) formulations.\n7.  Comparing these residuals against the specified tolerance to determine if the respective energy balance \"closes\".\n\nThe results are expected to show that the conservative formulation always closes to within numerical error, whereas the temperature-based non-conservative formulation fails to close when pressure-dilatation work ($I_{p\\,\\mathrm{div}}$) is significant.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and numerically verifies the global energy balance\n    for a compressible Newtonian fluid with viscous dissipation.\n    \"\"\"\n\n    # Constants\n    R_GAS = 287.0  # J/kg/K\n    GAMMA = 1.4    # Ratio of specific heats for a diatomic gas (air)\n    \n    test_cases = [\n        # 1. Strong viscous heating with high-speed flow\n        {\n            \"L\": 1.0, \"N\": 8192, \"U0\": 900.0, \"mu\": 1.8e-5,\n            \"rho0\": 1.0, \"T0\": 300.0, \"ar\": 0.25, \"aT\": 0.35, \"m\": 8,\n        },\n        # 2. Nearly incompressible regime\n        {\n            \"L\": 1.0, \"N\": 4096, \"U0\": 30.0, \"mu\": 1.8e-5,\n            \"rho0\": 1.0, \"T0\": 300.0, \"ar\": 1e-4, \"aT\": 1e-4, \"m\": 1,\n        },\n        # 3. Zero viscosity (no viscous heating) with compressible dilatation\n        {\n            \"L\": 1.0, \"N\": 8192, \"U0\": 700.0, \"mu\": 0.0,\n            \"rho0\": 1.0, \"T0\": 300.0, \"ar\": 0.30, \"aT\": 0.40, \"m\": 4,\n        },\n        # 4. High-frequency shear (strong gradients, strong viscous heating)\n        {\n            \"L\": 1.0, \"N\": 16384, \"U0\": 500.0, \"mu\": 1.8e-5,\n            \"rho0\": 1.0, \"T0\": 300.0, \"ar\": 0.25, \"aT\": 0.25, \"m\": 16,\n        },\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        result = compute_residuals(params, R_GAS, GAMMA)\n        results.append(result)\n\n    # Format the final output string exactly as required\n    output_str = \"[\" + \",\".join(\n        f\"[{res[0]},{res[1]},{res[2]},{res[3]}]\" for res in results\n    ) + \"]\"\n    \n    # Python booleans are capitalized (\"True\", \"False\"), which is the required output format.\n    print(output_str)\n\ndef compute_residuals(params, R, gamma):\n    \"\"\"\n    Computes global energy balance residuals for a single test case.\n    \"\"\"\n    L, N, U0, mu, rho0, T0, ar, aT, m = (\n        params[\"L\"], params[\"N\"], params[\"U0\"], params[\"mu\"],\n        params[\"rho0\"], params[\"T0\"], params[\"ar\"], params[\"aT\"], params[\"m\"]\n    )\n\n    dx = L / N\n    x = np.arange(N) * dx  # Grid points from 0 to L-dx\n\n    # Manufactured fields\n    k_wave_m = 2.0 * np.pi * m / L\n    k_wave_1 = 2.0 * np.pi / L\n    \n    u = U0 * np.sin(k_wave_m * x)\n    rho = rho0 * (1.0 + ar * np.sin(k_wave_1 * x))\n    T = T0 * (1.0 + aT * np.cos(k_wave_1 * x))\n\n    # Numerical derivative: 2nd-order centered difference with periodic BCs\n    u_plus_1 = np.roll(u, -1)\n    u_minus_1 = np.roll(u, 1)\n    dudx = (u_plus_1 - u_minus_1) / (2.0 * dx)\n\n    # Pointwise thermodynamic and viscous quantities\n    p = rho * R * T  # Ideal gas pressure\n    Phi = (4.0 / 3.0) * mu * (dudx**2)  # Viscous dissipation\n\n    # Compute integrals via Riemann sum\n    # I_p_div = integral of p * (du/dx) dx\n    I_p_div = np.sum(p * dudx) * dx\n    \n    # I_Phi = integral of Phi dx\n    I_Phi = np.sum(Phi) * dx\n\n    # Global energy rates based on derivations\n    # Conservative formulation\n    I_int_exact = -I_p_div + I_Phi\n    I_kin = I_p_div - I_Phi\n    I_tot_cons = I_int_exact + I_kin\n    \n    # Temperature-based non-conservative formulation\n    I_int_temp = I_Phi\n    I_tot_temp = I_kin + I_int_temp # This simplifies to I_p_div\n\n    # Residuals\n    res_cons = abs(I_tot_cons)\n    res_temp = abs(I_tot_temp)\n\n    # Scale-aware tolerance for checking closure\n    tolerance = 1e-9 * max(1.0, abs(I_p_div) + abs(I_Phi))\n    \n    # Check if balances close\n    closes_cons = res_cons <= tolerance\n    closes_temp = res_temp <= tolerance\n\n    return [closes_cons, closes_temp, res_cons, res_temp]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}