{
    "hands_on_practices": [
        {
            "introduction": "格子玻尔兹曼方法的核心在于将流体宏观量（如密度和速度）与微观粒子分布函数联系起来。本练习将带你实践这一核心概念，通过计算D2Q9模型中的平衡态分布函数$f_i^{\\mathrm{eq}}$。这个计算不仅是LBM模拟中碰撞步骤的基础，更是验证你是否深刻理解微观与宏观世界之间桥梁的关键一步。",
            "id": "3375057",
            "problem": "考虑用于单组分弱可压缩流体的二维九速格子（D2Q9）上的等温格子玻尔兹曼方法（LBM）。离散速度为\n$$\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1),$$\n格子权重为\n$$w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36},$$\n格子声速为\n$$c_s^{2} = \\frac{1}{3}。$$\n假设 $|\\boldsymbol{u}|/c_s \\ll 1$ 并使用矩匹配原理，使得平衡态分布函数的零阶、一阶和二阶离散速度矩能在马赫数的二阶精度上再现等温可压缩欧拉级流体动力学场。具体要求如下：\n- 零阶矩恢复质量密度 $ \\rho $，\n- 一阶矩恢复动量密度 $ \\rho \\boldsymbol{u} $，\n- 二阶矩恢复等温压力张量 $ \\boldsymbol{\\Pi}^{eq} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u} $。\n\n仅使用这些约束，推导与上述矩条件在$|\\boldsymbol{u}|$的二阶精度内一致的 D2Q9 平衡态分布函数 $f_i^{eq}(\\rho,\\boldsymbol{u})$ 的一般形式。然后，对于特定状态\n$$\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right),$$\n计算所有九个平衡态分布函数 $f_i^{eq}$（$i=0,\\dots,8$）。最后，通过显式计算 $\\sum_{i=0}^{8} f_i^{eq}$ 和 $\\sum_{i=0}^{8} f_i^{eq}\\boldsymbol{c}_i$ 来验证密度和动量的恢复，并报告标量 $\\sum_{i} f_i^{eq}$ 以及 $\\sum_{i} f_i^{eq}\\boldsymbol{c}_i$ 的两个分量。\n\n将最终答案表示为包含 $9$ 个值 $f_0^{eq},f_1^{eq},\\dots,f_8^{eq}$，其后依次是 $\\sum_{i} f_i^{eq}$、$\\left(\\sum_{i} f_i^{eq} c_{ix}\\right)$ 和 $\\left(\\sum_{i} f_i^{eq} c_{iy}\\right)$ 的单行矩阵。不需要四舍五入，最终答案中不应包含单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   **模型**：用于单组分弱可压缩流体的二维九速（D2Q9）格子上的等温格子玻尔兹曼方法（LBM）。\n-   **离散速度 $\\boldsymbol{c}_i$**：\n    $\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1)$，在格子单位中 $\\Delta x = 1$ 且 $\\Delta t = 1$。\n-   **格子权重 $w_i$**：\n    $w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36}$。\n-   **格子声速 $c_s$**：\n    $c_s^{2} = \\frac{1}{3}$。\n-   **低马赫数条件**：$|\\boldsymbol{u}|/c_s \\ll 1$。\n-   **平衡态分布函数 $f_i^{eq}$ 的矩约束**：\n    1.  零阶矩（密度）：$\\sum_{i=0}^{8} f_i^{eq} = \\rho$。\n    2.  一阶矩（动量）：$\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i = \\rho \\boldsymbol{u}$。\n    3.  二阶矩（动量通量）：$\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i \\boldsymbol{c}_i = \\boldsymbol{\\Pi}^{eq} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u}$。\n-   **特定状态**：\n    $\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据科学性、适定性和客观性标准对问题进行评估。\n\n-   **科学性**：该问题是计算流体动力学领域内的标准推导和应用，具体涉及格子玻尔兹曼方法。D2Q9 模型、其权重、声速以及平衡态分布的矩匹配条件是 LBM 理论中基础且成熟的概念。该问题在科学上是合理的。\n-   **适定性**：问题提供了所有必要的约束和数据，以推导指定阶数的平衡态分布函数的一般形式并计算其具体值。矩条件唯一确定了 $f_i^{eq}$ 在速度上的多项式展开系数。密度和速度的具体值定义明确。问题是自洽且唯一可解的。\n-   **客观性**：问题以精确的数学语言陈述，没有任何主观或模糊的术语。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。这是一个计算物理学中的标准、适定性问题，符合所有验证标准。将提供完整解答。\n\n### 平衡态分布函数的推导\n\n该问题要求从矩条件推导 $f_i^{eq}(\\rho, \\boldsymbol{u})$ 的形式。一种标准方法是通过正交多项式的截断展开来实现，在 LBM 中即为基于格子的 Hermite 多项式。我们寻求一个 $f_i^{eq}$ 在宏观速度 $\\boldsymbol{u}$ 的幂次上到二阶的展开式，这与低马赫数假设一致。\n\n我们将 $f_i^{eq}$ 展开为：\n$$f_i^{eq} = w_i \\left( A + B_{\\alpha} c_{i\\alpha} + C_{\\alpha\\beta} c_{i\\alpha} c_{i\\beta} + D_{\\alpha\\beta} \\delta_{\\alpha\\beta} \\right)$$\n其中重复的希腊下标表示对空间维度（$x, y$）求和。系数 $A$、$B_\\alpha$、$C_{\\alpha\\beta}$ 和 $D_{\\alpha\\beta}$ 是 $\\rho$ 和 $\\boldsymbol{u}$ 的函数。为简化，我们将其表示为 $u$ 的多项式。\n一个更直接的方法是使用 Grad 型矩展开，根据其矩来表示 $f_i^{eq}$。对于二阶展开，其一般形式为：\n$$f_i^{eq} = w_i \\left( a^{(0)} + \\frac{a_{\\alpha}^{(1)} c_{i\\alpha}}{c_s^2} + \\frac{a_{\\alpha\\beta}^{(2)} (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right)$$\n其中 $a^{(0)}$、$a_\\alpha^{(1)}$ 和 $a_{\\alpha\\beta}^{(2)}$ 分别是 $f_i^{eq}$ 关于速度的零阶、一阶和二阶原始矩。\n流体动力学矩由约束条件给出：\n-   $a^{(0)} = \\sum_i f_i^{eq} = \\rho$\n-   $a_{\\alpha}^{(1)} = \\sum_i f_i^{eq} c_{i\\alpha} = \\rho u_\\alpha$\n-   $\\sum_i f_i^{eq} c_{i\\alpha}c_{i\\beta} = \\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$\n\n从展开式本身，我们也可以计算二阶矩：\n$$ \\sum_i f_i^{eq} c_{i\\alpha} c_{i\\beta} = \\sum_i w_i \\left( a^{(0)} + \\frac{a_{\\gamma}^{(1)} c_{i\\gamma}}{c_s^2} + \\frac{a_{\\gamma\\delta}^{(2)} (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta})}{2c_s^4} \\right) c_{i\\alpha} c_{i\\beta} $$\n利用格子各向同性性质 $\\sum_i w_i c_{i\\alpha} c_{i\\beta} = c_s^2 \\delta_{\\alpha\\beta}$ 和 $\\sum_i w_i c_{i\\alpha}c_{i\\beta}c_{i\\gamma} = 0$，我们得到：\n$$ \\sum_i f_i^{eq} c_{i\\alpha} c_{i\\beta} = a^{(0)} c_s^2 \\delta_{\\alpha\\beta} + \\frac{a_{\\gamma\\delta}^{(2)}}{2c_s^4} \\sum_i w_i (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta}) c_{i\\alpha}c_{i\\beta} $$\n第二项包含四阶矩。由于我们匹配的矩达到 $\\boldsymbol{u}$ 的二阶，项 $a_{\\gamma\\delta}^{(2)}$ 本身是 $O(|\\boldsymbol{u}|^2)$ 阶。$\\sum f_i^{eq} c_{i\\alpha}c_{i\\beta}$ 的展开式实际上是 $\\rho c_s^2 \\delta_{\\alpha\\beta} + a_{\\alpha\\beta}^{(2)}$。\n通过与约束条件 $\\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$ 比较，我们可以确定二阶矩系数为 $a_{\\alpha\\beta}^{(2)} = \\rho u_\\alpha u_\\beta$。\n\n将 $a^{(0)}=\\rho$、$a_{\\alpha}^{(1)}=\\rho u_\\alpha$ 和 $a_{\\alpha\\beta}^{(2)}=\\rho u_\\alpha u_\\beta$ 代回 $f_i^{eq}$ 的展开式：\n$$ f_i^{eq} = w_i \\left( \\rho + \\frac{(\\rho u_\\alpha) c_{i\\alpha}}{c_s^2} + \\frac{(\\rho u_\\alpha u_\\beta) (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right) $$\n提出因子 $\\rho$：\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{u_\\alpha c_{i\\alpha}}{c_s^2} + \\frac{u_\\alpha u_\\beta c_{i\\alpha}c_{i\\beta} - u_\\alpha u_\\beta c_s^2 \\delta_{\\alpha\\beta}}{2c_s^4} \\right) $$\n用向量表示法，即为：\n$$ f_i^{eq}(\\rho, \\boldsymbol{u}) = w_i \\rho \\left( 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_s^2} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2}{2c_s^4} - \\frac{|\\boldsymbol{u}|^2}{2c_s^2} \\right) $$\n这是与矩条件在 $|\\boldsymbol{u}|$ 的二阶精度内一致的 D2Q9 平衡态分布函数的一般形式。\n\n### 特定平衡态分布函数的计算\n\n给定 $\\rho = \\frac{5}{4}$，$\\boldsymbol{u} = \\left(\\frac{1}{6}, -\\frac{1}{9}\\right)$，以及 $c_s^2=\\frac{1}{3}$。\n我们将这些值代入推导出的公式。首先，计算公共项：\n$$ \\frac{1}{c_s^2} = 3 $$\n$$ \\frac{1}{2c_s^4} = \\frac{9}{2} $$\n$$ |\\boldsymbol{u}|^2 = u_x^2 + u_y^2 = \\left(\\frac{1}{6}\\right)^2 + \\left(-\\frac{1}{9}\\right)^2 = \\frac{1}{36} + \\frac{1}{81} = \\frac{9+4}{324} = \\frac{13}{324} $$\n表达式变为：\n$$ f_i^{eq} = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{3}{2}\\frac{13}{324} \\right) = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216} \\right) $$\n现在，我们计算每个 $i$ 的 $\\boldsymbol{c}_i \\cdot \\boldsymbol{u}$：\n$\\boldsymbol{c}_0 \\cdot \\boldsymbol{u} = 0$,\n$\\boldsymbol{c}_1 \\cdot \\boldsymbol{u} = \\frac{1}{6}$,\n$\\boldsymbol{c}_2 \\cdot \\boldsymbol{u} = -\\frac{1}{9}$,\n$\\boldsymbol{c}_3 \\cdot \\boldsymbol{u} = -\\frac{1}{6}$,\n$\\boldsymbol{c}_4 \\cdot \\boldsymbol{u} = \\frac{1}{9}$,\n$\\boldsymbol{c}_5 \\cdot \\boldsymbol{u} = \\frac{1}{6}-\\frac{1}{9} = \\frac{1}{18}$,\n$\\boldsymbol{c}_6 \\cdot \\boldsymbol{u} = -\\frac{1}{6}-\\frac{1}{9} = -\\frac{5}{18}$,\n$\\boldsymbol{c}_7 \\cdot \\boldsymbol{u} = -\\frac{1}{6}+\\frac{1}{9} = -\\frac{1}{18}$,\n$\\boldsymbol{c}_8 \\cdot \\boldsymbol{u} = \\frac{1}{6}+\\frac{1}{9} = \\frac{5}{18}$。\n\n令 $S_i = 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216}$。我们计算 $f_i^{eq} = w_i (\\frac{5}{4}) S_i$：\n-   $i=0$：$S_0 = 1 - \\frac{13}{216} = \\frac{203}{216}$。$f_0^{eq} = \\frac{4}{9} \\frac{5}{4} \\frac{203}{216} = \\frac{5}{9} \\frac{203}{216} = \\frac{1015}{1944}$。\n-   $i=1$：$S_1 = 1 + 3(\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 + \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216+108+27-13}{216} = \\frac{338}{216} = \\frac{169}{108}$。$f_1^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{169}{108} = \\frac{5}{36} \\frac{169}{108} = \\frac{845}{3888}$。\n-   $i=2$：$S_2 = 1 + 3(-\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 - \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216-72+12-13}{216} = \\frac{143}{216}$。$f_2^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{143}{216} = \\frac{5}{36} \\frac{143}{216} = \\frac{715}{7776}$。\n-   $i=3$：$S_3 = 1 + 3(-\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 - \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216-108+27-13}{216} = \\frac{122}{216} = \\frac{61}{108}$。$f_3^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{61}{108} = \\frac{5}{36} \\frac{61}{108} = \\frac{305}{3888}$。\n-   $i=4$：$S_4 = 1 + 3(\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 + \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216+72+12-13}{216} = \\frac{287}{216}$。$f_4^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{287}{216} = \\frac{5}{36} \\frac{287}{216} = \\frac{1435}{7776}$。\n-   $i=5$：$S_5 = 1 + 3(\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 + \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216+36+3-13}{216} = \\frac{242}{216} = \\frac{121}{108}$。$f_5^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{121}{108} = \\frac{5}{144} \\frac{121}{108} = \\frac{605}{15552}$。\n-   $i=6$：$S_6 = 1 + 3(-\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 - \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216-180+75-13}{216} = \\frac{98}{216} = \\frac{49}{108}$。$f_6^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{49}{108} = \\frac{5}{144} \\frac{49}{108} = \\frac{245}{15552}$。\n-   $i=7$：$S_7 = 1 + 3(-\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 - \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216-36+3-13}{216} = \\frac{170}{216} = \\frac{85}{108}$。$f_7^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{85}{108} = \\frac{5}{144} \\frac{85}{108} = \\frac{425}{15552}$。\n-   $i=8$：$S_8 = 1 + 3(\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 + \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216+180+75-13}{216} = \\frac{458}{216} = \\frac{229}{108}$。$f_8^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{229}{108} = \\frac{5}{144} \\frac{229}{108} = \\frac{1145}{15552}$。\n\n### 矩恢复的验证\n\n**密度：** 总和 $\\sum_{i=0}^{8} f_i^{eq}$ 必须等于 $\\rho = \\frac{5}{4}$。根据构造，$f_i^{eq}$ 公式的解析求和结果为 $\\rho$。我们用数值来验证。使用公共分母 $15552$：\n$$ \\sum f_i^{eq} = \\frac{8120 + 3380 + 1430 + 1220 + 2870 + 605 + 245 + 425 + 1145}{15552} = \\frac{19440}{15552} = \\frac{5 \\times 3888}{4 \\times 3888} = \\frac{5}{4} $$\n密度被正确恢复。\n\n**动量：** 总和 $\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i$ 必须等于 $\\rho\\boldsymbol{u} = \\frac{5}{4}(\\frac{1}{6}, -\\frac{1}{9}) = (\\frac{5}{24}, -\\frac{5}{36})$。\n-   x-分量：$\\sum f_i^{eq} c_{ix} = f_1^{eq}-f_3^{eq}+f_5^{eq}-f_6^{eq}-f_7^{eq}+f_8^{eq}$\n$$ \\sum f_i^{eq} c_{ix} = \\frac{3380 - 1220 + 605 - 245 - 425 + 1145}{15552} = \\frac{3240}{15552} = \\frac{5 \\times 648}{24 \\times 648} = \\frac{5}{24} $$\n-   y-分量：$\\sum f_i^{eq} c_{iy} = f_2^{eq}-f_4^{eq}+f_5^{eq}+f_6^{eq}-f_7^{eq}-f_8^{eq}$\n$$ \\sum f_i^{eq} c_{iy} = \\frac{1430 - 2870 + 605 + 245 - 425 - 1145}{15552} = \\frac{-2160}{15552} = \\frac{-5 \\times 432}{36 \\times 432} = -\\frac{5}{36} $$\n动量也被正确恢复。计算值是正确的。\n因此，最终答案的十二个量为：\n$f_0^{eq} = \\frac{1015}{1944}$, $f_1^{eq} = \\frac{845}{3888}$, $f_2^{eq} = \\frac{715}{7776}$, $f_3^{eq} = \\frac{305}{3888}$, $f_4^{eq} = \\frac{1435}{7776}$, $f_5^{eq} = \\frac{605}{15552}$, $f_6^{eq} = \\frac{245}{15552}$, $f_7^{eq} = \\frac{425}{15552}$, $f_8^{eq} = \\frac{1145}{15552}$, $\\sum f_i^{eq} = \\frac{5}{4}$, $\\sum (f_i^{eq} c_{ix}) = \\frac{5}{24}$, $\\sum (f_i^{eq} c_{iy}) = -\\frac{5}{36}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1015}{1944}  \\frac{845}{3888}  \\frac{715}{7776}  \\frac{305}{3888}  \\frac{1435}{7776}  \\frac{605}{15552}  \\frac{245}{15552}  \\frac{425}{15552}  \\frac{1145}{15552}  \\frac{5}{4}  \\frac{5}{24}  -\\frac{5}{36} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "任何数值方法都不仅仅是一个黑箱，理解其内在的稳定性和数值特性至关重要。本练习将引导你使用冯·诺依曼稳定性分析，来“解剖”LBM算法，并推导剪切模式的色散关系。通过这个过程，你将亲手揭示格子玻尔兹曼方法中的数值黏性来源，这是从LBM使用者进阶为LBM开发者的必经之路。",
            "id": "3375028",
            "problem": "考虑用于等温流体的二维九速（D2Q9）Bhatnagar–Gross–Krook（BGK）格子玻尔兹曼方法（LBM）。离散速度为 $ \\mathbf{c}_{0} = (0,0) $、$ \\mathbf{c}_{1} = (1,0) $、$ \\mathbf{c}_{2} = (0,1) $、$ \\mathbf{c}_{3} = (-1,0) $、$ \\mathbf{c}_{4} = (0,-1) $、$ \\mathbf{c}_{5} = (1,1) $、$ \\mathbf{c}_{6} = (-1,1) $、$ \\mathbf{c}_{7} = (-1,-1) $、$ \\mathbf{c}_{8} = (1,-1) $，对应的权重为 $ w_{0} = \\frac{4}{9} $、$ w_{1,2,3,4} = \\frac{1}{9} $、$ w_{5,6,7,8} = \\frac{1}{36} $。分布函数 $ f_{i}(\\mathbf{x}, t) $ 的单松弛时间 BGK 更新法则为\n$$\nf_{i}(\\mathbf{x} + \\mathbf{c}_{i} \\Delta t, t + \\Delta t) = f_{i}(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau} \\left( f_{i}(\\mathbf{x}, t) - f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t) \\right),\n$$\n其中 $ \\tau $ 是松弛时间，$ f_{i}^{\\mathrm{eq}} $ 是按流体速度 $ \\mathbf{u}(\\mathbf{x}, t) $ 展开的二阶等温平衡分布函数，\n$$\nf_{i}^{\\mathrm{eq}} = w_{i} \\rho \\left[ 1 + \\frac{\\mathbf{c}_{i} \\cdot \\mathbf{u}}{c_{s}^{2}} + \\frac{(\\mathbf{c}_{i} \\cdot \\mathbf{u})^{2}}{2 c_{s}^{4}} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_{s}^{2}} \\right],\n$$\n$ \\rho $ 是质量密度，$ c_{s}^{2} $ 是格子声速的平方。对于格子单位下的 D2Q9 模型，$ c_{s}^{2} = \\frac{1}{3} $ 且 $ \\Delta x = \\Delta t = 1 $。\n\n将 D2Q9 BGK LBM 在均匀平衡态 $ \\rho(\\mathbf{x}, t) = \\rho_{0} $ 和 $ \\mathbf{u}(\\mathbf{x}, t) = \\mathbf{0} $ 周围线性化，并考虑一个横向（剪切）平面波微扰，其波矢为 $ \\mathbf{k} = (k, 0) $，因此唯一非零的速度分量是 $ u_{y}(x,t) $。对线性化后的更新方程进行 von Neumann（傅里叶）稳定性分析，并推导出剪切模式下，在 $ |k| $ 的主导阶上，复角频率 $ \\omega(k) $（由时间依赖关系 $ \\exp(- i \\omega t) $ 定义）。使用等温极限并假设流体动力学（长波）区域。\n\n从你的色散关系中，指出哪一部分对应于剪切模式中的数值耗散，哪一部分对应于数值色散。将你的最终答案表示为 $ \\omega(k) $ 关于 $ k $、$ \\tau $ 和 $ c_{s}^{2} $ 的单个闭式解析表达式。不需要数值近似或四舍五入。最终答案的表达式内不得包含单位。",
            "solution": "该问题要求对 D2Q9 BGK 格子玻尔兹曼方法（LBM）中的横向剪切波进行 von Neumann 稳定性分析，以求出长波极限下的色散关系 $\\omega(k)$。\n\n### 步骤 1：BGK 方程的线性化\n\nLBM 描述了粒子分布函数 $f_i(\\mathbf{x}, t)$ 的演化。BGK 更新法则如下：\n$$\nf_{i}(\\mathbf{x} + \\mathbf{c}_{i} \\Delta t, t + \\Delta t) = f_{i}(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau} \\left( f_{i}(\\mathbf{x}, t) - f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t) \\right)\n$$\n在格子单位下，$\\Delta t = 1$，因此方程为：\n$$\nf_{i}(\\mathbf{x} + \\mathbf{c}_{i}, t + 1) = \\left(1 - \\frac{1}{\\tau}\\right) f_{i}(\\mathbf{x}, t) + \\frac{1}{\\tau} f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t)\n$$\n我们在由恒定密度 $\\rho_0$ 和零速度 $\\mathbf{u}_0 = \\mathbf{0}$ 定义的均匀静止状态附近对系统进行线性化。分布函数和宏观变量被微扰为：\n$f_i = f_i^{(0)} + \\delta f_i$，其中 $f_i^{(0)} = w_i \\rho_0$。\n$\\rho = \\rho_0 + \\delta \\rho$。\n$\\mathbf{u} = \\mathbf{0} + \\delta \\mathbf{u}$。\n\n宏观微扰是分布函数微扰的矩：\n$\\delta \\rho = \\sum_i \\delta f_i$。\n$\\rho_0 \\delta \\mathbf{u} = \\sum_i \\mathbf{c}_i \\delta f_i$。\n\n平衡分布函数 $f_i^{\\mathrm{eq}}$ 在微扰 $\\delta \\rho$ 和 $\\delta \\mathbf{u}$ 下展开至一阶：\n$$\nf_{i}^{\\mathrm{eq}} = w_{i} (\\rho_0+\\delta\\rho) \\left[ 1 + \\frac{\\mathbf{c}_{i} \\cdot \\delta\\mathbf{u}}{c_{s}^{2}} + \\mathcal{O}(|\\delta\\mathbf{u}|^2) \\right] \\approx w_i \\rho_0 + w_i \\delta\\rho + \\frac{w_i\\rho_0}{c_s^2}(\\mathbf{c}_i \\cdot \\delta\\mathbf{u})\n$$\n平衡分布函数的微扰为 $\\delta f_i^{\\mathrm{eq}} = f_i^{\\mathrm{eq}} - f_i^{(0)}$：\n$$\n\\delta f_i^{\\mathrm{eq}} = w_i \\delta\\rho + \\frac{w_i\\rho_0}{c_s^2}(\\mathbf{c}_i \\cdot \\delta\\mathbf{u})\n$$\n将微扰量代入 BGK 方程并仅保留一阶项，得到微扰的线性化 LBE：\n$$\n\\delta f_{i}(\\mathbf{x} + \\mathbf{c}_{i}, t + 1) = \\left(1 - \\frac{1}{\\tau}\\right) \\delta f_{i}(\\mathbf{x}, t) + \\frac{1}{\\tau} \\delta f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t)\n$$\n\n### 步骤 2：傅里叶分析\n我们通过假设所有微扰都具有平面波形式 $\\delta A(\\mathbf{x}, t) = \\hat{A} \\exp(i \\mathbf{k} \\cdot \\mathbf{x} - i \\omega t)$ 来进行 von Neumann 分析。时间步进算子的特征值为 $\\lambda = \\exp(-i \\omega \\Delta t) = \\exp(-i\\omega)$。线性化的 LBE 变为关于傅里叶振幅 $\\widehat{\\delta f_i}$ 的代数方程：\n$$\n\\lambda e^{i \\mathbf{k} \\cdot \\mathbf{c}_i} \\widehat{\\delta f_i} = \\left(1 - \\frac{1}{\\tau}\\right) \\widehat{\\delta f_i} + \\frac{1}{\\tau} \\widehat{\\delta f_i^{\\mathrm{eq}}}\n$$\n整理得到 $\\widehat{\\delta f_i}$：\n$$\n\\widehat{\\delta f_i} = \\frac{1/\\tau}{\\lambda e^{i \\mathbf{k} \\cdot \\mathbf{c}_i} - (1 - 1/\\tau)} \\widehat{\\delta f_i^{\\mathrm{eq}}}\n$$\n对于横向剪切波的特定情况，波矢为 $\\mathbf{k}=(k, 0)$，速度微扰为纯横向，即 $\\delta\\mathbf{u}=(0, \\delta u_y)$。对于纯剪切模式，密度微扰为零，即 $\\delta\\rho = 0$。这与 Navier-Stokes 方程一致，并且可以验证在 LBM 方程中这是一个一致的解耦。在这些条件下，平衡分布的微扰简化为：\n$$\n\\widehat{\\delta f_i^{\\mathrm{eq}}} = \\frac{w_i \\rho_0}{c_s^2} c_{iy} \\widehat{\\delta u_y}\n$$\n将此代入 $\\widehat{\\delta f_i}$ 的表达式中：\n$$\n\\widehat{\\delta f_i} = \\frac{1/\\tau}{\\lambda e^{i k c_{ix}} - (1 - 1/\\tau)} \\frac{w_i \\rho_0}{c_s^2} c_{iy} \\widehat{\\delta u_y}\n$$\n\n### 步骤 3：色散关系的推导\n通过对速度矩施加自洽条件 $\\rho_0 \\widehat{\\delta u_y} = \\sum_i c_{iy} \\widehat{\\delta f_i}$ 来找到色散关系。\n$$\n\\rho_0 \\widehat{\\delta u_y} = \\sum_i c_{iy} \\left( \\frac{1/\\tau}{\\lambda e^{i k c_{ix}} - (1 - 1/\\tau)} \\frac{w_i \\rho_0}{c_s^2} c_{iy} \\widehat{\\delta u_y} \\right)\n$$\n假设存在非平凡解 $\\widehat{\\delta u_y} \\neq 0$，我们可以从两边消去 $\\rho_0 \\widehat{\\delta u_y}$，得到精确的色散关系：\n$$\n1 = \\frac{1}{\\tau c_s^2} \\sum_i \\frac{w_i c_{iy}^2}{\\lambda e^{i k c_{ix}} - (1 - 1/\\tau)}\n$$\n我们现在在流体动力学极限下分析这个关系，其中 $k$ 和 $\\omega$ 很小。这对应于 $\\lambda = e^{-i\\omega} \\approx 1-i\\omega$。对于扩散模式，$\\omega \\sim k^2$。我们将分母展开到 $k$ 的二阶：\n$$\n\\lambda e^{i k c_{ix}} \\approx (1-i\\omega)(1 + i k c_{ix} - \\frac{1}{2} k^2 c_{ix}^2) \\approx 1 - i\\omega + i k c_{ix} - \\frac{1}{2} k^2 c_{ix}^2\n$$\n令 $A = \\lambda - (1 - 1/\\tau)$。分母为 $A + \\lambda(ik c_{ix} - \\frac{1}{2} k^2 c_{ix}^2)$。我们使用泰勒级数展开分数 $1/(A+\\dots)$：\n$$\n\\frac{1}{A + \\delta} \\approx \\frac{1}{A}\\left(1 - \\frac{\\delta}{A} + \\frac{\\delta^2}{A^2}\\right)\n$$\n其中 $\\delta = \\lambda(ik c_{ix} - \\frac{1}{2} k^2 c_{ix}^2)$。让我们将其代入求和式中：\n$$\n\\tau c_s^2 = \\sum_i \\frac{w_i c_{iy}^2}{A} \\left[ 1 - \\frac{\\lambda}{A}\\left(ikc_{ix} - \\frac{k^2c_{ix}^2}{2}\\right) + \\frac{\\lambda^2}{A^2}(ik c_{ix})^2 + \\dots \\right]\n$$\n按 $k$ 的幂次整理各项：\n$$\n\\tau c_s^2 = \\frac{1}{A}\\sum_i w_i c_{iy}^2 - \\frac{i a k}{A^2}\\sum_i w_i c_{iy}^2c_{ix} + \\frac{k^2}{A^2}\\left(\\frac{a}{2}\\sum_i w_i c_{iy}^2c_{ix}^2 - \\frac{a^2}{A}\\sum_i w_i c_{iy}^2c_{ix}^2\\right) + \\mathcal{O}(k^3)\n$$\n使用 D2Q9 格子的以下各向同性性质：\n$\\sum_i w_i c_{iy}^2 = c_s^2$\n$\\sum_i w_i c_{iy}^2 c_{ix} = 0$ (由于对称性)\n$\\sum_i w_i c_{ix}^2 c_{iy}^2 = c_s^4$ (对于 D2Q9。通常，$\\sum_i w_i c_{i\\alpha}c_{i\\beta}c_{i\\gamma}c_{i\\delta}=c_s^4(\\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta}+\\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta}+\\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma})$)\n\n色散关系简化为：\n$$\n\\tau c_s^2 = \\frac{c_s^2}{A} + k^2 c_s^4 \\left( \\frac{\\lambda}{2A^2} - \\frac{\\lambda^2}{A^3} \\right)\n$$\n在流体动力学极限下（$k \\to 0, \\omega \\to 0$），$\\lambda \\to 1$ 且 $A \\to 1 - (1-1/\\tau) = 1/\\tau$。我们保留 $\\omega$ 和 $k^2$ 的主导阶项。\n令 $A = 1/\\tau - i\\omega$。\n$$\n\\tau c_s^2 = \\frac{c_s^2}{1/\\tau - i\\omega} + k^2 c_s^4 \\left( \\frac{1}{2(1/\\tau)^2} - \\frac{1}{(1/\\tau)^3} \\right) + \\mathcal{O}(\\omega^2, k^4, \\omega k^2)\n$$\n$$\n\\tau c_s^2 \\approx c_s^2 \\tau(1+i\\omega\\tau) + k^2 c_s^4 \\tau^2 \\left(\\frac{1}{2}-\\tau\\right)\n$$\n$$\n\\tau c_s^2 \\approx \\tau c_s^2 + i\\omega\\tau^2 c_s^2 + k^2 c_s^4 \\tau^2 \\left(\\frac{1}{2}-\\tau\\right)\n$$\n从两边消去 $\\tau c_s^2$：\n$$\n0 \\approx i\\omega\\tau^2 c_s^2 + k^2 c_s^4 \\tau^2 \\left(\\frac{1}{2}-\\tau\\right)\n$$\n求解 $\\omega(k)$：\n$$\ni\\omega = -k^2 \\frac{c_s^4 \\tau^2}{c_s^2 \\tau^2} \\left(\\frac{1}{2}-\\tau\\right) = -k^2 c_s^2 \\left(\\frac{1}{2}-\\tau\\right) = k^2 c_s^2 \\left(\\tau-\\frac{1}{2}\\right)\n$$\n$$\n\\omega(k) = -i k^2 c_s^2 \\left(\\tau - \\frac{1}{2}\\right)\n$$\n\n### 步骤 4：数值耗散和数值色散的识别\n推导出的主导阶色散关系为 $\\omega(k) = -i k^2 c_s^2 (\\tau - \\frac{1}{2})$。\n复频率 $\\omega(k)$ 可以分解为其实部和虚部，$\\omega(k) = \\mathrm{Re}(\\omega) + i\\,\\mathrm{Im}(\\omega)$。模式的时间依赖性由 $\\exp(-i\\omega t) = \\exp(-i\\mathrm{Re}(\\omega)t) \\exp(\\mathrm{Im}(\\omega)t)$ 给出。\n\n1.  **数值色散**：实部 $\\mathrm{Re}(\\omega)$ 控制模式的传播速度。对于我们的结果，$\\mathrm{Re}(\\omega) = 0$。这对于剪切模式是物理上正确的，因为它在不可压缩的 Navier-Stokes 方程中是纯扩散且不传播的。主导阶项中没有实部意味着在此近似水平上没有数值色散。数值色散会表现为非零的实部项，通常为 $\\mathcal{O}(k^3)$ 或更高阶。\n\n2.  **数值耗散**：虚部 $\\mathrm{Im}(\\omega)$ 控制模式的增长或衰减率。此处，$\\mathrm{Im}(\\omega) = -k^2 c_s^2 (\\tau - \\frac{1}{2})$。为使模式稳定（衰减），我们需要 $\\mathrm{Im}(\\omega)  0$，这要求 $\\tau > 1/2$。衰减率为 $-\\mathrm{Im}(\\omega) = k^2 c_s^2 (\\tau - \\frac{1}{2})$。在对应的连续介质方程 $\\partial_t u_y = \\nu \\nabla^2 u_y$ 中，衰减率为 $\\nu k^2$。通过比较，LBM 流体的有效运动粘度为 $\\nu_{\\mathrm{LBM}} = c_s^2 (\\tau - 1/2)$。这个有效粘度可以分解为两部分：\n    $$\n    \\nu_{\\mathrm{LBM}} = \\underbrace{c_s^2 \\tau}_{\\text{物理}} - \\underbrace{\\frac{c_s^2}{2}}_{\\text{数值}}\n    $$\n    $c_s^2 \\tau$ 项源于 BGK 碰撞模型，对应于物理粘度。$-c_s^2/2$ 项是迁移算子（$\\mathbf{x} \\to \\mathbf{x}+\\mathbf{c}_i \\Delta t$）有限时间步长离散化的产物。它代表了对耗散的数值贡献。在这种情况下，它是一个反耗散项，降低了总的有效粘度。因此，色散关系中对应于数值耗散的部分与有效粘度中的 $-c_s^2/2$ 项相关。\n\n复角频率的最终表达式由该分析推导得出。",
            "answer": "$$\n\\boxed{-i k^{2} c_{s}^{2} \\left(\\tau - \\frac{1}{2}\\right)}\n$$"
        },
        {
            "introduction": "理论的最终目的是指导实践。本练习是一个综合性的编程项目，要求你从零开始构建一个二维LBM模拟器，用于研究经典的泰勒-格林涡的衰减过程。更有挑战性的是，你将引入大涡模拟（LES）中的Smagorinsky模型，这让你能够一窥LBM在模拟复杂湍流问题中的强大潜力，体验如何通过亚格子模型来捕捉那些无法被网格直接解析的物理效应。",
            "id": "3375021",
            "problem": "您的任务是从第一性原理出发，在格子玻尔兹曼方法（LBM）框架下构建一个完整的数值模拟器，以研究二维泰勒-格林涡的衰减过程，以及通过 Smagorinsky 大涡模拟（LES）闭合项进行的亚格子建模对动能衰减率的影响。该模拟器必须是一个完全独立、可直接运行的单一程序。\n\n其基本出发点是通过玻尔兹曼方程及其在离散速度下的单弛豫时间 Bhatnagar-Gross-Krook（BGK）模型来对流体动力学进行动力学表述。在二维九速（$\\mathrm{D2Q9}$）格子中，离散粒子分布函数 $f_i(\\mathbf{x}, t)$ 在碰撞和迁移的共同作用下演化。宏观密度 $\\rho(\\mathbf{x}, t)$ 和速度 $\\mathbf{u}(\\mathbf{x}, t)$ 通过对 $f_i$ 取速度矩来恢复。平衡分布函数 $f_i^{\\mathrm{eq}}$ 的定义是通过将其矩与等温格子的流体动力学场相匹配，而碰撞步骤则以弛豫时间 $\\tau$ 控制的速率使 $f_i$ 向 $f_i^{\\mathrm{eq}}$ 松弛。在格子单位中，运动粘度 $\\nu$ 通过 $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$ 与弛豫时间相关联，其中 $c_s^2$ 是格子声速的平方。您必须将 Smagorinsky LES 闭合项建模为一个基于局部应变率张量模的局部涡粘度 $\\nu_t$，从而定义一个有效粘度 $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$ 和一个局部弛豫时间 $\\tau_{\\mathrm{eff}} = \\frac{\\nu_{\\mathrm{eff}}}{c_s^2} + \\frac{1}{2}$。滤波宽度必须取为与格子间距相等。\n\n目标流场是边长为 $L$ 的周期性方形区域上的二维泰勒-格林涡，其初始速度场无散，由下式给出：\n$$\nu_x(x,y,0) = U_0 \\cos(k x)\\,\\sin(k y), \\qquad\nu_y(x,y,0) = - U_0 \\sin(k x)\\,\\cos(k y),\n$$\n其中基本波数 $k = \\frac{2\\pi}{L}$。对于不可压缩粘性流体，模态振幅随时间衰减，单位质量动能\n$$\nE(t) = \\frac{1}{2}\\left\\langle u_x^2 + u_y^2 \\right\\rangle,\n$$\n具有一个已知的参考演化过程，您必须将其用作无亚格子建模情况下的直接数值模拟（DNS）比较基准。您的实现必须对 LBM 方程进行时间上的数值积分，计算最终时刻的空间平均动能 $E_{\\mathrm{LBM}}(t)$，并将其与根据层流（无 LES）情况下泰勒-格林涡的精确粘性衰减计算出的解析参考解 $E_{\\mathrm{ref}}(t)$ 进行比较。Smagorinsky 常数 $C_s$ 的影响必须通过由局部应变率张量模定义的涡粘度 $\\nu_t$ 来引入。\n\n您必须从以下基本原理出发进行推导：\n- 二维情况下带有 Bhatnagar-Gross-Krook（BGK）弛豫项的离散速度玻尔兹曼方程。\n- 通过分布函数的速度矩定义宏观场。\n- 通过厄米投影获得的、在密度和动量上匹配到二阶的等温格子平衡分布函数。\n- 在 $\\mathrm{D2Q9}$ 格子单位下，关系式 $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$。\n- 用于大涡模拟（LES）的 Smagorinsky 模型，其中涡粘度为 $\\nu_t = \\left(C_s \\Delta\\right)^2 \\left\\lVert S \\right\\rVert$，$\\Delta$ 为滤波宽度，$\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$，且 $S_{ij} = \\frac{1}{2}\\left(\\partial_j u_i + \\partial_i u_j\\right)$。\n- 用于参考比较的二维精确层流泰勒-格林涡衰减。\n\n您的程序必须实现：\n- 在方形格子上具有周期性边界条件的二维 $\\mathrm{D2Q9}$ LBM。\n- 从 $\\nu_{\\mathrm{eff}}(\\mathbf{x}, t) = \\nu + \\nu_t(\\mathbf{x}, t)$ 得到的局部弛豫时间 $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)$，其中 $\\nu_t$ 使用中心差分计算速度梯度，且 $\\Delta = 1$（格子间距）。\n- 使用泰勒-格林涡速度场和均匀密度进行初始化。\n\n科学与数值参数及单位：\n- 完全在格子单位下工作，$\\Delta x = \\Delta y = \\Delta t = 1$，因此在此设定下所有量均为无量纲。\n- 格子尺寸 $N_x = N_y = 64$，因此 $L = 64$ 且 $k = \\frac{2\\pi}{64}$。\n- 基础运动粘度 $\\nu = 0.01$。\n- 初始速度幅值 $U_0 = 0.05$。\n- 总时间步数 $N_t = 300$。\n- 使用标准的 $\\mathrm{D2Q9}$ 速度和权重，以及 $c_s^2 = \\frac{1}{3}$。\n\n测试套件：\n- 程序必须运行四个测试用例，每个用例由一个 Smagorinsky 常数 $C_s$ 指定：$C_s = 0.0$（无 LES）、$C_s = 0.12$、$C_s = 0.18$ 和 $C_s = 0.24$。\n- 对于每个测试用例，计算最终时刻的 LBM 动能 $E_{\\mathrm{LBM}}(t=N_t)$、基于层流泰勒-格林衰减的解析参考能量 $E_{\\mathrm{ref}}(t=N_t)$，并报告无量纲偏差\n$$\n\\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1.\n$$\n\n输出规格：\n- 您的程序必须生成单行输出，其中包含四个测试用例的结果，形式为方括号内的逗号分隔列表，例如 $\\left[\\delta_1,\\delta_2,\\delta_3,\\delta_4\\right]$。\n- 每个 $\\delta(C_s)$ 必须是四舍五入到六位小数的十进制数。\n- 输出是无量纲的，并且必须严格按照指定的单行格式打印。\n\n解决方案必须从上述基本原理出发，推导并论证其数值步骤和诊断量，解释为何在此背景下泰勒-格林涡衰减是合适的 DNS 参考，并阐明 Smagorinsky 常数如何以及为何通过增加有效粘度来改变衰减过程。特别要确保您的推导清晰地展示了 LBM 的更新步骤，解释了为什么它在该体系下是正确的，以及算法如何以科学上一致的方式计算应变率和涡粘度。避免非物理配置，并通过在所有位置保持弛豫时间大于 $\\frac{1}{2}$ 来确保稳定性。",
            "solution": "该问题陈述是计算流体动力学中一个有效且适定的数值实验。它要求开发一个格子玻尔兹曼方法（LBM）模拟器，用于研究一个二维衰减湍流，特别是泰勒-格林涡。该问题包括与解析解的比较，以及对亚格子尺度模型——Smagorinsky 大涡模拟（LES）模型——效果的研究。所有必要的物理和数值参数都已提供，并且该问题在流体动力学和数值方法的既定原理上具有科学依据。\n\n按照要求，解决方案将从第一性原理出发进行开发。我们首先从格子玻尔兹曼方法的理论基础开始，然后引入 Smagorinsky LES 模型，详细说明泰勒-格林涡流的特性，最后概述完整的数值算法和待计算的诊断量。\n\n**1. 格子玻尔兹曼方程**\n\nLBM 描述了在离散格子上，一组粒子分布函数 $f_i(\\mathbf{x}, t)$ 的演化。每个函数 $f_i$ 代表在位置 $\\mathbf{x}$ 和时间 $t$ 以离散速度 $\\mathbf{c}_i$ 运动的粒子密度。其演化由离散速度玻尔兹曼方程控制。采用 Bhatnagar-Gross-Krook（BGK）近似来处理碰撞项，该方程为：\n$$\n\\frac{\\partial f_i}{\\partial t} + \\mathbf{c}_i \\cdot \\nabla f_i = -\\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n其中 $\\tau$ 是单弛豫时间，它控制分布函数向局部平衡分布 $f_i^{\\mathrm{eq}}$ 松弛的速率。在时间和空间上对该方程进行离散化，并设 $\\Delta t = \\Delta x = 1$（格子单位），即可得到 LBM 的更新规则，该规则通常分为两步：碰撞和迁移。\n\n**碰撞步骤**：处理方程右侧。在每个格点上计算碰撞后的分布 $f_i^*$：\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n\n**迁移步骤**：处理方程左侧的平流项。碰撞后的粒子群根据其离散速度移动到相邻格点：\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n$$\n在我们的格子单位中，这简化为 $f_i(\\mathbf{x} + \\mathbf{c}_i, t + 1) = f_i^*(\\mathbf{x}, t)$。\n\n**2. D2Q9 格子模型**\n\n对于二维流动，D2Q9 模型是标准模型。它使用一个具有九个离散速度 $\\mathbf{c}_i$（$i=0, \\dots, 8$）的方形格子。\n-   $\\mathbf{c}_0 = (0, 0)$（静止粒子）\n-   $\\mathbf{c}_{1,2,3,4} = (1, 0), (0, 1), (-1, 0), (0, -1)$（轴向速度，速率为 $1$）\n-   $\\mathbf{c}_{5,6,7,8} = (1, 1), (-1, 1), (-1, -1), (1, -1)$（对角线速度，速率为 $\\sqrt{2}$）\n\n与每个速度相关联的是一个权重 $w_i$：\n-   $w_0 = 4/9$\n-   $w_{1,2,3,4} = 1/9$\n-   $w_{5,6,7,8} = 1/36$\n\n选择这些权重和速度是为了确保该模型在低马赫数极限下能够恢复纳维-斯托克斯方程。格子声速由 $c_s^2 = \\sum_i w_i (\\mathbf{c}_{ix})^2 = 1/3$ 给出。\n\n**3. 宏观流体动力学变量**\n\n宏观流体密度 $\\rho$ 和动量 $\\rho \\mathbf{u}$（以及速度 $\\mathbf{u}$）是作为分布函数的矩来恢复的：\n$$\n\\rho(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t)\n$$\n$$\n\\rho(\\mathbf{x}, t) \\mathbf{u}(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t) \\mathbf{c}_i\n$$\n\n**4. 平衡分布函数**\n\n平衡分布 $f_i^{\\mathrm{eq}}$ 是局部宏观密度和速度的函数。对于近乎不可压缩（低马赫数）的体系，使用 Maxwell-Boltzmann 分布在速度 $\\mathbf{u}$ 上的二阶展开：\n$$\nf_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_s^2} \\right]\n$$\n这种形式确保 $f_i^{\\mathrm{eq}}$ 的矩能返回正确的宏观 $\\rho$ 和 $\\rho\\mathbf{u}$，这对于恢复正确形式的纳维-斯托克斯方程至关重要。\n\n**5. 粘度与 Smagorinsky LES 模型**\n\n通过 Chapman-Enskog 展开可以证明，LBM-BGK 模型能够恢复纳维-斯托克斯方程，其运动粘度 $\\nu$ 与弛豫时间 $\\tau$ 的关系为：\n$$\n\\nu = c_s^2 \\left( \\tau - \\frac{1}{2} \\right)\n$$\n该问题要求模拟一个可能在小于格子分辨率的尺度上发展出湍流特征的流动。大涡模拟（LES）是一种用于模拟这些未解析的亚格子尺度对已解析流动影响的技术。Smagorinsky 模型是一种代数亚格子尺度模型，它引入了一个涡粘度 $\\nu_t$，该粘度取决于已解析流动的局部应变率。\n总有效粘度变为 $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$，其中 $\\nu$ 是基础分子粘度。涡粘度由下式给出：\n$$\n\\nu_t = (C_s \\Delta)^2 \\left\\lVert S \\right\\rVert\n$$\n这里，$C_s$ 是无量纲的 Smagorinsky 常数，$\\Delta$ 是滤波宽度（取为格子间距，因此 $\\Delta = 1$），而 $\\left\\lVert S \\right\\rVert$ 是已解析尺度应变率张量 $S_{ij}$ 的模。\n\n应变率张量定义为 $S_{ij} = \\frac{1}{2}(\\partial_j u_i + \\partial_i u_j)$，其中 $\\partial_i \\equiv \\partial/\\partial x_i$。其模为 $\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$。在二维情况下，展开为：\n$$\n\\left\\lVert S \\right\\rVert = \\sqrt{2 \\left( S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2 \\right)}\n$$\n其中 $S_{xx} = \\partial_x u_x$，$S_{yy} = \\partial_y u_y$，$S_{xy} = \\frac{1}{2}(\\partial_y u_x + \\partial_x u_y)$。这些速度梯度必须在每个时间步从格子上的速度场数值计算得到。我们使用二阶中心差分格式，例如 $\\partial_x \\phi(x,y) \\approx (\\phi(x+1,y) - \\phi(x-1,y))/2$。\n\n$\\nu_t$ 的引入意味着粘度不再是均匀的。通过定义一个局部的、随时间变化的有效弛豫时间 $\\tau_{\\mathrm{eff}}$，将其整合到 LBM 中：\n$$\n\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = \\frac{\\nu_{\\mathrm{eff}}(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2} = \\frac{\\nu + \\nu_t(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2}\n$$\n然后使用这个局部的 $\\tau_{\\mathrm{eff}}$ 来执行碰撞步骤：\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n较大的 $C_s$ 会在高剪切区域导致较大的涡粘度，从而产生较大的 $\\tau_{\\mathrm{eff}}$，并因此增强动能的耗散，模拟了湍流涡的物理效应。为保证稳定性，要求处处满足 $\\tau_{\\mathrm{eff}} > 1/2$。由于 $\\nu > 0$ 且 $\\nu_t \\ge 0$，该条件由问题参数（$\\nu=0.01$，因此基础 $\\tau = 0.53 > 0.5$）所满足。\n\n**6. 泰勒-格林涡**\n\n泰勒-格林涡是双周期域上不可压缩纳维-斯托克斯方程的一个精确解。它作为验证粘性流和湍流数值格式的典范问题。初始速度场由下式给出：\n$$\nu_x(x,y,0) = U_0 \\cos(kx)\\sin(ky)\n$$\n$$\nu_y(x,y,0) = -U_0 \\sin(kx)\\cos(ky)\n$$\n其中 $k = 2\\pi/L$ 是边长为 $L$ 的区域的基本波数。\n对于层流情况（即没有任何湍流模型，对应于 $C_s=0$），速度场解析地衰减为：\n$$\nu_x(x,y,t) = U_0 \\cos(kx)\\sin(ky) e^{-2\\nu k^2 t}\n$$\n$$\nu_y(x,y,t) = -U_0 \\sin(kx)\\cos(ky) e^{-2\\nu k^2 t}\n$$\n空间平均的单位质量动能 $E(t) = \\frac{1}{2} \\langle u_x^2 + u_y^2 \\rangle$ 提供了一个单一的度量来追踪流动的演化。对于解析解，此值为：\n$$\nE_{\\mathrm{ref}}(t) = \\frac{1}{2} \\left\\langle U_0^2 e^{-4\\nu k^2 t} (\\cos^2(kx)\\sin^2(ky) + \\sin^2(kx)\\cos^2(ky)) \\right\\rangle\n$$\n利用在一个周期内 $\\langle \\cos^2(\\cdot) \\rangle = \\langle \\sin^2(\\cdot) \\rangle = 1/2$ 的事实，空间平均项变为 $\\langle \\dots \\rangle = (1/2)(1/2) + (1/2)(1/2) = 1/2$。因此，参考解析能量衰减为：\n$$\nE_{\\mathrm{ref}}(t) = \\frac{U_0^2}{4} e^{-4\\nu k^2 t}\n$$\n这提供了基准（“DNS 参考”），可用于验证 $C_s=0$ 时的 LBM 模拟，并量化 $C_s>0$ 时 LES 模型的效果。\n\n**7. 数值算法与诊断**\n\n单个测试用例的完整算法如下：\n\n-   **初始化（$t=0$）：**\n    1.  为尺寸为 $N_x \\times N_y$ 的区域定义格子网格 $(x, y)$。此处 $N_x = N_y = L = 64$。\n    2.  将初始密度设为常数，$\\rho(\\mathbf{x}, 0) = \\rho_0 = 1$。\n    3.  使用泰勒-格林涡方程计算初始速度场 $\\mathbf{u}(\\mathbf{x}, 0)$。\n    4.  将分布函数初始化为其平衡值：$f_i(\\mathbf{x}, 0) = f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x}, 0), \\mathbf{u}(\\mathbf{x}, 0))$。\n\n-   **时间循环（从 $t=1$ 到 $N_t$）：**\n    1.  **迁移**：粒子群被移动到相邻格点。拉式格式在计算上很高效：$f_i(\\mathbf{x}, t_{post-stream}) = f_i(\\mathbf{x}-\\mathbf{c}_i, t_{post-collision})$。周期性边界条件可以通过模运算或 `numpy.roll` 自然处理。\n    2.  **宏观场**：使用矩求和从迁移后的粒子群 $f_i$ 计算 $\\rho(\\mathbf{x}, t)$ 和 $\\mathbf{u}(\\mathbf{x}, t)$。\n    3.  **LES 计算（如果 $C_s > 0$）：**\n        a. 通过二阶中心差分计算速度梯度分量（$\\partial_x u_x, \\partial_y u_x, \\ldots$）。\n        b. 组装应变率张量分量 $S_{ij}$ 并计算其模 $\\left\\lVert S \\right\\rVert$。\n        c. 计算涡粘度 $\\nu_t(\\mathbf{x}, t) = C_s^2 \\left\\lVert S(\\mathbf{x}, t) \\right\\rVert$。\n        d. 确定局部有效弛豫时间 $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = (\\nu + \\nu_t)/c_s^2 + 1/2$。\n    4.  **碰撞**：\n        a. 从当前的宏观 $\\rho$ 和 $\\mathbf{u}$ 计算平衡分布 $f_i^{\\mathrm{eq}}(\\mathbf{x}, t)$。\n        b. 使用局部弛豫时间 $\\tau_{\\mathrm{eff}}$（如果 $C_s=0$ 则使用恒定的基础 $\\tau$）应用碰撞步骤：\n           $f_i(\\mathbf{x}, t_{post-collision}) = f_i - (1/\\tau_{\\mathrm{eff}})(f_i - f_i^{\\mathrm{eq}})$。\n\n-   **最终计算（$t=N_t$）：**\n    1.  在最后一个时间步之后，计算最终速度场 $\\mathbf{u}(\\mathbf{x}, N_t)$。\n    2.  通过在区域上求平均来计算数值动能：$E_{\\mathrm{LBM}}(N_t) = \\frac{1}{2 N_x N_y} \\sum_{\\mathbf{x}} (u_x^2(\\mathbf{x}, N_t) + u_y^2(\\mathbf{x}, N_t))$。\n    3.  计算解析参考能量 $E_{\\mathrm{ref}}(N_t) = (U_0^2/4) \\exp(-4\\nu k^2 N_t)$。\n    4.  计算最终诊断量，即无量纲偏差 $\\delta(C_s)$：\n        $$\n        \\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1\n        $$\n对于 Smagorinsky 常数 $C_s$ 的每个指定值，重复此过程。$C_s=0$ 的情况用于验证底层求解器的准确性，我们期望 $\\delta(0) \\approx 0$。对于 $C_s>0$，由于涡粘度导致的耗散增强将使 $E_{\\mathrm{LBM}}(N_t)$ 小于 $E_{\\mathrm{ref}}(N_t)$，从而产生负的 $\\delta(C_s)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates the decay of a 2D Taylor-Green vortex using the Lattice Boltzmann Method\n    with a Smagorinsky LES model.\n    \"\"\"\n    \n    # Scientific and numerical parameters in lattice units\n    Nx = 64          # Lattice size in x-direction\n    Ny = 64          # Lattice size in y-direction\n    Nt = 300         # Total number of time steps\n    nu = 0.01        # Base kinematic viscosity\n    U0 = 0.05        # Initial velocity amplitude\n    rho0 = 1.0       # Initial uniform density\n    \n    test_cases_Cs = [0.0, 0.12, 0.18, 0.24] # Smagorinsky constants\n\n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=int)\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1.0 / 3.0  # Speed of sound squared\n\n    # Pre-calculate reference energy decay for comparison\n    k = 2.0 * np.pi / Nx\n    E_ref_final = (U0**2 / 4.0) * np.exp(-4.0 * nu * k**2 * Nt)\n\n    results = []\n    \n    for Cs in test_cases_Cs:\n        \n        # --- Initialization ---\n        # Create lattice grid\n        x = np.arange(Nx)\n        y = np.arange(Ny)\n        X, Y = np.meshgrid(x, y)\n\n        # Initialize velocity field (Taylor-Green vortex)\n        ux = U0 * np.cos(k * X) * np.sin(k * Y)\n        uy = -U0 * np.sin(k * X) * np.cos(k * Y)\n\n        # Initialize density\n        rho = np.full((Ny, Nx), rho0)\n\n        # Initialize distribution functions to equilibrium\n        u_sq = ux**2 + uy**2\n        c_dot_u = np.einsum('ia,yxa->iyx', c, np.stack([ux, uy], axis=-1))\n        \n        feq = np.zeros((9, Ny, Nx))\n        for i in range(9):\n            feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n        \n        f = feq.copy()\n        \n        # Base relaxation time (for Cs=0 case)\n        tau_base = nu / cs2 + 0.5\n        omega_base = 1.0 / tau_base\n\n        # --- Time-stepping loop ---\n        for t in range(Nt):\n            # Streaming (pull scheme)\n            for i in range(9):\n                f[i, :, :] = np.roll(f[i, :, :], c[i], axis=(1, 0))\n\n            # Macroscopic variables from streamed populations\n            rho = np.sum(f, axis=0)\n            ux = np.einsum('iyx,i->yx', f, c[:, 0]) / rho\n            uy = np.einsum('iyx,i->yx', f, c[:, 1]) / rho\n\n            # --- Collision Step ---\n            # Equilibrium distribution\n            u_sq = ux**2 + uy**2\n            c_dot_u = np.einsum('ia,yxa->iyx', c, np.stack([ux, uy], axis=-1))\n            for i in range(9):\n                feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n\n            # Determine relaxation parameter omega\n            if Cs > 0:\n                # Calculate strain rate tensor components using central differences\n                # Gradients are calculated using np.roll for periodic boundaries\n                # dux/dx\n                grad_ux_x = (np.roll(ux, -1, axis=1) - np.roll(ux, 1, axis=1)) / 2.0\n                # dux/dy\n                grad_ux_y = (np.roll(ux, -1, axis=0) - np.roll(ux, 1, axis=0)) / 2.0\n                # duy/dx\n                grad_uy_x = (np.roll(uy, -1, axis=1) - np.roll(uy, 1, axis=1)) / 2.0\n                # duy/dy\n                grad_uy_y = (np.roll(uy, -1, axis=0) - np.roll(uy, 1, axis=0)) / 2.0\n                \n                Sxx = grad_ux_x\n                Syy = grad_uy_y\n                Sxy = 0.5 * (grad_ux_y + grad_uy_x)\n\n                # Strain rate magnitude\n                S_mag = np.sqrt(2.0 * (Sxx**2 + Syy**2 + 2.0 * Sxy**2))\n                \n                # Eddy viscosity\n                nu_t = (Cs**2) * S_mag # Delta = 1 in lattice units\n                \n                # Effective relaxation time\n                tau_eff = (nu + nu_t) / cs2 + 0.5\n                omega = 1.0 / tau_eff\n            else:\n                omega = omega_base\n            \n            # Apply collision\n            f += omega * (feq - f)\n            \n        # --- Post-processing ---\n        # Final kinetic energy from LBM simulation\n        final_ux = np.einsum('iyx,i->yx', f, c[:, 0]) / np.sum(f, axis=0)\n        final_uy = np.einsum('iyx,i->yx', f, c[:, 1]) / np.sum(f, axis=0)\n        E_lbm_final = 0.5 * np.mean(final_ux**2 + final_uy**2)\n\n        # Calculate dimensionless deviation\n        deviation = (E_lbm_final / E_ref_final) - 1.0\n        results.append(deviation)\n\n    # Final print statement in the exact required format\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}