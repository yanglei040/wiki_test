{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将引导你在一个简化的二维环境中，逐步了解推进前沿方法（AFM）的核心机制。通过为一个方形区域手动生成最初的几个三角形，你将具体理解前沿是如何被定义的，新单元是如何创建的，以及在算法的每一步中前沿是如何更新的。这个练习为更复杂的三维应用奠定了基础。",
            "id": "3289637",
            "problem": "考虑一个凸方形域，用于通过推进前沿法 (Advancing-Front Method, AFM) 进行非结构化三角剖分，该域由逆时针排序的顶点 $V_1 = (0, 0)$、$V_2 = (l, 0)$、$V_3 = (l, l)$ 和 $V_4 = (0, l)$ 定义，其中 $l > 0$ 是以米为单位的均匀目标边长。初始前沿是由有向边 $(V_1 \\rightarrow V_2)$、$(V_2 \\rightarrow V_3)$、$(V_3 \\rightarrow V_4)$ 和 $(V_4 \\rightarrow V_1)$ 按逆时针顺序组成的多边形边界。\n\n使用AFM（推进前沿法）的等边放置规则：给定一个活动前沿边 $(A \\rightarrow B)$，构造一个候选顶点 $P$，使得三角形 $(A, B, P)$ 是以 $(A, B)$ 为底的等边三角形，并选择位于域内部一侧的顶点。对于一个逆时针定向的凸多边形，其内部位于每条有向边界边的左侧。令等边三角形顶点通过将边向量 $B - A$ 绕点 $A$ 旋转 $+60^{\\circ}$ （左侧选择）形成，即 $P = A + R_{+60^{\\circ}}(B - A)$，其中旋转矩阵为\n$$\nR_{+60^{\\circ}} \\;=\\; \\begin{pmatrix}\n\\cos(60^{\\circ})  -\\sin(60^{\\circ}) \\\\\n\\sin(60^{\\circ})  \\cos(60^{\\circ})\n\\end{pmatrix} \\;=\\; \\begin{pmatrix}\n\\frac{1}{2}  -\\frac{\\sqrt{3}}{2} \\\\\n\\frac{\\sqrt{3}}{2}  \\frac{1}{2}\n\\end{pmatrix}.\n$$\n按以下步骤进行：\n- 首先选择活动边 $(V_1 \\rightarrow V_2)$ 并插入相应的等边顶点 $P_1$，生成三角形 $(V_1, V_2, P_1)$。通过移除 $(V_1 \\rightarrow V_2)$ 并添加与 $P_1$ 相邻的新边来更新前沿。\n- 接着选择活动边 $(V_2 \\rightarrow V_3)$，插入等边顶点 $P_2$，生成三角形 $(V_2, V_3, P_2)$，并相应地更新前沿。\n- 然后选择活动边 $(V_3 \\rightarrow V_4)$，插入等边顶点 $P_3$，生成三角形 $(V_3, V_4, P_3)$，并相应地更新前沿。\n\n计算 $P_1$、$P_2$ 和 $P_3$ 的坐标，明确列出每次插入后作为有向边有序集的前沿，并确定前三个三角形的面积。作为最终答案，提供这前三个三角形的面积之和，以关于 $l$ 的闭式解析表达式表示。最终面积总和以平方米表示。无需四舍五入。",
            "solution": "将通过首先提取所有给定信息，然后评估其科学合理性、一致性和完整性来验证问题。\n\n### 步骤 1：提取已知信息\n- 域：一个凸方形，其顶点按逆时针顺序为 $V_1 = (0, 0)$、$V_2 = (l, 0)$、$V_3 = (l, l)$ 和 $V_4 = (0, l)$。\n- 参数：$l > 0$ 是以米为单位的均匀目标边长。\n- 初始前沿：由有向边 $(V_1 \\rightarrow V_2)$、$(V_2 \\rightarrow V_3)$、$(V_3 \\rightarrow V_4)$ 和 $(V_4 \\rightarrow V_1)$ 按逆时针顺序组成的多边形边界。\n- 顶点放置规则：对于一个活动前沿边 $(A \\rightarrow B)$，候选顶点 $P$ 的构造使得三角形 $(A, B, P)$ 是等边三角形且位于域的内部一侧。\n- 顶点计算公式：$P = A + R_{+60^{\\circ}}(B - A)$，其中旋转矩阵为 $R_{+60^{\\circ}} = \\begin{pmatrix} \\frac{1}{2}  -\\frac{\\sqrt{3}}{2} \\\\ \\frac{\\sqrt{3}}{2}  \\frac{1}{2} \\end{pmatrix}$。\n- 步骤：\n  1. 选择边 $(V_1 \\rightarrow V_2)$，生成顶点 $P_1$ 和三角形 $(V_1, V_2, P_1)$，并更新前沿。\n  2. 选择边 $(V_2 \\rightarrow V_3)$，生成顶点 $P_2$ 和三角形 $(V_2, V_3, P_2)$，并更新前沿。\n  3. 选择边 $(V_3 \\rightarrow V_4)$，生成顶点 $P_3$ 和三角形 $(V_3, V_4, P_3)$，并更新前沿。\n- 解答中要求输出：$P_1$、$P_2$、$P_3$ 的坐标；每次插入后的前沿；以及前三个三角形的面积。\n- 最终答案：这三个三角形的面积之和。\n\n### 步骤 2：使用提取的已知信息进行验证\n根据验证标准评估问题陈述。\n- **科学依据：** 该问题基于推进前沿法 (AFM)，这是一种在计算几何和计算流体力学中用于生成非结构化网格的成熟算法。所使用的数学运算（向量代数、旋转）是标准且正确的。\n- **适定性：** 该问题提供了一个明确定义的初始状态（方形域和前沿）、一套用于生成新点和单元的确定性规则，以及一个特定的操作序列。该过程清晰明确，能够导出一个唯一的解。\n- **客观性：** 语言精确，没有主观或基于观点的陈述。所有术语都经过了数学定义。\n- **完整性和一致性：** 提供了所有必要的信息（顶点、目标长度、顶点规则、步骤）。设置中没有矛盾。顶点计算公式正确地对应于逆时针定向边界中朝向内部的三角形的 $+60^{\\circ}$ 旋转。\n\n### 步骤 3：结论与行动\n该问题有效。它是一个计算几何领域中适定且具有科学依据的问题。将提供详细的解答。\n\n### 解题推导\n解答过程遵循推进前沿法规定的步骤。正方形的顶点给定为 $V_1 = (0, 0)$、$V_2 = (l, 0)$、$V_3 = (l, l)$ 和 $V_4 = (0, l)$。初始前沿 $\\mathcal{F}_0$ 是构成边界的有向边的有序集合：\n$$\n\\mathcal{F}_0 = ((V_1 \\rightarrow V_2), (V_2 \\rightarrow V_3), (V_3 \\rightarrow V_4), (V_4 \\rightarrow V_1))\n$$\n\n**步骤 1：处理边 $(V_1 \\rightarrow V_2)$**\n第一个活动边是 $(A \\rightarrow B) = (V_1 \\rightarrow V_2)$。\n- $A = V_1 = (0, 0)$。\n- $B = V_2 = (l, 0)$。\n- 边向量是 $B - A = (l, 0)$。\n- 顶点 $P_1$ 使用给定公式计算：$P_1 = A + R_{+60^{\\circ}}(B - A)$。\n$$\nP_1 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{2}  -\\frac{\\sqrt{3}}{2} \\\\ \\frac{\\sqrt{3}}{2}  \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} l \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} \\frac{l}{2} \\\\ \\frac{l\\sqrt{3}}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{l}{2} \\\\ \\frac{l\\sqrt{3}}{2} \\end{pmatrix}\n$$\n因此，第一个顶点的坐标是 $P_1 = \\left(\\frac{l}{2}, \\frac{l\\sqrt{3}}{2}\\right)$。\n形成了一个新三角形 $T_1 = (V_1, V_2, P_1)$。这是一个边长为 $l$ 的等边三角形。其面积，记为 $\\text{Area}(T_1)$，由公式 $\\frac{\\sqrt{3}}{4} \\times (\\text{边长})^2$ 给出。\n$$\n\\text{Area}(T_1) = \\frac{\\sqrt{3}}{4}l^2\n$$\n通过用两条新边 $(V_1 \\rightarrow P_1)$ 和 $(P_1 \\rightarrow V_2)$ 替换边 $(V_1 \\rightarrow V_2)$ 来更新前沿。更新后的前沿 $\\mathcal{F}_1$ 为：\n$$\n\\mathcal{F}_1 = ((V_1 \\rightarrow P_1), (P_1 \\rightarrow V_2), (V_2 \\rightarrow V_3), (V_3 \\rightarrow V_4), (V_4 \\rightarrow V_1))\n$$\n\n**步骤 2：处理边 $(V_2 \\rightarrow V_3)$**\n下一个活动边是 $(A \\rightarrow B) = (V_2 \\rightarrow V_3)$。\n- $A = V_2 = (l, 0)$。\n- $B = V_3 = (l, l)$。\n- 边向量是 $B - A = (0, l)$。\n- 顶点 $P_2$ 计算如下：$P_2 = A + R_{+60^{\\circ}}(B - A)$。\n$$\nP_2 = \\begin{pmatrix} l \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{2}  -\\frac{\\sqrt{3}}{2} \\\\ \\frac{\\sqrt{3}}{2}  \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ l \\end{pmatrix} = \\begin{pmatrix} l \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} -\\frac{l\\sqrt{3}}{2} \\\\ \\frac{l}{2} \\end{pmatrix} = \\begin{pmatrix} l - \\frac{l\\sqrt{3}}{2} \\\\ \\frac{l}{2} \\end{pmatrix}\n$$\n因此，第二个顶点的坐标是 $P_2 = \\left(l - \\frac{l\\sqrt{3}}{2}, \\frac{l}{2}\\right)$。\n形成了一个新三角形 $T_2 = (V_2, V_3, P_2)$。这是一个边长为 $|V_3 - V_2| = |(0, l)| = l$ 的等边三角形。其面积为：\n$$\n\\text{Area}(T_2) = \\frac{\\sqrt{3}}{4}l^2\n$$\n通过用边 $(V_2 \\rightarrow P_2)$ 和 $(P_2 \\rightarrow V_3)$ 替换 $\\mathcal{F}_1$ 中的边 $(V_2 \\rightarrow V_3)$ 来更新前沿。更新后的前沿 $\\mathcal{F}_2$ 为：\n$$\n\\mathcal{F}_2 = ((V_1 \\rightarrow P_1), (P_1 \\rightarrow V_2), (V_2 \\rightarrow P_2), (P_2 \\rightarrow V_3), (V_3 \\rightarrow V_4), (V_4 \\rightarrow V_1))\n$$\n\n**步骤 3：处理边 $(V_3 \\rightarrow V_4)$**\n下一个活动边是 $(A \\rightarrow B) = (V_3 \\rightarrow V_4)$。\n- $A = V_3 = (l, l)$。\n- $B = V_4 = (0, l)$。\n- 边向量是 $B - A = (-l, 0)$。\n- 顶点 $P_3$ 计算如下：$P_3 = A + R_{+60^{\\circ}}(B - A)$。\n$$\nP_3 = \\begin{pmatrix} l \\\\ l \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{2}  -\\frac{\\sqrt{3}}{2} \\\\ \\frac{\\sqrt{3}}{2}  \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} -l \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} l \\\\ l \\end{pmatrix} + \\begin{pmatrix} -\\frac{l}{2} \\\\ -\\frac{l\\sqrt{3}}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{l}{2} \\\\ l - \\frac{l\\sqrt{3}}{2} \\end{pmatrix}\n$$\n因此，第三个顶点的坐标是 $P_3 = \\left(\\frac{l}{2}, l - \\frac{l\\sqrt{3}}{2}\\right)$。\n形成了一个新三角形 $T_3 = (V_3, V_4, P_3)$。这是一个边长为 $|V_4 - V_3| = |(-l, 0)| = l$ 的等边三角形。其面积为：\n$$\n\\text{Area}(T_3) = \\frac{\\sqrt{3}}{4}l^2\n$$\n通过用边 $(V_3 \\rightarrow P_3)$ 和 $(P_3 \\rightarrow V_4)$ 替换 $\\mathcal{F}_2$ 中的边 $(V_3 \\rightarrow V_4)$ 来更新前沿。最终的前沿 $\\mathcal{F}_3$ 为：\n$$\n\\mathcal{F}_3 = ((V_1 \\rightarrow P_1), (P_1 \\rightarrow V_2), (V_2 \\rightarrow P_2), (P_2 \\rightarrow V_3), (V_3 \\rightarrow P_3), (P_3 \\rightarrow V_4), (V_4 \\rightarrow V_1))\n$$\n\n**最终计算：面积之和**\n问题要求计算前三个生成的三角形 $T_1$、$T_2$ 和 $T_3$ 的面积之和。\n总面积 $A_{total}$ 为：\n$$\nA_{total} = \\text{Area}(T_1) + \\text{Area}(T_2) + \\text{Area}(T_3)\n$$\n$$\nA_{total} = \\frac{\\sqrt{3}}{4}l^2 + \\frac{\\sqrt{3}}{4}l^2 + \\frac{\\sqrt{3}}{4}l^2 = 3 \\times \\left(\\frac{\\sqrt{3}}{4}l^2\\right)\n$$\n$$\nA_{total} = \\frac{3\\sqrt{3}}{4}l^2\n$$\n由于 $l$ 的单位是米，所以面积的单位是平方米。",
            "answer": "$$\\boxed{\\frac{3\\sqrt{3}}{4}l^{2}}$$"
        },
        {
            "introduction": "在实际的网格生成中，创建一个新单元只完成了一半的工作；我们还必须确保它符合质量标准。这个练习聚焦于对一个三维四面体单元进行质量评估的关键任务。你将计算关键的几何度量，包括半径比质量 $q$ 和二面角，以判断一个候选的四面体是否能被计算流体动力学（CFD）仿真所接受。",
            "id": "3289592",
            "problem": "在计算流体动力学（CFD）的背景下，考虑一个前沿推进（AF）非结构四面体网格生成的步骤，其中通过从一个活跃前沿面上提起一个顶点来生成一个候选四面体。设该候选四面体的顶点为 $\\mathbf{a}$、$\\mathbf{b}$、$\\mathbf{c}$ 和 $\\mathbf{d}$，其笛卡尔坐标由下式给出\n$$\n\\mathbf{a} = (0,\\,0,\\,0),\\quad\n\\mathbf{b} = (1,\\,0,\\,0),\\quad\n\\mathbf{c} = (0,\\,1,\\,0),\\quad\n\\mathbf{d} = (0.2,\\,0.3,\\,1).\n$$\n网格的可接受性由前沿推进方法中使用的两个标准几何质量准则决定：\n- 半径比质量界限 $q \\ge q_{\\min}$，其中 $q_{\\min} = 0.80$。\n- 最小二面角界限 $\\theta_{\\min} \\ge 0.75$ 弧度。\n\n从基本几何定义出发，计算该四面体的体积 $V$、总表面积 $S$、内切球半径 $r$、外接球半径 $R$，以及由归一化半径比 $q = \\dfrac{3 r}{R}$ 定义的质量度量 $q$。此外，计算所有二面角（以弧度表示）并确定最小二面角 $\\theta_{\\min}$，然后判断该候选四面体是否满足两个可接受性准则。\n\n仅使用以下基本公式：\n- 体积的标量三重积：$V = \\dfrac{\\left| \\left( (\\mathbf{b}-\\mathbf{a}) \\times (\\mathbf{c}-\\mathbf{a}) \\right) \\cdot (\\mathbf{d}-\\mathbf{a}) \\right|}{6}$。\n- 三角形面积的叉积公式：$A_{\\triangle} = \\dfrac{1}{2}\\left\\| \\mathbf{u} \\times \\mathbf{v}\\right\\|$。\n- 四面体的内切球半径-体积-表面积关系：$V = \\dfrac{1}{3} r S$。\n- 外心是与所有顶点等距的唯一点，通过求解形式为 $\\left(\\mathbf{b}-\\mathbf{a}\\right)\\cdot \\mathbf{O} = \\dfrac{\\|\\mathbf{b}\\|^{2}-\\|\\mathbf{a}\\|^{2}}{2}$ 等的线性方程组获得。\n- 两个法向量为 $\\mathbf{n}_{1}$ 和 $\\mathbf{n}_{2}$ 的面之间的二面角由 $\\theta = \\pi - \\arccos\\!\\left( \\dfrac{\\mathbf{n}_{1}\\cdot \\mathbf{n}_{2}}{\\|\\mathbf{n}_{1}\\|\\,\\|\\mathbf{n}_{2}\\|} \\right)$ 给出。\n\n将最终报告的数值 $q$ 四舍五入到四位有效数字。二面角以弧度表示。报告无量纲形式的 $q$。您的最终答案必须仅为 $q$ 的单个值。",
            "solution": "问题陈述已经过验证，被认为是科学可靠、定义明确、客观和完整的。所有必要的数据、定义和公式均已提供，不存在内部矛盾或违反数学、物理原理的情况。该问题是计算几何在计算流体动力学网格质量分析中应用的一个标准练习。因此，我们可以开始求解。\n\n四面体的顶点给定为 $\\mathbf{a} = (0,\\,0,\\,0)$、$\\mathbf{b} = (1,\\,0,\\,0)$、$\\mathbf{c} = (0,\\,1,\\,0)$ 和 $\\mathbf{d} = (0.2,\\,0.3,\\,1)$。由于顶点 $\\mathbf{a}$ 位于原点，从 $\\mathbf{a}$ 到其他顶点的向量就是这些顶点自身的坐标向量：\n$$ \\mathbf{v}_{ab} = \\mathbf{b} - \\mathbf{a} = (1,\\,0,\\,0) $$\n$$ \\mathbf{v}_{ac} = \\mathbf{c} - \\mathbf{a} = (0,\\,1,\\,0) $$\n$$ \\mathbf{v}_{ad} = \\mathbf{d} - \\mathbf{a} = (0.2,\\,0.3,\\,1) $$\n\n首先，我们使用标量三重积公式计算四面体的体积 $V$：\n$$ V = \\frac{\\left| \\left( \\mathbf{v}_{ab} \\times \\mathbf{v}_{ac} \\right) \\cdot \\mathbf{v}_{ad} \\right|}{6} $$\n叉积为：\n$$ \\mathbf{v}_{ab} \\times \\mathbf{v}_{ac} = (1,\\,0,\\,0) \\times (0,\\,1,\\,0) = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ 1  0  0 \\\\ 0  1  0 \\end{vmatrix} = (0,\\,0,\\,1) $$\n点积为：\n$$ (0,\\,0,\\,1) \\cdot (0.2,\\,0.3,\\,1) = 1 $$\n因此，体积为：\n$$ V = \\frac{1}{6} $$\n\n接下来，我们计算总表面积 $S$。这需要计算四个三角面 $\\triangle abc$、$\\triangle abd$、$\\triangle acd$ 和 $\\triangle bcd$ 的面积。我们使用公式 $A_{\\triangle} = \\frac{1}{2}\\left\\| \\mathbf{u} \\times \\mathbf{v}\\right\\|$。\n面 $\\triangle abc$ 的面积：\n$$ A_{abc} = \\frac{1}{2}\\|\\mathbf{v}_{ab} \\times \\mathbf{v}_{ac}\\| = \\frac{1}{2}\\|(0,0,1)\\| = \\frac{1}{2} $$\n面 $\\triangle abd$ 的面积：\n$$ \\mathbf{v}_{ab} \\times \\mathbf{v}_{ad} = (1,0,0) \\times (0.2,0.3,1) = (0, -1, 0.3) $$\n$$ A_{abd} = \\frac{1}{2}\\|(0, -1, 0.3)\\| = \\frac{1}{2}\\sqrt{0^2 + (-1)^2 + 0.3^2} = \\frac{1}{2}\\sqrt{1.09} $$\n面 $\\triangle acd$ 的面积：\n$$ \\mathbf{v}_{ac} \\times \\mathbf{v}_{ad} = (0,1,0) \\times (0.2,0.3,1) = (1, 0, -0.2) $$\n$$ A_{acd} = \\frac{1}{2}\\|(1, 0, -0.2)\\| = \\frac{1}{2}\\sqrt{1^2 + 0^2 + (-0.2)^2} = \\frac{1}{2}\\sqrt{1.04} $$\n面 $\\triangle bcd$ 的面积：\n$$ \\mathbf{v}_{bc} = \\mathbf{c}-\\mathbf{b} = (-1,1,0) $$\n$$ \\mathbf{v}_{bd} = \\mathbf{d}-\\mathbf{b} = (-0.8,0.3,1) $$\n$$ \\mathbf{v}_{bc} \\times \\mathbf{v}_{bd} = (-1,1,0) \\times (-0.8,0.3,1) = (1, 1, -0.3+0.8) = (1, 1, 0.5) $$\n$$ A_{bcd} = \\frac{1}{2}\\|(1, 1, 0.5)\\| = \\frac{1}{2}\\sqrt{1^2+1^2+0.5^2} = \\frac{1}{2}\\sqrt{2.25} = \\frac{1}{2}(1.5) = \\frac{3}{4} $$\n总表面积 $S$ 是这些面积的总和：\n$$ S = A_{abc} + A_{abd} + A_{acd} + A_{bcd} = \\frac{1}{2} + \\frac{1}{2}\\sqrt{1.09} + \\frac{1}{2}\\sqrt{1.04} + \\frac{3}{4} = \\frac{5}{4} + \\frac{1}{2}(\\sqrt{1.09} + \\sqrt{1.04}) $$\n\n内切球半径 $r$ 使用关系式 $V = \\frac{1}{3} r S$ 求得：\n$$ r = \\frac{3V}{S} = \\frac{3(1/6)}{S} = \\frac{1/2}{S} = \\frac{1}{2S} = \\frac{1}{\\frac{5}{2} + \\sqrt{1.09} + \\sqrt{1.04}} $$\n\n为了求外接球半径 $R$，我们首先找到外心 $\\mathbf{O}=(x,y,z)$，它与所有顶点等距。我们求解所提供的线性方程组：\n$$ (\\mathbf{b}-\\mathbf{a})\\cdot \\mathbf{O} = \\frac{\\|\\mathbf{b}\\|^{2}-\\|\\mathbf{a}\\|^{2}}{2} $$\n$$ (\\mathbf{c}-\\mathbf{a})\\cdot \\mathbf{O} = \\frac{\\|\\mathbf{c}\\|^{2}-\\|\\mathbf{a}\\|^{2}}{2} $$\n$$ (\\mathbf{d}-\\mathbf{a})\\cdot \\mathbf{O} = \\frac{\\|\\mathbf{d}\\|^{2}-\\|\\mathbf{a}\\|^{2}}{2} $$\n我们有 $\\|\\mathbf{a}\\|^2=0$、$\\|\\mathbf{b}\\|^2=1^2=1$、$\\|\\mathbf{c}\\|^2=1^2=1$ 以及 $\\|\\mathbf{d}\\|^2=0.2^2+0.3^2+1^2=0.04+0.09+1=1.13$。方程组变为：\n1. $(1,0,0) \\cdot (x,y,z) = \\frac{1-0}{2} \\implies x = 0.5$\n2. $(0,1,0) \\cdot (x,y,z) = \\frac{1-0}{2} \\implies y = 0.5$\n3. $(0.2,0.3,1) \\cdot (x,y,z) = \\frac{1.13-0}{2} \\implies 0.2x+0.3y+z = 0.565$\n将 $x=0.5$ 和 $y=0.5$ 代入第三个方程：\n$$ 0.2(0.5) + 0.3(0.5) + z = 0.565 \\implies 0.1 + 0.15 + z = 0.565 \\implies z = 0.315 $$\n外心是 $\\mathbf{O} = (0.5, 0.5, 0.315)$。外接球半径 $R$ 是从 $\\mathbf{O}$ 到任一顶点（例如 $\\mathbf{a}$）的距离：\n$$ R = \\|\\mathbf{O}-\\mathbf{a}\\| = \\|\\mathbf{O}\\| = \\sqrt{0.5^2 + 0.5^2 + 0.315^2} = \\sqrt{0.25 + 0.25 + 0.099225} = \\sqrt{0.599225} $$\n\n现在我们计算半径比质量度量 $q$：\n$$ q = \\frac{3r}{R} = \\frac{3}{R \\times (2S)} = \\frac{3}{\\sqrt{0.599225} \\left( \\frac{5}{2} + \\sqrt{1.09} + \\sqrt{1.04} \\right)} $$\n数值计算如下：\n$R \\approx \\sqrt{0.599225} \\approx 0.774096$\n$S \\approx \\frac{5}{4} + \\frac{1}{2}(1.04403 + 1.01980) = 1.25 + 1.031915 = 2.281915$\n$r = \\frac{1}{2S} \\approx \\frac{1}{2(2.281915)} \\approx 0.219114$\n$$ q = \\frac{3r}{R} \\approx \\frac{3 \\times 0.219114}{0.774096} \\approx \\frac{0.657342}{0.774096} \\approx 0.849178 $$\n四舍五入到四位有效数字， $q \\approx 0.8492$。\n\n接下来，我们计算二面角。这需要每个面的外向法向量。对于面 $\\triangle v_1 v_2 v_3$，其法向量 $\\mathbf{n} = (\\mathbf{v}_2-\\mathbf{v}_1) \\times (\\mathbf{v}_3-\\mathbf{v}_1)$ 是外向的，如果满足 $\\mathbf{n} \\cdot (\\mathbf{v}_4-\\mathbf{v}_1) > 0$。\n- 面 $\\triangle abc$ (相对于 $\\mathbf{d}$): $\\mathbf{n}_{abc} = (\\mathbf{b}-\\mathbf{a}) \\times (\\mathbf{c}-\\mathbf{a}) = (0,0,1)$。测试: $\\mathbf{n}_{abc} \\cdot (\\mathbf{d}-\\mathbf{a}) = 1 > 0$。所以，外向法向量为 $\\mathbf{n}_1 = -(0,0,1) = (0,0,-1)$。$\\|\\mathbf{n}_1\\| = 1$。\n- 面 $\\triangle abd$ (相对于 $\\mathbf{c}$): $\\mathbf{n}_{abd} = (\\mathbf{b}-\\mathbf{a}) \\times (\\mathbf{d}-\\mathbf{a}) = (0,-1,0.3)$。测试: $\\mathbf{n}_{abd} \\cdot (\\mathbf{c}-\\mathbf{a}) = -1  0$。外向法向量为 $\\mathbf{n}_2=(0,-1,0.3)$。$\\|\\mathbf{n}_2\\| = \\sqrt{1.09}$。\n- 面 $\\triangle acd$ (相对于 $\\mathbf{b}$): $\\mathbf{n}_{acd} = (\\mathbf{c}-\\mathbf{a}) \\times (\\mathbf{d}-\\mathbf{a}) = (1,0,-0.2)$。测试: $\\mathbf{n}_{acd} \\cdot (\\mathbf{b}-\\mathbf{a}) = 1 > 0$。外向法向量为 $\\mathbf{n}_3=(-1,0,0.2)$。$\\|\\mathbf{n}_3\\| = \\sqrt{1.04}$。\n- 面 $\\triangle bcd$ (相对于 $\\mathbf{a}$): $\\mathbf{n}_{bcd} = (\\mathbf{c}-\\mathbf{b}) \\times (\\mathbf{d}-\\mathbf{b}) = (1,1,0.5)$。测试: $\\mathbf{n}_{bcd} \\cdot (\\mathbf{a}-\\mathbf{b}) = -1  0$。外向法向量为 $\\mathbf{n}_4=(1,1,0.5)$。$\\|\\mathbf{n}_4\\| = 1.5$。\n\n具有外向法向量 $\\mathbf{n}_i, \\mathbf{n}_j$ 的两个面之间的二面角 $\\theta$ 由下式给出 $\\theta = \\pi - \\arccos\\left(\\frac{\\mathbf{n}_i\\cdot\\mathbf{n}_j}{\\|\\mathbf{n}_i\\|\\|\\mathbf{n}_j\\|}\\right)$。\n- 边 $ab$ 上的角 (面 $abc, abd$): $\\mathbf{n}_1 \\cdot \\mathbf{n}_2 = (0,0,-1)\\cdot(0,-1,0.3) = -0.3$。 $\\theta_{ab} = \\pi - \\arccos\\left(\\frac{-0.3}{1 \\cdot \\sqrt{1.09}}\\right) \\approx 1.279$ rad.\n- 边 $ac$ 上的角 (面 $abc, acd$): $\\mathbf{n}_1 \\cdot \\mathbf{n}_3 = (0,0,-1)\\cdot(-1,0,0.2) = -0.2$。 $\\theta_{ac} = \\pi - \\arccos\\left(\\frac{-0.2}{1 \\cdot \\sqrt{1.04}}\\right) \\approx 1.374$ rad.\n- 边 $ad$ 上的角 (面 $abd, acd$): $\\mathbf{n}_2 \\cdot \\mathbf{n}_3 = (0,-1,0.3)\\cdot(-1,0,0.2) = 0.06$。 $\\theta_{ad} = \\pi - \\arccos\\left(\\frac{0.06}{\\sqrt{1.09}\\sqrt{1.04}}\\right) \\approx 1.627$ rad.\n- 边 $bc$ 上的角 (面 $abc, bcd$): $\\mathbf{n}_1 \\cdot \\mathbf{n}_4 = (0,0,-1)\\cdot(1,1,0.5) = -0.5$。 $\\theta_{bc} = \\pi - \\arccos\\left(\\frac{-0.5}{1 \\cdot 1.5}\\right) = \\pi - \\arccos\\left(-\\frac{1}{3}\\right) \\approx 1.231$ rad.\n- 边 $bd$ 上的角 (面 $abd, bcd$): $\\mathbf{n}_2 \\cdot \\mathbf{n}_4 = (0,-1,0.3)\\cdot(1,1,0.5) = -0.85$。 $\\theta_{bd} = \\pi - \\arccos\\left(\\frac{-0.85}{\\sqrt{1.09} \\cdot 1.5}\\right) \\approx 0.996$ rad.\n- 边 $cd$ 上的角 (面 $acd, bcd$): $\\mathbf{n}_3 \\cdot \\mathbf{n}_4 = (-1,0,0.2)\\cdot(1,1,0.5) = -0.9$。 $\\theta_{cd} = \\pi - \\arccos\\left(\\frac{-0.9}{\\sqrt{1.04} \\cdot 1.5}\\right) \\approx 0.941$ rad.\n\n最小二面角为 $\\theta_{\\min\\_calc} = \\theta_{cd} \\approx 0.941$ 弧度。\n\n最后，我们检查可接受性准则：\n1. 半径比：$q \\approx 0.8492$。条件是 $q \\ge q_{\\min} = 0.80$。由于 $0.8492 \\ge 0.80$，此准则得到满足。\n2. 二面角：计算出的最小二面角为 $\\theta_{\\min\\_calc} \\approx 0.941$ 弧度。条件是 $\\theta_{\\min} \\ge 0.75$ 弧度。由于 $0.941 \\ge 0.75$，此准则也得到满足。\n\n候选四面体满足两个可接受性准则。问题要求将 $q$ 的单个值作为最终答案。",
            "answer": "$$\n\\boxed{0.8492}\n$$"
        },
        {
            "introduction": "推进前沿方法的真正威力在于其能适应复杂需求，例如生成与流动特征对齐的各向异性网格。这个高级练习将挑战你在一个各向异性度量空间中实现一个节点放置策略，这是现代CFD网格生成的基石。你将求解一个新顶点的位置，使其满足期望的单元拉伸和尺寸要求，从而将度量张量的数学理论与实际的编程实现联系起来。",
            "id": "3289653",
            "problem": "要求您为非结构化四面体网格划分中的三维推进前沿法（advancing-front）布局步骤实现各向异性度量空间下的操作。推进前沿法通过放置一个新点来扩展一个表面三角形面，从而形成一个有效的四面体。数学和算法任务如下。\n\n给定一个在 $\\mathbb{R}^3$ 中（坐标单位为米）具有顶点 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 的三角形，计算单位面法线 $\\mathbf{n}_f$，在三角形质心处评估局部度量张量 $\\mathbf{M}$，生成一个候选点 $\\mathbf{p}$，使得该点到 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 的度量空间边长等于目标长度 $l$（单位为米），并检查生成的四面体是否满足合法性条件 $V > 0$，其中 $V$ 是有向体积，单位为立方米。合法性条件 $V > 0$ 强制要求四面体相对于面顶点排序 $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 具有一致的朝向。\n\n基本依据由以下定义和事实给出：\n- 在对称正定（SPD）度量张量 $\\mathbf{M} \\in \\mathbb{R}^{3 \\times 3}$ 下，向量 $\\mathbf{v} \\in \\mathbb{R}^3$ 的基于度量的长度定义为\n$$\\ell_{\\mathbf{M}}(\\mathbf{v}) = \\sqrt{\\mathbf{v}^\\top \\mathbf{M} \\,\\mathbf{v}}.$$\n- 一个对称正定（SPD）矩阵 $\\mathbf{M}$ 在 $\\mathbb{R}^3$ 上引入了一个内积和一个范数，并表示所需网格单元尺寸和拉伸中的各向异性。\n- 具有顶点 $(\\mathbf{a},\\mathbf{b},\\mathbf{c},\\mathbf{p})$ 的四面体的有向体积为\n$$V = \\frac{1}{6}\\,\\det\\big[\\mathbf{b}-\\mathbf{a},\\,\\mathbf{c}-\\mathbf{a},\\,\\mathbf{p}-\\mathbf{a}\\big].$$\n- 单位面法线根据有序顶点 $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 通过右手定则计算得出，公式为\n$$\\mathbf{n}_f = \\frac{(\\mathbf{b}-\\mathbf{a}) \\times (\\mathbf{c}-\\mathbf{a})}{\\|(\\mathbf{b}-\\mathbf{a}) \\times (\\mathbf{c}-\\mathbf{a})\\|}.$$\n\n目标点 $\\mathbf{p}$ 必须满足以下方程组\n$$\\sqrt{(\\mathbf{a}-\\mathbf{p})^\\top \\mathbf{M}\\,(\\mathbf{a}-\\mathbf{p})} = l, \\quad \\sqrt{(\\mathbf{b}-\\mathbf{p})^\\top \\mathbf{M}\\,(\\mathbf{b}-\\mathbf{p})} = l, \\quad \\sqrt{(\\mathbf{c}-\\mathbf{p})^\\top \\mathbf{M}\\,(\\mathbf{c}-\\mathbf{p})} = l,$$\n其平方形式为\n$$(\\mathbf{a}-\\mathbf{p})^\\top \\mathbf{M}\\,(\\mathbf{a}-\\mathbf{p}) = l^2, \\quad (\\mathbf{b}-\\mathbf{p})^\\top \\mathbf{M}\\,(\\mathbf{b}-\\mathbf{p}) = l^2, \\quad (\\mathbf{c}-\\mathbf{p})^\\top \\mathbf{M}\\,(\\mathbf{c}-\\mathbf{p}) = l^2.$$\n\n为了使问题自成一体且可测试，请使用以下测试套件。在每种情况下，计算 $\\mathbf{n}_f$，在质心 $\\mathbf{m} = (\\mathbf{a}+\\mathbf{b}+\\mathbf{c})/3$ 处评估 $\\mathbf{M}$，生成一个尽可能满足度量距离约束的候选点 $\\mathbf{p}$，然后计算 $V$ 和由以下公式定义的合法性布尔值\n$$\\text{legal} = \\big(V > 0\\big) \\,\\wedge\\,\\left(\\max\\Big\\{\\left|\\ell_{\\mathbf{M}}(\\mathbf{a}-\\mathbf{p}) - l\\right|,\\,\\left|\\ell_{\\mathbf{M}}(\\mathbf{b}-\\mathbf{p}) - l\\right|,\\,\\left|\\ell_{\\mathbf{M}}(\\mathbf{c}-\\mathbf{p}) - l\\right|\\Big\\} \\le \\varepsilon\\right),$$\n容差为 $\\varepsilon = 10^{-6}$ (米)。返回候选点坐标 $(p_x,p_y,p_z)$（单位为米）和有向体积 $V$（单位为立方米）。\n\n度量张量评估：\n- 对于常数度量情况，使用 $\\mathbf{M}(\\mathbf{x}) = \\mathrm{diag}(\\lambda_1,\\lambda_2,\\lambda_3)$。\n- 对于梯度对齐的各向异性情况，定义一个标量场 $u(\\mathbf{x}) = x + 2y + 3z$，令 $\\nabla u = [1,\\,2,\\,3]^\\top$，定义一个标准正交标架 $\\{\\mathbf{e}_1,\\mathbf{e}_2,\\mathbf{e}_3\\}$，其中 $\\mathbf{e}_1 = \\nabla u / \\|\\nabla u\\|$，$\\mathbf{e}_2$ 为任意与 $\\mathbf{e}_1$ 标准正交的向量，且 $\\mathbf{e}_3 = \\mathbf{e}_1 \\times \\mathbf{e}_2$。令 $\\mathbf{Q} = [\\mathbf{e}_1\\,\\mathbf{e}_2\\,\\mathbf{e}_3]$ 为特征向量构成的标准正交矩阵，并设置\n$$\\mathbf{M}(\\mathbf{x}) = \\mathbf{Q}\\,\\mathrm{diag}(4,1,1)\\,\\mathbf{Q}^\\top.$$\n\n测试套件（坐标单位为米，目标长度单位为米）：\n- 情况 $1$（理想情况，各向同性，位于 $z=0$ 平面上的等边三角形面）：\n  - $\\mathbf{a} = (0,\\,0,\\,0)$, $\\mathbf{b} = (1,\\,0,\\,0)$, $\\mathbf{c} = \\left(\\tfrac{1}{2},\\,\\tfrac{\\sqrt{3}}{2},\\,0\\right)$, $\\mathbf{M} = \\mathrm{diag}(1,1,1)$, $l = 0.8$.\n- 情况 $2$（沿 $z$ 轴的各向异性拉伸，同一三角形面）：\n  - $\\mathbf{a} = (0,\\,0,\\,0)$, $\\mathbf{b} = (1,\\,0,\\,0)$, $\\mathbf{c} = \\left(\\tfrac{1}{2},\\,\\tfrac{\\sqrt{3}}{2},\\,0\\right)$, $\\mathbf{M} = \\mathrm{diag}(1,1,4)$, $l = 0.8$.\n- 情况 $3$（各向同性度量下边界高度为 $0$，同一三角形面）：\n  - $\\mathbf{a} = (0,\\,0,\\,0)$, $\\mathbf{b} = (1,\\,0,\\,0)$, $\\mathbf{c} = \\left(\\tfrac{1}{2},\\,\\tfrac{\\sqrt{3}}{2},\\,0\\right)$, $\\mathbf{M} = \\mathrm{diag}(1,1,1)$, $l = \\sqrt{\\tfrac{1}{3}}$.\n- 情况 $4$（梯度对齐的各向异性，斜面）：\n  - $\\mathbf{a} = (0,\\,0,\\,0)$, $\\mathbf{b} = (1,\\,0,\\,0)$, $\\mathbf{c} = (0,\\,0.3,\\,0.1)$, $\\mathbf{M}$ 来自上述梯度对齐构造，特征值为 $(4,1,1)$, $l = 0.7$.\n\n您的程序必须：\n- 计算 $\\mathbf{n}_f$，在质心处评估 $\\mathbf{M}$，沿度量感知的法线方向构造初始猜测点，并通过求解非线性系统来优化 $\\mathbf{p}$，以最小化与度量长度等式的偏差。\n- 对于每个测试用例，返回列表 $[p_x,p_y,p_z,V,\\text{legal}]$，其中 $(p_x,p_y,p_z)$ 的单位为米，$V$ 的单位为立方米。将 $p_x$、$p_y$ 和 $p_z$ 四舍五入到 $6$ 位小数，$V$ 四舍五入到 $9$ 位小数。布尔值 $\\text{legal}$ 不进行四舍五入。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，不含空格，例如\n$$[\\text{case}_1,\\text{case}_2,\\text{case}_3,\\text{case}_4],$$\n其中每个 $\\text{case}_i$ 本身也是一个用方括号括起来的逗号分隔列表。\n\n基本推理和推导必须在算法内部实现，而不是使用特定的公式。角度不属于本问题，因此不需要角度单位。所有距离和体积都必须遵守指定的单位。",
            "solution": "该问题要求在一个各向异性度量空间中，为三维推进前沿网格生成算法实现一个点放置步骤。给定一个由顶点 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 定义的三角形面，以及一个对称正定（SPD）度量张量 $\\mathbf{M}$，我们的任务是找到一个点 $\\mathbf{p}$，以形成一个新的四面体 $(\\mathbf{a},\\mathbf{b},\\mathbf{c},\\mathbf{p})$。新点 $\\mathbf{p}$ 的位置必须满足其在度量空间中到三角形每个顶点的距离均为指定的目标长度 $l$。最后，我们必须验证所生成四面体的有效性。\n\n问题的核心是通过求解以下三个非线性方程组成的方程组来找到点 $\\mathbf{p} = [p_x, p_y, p_z]^\\top$ 的坐标：\n$$(\\mathbf{p}-\\mathbf{a})^\\top \\mathbf{M}\\,(\\mathbf{p}-\\mathbf{a}) = l^2 \\quad (1)$$\n$$(\\mathbf{p}-\\mathbf{b})^\\top \\mathbf{M}\\,(\\mathbf{p}-\\mathbf{b}) = l^2 \\quad (2)$$\n$$(\\mathbf{p}-\\mathbf{c})^\\top \\mathbf{M}\\,(\\mathbf{p}-\\mathbf{c}) = l^2 \\quad (3)$$\n这些方程表明，点 $\\mathbf{p}$ 位于三个椭球体的交点上，这三个椭球体分别以 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 为中心，形状由 $\\mathbf{M}$ 定义，大小由 $l$ 定义。\n\n虽然这是一个非线性系统，但可以将其简化。通过用方程(2)减去方程(1)，以及用方程(3)减去方程(1)，我们得到了一个关于 $\\mathbf{p}$ 的两个线性方程组成的方程组。让我们展开方程(1)和(2)：\n$$ \\mathbf{p}^\\top\\mathbf{M}\\mathbf{p} - 2\\mathbf{a}^\\top\\mathbf{M}\\mathbf{p} + \\mathbf{a}^\\top\\mathbf{M}\\mathbf{a} = l^2 $$\n$$ \\mathbf{p}^\\top\\mathbf{M}\\mathbf{p} - 2\\mathbf{b}^\\top\\mathbf{M}\\mathbf{p} + \\mathbf{b}^\\top\\mathbf{M}\\mathbf{b} = l^2 $$\n将它们相减可以消去二次项 $\\mathbf{p}^\\top\\mathbf{M}\\mathbf{p}$：\n$$ 2(\\mathbf{a}-\\mathbf{b})^\\top\\mathbf{M}\\mathbf{p} = \\mathbf{a}^\\top\\mathbf{M}\\mathbf{a} - \\mathbf{b}^\\top\\mathbf{M}\\mathbf{b} \\quad (4) $$\n同样地，用(3)减去(1)：\n$$ 2(\\mathbf{c}-\\mathbf{a})^\\top\\mathbf{M}\\mathbf{p} = \\mathbf{c}^\\top\\mathbf{M}\\mathbf{c} - \\mathbf{a}^\\top\\mathbf{M}\\mathbf{a} \\quad (5) $$\n注意，由于 $\\mathbf{M}$ 是对称的，我们可以写成 $2(\\mathbf{c}-\\mathbf{a})^\\top\\mathbf{M}\\mathbf{p} = -2(\\mathbf{a}-\\mathbf{c})^\\top\\mathbf{M}\\mathbf{p}$。调整方程(5)后得到：\n$$ 2(\\mathbf{a}-\\mathbf{c})^\\top\\mathbf{M}\\mathbf{p} = \\mathbf{a}^\\top\\mathbf{M}\\mathbf{a} - \\mathbf{c}^\\top\\mathbf{M}\\mathbf{c} \\quad (5') $$\n\n方程(4)和(5')代表了 $\\mathbb{R}^3$ 中的两个平面。满足这两个方程的所有点 $\\mathbf{p}$ 的集合是它们的交集，即一条直线。这条线是在由 $\\mathbf{M}$ 定义的度量空间中与 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 等距的点的轨迹；它是该度量下三角形 $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 的外接轴。\n\n我们可以将这条直线参数化表示为 $\\mathbf{p}(t) = \\mathbf{p}_{\\text{base}} + t\\mathbf{d}_{\\text{line}}$，其中 $\\mathbf{p}_{\\text{base}}$ 是直线上的任意一个特定点，$\\mathbf{d}_{\\text{line}}$ 是直线的方向向量。\n方向向量 $\\mathbf{d}_{\\text{line}}$ 与两个平面的法向量都正交。这两个平面的法向量分别为 $\\mathbf{n}_1 = \\mathbf{M}(\\mathbf{a}-\\mathbf{b})$ 和 $\\mathbf{n}_2 = \\mathbf{M}(\\mathbf{a}-\\mathbf{c})$。因此，方向向量是它们的叉积：\n$$ \\mathbf{d}_{\\text{line}} = (\\mathbf{M}(\\mathbf{a}-\\mathbf{b})) \\times (\\mathbf{M}(\\mathbf{a}-\\mathbf{c})) $$\n可以通过求解由(4)和(5')定义的 $2 \\times 3$ 线性系统来找到一个特解 $\\mathbf{p}_{\\text{base}}$。一个稳健的方法是设置 $\\mathbf{p}$ 的一个分量为零，例如 $p_z=0$，然后求解得到的关于另外两个分量的 $2 \\times 2$ 系统。\n\n确定了直线 $\\mathbf{p}(t)$ 后，我们将其代入任意一个原始的二次方程，例如方程(1)：\n$$ (\\mathbf{p}_{\\text{base}} + t\\mathbf{d}_{\\text{line}} - \\mathbf{a})^\\top \\mathbf{M} (\\mathbf{p}_{\\text{base}} + t\\mathbf{d}_{\\text{line}} - \\mathbf{a}) = l^2 $$\n令 $\\mathbf{v}_0 = \\mathbf{p}_{\\text{base}} - \\mathbf{a}$，上式可展开为关于参数 $t$ 的二次方程：\n$$ (\\mathbf{d}_{\\text{line}}^\\top \\mathbf{M} \\mathbf{d}_{\\text{line}}) t^2 + (2\\mathbf{v}_0^\\top \\mathbf{M} \\mathbf{d}_{\\text{line}}) t + (\\mathbf{v}_0^\\top \\mathbf{M} \\mathbf{v}_0 - l^2) = 0 $$\n求解这个二次方程最多可以得到两个实数值 $t$，记为 $t_1$ 和 $t_2$。它们对应两个候选点 $\\mathbf{p}_1 = \\mathbf{p}(t_1)$ 和 $\\mathbf{p}_2 = \\mathbf{p}(t_2)$，这两个点相对于三角形的度量平面是对称的。\n\n为了为推进前沿选择正确的点，我们使用四面体 $(\\mathbf{a},\\mathbf{b},\\mathbf{c},\\mathbf{p})$ 的有向体积 $V$：\n$$ V = \\frac{1}{6}\\,\\det\\big[\\mathbf{b}-\\mathbf{a},\\,\\mathbf{c}-\\mathbf{a},\\,\\mathbf{p}-\\mathbf{a}\\big] $$\n“推进”前沿的惯例意味着要从现有表面“向外”移动，这对应于形成一个有向体积为正的四面体，与面顶点 $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 的右手定则排序一致。因此，我们选择能使 $V>0$ 的点 $\\mathbf{p}$。\n\n对于梯度对齐的各向异性度量情况，张量 $\\mathbf{M}$ 由 $\\mathbf{M} = \\mathbf{Q}\\,\\mathrm{diag}(4,1,1)\\,\\mathbf{Q}^\\top$ 给出。矩阵 $\\mathbf{Q} = [\\mathbf{e}_1\\,\\mathbf{e}_2\\,\\mathbf{e}_3]$ 由一个标准正交基构成，其中 $\\mathbf{e}_1$ 与给定梯度对齐。由于另外两个特征值相同，对应于特征值 $1$ 的特征空间是一个二维平面。可以选择该平面的任意标准正交基 $\\{\\mathbf{e}_2, \\mathbf{e}_3\\}$。$\\mathbf{M}$ 的形式可以简化为 $\\mathbf{M} = 4\\mathbf{e}_1\\mathbf{e}_1^\\top + 1(\\mathbf{e}_2\\mathbf{e}_2^\\top + \\mathbf{e}_3\\mathbf{e}_3^\\top)$。使用恒等式 $\\mathbf{I} = \\mathbf{e}_1\\mathbf{e}_1^\\top + \\mathbf{e}_2\\mathbf{e}_2^\\top + \\mathbf{e}_3\\mathbf{e}_3^\\top$，我们有 $\\mathbf{e}_2\\mathbf{e}_2^\\top + \\mathbf{e}_3\\mathbf{e}_3^\\top = \\mathbf{I} - \\mathbf{e}_1\\mathbf{e}_1^\\top$。因此，$\\mathbf{M}$可以高效地计算为：\n$$ \\mathbf{M} = 4\\mathbf{e}_1\\mathbf{e}_1^\\top + (\\mathbf{I} - \\mathbf{e}_1\\mathbf{e}_1^\\top) = \\mathbf{I} + 3\\mathbf{e}_1\\mathbf{e}_1^\\top $$\n其中 $\\mathbf{e}_1 = \\nabla u / \\|\\nabla u\\|$ 且 $\\mathbf{I}$ 是单位矩阵。\n\n对所选点 $\\mathbf{p}$ 的最终合法性检查包括两个条件：有向体积必须为正（$V>0$），并且从新点到各顶点的度量距离必须在小容差 $\\varepsilon=10^{-6}$ 内与目标长度 $l$ 相匹配。\n$$ \\text{legal} = \\big(V > 0\\big) \\,\\wedge\\,\\left(\\max\\Big\\{\\left|\\ell_{\\mathbf{M}}(\\mathbf{a}-\\mathbf{p}) - l\\right|,\\,\\left|\\ell_{\\mathbf{M}}(\\mathbf{b}-\\mathbf{p}) - l\\right|,\\,\\left|\\ell_{\\mathbf{M}}(\\mathbf{c}-\\mathbf{p}) - l\\right|\\Big\\} \\le \\varepsilon\\right) $$\n由于我们的解析方法直接求解方程，距离误差应接近机器精度，但为了形式上的验证，仍然执行此检查。\n\n对于每个测试用例，算法按以下步骤进行：\n1. 定义顶点 $\\mathbf{a}, \\mathbf{b}, \\mathbf{c}$、目标长度 $l$ 以及构造度量张量 $\\mathbf{M}$ 的规则。\n2. 根据给定规则构造 $\\mathbf{M}$。对于梯度对齐的情况，使用简化公式 $\\mathbf{M} = \\mathbf{I} + 3\\mathbf{e}_1\\mathbf{e}_1^\\top$。\n3. 建立并求解用于确定外接轴的 $2 \\times 3$ 线性系统。这将得到一个基点 $\\mathbf{p}_{\\text{base}}$ 和方向 $\\mathbf{d}_{\\text{line}}$。\n4. 将参数化直线方程代入一个距离平方方程中，形成并求解关于 $t$ 的二次方程。\n5. 计算两个候选点 $\\mathbf{p}_1, \\mathbf{p}_2$。\n6. 为每个候选点计算有向体积 $V$，并选择使 $V>0$ 的那个点。\n7. 对所选点进行合法性检查。\n8. 按要求格式化结果分量 $(p_x, p_y, p_z)$、体积 $V$ 和合法性布尔值。",
            "answer": "[[0.500000,0.288675,0.653197,0.094437171,true],[0.500000,0.288675,0.326599,0.047218585,true],[0.500000,0.288675,0.000000,0.000000000,false],[0.537877,0.147102,-0.016335,0.000816750,true]]"
        }
    ]
}