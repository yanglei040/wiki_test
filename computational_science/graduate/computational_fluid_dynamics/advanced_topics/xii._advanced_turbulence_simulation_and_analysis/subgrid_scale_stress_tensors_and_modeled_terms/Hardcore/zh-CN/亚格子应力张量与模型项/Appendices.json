{
    "hands_on_practices": [
        {
            "introduction": "在大涡模拟中，最常见的一类亚格子模型是涡粘性模型，它们建立在Boussinesq假设之上。这个练习将深入探讨这一核心假设的直接几何后果。通过在一个给定的解析应变率张量下计算偏亚格子应力张量 $\\tau_{ij}^{\\text{dev}}$ 的主轴，你将亲手验证涡粘性模型如何强制应力张量与应变率张量的主轴对齐，并理解解析流场的旋转部分在这些模型中被忽略的原因。",
            "id": "3367465",
            "problem": "考虑一个不可压缩流的大涡模拟 (LES)。令解析速度场为 $\\tilde{u}_{i}(\\boldsymbol{x},t)$，解析速度梯度为 $\\partial \\tilde{u}_{i}/\\partial x_{j}$。子网格尺度 (SGS) 应力张量定义为 $\\tau_{ij} \\equiv \\overline{u_{i} u_{j}} - \\tilde{u}_{i}\\tilde{u}_{j}$，其偏量部分为 $\\tau_{ij}^{\\text{dev}} \\equiv \\tau_{ij} - \\frac{1}{3}\\tau_{kk}\\delta_{ij}$。对称的解析应变率张量为 $S_{ij} \\equiv \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\tilde{u}_{j}}{\\partial x_{i}}\\right)$，反对称的解析旋转率张量为 $W_{ij} \\equiv \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_{i}}{\\partial x_{j}} - \\frac{\\partial \\tilde{u}_{j}}{\\partial x_{i}}\\right)$。在点 $\\boldsymbol{x}_{0}$ 处，解析梯度的对称部分允许谱分解 $S = Q \\Lambda Q^{\\top}$，其中包含实特征值和标准正交特征向量，\n$$\n\\Lambda = \\operatorname{diag}\\!\\big(8,\\,2,\\,-10\\big)\\quad\\text{(in s}^{-1}\\text{)},\n$$\n且 $Q$ 是一个正交矩阵，由绕 $z$ 轴旋转 $\\theta = \\pi/6$ 再接着绕 $y$ 轴旋转 $\\phi = \\pi/4$ 复合而成，即 $Q = R_{z}(\\theta)\\,R_{y}(\\phi)$，其中\n$$\nR_{z}(\\theta) = \\begin{pmatrix}\n\\cos\\theta  -\\sin\\theta  0\\\\\n\\sin\\theta  \\cos\\theta  0\\\\\n0  0  1\n\\end{pmatrix},\\qquad\nR_{y}(\\phi) = \\begin{pmatrix}\n\\cos\\phi  0  \\sin\\phi\\\\\n0  1  0\\\\\n-\\sin\\phi  0  \\cos\\phi\n\\end{pmatrix}.\n$$\n假设在 $\\boldsymbol{x}_{0}$ 点处的完整解析梯度为 $\\partial \\tilde{u}_{i}/\\partial x_{j} = S_{ij} + W_{ij}$，其反对称部分由下式指定\n$$\nW = \\begin{pmatrix}\n0  -3  -2\\\\\n3  0  -1\\\\\n2  1  0\n\\end{pmatrix}\\quad\\text{(in s}^{-1}\\text{)}.\n$$\n采用一个将偏量子网格尺度应力与解析运动学联系起来的各向同性涡粘性封闭。\n\n从滤波后的方程和上述定义出发，确定在 $\\boldsymbol{x}_{0}$ 点处 $\\tau_{ij}^{\\text{dev}}$ 的主轴（单位特征向量），并以相对于实验室基的方向余弦表示。将你的答案以一个标准正交矩阵的形式给出，该矩阵的列是这些主轴。然后，简要论证反对称部分 $W_{ij}$ 是否以及如何影响 $\\tau_{ij}^{\\text{dev}}$ 的主轴，并解释 $\\tau_{ij}^{\\text{dev}}$ 与解析应变之间的对齐关系。\n\n精确表示主轴的最终标准正交矩阵（无四舍五入）。",
            "solution": "该问题要求确定偏量子网格尺度 (SGS) 应力张量 $\\tau_{ij}^{\\text{dev}}$ 的主轴，并讨论其与解析流运动学的关系。\n\n首先，我们必须建立 $\\tau_{ij}^{\\text{dev}}$ 与解析量之间的关系。问题陈述采用了各向同性涡粘性封闭。对于不可压缩流，此类模型的一般形式是用于湍流的 Boussinesq 假设：\n$$\n\\tau_{ij}^{\\text{dev}} = \\tau_{ij} - \\frac{1}{3}\\tau_{kk}\\delta_{ij} = -2 \\nu_{SGS} S_{ij}\n$$\n此处，$\\nu_{SGS}$ 是标量涡粘性，它是一个由解析流的局部属性和滤波尺度决定的正值。$S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\tilde{u}_{j}}{\\partial x_{i}}\\right)$ 是解析应变率张量。\n\n此本构关系表明，张量 $\\tau_{ij}^{\\text{dev}}$ 与张量 $S_{ij}$ 成正比，比例常数为负标量 $-2\\nu_{SGS}$。线性张量关系的一个基本性质是，如果两个张量通过一个标量倍数成比例，它们共享同一组特征向量（主轴）。特征值也按相同的因子缩放。具体来说，如果 $\\boldsymbol{v}$ 是 $S_{ij}$ 的一个特征向量，其特征值为 $\\lambda_S$，则 $S_{ij} v_j = \\lambda_S v_i$。将 $\\tau_{ij}^{\\text{dev}}$ 应用于 $\\boldsymbol{v}$ 可得：\n$$\n\\tau_{ij}^{\\text{dev}}v_j = (-2\\nu_{SGS}S_{ij})v_j = -2\\nu_{SGS}(S_{ij}v_j) = -2\\nu_{SGS}(\\lambda_S v_i) = (-2\\nu_{SGS}\\lambda_S)v_i\n$$\n因此，$\\boldsymbol{v}$ 也是 $\\tau_{ij}^{\\text{dev}}$ 的一个特征向量，其特征值为 $\\lambda_{\\tau} = -2\\nu_{SGS}\\lambda_S$。这证实了 $\\tau_{ij}^{\\text{dev}}$ 的主轴与 $S_{ij}$ 的主轴相同。\n\n问题给出了 $S_{ij}$ 的谱分解为 $S = Q \\Lambda Q^{\\top}$。在此分解中，$\\Lambda$ 是 $S$ 的特征值组成的对角矩阵，而 $Q$ 是一个正交矩阵，其列是 $S$ 对应的标准正交特征向量。这些特征向量就是 $S$ 的主轴。因此，为了找到 $\\tau_{ij}^{\\text{dev}}$ 的主轴，我们需要计算矩阵 $Q$。\n\n矩阵 $Q$ 由两个旋转复合而成：$Q = R_{z}(\\theta)R_{y}(\\phi)$，其中 $\\theta = \\pi/6$ 且 $\\phi = \\pi/4$。首先，我们计算三角函数值：\n$$\n\\cos(\\theta) = \\cos(\\pi/6) = \\frac{\\sqrt{3}}{2}, \\quad \\sin(\\theta) = \\sin(\\pi/6) = \\frac{1}{2}\n$$\n$$\n\\cos(\\phi) = \\cos(\\pi/4) = \\frac{\\sqrt{2}}{2}, \\quad \\sin(\\phi) = \\sin(\\pi/4) = \\frac{\\sqrt{2}}{2}\n$$\n旋转矩阵为：\n$$\nR_{z}(\\theta) = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0\\\\ \\sin\\theta  \\cos\\theta  0\\\\ 0  0  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  0\\\\ \\frac{1}{2}  \\frac{\\sqrt{3}}{2}  0\\\\ 0  0  1 \\end{pmatrix}\n$$\n$$\nR_{y}(\\phi) = \\begin{pmatrix} \\cos\\phi  0  \\sin\\phi\\\\ 0  1  0\\\\ -\\sin\\phi  0  \\cos\\phi \\end{pmatrix} = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2}\\\\ 0  1  0\\\\ -\\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2} \\end{pmatrix}\n$$\n现在，我们计算乘积 $Q = R_{z}(\\theta)R_{y}(\\phi)$：\n$$\nQ = \\begin{pmatrix} \\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  0\\\\ \\frac{1}{2}  \\frac{\\sqrt{3}}{2}  0\\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2}\\\\ 0  1  0\\\\ -\\frac{\\sqrt{2}}{2}  0  \\frac{\\sqrt{2}}{2} \\end{pmatrix}\n$$\n$$\nQ = \\begin{pmatrix}\n(\\frac{\\sqrt{3}}{2})(\\frac{\\sqrt{2}}{2}) + (-\\frac{1}{2})(0) + (0)(-\\frac{\\sqrt{2}}{2})   (\\frac{\\sqrt{3}}{2})(0) + (-\\frac{1}{2})(1) + (0)(0)   (\\frac{\\sqrt{3}}{2})(\\frac{\\sqrt{2}}{2}) + (-\\frac{1}{2})(0) + (0)(\\frac{\\sqrt{2}}{2}) \\\\\n(\\frac{1}{2})(\\frac{\\sqrt{2}}{2}) + (\\frac{\\sqrt{3}}{2})(0) + (0)(-\\frac{\\sqrt{2}}{2})   (\\frac{1}{2})(0) + (\\frac{\\sqrt{3}}{2})(1) + (0)(0)   (\\frac{1}{2})(\\frac{\\sqrt{2}}{2}) + (\\frac{\\sqrt{3}}{2})(0) + (0)(\\frac{\\sqrt{2}}{2}) \\\\\n(0)(\\frac{\\sqrt{2}}{2}) + (0)(0) + (1)(-\\frac{\\sqrt{2}}{2})   (0)(0) + (0)(1) + (1)(0)   (0)(\\frac{\\sqrt{2}}{2}) + (0)(0) + (1)(\\frac{\\sqrt{2}}{2})\n\\end{pmatrix}\n$$\n$$\nQ = \\begin{pmatrix}\n\\frac{\\sqrt{6}}{4}   -\\frac{1}{2}   \\frac{\\sqrt{6}}{4} \\\\\n\\frac{\\sqrt{2}}{4}   \\frac{\\sqrt{3}}{2}   \\frac{\\sqrt{2}}{4} \\\\\n-\\frac{\\sqrt{2}}{2}   0   \\frac{\\sqrt{2}}{2}\n\\end{pmatrix}\n$$\n该矩阵 $Q$ 的列是 $S_{ij}$ 和 $\\tau_{ij}^{\\text{dev}}$ 的单位特征向量（主轴）。\n\n接下来，我们讨论速度梯度的反对称部分 $W_{ij}$ 的影响。解析速度梯度张量分解为 $\\frac{\\partial \\tilde{u}_{i}}{\\partial x_{j}} = S_{ij} + W_{ij}$。各向同性涡粘性模型 $\\tau_{ij}^{\\text{dev}} = -2\\nu_{SGS}S_{ij}$ 仅依赖于对称部分 $S_{ij}$。因此，在此模型的框架内，解析旋转率张量 $W_{ij}$ 对 SGS 应力张量 $\\tau_{ij}$ 没有影响，因此对其偏量部分 $\\tau_{ij}^{\\text{dev}}$ 或其主轴也没有影响。这是线性涡粘性模型的一个关键特征和局限性。更高级的、非线性的或各向异性的 SGS 模型可以并且确实包含了对 $W_{ij}$ 的依赖关系，这可能导致 $\\tau_{ij}^{\\text{dev}}$ 和 $S_{ij}$ 的主轴之间出现不对齐。\n\n最后，我们解释 $\\tau_{ij}^{\\text{dev}}$ 与解析应变的对齐关系。$\\tau_{ij}^{\\text{dev}}$ 和 $S_{ij}$ 主轴的完美对齐是 Boussinesq 假设的直接结果。该假设将子网格尺度湍流脉动对解析流的影响建模为一种增强的分子粘性。这种“涡粘性”的主要作用是从解析尺度上耗散动能。从解析尺度到子网格尺度的能量传递率（SGS 耗散率）由 $\\epsilon_{SGS} = -\\tau_{ij}S_{ij}$ 给出。对于各向同性涡粘性模型，这简化为 $\\epsilon_{SGS} = -\\tau_{ij}^{\\text{dev}}S_{ij} = -(-2\\nu_{SGS}S_{ij})S_{ij} = 2\\nu_{SGS}S_{ij}S_{ij} = 2\\nu_{SGS}|S|^2$。由于 $\\nu_{SGS}  0$ 且 $|S|^2 \\ge 0$，SGS 耗散总是非负的，这意味着该模型是纯耗散的（能量总是从大尺度流向小尺度）。$\\tau_{ij}^{\\text{dev}}$ 和 $S_{ij}$ 的共轴性是这一物理假设的数学表示。特征值之间的关系为 $\\lambda_{\\tau} = -2\\nu_{SGS}\\lambda_S$。这表明应变的最拉伸方向（最大的正 $\\lambda_S$）与最压缩的 SGS 应力（最负的 $\\lambda_{\\tau}$）对齐，代表了小尺度对大尺度变形的制动效应。虽然这是一个合理且简单的模型，但直接数值模拟和实验表明，在真实的湍流中，真实的 SGS 应力主轴和解析应变率张量主轴常常是不对齐的。",
            "answer": "$$\n\\boxed{\\begin{pmatrix}\n\\frac{\\sqrt{6}}{4}   -\\frac{1}{2}   \\frac{\\sqrt{6}}{4} \\\\\n\\frac{\\sqrt{2}}{4}   \\frac{\\sqrt{3}}{2}   \\frac{\\sqrt{2}}{4} \\\\\n-\\frac{\\sqrt{2}}{2}   0   \\frac{\\sqrt{2}}{2}\n\\end{pmatrix}}\n$$"
        },
        {
            "introduction": "为了深刻理解亚格子应力的物理来源，我们需要将其分解为不同尺度相互作用的贡献。本练习将引导你对一个简化的速度场进行Leonard–Cross–Reynolds分解，从而清晰地分离出由已解析尺度之间相互作用产生的Leonard应力 $L_{ij}$、已解析尺度与亚格子尺度相互作用产生的Cross应力 $C_{ij}$，以及亚格子尺度之间相互作用产生的Reynolds应力 $R_{ij}$。完成这个练习将为理解动态程序等高级建模思想奠定坚实的理论基础。",
            "id": "3367527",
            "problem": "考虑一个二维周期性环面上的不可压缩、常密度速度场，其在每个方向上的周期为 $2\\pi$。该速度场由两个大尺度（已解析）傅里叶模态和一个小尺度（亚格子）残余模态组成。大尺度已解析分量 $\\bar{\\boldsymbol{u}}(x,y)$ 由流函数表示定义：\n$$\n\\psi_{1}(x,y) = A \\cos(x), \\quad \\psi_{2}(x,y) = B \\cos(y),\n$$\n速度为 $\\bar{\\boldsymbol{u}} = \\nabla^{\\perp}(\\psi_{1} + \\psi_{2}) = \\left(\\frac{\\partial}{\\partial y}, -\\frac{\\partial}{\\partial x}\\right)(\\psi_{1} + \\psi_{2})$，亚格子（残余）分量 $\\boldsymbol{u}'(x,y)$ 定义为：\n$$\n\\psi_{r}(x,y) = A_{r} \\cos(2x + y), \\quad \\boldsymbol{u}' = \\nabla^{\\perp}\\psi_{r}.\n$$\n设大涡模拟（LES）滤波器为在欧几里得波数 $|\\boldsymbol{k}| \\leq k_{c}$ 处的尖锐谱截断，其中 $k_{c} = \\frac{3}{2}$，因此波矢量为 $(1,0)$ 和 $(0,1)$ 的已解析模态会通过滤波器，而波矢量为 $(2,1)$ 的残余模态则被滤波器完全移除。因此，根据构造，滤波后的速度满足 $\\bar{\\boldsymbol{u}} = \\boldsymbol{u} - \\boldsymbol{u}'$。\n\n您将处理亚格子尺度应力张量\n$$\n\\tau_{ij} = \\overline{u_{i} u_{j}} - \\bar{u}_{i}\\,\\bar{u}_{j},\n$$\n及其在LES滤波器尺度上的Leonard-交叉-Reynolds分解，\n$$\n\\tau_{ij} = L_{ij} + C_{ij} + R_{ij},\n$$\n其中 $L_{ij}$、$C_{ij}$ 和 $R_{ij}$ 需要从第一性原理出发，基于分解 $\\boldsymbol{u} = \\bar{\\boldsymbol{u}} + \\boldsymbol{u}'$ 和给定的滤波器进行定义和推导。\n\n取振幅 $A = 2$、$B = 1$ 和 $A_{r} = 1$。在点 $(x,y) = \\left(\\frac{\\pi}{6}, \\frac{\\pi}{6}\\right)$ 处：\n- 推导由指定滤波器和场分解引起的 $L_{ij}$、$C_{ij}$ 和 $R_{ij}$ 的表达式，并在该点对其求值。\n- 通过计算这三个张量在该点的弗罗贝尼乌斯范数 $\\|L\\|_{F}$、$\\|C\\|_{F}$ 和 $\\|R\\|_{F}$，来量化并比较它们的量级。\n\n将最终答案表示为有序三元组 $(\\|L\\|_{F}, \\|C\\|_{F}, \\|R\\|_{F})$，形式为精确的闭合形式。不包含单位。不要四舍五入。",
            "solution": "用户希望对给定二维速度场的亚格子尺度应力张量进行Leonard-交叉-Reynolds分解分析。\n\n首先验证问题。所有给定的量、定义和条件都已明确说明。该问题设置在流体动力学中大涡模拟（LES）的标准理论框架内，使用了诸如流函数、谱滤波器和亚格子尺度应力张量等成熟的概念。该设置是一个用于分析LES闭合项的简化但科学上合理的模型。所有必要的参数（$A, B, A_r, k_c$）和求值点都已提供。该问题是自洽的、有科学依据的、适定的和客观的。因此，该问题是有效的，将推导求解。\n\n**步骤1：定义速度场**\n\n已解析（大尺度）速度场 $\\bar{\\boldsymbol{u}} = (\\bar{u}_{1}, \\bar{u}_{2})$ 由流函数 $\\psi = \\psi_1 + \\psi_2 = A \\cos(x) + B \\cos(y)$ 导出。\n速度分量由 $\\bar{u}_{1} = \\frac{\\partial \\psi}{\\partial y}$ 和 $\\bar{u}_{2} = -\\frac{\\partial \\psi}{\\partial x}$ 给出。\n$$\n\\bar{u}_{1}(x,y) = \\frac{\\partial}{\\partial y}(A \\cos(x) + B \\cos(y)) = -B \\sin(y)\n$$\n$$\n\\bar{u}_{2}(x,y) = -\\frac{\\partial}{\\partial x}(A \\cos(x) + B \\cos(y)) = A \\sin(x)\n$$\n因此，已解析速度矢量为 $\\bar{\\boldsymbol{u}} = (-B \\sin(y), A \\sin(x))$。\n\n亚格子（小尺度）速度场 $\\boldsymbol{u}' = (u'_{1}, u'_{2})$ 由流函数 $\\psi_{r} = A_{r} \\cos(2x + y)$ 导出。\n$$\nu'_{1}(x,y) = \\frac{\\partial \\psi_r}{\\partial y} = \\frac{\\partial}{\\partial y}(A_{r} \\cos(2x + y)) = -A_{r} \\sin(2x + y)\n$$\n$$\nu'_{2}(x,y) = -\\frac{\\partial \\psi_r}{\\partial x} = -\\frac{\\partial}{\\partial x}(A_{r} \\cos(2x + y)) = 2A_{r} \\sin(2x + y)\n$$\n因此，亚格子速度矢量为 $\\boldsymbol{u}' = A_{r} \\sin(2x+y) (-1, 2)$。\n\n**步骤2：Leonard-交叉-Reynolds 分解**\n\n亚格子尺度（SGS）应力张量定义为 $\\tau_{ij} = \\overline{u_{i} u_{j}} - \\bar{u}_{i}\\,\\bar{u}_{j}$，其中上划线表示LES滤波操作。总速度为 $\\boldsymbol{u} = \\bar{\\boldsymbol{u}} + \\boldsymbol{u}'$。将其代入 $\\tau_{ij}$ 的定义，并利用对于尖锐谱滤波器（它是一个投影算子），有 $\\overline{\\bar{\\boldsymbol{u}}} = \\bar{\\boldsymbol{u}}$ 且根据构造有 $\\overline{\\boldsymbol{u}'} = \\boldsymbol{0}$，我们得到 $\\overline{\\boldsymbol{u}} = \\overline{\\bar{\\boldsymbol{u}} + \\boldsymbol{u}'} = \\bar{\\boldsymbol{u}}$。\n$$\n\\tau_{ij} = \\overline{(\\bar{u}_{i} + u'_{i})(\\bar{u}_{j} + u'_{j})} - \\bar{u}_{i}\\bar{u}_{j}\n$$\n展开乘积并利用滤波器的线性性质：\n$$\n\\tau_{ij} = \\overline{\\bar{u}_{i}\\bar{u}_{j}} + \\overline{\\bar{u}_{i}u'_{j}} + \\overline{u'_{i}\\bar{u}_{j}} + \\overline{u'_{i}u'_{j}} - \\bar{u}_{i}\\bar{u}_{j}\n$$\n重新整理得到分解 $\\tau_{ij} = L_{ij} + C_{ij} + R_{ij}$：\n-   **Leonard应力**: $L_{ij} = \\overline{\\bar{u}_{i}\\bar{u}_{j}} - \\bar{u}_{i}\\bar{u}_{j}$\n-   **交叉应力**: $C_{ij} = \\overline{\\bar{u}_{i}u'_{j}} + \\overline{u'_{i}\\bar{u}_{j}}$\n-   **Reynolds应力**: $R_{ij} = \\overline{u'_{i}u'_{j}}$\n\n该滤波器是在 $k_c = \\frac{3}{2}$ 处的尖锐谱截断。一个函数的傅里叶模态，若其波矢量为 $\\boldsymbol{k}$，当 $|\\boldsymbol{k}| \\le k_c$ 时通过滤波器，当 $|\\boldsymbol{k}|  k_c$ 时被移除。两个波矢量为 $\\boldsymbol{k}_a$ 和 $\\boldsymbol{k}_b$ 的模态的乘积会生成波矢量为 $\\boldsymbol{k}_a \\pm \\boldsymbol{k}_b$ 的模态。\n\n**步骤3：计算Leonard应力张量 $L_{ij}$**\n\n我们首先构建张量积 $\\bar{u}_i \\bar{u}_j$：\n$$\n\\bar{u}_i \\bar{u}_j = \\begin{pmatrix} \\bar{u}_{1}^2   \\bar{u}_{1}\\bar{u}_{2} \\\\ \\bar{u}_{2}\\bar{u}_{1}   \\bar{u}_{2}^2 \\end{pmatrix} = \\begin{pmatrix} B^2 \\sin^2(y)   -AB \\sin(x)\\sin(y) \\\\ -AB \\sin(x)\\sin(y)   A^2 \\sin^2(x) \\end{pmatrix}\n$$\n我们使用三角恒等式对每个分量应用滤波器：\n-   $\\overline{B^2 \\sin^2(y)} = \\overline{\\frac{B^2}{2}(1 - \\cos(2y))}$。$\\cos(2y)$ 项的波矢量为 $(0,2)$，其模长 $|\\boldsymbol{k}|=2  k_c$，因此被滤掉。常数项通过。因此，$\\overline{B^2 \\sin^2(y)} = \\frac{B^2}{2}$。\n-   $\\overline{A^2 \\sin^2(x)} = \\overline{\\frac{A^2}{2}(1 - \\cos(2x))}$。$\\cos(2x)$ 项的波矢量为 $(2,0)$，其模长 $|\\boldsymbol{k}|=2  k_c$，因此被滤掉。因此，$\\overline{A^2 \\sin^2(x)} = \\frac{A^2}{2}$。\n-   $\\overline{-AB \\sin(x)\\sin(y)} = \\overline{-\\frac{AB}{2}(\\cos(x-y) - \\cos(x+y))}$。这些项的波矢量为 $(\\pm 1, \\mp 1)$ 和 $(\\pm 1, \\pm 1)$，其模长均为 $|\\boldsymbol{k}|=\\sqrt{2} \\approx 1.414  k_c$。所有模态都通过。因此，$\\overline{-AB \\sin(x)\\sin(y)} = -AB \\sin(x)\\sin(y)$。\n\nLeonard张量为 $L_{ij} = \\overline{\\bar{u}_i \\bar{u}_j} - \\bar{u}_i \\bar{u}_j$：\n$$\nL_{ij} = \\begin{pmatrix} \\frac{B^2}{2}   -AB \\sin(x)\\sin(y) \\\\ -AB \\sin(x)\\sin(y)   \\frac{A^2}{2} \\end{pmatrix} - \\begin{pmatrix} B^2 \\sin^2(y)   -AB \\sin(x)\\sin(y) \\\\ -AB \\sin(x)\\sin(y)   A^2 \\sin^2(x) \\end{pmatrix}\n$$\n$$\nL_{ij} = \\begin{pmatrix} \\frac{B^2}{2} - B^2 \\sin^2(y)   0 \\\\ 0   \\frac{A^2}{2} - A^2 \\sin^2(x) \\end{pmatrix} = \\begin{pmatrix} \\frac{B^2}{2}\\cos(2y)   0 \\\\ 0   \\frac{A^2}{2}\\cos(2x) \\end{pmatrix}\n$$\n\n**步骤4：计算交叉应力张量 $C_{ij}$**\n\n我们分析乘积 $\\bar{u}_i u'_j$。这涉及到已解析模态（例如 $\\sin(x)$，$\\boldsymbol{k}=(1,0)$）和亚格子模态（$\\sin(2x+y)$，$\\boldsymbol{k}=(2,1)$）的乘积。\n-   $\\overline{\\sin(y)\\sin(2x+y)} = \\overline{\\frac{1}{2}(\\cos(2x) - \\cos(2x+2y))}$。波矢量为 $(2,0)$ 和 $(2,2)$，其模长分别为 $2$ 和 $\\sqrt{8}$，均大于 $k_c$。因此，结果为 $0$。\n-   $\\overline{\\sin(x)\\sin(2x+y)} = \\overline{\\frac{1}{2}(\\cos(x+y) - \\cos(3x+y))}$。波矢量为 $(1,1)$ 和 $(3,1)$，其模长分别为 $\\sqrt{2}$ 和 $\\sqrt{10}$。由于 $\\sqrt{2}  k_c$ 且 $\\sqrt{10}  k_c$，只有第一项通过。结果为 $\\frac{1}{2}\\cos(x+y)$。\n\n现在我们计算 $\\overline{\\bar{u}_i u'_j}$：\n$$\n\\overline{\\bar{u}_i u'_j} = \\begin{pmatrix} \\overline{(-B\\sin y)(-A_r\\sin(2x+y))}   \\overline{(-B\\sin y)(2A_r\\sin(2x+y))} \\\\ \\overline{(A\\sin x)(-A_r\\sin(2x+y))}   \\overline{(A\\sin x)(2A_r\\sin(2x+y))} \\end{pmatrix}\n$$\n$$\n\\overline{\\bar{u}_i u'_j} = \\begin{pmatrix} A_r B \\overline{\\sin y \\sin(2x+y)}   -2A_r B \\overline{\\sin y \\sin(2x+y)} \\\\ -A_r A \\overline{\\sin x \\sin(2x+y)}   2A_r A \\overline{\\sin x \\sin(2x+y)} \\end{pmatrix} = \\begin{pmatrix} 0   0 \\\\ -\\frac{A_r A}{2}\\cos(x+y)   A_r A \\cos(x+y) \\end{pmatrix}\n$$\n这可以写成 $\\frac{A_r A}{2}\\cos(x+y) \\begin{pmatrix} 0   0 \\\\ -1   2 \\end{pmatrix}$。\n交叉应力的另一部分是 $\\overline{u'_i \\bar{u}_j} = (\\overline{\\bar{u}_j u'_i})^T$。\n$$\n\\overline{u'_i \\bar{u}_j} = \\left( \\frac{A_r A}{2}\\cos(x+y) \\begin{pmatrix} 0   0 \\\\ -1   2 \\end{pmatrix} \\right)^T = \\frac{A_r A}{2}\\cos(x+y) \\begin{pmatrix} 0   -1 \\\\ 0   2 \\end{pmatrix}\n$$\n将它们相加得到 $C_{ij}$：\n$$\nC_{ij} = \\frac{A_r A}{2}\\cos(x+y) \\left( \\begin{pmatrix} 0   0 \\\\ -1   2 \\end{pmatrix} + \\begin{pmatrix} 0   -1 \\\\ 0   2 \\end{pmatrix} \\right) = \\frac{A_r A}{2}\\cos(x+y) \\begin{pmatrix} 0   -1 \\\\ -1   4 \\end{pmatrix}\n$$\n\n**步骤5：计算Reynolds应力张量 $R_{ij}$**\n\n我们分析乘积 $u'_i u'_j$：\n$$\nu'_i u'_j = \\begin{pmatrix} (u'_1)^2   u'_1 u'_2 \\\\ u'_2 u'_1   (u'_2)^2 \\end{pmatrix} = A_r^2 \\sin^2(2x+y) \\begin{pmatrix} 1   -2 \\\\ -2   4 \\end{pmatrix}\n$$\n我们对此量进行滤波：$\\overline{\\sin^2(2x+y)} = \\overline{\\frac{1}{2}(1 - \\cos(4x+2y))}$。$\\cos(4x+2y)$ 的波矢量为 $(4,2)$，其模长为 $\\sqrt{20}  k_c$。此项被滤掉，剩下 $\\overline{\\sin^2(2x+y)} = \\frac{1}{2}$。\n$$\nR_{ij} = \\overline{u'_i u'_j} = \\frac{A_r^2}{2} \\begin{pmatrix} 1   -2 \\\\ -2   4 \\end{pmatrix}\n$$\n\n**步骤6：在点 $(x,y) = (\\pi/6, \\pi/6)$ 处对张量求值并计算范数**\n\n给定 $A=2, B=1, A_r=1$ 和 $(x,y) = (\\pi/6, \\pi/6)$。\n$\\cos(2x) = \\cos(\\pi/3) = \\frac{1}{2}$。\n$\\cos(2y) = \\cos(\\pi/3) = \\frac{1}{2}$。\n$\\cos(x+y) = \\cos(\\pi/3) = \\frac{1}{2}$。\n\n-   **Leonard应力**：\n    $L = \\begin{pmatrix} \\frac{1^2}{2}(\\frac{1}{2})   0 \\\\ 0   \\frac{2^2}{2}(\\frac{1}{2}) \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{4}   0 \\\\ 0   1 \\end{pmatrix}$。\n    $\\|L\\|_F = \\sqrt{(\\frac{1}{4})^2 + 0^2 + 0^2 + 1^2} = \\sqrt{\\frac{1}{16} + 1} = \\sqrt{\\frac{17}{16}} = \\frac{\\sqrt{17}}{4}$。\n\n-   **交叉应力**：\n    $C = \\frac{1 \\cdot 2}{2}(\\frac{1}{2}) \\begin{pmatrix} 0   -1 \\\\ -1   4 \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} 0   -1 \\\\ -1   4 \\end{pmatrix} = \\begin{pmatrix} 0   -\\frac{1}{2} \\\\ -\\frac{1}{2}   2 \\end{pmatrix}$。\n    $\\|C\\|_F = \\sqrt{0^2 + (-\\frac{1}{2})^2 + (-\\frac{1}{2})^2 + 2^2} = \\sqrt{\\frac{1}{4} + \\frac{1}{4} + 4} = \\sqrt{\\frac{1}{2} + 4} = \\sqrt{\\frac{9}{2}} = \\frac{3}{\\sqrt{2}} = \\frac{3\\sqrt{2}}{2}$。\n\n-   **Reynolds应力**：\n    $R = \\frac{1^2}{2} \\begin{pmatrix} 1   -2 \\\\ -2   4 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2}   -1 \\\\ -1   2 \\end{pmatrix}$。\n    $\\|R\\|_F = \\sqrt{(\\frac{1}{2})^2 + (-1)^2 + (-1)^2 + 2^2} = \\sqrt{\\frac{1}{4} + 1 + 1 + 4} = \\sqrt{\\frac{1}{4} + 6} = \\sqrt{\\frac{25}{4}} = \\frac{5}{2}$。\n\n最终答案是有序三元组 $(\\|L\\|_{F}, \\|C\\|_{F}, \\|R\\|_{F})$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\sqrt{17}}{4}   \\frac{3\\sqrt{2}}{2}   \\frac{5}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "前面的练习揭示了Leonard应力是完全可由已解析流场计算的。动态程序正是利用这一特性来克服传统Smagorinsky模型常系数假定的局限性。在这个综合性练习中，你将从第一性原理出发，推导并实现一个完整的动态程序，用于局部计算Smagorinsky系数 $C_s^2$。通过这个实践，你不仅能掌握动态建模的核心思想，还能体会到理论推导如何转化为解决实际CFD问题的强大数值算法。",
            "id": "3367475",
            "problem": "你的任务是为二维周期性已解析速度场实现大涡模拟（LES）中亚格子尺度模型的动态程序，以计算局域 Smagorinsky 系数平方 $C_s^2$ 并与常系数模型进行比较。该实现必须是一个完整的、可运行的程序。推导和算法必须从基本的滤波方程和张量定义出发，不得依赖快捷公式。\n\n从滤波后的 Navier-Stokes 方程和亚格子尺度应力张量的定义开始。亚格子尺度（SGS）应力张量由滤波后乘积与滤波后变量乘积之差定义为\n$$\\tau_{ij} = \\overline{u_i u_j} - \\overline{u}_i\\, \\overline{u}_j,$$\n其中 $u_i$ 是已解析速度，上划线表示在网格尺度 $ \\Delta $ 上的滤波。在 Smagorinsky 框架中，SGS 应力的有模型偏应力部分由下式给出\n$$\\tau_{ij}^{\\mathrm{dev}} = -2 \\nu_t S_{ij},$$\n其中 $\\nu_t$ 是涡粘性系数，$S_{ij}$ 是已解析应变率张量，\n$$S_{ij} = \\frac{1}{2}\\left( \\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i} \\right),$$\n应变率大小为\n$$|S| = \\sqrt{2\\, S_{ij} S_{ij}}.$$\n在常系数 Smagorinsky 模型中，$\\nu_t$ 由下式给出\n$$\\nu_t = (C_s \\Delta)^2 |S|,$$\n其中 $C_s$ 是一个预设常数。\n\n动态程序基于 Germano 恒等式，使用一个尺度为 $ \\widetilde{\\Delta} = \\alpha \\Delta $ 的测试滤波器，并定义了 Leonard 应力张量\n$$L_{ij} = \\widetilde{u_i u_j} - \\widetilde{u}_i\\, \\widetilde{u}_j,$$\n其中波浪线表示测试滤波。使用一个礼帽测试滤波器，实现为在周期性边界条件下的 $3 \\times 3$ 模板上的局部平均。通过调用 Germano 恒等式，并仅使用偏应力分量在每个网格单元上执行最小二乘法最小化，来推导局域 $C_s^2$ 的表达式。不要在问题陈述中使用或声明快捷公式；你的推导必须从上述定义开始，通过第一性原理得出局域 $C_s^2$ 的表达式。\n\n实现细节和约定：\n- 在方形域上，使用二维空间和周期性边界条件。\n- 使用间距为 $ \\Delta = \\Delta x = \\Delta y $ 的均匀网格，并对空间导数使用离散中心差分近似。\n- 将测试滤波器定义为核大小为 $3 \\times 3$ 的离散礼帽滤波器，并应用周期性包裹。\n- 在形成内积之前，通过从任意二阶张量 $A_{ij}$ 中减去 $ \\frac{1}{2} A_{kk} \\delta_{ij} $ 来处理二维情况下的偏应力部分。\n- 当最小二乘表达式中的分母低于您选择的某个小阈值 $\\varepsilon$ 时，通过设置 $C_s^2 = 0$ 来处理退化情况。\n- 对用于涡粘性系数的最终 $C_s^2$ 实现非负裁剪，即使用 $\\max(C_s^2, 0)$ 进行比较。\n- 全程使用无量纲单位。无需进行物理单位转换。\n\n你的程序必须实现以下测试套件，每个测试用例均在域 $x \\in [0, 2\\pi)$, $y \\in [0, 2\\pi)$ 上定义，并带有周期性边界条件：\n\n- 测试用例 $1$ （理想情况，非平凡的已解析梯度）：\n  - 网格分辨率 $N_x = N_y = 64$。\n  - 滤波比 $\\alpha = 2$。\n  - 恒定 Smagorinsky 系数 $C_0 = 0.17$。\n  - 已解析速度场：\n    $$u_1(x,y) = \\sin(k x)\\cos(k y), \\quad u_2(x,y) = -\\cos(k x)\\sin(k y),$$\n    其中波数 $k = 4$。\n- 测试用例 $2$ （梯度消失的边缘情况）：\n  - 网格分辨率 $N_x = N_y = 64$。\n  - 滤波比 $\\alpha = 2$。\n  - 恒定 Smagorinsky 系数 $C_0 = 0.17$。\n  - 已解析速度场：\n    $$u_1(x,y) = U_0, \\quad u_2(x,y) = 0,$$\n    其中常数 $U_0 = 1$。\n- 测试用例 $3$ （恒定剪切，域上应变率大小均匀）：\n  - 网格分辨率 $N_x = N_y = 64$。\n  - 滤波比 $\\alpha = 2$。\n  - 恒定 Smagorinsky 系数 $C_0 = 0.17$。\n  - 已解析速度场：\n    $$u_1(x,y) = a\\, y, \\quad u_2(x,y) = 0,$$\n    其中剪切振幅 $a = 1$。\n\n对于每个测试用例：\n- 使用动态程序计算局域动态 $C_s^2$ 场及其在操作中使用的非负裁剪版本。\n- 计算裁剪后动态 $C_s^2$ 的域平均值，记为 $\\langle C_s^2 \\rangle_{\\mathrm{dyn}}$。\n- 通过构建标量差与常系数模型进行比较\n$$D = \\langle C_s^2 \\rangle_{\\mathrm{dyn}} - C_0^2.$$\n\n你的程序应生成单行输出，其中包含按测试用例 $1$、$2$、$3$ 顺序排列的结果，格式为方括号内以逗号分隔的列表，即 $[D_1, D_2, D_3]$。所有输出必须是无量纲浮点数。三角函数中使用的角度以弧度为单位。不涉及百分比。",
            "solution": "任务是实现用于大涡模拟（LES）的 Smagorinsky 系数 $C_s$ 的动态计算程序。解决方案需要从第一性原理进行推导，然后进行数值实现。\n\n### 局域 Smagorinsky 系数的推导\n\n由 Germano 等人构想的动态程序提供了一种基于已解析速度场在局域计算模型系数 $C_s$ 的方法，而不是假定它是一个普适常数。它利用了将两个不同的空间滤波器应用于流场时产生的数学恒等式。\n\n设 $u_i$ 是问题陈述中明确给出的已解析速度场。主滤波器是网格滤波器，其特征宽度为 $\\Delta$。问题还引入了一个次级的、更粗的滤波器，即测试滤波器，用波浪线 $(\\widetilde{\\cdot})$ 表示，其特征宽度为 $\\widetilde{\\Delta} = \\alpha\\Delta$，其中 $\\alpha  1$。\n\n网格尺度上的亚格子尺度（SGS）应力张量 $\\tau_{ij}$ 表示未解析尺度对已解析尺度的影响。Smagorinsky 模型为该张量的偏应力部分提出了一个本构关系，它与已解析应变率张量 $S_{ij}$ 成正比：\n$$ \\tau_{ij}^{\\mathrm{dev}} \\approx -2 \\nu_t S_{ij} = -2 (C_s \\Delta)^2 |S| S_{ij} $$\n此处，$S_{ij} = \\frac{1}{2}(\\partial_j u_i + \\partial_i u_j)$ 是已解析应变率张量，而 $|S| = \\sqrt{2S_{kl}S_{kl}}$ 是其大小。\n\n对于测试滤波器尺度上的 SGS 应力张量 $T_{ij}$，可以写出类似的模型：\n$$ T_{ij}^{\\mathrm{dev}} \\approx -2 (C_s \\widetilde{\\Delta})^2 |\\widetilde{S}| \\widetilde{S}_{ij} $$\n其中 $\\widetilde{S}_{ij}$ 是从测试滤波后的速度场 $\\widetilde{u}_i$ 计算出的应变率张量。一个关键假设是系数 $C_s$ 在两个尺度上是相同的。\n\nGermano 恒等式提供了两个尺度上的 SGS 应力与 Leonard 应力张量 $L_{ij}$ 之间的精确关系：\n$$ L_{ij} = T_{ij} - \\widetilde{\\tau_{ij}} $$\n其中 $L_{ij} = \\widetilde{u_i u_j} - \\widetilde{u}_i \\widetilde{u}_j$ 是 Leonard 应力，可以直接从已解析速度场 $u_i$ 计算得出。该恒等式对偏应力部分同样成立：\n$$ L_{ij}^{\\mathrm{dev}} = T_{ij}^{\\mathrm{dev}} - \\widetilde{\\tau_{ij}^{\\mathrm{dev}}} $$\n\n将 $T_{ij}^{\\mathrm{dev}}$ 和 $\\tau_{ij}^{\\mathrm{dev}}$ 的 Smagorinsky 模型代入此恒等式，得到一个关于 $C_s$ 的方程：\n$$ L_{ij}^{\\mathrm{dev}} \\approx -2 (C_s \\widetilde{\\Delta})^2 |\\widetilde{S}| \\widetilde{S}_{ij} - \\widetilde{(-2 (C_s \\Delta)^2 |S| S_{ij})} $$\n动态程序的核心假设是 Smagorinsky 系数 $C_s$ 在空间上变化缓慢，因此可以将其移出测试滤波操作：\n$$ L_{ij}^{\\mathrm{dev}} \\approx -2 C_s^2 \\widetilde{\\Delta}^2 |\\widetilde{S}| \\widetilde{S}_{ij} + 2 C_s^2 \\Delta^2 \\widetilde{|S| S_{ij}} $$\n重排各项以求解 $C_s^2$：\n$$ L_{ij}^{\\mathrm{dev}} \\approx C_s^2 \\left[ 2 \\Delta^2 \\widetilde{|S| S_{ij}} - 2 \\widetilde{\\Delta}^2 |\\widetilde{S}| \\widetilde{S}_{ij} \\right] $$\n让我们定义一个模型张量 $M_{ij}$：\n$$ M_{ij} = 2 \\Delta^2 \\left( \\widetilde{|S| S_{ij}} - \\alpha^2 |\\widetilde{S}| \\widetilde{S}_{ij} \\right) $$\n方程变为 $L_{ij}^{\\mathrm{dev}} \\approx C_s^2 M_{ij}$。为了正确地等同偏应力张量，我们应将 $M_{ij}$ 投影到其偏应力部分 $M_{ij}^{\\mathrm{dev}} = M_{ij} - \\frac{1}{2} M_{kk} \\delta_{ij}$。这产生了一个只有一个标量未知数 $C_s^2$ 的张量方程：\n$$ L_{ij}^{\\mathrm{dev}} \\approx C_s^2 M_{ij}^{\\mathrm{dev}} $$\n该系统是超定的（在二维情况下，3 个独立方程求解一个未知数）。为了在每个网格点找到 $C_s^2$ 的最优值，我们使用指标求和约定，最小化误差平方和 $e = (L_{ij}^{\\mathrm{dev}} - C_s^2 M_{ij}^{\\mathrm{dev}})(L_{ij}^{\\mathrm{dev}} - C_s^2 M_{ij}^{\\mathrm{dev}})$。对 $C_s^2$ 求导并令其为零，得到最小二乘解：\n$$ \\frac{\\partial e}{\\partial (C_s^2)} = -2 L_{ij}^{\\mathrm{dev}} M_{ij}^{\\mathrm{dev}} + 2 C_s^2 M_{kl}^{\\mathrm{dev}} M_{kl}^{\\mathrm{dev}} = 0 $$\n$$ C_s^2 = \\frac{L_{ij}^{\\mathrm{dev}} M_{ij}^{\\mathrm{dev}}}{M_{kl}^{\\mathrm{dev}} M_{kl}^{\\mathrm{dev}}} = \\frac{\\langle L^{\\mathrm{dev}}, M^{\\mathrm{dev}} \\rangle}{\\langle M^{\\mathrm{dev}}, M^{\\mathrm{dev}} \\rangle} $$\n这个表达式允许在域中任何位置进行 $C_s^2$ 的局域计算。\n\n### 算法实现\n\n对于给定的均匀周期性网格上的二维速度场 $(u_1, u_2)$，数值实现逐一遵循推导步骤。\n\n1.  **离散化**：在域 $[0, 2\\pi) \\times [0, 2\\pi)$ 上定义一个大小为 $N_x \\times N_y$ 的均匀网格，网格间距为 $\\Delta = \\Delta x = \\Delta y = 2\\pi / N_x$。\n2.  **计算导数**：应变率张量 $S_{ij}$ 所需的空间导数使用带有周期性边界条件的二阶中心差分进行近似。对于场 $f(x_i)$，$\\frac{\\partial f}{\\partial x}|_{i} \\approx \\frac{f(x_{i+1}) - f(x_{i-1})}{2\\Delta x}$。\n3.  **计算已解析应变率场**：根据速度场 $u_i = (u_1, u_2)$，计算应变率张量的分量 $S_{11}$、$S_{12}$、$S_{22}$ 和应变率大小 $|S|$。\n4.  **应用测试滤波器**：测试滤波器是一个 $3 \\times 3$ 的礼帽滤波器，实现为与归一化全一核的离散卷积。此操作应用于速度分量 $u_i$ 以获得 $\\widetilde{u}_i$。\n5.  **计算 Leonard 应力张量 ($L_{ij}$)**：\n    - 计算乘积 $u_i u_j$。\n    - 对这些乘积应用测试滤波器，得到 $\\widetilde{u_i u_j}$。\n    - 计算滤波后速度的乘积 $\\widetilde{u}_i \\widetilde{u}_j$。\n    - 计算 $L_{ij} = \\widetilde{u_i u_j} - \\widetilde{u}_i \\widetilde{u}_j$。\n    - 计算偏应力部分，$L_{ij}^{\\mathrm{dev}} = L_{ij} - \\frac{1}{2}(L_{11}+L_{22})\\delta_{ij}$。\n6.  **计算模型张量 ($M_{ij}$)**：\n    - 形成张量场 $\\beta_{ij} = |S| S_{ij}$ 并应用测试滤波器得到 $\\widetilde{\\beta_{ij}}$。\n    - 对该应变率张量 $S_{ij}$ 应用测试滤波器得到 $\\widetilde{S}_{ij}$。\n    - 计算滤波后应变率张量的大小，$|\\widetilde{S}| = \\sqrt{2 \\widetilde{S}_{kl}\\widetilde{S}_{kl}}$。\n    - 形成张量场 $\\gamma_{ij} = |\\widetilde{S}| \\widetilde{S}_{ij}$。\n    - 组合得到 $M_{ij} = 2 \\Delta^2 (\\widetilde{\\beta_{ij}} - \\alpha^2 \\gamma_{ij})$。\n    - 计算偏应力部分，$M_{ij}^{\\mathrm{dev}} = M_{ij} - \\frac{1}{2}(M_{11}+M_{22})\\delta_{ij}$。\n7.  **计算 $C_s^2$**：\n    - 在每个网格点计算分子 $\\langle L^{\\mathrm{dev}}, M^{\\mathrm{dev}} \\rangle = L_{ij}^{\\mathrm{dev}} M_{ij}^{\\mathrm{dev}}$ 和分母 $\\langle M^{\\mathrm{dev}}, M^{\\mathrm{dev}} \\rangle = M_{kl}^{\\mathrm{dev}} M_{kl}^{\\mathrm{dev}}$。\n    - 计算 $C_s^2$。当分母小于阈值 $\\varepsilon$ 时，设 $C_s^2=0$ 以防止除以零并处理退化情况。\n8.  **后处理**：\n    - 对结果场进行裁剪以确保非负性：$C_{s,\\text{clipped}}^2 = \\max(C_s^2, 0)$。\n    - 计算域平均值，$\\langle C_s^2 \\rangle_{\\mathrm{dyn}} = \\mathrm{mean}(C_{s,\\text{clipped}}^2)$。\n    - 计算最终差值 $D = \\langle C_s^2 \\rangle_{\\mathrm{dyn}} - C_0^2$，用于与常系数模型进行比较。\n\n此程序应用于问题中指定的三个测试用例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import ndimage\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    # test_cases: (Nx, Ny, alpha, C0, u_func_type, param)\n    # u_func_type determines the velocity field: 'taylor_green', 'constant', or 'shear'.\n    # param corresponds to wavenumber 'k' or amplitude 'a' or 'U0'.\n    test_cases = [\n        (64, 64, 2.0, 0.17, 'taylor_green', 4.0),\n        (64, 64, 2.0, 0.17, 'constant', 1.0),\n        (64, 64, 2.0, 0.17, 'shear', 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        D = compute_for_case(*case)\n        results.append(D)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_for_case(Nx, Ny, alpha, C0, u_func_type, param):\n    \"\"\"\n    Computes the dynamic Smagorinsky coefficient and the difference D for a single test case.\n    \"\"\"\n    # Grid setup\n    L_domain = 2.0 * np.pi\n    dx = L_domain / Nx\n    dy = L_domain / Ny\n    Delta = dx  # Grid scale Delta, assuming dx=dy\n\n    x = np.linspace(0, L_domain, num=Nx, endpoint=False)\n    y = np.linspace(0, L_domain, num=Ny, endpoint=False)\n    xx, yy = np.meshgrid(x, y)\n\n    # Velocity field generation\n    if u_func_type == 'taylor_green':\n        k = param\n        u1 = np.sin(k * xx) * np.cos(k * yy)\n        u2 = -np.cos(k * xx) * np.sin(k * yy)\n    elif u_func_type == 'constant':\n        U0 = param\n        u1 = U0 * np.ones_like(xx)\n        u2 = np.zeros_like(yy)\n    elif u_func_type == 'shear':\n        a = param\n        u1 = a * yy\n        u2 = np.zeros_like(yy)\n    else:\n        raise ValueError(\"Unknown velocity function type\")\n\n    # Derivatives via central differences with periodic boundaries (np.roll)\n    inv_2dx = 1.0 / (2.0 * dx)\n    inv_2dy = 1.0 / (2.0 * dy)\n    \n    du1_dx1 = (np.roll(u1, -1, axis=1) - np.roll(u1, 1, axis=1)) * inv_2dx\n    du1_dx2 = (np.roll(u1, -1, axis=0) - np.roll(u1, 1, axis=0)) * inv_2dy\n    du2_dx1 = (np.roll(u2, -1, axis=1) - np.roll(u2, 1, axis=1)) * inv_2dx\n    du2_dx2 = (np.roll(u2, -1, axis=0) - np.roll(u2, 1, axis=0)) * inv_2dy\n\n    # Strain-rate tensor S_ij\n    S11 = du1_dx1\n    S22 = du2_dx2\n    S12 = 0.5 * (du1_dx2 + du2_dx1)\n\n    # Strain-rate magnitude |S|\n    abs_S_sq = 2.0 * (S11**2 + S22**2 + 2.0 * S12**2)\n    abs_S = np.sqrt(abs_S_sq)\n\n    # Test filter (3x3 top-hat)\n    filter_kernel = np.ones((3, 3)) / 9.0\n    def apply_filter(field):\n        return ndimage.convolve(field, filter_kernel, mode='wrap')\n\n    # Test-filtered velocities\n    u1_f = apply_filter(u1)\n    u2_f = apply_filter(u2)\n    \n    # Leonard stress tensor L_ij\n    L11 = apply_filter(u1 * u1) - u1_f * u1_f\n    L12 = apply_filter(u1 * u2) - u1_f * u2_f\n    L22 = apply_filter(u2 * u2) - u2_f * u2_f\n    \n    # Deviatoric Leonard stress L_ij^dev\n    tr_L = L11 + L22\n    L11_dev = L11 - 0.5 * tr_L\n    L12_dev = L12\n    L22_dev = L22 - 0.5 * tr_L\n\n    # Model tensor M_ij = 2 * Delta^2 * (tilde(|S|S_ij) - alpha^2 * |tilde(S)|tilde(S_ij))\n    \n    # Beta term: beta_ij = |S|S_ij\n    beta11 = abs_S * S11\n    beta12 = abs_S * S12\n    beta22 = abs_S * S22\n    beta11_f = apply_filter(beta11)\n    beta12_f = apply_filter(beta12)\n    beta22_f = apply_filter(beta22)\n    \n    # Gamma term: gamma_ij = |tilde(S)|*tilde(S_ij)\n    S11_f = apply_filter(S11)\n    S12_f = apply_filter(S12)\n    S22_f = apply_filter(S22)\n    abs_S_f_sq = 2.0 * (S11_f**2 + S22_f**2 + 2.0 * S12_f**2)\n    abs_S_f = np.sqrt(abs_S_f_sq)\n    gamma11 = abs_S_f * S11_f\n    gamma12 = abs_S_f * S12_f\n    gamma22 = abs_S_f * S22_f\n\n    # Assemble M_ij\n    factor = 2.0 * (Delta**2)\n    M11 = factor * (beta11_f - alpha**2 * gamma11)\n    M12 = factor * (beta12_f - alpha**2 * gamma12)\n    M22 = factor * (beta22_f - alpha**2 * gamma22)\n\n    # Deviatoric model tensor M_ij^dev\n    tr_M = M11 + M22\n    M11_dev = M11 - 0.5 * tr_M\n    M12_dev = M12\n    M22_dev = M22 - 0.5 * tr_M\n    \n    # Calculate C_s^2 numerator and denominator for the least squares solution\n    numerator = L11_dev * M11_dev + L22_dev * M22_dev + 2 * L12_dev * M12_dev\n    denominator = M11_dev**2 + M22_dev**2 + 2 * M12_dev**2\n\n    # Calculate C_s^2 with a threshold for the denominator\n    epsilon = 1e-12\n    Cs_sq = np.zeros_like(denominator)\n    mask = denominator > epsilon\n    Cs_sq[mask] = numerator[mask] / denominator[mask]\n\n    # Clip for non-negativity\n    Cs_sq_clipped = np.maximum(0, Cs_sq)\n    \n    # Compute domain average and the final difference D\n    avg_Cs_sq_dyn = np.mean(Cs_sq_clipped)\n    D = avg_Cs_sq_dyn - C0**2\n\n    return D\n\n# Uncomment the following line to run the solution when the script is executed.\n# solve()\n```"
        }
    ]
}