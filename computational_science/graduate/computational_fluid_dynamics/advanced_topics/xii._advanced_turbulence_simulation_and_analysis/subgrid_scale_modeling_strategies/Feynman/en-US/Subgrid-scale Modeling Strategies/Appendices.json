{
    "hands_on_practices": [
        {
            "introduction": "A robust subgrid-scale model must be founded on physically and mathematically sound principles. A critical requirement is 'realizability,' which ensures the subgrid-scale stress tensor, $\\tau_{ij}$, does not predict unphysical states, such as negative turbulent kinetic energy. This exercise  challenges you to investigate the fundamental connection between the choice of spatial filter and the realizability of the resulting subgrid-scale stress tensor, providing crucial insight into the foundations of Large Eddy Simulation.",
            "id": "3367137",
            "problem": "Consider incompressible flow governed by the Navier–Stokes equations and a Large Eddy Simulation (LES) formulation in which resolved fields are obtained by applying a spatial filter operator to the velocity field. Let the filter be defined either as a convolution with a kernel or as a sharp spectral cutoff. The filtered velocity is denoted by $\\bar{u}_i(\\mathbf{x},t)$, and the Subgrid-Scale (SGS) stress is defined as\n$$\n\\tau_{ij}(\\mathbf{x},t) = \\overline{u_i u_j}(\\mathbf{x},t) - \\bar{u}_i(\\mathbf{x},t)\\,\\bar{u}_j(\\mathbf{x},t).\n$$\nThe SGS stress tensor $\\tau_{ij}$ is said to be realizable if it is symmetric and positive semidefinite, which is equivalent to requiring that for every vector $a_i$, the scalar quadratic form\n$$\na_i\\,\\tau_{ij}\\,a_j \\ge 0,\n$$\nand in particular its trace yields a nonnegative SGS kinetic energy $k_{\\mathrm{sgs}} = \\tfrac{1}{2}\\,\\tau_{ii} \\ge 0$ at every point. A convolution filter with kernel $G_\\Delta(\\mathbf{r})$ is called positivity preserving if $G_\\Delta(\\mathbf{r}) \\ge 0$ and $\\int G_\\Delta(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = 1$. Consider three common filters: (i) Gaussian filter with kernel $G_\\Delta(\\mathbf{r}) \\propto \\exp(-|\\mathbf{r}|^2/\\Delta^2)$, (ii) top-hat (box) filter with kernel $G_\\Delta(\\mathbf{r}) = \\Delta^{-d}$ inside a $d$-dimensional box of width $\\Delta$ and zero outside, and (iii) sharp spectral cutoff filter that retains Fourier modes with wavenumber $|\\mathbf{k}| \\le k_c$ and removes modes with $|\\mathbf{k}| > k_c$.\n\nUsing only the above definitions and fundamental properties of filters, select all statements that are correct:\n\nA. For any positivity-preserving convolution filter, the tensor $\\tau_{ij}$ is symmetric positive semidefinite pointwise, and $k_{\\mathrm{sgs}}(\\mathbf{x},t) \\ge 0$ for all $\\mathbf{x}$ and $t$. Gaussian and box filters satisfy these conditions.\n\nB. The sharp spectral cutoff filter is an $L^2$ orthogonal projector, therefore it preserves nonnegativity pointwise and guarantees $k_{\\mathrm{sgs}}(\\mathbf{x},t) \\ge 0$ at every point; hence $\\tau_{ij}$ is realizable pointwise.\n\nC. Under a sharp spectral cutoff, $k_{\\mathrm{sgs}}(\\mathbf{x},t)$ is nonnegative in a global (domain-integrated) sense because it represents the energy in filtered-out wavenumbers, but $k_{\\mathrm{sgs}}(\\mathbf{x},t)$ can be negative pointwise for certain fields. A one-dimensional example can be constructed to demonstrate this.\n\nD. If the filter kernel is not nonnegative (i.e., has negative lobes), then negative eigenvalues of $\\tau_{ij}$ are required to represent backscatter; such indefiniteness of $\\tau_{ij}$ is physically necessary for energy transfer from small to large scales.\n\nE. The box filter kernel exhibits a Gibbs-type oscillation in physical space and is therefore non-positive, which can induce negative SGS kinetic energy and violate realizability.\n\nChoose all that apply.",
            "solution": "We begin from the definitions of filtering and the Subgrid-Scale (SGS) stress. The filtered field obtained from a convolution filter is\n$$\n\\bar{u}_i(\\mathbf{x}) = \\int_{\\mathbb{R}^d} G_\\Delta(\\mathbf{r})\\,u_i(\\mathbf{x}-\\mathbf{r})\\,\\mathrm{d}\\mathbf{r},\n$$\nwith the kernel $G_\\Delta(\\mathbf{r})$ normalized by $\\int G_\\Delta(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = 1$. The SGS stress is defined as\n$$\n\\tau_{ij}(\\mathbf{x}) = \\overline{u_i u_j}(\\mathbf{x}) - \\bar{u}_i(\\mathbf{x})\\,\\bar{u}_j(\\mathbf{x}).\n$$\nRealizability requires $\\tau_{ij}$ symmetric and positive semidefinite, i.e., for all vectors $a_i$,\n$$\na_i\\,\\tau_{ij}\\,a_j = \\overline{\\big(a_k u_k\\big)^2} - \\big(\\overline{a_k u_k}\\big)^2 \\ge 0,\n$$\nand $k_{\\mathrm{sgs}} = \\tfrac{1}{2}\\tau_{ii}\\ge 0$ at every point.\n\nWe use two foundational facts:\n- If $G_\\Delta(\\mathbf{r}) \\ge 0$ and is normalized, then for any scalar field $\\phi(\\mathbf{x})$, Jensen’s inequality yields\n$$\n\\overline{\\phi^2}(\\mathbf{x}) = \\int G_\\Delta(\\mathbf{r})\\,\\phi^2(\\mathbf{x}-\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} \\ge \\left(\\int G_\\Delta(\\mathbf{r})\\,\\phi(\\mathbf{x}-\\mathbf{r})\\,\\mathrm{d}\\mathbf{r}\\right)^2 = \\bar{\\phi}^2(\\mathbf{x}),\n$$\npointwise.\n- The sharp spectral cutoff is an $L^2$ orthogonal projector in Fourier space that preserves energy in a global sense, but its physical-space kernel has oscillatory sidelobes with negative portions and is thus not positivity preserving pointwise.\n\nWe now analyze each option.\n\nOption A: For a positivity-preserving convolution filter, take any vector $a_i$ and define a scalar field $\\phi(\\mathbf{x}) = a_k u_k(\\mathbf{x})$. By Jensen’s inequality,\n$$\na_i\\,\\tau_{ij}\\,a_j = \\overline{\\phi^2} - \\bar{\\phi}^2 \\ge 0,\n$$\npointwise. Hence $\\tau_{ij}$ is positive semidefinite at every point, and $k_{\\mathrm{sgs}}(\\mathbf{x}) = \\tfrac{1}{2}\\tau_{ii}(\\mathbf{x}) \\ge 0$ follows by choosing $a$ along coordinate axes and by the properties of positive semidefinite matrices. The Gaussian kernel $G_\\Delta(\\mathbf{r}) \\propto \\exp(-|\\mathbf{r}|^2/\\Delta^2)$ is strictly nonnegative and normalized; the box (top-hat) kernel is nonnegative and normalized over its support. Therefore both are positivity preserving and ensure realizability pointwise. Verdict: Correct.\n\nOption B: The sharp spectral cutoff operator $\\mathcal{P}_{\\le k_c}$ is an $L^2$ orthogonal projector onto Fourier modes with $|\\mathbf{k}| \\le k_c$. While $\\mathcal{P}_{\\le k_c}$ preserves global energy norms and orthogonality in Fourier space, the corresponding physical-space kernel is the inverse Fourier transform of the indicator function $\\chi_{|\\mathbf{k}|\\le k_c}$, which is oscillatory and has negative lobes. Thus it is not positivity preserving pointwise. Consequently, the inequality $\\overline{\\phi^2} \\ge \\bar{\\phi}^2$ can be violated pointwise, and there is no guarantee that $k_{\\mathrm{sgs}}(\\mathbf{x}) \\ge 0$ everywhere. Verdict: Incorrect.\n\nOption C: The global SGS kinetic energy associated with a sharp spectral cutoff is\n$$\n\\int k_{\\mathrm{sgs}}(\\mathbf{x})\\,\\mathrm{d}\\mathbf{x} = \\frac{1}{2}\\int \\left(\\overline{u_i u_i} - \\bar{u}_i \\bar{u}_i\\right)\\,\\mathrm{d}\\mathbf{x},\n$$\nand, by Parseval’s theorem and orthogonality of low- and high-pass components, this integral equals the energy contained in the removed (high-wavenumber) modes and is therefore nonnegative. However, pointwise negativity can occur. We construct a one-dimensional example on a periodic domain with a cutoff at wavenumber $k_c$. Let\n$$\nu(x) = \\cos(k_c x) + \\varepsilon\\,\\cos(2 k_c x),\n$$\nwith $0\\varepsilon1$. The sharp cutoff keeps $|\\!k|\\le k_c$, so\n$$\n\\bar{u}(x) = \\cos(k_c x).\n$$\nCompute $u^2(x)$:\n$$\nu^2 = \\cos^2(k_c x) + 2\\varepsilon \\cos(k_c x)\\cos(2k_c x) + \\varepsilon^2 \\cos^2(2k_c x).\n$$\nUsing trigonometric identities, the Fourier content of $u^2$ includes modes at $0$, $k_c$, $2k_c$, $3k_c$, and $4k_c$. After applying the sharp cutoff, only the $0$ and $k_c$ components remain, yielding\n$$\n\\overline{u^2}(x) = \\frac{1}{2} + \\varepsilon \\cos(k_c x) + \\frac{\\varepsilon^2}{2}.\n$$\nThus,\n$$\n\\tau_{11}(x) = \\overline{u^2}(x) - \\bar{u}^2(x) = \\left(\\frac{1}{2} + \\varepsilon \\cos(k_c x) + \\frac{\\varepsilon^2}{2}\\right) - \\cos^2(k_c x).\n$$\nSince $\\cos^2(k_c x) = \\tfrac{1}{2}\\big(1+\\cos(2k_c x)\\big)$, we obtain\n$$\n\\tau_{11}(x) = \\varepsilon \\cos(k_c x) + \\frac{\\varepsilon^2}{2} - \\frac{1}{2}\\cos(2k_c x).\n$$\nAt a point where $\\cos(k_c x)=-1$ and $\\cos(2k_c x)=1$ (e.g., $k_c x = \\pi$), this reduces to\n$$\n\\tau_{11} = -\\varepsilon + \\frac{\\varepsilon^2-1}{2}  0\\quad \\text{for}\\quad 0\\varepsilon1,\n$$\ndemonstrating negative pointwise SGS kinetic energy $k_{\\mathrm{sgs}}=\\tfrac{1}{2}\\tau_{11}$ and violation of realizability locally, despite the global integral being nonnegative. Verdict: Correct.\n\nOption D: Backscatter refers to local negative energy flux from subgrid to resolved scales, characterized by the sign of the transfer term $\\Pi = -\\tau_{ij} S_{ij}$, where $S_{ij}$ is the resolved rate-of-strain tensor $S_{ij} = \\tfrac{1}{2}\\left(\\partial \\bar{u}_i/\\partial x_j + \\partial \\bar{u}_j/\\partial x_i\\right)$. Backscatter does not require $\\tau_{ij}$ to be indefinite, nor does it require negative eigenvalues of $\\tau_{ij}$. In fact, many realizable models maintain $k_{\\mathrm{sgs}}\\ge 0$ and keep $\\tau_{ij}$ positive semidefinite, yet can produce local backscatter via the alignment of $\\tau_{ij}$ with $S_{ij}$ or through dynamic adjustment of model coefficients. Indefiniteness of $\\tau_{ij}$ leading to $k_{\\mathrm{sgs}}0$ is unphysical because it violates realizability; it is not a prerequisite for backscatter. Verdict: Incorrect.\n\nOption E: The box (top-hat) filter kernel in physical space is exactly nonnegative and piecewise constant over its support, with no oscillatory sidelobes; Gibbs-type oscillations are associated with spectral truncation, not with physical-space box convolution. Therefore, the box kernel is positivity preserving and does not inherently induce negative SGS kinetic energy or violate realizability. Verdict: Incorrect.\n\nHence, the correct options are A and C.",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "Beyond theoretical correctness, the practical utility of an SGS model is deeply intertwined with the numerical scheme used for the simulation. The presence of an explicit eddy viscosity term, for example, introduces a diffusive mechanism that can severely restrict the stable time step and impact computational cost. This practice  provides a hands-on analysis of this interplay, requiring you to derive and compare the stability constraints for an explicit LES model versus an implicit approach that relies on numerical dissipation.",
            "id": "3367156",
            "problem": "Consider a one-dimensional, incompressible, large-eddy simulation (LES) of a homogeneous shear flow, linearized about a uniform mean advection. The resolved velocity fluctuation $u(x,t)$ satisfies the linear convection–diffusion model\n$$\n\\frac{\\partial u}{\\partial t} + U \\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x}\\left[\\left(\\nu + \\nu_{t}\\right)\\frac{\\partial u}{\\partial x}\\right],\n$$\non a uniform grid with spacing $\\Delta$. The molecular kinematic viscosity is $\\nu$, the mean advection speed is $U$, and the subgrid-scale eddy viscosity is modeled by the Smagorinsky form $\\nu_{t} = C_{s}^{2}\\,\\Delta^{2}\\,|S|$, where $C_{s}$ is the Smagorinsky coefficient and $|S|$ is a prescribed constant magnitude of the resolved strain rate tensor. The spatial discretization uses second-order central differences for the diffusive operator, and a monotone first-order upwind flux for the convective operator (assume $U0$ so that upwind is taken from the left). Time advancement uses the classical third-order Strong Stability Preserving Runge–Kutta (SSP–RK$3$) method.\n\nTwo subgrid-scale strategies are considered:\n\n- Strategy A (explicit LES): use the explicit Smagorinsky eddy viscosity with $\\nu_{t} = C_{s}^{2}\\,\\Delta^{2}\\,|S|$.\n- Strategy B (implicit numerical damping, also called implicit LES): set $\\nu_{t}=0$ but rely on the numerical dissipation of the upwind flux, which for linear advection is equivalent, at leading order in wavenumber, to an effective viscosity $\\nu_{\\text{num}} = \\kappa\\,U\\,\\Delta$ with a given scheme-dependent constant $\\kappa0$.\n\nStarting from the linear convection–diffusion equation, the von Neumann Fourier symbol of the second-order discrete Laplacian, and the monotonicity condition for forward Euler time stepping of linear advection with first-order upwind flux, derive the forward Euler stability constraints for explicit integration of the semi-discrete system. Then, using the defining property of Strong Stability Preserving Runge–Kutta methods, deduce the maximum stable time step under SSP–RK$3$ for each strategy as the minimum of an advective bound and a diffusive bound. Express the diffusive bound in terms of the effective viscosity $\\nu_{\\text{eff}}$ (equal to $\\nu+\\nu_{t}$ in Strategy A and to $\\nu+\\nu_{\\text{num}}$ in Strategy B).\n\nUse the following parameter values:\n- $U = 2\\,\\text{m}\\,\\text{s}^{-1}$,\n- $\\nu = 1.0 \\times 10^{-5}\\,\\text{m}^{2}\\,\\text{s}^{-1}$,\n- $\\Delta = 1.0 \\times 10^{-3}\\,\\text{m}$,\n- $C_{s} = 0.17$,\n- $|S| = 5.0 \\times 10^{4}\\,\\text{s}^{-1}$,\n- $\\kappa = \\tfrac{1}{2}$.\n\nDefine the maximum stable time steps $\\Delta t_{\\text{A}}$ and $\\Delta t_{\\text{B}}$ for Strategies A and B, respectively, as the minima of their advective and diffusive bounds. Compute the ratio\n$$\nR \\equiv \\frac{\\Delta t_{\\text{B}}}{\\Delta t_{\\text{A}}},\n$$\nand report the value of $R$ rounded to three significant figures. Because $R$ is dimensionless, do not include any units in your final numerical answer.",
            "solution": "The problem requires the derivation of stability constraints for a one-dimensional linear convection-diffusion equation, discretized using specific numerical methods, under two different subgrid-scale modeling strategies. The final goal is to compute the ratio of the maximum stable time steps for these two strategies.\n\nThe governing equation for the resolved velocity fluctuation $u(x,t)$ is\n$$\n\\frac{\\partial u}{\\partial t} + U \\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x}\\left[\\nu_{\\text{eff}}\\frac{\\partial u}{\\partial x}\\right]\n$$\nwhere $\\nu_{\\text{eff}}$ is the effective kinematic viscosity.\n\nThe spatial domain is discretized on a uniform grid with spacing $\\Delta$. The spatial operators are discretized as follows:\n1.  The convective term $\\frac{\\partial u}{\\partial x}$ is approximated using a first-order upwind scheme. For a mean advection speed $U0$, the operator at grid node $j$ is $\\frac{u_j - u_{j-1}}{\\Delta}$.\n2.  The diffusive term $\\frac{\\partial^2 u}{\\partial x^2}$ is approximated using a second-order central difference scheme: $\\frac{u_{j+1} - 2u_j + u_{j-1}}{\\Delta^2}$.\n\nSubstituting these discretizations into the governing equation yields the semi-discrete ordinary differential equation (ODE) for the velocity at node $j$:\n$$\n\\frac{du_j}{dt} = -U \\frac{u_j - u_{j-1}}{\\Delta} + \\nu_{\\text{eff}} \\frac{u_{j+1} - 2u_j + u_{j-1}}{\\Delta^2}\n$$\nThis system of ODEs is to be integrated in time using the third-order Strong Stability Preserving Runge-Kutta (SSP-RK$3$) method.\n\nThe problem directs us to first derive the stability constraints for the simpler forward Euler time-stepping method, and then use this result to deduce the constraint for SSP-RK$3$. For a linear problem decomposed into advective and diffusive parts, the overall stability constraint is typically taken as the minimum of the constraints imposed by each part.\n\nFirst, let's derive the forward Euler stability constraints.\n\n**Advective Stability Constraint:**\nConsider the pure advection equation, $ \\frac{\\partial u}{\\partial t} + U \\frac{\\partial u}{\\partial x} = 0$. The semi-discrete form using first-order upwind is $\\frac{du_j}{dt} = -U \\frac{u_j - u_{j-1}}{\\Delta}$. Applying the forward Euler method with time step $\\Delta t$:\n$$\nu_j^{n+1} = u_j^n - \\frac{U \\Delta t}{\\Delta} (u_j^n - u_{j-1}^n) = \\left(1 - \\frac{U \\Delta t}{\\Delta}\\right)u_j^n + \\frac{U \\Delta t}{\\Delta} u_{j-1}^n\n$$\nThe problem specifies using the monotonicity condition for stability. For the scheme to be monotone (i.e., not create new extrema), the coefficients of $u^n$ terms on the right-hand side must be non-negative. This requires:\n$$\n1 - \\frac{U \\Delta t}{\\Delta} \\ge 0 \\implies \\frac{U \\Delta t}{\\Delta} \\le 1\n$$\nThis gives the advective Courant-Friedrichs-Lewy (CFL) condition:\n$$\n\\Delta t \\le \\frac{\\Delta}{U} \\equiv \\Delta t_{\\text{adv}}\n$$\n\n**Diffusive Stability Constraint:**\nConsider the pure diffusion equation, $\\frac{\\partial u}{\\partial t} = \\nu_{\\text{eff}} \\frac{\\partial^2 u}{\\partial x^2}$. The semi-discrete form using second-order central differences is $\\frac{du_j}{dt} = \\nu_{\\text{eff}} \\frac{u_{j+1} - 2u_j + u_{j-1}}{\\Delta^2}$. Applying the forward Euler method:\n$$\nu_j^{n+1} = u_j^n + \\frac{\\nu_{\\text{eff}} \\Delta t}{\\Delta^2} (u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\nWe use von Neumann stability analysis. For a Fourier mode $u_j^n = g^n \\exp(ik j \\Delta)$, the amplification factor $g(k) = \\frac{u_j^{n+1}}{u_j^n}$ is:\n$$\ng(k) = 1 + \\frac{\\nu_{\\text{eff}} \\Delta t}{\\Delta^2} (\\exp(ik\\Delta) - 2 + \\exp(-ik\\Delta)) = 1 + \\frac{2\\nu_{\\text{eff}} \\Delta t}{\\Delta^2} (\\cos(k\\Delta) - 1)\n$$\nUsing the identity $\\cos(k\\Delta) - 1 = -2\\sin^2(\\frac{k\\Delta}{2})$, we get:\n$$\ng(k) = 1 - \\frac{4\\nu_{\\text{eff}} \\Delta t}{\\Delta^2} \\sin^2\\left(\\frac{k\\Delta}{2}\\right)\n$$\nFor stability, we require $|g(k)| \\le 1$ for all wavenumbers $k$. Since $g(k) \\le 1$, we only need to enforce $g(k) \\ge -1$. The minimum value of $g(k)$ occurs when $\\sin^2(\\frac{k\\Delta}{2}) = 1$ (i.e., for the highest frequency mode $k\\Delta = \\pi$).\n$$\ng_{\\text{min}} = 1 - \\frac{4\\nu_{\\text{eff}} \\Delta t}{\\Delta^2} \\ge -1 \\implies 2 \\ge \\frac{4\\nu_{\\text{eff}} \\Delta t}{\\Delta^2}\n$$\nThis gives the diffusive stability condition:\n$$\n\\Delta t \\le \\frac{2\\Delta^2}{4\\nu_{\\text{eff}}} = \\frac{\\Delta^2}{2\\nu_{\\text{eff}}} \\equiv \\Delta t_{\\text{diff}}\n$$\n\n**SSP-RK3 Stability Constraint:**\nThe problem states to use the defining property of SSP methods. A key property of SSP methods is that they preserve the stability properties (like monotonicity or total variation diminishing) of the forward Euler method under the same CFL constraint, potentially scaled by an SSP coefficient $C_{SSP}$. For the classical SSP-RK$3$ method, this coefficient is $C_{SSP}=1$. This implies that the stability constraints derived for the forward Euler method are sufficient for the SSP-RK$3$ method. Therefore, we take the maximum stable time step for the full convection-diffusion problem as the minimum of the advective and diffusive bounds:\n$$\n\\Delta t_{\\text{stable}} \\le \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff}}) = \\min\\left(\\frac{\\Delta}{U}, \\frac{\\Delta^2}{2\\nu_{\\text{eff}}}\\right)\n$$\n\nNow we apply this framework to the two strategies, using the given parameter values:\n- $U = 2\\,\\text{m}\\,\\text{s}^{-1}$\n- $\\nu = 1.0 \\times 10^{-5}\\,\\text{m}^{2}\\,\\text{s}^{-1}$\n- $\\Delta = 1.0 \\times 10^{-3}\\,\\text{m}$\n- $C_{s} = 0.17$\n- $|S| = 5.0 \\times 10^{4}\\,\\text{s}^{-1}$\n- $\\kappa = \\frac{1}{2}$\n\nThe advective time step limit is the same for both strategies, as it only depends on $U$ and $\\Delta$:\n$$\n\\Delta t_{\\text{adv}} = \\frac{\\Delta}{U} = \\frac{1.0 \\times 10^{-3}\\,\\text{m}}{2\\,\\text{m}\\,\\text{s}^{-1}} = 5.0 \\times 10^{-4}\\,\\text{s}\n$$\n\n**Strategy A: Explicit LES**\nThe effective viscosity $\\nu_{\\text{eff, A}}$ is the sum of molecular and subgrid-scale eddy viscosities:\n$$\n\\nu_{\\text{eff, A}} = \\nu + \\nu_t = \\nu + C_{s}^{2}\\,\\Delta^{2}\\,|S|\n$$\nSubstituting the values:\n$$\n\\nu_t = (0.17)^2 \\times (1.0 \\times 10^{-3}\\,\\text{m})^2 \\times (5.0 \\times 10^{4}\\,\\text{s}^{-1}) = 0.0289 \\times 10^{-6}\\,\\text{m}^2 \\times 5.0 \\times 10^{4}\\,\\text{s}^{-1} = 1.445 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}\n$$\n$$\n\\nu_{\\text{eff, A}} = 1.0 \\times 10^{-5}\\,\\text{m}^2\\,\\text{s}^{-1} + 1.445 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1} = (0.01 + 1.445) \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1} = 1.455 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}\n$$\nThe diffusive time step limit for Strategy A is:\n$$\n\\Delta t_{\\text{diff, A}} = \\frac{\\Delta^2}{2\\nu_{\\text{eff, A}}} = \\frac{(1.0 \\times 10^{-3}\\,\\text{m})^2}{2 \\times 1.455 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}} = \\frac{1.0 \\times 10^{-6}\\,\\text{m}^2}{2.91 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}} \\approx 3.4364 \\times 10^{-4}\\,\\text{s}\n$$\nThe maximum stable time step for Strategy A is the minimum of the two bounds:\n$$\n\\Delta t_{\\text{A}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff, A}}) = \\min(5.0 \\times 10^{-4}\\,\\text{s}, 3.4364 \\times 10^{-4}\\,\\text{s}) = 3.4364 \\times 10^{-4}\\,\\text{s}\n$$\n\n**Strategy B: Implicit LES (ILES)**\nIn this strategy, $\\nu_t=0$ and the effective viscosity $\\nu_{\\text{eff, B}}$ is the sum of molecular and numerical viscosities:\n$$\n\\nu_{\\text{eff, B}} = \\nu + \\nu_{\\text{num}} = \\nu + \\kappa\\,U\\,\\Delta\n$$\nSubstituting the values:\n$$\n\\nu_{\\text{num}} = \\frac{1}{2} \\times (2\\,\\text{m}\\,\\text{s}^{-1}) \\times (1.0 \\times 10^{-3}\\,\\text{m}) = 1.0 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}\n$$\n$$\n\\nu_{\\text{eff, B}} = 1.0 \\times 10^{-5}\\,\\text{m}^2\\,\\text{s}^{-1} + 1.0 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1} = (0.01 + 1.0) \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1} = 1.01 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}\n$$\nThe diffusive time step limit for Strategy B is:\n$$\n\\Delta t_{\\text{diff, B}} = \\frac{\\Delta^2}{2\\nu_{\\text{eff, B}}} = \\frac{(1.0 \\times 10^{-3}\\,\\text{m})^2}{2 \\times 1.01 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}} = \\frac{1.0 \\times 10^{-6}\\,\\text{m}^2}{2.02 \\times 10^{-3}\\,\\text{m}^2\\,\\text{s}^{-1}} \\approx 4.9505 \\times 10^{-4}\\,\\text{s}\n$$\nThe maximum stable time step for Strategy B is the minimum of the two bounds:\n$$\n\\Delta t_{\\text{B}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff, B}}) = \\min(5.0 \\times 10^{-4}\\,\\text{s}, 4.9505 \\times 10^{-4}\\,\\text{s}) = 4.9505 \\times 10^{-4}\\,\\text{s}\n$$\n\n**Ratio of Time Steps**\nFinally, we compute the ratio $R \\equiv \\frac{\\Delta t_{\\text{B}}}{\\Delta t_{\\text{A}}}$:\n$$\nR = \\frac{4.9505 \\times 10^{-4}\\,\\text{s}}{3.4364 \\times 10^{-4}\\,\\text{s}} \\approx 1.44058\n$$\nRounding to three significant figures, the result is $1.44$.\n\nIn this problem, the explicit Smagorinsky model (Strategy A) introduces a larger effective viscosity than the numerical dissipation from the upwind scheme (Strategy B), with $\\nu_{\\text{eff, A}}  \\nu_{\\text{eff, B}}$. The diffusive time step constraint is more restrictive for larger viscosities ($\\Delta t_{\\text{diff}} \\propto 1/\\nu_{\\text{eff}}$). For both strategies, the diffusive limit was more restrictive than the advective one. Consequently, Strategy A, having the larger viscosity, is subject to a more stringent time step constraint, resulting in a ratio $R  1$.",
            "answer": "$$\n\\boxed{1.44}\n$$"
        },
        {
            "introduction": "Static, predefined coefficients in SGS models often lack universality, motivating the development of adaptive strategies. The dynamic procedure, based on the Germano identity, offers a powerful framework for determining model coefficients 'on the fly' from the resolved flow field. In this advanced practice , you will derive and implement a dynamic model for the turbulent Prandtl number, $Pr_t$, in scalar transport, bridging the gap from first-principles derivation to a working computational routine.",
            "id": "3367196",
            "problem": "Consider incompressible Large-Eddy Simulation (LES) of scalar transport in heated turbulent channel flow. Start from the filtered scalar transport equation and the definition of Subgrid-Scale (SGS) scalar flux. Derive, from first principles, a dynamic model for the turbulent Prandtl number $Pr_t(\\mathbf{x},t)$ using a Germano-like identity for scalar flux that employs a test filter applied along homogeneous directions. Your derivation must begin from the filtered transport equations and modeling assumptions, and proceed to an implementable expression that determines the local reciprocal turbulent Prandtl number as a least-squares optimum. Then, implement the derived expression to compute a plane-averaged value of $Pr_t$ across the wall-normal direction in a synthetic heated turbulent channel, with scientifically plausible mean profiles and fluctuations.\n\nPhysical and mathematical context, definitions, and requirements:\n\n- Use the filtered scalar transport equation for an incompressible flow and define the Subgrid-Scale (SGS) scalar flux $ \\tau_{\\theta,i} = \\overline{u_i \\theta} - \\bar{u}_i \\bar{\\theta} $. Model the SGS scalar flux by a Fickian eddy diffusivity, $ \\tau_{\\theta,i}^{m} = - \\kappa_t \\, \\partial_i \\bar{\\theta} $, where $ \\kappa_t = \\nu_t / Pr_t $, $ \\nu_t $ is the eddy viscosity, and $ Pr_t $ is the turbulent Prandtl number to be determined dynamically.\n- Introduce a Germano-like identity for the scalar, leveraging a test filter denoted by a hat over filtered variables, applied along homogeneous directions. Define the resolved test-scale scalar flux and derive an identity linking resolved and modeled quantities at grid and test scales.\n- Obtain a least-squares expression for the local reciprocal turbulent Prandtl number $ \\alpha(\\mathbf{x},t) = 1/Pr_t(\\mathbf{x},t) $. The final expression must involve filtered correlations $ L_i $ and a model kernel $ M_i $ built from filtered combinations of $ \\nu_t $, $ \\bar{\\theta} $, and their gradients, using the test filter.\n- For implementation, consider a heated turbulent channel with half-height $ h $, friction Reynolds number $ Re_\\tau $, friction velocity scaled to $ u_\\tau = 1 $, and kinematic viscosity $ \\nu = u_\\tau h / Re_\\tau $. Construct mean profiles:\n  - Streamwise mean velocity $ U(y) $ approximated by a logarithmic law in wall units with the von Kármán constant $ \\kappa $ and additive constant $ B $,\n  - Mean scalar (temperature) $ \\Theta(y) $ with a constant gradient across the channel height $ 2h $.\n  Augment these profiles with homogeneous random fluctuations of specified amplitude to emulate turbulence; ensure reproducibility via a fixed random seed. Compute $ \\nu_t(y) $ using a van Driest-damped mixing-length formulation $ \\ell(y) = \\kappa y_w \\left(1 - \\exp(-y^+/A^+)\\right) $ based on the distance to the nearest wall $ y_w $ and wall units $ y^+ $, and approximate $ \\partial_y U $ from the log-law slope.\n- Apply the test filter as a periodic, uniform box filter along the streamwise and spanwise directions only; do not filter along the wall-normal direction. Use second-order accurate finite differences with periodic boundary conditions in the streamwise and spanwise directions and one-sided differences at the walls for the wall-normal derivative.\n- To compute $ Pr_t(y) $, perform plane-averaging in the homogeneous directions to evaluate the least-squares optimum for $ \\alpha(y) = 1/Pr_t(y) $ at each wall-normal location $ y $. Enforce physical realizability by:\n  - Using a fallback $ Pr_t^0 $ when the least-squares denominator is below a small threshold or when the computed $ \\alpha(y) $ is non-positive,\n  - Clipping $ Pr_t(y) $ into a prescribed physically plausible interval $ [Pr_{t,\\min}, Pr_{t,\\max}] $ before averaging across $ y $.\n- Express the final scalar results as dimensionless numbers.\n\nNumerical configuration:\n\n- Domain: $ x \\in [0, L_x] $, $ y \\in [0, 2h] $, $ z \\in [0, L_z] $ with $ h = 1 $, $ L_x = 2\\pi $, $ L_z = \\pi $.\n- Discretization: Uniform grids in all directions with $ N_x $, $ N_y $, $ N_z $ points; periodic in $ x $ and $ z $, no-slip at $ y=0 $ and $ y=2h $ approximated in mean velocity profile construction.\n- Test filter: periodic box filter of width $ m $ (odd integer) in $ x $ and $ z $ directions.\n\nYour program must implement the derived dynamic procedure and return the plane-averaged $ Pr_t $ for each of the following test cases. Use the fixed random seed $ 42 $ for all random fields.\n\nTest suite (each tuple is $(Re_\\tau, m, A_u, A_\\theta, Pr_t^0, Pr_{t,\\min}, Pr_{t,\\max}, N_x, N_y, N_z)$):\n\n1. $(180, 5, 0.10, 0.05, 0.70, 0.20, 2.00, 32, 33, 32)$, representative happy-path turbulence intensity and moderate test filter.\n2. $(180, 7, 0.05, 1\\times 10^{-4}, 0.90, 0.20, 2.00, 32, 33, 32)$, near-degenerate scalar fluctuations to trigger fallback behavior.\n3. $(180, 3, 0.20, 0.20, 0.70, 0.20, 2.00, 32, 33, 32)$, high fluctuation amplitudes and small test filter to exercise clipping.\n\nFinal output specification:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each value rounded to three decimal places and in the same order as the test suite, for example, \"[result1,result2,result3]\".\n- Each result must be a single dimensionless floating-point number equal to the wall-normal plane-averaged $ Pr_t $ for that test case.",
            "solution": "The derivation begins from the filtered conservation of a passive scalar (temperature) in incompressible flow under the Large-Eddy Simulation (LES) framework. Let $ \\bar{\\theta} $ be the filtered scalar and $ \\bar{u}_i $ be the filtered velocity. The filtered scalar transport equation can be written as\n$$\n\\frac{\\partial \\bar{\\theta}}{\\partial t} + \\frac{\\partial (\\bar{u}_i \\bar{\\theta})}{\\partial x_i} = \\frac{\\partial}{\\partial x_i} \\left( \\alpha \\frac{\\partial \\bar{\\theta}}{\\partial x_i} \\right) - \\frac{\\partial \\tau_{\\theta,i}}{\\partial x_i},\n$$\nwhere $ \\alpha $ is the molecular diffusivity and the Subgrid-Scale (SGS) scalar flux is\n$$\n\\tau_{\\theta,i} = \\overline{u_i \\theta} - \\bar{u}_i \\bar{\\theta}.\n$$\nA common modeling assumption is a Fickian form for the SGS flux,\n$$\n\\tau_{\\theta,i}^{m} = - \\kappa_t \\, \\partial_i \\bar{\\theta},\n$$\nwith $ \\kappa_t = \\nu_t / Pr_t $ where $ \\nu_t $ is the SGS eddy viscosity and $ Pr_t $ is the turbulent Prandtl number to be modeled.\n\nTo dynamically determine $ Pr_t $, we introduce a Germano-like identity for scalar flux at a larger test-filter scale (denoted by a hat, $ \\hat{\\cdot} $) applied to already filtered variables. Consider the resolved test-filtered correlation\n$$\nL_i \\equiv \\widehat{\\bar{u}_i \\bar{\\theta}} - \\hat{\\bar{u}}_i \\hat{\\bar{\\theta}}.\n$$\nThis quantity represents the difference between the filtered product and the product of filtered fields at the test scale; it is analogous to the Germano identity for momentum but formulated for a scalar correlation. One may also define the modeled SGS flux at the grid scale as $ \\tau_{\\theta,i}^{m} = - \\kappa_t \\, \\partial_i \\bar{\\theta} $ and at the test scale (using the same $ Pr_t $ to avoid double counting) as $ T_{\\theta,i}^{m} = - \\tilde{\\kappa}_t \\, \\partial_i \\hat{\\bar{\\theta}} $, where $ \\tilde{\\kappa}_t = \\hat{\\nu}_t / Pr_t $ under the same Fickian assumption. Applying the test filter to the modeled grid-scale flux gives $ \\widehat{\\tau_{\\theta,i}^{m}} = - \\widehat{ \\kappa_t \\, \\partial_i \\bar{\\theta} } $.\n\nThe Germano-like identity for the scalar flux at the test scale can then be written as a relation between resolved and modeled quantities:\n$$\nL_i \\approx T_{\\theta,i}^{m} - \\widehat{\\tau_{\\theta,i}^{m}}.\n$$\nSubstituting the models yields\n$$\nL_i \\approx - \\frac{\\hat{\\nu}_t}{Pr_t} \\, \\partial_i \\hat{\\bar{\\theta}} + \\frac{1}{Pr_t} \\, \\widehat{ \\nu_t \\, \\partial_i \\bar{\\theta} }.\n$$\nIntroduce the unknown local reciprocal turbulent Prandtl number $ \\alpha = 1/Pr_t $ and define the model kernel\n$$\nM_i \\equiv \\hat{\\nu}_t \\, \\partial_i \\hat{\\bar{\\theta}} - \\widehat{ \\nu_t \\, \\partial_i \\bar{\\theta} }.\n$$\nThen the identity becomes\n$$\nL_i \\approx - \\alpha \\, M_i.\n$$\n\nTo determine $ \\alpha $ robustly in the presence of numerical noise and variability in three directions $ i \\in \\{x,y,z\\} $, employ a least-squares minimization over the homogeneous directions (here, plane averaging over streamwise $ x $ and spanwise $ z $ at fixed wall-normal $ y $). Define the error functional\n$$\nE(\\alpha) = \\sum_{i} \\left\\langle \\left( L_i + \\alpha \\, M_i \\right)^2 \\right\\rangle_{x,z},\n$$\nwhere $ \\langle \\cdot \\rangle_{x,z} $ denotes a plane average at fixed $ y $. Minimizing $ E $ with respect to $ \\alpha $ yields the normal equation\n$$\n\\frac{dE}{d\\alpha} = 2 \\sum_{i} \\left\\langle \\left( L_i + \\alpha \\, M_i \\right) M_i \\right\\rangle_{x,z} = 0,\n$$\nwhich gives\n$$\n\\alpha(y) = - \\frac{ \\sum_{i} \\left\\langle L_i M_i \\right\\rangle_{x,z} }{ \\sum_{i} \\left\\langle M_i M_i \\right\\rangle_{x,z} }.\n$$\nThen $ Pr_t(y) = 1 / \\alpha(y) $.\n\nFor physical realizability and numerical stability, we adopt safeguards:\n- If the denominator $ \\sum_{i} \\langle M_i M_i \\rangle_{x,z} $ at a given $ y $ is below a small threshold (near-degenerate case) or if $ \\alpha(y) \\le 0 $, we assign a fallback value $ Pr_t^0 $,\n- Otherwise, we clip $ Pr_t(y) $ into $ [Pr_{t,\\min}, Pr_{t,\\max}] $.\n\nImplementation details for the heated turbulent channel:\n- Geometry: channel half-height $ h = 1 $, total height $ 2h $, periodic in $ x $ and $ z $ with lengths $ L_x = 2\\pi $, $ L_z = \\pi $.\n- Discretization: uniform grids with $ N_x $, $ N_y $, $ N_z $ points. Periodic boundary conditions in $ x $ and $ z $, and wall boundaries at $ y=0 $ and $ y=2h $.\n- Mean profiles: streamwise mean velocity $ U(y) $ approximated by a log-law in wall units with von Kármán constant $ \\kappa $ and additive constant $ B $. Let $ y_w = \\min(y, 2h - y) $ be the distance to the nearest wall, $ u_\\tau = 1 $, and $ \\nu = u_\\tau h / Re_\\tau $. Define wall coordinate $ y^+ = y_w u_\\tau / \\nu = y_w Re_\\tau / h $. Use $ U^+ = (1/\\kappa) \\ln( y^+ + \\varepsilon ) + B $ with a small $ \\varepsilon $ to avoid singularity, then $ U(y) = u_\\tau U^+ $. The wall-normal derivative $ \\partial_y U $ from the log-law slope is approximated by\n$$\n\\frac{\\partial U}{\\partial y} \\approx \\frac{u_\\tau^2}{\\kappa \\, \\nu \\, (y^+ + \\varepsilon)}.\n$$\n- Eddy viscosity via van Driest-damped mixing length:\n$$\n\\ell(y) = \\kappa \\, y_w \\left(1 - \\exp\\left(-\\frac{y^+}{A^+}\\right)\\right), \\quad \\nu_t(y) = \\ell(y)^2 \\, \\left| \\frac{\\partial U}{\\partial y} \\right|.\n$$\nHere $ A^+ $ is a damping constant.\n- Mean scalar: impose a constant mean temperature drop $ \\Delta \\Theta $ across the channel, $ \\Theta(y) = \\Theta_0 - \\Delta \\Theta \\, y/(2h) $.\n- Fluctuations: add homogeneous Gaussian fluctuations of amplitudes $ A_u $ for velocity components and $ A_\\theta $ for temperature, with fixed random seed for reproducibility.\n\nComputational steps:\n1. Generate $ U(y) $, $ \\Theta(y) $, and $ \\nu_t(y) $ profiles; assemble three-dimensional fields $ u(x,y,z) = U(y) + \\text{fluctuations} $, similarly for $ v, w $, and $ \\theta(x,y,z) = \\Theta(y) + \\text{fluctuations} $.\n2. Compute gradients $ \\partial_x \\bar{\\theta}, \\partial_y \\bar{\\theta}, \\partial_z \\bar{\\theta} $ with second-order central differences for interior points, periodic in $ x $ and $ z $, and one-sided at $ y $ boundaries.\n3. Apply the periodic box test filter of width $ m $ along $ x $ and $ z $ (no filtering in $ y $) to compute $ \\hat{\\bar{u}}_i $, $ \\hat{\\bar{\\theta}} $, $ \\widehat{\\bar{u}_i \\bar{\\theta}} $, $ \\hat{\\nu}_t $, and $ \\widehat{\\nu_t \\partial_i \\bar{\\theta}} $.\n4. Form $ L_i $ and $ M_i $ and compute $ \\alpha(y) $ by least squares for each $ y $ with plane averaging over $ x,z $.\n5. Apply fallback and clipping to get $ Pr_t(y) $, and compute the wall-normal average $ \\overline{Pr_t} $.\n\nValidation rationale:\n- The dynamically obtained $ Pr_t $ in turbulent channel flow, depending on Reynolds number and scalar boundary conditions, is typically of order one, often within $ [0.4, 1.0] $ for many engineering flows. The safeguards ensure physical realizability even in degenerate or noisy synthetic data. The test suite covers a representative case, a near-degenerate scalar fluctuation case that should revert to the fallback $ Pr_t^0 $, and a noisy case that exercises clipping.\n\nThe final program implements these steps for the provided test suite and prints the plane-averaged $ Pr_t $ for each test case as a single line list of three decimal-place rounded floating-point numbers.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef box_filter_xz(arr: np.ndarray, m: int) - np.ndarray:\n    \"\"\"\n    Periodic box (uniform) filter along x and z axes only.\n    No filtering along y. Separably applies moving average along x then z.\n    \"\"\"\n    w = m // 2\n    # First filter along x (axis=0)\n    tmp = np.zeros_like(arr)\n    for dx in range(-w, w + 1):\n        tmp += np.roll(arr, shift=dx, axis=0)\n    tmp /= m\n    # Then filter along z (axis=2)\n    out = np.zeros_like(arr)\n    for dz in range(-w, w + 1):\n        out += np.roll(tmp, shift=dz, axis=2)\n    out /= m\n    return out\n\ndef gradients_theta(theta: np.ndarray, Lx: float, Ly: float, Lz: float) - tuple:\n    \"\"\"\n    Compute gradients of theta: (dtheta/dx, dtheta/dy, dtheta/dz)\n    Periodic in x (axis 0) and z (axis 2); one-sided at y boundaries (axis 1).\n    \"\"\"\n    Nx, Ny, Nz = theta.shape\n    dx = Lx / Nx\n    dy = Ly / Ny\n    dz = Lz / Nz\n\n    # x-gradient: periodic central difference\n    dth_dx = (np.roll(theta, -1, axis=0) - np.roll(theta, 1, axis=0)) / (2.0 * dx)\n    # z-gradient: periodic central difference\n    dth_dz = (np.roll(theta, -1, axis=2) - np.roll(theta, 1, axis=2)) / (2.0 * dz)\n    # y-gradient: central interior, one-sided boundaries\n    dth_dy = np.zeros_like(theta)\n    dth_dy[:, 1:-1, :] = (theta[:, 2:, :] - theta[:, :-2, :]) / (2.0 * dy)\n    dth_dy[:, 0, :] = (theta[:, 1, :] - theta[:, 0, :]) / dy\n    dth_dy[:, -1, :] = (theta[:, -1, :] - theta[:, -2, :]) / dy\n\n    return dth_dx, dth_dy, dth_dz\n\ndef generate_channel_fields(Re_tau: float, Nx: int, Ny: int, Nz: int,\n                            Lx: float, Lz: float, h: float,\n                            Au: float, Ath: float,\n                            seed: int = 42, delta_theta: float = 1.0,\n                            kappa: float = 0.41, B_const: float = 5.2, Aplus: float = 26.0):\n    \"\"\"\n    Generate synthetic turbulent channel fields:\n    - Mean velocity via log-law,\n    - Mean temperature linear across channel height,\n    - Eddy viscosity via van Driest-damped mixing length,\n    - Add homogeneous Gaussian fluctuations.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    # Coordinates\n    x = np.linspace(0.0, Lx, Nx, endpoint=False)\n    y = np.linspace(0.0, 2.0 * h, Ny, endpoint=False)\n    z = np.linspace(0.0, Lz, Nz, endpoint=False)\n    # Distance to nearest wall\n    y_w = np.minimum(y, 2.0 * h - y)  # shape (Ny,)\n    # Wall units\n    u_tau = 1.0\n    nu = u_tau * h / Re_tau  # kinematic viscosity\n    eps = 1e-6\n    y_plus = y_w * u_tau / (nu + eps)  # avoid division by zero\n\n    # Mean velocity U(y) via log-law in wall units (synthetic)\n    U_plus = (1.0 / kappa) * np.log(y_plus + 1.0) + B_const  # add 1 to avoid singularity near wall\n    U_y = u_tau * U_plus  # dimensional mean velocity (nondimensionalized with u_tau=1)\n\n    # dU/dy approximated from log-law slope\n    dU_dy = (u_tau ** 2) / (kappa * (nu + eps) * (y_plus + 1.0))  # synthetic slope\n\n    # Van Driest-damped mixing length and eddy viscosity\n    l_mix = kappa * y_w * (1.0 - np.exp(-y_plus / Aplus))\n    nu_t_y = l_mix ** 2 * np.abs(dU_dy)  # shape (Ny,)\n\n    # Mean temperature profile: linear drop across channel height 2h\n    theta_mean_y = 1.0 - (y / (2.0 * h)) * delta_theta  # theta=1 at bottom wall, 0 at top wall\n\n    # Broadcast to 3D\n    U = U_y[None, :, None] * np.ones((Nx, 1, Nz))\n    nu_t = nu_t_y[None, :, None] * np.ones((Nx, 1, Nz))\n    theta_mean = theta_mean_y[None, :, None] * np.ones((Nx, 1, Nz))\n\n    # Fluctuations\n    u_fluc = Au * rng.normal(size=(Nx, Ny, Nz))\n    v_fluc = Au * rng.normal(size=(Nx, Ny, Nz))\n    w_fluc = Au * rng.normal(size=(Nx, Ny, Nz))\n    theta_fluc = Ath * rng.normal(size=(Nx, Ny, Nz))\n\n    # Fields\n    u = U + u_fluc\n    v = v_fluc\n    w = w_fluc\n    theta = theta_mean + theta_fluc\n\n    return u, v, w, theta, nu_t, nu\n\ndef compute_dynamic_prt(u: np.ndarray, v: np.ndarray, w: np.ndarray,\n                        theta: np.ndarray, nu_t: np.ndarray,\n                        Lx: float, Ly: float, Lz: float,\n                        m: int, prt0: float,\n                        prt_min: float, prt_max: float) - float:\n    \"\"\"\n    Compute plane-averaged dynamic turbulent Prandtl number using Germano-like identity.\n    \"\"\"\n    Nx, Ny, Nz = theta.shape\n    # Test-filtered fields (x,z only)\n    u_hat = box_filter_xz(u, m)\n    v_hat = box_filter_xz(v, m)\n    w_hat = box_filter_xz(w, m)\n    theta_hat = box_filter_xz(theta, m)\n    # Filtered products\n    utheta_hat = box_filter_xz(u * theta, m)\n    vtheta_hat = box_filter_xz(v * theta, m)\n    wtheta_hat = box_filter_xz(w * theta, m)\n    # L_i terms\n    Lx_term = utheta_hat - u_hat * theta_hat\n    Ly_term = vtheta_hat - v_hat * theta_hat\n    Lz_term = wtheta_hat - w_hat * theta_hat\n    # Gradients of theta and theta_hat\n    dth_dx, dth_dy, dth_dz = gradients_theta(theta, Lx, Ly, Lz)\n    dthhat_dx, dthhat_dy, dthhat_dz = gradients_theta(theta_hat, Lx, Ly, Lz)\n    # Tilde nu_t\n    nu_t_hat = box_filter_xz(nu_t, m)\n    # Hat of nu_t * gradients\n    P_x = nu_t * dth_dx\n    P_y = nu_t * dth_dy\n    P_z = nu_t * dth_dz\n    Px_hat = box_filter_xz(P_x, m)\n    Py_hat = box_filter_xz(P_y, m)\n    Pz_hat = box_filter_xz(P_z, m)\n    # M_i terms\n    Mx_term = nu_t_hat * dthhat_dx - Px_hat\n    My_term = nu_t_hat * dthhat_dy - Py_hat\n    Mz_term = nu_t_hat * dthhat_dz - Pz_hat\n\n    # Least-squares for alpha(y) with plane averaging over x,z\n    alpha0 = 1.0 / prt0\n    alpha_min = 1.0 / prt_max  # reciprocal bounds\n    alpha_max = 1.0 / prt_min\n    eps_den = 1e-12\n\n    prt_y = np.zeros(Ny)\n    # Precompute plane averages at each y\n    for j in range(Ny):\n        # Plane averages over x,z\n        Lxj = Lx_term[:, j, :]\n        Lyj = Ly_term[:, j, :]\n        Lzj = Lz_term[:, j, :]\n        Mxj = Mx_term[:, j, :]\n        Myj = My_term[:, j, :]\n        Mzj = Mz_term[:, j, :]\n\n        num = (\n            np.mean(Lxj * Mxj) +\n            np.mean(Lyj * Myj) +\n            np.mean(Lzj * Mzj)\n        )\n        den = (\n            np.mean(Mxj * Mxj) +\n            np.mean(Myj * Myj) +\n            np.mean(Mzj * Mzj)\n        )\n\n        # alpha(y)\n        if den  eps_den:\n            alpha = alpha0\n        else:\n            alpha = - num / den\n            if alpha = 0.0:\n                alpha = alpha0\n            else:\n                # clip reciprocal turbulent Prandtl number\n                alpha = min(max(alpha, alpha_min), alpha_max)\n        prt_y[j] = 1.0 / alpha\n\n    # Plane-averaged Pr_t across y\n    prt_mean = float(np.mean(prt_y))\n    return prt_mean\n\ndef run_test_case(case):\n    \"\"\"\n    case: (Re_tau, m, A_u, A_theta, Pr_t0, Pr_t_min, Pr_t_max, Nx, Ny, Nz)\n    \"\"\"\n    Re_tau, m, Au, Ath, prt0, prt_min, prt_max, Nx, Ny, Nz = case\n    h = 1.0\n    Lx = 2.0 * np.pi\n    Lz = 1.0 * np.pi\n    Ly = 2.0 * h\n\n    # Generate fields\n    u, v, w, theta, nu_t, nu = generate_channel_fields(\n        Re_tau=Re_tau, Nx=Nx, Ny=Ny, Nz=Nz, Lx=Lx, Lz=Lz, h=h,\n        Au=Au, Ath=Ath, seed=42\n    )\n\n    # Compute dynamic Pr_t\n    prt_mean = compute_dynamic_prt(\n        u=u, v=v, w=w, theta=theta, nu_t=nu_t,\n        Lx=Lx, Ly=Ly, Lz=Lz,\n        m=m, prt0=prt0, prt_min=prt_min, prt_max=prt_max\n    )\n    return prt_mean\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (180, 5, 0.10, 0.05, 0.70, 0.20, 2.00, 32, 33, 32),\n        (180, 7, 0.05, 1e-4, 0.90, 0.20, 2.00, 32, 33, 32),\n        (180, 3, 0.20, 0.20, 0.70, 0.20, 2.00, 32, 33, 32),\n    ]\n\n    results = []\n    for case in test_cases:\n        prt_mean = run_test_case(case)\n        # Round to three decimal places as specified\n        results.append(f\"{prt_mean:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}