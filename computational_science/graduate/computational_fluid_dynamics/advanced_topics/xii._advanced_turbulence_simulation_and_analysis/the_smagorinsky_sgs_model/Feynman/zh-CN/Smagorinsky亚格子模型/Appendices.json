{
    "hands_on_practices": [
        {
            "introduction": "理论知识需要通过动手实践来巩固。本节的第一个练习将从一个理想化的简单剪切流场景出发，要求你手动计算亚格子尺度（SGS）粘性。这个基础练习旨在帮助你建立对Smagorinsky模型核心公式的直观理解，清晰地展示解析应变率张量 $\\bar{S}_{ij}$ 如何直接决定涡粘性 $\\nu_{sgs}$ 的大小。通过这个计算，你将掌握该模型的基本应用方法。",
            "id": "1770682",
            "problem": "在计算流体动力学领域，大涡模拟（LES）是一种湍流模拟技术，它将直接解析的大尺度湍流涡与被模型化的小尺度涡分离开来。这些未解析的小尺度对解析流场的影响通过一个亚格子尺度（SGS）应力张量来体现。模拟该张量的一个常用方法是 Boussinesq 假设，该假设通过一个 SGS 涡粘性 $\\nu_{sgs}$ 将 SGS 应力与解析应变率张量联系起来。\n\n这种涡粘性的一个基础模型是 Smagorinsky 模型，由以下表达式给出：\n$$\n\\nu_{sgs} = (C_s \\Delta)^2 \\sqrt{2 \\bar{S}_{ij} \\bar{S}_{ij}}\n$$\n其中 $C_s$ 是无量纲 Smagorinsky 常数，$\\Delta$ 是滤波宽度（计算网格的特征长度尺度），而 $\\bar{S}_{ij}$ 是解析应变率张量。对于速度分量为 $\\bar{u}_i$（在方向 $x_i = (x, y, z)$ 上）的不可压缩流，应变率张量定义为 $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_i}{\\partial x_j} + \\frac{\\partial \\bar{u}_j}{\\partial x_i}\\right)$。项 $\\bar{S}_{ij} \\bar{S}_{ij}$ 意味着对重复指标求和（爱因斯坦求和约定）。\n\n考虑笛卡尔坐标系中的一个简单的、稳态的二维剪切流，其速度场由 $\\vec{v} = (u,v,w)$ 给出，分量为 $u = S y$，$v=0$ 和 $w=0$。量 $S$ 是一个恒定的正剪切率。为了本分析的目的，假设 LES 中固有的滤波操作不改变此线性速度剖面，因此解析速度场与给定场相同（即 $\\bar{u}_i = u_i$）。\n\n基于此信息，推导在这种简单剪切流中亚格子尺度粘性 $\\nu_{sgs}$ 的表达式。您的最终答案应以剪切率 $S$、Smagorinsky 常数 $C_s$ 和滤波宽度 $\\Delta$ 来表示。",
            "solution": "我们使用 Smagorinsky 亚格子尺度粘性模型\n$$\n\\nu_{sgs} = (C_{s}\\Delta)^{2}\\sqrt{2\\,\\bar{S}_{ij}\\bar{S}_{ij}},\n$$\n其中，对于不可压缩流，解析应变率张量定义为\n$$\n\\bar{S}_{ij}=\\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}}+\\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right).\n$$\n给定的速度场为 $u_{1}=u=S\\,y$，$u_{2}=v=0$，$u_{3}=w=0$，其中 $x_{1}=x$，$x_{2}=y$，$x_{3}=z$，并且滤波操作不改变该场，因此 $\\bar{u}_{i}=u_{i}$。非零的速度梯度为\n$$\n\\frac{\\partial u_{1}}{\\partial x_{2}}=S,\\quad \\frac{\\partial u_{1}}{\\partial x_{1}}=\\frac{\\partial u_{1}}{\\partial x_{3}}=\\frac{\\partial u_{2}}{\\partial x_{j}}=\\frac{\\partial u_{3}}{\\partial x_{j}}=0.\n$$\n使用 $\\bar{S}_{ij}$ 的定义，唯一的非零分量是\n$$\n\\bar{S}_{12}=\\bar{S}_{21}=\\frac{1}{2}\\left(\\frac{\\partial u_{1}}{\\partial x_{2}}+\\frac{\\partial u_{2}}{\\partial x_{1}}\\right)=\\frac{S}{2},\n$$\n而所有对角及其他非对角分量都为零。那么缩并为\n$$\n\\bar{S}_{ij}\\bar{S}_{ij}=\\bar{S}_{12}^{2}+\\bar{S}_{21}^{2}=2\\left(\\frac{S}{2}\\right)^{2}=\\frac{S^{2}}{2}.\n$$\n因此，\n$$\n\\sqrt{2\\,\\bar{S}_{ij}\\bar{S}_{ij}}=\\sqrt{2\\cdot\\frac{S^{2}}{2}}=|S|.\n$$\n由于给定的剪切率 $S$ 被指定为正值，所以 $|S|=S$。代入 Smagorinsky 模型得到\n$$\n\\nu_{sgs}=(C_{s}\\Delta)^{2}S.\n$$",
            "answer": "$$\\boxed{(C_{s}\\Delta)^{2}S}$$"
        },
        {
            "introduction": "在掌握了基本计算之后，我们必须对模型进行批判性地审视。这个练习揭示了标准Smagorinsky模型的一个关键缺陷：它无法在层流或剪切流区域“关闭”，从而产生非物理性的伪耗散。通过分析这个层流剪切的案例，你将从第一性原理出发，理解为何动态Smagorinsky程序能够成功解决这一问题，因为它允许模型系数 $C_s$ 根据流场自身的尺度信息进行自适应调整。",
            "id": "3373067",
            "problem": "考虑一个不可压缩、层流简单剪切流的大涡模拟 (LES)，其滤波后的速度场由 $\\bar{\\mathbf{u}}(x,y,z) = (G y,\\, 0,\\, 0)$ 给出，其中 $G$ 是一个恒定的剪切率。该 LES 应用了宽度为 $\\Delta$ 的空间滤波器，并通过涡粘性闭合模型来模拟偏亚格子尺度 (SGS) 应力。\n\n从下述定义和定律出发，完成以下任务：\n1. 对于不可压缩流，使用滤波后应变率张量 $S_{ij}$ 的运动学定义，计算标量大小 $|\\bar{S}|$，仅用 $G$ 表示。其中，大小定义为 $|\\bar{S}| = \\left(2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij}\\right)^{1/2}$。\n2. 使用涡粘性闭合模型 $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$ 和 Smagorinsky 假设 $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$（其中模型系数 $C_{S}$ 为常数），从第一性原理出发进行论证，说明为何即使在网格细化（即 $\\Delta \\to 0$）的情况下，尽管流场是完全层流且被完全解析，该常系数 $C_{S}$ 闭合模型仍会预测非零的 SGS 耗散。然后，从作为 Smagorinsky 动态程序核心的 Germano 恒等式出发，解释为什么对于该流场，动态计算出的 $C_{S}^{2}$ 会消失（即为零）。\n\n仅使用以下基本要素作为你的出发点：\n- 不可压缩流的滤波连续性方程 $\\partial \\bar{u}_{i}/\\partial x_{i} = 0$。\n- 滤波后应变率的定义 $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)$。\n- 偏亚格子尺度闭合模型 $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$，其中 $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$。\n- 用于 LES 和测试滤波的 Germano 恒等式：$L_{ij} = \\widetilde{\\overline{u_{i}\\,u_{j}}} - \\tilde{\\bar{u}}_{i}\\,\\tilde{\\bar{u}}_{j}$，其中波浪号表示测试滤波，上划线表示网格滤波，$L_{ij}$ 是 Leonard 应力。\n\n将 $|\\bar{S}|$ 的值以仅含 $G$ 的单个代数表达式的形式报告。无需进行数值计算。如果在你的论证中引入任何物理单位，请使用标准的国际单位制 (SI) 明确说明，但最终报告的表达式必须是仅用 $G$ 写出的不带单位的形式。",
            "solution": "该问题要求对一个给定的不可压缩、层流简单剪切流，分两部分对 Smagorinsky 亚格子尺度 (SGS) 模型进行分析。首先，我们计算滤波后应变率张量的大小。其次，我们分析常系数和动态 Smagorinsky 模型在该流场中的行为。\n\n**第一部分：滤波后应变率大小 $|\\bar{S}|$ 的计算**\n\n问题给出了在笛卡尔坐标系 $(x_1, x_2, x_3) = (x, y, z)$ 中，滤波后的速度场 $\\bar{\\mathbf{u}}$ 的分量为：\n$$\n\\bar{u}_1 = G y = G x_2 \\\\\n\\bar{u}_2 = 0 \\\\\n\\bar{u}_3 = 0\n$$\n其中 $G$ 是恒定剪切率。\n\n滤波后的应变率张量 $\\bar{S}_{ij}$ 定义为：\n$$\n\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)\n$$\n我们计算该张量的分量。速度分量中唯一非零的偏导数是 $\\frac{\\partial \\bar{u}_1}{\\partial x_2} = G$。所有其他导数，如 $\\frac{\\partial \\bar{u}_1}{\\partial x_1}$、$\\frac{\\partial \\bar{u}_1}{\\partial x_3}$、$\\frac{\\partial \\bar{u}_2}{\\partial x_j}$ 和 $\\frac{\\partial \\bar{u}_3}{\\partial x_j}$，均为零。\n\n$\\bar{S}_{ij}$ 的对角分量为：\n$$\n\\bar{S}_{11} = \\frac{\\partial \\bar{u}_1}{\\partial x_1} = 0 \\\\\n\\bar{S}_{22} = \\frac{\\partial \\bar{u}_2}{\\partial x_2} = 0 \\\\\n\\bar{S}_{33} = \\frac{\\partial \\bar{u}_3}{\\partial x_3} = 0\n$$\n非对角分量为：\n$$\n\\bar{S}_{12} = \\bar{S}_{21} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_2} + \\frac{\\partial \\bar{u}_2}{\\partial x_1}\\right) = \\frac{1}{2}(G + 0) = \\frac{G}{2} \\\\\n\\bar{S}_{13} = \\bar{S}_{31} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_1}\\right) = \\frac{1}{2}(0 + 0) = 0 \\\\\n\\bar{S}_{23} = \\bar{S}_{32} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_2}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_2}\\right) = \\frac{1}{2}(0 + 0) = 0\n$$\n因此，滤波后的应变率张量的矩阵形式为：\n$$\n\\bar{S}_{ij} =\n\\begin{pmatrix}\n0  \\frac{G}{2}  0 \\\\\n\\frac{G}{2}  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\n滤波后应变率张量的大小定义为 $|\\bar{S}| = (2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij})^{1/2}$，其中隐含对重复指标求和。\n首先，我们计算乘积 $\\bar{S}_{ij}\\,\\bar{S}_{ij}$：\n$$\n\\bar{S}_{ij}\\,\\bar{S}_{ij} = \\sum_{i=1}^3 \\sum_{j=1}^3 (\\bar{S}_{ij})^2 = (\\bar{S}_{12})^2 + (\\bar{S}_{21})^2 = \\left(\\frac{G}{2}\\right)^2 + \\left(\\frac{G}{2}\\right)^2 = \\frac{G^2}{4} + \\frac{G^2}{4} = \\frac{G^2}{2}\n$$\n现在，我们将此结果代入 $|\\bar{S}|$ 的定义中：\n$$\n|\\bar{S}| = \\left(2 \\cdot \\frac{G^2}{2}\\right)^{1/2} = \\left(G^2\\right)^{1/2} = |G|\n$$\n由于问题要求表达式仅用 $G$ 表示，且剪切率是一个可正可负的标量，因此最准确的形式是 $|G|$。\n\n**第二部分：Smagorinsky 闭合模型的分析**\n\n**常系数 Smagorinsky 模型的失效：**\n标准 Smagorinsky 模型提出的涡粘性 $\\nu_t$ 由下式给出：\n$$\n\\nu_t = (C_S \\Delta)^2 |\\bar{S}|\n$$\n其中 $C_S$ 是一个常数，$\\Delta$ 是滤波宽度。偏亚格子应力则被建模为：\n$$\n\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij} = -2 \\nu_t \\bar{S}_{ij}\n$$\nSGS 动能耗散率为 $\\epsilon_{\\mathrm{SGS}} = -(\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij})\\bar{S}_{ij} = 2 \\nu_t \\bar{S}_{ij}\\bar{S}_{ij}$。\n对于给定的流场，我们得到 $|\\bar{S}| = |G|$。将其代入 $\\nu_t$ 的模型中：\n$$\n\\nu_t = (C_S \\Delta)^2 |G|\n$$\n由于在此公式中 $C_S$ 是一个非零常数，$\\Delta > 0$，且我们假设一个非平凡的剪切流（$G \\neq 0$），该模型预测了一个非零的涡粘性 $\\nu_t \\neq 0$。这反过来又导致了非零的偏亚格子应力和非零的 SGS 耗散率：\n$$\n\\epsilon_{\\mathrm{SGS}} = 2 \\left((C_S \\Delta)^2 |G|\\right) \\left(\\frac{G^2}{2}\\right) = (C_S \\Delta)^2 |G| G^2 = C_S^2 \\Delta^2 |G|^3\n$$\n其根本缺陷在于原始流场被指定为*层流*。在层流中，不存在湍流脉动，因此 SGS 应力张量必须为零。常系数 Smagorinsky 模型仅依赖于*已解析*应变率的大小 $|\\bar{S}|$。由于简单的剪切流具有非零的平均应变率，该模型错误地预测了亚格子尺度湍流的存在，并从已解析的流场中虚假地移除了能量。该模型无法区分具有平均剪切的湍流和简单的层流剪切流。即使在网格细化时（$\\Delta \\to 0$），对于任何有限的 $\\Delta$，该模型都会预测虚假的耗散，尽管这种耗散在极限情况下确实正确地趋于零。\n\n**动态 Smagorinsky 程序的成功：**\n动态程序通过基于在两个不同滤波尺度上（网格滤波器，宽度为 $\\Delta$，用 $\\bar{\\cdot}$ 表示；以及测试滤波器，宽度为 $\\hat{\\Delta} > \\Delta$，用 $\\tilde{\\cdot}$ 表示）可用的流场信息来计算 $C_S$，从而纠正了这个缺陷。该程序源于 Germano 恒等式，该恒等式关联了这两个尺度上的应力：\n$$\nL_{ij} = T_{ij} - \\widetilde{\\tau_{ij}}\n$$\n其中 $L_{ij} = \\widetilde{\\bar{u}_i \\bar{u}_j} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ 是 Leonard 应力（可从已解析场 $\\bar{u}_i$ 计算），$T_{ij} = \\widetilde{\\overline{u_i u_j}} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ 是亚测试尺度应力，而 $\\tau_{ij} = \\overline{u_i u_j} - \\bar{u}_i \\bar{u}_j$ 是亚格子尺度应力。\n\n通过使用 Smagorinsky 闭合模型对 $\\tau_{ij}$ 和 $T_{ij}$ 的偏量部分进行建模，并假设 $C_S$ 在两个滤波尺度之间是常数，可以得到关系式 $L_{ij}^{\\text{dev}} = C_S^2 M_{ij}$，其中 $L_{ij}^{\\text{dev}}$ 是 Leonard 应力张量的偏量部分，$M_{ij}$ 是一个同样可以从滤波后的速度场计算出的张量：\n$$\nM_{ij} = 2\\Delta^2 \\widetilde{|\\bar{S}|\\bar{S}_{ij}} - 2\\hat{\\Delta}^2 |\\tilde{\\bar{S}}|\\tilde{\\bar{S}}_{ij}\n$$\n$C_S^2$ 随后通过最小化此关系中的误差来求得，通常通过最小二乘法：$C_S^2 = \\frac{L_{ij}^{\\text{dev}} M_{ij}}{M_{kl} M_{kl}}$。\n\n让我们为给定的流场 $\\bar{u}_1 = Gx_2$ 分析 $L_{ij}$ 和 $M_{ij}$。我们假设标准滤波器不会改变坐标的线性函数，所以 $\\tilde{\\bar{u}}_1 = \\widetilde{Gx_2} = Gx_2 = \\bar{u}_1$。然而，滤波确实会影响非线性项。\n乘积 $\\bar{u}_i \\bar{u}_j$ 中唯一非零的项是 $\\bar{u}_1\\bar{u}_1 = (Gx_2)^2$。对这个二次项应用测试滤波器会得到 $\\widetilde{(Gx_2)^2} = (Gx_2)^2 + C$，其中 C为某个常数，其值取决于滤波器的形状和宽度 $\\hat{\\Delta}$（例如，对于一维箱式滤波器，$C = G^2\\hat{\\Delta}^2/12$）。\nLeonard 应力分量为：\n$$\nL_{11} = \\widetilde{\\bar{u}_1 \\bar{u}_1} - \\tilde{\\bar{u}}_1 \\tilde{\\bar{u}}_1 = ((Gx_2)^2 + C) - (Gx_2)^2 = C\n$$\n所有其他分量 $L_{ij}$ 均为零，因为它们涉及像 $\\bar{u}_1\\bar{u}_2=0$ 这样的乘积。因此，$L_{ij}$ 是一个对角张量。因此，其偏量部分 $L_{ij}^{\\text{dev}} = L_{ij} - \\frac{1}{3}L_{kk}\\delta_{ij}$ 也是一个对角张量。\n\n现在，我们来分析 $M_{ij}$。由于 $\\tilde{\\bar{u}}_i = \\bar{u}_i$，应变率张量也相同：$\\tilde{\\bar{S}}_{ij} = \\bar{S}_{ij}$，它们的大小也相同：$|\\tilde{\\bar{S}}| = |\\bar{S}| = |G|$。项 $|\\bar{S}|\\bar{S}_{ij}$ 是一个常数张量场。对一个常数场进行滤波会得到常数本身，因此 $\\widetilde{|\\bar{S}|\\bar{S}_{ij}} = |\\bar{S}|\\bar{S}_{ij}$。\n将这些代入 $M_{ij}$ 的表达式中：\n$$\nM_{ij} = (2\\Delta^2 - 2\\hat{\\Delta}^2)|\\bar{S}|\\bar{S}_{ij}\n$$\n这表明 $M_{ij}$ 与 $\\bar{S}_{ij}$ 成正比。正如我们在第一部分中发现的，$\\bar{S}_{ij}$ 是一个纯粹的非对角张量。\n\n最后，我们从分子 $L_{ij}^{\\text{dev}} M_{ij}$ 计算 $C_S^2$。这是一个对角张量（$L_{ij}^{\\text{dev}}$）和一个纯非对角张量（$M_{ij}$）的缩并积（内积）。这样的乘积恒为零：\n$$\nL_{ij}^{\\text{dev}} M_{ij} = \\sum_{i,j} L_{ij}^{\\text{dev}} M_{ij} = 0\n$$\n分母 $M_{kl}M_{kl}$ 与 $\\bar{S}_{kl}\\bar{S}_{kl} = G^2/2$ 成正比，是非零的。\n因此，动态计算的系数为：\n$$\nC_S^2 = \\frac{0}{\\text{non-zero}} = 0\n$$\n动态程序正确地确定了对于这种层流，模型系数必须为零，这反过来意味着 $\\nu_t = 0$，并且虚假的 SGS 耗散被消除了。模型正确地“自行关闭”了。",
            "answer": "$$\n\\boxed{|G|}\n$$"
        },
        {
            "introduction": "现在，让我们从解析推导转向计算实践。在大涡模拟（LES）的实际应用中，“滤波”操作的概念可能存在模糊性：它既可以是一个对速度场进行的显式数学运算，也可以是数值离散格式本身带来的隐式效应。这个编程练习将让你亲手实现Smagorinsky模型，并量化比较这两种不同的滤波方式对亚格子应力计算结果的影响，从而深刻理解在真实CFD代码中进行LES建模时的重要考量。",
            "id": "3380543",
            "problem": "您需要编写一个完整、可运行的程序。对于给定的二维解析速度场，该程序需要比较两种方法预测的亚格子尺度 (SGS) 应力：一种是通过隐式滤波的二阶中心差分格式预测，另一种是在应用显式顶帽（箱式）滤波器后预测。两种方法都使用 Smagorinsky 亚格子尺度模型进行封闭。您的程序必须为每个测试用例计算一个标量，该标量用于量化两种 SGS 应力预测之间的差异，然后按照下文指定的格式，将所提供测试套件的所有标量输出到单行中。\n\n使用的基本原理和定义：\n- 从空间滤波的不可压缩 Navier–Stokes 方程和亚格子尺度应力张量的定义出发，其中偏斜部分由 Smagorinsky 涡粘性假设建模。通过引入一个与特征滤波宽度平方和解析应变率张量大小成正比的涡粘性，来封闭偏斜 SGS 应力。\n- 解析速度场是不可压缩且平滑的，所有计算都在一个均匀的周期性网格上进行。\n\n数学设置：\n- 考虑一个边长为 $L = 2\\pi$ 的方形周期性域和一个包含 $N \\times N$ 个点的均匀网格，网格间距为 $\\Delta x = \\Delta y = L/N$。三角函数中的所有角度均以弧度为单位。\n- 通过 $\\boldsymbol{u} = (u,v) = \\left(\\frac{\\partial \\psi}{\\partial y}, -\\frac{\\partial \\psi}{\\partial x}\\right)$ 定义标量流函数 $\\psi(x,y)$ 和不可压缩速度场。使用解析流函数\n$$\n\\psi(x,y) = \\sin(k_x x)\\sin(k_y y),\n$$\n其中 $k_x$ 和 $k_y$ 是指定波数的整数。\n- 使用带有周期性边界条件的二阶中心差分公式计算空间导数。对于任意网格函数 $f$，在 $x$ 方向上的离散导数为\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_{i,j} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta x},\n$$\n其中索引对 $N$ 取模；$y$ 方向同理。\n\n解析应变率张量：\n- 根据解析速度场，计算解析应变率张量 $S_{ij}$，\n$$\nS_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right),\n$$\n及其大小\n$$\n\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}},\n$$\n其中重复指标表示对空间维度 $i,j \\in \\{x,y\\}$ 求和。\n\nSmagorinsky 亚格子尺度封闭：\n- 偏斜 SGS 应力建模为\n$$\n\\tau^{\\mathrm{dev}}_{ij} = - 2 \\left(C_s \\Delta\\right)^2 \\lvert S \\rvert \\, S_{ij},\n$$\n其中 $C_s$ 是 Smagorinsky 常数，$\\Delta$ 是特征滤波宽度。为确保离散计算中的张量是无迹的，应用 $d=2$ 的偏斜投影\n$$\n\\widetilde{\\tau}_{ij} = \\tau_{ij} - \\frac{1}{d} \\tau_{kk} \\, \\delta_{ij}, \\quad d=2,\n$$\n其中 $\\delta_{ij}$ 是克罗内克 δ (Kronecker delta)。\n\n两种待比较的滤波路径：\n- 隐式滤波：使用网格上未经滤波的解析场和二阶中心差分导数来构建 $S_{ij}$，并将特征宽度设置为基于网格的尺度 $\\Delta_{\\mathrm{imp}} = \\sqrt{\\Delta x \\Delta y}$。\n- 显式滤波：首先对速度场的每个分量应用一个整数半径为 $r \\ge 0$ 的可分离、周期性二维顶帽（箱式）滤波器，即一个 $(2r+1)\\times(2r+1)$ 的均匀平均。然后根据显式滤波后的速度计算导数、$S_{ij}$ 和 SGS 应力。在此路径中，将特征宽度设置为在二维中一致缩放的显式滤波器宽度\n$$\n\\Delta_{\\mathrm{exp}} = (2r+1) \\, \\sqrt{\\Delta x \\Delta y}.\n$$\n\n差异度量：\n- 令 $\\tau^{\\mathrm{imp}}_{ij}$ 和 $\\tau^{\\mathrm{exp}}_{ij}$ 分别表示沿隐式和显式路径计算的偏斜 SGS 张量。使用网格上的归一化离散 Frobenius 范数来量化它们的差异，\n$$\nE = \\sqrt{\\frac{\\sum\\limits_{\\text{grid}} \\left[ \\left(\\Delta \\tau_{xx}\\right)^2 + \\left(\\Delta \\tau_{yy}\\right)^2 + 2 \\left(\\Delta \\tau_{xy}\\right)^2 \\right]}{\\sum\\limits_{\\text{grid}} \\left[ \\left(\\tau^{\\mathrm{imp}}_{xx}\\right)^2 + \\left(\\tau^{\\mathrm{imp}}_{yy}\\right)^2 + 2 \\left(\\tau^{\\mathrm{imp}}_{xy}\\right)^2 \\right]}},\n$$\n其中 $\\Delta \\tau_{ij} = \\tau^{\\mathrm{imp}}_{ij} - \\tau^{\\mathrm{exp}}_{ij}$。如果分母恰好为零，则定义 $E = 0$。\n\n所需的数值构建细节：\n- 通过将 $x \\in [0,L)$ 和 $y \\in [0,L)$ 离散化为 $x_i = i \\Delta x$，$y_j = j \\Delta y$（其中 $i,j \\in \\{0,1,\\dots,N-1\\}$）来构建解析场。\n- 将周期性中心差分和显式顶帽滤波器实现为每个方向上的可分离周期性 $(2r+1)$ 点移动平均。\n- 两条路径均使用相同的二阶导数公式。\n\n测试套件：\n对于每个元组 $(N, C_s, r, k_x, k_y)$，计算并记录上面定义的标量 $E$。\n- 测试 1：$(N, C_s, r, k_x, k_y) = (64, 0.17, 0, 4, 3)$。\n- 测试 2：$(N, C_s, r, k_x, k_y) = (64, 0.17, 1, 4, 3)$。\n- 测试 3：$(N, C_s, r, k_x, k_y) = (64, 0.17, 2, 8, 8)$。\n- 测试 4：$(N, C_s, r, k_x, k_y) = (16, 0.10, 1, 2, 1)$。\n- 测试 5：$(N, C_s, r, k_x, k_y) = (32, 0.23, 3, 1, 5)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含测试 1 到 5 的五个浮点值 $E$ 的结果，按顺序排列，以逗号分隔，并用方括号括起来，不含空格。例如，一个有效的输出应类似于 $[e_1,e_2,e_3,e_4,e_5]$。不允许有其他输出。",
            "solution": "该问题是有效的，因为它在科学上基于计算流体力学（特别是大涡模拟 (LES)）的原理，并且在数学上是适定和自洽的。所有必要的方程、参数和数值方法都得到了明确的定义。\n\n解决方案首先构建计算环境和给定的解析速度场。随后，它实现两种不同的滤波路径——隐式和显式——以计算亚格子尺度 (SGS) 应力张量。最后，它使用指定的误差度量来量化所得应力场之间的差异。\n\n**1. 网格和速度场生成**\n模拟在一个边长为 $L=2\\pi$ 的二维方形周期性域上进行。该域被离散化为一个 $N \\times N$ 个点的均匀网格。每个方向上的网格间距为 $\\Delta x = \\Delta y = L/N$。网格坐标由 $x_i = i \\Delta x$ 和 $y_j = j \\Delta y$ 给出，其中 $i, j \\in \\{0, 1, \\dots, N-1\\}$。\n\n不可压缩速度场 $\\boldsymbol{u} = (u,v)$ 由标量流函数 $\\psi(x,y)$ 导出。这种构造方式 $\\boldsymbol{u} = (\\partial_y \\psi, -\\partial_x \\psi)$ 解析地保证了速度场的散度为零，即 $\\nabla \\cdot \\boldsymbol{u} = 0$。指定的流函数为 $\\psi(x,y) = \\sin(k_x x)\\sin(k_y y)$，由此可得到速度分量：\n$$\nu(x,y) = \\frac{\\partial \\psi}{\\partial y} = k_y \\sin(k_x x)\\cos(k_y y)\n$$\n$$\nv(x,y) = -\\frac{\\partial \\psi}{\\partial x} = -k_x \\cos(k_x x)\\sin(k_y y)\n$$\n在网格点 $(x_i, y_j)$ 处对这些解析表达式求值，以生成离散的解析速度场，这构成了所有后续计算的起点。\n\n**2. 数值算子**\n需要两个核心数值算子：一个导数近似算子和一个空间滤波算子。\n\n- **周期性中心差分**：使用二阶精确的中心差分格式计算空间导数。对于一个通用网格函数 $f_{i,j}$，偏导数近似为：\n$$\n\\frac{\\partial f}{\\partial x} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta x} \\quad \\text{and} \\quad \\frac{\\partial f}{\\partial y} \\approx \\frac{f_{i,j+1} - f_{i,j-1}}{2 \\Delta y}\n$$\n周期性通过实现对 $N$ 取模的索引移位来处理，这可以通过数组滚动操作高效实现。\n\n- **周期性顶帽（箱式）滤波器**：对于显式滤波路径，应用一个可分离的二维顶帽滤波器。该滤波器将每个网格点的值替换为其 $(2r+1) \\times (2r+1)$ 邻域内值的未加权平均值，其中 $r$ 是滤波器半径。该滤波器操作使用 `scipy.ndimage.uniform_filter` 并配合 `mode='wrap'` 选项来实现，以正确处理周期性边界。\n\n**3. Smagorinsky SGS 应力计算**\n物理建模的核心在于使用 Smagorinsky 封闭计算偏斜 SGS 应力张量 $\\tau^{\\mathrm{dev}}_{ij}$。此过程被封装在一个单一函数中，该函数以速度场和模型参数作为输入。\n\n- **步骤 1：应变率张量**：根据给定的解析速度场 $(u_i)$，使用中心差分算子计算解析应变率张量 $S_{ij}$ 的分量：\n$$\nS_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right) \\quad \\Rightarrow \\quad S_{xx} = \\frac{\\partial u}{\\partial x}, \\quad S_{yy} = \\frac{\\partial v}{\\partial y}, \\quad S_{xy} = \\frac{1}{2}\\left(\\frac{\\partial u}{\\partial y} + \\frac{\\partial v}{\\partial x}\\right)\n$$\n- **步骤 2：应变率的模**：应变率张量的模 $\\lvert S \\rvert$ 计算如下：\n$$\n\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}} = \\sqrt{2(S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2)}\n$$\n- **步骤 3：SGS 应力张量**：偏斜 SGS 应力被建模为与应变率成正比，即 $\\tau^{\\mathrm{dev}}_{ij} = -2 \\nu_{SGS} S_{ij}$，其中 $\\nu_{SGS}$ 是涡粘性。Smagorinsky 模型将涡粘性定义为：\n$$\n\\nu_{SGS} = (C_s \\Delta)^2 \\lvert S \\rvert\n$$\n此处，$C_s$ 是 Smagorinsky 常数，$\\Delta$ 是特征滤波宽度。这给出了初步的 SGS 应力张量分量，例如 $\\tau_{xx} = -2 \\nu_{SGS} S_{xx}$。\n- **步骤 4：偏斜投影**：尽管不可压缩流的解析应变率张量是无迹的（$S_{kk}=0$），但数值离散化误差可能会引入非零的迹。为了严格强制无迹属性（$\\tau_{kk}=0$），对计算出的应力张量应用偏斜投影：\n$$\n\\widetilde{\\tau}_{ij} = \\tau_{ij} - \\frac{1}{d} \\tau_{kk} \\delta_{ij} \\quad (\\text{with } d=2)\n$$\n这确保了最终计算出的 SGS 应力张量是真正的偏斜张量。\n\n**4. 两条路径的实现**\n该问题要求比较由两种对滤波宽度 $\\Delta$ 的不同解释所产生的 SGS 应力张量。\n\n- **隐式路径**：此方法假设滤波操作由网格本身隐式执行。特征滤波宽度被设置为网格尺度 $\\Delta_{\\mathrm{imp}} = \\sqrt{\\Delta x \\Delta y}$。SGS 应力计算直接应用于原始的、未经滤波的速度场。\n\n- **显式路径**：此方法在建模之前涉及一个显式的滤波步骤。速度场分量 $(u,v)$ 首先使用 $(2r+1)\\times(2r+1)$ 箱式滤波器进行平滑处理。然后将特征滤波宽度设置为与此显式滤波器尺寸一致的值，即 $\\Delta_{\\mathrm{exp}} = (2r+1) \\sqrt{\\Delta x \\Delta y}$。接着使用 $\\Delta_{\\mathrm{exp}}$ 对这个预先滤波的速度场进行 SGS 应力计算。\n\n**5. 差异度量**\n两个 SGS 应力张量 $\\tau^{\\mathrm{imp}}_{ij}$ 和 $\\tau^{\\mathrm{exp}}_{ij}$ 之间的差异，通过它们差值的、在所有网格点上求和的归一化 Frobenius 范数来量化：\n$$\nE = \\sqrt{\\frac{\\sum_{\\text{grid}} \\lVert \\tau^{\\mathrm{imp}} - \\tau^{\\mathrm{exp}} \\rVert_F^2}{\\sum_{\\text{grid}} \\lVert \\tau^{\\mathrm{imp}} \\rVert_F^2}} = \\sqrt{\\frac{\\sum\\limits_{\\text{grid}} \\left[ (\\Delta \\tau_{xx})^2 + (\\Delta \\tau_{yy})^2 + 2 (\\Delta \\tau_{xy})^2 \\right]}{\\sum\\limits_{\\text{grid}} \\left[ (\\tau^{\\mathrm{imp}}_{xx})^2 + (\\tau^{\\mathrm{imp}}_{yy})^2 + 2 (\\tau^{\\mathrm{imp}}_{xy})^2 \\right]}}\n$$\n其中 $\\Delta \\tau_{ij} = \\tau^{\\mathrm{imp}}_{ij} - \\tau^{\\mathrm{exp}}_{ij}$。如果分母为零（即，隐式应力场恒为零），则误差 $E$ 定义为 $0$。\n\n对问题陈述中指定的每个测试用例执行所述过程，收集得到的标量值 $E$，并格式化为最终输出。对于滤波器半径 $r=0$ 的特殊情况，显式滤波器是一个单位操作，滤波宽度变得相等（$\\Delta_{\\mathrm{exp}} = \\Delta_{\\mathrm{imp}}$），导致预期误差为 $E=0$，这可作为一项有价值的内部一致性检验。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.ndimage import uniform_filter\n\ndef solve():\n    \"\"\"\n    Main function to compute and compare SGS stress predictions for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, Cs, r, kx, ky)\n        (64, 0.17, 0, 4, 3),\n        (64, 0.17, 1, 4, 3),\n        (64, 0.17, 2, 8, 8),\n        (16, 0.10, 1, 2, 1),\n        (32, 0.23, 3, 1, 5),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, Cs, r, kx, ky = case\n        \n        # 1. Grid and Field Setup\n        L = 2.0 * np.pi\n        dx = dy = L / N\n        x = np.linspace(0, L - dx, N)\n        y = np.linspace(0, L - dy, N)\n        X, Y = np.meshgrid(x, y)\n        \n        # Analytical velocity field from streamfunction\n        # psi = sin(kx*x)sin(ky*y)\n        # u = d(psi)/dy = ky*sin(kx*x)cos(ky*y)\n        # v = -d(psi)/dx = -kx*cos(kx*x)sin(ky*y)\n        u_initial = ky * np.sin(kx * X) * np.cos(ky * Y)\n        v_initial = -kx * np.cos(kx * X) * np.sin(ky * Y)\n\n        # 2. Implicit Pathway\n        Delta_imp = np.sqrt(dx * dy)\n        tau_imp_xx, tau_imp_yy, tau_imp_xy = calculate_sgs_stress(\n            u_initial, v_initial, dx, dy, Cs, Delta_imp\n        )\n        \n        # 3. Explicit Pathway\n        # Apply top-hat filter to velocity fields\n        u_filtered = box_filter(u_initial, r)\n        v_filtered = box_filter(v_initial, r)\n        \n        Delta_exp = (2 * r + 1) * np.sqrt(dx * dy)\n        tau_exp_xx, tau_exp_yy, tau_exp_xy = calculate_sgs_stress(\n            u_filtered, v_filtered, dx, dy, Cs, Delta_exp\n        )\n\n        # 4. Difference Metric Calculation\n        d_tau_xx = tau_imp_xx - tau_exp_xx\n        d_tau_yy = tau_imp_yy - tau_exp_yy\n        d_tau_xy = tau_imp_xy - tau_exp_xy\n        \n        # Numerator: Sum of squared Frobenius norm of the difference tensor\n        numerator = np.sum(d_tau_xx**2 + d_tau_yy**2 + 2 * d_tau_xy**2)\n        \n        # Denominator: Sum of squared Frobenius norm of the implicit tensor\n        denominator = np.sum(tau_imp_xx**2 + tau_imp_yy**2 + 2 * tau_imp_xy**2)\n        \n        if denominator == 0.0:\n            E = 0.0\n        else:\n            E = np.sqrt(numerator / denominator)\n            \n        results.append(E)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef periodic_central_difference(f, delta):\n    \"\"\"\n    Computes partial derivatives using 2nd-order periodic central differences.\n    Numpy indexing: axis 0 is y, axis 1 is x.\n    \"\"\"\n    df_dx = (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * delta)\n    df_dy = (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * delta)\n    return df_dx, df_dy\n\ndef box_filter(f, r):\n    \"\"\"\n    Applies a separable, periodic 2D top-hat (box) filter of radius r.\n    A radius r=0 means a 1x1 filter, which is an identity operation.\n    \"\"\"\n    if r == 0:\n        return f.copy()\n    width = 2 * r + 1\n    # scipy.ndimage.uniform_filter is ideal for this, handling separability\n    # and periodic boundaries (mode='wrap') efficiently.\n    return uniform_filter(f, size=width, mode='wrap')\n\ndef calculate_sgs_stress(u, v, dx, dy, Cs, Delta_filter):\n    \"\"\"\n    Computes the deviatoric Smagorinsky SGS stress tensor for a given velocity field.\n    \"\"\"\n    # Compute velocity gradients using central differences\n    du_dx, du_dy = periodic_central_difference(u, dx)\n    dv_dx, dv_dy = periodic_central_difference(v, dy)\n\n    # Compute resolved strain-rate tensor components, S_ij\n    S_xx = du_dx\n    S_yy = dv_dy\n    S_xy = 0.5 * (du_dy + dv_dx)\n\n    # Compute strain-rate magnitude, |S|\n    # |S| = sqrt(2 * S_ij * S_ij)\n    S_mag = np.sqrt(2 * (S_xx**2 + S_yy**2 + 2 * S_xy**2))\n\n    # Compute eddy viscosity, nu_sgs\n    nu_sgs = (Cs * Delta_filter)**2 * S_mag\n\n    # Compute SGS stress tensor, tau_ij = -2 * nu_sgs * S_ij\n    tau_xx_raw = -2 * nu_sgs * S_xx\n    tau_yy_raw = -2 * nu_sgs * S_yy\n    tau_xy_raw = -2 * nu_sgs * S_xy\n\n    # Apply deviatoric projection for d=2 to enforce trace-free property numerically\n    trace_tau = tau_xx_raw + tau_yy_raw\n    tau_xx = tau_xx_raw - 0.5 * trace_tau\n    tau_yy = tau_yy_raw - 0.5 * trace_tau\n    tau_xy = tau_xy_raw # Off-diagonal elements are unchanged by projection\n    \n    return tau_xx, tau_yy, tau_xy\n\nsolve()\n```"
        }
    ]
}