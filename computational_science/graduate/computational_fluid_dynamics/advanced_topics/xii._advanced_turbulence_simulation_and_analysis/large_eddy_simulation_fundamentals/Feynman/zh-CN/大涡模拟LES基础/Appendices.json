{
    "hands_on_practices": [
        {
            "introduction": "大涡模拟（Large Eddy Simulation）的基础在于空间滤波的概念，它将湍流分为大的、可解的涡和小的、需要建模的亚格子尺度涡。第一个练习提供了一个直接的解析练习，以理解一个常用滤波器——“礼帽”滤波器——对一个简单正弦波的作用。通过完成这个练习（），您将对滤波器如何修改流场以及如何定义其有效“截止”尺度有一个具体的理解。",
            "id": "3338942",
            "problem": "在大涡模拟（LES）中，空间滤波被定义为一个场与一个滤波核的卷积。考虑一个一维空间均匀的滤波器，其核函数 $G(x;\\Delta)$ 是宽度为 $\\Delta$ 的紧支集，并将滤波后的场 $\\bar{\\phi}(x)$ 定义为卷积 $\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,dr$。取箱式核函数 $G(x;\\Delta) = \\frac{1}{\\Delta}\\,\\mathbb{1}_{|x| \\le \\Delta/2}$ 和标量场 $\\phi(x) = \\sin(k x)$，其中 $k$ 是一个实波数。仅从卷积的定义和基本的三角恒等式出发，推导 $\\bar{\\phi}(x)$ 作为 $k$、$\\Delta$ 和 $x$ 的函数的闭式表达式。然后，将有效谱截断波数 $k_c$ 定义为使滤波器一维传递函数幅值消失的最小正波数 $k$，并表示出相应的无量纲积 $k_c \\Delta$。将您的最终答案以单行向量的形式给出，其第一个条目是 $\\bar{\\phi}(x)$ 的精确表达式，第二个条目是 $k_c \\Delta$ 的精确值。无需四舍五入，最终答案中不应包含单位。",
            "solution": "在尝试求解之前，对问题陈述进行严格验证。\n\n### 步骤 1：提取已知条件\n- **空间滤波的定义：** 滤波后的场 $\\bar{\\phi}(x)$ 是场 $\\phi(x)$ 与滤波核 $G(x;\\Delta)$ 的卷积：$\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,dr$。\n- **滤波核：** 一维箱式滤波核，$G(x;\\Delta) = \\frac{1}{\\Delta}\\,\\mathbb{1}_{|x| \\le \\Delta/2}$，其中 $\\mathbb{1}$ 是指示函数，$\\Delta$ 是滤波器宽度。\n- **标量场：** 单波数正弦场，$\\phi(x) = \\sin(k x)$，其中 $k$ 是实波数。\n- **截断波数的定义：** 有效谱截断波数 $k_c$ 是使滤波器一维传递函数幅值消失的最小正波数 $k$。\n- **任务：** 推导 $\\bar{\\phi}(x)$ 的闭式表达式，并求出无量纲积 $k_c \\Delta$ 的值。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学基础：** 该问题是大涡模拟（LES）数学基础中的一个标准练习，而大涡模拟是计算流体力学的一个主要课题。卷积、滤波核和传递函数等概念是信号处理和湍流理论中的基本原理。\n- **适定性：** 提供了所有必要的函数（$G$, $\\phi$）、定义（卷积, $k_c$）和约束。该问题是自洽的，其结构可产生唯一解。\n- **客观性：** 语言正式且精确，没有主观或含糊的陈述。\n- **未检测到其他缺陷：** 该问题并非不健全、不完整、矛盾、不现实或不适定。\n\n### 步骤 3：结论与行动\n该问题是 **有效的**。将提供一个完整且有理有据的解答。\n\n### 解题推导\n第一步是通过计算卷积积分来推导滤波后场 $\\bar{\\phi}(x)$ 的表达式。\n滤波后场的定义为：\n$$\n\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,dr\n$$\n代入给定的滤波核 $G(r;\\Delta)$ 和标量场 $\\phi(x)$ 的表达式：\n$$\n\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} \\left(\\frac{1}{\\Delta}\\,\\mathbb{1}_{|r| \\le \\Delta/2}\\right) \\sin(k(x-r))\\,dr\n$$\n指示函数 $\\mathbb{1}_{|r| \\le \\Delta/2}$ 在 $-\\Delta/2 \\le r \\le \\Delta/2$ 时等于 $1$，否则为 $0$。此属性限制了积分的上下限：\n$$\n\\bar{\\phi}(x) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\sin(k(x-r))\\,dr\n$$\n为计算该积分，我们使用两角差的正弦三角恒等式：$\\sin(A-B) = \\sin(A)\\cos(B) - \\cos(A)\\sin(B)$。令 $A = kx$ 且 $B = kr$。\n$$\n\\sin(k(x-r)) = \\sin(kx)\\cos(kr) - \\cos(kx)\\sin(kr)\n$$\n将此代入积分中：\n$$\n\\bar{\\phi}(x) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\left[ \\sin(kx)\\cos(kr) - \\cos(kx)\\sin(kr) \\right]\\,dr\n$$\n由于 $\\sin(kx)$ 和 $\\cos(kx)$ 不依赖于积分变量 $r$，它们可以从积分中提出：\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(kx)}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\cos(kr)\\,dr - \\frac{\\cos(kx)}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\sin(kr)\\,dr\n$$\n我们现在分别计算这两个积分。\n第一个积分涉及偶函数 $\\cos(kr)$ 在对称区间上的积分：\n$$\n\\int_{-\\Delta/2}^{\\Delta/2} \\cos(kr)\\,dr = \\left[ \\frac{\\sin(kr)}{k} \\right]_{-\\Delta/2}^{\\Delta/2} = \\frac{\\sin(k\\Delta/2)}{k} - \\frac{\\sin(-k\\Delta/2)}{k}\n$$\n由于 $\\sin(-z) = -\\sin(z)$，这可以简化为：\n$$\n\\frac{\\sin(k\\Delta/2)}{k} + \\frac{\\sin(k\\Delta/2)}{k} = \\frac{2}{k} \\sin\\left(\\frac{k\\Delta}{2}\\right)\n$$\n第二个积分涉及奇函数 $\\sin(kr)$ 在对称区间上的积分。这样的积分恒为零。我们可以明确地验证这一点：\n$$\n\\int_{-\\Delta/2}^{\\Delta/2} \\sin(kr)\\,dr = \\left[ -\\frac{\\cos(kr)}{k} \\right]_{-\\Delta/2}^{\\Delta/2} = -\\frac{\\cos(k\\Delta/2)}{k} - \\left(-\\frac{\\cos(-k\\Delta/2)}{k}\\right)\n$$\n由于 $\\cos(-z) = \\cos(z)$，这可以简化为：\n$$\n-\\frac{\\cos(k\\Delta/2)}{k} + \\frac{\\cos(k\\Delta/2)}{k} = 0\n$$\n将这些结果代回 $\\bar{\\phi}(x)$ 的表达式中：\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(kx)}{\\Delta} \\left( \\frac{2}{k} \\sin\\left(\\frac{k\\Delta}{2}\\right) \\right) - \\frac{\\cos(kx)}{\\Delta} (0)\n$$\n$$\n\\bar{\\phi}(x) = \\frac{2}{k\\Delta} \\sin\\left(\\frac{k\\Delta}{2}\\right) \\sin(kx)\n$$\n这个表达式可以方便地重写以突出滤波器的传递函数。通过重新整理各项，我们得到所需答案的第一部分：\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\sin(kx)\n$$\n\n第二步是确定无量纲积 $k_c \\Delta$。\n将滤波器应用于单个傅里叶模态 $\\exp(ikx)$，会导致该模态乘以滤波器的传递函数 $\\hat{G}(k)$。对于像 $\\phi(x) = \\sin(kx)$ 这样的实值场，假设核函数 $G(x)$ 是实偶函数（对于箱式核是成立的），则滤波后的场为 $\\bar{\\phi}(x) = \\hat{G}(k)\\phi(x)$。\n通过将我们推导出的 $\\bar{\\phi}(x)$ 表达式与形式 $\\hat{G}(k)\\phi(x) = \\hat{G}(k)\\sin(kx)$ 进行比较，我们可以确定传递函数：\n$$\n\\hat{G}(k) = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2}\n$$\n这是归一化的 sinc 函数，$\\text{sinc}(k\\Delta/2)$。\n根据问题定义，$k_c$ 是使传递函数幅值 $|\\hat{G}(k)|$ 为零的最小正波数 $k$。由于 $\\hat{G}(k)$ 是实数，这等价于找到使 $\\hat{G}(k) = 0$ 的最小正波数 $k$。\n$$\n\\frac{\\sin(k_c\\Delta/2)}{k_c\\Delta/2} = 0\n$$\n要使此表达式为零，分子必须为零，而分母不为零（$k_c=0$ 的情况被排除，因为我们寻求的是正波数，并且在极限 $k\\to 0$ 时，$\\hat{G}(k) \\to 1$）。\n因此，条件是：\n$$\n\\sin\\left(\\frac{k_c\\Delta}{2}\\right) = 0\n$$\n$\\sin(\\theta) = 0$ 的通解是 $\\theta = n\\pi$，其中 $n$ 是任意整数。因此：\n$$\n\\frac{k_c\\Delta}{2} = n\\pi, \\quad n \\in \\mathbb{Z}\n$$\n我们寻求最小的正波数 $k_c$。由于滤波器宽度 $\\Delta$ 是正的，我们必须有 $n  0$。最小的正整数是 $n=1$。\n$$\n\\frac{k_c\\Delta}{2} = \\pi\n$$\n求解无量纲积 $k_c \\Delta$ 得到所需答案的第二部分：\n$$\nk_c \\Delta = 2\\pi\n$$\n其物理释义是，箱式滤波器完全移除了波长 $\\lambda = 2\\pi/k_c$ 等于滤波器宽度 $\\Delta$ 的波，即 $\\lambda_c = \\Delta$。\n\n最终答案由 $\\bar{\\phi}(x)$ 的表达式和 $k_c \\Delta$ 的值组成。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\sin(kx)  2\\pi \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "将LES滤波器应用于Navier-Stokes方程会引入未封闭的亚格子尺度（SGS）应力张量 $\\tau_{ij}$，这代表了LES建模中的核心挑战。这个动手编程练习（）让您能够从合成的高分辨率数据中计算出这个“精确”的应力，并将其与经典的尺度相似性模型的预测进行比较。此外，您还将量化亚格子能量通量，从而深入了解SGS模型应如何从已解尺度中耗散能量以模仿湍流的能量级串。",
            "id": "3339012",
            "problem": "考虑二维空间中的不可压缩流以及大涡模拟 (LES) 的框架。从滤波后的方程出发，子网格尺度 (SGS) 应力张量根据直接数值模拟 (DNS) 数据由精确关系定义为 $$\\tau_{ij}^{\\mathrm{exact}} = \\overline{u_i u_j} - \\overline{u}_i \\,\\overline{u}_j,$$ 其中 $\\overline{\\cdot}$ 表示在 LES 滤波尺度上的空间滤波。尺度相似 (SS) 模型（也称为 Bardina 模型）仅使用已解析的滤波场和测试滤波器来定义模型应力，具体如下 $$\\tau_{ij}^{\\mathrm{SS}} = \\widehat{\\overline{u}_i \\,\\overline{u}_j} - \\widehat{\\overline{u}}_i \\,\\widehat{\\overline{u}}_j,$$ 其中尖号表示在更大尺度上的第二个滤波器（测试滤波器）。在混合模型中，为了修正平均能量传递，会加入一个涡粘性贡献项，该项由 Boussinesq 假设定义 $$\\tau_{ij}^{\\mathrm{EV}} = -2 \\nu_t S_{ij},\\quad \\nu_t = \\left(C_s \\,\\Delta\\right)^2 \\,\\lvert S \\rvert,$$ 其中已解析应变率为 $$S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i}\\right),\\quad \\lvert S \\rvert = \\sqrt{2\\,S_{ij} S_{ij}},$$ 模型常数为 $C_s$，滤波宽度为 $\\Delta$。混合应力为 $$\\tau_{ij}^{\\mathrm{mix}} = \\tau_{ij}^{\\mathrm{SS}} - 2 \\nu_t S_{ij}.$$\n\n您将需在一个离散的、周期性的二维网格上实现这些定义，网格的无量纲间距为 $h = 1$，并且在所有三角函数求值中使用弧度。设域为一个 $N \\times N$ 的网格，索引为 $(m,n)$，其中 $m,n \\in \\{0,1,\\ldots,N-1\\}$。将 DNS 速度分量确定性地定义为网格索引的函数：\n$$u(m,n) = \\sin\\!\\left(\\frac{2\\pi f_x}{N}\\,m\\right)\\cos\\!\\left(\\frac{2\\pi f_y}{N}\\,n\\right) + 0.3\\,\\sin\\!\\left(\\frac{4\\pi f_x}{N}\\,m\\right)\\sin\\!\\left(\\frac{6\\pi f_y}{N}\\,n\\right),$$\n$$v(m,n) = -\\cos\\!\\left(\\frac{2\\pi f_x}{N}\\,m\\right)\\sin\\!\\left(\\frac{2\\pi f_y}{N}\\,n\\right) + 0.25\\,\\cos\\!\\left(\\frac{4\\pi f_x}{N}\\,m\\right)\\cos\\!\\left(\\frac{4\\pi f_y}{N}\\,n\\right).$$\n所有三角函数参数均以弧度为单位。\n\n使用一个带有周期性边界条件的离散、可分离的顶帽（箱式）滤波器。设 LES 滤波器的半径为 $r_f \\in \\mathbb{N}$，其窗口大小为 $N_f = 2 r_f + 1$。标量场 $\\phi$ 经过滤波后的场 $\\overline{\\phi}$ 是以每个网格点为中心的 $(2r_f+1)\\times(2r_f+1)$ 邻域上的平均值，计算时使用周期性环绕。测试滤波器的半径为 $r_t = \\alpha\\,r_f$，其中 $\\alpha \\ge 1$ 为整数，其窗口大小为 $N_t = 2 r_t + 1$。对带尖号的滤波器使用相同的离散平均法则。\n\n通过对指定的 DNS 乘积和速度进行滤波，计算 LES 滤波尺度上的精确 SGS 应力分量；通过对 LES 滤波后速度的乘积应用测试滤波器，计算 SS 模型分量。使用二阶中心差分法、周期性边界条件和网格间距 $h=1$，从 LES 滤波后的速度计算已解析应变率 $S_{ij}$。\n\n将每个网格点上从已解析尺度到子网格尺度的无量纲瞬时能量通量定义为\n$$\\Pi = -\\sum_{i,j=1}^{2} \\tau_{ij} S_{ij}.$$\n在二维情况下，对于对称张量，这可以实现为\n$$\\Pi = -\\left(\\tau_{11} S_{11} + \\tau_{22} S_{22} + 2\\,\\tau_{12} S_{12}\\right).$$\n通过对所有网格点上的 $\\Pi$ 进行平均，计算域平均值 $\\langle \\Pi \\rangle$。\n\n您的任务：\n- 对每个测试用例，计算精确剪切应力分量 $\\tau_{12}^{\\mathrm{exact}}$ 和 SS 模型预测值 $\\tau_{12}^{\\mathrm{SS}}$ 的展平数组之间的皮尔逊相关系数 $r$。\n- 计算精确应力、SS 模型应力以及带涡粘性的混合模型应力的域平均能量通量 $\\langle \\Pi \\rangle$。\n\n所有能量通量均以无量纲单位表示，角度以弧度表示。输出必须是浮点数。\n\n测试套件：\n- 用例 1：$N = 64$，$f_x = 2$，$f_y = 3$，$r_f = 1$（因此 $N_f = 3$），$\\alpha = 2$，$C_s = 0.0$。\n- 用例 2：$N = 64$，$f_x = 2$，$f_y = 3$，$r_f = 1$（因此 $N_f = 3$），$\\alpha = 2$，$C_s = 0.18$。\n- 用例 3：$N = 64$，$f_x = 8$，$f_y = 9$，$r_f = 2$（因此 $N_f = 5$），$\\alpha = 2$，$C_s = 0.18$。\n- 用例 4：$N = 64$，$f_x = 4$，$f_y = 5$，$r_f = 4$（因此 $N_f = 9$），$\\alpha = 2$，$C_s = 0.18$。\n\n在您的程序中使用的定义：\n- LES 滤波宽度为 $\\Delta = N_f \\, h$，其中 $h = 1$。\n- 导数的中心差分使用周期性环绕：对于场 $\\phi$，$$\\frac{\\partial \\phi}{\\partial x} \\approx \\frac{\\phi(m,n+1) - \\phi(m,n-1)}{2h},\\quad \\frac{\\partial \\phi}{\\partial y} \\approx \\frac{\\phi(m+1,n) - \\phi(m-1,n)}{2h},$$ 其中索引以 $N$ 为模，且 $h=1$。\n- 相关系数 $r$ 使用两个展平数组之间的标准皮尔逊公式计算。\n\n您的程序应生成单行输出，其中包含所有测试用例的汇总结果，格式为方括号内的逗号分隔列表。对于每个测试用例，将四个浮点数 $[r,\\langle \\Pi \\rangle_{\\mathrm{exact}},\\langle \\Pi \\rangle_{\\mathrm{SS}},\\langle \\Pi \\rangle_{\\mathrm{mix}}]$ 按顺序追加到这个列表中，从而为四个用例生成一个长度为 16 的扁平列表。角度必须以弧度为单位，能量通量必须是无量纲浮点数。",
            "solution": "用户提供的问题是计算流体动力学领域一个适定的计算练习，特别关注大涡模拟 (LES) 的基本原理。该问题具有科学依据，所有定义均符合标准的 LES 文献，尽管为教学目的采用了一些非标准的符号选择。所有必需的数据和参数都已提供，从而能够得到一个唯一的、确定性的解。该问题的有效性已得到确认。\n\n求解过程通过逐步实现指定的模型和数值方法来进行。\n\n### 1. 网格和速度场生成\n建立一个尺寸为 $N \\times N$ 的二维周期性域。网格索引为 $(m,n)$，其中 $m, n \\in \\{0, 1, \\dots, N-1\\}$。问题将一个合成的直接数值模拟 (DNS) 场的速度分量 $u_1$ 和 $u_2$（在问题中表示为 $u$ 和 $v$）定义为这些网格索引的确定性函数。\n速度矢量为 $\\mathbf{u} = (u_1, u_2)$，其中：\n$$u_1(m,n) = \\sin\\left(\\frac{2\\pi f_x}{N}m\\right)\\cos\\left(\\frac{2\\pi f_y}{N}n\\right) + 0.3\\sin\\left(\\frac{4\\pi f_x}{N}m\\right)\\sin\\left(\\frac{6\\pi f_y}{N}n\\right)$$\n$$u_2(m,n) = -\\cos\\left(\\frac{2\\pi f_x}{N}m\\right)\\sin\\left(\\frac{2\\pi f_y}{N}n\\right) + 0.25\\cos\\left(\\frac{4\\pi f_x}{N}m\\right)\\cos\\left(\\frac{4\\pi f_y}{N}n\\right)$$\n这些场作为 LES 模型分析所需的高分辨率“真值”数据。\n\n### 2. 算子的离散化\n需要两个关键算子：一个空间滤波器和一个微分算子。\n\n**空间滤波：** 定义一个离散、可分离的顶帽（箱式）滤波器。对于给定的场 $\\phi$，网格点上的 LES 滤波场 $\\overline{\\phi}$ 是尺寸为 $N_f \\times N_f$ 的方形邻域上的平均值，其中 $N_f = 2r_f+1$，$r_f$ 是滤波器半径。用尖号 ($\\widehat{\\cdot}$) 表示的相同滤波操作用于测试滤波器，但其半径更大，为 $r_t = \\alpha r_f$。该操作通过沿每个轴依次应用一维移动平均来数值实现，并遵循周期性边界条件。\n\n**空间微分：** 问题为关于坐标 $x$ 和 $y$ 的偏导数定义了二阶中心差分格式。这里使用了一个非标准映射：导数 $\\partial/\\partial x$ 沿网格的第二个索引（$n$）计算，而 $\\partial/\\partial y$ 沿第一个索引（$m$）计算：\n$$\\frac{\\partial\\phi}{\\partial x}(m,n) \\approx \\frac{\\phi(m,n+1) - \\phi(m,n-1)}{2h}$$\n$$\\frac{\\partial\\phi}{\\partial y}(m,n) \\approx \\frac{\\phi(m+1,n) - \\phi(m-1,n)}{2h}$$\n其中 $h=1$ 是网格间距，索引以 $N$ 为模以强制周期性。当关联到张量索引表示法 $\\partial/\\partial x_j$ 时，我们映射 $\\partial/\\partial x_1 \\to \\partial/\\partial x$ 和 $\\partial/\\partial x_2 \\to \\partial/\\partial y$。\n\n### 3. 子网格尺度 (SGS) 应力张量\n在定义了算子之后，我们计算各种 SGS 应力张量。\n\n**精确 SGS 应力 ($\\tau_{ij}^{\\mathrm{exact}}$)：** 这是从 DNS 数据计算得出的。首先，对 DNS 速度场 $\\mathbf{u}$ 进行滤波，以获得已解析的 LES 速度场 $\\overline{\\mathbf{u}}$。然后，计算 DNS 速度分量的张量积 ($u_i u_j$) 并对其进行滤波。精确 SGS 应力定义为：\n$$\\tau_{ij}^{\\mathrm{exact}} = \\overline{u_i u_j} - \\overline{u}_i \\overline{u}_j$$\n\n**尺度相似 (SS) 模型应力 ($\\tau_{ij}^{\\mathrm{SS}}$)：** 该模型，也称为 Bardina 模型，仅使用已解析场来近似 SGS 应力。它对 LES 场应用了第二个更宽的“测试”滤波器。\n$$\\tau_{ij}^{\\mathrm{SS}} = \\widehat{\\overline{u}_i \\overline{u}_j} - \\widehat{\\overline{u}}_i \\widehat{\\overline{u}}_j$$\n在计算上，这需要对已经过 LES 滤波的场 ($\\overline{u}_i$) 及其乘积 ($\\overline{u}_i \\overline{u}_j$) 应用测试滤波器（半径 $r_t$）。\n\n### 4. 相关性分析\nLES 建模的一个主要目标是产生一个与精确应力良好相关的模型应力。计算精确剪切应力分量 $\\tau_{12}^{\\mathrm{exact}}$ 与其 SS 模型对应项 $\\tau_{12}^{\\mathrm{SS}}$ 之间的皮尔逊相关系数 $r$。\n$$r(\\tau_{12}^{\\mathrm{exact}}, \\tau_{12}^{\\mathrm{SS}}) = \\frac{\\mathrm{cov}(\\tau_{12}^{\\mathrm{exact}}, \\tau_{12}^{\\mathrm{SS}})}{\\sigma_{\\tau_{12}^{\\mathrm{exact}}} \\sigma_{\\tau_{12}^{\\mathrm{SS}}}}$$\n这是在展平为一维向量的应力值数组上计算的。\n\n### 5. SGS 能量通量 ($\\Pi$)\nLES 模型的另一个关键方面是其正确预测已解析尺度和子网格尺度之间能量传递的能力。这由 SGS 能量通量 $\\Pi = -\\tau_{ij} S_{ij}$ 来量化，其中 $S_{ij}$ 是已解析尺度应变率张量。\n\n**已解析尺度应变率 ($S_{ij}$)：** 该张量由 LES 滤波后的速度场 $\\overline{\\mathbf{u}}$ 计算得出：\n$$S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i}\\right)$$\n使用指定的离散微分法则来计算速度梯度。其分量为：\n$$S_{11} = \\frac{\\partial \\overline{u}_1}{\\partial x_1}, \\quad S_{22} = \\frac{\\partial \\overline{u}_2}{\\partial x_2}, \\quad S_{12} = \\frac{1}{2}\\left(\\frac{\\partial \\overline{u}_1}{\\partial x_2} + \\frac{\\partial \\overline{u}_2}{\\partial x_1}\\right)$$\n\n**混合模型应力 ($\\tau_{ij}^{\\mathrm{mix}}$)：** 已知 SS 模型的耗散性较差。为了修正这一点，添加了一个涡粘性项，从而构成一个混合模型。\n$$\\tau_{ij}^{\\mathrm{mix}} = \\tau_{ij}^{\\mathrm{SS}} - 2 \\nu_t S_{ij}$$\n涡粘性 $\\nu_t$ 使用 Smagorinsky 公式进行建模：\n$$\\nu_t = (C_s \\Delta)^2 |\\overline{S}|, \\quad \\text{其中} \\quad |\\overline{S}| = \\sqrt{2 S_{ij} S_{ij}}$$\n这里，$C_s$ 是 Smagorinsky 常数，$\\Delta = N_f h$ 是 LES 滤波宽度。\n\n**能量通量计算：** 为每个模型计算 SGS 能量通量，并在整个域上进行平均。在二维情况下，通量为：\n$$\\Pi = -(\\tau_{11}S_{11} + \\tau_{22}S_{22} + 2\\tau_{12}S_{12})$$\n我们为每个测试用例计算域平均值 $\\langle \\Pi_{\\mathrm{exact}} \\rangle$、$\\langle \\Pi_{\\mathrm{SS}} \\rangle$ 和 $\\langle \\Pi_{\\mathrm{mix}} \\rangle$。对于混合模型，其通量可以方便地计算为：\n$$\\Pi_{\\mathrm{mix}} = \\Pi_{\\mathrm{SS}} + 2 \\nu_t S_{ij}S_{ij} = \\Pi_{\\mathrm{SS}} + \\nu_t |\\overline{S}|^2 = \\Pi_{\\mathrm{SS}} + (C_s \\Delta)^2 |\\overline{S}|^3$$\n\n实现过程首先为滤波和微分操作创建函数，然后处理每个测试用例以计算四个所需的量：相关系数 $r$ 和三个平均能量通量。",
            "answer": "```python\nimport numpy as np\n\ndef box_filter_2d(phi, r):\n    \"\"\"\n    Applies a 2D separable box filter with periodic boundary conditions.\n    \n    Args:\n        phi (np.ndarray): The 2D input field.\n        r (int): The filter radius (window size will be 2*r+1).\n        \n    Returns:\n        np.ndarray: The filtered field.\n    \"\"\"\n    if r == 0:\n        return phi\n        \n    window_size = 2 * r + 1\n    \n    # Filter along axis 0 (m-index)\n    phi_temp = np.zeros_like(phi, dtype=np.float64)\n    for i in range(-r, r + 1):\n        phi_temp += np.roll(phi, i, axis=0)\n    \n    # Filter along axis 1 (n-index)\n    phi_filtered = np.zeros_like(phi_temp, dtype=np.float64)\n    for i in range(-r, r + 1):\n        phi_filtered += np.roll(phi_temp, i, axis=1)\n    \n    # Normalize by total window area\n    phi_filtered /= (window_size * window_size)\n    \n    return phi_filtered\n\ndef calculate_derivatives(phi, h=1.0):\n    \"\"\"\n    Calculates spatial derivatives using second-order central differences\n    with periodic boundaries, following the problem's unconventional definitions.\n    \n    - d/dx is defined as difference along axis 1 (n-index).\n    - d/dy is defined as difference along axis 0 (m-index).\n    \n    Args:\n        phi (np.ndarray): The 2D input field.\n        h (float): The grid spacing.\n        \n    Returns:\n        tuple[np.ndarray, np.ndarray]: (d(phi)/dx, d(phi)/dy)\n    \"\"\"\n    # d/dx is defined as difference along axis 1 (n-index)\n    d_dx = (np.roll(phi, -1, axis=1) - np.roll(phi, 1, axis=1)) / (2 * h)\n    \n    # d/dy is defined as difference along axis 0 (m-index)\n    d_dy = (np.roll(phi, -1, axis=0) - np.roll(phi, 1, axis=0)) / (2 * h)\n    \n    return d_dx, d_dy\n\ndef process_case(N, fx, fy, rf, alpha, Cs):\n    \"\"\"\n    Processes a single test case and returns the required metrics.\n    \"\"\"\n    h = 1.0\n    \n    # 1. Grid and DNS field generation\n    m, n = np.meshgrid(np.arange(N), np.arange(N), indexing='ij')\n    u1 = np.sin(2 * np.pi * fx / N * m) * np.cos(2 * np.pi * fy / N * n) + \\\n         0.3 * np.sin(4 * np.pi * fx / N * m) * np.sin(6 * np.pi * fy / N * n)\n    u2 = -np.cos(2 * np.pi * fx / N * m) * np.sin(2 * np.pi * fy / N * n) + \\\n         0.25 * np.cos(4 * np.pi * fx / N * m) * np.cos(4 * np.pi * fy / N * n)\n\n    # 2. Filtering\n    rt = int(alpha * rf)\n    u1_bar = box_filter_2d(u1, rf)\n    u2_bar = box_filter_2d(u2, rf)\n    \n    u1_hat = box_filter_2d(u1_bar, rt)\n    u2_hat = box_filter_2d(u2_bar, rt)\n\n    # 3. Exact SGS Stress\n    tau11_exact = box_filter_2d(u1 * u1, rf) - u1_bar * u1_bar\n    tau12_exact = box_filter_2d(u1 * u2, rf) - u1_bar * u2_bar\n    tau22_exact = box_filter_2d(u2 * u2, rf) - u2_bar * u2_bar\n\n    # 4. Scale-Similarity (SS) Model Stress\n    tau11_ss = box_filter_2d(u1_bar * u1_bar, rt) - u1_hat * u1_hat\n    tau12_ss = box_filter_2d(u1_bar * u2_bar, rt) - u1_hat * u2_hat\n    tau22_ss = box_filter_2d(u2_bar * u2_bar, rt) - u2_hat * u2_hat\n\n    # 5. Correlation Coefficient\n    r = np.corrcoef(tau12_exact.flatten(), tau12_ss.flatten())[0, 1]\n\n    # 6. Resolved Strain Rate Tensor S_ij\n    du1_dx, du1_dy = calculate_derivatives(u1_bar, h)\n    du2_dx, du2_dy = calculate_derivatives(u2_bar, h)\n    S11 = du1_dx\n    S22 = du2_dy\n    S12 = 0.5 * (du1_dy + du2_dx)\n    \n    # 7. Energy Fluxes\n    Pi_exact = -(tau11_exact * S11 + tau22_exact * S22 + 2 * tau12_exact * S12)\n    Pi_ss = -(tau11_ss * S11 + tau22_ss * S22 + 2 * tau12_ss * S12)\n    \n    avg_Pi_exact = np.mean(Pi_exact)\n    avg_Pi_ss = np.mean(Pi_ss)\n\n    # 8. Mixed Model Flux\n    if Cs == 0.0:\n        avg_Pi_mix = avg_Pi_ss\n    else:\n        Nf = 2 * rf + 1\n        delta = Nf * h\n        S_mag_sq = 2 * (S11**2 + S22**2 + 2 * S12**2)\n        S_mag = np.sqrt(S_mag_sq)\n        \n        dissipation_ev = (Cs * delta)**2 * S_mag**3\n        avg_Pi_mix = avg_Pi_ss + np.mean(dissipation_ev)\n\n    return r, avg_Pi_exact, avg_Pi_ss, avg_Pi_mix\n\ndef main():\n    \"\"\"\n    Main execution block to run all test cases and print results.\n    \"\"\"\n    test_suite = [\n        {\"N\": 64, \"fx\": 2, \"fy\": 3, \"rf\": 1, \"alpha\": 2, \"Cs\": 0.0},\n        {\"N\": 64, \"fx\": 2, \"fy\": 3, \"rf\": 1, \"alpha\": 2, \"Cs\": 0.18},\n        {\"N\": 64, \"fx\": 8, \"fy\": 9, \"rf\": 2, \"alpha\": 2, \"Cs\": 0.18},\n        {\"N\": 64, \"fx\": 4, \"fy\": 5, \"rf\": 4, \"alpha\": 2, \"Cs\": 0.18},\n    ]\n\n    all_results = []\n    for case_params in test_suite:\n        results = process_case(**case_params)\n        all_results.extend(results)\n\n    # Format the output as a single comma-separated list in brackets\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nif __name__ == \"__main__\":\n    main()\n```"
        },
        {
            "introduction": "现代SGS建模越来越多地利用机器学习，但这些模型必须遵守流体动力学的基本物理定律才能保证其可靠性。这个高级练习（）将指导您构建一个基于物理信息的SGS应力神经网络模型。您将通过使用张量基和标量不变量来构建一个内在满足伽利略不变性的模型，并学习如何通过专门设计的损失函数来强制施加能量耗散等物理约束。",
            "id": "3339014",
            "problem": "您的任务是为大涡模拟（Large Eddy Simulation, LES）实现一个受约束的机器学习亚格子尺度（Subgrid-Scale, SGS）偏应力模型。该模型使用基于滤波应变率张量 $\\tilde{S}_{ij}$ 和滤波旋转率张量 $\\tilde{\\Omega}_{ij}$ 构建的不变张量基。该模型必须是客观的（坐标系不变的）、对称的、无迹的，并通过惩罚项来促进其耗散性。程序必须通过聚合数据拟合损失和约束惩罚来计算每个案例的总损失值。\n\n从以下不可压缩滤波流的基本定义开始：应变率张量 $\\tilde{S} = \\frac{1}{2} \\left( \\nabla \\tilde{u} + \\nabla \\tilde{u}^{\\top} \\right)$ 和旋转率张量 $\\tilde{\\Omega} = \\frac{1}{2} \\left( \\nabla \\tilde{u} - \\nabla \\tilde{u}^{\\top} \\right)$，对于不可压缩流，$\\operatorname{tr}(\\tilde{S}) = 0$。对任意张量 $\\mathbf{A}$ 定义偏张量算子 $\\operatorname{dev}(\\mathbf{A}) = \\mathbf{A} - \\frac{1}{3} \\operatorname{tr}(\\mathbf{A}) \\mathbf{I}$，其中 $\\mathbf{I}$ 是单位张量。\n\n对于每个测试案例，您将获得数值张量 $\\tilde{S}$ 和 $\\tilde{\\Omega}$（均为 $3 \\times 3$）以及一个滤波器宽度 $\\Delta$。使用以下不变量标量（每个都是 $\\tilde{S}$ 和 $\\tilde{\\Omega}$ 的标量函数）作为系数映射的输入：\n$$\n\\lambda_1 = \\operatorname{tr}(\\tilde{S}^2), \\quad\n\\lambda_2 = \\operatorname{tr}(\\tilde{\\Omega}^2), \\quad\n\\lambda_3 = \\operatorname{tr}(\\tilde{S}^3), \\quad\n\\lambda_4 = \\operatorname{tr}(\\tilde{\\Omega}^2 \\tilde{S}), \\quad\n\\lambda_5 = \\operatorname{tr}(\\tilde{\\Omega}^2 \\tilde{S}^2).\n$$\n\n构建以下客观、对称、无迹的张量基：\n$$\n\\mathbf{T}^{(1)} = \\operatorname{dev}(\\tilde{S}), \\quad\n\\mathbf{T}^{(2)} = \\tilde{S}\\tilde{\\Omega} - \\tilde{\\Omega}\\tilde{S}, \\quad\n\\mathbf{T}^{(3)} = \\operatorname{dev}(\\tilde{S}^2).\n$$\n\n将建模的偏SGS应力定义为\n$$\n\\boldsymbol{\\tau}'_{\\text{model}} = \\sum_{n=1}^{3} g_n(\\boldsymbol{\\lambda}) \\, \\mathbf{T}^{(n)},\n$$\n其中 $\\boldsymbol{\\lambda} = [\\lambda_1, \\lambda_2, \\lambda_3, \\lambda_4, \\lambda_5]^{\\top}$，系数 $g_n$ 由一个固定的双层神经映射产生：\n$$\n\\mathbf{h} = \\tanh\\!\\left( \\mathbf{W}_1 \\boldsymbol{\\lambda} + \\mathbf{b}_1 \\right), \\quad\n\\mathbf{g} = \\mathbf{W}_2 \\mathbf{h} + \\mathbf{b}_2,\n$$\n其中 $\\mathbf{g} = [g_1,g_2,g_3]^{\\top}$，$\\tanh(\\cdot)$ 逐元素应用。使用以下固定的权重和偏置：\n$$\n\\mathbf{W}_1 =\n\\begin{bmatrix}\n0.5  -0.3  0.2  0.1  -0.4 \\\\\n-0.1  0.2  0.5  -0.3  0.1 \\\\\n0.3  0.3  -0.2  0.4  0.2 \\\\\n-0.4  0.1  0.3  0.2  -0.1\n\\end{bmatrix}, \\quad\n\\mathbf{b}_1 =\n\\begin{bmatrix}\n0.05 \\\\ -0.02 \\\\ 0.01 \\\\ 0.03\n\\end{bmatrix},\n$$\n$$\n\\mathbf{W}_2 =\n\\begin{bmatrix}\n0.4  -0.2  0.1  0.3 \\\\\n-0.3  0.5  0.2  -0.1 \\\\\n0.2  0.1  -0.4  0.2\n\\end{bmatrix}, \\quad\n\\mathbf{b}_2 =\n\\begin{bmatrix}\n0.01 \\\\ -0.02 \\\\ 0.03\n\\end{bmatrix}.\n$$\n\n定义用于监督训练的 Smagorinsky 型目标偏应力为\n$$\n\\boldsymbol{\\tau}'_{\\text{target}} = - 2 \\, \\nu_t \\, \\operatorname{dev}(\\tilde{S}), \\quad\n\\nu_t = (C_s \\, \\Delta)^2 \\, \\lVert \\tilde{S} \\rVert, \\quad\n\\lVert \\tilde{S} \\rVert = \\sqrt{2 \\, \\tilde{S}:\\tilde{S}},\n$$\n其中 $C_s = 0.16$，冒号表示双点积 $\\mathbf{A}:\\mathbf{B} = \\sum_{i,j} A_{ij} B_{ij}$。\n\n对于每个测试案例，计算：\n- 数据损失\n$$\nL_{\\text{data}} = \\lVert \\boldsymbol{\\tau}'_{\\text{model}} - \\boldsymbol{\\tau}'_{\\text{target}} \\rVert_F^2,\n$$\n其中 $\\lVert \\cdot \\rVert_F$ 是弗罗贝尼乌斯范数。\n- 能量耗散率\n$$\n\\Pi = - \\boldsymbol{\\tau}'_{\\text{model}} : \\tilde{S},\n$$\n和耗散性惩罚\n$$\nL_{\\text{diss}} = \\max(0, -\\Pi)^2,\n$$\n该惩罚项惩罚反向散射（负 $\\Pi$）。\n- 一个受可实现性启发的量级界限，常数 $C_b = 0.5$，\n$$\nM = C_b \\, \\Delta^2 \\, (\\tilde{S}:\\tilde{S}), \\quad\nL_{\\text{mag}} = \\max\\!\\left( 0, \\lVert \\boldsymbol{\\tau}'_{\\text{model}} \\rVert_F - M \\right)^2.\n$$\n- 一个无迹性惩罚\n$$\nL_{\\text{tr}} = \\left( \\operatorname{tr}(\\boldsymbol{\\tau}'_{\\text{model}}) \\right)^2.\n$$\n\n将每个案例的总损失聚合为\n$$\nL_{\\text{total}} = L_{\\text{data}} + \\alpha \\, L_{\\text{diss}} + \\beta \\, L_{\\text{mag}} + \\gamma \\, L_{\\text{tr}},\n$$\n其中 $\\alpha = 10$, $\\beta = 1$, $\\gamma = 1$。\n\n使用以下包含四个案例的测试套件，每个案例提供 $\\tilde{S}$、$\\tilde{\\Omega}$ 和 $\\Delta$：\n- 案例 1（简单剪切流，$\\Delta = 1$）：\n$$\n\\tilde{S}_1 =\n\\begin{bmatrix}\n0.0  0.5  0.0 \\\\\n0.5  0.0  0.0 \\\\\n0.0  0.0  0.0\n\\end{bmatrix}, \\quad\n\\tilde{\\Omega}_1 =\n\\begin{bmatrix}\n0.0  0.0  0.0 \\\\\n0.0  0.0  0.0 \\\\\n0.0  0.0  0.0\n\\end{bmatrix}, \\quad\n\\Delta_1 = 1.0.\n$$\n- 案例 2（刚体旋转，$\\Delta = 1$）：\n$$\n\\tilde{S}_2 =\n\\begin{bmatrix}\n0.0  0.0  0.0 \\\\\n0.0  0.0  0.0 \\\\\n0.0  0.0  0.0\n\\end{bmatrix}, \\quad\n\\tilde{\\Omega}_2 =\n\\begin{bmatrix}\n0.0  -0.8  0.0 \\\\\n0.8  0.0  0.0 \\\\\n0.0  0.0  0.0\n\\end{bmatrix}, \\quad\n\\Delta_2 = 1.0.\n$$\n- 案例 3（混合应变与旋转，$\\Delta = 1$）：\n$$\n\\tilde{S}_3 =\n\\begin{bmatrix}\n0.5  0.2  0.0 \\\\\n0.2  -0.5  0.1 \\\\\n0.0  0.1  0.0\n\\end{bmatrix}, \\quad\n\\tilde{\\Omega}_3 =\n\\begin{bmatrix}\n0.0  -0.3  0.0 \\\\\n0.3  0.0  0.2 \\\\\n0.0  -0.2  0.0\n\\end{bmatrix}, \\quad\n\\Delta_3 = 1.0.\n$$\n- 案例 4（带弱旋转的平面拉伸，$\\Delta = 1$）：\n$$\n\\tilde{S}_4 =\n\\begin{bmatrix}\n0.3  0.0  0.0 \\\\\n0.0  -0.3  0.0 \\\\\n0.0  0.0  0.0\n\\end{bmatrix}, \\quad\n\\tilde{\\Omega}_4 =\n\\begin{bmatrix}\n0.0  -0.1  0.0 \\\\\n0.1  0.0  0.0 \\\\\n0.0  0.0  0.0\n\\end{bmatrix}, \\quad\n\\Delta_4 = 1.0.\n$$\n\n要求：\n- 实现指定的不变量计算、基构建、系数映射、模型应力、目标应力以及所有惩罚项。\n- 对于每个案例，计算 $L_{\\text{total}}$ 作为一个浮点数。\n- 最终输出格式：您的程序应生成一行输出，其中包含四个 $L_{\\text{total}}$ 值，按案例 1 到 4 的顺序排列，形式为逗号分隔的列表，并用方括号括起来，每个值精确到 $8$ 位小数（例如，$[0.12345678,0.00000000,1.23456789,0.98765432]$）。\n- 所有量均为无量纲；不需要物理单位。不使用角度，也无须表示百分比。\n\n您的解决方案必须是一个完整的、可运行的程序，能够为所提供的测试套件生成包含计算损失的指定单行输出。",
            "solution": "该问题被评估为有效。这是一个适定的、有科学依据的计算问题，其根源在于大涡模拟（LES）的湍流建模原理。所有必需的数据、定义和参数均已提供，计算步骤逻辑一致且明确。该问题可直接进入求解阶段。\n\n目标是实现一个特定的、受约束的、数据驱动的亚格子尺度（SGS）应力模型，并针对几个典型的流动案例评估其性能（以复合损失函数衡量）。该模型的公式基于伽利略不变性原理，该原理规定SGS应力的本构关系必须独立于观察者的参考系。通过将模型构建为局部滤波速度梯度张量的张量多项式，其中多项式的标量系数是流场标量不变量的函数，可以系统地实现这一点。\n\n首先，我们定义从滤波速度场 $\\tilde{u}$ 导出的基本张量。它们是对称的滤波应变率张量 $\\tilde{S} = \\frac{1}{2} \\left( \\nabla \\tilde{u} + \\nabla \\tilde{u}^{\\top} \\right)$ 和反对称的滤波旋转率张量 $\\tilde{\\Omega} = \\frac{1}{2} \\left( \\nabla \\tilde{u} - \\nabla \\tilde{u}^{\\top} \\right)$。对于不可压缩流，连续性方程 $\\nabla \\cdot \\tilde{u} = 0$ 意味着应变率张量是无迹的，即 $\\operatorname{tr}(\\tilde{S}) = 0$。\n\n模型系数由一个以一组标量不变量为输入的神经网络确定。这些不变量记为 $\\boldsymbol{\\lambda} = [\\lambda_1, \\lambda_2, \\lambda_3, \\lambda_4, \\lambda_5]^{\\top}$，由 $\\tilde{S}$ 和 $\\tilde{\\Omega}$ 的乘积构成，并保证是客观的。它们的定义如下：\n$$\n\\lambda_1 = \\operatorname{tr}(\\tilde{S}^2), \\quad\n\\lambda_2 = \\operatorname{tr}(\\tilde{\\Omega}^2), \\quad\n\\lambda_3 = \\operatorname{tr}(\\tilde{S}^3), \\quad\n\\lambda_4 = \\operatorname{tr}(\\tilde{\\Omega}^2 \\tilde{S}), \\quad\n\\lambda_5 = \\operatorname{tr}(\\tilde{\\Omega}^2 \\tilde{S}^2).\n$$\n\n建模的偏SGS应力 $\\boldsymbol{\\tau}'_{\\text{model}}$ 表示为一个由客观、对称、无迹的张量 $\\mathbf{T}^{(n)}$ 构成的基的线性组合：\n$$\n\\boldsymbol{\\tau}'_{\\text{model}} = \\sum_{n=1}^{3} g_n(\\boldsymbol{\\lambda}) \\, \\mathbf{T}^{(n)}.\n$$\n指定的张量基为：\n$$\n\\mathbf{T}^{(1)} = \\operatorname{dev}(\\tilde{S}), \\quad\n\\mathbf{T}^{(2)} = \\tilde{S}\\tilde{\\Omega} - \\tilde{\\Omega}\\tilde{S}, \\quad\n\\mathbf{T}^{(3)} = \\operatorname{dev}(\\tilde{S}^2).\n$$\n这里，偏张量算子 $\\operatorname{dev}(\\mathbf{A}) = \\mathbf{A} - \\frac{1}{3} \\operatorname{tr}(\\mathbf{A}) \\mathbf{I}$ 确保 $\\mathbf{T}^{(1)}$ 和 $\\mathbf{T}^{(3)}$ 是无迹的。由于给定 $\\operatorname{tr}(\\tilde{S}) = 0$，$\\mathbf{T}^{(1)}$ 简化为 $\\tilde{S}$。张量 $\\mathbf{T}^{(2)}$ 是一个对称张量和一个反对称张量的交换子，其构造也保证了它是对称且无迹的。系数 $\\mathbf{g} = [g_1, g_2, g_3]^{\\top}$ 是一个双层前馈神经网络的输出，其隐藏层使用 $\\tanh$ 激活函数：\n$$\n\\mathbf{h} = \\tanh\\!\\left( \\mathbf{W}_1 \\boldsymbol{\\lambda} + \\mathbf{b}_1 \\right), \\quad\n\\mathbf{g} = \\mathbf{W}_2 \\mathbf{h} + \\mathbf{b}_2.\n$$\n权重 $\\mathbf{W}_1, \\mathbf{W}_2$ 和偏置 $\\mathbf{b}_1, \\mathbf{b}_2$ 作为固定常数提供。\n\n该模型与一个由经典 Smagorinsky 模型推导出的目标应力 $\\boldsymbol{\\tau}'_{\\text{target}}$ 进行评估。该目标定义为：\n$$\n\\boldsymbol{\\tau}'_{\\text{target}} = - 2 \\, \\nu_t \\, \\operatorname{dev}(\\tilde{S}), \\quad \\text{其中} \\quad \\nu_t = (C_s \\, \\Delta)^2 \\, \\lVert \\tilde{S} \\rVert.\n$$\n涡粘性 $\\nu_t$ 取决于滤波器宽度 $\\Delta$、Smagorinsky 常数 $C_s = 0.16$ 以及应变率的标量大小，定义为 $\\lVert \\tilde{S} \\rVert = \\sqrt{2 \\, \\tilde{S}:\\tilde{S}}$。冒号表示法 $\\mathbf{A}:\\mathbf{B} = \\sum_{i,j} A_{ij} B_{ij}$ 代表双点积，等价于 $\\operatorname{tr}(\\mathbf{A}^{\\top}\\mathbf{B})$。\n\n总损失 $L_{\\text{total}}$ 是四个分量的加权和，旨在强制实现理想的物理和数学属性：\n$$\nL_{\\text{total}} = L_{\\text{data}} + \\alpha \\, L_{\\text{diss}} + \\beta \\, L_{\\text{mag}} + \\gamma \\, L_{\\text{tr}}.\n$$\n这些分量是：\n1.  **数据损失** $L_{\\text{data}} = \\lVert \\boldsymbol{\\tau}'_{\\text{model}} - \\boldsymbol{\\tau}'_{\\text{target}} \\rVert_F^2$：这是一个标准的均方误差项，通过弗罗贝尼乌斯范数的平方来量化，它驱动模型去匹配 Smagorinsky 目标。\n2.  **耗散性惩罚** $L_{\\text{diss}} = \\max(0, -\\Pi)^2$：该项惩罚非耗散行为。SGS 耗散率为 $\\Pi = - \\boldsymbol{\\tau}'_{\\text{model}} : \\tilde{S}$。$\\Pi$ 的负值对应于“反向散射”，即能量从亚格子尺度向解析尺度的传递，这种情况应当受到限制。\n3.  **量级惩罚** $L_{\\text{mag}} = \\max\\!\\left( 0, \\lVert \\boldsymbol{\\tau}'_{\\text{model}} \\rVert_F - M \\right)^2$：这强制对 SGS 应力的大小施加一个基于可实现性的界限。该界限为 $M = C_b \\, \\Delta^2 \\, (\\tilde{S}:\\tilde{S})$，其中 $C_b = 0.5$。\n4.  **无迹性惩罚** $L_{\\text{tr}} = \\left( \\operatorname{tr}(\\boldsymbol{\\tau}'_{\\text{model}}) \\right)^2$：该项惩罚模型应力中任何非零的迹。通过使用无迹基的构造，该项在解析上应为零，但在通用的数值实现中，它是一个关键的约束。\n\n惩罚权重指定为 $\\alpha = 10$, $\\beta = 1$, $\\gamma = 1$。\n\n每个测试案例的计算流程如下：\n1.  给定输入张量 $\\tilde{S}$ 和 $\\tilde{\\Omega}$ 以及滤波器宽度 $\\Delta$。\n2.  计算五个标量不变量 $\\lambda_1, \\ldots, \\lambda_5$。\n3.  构造三个基张量 $\\mathbf{T}^{(1)}, \\mathbf{T}^{(2)}, \\mathbf{T}^{(3)}$。\n4.  使用不变量向量 $\\boldsymbol{\\lambda}$ 通过神经网络进行前向传播，以获得系数 $g_1, g_2, g_3$。\n5.  组装模型应力 $\\boldsymbol{\\tau}'_{\\text{model}}$。\n6.  计算目标应力 $\\boldsymbol{\\tau}'_{\\text{target}}$。\n7.  计算四个损失分量（$L_\\text{data}$, $L_\\text{diss}$, $L_\\text{mag}$, $L_\\text{tr}$）。\n8.  使用给定的权重组合损失，以求得总损失 $L_{\\text{total}}$。对所有提供的测试案例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and evaluates a constrained machine-learned SGS stress model for LES.\n    \"\"\"\n    # Define constants and model parameters\n    Cs = 0.16\n    Cb = 0.5\n    alpha = 10.0\n    beta = 1.0\n    gamma = 1.0\n\n    W1 = np.array([\n        [0.5, -0.3, 0.2, 0.1, -0.4],\n        [-0.1, 0.2, 0.5, -0.3, 0.1],\n        [0.3, 0.3, -0.2, 0.4, 0.2],\n        [-0.4, 0.1, 0.3, 0.2, -0.1]\n    ])\n    b1 = np.array([0.05, -0.02, 0.01, 0.03])\n\n    W2 = np.array([\n        [0.4, -0.2, 0.1, 0.3],\n        [-0.3, 0.5, 0.2, -0.1],\n        [0.2, 0.1, -0.4, 0.2]\n    ])\n    b2 = np.array([0.01, -0.02, 0.03])\n\n    # Define the test suite of four cases\n    test_cases = [\n        {\n            \"S\": np.array([[0.0, 0.5, 0.0], [0.5, 0.0, 0.0], [0.0, 0.0, 0.0]]),\n            \"Omega\": np.array([[0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0]]),\n            \"Delta\": 1.0\n        },\n        {\n            \"S\": np.array([[0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0]]),\n            \"Omega\": np.array([[0.0, -0.8, 0.0], [0.8, 0.0, 0.0], [0.0, 0.0, 0.0]]),\n            \"Delta\": 1.0\n        },\n        {\n            \"S\": np.array([[0.5, 0.2, 0.0], [0.2, -0.5, 0.1], [0.0, 0.1, 0.0]]),\n            \"Omega\": np.array([[0.0, -0.3, 0.0], [0.3, 0.0, 0.2], [0.0, -0.2, 0.0]]),\n            \"Delta\": 1.0\n        },\n        {\n            \"S\": np.array([[0.3, 0.0, 0.0], [0.0, -0.3, 0.0], [0.0, 0.0, 0.0]]),\n            \"Omega\": np.array([[0.0, -0.1, 0.0], [0.1, 0.0, 0.0], [0.0, 0.0, 0.0]]),\n            \"Delta\": 1.0\n        }\n    ]\n\n    results = []\n\n    def dev(A):\n        \"\"\"Computes the deviatoric part of a tensor.\"\"\"\n        return A - (1.0 / 3.0) * np.trace(A) * np.eye(3)\n\n    for case in test_cases:\n        S = case[\"S\"]\n        Omega = case[\"Omega\"]\n        Delta = case[\"Delta\"]\n\n        # Step 1: Calculate scalar invariants\n        S2 = S @ S\n        S3 = S2 @ S\n        Omega2 = Omega @ Omega\n        Omega2S = Omega2 @ S\n        Omega2S2 = Omega2 @ S2\n\n        lambda1 = np.trace(S2)\n        lambda2 = np.trace(Omega2)\n        lambda3 = np.trace(S3)\n        lambda4 = np.trace(Omega2S)\n        lambda5 = np.trace(Omega2S2)\n        \n        lambda_vec = np.array([lambda1, lambda2, lambda3, lambda4, lambda5])\n\n        # Step 2: Construct the objective, symmetric, traceless tensor basis\n        T1 = dev(S)  # Given tr(S)=0, this is simply S\n        T2 = S @ Omega - Omega @ S\n        T3 = dev(S2)\n\n        # Step 3: Calculate coefficients via the neural mapping\n        h = np.tanh(W1 @ lambda_vec + b1)\n        g = W2 @ h + b2\n\n        # Step 4: Assemble the modeled deviatoric SGS stress\n        tau_model = g[0] * T1 + g[1] * T2 + g[2] * T3\n\n        # Step 5: Compute the Smagorinsky-type target deviatoric stress\n        s_norm_mag = np.sqrt(2 * lambda1)\n        nu_t = (Cs * Delta)**2 * s_norm_mag\n        tau_target = -2 * nu_t * dev(S) # Again, dev(S) simplifies to S\n\n        # Step 6: Compute the loss components\n        # Data loss\n        L_data = np.linalg.norm(tau_model - tau_target, 'fro')**2\n\n        # Dissipativity penalty\n        Pi = -np.sum(tau_model * S)  # This is -tau_model : S\n        L_diss = np.maximum(0, -Pi)**2\n\n        # Magnitude penalty\n        S_ddot_S = lambda1\n        M = Cb * Delta**2 * S_ddot_S\n        L_mag = np.maximum(0, np.linalg.norm(tau_model, 'fro') - M)**2\n\n        # Tracelessness penalty\n        L_tr = np.trace(tau_model)**2\n\n        # Step 7: Aggregate the per-case total loss\n        L_total = L_data + alpha * L_diss + beta * L_mag + gamma * L_tr\n        results.append(L_total)\n\n    # Final print statement in the exact required format\n    formatted_results = [f\"{r:.8f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the solver\nsolve()\n```"
        }
    ]
}