{
    "hands_on_practices": [
        {
            "introduction": "雷诺应力张量 $R_{ij} = \\overline{u_i' u_j'}$ 并非纯粹的数学抽象，它代表了真实的物理统计量。一个至关重要且不可违背的特性是“可实现性”（realizability），它要求该张量必须是半正定的，以确保任何方向上的湍流正应力都是非负的。这项动手实践  通过分析一个违反该约束的假设性湍流模型，揭示了这一基本约束的重要性，你将看到该模型如何导出一个非物理的预测——一个负的脉动速度均方值。",
            "id": "3357813",
            "problem": "考虑一个由雷诺平均纳维-斯托克斯（RANS）方程控制的不可压缩湍流。设瞬时速度通过雷诺分解为 $u_{i} = U_{i} + u_{i}'$，其中 $U_{i}$ 是平均速度，$u_{i}'$ 是脉动速度。雷诺应力张量定义为 $R_{ij} = \\overline{u_{i}' u_{j}'}$，湍动能定义为 $k = \\frac{1}{2} R_{ii}$。雷诺应力各向异性张量定义为 $b_{ij} = \\frac{R_{ij}}{2k} - \\frac{1}{3} \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克（Kronecker）δ函数。\n\n从 $R_{ij}$ 的协方差结构可知，可实现性（realizability）要求对于任意单位向量 $a_{i}$，二次型 $a_{i} R_{ij} a_{j}$ 必须为非负，因为它等于脉动速度沿 $a_{i}$ 的标量投影的均方值。在本问题中，你将构建一个违反此可实现性的假设性封闭模型。\n\n假设有人为各向异性提出了以下假设性封闭模型：\n$$\nb_{ij} = -\\gamma\\, \\delta_{ij},\n$$\n其中 $\\gamma  0$ 是一个常数。那么，建模拟合的雷诺应力为\n$$\nR_{ij} = 2k\\, b_{ij} + \\frac{2}{3}k\\, \\delta_{ij}.\n$$\n假设 $k  0$，并令单位向量为 $a_{i} = (1,0,0)$，因此有 $a_{i} a_{j} \\delta_{ij} = 1$ 和 $a_{i} a_{j} b_{ij} = b_{11}$。\n\n仅使用上述定义和 $a_{i} R_{ij} a_{j}$ 代表一个均方值的要求，首先证明为什么可实现性要求对于任何单位向量 $a_{i}$ 都有 $a_{i} R_{ij} a_{j} \\ge 0$。然后，对于 $\\gamma = \\frac{1}{2}$ 的特定假设性封闭模型，计算无量纲量\n$$\nr \\equiv \\frac{a_{i} R_{ij} a_{j}}{k}\n$$\n对于所选的 $a_{i} = (1,0,0)$，并明确证明该值违反了可实现性。将最终答案表示为不带单位的纯数 $r$。",
            "solution": "该问题陈述经核实具有科学依据、提法恰当且客观。这是湍流模型领域中一个标准的教学练习，用以演示可实现性的概念。所有必要信息均已提供，任务定义明确。\n\n该问题要求完成三项内容：首先，证明可实现性条件的合理性；其次，为一个假设的湍流模型计算一个特定的无量纲量；第三，证明该模型违反了可实现性。\n\n首先，我们来证明可实现性条件的合理性，该条件指出对于任意单位向量 $a_{i}$，二次型 $a_{i} R_{ij} a_{j}$ 必须为非负。雷诺应力张量 $R_{ij}$ 定义为速度脉动乘积的时间平均值，$R_{ij} = \\overline{u_{i}' u_{j}'}$。设 $a_{i}$ 为一个代表特定空间方向的常数单位向量。那么该二次型为：\n$$\na_{i} R_{ij} a_{j} = a_{i} (\\overline{u_{i}' u_{j}'}) a_{j}\n$$\n由于平均算子是线性的，并且 $a_{i}$ 的分量是常数，我们可以将它们移到平均号内部：\n$$\na_{i} R_{ij} a_{j} = \\overline{(a_{i} u_{i}') (a_{j} u_{j}')}\n$$\n我们定义一个标量 $v'$，作为脉动速度向量 $u_{k}'$ 在单位向量 $a_{k}$ 指定方向上的标量投影。使用指标记法，即为 $v' = a_{k} u_{k}'$。于是，上述表达式可以改写为：\n$$\na_{i} R_{ij} a_{j} = \\overline{(v')^2}\n$$\n这个量 $\\overline{(v')^2}$ 代表了在 $a_{i}$ 方向上脉动速度分量的均方值。作为一个实数平方的时间平均值，它必须是非负的。因此，任何物理上真实的雷诺应力张量都必须满足对于任意单位向量 $a_{i}$，条件 $a_{i} R_{ij} a_{j} \\ge 0$ 成立。这个性质被称为可实现性。\n\n其次，我们为指定的假设性封闭模型计算无量纲量 $r \\equiv \\frac{a_{i} R_{ij} a_{j}}{k}$。问题给出了建模拟合的雷诺应力张量为：\n$$\nR_{ij} = 2k\\, b_{ij} + \\frac{2}{3}k\\, \\delta_{ij}\n$$\n其中各向异性张量 $b_{ij}$ 由以下假设性封闭模型给出：\n$$\nb_{ij} = -\\gamma\\, \\delta_{ij}\n$$\n其中常数 $\\gamma = \\frac{1}{2}$。我们将 $R_{ij}$ 的表达式代入 $r$ 的定义中：\n$$\nr = \\frac{a_{i} \\left( 2k\\, b_{ij} + \\frac{2}{3}k\\, \\delta_{ij} \\right) a_{j}}{k}\n$$\n已知湍动能 $k$ 是一个标量且 $k  0$，我们可以将其从分子中提出并与分母相消：\n$$\nr = a_{i} \\left( 2\\, b_{ij} + \\frac{2}{3}\\, \\delta_{ij} \\right) a_{j} = 2 a_{i} b_{ij} a_{j} + \\frac{2}{3} a_{i} \\delta_{ij} a_{j}\n$$\n现在，我们代入 $b_{ij}$ 的假设性封闭模型：\n$$\nr = 2 a_{i} (-\\gamma\\, \\delta_{ij}) a_{j} + \\frac{2}{3} a_{i} \\delta_{ij} a_{j}\n$$\n提出公因式 $a_{i} \\delta_{ij} a_{j}$：\n$$\nr = \\left( -2\\gamma + \\frac{2}{3} \\right) (a_{i} \\delta_{ij} a_{j})\n$$\n项 $a_{i} \\delta_{ij} a_{j}$ 可简化为 $a_{i} a_{i}$，即向量 $a_{i}$ 的模的平方。由于 $a_{i}$ 是单位向量，其模为 $1$，其模的平方也为 $1$。问题通过陈述 $a_{i} a_{j} \\delta_{ij} = 1$ 确认了对于特定选择 $a_{i} = (1,0,0)$ 的情况。因此，$r$ 的表达式简化为：\n$$\nr = -2\\gamma + \\frac{2}{3}\n$$\n问题指定了值 $\\gamma = \\frac{1}{2}$。代入此值：\n$$\nr = -2 \\left(\\frac{1}{2}\\right) + \\frac{2}{3} = -1 + \\frac{2}{3} = -\\frac{1}{3}\n$$\n\n第三，我们证明这个结果违反了可实现性。可实现性条件为 $a_{i} R_{ij} a_{j} \\ge 0$。由于给定 $k  0$，此条件等价于要求无量纲量 $r = \\frac{a_{i} R_{ij} a_{j}}{k}$ 为非负，即 $r \\ge 0$。我们对 $\\gamma = \\frac{1}{2}$ 的假设模型的计算得出的结果是 $r = -\\frac{1}{3}$。由于 $-\\frac{1}{3}  0$，非负性条件被违反。这明确地证明了所提出的封闭模型 $b_{ij} = -\\gamma\\, \\delta_{ij}$ 在 $\\gamma = \\frac{1}{2}$ 时是不符合物理实际的，因为它导致了负的脉动速度分量均方值，而这是不可能的。",
            "answer": "$$\\boxed{-\\frac{1}{3}}$$"
        },
        {
            "introduction": "平均流与湍流之间的相互作用通常被概念化为一个单向过程，即动能从大尺度的平均运动传递到小尺度的湍流涡旋中，这一过程由动能收支方程中的湍流生成项控制。这项实践  首先要求你从第一性原理出发推导出这个关键项，然后通过一个计算实验来探索其行为，其中包括“逆梯度”输运的情况，此时能量会反向流回平均流，这是基本 RANS 模型无法捕捉的一种现象。",
            "id": "3357831",
            "problem": "考虑一种遵循基本动量平衡和质量守恒定律的、密度恒定、不可压缩的牛顿流体。您必须从以下基本方程出发：\n\n- 不可压缩连续性方程：$\\partial_i u_i = 0$。\n- 牛顿动量方程：$\\partial_t u_i + u_j \\partial_j u_i = -\\frac{1}{\\rho} \\partial_i p + \\nu \\partial_j \\partial_j u_i + f_i$，其中 $\\rho$ 是密度，$\\nu$ 是运动粘度，而 $f_i$ 是单位质量的体积力。\n\n任务 A (推导)：应用雷诺分解 $u_i = \\bar{u}_i + u_i'$ 和 $p = \\bar{p} + p'$ 以及满足雷诺法则的平均算子，推导雷诺平均纳维-斯托克斯 (RANS) 系统中平均流的平均动能方程。您的推导必须从上述基本方程出发，且仅使用与不可压缩性一致的、数学上有效的操作和恒等式。请识别出在平均场和湍流脉动之间传递动能的项，并用该项与平均速度梯度的无坐标张量缩并形式来表示。请勿使用任何快捷公式；您的推导必须从第一性原理出发。\n\n任务 B (受控实验与计算)：设计一个受控的、空间均匀的实验，在实验中，通过改变雷诺应力相对于平均速度梯度的符号，使任务 A 中的能量传递项改变符号。为确保数学上的具体性，将平均速度梯度表示为一个恒定张量 $G_{ij} = \\partial_j \\bar{u}_i$ (单位为 $\\mathrm{s}^{-1}$)，将雷诺应力表示为一个恒定对称张量 $R_{ij} = \\overline{u_i' u_j'}$ (单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$)。对于每种情况，单位质量的平均动能向湍流动能的瞬时传递率被定义为标量\n$$\nP \\equiv -\\sum_{i=1}^3 \\sum_{j=1}^3 R_{ij} \\, G_{ij},\n$$\n单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$。\n\n此外，为评估一种常见的模型响应，请计算 Boussinesq 涡粘性闭合的预测值。该闭合假设 $R_{ij}^{\\text{model}} \\approx -2 \\nu_t S_{ij}$，其中 $S_{ij} \\equiv \\tfrac{1}{2}(G_{ij}+G_{ji})$ 是平均应变率张量，$\\nu_t \\ge 0$ 是一个标量涡粘性系数。对于给定的 $(R_{ij},G_{ij})$，定义最小二乘最佳拟合涡粘性系数\n$$\n\\nu_t^\\star \\equiv -\\frac{\\sum_{i,j} R_{ij}\\, S_{ij}}{2 \\sum_{i,j} S_{ij}\\, S_{ij}},\n$$\n并将模型约束为 $\\nu_t = \\max(0,\\nu_t^\\star)$。相应的模型化传递率则为\n$$\nP_{\\text{model}} \\equiv 2 \\nu_t \\sum_{i,j} S_{ij}\\, S_{ij}.\n$$\n\n您必须实现一个程序，为每个测试用例计算数对 $(P, P_{\\text{model}})$ 和一个布尔标志，该标志指示 $P$ 是否为负（相对于典型的正向平均-湍流能量传递，符号发生了改变）。所有计算出的传递率必须以 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$ 为单位表示，并四舍五入到六位小数。\n\n测试套件：使用以下五个科学上合理的案例（所有张量均为 $3 \\times 3$，其分量采用国际单位制）：\n\n- 案例 1 (典型平面剪切，正向传递)：\n$$G = \\begin{bmatrix} 0  5  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{s}^{-1}, \\quad R = \\begin{bmatrix} 0  -0.02  0 \\\\ -0.02  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}$$\n- 案例 2 (逆梯度，负向传递)：\n$$G = \\begin{bmatrix} 0  5  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{s}^{-1}, \\quad R = \\begin{bmatrix} 0  0.005  0 \\\\ 0.005  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}$$\n- 案例 3 (零剪切边界情况)：\n$$G = \\begin{bmatrix} 0  0  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{s}^{-1}, \\quad R = \\begin{bmatrix} 0  -0.01  0 \\\\ -0.01  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}$$\n- 案例 4 (具有各向异性应力的三维混合梯度)：\n$$G = \\begin{bmatrix} 0  4  0 \\\\ 2  0  -3 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{s}^{-1}, \\quad R = \\begin{bmatrix} 0.10  -0.03  0.00 \\\\ -0.03  0.08  0.01 \\\\ 0.00  0.01  0.05 \\end{bmatrix}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}$$\n- 案例 5 (与闭合模型一致的剪切，涡粘性系数已知)：$G = \\begin{bmatrix} 0  10  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{s}^{-1}$，已知涡粘性系数 $\\nu_t = 0.01\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$ 用于通过 $R = -2 \\nu_t S$ 定义 $R$，其中 $S = \\tfrac{1}{2}(G+G^\\top)$；具体为 $R = \\begin{bmatrix} 0  -0.10  0 \\\\ -0.10  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}$。\n\n答案规格和最终输出格式：您的程序必须生成单行输出，其中包含一个结果列表，每个测试用例对应一个结果。每个结果都是一个列表 `[P, P_model, is_negative]`，其中 $P$ 和 $P_{\\text{model}}$ 四舍五入到六位小数，`is_negative` 是一个布尔值，指示 $P  0$ 是否成立。总体输出必须是一个包含五个案例结果的单一列表，其格式严格为一个用方括号括起来的逗号分隔列表，例如\n`[[P_1, P_model,1, is_negative_1], [P_2, P_model,2, is_negative_2], ...]`，\n所有 $P$ 和 $P_{\\text{model}}$ 的单位均为 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$。",
            "solution": "我们从不可压缩质量守恒方程 $\\partial_i u_i = 0$ 和牛顿动量方程 $\\partial_t u_i + u_j \\partial_j u_i = -\\frac{1}{\\rho} \\partial_i p + \\nu \\partial_j \\partial_j u_i + f_i$ 出发。引入雷诺分解 $u_i = \\bar{u}_i + u_i'$ 和 $p = \\bar{p} + p'$，并应用满足雷诺法则的平均算子，例如 $\\overline{u_i'} = 0$、$\\overline{\\bar{u}_i} = \\bar{u}_i$、线性和（对于统计定常平均）与微分的可交换性。雷诺平均纳维-斯托克斯 (RANS) 的平均动量方程为\n$$\n\\partial_t \\bar{u}_i + \\bar{u}_j \\partial_j \\bar{u}_i = -\\frac{1}{\\rho} \\partial_i \\bar{p} + \\nu \\partial_j \\partial_j \\bar{u}_i - \\partial_j \\overline{u_i' u_j'} + \\bar{f}_i,\n$$\n其中 $\\partial_i \\bar{u}_i = 0$。\n\n为了推导平均动能方程，将平均动量方程乘以 $\\bar{u}_i$，并使用乘法法则和不可压缩性条件。定义单位质量的平均动能为 $K \\equiv \\tfrac{1}{2} \\bar{u}_i \\bar{u}_i$。时间导数项变为 $\\bar{u}_i \\partial_t \\bar{u}_i = \\partial_t K$。根据链式法则，平均对流项为 $\\bar{u}_i \\bar{u}_j \\partial_j \\bar{u}_i = \\bar{u}_j \\partial_j K$。由于 $\\partial_i \\bar{u}_i = 0$，压力功项可以组合成一个散度项：$\\bar{u}_i \\partial_i \\bar{p} = \\partial_i (\\bar{p}\\,\\bar{u}_i) - \\bar{p} \\partial_i \\bar{u}_i = \\partial_i (\\bar{p}\\,\\bar{u}_i)$。粘性功项可分解为一个类耗散项和一个散度项的和：$\\nu \\bar{u}_i \\partial_j \\partial_j \\bar{u}_i = \\nu \\partial_j (\\bar{u}_i \\partial_j \\bar{u}_i) - \\nu (\\partial_j \\bar{u}_i) (\\partial_j \\bar{u}_i)$。体积力功为 $\\bar{f}_i \\bar{u}_i$。根据乘法法则，雷诺应力输运项的贡献为 $\\bar{u}_i \\left(-\\partial_j \\overline{u_i' u_j'}\\right) = -\\partial_j(\\bar{u}_i \\overline{u_i' u_j'}) + \\overline{u_i' u_j'} \\partial_j \\bar{u}_i$。\n\n将各项整理成守恒形式，\n$$\n\\partial_t K + \\bar{u}_j \\partial_j K + \\partial_j\\left(\\frac{\\bar{p}}{\\rho}\\bar{u}_j + \\nu \\bar{u}_i \\partial_j \\bar{u}_i - \\bar{u}_i \\overline{u_i' u_j'}\\right)\n= -\\nu (\\partial_j \\bar{u}_i)(\\partial_j \\bar{u}_i) - \\overline{u_i' u_j'}\\,\\partial_j \\bar{u}_i + \\bar{f}_i \\bar{u}_i.\n$$\n此处，标量项 $-\\overline{u_i' u_j'}\\,\\partial_j \\bar{u}_i$ 在平均场和湍流场之间传递动能：当它为正时，平均动能损失（一个汇），湍流动能产生；当它为负时，湍流脉动将能量反馈给平均流（平均流的一个源）。因为雷诺应力张量 $R_{ij} \\equiv \\overline{u_i' u_j'}$ 是对称的，而平均速度梯度 $\\partial_j \\bar{u}_i$ 可以分解为对称的应变率张量 $S_{ij} \\equiv \\tfrac{1}{2}(\\partial_j \\bar{u}_i + \\partial_i \\bar{u}_j)$ 和反对称的旋转张量 $W_{ij} \\equiv \\tfrac{1}{2}(\\partial_j \\bar{u}_i - \\partial_i \\bar{u}_j)$，所以该缩并可简化为 $-\\overline{u_i' u_j'}\\,\\partial_j \\bar{u}_i = -R_{ij} S_{ij}$，因为 $R_{ij} W_{ij} = 0$。\n\n对于受控实验，我们选择空间均匀的 $G_{ij} \\equiv \\partial_j \\bar{u}_i$ 和 $R_{ij}$ 来构建五个测试用例。单位质量的传递率定义为\n$$\nP \\equiv -\\sum_{i=1}^3 \\sum_{j=1}^3 R_{ij}\\,G_{ij},\n$$\n单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$。为评估模型响应，采用 Boussinesq 涡粘性闭合来模拟雷诺应力，$R_{ij}^{\\text{model}} \\approx -2 \\nu_t S_{ij}$，其中 $S_{ij} = \\tfrac{1}{2}(G_{ij}+G_{ji})$ 且 $\\nu_t \\ge 0$。对于给定的 $(R,G)$，最小化 $\\|R + 2 \\nu_t S\\|_F^2$ 的标量 $\\nu_t^\\star$ 的最小二乘拟合得到\n$$\n\\nu_t^\\star = -\\frac{\\sum_{i,j} R_{ij} S_{ij}}{2 \\sum_{i,j} S_{ij} S_{ij}},\n$$\n约束模型 $\\nu_t = \\max(0,\\nu_t^\\star)$ 确保了模型化的产生项为非负。模型化的传递率为\n$$\nP_{\\text{model}} = 2 \\nu_t \\sum_{i,j} S_{ij} S_{ij}.\n$$\n\n五个测试用例如上所述，均采用国际单位制。每个案例的计算算法如下：\n\n- 计算 $P = -\\sum_{i,j} R_{ij} G_{ij}$。\n- 计算 $S = \\tfrac{1}{2}(G + G^\\top)$、弗罗贝尼乌斯范数的平方 $||S||_F^2 = \\sum_{i,j} S_{ij} S_{ij}$ 以及内积 $\\langle R,S \\rangle = \\sum_{i,j} R_{ij} S_{ij}$。\n- 如果 $||S||_F^2 = 0$，则设 $P_{\\text{model}} = 0$。否则，计算 $\\nu_t^\\star = -\\langle R,S\\rangle / (2 ||S||_F^2)$ 和 $\\nu_t = \\max(0,\\nu_t^\\star)$，然后计算 $P_{\\text{model}} = 2 \\nu_t ||S||_F^2$。\n- 如果 $P  0$，布尔标志 $\\text{is\\_negative}$ 为真。\n\n解释与物理合理性：在典型的剪切驱动湍流中，互相关 $R_{12} = \\overline{u' v'}$ 的符号通常与平均剪切 $G_{12} = \\partial_y \\bar{u}$ 相反，因此 $P$ 为正，表示能量从平均流向湍流传递。逆梯度动量输运可能发生在强旋转剪切流（例如，低绝对涡度）或具有强曲率或非局域历史效应的流中，导致 $R_{12}$ 与 $G_{12}$ 符号相同，使得 $P$ 为负。标量涡粘性 Boussinesq 闭合强制要求 $\\nu_t \\ge 0$，这意味着 $P_{\\text{model}} \\ge 0$，因此无法表示负的 $P$；在最小二乘拟合中，这表现为 $\\nu_t^\\star  0$ 的情况被截断为 0，从而在真实传递 $P$ 为负时，得到 $P_{\\text{model}} = 0$。具有零剪切的边界情况，$S_{ij} = 0$，此时 $P$ 和 $P_{\\text{model}}$ 均为 0，这与没有平均流到湍流的能量传递是一致的。\n\n最后，您的程序必须为指定的测试套件实现这些计算，并打印包含五个结果列表的单行输出，每个结果格式为 $[P, P_{\\text{model}}, \\text{is\\_negative}]$，其中 $P$ 和 $P_{\\text{model}}$ 四舍五入到六位小数，单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_production(R: np.ndarray, G: np.ndarray) - float:\n    \"\"\"\n    Compute mean-to-turbulence kinetic energy transfer rate:\n    P = - sum_{i,j} R_ij * G_ij\n    Units: m^2/s^3\n    \"\"\"\n    return float(-np.sum(R * G))\n\ndef compute_model_production(R: np.ndarray, G: np.ndarray) - float:\n    \"\"\"\n    Compute modeled transfer rate using Boussinesq eddy viscosity closure with\n    nonnegative least-squares best-fit nu_t.\n    S = 0.5 * (G + G^T)\n    nu_t* = -"
        },
        {
            "introduction": "最简单的 RANS 封闭模型，即线性涡粘模型，依赖于 Boussinesq 假设，该假设认为雷诺应力各向异性张量与平均应变率张量是线性相关的。尽管这很方便，但在复杂流动（如分离流或强曲率流）中，这一假设常常失效。这项练习  介绍了一种来自“先验”分析的强大诊断工具，要求你量化真实应力各向异性与应变率之间的错位，从而利用几何投影的概念来衡量涡粘假设的根本误差。",
            "id": "3357794",
            "problem": "考虑一个由雷诺平均纳维-斯托克斯方程描述的不可压缩湍流，其中雷诺分解产生一个平均速度场和湍流脉动。二阶湍流矩是雷诺应力张量，记为 $\\overline{u_i' u_j'}$，湍动能定义为 $k = \\tfrac{1}{2} \\overline{u_i' u_i'}$。各向异性张量定义为 $b_{ij} = \\overline{u_i' u_j'}/(2k) - \\delta_{ij}/3$，它是对称且无迹的。Boussinesq 涡粘性假设假定雷诺应力的偏量部分相对于平均应变率的主方向是各向同性的，从而给出一个形式为 $b_{ij}^{\\mathrm{EV}} = -(\\nu_t/k) S_{ij}$ 的模化各向异性，其中 $S_{ij} = \\tfrac{1}{2}(\\partial U_i/\\partial x_j + \\partial U_j/\\partial x_i)$ 是平均应变率张量，$\\nu_t$ 是一个标量湍流粘度。\n\n在非平衡分离流中，真实的各向异性可能与平均应变率不重合。量化各向同性假设所引入误差的一种方法是将真实的各向异性张量投影到由平均应变率张量张成的一维子空间上。将对称二阶张量空间视为具有 Frobenius 内积 $\\langle A, B\\rangle = A_{ij} B_{ij}$ 和范数 $\\|A\\|_F = \\sqrt{\\langle A, A\\rangle}$ 的空间。对于给定的雷诺应力张量 $\\overline{u_i' u_j'}$ 和应变率张量 $S_{ij}$，定义：\n- 真实各向异性 $b_{ij} = \\overline{u_i' u_j'}/(2k) - \\delta_{ij}/3$，其中 $k = \\tfrac{1}{2}\\overline{u_i' u_i'}$，\n- 最佳拟合涡粘性各向异性 $b_{ij}^{\\mathrm{fit}}$ 为 $b_{ij}$ 在 $S_{ij}$ 所张成的子空间上的正交投影，即 $b_{ij}^{\\mathrm{fit}} = \\operatorname*{arg\\,min}_{\\alpha \\in \\mathbb{R}} \\| b_{ij} - \\alpha S_{ij}\\|_F$，\n- 相对残差 $r = \\| b_{ij} - b_{ij}^{\\mathrm{fit}}\\|_F / \\|b_{ij}\\|_F$（如果 $\\|b_{ij}\\|_F = 0$，则定义 $r = 0$），\n- 余弦对齐度 $c = \\langle b_{ij}, S_{ij}\\rangle / (\\|b_{ij}\\|_F \\|S_{ij}\\|_F)$，约定当 $\\|b_{ij}\\|_F = 0$ 和 $\\|S_{ij}\\|_F = 0$ 同时成立时 $c = 1$，当这两个范数中只有一个为零时 $c = 0$。\n\n仅从这些定义以及雷诺平均纳维-斯托克斯方程和雷诺分解的基本结构出发，推导计算给定张量对 $(\\overline{u_i' u_j'}, S_{ij})$ 的 $r$ 和 $c$ 的算法，并将其实现为一个程序，该程序为代表非平衡分离流不同状态的一个小型测试套件输出误差度量。为此计算，所有量均应视为无量纲，输出中不应报告任何物理单位。\n\n使用以下对称张量测试套件，每个案例由一对 $(\\overline{u_i' u_j'}, S_{ij})$ 指定：\n\n- 案例 1（平衡对齐剪切，理想情况）：\n  $$ \\overline{u_i' u_j'} = \\begin{bmatrix} 1.0  -0.6  0.0 \\\\ -0.6  1.0  0.0 \\\\ 0.0  0.0  1.0 \\end{bmatrix}, \\quad S_{ij} = \\begin{bmatrix} 0.0  1.0  0.0 \\\\ 1.0  0.0  0.0 \\\\ 0.0  0.0  0.0 \\end{bmatrix} $$\n- 案例 2（非平衡分离类错位）：\n  $$ \\overline{u_i' u_j'} = \\begin{bmatrix} 2.2  0.2  -0.1 \\\\ 0.2  0.6  0.05 \\\\ -0.1  0.05  0.4 \\end{bmatrix}, \\quad S_{ij} = \\begin{bmatrix} 0.0  1.0  0.0 \\\\ 1.0  0.3  0.6 \\\\ 0.0  0.6  -0.3 \\end{bmatrix} $$\n- 案例 3（各向同性应力，零各向异性边缘案例）：\n  $$ \\overline{u_i' u_j'} = \\begin{bmatrix} 0.8  0.0  0.0 \\\\ 0.0  0.8  0.0 \\\\ 0.0  0.0  0.8 \\end{bmatrix}, \\quad S_{ij} = \\begin{bmatrix} 0.0  0.5  0.0 \\\\ 0.5  0.0  0.0 \\\\ 0.0  0.0  0.0 \\end{bmatrix} $$\n- 案例 4（零应变，不可约各向异性边缘案例）：\n  $$ \\overline{u_i' u_j'} = \\begin{bmatrix} 3.0  0.2  0.1 \\\\ 0.2  1.0  0.05 \\\\ 0.1  0.05  0.5 \\end{bmatrix}, \\quad S_{ij} = \\begin{bmatrix} 0.0  0.0  0.0 \\\\ 0.0  0.0  0.0 \\\\ 0.0  0.0  0.0 \\end{bmatrix} $$\n\n你的程序应针对每个案例计算如上定义的 $(r, c)$ 对，并生成一行输出，其中包含按案例顺序排列的、用方括号括起来的逗号分隔对列表。每个数字都应四舍五入到六位小数。例如，要求的格式是 `[[r1,c1],[r2,c2],[r3,c3],[r4,c4]]`，不带任何附加文本。",
            "solution": "该问题要求推导并实现一个算法，用于计算两个度量指标：相对残差 $r$ 和余弦对齐度 $c$。这两个指标量化了对于给定的湍流状态，Boussinesq 涡粘性假设的有效性。该状态由雷诺应力张量 $\\overline{u_i' u_j'}$ 和平均应变率张量 $S_{ij}$ 定义。\n\n首先，我们将必要的量形式化。所有张量都被视为 $3 \\times 3$ 实数矩阵向量空间的元素，该空间配备了 Frobenius 内积 $\\langle A, B\\rangle = A_{ij} B_{ij}$ 及其诱导范数 $\\|A\\|_F = \\sqrt{\\langle A, A\\rangle}$。\n\n湍动能 $k$ 是雷诺应力张量迹的一半：\n$$k = \\frac{1}{2} \\overline{u_i' u_i'} = \\frac{1}{2} \\operatorname{tr}(\\overline{u_i' u_j'})$$\n各向异性张量 $b_{ij}$ 定义为归一化雷诺应力张量的偏量部分：\n$$b_{ij} = \\frac{\\overline{u_i' u_j'}}{2k} - \\frac{1}{3}\\delta_{ij}$$\n其中 $\\delta_{ij}$ 是克罗内克 δ。根据构造，$b_{ij}$ 是一个对称且无迹的张量。这在 $k \\neq 0$ 的情况下成立。如果 $k=0$，雷诺应力张量 $\\overline{u_i' u_j'}$ 必须是零张量，因为其对角线元素（即方差）将为零。在这种情况下，湍流不存在，各向异性的概念也定义不清。然而，当 $k \\to 0$ 时，极限意味着 $b_{ij} \\to 0$，因此如果 $k=0$，我们可以认为 $b_{ij}$ 是零张量。\n\n问题的核心是找到与 $S_{ij}$ 成比例的 $b_{ij}$ 的最佳近似。这是一个正交投影问题。我们在由 $S_{ij}$ 张成的一维子空间中寻找最接近 $b_{ij}$ 的张量 $b_{ij}^{\\mathrm{fit}}$。这表示为：\n$$b_{ij}^{\\mathrm{fit}} = \\alpha S_{ij}$$\n其中 $\\alpha \\in \\mathbb{R}$ 是使残差的 Frobenius 范数平方 $\\|b_{ij} - \\alpha S_{ij}\\|_F^2$ 最小化的标量系数。我们定义目标函数 $L(\\alpha)$：\n$$L(\\alpha) = \\|b - \\alpha S\\|_F^2 = \\langle b - \\alpha S, b - \\alpha S \\rangle$$\n展开内积：\n$$L(\\alpha) = \\langle b, b \\rangle - 2\\alpha \\langle b, S \\rangle + \\alpha^2 \\langle S, S \\rangle = \\|b\\|_F^2 - 2\\alpha \\langle b, S \\rangle + \\alpha^2 \\|S\\|_F^2$$\n为了找到最小值，我们计算 $L(\\alpha)$ 关于 $\\alpha$ 的导数并将其设为零：\n$$\\frac{dL}{d\\alpha} = -2 \\langle b, S \\rangle + 2\\alpha \\|S\\|_F^2 = 0$$\n假设 $\\|S\\|_F^2 \\neq 0$，解出 $\\alpha$：\n$$\\alpha = \\frac{\\langle b, S \\rangle}{\\|S\\|_F^2}$$\n如果 $\\|S\\|_F = 0$，则 $S_{ij}$ 是零张量。由 $S_{ij}$ 张成的子空间只包含零张量，因此投影 $b_{ij}^{\\mathrm{fit}}$ 必须是零张量。\n\n余弦对齐度 $c$ 直接定义为向量空间中 $b_{ij}$ 和 $S_{ij}$ 之间夹角的余弦：\n$$c = \\frac{\\langle b, S \\rangle}{\\|b\\|_F \\|S\\|_F}$$\n问题为范数为零的情况提供了具体约定：\n1. 如果 $\\|b\\|_F = 0$ 且 $\\|S\\|_F = 0$，则 $c=1$。\n2. 如果 $\\|b\\|_F$ 或 $\\|S\\|_F$ 中只有一个为零，则 $c=0$。\n\n相对残差 $r$ 定义为：\n$$r = \\frac{\\| b - b^{\\mathrm{fit}}\\|_F}{\\|b\\|_F}$$\n并有特殊条件，即如果 $\\|b\\|_F=0$，则 $r=0$。\n根据构造，残差向量 $b - b^{\\mathrm{fit}}$ 与由 $S$ 张成的投影子空间正交。因此，它与 $b^{\\mathrm{fit}}$ 正交。根据该内积空间中的勾股定理，我们有：\n$$\\|b\\|_F^2 = \\|b^{\\mathrm{fit}}\\|_F^2 + \\|b - b^{\\mathrm{fit}}\\|_F^2$$\n因此，残差的范数平方为 $\\|b - b^{\\mathrm{fit}}\\|_F^2 = \\|b\\|_F^2 - \\|b^{\\mathrm{fit}}\\|_F^2$。\n我们可以用 $\\alpha$ 来表示 $\\|b^{\\mathrm{fit}}\\|_F^2$：\n$$\\|b^{\\mathrm{fit}}\\|_F^2 = \\|\\alpha S\\|_F^2 = \\alpha^2 \\|S\\|_F^2 = \\left(\\frac{\\langle b, S \\rangle}{\\|S\\|_F^2}\\right)^2 \\|S\\|_F^2 = \\frac{\\langle b, S \\rangle^2}{\\|S\\|_F^2}$$\n这在 $\\|S\\|_F \\neq 0$ 时有效。\n将其代入残差平方 $r^2$ 的表达式中：\n$$r^2 = \\frac{\\|b - b^{\\mathrm{fit}}\\|_F^2}{\\|b\\|_F^2} = \\frac{\\|b\\|_F^2 - \\|b^{\\mathrm{fit}}\\|_F^2}{\\|b\\|_F^2} = 1 - \\frac{\\|b^{\\mathrm{fit}}\\|_F^2}{\\|b\\|_F^2} = 1 - \\frac{\\langle b, S \\rangle^2}{\\|b\\|_F^2 \\|S\\|_F^2}$$\n认识到最后一项是余弦对齐度 $c$ 的平方，我们得到一个简单的关系：\n$$r^2 = 1 - c^2 \\implies r = \\sqrt{1 - c^2}$$\n此关系在 $\\|b\\|_F \\neq 0$ 时成立。让我们对照边缘案例进行验证。\n- 如果 $\\|b\\|_F \\neq 0$ 且 $\\|S\\|_F = 0$：$c$ 的定义给出 $c=0$。该公式给出 $r = \\sqrt{1-0^2}=1$。让我们根据 $r$ 的基本定义来检查这一点。如果 $\\|S\\|_F=0$，则 $b^{\\mathrm{fit}}=0$。残差为 $b-0=b$。因此 $r = \\|b\\|_F/\\|b\\|_F = 1$。公式成立。\n- 如果 $\\|b\\|_F = 0$：问题明确规定 $r=0$，因此我们必须直接使用这个定义。\n\n基于此分析，针对每一对 $(\\overline{u_i' u_j'}, S_{ij})$ 的算法如下：\n\n1.  计算湍动能：$k = \\frac{1}{2} \\operatorname{tr}(\\overline{u_i' u_j'})$。\n2.  如果 $k=0$，则 $\\overline{u_i' u_j'}$ 是零张量，这意味着 $b_{ij}$ 也是零张量。否则，计算各向异性张量：$b_{ij} = \\frac{\\overline{u_i' u_j'}}{2k} - \\frac{1}{3}\\delta_{ij}$。\n3.  计算 Frobenius 范数 $\\|b\\|_F$ 和 $\\|S\\|_F$。\n4.  根据提供的规则计算余弦对齐度 $c$：\n    - 如果 $\\|b\\|_F \\approx 0$ 且 $\\|S\\|_F \\approx 0$，设置 $c=1.0$。\n    - 如果 $\\|b\\|_F \\approx 0$ 或 $\\|S\\|_F \\approx 0$（但不是两者都成立），设置 $c=0.0$。\n    - 否则，计算内积 $\\langle b, S \\rangle = \\sum_{i,j} b_{ij}S_{ij}$ 并设置 $c = \\langle b, S \\rangle / (\\|b\\|_F \\|S\\|_F)$。\n5.  计算相对残差 $r$：\n    - 如果 $\\|b\\|_F \\approx 0$，设置 $r=0.0$。\n    - 否则，计算 $r = \\sqrt{1.0 - c^2}$。为防止数值问题（例如 `c` 略微超出 $[-1, 1]$），谨慎的做法是计算为 $r = \\sqrt{\\max(0, 1.0 - c^2)}$。\n\n该算法将被实现以处理给定的测试套件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error metrics (r, c) for a test suite of Reynolds stress\n    and mean strain-rate tensors.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: equilibrium-aligned shear\n        (\n            np.array([[1.0, -0.6, 0.0], [-0.6, 1.0, 0.0], [0.0, 0.0, 1.0]]),\n            np.array([[0.0, 1.0, 0.0], [1.0, 0.0, 0.0], [0.0, 0.0, 0.0]])\n        ),\n        # Case 2: non-equilibrium separated-like misalignment\n        (\n            np.array([[2.2, 0.2, -0.1], [0.2, 0.6, 0.05], [-0.1, 0.05, 0.4]]),\n            np.array([[0.0, 1.0, 0.0], [1.0, 0.3, 0.6], [0.0, 0.6, -0.3]])\n        ),\n        # Case 3: isotropic stress, edge case with zero anisotropy\n        (\n            np.array([[0.8, 0.0, 0.0], [0.0, 0.8, 0.0], [0.0, 0.0, 0.8]]),\n            np.array([[0.0, 0.5, 0.0], [0.5, 0.0, 0.0], [0.0, 0.0, 0.0]])\n        ),\n        # Case 4: zero strain, edge case with irreducible anisotropy\n        (\n            np.array([[3.0, 0.2, 0.1], [0.2, 1.0, 0.05], [0.1, 0.05, 0.5]]),\n            np.array([[0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0]])\n        )\n    ]\n\n    results = []\n    for R_stress, S_strain in test_cases:\n        r, c = calculate_metrics(R_stress, S_strain)\n        results.append(f\"[{r:.6f},{c:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_metrics(R, S):\n    \"\"\"\n    Calculates the relative residual error 'r' and cosine alignment 'c'.\n    \n    Args:\n        R (np.ndarray): The Reynolds stress tensor, u'_i u'_j.\n        S (np.ndarray): The mean rate-of-strain tensor, S_ij.\n        \n    Returns:\n        tuple[float, float]: A pair of floats (r, c).\n    \"\"\"\n    # 1. Calculate turbulent kinetic energy k\n    k = 0.5 * np.trace(R)\n\n    # 2. Calculate the anisotropy tensor b_ij\n    # Use a small tolerance to handle floating point comparisons\n    tol = 1e-12\n    if k  tol:\n        # If k is zero, Reynolds stress is zero, so anisotropy is zero.\n        b = np.zeros_like(R)\n    else:\n        I = np.identity(R.shape[0])\n        b = R / (2.0 * k) - I / 3.0\n\n    # 3. Compute Frobenius norms\n    norm_b = np.linalg.norm(b, 'fro')\n    norm_s = np.linalg.norm(S, 'fro')\n\n    # 4. Compute cosine alignment c based on problem's rules for edge cases\n    if norm_b  tol and norm_s  tol:\n        c = 1.0\n    elif norm_b  tol or norm_s  tol:\n        c = 0.0\n    else:\n        # Inner product is the sum of element-wise products\n        inner_prod = np.sum(b * S)\n        c = inner_prod / (norm_b * norm_s)\n\n    # 5. Compute relative residual error r\n    if norm_b  tol:\n        # Per problem definition, r=0 if ||b||=0\n        r = 0.0\n    else:\n        # Clamp c^2 to [0, 1] to avoid domain error with sqrt due to float precision\n        c_squared = max(0.0, min(1.0, c**2))\n        r = np.sqrt(1.0 - c_squared)\n\n    return r, c\n\nsolve()\n```"
        }
    ]
}