{
    "hands_on_practices": [
        {
            "introduction": "这项实践是实现雷诺平均纳维-斯托克斯（RANS）壁面处理的基石。我们将通过开发一个平衡壁面函数的数值计算器，从理论走向应用。本练习将要求您求解非线性的壁面律对数定律，以确定摩擦速度$u_{\\tau}$，这是将外部流动解与壁面物理条件联系起来的关键一步。掌握此方法后，您将能够计算出壁面剪切应力$\\tau_w$以及近壁湍动能$k_P$和耗散率$\\epsilon_P$等基本边界条件。",
            "id": "3391064",
            "problem": "您的任务是为雷诺平均纳维-斯托克斯 (RANS) 闭合模型在完全发展的湍流边界层中的第一个离壁点实现一个平衡壁面函数求解器。该模型必须仅由计算流体动力学 (CFD) 壁面处理中经过充分测试的关系式构成。请使用以下定义和经验关系作为基础：\n\n- 雷诺平均纳维-斯托克斯 (RANS)：一种湍流模拟方法，其中瞬时流变量被分解为平均部分和脉动部分，时间平均方程通过湍流模型进行封闭。\n- 摩擦速度 $u_{\\tau}$ 定义为 $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$，其中 $\\tau_w$ 是壁面剪切应力，$\\rho$ 是流体密度。\n- 在平衡对数区，平均速度的壁面律由下式给出：\n  $$U^+ = \\frac{1}{\\kappa}\\ln\\left(y^+\\right) + B,$$\n  其中 $U^+ = U_P/u_{\\tau}$，$y^+ = u_{\\tau} y_P/\\nu$，$\\kappa$ 是 von Kármán 常数，$B$ 是加法常数，$U_P$ 是近壁点 $P$ 处的平均速度，$y_P$ 是点 $P$ 到壁面的法向距离，$\\nu$ 是运动粘度。请使用自然对数。\n- 在用于 $k$–$\\epsilon$ 模型的高雷诺数平衡壁面函数框架中，将第一个离壁单元中心处的近壁值设定为：\n  $$k_P = \\frac{u_{\\tau}^2}{\\sqrt{C_{\\mu}}},\\qquad \\epsilon_P = \\frac{u_{\\tau}^3}{\\kappa\\, y_P},$$\n  其中 $k_P$ 是点 $P$ 处的湍动能，$\\epsilon_P$ 是湍动能的耗散率，$C_{\\mu}$ 是一个模型常数。\n\n您的任务是，对于每个测试用例，对对数律进行数值反演，以计算满足以下方程的唯一正值 $u_{\\tau}$：\n$$\\frac{U_P}{u_{\\tau}} = \\frac{1}{\\kappa}\\ln\\left(\\frac{u_{\\tau}\\, y_P}{\\nu}\\right) + B,$$\n然后使用上述关系式计算壁面剪切应力 $\\tau_w = \\rho\\, u_{\\tau}^2$ 以及 $k_P$ 和 $\\epsilon_P$。\n\n假设和常数：\n- 使用 $\\kappa = 0.41$ 和 $B = 5.2$。\n- 使用 $C_{\\mu} = 0.09$。\n- 仅使用具有物理意义的输入：$U_P  0$，$y_P  0$，$\\nu  0$，$\\rho  0$。\n- 使用自然对数底数 $e$。\n\n数值要求：\n- 通过对一个在 $u_{\\tau}  0$ 上严格单调的适定标量方程进行求根来求解 $u_{\\tau}$。使用稳健的区间法以确保所有测试用例都能收敛。解的计算必须达到严格的容差，以使最终报告的值至少精确到小数点后六位。\n\n单位和输出：\n- 所有输入均采用国际单位制 (SI)。要求的输出是：\n  - $u_{\\tau}$ 单位为 $\\mathrm{m/s}$，\n  - $\\tau_w$ 单位为 $\\mathrm{Pa}$，\n  - $k_P$ 单位为 $\\mathrm{m^2/s^2}$，\n  - $\\epsilon_P$ 单位为 $\\mathrm{m^2/s^3}$。\n- 将每个输出值表示为精确到小数点后六位的小数。\n\n测试套件：\n- 对所有用例使用 $\\kappa = 0.41$，$B = 5.2$ 和 $C_{\\mu} = 0.09$。\n- 用例 1：$U_P = 5\\,\\mathrm{m/s}$，$y_P = 0.5\\times 10^{-3}\\,\\mathrm{m}$，$\\nu = 1.0\\times 10^{-5}\\,\\mathrm{m^2/s}$，$\\rho = 1.225\\,\\mathrm{kg/m^3}$。\n- 用例 2：$U_P = 10\\,\\mathrm{m/s}$，$y_P = 1.0\\times 10^{-3}\\,\\mathrm{m}$，$\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^2/s}$，$\\rho = 1.225\\,\\mathrm{kg/m^3}$。\n- 用例 3：$U_P = 2\\,\\mathrm{m/s}$，$y_P = 2.0\\times 10^{-4}\\,\\mathrm{m}$，$\\nu = 1.0\\times 10^{-6}\\,\\mathrm{m^2/s}$，$\\rho = 1000.0\\,\\mathrm{kg/m^3}$。\n- 用例 4：$U_P = 50\\,\\mathrm{m/s}$，$y_P = 2.0\\times 10^{-3}\\,\\mathrm{m}$，$\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^2/s}$，$\\rho = 1.225\\,\\mathrm{kg/m^3}$。\n\n程序规范：\n- 您的程序必须为每个用例计算四元组 $\\left[u_{\\tau},\\ \\tau_w,\\ k_P,\\ \\epsilon_P\\right]$，顺序如上所示，单位如上指定，并且每个值都四舍五入到小数点后六位。\n- 您的程序应生成单行输出，其中包含所有用例的结果，形式为逗号分隔的列表，每个用例的结果本身是一个带方括号的逗号分隔列表，中间没有空格。例如：$\\texttt{[[a\\_1,b\\_1,c\\_1,d\\_1],[a\\_2,b\\_2,c\\_2,d\\_2],\\ldots]}$。",
            "solution": "该问题要求为雷诺平均纳维-斯托克斯 (RANS) 计算流体动力学 (CFD) 实现一个平衡壁面函数求解器。任务的核心是通过数值求解壁面律方程来确定摩擦速度 $u_{\\tau}$，并随后使用该值计算壁面剪切应力 $\\tau_w$、以及湍动能 $k_P$ 和其耗散率 $\\epsilon_P$ 的近壁值。\n\n待求解的基本关系是对数壁面律，这是一个代数方程，它将距壁面距离为 $y_P$ 处的平均速度 $U_P$ 与摩擦速度 $u_{\\tau}$ 联系起来：\n$$ \\frac{U_P}{u_{\\tau}} = \\frac{1}{\\kappa}\\ln\\left(\\frac{u_{\\tau}\\, y_P}{\\nu}\\right) + B $$\n这里，$\\kappa$ 是 von Kármán 常数，$B$ 是对数层加法常数，$\\nu$ 是流体的运动粘度。这是一个关于未知数 $u_{\\tau}$ 的超越方程。\n\n为了数值求解该方程，我们定义一个函数 $f(u_{\\tau})$，其根对应于方程的解。该函数通过对方程进行重排得到：\n$$ f(u_{\\tau}) = \\frac{U_P}{u_{\\tau}} - \\frac{1}{\\kappa}\\ln\\left(\\frac{u_{\\tau}\\, y_P}{\\nu}\\right) - B $$\n我们寻求使 $f(u_{\\tau}) = 0$ 的值 $u_{\\tau}  0$。物理约束条件为 $U_P  0$，$y_P  0$，$\\nu  0$，$\\kappa  0$，并且所期望的解 $u_{\\tau}$也必须是正数。\n\n为确保唯一解的存在并为数值求解器的选择提供依据，我们分析函数 $f(u_{\\tau})$ 在其定义域 $u_{\\tau} \\in (0, \\infty)$ 上的性质。我们首先计算 $f(u_{\\tau})$ 关于 $u_{\\tau}$ 的导数：\n$$ f'(u_{\\tau}) = \\frac{d}{du_{\\tau}}\\left( U_P u_{\\tau}^{-1} - \\frac{1}{\\kappa}\\ln(u_{\\tau}) - \\frac{1}{\\kappa}\\ln\\left(\\frac{y_P}{\\nu}\\right) - B \\right) $$\n$$ f'(u_{\\tau}) = -U_P u_{\\tau}^{-2} - \\frac{1}{\\kappa u_{\\tau}} $$\n由于 $U_P$、$\\kappa$ 和 $u_{\\tau}$ 均为正数，导数中的两项都是负数。因此，对于所有 $u_{\\tau}  0$，$f'(u_{\\tau})  0$。这证明了 $f(u_{\\tau})$ 在其整个定义域上是一个严格单调递减函数。\n\n接下来，我们考察 $f(u_{\\tau})$ 在其定义域边界处的行为：\n- 当 $u_{\\tau} \\to 0^+$ 时，项 $U_P/u_{\\tau} \\to +\\infty$，项 $-\\frac{1}{\\kappa}\\ln(u_{\\tau}) \\to +\\infty$。因此，$\\lim_{u_{\\tau} \\to 0^+} f(u_{\\tau}) = +\\infty$。\n- 当 $u_{\\tau} \\to \\infty$ 时，项 $U_P/u_{\\tau} \\to 0$，项 $-\\frac{1}{\\kappa}\\ln(u_{\\tau}) \\to -\\infty$。因此，$\\lim_{u_{\\tau} \\to \\infty} f(u_{\\tau}) = -\\infty$。\n\n因为 $f(u_{\\tau})$ 在区间 $(0, \\infty)$ 上是连续的，并且从 $+\\infty$ 严格递减到 $-\\infty$，根据介值定理，存在一个且仅有一个正根 $u_{\\tau}$ 满足 $f(u_{\\tau}) = 0$。\n\n问题的这种适定性使得我们可以使用稳健的求根算法，例如区间法（如二分法或 Brent 方法）。这类方法需要一个初始区间 $[a, b]$，使得 $f(a)$ 和 $f(b)$ 符号相反。根据我们的分析：\n- 我们可以为下界 $a$ 选择一个非常小的正数（例如，$a=10^{-9}$），这能确保 $f(a)  0$。\n- 对于上界 $b$，选择 $b=U_P$ 是一个合理的选择，因为物理上期望 $u_{\\tau}$ 小于局部速度 $U_P$。对于这个选择，$f(U_P) = 1 - B - \\frac{1}{\\kappa}\\ln\\left(\\frac{U_P y_P}{\\nu}\\right)$。对于给定的常数（$B=5.2$），该值对所有给定的测试用例都为负。\n因此，区间 $[10^{-9}, U_P]$ 为求解器提供了一个可靠的括号。实现中将使用 `scipy.optimize.brentq` 函数，这是一个高效且稳健的区间求根算法的实现。\n\n一旦求解器为给定的测试用例找到了唯一的 $u_{\\tau}$ 值，就可以使用提供的公式计算其余的量：\n- 壁面剪切应力 $\\tau_w$ 可由摩擦速度的定义 $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$ 计算得出：\n$$ \\tau_w = \\rho\\, u_{\\tau}^2 $$\n- 湍动能 $k_P$ 由标准的平衡关系确定：\n$$ k_P = \\frac{u_{\\tau}^2}{\\sqrt{C_{\\mu}}} $$\n- 湍动能耗散率 $\\epsilon_P$ 使用其相应的平衡关系求得：\n$$ \\epsilon_P = \\frac{u_{\\tau}^3}{\\kappa\\, y_P} $$\n\n该过程被系统地应用于每个测试用例，使用指定的常数 $\\kappa = 0.41$，$B = 5.2$ 和 $C_{\\mu} = 0.09$。所有计算均在国际单位制 (SI) 下进行，最终结果按要求四舍五入到小数点后六位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes wall-function derived quantities for a series of test cases.\n    For each case, it numerically solves for the friction velocity u_tau and then\n    calculates wall shear stress (tau_w), turbulent kinetic energy (k_p),\n    and turbulent dissipation rate (epsilon_p).\n    \"\"\"\n\n    # Define the constants from the problem statement.\n    KAPPA = 0.41  # von Kármán constant\n    B = 5.2       # Log-law additive constant\n    C_MU = 0.09   # k-epsilon model constant\n\n    # Define the test cases from the problem statement as a list of tuples.\n    # Each tuple contains: (U_P, y_P, nu, rho)\n    test_cases = [\n        (5.0, 0.5e-3, 1.0e-5, 1.225),   # Case 1\n        (10.0, 1.0e-3, 1.5e-5, 1.225),  # Case 2\n        (2.0, 2.0e-4, 1.0e-6, 1000.0),  # Case 3\n        (50.0, 2.0e-3, 1.5e-5, 1.225),  # Case 4\n    ]\n\n    all_results_formatted = []\n    TOLERANCE = 1e-14 # High precision for the root-finder\n\n    for case in test_cases:\n        Up, yp, nu, rho = case\n\n        # Define the function for root-finding. We seek the root u_tau of f(u_tau) = 0.\n        # The equation is: U_P/u_tau = (1/kappa)*ln(u_tau*y_P/nu) + B\n        # Rearranged for root-finding: f(u_tau) = U_P/u_tau - ((1/kappa)*ln(u_tau*y_P/nu) + B)\n        def root_func(u_tau):\n            # The argument to the logarithm, y_plus, must be positive.\n            # Since y_P > 0 and nu > 0, this requires u_tau > 0.\n            if u_tau = 0:\n                # Return a large number to guide the solver away from non-physical values.\n                return np.inf\n            y_plus = u_tau * yp / nu\n            return Up / u_tau - ((1.0 / KAPPA) * np.log(y_plus) + B)\n\n        # A robust bracket for the root-finding algorithm.\n        # The function is strictly decreasing for u_tau > 0.\n        # As u_tau -> 0+, f(u_tau) -> +inf.\n        # As u_tau -> inf, f(u_tau) -> -inf.\n        # Lower bound `a` can be a small positive number.\n        # Upper bound `b` can be U_P, for which f(b) is negative for these cases.\n        a = 1e-9\n        b = Up\n        \n        # Solve for u_tau using Brent's method for robustness and efficiency.\n        u_tau_sol = brentq(root_func, a, b, xtol=TOLERANCE, rtol=TOLERANCE)\n\n        # Calculate the derived quantities using the solved u_tau.\n        # 1. Wall shear stress\n        tau_w_sol = rho * u_tau_sol**2\n        \n        # 2. Turbulent kinetic energy at point P\n        k_p_sol = u_tau_sol**2 / np.sqrt(C_MU)\n        \n        # 3. Turbulent dissipation rate at point P\n        epsilon_p_sol = u_tau_sol**3 / (KAPPA * yp)\n        \n        # Collect the results for the current case.\n        case_results = [u_tau_sol, tau_w_sol, k_p_sol, epsilon_p_sol]\n\n        # Format each value to exactly six decimal places.\n        formatted_quad = [f\"{val:.6f}\" for val in case_results]\n        all_results_formatted.append(f\"[{','.join(formatted_quad)}]\")\n    \n    # Final print statement in the exact required format.\n    # The output is a single line: [[...],[...],...]\n    print(f\"[{','.join(all_results_formatted)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实现了壁面函数之后，理解其局限性至关重要。本练习通过一个思想实验，展示了当标准的对数壁面函数被错误应用时（特别是当第一个网格点位于粘性子层，$y^+  5$）所产生的重大误差。通过将从对数律中“推断”出的壁面剪切应力与一个合成的“真实”值进行比较，您将直接量化这种不一致性，并体会到网格质量和$y^+$值布局在实现精确计算流体动力学（CFD）模拟中的重要性。",
            "id": "3391066",
            "problem": "考虑一个靠近固体壁面的统计定常、充分发展的湍流，使用雷诺平均纳维-斯托克斯 (RANS) 封闭模型进行建模，并对其进行一维法向离散化。第一个单元中心距离壁面为 $y_1$，单元厚度均匀为 $\\Delta y$，因此 $y_1 = \\Delta y/2$。假设流体为牛顿流体，其密度 $\\rho$ 和运动粘度 $\\nu$ 为常数，令摩擦速度为 $u_\\tau = \\sqrt{\\tau_w/\\rho}$，其中 $\\tau_w$ 是壁面剪切应力。定义内尺度变量 $y^+ = y u_\\tau/\\nu$ 和 $U^+ = U/u_\\tau$，其中 $U$ 是平均流向速度。\n\n作为一个经过充分检验的物理事实，在粘性子层中，平均速度满足 $U^+ \\approx y^+$；在对数律层中，平均速度满足 $U^+ \\approx \\frac{1}{\\kappa} \\ln(y^+) + B$，其中 $\\kappa$ 是 von Kármán 常数，$B$ 是一个经验截距。许多 RANS 封闭模型中的标准壁面函数在第一个离壁点上施加对数关系式，以推断壁面剪切应力。\n\n您的任务是，基于上述定义和事实，通过纯粹的数学和算法构建来证明，当使用标准壁面函数（壁面对数律）时，将第一个节点放置在 $y^+ \\approx 5$ 处所引入的不一致性，并估算由此产生的 $\\tau_w$ 误差。对于每个测试案例，请按以下步骤进行：\n\n1. 将 $(\\rho,\\nu,u_\\tau)$ 作为给定常数。对于一个指定的目标 $y_1^+$，构建一个网格，其 $\\Delta y$ 满足 $y_1 = \\Delta y/2$ 且 $y_1^+ = y_1 u_\\tau/\\nu$ 等于该目标值。这意味着 $\\Delta y = 2 y_1$ 且 $y_1 = \\dfrac{y_1^+ \\, \\nu}{u_\\tau}$。\n2. 在 $y_1$ 处生成一个与以下参考近壁行为一致的合成“真实”平均速度 $U$：\n   - 如果 $y_1^+ \\leq 5$，使用粘性子层关系 $U^+ = y^+$ 来设置 $U = u_\\tau \\, y_1^+$。\n   - 如果 $y_1^+ \\geq 30$，使用对数关系 $U^+ = \\dfrac{1}{\\kappa} \\ln(y^+) + B$ 来设置 $U = u_\\tau \\left(\\dfrac{1}{\\kappa} \\ln(y_1^+) + B\\right)$。\n   - 测试套件中不使用 $5  y^+  30$ 之间的过渡区，因此不需要额外的建模。\n3. 通过在 $y_1$ 处反解对数关系，从 $U$ 估算出“推断出的”摩擦速度 $\\hat{u}_\\tau$，从而模拟标准壁面函数对壁面剪切应力的推断过程。即，求解非线性方程中的 $\\hat{u}_\\tau$：\n   $$ \\frac{U}{\\hat{u}_\\tau} = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_1 \\hat{u}_\\tau}{\\nu}\\right) + B. $$\n   然后计算推断出的壁面剪切应力 $\\hat{\\tau}_w = \\rho \\, \\hat{u}_\\tau^2$。\n4. 计算真实的壁面剪切应力 $\\tau_w = \\rho \\, u_\\tau^2$ 和相对误差\n   $$ e = \\frac{\\hat{\\tau}_w - \\tau_w}{\\tau_w}. $$\n   将 $e$ 以小数形式报告。\n\n使用以下常数：$\\rho = 1000$ ($\\mathrm{kg/m^3}$)，$\\nu = 10^{-6}$ ($\\mathrm{m^2/s}$)，$u_\\tau = 0.2$ ($\\mathrm{m/s}$)，$\\kappa = 0.41$ 和 $B = 5.2$。通过指定 $y_1^+$ 目标值来构建以下四个测试案例：\n- 案例 A（深粘性子层）：$y_1^+ = 0.5$。\n- 案例 B（靠近粘性-对数过渡区）：$y_1^+ = 5$。\n- 案例 C（进入对数律层）：$y_1^+ = 30$。\n- 案例 D（深入对数律层）：$y_1^+ = 100$。\n\n对于每个案例，执行上述步骤并计算相对误差 $e$（无量纲）。您的程序应生成单行输出，其中包含四个相对误差，形式为方括号括起来的逗号分隔列表，每个值四舍五入到六位小数，例如“$[e_A,e_B,e_C,e_D]$”。不应打印任何其他文本或格式。所有使用物理单位的中间量应在内部与指定的单位保持一致，壁面剪切应力 $\\tau_w$ 的单位是 $\\mathrm{Pa}$；报告的相对误差 $e$ 是无量纲的，并且必须表示为小数。",
            "solution": "目标是量化当第一个近壁节点位于 $y^+ \\approx 5$ 处，但却施加基于对数律的标准壁面函数来推断壁面剪切应力时所引入的不一致性。我们从近壁湍流的基本定义和经过充分检验的事实出发。\n\n首先，根据壁面剪切应力 $\\tau_w$ 定义摩擦速度 $u_\\tau = \\sqrt{\\tau_w/\\rho}$。通过内尺度 $y^+ = y \\, u_\\tau/\\nu$ 和 $U^+ = U/u_\\tau$ 引入壁面单位。在靠近壁面的统计定常、充分发展的湍流中，平均动量方程在紧邻壁面的区域得以简化，因为与粘性应力相比，雷诺剪切应力可以忽略不计。因此，总应力近似为粘性应力，即 $\\tau \\approx \\mu \\, \\dfrac{dU}{dy}$，其中 $\\mu = \\rho \\nu$ 是动力粘度。对这种近壁行为进行积分，可得到对于 $y^+ \\lesssim 5$ 成立的、经过充分检验的粘性子层关系 $U^+ \\approx y^+$。\n\n远离壁面处，使用混合长度封闭模型（雷诺平均纳维-斯托克斯建模中一个被广泛接受的基础）的经验和理论论证，得出了在边界层平衡区域（$y^+ \\gtrsim 30$）的壁面对数律：$U^+ \\approx \\dfrac{1}{\\kappa}\\ln(y^+) + B$，其中 $\\kappa$ 是 von Kármán 常数，$B$ 是一个经验截距。这两个经过充分检验的事实构成了许多计算流体动力学壁面处理方法的基础。\n\n一个典型的“标准壁面函数”在第一个离壁点上施加对数关系，以便从距离壁面 $y_1$ 处计算出的平均速度 $U$ 来推断 $u_\\tau$（并由此推断 $\\tau_w$）。摩擦速度 $u_\\tau$ 本身控制着内尺度 $y^+$，这意味着在给定 $U$ 和 $y_1$ 的情况下求解 $u_\\tau$ 时存在非线性。如果第一个节点位于粘性子层中，用对数关系替代线性关系会产生不一致性。我们通过比较由一致的近壁关系计算出的“真实”壁面剪切应力与通过反解对数律得到的“推断”壁面剪切应力来量化这种不一致性。\n\n基于这些原理的算法步骤如下：\n\n1. 固定物理常数 $\\rho$、$\\nu$、$\\kappa$、$B$ 以及表征目标流场的“真实”摩擦速度 $u_\\tau$。真实的壁面剪切应力为 $\\tau_w = \\rho \\, u_\\tau^2$。\n2. 对于每个目标 $y_1^+$，根据具有均匀单元的一维法向离散化方案，计算网格间距，使得第一个单元中心位于 $y_1 = \\dfrac{y_1^+ \\, \\nu}{u_\\tau}$ 且 $\\Delta y = 2 y_1$。\n3. 通过选择与已知 $u_\\tau$ 一致的适当近壁关系，在 $y_1$ 处生成一个合成的“真实”平均速度 $U$：\n   - 如果 $y_1^+ \\leq 5$，使用粘性子层：$U^+ = y_1^+ \\Rightarrow U = u_\\tau \\, y_1^+$。\n   - 如果 $y_1^+ \\geq 30$，使用对数律：$U^+ = \\dfrac{1}{\\kappa}\\ln(y_1^+) + B \\Rightarrow U = u_\\tau\\left(\\dfrac{1}{\\kappa}\\ln(y_1^+) + B\\right)$。\n4. 通过求解在 $y_1$ 处施加的对数关系，得到一个推断出的摩擦速度 $\\hat{u}_\\tau$，从而模拟标准壁面函数。需要求解的方程是：\n   $$ g(\\hat{u}_\\tau) = \\frac{U}{\\hat{u}_\\tau} - \\left[\\frac{1}{\\kappa} \\ln\\left(\\frac{y_1 \\hat{u}_\\tau}{\\nu}\\right) + B\\right] = 0, $$\n   对于 $\\hat{u}_\\tau  0$，该方程是良定的，因为第一项随 $\\hat{u}_\\tau$ 增大而减小，第二项呈对数增长，这确保了根的唯一性。可以使用像 Brent 括号法这样的稳健数值方法在一个很宽的区间（例如，一个小的正数下界和一个大的上界之间）内找到根，因为对于物理上合理的输入，$g$ 在这样的范围内会表现出符号变化。\n5. 计算推断出的壁面剪切应力 $\\hat{\\tau}_w = \\rho \\, \\hat{u}_\\tau^2$ 和相对误差\n   $$ e = \\frac{\\hat{\\tau}_w - \\tau_w}{\\tau_w}. $$\n   这个误差是无量纲的，直接量化了在第一个节点使用对数律所引入的不一致性。\n6. 将此程序应用于旨在探测不同区域的四个测试案例：\n   - $y_1^+ = 0.5$（深粘性子层，预计有大的不一致性），\n   - $y_1^+ = 5$（靠近过渡区，我们感兴趣的案例），\n   - $y_1^+ = 30$（进入对数律区域，预计具有一致性），\n   - $y_1^+ = 100$（深入对数律区域，预计具有一致性）。\n7. 以指定的单行格式，将误差 $e$ 作为包含四个小数的列表报告，每个小数四舍五入到六位小数。\n\n科学解释：对于 $y_1^+ \\leq 5$，真实的 $U^+$ 随 $y^+$ 线性增长，而对数律仅呈对数增长。当使用一个实际上与同一位置的线性律一致的速度来反解对数关系时，为了使观测到的较大的 $U/u_\\tau$ 与对数表达式相协调，推断出的 $\\hat{u}_\\tau$ 相对于真实的 $u_\\tau$ 会减小，这导致对 $\\hat{\\tau}_w$ 的显著低估。相反，对于 $y_1^+ \\geq 30$，如果 $U$ 与对数律一致，那么反解同一定律将重现正确的 $u_\\tau$，因此在 $\\tau_w$ 中产生的误差可以忽略不计。这证明了在使用标准壁面函数时将第一个节点放置得太靠近壁面的不一致性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    # Physical and model constants (units: rho [kg/m^3], nu [m^2/s], u_tau [m/s])\n    rho = 1000.0\n    nu = 1e-6\n    u_tau_true = 0.2\n    kappa = 0.41\n    B = 5.2\n\n    # Test cases specified by target y1^+ values\n    yplus_targets = [0.5, 5.0, 30.0, 100.0]\n\n    def U_true_at_y1(yplus):\n        \"\"\"\n        Compute synthetic 'true' mean velocity U at y1 for a given yplus = y1^+,\n        using viscous sublayer for yplus = 5, and log-law for yplus >= 30.\n        \"\"\"\n        if yplus = 5.0:\n            # Viscous sublayer: U+ = y+\n            return u_tau_true * yplus\n        else:\n            # Log-law: U+ = (1/kappa) ln(y+) + B\n            return u_tau_true * ((1.0 / kappa) * np.log(yplus) + B)\n\n    def infer_u_tau_from_log(U, y1):\n        \"\"\"\n        Infer friction velocity u_tau by inverting the log-law at y1:\n            U/u = (1/kappa) ln(y1 * u / nu) + B\n        Solve g(u) = 0 with a robust bracket.\n        \"\"\"\n        def g(u):\n            return U / u - ((1.0 / kappa) * np.log(y1 * u / nu) + B)\n\n        # Use a wide bracket to ensure a sign change for physically plausible U, y1\n        lower = 1e-8\n        upper = 1e4\n        # Ensure the function is defined in the bracket\n        return brentq(g, lower, upper, maxiter=200, xtol=1e-12)\n\n    results = []\n    for yplus_target in yplus_targets:\n        # Construct grid: y1 = yplus_target * nu / u_tau_true\n        y1 = yplus_target * nu / u_tau_true\n        # Synthetic \"true\" velocity at y1\n        U = U_true_at_y1(yplus_target)\n        # Inferred friction velocity from standard wall function (log-law)\n        u_tau_inferred = infer_u_tau_from_log(U, y1)\n        # Compute wall shear stresses\n        tau_w_true = rho * (u_tau_true ** 2)\n        tau_w_inferred = rho * (u_tau_inferred ** 2)\n        # Relative error as a decimal number\n        error = (tau_w_inferred - tau_w_true) / tau_w_true\n        results.append(error)\n\n    # Final print statement in the exact required format, rounded to six decimals.\n    print(f\"[{','.join(f'{e:.6f}' for e in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现实世界中的CFD应用涉及复杂的几何形状和非均匀网格，其中第一个单元的法向壁面距离可能差异巨大。这项实践将我们的分析从单个点扩展到整个表面，以应对自动模型选择的实际挑战。您将使用成熟的经验关系式来估计整个网格上的局部$y^+$值，并实现一种逻辑，以在高雷诺数壁面函数和双层模型之间自动切换——这是工业CFD软件中为确保稳健性和准确性而采用的常用策略。",
            "id": "3391094",
            "problem": "您的任务是构建一个程序，对于雷诺平均纳维-斯托克斯 (RANS) 模拟中给定的一组临近壁面的网格面，判断高雷诺数 (high-Re) 壁面函数是否有效，并根据无量纲壁面距离在其他地方自动切换到双层模型。您的推导必须从计算流体力学中壁面有界剪切流的基本关系开始。程序必须执行以下基于第一性原理的步骤。\n\n从壁面剪切应力和相关的摩擦速度的定义开始。令表面摩擦系数定义为 $C_f = \\tau_w / \\left(\\tfrac{1}{2} \\rho U_b^2\\right)$，其中 $\\tau_w$ 是壁面剪切应力，$\\rho$ 是流体密度，而 $U_b$ 是平行于壁面的代表性主流速度。摩擦速度定义为 $u_\\tau = \\sqrt{\\tau_w / \\rho}$。无量纲壁面距离定义为 $y^+ = u_\\tau y / \\nu$，其中 $y$ 是从壁面到网格面中心的距离，$\\nu = \\mu / \\rho$ 是运动粘度，$\\mu$ 是动力粘度。\n\n为了在不提供直接壁面剪切数据的情况下封闭表面摩擦系数，采用与边界层理论一致的、广泛使用的平板关联式。对于长度为 $L$ 的平板，定义平板长度雷诺数 $Re_L = \\rho U_b L / \\mu$。当 $Re_L  5 \\times 10^5$ 时使用层流关联式，否则使用湍流关联式。具体来说，对于层流边界层，使用 $C_f = 0.664 / \\sqrt{Re_L}$；对于湍流边界层，使用 $C_f = 0.0592 \\, Re_L^{-1/5}$。这些关联式在壁面有界剪切流中经过了充分检验，并为当前目的提供了物理上一致的 $C_f$ 估计。\n\n给定 $C_f$，通过 $u_\\tau = U_b \\sqrt{\\tfrac{1}{2} C_f}$ 计算 $u_\\tau$，然后通过 $y^+ = u_\\tau y / \\nu$ 计算每个网格面的 $y^+$。当第一个离壁单元的中心位于对数区时，声明高雷诺数壁面函数有效，为工程目的，该区域取为 $y^+ \\ge 30$。然后在其他地方，即当 $y^+  30$ 时，触发自动切换到双层模型。\n\n对于每个测试用例，所需的输出是：\n- 高雷诺数壁面函数有效的网格面所占的比例，定义为 $y^+ \\ge 30$ 的网格面数量除以总网格面数量（以小数表示）。\n- 每个网格面的一个整数决策代码，用于指定模型选择，其中 $2$ 表示使用高雷诺数壁面函数（有效区域 $y^+ \\ge 30$），$0$ 表示自动切换到双层模型（$y^+  30$）。\n\n科学和数值要求：\n- 推导必须与上述定义和关联式一致。\n- 距离必须以米 (m) 表示，速度以米每秒 (m/s) 表示，密度以千克每立方米 (kg/m$^3$) 表示，动力粘度以帕斯卡秒 (Pa·s) 表示，$y^+$ 是无量纲的。\n- 最终的比例应以十进制数返回。您可以将该比例四舍五入到三位小数。\n- 此问题不涉及角度。\n\n测试套件：\n提供以下三个测试用例来验证您的程序：\n1.  具有广泛 $y$ 值分布的湍流区：\n    -   $U_b = 20$ m/s, $L = 2$ m, $\\rho = 1.225$ kg/m$^3$, $\\mu = 1.8 \\times 10^{-5}$ Pa·s\n    -   $y$ 值（单位：米）：$[5 \\times 10^{-5}, 2 \\times 10^{-4}, 8 \\times 10^{-4}, 3 \\times 10^{-3}, 1 \\times 10^{-2}]$\n2.  具有较小 $y$ 值的层流区：\n    -   $U_b = 2$ m/s, $L = 0.1$ m, $\\rho = 1.225$ kg/m$^3$, $\\mu = 1.8 \\times 10^{-5}$ Pa·s\n    -   $y$ 值（单位：米）：$[1 \\times 10^{-5}, 1 \\times 10^{-4}, 5 \\times 10^{-4}, 1 \\times 10^{-3}]$\n3.  包含接近过渡阈值的网格面的边界聚焦湍流案例：\n    -   $U_b = 15$ m/s, $L = 1$ m, $\\rho = 1.225$ kg/m$^3$, $\\mu = 1.8 \\times 10^{-5}$ Pa·s\n    -   $y$ 值（单位：米）：$[1.136 \\times 10^{-4}, 6.807 \\times 10^{-4}, 6.807 \\times 10^{-3}, 1 \\times 10^{-2}]$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果编码为一个双元素列表，其中包含比例（一个浮点数，四舍五入到三位小数）和每个网格面的整数决策代码列表。例如：\n\"[[fraction1,[code_1,code_2,...]],[fraction2,[...]],...]\"",
            "solution": "该问题是有效的，因为它在科学上基于计算流体力学的原理，问题设定良好，具有清晰且确定性的计算步骤，并且其定义和标准是客观的。所有必需的物理参数和经验关联式都已提供，构成了一个自洽且可解的问题。以下解决方案通过从所提供的第一性原理逐步推导所需量来进行。\n\n**第 1 步：平板长度雷诺数 ($Re_L$)**\n第一步是在特征长度尺度 $L$ 上表征整体流动状态（层流或湍流）。这通过计算平板长度雷诺数 $Re_L$ 来实现，该雷诺数定义为惯性力与粘性力之比。\n$$\nRe_L = \\frac{\\rho U_b L}{\\mu}\n$$\n这里，$\\rho$ 是流体密度，$U_b$ 是主流速度，$L$ 是平板的特征长度，$\\mu$ 是动力粘度。问题指定了一个 $Re_L = 5 \\times 10^5$ 的阈值，用以区分层流和湍流边界层关联式。\n\n**第 2 步：表面摩擦系数 ($C_f$)**\n表面摩擦系数 $C_f$ 将壁面剪切应力 $\\tau_w$ 与主流的动压关联起来。问题提供了基于 $Re_L$ 的标准经验关联式，这些关联式源自平板边界层理论。\n\n对于层流边界层，其中 $Re_L  5 \\times 10^5$：\n$$\nC_f = \\frac{0.664}{\\sqrt{Re_L}}\n$$\n对于湍流边界层，其中 $Re_L \\ge 5 \\times 10^5$：\n$$\nC_f = 0.0592 \\, Re_L^{-1/5}\n$$\n\n**第 3 步：摩擦速度 ($u_\\tau$)**\n摩擦速度 $u_\\tau$ 是一个基本的速度尺度，用于表征近壁的剪切主导区域。它由壁面剪切应力 $\\tau_w$ 和流体密度 $\\rho$ 定义：\n$$\nu_\\tau = \\sqrt{\\frac{\\tau_w}{\\rho}}\n$$\n为了在没有 $\\tau_w$ 直接知识的情况下计算 $u_\\tau$，我们使用表面摩擦系数的定义，$C_f = \\tau_w / \\left(\\tfrac{1}{2} \\rho U_b^2\\right)$。整理后得到 $\\tau_w = C_f \\cdot \\frac{1}{2} \\rho U_b^2$。将其代入 $u_\\tau$ 的定义中：\n$$\nu_\\tau = \\sqrt{\\frac{C_f \\cdot \\frac{1}{2} \\rho U_b^2}{\\rho}} = \\sqrt{\\frac{1}{2} C_f U_b^2}\n$$\n这得出了用已知量表示 $u_\\tau$ 的最终表达式：\n$$\nu_\\tau = U_b \\sqrt{\\frac{C_f}{2}}\n$$\n\n**第 4 步：无量纲壁面距离 ($y^+$)**\n无量纲壁面距离 $y^+$ 是由粘性长度尺度 $\\nu/u_\\tau$ 无量纲化的法向壁面坐标 $y$。它是确定给定点位于边界层哪个区域（粘性底层、缓冲层或对数律区）的关键参数。\n运动粘度 $\\nu$ 定义为 $\\nu = \\mu / \\rho$。$y^+$ 的公式是：\n$$\ny^+ = \\frac{u_\\tau y}{\\nu}\n$$\n对输入数据中提供的每个网格面中心距离 $y$ 执行此计算。\n\n**第 5 步：模型选择和输出生成**\n最后一步是应用模型选择的决策准则。高雷诺数壁面函数仅在第一个离壁计算节点位于边界层的对数区内时才有效。对于工程应用，通常认为该区域从 $y^+ \\approx 30$ 开始。\n- 如果 $y^+ \\ge 30$，则认为高雷诺数壁面函数有效。分配决策代码 $2$。\n- 如果 $y^+  30$，则节点位于粘性底层或缓冲层，壁面函数不适用。需要切换到双层模型（或解析粘性底层的低雷诺数模型）。分配决策代码 $0$。\n\n然后编译每个测试用例所需的输出：\n1.  壁面函数有效的网格面比例，计算方法为 $y^+ \\ge 30$ 的网格面数量除以总网格面数量。结果四舍五入到三位小数。\n2.  一个包含每个网格面整数决策代码（$0$ 或 $2$）的列表。\n\n这个系统化的过程确保了在 RANS 模拟中选择适当近壁区模化策略的一种物理上一致且自动化的方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for wall function validity based on y+ for multiple test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Turbulent regime\n        {\n            \"Ub\": 20.0,\n            \"L\": 2.0,\n            \"rho\": 1.225,\n            \"mu\": 1.8e-5,\n            \"y_values\": np.array([5e-5, 2e-4, 8e-4, 3e-3, 1e-2]),\n        },\n        # Case 2: Laminar regime\n        {\n            \"Ub\": 2.0,\n            \"L\": 0.1,\n            \"rho\": 1.225,\n            \"mu\": 1.8e-5,\n            \"y_values\": np.array([1e-5, 1e-4, 5e-4, 1e-3]),\n        },\n        # Case 3: Boundary-focused turbulent case\n        {\n            \"Ub\": 15.0,\n            \"L\": 1.0,\n            \"rho\": 1.225,\n            \"mu\": 1.8e-5,\n            \"y_values\": np.array([1.136e-4, 6.807e-4, 6.807e-3, 1e-2]),\n        },\n    ]\n\n    results_str_list = []\n    for case in test_cases:\n        # Extract parameters for the current case\n        Ub = case[\"Ub\"]\n        L = case[\"L\"]\n        rho = case[\"rho\"]\n        mu = case[\"mu\"]\n        y_values = case[\"y_values\"]\n\n        # Step 1: Calculate Reynolds number\n        Re_L = rho * Ub * L / mu\n\n        # Step 2: Calculate skin-friction coefficient based on flow regime\n        if Re_L  5e5:\n            # Laminar correlation\n            Cf = 0.664 / np.sqrt(Re_L)\n        else:\n            # Turbulent correlation\n            Cf = 0.0592 * Re_L**(-1.0 / 5.0)\n\n        # Step 3: Calculate friction velocity\n        u_tau = Ub * np.sqrt(Cf / 2.0)\n\n        # Step 4: Calculate dimensionless wall distance y+\n        nu = mu / rho\n        y_plus = u_tau * y_values / nu\n\n        # Step 5: Apply decision logic and generate outputs\n        # Assign code 2 for y+ >= 30 (high-Re), 0 otherwise (two-layer)\n        decision_codes = np.where(y_plus >= 30, 2, 0).tolist()\n\n        # Calculate the fraction of valid faces\n        num_valid_faces = np.sum(y_plus >= 30)\n        total_faces = len(y_values)\n        fraction = num_valid_faces / total_faces if total_faces > 0 else 0.0\n\n        # Format the results as specified\n        fraction_str = f\"{fraction:.3f}\"\n        codes_str = f\"[{','.join(map(str, decision_codes))}]\"\n        result_str = f\"[{fraction_str},{codes_str}]\"\n        results_str_list.append(result_str)\n\n    # Final print statement in the exact required format.\n    final_output = f\"[{','.join(results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}