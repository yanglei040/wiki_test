{
    "hands_on_practices": [
        {
            "introduction": "在计算流体力学中，正确设置边界条件是获得物理上真实且数值上稳定解的关键，但这首先引出一个基本问题：在给定边界上，我们究竟需要指定多少个物理量？本练习将通过严格的推导，建立双曲型偏微分方程的特征线理论与实际边界条件设定之间的桥梁。你将通过分析van Leer通量矢量分裂等方法的内在逻辑，来验证为何不同流动区域（如亚音速入流、超音速出流）需要不同数量的给定条件，从而为边界条件的设计提供坚实的理论基础。",
            "id": "3387442",
            "problem": "考虑沿边界法向的一维无粘性流动的可压缩欧拉方程。设外向单位法向量固定，并用密度 $\\,\\rho\\,$（单位：$\\mathrm{kg/m^3}$）、法向速度 $\\,u_n\\,$（单位：$\\mathrm{m/s}$）和压力 $\\,p\\,$（单位：$\\mathrm{Pa}$）表示原始变量。设比热比表示为 $\\,\\gamma\\,$（无量纲）。声速为 $\\,a = \\sqrt{\\gamma p / \\rho}\\,$（单位：$\\mathrm{m/s}$），边界法向马赫数为 $\\,M_n = u_n / a\\,$（无量纲）。在计算流体动力学（CFD）中，通量矢量分裂（FVS）方法，例如 van Leer 通量矢量分裂，将法向通量矢量 $\\,F_n\\,$ 分解为正部 $\\,F_n^+\\,$ 和负部 $\\,F_n^-\\,$，它们分别代表与移出和移入计算域的波相关的贡献。\n\n您的任务是：\n- 根据可压缩欧拉方程和特征线理论，推导边界处入流与出流特征线的分类，该分类基于与法向通量雅可比矩阵相关的特征值的符号。使用此分类来确定，对于给定的 $\\,M_n\\,$，有多少条特征线是入流的，因此为保证适定性必须施加多少个边界变量。\n- 从控制 van Leer 通量矢量分裂的物理约束出发，陈述正、负分裂函数 $\\,g^\\pm(M_n)\\,$，这些函数在超声速区域平滑地恢复为纯上游格式，并在亚声速区域实现一致的分裂。解释 $\\,g^\\pm(M_n)\\,$ 如何指示 $\\,F_n^+\\,$ 和 $\\,F_n^-\\,$ 是否被激活，并将其与入流特征线的数量联系起来。\n- 通过组合法向质量通量来实现在亚声速边界的特征线入流/出流，其中使用 $\\,F^\\pm\\,$ 并遵循以下规则：入流贡献使用外部（施加的）数据，而出流贡献使用内部数据。您应将法向质量通量分量的 $\\,F^\\pm\\,$ 分裂实现为 $\\,F_\\rho^\\pm = \\rho a\\, g^\\pm(M_n)\\,$。此任务不要求您实现动量和能量通量分量。\n\n严格证明，对于亚声速边界，施加变量的数量等于从特征值符号模式推导出的入流特征线数量，并且该数量与从 $\\,g^\\pm(M_n)\\,$ 推断的流态一致，具体如下：\n- 亚声速入流（$-1  M_n  0$）需要施加两个变量。\n- 亚声速出流（$0  M_n  1$）需要施加一个变量。\n- 超声速入流（$M_n  -1$）需要施加三个变量。\n- 超声速出流（$M_n > 1$）需要施加零个变量。\n- 声速临界情况（$M_n = -1, 0, 1$）通过计算严格为负的特征值得出，分别产生两个、一个和零个施加变量。\n\n然后，编写一个完整的程序，该程序：\n1. 计算 $\\,a\\,$、$\\,M_n\\,$、通过检查 $\\,u_n - a\\,$、$\\,u_n\\,$ 和 $\\,u_n + a\\,$ 的符号得到的入流特征线数量、通过流态分类得到的施加边界变量数量，以及从 $\\,g^\\pm(M_n)\\,$ 激活状态推断的入流数量。\n2. 对于每个测试用例，返回一个布尔值，指示这三个计数是否一致。\n3. 为演示目的，根据特征线入流/出流规则，一致地使用内部与外部状态来组合 $\\,F_\\rho^+\\,$ 和 $\\,F_\\rho^-\\,$，但不打印这些通量。\n\n使用以下测试套件，所有量均采用上述指定单位：\n- 情况 1：$\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = 100\\,$。这是亚声速出流，满足 $\\,0  M_n  1\\,$。\n- 情况 2：$\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = -100\\,$。这是亚声速入流，满足 $\\,-1  M_n  0\\,$。\n- 情况 3：$\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = 500\\,$。这是超声速出流，满足 $\\,M_n > 1\\,$。\n- 情况 4：$\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = -500\\,$。这是超声速入流，满足 $\\,M_n  -1\\,$。\n- 情况 5：$\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, 选择 $\\,a = 300\\,$ 并设置 $\\,p = \\rho a^2 / \\gamma\\,$, $\\,u_n = a\\,$，因此 $\\,M_n = 1\\,$（声速出流）。\n- 情况 6：与情况 5 相同，但 $\\,u_n = -a\\,$，因此 $\\,M_n = -1\\,$（声速入流）。\n- 情况 7：与情况 5 相同，但 $\\,u_n = 0\\,$，因此 $\\,M_n = 0\\,$（驻点）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,...]”），其中每个条目是对应测试用例的布尔值，如上所述。",
            "solution": "该问题要求严格验证三种确定一维欧拉方程施加边界条件数量的方法之间的一致性：基于特征值的特征线分析、基于马赫数的流态分类，以及从 van Leer 通量分裂函数激活状态的推断。\n\n### 第一部分：特征线分析与边界条件\n\n一维无粘性可压缩流动的欧拉方程可以使用原始变量 $\\mathbf{W} = [\\rho, u_n, p]^T$ 写成准线性形式。该方程组为：\n$$\n\\frac{\\partial \\mathbf{W}}{\\partial t} + \\mathbf{A}_p \\frac{\\partial \\mathbf{W}}{\\partial x_n} = 0\n$$\n其中 $x_n$ 是垂直于边界的坐标。原始变量的雅可比矩阵 $\\mathbf{A}_p$ 为：\n$$\n\\mathbf{A}_p = \\frac{\\partial \\mathbf{F}_p}{\\partial \\mathbf{W}} = \n\\begin{pmatrix}\nu_n  \\rho  0 \\\\\n0  u_n  1/\\rho \\\\\n0  \\gamma p  u_n\n\\end{pmatrix}\n$$\n该矩阵的特征值 $\\lambda$ 决定了特征波的传播速度。它们通过求解 $\\det(\\mathbf{A}_p - \\lambda \\mathbf{I}) = 0$ 找到：\n$$\n\\det \\begin{pmatrix}\nu_n - \\lambda  \\rho  0 \\\\\n0  u_n - \\lambda  1/\\rho \\\\\n0  \\gamma p  u_n - \\lambda\n\\end{pmatrix} = (u_n - \\lambda) \\left[ (u_n - \\lambda)^2 - \\frac{\\gamma p}{\\rho} \\right] = 0\n$$\n使用声速的定义 $a = \\sqrt{\\gamma p / \\rho}$，这可简化为：\n$$\n(u_n - \\lambda) [ (u_n - \\lambda)^2 - a^2 ] = 0\n$$\n三个特征值是：\n$$\n\\lambda_1 = u_n - a, \\quad \\lambda_2 = u_n, \\quad \\lambda_3 = u_n + a\n$$\n它们分别代表逆流传播的声波、随流传播的熵/接触间断波以及随流传播的声波的速度。\n\n对于边界处的双曲系统，必须从外部指定的边界条件数量等于传播到计算域内的特征波数量。如果波的传播速度 $\\lambda$ 为负（假设外法线指向正方向），则该波是入流波。因此，所需边界条件的数量等于 $\\mathbf{A}_p$ 的负特征值的数量。\n\n我们现在可以根据边界法向马赫数 $M_n = u_n / a$ 对流态进行分类，并计算负特征值的数量：\n\n1.  **超声速入流 ($M_n  -1$)**：此时 $u_n  -a$。这意味着 $u_n + a  0$。由于 $a > 0$，我们有 $u_n  0$ 和 $u_n - a  0$。所有三个特征值 $\\lambda_1 = u_n - a$、$\\lambda_2 = u_n$ 和 $\\lambda_3 = u_n + a$ 均为负。\n    *   入流特征线数量：$3$。所有变量都必须从外部施加。\n\n2.  **亚声速入流 ($-1  M_n  0$)**：此时 $-a  u_n  0$。\n    *   $\\lambda_1 = u_n - a  0$（因为 $u_n$ 为负）。\n    *   $\\lambda_2 = u_n  0$。\n    *   $\\lambda_3 = u_n + a > 0$。\n    *   入流特征线数量：$2$。必须施加两个变量。\n\n3.  **亚声速出流 ($0 \\le M_n  1$)**：此时 $0 \\le u_n  a$。\n    *   $\\lambda_1 = u_n - a  0$。\n    *   $\\lambda_2 = u_n \\ge 0$。\n    *   $\\lambda_3 = u_n + a > 0$。\n    *   入流特征线数量（严格为负的特征值）：$1$。必须施加一个变量。对于 $M_n=0$ 的特殊情况，特征值为 $-a, 0, a$，产生一个严格为负的特征值。\n\n4.  **超声速出流 ($M_n \\ge 1$)**：此时 $u_n \\ge a$。\n    *   $\\lambda_1 = u_n - a \\ge 0$。\n    *   $\\lambda_2 = u_n > 0$。\n    *   $\\lambda_3 = u_n + a > 0$。\n    *   入流特征线数量（严格为负的特征值）：$0$。不施加任何变量；所有变量都由内部确定。对于 $M_n=1$ 的特殊情况，特征值为 $0, a, 2a$，产生零个严格为负的特征值。\n\n5.  **声速点（根据问题陈述）**：计数规则基于严格为负的特征值。\n    *   $M_n = 1$ ($u_n = a$)：特征值为 $0, a, 2a$。计数 = $0$。\n    *   $M_n = -1$ ($u_n = -a$)：特征值为 $-2a, -a, 0$。计数 = $2$。\n    *   $M_n = 0$ ($u_n = 0$)：特征值为 $-a, 0, a$。计数 = $1$。\n\n此分析提供了一个严格的证明，即通过计算严格为负的特征值所确定的所需边界条件数量，与问题中为每个流态指定的数量相匹配。\n\n### 第二部分：Van Leer 通量矢量分裂\n\nVan Leer 通量矢量分裂将通量矢量 $\\mathbf{F}_n$ 分解为 $\\mathbf{F}_n^+$ 和 $\\mathbf{F}_n^-$，其中 $\\mathbf{F}_n^+$ 与向正方向移动的信息（出流）相关，而 $\\mathbf{F}_n^-$ 与向负方向移动的信息（入流）相关。对于边界处的数值格式，规则是使用内部数据评估出流通量，使用外部（施加的）数据评估入流通量：\n$$\n\\mathbf{F}_{n, \\text{boundary}} = \\mathbf{F}_n^+(\\mathbf{W}_{\\text{interior}}) + \\mathbf{F}_n^-(\\mathbf{W}_{\\text{exterior}})\n$$\n分裂的构造方式使得 $\\mathbf{F}_n^+$ 的雅可比矩阵具有非负特征值，而 $\\mathbf{F}_n^-$ 的雅可比矩阵具有非正特征值，从而确保稳定性。\n\n对于质量通量分量 $F_\\rho = \\rho u_n = \\rho a M_n$，van Leer 分裂由 $F_\\rho = F_\\rho^+ + F_\\rho^- = \\rho a g^+(M_n) + \\rho a g^-(M_n)$ 给出，这意味着 $M_n = g^+(M_n) + g^-(M_n)$。标准连续分裂函数 $g^\\pm(M_n)$ 为：\n$$\ng^+(M_n) = \\begin{cases} 0  \\text{if } M_n \\le -1 \\\\ \\frac{1}{4}(M_n+1)^2  \\text{if } -1  M_n  1 \\\\ M_n  \\text{if } M_n \\ge 1 \\end{cases}\n$$\n$$\ng^-(M_n) = \\begin{cases} M_n  \\text{if } M_n \\le -1 \\\\ -\\frac{1}{4}(M_n-1)^2  \\text{if } -1  M_n  1 \\\\ 0  \\text{if } M_n \\ge 1 \\end{cases}\n$$\n这些函数的“激活”状态决定了边界流的性质：\n-   如果 $g^-(M_n) = 0$，则只有 $\\mathbf{F}_n^+$ 通量是激活的。这对应于超声速出流区域（$M_n \\ge 1$），此时所有信息都离开计算域。通量完全由内部数据计算，需要 $0$ 个施加变量。这与特征值分析一致。\n-   如果 $g^+(M_n) = 0$，则只有 $\\mathbf{F}_n^-$ 通量是激活的。这对应于超声速入流区域（$M_n \\le -1$），此时所有信息都进入计算域。通量完全由外部数据计算，需要 $3$ 个施加变量。然而，我们必须区分声速点 $M_n=-1$（2 个变量）和 $M_n  -1$ 的情况（3 个变量）。\n-   如果 $g^+(M_n)$ 和 $g^-(M_n)$ 均不为零，则流动是亚声速的（$|M_n|1$），同时具有入流和出流贡献。施加变量的数量（$1$ 或 $2$）取决于 $M_n$ 的符号。\n\n因此，我们可以建立一个基于 $g^\\pm(M_n)$ 激活状态的一致计数方法，该方法与特征线分析精确匹配：\n-   如果 $g^-(M_n)$ 为零，我们处于超声速出流区域（$M_n \\ge 1$）。施加变量的计数为 $0$。\n-   如果 $g^+(M_n)$ 为零，我们处于超声速入流区域（$M_n \\le -1$）。\n    -   如果 $M_n = -1$，计数为 $2$。\n    -   如果 $M_n  -1$，计数为 $3$。\n-   如果两者都不为零，我们处于亚声速区域（$-1  M_n  1$）。\n    -   如果 $M_n  0$（亚声速入流），计数为 $2$。\n    -   如果 $M_n \\ge 0$（亚声速出流/驻点），计数为 $1$。\n\n此逻辑表明，可以从 van Leer 分裂函数的激活状态一致地推断出施加边界条件的数量，因为这些函数的设计初衷就是为了反映流态的底层特征结构。因此，这三种计数方法是等价的。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates the consistency of three methods for counting required boundary\n    conditions in 1D compressible flow for a suite of test cases.\n    \"\"\"\n    \n    # Test cases: (gamma, rho, u_n, p, a)\n    # Use None for values to be calculated.\n    test_cases = [\n        # Case 1: Subsonic outflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 100.0, 'p': 101325.0, 'a': None},\n        # Case 2: Subsonic inflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': -100.0, 'p': 101325.0, 'a': None},\n        # Case 3: Supersonic outflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 500.0, 'p': 101325.0, 'a': None},\n        # Case 4: Supersonic inflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': -500.0, 'p': 101325.0, 'a': None},\n        # Case 5: Sonic outflow M_n = 1\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 300.0, 'p': None, 'a': 300.0},\n        # Case 6: Sonic inflow M_n = -1\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': -300.0, 'p': None, 'a': 300.0},\n        # Case 7: Stagnation M_n = 0\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 0.0, 'p': None, 'a': 300.0},\n    ]\n\n    results = []\n    \n    # Define van Leer splitting functions\n    def g_plus(Mn):\n        if Mn >= 1.0:\n            return Mn\n        elif Mn = -1.0:\n            return 0.0\n        else:\n            return 0.25 * (Mn + 1.0)**2\n\n    def g_minus(Mn):\n        if Mn = -1.0:\n            return Mn\n        elif Mn >= 1.0:\n            return 0.0\n        else:\n            return -0.25 * (Mn - 1.0)**2\n\n    for case in test_cases:\n        gamma, rho, u_n = case['gamma'], case['rho'], case['u_n']\n        p, a = case['p'], case['a']\n\n        # Complete the state variables\n        if a is None:\n            a = np.sqrt(gamma * p / rho)\n        if p is None:\n            p = rho * a**2 / gamma\n        \n        # Avoid division by zero if a=0, though not in test cases\n        if a > 1e-9:\n            Mn = u_n / a\n        else:\n            Mn = 0.0\n\n        # Method 1: Count strictly negative eigenvalues\n        eigenvalues = [u_n - a, u_n, u_n + a]\n        count_eigen = sum(1 for lam in eigenvalues if lam  -1e-9)\n\n        # Method 2: Count based on Mach number regime classification\n        if Mn >= 1.0 or np.isclose(Mn, 1.0):\n            count_regime = 0\n        elif Mn = -1.0 and not np.isclose(Mn, -1.0):\n            count_regime = 3\n        elif np.isclose(Mn, -1.0):\n            count_regime = 2\n        elif Mn  0.0 and not np.isclose(Mn, 0.0):\n            count_regime = 2\n        else:  # This covers [0, 1)\n            count_regime = 1\n\n        # Method 3: Count inferred from van Leer splitting function activation\n        gp = g_plus(Mn)\n        gm = g_minus(Mn)\n        \n        count_vanleer = -1 # Default invalid\n        if np.isclose(gm, 0.0): # Supersonic outflow regime (Mn >= 1)\n            count_vanleer = 0\n        elif np.isclose(gp, 0.0): # Supersonic inflow regime (Mn = -1)\n            if np.isclose(Mn, -1.0):\n                count_vanleer = 2\n            else: # Mn  -1\n                count_vanleer = 3\n        else: # Subsonic regime (-1  Mn  1)\n            if Mn  0.0:\n                count_vanleer = 2\n            else: # Mn >= 0\n                count_vanleer = 1\n\n        # Check for agreement among all three methods\n        is_consistent = (count_eigen == count_regime == count_vanleer)\n        results.append(is_consistent)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了需要施加多少边界条件后，我们转向一个同样根本的问题：对于一个具体的物理边界，例如固体壁面，这些条件应该是什么？本练习将引导你从欧拉方程出发，推导出一个至关重要的关系式，该关系式揭示了壁面曲率与垂直于壁面的压力梯度之间的内在联系。通过这个实践，你将深刻理解流体为维持其沿曲面流动的路径，所必须建立的离心力与压力梯度平衡，以及如何将这一物理原理转化为数值模拟中精确的壁面边界条件。",
            "id": "3296213",
            "problem": "考虑一个二维、定常、无粘、可压缩流，该流动由欧拉方程控制，并邻近一个绝热、不可穿透的滑移壁面。设壁面局部由光滑曲线 $y(x)$ 表示，并引入一个局部标准正交标架，其单位切向量为 $\\mathbf{t}$，向外单位法向量为 $\\mathbf{n}$，其中坐标 $s$ 是沿壁面的弧长，$n$ 是垂直于壁面并指向流体内部的距离。流速 $\\mathbf{V}$ 分解为 $\\mathbf{V} = V_t \\mathbf{t} + V_n \\mathbf{n}$，滑移、不可穿透条件要求在壁面上 $V_n = 0$。对于比热比为 $\\gamma$、特定气体常数为 $R$ 的理想气体，声速为 $a = \\sqrt{\\gamma R T}$，密度为 $\\rho = p/(R T)$，其中 $p$ 是静压，$T$ 是静温。壁面处的切向流马赫数为 $M_t = V_t/a$。\n\n从投影到法向的无粘动量平衡和沿弯曲流线运动的运动学出发，推导一个相容性边界条件，该条件将壁面处法向压力梯度的大小 $|\\partial p/\\partial n|$ 表示为流动和壁面几何形状的函数。明确地将 $|\\partial p/\\partial n|$ 与切向速度 $V_t$ 和壁面曲率 $\\kappa_w$ 联系起来，其中有符号曲率定义为 $\\kappa_w = \\mathrm{d}\\theta/\\mathrm{d}s$，$\\theta(s)$ 是切线角；等效地，对于由函数图像 $y(x)$ 给出的壁面，其曲率大小为\n$$\n|\\kappa_w(x)| = \\frac{|y''(x)|}{\\left(1 + \\left(y'(x)\\right)^2\\right)^{3/2}}.\n$$\n仅使用无粘定常欧拉方程、牛顿第二定律和理想气体关系式作为基本依据。\n\n算法任务：实现一个程序，针对一组指定的测试用例，计算壁面处法向压力梯度的大小，\n$$\n\\left|\\frac{\\partial p}{\\partial n}\\right| = \\rho \\, V_t^2 \\, |\\kappa_w|,\n$$\n其中 $V_t = M_t \\, a$，$a = \\sqrt{\\gamma R T}$，以及 $\\rho = \\frac{p}{R T}$，使用在给定点 $x_0$ 处求值的 $y'(x)$ 和 $y''(x)$ 的解析表达式。所有输出必须以帕斯卡/米（$\\mathrm{Pa/m}$）为单位表示。最终数值答案必须打印并四舍五入到六位小数。\n\n测试套件：\n- 情况 A（标准情况，平直壁面）：$y(x) = 0$，$y'(x) = 0$，$y''(x) = 0$，$\\gamma = 1.4$，$R = 287$，$p = 100000$ $\\mathrm{Pa}$，$T = 300$ $\\mathrm{K}$，$M_t = 0.5$，$x_0 = 0$。\n- 情况 B（通过抛物线实现的平缓曲率）：$y(x) = \\dfrac{x^2}{2R_c}$，$y'(x) = \\dfrac{x}{R_c}$，$y''(x) = \\dfrac{1}{R_c}$，其中 $R_c = 2.0$ $\\mathrm{m}$，$\\gamma = 1.4$，$R = 287$，$p = 120000$ $\\mathrm{Pa}$，$T = 320$ $\\mathrm{K}$，$M_t = 0.8$，$x_0 = 0$。\n- 情况 C（通过圆形实现的跨声速曲率）：$y(x) = \\sqrt{R_c^2 - x^2}$，$y'(x) = -\\dfrac{x}{\\sqrt{R_c^2 - x^2}}$，$y''(x) = -\\dfrac{1}{\\sqrt{R_c^2 - x^2}} - \\dfrac{x^2}{\\left(R_c^2 - x^2\\right)^{3/2}}$，其中 $R_c = 1.5$ $\\mathrm{m}$，$\\gamma = 1.4$，$R = 287$，$p = 100000$ $\\mathrm{Pa}$，$T = 300$ $\\mathrm{K}$，$M_t = 1.0$，$x_0 = 0$。\n- 情况 D（大曲率和超声速，模拟激波相互作用风险）：$y(x) = \\dfrac{x^2}{2R_c}$，$y'(x) = \\dfrac{x}{R_c}$，$y''(x) = \\dfrac{1}{R_c}$，其中 $R_c = 0.05$ $\\mathrm{m}$，$\\gamma = 1.4$，$R = 287$，$p = 200000$ $\\mathrm{Pa}$，$T = 300$ $\\mathrm{K}$，$M_t = 2.5$，$x_0 = 0$。\n- 情况 E（近乎停滞的切向速度）：$y(x) = \\dfrac{x^2}{2R_c}$，$y'(x) = \\dfrac{x}{R_c}$，$y''(x) = \\dfrac{1}{R_c}$，其中 $R_c = 0.2$ $\\mathrm{m}$，$\\gamma = 1.4$，$R = 287$，$p = 100000$ $\\mathrm{Pa}$，$T = 300$ $\\mathrm{K}$，$M_t = 0.01$，$x_0 = 0$。\n\n您的程序应生成一行输出，其中包含情况 A 到 E 的结果，按顺序排列，形式为一个用方括号括起来的逗号分隔列表，例如 $[r_A,r_B,r_C,r_D,r_E]$，其中每个 $r_\\cdot$ 是计算出的 $|\\partial p/\\partial n|$ 的值，单位为 $\\mathrm{Pa/m}$，并四舍五入到六位小数。",
            "solution": "该问题是为定常、无粘、可压缩流在固体壁面处推导一个法向压力梯度的相容性边界条件，然后实现一个程序来为一组给定的测试用例计算该梯度。\n\n### 法向压力梯度边界条件的推导\n\n推导从无粘流体的定常欧拉动量方程开始，这是流体元的牛顿第二定律的表述：\n$$\n\\rho (\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = - \\nabla p\n$$\n其中 $\\rho$ 是流体密度，$\\mathbf{V}$ 是速度矢量，$p$ 是静压。\n\n为了分析弯曲壁面附近的流动，使用自然坐标系 $(s, n)$ 是有利的，其中 $s$ 是沿流线的弧长，$n$ 是垂直于流线的坐标。速度矢量与流线相切，因此 $\\mathbf{V} = V \\mathbf{t}$，其中 $V$ 是流速，$\\mathbf{t}$ 是单位切向量。\n\n加速度项 $(\\mathbf{V} \\cdot \\nabla) \\mathbf{V}$ 可以分解为切向和法向分量。速度矢量的对流导数由下式给出：\n$$\n(\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = V \\frac{\\partial (V \\mathbf{t})}{\\partial s} = V \\left( \\frac{\\partial V}{\\partial s} \\mathbf{t} + V \\frac{\\partial \\mathbf{t}}{\\partial s} \\right)\n$$\n根据微分几何，切向量对弧长的导数与流线曲率 $\\kappa$ 和主单位法向量 $\\mathbf{n}_{cc}$（指向曲率中心）有关：\n$$\n\\frac{\\partial \\mathbf{t}}{\\partial s} = \\kappa \\mathbf{n}_{cc}\n$$\n曲率 $\\kappa$ 是曲率半径 $R_c$ 的倒数，即 $\\kappa = 1/R_c$。将此代入加速度表达式中，得到：\n$$\n(\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = V \\frac{\\partial V}{\\partial s} \\mathbf{t} + \\kappa V^2 \\mathbf{n}_{cc}\n$$\n第一项表示沿流线的速度变化，第二项是使流体质点保持在其弯曲路径上所需的向心加速度。\n\n压力梯度 $\\nabla p$ 也可以在此坐标系中分解。欧拉动量方程变为：\n$$\n\\rho \\left( V \\frac{\\partial V}{\\partial s} \\mathbf{t} + \\kappa V^2 \\mathbf{n}_{cc} \\right) = - \\left( \\frac{\\partial p}{\\partial s} \\mathbf{t} + \\frac{\\partial p}{\\partial n} \\mathbf{n}_{cc} \\right)\n$$\n通过令法向 $\\mathbf{n}_{cc}$ 上的矢量分量相等，我们得到了法向动量平衡方程：\n$$\n\\rho \\kappa V^2 = - \\frac{\\partial p}{\\partial n}\n$$\n或\n$$\n\\frac{\\partial p}{\\partial n} = - \\rho \\kappa V^2\n$$\n这个基本关系表明，垂直于流线的压力梯度是平衡由其曲率产生的离心力所必需的。压力在与曲率中心相反的方向上增加。\n\n在固体的、不可穿透的壁面处，流动不能穿过它，因此速度的法向分量为零。对于无粘流，这意味着壁面本身就是一条流线。因此，在壁面上，流速完全是切向的，$V = V_t$，并且流线曲率等于壁面曲率，$\\kappa = \\kappa_w$。将这些代入法向动量方程，得到：\n$$\n\\left. \\frac{\\partial p}{\\partial n} \\right|_{\\text{wall}} = - \\rho_w \\kappa_w V_{t,w}^2\n$$\n问题要求的是该梯度的绝对值，即 $|\\partial p/\\partial n|$。取绝对值，我们得到：\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = |- \\rho_w \\kappa_w V_{t,w}^2|\n$$\n由于密度 $\\rho$ 和 $V_t^2$ 是非负的，这简化为：\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\rho_w V_{t,w}^2 |\\kappa_w|\n$$\n这就是所求的相容性边界条件，它将壁面处的法向压力梯度与当地的密度、切向速度和壁面曲率联系起来。\n\n### 算法计算\n\n算法任务是为几个测试用例计算 $|\\partial p/\\partial n|$。问题提供了所有必要的参数和关系。每个情况的计算过程如下：\n1.  使用为曲线 $y(x)$ 提供的公式，在指定点 $x_0$ 计算壁面曲率的大小 $|\\kappa_w|$：\n$$\n|\\kappa_w(x_0)| = \\frac{|y''(x_0)|}{\\left(1 + \\left(y'(x_0)\\right)^2\\right)^{3/2}}\n$$\n2.  使用理想气体定律计算流体密度 $\\rho$：\n$$\n\\rho = \\frac{p}{R T}\n$$\n3.  计算理想气体的声速 $a$：\n$$\na = \\sqrt{\\gamma R T}\n$$\n4.  根据切向马赫数 $M_t$ 确定切向速度 $V_t$：\n$$\nV_t = M_t a\n$$\n5.  最后，将这些值代入推导出的公式中：\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\rho V_t^2 |\\kappa_w|\n$$\n\n为了验证，将 $\\rho$、$a$ 和 $V_t$ 的表达式代入最终公式以获得简化表达式是很有启发性的：\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\left( \\frac{p}{R T} \\right) (M_t \\sqrt{\\gamma R T})^2 |\\kappa_w| = \\frac{p}{R T} M_t^2 (\\gamma R T) |\\kappa_w|\n$$\n$R T$ 项相互抵消，得到一个简洁而优雅的关系：\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = p \\, \\gamma \\, M_t^2 \\, |\\kappa_w|\n$$\n这个简化形式对于检查结果很有用。但是，实现过程将遵循问题陈述中指定的完整计算链来展示每一步。\n\n该实现将处理提供的测试用例，为每个用例计算 $|\\partial p/\\partial n|$，并按要求格式化结果。所有物理单位均采用国际单位制（SI），因此得到的压力梯度单位为帕斯卡/米（$\\mathrm{Pa/m}$）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the magnitude of the normal pressure gradient at a wall\n    for several test cases of compressible, inviscid flow.\n    \"\"\"\n\n    # Test cases are defined as tuples with the following structure:\n    # (p, T, Mt, gamma, R, y_prime_at_x0, y_double_prime_at_x0)\n    # where:\n    # p: static pressure (Pa)\n    # T: static temperature (K)\n    # Mt: tangential Mach number\n    # gamma: specific heat ratio\n    # R: specific gas constant (J/(kg*K))\n    # y_prime_at_x0: value of the first derivative of wall shape y(x) at x0\n    # y_double_prime_at_x0: value of the second derivative of wall shape y(x) at x0\n    \n    test_cases = [\n        # Case A: happy path, flat wall\n        (100000, 300, 0.5, 1.4, 287, 0.0, 0.0),\n        # Case B: gentle curvature via parabola (Rc = 2.0 m)\n        (120000, 320, 0.8, 1.4, 287, 0.0, 1.0 / 2.0),\n        # Case C: transonic curvature via circle (Rc = 1.5 m)\n        (100000, 300, 1.0, 1.4, 287, 0.0, -1.0 / 1.5),\n        # Case D: severe curvature and supersonic (Rc = 0.05 m)\n        (200000, 300, 2.5, 1.4, 287, 0.0, 1.0 / 0.05),\n        # Case E: near-stagnation tangential velocity (Rc = 0.2 m)\n        (100000, 300, 0.01, 1.4, 287, 0.0, 1.0 / 0.2),\n    ]\n\n    results = []\n\n    def calculate_dpdn(p, T, Mt, gamma, R, y_prime_val, y_double_prime_val):\n        \"\"\"Calculates |dp/dn| for a single case.\"\"\"\n        # 1. Calculate the magnitude of the wall curvature |kappa_w|\n        # |kappa_w(x)| = |y''(x)| / (1 + (y'(x))^2)^(3/2)\n        kappa_mag = np.abs(y_double_prime_val) / (1 + y_prime_val**2)**1.5\n\n        # If curvature is zero, the gradient is zero.\n        if kappa_mag == 0:\n            return 0.0\n\n        # 2. Calculate density rho\n        # rho = p / (R * T)\n        rho = p / (R * T)\n\n        # 3. Calculate speed of sound a\n        # a = sqrt(gamma * R * T)\n        a = np.sqrt(gamma * R * T)\n\n        # 4. Calculate tangential velocity Vt\n        # Vt = Mt * a\n        V_t = Mt * a\n\n        # 5. Calculate the magnitude of the normal pressure gradient\n        # |dp/dn| = rho * Vt^2 * |kappa_w|\n        dpdn_mag = rho * V_t**2 * kappa_mag\n        \n        return dpdn_mag\n\n    for case in test_cases:\n        p, T, Mt, gamma, R, y_prime_val, y_double_prime_val = case\n        result = calculate_dpdn(p, T, Mt, gamma, R, y_prime_val, y_double_prime_val)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The results are rounded to six decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "许多CFD模拟需要“开放”或“远场”边界，其理想目标是让流场中的波无反射地离开计算域，但这在实践中极具挑战性。本练习将这一挑战置于一个经典的拉伐尔喷管流动问题中，通过对比一个简单的数值外插方法和一个更复杂的基于特征线的出流条件，来探究边界条件选择的实际后果。你将通过分析不同边界条件下喷管内激波位置和波反射的差异，直观地体验到出流边界条件的选取如何显著影响可压缩流模拟的准确性和稳定性。",
            "id": "3296195",
            "problem": "需要对通过收敛-发散拉伐尔喷管的可压缩流动进行一维准定常分析，以对比两种出口边界条件对激波位置、激波后压力恢复和波反射的数值影响。喷管的几何形状由沿轴向坐标 $x \\in [0,L]$ 的面积分布 $A(x)$ 指定，喉部位于 $x_{\\mathrm{t}}$，出口位于 $x_{\\mathrm{e}}$。假设流动为无粘性、量热完全气体，其比热比 $\\gamma$ 为常数，理想气体常数归一化为1，因此声速 $a$、静温 $T$ 满足 $a^2 = \\gamma T$，状态方程为 $p = \\rho T$。入口处的滞止（总）参数为 $p_0$ 和 $T_0$，其归一化值为 $p_0 = 1$ 和 $T_0 = 1$。喷管面积由 $A(x) = 1 + 2.2\\,(x - 1.5)^2$ 给出，其中 $x \\in [0,3]$，因此 $L = 3$，$x_{\\mathrm{t}} = 1.5$，$A(x_{\\mathrm{t}}) = 1$，以及 $A(x_{\\mathrm{e}}) = A(3) = 5.95$。\n\n该算法必须从第一性原理出发。使用一维无粘欧拉方程及其考虑面积变化的准一维形式，来推导等熵流关系、正激波关系和基于特征线的边界行为。根据守恒定律和假设局部等熵区域由单个正激波分隔，构建等熵流管的面积-马赫数关系以及压力和温度的滞止-静态关系。对于正激波，使用从质量、动量和能量守恒推导出的 Rankine–Hugoniot 条件，将上游马赫数 $M_1$ 与下游马赫数 $M_2$ 以及压力跃升 $p_2/p_1$ 联系起来。在出口边界处，使用线性化的一维声学来定义出口介质的声阻抗 $Z = \\rho a$ 和边界的反射系数 $R = (Z_{\\mathrm{b}} - Z)/(Z_{\\mathrm{b}} + Z)$，其中边界阻抗为 $Z_{\\mathrm{b}}$，$Z_{\\mathrm{b}} \\to \\infty$ 近似硬反射（超声速出口外插，作用类似于高阻抗终端），而 $Z_{\\mathrm{b}} = Z$ 近似完全无反射终端（与入射特征线匹配的特征线出口）。\n\n定义要比较的两种边界条件：\n- 超声速出口外插边界条件：将出口近似为高阻抗终端，即 $Z_{\\mathrm{b}} \\gg Z$，这意味着强反射，$R \\approx 1$。\n- 特征线出口边界条件：将出口近似为阻抗匹配，即 $Z_{\\mathrm{b}} = Z$，这意味着最小反射，$R \\approx 0$。\n\n设外部背压为 $p_{\\mathrm{b}}$，设振幅为 $p_{\\mathrm{w}}$ 的小振幅出射声波冲击出口。将内部流动感受到的有效出口压力建模为 $p_{\\mathrm{eff}} = p_{\\mathrm{b}} + R\\,p_{\\mathrm{w}}$，其中 $R$ 取决于所选的边界条件。\n\n对于一个候选激波位置 $x_{\\mathrm{s}} \\in (x_{\\mathrm{t}}, x_{\\mathrm{e}})$，计算：\n1.  在 $x_{\\mathrm{s}}$ 处的上游超声速马赫数 $M_1$，使用面积-马赫数关系式的超声速分支，从喉部（$A^* = A(x_{\\mathrm{t}})$）开始走等熵路径。\n2.  根据欧拉方程和理想气体定律推导的等熵关系，从 $p_0$ 和 $M_1$ 计算上游静压 $p_1$。\n3.  应用正激波的 Rankine–Hugoniot 关系，计算 $x_{\\mathrm{s}}$ 处的下游马赫数 $M_2$ 和静压 $p_2$。\n4.  根据激波后区域的等熵关系，从 $p_2$ 和 $M_2$ 计算 $x_{\\mathrm{s}}$ 处的下游滞止压力 $p_{0,2}$。\n5.  从 $x_{\\mathrm{s}}$ 到出口 $x_{\\mathrm{e}}$ 的等熵亚声速演化：根据 $A(x_{\\mathrm{s}})$ 处的 $M_2$ 确定亚声速分支的有效激波后 $A^*$，然后在亚声速分支上找到 $A(x_{\\mathrm{e}})$ 处的 $M_{\\mathrm{e}}$，并从 $p_{0,2}$ 和 $M_{\\mathrm{e}}$ 计算出口静压 $p_{\\mathrm{e}}$。\n\n对于给定的 $p_{\\mathrm{eff}}$，将稳态激波位置 $x_{\\mathrm{s}}$ 定义为标量方程 $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ 在区间 $(x_{\\mathrm{t}}, x_{\\mathrm{e}})$ 上的根，并确认只有当 $p_{\\mathrm{eff}}$ 超过无激波的超声速分支所获得的完全膨胀超声速出口压力时，才存在物理上可接受的激波。\n\n每个测试用例下，每种边界条件需要报告的测量值：\n- 下游激波位置 $x_{\\mathrm{s}}$，浮点数（如果不存在内部激波，则使用 $-1.0$）。\n- 激波两侧的压力恢复 $p_2/p_1$，浮点数（如果不存在内部激波，则使用 $1.0$）。\n- 反射系数大小 $R$，浮点数。\n\n所有量都由入口滞止值进行无量纲化，因此不需要物理单位。不使用角度。\n\n实现一个完整、可运行的程序，该程序：\n- 当激波存在时，使用数值求根法计算上述量，否则报告无激波的指标。\n- 使用声阻抗模型计算每种边界条件的 $R$；对于超声速出口外插，将 $Z_{\\mathrm{b}}$ 近似为局部介质阻抗 $Z$ 的一个大倍数，以模拟高阻抗终端；对于特征线出口，使用 $Z_{\\mathrm{b}} = Z$。\n- 将指定测试套件的结果汇总为确切的最终输出格式。\n\n测试套件参数，以涵盖典型、近边界和边缘情况：\n- 案例 1：$\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.12$, $p_{\\mathrm{w}} = 0.01$。\n- 案例 2：$\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.05$, $p_{\\mathrm{w}} = 0.008$。\n- 案例 3：$\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.03$, $p_{\\mathrm{w}} = 0.005$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个列表的列表，每个子列表对应一个测试用例，每个子列表按顺序为 $[x_{\\mathrm{s}}^{\\mathrm{extrap}}, x_{\\mathrm{s}}^{\\mathrm{char}}, (p_2/p_1)^{\\mathrm{extrap}}, (p_2/p_1)^{\\mathrm{char}}, R^{\\mathrm{extrap}}, R^{\\mathrm{char}}]$，所有数字均打印为 Python 浮点数。例如，单行输出如 $[[v_{11},v_{12},v_{13},v_{14},v_{15},v_{16}],[v_{21},v_{22},v_{23},v_{24},v_{25},v_{26}],[v_{31},v_{32},v_{33},v_{34},v_{35},v_{36}]]$。",
            "solution": "该问题要求对拉伐尔喷管中的可压缩流动进行一维准定常分析，以确定在不同出口边界条件下正激波的位置。解决方案基于气体动力学的基本原理构建。\n\n### I. 等熵流动的控制原理\n流动被建模为无粘性、量热完全气体。在没有激波的区域，流动是等熵的。滞止性质和静态性质之间的关系由马赫数 $M = u/a$ 控制，其中 $u$ 是流速，$a = \\sqrt{\\gamma T}$ 是当地声速。给定归一化的入口滞止压力 $p_0=1$ 和温度 $T_0=1$，当地静压 $p$ 和静温 $T$ 为：\n$$ \\frac{p_0}{p} = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} \\implies p = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{-\\frac{\\gamma}{\\gamma-1}} $$\n$$ \\frac{T_0}{T} = 1 + \\frac{\\gamma-1}{2} M^2 \\implies T = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{-1} $$\n其中 $\\gamma$ 是比热比。\n\n对于准一维流动，在等熵条件下，质量和动量守恒导出了面积-马赫数关系，该关系将局部横截面积 $A$ 与马赫数 $M$ 联系起来。该关系以声速喉道面积 $A^*$ 为参考，此处 $M=1$：\n$$ \\frac{A}{A^*} = \\frac{1}{M} \\left[ \\frac{2}{\\gamma+1} \\left(1 + \\frac{\\gamma-1}{2} M^2 \\right) \\right]^{\\frac{\\gamma+1}{2(\\gamma-1)}} $$\n这个方程是关于 $M$ 的超越方程，必须进行数值求解。对于给定的面积比 $A/A^* > 1$，存在两个 $M$ 的解：一个是亚声速解（$M1$），另一个是超声速解（$M>1$）。喷管几何形状由 $A(x) = 1 + 2.2(x-1.5)^2$ 给出，喉部位于 $x_{\\mathrm{t}}=1.5$，此处 $A(x_{\\mathrm{t}})=1$。由于入口是一个大型储气室，我们假设流动在喉部达到壅塞状态，因此任何激波上游流动的参考声速面积为 $A^*=A(x_{\\mathrm{t}})=1$。\n\n### II. 正激波关系\n如果出现正激波，流动性质会发生突变的、非等熵的变化。跨越激波的关系式（Rankine-Hugoniot 条件）由质量、动量和能量守恒定律推导得出。下标 $1$ 表示激波正上游的条件，下标 $2$ 表示激波正下游的条件。\n下游马赫数 $M_2$ 是上游马赫数 $M_1$ 的函数：\n$$ M_2^2 = \\frac{M_1^2 + \\frac{2}{\\gamma-1}}{\\frac{2\\gamma}{\\gamma-1}M_1^2 - 1} $$\n激波只能在超声速流（$M_1 > 1$）中形成，而下游流动总是亚声速的（$M_2  1$）。\n跨越激波的静压比代表了压力恢复，其表达式为：\n$$ \\frac{p_2}{p_1} = \\frac{2\\gamma}{\\gamma+1}M_1^2 - \\frac{\\gamma-1}{\\gamma+1} $$\n跨越激波时，滞止压力会损失。新的下游滞止压力 $p_{0,2}$ 可以通过局部静态性质 $(p_2, M_2)$，利用等熵关系式求得：\n$$ p_{0,2} = p_2 \\left( 1 + \\frac{\\gamma-1}{2} M_2^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} $$\n\n### III. 内部有激波的流动建模\n为了找到给定有效背压 $p_{\\mathrm{eff}}$ 下的稳态激波位置 $x_{\\mathrm{s}}$，我们构建一个函数 $p_{\\mathrm{e}}(x_{\\mathrm{s}})$，该函数计算由位于 $x_{\\mathrm{s}}$ 的激波所产生的喷管出口压力。正确的 $x_{\\mathrm{s}}$ 是方程 $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ 的根。\n\n为候选激波位置 $x_{\\mathrm{s}} \\in (x_{\\mathrm{t}}, x_{\\mathrm{e}})$ 计算 $p_{\\mathrm{e}}(x_{\\mathrm{s}})$ 的算法如下：\n1.  **上游等熵流**：对于给定的 $x_{\\mathrm{s}}$，计算面积 $A(x_{\\mathrm{s}})$。由于从喉部到激波的流动是等熵的，面积比为 $A(x_{\\mathrm{s}})/A(x_{\\mathrm{t}})$。求解面积-马赫数关系，得到 $x_{\\mathrm{s}}$ 处的超声速马赫数 $M_1$。\n2.  **激波前静压**：使用等熵压力关系式，以及 $M_1$ 和 $p_0=1$，计算激波前的静压 $p_1$。\n3.  **正激波跃变**：应用 Rankine-Hugoniot 关系式，求出激波后的马赫数 $M_2$ 和静压 $p_2$。\n4.  **激波后滞止压力**：根据 $p_2$ 和 $M_2$ 计算激波后的滞止压力 $p_{0,2}$。\n5.  **下游等熵流**：从 $x_{\\mathrm{s}}$ 到出口 $x_{\\mathrm{e}}$ 的流动是亚声速且等熵的，受滞止压力 $p_{0,2}$ 控制。这个新的等熵流有一个不同的有效声速面积 $A_{2}^*$。我们通过在 $x_{\\mathrm{s}}$ 处应用面积-马赫数关系式，并使用面积 $A(x_{\\mathrm{s}})$ 和马赫数 $M_2$ 来找到 $A_{2}^*$。\n6.  **出口条件**：使用面积比 $A(x_{\\mathrm{e}})/A_{2}^*$（其中 $x_{\\mathrm{e}}=3$），求解面积-马赫数关系式，得到亚声速出口马赫数 $M_{\\mathrm{e}}$。\n7.  **出口静压**：使用等熵压力关系式，以及 $M_{\\mathrm{e}}$ 和激波后滞止压力 $p_{0,2}$，计算出口压力 $p_{\\mathrm{e}}$。这就是 $p_{\\mathrm{e}}(x_{\\mathrm{s}})$ 的值。\n\n### IV. 出口边界条件模型\n问题引入了一个声学模型用于出口边界，以确定有效背压 $p_{\\mathrm{eff}}$。\n-   **声阻抗**：$Z = \\rho a$。\n-   **反射系数**：$R = (Z_{\\mathrm{b}} - Z)/(Z_{\\mathrm{b}} + Z)$，其中 $Z_{\\mathrm{b}}$ 是外部介质的阻抗。\n-   **有效背压**：$p_{\\mathrm{eff}} = p_{\\mathrm{b}} + R \\, p_{\\mathrm{w}}$，其中 $p_{\\mathrm{b}}$ 是环境背压，$p_{\\mathrm{w}}$ 是出射声波的振幅。\n\n两种边界条件的建模如下：\n1.  **超声速出口外插**：这对应于高阻抗终端，$Z_{\\mathrm{b}} \\gg Z$。我们通过设置 $Z_{\\mathrm{b}} = K Z$ 并取一个大的常数 $K$（例如 $K=10^6$）来对此进行建模。反射系数为 $R^{\\mathrm{extrap}} = (K-1)/(K+1) \\approx 1$。\n2.  **特征线出口**：这对应于完全无反射的边界，$Z_{\\mathrm{b}} = Z$。反射系数为 $R^{\\mathrm{char}} = (1-1)/(1+1) = 0$。\n\n### V. 数值求解算法\n对于每个测试用例 $(\\gamma, p_{\\mathrm{b}}, p_{\\mathrm{w}})$ 和每种边界条件类型：\n1.  **计算 $R$ 和 $p_{\\mathrm{eff}}$**：确定边界条件的反射系数 $R$ 和有效压力 $p_{\\mathrm{eff}}$。\n2.  **检查激波是否存在**：只有当 $p_{\\mathrm{eff}}$ 位于特定范围内时，发散段内才会存在正激波。\n    -   最小压力 $p_{\\mathrm{min}}$ 对应于流动全程超声速至出口（激波位于出口下游）。这可以通过求解 $A(x_{\\mathrm{e}})$ 处的超声速 $M_{\\mathrm{e}}$ 的面积-马赫数关系，并计算相应的等熵静压来找到。\n    -   最大压力 $p_{\\mathrm{max}}$ 对应于整个喷管内的亚声速流动。这可以通过求解 $A(x_{\\mathrm{e}})$ 处的亚声速 $M_{\\mathrm{e}}$ 的面积-马赫数关系，并计算其等熵静压来找到。\n    -   如果 $p_{\\mathrm{min}}  p_{\\mathrm{eff}}  p_{\\mathrm{max}}$，则存在激波。否则，不会形成内部激波，我们报告默认值（$x_{\\mathrm{s}} = -1.0, p_2/p_1 = 1.0$）。\n3.  **寻找激波位置**：如果预期存在激波，则在区间 $(x_{\\mathrm{t}}, x_{\\mathrm{e}})$（即 $(1.5, 3.0)$）上求解非线性方程 $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ 以得到 $x_{\\mathrm{s}}$。像 Brent-Dekker 方法这样的数值求根方法是合适的。\n4.  **计算指标**：一旦找到激波位置 $x_{\\mathrm{s}}$，重新评估 $x_{\\mathrm{s}}$ 处的流动条件以计算压力恢复比 $p_2/p_1$。\n5.  **汇总并报告**：收集每个边界条件和测试用例的计算值（$x_{\\mathrm{s}}$, $p_2/p_1$, $|R|$），并按规定格式输出。\n\n该实现将依赖数值求根器来从面积比求解马赫数，以及从压力匹配条件求解激波位置。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the 1D quasi-steady compressible flow problem in a Laval nozzle\n    for different outflow boundary conditions.\n    \"\"\"\n\n    test_cases = [\n        # (gamma, p_b, p_w)\n        (1.4, 0.12, 0.01),\n        (1.4, 0.05, 0.008),\n        (1.4, 0.03, 0.005),\n    ]\n\n    # Nozzle geometry\n    nozzle_area = lambda x: 1.0 + 2.2 * (x - 1.5)**2\n    x_throat = 1.5\n    x_exit = 3.0\n\n    # Approximations for boundary conditions\n    K_extrap = 1e6  # Large factor for high-impedance approximation\n\n    # Helper function for area-Mach relation residual\n    def area_mach_residual(M, A_ratio, gamma):\n        if M == 0:\n            return -np.inf\n        term1 = 2 / (gamma + 1)\n        term2 = 1 + (gamma - 1) / 2 * M**2\n        return (A_ratio**2) - (1 / M**2) * (term1 * term2)**((gamma + 1) / (gamma - 1))\n\n    # Helper function to get Mach from Area Ratio\n    def get_mach_from_area_ratio(A_ratio, gamma, branch='supersonic'):\n        try:\n            if branch == 'supersonic':\n                # Search for M > 1\n                return brentq(area_mach_residual, 1.00001, 10.0, args=(A_ratio, gamma))\n            else: # subsonic\n                # Search for M  1\n                return brentq(area_mach_residual, 1e-6, 0.99999, args=(A_ratio, gamma))\n        except ValueError:\n            return np.nan\n\n    # Main function to calculate exit pressure given a shock location\n    def calculate_exit_pressure(x_s, gamma):\n        p0 = 1.0\n        A_t = nozzle_area(x_throat)\n        \n        # 1. Upstream Isentropic Flow\n        A_s = nozzle_area(x_s)\n        A_ratio_1 = A_s / A_t\n        M1 = get_mach_from_area_ratio(A_ratio_1, gamma, branch='supersonic')\n        if np.isnan(M1): return np.nan\n        \n        # 2. Pre-Shock Static Pressure\n        p1 = p0 * (1 + (gamma - 1) / 2 * M1**2)**(-gamma / (gamma - 1))\n\n        # 3. Normal Shock Jump\n        M1_sq = M1**2\n        M2_sq = (M1_sq + 2 / (gamma - 1)) / (2 * gamma / (gamma - 1) * M1_sq - 1)\n        M2 = np.sqrt(M2_sq)\n        p2 = p1 * (1 + 2 * gamma / (gamma + 1) * (M1_sq - 1))\n\n        # 4. Post-Shock Stagnation Pressure\n        p0_2 = p2 * (1 + (gamma - 1) / 2 * M2**2)**(gamma / (gamma - 1))\n\n        # 5. Downstream Isentropic Flow (find effective A*)\n        # Using area-mach relation at shock location with post-shock conditions\n        gm1 = gamma - 1\n        gp1 = gamma + 1\n        term = (1/M2) * ( (2/gp1) * (1 + gm1/2*M2**2) )**(gp1/(2*gm1))\n        A2_star = A_s / term\n\n        # 6. Exit Conditions\n        A_e = nozzle_area(x_exit)\n        A_ratio_2 = A_e / A2_star\n        M_e = get_mach_from_area_ratio(A_ratio_2, gamma, branch='subsonic')\n        if np.isnan(M_e): return np.nan\n\n        # 7. Exit Static Pressure\n        p_e = p0_2 * (1 + (gamma - 1) / 2 * M_e**2)**(-gamma / (gamma - 1))\n        \n        return p_e\n\n    # Residual for shock location root finding\n    def shock_location_residual(x_s, p_target, gamma):\n        p_e = calculate_exit_pressure(x_s, gamma)\n        if np.isnan(p_e):\n            # Penalize invalid x_s values to guide the solver\n            return 1e9 * (x_s - x_throat)\n        return p_e - p_target\n\n    final_results = []\n    \n    for gamma, p_b, p_w in test_cases:\n        p0 = 1.0\n        A_t = nozzle_area(x_throat)\n        A_e = nozzle_area(x_exit)\n        A_ratio_exit = A_e / A_t\n\n        # Calculate pressure bounds for shock existence\n        M_e_sup = get_mach_from_area_ratio(A_ratio_exit, gamma, branch='supersonic')\n        p_min = p0 * (1 + (gamma - 1) / 2 * M_e_sup**2)**(-gamma / (gamma - 1))\n\n        M_e_sub = get_mach_from_area_ratio(A_ratio_exit, gamma, branch='subsonic')\n        p_max = p0 * (1 + (gamma - 1) / 2 * M_e_sub**2)**(-gamma / (gamma - 1))\n        \n        case_results = []\n        \n        # Define BCs and their parameters\n        bcs = {\n            'extrap': {'K': K_extrap},\n            'char': {'K': 1.0}\n        }\n        \n        results_map = {}\n\n        for name, params in bcs.items():\n            K = params['K']\n            R = (K - 1) / (K + 1)\n            p_eff = p_b + R * p_w\n\n            if not (p_min  p_eff  p_max):\n                x_s_sol = -1.0\n                p_recovery = 1.0\n            else:\n                try:\n                    # Use a narrow but safe interval away from singularities\n                    x_s_sol = brentq(shock_location_residual, x_throat + 1e-6, x_exit - 1e-6, args=(p_eff, gamma))\n\n                    A_s_sol = nozzle_area(x_s_sol)\n                    A_ratio_sol = A_s_sol / A_t\n                    M1_sol = get_mach_from_area_ratio(A_ratio_sol, gamma, branch='supersonic')\n                    p_recovery = 1 + 2 * gamma / (gamma + 1) * (M1_sol**2 - 1)\n                except ValueError:\n                    # Root not bracketed, implies pressure is outside shock regime\n                    x_s_sol = -1.0\n                    p_recovery = 1.0\n            \n            results_map[name] = {\n                'xs': x_s_sol,\n                'pr': p_recovery,\n                'R': abs(R)\n            }\n        \n        # Assemble sublist in the required order\n        case_results.extend([\n            results_map['extrap']['xs'],\n            results_map['char']['xs'],\n            results_map['extrap']['pr'],\n            results_map['char']['pr'],\n            results_map['extrap']['R'],\n            results_map['char']['R']\n        ])\n        \n        final_results.append(case_results)\n\n    print(f\"{final_results}\")\n\nsolve()\n```"
        }
    ]
}