{
    "hands_on_practices": [
        {
            "introduction": "To build a solid foundation, we first connect the abstract concept of characteristic variables to the tangible physics of wave reflection. This practice challenges you to derive the fundamental acoustic reflection coefficient using the one-dimensional characteristic relations for pressure and velocity. Mastering this derivation provides the physical intuition necessary for designing boundary conditions that properly manage wave interactions.",
            "id": "3300347",
            "problem": "Consider a planar, stationary boundary at $x=0$ separating a quiescent, uniform, inviscid compressible medium occupying $x0$ from an external environment. In the medium, the density is $\\rho$ and the speed of sound is $a$, so the characteristic acoustic impedance of the medium is $Z_0=\\rho a$. A small-amplitude, time-harmonic plane acoustic wave of angular frequency $\\omega$ is normally incident on the boundary from the medium side ($x0$) and propagates in the $+x$ direction. The setting is subsonic, and the disturbance is sufficiently small for linear acoustics to be valid. The boundary is modeled as a linear acoustic impedance, defined by the relation $Z=\\Delta p/\\Delta u_n$ between the pressure fluctuation $\\Delta p$ and the normal velocity fluctuation $\\Delta u_n$ at the surface, where the normal direction is the $+x$ direction.\n\nWithin the framework of Computational Fluid Dynamics (CFD) and characteristic-based boundary conditions for subsonic regimes, start from the linearized one-dimensional equations of motion for compressible flow and the corresponding characteristic relations for small-amplitude plane waves. Using these foundations, derive the plane-wave reflection coefficient $R$ at $x=0$, defined as the complex amplitude ratio of the reflected pressure fluctuation to the incident pressure fluctuation at the boundary, expressed solely in terms of $Z$ and $Z_0$. Provide your final result as a single closed-form analytic expression. No numerical evaluation is required.",
            "solution": "The problem statement is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n-   **System**: A planar, stationary boundary at $x=0$.\n-   **Medium**: A quiescent, uniform, inviscid compressible medium for $x0$.\n-   **Medium Properties**: Density $\\rho$, speed of sound $a$.\n-   **Characteristic Impedance of Medium**: $Z_0 = \\rho a$.\n-   **Incident Wave**: A small-amplitude, time-harmonic plane acoustic wave of angular frequency $\\omega$.\n-   **Wave Propagation**: Normally incident on the boundary from $x0$, propagating in the $+x$ direction.\n-   **Physical Regime**: Subsonic, with disturbances small enough for linear acoustics to be valid.\n-   **Boundary Condition**: The boundary is a linear acoustic impedance, defined by the relation $Z = \\Delta p / \\Delta u_n$ at the surface.\n-   **Coordinates**: The normal direction is the $+x$ direction, so $\\Delta u_n$ is the velocity component in the $+x$ direction.\n-   **Objective**: Derive the plane-wave reflection coefficient $R$, defined as the complex amplitude ratio of the reflected pressure fluctuation to the incident pressure fluctuation at the boundary ($x=0$).\n-   **Constraint**: The expression for $R$ must be solely in terms of $Z$ and $Z_0$.\n-   **Starting Point**: The derivation must start from the linearized one-dimensional equations of motion for compressible flow and the corresponding characteristic relations for small-amplitude plane waves.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is set within the well-established framework of linear acoustics, which is derived from the fundamental principles of fluid dynamics (the Euler equations). The concepts of acoustic impedance, plane waves, and reflection coefficients are standard in physics and engineering. The setup is scientifically sound.\n-   **Well-Posed**: The problem provides a clear objective (derive $R$), defines all necessary quantities ($Z$, $Z_0$, $R$), and supplies the required boundary condition and physical relationships. It is structured to admit a unique and meaningful analytical solution.\n-   **Objective**: The language is formal, precise, and devoid of any subjective or opinion-based statements. All terms are standard technical definitions.\n-   **Completeness and Consistency**: The problem is self-contained. The provided information is sufficient and consistent for the derivation. For example, the assumption of small-amplitude waves justifies the use of linear equations, and the definition of impedance provides the necessary boundary condition.\n-   **Relevance**: The problem is directly relevant to the topic of characteristic-based boundary conditions in computational fluid dynamics, as it requires using the characteristic relations of the governing equations to solve a boundary interaction problem.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, objective, and internally consistent. A solution will be derived as requested.\n\n### Derivation\nThe derivation begins with the one-dimensional linearized Euler equations for an inviscid compressible flow, which govern the propagation of small acoustic disturbances. Let $\\Delta p(x,t)$ be the pressure fluctuation and $u(x,t)$ be the velocity fluctuation in the $x$-direction (equivalent to $\\Delta u_n$ as per the problem statement) around a quiescent state with mean density $\\rho$ and mean pressure $p_0$. The linearized continuity and momentum equations are:\n\n$$\n\\frac{\\partial (\\Delta \\rho)}{\\partial t} + \\rho \\frac{\\partial u}{\\partial x} = 0 \\quad (\\text{Continuity})\n$$\n$$\n\\rho \\frac{\\partial u}{\\partial t} + \\frac{\\partial (\\Delta p)}{\\partial x} = 0 \\quad (\\text{Momentum})\n$$\n\nFor small-amplitude acoustic waves, the process is isentropic, which relates pressure and density fluctuations via the speed of sound, $a$: $\\Delta p = a^2 \\Delta \\rho$. Substituting $\\Delta \\rho = \\Delta p / a^2$ into the continuity equation gives:\n\n$$\n\\frac{1}{a^2} \\frac{\\partial (\\Delta p)}{\\partial t} + \\rho \\frac{\\partial u}{\\partial x} = 0\n$$\n\nThe problem asks to use the characteristic relations. We form these from the two first-order partial differential equations for $\\Delta p$ and $u$. Adding and subtracting scaled versions of the momentum and modified continuity equations leads to the characteristic form:\n$$\n\\left( \\frac{\\partial}{\\partial t} + a \\frac{\\partial}{\\partial x} \\right) (\\Delta p + \\rho a u) = 0\n$$\n$$\n\\left( \\frac{\\partial}{\\partial t} - a \\frac{\\partial}{\\partial x} \\right) (\\Delta p - \\rho a u) = 0\n$$\nThese equations show that the quantity $\\Delta p + \\rho a u$ is constant along a characteristic path moving to the right ($dx/dt = a$), and the quantity $\\Delta p - \\rho a u$ is constant along a characteristic path moving to the left ($dx/dt = -a$).\n\nThe total acoustic field is a superposition of an incident wave (subscript $i$) propagating in the $+x$ direction and a reflected wave (subscript $r$) propagating in the $-x$ direction.\n$$\n\\Delta p(x,t) = \\Delta p_i(x,t) + \\Delta p_r(x,t)\n$$\n$$\nu(x,t) = u_i(x,t) + u_r(x,t)\n$$\n\nFor a pure right-propagating wave (the incident wave), the left-propagating invariant must be zero. This gives the relation:\n$$\n\\Delta p_i - \\rho a u_i = 0 \\implies \\Delta p_i = \\rho a u_i\n$$\nFor a pure left-propagating wave (the reflected wave), the right-propagating invariant must be zero. This gives:\n$$\n\\Delta p_r + \\rho a u_r = 0 \\implies \\Delta p_r = -\\rho a u_r\n$$\nThe quantity $Z_0 = \\rho a$ is the characteristic acoustic impedance of the medium. Thus, $\\Delta p_i = Z_0 u_i$ and $\\Delta p_r = -Z_0 u_r$.\n\nThe problem specifies time-harmonic plane waves of angular frequency $\\omega$. The pressure and velocity fields can be written in terms of their complex amplitudes (denoted by a hat) and the wave number $k = \\omega/a$:\n$$\n\\Delta p_i(x,t) = \\hat{p}_i \\exp(i(\\omega t - kx))\n$$\n$$\n\\Delta p_r(x,t) = \\hat{p}_r \\exp(i(\\omega t + kx))\n$$\nThe total pressure and velocity at any point are:\n$$\n\\Delta p(x,t) = \\hat{p}_i \\exp(i(\\omega t - kx)) + \\hat{p}_r \\exp(i(\\omega t + kx))\n$$\n$$\nu(x,t) = u_i(x,t) + u_r(x,t) = \\frac{1}{Z_0} \\Delta p_i(x,t) - \\frac{1}{Z_0} \\Delta p_r(x,t) = \\frac{1}{Z_0} \\left[ \\hat{p}_i \\exp(i(\\omega t - kx)) - \\hat{p}_r \\exp(i(\\omega t + kx)) \\right]\n$$\n\nAt the boundary $x=0$, the impedance $Z$ is defined by the relation $Z = \\Delta p(0,t) / u(0,t)$. We evaluate the total pressure and velocity at this boundary:\n$$\n\\Delta p(0,t) = \\hat{p}_i \\exp(i\\omega t) + \\hat{p}_r \\exp(i\\omega t) = (\\hat{p}_i + \\hat{p}_r) \\exp(i\\omega t)\n$$\n$$\nu(0,t) = \\frac{1}{Z_0} (\\hat{p}_i \\exp(i\\omega t) - \\hat{p}_r \\exp(i\\omega t)) = \\frac{1}{Z_0} (\\hat{p}_i - \\hat{p}_r) \\exp(i\\omega t)\n$$\nSubstituting these expressions into the definition of the boundary impedance $Z$:\n$$\nZ = \\frac{\\Delta p(0,t)}{u(0,t)} = \\frac{(\\hat{p}_i + \\hat{p}_r) \\exp(i\\omega t)}{\\frac{1}{Z_0} (\\hat{p}_i - \\hat{p}_r) \\exp(i\\omega t)} = Z_0 \\frac{\\hat{p}_i + \\hat{p}_r}{\\hat{p}_i - \\hat{p}_r}\n$$\n\nThe reflection coefficient $R$ is defined as the ratio of the complex amplitudes of the reflected and incident pressure waves at the boundary: $R = \\hat{p}_r / \\hat{p}_i$. We can now solve the impedance relation for $R$.\n$$\nZ = Z_0 \\frac{1 + (\\hat{p}_r / \\hat{p}_i)}{1 - (\\hat{p}_r / \\hat{p}_i)} = Z_0 \\frac{1 + R}{1 - R}\n$$\nRearranging to solve for $R$:\n$$\n\\frac{Z}{Z_0} = \\frac{1 + R}{1 - R}\n$$\n$$\n\\frac{Z}{Z_0} (1 - R) = 1 + R\n$$\n$$\n\\frac{Z}{Z_0} - \\frac{Z}{Z_0} R = 1 + R\n$$\n$$\n\\frac{Z}{Z_0} - 1 = R + \\frac{Z}{Z_0} R = R \\left( 1 + \\frac{Z}{Z_0} \\right)\n$$\n$$\n\\frac{Z - Z_0}{Z_0} = R \\left( \\frac{Z_0 + Z}{Z_0} \\right)\n$$\n$$\nZ - Z_0 = R (Z + Z_0)\n$$\n$$\nR = \\frac{Z - Z_0}{Z + Z_0}\n$$\nThis expression gives the complex reflection coefficient $R$ solely in terms of the boundary impedance $Z$ and the characteristic impedance of the medium $Z_0$, as required.",
            "answer": "$$\n\\boxed{\\frac{Z - Z_0}{Z + Z_0}}\n$$"
        },
        {
            "introduction": "In practice, multidimensional CFD codes often simplify boundary treatment by applying one-dimensional physics normal to the boundary, a method known as the Local One-Dimensional Inviscid (LODI) approximation. This exercise exposes a critical limitation of this common approach by tasking you with deriving the spurious reflection coefficient for an obliquely incident wave. Quantifying this error is crucial for understanding when such simplified boundary conditions are appropriate and when they may contaminate a numerical solution.",
            "id": "3300367",
            "problem": "Consider a two-dimensional inviscid, compressible fluid at rest with uniform base density $\\rho_{0}$ and sound speed $c$. Small-amplitude acoustic disturbances $p'$, $u'$, and $v'$ evolve according to the linearized Euler equations about this quiescent state, with $p' = c^{2} \\rho'$ as the thermodynamic closure. A semi-infinite computational domain occupies $\\{(x,y) \\in \\mathbb{R}^{2} : x  0\\}$ and is bounded by a planar outlet boundary at $x = 0$ whose outward normal is the $+x$ direction.\n\nThe boundary employs the Local One-Dimensional Inviscid (LODI) approximation, which enforces a one-dimensional, normal-direction acoustic non-reflecting condition by setting the incoming normal-direction characteristic to zero at $x = 0$. An incident time-harmonic acoustic plane wave of angular frequency $\\omega$ propagates within the domain towards the boundary with wavevector $\\boldsymbol{k} = (k_{x}, k_{y})$, where $k = |\\boldsymbol{k}|$ and the incidence angle $\\theta \\in [0,\\pi/2]$ is defined by $\\cos\\theta = k_{x}/k$ and $\\sin\\theta = k_{y}/k$ relative to the outward normal. Assume there is no mean flow (thus subsonic), and model the reflected field as a single specularly reflected plane wave consistent with linear acoustics.\n\nStarting from the two-dimensional linearized Euler equations and the acoustic plane-wave relations implied by them, derive the reflection coefficient predicted by the one-dimensional LODI boundary condition, defined as the complex amplitude ratio $R(\\theta) = p_{r}/p_{i}$ of the reflected to incident pressure at the boundary, as a function of the incidence angle $\\theta$. Express $\\theta$ in radians. Provide the final expression for $R(\\theta)$; no numerical evaluation or rounding is required.",
            "solution": "The problem asks for the derivation of the reflection coefficient $R(\\theta)$ for a time-harmonic acoustic plane wave incident on a boundary at $x=0$, where a Local One-Dimensional Inviscid (LODI) boundary condition is applied. The fluid is initially at rest, and the analysis is based on the two-dimensional linearized Euler equations.\n\nThe governing equations for small-amplitude disturbances $p'$, $\\rho'$, $u'$, and $v'$ in a quiescent medium with base density $\\rho_0$ and sound speed $c$ are the linearized Euler equations:\nContinuity:\n$$\n\\frac{\\partial \\rho'}{\\partial t} + \\rho_0 \\left(\\frac{\\partial u'}{\\partial x} + \\frac{\\partial v'}{\\partial y}\\right) = 0\n$$\nx-Momentum:\n$$\n\\rho_0 \\frac{\\partial u'}{\\partial t} + \\frac{\\partial p'}{\\partial x} = 0\n$$\ny-Momentum:\n$$\n\\rho_0 \\frac{\\partial v'}{\\partial t} + \\frac{\\partial p'}{\\partial y} = 0\n$$\nThe system is closed with the isentropic relation for acoustic waves, $p' = c^{2} \\rho'$. Using this, the continuity equation can be rewritten in terms of pressure perturbation $p'$:\n$$\n\\frac{1}{c^2}\\frac{\\partial p'}{\\partial t} + \\rho_0 \\left(\\frac{\\partial u'}{\\partial x} + \\frac{\\partial v'}{\\partial y}\\right) = 0\n$$\nWe consider time-harmonic plane wave solutions of the form $q'(x,y,t) = \\hat{q} \\exp(i(\\boldsymbol{k} \\cdot \\boldsymbol{x} - \\omega t))$, where $q'$ represents any of the perturbation variables ($p'$, $u'$, $v'$) and $\\hat{q}$ is its complex amplitude. Here, $\\boldsymbol{k} = (k_x, k_y)$ is the wavevector, $\\boldsymbol{x}=(x,y)$, and $\\omega$ is the angular frequency. Substituting these forms into the momentum equations yields:\n$$\n-i\\omega \\rho_0 \\hat{u} + ik_x \\hat{p} = 0 \\implies \\hat{u} = \\frac{k_x}{\\rho_0 \\omega} \\hat{p}\n$$\n$$\n-i\\omega \\rho_0 \\hat{v} + ik_y \\hat{p} = 0 \\implies \\hat{v} = \\frac{k_y}{\\rho_0 \\omega} \\hat{p}\n$$\nSubstituting these into the pressure form of the continuity equation gives the acoustic dispersion relation $\\omega = ck$. Thus, the velocity amplitudes can be expressed as:\n$$\n\\hat{u} = \\frac{k_x}{\\rho_0 c k} \\hat{p}, \\quad \\hat{v} = \\frac{k_y}{\\rho_0 c k} \\hat{p}\n$$\n\nThe total acoustic field is a superposition of the incident and reflected waves.\nThe incident wave propagates towards the boundary at $x=0$ from the domain $x0$, so its wavevector is $\\boldsymbol{k}_i = (k_x, k_y)$ with $k_x  0$. The incidence angle $\\theta$ is given by $\\cos\\theta = k_x/k$ and $\\sin\\theta = k_y/k$. The fields are:\n$$\np_i'(x,y,t) = p_i \\exp(i(k_x x + k_y y - \\omega t))\n$$\n$$\nu_i'(x,y,t) = \\frac{k_x}{\\rho_0 c k} p_i' = \\frac{\\cos\\theta}{\\rho_0 c} p_i'\n$$\nThe reflected wave propagates away from the boundary. According to the principle of specular reflection, the tangential component of the wavevector is conserved ($k_{ry} = k_y$), while the normal component reverses sign ($k_{rx} = -k_x$). The reflected wavevector is $\\boldsymbol{k}_r = (-k_x, k_y)$. The reflected fields are:\n$$\np_r'(x,y,t) = p_r \\exp(i(-k_x x + k_y y - \\omega t))\n$$\n$$\nu_r'(x,y,t) = \\frac{-k_x}{\\rho_0 c k} p_r' = -\\frac{\\cos\\theta}{\\rho_0 c} p_r'\n$$\nwhere $p_i$ and $p_r$ are the complex pressure amplitudes at the origin $(0,0)$. The reflection coefficient is defined as $R(\\theta) = p_r/p_i$.\n\nThe LODI boundary condition approximates the physics at the boundary by considering only the 1D Euler equations normal to it, setting $\\partial/\\partial y = 0$. Using the primitive variables $(p', u', v')$, the system $\\frac{\\partial \\boldsymbol{q}'}{\\partial t} + A_x \\frac{\\partial \\boldsymbol{q}'}{\\partial x} = 0$ is governed by the matrix:\n$$\nA_x = \\begin{pmatrix} 0  \\rho_0 c^2  0 \\\\ 1/\\rho_0  0  0 \\\\ 0  0  0 \\end{pmatrix}\n$$\nThe eigenvalues of $A_x$ are $\\lambda = \\{c, -c, 0\\}$, representing the speeds of characteristics propagating in the $x$-direction. The domain is $x0$, so the outward normal is in the $+x$ direction. An incoming characteristic is one that propagates into the domain, which corresponds to a negative propagation speed. Thus, the incoming characteristic corresponds to the eigenvalue $\\lambda = -c$. The associated left eigenvector is $\\boldsymbol{l}_2^T = [1, -\\rho_0 c, 0]$.\nThe incoming characteristic quantity is $\\mathcal{L}_2 = \\boldsymbol{l}_2^T \\cdot \\boldsymbol{q}' = p' - \\rho_0 c u'$. The LODI boundary condition sets this incoming characteristic to zero at the boundary $x=0$:\n$$\np'(0,y,t) - \\rho_0 c u'(0,y,t) = 0\n$$\nThe total pressure and normal velocity at the boundary are $p' = p_i' + p_r'$ and $u' = u_i' + u_r'$. Substituting these into the boundary condition at $x=0$:\n$$\n(p_i'(0,y,t) + p_r'(0,y,t)) - \\rho_0 c (u_i'(0,y,t) + u_r'(0,y,t)) = 0\n$$\nThe phase factor $\\exp(i(k_y y - \\omega t))$ is common to all terms and can be canceled. We are left with an equation for the complex amplitudes:\n$$\n(p_i + p_r) - \\rho_0 c \\left( \\frac{\\cos\\theta}{\\rho_0 c} p_i - \\frac{\\cos\\theta}{\\rho_0 c} p_r \\right) = 0\n$$\nSimplifying the expression:\n$$\n(p_i + p_r) - \\cos\\theta (p_i - p_r) = 0\n$$\n$$\np_i + p_r - p_i\\cos\\theta + p_r\\cos\\theta = 0\n$$\nGrouping terms with $p_i$ and $p_r$:\n$$\np_i(1 - \\cos\\theta) + p_r(1 + \\cos\\theta) = 0\n$$\nWe solve for the reflection coefficient $R(\\theta) = p_r/p_i$:\n$$\np_r(1 + \\cos\\theta) = -p_i(1 - \\cos\\theta)\n$$\n$$\nR(\\theta) = \\frac{p_r}{p_i} = -\\frac{1 - \\cos\\theta}{1 + \\cos\\theta}\n$$\nThis is the reflection coefficient predicted by the one-dimensional LODI boundary condition as a function of the incidence angle $\\theta$.",
            "answer": "$$\n\\boxed{-\\frac{1 - \\cos\\theta}{1 + \\cos\\theta}}\n$$"
        },
        {
            "introduction": "Beyond the one-dimensional approximation, another common simplification in characteristic-based boundary conditions is linearization. This hands-on computational exercise requires you to quantify the breakdown of this assumption for finite-amplitude waves. By comparing the velocity prescribed by a linearized acoustic relation against the exact value from the nonlinear Riemann invariant, you will directly measure the error introduced by ignoring nonlinearity in practical flow control.",
            "id": "3300321",
            "problem": "You are to analyze the consistency and accuracy of Characteristic-Based Boundary Conditions (CBC) in subsonic regimes for one-dimensional, isentropic, compressible flow of an ideal gas. Specifically, you will quantify the breakdown of a linearized boundary control law under finite-amplitude disturbances by comparing it with the exact nonlinear control obtained from Riemann invariants. Your analysis must be implemented as a runnable program that computes measurable discrepancies for a set of prescribed test cases.\n\nStart from the following foundational base:\n- The governing equations are the one-dimensional, isentropic compressible Euler equations for an ideal gas with ratio of specific heats $\\gamma$.\n- The speed of sound is $a = \\sqrt{\\gamma p / \\rho}$.\n- The equation of state is $p = K \\rho^\\gamma$ for some constant $K$ along isentropes.\n- Riemann invariants for one-dimensional isentropic flow are $J_{+} = u + \\dfrac{2 a}{\\gamma - 1}$ and $J_{-} = u - \\dfrac{2 a}{\\gamma - 1}$, where $u$ is the velocity and $a$ is the local speed of sound. Along right-running characteristics, $J_{-}$ is constant; along left-running characteristics, $J_{+}$ is constant.\n- In linear acoustics near a uniform base state with density $\\rho_{0}$, pressure $p_{0}$, velocity $u_{0} = 0$, and speed of sound $a_{0} = \\sqrt{\\gamma p_{0} / \\rho_{0}}$, the plane-wave relation for a right-going disturbance is $u' = \\dfrac{p'}{\\rho_{0} a_{0}}$ and $p' = a_{0}^{2} \\rho'$, where $'$ denotes a small perturbation.\n\nConsider a subsonic inflow boundary at $x = 0$ feeding a right-running wave into the domain. The desired target is a right-running isentropic simple wave of finite amplitude that maintains the outgoing Riemann invariant $J_{-}$ equal to its base value while modifying $J_{+}$. A practical CBC attempts to impose the incoming data to realize this wave. Two control laws are to be compared:\n- Exact nonlinear invariant control: Uses the constancy of $J_{-}$ together with isentropic relations to produce the correct velocity $u$ corresponding to a prescribed density ratio $r = \\rho / \\rho_{0}$ at the boundary.\n- Linearized acoustic control: Uses the linear plane-wave relation to map the same target density ratio $r$ to a boundary velocity consistent with linear acoustics.\n\nYour tasks:\n1. Derive from the above foundations the exact nonlinear velocity $u_{\\text{exact}}(r)$ corresponding to a right-running isentropic simple wave that preserves $J_{-}$ at its base value when the boundary state has density ratio $r = 1 + \\varepsilon$ relative to the base state. Express $u_{\\text{exact}}$ in terms of $r$, $\\gamma$, and $a_{0}$ only.\n2. Derive from the linear acoustic relations a linearized control $u_{\\text{lin}}(r)$ that maps a given density ratio $r$ to a boundary velocity. Express $u_{\\text{lin}}$ in terms of $r$ and $a_{0}$ only.\n3. For the linearized control applied at the boundary, compute the induced violation of the outgoing invariant $J_{-}$ relative to its base value. Define the residual\n$$\n\\delta J_{-}(r) = \\left[u_{\\text{lin}}(r) - \\frac{2 a(r)}{\\gamma - 1}\\right] - \\left[u_{0} - \\frac{2 a_{0}}{\\gamma - 1}\\right],\n$$\nwhere $a(r)$ is the local speed of sound consistent with the isentropic relation at density ratio $r$ and $u_{0} = 0$. Then compute a dimensionless normalized residual\n$$\ne_{\\text{RI}}(r) = \\frac{|\\delta J_{-}(r)|}{\\dfrac{2 a_{0}}{\\gamma - 1}\\,|r - 1|}.\n$$\nThis quantity measures, per unit density amplitude, how strongly the linearized control violates the exact nonlinear invariant that should be preserved by a right-running simple wave.\n4. Quantify the control mismatch between the two controls via the absolute relative velocity error\n$$\ne_{u}(r) = \\frac{|u_{\\text{lin}}(r) - u_{\\text{exact}}(r)|}{|u_{\\text{exact}}(r)|}.\n$$\n5. Assume a uniform base state with $\\gamma = 1.4$, $\\rho_{0} = 1.0$ in $\\mathrm{kg/m^{3}}$, $p_{0} = 100000$ in $\\mathrm{Pa}$, and $u_{0} = 0$ in $\\mathrm{m/s}$. All output metrics are dimensionless and must be reported without units.\n\nImplement a program that:\n- Uses the above base state and computes $a_{0}$.\n- For each test case listed below, forms $r = 1 + \\varepsilon$, computes $a(r)$, $u_{\\text{exact}}(r)$, $u_{\\text{lin}}(r)$, and then computes the two metrics $e_{u}(r)$ and $e_{\\text{RI}}(r)$.\n- Produces a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order: for each test case in sequence, append first $e_{u}(r)$ and then $e_{\\text{RI}}(r)$. Thus, if there are $N$ test cases, the output list has length $2N$.\n\nTest suite:\n- Case $1$: $\\varepsilon = 0.2$.\n- Case $2$: $\\varepsilon = -0.2$.\n- Case $3$: $\\varepsilon = 10^{-6}$.\n- Case $4$: $\\varepsilon = 0.4$.\n- Case $5$: $\\varepsilon = -0.4$.\n\nYour program must not require any input, must not read or write files, and must use only the specified runtime environment. All results must be printed as dimensionless numbers.",
            "solution": "The problem requires an analysis of the discrepancy between a nonlinear characteristic-based boundary condition and its linearization for one-dimensional isentropic flow. The analysis is performed by deriving the exact and linearized control laws and then computing two error metrics for a given set of parameters.\n\nThe foundational equations provided are the one-dimensional isentropic Euler equations. The state of the gas is described by its velocity $u$, density $\\rho$, and pressure $p$. The ratio of specific heats is $\\gamma$. The local speed of sound is $a = \\sqrt{\\gamma p / \\rho}$. For isentropic transformations, $p/\\rho^\\gamma$ is constant. The Riemann invariants are $J_{\\pm} = u \\pm \\frac{2a}{\\gamma-1}$. For a wave propagating to the right (a right-running characteristic), $J_{-}$ is constant.\n\nThe base state is a uniform medium at rest, with $u_{0}=0$, $\\rho_{0}$, $p_{0}$, and sound speed $a_{0} = \\sqrt{\\gamma p_{0} / \\rho_{0}}$. We consider a subsonic inflow boundary at $x=0$ that generates a right-running simple wave. The defining property of this wave is that the outgoing Riemann invariant, $J_{-}$, remains constant and equal to its value in the base state.\n\n**1. Derivation of the Exact Nonlinear Velocity $u_{\\text{exact}}(r)$**\n\nFor a right-running simple wave, the Riemann invariant $J_{-} = u - \\frac{2a}{\\gamma-1}$ is constant. Its value is set by the undisturbed base state:\n$$J_{-, \\text{base}} = u_{0} - \\frac{2 a_{0}}{\\gamma - 1} = 0 - \\frac{2 a_{0}}{\\gamma - 1} = -\\frac{2 a_{0}}{\\gamma - 1}$$\nAt the boundary, the state is $(u, \\rho, a)$, and this state must satisfy the same invariant condition:\n$$u - \\frac{2a}{\\gamma-1} = -\\frac{2 a_{0}}{\\gamma - 1}$$\nThis velocity $u$ is the exact velocity required to launch a pure simple wave, which we denote $u_{\\text{exact}}$. Solving for $u_{\\text{exact}}$ gives:\n$$u_{\\text{exact}} = \\frac{2}{\\gamma-1} (a - a_{0})$$\nTo express this in terms of the density ratio $r = \\rho/\\rho_{0}$, we use the isentropic relations. The pressure is $p = p_{0} (\\rho/\\rho_{0})^\\gamma = p_{0} r^\\gamma$. The local speed of sound $a$ is:\n$$a = \\sqrt{\\frac{\\gamma p}{\\rho}} = \\sqrt{\\frac{\\gamma (p_{0} r^\\gamma)}{(\\rho_{0} r)}} = \\sqrt{\\left(\\frac{\\gamma p_{0}}{\\rho_{0}}\\right) r^{\\gamma-1}} = a_{0} \\sqrt{r^{\\gamma-1}} = a_{0} r^{(\\gamma-1)/2}$$\nSubstituting this expression for $a$ into the equation for $u_{\\text{exact}}$ yields the final form of the nonlinear control law:\n$$u_{\\text{exact}}(r) = \\frac{2 a_{0}}{\\gamma-1} \\left( r^{(\\gamma-1)/2} - 1 \\right)$$\n\n**2. Derivation of the Linearized Acoustic Velocity $u_{\\text{lin}}(r)$**\n\nThe linearized control law is based on linear acoustic theory for small perturbations $(\\rho', p', u')$ around the base state $(u_{0}=0, \\rho_{0}, p_{0})$. For a right-going plane wave, the relations are $u' = p' / (\\rho_0 a_0)$ and $p' = a_0^2 \\rho'$.\nThe velocity at the boundary is $u_{\\text{lin}} = u'$. The density perturbation $\\rho'$ is related to the density ratio $r$ by:\n$$r = \\frac{\\rho}{\\rho_{0}} = \\frac{\\rho_{0} + \\rho'}{\\rho_{0}} = 1 + \\frac{\\rho'}{\\rho_{0}} \\implies \\rho' = \\rho_{0} (r-1)$$\nUsing the linear acoustic relations, we can find the velocity $u'$ corresponding to this density perturbation:\n$$u_{\\text{lin}}(r) = u' = \\frac{p'}{\\rho_{0} a_{0}} = \\frac{a_{0}^2 \\rho'}{\\rho_{0} a_{0}} = a_{0} \\frac{\\rho'}{\\rho_{0}} = a_{0} (r-1)$$\nThis is the linearized control law.\n\n**3. Formulation of Error Metrics**\n\nWe now formulate the two required error metrics.\n\nThe residual of the outgoing invariant $J_{-}$ when applying the linearized control is defined as:\n$$\\delta J_{-}(r) = \\left[u_{\\text{lin}}(r) - \\frac{2 a(r)}{\\gamma - 1}\\right] - \\left[u_{0} - \\frac{2 a_{0}}{\\gamma - 1}\\right]$$\nAs shown in the derivation of $u_{\\text{exact}}$, the condition for a perfect simple wave is $u_{\\text{exact}}(r) - \\frac{2 a(r)}{\\gamma-1} = u_0 - \\frac{2 a_0}{\\gamma-1}$. We can rearrange this to $\\frac{2 a(r)}{\\gamma-1} = u_{\\text{exact}}(r) - u_0 + \\frac{2 a_0}{\\gamma-1}$. Substituting this into the expression for $\\delta J_{-}(r)$ and using $u_0=0$ leads to a significant simplification:\n$$\\delta J_{-}(r) = u_{\\text{lin}}(r) - \\left(u_{\\text{exact}}(r) - u_0 + \\frac{2 a_0}{\\gamma-1}\\right) - \\left(u_0 - \\frac{2 a_0}{\\gamma-1}\\right) = u_{\\text{lin}}(r) - u_{\\text{exact}}(r)$$\nThe normalized residual $e_{\\text{RI}}(r)$ is therefore:\n$$e_{\\text{RI}}(r) = \\frac{|\\delta J_{-}(r)|}{\\frac{2 a_{0}}{\\gamma - 1}\\,|r - 1|} = \\frac{|u_{\\text{lin}}(r) - u_{\\text{exact}}(r)|}{\\frac{2 a_{0}}{\\gamma - 1}\\,|r - 1|}$$\nThe absolute relative velocity error $e_{u}(r)$ is given directly by its definition:\n$$e_{u}(r) = \\frac{|u_{\\text{lin}}(r) - u_{\\text{exact}}(r)|}{|u_{\\text{exact}}(r)|}$$\n\n**4. Implementation Plan**\n\nThe program will first compute the base state sound speed $a_{0}$ from the given values $\\gamma=1.4$, $p_0=100000\\,\\text{Pa}$, and $\\rho_0=1.0\\,\\text{kg/m}^3$. Then, for each specified value of $\\varepsilon$ in the test suite, it will:\n1.  Calculate the density ratio $r = 1 + \\varepsilon$.\n2.  Compute $u_{\\text{exact}}(r)$ using the derived formula.\n3.  Compute $u_{\\text{lin}}(r)$ using its derived formula.\n4.  Calculate the two error metrics, $e_{u}(r)$ and $e_{\\text{RI}}(r)$, using their definitions above.\n5.  Store the results in the required order for final output.\nAll calculations are performed with floating-point numbers. The final list of results is formatted into a single string as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the discrepancy between nonlinear and linearized characteristic\n    boundary conditions for 1D isentropic compressible flow.\n    \"\"\"\n    # Define constants and base state parameters from the problem statement.\n    gamma = 1.4\n    rho0 = 1.0  # kg/m^3\n    p0 = 100000.0  # Pa\n    u0 = 0.0  # m/s\n\n    # Define the test cases from the problem statement.\n    # Each case is a value for the perturbation amplitude epsilon.\n    test_cases_eps = [0.2, -0.2, 1e-6, 0.4, -0.4]\n\n    # Calculate base state speed of sound.\n    a0 = np.sqrt(gamma * p0 / rho0)\n\n    results = []\n    \n    # Pre-calculate the exponent for the isentropic relation for 'a'.\n    # exponent = (gamma - 1) / 2\n    exponent = 0.2\n\n    # Loop through each test case.\n    for eps in test_cases_eps:\n        # The density ratio r.\n        r = 1.0 + eps\n\n        # Task 1: Calculate the exact nonlinear velocity u_exact(r).\n        # u_exact(r) = (2 * a0 / (gamma - 1)) * (r^((gamma-1)/2) - 1)\n        u_exact = (2.0 * a0 / (gamma - 1.0)) * (np.power(r, exponent) - 1.0)\n        \n        # Task 2: Calculate the linearized acoustic velocity u_lin(r).\n        # u_lin(r) = a0 * (r - 1)\n        u_lin = a0 * (r - 1.0)\n\n        # The difference between linear and exact velocities, which is also\n        # the residual of the Riemann invariant, delta_J_minus.\n        velocity_mismatch = u_lin - u_exact\n\n        # Task 4: Calculate the relative velocity error, e_u(r).\n        # e_u(r) = |u_lin(r) - u_exact(r)| / |u_exact(r)|\n        # Handle the case where u_exact is zero (eps=0), though not in test suite.\n        if np.abs(u_exact)  1e-15:\n            e_u = 0.0\n        else:\n            e_u = np.abs(velocity_mismatch) / np.abs(u_exact)\n        \n        # Task 3: Calculate the normalized Riemann invariant residual, e_RI(r).\n        # e_RI(r) = |delta_J_minus(r)| / ( (2*a0/(gamma-1)) * |r-1| )\n        # Denominator is zero if r=1 (eps=0).\n        if np.abs(r - 1.0)  1e-15:\n            # Taylor expansion shows the limit is 0.5 for r->1\n            e_RI = 0.5\n        else:\n            normalization_factor_RI = (2.0 * a0 / (gamma - 1.0)) * np.abs(r - 1.0)\n            e_RI = np.abs(velocity_mismatch) / normalization_factor_RI\n        \n        # Append results in the specified order: e_u followed by e_RI.\n        results.append(e_u)\n        results.append(e_RI)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}