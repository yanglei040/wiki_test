{
    "hands_on_practices": [
        {
            "introduction": "要从根本上理解无反射边界条件的必要性，最好的方法是直接比较一个简单的（但通常不正确的）边界条件和一个基础的无反射边界条件所产生的效果。本练习旨在通过分析和量化一维波动方程中著名的 Dirichlet 边界条件和一阶阻抗匹配边界条件所产生的虚假反射，来巩固这一核心概念 ()。通过推导离散反射系数，您将亲身体验到不同边界处理方式对数值解精度的巨大影响。",
            "id": "3349612",
            "problem": "考虑定义在半无限域 $x \\ge 0$ 上的一维波动方程 $u_{tt} = c^2 u_{xx}$。场 $u$ 在一个均匀网格上进行离散化，空间步长为 $\\Delta x$，时间步长为 $\\Delta t$，记为 $u_j^n \\approx u(x_j,t_n)$，其中 $x_j = j \\Delta x$ 且 $t_n = n \\Delta t$。内部点的更新采用在时间和空间上均为二阶精度的中心差分格式，该格式根据一个标准的显式模板来推进 $u_j^n$。库朗-弗里德里希斯-列维 (Courant–Friedrichs–Lewy, CFL) 数定义为 $\\lambda = \\dfrac{c \\Delta t}{\\Delta x}$。\n\n您将分析一个时谐平面波入射到边界 $j=0$ 时的离散反射情况，考虑两种边界闭合方案：\n\n- 简单的狄利克雷 (Dirichlet) 边界，强制对所有整数 $n$ 满足 $u_0^n = 0$。\n- 在 $j=0$ 处的一阶阻抗匹配 (Sommerfeld 型) 边界闭合，它使用中心时间差分和单边空间差分，强制满足\n$$\n\\frac{u_0^{n+1} - u_0^{n-1}}{2 \\Delta t} - c \\, \\frac{u_1^n - u_0^n}{\\Delta x} = 0.\n$$\n\n角度必须以弧度表示。\n\n从离散的内部点更新格式以及入射和反射离散平面波的叠加出发，您必须：\n\n1. 使用平面波拟设 (plane-wave ansatz) 和内部模板，推导连接离散时间频率、离散波数和 CFL 数的离散色散关系。\n2. 通过将每个边界闭合条件应用于叠加的入射波和反射波，为狄利克雷边界和阻抗匹配边界构建在 $j=0$ 处的离散反射系数。反射系数 $R$ 定义为反射波与入射波的复振幅之比。\n3. 使用推导出的表达式，为下面指定的一组测试用例计算两种边界闭合的反射系数模 $|R|$。每个测试用例由 $(\\lambda,\\theta)$ 参数化，其中 $\\theta = k \\Delta x$ 是无量纲离散波数，$k$ 是连续波数。离散时间频率与您推导的色散关系一致。对于数值计算，请选择与内部色散关系一致的离散频率主分支。\n\n待评估的测试套件为：\n- 用例 1：$\\lambda = 0.8$，$\\theta = 0.4$。\n- 用例 2：$\\lambda = 0.8$，$\\theta = 2.6$。\n- 用例 3：$\\lambda = 1.0$，$\\theta = \\pi$。\n- 用例 4：$\\lambda = 0.2$，$\\theta = 1.0$。\n- 用例 5：$\\lambda = 0.95$，$\\theta = 0.05$。\n\n对于每个测试用例，您的程序必须计算浮点数对 $[|R_{\\mathrm{D}}|, |R_{\\mathrm{ABC}}|]$，其中 $|R_{\\mathrm{D}}|$ 是狄利克雷边界的反射系数模，而 $|R_{\\mathrm{ABC}}|$ 是阻抗匹配边界的反射系数模。最终输出必须是单行文本，包含一个由方括号括起来的、以逗号分隔的数对列表，例如：\n$$\n[[|R_{\\mathrm{D}}|,|R_{\\mathrm{ABC}}|],\\,[|R_{\\mathrm{D}}|,|R_{\\mathrm{ABC}}|],\\,\\dots]\n$$\n您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，每个条目完全按照测试套件的顺序列出，格式为双元素列表 $[|R_{\\mathrm{D}}|,|R_{\\mathrm{ABC}}|]$。",
            "solution": "此问题被认为是有效的，因为它具有科学依据、良态 (well-posed) 且客观。它包含对数值波传播和反射的标准分析，没有任何使其无效的缺陷。我们开始进行解答。\n\n分析分为三个部分：\n1.  推导内部有限差分格式的离散色散关系。\n2.  推导狄利克雷边界条件和一阶阻抗匹配边界条件的离散反射系数。\n3.  为给定测试用例指定数值计算步骤。\n\n**1. 离散色散关系**\n\n一维波动方程为 $u_{tt} = c^2 u_{xx}$。区域内部采用在时间和空间上均为二阶精度的中心差分格式进行离散化：\n$$\n\\frac{u_j^{n+1} - 2u_j^n + u_j^{n-1}}{(\\Delta t)^2} = c^2 \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\n$$\n引入库朗-弗里德里希斯-列维 (CFL) 数 $\\lambda = \\frac{c \\Delta t}{\\Delta x}$，该格式可以重排为其显式形式：\n$$\nu_j^{n+1} = 2(1 - \\lambda^2)u_j^n - u_j^{n-1} + \\lambda^2 (u_{j+1}^n + u_{j-1}^n)\n$$\n为求出色散关系，我们将平面波拟设 $u_j^n = \\hat{u} e^{i(\\omega t_n - k x_j)}$ 代入差分格式中。令 $\\tilde{\\omega} = \\omega \\Delta t$ 为无量纲离散时间频率，$\\theta = k \\Delta x$ 为无量纲离散波数。拟设变为 $u_j^n = \\hat{u} e^{i(n\\tilde{\\omega} - j\\theta)}$。将其代入数值格式并除以公因子 $\\hat{u} e^{i(n\\tilde{\\omega} - j\\theta)}$，得到：\n$$\ne^{i\\tilde{\\omega}} = 2(1 - \\lambda^2) - e^{-i\\tilde{\\omega}} + \\lambda^2 (e^{-i\\theta} + e^{i\\theta})\n$$\n整理各项以求解 $\\tilde{\\omega}$：\n$$\ne^{i\\tilde{\\omega}} + e^{-i\\tilde{\\omega}} = 2(1 - \\lambda^2) + 2\\lambda^2 \\cos\\theta\n$$\n使用恒等式 $e^{iz} + e^{-iz} = 2\\cos z$，我们得到：\n$$\n2\\cos\\tilde{\\omega} = 2 - 2\\lambda^2(1 - \\cos\\theta)\n$$\n应用半角恒等式 $\\cos z = 1 - 2\\sin^2(z/2)$ 和 $1 - \\cos z = 2\\sin^2(z/2)$：\n$$\n2(1 - 2\\sin^2(\\tilde{\\omega}/2)) = 2 - 2\\lambda^2(2\\sin^2(\\theta/2))\n$$\n$$\n-4\\sin^2(\\tilde{\\omega}/2) = -4\\lambda^2\\sin^2(\\theta/2)\n$$\n这可简化为该格式的离散色散关系：\n$$\n\\sin^2(\\tilde{\\omega}/2) = \\lambda^2\\sin^2(\\theta/2)\n$$\n取平方根并选择对应于物理波传播的主分支，我们得到：\n$$\n\\sin(\\tilde{\\omega}/2) = \\lambda \\sin(\\theta/2)\n$$\n由此，离散时间频率 $\\tilde{\\omega}$ 可以表示为离散波数 $\\theta$ 和 CFL 数 $\\lambda$ 的函数：\n$$\n\\tilde{\\omega} = 2 \\arcsin(\\lambda \\sin(\\theta/2))\n$$\n此关系在稳定格式（其中 $\\lambda \\le 1$）下有效。\n\n**2. 反射系数**\n\n在半无限域 $x \\ge 0$ 上的解是一个入射波和一个反射波的叠加。入射波朝向边界 $x=0$ 传播（左行波），反射波远离边界传播（右行波）。解的离散形式为：\n$$\nu_j^n = u_{I,j}^n + u_{R,j}^n = A_I e^{i(n\\tilde{\\omega} + j\\theta)} + A_R e^{i(n\\tilde{\\omega} - j\\theta)}\n$$\n其中 $A_I$ 和 $A_R$ 分别是入射波和反射波的复振幅。反射系数 $R$ 定义为比值 $R = A_R / A_I$。总解可以写为：\n$$\nu_j^n = A_I e^{in\\tilde{\\omega}}(e^{ij\\theta} + R e^{-ij\\theta})\n$$\n\n**狄利克雷边界条件 ($R_D$)**\n边界条件为对所有 $n$ 满足 $u_0^n = 0$。将此应用于 $j=0$ 处的总解：\n$$\nu_0^n = A_I e^{in\\tilde{\\omega}}(e^{i(0)\\theta} + R_D e^{-i(0)\\theta}) = 0\n$$\n$$\nA_I e^{in\\tilde{\\omega}}(1 + R_D) = 0\n$$\n对于非平凡入射波（$A_I \\ne 0$），这要求 $1 + R_D = 0$，从而得到：\n$$\nR_D = -1\n$$\n反射系数的模为 $|R_D| = 1$，这表示发生了相位反转的全反射，与 $\\lambda$ 或 $\\theta$ 无关。\n\n**阻抗匹配边界条件 ($R_{ABC}$)**\n边界条件由下式给出：\n$$\n\\frac{u_0^{n+1} - u_0^{n-1}}{2 \\Delta t} - c \\, \\frac{u_1^n - u_0^n}{\\Delta x} = 0\n$$\n我们将总解 $u_j^n = A_I e^{in\\tilde{\\omega}}(e^{ij\\theta} + R_{ABC} e^{-ij\\theta})$ 代入此方程。首先，我们计算必要的项：\n- $u_0^n = A_I e^{in\\tilde{\\omega}}(1 + R_{ABC})$\n- $u_0^{n \\pm 1} = u_0^n e^{\\pm i\\tilde{\\omega}}$\n- $u_1^n = A_I e^{in\\tilde{\\omega}}(e^{i\\theta} + R_{ABC} e^{-i\\theta})$\n\n将这些代入边界条件：\n$$\n\\frac{A_I e^{in\\tilde{\\omega}}(1+R_{ABC})(e^{i\\tilde{\\omega}} - e^{-i\\tilde{\\omega}})}{2\\Delta t} - \\frac{c}{\\Delta x} \\left( A_I e^{in\\tilde{\\omega}}(e^{i\\theta} + R_{ABC}e^{-i\\theta}) - A_I e^{in\\tilde{\\omega}}(1 + R_{ABC}) \\right) = 0\n$$\n除以 $A_I e^{in\\tilde{\\omega}}$ 并使用 $e^{iz} - e^{-iz} = 2i\\sin z$：\n$$\n\\frac{(1+R_{ABC})(i\\sin\\tilde{\\omega})}{\\Delta t} - \\frac{c}{\\Delta x} \\left( (e^{i\\theta}-1) + R_{ABC}(e^{-i\\theta}-1) \\right) = 0\n$$\n乘以 $\\Delta x/c = \\Delta t/\\lambda$：\n$$\n\\frac{1}{\\lambda} (1+R_{ABC})(i\\sin\\tilde{\\omega}) - \\left( (e^{i\\theta}-1) + R_{ABC}(e^{-i\\theta}-1) \\right) = 0\n$$\n现在我们求解 $R_{ABC}$：\n$$\nR_{ABC} \\left( \\frac{i\\sin\\tilde{\\omega}}{\\lambda} - (e^{-i\\theta}-1) \\right) = (e^{i\\theta}-1) - \\frac{i\\sin\\tilde{\\omega}}{\\lambda}\n$$\n$$\nR_{ABC} = \\frac{(e^{i\\theta}-1) - i\\sin\\tilde{\\omega}/\\lambda}{i\\sin\\tilde{\\omega}/\\lambda - (e^{-i\\theta}-1)}\n$$\n为避免在实现中除以 $\\lambda$，我们可以将分子和分母同乘以 $\\lambda$：\n$$\nR_{ABC} = \\frac{\\lambda(e^{i\\theta}-1) - i\\sin\\tilde{\\omega}}{i\\sin\\tilde{\\omega} + \\lambda(1-e^{-i\\theta})}\n$$\n必须为每个测试用例计算模 $|R_{ABC}|$。\n\n**3. 数值计算**\n\n对于每个测试用例 $(\\lambda, \\theta)$：\n1.  狄利克雷边界的反射系数模为 $|R_D| = 1.0$。\n2.  离散时间频率 $\\tilde{\\omega}$ 根据色散关系计算：$\\tilde{\\omega} = 2 \\arcsin(\\lambda \\sin(\\theta/2))$。\n3.  使用推导出的公式计算复反射系数 $R_{ABC}$。\n4.  然后计算复数 $R_{ABC}$ 的绝对值，即其模 $|R_{ABC}|$。\n5.  结果以数对 $[|R_D|, |R_{ABC}|]$ 的形式报告。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the magnitude of the reflection coefficient for Dirichlet and\n    first-order impedance-matched boundary conditions for a 1D wave equation.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple (lambda, theta).\n    test_cases = [\n        (0.8, 0.4),\n        (0.8, 2.6),\n        (1.0, np.pi),\n        (0.2, 1.0),\n        (0.95, 0.05)\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        lmbda, theta = case\n        \n        # 1. Reflection coefficient for the Dirichlet boundary\n        # As derived, R_D = -1, so its magnitude is always 1.\n        mag_R_d = 1.0\n        \n        # 2. Reflection coefficient for the impedance-matched boundary (ABC)\n        \n        # Check for stability condition, although all test cases satisfy it.\n        if lmbda  1.0:\n            raise ValueError(f\"CFL condition not met: lambda = {lmbda}  1\")\n\n        # Calculate discrete temporal frequency from the dispersion relation\n        # sin(omega_tilde/2) = lambda * sin(theta/2)\n        omega_tilde = 2 * np.arcsin(lmbda * np.sin(theta / 2.0))\n        \n        # Calculate the complex reflection coefficient R_ABC using the derived formula:\n        # R_ABC = (lmbda*(exp(i*theta) - 1) - i*sin(omega_tilde)) / \n        #         (i*sin(omega_tilde) + lmbda*(1 - exp(-i*theta)))\n        \n        # Numerator of R_ABC\n        num = lmbda * (np.exp(1j * theta) - 1.0) - 1j * np.sin(omega_tilde)\n        \n        # Denominator of R_ABC\n        den = 1j * np.sin(omega_tilde) + lmbda * (1.0 - np.exp(-1j * theta))\n        \n        # In the limit theta - 0, den - 0. Handle this case if necessary.\n        # For the given test cases, theta is never zero.\n        if np.isclose(den, 0):\n             # This case corresponds to perfect absorption in the continuous limit.\n             # Numerically, R_abc should be 0.\n             R_abc = 0.0\n        else:\n             R_abc = num / den\n\n        # Calculate the magnitude of the reflection coefficient\n        mag_R_abc = np.abs(R_abc)\n        \n        results.append([mag_R_d, mag_R_abc])\n\n    # Final print statement in the exact required format.\n    # str(list) automatically creates the \"[a, b]\" format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在为对流主导的流动（如线性对流方程所描述的）设计出流边界条件时，除了要最小化反射，还必须确保整个数值格式的稳定性。本练习将引导您为一个经典的 Orlanski 型辐射边界条件推导其显式有限差分格式，并对其稳定性进行严格的 von Neumann 分析 ()。这个实践旨在加深您对边界条件如何与内部格式相互作用并影响计算稳定性的理解。",
            "id": "3349551",
            "problem": "考虑线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中 $a  0$ 为常数，定义在区间 $x \\in [0,L]$ 上。设空间网格是均匀的，其中 $x_{j} = j\\,\\Delta x$ (对于 $j = 0,1,\\dots,N$)，时间层级为 $t^{n} = n\\,\\Delta t$ (对于 $n = 0,1,2,\\dots$)。定义库朗数 (Courant number) $\\sigma = a\\,\\Delta t / \\Delta x$。对于 $j = 1,2,\\dots,N-1$，$u_{j}^{n}$ 的内部更新由标准的显式迎风格式（时间向前，空间向后，Forward-Time Backward-Space）得到，并且假设在所有时间 $t^{n}$，左边界 $x_{0}$ 处的值是已知的。\n\n在右边界 $x_{N} = L$ 处，施加一个 Orlanski 型的无反射边界条件（对流辐射），对于此常系数问题，该条件可写为在 $x=L$ 处 $u_{t} + a\\,u_{x} = 0$。仅从控制方程 $u_{t} + a\\,u_{x} = 0$、库朗数 $\\sigma$ 的定义以及前述的均匀网格出发，完成以下任务：\n\n1. 在右边界节点 $x_{N}$ 处，推导一个显式有限差分更新格式，用于将 $u_{N}^{n}$ 推进到 $u_{N}^{n+1}$。该格式在时间上使用单步前向差分，在空间上使用与信息传出计算域方向一致的单边差分。\n\n2. 使用适用于常系数平流问题的简正模（von Neumann）方法，分析组合了内部格式和边界格式的显式格式的线性稳定性，并确定最大的库朗数 $\\sigma_{\\max}$，使得对于所有空间傅里叶波数，放大因子的模长小于或等于1。你可以假设你推导的边界更新格式不会引入计算域外的任何未知数。\n\n将你的最终结果表示为一个实数，即为保证稳定性所允许的最大库朗数 $\\sigma_{\\max}$。最终答案中不应报告任何中间表达式。无需四舍五入，$\\sigma$ 也没有物理单位。",
            "solution": "问题要求为线性平流方程推导一个数值边界条件，并随后对组合的内部和边界格式进行稳定性分析。按要求，分析分为两部分进行。\n\n第1部分：右边界显式更新格式的推导。\n\n控制偏微分方程是线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中波速 $a > 0$ 为常数。问题指明，在右边界 $x_{N} = L$ 处，同一个方程作为无反射边界条件成立：\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0 \\quad \\text{at } x=L\n$$\n我们需要在网格点 $(x_{N}, t^{n})$ 处离散化此方程，以求得 $u_{N}^{n+1}$ 的更新格式。离散化方法被指定为时间上采用单步前向差分，空间上采用单边差分。\n\n在点 $(x_{N}, t^{n})$ 处，时间导数 $u_{t}$ 的单步前向差分为：\n$$\n\\frac{\\partial u}{\\partial t} \\bigg|_{j=N}^{n} \\approx \\frac{u_{N}^{n+1} - u_{N}^{n}}{\\Delta t}\n$$\n对于空间导数 $u_{x}$，我们必须使用与“信息传出计算域”方向一致的单边差分。由于 $a > 0$，方程 $dx/dt = a$ 的特征线从左向右传播。信息朝 $x$ 增大的方向流动。在右边界 $x_{N}=L$ 处，信息正在离开计算域。一个尊重此信息流向的数值格式（“迎风”格式）必须使用计算域内的点，即空间索引为 $j \\le N$ 的点。使用这些点的最简单的单边差分是一阶后向差分：\n$$\n\\frac{\\partial u}{\\partial x} \\bigg|_{j=N}^{n} \\approx \\frac{u_{N}^{n} - u_{N-1}^{n}}{\\Delta x}\n$$\n这个选择也与内部格式，即一阶时间向前空间向后（FTBS）方法，保持一致。\n\n将这些离散近似代入边界条件方程，得到：\n$$\n\\frac{u_{N}^{n+1} - u_{N}^{n}}{\\Delta t} + a \\left( \\frac{u_{N}^{n} - u_{N-1}^{n}}{\\Delta x} \\right) = 0\n$$\n现在我们可以求解 $u_{N}^{n+1}$。两边乘以 $\\Delta t$ 得到：\n$$\nu_{N}^{n+1} - u_{N}^{n} = -a \\frac{\\Delta t}{\\Delta x} (u_{N}^{n} - u_{N-1}^{n})\n$$\n使用库朗数的定义 $\\sigma = a\\,\\Delta t / \\Delta x$，我们有：\n$$\nu_{N}^{n+1} = u_{N}^{n} - \\sigma (u_{N}^{n} - u_{N-1}^{n})\n$$\n重新整理各项，我们得到右边界节点的显式更新公式：\n$$\nu_{N}^{n+1} = (1 - \\sigma) u_{N}^{n} + \\sigma u_{N-1}^{n}\n$$\n此更新格式使用时间层 $n$ 上来自节点 $N$ 和 $N-1$ 的值，这些节点均在计算域内，符合要求。\n\n第2部分：线性稳定性分析。\n\n问题要求使用简正模（von Neumann）方法对组合的内部和边界格式进行稳定性分析。\n\n首先，我们写出内部格式。对于 $j=1, 2, \\dots, N-1$ 的 FTBS 方法是：\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + a \\left( \\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x} \\right) = 0\n$$\n求解 $u_{j}^{n+1}$ 并使用 $\\sigma = a\\,\\Delta t / \\Delta x$：\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\sigma(u_{j}^{n} - u_{j-1}^{n}) = (1 - \\sigma) u_{j}^{n} + \\sigma u_{j-1}^{n}\n$$\n我们观察到，为边界节点 $j=N$ 推导的更新公式与内部节点 $j=1, \\dots, N-1$ 的更新公式形式相同。因此，我们可以分析这一个统一的有限差分方程的稳定性。\n\nvon Neumann 稳定性分析考察单个空间傅里叶模式的增长或衰减。我们假设解的形式为：\n$$\nu_{j}^{n} = g^{n} e^{i k x_{j}} = g^{n} e^{i k j \\Delta x}\n$$\n其中 $k$ 是波数，$g$ 是每个时间步的复放大因子。为使格式稳定，对于所有可能的波数，放大因子的模必须小于或等于1，即 $|g| \\le 1$。\n\n将模式解代入差分方程 $u_{j}^{n+1} = (1 - \\sigma) u_{j}^{n} + \\sigma u_{j-1}^{n}$：\n$$\ng^{n+1} e^{i k j \\Delta x} = (1 - \\sigma) g^{n} e^{i k j \\Delta x} + \\sigma g^{n} e^{i k (j-1) \\Delta x}\n$$\n整个方程除以 $g^{n} e^{i k j \\Delta x}$ 得到放大因子 $g$ 的表达式：\n$$\ng = (1 - \\sigma) + \\sigma e^{-i k \\Delta x}\n$$\n令 $\\theta = k \\Delta x$ 为无量纲波数，其取值范围为 $[-\\pi, \\pi]$。放大因子是 $\\theta$ 的函数：\n$$\ng(\\theta) = 1 - \\sigma + \\sigma e^{-i\\theta}\n$$\n在复平面上，该方程描述了一个圆，其圆心为 $c = 1 - \\sigma$，半径为 $r = |\\sigma|$。由于 $a > 0$、$\\Delta t > 0$ 和 $\\Delta x > 0$，我们有 $\\sigma > 0$，因此半径为 $r=\\sigma$。\n为使格式稳定，这个圆必须被包含在单位圆盘 $|z| \\le 1$ 内。圆上离原点最远的点距离为 $|c| + r$。因此，稳定性条件为：\n$$\n|1 - \\sigma| + \\sigma \\le 1\n$$\n我们根据 $\\sigma$ 的值分两种情况分析这个不等式：\n\n情况1：$0 \\le \\sigma \\le 1$。\n在此情况下，$1 - \\sigma \\ge 0$，所以 $|1 - \\sigma| = 1 - \\sigma$。稳定性条件变为：\n$$\n(1 - \\sigma) + \\sigma \\le 1 \\implies 1 \\le 1\n$$\n这总是成立的。因此，对于 $0 \\le \\sigma \\le 1$，格式是稳定的。\n\n情况2：$\\sigma > 1$。\n在此情况下，$1 - \\sigma  0$，所以 $|1 - \\sigma| = -(1 - \\sigma) = \\sigma - 1$。稳定性条件变为：\n$$\n(\\sigma - 1) + \\sigma \\le 1 \\implies 2\\sigma - 1 \\le 1 \\implies 2\\sigma \\le 2 \\implies \\sigma \\le 1\n$$\n这个结果 $\\sigma \\le 1$ 与本情况的假设 $\\sigma > 1$ 相矛盾。因此，当 $\\sigma > 1$ 时，不存在稳定的解。\n\n综合两种情况，von Neumann 稳定性分析表明，该格式当且仅当 $0 \\le \\sigma \\le 1$ 时是稳定的。由于此分析适用于内部和边界所使用的数值格式，这个条件决定了整个方法的稳定性。\n\n能使格式稳定的最大允许库朗数 $\\sigma_{\\max}$ 是此范围内的最大值。\n$$\n\\sigma_{\\max} = 1\n$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "理论上完美的无反射边界条件在应用于实际问题时，往往会因为对物理参数（如声速）的估计不准确而性能下降。本练习将带您进入一个更高级的分析层面，通过推导反射系数对参数误差的灵敏度，来研究这种不完美性的影响 ()。通过这项实践，您将学会如何评估一个边界条件在面对非理想流动条件（如轻微的非等熵效应）和参数不确定性时的鲁棒性。",
            "id": "3349564",
            "problem": "考虑由线性化欧拉方程控制的均匀理想气体流的一维小振幅平面波扰动。设均匀基态的特征为：密度 $\\rho_0$、压力 $p_0$、温度 $T_0$ 均为常数，比热比为 $\\gamma$，气体常数为 $R$（因此当地声速 $c$ 满足 $c^2 = \\gamma R T$），且平均速度可忽略不计，从而对流效应在主阶上可以忽略。对于小扰动 $(\\rho', u', p')$，线性化方程允许存在右行和左行声学模式，其色散关系为 $\\omega = \\pm c k$，本构关系对于声学部分为 $u' = \\pm p'/(\\rho_0 c)$ 和 $p' = c^2 \\rho'$。此外，还存在一个熵模式，其 $p'_s = 0$，$u'_s = 0$ 且 $s' \\neq 0$，该模式对流局部热力学状态。\n\n基于不变量的无反射边界条件 (NRBC) 通常在出流边界强制要求入射声学特征消失。一种实际的实现方式是在边界上强制施加代数约束 $u' = p'/(\\rho_0 \\hat{c})$，其中使用了根据估计的比热比 $\\hat{\\gamma}$ 和基础热力学状态推导出的估计声速 $\\hat{c}$。在轻微非等熵流中，局部温度受到一个小的无量纲熵振幅 $\\sigma$ 的扰动，定义为 $\\sigma \\equiv s'/c_v$，其中 $c_v$ 是定容比热。因此，对于小的 $\\sigma$，局部声速满足 $c \\approx \\sqrt{\\gamma R T_0}\\,(1 + \\tfrac{1}{2}\\sigma)$，而边界算法使用的 $\\hat{c} \\approx \\sqrt{\\hat{\\gamma} R T_0}$ 忽略了 $\\sigma$ 并可能使用了错误的 $\\hat{\\gamma}$。\n\n从线性化欧拉方程和声学模式关系出发，根据第一性原理推导一个右行入射声波在遇到强制施加 $u' = p'/(\\rho_0 \\hat{c})$ 的出流边界时的反射系数大小 $|R|$。将 $|R|$ 完全用真实局部声速 $c$ 及其估计值 $\\hat{c}$ 表示。然后，使用 $c \\approx \\sqrt{\\gamma R T_0}\\,(1 + \\tfrac{1}{2}\\sigma)$ 和 $\\hat{c} \\approx \\sqrt{\\hat{\\gamma} R T_0}$，推导 $|R|$ 对 $\\hat{c}$ 的灵敏度（表示为 $\\partial |R| / \\partial \\hat{c}$）和 $|R|$ 对 $\\hat{\\gamma}$ 的灵敏度（表示为 $\\partial |R| / \\partial \\hat{\\gamma}$）在给定参数值下的解析表达式。您必须通过 $\\hat{c}(\\hat{\\gamma})$ 使用链式法则来表示 $\\partial |R| / \\partial \\hat{\\gamma}$。\n\n您的程序必须实现这些公式，并为每个测试用例计算一个三元组，包括：\n- 反射系数大小 $|R|$，\n- 绝对灵敏度 $\\left|\\partial |R| / \\partial \\hat{c}\\right|$，\n- 绝对灵敏度 $\\left|\\partial |R| / \\partial \\hat{\\gamma}\\right|$。\n\n所有速度单位必须为米/秒 (m/s)，$R$ 的单位为焦耳/千克·开尔文 (J/(kg·K))，$T_0$ 的单位为开尔文 (K)，输出为无量纲浮点数。对于其中估计值 $\\hat{c}$ 是直接给出而没有 $\\hat{\\gamma}$ 的测试用例，将 $\\partial |R| / \\partial \\hat{\\gamma}$ 定义为数值 $0.0$。\n\n使用以下测试套件，涵盖一般情况、边界条件精确匹配情况以及包括较大参数误差的边缘情况：\n1. 直接指定声速（正常路径）：$c = 340.0$ m/s，$\\hat{c} = 333.0$ m/s。忽略 $\\sigma$ 和任何 $\\hat{\\gamma}$；报告三元组 $(|R|, |\\partial |R| / \\partial \\hat{c}|, 0.0)$。\n2. 基于伽马的估计，带有轻微非等熵效应（一般情况）：$\\gamma = 1.4$，$\\hat{\\gamma} = 1.39$，$R = 287.0$ J/(kg·K)，$T_0 = 300.0$ K，$\\sigma = 0.02$。\n3. 基于伽马的估计，完全匹配（边界条件精确性）：$\\gamma = 1.4$，$\\hat{\\gamma} = 1.4$，$R = 287.0$ J/(kg·K)，$T_0 = 300.0$ K，$\\sigma = 0.0$。\n4. 基于伽马的估计，具有较大失配和较大非等熵效应（边缘情况）：$\\gamma = 1.4$，$\\hat{\\gamma} = 1.2$，$R = 287.0$ J/(kg·K)，$T_0 = 800.0$ K，$\\sigma = 0.1$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的三元组本身也是一个用方括号括起来的逗号分隔列表。例如：“[[result_case1_a,result_case1_b,result_case1_c],[result_case2_a,result_case2_b,result_case2_c],...]”。所有输出必须是浮点数。不得打印任何额外文本。",
            "solution": "用户提供的问题已经过验证，被确定为自洽、有科学依据且定义明确。求解过程如下。\n\n问题的核心是确定一维声波在数值出流边界处的反射，并分析此反射对边界条件中所用参数的灵敏度。流场扰动被分解为入射（右行，下标 $i$）和反射（左行，下标 $r$）分量。总速度扰动 $u'$ 和总压力扰动 $p'$ 由叠加给出：$u' = u'_i + u'_r$ 和 $p' = p'_i + p'_r$。\n\n根据平均速度可忽略的流动的线性化欧拉方程，右行和左行平面声波的本构关系为：\n$$u'_i = \\frac{p'_i}{\\rho_0 c} \\quad \\text{(入射，右行)}$$\n$$u'_r = -\\frac{p'_r}{\\rho_0 c} \\quad \\text{(反射，左行)}$$\n其中 $\\rho_0$ 是恒定的平均密度，$c$ 是介质中真实的局部声速。\n\n无反射边界条件 (NRBC) 在出流边界处强制施加。如问题所述，该条件是一个代数约束，旨在使入射特征（此处为左行波）消失。然而，它使用了一个估计的声速 $\\hat{c}$。该条件为：\n$$u' = \\frac{p'}{\\rho_0 \\hat{c}}$$\n\n为求反射系数，我们将叠加后的场代入边界条件：\n$$u'_i + u'_r = \\frac{p'_i + p'_r}{\\rho_0 \\hat{c}}$$\n接下来，我们将速度扰动 $u'_i$ 和 $u'_r$ 替换为它们基于压力的本构关系：\n$$\\frac{p'_i}{\\rho_0 c} - \\frac{p'_r}{\\rho_0 c} = \\frac{p'_i + p'_r}{\\rho_0 \\hat{c}}$$\n项 $\\rho_0$ 消去，得到一个关联压力扰动的方程：\n$$\\frac{p'_i}{c} - \\frac{p'_r}{c} = \\frac{p'_i}{\\hat{c}} + \\frac{p'_r}{\\hat{c}}$$\n反射系数 $R$ 定义为反射波振幅与入射波振幅之比，$R = p'_r / p'_i$。重新整理方程以求解此比率：\n$$p'_i \\left( \\frac{1}{c} - \\frac{1}{\\hat{c}} \\right) = p'_r \\left( \\frac{1}{c} + \\frac{1}{\\hat{c}} \\right)$$\n$$R = \\frac{p'_r}{p'_i} = \\frac{\\frac{1}{c} - \\frac{1}{\\hat{c}}}{\\frac{1}{c} + \\frac{1}{\\hat{c}}}$$\n分子和分母同乘以 $c\\hat{c}$ 可简化表达式：\n$$R = \\frac{\\hat{c} - c}{\\hat{c} + c}$$\n问题要求的是反射系数的大小 $|R|$。由于 $c$ 和 $\\hat{c}$ 都是速度，因此为正值，分母 $\\hat{c}+c$ 总是正的。其大小为：\n$$|R| = \\left| \\frac{\\hat{c} - c}{\\hat{c} + c} \\right| = \\frac{|\\hat{c} - c|}{\\hat{c} + c}$$\n\n第二个任务是求 $|R|$ 对估计声速 $\\hat{c}$ 的绝对灵敏度，即 $|\\partial |R| / \\partial \\hat{c}|$。我们必须对 $|R|$ 关于 $\\hat{c}$ 求导。让我们考虑 $\\hat{c} \\neq c$ 的情况。\n如果 $\\hat{c} > c$，那么 $|R| = (\\hat{c}-c)/(\\hat{c}+c)$。使用商法则求导：\n$$\\frac{\\partial |R|}{\\partial \\hat{c}} = \\frac{1(\\hat{c}+c) - (\\hat{c}-c)1}{(\\hat{c}+c)^2} = \\frac{2c}{(\\hat{c}+c)^2}$$\n如果 $\\hat{c}  c$，那么 $|R| = (c-\\hat{c})/(c+\\hat{c})$。求导得到：\n$$\\frac{\\partial |R|}{\\partial \\hat{c}} = \\frac{-1(c+\\hat{c}) - (c-\\hat{c})1}{(c+\\hat{c})^2} = \\frac{-2c}{(c+\\hat{c})^2}$$\n这两种情况可以合并为 $\\frac{\\partial |R|}{\\partial \\hat{c}} = \\text{sgn}(\\hat{c}-c) \\frac{2c}{(\\hat{c}+c)^2}$。因此，绝对灵敏度为：\n$$\\left|\\frac{\\partial |R|}{\\partial \\hat{c}}\\right| = \\frac{2c}{(\\hat{c}+c)^2}$$\n对于所有正的 $c$ 和 $\\hat{c}$，此表达式是连续且定义良好的。在 $\\hat{c}=c$ 点， $|R|=0$，其导数在形式上是未定义的。然而，当 $\\hat{c} \\to c$ 时，绝对导数的极限是 $\\frac{2c}{(c+c)^2} = \\frac{1}{2c}$，这表示在完美匹配条件附近的反射变化率的大小。因此，我们对所有情况都使用这个公式。\n\n第三个任务是求 $|R|$ 对估计比热比 $\\hat{\\gamma}$ 的绝对灵敏度，即 $|\\partial |R| / \\partial \\hat{\\gamma}|$。我们应用链式法则：\n$$\\frac{\\partial |R|}{\\partial \\hat{\\gamma}} = \\frac{\\partial |R|}{\\partial \\hat{c}} \\frac{\\partial \\hat{c}}{\\partial \\hat{\\gamma}}$$\n估计声速 $\\hat{c}$ 由 $\\hat{c} = \\sqrt{\\hat{\\gamma} R T_0}$ 给出。其对 $\\hat{\\gamma}$ 的导数为：\n$$\\frac{\\partial \\hat{c}}{\\partial \\hat{\\gamma}} = \\frac{\\partial}{\\partial \\hat{\\gamma}} \\left( (\\hat{\\gamma} R T_0)^{1/2} \\right) = \\frac{1}{2} (\\hat{\\gamma} R T_0)^{-1/2} (R T_0) = \\frac{\\sqrt{\\hat{\\gamma} R T_0}}{2\\hat{\\gamma}} = \\frac{\\hat{c}}{2\\hat{\\gamma}}$$\n将此结果和 $\\partial|R|/\\partial\\hat{c}$ 的表达式代入链式法则，得到：\n$$\\frac{\\partial |R|}{\\partial \\hat{\\gamma}} = \\left( \\text{sgn}(\\hat{c}-c) \\frac{2c}{(\\hat{c}+c)^2} \\right) \\left( \\frac{\\hat{c}}{2\\hat{\\gamma}} \\right) = \\text{sgn}(\\hat{c}-c) \\frac{c \\hat{c}}{\\hat{\\gamma} (\\hat{c}+c)^2}$$\n因此，绝对灵敏度为：\n$$\\left|\\frac{\\partial |R|}{\\partial \\hat{\\gamma}}\\right| = \\frac{c \\hat{c}}{\\hat{\\gamma} (\\hat{c}+c)^2}$$\n\n局部声速 $c$ 受非等熵扰动影响，由 $c \\approx \\sqrt{\\gamma R T_0}\\,(1 + \\tfrac{1}{2}\\sigma)$ 给出。对于未指定 $\\hat{\\gamma}$ 的测试用例，$\\hat{c}$ 是直接给出的，这意味着 $\\partial\\hat{c}/\\partial\\hat{\\gamma}$ 为 $0$，因此 $|\\partial|R|/\\partial\\hat{\\gamma}|=0.0$。\n\n这些推导出的公式将被实现，以计算给定测试用例所需的三元组。\n对于涉及 $\\gamma$ 和 $\\sigma$ 的情况，真实局部声速 $c$ 计算为 $c = \\sqrt{\\gamma R T_0} (1 + 0.5 \\sigma)$，而估计声速 $\\hat{c}$ 计算为 $\\hat{c} = \\sqrt{\\hat{\\gamma} R T_0}$。\n每个测试用例的计算都使用这些公式进行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the non-reflecting boundary condition problem for four test cases.\n    Derives the reflection coefficient and its sensitivities, then computes the numerical values.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'type': 'direct', 'c': 340.0, 'c_hat': 333.0},\n        {'type': 'gamma', 'gamma': 1.4, 'gamma_hat': 1.39, 'R': 287.0, 'T0': 300.0, 'sigma': 0.02},\n        {'type': 'gamma', 'gamma': 1.4, 'gamma_hat': 1.4, 'R': 287.0, 'T0': 300.0, 'sigma': 0.0},\n        {'type': 'gamma', 'gamma': 1.4, 'gamma_hat': 1.2, 'R': 287.0, 'T0': 800.0, 'sigma': 0.1},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        if case['type'] == 'direct':\n            c = case['c']\n            c_hat = case['c_hat']\n            gamma_hat = None  # Indicates gamma_hat is not used for c_hat calculation\n        elif case['type'] == 'gamma':\n            gamma = case['gamma']\n            gamma_hat = case['gamma_hat']\n            R_const = case['R']\n            T0 = case['T0']\n            sigma = case['sigma']\n            \n            # Calculate the true local sound speed, c, including non-isentropic effects\n            c0 = np.sqrt(gamma * R_const * T0)\n            c = c0 * (1.0 + 0.5 * sigma)\n            \n            # Calculate the estimated sound speed, c_hat, used in the boundary condition\n            c_hat = np.sqrt(gamma_hat * R_const * T0)\n        else:\n            continue\n\n        # Formula 1: Reflection Coefficient Magnitude |R|\n        # |R| = |c_hat - c| / (c_hat + c)\n        if c_hat + c == 0:\n             # Avoid division by zero, though physically c, c_hat  0\n            R_mag = np.inf if c_hat - c != 0 else 0.0\n        else:\n            R_mag = np.abs(c_hat - c) / (c_hat + c)\n\n        # Formula 2: Absolute Sensitivity of |R| with respect to c_hat\n        # |d|R|/d(c_hat)| = 2*c / (c_hat + c)^2\n        if (c_hat + c) == 0:\n            sens_c_hat_abs = np.inf\n        else:\n            sens_c_hat_abs = (2.0 * c) / (c_hat + c)**2\n\n        # Formula 3: Absolute Sensitivity of |R| with respect to gamma_hat\n        # |d|R|/d(gamma_hat)| = (c * c_hat) / (gamma_hat * (c_hat + c)^2)\n        if gamma_hat is not None:\n            if gamma_hat == 0 or (c_hat + c) == 0:\n                sens_gamma_hat_abs = np.inf\n            else:\n                sens_gamma_hat_abs = (c * c_hat) / (gamma_hat * (c_hat + c)**2)\n        else:\n            # Case where c_hat is given directly, so sensitivity to gamma_hat is 0.\n            sens_gamma_hat_abs = 0.0\n            \n        all_results.append([R_mag, sens_c_hat_abs, sens_gamma_hat_abs])\n\n    # Format the final output string as specified in the problem.\n    # e.g., \"[[r1,s1a,s1b],[r2,s2a,s2b],...]\"\n    formatted_results = []\n    for res_triple in all_results:\n        formatted_triple = ','.join(map(str, res_triple))\n        formatted_results.append(f\"[{formatted_triple}]\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}