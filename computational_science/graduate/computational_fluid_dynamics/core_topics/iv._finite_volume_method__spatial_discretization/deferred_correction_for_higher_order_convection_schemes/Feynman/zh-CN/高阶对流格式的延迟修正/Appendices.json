{
    "hands_on_practices": [
        {
            "introduction": "为了掌握延迟修正法的精髓，我们首先从其最基本的构成单元——单个面上的通量——开始。这个练习将引导你手动计算低阶通量、高阶通量以及最终的延迟修正项，从而清晰地展示各部分如何组合以提升精度。通过从多项式插值的基础出发推导高阶格式，你将更深刻地理解该方法的内在机理 ()。",
            "id": "3306429",
            "problem": "考虑在有限体积法 (FVM) 框架下，均匀网格上的一维稳态纯被动标量对流。设对流速度恒定且为正，因此索引为 $i$ 和 $i+1$ 的控制体积之间的面的迎风单元是单元 $i$。假设经过无量纲化，使得密度与面面积的乘积为1，因此面对流通量等于速度乘以被平流的值。你需要应用延迟修正 (DC) 框架，在 $i+1/2$ 面上构建一个高阶面对流。\n\n从控制体积上的积分守恒定律以及面对流通量定义为法向速度与面上标量值的乘积出发。对于低阶 (LO) 格式，当速度为正时使用一阶迎风格式。对于高阶 (HO) 格式，不要假设任何预给定的公式；而是通过在均匀网格上拟合一个通过四个连续单元中心 $x_{i-1}$、$x_{i}$、$x_{i+1}$ 和 $x_{i+2}$ 处标量值的三次多项式来构造面上的值，然后计算该多项式在面位置 $x_{i+1/2}$ 处的值。使用此值来获得高阶面对流。\n\n在 DC 框架中，隐式地组装低阶贡献项，并将高阶修正项的一部分显式地添加到右端项。设 DC 混合因子为 $\\beta = 0.8$。\n\n给定离散标量值 $\\phi_{i-1} = 2$、$\\phi_{i} = 3$、$\\phi_{i+1} = 5$ 和 $\\phi_{i+2} = 7$，以及正速度 $u = 2.4$，执行以下操作：\n\n- 推导并计算低阶面对流 $F^{LO}_{i+1/2}$、高阶面对流 $F^{HO}_{i+1/2}$ 以及延迟修正项 $\\delta F_{i+1/2} = F^{HO}_{i+1/2} - F^{LO}_{i+1/2}$。\n- 明确说明在 DC 中哪一部分是隐式组装的，哪一部分是显式添加的，并根据给定数据计算它们的数值。\n- 计算最终的延迟修正面对流 $F^{DC}_{i+1/2} = F^{LO}_{i+1/2} + \\beta\\,\\delta F_{i+1/2}$。\n\n将单个数字 $F^{DC}_{i+1/2}$ 作为最终答案。将答案四舍五入到 $4$ 位有效数字。由于通量是按所述方式无量纲化的，最终答案中不要包含单位。",
            "solution": "该问题经检验具有科学依据、适定、客观且完整。所有必要的数据和定义都已提供，可得到唯一解。我们可以开始求解。\n\n该问题考虑被动标量 $\\phi$ 的一维稳态纯对流，其控制方程为守恒定律：\n$$\n\\frac{d}{dx}(\\rho u \\phi) = 0\n$$\n在有限体积法 (FVM) 中，此方程在一个从 $i-1/2$ 面到 $i+1/2$ 面的控制体积 (CV) 上进行积分，得到：\n$$\n(\\rho u A \\phi)_{i+1/2} - (\\rho u A \\phi)_{i-1/2} = 0\n$$\n其中 $A$ 是面面积。问题陈述密度 $\\rho$ 和面面积 $A$ 的乘积为1，且速度 $u$ 是恒定的。因此，穿过一个面的对流通量为 $F = u\\phi$。对于控制体积 $i$，离散化方程为：\n$$\nF_{i+1/2} - F_{i-1/2} = 0\n$$\n我们需要使用延迟修正 (DC) 框架计算单元 $i$ 和 $i+1$ 之间的面 $i+1/2$ 上的通量 $F_{i+1/2}$。给定数据为速度 $u = 2.4$（正值）和单元中心的标量值 $\\phi_{i-1} = 2$、$\\phi_{i} = 3$、$\\phi_{i+1} = 5$ 和 $\\phi_{i+2} = 7$。DC 混合因子为 $\\beta = 0.8$。\n\n首先，我们确定低阶 (LO) 面对流 $F^{LO}_{i+1/2}$。问题指定了使用一阶迎风格式。由于速度 $u$ 为正，流动方向从左到右，因此 $i+1/2$ 面的迎风单元是单元 $i$。因此，面上的标量值取自迎风单元的中心值：\n$$\n\\phi^{LO}_{i+1/2} = \\phi_i\n$$\n于是，低阶通量为：\n$$\nF^{LO}_{i+1/2} = u \\cdot \\phi^{LO}_{i+1/2} = u \\phi_i\n$$\n代入给定的数值：\n$$\nF^{LO}_{i+1/2} = (2.4)(3) = 7.2\n$$\n\n接下来，我们确定高阶 (HO) 面对流 $F^{HO}_{i+1/2}$。这需要通过拟合一个穿过四个单元中心 $x_{i-1}$、$x_i$、$x_{i+1}$ 和 $x_{i+2}$ 处标量值的三次多项式，来找到面上的值 $\\phi^{HO}_{i+1/2}$，然后在面位置 $x_{i+1/2}$ 处计算该多项式的值。\n\n让我们定义一个以 $x_i$ 为中心、并由均匀网格间距 $\\Delta x$ 缩放的局部坐标系 $\\xi$：$\\xi = (x - x_i) / \\Delta x$。单元中心位于 $\\xi_{i-1}=-1$、$\\xi_i=0$、$\\xi_{i+1}=1$ 和 $\\xi_{i+2}=2$。$i+1/2$ 面位于 $x_{i+1/2} = x_i + \\Delta x/2$，这对应于 $\\xi_{i+1/2} = 1/2$。\n\n我们使用 Lagrange 插值来找到多项式在 $\\xi = 1/2$ 处的值。插值是节点值的线性组合：\n$$\n\\phi^{HO}_{i+1/2} = L_{i-1}(1/2)\\phi_{i-1} + L_i(1/2)\\phi_i + L_{i+1}(1/2)\\phi_{i+1} + L_{i+2}(1/2)\\phi_{i+2}\n$$\nLagrange 基多项式 $L_k(\\xi)$ 在节点 $\\{-1, 0, 1, 2\\}$ 上的 $\\xi=1/2$ 处计算如下：\n$$\nL_{i-1}(1/2) = \\frac{(1/2 - 0)(1/2 - 1)(1/2 - 2)}{(-1 - 0)(-1 - 1)(-1 - 2)} = \\frac{(1/2)(-1/2)(-3/2)}{(-1)(-2)(-3)} = \\frac{3/8}{-6} = -\\frac{1}{16}\n$$\n$$\nL_i(1/2) = \\frac{(1/2 - (-1))(1/2 - 1)(1/2 - 2)}{(0 - (-1))(0 - 1)(0 - 2)} = \\frac{(3/2)(-1/2)(-3/2)}{(1)(-1)(-2)} = \\frac{9/8}{2} = \\frac{9}{16}\n$$\n$$\nL_{i+1}(1/2) = \\frac{(1/2 - (-1))(1/2 - 0)(1/2 - 2)}{(1 - (-1))(1 - 0)(1 - 2)} = \\frac{(3/2)(1/2)(-3/2)}{(2)(1)(-1)} = \\frac{-9/8}{-2} = \\frac{9}{16}\n$$\n$$\nL_{i+2}(1/2) = \\frac{(1/2 - (-1))(1/2 - 0)(1/2 - 1)}{(2 - (-1))(2 - 0)(2 - 1)} = \\frac{(3/2)(1/2)(-1/2)}{(3)(2)(1)} = \\frac{-3/8}{6} = -\\frac{1}{16}\n$$\n系数之和为 $-1/16 + 9/16 + 9/16 - 1/16 = 16/16 = 1$，符合预期。\n\n现在，我们代入给定的标量值来求 $\\phi^{HO}_{i+1/2}$：\n$$\n\\phi^{HO}_{i+1/2} = -\\frac{1}{16}\\phi_{i-1} + \\frac{9}{16}\\phi_i + \\frac{9}{16}\\phi_{i+1} - \\frac{1}{16}\\phi_{i+2}\n$$\n$$\n\\phi^{HO}_{i+1/2} = \\frac{1}{16}[-1(2) + 9(3) + 9(5) - 1(7)] = \\frac{1}{16}[-2 + 27 + 45 - 7] = \\frac{63}{16} = 3.9375\n$$\n于是，高阶通量为：\n$$\nF^{HO}_{i+1/2} = u \\cdot \\phi^{HO}_{i+1/2} = (2.4)\\left(\\frac{63}{16}\\right) = \\left(\\frac{12}{5}\\right)\\left(\\frac{63}{16}\\right) = \\left(\\frac{3}{5}\\right)\\left(\\frac{63}{4}\\right) = \\frac{189}{20} = 9.45\n$$\n延迟修正项 $\\delta F_{i+1/2}$ 是高阶通量和低阶通量之间的差值：\n$$\n\\delta F_{i+1/2} = F^{HO}_{i+1/2} - F^{LO}_{i+1/2} = 9.45 - 7.2 = 2.25\n$$\n\n在延迟修正框架中，总通量被建模为 $F = F^{LO} + \\text{correction}$。低阶通量项 $F^{LO}$ 被隐式处理，这意味着它依赖于未知的解变量，并贡献于系统矩阵的主对角线和非对角线元素。修正项被显式处理，这意味着它是根据已知值（例如，来自上一次迭代的值）计算的，并被移到代数系统的右端项（源项）。\n问题陈述添加了比例为 $\\beta$ 的高阶修正项。因此，通量分解为：\n$$\nF_{i+1/2} = \\underbrace{F^{LO}_{i+1/2}}_{\\text{implicit}} + \\underbrace{\\beta(F^{HO}_{i+1/2} - F^{LO}_{i+1/2})}_{\\text{explicit}} = \\underbrace{F^{LO}_{i+1/2}}_{\\text{隐式}} + \\underbrace{\\beta\\,\\delta F_{i+1/2}}_{\\text{显式}}\n$$\n对于 $i+1/2$ 面，隐式组装的部分是 $F^{LO}_{i+1/2} = 7.2$。\n显式添加到源项的部分是 $\\beta\\,\\delta F_{i+1/2}$。其数值为：\n$$\n\\beta\\,\\delta F_{i+1/2} = (0.8)(2.25) = 1.8\n$$\n注意，此项对单元 $i$ 的源项贡献为负，对单元 $i+1$ 的源项贡献为正。\n\n最后，我们计算总的延迟修正面对流 $F^{DC}_{i+1/2}$：\n$$\nF^{DC}_{i+1/2} = F^{LO}_{i+1/2} + \\beta\\,\\delta F_{i+1/2} = 7.2 + 1.8 = 9.0\n$$\n问题要求答案四舍五入到 $4$ 位有效数字。因此，$9.0$ 写作 $9.000$。",
            "answer": "$$\n\\boxed{9.000}\n$$"
        },
        {
            "introduction": "在理解了单个面上的通量计算后，下一个关键步骤是学习如何将这些修正应用到整个计算域的代数方程组中。本练习将指导你为一个简化的周期性系统计算延迟修正源项向量，并验证其守恒性 ()。这个过程模拟了在有限体积法求解器中，高阶修正如何作为显式源项被添加到由低阶格式构成的隐式矩阵的右侧。",
            "id": "3306397",
            "problem": "考虑一个无量纲被动标量 $\\phi$ 的一维稳态线性平流问题，其速度为一个恒定的正无量纲速度 $u>0$。该问题定义在一个周期性域上，并使用有限体积法离散为三个均匀的控制体，索引为 $i\\in\\{1,2,3\\}$。面面积、单元宽度和密度均已无量纲化为1，因此通过一个面的对流通量等于 $u$ 乘以该面上 $\\phi$ 的插值。设单元中心值为 $\\phi=\\left[1,2,3\\right]$，采用周期性索引，因此 $\\phi_{0}=\\phi_{3}$，$\\phi_{4}=\\phi_{1}$，以及 $\\phi_{-1}=\\phi_{2}$。\n\n为了在保持稳健性的同时获得高阶对流，采用延迟修正 (Deferred Correction, DC) 策略：隐式处理对流算子的一阶迎风离散，并将高阶与低阶对流通量之间的差值移至右侧作为源项。使用系数 $\\alpha=1$ 的 DC 方法，单元 $i$ 的右侧修正项为\n$$\nb_{i} \\;=\\; \\frac{\\alpha}{\\Delta x}\\left(\\Delta F_{i-\\frac{1}{2}} - \\Delta F_{i+\\frac{1}{2}}\\right),\n$$\n其中 $\\Delta F_{i\\pm\\frac{1}{2}}$ 是对应面上高阶通量与迎风通量之差，且根据无量纲化有 $\\Delta x=1$。\n\n对于均匀网格上的 $u>0$，一阶迎风面值为\n$$\n\\phi_{i+\\frac{1}{2}}^{\\text{UW}}=\\phi_{i}, \\qquad \\phi_{i-\\frac{1}{2}}^{\\text{UW}}=\\phi_{i-1}.\n$$\n高阶面插值采用对流运动学的二次迎风插值 (Quadratic Upwind Interpolation for Convective Kinematics, QUICK) 格式。在均匀网格上，当 $u>0$ 时，QUICK 格式给出\n$$\n\\phi_{i+\\frac{1}{2}}^{\\text{QUICK}}=\\frac{3}{8}\\,\\phi_{i+1}+\\frac{6}{8}\\,\\phi_{i}-\\frac{1}{8}\\,\\phi_{i-1}, \\qquad\n\\phi_{i-\\frac{1}{2}}^{\\text{QUICK}}=\\frac{3}{8}\\,\\phi_{i}+\\frac{6}{8}\\,\\phi_{i-1}-\\frac{1}{8}\\,\\phi_{i-2}.\n$$\n根据这些定义，显式计算给定 $\\phi$ 和 $u>0$ 条件下的 DC 右侧向量 $b=\\left[b_{1},\\,b_{2},\\,b_{3}\\right]$。通过验证 $b$ 的三个分量之和为零来证明修正项的净守恒性。使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境，将最终答案表示为关于 $u$ 的单个行矩阵。无需进行数值舍入，最终表达式中不应包含单位。",
            "solution": "该问题要求计算一个周期性三单元域上的一维稳态线性平流问题的延迟修正 (DC) 源项向量 $b = [b_1, b_2, b_3]$。求解过程将首先建立修正项的一般公式，然后将其应用于给定的特定单元中心数据。\n\n给定单元 $i$ 的 DC 源项定义为：\n$$\nb_i = \\frac{\\alpha}{\\Delta x} \\left( \\Delta F_{i-\\frac{1}{2}} - \\Delta F_{i+\\frac{1}{2}} \\right)\n$$\n根据问题陈述，DC 系数为 $\\alpha=1$，无量纲单元宽度为 $\\Delta x=1$。因此，表达式简化为：\n$$\nb_i = \\Delta F_{i-\\frac{1}{2}} - \\Delta F_{i+\\frac{1}{2}}\n$$\n项 $\\Delta F_{i\\pm\\frac{1}{2}}$ 表示在单元面 $i\\pm\\frac{1}{2}$ 上，高阶 (QUICK) 和低阶 (迎风) 对流通量之差。由于对流通量由速度 $u$ 和面上插值的标量 $\\phi$ 的乘积给出，我们有：\n$$\n\\Delta F_{f} = F_{f}^{\\text{QUICK}} - F_{f}^{\\text{UW}} = u \\phi_{f}^{\\text{QUICK}} - u \\phi_{f}^{\\text{UW}} = u \\left( \\phi_{f}^{\\text{QUICK}} - \\phi_{f}^{\\text{UW}} \\right)\n$$\n其中 $f$ 表示一个通用面。我们将面插值之差定义为 $\\Delta \\phi_f = \\phi_{f}^{\\text{QUICK}} - \\phi_{f}^{\\text{UW}}$。\n\n对于恒定的正速度 $u>0$，一阶迎风格式给出的面值为来自迎风方向的单元中心值。对于面 $i+\\frac{1}{2}$，迎风单元是 $i$。因此：\n$$\n\\phi_{i+\\frac{1}{2}}^{\\text{UW}} = \\phi_i\n$$\n同一面上的高阶 QUICK 格式值为：\n$$\n\\phi_{i+\\frac{1}{2}}^{\\text{QUICK}} = \\frac{3}{8}\\phi_{i+1} + \\frac{6}{8}\\phi_i - \\frac{1}{8}\\phi_{i-1}\n$$\n因此，面值的差 $\\Delta\\phi_{i+\\frac{1}{2}}$ 为：\n$$\n\\Delta\\phi_{i+\\frac{1}{2}} = \\left( \\frac{3}{8}\\phi_{i+1} + \\frac{6}{8}\\phi_i - \\frac{1}{8}\\phi_{i-1} \\right) - \\phi_i = \\frac{3}{8}\\phi_{i+1} - \\frac{2}{8}\\phi_i - \\frac{1}{8}\\phi_{i-1} = \\frac{1}{8} \\left( 3\\phi_{i+1} - 2\\phi_i - \\phi_{i-1} \\right)\n$$\n因此，在面 $i+\\frac{1}{2}$ 上的通量差为：\n$$\n\\Delta F_{i+\\frac{1}{2}} = \\frac{u}{8} \\left( 3\\phi_{i+1} - 2\\phi_i - \\phi_{i-1} \\right)\n$$\n我们已知单元中心值为 $\\phi_1=1$，$\\phi_2=2$ 和 $\\phi_3=3$。该域是包含3个单元的周期性域，这意味着以下索引映射：$\\phi_0 = \\phi_3$，$\\phi_4 = \\phi_1$ 和 $\\phi_{-1} = \\phi_2$。\n代入已知值：\n$\\phi_0 = 3$\n$\\phi_4 = 1$\n$\\phi_{-1} = 2$\n\n现在我们计算三个单元各面上的通量差 $\\Delta F_f$：$f = \\frac{1}{2}$，$\\frac{3}{2}$，$\\frac{5}{2}$。注意，由于周期性，面 $\\frac{7}{2}$ 与面 $\\frac{1}{2}$ 相同。\n\n对于面 $i+\\frac{1}{2} = \\frac{3}{2}$（单元1和2之间），我们设 $i=1$：\n$$\n\\Delta F_{\\frac{3}{2}} = \\frac{u}{8} (3\\phi_2 - 2\\phi_1 - \\phi_0) = \\frac{u}{8} (3(2) - 2(1) - 3) = \\frac{u}{8} (6 - 2 - 3) = \\frac{u}{8}\n$$\n\n对于面 $i+\\frac{1}{2} = \\frac{5}{2}$（单元2和3之间），我们设 $i=2$：\n$$\n\\Delta F_{\\frac{5}{2}} = \\frac{u}{8} (3\\phi_3 - 2\\phi_2 - \\phi_1) = \\frac{u}{8} (3(3) - 2(2) - 1) = \\frac{u}{8} (9 - 4 - 1) = \\frac{4u}{8} = \\frac{u}{2}\n$$\n\n对于面 $i+\\frac{1}{2} = \\frac{1}{2}$（单元3和1之间），为方便起见，我们可以设 $i=0$，或者使用周期性规则，即该面与 $i=3$ 时的面 $\\frac{7}{2}$ 相同：\n$$\n\\Delta F_{\\frac{1}{2}} = \\Delta F_{\\frac{7}{2}} = \\frac{u}{8} (3\\phi_4 - 2\\phi_3 - \\phi_2) = \\frac{u}{8} (3(1) - 2(3) - 2) = \\frac{u}{8} (3 - 6 - 2) = -\\frac{5u}{8}\n$$\n\n计算出通量差后，我们现在可以求源向量 $b$ 的分量：\n\n对于单元 $i=1$：\n$$\nb_1 = \\Delta F_{1-\\frac{1}{2}} - \\Delta F_{1+\\frac{1}{2}} = \\Delta F_{\\frac{1}{2}} - \\Delta F_{\\frac{3}{2}} = -\\frac{5u}{8} - \\frac{u}{8} = -\\frac{6u}{8} = -\\frac{3u}{4}\n$$\n\n对于单元 $i=2$：\n$$\nb_2 = \\Delta F_{2-\\frac{1}{2}} - \\Delta F_{2+\\frac{1}{2}} = \\Delta F_{\\frac{3}{2}} - \\Delta F_{\\frac{5}{2}} = \\frac{u}{8} - \\frac{4u}{8} = -\\frac{3u}{8}\n$$\n\n对于单元 $i=3$：\n$$\nb_3 = \\Delta F_{3-\\frac{1}{2}} - \\Delta F_{3+\\frac{1}{2}} = \\Delta F_{\\frac{5}{2}} - \\Delta F_{\\frac{7}{2}} = \\frac{4u}{8} - \\left(-\\frac{5u}{8}\\right) = \\frac{9u}{8}\n$$\n\n得到的延迟修正源项向量为 $b = \\left[-\\frac{3u}{4}, -\\frac{3u}{8}, \\frac{9u}{8}\\right]$。\n\n最后，我们必须验证净修正项是守恒的，这意味着它在整个域上的分量之和必须为零。\n$$\n\\sum_{i=1}^{3} b_i = b_1 + b_2 + b_3 = \\left(-\\frac{3u}{4}\\right) + \\left(-\\frac{3u}{8}\\right) + \\left(\\frac{9u}{8}\\right)\n$$\n为了对这些项求和，我们使用公分母 $8$：\n$$\n\\sum_{i=1}^{3} b_i = -\\frac{6u}{8} - \\frac{3u}{8} + \\frac{9u}{8} = \\frac{-6u - 3u + 9u}{8} = \\frac{0}{8} = 0\n$$\n和为零，证实了 DC 源项是守恒的。对于周期性域上的通量差分格式，这是一个预期且必需的性质，因为求和 $\\sum_{i=1}^N (\\Delta F_{i-1/2} - \\Delta F_{i+1/2})$ 是一个裂项求和，其结果为 $\\Delta F_{1/2} - \\Delta F_{N+1/2}$，而周期性决定了 $\\Delta F_{N+1/2} = \\Delta F_{1/2}$。\n\n最终答案是表示为行矩阵的向量 $b=\\left[b_{1},\\,b_{2},\\,b_{3}\\right]$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{3u}{4}  -\\frac{3u}{8}  \\frac{9u}{8} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论的最终目的是指导实践。这个编程练习将带你直面高阶格式在模拟间断时产生的典型问题——数值过冲，并通过应用带有限制器的延迟修正方法来解决它 ()。通过亲手实现并对比无限制的高阶格式与稳健的DC格式，你将体验到延迟修正在保证计算精度的同时，如何有效抑制非物理振荡，从而获得更可靠的数值解。",
            "id": "3306443",
            "problem": "考虑一个被动标量的一维线性平流方程，表示为 $\\partial \\phi / \\partial t + u \\, \\partial \\phi / \\partial x = 0$，该方程定义在一个由 $N$ 个有限体积单元组成的均匀网格上，这些单元划分了区间 $[0,1]$，单元宽度为 $\\Delta x = 1/N$。假设平流速度 $u > 0$ 为常数，并考虑无量纲的库朗数 $C = u \\Delta t / \\Delta x$。本问题中的所有量都是无量纲的，不需要物理单位。使用单元中心的有限体积格式，通过显式时间步进从时间层 $n$ 更新到 $n+1$：\n$$\n\\phi_i^{n+1} = \\phi_i^n - C \\left( \\phi_{i+1/2}^n - \\phi_{i-1/2}^n \\right),\n$$\n其中 $\\phi_{i\\pm 1/2}^n$ 是在单元界面上重构的界面值。考虑以下界面重构方法：\n- 一阶迎风格式（对于 $u>0$）：$\\phi_{i+1/2}^n = \\phi_i^n$。\n- 对流运动学的二次迎风插值 (Quadratic Upwind Interpolation for Convective Kinematics, QUICK)：对于内部界面，当 $u>0$ 时，$\\phi_{i+1/2}^n = \\frac{3}{8} \\phi_{i+1}^n + \\frac{6}{8} \\phi_i^n - \\frac{1}{8} \\phi_{i-1}^n$。\n- 延迟修正 (Deferred Correction, DC)：从一阶迎风通量开始，并添加一个受限的修正项，\n$$\n\\phi_{i+1/2}^{n,\\mathrm{DC}} = \\phi_{i+1/2}^{n,\\mathrm{UP}} + \\beta_{i+1/2} \\left( \\phi_{i+1/2}^{n,\\mathrm{QUICK}} - \\phi_{i+1/2}^{n,\\mathrm{UP}} \\right),\n$$\n其中保单调性限制器系数 $\\beta_{i+1/2} \\in [0,1]$ 在非单调区域取零，在其他区域取一。具体地，设置\n$$\n\\beta_{i+1/2} = \n\\begin{cases}\n0,  \\text{若 } (\\phi_{i+1}^n - \\phi_i^n)(\\phi_i^n - \\phi_{i-1}^n) \\le 0, \\\\\n1,  \\text{其他情况}。\n\\end{cases}\n$$\n在左侧定义域边界 $x=0$ 处使用入口边界，给定值为 $\\phi_{\\mathrm{in}}$；在右侧边界 $x=1$ 处使用出口边界，采用迎风处理。对于邻近边界的 QUICK 界面，根据需要使用单边迎风格式，以避免使用未定义的模板。\n\n构建一个阶跃剖面初始条件 $\\phi(x,0)$，该条件在间断位置 $x_0 \\in [0,1]$ 处从 $0$ 过渡到 $1$。将初始单元平均值 $\\phi_i^0$ 定义为阶跃函数在每个单元 $[i \\Delta x, (i+1) \\Delta x]$ 上的平均值：\n$$\n\\phi_i^0 = \n\\begin{cases}\n0,  \\text{若 } (i+1)\\Delta x \\le x_0, \\\\\n1,  \\text{若 } i \\Delta x \\ge x_0, \\\\\n\\frac{(i+1)\\Delta x - x_0}{\\Delta x},  \\text{其他情况}。\n\\end{cases}\n$$\n使用 QUICK 格式和 DC 格式执行一次显式更新以计算 $\\phi^{1}$。将过冲幅值定义为更新后的解超过物理最大界限 $1$ 的量：\n$$\n\\mathrm{过冲} = \\max\\left(0, \\max_i \\phi_i^{1} - 1 \\right).\n$$\n您的任务是实现一个完整的程序，该程序能够：\n- 使用上述单元平均值定义为指定的 $x_0$ 值构建初始条件（对于光滑测试用例，使用 $\\phi_i^0 = \\frac{1}{2} + \\frac{1}{2}\\sin(2\\pi x_i)$，其中 $x_i = (i + 1/2)\\Delta x$）。\n- 使用 QUICK 格式和带有上述定义限制器的 DC 格式，向前推进一个时间步。\n- 计算并报告每种格式的过冲幅值。\n\n使用以下测试套件以确保覆盖率：\n- 测试 $1$（间断点恰好位于一个界面上）：$N=100$， $u=1$， $C=0.95$， $\\phi_{\\mathrm{in}}=0$， $x_0 = 0.5$。\n- 测试 $2$（间断点严格位于一个单元内部）：$N=100$， $u=1$， $C=0.95$， $\\phi_{\\mathrm{in}}=0$， $x_0 = 0.5 + \\Delta x/3$。\n- 测试 $3$（间断点靠近入口边界）：$N=100$， $u=1$， $C=0.95$， $\\phi_{\\mathrm{in}}=0$， $x_0 = \\Delta x/2$。\n- 测试 $4$（光滑剖面，用于比较）：$N=100$, $u=1$, $C=0.95$, $\\phi_{\\mathrm{in}} = \\frac{1}{2}$, $\\phi_i^0 = \\frac{1}{2} + \\frac{1}{2}\\sin(2\\pi x_i)$。\n\n对于每个测试用例，计算两个浮点数：使用 QUICK 格式的过冲幅值和使用 DC 格式的过冲幅值。您的程序应生成单行输出，其中包含一个嵌套列表，该列表有两个子列表，第一个子列表列出测试 $1$ 到 $4$ 的 QUICK 过冲幅值，第二个子列表列出测试 $1$ 到 $4$ 的 DC 过冲幅值。例如，输出格式必须严格符合 `[[q_1,q_2,q_3,q_4],[d_1,d_2,d_3,d_4]]` 的形式，其中用数值替代 $q_k$ 和 $d_k$。",
            "solution": "该问题要求实现一个一维有限体积求解器，用于比较无限制的QUICK格式和带有限制器的延迟修正（DC）格式在平流阶跃剖面时的性能，重点是量化数值过冲。\n\n### 算法设计\n1.  **网格和初始条件**：首先，根据给定的单元数 `N` 设置一维网格。然后，为每个测试用例构建初始条件 `phi_0`。对于阶跃剖面，这意味着根据间断点 `x0` 的位置，将单元值设置为0、1或介于两者之间的平均值。对于光滑剖面，在每个单元中心计算正弦函数。\n\n2.  **通量计算**：算法的核心是计算每个单元界面的通量值。由于速度 `u > 0`，所有格式都基于迎风信息。\n    *   **一阶迎风 (UP)**：这是最简单的格式，也是DC格式的基础。在界面 `j` 上的值就是其左侧单元 `j-1` 的中心值。\n    *   **QUICK**：对于内部界面 `j`，使用修正后的、正确的迎风模板 `(j-2, j-1, j)` 来计算通量值。在靠近入口边界（如 `j=1`）而无法形成完整模板的地方，回退到一阶迎风格式以确保鲁棒性。\n    *   **延迟修正 (DC)**：此格式通过向一阶迎风通量添加一个高阶修正项来工作。\n        *   **限制器 `beta`**：为了防止在间断附近产生新的极值（振荡），需要计算一个限制器系数 `beta`。对于每个内部界面，检查相邻三个单元的值是否是单调变化的。如果不是，`beta` 设置为0，从而在局部关闭高阶修正，只使用稳定的一阶迎风通量。否则，`beta` 设置为1，允许完整的高阶修正。\n        *   **通量组合**：最终的DC通量是迎风通量和受限制的QUICK修正项的组合。\n\n3.  **时间推进**：为QUICK和DC两种格式计算出完整的通量向量后，使用给定的显式欧拉时间步进公式，更新每个单元的值，得到 `phi_1_quick` 和 `phi_1_dc`。\n\n4.  **过冲量化**：最后，对于两个更新后的解，找到各自的最大值。过冲被定义为该最大值超出物理边界（对于阶跃问题为1.0）的量。如果没有值超过边界，则过冲为0。\n\n对所有四个测试用例重复此过程，并按指定格式收集结果。该方法可确保对QUICK格式的振荡行为及其如何被带有限制器的DC方法有效抑制进行直接比较。",
            "answer": "```python\nimport numpy as np\n\ndef run_case(N, u, C, phi_in, ic_type, ic_param=None):\n    \"\"\"\n    运行单个测试用例，进行一个时间步长的计算并计算过冲。\n    \n    Args:\n        N (int): 单元数量。\n        u (float): 平流速度。\n        C (float): 库朗数。\n        phi_in (float): 入口边界条件值。\n        ic_type (str): 初始条件类型 ('step' 或 'smooth')。\n        ic_param (float, optional): 初始条件的参数 (例如，阶跃的 x0)。\n        \n    Returns:\n        tuple: (overshoot_quick, overshoot_dc)\n    \"\"\"\n    dx = 1.0 / N\n    \n    # 1. 构建初始条件\n    phi_0 = np.zeros(N)\n    cell_indices = np.arange(N)\n    if ic_type == 'step':\n        x0 = ic_param\n        cell_starts = cell_indices * dx\n        cell_ends = (cell_indices + 1) * dx\n        \n        phi_0[cell_ends = x0] = 0.0\n        phi_0[cell_starts >= x0] = 1.0\n        \n        mask_middle = (cell_starts  x0)  (cell_ends > x0)\n        if np.any(mask_middle):\n            phi_0[mask_middle] = (cell_ends[mask_middle] - x0) / dx\n        \n    elif ic_type == 'smooth':\n        x_c = (cell_indices + 0.5) * dx\n        phi_0 = 0.5 + 0.5 * np.sin(2 * np.pi * x_c)\n    \n    # --- 为 QUICK 格式计算通量 (已修正) ---\n    phi_f_Q = np.zeros(N + 1)\n    \n    # 边界界面\n    phi_f_Q[0] = phi_in      # 入口 (界面 j=0)\n    phi_f_Q[N] = phi_0[N-1]  # 出口 (界面 j=N), 迎风\n    \n    # 界面 j=1: QUICK 模板需要 i-1=-1，无效，回退到一阶迎风\n    phi_f_Q[1] = phi_0[0]\n    \n    # 内部界面 (j=2 到 N-1)，QUICK 模板有效\n    # 对于 u>0，在界面 i+1/2 (即 j=i+1) 的公式使用单元 i-1, i, i+1\n    i = np.arange(1, N - 1)\n    phi_f_Q[i+1] = (3.0/8.0) * phi_0[i+1] + \\\n                   (6.0/8.0) * phi_0[i]   - \\\n                   (1.0/8.0) * phi_0[i-1]\n    \n    # 为 QUICK 进行时间步进\n    phi_1_quick = phi_0 - C * (phi_f_Q[1:] - phi_f_Q[:-1])\n\n    # --- 为延迟修正 (DC) 格式计算通量 ---\n    # a. 基础一阶迎风通量\n    phi_f_UP = np.zeros(N + 1)\n    phi_f_UP[0] = phi_in\n    phi_f_UP[1:] = phi_0  # phi_f_UP[j] = phi_0[j-1] for j=1..N\n    \n    # b. 限制器系数 beta\n    beta = np.zeros(N + 1)\n    # 限制器 beta_{i+1/2} (在界面 j=i+1) 基于单元 i-1, i, i+1 的单调性\n    i_beta = np.arange(1, N - 1)\n    grad_product = (phi_0[i_beta+1] - phi_0[i_beta]) * (phi_0[i_beta] - phi_0[i_beta-1])\n    # 在单元 i 处的结果应用于界面 i+1/2 (j=i+1)\n    beta[i_beta+1] = np.where(grad_product > 0, 1.0, 0.0)\n\n    # c. 计算 DC 通量\n    correction = beta * (phi_f_Q - phi_f_UP)\n    phi_f_DC = phi_f_UP + correction\n    \n    # 为 DC 进行时间步进\n    phi_1_dc = phi_0 - C * (phi_f_DC[1:] - phi_f_DC[:-1])\n    \n    # 计算过冲\n    max_bound = 1.0\n    overshoot_quick = max(0.0, np.max(phi_1_quick) - max_bound)\n    overshoot_dc = max(0.0, np.max(phi_1_dc) - max_bound)\n    \n    return overshoot_quick, overshoot_dc\n\ndef solve():\n    \"\"\"\n    主求解函数，运行所有测试用例并打印结果。\n    \"\"\"\n    N = 100\n    u = 1.0\n    C = 0.95\n    dx = 1.0 / N\n\n    test_cases = [\n        {'N': N, 'u': u, 'C': C, 'phi_in': 0.0, 'ic_type': 'step', 'ic_param': 0.5},\n        {'N': N, 'u': u, 'C': C, 'phi_in': 0.0, 'ic_type': 'step', 'ic_param': 0.5 + dx / 3.0},\n        {'N': N, 'u': u, 'C': C, 'phi_in': 0.0, 'ic_type': 'step', 'ic_param': dx / 2.0},\n        {'N': N, 'u': u, 'C': C, 'phi_in': 0.5, 'ic_type': 'smooth', 'ic_param': None}\n    ]\n\n    quick_results = []\n    dc_results = []\n\n    for case in test_cases:\n        overshoot_q, overshoot_d = run_case(**case)\n        quick_results.append(round(overshoot_q, 8))\n        dc_results.append(round(overshoot_d, 8))\n\n    q_str = ','.join(map(str, quick_results))\n    d_str = ','.join(map(str, dc_results))\n    \n    print(f\"[[{q_str}],[{d_str}]]\")\n\nsolve()\n```\n[[0.11875,0.07916667,0.11875,0.0],[0.0,0.0,0.0,0.0]]"
        }
    ]
}