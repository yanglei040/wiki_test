{
    "hands_on_practices": [
        {
            "introduction": "迎风格式因其稳定性而备受推崇，但这种稳定性并非没有代价。它以牺牲精度为代价，引入了一种行为类似于物理扩散的误差。本练习  是一项经典的理论分析，旨在揭示这种“数值扩散”的来源。通过对离散化的平流方程进行泰勒级数展开，您将推导出修正方程——即您的代码实际求解的偏微分方程——并分析确定该人为扩散项的具体形式。",
            "id": "3386735",
            "problem": "考虑具有恒定速度的线性一维($1$D)平流方程，\n$$\n\\partial_{t} \\phi + a \\,\\partial_{x} \\phi = 0,\n$$\n其中 $a>0$ 是常数。使用有限体积法，在间距为 $\\Delta x$ 的均匀网格上离散化此方程，其中面值采用一阶迎风插值，并使用时间步长为 $\\Delta t$ 的前向(显式)欧拉法进行时间推进。令 Courant–Friedrichs–Lewy (CFL) 数定义为 $\\mathrm{CFL} \\equiv a\\,\\Delta t/\\Delta x$。\n\n从积分守恒形式和由迎风面值构建的数值通量的定义出发，推导全离散格式在 $\\Delta x$ 和 $\\Delta t$ 的主非平凡阶上满足的修正方程。特别地，识别可被解释为有效扩散的主阶截断项，从而将修正方程写成以下形式\n$$\n\\partial_{t} \\phi + a\\,\\partial_{x} \\phi = D_{\\text{num}}\\,\\partial_{xx} \\phi + \\text{higher-order terms}.\n$$\n您的推导必须从有限体积平衡和显式欧拉更新开始，围绕空间和时间上的一个通用单元中心进行泰勒展开，并在适当之处使用连续方程消除时间导数，以空间导数代之。\n\n请以 $a$、$\\Delta x$ 和 $\\mathrm{CFL}$ 的单个闭式解析表达式的形式报告有效数值扩散系数 $D_{\\text{num}}$。最终答案仅提供 $D_{\\text{num}}$ 的解析表达式。无需进行数值计算或四舍五入。",
            "solution": "该问题已经过验证并被认为是有效的。这是偏微分方程数值方法分析中的一个标准的、适定的问题，基于已建立的数学和计算原理。所有必要信息均已提供，术语精确无歧义。\n\n我们首先陈述一维线性平流方程在控制体积(或单元) $C_i = [x_{i-1/2}, x_{i+1/2}]$ 上的积分守恒形式，其中 $x_i$ 是单元中心，$\\Delta x = x_{i+1/2} - x_{i-1/2}$ 是均匀的单元宽度。\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial \\phi}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (a\\phi)}{\\partial x} \\,dx = 0\n$$\n令 $\\phi_i(t)$ 为守恒量 $\\phi$ 在时间 $t$ 位于单元 $C_i$ 内的单元平均值，定义为：\n$$\n\\phi_i(t) \\equiv \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\phi(x,t) \\,dx\n$$\n将此定义和微积分基本定理应用于积分守恒律，我们得到半离散有限体积公式：\n$$\n\\frac{d\\phi_i}{dt} + \\frac{1}{\\Delta x} \\left[ (a\\phi)_{i+1/2} - (a\\phi)_{i-1/2} \\right] = 0\n$$\n此处，$(a\\phi)_{i \\pm 1/2}$ 表示在单元面 $x_{i \\pm 1/2}$ 处的数值通量。\n\n问题指定使用前向(显式)欧拉法进行时间积分。将此方法以时间步长 $\\Delta t$ 应用于半离散方程，得到全离散形式：\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left[ F_{i+1/2}^n - F_{i-1/2}^n \\right] = 0\n$$\n其中上标 $n$ 表示时间层 $t_n = n\\Delta t$，数值通量为 $F = a\\phi$。\n\n空间离散化采用一阶迎风插值。由于速度 $a$ 给定为正值 ($a>0$)，因此“迎风”方向是向左。因此，单元面上的 $\\phi$ 值取自其紧邻的左侧单元。\n对于 $x_{i+1/2}$ 处的面，迎风单元是 $C_i$，因此 $\\phi_{i+1/2}^n = \\phi_i^n$。\n对于 $x_{i-1/2}$ 处的面，迎风单元是 $C_{i-1}$，因此 $\\phi_{i-1/2}^n = \\phi_{i-1}^n$。\n因此，数值通量为：\n$$\nF_{i+1/2}^n = a \\phi_i^n \\quad \\text{and} \\quad F_{i-1/2}^n = a \\phi_{i-1}^n\n$$\n将这些通量代入全离散方程，得到：\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} + \\frac{a}{\\Delta x} \\left( \\phi_i^n - \\phi_{i-1}^n \\right) = 0\n$$\n为了推导修正方程，我们围绕中心点 $(x_i, t_n)$ 对离散方程中的每一项进行泰勒级数展开。我们将 $\\phi_i^n$ 视为精确解在该点的值 $\\phi(x_i, t_n)$，并将其余各项与之关联。\n$\\phi_i^{n+1}$ 在时间上的展开式为：\n$$\n\\phi_i^{n+1} = \\phi(x_i, t_n + \\Delta t) = \\phi(x_i, t_n) + \\Delta t \\, \\partial_t\\phi + \\frac{(\\Delta t)^2}{2} \\, \\partial_{tt}\\phi + \\mathcal{O}((\\Delta t)^3)\n$$\n$\\phi_{i-1}^n$ 在空间上的展开式为：\n$$\n\\phi_{i-1}^n = \\phi(x_i - \\Delta x, t_n) = \\phi(x_i, t_n) - \\Delta x \\, \\partial_x\\phi + \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx}\\phi - \\frac{(\\Delta x)^3}{6} \\, \\partial_{xxx}\\phi + \\mathcal{O}((\\Delta x)^4)\n$$\n在这些展开式中，$\\phi$ 及其偏导数均在 $(x_i, t_n)$ 处求值。\n\n我们将这些展开式代入离散方程的左侧：\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} = \\frac{1}{\\Delta t} \\left( \\left[ \\phi + \\Delta t \\, \\partial_t\\phi + \\frac{(\\Delta t)^2}{2} \\, \\partial_{tt}\\phi + \\dots \\right] - \\phi \\right) = \\partial_t\\phi + \\frac{\\Delta t}{2} \\, \\partial_{tt}\\phi + \\mathcal{O}((\\Delta t)^2)\n$$\n以及右侧：\n$$\n-\\frac{a}{\\Delta x} (\\phi_i^n - \\phi_{i-1}^n) = -\\frac{a}{\\Delta x} \\left( \\phi - \\left[ \\phi - \\Delta x \\, \\partial_x\\phi + \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx}\\phi - \\dots \\right] \\right)\n$$\n$$\n= -\\frac{a}{\\Delta x} \\left( \\Delta x \\, \\partial_x\\phi - \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx}\\phi + \\dots \\right) = -a\\,\\partial_x\\phi + \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi - \\mathcal{O}((\\Delta x)^2)\n$$\n令展开后的左右两侧相等，便得到该离散格式实际求解的偏微分方程，保留至主阶误差项：\n$$\n\\partial_t\\phi + \\frac{\\Delta t}{2} \\, \\partial_{tt}\\phi = -a\\,\\partial_x\\phi + \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi + \\text{H.O.T.}\n$$\n其中 H.O.T. 代表高阶项。整理后，我们得到：\n$$\n\\partial_t\\phi + a\\,\\partial_x\\phi = \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi - \\frac{\\Delta t}{2} \\, \\partial_{tt}\\phi + \\text{H.O.T.}\n$$\n这还不是所需的形式，因为截断误差中包含时间导数 $\\partial_{tt}\\phi$。为得到修正方程，我们必须用空间导数来表示这个时间导数。我们使用原始偏微分方程 $\\partial_t\\phi = -a\\,\\partial_x\\phi$，它在最低阶上是成立的。我们可以对该方程求导，以找到高阶导数之间的关系。\n$$\n\\partial_{t} (\\partial_t \\phi) = \\partial_{t} (-a\\,\\partial_x \\phi) = -a\\,\\partial_{tx}\\phi\n$$\n假设解 $\\phi$ 足够光滑，我们有 $\\partial_{tx}\\phi = \\partial_{xt}\\phi$。于是：\n$$\n\\partial_{tt}\\phi = -a\\,\\partial_{x}(\\partial_t \\phi) = -a\\,\\partial_{x}(-a\\,\\partial_x \\phi) = a^2\\,\\partial_{xx}\\phi\n$$\n我们也可以从修正方程本身 $\\partial_t \\phi = -a \\partial_x \\phi + \\mathcal{O}(\\Delta x, \\Delta t)$ 推导 $\\partial_{tt}\\phi$ 的表达式。对其求导得到 $\\partial_{tt}\\phi = a^2 \\partial_{xx}\\phi + \\mathcal{O}(\\Delta x, \\Delta t)$。将其代回截断误差项不会改变主阶行为。\n\n将 $\\partial_{tt}\\phi = a^2\\,\\partial_{xx}\\phi$ 代入我们整理后的方程：\n$$\n\\partial_t\\phi + a\\,\\partial_x\\phi = \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi - \\frac{\\Delta t}{2} (a^2\\,\\partial_{xx}\\phi) + \\text{H.O.T.}\n$$\n现在我们可以将乘以二阶空间导数 $\\partial_{xx}\\phi$ 的项组合在一起：\n$$\n\\partial_t\\phi + a\\,\\partial_x\\phi = \\left( \\frac{a\\Delta x}{2} - \\frac{a^2\\Delta t}{2} \\right) \\partial_{xx}\\phi + \\text{H.O.T.}\n$$\n这就是主非平凡阶的修正方程。乘以 $\\partial_{xx}\\phi$ 的项是有效数值扩散系数 $D_{\\text{num}}$。\n$$\nD_{\\text{num}} = \\frac{a\\Delta x}{2} - \\frac{a^2\\Delta t}{2}\n$$\n问题要求用 $a$、$\\Delta x$ 和 Courant–Friedrichs–Lewy (CFL) 数（定义为 $\\mathrm{CFL} \\equiv a\\,\\Delta t/\\Delta x$）来表示这个表达式。我们可以从 $D_{\\text{num}}$ 的表达式中提出因子 $\\frac{a\\Delta x}{2}$：\n$$\nD_{\\text{num}} = \\frac{a\\Delta x}{2} \\left( 1 - \\frac{a^2\\Delta t}{a\\Delta x} \\right) = \\frac{a\\Delta x}{2} \\left( 1 - \\frac{a\\Delta t}{\\Delta x} \\right)\n$$\n代入 CFL 数的定义，我们得到数值扩散系数的最终表达式：\n$$\nD_{\\text{num}} = \\frac{a\\Delta x}{2} (1 - \\mathrm{CFL})\n$$\n这个具有扩散项形式的主阶截断误差项，是造成一阶迎风格式耗散性的原因。",
            "answer": "$$\n\\boxed{\\frac{a \\Delta x}{2} (1 - \\mathrm{CFL})}\n$$"
        },
        {
            "introduction": "在理论上识别出数值扩散之后，下一个合乎逻辑的步骤是在一个实际问题中量化其影响。本练习  提供了一个直接测量迎风格式误差的动手实践机会。您将首先推导出一个一维稳态对流-扩散问题的精确解析解，然后计算该精确值与在单元交界面上通过迎风插值预测的值之间的差异，从而探索该误差如何随佩克莱数（Peclet number）和网格分辨率的变化而变化。",
            "id": "3386667",
            "problem": "考虑在无量纲域 $x \\in [0,1]$ 上的一维稳态对流扩散边值问题，其材料性质和速度均为常数，由被动标量$\\phi(x)$的守恒定律控制：\n$$\n\\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0,\n$$\n服从狄利克雷边界条件 $\\phi(0) = \\phi_0$ 和 $\\phi(1) = \\phi_1$。假设 $\\Gamma > 0$，$\\rho > 0$ 和 $u > 0$ 均为常数。定义无量纲全局佩克莱数为\n$$\nP = \\frac{\\rho u L}{\\Gamma},\n$$\n其中 $L = 1$，均匀网格由 $N$ 个有限体积组成，间距为 $\\Delta x = \\frac{1}{N}$。设内部面位置为 $x_f = j \\Delta x$（其中 $j = 1,2,\\dots,N-1$），单元中心位置为 $x_j = \\left(j - \\frac{1}{2}\\right) \\Delta x$（其中 $j = 1,2,\\dots,N$）。定义局部单元佩克莱数为\n$$\nPe = \\frac{P}{N}.\n$$\n\n使用有限体积法（FVM），通过一个面的对流通量需要对该面上的值 $\\phi_f$ 进行近似。对于正速度 $u > 0$，迎风插值法规定，位于单元 $j$ 和 $j+1$ 之间的内部面上的值为\n$$\n\\phi_f^{\\text{up}} = \\phi(x_j),\n$$\n其中 $\\phi(x_j)$ 表示单元中心的值。精确的面值为 $\\phi(x_f)$，其中 $\\phi(x)$ 是该边值问题的精确连续解。\n\n您的任务是：\n- 使用控制方程和边界条件推导精确连续解 $\\phi(x)$。\n- 对下面指定的每个测试用例，计算所有内部面上由迎风插值引起的误差，误差定义为\n$$\ne_j = \\phi_f^{\\text{up}} - \\phi(x_f) = \\phi(x_j) - \\phi(x_f),\n$$\n并报告两个标量度量：\n    1. 所有内部面上的最大绝对误差，\n    $$\n    E_{\\infty} = \\max_{1 \\le j \\le N-1} |e_j|.\n    $$\n    2. 所有内部面上的平均绝对误差，\n    $$\n    E_{\\text{mean}} = \\frac{1}{N-1} \\sum_{j=1}^{N-1} |e_j|.\n    $$\n- 使用边界值 $\\phi_0 = 0$ 和 $\\phi_1 = 1$。\n\n所有量均为无量纲。最终输出必须是测试集上聚合结果，打印为单行，其中包含一个由双元素列表组成的列表，每个内部列表为 $[E_{\\infty}, E_{\\text{mean}}]$，对应于下面列出的测试用例，并按顺序排列。\n\n测试集：\n1. $P = 0.0$, $N = 4$。\n2. $P = 0.1$, $N = 10$。\n3. $P = 2.0$, $N = 10$。\n4. $P = 2.0$, $N = 40$。\n5. $P = 10.0$, $N = 10$。\n6. $P = 10.0$, $N = 100$。\n\n您的程序应生成一行输出，其中包含一个逗号分隔的列表形式的结果，并用方括号括起来，例如，`[[r_{11}, r_{12}], [r_{21}, r_{22}], \\dots]`，其中每个 `r_{ij}` 是一个浮点数，代表相应测试用例的 $E_{\\infty}$ 或 $E_{\\text{mean}}$。",
            "solution": "该问题被验证为具有科学依据、适定、客观和完整。所有必要信息均已提供，并且这些概念在输运现象和计算流体力学领域是标准的。任务是推导一维稳态对流扩散方程的精确解，然后为一组给定的参数计算一阶迎风插值格式的误差。\n\n### 步骤 1：精确解析解的推导\n\n被动标量 $\\phi(x)$ 的稳态一维对流扩散控制方程为：\n$$\n\\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0\n$$\n假设扩散系数 $\\Gamma$、密度 $\\rho$ 和速度 $u$ 是常数，该方程简化为一个具有常系数的二阶线性常微分方程（ODE）：\n$$\n\\Gamma \\frac{d^2 \\phi}{dx^2} - \\rho u \\frac{d \\phi}{dx} = 0\n$$\n两边除以 $\\Gamma$（因为 $\\Gamma > 0$）：\n$$\n\\frac{d^2 \\phi}{dx^2} - \\frac{\\rho u}{\\Gamma} \\frac{d \\phi}{dx} = 0\n$$\n问题中定义了全局佩克莱数 $P = \\frac{\\rho u L}{\\Gamma}$，其中域长度 $L=1$。将其代入 ODE 得到：\n$$\n\\frac{d^2 \\phi}{dx^2} - P \\frac{d \\phi}{dx} = 0\n$$\n该 ODE 的特征方程是 $r^2 - Pr = 0$，它有两个不同的根：$r_1 = 0$ 和 $r_2 = P$。\n\n**情况 1：$P \\neq 0$**\n通解的形式为 $\\phi(x) = C_1 e^{r_1 x} + C_2 e^{r_2 x}$，即：\n$$\n\\phi(x) = C_1 + C_2 e^{Px}\n$$\n积分常数 $C_1$ 和 $C_2$ 由狄利克雷边界条件 $\\phi(0) = \\phi_0$ 和 $\\phi(1) = \\phi_1$ 确定。\n在 $x=0$ 处：\n$$\n\\phi(0) = C_1 + C_2 e^0 = C_1 + C_2 = \\phi_0\n$$\n在 $x=1$ 处：\n$$\n\\phi(1) = C_1 + C_2 e^P = \\phi_1\n$$\n解这个关于 $C_1$ 和 $C_2$ 的线性方程组：\n由第一个方程得 $C_1 = \\phi_0 - C_2$。代入第二个方程：\n$$\n(\\phi_0 - C_2) + C_2 e^P = \\phi_1 \\implies C_2(e^P - 1) = \\phi_1 - \\phi_0 \\implies C_2 = \\frac{\\phi_1 - \\phi_0}{e^P - 1}\n$$\n然后求出 $C_1$：\n$$\nC_1 = \\phi_0 - \\frac{\\phi_1 - \\phi_0}{e^P - 1} = \\frac{\\phi_0(e^P - 1) - (\\phi_1 - \\phi_0)}{e^P - 1} = \\frac{\\phi_0 e^P - \\phi_1}{e^P - 1}\n$$\n将 $C_1$ 和 $C_2$ 代回通解，得到：\n$$\n\\phi(x) = \\frac{\\phi_0 e^P - \\phi_1}{e^P - 1} + \\left(\\frac{\\phi_1 - \\phi_0}{e^P - 1}\\right) e^{Px} = \\phi_0 + (\\phi_1 - \\phi_0) \\frac{e^{Px} - 1}{e^P - 1}\n$$\n对于特定的边界条件 $\\phi_0 = 0$ 和 $\\phi_1 = 1$，精确解简化为：\n$$\n\\phi(x) = \\frac{e^{Px} - 1}{e^P - 1}\n$$\n\n**情况 2：$P = 0$**\n当 $P=0$ 时，控制方程简化为纯扩散方程：\n$$\n\\frac{d^2 \\phi}{dx^2} = 0\n$$\n积分两次得到一个线性解：$\\phi(x) = C_1 x + C_2$。\n应用边界条件 $\\phi(0) = \\phi_0 = 0$ 和 $\\phi(1) = \\phi_1 = 1$：\n在 $x=0$ 处：$\\phi(0) = C_2 = 0$。\n在 $x=1$ 处：$\\phi(1) = C_1 + C_2 = C_1 = 1$。\n因此，对于 $P=0$，精确解为：\n$$\n\\phi(x) = x\n$$\n这个结果与 $P \\neq 0$ 的解在 $P \\to 0$ 时的极限是一致的，这可以用洛必达法则来验证。\n\n### 步骤 2：误差计算方法\n\n该问题要求计算一阶迎风插值格式在每个内部控制体面上的误差。网格有 $N$ 个均匀的控制体，宽度为 $\\Delta x = 1/N$。\n\n- 内部面位于 $x_f = j \\Delta x$，其中 $j = 1, 2, \\ldots, N-1$。\n- 单元中心位于 $x_j = (j - 1/2) \\Delta x$，其中 $j = 1, 2, \\ldots, N$。\n\n问题指出，对于正速度（$u>0$），对流是从左向右的。在单元 $j$ 和单元 $j+1$ 之间的面（位于 $x_f = j\\Delta x$）上的迎风值是来自上游单元（即单元 $j$）中心的值。单元 $j$ 的中心位于 $x_j = (j - 1/2)\\Delta x$。因此，面值的迎风近似为：\n$$\n\\phi_f^{\\text{up}} = \\phi(x_j) = \\phi\\left(\\left(j - \\frac{1}{2}\\right)\\Delta x\\right)\n$$\n在同个面上的精确值为 $\\phi(x_f) = \\phi(j\\Delta x)$。\n\n在第 $j$ 个内部面上的插值误差 $e_j$ 定义为迎风近似值与精确面值之差：\n$$\ne_j = \\phi_f^{\\text{up}} - \\phi(x_f) = \\phi\\left(\\left(j - \\frac{1}{2}\\right)\\Delta x\\right) - \\phi(j\\Delta x)\n$$\n对所有内部面（即 $j = 1, 2, \\ldots, N-1$）执行此计算。\n\n### 步骤 3：数值程序和误差度量\n\n对于由一对值 $(P, N)$ 定义的每个测试用例，执行以下程序：\n1. 根据 $P$ 的值，确定精确解 $\\phi(x)$ 的适当形式。\n2. 计算网格间距 $\\Delta x = 1/N$。\n3. 对于从 $1$ 到 $N-1$ 的每个内部面索引 $j$：\n    a. 确定迎风单元中心的坐标：$x_{\\text{cell}} = (j - 1/2)\\Delta x$。\n    b. 确定面的坐标：$x_{\\text{face}} = j\\Delta x$。\n    c. 在这两点上评估精确解：$\\phi(x_{\\text{cell}})$ 和 $\\phi(x_{\\text{face}})$。\n    d. 计算误差：$e_j = \\phi(x_{\\text{cell}}) - \\phi(x_{\\text{face}})$。\n4. 在计算出误差数组 $\\{e_1, e_2, \\ldots, e_{N-1}\\}$ 后，计算两个所需的度量：\n    a. 最大绝对误差（无穷范数）：\n       $$\n       E_{\\infty} = \\max_{1 \\le j \\le N-1} |e_j|\n       $$\n    b. 平均绝对误差：\n       $$\n       E_{\\text{mean}} = \\frac{1}{N-1} \\sum_{j=1}^{N-1} |e_j|\n       $$\n5. 对 $[E_{\\infty}, E_{\\text{mean}}]$ 这对值构成一个测试用例的结果。对所有提供的测试用例重复此过程。为了数值稳定性，表达式 $\\frac{e^A-1}{e^B-1}$ 用 `np.expm1(A) / np.expm1(B)` 来实现，以保持对小参数的精度。",
            "answer": "[[0.125, 0.125],[0.0487300330366282, 0.04758509315516035],[0.0861191028399589, 0.07604473820293026],[0.023247072922989047, 0.022370716606822295],[0.05278923483321213, 0.0298495815657492],[0.005131584639205167, 0.002998687788484196]]"
        },
        {
            "introduction": "开发可靠数值求解器的一个基本实践是代码验证——确保所实现的代码的行为符合其基础理论。本练习  引入了强大的“制造解方法”(Method of Manufactured Solutions, MMS)，以正式验证我们迎风格式的收敛阶。您将为一个带有特殊设计源项的平流问题实现一个有限体积求解器，并证明随着网格的加密，误差确实以预期的一阶速率减小，从而确认您的实现是正确的。",
            "id": "3386714",
            "problem": "考虑空间域 $[0,1]$ 上标量场 $\\phi(x)$ 的稳态一维纯平流问题，其速度 $a \\in \\mathbb{R}$ 为常数，并受源项 $s(x)$ 影响。其微分形式的控制守恒律为\n$$\n\\frac{d}{dx}\\big(a\\,\\phi(x)\\big) = s(x),\n$$\n并在相应的上游边界上施加入流边界条件。为验证一阶迎风有限体积离散的网格收敛性，请使用人造解方法：指定一个光滑的精确解\n$$\n\\phi_{\\text{exact}}(x) = \\sin(2\\pi x),\n$$\n其中角度以弧度为单位，并选择 $s(x)$ 使得对于任意常数 $a$，控制方程都由 $\\phi_{\\text{exact}}(x)$ 恒成立。也就是说，根据上述定义确定 $s(x)$。\n\n将域 $[0,1]$ 离散为 $N$ 个宽度为 $\\Delta x = 1/N$ 的均匀有限体积（单元），其单元中心为 $x_i = \\big(i+\\frac{1}{2}\\big)\\Delta x$，$i = 0,1,\\dots,N-1$。从守恒律出发，推导单元积分平衡\n$$\n\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} \\frac{d}{dx}\\big(a\\,\\phi(x)\\big)\\,dx = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} s(x)\\,dx,\n$$\n并使用迎风插值法计算面值，从而得到相应的离散通量差：\n- 对于 $a>0$， $x_{i+\\frac{1}{2}}$ 处的面值取自上游（左）侧，而 $x_{i-\\frac{1}{2}}$ 处的面值取自上游（左）侧（包括左边界），这与 $a$ 的符号一致。\n- 对于 $a<0$， $x_{i+\\frac{1}{2}}$ 处的面值取自上游（右）侧，而 $x_{i-\\frac{1}{2}}$ 处的面值取自上游（右）侧（包括右边界）。\n\n在每个单元中，使用中点法则近似源项积分，即使用 $s(x_i)\\,\\Delta x$。通过从入流边界向出流边界推进（当 $a>0$ 时为前向代入，当 $a<0$ 时为反向代入）来求解得到的稳态离散系统，并在相应边界上使用由 $\\phi_{\\text{exact}}(x)$ 设定的入流边界值。计算离散 $L^1$ 误差\n$$\nE_{L^1}(N,a) = \\sum_{i=0}^{N-1}\\left|\\phi_i - \\phi_{\\text{exact}}(x_i)\\right|\\,\\Delta x,\n$$\n其中 $\\phi_i$ 表示单元 $i$ 中的离散有限体积解，$\\phi_{\\text{exact}}(x_i)$ 是单元中心处的精确解。通过计算连续网格加密之间的观测阶来展示网格收敛性，\n$$\np = \\frac{\\ln\\big(E_{L^1}(N_{\\text{coarse}},a)/E_{L^1}(N_{\\text{fine}},a)\\big)}{\\ln\\big(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}}\\big)},\n$$\n并验证对于该光滑人造解，$p$ 近似为 $1$。\n\n使用以下 $(a,N)$ 参数对测试套件：\n- $(a,N) = (1.3,20)$,\n- $(a,N) = (1.3,40)$,\n- $(a,N) = (1.3,80)$,\n- $(a,N) = (1.3,160)$,\n- $(a,N) = (-1.7,40)$,\n- $(a,N) = (-1.7,80)$.\n\n角度应以弧度解释。所有量均为无量纲。对于观测阶的计算，当 $a=1.3$ 时，取 $(N_{\\text{coarse}},N_{\\text{fine}})$ 对为 $(20,40)$、$(40,80)$ 和 $(80,160)$；当 $a=-1.7$ 时，取 $(40,80)$。除误差外，还需计算布尔值，以指示每个观测阶是否在 $1$ 的 $\\pm 0.1$ 容差范围内，即 $\\left|p-1\\right|\\le 0.1$ 是否成立。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含：\n- 上述测试用例的 $6$ 个 $L^1$ 误差，\n- 上述网格加密对的 $4$ 个观测阶 $p$，\n- 上述阶数检查的 $4$ 个布尔值。\n\n例如，输出应具有以下形式\n$$\n[\\text{E}_{1},\\text{E}_{2},\\text{E}_{3},\\text{E}_{4},\\text{E}_{5},\\text{E}_{6},\\;p_{1},p_{2},p_{3},p_{4},\\;\\text{b}_{1},\\text{b}_{2},\\text{b}_{3},\\text{b}_{4}],\n$$\n其中每个 $\\text{E}_{k}$ 是一个浮点数，每个 $p_{j}$ 是一个浮点数，每个 $\\text{b}_{j}$ 是一个布尔值。",
            "solution": "用户希望使用一阶迎风有限体积法求解一个稳态一维平流-源问题，并使用人造解方法验证其网格收敛性。\n\n首先，我们验证问题陈述。该问题提供了一个明确定义的偏微分方程、一个人造解、对数值方法（一阶迎风有限体积法）的清晰描述、一个域、边界条件、误差度量和具体的测试用例。该问题在科学上是合理的、适定的、客观的和完整的。它代表了计算流体动力学中的一个标准验证练习。因此，该问题被认为是**有效的**。\n\n求解过程包括以下步骤：\n\n**1. 推导人造源项**\n控制方程是稳态一维守恒律：\n$$\n\\frac{d}{dx}\\big(a\\,\\phi(x)\\big) = s(x)\n$$\n其中 `$a$` 是一个恒定速度。这可以简化为 `$a \\frac{d\\phi}{dx} = s(x)$`。指定的人造解为：\n$$\n\\phi_{\\text{exact}}(x) = \\sin(2\\pi x)\n$$\n为确保 `$\\phi_{\\text{exact}}(x)$` 是一个解，我们必须相应地选择源项 `$s(x)$`。我们对 `$\\phi_{\\text{exact}}(x)$` 求导，并将其代入控制方程：\n$$\n\\frac{d\\phi_{\\text{exact}}}{dx} = \\frac{d}{dx}\\big(\\sin(2\\pi x)\\big) = 2\\pi \\cos(2\\pi x)\n$$\n因此，源项必须为：\n$$\ns(x) = a \\frac{d\\phi_{\\text{exact}}}{dx} = 2\\pi a \\cos(2\\pi x)\n$$\n\n**2. 有限体积离散化**\n我们将域 `$[0,1]$` 离散为 `$N$` 个宽度为 `$\\Delta x = 1/N$` 的均匀单元。第 `$i$` 个单元覆盖区间 `$[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$`，其中心位于 `$x_i = (i+\\frac{1}{2})\\Delta x$`，其中 `$i = 0, \\dots, N-1$`。\n\n我们在第 `$i$` 个单元上对控制方程进行积分：\n$$\n\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} \\frac{d}{dx}\\big(a\\,\\phi(x)\\big)\\,dx = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} s(x)\\,dx\n$$\n对左侧应用微积分基本定理，得到单元面上的通量差：\n$$\n\\big[a\\,\\phi(x)\\big]_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} = (a\\phi)_{i+\\frac{1}{2}} - (a\\phi)_{i-\\frac{1}{2}}\n$$\n其中 `$(a\\phi)_{i \\pm \\frac{1}{2}}$` 表示在面 `$x_{i \\pm \\frac{1}{2}}$` 处的通量。右侧源项的积分使用中点法则近似：\n$$\n\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} s(x)\\,dx \\approx s(x_i)\\Delta x\n$$\n将这些结合起来，得到单元 `$i$` 的离散平衡方程：\n$$\n(a\\phi)_{i+\\frac{1}{2}} - (a\\phi)_{i-\\frac{1}{2}} = s(x_i)\\Delta x\n$$\n令 `$\\phi_i$` 表示单元 `$i$` 中单元平均值的数值近似。我们现在应用一阶迎风格式来近似面通量。\n\n**3. 迎风格式和求解推进**\n迎风格式将 `$\\phi$` 的面值设为面之上游单元的值。上游方向由速度 `$a$` 的符号决定。\n\n**情况1：`$a > 0$`（从左向右流动）**\n上游方向为左侧。\n-   在面 `$x_{i+\\frac{1}{2}}$` 处的通量：值取自单元 `$i$`。 `$ (a\\phi)_{i+\\frac{1}{2}} \\approx a\\phi_i $`。\n-   在面 `$x_{i-\\frac{1}{2}}$` 处的通量：值取自单元 `$i-1$`。 `$ (a\\phi)_{i-\\frac{1}{2}} \\approx a\\phi_{i-1} $`。\n\n离散方程变为：\n$$\na\\phi_i - a\\phi_{i-1} = s(x_i)\\Delta x\n$$\n求解 `$\\phi_i$`，我们得到一个递推关系：\n$$\n\\phi_i = \\phi_{i-1} + \\frac{s(x_i)\\Delta x}{a}\n$$\n入流边界在 `$x=0$`。对于第一个单元（`$i=0$`），`$\\phi_{i-1}$` 项成为边界值 `$\\phi_{-1} \\equiv \\phi_{\\text{exact}}(0) = \\sin(0) = 0$`。因此，我们可以依次求解 `$\\phi_0, \\phi_1, \\dots, \\phi_{N-1}$`（前向代入）。\n\n**情况2：`$a < 0$`（从右向左流动）**\n上游方向为右侧。\n-   在面 `$x_{i+\\frac{1}{2}}$` 处的通量：值取自单元 `$i+1$`。 `$ (a\\phi)_{i+\\frac{1}{2}} \\approx a\\phi_{i+1} $`。\n-   在面 `$x_{i-\\frac{1}{2}}$` 处的通量：值取自单元 `$i$`。 `$ (a\\phi)_{i-\\frac{1}{2}} \\approx a\\phi_i $`。\n\n离散方程变为：\n$$\na\\phi_{i+1} - a\\phi_i = s(x_i)\\Delta x\n$$\n求解 `$\\phi_i$`，我们得到一个不同的递推关系：\n$$\n\\phi_i = \\phi_{i+1} - \\frac{s(x_i)\\Delta x}{a}\n$$\n入流边界在 `$x=1$`。对于最后一个单元（`$i=N-1$`），`$\\phi_{i+1}$` 项成为边界值 `$\\phi_{N} \\equiv \\phi_{\\text{exact}}(1) = \\sin(2\\pi) = 0$`。我们依次求解 `$\\phi_{N-1}, \\phi_{N-2}, \\dots, \\phi_0}$`（反向代入）。\n\n**4. 误差与收敛性分析**\n计算出 `$i=0, \\dots, N-1$` 的数值解 `$\\phi_i$` 后，我们使用给定的公式计算离散 `$L^1$` 误差：\n$$\nE_{L^1}(N,a) = \\sum_{i=0}^{N-1}\\left|\\phi_i - \\phi_{\\text{exact}}(x_i)\\right|\\,\\Delta x\n$$\n收敛的观测阶 `$p$` 是通过对连续加密的网格对计算得出的：\n$$\np = \\frac{\\ln\\big(E_{L^1}(N_{\\text{coarse}},a)/E_{L^1}(N_{\\text{fine}},a)\\big)}{\\ln\\big(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}}\\big)}\n$$\n对于为 `$2$` 的加密因子，`$\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}} = 2$`，因此分母为 `$\\ln(2)$`。该一阶格式的理论收敛阶为 `$p=1$`。我们通过检查 `$\\left|p-1\\right|\\le 0.1$` 来验证这一点。\n\n对于每个指定的 `$(a,N)$` 对，实现将遵循此逻辑来计算和报告误差、阶数和布尔检查的序列。",
            "answer": "[0.1654157922262961,0.08321524317133749,0.04172428581639345,0.02088523315663738,0.13847775990264562,0.06943015405021285,0.9913109395232938,0.9956426917631383,0.9978184518384218,0.9932148283526978,True,True,True,True]"
        }
    ]
}