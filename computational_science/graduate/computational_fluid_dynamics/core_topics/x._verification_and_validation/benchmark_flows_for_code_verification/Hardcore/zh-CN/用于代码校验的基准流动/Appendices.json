{
    "hands_on_practices": [
        {
            "introduction": "验证计算流体动力学 (CFD) 代码最基本的任务之一是确认其数值解的收敛阶。本练习通过一个经典的泊肃叶流动问题，带你建立一套系统性的验证流程。通过将数值计算得到的压力梯度与精确的解析解进行比较，你将学会如何通过网格加密研究来量化离散误差，并计算观测到的精度阶 。这项实践是代码验证的基石，为你评估和信任数值模拟结果提供了基本工具。",
            "id": "3295560",
            "problem": "您的任务是，在计算流体动力学（CFD）的背景下，为充分发展的层流槽道流形式化并实现一个验证指标，然后使用该指标从一系列网格加密过程中的压力残差推断数值精度阶。该流动是不可压缩、定常、牛顿流体的平面泊肃叶流，发生在两个无限大的平行板之间，两板之间的总高度为$2h$，其中$h$为半高。此问题的基本依据是不可压缩纳维-斯托克斯方程中所体现的质量和动量守恒、壁面处的无滑移边界条件，以及充分发展流的定义。您的任务如下：\n\n$1.$ 从第一性原理出发，始于不可压缩纳维-斯托克斯方程和充分发展的假设，推导单位长度恒定压降$dp/dx$与平均轴向速度$U_{\\text{mean}}$之间的精确关系，给定动力粘度$\\mu$和槽道半高$h$。您必须以$\\text{Pa}/\\text{m}$为单位表示$dp/dx$。\n\n$2.$ 定义一个基于线性压降的无量纲验证指标：构建\n$$\nR_h \\equiv \\frac{\\left| \\left(\\frac{dp}{dx}\\right)_{\\text{num},h} - \\left(\\frac{dp}{dx}\\right)_{\\text{exact}} \\right|}{\\left|\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}\\right|},\n$$\n其中$\\left(\\frac{dp}{dx}\\right)_{\\text{num},h}$是从间距为$\\Delta x_h$的网格上的离散压力场获得的压力梯度的数值估计值，而$\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}$是您在任务$1$中推导出的精确解析压力梯度。\n\n$3.$ 通过在渐近区域拟合模型$R_h \\sim C \\, (\\Delta x_h)^p$来演示如何从$R_h$随网格间距的标度关系中推断观测精度阶，其中$p$是精度阶，$C$是一个常数。使用对数空间中的最小二乘拟合，从一系列网格加密中估计$p$。\n\n为了使任务自洽且可测试，请考虑通过在精确线性压力分布上叠加一个依赖于网格的线性偏差来构造合成的数值压力场$p_{\\text{num}}(x)$，\n$$\np_{\\text{num}}(x) = p_0 + \\left[\\left(\\frac{dp}{dx}\\right)_{\\text{exact}} + \\alpha \\, (\\Delta x_h)^{p^\\star} \\left|\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}\\right| \\right] x,\n$$\n其中$p_0$是入口压力，$\\alpha$是一个无量纲振幅参数，$\\Delta x_h$是给定网格的网格间距，而$p^\\star$是仅用于合成数值数据以使$R_h = \\alpha \\, (\\Delta x_h)^{p^\\star}$精确成立的施加（真实）阶数。为了从$p_{\\text{num}}(x)$对$x$的关系中估计数值压力梯度$\\left(\\frac{dp}{dx}\\right)_{\\text{num},h}$，请在每个网格上使用最小二乘线性拟合。\n\n对于下述套件中的每个测试用例，您必须实现一个程序来执行以下操作：\n$1.$ 根据$\\mu$、$h$和$U_{\\text{mean}}$计算$\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}$。\n$2.$ 对于加密集中的每个网格，在槽道长度$L$上使用上述合成模型在$N$个等距点（包括两个端点）上生成$p_{\\text{num}}(x)$，通过最小二乘法估计$\\left(\\frac{dp}{dx}\\right)_{\\text{num},h}$，并计算$R_h$。\n$3.$ 从序列$\\{(\\Delta x_h, R_h)\\}$中，通过对$\\log R_h$与$\\log \\Delta x_h$进行最小二乘回归来推断观测阶$p$。\n$4.$ 将每个测试用例推断出的阶数$p$作为浮点数返回，四舍五入到$6$位小数。\n\n使用以下测试套件。所有物理输入参数必须按所述单位解释：动力粘度单位为$\\text{Pa}\\cdot\\text{s}$，长度单位为$\\text{m}$，速度单位为$\\text{m}/\\text{s}$，压力单位为$\\text{Pa}$，压力梯度单位为$\\text{Pa}/\\text{m}$。此问题中不使用角度单位。\n\n测试用例 $1$ (顺利通过路径):\n- $\\mu = 1.0$,\n- $h = 0.05$,\n- $U_{\\text{mean}} = 0.5$,\n- $L = 2.0$,\n- $p_0 = 101325.0$,\n- $\\alpha = 0.5$,\n- $p^\\star = 2.0$,\n- 网格尺寸 $N \\in \\{50, 100, 200\\}$。\n\n测试用例 $2$ (近一阶行为):\n- $\\mu = 0.8$,\n- $h = 0.02$,\n- $U_{\\text{mean}} = 0.2$,\n- $L = 1.0$,\n- $p_0 = 101325.0$,\n- $\\alpha = 0.3$,\n- $p^\\star = 1.0$,\n- 网格尺寸 $N \\in \\{40, 80, 160\\}$。\n\n测试用例 $3$ (振幅较小的三阶行为):\n- $\\mu = 1.5$,\n- $h = 0.1$,\n- $U_{\\text{mean}} = 1.0$,\n- $L = 3.0$,\n- $p_0 = 101325.0$,\n- $\\alpha = 0.1$,\n- $p^\\star = 3.0$,\n- 网格尺寸 $N \\in \\{30, 60, 120\\}$。\n\n测试用例 $4$ (较粗网格边界情况):\n- $\\mu = 0.6$,\n- $h = 0.05$,\n- $U_{\\text{mean}} = 0.1$,\n- $L = 2.0$,\n- $p_0 = 101325.0$,\n- $\\alpha = 0.7$,\n- $p^\\star = 2.0$,\n- 网格尺寸 $N \\in \\{10, 20, 40\\}$。\n\n您的程序应生成单行输出，其中包含推断出的阶数，形式为逗号分隔的列表，括在方括号中，并四舍五入到六位小数（例如，\"[$2.000000$, $1.000000$, $3.000000$, $2.000000$]\"，但不含美元符号；实际输出必须是数值字符串，不含LaTeX）。\n\n最终输出必须是浮点数。不应打印其他任何文本。",
            "solution": "问题陈述已经过验证，并被认为是有效的。它在科学上基于流体力学原理（纳维-斯托克斯方程，泊肃叶流），在数值上其验证方法（精度阶，网格加密）是合理的，并且形式上是良定的，提供了所有必要的数据和定义。因此，我们可以着手提供完整的解决方案。\n\n根据要求，解决方案分为三个主要部分：解析压力梯度的推导、验证指标的定义以及推断数值精度阶的方法。\n\n### 1. 平面泊肃叶流精确压力梯度的推导\n\n我们从笛卡尔坐标系中牛顿流体的定常、不可压缩纳维-斯托克斯方程开始。设流动方向为$x$方向，发生在位于$y = \\pm h$的两个平行板之间。速度矢量为$\\mathbf{u} = (u, v, w)$。\n\n控制方程为：\n质量守恒（连续性方程）：\n$$ \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0 $$\n动量守恒（纳维-斯托克斯方程）：\n$$ \\rho \\left( \\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u} \\cdot \\nabla \\mathbf{u} \\right) = -\\nabla p + \\mu \\nabla^2 \\mathbf{u} $$\n\n我们应用以下平面泊肃叶流的假设：\n1.  **定常流**：所有时间导数均为零，$\\frac{\\partial}{\\partial t}(\\cdot) = 0$。\n2.  **平面流**：流动是二维的，因此在$z$方向没有速度分量（$w=0$），并且所有量在$z$方向没有变化，$\\frac{\\partial}{\\partial z}(\\cdot) = 0$。\n3.  **充分发展流**：速度剖面在流向（$x$）方向不发生变化。这意味着$\\frac{\\partial u}{\\partial x} = 0$。\n\n应用这些假设，连续性方程简化为$\\frac{\\partial v}{\\partial y} = 0$。考虑到壁面处的无滑移/无穿透边界条件（在$y=\\pm h$处$v=0$），这意味着壁面法向速度分量$v$在各处都为零。\n\n$x$和$y$方向的动量方程变为：\n$x$-动量方程：\n$$ \\rho \\left( u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y} \\right) = -\\frac{\\partial p}{\\partial x} + \\mu \\left( \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} \\right) $$\n$y$-动量方程：\n$$ \\rho \\left( u \\frac{\\partial v}{\\partial x} + v \\frac{\\partial v}{\\partial y} \\right) = -\\frac{\\partial p}{\\partial y} + \\mu \\left( \\frac{\\partial^2 v}{\\partial x^2} + \\frac{\\partial^2 v}{\\partial y^2} \\right) $$\n\n代入我们假设的推论（$v=0$, $\\frac{\\partial u}{\\partial x}=0$）：\n$x$-动量方程：\n$$ 0 = -\\frac{\\partial p}{\\partial x} + \\mu \\frac{d^2 u}{dy^2} $$\n$y$-动量方程：\n$$ 0 = -\\frac{\\partial p}{\\partial y} $$\n\n从$y$-动量方程可以看出，压力$p$不随$y$变化，因此$p = p(x)$。于是，偏导数$\\frac{\\partial p}{\\partial x}$可以写成全导数$\\frac{dp}{dx}$。$x$-动量方程可以重新排列为：\n$$ \\frac{d^2 u}{dy^2} = \\frac{1}{\\mu} \\frac{dp}{dx} $$\n等式左边仅是$y$的函数，而右边仅是$x$的函数。为使此等式成立，两边都必须等于一个常数。这证实了压力梯度$\\frac{dp}{dx}$沿槽道是恒定的。\n\n我们对该方程关于$y$积分两次：\n$$ \\frac{du}{dy} = \\frac{1}{\\mu} \\frac{dp}{dx} y + C_1 $$\n$$ u(y) = \\frac{1}{2\\mu} \\frac{dp}{dx} y^2 + C_1 y + C_2 $$\n积分常数$C_1$和$C_2$由边界条件确定。我们在壁面$y=\\pm h$处施加无滑移条件，$u=0$：\n1. 在$y=h$处: $0 = \\frac{1}{2\\mu} \\frac{dp}{dx} h^2 + C_1 h + C_2$\n2. 在$y=-h$处: $0 = \\frac{1}{2\\mu} \\frac{dp}{dx} h^2 - C_1 h + C_2$\n\n用第一个方程减去第二个方程得到$2 C_1 h = 0$，这意味着$C_1=0$。将$C_1=0$代入第一个方程得到$C_2 = -\\frac{h^2}{2\\mu} \\frac{dp}{dx}$。因此，速度剖面是著名的抛物线剖面：\n$$ u(y) = \\frac{1}{2\\mu} \\frac{dp}{dx} (y^2 - h^2) $$\n对于正的平均流速$U_{\\text{mean}} > 0$，压力必须沿$x$方向减小，因此$\\frac{dp}{dx}$必须为负。\n\n平均轴向速度$U_{\\text{mean}}$定义为单位面积的体积流量，在槽道横截面从$y=-h$到$y=h$上平均：\n$$ U_{\\text{mean}} = \\frac{1}{2h} \\int_{-h}^{h} u(y) \\, dy = \\frac{1}{2h} \\int_{-h}^{h} \\frac{1}{2\\mu} \\frac{dp}{dx} (y^2 - h^2) \\, dy $$\n$$ U_{\\text{mean}} = \\frac{1}{4h\\mu} \\frac{dp}{dx} \\left[ \\frac{y^3}{3} - h^2 y \\right]_{-h}^{h} $$\n$$ U_{\\text{mean}} = \\frac{1}{4h\\mu} \\frac{dp}{dx} \\left( \\left(\\frac{h^3}{3} - h^3\\right) - \\left(\\frac{-h^3}{3} - h^2(-h)\\right) \\right) $$\n$$ U_{\\text{mean}} = \\frac{1}{4h\\mu} \\frac{dp}{dx} \\left( -\\frac{2h^3}{3} - \\frac{2h^3}{3} \\right) = \\frac{1}{4h\\mu} \\frac{dp}{dx} \\left( -\\frac{4h^3}{3} \\right) $$\n$$ U_{\\text{mean}} = -\\frac{h^2}{3\\mu} \\frac{dp}{dx} $$\n\n最后，我们重新整理此表达式，解出精确的压力梯度，这是任务$1$要求的结果：\n$$ \\left(\\frac{dp}{dx}\\right)_{\\text{exact}} = -\\frac{3 \\mu U_{\\text{mean}}}{h^2} $$\n\n### 2. 线性压降的验证指标\n\n问题定义了一个无量纲验证指标$R_h$，用以量化数值计算的压力梯度的相对误差：\n$$ R_h \\equiv \\frac{\\left| \\left(\\frac{dp}{dx}\\right)_{\\text{num},h} - \\left(\\frac{dp}{dx}\\right)_{\\text{exact}} \\right|}{\\left|\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}\\right|} $$\n这里，$\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}$是上面推导出的解析值。项$\\left(\\frac{dp}{dx}\\right)_{\\text{num},h}$表示从特征间距为$\\Delta x_h$的网格上的数值模拟数据估计出的压力梯度。在此问题中，它是通过对沿槽道的离散压力数据$p_{\\text{num}}(x)$进行最小二乘线性拟合获得的。该指标在验证与确认中是基础性的，因为它为压力梯度的离散误差提供了一个定量的度量。\n\n### 3. 观测精度阶的推断\n\n对于一个$p$阶精度的数值方法，其离散误差$E$预期在渐近区域（即，对于足够小的$\\Delta x$）会根据关系式$E \\approx C (\\Delta x)^p$随网格间距$\\Delta x$变化，其中$C$是一个常数。在我们的情境中，误差指标$R_h$作为我们的误差度量$E$，网格间距为$\\Delta x_h$。因此，我们将误差的行为建模为：\n$$ R_h = C (\\Delta x_h)^p $$\n为了从一系列在相继加密的网格上进行的数值实验中确定观测精度阶$p$，我们可以通过对两边取自然对数来线性化这个幂律关系：\n$$ \\ln(R_h) = \\ln(C) + p \\ln(\\Delta x_h) $$\n该方程具有直线形式$Y = b + mX$，其中$Y = \\ln(R_h)$，$X = \\ln(\\Delta x_h)$，斜率是精度阶$m=p$，截距是$b = \\ln(C)$。\n\n给定一个产生$(\\Delta x_i, R_i)$对的网格加密序列，我们可以计算出相应的$(\\ln(\\Delta x_i), \\ln(R_i))$对。然后对这些对数转换后的数据执行线性最小二乘回归，以找到最佳拟合斜率，这就是我们对观测精度阶$p$的估计。\n\n实现将为每个测试用例执行以下步骤：\n1.  使用推导出的公式计算$\\left(\\frac{dp}{dx}\\right)_{\\text{exact}}$。\n2.  对于一系列网格尺寸$N_i$，计算网格间距$\\Delta x_i = L / (N_i - 1)$。\n3.  为每个网格生成合成的数值压力数据$p_{\\text{num}}(x)$。\n4.  通过对$(x, p_{\\text{num}})$数据应用线性最小二乘拟合来估计$\\left(\\frac{dp}{dx}\\right)_{\\text{num},h}$。\n5.  计算相应的误差指标$R_i$。\n6.  对$(\\ln(\\Delta x_i), \\ln(R_i))$数据点执行线性最小二乘拟合，以找到斜率$p$。\n\n所提供的合成数据模型确保$R_h = \\alpha (\\Delta x_h)^{p^\\star}$精确成立。因此，对对数转换数据的最小二乘拟合预期将恢复$p = p^\\star$至机器精度。这使得该问题成为一个用于验证精度阶计算实现本身的良定程序。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of inferring the order of accuracy for a synthetic\n    CFD verification test case based on plane Poiseuille flow.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"mu\": 1.0, \"h\": 0.05, \"U_mean\": 0.5, \"L\": 2.0, \"p0\": 101325.0,\n            \"alpha\": 0.5, \"p_star\": 2.0, \"N_list\": [50, 100, 200]\n        },\n        {\n            \"mu\": 0.8, \"h\": 0.02, \"U_mean\": 0.2, \"L\": 1.0, \"p0\": 101325.0,\n            \"alpha\": 0.3, \"p_star\": 1.0, \"N_list\": [40, 80, 160]\n        },\n        {\n            \"mu\": 1.5, \"h\": 0.1, \"U_mean\": 1.0, \"L\": 3.0, \"p0\": 101325.0,\n            \"alpha\": 0.1, \"p_star\": 3.0, \"N_list\": [30, 60, 120]\n        },\n        {\n            \"mu\": 0.6, \"h\": 0.05, \"U_mean\": 0.1, \"L\": 2.0, \"p0\": 101325.0,\n            \"alpha\": 0.7, \"p_star\": 2.0, \"N_list\": [10, 20, 40]\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current test case\n        mu = case[\"mu\"]\n        h = case[\"h\"]\n        U_mean = case[\"U_mean\"]\n        L = case[\"L\"]\n        p0 = case[\"p0\"]\n        alpha = case[\"alpha\"]\n        p_star = case[\"p_star\"]\n        N_list = case[\"N_list\"]\n\n        # 1. Compute the exact pressure gradient\n        dpdx_exact = -3.0 * mu * U_mean / (h**2)\n\n        log_delta_x_vals = []\n        log_R_h_vals = []\n\n        # 2. Loop through grid refinements\n        for N in N_list:\n            # Grid spacing\n            delta_x = L / (N - 1)\n            \n            # Generate synthetic pressure data\n            # The slope for the synthetic data is constructed with a manufactured error term\n            dpdx_synth = dpdx_exact + alpha * (delta_x**p_star) * abs(dpdx_exact)\n            x_coords = np.linspace(0, L, N)\n            p_num = p0 + dpdx_synth * x_coords\n            \n            # Estimate the numerical pressure gradient by least-squares linear fit\n            # For perfectly linear data, polyfit recovers the slope exactly.\n            dpdx_num_h, _ = np.polyfit(x_coords, p_num, 1)\n\n            # Compute the verification metric R_h\n            if abs(dpdx_exact) == 0:\n                # Avoid division by zero, although not expected in these test cases\n                # If dpdx_exact is 0, U_mean must be 0, and the error is absolute\n                R_h = abs(dpdx_num_h - dpdx_exact)\n            else:\n                R_h = abs(dpdx_num_h - dpdx_exact) / abs(dpdx_exact)\n            \n            # Collect data for log-log regression\n            log_delta_x_vals.append(np.log(delta_x))\n            log_R_h_vals.append(np.log(R_h))\n\n        # 3. Infer the observed order of accuracy p\n        # Fit a line (polynomial of degree 1) to the log-log data.\n        # The slope of this line is the order of accuracy.\n        p, _ = np.polyfit(log_delta_x_vals, log_R_h_vals, 1)\n        \n        results.append(p)\n\n    # 4. Format and print the final output\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了稳态流动的验证方法后，我们将注意力转向更复杂的非稳态问题。泰勒-格林涡 (Taylor-Green vortex) 是一个经典的非稳态流动基准算例，在低雷诺数极限下，其速度场的衰减规律存在精确的解析解。本练习要求你推导该解析解，并将其与数值模拟结果进行对比，从而不仅可以验证空间离散格式的准确性，还能检验时间积分方案的精度 。通过分析动能的衰减率，你将深入理解如何评估代码处理瞬态物理过程的能力。",
            "id": "3295591",
            "problem": "考虑一个边长为 $L$ 的周期性方形区域中的二维、不可压缩、粘性流体，其运动粘度为 $\\nu > 0$。在时间 $t=0$ 时，速度场初始化为泰勒-格林涡 (Taylor–Green vortex)，\n$$\nu(x,y,0) = U_{0}\\,\\sin(k x)\\cos(k y), \\quad v(x,y,0) = -\\,U_{0}\\,\\cos(k x)\\sin(k y),\n$$\n其中 $k = 2\\pi/L$ 且 $U_{0} > 0$。假设基于速度尺度 $U_{0}$ 和长度尺度 $1/k$ 的雷诺数 ($Re$) 满足 $Re \\ll 1$，因此在所关心的时间尺度上，惯性效应与粘性扩散相比可以忽略不计。从不可压缩纳维-斯托克斯方程 (Navier–Stokes equations) 和无散度约束作为唯一允许的基础出发，并施加周期性边界条件，推导由下式定义的速度幅值的粘性衰减率 $\\sigma$ 的闭式表达式：\n$$\nU(t) = U_{0}\\,\\exp(-\\sigma\\, t),\n$$\n在上述低雷诺数假设下。您的推导必须证明对压力场作出的任何假设，并且必须展示为获得幅值演化所需的空间和时间变量分离过程。\n\n此外，请解释在验证计算流体动力学代码时，此基准问题中的哪些误差范数最适合主要揭示空间不准确性，哪些最适合主要揭示时间不准确性，并从这些范数如何加权误差的第一性原理出发，证明您的选择。\n\n请将衰减率 $\\sigma$ 报告为仅含 $\\nu$ 和 $k$ 的单个闭式表达式。衰减率的单位为秒的倒数；不需要进行四舍五入或数值近似。在最终的方框答案中不要包含单位。",
            "solution": "此问题经评估有效。这是一个来自计算流体动力学领域的适定（well-posed）、有科学依据的问题，具体涉及使用已知的解析解来验证数值方法。其设定是自洽且一致的，所有术语都得到了明确定义。\n\n推导始于具有恒定密度 $\\rho$ 和运动粘度 $\\nu$ 的流体的二维不可压缩纳维-斯托克斯方程。速度场为 $\\mathbf{u} = (u,v)$，压力为 $p$。\n动量方程为：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\nu \\nabla^2 \\mathbf{u}\n$$\n不可压缩性约束为：\n$$\n\\nabla \\cdot \\mathbf{u} = 0\n$$\n问题陈述，雷诺数 $Re = \\frac{U_0 L_{char}}{\\nu}$ 非常小，其中特征长度尺度为 $L_{char} = 1/k$。条件 $Re = \\frac{U_0}{k \\nu} \\ll 1$ 意味着惯性项 $(\\mathbf{u} \\cdot \\nabla)\\mathbf{u}$ 与粘性项 $\\nu \\nabla^2 \\mathbf{u}$ 相比可以忽略不计。这是因为它们的量级之比与 $Re$ 成比例。应用这种低雷诺数近似，将动量方程简化为非定常斯托克斯方程 (unsteady Stokes equation)：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\frac{1}{\\rho}\\nabla p + \\nu \\nabla^2 \\mathbf{u}\n$$\n为了证明关于压力场的假设，我们对简化的动量方程取散度：\n$$\n\\nabla \\cdot \\left(\\frac{\\partial \\mathbf{u}}{\\partial t}\\right) = \\nabla \\cdot \\left(-\\frac{1}{\\rho}\\nabla p\\right) + \\nabla \\cdot (\\nu \\nabla^2 \\mathbf{u})\n$$\n假设有足够的光滑性，我们可以交换空间和时间导数：\n$$\n\\frac{\\partial}{\\partial t}(\\nabla \\cdot \\mathbf{u}) = -\\frac{1}{\\rho}\\nabla^2 p + \\nu \\nabla^2(\\nabla \\cdot \\mathbf{u})\n$$\n使用不可压缩性约束 $\\nabla \\cdot \\mathbf{u} = 0$，该方程简化为关于压力的拉普拉斯方程 (Laplace equation)：\n$$\n\\nabla^2 p = 0\n$$\n问题指定了一个周期性方形区域。对于在全周期性区域上满足拉普拉斯方程的函数，唯一可能的解是常数，即 $p(x,y,t) = C(t)$。一个空间上恒定的压力其梯度为零，$\\nabla p = \\mathbf{0}$。因此，动量方程中的压力梯度项消失了。\n\n速度分量 $u$ 和 $v$ 的控制方程变成了非耦合的热传导方程 (heat equations)：\n$$\n\\frac{\\partial u}{\\partial t} = \\nu \\nabla^2 u, \\quad \\frac{\\partial v}{\\partial t} = \\nu \\nabla^2 v\n$$\n问题寻求一个速度幅值呈指数衰减的解。这提示我们采用变量分离法，其中初始条件的空间结构由一个随时间变化的幅值进行调制。我们提出以下形式的解：\n$$\nu(x,y,t) = A(t) \\sin(kx)\\cos(ky)\n$$\n$$\nv(x,y,t) = -A(t) \\cos(kx)\\sin(ky)\n$$\n其中 $A(t)$ 是随时间变化的幅值。$t=0$ 时的初始条件是 $u(x,y,0) = U_0 \\sin(kx)\\cos(ky)$ 和 $v(x,y,0) = -U_0 \\cos(kx)\\sin(ky)$，这要求 $A(0) = U_0$。这个提出的解的形式在任何时候都保持无散度，因为 $\\frac{\\partial u}{\\partial x} = A(t)k\\cos(kx)\\cos(ky)$ 和 $\\frac{\\partial v}{\\partial y} = -A(t)\\cos(kx)(k\\cos(ky))$，所以 $\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = 0$。\n\n现在，我们将 $u(x,y,t)$ 的拟设形式代入热传导方程 $\\frac{\\partial u}{\\partial t} = \\nu \\nabla^2 u$。\n左边是：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{dA}{dt} \\sin(kx)\\cos(ky)\n$$\n右边需要计算空间部分的拉普拉斯算子：\n$$\n\\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2}\n$$\n$$\n\\frac{\\partial u}{\\partial x} = A(t) k \\cos(kx)\\cos(ky) \\implies \\frac{\\partial^2 u}{\\partial x^2} = -A(t) k^2 \\sin(kx)\\cos(ky)\n$$\n$$\n\\frac{\\partial u}{\\partial y} = -A(t) k \\sin(kx)\\sin(ky) \\implies \\frac{\\partial^2 u}{\\partial y^2} = -A(t) k^2 \\sin(kx)\\cos(ky)\n$$\n将它们相加得到拉普拉斯算子：\n$$\n\\nabla^2 u = (-A(t) k^2 - A(t) k^2) \\sin(kx)\\cos(ky) = -2k^2 A(t) \\sin(kx)\\cos(ky) = -2k^2 u\n$$\n将这些表达式代回关于 $u$ 的热传导方程：\n$$\n\\frac{dA}{dt} \\sin(kx)\\cos(ky) = \\nu \\left(-2k^2 A(t) \\sin(kx)\\cos(ky)\\right)\n$$\n因为 $\\sin(kx)\\cos(ky)$ 不恒为零，我们可以将其约去，得到一个关于幅值 $A(t)$ 的常微分方程：\n$$\n\\frac{dA}{dt} = -2\\nu k^2 A(t)\n$$\n这是一个一阶线性常微分方程，其解为 $A(t) = C \\exp(-2\\nu k^2 t)$。利用初始条件 $A(0) = U_0$，我们得到常数 $C=U_0$。因此，幅值的演化为：\n$$\nA(t) = U_0 \\exp(-2\\nu k^2 t)\n$$\n问题将速度幅值演化定义为 $U(t) = U_0 \\exp(-\\sigma t)$。将此与我们推导出的 $A(t)$ 的表达式进行比较，我们可以确定衰减率 $\\sigma$：\n$$\n\\sigma = 2\\nu k^2\n$$\n对 $v$ 分量进行类似的推导会得到关于 $A(t)$ 的相同常微分方程，从而证实了解的一致性。\n\n关于问题的第二部分，即用于代码验证的误差范数：\n设精确解为 $\\mathbf{u}_{ex}$，数值解为 $\\mathbf{u}_h$。误差为 $\\mathbf{e} = \\mathbf{u}_h - \\mathbf{u}_{ex}$。\n\n为了主要揭示空间不准确性，应该使用一个强调在某个固定时间点（通常是最终时间 $T$）误差的空间分布的误差范数。$L_\\infty$ 范数特别适合此目的：\n$$\n||\\mathbf{e}(T)||_{L_\\infty} = \\sup_{(x,y) \\in \\Omega} |\\mathbf{e}(x,y,T)|\n$$\n在这里，$\\Omega$ 是方形区域。$L_\\infty$ 范数测量区域内的最大点误差。它对局部误差高度敏感，例如数值振荡（吉布斯现象 (Gibbs phenomena)）或波状特征的错误相速度和群速度，这些都是空间分辨率不足或低阶空间离散格式的标志。涡的空间结构中的一个误差，即使是局部的，也会被这个范数直接捕捉到，而像 $L_2$ 这样的积分范数可能会将其平均掉。\n\n为了主要揭示时间不准确性，应该测量一个对时间步进算法的累积效应敏感的全局、时间积分量的误差。流场的总动能 $E(t)$ 是一个极好的候选者。\n$$\nE(t) = \\frac{1}{2}\\int_{\\Omega} |\\mathbf{u}(x,y,t)|^2 \\,d\\Omega\n$$\n对于精确解，能量呈指数衰减：$E_{ex}(t) = E_0 \\exp(-2\\sigma t) = E_0 \\exp(-4\\nu k^2 t)$。数值模拟产生一个离散的能量历史 $E_h(t)$。最终时刻总能量的误差 $|E_h(T) - E_{ex}(T)|$ 是时间准确性的一个有力指标。这是因为能量耗散率由时间积分格式必须保持的全局平衡所控制。时间步进器中的数值耗散（或耗散不足）将导致 $E_h(t)$ 以错误的速率衰减。由于动能是一个积分量，它平均掉了误差场的精细空间细节，从而分离出长期时间积分对整个系统动力学的影响。",
            "answer": "$$\\boxed{2\\nu k^{2}}$$"
        },
        {
            "introduction": "对于不可压缩流求解器而言，确保速度场满足无散度条件（即质量守恒）是其核心挑战之一。本练习聚焦于验证一种关键算法——投影法——在交错网格上强制执行无散度约束的能力。你将使用一个精确无散的解析速度场作为初始条件，通过投影算法对其进行修正，并测量修正后速度场的离散散度 。这项实践揭示了不可压缩流求解器维持无散场的内部机制，并演示了如何验证一个算法模块是否能达到机器精度的要求。",
            "id": "3295581",
            "problem": "设计并实现一个独立的程序，在二维均匀 Marker-and-Cell (MAC) 网格上，通过测量散度的离散 $L_{2}$ 范数并研究其在网格加密下的衰减情况，来验证交错网格投影法能够产生一个数值上无散度的速度场。从不可压缩性约束和控制体上的有限体积平衡出发，并使用一致的二阶中心差分。将测试限制在一个周期性方形域内，以分离离散算子的影响。\n\n使用的基本原理如下：\n- 不可压缩流体的不可压缩性约束 $ \\nabla \\cdot \\mathbf{u} = 0 $。\n- 投影法思想：给定一个中间的面心速度 $ \\mathbf{u}^{\\star} $，获得一个校正后的速度 $ \\mathbf{u} = \\mathbf{u}^{\\star} - \\nabla p $，使得 $ \\nabla \\cdot \\mathbf{u} = 0 $ 在离散意义上成立，其中 $ p $ 求解一个由离散散度算子和梯度算子导出的泊松方程。\n- 在均匀网格上的一致二阶中心差分离散化。\n\n使用以下通用的、数学上指定的设置：\n\n- 域和单位：\n  - 计算域为 $ \\Omega = [0, 2\\pi) \\times [0, 2\\pi) $，在两个方向上均采用周期性边界条件。\n  - 所有三角函数参数均以弧度为单位。\n- 交错 (MAC) 网格布局：\n  - 压力 $ p_{i,j} $ 存储在单元中心 $ (x_{c,i}, y_{c,j}) = \\big((i+\\tfrac{1}{2})\\Delta x, (j+\\tfrac{1}{2})\\Delta y\\big) $，其中 $ i = 0,\\dots,N_{x}-1 $，$ j = 0,\\dots,N_{y}-1 $，且 $ \\Delta x = \\frac{2\\pi}{N_{x}} $，$ \\Delta y = \\frac{2\\pi}{N_{y}} $。\n  - $ x $ 方向速度分量 $ u_{i,j} $ 存储在 $ x $ 面上 $ (x_{u,i}, y_{u,j}) = (i\\Delta x, (j+\\tfrac{1}{2})\\Delta y) $。\n  - $ y $ 方向速度分量 $ v_{i,j} $ 存储在 $ y $ 面上 $ (x_{v,i}, y_{v,j}) = \\big((i+\\tfrac{1}{2})\\Delta x, j\\Delta y\\big) $。\n- 构造的光滑无散度场：\n  - 定义解析速度场 $ \\mathbf{u}_{\\text{exact}}(x,y) = \\big(u_{\\text{exact}}(x,y), v_{\\text{exact}}(x,y)\\big) $ 为\n    $$\n    u_{\\text{exact}}(x,y) = -\\cos(x)\\sin(y), \\quad v_{\\text{exact}}(x,y) = \\sin(x)\\cos(y),\n    $$\n    它对所有 $ (x,y) $ 满足 $ \\nabla \\cdot \\mathbf{u}_{\\text{exact}} = 0 $。\n  - 在 MAC 网格的面上对 $ \\mathbf{u}_{\\text{exact}} $ 进行采样，以获得 $ \\mathbf{u}^{\\star} $。\n- 离散算子 (具有周期性环绕)：\n  - 单元中心的离散散度为\n    $$\n    (\\nabla_{h} \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i,j}}{\\Delta x} + \\frac{v_{i,j+1} - v_{i,j}}{\\Delta y}.\n    $$\n  - 将单元中心压力映射到面心分量的离散梯度为\n    $$\n    (\\nabla_{h} p)^{x}_{i,j} = \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}, \\quad (\\nabla_{h} p)^{y}_{i,j} = \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}.\n    $$\n  - 复合算子 $ \\nabla_{h}\\cdot \\nabla_{h} p $ 在单元中心产生标准的五点离散拉普拉斯算子。\n- 离散投影：\n  - 在单元中心构建右端项 $ b = \\nabla_{h} \\cdot \\mathbf{u}^{\\star} $。\n  - 求解离散泊松方程\n    $$\n    \\mathcal{L}_{h} p = b,\n    $$\n    其中 $ \\mathcal{L}_{h} $ 是五点周期性拉普拉斯算子，通过减去 $ b $ 在网格上的平均值来强制零均值可解性。将使用两种求解器：\n    1. 一个带权重的雅可比迭代法，具有固定的迭代次数 $ K $ 和松弛参数 $ \\omega \\in (0,1) $。对于五点拉普拉斯算子，对角线元素为 $ a_{ii} = -2/\\Delta x^{2} - 2/\\Delta y^{2} $。一次雅可比扫描计算\n       $$\n       p^{\\text{new}}_{i,j} = (1-\\omega) p^{\\text{old}}_{i,j} + \\omega \\frac{b_{i,j} - \\frac{1}{\\Delta x^{2}}(p^{\\text{old}}_{i+1,j} + p^{\\text{old}}_{i-1,j}) - \\frac{1}{\\Delta y^{2}}(p^{\\text{old}}_{i,j+1} + p^{\\text{old}}_{i,j-1})}{-2/\\Delta x^{2} - 2/\\Delta y^{2}}.\n       $$\n       在每次迭代中保持 $ p $ 的零均值。\n    2. 一种利用周期性的谱方法求解，使用快速傅里叶变换 (FFT)。离散拉普拉斯算子的特征值为\n       $$\n       \\lambda(k,\\ell) = -\\frac{4}{\\Delta x^{2}} \\sin^{2}\\left( \\frac{\\pi k}{N_{x}} \\right) - \\frac{4}{\\Delta y^{2}} \\sin^{2}\\left( \\frac{\\pi \\ell}{N_{y}} \\right),\n       $$\n       对于 $ k=0,\\dots,N_{x}-1 $，$ \\ell=0,\\dots,N_{y}-1 $，其中零模被设定以强制零均值压力。\n  - 通过 $ u \\leftarrow u^{\\star} - (\\nabla_{h} p)^{x} $，$ v \\leftarrow v^{\\star} - (\\nabla_{h} p)^{y} $ 校正速度。\n- 散度的离散 $ L_{2} $ 范数：\n  $$\n  \\| \\nabla_{h} \\cdot \\mathbf{u} \\|_{L_{2,h}} = \\left( \\sum_{i=0}^{N_{x}-1} \\sum_{j=0}^{N_{y}-1} \\big( (\\nabla_{h} \\cdot \\mathbf{u})_{i,j} \\big)^{2} \\, \\Delta x \\, \\Delta y \\right)^{1/2}.\n  $$\n\n实现以下测试套件并计算所要求的输出：\n\n- 案例 A (使用近似投影的理想路径加密研究)：\n  - 使用带权重的雅可比法，其中 $ \\omega = \\frac{2}{3} $，$ K = 10 $ 次迭代。\n  - 网格：$ (N_{x}, N_{y}) \\in \\{(16,16), (32,32), (64,64), (128,128)\\} $。\n  - 对每个网格，执行投影并计算校正后速度散度的离散 $ L_{2} $ 范数。然后计算连续网格之间的观测加密率\n    $$\n    r_{i \\to i+1} = \\log_{2}\\left( \\frac{\\| \\nabla_{h} \\cdot \\mathbf{u} \\|_{L_{2,h}}^{(N_{i})}}{\\| \\nabla_{h} \\cdot \\mathbf{u} \\|_{L_{2,h}}^{(N_{i+1})}} \\right).\n    $$\n- 案例 B (通过 FFT 进行精确投影的一致性检查)：\n  - 在 $ (N_{x}, N_{y}) = (64,64) $ 上使用谱方法 FFT 求解。计算投影后散度的离散 $ L_{2} $ 范数。\n- 案例 C (使用近似投影的边缘情况各向异性)：\n  - 在 $ (N_{x}, N_{y}) = (48,64) $ 上使用带权重的雅可比法，其中 $ \\omega = \\frac{2}{3} $，$ K = 10 $。计算投影后散度的离散 $ L_{2} $ 范数。\n\n您的程序必须输出单行，其中包含一个用方括号括起来的逗号分隔的扁平列表，按顺序包含以下条目：\n- 来自案例 A 在 $ (16,16) $, $ (32,32) $, $ (64,64) $, $ (128,128) $ 上的四个离散 $ L_{2} $ 范数。\n- 三个观测到的加密率 $ r_{16 \\to 32} $, $ r_{32 \\to 64} $, $ r_{64 \\to 128} $。\n- 来自案例 B 在 $ (64,64) $ 上的离散 $ L_{2} $ 范数。\n- 来自案例 C 在 $ (48,64) $ 上的离散 $ L_{2} $ 范数。\n- 一个布尔值，指示案例 A 中的所有三个观测加密率是否都超过 $ 1.8 $。\n\n所有数值必须以普通十进制数输出，并且布尔值必须恰好是 True 或 False。角度必须以弧度为单位。输出中不需要物理单位。最终输出必须看起来像\n- 示例格式 (非实际值)：$ [n_{16}, n_{32}, n_{64}, n_{128}, r_{16\\to 32}, r_{32\\to 64}, r_{64\\to 128}, n_{\\text{FFT64}}, n_{\\text{aniso}}, \\text{boolean}] $。",
            "solution": "该问题是有效的。它提出了一个来自计算流体力学领域的适定且具有科学依据的任务，具体涉及一种数值方法的验证。所提供的参数、方程和测试用例是完整的、一致的且无歧义的。\n\n目标是验证交错网格投影法能够为一个流体速度场 $\\mathbf{u}$ 正确地施加不可压缩性约束 $\\nabla \\cdot \\mathbf{u} = 0$。该验证通过在 Marker-and-Cell (MAC) 网格上离散化一个已知的无散度解析速度场，应用投影法，然后测量所得数值速度场的离散散度来执行。被测试的核心原理是，投影法通过为一个类压标量求解一个离散泊松方程，可以校正一个中间速度场，从而产生一个离散意义上无散度的最终场。\n\n在此，我们详细说明构建所需程序的理论和方法步骤。\n\n首先，我们建立计算网格。域是一个周期性方形 $\\Omega = [0, 2\\pi) \\times [0, 2\\pi)$。我们将此域离散化为 $N_x \\times N_y$ 个单元的均匀网格，网格间距为 $\\Delta x = 2\\pi/N_x$ 和 $\\Delta y = 2\\pi/N_y$。该问题指定了一个交错 MAC 网格。在此网格上，像压力 $p_{i,j}$ 这样的标量位于单元中心 $(x_{c,i}, y_{c,j}) = ((i+\\frac{1}{2})\\Delta x, (j+\\frac{1}{2})\\Delta y)$。然而，矢量分量是交错的，并位于控制体的面上。速度的 $x$ 分量 $u_{i,j}$ 位于垂直面的中心 $(x_{u,i}, y_{u,j}) = (i\\Delta x, (j+\\frac{1}{2})\\Delta y)$，而 $y$ 分量 $v_{i,j}$ 位于水平面的中心 $(x_{v,i}, y_{v,j}) = ((i+\\frac{1}{2})\\Delta x, j\\Delta y)$。这种交错布局是不可压缩流求解器中的一个关键设计选择，因为它自然地防止了在同位网格上可能出现的压力奇偶解耦不稳定性。\n\n验证过程采用“制造解法”(method of manufactured solutions)。我们从一个光滑的解析速度场 $\\mathbf{u}_{\\text{exact}}(x,y)$ 开始，它被设计成精确无散度的。指定的场是：\n$$\nu_{\\text{exact}}(x,y) = -\\cos(x)\\sin(y), \\quad v_{\\text{exact}}(x,y) = \\sin(x)\\cos(y)\n$$\n该场的散度为 $\\nabla \\cdot \\mathbf{u}_{\\text{exact}} = \\frac{\\partial u_{\\text{exact}}}{\\partial x} + \\frac{\\partial v_{\\text{exact}}}{\\partial y} = \\sin(x)\\sin(y) - \\sin(x)\\sin(y) = 0$。在 MAC 网格上相应的面位置对该场进行采样，以产生我们的初始中间速度场，记为 $\\mathbf{u}^{\\star} = (u^{\\star}, v^{\\star})$。由于离散化误差，$\\mathbf{u}^{\\star}$ 的离散散度将不完全为零。\n\n投影法的目标是找到对 $\\mathbf{u}^{\\star}$ 的校正，以产生一个具有零离散散度的新场 $\\mathbf{u}$。该过程基于 Hodge-Helmholtz 分解，该分解指出任何矢量场都可以分解为一个无散度部分和一个标量势的梯度。我们假定最终速度场 $\\mathbf{u}$ 与中间场 $\\mathbf{u}^{\\star}$ 的关系是通过减去一个标量场 $p$ 的梯度得到的：\n$$\n\\mathbf{u} = \\mathbf{u}^{\\star} - \\nabla_{h} p\n$$\n这里，$\\nabla_{h}$ 是离散梯度算子。为了对校正后的场施加不可压缩性约束 $\\nabla_{h} \\cdot \\mathbf{u} = 0$，我们代入 $\\mathbf{u}$ 的表达式：\n$$\n\\nabla_{h} \\cdot (\\mathbf{u}^{\\star} - \\nabla_{h} p) = 0 \\implies \\nabla_{h} \\cdot \\mathbf{u}^{\\star} - \\nabla_{h} \\cdot \\nabla_{h} p = 0\n$$\n这为类压量 $p$ 产生了一个离散泊松方程：\n$$\n\\mathcal{L}_{h} p = b\n$$\n其中 $\\mathcal{L}_{h} \\equiv \\nabla_{h} \\cdot \\nabla_{h}$ 是离散拉普拉斯算子，右端项 (RHS) 是中间场的离散散度，$b \\equiv \\nabla_{h} \\cdot \\mathbf{u}^{\\star}$。离散算子使用二阶中心差分定义，与有限体积公式一致。对于一个单元 $(i,j)$：\n- 离散散度：$(\\nabla_{h} \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i,j}}{\\Delta x} + \\frac{v_{i,j+1} - v_{i,j}}{\\Delta y}$\n- 离散梯度：$(\\nabla_{h} p)^{x}_{i,j} = \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}$，$(\\nabla_{h} p)^{y}_{i,j} = \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}$\n\n结合这些，在单元 $(i,j)$ 处得到标准的拉普拉斯算子五点模板：\n$$\n\\mathcal{L}_{h} p_{i,j} = \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{\\Delta y^2}\n$$\n\n对于周期性域，离散泊松方程有解的条件是右端项在整个域上的和为零。由于周期性边界条件，将离散散度 $b_{i,j}$ 在所有单元上求和会得到一个恒等于零的伸缩级数。然而，在浮点运算中，这个和可能是一个小的非零值。为了确保可解性，我们通过从 $b$ 中减去其自身的平均值来强制执行此条件。那么压力 $p$ 的确定会相差一个任意常数。我们通过要求 $p$ 的均值为零来强制获得唯一解。\n\n指定了两种求解泊松方程的方法：\n\n1.  **带权重的雅可比迭代法**：这是一种迭代的近似求解器。对于固定的迭代次数 $K$，它不能精确求解方程。更新规则将前一次的迭代值 $p^{\\text{old}}$ 与从泊松方程导出的新估计值混合。$p$ 的解中的误差会直接转化为最终速度场 $\\mathbf{u}$ 中的非零散度。\n\n2.  **谱方法 (FFT) 求解器**：这是一种直接的“精确”求解器（达到机器精度），它利用了周期性域的特性。离散傅里叶模式是离散拉普拉斯算子的特征向量。求解过程包括：\n    a. 对右端项进行二维快速傅里叶变换 (FFT)，$\\hat{b} = \\text{FFT}(b)$。\n    b. 将每个傅里叶系数 $\\hat{b}(k,\\ell)$ 除以拉普拉斯算子对应的特征值 $\\lambda(k,\\ell)$，得到 $\\hat{p}(k,\\ell) = \\hat{b}(k,\\ell) / \\lambda(k,\\ell)$。\n    c. 零频率模式 $(k,\\ell)=(0,0)$ 的特征值为 $\\lambda(0,0)=0$。可解性条件确保了 $\\hat{b}(0,0)=0$。我们设置 $\\hat{p}(0,0)=0$ 以强制零均值压力约束。\n    d. 对 $\\hat{p}$ 进行二维逆快速傅里叶变换，以在物理空间中获得解 $p$。\n\n一旦求得 $p$，速度就被校正：$u_{i,j} = u^{\\star}_{i,j} - (\\nabla_h p)^x_{i,j}$ 和 $v_{i,j} = v^{\\star}_{i,j} - (\\nabla_h p)^y_{i,j}$。\n\n最后，为了量化投影的成功程度，我们计算最终速度场 $\\mathbf{u}$ 散度的离散 $L_2$ 范数：\n$$\n\\| \\nabla_{h} \\cdot \\mathbf{u} \\|_{L_{2,h}} = \\left( \\sum_{i,j} |(\\nabla_{h} \\cdot \\mathbf{u})_{i,j}|^2 \\Delta x \\Delta y \\right)^{1/2}\n$$\n对于“精确”的 FFT 求解器，该范数应接近机器精度。对于“近似”的雅可比求解器，它会更大，但应随着网格的加密而减小。加密率 $r$ 量化了这种衰减。问题要求我们对指定的测试用例执行此分析。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.fft import fft2, ifft2\n\ndef run_projection_test(Nx, Ny, solver_type, K=None, omega=None):\n    \"\"\"\n    Performs a single projection method verification test on a MAC grid.\n\n    Args:\n        Nx (int): Number of grid cells in the x-direction.\n        Ny (int): Number of grid cells in the y-direction.\n        solver_type (str): Type of Poisson solver ('jacobi' or 'fft').\n        K (int, optional): Number of Jacobi iterations. Required for 'jacobi'.\n        omega (float, optional): Jacobi relaxation parameter. Required for 'jacobi'.\n\n    Returns:\n        float: The discrete L2 norm of the divergence of the corrected velocity field.\n    \"\"\"\n    # 1. Domain and Grid Setup\n    Lx, Ly = 2 * np.pi, 2 * np.pi\n    dx, dy = Lx / Nx, Ly / Ny\n\n    # Coordinates for pressure (cell centers)\n    xc = (np.arange(Nx) + 0.5) * dx\n    yc = (np.arange(Ny) + 0.5) * dy\n    \n    # Coordinates for u-velocity (x-faces)\n    xu = np.arange(Nx) * dx\n    yu = (np.arange(Ny) + 0.5) * dy\n    xu_grid, yu_grid = np.meshgrid(xu, yu, indexing='ij')\n\n    # Coordinates for v-velocity (y-faces)\n    xv = (np.arange(Nx) + 0.5) * dx\n    yv = np.arange(Ny) * dy\n    xv_grid, yv_grid = np.meshgrid(xv, yv, indexing='ij')\n\n    # 2. Initialize Intermediate Velocity Field u_star\n    # Sample the exact divergence-free field on the MAC grid faces.\n    u_star = -np.cos(xu_grid) * np.sin(yu_grid)\n    v_star = np.sin(xv_grid) * np.cos(yv_grid)\n\n    # Transpose to match numpy's (row, col) convention, which is (y, x)\n    u_star = u_star.T\n    v_star = v_star.T\n\n    # 3. Compute RHS of Poisson Equation\n    # Discrete divergence of u_star. np.roll handles periodic boundaries.\n    # (u_{i+1,j} - u_{i,j}) / dx\n    div_u = (np.roll(u_star, -1, axis=1) - u_star) / dx\n    # (v_{i,j+1} - v_{i,j}) / dy\n    div_v = (np.roll(v_star, -1, axis=0) - v_star) / dy\n    \n    b = div_u + div_v\n\n    # Enforce solvability condition: zero-mean RHS\n    b -= np.mean(b)\n    \n    # 4. Solve the Poisson Equation: L_h * p = b\n    p = np.zeros((Ny, Nx), dtype=float)\n    if solver_type == 'jacobi':\n        if K is None or omega is None:\n            raise ValueError(\"K and omega must be provided for Jacobi solver.\")\n        \n        diag_coeff = -2.0 / (dx*dx) - 2.0 / (dy*dy)\n        \n        for _ in range(K):\n            # Off-diagonal part of the Laplacian applied to p\n            off_diag_lap_p = (\n                (np.roll(p, -1, axis=1) + np.roll(p, 1, axis=1)) / (dx*dx) +\n                (np.roll(p, -1, axis=0) + np.roll(p, 1, axis=0)) / (dy*dy)\n            )\n            # Jacobi update for L_h * p = b\n            p_update = (b - off_diag_lap_p) / diag_coeff\n            \n            # Apply weighted relaxation\n            p = (1.0 - omega) * p + omega * p_update\n            \n            # Enforce zero-mean pressure at each iteration\n            p -= np.mean(p)\n\n    elif solver_type == 'fft':\n        # Create wavenumbers indices\n        k_indices = np.arange(Nx)\n        l_indices = np.arange(Ny)\n        K_grid, L_grid = np.meshgrid(k_indices, l_indices) \n\n        # Compute eigenvalues of the discrete Laplacian in Fourier space\n        lambda_kl = (-4.0 / (dx*dx) * np.sin(np.pi * K_grid / Nx)**2 -\n                     -4.0 / (dy*dy) * np.sin(np.pi * L_grid / Ny)**2)\n        \n        # FFT of the RHS\n        b_hat = fft2(b)\n        \n        # Solve for p_hat = b_hat / lambda_kl\n        # Handle the zero-frequency mode (k=0, l=0) where lambda=0\n        p_hat = np.divide(b_hat, lambda_kl, out=np.zeros_like(b_hat), where=lambda_kl != 0)\n        \n        # Inverse FFT to get p in physical space\n        p = np.real(ifft2(p_hat))\n\n    else:\n        raise ValueError(f\"Unknown solver type: {solver_type}\")\n\n    # 5. Correct the Velocity Field\n    # Discrete gradient of p.\n    # (p_{i,j} - p_{i-1,j}) / dx\n    grad_p_x = (p - np.roll(p, 1, axis=1)) / dx\n    # (p_{i,j} - p_{i,j-1}) / dy\n    grad_p_y = (p - np.roll(p, 1, axis=0)) / dy\n    \n    u = u_star - grad_p_x\n    v = v_star - grad_p_y\n\n    # 6. Compute Divergence of the Final Field and its L2 norm\n    final_div = ((np.roll(u, -1, axis=1) - u) / dx +\n                 (np.roll(v, -1, axis=0) - v) / dy)\n    \n    norm_l2 = np.sqrt(np.sum(final_div**2 * dx * dy))\n    \n    return norm_l2\n\ndef solve():\n    \"\"\"\n    Runs the full test suite and prints the final results.\n    \"\"\"\n    # Case A: Jacobi refinement study\n    case_a_configs = [(16, 16), (32, 32), (64, 64), (128, 128)]\n    case_a_norms = [run_projection_test(Nx=n, Ny=n, solver_type='jacobi', K=10, omega=2/3) for n, _ in case_a_configs]\n\n    # Calculate refinement rates for Case A\n    rates = []\n    for i in range(len(case_a_norms) - 1):\n        # r = log2(error_coarse / error_fine)\n        rate = np.log2(case_a_norms[i] / case_a_norms[i+1])\n        rates.append(rate)\n\n    # Case B: FFT \"exact\" projection\n    norm_b = run_projection_test(Nx=64, Ny=64, solver_type='fft')\n\n    # Case C: Jacobi on anisotropic grid\n    norm_c = run_projection_test(Nx=48, Ny=64, solver_type='jacobi', K=10, omega=2/3)\n\n    # Final check: do all rates exceed 1.8?\n    rates_exceed_threshold = all(r > 1.8 for r in rates)\n\n    # Assemble final results list\n    all_results = case_a_norms + rates + [norm_b, norm_c, rates_exceed_threshold]\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}