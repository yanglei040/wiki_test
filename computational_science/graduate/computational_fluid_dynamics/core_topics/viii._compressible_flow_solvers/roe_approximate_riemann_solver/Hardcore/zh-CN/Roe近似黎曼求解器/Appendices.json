{
    "hands_on_practices": [
        {
            "introduction": "掌握任何数值格式的第一步都是实现其核心逻辑。本练习将指导您从零开始，为一维欧拉方程构建一个完整的 Roe 近似黎曼求解器，内容涵盖计算 Roe 平均态、分解波结构，直至最终组装数值通量。通过解决一系列标准测试用例，您将对该求解器的内部机制获得具体而深入的理解。",
            "id": "3359352",
            "problem": "考虑在计算流体力学 (CFD) 和 Roe 近似黎曼求解器的背景下的一维可压缩欧拉方程。守恒变量为 $U = [\\rho, \\rho u, E]^T$，其中 $\\rho$ 是质量密度（单位 $\\mathrm{kg \\, m^{-3}}$），$u$ 是速度（单位 $\\mathrm{m \\, s^{-1}}$），$E$ 是总能量密度（单位 $\\mathrm{J \\, m^{-3}}$）。压力 $p$（单位 $\\mathrm{Pa}$）通过量热完全气体的热力学封闭关系与守恒变量相关联，其比热比为 $\\gamma$：\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2} \\rho u^2\\right).\n$$\n物理通量矢量为\n$$\nF(U) = \\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu(E + p)\n\\end{bmatrix},\n$$\n其中质量通量单位为 $\\mathrm{kg \\, m^{-2} \\, s^{-1}}$，动量通量单位为 $\\mathrm{kg \\, m^{-1} \\, s^{-2}}$，能量通量单位为 $\\mathrm{W \\, m^{-2}}$。\n\nRoe 近似黎曼求解器在左、右状态之间的一个 Roe 平均状态上构造一个线性化通量雅可比矩阵 $A^{\\sim}$。设左、右原始变量状态分别为 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，且具有相同的 $\\gamma$。左、右总能量定义为\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\tfrac{1}{2} \\rho_L u_L^2, \\quad E_R = \\frac{p_R}{\\gamma - 1} + \\tfrac{1}{2} \\rho_R u_R^2,\n$$\n比焓定义为\n$$\nH_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}.\n$$\nRoe 平均变量通过密度平方根加权获得：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\n$$\nRoe 平均声速为\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}.\n$$\nRoe 线性化雅可比矩阵 $A^{\\sim}$ 的特征值为\n$$\n\\Lambda = \\mathrm{diag}(\\lambda_1, \\lambda_2, \\lambda_3) = \\mathrm{diag}(\\tilde{u} - \\tilde{a}, \\tilde{u}, \\tilde{u} + \\tilde{a}),\n$$\n一维欧拉系统的一组规范右特征向量（$R$ 的列向量）为\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\tfrac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix},\n$$\n因此\n$$\nR = \\begin{bmatrix}\n1  1  1 \\\\\n\\tilde{u} - \\tilde{a}  \\tilde{u}  \\tilde{u} + \\tilde{a} \\\\\n\\tilde{H} - \\tilde{u}\\tilde{a}  \\tfrac{1}{2}\\tilde{u}^2  \\tilde{H} + \\tilde{u}\\tilde{a}\n\\end{bmatrix}.\n$$\n令 $L = R^{-1}$ 为左特征向量矩阵。守恒变量的跳跃量为 $\\Delta U = U_R - U_L$，其中 $U_L = [\\rho_L, \\rho_L u_L, E_L]^T$ 且 $U_R = [\\rho_R, \\rho_R u_R, E_R]^T$。波强度为\n$$\n\\alpha = \\begin{bmatrix} \\alpha_1 \\\\ \\alpha_2 \\\\ \\alpha_3 \\end{bmatrix} = L \\, \\Delta U.\n$$\n然后，Roe 数值通量计算如下\n$$\nF^{\\mathrm{Roe}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} \\sum_{i=1}^{3} |\\lambda_i| \\, \\alpha_i \\, r_i.\n$$\n\n您的任务是实现一个完整、可运行的程序，对每个提供的测试用例执行以下操作：\n- 根据原始输入和 $\\gamma$ 计算 $U_L$、$U_R$、$F(U_L)$、$F(U_R)$。\n- 构建 Roe 平均值 $\\tilde{u}$、$\\tilde{H}$、$\\tilde{a}$。\n- 构造 $R$、$\\Lambda$ 和 $L$。\n- 计算波强度 $\\alpha_i$。\n- 计算数值通量 $F^{\\mathrm{Roe}}$ 并返回其前三个分量（质量、动量、能量通量）。\n\n您的程序必须计算矩阵和波强度，但只输出通量分量。请使用以下包含左/右原始状态和比热比 $\\gamma$ 的测试套件：\n- 测试 1（典型的类激波管对比）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 0.0, 100000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.125, 0.0, 10000.0, 1.4)$。\n- 测试 2（类接触间断情况）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 300.0, 100000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.125, 300.0, 100000.0, 1.4)$。\n- 测试 3（强压缩情况）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 800.0, 150000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.5, 100.0, 80000.0, 1.4)$。\n- 测试 4（具有相反速度的近真空右状态）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 50.0, 200000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.02, -50.0, 5000.0, 1.4)$。\n\n所有通量必须以国际单位制 (SI) 表示。具体而言：\n- 质量通量，单位为 $\\mathrm{kg \\, m^{-2} \\, s^{-1}}$。\n- 动量通量，单位为 $\\mathrm{kg \\, m^{-1} \\, s^{-2}}$。\n- 能量通量，单位为 $\\mathrm{W \\, m^{-2}}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个三元组。每个三元组的形式必须为 $[f_\\mathrm{mass}, f_\\mathrm{mom}, f_\\mathrm{energy}]$，四舍五入到八位小数，且不含空格。例如，输出格式必须为\n$$\n[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3],[x_4,y_4,z_4]]\n$$\n其中 $x_i$、$y_i$、$z_i$ 是十进制浮点数。",
            "solution": "此问题有效。它提出了一个清晰、独立且有科学依据的任务：为一组明确定义的测试用例，实现用于一维欧拉方程的 Roe 近似黎曼求解器。所给出的方程、变量定义和算法步骤在计算流体力学领域都是标准且正确的。现在我将提供推理的解决方案。\n\n解决方案涉及按所述步骤实现 Roe 求解器算法。对于每个测试用例，我们都给定了左、右状态的原始变量 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，以及比热比 $\\gamma$。目标是计算这两个状态之间界面上的 Roe 数值通量 $F^{\\mathrm{Roe}}$。\n\n流程如下：\n\n1.  **计算守恒状态矢量和物理通量**\n    第一步是将给定的原始变量 $(\\rho, u, p)$ 转换为守恒变量矢量 $U = [\\rho, \\rho u, E]^T$。总能量密度 $E$ 由量热完全气体的状态方程给出：\n    $$\n    E = \\frac{p}{\\gamma - 1} + \\frac{1}{2} \\rho u^2\n    $$\n    对左 ($L$) 和右 ($R$) 两种状态都执行此操作，以获得 $U_L$ 和 $U_R$。\n    $$\n    U_L = \\begin{bmatrix} \\rho_L \\\\ \\rho_L u_L \\\\ E_L \\end{bmatrix}, \\quad U_R = \\begin{bmatrix} \\rho_R \\\\ \\rho_R u_R \\\\ E_R \\end{bmatrix}\n    $$\n    随后，使用以下公式计算物理通量矢量 $F(U_L)$ 和 $F(U_R)$：\n    $$\n    F(U) = \\begin{bmatrix}\n    \\rho u \\\\\n    \\rho u^2 + p \\\\\n    u(E + p)\n    \\end{bmatrix}\n    $$\n\n2.  **计算 Roe 平均状态**\n    Roe 方法通过引入一个特殊的平均状态 $(\\tilde{\\rho}, \\tilde{u}, \\tilde{p}, \\tilde{H}, \\tilde{a})$ 来将黎曼问题线性化。关键在于，此平均状态必须满足 Roe 性质 $\\Delta F = \\tilde{A} \\Delta U$，其中 $\\tilde{A}$ 是在 Roe 平均状态下求值的雅可比矩阵。问题陈述中提供的特定平均公式保证了这一点。\n    我们首先计算左、右状态的比焓：\n    $$\n    H_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}\n    $$\n    然后使用密度平方根加权计算 Roe 平均速度 $\\tilde{u}$ 和比焓 $\\tilde{H}$：\n    $$\n    \\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n    $$\n    由此，可以求得 Roe 平均声速 $\\tilde{a}$：\n    $$\n    \\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}\n    $$\n\n3.  **确定 Roe 矩阵的特征结构**\n    Roe 矩阵 $\\tilde{A}$ 拥有一组实特征值和一组完备的线性无关的特征向量。这些特征值对应于线性化系统中特征波的速度：\n    $$\n    \\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a}\n    $$\n    给出了相应的右特征向量 $r_1, r_2, r_3$，它们构成了右特征向量矩阵 $R$ 的列。左特征向量矩阵 $L$ 是 $R$ 的逆矩阵，即 $L=R^{-1}$。\n\n4.  **计算波强度**\n    守恒变量的跳跃量 $\\Delta U = U_R - U_L$ 被投影到右特征向量的基上。这个投影的系数就是波强度 $\\alpha_i$。\n    $$\n    \\Delta U = \\sum_{i=1}^3 \\alpha_i r_i = R \\alpha\n    $$\n    波强度矢量 $\\alpha = [\\alpha_1, \\alpha_2, \\alpha_3]^T$ 可通过求解此线性系统得到，最直接的方法是计算 $\\alpha = R^{-1} \\Delta U = L \\Delta U$。\n\n5.  **计算 Roe 数值通量**\n    Roe 通量由左、右物理通量的平均值，加上一个模拟从界面传播的波的影响的耗散项构成。这个耗散项由波强度、特征值和特征向量构成。\n    $$\n    F^{\\mathrm{Roe}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2} \\sum_{i=1}^{3} |\\lambda_i| \\, \\alpha_i \\, r_i\n    $$\n    项 $|\\lambda_i|$ 确保了格式被正确地迎风化。$\\lambda_i  0$ 的波向右传播，而 $\\lambda_i  0$ 的波向左传播。这个求和项代表了这些波在单元界面处的净效应，提供了必要的数值耗散以确保稳定性并捕捉如激波之类的间断。绝对值 $|...|$ 至关重要，因为它确保了正确的迎风耗散，从而能将陡峭的梯度稳定地平滑到几个网格单元上。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Roe's approximate Riemann solver problem\n    for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        {'L': (1.0, 0.0, 100000.0), 'R': (0.125, 0.0, 10000.0), 'gamma': 1.4},\n        {'L': (1.0, 300.0, 100000.0), 'R': (0.125, 300.0, 100000.0), 'gamma': 1.4},\n        {'L': (1.0, 800.0, 150000.0), 'R': (0.5, 100.0, 80000.0), 'gamma': 1.4},\n        {'L': (1.0, 50.0, 200000.0), 'R': (0.02, -50.0, 5000.0), 'gamma': 1.4}\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_l, u_l, p_l = case['L']\n        rho_r, u_r, p_r = case['R']\n        gamma = case['gamma']\n\n        flux_vector = compute_roe_flux(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma)\n        \n        formatted_flux = (f\"[{flux_vector[0]:.8f},\"\n                          f\"{flux_vector[1]:.8f},\"\n                          f\"{flux_vector[2]:.8f}]\")\n        results.append(formatted_flux)\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_roe_flux(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma):\n    \"\"\"\n    Computes the Roe numerical flux for the 1D Euler equations.\n\n    Args:\n        rho_l, u_l, p_l (float): Density, velocity, and pressure for the left state.\n        rho_r, u_r, p_r (float): Density, velocity, and pressure for the right state.\n        gamma (float): Ratio of specific heats.\n\n    Returns:\n        numpy.ndarray: The Roe flux vector [mass_flux, momentum_flux, energy_flux].\n    \"\"\"\n    \n    gm1 = gamma - 1.0\n\n    # Step 1: Compute Conservative State Vectors and Physical Fluxes\n    # Left State\n    e_l = p_l / gm1 + 0.5 * rho_l * u_l**2\n    u_vec_l = np.array([rho_l, rho_l * u_l, e_l])\n    f_vec_l = np.array([rho_l * u_l, rho_l * u_l**2 + p_l, u_l * (e_l + p_l)])\n\n    # Right State\n    e_r = p_r / gm1 + 0.5 * rho_r * u_r**2\n    u_vec_r = np.array([rho_r, rho_r * u_r, e_r])\n    f_vec_r = np.array([rho_r * u_r, rho_r * u_r**2 + p_r, u_r * (e_r + p_r)])\n\n    # Step 2: Compute Roe-Averaged State\n    sqrt_rho_l = np.sqrt(rho_l)\n    sqrt_rho_r = np.sqrt(rho_r)\n    \n    # Roe-averaged velocity\n    u_roe = (sqrt_rho_l * u_l + sqrt_rho_r * u_r) / (sqrt_rho_l + sqrt_rho_r)\n    \n    # Specific enthalpies\n    h_l = (e_l + p_l) / rho_l\n    h_r = (e_r + p_r) / rho_r\n    \n    # Roe-averaged specific enthalpy\n    h_roe = (sqrt_rho_l * h_l + sqrt_rho_r * h_r) / (sqrt_rho_l + sqrt_rho_r)\n    \n    # Roe-averaged sound speed\n    a_roe_sq = gm1 * (h_roe - 0.5 * u_roe**2)\n    a_roe = np.sqrt(a_roe_sq)\n\n    # Step 3: Determine the Eigenstructure of the Roe Matrix\n    # Eigenvalues\n    lambda_vals = np.array([u_roe - a_roe, u_roe, u_roe + a_roe])\n    \n    # Right eigenvectors\n    r1 = np.array([1.0, u_roe - a_roe, h_roe - u_roe * a_roe])\n    r2 = np.array([1.0, u_roe, 0.5 * u_roe**2])\n    r3 = np.array([1.0, u_roe + a_roe, h_roe + u_roe * a_roe])\n    \n    # Right eigenvector matrix (eigenvectors as columns)\n    R = np.vstack([r1, r2, r3]).T\n\n    # Step 4: Calculate Wave Strengths\n    # Left eigenvector matrix\n    L = np.linalg.inv(R)\n    \n    # Jump in conservative variables\n    delta_u = u_vec_r - u_vec_l\n    \n    # Wave strengths\n    alpha_vals = L @ delta_u\n\n    # Step 5: Compute the Roe Numerical Flux\n    # Dissipation term: sum of |lambda_i| * alpha_i * r_i\n    dissipation = np.zeros(3)\n    abs_lambda = np.abs(lambda_vals)\n    r_vecs = [r1, r2, r3]\n    for i in range(3):\n        dissipation += abs_lambda[i] * alpha_vals[i] * r_vecs[i]\n\n    # Final Roe flux\n    f_roe = 0.5 * (f_vec_l + f_vec_r) - 0.5 * dissipation\n    \n    return f_roe\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "虽然标准的 Roe 求解器具有很高的精度，但其线性化处理在跨音速稀疏波等情况下可能会失效，产生违反熵增原理的膨胀激波。本练习探讨了一种常见的解决方案——熵修正，但同时揭示了一个关键的精微之处：不加区分地应用熵修正会降低解的质量。通过静止接触间断这一经典测试，您将学习到为何熵修正必须有选择性地仅应用于真正的非线性特征场，从而避免将人为的耗散引入线性退化的波中。",
            "id": "3359305",
            "problem": "你需要实现并分析用于理想气体和恒定比热比的一维气体动力学欧拉方程的 Roe 近似黎曼求解器，并引入一个仅应用于声学场的熵修正。然后，定量评估这种熵修正对保持静止接触间断的影响。\n\n从以下基本理论出发：\n- 理想气体的一维气体动力学欧拉方程的守恒形式为\n$$\nU_t + F(U)_x = 0,\n$$\n其中守恒状态向量为\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix},\n$$\n通量为\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix},\n$$\n理想气体的热力学闭合关系为\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right).\n$$\n这里，$ \\rho $ 是密度，$ u $ 是速度，$ p $ 是压力，$ E $ 是总能量密度，$ \\gamma $ 是比热比。\n\n- Roe 线性化使用 Roe 平均状态来近似雅可比矩阵。定义 Roe 平均速度 $ \\tilde{u} $、Roe 平均比焓 $ \\tilde{H} $ 和 Roe 平均声速 $ \\tilde{a} $ 如下：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)},\n$$\n其中 $ H = (E + p)/\\rho $ 是总比焓，下标 $ L $ 和 $ R $ 表示左、右状态。\n\n- Roe 平均雅可比矩阵的特征值为\n$$\n\\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a},\n$$\n其对应的右特征向量（以守恒变量形式表示）为\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix}.\n$$\n令 $ \\Delta U = U_R - U_L $。波强度向量 $ \\alpha = (\\alpha_1, \\alpha_2, \\alpha_3)^T $ 可通过以下线性系统获得\n$$\nR \\alpha = \\Delta U, \\quad \\text{其中 } R = [r_1 \\; r_2 \\; r_3].\n$$\n\n- 界面上的 Roe 数值通量为\n$$\n\\hat{F}(U_L, U_R) = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i| \\alpha_i r_i.\n$$\n\n- 熵修正用于在声速点附近对特征值的绝对值进行正则化。使用 Harten 二次熵修正函数，阈值为 $ \\delta  0 $：\n$$\n\\phi(|\\lambda|;\\delta) = \\begin{cases}\n\\frac{1}{2}\\left(\\frac{|\\lambda|^2}{\\delta} + \\delta\\right),  \\text{if } |\\lambda|  \\delta, \\\\\n|\\lambda|,  \\text{if } |\\lambda| \\ge \\delta.\n\\end{cases}\n$$\n仅对声学场应用此熵修正，即将 $ |\\lambda_1| $ 和 $ |\\lambda_3| $ 修改为 $ \\phi(|\\lambda_1|;\\delta) $ 和 $ \\phi(|\\lambda_3|;\\delta) $，而保持 $ |\\lambda_2| $ 不变。为了比较，还需考虑另一种配置，即将熵修正应用于所有三个场。\n\n任务：\n1. 实现一个函数，该函数使用 Roe 求解器计算 $ \\hat{F}(U_L, U_R) $，并具有可配置的熵修正模式：无、仅声学场或所有特征值。\n2. 评估静止接触间断是否被保持。静止接触间断在此定义为 $ u_L = u_R = 0 $，$ p_L = p_R $ 和 $ \\rho_L \\ne \\rho_R $。在这种情况下，两侧的物理通量相等，为 $ F(U_L) = F(U_R) = [0, p, 0]^T $，在界面上完美保持意味着数值通量 $ \\hat{F} $ 精确等于 $ [0, p, 0]^T $。\n3. 全程使用无量纲量；不需要物理单位。\n\n定义保持准则：对于给定的配置，计算静止接触情况下的数值通量 $ \\hat{F} $ 和精确物理通量 $ F(U_L) $，然后计算误差向量 $ e = \\hat{F} - F(U_L) $ 及其欧几里得范数 $ \\|e\\|_2 $。如果 $ \\|e\\|_2 \\le \\varepsilon $（其中 $ \\varepsilon $ 是一个固定的容差），则该界面保持了静止接触。\n\n测试套件：\n使用以下测试用例，所有用例的比热比 $ \\gamma = 1.4 $，容差 $ \\varepsilon = 10^{-12} $。\n\n- 用例 1（正常路径）：左侧 $ (\\rho_L, u_L, p_L) = (1.0, 0.0, 1.0) $，右侧 $ (\\rho_R, u_R, p_R) = (2.0, 0.0, 1.0) $，熵修正阈值 $ \\delta = 10^{-3} $，熵修正模式：仅声学场。输出一个布尔值，指示是否保持。\n\n- 用例 2（对比配置）：状态与用例 1 相同，熵修正阈值 $ \\delta = 10^{-3} $，熵修正模式：所有特征值。输出一个布尔值，指示是否保持。\n\n- 用例 3（边界阈值）：状态与用例 1 相同，熵修正阈值 $ \\delta = 10^{-12} $，熵修正模式：所有特征值。输出一个布尔值，指示是否保持。\n\n- 用例 4（近静止接触，对仅声学场修正的影响）：左侧 $ (\\rho_L, u_L, p_L) = (1.0, 10^{-6}, 1.0) $，右侧 $ (\\rho_R, u_R, p_R) = (2.0, 10^{-6}, 1.0) $，熵修正阈值 $ \\delta = 10^{-3} $。计算熵修正模式为“无”和“仅声学场”时的数值通量，并输出它们差值的欧几里得范数 $ \\|\\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}}\\|_2 $，结果为浮点数。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，$ [\\text{result1},\\text{result2},\\text{result3},\\text{result4}] $），其中前三个条目分别为用例 1-3 的布尔值，第四个条目为用例 4 的浮点数。所有计算必须是无量纲的。",
            "solution": "用户要求实现并分析用于一维欧拉方程的 Roe 近似黎曼求解器，特别关注熵修正对保持静止接触间断的影响。该问题在科学上是合理的，定义明确，并且提供了所有必要的定义和数据。我将继续提供完整的解决方案。\n\n该解决方案涉及 Roe 求解器的分步实现，然后对四个指定的测试用例进行行为分析。该方法的核心是计算左状态 $U_L$ 和右状态 $U_R$ 之间界面上的数值通量 $\\hat{F}(U_L, U_R)$。\n\n### 步骤 1：状态和通量表示\n问题以原始变量 $(\\rho, u, p)$ 提供了状态。这些必须首先转换为守恒状态向量 $U = [\\rho, \\rho u, E]^T$。总能量密度 $E$ 通过重新整理理想气体状态方程得到：\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2\n$$\n物理通量函数 $F(U)$ 由下式给出：\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix}\n$$\n我们需要为左、右两种状态计算这个通量。\n\n### 步骤 2：Roe 平均状态\nRoe 方法通过引入一个状态平均的雅可比矩阵来线性化问题。该矩阵的元素取决于 Roe 平均量，这些量由左 ($L$) 和右 ($R$) 状态计算得出。所需平均量为速度 $\\tilde{u}$、比焓 $\\tilde{H}$ 和声速 $\\tilde{a}$。\n\n首先，我们定义比焓 $H = (E+p)/\\rho$。然后，计算 Roe 平均值：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)}\n$$\n构建这些平均值是为了精确满足 Rankine-Hugoniot 条件，即 $F(U_R) - F(U_L) = \\tilde{A}(U_R - U_L)$，其中 $\\tilde{A}$ 是在 Roe 平均状态下评估的雅可比矩阵。\n\n### 步骤 3：波分解\n界面上的状态跳跃 $\\Delta U = U_R - U_L$ 被投影到 Roe 平均雅可比矩阵 $\\tilde{A}$ 的右特征向量基上。$\\tilde{A}$ 的特征值是 $\\lambda_1 = \\tilde{u} - \\tilde{a}$、$\\lambda_2 = \\tilde{u}$ 和 $\\lambda_3 = \\tilde{u} + \\tilde{a}$，分别对应于左行声学波、熵/接触波和右行声学波。投影由以下线性系统给出：\n$$\nR \\alpha = \\Delta U\n$$\n其中 $R = [r_1, r_2, r_3]$ 是其列为右特征向量的矩阵，$\\alpha = [\\alpha_1, \\alpha_2, \\alpha_3]^T$ 是波强度向量。通过求解这个 $3 \\times 3$ 系统，我们得到波强度的显式公式：\n$$\n\\alpha_2 = \\frac{\\gamma-1}{\\tilde{a}^2} \\left( \\Delta U_1 (\\tilde{H} - \\tilde{u}^2) + \\Delta U_2 \\tilde{u} - \\Delta U_3 \\right)\n$$\n$$\n\\alpha_1 = \\frac{1}{2} \\left[ (\\Delta U_1 - \\alpha_2) - \\frac{\\Delta U_2 - \\tilde{u}\\Delta U_1}{\\tilde{a}} \\right]\n$$\n$$\n\\alpha_3 = \\frac{1}{2} \\left[ (\\Delta U_1 - \\alpha_2) + \\frac{\\Delta U_2 - \\tilde{u}\\Delta U_1}{\\tilde{a}} \\right]\n$$\n其中 $\\Delta U = [\\Delta U_1, \\Delta U_2, \\Delta U_3]^T$。\n\n### 步骤 4：带熵修正的数值通量\nRoe 数值通量是一种迎风型通量，由左、右通量的平均值加上一个模拟界面处波传播的耗散项构成。\n$$\n\\hat{F}(U_L, U_R) = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i|_{\\text{fixed}} \\alpha_i r_i\n$$\n$|\\lambda_i|$ 项引入了数值耗散。然而，对于接近零的特征值，这可能产生非物理的解，如膨胀激波。应用 Harten 熵修正来对 $|\\lambda_i|$ 进行正则化：\n$$\n|\\lambda_i|_{\\text{fixed}} = \\phi(|\\lambda_i|;\\delta) = \\begin{cases}\n\\frac{1}{2}\\left(\\frac{|\\lambda_i|^2}{\\delta} + \\delta\\right),  \\text{if } |\\lambda_i|  \\delta \\\\\n|\\lambda_i|,  \\text{if } |\\lambda_i| \\ge \\delta\n\\end{cases}\n$$\n问题指定了三种应用此修正的模式：`'none'`（无）、`'acoustic-only'`（仅应用于 $\\lambda_1, \\lambda_3$）和 `'all-eigenvalues'`（所有特征值）。\n\n### 测试用例分析\n\n**用例 1：静止接触，仅声学场修正**\n- 状态：$(\\rho_L, u_L, p_L)=(1.0, 0.0, 1.0)$，$(\\rho_R, u_R, p_R)=(2.0, 0.0, 1.0)$。模式：`acoustic-only`。\n- 静止接触具有 $u_L=u_R=0$ 和 $p_L=p_R$。这意味着 $\\tilde{u}=0$。两侧的物理通量均为 $F(U_L)=F(U_R)=[0, p, 0]^T = [0, 1, 0]^T$。为实现完美保持，$\\hat{F}$ 必须等于此通量。\n- 对于此配置，波分解正确地将间断分离到接触波中。波强度为 $\\alpha_1=0$，$\\alpha_3=0$，以及 $\\alpha_2 = \\Delta \\rho = 1$。耗散项变为 $\\frac{1}{2}|\\lambda_2|_{\\text{fixed}} \\alpha_2 r_2$。\n- 特征值为 $\\lambda_2 = \\tilde{u} = 0$。在 `'acoustic-only'` 模式下，不对该特征值应用熵修正，因此 $|\\lambda_2|_{\\text{fixed}} = |\\lambda_2| = 0$。\n- 耗散项恰好为零。因此，$\\hat{F} = \\frac{1}{2}(F_L + F_R) = F_L$。误差为零，静止接触间断被完美保持。结果为 `True`。\n\n**用例 2：静止接触，所有特征值修正**\n- 状态相同，但熵修正应用于所有特征值。\n- 波强度再次为 $\\alpha=(0, 1, 0)$。耗散为 $\\frac{1}{2}|\\lambda_2|_{\\text{fixed}} \\alpha_2 r_2$。\n- 特征值为 $\\lambda_2 = 0$。使用 $\\delta=10^{-3}$，我们有 $|\\lambda_2|  \\delta$。修正被激活：$|\\lambda_2|_{\\text{fixed}} = \\phi(0; \\delta) = \\frac{\\delta}{2}$。\n- 耗散项非零：$\\frac{1}{2} (\\frac{\\delta}{2}) (1) r_2$，其中 $r_2 = [1, \\tilde{u}, \\frac{1}{2}\\tilde{u}^2]^T = [1,0,0]^T$。耗散向量为 $[\\delta/4, 0, 0]^T$。\n- 数值通量为 $\\hat{F} = [0, 1, 0]^T - [\\delta/4, 0, 0]^T$。误差向量为 $e = [-\\delta/4, 0, 0]^T$。\n- 误差范数为 $\\|e\\|_2 = \\delta/4 = 10^{-3}/4 = 2.5 \\times 10^{-4}$。\n- 由于 $2.5 \\times 10^{-4}  \\varepsilon=10^{-12}$，条件不满足。接触间断未被保持。结果为 `False`。这表明，对接触波应用熵修正会引入虚假的耗散，从而涂抹静止的接触间断。\n\n**用例 3：静止接触，所有特征值修正，小 delta**\n- 与用例 2 相同，但 $\\delta = 10^{-12}$。\n- 误差范数再次为 $\\delta/4 = 10^{-12}/4 = 2.5 \\times 10^{-13}$。\n- 此时，$2.5 \\times 10^{-13} \\le \\varepsilon=10^{-12}$。保持准则得到满足。结果为 `True`。\n\n**用例 4：近静止接触**\n- 状态：$(\\rho_L, u_L, p_L)=(1.0, 10^{-6}, 1.0)$，$(\\rho_R, u_R, p_R)=(2.0, 10^{-6}, 1.0)$，$\\delta=10^{-3}$。我们计算 $\\|\\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}}\\|_2$。\n- 两种通量之间的差异仅源于其耗散项的差异：\n$ \\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}} = \\frac{1}{2} \\sum_{i=1}^3 (\\alpha_i r_i (|\\lambda_i| - |\\lambda_i|_{\\text{acoustic-fixed}})) $\n- 在 `'acoustic-only'` 模式下，修正仅应用于 $\\lambda_1$ 和 $\\lambda_3$。\n- 对于这种近静止流，$\\tilde{u} = 10^{-6}$，Roe 平均声速 $\\tilde{a} \\approx 0.995$。\n- 声学特征值为 $\\lambda_1 = \\tilde{u} - \\tilde{a} \\approx -0.995$ 和 $\\lambda_3 = \\tilde{u} + \\tilde{a} \\approx 0.995$。\n- 相应的绝对值为 $|\\lambda_1| \\approx 0.995$ 和 $|\\lambda_3| \\approx 0.995$。两者都远大于阈值 $\\delta = 10^{-3}$。\n- 根据 $\\phi$ 的定义，如果 $|\\lambda| \\ge \\delta$，则 $\\phi(|\\lambda|; \\delta) = |\\lambda|$。\n- 因此，对于两个声学波，熵修正不起作用。$|\\lambda_{1,3}|_{\\text{acoustic-fixed}} = |\\lambda_{1,3}|$。\n- `'acoustic-only'` 和 `'none'` 模式的耗散项是相同的，因此通量之间的差值为零。结果为 `0.0`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma, delta, mode):\n    \"\"\"\n    Computes Roe's approximate Riemann solver flux for the 1D Euler equations.\n    \"\"\"\n    # Step 1: Convert primitive variables to conservative variables\n    E_L = p_L / (gamma - 1.0) + 0.5 * rho_L * u_L**2\n    U_L = np.array([rho_L, rho_L * u_L, E_L])\n    \n    E_R = p_R / (gamma - 1.0) + 0.5 * rho_R * u_R**2\n    U_R = np.array([rho_R, rho_R * u_R, E_R])\n\n    # Compute physical fluxes\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n\n    # Step 2: Compute Roe-averaged quantities\n    sqrt_rho_L = np.sqrt(rho_L)\n    sqrt_rho_R = np.sqrt(rho_R)\n    \n    u_tilde = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n    H_tilde = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    a_tilde_sq = (gamma - 1.0) * (H_tilde - 0.5 * u_tilde**2)\n    # Ensure non-negativity before sqrt due to potential floating point errors\n    a_tilde = np.sqrt(max(0.0, a_tilde_sq))\n\n    # Step 3: Compute wave strengths (alpha vector)\n    Delta_U = U_R - U_L\n    Delta_U1, Delta_U2, Delta_U3 = Delta_U\n    \n    if a_tilde == 0:\n        # This case is degenerate and not expected for the given problems.\n        # A robust implementation would handle this, e.g., by falling\n        # back to a more diffusive flux like Lax-Friedrichs.\n        # For this problem set, an exception is sufficient.\n        raise ValueError(\"Roe-averaged sound speed is zero.\")\n\n    alpha_2 = (gamma - 1.0) / a_tilde**2 * (Delta_U1 * (H_tilde - u_tilde**2) + Delta_U2 * u_tilde - Delta_U3)\n    alpha_1 = 0.5 * ((Delta_U1 - alpha_2) - (Delta_U2 - u_tilde * Delta_U1) / a_tilde)\n    alpha_3 = 0.5 * ((Delta_U1 - alpha_2) + (Delta_U2 - u_tilde * Delta_U1) / a_tilde)\n    alphas = np.array([alpha_1, alpha_2, alpha_3])\n\n    # Eigenvalues and right eigenvectors\n    lambdas = np.array([u_tilde - a_tilde, u_tilde, u_tilde + a_tilde])\n    \n    r1 = np.array([1.0, u_tilde - a_tilde, H_tilde - u_tilde * a_tilde])\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde**2])\n    r3 = np.array([1.0, u_tilde + a_tilde, H_tilde + u_tilde * a_tilde])\n    R = np.array([r1, r2, r3]).T # Eigenvectors as columns\n\n    # Step 4: Apply Harten's entropy fix\n    def phi(lambda_abs, d):\n        return 0.5 * (lambda_abs**2 / d + d) if lambda_abs  d else lambda_abs\n\n    abs_lambdas_fixed = np.abs(lambdas)\n    \n    if mode == 'acoustic-only':\n        abs_lambdas_fixed[0] = phi(abs_lambdas_fixed[0], delta)\n        abs_lambdas_fixed[2] = phi(abs_lambdas_fixed[2], delta)\n    elif mode == 'all-eigenvalues':\n        for i in range(3):\n            abs_lambdas_fixed[i] = phi(abs_lambdas_fixed[i], delta)\n    # Mode 'none' requires no changes\n\n    # Step 5: Compute Roe flux\n    dissipation = 0.5 * np.dot(R, (abs_lambdas_fixed * alphas))\n    \n    F_hat = 0.5 * (F_L + F_R) - dissipation\n    return F_hat\n\ndef solve():\n    # Define the test cases from the problem statement.\n    gamma = 1.4\n    epsilon = 1e-12\n    \n    test_cases = [\n        # Case 1\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-3, 'mode': 'acoustic-only'},\n        # Case 2\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-3, 'mode': 'all-eigenvalues'},\n        # Case 3\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-12, 'mode': 'all-eigenvalues'},\n        # Case 4\n        {'rho_L': 1.0, 'u_L': 1e-6, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 1e-6, 'p_R': 1.0, 'delta': 1e-3}\n    ]\n\n    results = []\n\n    # Cases 1, 2, 3: Preservation of stationary contact\n    for i in range(3):\n        case = test_cases[i]\n        \n        roe_flux = compute_roe_flux(case['rho_L'], case['u_L'], case['p_L'],\n                                      case['rho_R'], case['u_R'], case['p_R'],\n                                      gamma, case['delta'], case['mode'])\n        \n        # For a stationary contact, the exact flux is F(U_L) = [0, p, 0]\n        exact_flux = np.array([0.0, case['p_L'], 0.0])\n        \n        error_norm = np.linalg.norm(roe_flux - exact_flux)\n        \n        results.append(error_norm = epsilon)\n\n    # Case 4: Difference between acoustic-only and no-fix fluxes\n    case4 = test_cases[3]\n    \n    flux_acoustic = compute_roe_flux(case4['rho_L'], case4['u_L'], case4['p_L'],\n                                     case4['rho_R'], case4['u_R'], case4['p_R'],\n                                     gamma, case4['delta'], 'acoustic-only')\n    \n    flux_none = compute_roe_flux(case4['rho_L'], case4['u_L'], case4['p_L'],\n                                 case4['rho_R'], case4['u_R'], case4['p_R'],\n                                 gamma, case4['delta'], 'none')\n\n    diff_norm = np.linalg.norm(flux_acoustic - flux_none)\n    results.append(diff_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个稳健的数值格式必须始终产生物理上真实的结果，对于欧拉方程而言，这意味着保持密度和压力的正定性。然而，在强稀疏波扩展至近真空等极端情况下，基本的 Roe 求解器可能无法满足这一要求。本练习旨在解决这一关键的失效模式，要求您设计一个保持正定性的通量。通过将精确的 Roe 通量与更为稳健的 HLLE 通量进行自适应混合，您将确保格式在更广泛的挑战性问题中保持稳定和物理意义。",
            "id": "3359360",
            "problem": "考虑理想气体的一维可压缩欧拉方程组的守恒变量形式，其比热比为 $\\gamma \\in \\mathbb{R}$，$\\gamma  1$：\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}, \\quad \\mathbf{U} = \\begin{bmatrix} \\rho \\\\ m \\\\ E \\end{bmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} m \\\\ \\dfrac{m^2}{\\rho} + p \\\\ (E+p)u \\end{bmatrix},\n$$\n其中原始变量为密度 $\\rho  0$、速度 $u = m/\\rho$、压力 $p$ 和总能量 $E$，它们通过理想气体状态方程相关联：\n$$\np = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\rho u^2 \\right).\n$$\n定义不变区域 $\\mathcal{G} = \\{ \\mathbf{U}: \\rho  0,\\ p  0 \\}$。\n\n设在左、右状态 $(\\mathbf{U}_L, \\mathbf{U}_R)$ 处的 Roe 线性化由标准的 Roe 平均速度 $\\tilde{u}$、总焓 $\\tilde{H}$ 和声速 $\\tilde{a}$ 定义：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}\\,u_L + \\sqrt{\\rho_R}\\,u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}\\,H_L + \\sqrt{\\rho_R}\\,H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\\quad\n\\tilde{a}^2 = (\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2}\\tilde{u}^2\\right),\n$$\n其中 $H = (E + p)/\\rho$ 且 $u = m/\\rho$。Roe 通量 $\\mathbf{F}^{\\mathrm{Roe}}(\\mathbf{U}_L,\\mathbf{U}_R)$ 是使用 Roe 矩阵的特征分解计算的近似黎曼通量，该矩阵的特征值为 $\\tilde{u}-\\tilde{a}$、$\\tilde{u}$、$\\tilde{u}+\\tilde{a}$ 及其对应的右特征向量。Harten–Lax–van Leer–Einfeldt (HLLE) 通量 $\\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R)$ 由单侧信号速度 $S_L \\le 0 \\le S_R$ 定义，这些速度由最快的左行和右行特征线的一致下界和上界构造而成，例如\n$$\nS_L = \\min\\{u_L - c_L,\\ \\tilde{u} - \\tilde{a},\\ u_R - c_R\\},\\quad\nS_R = \\max\\{u_L + c_L,\\ \\tilde{u} + \\tilde{a},\\ u_R + c_R\\},\n$$\n其中 $c = \\sqrt{\\gamma p/\\rho}$ 是物理声速，且\n$$\n\\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) = \n\\begin{cases}\n\\mathbf{F}(\\mathbf{U}_L),  S_L \\ge 0,\\\\\n\\mathbf{F}(\\mathbf{U}_R),  S_R \\le 0,\\\\\n\\dfrac{S_R \\mathbf{F}(\\mathbf{U}_L) - S_L \\mathbf{F}(\\mathbf{U}_R) + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L},  \\text{否则}.\n\\end{cases}\n$$\n\n在均匀网格上，给定 $\\Delta x  0$ 的一阶有限体积更新公式为\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^{n} - \\lambda \\left( \\hat{\\mathbf{F}}_{i+\\tfrac{1}{2}} - \\hat{\\mathbf{F}}_{i-\\tfrac{1}{2}} \\right), \\quad \\lambda = \\frac{\\Delta t}{\\Delta x},\n$$\n其中 $\\hat{\\mathbf{F}}_{i\\pm \\tfrac{1}{2}}$ 是一个相容的数值通量，$\\Delta t  0$ 是时间步长，通过 Courant–Friedrichs–Lewy (CFL) 数 $\\nu \\in (0,1)$ 选择：\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i\\left(|u_i| + c_i\\right)}.\n$$\n\n任务：\n1. 构造显式的左右初始状态 $(\\mathbf{U}_L,\\mathbf{U}_R) \\in \\mathcal{G} \\times \\mathcal{G}$，使得在第一波和第三波段之间的中心扇区中的 Roe 线性化中间状态具有 $\\rho^\\star \\le 0$ 或 $p^\\star \\le 0$。为了使此检查能够在不进行时间推进的情况下进行算法验证，将 Roe 星状态定义为\n$$\n\\mathbf{U}^\\star = \\mathbf{U}_L + \\alpha_1 \\mathbf{r}_1 + \\alpha_2 \\mathbf{r}_2,\n$$\n其中 $\\{\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3\\}$ 是在 $(\\tilde{u},\\tilde{H},\\tilde{a})$ 处的 Roe 右特征向量，波强度系数 $\\alpha_k$ 由以下线性系统定义\n$$\n[\\mathbf{r}_1\\ \\mathbf{r}_2\\ \\mathbf{r}_3]\\begin{bmatrix}\\alpha_1\\\\ \\alpha_2\\\\ \\alpha_3\\end{bmatrix} = \\mathbf{U}_R - \\mathbf{U}_L.\n$$\n如果 $\\mathbf{U}^\\star$ 的任一分量导致 $\\rho^\\star \\le 0$ 或 $p^\\star \\le 0$，则声明 Roe 求解器对于给定的 $(\\mathbf{U}_L,\\mathbf{U}_R)$ 是非容许的。\n\n2. 通过在每个界面处将 Roe 通量与 HLLE 通量混合，设计一个保正性通量修正，\n$$\n\\hat{\\mathbf{F}}_{\\theta}(\\mathbf{U}_L,\\mathbf{U}_R) = \\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) + \\theta \\left( \\mathbf{F}^{\\mathrm{Roe}}(\\mathbf{U}_L,\\mathbf{U}_R) - \\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) \\right), \\quad \\theta \\in [0,1],\n$$\n其中，界面参数 $\\theta$ 被自适应地选择，以确保在一个具有三个单元的周期性网格上进行一个向前欧拉步后，所有更新后的单元状态都位于 $\\mathcal{G}$ 内。$\\theta$ 的选择必须纯粹由每个界面的局部邻居信息计算得出，并且绝不能增加到超过 $\\theta = 1$。实现一个 $\\theta$ 的构造性选择规则，该规则在 CFL 数满足 $\\nu \\le \\nu_0$（对于某个你必须明确指定的 $\\nu_0 \\in (0,1)$）的形式的界限时，始终保证共享该界面的两个单元的 $\\rho_i^{n+1}  0$ 和 $p_i^{n+1}  0$。\n\n3. 证明一个不变区域性质：证明对于单独的 HLLE 通量（即 $\\theta = 0$），映射 $\\mathbf{U}^n \\mapsto \\mathbf{U}^{n+1}$ 在 CFL 界限 $\\nu \\le \\nu_0$ 下保持 $\\mathcal{G}$，并且在任务2中构造的 $\\theta \\in [0,1]$ 混合方案也保持 $\\mathcal{G}$。\n\n实现要求：\n- 使用理想气体方程，其中 $\\gamma = 1.4$。\n- 使用一个具有三个单元的周期性网格，其中 $\\Delta x = 1$，并执行单个向前欧拉步。\n- 对于保正性混合通量，使用 $\\nu = 0.45$。\n- 对于任务1中的 Roe 非容许性检查，不要进行时间推进；仅检查如上定义的 Roe 星状态 $\\mathbf{U}^\\star$。\n- 将状态视为无量纲；不需要物理单位。\n\n测试套件：\n- 使用以下左-右原始状态对 $(\\rho_L,u_L,p_L;\\ \\rho_R,u_R,p_R)$，并且对于混合通量更新，将三个周期性单元初始化为 $[\\text{左},\\ \\text{右},\\ \\text{左}]$：\n  - 情况 A（极端对称稀疏波）：$(1.0,-100.0,10^{-6};\\ 1.0,100.0,10^{-6})$。\n  - 情况 B（具有密度反差的强非对称稀疏波）：$(10.0,-60.0,10^{-4};\\ 0.1,60.0,10^{-6})$。\n  - 情况 C（中等激波管类问题）：$(1.0,0.0,1.0;\\ 0.125,0.0,0.1)$。\n  - 情况 D（速度相反的近真空）：$(10^{-3},-20.0,10^{-12};\\ 10^{-3},20.0,10^{-12})$。\n\n所需输出：\n- 对于每种情况，输出两个布尔值：\n  - 第一个布尔值为真，如果 Roe 的星状态是非容许的，即如果 $\\rho^\\star \\le 0$ 或 $p^\\star \\le 0$。\n  - 第二个布尔值为真，如果在 CFL 数 $\\nu = 0.45$ 的情况下，使用混合通量进行一次三单元周期性更新后，所有更新后的单元状态都满足 $\\rho  0$ 和 $p  0$。\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下：\n$$\n[\\text{roe\\_bad\\_A},\\ \\text{pos\\_ok\\_A},\\ \\text{roe\\_bad\\_B},\\ \\text{pos\\_ok\\_B},\\ \\text{roe\\_bad\\_C},\\ \\text{pos\\_ok\\_C},\\ \\text{roe\\_bad\\_D},\\ \\text{pos\\_ok\\_D}],\n$$\n其中每个符号都是实现语言中的布尔字面量。",
            "solution": "该问题是有效的，因为它科学地基于计算流体动力学中被充分理解的原理，特别是关于欧拉方程的数值解。它提出了一组清晰、客观且适定的任务：分析 Roe 近似黎曼求解器的一个已知失效模式，并通过将其与鲁棒的 HLLE 通量混合来实现一个标准的保正性修正。参数、初始条件和所需输出都已明确定义，使得该问题自成体系且可验证。\n\n### 理论基础\n\n可压缩理想气体的一维欧拉方程是一个双曲守恒律系统：\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}\n$$\n其中 $\\mathbf{U} = [\\rho, m, E]^T$ 是守恒变量（密度、动量、总能量）的向量，$\\mathbf{F}(\\mathbf{U})$ 是通量向量。该系统必须通过一个状态方程来封闭，对于理想气体，该方程将压力 $p$ 与守恒量联系起来：\n$$\np = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\rho u^2 \\right) = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\frac{m^2}{\\rho} \\right)\n$$\n一个有物理意义的解必须位于不变区域 $\\mathcal{G} = \\{ \\mathbf{U}: \\rho  0, p  0 \\}$ 内。\n\n一阶有限体积法通过以下方式更新网格平均状态 $\\mathbf{U}_i$：\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^{n} - \\frac{\\Delta t}{\\Delta x} \\left( \\hat{\\mathbf{F}}_{i+\\tfrac{1}{2}} - \\hat{\\mathbf{F}}_{i-\\tfrac{1}{2}} \\right)\n$$\n其中 $\\hat{\\mathbf{F}}_{i\\pm\\tfrac{1}{2}}$ 是与 $\\mathbf{F}(\\mathbf{U})$ 相容的数值通量函数。数值通量的选择对解的稳定性、准确性和物理容许性至关重要。\n\n#### 任务1：Roe 求解器的非容许性\n\nRoe 的近似黎曼求解器通过寻找一个满足 $\\mathbf{F}(\\mathbf{U}_{i+1}) - \\mathbf{F}(\\mathbf{U}_i) = \\tilde{\\mathbf{A}}(\\mathbf{U}_i, \\mathbf{U}_{i+1})$ 的矩阵 $\\tilde{\\mathbf{A}}(\\mathbf{U}_i, \\mathbf{U}_{i+1})$（Roe 矩阵）来在每个单元界面 $(i+\\tfrac{1}{2})$ 处对问题进行线性化。矩阵 $\\tilde{\\mathbf{A}}$ 使用 Roe 平均状态构造。虽然计算效率高，但这种线性化可能无法遵守欧拉方程的非线性约束，特别是对于涉及强稀疏波或近真空状态的问题。这可能导致生成具有非物理负密度或负压力的状态。\n\n该问题定义了对此失效模式的特定检查。给定左、右状态 $(\\mathbf{U}_L, \\mathbf{U}_R)$：\n1.  计算 Roe 平均量 $(\\tilde{u}, \\tilde{H}, \\tilde{a})$。\n2.  跳跃量 $\\Delta\\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$ 在 Roe 矩阵的右特征向量基 $\\{\\mathbf{r}_1, \\mathbf{r}_2, \\mathbf{r}_3\\}$ 中分解：$\\Delta\\mathbf{U} = \\sum_{k=1}^3 \\alpha_k \\mathbf{r}_k$。\n3.  通过求解这个线性系统找到系数 $\\alpha_k$。我们使用标准的特征向量：\n    $$\n    \\mathbf{r}_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u}-\\tilde{a} \\\\ \\tilde{H}-\\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\n    \\mathbf{r}_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\n    \\mathbf{r}_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u}+\\tilde{a} \\\\ \\tilde{H}+\\tilde{u}\\tilde{a} \\end{bmatrix}\n    $$\n    第二个特征向量 $\\mathbf{r}_2$ 对应于恒定压力和速度下的熵跳跃。\n4.  一个中间“星”状态被定义为 $\\mathbf{U}^\\star = \\mathbf{U}_L + \\alpha_1 \\mathbf{r}_1 + \\alpha_2 \\mathbf{r}_2$。通过将其转换为原始变量 $(\\rho^\\star, u^\\star, p^\\star)$ 并验证是否 $\\rho^\\star  0$ 和 $p^\\star  0$ 来检查此状态的物理容许性。如果不满足，则认为该求解器对这对状态是非容许的。\n\n#### 任务3：HLLE 通量的不变区域性质\n\n众所周知，HLLE 通量在适当的 CFL 条件下是鲁棒地保正的。可以证明，该更新格式是前一时间步状态的凸组合，从而保持了凸集 $\\mathcal{G}$。\n可以证明，只要时间步长 $\\Delta t$ 满足类 CFL 条件，HLLE 有限体积格式就能保持 $\\rho$ 和 $p$ 的正性：\n$$\n\\frac{\\Delta t}{\\Delta x} \\max_{j} \\left( S_{R, j+\\tfrac{1}{2}} - S_{L, j+\\tfrac{1}{2}} \\right) \\le 1\n$$\n其中最大值取自所有单元界面 $j+\\tfrac{1}{2}$。信号速度 $S_L$ 和 $S_R$ 定义为：\n$$\nS_L = \\min\\{u_L - c_L,\\ \\tilde{u} - \\tilde{a},\\ u_R - c_R\\}, \\quad S_R = \\max\\{u_L + c_L,\\ \\tilde{u} + \\tilde{a},\\ u_R + c_R\\}\n$$\n设 $S_{\\text{max}} = \\max_i(|u_i| + c_i)$。时间步长为 $\\Delta t = \\nu \\frac{\\Delta x}{S_{\\text{max}}}$。\n根据 $S_L$ 和 $S_R$ 的定义，我们有界 $S_R \\le S_{\\text{max}}$ 和 $S_L \\ge -S_{\\text{max}}$。因此，$S_R - S_L \\le 2S_{\\text{max}}$。将此代入 CFL 条件：\n$$\n\\frac{1}{S_{\\text{max}}} \\nu \\cdot (2 S_{\\text{max}}) \\le 1 \\implies 2\\nu \\le 1 \\implies \\nu \\le 0.5\n$$\n因此，对于 $\\nu \\le \\nu_0 = 0.5$，HLLE 格式保证保持不变区域 $\\mathcal{G}$。\n\n#### 任务2：保正性混合通量\n\n为了结合 Roe 求解器的准确性和 HLLE 的鲁棒性，我们使用一个混合通量：\n$$\n\\hat{\\mathbf{F}}_{\\theta} = (1-\\theta)\\mathbf{F}^{\\mathrm{HLLE}} + \\theta \\mathbf{F}^{\\mathrm{Roe}}\n$$\n其中 $\\theta \\in [0,1]$ 是一个自适应参数。为确保正性，必须在每个界面处仔细选择 $\\theta$。我们采用了一种构造性方法，遵循保正性限制器（例如 Zhang  Shu, JCP 2010）的框架。\n\n在单元 $i$ 和 $i+1$ 之间的每个界面 $j=i+\\tfrac{1}{2}$ 处，我们确定一个单一参数 $\\theta_j$，以确保两个相邻单元更新后的正性。这是通过考虑两个“测试状态”来实现的，这两个状态隔离了界面 $j$ 处通量的贡献：\n$$\n\\mathbf{P}_{i} (\\theta_j) = \\mathbf{U}_i^n - 2\\lambda \\left( \\hat{\\mathbf{F}}_{\\theta_j}(\\mathbf{U}_i^n, \\mathbf{U}_{i+1}^n) - \\mathbf{F}(\\mathbf{U}_i^n) \\right)\n$$\n$$\n\\mathbf{P}_{i+1}(\\theta_j) = \\mathbf{U}_{i+1}^n + 2\\lambda \\left( \\hat{\\mathbf{F}}_{\\theta_j}(\\mathbf{U}_i^n, \\mathbf{U}_{i+1}^n) - \\mathbf{F}(\\mathbf{U}_{i+1}^n) \\right)\n$$\n其中 $\\lambda = \\Delta t/\\Delta x$。为了使整个格式在 CFL 条件 $\\nu \\le \\nu_0/2 = 0.25$ 下是保正的，只需确保 $\\mathbf{P}_i, \\mathbf{P}_{i+1} \\in \\mathcal{G}$。虽然问题使用 $\\nu=0.45$，但这种限制过程是一种鲁棒的启发式方法，通常在其严格的理论界限之外也能工作。\n\n令 $\\mathbf{F}^{\\mathrm{R-H}} = \\mathbf{F}^{\\mathrm{Roe}} - \\mathbf{F}^{\\mathrm{HLLE}}$。单元 $i$ 的测试状态可以写成：\n$$\n\\mathbf{P}_{i}(\\theta_j) = \\left( \\mathbf{U}_i^n - 2\\lambda(\\mathbf{F}^{\\mathrm{HLLE}} - \\mathbf{F}_i^n) \\right) - 2\\lambda\\theta_j \\mathbf{F}^{\\mathrm{R-H}}\n$$\n令 $\\mathbf{U}_{\\mathrm{base}} = \\mathbf{U}_i^n - 2\\lambda(\\mathbf{F}^{\\mathrm{HLLE}} - \\mathbf{F}_i^n)$，在更严格的 CFL 条件下，它保证在 $\\mathcal{G}$ 中。令 $\\delta\\mathbf{U} = -2\\lambda \\mathbf{F}^{\\mathrm{R-H}}$。我们需要找到最大的 $\\theta \\in [0,1]$ 使得 $\\mathbf{U}(\\theta) = \\mathbf{U}_{\\mathrm{base}} + \\theta \\delta\\mathbf{U}$ 在 $\\mathcal{G}$ 中。这涉及两个条件：\n1.  **密度正性**：$\\rho(\\theta) = \\rho_{\\mathrm{base}} + \\theta \\delta\\rho  0$。这是一个关于 $\\theta$ 的线性不等式。\n2.  **压力正性**：$p(\\theta) = (\\gamma-1)(E(\\theta) - \\frac{m(\\theta)^2}{2\\rho(\\theta)})  0$。这转化为一个二次不等式 $A\\theta^2 + B\\theta + C  0$，其中 $C  0$。\n\n通过对 $\\mathbf{P}_i$ 和 $\\mathbf{P}_{i+1}$ 求解这些不等式，我们得到两个上界 $\\theta_{i, \\max}$ 和 $\\theta_{i+1, \\max}$。界面 $j$ 的最终混合因子是 $\\theta_j = \\min(\\theta_{i, \\max}, \\theta_{i+1, \\max}, 1.0)$。这种构造确保了混合通量仅在需要时向鲁棒的 HLLE 通量退化，以维持物理容许性。\n\n然后使用这些局部确定的混合通量执行完整的有限体积更新。该过程保持了不变区域 $\\mathcal{G}$，正如任务3对混合格式所要求的那样。\n\n### 数值实现\n\n为了解决这个问题，我们实现以下组件：\n1.  用于在原始变量 $(\\rho, u, p)$ 和守恒变量 $(\\rho, m, E)$ 之间转换的函数。\n2.  用于计算物理通量 $\\mathbf{F}(\\mathbf{U})$、声速 $c$ 和总焓 $H$ 的函数。\n3.  一个用于 Roe 非容许性检查的函数（任务1）。\n4.  用于计算 Roe 通量和 HLLE 通量的函数。\n5.  一个通过求解两个相邻单元的线性和二次不等式来计算界面处保正性混合因子 $\\theta$ 的函数。\n6.  一个主程序，它设置三单元周期性问题，计算时间步长，确定每个界面的 $\\theta$，执行有限体积更新，并检查最终状态的正性。\n\n最终代码将对提供的四个测试案例分别执行此逻辑，并按要求格式化布尔结果。",
            "answer": "```python\nimport numpy as np\n\n# Global constants\nGAMMA = 1.4\nGAMMA_MINUS_1 = GAMMA - 1.0\n\n# --- Primitive and Conservative Variable Conversions ---\ndef prim_to_cons(rho, u, p):\n    \"\"\"Converts primitive variables to conservative variables.\"\"\"\n    m = rho * u\n    E = p / GAMMA_MINUS_1 + 0.5 * rho * u**2\n    return np.array([rho, m, E])\n\ndef cons_to_prim(U):\n    \"\"\"Converts conservative variables to primitive variables.\"\"\"\n    rho, m, E = U\n    if rho = 0:\n        return np.array([rho, 0.0, -1.0]) # Invalid state\n    u = m / rho\n    p = GAMMA_MINUS_1 * (E - 0.5 * m * u)\n    if p = 0:\n        return np.array([rho, u, p]) # Invalid state\n    return np.array([rho, u, p])\n\n# --- Physics Calculations ---\ndef get_flux(U):\n    \"\"\"Computes the Euler flux vector F(U).\"\"\"\n    rho, m, E = U\n    if rho = 0: # Handle non-physical state\n        return np.zeros(3)\n    u = m / rho\n    p = GAMMA_MINUS_1 * (E - 0.5 * m * u)\n    if p  0: p = 0 # Pressure cannot be negative in flux calculation\n    \n    F = np.zeros(3)\n    F[0] = m\n    F[1] = m * u + p\n    F[2] = (E + p) * u\n    return F\n\ndef get_h_and_c(rho, u, p):\n    \"\"\"Computes total enthalpy H and sound speed c.\"\"\"\n    if rho = 0 or p = 0:\n        return 0, 0\n    E = p / GAMMA_MINUS_1 + 0.5 * rho * u**2\n    H = (E + p) / rho\n    c = np.sqrt(GAMMA * p / rho)\n    return H, c\n    \n# --- Task 1: Roe Non-Admissibility Check ---\ndef check_roe_admissibility(prim_L, prim_R):\n    \"\"\"Checks if the Roe intermediate state is non-physical.\"\"\"\n    rho_L, u_L, p_L = prim_L\n    rho_R, u_R, p_R = prim_R\n    \n    U_L = prim_to_cons(rho_L, u_L, p_L)\n    U_R = prim_to_cons(rho_R, u_R, p_R)\n\n    # Roe averages\n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    H_L, _ = get_h_and_c(rho_L, u_L, p_L)\n    H_R, _ = get_h_and_c(rho_R, u_R, p_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq  0:\n        return True # Roe average leads to imaginary sound speed\n\n    tilde_a = np.sqrt(a_sq)\n\n    # Eigenvectors\n    r1 = np.array([1.0, tilde_u - tilde_a, tilde_H - tilde_u * tilde_a])\n    r2 = np.array([1.0, tilde_u, 0.5 * tilde_u**2])\n    r3 = np.array([1.0, tilde_u + tilde_a, tilde_H + tilde_u * tilde_a])\n    R_matrix = np.vstack([r1, r2, r3]).T\n\n    # Solve for wave strengths\n    delta_U = U_R - U_L\n    try:\n        alphas = np.linalg.solve(R_matrix, delta_U)\n    except np.linalg.LinAlgError:\n        return True # Singular matrix, pathological case\n    alpha1, alpha2, _ = alphas\n    \n    # Compute star state as defined in the problem\n    U_star = U_L + alpha1 * r1 + alpha2 * r2\n    \n    # Check positivity\n    _, _, p_star = cons_to_prim(U_star)\n    return U_star[0] = 0 or p_star = 0\n\n# --- Task 2: Positivity-Preserving Blended Flux ---\n\ndef get_roe_flux(U_L, U_R):\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n    \n    if rho_L = 0 or p_L =0 or rho_R = 0 or p_R = 0:\n        # Fallback for non-physical states, e.g. return average flux\n        return 0.5 * (get_flux(U_L) + get_flux(U_R))\n\n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    H_L, _ = get_h_and_c(rho_L, u_L, p_L)\n    H_R, _ = get_h_and_c(rho_R, u_R, p_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq  0: a_sq = 0 # Einfeldt fix\n    tilde_a = np.sqrt(a_sq)\n\n    r1 = np.array([1.0, tilde_u - tilde_a, tilde_H - tilde_u * tilde_a])\n    r2 = np.array([1.0, tilde_u, 0.5 * tilde_u**2])\n    r3 = np.array([1.0, tilde_u + tilde_a, tilde_H + tilde_u * tilde_a])\n    R_matrix = np.vstack([r1, r2, r3]).T\n\n    delta_U = U_R - U_L\n    try:\n        alphas = np.linalg.solve(R_matrix, delta_U)\n    except np.linalg.LinAlgError: # Fallback\n        return 0.5 * (get_flux(U_L) + get_flux(U_R))\n\n    lambda_tilde = np.array([tilde_u - tilde_a, tilde_u, tilde_u + tilde_a])\n    \n    F_L, F_R = get_flux(U_L), get_flux(U_R)\n    dissipation = R_matrix @ (np.diag(np.abs(lambda_tilde)) @ alphas)\n    \n    return 0.5 * (F_L + F_R) - 0.5 * dissipation\n\ndef get_hlle_flux(U_L, U_R):\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n    \n    if rho_L = 0 or p_L =0: return get_flux(U_R)\n    if rho_R = 0 or p_R =0: return get_flux(U_L)\n    \n    H_L, c_L = get_h_and_c(rho_L, u_L, p_L)\n    H_R, c_R = get_h_and_c(rho_R, u_R, p_R)\n    \n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq  0: a_sq = 0\n    tilde_a = np.sqrt(a_sq)\n    \n    S_L = min(u_L - c_L, tilde_u - tilde_a)\n    S_R = max(u_R + c_R, tilde_u + tilde_a)\n\n    F_L, F_R = get_flux(U_L), get_flux(U_R)\n\n    if S_L >= 0: return F_L\n    if S_R = 0: return F_R\n    \n    return (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n\ndef get_positivity_theta(U_base, dU):\n    \"\"\"Calculates max theta in [0,1] for one test state.\"\"\"\n    rho_base, m_base, E_base = U_base\n    drho, dm, dE = dU\n    \n    theta_rho = 1.0\n    if drho  -1e-15: # Avoid division by zero\n        theta_rho = -rho_base / drho\n        if theta_rho  0: theta_rho = 1.0 # Negative root is not a constraint\n    \n    # Quadratic for pressure: A*theta^2 + B*theta + C > 0\n    # C is pressure of base state\n    rho_p, u_p, p_p = cons_to_prim(U_base)\n    if rho_p = 0 or p_p = 0: return 0.0\n\n    C = 2 * E_base * rho_base - m_base**2\n    \n    A = 2 * dE * drho - dm**2\n    B = 2 * (E_base * drho + rho_base * dE) - 2 * m_base * dm\n    \n    theta_p = 1.0\n    \n    if abs(A)  1e-15: # Linear case\n        if B  -1e-15:\n            root = -C / B\n            if root > 0:\n                theta_p = root\n    else: # Quadratic case\n        delta = B**2 - 4 * A * C\n        if delta >= 0:\n            sqrt_delta = np.sqrt(delta)\n            r1 = (-B + sqrt_delta) / (2 * A)\n            r2 = (-B - sqrt_delta) / (2 * A)\n            \n            pos_roots = []\n            if r1 > 1e-15: pos_roots.append(r1)\n            if r2 > 1e-15: pos_roots.append(r2)\n            \n            if len(pos_roots) > 0:\n                root = min(pos_roots)\n                if A > 0: # Parabola opens up, positive outside roots\n                    theta_p = root\n                else: # Parabola opens down, positive between roots\n                    if max(r1,r2)>0:\n                        theta_p = root\n\n    return min(theta_rho, theta_p, 1.0) * 0.999999 # Safety factor\n\ndef run_blended_flux_update(prim_L, prim_R):\n    \"\"\"Runs one step on 3 periodic cells and checks positivity.\"\"\"\n    # Setup\n    dx = 1.0\n    cfl = 0.45\n    \n    U_states_n = [\n        prim_to_cons(*prim_L),\n        prim_to_cons(*prim_R),\n        prim_to_cons(*prim_L)\n    ]\n    \n    # Calculate dt\n    max_wave_speed = 0.0\n    for U in U_states_n:\n        rho, u, p = cons_to_prim(U)\n        if rho = 0 or p = 0: continue\n        _, c = get_h_and_c(rho, u, p)\n        max_wave_speed = max(max_wave_speed, abs(u) + c)\n    if max_wave_speed == 0: return False # Bad IC\n    dt = cfl * dx / max_wave_speed\n    lam = dt / dx\n\n    # Interfaces states: U_i, U_{i+1}\n    interfaces = [(U_states_n[0], U_states_n[1]), (U_states_n[1], U_states_n[2]), (U_states_n[2], U_states_n[0])]\n\n    # Compute blending factors\n    thetas = []\n    for U_L, U_R in interfaces:\n        F_roe = get_roe_flux(U_L, U_R)\n        F_hlle = get_hlle_flux(U_L, U_R)\n        F_R_minus_H = F_roe - F_hlle\n        \n        # Theta for Left Cell (index i)\n        U_base_L = U_L - 2 * lam * (F_hlle - get_flux(U_L))\n        dU_L = -2 * lam * F_R_minus_H\n        theta_L = get_positivity_theta(U_base_L, dU_L)\n\n        # Theta for Right Cell (index i+1)\n        U_base_R = U_R + 2 * lam * (F_hlle - get_flux(U_R))\n        dU_R = 2 * lam * F_R_minus_H\n        theta_R = get_positivity_theta(U_base_R, dU_R)\n\n        thetas.append(min(theta_L, theta_R))\n\n    # Compute blended fluxes\n    fluxes = []\n    for i, (U_L, U_R) in enumerate(interfaces):\n        F_roe = get_roe_flux(U_L, U_R)\n        F_hlle = get_hlle_flux(U_L, U_R)\n        fluxes.append(F_hlle + thetas[i] * (F_roe - F_hlle))\n\n    # Update states\n    U_states_n_plus_1 = [\n        U_states_n[0] - lam * (fluxes[0] - fluxes[2]),\n        U_states_n[1] - lam * (fluxes[1] - fluxes[0]),\n        U_states_n[2] - lam * (fluxes[2] - fluxes[1]),\n    ]\n    \n    # Check positivity of all updated states\n    all_positive = True\n    for U in U_states_n_plus_1:\n        rho, _, p = cons_to_prim(U)\n        if rho = 0 or p = 0:\n            all_positive = False\n            break\n            \n    return all_positive\n    \ndef solve():\n    \"\"\"Main solver function to run test cases.\"\"\"\n    # (rho_L, u_L, p_L; rho_R, u_R, p_R)\n    test_cases = [\n        ((1.0, -100.0, 1e-6), (1.0, 100.0, 1e-6)),         # Case A\n        ((10.0, -60.0, 1e-4), (0.1, 60.0, 1e-6)),          # Case B\n        ((1.0, 0.0, 1.0), (0.125, 0.0, 0.1)),              # Case C\n        ((1e-3, -20.0, 1e-12), (1e-3, 20.0, 1e-12)),       # Case D\n    ]\n    \n    results = []\n    for case in test_cases:\n        prim_L, prim_R = case\n        \n        # Task 1: Check Roe admissibility\n        roe_bad = check_roe_admissibility(prim_L, prim_R)\n        results.append(str(roe_bad).lower())\n        \n        # Task 2: Run blended flux update and check positivity\n        pos_ok = run_blended_flux_update(prim_L, prim_R)\n        results.append(str(pos_ok).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}