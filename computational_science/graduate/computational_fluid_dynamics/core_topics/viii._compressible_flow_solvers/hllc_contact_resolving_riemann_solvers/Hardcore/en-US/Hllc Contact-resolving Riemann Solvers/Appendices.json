{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp the HLLC solver, we must first master its fundamental mechanics. This exercise provides a concrete opportunity to apply the HLLC formulas step-by-step, moving from initial left and right states to a final numerical flux value. By manually computing the wave speeds, intermediate star-region properties, and the final flux, you will build a solid foundation for understanding and implementing this powerful tool. ",
            "id": "3330293",
            "problem": "Consider the one-dimensional Euler equations for an ideal gas with ratio of specific heats $\\gamma$ and conserved variables $U = (\\rho,\\ \\rho u,\\ E)^{\\mathsf{T}}$ governed by the flux $F(U) = \\big(\\rho u,\\ \\rho u^{2} + p,\\ u\\,(E + p)\\big)^{\\mathsf{T}}$, where $E = \\dfrac{p}{\\gamma - 1} + \\dfrac{1}{2}\\,\\rho\\,u^{2}$. The Riemann problem at an interface has left and right primitive states $U_{L} = (\\rho_{L}, u_{L}, p_{L})$ and $U_{R} = (\\rho_{R}, u_{R}, p_{R})$. Assume an ideal gas with speed of sound $a = \\sqrt{\\gamma p/\\rho}$. Let the numerical states be $U_{L} = (\\rho_{L}, u_{L}, p_{L}) = (0.8,\\ 1.0,\\ 0.5)$, $U_{R} = (\\rho_{R}, u_{R}, p_{R}) = (1.2,\\ -0.5,\\ 0.7)$, and $\\gamma = 1.4$.\n\nUsing the Harten–Lax–van Leer–Contact (HLLC) contact-resolving Riemann solver, determine the single scalar equal to the momentum flux component of the HLLC numerical flux at the interface, denoted by the second component of $F_{\\mathrm{HLLC}}(U_{L}, U_{R})$. To make the wave-speed estimates concrete, use the Davis estimates for the bounding signal speeds,\n$S_{L} = \\min\\{u_{L} - a_{L},\\ u_{R} - a_{R}\\}$ and $S_{R} = \\max\\{u_{L} + a_{L},\\ u_{R} + a_{R}\\}$,\nwith $a_{L} = \\sqrt{\\gamma p_{L}/\\rho_{L}}$ and $a_{R} = \\sqrt{\\gamma p_{R}/\\rho_{R}}$. Determine the appropriate HLLC branch based on the signs of the wave speeds, construct the star state and the star flux imposed by the Rankine–Hugoniot conditions across the waves, and then evaluate the momentum flux component of $F_{\\mathrm{HLLC}}$ at the interface.\n\nReport your final numerical answer as a single nondimensional scalar and round your answer to four significant figures.",
            "solution": "The problem requires the determination of the momentum flux component of the Harten–Lax–van Leer–Contact (HLLC) numerical flux, $F_{\\mathrm{HLLC}}$, at the interface for a Riemann problem defined by given left and right states. The governing equations are the one-dimensional Euler equations for an ideal gas.\n\nThe conserved variable vector is $U = (\\rho, \\rho u, E)^{\\mathsf{T}}$ and the flux vector is $F(U) = (\\rho u, \\rho u^2 + p, u(E + p))^{\\mathsf{T}}$. The total energy density $E$ is related to pressure $p$ by the equation of state for an ideal gas: $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2$.\n\nThe HLLC flux $F_{\\mathrm{HLLC}}(U_L, U_R)$ is a piecewise constant function of the ratio $x/t$, defined by the wave speed estimates $S_L$, $S_M$ (contact), and $S_R$. The formula for the HLLC flux is:\n$$\nF_{\\mathrm{HLLC}} =\n\\begin{cases}\nF_L & \\text{if } x/t < S_L \\\\\nF_L^* & \\text{if } S_L \\le x/t < S_M \\\\\nF_R^* & \\text{if } S_M \\le x/t < S_R \\\\\nF_R & \\text{if } x/t \\ge S_R\n\\end{cases}\n$$\nAt the cell interface, we evaluate the flux at $x/t=0$. The specific formula to use depends on the signs of $S_L$, $S_M$, and $S_R$. We must first calculate these wave speeds.\n\nThe given primitive variables are:\nLeft state: $(\\rho_L, u_L, p_L) = (0.8, 1.0, 0.5)$\nRight state: $(\\rho_R, u_R, p_R) = (1.2, -0.5, 0.7)$\nRatio of specific heats: $\\gamma = 1.4$\n\nFirst, we calculate the speed of sound for the left and right states using the formula $a = \\sqrt{\\gamma p / \\rho}$.\n$$ a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{1.4 \\times 0.5}{0.8}} = \\sqrt{0.875} \\approx 0.935414 $$\n$$ a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}} = \\sqrt{\\frac{1.4 \\times 0.7}{1.2}} = \\sqrt{\\frac{0.98}{1.2}} \\approx 0.903696 $$\n\nNext, we calculate the Davis estimates for the fastest left- and right-propagating signal speeds, $S_L$ and $S_R$.\n$$ S_L = \\min\\{u_L - a_L, u_R - a_R\\} = \\min\\{1.0 - 0.935414, -0.5 - 0.903696\\} $$\n$$ S_L = \\min\\{0.064586, -1.403696\\} = -1.403696 $$\n$$ S_R = \\max\\{u_L + a_L, u_R + a_R\\} = \\max\\{1.0 + 0.935414, -0.5 + 0.903696\\} $$\n$$ S_R = \\max\\{1.935414, 0.403696\\} = 1.935414 $$\n\nNow, we calculate the speed of the contact wave, $S_M$. Its formula is derived by enforcing that the pressure in the star regions, $p_L^*$ and $p_R^*$, are equal.\n$$ S_M = \\frac{p_R - p_L + \\rho_L u_L (S_L - u_L) - \\rho_R u_R (S_R - u_R)}{\\rho_L (S_L - u_L) - \\rho_R (S_R - u_R)} $$\nWe compute the terms in the numerator and denominator:\nNumerator:\n$$ N = (0.7 - 0.5) + (0.8)(1.0)( -1.403696 - 1.0) - (1.2)(-0.5)(1.935414 - (-0.5)) $$\n$$ N = 0.2 + 0.8(-2.403696) + 0.6(2.435414) $$\n$$ N = 0.2 - 1.922957 + 1.461248 = -0.261709 $$\nDenominator:\n$$ D = 0.8(-2.403696) - 1.2(2.435414) $$\n$$ D = -1.922957 - 2.922497 = -4.845454 $$\nSo, the contact wave speed is:\n$$ S_M = \\frac{-0.261709}{-4.845454} \\approx 0.054012 $$\n\nWith the wave speeds $S_L \\approx -1.404$, $S_M \\approx 0.054$, and $S_R \\approx 1.935$, we can determine which region contains the interface at $x/t=0$. We observe that $S_L < 0 < S_M$. Therefore, the appropriate flux is the one for the left star region, $F_L^*$.\n\nThe problem asks for the second component of this flux vector, which represents the momentum flux. The flux vector in the star region $K \\in \\{L, R\\}$ is given by $F_K^* = (\\rho_K^* S_M, \\rho_K^* S_M^2 + p^*, S_M(E_K^* + p^*))^{\\mathsf{T}}$, where $u^*=S_M$ and $p^*$ are the uniform velocity and pressure in the star regions. The momentum flux component is the second component:\n$$ (F_L^*)_2 = \\rho_L^* S_M^2 + p^* $$\nWe need to calculate the pressure $p^*$ and the density $\\rho_L^*$ in the left star region.\nThe pressure $p^*$ is given by the Rankine-Hugoniot condition across the $S_L$ wave:\n$$ p^* = p_L + \\rho_L(S_L - u_L)(S_M - u_L) $$\n$$ p^* = 0.5 + 0.8(-1.403696 - 1.0)(0.054012 - 1.0) $$\n$$ p^* = 0.5 + 0.8(-2.403696)(-0.945988) $$\n$$ p^* = 0.5 + 1.819397 \\approx 2.31940 $$\n\nThe density $\\rho_L^*$ is found from the mass conservation jump condition across $S_L$:\n$$ \\rho_L^* = \\rho_L \\frac{S_L - u_L}{S_L - S_M} $$\n$$ \\rho_L^* = 0.8 \\frac{-1.403696 - 1.0}{-1.403696 - 0.054012} = 0.8 \\frac{-2.403696}{-1.457708} $$\n$$ \\rho_L^* = 0.8 \\times 1.64901 \\approx 1.31921 $$\n\nFinally, we compute the momentum flux component:\n$$ (F_L^*)_2 = p^* + \\rho_L^* S_M^2 $$\n$$ (F_L^*)_2 \\approx 2.31940 + (1.31921)(0.054012)^2 $$\n$$ (F_L^*)_2 \\approx 2.31940 + (1.31921)(0.0029173) $$\n$$ (F_L^*)_2 \\approx 2.31940 + 0.003848 $$\n$$ (F_L^*)_2 \\approx 2.323248 $$\nRounding the result to four significant figures gives $2.323$.",
            "answer": "$$\\boxed{2.323}$$"
        },
        {
            "introduction": "The 'C' in HLLC stands for 'Contact,' and its ability to resolve contact discontinuities is its defining advantage over simpler solvers like HLL. This hands-on coding exercise is designed to provide a striking visual and quantitative demonstration of why this feature is so critical, particularly in multi-species or multiphase flows. By intentionally perturbing the contact wave speed estimate $S_M$ and observing the effect on a passively advected scalar, you will directly see how errors in the contact wave lead to non-physical results, thus building a strong intuition for the solver's design. ",
            "id": "3330267",
            "problem": "Consider the one-dimensional compressible Euler equations with an additional passively advected scalar, posed as a conservation law system over the spatial domain $[0,1]$ with time $t \\ge 0$. The unknown vector of conserved variables is $U = [\\rho, \\rho u, E, \\rho Y]^{\\top}$ where $\\rho$ is density, $u$ is velocity, $E$ is total energy density, and $Y \\in [0,1]$ is a dimensionless passive mass fraction. The flux is $F(U) = [\\rho u, \\rho u^{2} + p, u(E + p), \\rho Y u]^{\\top}$ with thermodynamic closure given by the ideal gas law $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^{2}\\right)$, where $\\gamma > 1$ is the ratio of specific heats. The passive scalar $Y$ is transported through the conservative variable $\\rho Y$ and does not affect the dynamics of the Euler subsystem.\n\nYou will implement a first-order finite volume method with the Harten-Lax-van Leer with Contact (HLLC) Riemann solver for the Euler subsystem and consistent conservative fluxing of the passive scalar. The numerical flux at each interface must be the HLLC flux derived from the three-wave Riemann fan with left and right states, using a standard two-sided wave speed bound computed from local signal speeds and a contact wave speed $S_M$. To isolate the role of the contact wave, we study a pure contact discontinuity: both sides have equal pressure and velocity but different density and passive scalar fraction, so the exact solution is a single moving contact at speed $u$ with $Y$ passively advected. In exact arithmetic with an exact contact wave speed estimate, the HLLC solver should not generate passive scalar values outside the initial interval $[Y_{\\min}, Y_{\\max}]$; however, if the contact speed $S_M$ is mis-estimated, conservative updates of $\\rho$ and $\\rho Y$ can become inconsistent and produce bound violations in $Y = (\\rho Y)/\\rho$. We quantify this effect by introducing a controlled perturbation $\\Delta S_M$ to the contact wave speed estimate at every interface and time step, replacing $S_M$ in the HLLC flux by $S_M' = S_M + \\Delta S_M$, where $S_M$ is the standard HLLC contact estimate derived from momentum and pressure balance and $\\Delta S_M$ is a prescribed constant error per test case.\n\nYour implementation must:\n- Discretize the domain with $N$ uniform cells of width $\\Delta x = 1/N$.\n- Use periodic boundary conditions in space.\n- Use an explicit forward Euler time integrator with a Courant-Friedrichs-Lewy (CFL) number of $0.5$ and an adaptive time step $\\Delta t = \\text{CFL}\\cdot \\Delta x / \\max_{i} \\lambda_i$, where $\\lambda_i$ are the local interface signal speeds (take the maximum of the absolute values of the left and right HLL speeds at each interface).\n- For each interface Riemann problem, compute the HLLC flux for the Euler subsystem using left and right conserved states, an ideal gas with given $\\gamma$, Davis-type two-sided estimates for the left and right wave speeds $S_L$ and $S_R$ based on local velocities and sound speeds, and the nominal contact wave speed $S_M$ from pressure and momentum balance in the star region. Then enforce the perturbed contact speed by setting $S_M' = S_M + \\Delta S_M$ and use $S_M'$ consistently in the HLLC star-state and flux formulas for all conserved quantities, including $\\rho Y$.\n- Initialize a single contact discontinuity at $x_0 = 0.5$ with uniform pressure and velocity on both sides, but different densities and passive scalars, as specified in each test case below.\n- Advance to a specified final time $T$ without crossing more than a fraction of the domain to avoid interaction with the second periodic discontinuity.\n\nFor each simulation, define the passive scalar overshoot as follows. Let $Y_{\\text{num}}(x_i, T)$ be the numerical passive scalar in cell $i$ at time $T$, and let $Y_{\\min} = \\min(Y_L, Y_R)$ and $Y_{\\max} = \\max(Y_L, Y_R)$ be the initial physical bounds. Define the non-negative bound violation at cell $i$ as\n$$\n\\delta_i^{+} = \\max\\{\\,Y_{\\text{num}}(x_i,T) - Y_{\\max},\\, 0\\,\\}, \\quad\n\\delta_i^{-} = \\max\\{\\,Y_{\\min} - Y_{\\text{num}}(x_i,T),\\, 0\\,\\}.\n$$\nThen define the scalar overshoot amplitude as\n$$\n\\mathcal{O} = \\max_i \\left( \\max\\{ \\delta_i^{+}, \\delta_i^{-} \\} \\right).\n$$\nTo relate overshoot to the contact speed error, define the normalized sensitivity\n$$\n\\kappa = \\frac{\\mathcal{O}}{|\\Delta S_M| + \\varepsilon},\n$$\nwith $\\varepsilon = 10^{-12}$ to avoid division by zero in the exact-contact case $\\Delta S_M = 0$.\n\nYour task is to implement the above method and compute $(\\mathcal{O}, \\kappa)$ for each of the following five test cases. Use $N = 200$ cells, $\\text{CFL} = 0.5$, and final time $T = 0.001$ seconds for all cases. All physical quantities are in SI units: density in $\\text{kg}/\\text{m}^3$, velocity in $\\text{m}/\\text{s}$, pressure in $\\text{Pa}$, time in $\\text{s}$. The outputs $\\mathcal{O}$ and $\\kappa$ are dimensionless.\n\nTest suite (each case specifies $(\\rho_L, \\rho_R, u, p, Y_L, Y_R, \\gamma, \\Delta S_M)$):\n- Case $1$: $(1.0, 2.0, 200.0, 100000.0, 0.2, 0.8, 1.4, 0.0)$\n- Case $2$: $(1.0, 2.0, 200.0, 100000.0, 0.2, 0.8, 1.4, 50.0)$\n- Case $3$: $(1.0, 2.0, 200.0, 100000.0, 0.2, 0.8, 1.4, -50.0)$\n- Case $4$: $(0.5, 5.0, 50.0, 100000.0, 0.0, 1.0, 1.4, 30.0)$\n- Case $5$: $(1.0, 3.0, 0.0, 100000.0, 0.1, 0.9, 1.4, 30.0)$\n\nAlgorithmic requirements and acceptance criteria:\n- Start from conservation law principles and the ideal gas relation; do not introduce extraneous numerical limiters or post-processing beyond what is stated above.\n- The HLLC Riemann solver must be used for flux computation, with the perturbed contact speed $S_M' = S_M + \\Delta S_M$ applied consistently in the star-state construction and fluxes for all conserved variables.\n- For each test case, report two floats: the overshoot amplitude $\\mathcal{O}$ and the normalized sensitivity $\\kappa$. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[\\mathcal{O}_1, \\kappa_1, \\mathcal{O}_2, \\kappa_2, \\mathcal{O}_3, \\kappa_3, \\mathcal{O}_4, \\kappa_4, \\mathcal{O}_5, \\kappa_5]$.\n\nYour program must be a complete, runnable implementation that produces the required single-line output with no additional text.",
            "solution": "The problem requires the implementation of a first-order finite volume method to solve the one-dimensional Euler equations augmented with a passively advected scalar. The core of the method is the Harten-Lax-van Leer with Contact (HLLC) Riemann solver, where the contact wave speed estimate is intentionally perturbed to study its effect on the positivity of the passive scalar.\n\n### 1. Governing Equations\n\nThe system of conservation laws is given by $\\partial_t U + \\partial_x F(U) = 0$, where $U$ is the vector of conserved variables and $F(U)$ is the flux vector. These are defined as:\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\\\ \\rho Y \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\\\ \\rho u Y \\end{pmatrix}\n$$\nHere, $\\rho$ is the mass density, $u$ is the fluid velocity, $E$ is the total energy per unit volume, and $Y$ is the mass fraction of a passive scalar, with $Y \\in [0, 1]$. The system is closed by the ideal gas equation of state, which relates the pressure $p$ to the conserved variables:\n$$\np = (\\gamma - 1) \\left( E - \\frac{1}{2}\\rho u^2 \\right) = (\\gamma - 1) \\left( E - \\frac{(\\rho u)^2}{2\\rho} \\right)\n$$\nwhere $\\gamma$ is the ratio of specific heats. The fourth equation, $\\partial_t(\\rho Y) + \\partial_x(\\rho u Y) = 0$, describes the passive advection of the scalar $Y$.\n\n### 2. Finite Volume Discretization\n\nThe spatial domain $[0, 1]$ is discretized into $N$ uniform cells, indexed by $i$, each of width $\\Delta x = 1/N$. The cell-averaged conserved quantities at time $t$ are denoted by $U_i(t) \\approx \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} U(x, t) dx$. The semi-discrete finite volume formulation for cell $i$ is:\n$$\n\\frac{dU_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. We use an explicit forward Euler method for time integration:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\nThe time step $\\Delta t$ is chosen adaptively to satisfy the Courant-Friedrichs-Lewy (CFL) condition:\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_{j} |\\lambda_{\\max, j}|}\n$$\nwhere $\\text{CFL}=0.5$ and $|\\lambda_{\\max, j}|$ is the maximum wave speed (in magnitude) over all interfaces $j$.\n\n### 3. The HLLC Riemann Solver\n\nThe numerical flux $F_{i+1/2}$ is computed by solving a Riemann problem at the interface with left state $U_L = U_i^n$ and right state $U_R = U_{i+1}^n$. The HLLC Riemann solver approximates the solution with a three-wave model consisting of a left-propagating wave, a right-propagating wave, and a contact discontinuity moving between them.\n\n#### 3.1. Wave Speed Estimates\nFirst, we convert the left ($L$) and right ($R$) conserved states $U_K$ (where $K \\in \\{L, R\\}$) to primitive variables $W_K = [\\rho_K, u_K, p_K, Y_K]^\\top$. The speed of sound in each state is $c_K = \\sqrt{\\gamma p_K / \\rho_K}$. The speeds of the leftmost ($S_L$) and rightmost ($S_R$) waves are estimated using the Davis formulation:\n$$\nS_L = \\min(u_L - c_L, u_R - c_R)\n$$\n$$\nS_R = \\max(u_L + c_L, u_R + c_R)\n$$\n\n#### 3.2. Perturbed Contact Wave Speed\nThe HLLC solver introduces an intermediate wave, the contact discontinuity, with speed $S_M$. The standard estimate for $S_M$ is derived from momentum and pressure balance across the star region:\n$$\nS_M = \\frac{p_R - p_L + \\rho_L u_L (S_L - u_L) - \\rho_R u_R (S_R - u_R)}{\\rho_L(S_L - u_L) - \\rho_R(S_R - u_R)}\n$$\nFor the specific initial conditions of a pure contact discontinuity ($p_L=p_R$, $u_L=u_R=u$), this formula simplifies to $S_M = u$, which is the exact contact speed. The problem requires introducing a controlled perturbation $\\Delta S_M$ to this estimate. The perturbed contact speed $S_M'$ is used throughout the HLLC flux calculation:\n$$\nS_M' = S_M + \\Delta S_M\n$$\n\n#### 3.3. Star Region States and Fluxes\nThe HLLC approximation defines two intermediate \"star\" states, $U_L^*$ and $U_R^*$, in the regions between the waves. The pressure $p^*$ and velocity $u^*$ are constant in the entire star region, with $u^*=S_M'$. The pressure $p^*$ is found by ensuring consistency of the Rankine-Hugoniot conditions across the left and right waves:\n$$\np^* = p_L + \\rho_L (u_L - S_L)(u_L - S_M') = p_R + \\rho_R(u_R - S_R)(u_R - S_M')\n$$\nWe can calculate $p^*$ using the left state. The star states $U_K^*$ (for $K=L,R$) can then be computed. An efficient way is to first define an auxiliary vector $P^* = [0, p^*, p^*S_M', 0]^\\top$ and then compute:\n$$\nU_K^* = \\frac{S_K U_K - F(U_K) + P^*}{S_K - S_M'}\n$$\nThis formula correctly constructs the star states, including the conserved passive scalar $(\\rho Y)_K^* = \\rho_K^* Y_K$, as $Y_L^* = Y_L, Y_R^* = Y_R$ across the contact wave and the fourth component of $P^*$ is zero. The densities in the star regions are $\\rho_K^* = \\rho_K \\frac{S_K - u_K}{S_K - S_M'}$. When $S_M'$ is not the true contact speed, the updates for $\\rho$ and $\\rho Y$ can become inconsistent, potentially leading to non-physical values of $Y = (\\rho Y)/\\rho$.\n\nThe final HLLC numerical flux, $F_{HLLC}$, is determined by the location of the interface (where speed is $0$) relative to the wave speeds $S_L$, $S_M'$, and $S_R$:\n$$\nF_{HLLC} = \\begin{cases}\n    F_L = F(U_L) & \\text{if } 0 \\le S_L \\\\\n    F_L^* = F_L + S_L(U_L^* - U_L) & \\text{if } S_L < 0 \\le S_M' \\\\\n    F_R^* = F_R + S_R(U_R^* - U_R) & \\text{if } S_M' < 0 \\le S_R \\\\\n    F_R = F(U_R) & \\text{if } S_R < 0\n\\end{cases}\n$$\n\n### 4. Simulation and Analysis\n\nFor each test case, the algorithm proceeds as follows:\n1.  **Initialization**: Set up a piecewise constant initial state on the grid with $N=200$ cells, with the discontinuity at $x=0.5$. The state is $(\\rho_L, u, p, Y_L)$ for cells with centers $x_i < 0.5$ and $(\\rho_R, u, p, Y_R)$ for $x_i \\ge 0.5$. Convert these primitive variables to the vector of conserved variables $U$.\n2.  **Time Marching**: Evolve the system from $t=0$ to the final time $T=0.001$. In each time step:\n    a.  Compute the maximum wave speed $|\\lambda_{\\max}|$ over all interfaces, accounting for periodic boundary conditions.\n    b.  Calculate the time step $\\Delta t$ using the CFL condition.\n    c.  For each interface, compute the HLLC flux $F_{i+1/2}$ using the specified $\\Delta S_M$.\n    d.  Update the state vectors $U_i$ for all cells using the forward Euler method.\n3.  **Post-processing**: At time $T$, calculate the cell-wise passive scalar $Y_{\\text{num}}(x_i, T) = (\\rho Y)_i / \\rho_i$.\n4.  **Metrics Calculation**: Determine the minimum and maximum initial scalar values, $Y_{\\min}$ and $Y_{\\max}$. Compute the overshoot amplitude $\\mathcal{O}$ and the normalized sensitivity $\\kappa$ as defined in the problem statement:\n    $$\n    \\mathcal{O} = \\max_i \\left( \\max\\{ Y_{\\text{num}}(x_i,T) - Y_{\\max}, 0 \\}, \\max\\{ Y_{\\min} - Y_{\\text{num}}(x_i,T), 0 \\} \\right)\n    $$\n    $$\n    \\kappa = \\frac{\\mathcal{O}}{|\\Delta S_M| + \\varepsilon}, \\quad \\text{with } \\varepsilon = 10^{-12}\n    $$\nThe pairs $(\\mathcal{O}, \\kappa)$ are computed for each of the five test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main solver function to run the CFD simulation for all test cases.\n    \"\"\"\n\n    def primitive_to_conserved(W, gamma):\n        \"\"\"Converts primitive variables [rho, u, p, Y] to conserved [rho, rho*u, E, rho*Y].\"\"\"\n        rho, u, p, Y = W\n        U = np.zeros(4)\n        U[0] = rho\n        U[1] = rho * u\n        U[2] = p / (gamma - 1.0) + 0.5 * rho * u**2\n        U[3] = rho * Y\n        return U\n\n    def conserved_to_primitive(U, gamma):\n        \"\"\"Converts conserved variables [rho, rho*u, E, rho*Y] to primitive [rho, u, p, Y].\"\"\"\n        W = np.zeros(4)\n        rho = U[0]\n        if rho <= 0: # Avoid division by zero or negative density\n            return np.array([1e-9, 0.0, 1e-9, 0.0])\n        \n        u = U[1] / rho\n        p = (gamma - 1.0) * (U[2] - 0.5 * rho * u**2)\n        Y = U[3] / rho\n        W[0] = rho\n        W[1] = u\n        W[2] = p if p > 0 else 1e-9\n        W[3] = Y\n        return W\n\n    def get_flux(U, gamma):\n        \"\"\"Computes the flux vector F(U).\"\"\"\n        F = np.zeros(4)\n        rho, u, p, _ = conserved_to_primitive(U, gamma)\n        E = U[2]\n        rhoY = U[3]\n\n        F[0] = rho * u\n        F[1] = rho * u**2 + p\n        F[2] = u * (E + p)\n        F[3] = u * rhoY\n        return F\n\n    def hllc_flux(U_L, U_R, gamma, delta_S_M):\n        \"\"\"Computes the HLLC flux given left and right states.\"\"\"\n        W_L = conserved_to_primitive(U_L, gamma)\n        W_R = conserved_to_primitive(U_R, gamma)\n\n        rho_L, u_L, p_L, Y_L = W_L\n        rho_R, u_R, p_R, Y_R = W_R\n\n        c_L = np.sqrt(gamma * p_L / rho_L)\n        c_R = np.sqrt(gamma * p_R / rho_R)\n\n        # Davis wave speed estimates\n        S_L = min(u_L - c_L, u_R - c_R)\n        S_R = max(u_L + c_L, u_R + c_R)\n        \n        # Nominal contact wave speed\n        num_S_M = p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R)\n        den_S_M = rho_L * (S_L - u_L) - rho_R * (S_R - u_R)\n        S_M = num_S_M / den_S_M if abs(den_S_M) > 1e-9 else (u_L + u_R) / 2.0\n\n        # Perturbed contact wave speed\n        S_M_prime = S_M + delta_S_M\n\n        if 0.0 <= S_L:\n            return get_flux(U_L, gamma)\n        if S_R <= 0.0:\n            return get_flux(U_R, gamma)\n\n        # Pressure in the star region\n        p_star = p_L + rho_L * (u_L - S_L) * (u_L - S_M_prime)\n\n        F_L = get_flux(U_L, gamma)\n        F_R = get_flux(U_R, gamma)\n\n        if S_L < 0.0 <= S_M_prime:\n            P_star_vec = np.array([0., p_star, p_star * S_M_prime, 0.])\n            den = S_L - S_M_prime\n            if abs(den) < 1e-9: den = -1e-9\n            U_L_star = (S_L * U_L - F_L + P_star_vec) / den\n            return F_L + S_L * (U_L_star - U_L)\n        \n        elif S_M_prime < 0.0 <= S_R:\n            P_star_vec = np.array([0., p_star, p_star * S_M_prime, 0.])\n            den = S_R - S_M_prime\n            if abs(den) < 1e-9: den = 1e-9\n            U_R_star = (S_R * U_R - F_R + P_star_vec) / den\n            return F_R + S_R * (U_R_star - U_R)\n            \n        return np.zeros(4) # Should not be reached with proper S_L, S_R estimates\n\n    # Simulation parameters\n    N = 200\n    CFL = 0.5\n    T_final = 0.001\n    epsilon = 1e-12\n    domain_length = 1.0\n    dx = domain_length / N\n\n    test_cases = [\n        # (rho_L, rho_R, u, p, Y_L, Y_R, gamma, delta_S_M)\n        (1.0, 2.0, 200.0, 100000.0, 0.2, 0.8, 1.4, 0.0),\n        (1.0, 2.0, 200.0, 100000.0, 0.2, 0.8, 1.4, 50.0),\n        (1.0, 2.0, 200.0, 100000.0, 0.2, 0.8, 1.4, -50.0),\n        (0.5, 5.0, 50.0, 100000.0, 0.0, 1.0, 1.4, 30.0),\n        (1.0, 3.0, 0.0, 100000.0, 0.1, 0.9, 1.4, 30.0)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        rho_L, rho_R, u_contact, p_contact, Y_L, Y_R, gamma, delta_S_M = case\n\n        # Initial conditions\n        W_L = np.array([rho_L, u_contact, p_contact, Y_L])\n        W_R = np.array([rho_R, u_contact, p_contact, Y_R])\n        U_L = primitive_to_conserved(W_L, gamma)\n        U_R = primitive_to_conserved(W_R, gamma)\n\n        U = np.zeros((4, N))\n        x = (np.arange(N) + 0.5) * dx\n        \n        # Discontinuity at x=0.5\n        U[:, x < 0.5] = U_L[:, np.newaxis]\n        U[:, x >= 0.5] = U_R[:, np.newaxis]\n\n        t = 0.0\n        while t < T_final:\n            max_lambda = 0.0\n            \n            # Calculate max wave speed for dt\n            for i in range(N):\n                U_i = U[:, i]\n                U_j = U[:, (i + 1) % N]\n                W_i = conserved_to_primitive(U_i, gamma)\n                W_j = conserved_to_primitive(U_j, gamma)\n                \n                c_i = np.sqrt(gamma * W_i[2] / W_i[0])\n                c_j = np.sqrt(gamma * W_j[2] / W_j[0])\n\n                s_l_local = min(W_i[1] - c_i, W_j[1] - c_j)\n                s_r_local = max(W_i[1] + c_i, W_j[1] + c_j)\n                max_lambda = max(max_lambda, abs(s_l_local), abs(s_r_local))\n            \n            dt = CFL * dx / max_lambda if max_lambda > 0 else T_final\n            if t + dt > T_final:\n                dt = T_final - t\n            \n            # Compute fluxes at interfaces\n            fluxes = np.zeros((4, N))\n            for i in range(N):\n                U_i_L = U[:, i]\n                U_i_R = U[:, (i + 1) % N]\n                fluxes[:, i] = hllc_flux(U_i_L, U_i_R, gamma, delta_S_M)\n            \n            # Update states\n            U_next = np.copy(U)\n            for i in range(N):\n                flux_L = fluxes[:, (i - 1 + N) % N]\n                flux_R = fluxes[:, i]\n                U_next[:, i] = U[:, i] - (dt / dx) * (flux_R - flux_L)\n            \n            U = U_next\n            t += dt\n\n        # Post-processing\n        Y_num = U[3, :] / U[0, :]\n        Y_min_init = min(Y_L, Y_R)\n        Y_max_init = max(Y_L, Y_R)\n\n        overshoot = np.maximum(Y_num - Y_max_init, 0.0)\n        undershoot = np.maximum(Y_min_init - Y_num, 0.0)\n        \n        O = np.max(np.maximum(overshoot, undershoot))\n        kappa = O / (abs(delta_S_M) + epsilon)\n        \n        results.extend([O, kappa])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "An approximate Riemann solver is just one component of a modern finite-volume scheme; its performance is inextricably linked to the spatial reconstruction method used to define the states at cell interfaces. This practice explores the synergy between the HLLC flux and high-order reconstruction techniques in preserving the sharpness of contact discontinuities. By implementing a simplified one-step solver, you will quantify and compare the numerical diffusion produced by different reconstruction schemes—from first-order to advanced methods like PPM and WENO5—isolating how accuracy is achieved in practice. ",
            "id": "3330283",
            "problem": "You are asked to construct a conservative, finite-volume, one-step update for the one-dimensional Euler equations using the Harten-Lax-van Leer-Contact (HLLC) Riemann solver, and to quantify the numerical diffusion of the HLLC flux across a pure contact discontinuity under different interface reconstructions. The scenario is a pure contact discontinuity, where the left and right states satisfy $p_L = p_R$, $u_L = u_R$, and $\\rho_L \\neq \\rho_R$. The reconstruction variants to be compared are the Piecewise Parabolic Method (PPM) and the fifth-order Weighted Essentially Non-Oscillatory (WENO5) scheme. To isolate the flux contribution to smearing, restrict reconstruction of pressure and velocity to spatially constant values (equal to their initial uniform values), and reconstruct only the density field. All quantities are dimensionless.\n\nStart from the one-dimensional Euler equations with an ideal gas equation of state,\n$$\n\\frac{\\partial }{\\partial t}\n\\begin{bmatrix}\n\\rho \\\\ \\rho u \\\\ E\n\\end{bmatrix}\n+\n\\frac{\\partial }{\\partial x}\n\\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu (E + p)\n\\end{bmatrix}\n= 0,\n\\qquad\np = (\\gamma - 1) \\left( E - \\frac{1}{2} \\rho u^2 \\right),\n$$\nwhere $\\rho$ is the density, $u$ is the velocity, $p$ is the pressure, $E$ is the total energy density, and $\\gamma$ is the ratio of specific heats. The ideal gas law and conservation form above are the fundamental base.\n\nThe HLLC solver must be derived from the Rankine-Hugoniot jump conditions and wave-speed estimates consistent with these equations. For a face between a left state $(\\rho_L, u_L, p_L)$ and a right state $(\\rho_R, u_R, p_R)$, use physically sound estimates for the left and right wave speeds, $S_L$ and $S_R$, and the contact speed $S_M$, to construct the star states and the HLLC flux. Employ a single forward-Euler time update,\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}_{i+\\frac{1}{2}} - \\mathbf{F}_{i-\\frac{1}{2}} \\right),\n$$\nwhere $\\mathbf{U}_i = [\\rho_i, (\\rho u)_i, E_i]^{\\mathsf{T}}$ denotes the cell-average conservative variables, $\\mathbf{F}_{i\\pm\\frac{1}{2}}$ are the HLLC fluxes at faces, $\\Delta x$ is the uniform grid spacing, and $\\Delta t$ is selected by a Courant-Friedrichs-Lewy (CFL) criterion using the maximum characteristic speed. Assume periodic boundary conditions over $x \\in [0,1]$.\n\nInterface reconstruction policies must be:\n- Flux-only baseline (first order): piecewise-constant reconstruction, i.e., $\\rho_{i+\\frac{1}{2}}^- = \\rho_i$ and $\\rho_{i+\\frac{1}{2}}^+ = \\rho_{i+1}$.\n- Piecewise Parabolic Method (PPM): a fourth-order face interpolation with monotonicity clipping for $\\rho$, i.e., an unconstrained interface value\n$$\n\\rho_{i+\\frac{1}{2}}^{(0)} = \\frac{7}{12}\\left(\\rho_i + \\rho_{i+1}\\right) - \\frac{1}{12}\\left(\\rho_{i-1} + \\rho_{i+2}\\right),\n$$\nis computed and then clipped into $[\\min(\\rho_i,\\rho_{i+1}), \\max(\\rho_i,\\rho_{i+1})]$ as the left state $\\rho_{i+\\frac{1}{2}}^-$; compute the right state analogously from cell $i+1$.\n- Weighted Essentially Non-Oscillatory (WENO5): the Jiang-Shu fifth-order WENO reconstruction, using three candidate polynomials with smoothness indicators and nonlinear weights to obtain $\\rho_{i+\\frac{1}{2}}^-$ and a symmetric stencil to obtain $\\rho_{i+\\frac{1}{2}}^+$.\n\nPressure and velocity reconstructions are held constant and equal to their initial uniform values, i.e., $u(x,t) \\equiv u_0$ and $p(x,t) \\equiv p_0$, for all faces. This isolates the density reconstruction as the only source of spatial variation seen by the Riemann solver and thus isolates the flux contribution to smearing.\n\nDefine a diagnostic for numerical diffusion relative to the exact advected contact after one time step. The exact solution for the pure contact is a translation of the initial density step at speed $u_0$,\n$$\n\\rho_{\\text{exact}}(x, t+\\Delta t) =\n\\begin{cases}\n\\rho_L, & x < x_0 + u_0 \\Delta t \\ (\\text{mod }1), \\\\\n\\rho_R, & x \\ge x_0 + u_0 \\Delta t \\ (\\text{mod }1),\n\\end{cases}\n$$\nwith cell-average treatment at the single cell where the discontinuity lies inside the cell. Let the normalized $L^1$ discrepancy\n$$\nD = \\frac{1}{N \\, |\\Delta \\rho|} \\sum_{i=0}^{N-1} \\left| \\rho_i^{\\text{num}} - \\rho_i^{\\text{exact}} \\right|,\n\\qquad \\Delta \\rho = \\rho_R - \\rho_L,\n$$\nquantify the diffusion after one step, where $N$ is the number of cells, $\\rho_i^{\\text{num}}$ are the numerical cell-averages at time $t+\\Delta t$, and $\\rho_i^{\\text{exact}}$ are the exact advected cell-averages at the same time. This $D$ is dimensionless.\n\nImplement the program to compute $D$ for three reconstruction choices: flux-only baseline, PPM, and WENO5, for each test case in the test suite below. Use a single forward-Euler step from the initial condition. Use periodic boundary conditions and choose $\\Delta t$ using the CFL condition\n$$\n\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{\\max_j \\left( \\max\\left( |S_L|, |S_R| \\right)_j \\right)},\n$$\nwhere the maximum is taken over all faces.\n\nTest Suite (all quantities dimensionless):\n- Case $1$: $\\gamma = 1.4$, $N = 200$, $p_0 = 1.0$, $u_0 = 0.2$, $\\rho_L = 1.0$, $\\rho_R = 2.0$, $x_0 = 0.5$, $\\text{CFL} = 0.45$.\n- Case $2$ (stationary contact): $\\gamma = 1.4$, $N = 200$, $p_0 = 1.0$, $u_0 = 0.0$, $\\rho_L = 1.0$, $\\rho_R = 2.0$, $x_0 = 0.25$, $\\text{CFL} = 0.45$.\n- Case $3$ (supersonic advection): $\\gamma = 1.4$, $N = 200$, $p_0 = 1.0$, $u_0 = 1.5$, $\\rho_L = 0.8$, $\\rho_R = 1.6$, $x_0 = 0.5$, $\\text{CFL} = 0.45$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n\\left[ D_{\\text{flux}}, D_{\\text{PPM}}, D_{\\text{WENO}}, D_{\\text{flux}}, D_{\\text{PPM}}, D_{\\text{WENO}}, D_{\\text{flux}}, D_{\\text{PPM}}, D_{\\text{WENO}} \\right],\n$$\ncorresponding to Cases $1$, $2$, and $3$, respectively. Express each $D$ as a float rounded to eight decimal places, in dimensionless units.",
            "solution": "This solution implements the specified numerical scheme to solve the problem.\n\n### 1. Solution Derivation\n\nThe solution proceeds by implementing the specified numerical scheme.\n\n**1. Governing Equations and State Vector**\n\nThe system is governed by the 1D Euler equations in conservation form:\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0\n$$\nwhere the state vector $\\mathbf{U}$ and flux vector $\\mathbf{F}(\\mathbf{U})$ are:\n$$\n\\mathbf{U} = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\qquad\n\\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix}\n$$\nThe equation of state for an ideal gas connects pressure $p$, density $\\rho$, velocity $u$, and total energy density $E$:\n$$\np = (\\gamma - 1) \\left( E - \\frac{1}{2} \\rho u^2 \\right)\n$$\n\n**2. Finite Volume Discretization**\n\nA uniform grid with $N$ cells of width $\\Delta x = 1/N$ is used. The cell centers are $x_i = (i+0.5)\\Delta x$. The cell-averaged state is $\\mathbf{U}_i(t) \\approx \\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} \\mathbf{U}(x,t) dx$. The semi-discrete finite volume scheme is:\n$$\n\\frac{d\\mathbf{U}_i}{dt} = -\\frac{1}{\\Delta x} \\left( \\mathbf{F}_{i+\\frac{1}{2}} - \\mathbf{F}_{i-\\frac{1}{2}} \\right)\n$$\nwhere $\\mathbf{F}_{i\\pm\\frac{1}{2}}$ are the numerical fluxes at the cell interfaces. A single forward-Euler step is used for time integration:\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}_{i+\\frac{1}{2}} - \\mathbf{F}_{i-\\frac{1}{2}} \\right)\n$$\n\n**3. HLLC Riemann Solver for a Pure Contact**\n\nThe HLLC flux at an interface $i+1/2$ depends on the reconstructed states to the left, $\\mathbf{U}_L$, and right, $\\mathbf{U}_R$. A crucial simplification arises from the specific problem setup. The states at any interface are $(\\rho_L, u_0, p_0)$ and $(\\rho_R, u_0, p_0)$, constituting a pure contact discontinuity. The HLLC solver correctly identifies the contact speed as the material velocity, $S_M = u_0$. For a pure contact, the HLLC flux collapses to a simple upwind flux based on the sign of $S_M = u_0$:\n$$\n\\mathbf{F}^{\\text{HLLC}}_{i+\\frac{1}{2}} =\n\\begin{cases}\n\\mathbf{F}(\\mathbf{U}_L) & \\text{if } u_0 \\ge 0 \\\\\n\\mathbf{F}(\\mathbf{U}_R) & \\text{if } u_0 < 0\n\\end{cases}\n$$\nHere, $\\mathbf{U}_L$ and $\\mathbf{U}_R$ are constructed using the reconstructed densities $\\rho_{i+1/2}^-$ and $\\rho_{i+1/2}^+$, respectively, along with the constant pressure $p_0$ and velocity $u_0$.\n\n**4. Spatial Reconstruction of Density**\n\nThe left and right states of density at interface $i+1/2$, denoted $\\rho_{i+1/2}^-$ and $\\rho_{i+1/2}^+$, are obtained via one of three methods. Periodic boundary conditions are handled using modulo arithmetic on indices.\n\n- **Flux-only (1st order)**: Piecewise constant states.\n  $$ \\rho_{i+1/2}^- = \\rho_i, \\quad \\rho_{i+1/2}^+ = \\rho_{i+1} $$\n- **PPM (4th order with clipping)**: As defined in the problem, the unconstrained value is first computed and then clipped to the range of its neighboring cell-averages.\n- **WENO5 (5th order)**: The Jiang-Shu formulation is used. For $\\rho_{i+1/2}^-$, three candidate values are computed from stencils of neighboring cells. Smoothness indicators $\\beta_k$ are calculated and combined with ideal weights to form non-linear weights $\\omega_k$. The final value is a weighted average of the candidates. The right state $\\rho_{i+1/2}^+$ is computed symmetrically.\n\n**5. Initial Conditions, Time Step, and Diagnostic**\n\n- **Initial State**: The initial step function in density implies initial cell averages $\\rho_i^0$ that are $\\rho_L$, $\\rho_R$, or a weighted average in the single cell containing the discontinuity at $x_0$.\n- **Time Step**: The time step $\\Delta t$ is calculated for each reconstruction method using the specified CFL condition and the maximum wave speed across all interfaces, which depends on the reconstructed densities.\n- **Exact Solution and Diffusion Metric**: After one time step, the exact position of the contact is $x_{\\text{disc}} = (x_0 + u_0 \\Delta t) \\pmod 1$. The cell-averaged exact solution $\\rho_i^{\\text{exact}}$ is computed based on this new position. The numerical diffusion $D$ is then calculated using the provided $L^1$ norm formula. For the stationary case ($u_0=0$), the flux difference is zero, so $\\mathbf{U}^{n+1} = \\mathbf{U}^n$ and $D=0$.\n\nThe following program implements this entire procedure, calculating the diffusion metric $D$ for each reconstruction scheme and test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs a 1D Euler finite-volume solver with an HLLC flux function\n    to quantify numerical diffusion of a pure contact discontinuity under\n    different density reconstruction schemes (1st order, PPM, WENO5).\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Subsonic advection\n        {'gamma': 1.4, 'N': 200, 'p0': 1.0, 'u0': 0.2, 'rho_L': 1.0, 'rho_R': 2.0, 'x0': 0.5, 'CFL': 0.45},\n        # Case 2: Stationary contact\n        {'gamma': 1.4, 'N': 200, 'p0': 1.0, 'u0': 0.0, 'rho_L': 1.0, 'rho_R': 2.0, 'x0': 0.25, 'CFL': 0.45},\n        # Case 3: Supersonic advection\n        {'gamma': 1.4, 'N': 200, 'p0': 1.0, 'u0': 1.5, 'rho_L': 0.8, 'rho_R': 1.6, 'x0': 0.5, 'CFL': 0.45},\n    ]\n\n    all_results = []\n    reconstruction_methods = ['flux', 'ppm', 'weno5']\n\n    for case in test_cases:\n        N = case['N']\n        dx = 1.0 / N\n        x = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n        \n        # Get initial cell-averaged density\n        rho_initial = get_cell_averaged_ic(case['rho_L'], case['rho_R'], case['x0'], N)\n        \n        for method in reconstruction_methods:\n            # For stationary case, flux is zero, no change in state, so diffusion is zero\n            if case['u0'] == 0.0:\n                all_results.append(0.0)\n                continue\n\n            # 1. Reconstruct interface states for density\n            rho_l, rho_r = reconstruct(rho_initial, N, method)\n\n            # 2. Calculate time step based on CFL condition\n            dt = calculate_dt(rho_l, rho_r, case['gamma'], case['p0'], case['u0'], case['CFL'], dx)\n\n            # 3. Calculate numerical fluxes at interfaces\n            # Problem simplifies to upwinding based on u0\n            if case['u0'] >= 0:\n                rho_flux_face = rho_l\n            else:\n                rho_flux_face = rho_r\n            \n            p0 = case['p0']\n            u0 = case['u0']\n            gamma = case['gamma']\n            \n            E_flux_face = p0 / (gamma - 1.0) + 0.5 * rho_flux_face * u0**2\n            \n            flux_mass = rho_flux_face * u0\n            flux_momentum = rho_flux_face * u0**2 + p0\n            flux_energy = u0 * (E_flux_face + p0)\n            \n            # Combine into a flux vector array\n            F = np.vstack([flux_mass, flux_momentum, flux_energy])\n\n            # 4. Perform single forward-Euler step\n            U_initial = state_from_prim(rho_initial, u0, p0, gamma)\n            \n            F_iph = F\n            F_imh = np.roll(F, 1, axis=1) # F_{i-1/2}\n\n            U_final = U_initial - (dt / dx) * (F_iph - F_imh)\n            rho_final, _, _ = prim_from_state(U_final, gamma)\n\n            # 5. Calculate exact solution and diffusion metric\n            rho_exact_final = get_cell_averaged_ic(case['rho_L'], case['rho_R'], case['x0'] + u0 * dt, N)\n            \n            delta_rho = case['rho_R'] - case['rho_L']\n            diffusion_metric = np.sum(np.abs(rho_final - rho_exact_final)) / (N * np.abs(delta_rho))\n            \n            all_results.append(diffusion_metric)\n\n    # Format and print results\n    formatted_results = [f\"{r:.8f}\" for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef get_cell_averaged_ic(rho_L, rho_R, x_disc, N):\n    dx = 1.0 / N\n    x_interfaces = np.linspace(0, 1, N + 1)\n    x_disc_mod = x_disc % 1.0\n    \n    rho_ic = np.zeros(N)\n    for i in range(N):\n        left_edge = x_interfaces[i]\n        right_edge = x_interfaces[i+1]\n        \n        if x_disc_mod <= left_edge or x_disc_mod > right_edge:\n            # Disc is outside the cell\n            if (left_edge + right_edge) / 2 < x_disc_mod:\n                 rho_ic[i] = rho_L if rho_L < rho_R else rho_R # Handle wraparound case\n            else:\n                 rho_ic[i] = rho_R if rho_L < rho_R else rho_L\n            # A bit more robust for periodic BC case\n            mid_point = (left_edge + right_edge) / 2.0\n            dist1 = min(abs(mid_point-x_disc_mod), 1-abs(mid_point-x_disc_mod))\n            dist2 = min(abs(mid_point-(x_disc_mod-1)), 1-abs(mid_point-(x_disc_mod-1)))\n            dist3 = min(abs(mid_point-(x_disc_mod+1)), 1-abs(mid_point-(x_disc_mod+1)))\n            \n            if dist1 < dist2 and dist1 < dist3:\n                rho_ic[i] = rho_R if mid_point > x_disc_mod else rho_L\n            elif dist2 < dist3:\n                rho_ic[i] = rho_R if mid_point > (x_disc_mod-1) else rho_L\n            else:\n                rho_ic[i] = rho_R if mid_point > (x_disc_mod+1) else rho_L\n\n        else: # Disc is inside the cell\n            rho_ic[i] = (rho_L * (x_disc_mod - left_edge) + rho_R * (right_edge - x_disc_mod)) / dx\n\n    return rho_ic\n\ndef reconstruct(rho, N, method):\n    rho_padded = np.zeros(N + 6)\n    rho_padded[3:-3] = rho\n    rho_padded[0:3] = rho[N-3:]\n    rho_padded[-3:] = rho[0:3]\n\n    rho_l = np.zeros(N)\n    rho_r = np.zeros(N)\n\n    if method == 'flux':\n        rho_l = rho\n        rho_r = np.roll(rho, -1)\n    \n    elif method == 'ppm':\n        for i in range(N):\n            # Stencil indices in padded array\n            im1, i0, i1, i2, i3 = i+2, i+3, i+4, i+5, i+6\n            \n            # Left state at i+1/2\n            v_im1, v_i0, v_i1, v_i2 = rho_padded[im1-1], rho_padded[i0-1], rho_padded[i1-1], rho_padded[i2-1]\n            unc_l = (7.0/12.0) * (v_i0 + v_i1) - (1.0/12.0) * (v_im1 + v_i2)\n            rho_l[i] = np.clip(unc_l, min(v_i0, v_i1), max(v_i0, v_i1))\n            \n            # Right state at i+1/2 (stencil shifted by +1)\n            v_i0, v_i1, v_i2, v_i3 = rho_padded[i0-1], rho_padded[i1-1], rho_padded[i2-1], rho_padded[i3-1]\n            unc_r = (7.0/12.0) * (v_i1 + v_i2) - (1.0/12.0) * (v_i0 + v_i3)\n            rho_r[i] = np.clip(unc_r, min(v_i1, v_i2), max(v_i1, v_i2))\n\n    elif method == 'weno5':\n        epsilon = 1e-40 # Use larger epsilon to avoid issues in smooth regions\n        \n        # Left-biased reconstruction for rho_{i+1/2}^-\n        v_im2 = np.roll(rho, 2)\n        v_im1 = np.roll(rho, 1)\n        v_i = rho\n        v_ip1 = np.roll(rho, -1)\n        v_ip2 = np.roll(rho, -2)\n\n        p0 = (2.0/6.0)*v_im2 - (7.0/6.0)*v_im1 + (11.0/6.0)*v_i\n        p1 = -(1.0/6.0)*v_im1 + (5.0/6.0)*v_i + (2.0/6.0)*v_ip1\n        p2 = (2.0/6.0)*v_i + (5.0/6.0)*v_ip1 - (1.0/6.0)*v_ip2\n\n        beta0 = (13.0/12.0)*(v_im2 - 2*v_im1 + v_i)**2 + 0.25*(v_im2 - 4*v_im1 + 3*v_i)**2\n        beta1 = (13.0/12.0)*(v_im1 - 2*v_i + v_ip1)**2 + 0.25*(v_im1 - v_ip1)**2\n        beta2 = (13.0/12.0)*(v_i - 2*v_ip1 + v_ip2)**2 + 0.25*(3*v_i - 4*v_ip1 + v_ip2)**2\n\n        d0, d1, d2 = 0.1, 0.6, 0.3\n        \n        alpha0 = d0 / (epsilon + beta0)**2\n        alpha1 = d1 / (epsilon + beta1)**2\n        alpha2 = d2 / (epsilon + beta2)**2\n        \n        sum_alpha = alpha0 + alpha1 + alpha2\n        w0, w1, w2 = alpha0/sum_alpha, alpha1/sum_alpha, alpha2/sum_alpha\n        \n        rho_l = w0*p0 + w1*p1 + w2*p2\n        \n        # Right-biased reconstruction for rho_{i+1/2}^+\n        v_im1 = np.roll(rho, 2)\n        v_i = np.roll(rho, 1)\n        v_ip1 = rho\n        v_ip2 = np.roll(rho, -1)\n        v_ip3 = np.roll(rho, -2)\n\n        p0_r = (11.0/6.0)*v_ip1 - (7.0/6.0)*v_ip2 + (2.0/6.0)*v_ip3\n        p1_r = (2.0/6.0)*v_i + (5.0/6.0)*v_ip1 - (1.0/6.0)*v_ip2\n        p2_r = -(1.0/6.0)*v_im1 + (5.0/6.0)*v_i + (2.0/6.0)*v_ip1\n        \n        d0_r, d1_r, d2_r = 0.3, 0.6, 0.1 # Symmetric weights\n        br0 = (13.0/12.0)*(v_ip1 - 2*v_ip2 + v_ip3)**2 + 0.25*(3*v_ip1 - 4*v_ip2 + v_ip3)**2\n        br1 = (13.0/12.0)*(v_i - 2*v_ip1 + v_ip2)**2 + 0.25*(v_i - v_ip2)**2\n        br2 = (13.0/12.0)*(v_im1 - 2*v_i + v_ip1)**2 + 0.25*(v_im1 - 4*v_i + 3*v_ip1)**2\n        \n        ar0 = d0_r / (epsilon + br0)**2\n        ar1 = d1_r / (epsilon + br1)**2\n        ar2 = d2_r / (epsilon + br2)**2\n        \n        sum_ar = ar0 + ar1 + ar2\n        wr0, wr1, wr2 = ar0/sum_ar, ar1/sum_ar, ar2/sum_ar\n        \n        rho_r = wr0*p0_r + wr1*p1_r + wr2*p2_r\n        # The right reconstruction rho_r is for interface i-1/2. We need it for i+1/2.\n        # This means rho_r at i becomes rho_r at i+1/2 by rolling.\n        rho_r = np.roll(rho_r, -1)\n\n    return rho_l, rho_r\n\ndef calculate_dt(rho_l, rho_r, gamma, p0, u0, cfl, dx):\n    a_l = np.sqrt(gamma * p0 / rho_l)\n    a_r = np.sqrt(gamma * p0 / rho_r)\n    max_a = np.maximum(a_l, a_r)\n    \n    s_l_abs = np.abs(u0 - max_a)\n    s_r_abs = np.abs(u0 + max_a)\n    \n    max_speed_per_interface = np.maximum(s_l_abs, s_r_abs)\n    global_max_speed = np.max(max_speed_per_interface)\n    \n    return cfl * dx / global_max_speed\n\ndef state_from_prim(rho, u, p, gamma):\n    U = np.zeros((3, len(rho)))\n    U[0, :] = rho\n    U[1, :] = rho * u\n    U[2, :] = p / (gamma - 1.0) + 0.5 * rho * u**2\n    return U\n\ndef prim_from_state(U, gamma):\n    rho = U[0, :]\n    u = U[1, :] / rho\n    p = (gamma - 1.0) * (U[2, :] - 0.5 * rho * u**2)\n    return rho, u, p\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}