{
    "hands_on_practices": [
        {
            "introduction": "This first practice grounds our understanding in a continuous, analytical setting. We will derive and solve the Poisson equation for a pressure-like field that projects a given non-divergence-free velocity field onto the space of incompressible flows. This exercise clarifies the mathematical origin of the pressure-Poisson equation that is central to projection methods in computational fluid dynamics. ",
            "id": "3380231",
            "problem": "Consider a nondimensional, two-dimensional, periodic domain $\\Omega = [0,2\\pi] \\times [0,2\\pi]$ with periodic boundary conditions on all sides. Let $\\boldsymbol{u}(x,y)$ be a prescribed velocity field that is not divergence-free and suppose we wish to determine the pressure-like correction that enforces the incompressible continuity equation. Starting from the incompressible continuity constraint $\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0$ and the fact that pressure acts to enforce this constraint by providing a gradient correction, require that the corrected velocity $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$ be divergence-free. Impose periodic boundary conditions and the zero spatial mean constraint $\\int_{\\Omega} \\phi \\, \\mathrm{d}\\boldsymbol{x} = 0$ to fix the uniqueness of $\\phi$.\n\nFor the specific velocity field\n$$\n\\boldsymbol{u}(x,y) = \\begin{pmatrix} A \\cos(x)\\,\\sin(y) \\\\ B \\sin(x)\\,\\cos(y) \\end{pmatrix},\n$$\nwith real constants $A$ and $B$, perform the following:\n\n1. Derive, from the continuity constraint and the stated boundary conditions, the governing equation for the scalar field $\\phi(x,y)$ such that $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$ is divergence-free on $\\Omega$.\n2. Solve for the explicit analytic expression of $\\phi(x,y)$ that satisfies the periodic boundary conditions and the zero-mean constraint.\n3. Using the definition of the $L^{2}$ norm $\\|f\\|_{L^{2}(\\Omega)} = \\left( \\int_{\\Omega} |f|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2}$, compute the reduction \n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} - \\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)}.\n$$\n\nExpress your final answer as a two-component row vector in analytic form, where the first component is the function $\\phi(x,y)$ and the second component is the scalar $\\Delta$. No rounding is required.",
            "solution": "The problem will be validated by first extracting the given information and then checking it against criteria for scientific soundness, well-posedness, and objectivity.\n\n### Step 1: Extract Givens\n-   Domain of interest: A two-dimensional, periodic domain $\\Omega = [0,2\\pi] \\times [0,2\\pi]$.\n-   Boundary conditions: Periodic on all sides.\n-   Prescribed velocity field: $\\boldsymbol{u}(x,y)$.\n-   Corrected velocity field: $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$, where $\\phi$ is a scalar field.\n-   Incompressibility constraint for the corrected field: $\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0$.\n-   Uniqueness constraint for the scalar field: $\\int_{\\Omega} \\phi \\, \\mathrm{d}\\boldsymbol{x} = 0$.\n-   Specific form of the prescribed velocity field: $\\boldsymbol{u}(x,y) = \\begin{pmatrix} A \\cos(x)\\,\\sin(y) \\\\ B \\sin(x)\\,\\cos(y) \\end{pmatrix}$, with $A$ and $B$ being real constants.\n-   Definition of the $L^{2}$ norm: $\\|f\\|_{L^{2}(\\Omega)} = \\left( \\int_{\\Omega} |f|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2}$.\n-   Quantity to compute: The reduction $\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} - \\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)}$.\n-   Required output: A two-component row vector containing the analytic expression for $\\phi(x,y)$ and the value of $\\Delta$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a standard procedure in computational fluid dynamics known as a projection method, specifically for enforcing the incompressibility constraint on a velocity field. This is a form of Helmholtz-Hodge decomposition.\n-   **Scientifically Grounded:** The problem is firmly based on fundamental principles of vector calculus and partial differential equations as applied to fluid dynamics. The use of a scalar potential $\\phi$ (physically related to pressure) to project a velocity field onto a divergence-free space is a cornerstone of algorithms for solving the incompressible Navier-Stokes equations.\n-   **Well-Posed:** The problem requires deriving and solving a Poisson equation for $\\phi$. The source term for this equation is $\\nabla \\cdot \\boldsymbol{u}$. For a Poisson equation on a periodic domain, a solution exists if and only if the integral of the source term over the domain is zero. Let's verify this compatibility condition:\n    $$ \\int_{\\Omega} (\\nabla \\cdot \\boldsymbol{u}) \\, \\mathrm{d}\\boldsymbol{x} = \\oint_{\\partial \\Omega} \\boldsymbol{u} \\cdot \\boldsymbol{n} \\, \\mathrm{d}s $$\n    by the Divergence Theorem, where $\\partial \\Omega$ is the boundary of the domain and $\\boldsymbol{n}$ is the outward normal vector. Due to the periodic boundary conditions, the flux $\\boldsymbol{u} \\cdot \\boldsymbol{n}$ on any side of the rectangular domain is equal and opposite to the flux on the opposing side, causing the boundary integral to be exactly zero. Thus, the compatibility condition is met. The additional constraint $\\int_{\\Omega} \\phi \\, \\mathrm{d}\\boldsymbol{x} = 0$ removes the ambiguity of adding an arbitrary constant to the solution, ensuring a unique solution for $\\phi$. The problem is well-posed.\n-   **Objective and Complete:** The problem is stated using precise mathematical language, and all necessary components (equations, fields, constraints, domain, boundary conditions) are provided.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Part 1: Derivation of the Governing Equation for $\\phi(x,y)$\nThe corrected velocity field $\\boldsymbol{u}^{\\star}$ is required to be divergence-free. The definition of $\\boldsymbol{u}^{\\star}$ is given as $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$.\nThe continuity constraint is:\n$$\n\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0\n$$\nSubstituting the expression for $\\boldsymbol{u}^{\\star}$:\n$$\n\\nabla \\cdot (\\boldsymbol{u} - \\nabla \\phi) = 0\n$$\nUsing the linearity of the divergence operator:\n$$\n\\nabla \\cdot \\boldsymbol{u} - \\nabla \\cdot (\\nabla \\phi) = 0\n$$\nThe divergence of the gradient of a scalar field is the Laplacian operator, $\\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi$. Therefore, the governing equation for $\\phi$ is the Poisson equation:\n$$\n\\nabla^2 \\phi = \\nabla \\cdot \\boldsymbol{u}\n$$\nNext, we compute the source term, $\\nabla \\cdot \\boldsymbol{u}$, for the given velocity field $\\boldsymbol{u}(x,y) = \\begin{pmatrix} A \\cos(x)\\,\\sin(y) \\\\ B \\sin(x)\\,\\cos(y) \\end{pmatrix}$.\nLet $u_x(x,y) = A \\cos(x)\\,\\sin(y)$ and $u_y(x,y) = B \\sin(x)\\,\\cos(y)$.\n$$\n\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial u_x}{\\partial x} + \\frac{\\partial u_y}{\\partial y} = \\frac{\\partial}{\\partial x} (A \\cos(x)\\,\\sin(y)) + \\frac{\\partial}{\\partial y} (B \\sin(x)\\,\\cos(y))\n$$\n$$\n\\nabla \\cdot \\boldsymbol{u} = -A \\sin(x)\\,\\sin(y) - B \\sin(x)\\,\\sin(y) = -(A+B) \\sin(x)\\,\\sin(y)\n$$\nThus, the governing equation for $\\phi(x,y)$ is:\n$$\n\\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = -(A+B) \\sin(x)\\,\\sin(y)\n$$\n\n### Part 2: Solution for $\\phi(x,y)$\nWe solve the Poisson equation derived above on the domain $\\Omega = [0,2\\pi] \\times [0,2\\pi]$ with periodic boundary conditions and the zero-mean constraint. Given the trigonometric form of the source term, we propose a solution of a similar form (method of undetermined coefficients):\n$$\n\\phi(x,y) = C \\sin(x)\\,\\sin(y)\n$$\nwhere $C$ is a constant to be determined. We compute the Laplacian of this trial solution:\n$$\n\\frac{\\partial \\phi}{\\partial x} = C \\cos(x)\\,\\sin(y) \\implies \\frac{\\partial^2 \\phi}{\\partial x^2} = -C \\sin(x)\\,\\sin(y)\n$$\n$$\n\\frac{\\partial \\phi}{\\partial y} = C \\sin(x)\\,\\cos(y) \\implies \\frac{\\partial^2 \\phi}{\\partial y^2} = -C \\sin(x)\\,\\sin(y)\n$$\n$$\n\\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = -C \\sin(x)\\,\\sin(y) - C \\sin(x)\\,\\sin(y) = -2C \\sin(x)\\,\\sin(y)\n$$\nSubstituting this back into the Poisson equation:\n$$\n-2C \\sin(x)\\,\\sin(y) = -(A+B) \\sin(x)\\,\\sin(y)\n$$\nThis equality must hold for all $(x,y) \\in \\Omega$, which implies:\n$$\n-2C = -(A+B) \\implies C = \\frac{A+B}{2}\n$$\nSo, a particular solution is $\\phi_p(x,y) = \\frac{A+B}{2} \\sin(x)\\,\\sin(y)$. The general solution is this particular solution plus any solution to the homogeneous Laplace equation, $\\nabla^2 \\phi_h = 0$, that satisfies the periodic boundary conditions. The only such solutions are constants, so $\\phi_h(x,y) = K$. The general periodic solution is:\n$$\n\\phi(x,y) = \\frac{A+B}{2} \\sin(x)\\,\\sin(y) + K\n$$\nWe now apply the zero-mean constraint $\\int_{\\Omega} \\phi \\, \\mathrm{d}\\boldsymbol{x} = 0$ to find $K$:\n$$\n\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\left( \\frac{A+B}{2} \\sin(x)\\,\\sin(y) + K \\right) \\mathrm{d}x\\,\\mathrm{d}y = 0\n$$\n$$\n\\frac{A+B}{2} \\left(\\int_{0}^{2\\pi} \\sin(x)\\,\\mathrm{d}x\\right) \\left(\\int_{0}^{2\\pi} \\sin(y)\\,\\mathrm{d}y\\right) + K \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\mathrm{d}x\\,\\mathrm{d}y = 0\n$$\nThe integral of $\\sin(t)$ over a full period $[0, 2\\pi]$ is $0$.\n$$\n\\int_{0}^{2\\pi} \\sin(t)\\,\\mathrm{d}t = [-\\cos(t)]_{0}^{2\\pi} = -1 - (-1) = 0\n$$\nTherefore, the first term vanishes. The equation simplifies to:\n$$\nK \\cdot (\\text{Area of } \\Omega) = K \\cdot (2\\pi \\cdot 2\\pi) = 4\\pi^2 K = 0\n$$\nThis implies $K=0$. The unique solution for $\\phi(x,y)$ is:\n$$\n\\phi(x,y) = \\frac{A+B}{2} \\sin(x)\\,\\sin(y)\n$$\n\n### Part 3: Computation of the Reduction $\\Delta$\nThe reduction $\\Delta$ is defined as:\n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} - \\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)}\n$$\nBy construction, the corrected field $\\boldsymbol{u}^{\\star}$ is divergence-free, i.e., $\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0$. The norm of a zero function is $0$, so $\\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)} = 0$. The reduction simplifies to:\n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)}\n$$\nWe compute this norm using its definition:\n$$\n\\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} = \\left( \\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2}\n$$\nFrom Part 1, we have $\\nabla \\cdot \\boldsymbol{u} = -(A+B) \\sin(x)\\,\\sin(y)$. Squaring this gives:\n$$\n|\\nabla \\cdot \\boldsymbol{u}|^{2} = \\left( -(A+B) \\sin(x)\\,\\sin(y) \\right)^2 = (A+B)^2 \\sin^2(x)\\,\\sin^2(y)\n$$\nNow we integrate over the domain $\\Omega$:\n$$\n\\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} (A+B)^2 \\sin^2(x)\\,\\sin^2(y) \\, \\mathrm{d}x\\,\\mathrm{d}y\n$$\n$$\n= (A+B)^2 \\left( \\int_{0}^{2\\pi} \\sin^2(x) \\, \\mathrm{d}x \\right) \\left( \\int_{0}^{2\\pi} \\sin^2(y) \\, \\mathrm{d}y \\right)\n$$\nWe evaluate the definite integral of $\\sin^2(t)$:\n$$\n\\int_{0}^{2\\pi} \\sin^2(t) \\, \\mathrm{d}t = \\int_{0}^{2\\pi} \\frac{1-\\cos(2t)}{2} \\, \\mathrm{d}t = \\frac{1}{2} \\left[ t - \\frac{\\sin(2t)}{2} \\right]_{0}^{2\\pi}\n$$\n$$\n= \\frac{1}{2} \\left( (2\\pi - 0) - (0-0) \\right) = \\pi\n$$\nSubstituting this result back, we get:\n$$\n\\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y = (A+B)^2 (\\pi)(\\pi) = (A+B)^2\\pi^2\n$$\nFinally, we take the square root to find the $L^2$ norm:\n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} = \\sqrt{(A+B)^2\\pi^2} = \\sqrt{(A+B)^2} \\sqrt{\\pi^2} = |A+B|\\pi\n$$\nThe two components of the final answer are $\\phi(x,y) = \\frac{A+B}{2} \\sin(x)\\sin(y)$ and $\\Delta = |A+B|\\pi$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{A+B}{2} \\sin(x)\\sin(y) & |A+B|\\pi\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from continuous theory to numerical practice, this exercise examines the pressure-correction mechanism at the level of a single control volume, as used in the Finite Volume Method (FVM). You will calculate the mass imbalance from a provisional velocity field and then determine the local pressure correction needed to restore mass conservation. This reveals the algebraic heart of popular CFD algorithms like the SIMPLE family. ",
            "id": "3380209",
            "problem": "Consider a single internal rectangular control volume in a steady, incompressible flow field discretized by the Finite Volume Method (FVM). The control volume dimensions are $\\Delta x = 0.02$ m, $\\Delta y = 0.03$ m, and $\\Delta z = 0.01$ m. The fluid density is uniform and equal to $\\rho = 1.2$ kg/m$^{3}$. The outward unit normal from the control volume points in $+\\hat{x}$ on the east face, $-\\hat{x}$ on the west face, $+\\hat{y}$ on the north face, and $-\\hat{y}$ on the south face. The predicted velocity components at the face centers are given as: x-components $u_{e}^{*} = 0.8$ m/s and $u_{w}^{*} = -0.7$ m/s for the east and west faces, respectively; and y-components $v_{n}^{*} = 0.4$ m/s and $v_{s}^{*} = -0.9$ m/s for the north and south faces, respectively. There is no flow in the z-direction. There are no volumetric mass sources or sinks within the control volume.\n\n1. Using the integral form of the mass conservation (continuity) equation, compute the residual mass imbalance $R_{P}$ defined as the net outward mass flux through the control volume faces when the predicted velocities $u_{e}^{*}$, $u_{w}^{*}$, $v_{n}^{*}$, and $v_{s}^{*}$ are used. The face areas are $A_{e} = \\Delta y \\Delta z$, $A_{w} = \\Delta y \\Delta z$, $A_{n} = \\Delta x \\Delta z$, and $A_{s} = \\Delta x \\Delta z$.\n\n2. Assume a pressure-correction strategy in which the velocity correction is linearly proportional to the pressure-correction gradient in the face-normal direction. Specifically, at each face $f \\in \\{e,w,n,s\\}$, the mass-flux correction is related to the pressure correction by\n$$\n\\delta \\dot{m}_{f} \\;=\\; \\rho \\, A_{f} \\, d_{f} \\,\\frac{p_{P}' - p_{N(f)}'}{\\delta_{f}},\n$$\nwhere $p_{P}'$ is the pressure correction at the control volume center, $p_{N(f)}'$ is the pressure correction at the neighbor cell across face $f$, $d_{f}$ is a given mobility coefficient arising from the linearized momentum equation, and $\\delta_{f}$ is the distance between the two adjacent cell centers along the face-normal direction. For this control volume, take $\\delta_{e} = \\Delta x$, $\\delta_{w} = \\Delta x$, $\\delta_{n} = \\Delta y$, and $\\delta_{s} = \\Delta y$. The mobility coefficients are given as $d_{e} = 1.0 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s, $d_{w} = 1.2 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s, $d_{n} = 0.8 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s, and $d_{s} = 1.5 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s.\n\nFormulate the local discrete pressure-correction equation that enforces the continuity equation by requiring the corrected net outward mass flux to be zero in this control volume, and then compute the value of $p_{P}'$ that would drive the residual to zero in one iteration if the neighbor-cell pressure corrections are held at zero in this update, i.e., $p_{E}' = p_{W}' = p_{N}' = p_{S}' = 0$.\n\nExpress the final pressure correction in Pascals and round your answer to four significant figures.",
            "solution": "The problem requires a two-part calculation related to the enforceability of mass conservation in a finite volume discretized flow field. First, we must compute the mass imbalance from a predicted velocity field. Second, we must formulate and solve the pressure-correction equation to find the pressure correction at the cell center that would nullify this imbalance.\n\n### Part 1: Calculation of the Residual Mass Imbalance\n\nThe integral form of the steady-state continuity equation for an incompressible fluid (constant density $\\rho$) is:\n$$ \\oint_S \\mathbf{v} \\cdot d\\mathbf{S} = 0 $$\nwhere $\\mathbf{v}$ is the velocity field and the integral is over the closed surface $S$ of the control volume. For a fluid with uniform density $\\rho$, the mass conservation equation is $\\oint_S \\rho (\\mathbf{v} \\cdot d\\mathbf{S}) = 0$.\n\nIn the Finite Volume Method (FVM), this integral is approximated by summing the mass fluxes over the faces of the control volume. For a rectangular control volume with faces labeled east (e), west (w), north (n), and south (s), and no flux in the z-direction, the net outward mass flux is given by:\n$$ \\sum_{f} \\dot{m}_f = (\\rho u A)_e - (\\rho u A)_w + (\\rho v A)_n - (\\rho v A)_s $$\nwhere $u$ and $v$ are the velocity components in the $x$ and $y$ directions, respectively, and $A$ is the area of the corresponding face. The terms $(\\rho u A)_f$ and $(\\rho v A)_f$ represent the mass flow rates across the faces.\n\nThe residual mass imbalance, $R_P$, is the value of this sum when computed with the predicted velocities, which are denoted by a superscript $*$.\n$$ R_P = (\\rho u^* A)_e - (\\rho u^* A)_w + (\\rho v^* A)_n - (\\rho v^* A)_s $$\nGiven that the east and west faces have the same area $A_e = A_w = \\Delta y \\Delta z$, and the north and south faces have the same area $A_n = A_s = \\Delta x \\Delta z$, we can write:\n$$ R_P = \\rho [ A_e (u_e^* - u_w^*) + A_n (v_n^* - v_s^*) ] $$\n\nFirst, we calculate the face areas using the provided dimensions:\n$\\Delta x = 0.02$ m, $\\Delta y = 0.03$ m, $\\Delta z = 0.01$ m.\n$$ A_e = A_w = \\Delta y \\Delta z = (0.03 \\, \\text{m})(0.01 \\, \\text{m}) = 3 \\times 10^{-4} \\, \\text{m}^2 $$\n$$ A_n = A_s = \\Delta x \\Delta z = (0.02 \\, \\text{m})(0.01 \\, \\text{m}) = 2 \\times 10^{-4} \\, \\text{m}^2 $$\n\nNext, we use the given fluid density and predicted velocities:\n$\\rho = 1.2$ kg/m$^3$.\n$u_e^* = 0.8$ m/s.\n$u_w^* = -0.7$ m/s.\n$v_n^* = 0.4$ m/s.\n$v_s^* = -0.9$ m/s.\n\nNow, we substitute these values into the equation for $R_P$:\n$$ R_P = (1.2 \\, \\text{kg/m}^3) [ (3 \\times 10^{-4} \\, \\text{m}^2)(0.8 \\, \\text{m/s} - (-0.7 \\, \\text{m/s})) + (2 \\times 10^{-4} \\, \\text{m}^2)(0.4 \\, \\text{m/s} - (-0.9 \\, \\text{m/s})) ] $$\n$$ R_P = 1.2 [ (3 \\times 10^{-4})(1.5) + (2 \\times 10^{-4})(1.3) ] \\, \\text{kg/s} $$\n$$ R_P = 1.2 [ 4.5 \\times 10^{-4} + 2.6 \\times 10^{-4} ] \\, \\text{kg/s} $$\n$$ R_P = 1.2 [ 7.1 \\times 10^{-4} ] \\, \\text{kg/s} $$\n$$ R_P = 8.52 \\times 10^{-4} \\, \\text{kg/s} $$\n\n### Part 2: Formulation and Solution of the Pressure-Correction Equation\n\nThe pressure-correction method aims to find a pressure-correction field, $p'$, that induces a velocity-correction field, $\\mathbf{v}'$, such that the corrected velocity field, $\\mathbf{v} = \\mathbf{v}^* + \\mathbf{v}'$, satisfies the continuity equation. This means the corrected net mass flux must be zero:\n$$ \\sum_{f} \\dot{m}_{f, \\text{corrected}} = 0 $$\nThe corrected flux is the sum of the predicted flux and the flux correction: $\\dot{m}_{f, \\text{corrected}} = \\dot{m}^*_f + \\delta \\dot{m}_f$. Therefore, the condition becomes:\n$$ \\sum_{f} (\\dot{m}^*_f + \\delta \\dot{m}_f) = (\\sum_{f} \\dot{m}^*_f) + (\\sum_{f} \\delta \\dot{m}_f) = 0 $$\n$$ R_P + \\sum_{f} \\delta \\dot{m}_f = 0 $$\nThe problem provides the formulation for the mass flux correction at each face $f$:\n$$ \\delta \\dot{m}_{f} = \\rho A_{f} d_{f} \\frac{p_{P}' - p_{N(f)}'}{\\delta_{f}} $$\nwhere $p_P'$ is the pressure correction in the central cell $P$, and $p_{N(f)}'$ is the correction in the neighbor cell across face $f$. This formulation correctly represents the correction to the net outward flux contribution from each face.\n\nSubstituting this into the balance equation, we get the discrete pressure-correction equation:\n$$ R_P + \\rho A_e d_e \\frac{p_P' - p_E'}{\\delta_e} + \\rho A_w d_w \\frac{p_P' - p_W'}{\\delta_w} + \\rho A_n d_n \\frac{p_P' - p_N'}{\\delta_n} + \\rho A_s d_s \\frac{p_P' - p_S'}{\\delta_s} = 0 $$\nWe are asked to solve for $p_P'$ assuming the neighbor cell pressure-corrections are zero in this update step: $p_E' = p_W' = p_N' = p_S' = 0$. The equation simplifies to:\n$$ R_P + p_P' \\left( \\frac{\\rho A_e d_e}{\\delta_e} + \\frac{\\rho A_w d_w}{\\delta_w} + \\frac{\\rho A_n d_n}{\\delta_n} + \\frac{\\rho A_s d_s}{\\delta_s} \\right) = 0 $$\nSolving for $p_P'$:\n$$ p_P' = \\frac{-R_P}{\\frac{\\rho A_e d_e}{\\delta_e} + \\frac{\\rho A_w d_w}{\\delta_w} + \\frac{\\rho A_n d_n}{\\delta_n} + \\frac{\\rho A_s d_s}{\\delta_s}} $$\nLet's compute the terms in the denominator.\n- $R_P = 8.52 \\times 10^{-4}$ kg/s.\n- $\\rho = 1.2$ kg/m$^3$.\n- $A_e = A_w = 3 \\times 10^{-4}$ m$^2$; $\\delta_e = \\delta_w = \\Delta x = 0.02$ m.\n- $A_n = A_s = 2 \\times 10^{-4}$ m$^2$; $\\delta_n = \\delta_s = \\Delta y = 0.03$ m.\n- $d_e = 1.0 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s).\n- $d_w = 1.2 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s).\n- $d_n = 0.8 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s).\n- $d_s = 1.5 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s).\n\nLet's calculate the coefficients $a_f = \\frac{\\rho A_f d_f}{\\delta_f}$:\n$$ a_e = \\frac{(1.2)(3 \\times 10^{-4})(1.0 \\times 10^{-4})}{0.02} = \\frac{3.6 \\times 10^{-8}}{0.02} = 1.8 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\n$$ a_w = \\frac{(1.2)(3 \\times 10^{-4})(1.2 \\times 10^{-4})}{0.02} = \\frac{4.32 \\times 10^{-8}}{0.02} = 2.16 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\n$$ a_n = \\frac{(1.2)(2 \\times 10^{-4})(0.8 \\times 10^{-4})}{0.03} = \\frac{1.92 \\times 10^{-8}}{0.03} = 0.64 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\n$$ a_s = \\frac{(1.2)(2 \\times 10^{-4})(1.5 \\times 10^{-4})}{0.03} = \\frac{3.6 \\times 10^{-8}}{0.03} = 1.2 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\nThe sum of these coefficients is the denominator:\n$$ \\sum a_f = (1.8 + 2.16 + 0.64 + 1.2) \\times 10^{-6} = 5.8 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\nNow, we can find $p_P'$:\n$$ p_P' = \\frac{-8.52 \\times 10^{-4} \\, \\text{kg/s}}{5.8 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)}} = -\\frac{8.52}{5.8} \\times 10^2 \\, \\text{Pa} $$\n$$ p_P' \\approx -1.4689655... \\times 10^2 \\, \\text{Pa} = -146.89655... \\, \\text{Pa} $$\nRounding the result to four significant figures gives:\n$$ p_P' \\approx -146.9 \\, \\text{Pa} $$\nThe positive mass residual $R_P$ indicates a net mass outflow, which is corrected by a negative pressure correction $p_P'$ that lowers the cell pressure relative to its neighbors, thereby reducing outflows and inflows to achieve mass balance.",
            "answer": "$$\\boxed{-146.9}$$"
        },
        {
            "introduction": "This final practice elevates the concept of pressure correction to the level of a formal projection operator. By implementing a spectral (FFT-based) solver, you will not only enforce the divergence-free constraint numerically but also analyze the fundamental properties of this projection. This provides a deeper, coordinate-independent understanding of how the velocity field is decomposed into its solenoidal (divergence-free) and potential components. ",
            "id": "3380192",
            "problem": "Consider a periodic, incompressible flow on the unit square domain $[0,1]\\times[0,1]$ sampled on a uniform, two-dimensional grid with $N_x$ points in the $x$-direction and $N_y$ points in the $y$-direction. Angles must be interpreted in radians. The incompressible continuity equation requires the velocity field $\\mathbf{u}=(u_x,u_y)$ to satisfy $\\nabla\\cdot\\mathbf{u}=0$. In numerical simulation, a provisional velocity $\\mathbf{u}$ may have nonzero divergence. A pressure correction $p$ is then introduced so that the corrected velocity $\\mathbf{u}^\\star=\\mathbf{u}-\\nabla p$ minimizes the divergence. This problem asks you to derive, implement, and analyze this minimization and the associated pressure projection operator.\n\nStarting from fundamental principles, use the incompressible continuity equation and periodic boundary conditions to formulate the least-squares minimization of the divergence of the corrected velocity. Specifically, define the cost functional\n$$\n\\mathcal{J}(p)=\\left\\|\\nabla\\cdot\\left(\\mathbf{u}-\\nabla p\\right)\\right\\|_{L^2}^2\n$$\nover scalar fields $p$ on $[0,1]\\times[0,1]$ having zero mean, with the norm defined by\n$$\n\\left\\|f\\right\\|_{L^2}=\\left(\\int_{0}^{1}\\int_{0}^{1} f(x,y)^2\\,\\mathrm{d}x\\,\\mathrm{d}y\\right)^{1/2}.\n$$\nDerive the condition that characterizes the minimizer (i.e., the optimal pressure correction), and explain how this condition arises from the continuity equation. Then, implement a spectral algorithm (using the Fast Fourier Transform (FFT)) to compute $p$ and $\\mathbf{u}^\\star$ on a discrete grid with periodic boundary conditions. Compute the discrete $L^2$-norm of the divergence of $\\mathbf{u}$ before correction and of $\\mathbf{u}^\\star$ after correction, using the discrete analogue of the divergence computed spectrally.\n\nDefine the pressure projection operator $\\mathsf{P}$ as the linear map that takes any velocity $\\mathbf{u}$ to the corrected velocity $\\mathbf{u}^\\star$ obtained by minimizing $\\mathcal{J}(p)$. Analyze the spectrum (the set of eigenvalues) of $\\mathsf{P}$ by considering its action in the Fourier domain on each wavevector. Numerically evaluate the eigenvalues of $\\mathsf{P}$ on the provided grids and report the smallest and largest eigenvalues observed across all discrete modes.\n\nYour program must implement the above steps and evaluate the following test suite. For each case, construct the specified synthetic velocity field, apply the spectral pressure correction, and return the discrete divergence norms before and after correction, as well as the minimum and maximum eigenvalues of the pressure projection operator over all modes on the given grid. All trigonometric functions must interpret angles in radians.\n\nTest suite:\n- Case $1$ (general case, square grid): $N_x=32$, $N_y=32$. Define\n  $$\n  u_x(x,y)=\\sin(2\\pi x)+\\tfrac{1}{2}\\sin(4\\pi y),\\quad\n  u_y(x,y)=0.3\\cos(2\\pi y)+0.1\\cos(2\\pi x).\n  $$\n- Case $2$ (rectangular grid, mixed components): $N_x=8$, $N_y=5$. Define\n  $$\n  u_x(x,y)=\\sin(2\\pi x)+0.2\\cos(2\\pi y),\\quad\n  u_y(x,y)=\\sin(2\\pi y)+0.1\\sin(2\\pi x).\n  $$\n- Case $3$ (edge case, divergence-free input): $N_x=3$, $N_y=3$. Define a stream function $\\psi(x,y)=\\sin(2\\pi x)\\sin(2\\pi y)$ and set\n  $$\n  u_x(x,y)=\\frac{\\partial \\psi}{\\partial y}(x,y),\\quad\n  u_y(x,y)=-\\frac{\\partial \\psi}{\\partial x}(x,y).\n  $$\n\nYour program must produce a single line of output containing the results as a comma-separated list of per-case results enclosed in square brackets, where each per-case result is itself a comma-separated list of four floats enclosed in square brackets, in the order\n$$\n\\left[\\left[\\text{before}_1,\\text{after}_1,\\min\\lambda_1,\\max\\lambda_1\\right],\\left[\\text{before}_2,\\text{after}_2,\\min\\lambda_2,\\max\\lambda_2\\right],\\left[\\text{before}_3,\\text{after}_3,\\min\\lambda_3,\\max\\lambda_3\\right]\\right],\n$$\nwhere $\\text{before}_k$ is the discrete $L^2$-norm of $\\nabla\\cdot\\mathbf{u}$ before correction for case $k$, $\\text{after}_k$ is the discrete $L^2$-norm of $\\nabla\\cdot\\mathbf{u}^\\star$ after correction for case $k$, and $\\min\\lambda_k$, $\\max\\lambda_k$ are the smallest and largest eigenvalues of the pressure projection operator on the grid for case $k$. The numerical outputs must be real-valued floats.",
            "solution": "This problem requires deriving the Pressure Poisson Equation from a least-squares minimization principle, formulating a spectral solver, and analyzing the resulting projection operator.\n\n### Derivation of the Pressure Poisson Equation\n\nThe goal is to find a scalar pressure correction field $p$ that minimizes the cost functional:\n$$\n\\mathcal{J}(p)=\\left\\|\\nabla\\cdot\\left(\\mathbf{u}-\\nabla p\\right)\\right\\|_{L^2}^2 = \\int_{\\Omega} \\left(\\nabla\\cdot\\mathbf{u} - \\nabla^2 p\\right)^2 \\, \\mathrm{d}\\mathbf{x}\n$$\nwhere $\\Omega$ is the domain $[0,1]\\times[0,1]$. Since the integrand is a squared real value, the functional $\\mathcal{J}(p)$ is always non-negative. Its minimum possible value is zero. This minimum is achieved if we can find a pressure field $p$ that makes the integrand zero everywhere in the domain. This provides the characterizing condition for the optimal pressure correction:\n$$\n\\nabla\\cdot\\mathbf{u} - \\nabla^2 p = 0\n$$\nRearranging this gives the familiar **Pressure Poisson Equation (PPE)**:\n$$\n\\nabla^2 p = \\nabla\\cdot\\mathbf{u}\n$$\nBy solving this equation for $p$, we find the pressure correction that ensures the corrected velocity field $\\mathbf{u}^\\star = \\mathbf{u} - \\nabla p$ is perfectly divergence-free, i.e., $\\nabla \\cdot \\mathbf{u}^\\star = 0$, thus satisfying the incompressible continuity equation. On a periodic domain, a solution to the PPE exists if the integral of the source term over the domain is zero. This is guaranteed by the divergence theorem: $\\int_{\\Omega} \\nabla\\cdot\\mathbf{u} \\,d\\mathbf{x} = \\oint_{\\partial \\Omega} \\mathbf{u}\\cdot\\mathbf{n}\\,d\\mathbf{s} = 0$ for periodic boundary conditions. To ensure a unique solution for $p$, we enforce the zero-mean constraint $\\int_{\\Omega} p \\,d\\mathbf{x} = 0$.\n\n### Spectral Algorithm Formulation\n\nOn a periodic domain, it is highly efficient to work in Fourier space. We represent a function $f(x,y)$ by its Fourier series coefficients $\\hat{f}(\\mathbf{k})$, where $\\mathbf{k}=(k_x, k_y)$ is the wavevector. The key property is that differentiation in real space becomes multiplication in Fourier space:\n$$\n\\widehat{\\nabla f}(\\mathbf{k}) = i 2\\pi \\mathbf{k} \\hat{f}(\\mathbf{k}), \\quad \\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k}) = i 2\\pi \\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k}), \\quad \\widehat{\\nabla^2 p}(\\mathbf{k}) = -(2\\pi)^2 |\\mathbf{k}|^2 \\hat{p}(\\mathbf{k})\n$$\nApplying the Fourier transform to the PPE, we get an algebraic equation for each mode $\\mathbf{k}$:\n$$\n-(2\\pi)^2 |\\mathbf{k}|^2 \\hat{p}(\\mathbf{k}) = \\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k}) = i 2\\pi \\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})\n$$\nFor any non-zero wavevector ($\\mathbf{k} \\neq \\mathbf{0}$), we can solve for $\\hat{p}(\\mathbf{k})$:\n$$\n\\hat{p}(\\mathbf{k}) = \\frac{i 2\\pi \\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})}{-(2\\pi)^2 |\\mathbf{k}|^2} = -\\frac{i (\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k}))}{2\\pi |\\mathbf{k}|^2}\n$$\nFor the zero-mean mode ($\\mathbf{k} = \\mathbf{0}$), the zero-mean constraint on $p$ requires $\\hat{p}(\\mathbf{0}) = 0$. This is consistent because the source term $\\widehat{\\nabla\\cdot\\mathbf{u}}(\\mathbf{0})$ is also zero.\n\nThe algorithm is:\n1. Compute the 2D FFT of the velocity components $u_x, u_y$ to get $\\hat{u}_x(\\mathbf{k}), \\hat{u}_y(\\mathbf{k})$.\n2. For each $\\mathbf{k}$, compute $\\hat{p}(\\mathbf{k})$ using the formula above.\n3. Compute the Fourier transform of the corrected velocity: $\\hat{\\mathbf{u}}^\\star(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - i 2\\pi \\mathbf{k} \\hat{p}(\\mathbf{k})$.\n4. Compute the inverse 2D FFT of $\\hat{\\mathbf{u}}^\\star(\\mathbf{k})$ to obtain the real-space corrected velocity $\\mathbf{u}^\\star(x,y)$.\n\n### Analysis of the Pressure Projection Operator\n\nThe pressure projection operator $\\mathsf{P}$ maps $\\mathbf{u}$ to $\\mathbf{u}^\\star$. Let's find its representation in Fourier space, $\\hat{\\mathsf{P}}$, which maps $\\hat{\\mathbf{u}}(\\mathbf{k})$ to $\\hat{\\mathbf{u}}^\\star(\\mathbf{k})$.\n$$\n\\hat{\\mathbf{u}}^\\star(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - i 2\\pi \\mathbf{k} \\hat{p}(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - i 2\\pi \\mathbf{k} \\left( -\\frac{i (\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k}))}{2\\pi |\\mathbf{k}|^2} \\right)\n$$\n$$\n\\hat{\\mathbf{u}}^\\star(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - \\frac{\\mathbf{k} (\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k}))}{|\\mathbf{k}|^2} = \\left(\\mathbf{I} - \\frac{\\mathbf{k} \\otimes \\mathbf{k}}{|\\mathbf{k}|^2}\\right) \\hat{\\mathbf{u}}(\\mathbf{k})\n$$\nwhere $\\mathbf{I}$ is the identity matrix and $\\mathbf{k} \\otimes \\mathbf{k}$ is the outer product.\nThe operator $\\hat{\\mathsf{P}}(\\mathbf{k}) = \\mathbf{I} - \\frac{\\mathbf{k} \\otimes \\mathbf{k}}{|\\mathbf{k}|^2}$ is a projection matrix. It projects any vector $\\hat{\\mathbf{u}}(\\mathbf{k})$ onto the subspace orthogonal to the wavevector $\\mathbf{k}$.\n- Any vector component parallel to $\\mathbf{k}$ (the longitudinal part, which causes divergence) is annihilated. The eigenvalue for this eigenvector is $\\lambda=0$.\n- Any vector component perpendicular to $\\mathbf{k}$ (the transverse or solenoidal part) is left unchanged. The eigenvalue for this eigenvector is $\\lambda=1$.\n\nFor the special case $\\mathbf{k}=\\mathbf{0}$, $\\hat{p}(\\mathbf{0})=0$, so $\\hat{\\mathbf{u}}^\\star(\\mathbf{0})=\\hat{\\mathbf{u}}(\\mathbf{0})$. The operator is the identity, with eigenvalue $\\lambda=1$.\nTherefore, the spectrum (the set of all possible eigenvalues) of the operator $\\mathsf{P}$ over all modes is precisely $\\{0, 1\\}$. The minimum eigenvalue is always 0 and the maximum is always 1, regardless of the input velocity field or the grid discretization (as long as non-zero wavevectors exist).",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the pressure projection problem for three test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"Nx\": 32, \"Ny\": 32,\n            \"ux_func\": lambda x, y, pi: np.sin(2 * pi * x) + 0.5 * np.sin(4 * pi * y),\n            \"uy_func\": lambda x, y, pi: 0.3 * np.cos(2 * pi * y) + 0.1 * np.cos(2 * pi * x),\n        },\n        {\n            \"Nx\": 8, \"Ny\": 5,\n            \"ux_func\": lambda x, y, pi: np.sin(2 * pi * x) + 0.2 * np.cos(2 * pi * y),\n            \"uy_func\": lambda x, y, pi: np.sin(2 * pi * y) + 0.1 * np.sin(2 * pi * x),\n        },\n        {\n            \"Nx\": 3, \"Ny\": 3,\n            \"ux_func\": lambda x, y, pi: 2 * pi * np.sin(2 * pi * x) * np.cos(2 * pi * y),  # from u_x = d(psi)/dy\n            \"uy_func\": lambda x, y, pi: -2 * pi * np.cos(2 * pi * x) * np.sin(2 * pi * y), # from u_y = -d(psi)/dx\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Nx, Ny = case[\"Nx\"], case[\"Ny\"]\n        ux_func, uy_func = case[\"ux_func\"], case[\"uy_func\"]\n\n        # 1. Set up grid and wavenumbers\n        x = np.linspace(0, 1, Nx, endpoint=False)\n        y = np.linspace(0, 1, Ny, endpoint=False)\n        xx, yy = np.meshgrid(x, y)\n\n        kx = np.fft.fftfreq(Nx, d=1/Nx)\n        ky = np.fft.fftfreq(Ny, d=1/Ny)\n        Kx, Ky = np.meshgrid(kx, ky)\n        \n        # Squared magnitude of the wavevector\n        K2 = Kx**2 + Ky**2\n\n        # 2. Define initial velocity field and take its Fourier transform\n        ux = ux_func(xx, yy, np.pi)\n        uy = uy_func(xx, yy, np.pi)\n        \n        ux_hat = np.fft.fft2(ux)\n        uy_hat = np.fft.fft2(uy)\n\n        # 3. Compute divergence of the initial field and its L2-norm\n        # Divergence in Fourier space: div_u_hat = i*2*pi*(Kx*ux_hat + Ky*uy_hat)\n        div_u_hat = 1j * 2 * np.pi * (Kx * ux_hat + Ky * uy_hat)\n        \n        # Transform back to real space to compute the norm\n        div_u = np.real(np.fft.ifft2(div_u_hat))\n        \n        # The discrete L2-norm is sqrt(mean(f^2))\n        norm_before = np.sqrt(np.mean(div_u**2))\n        \n        # 4. Solve the Pressure Poisson equation in Fourier space\n        # p_hat = -div_u_hat / ( (2*pi)^2 * K2 ) for k != 0\n        # For k=0, p_hat(0,0)=0 due to zero-mean pressure constraint.\n        # We can safely divide by K2 if we handle the k=0 case.\n        # Create a copy of K2 and set the (0,0) element to 1 to avoid division by zero.\n        # p_hat(0,0) will be zero anyway since div_u_hat(0,0) is zero.\n        K2_inv = np.copy(K2)\n        if K2_inv[0, 0] == 0:\n            K2_inv[0, 0] = 1.0 # Avoid division by zero, p_hat(0,0) will be 0 as needed.\n            \n        p_hat = -div_u_hat / ((2 * np.pi)**2 * K2_inv)\n\n        # 5. Compute the corrected velocity field\n        # u_star_hat = u_hat - i*2*pi*k*p_hat\n        ux_star_hat = ux_hat - 1j * 2 * np.pi * Kx * p_hat\n        uy_star_hat = uy_hat - 1j * 2 * np.pi * Ky * p_hat\n\n        # 6. Compute divergence of the corrected field and its L2-norm\n        div_u_star_hat = 1j * 2 * np.pi * (Kx * ux_star_hat + Ky * uy_star_hat)\n        div_u_star = np.real(np.fft.ifft2(div_u_star_hat))\n        norm_after = np.sqrt(np.mean(div_u_star**2))\n        \n        # 7. Analyze the eigenvalues of the pressure projection operator\n        # As derived in the solution, the operator P projects each Fourier mode\n        # u_hat(k) onto the subspace orthogonal to the wavevector k.\n        # This projection has two eigenvalues for each k:\n        # - Eigenvalue 0 for the component of u_hat parallel to k (longitudinal).\n        # - Eigenvalue 1 for the component of u_hat perpendicular to k (transverse).\n        # For the k=0 mode, the operator is the identity, with eigenvalues (1, 1).\n        # Therefore, the set of all eigenvalues for the operator on the entire\n        # grid is exactly {0, 1}.\n        min_lambda = 0.0\n        max_lambda = 1.0\n        \n        results.append([norm_before, norm_after, min_lambda, max_lambda])\n    \n    # Format the final output string\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, r))}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}