{
    "hands_on_practices": [
        {
            "introduction": "To appreciate the solution, we must first understand the problem. This practice guides you through a numerical experiment to visualize the core instability of co-located grids: the \"checkerboard\" pressure mode. By constructing a specific forcing term designed to excite this non-physical, high-frequency oscillation, you will see how a naive co-located discretization allows it to exist without affecting the velocity field, a phenomenon known as pressure-velocity decoupling . This exercise provides the essential motivation for why sophisticated momentum interpolation techniques are not just helpful, but necessary.",
            "id": "3365597",
            "problem": "Consider the steady, incompressible Stokes equations on a two-dimensional periodic domain of length $L=1$ in each direction, with spatial coordinates $(x,y)$ and velocity field $\\mathbf{u}(x,y) = (u(x,y), v(x,y))$:\n$$\n-\\nabla p + \\nu \\nabla^2 \\mathbf{u} = \\mathbf{f}, \\quad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwhere $p(x,y)$ is the pressure, $\\nu$ is the kinematic viscosity, and $\\mathbf{f}(x,y)$ is a given body force. In a fractional-step projection approach, the pressure field $p$ is recovered from the following Poisson equation for pressure associated with enforcing discrete incompressibility:\n$$\n\\nabla^2 p = s,\n$$\nwhere $s$ is a discrete source constructed from the divergence of an intermediate velocity field. On a uniform Cartesian grid with spacing $\\Delta x = \\Delta y$, different grid arrangements lead to different discrete gradient and divergence operators. In particular:\n- The co-located (cell-centered) arrangement places $u$, $v$, and $p$ all at cell centers. A common naive central-difference implementation computes the discrete pressure gradient at centers using nearest neighbors in each coordinate direction:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}^{\\text{col}} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}^{\\text{col}} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta x}.\n$$\n- The Marker-And-Cell (MAC) staggered arrangement places $u$ on vertical faces at $(i+\\tfrac{1}{2}, j)$, $v$ on horizontal faces at $(i, j+\\tfrac{1}{2})$, and $p$ at cell centers $(i,j)$. The discrete pressure gradient naturally appears at faces:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i+\\frac{1}{2},j}^{\\text{MAC}} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j+\\frac{1}{2}}^{\\text{MAC}} = \\frac{p_{i,j+1} - p_{i,j}}{\\Delta x}.\n$$\n\nIt is known that co-located central differences admit a spurious pressure mode, often called a checkerboard mode, which is defined on an $N_x \\times N_y$ uniform periodic grid by\n$$\np_{i,j}^{\\text{chk}} = (-1)^{i+j}, \\quad i = 0,1,\\dots,N_x-1, \\quad j = 0,1,\\dots,N_y-1,\n$$\nand corresponds to the highest resolvable spatial frequency (the Nyquist mode). This mode can be excited by certain discrete forcings and, on co-located grids, can decouple from the momentum equations under naive interpolation from centers to faces, leading to nonphysical oscillations in $p$ that do not drive momentum. In contrast, the MAC staggering suppresses this decoupling because the face-centered discrete gradient directly samples adjacent cell-center pressures, and the checkerboard difference does not vanish at faces.\n\nYour task is to:\n1. Use a manufactured source $s_{i,j} = (-1)^{i+j}$ to excite the checkerboard mode in the discrete pressure Poisson equation with periodic boundary conditions, discretized by the standard five-point Laplacian. The discrete Fourier symbol of the five-point Laplacian on a uniform grid of spacing $\\Delta x$ is\n$$\n\\lambda(k_x,k_y) = \\frac{2}{\\Delta x^2}\\left(\\cos(k_x \\Delta x)-1\\right) + \\frac{2}{\\Delta x^2}\\left(\\cos(k_y \\Delta x)-1\\right),\n$$\nfor discrete wavenumbers $k_x = \\frac{2\\pi m}{L}$, $k_y = \\frac{2\\pi n}{L}$, where $m = 0,1,\\dots,N_x-1$ and $n = 0,1,\\dots,N_y-1$. The checkerboard mode corresponds to $(m,n) = (N_x/2, N_y/2)$ when $N_x$ and $N_y$ are even, giving $\\cos(\\pi) = -1$ and thus\n$$\n\\lambda_{\\text{chk}} = -\\frac{4}{\\Delta x^2} - \\frac{4}{\\Delta x^2} = -\\frac{8}{\\Delta x^2}.\n$$\nFrom this, the pressure amplitude associated with the checkerboard forcing scales as\n$$\nA_p(\\Delta x) = \\frac{1}{|\\lambda_{\\text{chk}}|} = \\frac{\\Delta x^2}{8}.\n$$\n2. Numerically solve the discrete periodic Poisson equation $\\nabla^2 p = s$ using the discrete Laplacian symbol above in the Fourier domain for a sequence of uniform grids, and extract the numerical amplitude $A_p(\\Delta x)$ of the checkerboard component by projecting the computed $p$ onto $p^{\\text{chk}}$.\n3. Compute and compare the root-mean-square (RMS) magnitude of the face-centered pressure gradient that would enter the momentum equations under:\n   - A co-located naive face-gradient obtained by averaging cell-centered gradients at adjacent cells to faces:\n   $$\n   \\left(\\frac{\\partial p}{\\partial x}\\right)_{i+\\frac{1}{2},j}^{\\text{col-face}} = \\frac{1}{2}\\left[\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}^{\\text{col}} + \\left(\\frac{\\partial p}{\\partial x}\\right)_{i+1,j}^{\\text{col}}\\right], \\quad\n   \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j+\\frac{1}{2}}^{\\text{col-face}} = \\frac{1}{2}\\left[\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}^{\\text{col}} + \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j+1}^{\\text{col}}\\right].\n   $$\n   - The MAC face-gradient, as defined above. The RMS magnitude is defined as\n   $$\n   G_{\\text{RMS}} = \\sqrt{\\frac{1}{N_f}\\sum_{f} g_f^2},\n   $$\n   where $g_f$ ranges over all face gradient components in both directions and $N_f$ is the number of faces.\n4. Demonstrate numerically that:\n   - The co-located naive face-gradient is blind to the checkerboard component so that its RMS magnitude is numerically zero for the manufactured forcing, explaining the decoupling.\n   - The MAC face-gradient couples to the checkerboard mode, and its RMS magnitude scales like $\\mathcal{O}(\\Delta x)$ for the manufactured forcing because $A_p(\\Delta x) \\sim \\Delta x^2$ and the face gradient scales like $A_p(\\Delta x)/\\Delta x$.\n\nImplement a program that:\n- Builds the manufactured source $s_{i,j} = (-1)^{i+j}$ on a periodic domain of length $L=1$.\n- Solves the discrete Poisson equation in Fourier space using the discrete Laplacian symbol to obtain $p_{i,j}$.\n- Computes the numerical checkerboard amplitude $A_p(\\Delta x)$ via projection onto $(-1)^{i+j}$.\n- Computes $G_{\\text{RMS}}^{\\text{col-face}}$ and $G_{\\text{RMS}}^{\\text{MAC}}$ for the resulting $p_{i,j}$.\n- Reports the tuple $(A_p(\\Delta x), G_{\\text{RMS}}^{\\text{col-face}}, G_{\\text{RMS}}^{\\text{MAC}})$ for each grid.\n\nTest Suite:\n- Use square grids with $N_x=N_y$ and $L=1$ for the following cases:\n  1. $N_x=N_y=8$ (coarse grid, $\\Delta x = 1/8$).\n  2. $N_x=N_y=16$ (moderate grid, $\\Delta x = 1/16$).\n  3. $N_x=N_y=32$ (fine grid, $\\Delta x = 1/32$).\n  4. $N_x=N_y=64$ (very fine grid, $\\Delta x = 1/64$).\nAll reported quantities are dimensionless. Your program should produce a single line of output containing the results as a comma-separated list of four bracketed tuples, each tuple ordered as $(A_p(\\Delta x), G_{\\text{RMS}}^{\\text{col-face}}, G_{\\text{RMS}}^{\\text{MAC}})$ in the same order as the test cases, for example:\n\"[(a1,b1,c1),(a2,b2,c2),(a3,b3,c3),(a4,b4,c4)]\".",
            "solution": "We begin from the steady incompressible Stokes equations\n$$\n-\\nabla p + \\nu \\nabla^2 \\mathbf{u} = \\mathbf{f}, \\quad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwhich, under a fractional-step approach, leads to enforcing discrete incompressibility via a pressure Poisson equation\n$$\n\\nabla^2 p = s,\n$$\nwhere the source $s$ is obtained from the divergence of an intermediate velocity. On a uniform periodic grid, solving this Poisson equation in the discrete Fourier space is natural and reveals how certain spatial modes propagate into pressure. We focus on the checkerboard (Nyquist) mode,\n$$\np_{i,j}^{\\text{chk}} = (-1)^{i+j},\n$$\nwhich alternates in sign between neighboring cell centers.\n\nFor a uniform grid with spacing $\\Delta x$ and periodic boundary conditions, the standard five-point discrete Laplacian has Fourier symbol\n$$\n\\lambda(k_x,k_y) = \\frac{2}{\\Delta x^2}\\left(\\cos(k_x \\Delta x)-1\\right) + \\frac{2}{\\Delta x^2}\\left(\\cos(k_y \\Delta x)-1\\right),\n$$\nwith discrete wavenumbers $k_x = \\frac{2\\pi m}{L}$ and $k_y = \\frac{2\\pi n}{L}$, $m=0,\\dots,N_x-1$, $n=0,\\dots,N_y-1$, and $L=1$. For the checkerboard mode, $(m,n)=(N_x/2, N_y/2)$ and $k_x \\Delta x = \\pi$, $k_y \\Delta x = \\pi$, giving\n$$\n\\lambda_{\\text{chk}} = \\frac{2}{\\Delta x^2}\\left(\\cos \\pi - 1\\right) + \\frac{2}{\\Delta x^2}\\left(\\cos \\pi - 1\\right) = \\frac{2}{\\Delta x^2}\\left(-1 - 1\\right) + \\frac{2}{\\Delta x^2}\\left(-1 - 1\\right) = -\\frac{8}{\\Delta x^2}.\n$$\nForcing the Poisson equation with $s_{i,j}=(-1)^{i+j}$ means the right-hand side has only this mode. Therefore the solution is proportional to the same mode:\n$$\np_{i,j} = A_p(\\Delta x)\\, (-1)^{i+j}.\n$$\nPlugging into the discrete Poisson equation in Fourier space yields\n$$\n\\lambda_{\\text{chk}} A_p(\\Delta x) = 1 \\quad \\Rightarrow \\quad A_p(\\Delta x) = \\frac{1}{\\lambda_{\\text{chk}}} = -\\frac{\\Delta x^2}{8}.\n$$\nThe problem asks for the amplitude, so we consider the magnitude, which scales as $\\Delta x^2/8$.\n\nThe distinction between co-located and Marker-And-Cell (MAC) staggering enters through how the pressure gradient is represented in the momentum equations:\n- In a co-located (cell-centered) scheme, a common naive implementation uses central differences to estimate $\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}^{\\text{col}}$ and $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}^{\\text{col}}$ at cell centers. For the checkerboard pressure $p_{i,j} = A_p(\\Delta x)\\,(-1)^{i+j}$,\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}^{\\text{col}} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}\n= \\frac{A_p(\\Delta x)\\left[(-1)^{i+1+j} - (-1)^{i-1+j}\\right]}{2\\Delta x}\n= \\frac{A_p(\\Delta x)\\,(-1)^{i+j}\\left[-1 - (-1)\\right]}{2\\Delta x} = 0,\n$$\nand a similar calculation shows $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}^{\\text{col}}=0$. If one then naively forms face gradients by averaging adjacent center gradients, the resulting face pressure gradient that would drive the momentum equations is still zero. This demonstrates the decoupling: the checkerboard pressure produces no face-centered pressure force in the co-located naive scheme.\n- In the MAC staggered arrangement, the face-centered discrete gradient directly takes differences of adjacent center pressures:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i+\\frac{1}{2},j}^{\\text{MAC}} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}\n= \\frac{A_p(\\Delta x)\\left[(-1)^{i+1+j} - (-1)^{i+j}\\right]}{\\Delta x}\n= \\frac{A_p(\\Delta x)\\,(-1)^{i+j}(-1 - 1)}{\\Delta x}\n= -\\frac{2\\,A_p(\\Delta x)}{\\Delta x}\\,(-1)^{i+j}.\n$$\nAn analogous expression holds for $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j+\\frac{1}{2}}^{\\text{MAC}}$. Consequently, the MAC face-gradient couples strongly to the checkerboard and drives momentum corrections that suppress such oscillations. The magnitude of the MAC face-gradient scales like $\\frac{|A_p(\\Delta x)|}{\\Delta x} \\sim \\frac{\\Delta x^2}{\\Delta x} = \\mathcal{O}(\\Delta x)$ for the manufactured forcing.\n\nThe program implements this procedure: it solves the Poisson equation in Fourier space, inverse transforms to get the pressure field $p_{i,j}$, and then computes the RMS of the pressure gradients for both the naive co-located and the MAC stencils. The numerical results should confirm that the co-located gradient RMS is near machine zero, while the MAC gradient RMS scales linearly with $\\Delta x$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef discrete_laplacian_symbol(nx, ny, dx):\n    \"\"\"\n    Build the discrete Laplacian symbol lambda(m,n) for a periodic grid\n    using the five-point stencil central differences on a uniform grid.\n    \"\"\"\n    # Wavenumber indices m, n\n    m = np.arange(nx)\n    n = np.arange(ny)\n    # Cosine terms for each axis\n    cos_m = np.cos(2.0 * np.pi * m / nx)\n    cos_n = np.cos(2.0 * np.pi * n / ny)\n    # Broadcast to 2D grid of (m,n)\n    lam = (2.0 / dx**2) * (cos_m[:, None] - 1.0) + (2.0 / dx**2) * (cos_n[None, :] - 1.0)\n    return lam\n\ndef solve_poisson_checkerboard(nx, ny, L=1.0):\n    \"\"\"\n    Solve the discrete periodic Poisson equation for s_{i,j} = (-1)^{i+j}\n    using the discrete Laplacian symbol in Fourier space.\n\n    Returns:\n        p: computed pressure field (nx x ny)\n        Ap: numerical checkerboard amplitude via projection onto (-1)^{i+j}\n    \"\"\"\n    dx = L / nx\n    # Manufactured source s = (-1)^{i+j}\n    i = np.arange(nx)[:, None]\n    j = np.arange(ny)[None, :]\n    s = ((-1.0) ** (i + j)).astype(np.float64)\n\n    # FFT of source\n    s_hat = np.fft.fft2(s)\n\n    # Discrete Laplacian symbol\n    lam = discrete_laplacian_symbol(nx, ny, dx)\n\n    # Avoid division by zero: source has zero mean, so lam[0,0] won't be used\n    # Construct p_hat = s_hat / lam\n    # Use where to handle potential zeros robustly (though s_hat[0,0]==0)\n    p_hat = np.zeros_like(s_hat, dtype=np.complex128)\n    mask = lam != 0.0\n    p_hat[mask] = s_hat[mask] / lam[mask]\n\n    # Inverse FFT to get p\n    p = np.real(np.fft.ifft2(p_hat))\n\n    # Compute checkerboard amplitude Ap = mean(p * (-1)^{i+j})\n    pattern = ((-1.0) ** (i + j)).astype(np.float64)\n    Ap = np.sum(p * pattern) / (nx * ny)\n\n    return p, Ap, dx\n\ndef colocated_face_gradient_rms(p, dx):\n    \"\"\"\n    Compute co-located center gradients via central differences and then\n    naive face gradients by averaging adjacent center gradients.\n    Return RMS magnitude over all faces.\n    \"\"\"\n    nx, ny = p.shape\n\n    # Periodic shifts\n    p_ip = np.roll(p, -1, axis=0)\n    p_im = np.roll(p,  1, axis=0)\n    p_jp = np.roll(p, -1, axis=1)\n    p_jm = np.roll(p,  1, axis=1)\n\n    # Center gradients (central difference)\n    gx_c = (p_ip - p_im) / (2.0 * dx)\n    gy_c = (p_jp - p_jm) / (2.0 * dx)  # dx == dy\n\n    # Face gradients: average adjacent center gradients to faces\n    # x-faces at (i+1/2, j): average gx_c[i,j] and gx_c[i+1,j]\n    gx_face = 0.5 * (gx_c + np.roll(gx_c, -1, axis=0))\n    # y-faces at (i, j+1/2): average gy_c[i,j] and gy_c[i,j+1]\n    gy_face = 0.5 * (gy_c + np.roll(gy_c, -1, axis=1))\n\n    # RMS over all faces (both directions)\n    # Number of faces: 2 * nx * ny\n    rms = np.sqrt((np.sum(gx_face**2) + np.sum(gy_face**2)) / (2.0 * nx * ny))\n    return rms\n\ndef mac_face_gradient_rms(p, dx):\n    \"\"\"\n    Compute MAC face gradients directly from adjacent center pressures.\n    Return RMS magnitude over all faces.\n    \"\"\"\n    nx, ny = p.shape\n\n    # x-face gradient: (p_{i+1,j} - p_{i,j}) / dx\n    p_ip = np.roll(p, -1, axis=0)\n    gx_face = (p_ip - p) / dx\n\n    # y-face gradient: (p_{i,j+1} - p_{i,j}) / dx\n    p_jp = np.roll(p, -1, axis=1)\n    gy_face = (p_jp - p) / dx\n\n    rms = np.sqrt((np.sum(gx_face**2) + np.sum(gy_face**2)) / (2.0 * nx * ny))\n    return rms\n\ndef run_test_case(nx):\n    ny = nx\n    p, Ap, dx = solve_poisson_checkerboard(nx, ny, L=1.0)\n    rms_col = colocated_face_gradient_rms(p, dx)\n    rms_mac = mac_face_gradient_rms(p, dx)\n    return (Ap, rms_col, rms_mac)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [8, 16, 32, 64]\n\n    results = []\n    for nx in test_cases:\n        Ap, rms_col, rms_mac = run_test_case(nx)\n        # Format each tuple with reasonable precision\n        results.append(f\"({Ap:.10f},{rms_col:.10e},{rms_mac:.10e})\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having diagnosed the checkerboard instability , we now turn to the canonical solution: the Rhie-Chow momentum interpolation. This hands-on derivation is a fundamental rite of passage in learning CFD, tasking you with assembling the coefficients of the pressure-correction Poisson equation. By working through the algebra under a set of simplifying, pedagogical assumptions, you will gain a concrete understanding of how this interpolation technique explicitly introduces a pressure-gradient-dependent term that couples the velocity and pressure fields, effectively suppressing the spurious oscillations.",
            "id": "3302122",
            "problem": "Consider a two-dimensional, incompressible, constant-density flow solved on a co-located finite volume grid, where all primitive variables are stored at cell centers. The grid is uniform with spacings $\\Delta x$ and $\\Delta y$, so the control volume for any interior cell $P$ has volume $\\Delta V = \\Delta x \\Delta y$, and the face areas are $A_{e} = \\Delta y$, $A_{w} = \\Delta y$, $A_{n} = \\Delta x$, and $A_{s} = \\Delta x$. The time integration is implicit Euler with time-step size $\\Delta t$. To avoid pressure–velocity decoupling on the co-located arrangement, the face mass fluxes are constructed using the Rhie–Chow interpolation, where the face-normal velocity correction depends on a face-effective inverse diagonal of the momentum equation obtained by central interpolation of the reciprocal of cell-center diagonal coefficients.\n\nAssume that in the discretized momentum equations for the horizontal velocity component $u$ and the vertical velocity component $v$, the diagonal coefficients at all cells are exactly $a_{P}^{u} = a_{P}^{v} = \\rho \\Delta V / \\Delta t$, where $\\rho$ is the constant density. Using this assumption and central interpolation of the reciprocal of the diagonal to compute the face-effective diagonal for each face, derive and explicitly assemble the coefficients of the linear pressure-correction equation for the interior cell $P$,\n$$\na_{P}^{p'} \\, p'_{P} \\;=\\; a_{E}^{p'} \\, p'_{E} \\;+\\; a_{W}^{p'} \\, p'_{W} \\;+\\; a_{N}^{p'} \\, p'_{N} \\;+\\; a_{S}^{p'} \\, p'_{S} \\;+\\; b_{P}^{p'} \\,,\n$$\nwhere $p'$ denotes the pressure correction, and $b_{P}^{p'}$ is the correction source term arising from mass-flux imbalance of the predicted (uncorrected) fluxes. Express the assembled coefficients $a_{W}^{p'}$, $a_{E}^{p'}$, $a_{S}^{p'}$, $a_{N}^{p'}$, and the diagonal $a_{P}^{p'}$ in terms of $\\Delta x$, $\\Delta y$, $\\rho$, and $\\Delta t$. Provide the final answers in the order $a_{W}^{p'}$, $a_{E}^{p'}$, $a_{S}^{p'}$, $a_{N}^{p'}$, $a_{P}^{p'}$ as a single row. No numerical evaluation is required.",
            "solution": "The pressure-correction equation is derived by enforcing mass conservation for the corrected velocity field. For a two-dimensional, incompressible flow, the discretized continuity equation for a control volume $P$ is the sum of outgoing mass fluxes, which must equal the source term $b_P^{p'}$, representing the negative mass imbalance from the predictor step:\n$$\n(\\rho u A)_{e} - (\\rho u A)_{w} + (\\rho v A)_{n} - (\\rho v A)_{s} = 0\n$$\nWithin the SIMPLE algorithm, the velocity and pressure fields are decomposed into a predicted part (denoted by $*$) and a correction part (denoted by $'$): $p = p^* + p'$, $\\mathbf{u} = \\mathbf{u}^* + \\mathbf{u}'$. The corrected velocity $\\mathbf{u}$ must satisfy continuity. Substituting the decompositions into the continuity equation for the correction field gives:\n$$\n(\\rho u' A)_{e} - (\\rho u' A)_{w} + (\\rho v' A)_{n} - (\\rho v' A)_{s} = b_{P}^{p'}\n$$\nThe velocity corrections are related to the pressure-correction gradient. Following the Rhie-Chow principle, the velocity correction at the east face $e$ is given by:\n$$\nu'_{e} = -\\overline{\\left(\\frac{V}{a^{u}}\\right)}_{e} \\frac{p'_{E} - p'_{P}}{\\Delta x}\n$$\nwhere $\\overline{(V/a^u)}_e$ is the central interpolation of the cell-center quantity $V/a^u$. Given the problem's assumption, $a_{P}^{u} = a_{E}^{u} = \\frac{\\rho \\Delta V}{\\Delta t}$, the term $\\Delta V/a^u$ is constant for all cells:\n$$\n\\frac{\\Delta V}{a^{u}} = \\Delta V \\left( \\frac{\\Delta t}{\\rho \\Delta V} \\right) = \\frac{\\Delta t}{\\rho}\n$$\nThe interpolated value at face $e$ is therefore simply $\\overline{(\\Delta V/a^u)}_e = \\Delta t / \\rho$. Substituting this back into the expression for $u'_e$:\n$$\nu'_{e} = - \\frac{\\Delta t}{\\rho} \\frac{p'_{E} - p'_{P}}{\\Delta x} = \\frac{\\Delta t}{\\rho} \\frac{p'_{P} - p'_{E}}{\\Delta x}\n$$\nThe mass flux correction at face $e$, $(\\rho u' A)_e$, is then:\n$$\n(\\rho u' A)_{e} = \\rho A_{e} u'_{e} = \\rho (\\Delta y) \\left( \\frac{\\Delta t}{\\rho} \\frac{p'_{P} - p'_{E}}{\\Delta x} \\right) = \\frac{\\Delta t \\Delta y}{\\Delta x} (p'_{P} - p'_{E})\n$$\nBy symmetry, we can derive the flux corrections for the other faces (noting that the correction flux at face $w$ is defined from cell $W$ to $P$, so the outgoing flux from $P$ is $-(\\rho u' A)_w$):\n- **West face (w):** The outgoing flux from $P$ is $-(\\rho u' A)_w = - \\left( \\frac{\\Delta t \\Delta y}{\\Delta x} (p'_{W} - p'_{P}) \\right) = \\frac{\\Delta t \\Delta y}{\\Delta x} (p'_{P} - p'_{W})$\n- **North face (n):** The outgoing flux is $(\\rho v' A)_n = \\frac{\\Delta t \\Delta x}{\\Delta y} (p'_{P} - p'_{N})$\n- **South face (s):** The outgoing flux is $-(\\rho v' A)_s = \\frac{\\Delta t \\Delta x}{\\Delta y} (p'_{P} - p'_{S})$\n\nSubstituting these outgoing flux corrections into the continuity equation for the correction fields:\n$$\n\\frac{\\Delta t \\Delta y}{\\Delta x} (p'_{P} - p'_{E}) + \\frac{\\Delta t \\Delta y}{\\Delta x} (p'_{P} - p'_{W}) + \\frac{\\Delta t \\Delta x}{\\Delta y} (p'_{P} - p'_{N}) + \\frac{\\Delta t \\Delta x}{\\Delta y} (p'_{P} - p'_{S}) = b_{P}^{p'}\n$$\nThe problem specifies the form $a_{P}^{p'} p'_{P} = \\sum a_{nb}^{p'} p'_{nb} + b_{P}^{p'}$. Rearranging the equation by grouping terms for $p'_P$ on the left and neighbor terms on the right:\n$$\np'_{P} \\left( \\frac{\\Delta t \\Delta y}{\\Delta x} + \\frac{\\Delta t \\Delta y}{\\Delta x} + \\frac{\\Delta t \\Delta x}{\\Delta y} + \\frac{\\Delta t \\Delta x}{\\Delta y} \\right) = \\left( \\frac{\\Delta t \\Delta y}{\\Delta x} \\right) p'_{E} + \\left( \\frac{\\Delta t \\Delta y}{\\Delta x} \\right) p'_{W} + \\left( \\frac{\\Delta t \\Delta x}{\\Delta y} \\right) p'_{N} + \\left( \\frac{\\Delta t \\Delta x}{\\Delta y} \\right) p'_{S} + b_{P}^{p'}\n$$\nFrom this final form, we can identify the coefficients:\n$$\na_{E}^{p'} = \\frac{\\Delta t \\Delta y}{\\Delta x} \\quad , \\quad a_{W}^{p'} = \\frac{\\Delta t \\Delta y}{\\Delta x} \\quad , \\quad a_{N}^{p'} = \\frac{\\Delta t \\Delta x}{\\Delta y} \\quad , \\quad a_{S}^{p'} = \\frac{\\Delta t \\Delta x}{\\Delta y}\n$$\nThe diagonal coefficient $a_{P}^{p'}$ is the sum of the neighbor coefficients:\n$$\na_{P}^{p'} = a_{E}^{p'} + a_{W}^{p'} + a_{N}^{p'} + a_{S}^{p'} = 2 \\frac{\\Delta t \\Delta y}{\\Delta x} + 2 \\frac{\\Delta t \\Delta x}{\\Delta y} = 2 \\Delta t \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\Delta t \\Delta y}{\\Delta x} & \\frac{\\Delta t \\Delta y}{\\Delta x} & \\frac{\\Delta t \\Delta x}{\\Delta y} & \\frac{\\Delta t \\Delta x}{\\Delta y} & 2 \\Delta t \\left(\\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A stable interior scheme is only half the battle; a robust solver requires consistent boundary conditions. This exercise moves from the domain interior to its edges, challenging you to formulate a complete and stable set of boundary conditions for a common inflow-outflow problem being solved on a co-located grid . Selecting the correct treatment for pressure, velocity, and the pressure-correction variable itself is crucial for ensuring global mass conservation and preventing the boundaries from becoming a source of numerical error.",
            "id": "3302115",
            "problem": "Consider a steady, incompressible flow solved on a co-located grid using the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE). The computational domain has an inlet boundary $\\Gamma_{\\text{in}}$ and an outlet boundary $\\Gamma_{\\text{out}}$. The discrete continuity equation at each control volume requires that the sum of incoming and outgoing mass fluxes equals $0$, and globally the net mass flux across all boundaries must be $0$. In a co-located arrangement, pressure and velocity are stored at the same locations, and naive linear interpolation of face velocities can lead to decoupling between pressure and velocity, producing spurious pressure oscillations. A well-tested remedy is Rhie–Chow momentum interpolation, which computes face velocities from the discretized momentum equation and includes a pressure gradient contribution consistent with the cell-centered momentum coefficients.\n\nYou are asked to select a boundary condition formulation for the inlet and outlet that is consistent with the governing laws and discretization, such that:\n- Global mass conservation is satisfied (net mass flux across boundaries equals $0$ in the steady state).\n- Spurious pressure oscillations are prevented near boundaries in the co-located arrangement.\n\nAssume that at the inlet $\\Gamma_{\\text{in}}$ a velocity profile $\\mathbf{u}_{\\text{in}}$ is prescribed, and at the outlet $\\Gamma_{\\text{out}}$ a static pressure $p_{\\text{out}}$ is prescribed. Let $p$ denote the pressure, $\\mathbf{u}$ the velocity, $\\hat{p}$ the pressure correction, $\\partial(\\cdot)/\\partial n$ the normal derivative at the boundary, and $\\mathbf{n}$ the outward unit normal. The face mass flux is $\\dot{m}_f = \\rho\\,\\mathbf{u}_f \\cdot \\mathbf{S}_f$, where $\\rho$ is the density and $\\mathbf{S}_f$ is the face area vector. You must choose a formulation that applies boundary conditions to $p$, $\\hat{p}$, and $\\mathbf{u}$ at $\\Gamma_{\\text{in}}$ and $\\Gamma_{\\text{out}}$, and specifies how to compute boundary face fluxes, in a way that satisfies the criteria above.\n\nWhich option provides a correct and complete boundary condition formulation?\n\nA. Inlet $\\Gamma_{\\text{in}}$: Dirichlet for velocity, $\\mathbf{u} = \\mathbf{u}_{\\text{in}}$; Neumann for pressure, $\\partial p/\\partial n = 0$; Neumann for pressure correction, $\\partial \\hat{p}/\\partial n = 0$. Outlet $\\Gamma_{\\text{out}}$: Dirichlet for pressure, $p = p_{\\text{out}}$; Dirichlet for pressure correction, $\\hat{p} = 0$; Neumann (or convective) for velocity, $\\partial \\mathbf{u}/\\partial n = 0$. Compute all boundary face velocities for mass fluxes using Rhie–Chow momentum interpolation based on adjacent interior momentum coefficients, ensuring that the pressure-gradient contribution is included at $\\Gamma_{\\text{out}}$ and that the prescribed $\\mathbf{u}_{\\text{in}}$ is enforced at $\\Gamma_{\\text{in}}$ without overriding the Rhie–Chow consistency in the pressure correction equation.\n\nB. Inlet $\\Gamma_{\\text{in}}$: Dirichlet for both velocity and pressure, $\\mathbf{u} = \\mathbf{u}_{\\text{in}}$ and $p = p_{\\text{in}}$; Outlet $\\Gamma_{\\text{out}}$: Neumann for pressure, $\\partial p/\\partial n = 0$; Neumann for pressure correction, $\\partial \\hat{p}/\\partial n = 0$; Neumann for velocity, $\\partial \\mathbf{u}/\\partial n = 0$. Compute boundary face velocities by direct linear interpolation of cell-centered velocities without Rhie–Chow momentum interpolation.\n\nC. Inlet $\\Gamma_{\\text{in}}$: Impose the volumetric flow rate by an integral constraint $\\int_{\\Gamma_{\\text{in}}} \\mathbf{u}\\cdot \\mathbf{n}\\, \\mathrm{d}S = Q_{\\text{in}}$, and Dirichlet for pressure, $p = p_{\\text{in}}$; Outlet $\\Gamma_{\\text{out}}$: Neumann for pressure, $\\partial p/\\partial n = 0$; Neumann for pressure correction, $\\partial \\hat{p}/\\partial n = 0$; Dirichlet for velocity, $\\mathbf{u} = \\mathbf{0}}$. Compute face velocities at all boundaries from the interior momentum stencil without special treatment.\n\nD. Inlet $\\Gamma_{\\text{in}}$: Dirichlet for velocity, $\\mathbf{u} = \\mathbf{u}_{\\text{in}}$; Neumann for pressure, $\\partial p/\\partial n = 0$; Neumann for pressure correction, $\\partial \\hat{p}/\\partial n = 0$. Outlet $\\Gamma_{\\text{out}}$: Dirichlet for pressure, $p = p_{\\text{out}}$; Dirichlet for pressure correction, $\\hat{p} = 0$; Neumann for velocity, $\\partial \\mathbf{u}/\\partial n = 0$. Compute boundary face velocities for mass fluxes by direct averaging of adjacent cell-centered velocities (no Rhie–Chow correction) and use the interior Rhie–Chow only away from boundaries.\n\nSelect the option that satisfies the stated criteria and is consistent with the governing equations $\\nabla\\cdot \\mathbf{u} = 0$ and the SIMPLE pressure-velocity coupling on a co-located grid.",
            "solution": "This problem requires selecting a boundary condition set for a velocity-inlet/pressure-outlet problem that is consistent with the physics of incompressible flow and stable for a co-located grid using the SIMPLE algorithm.\n\n*   **Inlet $\\Gamma_{\\text{in}}$:** The velocity profile $\\mathbf{u}_{\\text{in}}$ is prescribed, which is a Dirichlet condition for velocity. Since the velocity is fixed, it must not be altered by the pressure correction step. This implies that the velocity correction $\\hat{\\mathbf{u}}$ at the inlet is zero. As $\\hat{\\mathbf{u}}$ is driven by the gradient of the pressure correction $\\hat{p}$, a zero normal gradient (Neumann) condition, $\\partial \\hat{p}/\\partial n = 0$, is required for the pressure correction. For the pressure itself, a Dirichlet condition cannot be applied simultaneously with velocity at an inlet for incompressible flow. Therefore, pressure is typically extrapolated from the interior, leading to a Neumann condition, $\\partial p/\\partial n = 0$.\n\n*   **Outlet $\\Gamma_{\\text{out}}$:** The static pressure $p_{\\text{out}}$ is prescribed, which is a Dirichlet condition for pressure. This provides the necessary pressure reference for the whole domain. To ensure the pressure remains fixed at this value, the pressure correction $\\hat{p}$ at the outlet must be zero, which is a Dirichlet condition, $\\hat{p} = 0$. The velocity at the outlet is unknown and must be computed. A common and robust choice is to assume a fully developed flow profile, which translates to a zero normal gradient (Neumann) condition, $\\partial \\mathbf{u}/\\partial n = 0$.\n\n*   **Boundary Fluxes and Stability:** A critical aspect for stability on a co-located grid is the calculation of mass fluxes at the boundaries. At the inlet, the flux is known from the prescribed velocity. At the outlet, the flux is unknown. To prevent the pressure-velocity decoupling that co-located grids are prone to, the velocity at the outlet face must be computed using the Rhie–Chow interpolation principle. This ensures the outlet velocity is correctly coupled to the pressure gradient between the boundary face and the adjacent interior cell, suppressing spurious oscillations. Abandoning the Rhie–Chow method at the boundary, as suggested in some options, is a common mistake that leads to instability.\n\nAnalyzing the options:\n- **Option A** correctly implements all these conditions: Dirichlet for inlet velocity and outlet pressure; Neumann for inlet pressure and outlet velocity; corresponding Neumann and Dirichlet conditions for the pressure correction; and, crucially, consistent application of the Rhie-Chow principle for boundary flux calculation.\n- **Option B** is incorrect because it over-constrains the inlet (Dirichlet on both $\\mathbf{u}$ and $p$) and fails to use Rhie–Chow interpolation.\n- **Option C** is incorrect because it specifies $\\mathbf{u}=\\mathbf{0}$ at the outlet, which represents a wall, not an outflow boundary.\n- **Option D** correctly identifies the Dirichlet/Neumann conditions but is fatally flawed by recommending the abandonment of Rhie–Chow interpolation at the boundaries, which would re-introduce the decoupling problem.\n\nTherefore, Option A provides the only correct and complete formulation.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}