{
    "hands_on_practices": [
        {
            "introduction": "A robust numerical method begins with well-behaved discrete operators. This exercise takes us back to first principles, using truncation error analysis to rigorously assess the quality of the finite difference schemes on a staggered grid. By performing a Taylor series expansion, you will verify that the standard Marker-and-Cell (MAC) approximations for the gradient and divergence are second-order accurate on a uniform grid, providing a solid theoretical justification for the method's excellent performance .",
            "id": "3289961",
            "problem": "Consider a two-dimensional, incompressible flow governed by mass conservation, where the divergence of the velocity field must vanish, and the pressure gradient appears in the momentum balance. On a uniform rectangular grid with spatial step $h$ in both directions, adopt the Marker-and-Cell (MAC) staggered arrangement: the pressure $p$ resides at cell centers $(x_i,y_j)$, the horizontal velocity component $u$ resides at vertical face centers $(x_{i+\\frac{1}{2}},y_j)$, and the vertical velocity component $v$ resides at horizontal face centers $(x_i,y_{j+\\frac{1}{2}})$. \n\nLet the manufactured smooth fields be\n$$\nu(x,y) = \\sin(\\alpha x)\\sin(\\beta y), \\quad v(x,y) = \\cos(\\alpha x)\\cos(\\beta y), \\quad p(x,y) = \\sin(\\alpha x)\\cos(\\beta y),\n$$\nwith constants $\\alpha>0$ and $\\beta>0$. Define the discrete MAC divergence at a cell center $(x_0,y_0)$ by\n$$\nD_h[u,v](x_0,y_0) \\equiv \\frac{u(x_0+\\frac{h}{2},y_0)-u(x_0-\\frac{h}{2},y_0)}{h} + \\frac{v(x_0,y_0+\\frac{h}{2})-v(x_0,y_0-\\frac{h}{2})}{h},\n$$\nand define the discrete MAC pressure gradient components by\n$$\nG_h^x[p](x_0+\\tfrac{h}{2},y_0) \\equiv \\frac{p(x_0+h,y_0)-p(x_0,y_0)}{h}, \\qquad G_h^y[p](x_0,y_0+\\tfrac{h}{2}) \\equiv \\frac{p(x_0,y_0+h)-p(x_0,y_0)}{h}.\n$$\n\nStarting from the definitions of spatial derivatives and using Taylor series expansions anchored at the evaluation points, perform a truncation error analysis to obtain the leading-order terms of the local truncation errors of $D_h[u,v](x_0,y_0)$, $G_h^x[p](x_0+\\tfrac{h}{2},y_0)$, and $G_h^y[p](x_0,y_0+\\tfrac{h}{2})$ in powers of $h$ for a uniform grid. Explicitly show that these leading terms scale as $\\mathcal{O}(h^2)$, thereby demonstrating second-order consistency in space for the staggered MAC divergence and pressure gradient on uniform grids. Briefly indicate how this second-order consistency relates to one advantage of staggered grids, and note one drawback pertinent to implementation.\n\nFinally, evaluate the sum of the leading-order truncation errors\n$$\nS(h) \\equiv \\operatorname{TE}_{\\mathrm{div}}(x_0,y_0) + \\operatorname{TE}_{\\mathrm{grad},x}(x_0+\\tfrac{h}{2},y_0) + \\operatorname{TE}_{\\mathrm{grad},y}(x_0,y_0+\\tfrac{h}{2}),\n$$\nat the point $(x_0,y_0) = \\left(\\frac{1}{3},\\frac{1}{4}\\right)$ and express $S(h)$ as a single, closed-form analytic expression in terms of $\\alpha$, $\\beta$, and $h$. Express your final answer exactly; no rounding is required and no physical units are associated with the quantities here.",
            "solution": "The problem requires a truncation error analysis of the Marker-and-Cell (MAC) staggered grid finite difference operators for divergence and pressure gradient, a discussion of the method's properties, and an explicit calculation of the sum of leading-order error terms for a given set of manufactured fields.\n\nThe local truncation error (TE) of a discrete operator $L_h$ approximating a continuous differential operator $L$ for a function $f$ is defined as $\\operatorname{TE}[f] \\equiv L_h[f] - L[f]$. The leading-order term of the truncation error determines the order of accuracy of the discretization.\n\n**1. Truncation Error Analysis of the Discrete Divergence $D_h[u,v]$**\n\nThe discrete divergence at a cell center $(x_0, y_0)$ is given by:\n$$\nD_h[u,v](x_0,y_0) = \\frac{u(x_0+\\frac{h}{2},y_0)-u(x_0-\\frac{h}{2},y_0)}{h} + \\frac{v(x_0,y_0+\\frac{h}{2})-v(x_0,y_0-\\frac{h}{2})}{h}\n$$\nThe corresponding continuous operator is the divergence $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$, evaluated at $(x_0, y_0)$.\n\nWe use Taylor series expansions for $u$ and $v$ around the point $(x_0, y_0)$. For the first term involving $u$, we have:\n$$\nu(x_0 \\pm \\frac{h}{2}, y_0) = u(x_0,y_0) \\pm \\frac{h}{2}\\frac{\\partial u}{\\partial x}\\bigg|_{(x_0,y_0)} + \\frac{1}{2!}\\left(\\frac{h}{2}\\right)^2\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{(x_0,y_0)} \\pm \\frac{1}{3!}\\left(\\frac{h}{2}\\right)^3\\frac{\\partial^3 u}{\\partial x^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\nSubtracting the two expansions gives:\n$$\nu(x_0+\\frac{h}{2},y_0) - u(x_0-\\frac{h}{2},y_0) = h\\frac{\\partial u}{\\partial x}\\bigg|_{(x_0,y_0)} + \\frac{h^3}{24}\\frac{\\partial^3 u}{\\partial x^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^5)\n$$\nDividing by $h$, we get the approximation for $\\frac{\\partial u}{\\partial x}$:\n$$\n\\frac{u(x_0+\\frac{h}{2},y_0)-u(x_0-\\frac{h}{2},y_0)}{h} = \\frac{\\partial u}{\\partial x}\\bigg|_{(x_0,y_0)} + \\frac{h^2}{24}\\frac{\\partial^3 u}{\\partial x^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\nBy an identical analysis for the $v$ component with respect to $y$:\n$$\n\\frac{v(x_0,y_0+\\frac{h}{2})-v(x_0,y_0-\\frac{h}{2})}{h} = \\frac{\\partial v}{\\partial y}\\bigg|_{(x_0,y_0)} + \\frac{h^2}{24}\\frac{\\partial^3 v}{\\partial y^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\nSumming these two results gives the expansion for the discrete divergence operator:\n$$\nD_h[u,v](x_0,y_0) = \\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right)\\bigg|_{(x_0,y_0)} + \\frac{h^2}{24}\\left(\\frac{\\partial^3 u}{\\partial x^3} + \\frac{\\partial^3 v}{\\partial y^3}\\right)\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\nThe truncation error is $\\operatorname{TE}_{\\mathrm{div}} = D_h[u,v] - (\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y})$. The leading-order term is:\n$$\n\\operatorname{TE}_{\\mathrm{div}}(x_0,y_0) = \\frac{h^2}{24}\\left(\\frac{\\partial^3 u}{\\partial x^3} + \\frac{\\partial^3 v}{\\partial y^3}\\right)\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\nThis term is of order $\\mathcal{O}(h^2)$, so the operator is second-order accurate.\n\n**2. Truncation Error Analysis of the Discrete Pressure Gradient $G_h[p]$**\n\nThe discrete x-component of the pressure gradient is evaluated at the $u$-velocity location $(x_0+\\frac{h}{2},y_0)$:\n$$\nG_h^x[p](x_0+\\tfrac{h}{2},y_0) = \\frac{p(x_0+h,y_0)-p(x_0,y_0)}{h}\n$$\nWe analyze this by expanding $p(x_0+h, y_0)$ and $p(x_0, y_0)$ around the evaluation point $(x_0+\\frac{h}{2}, y_0)$. Let $x' = x_0+\\frac{h}{2}$. The stencil points are $x'+\\frac{h}{2}$ and $x'-\\frac{h}{2}$.\n$$\np(x' \\pm \\frac{h}{2}, y_0) = p(x',y_0) \\pm \\frac{h}{2}\\frac{\\partial p}{\\partial x}\\bigg|_{(x',y_0)} + \\frac{h^2}{8}\\frac{\\partial^2 p}{\\partial x^2}\\bigg|_{(x',y_0)} \\pm \\frac{h^3}{48}\\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x',y_0)} + \\mathcal{O}(h^4)\n$$\nThe standard central difference formula gives:\n$$\nG_h^x[p](x',y_0) = \\frac{\\partial p}{\\partial x}\\bigg|_{(x',y_0)} + \\frac{h^2}{24}\\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x',y_0)} + \\mathcal{O}(h^4)\n$$\nSubstituting $x' = x_0+\\frac{h}{2}$, the leading-order truncation error is:\n$$\n\\operatorname{TE}_{\\mathrm{grad},x}(x_0+\\tfrac{h}{2},y_0) = \\frac{h^2}{24}\\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x_0+h/2,y_0)} + \\mathcal{O}(h^4)\n$$\nThis operator is also second-order accurate. By symmetry, the analysis for the y-component of the gradient, evaluated at $(x_0, y_0+\\frac{h}{2})$, yields:\n$$\n\\operatorname{TE}_{\\mathrm{grad},y}(x_0,y_0+\\tfrac{h}{2}) = \\frac{h^2}{24}\\frac{\\partial^3 p}{\\partial y^3}\\bigg|_{(x_0,y_0+h/2)} + \\mathcal{O}(h^4)\n$$\nThis demonstrates second-order consistency for both the discrete divergence and pressure gradient operators on a uniform staggered grid.\n\n**3. Advantage and Drawback of Staggered Grids**\n\nAn important advantage of the staggered grid arrangement is the strong, natural coupling it creates between pressure and velocity. For a collocated grid (all variables at the same nodes), a simple central difference for the pressure gradient would only involve non-adjacent pressure nodes (e.g., $p_{i+1}$ and $p_{i-1}$ to compute the gradient at node $i$). This can lead to a decoupling where high-frequency, non-physical \"checkerboard\" oscillations in the pressure field are not \"felt\" by the discrete gradient operator, and thus do not affect the velocity field. The staggered grid prevents this by computing velocity on cell faces using the pressure values in the adjacent cells (e.g., $u_{i+1/2}$ is driven by $p_{i+1}-p_i$), ensuring that a pressure difference across a cell directly influences the flow through it.\n\nA primary drawback is the increased implementation complexity. Managing different variable locations requires more complex data structures and indexing logic. Boundary condition implementation is also more intricate, as different variables are located at different distances from the physical boundary. This complexity is exacerbated on non-Cartesian grids.\n\n**4. Calculation of the Sum of Leading-Order Truncation Errors**\n\nWe need to evaluate the sum $S(h)$ of the leading-order truncation error terms:\n$$\nS(h) = \\frac{h^2}{24}\\left[ \\left(\\frac{\\partial^3 u}{\\partial x^3} + \\frac{\\partial^3 v}{\\partial y^3}\\right)\\bigg|_{(x_0,y_0)} + \\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x_0+h/2,y_0)} + \\frac{\\partial^3 p}{\\partial y^3}\\bigg|_{(x_0,y_0+h/2)} \\right]\n$$\nFirst, we compute the required third derivatives from the given manufactured solutions:\n$u(x,y) = \\sin(\\alpha x)\\sin(\\beta y)$\n$v(x,y) = \\cos(\\alpha x)\\cos(\\beta y)$\n$p(x,y) = \\sin(\\alpha x)\\cos(\\beta y)$\n\nThe derivatives are:\n$\\frac{\\partial^3 u}{\\partial x^3} = -\\alpha^3 \\cos(\\alpha x)\\sin(\\beta y)$\n$\\frac{\\partial^3 v}{\\partial y^3} = \\beta^3 \\cos(\\alpha x)\\sin(\\beta y)$\n$\\frac{\\partial^3 p}{\\partial x^3} = -\\alpha^3 \\cos(\\alpha x)\\cos(\\beta y)$\n$\\frac{\\partial^3 p}{\\partial y^3} = \\beta^3 \\sin(\\alpha x)\\sin(\\beta y)$\n\nNow, we assemble the expression for $S(h)$:\n$$\nS(h) = \\frac{h^2}{24}\\left[ \\left(-\\alpha^3 \\cos(\\alpha x)\\sin(\\beta y) + \\beta^3 \\cos(\\alpha x)\\sin(\\beta y)\\right)\\bigg|_{(x_0,y_0)} \\right. \\\\ \\left. + \\left(-\\alpha^3 \\cos(\\alpha x)\\cos(\\beta y)\\right)\\bigg|_{(x_0+h/2,y_0)} + \\left(\\beta^3 \\sin(\\alpha x)\\sin(\\beta y)\\right)\\bigg|_{(x_0,y_0+h/2)} \\right]\n$$\nSimplifying the first term:\n$$\nS(h) = \\frac{h^2}{24}\\left[ (\\beta^3 - \\alpha^3)\\cos(\\alpha x_0)\\sin(\\beta y_0) - \\alpha^3 \\cos\\left(\\alpha(x_0+\\frac{h}{2})\\right)\\cos(\\beta y_0) \\right. \\\\ \\left. + \\beta^3 \\sin(\\alpha x_0)\\sin\\left(\\beta(y_0+\\frac{h}{2})\\right) \\right]\n$$\nFinally, we substitute the specified point $(x_0, y_0) = (\\frac{1}{3}, \\frac{1}{4})$:\n$$\nS(h) = \\frac{h^2}{24}\\left[ (\\beta^3 - \\alpha^3)\\cos\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\frac{\\beta}{4}\\right) - \\alpha^3 \\cos\\left(\\alpha\\left(\\frac{1}{3}+\\frac{h}{2}\\right)\\right)\\cos\\left(\\frac{\\beta}{4}\\right) \\right. \\\\ \\left. + \\beta^3 \\sin\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\beta\\left(\\frac{1}{4}+\\frac{h}{2}\\right)\\right) \\right]\n$$\nThis is the final closed-form analytic expression for the sum of the leading-order truncation errors.",
            "answer": "$$\n\\boxed{\\frac{h^2}{24} \\left[ (\\beta^3 - \\alpha^3)\\cos\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\frac{\\beta}{4}\\right) - \\alpha^3 \\cos\\left(\\frac{\\alpha}{3}+\\frac{\\alpha h}{2}\\right)\\cos\\left(\\frac{\\beta}{4}\\right) + \\beta^3 \\sin\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\frac{\\beta}{4}+\\frac{\\beta h}{2}\\right) \\right]}\n$$"
        },
        {
            "introduction": "The primary motivation for the staggered grid is its ability to prevent the emergence of spurious pressure oscillations, a notorious problem in simple collocated grid arrangements. This hands-on coding exercise is designed to provide a dramatic and quantitative illustration of this phenomenon. You will implement both collocated and staggered operators and apply them to a \"checkerboard\" pressure field, directly observing how the collocated scheme fails to detect this non-physical mode while the staggered scheme correctly resolves it .",
            "id": "3289986",
            "problem": "Consider the two-dimensional incompressible pressure–velocity coupling in Computational Fluid Dynamics (CFD), where pressure gradients drive velocity updates and the discrete divergence operator enforces mass conservation. Odd–even decoupling and checkerboarding of pressure arise in collocated arrangements when central differences are used improperly, while staggered arrangements suppress these modes. Design a manufactured solution and discrete operators to quantify this phenomenon in a purely mathematical setting.\n\nUse a square periodic domain $[0,1]\\times[0,1]$ discretized into $N\\times N$ uniform cells of size $\\Delta x=\\Delta y=1/N$. Pressure $p$ is defined at cell centers $(x_i,y_j)$ with $x_i=(i+\\tfrac{1}{2})\\Delta x$ and $y_j=(j+\\tfrac{1}{2})\\Delta y$, for indices $i,j\\in\\{0,1,\\dots,N-1\\}$.\n\nManufactured solutions:\n- Checkerboard (Nyquist) mode: $p_{i,j}=(-1)^{i+j}$, which corresponds to the grid-scale alternating pattern.\n- Smooth mode: $p_{i,j}=\\sin(2\\pi x_i)\\sin(2\\pi y_j)$.\n\nDiscrete operators with periodic boundary conditions:\n1. Collocated central-difference gradient and divergence at cell centers:\n   - Gradient at centers:\n     $$G_{x}^{c}(i,j)=\\frac{p_{i+1,j}-p_{i-1,j}}{2\\Delta x},\\quad G_{y}^{c}(i,j)=\\frac{p_{i,j+1}-p_{i,j-1}}{2\\Delta y}.$$\n   - Divergence of gradient at centers:\n     $$D^{c}G^{c}(i,j)=\\frac{G_{x}^{c}(i+1,j)-G_{x}^{c}(i-1,j)}{2\\Delta x}+\\frac{G_{y}^{c}(i,j+1)-G_{y}^{c}(i,j-1)}{2\\Delta y}.$$\n2. Staggered gradient at faces and divergence to centers (flux differences):\n   - Face gradients:\n     $$G_{x}^{s}(i+\\tfrac{1}{2},j)=\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x},\\quad G_{y}^{s}(i,j+\\tfrac{1}{2})=\\frac{p_{i,j+1}-p_{i,j}}{\\Delta y}.$$\n   - Divergence of face gradients to centers:\n     $$D^{s}G^{s}(i,j)=\\frac{G_{x}^{s}(i+\\tfrac{1}{2},j)-G_{x}^{s}(i-\\tfrac{1}{2},j)}{\\Delta x}+\\frac{G_{y}^{s}(i,j+\\tfrac{1}{2})-G_{y}^{s}(i,j-\\tfrac{1}{2})}{\\Delta y}.$$\n\nDefine the five-point discrete Laplacian as the reference operator:\n$$L p_{i,j}=\\frac{p_{i+1,j}+p_{i-1,j}+p_{i,j+1}+p_{i,j-1}-4p_{i,j}}{\\Delta x^{2}}.$$\n\nDefine the discrete $L^{2}$ norm for a grid function $q_{i,j}$ by\n$$\\|q\\|_{2}=\\sqrt{\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} q_{i,j}^{2}\\,\\Delta x\\,\\Delta y}.$$\n\nFor each test case, compute:\n- The $L^{2}$ error $E=\\|D^{\\star}G^{\\star}p-Lp\\|_{2}$, where $\\star\\in\\{c,s\\}$ denotes collocated or staggered.\n- The checkerboarding amplitude ratio $A=\\|D^{\\star}G^{\\star}p\\|_{2}/\\|Lp\\|_{2}$.\n\nScientific rationale to be investigated:\n- Show that the collocated operator $D^{c}G^{c}$ annihilates the Nyquist checkerboard mode, i.e., yields $A\\approx 0$, which demonstrates odd–even decoupling and spurious pressure modes.\n- Show that the staggered operator $D^{s}G^{s}$ matches the reference Laplacian on both modes, i.e., yields $A\\approx 1$ and $E\\approx 0$, thereby suppressing checkerboarding.\n\nPhysical and numerical units:\n- There are no physical units; all quantities are nondimensional. Angles (if any) are in radians, but only trigonometric functions of nondimensional arguments are used.\n\nTest suite:\n- Case 1: $N=8$, checkerboard mode, collocated.\n- Case 2: $N=8$, checkerboard mode, staggered.\n- Case 3: $N=32$, checkerboard mode, collocated.\n- Case 4: $N=4$, checkerboard mode, collocated (boundary coarse grid).\n- Case 5: $N=32$, smooth mode, collocated.\n- Case 6: $N=32$, smooth mode, staggered.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must be a two-element list $[E,A]$ of floats in that order. For example, the output format must be\n$$[ [E_{1},A_{1}], [E_{2},A_{2}], \\dots ]$$\nwith no additional text.",
            "solution": "The objective is to quantify the response of collocated and staggered grid arrangements to specific pressure fields. The core of the analysis lies in expanding the composite divergence-of-gradient operators, $D^{\\star}G^{\\star}$, and comparing them to the reference five-point Laplacian, $L$. All index arithmetic is performed modulo $N$ to enforce periodic boundary conditions.\n\n**Staggered Operator Analysis**\nFirst, we analyze the staggered operator, $D^{s}G^{s}$. By substituting the definitions of the face gradients into the divergence expression, we obtain the operator's action on the pressure field $p_{i,j}$.\nThe $x$-component of the divergence is:\n$$ \\frac{G_{x}^{s}(i+\\frac{1}{2},j)-G_{x}^{s}(i-\\frac{1}{2},j)}{\\Delta x} = \\frac{1}{\\Delta x} \\left( \\frac{p_{i+1,j}-p_{i,j}}{\\Delta x} - \\frac{p_{i,j}-p_{i-1,j}}{\\Delta x} \\right) = \\frac{p_{i+1,j}-2p_{i,j}+p_{i-1,j}}{\\Delta x^2} $$\nThe $y$-component is analogous. Summing them and noting that $\\Delta x = \\Delta y$, we find:\n$$ D^{s}G^{s}p_{i,j} = \\frac{p_{i+1,j}-2p_{i,j}+p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1}-2p_{i,j}+p_{i,j-1}}{\\Delta y^2} = \\frac{p_{i+1,j}+p_{i-1,j}+p_{i,j+1}+p_{i,j-1}-4p_{i,j}}{\\Delta x^2} $$\nThis expression is identical to the definition of the reference five-point Laplacian, $Lp_{i,j}$.\n$$ D^{s}G^{s}p_{i,j} \\equiv Lp_{i,j} $$\nTherefore, for the staggered arrangement, the error $E=\\|D^{s}G^{s}p-Lp\\|_{2}$ will be identically zero (up to machine precision), and the amplitude ratio $A=\\|D^{s}G^{s}p\\|_{2}/\\|Lp\\|_{2}$ will be identically one for any pressure field where $\\|Lp\\|_2 \\neq 0$. This scheme correctly represents the pressure Laplacian.\n\n**Collocated Operator Analysis**\nNext, we analyze the collocated operator, $D^{c}G^{c}$. We substitute the central-difference gradient into the central-difference divergence.\nThe $x$-component of the divergence is:\n$$ \\frac{G_{x}^{c}(i+1,j)-G_{x}^{c}(i-1,j)}{2\\Delta x} = \\frac{1}{2\\Delta x} \\left( \\frac{p_{i+2,j}-p_{i,j}}{2\\Delta x} - \\frac{p_{i,j}-p_{i-2,j}}{2\\Delta x} \\right) = \\frac{p_{i+2,j}-2p_{i,j}+p_{i-2,j}}{4\\Delta x^2} $$\nThe $y$-component is analogous. Summing them yields:\n$$ D^{c}G^{c}p_{i,j} = \\frac{p_{i+2,j}+p_{i-2,j}+p_{i,j+2}+p_{i,j-2}-4p_{i,j}}{4\\Delta x^2} $$\nThis operator is a five-point Laplacian, but it operates on a stencil with a spacing of $2\\Delta x$, not $\\Delta x$. This difference in stencils is the root cause of the decoupling phenomenon.\n\n**Application to Manufactured Solutions**\n\n1. **Checkerboard (Nyquist) Mode:** $p_{i,j} = (-1)^{i+j}$\n   - **Collocated Operator:** We apply the expanded $D^{c}G^{c}$ operator. Note that $p_{i\\pm 2,j} = (-1)^{(i\\pm 2)+j} = (-1)^2 (-1)^{i+j} = p_{i,j}$. Similarly, $p_{i,j\\pm 2} = p_{i,j}$. Substituting these into the operator expression gives:\n     $$ D^{c}G^{c}p_{i,j} = \\frac{p_{i,j}+p_{i,j}+p_{i,j}+p_{i,j}-4p_{i,j}}{4\\Delta x^2} = 0 $$\n     The collocated operator annihilates the checkerboard mode. It lies in the operator's null space. This means $\\|D^{c}G^{c}p\\|_{2} = 0$, and thus the amplitude ratio $A=0$. This is the mathematical signature of odd-even decoupling: a non-zero pressure mode produces a zero pressure gradient, failing to drive fluid motion.\n   - **Reference Laplacian:** Applying $L$ to the checkerboard mode: $p_{i\\pm 1, j} = -p_{i,j}$ and $p_{i, j\\pm 1} = -p_{i,j}$.\n     $$ Lp_{i,j} = \\frac{-p_{i,j}-p_{i,j}-p_{i,j}-p_{i,j}-4p_{i,j}}{\\Delta x^2} = \\frac{-8p_{i,j}}{\\Delta x^2} = -8N^2 p_{i,j} $$\n     This is clearly non-zero. The error is $E = \\|D^{c}G^{c}p - Lp\\|_{2} = \\|0 - Lp\\|_{2} = \\|Lp\\|_{2}$.\n     We can calculate this norm:\n     $$ \\|Lp\\|_{2}^2 = \\sum_{i,j=0}^{N-1} (-8N^2 p_{i,j})^2 \\Delta x \\Delta y = \\sum_{i,j=0}^{N-1} 64N^4 ((-1)^{i+j})^2 \\frac{1}{N^2} = \\frac{64N^4}{N^2} \\sum_{i,j=0}^{N-1} 1 = 64N^2 \\cdot N^2 = 64N^4 $$\n     Thus, $E = \\|Lp\\|_{2} = \\sqrt{64N^4} = 8N^2$.\n   - **Staggered Operator:** As shown, $D^s G^s p = Lp$. Therefore, $E=0$ and $A=1$. The staggered scheme correctly resolves the checkerboard mode.\n\n2. **Smooth Mode:** $p_{i,j} = \\sin(2\\pi x_i)\\sin(2\\pi y_j)$\n   - **Staggered Operator:** Again, $D^s G^s p = Lp$, so $E=0$ and $A=1$. The operator is exact relative to the reference Laplacian.\n   - **Collocated Operator:** Both operators $D^c G^c$ and $L$ are second-order accurate approximations of the continuous Laplacian $\\nabla^2$. However, they are not identical. Their truncation errors differ.\n     For a smooth function $f(x)$, the leading error terms are:\n     $$ Lf - f'' = \\frac{\\Delta x^2}{12} f^{(4)} + O(\\Delta x^4) $$\n     $$ (D^c G^c f)_{\\text{1D}} - f'' = \\frac{(2\\Delta x)^2}{12} f^{(4)} + O(\\Delta x^4) = \\frac{4\\Delta x^2}{12} f^{(4)} + O(\\Delta x^4) $$\n     The collocated operator has a truncation error four times larger. Their difference, $D^c G^c p - Lp$, is non-zero, resulting in a non-zero error $E$. Since both operators provide a reasonable approximation of the same underlying continuous operator for this smooth, long-wavelength mode, their norms will be similar, leading to an amplitude ratio $A \\approx 1$.\n\n**Summary of Predictions**\n- **Cases 1, 3, 4 (Checkerboard, Collocated):** $A=0$, $E=8N^2$.\n- **Case 2 (Checkerboard, Staggered):** $A=1$, $E=0$.\n- **Case 5 (Smooth, Collocated):** $A \\approx 1$, $E > 0$.\n- **Case 6 (Smooth, Staggered):** $A=1$, $E=0$.\n\nThese theoretical predictions will be verified by the numerical implementation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_case(N, mode, op_type):\n    \"\"\"\n    Computes the error E and amplitude ratio A for a single test case.\n    \n    Args:\n        N (int): Number of grid cells in each dimension.\n        mode (str): Type of manufactured solution ('checkerboard' or 'smooth').\n        op_type (str): Type of discrete operator ('collocated' or 'staggered').\n\n    Returns:\n        tuple: A tuple containing the L2 error (E) and amplitude ratio (A).\n    \"\"\"\n    dx = 1.0 / N\n    dy = 1.0 / N\n\n    # Define grid indices and coordinates\n    i_indices = np.arange(N)\n    j_indices = np.arange(N)\n    ii, jj = np.meshgrid(i_indices, j_indices, indexing='ij')\n\n    # Construct the pressure field p\n    if mode == 'checkerboard':\n        p = (-1.0)**(ii + jj)\n    elif mode == 'smooth':\n        # Cell-centered coordinates\n        x = (ii + 0.5) * dx\n        y = (jj + 0.5) * dy\n        p = np.sin(2.0 * np.pi * x) * np.sin(2.0 * np.pi * y)\n    else:\n        raise ValueError(\"Unknown mode type\")\n\n    # --- Operator Calculations ---\n\n    # Periodic shifts for stencils\n    # i-direction shifts\n    p_ip1 = np.roll(p, -1, axis=0) # Index i+1\n    p_im1 = np.roll(p,  1, axis=0) # Index i-1\n    # j-direction shifts\n    p_jp1 = np.roll(p, -1, axis=1) # Index j+1\n    p_jm1 = np.roll(p,  1, axis=1) # Index j-1\n\n    # 1. Reference 5-point Laplacian (Lp)\n    # Since dx = dy, we use dx**2\n    Lp = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4.0 * p) / (dx**2)\n\n    # 2. Divergence-of-Gradient operator (DGp)\n    if op_type == 'collocated':\n        # Expanded form of D^c G^c operator\n        # This stencil uses points at i±2 and j±2\n        p_ip2 = np.roll(p, -2, axis=0)\n        p_im2 = np.roll(p,  2, axis=0)\n        p_jp2 = np.roll(p, -2, axis=1)\n        p_jm2 = np.roll(p,  2, axis=1)\n        DGp = (p_ip2 + p_im2 + p_jp2 + p_jm2 - 4.0 * p) / (4.0 * dx**2)\n    elif op_type == 'staggered':\n        # Expanded form of D^s G^s operator, which is identical to Lp\n        DGp = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4.0 * p) / (dx**2)\n    else:\n        raise ValueError(\"Unknown operator type\")\n\n    # --- Metric Calculations ---\n\n    def l2_norm(q_grid):\n        \"\"\"Computes the discrete L2 norm of a grid function.\"\"\"\n        cell_area = dx * dy\n        return np.sqrt(np.sum(q_grid**2 * cell_area))\n\n    # Calculate norms of the operator outputs\n    norm_Lp = l2_norm(Lp)\n    norm_DGp = l2_norm(DGp)\n    \n    # Calculate the L2 error E\n    error_field = DGp - Lp\n    E = l2_norm(error_field)\n\n    # Calculate the amplitude ratio A\n    # Avoid division by zero, although not expected for these test cases\n    if norm_Lp < 1e-15:\n        # If Lp is zero, A is undefined. If DGp is also zero, 1 is a plausible value.\n        # If DGp is non-zero, the ratio is infinite.\n        A = 1.0 if norm_DGp < 1e-15 else np.inf\n    else:\n        A = norm_DGp / norm_Lp\n\n    return E, A\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N, mode, operator_type)\n        (8, 'checkerboard', 'collocated'),\n        (8, 'checkerboard', 'staggered'),\n        (32, 'checkerboard', 'collocated'),\n        (4, 'checkerboard', 'collocated'),\n        (32, 'smooth', 'collocated'),\n        (32, 'smooth', 'staggered'),\n    ]\n\n    results = []\n    for N, mode, op_type in test_cases:\n        E, A = compute_case(N, mode, op_type)\n        results.append([E, A])\n\n    # Format the output as a list of lists string\n    # e.g., [[E1,A1],[E2,A2],...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond simply preventing oscillations, the choice of grid has profound implications for the mathematical structure and stability of the discretized system. This practice delves into the linear algebra of pressure-velocity coupling by analyzing the eigenvalue spectrum of the complete system matrix. You will discover that the collocated grid introduces spurious near-null eigenvalues, corresponding to non-physical pressure modes that contaminate the solution, while the staggered grid formulation results in a well-posed system that correctly reflects the physics of the underlying Stokes equations .",
            "id": "3289928",
            "problem": "Consider the steady, one-dimensional incompressible Stokes equations on a periodic domain of length $1$, written as $-\\nu \\, \\partial_{xx} u + \\partial_x p = f$ and $\\partial_x u = 0$, where $u$ is velocity, $p$ is pressure, $\\nu &gt; 0$ is kinematic viscosity, and $f$ is a prescribed body force. Let $\\nu = 1$ and $f \\equiv 0$. Discretize the system on two grids: a collocated grid and a staggered Marker-and-Cell (MAC) grid, both with periodic boundary conditions. Use a uniform mesh with $N$ points, mesh size $h = 1/N$, and indices taken modulo $N$.\n\nDefine the discrete saddle-point system for each grid as the block matrix\n$$\nK = \\begin{bmatrix}\nA &amp; G \\\\\n-D &amp; 0\n\\end{bmatrix},\n$$\nwhere $A$ is the discrete diffusion operator for velocity, $D$ is the discrete divergence, and $G$ is the discrete gradient. On both grids impose the symmetry-compatible choice $G = -D^\\top$ so that $K$ is symmetric indefinite.\n\nFor the collocated grid:\n- Place both $u$ and $p$ at cell centers $x_i = i h$, for $i = 0, \\dots, N-1$.\n- Use the standard second-difference Laplacian for $A$ at cell centers:\n$$\n(A u)_i = \\nu \\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2}.\n$$\n- Use the centered-difference divergence for $D$ at cell centers:\n$$\n(D u)_i = \\frac{u_{i+1} - u_{i-1}}{2 h}.\n$$\n- Set $G = -D^\\top$.\n\nFor the staggered Marker-and-Cell (MAC) grid:\n- Place $u$ at faces $x_{i+\\frac{1}{2}} = (i+\\frac{1}{2}) h$ and $p$ at cell centers $x_i = i h$, for $i = 0, \\dots, N-1$.\n- Use the standard second-difference Laplacian for $A$ at face locations:\n$$\n(A u)_{i+\\frac{1}{2}} = \\nu \\frac{u_{i+\\frac{3}{2}} - 2 u_{i+\\frac{1}{2}} + u_{i-\\frac{1}{2}}}{h^2}.\n$$\n- Use the one-sided difference divergence from faces to centers for $D$:\n$$\n(D u)_i = \\frac{u_{i+\\frac{1}{2}} - u_{i-\\frac{1}{2}}}{h}.\n$$\n- Set $G = -D^\\top$.\n\nFor each grid, assemble $K$ as a $2N \\times 2N$ matrix using periodic wrap-around indexing. Compute all eigenvalues $\\{\\lambda_j\\}$ of $K$ and classify an eigenvalue as near-null if $|\\lambda_j| \\le \\tau$, where $\\tau = \\varepsilon \\cdot \\rho$ with $\\rho = \\max_j |\\lambda_j|$ and $\\varepsilon = 10^{-8}$.\n\nTask:\n- Implement a program that for each specified $N$ constructs both discretizations (collocated and MAC), assembles the corresponding $K$, computes all eigenvalues, and counts the number of near-null eigenvalues for each grid using the threshold $\\tau$ defined above.\n- For each test case $N$, output the triple $[n_{\\mathrm{MAC}}, n_{\\mathrm{COL}}, n_{\\mathrm{COL}} - n_{\\mathrm{MAC}}]$, where $n_{\\mathrm{MAC}}$ is the near-null count for the MAC grid and $n_{\\mathrm{COL}}$ is the near-null count for the collocated grid.\n\nUse the following test suite of grid sizes:\n- $N = 4$ (boundary-size even grid),\n- $N = 5$ (odd grid to probe the behavior of alternating patterns),\n- $N = 8$ (moderate even grid, happy path),\n- $N = 32$ (larger even grid).\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each element formatted as a triple in square brackets with no spaces. For example:\n- If there are four test cases, the output must look like\n$$\n[[a_1,b_1,c_1],[a_2,b_2,c_2],[a_3,b_3,c_3],[a_4,b_4,c_4]]\n$$\nwhere each $a_k$, $b_k$, and $c_k$ is an integer.",
            "solution": "This problem requires an analysis of the eigenvalues of the discrete saddle-point operator $K$ for the Stokes equations, which provides insight into the stability of the collocated and staggered grid discretizations. An eigenvalue of zero corresponds to a non-trivial vector $(u, p)$ in the null space of $K$. The dimension of this null space is a critical property of the discretization.\n\nThe system of equations to find the null space of $K = \\begin{bmatrix} A & -D^\\top \\\\ -D & 0 \\end{bmatrix}$ is:\n$$\n\\begin{cases}\nA u - D^\\top p = 0 \\\\\n-D u = 0\n\\end{cases}\n$$\n\n**Continuous System Analysis**\nFirst, consider the continuous problem on a periodic domain. The null space is determined by the equations $\\partial_x u = 0$ and $-\\nu \\partial_{xx} u + \\partial_x p = 0$.\n1.  From $\\partial_x u = 0$, the velocity $u$ must be a constant, $u(x) = c_1$.\n2.  Substituting this into the momentum equation gives $-\\nu \\partial_{xx} c_1 + \\partial_x p = 0$, which simplifies to $\\partial_x p = 0$. Thus, the pressure $p$ must also be a constant, $p(x) = c_2$.\nThe null space is therefore spanned by the pairs $(u, p) = (c_1, 0)$ (constant velocity mode, a physical rigid-body motion) and $(u, p) = (0, c_2)$ (constant pressure mode, a gauge freedom since pressure is only determined up to a constant). The continuous operator has a two-dimensional null space. A stable discretization should replicate this property.\n\n**Staggered (MAC) Grid Analysis**\nOn the MAC grid, the divergence operator is $(D u)_i = (u_{i+1/2} - u_{i-1/2})/h$.\n- The condition $Du = 0$ implies $u_{i+1/2} - u_{i-1/2} = 0$ for all $i=0, \\dots, N-1$. Due to periodicity, this means all velocity components are equal: $u_{1/2} = u_{3/2} = \\dots = u_{N-1/2}$. The null space of $D$, $\\ker(D)$, consists only of constant velocity vectors. So, any null-space velocity mode $u$ must be a constant vector, $u = c_1 \\vec{1}$.\n- The gradient-like operator in the system is $-D^\\top$. Its action is $(-D^\\top p)_{i+1/2} = (p_i - p_{i+1})/h$. The condition $D^\\top p = 0$ implies $p_i - p_{i+1} = 0$ for all $i$, meaning $p$ is a constant vector, $p = c_2 \\vec{1}$.\n- Now we check the full system.\n  1. For the constant pressure mode $(u, p) = (0, c_2\\vec{1})$: $A(0) - D^\\top(c_2\\vec{1}) = 0$ (since $D^\\top$ annihilates constant vectors) and $-D(0) = 0$. This is a null vector.\n  2. For the constant velocity mode $(u, p) = (c_1\\vec{1}, 0)$: $-D(c_1\\vec{1}) = 0$ (since $D$ annihilates constant vectors) and $A(c_1\\vec{1}) - D^\\top(0) = 0$ (since the discrete Laplacian $A$ also annihilates constant vectors on a periodic domain). This is also a null vector.\nThe null space of $K_{\\mathrm{MAC}}$ is spanned by $(\\vec{1}, 0)$ and $(0, \\vec{1})$, correctly reproducing the two-dimensional null space of the continuous operator. We expect to find $n_{\\mathrm{MAC}} = 2$ near-null eigenvalues for all $N$.\n\n**Collocated Grid Analysis**\nOn the collocated grid, the divergence operator is $(D u)_i = (u_{i+1} - u_{i-1})/(2h)$.\n- The condition $Du = 0$ implies $u_{i+1} = u_{i-1}$ for all $i$. This means values at even indices are equal ($u_0 = u_2 = u_4 = \\dots$) and values at odd indices are equal ($u_1 = u_3 = u_5 = \\dots$).\n  - If $N$ is odd, this forces all elements to be equal, so $\\ker(D)$ contains only constant vectors, just like the MAC grid.\n  - If $N$ is even, $\\ker(D)$ is two-dimensional. It is spanned by the constant vector $\\vec{1} = (1, 1, \\dots, 1)^\\top$ and the high-frequency \"checkerboard\" or \"zig-zag\" mode $u_s = (1, -1, 1, -1, \\dots)^\\top$. This $u_s$ mode is unphysical and is a known artifact of this discretization, leading to instability.\n- The operator $D$ is skew-symmetric ($D^\\top = -D$), so $\\ker(D^\\top) = \\ker(D)$. This means $D^\\top$ also annihilates constant vectors and, for even $N$, the checkerboard mode.\n- We now check the null space of $K_{\\mathrm{COL}}$. The physical modes $(\\vec{1}, 0)$ and $(0, \\vec{1})$ are in the null space for the same reasons as in the MAC case. This gives two null modes for any $N$.\n- Consider the case where $N$ is even. An additional, spurious pressure mode may exist. Let's test the pair $(u, p) = (0, p_s)$, where $p_s$ is the checkerboard mode.\n  1. Is $-Du = -D(0) = 0$? Yes.\n  2. Is $Au - D^\\top p_s = A(0) - D^\\top p_s = -D^\\top p_s = 0$? Yes, because $p_s \\in \\ker(D^\\top)$.\n  Therefore, for even $N$, $(0, p_s)$ is a null vector of $K_{\\mathrm{COL}}$. This is a purely numerical artifact, a spurious pressure mode.\n- The null space of $K_{\\mathrm{COL}}$ is thus three-dimensional for even $N$, spanned by $(\\vec{1}, 0)$, $(0, \\vec{1})$, and $(0, p_s)$. For odd $N$, the checkerboard mode does not exist in $\\ker(D)$, so the null space is two-dimensional.\n\n**Predicted Results**\n- For $N=4, 8, 32$ (even): $n_{\\mathrm{MAC}}=2$, $n_{\\mathrm{COL}}=3$. The triple is $[2, 3, 1]$.\n- For $N=5$ (odd): $n_{\\mathrm{MAC}}=2$, $n_{\\mathrm{COL}}=2$. The triple is $[2, 2, 0]$.\n\nThe following code implements the construction of these matrices and numerically verifies these predictions by computing the eigenvalues.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_matrices(N, grid_type):\n    \"\"\"\n    Constructs the discrete operators A and D for a given grid size and type.\n\n    Args:\n        N (int): The number of grid points.\n        grid_type (str): Either 'collocated' or 'mac'.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]: The matrices A and D.\n    \"\"\"\n    if not isinstance(N, int) or N <= 0:\n        raise ValueError(\"N must be a positive integer.\")\n\n    h = 1.0 / N\n    nu = 1.0\n\n    A = np.zeros((N, N), dtype=float)\n    D = np.zeros((N, N), dtype=float)\n\n    if grid_type == 'collocated':\n        for i in range(N):\n            # A matrix: Standard second-difference Laplacian at cell centers\n            A[i, i] = -2.0 * nu / h**2\n            A[i, (i - 1) % N] += 1.0 * nu / h**2\n            A[i, (i + 1) % N] += 1.0 * nu / h**2\n\n            # D matrix: Centered-difference divergence at cell centers\n            D[i, (i + 1) % N] = 1.0 / (2.0 * h)\n            D[i, (i - 1) % N] = -1.0 / (2.0 * h)\n            \n    elif grid_type == 'mac':\n        for i in range(N):\n            # A matrix: Standard second-difference Laplacian at faces\n            # The structure is identical to the collocated grid's A matrix\n            A[i, i] = -2.0 * nu / h**2\n            A[i, (i - 1) % N] += 1.0 * nu / h**2\n            A[i, (i + 1) % N] += 1.0 * nu / h**2\n\n            # D matrix: One-sided difference from faces to centers\n            D[i, i] = 1.0 / h\n            D[i, (i - 1) % N] = -1.0 / h\n    else:\n        raise ValueError(\"Invalid grid_type. Must be 'collocated' or 'mac'.\")\n\n    return A, D\n\ndef assemble_saddle_point_matrix(A, D):\n    \"\"\"\n    Assembles the symmetric saddle-point matrix K.\n\n    K = [ A  -D^T ]\n        [ -D   0  ]\n\n    Args:\n        A (np.ndarray): The N x N diffusion matrix.\n        D (np.ndarray): The N x N divergence matrix.\n\n    Returns:\n        np.ndarray: The 2N x 2N saddle-point matrix K.\n    \"\"\"\n    N = A.shape[0]\n    K = np.zeros((2 * N, 2 * N), dtype=float)\n    \n    # Upper-left block (A)\n    K[:N, :N] = A\n    # Upper-right block (G = -D^T)\n    K[:N, N:] = -D.T\n    # Lower-left block (-D)\n    K[N:, :N] = -D\n    # Lower-right block is zero\n\n    return K\n\ndef count_near_null_eigenvalues(K, epsilon=1e-8):\n    \"\"\"\n    Computes eigenvalues of K and counts how many are near-null.\n\n    Args:\n        K (np.ndarray): The matrix to analyze.\n        epsilon (float): Relative tolerance for defining \"near-null\".\n\n    Returns:\n        int: The number of near-null eigenvalues.\n    \"\"\"\n    # K is constructed to be symmetric, so use eigvalsh for numerical stability\n    eigenvalues = np.linalg.eigvalsh(K)\n    \n    # Get the spectral radius (max absolute eigenvalue)\n    rho = np.max(np.abs(eigenvalues))\n    \n    # Define the absolute tolerance for being near-null\n    # Avoid rho=0 for a zero matrix\n    if rho == 0:\n        tau = epsilon\n    else:\n        tau = epsilon * rho\n\n    # Count eigenvalues whose absolute value is within the tolerance\n    near_null_count = np.sum(np.abs(eigenvalues) <= tau)\n    \n    return int(near_null_count)\n\ndef solve():\n    \"\"\"\n    Main function to execute the problem for the specified test cases.\n    \"\"\"\n    test_cases = [4, 5, 8, 32]\n    \n    results = []\n    \n    for N in test_cases:\n        # Collocated grid\n        A_col, D_col = construct_matrices(N, 'collocated')\n        K_col = assemble_saddle_point_matrix(A_col, D_col)\n        n_col = count_near_null_eigenvalues(K_col)\n        \n        # Staggered (MAC) grid\n        A_mac, D_mac = construct_matrices(N, 'mac')\n        K_mac = assemble_saddle_point_matrix(A_mac, D_mac)\n        n_mac = count_near_null_eigenvalues(K_mac)\n        \n        # Store the result triple\n        results.append([n_mac, n_col, n_col - n_mac])\n\n    # Format the final output string as specified\n    string_parts = []\n    for r in results:\n        string_parts.append(f\"[{r[0]},{r[1]},{r[2]}]\")\n    final_output = f\"[{','.join(string_parts)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}