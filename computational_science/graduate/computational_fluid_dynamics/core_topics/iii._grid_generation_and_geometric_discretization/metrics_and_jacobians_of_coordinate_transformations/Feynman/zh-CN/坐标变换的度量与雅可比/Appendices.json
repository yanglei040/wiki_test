{
    "hands_on_practices": [
        {
            "introduction": "在坐标变换中，雅可比矩阵是一个基本工具，其行列式直接关系到计算网格的有效性。一个非正或为零的雅可比行列式意味着物理网格单元发生了折叠或退化，这在计算流体动力学（CFD）中是必须避免的。通过本练习 ，你将直接计算一个非线性变换的雅可比行列式，并学会如何确定导致网格奇异性的点的轨迹，这是评估和生成高质量网格的首要步骤。",
            "id": "3345116",
            "problem": "考虑一个从坐标为 $\\xi$ 和 $\\eta$ 的二维计算域到坐标为 $x$ 和 $y$ 的物理域的光滑映射，其表达式为\n$$\nx(\\xi,\\eta)=\\xi+\\alpha\\,\\xi\\,\\eta,\\qquad y(\\xi,\\eta)=\\eta+\\beta\\,\\xi^2,\n$$\n其中 $\\alpha$ 和 $\\beta$ 为实常数。在计算流体动力学的背景下，雅可比矩阵定义为物理坐标对计算坐标的所有一阶偏导数构成的矩阵，其行列式是标量雅可比，它控制着映射的局部面积缩放、方向和局部可逆性。\n\n仅使用偏导数和多变量变换的雅可比的定义，完成以下任务：\n\n1. 用 $\\xi$、$\\eta$、$\\alpha$ 和 $\\beta$ 显式推导雅可比矩阵 $\\partial(x,y)/\\partial(\\xi,\\eta)$。\n2. 计算雅可比行列式 $J(\\xi,\\eta)$。\n3. 确定 $(\\xi,\\eta)$ 平面中使 $J(\\xi,\\eta)=0$ 成立的点的轨迹，并讨论参数的特殊情况如何改变该轨迹以及映射的局部可逆性。\n\n将雅可比行列式 $J(\\xi,\\eta)$ 以单个闭合形式的解析表达式作为你的最终答案。不需要也不允许进行数值计算。最终答案中不要包含任何单位。",
            "solution": "该问题要求针对给定的坐标变换，推导其雅可比矩阵和行列式，并分析该变换是奇异的条件。\n\n从计算坐标 $(\\xi, \\eta)$ 到物理坐标 $(x, y)$ 的映射由以下函数给出：\n$$\nx(\\xi, \\eta) = \\xi + \\alpha\\,\\xi\\,\\eta\n$$\n$$\ny(\\xi, \\eta) = \\eta + \\beta\\,\\xi^2\n$$\n其中 $\\alpha$ 和 $\\beta$ 为实常数。\n\n**1. 雅可比矩阵的推导**\n\n变换的雅可比矩阵，记为 $\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}$，是一个 $2 \\times 2$ 矩阵，其元素是物理坐标对计算坐标的一阶偏导数：\n$$\n\\mathbf{J} = \\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\n我们分别计算每个偏导数。\n\n对于 $x(\\xi, \\eta) = \\xi + \\alpha\\,\\xi\\,\\eta$：\n关于 $\\xi$ 的偏导数为：\n$$\n\\frac{\\partial x}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} (\\xi + \\alpha\\,\\xi\\,\\eta) = 1 + \\alpha\\,\\eta\n$$\n关于 $\\eta$ 的偏导数为：\n$$\n\\frac{\\partial x}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} (\\xi + \\alpha\\,\\xi\\,\\eta) = \\alpha\\,\\xi\n$$\n\n对于 $y(\\xi, \\eta) = \\eta + \\beta\\,\\xi^2$：\n关于 $\\xi$ 的偏导数为：\n$$\n\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} (\\eta + \\beta\\,\\xi^2) = 2\\,\\beta\\,\\xi\n$$\n关于 $\\eta$ 的偏导数为：\n$$\n\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} (\\eta + \\beta\\,\\xi^2) = 1\n$$\n将这些分量组合成矩阵，我们得到雅可比矩阵：\n$$\n\\mathbf{J}(\\xi, \\eta) = \\begin{pmatrix} 1 + \\alpha\\,\\eta  \\alpha\\,\\xi \\\\ 2\\,\\beta\\,\\xi  1 \\end{pmatrix}\n$$\n\n**2. 雅可比行列式的计算**\n\n雅可比行列式 $J(\\xi,\\eta)$ 是雅可比矩阵 $\\mathbf{J}$ 的行列式。对于一个 $2 \\times 2$ 矩阵 $\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$，其行列式为 $ad - bc$。\n将此应用于我们的雅可比矩阵：\n$$\nJ(\\xi, \\eta) = \\det(\\mathbf{J}) = (1 + \\alpha\\,\\eta)(1) - (\\alpha\\,\\xi)(2\\,\\beta\\,\\xi)\n$$\n化简此表达式，得到雅可比行列式：\n$$\nJ(\\xi, \\eta) = 1 + \\alpha\\,\\eta - 2\\,\\alpha\\,\\beta\\,\\xi^2\n$$\n\n**3. 奇异点轨迹分析**\n\n在雅可比行列式为零的点，映射是奇异的，意味着它不是局部可逆的。这些点在计算流体动力学中至关重要，因为它们对应于网格的折叠，即计算域中的一个有限面积区域映射到物理域中的零面积线或点。我们通过令 $J(\\xi, \\eta) = 0$ 来找到这些奇异点的轨迹：\n$$\n1 + \\alpha\\,\\eta - 2\\,\\alpha\\,\\beta\\,\\xi^2 = 0\n$$\n该方程描述了 $(\\xi, \\eta)$ 平面内的一条曲线。我们考察在常数 $\\alpha$ 和 $\\beta$ 的不同条件下该曲线的性质。\n\n情况 1: $\\alpha = 0$。\n如果 $\\alpha = 0$，雅可比行列式变为：\n$$\nJ(\\xi, \\eta) = 1 + (0)\\,\\eta - 2\\,(0)\\,\\beta\\,\\xi^2 = 1\n$$\n由于对于所有的 $(\\xi, \\eta)$，$J(\\xi, \\eta) = 1 \\neq 0$，所以映射处处非奇异。此时变换为 $x=\\xi$ 和 $y=\\eta+\\beta\\,\\xi^2$，这是一个简单的剪切和抛物线变换，它总是局部可逆的。\n\n情况 2: $\\beta = 0$ (且 $\\alpha \\neq 0$)。\n如果 $\\beta = 0$，雅可比行列式变为：\n$$\nJ(\\xi, \\eta) = 1 + \\alpha\\,\\eta\n$$\n奇异性条件 $J(\\xi, \\eta) = 0$ 意味着 $1 + \\alpha\\,\\eta = 0$，这给出：\n$$\n\\eta = -\\frac{1}{\\alpha}\n$$\n在这种情况下，奇异点的轨迹是 $(\\xi, \\eta)$ 平面内的一条水平线。除这条线上的点外，映射处处可逆。\n\n情况 3: $\\alpha \\neq 0$ 且 $\\beta \\neq 0$。\n这是最一般的情况。我们对奇异性方程求解 $\\eta$：\n$$\n\\alpha\\,\\eta = 2\\,\\alpha\\,\\beta\\,\\xi^2 - 1\n$$\n$$\n\\eta = \\frac{2\\,\\alpha\\,\\beta\\,\\xi^2 - 1}{\\alpha} = 2\\,\\beta\\,\\xi^2 - \\frac{1}{\\alpha}\n$$\n这个方程描述了 $(\\xi, \\eta)$ 平面内的一条抛物线，其对称轴为 $\\eta$ 轴，顶点在点 $(0, -1/\\alpha)$。抛物线的开口方向由 $\\beta$ 的符号决定。如果 $\\beta > 0$，抛物线开口向上。如果 $\\beta  0$，抛物线开口向下。除了这条抛物线曲线上的点，映射处处是局部可逆的。任何穿过这条抛物线的 $(\\xi, \\eta)$ 计算域中的网格，将在 $(x, y)$ 物理域中产生折叠的、无效的网格。",
            "answer": "$$\n\\boxed{1 + \\alpha\\,\\eta - 2\\,\\alpha\\,\\beta\\,\\xi^2}\n$$"
        },
        {
            "introduction": "在理解了雅可比行列式如何衡量面积缩放后，我们进一步探索描述局部几何（如长度和角度）的度量张量。虽然雅可比行列式告诉我们单元面积的变化，但度量张量更全面地刻画了网格的局部形状和畸变。本练习  将通过一个常见的剪切变换，让你亲手计算度量张量的分量，并量化由变换引起的网格非正交性，这对于在非正交网格上构建精确的数值格式至关重要。",
            "id": "3345156",
            "problem": "在计算流体动力学 (CFD) 中，曲线坐标用于将简单的计算域映射到可能倾斜的物理域，同时便于在结构化网格上进行离散化。考虑一个从计算坐标 $(\\xi,\\eta)$ 到物理笛卡尔坐标 $(x,y)$ 的二维映射，该映射由 $x=\\xi$ 和 $y=\\eta+\\alpha\\,\\xi$ 定义，其中 $\\alpha$ 是一个常数且 $\\alpha\\neq 0$。仅使用矢量微积分和张量微积分的第一性原理，计算此映射在计算坐标中导出的度量张量分量 $g_{ij}$，并确定与 $\\xi$ 和 $\\eta$ 相关联的协变基矢量之间的夹角。请以弧度为单位提供该角度。\n\n将最终答案表示为一个单行矩阵，其中按顺序包含四个元素 $\\left[g_{\\xi\\xi},\\,g_{\\xi\\eta},\\,g_{\\eta\\eta},\\,\\theta\\right]$，其中 $\\theta$ 是协变基矢量之间的夹角。无需四舍五入，最终表达式中不应包含单位（角度必须以弧度为单位）。",
            "solution": "该问题要求针对一个给定的从计算域 $(\\xi, \\eta)$ 到物理笛卡尔域 $(x, y)$ 的二维坐标变换，计算度量张量分量 $g_{ij}$ 以及协变基矢量之间的夹角 $\\theta$。\n\n该变换由以下方程定义：\n$$x = \\xi$$\n$$y = \\eta + \\alpha\\xi$$\n其中 $\\alpha$ 是一个非零常数。\n\n物理域中某点的位矢 $\\mathbf{r}$ 可以用标准笛卡尔基矢量 $\\mathbf{i}$ 和 $\\mathbf{j}$ 表示为 $\\mathbf{r} = x\\mathbf{i} + y\\mathbf{j}$。代入变换方程，我们将位矢表示为计算坐标 $(\\xi, \\eta)$ 的函数：\n$$\\mathbf{r}(\\xi, \\eta) = \\xi\\mathbf{i} + (\\eta + \\alpha\\xi)\\mathbf{j}$$\n\n协变基矢量（我们记为 $\\mathbf{g}_{\\xi}$ 和 $\\mathbf{g}_{\\eta}$）被定义为位矢相对于计算坐标的偏导数。这些矢量在物理空间中与坐标线相切。\n\n与 $\\xi$ 坐标相关联的协变基矢量是：\n$$\\mathbf{g}_{\\xi} = \\frac{\\partial \\mathbf{r}}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} \\left( \\xi\\mathbf{i} + (\\eta + \\alpha\\xi)\\mathbf{j} \\right) = \\frac{\\partial x}{\\partial \\xi}\\mathbf{i} + \\frac{\\partial y}{\\partial \\xi}\\mathbf{j}$$\n计算偏导数：\n$$\\frac{\\partial x}{\\partial \\xi} = 1$$\n$$\\frac{\\partial y}{\\partial \\xi} = \\alpha$$\n因此，矢量 $\\mathbf{g}_{\\xi}$ 是：\n$$\\mathbf{g}_{\\xi} = 1\\mathbf{i} + \\alpha\\mathbf{j}$$\n\n与 $\\eta$ 坐标相关联的协变基矢量是：\n$$\\mathbf{g}_{\\eta} = \\frac{\\partial \\mathbf{r}}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} \\left( \\xi\\mathbf{i} + (\\eta + \\alpha\\xi)\\mathbf{j} \\right) = \\frac{\\partial x}{\\partial \\eta}\\mathbf{i} + \\frac{\\partial y}{\\partial \\eta}\\mathbf{j}$$\n计算偏导数：\n$$\\frac{\\partial x}{\\partial \\eta} = 0$$\n$$\\frac{\\partial y}{\\partial \\eta} = 1$$\n因此，矢量 $\\mathbf{g}_{\\eta}$ 是：\n$$\\mathbf{g}_{\\eta} = 0\\mathbf{i} + 1\\mathbf{j} = \\mathbf{j}$$\n\n协变度量张量的分量 $g_{ij}$ 被定义为协变基矢量的标量（点）积：$g_{ij} = \\mathbf{g}_{i} \\cdot \\mathbf{g}_{j}$。在我们的例子中，指标 $i$ 和 $j$ 对应于 $\\xi$ 和 $\\eta$。\n\n分量 $g_{\\xi\\xi}$ 是：\n$$g_{\\xi\\xi} = \\mathbf{g}_{\\xi} \\cdot \\mathbf{g}_{\\xi} = (1\\mathbf{i} + \\alpha\\mathbf{j}) \\cdot (1\\mathbf{i} + \\alpha\\mathbf{j}) = (1)(1) + (\\alpha)(\\alpha) = 1 + \\alpha^{2}$$\n\n分量 $g_{\\eta\\eta}$ 是：\n$$g_{\\eta\\eta} = \\mathbf{g}_{\\eta} \\cdot \\mathbf{g}_{\\eta} = (\\mathbf{j}) \\cdot (\\mathbf{j}) = 1$$\n\n非对角分量 $g_{\\xi\\eta}$ 是：\n$$g_{\\xi\\eta} = \\mathbf{g}_{\\xi} \\cdot \\mathbf{g}_{\\eta} = (1\\mathbf{i} + \\alpha\\mathbf{j}) \\cdot (\\mathbf{j}) = (1)(0) + (\\alpha)(1) = \\alpha$$\n由于度量张量的对称性，有 $g_{\\eta\\xi} = g_{\\xi\\eta} = \\alpha$。\n\n两个协变基矢量 $\\mathbf{g}_{\\xi}$ 和 $\\mathbf{g}_{\\eta}$ 之间的夹角 $\\theta$ 由点积的几何定义确定：\n$$\\mathbf{g}_{\\xi} \\cdot \\mathbf{g}_{\\eta} = |\\mathbf{g}_{\\xi}| |\\mathbf{g}_{\\eta}| \\cos(\\theta)$$\n其中 $|\\mathbf{v}|$ 表示矢量 $\\mathbf{v}$ 的模。\n\n基矢量的模与度量张量的对角分量相关：\n$$|\\mathbf{g}_{\\xi}| = \\sqrt{\\mathbf{g}_{\\xi} \\cdot \\mathbf{g}_{\\xi}} = \\sqrt{g_{\\xi\\xi}} = \\sqrt{1 + \\alpha^{2}}$$\n$$|\\mathbf{g}_{\\eta}| = \\sqrt{\\mathbf{g}_{\\eta} \\cdot \\mathbf{g}_{\\eta}} = \\sqrt{g_{\\eta\\eta}} = \\sqrt{1} = 1$$\n点积是度量张量的非对角分量：\n$$\\mathbf{g}_{\\xi} \\cdot \\mathbf{g}_{\\eta} = g_{\\xi\\eta} = \\alpha$$\n\n将这些表达式代入角度公式，得到：\n$$\\alpha = \\left( \\sqrt{1 + \\alpha^{2}} \\right) (1) \\cos(\\theta)$$\n求解 $\\cos(\\theta)$：\n$$\\cos(\\theta) = \\frac{\\alpha}{\\sqrt{1 + \\alpha^{2}}}$$\n因此，以弧度表示的角度 $\\theta$ 是：\n$$\\theta = \\arccos\\left(\\frac{\\alpha}{\\sqrt{1 + \\alpha^{2}}}\\right)$$\n条件 $\\alpha \\neq 0$ 确保了 $\\arccos$ 函数的宗量不等于 $0$ 且基矢量非正交。对于任何非零的 $\\alpha$，宗量的绝对值始终小于 $1$，因此该角度是良定义的并且不等于 $\\frac{\\pi}{2}$。\n\n最终要求的输出是包含度量张量分量和角度 $\\theta$ 的行矩阵：$[g_{\\xi\\xi}, g_{\\xi\\eta}, g_{\\eta\\eta}, \\theta]$。\n汇总计算出的量：\n$$g_{\\xi\\xi} = 1 + \\alpha^{2}$$\n$$g_{\\xi\\eta} = \\alpha$$\n$$g_{\\eta\\eta} = 1$$\n$$\\theta = \\arccos\\left(\\frac{\\alpha}{\\sqrt{1 + \\alpha^{2}}}\\right)$$\n这就得到了最终的矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{bmatrix}\n1 + \\alpha^2  \\alpha  1  \\arccos\\left(\\frac{\\alpha}{\\sqrt{1 + \\alpha^2}}\\right)\n\\end{bmatrix}\n}\n$$"
        },
        {
            "introduction": "坐标变换的几何特性对数值格式的准确性有着深刻影响，其中几何守恒律（Geometric Conservation Law, GCL）是确保自由流（uniform flow）能够被精确保持的关键。从理论上讲，这些度量恒等式是自动满足的，但在离散化的数值世界中，必须通过精巧的数值方法来保证它们成立。本练习  将引导你从基本定义出发，推导并用数值方法验证这些重要的恒等式，让你深刻理解抽象的几何概念是如何直接转化为保证CFD求解器稳定性和准确性的具体要求的。",
            "id": "3345146",
            "problem": "考虑一个在计算流体动力学（CFD, Computational Fluid Dynamics）中使用的光滑二维曲线坐标变换，该变换通过 $x=x(\\xi,\\eta)$ 和 $y=y(\\xi,\\eta)$ 将计算坐标 $(\\xi,\\eta)$ 映射到物理坐标 $(x,y)$。从连续介质力学中曲线坐标的核心定义出发，设协变基向量定义为 $\\mathbf{a}_1=\\partial \\mathbf{r}/\\partial \\xi$ 和 $\\mathbf{a}_2=\\partial \\mathbf{r}/\\partial \\eta$，其中 $\\mathbf{r}(\\xi,\\eta)=(x(\\xi,\\eta),y(\\xi,\\eta))$。雅可比行列式 $J$ 是有向面积缩放因子 $J=\\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}\\right)$。逆变基向量 $\\mathbf{a}^i$ 定义为满足 $\\mathbf{a}^i\\cdot\\mathbf{a}_j=\\delta^i_j$ 的倒易基，其中 $\\delta^i_j$ 是克罗内克（Kronecker）δ。\n\n你的任务是推导、实现并验证保证曲线坐标系公式中自由流守恒的度量恒等式：即以下方程的离散近似\n$$\\frac{\\partial\\left(J a^i_x\\right)}{\\partial \\xi^i}=0\\quad\\text{和}\\quad\\frac{\\partial\\left(J a^i_y\\right)}{\\partial \\xi^i}=0，$$\n其中 $a^i_x$ 和 $a^i_y$ 是逆变基向量 $\\mathbf{a}^i$ 的笛卡尔分量，并且对重复的上标 $i\\in\\{1,2\\}$ 应用爱因斯坦求和约定，其中 $\\xi^1=\\xi$ 和 $\\xi^2=\\eta$。你的推导和算法必须基于以下基本定义：\n- 协变基向量 $\\mathbf{a}_1=\\left(\\frac{\\partial x}{\\partial \\xi},\\frac{\\partial y}{\\partial \\xi}\\right)$ 和 $\\mathbf{a}_2=\\left(\\frac{\\partial x}{\\partial \\eta},\\frac{\\partial y}{\\partial \\eta}\\right)$。\n- 雅可比行列式 $J=\\frac{\\partial x}{\\partial \\xi}\\frac{\\partial y}{\\partial \\eta}-\\frac{\\partial x}{\\partial \\eta}\\frac{\\partial y}{\\partial \\xi}$。\n- 逆变基向量 $\\mathbf{a}^i$ 与 $\\mathbf{a}_i$ 互为倒易基。\n\n你不能使用问题陈述中的快捷公式；相反，必须从上述核心定义中推导出必要的关系。三角函数中使用的角度必须以弧度为单位。\n\n实现一个 Python 程序，该程序：\n1. 构建 $(\\xi,\\eta)\\in[0,1]\\times[0,1]$ 上的均匀计算网格，网格点数为 $N\\times N$，其中 $N$ 由每个测试用例指定。\n2. 对于测试套件中的每个映射，在网格上计算 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 的值。\n3. 使用二阶中心差分在内部点上计算一阶导数 $\\frac{\\partial x}{\\partial \\xi}$、$\\frac{\\partial x}{\\partial \\eta}$、$\\frac{\\partial y}{\\partial \\xi}$ 和 $\\frac{\\partial y}{\\partial \\eta}$ 的离散近似值。\n4. 基于这些导数值，通过倒易基的定义计算内部点上的雅可比行列式 $J$ 以及逆变分量 $a^i_x$ 和 $a^i_y$。\n5. 构造通量类物理量 $J a^i_x$ 和 $J a^i_y$（对于 $i\\in\\{1,2\\}$），并使用二阶中心差分在内部点上计算它们的离散散度 $\\frac{\\partial(J a^1_\\alpha)}{\\partial \\xi}+\\frac{\\partial(J a^2_\\alpha)}{\\partial \\eta}$（对于 $\\alpha\\in\\{x,y\\}$）。\n6. 对于每个测试用例，分别报告内部点上 $x$ 分量和 $y$ 分量的离散散度的最大绝对值，结果为两个浮点数。\n\n设计的程序应在没有外部输入的情况下运行，并生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个包含两个浮点数元素 $[r_x,r_y]$ 的列表，代表 $x$ 和 $y$ 分量的最大绝对散度残差。确切的最终输出格式必须是：\n$$\\texttt{[[r1x,r1y],[r2x,r2y],[r3x,r3y],[r4x,r4y]]}$$\n不得包含任何额外文本。\n\n三角函数映射中的角度必须以弧度为单位。不涉及物理单位；所有量均为无量纲。\n\n需要实现的测试套件：\n- 情况 1（恒等映射，理想情况）：$x(\\xi,\\eta)=\\xi$，$y(\\xi,\\eta)=\\eta$，$N=51$。\n- 情况 2（光滑正弦扰动，理想情况）：$x(\\xi,\\eta)=\\xi+\\alpha\\sin(2\\pi\\xi)\\sin(2\\pi\\eta)$，$y(\\xi,\\eta)=\\eta+\\beta\\sin(2\\pi\\xi)\\sin(2\\pi\\eta)$，其中 $\\alpha=0.1$，$\\beta=0.1$，$N=101$。\n- 情况 3（耦合多项式剪切，接近边界有较强变形但非奇异）：$x(\\xi,\\eta)=\\xi+s\\eta^2$，$y(\\xi,\\eta)=\\eta+t\\xi^2$，其中 $s=0.4$，$t=0.5$，$N=101$。\n- 情况 4（粗网格，用于探究离散化误差）：与情况 2 相同，$\\alpha=0.1$，$\\beta=0.1$，$N=11$。\n\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果（例如，$\\texttt{[[r1x,r1y],[r2x,r2y]]}$）。每个 $r$ 都必须是一个浮点数。",
            "solution": "该问题要求推导、实现并验证在二维曲线坐标系中用于自由流守恒的度量恒等式。这些恒等式在计算流体动力学（CFD）中通常被称为几何守恒律（Geometric Conservation Law, GCL），它们确保均匀流场（“自由流”）是离散化控制方程的一个有效解。从解析角度看，这些恒等式是坐标变换光滑性的一个推论。在数值上，这些恒等式在离散化误差的阶数范围内得到满足，是对任何曲线网格上的流体求解器的关键测试。\n\n待验证的恒等式是：\n$$\n\\frac{\\partial\\left(J a^i_x\\right)}{\\partial \\xi^i} = \\frac{\\partial\\left(J a^1_x\\right)}{\\partial \\xi} + \\frac{\\partial\\left(J a^2_x\\right)}{\\partial \\eta} = 0\n$$\n$$\n\\frac{\\partial\\left(J a^i_y\\right)}{\\partial \\xi^i} = \\frac{\\partial\\left(J a^1_y\\right)}{\\partial \\xi} + \\frac{\\partial\\left(J a^2_y\\right)}{\\partial \\eta} = 0\n$$\n其中对索引 $i \\in \\{1, 2\\}$ 应用了求和约定，且 $\\xi^1 = \\xi$ 和 $\\xi^2 = \\eta$。这里，$J$ 是从计算坐标 $(\\xi, \\eta)$到物理坐标 $(x, y)$ 变换的雅可比行列式，$a^i_x, a^i_y$ 是逆变基向量 $\\mathbf{a}^i$ 的笛卡尔分量。\n\n求解过程分为两个阶段：首先，从给定的定义中解析推导必要的量；其次，设计并实现一个数值算法来离散地验证这些恒等式。\n\n### 解析推导\n\n推导从坐标变换及其相关几何量的基本定义开始。\n\n1.  **协变基和雅可比矩阵**：物理域中的位置向量为 $\\mathbf{r}(\\xi, \\eta) = (x(\\xi, \\eta), y(\\xi, \\eta))$。协变基向量 $\\mathbf{a}_1$ 和 $\\mathbf{a}_2$ 分别是坐标线 $\\eta=\\text{const}$ 和 $\\xi=\\text{const}$ 的切线。它们定义为：\n    $$\n    \\mathbf{a}_1 = \\frac{\\partial \\mathbf{r}}{\\partial \\xi} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} \\\\ \\frac{\\partial y}{\\partial \\xi} \\end{pmatrix}, \\quad \\mathbf{a}_2 = \\frac{\\partial \\mathbf{r}}{\\partial \\eta} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n    $$\n    这些向量构成了变换的雅可比矩阵的列，我们将其表示为 $\\mathbf{J}_{\\text{mat}}$：\n    $$\n    \\mathbf{J}_{\\text{mat}} = \\frac{\\partial(x, y)}{\\partial(\\xi, \\eta)} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} x_\\xi  x_\\eta \\\\ y_\\xi  y_\\eta \\end{pmatrix}\n    $$\n    雅可比行列式 $J$ 是该矩阵的行列式：$J = \\det(\\mathbf{J}_{\\text{mat}}) = x_\\xi y_\\eta - x_\\eta y_\\xi$。\n\n2.  **逆变基**：逆变基向量 $\\mathbf{a}^1$ 和 $\\mathbf{a}^2$ 通过与协变基的倒易关系定义：\n    $$\n    \\mathbf{a}^i \\cdot \\mathbf{a}_j = \\delta^i_j\n    $$\n    其中 $\\delta^i_j$ 是克罗内克（Kronecker）δ。这组线性方程可以用矩阵形式表示。设逆变向量为矩阵 $\\mathbf{A}$ 的行，其中 $\\mathbf{a}^1 = (a^1_x, a^1_y)$ 和 $\\mathbf{a}^2 = (a^2_x, a^2_y)$。\n    $$\n    \\mathbf{A} = \\begin{pmatrix} a^1_x  a^1_y \\\\ a^2_x  a^2_y \\end{pmatrix}\n    $$\n    倒易条件即为 $\\mathbf{A} \\, (\\mathbf{J}_{\\text{mat}})^T = \\mathbf{I}$，其中 $\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。这意味着 $\\mathbf{A} = ((\\mathbf{J}_{\\text{mat}})^T)^{-1} = (\\mathbf{J}_{\\text{mat}}^{-1})^T$。我们来计算 $\\mathbf{J}_{\\text{mat}}^{-1}$：\n    $$\n    \\mathbf{J}_{\\text{mat}}^{-1} = \\frac{1}{J} \\begin{pmatrix} y_\\eta  -x_\\eta \\\\ -y_\\xi  x_\\xi \\end{pmatrix} = \\frac{\\partial(\\xi, \\eta)}{\\partial(x, y)}\n    $$\n    取转置得到矩阵 $\\mathbf{A}$：\n    $$\n    \\mathbf{A} = (\\mathbf{J}_{\\text{mat}}^{-1})^T = \\frac{1}{J} \\begin{pmatrix} y_\\eta  -y_\\xi \\\\ -x_\\eta  x_\\xi \\end{pmatrix}\n    $$\n    通过将矩阵 $\\mathbf{A}$ 的元素与其定义进行比较，我们得到逆变基向量的笛卡尔分量：\n    $$\n    a^1_x = \\frac{y_\\eta}{J}, \\quad a^1_y = \\frac{-x_\\eta}{J}\n    $$\n    $$\n    a^2_x = \\frac{-y_\\xi}{J}, \\quad a^2_y = \\frac{x_\\xi}{J}\n    $$\n\n3.  **度量恒等式**：现在我们可以构造度量恒等式所需的通量类物理量 $J a^i_x$ 和 $J a^i_y$：\n    -   对于 $i=1$：$J a^1_x = J (\\frac{y_\\eta}{J}) = y_\\eta$ 和 $J a^1_y = J (\\frac{-x_\\eta}{J}) = -x_\\eta$。\n    -   对于 $i=2$：$J a^2_x = J (\\frac{-y_\\xi}{J}) = -y_\\xi$ 和 $J a^2_y = J (\\frac{x_\\xi}{J}) = x_\\xi$。\n\n    将这些简化后的表达式代入散度方程，得到：\n    -   对于 $x$ 分量的 GCL：\n        $$\n        \\frac{\\partial(J a^1_x)}{\\partial \\xi} + \\frac{\\partial(J a^2_x)}{\\partial \\eta} = \\frac{\\partial(y_\\eta)}{\\partial \\xi} + \\frac{\\partial(-y_\\xi)}{\\partial \\eta} = \\frac{\\partial^2 y}{\\partial \\xi \\partial \\eta} - \\frac{\\partial^2 y}{\\partial \\eta \\partial \\xi}\n        $$\n    -   对于 $y$ 分量的 GCL：\n        $$\n        \\frac{\\partial(J a^1_y)}{\\partial \\xi} + \\frac{\\partial(J a^2_y)}{\\partial \\eta} = \\frac{\\partial(-x_\\eta)}{\\partial \\xi} + \\frac{\\partial(x_\\xi)}{\\partial \\eta} = -\\frac{\\partial^2 x}{\\partial \\xi \\partial \\eta} + \\frac{\\partial^2 x}{\\partial \\eta \\partial \\xi}\n        $$\n    对于任何二阶偏导数连续的光滑变换，根据 Clairaut 定理关于混合偏导数相等的结论，可以保证这两个表达式恒等于零。\n\n### 数值验证策略\n\n本任务的核心是验证当所有导数被离散数值近似取代时，这些恒等式是否仍然成立。该算法遵循“先离散后求导”的方法。\n\n1.  **网格生成**：在域 $(\\xi, \\eta) \\in [0, 1] \\times [0, 1]$ 上生成一个 $N \\times N$ 点的均匀计算网格。网格间距为 $\\Delta\\xi = \\Delta\\eta = 1/(N-1)$。网格点为 $(\\xi_j, \\eta_k) = (j\\Delta\\xi, k\\Delta\\eta)$，其中 $j,k \\in \\{0, \\dots, N-1\\}$。\n\n2.  **映射计算**：在计算网格的每个点上计算物理坐标 $(x, y)$，生成两个 $N \\times N$ 的数组 $\\mathbf{X}$ 和 $\\mathbf{Y}$。\n\n3.  **第一层离散化（通量）**：使用二阶中心差分近似一阶导数（$x_\\xi, x_\\eta, y_\\xi, y_\\eta$）。此计算在 $(N-2) \\times (N-2)$ 的内部点网格上执行（索引 $j,k \\in \\{1, \\dots, N-2\\}$）。\n    $$\n    (f_\\xi)_{j,k} \\approx \\frac{f_{j+1,k} - f_{j-1,k}}{2\\Delta\\xi}, \\quad (f_\\eta)_{j,k} \\approx \\frac{f_{j,k+1} - f_{j,k-1}}{2\\Delta\\eta}\n    $$\n    此步骤的结果是四个 $(N-2) \\times (N-2)$ 的数组，代表离散的一阶导数。根据解析推导，这些数组直接对应于离散的通量类物理量：（Flux$_{x1}$)$_{j,k} = (y_\\eta)_{j,k}$，（Flux$_{x2}$)$_{j,k} = -(y_\\xi)_{j,k}$，以此类推。\n\n4.  **第二层离散化（散度）**：然后计算离散通量场的散度，同样使用二阶中心差分。此操作需要来自通量数组相邻点的数据，因此只能在更小的 $(N-4) \\times (N-4)$ 尺寸的内部网格上执行（索引 $j,k \\in \\{2, \\dots, N-3\\}$）。对于 $x$ 分量，内部点的残差为：\n    $$\n    R_x \\approx \\frac{(\\text{Flux}_{x1})_{j+1,k} - (\\text{Flux}_{x1})_{j-1,k}}{2\\Delta\\xi} + \\frac{(\\text{Flux}_{x2})_{j,k+1} - (\\text{Flux}_{x2})_{j,k-1}}{2\\Delta\\eta}\n    $$\n    对于 $y$ 分量的残差 $R_y$，也有类似的表达式。\n\n5.  **结果报告**：每个测试用例的最后一步是，在 $(N-4) \\times (N-4)$ 网格上找到计算出的残差的最大绝对值 $\\max(|R_x|)$ 和 $\\max(|R_y|)$。对于二次或更低次多项式的映射，中心差分算子是精确的，因此计算出的残差应该在机器浮点精度范围内为零。对于更复杂的映射（如正弦情况），预计会存在非零的离散化误差，该误差应随着网格加密而减小，通常为 $O((\\Delta\\xi)^2)$ 阶。\n\n这个数值过程严格测试了离散几何算子是否可交换，这是 Clairaut 定理的离散等价形式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_case(N, mapping_func, params):\n    \"\"\"\n    Computes the Geometric Conservation Law (GCL) residuals for a given \n    coordinate mapping and grid size.\n\n    Args:\n        N (int): The number of points in each direction of the grid.\n        mapping_func (function): A function that takes XI, ETA, and params \n                                 and returns the mapped X, Y coordinates.\n        params (dict): A dictionary of parameters for the mapping function.\n\n    Returns:\n        list[float, float]: A list containing the maximum absolute residuals \n                            for the x and y components of the GCL.\n    \"\"\"\n    if N  5:\n        # The central differencing stencil requires a grid of at least 5x5\n        # to produce a non-empty residual field.\n        return [0.0, 0.0]\n\n    # 1. Construct the uniform computational grid\n    h = 1.0 / (N - 1)  # Grid spacing for both xi and eta\n    xi_vec = np.linspace(0.0, 1.0, N)\n    eta_vec = np.linspace(0.0, 1.0, N)\n    XI, ETA = np.meshgrid(xi_vec, eta_vec, indexing='ij')\n\n    # 2. Evaluate the physical coordinates x and y on the grid\n    X, Y = mapping_func(XI, ETA, params)\n\n    # 3. Compute discrete first derivatives on the (N-2)x(N-2) interior grid\n    #    using second-order central differences.\n    x_xi = (X[1:-1, 2:] - X[1:-1, :-2]) / (2 * h)\n    x_eta = (X[2:, 1:-1] - X[:-2, 1:-1]) / (2 * h)\n    y_xi = (Y[1:-1, 2:] - Y[1:-1, :-2]) / (2 * h)\n    y_eta = (Y[2:, 1:-1] - Y[:-2, 1:-1]) / (2 * h)\n\n    # 4. Form the discrete flux-like quantities (J*a^i_x and J*a^i_y)\n    #    These are (N-2)x(N-2) arrays.\n    flux_x1 = y_eta\n    flux_x2 = -y_xi\n    flux_y1 = -x_eta\n    flux_y2 = x_xi\n\n    # 5. Evaluate the discrete divergence of the flux quantities on the\n    #    (N-4)x(N-4) interior grid using second-order central differences.\n    d_flux_x1_d_xi = (flux_x1[1:-1, 2:] - flux_x1[1:-1, :-2]) / (2 * h)\n    d_flux_x2_d_eta = (flux_x2[2:, 1:-1] - flux_x2[:-2, 1:-1]) / (2 * h)\n    residual_x = d_flux_x1_d_xi + d_flux_x2_d_eta\n    \n    d_flux_y1_d_xi = (flux_y1[1:-1, 2:] - flux_y1[1:-1, :-2]) / (2 * h)\n    d_flux_y2_d_eta = (flux_y2[2:, 1:-1] - flux_y2[:-2, 1:-1]) / (2 * h)\n    residual_y = d_flux_y1_d_xi + d_flux_y2_d_eta\n\n    # 6. Report the maximum absolute value of the residuals.\n    max_abs_residual_x = np.max(np.abs(residual_x))\n    max_abs_residual_y = np.max(np.abs(residual_y))\n    \n    return [max_abs_residual_x, max_abs_residual_y]\n\ndef mapping_identity(XI, ETA, params):\n    \"\"\"Case 1: Identity mapping.\"\"\"\n    return XI, ETA\n\ndef mapping_sinusoidal(XI, ETA, params):\n    \"\"\"Case 2  4: Smooth sinusoidal perturbation.\"\"\"\n    alpha = params['alpha']\n    beta = params['beta']\n    x = XI + alpha * np.sin(2 * np.pi * XI) * np.sin(2 * np.pi * ETA)\n    y = ETA + beta * np.sin(2 * np.pi * XI) * np.sin(2 * np.pi * ETA)\n    return x, y\n\ndef mapping_polynomial(XI, ETA, params):\n    \"\"\"Case 3: Coupled polynomial shear.\"\"\"\n    s = params['s']\n    t = params['t']\n    x = XI + s * ETA**2\n    y = ETA + t * XI**2\n    return x, y\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {'N': 51, 'mapping': mapping_identity, 'params': {}},\n        {'N': 101, 'mapping': mapping_sinusoidal, 'params': {'alpha': 0.1, 'beta': 0.1}},\n        {'N': 101, 'mapping': mapping_polynomial, 'params': {'s': 0.4, 't': 0.5}},\n        {'N': 11, 'mapping': mapping_sinusoidal, 'params': {'alpha': 0.1, 'beta': 0.1}},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        residuals = solve_case(case['N'], case['mapping'], case['params'])\n        all_results.append(residuals)\n\n    # Format the final output string as per the problem specification.\n    result_strings = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}