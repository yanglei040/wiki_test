{
    "hands_on_practices": [
        {
            "introduction": "本节的实践练习旨在通过具体的计算问题，加深您对多物理场拓扑优化核心概念的理解。第一个练习  将引导您处理一个简化的热-力耦合系统。通过运用基于密度的惩罚方法(SIMP)，您将学习如何解析地推导并求解一个在体积约束下最小化加权柔度的优化问题，从而为更复杂的分析奠定坚实的数学基础。",
            "id": "3530728",
            "problem": "考虑一个一维无量纲化的双物理场设计问题，对象是一个离散为两个相等有限元（索引为 $i \\in \\{1,2\\}$）的杆，每个单元的长度为 $1$，截面积为 $1$。在线性弹性力学中，该杆承受准静态端部力 $F$；在热传导中，该杆承受稳态端部热通量 $Q$。任务是通过两个单元设计密度 $\\rho_{1}$ 和 $\\rho_{2}$，使用固体各向同性材料惩罚（SIMP）插值法来分配材料，以在全局体积约束下最小化机械柔度和热柔度的加权和。SIMP 法则为：杨氏模量 $E(\\rho_{i})=\\rho_{i}^{p} E_{0}$，导热系数 $k(\\rho_{i})=\\rho_{i}^{p} k_{0}$，两种物理场使用相同的惩罚指数 $p$。假设 $\\rho_{i}$ 的下界正则化可以忽略，因此允许内部解。优化在无量纲化条件下进行，使得 $A=1$，$L_{i}=1$，$E_{0}=1$，$k_{0}=1$，$F=1$，$Q=1$。\n\n从以下基本原理出发：\n-   线性弹性力学中的一维线性动量守恒、Hooke 定律和应变能，以及热传导中的 Fourier 定律和稳态能量守恒。\n-   机械柔度定义为 $F$ 乘以端部位移，热柔度定义为 $Q$ 乘以端部温升，两者都可以通过单元属性以一维串联形式表示。\n\n使用这些原理，推导机械柔度和热柔度关于 $\\rho_{i}$ 和 $p$ 的一维串联表达式，然后构建加权目标函数\n$$\nJ(\\rho_{1},\\rho_{2})=\\sum_{i=1}^{2}\\left(\\alpha\\,w_{i}\\,C_{\\text{mech},i}(\\rho_{i})+\\beta\\,t_{i}\\,C_{\\text{therm},i}(\\rho_{i})\\right),\n$$\n其中 $w_{i}$ 和 $t_{i}$ 是给定的无量纲空间权重，$\\alpha$ 和 $\\beta$ 是正常数。施加体积约束 $\\rho_{1}+\\rho_{2}=1$，并假设公共惩罚指数 $p=3$。\n\n给定具体数据 $\\alpha=1$，$\\beta=1$，$w_{1}=4$，$w_{2}=\\frac{1}{6}$，$t_{1}=\\frac{4}{3}$，$t_{2}=\\frac{1}{6}$，$p=3$，以及上述无量纲化条件，执行以下操作：\n-   使用带有单个体积约束乘子的 Lagrangian 函数，推导 $(\\rho_{1},\\rho_{2})$ 的一阶必要最优性条件。\n-   显式求解这些条件以获得最优的 $\\rho_{1}$。\n\n将最优 $\\rho_{1}$ 的最终答案表示为一个精确分数。不要包含单位，也不要报告不等式或方程，只报告数值。无需四舍五入。",
            "solution": "该问题验证如下。\n\n**步骤 1：提取给定信息**\n-   **域**：一维杆，离散为两个相等的有限元，索引为 $i \\in \\{1,2\\}$。\n-   **几何**：每个单元长度 $L_i=1$，截面积 $A_i=1$。\n-   **物理场**：准静态线性弹性力学和稳态热传导。\n-   **载荷**：端部力 $F$ 和端部热通量 $Q$。\n-   **材料模型**：固体各向同性材料惩罚 (SIMP)，杨氏模量 $E(\\rho_{i})=\\rho_{i}^{p} E_{0}$，导热系数 $k(\\rho_{i})=\\rho_{i}^{p} k_{0}$。\n-   **设计变量**：单元材料密度 $\\rho_1$ 和 $\\rho_2$。\n-   **目标函数**：最小化柔度的加权和 $J(\\rho_{1},\\rho_{2})=\\sum_{i=1}^{2}\\left(\\alpha\\,w_{i}\\,C_{\\text{mech},i}(\\rho_{i})+\\beta\\,t_{i}\\,C_{\\text{therm},i}(\\rho_{i})\\right)$。\n-   **约束**：全局体积约束 $\\rho_1 + \\rho_2 = 1$。\n-   **常数和参数**：\n    -   无量纲化：$A=1$，$L_i=1$，$E_0=1$，$k_0=1$，$F=1$，$Q=1$。\n    -   惩罚指数：$p=3$。\n    -   权重因子：$\\alpha=1$，$\\beta=1$。\n    -   空间权重：$w_{1}=4$，$w_{2}=\\frac{1}{6}$，$t_{1}=\\frac{4}{3}$，$t_{2}=\\frac{1}{6}$。\n-   **基本原理**：\n    -   线性弹性力学中的线性动量守恒、Hooke 定律和应变能。\n    -   热传导中的 Fourier 定律和稳态能量守恒。\n    -   机械柔度（$F$ 乘以端部位移）和热柔度（$Q$ 乘以端部温升）的定义。\n-   **任务**：推导一阶必要最优性条件并求解最优的 $\\rho_1$。\n\n**步骤 2：使用提取的给定信息进行验证**\n-   **科学依据**：该问题基于连续介质力学（线性弹性和热传导）的基本原理以及结构优化中的标准方法（SIMP）。它在科学上是合理的。\n-   **适定性**：该问题是一个约束优化问题。目标函数是形如 $c \\rho^{-p}$ 的函数之和，对于 $\\rho > 0$ 是凸函数。约束是线性的。这种结构通常会产生唯一的、稳定的解。该问题是适定的。\n-   **客观性**：语言精确，所有参数都明确给出。没有主观或模糊的术语。\n-   **其他缺陷**：该问题是自洽、一致且在一个学术优化问题的框架内是可行的。它不是琐碎的或同义反复的。\n\n**步骤 3：结论与行动**\n该问题有效。将推导解答。\n\n**解答推导**\n\n首先，我们推导单元柔度的表达式。对于两个串联单元的系统，在力学问题中，总力 $F$ 传递通过每个单元；在热学问题中，总热通量 $Q$ 流经每个单元。\n\n单元 $i$ 的机械柔度贡献与其应变能相关。一维杆单元的刚度为 $k_{\\text{mech},i} = \\frac{A_i E_i}{L_i}$。系统的总机械柔度是各单元贡献之和，其中单元 $i$ 的贡献由 $C_{\\text{mech},i} = \\frac{F^2 L_i}{A_i E_i}$ 给出。\n使用 SIMP 法则，$E_i = E(\\rho_i) = \\rho_i^p E_0$。\n所以，$C_{\\text{mech},i}(\\rho_i) = \\frac{F^2 L_i}{A_i \\rho_i^p E_0}$。\n\n类似地，一维单元的热导为 $k_{\\text{therm},i} = \\frac{A_i k_i}{L_i}$。总热柔度是各单元贡献之和，其中单元 $i$ 的贡献为 $C_{\\text{therm},i} = \\frac{Q^2 L_i}{A_i k_i}$。\n使用 SIMP 法则，$k_i = k(\\rho_i) = \\rho_i^p k_0$。\n所以，$C_{\\text{therm},i}(\\rho_i) = \\frac{Q^2 L_i}{A_i \\rho_i^p k_0}$。\n\n我们应用无量纲化：$A_i=1$，$L_i=1$，$E_0=1$，$k_0=1$，$F=1$，$Q=1$。\n柔度表达式简化为：\n$C_{\\text{mech},i}(\\rho_i) = \\frac{1^2 \\cdot 1}{1 \\cdot \\rho_i^p \\cdot 1} = \\frac{1}{\\rho_i^p} = \\rho_i^{-p}$。\n$C_{\\text{therm},i}(\\rho_i) = \\frac{1^2 \\cdot 1}{1 \\cdot \\rho_i^p \\cdot 1} = \\frac{1}{\\rho_i^p} = \\rho_i^{-p}$。\n\n需要最小化的目标函数是：\n$J(\\rho_1, \\rho_2) = \\sum_{i=1}^{2} (\\alpha w_i C_{\\text{mech},i}(\\rho_i) + \\beta t_i C_{\\text{therm},i}(\\rho_i))$。\n代入柔度表达式：\n$J(\\rho_1, \\rho_2) = (\\alpha w_1 + \\beta t_1) \\rho_1^{-p} + (\\alpha w_2 + \\beta t_2) \\rho_2^{-p}$。\n我们定义灵敏度数 $S_i = \\alpha w_i + \\beta t_i$。目标函数变为：\n$J(\\rho_1, \\rho_2) = S_1 \\rho_1^{-p} + S_2 \\rho_2^{-p}$。\n\n优化问题是：\n最小化 $J(\\rho_1, \\rho_2) = S_1 \\rho_1^{-p} + S_2 \\rho_2^{-p}$\n约束条件为 $g(\\rho_1, \\rho_2) = \\rho_1 + \\rho_2 - 1 = 0$。\n\n我们使用 Lagrange 乘子法。Lagrangian 函数是：\n$\\mathcal{L}(\\rho_1, \\rho_2, \\lambda) = J(\\rho_1, \\rho_2) + \\lambda g(\\rho_1, \\rho_2) = S_1 \\rho_1^{-p} + S_2 \\rho_2^{-p} + \\lambda(\\rho_1 + \\rho_2 - 1)$。\n\n通过将 Lagrangian 函数对 $\\rho_1$、$\\rho_2$ 和 $\\lambda$ 的偏导数设为零，得到一阶必要最优性条件：\n1. $\\frac{\\partial \\mathcal{L}}{\\partial \\rho_1} = -p S_1 \\rho_1^{-p-1} + \\lambda = 0 \\implies \\lambda = p S_1 \\rho_1^{-p-1}$。\n2. $\\frac{\\partial \\mathcal{L}}{\\partial \\rho_2} = -p S_2 \\rho_2^{-p-1} + \\lambda = 0 \\implies \\lambda = p S_2 \\rho_2^{-p-1}$。\n3. $\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = \\rho_1 + \\rho_2 - 1 = 0$。\n\n令 Lagrange 乘子 $\\lambda$ 的两个表达式相等：\n$p S_1 \\rho_1^{-p-1} = p S_2 \\rho_2^{-p-1}$\n$S_1 \\rho_1^{-p-1} = S_2 \\rho_2^{-p-1}$\n$\\frac{\\rho_2^{-p-1}}{\\rho_1^{-p-1}} = \\frac{S_1}{S_2}$\n$\\left(\\frac{\\rho_1}{\\rho_2}\\right)^{p+1} = \\frac{S_1}{S_2}$\n$\\frac{\\rho_1}{\\rho_2} = \\left(\\frac{S_1}{S_2}\\right)^{\\frac{1}{p+1}}$。\n\n从约束条件，我们有 $\\rho_2 = 1 - \\rho_1$。将其代入方程：\n$\\frac{\\rho_1}{1 - \\rho_1} = \\left(\\frac{S_1}{S_2}\\right)^{\\frac{1}{p+1}}$。\n令 $R = \\left(\\frac{S_1}{S_2}\\right)^{\\frac{1}{p+1}}$。则 $\\rho_1 = R(1 - \\rho_1) = R - R\\rho_1$。\n$\\rho_1 (1 + R) = R$。\n$\\rho_1 = \\frac{R}{1+R} = \\frac{\\left(\\frac{S_1}{S_2}\\right)^{\\frac{1}{p+1}}}{1+\\left(\\frac{S_1}{S_2}\\right)^{\\frac{1}{p+1}}}$。\n这也可以写成 $\\rho_1 = \\frac{1}{1 + \\left(\\frac{S_2}{S_1}\\right)^{\\frac{1}{p+1}}}$。\n\n现在，我们代入给定的数值：\n$\\alpha=1$, $\\beta=1$, $p=3$。\n$w_1=4$, $w_2=\\frac{1}{6}$。\n$t_1=\\frac{4}{3}$, $t_2=\\frac{1}{6}$。\n\n首先，计算灵敏度 $S_1$ 和 $S_2$：\n$S_1 = \\alpha w_1 + \\beta t_1 = (1)(4) + (1)(\\frac{4}{3}) = 4 + \\frac{4}{3} = \\frac{12}{3} + \\frac{4}{3} = \\frac{16}{3}$。\n$S_2 = \\alpha w_2 + \\beta t_2 = (1)(\\frac{1}{6}) + (1)(\\frac{1}{6}) = \\frac{1}{6} + \\frac{1}{6} = \\frac{2}{6} = \\frac{1}{3}$。\n\n接下来，计算比率 $\\frac{S_2}{S_1}$：\n$\\frac{S_2}{S_1} = \\frac{1/3}{16/3} = \\frac{1}{3} \\cdot \\frac{3}{16} = \\frac{1}{16}$。\n\n指数是 $\\frac{1}{p+1} = \\frac{1}{3+1} = \\frac{1}{4}$。\n现在计算项 $\\left(\\frac{S_2}{S_1}\\right)^{\\frac{1}{p+1}}$：\n$\\left(\\frac{1}{16}\\right)^{\\frac{1}{4}} = \\frac{1^{1/4}}{16^{1/4}} = \\frac{1}{\\sqrt[4]{16}} = \\frac{1}{2}$。\n\n最后，我们计算最优的 $\\rho_1$：\n$\\rho_1 = \\frac{1}{1 + \\frac{1}{2}} = \\frac{1}{\\frac{3}{2}} = \\frac{2}{3}$。\n\n单元 1 的最优密度是 $\\frac{2}{3}$。因此，单元 2 的最优密度是 $\\rho_2 = 1 - \\rho_1 = 1 - \\frac{2}{3} = \\frac{1}{3}$。两者都是有效的内部解（$0 < \\rho_i < 1$）。",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "在掌握了基本的柔度最小化之后，下一个练习  将挑战您处理更为复杂的性能约束。本问题引入了基于特征值的稳定性约束，要求在最小化热时间常数的同时，保证结构的基频不低于某个临界值。这个练习将展示拓扑优化框架如何灵活地整合来自不同物理域（动力学与热传导）的设计要求，并揭示主动约束在驱动最优设计中的关键作用。",
            "id": "3530732",
            "problem": "一个长度为 $L$、横截面积为 $A$ 的均匀杆状设计域被嵌入一个耦合热弹性设备中。单个伪密度设计变量 $x \\in [0,1]$ 通过固体各向同性材料惩罚 (SIMP) 模型均匀地缩放局部材料分布。弹性模量、质量密度和热导率分别被建模为 $E(x) = E_{0} x^{p}$、$\\rho(x) = \\rho_{0} x$ 和 $k(x) = k_{0} x^{q}$，其中 $p$ 和 $q$ 是给定的正指数。设备级目标是最小化杆的主导热时间常数，同时保证以基频固有频率的下界表示的最小机械振动稳定性裕度。\n\n使用以下基本原理：\n\n- 对于单自由度集总机械振子，依据牛顿第二定律和胡克定律：若等效刚度为 $k_{m}(x)$，等效质量为 $m(x)$，则自由振动方程为 $m(x) \\ddot{u} + k_{m}(x) u = 0$，其谐波解 $u(t) = U \\exp(\\mathrm{i} \\omega t)$ 意味着 $\\omega^{2}(x) = \\frac{k_{m}(x)}{m(x)}$。\n\n- 结合傅里叶定律的一维热传导能量守恒：在 $X \\in (0,L)$ 上，方程为 $\\rho(x) c \\, \\partial T/\\partial t = k(x) \\, \\partial^{2} T/\\partial X^{2}$，边界条件为齐次狄利克雷边界条件 $T(0,t) = 0$ 和 $T(L,t) = 0$。通过变量分离法可得到指数衰减模式，其衰减率为 $\\lambda_{n}(x) = (\\frac{k(x)}{\\rho(x)c}) (n \\pi/L)^{2}$，其中 $n \\in \\mathbb{N}$。主导热时间常数为 $\\tau(x) = 1/\\lambda_{1}(x) = \\frac{\\rho(x) c L^{2}}{\\pi^{2} k(x)}$。\n\n假设一个一致的一维有限元凝聚过程产生等效刚度 $k_{m}(x) = k_{m0} x^{p}$ 和等效集总质量 $m(x) = m_{0} x$，其中 $k_{m0}$ 和 $m_{0}$ 为已知的正常数。假设设计必须满足基于特征值的机械稳定性约束 $\\omega(x) \\ge \\omega_{\\min}$。\n\n给定参数 $p = 3$、$q = \\frac{1}{2}$、$k_{m0} = 9$、$m_{0} = 1$ 和 $\\omega_{\\min} = 2$（所有力学量均采用一致的相干单位，且 $c$ 和 $L$ 为任意但固定且为正的常数），利用上述基本定律建立标量拓扑优化问题\n$$\n\\min_{0 \\le x \\le 1} \\ \\tau(x) \\quad \\text{subject to} \\quad \\omega(x) \\ge \\omega_{\\min},\n$$\n然后，确定解决此问题的最优伪密度 $x^{\\star}$。将您的 $x^{\\star}$ 最终答案表示为一个无单位的精确数。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。所有提供的信息都具有科学依据、自洽且提法恰当。该问题是一个标准的标量约束优化问题，它源于力学和传热学的基本原理，并应用于使用固体各向同性材料惩罚 (SIMP) 模型的拓扑优化背景下。\n\n任务是找到解决以下问题的最优伪密度 $x^{\\star}$：\n$$\n\\min_{0 \\le x \\le 1} \\ \\tau(x) \\quad \\text{subject to} \\quad \\omega(x) \\ge \\omega_{\\min}\n$$\n\n首先，我们用设计变量 $x$ 来表示目标函数（热时间常数 $\\tau(x)$）和约束函数（固有频率 $\\omega(x)$）。\n\n热时间常数由下式给出：\n$$\n\\tau(x) = \\frac{\\rho(x) c L^{2}}{\\pi^{2} k(x)}\n$$\n使用SIMP关系式 $\\rho(x) = \\rho_{0} x$ 和 $k(x) = k_{0} x^{q}$，我们将它们代入 $\\tau(x)$ 的表达式中：\n$$\n\\tau(x) = \\frac{(\\rho_{0} x) c L^{2}}{\\pi^{2} (k_{0} x^{q})} = \\left(\\frac{\\rho_{0} c L^{2}}{\\pi^{2} k_{0}}\\right) x^{1-q}\n$$\n括号中的项是一个正常数，我们可以将其表示为 $C_{\\tau} = \\frac{\\rho_{0} c L^{2}}{\\pi^{2} k_{0}}$。寻找最优 $x$ 时不需要这个常数的具体值。使用给定参数 $q = \\frac{1}{2}$，目标函数变为：\n$$\n\\tau(x) = C_{\\tau} x^{1 - \\frac{1}{2}} = C_{\\tau} x^{\\frac{1}{2}}\n$$\n\n接下来，我们建立约束条件。固有频率的平方由下式给出：\n$$\n\\omega^{2}(x) = \\frac{k_{m}(x)}{m(x)}\n$$\n问题指定了等效刚度 $k_{m}(x) = k_{m0} x^{p}$ 和等效质量 $m(x) = m_{0} x$。代入这些值可得：\n$$\n\\omega^{2}(x) = \\frac{k_{m0} x^{p}}{m_{0} x} = \\frac{k_{m0}}{m_{0}} x^{p-1}\n$$\n固有频率是该表达式的平方根。由于 $x \\in [0,1]$，我们有：\n$$\n\\omega(x) = \\sqrt{\\frac{k_{m0}}{m_{0}}} x^{\\frac{p-1}{2}}\n$$\n我们现在代入给定的参数值 $p=3$、$k_{m0}=9$ 和 $m_{0}=1$：\n$$\n\\omega(x) = \\sqrt{\\frac{9}{1}} x^{\\frac{3-1}{2}} = 3 x^{\\frac{2}{2}} = 3x\n$$\n机械稳定性约束为 $\\omega(x) \\ge \\omega_{\\min}$。当 $\\omega_{\\min} = 2$ 时，该约束变为：\n$$\n3x \\ge 2 \\implies x \\ge \\frac{2}{3}\n$$\n\n现在，该优化问题可以完全用 $x$ 来表述：\n最小化 $\\tau(x) = C_{\\tau} x^{\\frac{1}{2}}$\n约束条件为：\n1. $x \\ge \\frac{2}{3}$ (来自机械稳定性)\n2. $0 \\le x \\le 1$ (来自设计变量的定义)\n\n这些约束的交集定义了 $x$ 的可行域，即区间 $x \\in [\\frac{2}{3}, 1]$。\n\n为了在该可行域内找到使目标函数 $\\tau(x) = C_{\\tau} x^{\\frac{1}{2}}$ 最小化的 $x$ 值，我们分析 $\\tau(x)$ 的行为。我们可以考察它关于 $x$ 的导数：\n$$\n\\frac{d\\tau}{dx} = \\frac{d}{dx} \\left( C_{\\tau} x^{\\frac{1}{2}} \\right) = C_{\\tau} \\left( \\frac{1}{2} x^{-\\frac{1}{2}} \\right) = \\frac{C_{\\tau}}{2\\sqrt{x}}\n$$\n由于 $C_{\\tau} > 0$ 且 $x$ 的可行域为 $[\\frac{2}{3}, 1]$，导数 $\\frac{d\\tau}{dx}$ 在整个可行域上严格为正。这意味着目标函数 $\\tau(x)$ 是关于 $x$ 的严格单调递增函数。\n\n要在一个闭区间上最小化一个严格递增函数，必须选择该区间内变量的最小值。可行区间是 $[\\frac{2}{3}, 1]$。此区间中的最小值是 $\\frac{2}{3}$。\n\n因此，在满足机械稳定性约束的同时最小化热时间常数的最优伪密度 $x^{\\star}$ 是可行集的下界。\n\n$$\nx^{\\star} = \\frac{2}{3}\n$$",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "理论分析为我们提供了深刻的洞见，但解决大规模、高度耦合的多物理场问题，离不开高效的计算方法。最后一个练习  是一个编程实践，它将引导您深入多物理场拓扑优化的计算核心：伴随法（adjoint method）灵敏度分析。您将为一个离散的热-弹性耦合系统推导伴随方程，并编写代码来计算目标函数相对于设计变量的梯度，最后通过与有限差分法的对比来验证其准确性，这是开发可靠优化算法的关键一步。",
            "id": "3530723",
            "problem": "考虑一个用于模拟热弹性相互作用的稳态线性双场耦合系统，其离散形式适用于拓扑与形状优化。设机械位移矢量为 $u \\in \\mathbb{R}^{2}$，温度矢量为 $T \\in \\mathbb{R}^{2}$。定义状态矢量 $y \\in \\mathbb{R}^{4}$ 为 $y = \\begin{bmatrix} u \\\\ T \\end{bmatrix}$。耦合控制方程以残差形式给出：\n$$\nF(y,\\rho) = \\begin{bmatrix} K_u(\\rho)  -B \\\\ -S  K_T(\\rho) \\end{bmatrix} \\begin{bmatrix} u \\\\ T \\end{bmatrix} - \\begin{bmatrix} f_{\\mathrm{ext}} \\\\ q_{\\mathrm{ext}} \\end{bmatrix} = 0,\n$$\n其中 $K_u(\\rho) \\in \\mathbb{R}^{2 \\times 2}$ 和 $K_T(\\rho) \\in \\mathbb{R}^{2 \\times 2}$ 分别是用于力学和热学的类刚度矩阵，它们依赖于设计矢量 $\\rho \\in [0,1]^m$（其中 $m=3$），而 $B \\in \\mathbb{R}^{2 \\times 2}$ 和 $S \\in \\mathbb{R}^{2 \\times 2}$ 是固定的耦合矩阵。外部机械载荷矢量为 $f_{\\mathrm{ext}} \\in \\mathbb{R}^{2}$，外部热载荷矢量为 $q_{\\mathrm{ext}} \\in \\mathbb{R}^{2}$。\n\n类刚度矩阵是通过固体各向同性材料惩罚 (Solid Isotropic Material with Penalization, SIMP) 插值法由单元基组装而成。设机械单元基为\n$$\nK_{u,1} = \\begin{bmatrix} 2  -1 \\\\ -1  2 \\end{bmatrix}, \\quad\nK_{u,2} = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix}, \\quad\nK_{u,3} = \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix},\n$$\n热单元基为\n$$\nK_{T,1} = \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}, \\quad\nK_{T,2} = \\begin{bmatrix} 2  -1 \\\\ -1  2 \\end{bmatrix}, \\quad\nK_{T,3} = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix}.\n$$\n对于每个单元索引 $i \\in \\{1,2,3\\}$，定义 SIMP 插值为\n$$\nE_i(\\rho_i) = E_{\\min} + \\rho_i^p \\left(E_0 - E_{\\min}\\right), \\quad\nk_i(\\rho_i) = k_{\\min} + \\rho_i^p \\left(k_0 - k_{\\min}\\right),\n$$\n因此\n$$\nK_u(\\rho) = \\sum_{i=1}^{3} E_i(\\rho_i) K_{u,i}, \\qquad\nK_T(\\rho) = \\sum_{i=1}^{3} k_i(\\rho_i) K_{T,i}.\n$$\n假设 $E_0 > 0$、$k_0 > 0$、$E_{\\min} > 0$、$k_{\\min} > 0$ 且 $p \\ge 1$。\n\n拓扑优化的目标泛函是一个类柔度度量，并增广了一个热学二次项和对设计的线性正则化项：\n$$\nJ(y,\\rho) = f_{\\mathrm{ext}}^{\\top} u + \\gamma \\, T^{\\top} W T + \\eta \\sum_{i=1}^{3} \\rho_i,\n$$\n其中 $W \\in \\mathbb{R}^{2 \\times 2}$ 是对称正定矩阵，且 $\\gamma > 0, \\eta > 0$。\n\n您的任务是：\n- 从第一性原理推导 $J(y(\\rho),\\rho)$ 关于设计 $\\rho$ 的基于离散伴随的梯度，其中 $y(\\rho)$ 是 $F(y,\\rho) = 0$ 的解。使用拉格朗日函数 $L(y,\\rho,\\lambda) = J(y,\\rho) + \\lambda^{\\top} F(y,\\rho)$ 和条件 \n$$\n\\left(\\frac{\\partial F}{\\partial y}(y,\\rho)\\right)^{\\top} \\lambda + \\frac{\\partial J}{\\partial y}(y,\\rho) = 0\n$$\n来定义伴随矢量 $\\lambda \\in \\mathbb{R}^{4}$，并用 $y$、$\\lambda$ 以及 $K_u(\\rho)$ 和 $K_T(\\rho)$ 的导数来表示 $\\nabla_{\\rho} J$。\n- 实现一个程序，该程序针对给定的测试用例计算伴随梯度，并与有限差分中心近似进行验证。报告每个测试用例中，伴随梯度与有限差分梯度在所有设计分量上的最大绝对差。\n\n对 SIMP 和目标函数使用以下数值参数：\n$$\nE_0 = 1.0,\\quad E_{\\min} = 10^{-3},\\quad k_0 = 1.0,\\quad k_{\\min} = 10^{-3},\\quad p = 3,\\quad \\gamma = 0.1,\\quad \\eta = 0.01,\\quad W = I_2,\n$$\n其中 $I_2$ 表示 $2 \\times 2$ 单位矩阵。\n\n使用以下由 $(\\rho, B, S, f_{\\mathrm{ext}}, q_{\\mathrm{ext}})$ 定义的 4 个测试用例组成的测试套件：\n- 案例 1 (一般耦合，中等设计)：\n$$\n\\rho = \\begin{bmatrix} 0.6 \\\\ 0.8 \\\\ 0.3 \\end{bmatrix},\\quad\nB = \\begin{bmatrix} 0.4  0.0 \\\\ 0.0  0.2 \\end{bmatrix},\\quad\nS = \\begin{bmatrix} 0.1  0.05 \\\\ 0.0  0.2 \\end{bmatrix},\\quad\nf_{\\mathrm{ext}} = \\begin{bmatrix} 1.0 \\\\ 0.5 \\end{bmatrix},\\quad\nq_{\\mathrm{ext}} = \\begin{bmatrix} 0.3 \\\\ 0.2 \\end{bmatrix}.\n$$\n- 案例 2 (近奇异设计，由于 $E_{\\min}$ 和 $k_{\\min}$ 的存在仍然是适定的)：\n$$\n\\rho = \\begin{bmatrix} 10^{-3} \\\\ 10^{-3} \\\\ 10^{-3} \\end{bmatrix},\\quad\nB = \\begin{bmatrix} 0.4  0.0 \\\\ 0.0  0.2 \\end{bmatrix},\\quad\nS = \\begin{bmatrix} 0.1  0.05 \\\\ 0.0  0.2 \\end{bmatrix},\\quad\nf_{\\mathrm{ext}} = \\begin{bmatrix} 1.0 \\\\ 0.5 \\end{bmatrix},\\quad\nq_{\\mathrm{ext}} = \\begin{bmatrix} 0.3 \\\\ 0.2 \\end{bmatrix}.\n$$\n- 案例 3 (解耦场)：\n$$\n\\rho = \\begin{bmatrix} 0.5 \\\\ 0.5 \\\\ 0.5 \\end{bmatrix},\\quad\nB = \\begin{bmatrix} 0.0  0.0 \\\\ 0.0  0.0 \\end{bmatrix},\\quad\nS = \\begin{bmatrix} 0.0  0.0 \\\\ 0.0  0.0 \\end{bmatrix},\\quad\nf_{\\mathrm{ext}} = \\begin{bmatrix} 1.0 \\\\ 0.5 \\end{bmatrix},\\quad\nq_{\\mathrm{ext}} = \\begin{bmatrix} 0.3 \\\\ 0.2 \\end{bmatrix}.\n$$\n- 案例 4 (强耦合)：\n$$\n\\rho = \\begin{bmatrix} 0.9 \\\\ 0.1 \\\\ 0.7 \\end{bmatrix},\\quad\nB = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix},\\quad\nS = \\begin{bmatrix} 0.5  0.3 \\\\ 0.3  0.8 \\end{bmatrix},\\quad\nf_{\\mathrm{ext}} = \\begin{bmatrix} 1.0 \\\\ 0.5 \\end{bmatrix},\\quad\nq_{\\mathrm{ext}} = \\begin{bmatrix} 0.3 \\\\ 0.2 \\end{bmatrix}.\n$$\n\n对于每个案例，您的程序应执行以下操作：\n- 组装 $K_u(\\rho)$ 和 $K_T(\\rho)$。\n- 从 $F(y,\\rho) = 0$ 求解 $y(\\rho)$。\n- 构造 $\\dfrac{\\partial J}{\\partial y}(y,\\rho)$ 并求解伴随系统 \n$$\n\\left(\\frac{\\partial F}{\\partial y}(y,\\rho)\\right)^{\\top} \\lambda + \\frac{\\partial J}{\\partial y}(y,\\rho) = 0,\n$$\n其中 $\\dfrac{\\partial F}{\\partial y}(y,\\rho) = \\begin{bmatrix} K_u(\\rho)  -B \\\\ -S  K_T(\\rho) \\end{bmatrix}$。\n- 计算伴随梯度 $\\nabla_{\\rho} J = \\dfrac{\\partial J}{\\partial \\rho} + \\lambda^{\\top} \\dfrac{\\partial F}{\\partial \\rho}$，其分量为\n$$\n\\frac{\\partial J}{\\partial \\rho_i} = \\eta, \\qquad\n\\lambda^{\\top} \\frac{\\partial F}{\\partial \\rho_i} = \\lambda_u^{\\top} \\left(\\frac{\\partial K_u}{\\partial \\rho_i}\\right) u + \\lambda_T^{\\top} \\left(\\frac{\\partial K_T}{\\partial \\rho_i}\\right) T,\n$$\n且\n$$\n\\frac{\\partial K_u}{\\partial \\rho_i} = \\frac{d E_i}{d \\rho_i} K_{u,i}, \\quad \\frac{d E_i}{d \\rho_i} = p \\rho_i^{p-1} \\left(E_0 - E_{\\min}\\right), \\qquad\n\\frac{\\partial K_T}{\\partial \\rho_i} = \\frac{d k_i}{d \\rho_i} K_{T,i}, \\quad \\frac{d k_i}{d \\rho_i} = p \\rho_i^{p-1} \\left(k_0 - k_{\\min}\\right).\n$$\n- 使用扰动 $\\varepsilon = 10^{-8}$ 计算 $\\nabla_{\\rho} J$ 的有限差分中心近似。\n- 对于每个案例，返回伴随梯度与有限差分梯度之间的最大绝对差。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_1,r_2,r_3,r_4]$），其中每个 $r_j$ 是案例 $j$ 的最大绝对差。所有报告的值都是无量纲实数。",
            "solution": "我们从离散多物理场系统的残差形式开始：\n$$\nF(y,\\rho) = \\mathcal{A}(\\rho) y - b = 0,\n$$\n其中\n$$\n\\mathcal{A}(\\rho) = \\begin{bmatrix} K_u(\\rho)  -B \\\\ -S  K_T(\\rho) \\end{bmatrix}, \\qquad\nb = \\begin{bmatrix} f_{\\mathrm{ext}} \\\\ q_{\\mathrm{ext}} \\end{bmatrix},\n$$\n$y = \\begin{bmatrix} u \\\\ T \\end{bmatrix}$，其中 $u \\in \\mathbb{R}^{2}$ 和 $T \\in \\mathbb{R}^{2}$，以及 $\\rho = \\begin{bmatrix} \\rho_1 \\\\ \\rho_2 \\\\ \\rho_3 \\end{bmatrix} \\in [0,1]^3$。目标函数为\n$$\nJ(y,\\rho) = f_{\\mathrm{ext}}^{\\top} u + \\gamma \\, T^{\\top} W T + \\eta \\sum_{i=1}^{3} \\rho_i.\n$$\n\n伴随方法从拉格朗日函数推导而来：\n$$\nL(y,\\rho,\\lambda) = J(y,\\rho) + \\lambda^{\\top} F(y,\\rho) = J(y,\\rho) + \\lambda^{\\top}\\left(\\mathcal{A}(\\rho) y - b\\right),\n$$\n其中 $\\lambda \\in \\mathbb{R}^{4}$ 是伴随矢量。将 $L$ 对 $y$ 求导并令其为零，即可得到伴随方程。具体来说，\n$$\n\\frac{\\partial L}{\\partial y} = \\frac{\\partial J}{\\partial y} + \\left(\\frac{\\partial F}{\\partial y}\\right)^{\\top} \\lambda = 0,\n$$\n即\n$$\n\\left(\\frac{\\partial F}{\\partial y}\\right)^{\\top} \\lambda + \\frac{\\partial J}{\\partial y} = 0.\n$$\n对于我们的残差 $F(y,\\rho) = \\mathcal{A}(\\rho) y - b$，其关于 $y$ 的雅可比矩阵为：\n$$\n\\frac{\\partial F}{\\partial y} = \\mathcal{A}(\\rho) = \\begin{bmatrix} K_u(\\rho)  -B \\\\ -S  K_T(\\rho) \\end{bmatrix}.\n$$\n目标函数关于 $y$ 的梯度为：\n$$\n\\frac{\\partial J}{\\partial y} = \\begin{bmatrix} \\frac{\\partial J}{\\partial u} \\\\ \\frac{\\partial J}{\\partial T} \\end{bmatrix}\n= \\begin{bmatrix} f_{\\mathrm{ext}} \\\\ 2 \\gamma W T \\end{bmatrix}.\n$$\n因此，伴随方程变为\n$$\n\\mathcal{A}(\\rho)^{\\top} \\lambda + \\begin{bmatrix} f_{\\mathrm{ext}} \\\\ 2 \\gamma W T \\end{bmatrix} = 0.\n$$\n求解这个 $4 \\times 4$ 线性系统可得到 $\\lambda = \\begin{bmatrix} \\lambda_u \\\\ \\lambda_T \\end{bmatrix}$，其中 $\\lambda_u \\in \\mathbb{R}^{2}$ 和 $\\lambda_T \\in \\mathbb{R}^{2}$。\n\n接下来，目标函数 $J(y(\\rho),\\rho)$ 关于 $\\rho$ 的全导数为：\n$$\n\\frac{d}{d \\rho_i} J(y(\\rho),\\rho) = \\frac{\\partial J}{\\partial \\rho_i} + \\left(\\frac{\\partial J}{\\partial y}\\right)^{\\top} \\frac{\\partial y}{\\partial \\rho_i}.\n$$\n使用约束条件 $F(y(\\rho),\\rho) = 0$，我们对其关于 $\\rho_i$ 求导：\n$$\n\\frac{\\partial F}{\\partial y} \\frac{\\partial y}{\\partial \\rho_i} + \\frac{\\partial F}{\\partial \\rho_i} = 0\n\\quad \\Rightarrow \\quad\n\\frac{\\partial y}{\\partial \\rho_i} = - \\left(\\frac{\\partial F}{\\partial y}\\right)^{-1} \\frac{\\partial F}{\\partial \\rho_i}.\n$$\n代入 $\\dfrac{dJ}{d\\rho_i}$ 的表达式中，可得：\n$$\n\\frac{dJ}{d\\rho_i} = \\frac{\\partial J}{\\partial \\rho_i} - \\left(\\frac{\\partial J}{\\partial y}\\right)^{\\top} \\left(\\frac{\\partial F}{\\partial y}\\right)^{-1} \\frac{\\partial F}{\\partial \\rho_i}.\n$$\n通过求解以下方程引入伴随矢量 $\\lambda$：\n$$\n\\left(\\frac{\\partial F}{\\partial y}\\right)^{\\top} \\lambda + \\frac{\\partial J}{\\partial y} = 0\n\\quad \\Rightarrow \\quad\n\\lambda = - \\left(\\frac{\\partial F}{\\partial y}\\right)^{-\\top} \\frac{\\partial J}{\\partial y}.\n$$\n于是\n$$\n\\frac{dJ}{d\\rho_i} = \\frac{\\partial J}{\\partial \\rho_i} + \\lambda^{\\top} \\frac{\\partial F}{\\partial \\rho_i}.\n$$\n这就是经典的伴随灵敏度公式：关于设计的梯度等于直接导数加上伴随加权的残差导数。\n\n对于我们的具体问题，请注意 $b$ 不依赖于 $\\rho$，并且残差关于 $\\rho_i$ 的导数为：\n$$\n\\frac{\\partial F}{\\partial \\rho_i} = \\begin{bmatrix} \\frac{\\partial K_u}{\\partial \\rho_i}  0 \\\\ 0  \\frac{\\partial K_T}{\\partial \\rho_i} \\end{bmatrix} \\begin{bmatrix} u \\\\ T \\end{bmatrix}\n= \\begin{bmatrix} \\left(\\frac{\\partial K_u}{\\partial \\rho_i}\\right) u \\\\ \\left(\\frac{\\partial K_T}{\\partial \\rho_i}\\right) T \\end{bmatrix}.\n$$\n因此，\n$$\n\\lambda^{\\top} \\frac{\\partial F}{\\partial \\rho_i} = \\lambda_u^{\\top} \\left(\\frac{\\partial K_u}{\\partial \\rho_i}\\right) u + \\lambda_T^{\\top} \\left(\\frac{\\partial K_T}{\\partial \\rho_i}\\right) T.\n$$\n类刚度矩阵的偏导数为\n$$\n\\frac{\\partial K_u}{\\partial \\rho_i} = \\frac{d E_i}{d \\rho_i} K_{u,i}, \\quad \\frac{d E_i}{d \\rho_i} = p \\rho_i^{p-1} \\left(E_0 - E_{\\min}\\right),\n$$\n以及\n$$\n\\frac{\\partial K_T}{\\partial \\rho_i} = \\frac{d k_i}{d \\rho_i} K_{T,i}, \\quad \\frac{d k_i}{d \\rho_i} = p \\rho_i^{p-1} \\left(k_0 - k_{\\min}\\right).\n$$\n$J$ 关于 $\\rho_i$ 的直接导数就是：\n$$\n\\frac{\\partial J}{\\partial \\rho_i} = \\eta,\n$$\n因为类柔度项 $f_{\\mathrm{ext}}^{\\top} u$ 和热学二次项 $\\gamma T^{\\top} W T$ 除了通过 $y(\\rho)$ 之外，没有对 $\\rho$ 的显式依赖，而这种依赖已经由伴随方法处理了。\n\n每个测试用例的算法流程：\n- 根据基和 SIMP 系数 $E_i(\\rho_i)$ 和 $k_i(\\rho_i)$ 组装 $K_u(\\rho)$ 和 $K_T(\\rho)$。\n- 构建 $4 \\times 4$ 分块矩阵 $\\mathcal{A}(\\rho)$ 和右端项 $b$。\n- 求解正向线性系统 $\\mathcal{A}(\\rho) y = b$ 以获得 $y = \\begin{bmatrix} u \\\\ T \\end{bmatrix}$。\n- 将目标函数关于 $y$ 的梯度构造为 $\\dfrac{\\partial J}{\\partial y} = \\begin{bmatrix} f_{\\mathrm{ext}} \\\\ 2 \\gamma W T \\end{bmatrix}$。\n- 求解伴随系统 $\\mathcal{A}(\\rho)^{\\top} \\lambda = - \\dfrac{\\partial J}{\\partial y}$ 以获得 $\\lambda$。\n- 计算伴随梯度分量\n$$\n\\left(\\nabla_{\\rho} J\\right)_i = \\eta + \\lambda_u^{\\top} \\left(\\frac{\\partial K_u}{\\partial \\rho_i}\\right) u + \\lambda_T^{\\top} \\left(\\frac{\\partial K_T}{\\partial \\rho_i}\\right) T, \\quad i = 1,2,3.\n$$\n- 通过有限差分进行验证：对于一个很小的 $\\varepsilon = 10^{-8}$，计算中心差分\n$$\n\\left(\\nabla_{\\rho} J\\right)^{\\mathrm{FD}}_i \\approx \\frac{J\\left(y(\\rho + \\varepsilon e_i), \\rho + \\varepsilon e_i\\right) - J\\left(y(\\rho - \\varepsilon e_i), \\rho - \\varepsilon e_i\\right)}{2 \\varepsilon},\n$$\n其中 $e_i$ 是 $\\mathbb{R}^3$ 中的第 $i$ 个单位矢量，而 $y(\\cdot)$ 是通过求解扰动后设计的正向问题得到的。\n- 计算最大绝对差\n$$\nr = \\max_{i \\in \\{1,2,3\\}} \\left| \\left(\\nabla_{\\rho} J\\right)_i - \\left(\\nabla_{\\rho} J\\right)^{\\mathrm{FD}}_i \\right|.\n$$\n\n数值稳定性与物理真实性：\n- SIMP 的下界 $E_{\\min} > 0$ 和 $k_{\\min} > 0$ 确保了 $K_u(\\rho)$ 和 $K_T(\\rho)$ 是对称半正定基的正定组合，因此对于给定的耦合，分块矩阵 $\\mathcal{A}(\\rho)$ 是非奇异的。\n- 耦合矩阵 $B$ 和 $S$ 代表线性化的热弹性相互作用。虽然真实的热弹性耦合通常以热膨胀载荷的形式进入力学方程，并通过耗散源进入热方程，但这种对称分块表示提供了一个数学上合理的耦合线性系统，适合用于伴随灵敏度分析的演示。\n- 中心有限差分步长 $\\varepsilon$ 被选得足够小，以确保在双精度算术下获得高精度近似，而不会产生过度的舍入误差。\n\n该程序实现了所描述的流程，并为 4 个测试用例返回列表 $[r_1, r_2, r_3, r_4]$，其中包含衡量伴随梯度和有限差分梯度之间差异的无量纲实数。",
            "answer": "```python\nimport numpy as np\n\ndef simp_coef(rho_i, x0, xmin, p):\n    \"\"\"Calculates the SIMP interpolated material property.\"\"\"\n    return xmin + (x0 - xmin) * (rho_i ** p)\n\ndef simp_deriv(rho_i, x0, xmin, p):\n    \"\"\"Calculates the derivative of the SIMP interpolation.\"\"\"\n    if p * (x0 - xmin) == 0:\n        return 0.0\n    return p * (rho_i ** (p - 1)) * (x0 - xmin)\n\ndef assemble_matrices(rho, Ku_bases, Kt_bases, E0, Emin, k0, kmin, p):\n    \"\"\"Assembles global stiffness-like matrices and their derivatives.\"\"\"\n    Ku = np.zeros((2, 2))\n    Kt = np.zeros((2, 2))\n    dKu_drho = []\n    dKt_drho = []\n    for i in range(len(rho)):\n        Ei = simp_coef(rho[i], E0, Emin, p)\n        ki = simp_coef(rho[i], k0, kmin, p)\n        dEi = simp_deriv(rho[i], E0, Emin, p)\n        dki = simp_deriv(rho[i], k0, kmin, p)\n        Ku += Ei * Ku_bases[i]\n        Kt += ki * Kt_bases[i]\n        dKu_drho.append(dEi * Ku_bases[i])\n        dKt_drho.append(dki * Kt_bases[i])\n    return Ku, Kt, dKu_drho, dKt_drho\n\ndef build_block_matrix(Ku, Kt, B, S):\n    \"\"\"Builds the 4x4 coupled system matrix.\"\"\"\n    A = np.zeros((4, 4))\n    A[0:2, 0:2] = Ku\n    A[0:2, 2:4] = -B\n    A[2:4, 0:2] = -S\n    A[2:4, 2:4] = Kt\n    return A\n\ndef solve_forward(rho, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p):\n    \"\"\"Solves the forward problem F(y, rho) = 0 for y.\"\"\"\n    Ku, Kt, dKu_drho, dKt_drho = assemble_matrices(rho, Ku_bases, Kt_bases, E0, Emin, k0, kmin, p)\n    A = build_block_matrix(Ku, Kt, B, S)\n    b = np.hstack([fext, qext])\n    y = np.linalg.solve(A, b)\n    u = y[0:2]\n    T = y[2:4]\n    return u, T, A, dKu_drho, dKt_drho\n\ndef objective(u, T, rho, fext, gamma, W, eta):\n    \"\"\"Calculates the objective function J.\"\"\"\n    return float(fext @ u + gamma * (T @ (W @ T)) + eta * np.sum(rho))\n\ndef adjoint_gradient(rho, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p, gamma, W, eta):\n    \"\"\"Computes the gradient of J using the adjoint method.\"\"\"\n    u, T, A, dKu_drho, dKt_drho = solve_forward(rho, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p)\n    \n    # Adjoint RHS: -dJ/dy\n    dJ_du = fext\n    dJ_dT = 2.0 * gamma * (W @ T)\n    dJ_dy = np.hstack([dJ_du, dJ_dT])\n    rhs_adj = -dJ_dy\n    \n    # Solve adjoint system: A^T * lambda = -dJ/dy\n    lam = np.linalg.solve(A.T, rhs_adj)\n    lam_u = lam[0:2]\n    lam_T = lam[2:4]\n    \n    # Compute gradient components\n    grad = np.zeros(len(rho))\n    for i in range(len(rho)):\n        dJ_drho_explicit = eta\n        term_u = lam_u @ (dKu_drho[i] @ u)\n        term_T = lam_T @ (dKt_drho[i] @ T)\n        grad[i] = dJ_drho_explicit + term_u + term_T\n        \n    return grad\n\ndef fd_gradient(rho, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p, gamma, W, eta, eps=1e-8):\n    \"\"\"Computes the gradient of J using finite differences for verification.\"\"\"\n    grad_fd = np.zeros(len(rho))\n    for i in range(len(rho)):\n        rho_plus = rho.copy()\n        rho_minus = rho.copy()\n        \n        rho_plus[i] += eps\n        rho_minus[i] -= eps\n        \n        u_p, T_p, _, _, _ = solve_forward(rho_plus, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p)\n        J_p = objective(u_p, T_p, rho_plus, fext, gamma, W, eta)\n        \n        u_m, T_m, _, _, _ = solve_forward(rho_minus, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p)\n        J_m = objective(u_m, T_m, rho_minus, fext, gamma, W, eta)\n        \n        grad_fd[i] = (J_p - J_m) / (2 * eps)\n        \n    return grad_fd\n\ndef run_case(rho, B, S, fext, qext):\n    \"\"\"Runs a single test case and computes the gradient error.\"\"\"\n    # Parameters\n    E0, Emin = 1.0, 1e-3\n    k0, kmin = 1.0, 1e-3\n    p = 3\n    gamma, eta = 0.1, 0.01\n    W = np.eye(2)\n\n    # Bases\n    Ku_bases = [np.array([[2.0, -1.0], [-1.0, 2.0]]),\n                np.array([[1.0, 0.0], [0.0, 1.0]]),\n                np.array([[1.0, -1.0], [-1.0, 1.0]])]\n    Kt_bases = [np.array([[1.0, -1.0], [-1.0, 1.0]]),\n                np.array([[2.0, -1.0], [-1.0, 2.0]]),\n                np.array([[1.0, 0.0], [0.0, 1.0]])]\n\n    grad_adj = adjoint_gradient(rho, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p, gamma, W, eta)\n    grad_fd = fd_gradient(rho, Ku_bases, Kt_bases, B, S, fext, qext, E0, Emin, k0, kmin, p, gamma, W, eta, eps=1e-8)\n    \n    max_diff = float(np.max(np.abs(grad_adj - grad_fd)))\n    return max_diff\n\ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    test_cases = [\n        # Case 1\n        (np.array([0.6, 0.8, 0.3]), np.array([[0.4, 0.0], [0.0, 0.2]]), np.array([[0.1, 0.05], [0.0, 0.2]]), np.array([1.0, 0.5]), np.array([0.3, 0.2])),\n        # Case 2\n        (np.array([1e-3, 1e-3, 1e-3]), np.array([[0.4, 0.0], [0.0, 0.2]]), np.array([[0.1, 0.05], [0.0, 0.2]]), np.array([1.0, 0.5]), np.array([0.3, 0.2])),\n        # Case 3\n        (np.array([0.5, 0.5, 0.5]), np.array([[0.0, 0.0], [0.0, 0.0]]), np.array([[0.0, 0.0], [0.0, 0.0]]), np.array([1.0, 0.5]), np.array([0.3, 0.2])),\n        # Case 4\n        (np.array([0.9, 0.1, 0.7]), np.array([[1.0, 0.0], [0.0, 1.0]]), np.array([[0.5, 0.3], [0.3, 0.8]]), np.array([1.0, 0.5]), np.array([0.3, 0.2])),\n    ]\n\n    results = [run_case(*case) for case in test_cases]\n\n    print(f\"[{','.join(map(lambda x: f'{x:.12e}', results))}]\")\n\nsolve()\n```"
        }
    ]
}