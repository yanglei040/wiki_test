{
    "hands_on_practices": [
        {
            "introduction": "坡印廷定理是电磁学中能量守恒的基石。然而，当我们将连续的麦克斯韦方程组离散化以进行数值模拟时，这个精确的守恒定律不一定能被严格保持。本练习将指导您实现一个基础的等离子体-电磁场耦合数值格式，并量化其在离散层面上对能量守恒定律的违背程度。这是一个至关重要的计算物理实践，能加深您对数值截断误差如何表现为守恒律残差的理解。",
            "id": "3522867",
            "problem": "考虑一个一维（$x$）周期性区域，其长度为 $L$，被离散化为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元格。等离子体由流体变量和电磁场建模。流体是理想气体，其质量密度为 $\\rho$，速度为 $u$，压力为 $p$，比热容比为 $\\gamma$。电磁场是横向电场分量 $E_z$ 和横向磁场分量 $B_y$，其真空介电常数为 $\\epsilon_0$，真空磁导率为 $\\mu_0$，满足 $c^2 = 1/(\\mu_0 \\epsilon_0)$，其中 $c$ 是光速。\n\n从以下基本定律和核心定义出发：\n- 麦克斯韦-法拉第定律：$\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$。\n- 包含传导电流的安培-麦克斯韦定律：$\\partial_t \\mathbf{E} = c^2 \\nabla \\times \\mathbf{B} - \\mathbf{J}/\\epsilon_0$。\n- 欧姆定律（实验室参考系中的电阻模型）：$\\mathbf{J} = \\sigma \\left(\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} \\right)$，其中 $\\sigma$ 是电导率。\n- 理想气体内能密度：$e = p/(\\gamma-1)$ 和流体动能密度：$\\rho u^2/2$。\n- 电磁能量密度：$U_{\\mathrm{em}} = \\epsilon_0 E^2/2 + B^2/(2\\mu_0)$ 和坡印亭矢量：$\\mathbf{S} = (1/\\mu_0)\\mathbf{E} \\times \\mathbf{B}$。\n- 坡印亭定理（电磁能量平衡）：$\\partial_t U_{\\mathrm{em}} + \\nabla \\cdot \\mathbf{S} = -\\mathbf{J} \\cdot \\mathbf{E}$。\n\n在一维配置中，取 $\\mathbf{u} = (u,0,0)$，$\\mathbf{E} = (0,0,E_z)$ 和 $\\mathbf{B} = (0,B_y,0)$。根据上述定律，推导出组合能量密度 $U = \\rho u^2/2 + p/(\\gamma-1) + B_y^2/(2\\mu_0) + \\epsilon_0 E_z^2/2$ 及其连续平衡方程，并说明电磁耦合项 $-\\mathbf{J}\\cdot\\mathbf{E}$ 如何出现在场能量中，以及机械功如何与流体能量耦合。然后，在一个均匀网格上，使用有限体积法为电磁部分构建一个离散能量平衡方程：\n\n- 离散空间导数使用带有周期性边界条件的二阶中心差分：\n  - $\\left(\\partial_x f\\right)_i \\approx \\left(f_{i+1} - f_{i-1}\\right)/(2\\Delta x)$。\n- 时间步进是显式前向欧拉法：\n  - $E_i^{n+1} = E_i^n + \\Delta t \\left(c^2 \\left(\\partial_x B\\right)_i^n - J_i^n/\\epsilon_0\\right)$，\n  - $B_i^{n+1} = B_i^n + \\Delta t \\left(\\partial_x E\\right)_i^n$。\n- 时间层 $n$ 的离散电磁能量密度为 $U_{\\mathrm{em},i}^n = \\epsilon_0 \\left(E_i^n\\right)^2/2 + \\left(B_i^n\\right)^2/(2\\mu_0)$。\n- 单元格界面处的离散坡印亭通量使用算术平均：\n  - $S_{x,i+1/2}^n = -\\left(1/\\mu_0\\right)\\left(\\frac{E_i^n + E_{i+1}^n}{2}\\right)\\left(\\frac{B_i^n + B_{i+1}^n}{2}\\right)$，\n  - $\\left(\\nabla \\cdot \\mathbf{S}\\right)_i^n \\approx \\left(S_{x,i+1/2}^n - S_{x,i-1/2}^n\\right)/\\Delta x$。\n- 离散电流密度为 $J_i^n = \\sigma \\left(E_i^n + u B_i^n\\right)$。\n\n在一个时间步之后，定义每个单元格的电磁坡印亭定理的离散残差：\n$$\nR_i = \\frac{U_{\\mathrm{em},i}^{n+1} - U_{\\mathrm{em},i}^n}{\\Delta t} + \\left(\\nabla \\cdot \\mathbf{S}\\right)_i^n + J_i^n E_i^n.\n$$\n\n使用均方根（RMS）范数测量标量残差，并通过三个项的RMS量级之和进行归一化：\n$$\n\\mathrm{rms}(X) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1} X_i^2}, \\quad\n\\mathcal{R} = \\frac{\\mathrm{rms}(R)}{\\mathrm{rms}\\left(\\frac{U_{\\mathrm{em}}^{n+1} - U_{\\mathrm{em}}^n}{\\Delta t}\\right) + \\mathrm{rms}\\left(\\nabla \\cdot \\mathbf{S}\\right) + \\mathrm{rms}\\left(J E\\right) + \\varepsilon},\n$$\n带有一个小的稳定化项 $\\varepsilon = 10^{-30}$。\n\n您的程序必须实现上述离散格式，进行一个显式时间步的计算，并为每个测试用例计算 $\\mathcal{R}$。每个测试用例的输出必须是一个布尔值，如果 $\\mathcal{R}  \\tau$（其中 $\\tau$ 是指定的容差），则为 true。使用以下常数和测试套件，所有单位均为国际单位制（SI）：\n\n- 常数：\n  - $L = 1.0$，\n  - $c = 299792458.0$，\n  - $\\mu_0 = 4\\pi\\times 10^{-7}$，\n  - $\\epsilon_0 = 1/\\left(\\mu_0 c^2\\right)$，\n  - $\\gamma = 5/3$，\n  - $\\tau = 10^{-3}$，\n  - $\\mathrm{CFL} = 0.1$。\n\n- 测试套件用例：\n  1. 电阻弛豫（正常路径）：$N = 256$，$u = 0.0$，$\\sigma = 1000.0$，$E_z(x) = E_0 \\sin(2\\pi x/L)$，其中 $E_0 = 10^3$，$B_y(x) = 0.0$。\n  2. 真空恒定场（导数为零的边界情况）：$N = 64$，$u = 0.0$，$\\sigma = 0.0$，$E_z(x) = E_0$，其中 $E_0 = 10^2$，$B_y(x) = B_0$，其中 $B_0 = 10^{-4}$。\n  3. 真空驻波（覆盖波的传播）：$N = 256$，$u = 0.0$，$\\sigma = 0.0$，$E_z(x) = E_0 \\sin(2\\pi x/L)$，其中 $E_0 = 10^3$，$B_y(x) = \\left(E_0/c\\right) \\sin(2\\pi x/L)$。\n\n对于每个用例，使用 $\\Delta t = \\mathrm{CFL}\\times \\Delta x / c$ 并通过索引环绕实现周期性边界。虽然定义了组合能量 $U = \\rho u^2/2 + p/(\\gamma-1) + B_y^2/(2\\mu_0) + \\epsilon_0 E_z^2/2$，但在此测试中，您只需要电磁部分。程序必须生成单行输出，其中包含三个测试用例的结果，格式为用方括号括起来的逗号分隔列表，例如 $\\left[\\mathrm{true},\\mathrm{false},\\mathrm{true}\\right]$。布尔值必须是小写的 Python 字面量，不带单位。",
            "solution": "该问题被验证为具有科学依据、问题适定且自洽。所提供的方程和离散化方法是计算物理学中的标准方法。该任务是一个定义明确的数值实验，旨在评估特定时域有限差分格式的局部能量守恒特性。\n\n### 第1部分：连续能量平衡推导\n\n问题要求推导组合能量平衡方程，并说明流体与电磁分量之间的耦合。总能量密度是流体能量密度（动能加内能）与电磁能量密度之和：\n$$\nU = \\underbrace{\\frac{1}{2}\\rho u^2 + \\frac{p}{\\gamma-1}}_{\\mathcal{E}_{\\mathrm{fluid}}} + \\underbrace{\\frac{1}{2}\\epsilon_0 E^2 + \\frac{1}{2\\mu_0} B^2}_{U_{\\mathrm{em}}}\n$$\n我们将分析每个分量的时间演化。\n\n电磁能量密度 $U_{\\mathrm{em}}$ 的演化由所给出的坡印亭定理决定：\n$$\n\\frac{\\partial U_{\\mathrm{em}}}{\\partial t} + \\nabla \\cdot \\mathbf{S} = -\\mathbf{J} \\cdot \\mathbf{E}\n$$\n这里，$\\mathbf{S} = (\\mathbf{E} \\times \\mathbf{B})/\\mu_0$ 是坡印亭矢量，表示电磁场的定向能量通量。右侧的项 $-\\mathbf{J} \\cdot \\mathbf{E}$ 表示电磁能量的耗散项。这部分能量从场传递给电荷载流子，在本模型中，载流子构成了流体。\n\n流体能量密度 $\\mathcal{E}_{\\mathrm{fluid}}$ 的演化由流体动力学的能量方程决定，该方程增加了一个源项，表示电磁场对流体所做的功。这个源项恰好是场损失的能量，因此流体能量平衡方程为：\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{fluid}}}{\\partial t} + \\nabla \\cdot \\mathbf{F}_{\\mathrm{fluid}} = \\mathbf{J} \\cdot \\mathbf{E}\n$$\n其中 $\\mathbf{F}_{\\mathrm{fluid}} = \\left(\\mathcal{E}_{\\mathrm{fluid}} + p\\right)\\mathbf{u}$ 是流体能量通量（焓通量加动能通量）。该方程表明，项 $\\mathbf{J} \\cdot \\mathbf{E}$ 作为流体的能量源。\n\n将这两个平衡方程相加，耦合项 $\\mathbf{J} \\cdot \\mathbf{E}$ 相互抵消：\n$$\n\\frac{\\partial (U_{\\mathrm{em}} + \\mathcal{E}_{\\mathrm{fluid}})}{\\partial t} + \\nabla \\cdot (\\mathbf{S} + \\mathbf{F}_{\\mathrm{fluid}}) = 0\n$$\n这就是总组合能量的守恒定律，其中总能量密度为 $U$，总能量通量是坡印亭矢量和流体能量通量之和。\n\n问题进一步要求阐述机械功如何与流体耦合。流体的能量源项 $\\mathbf{J} \\cdot \\mathbf{E}$ 可以被分解。洛伦兹力 $\\mathbf{f}_{\\mathrm{L}} = \\mathbf{J} \\times \\mathbf{B}$ 对流体所做的机械功的速率为 $\\mathbf{u} \\cdot (\\mathbf{J} \\times \\mathbf{B})$，它改变了流体的动能密度 $\\frac{1}{2}\\rho u^2$。能量输入的剩余部分进入流体的内能 $p/(\\gamma-1)$。内能的这种变化是由于焦耳热，其速率为 $Q_{\\mathrm{Joule}} = (\\mathbf{J} \\cdot \\mathbf{E}) - \\mathbf{u} \\cdot (\\mathbf{J} \\times \\mathbf{B})$。使用矢量恒等式和给定的欧姆定律 $\\mathbf{J} = \\sigma(\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B})$，这个加热项可简化为：\n$$\nQ_{\\mathrm{Joule}} = \\mathbf{J} \\cdot (\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B}) = \\frac{1}{\\sigma} |\\mathbf{J}|^2 \\geq 0\n$$\n因此，耦合项 $\\mathbf{J} \\cdot \\mathbf{E}$ 将能量从电磁场传递到流体，并通过机械功分配为动能，通过电阻加热分配为内能。\n\n### 第2部分：离散能量平衡与残差计算\n\n计算任务是评估一个特定的数值格式在多大程度上满足坡印亭定理的离散版本。一个完美的数值格式会精确地保持能量平衡，从而产生零残差。所选的格式采用了前向欧拉时间步进和二阶中心差分，它并非为精确能量守恒而设计，因此由于截断误差，预计会产生非零残差。目标是量化这个残差。\n\n对于每个测试用例，算法按以下步骤进行：\n1.  **设置**：将长度为 $L=1.0$ 的物理区域离散化为 $N$ 个宽度为 $\\Delta x = L/N$ 的单元格。定义常数 $c$、$\\mu_0$、$\\epsilon_0$ 和 Courant-Friedrichs-Lewy 数 $\\mathrm{CFL}=0.1$。时间步长计算为 $\\Delta t = \\mathrm{CFL} \\cdot \\Delta x / c$。\n2.  **初始化**：在时间 $t=0$（或离散层级 $n$），根据每个测试用例中指定的函数，在网格节点 $x_i = i \\Delta x$ 上初始化场 $E_z$ 和 $B_y$。\n3.  **计算层级 n 的各项**：使用场值 $E_i^n$ 和 $B_i^n$：\n    - 计算电流密度 $J_i^n = \\sigma (E_i^n + u B_i^n)$。\n    - 使用带有周期性边界条件的二阶中心差分计算空间导数 $(\\partial_x E)_i^n$ 和 $(\\partial_x B)_i^n$。\n    - 通过平均场值计算单元格界面处的坡印亭通量 $S_{x, i\\pm 1/2}^n$。\n    - 使用界面通量的中心差分计算坡印亭矢量的散度 $(\\nabla \\cdot \\mathbf{S})_i^n$。\n    - 计算初始电磁能量密度 $U_{\\mathrm{em},i}^n$。\n4.  **时间推进**：使用显式前向欧拉法将场推进一个步长至层级 $n+1$：\n    $$\n    E_i^{n+1} = E_i^n + \\Delta t \\left(c^2 (\\partial_x B)_i^n - J_i^n/\\epsilon_0\\right)\n    $$\n    $$\n    B_i^{n+1} = B_i^n + \\Delta t (\\partial_x E)_i^n\n    $$\n5.  **计算层级 n+1 的各项**：根据更新后的场 $E_i^{n+1}$ 和 $B_i^{n+1}$ 计算最终的电磁能量密度 $U_{\\mathrm{em},i}^{n+1}$。\n6.  **残差计算**：为每个单元格计算坡印亭定理的离散残差 $R_i$：\n    $$\n    R_i = \\frac{U_{\\mathrm{em},i}^{n+1} - U_{\\mathrm{em},i}^n}{\\Delta t} + (\\nabla \\cdot \\mathbf{S})_i^n + J_i^n E_i^n\n    $$\n    这个 $R_i$ 衡量了离散能量方程中的局部不平衡。\n7.  **归一化与评估**：计算残差数组 $R$ 的均方根（RMS）范数。通过平衡方程中各项的 RMS 范数之和对其进行归一化，以获得相对误差度量 $\\mathcal{R}$。\n    $$\n    \\mathcal{R} = \\frac{\\mathrm{rms}(R)}{\\mathrm{rms}\\left(\\frac{U_{\\mathrm{em}}^{n+1} - U_{\\mathrm{em}}^n}{\\Delta t}\\right) + \\mathrm{rms}\\left(\\nabla \\cdot \\mathbf{S}\\right) + \\mathrm{rms}\\left(J E\\right) + \\varepsilon}\n    $$\n    最后，将此归一化残差 $\\mathcal{R}$ 与容差 $\\tau=10^{-3}$ 进行比较。如果 $\\mathcal{R}  \\tau$ 则结果为 `true`，否则为 `false`。对所有三个测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the three specified test cases.\n    \"\"\"\n    \n    # Constants\n    L = 1.0\n    C_LIGHT = 299792458.0\n    MU_0 = 4.0 * np.pi * 1.0e-7\n    EPSILON_0 = 1.0 / (MU_0 * C_LIGHT**2)\n    TOLERANCE = 1.0e-3\n    CFL = 0.1\n    EPSILON_STAB = 1.0e-30\n\n    # Test suite cases\n    # (N, u, sigma, E0, B0_factor, wave_type)\n    # B0_factor is a multiplier for B_y initializer. If wave_type is 'const', B0 is absolute.\n    test_cases = [\n        # 1. Resistive relaxation\n        {'N': 256, 'u': 0.0, 'sigma': 1000.0, 'E0': 1000.0, 'B0': 0.0, 'wave_type': 'sin', 'B_is_absolute': True},\n        # 2. Vacuum constant fields\n        {'N': 64, 'u': 0.0, 'sigma': 0.0, 'E0': 100.0, 'B0': 1.0e-4, 'wave_type': 'const', 'B_is_absolute': True},\n        # 3. Vacuum standing wave\n        {'N': 256, 'u': 0.0, 'sigma': 0.0, 'E0': 1000.0, 'B0': 1.0 / C_LIGHT, 'wave_type': 'sin', 'B_is_absolute': False}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        u = case['u']\n        sigma = case['sigma']\n        E0 = case['E0']\n        B0 = case['B0']\n        wave_type = case['wave_type']\n        B_is_absolute = case['B_is_absolute']\n\n        # Discretization\n        dx = L / N\n        dt = CFL * dx / C_LIGHT\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # Initial conditions at time n\n        if wave_type == 'sin':\n            E_n = E0 * np.sin(2.0 * np.pi * x / L)\n            if B_is_absolute:\n                B_n = B0 * np.ones(N) # Case 1 has B0=0, so this works\n            else: # Case 3\n                B_n = E0 * B0 * np.sin(2.0 * np.pi * x / L) \n        elif wave_type == 'const': # Case 2\n            E_n = E0 * np.ones(N)\n            B_n = B0 * np.ones(N)\n\n        # --- Calculations at time n ---\n\n        # Current density J_z\n        J_n = sigma * (E_n + u * B_n)\n\n        # Spatial derivatives using 2nd-order central differences with periodic BCs\n        # np.roll(a, -1) is i+1, np.roll(a, 1) is i-1\n        dEdx_n = (np.roll(E_n, -1) - np.roll(E_n, 1)) / (2.0 * dx)\n        dBdx_n = (np.roll(B_n, -1) - np.roll(B_n, 1)) / (2.0 * dx)\n\n        # Poynting flux S_x = -E_z*B_y/mu_0\n        # Flux at cell interfaces i+1/2\n        E_plus_half = (E_n + np.roll(E_n, -1)) / 2.0\n        B_plus_half = (B_n + np.roll(B_n, -1)) / 2.0\n        S_plus_half = -(1.0 / MU_0) * E_plus_half * B_plus_half\n        \n        # Flux at cell interfaces i-1/2\n        S_minus_half = np.roll(S_plus_half, 1)\n\n        # Divergence of Poynting vector\n        divS_n = (S_plus_half - S_minus_half) / dx\n\n        # JE term\n        JE_n = J_n * E_n\n\n        # EM energy density at time n\n        U_em_n = 0.5 * EPSILON_0 * E_n**2 + 0.5 * (1.0 / MU_0) * B_n**2\n\n        # --- Time step to n+1 using Forward Euler ---\n        E_n1 = E_n + dt * (C_LIGHT**2 * dBdx_n - J_n / EPSILON_0)\n        B_n1 = B_n + dt * dEdx_n\n\n        # --- Calculations at time n+1 ---\n        # EM energy density at time n+1\n        U_em_n1 = 0.5 * EPSILON_0 * E_n1**2 + 0.5 * (1.0 / MU_0) * B_n1**2\n\n        # --- Residual Calculation ---\n        # Time derivative of energy\n        dUdt = (U_em_n1 - U_em_n) / dt\n\n        # Residual R_i\n        R = dUdt + divS_n + JE_n\n        \n        # RMS norm function\n        def rms(X):\n            return np.sqrt(np.mean(X**2))\n\n        # Calculate normalized residual R\n        rms_R = rms(R)\n        rms_dUdt = rms(dUdt)\n        rms_divS = rms(divS_n)\n        rms_JE = rms(JE_n)\n\n        denominator = rms_dUdt + rms_divS + rms_JE + EPSILON_STAB\n        \n        # Avoid division by zero if all terms are zero (e.g. Case 2)\n        if denominator == EPSILON_STAB:\n            # If numerator is also zero, residual is 0. Otherwise, it is large.\n            # In this problem setup, for Case 2, numerator is also 0.\n            R_norm = 0.0\n        else:\n            R_norm = rms_R / denominator\n        \n        results.append(R_norm  TOLERANCE)\n\n    # Format output as a list of lowercase boolean strings\n    result_str = ','.join(str(res).lower() for res in results)\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在上一个练习中，我们看到一个数值格式会引入能量误差。本练习中，我们将从“验证”转向“设计”，以解决另一个基本守恒律：电荷守恒。通过精心设计变量在空间和时间上的交错排布（即著名的Yee氏网格），我们可以构建一个数值格式，使其在机器精度内精确满足离散的电荷守恒方程。这个实践揭示了计算电磁学中的一个强大设计原则：如何将物理定律的几何结构直接嵌入到离散化方案中，从而获得数值上更鲁棒的结果。",
            "id": "3522863",
            "problem": "为耦合的等离子体-流体-电磁系统设计一个二维、周期性、均匀笛卡尔时域格式，该格式需保证离散电荷连续性在机器精度下精确满足。目标是确定未知量的交错空间布局和时间交错方式，以及一个更新序列，从而使离散连续性方程在舍入误差范围内得以满足。请使用以下基本出发点和假设。\n\n1. 基本原理：\n   - 真空中的麦克斯韦方程组，包含源电流密度：$\\nabla \\times \\mathbf{E}=-\\partial_t \\mathbf{B}$ 和 $\\nabla \\times \\mathbf{H}=\\partial_t \\mathbf{D}+\\mathbf{J}$，其中 $\\mathbf{D}=\\varepsilon_0 \\mathbf{E}$ 且 $\\mathbf{B}=\\mu_0 \\mathbf{H}$。电荷连续性方程为 $\\partial_t \\rho_e + \\nabla \\cdot \\mathbf{J}=0$，高斯定律为 $\\nabla \\cdot \\mathbf{D}=\\rho_e$。\n   - 传导电流密度的流体（Drude）模型：$\\partial_t \\mathbf{J} + \\nu \\mathbf{J} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}$，其中 $\\nu$ 是有效碰撞频率，$\\omega_p$ 是（可能与空间相关的）等离子体频率。\n   - 二维横磁（TM$_z$）极化，磁场为平面外分量：平面内电场 $\\mathbf{E}=(E_x,E_y,0)$，平面外磁场 $\\mathbf{H}=(0,0,H_z)$，以及平面内电流密度 $\\mathbf{J}=(J_x,J_y,0)$。\n\n2. 交错网格设计要求：\n   - 在矩形网格上采用Yee型交错空间布局，以确保离散旋度和散度算子满足守恒所需的恒等式。将$E_x$置于垂直面上，$E_y$置于水平面上，$H_z$置于单元中心，$J_x$与$E_x$共置，$J_y$与$E_y$共置，$\\rho_e$置于单元中心。选择一种时间交错方式，使得用于$\\mathbf{E}$的离散安培-麦克斯韦更新在空间和时间上都使用共置的$\\mathbf{J}$，并且得到的离散连续性方程$\\frac{\\rho_e^{n+1}-\\rho_e^n}{\\Delta t}+\\nabla_h\\cdot \\mathbf{J}^{n+1/2}=0$在机器精度下成立。此处$\\nabla_h \\cdot$表示面到中心的离散散度。\n\n3. 离散化约束：\n   - 使用一个具有$N_x \\times N_y$个单元的均匀网格，在两个方向上都采用周期性边界条件，单元尺寸为$\\Delta x=L_x/N_x$和$\\Delta y=L_y/N_y$，时间步长为$\\Delta t$。使用与交错布局一致的离散算子构建一个格式，使得在周期性条件下离散恒等式$\\nabla_h \\cdot (\\nabla_h \\times \\cdot)=0$精确成立。\n   - 对电磁场采用与时域有限差分（FDTD）方法一致的蛙跳式时间交错，并对Drude模型采用时间中心离散，该离散方式从$\\mathbf{J}^{n-1/2}$和$\\mathbf{E}^n$得到$\\mathbf{J}^{n+1/2}$，且不违反连续性恒等式。初始条件必须满足离散高斯定律$\\rho_e^0=\\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^0$。\n\n4. 预设初始条件和参数：\n   - 物理常数：$\\varepsilon_0=8.8541878128\\times 10^{-12}$ 法拉/米，$\\mu_0=4\\pi\\times 10^{-7}$ 亨利/米，以及 $c=1/\\sqrt{\\varepsilon_0 \\mu_0}$ 米/秒。\n   - 计算域：$L_x=0.1$ 米， $L_y=0.1$ 米。在两个方向上均使用周期性边界条件。\n   - 初始场由在相应交错位置上求值的解析函数给出，\n     $$\n     E_x(x,y)=\\cos\\left(\\frac{2\\pi x}{L_x}\\right)+\\frac{1}{2}\\sin\\left(\\frac{4\\pi y}{L_y}\\right),\\quad\n     E_y(x,y)=0.7\\cos\\left(\\frac{2\\pi y}{L_y}\\right)-0.3\\sin\\left(\\frac{2\\pi x}{L_x}\\right),\\quad\n     H_z(x,y)=\\sin\\left(\\frac{2\\pi x}{L_x}\\right)\\sin\\left(\\frac{2\\pi y}{L_y}\\right).\n     $$\n   - 传导电流由Drude模型控制。对于空间变化的等离子体频率，使用\n     $$\n     \\omega_p(x,y)=\\omega_0\\left[1+0.5\\sin\\left(\\frac{2\\pi x}{L_x}\\right)\\cos\\left(\\frac{2\\pi y}{L_y}\\right)\\right].\n     $$\n     在每个测试案例中，碰撞频率$\\nu$在空间上是均匀的。\n\n5. 时间步长：\n   - 设$\\Delta t=\\theta \\,\\Delta t_{\\mathrm{CFL}}$，其中$\\Delta t_{\\mathrm{CFL}}=\\left(c\\sqrt{(\\Delta x)^{-2}+(\\Delta y)^{-2}}\\right)^{-1}$，$\\theta\\in(0,1]$是为每个测试案例给定的因子。三角函数内的角度以弧度为单位。\n\n6. 计算内容与结果报告方式：\n   - 在每个时间步 $n\\to n+1$，使用与空间交错一致的面到中心散度定义离散电荷密度 $\\rho_e^n=\\varepsilon_0 \\,\\nabla_h\\cdot \\mathbf{E}^n$。令$\\mathbf{J}^{n+1/2}$为半时间步上与$\\mathbf{E}$在空间中共置的电流。定义离散连续性残差场\n     $$\n     \\mathcal{R}^{n+1/2}=\\frac{\\rho_e^{n+1}-\\rho_e^n}{\\Delta t}+\\nabla_h\\cdot \\mathbf{J}^{n+1/2}.\n     $$\n     对于每个测试案例，运行指定时间步数的格式，并报告在所有网格单元和所有时间步上$\\mathcal{R}^{n+1/2}$的最大绝对值。将此最大值表示为单位为库仑/立方米/秒（$\\mathrm{C}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$）的浮点数。\n\n7. 测试套件：\n   对于所有案例，使用上述相同的计算域和初始条件。每个测试案例由元组$(N_x,N_y,\\theta,\\text{steps},\\omega_0,\\nu,\\text{profile})$指定，其中profile是“vacuum”、“uniform”或“varying”之一，并按如下方式确定$\\omega_p(x,y)$：\n   - “vacuum”：$\\omega_p(x,y)\\equiv 0$。\n   - “uniform”：$\\omega_p(x,y)\\equiv \\omega_0$。\n   - “varying”：$\\omega_p(x,y)$由上述公式和指定的$\\omega_0$给出。\n\n   使用以下四个案例：\n   - 案例1（理想路径，真空）：$(16,16,0.9,10,0.0,0.0,\\text{vacuum})$。\n   - 案例2（均匀等离子体，中等碰撞）：$(8,8,0.95,20,2.0\\times 10^{11},1.0\\times 10^{10},\\text{uniform})$。\n   - 案例3（空间变化等离子体，低碰撞）：$(10,6,0.8,15,1.5\\times 10^{11},5.0\\times 10^{9},\\text{varying})$。\n   - 案例4（边缘情况，小网格，无碰撞）：$(2,2,0.5,5,1.0\\times 10^{11},0.0,\\text{uniform})$。\n\n8. 要求的最终输出格式：\n   - 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述案例的顺序排列结果，例如：“[r1,r2,r3,r4]”，其中每个$r_k$是案例$k$的最大绝对残差，单位为$\\mathrm{C}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$。\n\n您的任务是：\n- 确定一个与上述要求一致的具体的$E_x$、$E_y$、$H_z$、$J_x$、$J_y$和$\\rho_e$的交错空间布局和时间交错方案，推导一个强制执行离散连续性恒等式的二阶精确更新方案，并予以实现。\n- 必须选择离散算子，使得进入安培定律的旋度项的散度在周期性边界条件下恒等于零，从而只要$\\rho_e^0=\\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^0$成立，离散连续性方程就能在机器精度下保持。\n- 为该测试套件实现该格式，并以确切的输出格式报告所要求的结果。所有矢量微积分和代数必须在离散化的框架内表达和论证；除非能从您的离散算子中证明，否则不要假定任何连续恒等式在离散情况下成立。",
            "solution": "用户提供了一个有效的、适定的计算等离子体物理问题。任务是设计并实现一个耦合等离子体-流体-电磁系统的数值格式，该格式能够以机器精度离散地保持电荷连续性。\n\n### 1. 问题陈述的验证\n该问题具有科学依据，基于麦克斯韦方程组和等离子体电导率的Drude模型。对数值格式的约束（交错网格、蛙跳时间步进、离散连续性方程的特定形式）是时域有限差分（FDTD）方法领域的标准做法。所有必需的参数、初始条件和测试案例均已提供，使得问题自成体系且客观。设计一个满足离散守恒律的格式的目标是计算物理学中一个非平凡但已被深入理解的任务，这证实了问题的有效性。\n\n### 2. 电荷守恒格式的设计\n\n#### 2.1. 空间与时间交错\n为了满足问题的约束，包括离散矢量恒等式$\\nabla_h \\cdot (\\nabla_h \\times \\cdot) = 0$，我们采用二维TM$_z$问题的标准Yee交错网格，并使电荷密度位于节点中心。设网格索引为$(i,j)$。\n- 电场分量$E_x$和共置的电流密度$J_x$位于$x=(i+1/2)\\Delta x, y=j\\Delta y$。\n- 电场分量$E_y$和共置的电流密度$J_y$位于$x=i\\Delta x, y=(j+1/2)\\Delta y$。\n- 磁场分量$H_z$位于单元中心，$x=(i+1/2)\\Delta x, y=(j+1/2)\\Delta y$。\n- 电荷密度$\\rho_e$位于网格节点，$x=i\\Delta x, y=j\\Delta y$。\n\n对于时间交错，我们使用蛙跳格式：\n- 电场$\\mathbf{E}$在整数时间步计算：$t=n\\Delta t$。\n- 磁场$\\mathbf{H}$和电流密度$\\mathbf{J}$在半整数时间步计算：$t=(n+1/2)\\Delta t$。\n\n#### 2.2. 离散方程的推导\n控制方程按以下方式离散化，以确保空间和时间上的二阶精度。\n\n**法拉第定律：** $\\mu_0 \\partial_t \\mathbf{H} = -\\nabla \\times \\mathbf{E}$。\n此式用于将$H_z$从时间步$n-1/2$更新到$n+1/2$，中心在时间$n$：\n$$\n\\mu_0 \\frac{H_z^{n+1/2} - H_z^{n-1/2}}{\\Delta t} = -(\\nabla_h \\times \\mathbf{E}^n)_z\n$$\n在$H_z$位置$(i+1/2, j+1/2)$计算的离散旋度算子为：\n$$\n(\\nabla_h \\times \\mathbf{E}^n)_{i+1/2, j+1/2} = \\frac{E_{y, i+1, j+1/2}^n - E_{y, i, j+1/2}^n}{\\Delta x} - \\frac{E_{x, i+1/2, j+1}^n - E_{x, i+1/2, j}^n}{\\Delta y}\n$$\n\n**安培-麦克斯韦定律：** $\\varepsilon_0 \\partial_t \\mathbf{E} + \\mathbf{J} = \\nabla \\times \\mathbf{H}$。\n此式用于将$\\mathbf{E}$从时间步$n$更新到$n+1$，中心在时间$n+1/2$：\n$$\n\\varepsilon_0 \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t} + \\mathbf{J}^{n+1/2} = (\\nabla_h \\times \\mathbf{H})^{n+1/2}\n$$\n在$\\mathbf{E}$分量位置计算的离散旋度算子为：\n$$\n(\\nabla_h \\times \\mathbf{H})_{x, i+1/2, j} = \\frac{H_{z, i+1/2, j+1/2} - H_{z, i+1/2, j-1/2}}{\\Delta y}\n$$\n$$\n(\\nabla_h \\times \\mathbf{H})_{y, i, j+1/2} = -\\frac{H_{z, i+1/2, j+1/2} - H_{z, i-1/2, j+1/2}}{\\Delta x}\n$$\n\n**Drude模型：** $\\partial_t \\mathbf{J} + \\nu \\mathbf{J} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}$。\n此式用于将$\\mathbf{J}$从时间步$n-1/2$更新到$n+1/2$，中心在时间$n$：\n$$\n\\frac{\\mathbf{J}^{n+1/2} - \\mathbf{J}^{n-1/2}}{\\Delta t} + \\nu \\frac{\\mathbf{J}^{n+1/2} + \\mathbf{J}^{n-1/2}}{2} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}^n\n$$\n解出$\\mathbf{J}^{n+1/2}$得到一个显式更新式：\n$$\n\\mathbf{J}^{n+1/2} = \\left(\\frac{1/\\Delta t - \\nu/2}{1/\\Delta t + \\nu/2}\\right) \\mathbf{J}^{n-1/2} + \\left(\\frac{\\varepsilon_0 \\omega_p^2}{1/\\Delta t + \\nu/2}\\right) \\mathbf{E}^n\n$$\n\n#### 2.3. 离散电荷守恒的证明\n问题要求检查离散连续性方程的残差$\\mathcal{R}^{n+1/2} = \\frac{\\rho_e^{n+1} - \\rho_e^n}{\\Delta t} + \\nabla_h \\cdot \\mathbf{J}^{n+1/2}$。电荷密度由高斯定律定义：$\\rho_e^n = \\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^n$。将此代入残差表达式：\n$$\n\\mathcal{R}^{n+1/2} = \\frac{\\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^{n+1} - \\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^n}{\\Delta t} + \\nabla_h \\cdot \\mathbf{J}^{n+1/2}\n$$\n利用离散散度算子$\\nabla_h \\cdot$的线性性：\n$$\n\\mathcal{R}^{n+1/2} = \\nabla_h \\cdot \\left( \\varepsilon_0 \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t} + \\mathbf{J}^{n+1/2} \\right)\n$$\n根据我们的离散安培-麦克斯韦定律，括号中的项等于$(\\nabla_h \\times \\mathbf{H})^{n+1/2}$。因此，\n$$\n\\mathcal{R}^{n+1/2} = \\nabla_h \\cdot ((\\nabla_h \\times \\mathbf{H})^{n+1/2})\n$$\n所选的交错网格和中心差分算子确保了对于在具有周期性边界条件的网格上定义的任何场，离散旋度的离散散度恒为零（$\\nabla_h \\cdot (\\nabla_h \\times \\cdot) \\equiv 0$）。因此，残差$\\mathcal{R}^{n+1/2}$在每个时间步都数学上为零。实现将产生一个与机器浮点精度相当的值。\n\n### 3. 实现算法\n模拟过程如下：\n\n1.  **初始化：**\n    - 定义网格参数$(\\Delta x, \\Delta y, \\Delta t)$。\n    - 为所有交错场分量设置坐标数组。\n    - 使用给定的解析函数在$t=0$时初始化电场$\\mathbf{E}^0 = (E_x^0, E_y^0)$。\n    - 在$t=-\\Delta t/2$时初始化磁场$H_z^{-1/2}$。我们假设为$H_z$提供的函数是在此时间步求值，这是当为所有场指定$t=0$初始条件时FDTD为了方便而采用的标准约定。\n    - 假设系统在$t0$时是静止的，将电流密度$\\mathbf{J}^{-1/2} = (J_x^{-1/2}, J_y^{-1/2})$初始化为零。\n    - 预计算Drude模型更新的系数，这些系数取决于等离子体剖面（$\\omega_p$）和碰撞频率（$\\nu$）。\n\n2.  **时间步进循环：** 对于从$0$到`steps-1`的每个时间步$n$：\n    a. 使用$\\mathbf{E}^n$将磁场从$H_z^{n-1/2}$更新到$H_z^{n+1/2}$。\n    b. 使用$\\mathbf{E}^n$将电流密度从$\\mathbf{J}^{n-1/2}$更新到$\\mathbf{J}^{n+1/2}$。\n    c. 使用$H_z^{n+1/2}$和$\\mathbf{J}^{n+1/2}$将电场从$\\mathbf{E}^n$更新到$\\mathbf{E}^{n+1}$。\n    d. 使用$\\mathbf{E}^{n+1}$、$\\mathbf{E}^n$和$\\mathbf{J}^{n+1/2}$在网格节点处计算残差场$\\mathcal{R}^{n+1/2}$。其离散散度算子为$(\\nabla_h \\cdot \\mathbf{F})_{i,j} = \\frac{F_{x,i+1/2,j} - F_{x,i-1/2,j}}{\\Delta x} + \\frac{F_{y,i,j+1/2} - F_{y,i,j-1/2}}{\\Delta y}$。\n    e. 记录残差场在网格上的最大绝对值，并更新迄今为止找到的全局最大值。\n    f. 为下一次迭代推进场。\n\n3.  **结果：** 循环结束后，报告在所有时间步和所有网格点上找到的最大绝对残差，作为该测试案例的结果。周期性边界条件通过`numpy.roll`处理，以高效正确地实现有限差分算子。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Physical constants in SI units\n    EPS0 = 8.8541878128e-12  # F/m\n    MU0 = 4 * np.pi * 1e-7   # H/m\n    C0 = 1 / np.sqrt(EPS0 * MU0) # m/s\n\n    def _solve_case(Nx, Ny, theta, steps, omega0, nu, profile):\n        \"\"\"\n        Solves one case of the coupled plasma-fluid-electromagnetic system.\n        The numerical scheme is designed to guarantee exact discrete charge continuity.\n        \"\"\"\n        # --- 1. Setup Grid, Time Step, and Domain ---\n        Lx = 0.1  # m\n        Ly = 0.1  # m\n        dx = Lx / Nx\n        dy = Ly / Ny\n        dt_cfl = 1 / (C0 * np.sqrt(1/dx**2 + 1/dy**2))\n        dt = theta * dt_cfl\n\n        # --- 2. Staggered Grid Coordinates ---\n        # Ex/Jx components are at face centers (i+1/2, j)\n        x_Ex = (np.arange(Nx) + 0.5) * dx\n        y_Ex = np.arange(Ny) * dy\n        X_Ex, Y_Ex = np.meshgrid(x_Ex, y_Ex, indexing='ij')\n        \n        # Ey/Jy components are at face centers (i, j+1/2)\n        x_Ey = np.arange(Nx) * dx\n        y_Ey = (np.arange(Ny) + 0.5) * dy\n        X_Ey, Y_Ey = np.meshgrid(x_Ey, y_Ey, indexing='ij')\n\n        # Hz components are at cell centers (i+1/2, j+1/2)\n        x_Hz = (np.arange(Nx) + 0.5) * dx\n        y_Hz = (np.arange(Ny) + 0.5) * dy\n        X_Hz, Y_Hz = np.meshgrid(x_Hz, y_Hz, indexing='ij')\n        \n        # --- 3. Initial Field Conditions ---\n        # E-field components are at t=0\n        Ex = np.cos(2 * np.pi * X_Ex / Lx) + 0.5 * np.sin(4 * np.pi * Y_Ex / Ly)\n        Ey = 0.7 * np.cos(2 * np.pi * Y_Ey / Ly) - 0.3 * np.sin(2 * np.pi * X_Ey / Lx)\n        \n        # H and J fields are staggered in time (leapfrog), initialized at t=-dt/2\n        # As is conventional, we use the t=0 analytic function for H at t=-dt/2\n        Hz_prev = np.sin(2 * np.pi * X_Hz / Lx) * np.sin(2 * np.pi * Y_Hz / Ly)\n        \n        # Current is assumed to be zero for t0\n        Jx_prev = np.zeros((Nx, Ny), dtype=float)\n        Jy_prev = np.zeros((Nx, Ny), dtype=float)\n        \n        # --- 4. Plasma Parameters and Update Coefficients ---\n        if profile == \"vacuum\":\n            omega_p_sq_x = np.zeros((Nx, Ny), dtype=float)\n            omega_p_sq_y = np.zeros((Nx, Ny), dtype=float)\n        elif profile == \"uniform\":\n            omega_p_sq_x = np.full((Nx, Ny), omega0**2, dtype=float)\n            omega_p_sq_y = np.full((Nx, Ny), omega0**2, dtype=float)\n        elif profile == \"varying\":\n            omega_p_x = omega0 * (1 + 0.5 * np.sin(2*np.pi*X_Ex/Lx) * np.cos(2*np.pi*Y_Ex/Ly))\n            omega_p_sq_x = omega_p_x**2\n            omega_p_y = omega0 * (1 + 0.5 * np.sin(2*np.pi*X_Ey/Lx) * np.cos(2*np.pi*Y_Ey/Ly))\n            omega_p_sq_y = omega_p_y**2\n        \n        # Drude model update coefficients for J^{n+1/2} = C1*J^{n-1/2} + C2*E^n\n        if nu == 0.0:\n            C1 = 1.0\n            C2_x = EPS0 * omega_p_sq_x * dt\n            C2_y = EPS0 * omega_p_sq_y * dt\n        else:\n            den = 1.0 / dt + nu / 2.0\n            C1 = (1.0 / dt - nu / 2.0) / den\n            C2x_num = EPS0 * omega_p_sq_x\n            C2_x = C2x_num / den\n            C2y_num = EPS0 * omega_p_sq_y\n            C2_y = C2y_num / den\n\n        max_abs_residual = 0.0\n\n        # --- 5. FDTD Time-stepping Loop ---\n        for _ in range(steps):\n            # Current state: Ex, Ey at time n; Hz_prev, Jx_prev, Jy_prev at n-1/2\n            \n            # --- Update H-field from n-1/2 to n+1/2 ---\n            curl_E_z = (np.roll(Ey, -1, axis=0) - Ey) / dx - \\\n                       (np.roll(Ex, -1, axis=1) - Ex) / dy\n            Hz = Hz_prev - (dt / MU0) * curl_E_z\n            \n            # --- Update J-field from n-1/2 to n+1/2 ---\n            Jx = C1 * Jx_prev + C2_x * Ex\n            Jy = C1 * Jy_prev + C2_y * Ey\n            \n            # --- Update E-field from n to n+1 ---\n            curl_H_x = (Hz - np.roll(Hz, 1, axis=1)) / dy\n            curl_H_y = -(Hz - np.roll(Hz, 1, axis=0)) / dx\n            Ex_next = Ex + (dt / EPS0) * (curl_H_x - Jx)\n            Ey_next = Ey + (dt / EPS0) * (curl_H_y - Jy)\n            \n            # --- Calculate Charge Continuity Residual at t=n+1/2 ---\n            # rho^n = eps0 * div(E^n) at nodes (i, j)\n            div_E_n = (Ex - np.roll(Ex, 1, axis=0)) / dx + \\\n                      (Ey - np.roll(Ey, 1, axis=1)) / dy\n            rho_n = EPS0 * div_E_n\n            \n            # rho^{n+1} = eps0 * div(E^{n+1}) at nodes (i, j)\n            div_E_n_plus_1 = (Ex_next - np.roll(Ex_next, 1, axis=0)) / dx + \\\n                             (Ey_next - np.roll(Ey_next, 1, axis=1)) / dy\n            rho_n_plus_1 = EPS0 * div_E_n_plus_1\n            \n            # div(J^{n+1/2}) at nodes (i, j)\n            div_J_n_half = (Jx - np.roll(Jx, 1, axis=0)) / dx + \\\n                           (Jy - np.roll(Jy, 1, axis=1)) / dy\n            \n            # Residual R^{n+1/2} = (rho^{n+1} - rho^n)/dt + div(J^{n+1/2})\n            residual = (rho_n_plus_1 - rho_n) / dt + div_J_n_half\n            \n            # Update the maximum absolute residual found so far\n            current_max_abs_res = np.max(np.abs(residual))\n            if current_max_abs_res > max_abs_residual:\n                max_abs_residual = current_max_abs_res\n\n            # --- Advance fields for the next iteration ---\n            Ex, Ey = Ex_next, Ey_next\n            Hz_prev = Hz\n            Jx_prev, Jy_prev = Jx, Jy\n            \n        return max_abs_residual\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, theta, steps, omega0, nu, profile)\n        (16, 16, 0.9, 10, 0.0, 0.0, \"vacuum\"),\n        (8, 8, 0.95, 20, 2.0e11, 1.0e10, \"uniform\"),\n        (10, 6, 0.8, 15, 1.5e11, 5.0e9, \"varying\"),\n        (2, 2, 0.5, 5, 1.0e11, 0.0, \"uniform\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.18e}' for r in results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "精心设计的守恒格式是必要的，但并非万能，因为物理过程本身就能引入严峻的数值挑战。本练习将深入探讨由霍尔效应引起的“刚性”（stiffness）问题，这在等离子体模拟中极为常见。我们将推导哨声波（whistler wave）的色散关系，并揭示其独特的 $\\omega \\propto k^2$ 形式如何对显式时间积分方法施加一个严苛的时间步长限制，即 $\\Delta t \\propto \\Delta x^2$ 。通过量化这一限制并与常规的CFL条件对比，您将深刻理解为何在模拟多尺度物理现象时，隐式-显式（IMEX）等高级算法是不可或缺的。",
            "id": "3522825",
            "problem": "考虑包含广义欧姆定律中霍尔效应的单流体磁流体动力学系统。研究对象为非相对论性、准中性、磁化的等离子体，其离子数密度 $n$ 和离子质量 $m_i$ 均为常数。令 $\\mathbf{B}$ 表示磁场，$\\mathbf{u}$ 表示整体离子速度，$\\mathbf{J}$ 表示电流密度，$\\mu_0$ 表示真空磁导率， $e$ 表示元电荷。其控制关系为以下基本定律和标准本构关系：法拉第定律 $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$，无位移电流的安培定律 $\\mathbf{J} = \\nabla \\times \\mathbf{B}/\\mu_0$，以及广义欧姆定律（忽略电子压力和电阻率）$\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} = -\\left(\\mathbf{J} \\times \\mathbf{B}\\right)/(n e)$。结合这些方程可得到感应方程\n$$\n\\partial_t \\mathbf{B} = \\nabla \\times \\left( \\mathbf{u} \\times \\mathbf{B} \\right) - \\nabla \\times \\left( \\frac{\\mathbf{J} \\times \\mathbf{B}}{n e} \\right),\n$$\n其中 $\\mathbf{J} = \\nabla \\times \\mathbf{B}/\\mu_0$。对于大小为 $B_0 = \\|\\mathbf{B}_0\\|$ 的均匀背景磁场，定义阿尔芬速度 $v_A = B_0/\\sqrt{\\mu_0 n m_i}$ 和离子趋肤深度 $d_i = \\sqrt{m_i/(\\mu_0 n e^2)}$。考虑波矢平行于均匀背景场的小振幅一维扰动，并研究由感应方程中的霍尔项控制的线性哨声波模式。仅使用上述基本定律和定义，并做出线性平面波的拟设，您必须：\n1) 在上述霍尔磁流体动力学极限下，推导物理（国际单位制）单位下的哨声波模式色散关系，其形式为 $\\omega = C \\, k^2$，其中 $C$ 必须用 $B_0$、$n$、$e$ 和 $\\mu_0$ 表示（并证明其也等于 $v_A d_i$）。\n2) 考虑使用经典的四阶显式 Runge–Kutta 方法对线性振荡模式 $\\partial_t q = i \\omega q$ 进行时间推进。推导标量放大因子，并根据无量纲参数 $z = i \\omega \\Delta t$，确定最大正值 $\\alpha_\\star$，使得对于纯虚数 $z = i \\alpha$（$0 \\le \\alpha \\le \\alpha_\\star$），该格式是能量有界的。您的推导必须从 Runge–Kutta 更新的初始原理出发。然后，写出在间距为 $\\Delta x$ 的均匀网格上，由给定最大可分辨波数 $k_{\\max}$ 处的哨声波色散所施加的时间步长 $\\Delta t_{\\mathrm{exp}}$ 的显式稳定性约束。\n3) 针对感应方程提出一种隐式-显式（IMEX）时间离散化方案，其中霍尔项 $\\nabla \\times \\left((\\mathbf{J} \\times \\mathbf{B})/(n e)\\right)$ 进行隐式处理，而平流项 $\\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$ 进行显式处理。您的 IMEX 格式对于霍尔项必须是时间二阶精确的，对于显式平流项必须是一阶精确的。在假设 $\\mathbf{u}$ 是给定的、不随时间变化的场的情况下，给出从 $\\mathbf{B}^n$ 到 $\\mathbf{B}^{n+1}$ 的离散更新。在线性、常系数极限下，围绕 $\\mathbf{B}_0$ 分析隐式霍尔子步骤的无条件能量稳定性，并说明哪个剩余约束限制了 IMEX 时间步长。\n4) 在一个由 $N$ 个均匀间隔单元解析的长度为 $L$ 的周期性一维域上，使用 $k_{\\max} = \\pi/\\Delta x$（其中 $\\Delta x = L/N$）作为最大可分辨波数。对于第 2 项中的显式格式，最严格的哨声波时间步长是由最高波数设定的 $\\Delta t_{\\mathrm{exp}}$。对于第 3 项中的 IMEX 格式，假设霍尔贡献由 Crank–Nicolson 隐式步长处理且能量稳定，因此剩余的时间步长约束来自显式平流项，其 Courant–Friedrichs–Lewy (CFL) 数为 $\\mathrm{CFL}_{\\mathrm{adv}}$，即\n$$\n\\Delta t_{\\mathrm{IMEX}} = \\mathrm{CFL}_{\\mathrm{adv}} \\frac{\\Delta x}{U},\n$$\n其中 $U = \\|\\mathbf{u}\\|$ 是给定的恒定平流速度。所有时间步长均以秒为单位表示，并由您的程序四舍五入为浮点数。\n您的程序必须使用您提供的推导，为每个测试用例计算出数组 $[\\Delta t_{\\mathrm{exp}}, \\Delta t_{\\mathrm{IMEX}}]$，所有量均采用国际单位制。在程序内部使用以下国际单位制物理常数：$\\mu_0 = 4 \\pi \\times 10^{-7}$，$e = 1.602176634 \\times 10^{-19}$。需要时，使用质子质量 $m_p = 1.67262192369 \\times 10^{-27}$ 作为参考。\n\n测试套件（每个用例为 $(L, N, B_0, n, m_i, U, \\mathrm{CFL}_{\\mathrm{adv}})$）：\n- 用例 A（一般情况）：$L = 1.0$, $N = 256$, $B_0 = 0.1$, $n = 10^{19}$, $m_i = m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$。\n- 用例 B（网格细化）：$L = 1.0$, $N = 4096$, $B_0 = 0.1$, $n = 10^{19}$, $m_i = m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$。\n- 用例 C（离子质量变化）：$L = 1.0$, $N = 256$, $B_0 = 0.1$, $n = 10^{19}$, $m_i = 4 m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$。\n- 用例 D（低密度边缘）：$L = 1.0$, $N = 256$, $B_0 = 0.1$, $n = 10^{17}$, $m_i = m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$。\n\n所需最终输出格式：您的程序应生成单行输出，其中包含结果，形式为列表的列表，每个数字使用科学记数法表示并保留十二位有效数字，格式完全如下\n$[[\\Delta t_{\\mathrm{exp}}^{(A)},\\Delta t_{\\mathrm{IMEX}}^{(A)}],[\\Delta t_{\\mathrm{exp}}^{(B)},\\Delta t_{\\mathrm{IMEX}}^{(B)}],[\\Delta t_{\\mathrm{exp}}^{(C)},\\Delta t_{\\mathrm{IMEX}}^{(C)}],[\\Delta t_{\\mathrm{exp}}^{(D)},\\Delta t_{\\mathrm{IMEX}}^{(D)}]]$,\n无空格。所有时间步长必须以秒为单位。",
            "solution": "该问题经验证在科学上是合理的、适定的和客观的。所有必要信息均已提供，任务逻辑结构清晰、具有挑战性，并且直接关系到计算等离子体物理学。我们开始进行解答。\n\n### 第 1 部分：哨声波模式色散关系\n\n问题要求推导哨声波模式的色散关系，该模式源于感应方程中的霍尔项。在研究这类电子磁流体动力学波时，按照标准做法忽略流体平流项 $(\\mathbf{u} \\times \\mathbf{B})$，其控制方程为：\n$$\n\\partial_t \\mathbf{B} = - \\nabla \\times \\left( \\frac{\\mathbf{J} \\times \\mathbf{B}}{n e} \\right)\n$$\n我们将安培定律 $\\mathbf{J} = (\\nabla \\times \\mathbf{B}) / \\mu_0$ 代入此方程：\n$$\n\\partial_t \\mathbf{B} = - \\frac{1}{n e \\mu_0} \\nabla \\times \\left( (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B} \\right)\n$$\n我们对该方程在均匀、静态的背景磁场 $\\mathbf{B}_0$ 周围进行线性化，考虑小振幅扰动 $\\delta\\mathbf{B}$。令 $\\mathbf{B} = \\mathbf{B}_0 + \\delta\\mathbf{B}$。由于 $\\mathbf{B}_0$ 是常数，因此 $\\nabla \\times \\mathbf{B}_0 = 0$。线性化后的方程为：\n$$\n\\partial_t \\delta\\mathbf{B} = - \\frac{1}{n e \\mu_0} \\nabla \\times \\left( (\\nabla \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0 \\right)\n$$\n我们对扰动采用平面波拟设 $\\delta\\mathbf{B} \\propto \\exp(i(\\mathbf{k} \\cdot \\mathbf{r} - \\omega t))$。在此形式下，算子 $\\partial_t$ 和 $\\nabla$ 变换为代数乘子：$\\partial_t \\rightarrow -i\\omega$ 和 $\\nabla \\rightarrow i\\mathbf{k}$。线性化方程变为：\n$$\n-i\\omega \\delta\\mathbf{B} = - \\frac{1}{n e \\mu_0} (i\\mathbf{k}) \\times \\left( (i\\mathbf{k} \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0 \\right)\n$$\n问题指明波矢 $\\mathbf{k}$ 平行于背景场 $\\mathbf{B}_0$。我们调整坐标系，使得 $\\mathbf{B}_0 = B_0 \\hat{z}$ 和 $\\mathbf{k} = k \\hat{z}$。方程简化为：\n$$\n-i\\omega \\delta\\mathbf{B} = - \\frac{i k}{n e \\mu_0} \\hat{z} \\times \\left( (i k \\hat{z} \\times \\delta\\mathbf{B}) \\times (B_0 \\hat{z}) \\right)\n$$\n使用矢量三重积恒等式 $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$，我们展开括号中的项：\n$$\n(i k \\hat{z} \\times \\delta\\mathbf{B}) \\times (B_0 \\hat{z}) = (i k \\hat{z}) \\left( (\\hat{z} \\times \\delta\\mathbf{B}) \\cdot (B_0 \\hat{z}) \\right) - (B_0 \\hat{z}) \\left( (\\hat{z} \\times \\delta\\mathbf{B}) \\cdot (i k \\hat{z}) \\right)\n$$\n第二项为零，因为 $(\\hat{z} \\times \\delta\\mathbf{B})$ 垂直于 $\\hat{z}$。因此，该表达式为零。这表明展开中存在错误。让我们重新组合这些项：\n$$\n\\omega \\delta\\mathbf{B} = - \\frac{k}{n e \\mu_0} \\hat{z} \\times \\left( (i k \\hat{z} \\times \\delta\\mathbf{B}) \\times B_0 \\hat{z} \\right) = - \\frac{i k^2 B_0}{n e \\mu_0} \\hat{z} \\times \\left( (\\hat{z} \\times \\delta\\mathbf{B}) \\times \\hat{z} \\right)\n$$\n再次对 $(\\hat{z} \\times \\delta\\mathbf{B}) \\times \\hat{z}$ 使用该恒等式：\n$$\n(\\hat{z} \\times \\delta\\mathbf{B}) \\times \\hat{z} = \\delta\\mathbf{B}(\\hat{z} \\cdot \\hat{z}) - \\hat{z}(\\hat{z} \\cdot \\delta\\mathbf{B}) = \\delta\\mathbf{B} - \\hat{z}(\\hat{z} \\cdot \\delta\\mathbf{B})\n$$\n项 $\\delta\\mathbf{B}_\\perp = \\delta\\mathbf{B} - \\hat{z}(\\hat{z} \\cdot \\delta\\mathbf{B})$ 是 $\\delta\\mathbf{B}$ 垂直于 $\\hat{z}$ 的分量。无散条件 $\\nabla \\cdot \\delta\\mathbf{B} = 0$ 意味着 $i \\mathbf{k} \\cdot \\delta\\mathbf{B} = ik \\delta B_z = 0$，因此 $\\delta B_z = 0$。所以，$\\delta\\mathbf{B}$ 是纯横向的，$\\delta\\mathbf{B} = \\delta\\mathbf{B}_\\perp$。\n方程变为：\n$$\n\\omega \\delta\\mathbf{B} = - \\frac{i k^2 B_0}{n e \\mu_0} \\hat{z} \\times \\delta\\mathbf{B}\n$$\n让我们用分量表示。设 $\\delta\\mathbf{B} = \\delta B_x \\hat{x} + \\delta B_y \\hat{y}$。则 $\\hat{z} \\times \\delta\\mathbf{B} = \\delta B_x \\hat{y} - \\delta B_y \\hat{x}$。\n$$\n\\omega (\\delta B_x \\hat{x} + \\delta B_y \\hat{y}) = - \\frac{i k^2 B_0}{n e \\mu_0} (\\delta B_y \\hat{x} - \\delta B_x \\hat{y})\n$$\n这个矢量方程产生了一个由两个线性方程组成的系统：\n$$\n\\omega \\delta B_x = -i \\frac{k^2 B_0}{n e \\mu_0} \\delta B_y\n$$\n$$\n\\omega \\delta B_y = i \\frac{k^2 B_0}{n e \\mu_0} \\delta B_x\n$$\n该系统对于 $(\\delta B_x, \\delta B_y)$ 有非平凡解的条件是其系数矩阵的行列式为零：\n$$\n\\det \\begin{pmatrix} \\omega  i \\frac{k^2 B_0}{n e \\mu_0} \\\\ -i \\frac{k^2 B_0}{n e \\mu_0}  \\omega \\end{pmatrix} = \\omega^2 - \\left( \\frac{k^2 B_0}{n e \\mu_0} \\right)^2 = 0\n$$\n这给出了色散关系 $\\omega = \\pm \\frac{B_0}{n e \\mu_0} k^2$。两个符号分别对应右旋和左旋圆偏振波。我们取正常数 $C$。\n$$\nC = \\frac{B_0}{n e \\mu_0}\n$$\n接下来，我们证明 $C = v_A d_i$。使用给定的定义：\n$$\nv_A d_i = \\left( \\frac{B_0}{\\sqrt{\\mu_0 n m_i}} \\right) \\left( \\sqrt{\\frac{m_i}{\\mu_0 n e^2}} \\right) = \\frac{B_0 \\sqrt{m_i}}{\\sqrt{\\mu_0 n m_i} \\sqrt{\\mu_0 n e^2}} = \\frac{B_0}{\\sqrt{\\mu_0 n} \\sqrt{\\mu_0 n e^2}} = \\frac{B_0}{\\mu_0 n e}\n$$\n这证实了 $C = v_A d_i$。\n\n### 第 2 部分：RK4 稳定性分析\n\n我们分析经典四阶 Runge-Kutta (RK4) 方法对于线性测试方程 $\\partial_t q = i\\omega q$ 的稳定性。单步的放大因子 $g(z)$，其中 $q^{n+1} = g(z) q^n$ 且 $z = i\\omega \\Delta t$，由指数函数到四阶的泰勒级数展开给出：\n$$\ng(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!}\n$$\n如果放大因子的模长小于或等于 1，即 $|g(z)| \\le 1$，则该格式是数值稳定的。对于哨声波模式，频率 $\\omega$ 是实数，因此我们考虑纯虚数 $z = i\\alpha$，其中 $\\alpha = \\omega \\Delta t$ 是一个实数无量纲参数。\n$$\ng(i\\alpha) = 1 + (i\\alpha) + \\frac{(i\\alpha)^2}{2} + \\frac{(i\\alpha)^3}{6} + \\frac{(i\\alpha)^4}{24} = 1 + i\\alpha - \\frac{\\alpha^2}{2} - i\\frac{\\alpha^3}{6} + \\frac{\\alpha^4}{24}\n$$\n分组实部和虚部：\n$$\ng(i\\alpha) = \\left(1 - \\frac{\\alpha^2}{2} + \\frac{\\alpha^4}{24}\\right) + i\\left(\\alpha - \\frac{\\alpha^3}{6}\\right)\n$$\n稳定性条件是 $|g(i\\alpha)|^2 \\le 1$：\n$$\n\\left(1 - \\frac{\\alpha^2}{2} + \\frac{\\alpha^4}{24}\\right)^2 + \\left(\\alpha - \\frac{\\alpha^3}{6}\\right)^2 \\le 1\n$$\n展开各项：\n$$\n\\left(1 - \\alpha^2 + \\frac{\\alpha^4}{4} + \\frac{\\alpha^4}{12} - \\frac{\\alpha^6}{24} + \\frac{\\alpha^8}{576}\\right) + \\left(\\alpha^2 - \\frac{\\alpha^4}{3} + \\frac{\\alpha^6}{36}\\right) \\le 1\n$$\n$$\n1 - \\alpha^2 + \\frac{\\alpha^4}{3} - \\frac{\\alpha^6}{24} + \\frac{\\alpha^8}{576} + \\alpha^2 - \\frac{\\alpha^4}{3} + \\frac{\\alpha^6}{36} \\le 1\n$$\n项 $\\alpha^2$ 和 $\\alpha^4/3$ 相消。\n$$\n-\\frac{\\alpha^6}{24} + \\frac{\\alpha^6}{36} + \\frac{\\alpha^8}{576} \\le 0\n$$\n$$\n\\alpha^6 \\left( \\frac{-3+2}{72} \\right) + \\frac{\\alpha^8}{576} \\le 0 \\implies -\\frac{\\alpha^6}{72} + \\frac{\\alpha^8}{576} \\le 0\n$$\n由于 $\\alpha \\ge 0$，我们考虑 $\\alpha > 0$ 并除以 $\\alpha^6$：\n$$\n-\\frac{1}{72} + \\frac{\\alpha^2}{576} \\le 0 \\implies \\alpha^2 \\le \\frac{576}{72} = 8\n$$\n稳定性边界是 $\\alpha^2 = 8$，这意味着使该格式稳定的最大正值为 $\\alpha_\\star = \\sqrt{8} = 2\\sqrt{2}$。\n\n时间步长 $\\Delta t$ 的显式稳定性约束为 $|\\omega \\Delta t| \\le \\alpha_\\star$。为确保网格上所有可分辨模式的稳定性，我们必须使用最大频率 $\\omega_{\\max}$，它对应于最大波数 $k_{\\max}$。该条件是：\n$$\n\\Delta t_{\\mathrm{exp}} \\le \\frac{\\alpha_\\star}{|\\omega_{\\max}|} = \\frac{2\\sqrt{2}}{|\\omega_{\\max}|}\n$$\n根据第 1 部分， $|\\omega| = \\frac{B_0}{\\mu_0 n e} k^2$。使用给定的最大可分辨波数 $k_{\\max} = \\pi/\\Delta x$：\n$$\n\\omega_{\\max} = \\frac{B_0}{\\mu_0 n e} k_{\\max}^2 = \\frac{B_0}{\\mu_0 n e} \\left(\\frac{\\pi}{\\Delta x}\\right)^2\n$$\n将此代入稳定性约束，得到最大允许显式时间步长的表达式：\n$$\n\\Delta t_{\\mathrm{exp}} = \\frac{2\\sqrt{2} \\mu_0 n e}{B_0 (\\pi/\\Delta x)^2} = \\frac{2\\sqrt{2} \\mu_0 n e \\Delta x^2}{B_0 \\pi^2}\n$$\n\n### 第 3 部分：IMEX 格式与稳定性\n\n感应方程为 $\\partial_t \\mathbf{B} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) - \\nabla \\times \\left( \\frac{\\mathbf{J} \\times \\mathbf{B}}{n e} \\right)$。我们将其分为显式平流部分 $\\mathcal{F}(\\mathbf{B}) = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$ 和隐式霍尔部分 $\\mathcal{G}(\\mathbf{B}) = - \\nabla \\times ((\\mathbf{J} \\times \\mathbf{B})/(ne))$。\n所要求的 IMEX 格式对于显式部分是时间一阶的，对于隐式部分是时间二阶的。一个合适的选择是前向欧拉 / Crank-Nicolson 格式：\n$$\n\\frac{\\mathbf{B}^{n+1} - \\mathbf{B}^n}{\\Delta t} = \\mathcal{F}(\\mathbf{B}^n) + \\frac{1}{2}\\left(\\mathcal{G}(\\mathbf{B}^{n+1}) + \\mathcal{G}(\\mathbf{B}^n)\\right)\n$$\n霍尔项 $\\mathcal{G}(\\mathbf{B})$ 是非线性的。为了分析和实际实现，通常会对其进行线性化。在强均匀场 $\\mathbf{B}_0$ 周围的“线性、常系数极限”下，我们有 $\\mathbf{J} \\times \\mathbf{B} \\approx (\\nabla \\times \\mathbf{B}/\\mu_0) \\times \\mathbf{B}_0$。这给出了一个线性算子 $\\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] = - \\frac{1}{\\mu_0 n e} \\nabla \\times ((\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}_0)$。$\\mathbf{B}^{n+1}$ 的离散更新可写为：\n$$\n\\left(I - \\frac{\\Delta t}{2}\\mathcal{L}_{\\text{Hall}}\\right)\\mathbf{B}^{n+1} = \\left(I + \\frac{\\Delta t}{2}\\mathcal{L}_{\\text{Hall}}\\right)\\mathbf{B}^n + \\Delta t \\, \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}^n)\n$$\n这是一个在每一步都需要求解 $\\mathbf{B}^{n+1}$ 的线性系统。\n\n为了分析隐式霍尔子步骤的能量稳定性，我们考虑用 Crank-Nicolson 离散化的方程 $\\partial_t \\mathbf{B} = \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}]$：$\\frac{\\mathbf{B}^{n+1} - \\mathbf{B}^n}{\\Delta t} = \\frac{1}{2}(\\mathcal{L}_{\\text{Hall}}[\\mathbf{B}^{n+1}] + \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}^n])$。\n算子 $\\mathcal{L}_{\\text{Hall}}$ 是斜厄米算子，意味着其伴随算子是其负算子：$\\mathcal{L}_{\\text{Hall}}^\\dagger = -\\mathcal{L}_{\\text{Hall}}$。这可以通过在周期域上进行分部积分来证明：\n$$\n\\langle \\mathbf{A}, \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] \\rangle = \\int \\mathbf{A}^* \\cdot \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] dV = \\int \\mathbf{A}^* \\cdot \\left[ - C_H \\nabla \\times ((\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}_0) \\right] dV\n$$\n其中 $C_H = 1/(\\mu_0 n e)$。通过分部积分，可以证明 $\\langle \\mathbf{A}, \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] \\rangle = \\langle -\\mathcal{L}_{\\text{Hall}}[\\mathbf{A}], \\mathbf{B} \\rangle$。\n对于斜厄米算子 $S$，Crank-Nicolson 放大算子为 $G = (I - \\frac{\\Delta t}{2} S)^{-1} (I + \\frac{\\Delta t}{2} S)$。该算子是幺正的：\n$$\nG^\\dagger G = \\left( (I + \\frac{\\Delta t}{2} S)^\\dagger \\left((I - \\frac{\\Delta t}{2} S)^{-1}\\right)^\\dagger \\right) \\left( (I - \\frac{\\Delta t}{2} S)^{-1} (I + \\frac{\\Delta t}{2} S) \\right)\n$$\n使用 $S^\\dagger = -S$ 和 $(A^{-1})^\\dagger = (A^\\dagger)^{-1}$：\n$$\nG^\\dagger G = \\left( (I - \\frac{\\Delta t}{2} S) (I + \\frac{\\Delta t}{2} S)^{-1} \\right) \\left( (I - \\frac{\\Delta t}{2} S)^{-1} (I + \\frac{\\Delta t}{2} S) \\right)\n$$\n由于这些算子可交换，$G^\\dagger G = (I - \\frac{\\Delta t}{2} S)(I - \\frac{\\Delta t}{2} S)^{-1}(I + \\frac{\\Delta t}{2} S)^{-1}(I + \\frac{\\Delta t}{2} S) = I$。\n幺正放大算子意味着 $\\| \\mathbf{B}^{n+1} \\| = \\| G \\mathbf{B}^n \\| = \\| \\mathbf{B}^n \\|$，保持了 L2-范数（能量）。这表明对霍尔项的 Crank-Nicolson 处理对于任何 $\\Delta t$ 都是无条件能量稳定的。\n\n当刚性的霍尔项被隐式且稳定地处理后，整个 IMEX 格式的时间步长受到显式平流部分稳定性约束的限制。这就是 CFL 条件：\n$$\n\\Delta t_{\\mathrm{IMEX}} \\le \\mathrm{CFL}_{\\mathrm{adv}} \\frac{\\Delta x}{U}\n$$\n其中 $U$ 是特征平流速度。这是限制 IMEX 时间步长的剩余约束。\n\n### 第 4 部分：计算公式\n\n所需的计算基于推导和给出的公式。\n1.  根据哨声波模式的 RK4 稳定性分析，最大显式时间步长为：\n    $$\n    \\Delta t_{\\mathrm{exp}} = \\frac{2\\sqrt{2} \\mu_0 n e (\\Delta x)^2}{B_0 \\pi^2} = \\frac{2\\sqrt{2} \\mu_0 n e (L/N)^2}{B_0 \\pi^2}\n    $$\n2.  受显式平流 CFL 条件限制的最大 IMEX 时间步长由下式给出：\n    $$\n    \\Delta t_{\\mathrm{IMEX}} = \\mathrm{CFL}_{\\mathrm{adv}} \\frac{\\Delta x}{U} = \\mathrm{CFL}_{\\mathrm{adv}} \\frac{L/N}{U}\n    $$\n将为所提供的测试用例实现这些公式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating explicit and IMEX time step limits\n    for several test cases in Hall-MHD.\n    \"\"\"\n    \n    # Physical constants in SI units\n    MU_0 = 4 * np.pi * 1e-7  # Vacuum permeability (H/m or T*m/A)\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C)\n    M_PROTON = 1.67262192369e-27  # Proton mass (kg)\n\n    # Test suite: (L, N, B0, n, mi, U, CFL_adv)\n    test_cases = [\n        # Case A (general regime)\n        (1.0, 256, 0.1, 1e19, M_PROTON, 1e4, 0.5),\n        # Case B (grid-refined boundary)\n        (1.0, 4096, 0.1, 1e19, M_PROTON, 1e4, 0.5),\n        # Case C (ion-mass variation)\n        (1.0, 256, 0.1, 1e19, 4 * M_PROTON, 1e4, 0.5),\n        # Case D (low density edge)\n        (1.0, 256, 0.1, 1e17, M_PROTON, 1e4, 0.5),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, N, B0, n, mi, U, CFL_adv = case\n\n        # Grid spacing\n        delta_x = L / N\n\n        # Part 1: Whistler dispersion constant and explicit time step calculation\n        # The whistler dispersion relation is omega = C * k^2 where C = B0 / (mu0 * n * e)\n        # The RK4 stability limit for this purely oscillatory system is omega_max * dt = 2*sqrt(2).\n        # omega_max corresponds to k_max = pi / delta_x.\n        # dt_exp = (2*sqrt(2)) / omega_max = (2*sqrt(2)) / (C * k_max^2)\n        # dt_exp = (2*sqrt(2) * mu0 * n * e) / (B0 * (pi/delta_x)^2)\n        #        = (2*sqrt(2) * mu0 * n * e * delta_x^2) / (B0 * pi^2)\n        \n        numerator_exp = 2 * np.sqrt(2) * MU_0 * n * E_CHARGE * (delta_x**2)\n        denominator_exp = B0 * (np.pi**2)\n        dt_exp = numerator_exp / denominator_exp\n\n        # Part 2: IMEX time step calculation\n        # The IMEX time step is limited by the advective CFL condition.\n        # dt_imex = CFL_adv * delta_x / U\n        \n        dt_imex = CFL_adv * delta_x / U\n        \n        results.append([dt_exp, dt_imex])\n\n    # Format the output as specified: [[...],[...],...] with 12 significant digits.\n    # The format string \"{:.12e}\" produces scientific notation with 12 digits after the decimal.\n    # Total significant digits is 1 + 12 = 13.\n    # The problem asks for \"twelve significant digits\".\n    # A format like \"{:.11e}\" should be used for 12 total significant digits.\n    \n    # Example: np.format_float_scientific(1.23456789012345e-10, precision=11)\n    # -> '1.23456789012e-10' (12 significant digits)\n    \n    result_strings = []\n    for res_pair in results:\n        s1 = np.format_float_scientific(res_pair[0], precision=11, unique=False)\n        s2 = np.format_float_scientific(res_pair[1], precision=11, unique=False)\n        result_strings.append(f\"[{s1},{s2}]\")\n        \n    print(f\"[[{result_strings[0][1:-1]}],[{result_strings[1][1:-1]}],[{result_strings[2][1:-1]}],[{result_strings[3][1:-1]}]]\")\n\nsolve()\n\n```"
        }
    ]
}