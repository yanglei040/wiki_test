{
    "hands_on_practices": [
        {
            "introduction": "对于任何瞬态模拟，特别是使用显式时间积分的模拟，确保数值稳定性是首要的关键步骤。在分区式多物理场仿真中，不同求解器处理不同物理场，此时全局稳定性取决于所有子系统中最严格的约束。本练习  提供了一个流固耦合（FSI）中的经典场景，要求你确定一个耦合大涡模拟（LES）-结构仿真的临界时间步长。它旨在强化Courant–Friedrichs–Lewy (CFL) 条件这一基本概念，及其在多物理场背景下的应用。",
            "id": "3509332",
            "problem": "在一个多物理场流固耦合框架内，一块柔性张紧板沉浸在不可压缩的湍流通道流中，该流场通过大涡模拟（LES）进行解析。耦合通过一个具有单一全局时间步长的松散耦合分区算法来执行。流体求解器使用显式时间积分器，结构求解器在板的薄膜模型上使用显式中心差分法。密度比为1，即 $\\rho_{s}/\\rho_{f} = 1$。流场和结构采用以下参数进行离散化：\n\n- 流体侧 (LES)：最大解析速度 $U_{\\max} = 12\\,\\mathrm{m/s}$，最小网格间距 $\\Delta = 1.0 \\times 10^{-3}\\,\\mathrm{m}$，以及流体库朗-弗里德里希-列维 (CFL) 极限 $C_{\\mathrm{CFL},f} = 0.5$。\n- 结构侧 (薄膜板)：单位长度的面内张力 $T = 1000\\,\\mathrm{N/m}$，板厚 $t = 1.0 \\times 10^{-3}\\,\\mathrm{m}$，质量密度 $\\rho_{f} = \\rho_{s} = 1000\\,\\mathrm{kg/m^{3}}$ (根据给定比率)，结构单元尺寸 $h_{s} = 5.0 \\times 10^{-3}\\,\\mathrm{m}$，以及结构库朗极限 $C_{\\mathrm{Courant},s} = 0.9$。\n\n从不可压缩的纳维-斯托克斯方程及其由流体CFL条件表示的显式时间离散稳定性要求出发，并从薄膜波动方程及其由结构库朗条件表示的显式稳定性出发，推导出保证两个求解器在松散分区耦合下稳定的临界全局时间步长 $\\Delta t_{\\mathrm{crit}}$。使用上述数据计算其值。\n\n以微秒为单位表示最终的时间步长，并将您的答案四舍五入到四位有效数字。",
            "solution": "问题要求为松散耦合分区的流固耦合（FSI）模拟找到临界全局时间步长 $\\Delta t_{\\mathrm{crit}}$。这个临界时间步长是保证流体和结构求解器（两者均使用显式时间积分方案）数值稳定性的最大值。对于这种具有单一全局时间步长的设置，整体稳定性由各个子问题中最严格的（即最小的）时间步长限制决定。因此，临界全局时间步长由流体求解器的最大稳定时间步长 $\\Delta t_{f}$ 和结构求解器的最大稳定时间步长 $\\Delta t_{s}$ 的最小值给出。\n$$\n\\Delta t_{\\mathrm{crit}} = \\min(\\Delta t_{f}, \\Delta t_{s})\n$$\n\n首先，我们确定流体求解器的稳定性极限。问题指明，流体动力学使用大涡模拟（LES）和显式时间积分器进行解析。这种方案的稳定性由库朗-弗里德里希-列维（CFL）条件控制，该条件关联了时间步长 $\\Delta t_{f}$、流体速度 $U$ 和网格间距 $\\Delta$。该条件给出如下：\n$$\nC_{\\mathrm{CFL},f} = \\frac{U \\Delta t_{f}}{\\Delta}\n$$\n如果 $C_{\\mathrm{CFL},f}$ 低于某个极限（本题中为 $C_{\\mathrm{CFL},f} = 0.5$），则模拟是稳定的。为了找到最大允许时间步长，我们使用最严格的情况，即涉及最大速度 $U_{\\max}$ 和最小网格间距 $\\Delta$ 的情况。\n流体侧的给定值为：\n- 最大解析速度: $U_{\\max} = 12 \\, \\mathrm{m/s}$\n- 最小网格间距: $\\Delta = 1.0 \\times 10^{-3} \\, \\mathrm{m}$\n- 流体CFL极限: $C_{\\mathrm{CFL},f} = 0.5$\n\n重排CFL条件以求解流体求解器的最大允许时间步长 $\\Delta t_{f}$：\n$$\n\\Delta t_{f} \\le \\frac{C_{\\mathrm{CFL},f} \\cdot \\Delta}{U_{\\max}}\n$$\n代入给定值：\n$$\n\\Delta t_{f} \\le \\frac{0.5 \\cdot (1.0 \\times 10^{-3} \\, \\mathrm{m})}{12 \\, \\mathrm{m/s}} = \\frac{5.0 \\times 10^{-4}}{12} \\, \\mathrm{s} \\approx 4.1667 \\times 10^{-5} \\, \\mathrm{s}\n$$\n因此，流体求解器的最大稳定时间步长为 $\\Delta t_{f} = 4.166\\overline{6} \\times 10^{-5} \\, \\mathrm{s}$。\n\n接下来，我们确定结构求解器的稳定性极限。该结构是一块柔性板，被建模为薄膜，其动力学通过显式中心差分格式求解。张紧薄膜的控制方程是波动方程。波动方程显式格式的稳定性由一个库朗型条件决定。必须首先计算薄膜中的波传播速度 $c_s$。它由以下公式给出：\n$$\nc_s = \\sqrt{\\frac{T}{\\rho_s t}}\n$$\n其中 $T$ 是单位长度的面内张力，$\\rho_s$ 是板材料的质量密度，而 $t$ 是板厚。注意，乘积 $\\rho_s t$ 代表薄膜的单位面积质量。\n结构侧的给定值为：\n- 单位长度的张力: $T = 1000 \\, \\mathrm{N/m}$\n- 板厚: $t = 1.0 \\times 10^{-3} \\, \\mathrm{m}$\n- 质量密度: $\\rho_s = 1000 \\, \\mathrm{kg/m^3}$\n- 结构单元尺寸: $h_s = 5.0 \\times 10^{-3} \\, \\mathrm{m}$\n- 结构库朗极限: $C_{\\mathrm{Courant},s} = 0.9$\n\n我们计算波速 $c_s$：\n$$\nc_s = \\sqrt{\\frac{1000 \\, \\mathrm{N/m}}{(1000 \\, \\mathrm{kg/m^3}) \\cdot (1.0 \\times 10^{-3} \\, \\mathrm{m})}} = \\sqrt{\\frac{1000}{1}} \\, \\mathrm{m/s} = \\sqrt{1000} \\, \\mathrm{m/s}\n$$\n$c_s = 10\\sqrt{10} \\, \\mathrm{m/s} \\approx 31.6228 \\, \\mathrm{m/s}$。\n\n结构求解器的库朗条件是：\n$$\nC_{\\mathrm{Courant},s} = \\frac{c_s \\Delta t_{s}}{h_s}\n$$\n为保证稳定性，该值不得超过给定的极限 $C_{\\mathrm{Courant},s} = 0.9$。我们重排公式以求得结构求解器的最大允许时间步长 $\\Delta t_{s}$：\n$$\n\\Delta t_{s} \\le \\frac{C_{\\mathrm{Courant},s} \\cdot h_s}{c_s}\n$$\n代入数值：\n$$\n\\Delta t_{s} \\le \\frac{0.9 \\cdot (5.0 \\times 10^{-3} \\, \\mathrm{m})}{\\sqrt{1000} \\, \\mathrm{m/s}} = \\frac{4.5 \\times 10^{-3}}{\\sqrt{1000}} \\, \\mathrm{s} \\approx 1.423 \\times 10^{-4} \\, \\mathrm{s}\n$$\n因此，结构求解器的最大稳定时间步长为 $\\Delta t_{s} \\approx 1.423 \\times 10^{-4} \\, \\mathrm{s}$。\n\n最后，我们确定耦合系统的临界全局时间步长 $\\Delta t_{\\mathrm{crit}}$。这是两个独立时间步长限制中的最小值：\n$$\n\\Delta t_{\\mathrm{crit}} = \\min(\\Delta t_{f}, \\Delta t_{s})\n$$\n$$\n\\Delta t_{\\mathrm{crit}} = \\min(4.166\\overline{6} \\times 10^{-5} \\, \\mathrm{s}, \\, 1.423 \\times 10^{-4} \\, \\mathrm{s})\n$$\n比较这两个值，很明显流体求解器对时间步长施加了更严格的约束。\n$$\n\\Delta t_{\\mathrm{crit}} = \\Delta t_{f} = 4.166\\overline{6} \\times 10^{-5} \\, \\mathrm{s}\n$$\n问题要求结果以微秒 ($\\mu\\mathrm{s}$) 表示，并四舍五入到四位有效数字。我们将单位从秒转换为微秒 ($1 \\, \\mathrm{s} = 10^6 \\, \\mu\\mathrm{s}$)：\n$$\n\\Delta t_{\\mathrm{crit}} = (4.166\\overline{6} \\times 10^{-5}) \\times 10^6 \\, \\mu\\mathrm{s} = 41.66\\overline{6} \\, \\mu\\mathrm{s}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n\\Delta t_{\\mathrm{crit}} = 41.67 \\, \\mu\\mathrm{s}\n$$\n这就是确保松散耦合 FSI 模拟中两个求解器都稳定的临界全局时间步长。",
            "answer": "$$\n\\boxed{41.67}\n$$"
        },
        {
            "introduction": "高保真度模型在功能强大的同时，也可能引入其特有的数值挑战。例如，大涡模拟中的动态Smagorinsky模型可能预测出局部的负涡粘性，这会导致非物理的能量增长，并最终使模拟发散。这个动手编程练习  深入探讨了这一实际问题，指导你实现一种拉格朗日平均技术来正则化模型系数。通过这种方法，可以保证总粘性的非负性，从而稳定模拟过程，这个实践揭示了物理建模与数值稳健性之间的重要联系。",
            "id": "3509289",
            "problem": "考虑用于大涡模拟 (LES) 的不可压缩流，其中滤波后的纳维-斯托克斯方程包含一个由涡粘性封闭建模的亚格子尺度应力。在动态模型中，该系数在粗分辨率下可能局部为负，这会引起反扩散并可能触发数值爆破。您的任务是分析此种情况下的数值稳定性，并构建一种拉格朗日平均方法来正则化负涡粘性。请从第一性原理和广为接受的事实出发。仅使用此处提供的定义，不要假设任何未说明的公式。\n\n为您提供了以下用于建模和稳定性的基础：\n\n- 不可压缩流体的滤波后动量方程中，粘性项与有效粘度成正比。亚格子尺度 (SGS) 涡粘性模型将涡粘性定义为 $\\nu_t(t) = C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert$，其中 $\\Delta$ 是滤波器宽度，$C_d(t)$ 是动态系数，$\\lvert S(t)\\rvert$ 是可解应变率张量的模。\n- 总有效粘度为 $\\nu_{\\mathrm{eff}}(t) = \\nu + \\nu_t(t)$，其中 $\\nu$ 是分子运动粘度。\n- 对于在间距为 $\\Delta x$ 的均匀网格上使用的显式时间步进格式，稳定性需要满足平流的 Courant-Friedrichs-Lewy (CFL) 条件和粘性项的扩散条件。给定一个特征均匀速度大小 $\\lvert u\\rvert$，将平流时间步长限制定义为 $\\Delta t_{\\mathrm{adv}} = c_{\\mathrm{adv}}\\;\\Delta x/\\lvert u\\rvert$，其中 $c_{\\mathrm{adv}}$ 是一个在 $(0,1]$ 内的常数。对于粘性项，当 $\\nu_{\\mathrm{eff}}(t) > 0$ 时，将扩散时间步长限制定义为 $\\Delta t_{\\mathrm{diff}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2/\\nu_{\\mathrm{eff}}(t)$；当 $\\nu_{\\mathrm{eff}}(t) \\le 0$ 时，定义为 $\\Delta t_{\\mathrm{diff}}(t) = 0$；其中 $c_{\\mathrm{diff}}$ 是一个在 $(0,1]$ 内的常数。在时间 $t$ 的总体稳定时间步长是这两个限制的最小值。\n\n为构建动态系数的拉格朗日平均正则化，请使用基于迹线的指数松弛：\n- 设拉格朗日平均动态系数 $C_L(t)$ 满足一阶常微分方程 $\\mathrm{d} C_L/\\mathrm{d}t = \\left(C_d(t) - C_L(t)\\right)/T_L$，其中 $C_L(0) = C_d(0)$ 且 $T_L > 0$ 是拉格朗日松弛时间尺度。\n- 定义正则化涡粘性 $\\nu_{t,\\mathrm{reg}}(t) = \\max\\left(C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert,\\,-\\nu\\right)$，这保证了 $\\nu_{\\mathrm{eff,reg}}(t) = \\nu + \\nu_{t,\\mathrm{reg}}(t) \\ge 0$。\n- 使用正则化后，当 $\\nu_{\\mathrm{eff,reg}}(t) > 0$ 时，定义 $\\Delta t_{\\mathrm{diff,reg}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2/\\nu_{\\mathrm{eff,reg}}(t)$；当 $\\nu_{\\mathrm{eff,reg}}(t) = 0$ 时，将 $\\Delta t_{\\mathrm{diff,reg}}(t)$ 解释为 $+\\infty$。正则化后在时间 $t$ 的总体稳定时间步长是这两个限制的最小值。\n\n沿单条迹线的时间信号和数值评估参数规定如下：\n- 可解应变模为 $\\lvert S(t)\\rvert = S_0\\left(1 + a_s \\sin(2\\pi f_s t)\\right)$。\n- 动态系数为 $C_d(t) = C_0 + \\epsilon \\sin(2\\pi f_c t)$。\n- 迹线速度大小 $\\lvert u\\rvert$ 是恒定的，且空间滤波器宽度等于网格间距，即 $\\Delta = \\Delta x$。\n- 评估时域为 $T_{\\mathrm{end}}$，评估增量为 $\\delta t$。您必须在此区间内计算整个时间范围内的最小扩散限制。程序应设置正则化前的总体稳定时间步长 $\\Delta t_{\\mathrm{stable,before}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff}}(t)\\right)$ 和正则化后的稳定时间步长 $\\Delta t_{\\mathrm{stable,after}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff,reg}}(t)\\right)$，并相应地在求最小值时解释 $+\\infty$。\n\n使用以下常数、单位和测试套件：\n- 使用 $c_{\\mathrm{adv}} = 0.5$ 和 $c_{\\mathrm{diff}} = 0.5$。\n- 所有长度单位为$\\mathrm{m}$，粘度单位为$\\mathrm{m}^2/\\mathrm{s}$，时间单位为$\\mathrm{s}$，频率单位为$\\mathrm{Hz}$，应变单位为$\\mathrm{s}^{-1}$。\n- 在 $t \\in [0, T_{\\mathrm{end}}]$ 上以步长 $\\delta t$ 进行评估。\n- 测试套件参数：\n  1. 案例 1：$\\Delta x = 0.05$，$\\nu = 1.0\\times 10^{-5}$，$\\lvert u\\rvert = 1.0$，$\\Delta = \\Delta x$，$S_0 = 50$，$a_s = 0.5$，$f_s = 1.0$，$C_0 = -0.12$，$\\epsilon = 0.08$，$f_c = 2.0$，$T_L = 0.20$，$T_{\\mathrm{end}} = 1.0$，$\\delta t = 0.001$。\n  2. 案例 2：$\\Delta x = 0.20$，$\\nu = 5.0\\times 10^{-6}$，$\\lvert u\\rvert = 4.0$，$\\Delta = \\Delta x$，$S_0 = 100$，$a_s = 0.3$，$f_s = 0.5$，$C_0 = -0.30$，$\\epsilon = 0.20$，$f_c = 1.0$，$T_L = 0.01$，$T_{\\mathrm{end}} = 1.0$，$\\delta t = 0.001$。\n  3. 案例 3：$\\Delta x = 0.01$，$\\nu = 1.0\\times 10^{-6}$，$\\lvert u\\rvert = 10.0$，$\\Delta = \\Delta x$，$S_0 = 80$，$a_s = 0.4$，$f_s = 3.0$，$C_0 = -0.005$，$\\epsilon = 0.010$，$f_c = 4.0$，$T_L = 2.0$，$T_{\\mathrm{end}} = 1.0$，$\\delta t = 0.001$。\n\n您的程序必须：\n- 计算每个案例的 $\\Delta t_{\\mathrm{stable,before}}$ 和 $\\Delta t_{\\mathrm{stable,after}}$。\n- 输出单行结果，该行包含一个由方括号括起的逗号分隔列表，其中包含六个以秒为单位的浮点数结果，顺序为 $[\\Delta t_{\\mathrm{stable,before}}^{(1)}, \\Delta t_{\\mathrm{stable,after}}^{(1)}, \\Delta t_{\\mathrm{stable,before}}^{(2)}, \\Delta t_{\\mathrm{stable,after}}^{(2)}, \\Delta t_{\\mathrm{stable,before}}^{(3)}, \\Delta t_{\\mathrm{stable,after}}^{(3)}]$。每个值必须四舍五入到 $6$ 位小数。",
            "solution": "目标是分析使用动态涡粘性模型的大涡模拟 (LES) 的数值稳定性，并构建一种拉格朗日平均方法来对其进行正则化。该分析通过计算显式数值格式在应用正则化前后所允许的最大稳定时间步长来执行。\n\n该问题基于计算流体动力学的既定原则，特别是湍流模型和偏微分方程的数值分析。所提供的定义和参数在科学上是一致的，足以进行适定性分析。\n\n### 1. 无正则化时的数值稳定性分析\n\n对于显式时间步进格式，最大允许时间步长 $\\Delta t$ 受稳定性标准的约束。问题指定了两种此类约束：一种用于平流，一种用于扩散。\n\n平流时间步长限制由下式给出：\n$$\n\\Delta t_{\\mathrm{adv}} = c_{\\mathrm{adv}}\\;\\frac{\\Delta x}{\\lvert u\\rvert}\n$$\n其中 $c_{\\mathrm{adv}} \\in (0, 1]$ 是平流 Courant-Friedrichs-Lewy (CFL) 数，$\\Delta x$ 是网格间距，$\\lvert u\\rvert$ 是特征速度大小。由于其组成参数是恒定的，因此对于每个测试案例，此限制是常数。\n\n扩散时间步长限制取决于有效粘度 $\\nu_{\\mathrm{eff}}(t)$。亚格子尺度 (SGS) 涡粘性模型化为：\n$$\n\\nu_t(t) = C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert\n$$\n其中 $C_d(t)$ 是动态模型系数，$\\Delta$ 是滤波器宽度，$\\lvert S(t)\\rvert$ 是可解应变率张量的模。总有效粘度是分子粘度 $\\nu$ 和涡粘性 $\\nu_t(t)$ 的和：\n$$\n\\nu_{\\mathrm{eff}}(t) = \\nu + \\nu_t(t) = \\nu + C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert\n$$\n扩散时间步长限制则定义为：\n$$\n\\Delta t_{\\mathrm{diff}}(t) = \\begin{cases} c_{\\mathrm{diff}}\\;\\frac{\\Delta x^2}{\\nu_{\\mathrm{eff}}(t)}  \\text{if } \\nu_{\\mathrm{eff}}(t) > 0 \\\\ 0  \\text{if } \\nu_{\\mathrm{eff}}(t) \\le 0 \\end{cases}\n$$\n其中 $c_{\\mathrm{diff}} \\in (0, 1]$ 是扩散 CFL 数。\n\n在任意时刻 $t$ 的总体稳定时间步长为 $\\min(\\Delta t_{\\mathrm{adv}}, \\Delta t_{\\mathrm{diff}}(t))$。为确保在整个模拟时间 $T_{\\mathrm{end}}$ 内的稳定性，时间步长必须小于在区间 $t \\in [0, T_{\\mathrm{end}}]$ 上遇到的最小值。因此，正则化前的总体稳定时间步长为：\n$$\n\\Delta t_{\\mathrm{stable,before}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff}}(t)\\right)\n$$\n动态模型允许 $C_d(t)$ 变为负值。如果 $C_d(t)$ 足够负，涡粘性 $\\nu_t(t)$ 可能变得足够负，从而使总有效粘度 $\\nu_{\\mathrm{eff}}(t)$ 变为非正值。具体来说，如果 $\\nu + C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert \\le 0$，则 $\\nu_{\\mathrm{eff}}(t) \\le 0$。根据 $\\Delta t_{\\mathrm{diff}}(t)$ 的定义，这会立即强制 $\\Delta t_{\\mathrm{diff}}(t) = 0$。如果这种情况哪怕只在某个瞬间发生，那么 $\\min_{t} \\Delta t_{\\mathrm{diff}}(t) = 0$，导致 $\\Delta t_{\\mathrm{stable,before}} = 0$。这标志着数值格式的灾难性失败（“爆破”），因为使用显式方法无法在时间上向前推进。\n\n动态系数和应变率的函数由下式给出：\n$$\nC_d(t) = C_0 + \\epsilon \\sin(2\\pi f_c t)\n$$\n$$\n\\lvert S(t)\\rvert = S_0\\left(1 + a_s \\sin(2\\pi f_s t)\\right)\n$$\n对于给定的测试案例，参数设置使得 $C_d(t)$ 通常会达到负值，导致 $\\nu_{\\mathrm{eff}}(t)$ 在某些时刻变为非正值，这将导致 $\\Delta t_{\\mathrm{stable,before}} = 0$。\n\n### 2. 拉格朗日正则化方法的构建\n\n为防止数值爆破，使用基于拉格朗日迹线的平均方法对动态系数 $C_d(t)$ 进行正则化。引入一个新系数 $C_L(t)$，它代表 $C_d(t)$ 沿流体质点路径的时间松弛滞后平均值。其演化由以下一阶常微分方程 (ODE) 控制：\n$$\n\\frac{\\mathrm{d} C_L}{\\mathrm{d}t} = \\frac{C_d(t) - C_L(t)}{T_L}\n$$\n其初始条件为 $C_L(0) = C_d(0)$，其中 $T_L > 0$ 是拉格朗日松弛时间尺度。此方程使 $C_L(t)$ 以由 $T_L$ 决定的延迟和平滑度来追踪 $C_d(t)$。\n\n在数值实现中，此 ODE 在小的时间增量 $\\delta t$ 上进行离散化。使用一阶前向欧拉法，我们将导数近似为 $(\\mathrm{d} C_L/\\mathrm{d}t)|_t \\approx (C_L(t+\\delta t) - C_L(t))/\\delta t$。这产生以下迭代格式：\n$$\nC_L(t+\\delta t) \\approx C_L(t) + \\frac{\\delta t}{T_L}\\left(C_d(t) - C_L(t)\\right)\n$$\n从 $C_L(0) = C_d(0)$ 开始，迭代应用此公式来计算在区间 $[0, T_{\\mathrm{end}}]$ 上 $C_L(t)$ 的时间序列。\n\n### 3. 正则化后的稳定性分析\n\n拉格朗日平均系数 $C_L(t)$ 随后被用来定义一个正则化涡粘性 $\\nu_{t,\\mathrm{reg}}(t)$。一个关键步骤是引入对涡粘性的下方截断，以防止其变得比分子粘度更负：\n$$\n\\nu_{t,\\mathrm{reg}}(t) = \\max\\left(C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert,\\,-\\nu\\right)\n$$\n这种截断是稳定化的核心。正则化后的有效粘度 $\\nu_{\\mathrm{eff,reg}}(t)$ 则为：\n$$\n\\nu_{\\mathrm{eff,reg}}(t) = \\nu + \\nu_{t,\\mathrm{reg}}(t) = \\nu + \\max\\left(C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert,\\,-\\nu\\right)\n$$\n根据构造，$\\nu_{\\mathrm{eff,reg}}(t)$ 保证为非负。\n- 若 $C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert \\ge -\\nu$，则 $\\nu_{\\mathrm{eff,reg}}(t) = \\nu + C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert \\ge 0$。\n- 若 $C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert  -\\nu$，则 $\\nu_{\\mathrm{eff,reg}}(t) = \\nu - \\nu = 0$。\n\n对于非负的有效粘度，正则化后的扩散时间步长限制定义为：\n$$\n\\Delta t_{\\mathrm{diff,reg}}(t) = \\begin{cases} c_{\\mathrm{diff}}\\;\\frac{\\Delta x^2}{\\nu_{\\mathrm{eff,reg}}(t)}  \\text{if } \\nu_{\\mathrm{eff,reg}}(t)  0 \\\\ +\\infty  \\text{if } \\nu_{\\mathrm{eff,reg}}(t) = 0 \\end{cases}\n$$\n当 $\\nu_{\\mathrm{eff,reg}}(t) = 0$ 时，无限时间步长限制的解释是粘性项消失，因此不施加稳定性约束。正则化后的总体稳定时间步长则在整个时间域上计算：\n$$\n\\Delta t_{\\mathrm{stable,after}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff,reg}}(t)\\right)\n$$\n由于 $\\nu_{\\mathrm{eff,reg}}(t)$ 绝不为负，$\\min_{t} \\Delta t_{\\mathrm{diff,reg}}(t)$ 将是一个非零的正值（或 $+\\infty$），只要 $\\nu_{\\mathrm{eff,reg}}(t)$ 在有限时间区间内不恒等于零（在此情况下确实如此）。这确保了 $\\Delta t_{\\mathrm{stable,after}}$ 是一个有限的非零值，代表一个稳定的数值格式。对 $\\Delta t_{\\mathrm{diff,reg}}(t)$ 的最严格约束来自于 $\\nu_{\\mathrm{eff,reg}}(t)$ 的最大值，得出 $\\min_{t} \\Delta t_{\\mathrm{diff,reg}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2 / (\\max_{t} \\nu_{\\mathrm{eff,reg}}(t))$，假设 $\\max_{t} \\nu_{\\mathrm{eff,reg}}(t)  0$。\n\n### 4. 计算算法\n\n对于每个测试案例，执行以下步骤：\n1.  定义时间数组 $t_i = i \\cdot \\delta t$，其中 $i=0, 1, \\dots, N$ 且 $N = T_{\\mathrm{end}}/\\delta t$。\n2.  计算恒定的平流时间步长限制 $\\Delta t_{\\mathrm{adv}}$。\n3.  生成 $\\lvert S(t_i)\\rvert$ 和 $C_d(t_i)$ 的离散时间序列。\n4.  **正则化前分析**：\n    a. 计算有效粘度时间序列 $\\nu_{\\mathrm{eff}}(t_i) = \\nu + C_d(t_i)\\,\\Delta^2\\,\\lvert S(t_i)\\rvert$。\n    b. 检查是否存在 $\\nu_{\\mathrm{eff}}(t_i) \\le 0$。如果存在，则 $\\min_t \\Delta t_{\\mathrm{diff}}(t) = 0$，且 $\\Delta t_{\\mathrm{stable,before}}=0$。否则，计算 $\\min_t \\Delta t_{\\mathrm{diff}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2 / (\\max_i \\nu_{\\mathrm{eff}}(t_i))$ 并随后计算 $\\Delta t_{\\mathrm{stable,before}}$。\n5.  **正则化后分析**：\n    a. 初始化 $C_L(t_0) = C_d(t_0)$。\n    b. 使用前向欧拉法迭代计算 $C_L(t_i)$ 序列。\n    c. 计算正则化涡粘性序列 $\\nu_{t,\\mathrm{reg}}(t_i) = \\max\\left(C_L(t_i)\\,\\Delta^2\\,\\lvert S(t_i)\\rvert,\\,-\\nu\\right)$。\n    d. 计算正则化有效粘度序列 $\\nu_{\\mathrm{eff,reg}}(t_i) = \\nu + \\nu_{t,\\mathrm{reg}}(t_i)$。\n    e. 找到序列的最大值 $\\max_i \\nu_{\\mathrm{eff,reg}}(t_i)$。\n    f. 如果 $\\max_i \\nu_{\\mathrm{eff,reg}}(t_i)  0$，计算最小扩散限制 $\\min_t \\Delta t_{\\mathrm{diff,reg}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2 / (\\max_i \\nu_{\\mathrm{eff,reg}}(t_i))$。如果 $\\max_i \\nu_{\\mathrm{eff,reg}}(t_i) = 0$，此限制为 $+\\infty$。\n    g. 确定最终的稳定时间步长 $\\Delta t_{\\mathrm{stable,after}} = \\min(\\Delta t_{\\mathrm{adv}}, \\min_t \\Delta t_{\\mathrm{diff,reg}}(t))$。\n6.  然后收集每个案例的结果 $\\Delta t_{\\mathrm{stable,before}}$ 和 $\\Delta t_{\\mathrm{stable,after}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_stability(params):\n    \"\"\"\n    Computes stable time steps before and after Lagrangian regularization.\n\n    Args:\n        params (dict): A dictionary containing all parameters for a single case.\n\n    Returns:\n        tuple: A tuple containing (dt_stable_before, dt_stable_after).\n    \"\"\"\n    dx = params['dx']\n    nu = params['nu']\n    u_mag = params['u_mag']\n    Delta = params['Delta']\n    S0 = params['S0']\n    a_s = params['a_s']\n    f_s = params['f_s']\n    C0 = params['C0']\n    epsilon = params['epsilon']\n    f_c = params['f_c']\n    T_L = params['T_L']\n    T_end = params['T_end']\n    dt_eval = params['dt_eval']\n\n    c_adv = 0.5\n    c_diff = 0.5\n\n    # Create time array for evaluation\n    t_series = np.arange(0, T_end + dt_eval, dt_eval)\n\n    # Calculate constant advective time-step limit\n    dt_adv = c_adv * dx / u_mag\n\n    # Calculate time-dependent quantities\n    S_mag_t = S0 * (1 + a_s * np.sin(2 * np.pi * f_s * t_series))\n    C_d_t = C0 + epsilon * np.sin(2 * np.pi * f_c * t_series)\n\n    # --- Pre-regularization Analysis ---\n    nu_eff_t = nu + C_d_t * (Delta**2) * S_mag_t\n\n    # Check for non-positive effective viscosity\n    if np.any(nu_eff_t = 0):\n        min_dt_diff_before = 0.0\n    else:\n        # This branch is not expected for the given test cases but included for completeness\n        max_nu_eff = np.max(nu_eff_t)\n        min_dt_diff_before = c_diff * dx**2 / max_nu_eff\n    \n    dt_stable_before = min(dt_adv, min_dt_diff_before)\n\n    # --- Post-regularization Analysis ---\n    \n    # 1. Solve ODE for C_L(t) using Forward Euler\n    C_L_t = np.zeros_like(t_series)\n    C_L_t[0] = C_d_t[0]\n    for i in range(1, len(t_series)):\n        # C_L(t + dt) = C_L(t) + (dt/T_L) * (C_d(t) - C_L(t))\n        C_L_t[i] = C_L_t[i-1] + (dt_eval / T_L) * (C_d_t[i-1] - C_L_t[i-1])\n\n    # 2. Compute regularized viscosities\n    nu_t_reg = np.maximum(C_L_t * (Delta**2) * S_mag_t, -nu)\n    nu_eff_reg = nu + nu_t_reg\n\n    # 3. Compute stable time step after regularization\n    max_nu_eff_reg = np.max(nu_eff_reg)\n    \n    if max_nu_eff_reg > 0:\n        min_dt_diff_after = c_diff * dx**2 / max_nu_eff_reg\n    else:\n        # If max effective viscosity is 0, all values must be 0.\n        # This means dt_diff_reg is +inf for all t, so the min is +inf.\n        min_dt_diff_after = np.inf\n\n    dt_stable_after = min(dt_adv, min_dt_diff_after)\n\n    return dt_stable_before, dt_stable_after\n    \ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            'dx': 0.05, 'nu': 1.0e-5, 'u_mag': 1.0, 'Delta': 0.05,\n            'S0': 50, 'a_s': 0.5, 'f_s': 1.0, \n            'C0': -0.12, 'epsilon': 0.08, 'f_c': 2.0,\n            'T_L': 0.20, 'T_end': 1.0, 'dt_eval': 0.001\n        },\n        # Case 2\n        {\n            'dx': 0.20, 'nu': 5.0e-6, 'u_mag': 4.0, 'Delta': 0.20,\n            'S0': 100, 'a_s': 0.3, 'f_s': 0.5,\n            'C0': -0.30, 'epsilon': 0.20, 'f_c': 1.0,\n            'T_L': 0.01, 'T_end': 1.0, 'dt_eval': 0.001\n        },\n        # Case 3\n        {\n            'dx': 0.01, 'nu': 1.0e-6, 'u_mag': 10.0, 'Delta': 0.01,\n            'S0': 80, 'a_s': 0.4, 'f_s': 3.0,\n            'C0': -0.005, 'epsilon': 0.010, 'f_c': 4.0,\n            'T_L': 2.0, 'T_end': 1.0, 'dt_eval': 0.001\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        before, after = compute_stability(case)\n        all_results.extend([before, after])\n\n    # Format the final output string with rounding to 6 decimal places.\n    print(f\"[{','.join(f'{x:.6f}' for x in all_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "确保复杂多物理场代码的正确性是一项艰巨的任务。人造解方法（Method of Manufactured Solutions, MMS）是一种严谨的验证技术，它通过预设一个精确解，来测试代码复现该解的能力。这个高级实践  应用MMS来验证一个流固耦合界面格式的能量守恒特性。通过计算离散能量漂移，你将能定量评估耦合界面上不同的数值积分格式如何影响全局能量平衡，这对于耦合模拟的长期稳定性和准确性至关重要。",
            "id": "3509286",
            "problem": "设计并实现一个自包含的验证程序，该程序使用人工解方法，对一维可压缩流固耦合（FSI）模型的大涡模拟（LES）中的能量守恒界面处理进行验证。目标是针对两种界面求积格式和多组参数集，计算单个时间步内的离散能量漂移。所有量均为无量纲，所有角度均以弧度为单位。\n\n耦合系统定义在一个一维流体域 $x \\in [0,1]$ 上，其界面位于 $x=0$ 处，并附着于一个单自由度线性固体（质量-弹簧-阻尼器）。使用以下人工场作为流体密度、速度和温度，以及一个运动学上一致的界面位移：\n- 流体场：\n  - $ \\rho(x,t) = \\rho_0 + \\epsilon_\\rho \\cos(2\\pi x)\\,\\sin(\\omega t) $,\n  - $ u(x,t) = U_0 \\cos(2\\pi x + \\psi)\\,\\cos(\\omega t) $,\n  - $ T(x,t) = T_0 + \\epsilon_T \\cos(2\\pi x)\\,\\sin(\\omega t + \\phi_T) $.\n- 界面位移和速度（与流体强制保持运动学连续性）：\n  - $ \\eta(t) = \\dfrac{U_0 \\cos(\\psi)}{\\omega} \\sin(\\omega t) $,\n  - $ v_I(t) = \\dot{\\eta}(t) = U_0 \\cos(\\psi)\\,\\cos(\\omega t) $.\n\n假设气体为量热完全气体，比热比为 $ \\gamma $，气体常数经选择以满足 $ p(x,t) = (\\gamma - 1)\\,\\rho(x,t)\\,T(x,t) $，单位质量的比内能为 $ e(x,t) = T(x,t) $。总流体能量为\n$$ E_f(t) = \\int_0^1 \\rho(x,t)\\,\\left(T(x,t) + \\tfrac{1}{2} u(x,t)^2\\right)\\,dx. $$\n固体质量为 $ m $，线性刚度为 $ k_s $，线性粘性阻尼为 $ c $。其总能量为\n$$ E_s(t) = \\tfrac{1}{2} m\\,v_I(t)^2 + \\tfrac{1}{2} k_s\\,\\eta(t)^2. $$\n\n在界面 $x=0$ 处，定义传递到固体的流体法向牵引力为\n$$ \\tau(t) = -p(0,t) + 2\\,\\mu_{\\text{eff}}(t)\\,\\partial_x u(0,t), $$\n其中有效粘度 $ \\mu_{\\text{eff}}(t) = \\mu + \\mu_t(t) $，$ \\mu $ 是分子粘度，$ \\mu_t(t) $ 是来自 Smagorinsky 模型的亚网格尺度涡粘度\n$$ \\mu_t(t) = \\rho(0,t)\\,\\left(C_s\\,\\Delta\\right)^2\\,\\left|\\partial_x u(0,t)\\right|. $$\n这里 $ C_s $ 是 Smagorinsky 常数，$ \\Delta $ 是 LES 滤波长度。使用来自人工解 $ u(x,t) $ 的 $ \\partial_x u(0,t) $。\n\n定义复合能量 $ E_{\\text{tot}}(t) = E_f(t) + E_s(t) $ 及其精确时间导数 $ \\dfrac{d}{dt} E_{\\text{tot}}(t) $，通过对人工场求导得到。定义连续介质源项\n$$ S_{\\text{tot}}(t) = \\dfrac{d}{dt} E_{\\text{tot}}(t) - \\tau(t)\\,v_I(t), $$\n它表示对复合能量速率的所有非界面贡献（包括人工解所需的体积强迫项和通过 $ E_s'(t) $ 建模的内部固体阻尼）。在大小为 $ \\Delta t $ 的单个时间步 $ [t^n, t^{n+1}] $ 内，为给定的求积选择定义离散能量漂移为\n$$ \\delta = \\left(E_{\\text{tot}}(t^{n+1}) - E_{\\text{tot}}(t^n)\\right) - \\Delta t \\left[ \\mathcal{Q}\\{\\tau\\,v_I\\} + \\mathcal{Q}\\{S_{\\text{tot}}\\} \\right], $$\n其中 $ \\mathcal{Q}\\{\\cdot\\} $ 表示在 $ [t^n,t^{n+1}] $ 上应用的所选时间求积。\n\n必须考虑两种界面求积格式：\n- 能量守恒中点格式：$ \\mathcal{Q}\\{\\tau\\,v_I\\} = \\tau(t^{n+\\frac{1}{2}})\\,v_I(t^{n+\\frac{1}{2}}) $ 和 $ \\mathcal{Q}\\{S_{\\text{tot}}\\} = S_{\\text{tot}}(t^{n+\\frac{1}{2}}) $，其中 $ t^{n+\\frac{1}{2}} = \\tfrac{1}{2}(t^n + t^{n+1}) $。\n- 能量不守恒滞后乘积：$ \\mathcal{Q}\\{\\tau\\,v_I\\} = \\tau(t^n)\\,v_I(t^{n+1}) $，同时仍取 $ \\mathcal{Q}\\{S_{\\text{tot}}\\} = S_{\\text{tot}}(t^{n+\\frac{1}{2}}) $。\n\n实现一个程序，该程序：\n- 使用在 $ x \\in [0,1] $ 上足够精细的均匀网格，通过空间数值求积计算 $ E_f(t) $ 和 $ \\dfrac{d}{dt}E_f(t) $，并根据人工解 $ \\eta(t) $ 和 $ v_I(t) $ 解析计算 $ E_s(t) $ 和 $ \\dfrac{d}{dt}E_s(t) $。\n- 使用上述定义的 LES 有效粘度 $ \\mu_{\\text{eff}}(t) $ 计算 $ \\tau(t) $。\n- 使用每种指定的格式为单个时间步计算 $ S_{\\text{tot}}(t) $ 和离散能量漂移 $ \\delta $。\n\n使用固定的参数值（均为无量纲）：\n- $ \\gamma = 1.4 $, $ \\rho_0 = 1.0 $, $ \\epsilon_\\rho = 0.1 $, $ U_0 = 0.5 $, $ \\psi = \\pi/4 $, $ T_0 = 1.0 $, $ \\epsilon_T = 0.07 $, $ \\phi_T = \\pi/3 $, $ \\omega = 3.0 $, $ \\mu = 0.01 $, $ m = 1.0 $, $ k_s = 0.5 $, $ c = 0.02 $，空间波数 $ 2\\pi $，域长度 $ 1.0 $，界面面积 $ 1.0 $。初始时间固定为 $ t^n = 0.37 $。\n\n提供一个测试套件，包含以下参数集，用于单个时间步 $ \\Delta t $、Smagorinsky 常数 $ C_s $、滤波长度 $ \\Delta $ 和格式标识符，严格按照此顺序：\n- 情况 1（理想情况）：$ (\\Delta t, C_s, \\Delta, \\text{scheme}) = (0.01, 0.1, 0.1, \\text{\"consistent\"}) $。\n- 情况 2（对照）：$ (\\Delta t, C_s, \\Delta, \\text{scheme}) = (0.01, 0.1, 0.1, \\text{\"inconsistent\"}) $。\n- 情况 3（加密）：$ (\\Delta t, C_s, \\Delta, \\text{scheme}) = (0.005, 0.1, 0.1, \\text{\"consistent\"}) $。\n- 情况 4（边界，无亚网格）：$ (\\Delta t, C_s, \\Delta, \\text{scheme}) = (0.01, 0.0, 0.1, \\text{\"consistent\"}) $。\n- 情况 5（高亚网格）：$ (\\Delta t, C_s, \\Delta, \\text{scheme}) = (0.02, 0.25, 0.2, \\text{\"consistent\"}) $。\n- 情况 6（大步长，不守恒）：$ (\\Delta t, C_s, \\Delta, \\text{scheme}) = (0.05, 0.1, 0.1, \\text{\"inconsistent\"}) $。\n\n您的程序必须输出单行，其中包含一个包含 6 个浮点值的列表，这些值等于每种情况下离散能量漂移的绝对值 $ |\\delta| $，按相同顺序列出，并以方括号括起来的逗号分隔列表形式打印。例如，输出格式必须为 $ [r_1,r_2,r_3,r_4,r_5,r_6] $，其中每个 $ r_i $ 都是一个浮点数。\n\n所有计算必须以无量纲单位进行，所有角度均以弧度为单位。不允许外部输入；程序必须是完全自包含且确定性的。确保数值空间积分的分辨率足够高，以避免相对于指定的人工场产生混叠误差。",
            "solution": "我们使用人工解方法为多物理场耦合系统构建一个可验证的能量漂移度量，确保科学真实性和基于原理的推导。其基础是可压缩流体和线性弹性固体的能量守恒，以及能量守恒的界面功离散化的定义。该算法计算指定求积格式和参数下的离散能量漂移，而不求解控制方程；相反，它直接评估人工场。\n\n步骤 1：基本能量恒等式和人工场。\n- 对于流体，比内能为 $ e(x,t) = T(x,t) $，压力为 $ p(x,t) = (\\gamma - 1)\\,\\rho(x,t)\\,T(x,t) $，单位体积总能量密度（无量纲）为 $ \\rho(x,t)\\left(e(x,t) + \\tfrac{1}{2}u(x,t)^2\\right) = \\rho(x,t)\\left(T(x,t) + \\tfrac{1}{2}u(x,t)^2\\right) $。因此，总流体能量为\n$$ E_f(t) = \\int_{0}^{1} \\rho(x,t)\\left(T(x,t) + \\tfrac{1}{2}u(x,t)^2\\right)\\,dx. $$\n- 固体是一个单自由度质量-弹簧-阻尼系统，质量为 $ m $，刚度为 $ k_s $，粘性阻尼为 $ c $，其运动学受界面约束。固体能量为\n$$ E_s(t) = \\tfrac{1}{2}m\\,v_I(t)^2 + \\tfrac{1}{2}k_s\\,\\eta(t)^2, $$\n其中 $ v_I(t) = \\dot{\\eta}(t) $。\n\n- 人工场被规定为光滑的三角函数：\n  - $ \\rho(x,t) = \\rho_0 + \\epsilon_\\rho \\cos(2\\pi x)\\,\\sin(\\omega t) $,\n  - $ u(x,t) = U_0 \\cos(2\\pi x + \\psi)\\,\\cos(\\omega t) $,\n  - $ T(x,t) = T_0 + \\epsilon_T \\cos(2\\pi x)\\,\\sin(\\omega t + \\phi_T) $。\n  这些场足够光滑且具有周期性，使得在空间上能够进行高阶数值积分。\n\n- 界面运动学通过设置 $ \\eta(t) = \\dfrac{U_0 \\cos(\\psi)}{\\omega}\\sin(\\omega t) $ 来强制执行，从而得到 $ v_I(t) = U_0 \\cos(\\psi)\\cos(\\omega t) $。这确保了运动学连续性 $ u(0,t) = v_I(t) $，因为 $ u(0,t) = U_0 \\cos(\\psi)\\cos(\\omega t) $。\n\n步骤 2：包含大涡模拟封闭模型的界面牵引力。\n- 法向牵引力（指向固体为正）被建模为一维可压缩法向应力\n$$ \\tau(t) = -p(0,t) + 2\\,\\mu_{\\text{eff}}(t)\\,\\partial_x u(0,t), $$\n其中 $ \\mu_{\\text{eff}}(t) = \\mu + \\mu_t(t) $，而 Smagorinsky 涡粘度为\n$$ \\mu_t(t) = \\rho(0,t)\\,(C_s \\Delta)^2\\,\\left|\\partial_x u(0,t)\\right|. $$\n- 使用人工速度，有 $ \\partial_x u(x,t) = -2\\pi U_0 \\sin(2\\pi x + \\psi)\\,\\cos(\\omega t) $，因此 $ \\partial_x u(0,t) = -2\\pi U_0 \\sin(\\psi)\\,\\cos(\\omega t) $。界面压力为 $ p(0,t) = (\\gamma-1)\\,\\rho(0,t)\\,T(0,t) $，其中 $ \\rho(0,t) = \\rho_0 + \\epsilon_\\rho \\sin(\\omega t) $ 和 $ T(0,t) = T_0 + \\epsilon_T \\sin(\\omega t + \\phi_T) $。\n\n步骤 3：复合能量速率和源项分解。\n- 复合能量为 $ E_{\\text{tot}}(t) = E_f(t) + E_s(t) $。其时间导数为\n$$ \\dfrac{d}{dt}E_{\\text{tot}}(t) = \\dfrac{d}{dt}E_f(t) + \\dfrac{d}{dt}E_s(t). $$\n- 对于流体，使用链式法则在积分号下求导：\n$$ \\dfrac{d}{dt}\\left[\\rho\\left(T + \\tfrac{1}{2}u^2\\right)\\right] = \\dot{\\rho}\\left(T + \\tfrac{1}{2}u^2\\right) + \\rho\\left(\\dot{T} + u\\,\\dot{u}\\right), $$\n其中上方的点表示 $ \\partial/\\partial t $。每个时间导数都从人工场解析获得：\n  - $ \\dot{\\rho}(x,t) = \\epsilon_\\rho \\cos(2\\pi x)\\,\\omega\\cos(\\omega t) $,\n  - $ \\dot{u}(x,t) = -U_0 \\cos(2\\pi x + \\psi)\\,\\omega\\sin(\\omega t) $,\n  - $ \\dot{T}(x,t) = \\epsilon_T \\cos(2\\pi x)\\,\\omega\\cos(\\omega t + \\phi_T) $。\n因此，\n$$ \\dfrac{d}{dt}E_f(t) = \\int_0^1 \\left[ \\dot{\\rho}\\left(T + \\tfrac{1}{2}u^2\\right) + \\rho\\left(\\dot{T} + u\\,\\dot{u}\\right) \\right] dx. $$\n该积分在空间上使用在 $ x \\in [0,1] $ 上足够精细的均匀网格进行数值计算，以确保三角函数乘积的精确求积。\n\n- 对于固体，\n$$ \\dfrac{d}{dt}E_s(t) = m\\,v_I(t)\\,\\dot{v}_I(t) + k_s\\,\\eta(t)\\,v_I(t), $$\n其中 $ v_I(t) = U_0 \\cos(\\psi)\\cos(\\omega t) $ 和 $ \\dot{v}_I(t) = -U_0 \\cos(\\psi)\\,\\omega \\sin(\\omega t) $。\n\n- 连续介质源项聚合定义为\n$$ S_{\\text{tot}}(t) = \\dfrac{d}{dt}E_{\\text{tot}}(t) - \\tau(t)\\,v_I(t). $$\n根据构造，这精确地强制了连续介质恒等式\n$$ \\dfrac{d}{dt}E_{\\text{tot}}(t) = \\tau(t)\\,v_I(t) + S_{\\text{tot}}(t). $$\n这个 $ S_{\\text{tot}}(t) $ 吸收了人工解所隐含的所有非界面能量贡献（例如，体积强迫项、模型耗散）。其显式评估使用了先前计算的 $ \\dfrac{d}{dt}E_{\\text{tot}}(t) $ 和 $ \\tau(t)\\,v_I(t) $。\n\n步骤 4：单个时间步内的离散能量漂移。\n- 对于大小为 $ \\Delta t $ 的时间步 $ [t^n, t^{n+1}] $，定义离散漂移\n$$ \\delta = \\left(E_{\\text{tot}}(t^{n+1}) - E_{\\text{tot}}(t^n)\\right) - \\Delta t \\left[ \\mathcal{Q}\\{\\tau\\,v_I\\} + \\mathcal{Q}\\{S_{\\text{tot}}\\} \\right]. $$\n- 评估两种求积格式：\n  - 能量守恒中点格式：$ \\mathcal{Q}\\{\\tau\\,v_I\\} = \\tau(t^{n+\\frac{1}{2}})\\,v_I(t^{n+\\frac{1}{2}}) $ 和 $ \\mathcal{Q}\\{S_{\\text{tot}}\\} = S_{\\text{tot}}(t^{n+\\frac{1}{2}}) $，其中 $ t^{n+\\frac{1}{2}} = \\tfrac{1}{2}(t^n + t^{n+1}) $。已知该选择是能量守恒的，因为对于光滑数据，中点法则近似积分的误差为 $ \\mathcal{O}(\\Delta t^3) $。\n  - 能量不守恒滞后乘积：$ \\mathcal{Q}\\{\\tau\\,v_I\\} = \\tau(t^n)\\,v_I(t^{n+1}) $，同时保留 $ \\mathcal{Q}\\{S_{\\text{tot}}\\} = S_{\\text{tot}}(t^{n+\\frac{1}{2}}) $。乘积不匹配通常会引入一个 $ \\mathcal{O}(\\Delta t) $ 的误差，从而产生相对较大的漂移。\n\n步骤 5：算法设计。\n- 固定所有物理和几何参数，以及初始时间 $ t^n = 0.37 $。\n- 对于每个指定 $ (\\Delta t, C_s, \\Delta, \\text{scheme}) $ 的测试用例：\n  - 计算 $ t^{n+1} = t^n + \\Delta t $ 和 $ t^{n+\\frac{1}{2}} $。\n  - 通过在 $ x \\in [0,1] $ 上使用高分辨率网格对 $ \\rho(T + \\tfrac{1}{2}u^2) $ 进行空间求积，计算 $ E_f(t^n) $ 和 $ E_f(t^{n+1}) $。\n  - 通过对时间导数被积函数进行空间求积，使用人工时间导数，在 $ t^{n+\\frac{1}{2}} $ 时刻计算 $ \\dfrac{d}{dt}E_f(t) $。\n  - 从人工解 $ \\eta(t) $ 和 $ v_I(t) $ 解析计算 $ E_s(t^n) $、$ E_s(t^{n+1}) $ 和 $ \\dfrac{d}{dt}E_s(t^{n+\\frac{1}{2}}) $。\n  - 组装 $ \\dfrac{d}{dt}E_{\\text{tot}}(t^{n+\\frac{1}{2}}) = \\dfrac{d}{dt}E_f(t^{n+\\frac{1}{2}}) + \\dfrac{d}{dt}E_s(t^{n+\\frac{1}{2}}) $。\n  - 在 $ t^n $、$ t^{n+1} $ 和 $ t^{n+\\frac{1}{2}} $ 时刻评估界面量 $ \\rho(0,t) $、$ T(0,t) $、$ \\partial_x u(0,t) $、$ p(0,t) $、$ \\mu_t(t) $、$ \\mu_{\\text{eff}}(t) $，从而得到 $ \\tau(t) $。\n  - 形成 $ S_{\\text{tot}}(t^{n+\\frac{1}{2}}) = \\dfrac{d}{dt}E_{\\text{tot}}(t^{n+\\frac{1}{2}}) - \\tau(t^{n+\\frac{1}{2}})\\,v_I(t^{n+\\frac{1}{2}}) $。\n  - 使用上述定义的守恒或不守恒求积规则计算漂移 $ \\delta $。\n  - 报告绝对值 $ |\\delta| $。\n\n步骤 6：测试套件和预期行为。\n- 六个指定的用例按以下方式改变 $ \\Delta t $、$ C_s $ 和 $ \\Delta $（按顺序）：$ (0.01,0.1,0.1,\\text{\"consistent\"}) $、$ (0.01,0.1,0.1,\\text{\"inconsistent\"}) $、$ (0.005,0.1,0.1,\\text{\"consistent\"}) $、$ (0.01,0.0,0.1,\\text{\"consistent\"}) $、$ (0.02,0.25,0.2,\\text{\"consistent\"}) $、$ (0.05,0.1,0.1,\\text{\"inconsistent\"}) $。\n- 能量守恒的中点格式用例应产生显著更小的漂移，并表现出近似 $ \\mathcal{O}(\\Delta t^3) $ 的依赖性，当 $ \\Delta t $ 减半时，$ |\\delta| $ 的显著减少将证明这一点。能量不守恒的用例应显示出大得多的漂移，大约与 $ \\mathcal{O}(\\Delta t) $ 成比例。\n- 改变 $ C_s $ 和 $ \\Delta $ 会改变 $ \\mu_t(t) $，从而改变界面牵引力大小 $ \\tau(t) $，这会成比例地影响绝对界面功率，并因此影响由不匹配求积产生的任何漂移的大小。\n\n程序必须输出单行，其中包含六个用例的绝对漂移值列表 $ [r_1,r_2,r_3,r_4,r_5,r_6] $。所有计算都是无量纲的，角度以弧度为单位。不允许外部输入，程序必须是自包含的。",
            "answer": "```python\nimport numpy as np\n\n# All computations are nondimensional; angles in radians.\n\ndef manufactured_fields_params():\n    gamma = 1.4\n    rho0 = 1.0\n    eps_rho = 0.1\n    U0 = 0.5\n    psi = np.pi / 4.0\n    T0 = 1.0\n    eps_T = 0.07\n    phi_T = np.pi / 3.0\n    omega = 3.0\n    mu = 0.01\n    m = 1.0\n    k_s = 0.5\n    c_damp = 0.02  # damping is part of the solid model, but energy balance is via E_s' and tau*v + S_tot\n    L = 1.0\n    k_wave = 2.0 * np.pi  # spatial wave number\n    return {\n        \"gamma\": gamma, \"rho0\": rho0, \"eps_rho\": eps_rho, \"U0\": U0, \"psi\": psi,\n        \"T0\": T0, \"eps_T\": eps_T, \"phi_T\": phi_T, \"omega\": omega, \"mu\": mu,\n        \"m\": m, \"k_s\": k_s, \"c\": c_damp, \"L\": L, \"k_wave\": k_wave\n    }\n\ndef rho_xt(x, t, pars):\n    return pars[\"rho0\"] + pars[\"eps_rho\"] * np.cos(pars[\"k_wave\"] * x) * np.sin(pars[\"omega\"] * t)\n\ndef u_xt(x, t, pars):\n    return pars[\"U0\"] * np.cos(pars[\"k_wave\"] * x + pars[\"psi\"]) * np.cos(pars[\"omega\"] * t)\n\ndef T_xt(x, t, pars):\n    return pars[\"T0\"] + pars[\"eps_T\"] * np.cos(pars[\"k_wave\"] * x) * np.sin(pars[\"omega\"] * t + pars[\"phi_T\"])\n\ndef rho_t_xt(x, t, pars):\n    return pars[\"eps_rho\"] * np.cos(pars[\"k_wave\"] * x) * pars[\"omega\"] * np.cos(pars[\"omega\"] * t)\n\ndef u_t_xt(x, t, pars):\n    return -pars[\"U0\"] * np.cos(pars[\"k_wave\"] * x + pars[\"psi\"]) * pars[\"omega\"] * np.sin(pars[\"omega\"] * t)\n\ndef T_t_xt(x, t, pars):\n    return pars[\"eps_T\"] * np.cos(pars[\"k_wave\"] * x) * pars[\"omega\"] * np.cos(pars[\"omega\"] * t + pars[\"phi_T\"])\n\ndef eta_t(t, pars):\n    # v_I(t) = d eta / dt = U0 cos(psi) cos(omega t)\n    return pars[\"U0\"] * np.cos(pars[\"psi\"]) * np.cos(pars[\"omega\"] * t)\n\ndef eta_xt(t, pars):\n    # eta(t) = (U0 cos(psi) / omega) sin(omega t)\n    return (pars[\"U0\"] * np.cos(pars[\"psi\"]) / pars[\"omega\"]) * np.sin(pars[\"omega\"] * t)\n\ndef eta_tt(t, pars):\n    # d^2 eta / dt^2 = - U0 cos(psi) * omega * sin(omega t)\n    return -pars[\"U0\"] * np.cos(pars[\"psi\"]) * pars[\"omega\"] * np.sin(pars[\"omega\"] * t)\n\ndef dudx_at_interface(t, pars):\n    # du/dx at x=0\n    return -pars[\"k_wave\"] * pars[\"U0\"] * np.sin(pars[\"psi\"]) * np.cos(pars[\"omega\"] * t)\n\ndef p_at_interface(t, pars):\n    rho = rho_xt(0.0, t, pars)\n    T = T_xt(0.0, t, pars)\n    gamma = pars[\"gamma\"]\n    return (gamma - 1.0) * rho * T\n\ndef tau_at_interface(t, pars, Cs, Delta):\n    # Effective viscosity mu_eff = mu + mu_t, mu_t = rho * (Cs * Delta)^2 * |du/dx|\n    rho = rho_xt(0.0, t, pars)\n    dudx = dudx_at_interface(t, pars)\n    mu_t = rho * (Cs * Delta) ** 2 * abs(dudx)\n    mu_eff = pars[\"mu\"] + mu_t\n    return -p_at_interface(t, pars) + 2.0 * mu_eff * dudx\n\ndef v_interface(t, pars):\n    return eta_t(t, pars)\n\ndef Ef(t, pars, Nx=8192):\n    # Spatial quadrature over x in [0,1] using trapezoidal rule\n    x = np.linspace(0.0, 1.0, Nx, endpoint=True)\n    rho = rho_xt(x, t, pars)\n    u = u_xt(x, t, pars)\n    T = T_xt(x, t, pars)\n    integrand = rho * (T + 0.5 * u * u)\n    return np.trapz(integrand, x)\n\ndef Ef_prime(t, pars, Nx=8192):\n    x = np.linspace(0.0, 1.0, Nx, endpoint=True)\n    rho = rho_xt(x, t, pars)\n    u = u_xt(x, t, pars)\n    T = T_xt(x, t, pars)\n    rho_t = rho_t_xt(x, t, pars)\n    u_t = u_t_xt(x, t, pars)\n    T_t = T_t_xt(x, t, pars)\n    integrand_dt = rho_t * (T + 0.5 * u * u) + rho * (T_t + u * u_t)\n    return np.trapz(integrand_dt, x)\n\ndef Es(t, pars):\n    v = eta_t(t, pars)\n    eta = eta_xt(t, pars)\n    return 0.5 * pars[\"m\"] * v * v + 0.5 * pars[\"k_s\"] * eta * eta\n\ndef Es_prime(t, pars):\n    v = eta_t(t, pars)\n    a = eta_tt(t, pars)\n    eta = eta_xt(t, pars)\n    return pars[\"m\"] * v * a + pars[\"k_s\"] * eta * v\n\ndef E_total(t, pars, Nx=8192):\n    return Ef(t, pars, Nx=Nx) + Es(t, pars)\n\ndef E_total_prime(t, pars, Nx=8192):\n    return Ef_prime(t, pars, Nx=Nx) + Es_prime(t, pars)\n\ndef S_total(t, pars, Cs, Delta, Nx=8192):\n    # S_tot = dE_tot/dt - tau * v_I\n    return E_total_prime(t, pars, Nx=Nx) - tau_at_interface(t, pars, Cs, Delta) * v_interface(t, pars)\n\ndef discrete_energy_drift(dt, Cs, Delta, scheme, t_n, pars, Nx=8192):\n    t_np1 = t_n + dt\n    t_mid = t_n + 0.5 * dt\n    # Exact energy change from manufactured fields via spatial quadrature\n    dE = E_total(t_np1, pars, Nx=Nx) - E_total(t_n, pars, Nx=Nx)\n    # Quadrature for tau*v\n    if scheme == \"consistent\":\n        q_tau_v = tau_at_interface(t_mid, pars, Cs, Delta) * v_interface(t_mid, pars)\n    elif scheme == \"inconsistent\":\n        q_tau_v = tau_at_interface(t_n, pars, Cs, Delta) * v_interface(t_np1, pars)\n    else:\n        raise ValueError(\"Unknown scheme\")\n    # Quadrature for S_tot: always midpoint for this study\n    q_S = S_total(t_mid, pars, Cs, Delta, Nx=Nx)\n    drift = dE - dt * (q_tau_v + q_S)\n    return abs(drift)\n\ndef solve():\n    pars = manufactured_fields_params()\n    # Test suite as specified\n    t_n = 0.37\n    test_cases = [\n        (0.01, 0.1, 0.1, \"consistent\"),\n        (0.01, 0.1, 0.1, \"inconsistent\"),\n        (0.005, 0.1, 0.1, \"consistent\"),\n        (0.01, 0.0, 0.1, \"consistent\"),\n        (0.02, 0.25, 0.2, \"consistent\"),\n        (0.05, 0.1, 0.1, \"inconsistent\"),\n    ]\n    # High spatial resolution to accurately integrate trigonometric products\n    Nx = 8192\n    results = []\n    for dt, Cs, Delta, scheme in test_cases:\n        drift = discrete_energy_drift(dt, Cs, Delta, scheme, t_n, pars, Nx=Nx)\n        # Format as scientific string with sufficient significant figures\n        results.append(np.format_float_scientific(drift, precision=10, unique=False, exp_digits=2))\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}