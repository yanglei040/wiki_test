{
    "hands_on_practices": [
        {
            "introduction": "The simplest way to tame the spurious oscillations that plague centered-difference schemes in advection-dominated problems is to add a small amount of \"artificial\" numerical diffusion. This foundational exercise guides you through a formal analysis of this technique . By analyzing the discrete operator, you will determine the minimum artificial diffusion needed to enforce a crucial stability property—the discrete maximum principle—and then use a modified equation analysis to quantify the impact of this stabilization on the accuracy of the scheme.",
            "id": "3526604",
            "problem": "Consider a scalar, steady, one-dimensional advection-diffusion model for a transported quantity in a multiphysics coupled simulation, governed on a uniform grid by the partial differential equation $a \\, \\frac{d u}{d x} - \\kappa \\, \\frac{d^{2} u}{d x^{2}} = s(x)$ with constant advection velocity $a \\in \\mathbb{R}$, molecular diffusion $\\kappa \\ge 0$, and smooth source $s(x)$. Let the domain be discretized with uniform grid spacing $h>0$. Using a centered finite-difference approximation for both the first and second derivatives on interior nodes and augmenting the molecular diffusion by an artificial diffusion $\\nu \\ge 0$, the discrete operator acting on the nodal values $\\{u_{i}\\}$ is obtained by replacing $\\frac{d u}{d x}$ with $(u_{i+1}-u_{i-1})/(2h)$ and $\\frac{d^{2} u}{d x^{2}}$ with $(u_{i+1}-2u_{i}+u_{i-1})/h^{2}$, but with total diffusion $\\kappa+\\nu$ in the discrete diffusive term.\n\nStarting from a Taylor-series truncation error expansion about a generic interior node to form the modified equation of this discrete scheme, and invoking the standard discrete maximum principle for linear scalar problems (namely, that the coefficient matrix is an $M$-matrix with nonpositive off-diagonals and nonnegative row sums for interior nodes), derive:\n\n1. The minimal artificial diffusion $\\nu_{\\min}$, expressed in terms of $a$, $\\kappa$, and $h$, required so that the centered scheme satisfies the discrete maximum principle for all interior nodes.\n\n2. The leading-order error term induced by this stabilization in the modified equation, expressed as a single coefficient $C_{\\text{lead}}$ multiplying $\\frac{d^{2} u}{d x^{2}}$.\n\nProvide your final answer as a row matrix containing $\\nu_{\\min}$ and $C_{\\text{lead}}$ in closed form. No numerical evaluation is required. If you introduce any intermediate symbols, eliminate them in the final expressions. Do not include physical units in the final answer. Round nothing; exact expressions are required.",
            "solution": "The user wants me to analyze a finite-difference scheme for the one-dimensional steady advection-diffusion equation.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   **Governing Equation**: $a \\, \\frac{d u}{d x} - \\kappa \\, \\frac{d^{2} u}{d x^{2}} = s(x)$\n-   **Parameters**: Constant advection velocity $a \\in \\mathbb{R}$, molecular diffusion $\\kappa \\ge 0$, uniform grid spacing $h > 0$.\n-   **Discretization Scheme**:\n    -   The term $\\frac{d u}{d x}$ is approximated by the centered difference $\\frac{u_{i+1}-u_{i-1}}{2h}$.\n    -   The term $\\frac{d^{2} u}{d x^{2}}$ is approximated by the centered difference $\\frac{u_{i+1}-2u_{i}+u_{i-1}}{h^{2}}$.\n    -   The molecular diffusion $\\kappa$ is augmented by an artificial diffusion $\\nu \\ge 0$, resulting in a total diffusion of $\\kappa+\\nu$ in the discrete diffusive term.\n-   **Condition**: The discrete scheme must satisfy the discrete maximum principle (DMP). This is stated to be equivalent to the coefficient matrix being an $M$-matrix, which requires nonpositive off-diagonal elements and nonnegative row sums for interior nodes.\n-   **Tasks**:\n    1.  Derive the minimal artificial diffusion $\\nu_{\\min}$ required to satisfy the DMP.\n    2.  Derive the coefficient $C_{\\text{lead}}$ of the leading-order error term proportional to $\\frac{d^{2} u}{d x^{2}}$ in the modified equation for the stabilized scheme.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is a classic exercise in the numerical analysis of partial differential equations, specifically within computational fluid dynamics. The advection-diffusion equation, finite difference methods, artificial diffusion, the discrete maximum principle, M-matrices, and modified equation analysis are all standard, well-established concepts. The problem is firmly grounded in mathematics and computational science.\n-   **Well-Posedness**: The problem is well-posed. It provides a clear set of rules and a concrete mathematical structure, from which two specific quantities, $\\nu_{\\min}$ and $C_{\\text{lead}}$, are to be derived. The path to the solution is unique and non-ambiguous.\n-   **Objectivity**: The problem is stated in precise, objective mathematical language. There are no subjective or opinion-based components.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is scientifically sound, well-posed, and objective. I will proceed with the solution.\n\n### Derivation\n\nThe analysis proceeds in two parts as requested: first, the derivation of the minimal artificial diffusion $\\nu_{\\min}$, and second, the derivation of the leading-order error coefficient $C_{\\text{lead}}$.\n\n#### Part 1: Derivation of Minimal Artificial Diffusion ($\\nu_{\\min}$)\n\nFirst, we construct the discrete equation at an interior grid node $x_i$. The given PDE is:\n$$a \\frac{d u}{d x} - \\kappa \\frac{d^{2} u}{d x^{2}} = s(x)$$\nApplying the specified finite difference approximations with total diffusion $\\kappa + \\nu$, we get the discrete equation for the nodal value $u_i = u(x_i)$:\n$$a \\left( \\frac{u_{i+1} - u_{i-1}}{2h} \\right) - (\\kappa + \\nu) \\left( \\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} \\right) = s_i$$\nwhere $s_i = s(x_i)$. To analyze the properties of the coefficient matrix, we rearrange this equation to group terms by $u_{i-1}$, $u_i$, and $u_{i+1}$:\n$$\\left( -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) u_{i-1} + \\left( \\frac{2(\\kappa+\\nu)}{h^2} \\right) u_i + \\left( \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) u_{i+1} = s_i$$\nThis is an equation of the form $A_{i,i-1}u_{i-1} + A_{i,i}u_i + A_{i,i+1}u_{i+1} = s_i$, where the coefficients of the matrix row corresponding to node $i$ are:\n-   Off-diagonal coefficient for $u_{i-1}$: $A_{i,i-1} = -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2}$\n-   Diagonal coefficient for $u_{i}$: $A_{i,i} = \\frac{2(\\kappa+\\nu)}{h^2}$\n-   Off-diagonal coefficient for $u_{i+1}$: $A_{i,i+1} = \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2}$\n\nThe problem states that the discrete maximum principle (DMP) is satisfied if the coefficient matrix is an $M$-matrix. For this tridiagonal system, this imposes the following conditions on the coefficients for any interior row $i$:\n1.  Nonpositive off-diagonals: $A_{i,i-1} \\le 0$ and $A_{i,i+1} \\le 0$.\n2.  Nonnegative row sums: $A_{i,i-1} + A_{i,i} + A_{i,i+1} \\ge 0$.\n\nLet's check the row sum condition first:\n$$A_{i,i-1} + A_{i,i} + A_{i,i+1} = \\left( -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) + \\left( \\frac{2(\\kappa+\\nu)}{h^2} \\right) + \\left( \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) = 0$$\nSince the row sum is $0$, the condition of being nonnegative is satisfied.\n\nNow, we enforce the nonpositive off-diagonal conditions:\n-   For $A_{i,i-1} \\le 0$:\n$$-\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\le 0 \\implies -\\frac{a}{2h} \\le \\frac{\\kappa+\\nu}{h^2} \\implies \\kappa+\\nu \\ge -\\frac{ah}{2}$$\n-   For $A_{i,i+1} \\le 0$:\n$$\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\le 0 \\implies \\frac{a}{2h} \\le \\frac{\\kappa+\\nu}{h^2} \\implies \\kappa+\\nu \\ge \\frac{ah}{2}$$\nTo satisfy both inequalities simultaneously for any $a \\in \\mathbb{R}$, the total diffusion must be greater than or equal to the maximum of the two right-hand side values:\n$$\\kappa+\\nu \\ge \\max\\left(\\frac{ah}{2}, -\\frac{ah}{2}\\right)$$\nThis simplifies using the absolute value:\n$$\\kappa+\\nu \\ge \\frac{|a|h}{2}$$\nFrom this inequality, we can determine the required artificial diffusion $\\nu$:\n$$\\nu \\ge \\frac{|a|h}{2} - \\kappa$$\nThe problem asks for the *minimal* artificial diffusion $\\nu_{\\min}$, and we are given that $\\nu \\ge 0$. Therefore, the minimal value for $\\nu$ must be the larger of $0$ and the value required by the DMP condition.\n$$\\nu_{\\min} = \\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\nThis ensures that the DMP is satisfied with the smallest possible non-negative addition to the diffusion.\n\n#### Part 2: Derivation of the Leading-Order Error Coefficient ($C_{\\text{lead}}$)\n\nTo find the coefficient of the leading error term, we derive the modified equation by performing a Taylor-series expansion of the discrete operator around the point $x_i$. Let $u$ and its derivatives $u'$, $u''$, etc., denote the function values at $x_i$.\nThe Taylor expansions for $u_{i\\pm1} = u(x_i \\pm h)$ are:\n$$u_{i+1} = u + hu' + \\frac{h^2}{2}u'' + \\frac{h^3}{6}u''' + O(h^4)$$\n$$u_{i-1} = u - hu' + \\frac{h^2}{2}u'' - \\frac{h^3}{6}u''' + O(h^4)$$\nWe expand the discrete derivative approximations:\n-   Advection term:\n$$\\frac{u_{i+1} - u_{i-1}}{2h} = \\frac{(u+hu'+\\frac{h^2}{2}u''+\\frac{h^3}{6}u'''+\\dots) - (u-hu'+\\frac{h^2}{2}u''-\\frac{h^3}{6}u'''+\\dots)}{2h} = \\frac{2hu' + \\frac{h^3}{3}u''' + \\dots}{2h} = u' + \\frac{h^2}{6}u''' + O(h^4)$$\n-   Diffusion term:\n$$\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} = \\frac{(u+hu'+\\frac{h^2}{2}u''+\\dots) - 2u + (u-hu'+\\frac{h^2}{2}u''+\\dots)}{h^2} = \\frac{h^2u'' + \\frac{h^4}{12}u'''' + \\dots}{h^2} = u'' + \\frac{h^2}{12}u'''' + O(h^4)$$\nThe discrete operator $L_h$ acting on the exact solution $u$ is:\n$$L_h u = a\\left(u' + \\frac{h^2}{6}u''' + O(h^4)\\right) - (\\kappa+\\nu)\\left(u'' + \\frac{h^2}{12}u'''' + O(h^4)\\right)$$\n$$L_h u = a u' - (\\kappa+\\nu)u'' + \\frac{ah^2}{6}u''' - \\frac{(\\kappa+\\nu)h^2}{12}u'''' + \\dots$$\nThe original continuous operator is $L u = a u' - \\kappa u''$. The truncation error $\\tau$ is the difference $\\tau = L_h u - L u$:\n$$\\tau = (a u' - (\\kappa+\\nu)u'' + \\dots) - (a u' - \\kappa u'')$$\n$$\\tau = -\\nu u'' + \\frac{ah^2}{6}u''' - \\frac{(\\kappa+\\nu)h^2}{12}u'''' + \\dots$$\nThe problem asks for the coefficient $C_{\\text{lead}}$ of the leading-order error term that is proportional to $\\frac{d^{2} u}{d x^{2}}$ (i.e., $u''$). The leading-order error is the term in the expansion of $\\tau$ with the lowest power of $h$. We must substitute $\\nu = \\nu_{\\min}$ to analyze the stabilized scheme.\n$$\\nu_{\\min} = \\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\nThere are two cases:\n1.  **Diffusion-dominated case**: $\\frac{|a|h}{2} \\le \\kappa$. Here, $\\nu_{\\min} = 0$. The truncation error becomes:\n    $$\\tau = \\frac{ah^2}{6}u''' - \\frac{\\kappa h^2}{12}u'''' + O(h^4)$$\n    The leading error is $O(h^2)$ and does not contain a $u''$ term. Thus, the coefficient of $u''$ in the leading error is $C_{\\text{lead}} = 0$.\n2.  **Advection-dominated case**: $\\frac{|a|h}{2} > \\kappa$. Here, $\\nu_{\\min} = \\frac{|a|h}{2} - \\kappa$. This value is of order $O(h)$. The truncation error is:\n    $$\\tau = -\\left(\\frac{|a|h}{2} - \\kappa\\right)u'' + \\frac{ah^2}{6}u''' - \\dots$$\n    The term $-\\nu_{\\min}u''$ is of order $O(h)$, while the next term is $O(h^2)$. Thus, $-\\nu_{\\min}u''$ is the leading error term. This term is proportional to $u''$, and its coefficient is $C_{\\text{lead}} = -\\nu_{\\min}$.\n\nCombining both cases, the coefficient of the leading-order error term proportional to $u''$ is given by $C_{\\text{lead}} = -\\nu_{\\min}$.\n$$C_{\\text{lead}} = -\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\nThis expression correctly evaluates to $0$ in the diffusion-dominated case and to $-(\\frac{|a|h}{2} - \\kappa)$ in the advection-dominated case.\n\nThe final answers are the expressions for $\\nu_{\\min}$ and $C_{\\text{lead}}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right) & -\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While uniform artificial diffusion can stabilize a scheme, it often adds excessive smearing. The Streamline-Upwind Petrov-Galerkin (SUPG) method provides a more sophisticated approach by adding stabilization only along the \"streamlines\" where instabilities originate. This practice  challenges you to derive the SUPG-stabilized element stiffness matrix from its weak form, providing a concrete look at how the method works at the element level and how it can be interpreted as a physically-motivated \"balancing diffusion.\"",
            "id": "3526619",
            "problem": "Consider the steady one-dimensional advection-diffusion equation for a scalar field $c(x)$ on a uniform mesh of linear ($P_1$) finite elements of size $h$ with constant coefficients,\n$$-k\\,\\frac{d^2 c}{dx^2} + u\\,\\frac{d c}{dx} = f,$$\nwhere $k > 0$ is the diffusivity, $u \\in \\mathbb{R}$ is the constant advection velocity, and $f$ is a source term. Let $N_1(x)$ and $N_2(x)$ be the usual linear shape functions on a single element $e = [x_1, x_2]$, with $x_2 - x_1 = h$, and assume $f$ is sufficiently regular such that standard weak forms apply. Using the Galerkin weak form in which the diffusion term is integrated by parts and the advection term is left in its conservative first-derivative form, the Streamline-Upwind Petrov-Galerkin (SUPG) stabilized weak form augments the test function $w$ by a streamline term and reads on each element\n$$\\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u\\,w'\\,\\big(-k\\,c'' + u\\,c' - f\\big)\\,dx = \\int_{e} w\\,f\\,dx,$$\nwhere $\\tau \\ge 0$ is the stabilization parameter and the primes denote derivatives with respect to $x$. For $P_1$ elements, the second derivative of $c$ vanishes almost everywhere on $e$, so that the SUPG term simplifies accordingly. Let the element Peclet number be $Pe_e = |u|\\,h/(2k)$.\n\nDerive, from first principles, the $2 \\times 2$ SUPG-stabilized element stiffness matrix $K_e(\\tau)$ that relates the nodal values of $c$ on element $e$. Clearly state any intermediate integral identities you use and express the final matrix in closed form in terms of $k$, $u$, $h$, and $\\tau$. Then, using your closed-form expression, show analytically how the off-diagonal entries depend on $\\tau$ in a way that damps spurious oscillations as $Pe_e$ grows, interpreting the SUPG contribution as an effective diffusion added along the streamline.\n\nYour final answer must be the single symbolic expression for the element stiffness matrix $K_e(\\tau)$ in terms of $k$, $u$, $h$, and $\\tau$. No numerical evaluation or rounding is required.",
            "solution": "The problem is subjected to validation and is found to be scientifically grounded, well-posed, objective, and internally consistent. It represents a standard derivation in the field of computational fluid dynamics and finite element analysis.\n\nWe begin with the provided one-dimensional steady advection-diffusion equation:\n$$ -k\\,\\frac{d^2 c}{dx^2} + u\\,\\frac{d c}{dx} = f $$\nThe Streamline-Upwind Petrov-Galerkin (SUPG) weak form on a single element $e = [x_1, x_2]$ of length $h=x_2-x_1$ is given as:\n$$ \\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u\\,w'\\,\\big(-k\\,c'' + u\\,c' - f\\big)\\,dx = \\int_{e} w\\,f\\,dx $$\nFor linear ($P_1$) finite elements, the approximation of the scalar field $c(x)$ on the element, denoted $c^h(x)$, is a linear polynomial. Consequently, its second derivative $c''$ is zero almost everywhere on the element. The SUPG weak form simplifies to:\n$$ \\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u^2\\,w' c'\\,dx - \\int_{e} \\tau\\,u\\,w' f\\,dx = \\int_{e} w\\,f\\,dx $$\nTo derive the element stiffness matrix $K_e(\\tau)$, we consider the terms on the left-hand side that depend on the unknown field $c$. The terms involving the source function $f$ contribute to the element load vector, not the stiffness matrix. Rearranging the terms, the contribution to the stiffness matrix comes from the expression:\n$$ \\int_{e} (k + \\tau u^2) w' c' \\,dx + \\int_{e} u\\,w c' \\,dx $$\nOn the element $e$, the field $c(x)$ is approximated as $c^h(x) = \\sum_{j=1}^{2} c_j N_j(x)$, where $c_1$ and $c_2$ are the nodal values at $x_1$ and $x_2$ respectively, and $N_1(x)$, $N_2(x)$ are the linear Lagrangian basis functions (shape functions). To construct the $2 \\times 2$ stiffness matrix, we choose the test function $w$ to be each basis function in turn, i.e., $w(x) = N_i(x)$ for $i=1, 2$.\nThe $(i,j)$ entry of the element stiffness matrix, $K_{ij}$, is the coefficient of the nodal value $c_j$ in the $i$-th equation (where $w=N_i$). Thus,\n$$ K_{ij} = \\int_{e} (k + \\tau u^2) N_i'(x) N_j'(x) \\,dx + \\int_{e} u\\,N_i(x) N_j'(x) \\,dx $$\nThe linear shape functions on the element $e = [x_1, x_2]$ are defined as:\n$$ N_1(x) = \\frac{x_2 - x}{h}, \\quad N_2(x) = \\frac{x - x_1}{h} $$\nTheir derivatives with respect to $x$ are constant over the element:\n$$ N_1'(x) = -\\frac{1}{h}, \\quad N_2'(x) = \\frac{1}{h} $$\nWe now compute the two parts of the stiffness matrix: the diffusion-like (symmetric) part and the advection (anti-symmetric) part.\n\nFirst, the diffusion-like term, which includes the standard diffusion and the SUPG contribution. Let's call its matrix representation $K^{\\text{diff\\_supg}}$.\n$$ K^{\\text{diff\\_supg}}_{ij} = \\int_{x_1}^{x_2} (k + \\tau u^2) N_i' N_j' \\,dx $$\nSince the integrand is constant, the integral is simply the integrand multiplied by the element length $h$.\n$$ K^{\\text{diff\\_supg}}_{11} = (k + \\tau u^2) \\left(-\\frac{1}{h}\\right)\\left(-\\frac{1}{h}\\right) h = \\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{12} = (k + \\tau u^2) \\left(-\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) h = -\\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{21} = (k + \\tau u^2) \\left(\\frac{1}{h}\\right)\\left(-\\frac{1}{h}\\right) h = -\\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{22} = (k + \\tau u^2) \\left(\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) h = \\frac{k + \\tau u^2}{h} $$\nThis gives the matrix:\n$$ K^{\\text{diff\\_supg}} = \\frac{k + \\tau u^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\nSecond, the advection term. Let its matrix be $K^{\\text{adv}}$.\n$$ K^{\\text{adv}}_{ij} = \\int_{x_1}^{x_2} u\\,N_i(x) N_j'(x) \\,dx $$\nWe evaluate the necessary integrals:\n$$ \\int_{x_1}^{x_2} N_1(x) \\,dx = \\int_{x_1}^{x_2} \\frac{x_2-x}{h} \\,dx = \\frac{h}{2} $$\n$$ \\int_{x_1}^{x_2} N_2(x) \\,dx = \\int_{x_1}^{x_2} \\frac{x-x_1}{h} \\,dx = \\frac{h}{2} $$\nNow we can compute the entries of $K^{\\text{adv}}$:\n$$ K^{\\text{adv}}_{11} = u \\int_{x_1}^{x_2} N_1(x) N_1'(x) \\,dx = u \\left(-\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_1(x) \\,dx = -\\frac{u}{h} \\frac{h}{2} = -\\frac{u}{2} $$\n$$ K^{\\text{adv}}_{12} = u \\int_{x_1}^{x_2} N_1(x) N_2'(x) \\,dx = u \\left(\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_1(x) \\,dx = \\frac{u}{h} \\frac{h}{2} = \\frac{u}{2} $$\n$$ K^{\\text{adv}}_{21} = u \\int_{x_1}^{x_2} N_2(x) N_1'(x) \\,dx = u \\left(-\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_2(x) \\,dx = -\\frac{u}{h} \\frac{h}{2} = -\\frac{u}{2} $$\n$$ K^{\\text{adv}}_{22} = u \\int_{x_1}^{x_2} N_2(x) N_2'(x) \\,dx = u \\left(\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_2(x) \\,dx = \\frac{u}{h} \\frac{h}{2} = \\frac{u}{2} $$\nThis gives the matrix:\n$$ K^{\\text{adv}} = \\frac{u}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix} $$\nThe total SUPG-stabilized element stiffness matrix $K_e(\\tau)$ is the sum of these two matrices:\n$$ K_e(\\tau) = K^{\\text{diff\\_supg}} + K^{\\text{adv}} = \\frac{k + \\tau u^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} + \\frac{u}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix} $$\nCombining the terms gives the final closed-form expression for the matrix:\n$$ K_e(\\tau) = \\begin{pmatrix} \\frac{k+\\tau u^2}{h} - \\frac{u}{2} & -\\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\\\ -\\frac{k+\\tau u^2}{h} - \\frac{u}{2} & \\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\end{pmatrix} $$\nNext, we analyze how the off-diagonal entries depend on $\\tau$ to damp oscillations. Spurious oscillations in the standard Galerkin method ($\\tau=0$) arise when advection dominates diffusion, i.e., when the element Peclet number $Pe_e = |u|h/(2k)$ is large. This corresponds to a loss of diagonal dominance in the global stiffness matrix. A sufficient condition to avoid these oscillations is for the assembled matrix to be an M-matrix, which requires (among other things) that the off-diagonal entries be non-positive.\nConsider the case $u > 0$. The potential for oscillations arises from the term $K_{12} = -k/h + u/2$. If $u/2 > k/h$, or $uh/(2k) > 1$ (i.e., $Pe_e > 1$), this term becomes positive, violating the M-matrix property. The SUPG-stabilized entry is $K_{12}(\\tau) = -k/h + u/2 - \\tau u^2/h$. The added term $-\\tau u^2/h$ is always non-positive (since $\\tau \\ge 0$). By choosing $\\tau$ appropriately, this term can counteract the positive contribution from advection, ensuring $K_{12}(\\tau) \\le 0$ and thereby damping the oscillations. A similar argument holds for $u < 0$ and the entry $K_{21}(\\tau)$. Thus, the $\\tau$ term adds targeted stability.\n\nFinally, we interpret the SUPG contribution. The stiffness matrix is the sum of the standard Galerkin advection-diffusion matrix (for $\\tau=0$) and a matrix originating from the SUPG term:\n$$ K^{\\text{SUPG}} = \\frac{\\tau u^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\nThis matrix has the exact same form as the standard diffusion matrix, which is $\\frac{k}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$. Therefore, the SUPG method can be interpreted as adding an \"artificial\" or \"balancing\" diffusion of magnitude $k_{\\text{art}} = \\tau u^2$ to the physical diffusion $k$, resulting in an effective diffusion $k_{\\text{eff}} = k + k_{\\text{art}} = k + \\tau u^2$. In multi-dimensional problems, this added diffusion acts specifically along the direction of the flow (the streamline), which is where numerical instability originates. In this 1D case, the streamline is aligned with the x-axis, so the method simply adds diffusion to the model.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{k+\\tau u^2}{h} - \\frac{u}{2} & -\\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\\\ -\\frac{k+\\tau u^2}{h} - \\frac{u}{2} & \\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\end{pmatrix} } $$"
        },
        {
            "introduction": "Real-world multiphysics problems are often non-linear and feature sharp gradients or shocks, which demand more advanced stabilization. This coding practice introduces the powerful entropy viscosity method for the non-linear Burgers' equation, a classic model for shock formation . You will implement an algorithm where the amount of artificial viscosity is not constant but is computed \"on the fly\" based on how well the numerical solution respects a fundamental entropy condition, allowing for sharp shock capturing with minimal diffusion in smooth regions.",
            "id": "3526624",
            "problem": "Consider the one-dimensional viscous Burgers equation in conservative form on a periodic domain with dimensionless variables,\n$$\nc_t + \\left(\\frac{c^2}{2}\\right)_x - \\epsilon\\,c_{xx} = 0,\n$$\nwhere $c(x,t)$ is a scalar field, $\\epsilon > 0$ is a small physical viscosity, and the subscript denotes partial differentiation. In the context of stabilization techniques for advection-dominated problems in multiphysics coupled simulation, the entropy viscosity method introduces an additional, data-driven viscosity field to regularize shocks while preserving accuracy in smooth regions.\n\nStarting only from the fundamental laws and core definitions associated with scalar conservation laws and convex entropy functions, derive an algorithm to:\n- construct an entropy pair $(\\eta(c), q(c))$ for the viscous Burgers equation,\n- obtain a pointwise entropy residual $R_\\eta(x,t)$ that quantifies departure from a smooth entropy balance,\n- define a stabilization viscosity field $\\nu_E(x,t)$ from $R_\\eta(x,t)$ using a physically sensible scaling,\n- evolve the partial differential equation with a total viscosity $\\nu_{\\text{tot}}(x,t) = \\epsilon + \\nu_E(x,t)$ using a conservative explicit finite-difference scheme that respects periodic boundary conditions,\n- and verify numerically that the total entropy $E(t) = \\int_0^1 \\eta(c(x,t))\\,dx$ is nonincreasing in time.\n\nThe computational domain is $x \\in [0,1]$ with periodic boundary conditions. Use the shock-like, piecewise-constant initial condition\n$$\nc(x,0) = \\begin{cases}\nc_L & \\text{if } x < x_s, \\\\\nc_R & \\text{if } x \\ge x_s,\n\\end{cases}\n$$\nwith $c_L = 1$, $c_R = 0$, and $x_s = 0.5$. All quantities are dimensionless.\n\nThe discretization must be second-order accurate in space for smooth solutions, conservative for the advective flux $\\left(\\frac{c^2}{2}\\right)_x$, and must incorporate the stabilization viscosity $\\nu_E(x,t)$ additively with the physical viscosity $\\epsilon$. Choose a time step $\\Delta t$ adaptively to satisfy standard explicit stability constraints for combined advection and diffusion, expressed in terms of the grid spacing $h$, the maximal characteristic speed, and the maximal viscosity.\n\nYour program must implement the full algorithm and produce, for each test case, a boolean indicating whether the numerically computed entropy $E(t)$ is nonincreasing for all times $t \\in [0,T]$ within a small numerical tolerance. Aggregate the results from all test cases into a single line of output containing a comma-separated Python-style list.\n\nUse the following test suite to assess correctness and robustness across regimes:\n- Test case $1$ (happy path): $N_x = 200$ spatial points, final time $T = 0.10$, physical viscosity $\\epsilon = 10^{-3}$, entropy viscosity coefficient $C_e = 0.5$, maximum viscosity cap coefficient $C_{\\max} = 0.5$, advective-diffusive stability factor $\\text{CFL} = 0.20$.\n- Test case $2$ (advection-dominated, very small physical viscosity): $N_x = 200$, $T = 0.10$, $\\epsilon = 10^{-6}$, $C_e = 1.5$, $C_{\\max} = 0.7$, $\\text{CFL} = 0.20$.\n- Test case $3$ (coarse grid edge case): $N_x = 50$, $T = 0.05$, $\\epsilon = 10^{-6}$, $C_e = 1.0$, $C_{\\max} = 1.0$, $\\text{CFL} = 0.20$.\n\nIn each case, verify monotonicity of $E(t)$ by checking that the discrete integral\n$$\nE^n \\approx h \\sum_{i=0}^{N_x-1} \\eta\\!\\left(c_i^n\\right)\n$$\ndoes not increase with time step index $n$, within a small numerical tolerance. Use periodic boundary conditions and ensure that the algorithm computes the stabilization viscosity field $\\nu_E(x,t)$ at every time step from the evolving solution.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[$r_1, r_2, r_3$]\", where each $r_k$ is a boolean for test case $k$ indicating whether $E(t)$ is nonincreasing in time for that case.",
            "solution": "The problem requires the implementation and verification of an entropy viscosity stabilization method for the one-dimensional viscous Burgers' equation. The solution involves deriving and numerically implementing an algorithm based on fundamental principles of scalar conservation laws.\n\n**1. Entropy Pair Construction**\n\nThe viscous Burgers' equation is a scalar conservation law of the form $\\partial_t c + \\partial_x f(c) = \\partial_x (\\epsilon \\partial_x c)$, with the advective flux being $f(c) = c^2/2$. An entropy function, $\\eta(c)$, must be a convex function of the conserved quantity $c$. The associated entropy flux, $q(c)$, is defined by the compatibility relation $q'(c) = \\eta'(c) f'(c)$.\n\nA standard choice for the entropy function is the kinetic energy analogue, $\\eta(c) = c^2/2$. This function is convex, as its second derivative, $\\eta''(c) = 1$, is positive.\nThe derivative of the entropy function is $\\eta'(c) = c$.\nThe derivative of the advective flux is $f'(c) = c$.\n\nSubstituting these into the compatibility relation gives:\n$$\nq'(c) = (c)(c) = c^2\n$$\nIntegrating this expression with respect to $c$ yields the entropy flux:\n$$\nq(c) = \\int c^2 dc = \\frac{c^3}{3}\n$$\nWe choose the integration constant to be zero. Thus, the entropy pair used for this problem is $(\\eta(c), q(c)) = (c^2/2, c^3/3)$.\n\n**2. Numerical Algorithm Design**\n\nThe core of the task is to evolve the PDE using a custom numerical scheme on a uniform grid $x_i = i h$ for $i = 0, \\ldots, N_x-1$, where $h = 1/N_x$. The scheme must be explicit in time and handle periodic boundary conditions. The total viscosity is data-driven, $\\nu_{\\text{tot}}(x,t) = \\epsilon + \\nu_E(x,t)$, where $\\nu_E$ is the entropy viscosity calculated at each time step.\n\n**2.1. Spatial Discretization**\n\nThe semi-discretized equation at grid point $x_i$ is:\n$$\n\\frac{dc_i}{dt} = - \\left. \\frac{\\partial f(c)}{\\partial x} \\right|_i + \\left. \\frac{\\partial}{\\partial x}\\left(\\nu_{\\text{tot}} \\frac{\\partial c}{\\partial x}\\right) \\right|_i\n$$\n-   **Advection Term**: As required, we use a conservative, second-order central difference scheme for the advective flux derivative:\n    $$\n    \\left. \\frac{\\partial f(c)}{\\partial x} \\right|_i \\approx \\frac{f(c_{i+1}) - f(c_{i-1})}{2h}\n    $$\n-   **Diffusion Term**: For the variable-coefficient diffusion term, a standard second-order conservative discretization is employed. The diffusive flux at the staggered grid point $x_{i+1/2}$ is approximated as $J_{i+1/2} \\approx \\frac{\\nu_{\\text{tot},i} + \\nu_{\\text{tot},i+1}}{2} \\frac{c_{i+1}-c_i}{h}$. The divergence of this flux at grid point $x_i$ is then:\n    $$\n    \\left. \\frac{\\partial J}{\\partial x} \\right|_i \\approx \\frac{J_{i+1/2} - J_{i-1/2}}{h}\n    $$\n\n**2.2. Entropy Viscosity Calculation**\n\nAt each time step $n$, given the solution $c^n$, the entropy viscosity field $\\nu_E^n$ is computed.\n\n-   **Entropy Residual ($R_\\eta$)**: The residual measures the local violation of the entropy conservation equation, $\\eta_t + q_x = 0$, by the non-dissipative part of the numerical scheme. We approximate $\\eta_t \\approx \\eta'(c) c_t$ and use the semi-discrete inviscid ODE, $c_t \\approx -f(c)_x$, to define the residual based on the current state $c^n$:\n    $$\n    R_{\\eta,i} = \\left| \\eta'(c_i) \\left( -\\frac{f_{i+1} - f_{i-1}}{2h} \\right) + \\left( \\frac{q_{i+1} - q_{i-1}}{2h} \\right) \\right|\n    $$\n    where $f_i = f(c_i)$ and $q_i = q(c_i)$.\n\n-   **Stabilization Viscosity ($\\nu_E$)**: The residual is scaled to define the viscosity. The scaling involves the grid spacing squared and is normalized by the local entropy variation to ensure correct physical units and localization.\n    $$\n    \\nu_{E,i} = C_e h^2 \\frac{ |R_{\\eta,i}| }{ |\\eta_{i+1} - \\eta_i| + |\\eta_{i-1} - \\eta_i| + \\delta }\n    $$\n    where $C_e$ is a specified coefficient, and $\\delta$ is a small number (e.g., $10^{-12}$) to prevent division by zero.\n\n-   **Viscosity Cap**: An upper bound is applied to $\\nu_E$ to prevent it from becoming excessively large, which could impose prohibitively small time steps. The cap is based on a local CFL-like condition:\n    $$\n    \\nu_{\\max, i} = C_{\\max} h |f'(c_i)| = C_{\\max} h |c_i|\n    $$\n    The final entropy viscosity is $\\nu_{E,i} \\leftarrow \\min(\\nu_{E,i}, \\nu_{\\max, i})$.\n\n**2.3. Time Evolution and Stability**\n\n-   **Time Stepping**: An explicit forward Euler scheme is used to advance the solution:\n    $$\n    c_i^{n+1} = c_i^n + \\Delta t \\cdot \\text{RHS}_i(c^n, \\nu_{\\text{tot}}^n)\n    $$\n-   **Adaptive Time Step ($\\Delta t$)**: To ensure stability of the explicit scheme, the time step $\\Delta t$ is calculated at each step based on the maximum characteristic speed and the maximum total viscosity:\n    $$\n    \\Delta t = \\text{CFL} \\cdot \\frac{h^2}{h \\max_j|c_j| + 2 \\max_j|\\nu_{\\text{tot},j}|}\n    $$\n    where `CFL` is the given advective-diffusive stability factor.\n\n**3. Verification of Entropy Dissipation**\n\nThe primary goal is to verify that the total discrete entropy, $E^n = h \\sum_{i=0}^{N_x-1} \\eta(c_i^n)$, is nonincreasing in time. This is checked at every time step by comparing the newly computed entropy $E^{n+1}$ with the previous value $E^n$. Due to floating-point arithmetic, the check is relaxed to $E^{n+1} \\le E^n + \\tau$, where $\\tau$ is a small numerical tolerance. If this condition is violated at any point during the simulation, the entropy is not considered nonincreasing for that test case.\n\nThis complete algorithm is implemented in the final program to solve the problem for the specified test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D viscous Burgers' equation using the entropy viscosity method\n    and verifies the non-increasing nature of the total discrete entropy.\n    \"\"\"\n\n    test_cases = [\n        # (Nx, T, epsilon, Ce, Cmax, CFL)\n        (200, 0.10, 1e-3, 0.5, 0.5, 0.20),  # Test case 1\n        (200, 0.10, 1e-6, 1.5, 0.7, 0.20),  # Test case 2\n        (50, 0.05, 1e-6, 1.0, 1.0, 0.20),   # Test case 3\n    ]\n\n    results = []\n    for params in test_cases:\n        is_monotonic = run_simulation(*params)\n        results.append(is_monotonic)\n\n    # Format the final output as a Python-style list string\n    print(f\"[{','.join(map(str, [r for r in results]))}]\")\n\ndef run_simulation(Nx, T, epsilon, Ce, Cmax, CFL):\n    \"\"\"\n    Runs a single simulation case for the Burgers' equation.\n\n    Args:\n        Nx (int): Number of spatial points.\n        T (float): Final simulation time.\n        epsilon (float): Physical viscosity.\n        Ce (float): Entropy viscosity coefficient.\n        Cmax (float): Viscosity cap coefficient.\n        CFL (float): Advective-diffusive stability factor.\n\n    Returns:\n        bool: True if the total entropy is non-increasing, False otherwise.\n    \"\"\"\n    # Domain and Grid setup\n    x = np.linspace(0.0, 1.0, Nx, endpoint=False)\n    h = 1.0 / Nx\n\n    # Initial Condition\n    cL, cR, xs = 1.0, 0.0, 0.5\n    c = np.where(x < xs, cL, cR)\n\n    # Entropy-related functions\n    # f(c) = c^2 / 2\n    # eta(c) = c^2 / 2 (entropy)\n    # q(c) = c^3 / 3 (entropy flux)\n    # eta'(c) = c\n    f = lambda u: 0.5 * u**2\n    eta = lambda u: 0.5 * u**2\n    q = lambda u: (1.0/3.0) * u**3\n    eta_prime = lambda u: u\n\n    t = 0.0\n    is_non_increasing = True\n    \n    # Initial total entropy computation\n    # The integral is approximated by a sum using the rectangle rule\n    E_prev = h * np.sum(eta(c))\n    \n    # Numerical tolerance for entropy increase check\n    tolerance = 1e-12\n\n    # Main time loop\n    while t < T:\n        # --- 1. Compute Entropy Viscosity ---\n        \n        # Central difference for advective term (for residual calculation)\n        f_c = f(c)\n        adv_term_res = -(np.roll(f_c, -1) - np.roll(f_c, 1)) / (2.0 * h)\n        \n        # Entropy residual R_eta = | eta'(c)*(-f_x) + q_x |\n        q_c = q(c)\n        R_eta = np.abs(eta_prime(c) * adv_term_res + (np.roll(q_c, -1) - np.roll(q_c, 1)) / (2.0 * h))\n        \n        # Denominator for viscosity scaling\n        eta_c = eta(c)\n        denom = np.abs(np.roll(eta_c, -1) - eta_c) + np.abs(np.roll(eta_c, 1) - eta_c) + 1e-12\n        \n        # Entropy viscosity nu_E\n        nu_E = Ce * h**2 * R_eta / denom\n        \n        # Viscosity cap\n        nu_max = Cmax * h * np.abs(c)\n        nu_E = np.minimum(nu_E, nu_max)\n        \n        # Total viscosity\n        nu_tot = epsilon + nu_E\n\n        # --- 2. Calculate Adaptive Time Step ---\n        c_max_speed = np.max(np.abs(c))\n        nu_max_total = np.max(nu_tot)\n\n        dt = CFL * h**2 / (h * c_max_speed + 2.0 * nu_max_total + 1e-12)\n        \n        # Ensure the final time T is not overshot\n        if t + dt > T:\n            dt = T - t\n\n        # --- 3. Evolve the Solution ---\n        \n        # Advection term: central difference\n        adv_term = -(np.roll(f(c), -1) - np.roll(f(c), 1)) / (2.0 * h)\n\n        # Diffusion term: second-order conservative central difference for variable coefficient\n        # Flux at staggered points i+1/2\n        flux_stag_p_half = 0.5 * (np.roll(nu_tot, -1) + nu_tot) * (np.roll(c, -1) - c) / h\n        # Divergence of the flux\n        diff_term = (flux_stag_p_half - np.roll(flux_stag_p_half, 1)) / h\n        \n        # Right-hand side of the semi-discrete equation\n        rhs = adv_term + diff_term\n        \n        # Update solution using Forward Euler\n        c_new = c + dt * rhs\n        c = c_new\n\n        # --- 4. Verify Entropy ---\n        E_curr = h * np.sum(eta(c))\n        \n        if E_curr > E_prev + tolerance:\n            is_non_increasing = False\n            # Break early as the condition is violated\n            break\n            \n        E_prev = E_curr\n        t += dt\n\n    return is_non_increasing\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}