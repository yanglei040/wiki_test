{"hands_on_practices": [{"introduction": "The core idea of Implicit Large-Eddy Simulation is that the truncation errors of a numerical scheme can act as a subgrid-scale model. To understand this, we must first isolate the behavior of the \"ideal\" discretized equations. This exercise [@problem_id:3333512] takes you back to first principles, asking you to derive the semi-discrete kinetic energy balance for a finite volume scheme. By analyzing the contribution of the convective term, you will discover the specific numerical condition that makes the scheme non-dissipative, providing a perfect baseline upon which numerical dissipation can be understood and controlled.", "problem": "Consider an Implicit Large-Eddy Simulation (ILES) of an incompressible, constant-density flow, discretized by the collocated-cell Finite Volume Method (FVM) on a uniform Cartesian mesh with triply-periodic boundary conditions. The unknown velocity field is stored at cell centers. Let each control volume be denoted by an index $P$ with volume $\\Delta \\Omega_{P}$ and cell-centered velocity $\\boldsymbol{u}_{P}(t)$. Each interior face $f$ connects a pair of neighboring cells $(P,N)$ and has outward area vector $\\boldsymbol{S}_{f}$ measured with respect to cell $P$, so that the same face has area vector $-\\boldsymbol{S}_{f}$ with respect to cell $N$. The constant density is $\\rho$, and the dynamic viscosity is $\\mu$.\n\nThe semi-discrete momentum balance in each cell $P$ is obtained by integrating the incompressible Navier–Stokes equations over the control volume and applying the divergence theorem to each flux term. The convective flux of momentum through face $f$ is represented by the mass flux $m_{f}$ multiplied by an interpolated face velocity $\\boldsymbol{u}_{f}$. The mass flux through face $f$ as seen from cell $P$ is $m_{f} = \\rho\\,\\boldsymbol{u}_{f}\\cdot\\boldsymbol{S}_{f}$, and the same face as seen from cell $N$ has mass flux $-m_{f}$. The face-velocity interpolation is defined by a single parameter $\\alpha \\in [0,1]$ via\n$$\n\\boldsymbol{u}_{f}(\\alpha) = \\alpha\\,\\boldsymbol{u}_{P} + (1-\\alpha)\\,\\boldsymbol{u}_{N}.\n$$\nAssume that the discrete continuity equation is enforced in the usual face-flux form,\n$$\n\\sum_{f\\in \\partial \\Omega_{P}} m_{f} = 0 \\quad \\text{for every cell } P,\n$$\nand that pressure is discretized with a centered, face-based gradient such that the discrete gradient and divergence operators form a summation-by-parts pair under the standard FVM inner product. Viscous fluxes are discretized with symmetric, centered differences that yield a nonnegative quadratic form for the viscous dissipation.\n\nStarting from the above fundamental laws and definitions, derive the semi-discrete kinetic energy balance for the global kinetic energy\n$$\nK(t) = \\sum_{P} \\Delta \\Omega_{P}\\,\\frac{\\rho}{2}\\,|\\boldsymbol{u}_{P}(t)|^{2}.\n$$\nExplicitly identify the contributions of the convective, pressure, and viscous terms to $\\mathrm{d}K/\\mathrm{d}t$, and express the convective contribution in terms of face pairs $(P,N)$, the mass flux $m_{f}$, and the interpolation parameter $\\alpha$. Then, determine the value of $\\alpha$ for which the convective contribution reduces exactly to a telescoping boundary transport of kinetic energy, with no interior production or destruction, so that under triply-periodic boundary conditions there is no spurious kinetic energy production from convection. Provide the final value of $\\alpha$ as your answer. No rounding is required. Your answer must be a single real number without units.", "solution": "The analysis begins with an examination of the problem statement to ensure its validity.\n\n### Step 1: Extract Givens\n- **Flow:** Incompressible, constant-density, Implicit Large-Eddy Simulation (ILES).\n- **Discretization:** Collocated-cell Finite Volume Method (FVM) on a uniform Cartesian mesh.\n- **Boundary Conditions:** Triply-periodic.\n- **Variables:** Cell-centered velocity $\\boldsymbol{u}_{P}(t)$ in control volume $\\Delta \\Omega_{P}$.\n- **Constants:** Density $\\rho$, dynamic viscosity $\\mu$.\n- **Face Geometry:** A face $f$ connects cells $P$ and $N$. Its area vector is $\\boldsymbol{S}_{f}$ pointing outwards from $P$.\n- **Semi-discrete Momentum Equation:** Derived from integrating the Navier-Stokes equations over $\\Delta \\Omega_{P}$.\n- **Mass Flux:** The mass flux through face $f$ is $m_{f} = \\rho\\,\\boldsymbol{u}_{f}\\cdot\\boldsymbol{S}_{f}$.\n- **Face Velocity Interpolation:** $\\boldsymbol{u}_{f}(\\alpha) = \\alpha\\,\\boldsymbol{u}_{P} + (1-\\alpha)\\,\\boldsymbol{u}_{N}$, with $\\alpha \\in [0,1]$.\n- **Discrete Continuity:** $\\sum_{f\\in \\partial \\Omega_{P}} m_{f} = 0$ for every cell $P$.\n- **Pressure-Gradient and Divergence:** The discrete operators form a summation-by-parts pair.\n- **Viscous Term:** Discretized using symmetric, centered differences, yielding a nonnegative quadratic form for viscous dissipation.\n- **Global Kinetic Energy:** $K(t) = \\sum_{P} \\Delta \\Omega_{P}\\,\\frac{\\rho}{2}\\,|\\boldsymbol{u}_{P}(t)|^{2}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, situated in the well-established field of Computational Fluid Dynamics. It is well-posed, objective, and self-contained, providing all necessary definitions and constraints to derive a unique solution for the parameter $\\alpha$. The premises, such as the form of the FVM equations and operator properties, are standard in the literature. The problem is formalizable and asks for a rigorous mathematical derivation. It is not trivial, as it requires careful algebraic manipulation and understanding of the conservation properties of numerical schemes. There are no contradictions, ambiguities, or factual unsoundness.\n\n### Step-3: Verdict and Action\nThe problem is deemed valid. A full, reasoned solution will be provided.\n\n### Derivation of the Semi-Discrete Kinetic Energy Balance\n\nThe semi-discrete momentum equation for a cell $P$ is obtained by integrating the Navier-Stokes equations over the control volume $\\Delta\\Omega_P$. For a constant density $\\rho$, this is:\n$$\n\\Delta\\Omega_P \\rho \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t} = -\\sum_{f \\in \\partial\\Omega_P} (\\rho \\boldsymbol{u}_f \\otimes \\boldsymbol{u}_f) \\cdot \\boldsymbol{S}_f - \\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f + \\sum_{f \\in \\partial\\Omega_P} \\boldsymbol{\\tau}_f \\cdot \\boldsymbol{S}_f\n$$\nUsing the definition of mass flux, $m_f = \\rho \\boldsymbol{u}_f \\cdot \\boldsymbol{S}_f$, the convective term can be written as $\\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f$. The momentum equation for cell $P$ is thus:\n$$\n\\Delta\\Omega_P \\rho \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t} = -\\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f - \\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f + \\boldsymbol{V}_P\n$$\nwhere $\\boldsymbol{V}_P$ represents the net viscous force on the cell.\n\nThe kinetic energy in cell $P$ is $K_P(t) = \\Delta \\Omega_{P}\\,\\frac{\\rho}{2}\\,|\\boldsymbol{u}_{P}(t)|^{2}$. Its time derivative is:\n$$\n\\frac{\\mathrm{d}K_P}{\\mathrm{d}t} = \\Delta \\Omega_{P}\\,\\rho\\,\\boldsymbol{u}_P \\cdot \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t} = \\boldsymbol{u}_P \\cdot \\left(\\Delta\\Omega_P \\rho \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t}\\right)\n$$\nSubstituting the momentum equation:\n$$\n\\frac{\\mathrm{d}K_P}{\\mathrm{d}t} = \\boldsymbol{u}_P \\cdot \\left( -\\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f \\right) + \\boldsymbol{u}_P \\cdot \\left( -\\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f \\right) + \\boldsymbol{u}_P \\cdot \\boldsymbol{V}_P\n$$\nThe rate of change of the global kinetic energy $K(t) = \\sum_P K_P(t)$ is found by summing over all cells $P$:\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = \\sum_P \\frac{\\mathrm{d}K_P}{\\mathrm{d}t} = T_C + T_P + T_V\n$$\nwhere $T_C$, $T_P$, and $T_V$ are the total contributions from convection, pressure, and viscous terms, respectively.\n\n**Contribution of the Pressure Term ($T_P$)**\nThe pressure term is $T_P = \\sum_P \\boldsymbol{u}_P \\cdot \\left( -\\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f \\right)$. The problem states that the discrete divergence ($D$) and gradient ($G$) operators form a summation-by-parts pair. Let the FVM inner product be $\\langle \\boldsymbol{a}, \\boldsymbol{b} \\rangle = \\sum_P \\Delta\\Omega_P \\boldsymbol{a}_P \\cdot \\boldsymbol{b}_P$. The summation-by-parts property, for periodic boundary conditions, is $\\langle \\boldsymbol{v}, G\\phi \\rangle = - \\langle D\\boldsymbol{v}, \\phi \\rangle$.\nThe pressure term can be written as $T_P = -\\langle \\boldsymbol{u}, Gp \\rangle$. Using the property, this becomes $T_P = \\langle Du, p \\rangle$.\nThe discrete divergence of the velocity field, consistent with the continuity equation, is $(D\\boldsymbol{u})_P = \\frac{1}{\\Delta\\Omega_P \\rho} \\sum_{f \\in \\partial\\Omega_P} \\rho \\boldsymbol{u}_f \\cdot \\boldsymbol{S}_f = \\frac{1}{\\Delta\\Omega_P \\rho} \\sum_{f \\in \\partial\\Omega_P} m_f$.\nThe discrete continuity equation is given as $\\sum_{f \\in \\partial\\Omega_P} m_f = 0$ for all $P$. Therefore, $(D\\boldsymbol{u})_P = 0$ for all $P$.\nThis implies that $T_P = \\sum_P \\Delta\\Omega_P (Du)_P p_P = 0$. The pressure term does no net work on the system.\n\n**Contribution of the Viscous Term ($T_V$)**\nThe viscous term is $T_V = \\sum_P \\boldsymbol{u}_P \\cdot \\boldsymbol{V}_P$. The problem states that the viscous discretization yields a nonnegative quadratic form for viscous dissipation. Viscous dissipation is defined as $\\epsilon = -T_V$. The condition is thus $\\epsilon \\ge 0$, which means $T_V \\le 0$. This term represents the irreversible conversion of kinetic energy into internal energy.\n\n**Contribution of the Convective Term ($T_C$)**\nThe total convective contribution is $T_C = \\sum_P \\left( -\\boldsymbol{u}_P \\cdot \\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f \\right)$. We can change the order of summation from summing over cells then faces to summing over all unique faces. Each interior face $f$ is shared by two cells, $P$ and $N$. The mass flux from $P$'s perspective is $m_f$, and from $N$'s perspective is $m_{f,N} = \\rho \\boldsymbol{u}_f \\cdot (-\\boldsymbol{S}_f) = -m_f$.\n$$\nT_C = -\\sum_{f(P,N)} \\left( \\boldsymbol{u}_P \\cdot (m_f \\boldsymbol{u}_f) + \\boldsymbol{u}_N \\cdot (m_{f,N} \\boldsymbol{u}_f) \\right) = -\\sum_{f(P,N)} (\\boldsymbol{u}_P \\cdot m_f \\boldsymbol{u}_f - \\boldsymbol{u}_N \\cdot m_f \\boldsymbol{u}_f)\n$$\n$$\nT_C = \\sum_{f(P,N)} m_f (\\boldsymbol{u}_N - \\boldsymbol{u}_P) \\cdot \\boldsymbol{u}_f\n$$\nNow, substitute the interpolation for $\\boldsymbol{u}_f = \\alpha \\boldsymbol{u}_P + (1-\\alpha)\\boldsymbol{u}_N$. A useful identity is $(b-a) \\cdot (\\alpha a + (1-\\alpha)b) = \\frac{1}{2}(|b|^2-|a|^2) - (\\alpha-\\frac{1}{2})|b-a|^2$.\nLetting $\\boldsymbol{a} = \\boldsymbol{u}_P$ and $\\boldsymbol{b} = \\boldsymbol{u}_N$, we have:\n$$\n(\\boldsymbol{u}_N - \\boldsymbol{u}_P) \\cdot \\boldsymbol{u}_f = \\frac{1}{2}(|\\boldsymbol{u}_N|^2 - |\\boldsymbol{u}_P|^2) - \\left(\\alpha - \\frac{1}{2}\\right)|\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2\n$$\nSubstituting this into the expression for $T_C$:\n$$\nT_C = \\sum_{f} m_f \\left[ \\frac{1}{2}(|\\boldsymbol{u}_N|^2 - |\\boldsymbol{u}_P|^2) \\right] - \\sum_{f} m_f \\left(\\alpha - \\frac{1}{2}\\right)|\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2\n$$\nLet's analyze the first term, $T_{C,1} = \\sum_{f} m_f \\frac{1}{2}(|\\boldsymbol{u}_N|^2 - |\\boldsymbol{u}_P|^2) = \\sum_f m_f (E_N - E_P)$, where $E_P = \\frac{1}{2}|\\boldsymbol{u}_P|^2$.\nWe can prove that this term is identically zero. Consider the sum $\\sum_P E_P \\left( \\sum_{f \\in \\partial\\Omega_P} m_f \\right)$. By the discrete continuity equation, this sum is zero.\n$$\n0 = \\sum_P E_P \\left( \\sum_{f \\in \\partial\\Omega_P} m_f \\right) = \\sum_P \\sum_{f \\in \\partial\\Omega_P} E_P m_f\n$$\nChanging the order of summation to be over unique faces:\n$$\n0 = \\sum_{f(P,N)} (E_P m_f + E_N m_{f,N}) = \\sum_{f(P,N)} (E_P m_f - E_N m_f) = \\sum_f m_f (E_P - E_N)\n$$\nThis shows that $\\sum_f m_f (E_P - E_N) = 0$. Therefore, $T_{C,1} = \\sum_f m_f (E_N - E_P) = - \\sum_f m_f(E_P - E_N) = 0$.\n\nThe convective contribution to the kinetic energy budget simplifies to:\n$$\nT_C = - \\left(\\alpha - \\frac{1}{2}\\right) \\sum_{f} m_f |\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2\n$$\nThe problem states that for a specific value of $\\alpha$, the convective contribution should reduce to a telescoping boundary transport. For a domain with periodic boundary conditions, such a transport term evaluates to zero. This means there is no spurious production or destruction of kinetic energy from the convective term in the interior of the domain. For this to be true, we must have $T_C = 0$.\nThe sum $\\sum_{f} m_f |\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2$ is not zero for a general flow. Therefore, for $T_C$ to be zero for any arbitrary flow field, the coefficient must be zero:\n$$\n\\alpha - \\frac{1}{2} = 0 \\implies \\alpha = \\frac{1}{2}\n$$\nThis value of $\\alpha$ corresponds to a centered interpolation for the face velocity, $\\boldsymbol{u}_f = \\frac{1}{2}(\\boldsymbol{u}_P + \\boldsymbol{u}_N)$, which makes the semi-discrete convective operator skew-symmetric and thus non-dissipative with respect to kinetic energy.\n\nThe final kinetic energy balance is:\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = T_C + T_V\n$$\nFor $\\alpha = 1/2$, $T_C=0$, and the energy balance becomes $\\frac{\\mathrm{d}K}{\\mathrm{d}t} = T_V \\le 0$. The total kinetic energy can only decrease due to viscous dissipation, which is physically correct.\n\nThe value of $\\alpha$ that ensures the convective term is non-dissipative is $1/2$.", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3333512"}, {"introduction": "Once we accept that numerical schemes have inherent dissipation, the next step is to quantify it. This practice [@problem_id:3333547] introduces modified wavenumber analysis, a powerful tool for dissecting the behavior of a discretization scheme in Fourier space. By modeling the effects of a flux limiter with a simple parameter, you will compute how the scheme alters the wave speed (dispersion error) and attenuates amplitudes (dissipation). This analysis provides direct insight into the balance between resolving physics and maintaining stability, and touches upon the critical \"bottleneck effect\" where energy can accumulate unnaturally near the grid cutoff.", "problem": "Consider the one-dimensional linear advection equation $u_t + a u_x = 0$ with constant speed $a>0$. In an Implicit Large-Eddy Simulation (ILES) context using a Total Variation Diminishing (TVD) reconstruction, the nonlinear flux limiter can be parameterized to tune the balance between numerical dispersion and dissipation. For a monochromatic mode under linearized analysis, this limiter can be modeled by an equivalent semi-discrete spatial operator that blends a centered difference (dispersive) term with a second-difference (dissipative) term. Specifically, assume the semi-discrete scheme\n$$\nu_t = -a\\, D_{\\beta}(u), \\quad D_{\\beta}(u_i) = \\frac{1}{\\Delta x}\\left(\\frac{1}{2}(u_{i+1} - u_{i-1}) - \\beta (u_{i+1} - 2 u_i + u_{i-1})\\right),\n$$\nwhere $\\beta \\ge 0$ is a limiter-controlled coefficient representing the effective strength of TVD-induced numerical dissipation, and $\\Delta x = L/N$ is the uniform grid spacing on a periodic domain of length $L$ with $N$ points.\n\nLet $u_i = \\hat{u}\\, e^{\\mathrm{i} k x_i}$ with $x_i = i \\Delta x$, where $k$ is the physical wavenumber and $\\mathrm{i} = \\sqrt{-1}$. Define the nondimensional wavenumber $\\theta = k \\Delta x$.\n\n1. Derive the discrete Fourier symbol of $D_{\\beta}$ and the associated modified wavenumber $k^*(k)$, defined through the relation $u_t = -\\mathrm{i}\\, a\\, k^*(k)\\, u$ for the monochromatic mode. Express $k^*(k)$ in terms of $\\theta$, $\\Delta x$, and $\\beta$.\n\n2. Define the phase error $\\phi(k)$ as $\\phi(k) = \\mathrm{Re}(k^*(k)) - k$, where $\\mathrm{Re}(\\cdot)$ denotes the real part. Provide an expression for $\\phi(k)$ in terms of $\\theta$, $\\Delta x$, and $k$.\n\n3. To characterize the bottleneck effect in ILES, use a physically motivated proxy comparing the numerical dissipation rate to molecular (physical) viscosity. Let the numerical dissipation rate induced by the scheme be\n$$\n\\mu(k) = \\frac{2 \\beta}{\\Delta x} \\left(1 - \\cos \\theta\\right),\n$$\nand let the physical viscous dissipation rate be $\\nu k^2$, where $\\nu > 0$ is the kinematic viscosity. Define the bottleneck amplitude $B$ as\n$$\nB = \\max_{k \\in \\mathcal{K}} \\frac{\\mu(k)}{\\nu k^2},\n$$\nwhere $\\mathcal{K}$ is the set of resolvable wavenumbers up to the Nyquist limit on the chosen grid. The angle unit must be radians.\n\nUsing these definitions, write a complete program that, for each test case in the following test suite, computes:\n- The maximum absolute phase error over all resolvable wavenumbers $\\max_{k \\in \\mathcal{K}} |\\phi(k)|$.\n- The bottleneck amplitude $B$.\n\nAssume $a = 1$ (dimensionless). Use the discrete set of wavenumbers $\\mathcal{K} = \\left\\{k_m = \\frac{2\\pi m}{L} \\,\\big|\\, m = 1, 2, \\ldots, \\left\\lfloor\\frac{N}{2}\\right\\rfloor \\right\\}$, so that $\\theta_m = k_m \\Delta x = \\frac{2\\pi m}{N}$. The program must produce the results for each test case as a list $[B, E_{\\phi}]$, where $E_{\\phi} = \\max_{k \\in \\mathcal{K}} |\\phi(k)|$.\n\nTest suite parameters (all quantities are dimensionless, angles in radians):\n- Case 1: $L = 2\\pi$, $N = 64$, $\\beta = 0.05$, $\\nu = 10^{-3}$.\n- Case 2: $L = 2\\pi$, $N = 64$, $\\beta = 0.20$, $\\nu = 10^{-3}$.\n- Case 3: $L = 2\\pi$, $N = 128$, $\\beta = 0.20$, $\\nu = 10^{-3}$.\n- Case 4: $L = 2\\pi$, $N = 32$, $\\beta = 0.40$, $\\nu = 10^{-3}$.\n- Case 5: $L = 2\\pi$, $N = 128$, $\\beta = 0.40$, $\\nu = 10^{-3}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the exact format:\n$$\n\\text{[[B\\_1,E\\_{\\phi,1}],[B\\_2,E\\_{\\phi,2}],[B\\_3,E\\_{\\phi,3}],[B\\_4,E\\_{\\phi,4}],[B\\_5,E\\_{\\phi,5}]]}\n$$\nwhere $B_i$ and $E_{\\phi,i}$ are floats for the $i$-th case, computed as specified above. No additional text should be printed.", "solution": "The problem is valid as it is scientifically grounded in the numerical analysis of partial differential equations, is self-contained, well-posed, and free of any ambiguities or contradictions.\n\nThe solution proceeds in four steps:\n1.  Derivation of the modified wavenumber $k^*(k)$ for the given semi-discrete scheme.\n2.  Derivation of the phase error $\\phi(k)$ and determination of its maximum absolute value $E_{\\phi}$.\n3.  Derivation of the bottleneck amplitude $B$.\n4.  Statement of the final formulas for implementation.\n\n**1. Derivation of the Modified Wavenumber**\n\nThe semi-discrete scheme for the one-dimensional linear advection equation $u_t + a u_x = 0$ is given by\n$$u_t = -a\\, D_{\\beta}(u)$$\nwhere the spatial operator $D_{\\beta}$ is defined as\n$$D_{\\beta}(u_i) = \\frac{1}{\\Delta x}\\left(\\frac{1}{2}(u_{i+1} - u_{i-1}) - \\beta (u_{i+1} - 2 u_i + u_{i-1})\\right)$$\nTo find the behavior of this scheme for a single Fourier mode, we substitute a monochromatic wave solution $u_j(t) = \\hat{u}(t) e^{\\mathrm{i}k x_j}$ into the operator, where $x_j = j\\Delta x$. The grid shifts are represented as $u_{j\\pm1} = \\hat{u}(t) e^{\\mathrm{i}k(j\\pm1)\\Delta x} = u_j e^{\\pm\\mathrm{i}k\\Delta x}$. Using the nondimensional wavenumber $\\theta = k\\Delta x$, we have $u_{j\\pm1} = u_j e^{\\pm\\mathrm{i}\\theta}$.\n\nSubstituting into the expression for $D_{\\beta}(u_j)$:\n$$D_{\\beta}(u_j) = \\frac{u_j}{\\Delta x}\\left(\\frac{1}{2}(e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta}) - \\beta (e^{\\mathrm{i}\\theta} - 2 + e^{-\\mathrm{i}\\theta})\\right)$$\nUsing Euler's identities, $e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta} = 2\\mathrm{i}\\sin\\theta$ and $e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta} = 2\\cos\\theta$, we simplify the terms:\n$$ \\frac{1}{2}(e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta}) = \\mathrm{i}\\sin\\theta $$\n$$ e^{\\mathrm{i}\\theta} - 2 + e^{-\\mathrm{i}\\theta} = (e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta}) - 2 = 2\\cos\\theta - 2 = -2(1-\\cos\\theta) $$\nThus, the operator becomes:\n$$ D_{\\beta}(u_j) = \\frac{u_j}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) $$\nThe semi-discrete equation for the mode amplitude $\\hat{u}$ is then:\n$$ \\frac{d\\hat{u}}{dt} e^{\\mathrm{i} k x_j} = -a \\frac{1}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) \\hat{u} e^{\\mathrm{i} k x_j} $$\nThis is rewritten as $\\frac{du}{dt} = \\lambda u$, where $\\lambda$ is the eigenvalue of the spatial discretization. The problem defines the modified wavenumber $k^*(k)$ through the relation $u_t = -\\mathrm{i} a k^*(k) u$. Comparing this with our derived equation:\n$$ -\\mathrm{i} a k^*(k) = -a \\frac{1}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) $$\n$$ \\mathrm{i} k^*(k) = \\frac{1}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) $$\nSolving for $k^*(k)$ by dividing by $\\mathrm{i}$ (and using $1/\\mathrm{i} = -\\mathrm{i}$):\n$$ k^*(k) = \\frac{1}{\\mathrm{i}\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) = \\frac{1}{\\Delta x} \\left( \\sin\\theta - \\mathrm{i}2\\beta(1-\\cos\\theta) \\right) $$\nThis is the complex modified wavenumber. Its real part governs numerical dispersion, and its imaginary part governs numerical dissipation.\n\n**2. Derivation of the Maximum Absolute Phase Error**\n\nThe phase error is defined as $\\phi(k) = \\mathrm{Re}(k^*(k)) - k$. From the expression for $k^*(k)$:\n$$ \\mathrm{Re}(k^*(k)) = \\frac{\\sin\\theta}{\\Delta x} $$\nThe phase error is therefore:\n$$ \\phi(k) = \\frac{\\sin\\theta}{\\Delta x} - k $$\nSince $\\theta = k\\Delta x$, we have $k = \\theta/\\Delta x$. Substituting this gives the phase error in terms of $\\theta$ and $\\Delta x$:\n$$ \\phi(k) = \\frac{\\sin\\theta - \\theta}{\\Delta x} $$\nWe need to find the maximum absolute phase error, $E_{\\phi} = \\max_{k \\in \\mathcal{K}} |\\phi(k)|$. The set of resolvable wavenumbers is $\\mathcal{K} = \\{k_m = \\frac{2\\pi m}{L} | m = 1, \\dots, \\lfloor\\frac{N}{2}\\rfloor \\}$. This corresponds to nondimensional wavenumbers $\\theta_m = k_m \\Delta x = \\frac{2\\pi m}{L} \\frac{L}{N} = \\frac{2\\pi m}{N}$.\nThe range of $\\theta_m$ is from $\\frac{2\\pi}{N}$ (for $m=1$) to $\\frac{2\\pi \\lfloor N/2 \\rfloor}{N}$. For all test cases, $N$ is even, so $\\lfloor N/2 \\rfloor = N/2$, and the maximum value of $\\theta_m$ is $\\theta_{\\max} = \\pi$ (the Nyquist wavenumber).\n\nThe function to maximize is $|\\phi(k)| = |\\frac{\\sin\\theta - \\theta}{\\Delta x}|$. For $\\theta>0$, $\\sin\\theta < \\theta$, so $\\sin\\theta - \\theta < 0$. Thus, $|\\sin\\theta - \\theta| = \\theta - \\sin\\theta$.\nLet $f(\\theta) = \\theta - \\sin\\theta$. Its derivative is $f'(\\theta) = 1 - \\cos\\theta$. For $\\theta \\in (0, 2\\pi)$, $f'(\\theta) \\ge 0$, meaning $f(\\theta)$ is a monotonically increasing function. The maximum of $|\\phi(k)|$ will therefore occur at the largest value of $\\theta$ in the discrete set, which is $\\theta_{\\max} = \\pi$.\n$$ E_{\\phi} = \\max_{k \\in \\mathcal{K}} |\\phi(k)| = \\frac{\\theta_{\\max} - \\sin(\\theta_{\\max})}{\\Delta x} = \\frac{\\pi - \\sin(\\pi)}{\\Delta x} = \\frac{\\pi}{\\Delta x} $$\nSubstituting $\\Delta x = L/N$, we get the final expression for the maximum absolute phase error:\n$$ E_{\\phi} = \\frac{\\pi N}{L} $$\n\n**3. Derivation of the Bottleneck Amplitude**\n\nThe bottleneck amplitude $B$ is defined as the maximum of the ratio of the numerical dissipation rate $\\mu(k)$ to the physical viscous dissipation rate $\\nu k^2$, over all resolvable wavenumbers:\n$$ B = \\max_{k \\in \\mathcal{K}} \\frac{\\mu(k)}{\\nu k^2} $$\nThe numerical dissipation rate is given as $\\mu(k) = \\frac{2 \\beta}{\\Delta x} \\left(1 - \\cos \\theta\\right)$.\nThe ratio is:\n$$ R(k) = \\frac{\\mu(k)}{\\nu k^2} = \\frac{1}{\\nu k^2} \\frac{2 \\beta}{\\Delta x} \\left(1 - \\cos(k\\Delta x)\\right) $$\nTo find the maximum, we analyze the behavior of the function $g(\\theta) = \\frac{1 - \\cos\\theta}{\\theta^2}$, where $\\theta = k\\Delta x$. The ratio can be written as $R(k) = \\frac{2\\beta \\Delta x}{\\nu} g(k\\Delta x)$.\nThe derivative of $g(\\theta)$ is $g'(\\theta) = \\frac{\\theta \\sin\\theta - 2(1-\\cos\\theta)}{\\theta^3}$. The numerator, $h(\\theta) = \\theta \\sin\\theta - 2(1-\\cos\\theta)$, can be shown to be negative for $\\theta \\in (0, \\pi)$ by analyzing its own derivatives: $h(0)=0$ and $h'(\\theta) = \\theta\\cos\\theta - \\sin\\theta$, which is also negative for $\\theta \\in(0,\\pi)$. Since $g'(\\theta) < 0$, the function $g(\\theta)$ is monotonically decreasing on $(0, \\pi]$.\nConsequently, the ratio $R(k)$ is a monotonically decreasing function of $k$ for $k\\Delta x \\in (0, \\pi]$. The maximum of $R(k)$ over the discrete set $\\mathcal{K}$ must occur at the smallest wavenumber in the set, which is $k_1 = \\frac{2\\pi}{L}$.\nThe corresponding nondimensional wavenumber is $\\theta_1 = k_1 \\Delta x = \\frac{2\\pi}{L} \\frac{L}{N} = \\frac{2\\pi}{N}$.\n\nWe evaluate $R(k)$ at $k=k_1$:\n$$ B = R(k_1) = \\frac{2 \\beta (1 - \\cos(\\theta_1))}{\\nu \\Delta x k_1^2} = \\frac{2 \\beta (1 - \\cos(2\\pi/N))}{\\nu (L/N) (2\\pi/L)^2} $$\n$$ B = \\frac{2 \\beta N (1 - \\cos(2\\pi/N))}{\\nu L (4\\pi^2/L^2)} = \\frac{2 \\beta N L (1 - \\cos(2\\pi/N))}{4\\pi^2 \\nu} = \\frac{\\beta N L}{2\\pi^2 \\nu} (1 - \\cos(2\\pi/N)) $$\nUsing the half-angle identity $1 - \\cos(2x) = 2 \\sin^2(x)$ with $x = \\pi/N$:\n$$ B = \\frac{\\beta N L}{2\\pi^2 \\nu} (2\\sin^2(\\pi/N)) = \\frac{\\beta N L}{\\pi^2 \\nu} \\sin^2(\\pi/N) $$\n\n**4. Final Formulas for Implementation**\n\nFor each test case with parameters $(L, N, \\beta, \\nu)$:\n1.  The maximum absolute phase error is calculated as:\n    $$ E_{\\phi} = \\frac{\\pi N}{L} $$\n2.  The bottleneck amplitude is calculated as:\n    $$ B = \\frac{\\beta N L}{\\pi^2 \\nu} \\sin^2\\left(\\frac{\\pi}{N}\\right) $$\nThese formulas will be implemented in the Python code.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the bottleneck amplitude (B) and maximum phase error (E_phi)\n    for a series of test cases based on a semi-discrete scheme for the\n    linear advection equation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (L, N, beta, nu)\n    test_cases = [\n        (2 * np.pi, 64, 0.05, 1e-3),\n        (2 * np.pi, 64, 0.20, 1e-3),\n        (2 * np.pi, 128, 0.20, 1e-3),\n        (2 * np.pi, 32, 0.40, 1e-3),\n        (2 * np.pi, 128, 0.40, 1e-3),\n    ]\n\n    results = []\n    \n    # Constant from problem statement.\n    a = 1.0\n\n    for case in test_cases:\n        L, N, beta, nu = case\n\n        # Formula for maximum absolute phase error: E_phi = pi * N / L\n        # This is derived from maximizing |phi(k)| = |(sin(theta)-theta)/dx|\n        # at the Nyquist wavenumber k_max = pi / dx, where theta_max = pi.\n        E_phi = np.pi * N / L\n\n        # Formula for bottleneck amplitude: B = (beta * N * L / (pi^2 * nu)) * sin^2(pi/N)\n        # This is derived from maximizing R(k) = mu(k) / (nu * k^2) at the\n        # smallest non-zero wavenumber k_1 = 2*pi / L.\n        # B = (2*beta*(1-cos(2*pi/N))) / (nu * (L/N) * (2*pi/L)^2)\n        #   = (beta * N * L / (2 * pi^2 * nu)) * (1 - cos(2*pi/N))\n        # Using 1 - cos(2x) = 2sin^2(x):\n        # B = (beta * N * L / (pi^2 * nu)) * sin^2(pi/N)\n        \n        # We use the sinc function form for better numerical stability, though the direct formula is also accurate for these parameters.\n        # B = (beta * (L/N) / nu) * (sin(pi/N)/(pi/N))^2\n        # For simplicity and directness, let's stick to the derived formula:\n        B = (beta * N * L / (np.pi**2 * nu)) * (np.sin(np.pi / N))**2\n\n        results.append([B, E_phi])\n\n    # Format the final output string as a list of lists.\n    # str([1.2, 3.4]) produces '[1.2, 3.4]', which is what's needed for the comma-separated join.\n    # The final output has no spaces within the sublists, e.g., \"[1.2,3.4]\".\n    # The default string representation of a list includes spaces. To match the implicit format\n    # of the example, we build the string more carefully.\n    \n    # Let's re-read the format example in the prompt.\n    # [[B_1,E_{\\phi,1}],[B_2,E_{\\phi,2}],...]\n    # In Python, str([[1.0, 2.0], [3.0, 4.0]]) produces '[[1.0, 2.0], [3.0, 4.0]]'\n    # The prompt template `f\"[{','.join(map(str, results))}]\"` joins these with commas,\n    # producing '[[1.0, 2.0], [3.0, 4.0]]' -> '[[1.0, 2.0],[3.0, 4.0]]'.\n    # This matches the requested format.\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\n\nsolve()\n```", "id": "3333547"}, {"introduction": "Applying ILES to real-world problems like wall-bounded turbulence requires translating theoretical knowledge into practical guidelines. In ILES, the grid is the filter, and this exercise [@problem_id:3333490] makes this concept concrete by asking you to develop a quantitative criterion for grid design. You will model the effective filter width on a stretched, anisotropic mesh and use it to ensure that the simulation has sufficient resolution to capture the vital energy-containing motions (near-wall streaks) in the turbulent buffer layer. This practice bridges the gap between numerical analysis and the practical setup of high-fidelity simulations.", "problem": "Consider incompressible turbulent channel flow and an implicit large-eddy simulation (ILES) discretization whose truncation error acts as an implicit filter. Work in wall units, where distances are nondimensionalized by the viscous length scale and denoted by a superscript $+$. The goal is to quantify how a geometrically stretched wall-normal grid modifies the local implicit cutoff wavenumber $k_{\\Delta}(y)$ and to formulate a quantitative criterion that guarantees the preservation of the premultiplied energy spectrum $E(k)$ of near-wall streaks up to the buffer layer. Your program must implement the following modeling assumptions and compute a safety factor for a set of test cases.\n\nFundamental bases and modeling choices:\n- The incompressible Navier–Stokes equations govern the flow and are filtered in large-eddy simulation. For an implicit method, take the effective filter width $\\Delta_{\\text{eff}}$ to be the geometric mean of the local grid spacings,\n$$\n\\Delta_{\\text{eff}}(y) = \\big(\\Delta_x \\,\\Delta_y(y)\\, \\Delta_z\\big)^{1/3}.\n$$\n- Motivated by the sampling theorem and linear stability of discrete operators, approximate the local implicit cutoff wavenumber by\n$$\nk_{\\Delta}(y) = \\alpha \\,\\frac{\\pi}{\\Delta_{\\text{eff}}(y)},\n$$\nwhere $\\alpha \\in (0,1]$ is a scheme-dependent constant capturing the dissipativity of the implicit filter induced by the discretization (including its dependence on the low-pass property of the scheme and time-stepping).\n- Near-wall streaks in turbulent channel flow exhibit robust inner-unit spectral peaks. For the purpose of this problem, model the target near-wall energy-containing wavelengths as constants\n$$\n\\lambda_x^+ = 700,\\qquad \\lambda_z^+ = 100,\n$$\nso that the required directional wavenumbers are\n$$\nk_{x,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_x^+},\\qquad k_{z,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_z^+},\n$$\nand the combined isotropic requirement for the magnitude is\n$$\nk_{\\mathrm{req,iso}} = \\sqrt{k_{x,\\mathrm{req}}^2 + k_{z,\\mathrm{req}}^2}.\n$$\n- Grid spacings in the streamwise and spanwise directions are uniform and specified in wall units as $\\Delta_x^+$ and $\\Delta_z^+$. The wall-normal spacing is geometrically stretched away from the wall with first cell height $\\Delta y_1^+$ and constant ratio $r>1$, i.e.,\n$$\n\\Delta y_j^+ = \\Delta y_1^+\\, r^{\\,j-1},\\qquad Y_n^+ = \\sum_{j=1}^{n} \\Delta y_j^+,\n$$\nand only the part of the grid with $Y_n^+ \\le y_{\\mathrm{buf}}^+$ contributes to the near-wall criterion. Use $y_{\\mathrm{buf}}^+=40$.\n\nSafety factor and pass/fail criterion:\n- Define the directional safety factor\n$$\nS_{\\mathrm{dir}} = \\min\\!\\Bigg(\\frac{\\alpha \\,\\pi/\\Delta_x^+}{k_{x,\\mathrm{req}}},\\, \\frac{\\alpha \\,\\pi/\\Delta_z^+}{k_{z,\\mathrm{req}}}\\Bigg),\n$$\nwhich enforces that the streamwise and spanwise cutoffs separately exceed their required values.\n- Define the isotropic safety factor over the buffer layer as\n$$\nS_{\\mathrm{iso}} = \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{k_{\\Delta}(Y_n^+)}{k_{\\mathrm{req,iso}}}\n= \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{\\alpha \\,\\pi/\\big(\\Delta_x^+ \\Delta_z^+ \\Delta y_n^+\\big)^{1/3}}{\\sqrt{k_{x,\\mathrm{req}}^2 + k_{z,\\mathrm{req}}^2}},\n$$\nwhere $\\Delta y_n^+$ is the local wall-normal spacing at the $n$-th cell within the buffer layer.\n- The overall safety factor is\n$$\nS = \\min\\big(S_{\\mathrm{dir}},\\, S_{\\mathrm{iso}}\\big).\n$$\nInterpretation: $S \\ge 1$ means that the implicit cutoff exceeds what is required to preserve near-wall streak energy up to the buffer layer; $S<1$ indicates under-resolution by this criterion.\n\nProgramming task:\n- Implement a program that, for each provided test case, computes $S$ exactly as prescribed above. The algorithm must:\n  1. Accept $\\Delta_x^+$, $\\Delta_z^+$, $\\Delta y_1^+$, $r$, $\\alpha$, and $y_{\\mathrm{buf}}^+$.\n  2. Compute $k_{x,\\mathrm{req}}$, $k_{z,\\mathrm{req}}$, and $k_{\\mathrm{req,iso}}$ from $\\lambda_x^+$ and $\\lambda_z^+$.\n  3. Construct the geometric sequence $\\Delta y_j^+$ until the cumulative sum $Y_n^+$ would exceed $y_{\\mathrm{buf}}^+$; include only those $n$ with $Y_n^+ \\le y_{\\mathrm{buf}}^+$.\n  4. Compute $S_{\\mathrm{dir}}$ and $S_{\\mathrm{iso}}$ and then $S$.\n- All quantities are dimensionless in wall units, so no physical units are required in the output. Angles are not used.\n\nTest suite:\n- Use the following parameter sets, each as a tuple $(\\Delta_x^+,\\Delta_z^+,\\Delta y_1^+, r,\\alpha, y_{\\mathrm{buf}}^+)$:\n  1. $(18.0, 9.0, 0.4, 1.10, 0.75, 40.0)$\n  2. $(30.0, 40.0, 0.8, 1.15, 0.60, 40.0)$\n  3. $(60.0, 12.0, 0.3, 1.70, 0.65, 40.0)$\n  4. $(25.0, 32.0, 0.5, 1.20, 0.70, 40.0)$\n  5. $(20.0, 35.0, 0.5, 1.05, 0.55, 40.0)$\n\nRequired final output format:\n- Your program should produce a single line of output containing a comma-separated list enclosed in square brackets, with the safety factor $S$ for each test case in the same order as above. Express each $S$ as a floating-point number. For example, the output format must look like \"[s1,s2,s3,s4,s5]\" with no extra spaces or text. You may format the floating-point values with a consistent number of decimal places if desired.", "solution": "The problem is valid as it presents a well-posed, scientifically grounded computational task within the field of computational fluid dynamics. The definitions, parameters, and objectives are clear, consistent, and sufficient for deriving a unique solution.\n\nThe objective is to compute a safety factor, $S$, which quantifies the resolution adequacy of an implicit large-eddy simulation (ILES) grid for capturing near-wall turbulent streaks in channel flow. The safety factor is based on a comparison between the spectral resolution required by the physics and the spectral resolution provided by the grid discretization.\n\nFirst, we establish the required spectral resolution. The problem models near-wall streaks as having characteristic wavelengths of $\\lambda_x^+ = 700$ and $\\lambda_z^+ = 100$ in the streamwise and spanwise directions, respectively. To resolve these structures, the grid must support wavenumbers at least as large as the corresponding fundamental wavenumbers:\n$$\nk_{x,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_x^+} = \\frac{2\\pi}{700}\n$$\n$$\nk_{z,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_z^+} = \\frac{2\\pi}{100}\n$$\nFor a combined, isotropic measure of the required resolution, we use the magnitude of the wavenumber vector:\n$$\nk_{\\mathrm{req,iso}} = \\sqrt{k_{x,\\mathrm{req}}^2 + k_{z,\\mathrm{req}}^2} = \\sqrt{\\left(\\frac{2\\pi}{700}\\right)^2 + \\left(\\frac{2\\pi}{100}\\right)^2} = \\frac{2\\pi}{100} \\sqrt{\\left(\\frac{1}{7}\\right)^2 + 1^2} = \\frac{2\\pi}{100} \\frac{\\sqrt{50}}{7} = \\frac{10\\pi\\sqrt{2}}{700} = \\frac{\\pi\\sqrt{2}}{70}\n$$\n\nNext, we determine the provided spectral resolution, which is limited by the grid spacing. In an ILES, the numerical discretization's truncation error acts as an implicit low-pass filter. The model approximates the effective local filter width, $\\Delta_{\\text{eff}}(y)$, as the geometric mean of the grid spacings in the three directions:\n$$\n\\Delta_{\\text{eff}}(y^+) = \\big(\\Delta_x^+ \\Delta_z^+ \\Delta_y^+(y^+)\\big)^{1/3}\n$$\nwhere $\\Delta_x^+$ and $\\Delta_z^+$ are uniform, and $\\Delta_y^+(y^+)$ is the local wall-normal grid spacing. The corresponding local implicit cutoff wavenumber, $k_{\\Delta}(y^+)$, is modeled as:\n$$\nk_{\\Delta}(y^+) = \\alpha \\frac{\\pi}{\\Delta_{\\text{eff}}(y^+)}\n$$\nThe parameter $\\alpha \\in (0,1]$ accounts for the fact that numerical schemes are not perfect \"brick-wall\" filters and their dissipative properties affect the effective cutoff.\n\nWith the required and provided resolutions defined, we can formulate the safety factors.\n\nThe directional safety factor, $S_{\\mathrm{dir}}$, checks if the uniform grid spacings in the streamwise and spanwise directions are sufficient on their own. It is the minimum of the ratios of the provided cutoff to the required wavenumber in each direction:\n$$\nS_{\\mathrm{dir}} = \\min\\Bigg(\\frac{\\alpha \\pi/\\Delta_x^+}{k_{x,\\mathrm{req}}},\\, \\frac{\\alpha \\pi/\\Delta_z^+}{k_{z,\\mathrm{req}}}\\Bigg)\n$$\nSubstituting the expressions for $k_{x,\\mathrm{req}}$ and $k_{z,\\mathrm{req}}$, this simplifies to:\n$$\nS_{\\mathrm{dir}} = \\min\\Bigg(\\frac{\\alpha \\lambda_x^+}{2\\Delta_x^+},\\, \\frac{\\alpha \\lambda_z^+}{2\\Delta_z^+}\\Bigg)\n$$\n\nThe isotropic safety factor, $S_{\\mathrm{iso}}$, addresses the combined resolution requirement, accounting for the variable wall-normal grid spacing. It is defined as the minimum resolution ratio over all grid cells within the buffer layer, specified as $Y_n^+ \\le y_{\\mathrm{buf}}^+$ (where $y_{\\mathrm{buf}}^+=40$).\n$$\nS_{\\mathrm{iso}} = \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{k_{\\Delta}(Y_n^+)}{k_{\\mathrm{req,iso}}} = \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{\\alpha \\pi / \\big(\\Delta_x^+ \\Delta_z^+ \\Delta y_n^+\\big)^{1/3}}{k_{\\mathrm{req,iso}}}\n$$\nHere, $\\Delta y_n^+$ is the wall-normal spacing of the $n$-th cell, given by the geometric progression $\\Delta y_n^+ = \\Delta y_1^+ r^{n-1}$. To find the minimum of the ratio, we must analyze its dependence on $\\Delta y_n^+$. The ratio is inversely proportional to $(\\Delta y_n^+)^{1/3}$. Therefore, to minimize the ratio, we must maximize its denominator, which means we must find the maximum value of $\\Delta y_n^+$ among all cells satisfying the buffer layer criterion. Since the stretching ratio $r>1$, the cell spacing $\\Delta y_n^+$ increases with the cell index $n$. Consequently, the maximum spacing, $\\Delta y_{\\max}^+$, corresponds to the last cell, say at index $N$, whose cumulative height $Y_N^+ = \\sum_{j=1}^{N} \\Delta y_j^+$ is less than or equal to $y_{\\mathrm{buf}}^+$.\nThe algorithm to find $\\Delta y_{\\max}^+$ is to iterate through cells, starting with $j=1$, calculating $\\Delta y_j^+$ and the cumulative height $Y_j^+$, and stopping when $Y_j^+$ exceeds $y_{\\mathrm{buf}}^+$. The value of $\\Delta y_{j-1}^+$ from the previous step is the required $\\Delta y_{\\max}^+$. If no cells fit within the buffer layer, the set is empty, and the minimum is formally infinite, meaning $S_{\\mathrm{iso}}$ would not be a limiting factor.\n\nOnce $\\Delta y_{\\max}^+$ is found, $S_{\\mathrm{iso}}$ is computed using this single value:\n$$\nS_{\\mathrm{iso}} = \\frac{\\alpha \\pi / \\big(\\Delta_x^+ \\Delta_z^+ \\Delta y_{\\max}^+\\big)^{1/3}}{k_{\\mathrm{req,iso}}}\n$$\n\nFinally, the overall safety factor $S$ is the minimum of the directional and isotropic factors, ensuring that all resolution criteria are met simultaneously:\n$$\nS = \\min(S_{\\mathrm{dir}}, S_{\\mathrm{iso}})\n$$\nA value of $S \\ge 1$ indicates that the grid resolution is sufficient according to this model, while $S < 1$ suggests under-resolution. The program will implement this logic for each test case.", "answer": "```python\nimport numpy as np\n\ndef calculate_safety_factor(dx_plus, dz_plus, dy1_plus, r, alpha, y_buf_plus):\n    \"\"\"\n    Computes the ILES grid resolution safety factor S for a single test case.\n\n    Args:\n        dx_plus (float): Streamwise grid spacing in wall units.\n        dz_plus (float): Spanwise grid spacing in wall units.\n        dy1_plus (float): First wall-normal cell height in wall units.\n        r (float): Wall-normal grid stretching ratio.\n        alpha (float): Scheme-dependent dissipation parameter.\n        y_buf_plus (float): Height of the buffer layer in wall units.\n\n    Returns:\n        float: The overall safety factor S.\n    \"\"\"\n    # 1. Define physical constants and required wavenumbers\n    lambda_x_plus = 700.0\n    lambda_z_plus = 100.0\n\n    k_x_req = 2 * np.pi / lambda_x_plus\n    k_z_req = 2 * np.pi / lambda_z_plus\n    k_req_iso = np.sqrt(k_x_req**2 + k_z_req**2)\n\n    # 2. Compute the directional safety factor S_dir\n    s_x = (alpha * np.pi / dx_plus) / k_x_req\n    s_z = (alpha * np.pi / dz_plus) / k_z_req\n    s_dir = min(s_x, s_z)\n\n    # 3. Compute the isotropic safety factor S_iso\n    # This requires finding the largest wall-normal cell spacing, dy_max_plus,\n    # for a cell whose top boundary Y_n^+ is within y_buf_plus.\n    \n    # Iteratively find the last cell within the buffer layer\n    current_y_plus = 0.0\n    last_dy_plus = 0.0\n    j = 1\n    while True:\n        dy_j_plus = dy1_plus * (r**(j - 1))\n        if current_y_plus + dy_j_plus > y_buf_plus:\n            break\n        last_dy_plus = dy_j_plus\n        current_y_plus += dy_j_plus\n        j += 1\n\n    # If no cell fits in the buffer layer, S_iso is not a limiting constraint (formally infinite).\n    if last_dy_plus == 0.0:\n        s_iso = float('inf')\n    else:\n        # The minimum isotropic ratio occurs at the largest cell spacing (dy_max_plus)\n        dy_max_plus = last_dy_plus\n        \n        delta_eff = (dx_plus * dz_plus * dy_max_plus)**(1.0/3.0)\n        k_delta_min = alpha * np.pi / delta_eff\n        s_iso = k_delta_min / k_req_iso\n\n    # 4. Compute the overall safety factor S\n    s_final = min(s_dir, s_iso)\n    \n    return s_final\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Test suite: tuples of (dx+, dz+, dy1+, r, alpha, y_buf+)\n    test_cases = [\n        (18.0, 9.0, 0.4, 1.10, 0.75, 40.0),\n        (30.0, 40.0, 0.8, 1.15, 0.60, 40.0),\n        (60.0, 12.0, 0.3, 1.70, 0.65, 40.0),\n        (25.0, 32.0, 0.5, 1.20, 0.70, 40.0),\n        (20.0, 35.0, 0.5, 1.05, 0.55, 40.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        dx, dz, dy1, r, alpha, y_buf = case\n        s_val = calculate_safety_factor(dx, dz, dy1, r, alpha, y_buf)\n        results.append(s_val)\n    \n    # Format the output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3333490"}]}