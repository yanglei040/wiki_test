{"hands_on_practices": [{"introduction": "Elliptic partial differential equations, such as the Poisson equation, are foundational for modeling steady-state physical phenomena like gravitational fields and subsurface pressure distributions. The accuracy of any numerical solution to these problems is critically dependent on how conditions at the domain's edge are handled. This exercise guides you through the derivation and implementation of a ghost-point method for enforcing Dirichlet boundary data, a versatile technique that preserves the overall second-order accuracy of a finite difference scheme [@problem_id:3578589].", "problem": "Consider the elliptic Partial Differential Equation (PDE) Poisson problem in two spatial dimensions on the open unit square domain $\\Omega=(0,1)\\times(0,1)$:\n$$\n-\\,\\Delta u = f \\quad \\text{in } \\Omega,\n$$\nwith Dirichlet boundary data\n$$\nu=g \\quad \\text{on } \\partial\\Omega.\n$$\nYou are asked to derive and implement a second-order accurate ghost-point finite difference stencil that enforces the Dirichlet data near the boundary while preserving the overall second-order accuracy of the scheme.\n\nYour derivation must start from fundamental calculus and Taylor expansion principles and respect the following modeling assumptions that are standard in computational geophysics for finite volume or cell-centered finite difference formulations:\n- The unknown $u$ is represented at cell centers on a uniform Cartesian grid with $N\\times N$ cells, grid spacing $h=1/N$, and cell-center coordinates $x_i=(i+\\tfrac{1}{2})h$, $y_j=(j+\\tfrac{1}{2})h$ for integers $i,j\\in\\{0,1,\\ldots,N-1\\}$.\n- The five-point discrete Laplacian interior stencil approximates $-\\Delta u$ at cell centers by the standard central differences on a uniform mesh.\n- Near a boundary face (e.g., $x=0$), you will introduce a ghost value at the reflected cell-center location (e.g., $x=-\\tfrac{h}{2}$) and enforce the Dirichlet boundary condition at the face location using a local one-dimensional argument in the outward normal direction. Your derivation must use Taylor expansions to justify the ghost-value relation and its order of accuracy with respect to the exact ghost value implied by the smooth solution $u$ and the boundary data $g$.\n\nTasks:\n1. Derive, in one spatial dimension, a ghost-point relation that enforces Dirichlet data $u(0)=g(0)$ at the boundary face $x=0$ for a cell-centered grid with unknowns at $x_{-1}=-\\tfrac{h}{2}$, $x_0=\\tfrac{h}{2}$, $x_1=\\tfrac{3h}{2}$. Starting from Taylor expansions about either the boundary face or a nearby cell center, show how to express the ghost value in terms of the boundary data and the adjacent interior value, and state clearly the order of consistency of that relation with the exact ghost value. Then write the resulting normal-direction discrete second-derivative stencil adjacent to the boundary face, and combine it with the tangential-direction difference to obtain the two-dimensional near-boundary stencil for $-\\,\\Delta u=f$ at the first layer of interior cell centers.\n2. Explain why, even if the local truncation error near the boundary is worse than the interior (for example, $\\mathcal{O}(h)$ or $\\mathcal{O}(1)$ at a set of cell centers of width $\\mathcal{O}(h)$ next to $\\partial\\Omega$), the overall global error in a mesh-weighted discrete $L^2$ norm can still be $\\mathcal{O}(h^2)$ for smooth solutions $u$ and data $f,g$. Your explanation should be based on the stability and smoothing properties of elliptic operators and a discrete energy estimate argument grounded in well-tested facts for elliptic PDEs.\n3. Implement the full two-dimensional scheme on $\\Omega$ using the cell-centered grid with ghost values to impose Dirichlet data on all four sides. Assemble the linear system for the unknown vector of size $N^2$ and solve it using any direct sparse solver. For each problem instance below, compute the mesh-weighted discrete $L^2$ error\n$$\n\\|e_h\\|_{2,h} \\;=\\; \\left(h^2 \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\left(u_{ij}^{\\text{num}}-u(x_i,y_j)\\right)^2\\right)^{1/2},\n$$\nand the observed order of accuracy\n$$\np \\;=\\; \\log_2\\!\\left(\\frac{\\|e_h\\|_{2,h}}{\\|e_{h/2}\\|_{2,h/2}}\\right).\n$$\n\nTest Suite:\n- Case A (homogeneous Dirichlet; smooth nontrivial source): exact solution $u(x,y)=\\sin(2\\pi x)\\sin(3\\pi y)$, so $f(x,y)=\\left((2\\pi)^2+(3\\pi)^2\\right)\\sin(2\\pi x)\\sin(3\\pi y)$ and $g$ is the trace of $u$ on $\\partial\\Omega$. Use $N\\in\\{16,32,64\\}$.\n- Case B (inhomogeneous Dirichlet; nonzero source): exact solution $u(x,y)=\\exp(x+y)$, so $f(x,y)=-2\\exp(x+y)$ and $g$ is the trace of $u$ on $\\partial\\Omega$. Use $N\\in\\{16,32,64\\}$.\n- Case C (Laplace equation; inhomogeneous boundary): exact solution $u(x,y)=\\cosh(x)\\cos(y)$, so $f(x,y)=0$ and $g$ is the trace of $u$ on $\\partial\\Omega$. Use $N\\in\\{16,32,64\\}$.\n\nRequired final output:\n- Your program must compute the observed order $p$ using the largest two grids for each case (that is, compare $N=32$ and $N=64$), and produce a single line of output containing the three results as a comma-separated list enclosed in square brackets, for example $[p_A,p_B,p_C]$.\n- Each $p$ must be printed as a floating-point number rounded to three decimal places.\n- No physical units are involved in this problem. Angles, where they appear inside trigonometric functions, are in radians.\n\nYour final answer must be a complete, runnable program that carries out these computations exactly as specified and prints the final output in the required single-line format.", "solution": "The user-provided problem is assessed to be valid as it is scientifically grounded, well-posed, objective, and contains a complete and consistent setup for a standard numerical analysis task. The methodology involves deriving, analyzing, and implementing a finite difference scheme for the Poisson equation.\n\n### Task 1: Derivation of the Ghost-Point Stencil\n\nWe are asked to derive a second-order accurate finite difference scheme for the Poisson problem $-\\Delta u = f$ on the unit square $\\Omega=(0,1)\\times(0,1)$ with Dirichlet boundary conditions $u=g$ on $\\partial\\Omega$. The scheme uses a cell-centered grid where unknowns $u_{ij}$ represent the solution at cell centers $(x_i, y_j) = ((i+\\frac{1}{2})h, (j+\\frac{1}{2})h)$ for $i,j \\in \\{0, 1, \\ldots, N-1\\}$ with grid spacing $h=1/N$.\n\nFirst, we consider the one-dimensional problem near the boundary at $x=0$. The first interior cell center is at $x_0=h/2$. We introduce a \"ghost\" cell center at $x_{-1}=-h/2$. The value of the solution at this ghost point, $u_{-1}$, is determined by enforcing the boundary condition $u(0)=g(0)$.\n\nA second-order accurate way to enforce this condition is to assume that the boundary value is the average of the values at the two adjacent cell centers:\n$$\n\\frac{u_0 + u_{-1}}{2} = g(0)\n$$\nThis is equivalent to a centered interpolation. To verify its accuracy, we use Taylor series expansion of the exact solution $u(x)$ around $x=0$:\n$$\nu(h/2) = u(0) + \\frac{h}{2} u'(0) + \\frac{h^2}{8} u''(0) + \\mathcal{O}(h^3)\n$$\n$$\nu(-h/2) = u(0) - \\frac{h}{2} u'(0) + \\frac{h^2}{8} u''(0) - \\mathcal{O}(h^3)\n$$\nSumming these and dividing by $2$ gives:\n$$\n\\frac{u(h/2) + u(-h/2)}{2} = u(0) + \\frac{h^2}{8} u''(0) + \\mathcal{O}(h^4)\n$$\nThus, setting $\\frac{u_0+u_{-1}}{2} = g(0)$ enforces the boundary condition with an error of $\\mathcal{O}(h^2)$. From this relation, we express the ghost value $u_{-1}$ as:\n$$\nu_{-1} = 2g(0) - u_0\n$$\nTo verify the consistency of this computed ghost value with the exact value $u_{exact}(-h/2)$, we compute the difference:\n$$\nu_{-1} - u_{exact}(-h/2) = (2g(0) - u_0) - u(-h/2)\n$$\nSubstituting Taylor expansions for $u_0=u(h/2)$ and $g(0)=u(0)$ around $x=-h/2$, or more simply as done above by expanding all around $x=0$, we find:\n$$\nu_{-1} - u_{exact}(-h/2) = \\left(2u(0) - \\left(u(0)+\\frac{h}{2}u'(0)+\\frac{h^2}{8}u''(0)\\right)\\right) - \\left(u(0)-\\frac{h}{2}u'(0)+\\frac{h^2}{8}u''(0)\\right) + \\mathcal{O}(h^3)\n$$\n$$\n= -\\frac{h^2}{4}u''(0) + \\mathcal{O}(h^3)\n$$\nThe computed ghost value is therefore consistent with the exact value to order $\\mathcal{O}(h^2)$.\n\nNext, we formulate the discrete second-derivative stencil for $-u_{xx}$ at the first interior point $x_0=h/2$. We use the standard centered difference formula, which involves points $x_0-h = -h/2$ and $x_0+h = 3h/2$. The corresponding grid indices are $-1$ and $1$.\n$$\n-u_{xx}(x_0) \\approx -\\frac{u_1 - 2u_0 + u_{-1}}{h^2}\n$$\nSubstituting our expression for the ghost value $u_{-1}$:\n$$\n-u_{xx}(x_0) \\approx -\\frac{u_1 - 2u_0 + (2g(0) - u_0)}{h^2} = \\frac{3u_0 - u_1 - 2g(0)}{h^2}\n$$\nThis is the required near-boundary stencil for the normal second derivative.\n\nFinally, we assemble the full two-dimensional stencil for $-\\Delta u = f$ at a point $(x_0, y_j)$ on the grid adjacent to the left boundary $x=0$.\n$$\n-\\Delta u(x_0, y_j) = -u_{xx}(x_0, y_j) - u_{yy}(x_0, y_j) = f(x_0, y_j)\n$$\nWe use our derived stencil for $-u_{xx}$ and the standard centered difference stencil for $-u_{yy}$:\n$$\n\\frac{3u_{0j} - u_{1j} - 2g(0, y_j)}{h^2} + \\frac{2u_{0j} - u_{0,j-1} - u_{0,j+1}}{h^2} \\approx f_{0j}\n$$\nRearranging to place all unknown terms on the left-hand side yields the final discrete equation at $(x_0, y_j)$:\n$$\n\\frac{5u_{0j} - u_{1j} - u_{0,j-1} - u_{0,j+1}}{h^2} = f_{0j} + \\frac{2g(0, y_j)}{h^2}\n$$\nThis equation, along with analogous ones for the other three boundaries and the standard 5-point stencil in the interior, forms the system of linear equations to be solved for the unknowns $\\{u_{ij}\\}$.\n\n### Task 2: Global Accuracy with Lower-Order Local Error\n\nA direct analysis of the local truncation error (LTE) for the near-boundary stencil derived in Task 1 reveals it to be $\\mathcal{O}(h)$. For instance, at $(x_0, y_j)$, the LTE is $\\tau_{0j} = (-\\Delta u - L_h u)|_{(x_0,y_j)}$. The tangential part $-u_{yy} - L_h^y u$ is $\\mathcal{O}(h^2)$, but the normal part $-u_{xx}-L_h^x u$ has an LTE of $-\\frac{1}{4}u_{xx}(0, y_j) + \\mathcal{O}(h)$. Thus, the total LTE is $\\mathcal{O}(h)$ at grid points adjacent to the boundary.\n\nOne might intuitively expect that an $\\mathcal{O}(h)$ LTE on $\\mathcal{O}(N) = \\mathcal{O}(1/h)$ grid points would degrade the global accuracy to $\\mathcal{O}(h)$. However, for elliptic problems, the global error in a discrete $L^2$ norm often remains $\\mathcal{O}(h^2)$, a phenomenon sometimes referred to as superconvergence. The explanation rests on the stability and smoothing properties of the elliptic operator and its discrete counterpart.\n\nLet $A_h$ be the matrix representing the discrete Laplacian operator, $e_h$ be the vector of global errors at grid points, and $\\tau_h$ be the vector of LTEs. The error satisfies the equation $A_h e_h = \\tau_h$. A basic stability estimate states that $\\|e_h\\|_{2,h} \\le \\|A_h^{-1}\\|_{2,h} \\|\\tau_h\\|_{2,h}$. The matrix norm $\\|A_h^{-1}\\|_{2,h}$ is bounded independently of $h$ for a stable scheme. The norm of the LTE vector is $\\|\\tau_h\\|_{2,h} = \\left(h^2 \\sum_{i,j} \\tau_{ij}^2\\right)^{1/2}$. This sum consists of approximately $(N-2)^2$ interior terms where $\\tau_{ij} = \\mathcal{O}(h^2)$ and approximately $4(N-2)$ boundary-adjacent terms where $\\tau_{ij}=\\mathcal{O}(h)$.\nThe resulting norm estimate is:\n$$\n\\|\\tau_h\\|_{2,h}^2 = h^2 \\left( \\mathcal{O}(N^2) \\cdot (\\mathcal{O}(h^2))^2 + \\mathcal{O}(N) \\cdot (\\mathcal{O}(h))^2 \\right) = h^2 \\left( \\mathcal{O}(h^{-2}) \\cdot \\mathcal{O}(h^4) + \\mathcal{O}(h^{-1}) \\cdot \\mathcal{O}(h^2) \\right) = \\mathcal{O}(h^4) + \\mathcal{O}(h^3)\n$$\nThis suggests $\\|\\tau_h\\|_{2,h} = \\mathcal{O}(h^{3/2})$, leading to a global error of $\\|e_h\\|_{2,h}=\\mathcal{O}(h^{3/2})$. While better than $\\mathcal{O}(h)$, this simple analysis is still too pessimistic.\n\nA more refined analysis, based on a discrete form of Green's identity or properties of the discrete Green's function, is needed. The inverse operator $A_h^{-1}$ possesses a smoothing property: it maps a \"rough\" forcing term (like our $\\tau_h$, which has a sharp jump at the boundary layer) to a \"smoother\" solution $e_h$. This is analogous to Saint-Venant's principle in mechanics. A rigorous proof (e.g., using Bramble's Lemma or GKS theory) demonstrates that the influence of the $\\mathcal{O}(h)$ LTE on the co-dimension one boundary set contributes to the global $L^2$ error at the same order as an $\\mathcal{O}(h^2)$ LTE in the bulk. Consequently, both the interior and boundary LTEs lead to an $\\mathcal{O}(h^2)$ contribution to the global error, resulting in an overall observed accuracy of $\\mathcal{O}(h^2)$ for smooth solutions.\n\n### Task 3: Implementation\n\nThe numerical implementation involves constructing and solving the $N^2 \\times N^2$ linear system $A \\vec{u} = \\vec{b}$ derived from the finite difference stencils. For a general point $(i,j)$, the equation is:\n$$\nc_{ij} u_{ij} - \\sum_{(i',j') \\in \\mathcal{N}_{ij}} u_{i'j'} = h^2 f_{ij} + (\\text{boundary terms})\n$$\n- **Interior points:** $c_{ij}=4$.\n- **Edge points (not corners):** $c_{ij}=5$.\n- **Corner points:** $c_{ij}=6$.\n\nThe matrix $A$ is sparse, symmetric, and positive definite, making it suitable for specialized solvers. The Python implementation below uses `scipy.sparse` to build the matrix efficiently and `scipy.sparse.linalg.spsolve` to solve the system. It then computes the discrete $L^2$ error and convergence order for the three test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse import linalg\n\ndef compute_order_of_accuracy(u_exact_func, f_func, N_values):\n    \"\"\"\n    Computes the observed order of accuracy for the Poisson solver.\n\n    Args:\n        u_exact_func: Lambda function for the exact solution u(x, y).\n        f_func: Lambda function for the source term f(x, y).\n        N_values: A list of grid sizes [N_coarse, N_fine].\n\n    Returns:\n        The computed order of accuracy p.\n    \"\"\"\n    errors = []\n    g_func = u_exact_func # Boundary data g is the trace of u\n\n    for N in N_values:\n        h = 1.0 / N\n        \n        # Create grid with cell centers\n        x = (np.arange(N) + 0.5) * h\n        y = (np.arange(N) + 0.5) * h\n        X, Y = np.meshgrid(x, y, indexing='ij')\n\n        # Assemble the linear system A*u = b\n        # Using row-major mapping: k = i * N + j\n        num_unknowns = N * N\n        mat_A = sparse.lil_matrix((num_unknowns, num_unknowns))\n        vec_b = np.zeros(num_unknowns)\n\n        for i in range(N):\n            for j in range(N):\n                k = i * N + j\n                \n                # Diagonal coefficient is 4 for interior, 5 for edge, 6 for corner\n                diag_coeff = 4.0\n                \n                # Source term\n                b_val = f_func(X[i, j], Y[i, j])\n\n                # Left neighbor / boundary\n                if i > 0:\n                    mat_A[k, (i - 1) * N + j] = -1.0\n                else:\n                    diag_coeff += 1.0\n                    b_val += 2.0 / h**2 * g_func(0.0, Y[i, j])\n\n                # Right neighbor / boundary\n                if i < N - 1:\n                    mat_A[k, (i + 1) * N + j] = -1.0\n                else:\n                    diag_coeff += 1.0\n                    b_val += 2.0 / h**2 * g_func(1.0, Y[i, j])\n\n                # Bottom neighbor / boundary\n                if j > 0:\n                    mat_A[k, i * N + (j - 1)] = -1.0\n                else:\n                    diag_coeff += 1.0\n                    b_val += 2.0 / h**2 * g_func(X[i, j], 0.0)\n                \n                # Top neighbor / boundary\n                if j < N - 1:\n                    mat_A[k, i * N + (j + 1)] = -1.0\n                else:\n                    diag_coeff += 1.0\n                    b_val += 2.0 / h**2 * g_func(X[i, j], 1.0)\n                \n                mat_A[k, k] = diag_coeff\n                vec_b[k] = b_val\n        \n        mat_A = mat_A / h**2\n        \n        # Solve the sparse linear system\n        mat_A_csr = mat_A.tocsr()\n        u_vec = linalg.spsolve(mat_A_csr, vec_b)\n        \n        # Reshape solution vector to grid\n        u_numerical = u_vec.reshape((N, N))\n        \n        # Compute error\n        u_exact_grid = u_exact_func(X, Y)\n        error_grid = u_numerical - u_exact_grid\n        l2_error = np.sqrt(h**2 * np.sum(error_grid**2))\n        errors.append(l2_error)\n        \n    # Calculate observed order of accuracy p\n    # p = log2(error_coarse / error_fine)\n    p = np.log2(errors[0] / errors[1])\n    return p\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    N_list_full = [16, 32, 64]\n    \n    # We compare the two largest grids, N=32 and N=64\n    N_list_for_order = [32, 64]\n\n    # Test Case A\n    u_A = lambda x, y: np.sin(2 * np.pi * x) * np.sin(3 * np.pi * y)\n    f_A = lambda x, y: ((2 * np.pi)**2 + (3 * np.pi)**2) * u_A(x, y)\n    p_A = compute_order_of_accuracy(u_A, f_A, N_list_for_order)\n\n    # Test Case B\n    u_B = lambda x, y: np.exp(x + y)\n    f_B = lambda x, y: -2 * np.exp(x + y)\n    p_B = compute_order_of_accuracy(u_B, f_B, N_list_for_order)\n\n    # Test Case C\n    u_C = lambda x, y: np.cosh(x) * np.cos(y)\n    f_C = lambda x, y: 0.0 * x * y # Zero function\n    p_C = compute_order_of_accuracy(u_C, f_C, N_list_for_order)\n\n    results = [p_A, p_B, p_C]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join([f'{r:.3f}' for r in results])}]\")\n\nsolve()\n```", "id": "3578589"}, {"introduction": "When simulating time-dependent phenomena like seismic wave propagation, ensuring the numerical stability of the chosen algorithm is paramount. For explicit time-stepping schemes, this stability is governed by the Courant–Friedrichs–Lewy (CFL) condition, which establishes a strict relationship between the wave speed, the spatial grid size, and the maximum allowable time step. This practice delves into the theoretical underpinnings of this crucial constraint, requiring a derivation of the CFL condition for the wave equation and a physical interpretation of why it must be respected [@problem_id:3578541].", "problem": "Consider linear acoustic wave propagation in a homogeneous, isotropic medium of constant wavespeed $c$ occupying a $d$-dimensional rectangular domain $\\Omega = [0,L]^{d}$, with homogeneous Dirichlet boundary conditions $u(\\mathbf{x},t) = 0$ for all $\\mathbf{x} \\in \\partial \\Omega$ and $t \\ge 0$, and smooth initial conditions $u(\\mathbf{x},0) = f(\\mathbf{x})$ and $u_{t}(\\mathbf{x},0) = g(\\mathbf{x})$. The governing partial differential equation is the second-order hyperbolic wave equation $u_{tt}(\\mathbf{x},t) = c^{2} \\nabla^{2} u(\\mathbf{x},t)$.\n\nOn a uniform Cartesian grid with mesh spacing $\\Delta x$ in each coordinate direction, discretize space with the standard second-order centered finite-difference Laplacian and time with the standard second-order centered three-level explicit update. For interior grid indices $\\mathbf{j} = (j_{1},\\dots,j_{d})$ and time levels $t^{n} = n \\Delta t$, the scheme reads\n$$\nu_{\\mathbf{j}}^{n+1} \\;=\\; 2 u_{\\mathbf{j}}^{n} \\;-\\; u_{\\mathbf{j}}^{n-1} \\;+\\; c^{2} \\Delta t^{2} \\sum_{m=1}^{d} \\frac{u_{\\mathbf{j}+\\mathbf{e}_{m}}^{n} \\;-\\; 2 u_{\\mathbf{j}}^{n} \\;+\\; u_{\\mathbf{j}-\\mathbf{e}_{m}}^{n}}{\\Delta x^{2}},\n$$\nwhere $\\mathbf{e}_{m}$ is the unit index vector in the $m$-th coordinate direction. Impose homogeneous Dirichlet boundary conditions at all time levels: $u_{\\mathbf{j}}^{n} = 0$ for $\\mathbf{j}$ on the discrete boundary.\n\nStarting from the governing equation and this explicit scheme, derive the Courant–Friedrichs–Lewy (CFL) stability condition that constrains the time step $\\Delta t$ in terms of $c$, $\\Delta x$, and $d$ by analyzing the boundedness of the scheme’s amplification factor over all admissible discrete wavenumbers. Then, using an argument grounded in operator spectra or discrete energy, explain why the presence of homogeneous Dirichlet boundaries does not permit a larger $\\Delta t$ than the constraint dictated by the interior stencil. Provide your final result as a single closed-form analytic expression for the maximum allowable $\\Delta t$ in terms of $c$, $\\Delta x$, and $d$. Do not include units in your final boxed expression.", "solution": "The fundamental base is the linear acoustic wave equation $u_{tt} = c^{2} \\nabla^{2} u$, which is hyperbolic and admits traveling waves with characteristic speed $c$. A standard second-order accurate explicit finite-difference method combines centered differences in time and space. On a uniform Cartesian grid with spacing $\\Delta x$ in each direction, the discrete Laplacian $\\Delta_{h}$ acting on a grid function $v_{\\mathbf{j}}$ is\n$$\n\\Delta_{h} v_{\\mathbf{j}} \\;=\\; \\sum_{m=1}^{d} \\frac{v_{\\mathbf{j}+\\mathbf{e}_{m}} \\;-\\; 2 v_{\\mathbf{j}} \\;+\\; v_{\\mathbf{j}-\\mathbf{e}_{m}}}{\\Delta x^{2}}.\n$$\nThe explicit three-level update for the wave equation is\n$$\nu_{\\mathbf{j}}^{n+1} \\;=\\; 2 u_{\\mathbf{j}}^{n} \\;-\\; u_{\\mathbf{j}}^{n-1} \\;+\\; c^{2} \\Delta t^{2} \\,\\Delta_{h} u_{\\mathbf{j}}^{n}.\n$$\n\nTo derive the Courant–Friedrichs–Lewy (CFL) stability condition, we perform a von Neumann analysis, which, for linear constant-coefficient stencils, assesses the amplification factor of discrete plane waves. Although the physical problem has homogeneous Dirichlet boundary conditions, the CFL constraint for an explicit local stencil arises from the interior update; thus it suffices to analyze modes that locally resemble plane waves. Consider the discrete Fourier mode\n$$\nu_{\\mathbf{j}}^{n} \\;=\\; \\rho^{n} \\exp\\!\\Big( i \\sum_{m=1}^{d} j_{m} \\theta_{m} \\Big),\n$$\nwith phase angles $\\theta_{m} \\in [0,\\pi]$ capturing the highest resolvable grid frequencies. Substituting this ansatz into the update yields, using linearity and separability,\n$$\n\\rho^{n+1} \\exp\\!\\Big( i \\sum_{m} j_{m} \\theta_{m} \\Big) \\;-\\; 2 \\rho^{n} \\exp\\!\\Big( i \\sum_{m} j_{m} \\theta_{m} \\Big) \\;+\\; \\rho^{n-1} \\exp\\!\\Big( i \\sum_{m} j_{m} \\theta_{m} \\Big)\n$$\n$$\n=\\; c^{2} \\Delta t^{2} \\sum_{m=1}^{d} \\frac{\\exp\\!\\big( i (j_{m}+1) \\theta_{m} \\big) + \\exp\\!\\big( i (j_{m}-1) \\theta_{m} \\big) - 2 \\exp\\!\\big( i j_{m} \\theta_{m} \\big)}{\\Delta x^{2}} \\prod_{k \\neq m} \\exp\\!\\big( i j_{k} \\theta_{k} \\big) \\,\\rho^{n}.\n$$\nCanceling the common factor $\\exp\\!\\big( i \\sum_{m} j_{m} \\theta_{m} \\big) \\rho^{n}$ and using $\\exp(i \\theta) + \\exp(-i \\theta) - 2 = 2 (\\cos \\theta - 1) = -4 \\sin^{2}(\\theta/2)$, we obtain the scalar recurrence for the amplification factor $\\rho$:\n$$\n\\rho^{2} \\;-\\; 2 \\rho \\;+\\; 1 \\;=\\; -\\, 4 \\rho \\, \\sum_{m=1}^{d} \\lambda^{2} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big),\n$$\nwhere $\\lambda := \\frac{c \\Delta t}{\\Delta x}$ is the dimensionless Courant number for each coordinate when the spacing is uniform. Rearranging,\n$$\n\\rho^{2} \\;+\\; \\rho \\Big( 4 \\sum_{m=1}^{d} \\lambda^{2} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big) \\;-\\; 2 \\Big) \\;+\\; 1 \\;=\\; 0.\n$$\nLet $z := \\rho$ and divide by $z$ to obtain\n$$\nz \\;+\\; \\frac{1}{z} \\;=\\; 2 \\;-\\; 4 \\sum_{m=1}^{d} \\lambda^{2} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big).\n$$\nFor stability of a second-order centered scheme for a conservative hyperbolic equation, the amplification factors must be unimodular, i.e. $|z| = 1$, so we can set $z = \\exp(i \\Omega \\Delta t)$ for some real discrete frequency $\\Omega$. Then $z + z^{-1} = 2 \\cos(\\Omega \\Delta t)$, implying\n$$\n2 \\cos(\\Omega \\Delta t) \\;=\\; 2 \\;-\\; 4 \\sum_{m=1}^{d} \\lambda^{2} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big).\n$$\nA necessary and sufficient condition for a real $\\Omega$ uniformly over all admissible $\\theta_{m}$ is that the right-hand side lies in the interval $[-2,2]$ for all $\\theta_{m}$. Therefore,\n$$\n\\Big| \\, 2 \\;-\\; 4 \\sum_{m=1}^{d} \\lambda^{2} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big) \\, \\Big| \\;\\le\\; 2\n\\quad \\Longleftrightarrow \\quad\n0 \\;\\le\\; \\sum_{m=1}^{d} \\lambda^{2} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big) \\;\\le\\; 1.\n$$\nBecause $\\sin^{2}(\\cdot)$ is bounded by $1$, the worst-case over all resolvable grid wavenumbers is attained when each $\\sin^{2}(\\theta_{m}/2)$ approaches $1$. Hence a sufficient and sharp bound is\n$$\n\\sum_{m=1}^{d} \\lambda^{2} \\;\\le\\; 1.\n$$\nWith uniform spacing in all directions, $\\lambda$ is the same for each $m$, yielding\n$$\nd \\lambda^{2} \\;\\le\\; 1\n\\quad \\Longrightarrow \\quad\n\\lambda \\;\\le\\; \\frac{1}{\\sqrt{d}}\n\\quad \\Longrightarrow \\quad\n\\Delta t \\;\\le\\; \\frac{\\Delta x}{c \\sqrt{d}}.\n$$\nThis is the Courant–Friedrichs–Lewy (CFL) stability condition for the explicit second-order accurate centered scheme for the wave equation on a $d$-dimensional uniform grid.\n\nWe now explain why homogeneous Dirichlet boundaries do not relax this interior time step constraint. There are two complementary perspectives grounded in first principles:\n\n1. Spectral viewpoint. The discrete Laplacian with homogeneous Dirichlet boundary conditions is a symmetric negative definite matrix whose eigenvectors are tensor products of sines, and whose eigenvalues are\n$$\n\\mu_{\\mathbf{k}} \\;=\\; \\frac{2}{\\Delta x^{2}} \\sum_{m=1}^{d} \\big( \\cos(\\theta_{m}) - 1 \\big)\n\\;=\\; -\\, \\frac{4}{\\Delta x^{2}} \\sum_{m=1}^{d} \\sin^{2}\\!\\Big( \\frac{\\theta_{m}}{2} \\Big),\n$$\nwith discrete angles $\\theta_{m}$ determined by the grid and boundary. The spectral radius $|\\mu_{\\max}|$ is bounded above by $\\frac{4d}{\\Delta x^{2}}$, the same as the periodic interior stencil bound. As the grid is refined, the largest admissible $\\sin^{2}$ approaches $1$, so the Dirichlet spectrum asymptotically saturates the same bound as the interior plane-wave analysis. The explicit update multiplies this spectrum by $c^{2} \\Delta t^{2}$, and the three-level stability requirement derived above depends only on the supremum of $\\sum_{m} \\sin^{2}(\\theta_{m}/2)$, which Dirichlet boundary conditions cannot increase beyond $1$; thus they do not allow a larger $\\Delta t$.\n\n2. Local energy viewpoint. The CFL constraint reflects the requirement that numerical information does not propagate across more than one grid cell per time step relative to the characteristic speed $c$. This locality is controlled by the interior stencil width and the wave speed, independent of boundary conditions. Homogeneous Dirichlet boundaries restrict global mode shapes but do not change the local coupling in the interior update. Therefore, the most restrictive local mode—corresponding to grid-scale oscillations—still dictates the stability limit, and boundary enforcement does not relax the interior time step constraint.\n\nHence, the maximum allowable time step for stability of this explicit second-order accurate scheme on a $d$-dimensional uniform grid is\n$$\n\\Delta t_{\\max} \\;=\\; \\frac{\\Delta x}{c \\sqrt{d}}.\n$$", "answer": "$$\\boxed{\\frac{\\Delta x}{c \\sqrt{d}}}$$", "id": "3578541"}, {"introduction": "Solving realistic, large-scale geophysical models often pushes beyond the limits of a single processor, necessitating the use of parallel computing. Domain decomposition methods are a cornerstone of modern parallel solvers, allowing a large problem to be broken into smaller, coupled sub-problems. This advanced practice challenges you to implement an overlapping Schwarz method for the acoustic wave system, using physically-derived transmission conditions based on characteristic variables to ensure the subdomains communicate correctly and efficiently [@problem_id:3578593].", "problem": "You are to implement a two-subdomain overlapping Schwarz method for the one-dimensional acoustic Initial Boundary Value Problem (IBVP) and use characteristic-variable-based transmission conditions at the overlap interfaces. The governing first-order system arises from linearized conservation of mass and momentum and is given by\n$$\n\\partial_t p(x,t) + \\kappa \\,\\partial_x v(x,t) = 0, \\quad \\partial_t v(x,t) + \\frac{1}{\\rho}\\,\\partial_x p(x,t) = 0,\n$$\nwhere $p(x,t)$ is acoustic pressure in $\\mathrm{Pa}$, $v(x,t)$ is particle velocity in $\\mathrm{m/s}$, $\\rho$ is density in $\\mathrm{kg/m^3}$, and $\\kappa$ is bulk modulus in $\\mathrm{Pa}$. The acoustic waves propagate at speed $c=\\sqrt{\\kappa/\\rho}$ in $\\mathrm{m/s}$ and have impedance $Z=\\rho c$ in $\\mathrm{Pa\\cdot s/m}$.\n\nThe characteristic variables for this hyperbolic system are\n$$\nw_+(x,t) = p(x,t) + Z\\,v(x,t), \\quad w_-(x,t) = p(x,t) - Z\\,v(x,t),\n$$\nwhich satisfy the transport equations\n$$\n\\partial_t w_+(x,t) + c\\,\\partial_x w_+(x,t) = 0, \\quad \\partial_t w_-(x,t) - c\\,\\partial_x w_-(x,t) = 0.\n$$\nAt the physical domain boundaries $x=0$ and $x=L$, use absorbing boundary conditions expressed in terms of incoming characteristics:\n$$\nw_+(0,t) = 0 \\quad \\text{and} \\quad w_-(L,t) = 0.\n$$\n\nYou must split the spatial domain $[0,L]$ into two overlapping subdomains $\\Omega_1 = [0, x_m + \\delta]$ and $\\Omega_2 = [x_m - \\delta, L]$, where $x_m=L/2$ and the overlap half-width is $\\delta>0$. Let the overlap be defined by a fixed number of grid points $o\\in\\mathbb{N}$ so that $2\\delta = 2 o\\,\\Delta x$, where $\\Delta x$ is the grid spacing. At each time step, perform inner Schwarz iterations in which each subdomain solves the discrete IBVP with transmission conditions imposed on the overlap via equality of incoming characteristics to the neighbor’s outgoing characteristics at the same physical location. Specifically, if $x_{\\mathrm{LB}}$ denotes the right boundary of $\\Omega_1$ and $x_{\\mathrm{RB}}$ denotes the left boundary of $\\Omega_2$, then at inner iteration $m$ and time level $t_n$ impose\n$$\nw_-^{(m+1)}(x_{\\mathrm{LB}}, t_n) = w_-^{(m)}_{\\Omega_2}(x_{\\mathrm{LB}}, t_n), \\quad w_+^{(m+1)}(x_{\\mathrm{RB}}, t_n) = w_+^{(m)}_{\\Omega_1}(x_{\\mathrm{RB}}, t_n).\n$$\nTranslate these characteristic equalities into ghost values needed by your finite difference discretization.\n\nDiscretize the system on a uniform grid using a staggered explicit scheme: store $p$ at integer grid points and $v$ at half-integer points, and use the update\n$$\nv^{n+\\frac{1}{2}}_{i+\\frac{1}{2}} = v^{n-\\frac{1}{2}}_{i+\\frac{1}{2}} - \\frac{\\Delta t}{\\rho\\,\\Delta x}\\big(p^n_{i+1} - p^n_i\\big),\n$$\n$$\np^{n+1}_i = p^n_i - \\frac{\\Delta t\\,\\kappa}{\\Delta x}\\big(v^{n+\\frac{1}{2}}_{i+\\frac{1}{2}} - v^{n+\\frac{1}{2}}_{i-\\frac{1}{2}}\\big).\n$$\nUse the absorbing and transmission conditions to supply ghost $v$ values at subdomain boundaries via\n$$\n\\text{Left physical boundary: } w_+(0,t)=0 \\Rightarrow v_{-\\frac{1}{2}} = -\\frac{p_0}{Z}, \\quad\n\\text{Right physical boundary: } w_-(L,t)=0 \\Rightarrow v_{N-\\frac{1}{2}} = \\frac{p_{N-1}}{Z},\n$$\nand, at overlap boundaries,\n$$\n\\text{For }\\Omega_1\\text{ at }x_{\\mathrm{LB}}: \\quad v_{i_{\\mathrm{LB}}+\\frac{1}{2}} = \\frac{p_{i_{\\mathrm{LB}}} - w_-^{\\mathrm{in}}}{Z}, \\quad\n\\text{For }\\Omega_2\\text{ at }x_{\\mathrm{RB}}: \\quad v_{i_{\\mathrm{RB}}-\\frac{1}{2}} = \\frac{w_+^{\\mathrm{in}} - p_{i_{\\mathrm{RB}}}}{Z}.\n$$\nDefine outgoing characteristics within each subdomain at the required overlap locations using collocated values by averaging staggered velocities to the pressure nodes:\n$$\nv_i^{\\text{node}} \\approx \\frac{1}{2}\\left(v_{i+\\frac{1}{2}} + v_{i-\\frac{1}{2}}\\right), \\quad\nw_+ \\approx p_i + Z\\,v_i^{\\text{node}}, \\quad w_- \\approx p_i - Z\\,v_i^{\\text{node}}.\n$$\n\nInitialize the IBVP with\n$$\np(x,0) = A\\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right), \\quad v(x,0)=0,\n$$\nwhere $A$ is amplitude in $\\mathrm{Pa}$, $x_0$ is center in $\\mathrm{m}$, and $\\sigma$ is width in $\\mathrm{m}$. Use the same initial data restricted to each subdomain for Schwarz iterations at each time step.\n\nYour program must:\n- Implement the above scheme, performing at each time step inner Schwarz iterations until the change in transmitted characteristics is below a tolerance $\\varepsilon$ or a maximum number of inner iterations is reached. Quantify the inner iteration change by the maximum absolute change of the transmitted characteristics between successive inner iterations.\n- For each specified overlap width $o$, run the simulation over a fixed number of time steps and report the average number of inner iterations per time step required to meet the tolerance, rounded to three decimals.\n\nPhysical and numerical parameters:\n- Domain length: $L = 1000\\,\\mathrm{m}$.\n- Density: $\\rho = 2000\\,\\mathrm{kg/m^3}$.\n- Wave speed: $c = 2000\\,\\mathrm{m/s}$.\n- Bulk modulus: $\\kappa = \\rho c^2$.\n- Impedance: $Z = \\rho c$.\n- Number of pressure grid points: $N = 201$, so $\\Delta x = \\frac{L}{N-1}$.\n- Time step: $\\Delta t = 0.4\\,\\frac{\\Delta x}{c}$ (radians do not apply here).\n- Number of time steps: $N_t = 80$.\n- Initial condition parameters: $A = 1\\,\\mathrm{Pa}$, $x_0 = \\frac{L}{3}$, $\\sigma = 0.05\\,L$.\n- Inner iteration tolerance: $\\varepsilon = 10^{-8}$.\n- Maximum inner iterations per time step: $M_{\\max} = 50$.\n\nTest suite (each case is a distinct overlap half-width $o$ in grid points):\n- Case $1$: $o=1$.\n- Case $2$: $o=5$.\n- Case $3$: $o=20$.\n- Case $4$: $o=45$.\n\nFor each case, your program must output the average inner iteration count across all time steps as a float. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). No units should be included in the output values. The results must be in the order of the test suite cases.", "solution": "The user-provided problem statement has been evaluated and is deemed to be valid. It is scientifically grounded, well-posed, objective, and contains sufficient information to construct a unique solution. The anlaysis now proceeds with the formulation and implementation of the solution.\n\nThe problem requires the implementation of an overlapping Schwarz domain decomposition method for the 1D acoustic wave equations. The method is based on exchanging characteristic variables at the artificial boundaries created by the domain splitting. The overall algorithm proceeds by discretizing the problem in time and, at each time step, iteratively solving for the transmission boundary conditions before advancing the solution.\n\nThe governing equations form a first-order hyperbolic system for acoustic pressure $p(x,t)$ and particle velocity $v(x,t)$:\n$$\n\\partial_t p + \\kappa \\,\\partial_x v = 0\n$$\n$$\n\\partial_t v + \\frac{1}{\\rho}\\,\\partial_x p = 0\n$$\nwhere $\\rho$ is the density, $\\kappa$ is the bulk modulus, $c = \\sqrt{\\kappa/\\rho}$ is the wave speed, and $Z = \\rho c$ is the acoustic impedance. The system is discretized using a staggered-grid finite-difference scheme (leapfrog):\n$$\nv^{n+\\frac{1}{2}}_{i+\\frac{1}{2}} = v^{n-\\frac{1}{2}}_{i+\\frac{1}{2}} - \\frac{\\Delta t}{\\rho\\,\\Delta x}\\left(p^n_{i+1} - p^n_i\\right)\n$$\n$$\np^{n+1}_i = p^n_i - \\frac{\\Delta t\\,\\kappa}{\\Delta x}\\left(v^{n+\\frac{1}{2}}_{i+\\frac{1}{2}} - v^{n+\\frac{1}{2}}_{i-\\frac{1}{2}}\\right)\n$$\nHere, pressure $p_i^n$ is defined at grid points $x_i = i\\Delta x$ and time levels $t_n = n\\Delta t$, while velocity $v_{i+1/2}^{n+1/2}$ is defined at staggered grid points $x_{i+1/2} = (i+1/2)\\Delta x$ and half-integer time levels $t_{n+1/2} = (n+1/2)\\Delta t$.\n\nThe spatial domain $[0, L]$ is partitioned into two overlapping subdomains: $\\Omega_1 = [0, x_m + \\delta]$ and $\\Omega_2 = [x_m - \\delta, L]$, where $x_m = L/2$ is the midpoint and $\\delta = o\\Delta x$ is the overlap half-width defined by $o$ grid cells. At each time step $t_n$, we solve for the transmission conditions at the artificial boundaries $x_{\\mathrm{RB}} = x_m - \\delta$ (left boundary of $\\Omega_2$) and $x_{\\mathrm{LB}} = x_m + \\delta$ (right boundary of $\\Omega_1$). This is achieved through an inner iterative process (Schwarz iterations).\n\nThe algorithm for a single time step from $t_n$ to $t_{n+1}$ is as follows:\n\n1.  **Initialize Schwarz Iteration**: At the beginning of the time step, we possess the fields $p^n$ and $v^{n-1/2}$ on both subdomains. We initialize the incoming characteristic variables, $w_{+}^{\\mathrm{in}}$ for $\\Omega_2$ and $w_{-}^{\\mathrm{in}}$ for $\\Omega_1$, typically from their converged values at the previous time step or zero for the first step.\n\n2.  **Inner Iteration Loop**: We iterate until the change in the transmitted characteristics falls below a tolerance $\\varepsilon$ or a maximum number of iterations $M_{\\max}$ is reached. In each inner iteration $m$:\n    a.  **Calculate Outgoing Characteristics**: Based on the state at time $t_n$ (i.e., using $p^n$ and $v^{n-1/2}$), each subdomain calculates its outgoing characteristic at the relevant communication boundary. The problem specifies a local averaging of staggered velocities to obtain a nodal velocity for this calculation:\n        $$\n        v_i^{\\text{node}}(t_n) \\approx \\frac{1}{2}\\left(v_{i+\\frac{1}{2}}^{n-\\frac{1}{2}} + v_{i-\\frac{1}{2}}^{n-\\frac{1}{2}}\\right)\n        $$\n        The outgoing characteristics are then:\n        -   From $\\Omega_1$ at $x_{\\mathrm{RB}}$: $w_{+, \\text{out}} = p_1^n(x_{\\mathrm{RB}}) + Z v_{1, \\text{node}}^n(x_{\\mathrm{RB}})$\n        -   From $\\Omega_2$ at $x_{\\mathrm{LB}}$: $w_{-, \\text{out}} = p_2^n(x_{\\mathrm{LB}}) - Z v_{2, \\text{node}}^n(x_{\\mathrm{LB}})$\n    b.  **Exchange Data (Jacobi Update)**: The incoming characteristics for the next iteration are updated with the outgoing characteristics just calculated:\n        $$\n        w_{+, \\text{new}}^{\\mathrm{in}} = w_{+, \\text{out}} \\quad (\\text{for } \\Omega_2)\n        $$\n        $$\n        w_{-, \\text{new}}^{\\mathrm{in}} = w_{-, \\text{out}} \\quad (\\text{for } \\Omega_1)\n        $$\n    c.  **Check Convergence**: The convergence criterion is applied to the change in the incoming characteristic values:\n        $$\n        \\max\\left(\\left|w_{+, \\text{new}}^{\\mathrm{in}} - w_{+, \\text{old}}^{\\mathrm{in}}\\right|, \\left|w_{-, \\text{new}}^{\\mathrm{in}} - w_{-, \\text{old}}^{\\mathrm{in}}\\right|\\right) < \\varepsilon\n        $$\n    d.  Update the characteristic values for the next inner iteration and continue the loop if not converged.\n\n3.  **Time Step Advancement**: Once the inner iterations have converged (or timed out), the final values of $w_{+}^{\\mathrm{in}}$ and $w_{-}^{\\mathrm{in}}$ are used to compute the required ghost-cell velocity values for the time-stepping of each subdomain.\n    -   For $\\Omega_1$, the physical (absorbing) boundary condition at $x=0$ is $v_{-1/2}^{n+1/2} = -p_0^n/Z$. The transmission condition at $x=x_{\\mathrm{LB}}$ provides the ghost value: $v_{i_{\\mathrm{LB}}+1/2}^{n+1/2} = (p_{i_{\\mathrm{LB}}}^n - w_{-}^{\\mathrm{in}})/Z$.\n    -   For $\\Omega_2$, the transmission condition at $x=x_{\\mathrm{RB}}$ provides the ghost value: $v_{i_{\\mathrm{RB}}-1/2}^{n+1/2} = (w_{+}^{\\mathrm{in}} - p_{i_{\\mathrm{RB}}}^n)/Z$. The physical boundary condition at $x=L$ is $v_{N-1/2}^{n+1/2} = p_{N-1}^n/Z$.\n    -   With these boundary data, the fields on both subdomains are advanced in parallel to obtain $p_1^{n+1}, v_1^{n+1/2}$ and $p_2^{n+1}, v_2^{n+1/2}$.\n\n4.  **Repeat**: This process is repeated for the specified number of time steps $N_t$. The average number of inner iterations per time step is recorded for each specified overlap width $o$.\n\nThe initial condition $v(x,0)=0$ is handled by setting the velocity field at the initial half-time-step, $v^{n-1/2}$ for $n=0$, to zero, i.e., $v_{i+1/2}^{-1/2} = 0$.\n\nThe implementation will simulate this process for the given set of physical and numerical parameters and for each value of overlap width $o$ in the test suite.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a two-subdomain overlapping Schwarz method for the 1D acoustic\n    Initial Boundary Value Problem (IBVP) using characteristic-variable-based\n    transmission conditions.\n    \"\"\"\n    \n    # --- Physical and numerical parameters ---\n    L = 1000.0  # Domain length (m)\n    rho = 2000.0  # Density (kg/m^3)\n    c = 2000.0  # Wave speed (m/s)\n    N_p_total = 201  # Number of pressure grid points in total domain\n    N_t = 80  # Number of time steps\n    A = 1.0  # Initial pressure amplitude (Pa)\n    x0 = L / 3.0  # Center of initial Gaussian\n    sigma = 0.05 * L  # Width of initial Gaussian\n    epsilon = 1e-8  # Inner iteration tolerance\n    M_max = 50  # Maximum inner iterations\n\n    # --- Derived parameters ---\n    kappa = rho * c**2\n    Z = rho * c\n    dx = L / (N_p_total - 1)\n    dt = 0.4 * dx / c\n    i_mid = (N_p_total - 1) // 2\n\n    # Test cases for overlap half-width in grid points\n    test_cases = [1, 5, 20, 45]\n    results = []\n\n    for o in test_cases:\n        # --- Subdomain Setup ---\n        # Subdomain 1 (left)\n        N_p1 = i_mid + o + 1\n        x1 = np.linspace(0.0, (i_mid + o) * dx, N_p1)\n        p1 = A * np.exp(-((x1 - x0)**2) / (2 * sigma**2))\n        v1_nmhalf = np.zeros(N_p1 - 1)\n\n        # Subdomain 2 (right)\n        N_p2 = (N_p_total - 1) - (i_mid - o) + 1\n        x2_start_idx = i_mid - o\n        x2 = np.linspace(x2_start_idx * dx, L, N_p2)\n        p2 = A * np.exp(-((x2 - x0)**2) / (2 * sigma**2))\n        v2_nmhalf = np.zeros(N_p2 - 1)\n        \n        # --- Communication Indices Setup ---\n        # For Omega_2 to send w- to Omega_1's right boundary (x_LB)\n        # Global p-index: i_mid + o\n        # Local p-index in Omega_2 grid: (i_mid + o) - (i_mid - o) = 2*o\n        comm_idx_d2 = 2 * o\n        \n        # For Omega_1 to send w+ to Omega_2's left boundary (x_RB)\n        # Global p-index: i_mid - o\n        # Local p-index in Omega_1 grid: i_mid - o\n        comm_idx_d1 = i_mid - o\n\n        # Schwarz iteration variables\n        w_minus_in = 0.0  # Incoming characteristic for Omega_1\n        w_plus_in = 0.0   # Incoming characteristic for Omega_2\n        total_inner_iters = 0\n\n        # --- Time Stepping Loop ---\n        for n in range(N_t):\n            inner_iter_count = 0\n            \n            # --- Inner Schwarz Loop (to converge transmission conditions) ---\n            for m in range(M_max):\n                inner_iter_count += 1\n                w_minus_in_old = w_minus_in\n                w_plus_in_old = w_plus_in\n\n                # Calculate outgoing characteristics (Jacobi-style exchange)\n                # Note: p is at t_n, v is at t_{n-1/2}.\n                # The nodal velocity v_node(t_n) is approximated using v(t_{n-1/2}).\n                \n                # Omega_2 computes its outgoing w- at x_LB\n                # v_node is at local index comm_idx_d2\n                v2_node_comm = 0.5 * (v2_nmhalf[comm_idx_d2] + v2_nmhalf[comm_idx_d2 - 1])\n                w_minus_in = p2[comm_idx_d2] - Z * v2_node_comm\n\n                # Omega_1 computes its outgoing w+ at x_RB\n                # v_node is at local index comm_idx_d1\n                v1_node_comm = 0.5 * (v1_nmhalf[comm_idx_d1] + v1_nmhalf[comm_idx_d1 - 1])\n                w_plus_in = p1[comm_idx_d1] + Z * v1_node_comm\n\n                # Check convergence of the exchanged characteristic values\n                change = max(abs(w_minus_in - w_minus_in_old), abs(w_plus_in - w_plus_in_old))\n                if change < epsilon:\n                    break\n            \n            total_inner_iters += inner_iter_count\n\n            # --- Evolve Subdomains by one time step using converged BCs ---\n            \n            # Subdomain 1\n            v1_nhalf = v1_nmhalf - (dt / (rho * dx)) * (p1[1:] - p1[:-1])\n            p1_new = np.zeros_like(p1)\n            \n            ghost_v_left1 = -p1[0] / Z  # Physical Absorbing BC at x=0\n            ghost_v_right1 = (p1[-1] - w_minus_in) / Z # Transmission Condition\n            \n            p1_new[0] = p1[0] - (dt * kappa / dx) * (v1_nhalf[0] - ghost_v_left1)\n            p1_new[1:-1] = p1[1:-1] - (dt * kappa / dx) * (v1_nhalf[1:] - v1_nhalf[:-1])\n            p1_new[-1] = p1[-1] - (dt * kappa / dx) * (ghost_v_right1 - v1_nhalf[-1])\n            \n            # Subdomain 2\n            v2_nhalf = v2_nmhalf - (dt / (rho * dx)) * (p2[1:] - p2[:-1])\n            p2_new = np.zeros_like(p2)\n            \n            ghost_v_left2 = (w_plus_in - p2[0]) / Z # Transmission Condition\n            ghost_v_right2 = p2[-1] / Z # Physical Absorbing BC at x=L\n\n            p2_new[0] = p2[0] - (dt * kappa / dx) * (v2_nhalf[0] - ghost_v_left2)\n            p2_new[1:-1] = p2[1:-1] - (dt * kappa / dx) * (v2_nhalf[1:] - v2_nhalf[:-1])\n            p2_new[-1] = p2[-1] - (dt * kappa / dx) * (ghost_v_right2 - v2_nhalf[-1])\n\n            # Update fields for the next time step\n            p1, v1_nmhalf = p1_new, v1_nhalf\n            p2, v2_nmhalf = p2_new, v2_nhalf\n\n        # Calculate and store the average number of iterations for this case\n        avg_iters = total_inner_iters / N_t\n        results.append(round(avg_iters, 3))\n    \n    # Print the results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3578593"}]}