{"hands_on_practices": [{"introduction": "The first step in simulating spin dynamics is to translate the continuous physical model onto a discrete computational grid. This practice focuses on the powerful exchange interaction, the quantum mechanical effect responsible for ferromagnetic and antiferromagnetic ordering. By starting from the continuous energy functional, you will derive its discrete finite-difference form and learn how to correctly implement the physically important zero-flux boundary conditions, a foundational skill for any micromagnetic code development [@problem_id:3460200].", "problem": "Consider a ferromagnetic cuboid discretized on a uniform, cell-centered, cubic finite-difference grid with cell size $\\Delta$ along each Cartesian direction. The magnetization field $\\mathbf{m}(\\mathbf{r},t)$ is a unit vector field. The micromagnetic exchange energy density is given by $A |\\nabla \\mathbf{m}|^2$, where $A$ is the exchange stiffness. In the Landau–Lifshitz–Gilbert dynamics, the corresponding exchange effective field is obtained from the variational derivative of the exchange energy with respect to $\\mathbf{m}$.\n\nStarting from the exchange energy functional and using only standard finite-volume or finite-difference approximations on the aforementioned grid, derive a discrete exchange field operator that is proportional to a discrete Laplacian acting component-wise on $\\mathbf{m}$. Impose the zero normal derivative boundary condition $\\partial_{n} \\mathbf{m} = 0$ on the boundary of the cuboid. Your derivation should:\n- Begin from the exchange energy integral and a consistent discrete approximation of this integral on the grid.\n- Use a variational argument to obtain the discrete operator that plays the role of the Laplacian.\n- Explain how the zero normal derivative boundary condition is incorporated at boundary cells, and why this implementation is consistent with the variational derivation.\n\nFinally, consider a boundary cell that lies on the planar boundary with outward unit normal along the negative $x$-direction (i.e., the face at $x=0$ so that this cell has no $-x$ neighbor). For one Cartesian component of $\\mathbf{m}$, write the seven-point finite-difference stencil coefficients of the discrete Laplacian at this boundary cell, listing the coefficients in the order $[\\text{center}, +x, -x, +y, -y, +z, -z]$. Express your final answer in terms of $\\Delta$ as a single row vector. No numerical evaluation is required.", "solution": "The problem requires the derivation of a discrete exchange field operator on a finite-difference grid, starting from the continuous exchange energy functional. The derivation must employ a variational argument and incorporate zero normal derivative boundary conditions. Finally, the specific stencil coefficients for the resulting discrete Laplacian operator at a boundary cell must be determined.\n\nThe continuous exchange energy functional for a ferromagnetic body occupying a volume $V$ is given by:\n$$E_{ex} = \\int_V A |\\nabla \\mathbf{m}|^2 dV$$\nwhere $A$ is the exchange stiffness constant and $\\mathbf{m} = (m_x, m_y, m_z)$ is the normalized magnetization vector field, i.e., $|\\mathbf{m}| = 1$. The term $|\\nabla \\mathbf{m}|^2$ is a shorthand for the sum of the squared gradients of each component:\n$$|\\nabla \\mathbf{m}|^2 = |\\nabla m_x|^2 + |\\nabla m_y|^2 + |\\nabla m_z|^2 = \\sum_{\\alpha \\in \\{x,y,z\\}} \\left( \\left(\\frac{\\partial m_\\alpha}{\\partial x}\\right)^2 + \\left(\\frac{\\partial m_\\alpha}{\\partial y}\\right)^2 + \\left(\\frac{\\partial m_\\alpha}{\\partial z}\\right)^2 \\right)$$\n\nTo discretize this energy on a uniform cubic grid with cell size $\\Delta$, we can approximate the integral as a sum over all cells. However, a more robust method for derivative-based energies is to discretize the energy contributions associated with the links between adjacent cells. We approximate the spatial derivative on a link connecting two adjacent cells and sum the energy density over the volume. For instance, the term $\\int (\\frac{\\partial m_\\alpha}{\\partial x})^2 dV$ can be discretized by considering the derivative between cells $(i,j,k)$ and $(i+1,j,k)$. The derivative is approximated as $\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta}$. The energy density is $(\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta})^2$. Associating this energy with a volume element of $\\Delta^3$ (e.g., a volume centered on the face between the cells), the energy contribution is $A (\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta})^2 \\Delta^3 = A \\Delta (m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k})^2$.\n\nSumming over all nearest-neighbor links in the grid, the total discrete exchange energy $E_{ex}^{disc}$ can be written as:\n$$E_{ex}^{disc} = A \\Delta \\sum_{\\langle p, p' \\rangle} |\\mathbf{m}_p - \\mathbf{m}_{p'}|^2$$\nwhere the sum is over all unique nearest-neighbor pairs of cells $\\langle p, p' \\rangle$ in the grid. An equivalent way to write this to avoid double counting is to sum over each cell $p = (i,j,k)$ and its neighbors in the positive-axis directions:\n$$E_{ex}^{disc} = A \\Delta \\sum_{i,j,k} \\left( |\\mathbf{m}_{i+1,j,k} - \\mathbf{m}_{i,j,k}|^2 + |\\mathbf{m}_{i,j+1,k} - \\mathbf{m}_{i,j,k}|^2 + |\\mathbf{m}_{i,j,k+1} - \\mathbf{m}_{i,j,k}|^2 \\right)$$\nwhere $|\\mathbf{v}|^2 = v_x^2 + v_y^2 + v_z^2$.\n\nThe exchange effective field $\\mathbf{H}_{ex}$ is derived from the variational derivative of the energy. In the discrete case, the field at cell $p$ is proportional to $-\\frac{\\partial E_{ex}^{disc}}{\\partial \\mathbf{m}_p}$. We seek an operator that is proportional to this derivative. Let's compute one component of this derivative, for an arbitrary component $\\alpha \\in \\{x,y,z\\}$ at an interior cell $p_0 = (i,j,k)$.\n$$\\frac{\\partial E_{ex}^{disc}}{\\partial m_{\\alpha,p_0}} = \\frac{\\partial}{\\partial m_{\\alpha,i,j,k}} E_{ex}^{disc}$$\nThe terms in $E_{ex}^{disc}$ that depend on $\\mathbf{m}_{i,j,k}$ are those connecting cell $(i,j,k)$ to its six nearest neighbors: $(i\\pm 1,j,k)$, $(i,j\\pm 1,k)$, and $(i,j,k\\pm 1)$. Let's denote $\\mathbf{m}_{i,j,k}$ as $\\mathbf{m}_0$ and its neighbors as $\\mathbf{m}_{\\pm x}, \\mathbf{m}_{\\pm y}, \\mathbf{m}_{\\pm z}$. The relevant part of the energy is:\n$$E_{rel} = A \\Delta \\left( |\\mathbf{m}_{+x}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-x}|^2 + |\\mathbf{m}_{+y}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-y}|^2 + |\\mathbf{m}_{+z}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-z}|^2 \\right)$$\nThe derivative with respect to $m_{\\alpha,0}$ is:\n$$\\frac{\\partial E_{rel}}{\\partial m_{\\alpha,0}} = A \\Delta \\left( -2(m_{\\alpha,+x}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-x}) -2(m_{\\alpha,+y}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-y}) -2(m_{\\alpha,+z}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-z}) \\right)$$\nCollecting terms for $m_{\\alpha,0}$:\n$$\\frac{\\partial E_{rel}}{\\partial m_{\\alpha,0}} = 2A\\Delta \\left( 6m_{\\alpha,0} - (m_{\\alpha,+x} + m_{\\alpha,-x} + m_{\\alpha,+y} + m_{\\alpha,-y} + m_{\\alpha,+z} + m_{\\alpha,-z}) \\right)$$\nThe standard seven-point finite-difference approximation of the Laplacian operator $\\nabla^2$ acting on a scalar field $f$ is:\n$$(\\nabla_d^2 f)_i = \\frac{f_{i+1,j,k} + f_{i-1,j,k} + f_{i,j+1,k} + f_{i,j-1,k} + f_{i,j,k+1} + f_{i,j,k-1} - 6f_{i,j,k}}{\\Delta^2}$$\nComparing this with our derivative, we find:\n$$\\frac{\\partial E_{ex}^{disc}}{\\partial m_{\\alpha,i,j,k}} = -2A\\Delta \\Delta^2 (\\nabla_d^2 m_\\alpha)_{i,j,k} = -2A\\Delta^3 (\\nabla_d^2 m_\\alpha)_{i,j,k}$$\nThe effective field operator at cell $p$ is therefore proportional to $-\\frac{\\partial E_{ex}^{disc}}{\\partial \\mathbf{m}_p}$, which is proportional to $2A\\Delta^3 \\nabla_d^2 \\mathbf{m}_p$. Thus, the discrete exchange field operator is proportional to the discrete Laplacian acting component-wise on $\\mathbf{m}$.\n\nNext, we incorporate the boundary condition $\\partial_n \\mathbf{m} = 0$, where $\\partial_n$ is the derivative along the outward normal. This is a natural boundary condition for the exchange energy minimization, as seen from the variation of the continuous functional:\n$$\\delta E_{ex} = 2A \\int_V (\\nabla \\mathbf{m}) \\cdot (\\nabla \\delta \\mathbf{m}) dV = \\int_S 2A (\\delta\\mathbf{m}) \\cdot (\\partial_n \\mathbf{m}) dS - \\int_V 2A (\\delta\\mathbf{m}) \\cdot (\\nabla^2 \\mathbf{m}) dV$$\nFor the volume integral to define the effective field, the surface integral must vanish. This occurs if $\\delta\\mathbf{m}=0$ on the boundary (fixed BC) or if $\\partial_n \\mathbf{m} = 0$ (free BC). The problem imposes the latter.\nIn the discrete model, this condition is implemented using ghost cells. Consider a boundary cell at the $x=0$ face. Its outward normal is $\\mathbf{n}=-\\hat{x}$. The boundary condition is $-\\frac{\\partial \\mathbf{m}}{\\partial x} = 0$, or simply $\\frac{\\partial \\mathbf{m}}{\\partial x} = 0$. Let the boundary cell be indexed by $(0,j,k)$. The general Laplacian expression for this cell requires the value at the non-existent neighbor $(-1,j,k)$, which is a ghost cell. We use the boundary condition to define the value in this ghost cell. Approximating the derivative at the boundary face (between cells $0$ and $-1$) with a central difference:\n$$\\frac{\\mathbf{m}_{0,j,k} - \\mathbf{m}_{-1,j,k}}{\\Delta} = 0 \\quad \\implies \\quad \\mathbf{m}_{-1,j,k} = \\mathbf{m}_{0,j,k}$$\nThis means the magnetization in the ghost cell is set equal to the magnetization in the adjacent boundary cell. This is consistent with the variational derivation because the energy contribution from the link between cell $(0,j,k)$ and the ghost cell $(-1,j,k)$, which would be $A\\Delta|\\mathbf{m}_{0,j,k} - \\mathbf{m}_{-1,j,k}|^2$, is zero. This corresponds to no exchange torque from outside the boundary.\n\nFinally, we find the stencil coefficients of the discrete Laplacian operator $\\nabla_d^2$ at this boundary cell $(0,j,k)$. We use the general expression for the Laplacian and substitute the ghost cell value. For any component $m_\\alpha$, which we will denote by $m$:\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{m_{1,j,k} + m_{-1,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1} - 6m_{0,j,k}}{\\Delta^2}$$\nSubstituting $m_{-1,j,k} = m_{0,j,k}$:\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{m_{1,j,k} + m_{0,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1} - 6m_{0,j,k}}{\\Delta^2}$$\nCollecting terms:\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{-5 m_{0,j,k} + m_{1,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1}}{\\Delta^2}$$\nThe operator is a linear combination of the values at the center cell and its real neighbors. The coefficients for the seven-point stencil in the order $[\\text{center}, +x, -x, +y, -y, +z, -z]$ are the multipliers of $m_{0,j,k}$, $m_{1,j,k}$, $m_{-1,j,k}$ (which is not a real cell), $m_{0,j+1,k}$, etc.\nThe coefficient for the center cell $(0,j,k)$ is $\\frac{-5}{\\Delta^2}$.\nThe coefficient for the $+x$ neighbor $(1,j,k)$ is $\\frac{1}{\\Delta^2}$.\nThe coefficient for the $-x$ neighbor is $0$, as this position is outside the computational domain.\nThe coefficients for the $\\pm y$ and $\\pm z$ neighbors are all $\\frac{1}{\\Delta^2}$.\n\nThe final vector of coefficients is:\n$$ \\left[ \\frac{-5}{\\Delta^2}, \\frac{1}{\\Delta^2}, 0, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2} \\right] $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{-5}{\\Delta^2} & \\frac{1}{\\Delta^2} & 0 & \\frac{1}{\\Delta^2} & \\frac{1}{\\Delta^2} & \\frac{1}{\\Delta^2} & \\frac{1}{\\Delta^2}\n\\end{pmatrix}\n}\n$$", "id": "3460200"}, {"introduction": "Unlike the short-range exchange interaction, the magnetostatic or demagnetizing field is long-range and notoriously difficult to compute directly. This exercise explores the industry-standard method for this task: using the Fast Fourier Transform (FFT) to perform the calculation as a convolution in reciprocal space. This problem will challenge you to think critically about the implications of periodic boundary conditions inherent in FFTs and the numerical techniques, such as zero-padding, required to simulate physically realistic isolated magnetic structures [@problem_id:3460239].", "problem": "Consider a finite-difference micromagnetic solver for the Landau-Lifshitz-Gilbert (LLG) equation that advances the magnetization field $\\mathbf{M}(\\mathbf{r}, t)$ in time using the effective field $\\mathbf{H}_\\mathrm{eff}(\\mathbf{r}, t)$, which includes the demagnetizing (magnetostatic) field $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$. The solver employs an algorithm based on the Fast Fourier Transform (FFT) to compute $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$ from $\\mathbf{M}(\\mathbf{r})$ via convolution with a demagnetizing tensor kernel $\\mathbf{N}(\\mathbf{r})$ in either open boundary conditions (finite sample) or with Periodic Boundary Conditions (PBC). Your task is to reason from magnetostatics and the definition of convolution to assess how the FFT-based approach should be constructed and how PBC alters the resulting field.\n\nUse as your fundamental base:\n- The magnetostatic Maxwell equations in the absence of free currents: $\\nabla \\cdot \\mathbf{B} = 0$, $\\nabla \\times \\mathbf{H} = \\mathbf{0}$, with $\\mathbf{B} = \\mu_0 (\\mathbf{H} + \\mathbf{M})$, where $\\mu_0$ is the permeability of free space.\n- The demagnetizing field arises from $\\nabla \\cdot \\mathbf{H} = - \\nabla \\cdot \\mathbf{M}$ and can be obtained from a scalar magnetostatic potential $\\phi(\\mathbf{r})$ satisfying $\\nabla^2 \\phi(\\mathbf{r}) = \\nabla \\cdot \\mathbf{M}(\\mathbf{r})$ and $\\mathbf{H}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$.\n- Convolution in real space becomes multiplication in Fourier space upon applying discrete Fourier transforms on a finite grid, with circular wrap-around unless precautions are taken.\n\nAssume a uniform Cartesian mesh with $N_x \\times N_y \\times N_z$ cells of sizes $a_x$, $a_y$, and $a_z$, respectively. The demagnetizing field is computed once per time step from $\\mathbf{M}(\\mathbf{r})$ by convolving a discrete real-space demagnetizing tensor kernel $\\mathbf{N}(\\mathbf{r})$ with $\\mathbf{M}(\\mathbf{r})$ using FFTs. The solver supports both open boundary conditions (finite sample, no periodicity) and periodic boundary conditions in either all $3$ dimensions or only in-plane ($x,y$), representing an infinite film of finite thickness along $z$.\n\nSelect all statements that are correct regarding the FFT-based computation and the impact of periodic boundary conditions on the demagnetizing field and energy:\n\nA. In a finite-difference micromagnetic code, computing $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$ via convolution with $\\mathbf{N}(\\mathbf{r})$ is efficiently implemented by embedding both $\\mathbf{M}(\\mathbf{r})$ and $\\mathbf{N}(\\mathbf{r})$ into a zero-padded array of size at least $2N_x \\times 2N_y \\times 2N_z$, taking discrete Fourier transforms, multiplying in reciprocal space as $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$, and inverse transforming. Without padding, open boundary conditions are violated by circular wrap-around and image self-interaction.\n\nB. Under fully periodic boundary conditions in all three dimensions, the $\\mathbf{k} = \\mathbf{0}$ component of the demagnetizing tensor should be set to $\\mathbf{N}(\\mathbf{0}) = \\mathbf{I}$ (the identity tensor) so that a spatially uniform magnetization yields a demagnetizing field $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\mathbf{M}(\\mathbf{r})$ everywhere.\n\nC. For a film that is periodic in $x$ and $y$ but open in $z$ (two-dimensional PBC), a spatially uniform out-of-plane magnetization $\\mathbf{M}(\\mathbf{r}) = M_0 \\hat{\\mathbf{z}}$ produces an average demagnetizing field $\\mathbf{H}_\\mathrm{d} = - M_0 \\hat{\\mathbf{z}}$, whereas a spatially uniform in-plane magnetization produces zero average demagnetizing field. This behavior is recovered by FFT convolution if the demag tensor is made periodic in-plane but retains the physical nonperiodic Green's function along $z$.\n\nD. Imposing fully periodic boundary conditions in the FFT convolution is equivalent to summing dipolar interactions over the infinite periodic images of the computational cell; consequently, for a spatially uniform magnetization the demagnetizing energy density under fully periodic boundary conditions is identically zero, while under open boundary conditions it is $\\frac{1}{2} \\mu_0 M_0^2 N_\\mathrm{shape}$, where $N_\\mathrm{shape}$ is the shape-dependent demagnetizing factor of the finite sample.\n\nE. In discrete Fourier convolution, aliasing of high-frequency components is harmless because the real-space demagnetizing kernel decays as $1/r^3$; thus, zero-padding is unnecessary even for open boundary conditions.\n\nChoose all correct options.", "solution": "The analysis begins with a validation of the problem statement, which is found to be scientifically sound, well-posed, and based on established principles of magnetostatics and computational physics. The problem asks to evaluate statements regarding the Fast Fourier Transform (FFT)-based calculation of the demagnetizing field $\\mathbf{H}_\\mathrm{d}$ in micromagnetic simulations.\n\nThe core physical principle is that the demagnetizing field $\\mathbf{H}_\\mathrm{d}$ is the solution to the magnetostatic Maxwell equations for a given magnetization distribution $\\mathbf{M}(\\mathbf{r})$. This can be formulated as a Poisson equation for a scalar potential $\\phi(\\mathbf{r})$, $\\nabla^2 \\phi(\\mathbf{r}) = \\nabla \\cdot \\mathbf{M}(\\mathbf{r})$, with $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$. The solution can be expressed as a convolution of $\\mathbf{M}(\\mathbf{r})$ with a demagnetizing tensor kernel $\\mathbf{N}(\\mathbf{r})$, i.e., $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = - (\\mathbf{N} * \\mathbf{M})(\\mathbf{r})$. In a discrete numerical scheme, the convolution theorem allows this to be computed efficiently as an element-wise product in Fourier space: $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$, where the tilde ($\\tilde{\\cdot}$) denotes the Discrete Fourier Transform (DFT), typically implemented via FFT.\n\nA. In a finite-difference micromagnetic code, computing $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$ via convolution with $\\mathbf{N}(\\mathbf{r})$ is efficiently implemented by embedding both $\\mathbf{M}(\\mathbf{r})$ and $\\mathbf{N}(\\mathbf{r})$ into a zero-padded array of size at least $2N_x \\times 2N_y \\times 2N_z$, taking discrete Fourier transforms, multiplying in reciprocal space as $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$, and inverse transforming. Without padding, open boundary conditions are violated by circular wrap-around and image self-interaction.\n\nThis statement addresses the simulation of a finite sample (open boundary conditions). The DFT inherently assumes that the input signals are periodic. Applying the convolution theorem with DFTs on unpadded arrays of size $N_x \\times N_y \\times N_z$ results in a *circular* convolution. This means that elements at one boundary of the simulation cell interact with elements at the opposite boundary as if they were adjacent, which is equivalent to simulating an infinite periodic system. To simulate an isolated, finite sample, a *linear* convolution is required. This is achieved by zero-padding the arrays before transformation. If the magnetization grid is of size $N_x \\times N_y \\times N_z$, padding it to a size of at least $(2N_x-1) \\times (2N_y-1) \\times (2N_z-1)$ is necessary to prevent the wrap-around artifacts. Using a size of $2N_x \\times 2N_y \\times 2N_z$ is common practice for FFT algorithm efficiency. This procedure correctly eliminates the spurious interactions with periodic images. The formula $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$ is the correct application of the convolution theorem. The statement is a precise and standard description of the technique.\n**Verdict: Correct.**\n\nB. Under fully periodic boundary conditions in all three dimensions, the $\\mathbf{k} = \\mathbf{0}$ component of the demagnetizing tensor should be set to $\\mathbf{N}(\\mathbf{0}) = \\mathbf{I}$ (the identity tensor) so that a spatially uniform magnetization yields a demagnetizing field $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\mathbf{M}(\\mathbf{r})$ everywhere.\n\nThis statement concerns a system with fully periodic boundary conditions (PBC) in all $3$ dimensions. For a spatially uniform magnetization $\\mathbf{M}(\\mathbf{r}) = \\mathbf{M}_0$, a constant, the magnetic charge density $\\rho_m = - \\nabla \\cdot \\mathbf{M} = \\mathbf{0}$. In an infinite, periodic medium with no sources, the demagnetizing field $\\mathbf{H}_\\mathrm{d}$ must be zero. From the computational perspective, a uniform magnetization $\\mathbf{M}_0$ is represented in Fourier space by a single non-zero component at $\\mathbf{k} = \\mathbf{0}$. To obtain a zero field in real space, $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = \\mathbf{0}$, its Fourier transform $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k})$ must be zero for all $\\mathbf{k}$. Since $\\tilde{\\mathbf{M}}(\\mathbf{k})$ is non-zero only at $\\mathbf{k}=\\mathbf{0}$, the relation $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$ requires that $\\tilde{\\mathbf{N}}(\\mathbf{0})$ must be the zero tensor, $\\tilde{\\mathbf{N}}(\\mathbf{0}) = \\mathbf{0}$. The statement proposes $\\tilde{\\mathbf{N}}(\\mathbf{0}) = \\mathbf{I}$, which would yield a non-zero field $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\mathbf{M}_0$. This is incorrect for a fully 3D periodic system.\n**Verdict: Incorrect.**\n\nC. For a film that is periodic in $x$ and $y$ but open in $z$ (two-dimensional PBC), a spatially uniform out-of-plane magnetization $\\mathbf{M}(\\mathbf{r}) = M_0 \\hat{\\mathbf{z}}$ produces an average demagnetizing field $\\mathbf{H}_\\mathrm{d} = - M_0 \\hat{\\mathbf{z}}$, whereas a spatially uniform in-plane magnetization produces zero average demagnetizing field. This behavior is recovered by FFT convolution if the demag tensor is made periodic in-plane but retains the physical nonperiodic Green's function along $z$.\n\nThis statement describes the magnetostatics of an infinite thin film. For a uniform out-of-plane magnetization $\\mathbf{M} = M_0 \\hat{\\mathbf{z}}$, magnetic surface charges $\\sigma_m = \\pm M_0$ appear on the top and bottom surfaces. These sheets of charge produce a uniform field $\\mathbf{H}_\\mathrm{d} = -M_0 \\hat{\\mathbf{z}}$ inside the film, analogous to a parallel-plate capacitor. For a uniform in-plane magnetization, e.g., $\\mathbf{M} = M_0 \\hat{\\mathbf{x}}$, the surface charge $\\sigma_m = \\mathbf{M} \\cdot \\hat{\\mathbf{n}} = 0$ on the top and bottom surfaces, resulting in zero demagnetizing field everywhere. Both physical descriptions are correct. The statement further asserts that numerical methods based on FFT convolution can reproduce this behavior. This is true; specialized methods using 2D FFTs for the in-plane dimensions combined with a non-periodic solver for the $z$-direction are standard for this geometry.\n**Verdict: Correct.**\n\nD. Imposing fully periodic boundary conditions in the FFT convolution is equivalent to summing dipolar interactions over the infinite periodic images of the computational cell; consequently, for a spatially uniform magnetization the demagnetizing energy density under fully periodic boundary conditions is identically zero, while under open boundary conditions it is $\\frac{1}{2} \\mu_0 M_0^2 N_\\mathrm{shape}$, where $N_\\mathrm{shape}$ is the shape-dependent demagnetizing factor of the finite sample.\n\nThis statement correctly identifies the FFT method with PBC as a form of Ewald summation for dipolar interactions. As established for option B, a uniform magnetization $\\mathbf{M}_0$ in a fully 3D periodic system generates zero demagnetizing field, $\\mathbf{H}_\\mathrm{d} = \\mathbf{0}$, under the standard summation convention used in FFT-based codes. The demagnetizing energy density is $E_\\mathrm{d} = -\\frac{1}{2}\\mu_0 \\mathbf{M} \\cdot \\mathbf{H}_\\mathrm{d}$, which is therefore zero. For contrast, the statement correctly gives the shape anisotropy energy density for a uniformly magnetized finite (open BC) sample of ellipsoidal shape as $\\frac{1}{2}\\mu_0 M_0^2 N_\\mathrm{shape}$, which arises from its non-zero internal demagnetizing field. The comparison highlights a key difference between the physics of fully periodic and finite systems, and all parts of the statement are accurate.\n**Verdict: Correct.**\n\nE. In discrete Fourier convolution, aliasing of high-frequency components is harmless because the real-space demagnetizing kernel decays as $1/r^3$; thus, zero-padding is unnecessary even for open boundary conditions.\n\nThis statement is incorrect on multiple grounds. First, the primary problem with omitting zero-padding for open boundary conditions is not aliasing but the enforcement of circular convolution, which physically corresponds to periodic boundary conditions, not open ones. Second, the reason given is fallacious. The demagnetizing field's kernel, with its long-range $1/r^3$ decay, is precisely why the wrap-around error is significant. A short-range interaction might have negligible wrap-around error, but a long-range one does not. Therefore, zero-padding is essential for simulating isolated systems. The premise is flawed, and the conclusion is wrong.\n**Verdict: Incorrect.**\n\nFinal compilation of correct options: A, C, D.", "answer": "$$\\boxed{ACD}$$", "id": "3460239"}, {"introduction": "With the ability to compute the effective field, the final challenge is to integrate the Landau-Lifshitz-Gilbert equation forward in time. This requires numerical schemes that are not only stable but also respect the core geometric constraint of spin dynamics: the conservation of the magnetization vector's unit length. This hands-on coding exercise guides you in deriving and implementing a sophisticated geometric integrator that splits the dynamics into its precessional and damping components, solving each part exactly. By comparing its performance to a standard Runge-Kutta method, you will gain a practical appreciation for how structure-preserving algorithms can achieve superior accuracy and stability in long-time simulations [@problem_id:3460197].", "problem": "Implement a numerical integrator for the Landau–Lifshitz–Gilbert spin dynamics that uses operator splitting to treat the precession analytically and the damping implicitly, and compare its phase accuracy against a standard explicit scheme in a ferromagnetic resonance (FMR) ring-down setting. Work with a single-domain macrospin of unit norm. Use the following fundamental base to derive your method.\n\nBase equations and definitions:\n- The Gilbert form of the Landau–Lifshitz–Gilbert equation for the unit magnetization vector $\\mathbf{m}(t)\\in\\mathbb{R}^3$ in a constant effective magnetic field $\\mathbf{H}\\in\\mathbb{R}^3$ is\n$$\n(1+\\alpha^2)\\frac{d\\mathbf{m}}{dt} = -\\gamma\\mathbf{m}\\times \\mathbf{H} - \\alpha\\gamma\\mathbf{m}\\times(\\mathbf{m}\\times \\mathbf{H}),\n$$\nwhere $\\gamma$ is the gyromagnetic ratio in $\\mathrm{rad\\,s^{-1}\\,T^{-1}}$, $\\alpha\\ge 0$ is the dimensionless damping, $\\times$ denotes the vector cross product, and $\\|\\mathbf{m}\\|=1$ for all $t$.\n- Define $\\gamma'=\\gamma/(1+\\alpha^2)$ so that the equation can be written as a sum of two vector fields,\n$$\n\\frac{d\\mathbf{m}}{dt} = \\underbrace{-\\gamma'\\mathbf{m}\\times\\mathbf{H}}_{\\text{precession}} + \\underbrace{-\\alpha\\gamma'\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{H})}_{\\text{damping}}.\n$$\n- In a constant field $\\mathbf{H} = H_0\\mathbf{h}$ with $H_0=\\|\\mathbf{H}\\|$ and $\\mathbf{h}$ a unit vector, the precession frequency is $\\omega = \\gamma' H_0$ in $\\mathrm{rad/s}$, and the ferromagnetic resonance (FMR) period is $T_{\\mathrm{per}} = 2\\pi/\\omega$.\n\nTask requirements:\n1. Derive from first principles a time-splitting scheme based on the decomposition above that applies:\n   - an exact precession map over a time step $\\Delta t$ about axis $\\mathbf{h}$ by angle $\\theta=\\omega\\,\\Delta t$ (no approximation in the precession substep), and\n   - an implicit update for the damping substep over a time interval $\\tau$ that preserves the unit norm and is unconditionally stable. Show how to reduce the implicit vector equation for the damping substep under constant $\\mathbf{H}$ to a scalar nonlinear equation for $s = \\mathbf{h}\\cdot \\mathbf{m}_{\\mathrm{new}}$, and solve it in closed form to obtain an explicit formula for $\\mathbf{m}_{\\mathrm{new}}$.\n2. Compose the two substeps in a symmetric Strang-like fashion (half damping, full precession, half damping) to obtain a second-order, symplectic-like splitting method.\n3. Implement, in code, both:\n   - the derived splitting integrator, and\n   - a baseline explicit fourth-order Runge–Kutta (RK4) method applied directly to the Gilbert form above (you may project back to the unit sphere after each RK4 step to control norm drift).\n4. Simulate an FMR ring-down: take a constant field $\\mathbf{H}=H_0\\hat{\\mathbf{z}}$ with $H_0>0$, start from a slightly tilted initial magnetization $\\mathbf{m}(0)$ at a small polar angle $\\theta_0$ from $\\hat{\\mathbf{z}}$, and evolve for an integer number of FMR periods. Define the numerical phase at time $t$ as the azimuthal angle $\\phi(t)=\\mathrm{atan2}(m_y(t),m_x(t))$ in radians, and compare to the analytical phase $\\phi_{\\mathrm{exact}}(t)=\\omega t$ modulo $2\\pi$. Use the wrapped absolute phase error $\\varepsilon_\\phi(t) = \\left|\\mathrm{atan2}(\\sin(\\phi(t)-\\phi_{\\mathrm{exact}}(t)),\\cos(\\phi(t)-\\phi_{\\mathrm{exact}}(t)))\\right|$ in radians.\n5. Design a test suite with the following three cases to assess phase accuracy:\n   - Case A (happy path): $\\gamma = 1.760859\\times 10^{11}\\ \\mathrm{rad\\,s^{-1}\\,T^{-1}}$, $H_0=1.0\\ \\mathrm{T}$, $\\alpha=0.02$, $\\theta_0 = 5^\\circ$ (convert to radians), total time $T_{\\mathrm{tot}}=20\\,T_{\\mathrm{per}}$, and time step $\\Delta t = T_{\\mathrm{per}}/12$.\n   - Case B (refined step): same as Case A but $\\Delta t = T_{\\mathrm{per}}/40$.\n   - Case C (boundary, no damping): same as Case A but with $\\alpha=0.0$ and $\\Delta t = T_{\\mathrm{per}}/12$.\n   In all cases, $T_{\\mathrm{per}}=2\\pi/\\omega$ with $\\omega=\\gamma' H_0$ and $\\gamma'=\\gamma/(1+\\alpha^2)$, and the integration should run for exactly $20$ FMR periods so that $T_{\\mathrm{tot}}/\\Delta t$ is an integer. All angles must be in radians, times in seconds, and fields in Tesla.\n6. For each case, compute the wrapped absolute phase error at the final time for the splitting method and for RK4, and return a boolean indicating whether the splitting method has strictly smaller final-time phase error than RK4.\n7. Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the cases in the order A, B, C. For example, the output format must be like $\\texttt{[true,false,true]}$ but with Python boolean capitalization.\n\nYour deliverable must be a complete, runnable program that:\n- Implements the above methods and comparisons.\n- Uses no user input.\n- Prints exactly one line with a Python list of three booleans as specified.", "solution": "The problem requires the derivation, implementation, and comparison of two numerical integrators for the Landau–Lifshitz–Gilbert (LLG) equation for a single-domain macrospin. The core of the task is to develop a geometrically-aware splitting method and benchmark its phase accuracy against a standard explicit Runge-Kutta integrator.\n\nThe LLG equation is given in the Gilbert form, which can be rearranged and decomposed into a precession term and a damping term. With $\\gamma' = \\gamma/(1+\\alpha^2)$, the equation of motion for the unit magnetization vector $\\mathbf{m}$ in a constant effective field $\\mathbf{H}$ is:\n$$\n\\frac{d\\mathbf{m}}{dt} = \\underbrace{-\\gamma'\\,\\mathbf{m}\\times\\mathbf{H}}_{\\mathbf{f}_{\\text{prec}}(\\mathbf{m})} + \\underbrace{-\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{H})}_{\\mathbf{f}_{\\text{damp}}(\\mathbf{m})}\n$$\nThe field is constant, $\\mathbf{H} = H_0\\mathbf{h}$, where $\\mathbf{h}$ is a unit vector. For the simulation, we use $\\mathbf{h}=\\hat{\\mathbf{z}}$.\n\nA symmetric second-order Strang splitting scheme is employed to integrate this system. The formal solution over one time step $\\Delta t$ is approximated as a composition of operators corresponding to the precession and damping flows:\n$$\n\\mathbf{m}(t+\\Delta t) \\approx \\mathcal{D}_{\\Delta t/2} \\circ \\mathcal{P}_{\\Delta t} \\circ \\mathcal{D}_{\\Delta t/2}(\\mathbf{m}(t))\n$$\nwhere $\\mathcal{P}_{\\Delta t}$ is the operator for the precession flow over a full time step $\\Delta t$, and $\\mathcal{D}_{\\tau}$ is the operator for the damping flow over a time interval $\\tau = \\Delta t/2$. We will now derive the exact analytical form of these operators.\n\n**1. Precession Substep $\\mathcal{P}_{\\Delta t}$**\n\nThe precession dynamics are described by the linear ordinary differential equation (ODE):\n$$\n\\frac{d\\mathbf{m}}{dt} = -\\gamma' \\mathbf{m} \\times \\mathbf{H} = \\omega (\\mathbf{h} \\times \\mathbf{m})\n$$\nwhere $\\omega = \\gamma' H_0$ is the Larmor precession frequency. This equation describes a rigid rotation of the vector $\\mathbf{m}$ about the axis defined by $\\mathbf{h}$ with a constant angular velocity $\\omega$. The analytical solution for a time step $\\Delta t$ is a rotation by an angle $\\theta = \\omega \\Delta t$. This rotation can be computed exactly using Rodrigues' rotation formula:\n$$\n\\mathcal{P}_{\\Delta t}(\\mathbf{m}_{\\text{in}}) = \\mathbf{m}_{\\text{in}} \\cos\\theta + (\\mathbf{h} \\times \\mathbf{m}_{\\text{in}}) \\sin\\theta + \\mathbf{h} (\\mathbf{h} \\cdot \\mathbf{m}_{\\text{in}}) (1 - \\cos\\theta)\n$$\nSince this map is an exact rotation, it naturally preserves the norm of the magnetization, $\\|\\mathbf{m}\\|=1$.\n\n**2. Damping Substep $\\mathcal{D}_{\\tau}$**\n\nThe damping dynamics are described by the nonlinear ODE:\n$$\n\\frac{d\\mathbf{m}}{dt} = -\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{H})\n$$\nUsing the vector triple product identity $\\mathbf{a}\\times(\\mathbf{b}\\times\\mathbf{c}) = \\mathbf{b}(\\mathbf{a}\\cdot\\mathbf{c})-\\mathbf{c}(\\mathbf{a}\\cdot\\mathbf{b})$ and $\\|\\mathbf{m}\\|=1$, the equation becomes:\n$$\n\\frac{d\\mathbf{m}}{dt} = \\alpha\\gamma' \\left( \\mathbf{H} - (\\mathbf{m}\\cdot\\mathbf{H})\\mathbf{m} \\right)\n$$\nThis equation describes a flow that moves $\\mathbf{m}$ towards alignment with $\\mathbf{H}$. The motion is constrained to the great circle on the unit sphere that passes through the initial magnetization vector and the field vector $\\mathbf{H}$. This geometric insight allows us to find an exact analytical solution for the damping substep.\n\nLet $\\phi(t)$ be the polar angle between $\\mathbf{m}(t)$ and $\\mathbf{h}$. We can parameterize $\\mathbf{m}(t)$ as $\\mathbf{m}(t) = \\cos(\\phi(t))\\mathbf{h} + \\sin(\\phi(t))\\hat{\\mathbf{p}}$, where $\\hat{\\mathbf{p}}$ is a fixed unit vector perpendicular to $\\mathbf{h}$ that lies in the plane of motion. Substituting this into the damping ODE yields a scalar ODE for the angle $\\phi(t)$:\n$$\n\\frac{d\\phi}{dt} = -\\alpha\\gamma'H_0 \\sin\\phi\n$$\nThis is a separable ODE. To find the map over a time interval $\\tau$, we integrate:\n$$\n\\int_{\\phi_{\\text{old}}}^{\\phi_{\\text{new}}} \\frac{d\\phi}{\\sin\\phi} = \\int_{0}^{\\tau} -\\alpha\\gamma'H_0 dt\n$$\nThe integral of $\\csc\\phi$ is $\\ln|\\tan(\\phi/2)|$. This leads to:\n$$\n\\ln\\left(\\frac{\\tan(\\phi_{\\text{new}}/2)}{\\tan(\\phi_{\\text{old}}/2)}\\right) = -\\alpha\\gamma'H_0\\tau\n$$\nSolving for $\\phi_{\\text{new}}$, we obtain the explicit, closed-form update rule:\n$$\n\\tan(\\phi_{\\text{new}}/2) = \\tan(\\phi_{\\text{old}}/2) \\exp(-\\alpha\\gamma'H_0\\tau)\n$$\nGiven an input vector $\\mathbf{m}_{\\text{old}}$, we first find its polar angle $\\phi_{\\text{old}} = \\arccos(\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})$. We then use the formula above to find $\\phi_{\\text{new}}$. The new vector $\\mathbf{m}_{\\text{new}}$ is reconstructed preserving the plane of motion:\n$$\n\\mathbf{m}_{\\text{new}} = \\cos(\\phi_{\\text{new}})\\mathbf{h} + \\sin(\\phi_{\\text{new}})\\frac{\\mathbf{m}_{\\text{old}} - (\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})\\mathbf{h}}{\\|\\mathbf{m}_{\\text{old}} - (\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})\\mathbf{h}\\|}\n$$\nThis exact solution for the damping flow is unconditionally stable and preserves the unit norm by construction, satisfying all the requirements for the damping substep integrator.\n\n**3. Baseline: Fourth-Order Runge-Kutta (RK4) Method**\n\nFor comparison, a standard explicit fourth-order Runge-Kutta (RK4) method is applied directly to the full LLG equation. A single step of RK4 from time $t_n$ to $t_n+\\Delta t$ is:\n$$\n\\begin{aligned}\n    \\mathbf{k}_1 &= \\mathbf{f}(\\mathbf{m}_n) \\\\\n    \\mathbf{k}_2 &= \\mathbf{f}(\\mathbf{m}_n + \\frac{\\Delta t}{2}\\mathbf{k}_1) \\\\\n    \\mathbf{k}_3 &= \\mathbf{f}(\\mathbf{m}_n + \\frac{\\Delta t}{2}\\mathbf{k}_2) \\\\\n    \\mathbf{k}_4 &= \\mathbf{f}(\\mathbf{m}_n + \\Delta t\\mathbf{k}_3) \\\\\n    \\mathbf{m}_{n+1}^* &= \\mathbf{m}_n + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n\\end{aligned}\n$$\nwhere $\\mathbf{f}(\\mathbf{m}) = \\mathbf{f}_{\\text{prec}}(\\mathbf{m}) + \\mathbf{f}_{\\text{damp}}(\\mathbf{m})$. The RK4 method does not inherently preserve the unit norm of $\\mathbf{m}$. Therefore, a projection step, $\\mathbf{m}_{n+1} = \\mathbf{m}_{n+1}^* / \\|\\mathbf{m}_{n+1}^*\\|$, must be applied after each time step to prevent unphysical norm drift.\n\n**4. Phase Error Calculation**\n\nThe accuracy of the integrators is assessed by the phase error in a ferromagnetic resonance (FMR) ring-down simulation. The analytical phase of the precessing magnetization at time $t$ is $\\phi_{\\text{exact}}(t) = \\omega t$. The numerical phase is $\\phi_{\\text{num}}(t) = \\mathrm{atan2}(m_y(t), m_x(t))$. The simulation runs for $T_{\\text{tot}} = 20 T_{\\text{per}}$, so the exact final phase is $\\phi_{\\text{exact}}(T_{\\text{tot}}) = 40\\pi$, which is equivalent to $0$ modulo $2\\pi$. The wrapped absolute phase error is calculated as $\\varepsilon_\\phi = |\\mathrm{atan2}(\\sin(\\phi_{\\text{num}}-\\phi_{\\text{exact}}), \\cos(\\phi_{\\text{num}}-\\phi_{\\text{exact}}))|$. The splitting integrator, being a geometric method that treats the dominant oscillatory part exactly, is expected to exhibit significantly lower phase error than the general-purpose RK4 method.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares a Landau-Lifshitz-Gilbert (LLG) splitting integrator\n    against a standard RK4 integrator for a ferromagnetic resonance ring-down problem.\n    The comparison is based on the final phase accuracy for three test cases.\n    \"\"\"\n\n    # --- Fundamental Constants ---\n    GAMMA = 1.760859e11  # Gyromagnetic ratio in rad s^-1 T^-1\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Happy path with moderate damping and time step\n        {'name': 'A', 'alpha': 0.02, 'dt_frac': 12},\n        # Case B: Refined time step\n        {'name': 'B', 'alpha': 0.02, 'dt_frac': 40},\n        # Case C: Boundary case with no damping\n        {'name': 'C', 'alpha': 0.0, 'dt_frac': 12},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Parameter Setup ---\n        alpha = case['alpha']\n        dt_frac = case['dt_frac']\n\n        H0 = 1.0  # Tesla\n        h_axis = np.array([0.0, 0.0, 1.0])\n        H_vec = H0 * h_axis\n\n        theta0_deg = 5.0\n        theta0_rad = np.deg2rad(theta0_deg)\n        m0 = np.array([np.sin(theta0_rad), 0.0, np.cos(theta0_rad)])\n\n        gammap = GAMMA / (1.0 + alpha**2)\n        omega = gammap * H0\n        T_per = 2.0 * np.pi / omega\n        \n        T_tot = 20.0 * T_per\n        dt = T_per / dt_frac\n        num_steps = int(round(T_tot / dt))\n\n        # --- Integrator Implementations ---\n\n        # 1. Splitting Method (Half-Damping, Full-Precession, Half-Damping)\n        def precession_step(m, angle):\n            \"\"\"Exact rotation around z-axis by a given angle.\"\"\"\n            cos_a = np.cos(angle)\n            sin_a = np.sin(angle)\n            mx_new = m[0] * cos_a - m[1] * sin_a\n            my_new = m[0] * sin_a + m[1] * cos_a\n            return np.array([mx_new, my_new, m[2]])\n\n        def damping_step(m, tau):\n            \"\"\"Exact solution of the damping sub-problem over time interval tau.\"\"\"\n            if alpha == 0.0:\n                return m\n            \n            s_old = np.clip(m @ h_axis, -1.0, 1.0)\n            \n            # If m is already aligned with H, no damping occurs.\n            if 1.0 - abs(s_old) < 1e-14:\n                return np.sign(s_old) * h_axis\n\n            phi_old = np.arccos(s_old)\n            sin_phi_old = np.sin(phi_old)\n\n            lamb = alpha * gammap * H0 * tau\n            tan_phi_old_half = np.tan(phi_old / 2.0)\n            tan_phi_new_half = tan_phi_old_half * np.exp(-lamb)\n            phi_new = 2.0 * np.arctan(tan_phi_new_half)\n\n            s_new = np.cos(phi_new)\n            sin_phi_new = np.sin(phi_new)\n            \n            # Reconstruct the new vector in the same plane (m, h)\n            # m_new = s_new * h + sin_new/sin_old * (m - s_old * h)\n            m_perp_old = m - s_old * h_axis\n            m_new = s_new * h_axis + m_perp_old * (sin_phi_new / sin_phi_old)\n            \n            return m_new\n\n        def integrate_split(m_init, n_steps, dt_val):\n            m = np.copy(m_init)\n            precession_angle = omega * dt_val\n            damping_tau = dt_val / 2.0\n            for _ in range(n_steps):\n                m = damping_step(m, damping_tau)\n                m = precession_step(m, precession_angle)\n                m = damping_step(m, damping_tau)\n            return m\n\n        # 2. RK4 Method\n        def llg_rhs(m):\n            m_cross_H = np.cross(m, H_vec)\n            m_cross_m_cross_H = np.cross(m, m_cross_H)\n            rhs = -gammap * m_cross_H - alpha * gammap * m_cross_m_cross_H\n            return rhs\n\n        def integrate_rk4(m_init, n_steps, dt_val):\n            m = np.copy(m_init)\n            for _ in range(n_steps):\n                k1 = llg_rhs(m)\n                k2 = llg_rhs(m + dt_val / 2.0 * k1)\n                k3 = llg_rhs(m + dt_val / 2.0 * k2)\n                k4 = llg_rhs(m + dt_val * k3)\n                m = m + dt_val / 6.0 * (k1 + 2 * k2 + 2 * k3 + k4)\n                m /= np.linalg.norm(m)  # Re-normalize after each step\n            return m\n\n        # --- Execution and Comparison ---\n        m_final_split = integrate_split(m0, num_steps, dt)\n        m_final_rk4 = integrate_rk4(m0, num_steps, dt)\n\n        # Final phase is 40*pi, which is 0 mod 2*pi\n        phi_exact_final = 0.0\n\n        phi_split = np.arctan2(m_final_split[1], m_final_split[0])\n        phi_rk4 = np.arctan2(m_final_rk4[1], m_final_rk4[0])\n\n        d_phi_split = phi_split - phi_exact_final\n        error_split = abs(np.arctan2(np.sin(d_phi_split), np.cos(d_phi_split)))\n\n        d_phi_rk4 = phi_rk4 - phi_exact_final\n        error_rk4 = abs(np.arctan2(np.sin(d_phi_rk4), np.cos(d_phi_rk4)))\n\n        results.append(error_split < error_rk4)\n\n    # --- Print Final Output ---\n    # The output format is a Python list of booleans, converted to a string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3460197"}]}