{"hands_on_practices": [{"introduction": "Before deploying numerical approximations, a firm grasp of the underlying physics is essential. This first practice establishes the theoretical \"gold standard\" for truncating an open domain by deriving the exact analytical boundary condition for a canonical problem: 2D scattering from an object within a circular boundary. By working through the derivation of the Dirichlet-to-Neumann (DtN) map [@problem_id:3336212], you will see how the Sommerfeld radiation condition is rigorously enforced mode-by-mode, providing a perfect, reflectionless termination that all practical methods strive to emulate.", "problem": "Consider two-dimensional, time-harmonic electromagnetic scattering in free space from a bounded inhomogeneity that is fully contained within a disk of radius $a>0$. In the transverse magnetic polarization with electric field polarized along the $z$-axis, the scalar field $u(\\boldsymbol{x})=E_{z}(\\boldsymbol{x})$ in the exterior homogeneous medium satisfies the scalar Helmholtz equation $(\\nabla^{2} + k^{2})u = 0$ for $r \\ge a$, with angular frequency $\\omega$, free-space permittivity $\\epsilon_{0}$, and permeability $\\mu_{0}$ such that $k = \\omega \\sqrt{\\mu_{0}\\epsilon_{0}}$. The field is time-harmonic with convention $\\exp(-\\mathrm{i}\\omega t)$ and satisfies the Sommerfeld radiation condition at infinity. In a Finite Element Method (FEM) discretization of the bounded interior domain $r \\le a$, an exact nonreflecting boundary condition on the truncation boundary $\\Gamma = \\{(r,\\theta): r=a\\}$ is enforced via the Dirichlet-to-Neumann (DtN) map: for any Dirichlet trace $u|_{\\Gamma}$, the boundary condition prescribes the outward normal derivative $\\partial u/\\partial n$ on $\\Gamma$.\n\nStarting solely from Maxwell’s equations in the frequency domain, their reduction to the scalar Helmholtz equation in this polarization, separation of variables in polar coordinates, and the radiation condition, derive the exact spectral representation of the DtN operator on the circular boundary $\\Gamma$. Specifically, if the boundary Dirichlet trace admits the Fourier series representation\n$$\nu(a,\\theta) = \\sum_{m=-\\infty}^{\\infty} u_{m} \\,\\exp(\\mathrm{i} m \\theta),\n$$\nthe corresponding outward normal derivative at $r=a$ can be written as\n$$\n\\left.\\frac{\\partial u}{\\partial n}\\right|_{r=a} \\equiv \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{m=-\\infty}^{\\infty} Y_{m}(k,a)\\, u_{m}\\, \\exp(\\mathrm{i} m \\theta),\n$$\nwhere $Y_{m}(k,a)$ is the modal symbol of the exact DtN map. Here $\\partial/\\partial r$ is the derivative in the radial direction pointing outward from the computational domain $r\\le a$ into the exterior region, and the Fourier coefficients $u_{m}$ are defined with respect to the orthonormal basis $\\exp(\\mathrm{i} m \\theta)$ on $\\Gamma$.\n\nProvide the closed-form analytic expression for $Y_{m}(k,a)$ in terms of $k$, $a$, and standard special functions. Use the convention that a prime denotes differentiation of a special function with respect to its entire argument. Do not approximate. Your final answer must be a single closed-form analytic expression.", "solution": "The problem requires the derivation of the modal symbol for the exact Dirichlet-to-Neumann (DtN) map for the two-dimensional scalar Helmholtz equation in the exterior of a circle of radius $a$.\n\nThe physical setting is a time-harmonic electromagnetic wave scattering problem in the transverse magnetic (TM) polarization. The scalar field $u(\\boldsymbol{x})$ represents the $z$-component of the electric field, $E_z$. In the homogeneous region exterior to the disk of radius $a$, for $r \\ge a$, this field satisfies the scalar Helmholtz equation:\n$$\n(\\nabla^2 + k^2) u = 0\n$$\nwhere $k$ is the free-space wavenumber. In polar coordinates $(r, \\theta)$, the Laplacian operator is given by $\\nabla^2 = \\frac{1}{r} \\frac{\\partial}{\\partial r} (r \\frac{\\partial}{\\partial r}) + \\frac{1}{r^2} \\frac{\\partial^2}{\\partial \\theta^2}$. The Helmholtz equation thus becomes:\n$$\n\\frac{1}{r} \\frac{\\partial}{\\partial r} \\left(r \\frac{\\partial u}{\\partial r}\\right) + \\frac{1}{r^2} \\frac{\\partial^2 u}{\\partial \\theta^2} + k^2 u = 0\n$$\nWe seek a solution using the method of separation of variables. Let $u(r, \\theta) = R(r)\\Theta(\\theta)$. Substituting this into the Helmholtz equation yields:\n$$\n\\frac{\\Theta(\\theta)}{r} \\frac{d}{dr} \\left(r \\frac{dR(r)}{dr}\\right) + \\frac{R(r)}{r^2} \\frac{d^2 \\Theta(\\theta)}{d\\theta^2} + k^2 R(r)\\Theta(\\theta) = 0\n$$\nMultiplying by $\\frac{r^2}{R(r)\\Theta(\\theta)}$ separates the variables:\n$$\n\\frac{r}{R(r)} \\frac{d}{dr} \\left(r \\frac{dR(r)}{dr}\\right) + k^2 r^2 = - \\frac{1}{\\Theta(\\theta)} \\frac{d^2 \\Theta(\\theta)}{d\\theta^2}\n$$\nThe left-hand side depends only on $r$, and the right-hand side depends only on $\\theta$. Therefore, both sides must be equal to a constant, which we denote by $m^2$.\n\nThe angular equation is:\n$$\n\\frac{d^2 \\Theta(\\theta)}{d\\theta^2} + m^2 \\Theta(\\theta) = 0\n$$\nFor the solution to be single-valued and continuous in the physical space, $\\Theta(\\theta)$ must be $2\\pi$-periodic. This constrains $m$ to be an integer, $m \\in \\mathbb{Z}$. The solutions are of the form $\\exp(\\mathrm{i} m \\theta)$.\n\nThe radial equation is:\n$$\n\\frac{r}{R(r)} \\frac{d}{dr} \\left(r \\frac{dR(r)}{dr}\\right) + k^2 r^2 = m^2\n$$\nRearranging gives the standard form of Bessel's differential equation:\n$$\nr^2 \\frac{d^2 R}{dr^2} + r \\frac{dR}{dr} + (k^2 r^2 - m^2)R = 0\n$$\nThe general solution to this equation is a linear combination of two linearly independent Bessel functions of order $m$. For scattering problems in exterior domains, it is most convenient to use the Hankel functions as the basis. The general radial solution is:\n$$\nR_m(r) = c_{m,1} H_m^{(1)}(kr) + c_{m,2} H_m^{(2)}(kr)\n$$\nwhere $H_m^{(1)}$ and $H_m^{(2)}$ are the Hankel functions of the first and second kind, respectively, and $c_{m,1}$ and $c_{m,2}$ are constants.\n\nThe field must satisfy the Sommerfeld radiation condition, which requires the wave to be purely outgoing at infinity. The time-harmonic convention is given as $\\exp(-\\mathrm{i}\\omega t)$. The asymptotic behavior of the Hankel functions for large arguments $z \\to \\infty$ is:\n$$\nH_m^{(1)}(z) \\sim \\sqrt{\\frac{2}{\\pi z}} \\exp\\left(\\mathrm{i} \\left(z - \\frac{m\\pi}{2} - \\frac{\\pi}{4}\\right)\\right)\n$$\n$$\nH_m^{(2)}(z) \\sim \\sqrt{\\frac{2}{\\pi z}} \\exp\\left(-\\mathrm{i} \\left(z - \\frac{m\\pi}{2} - \\frac{\\pi}{4}\\right)\\right)\n$$\nA wave's full spatio-temporal dependence is $R_m(r) \\exp(-\\mathrm{i}\\omega t)$. For the term involving $H_m^{(1)}(kr)$, the phase for large $r$ behaves as $kr - \\omega t$, which represents an outgoing wave. For the term involving $H_m^{(2)}(kr)$, the phase behaves as $-kr - \\omega t$, representing an incoming wave. The radiation condition dictates that only outgoing waves can exist at infinity, so we must set $c_{m,2} = 0$.\n\nThe general solution for the field $u(r,\\theta)$ in the exterior region $r \\ge a$ is a superposition of the modal solutions:\n$$\nu(r,\\theta) = \\sum_{m=-\\infty}^{\\infty} c_m H_m^{(1)}(kr) \\exp(\\mathrm{i} m \\theta)\n$$\nwhere the constants $c_m$ are determined by the boundary condition on the circle $\\Gamma$ at $r=a$.\n\nThe problem specifies the Dirichlet data on $\\Gamma$ as a Fourier series:\n$$\nu(a, \\theta) = \\sum_{m=-\\infty}^{\\infty} u_m \\exp(\\mathrm{i} m \\theta)\n$$\nBy evaluating our general solution at $r=a$ and equating it with the given boundary data, we can match the Fourier coefficients:\n$$\nc_m H_m^{(1)}(ka) = u_m\n$$\nFrom this, we can express the unknown constants $c_m$ in terms of the given Fourier coefficients $u_m$ of the Dirichlet trace:\n$$\nc_m = \\frac{u_m}{H_m^{(1)}(ka)}\n$$\nThis is well-defined because the Hankel function $H_m^{(1)}(z)$ has no zeros for real positive arguments $z=ka > 0$.\n\nThe DtN map relates the Dirichlet data to the outward normal derivative on the boundary. On the circular boundary $\\Gamma$, the outward normal direction corresponds to the radial direction $r$. Thus, we need to compute $\\frac{\\partial u}{\\partial n}|_{r=a} \\equiv \\frac{\\partial u}{\\partial r}|_{r=a}$. We differentiate the general solution term-by-term with respect to $r$:\n$$\n\\frac{\\partial u}{\\partial r} = \\frac{\\partial}{\\partial r} \\sum_{m=-\\infty}^{\\infty} c_m H_m^{(1)}(kr) \\exp(\\mathrm{i} m \\theta) = \\sum_{m=-\\infty}^{\\infty} c_m \\frac{d}{dr}\\left(H_m^{(1)}(kr)\\right) \\exp(\\mathrm{i} m \\theta)\n$$\nUsing the chain rule, and the convention that a prime on a special function denotes differentiation with respect to its entire argument, we have $\\frac{d}{dr} H_m^{(1)}(kr) = k (H_m^{(1)})'(kr)$. Therefore,\n$$\n\\frac{\\partial u}{\\partial r} = \\sum_{m=-\\infty}^{\\infty} c_m k (H_m^{(1)})'(kr) \\exp(\\mathrm{i} m \\theta)\n$$\nEvaluating this at the boundary $r=a$:\n$$\n\\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{m=-\\infty}^{\\infty} c_m k (H_m^{(1)})'(ka) \\exp(\\mathrm{i} m \\theta)\n$$\nNow, we substitute the expression for $c_m$ in terms of $u_m$:\n$$\n\\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{m=-\\infty}^{\\infty} \\left( \\frac{u_m}{H_m^{(1)}(ka)} \\right) k (H_m^{(1)})'(ka) \\exp(\\mathrm{i} m \\theta)\n$$\nRearranging the terms gives:\n$$\n\\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{m=-\\infty}^{\\infty} \\left(k \\frac{(H_m^{(1)})'(ka)}{H_m^{(1)}(ka)}\\right) u_m \\exp(\\mathrm{i} m \\theta)\n$$\nThe problem defines the DtN map through its spectral representation:\n$$\n\\left.\\frac{\\partial u}{\\partial n}\\right|_{r=a} = \\sum_{m=-\\infty}^{\\infty} Y_{m}(k,a)\\, u_{m}\\, \\exp(\\mathrm{i} m \\theta)\n$$\nBy direct comparison of the two preceding expressions, we identify the modal symbol $Y_m(k,a)$ of the exact DtN operator:\n$$\nY_m(k,a) = k \\frac{(H_m^{(1)})'(ka)}{H_m^{(1)}(ka)}\n$$\nThis expression provides the closed-form representation of the DtN map in the Fourier basis for each mode $m$.", "answer": "$$\n\\boxed{k \\frac{(H_m^{(1)})'(ka)}{H_m^{(1)}(ka)}}\n$$", "id": "3336212"}, {"introduction": "In most practical simulations, the geometry is too complex for an exact analytical boundary condition, necessitating the use of approximations like the Perfectly Matched Layer (PML). A critical skill for any computational scientist is the ability to validate these approximations. This exercise [@problem_id:3336184] guides you in developing a powerful, physics-based diagnostic tool by implementing an a posteriori reflection indicator based on the time-averaged Poynting vector, $\\mathbf{S} = \\frac{1}{2}\\operatorname{Re}(\\mathbf{E} \\times \\mathbf{H}^*)$. By computing the net power flowing through the computational boundary, you can create a quantitative measure of the spurious reflections introduced by your truncation scheme.", "problem": "You are given a time-harmonic open-region scattering problem truncated by a computational boundary $\\partial\\Omega$. In frequency domain with the exponential time convention $e^{+\\mathrm{i}\\omega t}$, the electromagnetic fields are complex-valued phasors. The aim is to construct an a posteriori indicator that detects reflection at $\\partial\\Omega$ by computing the net real power flux through the truncation boundary via the Poynting vector. The Poynting vector is defined by the fundamental relation $\\,\\mathbf{S} = \\tfrac{1}{2}\\operatorname{Re}\\!\\left(\\mathbf{E} \\times \\mathbf{H}^*\\right)$, where $\\mathbf{H}^*$ is the complex conjugate of the magnetic field $\\mathbf{H}$, and $\\operatorname{Re}(\\cdot)$ denotes the real part. Interpret negative contributions of $\\mathbf{S}\\cdot\\mathbf{n}$, where $\\mathbf{n}$ is the unit outward normal to $\\partial\\Omega$, as incoming power due to reflection.\n\nStarting only from Maxwell’s equations and the definition of the Poynting vector, derive a reflection indicator that quantifies net energy imbalance at the boundary, and implement it numerically on discrete boundary samples. Use the following well-defined process:\n\n- For each boundary sample point $i$ with unit outward normal $\\mathbf{n}_i = (n_{x,i}, n_{y,i}, 0)$ and boundary measure $\\Delta s_i$ (with units of meters), compute the scalar flux $\\phi_i = \\mathbf{S}_i \\cdot \\mathbf{n}_i$ from the given fields by first forming $\\mathbf{E}_i \\times \\mathbf{H}_i^*$ and then taking the real part and dotting with $\\mathbf{n}_i$. The scalar flux has units of $\\mathrm{W/m^2}$; when integrated along the boundary segment length $\\Delta s_i$, the contribution $\\phi_i \\Delta s_i$ has units of $\\mathrm{W/m}$ (power per unit length in the invariant direction orthogonal to the two-dimensional cross-section).\n- Aggregate outward and inward power contributions along $\\partial\\Omega$ by defining\n  $$P_{\\text{out}} = \\sum_i \\max\\!\\left( \\phi_i,\\, 0 \\right)\\,\\Delta s_i,\\quad P_{\\text{in}} = \\sum_i \\max\\!\\left( -\\phi_i,\\, 0 \\right)\\,\\Delta s_i.$$\n- Define the reflection indicator\n  $$R = \\frac{P_{\\text{in}}}{P_{\\text{out}} + \\varepsilon},$$\n  where $\\varepsilon$ is a small, positive number in $\\mathrm{W/m}$ to prevent division by zero. Use $\\varepsilon = 10^{-12}$.\n\nInterpret $R$ purely as a dimensionless scalar. Larger values indicate greater net energy imbalance due to reflection at the boundary.\n\nConsider a two-dimensional transverse magnetic (TM$_z$) setting where $\\mathbf{H} = (0,0,H_z)$ and $\\mathbf{E} = (E_x, E_y, 0)$. For convenience in the test suite, the discrete boundary fields are constructed from prescribed outward and inward amplitude parameters relative to the outward normal $\\mathbf{n}_i$:\n- Outward-oriented component amplitude $\\,\\beta_i \\ge 0$,\n- Inward-oriented component amplitude $\\,\\delta_i \\ge 0$,\n- Magnetic field amplitude $\\,\\Gamma_i$ (possibly complex),\n- Electric field phase $\\,\\varphi_E$ and magnetic field phase $\\,\\varphi_H$ (angles in radians).\n\nFor each boundary sample $i$, define the electric and magnetic phasors by\n$$E_{x,i} = \\left(-\\beta_i + \\delta_i\\right)\\,n_{y,i}\\,e^{\\,\\mathrm{i}\\varphi_E},\\qquad\nE_{y,i} = \\left(\\beta_i - \\delta_i\\right)\\,n_{x,i}\\,e^{\\,\\mathrm{i}\\varphi_E},\\qquad\nH_{z,i} = \\Gamma_i\\,e^{\\,\\mathrm{i}\\varphi_H}.$$\nThis construction yields purely outward flux when $\\delta_i = 0$ and generates inward flux where $\\delta_i > \\beta_i$. All other vector components are zero.\n\nYour program must implement the computation of $R$ for each of the following four test cases, using the boundary geometry and parameters below. The boundary is sampled at $N = 8$ points with equal measure $\\Delta s_i = 0.5$ for all $i$.\n\nBoundary normals $\\mathbf{n}_i$ for $i = 1,\\dots,8$:\n- $i=1,2$: $\\mathbf{n}_i = (1,\\,0,\\,0)$,\n- $i=3,4$: $\\mathbf{n}_i = (-1,\\,0,\\,0)$,\n- $i=5,6$: $\\mathbf{n}_i = (0,\\,1,\\,0)$,\n- $i=7,8$: $\\mathbf{n}_i = (0,\\,-1,\\,0)$.\n\nUse the following parameters for each case:\n\n- Case A (ideal outward radiation, no reflection):\n  - $\\beta_i = 1.0$ for all $i$,\n  - $\\delta_i = 0.0$ for all $i$,\n  - $\\Gamma_i = 1.0$ for all $i$,\n  - $\\varphi_E = 0.0$, $\\varphi_H = 0.0$.\n\n- Case B (localized mild reflection at two boundary points):\n  - $\\beta_i = 1.0$ for all $i$,\n  - $\\delta_i = 1.2$ for $i \\in \\{1,5\\}$ and $\\delta_i = 0.0$ otherwise,\n  - $\\Gamma_i = 1.0$ for all $i$,\n  - $\\varphi_E = 0.0$, $\\varphi_H = 0.0$.\n\n- Case C (near-cancellation with balanced inward/outward contributions):\n  - $\\beta_i = 1.0$ for all $i$,\n  - $\\delta_i = 1.02$ for $i \\in \\{1,2,3,4\\}$ and $\\delta_i = 0.98$ for $i \\in \\{5,6,7,8\\}$,\n  - $\\Gamma_i = 1.0$ for all $i$,\n  - $\\varphi_E = 0.0$, $\\varphi_H = 0.0$.\n\n- Case D (complex phasors with phase difference):\n  - $\\beta_i = 1.0$ for all $i$,\n  - $\\delta_i = 1.2$ for $i \\in \\{3,7\\}$, $\\delta_i = 0.2$ otherwise,\n  - $\\Gamma_i = 1.0$ for all $i$,\n  - $\\varphi_E = \\pi/4$, $\\varphi_H = \\pi/6$.\n\nAngle values are in radians. Power flux must be computed in $\\mathrm{W/m}$ when integrated along the boundary. The reflection indicator $R$ is unitless. Use $\\varepsilon = 10^{-12}\\,\\mathrm{W/m}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each entry being the value of $R$ for one test case rounded to six decimal places in decimal format. For example, the output should look like:\n$[r_A,r_B,r_C,r_D]$\nwhere $r_A$, $r_B$, $r_C$, $r_D$ are the computed indicators for Cases A, B, C, and D, respectively.\n\nThis test suite is designed to probe:\n- A \"happy path\" case with zero inward power,\n- A localized reflection case,\n- A boundary condition edge case where inward and outward nearly balance,\n- A complex-valued field case with a phase shift affecting the real power flux.", "solution": "The problem is assessed to be valid. It is scientifically grounded in electromagnetic theory, well-posed, objective, and provides a complete and consistent set of definitions and data for a solvable numerical task.\n\nThe primary objective is to derive an explicit formula for the reflection indicator $R$ and then compute it for four specified test cases. The derivation begins from the fundamental definition of the time-averaged Poynting vector, $\\mathbf{S}$, for time-harmonic fields with an $e^{+\\mathrm{i}\\omega t}$ time dependency.\n\nThe Poynting vector is given by\n$$ \\mathbf{S} = \\frac{1}{2}\\operatorname{Re}\\!\\left(\\mathbf{E} \\times \\mathbf{H}^*\\right) $$\nwhere $\\mathbf{E}$ is the electric field phasor, $\\mathbf{H}^*$ is the complex conjugate of the magnetic field phasor, and $\\operatorname{Re}(\\cdot)$ denotes the real part of a complex quantity.\n\nThe problem is set in a two-dimensional transverse magnetic (TM$_z$) configuration. For each discrete sample point $i$ on the boundary $\\partial\\Omega$, the field vectors are:\n$$ \\mathbf{E}_i = (E_{x,i}, E_{y,i}, 0) $$\n$$ \\mathbf{H}_i = (0, 0, H_{z,i}) $$\nThe complex conjugate of the magnetic field is:\n$$ \\mathbf{H}_i^* = (0, 0, H_{z,i}^*) $$\nFirst, we compute the cross product $\\mathbf{E}_i \\times \\mathbf{H}_i^*$:\n$$ \\mathbf{E}_i \\times \\mathbf{H}_i^* =\n\\begin{vmatrix}\n\\mathbf{\\hat{x}} & \\mathbf{\\hat{y}} & \\mathbf{\\hat{z}} \\\\\nE_{x,i} & E_{y,i} & 0 \\\\\n0 & 0 & H_{z,i}^*\n\\end{vmatrix}\n= (E_{y,i} H_{z,i}^*)\\,\\mathbf{\\hat{x}} - (E_{x,i} H_{z,i}^*)\\,\\mathbf{\\hat{y}} + 0\\,\\mathbf{\\hat{z}}\n$$\nThe Poynting vector at point $i$, $\\mathbf{S}_i$, is then:\n$$ \\mathbf{S}_i = \\frac{1}{2}\\operatorname{Re}\\!\\left( (E_{y,i} H_{z,i}^*,\\, -E_{x,i} H_{z,i}^*,\\, 0) \\right) = \\frac{1}{2} \\left( \\operatorname{Re}(E_{y,i} H_{z,i}^*),\\, -\\operatorname{Re}(E_{x,i} H_{z,i}^*),\\, 0 \\right) $$\nNext, we compute the scalar flux $\\phi_i$ by taking the dot product of $\\mathbf{S}_i$ with the outward unit normal vector $\\mathbf{n}_i = (n_{x,i}, n_{y,i}, 0)$:\n$$ \\phi_i = \\mathbf{S}_i \\cdot \\mathbf{n}_i = \\frac{1}{2} \\left( \\operatorname{Re}(E_{y,i} H_{z,i}^*) n_{x,i} - \\operatorname{Re}(E_{x,i} H_{z,i}^*) n_{y,i} \\right) $$\nThe problem provides specific parameterizations for the field components:\n$$ E_{x,i} = \\left(-\\beta_i + \\delta_i\\right)\\,n_{y,i}\\,e^{\\,\\mathrm{i}\\varphi_E} $$\n$$ E_{y,i} = \\left(\\beta_i - \\delta_i\\right)\\,n_{x,i}\\,e^{\\,\\mathrm{i}\\varphi_E} $$\n$$ H_{z,i} = \\Gamma_i\\,e^{\\,\\mathrm{i}\\varphi_H} $$\nand therefore,\n$$ H_{z,i}^* = \\Gamma_i^*\\,e^{-\\mathrm{i}\\varphi_H} $$\nNote that in all given test cases, $\\Gamma_i$ is a real number ($1.0$), so $\\Gamma_i^* = \\Gamma_i$. Let us proceed with the general form first. Let us calculate the complex products inside the $\\operatorname{Re}(\\cdot)$ operators:\n$$ E_{y,i} H_{z,i}^* = \\left(\\beta_i - \\delta_i\\right) n_{x,i} e^{\\mathrm{i}\\varphi_E} \\cdot \\Gamma_i^* e^{-\\mathrm{i}\\varphi_H} = \\left(\\beta_i - \\delta_i\\right) n_{x,i} \\Gamma_i^* e^{\\mathrm{i}\\left(\\varphi_E - \\varphi_H\\right)} $$\n$$ E_{x,i} H_{z,i}^* = \\left(-\\beta_i + \\delta_i\\right) n_{y,i} e^{\\mathrm{i}\\varphi_E} \\cdot \\Gamma_i^* e^{-\\mathrm{i}\\varphi_H} = -\\left(\\beta_i - \\delta_i\\right) n_{y,i} \\Gamma_i^* e^{\\mathrm{i}\\left(\\varphi_E - \\varphi_H\\right)} $$\nNow, taking the real parts, and using the identity $\\operatorname{Re}(z) = \\operatorname{Re}(a+\\mathrm{i}b) = a$ and Euler's formula $e^{\\mathrm{i}\\theta} = \\cos(\\theta) + \\mathrm{i}\\sin(\\theta)$, and assuming $\\Gamma_i$ is real as given in the test cases:\n$$ \\operatorname{Re}(E_{y,i} H_{z,i}^*) = \\left(\\beta_i - \\delta_i\\right) n_{x,i} \\Gamma_i \\cos\\left(\\varphi_E - \\varphi_H\\right) $$\n$$ \\operatorname{Re}(E_{x,i} H_{z,i}^*) = -\\left(\\beta_i - \\delta_i\\right) n_{y,i} \\Gamma_i \\cos\\left(\\varphi_E - \\varphi_H\\right) $$\nSubstituting these expressions back into the formula for $\\phi_i$:\n$$ \\phi_i = \\frac{1}{2} \\left[ \\left(\\left(\\beta_i - \\delta_i\\right) n_{x,i} \\Gamma_i \\cos\\left(\\varphi_E - \\varphi_H\\right)\\right) n_{x,i} - \\left(-\\left(\\beta_i - \\delta_i\\right) n_{y,i} \\Gamma_i \\cos\\left(\\varphi_E - \\varphi_H\\right)\\right) n_{y,i} \\right] $$\nFactoring out the common terms:\n$$ \\phi_i = \\frac{1}{2} \\left(\\beta_i - \\delta_i\\right) \\Gamma_i \\cos\\left(\\varphi_E - \\varphi_H\\right) \\left(n_{x,i}^2 + n_{y,i}^2\\right) $$\nSince $\\mathbf{n}_i$ is a unit vector, the sum of the squares of its components is $1$: $n_{x,i}^2 + n_{y,i}^2 = 1$. This simplifies the expression for the scalar flux significantly:\n$$ \\phi_i = \\frac{1}{2} \\left(\\beta_i - \\delta_i\\right) \\Gamma_i \\cos\\left(\\varphi_E - \\varphi_H\\right) $$\nThis simplified formula for $\\phi_i$ forms the basis of the numerical computation. The total outward and inward power per unit length, $P_{\\text{out}}$ and $P_{\\text{in}}$, are computed by summing the contributions from all $N=8$ boundary sample points, each with a boundary measure $\\Delta s_i = 0.5$:\n$$ P_{\\text{out}} = \\sum_{i=1}^{N} \\max\\!\\left( \\phi_i,\\, 0 \\right)\\,\\Delta s_i $$\n$$ P_{\\text{in}} = \\sum_{i=1}^{N} \\max\\!\\left( -\\phi_i,\\, 0 \\right)\\,\\Delta s_i $$\nFinally, the reflection indicator $R$ is calculated as the ratio of the total inward power to the total outward power, with a small regularization term $\\varepsilon = 10^{-12} \\, \\mathrm{W/m}$ to prevent division by zero:\n$$ R = \\frac{P_{\\text{in}}}{P_{\\text{out}} + \\varepsilon} $$\nThe algorithm for the solution is to iterate through each test case, apply the specified parameters to calculate $\\phi_i$ for all $8$ points, aggregate $P_{\\text{in}}$ and $P_{\\text{out}}$, and then compute $R$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the reflection indicator R for four test cases based on\n    a derived formula for electromagnetic power flux at a boundary.\n    \"\"\"\n    \n    # Constants defined in the problem statement\n    NUM_POINTS = 8\n    DELTA_S = 0.5\n    EPSILON = 1e-12\n\n    # Define the parameters for each of the four test cases.\n    # Note: Problem uses 1-based indexing for points i=1..8.\n    # We use 0-based indexing in arrays, so i=1 corresponds to index 0.\n\n    # Case A: Ideal outward radiation\n    delta_A = np.full(NUM_POINTS, 0.0)\n\n    # Case B: Localized mild reflection\n    delta_B = np.full(NUM_POINTS, 0.0)\n    delta_B[0] = 1.2  # i=1\n    delta_B[4] = 1.2  # i=5\n\n    # Case C: Near-cancellation\n    delta_C = np.full(NUM_POINTS, 0.98)\n    delta_C[0:4] = 1.02 # i=1,2,3,4\n\n    # Case D: Complex phasors with phase difference\n    delta_D = np.full(NUM_POINTS, 0.2)\n    delta_D[2] = 1.2  # i=3\n    delta_D[6] = 1.2  # i=7\n    \n    test_cases = [\n        # Case A (ideal outward radiation, no reflection):\n        {\n            \"beta\": np.full(NUM_POINTS, 1.0),\n            \"delta\": delta_A,\n            \"gamma\": np.full(NUM_POINTS, 1.0),\n            \"phi_E\": 0.0,\n            \"phi_H\": 0.0,\n        },\n        # Case B (localized mild reflection at two boundary points):\n        {\n            \"beta\": np.full(NUM_POINTS, 1.0),\n            \"delta\": delta_B,\n            \"gamma\": np.full(NUM_POINTS, 1.0),\n            \"phi_E\": 0.0,\n            \"phi_H\": 0.0,\n        },\n        # Case C (near-cancellation with balanced inward/outward contributions):\n        {\n            \"beta\": np.full(NUM_POINTS, 1.0),\n            \"delta\": delta_C,\n            \"gamma\": np.full(NUM_POINTS, 1.0),\n            \"phi_E\": 0.0,\n            \"phi_H\": 0.0,\n        },\n        # Case D (complex phasors with phase difference):\n        {\n            \"beta\": np.full(NUM_POINTS, 1.0),\n            \"delta\": delta_D,\n            \"gamma\": np.full(NUM_POINTS, 1.0),\n            \"phi_E\": np.pi / 4.0,\n            \"phi_H\": np.pi / 6.0,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        p_out = 0.0\n        p_in = 0.0\n        \n        beta_vals = case[\"beta\"]\n        delta_vals = case[\"delta\"]\n        gamma_vals = case[\"gamma\"]\n        phi_E = case[\"phi_E\"]\n        phi_H = case[\"phi_H\"]\n        \n        # Pre-compute the constant factor for the scalar flux calculation\n        cos_phase_diff = np.cos(phi_E - phi_H)\n        \n        for i in range(NUM_POINTS):\n            # Simplified formula derived in the solution:\n            # phi_i = 0.5 * (beta_i - delta_i) * gamma_i * cos(phi_E - phi_H)\n            phi_i = 0.5 * (beta_vals[i] - delta_vals[i]) * gamma_vals[i] * cos_phase_diff\n            \n            # Aggregate outward and inward power contributions\n            p_out += max(phi_i, 0.0) * DELTA_S\n            p_in += max(-phi_i, 0.0) * DELTA_S\n            \n        # Calculate the reflection indicator R\n        R = p_in / (p_out + EPSILON)\n        results.append(R)\n\n    # Format the results as specified: a comma-separated list in brackets,\n    # with each value rounded to six decimal places.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3336184"}, {"introduction": "The effectiveness of standard numerical techniques often relies on simplifying assumptions, such as the material in the physical domain being isotropic. This advanced practice explores what happens when these assumptions are violated, focusing on the application of PMLs to gyrotropic anisotropic media. You will investigate a subtle but critical implementation detail [@problem_id:3336172]: the potential non-commutativity of the PML stretching operator and the material's permittivity tensor, $\\bar{\\bar{\\epsilon}}$. This exercise demonstrates how a \"naive\" PML formulation can generate artificial reflections at the interface and provides a framework to analytically quantify this error.", "problem": "Consider two homogeneous half-spaces separated by the plane $x=0$. The left half-space ($x<0$) is a lossless gyrotropic magneto-optic medium with relative permittivity tensor\n$$\n\\bar{\\bar{\\epsilon}} = \n\\begin{pmatrix}\n\\epsilon_t & \\mathrm{i} g & 0\\\\\n- \\mathrm{i} g & \\epsilon_t & 0\\\\\n0 & 0 & \\epsilon_z\n\\end{pmatrix},\n$$\nand relative permeability $\\mu=\\mathrm{diag}(1,1,1)$, where $\\epsilon_t>0$, $\\epsilon_z>0$, and $g$ is real with $|g|<\\epsilon_t$. A time-harmonic ($e^{-\\mathrm{i} \\omega t}$) transverse-magnetic-out-of-plane (TM$z$) plane wave of angular frequency $\\omega$ with wavevector components $(k_x,k_y)$ impinges from the left. Assume fields have the $z$-invariant TM$z$ form with nonzero components $E_x$, $E_y$, and $H_z$ depending on $x$ and $y$ as $e^{\\mathrm{i} k_x x + \\mathrm{i} k_y y}$. The right half-space ($x>0$) is an absorbing layer constructed using a Perfectly Matched Layer (PML) complex coordinate stretch along $x$ with stretch factor $s_x \\in \\mathbb{C}$, $s_x=\\kappa_x + \\mathrm{i} \\sigma_x/\\omega$, where $\\kappa_x>0$ and $\\sigma_x\\ge 0$. Work in normalized units with $c=1$, $\\mu_0=1$, and $\\epsilon_0=1$ so that $k_0=\\omega$ and the free-space wave speed is unity.\n\nThe exact transformation-optics construction for stretching only along $x$ uses the Jacobian $\\Lambda=\\mathrm{diag}(1/s_x,1,1)$ and yields the transformed constitutive tensors in the PML region\n$$\n\\tilde{\\epsilon}_\\mathrm{exact} = \\det(\\Lambda)^{-1} \\Lambda \\, \\epsilon \\, \\Lambda^T,\\qquad\n\\tilde{\\mu}_\\mathrm{exact} = \\det(\\Lambda)^{-1} \\Lambda \\, \\mu \\, \\Lambda^T.\n$$\nHowever, many finite element method (FEM) implementations assume a commuting approximation between the diagonal stretch and the material tensor when forming element matrices, effectively replacing the exact transform by\n$$\n\\tilde{\\epsilon}_\\mathrm{naive} = \\det(\\Lambda)^{-1}\\, \\epsilon \\, \\Lambda^2,\\qquad\n\\tilde{\\mu}_\\mathrm{naive} = \\det(\\Lambda)^{-1}\\, \\Lambda^2 \\, \\mu,\n$$\nwhich coincides with the exact transform only if $\\epsilon$ and $\\Lambda$ commute. For the gyrotropic tensor above, $\\epsilon$ and $\\Lambda$ do not commute when $g\\ne 0$, which can generate residual reflections at the PML interface even in the continuous setting.\n\nStarting from Maxwell-Faraday and Maxwell-Ampère equations in the frequency domain and enforcing the plane-wave ansatz with given transverse wavenumber $k_y$, derive a dispersion relation in $k_x$ for TM$z$ modes in a homogeneous anisotropic medium with in-plane $2\\times 2$ permittivity sub-tensor\n$$\n\\bar{\\bar{\\epsilon}}_\\parallel = \\begin{pmatrix}\\epsilon_{xx} & \\epsilon_{xy}\\\\ \\epsilon_{yx} & \\epsilon_{yy}\\end{pmatrix},\n$$\nand scalar $\\mu_z$. Use this to compute, for each half-space, the two longitudinal wavenumbers (the roots in $k_x$), the ratio $E_x/E_y$ for each mode, and the modal admittance $Y=H_z/E_y$. Then, by enforcing continuity of the tangential fields $E_y$ and $H_z$ at $x=0$, express the complex reflection coefficient $R$ for an incident unit-amplitude forward mode from the left in terms of the modal admittances of the left-going (reflected) mode in the left half-space and the forward (decaying) mode in the right half-space. Finally, define and compute the residual reflection magnitude as $|R|$ when the right half-space uses the naive commuting PML transform instead of the exact transform.\n\nImplement a program that, for each test case below, constructs the left-medium tensor from $(\\epsilon_t,g,\\epsilon_z)$, constructs the right-medium naive PML tensor from $(\\epsilon_t,g,\\epsilon_z)$ and $s_x$ via the commuting approximation above, and computes the magnitude $|R|$ of the reflection coefficient at $x=0$ for a TM$z$ plane wave with the specified $k_0$ and $k_y$. Use the following foundational base only: the differential-form or vector-form Maxwell equations, the linear time-harmonic constitutive relations $D=\\epsilon_0 \\bar{\\bar{\\epsilon}} E$ and $B=\\mu_0 \\bar{\\bar{\\mu}} H$, and the plane-wave ansatz. No other shortcut formulas may be assumed in the derivation.\n\nUnits and angle specification: All quantities are dimensionless under the normalization $c=1$, $\\epsilon_0=1$, and $\\mu_0=1$. The stretch factor $s_x$ is specified directly as a complex number with its imaginary part representing loss. The transverse wavenumber $k_y$ is real and specified in radians per unit length.\n\nTest suite. For each case, the tuple is $(\\epsilon_t, g, \\epsilon_z, k_0, k_y, s_x)$:\n- Case $1$: $(2.25, 0.1, 2.25, 2\\pi, 0.3\\, k_0 \\sqrt{\\epsilon_t - g^2/\\epsilon_t}, 1 + 0.5\\mathrm{i})$.\n- Case $2$ (isotropic limit): $(2.25, 0.0, 2.25, 2\\pi, 0.3\\, k_0 \\sqrt{\\epsilon_t - g^2/\\epsilon_t}, 1 + 0.5\\mathrm{i})$.\n- Case $3$ (stronger gyrotropy and stronger PML): $(3.0, 0.8, 3.0, 2\\pi, 0.2\\, k_0 \\sqrt{\\epsilon_t - g^2/\\epsilon_t}, 1 + 1.0\\mathrm{i})$.\n- Case $4$ (near-normal incidence): $(2.25, 0.2, 2.25, 2\\pi, 0.01\\, k_0 \\sqrt{\\epsilon_t - g^2/\\epsilon_t}, 1 + 0.8\\mathrm{i})$.\n- Case $5$ (no stretch as a control): $(2.25, 0.2, 2.25, 2\\pi, 0.25\\, k_0 \\sqrt{\\epsilon_t - g^2/\\epsilon_t}, 1 + 0\\mathrm{i})$.\n\nYour program should output a single line containing the list of residual reflection magnitudes for the cases above as a comma-separated list enclosed in square brackets, for example $[r_1,r_2,r_3,r_4,r_5]$, where each $r_j$ is a floating-point number rounded to six decimal places.", "solution": "The problem is valid as it is scientifically sound, well-posed, and contains no ambiguities or contradictions. We will proceed with a full derivation and solution.\n\nThe problem concerns a time-harmonic plane wave with a temporal dependence of $e^{-\\mathrm{i} \\omega t}$ incident on an interface between a gyrotropic medium and a Perfectly Matched Layer (PML). We work in normalized units where the speed of light in vacuum $c=1$, the vacuum permeability $\\mu_0=1$, and the vacuum permittivity $\\epsilon_0=1$. This implies the free-space wavenumber is $k_0 = \\omega/c = \\omega$.\n\nThe wave is specified as Transverse-Magnetic-out-of-plane (TM$z$), which is defined by the nonzero field components $E_x$, $E_y$, and $H_z$. All fields are taken to be $z$-invariant ($\\partial/\\partial z = 0$) and have a spatial dependency of $e^{\\mathrm{i} k_x x + \\mathrm{i} k_y y}$, where $k_y$ is the given transverse wavenumber and $k_x$ is the longitudinal wavenumber to be determined.\n\nThe analysis starts from the frequency-domain Maxwell's equations:\n$$\n\\nabla \\times \\mathbf{E} = \\mathrm{i} \\omega \\mathbf{B} = \\mathrm{i} k_0 \\bar{\\bar{\\mu}} \\mathbf{H}\n$$\n$$\n\\nabla \\times \\mathbf{H} = -\\mathrm{i} \\omega \\mathbf{D} = -\\mathrm{i} k_0 \\bar{\\bar{\\epsilon}} \\mathbf{E}\n$$\n\nFor a TM$z$ field configuration $\\mathbf{E} = E_x(x,y) \\hat{x} + E_y(x,y) \\hat{y}$ and $\\mathbf{H} = H_z(x,y) \\hat{z}$, and assuming a general anisotropic medium with permittivity $\\bar{\\bar{\\epsilon}}$ and permeability $\\bar{\\bar{\\mu}}$, Maxwell's equations decouple. For the fields to be TM$z$, we must have $\\epsilon_{z,1}=\\epsilon_{z,2}=0$ and $\\mu_{1,z}=\\mu_{2,z}=0$, which is the case for the given tensors. The relevant material parameters are the in-plane permittivity sub-tensor $\\bar{\\bar{\\epsilon}}_\\parallel = \\begin{pmatrix}\\epsilon_{xx} & \\epsilon_{xy}\\\\ \\epsilon_{yx} & \\epsilon_{yy}\\end{pmatrix}$ and the out-of-plane permeability $\\mu_z = \\mu_{zz}$.\n\nWith the plane-wave ansatz $e^{\\mathrm{i} k_x x + \\mathrm{i} k_y y}$, the differential operators become $\\nabla \\to \\mathrm{i}(k_x \\hat{x} + k_y \\hat{y})$.\n\nFrom Faraday's Law, $\\nabla \\times \\mathbf{E} = ( \\partial_x E_y - \\partial_y E_x )\\hat{z}$, which becomes:\n$$\n(\\mathrm{i} k_x E_y - \\mathrm{i} k_y E_x)\\hat{z} = \\mathrm{i} k_0 \\mu_z H_z \\hat{z} \\implies k_x E_y - k_y E_x = k_0 \\mu_z H_z \\quad (1)\n$$\nFrom Ampere's Law, $\\nabla \\times \\mathbf{H} = \\partial_y H_z \\hat{x} - \\partial_x H_z \\hat{y}$, which becomes:\n$$\n(\\mathrm{i} k_y H_z)\\hat{x} - (\\mathrm{i} k_x H_z)\\hat{y} = -\\mathrm{i} k_0 (\\epsilon_{xx}E_x + \\epsilon_{xy}E_y)\\hat{x} - \\mathrm{i} k_0 (\\epsilon_{yx}E_x + \\epsilon_{yy}E_y)\\hat{y}\n$$\nEquating components gives:\n$$\nk_y H_z = -k_0 (\\epsilon_{xx}E_x + \\epsilon_{xy}E_y) \\quad (2)\n$$\n$$\n-k_x H_z = -k_0 (\\epsilon_{yx}E_x + \\epsilon_{yy}E_y) \\quad (3)\n$$\nWe can express $\\mathbf{E}_\\parallel = (E_x, E_y)^T$ in terms of $H_z$ from equations (2) and (3):\n$$\n\\begin{pmatrix} \\epsilon_{xx} & \\epsilon_{xy} \\\\ \\epsilon_{yx} & \\epsilon_{yy} \\end{pmatrix} \\begin{pmatrix} E_x \\\\ E_y \\end{pmatrix} = -\\frac{H_z}{k_0} \\begin{pmatrix} k_y \\\\ -k_x \\end{pmatrix}\n$$\nInverting the matrix yields expressions for $E_x$ and $E_y$:\n$$\nE_x = -\\frac{H_z}{k_0 \\det(\\bar{\\bar{\\epsilon}}_\\parallel)} (\\epsilon_{yy} k_y + \\epsilon_{xy} k_x) \\quad (4)\n$$\n$$\nE_y = \\frac{H_z}{k_0 \\det(\\bar{\\bar{\\epsilon}}_\\parallel)} (\\epsilon_{yx} k_y + \\epsilon_{xx} k_x) \\quad (5)\n$$\nwhere $\\det(\\bar{\\bar{\\epsilon}}_\\parallel) = \\epsilon_{xx}\\epsilon_{yy} - \\epsilon_{xy}\\epsilon_{yx}$.\n\nSubstituting (4) and (5) into (1) gives the dispersion relation:\n$$\nk_x \\left[ \\frac{H_z (\\epsilon_{yx} k_y + \\epsilon_{xx} k_x)}{k_0 \\det(\\bar{\\bar{\\epsilon}}_\\parallel)} \\right] - k_y \\left[ -\\frac{H_z (\\epsilon_{yy} k_y + \\epsilon_{xy} k_x)}{k_0 \\det(\\bar{\\bar{\\epsilon}}_\\parallel)} \\right] = k_0 \\mu_z H_z\n$$\n$$\n\\epsilon_{xx}k_x^2 + (\\epsilon_{xy} + \\epsilon_{yx})k_y k_x + \\epsilon_{yy}k_y^2 = k_0^2 \\mu_z \\det(\\bar{\\bar{\\epsilon}}_\\parallel)\n$$\nThis is a quadratic equation for $k_x$ for a given $k_y$.\n\nThe modal admittance is defined as $Y=H_z/E_y$. From equation (5):\n$$\nY = \\frac{k_0 \\det(\\bar{\\bar{\\epsilon}}_\\parallel)}{\\epsilon_{yx} k_y + \\epsilon_{xx} k_x}\n$$\n\nNow we apply these general results to the two media.\n\n**Left Half-Space ($x < 0$): Gyrotropic Medium**\nThe material parameters are $\\epsilon_{xx}=\\epsilon_t$, $\\epsilon_{yy}=\\epsilon_t$, $\\epsilon_{xy}=\\mathrm{i}g$, $\\epsilon_{yx}=-\\mathrm{i}g$, and $\\mu_z=1$.\nThen $\\epsilon_{xy}+\\epsilon_{yx}=0$ and $\\det(\\bar{\\bar{\\epsilon}}_\\parallel) = \\epsilon_t^2-g^2$. The dispersion relation simplifies to:\n$$\n\\epsilon_t k_x^2 + \\epsilon_t k_y^2 = k_0^2(\\epsilon_t^2 - g^2) \\implies k_x^2 + k_y^2 = k_0^2(\\epsilon_t - g^2/\\epsilon_t)\n$$\nThe longitudinal wavenumbers are $k_{x,L}^{\\pm} = \\pm \\sqrt{k_0^2(\\epsilon_t - g^2/\\epsilon_t) - k_y^2}$. The incident wave (propagating towards $+x$) has $k_{x,inc} = k_{x,L}^+$, and the reflected wave (propagating towards $-x$) has $k_{x,ref} = k_{x,L}^- = -k_{x,inc}$.\nThe admittances for the incident and reflected modes are:\n$$\nY_{inc} = \\frac{k_0 (\\epsilon_t^2-g^2)}{-\\mathrm{i}g k_y + \\epsilon_t k_{x,inc}}, \\quad Y_{ref} = \\frac{k_0 (\\epsilon_t^2-g^2)}{-\\mathrm{i}g k_y + \\epsilon_t k_{x,ref}}\n$$\n\n**Right Half-Space ($x > 0$): Naive PML Medium**\nThe naive PML transform is $\\tilde{\\epsilon} = s_x \\epsilon \\Lambda^2$ and $\\tilde{\\mu} = s_x \\mu \\Lambda^2$, where $\\Lambda=\\mathrm{diag}(1/s_x,1,1)$.\nThis gives $\\tilde{\\mu}_\\parallel = \\mathrm{diag}(1/s_x, s_x)$, $\\tilde{\\mu}_z = s_x$.\nThe transformed permittivity tensor is $\\tilde{\\epsilon} = \\begin{pmatrix} \\epsilon_t/s_x & \\mathrm{i} g s_x & 0 \\\\ -\\mathrm{i}g/s_x & \\epsilon_t s_x & 0 \\\\ 0 & 0 & \\epsilon_z s_x \\end{pmatrix}$.\nThe parameters for the right medium are:\n$\\epsilon_{xx}^{(R)} = \\epsilon_t/s_x$, $\\epsilon_{xy}^{(R)} = \\mathrm{i}gs_x$, $\\epsilon_{yx}^{(R)} = -\\mathrm{i}g/s_x$, $\\epsilon_{yy}^{(R)} = \\epsilon_t s_x$, and $\\mu_z^{(R)}=s_x$.\nThe determinant is invariant: $\\det(\\bar{\\bar{\\epsilon}}_\\parallel^{(R)}) = (\\epsilon_t/s_x)(\\epsilon_t s_x) - (\\mathrm{i} g s_x)(-\\mathrm{i}g/s_x) = \\epsilon_t^2-g^2$.\nThe dispersion relation for $k_x$ in the right medium is a quadratic equation $A k_x^2 + B k_x + C = 0$ with:\n$$\nA = \\frac{\\epsilon_t}{s_x}, \\quad B = \\mathrm{i} g (s_x - \\frac{1}{s_x}) k_y, \\quad C = \\epsilon_t s_x k_y^2 - k_0^2 s_x (\\epsilon_t^2 - g^2)\n$$\nWe solve this for $k_x$ and choose the root $k_{x,trans}$ which corresponds to a decaying wave for $x>0$, i.e., $\\mathrm{Im}(k_{x,trans}) > 0$.\nThe admittance of this transmitted mode is:\n$$\nY_{trans} = \\frac{k_0 \\det(\\bar{\\bar{\\epsilon}}_\\parallel^{(R)})}{\\epsilon_{yx}^{(R)} k_y + \\epsilon_{xx}^{(R)} k_{x,trans}} = \\frac{k_0 (\\epsilon_t^2-g^2)}{(-\\mathrm{i}g/s_x) k_y + (\\epsilon_t/s_x) k_{x,trans}} = \\frac{s_x k_0 (\\epsilon_t^2-g^2)}{-\\mathrm{i}g k_y + \\epsilon_t k_{x,trans}}\n$$\n\n**Reflection Coefficient**\nAt the interface $x=0$, tangential fields $E_y$ and $H_z$ are continuous.\nTotal field for $x<0$: $E_y = E_{y,inc} + E_{y,ref}$, $H_z = H_{z,inc} + H_{z,ref}$.\nTotal field for $x>0$: $E_y = E_{y,trans}$, $H_z = H_{z,trans}$.\nContinuity at $x=0$:\n$$\nE_{y,inc} + E_{y,ref} = E_{y,trans}\n$$\n$$\nY_{inc} E_{y,inc} + Y_{ref} E_{y,ref} = Y_{trans} E_{y,trans}\n$$\nThe reflection coefficient is $R=E_{y,ref}/E_{y,inc}$. Solving the system for $R$ yields:\n$$\nR = \\frac{Y_{inc} - Y_{trans}}{Y_{trans} - Y_{ref}}\n$$\nThe magnitude $|R|$ is the required output. For the special cases where $g=0$ (isotropic) or $s_x=1$ (no PML), the naive PML transform is exact or absent, respectively, resulting in a perfect match, and thus $|R|=0$. This serves as a check on our derivation.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the residual reflection from a naive PML termination of a gyrotropic medium.\n    \"\"\"\n    # Test cases as tuples: (epsilon_t, g, epsilon_z, k0, ky_factor, sx)\n    test_cases_defs = [\n        (2.25, 0.1, 2.25, 2 * np.pi, 0.3, 1 + 0.5j),\n        (2.25, 0.0, 2.25, 2 * np.pi, 0.3, 1 + 0.5j),\n        (3.0, 0.8, 3.0, 2 * np.pi, 0.2, 1 + 1.0j),\n        (2.25, 0.2, 2.25, 2 * np.pi, 0.01, 1 + 0.8j),\n        (2.25, 0.2, 2.25, 2 * np.pi, 0.25, 1 + 0.0j),\n    ]\n\n    results = []\n    for et_val, g_val, ez_val, k0_val, ky_fact, sx_val in test_cases_defs:\n        # Use complex numbers throughout for generality and precision\n        et, g, k0, sx = map(np.complex128, [et_val, g_val, k0_val, sx_val])\n\n        # Calculate ky based on the formula for each case\n        # eps_v = epsilon_t - g^2/epsilon_t (Voigt permittivity)\n        eps_v = et - g**2 / et if et != 0 else 0\n        ky = ky_fact * k0 * np.sqrt(eps_v)\n\n        # Left Medium (x < 0)\n        # Dispersion relation: k_x^2 + k_y^2 = k_0^2 * eps_v\n        kx_inc_sq = k0**2 * eps_v - ky**2\n        kx_inc = np.sqrt(kx_inc_sq)\n        kx_ref = -kx_inc\n\n        # Admittance Y = H_z / E_y = k0 * det(eps_parallel) / (eps_yx * ky + eps_xx * kx)\n        # For left medium: eps_xx = et, eps_yx = -i*g, det(eps_parallel) = et^2 - g^2\n        det_eps_parallel = et**2 - g**2\n        \n        Y_inc = k0 * det_eps_parallel / (-1j * g * ky + et * kx_inc)\n        Y_ref = k0 * det_eps_parallel / (-1j * g * ky + et * kx_ref)\n\n        # Right Medium (x > 0) - Naive PML\n        # Setup quadratic equation for kx in the PML: A*kx^2 + B*kx + C = 0\n        A = et / sx\n        B = 1j * g * (sx - 1/sx) * ky\n        C = et * sx * ky**2 - k0**2 * sx * det_eps_parallel\n        \n        # Solve for kx roots\n        discriminant = np.sqrt(B**2 - 4*A*C)\n        kx_r1 = (-B + discriminant) / (2 * A)\n        kx_r2 = (-B - discriminant) / (2 * A)\n        \n        # Choose the root corresponding to decay for x > 0, which has Im(kx) > 0.\n        # This check is more robust than relying on the sign of the determinant.\n        kx_trans = kx_r1 if kx_r1.imag > kx_r2.imag else kx_r2\n            \n        # Admittance of the transmitted mode in the PML\n        # Y_trans = s_x * k_0 * det(eps_parallel) / (-i*g*k_y + eps_t*k_x_trans)\n        Y_trans = sx * k0 * det_eps_parallel / (-1j * g * ky + et * kx_trans)\n        \n        # Reflection coefficient R = (Y_inc - Y_trans) / (Y_trans - Y_ref)\n        denominator = Y_trans - Y_ref\n        if np.isclose(denominator, 0.0):\n            # This occurs for a perfect match (e.g., g=0 or sx=1), where Y_inc = Y_trans\n            R = 0.0\n        else:\n            R = (Y_inc - Y_trans) / denominator\n            \n        results.append(np.abs(R))\n\n    # Format the final output string\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3336172"}]}