{"hands_on_practices": [{"introduction": "在计算机体系结构中，设计决策常常需要在性能、面积和功耗之间进行权衡。这个练习通过比较一个大型单周期组合乘法器和一个小巧的多周期迭代乘法器，具体展示了动态功耗和静态功耗之间的基本冲突。通过推导每种设计的总能耗表达式，你将能够确定一个“盈亏平衡点”，即迭代方法在能效上开始超越并行方法的特定操作数大小[@problem_id:36046]。", "problem": "一个设计团队正在评估两种采用互补金属氧化物半导体 (CMOS) 技术实现的无符号乘法器微架构，它们用于处理长度为 $n$ 位的操作数，并在电源电压为 $V$、时钟频率为 $f$ 的条件下运行。其中一种是全组合阵列乘法器，它在一个时钟周期内完成；另一种是位串行迭代乘法器，它需要 $n$ 个时钟周期。\n\n基本和建模假设：\n- 将一个电容从 $0$ 充电到 $V$ 会储存能量 $\\frac{1}{2} C V^{2}$，随后的放电会耗散该能量；在多个节点和周期中，每个周期的平均动态能耗可以建模为 $\\alpha \\, C_{\\mathrm{eq}} \\, V^{2}$，其中 $\\alpha$ 是平均活动因子，而 $C_{\\mathrm{eq}}$ 是聚合了所有翻转节点的等效开关电容。\n- 静态（泄漏）功率建模为 $P_{\\mathrm{leak}} = I_{\\mathrm{leak}} \\, V$，因此在时间 $t$ 内的泄漏能耗为 $E_{\\mathrm{leak}} = I_{\\mathrm{leak}} \\, V \\, t$。\n\n以下与技术和微架构相关的参数被认为是经过实验校准并提供的：\n- 电源电压 $V = 0.8 \\,\\mathrm{V}$ 和时钟频率 $f = 1.0 \\times 10^{9} \\,\\mathrm{Hz}$。\n- 组合乘法器：\n  - 平均活动因子 $\\alpha_{\\mathrm{comb}} = 0.15$ 每周期。\n  - 等效开关电容缩放关系 $C_{\\mathrm{comb}}(n) = k_{C} \\, n^{2}$，其中 $k_{C} = 0.4 \\times 10^{-15} \\,\\mathrm{F}$。\n  - 泄漏电流缩放关系 $I_{\\mathrm{leak,comb}}(n) = k_{I} \\, n^{2}$，其中 $k_{I} = 0.8 \\times 10^{-9} \\,\\mathrm{A}$。\n- 迭代位串行乘法器：\n  - 每周期平均活动因子 $\\alpha_{\\mathrm{iter}} = 0.10$。\n  - 每周期等效开关电容 $C_{0} = 20 \\times 10^{-15} \\,\\mathrm{F}$。\n  - 泄漏电流 $I_{\\mathrm{leak,iter}}(n) = I_{0} + I_{1} \\, n$，其中 $I_{0} = 5.0 \\times 10^{-9} \\,\\mathrm{A}$ 且 $I_{1} = 0.05 \\times 10^{-9} \\,\\mathrm{A}$。\n\n仅使用上述基本原理，推导每种设计每次乘法运算的总能耗表达式，并确定使迭代设计的每次乘法运算总能耗等于组合设计总能耗的操作数长度 $n$。将最终数值结果四舍五入至三位有效数字，并将其报告为对应于比特位的纯数字（不要在最终答案框中包含单位）。", "solution": "用户要求对问题陈述进行严格验证，如果问题被认为是有效的，则提供完整的解决方案。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n问题提供了以下数据和模型：\n-   长度为 $n$ 位的操作数。\n-   电源电压：$V = 0.8 \\,\\mathrm{V}$\n-   时钟频率：$f = 1.0 \\times 10^{9} \\,\\mathrm{Hz}$\n-   每周期平均动态能耗模型：$E_{\\mathrm{dyn,cycle}} = \\alpha \\, C_{\\mathrm{eq}} \\, V^{2}$\n-   静态（泄漏）能耗模型：$E_{\\mathrm{leak}} = I_{\\mathrm{leak}} \\, V \\, t$\n\n-   **组合阵列乘法器：**\n    -   执行时间：$1$ 个时钟周期。\n    -   平均活动因子：$\\alpha_{\\mathrm{comb}} = 0.15$\n    -   等效开关电容：$C_{\\mathrm{comb}}(n) = k_{C} \\, n^{2}$，其中 $k_{C} = 0.4 \\times 10^{-15} \\,\\mathrm{F}$。\n    -   泄漏电流：$I_{\\mathrm{leak,comb}}(n) = k_{I} \\, n^{2}$，其中 $k_{I} = 0.8 \\times 10^{-9} \\,\\mathrm{A}$。\n\n-   **迭代位串行乘法器：**\n    -   执行时间：$n$ 个时钟周期。\n    -   每周期平均活动因子：$\\alpha_{\\mathrm{iter}} = 0.10$\n    -   每周期等效开关电容：$C_{0} = 20 \\times 10^{-15} \\,\\mathrm{F}$。\n    -   泄漏电流：$I_{\\mathrm{leak,iter}}(n) = I_{0} + I_{1} \\, n$，其中 $I_{0} = 5.0 \\times 10^{-9} \\,\\mathrm{A}$ 且 $I_{1} = 0.05 \\times 10^{-9} \\,\\mathrm{A}$。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n根据指定标准对问题进行评估：\n-   **科学依据**：所提出的动态和静态能耗模型是数字 VLSI 电路分析中使用的标准一阶近似。阵列乘法器的电容（$C \\propto n^2$）和泄漏（$I_{\\mathrm{leak}} \\propto n^2$）的缩放模型正确反映了其面积增长，而迭代设计的线性泄漏模型是一个合理的简化。该问题牢固地植根于计算机组成和数字电子学的原理。\n-   **适定性**：问题是适定的。它要求求解单个变量 $n$ 的值，在该值下两个不同系统的总能耗相等。所有必要的参数和函数依赖关系都已明确给出，从而可以得到一个可解的代数方程。\n-   **客观性**：问题使用精确的技术语言陈述，没有主观性或歧义。\n-   所有其他验证检查均已通过。该问题没有科学缺陷，是可形式化的、完整的，并基于合理的工程模型提出了一个有意义的问题。\n\n**第 3 步：结论与行动**\n\n该问题是**有效的**。将提供完整的解决方案。\n\n### 解题推导\n\n目标是找到操作数长度 $n$，使得组合设计的每次乘法运算总能耗 $E_{\\mathrm{total,comb}}(n)$ 等于迭代设计的总能耗 $E_{\\mathrm{total,iter}}(n)$。\n\n**1. 组合乘法器的总能耗**\n\n总能耗是一次乘法运算的动态能耗和静态（泄漏）能耗之和，该运算需要一个时钟周期。一个时钟周期的持续时间为 $t_{\\mathrm{comb}} = \\frac{1}{f}$。\n\n-   **动态能耗 ($E_{\\mathrm{dyn,comb}}$)：**\n    动态能耗在一个周期内消耗。\n    $$E_{\\mathrm{dyn,comb}}(n) = \\alpha_{\\mathrm{comb}} \\, C_{\\mathrm{comb}}(n) \\, V^{2} = \\alpha_{\\mathrm{comb}} (k_{C} n^{2}) V^{2}$$\n\n-   **泄漏能耗 ($E_{\\mathrm{leak,comb}}$)：**\n    泄漏能耗是泄漏功率乘以执行时间。\n    $$E_{\\mathrm{leak,comb}}(n) = I_{\\mathrm{leak,comb}}(n) \\, V \\, t_{\\mathrm{comb}} = (k_{I} n^{2}) \\, V \\, \\frac{1}{f}$$\n\n-   **总能耗 ($E_{\\mathrm{total,comb}}$)：**\n    $$E_{\\mathrm{total,comb}}(n) = E_{\\mathrm{dyn,comb}}(n) + E_{\\mathrm{leak,comb}}(n) = \\alpha_{\\mathrm{comb}} k_{C} n^{2} V^{2} + \\frac{k_{I} n^{2} V}{f}$$\n    提出公因式 $n^2$：\n    $$E_{\\mathrm{total,comb}}(n) = \\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} \\right) n^{2}$$\n\n**2. 迭代乘法器的总能耗**\n\n这次乘法运算需要 $n$ 个时钟周期。总持续时间为 $t_{\\mathrm{iter}} = n \\times \\frac{1}{f} = \\frac{n}{f}$。\n\n-   **动态能耗 ($E_{\\mathrm{dyn,iter}}$)：**\n    每个周期的动态能耗是恒定的，$E_{\\mathrm{dyn,cycle,iter}} = \\alpha_{\\mathrm{iter}} C_{0} V^{2}$。$n$ 个周期内的总动态能耗为：\n    $$E_{\\mathrm{dyn,iter}}(n) = n \\times (\\alpha_{\\mathrm{iter}} C_{0} V^{2})$$\n\n-   **泄漏能耗 ($E_{\\mathrm{leak,iter}}$)：**\n    泄漏能耗是泄漏功率乘以总执行时间。\n    $$E_{\\mathrm{leak,iter}}(n) = I_{\\mathrm{leak,iter}}(n) \\, V \\, t_{\\mathrm{iter}} = (I_{0} + I_{1} n) \\, V \\, \\frac{n}{f} = \\frac{I_{0} V n}{f} + \\frac{I_{1} V n^{2}}{f}$$\n\n-   **总能耗 ($E_{\\mathrm{total,iter}}$)：**\n    $$E_{\\mathrm{total,iter}}(n) = E_{\\mathrm{dyn,iter}}(n) + E_{\\mathrm{leak,iter}}(n) = n \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V n}{f} + \\frac{I_{1} V n^{2}}{f}$$\n    按 $n$ 的幂次对项进行分组：\n    $$E_{\\mathrm{total,iter}}(n) = \\left( \\frac{I_{1} V}{f} \\right) n^{2} + \\left( \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f} \\right) n$$\n\n**3. 令能耗相等并求解 n**\n\n我们令 $E_{\\mathrm{total,comb}}(n) = E_{\\mathrm{total,iter}}(n)$：\n$$\\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} \\right) n^{2} = \\left( \\frac{I_{1} V}{f} \\right) n^{2} + \\left( \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f} \\right) n$$\n对于非平凡的乘法器，$n \\neq 0$，因此我们可以将等式两边同时除以 $n$：\n$$\\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} \\right) n = \\left( \\frac{I_{1} V}{f} \\right) n + \\left( \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f} \\right)$$\n重新整理以求解 $n$：\n$$\\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} - \\frac{I_{1} V}{f} \\right) n = \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f}$$\n$$n = \\frac{\\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f}}{\\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{(k_{I} - I_{1}) V}{f}}$$\n为了简化，我们可以将分子和分母同乘以 $\\frac{f}{V}$：\n$$n = \\frac{\\alpha_{\\mathrm{iter}} C_{0} V f + I_{0}}{\\alpha_{\\mathrm{comb}} k_{C} V f + k_{I} - I_{1}}$$\n\n**4. 数值计算**\n\n将给定值代入 $n$ 的表达式中：\n-   $V = 0.8$\n-   $f = 1.0 \\times 10^{9}$\n-   $\\alpha_{\\mathrm{comb}} = 0.15$\n-   $k_{C} = 0.4 \\times 10^{-15}$\n-   $k_{I} = 0.8 \\times 10^{-9}$\n-   $\\alpha_{\\mathrm{iter}} = 0.10$\n-   $C_{0} = 20 \\times 10^{-15}$\n-   $I_{0} = 5.0 \\times 10^{-9}$\n-   $I_{1} = 0.05 \\times 10^{-9}$\n\n分子：\n$$ \\alpha_{\\mathrm{iter}} C_{0} V f + I_{0} = (0.10)(20 \\times 10^{-15})(0.8)(1.0 \\times 10^{9}) + (5.0 \\times 10^{-9}) $$\n$$ = 1.6 \\times 10^{-6} + 5.0 \\times 10^{-9} = 1.6 \\times 10^{-6} + 0.005 \\times 10^{-6} = 1.605 \\times 10^{-6} $$\n\n分母：\n$$ \\alpha_{\\mathrm{comb}} k_{C} V f + k_{I} - I_{1} = (0.15)(0.4 \\times 10^{-15})(0.8)(1.0 \\times 10^{9}) + (0.8 \\times 10^{-9}) - (0.05 \\times 10^{-9}) $$\n$$ = 4.8 \\times 10^{-8} + 0.75 \\times 10^{-9} = 4.8 \\times 10^{-8} + 0.075 \\times 10^{-8} = 4.875 \\times 10^{-8} $$\n\n$n$ 的计算：\n$$ n = \\frac{1.605 \\times 10^{-6}}{4.875 \\times 10^{-8}} = \\frac{160.5 \\times 10^{-8}}{4.875 \\times 10^{-8}} \\approx 32.9230769... $$\n\n四舍五入到三位有效数字，结果为 $32.9$。", "answer": "$$ \\boxed{32.9} $$", "id": "3638046"}, {"introduction": "动态功耗不仅取决于电路的规模，还深刻地受到流经电路的数据模式的影响。本练习将深入探讨微架构层面，通过比较两种不同的16位乘法器实现（阵列乘法器与布斯编码乘法器），来量化这种数据依赖性[@problem_id:3638068]。你将使用概率模型来估算不同工作负载下的“活动因子” $\\alpha$，从而揭示精巧的算法设计（如布斯编码）如何通过减少开关活动来降低功耗。", "problem": "一个处理器数据通路必须支持在互补金属氧化物半导体 (CMOS) 中进行带符号的 $N$ 位乘法。对于 $N = 16$ 的情况，正在考虑两种微架构选项：\n- 一种常规的 $16 \\times 16$ 阵列乘法器，它形成所有简单的部分积，并使用一个进位保留加法器 (CSA) 阵列和一个随后的进位传播加法器 (CPA) 对其进行规约，以及\n- 一种基-$4$ Booth 重编码乘法器，它将部分积的行数减少大约 $2$ 倍，并使用多路复用的部分积生成。\n\n设计团队希望在真实的工作负载混合下比较预期的动态功耗。假设以下基本和建模假设：\n- 在有效电容 $C$ 上的每个 $0 \\rightarrow 1$ 逻辑电平充电事件从电源汲取能量 $E = \\frac{1}{2} C V^{2}$。在具有独立输入的周期内，某个节点的逻辑值在任何周期内都是一个 $\\Pr\\{1\\} = p$ 的伯努利随机变量，该节点发生 $0 \\rightarrow 1$ 事件的概率为 $\\alpha(p) = (1-p)p$。\n- 对于一个具有三个独立伯努利输入（其“1”概率均为 $p$）的一位全加器，其输出端的“1”概率为 $p_{\\text{sum}}(p) = 3p - 6p^{2} + 4p^{3}$ 和 $p_{\\text{car}}(p) = 3p^{2} - 2p^{3}$。使用 $\\alpha_{\\text{sum}}(p) = \\alpha(p_{\\text{sum}}(p))$ 和 $\\alpha_{\\text{car}}(p) = \\alpha(p_{\\text{car}}(p))$。\n- 将跨周期的连续操作数对视为独立的。忽略空间相关性，并将每个 CSA 全加器的输入建模为独立的，其“1”概率等于该工作负载下部分积位的“1”概率。对于 CPA，将其每位的有效 $0 \\rightarrow 1$ 翻转概率近似为 $\\alpha_{\\text{CPA}} = 0.25$，且与工作负载无关。假设两种架构的静态（漏电）功耗相同，在比较中可以忽略。\n\n架构和电路级参数如下：\n- 电源电压 $V = 0.9$ $\\mathrm{V}$，时钟频率 $f = 1.0 \\times 10^{9}$ $\\mathrm{Hz}$。\n- 阵列乘法器：\n  - 部分积生成使用 $16 \\times 16 = 256$ 个独立的单位 AND 节点，每个节点的每位有效开关电容为 $C_{\\text{pp}} = 1.0 \\times 10^{-15}$ $\\mathrm{F}$。\n  - CSA 规约被建模为 $(R-2)$ 层，每层有 $16$ 个一位全加器，其中 $R = 16$ 是部分积的行数。因此总共有 $224$ 个全加器单元。每个全加器单元的和输出与进位输出的有效电容分别为 $C_{\\text{sum}} = 1.5 \\times 10^{-15}$ $\\mathrm{F}$ 和 $C_{\\text{car}} = 1.5 \\times 10^{-15}$ $\\mathrm{F}$。\n  - 最终的 CPA 宽度为 $32$ 位，每位的有效开关电容为 $C_{\\text{CPA}} = 3.0 \\times 10^{-15}$ $\\mathrm{F}$，该值包含了其内部节点和输出。\n- 基-$4$ Booth 乘法器：\n  - 有效部分积行数为 $R_{B} = 9$。将部分积生成建模为 $R_{B} \\times 16 = 144$ 个多路复用位节点，每个节点的有效开关电容为 $C_{\\text{pp,B}} = C_{\\text{pp}} + C_{\\text{mux}}$，其中 $C_{\\text{mux}} = 1.0 \\times 10^{-15}$ $\\mathrm{F}$。\n  - CSA 规约使用 $(R_{B} - 2) = 7$ 层，每层有 $16$ 个全加器，即 $112$ 个全加器单元，其 $C_{\\text{sum}}$ 和 $C_{\\text{car}}$ 与上述相同。\n  - 最终的 CPA 与阵列乘法器情况相同（$32$ 位，电容为 $C_{\\text{CPA}}$）。\n- 工作负载：\n  - 随机情况：两个操作数都是独立同分布的，每位的“1”概率为 $p_{A} = p_{B} = 0.5$。将任何简单部分积位的“1”概率建模为 $p_{\\text{pp}} = p_{A} p_{B}$，并且对于 Booth 情况，为进行估算，假设生成的部分积行中的位“1”概率等于简单部分积模型。\n  - 结构化情况：一个操作数保持每位“1”概率为 $p_{A} = 0.5$，另一个是稀疏的，每位“1”概率为 $p_{B} = r$，其中 $r = 0.1$，且位之间独立。使用 $p_{\\text{pp}} = p_{A} p_{B}$，并且对 Booth 情况使用与上述相同的估算。\n- 混合：比例为 $q = 0.6$ 的周期是随机情况，比例为 $(1-q)$ 的周期是结构化情况。\n\n一个实现的预期动态功耗计算方法为：对所有独立节点，将其有效开关电容与 $0 \\rightarrow 1$ 翻转概率的乘积求和，然后乘以 $V^{2}$ 和 $f$。\n\n在给定的建模假设下，计算在混合工作负载下平均的 Booth 乘法器与阵列乘法器的预期动态功耗之比，即 $\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}}$。将你的答案表示为一个无量纲数，并将最终结果四舍五入到四位有效数字。", "solution": "目标是计算基-$4$ Booth 乘法器与常规阵列乘法器的预期动态功耗之比，$\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}}$。一个 CMOS 电路的动态功耗由对节点电容充电和放电所消耗的功率之和给出。对于一个具有多个节点的电路，总动态功耗 $P$ 可以表示为 $P = f V^2 \\sum_i C_i \\alpha_i$，其中 $f$ 是时钟频率，$V$ 是电源电压，$C_i$ 是节点 $i$ 的电容，$\\alpha_i$ 是节点 $i$ 的活动因子（$0 \\rightarrow 1$ 翻转的概率）。\n\n项 $\\sum_i C_i \\alpha_i$ 是电路的总有效开关电容，我们将其表示为 $C'$。由于两种架构的频率 $f$ 和电压 $V$ 相同，它们的功耗之比等于它们在工作负载混合下平均的总有效开关电容之比：\n$$\n\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}} = \\frac{f V^2 C'_{\\text{Booth, avg}}}{f V^2 C'_{\\text{Array, avg}}} = \\frac{C'_{\\text{Booth, avg}}}{C'_{\\text{Array, avg}}}\n$$\n每种架构的总有效开关电容 $C'$ 是其三个主要组成部分贡献的总和：部分积 (PP) 生成、进位保留加法器 (CSA) 阵列和最终的进位传播加法器 (CPA)。\n$$\nC' = C'_{\\text{PP}} + C'_{\\text{CSA}} + C'_{\\text{CPA}}\n$$\n问题指定了一个工作负载混合：比例为 $q=0.6$ 的周期是“随机”的，比例为 $1-q=0.4$ 的周期是“结构化”的。平均有效开关电容是加权平均值：\n$$\nC'_{\\text{avg}} = q \\cdot C'_{\\text{rand}} + (1-q) \\cdot C'_{\\text{struct}}\n$$\n我们必须首先计算每个工作负载的活动因子。对于一个“1”概率为 $p$ 的节点，其活动因子 $\\alpha(p)$ 为 $\\alpha(p) = p(1-p)$。\n\n**1. 工作负载参数和活动因子计算**\n\n**随机工作负载：**\n输入操作数位的“1”概率为 $p_A = 0.5$ 和 $p_B = 0.5$。一个简单部分积位的“1”概率是 $p_{\\text{pp,rand}} = p_A p_B = 0.5 \\times 0.5 = 0.25$。\n- 部分积节点活动：$\\alpha_{\\text{pp,rand}} = p_{\\text{pp,rand}}(1-p_{\\text{pp,rand}}) = 0.25(1-0.25) = 0.1875$。\n- CSA 全加器 (FA) 节点活动 (对于 $p = 0.25$)：\n  - 和输出“1”概率：$p_{\\text{sum}}(0.25) = 3(0.25) - 6(0.25)^2 + 4(0.25)^3 = 0.75 - 0.375 + 0.0625 = 0.4375$。\n  - 和活动：$\\alpha_{\\text{sum,rand}} = 0.4375(1-0.4375) = 0.24609375$。\n  - 进位输出“1”概率：$p_{\\text{car}}(0.25) = 3(0.25)^2 - 2(0.25)^3 = 0.1875 - 0.03125 = 0.15625$。\n  - 进位活动：$\\alpha_{\\text{car,rand}} = 0.15625(1-0.15625) = 0.1318359375$。\n\n**结构化工作负载：**\n“1”概率为 $p_A = 0.5$ 和 $p_B = 0.1$。一个部分积位的“1”概率是 $p_{\\text{pp,struct}} = p_A p_B = 0.5 \\times 0.1 = 0.05$。\n- 部分积节点活动：$\\alpha_{\\text{pp,struct}} = 0.05(1-0.05) = 0.0475$。\n- CSA FA 节点活动 (对于 $p = 0.05$)：\n  - 和输出“1”概率：$p_{\\text{sum}}(0.05) = 3(0.05) - 6(0.05)^2 + 4(0.05)^3 = 0.15 - 0.015 + 0.0005 = 0.1355$。\n  - 和活动：$\\alpha_{\\text{sum,struct}} = 0.1355(1-0.1355) = 0.11712475$。\n  - 进位输出“1”概率：$p_{\\text{car}}(0.05) = 3(0.05)^2 - 2(0.05)^3 = 0.0075 - 0.00025 = 0.00725$。\n  - 进位活动：$\\alpha_{\\text{car,struct}} = 0.00725(1-0.00725) = 0.0071971875$。\n\n**2. 有效开关电容计算**\n\n首先，我们计算每个工作负载下单个 FA 单元的开关电容。\n$C'_{\\text{FA}}(p) = C_{\\text{sum}}\\alpha_{\\text{sum}}(p) + C_{\\text{car}}\\alpha_{\\text{car}}(p)$。已知 $C_{\\text{sum}} = C_{\\text{car}} = 1.5 \\times 10^{-15} \\, \\mathrm{F}$：\n- 随机情况：$C'_{\\text{FA,rand}} = (1.5 \\times 10^{-15})(\\alpha_{\\text{sum,rand}} + \\alpha_{\\text{car,rand}}) = (1.5 \\times 10^{-15})(0.24609375 + 0.1318359375) = 0.56689453125 \\times 10^{-15} \\, \\mathrm{F}$。\n- 结构化情况：$C'_{\\text{FA,struct}} = (1.5 \\times 10^{-15})(\\alpha_{\\text{sum,struct}} + \\alpha_{\\text{car,struct}}) = (1.5 \\times 10^{-15})(0.11712475 + 0.0071971875) = 0.18648290625 \\times 10^{-15} \\, \\mathrm{F}$。\n\nCPA 的贡献在所有情况下都是恒定的：\n$C'_{\\text{CPA}} = N_{\\text{CPA}} C_{\\text{CPA}} \\alpha_{\\text{CPA}} = 32 \\times (3.0 \\times 10^{-15} \\, \\mathrm{F}) \\times 0.25 = 24 \\times 10^{-15} \\, \\mathrm{F}$。\n\n现在我们为每种架构和工作负载计算总的 $C'$。\n\n**阵列乘法器：**\n$N_{\\text{pp,A}} = 256$, $C_{\\text{pp}} = 1.0 \\times 10^{-15} \\, \\mathrm{F}$, $N_{\\text{FA,A}} = 224$。\n- 随机工作负载：\n  $C'_{\\text{Array,rand}} = N_{\\text{pp,A}} C_{\\text{pp}} \\alpha_{\\text{pp,rand}} + N_{\\text{FA,A}} C'_{\\text{FA,rand}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Array,rand}} = [256 \\times (1.0 \\times 10^{-15}) \\times 0.1875] + [224 \\times (0.56689453125 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Array,rand}} = [48 + 126.984375 + 24] \\times 10^{-15} = 198.984375 \\times 10^{-15} \\, \\mathrm{F}$。\n- 结构化工作负载：\n  $C'_{\\text{Array,struct}} = N_{\\text{pp,A}} C_{\\text{pp}} \\alpha_{\\text{pp,struct}} + N_{\\text{FA,A}} C'_{\\text{FA,struct}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Array,struct}} = [256 \\times (1.0 \\times 10^{-15}) \\times 0.0475] + [224 \\times (0.18648290625 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Array,struct}} = [12.16 + 41.772171 + 24] \\times 10^{-15} = 77.932171 \\times 10^{-15} \\, \\mathrm{F}$。\n\n**基-4 Booth 乘法器：**\n$N_{\\text{pp,B}} = 144$, $C_{\\text{pp,B}} = C_{\\text{pp}} + C_{\\text{mux}} = 2.0 \\times 10^{-15} \\, \\mathrm{F}$, $N_{\\text{FA,B}} = 112$。\n- 随机工作负载：\n  $C'_{\\text{Booth,rand}} = N_{\\text{pp,B}} C_{\\text{pp,B}} \\alpha_{\\text{pp,rand}} + N_{\\text{FA,B}} C'_{\\text{FA,rand}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Booth,rand}} = [144 \\times (2.0 \\times 10^{-15}) \\times 0.1875] + [112 \\times (0.56689453125 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Booth,rand}} = [54 + 63.4921875 + 24] \\times 10^{-15} = 141.4921875 \\times 10^{-15} \\, \\mathrm{F}$。\n- 结构化工作负载：\n  $C'_{\\text{Booth,struct}} = N_{\\text{pp,B}} C_{\\text{pp,B}} \\alpha_{\\text{pp,struct}} + N_{\\text{FA,B}} C'_{\\text{FA,struct}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Booth,struct}} = [144 \\times (2.0 \\times 10^{-15}) \\times 0.0475] + [112 \\times (0.18648290625 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Booth,struct}} = [13.68 + 20.8860855 + 24] \\times 10^{-15} = 58.5660855 \\times 10^{-15} \\, \\mathrm{F}$。\n\n**3. 混合平均计算和最终比率**\n混合工作负载由 $q=0.6$ 的随机周期和 $1-q=0.4$ 的结构化周期组成。\n- 阵列乘法器的平均值：\n  $C'_{\\text{Array,avg}} = 0.6 \\times C'_{\\text{Array,rand}} + 0.4 \\times C'_{\\text{Array,struct}}$\n  $C'_{\\text{Array,avg}} = (0.6 \\times 198.984375 + 0.4 \\times 77.932171) \\times 10^{-15}$\n  $C'_{\\text{Array,avg}} = (119.390625 + 31.1728684) \\times 10^{-15} = 150.5634934 \\times 10^{-15} \\, \\mathrm{F}$。\n- Booth 乘法器的平均值：\n  $C'_{\\text{Booth,avg}} = 0.6 \\times C'_{\\text{Booth,rand}} + 0.4 \\times C'_{\\text{Booth,struct}}$\n  $C'_{\\text{Booth,avg}} = (0.6 \\times 141.4921875 + 0.4 \\times 58.5660855) \\times 10^{-15}$\n  $C'_{\\text{Booth,avg}} = (84.8953125 + 23.4264342) \\times 10^{-15} = 108.3217467 \\times 10^{-15} \\, \\mathrm{F}$。\n\n最后，所求比率为：\n$$\n\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}} = \\frac{C'_{\\text{Booth, avg}}}{C'_{\\text{Array, avg}}} = \\frac{108.3217467 \\times 10^{-15}}{150.5634934 \\times 10^{-15}} \\approx 0.7194358\n$$\n四舍五入到四位有效数字，比率为 $0.7194$。", "answer": "$$\\boxed{0.7194}$$", "id": "3638068"}, {"introduction": "现代处理器通过动态电压与频率调整（DVFS）技术来应对变化的计算需求，以实现能效最大化。这个练习将场景扩展到系统层面，模拟一个在计算密集型和内存密集型阶段之间切换的工作负载[@problem_id:3638008]。你的任务是制定一个最优的DVFS调度策略，通过为每个阶段选择最佳的工作点来最小化总能耗，这需要你在动态功耗节省和因执行时间延长而增加的静态能量泄漏之间找到最佳平衡。", "problem": "一个处理器支持一组离散的动态电压和频率缩放 (DVFS) 操作点。对于每个操作点，都有一个以赫兹为单位的时钟频率、一个以伏特为单位的电源电压以及一个以瓦特为单位的测得的静态（泄漏）功率。一个工作负载被分段为多个阶段。在每个阶段中，必须执行固定数量的处理器周期，并且还有一个内存停顿分量，其延迟不随处理器频率而变化。假设以下基本事实和定义：\n\n- 单个逻辑转换的能量为 $E_{\\text{tr}} = \\tfrac{1}{2} C V^2$，其中 $C$ 是以法拉为单位的电容，$V$ 是以伏特为单位的电压。\n- 如果一个阶段需要 $N$ 个时钟周期，并表现出每周期有效开关电容 $C_{\\text{eff}}$（单位：法拉/周期），则其在电压 $V$ 下的动态能耗为 $E_{\\text{dyn}} = N \\, C_{\\text{eff}} \\, V^2$。\n- 对于一个需要 $N$ 个周期且内存停顿时间为 $S$ 秒的阶段，以频率 $f$（单位：赫兹）运行时，执行时间为 $T = \\dfrac{N}{f} + S$。\n- 该阶段在静态功率为 $P_{\\text{leak}}$（单位：瓦特）的 DVFS 点上的静态（泄漏）能耗为 $E_{\\text{leak}} = P_{\\text{leak}} \\, T$。\n- 在两个连续阶段之间更改 DVFS 点时，会产生一个恒定的 DVFS 转换开销能量 $E_{\\text{sw}}$（单位：焦耳/次）。\n\n给定一系列阶段和一组 DVFS 点，为每个阶段选择一个 DVFS 点以最小化总能耗。总能耗定义为所有阶段的 $E_{\\text{dyn}} + E_{\\text{leak}}$ 之和，加上相邻阶段之间每次 DVFS 更改的 $E_{\\text{sw}}$。初始阶段不产生转换成本。\n\n您的程序必须为以下每个测试用例计算最小总能耗，并将结果打印为单行，内容是方括号内以逗号分隔的浮点数列表。每个数字都必须以焦耳为单位，并精确到小数点后六位。\n\n测试用例定义：\n\n- 测试用例 $1$：\n  - DVFS 点：\n    - $\\{ f = 1.2 \\times 10^9 \\ \\text{Hz}, \\ V = 0.8 \\ \\text{V}, \\ P_{\\text{leak}} = 5 \\ \\text{W} \\}$\n    - $\\{ f = 2.0 \\times 10^9 \\ \\text{Hz}, \\ V = 1.0 \\ \\text{V}, \\ P_{\\text{leak}} = 8 \\ \\text{W} \\}$\n    - $\\{ f = 2.8 \\times 10^9 \\ \\text{Hz}, \\ V = 1.2 \\ \\text{V}, \\ P_{\\text{leak}} = 13 \\ \\text{W} \\}$\n  - 阶段 $(N, S, C_{\\text{eff}})$：\n    - $\\{ N = 2.0 \\times 10^9, \\ S = 0.1 \\ \\text{s}, \\ C_{\\text{eff}} = 5.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n    - $\\{ N = 0.5 \\times 10^9, \\ S = 0.8 \\ \\text{s}, \\ C_{\\text{eff}} = 3.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n    - $\\{ N = 1.5 \\times 10^9, \\ S = 0.05 \\ \\text{s}, \\ C_{\\text{eff}} = 6.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n  - DVFS 转换开销： $E_{\\text{sw}} = 0.2 \\ \\text{J}$\n\n- 测试用例 $2$：\n  - DVFS 点：与测试用例 1 相同。\n  - 阶段 $(N, S, C_{\\text{eff}})$：\n    - $\\{ N = 0.3 \\times 10^9, \\ S = 2.0 \\ \\text{s}, \\ C_{\\text{eff}} = 2.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n    - $\\{ N = 0.2 \\times 10^9, \\ S = 1.5 \\ \\text{s}, \\ C_{\\text{eff}} = 1.5 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n  - DVFS 转换开销： $E_{\\text{sw}} = 0.2 \\ \\text{J}$\n\n- 测试用例 $3$：\n  - DVFS 点：与测试用例 1 相同。\n  - 阶段 $(N, S, C_{\\text{eff}})$：\n    - $\\{ N = 3.0 \\times 10^9, \\ S = 0.02 \\ \\text{s}, \\ C_{\\text{eff}} = 6.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n    - $\\{ N = 2.0 \\times 10^9, \\ S = 0.01 \\ \\text{s}, \\ C_{\\text{eff}} = 5.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n    - $\\{ N = 1.0 \\times 10^9, \\ S = 0.01 \\ \\text{s}, \\ C_{\\text{eff}} = 4.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n  - DVFS 转换开销： $E_{\\text{sw}} = 0.2 \\ \\text{J}$\n\n- 测试用例 $4$：\n  - DVFS 点：\n    - $\\{ f = 1.0 \\times 10^9 \\ \\text{Hz}, \\ V = 0.8 \\ \\text{V}, \\ P_{\\text{leak}} = 5.0 \\ \\text{W} \\}$\n    - $\\{ f = 2.0 \\times 10^9 \\ \\text{Hz}, \\ V = 0.95 \\ \\text{V}, \\ P_{\\text{leak}} = 7.0 \\ \\text{W} \\}$\n    - $\\{ f = 3.2 \\times 10^9 \\ \\text{Hz}, \\ V = 1.05 \\ \\text{V}, \\ P_{\\text{leak}} = 9.5 \\ \\text{W} \\}$\n  - 阶段 $(N, S, C_{\\text{eff}})$：\n    - $\\{ N = 2.0 \\times 10^9, \\ S = 0.0 \\ \\text{s}, \\ C_{\\text{eff}} = 1.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n    - $\\{ N = 0.5 \\times 10^9, \\ S = 0.0 \\ \\text{s}, \\ C_{\\text{eff}} = 1.0 \\times 10^{-9} \\ \\text{F/cycle} \\}$\n  - DVFS 转换开销： $E_{\\text{sw}} = 0.1 \\ \\text{J}$\n\n要求：\n\n- 实现一个算法，该算法为每个测试用例独立地找到每个阶段的 DVFS 分配，以最小化所有阶段的总能耗之和，包括定义的 DVFS 转换开销。\n- 您的程序不得读取任何输入，必须直接计算给定测试用例的输出。\n- 输出格式：单行，包含方括号内的逗号分隔列表形式的结果，例如 $\\texttt{[1.234000,2.345000,3.456000,4.567000]}$，其中每个数字以焦耳为单位，并四舍五入到小数点后六位。", "solution": "我们从物理开关能耗关系 $E_{\\text{tr}} = \\tfrac{1}{2} C V^2$ 开始，该关系指出，将电容 $C$ 充电或放电至电压 $V$ 所消耗的能量与 $V^2$ 成正比。在一个包含 $N$ 个时钟周期的阶段中，总开关电容可以通过每周期有效开关电容 $C_{\\text{eff}}$ 来建模，从而得到动态能耗\n$$\nE_{\\text{dyn}} = N \\, C_{\\text{eff}} \\, V^2.\n$$\n在开关事件数量固定的情况下，此表达式取决于所选的 DVFS 电压 $V$，但与时钟频率 $f$ 没有直接关系。在频率 $f$ 下该阶段的执行时间包括一个计算分量和一个对 $f$ 不敏感的内存停顿分量。因此，\n$$\nT = \\frac{N}{f} + S,\n$$\n其中 $S$ 是以秒为单位的内存停顿时间。静态（泄漏）功率 $P_{\\text{leak}}$ 随时间持续耗散，贡献的泄漏能耗为\n$$\nE_{\\text{leak}} = P_{\\text{leak}} \\, T = P_{\\text{leak}} \\left( \\frac{N}{f} + S \\right).\n$$\n因此，单个阶段在给定 DVFS 点 $(f, V, P_{\\text{leak}})$ 的总能耗为\n$$\nE_{\\text{phase}}(N, S, C_{\\text{eff}}; f, V, P_{\\text{leak}}) = N \\, C_{\\text{eff}} \\, V^2 + P_{\\text{leak}} \\left( \\frac{N}{f} + S \\right).\n$$\n在一系列阶段中，更改相邻阶段之间的 DVFS 点会产生转换开销能量 $E_{\\text{sw}}$。假设工作负载由索引为 $i \\in \\{0, 1, \\dots, P-1\\}$ 的阶段组成，DVFS 点由索引为 $s \\in \\{0, 1, \\dots, S-1\\}$ 的状态索引。定义每个阶段、每个状态的能耗为\n$$\nE_{i}(s) = N_i \\, C_{\\text{eff},i} \\, V_s^2 + P_{\\text{leak},s} \\left( \\frac{N_i}{f_s} + S_i \\right).\n$$\n优化目标是为每个阶段 $i$ 选择一个状态 $s_i$，以最小化\n$$\nE_{\\text{total}} = \\sum_{i=0}^{P-1} E_{i}(s_i) + \\sum_{i=1}^{P-1} \\left[ s_i \\neq s_{i-1} \\right] E_{\\text{sw}},\n$$\n其中 $[ \\cdot ]$ 是 Iverson 括号，如果其条件为真，则其值为 $1$，否则为 $0$。\n\n一个规范且高效的解决方案是动态规划。设\n$$\n\\text{DP}[i][s] = \\text{当阶段 } i \\text{ 使用状态 } s \\text{ 时，阶段 } 0 \\ldots i \\text{ 的最小总能耗。}\n$$\n初始化：\n$$\n\\text{DP}[0][s] = E_{0}(s), \\quad \\forall s.\n$$\n对于 $i \\ge 1$ 的转移：\n$$\n\\text{DP}[i][s] = E_{i}(s) + \\min_{p \\in \\{0,\\ldots,S-1\\}} \\left( \\text{DP}[i-1][p] + \\Delta(p, s) \\right),\n$$\n其中\n$$\n\\Delta(p, s) = \n\\begin{cases}\n0,  \\text{若 } p = s, \\\\\nE_{\\text{sw}},  \\text{若 } p \\ne s.\n\\end{cases}\n$$\n最终的最小能耗为\n$$\n\\min_{s \\in \\{0,\\ldots,S-1\\}} \\text{DP}[P-1][s].\n$$\n对于每个测试用例，该算法的时间复杂度为 $O(P \\, S^2)$，使用滚动数组的空间复杂度为 $O(S)$，这对于小规模的离散 DVFS 集合是高效的。\n\n我们现在将此模型应用于指定的测试用例。为作说明，考虑测试用例 1 并计算代表性数值：\n\n- 对于阶段 1 $(i = 0)$，在 DVFS 点 $s = 0$ 处，$f = 1.2 \\times 10^9$, $V = 0.8$, $P_{\\text{leak}} = 5$，我们有：\n  - $T = \\dfrac{2.0 \\times 10^9}{1.2 \\times 10^9} + 0.1 = \\dfrac{5}{3} + 0.1 \\approx 1.766666\\ldots \\ \\text{s}$,\n  - $E_{\\text{dyn}} = (2.0 \\times 10^9)(5.0 \\times 10^{-9})(0.8)^2 = 10 \\cdot 0.64 = 6.4 \\ \\text{J}$,\n  - $E_{\\text{leak}} = 5 \\cdot T \\approx 8.833333\\ldots \\ \\text{J}$,\n  - $E_{0}(0) \\approx 15.233333\\ldots \\ \\text{J}$.\n- 对所有阶段和所有 DVFS 点进行类似的计算，可得到 $E_{i}(s)$，然后动态规划程序将它们与转换开销 $E_{\\text{sw}}$ 聚合起来。\n\n对每个测试用例执行此过程，得出以下最小总能耗，均以焦耳为单位，并四舍五入到六位小数：\n\n- 测试用例 $1$：$34.536667$。\n- 测试用例 $2$：$20.159333$。\n- 测试用例 $3$：$45.680000$。\n- 测试用例 $4$：$10.178125$。\n\n随附的程序对测试用例进行编码，使用上述物理关系计算 $E_{i}(s)$，执行动态规划以考虑转换开销，并以指定格式打印所需的列表。", "answer": "[34.536667,20.159333,45.680000,10.178125]", "id": "3638008"}]}