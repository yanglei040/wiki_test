{"hands_on_practices": [{"introduction": "现代处理器通过分支预测等推测执行技术来提升性能，但错误的预测会带来惩罚。这种惩罚不仅体现在浪费的时钟周期上，还直接转化为无效的能量消耗。本练习将引导你量化这种微架构层面的低效率所导致的能量浪费，从而具体理解为何精准的分支预测对构建高性能和高能效的处理器都至关重要。[@problem_id:3666607]", "problem": "一台乱序执行的中央处理器 (CPU) 以 $f_{clk} = 3.2\\ \\text{吉赫兹 (GHz)}$ 的时钟频率执行一个包含 $N = 5.0 \\times 10^{9}$ 条指令的工作负载。在执行的指令中，有 $\\alpha = 0.15$ 的比例是条件分支指令。分支预测器以 $m = 0.08$ 的概率错误预测一个分支。每次错误预测都会导致一次流水线刷新，并产生 $B = 14$ 个恢复周期，在这些周期内没有有效指令提交。在这些恢复周期内，芯片消耗的平均功率为 $P_{avg} = 65\\ \\text{瓦特 (W)}$，并假定在这些周期内该功率近似恒定。请仅使用能量等于功率对时间的积分以及周期时间为 $t_{cycle} = 1 / f_{clk}$ 的第一性原理定义，计算此工作负载因分支预测错误而浪费的总能量。请以焦耳 (J) 为单位表示您的最终能量，并将答案四舍五入到四位有效数字。", "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 问题验证\n\n**第一步：提取已知条件**\n- 指令总数：$N = 5.0 \\times 10^{9}$\n- 时钟频率：$f_{clk} = 3.2\\ \\text{吉赫兹 (GHz)}$\n- 条件分支指令的比例：$\\alpha = 0.15$\n- 分支预测错误概率：$m = 0.08$\n- 预测错误惩罚：$B = 14$ 个恢复周期\n- 恢复周期内的平均功耗：$P_{avg} = 65\\ \\text{瓦特 (W)}$\n- 周期时间的定义：$t_{cycle} = 1 / f_{clk}$\n- 第一性原理：能量等于功率对时间的积分。\n\n**第二步：使用提取的已知条件进行验证**\n对问题的有效性进行评估：\n- **科学依据**：该问题在计算机体系结构和电气工程原理方面有充分的依据。分支预测、流水线刷新、时钟频率、功率和能量等概念是基础性的，并且应用正确。为现代CPU提供的数值是合理且现实的。\n- **定义明确**：问题定义清晰。它提供了计算所要求量——因分支预测错误而浪费的总能量——所需的所有必要参数。可以从已知条件中系统地推导出一个唯一的数值解。\n- **客观性**：问题使用精确、定量和无偏见的语言陈述。没有主观因素。\n- **缺陷检查清单**：该问题没有违反任何无效性标准。它科学合理、可形式化、完整、现实且结构良好。\n\n**第三步：结论与行动**\n该问题被判定为**有效**。将提供一个合理的解决方案。\n\n### 解题过程\n\n目标是计算由分支预测错误引起的流水线恢复期间消耗的总能量 $E_{wasted}$。能量 ($E$)、恒定功率 ($P$) 和持续时间 ($T$) 之间的基本关系由下式给出：\n$$E = P \\times T$$\n在此背景下，功率是恢复周期内消耗的平均功率 $P_{avg}$，时间是所有恢复周期的总持续时间 $T_{wasted}$。\n$$E_{wasted} = P_{avg} \\times T_{wasted}$$\n为了求出 $E_{wasted}$，我们必须首先确定 $T_{wasted}$。总浪费时间是浪费的总时钟周期数与单个时钟周期持续时间 $t_{cycle}$ 的乘积。\n$$T_{wasted} = (\\text{浪费的总周期数}) \\times t_{cycle}$$\n单个周期的持续时间是时钟频率的倒数：\n$$t_{cycle} = \\frac{1}{f_{clk}}$$\n浪费的总周期数是分支预测错误次数与每次预测错误的周期惩罚 $B$ 的乘积。\n$$\\text{浪费的总周期数} = (\\text{预测错误次数}) \\times B$$\n预测错误的次数通过首先计算分支指令的总数，然后应用预测错误概率 $m$ 来得出。分支指令的总数是总执行指令数 $N$ 的一部分，比例为 $\\alpha$。\n$$\\text{分支指令数} = N \\times \\alpha$$\n$$\\text{预测错误次数} = (\\text{分支指令数}) \\times m = (N \\times \\alpha) \\times m$$\n现在，我们可以将这些中间结果代入我们的表达式中。\n浪费的总周期数为：\n$$\\text{浪费的总周期数} = N \\times \\alpha \\times m \\times B$$\n总浪费时间为：\n$$T_{wasted} = (N \\times \\alpha \\times m \\times B) \\times t_{cycle} = \\frac{N \\times \\alpha \\times m \\times B}{f_{clk}}$$\n最后，总浪费能量为：\n$$E_{wasted} = P_{avg} \\times T_{wasted} = P_{avg} \\frac{N \\alpha m B}{f_{clk}}$$\n现在我们将给定的数值代入此表达式。必须确保所有单位都采用国际标准单位制 (SI)。时钟频率 $f_{clk} = 3.2\\ \\text{GHz}$ 必须转换为赫兹 (Hz)，其中 $1\\ \\text{GHz} = 10^9\\ \\text{Hz}$。\n- $N = 5.0 \\times 10^{9}$ (条指令)\n- $\\alpha = 0.15$ (无量纲)\n- $m = 0.08$ (无量纲)\n- $B = 14$ (个周期)\n- $P_{avg} = 65\\ \\text{W}$ (焦耳/秒)\n- $f_{clk} = 3.2 \\times 10^{9}\\ \\text{Hz}$ (周期/秒)\n\n代入这些值：\n$$E_{wasted} = (65\\ \\text{J/s}) \\times \\frac{(5.0 \\times 10^{9}) \\times 0.15 \\times 0.08 \\times 14}{3.2 \\times 10^{9}\\ \\text{s}^{-1}}$$\n分子和分母中的 $10^9$ 因子可以消掉，从而简化计算：\n$$E_{wasted} = 65 \\times \\frac{5.0 \\times 0.15 \\times 0.08 \\times 14}{3.2}\\ \\text{J}$$\n我们来计算分数的值：\n$$5.0 \\times 0.15 = 0.75$$\n$$0.75 \\times 0.08 = 0.06$$\n$$0.06 \\times 14 = 0.84$$\n表达式变为：\n$$E_{wasted} = 65 \\times \\frac{0.84}{3.2}\\ \\text{J}$$\n$$E_{wasted} = 65 \\times 0.2625\\ \\text{J}$$\n$$E_{wasted} = 17.0625\\ \\text{J}$$\n问题要求最终答案四舍五入到四位有效数字。计算值为 $17.0625$。前四位有效数字是 $1$、$7$、$0$ 和 $6$。第五位数字是 $2$，小于 $5$，因此我们通过截断来进行舍入。\n最终结果是 $17.06\\ \\text{J}$。", "answer": "$$\\boxed{17.06}$$", "id": "3666607"}, {"introduction": "动态电压频率调节 (DVFS) 是管理处理器功耗的关键技术，但状态切换本身存在时间和能量开销。因此，并非任何时候切换到低功耗状态都是划算的。本练习将帮助你分析 DVFS 的转换开销，并计算出一个“盈亏平衡点”，即一个计算阶段必须持续多长时间，切换到低功耗状态才真正开始节省能量。[@problem_id:3666624]", "problem": "一款通用微处理器支持动态电压和频率缩放 (DVFS) 技术，允许在两个工作点之间切换：高性能状态和低功耗状态。考虑一个固定时钟时间长度为 $T$ 的单一程序阶段，在此阶段内，系统可以始终保持在高性能状态，也可以切换到低功耗状态并维持至阶段结束。微处理器在任何状态下的总功率是动态功率和泄漏功率之和，其中动态功率建模为 $P_{\\mathrm{dyn}} = C_{\\mathrm{eff}} V^{2} f$，泄漏功率建模为 $P_{\\mathrm{leak}} = V I_{\\mathrm{leak}}$。此处 $C_{\\mathrm{eff}}$ 表示总有效开关电容。\n\n给定以下测量参数：\n- 有效开关电容 $C_{\\mathrm{eff}} = 9 \\times 10^{-9}$ F。\n- 高性能状态电压 $V_{\\mathrm{H}} = 1.10$ V，频率 $f_{\\mathrm{H}} = 3.2 \\times 10^{9}$ Hz，泄漏电流 $I_{\\mathrm{leak,H}} = 12$ A。\n- 低功耗状态电压 $V_{\\mathrm{L}} = 0.80$ V，频率 $f_{\\mathrm{L}} = 1.6 \\times 10^{9}$ Hz，泄漏电流 $I_{\\mathrm{leak,L}} = 5$ A。\n\n状态之间的切换会产生开销：每次 DVFS 转换会额外消耗能量 $E_{\\mathrm{tr}} = 0.30$ J，并耗时 $t_{\\mathrm{tr}} = 2.0 \\times 10^{-3}$ s。假设在阶段边界处切入和切出低功耗状态时，每个阶段有两次转换。同时假设，额外能量 $E_{\\mathrm{tr}}$ 是处理器在转换期间稳定保持低功耗状态本应消耗的能量之外的开销，并且转换所花费的时间会使该阶段内可用于累积低功耗节能的时间总共减少 $2 t_{\\mathrm{tr}}$。\n\n从动态功率、泄漏功率以及能量是功率对时间积分的定义出发，推导出最小阶段长度 $t^{*}$，使得在该阶段切换到低功耗状态所产生的净节能相对于整个阶段保持在高性能状态为非负。以毫秒为单位表示 $t^{*}$，并将您的最终答案四舍五入到四位有效数字。", "solution": "问题要求解最小阶段长度，我们将其表示为 $T$，使得在该阶段内切换到低功耗状态相比保持在高性能状态能提供非负的节能。这个最小时间记为 $t^{*}$。\n\n首先，我们建立功耗模型。总功率 $P$ 是动态功率 $P_{\\mathrm{dyn}}$ 和泄漏功率 $P_{\\mathrm{leak}}$ 的和。\n给定的模型是：\n$P_{\\mathrm{dyn}} = C_{\\mathrm{eff}} V^{2} f$\n$P_{\\mathrm{leak}} = V I_{\\mathrm{leak}}$\n所以，总功率为 $P = C_{\\mathrm{eff}} V^{2} f + V I_{\\mathrm{leak}}$。\n\n让我们使用提供的参数计算高性能状态 ($P_{\\mathrm{H}}$) 和低功耗状态 ($P_{\\mathrm{L}}$) 的总功率。\n\n参数如下：\n有效开关电容 $C_{\\mathrm{eff}} = 9 \\times 10^{-9}$ F。\n高性能状态：$V_{\\mathrm{H}} = 1.10$ V，$f_{\\mathrm{H}} = 3.2 \\times 10^{9}$ Hz，$I_{\\mathrm{leak,H}} = 12$ A。\n低功耗状态：$V_{\\mathrm{L}} = 0.80$ V，$f_{\\mathrm{L}} = 1.6 \\times 10^{9}$ Hz，$I_{\\mathrm{leak,L}} = 5$ A。\n转换开销：能量 $E_{\\mathrm{tr}} = 0.30$ J 和时间 $t_{\\mathrm{tr}} = 2.0 \\times 10^{-3}$ s。\n\n对于高性能状态：\n$P_{\\mathrm{dyn,H}} = C_{\\mathrm{eff}} V_{\\mathrm{H}}^{2} f_{\\mathrm{H}} = (9 \\times 10^{-9} \\, \\text{F}) \\times (1.10 \\, \\text{V})^{2} \\times (3.2 \\times 10^{9} \\, \\text{Hz}) = 9 \\times 1.21 \\times 3.2 \\, \\text{W} = 34.848$ W。\n$P_{\\mathrm{leak,H}} = V_{\\mathrm{H}} I_{\\mathrm{leak,H}} = (1.10 \\, \\text{V}) \\times (12 \\, \\text{A}) = 13.2$ W。\n$P_{\\mathrm{H}} = P_{\\mathrm{dyn,H}} + P_{\\mathrm{leak,H}} = 34.848 \\, \\text{W} + 13.2 \\, \\text{W} = 48.048$ W。\n\n对于低功耗状态：\n$P_{\\mathrm{dyn,L}} = C_{\\mathrm{eff}} V_{\\mathrm{L}}^{2} f_{\\mathrm{L}} = (9 \\times 10^{-9} \\, \\text{F}) \\times (0.80 \\, \\text{V})^{2} \\times (1.6 \\times 10^{9} \\, \\text{Hz}) = 9 \\times 0.64 \\times 1.6 \\, \\text{W} = 9.216$ W。\n$P_{\\mathrm{leak,L}} = V_{\\mathrm{L}} I_{\\mathrm{leak,L}} = (0.80 \\, \\text{V}) \\times (5 \\, \\text{A}) = 4.0$ W。\n$P_{\\mathrm{L}} = P_{\\mathrm{dyn,L}} + P_{\\mathrm{leak,L}} = 9.216 \\, \\text{W} + 4.0 \\, \\text{W} = 13.216$ W。\n\n现在我们为持续时间为 $T$ 的阶段定义两种场景下的总消耗能量。\n\n场景1：微处理器在整个持续时间 $T$ 内保持在高性能状态。\n总消耗能量 $E_{\\mathrm{H}}$ 是恒定功率 $P_{\\mathrm{H}}$ 和持续时间 $T$ 的乘积：\n$$E_{\\mathrm{H}} = P_{\\mathrm{H}} T$$\n\n场景2：微处理器切换到低功耗状态。\n这个场景涉及两次转换（例如，在阶段开始时从高到低，在结束时从低到高）。\n这两次转换的总时间是 $2 t_{\\mathrm{tr}}$。\n问题陈述，这个转换时间减少了可用于低功耗操作的时间。因此，在低功耗状态下花费的时间是 $T - 2 t_{\\mathrm{tr}}$。\n在此场景下，总能量 $E_{\\mathrm{L,total}}$ 是三个部分的总和：\n1.  在稳定低功耗操作期间消耗的能量：$P_{\\mathrm{L}} (T - 2t_{\\mathrm{tr}})$。\n2.  在转换期间消耗的能量。在没有其他信息的情况下，一个标准的保守假设是处理器在转换期间以较高的功率水平 $P_{\\mathrm{H}}$ 消耗能量。因此，能量为 $P_{\\mathrm{H}} (2t_{\\mathrm{tr}})$。\n3.  两次转换的额外显式能量开销，即 $2 E_{\\mathrm{tr}}$。\n\n结合这些部分，总能量为：\n$$E_{\\mathrm{L,total}} = P_{\\mathrm{L}}(T - 2t_{\\mathrm{tr}}) + P_{\\mathrm{H}}(2t_{\\mathrm{tr}}) + 2E_{\\mathrm{tr}}$$\n\n盈亏平衡点出现在节能为零时，即两种场景下消耗的能量相等。为了获得非负节能，我们必须有 $E_{\\mathrm{H}} \\geq E_{\\mathrm{L,total}}$。最小时间 $t^{*}$ 对应于等式 $E_{\\mathrm{H}} = E_{\\mathrm{L,total}}$。\n\n$$P_{\\mathrm{H}} T = P_{\\mathrm{L}}(T - 2t_{\\mathrm{tr}}) + P_{\\mathrm{H}}(2t_{\\mathrm{tr}}) + 2E_{\\mathrm{tr}}$$\n\n我们需要解这个关于 $T$ 的方程。\n$$P_{\\mathrm{H}} T = P_{\\mathrm{L}} T - 2P_{\\mathrm{L}}t_{\\mathrm{tr}} + 2P_{\\mathrm{H}}t_{\\mathrm{tr}} + 2E_{\\mathrm{tr}}$$\n重新排列各项以分离出 $T$：\n$$P_{\\mathrm{H}} T - P_{\\mathrm{L}} T = 2P_{\\mathrm{H}}t_{\\mathrm{tr}} - 2P_{\\mathrm{L}}t_{\\mathrm{tr}} + 2E_{\\mathrm{tr}}$$\n$$T(P_{\\mathrm{H}} - P_{\\mathrm{L}}) = 2t_{\\mathrm{tr}}(P_{\\mathrm{H}} - P_{\\mathrm{L}}) + 2E_{\\mathrm{tr}}$$\n功率差为 $P_{\\mathrm{H}} - P_{\\mathrm{L}} = 48.048 \\, \\text{W} - 13.216 \\, \\text{W} = 34.832$ W。由于这是正数，我们可以用它来除：\n$$T = \\frac{2t_{\\mathrm{tr}}(P_{\\mathrm{H}} - P_{\\mathrm{L}})}{P_{\\mathrm{H}} - P_{\\mathrm{L}}} + \\frac{2E_{\\mathrm{tr}}}{P_{\\mathrm{H}} - P_{\\mathrm{L}}}$$\n$$t^{*} = T = 2t_{\\mathrm{tr}} + \\frac{2E_{\\mathrm{tr}}}{P_{\\mathrm{H}} - P_{\\mathrm{L}}}$$\n最小时间 $t^{*}$ 的这个表达式具有物理意义。它是因转换而损失的时间 ($2t_{\\mathrm{tr}}$) 与通过在降低的功率水平下运行来分摊转换的固定能量成本 ($2E_{\\mathrm{tr}}$) 所需时间的总和。\n\n现在，我们代入数值：\n$t_{\\mathrm{tr}} = 2.0 \\times 10^{-3}$ s\n$E_{\\mathrm{tr}} = 0.30$ J\n$P_{\\mathrm{H}} - P_{\\mathrm{L}} = 34.832$ W\n\n$$t^{*} = 2 \\times (2.0 \\times 10^{-3} \\, \\text{s}) + \\frac{2 \\times 0.30 \\, \\text{J}}{34.832 \\, \\text{W}}$$\n$$t^{*} = 4.0 \\times 10^{-3} \\, \\text{s} + \\frac{0.60}{34.832} \\, \\text{s}$$\n$$t^{*} = 0.004 \\, \\text{s} + 0.017225539... \\, \\text{s}$$\n$$t^{*} = 0.021225539... \\, \\text{s}$$\n\n问题要求答案以毫秒为单位，并四舍五入到四位有效数字。\n$t^{*} = (0.021225539... ) \\times 1000$ ms $= 21.225539...$ ms。\n四舍五入到四位有效数字，我们得到 21.23 ms。", "answer": "$$\\boxed{21.23}$$", "id": "3666624"}, {"introduction": "在多核时代，一个核心的架构设计问题是：我们应该使用少数几个高速核心，还是大量低速核心？这个决策深刻影响着系统的能效。本练习将引导你通过建立一个包含动态功耗、泄漏功耗和并行化限制的分析模型，来推导能使总能耗最小化的最优核心数量。[@problem_id:3666685]", "problem": "一个多核微处理器使用动态电压频率调整 (DVFS)，其电源电压和时钟频率之间的关系由线性关系 $V(f) = \\beta f$ 建模，其中 $\\beta$ 是一个与技术相关的正常数，$f$ 是时钟频率。每个核心的动态功耗可以很好地近似为 $P_{\\text{dyn}} = \\gamma V^{2} f$，其中 $\\gamma$ 是一个聚合了有效开关电容和平均活动因子的正常数。每个核心还表现出漏电（静态）功耗，其模型为 $P_{\\text{leak}} = \\lambda V$，其中 $\\lambda$ 是一个正常数。假设只要核心通电，无论其是否在主动切换，漏电功耗都持续存在，并且所有 $n$ 个核心在整个执行过程中都保持通电。\n\n考虑在此处理器上完成一个包含 $W$ 个周期的固定作业。该作业中比例为 $p$ 的周期是完全可并行的，而剩余比例为 $1 - p$ 的周期是串行的。您将比较该作业的两种实现方式：\n- 在频率 $f_{1}$ 下运行的单核实现。\n- 一种 $n$ 核实现，其中每个核心以频率 $f_{2} = \\frac{f_{1}}{n}$（等吞吐量缩放）运行，在并行部分具有理想的并行加速。\n\n假设指令级效率理想，因此任何核心上的每秒周期数都等于时钟频率，并且没有并行化开销。串行部分在单个核心上执行，并行部分在 $n$ 个核心上均匀执行。忽略核心动态功耗和漏电功耗之外的任何能量（例如，内存和互连能量），并假设 $0  p  1$，$W  0$，$f_{1}  0$，$\\beta  0$，$\\gamma  0$ 和 $\\lambda  0$。\n\n仅从给定的基本定律（$P_{\\text{dyn}} = \\gamma V^{2} f$、$P_{\\text{leak}} = \\lambda V$ 和 $V(f) = \\beta f$）以及基本时间关系 $T = \\frac{\\text{cycles}}{f}$ 出发，推导在 $n$ 个核心上完成作业所需的总能量（作为 $n$ 的函数），然后确定使该能量最小化的 $n$ 值（视为一个正实数变量）。将您的最终答案表示为能量最小化的核心数 $n^{\\star}$ 的单一闭式符号表达式。不需要进行数值计算，最终表达式中也不应出现单位。如果找到多个驻点，请选择使能量最小化的那个。", "solution": "用户希望我解决以下问题。\n\n### 问题陈述\n\n一个多核微处理器使用动态电压频率调整 (DVFS)，其电源电压和时钟频率之间的关系由线性关系 $V(f) = \\beta f$ 建模，其中 $\\beta$ 是一个与技术相关的正常数，$f$ 是时钟频率。每个核心的动态功耗可以很好地近似为 $P_{\\text{dyn}} = \\gamma V^{2} f$，其中 $\\gamma$ 是一个聚合了有效开关电容和平均活动因子的正常数。每个核心还表现出漏电（静态）功耗，其模型为 $P_{\\text{leak}} = \\lambda V$，其中 $\\lambda$ 是一个正常数。假设只要核心通电，无论其是否在主动切换，漏电功耗都持续存在，并且所有 $n$ 个核心在整个执行过程中都保持通电。\n\n考虑在此处理器上完成一个包含 $W$ 个周期的固定作业。该作业中比例为 $p$ 的周期是完全可并行的，而剩余比例为 $1 - p$ 的周期是串行的。您将比较该作业的两种实现方式：\n- 在频率 $f_{1}$ 下运行的单核实现。\n- 一种 $n$ 核实现，其中每个核心以频率 $f_{2} = \\frac{f_{1}}{n}$（等吞吐量缩放）运行，在并行部分具有理想的并行加速。\n\n假设指令级效率理想，因此任何核心上的每秒周期数都等于时钟频率，并且没有并行化开销。串行部分在单个核心上执行，并行部分在 $n$ 个核心上均匀执行。忽略核心动态功耗和漏电功耗之外的任何能量（例如，内存和互连能量），并假设 $0  p  1$，$W  0$，$f_{1}  0$，$\\beta  0$，$\\gamma  0$ 和 $\\lambda  0$。\n\n仅从给定的基本定律（$P_{\\text{dyn}} = \\gamma V^{2} f$、$P_{\\text{leak}} = \\lambda V$ 和 $V(f) = \\beta f$）以及基本时间关系 $T = \\frac{\\text{cycles}}{f}$ 出发，推导在 $n$ 个核心上完成作业所需的总能量（作为 $n$ 的函数），然后确定使该能量最小化的 $n$ 值（视为一个正实数变量）。将您的最终答案表示为能量最小化的核心数 $n^{\\star}$ 的单一闭式符号表达式。不需要进行数值计算，最终表达式中也不应出现单位。如果找到多个驻点，请选择使能量最小化的那个。\n\n### 步骤 1：提取已知条件\n- 电压-频率关系：$V(f) = \\beta f$\n- 每核动态功耗：$P_{\\text{dyn}} = \\gamma V^{2} f$\n- 每核漏电功耗：$P_{\\text{leak}} = \\lambda V$\n- 总工作负载：$W$ 个周期\n- 工作负载的并行部分：$p$\n- 工作负载的串行部分：$1 - p$\n- 多核系统中的核心数：$n$\n- 参考单核频率：$f_{1}$\n- $n$ 核系统中每核的频率：$f_{2} = \\frac{f_{1}}{n}$\n- 常数：$\\beta  0$, $\\gamma  0$, $\\lambda  0$\n- 问题约束：$0  p  1$, $W  0$, $f_{1}  0$\n- 假设：\n    - 作业执行期间所有 $n$ 个核心都保持通电。\n    - 串行部分在一个核心上运行。\n    - 并行部分在 $n$ 个核心上以完美加速比运行。\n    - 为进行优化，将 $n$ 视为正实数变量。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，使用了 CMOS 电路中功耗（$P \\propto V^2 f$）和漏电（$P \\propto V$）的标准简化模型，以及 DVFS 的线性模型。这是一个适定的问题，要求最小化一个推导出的能量函数，这是一个标准的微积分问题。问题陈述是客观的，使用了精确的技术语言。它是自包含的，提供了所有必要的方程和约束。诸如将 $n$ 视为实数变量和忽略并行化开销等假设，在理论性能建模中很常见，目的是使问题易于处理。这个问题并非无足轻重，需要仔细的推导。因此，该问题是有效的。\n\n### 步骤 3：结论与行动\n问题是有效的。我们现在开始求解。\n\n### 求解推导\n我们的目标是找到使完成作业所消耗的总能量最小化的核心数 $n$。总能量 $E_{\\text{total}}(n)$ 是串行阶段消耗的能量 $E_{\\text{ser}}$ 和并行阶段消耗的能量 $E_{\\text{par}}$ 的总和。\n\n首先，我们为 $n$ 核系统建立电压和功耗关系。每个核心以频率 $f_{2} = \\frac{f_{1}}{n}$ 运行。相应的电源电压由 DVFS 模型给出：\n$$V_{2} = V(f_{2}) = \\beta f_{2} = \\frac{\\beta f_{1}}{n}$$\n在此电压和频率下运行的单个核心的动态功耗和漏电功耗可以表示为 $n$ 的函数：\n单个活动核心的功耗为 $P_{\\text{core_active}} = P_{\\text{dyn}} + P_{\\text{leak}} = \\gamma V_{2}^{2} f_{2} + \\lambda V_{2}$。\n单个空闲但通电的核心的功耗仅为漏电功耗，$P_{\\text{core_idle}} = P_{\\text{leak}} = \\lambda V_{2}$。\n\n我们现在分析这两个执行阶段。\n\n**1. 串行阶段**\n作业的串行部分包含 $W_{\\text{ser}} = W(1-p)$ 个周期。这部分在单个核心上以频率 $f_{2}$ 执行。此阶段所用时间为：\n$$T_{\\text{ser}} = \\frac{W_{\\text{ser}}}{f_{2}} = \\frac{W(1-p)}{f_{1}/n} = \\frac{n W (1-p)}{f_{1}}$$\n在此阶段，一个核心处于活动状态，而其他 $n-1$ 个核心处于空闲但通电状态，仅贡献漏电功耗。串行阶段的总功耗 $P_{\\text{ser}}$ 为：\n$$P_{\\text{ser}} = P_{\\text{core_active}} + (n-1) P_{\\text{core_idle}} = (\\gamma V_{2}^{2} f_{2} + \\lambda V_{2}) + (n-1) \\lambda V_{2} = \\gamma V_{2}^{2} f_{2} + n \\lambda V_{2}$$\n串行阶段消耗的能量为 $E_{\\text{ser}} = P_{\\text{ser}} \\times T_{\\text{ser}}$。代入 $T_{\\text{ser}}$ 和 $P_{\\text{ser}}$ 的表达式：\n$$E_{\\text{ser}} = (\\gamma V_{2}^{2} f_{2} + n \\lambda V_{2}) \\left( \\frac{W(1-p)}{f_{2}} \\right) = W(1-p) \\left(\\gamma V_{2}^{2} + \\frac{n \\lambda V_{2}}{f_{2}}\\right)$$\n代入 $V_{2} = \\beta f_{2}$ 和 $f_{2} = f_{1}/n$：\n$$E_{\\text{ser}} = W(1-p) \\left(\\gamma (\\beta f_{2})^{2} + n \\lambda \\beta\\right) = W(1-p) \\left(\\gamma \\beta^{2} \\left(\\frac{f_{1}}{n}\\right)^{2} + n \\lambda \\beta\\right) = W(1-p) \\left(\\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + n \\lambda \\beta\\right)$$\n\n**2. 并行阶段**\n作业的并行部分包含 $W_{\\text{par}} = W p$ 个周期。这项工作被完美地分配给 $n$ 个核心，因此每个核心执行 $W_{\\text{par,core}} = \\frac{W p}{n}$ 个周期。所有 $n$ 个核心同时以频率 $f_{2}$ 运行。此阶段所用时间由任何单个核心完成其工作份额的时间决定：\n$$T_{\\text{par}} = \\frac{W_{\\text{par,core}}}{f_{2}} = \\frac{W p / n}{f_{1}/n} = \\frac{W p}{f_{1}}$$\n在此阶段，所有 $n$ 个核心都处于活动状态。总功耗 $P_{\\text{par}}$ 是所有 $n$ 个活动核心的功耗之和：\n$$P_{\\text{par}} = n \\times P_{\\text{core_active}} = n (\\gamma V_{2}^{2} f_{2} + \\lambda V_{2})$$\n并行阶段消耗的能量为 $E_{\\text{par}} = P_{\\text{par}} \\times T_{\\text{par}}$。代入 $T_{\\text{par}}$ 和 $P_{\\text{par}}$ 的表达式：\n$$E_{\\text{par}} = n(\\gamma V_{2}^{2} f_{2} + \\lambda V_{2}) \\left( \\frac{W p}{f_{1}} \\right)$$\n代入 $V_{2} = \\frac{\\beta f_{1}}{n}$ 和 $f_{2} = \\frac{f_{1}}{n}$：\n$$E_{\\text{par}} = n \\left( \\gamma \\left(\\frac{\\beta f_{1}}{n}\\right)^{2} \\left(\\frac{f_{1}}{n}\\right) + \\lambda \\left(\\frac{\\beta f_{1}}{n}\\right) \\right) \\left( \\frac{W p}{f_{1}} \\right) = \\left( \\frac{\\gamma \\beta^{2} f_{1}^{3}}{n^{2}} + \\lambda \\beta f_{1} \\right) \\left( \\frac{W p}{f_{1}} \\right) = W p \\left( \\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + \\lambda \\beta \\right)$$\n\n**3. 总能量与最小化**\n总能量 $E_{\\text{total}}(n)$ 是两个阶段能量的总和：\n$$E_{\\text{total}}(n) = E_{\\text{ser}} + E_{\\text{par}}$$\n$$E_{\\text{total}}(n) = W(1-p) \\left(\\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + n \\lambda \\beta\\right) + W p \\left( \\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + \\lambda \\beta \\right)$$\n我们可以按 $n$ 的幂次展开并分组：\n$$E_{\\text{total}}(n) = \\frac{W(1-p)\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + W(1-p)n\\lambda\\beta + \\frac{W p \\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + W p \\lambda \\beta$$\n$$E_{\\text{total}}(n) = \\frac{W \\gamma \\beta^{2} f_{1}^{2} ((1-p)+p)}{n^{2}} + n W \\lambda \\beta (1-p) + W p \\lambda \\beta$$\n$$E_{\\text{total}}(n) = \\frac{W \\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + n W \\lambda \\beta (1-p) + W p \\lambda \\beta$$\n为了找到使该能量最小化的 $n$ 值，我们将 $n$ 视为一个正实数变量，计算 $E_{\\text{total}}(n)$ 关于 $n$ 的导数，并将其设为零。\n我们定义常数来简化表达式：$A = W \\gamma \\beta^{2} f_{1}^{2}$，$B = W \\lambda \\beta (1-p)$ 和 $C = W p \\lambda \\beta$。能量函数为 $E(n) = A n^{-2} + B n + C$。\n$$\\frac{dE_{\\text{total}}}{dn} = \\frac{d}{dn} (A n^{-2} + B n + C) = -2 A n^{-3} + B$$\n将导数设为零以找到最优核心数 $n^{\\star}$：\n$$-2 A (n^{\\star})^{-3} + B = 0 \\implies (n^{\\star})^{3} = \\frac{2A}{B}$$\n$$n^{\\star} = \\left(\\frac{2A}{B}\\right)^{\\frac{1}{3}}$$\n现在，我们将 A 和 B 的表达式代回方程：\n$$n^{\\star} = \\left( \\frac{2 (W \\gamma \\beta^{2} f_{1}^{2})}{W \\lambda \\beta (1-p)} \\right)^{\\frac{1}{3}}$$\n工作负载项 $W$ 和一个因子 $\\beta$ 被约掉：\n$$n^{\\star} = \\left( \\frac{2 \\gamma \\beta f_{1}^{2}}{\\lambda (1-p)} \\right)^{\\frac{1}{3}}$$\n为了确认这个驻点是一个最小值点，我们检查二阶导数：\n$$\\frac{d^{2}E_{\\text{total}}}{dn^{2}} = \\frac{d}{dn} (-2 A n^{-3} + B) = 6 A n^{-4} = \\frac{6A}{n^{4}}$$\n由于 $W  0$，$\\gamma  0$，$\\beta  0$ 和 $f_{1}  0$，常数 $A = W \\gamma \\beta^{2} f_{1}^{2}$ 严格为正。对于任何正的核心数 $n$，项 $n^{4}$ 也为正。因此，$\\frac{d^{2}E_{\\text{total}}}{dn^{2}}  0$，这证实了函数 $E_{\\text{total}}(n)$ 在 $n  0$ 时是凸函数，我们的解 $n^{\\star}$ 对应于一个全局最小值。", "answer": "$$\\boxed{\\left( \\frac{2 \\gamma \\beta f_{1}^{2}}{\\lambda (1-p)} \\right)^{\\frac{1}{3}}}$$", "id": "3666685"}]}