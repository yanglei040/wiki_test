{"hands_on_practices": [{"introduction": "服务质量（QoS）管理的一个核心任务是预测系统性能。排队论为我们提供了强大的数学工具来分析和预测系统的响应时间。本练习将引导你从最基础的 $M/M/1$ 排队模型出发，估算一个服务的平均响应时间，并让你批判性地思考该模型的局限性。通过将理论预测与包含突发流量的真实场景数据进行对比，你将学习如何运用更普适的 $G/G/1$ 模型进行修正，从而深刻理解系统行为的可变性对服务质量的关键影响 [@problem_id:3674525]。", "problem": "一个由操作系统（OS）管理的加密服务被实现为单个内核线程，该线程以先到先服务（FCFS）的方式处理文件系统块请求。在一个长度为$10$分钟的平稳观察窗口内，进行了以下测量：平均到达率为$\\lambda = 900$个请求/秒，平均服务时间为$\\mathbb{E}[S] = 0.9$毫秒，到达间隔时间的变异系数平方（SCV）为$C_{a}^{2} = 5.0$，服务时间的SCV为$C_{s}^{2} = 1.5$。假设到达间隔时间和服务时间是独立同分布（i.i.d.）的，并且系统是稳定的。\n\n仅使用基本的排队论原理和经过充分检验的结论作为出发点：\n\n1) 在$M/M/1$排队（马尔可夫到达和马尔可夫服务）的假设下，从第一性原理推导平均响应时间$W$关于$\\lambda$和$\\mu$的表达式，其中$\\mu$是服务率，然后根据上述测量值进行数值计算。结果以毫秒表示。\n\n2) 基于测量的变异性$C_{a}^{2}$和$C_{s}^{2}$，批判性地评估$M/M/1$假设是否适用于这个具有突发性到达的操作系统管理服务。定性地解释与$M/M/1$的预测相比，突发性预计会如何改变等待时间。\n\n3) 使用考虑了一般到达和一般服务时间（$G/G/1$情景）的一阶校正，通过SCV计算校正后的平均响应时间估计值。最终响应时间以毫秒表示。将你的最终答案四舍五入到四位有效数字。", "solution": "问题陈述是自洽的，科学上基于排队论原理，并且提供的数据内部一致。给定的参数是：平均到達率$\\lambda = 900 \\text{ s}^{-1}$，平均服务时间$\\mathbb{E}[S] = 0.9 \\text{ ms} = 0.0009 \\text{ s}$，到达间隔时间的变异系数平方（SCV）$C_{a}^{2} = 5.0$，服务时间的SCV为$C_{s}^{2} = 1.5$。服务率为$\\mu = 1/\\mathbb{E}[S] = 1/0.0009 \\text{ s}^{-1} \\approx 1111.1 \\text{ s}^{-1}$。系统利用率为$\\rho = \\lambda / \\mu = \\lambda \\mathbb{E}[S] = 900 \\times 0.0009 = 0.81$。由于$\\rho  1$，系统如陈述所述是稳定的。该问题是有效的，可以如下解决。\n\n1) M/M/1排队的平均响应时间\n\n$M/M/1$排队假设到达间隔时间和服务时间是马尔可夫的（指数分布），具有单个服务器和无限缓冲区容量。排队规则是先到先服务（FCFS）。\n\n我们首先从第一性原理推导系统中的平均请求数$L$。对于处于稳态的$M/M/1$排队，系统中存在$n$个请求的概率$p_n$遵循几何分布：\n$$p_n = (1-\\rho)\\rho^n, \\quad \\text{for } n = 0, 1, 2, \\dots$$\n其中$\\rho = \\lambda/\\mu$是服务器利用率。\n\n系统中的平均请求数$L$是该分布的期望值：\n$$L = \\mathbb{E}[n] = \\sum_{n=0}^{\\infty} n p_n = \\sum_{n=0}^{\\infty} n (1-\\rho)\\rho^n = (1-\\rho) \\sum_{n=0}^{\\infty} n \\rho^n$$\n我们使用几何级数导数的恒等式，$\\sum_{n=1}^{\\infty} n x^{n-1} = \\frac{d}{dx} \\sum_{n=0}^{\\infty} x^n = \\frac{d}{dx} \\left(\\frac{1}{1-x}\\right) = \\frac{1}{(1-x)^2}$，对于$|x|1$。\n$$L = (1-\\rho) \\rho \\sum_{n=1}^{\\infty} n \\rho^{n-1} = (1-\\rho) \\rho \\left( \\frac{1}{(1-\\rho)^2} \\right) = \\frac{\\rho}{1-\\rho}$$\n根据利特尔法则（Little's Law），系统中的平均请求数与平均到达率$\\lambda$和平均响应时间$W$的关系为$L = \\lambda W$。将$L$的两个表达式相等：\n$$\\lambda W = \\frac{\\rho}{1-\\rho}$$\n求解$W$并代入$\\rho = \\lambda/\\mu$：\n$$W = \\frac{1}{\\lambda} \\frac{\\rho}{1-\\rho} = \\frac{1}{\\lambda} \\frac{\\lambda/\\mu}{1-\\lambda/\\mu} = \\frac{1}{\\lambda} \\frac{\\lambda/\\mu}{(\\mu-\\lambda)/\\mu} = \\frac{1}{\\mu-\\lambda}$$\n这就是$M/M/1$排队中平均响应时间的表达式。\n\n现在，我们对这个表达式进行数值计算。\n给定$\\lambda = 900 \\text{ s}^{-1}$和$\\mathbb{E}[S] = 0.9 \\text{ ms} = 0.0009 \\text{ s}$。\n服务率是$\\mu = \\frac{1}{\\mathbb{E}[S]} = \\frac{1}{0.0009} \\text{ s}^{-1} = \\frac{10000}{9} \\text{ s}^{-1}$。\n$$W = \\frac{1}{\\mu - \\lambda} = \\frac{1}{\\frac{10000}{9} - 900} = \\frac{1}{\\frac{10000 - 8100}{9}} = \\frac{9}{1900} \\text{ s}$$\n为了以毫秒表示结果，我们乘以$1000$：\n$$W = \\frac{9}{1900} \\times 1000 \\text{ ms} = \\frac{90}{19} \\text{ ms} \\approx 4.7368 \\text{ ms}$$\n\n2) M/M/1假设的适用性\n\n$M/M/1$模型假设到达间隔时间和服务时间都是指数分布的。指数分布的一个定义性特征是其变异系数平方（SCV）恰好为$1$。一个随机变量$X$的SCV定义为$C_X^2 = \\frac{\\text{Var}(X)}{(\\mathbb{E}[X])^2}$。\n\n问题提供了以下测量的SCV值：\n-   到达间隔时间的SCV: $C_a^2 = 5.0$\n-   服务时间的SCV: $C_s^2 = 1.5$\n\n由于$C_a^2 = 5.0 \\neq 1$，到达过程不是马尔可夫的（即不是泊松过程）。$C_a^2 > 1$的值表示一种“突发性”到达模式，其中到达比纯粹随机的泊松过程更集中。\n由于$C_s^2 = 1.5 \\neq 1$，服务时间不是指数分布的。$C_s^2 > 1$的值表示服务时间比指数分布假设的更具可变性。\n\n因此，$M/M/1$假设对于此系统**不适用**。\n\n定性地看，与具有平滑到达和服务时间的系统相比，到达的突发性（$C_a^2 > 1$）和服务时间的高可变性（$C_s^2 > 1$）都会导致拥塞加剧和队长增加。突发性到达倾向于间歇性地涌入队列，导致长时间的等待。类似地，一个异常长的服务时间会阻塞单个服务器，导致请求积压。因此，预计实际的平均等待时间将显著**长于**$M/M/1$模型的预测。\n\n3) G/G/1的平均响应时间校正估计\n\n为了解释到达间隔和服务时间的一般（非指数）分布，我们使用一个用于$G/G/1$系统中队列平均等待时间$W_q$的成熟近似公式。这通常被称为金曼近似（Kingman's approximation）或艾伦-库宁公式（Allen-Cunneen formula）：\n$$W_q \\approx \\mathbb{E}[S] \\left( \\frac{\\rho}{1-\\rho} \\right) \\left( \\frac{C_a^2 + C_s^2}{2} \\right)$$\n总平均响应时间$W$是队列中平均等待时间与平均服务时间之和：\n$$W = W_q + \\mathbb{E}[S]$$\n我们有以下数值：\n-   $\\mathbb{E}[S] = 0.9 \\text{ ms}$\n-   $\\rho = 0.81$\n-   $C_a^2 = 5.0$\n-   $C_s^2 = 1.5$\n\n首先，根据SCV计算校正因子：\n$$\\frac{C_a^2 + C_s^2}{2} = \\frac{5.0 + 1.5}{2} = \\frac{6.5}{2} = 3.25$$\n现在，将数值代入$W_q$的公式中：\n$$W_q \\approx (0.9 \\text{ ms}) \\left( \\frac{0.81}{1-0.81} \\right) (3.25) = (0.9 \\text{ ms}) \\left( \\frac{0.81}{0.19} \\right) (3.25)$$\n$$W_q \\approx (0.9 \\text{ ms}) \\times (4.263157...) \\times (3.25) \\approx 12.469736... \\text{ ms}$$\n最后，我们计算总平均响应时间$W$：\n$$W = W_q + \\mathbb{E}[S] \\approx 12.469736... \\text{ ms} + 0.9 \\text{ ms} = 13.369736... \\text{ ms}$$\n将最终答案四舍五入到四位有效数字，我们得到：\n$$W \\approx 13.37 \\text{ ms}$$\n正如第2部分所预测的，这个校正后的估计值远大于$M/M/1$模型预测的$\\approx 4.74 \\text{ ms}$，这反映了突发性到达和服务时间可变性对系统性能的显著影响。", "answer": "$$\\boxed{13.37}$$", "id": "3674525"}, {"introduction": "对于许多时间敏感的应用，如自动驾驶或工业控制，仅仅关注平均性能是远远不够的，我们必须提供严格的延迟保证。本练习将带你进入实时系统的世界，在这里，服务质量通常以最坏情况响应时间（Worst-Case Response Time, WCRT）来衡量。你将为一个采用固定优先级抢占式调度的任务集，推导并计算一个关键任务的 WCRT，其中不仅要考虑高优先级任务的抢占干扰，还必须计入由共享资源（如互斥锁）引起的阻塞延迟。通过这个练习，你将掌握分析实时系统可调度性的核心方法，并理解确保硬性 QoS 承诺所涉及的复杂性 [@problem_id:3674520]。", "problem": "操作系统中的一个实时子系统通过限制单个中央处理器（CPU）上的任务延迟来管理服务质量（QoS）。考虑一个采用固定优先级抢占式调度、遵循速率单调调度（RMS）算法的周期性独立任务集，其中周期越短意味着优先级越高。系统使用互斥锁（mutex）实现互斥，低优先级任务可能会执行非抢占式临界区，这可能通过资源共享阻塞高优先级任务。\n\n任务按索引排序，任务 $\\tau_{1}$ 具有最高优先级，其次是 $\\tau_{2}$，然后是 $\\tau_{3}$ 和 $\\tau_{4}$。任务参数如下：\n- 任务 $\\tau_{1}$：周期 $T_{1} = 25$ 毫秒，最坏情况执行时间 $C_{1} = 3$ 毫秒。\n- 任务 $\\tau_{2}$：周期 $T_{2} = 40$ 毫秒，最坏情况执行时间 $C_{2} = 5$ 毫秒。\n- 任务 $\\tau_{3}$：周期 $T_{3} = 100$ 毫秒，最坏情况执行时间 $C_{3} = 12$ 毫秒。\n- 任务 $\\tau_{4}$：周期 $T_{4} = 200$ 毫秒，最坏情况执行时间 $C_{4} = 20$ 毫秒，并且它可以持有一个受互斥锁保护的临界区长达 $4$ 毫秒。\n\n假设如下：\n- 在最坏情况下（临界时刻），所有任务的释放都是严格周期性和同步的。\n- 不存在释放抖动、自挂起和执行时间变化。\n- 任务 $\\tau_{3}$ 最多可能被一个低优先级的非抢占式临界区阻塞，阻塞时间的上界为 $B_{3} = 4$ 毫秒。\n- 截止时间等于周期。\n\n仅从核心定义和基本调度事实（例如，响应时间定义为完成时间减去释放时间，固定优先级调度的最坏情况临界时刻概念，以及干扰是由在响应区间内释放的高优先级作业抢占引起的这一事实）出发，通过将其表示为其自身计算时间、低优先级任务的一次性阻塞以及高优先级任务的干扰的函数，推导任务 $\\tau_{3}$ 的最坏情况响应时间的界限。然后，根据给定的任务参数，对该界限进行数值计算。\n\n以毫秒为单位表示最终的数值界限。无需四舍五入。", "solution": "目标是求出在固定优先级抢占式调度下，任务 $\\tau_{3}$ 由于低优先级临界区可能造成的阻塞而产生的最坏情况响应时间。\n\n从定义开始：任务 $\\tau_{i}$ 的一个作业的响应时间 $R_{i}$ 是从其释放到完成所经过的时间。在固定优先级抢占式调度下，最坏情况响应时间发生在临界时刻，即目标作业和所有更高优先级的作业同时释放的瞬间。这源于一个基本的调度事实：同步释放会使处理器上对任务 $\\tau_{i}$ 的作业的瞬时需求最大化。\n\n在其响应区间内，$\\tau_{i}$ 的一个作业会累积：\n1. 其自身的计算时间 $C_{i}$。\n2. 由于低优先级任务执行非抢占式临界区而造成的一次性阻塞 $B_{i}$。这是因为，在互斥的情况下，一个持有资源的低优先级任务最多只能阻止一次抢占，因此最多增加 $B_{i}$ 的延迟。\n3. 来自优先级更高的任务 $\\tau_{j}$（其中 $j \\in hp(i)$）的干扰，包括在 $\\tau_{i}$ 的作业等待期间释放的作业所进行的抢占。\n\n为了界定更高优先级任务 $\\tau_{j}$ 的干扰，注意到在任何长度为 $t$ 的区间内，$\\tau_{j}$ 的最大释放次数为 $\\lceil t / T_{j} \\rceil$，因为 $\\tau_{j}$ 是周期严格为 $T_{j}$ 的，并且假设在临界时刻同步释放。由于优先级的关系，$\\tau_{j}$ 的每个作业最多贡献 $C_{j}$ 的执行时间来抢占 $\\tau_{i}$。因此，在长度为 $R_{i}$ 的区间内，来自 $\\tau_{j}$ 的总干扰最多为 $\\lceil R_{i} / T_{j} \\rceil C_{j}$。\n\n综合这些影响，最坏情况响应时间的界限 $R_{i}$ 必须满足自洽关系\n$$\nR_{i} = C_{i} + B_{i} + \\sum_{j \\in hp(i)} \\lceil R_{i} / T_{j} \\rceil C_{j}\n$$\n其中 $hp(i)$ 是比 $\\tau_{i}$ 优先级更高的任务集。\n\n这个方程没有封闭形式解，但可以通过迭代计算来求解。我们初始化一个估计值，然后迭代应用方程的右侧，直到值收敛为止。\n$$\nR_{i}^{(k+1)} = C_{i} + B_{i} + \\sum_{j \\in hp(i)} \\lceil R_{i}^{(k)} / T_{j} \\rceil C_{j}\n$$\n一个合适的初始估计是 $R_{i}^{(0)} = C_{i} + B_{i}$，因为任务至少需要执行自己的工作并经受阻塞。\n\n现在，我们将这个框架应用于任务 $\\tau_{3}$。\n-   $C_{3} = 12$ 毫秒\n-   $B_{3} = 4$ 毫秒（来自任务 $\\tau_4$）\n-   $hp(3) = \\{\\tau_{1}, \\tau_{2}\\}$\n-   $T_1 = 25, C_1 = 3$\n-   $T_2 = 40, C_2 = 5$\n\n$\\tau_3$ 的响应时间方程为：\n$$\nR_3 = C_3 + B_3 + \\lceil R_3/T_1 \\rceil C_1 + \\lceil R_3/T_2 \\rceil C_2\n$$\n$$\nR_3 = 12 + 4 + \\lceil R_3/25 \\rceil \\cdot 3 + \\lceil R_3/40 \\rceil \\cdot 5\n$$\n我们开始迭代计算：\n-   初始估计：$R_3^{(0)} = C_3 + B_3 = 12 + 4 = 16$ 毫秒。\n-   迭代 1：\n    $R_3^{(1)} = 16 + \\lceil 16/25 \\rceil \\cdot 3 + \\lceil 16/40 \\rceil \\cdot 5 = 16 + 1 \\cdot 3 + 1 \\cdot 5 = 16 + 3 + 5 = 24$ 毫秒。\n-   迭代 2：\n    $R_3^{(2)} = 16 + \\lceil 24/25 \\rceil \\cdot 3 + \\lceil 24/40 \\rceil \\cdot 5 = 16 + 1 \\cdot 3 + 1 \\cdot 5 = 16 + 3 + 5 = 24$ 毫秒。\n\n由于 $R_3^{(2)} = R_3^{(1)} = 24$，该序列已经收敛。\n因此，任务 $\\tau_3$ 的最坏情况响应时间的界限是 $24$ 毫秒。\n由于 $R_3 = 24 \\text{ ms} \\leq T_3 = 100 \\text{ ms}$，该任务满足其截止时间。", "answer": "$$\\boxed{24}$$", "id": "3674520"}, {"introduction": "在现代系统中，服务质量的管理往往涉及在相互冲突的目标之间寻求最佳平衡，例如在吞吐量和延迟之间进行权衡。本练习模拟了一个常见的 I/O 调度场景：通过合并（merging）小请求来提升固态硬盘（SSD）的整体吞吐量。然而，这种合并操作会引入额外的排队延迟。你的任务是建立一个数学模型来量化这种权衡，并根据给定的服务等级目标（即 99 百分位延迟 $p_{99}$ 不得超过某个阈值），计算出允许的最大合并规模。这个实践将帮助你理解如何将抽象的性能模型应用于具体的工程决策，以满足现代云服务中常见的统计性 QoS 要求 [@problem_id:3674540]。", "problem": "一个用于固态硬盘（SSD）的操作系统存储栈实现基于时间的I/O合并，以提高吞吐量，同时满足服务质量（QoS）的尾延迟目标。调度器在长度为 $\\delta$ 的周期性合并窗口中运行，在此期间，它将所有新到达的小型读取请求排入队列，并在窗口结束时发出一个单一的合并I/O，将所有收集到的读取请求作为一个连续的操作来服务。假设小型读取请求的到达过程是速率为 $\\lambda$（单位：$\\text{s}^{-1}$）的平稳泊松过程，并且包含 $M$ 个小型读取请求的合并I/O的设备服务时间可以由一个仿射模型 $S(M) = \\alpha + \\beta M$ 很好地近似，其中 $\\alpha$ 模拟了每次I/O的固定开销，$\\beta$ 模拟了每次读取的传输时间。操作系统强制执行一个百分位延迟服务水平目标（SLO）：任何小型读取请求的端到端延迟的第99百分位数（$p_{99}$）不得超过一个预算值 $L_{\\max}$。\n\n为控制平均批处理大小，调度器通过强制执行稳态关系 $\\mathbb{E}[N(\\delta)] = \\lambda \\delta = M$ 来选择窗口长度作为目标合并大小 $M$ 的函数，其中 $N(\\delta)$ 是一个窗口内的到达次数。对于泊松过程和独立于到达的周期性门控，从任意到达时刻到下一个门控边界的剩余时间在 $[0,\\delta]$ 上均匀分布。因此，对于任意一个到达的请求，由合并操作引入的排队延迟部分服从 $[0,\\delta]$ 上的均匀分布。一次读取的端到端延迟被建模为该等待时间与后续合并I/O服务时间 $S(M)$ 的和。\n\n给定以下参数：\n- 到达率 $\\lambda = 5000$ $\\text{s}^{-1}$，\n- 固定服务开销 $\\alpha = 0.08$ $\\text{ms}$，\n- 单次读取传输时间 $\\beta = 0.03$ $\\text{ms}$，\n- 尾延迟预算 $L_{\\max} = 4$ $\\text{ms}$，\n\n并使用合并窗口规则 $\\delta(M) = M / \\lambda$（单位：秒），确定最大的整数合并大小 $M$，使得建模的 $p_{99}$ 端到端延迟不超过 $L_{\\max}$。所有时间量请以毫秒（ms）表示。最终答案必须是单个整数 $M$。由于 $M$ 是一个整数决策变量，因此无需四舍五入到有效数字。\n\n注意：进行合并的动机是，平均每个请求的服务时间随 $M$ 的增加而减少，因为 $\\frac{S(M)}{M} = \\frac{\\alpha}{M} + \\beta$，而较大的 $M$ 会增加由合并引起的等待时间。您的任务是平衡这些影响，以满足 $p_{99}$ 约束条件。", "solution": "问题要求解出满足给定服务质量（QoS）尾延迟目标的最大整数合并大小 $M$。解决方案需要为小型读取请求的端到端延迟建立一个模型，然后根据指定的约束条件求解 $M$。\n\n首先，我们来定义端到端延迟 $L$ 的组成部分。根据问题描述，任意小型读取的延迟是两个组成部分之和：\n1. 等待时间 $W$，即从请求到达时刻到当前合并窗口结束的这段时间。\n2. 服务时间 $T_s$，即包含该请求的合并I/O操作所需的时间。\n\n因此，总延迟为 $L = W + T_s$。我们必须刻画 $L$ 的概率特性。\n\n调度器以持续时间为 $\\delta$ 的合并窗口进行操作。问题指出，对于平稳泊松到达过程，任意一次到达的等待时间 $W$ 在区间 $[0, \\delta]$ 上均匀分布。我们可以将其写作 $W \\sim U[0, \\delta]$。\n\n包含目标为 $M$ 个小型读取的合并I/O的服务时间 $T_s$ 由确定性的仿射模型 $S(M) = \\alpha + \\beta M$ 给出。所以，$T_s = S(M)$。\n\n窗口持续时间 $\\delta$ 被设置为目标合并大小 $M$ 和到达率 $\\lambda$ 的函数，以满足稳态条件 $\\lambda \\delta = M$。这得出 $\\delta = M / \\lambda$。\n\n总延迟 $L$ 是一个随机变量，定义为随机变量 $W$ 和常量 $T_s = S(M)$（对于固定的目标 $M$）之和。\n$L = W + S(M)$，其中 $W \\sim U[0, M/\\lambda]$。\n一个均匀随机变量 $U[a, b]$ 与一个常数 $c$ 的和也是一个均匀随机变量，分布在 $[a+c, b+c]$ 上。\n在我们的例子中，$L$ 在区间 $[0 + S(M), \\delta + S(M)]$ 上均匀分布，即 $[S(M), S(M) + \\delta]$。\n\nQoS约束是针对延迟的第99百分位数（$p_{99}$），该值不得超过 $L_{\\max}$。令 $L_{0.99}$ 表示该百分位数。为了求出 $L_{0.99}$，我们使用 $L$ 的累积分布函数（CDF）。对于一个随机变量 $X \\sim U[a, b]$，其CDF为 $F_X(x) = \\frac{x-a}{b-a}$，其中 $x \\in [a, b]$。\n$L$ 的CDF因此为：\n$$ F_L(l) = \\frac{l - S(M)}{(S(M) + \\delta) - S(M)} = \\frac{l - S(M)}{\\delta} \\quad \\text{for } l \\in [S(M), S(M) + \\delta] $$\n第 $p$ 百分位延迟 $L_p$ 是使 $F_L(l) = p$ 成立的 $l$ 的值。\n$$ p = \\frac{L_p - S(M)}{\\delta} \\implies L_p = S(M) + p \\cdot \\delta $$\n对于第99百分位数，我们设 $p=0.99$：\n$$ L_{0.99} = S(M) + 0.99 \\delta $$\nQoS约束为 $L_{0.99} \\leq L_{\\max}$。代入 $L_{0.99}$、$S(M)$ 和 $\\delta$ 的表达式：\n$$ (\\alpha + \\beta M) + 0.99 \\left(\\frac{M}{\\lambda}\\right) \\leq L_{\\max} $$\n我们想找到满足此不等式的最大整数 $M$。我们可以重新整理不等式来求解 $M$：\n$$ \\alpha + M \\left(\\beta + \\frac{0.99}{\\lambda}\\right) \\leq L_{\\max} $$\n$$ M \\left(\\beta + \\frac{0.99}{\\lambda}\\right) \\leq L_{\\max} - \\alpha $$\n$$ M \\leq \\frac{L_{\\max} - \\alpha}{\\beta + \\frac{0.99}{\\lambda}} $$\n现在，我们代入给定的参数值。确保所有单位一致至关重要。问题建议时间单位使用毫秒（ms）。\n给定的参数是：\n- $\\lambda = 5000$ $\\text{s}^{-1}$\n- $\\alpha = 0.08$ $\\text{ms}$\n- $\\beta = 0.03$ $\\text{ms}$\n- $L_{\\max} = 4$ $\\text{ms}$\n\n我们将到达率 $\\lambda$ 的单位转换为 $\\text{ms}^{-1}$：\n$$ \\lambda = 5000 \\text{ s}^{-1} = 5000 \\times (1000 \\text{ ms})^{-1} = \\frac{5000}{1000} \\text{ ms}^{-1} = 5 \\text{ ms}^{-1} $$\n现在我们可以将数值代入关于 $M$ 的不等式中：\n$$ M \\leq \\frac{4 - 0.08}{0.03 + \\frac{0.99}{5}} $$\n我们分别计算分子和分母。\n分子：\n$$ L_{\\max} - \\alpha = 4 - 0.08 = 3.92 $$\n分母：\n$$ \\beta + \\frac{0.99}{\\lambda} = 0.03 + \\frac{0.99}{5} = 0.03 + 0.198 = 0.228 $$\n将这些值代回不等式：\n$$ M \\leq \\frac{3.92}{0.228} \\approx 17.19298... $$\n问题要求满足此条件的最大整数合并大小 $M$。小于或等于 $17.19298...$ 的最大整数是 $17$。\n\n为了验证，我们计算一下 $M=17$ 和 $M=18$ 时的 $p_{99}$ 延迟。\n对于 $M=17$：\n$L_{0.99}(17) = \\alpha + 17(\\beta + \\frac{0.99}{\\lambda}) = 0.08 + 17(0.03 + \\frac{0.99}{5}) = 0.08 + 17(0.228) = 0.08 + 3.876 = 3.956$ $\\text{ms}$。\n由于 $3.956 \\leq 4$，所以 $M=17$ 是一个有效的大小。\n\n对于 $M=18$：\n$L_{0.99}(18) = \\alpha + 18(\\beta + \\frac{0.99}{\\lambda}) = 0.08 + 18(0.228) = 0.08 + 4.104 = 4.184$ $\\text{ms}$。\n由于 $4.184 > 4$，所以 $M=18$ 违反了延迟约束。\n\n因此，最大的整数合并大小是 $17$。", "answer": "$$ \\boxed{17} $$", "id": "3674540"}]}