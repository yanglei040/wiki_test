{"hands_on_practices": [{"introduction": "径向分布函数 $g(r)$ 是分析流体结构的关键。然而，在有限的周期性盒子中，由于最小镜像约定 (Minimum Image Convention, MIC) 的限制，我们无法计算任意大距离的 $g(r)$。这个练习 [@problem_id:3412734] 将指导你从第一性原理出发，推导出一个严格的几何极限 $r_{\\max}$。当距离 $r$ 超过此极限时，$g(r)$ 的计算会因模拟盒子边界的截断而失真，从而让你深刻理解有限尺寸效应最直接的几何根源。", "problem": "使用分子动力学方法，在一个边长为 $L$ 的立方体盒子中，对数密度为 $\\rho$ 的简单、均匀、各向同性的流体施加三维周期性边界条件 (PBC) 进行模拟。为了估算径向分布函数 (RDF) $g(r)$，使用最小镜像约定 (MIC) 计算对间距：对于任意一个位置矢量为 $\\mathbf{r}_{i}$ 和 $\\mathbf{r}_{j}$ 的粒子对，其分离矢量通过适当选择整数三元组 $\\mathbf{n}$ 映射为 $\\mathbf{s}=\\mathbf{r}_{j}-\\mathbf{r}_{i}-\\mathbf{n}L$，使得 $\\mathbf{s}$ 的每个分量都位于区间 $(-L/2,L/2]$ 内。通过将模长 $|\\mathbf{s}|$ 统计到以半径 $r_{k}=k\\,\\Delta r$（$k\\geq 1$ 为整数）为中心、径向宽度均匀为 $\\Delta r$ 的一系列球壳中，并使用理想气体球壳体积因子 $4\\pi r^{2}\\Delta r$ 和数密度 $\\rho$ 进行归一化，来构建 $g(r)$ 的一个估算量。\n\n从以下第一性原理出发：(i) $g(r)$ 的定义，即间距为 $r$ 处的局部对密度与理想气体对密度的比值；(ii) $\\mathbb{R}^{3}$ 中球壳的欧几里得几何；(iii) PBC 和 MIC 作为将对分离矢量映射到立方体 $[-L/2,L/2]^{3}$ 中的几何作用；以及 (iv) 归一化中使用的球壳体积必须与采样对间距的几何区域完全对应的要求。请确定最大允许的直方图中心 $r_{\\max}$，使得对于直到并包括以 $r_{\\max}$ 为中心的 bin 在内的每一个 bin，其 $g(r)$ 的估算量都不受因 MIC 立方体边界对球壳的截断或各向异性裁剪而产生的镜像伪影的影响。\n\n假设当球壳与 MIC 立方体边界相交时，不对部分立体角进行校正，并要求每个被包含的球壳都完全包含在 MIC 立方体内。请用 $L$ 和 $\\Delta r$ 的闭式解析表达式表示您的最终结果。无需进行数值计算，也无需四舍五入。只需提供 $r_{\\max}$ 的表达式。", "solution": "问题要求确定用于计算径向分布函数 $g(r)$ 的最大允许直方图 bin 中心，记为 $r_{\\max}$。$g(r)$ 估算量的有效性取决于采样体积的几何完整性，正如问题陈述所规定的。推导将从所给定的第一性原理出发。\n\n(i) 径向分布函数 $g(r)$ 定义为间距为 $r$ 处的粒子对的局部数密度与理想气体的体数密度 $\\rho$ 之比。其估算量是通过统计分离模长落在球壳内的粒子对数量来构建的。\n\n(ii) 该估算量将对间距统计到宽度均匀为 $\\Delta r$ 的球壳中。对于某个整数 $k \\ge 1$，一个以半径 $r_k = k\\,\\Delta r$ 为中心的特定 bin，包含区间 $[r_k - \\Delta r/2, r_k + \\Delta r/2)$ 内的间距 $r$。这个理想球壳的体积通常近似为 $V_k \\approx 4\\pi r_k^2 \\Delta r$，该体积用于对粒子对计数进行归一化。\n\n(iii) 模拟在边长为 $L$ 的立方体盒子中采用三维周期性边界条件 (PBC)。最小镜像约定 (MIC) 用于计算任意两个粒子间的分离矢量 $\\mathbf{s}$。该约定将真实的分离矢量映射到中心的 Wigner-Seitz 原胞中，对于立方晶格而言，这是一个以原点为中心、边长为 $L$ 的立方体。因此，所有计算出的分离矢量 $\\mathbf{s}$ 都包含在 MIC 立方体内，该立方体可以表示为点集 $(s_x, s_y, s_z)$，其中每个分量都位于区间 $(-L/2, L/2]$ 内。我们将其表示为 $C_L = [-L/2, L/2]^3$。\n\n(iv) 问题强制要求，用于归一化的球壳体积必须与从中采样对间距的几何区域完全对应。由于归一化因子 $4\\pi r_k^2 \\Delta r$ 假设的是一个完整、不间断的球壳，因此只有当对应的整个球壳都被采样时，一个 bin 对 $g(r)$ 的贡献才被认为是无伪影的。由于所有采样的分离矢量 $\\mathbf{s}$ 都必须位于 MIC 立方体 $C_L$ 内，这个要求转化为一个严格的几何约束：整个球壳必须完全包含在立方体 $C_L$ 内。\n\n让我们将此几何约束形式化。考虑与以 $r_k$ 为中心的直方图 bin 相关联的球壳。该球壳由内径 $r_{\\text{inner}} = r_k - \\Delta r/2$ 和外径 $r_{\\text{outer}} = r_k + \\Delta r/2$ 定义。为了使整个球壳被包含在 MIC 立方体 $C_L$ 内，由其外径 $r_{\\text{outer}}$ 定义的球体必须完全包含在 $C_L$ 内。\n\n一个以原点为中心、半径为 $R$ 的球体，当且仅当其球面上的每个点都在立方体 $C_L = [-L/2, L/2]^3$ 的内部或边界上时，该球体才算完全包含在立方体内。球面上的点到原点的距离为 $R$。立方体 $C_L$ 的边界由位于 $x=\\pm L/2$、$y=\\pm L/2$ 和 $z=\\pm L/2$ 的六个平面组成。从原点到立方体边界上任意一点的最短距离是到这些面中任意一个面心（例如点 $(L/2, 0, 0)$）的距离，该距离为 $L/2$。因此，要使球体完全包含在立方体内，其半径 $R$ 必须小于或等于这个最小距离。该条件为：\n$$R \\le \\frac{L}{2}$$\n\n将此条件应用于以 $r_k$ 为中心的 bin 的球壳，我们必须确保与其外边界对应的球体被包含在立方体内。这个外球体的半径是 $r_{\\text{outer}} = r_k + \\Delta r/2$。因此，该 bin 不产生伪影的条件是：\n$$r_k + \\frac{\\Delta r}{2} \\le \\frac{L}{2}$$\n\n对于任何以 $r_k$ 为中心的 bin，要被认为是有效的，此不等式都必须成立。问题要求的是最大允许的直方图中心 $r_{\\max}$。这是 bin 中心 $r_k$ 在满足约束条件的情况下可以取到的最大值。我们可以通过重新整理不等式来求得此值：\n$$r_k \\le \\frac{L}{2} - \\frac{\\Delta r}{2}$$\n$$r_k \\le \\frac{L - \\Delta r}{2}$$\n\n满足此条件的 bin 中心 $r_k$ 的最大值恰好是允许范围的上界。因此，最大允许的直方图中心为：\n$$r_{\\max} = \\frac{L - \\Delta r}{2}$$\n\n任何中心 $r_k > r_{\\max}$ 的 bin，其外半径将满足 $r_k + \\Delta r/2 > L/2$，导致其对应的球壳被 MIC 立方体的面所截断。这将违反归一化体积与实际采样体积相对应的条件，从而在 $g(r)$ 的估算量中引入有限尺寸效应的伪影。", "answer": "$$\\boxed{\\frac{L - \\Delta r}{2}}$$", "id": "3412734"}, {"introduction": "截断对势，无论是通过人为设定的截断半径 $r_c$ 还是受限于盒子尺寸 $L/2$，都会给势能等热力学性质的计算带来系统性误差。这个实践 [@problem_id:3412735] 要求你推导用于补偿这些被忽略的长程相互作用的解析修正项。通过将修正分解为标准的“尾部修正”和真正的有限尺寸贡献，你将掌握一项获取精确模拟结果的关键技能。", "problem": "考虑一个均匀的单组分Lennard-Jones (LJ) 流体，其数密度为 $\\rho$，位于边长为 $L$ 的立方模拟盒子中，采用周期性边界条件和最小镜像约定。对势为 $u(r)=4\\varepsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$。在分子动力学模拟中，势在球形截断半径 $r_{c}$ 处被截断而未进行移位，且满足 $r_{c}\\leq L/2$。假设在超出最大相关结构长度后，径向分布函数等于1，即在 $r\\geq r_{c}$ 时以及在大 $L$ 条件下 $r\\geq L/2$ 时，$g(r)=1$。从无限均匀流体中单个粒子的平均势能的定义出发，推导必须加到原始截断模拟能量（使用截断半径 $r_{c}$ 计算）上的校正项的分解。该校正项应分解为两个可加部分：(i) 从 $r_{c}$ 到 $L/2$ 的解析截断尾部校正，以及 (ii) 考虑在最小镜像约定下超出 $L/2$ 的缺失相互作用的有限尺寸贡献。您的推导必须从第一性原理开始，包括用 $g(r)$ 和对势表示的势能的统计力学表达式，并通过显式径向积分进行。\n\n以约化的LJ单位表示每个粒子的这两个校正项，即，用约化密度 $\\rho^{*}=\\rho\\sigma^{3}$、约化截断半径 $r_{c}^{*}=r_{c}/\\sigma$ 和约化盒子长度 $L^{*}=L/\\sigma$ 来报告 $\\Delta u_{\\text{cut}}/\\varepsilon$ 和 $\\Delta u_{\\text{FS}}/\\varepsilon$。将您的最终结果以单行矩阵的形式提供，其第一个条目是 $\\Delta u_{\\text{cut}}/\\varepsilon$，第二个条目是 $\\Delta u_{\\text{FS}}/\\varepsilon$。无需进行数值计算。如果进行了任何简化，必须在代数上是精确的。不要在最终矩阵中包含单位；所要求的约化单位归一化已经指定了它们。", "solution": "问题要求推导在采用周期性边界条件（PBC）和最小镜像约定（MIC）的立方盒子中模拟的Lennard-Jones (LJ) 流体中单个粒子的两个势能校正项。推导必须从第一性原理开始。\n\n在数密度为 $\\rho$ 的无限均匀流体中，单个粒子的平均势能 $u_{\\text{inf}}$ 由统计力学表达式给出：\n$$\nu_{\\text{inf}} = \\frac{1}{2}\\rho \\int_{0}^{\\infty} u(r) g(r) 4\\pi r^2 dr\n$$\n其中 $u(r)$ 是对势，$g(r)$ 是径向分布函数。因子 $\\frac{1}{2}$ 是为了避免对粒子对进行双重计数。\n\n在势函数于截断半径 $r_c$ 处被截断的分子动力学模拟中，原始的单个粒子势能 $u_{\\text{raw}}$ 是通过仅对直至该距离的相互作用求和来计算的。该量的系综平均值为：\n$$\nu_{\\text{raw}} = \\frac{1}{2}\\rho \\int_{0}^{r_c} u(r) g(r) 4\\pi r^2 dr\n$$\n\n将原始能量调整到理想无限系统能量所需的总校正量 $\\Delta u$ 是这两个表达式之差：\n$$\n\\Delta u = u_{\\text{inf}} - u_{\\text{raw}} = \\frac{1}{2}\\rho \\int_{r_c}^{\\infty} u(r) g(r) 4\\pi r^2 dr\n$$\n\n问题指出我们应假设对于 $r \\geq r_c$，$g(r)=1$。这个用于长程校正的标准近似简化了积分：\n$$\n\\Delta u \\approx 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) r^2 dr\n$$\n\n问题要求将此总校正分解为两个可加部分：\n1.  截断尾部校正 $\\Delta u_{\\text{cut}}$，用于校正在 $r_c$ 到 $L/2$ 范围内被忽略的相互作用。距离 $L/2$ 是可以内切于立方模拟盒子的最大球体的半径，它代表了在MIC下一个中心粒子的最大相互作用范围。\n2.  有限尺寸校正 $\\Delta u_{\\text{FS}}$，用于解释在无限系统中存在但在有限周期性系统的MIC下不存在的超出 $L/2$ 的相互作用。\n\n基于此分解，我们可以在 $r=L/2$ 处分割 $\\Delta u$ 的积分：\n$$\n\\Delta u_{\\text{cut}} = 2\\pi\\rho \\int_{r_c}^{L/2} u(r) r^2 dr\n$$\n$$\n\\Delta u_{\\text{FS}} = 2\\pi\\rho \\int_{L/2}^{\\infty} u(r) r^2 dr\n$$\n问题中给出的条件 $r_c \\leq L/2$ 确保了 $\\Delta u_{\\text{cut}}$ 的积分范围是明确定义的。\n\nLennard-Jones 势由 $u(r) = 4\\varepsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$ 给出。我们首先需要求出 $u(r)r^2$ 的不定积分：\n$$\n\\int u(r) r^2 dr = \\int 4\\varepsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right] r^2 dr\n$$\n$$\n= 4\\varepsilon \\int \\left(\\sigma^{12}r^{-10} - \\sigma^{6}r^{-4}\\right) dr\n$$\n$$\n= 4\\varepsilon \\left[ \\frac{\\sigma^{12}r^{-9}}{-9} - \\frac{\\sigma^{6}r^{-3}}{-3} \\right] + C\n$$\n我们定义原函数 $I(r)$：\n$$\nI(r) = 4\\varepsilon \\left[ \\frac{\\sigma^{6}}{3r^{3}} - \\frac{\\sigma^{12}}{9r^{9}} \\right]\n$$\n\n现在我们可以计算这两个校正项。\n\n首先是截断尾部校正 $\\Delta u_{\\text{cut}}$：\n$$\n\\Delta u_{\\text{cut}} = 2\\pi\\rho \\left[ I(r) \\right]_{r_c}^{L/2} = 2\\pi\\rho \\left( I(L/2) - I(r_c) \\right)\n$$\n$$\n\\Delta u_{\\text{cut}} = 2\\pi\\rho \\left( 4\\varepsilon \\left[ \\frac{\\sigma^{6}}{3(L/2)^{3}} - \\frac{\\sigma^{12}}{9(L/2)^{9}} \\right] - 4\\varepsilon \\left[ \\frac{\\sigma^{6}}{3r_c^{3}} - \\frac{\\sigma^{12}}{9r_c^{9}} \\right] \\right)\n$$\n我们需要用约化单位报告 $\\Delta u_{\\text{cut}}/\\varepsilon$：$\\rho^{*} = \\rho\\sigma^{3}$、$r_{c}^{*} = r_{c}/\\sigma$ 和 $L^{*} = L/\\sigma$。\n$$\n\\frac{\\Delta u_{\\text{cut}}}{\\varepsilon} = 8\\pi\\rho \\left( \\left[ \\frac{\\sigma^{6}}{3(L^3/8)} - \\frac{\\sigma^{12}}{9(L^9/512)} \\right] - \\left[ \\frac{\\sigma^{6}}{3r_c^{3}} - \\frac{\\sigma^{12}}{9r_c^{9}} \\right] \\right)\n$$\n$$\n\\frac{\\Delta u_{\\text{cut}}}{\\varepsilon} = 8\\pi\\rho\\sigma^{3} \\left( \\left[ \\frac{8\\sigma^{3}}{3L^{3}} - \\frac{512\\sigma^{9}}{9L^{9}} \\right] - \\left[ \\frac{\\sigma^{3}}{3r_c^{3}} - \\frac{\\sigma^{9}}{9r_c^{9}} \\right] \\right)\n$$\n代入约化单位：\n$$\n\\frac{\\Delta u_{\\text{cut}}}{\\varepsilon} = 8\\pi\\rho^{*} \\left( \\left[ \\frac{8}{3(L/\\sigma)^{3}} - \\frac{512}{9(L/\\sigma)^{9}} \\right] - \\left[ \\frac{1}{3(r_c/\\sigma)^{3}} - \\frac{1}{9(r_c/\\sigma)^{9}} \\right] \\right)\n$$\n$$\n\\frac{\\Delta u_{\\text{cut}}}{\\varepsilon} = 8\\pi\\rho^{*} \\left( \\left( \\frac{8}{3(L^{*})^{3}} - \\frac{512}{9(L^{*})^{9}} \\right) - \\left( \\frac{1}{3(r_{c}^{*})^{3}} - \\frac{1}{9(r_{c}^{*})^{9}} \\right) \\right)\n$$\n\n其次是有限尺寸校正 $\\Delta u_{\\text{FS}}$：\n$$\n\\Delta u_{\\text{FS}} = 2\\pi\\rho \\int_{L/2}^{\\infty} u(r) r^2 dr = 2\\pi\\rho \\left[ I(r) \\right]_{L/2}^{\\infty}\n$$\n由于 $\\lim_{r\\to\\infty} I(r) = 0$，这变为：\n$$\n\\Delta u_{\\text{FS}} = 2\\pi\\rho \\left( 0 - I(L/2) \\right) = -2\\pi\\rho I(L/2)\n$$\n$$\n\\Delta u_{\\text{FS}} = -2\\pi\\rho \\left( 4\\varepsilon \\left[ \\frac{\\sigma^{6}}{3(L/2)^{3}} - \\frac{\\sigma^{12}}{9(L/2)^{9}} \\right] \\right)\n$$\n除以 $\\varepsilon$ 并转换为约化单位：\n$$\n\\frac{\\Delta u_{\\text{FS}}}{\\varepsilon} = -8\\pi\\rho \\left[ \\frac{\\sigma^{6}}{3(L^3/8)} - \\frac{\\sigma^{12}}{9(L^9/512)} \\right]\n$$\n$$\n\\frac{\\Delta u_{\\text{FS}}}{\\varepsilon} = -8\\pi\\rho\\sigma^{3} \\left[ \\frac{8\\sigma^{3}}{3L^{3}} - \\frac{512\\sigma^{9}}{9L^{9}} \\right]\n$$\n$$\n\\frac{\\Delta u_{\\text{FS}}}{\\varepsilon} = -8\\pi\\rho^{*} \\left[ \\frac{8}{3(L/\\sigma)^{3}} - \\frac{512}{9(L/\\sigma)^{9}} \\right]\n$$\n$$\n\\frac{\\Delta u_{\\text{FS}}}{\\varepsilon} = -8\\pi\\rho^{*} \\left( \\frac{8}{3(L^{*})^{3}} - \\frac{512}{9(L^{*})^{9}} \\right) = 8\\pi\\rho^{*} \\left( \\frac{512}{9(L^{*})^{9}} - \\frac{8}{3(L^{*})^{3}} \\right)\n$$\n这两个推导出的表达式是问题所要求的组成部分。将它们表示为行矩阵即可得到最终答案。\n第一个分量是 $\\frac{\\Delta u_{\\text{cut}}}{\\varepsilon} = 8\\pi\\rho^{*} \\left( \\frac{8}{3(L^{*})^{3}} - \\frac{512}{9(L^{*})^{9}} - \\frac{1}{3(r_{c}^{*})^{3}} + \\frac{1}{9(r_{c}^{*})^{9}} \\right)$。\n第二个分量是 $\\frac{\\Delta u_{\\text{FS}}}{\\varepsilon} = 8\\pi\\rho^{*} \\left( \\frac{512}{9(L^{*})^{9}} - \\frac{8}{3(L^{*})^{3}} \\right)$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 8\\pi\\rho^{*} \\left( \\frac{8}{3(L^{*})^{3}} - \\frac{512}{9(L^{*})^{9}} - \\frac{1}{3(r_{c}^{*})^{3}} + \\frac{1}{9(r_{c}^{*})^{9}} \\right)  8\\pi\\rho^{*} \\left( \\frac{512}{9(L^{*})^{9}} - \\frac{8}{3(L^{*})^{3}} \\right) \\end{pmatrix}}\n$$", "id": "3412735"}, {"introduction": "对于像介电常数 $\\epsilon$ 这样对长程关联敏感的响应性质，简单的能量修正往往不够。获得其热力学极限值 $\\epsilon(\\infty)$ 的标准方法是进行一系列不同系统尺寸的模拟，并对外推结果。这项综合性练习 [@problem_id:3412779] 不仅要求你推导在不同边界条件下 $\\epsilon$ 与总偶极矩涨落之间的关系，还要求你实现一个完整的有限尺寸标度分析方案，从而将理论知识应用于实际数据处理中。", "problem": "考虑一个在周期性边界条件 (PBC) 下模拟的各向同性极性流体的经典分子动力学系统。宏观静态介电常数，记为 $\\epsilon$，可以从模拟盒子的总偶极矩矢量 $\\mathbf{M}$ 的平衡涨落中估算出来。然而，有限尺寸效应和模拟盒子外部边界条件的选择会影响偶极矩涨落与 $\\epsilon$ 之间的关系。具体来说，对于边长为 $L$ 的立方盒子，两种常用的外部边界条件是导电边界（锡箔）和真空边界。在这两种情况下，总偶极矩的方差 $\\langle \\mathbf{M}^2 \\rangle$ 与 $\\epsilon$ 之间的有效关系有所不同，这是因为由形状相关的退极化因子决定的退极化场存在差异。\n\n任务：从线性响应理论 (LRT)、静电本构关系和涨落耗散定理 (FDT) 的基本原理出发，推导在导电边界（锡箔）和真空边界这两种条件下，各向同性系统中立方盒子内偶极矩方差 $\\langle \\mathbf{M}^2 \\rangle$ 与介电常数 $\\epsilon$ 之间的关系。假设立方盒子的形状因子与等于 $1/3$ 的退极化因子一致，且外部介质为导电介质（有效退极化为零）或真空。使用约化单位制，其中玻尔兹曼常数 $k_{\\mathrm{B}} = 1$，温度 $T$ 为无量纲量，因此所有报告的 $\\epsilon$ 值均为无量纲。\n\n有限尺寸标度方案：假设在尺寸为 $L$ 的盒子中估算的表观介电常数的有限尺寸依赖性对于足够大的 $L$ 是解析的，并遵循领头阶标度拟设\n$$\n\\epsilon(L) \\approx \\epsilon(\\infty) + \\frac{A}{L},\n$$\n其中 $A$ 是一个依赖于微观细节但与 $L$ 无关的未知系数，$\\epsilon(\\infty)$ 是热力学极限介电常数。给定几个 $L$ 下测得的 $\\langle \\mathbf{M}^2 \\rangle$ 值，分别使用您推导的关系式计算锡箔和真空边界条件下的 $\\epsilon(L)$，然后通过对 $\\epsilon(L)$ 与 $1/L$ 进行最小二乘线性拟合来估算 $\\epsilon(\\infty)$。如果测试用例中只有一个盒子尺寸 $L$ 可用，则返回单个 $\\epsilon(L)$ 值作为 $\\epsilon(\\infty)$ 的最佳可用估计。\n\n实现一个完整的、可运行的程序，该程序：\n- 对于每个提供的测试用例，将温度 $T$（无量纲）、盒子边长列表 $L$（无量纲长度单位）以及相应的锡箔和真空边界条件下测得的 $\\langle \\mathbf{M}^2 \\rangle$ 值列表作为输入。\n- 使用您从第一性原理推导出的关系，分别为锡箔和真空边界条件计算 $\\epsilon(L)$。\n- 对 $\\epsilon(L)$ 与 $1/L$ 进行最小二乘线性回归，以估算每种边界条件下的 $\\epsilon(\\infty)$。如果只有一个 $L$ 可用，则直接使用该值作为 $\\epsilon(\\infty)$ 的估计。\n- 将所有测试用例的外推介电常数输出为一行，形式为逗号分隔并用方括号括起来的列表，顺序为：$[\\epsilon_{\\mathrm{tf}}^{(\\infty)}\\text{ case 1}, \\epsilon_{\\mathrm{vac}}^{(\\infty)}\\text{ case 1}, \\epsilon_{\\mathrm{tf}}^{(\\infty)}\\text{ case 2}, \\epsilon_{\\mathrm{vac}}^{(\\infty)}\\text{ case 2}, \\ldots]$，其中 $\\epsilon_{\\mathrm{tf}}^{(\\infty)}$ 表示锡箔外推值，$\\epsilon_{\\mathrm{vac}}^{(\\infty)}$ 表示真空外推值。所有浮点数表示为四舍五入到三位小数。\n\n使用以下测试套件。所有量均采用 $k_{\\mathrm{B}}=1$ 的约化单位，长度为无量纲。对于每种情况，$T$ 是温度，$L$ 是盒子尺寸列表，$\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{tf}}$ 和 $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{vac}}$ 分别是锡箔和真空边界条件下测得的总偶极矩方差。\n\n测试套件：\n1. 情况A（中等极性，多种尺寸）：\n   - $T = 1$\n   - $L = [10, 20]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{tf}} = [4894.014500075782, 37719.72151277919]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{vac}} = [625.0, 4975.0]$\n2. 情况B（单一尺寸边缘情况）：\n   - $T = 1$\n   - $L = [8]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{tf}} = [641.6445]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{vac}} = [233.6970]$\n3. 情况C（弱极性，在 $L$ 上为常数）：\n   - $T = 1$\n   - $L = [12, 24]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{tf}} = [206.2255, 1649.8060]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{vac}} = [176.7647, 1414.1190]$\n4. 情况D（强极性，两种尺寸）：\n   - $T = 1$\n   - $L = [20, 50]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{tf}} = [114591.55902616464, 1772139.6000]$\n   - $\\langle \\mathbf{M}^2 \\rangle_{\\mathrm{vac}} = [5457.692811531652, 85303.0000]$\n\n最终输出格式：\n- 您的程序应生成一行，其中包含一个逗号分隔并用方括号括起来的结果列表，浮点数四舍五入到三位小数。例如：$[\\epsilon_{\\mathrm{tf}}^{(\\infty)}\\text{ case 1}, \\epsilon_{\\mathrm{vac}}^{(\\infty)}\\text{ case 1}, \\ldots]$。", "solution": "该问题被认为是有效的，因为它在科学上基于统计力学和电磁学原理，提法明确，目标清晰，数据充分，并且没有任何在问题验证标准中列出的使问题无效的缺陷。\n\n任务是推导模拟盒子的总偶极矩均方值 $\\langle \\mathbf{M}^2 \\rangle$ 与静态介电常数 $\\epsilon$ 之间的关系，适用于两种不同的宏观边界条件：导电（锡箔）和真空。然后，我们使用这些关系从有限尺寸的模拟数据中估算热力学极限介电常数 $\\epsilon(\\infty)$。推导将基于线性响应理论 (LRT) 和经典静电学。我们将在约化单位制下工作，其中玻尔兹曼常数 $k_{\\mathrm{B}} = 1$，并使用高斯/cgs单位制，其中电位移矢量 $\\mathbf{D}$、电场 $\\mathbf{E}$ 和极化强度 $\\mathbf{P}$ 之间的关系为 $\\mathbf{D} = \\mathbf{E} + 4\\pi\\mathbf{P}$。本构关系为 $\\mathbf{D} = \\epsilon \\mathbf{E}$，这意味着 $\\mathbf{P} = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E}$。\n\n根据线性响应理论，可观测量 $A$ 对一个通过相互作用哈密顿量 $H' = -BF$ 与可观测量 $B$ 耦合的微小外部场 $F$ 的响应由 $\\Delta \\langle A \\rangle = \\beta \\langle AB \\rangle_0 F$ 给出，其中 $\\beta = 1/(k_B T)$，$\\langle \\cdot \\rangle_0$ 表示在未受扰系综中的平均值。对于我们的问题，可观测量是模拟盒子的总偶极矩 $\\mathbf{M}$，它与外部施加的均匀电场 $\\mathbf{E}_0$ 共轭。相互作用哈密顿量为 $H' = - \\mathbf{M} \\cdot \\mathbf{E}_0$。\n\n因此，沿 $\\mathbf{E}_0$ 场方向的感生平均偶极矩 $\\langle \\mathbf{M} \\rangle$ 由涨落耗散定理给出。对于各向同性系统，其中 $\\langle M_x^2 \\rangle_0 = \\langle M_y^2 \\rangle_0 = \\langle M_z^2 \\rangle_0 = \\frac{1}{3}\\langle \\mathbf{M}^2 \\rangle_0$ 且自发极化 $\\langle \\mathbf{M} \\rangle_0 = 0$：\n$$ \\langle \\mathbf{M} \\rangle = \\frac{\\beta}{3} \\langle \\mathbf{M}^2 \\rangle_0 \\mathbf{E}_0 $$\n宏观极化强度为 $\\mathbf{P} = \\langle \\mathbf{M} \\rangle / V$，其中 $V=L^3$ 是立方盒子的体积。\n$$ \\mathbf{P} = \\frac{\\beta \\langle \\mathbf{M}^2 \\rangle_0}{3V} \\mathbf{E}_0 $$\n该方程将微观涨落 $\\langle \\mathbf{M}^2 \\rangle_0$ 与由外场 $\\mathbf{E}_0$ 引起的宏观响应 $\\mathbf{P}$ 联系起来。\n\n下一步是利用连续介质静电学，以一种依赖于宏观边界条件的方式，将 $\\mathbf{P}$ 与 $\\mathbf{E}_0$ 联系起来。关键在于，介电样品内部的局域麦克斯韦场 $\\mathbf{E}$ 通常不等于外场 $\\mathbf{E}_0$。它们之间的关系取决于样品的形状和周围介质的介电特性。内部场由下式给出：\n$$ \\mathbf{E} = \\mathbf{E}_0 - \\mathbf{E}_{\\text{dep}} $$\n其中 $\\mathbf{E}_{\\text{dep}}$ 是退极化场。对于一个嵌入在介电常数为 $\\epsilon'$ 的介质中的均匀极化强度为 $\\mathbf{P}$ 的样品，退极化场为 $\\mathbf{E}_{\\text{dep}} = 4\\pi N \\frac{\\mathbf{P}}{\\epsilon'}$，其中 $N$ 是依赖于几何形状的退极化因子。对于球体，$N=1/3$。我们采用这个值作为各向同性系统中立方盒子的近似。\n\n现在我们将LRT结果与两种特定边界条件下的静电学相结合。\n\n**1. 导电（锡箔）边界条件**\n这种情况对应于样品被导电介质包围，因此 $\\epsilon' \\to \\infty$。退极化场 $\\mathbf{E}_{\\text{dep}} = 4\\pi N \\frac{\\mathbf{P}}{\\epsilon'}$ 消失。这意味着样品内部的平均麦克斯韦场与外场相同：$\\mathbf{E} = \\mathbf{E}_0$。\n\n我们现在可以令极化强度 $\\mathbf{P}$ 的两个表达式相等：\n来自静电学：$\\mathbf{P} = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E} = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E}_0$。\n来自LRT：$\\mathbf{P} = \\frac{\\beta \\langle \\mathbf{M}^2 \\rangle_{\\text{tf}}}{3V} \\mathbf{E}_0$。\n\n令 $\\mathbf{E}_0$ 的系数相等：\n$$ \\frac{\\epsilon-1}{4\\pi} = \\frac{\\beta \\langle \\mathbf{M}^2 \\rangle_{\\text{tf}}}{3V} $$\n使用问题的单位制，$\\beta=1/T$ 和 $V=L^3$，我们可以解出在尺寸为 $L$ 的盒子中测得的表观介电常数 $\\epsilon_{\\text{tf}}(L)$：\n$$ \\epsilon_{\\text{tf}}(L) = 1 + \\frac{4\\pi \\langle \\mathbf{M}^2 \\rangle_{\\text{tf}}}{3 T L^3} $$\n\n**2. 真空边界条件**\n这种情况对应于样品被真空包围，因此 $\\epsilon' = 1$。退极化因子为 $N=1/3$。内部场为 $\\mathbf{E} = \\mathbf{E}_0 - 4\\pi N \\mathbf{P} = \\mathbf{E}_0 - \\frac{4\\pi}{3}\\mathbf{P}$。\n\n将此代入 $\\mathbf{P}$ 的静电关系式中：\n$$ \\mathbf{P} = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E} = \\frac{\\epsilon-1}{4\\pi} \\left( \\mathbf{E}_0 - \\frac{4\\pi}{3}\\mathbf{P} \\right) $$\n$$ \\mathbf{P} = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E}_0 - \\frac{\\epsilon-1}{3}\\mathbf{P} $$\n$$ \\mathbf{P} \\left( 1 + \\frac{\\epsilon-1}{3} \\right) = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E}_0 $$\n$$ \\mathbf{P} \\left( \\frac{\\epsilon+2}{3} \\right) = \\frac{\\epsilon-1}{4\\pi}\\mathbf{E}_0 $$\n这给出了一个用 $\\mathbf{E}_0$ 表示 $\\mathbf{P}$ 的静电学表达式：\n$$ \\mathbf{P} = \\frac{3}{\\epsilon+2} \\frac{\\epsilon-1}{4\\pi} \\mathbf{E}_0 $$\n现在，我们将其与LRT表达式 $\\mathbf{P} = \\frac{\\beta \\langle \\mathbf{M}^2 \\rangle_{\\text{vac}}}{3V} \\mathbf{E}_0$ 相等：\n$$ \\frac{\\beta \\langle \\mathbf{M}^2 \\rangle_{\\text{vac}}}{3V} = \\frac{3}{\\epsilon+2} \\frac{\\epsilon-1}{4\\pi} $$\n重新整理此式，得到著名的 Clausius-Mossotti 关系，它将宏观的 $\\epsilon$ 与微观涨落联系起来：\n$$ \\frac{\\epsilon(L)-1}{\\epsilon(L)+2} = \\frac{4\\pi \\beta \\langle \\mathbf{M}^2 \\rangle_{\\text{vac}}}{9V} $$\n让我们定义一个量 $X(L) = \\frac{4\\pi \\langle \\mathbf{M}^2 \\rangle_{\\text{vac}}}{9 T L^3}$。方程为 $\\frac{\\epsilon_{\\text{vac}}(L)-1}{\\epsilon_{\\text{vac}}(L)+2} = X(L)$。解出 $\\epsilon_{\\text{vac}}(L)$：\n$$ \\epsilon_{\\text{vac}}(L) - 1 = X(L) (\\epsilon_{\\text{vac}}(L) + 2) $$\n$$ \\epsilon_{\\text{vac}}(L) (1 - X(L)) = 1 + 2X(L) $$\n$$ \\epsilon_{\\text{vac}}(L) = \\frac{1 + 2X(L)}{1 - X(L)} $$\n\n**有限尺寸外推**\n问题提供了一个标度拟设 $\\epsilon(L) \\approx \\epsilon(\\infty) + A/L$。这描述了 $\\epsilon(L)$ 和 $1/L$ 之间的线性关系。我们的任务是通过线性最小二乘拟合找到截距 $\\epsilon(\\infty)$。\n对于一组数据点 $(x_i, y_i) = (1/L_i, \\epsilon(L_i))$，我们拟合一条直线 $y = mx + c$。截距 $c$ 是我们对 $\\epsilon(\\infty)$ 的估计。如果只有一个数据点 $(L_1, \\epsilon(L_1))$ 可用，那么对无限大尺寸极限的最佳估计就是 $\\epsilon(L_1)$ 本身。\n\n步骤如下：\n1. 对每个测试用例和每种边界条件（锡箔和真空），使用推导出的公式计算表观介电常数集合 $\\epsilon(L_i)$。\n2. 构成数据对 $(1/L_i, \\epsilon(L_i))$。\n3. 如果数据点多于一个，则进行线性回归以找到截距 $\\epsilon(\\infty)$。如果只有一个点，则设 $\\epsilon(\\infty) = \\epsilon(L_1)$。\n4. 报告每个测试用例得到的 $\\epsilon_{\\text{tf}}^{(\\infty)}$ 和 $\\epsilon_{\\text{vac}}^{(\\infty)}$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the molecular dynamics finite-size effect problem for dielectric constants.\n    \"\"\"\n    test_cases = [\n        # Case A (moderately polar, multiple sizes)\n        {\n            \"T\": 1.0,\n            \"L\": [10.0, 20.0],\n            \"M2_tf\": [4894.014500075782, 37719.72151277919],\n            \"M2_vac\": [625.0, 4975.0],\n        },\n        # Case B (single-size edge case)\n        {\n            \"T\": 1.0,\n            \"L\": [8.0],\n            \"M2_tf\": [641.6445],\n            \"M2_vac\": [233.6970],\n        },\n        # Case C (weakly polar, constant in L)\n        {\n            \"T\": 1.0,\n            \"L\": [12.0, 24.0],\n            \"M2_tf\": [206.2255, 1649.8060],\n            \"M2_vac\": [176.7647, 1414.1190],\n        },\n        # Case D (strongly polar, two sizes)\n        {\n            \"T\": 1.0,\n            \"L\": [20.0, 50.0],\n            \"M2_tf\": [114591.55902616464, 1772139.6],\n            \"M2_vac\": [5457.692811531652, 85303.0],\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        T = case[\"T\"]\n        L_list = np.array(case[\"L\"])\n        M2_tf_list = np.array(case[\"M2_tf\"])\n        M2_vac_list = np.array(case[\"M2_vac\"])\n        \n        # --- Tin-Foil Boundary Condition ---\n        eps_tf_L = []\n        for L, M2_tf in zip(L_list, M2_tf_list):\n            V = L**3\n            eps = 1.0 + (4.0 * np.pi * M2_tf) / (3.0 * T * V)\n            eps_tf_L.append(eps)\n        \n        # --- Vacuum Boundary Condition ---\n        eps_vac_L = []\n        for L, M2_vac in zip(L_list, M2_vac_list):\n            V = L**3\n            X = (4.0 * np.pi * M2_vac) / (9.0 * T * V)\n            if 1.0 - X == 0:\n                eps = float('inf')\n            else:\n                eps = (1.0 + 2.0 * X) / (1.0 - X)\n            eps_vac_L.append(eps)\n\n        # --- Finite-Size Extrapolation ---\n        n_points = len(L_list)\n        \n        if n_points == 1:\n            eps_tf_inf = eps_tf_L[0]\n            eps_vac_inf = eps_vac_L[0]\n        else:\n            x_inv_L = 1.0 / L_list\n            \n            # Linear regression: y = A*x + B, where B is the intercept epsilon_infinity\n            \n            # Tin-foil\n            coeffs_tf = np.polyfit(x_inv_L, eps_tf_L, 1)\n            eps_tf_inf = coeffs_tf[1]\n            \n            # Vacuum\n            coeffs_vac = np.polyfit(x_inv_L, eps_vac_L, 1)\n            eps_vac_inf = coeffs_vac[1]\n\n        results.append(eps_tf_inf)\n        results.append(eps_vac_inf)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```", "id": "3412779"}]}