## 引言
在分子动力学（MD）模拟的广阔领域中，精确而高效地模拟分子系统的长[时间演化](@entry_id:153943)是核心挑战之一。一个主要的计算瓶颈来自于[化学键](@entry_id:138216)的高频[振动](@entry_id:267781)，它迫使我们采用极小的时间步长，从而限制了对[蛋白质折叠](@entry_id:136349)、[配体结合](@entry_id:147077)等慢过程的探索。为了克服这一障碍，引入刚性近似成为一种至关重要的策略，它通过“冻结”这些快速运动，允许使用更大的时间步长，极大地提升了模拟效率。然而，如何正确地在理论和实践中实现这种刚性，引出了一系列深刻的力学和算法问题。

本文旨在系统性地阐述在[分子动力学](@entry_id:147283)中处理刚性分子的两种主要[范式](@entry_id:161181)。我们将深入探讨这两种方法的理论基础、数值实现及其对模拟结果的深远影响。

在第一章**“原理与机制”**中，我们将建立[刚体动力学](@entry_id:142040)的理论框架，从自由度的定义到[惯性张量](@entry_id:148659)，再到描述旋转的各种数学工具（如[四元数](@entry_id:147023)）。同时，我们将剖析约束算法（如SHAKE和LINCS）的力学原理，揭示它们如何通过[拉格朗日乘子](@entry_id:142696)来维持分子的几何构型。第二章**“应用与[交叉](@entry_id:147634)学科联系”**将视野扩展到实际应用，探讨刚体模型和约束如何在处理周期性边界条件、[多时间尺度积分](@entry_id:752321)、[自由能计算](@entry_id:164492)以及与实验数据（如[冷冻电镜](@entry_id:152102)）结合中发挥作用，并展示其与[机器人学](@entry_id:150623)、量子力学等领域的[交叉](@entry_id:147634)融合。最后，第三章**“动手实践”**提供了一系列精心设计的编程练习，旨在将理论知识转化为实际的编程技能，加深对SHAKE、LINCS等算法数值特性和实现细节的理解。

通过这三个章节的层层递进，读者将不仅掌握刚体模拟的核心技术，更能深刻理解其背后的物理原理和在多学科前沿研究中的应用价值。现在，让我们从刚体运动的基本原理开始我们的探索之旅。

## 原理与机制

在本章中，我们将深入探讨在[分子动力学](@entry_id:147283)（MD）中处理刚性分子的核心原理和机制。我们将从两个互补的视角来审视这个问题：第一种是将分子视为一个单一的、不可分割的刚体，具有明确的平动和[转动自由度](@entry_id:141502)；第二种则是将其视为一个由多个原子组成的体系，这些原子通过[代数方程](@entry_id:272665)（即约束）保持其相对位置不变。通过对这两种方法的详细分析，我们将揭示它们各自的数学表示、动力学方程以及在[数值模拟](@entry_id:137087)中的优缺点。

### 刚体模型的[运动学](@entry_id:173318)：自由度与构型空间

在[分子动力学模拟](@entry_id:160737)中引入刚性近似的主要动机是为了消除系统中最高频率的运动，即化学键的[振动](@entry_id:267781)。这些高频[振动](@entry_id:267781)通常需要极小的时间步长（约1飞秒）才能被[数值积分器](@entry_id:752799)准确地捕捉。通过将特定的分子或其子结构（如水分子或甲基）视为刚体，我们可以“冻结”这些[振动](@entry_id:267781)，从而允许使用更大的时间步长（例如2-5飞秒），显著提高计算效率，同时对许多宏观性质和慢过程的影响甚微。

一个由 $N$ 个无约束的点状原子组成的系统在三维空间中拥有 $3N$ 个笛卡尔自由度。然而，当我们施加约束以固定所有原子间的内部距离时，系统便成为一个刚体。一个自由的刚体，其在空间中的状态可以完全由其位置和朝向来描述。

- **[平动自由度](@entry_id:140257) (Translational Degrees of Freedom)**：我们可以通过追踪刚体上某一个[固定点](@entry_id:156394)（通常是其**[质心](@entry_id:265015)**）的位置来描述其整体平动。这需要3个坐标（例如，$x, y, z$），因此对应于3个[平动自由度](@entry_id:140257)。

- **[转动自由度](@entry_id:141502) (Rotational Degrees of Freedom)**：描述刚体相对于其质心的朝向则更为复杂。对于一个[非线性分子](@entry_id:175085)，它可以在三个独立的方向上转动，因此拥有3个[转动自由度](@entry_id:141502)。对于一个[线性分子](@entry_id:166760)（所有[原子核](@entry_id:167902)位于一条直线上），绕其分子轴的转动并不会改变原子的位置，因此不是一个物理上有意义的自由度。故[线性分子](@entry_id:166760)只有2个[转动自由度](@entry_id:141502)。

综上所述，一个自由的、[非线性](@entry_id:637147)的刚体总共拥有 $3 (\text{平动}) + 3 (\text{转动}) = 6$ 个自由度。为了从最初的 $3N$ 个自由度得到这6个自由度，我们必须引入 $m = 3N - 6$ 个独立的**[完整约束](@entry_id:140686) (holonomic constraints)** [@problem_id:3442756]。这些约束通常表现为固定原子间距离的[代数方程](@entry_id:272665)。

从数学上讲，一个刚体的所有可能构型（位置和朝向的集合）构成了一个被称为**[构型空间](@entry_id:149531)**的[流形](@entry_id:153038)。对于三维空间中的刚体，这个空间是**[特殊欧几里得群](@entry_id:139383) (Special Euclidean Group)**，记作 $SE(3)$。$SE(3)$ 的每个元素都是一个变换，它由一个平移和一个旋转组成。因此， $SE(3)$ 可以看作是平移空间 $\mathbb{R}^3$ 和旋转空间**[特殊正交群](@entry_id:146418) (Special Orthogonal Group)** $SO(3)$ 的结合。它的维度是 $\dim(SE(3)) = \dim(\mathbb{R}^3) + \dim(SO(3)) = 3 + 3 = 6$，这与我们前面点算的自由度数目完全一致 [@problem_id:3442756]。

### [惯性张量](@entry_id:148659)：[质量分布](@entry_id:158451)的描述

刚体的动力学行为不仅取决于其总质量，还取决于其质量的[分布](@entry_id:182848)。描述这种[分布](@entry_id:182848)如何影响转动行为的物理量是**惯性张量 (inertia tensor)**，记作 $\mathbf{I}$。对于一个由质量为 $m_i$、相对于[质心](@entry_id:265015)的位置为 $\mathbf{r}_i$ 的 $N$ 个离散点质量组成的刚体，其惯性张量是一个 $3 \times 3$ 的[对称矩阵](@entry_id:143130)，其分量由下式给出：

$$
I_{jk} = \sum_{i=1}^{N} m_i \left( |\mathbf{r}_i|^2 \delta_{jk} - r_{ij} r_{ik} \right)
$$

其中，$j, k \in \{x, y, z\}$，$r_{ij}$ 是矢量 $\mathbf{r}_i$ 的第 $j$ 个分量，$\delta_{jk}$ 是克罗内克符号。对角元素 $I_{xx}, I_{yy}, I_{zz}$ 分别被称为绕 $x, y, z$ 轴的**[转动惯量](@entry_id:174608)**，而非对角元素则被称为**[惯性积](@entry_id:170145)**。

通过选择一个特殊的[坐标系](@entry_id:156346)，即**[主轴](@entry_id:172691)[坐标系](@entry_id:156346) (principal axes frame)**，可以使[惯性张量对角化](@entry_id:167324)。[对角化](@entry_id:147016)后的[惯性张量](@entry_id:148659)为：

$$
\mathbf{I}_p = \begin{pmatrix} I_1 & 0 & 0 \\ 0 & I_2 & 0 \\ 0 & 0 & I_3 \end{pmatrix}
$$

其对角元素 $I_1, I_2, I_3$ 被称为**[主转动惯量](@entry_id:150889) (principal moments of inertia)**。这些值是刚体固有的属性，表征了其绕三个相互正交的[主轴](@entry_id:172691)转动的“惯性大小”。

分子的对称性直接决定了其[主转动惯量](@entry_id:150889)的结构 [@problem_id:3442771]。
- 对于一个**线性分子**，例如一个位于 $z$ 轴上的[三原子分子](@entry_id:155569)，其原子坐标为 $(0,0,-a)$, $(0,0,0)$ 和 $(0,0,a)$。由于所有质量都集中在 $z$ 轴上，任何垂直于该轴的转动都会遇到相同的[质量分布](@entry_id:158451)。因此，绕 $x$ 轴和 $y$ 轴的转动惯量必然相等，即 $I_1 = I_2$。而由于理想化的点质量模型中没有质量分布在离 $z$ 轴有限远的地方，绕 $z$ 轴的转动惯量为零，$I_3 = 0$。这种 $I_1 = I_2 \neq I_3$ 的结构是所有线性分子的标志。

- 对于一个**[对称陀螺分子](@entry_id:189173) (symmetric top)**，例如一个由三个相同质量的原子构成的等边三角形（位于 $xy$ 平面），它具有一个三重旋转对称轴（$C_3$ 轴，即 $z$ 轴）。这种对称性保证了在 $xy$ 平面内所有方向都是等价的，因此绕任何位于该平面内的轴的[转动惯量](@entry_id:174608)都相同。这意味着 $I_1 = I_2$。而绕对称轴 $z$ 轴的转动惯量 $I_3$ 则通常不同。如果 $I_1 = I_2  I_3$，则为**扁平陀螺 (oblate top)**；如果 $I_1 = I_2  I_3$，则为**长条陀螺 (prolate top)**。

理解惯性张量的结构对于建立正确的[刚体动力学](@entry_id:142040)模型至关重要，并且在比较不同模拟策略的数值稳定性时也扮演着重要角色 [@problem_id:3442788]。

### 方向的[参数化](@entry_id:272587)：旋转的多种表示

虽然[旋转群](@entry_id:204412) $SO(3)$ 是一个[三维流形](@entry_id:193484)，但不存在一个全局、无[奇异点](@entry_id:199525)的三参数[坐标系](@entry_id:156346)来描述它。这导致了多种不同的旋转表示方法，每种方法在计算效率、数值稳定性和直观性方面都有其独特的权衡。在模拟中选择合适的参数化方案是一个关键的决策 [@problem_id:3442775]。

- **旋转矩阵 (Rotation Matrices)**：一个旋转可以用一个 $3 \times 3$ 的矩阵 $\mathbf{R}$ 来表示，它满足 $\mathbf{R}^{\top}\mathbf{R} = \mathbf{I}$ (正交性) 和 $\det(\mathbf{R}) = 1$ (保持手性)。这种表示法使用9个标量，但受到6个独立约束的限制，因此是**冗余的 (redundant)**。其优点是应用旋转非常直接（通过矩阵-向量乘法），且表示是全局无[奇异点](@entry_id:199525)的。缺点是存储和计算成本较高，并且在[数值积分](@entry_id:136578)过程中，微小的累积误差会破坏其正交性，需要进行周期性的**[再正交化](@entry_id:754248) (re-orthonormalization)**。

- **[欧拉角](@entry_id:171794) (Euler Angles)**：例如 $ZYZ$ 顺序的[欧拉角](@entry_id:171794) $(\alpha, \beta, \gamma)$，它将任意旋转分解为绕三个固定或随体轴的连续转动。这是一种**最小化的 (minimal)** 表示，仅使用3个参数。其优点是参数数量少。然而，其致命缺点是存在**运动学[奇异点](@entry_id:199525) (kinematic singularities)**，即所谓的**[万向节死锁](@entry_id:171734) (gimbal lock)**。在某些特定的角度组合下（例如，当 $\beta=0$ 或 $\pi$ 时），两个[旋转轴](@entry_id:187094)会重合，导致一个自由度的表示丢失，此时的[运动方程](@entry_id:170720)会发散，引发严重的[数值不稳定性](@entry_id:137058)。此外，其[运动方程](@entry_id:170720)包含复杂的三角函数，计算成本较高。

- **[单位四元数](@entry_id:204470) (Unit Quaternions)**：[四元数](@entry_id:147023)是一种扩展的复数，形式为 $q = q_0 + q_1\mathbf{i} + q_2\mathbf{j} + q_3\mathbf{k}$。一个[单位四元数](@entry_id:204470)（满足 $q_0^2 + q_1^2 + q_2^2 + q_3^2 = 1$）可以表示三维空间中的一个旋转。这是一种包含4个参数和1个约束的冗余表示。[四元数](@entry_id:147023)是目前分子动力学中最受欢迎的旋转表示方法，其优点包括：(1) 全局无[奇异点](@entry_id:199525)；(2) 运动方程是线性的，不含[三角函数](@entry_id:178918)，更新效率极高；(3) 组合旋转仅需[四元数乘法](@entry_id:154753)。其缺点是表示不唯一，因为 $q$ 和 $-q$ 代表同一个旋转（这被称为对 $SO(3)$ 的**双重覆盖 (double cover)**），并且与旋转矩阵类似，[数值积分](@entry_id:136578)会使其范数偏离1，需要周期性地**归一化 (normalization)**。

- **指数坐标/轴-角表示 (Exponential Coordinates/Axis-Angle)**：任何旋转都可以由一个旋转轴（一个[单位向量](@entry_id:165907) $\hat{\mathbf{n}}$）和一个旋转角 $\theta$ 来定义。我们可以将其合并为一个三维向量 $\boldsymbol{\phi} = \theta \hat{\mathbf{n}}$，这是一种最小化的表示。它与李群理论中的[指数映射](@entry_id:137184)紧密相关。优点是参数少且直观。缺点是表示不唯一（例如，旋转 $2\pi$ 的整数倍角等同于不旋转），并且从旋转矩阵到轴-角表示的逆映射（[对数映射](@entry_id:637227)）在旋转角为 $\pi$ 的倍数时存在奇异性或模糊性。

总结来说，四元数因其在数值稳定性、计算效率和无[奇异点](@entry_id:199525)方面的综合优势，成为了刚体模拟中的首选。而[欧拉角](@entry_id:171794)因其[万向节死锁](@entry_id:171734)问题，在通用动力学模拟中基本被弃用 [@problem_id:3442775]。

### [刚体动力学](@entry_id:142040)：力矩与运动方程

描述刚体运动的方程是**牛顿-欧拉方程 (Newton-Euler equations)**。
- [平动](@entry_id:187700)部分的方程非常简单，形式与牛顿第二定律完全相同：
$$
M \ddot{\mathbf{r}}_{\mathrm{cm}} = \mathbf{F}_{\mathrm{net}}
$$
其中 $M$ 是总质量，$\mathbf{r}_{\mathrm{cm}}$ 是质心位置，$\mathbf{F}_{\mathrm{net}}$ 是作用在刚体上的净外力。

- 转动部分的方程则涉及到角动量 $\mathbf{L}$ 和力矩 $\boldsymbol{\tau}$：
$$
\frac{d\mathbf{L}}{dt} = \boldsymbol{\tau}_{\mathrm{net}}
$$
在随体[主轴](@entry_id:172691)[坐标系](@entry_id:156346)中，角动量与[角速度](@entry_id:192539) $\boldsymbol{\omega}$ 的关系为 $\mathbf{L} = \mathbf{I}_p \boldsymbol{\omega}$。由于惯性张量 $\mathbf{I}_p$ 在此[坐标系](@entry_id:156346)中是常数，方程可以写成更具体的形式，即欧拉方程。

力矩 $\boldsymbol{\tau}$ 是作用在物体上的力使其绕某一点转动的趋势。对于一个[势能](@entry_id:748988)为 $U$ 的保守系统，力矩是[势能](@entry_id:748988)相对于[无穷小旋转](@entry_id:166635) $\delta\boldsymbol{\phi}$ 的负梯度，即 $\delta U = - \boldsymbol{\tau} \cdot \delta\boldsymbol{\phi}$。我们可以利用这一关系从势能函数中推导出力矩。

考虑一个由Gay-Berne势描述的轴对称椭球分子，其[势能](@entry_id:748988) $U_{\mathrm{GB}}$ 是粒子间距离 $r$、粒子朝向矢量 $\hat{\mathbf{u}}_1, \hat{\mathbf{u}}_2$ 和粒子间连线矢量 $\hat{\mathbf{r}}$ 的函数。通过[链式法则](@entry_id:190743)，可以计算出势能因粒子1的无穷小转动 $\delta\boldsymbol{\phi}$ 而产生的变化 $\delta U_{\mathrm{GB}}$。由于 $\delta \hat{\mathbf{u}}_1 = \delta\boldsymbol{\phi} \times \hat{\mathbf{u}}_1$，最终可以推导出作用在粒子1上的力矩表达式 [@problem_id:3442801]：
$$
\boldsymbol{\tau} = - \left[ \frac{\partial U_{\mathrm{GB}}}{\partial s_{1}} (\hat{\mathbf{u}}_{1} \times \hat{\mathbf{r}}) + \frac{\partial U_{\mathrm{GB}}}{\partial c} (\hat{\mathbf{u}}_{1} \times \hat{\mathbf{u}}_{2}) \right]
$$
其中 $s_1 = \hat{\mathbf{r}} \cdot \hat{\mathbf{u}}_{1}$ 和 $c = \hat{\mathbf{u}}_{1} \cdot \hat{\mathbf{u}}_{2}$ 是势能的自变量。

一个重要的物理洞察是，对于任何[轴对称](@entry_id:173333)（单轴）势，作用在粒子上的力矩总是垂直于其[对称轴](@entry_id:177299)。这意味着，沿着对称轴方向的力矩分量恒为零 ($\tau_{\parallel} = \boldsymbol{\tau} \cdot \hat{\mathbf{u}}_1 = 0$)。这是因为势能仅依赖于对称轴的方向，而与粒子绕该轴的旋转角度无关。这一对称性意味着系统无法产生改变其绕对称轴自转状态的力矩 [@problem_id:3442801]。

### 原子论视角：[完整约束](@entry_id:140686)与[约束力](@entry_id:170052)

处理刚性分子的第二种方法是保留所有原子的笛卡尔坐标，但通过施加代数约束来固定它们的相对几何构型。一个典型的**[完整约束](@entry_id:140686) (holonomic constraint)** 是固定两个原子 $i$ 和 $j$ 之间的距离：
$$
\phi(q) = |\mathbf{r}_i - \mathbf{r}_j|^2 - d_{ij}^2 = 0
$$
其中 $q$ 是包含所有原子坐标的[广义坐标](@entry_id:156576)向量，$d_{ij}$ 是固定的键长。

这些约束是通过引入**约束力 (constraint forces)** 来维持的。根据[拉格朗日力学](@entry_id:147054)的基本原理，约束力总是作用在与约束[流形](@entry_id:153038)相垂直的方向上。在数学上，这意味着约束力向量 $f_c$ 必须是所有约束函数梯度 $\nabla \phi_k$ 的线性组合：
$$
f_c = G(q)^T \boldsymbol{\lambda}
$$
其中 $G(q)$ 是**约束雅可比矩阵 (constraint Jacobian)**，其每一行是 $\nabla \phi_k$；$\boldsymbol{\lambda}$ 是一个包含**[拉格朗日乘子](@entry_id:142696) (Lagrange multipliers)** 的向量，其值需要在每一步动态确定，以确保约束得到满足。

在[数值积分](@entry_id:136578)中，如速度[Verlet算法](@entry_id:150873)，一个无约束的更新步骤会产生一个临时的位置 $\tilde{q}^{n+1}$ 和速度 $\tilde{v}^{n+1}$，它们通常会违反约束条件。像**RATTLE**这样的算法通过在更新步骤后施加校正来强制满足约束 [@problem_id:3442819]。例如，对于速度的校正，我们寻求一个修正量 $\Delta \dot{q}^{n+1}$，使得最终速度 $\dot{q}^{n+1} = \tilde{v}^{n+1} + \Delta \dot{q}^{n+1}$ 满足速度级别的约束 $G(q^{n+1})\dot{q}^{n+1} = 0$。

这个校正量 $\Delta \dot{q}^{n+1}$ 是由一个瞬时施加的[约束力](@entry_id:170052)[脉冲产生](@entry_id:263613)的，因此它必须具有 $M^{-1}G^T\boldsymbol{\mu}$ 的形式，其中 $M$ 是[质量矩阵](@entry_id:177093)，$\boldsymbol{\mu}$ 是待求的乘子。通过将最终速度代入速度[约束方程](@entry_id:138140)，我们可以解出 $\boldsymbol{\mu}$，并最终得到速度校正的表达式：
$$
\Delta \dot{q}^{n+1} = - M^{-1} G(q^{n+1})^{\mathsf{T}} \left( G(q^{n+1}) M^{-1} G(q^{n+1})^{\mathsf{T}} \right)^{-1} G(q^{n+1}) \tilde{v}^{n+1}
$$
这个表达式的本质是一个投影操作：它计算出临时速度 $\tilde{v}^{n+1}$ 中违反约束的部分，并将其减去，从而将最终速度投影到允许的运动空间上 [@problem_id:3442819]。

### 约束算法的数值实现与稳定性

在实践中，求解[拉格朗日乘子](@entry_id:142696)是约束算法的核心计算任务。上述RATTLE的推导揭示了一个关键矩阵 $S = G M^{-1} G^T$。这个矩阵的性质直接决定了约束求解过程的效率和稳定性。

矩阵 $S$ 的**[条件数](@entry_id:145150) (condition number)** $\kappa_2$，即其最大[特征值](@entry_id:154894)与最小特征值之比，是衡量其[数值稳定性](@entry_id:146550)的一个关键指标。一个很大的[条件数](@entry_id:145150)意味着矩阵是**病态的 (ill-conditioned)**，此时求解线性方程组 $S\boldsymbol{\lambda} = b$ 对输入 $b$ 的微小扰动非常敏感。对于像**SHAKE**（一种早期的、广泛使用的迭代约束算法）这样的方法，病态的 $S$ 矩阵会导致迭代收敛非常缓慢，甚至失败。这种情况通常发生在约束网络中存在近似共线或共面的几何结构时，例如一个角度接近180度的三原子链，这会导致约束雅可比矩阵 $G$ 近似[秩亏](@entry_id:754065) [@problem_id:3442768]。为了保证模拟的稳定，病态的约束几何结构往往迫使我们使用更小的[积分时间步长](@entry_id:162921)。

对于一个包含 $N \approx 10^5$ 个原子的大型[生物分子](@entry_id:176390)体系，约束算法的[计算效率](@entry_id:270255)和并行扩展性至关重要 [@problem_id:3442770]。
- **SHAKE** 和 **RATTLE** 是[迭代算法](@entry_id:160288)，其计算成本约为 $O(k N_c)$，其中 $N_c$ 是约束数量，$k$ 是迭代次数。由于一个原子可能参与多个约束，在迭代过程中存在[数据依赖](@entry_id:748197)，这限制了它们在多处理器上的[强扩展性](@entry_id:172096)。
- **SETTLE** 是一种专门针对刚性水分子的解析算法。由于水分子的几何构型简单，其三个约束可以被解析地、非迭代地求解。每个水分子的计算成本是 $O(1)$，且不同水分子之间没有约束耦合，因此该算法可以**窘迫并行化 (embarrassingly parallel)**，具有极佳的扩展性。
- **LINCS (Linear Constraint Solver)** 是一种非迭代方法，它通过矩阵的级数展开来近似 $S^{-1}$。其成本为 $O(p N_c)$，其中 $p$ 是展开阶数。LINCS的并行性优于SHAKE，但其精度和稳定性依赖于展开阶数 $p$，对于通过长链或环耦合的约束网络，可能需要较高的 $p$ 值。

在现代MD模拟中，最常见的策略是采用混合方案：对数量庞大的溶剂水分子使用高效的**SETTLE**算法，而对蛋白质等溶质分子中的键长约束则使用**LINCS**算法。

### 理论基础与高级主题

最后，我们从更根本的理论层面比较这两种策略，并探讨一些高级主题。

从力学角度看，将分子视为单一刚体，其动力学由一个 $6 \times 6$ 的广义[质量矩阵](@entry_id:177093)描述。在随体[主轴](@entry_id:172691)[坐标系](@entry_id:156346)中，该矩阵是块对角的，分别对应于总质量 $m$ 和[惯性张量](@entry_id:148659) $\mathbf{I}_{\mathrm{cm}}$。只要分子不是理想的线性结构，该矩阵就是正定且通常是良态的。而采用原子坐标和[完整约束](@entry_id:140686)的方法，虽然其原始质量矩阵 $M$ 是对角且良态的，但约束的引入将问题转化为了一个更大维度的、耦合的**[鞍点问题](@entry_id:174221) (saddle-point problem)**。该系统的[数值条件](@entry_id:136760)由约束雅可比矩阵 $G$ 的性质决定，而不再仅仅是质量。因此，刚体表述通常能提供一个条件更好的[线性系统](@entry_id:147850) [@problem_id:3442788]。

从[统计力](@entry_id:194984)学的角度看，当从笛卡尔坐标变换到[广义坐标](@entry_id:156576)（如刚体的平动和转动坐标）时，相空间[体积元](@entry_id:267802)会发生改变。这个变换的[雅可比行列式](@entry_id:137120) $\sqrt{\det(\mathbf{J}^{\top}\mathbf{J})}$ 必须被包含在系统的[哈密顿量](@entry_id:172864)或[配分函数](@entry_id:193625)中，才能得到正确的[统计力学系综](@entry_id:141439)。这个修正项通常被称为**[Fixman势](@entry_id:749442)**。对于刚体，这个雅可比行列式可以被精确地分解为[平动](@entry_id:187700)部分和转动部分。转动部分的贡献依赖于分子的[主转动惯量](@entry_id:150889)和用于描述方向的坐标（如[欧拉角](@entry_id:171794)中的 $\sin\beta$ 因子） [@problem_id:3442761]。在实际模拟中，是否包含此修正项取决于所研究的性质。

此外，约束的类型也会对系统的热力学性质产生深远影响。我们主要讨论的[完整约束](@entry_id:140686) $C(q)=0$ 最终导出的动力学在约化的相空间上是哈密顿的，并且是时间可逆的。然而，还存在另一类**非[完整约束](@entry_id:140686) (nonholonomic constraints)**，它们只限制速度，形式为 $A(q)\dot{q}=0$，且通常不可积。这类系统不再是哈密顿系统，其相空间流可能是**可压缩的 (compressible)**，即相空间体积不守恒。这种相空间压缩性 $\kappa(q, \dot{q})$ 可以被精确计算，并且通常不为零。这意味着，为了在此类系统上正确地实现[恒温器](@entry_id:169186)（thermostat）以采样正则系综，恒温器的[动力学方程](@entry_id:751029)必须进行修正，以补偿这种非哈密顿效应。这与[完整约束](@entry_id:140686)系统形成了鲜明对比，后者的相空间流在有效意义上是不可压缩的，使得标准恒温器的设计更为直接 [@problem_id:3442803]。