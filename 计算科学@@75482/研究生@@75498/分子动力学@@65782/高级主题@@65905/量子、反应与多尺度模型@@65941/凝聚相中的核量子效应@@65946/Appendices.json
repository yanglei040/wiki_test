{"hands_on_practices": [{"introduction": "理解复杂材料中的核量子效应，首先要掌握其最基本的构成单元——量子谐振子。这项练习将引导你从第一性原理出发，推导一个三维量子谐振子在有限温度下的平均动能和势能。通过将量子结果与经典均分定理进行比较，你将亲手揭示零点能的存在以及量子振动模式在低温下被“冻结”的现象，从而深刻理解核量子效应的物理本质。[@problem_id:3430050]", "problem": "考虑一个凝聚相中的局域核振动模式，该模式被建模为一个质量为 $m$、角频率为 $\\omega$ 的各向同性三维量子谐振子。其哈密顿算符为\n$$\n\\hat{H} \\;=\\; \\sum_{\\alpha \\in \\{x,y,z\\}} \\left[ \\frac{\\hat{p}_{\\alpha}^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2} \\right].\n$$\n假设该模式在正则系综中处于温度 $T$ 的热平衡状态。从正则配分函数的定义 $Z \\,=\\, \\mathrm{Tr}\\left[\\exp(-\\beta \\hat{H})\\right]$（其中 $\\beta \\,=\\, 1/(k_{B} T)$）出发，利用基础的统计力学和量子力学原理，推导该模式动能 $\\langle \\hat{E}_{\\mathrm{kin}} \\rangle$ 和势能 $\\langle \\hat{E}_{\\mathrm{pot}} \\rangle$ 的热期望值的解析表达式。将这些量子结果与经典均分极限进行比较，并解释核量子效应（NQE）如何表现为零点贡献和有限温度下的热抑制，同时说明它们对 $\\omega$ 和 $T$ 的依赖关系。\n\n将你的最终答案以单行矩阵的形式表示为序对 $\\big(\\langle \\hat{E}_{\\mathrm{kin}} \\rangle,\\langle \\hat{E}_{\\mathrm{pot}} \\rangle\\big)$。不要进行数值计算。", "solution": "所述问题具有科学依据，提法恰当且客观。这是一个量子统计力学中标准的、可解的问题，没有内部矛盾或信息缺失。因此，我们可以进行推导。\n\n该系统是一个各向同性三维量子谐振子（QHO）。其哈密顿算符 $\\hat{H}$ 由下式给出\n$$\n\\hat{H} = \\sum_{\\alpha \\in \\{x,y,z\\}} \\left[ \\frac{\\hat{p}_{\\alpha}^{2}}{2m} + \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2} \\right]\n$$\n该哈密顿量是可分离的，意味着它是三个独立的一维（1D）量子谐振子哈密顿量之和，即 $\\hat{H} = \\hat{H}_x + \\hat{H}_y + \\hat{H}_z$，其中 $\\hat{H}_{\\alpha} = \\frac{\\hat{p}_{\\alpha}^{2}}{2m} + \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2}$。由于这种独立性以及谐振子的各向同性（三个维度的 $\\omega$ 相同），总动能和势能的期望值就是一维量子谐振子相应期望值的三倍：\n$$\n\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = 3 \\left\\langle \\frac{\\hat{p}^2}{2m} \\right\\rangle_{1D} \\quad \\text{和} \\quad \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = 3 \\left\\langle \\frac{1}{2} m \\omega^2 \\hat{q}^2 \\right\\rangle_{1D}\n$$\n因此，我们将在正则系综中，于逆温度 $\\beta = 1/(k_B T)$ 下，计算单个自由度的热期望值 $\\langle \\hat{p}^2 \\rangle_{1D}$ 和 $\\langle \\hat{q}^2 \\rangle_{1D}$。\n\n对于一维量子谐振子，用下降算符（$\\hat{a}$）和上升算符（$\\hat{a}^{\\dagger}$）来表示位置算符 $\\hat{q}$ 和动量算符 $\\hat{p}$ 会很方便：\n$$\n\\hat{q} = \\sqrt{\\frac{\\hbar}{2m\\omega}}(\\hat{a} + \\hat{a}^{\\dagger})\n$$\n$$\n\\hat{p} = i\\sqrt{\\frac{\\hbar m\\omega}{2}}(\\hat{a}^{\\dagger} - \\hat{a})\n$$\n一维量子谐振子的哈密顿量可以写作 $\\hat{H}_{1D} = \\hbar\\omega(\\hat{a}^{\\dagger}\\hat{a} + \\frac{1}{2})$，其中 $\\hat{n} = \\hat{a}^{\\dagger}\\hat{a}$ 是数算符，其本征值为 $n = 0, 1, 2, \\dots$。一个算符 $\\hat{O}$ 的热平均值由 $\\langle \\hat{O} \\rangle = \\mathrm{Tr}[\\hat{O} \\exp(-\\beta \\hat{H}_{1D})] / Z_{1D}$ 给出，其中 $Z_{1D} = \\mathrm{Tr}[\\exp(-\\beta \\hat{H}_{1D})]$。\n\n数算符的热平均值 $\\langle \\hat{n} \\rangle$ 对应于谐振子模式的平均占据数，它遵循单个玻色子模式的玻色-爱因斯坦分布：\n$$\n\\langle \\hat{n} \\rangle = \\frac{1}{\\exp(\\beta\\hbar\\omega) - 1}\n$$\n\n现在我们计算 $\\hat{q}^2$ 和 $\\hat{p}^2$ 的期望值。\n我们从 $\\langle \\hat{q}^2 \\rangle_{1D}$ 开始：\n$$\n\\hat{q}^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a} + \\hat{a}^{\\dagger})^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + \\hat{a}\\hat{a}^{\\dagger} + \\hat{a}^{\\dagger}\\hat{a} + (\\hat{a}^{\\dagger})^2)\n$$\n使用对易关系 $[\\hat{a}, \\hat{a}^{\\dagger}] = 1$，我们有 $\\hat{a}\\hat{a}^{\\dagger} = \\hat{a}^{\\dagger}\\hat{a} + 1$。将此代入 $\\hat{q}^2$ 的表达式中：\n$$\n\\hat{q}^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + (\\hat{a}^{\\dagger}\\hat{a} + 1) + \\hat{a}^{\\dagger}\\hat{a} + (\\hat{a}^{\\dagger})^2) = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + (\\hat{a}^{\\dagger})^2 + 2\\hat{a}^{\\dagger}\\hat{a} + 1)\n$$\n在计算热平均时，即在能量本征基 $|n\\rangle$ 上取迹，$\\hat{a}^2$ 和 $(\\hat{a}^{\\dagger})^2$ 项的对角元为零，因此它们的迹为零。所以，只有含 $\\hat{a}^{\\dagger}\\hat{a} = \\hat{n}$ 的项和常数项有贡献：\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{2m\\omega} \\langle 2\\hat{n} + 1 \\rangle = \\frac{\\hbar}{m\\omega} \\left(\\langle \\hat{n} \\rangle + \\frac{1}{2}\\right)\n$$\n代入 $\\langle \\hat{n} \\rangle$ 的表达式：\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{m\\omega} \\left(\\frac{1}{\\exp(\\beta\\hbar\\omega) - 1} + \\frac{1}{2}\\right) = \\frac{\\hbar}{2m\\omega} \\left(\\frac{2 + \\exp(\\beta\\hbar\\omega) - 1}{\\exp(\\beta\\hbar\\omega) - 1}\\right) = \\frac{\\hbar}{2m\\omega} \\frac{\\exp(\\beta\\hbar\\omega) + 1}{\\exp(\\beta\\hbar\\omega) - 1}\n$$\n这个表达式可以用双曲余切函数的定义来简化，$\\coth(x) = \\frac{\\exp(x) + \\exp(-x)}{\\exp(x) - \\exp(-x)} = \\frac{\\exp(2x) + 1}{\\exp(2x) - 1}$：\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{2m\\omega} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n那么，三维各向同性量子谐振子的平均势能为：\n$$\n\\langle \\hat{E}_{\\mathrm{pot}} \\rangle = 3 \\left\\langle \\frac{1}{2} m\\omega^2 \\hat{q}^2 \\right\\rangle_{1D} = 3 \\cdot \\frac{1}{2} m\\omega^2 \\left[ \\frac{\\hbar}{2m\\omega} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) \\right] = \\frac{3\\hbar\\omega}{4} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n\n类似地，我们计算 $\\langle \\hat{p}^2 \\rangle_{1D}$：\n$$\n\\hat{p}^2 = (i)^2 \\frac{\\hbar m\\omega}{2}(\\hat{a}^{\\dagger} - \\hat{a})^2 = -\\frac{\\hbar m\\omega}{2}((\\hat{a}^{\\dagger})^2 - \\hat{a}^{\\dagger}\\hat{a} - \\hat{a}\\hat{a}^{\\dagger} + \\hat{a}^2)\n$$\n使用 $\\hat{a}\\hat{a}^{\\dagger} = \\hat{a}^{\\dagger}\\hat{a} + 1$：\n$$\n\\hat{p}^2 = -\\frac{\\hbar m\\omega}{2}((\\hat{a}^{\\dagger})^2 - \\hat{a}^{\\dagger}\\hat{a} - (\\hat{a}^{\\dagger}\\hat{a} + 1) + \\hat{a}^2) = \\frac{\\hbar m\\omega}{2}(-(\\hat{a}^{\\dagger})^2 - \\hat{a}^2 + 2\\hat{a}^{\\dagger}\\hat{a} + 1)\n$$\n取热平均值，非对角项再次消失：\n$$\n\\langle \\hat{p}^2 \\rangle_{1D} = \\frac{\\hbar m\\omega}{2} \\langle 2\\hat{n} + 1 \\rangle = \\hbar m\\omega \\left(\\langle \\hat{n} \\rangle + \\frac{1}{2}\\right) = \\frac{\\hbar m\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n三维各向同性量子谐振子的平均动能为：\n$$\n\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = 3 \\left\\langle \\frac{\\hat{p}^2}{2m} \\right\\rangle_{1D} = 3 \\cdot \\frac{1}{2m} \\left[ \\frac{\\hbar m\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) \\right] = \\frac{3\\hbar\\omega}{4} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n这个结果证实了谐振子的量子维里定理，该定理规定 $\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle$。\n\n现在，我们在核量子效应（NQE）的背景下分析这些结果。\n\n1.  **经典极限（$T \\to \\infty$，或 $\\beta \\to 0$）：**\n    在此极限下，余切函数的自变量 $x = \\beta\\hbar\\omega/2$ 趋近于零。当 $x$ 很小时，$\\coth(x)$ 的泰勒展开为 $\\coth(x) \\approx 1/x$。\n    $$\n    \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle \\approx \\frac{3\\hbar\\omega}{4} \\left( \\frac{1}{\\beta\\hbar\\omega/2} \\right) = \\frac{3\\hbar\\omega}{4} \\frac{2}{\\beta\\hbar\\omega} = \\frac{3}{2\\beta} = \\frac{3}{2}k_B T\n    $$\n    这正是经典能量均分定理的结果，即三个动能和三个势能的二次自由度各对平均能量贡献 $\\frac{1}{2}k_B T$，因此动能和势能的总贡献分别为 $\\frac{3}{2}k_B T$。\n\n2.  **量子极限与核量子效应（$T \\to 0$，或 $\\beta \\to \\infty$）：**\n    在此极限下，$x = \\beta\\hbar\\omega/2 \\to \\infty$，且 $\\coth(x) \\to 1$。\n    $$\n    \\lim_{T\\to 0} \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\lim_{T\\to 0} \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = \\frac{3\\hbar\\omega}{4}\n    $$\n    这揭示了即使在绝对零度下也存在非零能量。总能量 $\\langle \\hat{H} \\rangle = \\langle \\hat{E}_{\\mathrm{kin}} \\rangle + \\langle \\hat{E}_{\\mathrm{pot}} \\rangle$ 趋近于 $\\frac{3\\hbar\\omega}{2}$，这是三维各向同性量子谐振子的基态能，或称零点能（ZPE）。这个零点能是源于 Heisenberg 不确定性原理的核量子效应的直接体现。在经典情况下，$T=0$ 时的能量应为零。\n\n3.  **有限温度下的核量子效应：** 无量纲参数 $\\hbar\\omega/(k_B T)$ 决定了量子效应的重要性。\n    -   **零点贡献：** 我们可以重写能量表达式以明确显示零点能的贡献：\n        $$\n        \\coth\\left(\\frac{x}{2}\\right) = 1 + \\frac{2}{\\exp(x)-1}\n        $$\n        因此，\n        $$\n        \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = \\frac{3\\hbar\\omega}{4} \\left[ 1 + \\frac{2}{\\exp(\\beta\\hbar\\omega) - 1} \\right] = \\frac{3\\hbar\\omega}{4} + \\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}\n        $$\n        第一项 $\\frac{3\\hbar\\omega}{4}$ 是对动能和势能的恒定零点贡献。第二项是热贡献。\n    -   **热抑制：** 量子能量的热贡献部分总是小于经典热能。经典预测是 $\\frac{3}{2}k_B T$，可以写成 $\\frac{3}{2 \\beta}$。对动能/势能的量子热贡献是 $\\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}$。比较表明，对于任何有限温度（$T>0$），$\\exp(\\beta\\hbar\\omega) - 1 > \\beta\\hbar\\omega$ 成立，这意味着 $\\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}  \\frac{3}{2\\beta} = \\frac{3}{2}k_B T$。当 $k_B T \\ll \\hbar\\omega$ 时，这种抑制作用非常显著。在这种情况下，热能不足以布居到更高的振动能级，导致自由度被“冻结”。这使得热容在 $T \\to 0$ 时趋于零，与经典热容恒为 $3k_B$ 形成鲜明对比。\n\n总而言之，核量子效应表现为相对于经典值的一个恒定的正能量偏移（零点能），这在低温（$T \\ll \\hbar\\omega/k_B$）下尤为明显；同时，在所有有限温度下，与经典预测相比，系统吸收热能的能力受到抑制。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3 \\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right),  \\frac{3 \\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) \\end{pmatrix}}\n$$", "id": "3430050"}, {"introduction": "路径积分分子动力学（PIMD）将量子粒子巧妙地映射为一个经典的环状聚合物，但这并非一个完美的等式，其代价是Trotter离散化误差。这项练习将带你深入PIMD方法的核心，通过严谨的算符代数和Baker-Campbell-Hausdorff (BCH) 公式，推导对称Trotter分解所引入的主导误差项。完成这项推导将使你对PIMD模拟的收敛行为（误差与珠子数$P$的平方成反比）有更本质的认识，这是评估和提升模拟精度的关键。[@problem_id:3430011]", "problem": "考虑一个嵌入在凝聚相中的单量子核坐标，它可以近似为一个一维谐振子，其哈密顿量为 $H = T + V$，其中 $T = \\frac{p^{2}}{2 m}$，$V = \\frac{1}{2} m \\omega^{2} x^{2}$，$m$ 是核质量，$\\omega$ 是振子角频率，$x$ 是位置算符，$p$ 是动量算符。在路径积分分子动力学 (PIMD) 中，有限温度的量子玻尔兹曼算符 $\\exp(- \\beta H)$（其中 $\\beta$ 为逆温度）通过使用对称 Trotter 分解 (Strang 分裂) 表示为 $P$ 个虚时间片的乘积\n$$\n\\left[ \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\exp\\!\\left( - \\frac{\\beta}{P} T \\right) \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\right]^{P}.\n$$\n从正则对易关系 $[x, p] = i \\hbar$、Baker–Campbell–Hausdorff (BCH) 公式和算符代数出发，推导由有限数量的切片 $P$ 引起的量子配分函数中的主阶离散化误差。具体来说，在 $P$ 很大的极限下，求相对误差\n$$\n\\delta \\equiv \\frac{Z_{P} - Z}{Z},\n$$\n的渐近展开式中的主阶项，其中 $Z_{P}$ 是通过具有 $P$ 个切片的对称 Trotter 分解获得的配分函数，$Z$ 是精确的量子配分函数。您的推导必须从给定的哈密顿量开始，仅使用基本的对易关系和标准展开，并通过基于 BCH 的方法评估对称 Trotter 分裂误差。将 $\\delta$ 的最终结果表示为包含 $\\beta$、$\\hbar$、$\\omega$ 和 $P$ 的闭式解析表达式。不需要进行数值计算。请将您的最终答案以解析表达式的形式给出。如果需要任何中间热期望值，请使用量子谐振子的成熟公式来表示它们。最终答案必须是单个表达式。最终答案中不要包含单位。", "solution": "我们考虑一维量子谐振子，其哈密顿量为 $H = T + V$，其中 $T = \\frac{p^{2}}{2 m}$，$V = \\frac{1}{2} m \\omega^{2} x^{2}$。精确的量子配分函数为 $Z = \\mathrm{Tr} \\left( \\exp(- \\beta H) \\right)$。路径积分分子动力学 (PIMD) 通过使用对称 Trotter 分解将 $\\exp(- \\beta H)$ 近似为 $P$ 个因子的乘积：\n$$\nU_{P} \\equiv \\left[ \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\exp\\!\\left( - \\frac{\\beta}{P} T \\right) \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\right]^{P}.\n$$\n令 $\\epsilon \\equiv \\frac{\\beta}{P}$。对于单个对称 Trotter 步，\n$$\nS(\\epsilon) \\equiv \\exp\\!\\left( - \\frac{\\epsilon}{2} V \\right) \\exp\\!\\left( - \\epsilon T \\right) \\exp\\!\\left( - \\frac{\\epsilon}{2} V \\right).\n$$\n我们将 Baker–Campbell–Hausdorff (BCH) 公式应用于此对称乘积。关于 Strang 分裂的一个标准结果给出\n$$\nS(\\epsilon) = \\exp\\!\\left( - \\epsilon (T + V) + \\epsilon^{3} K + O(\\epsilon^{5}) \\right),\n$$\n其中 $K$ 是一个由 $T$ 和 $V$ 的嵌套对易子构成的算符。为简洁起见，记 $A \\equiv - V$ 和 $B \\equiv - T$，则 Strang 误差指数为\n$$\nK = \\frac{1}{24} \\left( [A, [A, B]] + 2 [B, [A, B]] \\right).\n$$\n因为 $[A, B] = [-V, -T] = [V, T]$，且对易子的线性性质意味着 $[A, [A, B]] = - [V, [V, T]]$ 和 $[B, [A, B]] = - [T, [V, T]]$，我们得到\n$$\nK = \\frac{1}{24} \\left( - [V, [V, T]] - 2 [T, [V, T]] \\right).\n$$\n现在我们使用 $[x, p] = i \\hbar$ 来计算谐振子的这些对易子。首先计算 $[V, T]$：\n\\begin{align*}\n[V, T] = \\left[ \\frac{1}{2} m \\omega^{2} x^{2}, \\frac{p^{2}}{2 m} \\right] = \\frac{1}{4} \\omega^{2} [x^{2}, p^{2}] \\\\\n[x^{2}, p^{2}] = x^{2} p^{2} - p^{2} x^{2} = 2 i \\hbar (x p + p x),\n\\end{align*}\n所以\n$$\n[V, T] = \\frac{i \\hbar \\omega^{2}}{2} (x p + p x).\n$$\n接下来计算 $[V, [V, T]]$。首先，\n\\begin{align*}\n[x^{2}, x p + p x] = [x^{2}, x p] + [x^{2}, p x] \\\\\n[x^{2}, x p] = 2 i \\hbar x^{2}, \\quad [x^{2}, p x] = 2 i \\hbar x^{2},\n\\end{align*}\n因此 $[x^{2}, x p + p x] = 4 i \\hbar x^{2}$。所以，\n\\begin{align*}\n[V, [V, T]] = \\frac{i \\hbar \\omega^{2}}{2} [V, x p + p x] = \\frac{i \\hbar \\omega^{2}}{2} \\left[ \\frac{1}{2} m \\omega^{2} x^{2}, x p + p x \\right] \\\\\n= \\frac{i \\hbar \\omega^{2}}{2} \\cdot \\frac{1}{2} m \\omega^{2} \\cdot 4 i \\hbar x^{2} = - \\hbar^{2} m \\omega^{4} x^{2}.\n\\end{align*}\n现在计算 $[T, [V, T]]$。首先，\n\\begin{align*}\n[p^{2}, x p + p x] = [p^{2}, x p] + [p^{2}, p x] \\\\\n[p^{2}, x p] = [p^{2}, x] p = (- 2 i \\hbar p) p = - 2 i \\hbar p^{2}, \\\\\n[p^{2}, p x] = p [p^{2}, x] = p (- 2 i \\hbar p) = - 2 i \\hbar p^{2},\n\\end{align*}\n所以 $[p^{2}, x p + p x] = - 4 i \\hbar p^{2}$。所以，\n\\begin{align*}\n[T, [V, T]] = \\frac{i \\hbar \\omega^{2}}{2} [T, x p + p x] = \\frac{i \\hbar \\omega^{2}}{2} \\left[ \\frac{p^{2}}{2 m}, x p + p x \\right] \\\\\n= \\frac{i \\hbar \\omega^{2}}{2} \\cdot \\frac{1}{2 m} \\cdot (- 4 i \\hbar p^{2}) = \\hbar^{2} \\frac{\\omega^{2}}{m} p^{2}.\n\\end{align*}\n将这些结果代入 $K$ 的表达式中，\n\\begin{align*}\nK = \\frac{1}{24} \\left( - [V, [V, T]] - 2 [T, [V, T]] \\right) \\\\\n= \\frac{1}{24} \\left( - ( - \\hbar^{2} m \\omega^{4} x^{2} ) - 2 \\left( \\hbar^{2} \\frac{\\omega^{2}}{m} p^{2} \\right) \\right) \\\\\n= \\frac{\\hbar^{2}}{24} \\left( m \\omega^{4} x^{2} - 2 \\frac{\\omega^{2}}{m} p^{2} \\right).\n\\end{align*}\n完整的 $P$ 步乘积为\n$$\nU_{P} = \\left( S(\\epsilon) \\right)^{P} = \\exp\\!\\left( - \\beta H + P \\epsilon^{3} K + O(P \\epsilon^{5}) \\right).\n$$\n使用 $\\epsilon = \\frac{\\beta}{P}$，我们有 $P \\epsilon^{3} = \\frac{\\beta^{3}}{P^{2}}$。因此，\n$$\nU_{P} = \\exp\\!\\left( - \\beta H + \\frac{\\beta^{3}}{P^{2}} K + O\\!\\left( \\frac{\\beta^{5}}{P^{4}} \\right) \\right).\n$$\n相应的配分函数为\n$$\nZ_{P} = \\mathrm{Tr} \\left( U_{P} \\right) = \\mathrm{Tr} \\left( \\exp\\!\\left( - \\beta H \\right) \\exp\\!\\left( \\frac{\\beta^{3}}{P^{2}} K + \\cdots \\right) \\right).\n$$\n对于 $\\frac{1}{P^{2}}$ 的主阶项，展开 $K$ 的指数并利用迹的循环不变性：\n\\begin{align*}\nZ_{P} = \\mathrm{Tr} \\left( \\exp( - \\beta H ) \\left[ 1 + \\frac{\\beta^{3}}{P^{2}} K + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right) \\right] \\right) \\\\\n= Z + \\frac{\\beta^{3}}{P^{2}} \\mathrm{Tr} \\left( \\exp( - \\beta H ) K \\right) + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right),\n\\end{align*}\n所以相对误差为\n$$\n\\delta \\equiv \\frac{Z_{P} - Z}{Z} = \\frac{\\beta^{3}}{P^{2}} \\left\\langle K \\right\\rangle_{\\beta} + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right),\n$$\n其中 $\\left\\langle \\cdot \\right\\rangle_{\\beta}$ 表示关于 $H$ 的正则热期望值。使用 $K$ 的表达式，\n$$\n\\left\\langle K \\right\\rangle_{\\beta} = \\frac{\\hbar^{2}}{24} \\left( m \\omega^{4} \\left\\langle x^{2} \\right\\rangle_{\\beta} - 2 \\frac{\\omega^{2}}{m} \\left\\langle p^{2} \\right\\rangle_{\\beta} \\right).\n$$\n对于量子谐振子，其成熟的热平均值为\n$$\n\\left\\langle x^{2} \\right\\rangle_{\\beta} = \\frac{\\hbar}{2 m \\omega} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right), \\quad \\left\\langle p^{2} \\right\\rangle_{\\beta} = \\frac{m \\hbar \\omega}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right).\n$$\n将这些代入 $\\left\\langle K \\right\\rangle_{\\beta}$，\n\\begin{align*}\nm \\omega^{4} \\left\\langle x^{2} \\right\\rangle_{\\beta} = m \\omega^{4} \\cdot \\frac{\\hbar}{2 m \\omega} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) = \\frac{\\hbar \\omega^{3}}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right), \\\\\n\\frac{\\omega^{2}}{m} \\left\\langle p^{2} \\right\\rangle_{\\beta} = \\frac{\\omega^{2}}{m} \\cdot \\frac{m \\hbar \\omega}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) = \\frac{\\hbar \\omega^{3}}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right).\n\\end{align*}\n因此，\n\\begin{align*}\n\\left\\langle K \\right\\rangle_{\\beta} = \\frac{\\hbar^{2}}{24} \\left( \\frac{\\hbar \\omega^{3}}{2} - 2 \\cdot \\frac{\\hbar \\omega^{3}}{2} \\right) \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) \\\\\n= - \\frac{\\hbar^{3} \\omega^{3}}{48} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right).\n\\end{align*}\n于是，主阶相对误差为\n$$\n\\delta = - \\frac{\\beta^{3}}{P^{2}} \\frac{\\hbar^{3} \\omega^{3}}{48} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right).\n$$\n舍去高阶项，即可得到所要求的、用于谐振子量子配分函数的对称 Trotter 分解的主阶离散化误差的闭式解析表达式。", "answer": "$$\\boxed{- \\frac{\\beta^{3} \\hbar^{3} \\omega^{3}}{48 P^{2}} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right)}$$", "id": "3430011"}, {"introduction": "理论的价值最终体现在实践中。任何PIMD模拟的执行者都面临一个核心问题：需要多少“珠子”$P$才能准确地捕捉核量子效应？这项编码实践将理论付诸行动，你将编写程序来系统地研究路径积分计算的能量如何随$P$收敛，并检验一个常用的$P$取值“经验法则”在模拟液态水和甲烷等不同体系时的有效性。通过这个过程，你不仅能掌握验证模拟参数的关键技能，还能直观地理解不同材料的振动谱特性如何决定了模拟NQE的计算成本。[@problem_id:3430035]", "problem": "您必须编写一个完整且可运行的程序，该程序使用振动模式的谐波近似，对凝聚相中核量子效应的路径积分珠子数进行第一性原理收敛性研究。该程序必须实现一个基于不等式 $P_{\\text{beads}} \\gtrsim \\beta \\hbar \\omega_{\\max}$ 的判据，并测试其在代表液态水和甲烷的非均匀模式谱上的充分性。该研究必须基于以下基本原理和要求构建。\n\n从一组角频率为 $\\{\\omega_i\\}$ 的独立一维谐振子的正则量子配分函数 $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ 开始。每个模式的精确量子平均能量可以根据广为接受的量子统计力学原理获得。对于使用路径积分分子动力学（PIMD）的收敛路径积分离散化，珠子数 $P_{\\text{beads}}$ 控制着 Trotter 分解误差。使用虚时路径积分在 $P$ 个切片中的原始 Trotter 分解和环状聚合物表示法。谐振子的离散化配分函数可以表示为珠子坐标的多维高斯函数，通过对角化为环状聚合物简正模式可以精确积分。对于有限的 $P$，必须通过对离散化配分函数对 $\\beta$ 求导来计算平均能量，而不能采用随机抽样。除了二次型的对角化和 $\\ln Z$ 对 $\\beta$ 的求导法则外，不要假定任何快捷公式。您必须使用国际单位制（SI）中的常数 $\\hbar$ 和玻尔兹曼常数 $k_{\\mathrm{B}}$。\n\n您的程序必须为每个测试案例执行以下步骤。\n1. 使用公式 $\\omega = 2\\pi c \\tilde{\\nu}$（其中 $c$ 的单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$），将所有以波数 $\\mathrm{cm}^{-1}$ 为单位的振动模式输入转换为以 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 为单位的角频率。\n2. 对于给定的温度 $T$（单位为开尔文），计算 $\\beta = 1/(k_{\\mathrm{B}} T)$，单位为 $\\mathrm{J}^{-1}$。\n3. 通过对所有模式的精确谐振子能量求和，计算独立模式系统的精确总量子平均能量 $E_{\\text{exact,tot}}$。\n4. 通过计算环状聚合物表示的离散高斯积分并对 $-\\partial \\ln Z_P/\\partial \\beta$ 求导，计算总能量的有限-$P$ 离散近似值 $E_{P,\\text{tot}}$。您必须对任何正整数 $P$ 确定性地获得 $E_{P,\\text{tot}}$，而不使用蒙特卡洛采样。\n5. 将经验法则珠子数定义为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是模式集中的最大角频率，$\\lceil \\cdot \\rceil$ 表示向上取整到下一个整数。强制要求 $P_{\\text{rule}} \\ge 1$。\n6. 对于总相对误差的指定容差 $\\delta_{\\text{tot}}$ 和最差单模式相对误差的指定容差 $\\delta_{\\text{single}}$，确定：\n   a. 满足 $\\left|E_{P,\\text{tot}} - E_{\\text{exact,tot}}\\right|/E_{\\text{exact,tot}} \\le \\delta_{\\text{tot}}$ 的最小珠子数 $P_{\\text{tot}}$。\n   b. 满足 $\\max_i \\left( \\left|E_{P}(\\omega_i) - E_{\\text{exact}}(\\omega_i)\\right|/E_{\\text{exact}}(\\omega_i) \\right) \\le \\delta_{\\text{single}}$ 的最小珠子数 $P_{\\text{worst}}$。\n7. 通过检查在 $P = P_{\\text{rule}}$ 时对应的相对误差，评估两个布尔值：经验法则珠子数 $P_{\\text{rule}}$ 是否满足总误差标准，以及是否满足最差模式标准。\n8. 将过度因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$ 报告为一个浮点数。\n\n所有物理常数必须采用国际单位制（SI）：$\\hbar$ 的单位为 $\\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}}$ 的单位为 $\\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c$ 的单位为 $\\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。输入中的所有频率均以 $\\mathrm{cm}^{-1}$ 为单位，使用前必须转换为角频率（单位为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$）。温度以开尔文为单位。\n\n测试套件由四个案例组成，每个案例由一个元组 $(T, \\{\\tilde{\\nu}_i\\}, \\delta_{\\text{tot}}, \\delta_{\\text{single}})$ 定义，其中 $T$ 是温度（单位：开尔文），$\\{\\tilde{\\nu}_i\\}$ 是波数列表（单位：$\\mathrm{cm}^{-1}$），容差是无量纲的小数。\n1. 案例1（类似液态水，300开尔文）：$T = 300$，$\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$，$\\delta_{\\text{tot}} = 0.01$，$\\delta_{\\text{single}} = 0.01$。\n2. 案例2（类似甲烷，300开尔文）：$T = 300$，$\\{\\tilde{\\nu}_i\\} = [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200]$，$\\delta_{\\text{tot}} = 0.01$，$\\delta_{\\text{single}} = 0.01$。\n3. 案例3（类似液态水，100开尔文）：$T = 100$，$\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$，$\\delta_{\\text{tot}} = 0.01$，$\\delta_{\\text{single}} = 0.01$。\n4. 案例4（低频边界，300开尔文）：$T = 300$，$\\{\\tilde{\\nu}_i\\} = [100, 200, 300, 400, 500, 600]$，$\\delta_{\\text{tot}} = 0.01$，$\\delta_{\\text{single}} = 0.01$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试案例，输出一个包含六个元素的列表，顺序为 $[P_{\\text{tot}}, P_{\\text{worst}}, P_{\\text{rule}}, \\text{pass}_{\\text{tot}}, \\text{pass}_{\\text{worst}}, \\mathcal{O}]$，其中前三个是整数，接下来两个是布尔值，最后一个是浮点数。因此，总输出应为包含四个此类列表的列表，针对四个测试案例，以单行形式打印，例如 $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$。不应打印任何额外文本。所有角度在构造上都以弧度为单位，输出中不出现其他单位，因为报告的量是无量纲的或计数。所有百分比类型的比较必须按规定作为小数处理（例如，百分之一为 $0.01$）。", "solution": "该解决方案围绕量子统计力学原理和量子系统的路径积分表述构建。问题的核心是确定独立谐振子系统的路径积分表示法相对于离散化中使用的珠子数 $P$ 的收敛性。\n\n**1. 基本理论**\n\n**1.1. 谐振子的精确量子能量**\n\n对于角频率为 $\\omega$ 的单个量子谐振子，其能级由 $E_n = \\hbar\\omega(n + 1/2)$ 给出，其中 $n=0, 1, 2, \\dots$。在逆温 $\\beta = 1/(k_B T)$ 下，正则配分函数 $Z_{\\text{exact}}$ 是对所有状态的求和：\n$$ Z_{\\text{exact}}(\\omega) = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta\\hbar\\omega(n+1/2)} = \\frac{e^{-\\beta\\hbar\\omega/2}}{1 - e^{-\\beta\\hbar\\omega}} = \\frac{1}{2\\sinh(\\beta\\hbar\\omega/2)} $$\n平均能量 $E_{\\text{exact}}(\\omega)$ 通过对配分函数的对数就 $\\beta$ 求导得到：\n$$ E_{\\text{exact}}(\\omega) = -\\frac{\\partial \\ln Z_{\\text{exact}}(\\omega)}{\\partial \\beta} = \\frac{\\hbar\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) $$\n此表达式给出了单个谐振子模式的精确量子力学平均能量。对于一个由频率为 $\\{\\omega_i\\}$ 的独立谐振子组成的系统，总的精确能量就是对所有模式的能量求和：\n$$ E_{\\text{exact,tot}} = \\sum_i E_{\\text{exact}}(\\omega_i) $$\n\n**1.2. 路径积分离散化能量**\n\n路径积分表述将一个量子粒子表示为一个由 $P$ 个珠子组成的经典“环状聚合物”。使用谐振子的原始 Trotter 分解，离散化配分函数 $Z_P$ 可以写成关于珠子位置 $\\mathbf{x} = (x_1, \\dots, x_P)$ 的多维高斯积分。这个积分可以通过对指数中的二次型进行对角化来精确求解，这对应于向环状聚合物简正模式的变换。\n\n按照要求，推导过程是通过对得到的 $\\ln Z_P$ 的闭合形式表达式进行微分。质量为 $m$ 的粒子在谐势中的离散化配分函数为：\n$$ Z_P = \\left( \\frac{mP}{2\\pi\\beta\\hbar^2} \\right)^{P/2} \\int d\\mathbf{x} \\exp\\left( -\\sum_{s=1}^P \\left[ \\frac{mP}{2\\beta\\hbar^2}(x_s - x_{s+1})^2 + \\frac{\\beta m\\omega^2}{2P}x_s^2 \\right] \\right) $$\n其中 $x_{P+1} \\equiv x_1$。指数中的项是一个二次型 $-\\frac{1}{2}\\mathbf{x}^T \\mathbf{A} \\mathbf{x}$。矩阵 $\\mathbf{A}$ 是一个循环矩阵，其特征值 $\\lambda_k$（对于 $k=0, \\dots, P-1$）为：\n$$ \\lambda_k = \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} $$\n该积分的计算结果为 $(2\\pi)^{P/2}(\\det \\mathbf{A})^{-1/2} = (2\\pi)^{P/2} (\\prod_k \\lambda_k)^{-1/2}$。这导出了配分函数的表达式：\n$$ Z_P = \\left(\\frac{mP}{\\beta\\hbar^2}\\right)^{P/2} \\left(\\prod_{k=0}^{P-1} \\lambda_k\\right)^{-1/2} $$\n取对数得到：\n$$ \\ln Z_P = \\frac{P}{2}\\ln\\left(\\frac{mP}{\\beta\\hbar^2}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\ln\\left( \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} \\right) $$\n能量 $E_P(\\omega)$ 通过计算 $-\\partial(\\ln Z_P)/\\partial\\beta$ 得到。在进行微分和简化后，可以获得“热力学”能量估计量：\n$$ E_P(\\omega) = \\frac{P}{2\\beta} + \\frac{1}{2} \\sum_{k=0}^{P-1} \\frac{\\frac{4P}{\\beta^2\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) - \\frac{\\omega^2}{P}}{\\frac{4P}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta \\omega^2}{P}} $$\n注意，质量 $m$ 被消去了，这与谐振子的性质仅依赖于 $\\omega$ 的预期相符。这个公式是确定性的，允许在不使用随机抽样的情况下，计算任何有限珠子数 $P$ 的能量。一组模式的总能量是其和 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$。\n\n**2. 算法实现**\n\n该程序实现了上述理论框架，以执行所要求的收敛性研究。\n\n**步骤 1：初始化**\n物理常数按规定使用国际单位制定义：$\\hbar = 1.054571817 \\times 10^{-34} \\, \\mathrm{J}\\cdot\\mathrm{s}$， $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\cdot\\mathrm{K}^{-1}$，以及 $c = 2.99792458 \\times 10^{10} \\, \\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。\n\n**步骤 2：输入转换**\n对于每个测试案例，使用温度 $T$ 计算 $\\beta = 1/(k_B T)$。使用关系式 $\\omega = 2\\pi c \\tilde{\\nu}$ 将振动波数 $\\{\\tilde{\\nu}_i\\}$（单位 $\\mathrm{cm}^{-1}$）转换为角频率 $\\{\\omega_i\\}$（单位 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$）。\n\n**步骤 3：精确和近似能量计算**\n实现了使用推导出的公式计算 $E_{\\text{exact}}(\\omega)$ 和 $E_P(\\omega)$ 的函数。这些函数使用 `numpy` 进行矢量化，以同时高效地计算整个频率集 $\\{\\omega_i\\}$ 的能量。\n\n**步骤 4：收敛性分析**\n从 $P=1$ 开始启动一个搜索循环。在每次迭代中，程序计算总 PIMD 能量 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$ 和单个模式能量 $E_P(\\omega_i)$。然后计算相对误差：\n- 总相对误差：$\\epsilon_{\\text{tot}}(P) = |E_{P,\\text{tot}} - E_{\\text{exact,tot}}| / E_{\\text{exact,tot}}$\n- 最差模式相对误差：$\\epsilon_{\\text{worst}}(P) = \\max_i(|E_P(\\omega_i) - E_{\\text{exact}}(\\omega_i)| / E_{\\text{exact}(\\omega_i)})$\n\n循环继续进行，递增 $P$，直到找到满足 $\\epsilon_{\\text{tot}}(P_{\\text{tot}}) \\le \\delta_{\\text{tot}}$ 和 $\\epsilon_{\\text{worst}}(P_{\\text{worst}}) \\le \\delta_{\\text{single}}$ 的最小 $P_{\\text{tot}}$ 和 $P_{\\text{worst}}$ 值。\n\n**步骤 5：经验法则评估**\n启发式珠子数 $P_{\\text{rule}}$ 计算为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是集合中的最高频率。强制规定最小值为 1。然后通过计算在 $P=P_{\\text{rule}}$ 时的总相对误差和最差模式相对误差，并检查它们是否满足指定的容差（$\\delta_{\\text{tot}}$ 和 $\\delta_{\\text{single}}$），来测试此规则的性能。\n\n**步骤 6：报告**\n最后，将每个测试案例的结果——$P_{\\text{tot}}$、$P_{\\text{worst}}$、$P_{\\text{rule}}$、两个布尔通过/失败检查，以及过度因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$——收集并格式化为最终输出所需的列表的列表结构。", "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to run the PIMD convergence study for all test cases.\n    \"\"\"\n    \n    # Physical constants in SI units, except for c as specified\n    HBAR = 1.054571817e-34  # J.s\n    KB = 1.380649e-23        # J/K\n    C_CMS = 2.99792458e10   # cm/s\n\n    test_cases = [\n        # Case 1 (water-like at 300 K)\n        (300, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 2 (methane-like at 300 K)\n        (300, [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200], 0.01, 0.01),\n        # Case 3 (water-like at 100 K)\n        (100, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 4 (low-frequency at 300 K)\n        (300, [100, 200, 300, 400, 500, 600], 0.01, 0.01),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        T_kelvin, nu_cm_inv, delta_tot, delta_single = case\n        \n        # 1. Convert inputs\n        beta = 1.0 / (KB * T_kelvin)\n        omegas = 2.0 * np.pi * C_CMS * np.array(nu_cm_inv)\n        \n        # 3. Compute exact energies\n        def calc_E_exact(omega_arr, beta_val, hbar_val):\n            x = beta_val * hbar_val * omega_arr / 2.0\n            # Handle potential overflow in np.exp(2*x) for coth(x)\n            large_x_mask = x > 35\n            coth_x = np.zeros_like(x)\n            # For large x, coth(x) is 1\n            coth_x[large_x_mask] = 1.0\n            # For other x, use standard definition\n            non_large_x = ~large_x_mask\n            # Avoid division by zero if x is very small sinh(x->0) -> 0\n            small_x_mask = x  1e-8\n            x_safe = np.copy(x[non_large_x])\n            x_safe[x_safe  1e-8] = 1e-8 # Prevent division by zero, coth(x) ~ 1/x for small x\n            coth_x[non_large_x] = np.cosh(x_safe) / np.sinh(x_safe)\n            return (hbar_val * omega_arr / 2.0) * coth_x\n\n        E_exact_per_mode = calc_E_exact(omegas, beta, HBAR)\n        E_exact_tot = np.sum(E_exact_per_mode)\n\n        # 4. PIMD energy calculator\n        def calc_E_P(omega_arr, beta_val, P, hbar_val):\n            k = np.arange(P)\n            sin_k = np.sin(np.pi * k / P)\n            sin_k_sq = sin_k**2\n            \n            omega_arr_sq = omega_arr[:, np.newaxis]**2\n\n            num_part1 = omega_arr_sq / P\n            num_part2 = (4 * P / (beta_val**2 * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            numerator = num_part2 - num_part1\n            \n            den_part1 = (beta_val / P) * omega_arr_sq\n            den_part2 = (4 * P / (beta_val * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            denominator = den_part1 + den_part2\n            \n            sum_term = np.sum(numerator / denominator, axis=1)\n            \n            E_p_per_mode = P / (2 * beta_val) + 0.5 * sum_term\n            return E_p_per_mode, np.sum(E_p_per_mode)\n\n        # 5. Rule-of-thumb bead count\n        omega_max = np.max(omegas) if omegas.size > 0 else 0\n        P_rule_float = beta * HBAR * omega_max\n        P_rule = max(1, math.ceil(P_rule_float))\n\n        # 6. Find minimal P_tot and P_worst\n        P = 1\n        P_tot, P_worst = None, None\n        \n        while P_tot is None or P_worst is None:\n            E_p_per_mode, E_p_tot = calc_E_P(omegas, beta, P, HBAR)\n            \n            if P_tot is None:\n                rel_err_tot = np.abs(E_p_tot - E_exact_tot) / E_exact_tot\n                if rel_err_tot = delta_tot:\n                    P_tot = P\n            \n            if P_worst is None:\n                rel_err_per_mode = np.abs(E_p_per_mode - E_exact_per_mode) / E_exact_per_mode\n                max_rel_err = np.max(rel_err_per_mode)\n                if max_rel_err = delta_single:\n                    P_worst = P\n\n            P += 1\n            if P > 500:\n                 if P_tot is None: P_tot = -1\n                 if P_worst is None: P_worst = -1\n                 break\n\n        # 7. Evaluate P_rule\n        E_prule_per_mode, E_prule_tot = calc_E_P(omegas, beta, P_rule, HBAR)\n        \n        err_tot_at_prule = np.abs(E_prule_tot - E_exact_tot) / E_exact_tot\n        pass_tot = err_tot_at_prule = delta_tot\n        \n        err_worst_at_prule = np.max(np.abs(E_prule_per_mode - E_exact_per_mode) / E_exact_per_mode)\n        pass_worst = err_worst_at_prule = delta_single\n        \n        # 8. Overkill factor\n        overkill = float(P_rule) / P_tot if P_tot != 0 else float('inf')\n\n        all_results.append([P_tot, P_worst, P_rule, pass_tot, pass_worst, overkill])\n\n    # Format output string manually to match the exact requirement\n    # \"[[item1,item2,...],[item1,item2,...]]\" with no spaces.\n    list_of_list_strs = []\n    for res_list in all_results:\n        # Convert booleans to lowercase 'true'/'false'\n        res_list[3] = str(res_list[3]).lower()\n        res_list[4] = str(res_list[4]).lower()\n        str_items = [str(x) for x in res_list]\n        list_str = \"[\" + \",\".join(str_items) + \"]\"\n        list_of_list_strs.append(list_str)\n    final_output_str = \"[\" + \",\".join(list_of_list_strs) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```", "id": "3430035"}]}