{"hands_on_practices": [{"introduction": "WHAM的核心在于其自洽方程组，其中涉及对多个指数项求和。在计算机上直接实现这些方程时，尤其是在低温（即较大的 $\\beta$ 值）或存在强偏置势的情况下，指数项的参数可能变得非常大，导致浮点数溢出。本练习将指导您推导一种数值上稳定的方法，即“log-sum-exp”技巧，来计算这些项，确保您的代码在各种条件下都能稳健运行。[@problem_id:3461097]", "problem": "考虑一组在恒定温度 $T$ 和逆热能 $\\beta = 1/(k_B T)$ 下进行的 $K$ 次有偏分子动力学 (MD) 模拟，其中 $k_B$ 是玻尔兹曼常数。每次模拟 $k$ 都会对一个标量集体变量 $s$ 施加一个偏置势 $W_k(s)$。设 $s$ 被离散化为由索引 $i$ 标记的区间（bin），区间中心为 $s_i$。加权直方图分析方法 (WHAM) 结合这些模拟来估计 $s$ 上的无偏概率分布。在此背景下，针对区间 $i$ 的 WHAM 重加权涉及一个分母，该分母聚合了所有模拟的贡献，定义为\n$$\nD_i = \\sum_{k=1}^{K} n_k \\exp\\!\\left[\\beta f_k - \\beta W_k(s_i)\\right],\n$$\n其中 $n_k \\geq 1$ 是模拟 $k$ 贡献的非相关样本数，$f_k$ 是通过 WHAM 内的自洽性确定的折合自由能偏移量。对于大的 $\\beta$ 或陡峭的偏置势 $W_k(s)$，由于指数项中存在大的正参数，直接计算 $D_i$ 可能会发生上溢。从正则系综以及指数和对数的基本性质（$\\exp(\\cdot)$ 的单调性和恒等式 $\\ln(\\exp(x)) = x$）出发，通过对指数进行重新中心化，推导一个数值稳定的 $\\ln D_i$ 表达式，以避免上溢和下溢，同时不改变 $D_i$ 的值。你的推导必须只引入 $D_i$ 定义中已有的量，并使用标准数值库中可用的基本运算。请提供 $\\ln D_i$ 的最终封闭形式解析表达式，该表达式仅用 $\\beta$、$f_k$、$W_k(s_i)$ 和 $n_k$ 表示。无需四舍五入，最终答案中不应包含任何物理单位。", "solution": "问题要求推导加权直方图分析方法 (WHAM) 分母的自然对数 $\\ln(D_i)$ 的一个数值稳定的表达式。给定的 $D_i$ 表达式为：\n$$\nD_i = \\sum_{k=1}^{K} n_k \\exp\\!\\left[\\beta f_k - \\beta W_k(s_i)\\right]\n$$\n这里，$\\beta$ 是逆热能，$n_k$ 是来自模拟 $k$ 的样本数，$f_k$ 是模拟 $k$ 的折合自由能偏移量，$W_k(s_i)$ 是模拟 $k$ 的偏置势在区间 $i$ 中心处的值。\n\n当指数函数的参数 $\\beta f_k - \\beta W_k(s_i)$ 对于任何模拟 $k$ 是一个大的正数时，就会出现挑战。在这种情况下，项 $\\exp[\\beta f_k - \\beta W_k(s_i)]$ 可能会超出计算机的浮点表示能力，这种情况被称为数值上溢。直接计算 $D_i$ 然后再取对数将会失败。\n\n为了推导 $\\ln(D_i)$ 的稳定表达式，我们可以使用一种常见的代数技巧，通常称为“log-sum-exp”技巧。这包括找出和中的最大指数，将其因子分解出来，然后应用对数的性质。这个过程不会改变 $D_i$ 的数学值，而是将计算重构成一种数值稳定的形式。\n\n我们将第 $k$ 项的指数定义为 $A_k(s_i) = \\beta f_k - \\beta W_k(s_i)$。$D_i$ 的表达式变为：\n$$\nD_i = \\sum_{k=1}^{K} n_k \\exp(A_k(s_i))\n$$\n现在，我们为每个区间 $i$ 定义一个常数 $C_i$，作为所有 $K$ 次模拟中这些指数的最大值：\n$$\nC_i = \\max_{k' \\in \\{1, \\dots, K\\}} \\left\\{ A_{k'}(s_i) \\right\\} = \\max_{k' \\in \\{1, \\dots, K\\}} \\left\\{ \\beta f_{k'} - \\beta W_{k'}(s_i) \\right\\}\n$$\n我们使用 $k'$ 作为最大化过程的哑索引，以区别于求和索引 $k$。\n\n现在我们可以通过在每个指数内加上和减去 $C_i$ 来重写 $D_i$ 的表达式。这是一个零操作，保持了每一项的值不变。\n$$\nD_i = \\sum_{k=1}^{K} n_k \\exp\\left[ A_k(s_i) - C_i + C_i \\right]\n$$\n使用指数的性质 $\\exp(a+b) = \\exp(a)\\exp(b)$，我们可以拆分指数项：\n$$\nD_i = \\sum_{k=1}^{K} n_k \\exp\\left[ A_k(s_i) - C_i \\right] \\exp(C_i)\n$$\n由于 $\\exp(C_i)$ 相对于求和索引 $k$ 是一个常数，它可以从求和中提取出来：\n$$\nD_i = \\exp(C_i) \\left( \\sum_{k=1}^{K} n_k \\exp\\left[ A_k(s_i) - C_i \\right] \\right)\n$$\n这个表达式在数学上与 $D_i$ 的原始定义完全相同。现在，我们可以对两边取自然对数来求 $\\ln(D_i)$：\n$$\n\\ln(D_i) = \\ln\\left( \\exp(C_i) \\left( \\sum_{k=1}^{K} n_k \\exp\\left[ A_k(s_i) - C_i \\right] \\right) \\right)\n$$\n使用对数的性质 $\\ln(xy) = \\ln(x) + \\ln(y)$，我们将两个因子分开：\n$$\n\\ln(D_i) = \\ln\\left( \\exp(C_i) \\right) + \\ln\\left( \\sum_{k=1}^{K} n_k \\exp\\left[ A_k(s_i) - C_i \\right] \\right)\n$$\n根据基本恒等式 $\\ln(\\exp(x)) = x$，第一项简化为 $C_i$：\n$$\n\\ln(D_i) = C_i + \\ln\\left( \\sum_{k=1}^{K} n_k \\exp\\left[ A_k(s_i) - C_i \\right] \\right)\n$$\n这种形式是数值稳定的。求和内部指数函数的参数现在是 $A_k(s_i) - C_i = A_k(s_i) - \\max_{k'}\\{A_{k'}(s_i)\\}$。根据最大值的定义，对于所有的 $k$，这个差值总是小于或等于零。因此，$\\exp[A_k(s_i) - C_i]$ 的值将在 $0$ 和 $1$ 之间，从而防止上溢。指数最大的那一项，其调整后的指数将为 $0$，得到 $\\exp(0)=1$，这保证了最终对数的参数至少为 $1$（因为 $n_k \\ge 1$），从而防止了对数运算的下溢。\n\n为了只用初始量来提供最终表达式，我们代入 $A_k(s_i)$ 和 $C_i$ 的完整表达式。由于 $\\beta > 0$，它可以从最大化运算中提取出来：\n$$\nC_i = \\beta \\max_{k' \\in \\{1, \\dots, K\\}} \\left\\{ f_{k'} - W_{k'}(s_i) \\right\\}\n$$\n将此式和 $A_k(s_i)$ 代入我们推导的表达式中，得到最终答案：\n$$\n\\ln(D_i) = \\beta \\max_{k' \\in \\{1, \\dots, K\\}} \\left\\{ f_{k'} - W_{k'}(s_i) \\right\\} + \\ln\\left( \\sum_{k=1}^{K} n_k \\exp\\left[ \\beta(f_k - W_k(s_i)) - \\beta \\max_{k'' \\in \\{1, \\dots, K\\}} \\left\\{ f_{k''} - W_{k''}(s_i) \\right\\} \\right] \\right)\n$$\n这个表达式提供了一种数值稳健的方法来计算 $\\ln(D_i)$，避免了直接计算原始公式时固有的上溢和下溢问题。", "answer": "$$\n\\boxed{\\beta \\max_{k' \\in \\{1, \\dots, K\\}} \\left( f_{k'} - W_{k'}(s_i) \\right) + \\ln\\left( \\sum_{k=1}^{K} n_k \\exp\\left( \\beta \\left( f_k - W_k(s_i) \\right) - \\beta \\max_{k'' \\in \\{1, \\dots, K\\}} \\left( f_{k''} - W_{k''}(s_i) \\right) \\right) \\right)}\n$$", "id": "3461097"}, {"introduction": "在分子模拟中，许多重要的集体变量（如二面角）具有周期性。如果在处理这类变量时，简单地将其视为一个线性区间，会在周期性边界处产生严重的计算伪影，从而得到错误的自由能形貌。本练习旨在引导您思考如何正确处理系统的环状拓扑结构，从使用最小镜像约定计算偏置势能，到正确地对数据进行分箱，这些都是对周期性系统进行可靠分析的关键步骤。[@problem_id:3461108]", "problem": "一个测量扭转角的一维集体变量 $s$ 是严格周期性的，周期为 $L$，因此物理上不同的状态对应于 $s \\in [0,L)$，并且两个值之间的距离是在圆上定义的。在伞形采样中，窗口 $i$ 施加一个以 $s_{0,i}$ 为中心的谐波偏置 $w_i(s)$，并根据逆温度为 $\\beta$、总势能为 $U(s) + w_i(s)$ 的正则系综进行构象采样。因此，窗口 $i$ 中的正则偏置概率密度与 $\\exp\\!\\left[-\\beta\\left(U(s)+w_i(s)\\right)\\right]$ 成正比，而无偏置的目标密度 $p(s)$ 与 $\\exp\\!\\left[-\\beta U(s)\\right]$ 成正比。加权直方图分析法试图通过对每个采样构象对各区间（bin）的贡献进行重加权，然后通过 $F(s) = -k_{\\mathrm{B}} T \\ln p(s)$（最多相差一个相加常数）来估计自由能 $F(s)$，从而从多个窗口重构 $p(s)$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n\n考虑中心 $s_{0,i}$ 位于周期性边界附近的伞形窗，例如对于小的 $\\Delta > 0$，$s_{0,i} \\approx L - \\Delta$。在采样过程中，许多构象的 $s$ 值会跨越边界，例如，在进行卷绕处理前，当连续表示时，值会略大于 $L$ 或略小于 $0$。您的任务是，从第一性原理出发，决定如何将来自这些样本的贡献计入跨越边界的直方图区间中，以及如何防止在重构的 $F(s)$ 中出现人为的不连续性。\n\n下列哪些程序在确保跨边界计数的科学一致性和防止 $F(s)$ 中出现人为不连续性方面是正确的？\n\nA. 在 $[0,L)$ 上建立直方图，不进行任何卷绕处理，将任何 $s>L$ 的样本分配到 $L$ 之外的区间，并在归一化期间丢弃这些贡献，以避免在边界处重复计数。\n\nB. 通过 $s' = s - L \\left\\lfloor s/L \\right\\rfloor$ 将每个采样的 $s$ 映射到其在 $[0,L)$ 中的代表值 $s'$，使用 $s'$ 分配直方图区间，并使用最小镜像距离 $d(s',s_{0,i}) = \\min_{n \\in \\mathbb{Z}} \\left| s' - s_{0,i} + nL \\right|$ 计算谐波偏置，从而使重加权因子在边界上平滑变化。\n\nC. 为强制实现连续性，将任何 $s$ 值位于任一边界的一个小阈值 $\\delta$ 内的样本复制到第一个和最后一个区间中，并将其权重在这两者之间取平均，以减少边界伪影。\n\nD. 从重加权的直方图估计 $F(s)$ 时，显式施加周期性约束 $F(0) = F(L)$，并且如果对 $p(s)$ 或 $F(s)$ 应用平滑处理，则使用在圆上定义、采用流形上的测地距离的核函数（即周期性核函数），而不是在区间上使用欧几里得核函数。\n\nE. 在分析期间，将任何靠近 $L$ 的窗口中心 $s_{0,i}$ 移动 $\\pm L$，使得 $|s - s_{0,i}|$ 看起来很小而无需使用最小镜像约定，并保持所有采样的 $s$ 值不被卷绕，以便直方图在 $s=0$ 和 $s=L$ 处有清晰的边界。\n\n选择所有适用的选项。", "solution": "首先验证问题陈述，以确保其在科学上是合理的、定义明确的且客观的。\n\n### 步骤 1：提取已知信息\n- **系统**：一个一维集体变量 $s$，严格周期性，周期为 $L$。\n- **状态空间**：物理上不同的状态对应于 $s \\in [0,L)$。距离度量定义在一个圆上。\n- **模拟方法**：使用伞形采样。\n- **偏置势**：窗口 $i$ 施加一个以 $s_{0,i}$ 为中心的谐波偏置 $w_i(s)$。\n- **系综**：在逆温度为 $\\beta = (k_{\\mathrm{B}} T)^{-1}$ 的正则系综中进行采样。\n- **偏置概率密度**：在窗口 $i$ 中，概率密度与 $\\exp[-\\beta(U(s)+w_i(s))]$ 成正比。\n- **无偏置概率密度**：目标量是 $p(s) \\propto \\exp[-\\beta U(s)]$。\n- **自由能**：自由能定义为 $F(s) = -k_{\\mathrm{B}} T \\ln p(s)$（最多相差一个相加常数）。\n- **分析方法**：使用加权直方图分析法（WHAM）重构 $p(s)$。\n- **挑战**：对于中心 $s_{0,i}$ 靠近周期性边界（例如 $s_{0,i} \\approx L$）的窗口，样本会跨越边界（例如 $s > L$ 或 $s  0$）。任务是确定处理这些样本的正确程序，以确保计数一致并防止 $F(s)$ 中出现人为的不连续性。\n\n### 步骤 2：使用提取的已知信息进行验证\n- **科学上合理**：该问题牢固地植根于统计力学和计算物理学的原理。伞形采样、加权直方图分析法（WHAM）、周期性集体变量（如二面角）的概念以及自由能的定义都是标准的且描述准确。处理周期性边界条件的挑战是分子模拟中一个真实且重要的问题。\n- **定义明确**：问题定义清晰。它要求找到处理分子模拟数据分析中一个特定、常见技术挑战的正确程序。目标明确，上下文也提供了足够的细节。\n- **客观**：问题陈述使用精确、客观和标准的科学术语表达。没有主观或含糊的陈述。\n\n该问题没有表现出任何无效性缺陷。它是计算分子科学领域中一个标准的、有效的问题。\n\n### 步骤 3：结论与行动\n问题陈述是**有效的**。将推导一个解答。\n\n### 周期性系统的原理推导\n\n问题的核心在于正确处理坐标 $s$ 是周期性的系统。集体变量的空间不是实线 $\\mathbb{R}$，而是一个周长为 $L$ 的圆 $S^1$。所有物理量和数学运算都必须尊重这种拓扑结构。\n\n1.  **拓扑等价性**：如果对于某个整数 $n \\in \\mathbb{Z}$，有 $s_1 = s_2 + nL$，那么任意两点 $s_1$ 和 $s_2$ 在物理上是相同的。因此，任何物理状态的单值函数，如无偏置势能 $U(s)$ 和自由能 $F(s)$，都必须是周期为 $L$ 的周期函数：$U(s) = U(s+L)$ 和 $F(s) = F(s+L)$。\n\n2.  **距离度量**：圆上两点 $s_a$ 和 $s_b$ 之间的距离是它们之间最短的弧长。这被称为最小镜像距离，由 $d(s_a, s_b) = \\min_{n \\in \\mathbb{Z}} |s_a - s_b + nL|$ 给出。一个谐波偏置势 $w_i(s) = \\frac{1}{2}k_i (\\text{distance from } s_{0,i})^2$ 必须使用这个度量，才能成为圆上的一个平滑且物理上有意义的函数：$w_i(s) = \\frac{1}{2}k_i [d(s, s_{0,i})]^2$。使用简单的欧几里得距离 $|s - s_{0,i}|$ 会为中心靠近周期性边界的窗口在边界处产生一个非物理的能量尖峰。\n\n3.  **直方图分箱**：模拟轨迹产生一系列 $s$ 值，这些值通常是“未卷绕”的，可能会落在基本域 $[0, L)$ 之外。为了在圆上构建概率密度 $p(s)$ 的直方图，每个采样值 $s$ 都必须映射到其在所选基本域（例如 $s' \\in [0, L)$）中的唯一代表值 $s'$。正确的映射是 $s' = s \\pmod L$，可以实现为 $s' = s - L \\lfloor s/L \\rfloor$。直方图使用这些卷绕后的坐标 $s'$ 进行填充。\n\n4.  **连续性和后处理**：得到的自由能曲线 $F(s)$ 必须是周期性的，即 $F(0) = F(L)$。虽然对无限数据的完美分析可以保证这一点，但有限的数据和数值方法可能会引入微小的不匹配。强制实施这种周期性是有效的一步。此外，如果对数据（例如 $p(s)$ 或 $F(s)$）应用任何平滑处理，平滑核也必须尊重圆形拓扑。这需要一个周期性核函数（例如，卷绕高斯函数），它通过承认边界附近点（例如在 $s=\\epsilon$）与区间另一端的点（例如在 $s=L-\\epsilon$）的邻近性，来正确处理这些点。\n\n基于这些第一性原理，我们现在可以评估每个选项。\n\n### 逐项分析\n\n**A. 在 $[0,L)$ 上建立直方图，不进行任何卷绕处理，将任何 $sL$ 的样本分配到 $L$ 之外的区间，并在归一化期间丢弃这些贡献，以避免在边界处重复计数。**\n\n这个程序从根本上是错误的。位于 $s = L + \\epsilon$ 的样本在物理上与位于 $s=\\epsilon$ 的样本是相同的。丢弃位于 $s=L+\\epsilon$ 的样本意味着丢弃了有效的统计信息。这会人为地减少对 $s=0$ 附近区间的采样，导致不正确的概率密度和相应的自由能曲线中的人为势垒。这种方法将周期性变量视为被限制在一个盒子中，这与问题定义相矛盾。\n**结论：不正确。**\n\n**B. 通过 $s' = s - L \\left\\lfloor s/L \\right\\rfloor$ 将每个采样的 $s$ 映射到其在 $[0,L)$ 中的代表值 $s'$，使用 $s'$ 分配直方图区间，并使用最小镜像距离 $d(s',s_{0,i}) = \\min_{n \\in \\mathbb{Z}} \\left| s' - s_{0,i} + nL \\right|$ 计算谐波偏置，从而使重加权因子在边界上平滑变化。**\n\n这个程序正确地解决了核心问题。\n1.  映射 $s' = s - L \\lfloor s/L \\rfloor$ 正确地将所有采样坐标折叠到基本域 $[0,L)$ 中，这与原理3一致。这确保了每个样本都在其物理上正确的位置被计数。\n2.  如原理2中所解释，使用最小镜像距离 $d(s', s_{0,i})$ 来定义谐波偏置势是至关重要的。这确保了偏置能 $w_i(s)$ 在圆上是一个连续且平滑的函数，这对于重加权因子 $\\exp[\\beta w_i(s)]$ 在周期性边界上表现良好是必需的。这可以防止人为的能量跳跃，并确保偏置模拟的物理性质是正确的。\n该选项描述了对周期性变量进行伞形采样的标准、正确的实现方法。\n**结论：正确。**\n\n**C. 为强制实现连续性，将任何 $s$ 值位于任一边界的一个小阈值 $\\delta$ 内的样本复制到第一个和最后一个区间中，并将其权重在这两者之间取平均，以减少边界伪影。**\n\n这是一个临时的、启发式的程序，没有建立在严格的统计原理之上。它违反了直方图的基本规则，即每个样本只对一个区间做出贡献。复制和平均样本贡献是一种数据操纵形式，它扭曲了底层的概率分布。它试图表面上平滑一个由不正确处理引起的边界伪影，而不是通过尊重系统拓扑从根本上解决问题。实现连续性的正确方法是从一开始就使用周期性表示。\n**结论：不正确。**\n\n**D. 从重加权的直方图估计 $F(s)$ 时，显式施加周期性约束 $F(0) = F(L)$，并且如果对 $p(s)$ 或 $F(s)$ 应用平滑处理，则使用在圆上定义、采用流形上的测地距离的核函数（即周期性核函数），而不是在区间上使用欧几里得核函数。**\n\n这个选项描述了正确且通常必要的后处理步骤，与原理4一致。\n1.  真实的自由能 $F(s)$ 必须是周期性的。施加约束 $F(0) = F(L)$ 确保最终结果在物理上是有意义的，纠正了有限采样可能引起的微小差异。\n2.  如果进行平滑处理，使用周期性核函数是必不可少的。标准的欧几里得核函数会将 $s=0$ 和 $s=L$ 处的点视为相距很远，从而在边界处产生平滑伪影。周期性核函数正确地认识到域是圆形的，并且 $s=0$ 与 $s=L$ 相邻，因此保留了曲线的连续性和周期性。\n这两种做法都是合理的，并且与周期性数据的严格处理相一致。\n**结论：正确。**\n\n**E. 在分析期间，将任何靠近 $L$ 的窗口中心 $s_{0,i}$ 移动 $\\pm L$，使得 $|s - s_{0,i}|$ 看起来很小而无需使用最小镜像约定，并保持所有采样的 $s$ 值不被卷绕，以便直方图在 $s=0$ 和 $s=L$ 处有清晰的边界。**\n\n这是一个不正确且繁琐的变通方法，未能成为一个通用的解决方案。保持 $s$ 值不被卷绕会在实线上构建直方图，这是错误的拓扑结构。移动中心 $s_{0,i}$ 是一种“技巧”，目的是让简单的欧几里得距离计算 $|s-s_{0,i}|$ 给出正确的最小镜像距离，但这只对靠近移动后中心的样本 $s$ 有效。它不适用于所有可能的 $s$ 值，并且不等同于一个正确的最小镜像计算。例如，如果 $s_{0,i}=0.9L$ 被移动到 $-0.1L$，一个位于 $s=0.4L$ 的样本与中心的距离将被错误地计算得很大。稳健的方法是始终计算最小镜像距离。此选项明确避免了正确的约定，也未能正确地对数据进行分箱。\n**结论：不正确。**", "answer": "$$\\boxed{BD}$$", "id": "3461108"}, {"introduction": "WHAM通过“拼接”来自不同模拟窗口的信息来构建全局的平均力势（PMF）。这个拼接过程的核心是确定各个窗口之间未知的相对自由能偏移量（即 $f_k$）。本练习通过一个具体的思想实验，展示了如何利用基本的物理原理，如PMF在周期性边界上的连续性，来唯一地确定这些偏移量，从而确保最终重构的自由能曲线是物理上自洽且连续的。[@problem_id:3461096]", "problem": "描述扭转角的一维集体变量 (CV) $s$ 是周期性的，其定义域为 $s\\in[-\\pi,\\pi)$。使用加权直方图分析方法 (WHAM) 从伞形采样中重构了平均力势 (PMF) $F(s)$。WHAM 在每个窗口内产生的无偏直方图在乘法归一化下是准确的。该定义域由两个重叠的窗口覆盖，其经过 WHAM 重新加权的、未归一化的无偏密度建模为：$s\\in[-\\pi,0)$ 时为 $\\tilde{P}_{1}(s)=a\\left(2+\\cos s\\right)$，$s\\in[0,\\pi)$ 时为 $\\tilde{P}_{2}(s)=b\\left(2+\\cos s\\right)$，其中 $a0$ 且 $b0$。PMF 片段定义为：在 $[-\\pi,0)$ 上为 $F_{1}(s)=-k_{B}T\\ln\\tilde{P}_{1}(s)+C_{1}$，在 $[0,\\pi)$ 上为 $F_{2}(s)=-k_{B}T\\ln\\tilde{P}_{2}(s)+C_{2}$。其中 $k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度，$C_{1}$ 和 $C_{2}$ 是由于 WHAM 在每个窗口内的乘法归一化自由度而产生的未知加性常数。在 $[-\\pi,\\pi)$ 上的物理 PMF $F(s)$ 必须是单值的，并且在周期性边界上是连续的。平衡概率密度满足 $P(s)\\propto\\exp\\left(-\\beta F(s)\\right)$，其中 $\\beta=1/(k_{B}T)$。\n\n仅使用平衡统计力学的基本定义和 CV 的周期性，确定相对归一化 $\\Delta C=C_{2}-C_{1}$ 的唯一值，该值需同时满足以下两个要求：\n- 在周期性边界处 $F(s)$ 的连续性，即 $F(-\\pi)=F(\\pi)$。\n- 基于平衡概率定义 $P(s)\\propto\\exp\\left(-\\beta F(s)\\right)$，势盆 $A=[-\\pi/2,0)$ 和 $B=[0,\\pi/2]$ 之间的自由能差是一致的，具体而言，建模的 $\\tilde{P}_{1}$ 和 $\\tilde{P}_{2}$ 的对称性意味着自由能差为零：$\\Delta F_{A\\to B}=-k_{B}T\\ln\\left(\\frac{\\int_{B}P(s)\\,ds}{\\int_{A}P(s)\\,ds}\\right)=0$。\n\n将 $\\Delta C$ 的最终答案表示为以 $k_{B}T$、$a$ 和 $b$ 表示的闭式解析表达式，单位为焦耳。无需进行数值代入，也无需四舍五入。全文中角度均以弧度为单位。", "solution": "首先将根据指定标准对问题进行验证。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n- **集体变量 (CV)**：描述扭转角的一维 CV $s$。\n- **定义域**：$s \\in [-\\pi, \\pi)$，周期性。\n- **来自 WHAM 的未归一化无偏密度**：\n  - $\\tilde{P}_{1}(s) = a(2+\\cos s)$，对于 $s \\in [-\\pi, 0)$，其中 $a0$。\n  - $\\tilde{P}_{2}(s) = b(2+\\cos s)$，对于 $s \\in [0, \\pi)$，其中 $b0$。\n- **平均力势 (PMF) 片段**：\n  - $F_{1}(s) = -k_{B}T \\ln \\tilde{P}_{1}(s) + C_{1}$，在 $[-\\pi, 0)$ 上。\n  - $F_{2}(s) = -k_{B}T \\ln \\tilde{P}_{2}(s) + C_{2}$，在 $[0, \\pi)$ 上。\n  - $k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n  - $C_1, C_2$ 是未知的加性常数。\n- **平衡概率密度**：$P(s) \\propto \\exp(-\\beta F(s))$，其中 $\\beta = 1/(k_{B}T)$。\n- **要求 1**：物理 PMF $F(s)$ 在周期性边界处是连续的，即 $F(-\\pi) = F(\\pi)$。\n- **要求 2**：势盆 $A=[-\\pi/2, 0)$ 和势盆 $B=[0, \\pi/2]$ 之间的自由能差为零：$\\Delta F_{A\\to B} = -k_{B}T\\ln\\left(\\frac{\\int_{B}P(s)\\,ds}{\\int_{A}P(s)\\,ds}\\right)=0$。\n- **目标量**：确定相对归一化 $\\Delta C = C_2 - C_1$ 的唯一值。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学上成立**：该问题设置在平衡统计力学和分子动力学模拟的背景下，特别是使用加权直方图分析方法 (WHAM) 来重构平均力势 (PMF)。PMF、玻尔兹曼统计 ($P(s) \\propto \\exp(-\\beta F(s))$)、扭转角的周期性边界条件以及 PMF 的连续性等概念都是该领域的标准和基本原理。函数形式 $2+\\cos s$ 是一个简单扭转势的物理上合理的模型。该问题没有违反任何科学原理。\n- **提法恰当**：该问题提供了足够的信息来确定目标量 $\\Delta C$。给出的条件是明确的，两个要求提供了不同的数学约束，从而导出一个唯一解，如下所示。该问题是自洽且数学上可解的。\n- **客观性**：语言是精确、定量的，没有任何主观或基于意见的陈述。所有术语都在统计力学的背景下有正式定义。\n\n该问题不存在科学上不成立、不完整、矛盾或歧义等任何缺陷。所提供的条件是一致且充分的。\n\n**步骤 3：结论与行动**\n该问题被认为是**有效**的。将提供一个完整的、有理有据的解法。\n\n**解法**\n\n目标是确定相对常数 $\\Delta C = C_{2} - C_{1}$ 的唯一值，以确保分段定义的平均力势 (PMF) 满足两个物理一致性要求。完整的 PMF $F(s)$ 由两个片段构成：\n$F(s) = \\begin{cases} F_{1}(s) = -k_{B}T\\ln\\left[a(2+\\cos s)\\right] + C_{1}  s \\in [-\\pi, 0) \\\\ F_{2}(s) = -k_{B}T\\ln\\left[b(2+\\cos s)\\right] + C_{2}  s \\in [0, \\pi) \\end{cases}$\n\n我们将分别分析每个要求，以推导出 $\\Delta C$ 的表达式。\n\n**要求 1：周期性边界处的连续性**\n\n问题指出 PMF 必须在周期性边界处连续，这意味着函数在区间起点 $s = -\\pi$ 的值必须等于在区间终点（即 $s \\to \\pi^-$ 时）的值。\n在数学上，这表示为 $F(-\\pi) = F(\\pi)$。我们使用 $F_1(s)$ 的定义计算 $s=-\\pi$ 时的值，并使用 $F_2(s)$ 计算 $s \\to \\pi^-$ 时的极限。\n\n在 $s = -\\pi$ 时，PMF 由 $F_1(s)$ 给出：\n$F(-\\pi) = F_{1}(-\\pi) = -k_{B}T\\ln\\left[a(2+\\cos(-\\pi))\\right] + C_{1}$\n由于 $\\cos(-\\pi) = -1$，这简化为：\n$F(-\\pi) = -k_{B}T\\ln\\left[a(2-1)\\right] + C_{1} = -k_{B}T\\ln(a) + C_{1}$\n\n在极限 $s \\to \\pi^-$ 时，PMF 由 $F_2(s)$ 给出：\n$F(\\pi) = \\lim_{s\\to\\pi^{-}} F_{2}(s) = -k_{B}T\\ln\\left[b(2+\\cos(\\pi))\\right] + C_{2}$\n由于 $\\cos(\\pi) = -1$，这变为：\n$F(\\pi) = -k_{B}T\\ln\\left[b(2-1)\\right] + C_{2} = -k_{B}T\\ln(b) + C_{2}$\n\n根据连续性要求，将这两个表达式相等：\n$-k_{B}T\\ln(a) + C_{1} = -k_{B}T\\ln(b) + C_{2}$\n\n我们重排这个方程来求解 $\\Delta C = C_{2} - C_{1}$：\n$C_{2} - C_{1} = k_{B}T\\ln(b) - k_{B}T\\ln(a)$\n$\\Delta C = k_{B}T\\ln\\left(\\frac{b}{a}\\right)$\n\n**要求 2：势盆 A 和 B 之间的自由能差为零**\n\n第二个要求是势盆 $A = [-\\pi/2, 0)$ 和势盆 $B = [0, \\pi/2]$ 之间的自由能差为零。自由能差定义为：\n$\\Delta F_{A\\to B} = -k_{B}T\\ln\\left(\\frac{\\int_{B}P(s)\\,ds}{\\int_{A}P(s)\\,ds}\\right) = 0$\n这意味着对数的参数必须为 1：\n$\\frac{\\int_{B}P(s)\\,ds}{\\int_{A}P(s)\\,ds} = 1 \\implies \\int_{A}P(s)\\,ds = \\int_{B}P(s)\\,ds$\n\n平衡概率密度 $P(s)$ 与 $\\exp(-\\beta F(s))$ 成正比，其中 $\\beta = 1/(k_{B}T)$。设归一化常数为 $Z^{-1}$，则 $P(s) = Z^{-1}\\exp(-\\beta F(s))$。\n对于势盆 $A = [-\\pi/2, 0)$ 中的 $s$，我们使用 $F_1(s)$。\n$P(s) = Z^{-1}\\exp\\left(-\\beta F_{1}(s)\\right) = Z^{-1}\\exp\\left(-\\beta \\left[-k_{B}T\\ln(\\tilde{P}_{1}(s)) + C_{1}\\right]\\right)$\n$P(s) = Z^{-1}\\exp\\left(\\ln(\\tilde{P}_{1}(s)) - \\beta C_{1}\\right) = Z^{-1}\\tilde{P}_{1}(s)\\exp(-\\beta C_{1})$\n\n对于势盆 $B = [0, \\pi/2]$ 中的 $s$，我们使用 $F_2(s)$。\n$P(s) = Z^{-1}\\exp\\left(-\\beta F_{2}(s)\\right) = Z^{-1}\\exp\\left(-\\beta \\left[-k_{B}T\\ln(\\tilde{P}_{2}(s)) + C_{2}\\right]\\right)$\n$P(s) = Z^{-1}\\exp\\left(\\ln(\\tilde{P}_{2}(s)) - \\beta C_{2}\\right) = Z^{-1}\\tilde{P}_{2}(s)\\exp(-\\beta C_{2})$\n\n现在我们令两个势盆上的积分相等：\n$\\int_{-\\pi/2}^{0} Z^{-1}\\tilde{P}_{1}(s)\\exp(-\\beta C_{1})\\,ds = \\int_{0}^{\\pi/2} Z^{-1}\\tilde{P}_{2}(s)\\exp(-\\beta C_{2})\\,ds$\n\n常数 $Z^{-1}$ 从两侧消去。代入 $\\tilde{P}_{1}(s)$ 和 $\\tilde{P}_{2}(s)$ 的表达式：\n$\\exp(-\\beta C_{1}) \\int_{-\\pi/2}^{0} a(2+\\cos s)\\,ds = \\exp(-\\beta C_{2}) \\int_{0}^{\\pi/2} b(2+\\cos s)\\,ds$\n$a\\exp(-\\beta C_{1}) \\int_{-\\pi/2}^{0} (2+\\cos s)\\,ds = b\\exp(-\\beta C_{2}) \\int_{0}^{\\pi/2} (2+\\cos s)\\,ds$\n\n我们来计算积分。被积函数的原函数是 $\\int(2+\\cos s)\\,ds = 2s + \\sin s$。\n对于势盆 A 上的积分：\n$\\int_{-\\pi/2}^{0} (2+\\cos s)\\,ds = [2s + \\sin s]_{-\\pi/2}^{0} = (0+\\sin 0) - (2(-\\frac{\\pi}{2}) + \\sin(-\\frac{\\pi}{2})) = 0 - (-\\pi - 1) = \\pi+1$\n对于势盆 B 上的积分：\n$\\int_{0}^{\\pi/2} (2+\\cos s)\\,ds = [2s + \\sin s]_{0}^{\\pi/2} = (2(\\frac{\\pi}{2}) + \\sin(\\frac{\\pi}{2})) - (0+\\sin 0) = (\\pi+1) - 0 = \\pi+1$\n\n正如从被积函数 $2+\\cos s$ 关于 $s=0$ 的对称性以及对称的积分限所预期的那样，这两个积分是相等的。设 $I = \\pi+1$。方程变为：\n$a\\exp(-\\beta C_{1}) \\cdot I = b\\exp(-\\beta C_{2}) \\cdot I$\n\n由于 $I = \\pi+1 \\neq 0$，我们可以除以 $I$：\n$a\\exp(-\\beta C_{1}) = b\\exp(-\\beta C_{2})$\n重排各项以分离出常数：\n$\\frac{\\exp(-\\beta C_{1})}{\\exp(-\\beta C_{2})} = \\frac{b}{a}$\n$\\exp(-\\beta C_{1} + \\beta C_{2}) = \\frac{b}{a}$\n$\\exp(\\beta (C_{2} - C_{1})) = \\frac{b}{a}$\n\n对两边取自然对数：\n$\\beta (C_{2} - C_{1}) = \\ln\\left(\\frac{b}{a}\\right)$\n代入 $\\Delta C = C_{2} - C_{1}$ 和 $\\beta = 1/(k_{B}T)$：\n$\\frac{\\Delta C}{k_{B}T} = \\ln\\left(\\frac{b}{a}\\right)$\n$\\Delta C = k_{B}T\\ln\\left(\\frac{b}{a}\\right)$\n\n当强制执行时，两个要求独立地得出了相同的 $\\Delta C$ 表达式。这证明了物理模型的内部一致性。问题要求的是同时满足两个要求的 $\\Delta C$ 的唯一值。由于两者都导向相同的结果，这个唯一值就确定了。最终表达式以给定的常数表示，并且具有能量单位，这符合自由能差的要求。", "answer": "$$\\boxed{k_{B}T\\ln\\left(\\frac{b}{a}\\right)}$$", "id": "3461096"}]}