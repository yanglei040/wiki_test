{"hands_on_practices": [{"introduction": "多级快速多极子算法的效率源于其对问题域的分层分解。任何 MLFMA 实现的关键第一步是确定这种层次结构的适当深度。本实践问题将指导您计算八叉树所需的最小层数，以确保最小的盒子满足多极子展开的稳定性和准确性条件，这是一个将物理问题尺度与算法结构联系起来的基本步骤。[@problem_id:3332630]", "problem": "考虑自由空间中的一个三维时谐散射问题，该问题由与电场积分方程相关的格林函数$G(\\mathbf{r})$的标量亥姆霍兹方程建模。将在一个均匀八叉树上构建一个多层快速多极子算法 (MLFMA)，该八叉树将所有源和观察者包围在一个边长为$D = 1.2\\,\\mathrm{m}$的立方体包围盒内。工作频率为$f = 2.0\\,\\mathrm{GHz}$，光速为$c = 2.99792458 \\times 10^{8}\\,\\mathrm{m/s}$，因此自由空间波数为$k = 2\\pi f/c$。\n\n在树的第$\\ell$层，每个立方体盒子的边长为$h_{\\ell} = D/2^{\\ell}$，我们用半径为$a_{\\ell} = \\sqrt{3}\\,h_{\\ell}/2$的外接球来包围每个盒子。第$\\ell$层一个盒子的近场定义为与其共享一个面、一条边或一个角的$3\\times 3 \\times 3$的盒子块；此盒子块之外的盒子构成了其远场相互作用列表。因此，在最底层$L$，远场盒子之间的最小中心间距为$s_{\\min} = 2\\,h_{L}$。\n\n为了使 MLFMA 中亥姆霍兹核的多极子到局部 (M2L) 转换在最底层保持稳定和准确，必须满足以下分离条件：\n- 外接球不重叠：$s_{\\min} \\ge a_{L} + a_{L}$。\n- 分组尺寸约束：$k\\,a_{L} \\le \\kappa_{\\max}$，其中$\\kappa_{\\max} = 0.7$。\n\n计算最小的整数层数$L$，使得在最底层两个条件都得到满足。将最终答案表示为一个无量纲整数。", "solution": "在进行求解之前，对问题陈述的有效性进行严格评估。\n\n### 步骤 1：提取已知条件\n- 域：三维，立方体包围盒内的均匀八叉树。\n- 包围盒边长：$D = 1.2\\,\\mathrm{m}$。\n- 工作频率：$f = 2.0 \\times 10^9\\,\\mathrm{Hz}$。\n- 光速：$c = 2.99792458 \\times 10^{8}\\,\\mathrm{m/s}$。\n- 自由空间波数：$k = 2\\pi f/c$。\n- 第$\\ell$层立方体盒子的边长：$h_{\\ell} = D/2^{\\ell}$。\n- 第$\\ell$层盒子的外接球半径：$a_{\\ell} = \\sqrt{3}\\,h_{\\ell}/2$。\n- 近场定义：$3\\times 3 \\times 3$的相邻盒子块。\n- 最底层$L$远场盒子的最小中心间距：$s_{\\min} = 2\\,h_{L}$。\n- 第一个稳定性条件（外接球不重叠）：$s_{\\min} \\ge a_{L} + a_{L}$。\n- 第二个稳定性条件（分组尺寸约束）：$k\\,a_{L} \\le \\kappa_{\\max}$，其中$\\kappa_{\\max} = 0.7$。\n- 目标：计算满足这两个条件的最小整数层数$L$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题牢固地基于计算电磁学的原理，特别是应用于亥姆霍兹方程的多层快速多极子算法 (MLFMA)。所使用的概念，如八叉树分解、外接球、近场/远场分离以及多极子转换的稳定性条件，都是该领域的标准且成熟的概念。所提供的物理常数和参数是符合实际的。\n- **适定性**：该问题提供了所有必要的信息，并定义了两个清晰的数学不等式。目标是找到满足这两个不等式的最小整数$L$，这是一个定义明确且预期有唯一解的数学任务。\n- **客观性**：该问题使用精确、无歧义的技术语言陈述，不含主观或基于观点的论断。\n\n### 步骤 3：结论与行动\n该问题是有效的。它是计算科学中一个标准的、自洽的、适定的问题。将推导求解过程。\n\n任务是找到同时满足两个不等式的最小整数$L$。我们将分别分析每个条件。\n\n**条件 1：外接球不重叠**\n\n第一个条件是$s_{\\min} \\ge a_{L} + a_{L}$。\n我们已知最底层$L$的最小间距$s_{\\min}$和外接球半径$a_L$的表达式：\n$$s_{\\min} = 2\\,h_{L}$$\n$$a_{L} = \\frac{\\sqrt{3}}{2}\\,h_{L}$$\n将这些代入不等式中得到：\n$$2\\,h_{L} \\ge 2\\left(\\frac{\\sqrt{3}}{2}\\,h_{L}\\right)$$\n$$2\\,h_{L} \\ge \\sqrt{3}\\,h_{L}$$\n由于$h_{L} = D/2^{L}$是一个物理长度，它为正值。我们可以在不等式两边同时除以$h_L$而不改变不等号的方向：\n$$2 \\ge \\sqrt{3}$$\n两边平方，我们得到$4 \\ge 3$，这是一个真命题。这意味着，基于给定的近场和远场的标准定义，第一个关于远场盒子外接球不重叠的条件对于任意层级$L \\ge 0$都成立。因此，该条件不对$L$的值施加约束。\n\n**条件 2：分组尺寸约束**\n\n第二个条件是$k\\,a_{L} \\le \\kappa_{\\max}$。\n这个条件限制了层次结构中最小盒子的电尺寸，以确保多极子展开的准确性。我们将使用这个不等式来找到对$L$的约束。\n\n首先，我们计算自由空间波数$k$：\n$$k = \\frac{2\\pi f}{c} = \\frac{2\\pi (2.0 \\times 10^9\\,\\mathrm{s}^{-1})}{2.99792458 \\times 10^{8}\\,\\mathrm{m/s}} = \\frac{40\\pi}{2.99792458}\\,\\mathrm{m}^{-1}$$\n\n接下来，我们用$L$和给定参数表示$a_L$：\n$$a_{L} = \\frac{\\sqrt{3}}{2}\\,h_{L} = \\frac{\\sqrt{3}}{2} \\frac{D}{2^{L}}$$\n\n现在，我们将这些表达式代入不等式中：\n$$k \\left(\\frac{\\sqrt{3}\\,D}{2 \\cdot 2^{L}}\\right) \\le \\kappa_{\\max}$$\n\n我们需要求解$L$。整理不等式以分离出$2^{L}$：\n$$2^{L} \\ge \\frac{k\\sqrt{3}\\,D}{2\\,\\kappa_{\\max}}$$\n\n我们代入参数的数值：\n- $k = \\frac{40\\pi}{2.99792458}\\,\\mathrm{m}^{-1} \\approx 41.914486\\,\\mathrm{m}^{-1}$\n- $D = 1.2\\,\\mathrm{m}$\n- $\\kappa_{\\max} = 0.7$\n- $\\sqrt{3} \\approx 1.732051$\n\n将这些值代入不等式的右侧：\n$$2^{L} \\ge \\frac{\\left(\\frac{40\\pi}{2.99792458}\\right) \\sqrt{3} (1.2)}{2 (0.7)}$$\n$$2^{L} \\ge \\frac{(41.914486) (1.732051) (1.2)}{1.4}$$\n$$2^{L} \\ge \\frac{87.12683}{1.4}$$\n$$2^{L} \\ge 62.23345$$\n\n为了找到满足此条件的最小整数$L$，我们可以对两边取以 2 为底的对数：\n$$L \\ge \\log_{2}(62.23345)$$\n$$L \\ge \\frac{\\ln(62.23345)}{\\ln(2)}$$\n$$L \\ge \\frac{4.13093}{0.69315}$$\n$$L \\ge 5.9599...$$\n\n由于层数$L$必须是整数，满足$L \\ge 5.9599...$的最小整数值是$L=6$。\n\n因此，为满足两个稳定性条件所需的最小整数层数为$6$。", "answer": "$$\\boxed{6}$$", "id": "3332630"}, {"introduction": "MLFMA 的核心在于远群组之间场的高效平移，这一过程通过平面波展开得以实现。这个关键步骤的准确性取决于平面波采样方向的数量，该数量必须足以捕捉辐射方向图的角向复杂性。本练习将让您把期望的误差容限与所需的球谐函数截断阶数联系起来，并进而推导出平面波方向的数量，从而深入理解该算法核心的精度-成本权衡。[@problem_id:3332655]", "problem": "在三维计算电磁学中，多级快速多极子算法 (MLFMA) 通过在单位球面上的平面波采样来近似分离良好的簇之间聚合辐射方向图的平移。考虑一个 MLFMA 层级，其中自由空间中立方体簇盒的边长为$b$。设其外接球半径为$a = \\frac{\\sqrt{3}}{2}\\,b$。波数为$k = \\frac{2\\pi f}{c}$，其中$f$是频率，$c$是真空中的光速。标量自由空间格林函数求解亥姆霍兹方程，并同时拥有球谐函数和平面波两种表示；将前者截断至$p$阶会引入一个角带宽，该带宽必须由平面波采样支持。假设采用张量积形式的角向求积：极角方向使用高斯-勒让德求积，方位角方向使用均匀梯形法则。\n\n从亥姆霍兹格林函数的球谐函数表示和球贝塞尔函数成熟的渐近性出发，推导一个保守不等式，用以确定所需的最小球谐阶数$p$，使得当源被限制在盒内时，超过$p$阶的截断在方向平移中产生的相对误差不大于预设容差$\\epsilon$（您可以使用任何对$n \\geq k a$有效的球贝塞尔级数尾部的标准界）。然后，利用角带宽的考虑和所选求积法则的精确性，将平面波方向数$Q$与$p$关联起来。\n\n最后，根据以下参数计算$Q$的值：\n- 频率$f = 3.0 \\times 10^{9}\\,\\text{s}^{-1}$，\n- 光速$c = 3.0 \\times 10^{8}\\,\\text{m/s}$，\n- 盒边长$b = 1.0 \\times 10^{-1}\\,\\text{m}$，\n- 目标相对误差$\\epsilon = 1.0 \\times 10^{-4}$。\n\n返回满足您推导的界的最小整数$Q$。最终答案必须是一个整数。最终答案不需要单位。如果需要任何中间数值近似，其精度必须足以明确地确定该整数。", "solution": "该问题要求确定在多级快速多极子算法 (MLFMA) 的一个特定应用中，平面波采样方向的数量$Q$。求解过程分为三步：首先，我们根据给定的相对误差$\\epsilon$推导出球谐函数截断阶数$p$的一个不等式；其次，我们根据所选的求积方案将采样方向数$Q$与$p$关联起来；最后，我们使用给定的参数计算$Q$的数值。\n\n**第1步：推导截断阶数 $p$**\n\nMLFMA 平移算子的核心涉及平面波展开。平面波$\\exp(i\\mathbf{k} \\cdot \\mathbf{r})$可以用球谐函数和球贝塞尔函数展开：\n$$ \\exp(i\\mathbf{k} \\cdot \\mathbf{r}) = \\sum_{n=0}^{\\infty} (2n+1) i^n j_n(kr) P_n(\\hat{\\mathbf{k}} \\cdot \\hat{\\mathbf{r}}) $$\n其中$k=|\\mathbf{k}|$，$r=|\\mathbf{r}|$，$j_n$是第一类球贝塞尔函数，$P_n$是$n$阶勒让德多项式。在 MLFMA 中，此级数在$p$阶被截断。源被限制在边长为$b$的立方体盒内，该盒被一个半径为$a = \\frac{\\sqrt{3}}{2}b$的外接球所包围。因此，贝塞尔函数的宗量有界，$kr \\le ka$。\n\n截断误差由该级数的尾部（即$n > p$的项）决定。问题要求一个保守不等式。为此，我们可以依赖级数尾部的标准界，这些界源于球贝塞尔函数$j_n(x)$在阶数$n$远大于宗量$x$时的渐近行为。一个广泛使用的、由$p$阶截断引起的相对误差$\\epsilon$的保守界由以下不等式给出：\n$$ \\left( \\frac{eka}{2p} \\right)^p \\le \\epsilon $$\n此不等式在$p > ka$时有效，其中$e$是欧拉数。它的推导基于这样的假设：级数的尾部由最先被忽略的几项主导，并使用了$j_n(x)$的一个渐近界。我们必须找到同时满足$p>ka$和该不等式的最小整数$p$。可以通过对两边取自然对数来重写此不等式：\n$$ p \\ln\\left( \\frac{eka}{2p} \\right) \\le \\ln(\\epsilon) $$\n$$ p \\left( 1 + \\ln\\left(\\frac{ka}{2}\\right) - \\ln(p) \\right) \\le \\ln(\\epsilon) $$\n这个超越不等式将通过数值方法求解$p$。\n\n**第2步：采样方向数 $Q$ 与截断阶数 $p$ 之间的关系**\n\n问题指定了一个张量积求积网格，用于在单位球面上对平面波方向进行采样。这些方向由极角$\\theta \\in [0, \\pi]$和方位角$\\phi \\in [0, 2\\pi]$参数化。\n总采样点数为$Q = N_\\theta N_\\phi$，其中$N_\\theta$是极角的点数，$N_\\phi$是方位角的点数。\n\n$N_\\theta$和$N_\\phi$的选择取决于精确积分最高达$p$阶的球谐函数乘积的需求。球谐函数$Y_n^m(\\theta, \\phi)$对$\\phi$的依赖关系为$e^{im\\phi}$。MLFMA 公式中的被积函数涉及两个辐射方向图的乘积，从而产生最高可达$e^{i2p\\phi}$依赖关系的项。具有$N_\\phi$个点的均匀梯形法则对于最高$N_\\phi - 1$次的三角多项式是精确的。为了确保对最高频率分量$2p$的准确性，我们必须有：\n$$ N_\\phi - 1 \\ge 2p \\implies N_\\phi \\ge 2p + 1 $$\n最小选择是$N_\\phi = 2p+1$。\n\n对$\\theta$的依赖性涉及连带勒让德多项式$P_n^m(\\cos\\theta)$。两个此类函数的乘积（每个函数在$\\cos\\theta$中的阶数最高为$p$）会得到一个在$\\cos\\theta$中阶数最高为$2p$的多项式。在$[-1, 1]$上的一个$N_\\theta$点高斯-勒让德求积法则对于最高$2N_\\theta - 1$次的多项式是精确的。为了精确积分$2p$次多项式，我们需要：\n$$ 2N_\\theta - 1 \\ge 2p \\implies N_\\theta \\ge p + \\frac{1}{2} $$\n由于$N_\\theta$必须是整数，最小选择是$N_\\theta = p+1$。\n\n结合这些，总的平面波方向数$Q$为：\n$$ Q = N_\\theta N_\\phi = (p+1)(2p+1) $$\n\n**第3步：数值计算**\n\n我们有以下给定参数：\n-   频率：$f = 3.0 \\times 10^{9}\\,\\text{s}^{-1}$\n-   光速：$c = 3.0 \\times 10^{8}\\,\\text{m/s}$\n-   盒边长：$b = 1.0 \\times 10^{-1}\\,\\text{m}$\n-   目标相对误差：$\\epsilon = 1.0 \\times 10^{-4}$\n\n首先，我们计算波数$k$：\n$$ k = \\frac{2\\pi f}{c} = \\frac{2\\pi (3.0 \\times 10^9\\,\\text{s}^{-1})}{3.0 \\times 10^8\\,\\text{m/s}} = 20\\pi\\,\\text{m}^{-1} $$\n接下来，我们计算外接球的半径$a$：\n$$ a = \\frac{\\sqrt{3}}{2}b = \\frac{\\sqrt{3}}{2} (1.0 \\times 10^{-1}\\,\\text{m}) = \\frac{\\sqrt{3}}{20}\\,\\text{m} $$\n无量纲参数$ka$为：\n$$ ka = (20\\pi) \\left(\\frac{\\sqrt{3}}{20}\\right) = \\pi\\sqrt{3} \\approx 5.4414 $$\n误差容差的自然对数为：\n$$ \\ln(\\epsilon) = \\ln(1.0 \\times 10^{-4}) = -4\\ln(10) \\approx -9.2103 $$\n现在我们寻找满足$p > 5.4414$和不等式$p \\left( 1 + \\ln\\left(\\frac{\\pi\\sqrt{3}}{2p}\\right) \\right) \\le -9.2103$的最小整数$p$。我们从$6$开始测试$p$的整数值：\n- 对于$p=14$（大于$5.4414$）：\n  $14 \\left( 1 + \\ln\\left(\\frac{\\pi\\sqrt{3}}{2 \\times 14}\\right) \\right) = 14 \\left( 1 + \\ln(0.1943) \\right) \\approx 14(1 - 1.6382) = -8.9348$。\n  由于$-8.9348 \\not\\le -9.2103$，$p=14$不足够。\n- 对于$p=15$：\n  $15 \\left( 1 + \\ln\\left(\\frac{\\pi\\sqrt{3}}{2 \\times 15}\\right) \\right) = 15 \\left( 1 + \\ln(0.1814) \\right) \\approx 15(1 - 1.7072) = -10.608$。\n  由于$-10.608 \\le -9.2103$，$p=15$足够了。\n\n满足条件的最小整数是$p=15$。\n\n最后，我们使用第2步中推导的公式计算采样方向数$Q$：\n$$ Q = (p+1)(2p+1) = (15+1)(2 \\times 15 + 1) = (16)(31) = 496 $$\n最小平面波方向数为$496$。", "answer": "$$\\boxed{496}$$", "id": "3332655"}, {"introduction": "理论误差界为 MLFMA 提供了设计原则，但真正的理解来自于对算法行为的数值观测。这个编程实践练习要求您通过实现一个量化截断误差的数值实验来弥合理论与实践之间的差距。通过计算基于被忽略的球汉克尔级数项的、有物理动机的误差度量，您将对精度如何依赖于截断阶数和问题的电尺寸获得具体的直觉。[@problem_id:3306982]", "problem": "考虑一个半径为$a$的理想电导体 (PEC) 球体，被一个角频率为$\\omega$、真空介电常数为$\\epsilon$、真空磁导率为$\\mu$的时谐平面波照射，自由空间波数为$k = \\omega \\sqrt{\\mu \\epsilon}$。电场积分方程 (EFIE) 强制施加边界条件，即导体表面的总切向电场为零，这是麦克斯韦方程组在理想电导体边界条件下的直接推论。多层快速多极子算法 (MLFMA) 通过使用多极子展开来加速表面电流辐射场的计算，其截断由阶数$p$控制，较高的$p$会保留更多的多极子项。在基于多极子的电磁散射公式中，平移算子涉及第一类球汉克尔函数，表示为$h_n^{(1)}(\\cdot)$，截断阶数$p$决定了保留多少项。\n\n设计一个使用无量纲形式$x = ka$的数值实验，量化截断阶数$p$如何影响以下两个度量标准：\n- 与省略的多极子内容相关的 EFIE 残差范数$\\|r\\|$，通过被忽略的球谐波能量来建模；以及\n- 球汉克尔级数尾部误差大小，定义为截断的球汉克尔级数尾部$\\sum_{n>p} h_n^{(1)}(x)$的标量大小。\n\n从基本点出发：理想电导体边界条件强制切向电场为零，并且在多极子框架中，场在矢量球谐函数中展开，其径向依赖性由球贝塞尔函数和球汉克尔函数给出。利用球谐函数的正交性和 MLFMA 截断会舍弃高阶多极子这一事实，为残差范数和尾部误差构建可计算的代理。不要使用任何绕过这些基础的唯象快捷公式。\n\n在单个、完整、可运行的程序中实现以下实验：\n- 完全使用无量纲参数$x = ka$进行计算，并将入射场幅度设置为单位1，以便所有结果都是无量纲和无单位的。不需要任何物理单位。\n- 对于给定的配对$(x, p)$，将无限级数截断的安全有限上限定为$N_{\\max} = \\max(p+1, \\lceil x + 30 \\rceil)$，以确保在$x \\ll 1$到$x \\gg 1$的各种情况下数值收敛。\n- 将残差范数代理定义为$\\|r\\| = \\sqrt{ \\sum_{n=p+1}^{N_{\\max}} w_n \\left| h_n^{(1)}(x) \\right|^2 }$，其中$w_n = 2n+1$解释了球谐函数中的模态简并度。\n- 将球汉克尔级数尾部误差大小定义为$T_p(x) = \\left| \\sum_{n=p+1}^{N_{\\max}} h_n^{(1)}(x) \\right|$。\n- 为每个测试用例计算这两个度量标准，并将其报告为浮点数。此处的角度单位无关紧要，因为计算纯粹是径向的，只涉及$x$。\n\n使用以下$(x, p)$对的测试套件来检验不同的区域和截断水平：\n- 用例 1：$x = 0.1$, $p = 0$。\n- 用例 2：$x = 0.1$, $p = 2$。\n- 用例 3：$x = 1.0$, $p = 0$。\n- 用例 4：$x = 1.0$, $p = 4$。\n- 用例 5：$x = 10.0$, $p = 5$。\n- 用例 6：$x = 10.0$, $p = 15$。\n- 用例 7：$x = 50.0$, $p = 30$。\n- 用例 8：$x = 50.0$, $p = 70$。\n\n您的程序应生成一行输出，其中包含一个逗号分隔的列表，该列表用方括号括起来，其中每一项对应一个测试用例，并且是一个二元列表$[\\| r \\|, T_p(x)]$，每个浮点数四舍五入到$10$位有效数字，例如$[[\\| r \\|_1, T_p(x_1)], \\ldots, [\\| r \\|_8, T_p(x_8)]]$。", "solution": "该问题是有效的。它在计算电磁学方面有坚实的科学基础，问题陈述清晰，提供了所有必要的信息，并且其表述是客观的。该问题要求进行一项数值实验，以量化多极子方法中截断阶数对电磁散射的影响。这在诸如快速多极子方法 (FMM) 及其多层变体 (MLFMA) 等算法中是一个标准且重要的考虑因素。\n\n其物理背景是时谐平面波从半径为$a$的理想电导体 (PEC) 球体上的散射。其解是使用电场积分方程 (EFIE) 构建的，该方程强制施加边界条件，即导体表面的总切向电场必须为零：$\\vec{E}_{\\text{tan}}^{\\text{inc}} + \\vec{E}_{\\text{tan}}^{\\text{scat}} = 0$。散射场$\\vec{E}^{\\text{scat}}$是由球体上的感应表面电流$\\vec{J}_s$产生的。\n\n在球坐标系中，场很自然地使用矢量球谐函数进行展开。出射散射波的径向依赖性由第一类球汉克尔函数$h_n^{(1)}(kr)$描述，其中$k$是自由空间波数，$r$是径向距离。要完整表示散射场，需要一个由这些函数组成的无穷级数，其阶数$n$从$0$到$\\infty$。\n\n多层快速多极子算法 (MLFMA) 是一种用于求解 EFIE 的加速技术。它通过将源和观察点分组来避免直接计算所有成对相互作用。来自远处源群的场由一个截断的多极子展开表示。截断阶数（用$p$表示）决定了仅保留阶数最高为$n=p$的多极子项。这种截断是 MLFMA 中可控误差的主要来源。该问题要求使用两个基于被忽略的高阶项（$n > p$）且具有物理动机的度量标准来量化此误差。\n\n分析使用无量纲参数$x = ka$进行，该参数表示球体的电尺寸。\n\n第一个度量标准是球体表面上残差场 L2范数的一个代理，定义为\n$$\n\\| r \\| = \\sqrt{ \\sum_{n=p+1}^{N_{\\max}} w_n \\left| h_n^{(1)}(x) \\right|^2 }\n$$\n这个公式由模态展开的原理证明是合理的。球体外散射场的总能量与展开系数的平方幅值之和有关。根据矢量球谐函数在球面上的正交性，表面场的 L2范数平方与模态分量的平方幅值之和成正比。项$\\left| h_n^{(1)}(x) \\right|^2$表示阶数为$n$的单个径向模态对球体表面能量密度的贡献。权重$w_n = 2n+1$解释了模态简并度，因为对于每个阶数$n$，存在$2n+1$个正交的角向模态（球谐函数$Y_{nm}$）。求和范围涵盖了从$n=p+1$到足够大的阶数$N_{\\max}$的被忽略模态，以确保捕捉到无穷级数的尾部。因此，$\\| r \\|$模拟了场展开中被截断部分的能量含量，这对应于满足 EFIE 边界条件时的误差。\n\n第二个度量标准是球汉克尔级数尾部误差大小，定义为\n$$\nT_p(x) = \\left| \\sum_{n=p+1}^{N_{\\max}} h_n^{(1)}(x) \\right|\n$$\n这是衡量球汉克尔函数级数收敛性的一个更直接的度量。它表示径向展开中所有被截断项之和的幅值。虽然它不直接是能量范数，但对于线性依赖于这些径向函数之和的量，它提供了一个有价值且直接的截断误差评估。\n\n求和上限$N_{\\max} = \\max(p+1, \\lceil x + 30 \\rceil)$是一个确保数值收敛的实用选择。对于小的$x$，汉克尔函数随$n$迅速衰减，因此需要的项数较少。对于大的$x$，在渐近衰减开始前需要更多的项，这种行为由对$x$的依赖性捕捉。常数$30$提供了一个安全裕度。\n\n每个测试用例$(x, p)$的计算过程如下：\n1.  根据$x$和$p$确定求和上限$N_{\\max}$。\n2.  定义求和指数的范围$n \\in [p+1, p+2, \\ldots, N_{\\max}]$。\n3.  对于此范围内的每个$n$，计算第一类球汉克尔函数$h_n^{(1)}(x)$。这是一个复值函数，由$h_n^{(1)}(x) = j_n(x) + i y_n(x)$给出，其中$j_n(x)$和$y_n(x)$分别是第一类和第二类球贝塞尔函数。这些函数在像 `SciPy` 这样的科学计算库中随时可用。\n4.  通过对范围内的$n$求和$(2n+1)|h_n^{(1)}(x)|^2$，然后取和的平方根，来计算残差范数$\\| r \\|$。\n5.  通过对范围内的$n$求和复数值$h_n^{(1)}(x)$，然后取复数和的绝对值，来计算尾部误差$T_p(x)$。\n6.  然后为每个$(x, p)$对报告结果$[\\| r \\|, T_p(x)]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\ndef solve():\n    \"\"\"\n    Computes the residual norm and Hankel tail error for a set of test cases\n    related to the fast multipole method for electromagnetic scattering.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (x, p) pairs\n        (0.1, 0),\n        (0.1, 2),\n        (1.0, 0),\n        (1.0, 4),\n        (10.0, 5),\n        (10.0, 15),\n        (50.0, 30),\n        (50.0, 70),\n    ]\n\n    results = []\n    for x, p in test_cases:\n        # Step 1: Define the safe finite upper limit for truncation.\n        # N_max must be an integer for use in arange.\n        N_max = int(max(p + 1, np.ceil(x + 30)))\n\n        # Handle the case where the summation is empty.\n        if p + 1 > N_max:\n            residual_norm = 0.0\n            tail_error = 0.0\n            results.append([residual_norm, tail_error])\n            continue\n\n        # Step 2: Define the range of summation indices n.\n        n_values = np.arange(p + 1, N_max + 1)\n\n        # Step 3: Compute the spherical Hankel functions of the first kind.\n        # h_n^(1)(x) = j_n(x) + i * y_n(x)\n        # Using the sequence evaluation capability of scipy functions for efficiency.\n        jn_values = spherical_jn(n_values, x)\n        yn_values = spherical_yn(n_values, x)\n        h_n_1_values = jn_values + 1j * yn_values\n\n        # Step 4: Compute the residual norm proxy ||r||.\n        # ||r|| = sqrt( sum_{n=p+1}^{N_max} w_n * |h_n^(1)(x)|^2 )\n        # where w_n = 2n + 1\n        w_n = 2 * n_values + 1\n        residual_norm_sq = np.sum(w_n * np.abs(h_n_1_values)**2)\n        residual_norm = np.sqrt(residual_norm_sq)\n\n        # Step 5: Compute the spherical Hankel tail error magnitude T_p(x).\n        # T_p(x) = | sum_{n=p+1}^{N_max} h_n^(1)(x) |\n        tail_error = np.abs(np.sum(h_n_1_values))\n\n        # Step 6: Store the pair of metrics.\n        results.append([residual_norm, tail_error])\n\n    # Final print statement in the exact required format.\n    # Format each float to 10 significant digits using the 'g' format specifier.\n    formatted_pairs = [f\"[{format(pair[0], '.10g')}, {format(pair[1], '.10g')}]\" for pair in results]\n    final_output = f\"[{','.join(formatted_pairs)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3306982"}]}