{"hands_on_practices": [{"introduction": "在实现任何大规模数值方法之前，关键的第一步是估算所需的计算资源。此练习 [@problem_id:3288298] 将引导您分析自适应积分方法 (AIM) 的内存占用，并将其分解为主要组成部分：FFT 网格的格林函数、投影模板和近场阻抗矩阵。理解这些缩放规律对于预测在给定硬件平台上的可行性和性能至关重要。", "problem": "考虑一个三维快速傅里叶变换 (FFT) 加速的自适应积分方法 (AIM) 实现，该实现用于求解电场积分方程 (EFIE)，采用矩量法 (MoM) 进行离散化，并使用 $N$ 个 Rao–Wilton–Glisson 基函数。未知量分布在尺寸为 $L_{x}$、$L_{y}$ 和 $L_{z}$ 的矩形包围盒内，在自由空间中以频率 $f$ 进行激励。AIM 采用一个均匀的笛卡尔 FFT 网格，该网格通过对波长 $\\lambda$ 强制执行奈奎斯特-香农采样条件来自动选择，并在三个坐标方向上具有各向异性的过采样因子 $s_{x}$、$s_{y}$ 和 $s_{z}$。具体而言，网格间距为 $h_{i} = \\lambda / (2 s_{i})$（其中 $i \\in \\{x,y,z\\}$），并且每个方向上的网格大小都经过填充以减轻循环卷积的影响，即 $N_{i} = \\gamma_{i} \\,\\lceil L_{i} / h_{i} \\rceil$，其中填充因子 $\\gamma_{i} \\geq 1$。AIM 存储了所有 FFT 网格波数点上的谱域并矢格林函数 $\\hat{G}(\\boldsymbol{\\kappa})$，每个网格点有 $d_{G}$ 个独立分量，每个分量都存储为一个复双精度数。\n\n除了 $\\hat{G}$，AIM 还存储了投影模板，用于将基函数映射到网格，以及将网格场映射回测试函数。假设采用三线性投影，每个基函数的每次投影有 $n_{s}$ 个模板点，每个模板点存储一个权重（实双精度数）和三个整型网格索引。源到网格和网格到测试的模板都分别存储。最后，AIM 将近场相互作用存储为一个唯一的基函数对稀疏列表，这些基函数对处于预定的几何邻近范围内；假设每个未知量平均有 $n_{\\mathrm{nf}}$ 个近邻，并且存储为每个唯一的对保留一个复数耦合值以及标识该对的两个整型索引。\n\n使用以下物理上一致的参数：\n- 光速 $c = 3.0 \\times 10^{8} \\,\\text{m/s}$，工作频率 $f = 3.0 \\times 10^{9} \\,\\text{Hz}$，因此波长 $\\lambda = c/f$。\n- 包围盒尺寸 $L_{x} = 0.47 \\,\\text{m}$，$L_{y} = 0.36 \\,\\text{m}$，$L_{z} = 0.22 \\,\\text{m}$。\n- 过采样因子 $s_{x} = 1.4$，$s_{y} = 1.25$，$s_{z} = 1.05$，填充因子 $\\gamma_{x} = \\gamma_{y} = \\gamma_{z} = 2$。\n- 并矢格林函数存储：每个网格点 $d_{G} = 6$ 个独立分量，每个分量存储为一个复双精度数（$16$ 字节）。\n- 投影模板：每个基函数的每次投影有 $n_{s} = 8$ 个点；每个模板点存储一个实双精度数（$8$ 字节）和三个用于网格索引的 $4$ 字节整数（总计 $12$ 字节）；源到网格和网格到测试的模板都存储。\n- 近场：每个未知量的平均近邻数 $n_{\\mathrm{nf}} = 28$；每个唯一的对的存储包括一个复双精度数（$16$ 字节）和两个 $4$ 字节整数（总计 $8$ 字节）。\n- 未知量数量 $N = 450{,}000$。\n\n从 $h_{i}$ 的采样要求和填充后网格尺寸 $N_{i}$ 的定义出发，推导每个内存分量对 $N$ 和自适应网格参数的渐近依赖关系，然后计算实际的总内存占用\n$$\nM_{\\text{total}} = M_{\\hat{G}} + M_{\\text{stencils}} + M_{\\text{near-field}}\n$$\n以兆字节 (MB) 为单位，其中一兆字节定义为 $10^{6}$ 字节。将最终数值答案四舍五入到四位有效数字，并以兆字节表示。最终答案只提供 $M_{\\text{total}}$ 的单个数值。清晰地陈述你的推理和中间步骤，论证自适应网格选择对渐近和实际内存使用的影响。", "solution": "该问题陈述经评估具有科学依据、提法恰当、客观且内部一致。它为计算指定的自适应积分方法 (AIM) 实现的总内存占用提供了所有必要的参数和定义。这些参数在物理上是现实的，所描述的方法学与计算电磁学的标准实践相符。因此，该问题是有效的，我们着手进行求解。\n\n总内存占用 $M_{\\text{total}}$ 是谱域格林函数所需内存 $M_{\\hat{G}}$、投影模板所需内存 $M_{\\text{stencils}}$ 和近场阻抗矩阵所需内存 $M_{\\text{near-field}}$ 的总和。\n$$\nM_{\\text{total}} = M_{\\hat{G}} + M_{\\text{stencils}} + M_{\\text{near-field}}\n$$\n\n首先，我们分析每个内存分量对未知量数量 $N$ 的渐近依赖关系。对于表面网格，未知量数量 $N$ 与表面积除以平均单元尺寸的平方成正比。如果物体的特征尺寸为 $L_{\\text{obj}}$，则其表面积按 $L_{\\text{obj}}^2$ 的比例变化。这意味着包围盒的线性尺寸 $L_i$ 按 $L_{\\text{obj}}$ 的比例变化，进而按 $\\sqrt{N}$ 的比例变化。网格间距 $h_i$ 与波长 $\\lambda$ 成正比，而对于固定频率，$\\lambda$ 是一个常数。\n因此，每个维度上的 FFT 网格点数 $N_i$ 按以下方式变化：\n$$\nN_i = \\gamma_i \\lceil L_i / h_i \\rceil \\propto L_i \\propto \\sqrt{N}\n$$\nFFT 网格中的总点数是 $N_g = N_x N_y N_z$。其变化比例为：\n$$\nN_g \\propto (\\sqrt{N})^3 = N^{3/2}\n$$\n\n现在可以对每个内存分量进行渐近分析：\n1.  $M_{\\hat{G}}$：格林函数的内存与网格点总数 $N_g$ 成正比。因此，渐近标度为 $O(N^{3/2})$。\n2.  $M_{\\text{stencils}}$：投影模板的内存与基函数数量 $N$ 成正比。因此，渐近标度为 $O(N)$。\n3.  $M_{\\text{near-field}}$：假设每个未知量的平均近邻数 $n_{\\mathrm{nf}}$ 是常数，近场相互作用的内存也与基函数数量 $N$ 成正比。因此，渐近标度为 $M_{\\text{near-field}} \\propto O(N)$。\n\n对于大的 $N$，总内存 $M_{\\text{total}}$ 由格林函数存储的 $O(N^{3/2})$ 项主导，这是 FFT 加速方法的一个特点。\n\n接下来，我们使用给定的参数进行每个内存分量的实际计算。\n\n首先，我们计算波长 $\\lambda$：\n$$\n\\lambda = \\frac{c}{f} = \\frac{3.0 \\times 10^{8} \\,\\text{m/s}}{3.0 \\times 10^{9} \\,\\text{Hz}} = 0.1 \\,\\text{m}\n$$\n\n接着，我们使用过采样因子 $s_i$ 确定 AIM 网格间距 $h_i$：\n$$\nh_x = \\frac{\\lambda}{2 s_x} = \\frac{0.1}{2 \\times 1.4} = \\frac{0.1}{2.8} \\,\\text{m} \\\\\nh_y = \\frac{\\lambda}{2 s_y} = \\frac{0.1}{2 \\times 1.25} = \\frac{0.1}{2.5} = 0.04 \\,\\text{m} \\\\\nh_z = \\frac{\\lambda}{2 s_z} = \\frac{0.1}{2 \\times 1.05} = \\frac{0.1}{2.1} \\,\\text{m}\n$$\n\n现在，我们使用包围盒尺寸 $L_i$ 和填充因子 $\\gamma_i = 2$ 计算填充后的 FFT 网格维度 $N_i$：\n$$\nN_x = \\gamma_x \\left\\lceil \\frac{L_x}{h_x} \\right\\rceil = 2 \\left\\lceil \\frac{0.47}{0.1 / 2.8} \\right\\rceil = 2 \\lceil 0.47 \\times 28 \\rceil = 2 \\lceil 13.16 \\rceil = 2 \\times 14 = 28 \\\\\nN_y = \\gamma_y \\left\\lceil \\frac{L_y}{h_y} \\right\\rceil = 2 \\left\\lceil \\frac{0.36}{0.04} \\right\\rceil = 2 \\lceil 9 \\rceil = 2 \\times 9 = 18 \\\\\nN_z = \\gamma_z \\left\\lceil \\frac{L_z}{h_z} \\right\\rceil = 2 \\left\\lceil \\frac{0.22}{0.1 / 2.1} \\right\\rceil = 2 \\lceil 0.22 \\times 21 \\rceil = 2 \\lceil 4.62 \\rceil = 2 \\times 5 = 10\n$$\nFFT 网格中的总点数为：\n$$\nN_g = N_x \\times N_y \\times N_z = 28 \\times 18 \\times 10 = 5040\n$$\n\n有了这些中间值，我们就可以计算每个分量的内存。\n\n1.  谱域格林函数的内存，$M_{\\hat{G}}$：\n每个网格点存储 $d_G = 6$ 个独立的复双精度分量。每个复双精度数是 $16$ 字节。\n$$\nM_{\\hat{G}} = N_g \\times d_G \\times (16 \\,\\text{bytes/component}) = 5040 \\times 6 \\times 16 = 483,840 \\,\\text{bytes}\n$$\n\n2.  投影模板的内存，$M_{\\text{stencils}}$：\n为所有 $N = 450,000$ 个基函数存储了源到网格和网格到测试的模板。每个模板有 $n_s = 8$ 个点。每个点存储一个实双精度数（$8$ 字节）和三个 $4$ 字节整数（$3 \\times 4 = 12$ 字节），每个模板点共计 $8+12=20$ 字节。\n$$\nM_{\\text{stencils}} = 2 \\times N \\times n_s \\times (20 \\,\\text{bytes/point}) = 2 \\times 450,000 \\times 8 \\times 20 = 144,000,000 \\,\\text{bytes}\n$$\n\n3.  近场相互作用的内存，$M_{\\text{near-field}}$：\n$N=450,000$ 个未知量中的每一个平均有 $n_{\\mathrm{nf}}=28$ 个近邻。相互作用以唯一的对形式存储。唯一的对的数量为 $\\frac{N \\times n_{\\mathrm{nf}}}{2}$。每对的存储包括一个复双精度数（$16$ 字节）和两个用于索引的 $4$ 字节整数（$2 \\times 4 = 8$ 字节），每对共计 $16+8=24$ 字节。\n$$\nM_{\\text{near-field}} = \\frac{N \\times n_{\\mathrm{nf}}}{2} \\times (24 \\,\\text{bytes/pair}) = \\frac{450,000 \\times 28}{2} \\times 24 = 6,300,000 \\times 24 = 151,200,000 \\,\\text{bytes}\n$$\n\n最后，以字节为单位的总内存占用是这些分量的总和：\n$$\nM_{\\text{total}} = M_{\\hat{G}} + M_{\\text{stencils}} + M_{\\text{near-field}} = 483,840 + 144,000,000 + 151,200,000 = 295,683,840 \\,\\text{bytes}\n$$\n\n转换为兆字节 (MB)，使用定义 $1 \\,\\text{MB} = 10^6 \\,\\text{bytes}$：\n$$\nM_{\\text{total}} = \\frac{295,683,840}{10^6} \\,\\text{MB} = 295.68384 \\,\\text{MB}\n$$\n将结果四舍五入到四位有效数字，得到 $295.7 \\,\\text{MB}$。", "answer": "$$ \\boxed{295.7} $$", "id": "3288298"}, {"introduction": "AIM 效率的核心在于它将相互作用分解为近区和远区。本练习 [@problem_id:3288301] 提供了一种实践方法，用于制定一个复杂的自适应规则来确定近区厚度。您将从第一性原理推导出一个阈值，然后建立一个综合模型，该模型考虑了局部电尺寸和尖锐边缘等几何特征，并最终通过一个实际的校准过程来完成。", "problem": "考虑使用自适应积分方法 (AIM) 来加速求解均匀真空介质（介电常数为 $\\epsilon_0$，磁导率为 $\\mu_0$）中的离散化电场积分方程 (EFIE)。AIM 将相互作用分解为近区和远区：近区通过直接积分法处理，远区则通过插值到规则网格并与自由空间标量格林函数进行基于快速傅里叶变换的卷积来处理。标量格林函数为 $G(\\mathbf{r}) = \\dfrac{e^{-\\mathrm{i} k r}}{4 \\pi r}$，其中 $r = \\|\\mathbf{r}\\|$，$k = \\dfrac{2 \\pi f}{c}$ 是频率为 $f$ 时的自由空间波数，光速 $c = \\dfrac{1}{\\sqrt{\\mu_0 \\epsilon_0}}$。当核函数在网格步长 $h$ 上足够平滑时，远区近似是准确的。对于距离小于近区厚度 $t_{\\mathrm{nz}}$ 的相互作用，则进行精确处理，以控制奇异性和快速变化。\n\n任务 1 (从第一性原理推导)：从 $G(r) = \\dfrac{e^{-\\mathrm{i} k r}}{4 \\pi r}$ 出发，要求 $G$ 在一个网格步长 $h$ 上的局部相对变化满足 $\\left|\\dfrac{G'(r)}{G(r)}\\right| h \\le \\varepsilon$，其中 $\\varepsilon \\in (0,1)$ 是一个无量纲容差，且 $G'(r) = \\dfrac{d G}{d r}$。推导出一个阈值距离 $r_\\varepsilon$ 的显式表达式，在该距离上该边界条件变为紧约束。然后，为不等式因 $\\left(\\dfrac{\\varepsilon}{h}\\right)^2 \\le k^2$ 而无法满足的情况，指定一个鲁棒的备用方案。\n\n任务 2 (复合自适应规则)：引入局部电尺寸 $k a$（其中 $a$ 是特征局部网格单元尺寸），以考虑单元覆盖区上的相位变化。进一步引入基于相邻网格面元之间二面角 $\\phi$（单位为度）的锐边修正，其中 $\\phi = 180^\\circ$ 表示局部平坦，较小的 $\\phi$ 表示更锐利的边缘。定义边锐度因子 $s(\\phi) = \\sin\\!\\left(\\dfrac{\\pi - \\phi_{\\mathrm{rad}}}{2}\\right)$，其中 $\\phi_{\\mathrm{rad}}$ 是以弧度为单位的角度。提出以下复合自适应近区厚度规则：\n$$\nt_{\\mathrm{nz}}(k, a, h, \\varepsilon, \\phi; \\alpha, \\beta) \\;=\\; \\min\\!\\Bigg(3 a,\\; r_\\varepsilon + \\alpha\\, a\\, \\max\\!\\left(0,\\, \\frac{k a}{2 \\varepsilon} - 1\\right) + \\beta\\, a\\, s(\\phi)\\Bigg),\n$$\n其中 $\\alpha$ 和 $\\beta$ 是无量纲校准参数，$r_\\varepsilon$ 是任务 1 中得到的阈值距离，上限 $3 a$ 用于防止当网格步长过粗时近区的无界增长。\n\n任务 3 (使用锐边测试问题进行校准)：使用三个校准问题，通过最小二乘法校准 $\\alpha$ 和 $\\beta$。这些问题提供了近区厚度的真值 $t_{\\mathrm{gt}}$（单位为米）。使用 $k = \\dfrac{2 \\pi f}{c}$，其中 $c = \\dfrac{1}{\\sqrt{\\mu_0 \\epsilon_0}}$，$\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{H/m}$，$\\epsilon_0 \\approx 8.854187817 \\times 10^{-12}\\ \\mathrm{F/m}$。\n\n校准问题 (角度单位为度，距离单位为米，频率单位为赫兹，答案单位为米)：\n- 问题 C1: $f = 1\\ \\mathrm{GHz}$，$a = 0.05\\ \\mathrm{m}$，$h = 0.01\\ \\mathrm{m}$，$\\phi = 60^\\circ$，$\\varepsilon = 0.3$，$t_{\\mathrm{gt}} = 0.102438\\ \\mathrm{m}$。\n- 问题 C2: $f = 0.5\\ \\mathrm{GHz}$，$a = 0.02\\ \\mathrm{m}$，$h = 0.005\\ \\mathrm{m}$，$\\phi = 120^\\circ$，$\\varepsilon = 0.2$，$t_{\\mathrm{gt}} = 0.031904\\ \\mathrm{m}$。\n- 问题 C3: $f = 2\\ \\mathrm{GHz}$，$a = 0.02\\ \\mathrm{m}$，$h = 0.01\\ \\mathrm{m}$，$\\phi = 45^\\circ$，$\\varepsilon = 0.2$，$t_{\\mathrm{gt}} = 0.048660\\ \\mathrm{m}$。\n\n在所有校准问题中，根据给定的 $f$ 计算 $k$。对于 $r_\\varepsilon$，使用任务 1 的推导结果；如果 $\\left(\\dfrac{\\varepsilon}{h}\\right)^2 \\le k^2$，则使用备用方案 $r_\\varepsilon = a$。通过从 $t_{\\mathrm{gt}}$ 中减去 $r_\\varepsilon$，并对两个特征 $a \\max\\!\\left(0, \\dfrac{k a}{2 \\varepsilon} - 1\\right)$ 和 $a s(\\phi)$ 进行回归，构建线性系统来估计 $\\alpha$ 和 $\\beta$。\n\n任务 4 (在测试集上进行预测)：使用校准后的 $(\\alpha, \\beta)$，为以下三个测试问题中的每一个计算近区整数层数 $L = \\left\\lceil \\dfrac{t_{\\mathrm{nz}}}{h} \\right\\rceil$。角度单位为度，距离单位为米，频率单位为赫兹，$t_{\\mathrm{nz}}$ 要求的输出单位是米，但程序必须输出整数层数。\n\n测试集：\n- 测试 T1 (远区边界条件被违反，平滑面)：$f = 3\\ \\mathrm{GHz}$，$a = 0.04\\ \\mathrm{m}$，$h = 0.008\\ \\mathrm{m}$，$\\phi = 180^\\circ$，$\\varepsilon = 0.25$。\n- 测试 T2 (小电尺寸，中等锐边)：$f = 0.3\\ \\mathrm{GHz}$，$a = 0.005\\ \\mathrm{m}$，$h = 0.002\\ \\mathrm{m}$，$\\phi = 150^\\circ$，$\\varepsilon = 0.3$。\n- 测试 T3 (中等电尺寸，直角边)：$f = 1.5\\ \\mathrm{GHz}$，$a = 0.03\\ \\mathrm{m}$，$h = 0.006\\ \\mathrm{m}$，$\\phi = 90^\\circ$，$\\varepsilon = 0.25$。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按顺序为 $\\left[L_{\\mathrm{T1}}, L_{\\mathrm{T2}}, L_{\\mathrm{T3}}\\right]$，分别对应测试 T1、T2 和 T3。例如，形如 $\\left[15,4,12\\right]$ 的输出是可接受的。", "solution": "该问题经验证具有科学依据、问题适定且客观。它包含一套完整且一致的数据和指令，用于推导、校准和应用自适应积分方法 (AIM) 中的近区厚度模型。我们将按顺序完成每个任务来解决此问题。\n\n### 任务 1：阈值距离 $r_\\varepsilon$ 的推导\n\n分析从自由空间标量格林函数开始，其表达式为：\n$$\nG(r) = \\frac{e^{-\\mathrm{i} k r}}{4 \\pi r}\n$$\n其中 $r = \\|\\mathbf{r}\\|$ 是距离，$\\mathrm{i}$ 是虚数单位，$k$ 是波数。我们的任务是基于 $G(r)$ 的局部相对变化找到一个阈值距离 $r_\\varepsilon$。第一步是计算 $G(r)$ 对 $r$ 的导数：\n$$\nG'(r) = \\frac{d}{dr} G(r) = \\frac{d}{dr} \\left( \\frac{e^{-\\mathrm{i}kr}}{4\\pi r} \\right) = \\frac{1}{4\\pi} \\left( \\frac{-\\mathrm{i}ke^{-\\mathrm{i}kr} \\cdot r - e^{-\\mathrm{i}kr} \\cdot 1}{r^2} \\right) = \\frac{e^{-\\mathrm{i}kr}}{4\\pi r^2}(-\\mathrm{i}kr - 1)\n$$\n相对变化率是比值 $\\frac{G'(r)}{G(r)}$：\n$$\n\\frac{G'(r)}{G(r)} = \\frac{\\frac{e^{-\\mathrm{i}kr}}{4\\pi r^2}(-\\mathrm{i}kr - 1)}{\\frac{e^{-\\mathrm{i}kr}}{4\\pi r}} = \\frac{-\\mathrm{i}kr - 1}{r} = -\\mathrm{i}k - \\frac{1}{r}\n$$\n这个复数量的模为：\n$$\n\\left| \\frac{G'(r)}{G(r)} \\right| = \\left| -\\mathrm{i}k - \\frac{1}{r} \\right| = \\sqrt{(-k)^2 + \\left(-\\frac{1}{r}\\right)^2} = \\sqrt{k^2 + \\frac{1}{r^2}}\n$$\n远区近似的条件是，在网格步长 $h$ 上的相对变化受容差 $\\varepsilon$ 的限制：\n$$\n\\left| \\frac{G'(r)}{G(r)} \\right| h \\le \\varepsilon\n$$\n阈值距离 $r_\\varepsilon$ 定义为该边界条件为紧约束的地方，即等式成立：\n$$\nh \\sqrt{k^2 + \\frac{1}{r_\\varepsilon^2}} = \\varepsilon\n$$\n我们求解这个方程以得到 $r_\\varepsilon$：\n$$\n\\sqrt{k^2 + \\frac{1}{r_\\varepsilon^2}} = \\frac{\\varepsilon}{h}\n$$\n$$\nk^2 + \\frac{1}{r_\\varepsilon^2} = \\left(\\frac{\\varepsilon}{h}\\right)^2\n$$\n$$\n\\frac{1}{r_\\varepsilon^2} = \\left(\\frac{\\varepsilon}{h}\\right)^2 - k^2\n$$\n$$\nr_\\varepsilon^2 = \\frac{1}{\\left(\\frac{\\varepsilon}{h}\\right)^2 - k^2}\n$$\n对距离取正平方根，得到 $r_\\varepsilon$ 的显式表达式：\n$$\nr_\\varepsilon = \\frac{1}{\\sqrt{\\left(\\frac{\\varepsilon}{h}\\right)^2 - k^2}}\n$$\n为使 $r_\\varepsilon$ 是一个实正数，分母平方根内的量必须为正，这意味着条件 $\\left(\\frac{\\varepsilon}{h}\\right)^2 - k^2  0$，即 $\\left(\\frac{\\varepsilon}{h}\\right)^2  k^2$。问题为该不等式不满足的情况（即 $\\left(\\frac{\\varepsilon}{h}\\right)^2 \\le k^2$）指定了一个鲁棒的备用方案。在这种情况下，格林函数的变化速度过快，以至于网格即使在渐近情况下也无法解析，阈值距离被设置为一个特征单元尺寸 $a$。因此，$r_\\varepsilon$ 的完整规则是：\n$$\nr_\\varepsilon = \\begin{cases} \\dfrac{1}{\\sqrt{\\left(\\frac{\\varepsilon}{h}\\right)^2 - k^2}}  \\text{若 } \\left(\\frac{\\varepsilon}{h}\\right)^2  k^2 \\\\ a  \\text{若 } \\left(\\frac{\\varepsilon}{h}\\right)^2 \\le k^2 \\end{cases}\n$$\n\n### 任务 2 和 3：模型校准\n\n复合自适应近区厚度规则如下：\n$$\nt_{\\mathrm{nz}}(k, a, h, \\varepsilon, \\phi; \\alpha, \\beta) \\;=\\; \\min\\!\\Bigg(3 a,\\; r_\\varepsilon + \\alpha\\, a\\, \\max\\!\\left(0,\\, \\frac{k a}{2 \\varepsilon} - 1\\right) + \\beta\\, a\\, s(\\phi)\\Bigg)\n$$\n其中 $s(\\phi) = \\sin\\!\\left(\\frac{\\pi - \\phi_{\\mathrm{rad}}}{2}\\right)$。参数 $\\alpha$ 和 $\\beta$ 将使用三个提供的真值问题 (C1, C2, C3) 通过最小二乘拟合进行校准。通过分离包含 $\\alpha$ 和 $\\beta$ 的项来构建回归模型：\n$$\nt_{\\mathrm{gt}} - r_\\varepsilon \\approx \\alpha\\, \\underbrace{a\\, \\max\\!\\left(0,\\, \\frac{k a}{2 \\varepsilon} - 1\\right)}_{x_1} + \\beta\\, \\underbrace{a\\, s(\\phi)}_{x_2}\n$$\n这定义了一个线性系统 $\\mathbf{y} = \\mathbf{Xp}$，其中 $\\mathbf{p} = [\\alpha, \\beta]^T$。我们为三个校准问题计算向量 $\\mathbf{y}$ 和矩阵 $\\mathbf{X}$。使用的常量为 $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{H/m}$ 和 $\\epsilon_0 = 8.854187817 \\times 10^{-12}\\ \\mathrm{F/m}$，由此可得光速 $c = (\\mu_0\\epsilon_0)^{-1/2} \\approx 299792458.02\\ \\mathrm{m/s}$。\n\n**校准问题 C1：**\n给定：$f = 1\\ \\mathrm{GHz}$，$a = 0.05\\ \\mathrm{m}$，$h = 0.01\\ \\mathrm{m}$，$\\phi = 60^\\circ$，$\\varepsilon = 0.3$，$t_{\\mathrm{gt}} = 0.102438\\ \\mathrm{m}$。\n计算：\n$k = \\frac{2\\pi f}{c} \\approx 20.958\\ \\mathrm{rad/m}$。\n检查 $r_\\varepsilon$：$(\\frac{\\varepsilon}{h})^2 = (\\frac{0.3}{0.01})^2 = 900$；$k^2 \\approx 439.257$。由于 $900  439.257$，我们使用推导出的公式：$r_{\\varepsilon,1} \\approx 0.046588\\ \\mathrm{m}$。\n特征 $x_{1,1} = 0.05 \\cdot \\max(0, \\frac{20.958 \\cdot 0.05}{2 \\cdot 0.3} - 1) \\approx 0.037327\\ \\mathrm{m}$。\n特征 $x_{2,1} = 0.05 \\cdot \\sin(\\frac{\\pi - \\pi/3}{2}) \\approx 0.043301\\ \\mathrm{m}$。\n目标 $y_1 = t_{\\mathrm{gt},1} - r_{\\varepsilon,1} = 0.102438 - 0.046588 = 0.055850\\ \\mathrm{m}$。\n\n**校准问题 C2：**\n给定：$f = 0.5\\ \\mathrm{GHz}$，$a = 0.02\\ \\mathrm{m}$，$h = 0.005\\ \\mathrm{m}$，$\\phi = 120^\\circ$，$\\varepsilon = 0.2$，$t_{\\mathrm{gt}} = 0.031904\\ \\mathrm{m}$。\n计算：\n$k = \\frac{2\\pi f}{c} \\approx 10.479\\ \\mathrm{rad/m}$。\n检查 $r_\\varepsilon$：$(\\frac{\\varepsilon}{h})^2 = (\\frac{0.2}{0.005})^2 = 1600$；$k^2 \\approx 109.814$。由于 $1600  109.814$，我们使用公式：$r_{\\varepsilon,2} \\approx 0.025905\\ \\mathrm{m}$。\n特征 $x_{1,2} = 0.02 \\cdot \\max(0, \\frac{10.479 \\cdot 0.02}{2 \\cdot 0.2} - 1) = 0\\ \\mathrm{m}$。\n特征 $x_{2,2} = 0.02 \\cdot \\sin(\\frac{\\pi - 2\\pi/3}{2}) = 0.01\\ \\mathrm{m}$。\n目标 $y_2 = t_{\\mathrm{gt},2} - r_{\\varepsilon,2} = 0.031904 - 0.025905 = 0.005999\\ \\mathrm{m}$。\n\n**校准问题 C3：**\n给定：$f = 2\\ \\mathrm{GHz}$，$a = 0.02\\ \\mathrm{m}$，$h = 0.01\\ \\mathrm{m}$，$\\phi = 45^\\circ$，$\\varepsilon = 0.2$，$t_{\\mathrm{gt}} = 0.048660\\ \\mathrm{m}$。\n计算：\n$k = \\frac{2\\pi f}{c} \\approx 41.917\\ \\mathrm{rad/m}$。\n检查 $r_\\varepsilon$：$(\\frac{\\varepsilon}{h})^2 = (\\frac{0.2}{0.01})^2 = 400$；$k^2 \\approx 1757.027$。由于 $400 \\le 1757.027$，我们使用备用方案：$r_{\\varepsilon,3} = a = 0.02\\ \\mathrm{m}$。\n特征 $x_{1,3} = 0.02 \\cdot \\max(0, \\frac{41.917 \\cdot 0.02}{2 \\cdot 0.2} - 1) \\approx 0.021917\\ \\mathrm{m}$。\n特征 $x_{2,3} = 0.02 \\cdot \\sin(\\frac{\\pi - \\pi/4}{2}) \\approx 0.018478\\ \\mathrm{m}$。\n目标 $y_3 = t_{\\mathrm{gt},3} - r_{\\varepsilon,3} = 0.048660 - 0.02 = 0.028660\\ \\mathrm{m}$。\n\n线性系统为：\n$$\n\\begin{pmatrix} 0.055850 \\\\ 0.005999 \\\\ 0.028660 \\end{pmatrix} = \\begin{pmatrix} 0.037327  0.043301 \\\\ 0.0  0.01 \\\\ 0.021917  0.018478 \\end{pmatrix} \\begin{pmatrix} \\alpha \\\\ \\beta \\end{pmatrix}\n$$\n使用线性最小二乘法求解此超定系统，得出校准后的参数：\n$$\n\\alpha \\approx 1.20002 \\quad \\text{且} \\quad \\beta \\approx 0.24997\n$$\n在后续计算中，我们将使用这些拟合值。\n\n### 任务 4：在测试集上进行预测\n\n我们现在应用校准后的模型，为三个测试问题计算近区整数层数 $L = \\lceil \\frac{t_{\\mathrm{nz}}}{h} \\rceil$。\n\n**测试 T1：**\n给定：$f = 3\\ \\mathrm{GHz}$，$a = 0.04\\ \\mathrm{m}$，$h = 0.008\\ \\mathrm{m}$，$\\phi = 180^\\circ$，$\\varepsilon = 0.25$。\n计算：\n$k \\approx 62.875\\ \\mathrm{rad/m}$。\n检查 $r_\\varepsilon$：$(\\frac{\\varepsilon}{h})^2 \\approx 976.56$；$k^2 \\approx 3953.30$。由于 $(\\frac{\\varepsilon}{h})^2 \\le k^2$，我们使用备用方案 $r_\\varepsilon = a = 0.04\\ \\mathrm{m}$。\n$\\alpha$ 项：$1.20002 \\cdot 0.04 \\cdot \\max(0, \\frac{62.875 \\cdot 0.04}{2 \\cdot 0.25} - 1) \\approx 0.19345\\ \\mathrm{m}$。\n$\\beta$ 项：$0.24997 \\cdot 0.04 \\cdot \\sin(\\frac{\\pi - \\pi}{2}) = 0\\ \\mathrm{m}$。\n未加帽的厚度：$t'_{\\mathrm{nz}} = 0.04 + 0.19345 + 0 = 0.23345\\ \\mathrm{m}$。\n加帽后的厚度：$t_{\\mathrm{nz}} = \\min(3a, t'_{\\mathrm{nz}}) = \\min(0.12, 0.23345) = 0.12\\ \\mathrm{m}$。\n层数：$L_{\\mathrm{T1}} = \\lceil \\frac{0.12}{0.008} \\rceil = \\lceil 15 \\rceil = 15$。\n\n**测试 T2：**\n给定：$f = 0.3\\ \\mathrm{GHz}$，$a = 0.005\\ \\mathrm{m}$，$h = 0.002\\ \\mathrm{m}$，$\\phi = 150^\\circ$，$\\varepsilon = 0.3$。\n计算：\n$k \\approx 6.288\\ \\mathrm{rad/m}$。\n检查 $r_\\varepsilon$：$(\\frac{\\varepsilon}{h})^2 = 22500$；$k^2 \\approx 39.53$。由于 $(\\frac{\\varepsilon}{h})^2  k^2$，我们使用公式 $r_\\varepsilon \\approx 0.006673\\ \\mathrm{m}$。\n$\\alpha$ 项：$1.20002 \\cdot 0.005 \\cdot \\max(0, \\frac{6.288 \\cdot 0.005}{2 \\cdot 0.3} - 1) = 0\\ \\mathrm{m}$。\n$\\beta$ 项：$0.24997 \\cdot 0.005 \\cdot \\sin(\\frac{\\pi - 5\\pi/6}{2}) \\approx 0.000323\\ \\mathrm{m}$。\n未加帽的厚度：$t'_{\\mathrm{nz}} = 0.006673 + 0 + 0.000323 = 0.006996\\ \\mathrm{m}$。\n加帽后的厚度：$t_{\\mathrm{nz}} = \\min(3a, t'_{\\mathrm{nz}}) = \\min(0.015, 0.006996) = 0.006996\\ \\mathrm{m}$。\n层数：$L_{\\mathrm{T2}} = \\lceil \\frac{0.006996}{0.002} \\rceil = \\lceil 3.498 \\rceil = 4$。\n\n**测试 T3：**\n给定：$f = 1.5\\ \\mathrm{GHz}$，$a = 0.03\\ \\mathrm{m}$，$h = 0.006\\ \\mathrm{m}$，$\\phi = 90^\\circ$，$\\varepsilon = 0.25$。\n计算：\n$k \\approx 31.438\\ \\mathrm{rad/m}$。\n检查 $r_\\varepsilon$：$(\\frac{\\varepsilon}{h})^2 \\approx 1736.11$；$k^2 \\approx 988.27$。由于 $(\\frac{\\varepsilon}{h})^2  k^2$，我们使用公式 $r_\\varepsilon \\approx 0.036567\\ \\mathrm{m}$。\n$\\alpha$ 项：$1.20002 \\cdot 0.03 \\cdot \\max(0, \\frac{31.438 \\cdot 0.03}{2 \\cdot 0.25} - 1) \\approx 0.031906\\ \\mathrm{m}$。\n$\\beta$ 项：$0.24997 \\cdot 0.03 \\cdot \\sin(\\frac{\\pi - \\pi/2}{2}) \\approx 0.005303\\ \\mathrm{m}$。\n未加帽的厚度：$t'_{\\mathrm{nz}} = 0.036567 + 0.031906 + 0.005303 = 0.073776\\ \\mathrm{m}$。\n加帽后的厚度：$t_{\\mathrm{nz}} = \\min(3a, t'_{\\mathrm{nz}}) = \\min(0.09, 0.073776) = 0.073776\\ \\mathrm{m}$。\n层数：$L_{\\mathrm{T3}} = \\lceil \\frac{0.073776}{0.006} \\rceil = \\lceil 12.296 \\rceil = 13$。\n\n整数层数的最终结果是 $L_{\\mathrm{T1}} = 15$，$L_{\\mathrm{T2}} = 4$ 和 $L_{\\mathrm{T3}} = 13$。", "answer": "$$ \\boxed{[15, 4, 13]} $$", "id": "3288301"}, {"introduction": "作为局部启发式方法的替代方案，可以通过对近似施加全局误差容限来确定近区/远区边界。此练习 [@problem_id:3288285] 要求您实现一种算法，该算法通过自适应调整近区半径，将近似误差的范数控制在预设阈值以下。这种方法将算法参数 ($r_{\\text{near}}$) 与所期望的模拟数值保真度直接联系起来。", "problem": "考虑用于理想电导体 (PEC) 散射体的电场积分方程 (EFIE)，其中散射电场通过 Helmholtz 方程的自由空间标量格林函数表示。在使用 Rao–Wilton–Glisson 基函数的矩量法 (MoM) 离散化中，阻抗矩阵元素 $Z_{ij}$ 涉及核函数 $G(\\mathbf{r},\\mathbf{r}') = \\dfrac{e^{\\mathrm{i}k\\|\\mathbf{r}-\\mathbf{r}'\\|}}{4\\pi\\|\\mathbf{r}-\\mathbf{r}'\\|}$ 在面元上对基函数的积分。自适应积分方法 (AIM) 将阻抗矩阵分解为近区部分 $Z_{\\text{near}}$ 和远区部分 $Z_{\\text{fft}}$，几何上邻近的相互作用所对应的矩阵元素被直接处理，而远区的相互作用则通过在规则网格上的卷积进行加速。这种分解引入了一个近区划分半径 $r_{\\text{near}}$，它决定了哪些相互作用是精确计算的，哪些是通过基于网格的卷积计算的。\n\n我们关注的量是由错误分类或截断引起的近区贡献偏差，记为 $\\Delta\\mathbf{Z}_{\\text{near}}$。它被定义为一个矩阵，其 $(i,j)$ 元素是对于本应划分为近区却被划分为远区的相互作用，其直接近区计算值与其加速近似值之间的差。我们寻求自适应地调整近区划分半径 $r_{\\text{near}}$，以使引入的误差满足一个全局算子范数约束 $\\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_2 \\le \\tau$，其中 $\\tau$ 是一个预设的容差。\n\n从 EFIE 的基本表示和自由空间格林函数的牛顿奇异性行为出发，使用以下构造来驱动该自适应过程：\n\n- 两个基函数 $i$ 和 $j$ 之间的局部奇异性度量定义为 $m_{ij} = \\dfrac{a_i a_j}{R_{ij}^2}$，其中 $a_i$ 和 $a_j$ 是特征尺寸，$R_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ 是形心间距。该度量通过其梯度的 Lipschitz 型界反映了对奇异核函数 $G$ 的一阶灵敏度。\n\n- 存在一个取决于自由空间核函数尺度的常数 $\\beta$，使得对于通过基于网格的近似处理的相互作用，一个保守的逐元素界满足 $|\\Delta Z_{ij}| \\le \\beta\\, m_{ij}$。对于标量格林函数的幅度包络，使用 $\\beta = \\dfrac{1}{4\\pi}$。\n\n- 使用 Frobenius 范数界 $\\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_2 \\le \\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_F \\le \\sqrt{\\sum_{(i,j)\\in\\mathcal{F}(r)} b_{ij}^2}$，其中 $b_{ij} = \\beta \\dfrac{a_i a_j}{R_{ij}^2}$ 且 $\\mathcal{F}(r)$ 表示满足 $R_{ij} \\ge r$ 的远区划分配对集合，并使用不等式 $\\sqrt{\\sum_{(i,j)\\in\\mathcal{F}(r)} b_{ij}^2} \\le \\sqrt{M(r)} \\max_{(i,j)\\in\\mathcal{F}(r)} b_{ij}$，其中 $M(r) = |\\mathcal{F}(r)|$，定义单调递减函数\n$$\nf(r) = \\sqrt{M(r)}\\; \\max_{(i,j)\\in\\mathcal{F}(r)} \\left( \\beta \\frac{a_i a_j}{R_{ij}^2} \\right),\n$$\n并选择 $r_{\\text{near}}$ 作为满足 $f(r) \\le \\tau$ 的最小半径 $r \\ge h_{\\text{grid}}$，其中 $h_{\\text{grid}}$ 是 AIM 网格间距，低于此间距远区卷积假设不成立。\n\n实现一个算法，给定基函数形心 $\\{\\mathbf{r}_i\\}$、尺寸 $\\{a_i\\}$ 和网格间距 $h_{\\text{grid}}$，计算满足 $f(r_{\\text{near}}) \\le \\tau$ 的最小允许近区划分半径 $r_{\\text{near}}$（单位为米）。在 $r \\in [h_{\\text{grid}}, r_{\\max}]$ 上使用鲁棒的单调二分法，其中 $r_{\\max}$ 是集合中的最大形心间距，并选择 $r_{\\text{near}}$ 作为在数值容差内满足不等式的下界最小半径。在计算中，只处理 $i \\neq j$ 的不同配对 $(i,j)$。\n\n假设自由空间波数 $k$ 是有限且严格为正的，但为了保守的奇异性驱动的界的目的，你将只使用 $\\beta = \\dfrac{1}{4\\pi}$；不需要对 $k$ 的额外依赖。你必须：\n\n- 从 Maxwell 方程和 EFIE 核奇异性出发，推导该界的结构，并论证 $m_{ij}$ 的形式以及导致 $f(r)$ 的 Frobenius 范数到谱范数的简化。\n\n- 实现上述自适应算法。\n\n- 将你的实现应用于以下测试套件。所有几何量均以米为单位，你的程序必须以六位小数输出 $r_{\\text{near}}$（单位为米）。\n\n测试套件（每个案例提供 $(\\{\\mathbf{r}_i\\}, \\{a_i\\}, h_{\\text{grid}}, \\tau)$）：\n\n1. 案例 A（中等容差，密集面片）：\n   - 位置：$\\{\\mathbf{r}_i\\}_{i=1}^9$ 是 $z=0$ 平面上一个 $3 \\times 3$ 网格的形心，间距为 $0.1$，即 $(0.0,0.0,0.0)$, $(0.1,0.0,0.0)$, $(0.2,0.0,0.0)$, $(0.0,0.1,0.0)$, $(0.1,0.1,0.0)$, $(0.2,0.1,0.0)$, $(0.0,0.2,0.0)$, $(0.1,0.2,0.0)$, $(0.2,0.2,0.0)$。\n   - 尺寸：对所有 $i$，$a_i = 0.1$。\n   - 网格间距：$h_{\\text{grid}} = 0.12$。\n   - 容差：$\\tau = 0.3$。\n\n2. 案例 B（严格容差，相同面片）：\n   - 位置：与案例 A 相同。\n   - 尺寸：与案例 A 相同。\n   - 网格间距：$h_{\\text{grid}} = 0.12$。\n   - 容差：$\\tau = 0.05$。\n\n3. 案例 C（稀疏，大间距）：\n   - 位置：$\\{\\mathbf{r}_i\\}_{i=1}^4$ 是 $(0.0,0.0,0.0)$, $(2.0,0.0,0.0)$, $(0.0,2.0,0.0)$, $(2.0,2.0,0.0)$。\n   - 尺寸：对所有 $i$，$a_i = 0.05$。\n   - 网格间距：$h_{\\text{grid}} = 0.2$。\n   - 容差：$\\tau = 0.1$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔的列表，列表内容是自适应调整后的半径。每个条目格式化为六位小数，单位为米，例如 $[\\text{r\\_A},\\text{r\\_B},\\text{r\\_C}]$，其中 $\\text{r\\_A}$、$\\text{r\\_B}$ 和 $\\text{r\\_C}$ 分别是为案例 A、B 和 C 计算出的 $r_{\\text{near}}$。", "solution": "该问题陈述已经过严格审查，并被确定为有效。它在科学上基于计算电磁学的原理，特别是矩量法 (MoM) 和自适应积分方法 (AIM)。该问题定义良好、客观，并提供了制定和求解自适应近区划分半径所需的所有信息。所述方法虽然基于一系列保守的界，但在快速多极或 AIM 环境中，代表了一种合理且算法上易于处理的误差控制方法。\n\n我们现在将继续提供一个完整的、有理有据的解决方案，从理论推导开始，然后是算法实现。\n\n### 理论基础与推导\n\n该问题根植于针对理想电导体 (PEC) 散射的电场积分方程 (EFIE) 的数值解。EFIE 将散射体表面 $S$ 上感应的未知表面电流 $\\mathbf{J}(\\mathbf{r}')$ 与已知的入射电场 $\\mathbf{E}^{\\text{inc}}(\\mathbf{r})$ 联系起来：\n$$\n\\mathbf{\\hat{n}} \\times \\mathbf{E}^{\\text{inc}}(\\mathbf{r}) = -\\mathbf{\\hat{n}} \\times \\left[ -j\\omega\\mu_0 \\int_S G(\\mathbf{r}, \\mathbf{r}') \\mathbf{J}(\\mathbf{r}') dS' - \\frac{1}{j\\omega\\epsilon_0} \\nabla \\int_S G(\\mathbf{r}, \\mathbf{r}') (\\nabla' \\cdot \\mathbf{J}(\\mathbf{r}')) dS' \\right], \\quad \\mathbf{r} \\in S\n$$\n该积分方程的核是亥姆霍兹方程的自由空间标量格林函数，由下式给出：\n$$\nG(\\mathbf{r}, \\mathbf{r}') = \\frac{e^{\\mathrm{i}k\\|\\mathbf{r}-\\mathbf{r}'\\|}}{4\\pi\\|\\mathbf{r}-\\mathbf{r}'\\|}\n$$\n其中 $k$ 是自由空间波数。该核的一个关键特征是当 $\\|\\mathbf{r}-\\mathbf{r}'\\| \\to 0$ 时它的奇异性，此时其行为类似于 $1/\\|\\mathbf{r}-\\mathbf{r}'\\|$。这即是所谓的牛顿奇异性。EFIE 算子更具奇异性，涉及格林函数的梯度，表现出 $1/\\|\\mathbf{r}-\\mathbf{r}'\\|^2$ 的奇异行为。\n\n在矩量法 (MoM) 中，未知电流 $\\mathbf{J}$ 使用一组 $N$ 个基函数 $\\mathbf{f}_j(\\mathbf{r})$ 进行展开，对于三角形网格通常使用 Rao-Wilton-Glisson (RWG) 函数：$\\mathbf{J}(\\mathbf{r}) = \\sum_{j=1}^N I_j \\mathbf{f}_j(\\mathbf{r})$。这种离散化将积分方程转换为一个稠密的线性方程组 $\\mathbf{Z}\\mathbf{I} = \\mathbf{V}$，其中 $\\mathbf{I}$ 是未知电流系数的向量。阻抗矩阵元素 $Z_{ij}$ 表示基函数 $i$ 和基函数 $j$ 之间的相互作用。\n\n自适应积分方法 (AIM) 通过将阻抗矩阵 $\\mathbf{Z}$ 分解为一个稀疏的近区部分和一个结构化的远区部分来加速求解此系统所需的矩阵向量乘积：$\\mathbf{Z} = \\mathbf{Z}_{\\text{near}} + \\mathbf{Z}_{\\text{fft}}$。几何上“邻近”的基函数之间的相互作用被直接计算并存储在 $\\mathbf{Z}_{\\text{near}}$ 中，而“远”相互作用则通过在规则网格上的卷积进行近似，并使用快速傅里叶变换 (FFT) 高效计算。\n\n将基函数对分类为“近”或“远”的标准是一个分离半径 $r_{\\text{near}}$。如果一对 $(i, j)$ 的形心分离 $R_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ 小于 $r_{\\text{near}}$，则为近区对；否则为远区对。基于 FFT 的远相互作用近似会引入误差。问题定义了一个矩阵 $\\Delta\\mathbf{Z}_{\\text{near}}$ 来表示通过网格近似处理的相互作用所产生的误差。该问题的目标是找到一个合适的 $r_{\\text{near}}$ 来控制这个误差。\n\n问题为任何被视为远区的对 $(i, j)$ 的误差幅度 $|\\Delta Z_{ij}|$ 提供了一个保守的、逐元素的界：\n$$\n|\\Delta Z_{ij}| \\le \\beta \\, m_{ij} = \\beta \\frac{a_i a_j}{R_{ij}^2}\n$$\n这里，$a_i$ 和 $a_j$ 是基函数的特征尺寸，$R_{ij}$ 是它们的分离距离。这个界的动机在于，远场近似（如 AIM 中使用的多极展开）中的主要误差项与算子中最强的奇异性成正比，在 EFIE 中，该奇异性按 $1/R_{ij}^2$ 比例变化。项 $a_i a_j$ 代表基函数的“源强度”或面积的乘积。常数 $\\beta = 1/(4\\pi)$ 是从格林函数本身的幅度包络导出的一个比例因子。\n\n为了控制全局误差，对误差矩阵的谱范数施加了一个约束：$\\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_2 \\le \\tau$，其中 $\\tau$ 为给定容差。计算谱范数成本高昂，因此通过 Frobenius 范数使用一个标准的、更易于处理的上界：\n$$\n\\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_2 \\le \\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_F = \\sqrt{\\sum_{i=1}^N \\sum_{j=1}^N |\\Delta Z_{ij}|^2}\n$$\n误差 $\\Delta Z_{ij}$ 仅对于被分类为远区的对 $(i, j)$ 非零。设 $\\mathcal{F}(r)$ 是满足 $R_{ij} \\ge r$ 的有序对 $(i,j)$，$i\\neq j$ 的集合。如果我们选择 $r_{\\text{near}} = r$，这些就是由 FFT 处理的对。代入逐元素误差界，我们得到：\n$$\n\\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_F^2 \\le \\sum_{(i,j)\\in\\mathcal{F}(r)} \\left(\\beta \\frac{a_i a_j}{R_{ij}^2}\\right)^2\n$$\n为了简化这个和，引入了一个更粗略的界：平方和小于或等于项数乘以最大平方项。\n$$\n\\sum_{(i,j)\\in\\mathcal{F}(r)} b_{ij}^2 \\le M(r) \\left( \\max_{(i,j)\\in\\mathcal{F}(r)} b_{ij} \\right)^2\n$$\n其中 $b_{ij} = \\beta \\frac{a_i a_j}{R_{ij}^2}$ 且 $M(r) = |\\mathcal{F}(r)|$ 是远区集合中有序对的数量。\n\n结合这些不等式，原始约束 $\\|\\|\\Delta\\mathbf{Z}_{\\text{near}}\\|\\|_2 \\le \\tau$ 在以下条件下得到满足：\n$$\n\\sqrt{M(r)} \\max_{(i,j)\\in\\mathcal{F}(r)} \\left( \\beta \\frac{a_i a_j}{R_{ij}^2} \\right) \\le \\tau\n$$\n这定义了需要控制的函数：\n$$\nf(r) = \\sqrt{M(r)} \\max_{(i,j)\\in\\mathcal{F}(r)} \\left( \\beta \\frac{a_i a_j}{R_{ij}^2} \\right)\n$$\n问题是找到最小的半径 $r_{\\text{near}} = r$，使得 $r \\ge h_{\\text{grid}}$ 且 $f(r) \\le \\tau$。AIM 网格间距 $h_{\\text{grid}}$ 作为 $r_{\\text{near}}$ 的硬性下界，低于此值，卷积模型无效。\n\n### 通过二分法的算法求解\n\n函数 $f(r)$ 是单调非增的。随着 $r$ 的增加，远区对集合 $\\mathcal{F}(r)$ 会缩小或保持不变，因此 $M(r)$ 和最大项都是非增的。这种单调性允许使用二分算法高效地搜索最优的 $r_{\\text{near}}$。\n\n算法流程如下：\n1.  **初始化**：给定基函数形心 $\\{\\mathbf{r}_i\\}_{i=1}^N$、尺寸 $\\{a_i\\}_{i=1}^N$、网格间距 $h_{\\text{grid}}$ 和容差 $\\tau$。使用常数 $\\beta = 1/(4\\pi)$。\n2.  **预处理**：对于不同的对 $\\{i,j\\}$，$i \\neq j$，计算所有唯一的对间距离 $R_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ 和相应的奇异性度量 $m_{ij} = a_i a_j / R_{ij}^2$。将这些值存储在数组中以便高效查找。\n3.  **搜索区间**：在区间 $[r_{\\text{low}}, r_{\\text{high}}]$ 上搜索 $r_{\\text{near}}$。初始下界为 $r_{\\text{low}} = h_{\\text{grid}}$。初始上界 $r_{\\text{high}}$ 设为观测到的最大对间分离距离，$r_{\\max} = \\max_{i \\neq j} R_{ij}$。如果 $f(h_{\\text{grid}}) \\le \\tau$，则最小允许半径就是 $h_{\\text{grid}}$ 本身，无需搜索。否则，进行二分法。\n4.  **二分法**：算法迭代地将搜索区间减半：\n    a.  计算中点 $r_{\\text{mid}} = (r_{\\text{low}} + r_{\\text{high}}) / 2$。\n    b.  评估 $f(r_{\\text{mid}})$。这包括：\n        i.  识别所有满足 $R_{ij} \\ge r_{\\text{mid}}$ 的对 $\\{i,j\\}$。\n        ii. 计此种无序对的数量，设为 $P$。有序对的总数为 $M(r_{\\text{mid}}) = 2P$。\n        iii. 在这组对中找到 $b_{ij} = \\beta m_{ij}$ 的最大值。\n        iv. 计算 $f(r_{\\text{mid}}) = \\sqrt{M(r_{\\text{mid}})} \\times \\max b_{ij}$。如果没有对满足 $R_{ij} \\ge r_{\\text{mid}}$，则 $M=0$ 且 $f(r_{\\text{mid}})=0$。\n    c.  根据结果更新区间：\n        - 如果 $f(r_{\\text{mid}}) \\le \\tau$：$r_{\\text{mid}}$ 是一个有效（允许）的半径。可能存在更小的有效半径，因此我们更新上界：$r_{\\text{high}} = r_{\\text{mid}}$。\n        - 如果 $f(r_{\\text{mid}})  \\tau$：$r_{\\text{mid}}$ 太小。半径必须更大，因此我们更新下界：$r_{\\text{low}} = r_{\\text{mid}}$。\n5.  **终止**：循环继续进行固定次数的迭代，或直到区间 $(r_{\\text{high}} - r_{\\text{low}})$ 小于指定的数值精度。最终结果 $r_{\\text{near}}$ 是 $r_{\\text{high}}$ 的收敛值，它代表了搜索找到的满足条件的最小半径。\n\n此过程根据指定的误差控制模型，稳健而高效地计算所需的最小近区半径。", "answer": "$$ \\boxed{[0.120000, 0.228516, 0.200000]} $$", "id": "3288285"}]}