{"hands_on_practices": [{"introduction": "一阶玻恩近似通过忽略散射体内不同部分之间的相互作用（即多重散射）来简化问题。本实践旨在通过构建一个包含两个点散射体的思想实验，来量化分析作为多重散射效应的二阶玻恩项，并揭示其如何导致一阶近似的失效。通过计算一个偏离指标 [@problem_id:3290130]，你将亲手探究散射体间距和耦合强度对近似精度的影响。", "problem": "你需要研究在标量时谐亥姆霍兹设定下，两个相同点散射体之间的多重散射和相干相互作用，并通过探测器线上的干涉图样来量化观察到的玻恩近似失效的起始点。从二维空间中标量亥姆霍兹方程开始，描述总场 $E(\\mathbf{r})$，\n$$\n\\nabla^2 E(\\mathbf{r}) + k_0^2 \\bigl(1 + \\chi(\\mathbf{r})\\bigr) E(\\mathbf{r}) = 0,\n$$\n其中 $k_0 = 2\\pi/\\lambda$ 是波长为 $\\lambda$ 的自由空间波数，$\\chi(\\mathbf{r})$ 是一个无量纲的散射衬度。相关的 Lippmann–Schwinger 积分方程为\n$$\nE(\\mathbf{r}) = E_{\\mathrm{inc}}(\\mathbf{r}) + k_0^2 \\int_{\\mathbb{R}^2} G(\\mathbf{r},\\mathbf{r}') \\chi(\\mathbf{r}') E(\\mathbf{r}') \\,\\mathrm{d}\\mathbf{r}',\n$$\n其中 $E_{\\mathrm{inc}}(\\mathbf{r})$ 是入射场，$G(\\mathbf{r},\\mathbf{r}')$ 是二维自由空间格林函数，定义为\n$$\nG(\\mathbf{r},\\mathbf{r}') = \\frac{i}{4} H_0^{(1)}\\!\\big(k_0 \\lVert \\mathbf{r}-\\mathbf{r}' \\rVert\\big),\n$$\n其中 $H_0^{(1)}$ 是零阶第一类汉克尔函数。考虑两个相同的点散射体，其衬度为 $\\chi_0$，分别位于 $\\mathbf{r}_1 = (-d/2,0)$ 和 $\\mathbf{r}_2 = (d/2,0)$，因此衬度分布为\n$$\n\\chi(\\mathbf{r}) = \\chi_0 \\delta(\\mathbf{r}-\\mathbf{r}_1) + \\chi_0 \\delta(\\mathbf{r}-\\mathbf{r}_2).\n$$\n假设入射场为沿 $x$ 轴传播的平面波，$E_{\\mathrm{inc}}(\\mathbf{r}) = e^{i k_0 x}$。一阶玻恩近似将 Lippmann–Schwinger 积分中的 $E(\\mathbf{r}')$ 替换为 $E_{\\mathrm{inc}}(\\mathbf{r}')$。当积分被积函数中的 $E(\\mathbf{r}')$ 被其一阶玻恩场替换时，便产生二阶玻恩项，从而得到一个二重积分项。使用 $\\chi(\\mathbf{r})$ 的分布表示，该二重积分简化为一个离散和。在此设定下，你必须通过仅保留交叉散射项来模拟两个散射体之间的相干相互作用，即与 $G(\\mathbf{r}_1,\\mathbf{r}_2)$ 或 $G(\\mathbf{r}_2,\\mathbf{r}_1)$ 成比例的项，并忽略自相互作用项 $G(\\mathbf{r}_j,\\mathbf{r}_j)$，以避免点散射体模型中的奇异自作用项。这对应于多重散射近似中排除自能的常规主值解释。\n\n你的任务是：\n- 推导位于 $y=L$ 探测器线上的一阶玻恩散射场 $E^{(1)}(\\mathbf{r})$ 和二阶玻恩交叉散射场 $E^{(2)}_{\\mathrm{cross}}(\\mathbf{r})$ 的表达式，它们是观测坐标 $x$ 和间距 $d$ 的函数，使用上面定义的二维格林函数。\n- 展示随着 $d$ 的变化，二阶玻恩交叉项如何通过 $G(\\mathbf{r}_1,\\mathbf{r}_2)$ 编码相干相互作用。\n- 设计一个基于干涉的定量指标，用于检测玻恩近似失效的起始点：定义一阶玻恩模型下的探测器强度，\n$$\nI_1(x) = \\big\\lvert E^{(1)}(x,L)\\big\\rvert^2,\n$$\n以及包含一阶和二阶交叉项的强度，\n$$\nI_{12}(x) = \\big\\lvert E^{(1)}(x,L) + E^{(2)}_{\\mathrm{cross}}(x,L)\\big\\rvert^2.\n$$\n定义最大相对偏差\n$$\nR = \\frac{\\max_{x\\in[-X_{\\max},X_{\\max}]} \\big\\lvert I_{12}(x) - I_1(x)\\big\\rvert}{\\max_{x\\in[-X_{\\max},X_{\\max}]} I_1(x)},\n$$\n这是一个无单位小数。该指标反映了相干多重散射相对于一阶玻恩预测的强度。你将为几组参数计算 $R$，从而设计一个实验，以检测随着 $d$ 变化和 $\\chi_0$ 增加时玻恩近似失效的起始点，使用的判据是：较大的 $R$ 值表示与一阶玻恩干涉图样的偏离更强。\n\n物理单位和数值约定：\n- 所有长度（$\\lambda$、$d$、$L$、$X_{\\max}$）均以米（m）为单位。\n- 入射角以弧度为单位；此处为沿 $x$ 轴的 $0$ 弧度。\n- 输出 $R$ 是无单位的，必须表示为小数。\n\n实现一个完整、可运行的程序，该程序：\n- 使用如上所述的二维格林函数 $G(\\mathbf{r},\\mathbf{r}')$。\n- 为在 $\\left[-X_{\\max},X_{\\max}\\right]$ 上均匀分布的 $N_x$ 个探测点 $x$ 数组，计算 $E^{(1)}(x,L)$ 和 $E^{(2)}_{\\mathrm{cross}}(x,L)$。\n- 为下面列出的每个测试用例计算上面定义的指标 $R$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔结果列表，例如 $\\left[0.12345,0.06789\\right]$。\n\n测试套件：\n- 用例 1：$\\lambda = 0.5$ m, $\\chi_0 = 0.05$, $d = 0.05$ m, $L = 2.0$ m, $X_{\\max} = 1.0$ m, $N_x = 1001$。\n- 用例 2：$\\lambda = 0.5$ m, $\\chi_0 = 0.20$, $d = 0.05$ m, $L = 2.0$ m, $X_{\\max} = 1.0$ m, $N_x = 1001$。\n- 用例 3：$\\lambda = 0.5$ m, $\\chi_0 = 0.05$, $d = 0.5$ m, $L = 2.0$ m, $X_{\\max} = 1.0$ m, $N_x = 1001$。\n- 用例 4：$\\lambda = 0.5$ m, $\\chi_0 = 0.05$, $d = 5.0$ m, $L = 2.0$ m, $X_{\\max} = 1.0$ m, $N_x = 1001$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表，按上述用例顺序列出，例如 $\\left[r_1,r_2,r_3,r_4\\right]$，其中每个 $r_j$ 是为用例 $j$ 计算出的 $R$ 的小数值。", "solution": "该问题要求使用 Lippmann-Schwinger 积分方程的玻恩级数展开，分析二维空间中两个点散射体之间的多重散射。目标是推导一阶和二阶（仅交叉项）散射场，然后用这些场构建一个定量指标 $R$，用于衡量与一阶玻恩近似的偏差。将为几组参数计算该指标。\n\n分析从描述总场 $E(\\mathbf{r})$ 在散射衬度为 $\\chi(\\mathbf{r})$ 的介质中的时谐标量亥姆霍兹方程开始：\n$$\n\\nabla^2 E(\\mathbf{r}) + k_0^2 \\bigl(1 + \\chi(\\mathbf{r})\\bigr) E(\\mathbf{r}) = 0,\n$$\n其中 $k_0 = 2\\pi/\\lambda$ 是自由空间波数。这个微分方程可以重构为 Lippmann-Schwinger 积分方程：\n$$\nE(\\mathbf{r}) = E_{\\mathrm{inc}}(\\mathbf{r}) + k_0^2 \\int_{\\mathbb{R}^2} G(\\mathbf{r},\\mathbf{r}') \\chi(\\mathbf{r}') E(\\mathbf{r}') \\,\\mathrm{d}\\mathbf{r}',\n$$\n其中 $E_{\\mathrm{inc}}(\\mathbf{r})$ 是入射场，$G(\\mathbf{r},\\mathbf{r}')$ 是自由空间格林函数。在二维中，$G(\\mathbf{r},\\mathbf{r}') = \\frac{i}{4} H_0^{(1)}\\!\\big(k_0 \\lVert \\mathbf{r}-\\mathbf{r}' \\rVert\\big)$，其中 $H_0^{(1)}$ 是零阶第一类汉克尔函数。\n\n问题考虑了两个强度为 $\\chi_0$ 的相同点散射体，分别位于 $\\mathbf{r}_1 = (-d/2, 0)$ 和 $\\mathbf{r}_2 = (d/2, 0)$。因此，散射衬度由狄拉克δ函数之和建模：\n$$\n\\chi(\\mathbf{r}) = \\chi_0 \\delta(\\mathbf{r}-\\mathbf{r}_1) + \\chi_0 \\delta(\\mathbf{r}-\\mathbf{r}_2).\n$$\n入射场是沿 $x$ 轴传播的平面波，$E_{\\mathrm{inc}}(\\mathbf{r}) = e^{i k_0 x}$。\n\n**一阶玻恩散射场 $E^{(1)}(\\mathbf{r})$ 的推导**\n\n一阶玻恩近似 $E^{(1)}(\\mathbf{r})$ 是通过将积分内的总场 $E(\\mathbf{r}')$ 替换为入射场 $E_{\\mathrm{inc}}(\\mathbf{r}')$ 得到的。这代表单次散射事件。\n$$\nE^{(1)}(\\mathbf{r}) = k_0^2 \\int_{\\mathbb{R}^2} G(\\mathbf{r},\\mathbf{r}') \\chi(\\mathbf{r}') E_{\\mathrm{inc}}(\\mathbf{r}') \\,\\mathrm{d}\\mathbf{r}'.\n$$\n代入 $\\chi(\\mathbf{r}')$ 的表达式并利用δ函数的筛选性质，我们得到：\n$$\nE^{(1)}(\\mathbf{r}) = k_0^2 \\int_{\\mathbb{R}^2} G(\\mathbf{r},\\mathbf{r}') \\left[ \\chi_0 \\delta(\\mathbf{r}'-\\mathbf{r}_1) + \\chi_0 \\delta(\\mathbf{r}'-\\mathbf{r}_2) \\right] E_{\\mathrm{inc}}(\\mathbf{r}') \\,\\mathrm{d}\\mathbf{r}' \\\\\n= k_0^2 \\chi_0 \\left[ G(\\mathbf{r},\\mathbf{r}_1) E_{\\mathrm{inc}}(\\mathbf{r}_1) + G(\\mathbf{r},\\mathbf{r}_2) E_{\\mathrm{inc}}(\\mathbf{r}_2) \\right].\n$$\n散射体位置处的入射场值为 $E_{\\mathrm{inc}}(\\mathbf{r}_1) = e^{i k_0 (-d/2)} = e^{-i k_0 d/2}$ 和 $E_{\\mathrm{inc}}(\\mathbf{r}_2) = e^{i k_0 (d/2)} = e^{i k_0 d/2}$。因此，一阶散射场为：\n$$\nE^{(1)}(\\mathbf{r}) = k_0^2 \\chi_0 \\left[ G(\\mathbf{r},\\mathbf{r}_1) e^{-i k_0 d/2} + G(\\mathbf{r},\\mathbf{r}_2) e^{i k_0 d/2} \\right].\n$$\n\n**二阶玻恩交叉散射场 $E^{(2)}_{\\mathrm{cross}}(\\mathbf{r})$ 的推导**\n\n二阶玻恩项 $E^{(2)}(\\mathbf{r})$ 是通过在 Lippmann-Schwinger 积分中使用一阶散射场 $E^{(1)}(\\mathbf{r}')$ 得到的。这解释了双重散射事件。\n$$\nE^{(2)}(\\mathbf{r}) = k_0^2 \\int_{\\mathbb{R}^2} G(\\mathbf{r},\\mathbf{r}') \\chi(\\mathbf{r}') E^{(1)}(\\mathbf{r}') \\,\\mathrm{d}\\mathbf{r}'.\n$$\n代入 $E^{(1)}(\\mathbf{r}')$ 的积分形式会得到一个二重积分：\n$$\nE^{(2)}(\\mathbf{r}) = (k_0^2)^2 \\iint G(\\mathbf{r}, \\mathbf{r}') \\chi(\\mathbf{r}') G(\\mathbf{r}',\\mathbf{r}'') \\chi(\\mathbf{r}'') E_{\\mathrm{inc}}(\\mathbf{r}'') \\,\\mathrm{d}\\mathbf{r}'' \\mathrm{d}\\mathbf{r}'.\n$$\n使用 $\\chi$ 的δ函数模型将积分分解为关于散射体索引 $j,k \\in \\{1,2\\}$ 的离散和：\n$$\nE^{(2)}(\\mathbf{r}) = (k_0^2 \\chi_0)^2 \\sum_{j=1}^{2} \\sum_{k=1}^{2} G(\\mathbf{r},\\mathbf{r}_j) G(\\mathbf{r}_j,\\mathbf{r}_k) E_{\\mathrm{inc}}(\\mathbf{r}_k).\n$$\n问题指定只保留交叉散射项，即 $j \\neq k$ 的情况。这是一个标准程序，用以避免与点散射体自相互作用相关的非物理奇异性（$G(\\mathbf{r}_j,\\mathbf{r}_j)$ 项）。这对应于波从散射体 $k$ 传播到散射体 $j$，然后再到观察者。因此，交叉散射场为：\n$$\nE^{(2)}_{\\mathrm{cross}}(\\mathbf{r}) = (k_0^2 \\chi_0)^2 \\left[ G(\\mathbf{r},\\mathbf{r}_1) G(\\mathbf{r}_1,\\mathbf{r}_2) E_{\\mathrm{inc}}(\\mathbf{r}_2) + G(\\mathbf{r},\\mathbf{r}_2) G(\\mathbf{r}_2,\\mathbf{r}_1) E_{\\mathrm{inc}}(\\mathbf{r}_1) \\right].\n$$\n利用格林函数的互易性，$G(\\mathbf{r}_1,\\mathbf{r}_2) = G(\\mathbf{r}_2,\\mathbf{r}_1) = \\frac{i}{4} H_0^{(1)}(k_0 d)$，以及入射场的值，我们得到：\n$$\nE^{(2)}_{\\mathrm{cross}}(\\mathbf{r}) = (k_0^2 \\chi_0)^2 G(\\mathbf{r}_1,\\mathbf{r}_2) \\left[ G(\\mathbf{r},\\mathbf{r}_1) e^{i k_0 d/2} + G(\\mathbf{r},\\mathbf{r}_2) e^{-i k_0 d/2} \\right].\n$$\n该项明确包含因子 $G(\\mathbf{r}_1,\\mathbf{r}_2)$，它调节了两个散射体之间的相干相互作用。其大小取决于间距 $d$。\n\n**最终表达式和定量指标**\n\n为了进行数值计算，我们在探测器线上的一个观察点 $\\mathbf{r} = (x, L)$ 处评估场。令 $G_j(x,L) = G((x,L), \\mathbf{r}_j)$。所需的场为：\n$$\nE^{(1)}(x,L) = k_0^2 \\chi_0 \\left[ G_1(x,L) e^{-i k_0 d/2} + G_2(x,L) e^{i k_0 d/2} \\right]\n$$\n$$\nE^{(2)}_{\\mathrm{cross}}(x,L) = (k_0^2 \\chi_0)^2 G(\\mathbf{r}_1,\\mathbf{r}_2) \\left[ G_1(x,L) e^{i k_0 d/2} + G_2(x,L) e^{-i k_0 d/2} \\right]\n$$\n其中\n$G_1(x,L) = \\frac{i}{4} H_0^{(1)}\\!\\left(k_0 \\sqrt{(x+d/2)^2 + L^2}\\right)$,\n$G_2(x,L) = \\frac{i}{4} H_0^{(1)}\\!\\left(k_0 \\sqrt{(x-d/2)^2 + L^2}\\right)$,\n以及 $G(\\mathbf{r}_1,\\mathbf{r}_2) = \\frac{i}{4} H_0^{(1)}(k_0 d)$。\n\n强度计算为 $I_1(x) = \\big\\lvert E^{(1)}(x,L)\\big\\rvert^2$ 和 $I_{12}(x) = \\big\\lvert E^{(1)}(x,L) + E^{(2)}_{\\mathrm{cross}}(x,L)\\big\\rvert^2$。指标 $R$ 衡量了由于包含了二阶多重散射项而导致的强度图样的最大相对变化：\n$$\nR = \\frac{\\max_{x\\in[-X_{\\max},X_{\\max}]} \\big\\lvert I_{12}(x) - I_1(x)\\big\\rvert}{\\max_{x\\in[-X_{\\max},X_{\\max}]} I_1(x)}.\n$$\n\n**数值策略**\n\n计算过程首先为 $x$ 在 $[-X_{\\max}, X_{\\max}]$ 内定义一个包含 $N_x$ 个点的网格。然后，对于每一组参数 $(\\lambda, \\chi_0, d, L, X_{\\max})$：\n1.  计算波数 $k_0 = 2\\pi/\\lambda$。\n2.  将 $G_1$、$G_2$ 和 $G(\\mathbf{r}_1,\\mathbf{r}_2)$ 的汉克尔函数参数计算为 NumPy 数组。\n3.  使用 `scipy.special.hankel1` 计算格林函数。\n4.  在 $x$ 网格上以向量方式组装复值场 $E^{(1)}(x,L)$ 和 $E^{(2)}_{\\mathrm{cross}}(x,L)$。\n5.  计算强度 $I_1(x)$ 和 $I_{12}(x)$。\n6.  找到计算 $R$ 的分子和分母所需的最大值，并计算它们的比率。\n对每个测试用例重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef solve():\n    \"\"\"\n    Computes the Born breakdown indicator R for a series of test cases\n    in a 2D scalar multiple scattering problem.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (lambda (m), chi_0, d (m), L (m), X_max (m), N_x)\n    test_cases = [\n        (0.5, 0.05, 0.05, 2.0, 1.0, 1001),\n        (0.5, 0.20, 0.05, 2.0, 1.0, 1001),\n        (0.5, 0.05, 0.5, 2.0, 1.0, 1001),\n        (0.5, 0.05, 5.0, 2.0, 1.0, 1001),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current case\n        lambda_val, chi_0, d, L, X_max, N_x = case\n\n        # --- Initial Setup ---\n        # Free-space wavenumber\n        k_0 = 2.0 * np.pi / lambda_val\n        \n        # Detector coordinates\n        x_coords = np.linspace(-X_max, X_max, N_x)\n\n        # --- Green's Function Components ---\n        # Distances from each scatterer to the detector points\n        dist_1 = np.sqrt((x_coords + d / 2.0)**2 + L**2)\n        dist_2 = np.sqrt((x_coords - d / 2.0)**2 + L**2)\n\n        # Green's functions from scatterers to detector points\n        # G_j(x, L) = (i/4) * H_0^(1) (k_0 * ||r - r_j||)\n        G_1 = (1j / 4.0) * special.hankel1(0, k_0 * dist_1)\n        G_2 = (1j / 4.0) * special.hankel1(0, k_0 * dist_2)\n\n        # --- Field Calculations ---\n        # Incident field phase factors at the scatterer locations\n        # E_inc(r_1) = exp(-i*k_0*d/2) and E_inc(r_2) = exp(i*k_0*d/2)\n        phase_inc_at_r1 = np.exp(-1j * k_0 * d / 2.0)\n        phase_inc_at_r2 = np.exp(1j * k_0 * d / 2.0)\n\n        # --- First-Order Born Scattered Field E^(1) ---\n        # E^(1) = k_0^2 * chi_0 * [G_1 * E_inc(r_1) + G_2 * E_inc(r_2)]\n        E1_field = (k_0**2 * chi_0) * (G_1 * phase_inc_at_r1 + G_2 * phase_inc_at_r2)\n\n        # --- Second-Order Cross-Scattering Field E^(2)_cross ---\n        # Green's function between scatterers G(r_1, r_2)\n        # The argument is k_0 * ||r_1 - r_2|| = k_0 * d\n        G_12 = (1j / 4.0) * special.hankel1(0, k_0 * d)\n        \n        # E^(2)_cross = (k_0^2 * chi_0)^2 * G_12 * [G_1 * E_inc(r_2) + G_2 * E_inc(r_1)]\n        # Note the swapped phase factors corresponding to the interaction path\n        E2_cross_field = ((k_0**2 * chi_0)**2) * G_12 * (G_1 * phase_inc_at_r2 + G_2 * phase_inc_at_r1)\n\n        # --- Intensity Calculations ---\n        # I_1 = |E^(1)|^2\n        I_1 = np.abs(E1_field)**2\n        # I_12 = |E^(1) + E^(2)_cross|^2\n        I_12 = np.abs(E1_field + E2_cross_field)**2\n\n        # --- Quantitative Indicator R ---\n        # R = max|I_12 - I_1| / max|I_1|\n        numerator = np.max(np.abs(I_12 - I_1))\n        denominator = np.max(I_1)\n        \n        if denominator == 0:\n            # This case is physically unexpected for this problem setup.\n            # If max I_1 is 0, the first-order field is null everywhere.\n            # Assign inf if numerator is non-zero, otherwise 0.\n            R = np.inf if numerator > 0 else 0.0\n        else:\n            R = numerator / denominator\n        \n        results.append(R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3290130"}, {"introduction": "与直接线性化场的玻恩近似不同，雷托夫近似线性化的是场的复对数（即相位和对数振幅），这使其在处理相位变化较大的物体时通常更为稳健。本练习设计了一个基准场景，其中测量校准误差会导致玻恩近似得出非物理性的负吸收结果。你将学习如何利用克拉默斯-克勒尼希关系（Kramers–Kronig relations）这一物理约束来诊断和修正雷托夫近似中的这类误差，从而展示其相对于玻恩近似的优越性 [@problem_id:3290082]。", "problem": "考虑在一维平板几何结构中标量电磁场的散射问题，其中单色平面波由总场的标量亥姆霍兹方程所描述。设时谐约定为 $e^{-i\\omega t}$，标量场为 $u(x,\\omega)$，满足\n$$\n\\frac{d^2 u}{dx^2} + k_0^2 n^2(\\omega)\\,u = 0,\n$$\n其中 $k_0 = \\omega/c$，$c$ 是真空中的光速（单位为 $\\mathrm{m/s}$），$n(\\omega)$ 是复折射率。定义背景折射率 $n_0 = \\sqrt{\\varepsilon_\\infty}$，其中 $\\varepsilon_\\infty > 0$ 为实数；以及一个厚度为 $L$ 的平板，其相对介电常数 $\\varepsilon_r(\\omega)$ 具有因果性和无源性，使得在所有感兴趣的角频率 $\\omega$ 范围内，$\\operatorname{Im}\\{\\varepsilon_r(\\omega)\\} \\ge 0$（无源性）。复折射率 $n(\\omega) = \\sqrt{\\varepsilon_r(\\omega)}$ 选择在主支上，使得 $\\operatorname{Im}\\{n(\\omega)\\} \\ge 0$。入射场是一个沿 $+x$ 方向传播的平面波。\n\n定义在 $x=L$ 处的透射场，并用穿过相同厚度背景平板的透射场进行归一化，得到\n$$\nd(\\omega) = \\exp\\big( i k_0 L\\,(n(\\omega) - n_0)\\big),\n$$\n当内部反射可以忽略时，这便是精确的透射比。在实践中，测量仪器通常会引入一个未知的、与频率相关的校准增益 $g(\\omega) > 0$，从而影响测量数据，因此测得的透射比为\n$$\nd_{\\mathrm{meas}}(\\omega) = g(\\omega)\\,d(\\omega).\n$$\n\n我们希望通过线性化模型从测量数据中恢复复衬度 $\\Delta m(\\omega) = n(\\omega) - n_0 = \\Delta n(\\omega) + i\\,\\kappa(\\omega)$。两种常见的线性化方法是：\n\n1. 玻恩近似（场的线性化）：\n$$\n\\Delta m_{\\mathrm{Born}}(\\omega) \\approx \\frac{d_{\\mathrm{meas}}(\\omega) - 1}{i\\,k_0\\,L}.\n$$\n\n2. 里托夫近似（场的复对数的线性化）：\n$$\n\\psi(\\omega) = \\ln d_{\\mathrm{meas}}(\\omega), \\quad \\Delta m_{\\mathrm{Rytov}}(\\omega) \\approx \\frac{\\psi(\\omega)}{i\\,k_0\\,L}.\n$$\n\n定义吸收系数 $\\alpha(\\omega)$（单位为 $\\mathrm{m^{-1}}$）为\n$$\n\\alpha(\\omega) = 2\\,k_0\\,\\kappa(\\omega).\n$$\n无源性要求对于所有 $\\omega$，$\\alpha(\\omega) \\ge 0$。\n\n对于最小相位传输，克拉末－克朗尼关系（KK关系；以 Hendrik Anthony Kramers 和 Ralph Kronig 的名字命名）通过希尔伯特变换将相位 $\\phi(\\omega) = \\arg d(\\omega)$ 与幅度 $A(\\omega) = |d(\\omega)|$ 联系起来。在因果性和最小相位的假设下，以下关系成立（由于未知的绝对校准增益，可能存在一个附加常数）：\n$$\n\\phi(\\omega) = -\\mathcal{H}\\left[\\ln A(\\omega)\\right](\\omega) + \\phi_0,\n$$\n其中 $\\mathcal{H}[\\cdot]$ 表示频率轴上的希尔伯特变换，$\\phi_0$ 是一个实常数。等价地，\n$$\n\\ln A(\\omega) = \\mathcal{H}\\left[\\phi(\\omega)\\right](\\omega) + \\ln A_0,\n$$\n其中常数 $\\ln A_0$ 反映了未知的绝对增益。\n\n你需要设计一个基准模型（即一个频率相关的 $\\varepsilon_r(\\omega)$ 和一个带有校准增益 $g(\\omega)$ 的测量模型），使得玻恩近似在某些频率上预测出非物理的负吸收 $\\alpha_{\\mathrm{Born}}(\\omega)  0$，而与克拉末－克朗尼关系一致的里托夫重构则不会。使用一个物理上合理的德拜色散模型来表示 $\\varepsilon_r(\\omega)$：\n$$\n\\varepsilon_r(\\omega) = \\varepsilon_\\infty + \\frac{\\Delta\\varepsilon}{1 - i\\,\\omega\\,\\tau} + i\\,\\frac{\\sigma}{\\varepsilon_0\\,\\omega},\n$$\n其中 $\\varepsilon_0$ 是真空介电常数（单位为 $\\mathrm{F/m}$），$\\Delta\\varepsilon  0$，$\\tau  0$ 且 $\\sigma \\ge 0$。选择参数以确保在频带内的所有 $\\omega$ 处 $\\operatorname{Im}\\{\\varepsilon_r(\\omega)\\} \\ge 0$。\n\n为了凸显线性化的效果，定义一个平滑的实数校准增益剖面\n$$\ng(\\omega) = 1 + b\\,\\exp\\Big(-\\frac{(\\omega - \\omega_c)^2}{2\\,\\sigma_\\omega^2}\\Big),\n$$\n其中 $b \\ge 0$，$\\omega_c$ 在频带内，且 $\\sigma_\\omega  0$。此校准增益不属于物理过程，但在玻恩线性化下可能导致明显的无源性违背。应将里托夫方法与克拉末－克朗尼一致性结合使用，以诊断并校正这种校准偏差：从测量的相位 $\\phi_{\\mathrm{meas}}(\\omega) = \\arg d_{\\mathrm{meas}}(\\omega)$，通过在采样频率轴上进行离散希尔伯特变换来重构 $\\ln A(\\omega)$，然后选择附加常数以强制满足无源性，并构建 $\\psi(\\omega) = \\ln A_{\\mathrm{KK}}(\\omega) + i\\,\\phi_{\\mathrm{meas}}(\\omega)$，从而获得 $\\Delta m_{\\mathrm{Rytov}}(\\omega)$ 以及 $\\alpha_{\\mathrm{Rytov}}(\\omega)$。\n\n实现约束：\n\n- 使用角频率 $\\omega$（单位为 $\\mathrm{rad/s}$）、平板厚度 $L$（单位为 $\\mathrm{m}$），并以 $\\mathrm{m^{-1}}$ 为单位报告吸收。\n- 使用弧度作为角度单位。\n- 构建一个在有限频带 $[\\omega_{\\min},\\omega_{\\max}]$ 内均匀采样的频率网格。在进行离散希尔伯特变换之前，对数据应用适当的加窗以减少边缘效应，并通过强制无源性 $\\ln A(\\omega) \\le 0$ 来处理克拉末－克朗尼幅度重构中未知的附加常数。\n- 使用 $n(\\omega) = \\sqrt{\\varepsilon_r(\\omega)}$，并取复数平方根的主支。\n\n测试套件：\n\n设 $c = 3.0\\times 10^8\\,\\mathrm{m/s}$，$\\varepsilon_\\infty = 2.25$，$\\Delta\\varepsilon = 0.75$，$\\tau = 1.0\\times 10^{-12}\\,\\mathrm{s}$，$\\sigma = 0$，$L = 0.01\\,\\mathrm{m}$，$\\omega_{\\min} = 1.0\\times 10^{13}\\,\\mathrm{rad/s}$，$\\omega_{\\max} = 3.0\\times 10^{14}\\,\\mathrm{rad/s}$，$\\omega_c = 1.5\\times 10^{14}\\,\\mathrm{rad/s}$，以及 $\\sigma_\\omega = 2.0\\times 10^{13}\\,\\mathrm{rad/s}$。考虑以下三种校准增益：\n- 情况 1（理想路径）：$b = 0.0$。\n- 情况 2（中度偏差）：$b = 0.03$。\n- 情况 3（强度偏差）：$b = 0.08$。\n\n对于每种情况，计算\n$$\n\\alpha_{\\mathrm{Born}}(\\omega) = 2\\,k_0\\,\\operatorname{Im}\\{\\Delta m_{\\mathrm{Born}}(\\omega)\\},\n\\quad\n\\alpha_{\\mathrm{Rytov}}(\\omega) = 2\\,k_0\\,\\operatorname{Im}\\{\\Delta m_{\\mathrm{Rytov}}(\\omega)\\}.\n$$\n对于每种情况，返回一个布尔值，指明频带内是否存在任何 $\\omega$ 使得 $\\alpha_{\\mathrm{Born}}(\\omega)  0$，以及在经过克拉末－克朗尼幅度重构和无源性强制后是否存在任何 $\\omega$ 使得 $\\alpha_{\\mathrm{Rytov}}(\\omega)  0$。您的程序应生成单行输出，其中包含三种情况下的六个布尔值，按顺序聚合为一个用方括号括起来的逗号分隔列表（例如，“[b1,b2,b3,r1,r2,r3]”）。", "solution": "用户提供了一个有效的、适定的计算电磁学问题。任务是构建一个数值模型，以展示玻恩近似和里托夫近似在逆散射问题中的一个关键区别，尤其是在存在测量校准误差的情况下。我将着手提供一个完整的、有理有据的解决方案。\n\n对于每个测试用例，该解决方案主要分为四个步骤：\n1.  **基准真相模拟**：我们首先计算“真实”的物理量。频率相关的相对介电常数 $\\varepsilon_r(\\omega)$ 由德拜模型定义。\n    $$\n    \\varepsilon_r(\\omega) = \\varepsilon_\\infty + \\frac{\\Delta\\varepsilon}{1 - i\\,\\omega\\,\\tau}\n    $$\n    由于指定了 $\\sigma=0$，涉及电导率 $\\sigma$ 的项被省略。然后使用平方根的主支求得复折射率 $n(\\omega) = \\sqrt{\\varepsilon_r(\\omega)}$，确保虚部非负，即 $\\operatorname{Im}\\{n(\\omega)\\} \\ge 0$，这对应于无源介质。通过厚度为 $L$ 的平板的真实单程透射比 $d(\\omega)$ 由下式给出：\n    $$\n    d(\\omega) = \\exp\\big( i k_0 L\\,(n(\\omega) - n_0)\\big)\n    $$\n    其中 $k_0 = \\omega/c$ 是真空波数，$n_0 = \\sqrt{\\varepsilon_\\infty}$ 是背景折射率。\n\n2.  **测量模型**：模拟的“测量”数据 $d_{\\mathrm{meas}}(\\omega)$ 包括一个频率相关的实值校准增益 $g(\\omega)  0$。\n    $$\n    g(\\omega) = 1 + b\\,\\exp\\Big(-\\frac{(\\omega - \\omega_c)^2}{2\\,\\sigma_\\omega^2}\\Big)\n    $$\n    $$\n    d_{\\mathrm{meas}}(\\omega) = g(\\omega)\\,d(\\omega)\n    $$\n    此增益破坏了测量的幅度，$|d_{\\mathrm{meas}}| = g(\\omega)|d(\\omega)|$，但保持相位不变，$\\arg(d_{\\mathrm{meas}}) = \\arg(d(\\omega))$，因为 $g(\\omega)$ 是实数且为正。\n\n3.  **玻恩近似重构**：玻恩近似对散射场进行线性化。重构的材料衬度 $\\Delta m_{\\mathrm{Born}}(\\omega)$ 和相应的吸收系数 $\\alpha_{\\mathrm{Born}}(\\omega)$ 从测量数据中计算得出。\n    $$\n    \\Delta m_{\\mathrm{Born}}(\\omega) \\approx \\frac{d_{\\mathrm{meas}}(\\omega) - 1}{i\\,k_0\\,L}\n    $$\n    吸收系数为 $\\alpha(\\omega) = 2\\,k_0\\,\\operatorname{Im}\\{\\Delta m(\\omega)\\}$。经过仔细推导可得：\n    $$\n    \\alpha_{\\mathrm{Born}}(\\omega) = 2\\,k_0\\,\\operatorname{Im}\\left\\{\\frac{d_{\\mathrm{meas}}(\\omega) - 1}{i\\,k_0\\,L}\\right\\} = \\frac{2}{L}\\left(1 - \\operatorname{Re}\\{d_{\\mathrm{meas}}(\\omega)\\}\\right) = \\frac{2}{L}\\left(1 - g(\\omega)\\operatorname{Re}\\{d(\\omega)\\}\\right)\n    $$\n    项 $\\operatorname{Re}\\{d(\\omega)\\}$ 会振荡，而通过 $g(\\omega)  1$ 的放大很容易导致 $g(\\omega)\\operatorname{Re}\\{d(\\omega)\\}  1$，从而引出对有源介质的非物理预测，即 $\\alpha_{\\mathrm{Born}}(\\omega)  0$。此问题中，由于平板的电厚度非常大（即 $k_0 L$ 很大），这使得系统远远超出了玻恩近似的有效范围，从而加剧了这种失效。\n\n4.  **克拉末－克朗尼一致的里托夫重构**：里托夫近似对场的复相位（对数）进行线性化。\n    $$\n    \\Delta m_{\\mathrm{Rytov}}(\\omega) \\approx \\frac{\\ln d_{\\mathrm{meas}}(\\omega)}{i\\,k_0\\,L}\n    $$\n    关键的思路是不要直接使用 $\\ln d_{\\mathrm{meas}}(\\omega)$，因为它的实部 $\\ln|d_{\\mathrm{meas}}| = \\ln g(\\omega) + \\ln|d(\\omega)|$ 被增益所破坏。相反，我们利用克拉末－克朗尼关系，该关系连接了一个因果、最小相位函数的对数的实部和虚部。透射函数 $d(\\omega)$ 就是这样一个函数。它的相位 $\\phi(\\omega) = \\arg d(\\omega)$ 不受增益影响，即 $\\phi_{\\mathrm{meas}}(\\omega) = \\phi(\\omega)$。因此，我们可以通过希尔伯特变换，从测量的相位 $\\phi_{\\mathrm{meas}}(\\omega)$ 中重构出物理上一致的对数幅度 $\\ln A_{\\mathrm{KK}}(\\omega)$：\n    $$\n    \\ln A_{\\mathrm{KK}}(\\omega) = \\mathcal{H}[\\phi_{\\mathrm{meas}}](\\omega) + C\n    $$\n    其中 $\\mathcal{H}[\\cdot]$ 表示希尔伯特变换，$C$ 是一个常数。问题指定在有限频率网格上数值实现希尔伯特变换，为此我们对 $\\phi_{\\mathrm{meas}}$ 应用Tukey窗口以减轻边缘效应伪影。常数 $C$ 通过施加物理无源性约束 $\\alpha(\\omega) \\ge 0$ 来确定。里托夫重构的吸收为：\n    $$\n    \\alpha_{\\mathrm{Rytov}}(\\omega) = 2\\,k_0\\,\\operatorname{Im}\\left\\{\\frac{\\ln A_{\\mathrm{KK}}(\\omega) + i\\,\\phi_{\\mathrm{meas}}(\\omega)}{i\\,k_0\\,L}\\right\\} = -\\frac{2}{L}\\ln A_{\\mathrm{KK}}(\\omega)\n    $$\n    无源性 $\\alpha_{\\mathrm{Rytov}} \\ge 0$ 意味着 $\\ln A_{\\mathrm{KK}}(\\omega) \\le 0$。我们通过设置未知常数 $C$ 来强制满足这一点，使得重构的对数幅度的最大值为零：$C = -\\max(\\mathcal{H}[\\phi_{\\mathrm{meas}}](\\omega))$。通过这种构造，对于所有 $\\omega$，$\\ln A_{\\mathrm{KK}}(\\omega) \\le 0$，这保证了重构的吸收系数 $\\alpha_{\\mathrm{Rytov}}(\\omega)$ 将是非负的。此过程诊断并校正了未知的频率相关增益 $g(\\omega)$，从而得到一个物理上有效的重构结果。\n\n该实现将为每个测试用例计算 $\\alpha_{\\mathrm{Born}}(\\omega)$ 和 $\\alpha_{\\mathrm{Rytov}}(\\omega)$，并检查是否有任何值为负。我们预计玻恩近似在 $b>0$ 的情况下会失败（预测 $\\alpha  0$），而经过KK校正的里托夫方法在所有情况下都会成功（保持 $\\alpha \\ge 0$）。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.signal import hilbert\nfrom scipy.signal.windows import tukey\n\ndef solve():\n    \"\"\"\n    Solves the electromagnetics problem by comparing Born and Rytov approximations.\n\n    This function sets up a physical model of a dielectric slab, simulates a\n    \"measured\" transmission signal with a calibration gain, and then applies\n    two different reconstruction algorithms (Born and Rytov/Kramers-Kronig)\n    to recover the slab's absorption profile. It then checks each reconstruction\n    for a non-physical artifact (negative absorption).\n    \"\"\"\n\n    # Define physical constants and problem parameters from the statement.\n    c = 3.0e8  # Speed of light in vacuum, m/s\n    eps_inf = 2.25\n    delta_eps = 0.75\n    tau = 1.0e-12  # Debye relaxation time, s\n    sigma = 0.0  # Electrical conductivity, S/m\n    L = 0.01  # Slab thickness, m\n    w_min = 1.0e13  # Minimum angular frequency, rad/s\n    w_max = 3.0e14  # Maximum angular frequency, rad/s\n    w_c = 1.5e14  # Center frequency of gain profile, rad/s\n    sigma_w = 2.0e13  # Width of gain profile, rad/s\n\n    # Define the test cases for the calibration gain amplitude 'b'.\n    test_cases_b = [\n        0.0,   # Case 1: No calibration bias\n        0.03,  # Case 2: Moderate bias\n        0.08,  # Case 3: Strong bias\n    ]\n\n    # Set up the computational grid.\n    n0 = np.sqrt(eps_inf)\n    N = 4096  # Number of frequency points for high resolution.\n    omega = np.linspace(w_min, w_max, N)\n    k0 = omega / c\n\n    born_results = []\n    rytof_results = []\n\n    for b in test_cases_b:\n        # Step 1: Simulate the ground truth physics.\n        # Debye model for relative permittivity.\n        # The term with sigma is zero as per the problem statement.\n        eps_r = eps_inf + delta_eps / (1.0 - 1j * omega * tau)\n\n        # Complex refractive index (principal branch is default for np.sqrt).\n        n = np.sqrt(eps_r)\n\n        # Step 2: Simulate the measurement process.\n        # Ideal transmission ratio d(omega) neglecting internal reflections.\n        d = np.exp(1j * k0 * L * (n - n0))\n\n        # Frequency-dependent calibration gain g(omega).\n        g = 1.0 + b * np.exp(-((omega - w_c)**2) / (2.0 * sigma_w**2))\n\n        # \"Measured\" transmission ratio including the gain.\n        d_meas = g * d\n\n        # Step 3: Reconstruction using the Born approximation.\n        # The absorption coefficient from the Born model is alpha = (2/L)*(1 - Re{d_meas}).\n        alpha_born = (2.0 / L) * (1.0 - np.real(d_meas))\n        born_neg_alpha = np.any(alpha_born  0)\n        born_results.append(born_neg_alpha)\n\n        # Step 4: Reconstruction using the Kramers-Kronig-consistent Rytov approximation.\n        # The measured phase is immune to the real-valued gain g > 0.\n        phi_meas = np.angle(d_meas)\n        \n        # Apply a Tukey window to the phase data to reduce spectral leakage artifacts\n        # in the discrete Hilbert transform (FFT-based).\n        win = tukey(N, alpha=0.25)\n        phi_windowed = phi_meas * win\n        \n        # Reconstruct log-amplitude via the discrete Hilbert transform of the phase.\n        # ln(A) = H[phi]. The imaginary part of scipy's hilbert() is the transform.\n        ln_A_KK_raw = np.imag(hilbert(phi_windowed))\n\n        # Enforce passivity (alpha >= 0, which implies ln(A) = 0) by shifting\n        # the reconstructed log-amplitude so its maximum is 0.\n        ln_A_KK = ln_A_KK_raw - np.max(ln_A_KK_raw)\n        \n        # Calculate the Rytov absorption coefficient from the KK-reconstructed amplitude.\n        # alpha = -(2/L)*ln(A_KK).\n        alpha_rytof = (-2.0 / L) * ln_A_KK\n\n        # Check for non-physical negative absorption. By construction, we expect\n        # alpha_rytof >= 0, so this should be False barring numerical noise.\n        rytof_neg_alpha = np.any(alpha_rytof  0)\n        rytof_results.append(rytof_neg_alpha)\n\n    # Aggregate results in the specified order: [b1, b2, b3, r1, r2, r3].\n    final_results = born_results + rytof_results\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "id": "3290082"}, {"introduction": "基于相位的方法（如雷托夫近似）在实际应用中会面临一个关键挑战：相位缠绕。当真实相位延迟超过 $2\\pi$ 的范围时，测量值会被模糊地包裹在 $(-\\pi, \\pi]$ 区间内。本实践将指导你如何利用多频率数据和散射物理模型（相位与波数的线性关系）来解决这一问题 [@problem_id:3290093]。你将实现一个相位解缠绕算法，这在相干成像领域是一个至关重要且普遍适用的技术。", "problem": "考虑一个标量、时谐电磁场，它在波数为 $k$（单位：弧度/米）的均匀背景中，由标量亥姆霍兹方程控制。设一入射平面波 $E_{\\mathrm{inc}}(\\mathbf{r};k)$ 照射一个弱散射薄相位物体，该物体具有微小的折射率扰动 $\\delta n(\\mathbf{r})$，沿传播方向的厚度为 $T$（单位：米）。在Rytov近似下，定义Rytov变量为 $\\psi(\\mathbf{r};k) = \\ln\\left(E(\\mathbf{r};k)/E_{\\mathrm{inc}}(\\mathbf{r};k)\\right)$，其中 $E(\\mathbf{r};k)$ 是总场。对于近轴区中的薄纯相位物体，$\\psi$ 的虚部是相对于入射场的相位延迟，并且与 $k$ 近似成线性关系，即 $\\phi(\\mathbf{r};k) = \\mathrm{Im}\\,\\psi(\\mathbf{r};k) \\approx \\eta(\\mathbf{r})\\,k$，其中 $\\eta(\\mathbf{r}) = \\int \\delta n(\\mathbf{r})\\,\\mathrm{d}\\ell$ 是在观测点 $\\mathbf{r}$ 沿视线方向的有效光程扰动（单位：米）。实部 $\\mathrm{Re}\\,\\psi$ 是对数振幅，我们假设其保持在有限的动态范围内。\n\n在测量中，由于复对数或相位提取的主辐角限制，复相位只能以模 $2\\pi$ 的形式获取，因此测得的包裹相位为 $\\tilde{\\phi}(\\mathbf{r};k) = \\mathrm{wrap}\\left(\\phi(\\mathbf{r};k)\\right)$，其值被限制在区间 $(-\\pi,\\pi]$（单位：弧度）内。当 $\\lvert \\phi(\\mathbf{r};k) \\rvert$ 超过 $\\pi$ 时，这就构成了一个相位包裹问题。可以利用多波数数据，通过强制执行源自Rytov/Born线性化的跨$k$一致性来解包裹相位：两个相邻波数 $k_1$ 和 $k_2$ 之间的Rytov变量之差满足 $\\Delta \\psi(\\mathbf{r}) \\approx (k_2-k_1)\\,\\partial_k \\psi(\\mathbf{r};k)$，因此虚部遵循 $\\Delta \\phi(\\mathbf{r}) \\approx (k_2-k_1)\\,\\partial_k \\phi(\\mathbf{r};k)$。对于具有 $\\phi(\\mathbf{r};k) \\approx \\eta(\\mathbf{r})\\,k$ 的薄相位物体，可以得到 $\\partial_k \\phi(\\mathbf{r};k) \\approx \\eta(\\mathbf{r})$。\n\n您必须构建一个计算场景，该场景能够：\n1. 对于一个固定的观测点处的标量单点接收器（省略明确的 $\\mathbf{r}$ 标记，并将 $\\eta$ 视为常数），在给定波数对 $k_1$ 和 $k_2$ 的情况下，模拟真实的未包裹相位 $\\phi(\\mathbf{r};k_i) = \\eta\\,k_i$。\n2. 生成包裹测量值 $\\tilde{\\phi}(k_i) = \\mathrm{wrap}(\\phi(k_i)) \\in (-\\pi,\\pi]$，并可选地添加小的确定性扰动，以模拟有限的动态范围和量化效应。\n3. 实现一个多$k$解包裹策略，该策略使用以下公式强制执行Rytov跨波数一致性：\n$$\n\\Delta \\phi_{\\mathrm{unwrapped}} = \\mathrm{wrap}\\big(\\tilde{\\phi}(k_2) - \\tilde{\\phi}(k_1)\\big) + 2\\pi\\,m,\n$$\n其中，选择整数 $m \\in \\mathbb{Z}$ 以最小化 $\\left\\lvert \\Delta \\phi_{\\mathrm{unwrapped}} - (k_2-k_1)\\,\\eta \\right\\rvert$。这是在相位分量上强制执行 $\\Delta \\psi \\approx (k_2 - k_1)\\,\\partial_k \\psi$ 并利用 $\\partial_k \\phi \\approx \\eta$ 的结果。\n\n您的任务是实现一个程序，对下述每个测试用例，计算：\n- 真实相位差 $\\Delta \\phi_{\\mathrm{true}} = \\phi(k_2) - \\phi(k_1) = \\eta\\,(k_2-k_1)$。\n- 包裹相位差 $\\Delta \\tilde{\\phi} = \\mathrm{wrap}\\left(\\tilde{\\phi}(k_2) - \\tilde{\\phi}(k_1)\\right)$。\n- 通过选择使与 $\\Delta \\phi_{\\mathrm{true}}$ 的失配最小化的整数 $m$，计算解包裹相位差 $\\Delta \\phi_{\\mathrm{unwrapped}}$。\n- 绝对误差 $e = \\left\\lvert \\Delta \\phi_{\\mathrm{unwrapped}} - \\Delta \\phi_{\\mathrm{true}} \\right\\rvert$。\n\n所有角度必须以弧度表示。每个测试用例的输出必须是绝对误差 $e$（一个浮点数）。您的程序应生成单行输出，其中包含用逗号分隔并括在方括号中的结果（例如，“[e1,e2,e3,e4]”）。\n\n使用以下测试套件（所有 $k$ 的单位为弧度/米，$\\eta$ 的单位为米，角度的单位为弧度）：\n- 测试1（有包裹但无扰动的理想情况）：$k_1 = 20.0$, $k_2 = 22.0$, $\\eta = 0.8$, 无扰动。\n- 测试2（有显著包裹但无扰动）：$k_1 = 12.5$, $k_2 = 15.0$, $\\eta = 1.7$, 无扰动。\n- 测试3（包裹相位接近边界并有小的确定性扰动）：$k_1 = 30.0$, $k_2 = 32.8$, $\\eta = 3.05$, 在求差前，给 $\\tilde{\\phi}(k_1)$ 加上 $-0.05$，给 $\\tilde{\\phi}(k_2)$ 加上 $+0.05$。\n- 测试4（$k$ 间距小，包裹极少）：$k_1 = 100.0$, $k_2 = 100.5$, $\\eta = 2.7$, 无扰动。\n\n最终的数值输出必须是每个测试用例的绝对误差 $e$（单位为弧度），顺序与上述测试一致。\n\n您的程序必须是一个完整、可运行的实现，它能够：\n- 计算 $\\phi(k_i)$，将其包裹成 $\\tilde{\\phi}(k_i)$，应用指定的扰动（如有），计算 $\\Delta \\tilde{\\phi}$，使用带有 $\\partial_k \\phi \\approx \\eta$ 的跨$k$一致性进行解包裹，并返回每个测试用例的绝对误差 $e$。\n- 使用角度包裹约定 $\\mathrm{wrap}(\\alpha) \\in (-\\pi,\\pi]$。\n- 以“[e1,e2,e3,e4]”的精确格式打印单行。", "solution": "在尝试任何解决方案之前，需对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- **控制方程**：标量亥姆霍兹方程，用于时谐电磁场。\n- **背景介质**：均匀，波数为 $k$ (rad/m)。\n- **物体**：弱散射、薄、纯相位物体，具有小折射率扰动 $\\delta n(\\mathbf{r})$ 和厚度 $T$ (m)。\n- **入射场**：平面波 $E_{\\mathrm{inc}}(\\mathbf{r};k)$。\n- **总场**：$E(\\mathbf{r};k)$。\n- **Rytov变量**：$\\psi(\\mathbf{r};k) = \\ln\\left(E(\\mathbf{r};k)/E_{\\mathrm{inc}}(\\mathbf{r};k)\\right)$。\n- **相位模型**：对于近轴区中的薄纯相位物体，相位延迟 $\\phi(\\mathbf{r};k) = \\mathrm{Im}\\,\\psi(\\mathbf{r};k)$ 与 $k$ 近似成线性关系：$\\phi(\\mathbf{r};k) \\approx \\eta(\\mathbf{r})\\,k$。\n- **光程扰动**：$\\eta(\\mathbf{r}) = \\int \\delta n(\\mathbf{r})\\,\\mathrm{d}\\ell$ (m)。对于给定的问题，这在单个观测点被视为标量常数 $\\eta$。\n- **包裹相位测量**：$\\tilde{\\phi}(\\mathbf{r};k) = \\mathrm{wrap}\\left(\\phi(\\mathbf{r};k)\\right)$，其中 `wrap` 函数将其参数映射到区间 $(-\\pi,\\pi]$。\n- **跨波数一致性**：两个波数 $k_1$ 和 $k_2$ 之间的相位差近似为 $\\Delta \\phi(\\mathbf{r}) \\approx (k_2-k_1)\\,\\partial_k \\phi(\\mathbf{r};k)$。结合给定的相位模型，这变为 $\\Delta \\phi(\\mathbf{r}) \\approx (k_2-k_1)\\,\\eta(\\mathbf{r})$。\n- **解包裹公式**：$\\Delta \\phi_{\\mathrm{unwrapped}} = \\mathrm{wrap}\\big(\\tilde{\\phi}(k_2) - \\tilde{\\phi}(k_1)\\big) + 2\\pi\\,m$，其中 $m \\in \\mathbb{Z}$。\n- **解包裹准则**：选择整数 $m$ 以最小化 $\\left\\lvert \\Delta \\phi_{\\mathrm{unwrapped}} - (k_2-k_1)\\,\\eta \\right\\rvert$。\n- **任务**：对于每个测试用例，计算绝对误差 $e = \\left\\lvert \\Delta \\phi_{\\mathrm{unwrapped}} - \\Delta \\phi_{\\mathrm{true}} \\right\\rvert$，其中 $\\Delta \\phi_{\\mathrm{true}} = \\eta\\,(k_2-k_1)$。\n- **测试用例**：\n  1. $k_1 = 20.0$, $k_2 = 22.0$, $\\eta = 0.8$, 无扰动。\n  2. $k_1 = 12.5$, $k_2 = 15.0$, $\\eta = 1.7$, 无扰动。\n  3. $k_1 = 30.0$, $k_2 = 32.8$, $\\eta = 3.05$, 对 $\\tilde{\\phi}(k_1)$ 的扰动为 $-0.05$，对 $\\tilde{\\phi}(k_2)$ 的扰动为 $+0.05$。\n  4. $k_1 = 100.0$, $k_2 = 100.5$, $\\eta = 2.7$, 无扰动。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **有科学依据**：该问题基于Rytov近似，这是一种广泛使用且有效的波动方程线性化方法，用于解决电磁逆散射问题。相位包裹、多波数测量以及通过一致性检查进行相位解包裹等概念是相干成像和信号处理中的标准方法。相位模型 $\\phi(k) \\approx \\eta k$ 是薄物体和Born/Rytov近似的直接且有效的结果。该问题在科学上是合理的。\n2.  **适定性**：该问题指定了一个清晰的计算任务，并为每个测试用例提供了所有必要的输入（$k_1$、$k_2$、$\\eta$以及任何扰动）。为找到解包裹整数 $m$ 而需要最小化的目标函数是明确定义的，从而可以得到唯一解。所需的输出也被明确定义。\n3.  **客观性**：问题以精确、定量、客观的科学语言陈述。没有主观或基于意见的条款。\n4.  **设置不完整或矛盾**：问题是自洽的。所有变量、函数和约束都已定义。所提供的数据是充分且一致的。\n5.  **不切实际或不可行**：物理参数和提议的测量虽然为计算练习而简化，但在模拟的背景下是物理上可行的。\n6.  **病态或结构不良**：问题结构良好，引导用户从物理模型到具体算法及其测试用例。$m$ 的最小化过程是明确的，并确保唯一解的存在。\n7.  **伪深刻、琐碎或同义反复**：该问题是一个非琐碎的实现任务，它正确地模拟了通过使用来自物理模型的辅助信息来解决相位解包裹中的模糊性（找到$m$）这一核心挑战。\n8.  **超出科学可验证性范围**：该问题是一个计算任务，通过实施所描述的算法是完全可以验证的。\n\n### 步骤3：结论与行动\n该问题是有效的，因为它具有科学依据、适定、客观且完整。将提供一个解决方案。\n\n---\n\n### 解决方案\n该问题要求实现一个多波数相位解包裹算法。该算法利用了薄弱散射物体中相位累积的物理模型，该模型由Rytov近似控制。我们将首先形式化算法的步骤，然后将其应用于指定的测试用例。\n\n**1. 物理模型与测量过程**\n\n对于给定的波数 $k$，在特定观测点的真实、未包裹相位由以下线性关系建模：\n$$\n\\phi(k) = \\eta k\n$$\n其中 $\\eta$ 是有效光程扰动。这是基准真相相位。\n\n在测量中，相位通常作为复值信号的辐角被提取，这将其值限制在一个主值范围内。问题指定此范围为 $(-\\pi, \\pi]$。这个过程称为相位包裹。测量的包裹相位 $\\tilde{\\phi}(k)$ 由下式给出：\n$$\n\\tilde{\\phi}(k) = \\mathrm{wrap}(\\phi(k))\n$$\n包裹函数 $\\mathrm{wrap}(\\alpha)$ 通过加或减 $2\\pi$ 的整数倍，将任意实值角度 $\\alpha$ 映射到区间 $(-\\pi, \\pi]$。在数学上，这可以表示为：\n$$\n\\mathrm{wrap}(\\alpha) = \\alpha - 2\\pi N \\quad \\text{其中} \\quad N = \\left\\lfloor \\frac{\\alpha + \\pi}{2\\pi} \\right\\rfloor \\in \\mathbb{Z}\n$$\n或者等效地，使用 floor 函数，或者在计算上更常用 `(alpha + pi) % (2*pi) - pi`。\n\n在某些情况下，测量过程可能会引入扰动。对于给定的测试用例，我们考虑将确定性扰动 $p_1$ 和 $p_2$ 分别添加到包裹相位 $\\tilde{\\phi}(k_1)$ 和 $\\tilde{\\phi}(k_2)$ 上。\n\n**2. 相位解包裹算法**\n\n问题的核心是仅使用包裹测量值来确定两个波数 $k_1$ 和 $k_2$ 之间的真实相位差 $\\Delta\\phi_{\\mathrm{true}}$。真实相位差为：\n$$\n\\Delta\\phi_{\\mathrm{true}} = \\phi(k_2) - \\phi(k_1) = \\eta(k_2 - k_1)\n$$\n测量提供了两个包裹相位 $\\tilde{\\phi}(k_1)$ 和 $\\tilde{\\phi}(k_2)$（包括任何指定的扰动）。这些包裹相位的直接差值 $\\tilde{\\phi}(k_2) - \\tilde{\\phi}(k_1)$ 本身也存在包裹模糊性。我们首先计算包裹相位差：\n$$\n\\Delta\\tilde{\\phi} = \\mathrm{wrap}(\\tilde{\\phi}(k_2) - \\tilde{\\phi}(k_1))\n$$\n真实相位差 $\\Delta\\phi_{\\mathrm{true}}$ 和包裹相位差 $\\Delta\\tilde{\\phi}$ 通过一个未知的 $2\\pi$ 整数倍相关联：\n$$\n\\Delta\\phi_{\\mathrm{true}} = \\Delta\\tilde{\\phi} + 2\\pi m^*\n$$\n其中某个整数 $m^* \\in \\mathbb{Z}$。我们的目标是找到 $\\Delta\\phi_{\\mathrm{true}}$ 的一个估计值，我们称之为 $\\Delta\\phi_{\\mathrm{unwrapped}}$。这通过找到正确的整数 $m$ 来实现。\n$$\n\\Delta\\phi_{\\mathrm{unwrapped}} = \\Delta\\tilde{\\phi} + 2\\pi m\n$$\n问题规定应选择 $m$ 来强制与已知物理模型的一致性。具体来说，选择 $m$ 以最小化估计的解包裹相位差与理论预测的真实相位差之间的差的幅度：\n$$\n\\min_{m \\in \\mathbb{Z}} \\left| \\Delta\\phi_{\\mathrm{unwrapped}} - \\Delta\\phi_{\\mathrm{true}} \\right| = \\min_{m \\in \\mathbb{Z}} \\left| (\\Delta\\tilde{\\phi} + 2\\pi m) - \\eta(k_2 - k_1) \\right|\n$$\n为了找到最小化此表达式的整数 $m$，我们希望绝对值内的项尽可能接近于零：\n$$\n\\Delta\\tilde{\\phi} + 2\\pi m \\approx \\eta(k_2 - k_1)\n$$\n$$\n2\\pi m \\approx \\eta(k_2 - k_1) - \\Delta\\tilde{\\phi}\n$$\n$$\nm \\approx \\frac{\\eta(k_2 - k_1) - \\Delta\\tilde{\\phi}}{2\\pi}\n$$\n与此实数值最接近的整数 $m$ 可以通过四舍五入到最近的整数找到：\n$$\nm = \\mathrm{round}\\left( \\frac{\\Delta\\phi_{\\mathrm{true}} - \\Delta\\tilde{\\phi}}{2\\pi} \\right)\n$$\n\n**3. 计算步骤与误差度量**\n\n对于每个具有参数 $(k_1, k_2, \\eta, p_1, p_2)$ 的测试用例，步骤如下：\n1.  计算真实相位：$\\phi(k_1) = \\eta k_1$ 和 $\\phi(k_2) = \\eta k_2$。\n2.  计算真实相位差：$\\Delta\\phi_{\\mathrm{true}} = \\phi(k_2) - \\phi(k_1)$。\n3.  计算原始包裹相位：$\\tilde{\\phi}_0(k_1) = \\mathrm{wrap}(\\phi(k_1))$ 和 $\\tilde{\\phi}_0(k_2) = \\mathrm{wrap}(\\phi(k_2))$。\n4.  应用扰动得到最终的测量相位：$\\tilde{\\phi}(k_1) = \\tilde{\\phi}_0(k_1) + p_1$ 和 $\\tilde{\\phi}(k_2) = \\tilde{\\phi}_0(k_2) + p_2$。对于没有扰动的情况，$p_1=0$ 且 $p_2=0$。\n5.  根据测量值计算包裹相位差：$\\Delta\\tilde{\\phi} = \\mathrm{wrap}(\\tilde{\\phi}(k_2) - \\tilde{\\phi}(k_1))$。\n6.  使用上面推导的四舍五入公式确定最佳解包裹整数 $m$。\n7.  计算解包裹相位差的估计值：$\\Delta\\phi_{\\mathrm{unwrapped}} = \\Delta\\tilde{\\phi} + 2\\pi m$。\n8.  最后，计算绝对误差 $e$，这是每个测试用例所需的输出：\n    $$\n    e = \\left| \\Delta\\phi_{\\mathrm{unwrapped}} - \\Delta\\phi_{\\mathrm{true}} \\right|\n    $$\n此过程将针对四个给定的测试用例实施。案例3中的扰动引入了一个物理模型一致性检查无法纠正的误差，由此产生的非零误差 $e$ 量化了该测量噪声对解包裹结果的影响。对于其他没有扰动的情况，误差 $e$ 预计为零或接近机器精度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a multi-wavenumber phase unwrapping algorithm for a series of test cases.\n\n    The algorithm is based on the Rytov approximation for a thin phase object, where\n    the unwrapped phase is linear with the wavenumber k: phi(k) = eta * k.\n    The goal is to recover the true phase difference between two wavenumbers,\n    delta_phi_true = eta * (k2 - k1), from wrapped measurements.\n\n    The core of the method is to find an integer `m` that unwraps the phase difference\n    by minimizing the mismatch with the physically predicted phase difference.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (k1, k2, eta, perturbation1, perturbation2)\n    test_cases = [\n        (20.0, 22.0, 0.8, 0.0, 0.0),      # Test 1\n        (12.5, 15.0, 1.7, 0.0, 0.0),      # Test 2\n        (30.0, 32.8, 3.05, -0.05, 0.05),  # Test 3\n        (100.0, 100.5, 2.7, 0.0, 0.0)     # Test 4\n    ]\n\n    results = []\n\n    def wrap_to_pi(angle):\n        \"\"\"\n        Wraps an angle in radians to the interval (-pi, pi].\n        \"\"\"\n        return (angle + np.pi) % (2 * np.pi) - np.pi\n\n    for case in test_cases:\n        k1, k2, eta, p1, p2 = case\n\n        # Step 1  2: Calculate true phases and their difference.\n        # phi(k) = eta * k\n        phi_k1 = eta * k1\n        phi_k2 = eta * k2\n        delta_phi_true = phi_k2 - phi_k1\n\n        # Step 3  4: Calculate wrapped phases and apply perturbations.\n        tilde_phi_k1_raw = wrap_to_pi(phi_k1)\n        tilde_phi_k2_raw = wrap_to_pi(phi_k2)\n        \n        tilde_phi_k1 = tilde_phi_k1_raw + p1\n        tilde_phi_k2 = tilde_phi_k2_raw + p2\n        \n        # Step 5: Calculate the wrapped phase difference from measurements.\n        delta_tilde_phi = wrap_to_pi(tilde_phi_k2 - tilde_phi_k1)\n\n        # Step 6: Determine the optimal unwrapping integer 'm'.\n        # m is chosen to minimize | (delta_tilde_phi + 2*pi*m) - delta_phi_true |\n        # This is equivalent to rounding (delta_phi_true - delta_tilde_phi) / (2*pi).\n        m_float = (delta_phi_true - delta_tilde_phi) / (2 * np.pi)\n        m = np.round(m_float)\n\n        # Step 7: Compute the unwrapped phase difference.\n        delta_phi_unwrapped = delta_tilde_phi + 2 * np.pi * m\n\n        # Step 8: Compute the absolute error.\n        error = np.abs(delta_phi_unwrapped - delta_phi_true)\n        results.append(error)\n\n    # Format and print the final results\n    # Use '.16g' to ensure sufficient precision without trailing zeros.\n    print(f\"[{','.join(f'{r:.16g}' for r in results)}]\")\n\nsolve()\n```", "id": "3290093"}]}