{"hands_on_practices": [{"introduction": "我们从一个基本问题开始，分析最简单的全隐式格式——后向欧拉法。这个练习将探讨该格式在有耗介质中的应用，帮助您理解数值格式如何引入耗散效应。通过推导更新方程并计算数值耗散率，您可以深入了解数值算法的特性如何模拟或偏离真实的物理过程[@problem_id:3318776]。", "problem": "考虑一个由介电常数 $\\epsilon$、磁导率 $\\mu$ 和电导率 $\\sigma$ 表征的均匀、各向同性、线性介质。设电磁场由包含传导电流的麦克斯韦方程组描述，并假设本构关系为 $\\mathbf{D} = \\epsilon \\mathbf{E}$ 和 $\\mathbf{B} = \\mu \\mathbf{H}$ 以及欧姆定律 $\\mathbf{J} = \\sigma \\mathbf{E}$。在一维空间中，对于横电磁 (TEM) 极化（例如，$\\mathbf{E} = E_y(x,t)\\,\\hat{\\mathbf{y}}$ 和 $\\mathbf{H} = H_z(x,t)\\,\\hat{\\mathbf{z}}$ 依赖于 $x$），控制方程可以表示为 $E_y$ 和 $H_z$ 的函数。\n\n从这些定律出发，推导时域有限差分 (FDTD, Finite-Difference Time-Domain) 方法的全隐式后向欧拉时间步进格式，该格式将场从时间 $t^n$推进到 $t^{n+1} = t^n + \\Delta t$。将 $E_y^{n+1}$ 和 $H_z^{n+1}$ 的更新表示为在 $t^{n+1}$ 处计算的空间旋度算子和前一时刻的场 $E_y^n$ 和 $H_z^n$ 的函数。\n\n然后，将问题特殊化到空间均匀情况，此时空间导数为零，因此旋度项也为零。在这种均匀情况下，关注离散电场能量密度 $u_e^n = \\tfrac{1}{2}\\epsilon |E_y^n|^2$ 及其在后向欧拉格式下到 $u_e^{n+1} = \\tfrac{1}{2}\\epsilon |E_y^{n+1}|^2$ 的更新。将每个时间步长的电能数值耗散率定义为\n$$\n\\mathcal{D}_{\\text{num}}(\\Delta t) \\equiv \\frac{1}{\\Delta t}\\,\\ln\\!\\left(\\frac{u_e^n}{u_e^{n+1}}\\right),\n$$\n并确定下列哪个关于 $\\mathcal{D}_{\\text{num}}(\\Delta t)$ 的表达式是正确的，该表达式是 $\\Delta t$、$\\epsilon$、$\\mu$ 和 $\\sigma$ 的函数。\n\n选择一项：\n\nA. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{2}{\\Delta t}\\,\\ln\\!\\left(1 + \\frac{\\sigma\\,\\Delta t}{\\epsilon}\\right)$\n\nB. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{\\sigma}{\\epsilon}$\n\nC. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{2\\,\\sigma}{\\epsilon + \\mu}$\n\nD. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{1}{\\Delta t}\\,\\ln\\!\\left(1 + \\frac{\\sigma\\,\\Delta t}{\\epsilon}\\right)$", "solution": "评估问题陈述的有效性。\n\n**第 1 步：提取已知条件**\n- 介质：均匀、各向同性、线性。\n- 材料性质：介电常数 $\\epsilon$、磁导率 $\\mu$、电导率 $\\sigma$。\n- 控制方程：包含传导电流的麦克斯韦方程组。\n- 本构关系：$\\mathbf{D} = \\epsilon \\mathbf{E}$、$\\mathbf{B} = \\mu \\mathbf{H}$。\n- 欧姆定律：$\\mathbf{J} = \\sigma \\mathbf{E}$。\n- 场配置：一维空间 ($x$)，TEM 极化，$\\mathbf{E} = E_y(x,t)\\,\\hat{\\mathbf{y}}$ 和 $\\mathbf{H} = H_z(x,t)\\,\\hat{\\mathbf{z}}$。\n- 数值格式：从时间 $t^n$ 到 $t^{n+1} = t^n + \\Delta t$ 的 FDTD 全隐式后向欧拉时间步进格式。\n- 特殊情况：空间均匀场，此时空间导数（以及旋度项）为零。\n- 定义：时间步 $k$ 的离散电场能量密度 $u_e^k = \\tfrac{1}{2}\\epsilon |E_y^k|^2$。数值耗散率 $\\mathcal{D}_{\\text{num}}(\\Delta t) \\equiv \\frac{1}{\\Delta t}\\,\\ln\\!\\left(\\frac{u_e^n}{u_e^{n+1}}\\right)$。\n- 问题：确定 $\\mathcal{D}_{\\text{num}}(\\Delta t)$ 的正确表达式。\n\n**第 2 步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于经典电磁学（麦克斯韦方程组）的基本原理和标准的数值分析技术（后向欧拉有限差分格式）。这是计算电磁学中一个成熟的课题。\n- **适定性：** 问题提供了所有必要的定义，并通过清晰、连续的步骤引导推导过程。目标是推导一个特定的量，该量基于前提具有唯一的数学形式。\n- **客观性：** 语言正式、精确，没有主观性。\n\n**第 3 步：结论与行动**\n该问题科学上合理、适定、客观且自洽。这是一个有效的问题。我们可以继续进行解答。\n\n**推导**\n\n根据问题的指示，推导过程分三个阶段进行：首先，推导通用隐式更新格式；其次，将其特殊化到均匀情况；第三，计算数值耗散率。\n\n**1. 隐式后向欧拉格式的推导**\n\n我们从两个麦克斯韦旋度方程开始，并结合本构关系和欧姆定律：\n$$\n\\nabla \\times \\mathbf{H} = \\mathbf{J} + \\frac{\\partial \\mathbf{D}}{\\partial t} = \\sigma \\mathbf{E} + \\epsilon \\frac{\\partial \\mathbf{E}}{\\partial t} \\quad \\text{(安培-麦克斯韦定律)}\n$$\n$$\n\\nabla \\times \\mathbf{E} = - \\frac{\\partial \\mathbf{B}}{\\partial t} = - \\mu \\frac{\\partial \\mathbf{H}}{\\partial t} \\quad \\text{(法拉第电磁感应定律)}\n$$\n后向欧拉法将时间 $t^{n+1}$ 处的时间导数近似为 $\\frac{\\partial \\mathbf{F}}{\\partial t} \\approx \\frac{\\mathbf{F}^{n+1} - \\mathbf{F}^n}{\\Delta t}$，并在新的时间步 $t^{n+1}$ 处计算微分方程中的所有其他项。将此应用于麦克斯韦方程组，得到：\n$$\n(\\nabla \\times \\mathbf{H})^{n+1} = \\sigma \\mathbf{E}^{n+1} + \\epsilon \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t}\n$$\n$$\n(\\nabla \\times \\mathbf{E})^{n+1} = - \\mu \\frac{\\mathbf{H}^{n+1} - \\mathbf{H}^n}{\\Delta t}\n$$\n现在我们求解这些方程，得到时间 $t^{n+1}$ 处的场。根据安培-麦克斯韦定律：\n$$\n(\\nabla \\times \\mathbf{H})^{n+1} = \\left(\\sigma + \\frac{\\epsilon}{\\Delta t}\\right) \\mathbf{E}^{n+1} - \\frac{\\epsilon}{\\Delta t} \\mathbf{E}^n\n$$\n为求 $\\mathbf{E}^{n+1}$ 进行整理：\n$$\n\\left(\\sigma + \\frac{\\epsilon}{\\Delta t}\\right) \\mathbf{E}^{n+1} = \\frac{\\epsilon}{\\Delta t} \\mathbf{E}^n + (\\nabla \\times \\mathbf{H})^{n+1}\n$$\n乘以 $\\frac{\\Delta t}{\\epsilon}$ 得到：\n$$\n\\left(1 + \\frac{\\sigma \\Delta t}{\\epsilon}\\right) \\mathbf{E}^{n+1} = \\mathbf{E}^n + \\frac{\\Delta t}{\\epsilon} (\\nabla \\times \\mathbf{H})^{n+1}\n$$\n最后，求解 $\\mathbf{E}^{n+1}$：\n$$\n\\mathbf{E}^{n+1} = \\frac{1}{1 + \\frac{\\sigma \\Delta t}{\\epsilon}} \\left( \\mathbf{E}^n + \\frac{\\Delta t}{\\epsilon} (\\nabla \\times \\mathbf{H})^{n+1} \\right) = \\frac{\\epsilon}{\\epsilon + \\sigma \\Delta t} \\mathbf{E}^n + \\frac{\\Delta t}{\\epsilon + \\sigma \\Delta t} (\\nabla \\times \\mathbf{H})^{n+1}\n$$\n根据法拉第定律，求解 $\\mathbf{H}^{n+1}$ 更直接：\n$$\n\\mathbf{H}^{n+1} - \\mathbf{H}^n = - \\frac{\\Delta t}{\\mu} (\\nabla \\times \\mathbf{E})^{n+1}\n$$\n$$\n\\mathbf{H}^{n+1} = \\mathbf{H}^n - \\frac{\\Delta t}{\\mu} (\\nabla \\times \\mathbf{E})^{n+1}\n$$\n这些就是通用的隐式后向欧拉更新方程。\n\n**2. 特殊化到空间均匀情况**\n\n在空间均匀情况下，所有空间导数都为零。这意味着任何场向量的旋度都为零：\n$$\n(\\nabla \\times \\mathbf{E})^{n+1} = \\mathbf{0}\n$$\n$$\n(\\nabla \\times \\mathbf{H})^{n+1} = \\mathbf{0}\n$$\n将这些代入更新方程，可以极大地简化它们：\n$$\n\\mathbf{E}^{n+1} = \\frac{\\epsilon}{\\epsilon + \\sigma \\Delta t} \\mathbf{E}^n\n$$\n$$\n\\mathbf{H}^{n+1} = \\mathbf{H}^n\n$$\n对于指定的极化 $\\mathbf{E} = E_y(x,t)\\,\\hat{\\mathbf{y}}$，电场分量 $E_y$ 的更新为：\n$$\nE_y^{n+1} = \\frac{\\epsilon}{\\epsilon + \\sigma \\Delta t} E_y^n = \\frac{1}{1 + \\frac{\\sigma \\Delta t}{\\epsilon}} E_y^n\n$$\n\n**3. 数值耗散率的计算**\n\n问题将数值耗散率定义为 $\\mathcal{D}_{\\text{num}}(\\Delta t) \\equiv \\frac{1}{\\Delta t}\\,\\ln\\!\\left(\\frac{u_e^n}{u_e^{n+1}}\\right)$。离散电场能量密度为 $u_e^n = \\tfrac{1}{2}\\epsilon |E_y^n|^2$ 和 $u_e^{n+1} = \\tfrac{1}{2}\\epsilon |E_y^{n+1}|^2$。\n\n我们首先计算能量密度的比值：\n$$\n\\frac{u_e^n}{u_e^{n+1}} = \\frac{\\tfrac{1}{2}\\epsilon |E_y^n|^2}{\\tfrac{1}{2}\\epsilon |E_y^{n+1}|^2} = \\left|\\frac{E_y^n}{E_y^{n+1}}\\right|^2\n$$\n从上一步推导出的 $E_y$ 更新方程，我们得到场的比值：\n$$\n\\frac{E_y^{n+1}}{E_y^n} = \\frac{1}{1 + \\frac{\\sigma \\Delta t}{\\epsilon}}\n$$\n取倒数：\n$$\n\\frac{E_y^n}{E_y^{n+1}} = 1 + \\frac{\\sigma \\Delta t}{\\epsilon}\n$$\n将此代入能量比值的表达式中：\n$$\n\\frac{u_e^n}{u_e^{n+1}} = \\left(1 + \\frac{\\sigma \\Delta t}{\\epsilon}\\right)^2\n$$\n现在，我们将此结果代入数值耗散率的定义中：\n$$\n\\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{1}{\\Delta t}\\,\\ln\\!\\left(\\left(1 + \\frac{\\sigma \\Delta t}{\\epsilon}\\right)^2\\right)\n$$\n利用对数性质 $\\ln(a^b) = b\\ln(a)$，我们得到最终表达式：\n$$\n\\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{2}{\\Delta t}\\,\\ln\\!\\left(1 + \\frac{\\sigma \\Delta t}{\\epsilon}\\right)\n$$\n\n**逐项分析**\n\nA. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{2}{\\Delta t}\\,\\ln\\!\\left(1 + \\frac{\\sigma\\,\\Delta t}{\\epsilon}\\right)$\n此表达式与我们推导的结果完全匹配。\n**结论：正确**\n\nB. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{\\sigma}{\\epsilon}$\n此表达式与 $\\Delta t$ 无关。让我们考察当 $\\Delta t \\to 0$ 时我们推导结果的极限。对于小的 $x$，使用泰勒展开 $\\ln(1+x) \\approx x$：\n$$\n\\lim_{\\Delta t \\to 0} \\mathcal{D}_{\\text{num}}(\\Delta t) = \\lim_{\\Delta t \\to 0} \\frac{2}{\\Delta t} \\left(\\frac{\\sigma \\Delta t}{\\epsilon} + O((\\Delta t)^2)\\right) = \\frac{2\\sigma}{\\epsilon}\n$$\n连续时间系统 $\\frac{dE}{dt} = -\\frac{\\sigma}{\\epsilon}E$ 的解为 $E(t) = E_0 \\exp(-\\frac{\\sigma}{\\epsilon}t)$，导致能量 $u_e(t) \\propto \\exp(-\\frac{2\\sigma}{\\epsilon}t)$。精确的物理耗散率为 $\\frac{2\\sigma}{\\epsilon}$。当 $\\Delta t \\to 0$ 时，数值耗散率趋近于此值。选项 B 给出 $\\frac{\\sigma}{\\epsilon}$，与正确值相差一个因子 $2$。\n**结论：错误**\n\nC. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{2\\,\\sigma}{\\epsilon + \\mu}$\n在空间均匀情况下，电场 $\\mathbf{E}$ 的演化由常微分方程 $\\epsilon \\frac{d \\mathbf{E}}{d t} + \\sigma \\mathbf{E} = \\mathbf{0}$ 控制，该方程不涉及磁导率 $\\mu$。此选项中出现 $\\mu$ 表明它对于此特定问题是错误的。\n**结论：错误**\n\nD. $\\displaystyle \\mathcal{D}_{\\text{num}}(\\Delta t) = \\frac{1}{\\Delta t}\\,\\ln\\!\\left(1 + \\frac{\\sigma\\,\\Delta t}{\\epsilon}\\right)$\n此表达式恰好是我们推导结果的一半。如果错误地在对数中使用场的比值 $|E_y^n / E_y^{n+1}|$ 而不是能量的比值 $|E_y^n / E_y^{n+1}|^2$，就会产生这个错误。由于能量密度与场强的平方成正比，因此因子 $2$ 是必不可少的。\n**结论：错误**", "answer": "$$\\boxed{A}$$", "id": "3318776"}, {"introduction": "虽然全隐式方法在多维空间中可能计算成本高昂，但交替方向隐式（ADI）方法提供了一种高效的替代方案。本练习旨在剖析ADI-FDTD算法的内在结构，揭示其如何巧妙地将一个庞大而复杂的耦合系统分解为一系列易于求解的三对角系统[@problem_id:3318720]。理解这一结构是领会ADI-FDTD计算优势的关键。", "problem": "考虑一个在各向同性、无源介质中的二维 $z$ 方向横电（$\\mathrm{TE}_z$） Maxwell 方程组。介质的介电常数为 $\\epsilon$，磁导率为 $\\mu$。该问题在一个均匀的 Yee 网格上求解，网格间距为 $\\Delta x$ 和 $\\Delta y$，时间步长为 $\\Delta t$。电场分量 $E_x$ 和 $E_y$ 分别配置在 $(i, j+\\tfrac{1}{2})$ 和 $(i+\\tfrac{1}{2}, j)$ 位置，磁场分量 $H_z$ 配置在 $(i,j)$ 位置。控制方程为时域 Maxwell 旋度方程，\n$$\n\\partial_t E_x = \\frac{1}{\\epsilon}\\,\\partial_y H_z,\\quad\n\\partial_t E_y = -\\frac{1}{\\epsilon}\\,\\partial_x H_z,\\quad\n\\partial_t H_z = \\frac{1}{\\mu}\\left(\\partial_x E_y - \\partial_y E_x\\right).\n$$\n交替方向隐式时域有限差分（ADI-FDTD）格式将一个时间步内的更新分解为 2 次扫描。在第一个半步 $n\\to n+\\tfrac{1}{2}$ 中，更新在 $x$ 方向是隐式的，在 $y$ 方向是显式的；在第二个半步 $n+\\tfrac{1}{2}\\to n+1$ 中，更新在 $y$ 方向是隐式的，在 $x$ 方向是显式的。在 Yee 网格上使用二阶中心差分进行空间离散，并使用与上述描述一致的一阶分裂隐式-显式时间离散。从连续的 Maxwell 旋度方程和 Yee 网格差分定义出发，证明在第一次扫描中，沿每条固定的 $j$ 水平线上的未知数构成了用于 $E_y$ 更新的三对角线性系统；在第二次扫描中，沿每条固定的 $i$ 垂直线上的未知数构成了用于 $E_x$ 更新的三对角线性系统。基于此结构，设计一个直接行求解器，并根据网格大小 $N_x$ 和 $N_y$ 以及行长度 $m$ 来量化其每个时间步的计算复杂度（以浮点运算次数计）。\n\n选择所有关于 ADI-FDTD 行求解的代数结构和最终复杂度的正确陈述：\n\nA. 在每次 ADI 扫描中，沿隐式方向的网格线更新通过二阶中心差分仅耦合最近的邻居，从而产生一个三对角系统，该系统可由 Thomas 算法以 $O(m)$ 的复杂度求解，每行大约需要 $8m$ 次浮点运算；因此，每个时间步的两次扫描成本约为 $16\\,N_x N_y$ 次浮点运算，不包括用于辅助显式更新的常数项。\n\nB. Yee 网格的交错布局在每个半步中导致了与最近邻和次近邻的耦合，因此行系统是五对角的；需要一个带宽为 5 的带状求解器，每个时间步的成本尺度约为 $O\\!\\left(5\\,N_x N_y\\right)$。\n\nC. 使用理想电导体（PEC）边界，在最外层节点上对切向电场施加 Dirichlet 条件时，三对角结构保持不变；只有第一个和最后一个对角线元素被修改。如果 $\\epsilon$ 和 $\\mu$ 在空间上是均匀的，使得每次扫描中的行矩阵都相同，那么可以对所有行重复使用一次 LU 分解，从而将摊销成本降低到每次前向/后向替换约 $4m$ 次浮点运算，每个时间步约 $8\\,N_x N_y$ 次。\n\nD. 与显式时域有限差分（FDTD）相比，ADI-FDTD 在每个时间步都需要对一个稠密的全局矩阵求逆，对于总共 $N$ 个未知数，这会产生 $O(N^3)$ 的计算复杂度和 $O(N^2)$ 的内存需求。", "solution": "用户需要对一个关于二维交替方向隐式时域有限差分（ADI-FDTD）方法的问题进行严格验证和详细解答。\n\n### 步骤 1：提取已知条件\n- **公式：** 二维 $z$ 方向横电（$\\mathrm{TE}_z$）。\n- **介质：** 各向同性、无源，介电常数为 $\\epsilon$，磁导率为 $\\mu$。\n- **网格：** 均匀 Yee 网格，间距为 $\\Delta x$、$\\Delta y$，时间步长为 $\\Delta t$。\n- **场点位置：**\n    - $E_x$ 在 $(i, j+\\tfrac{1}{2})$\n    - $E_y$ 在 $(i+\\tfrac{1}{2}, j)$\n    - $H_z$ 在 $(i,j)$\n- **控制方程（连续）：**\n    $$ \\partial_t E_x = \\frac{1}{\\epsilon}\\,\\partial_y H_z $$\n    $$ \\partial_t E_y = -\\frac{1}{\\epsilon}\\,\\partial_x H_z $$\n    $$ \\partial_t H_z = \\frac{1}{\\mu}\\left(\\partial_x E_y - \\partial_y E_x\\right) $$\n- **数值格式：** ADI-FDTD，将一个时间步内的更新分解为两次扫描。\n    - **扫描 1 ($n \\to n+\\tfrac{1}{2}$):** $x$ 方向隐式，$y$ 方向显式。\n    - **扫描 2 ($n+\\tfrac{1}{2} \\to n+1$):** $y$ 方向隐式，$x$ 方向显式。\n- **离散化：** 空间上二阶中心差分；时间上一阶分裂隐式-显式离散。\n- **任务：** 证明三对角系统的形成并量化计算复杂度。\n- **网格大小：** $N_x$, $N_y$。行长度 $m$。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题基于 Maxwell 方程和 ADI-FDTD 方法，这些都是计算电磁学中标准、成熟的概念。该公式在科学上是合理的。\n2.  **适定性：** 问题提供了一组清晰的控制方程和数值方法的描述。它要求推导代数结构并分析其计算复杂度，这是数值分析中的标准任务，并能导出一个唯一且有意义的结果。\n3.  **客观性：** 语言技术性强、精确，没有主观或模糊的术语。\n4.  **完整性与一致性：** 问题提供了足够的信息来离散化方程并执行所需的分析。指定的 Yee 网格交错布局与二阶中心差分算子是一致的。没有内部矛盾。\n5.  **可行性：** 该设置描述了一个标准的计算场景。推导和复杂度分析是可行的。\n\n### 步骤 3：结论和行动\n问题陈述是有效的。这是一个计算科学中的适定问题，可以进行严格分析。现在开始求解过程。\n\n### 基于原理的推导\nADI-FDTD 方法将一个隐式-显式分裂格式应用于时域 Maxwell 方程。我们将对隐式项使用类似 Crank-Nicolson 的时间平均。设 $F^n_{i,j}$ 表示在时间步 $n$ 和网格位置 $(i,j)$ 的场 $F$。Yee 网格上的空间导数算子定义为：\n$$ \\delta_x F|_{i,j} = \\frac{F|_{i+1/2,j} - F|_{i-1/2,j}}{\\Delta x} $$\n$$ \\delta_y F|_{i,j} = \\frac{F|_{i,j+1/2} - F|_{i,j-1/2}}{\\Delta y} $$\n\n**扫描 1：从时间 $n$ 更新到 $n+\\frac{1}{2}$（$x$ 方向隐式，$y$ 方向显式）**\n\n关于 $x$ 的空间导数被隐式处理（在时间 $n$ 和 $n+\\frac{1}{2}$ 上平均），而关于 $y$ 的空间导数被显式处理（在时间 $n$ 计算）。对于时间间隔 $\\Delta t/2$ 的更新方程是：\n$$ (1) \\quad \\frac{E^{n+1/2}_x - E^n_x}{\\Delta t/2} = \\frac{1}{\\epsilon} \\delta_y H_z^n $$\n$$ (2) \\quad \\frac{E^{n+1/2}_y - E^n_y}{\\Delta t/2} = -\\frac{1}{2\\epsilon} (\\delta_x H_z^{n+1/2} + \\delta_x H_z^n) $$\n$$ (3) \\quad \\frac{H^{n+1/2}_z - H^n_z}{\\Delta t/2} = \\frac{1}{2\\mu} (\\delta_x E_y^{n+1/2} + \\delta_x E_y^n) - \\frac{1}{\\mu}\\delta_y E_x^n $$\n\n方程 (1) 是 $E_x$ 的一个完全显式更新。方程 (2) 和 (3) 构成了关于 $E_y^{n+1/2}$ 和 $H_z^{n+1/2}$ 的耦合系统。为了推导 $E_y$ 的系统，我们消去 $H_z^{n+1/2}$。从方程 (3)，我们可以在网格点 $(i,j)$ 表达 $H_z^{n+1/2}$：\n$$ H_{z,i,j}^{n+1/2} = H_{z,i,j}^n + \\frac{\\Delta t}{4\\mu} (\\delta_x E_{y,i,j}^{n+1/2} + \\delta_x E_{y,i,j}^n) - \\frac{\\Delta t}{2\\mu}\\delta_y E_{x,i,j}^n $$\n让我们将其代入网格点 $(i+\\frac{1}{2},j)$ 处的方程 (2) 的离散形式：\n$$ E_{y,i+1/2,j}^{n+1/2} - E_{y,i+1/2,j}^n = -\\frac{\\Delta t}{4\\epsilon} (\\delta_x H_{z,i+1/2,j}^{n+1/2} + \\delta_x H_{z,i+1/2,j}^n) $$\n$$ E_{y,i+1/2,j}^{n+1/2} - E_{y,i+1/2,j}^n = -\\frac{\\Delta t}{4\\epsilon \\Delta x} \\left[ (H_{z,i+1,j}^{n+1/2} - H_{z,i,j}^{n+1/2}) + (H_{z,i+1,j}^{n} - H_{z,i,j}^{n}) \\right] $$\n现在我们插入 $H_z^{n+1/2}$ 的表达式：\n$$ H_{z,i+1,j}^{n+1/2} - H_{z,i,j}^{n+1/2} = (H_{z,i+1,j}^{n} - H_{z,i,j}^{n}) + \\frac{\\Delta t}{4\\mu} (\\delta_x E_{y,i+1,j}^{n+1/2} - \\delta_x E_{y,i,j}^{n+1/2}) + ... $$\n关键项是 $\\delta_x E_y$ 算子的差值：\n$$ \\delta_x E_{y,i+1,j}^{n+1/2} - \\delta_x E_{y,i,j}^{n+1/2} = \\frac{1}{\\Delta x} \\left( E_{y,i+3/2,j}^{n+1/2} - E_{y,i+1/2,j}^{n+1/2} \\right) - \\frac{1}{\\Delta x} \\left( E_{y,i+1/2,j}^{n+1/2} - E_{y,i-1/2,j}^{n+1/2} \\right) $$\n$$ = \\frac{1}{\\Delta x} \\left( E_{y,i+3/2,j}^{n+1/2} - 2 E_{y,i+1/2,j}^{n+1/2} + E_{y,i-1/2,j}^{n+1/2} \\right) $$\n这是一个离散二阶导数算子。将其代回 $E_y$ 更新方程并收集包含 $E_y^{n+1/2}$ 的项，得到：\n$$ -\\left(\\frac{\\Delta t}{4}\\right)^2 \\frac{1}{\\epsilon\\mu\\Delta x^2} E_{y,i-1/2,j}^{n+1/2} + \\left(1 + 2\\left(\\frac{\\Delta t}{4}\\right)^2 \\frac{1}{\\epsilon\\mu\\Delta x^2}\\right) E_{y,i+1/2,j}^{n+1/2} - \\left(\\frac{\\Delta t}{4}\\right)^2 \\frac{1}{\\epsilon\\mu\\Delta x^2} E_{y,i+3/2,j}^{n+1/2} = \\mathrm{RHS}_i $$\n其中 $\\mathrm{RHS}_i$ 包含了所有在时间 $n$ 的已知场值。这是一个关于未知数 $E_y^{n+1/2}$（在索引 $(i+\\frac{1}{2},j)$ 处）的线性方程，它只与 $x$ 方向上最近的邻居，即 $(i-\\frac{1}{2},j)$ 和 $(i+\\frac{3}{2},j)$ 处的点耦合。对于一个固定的行 $j$，这就构成了一个关于未知向量 $\\{E_{y,i+1/2,j}^{n+1/2}\\}_{i=0...N_x-1}$ 的三对角方程组。\n\n**扫描 2：从时间 $n+\\frac{1}{2}$ 更新到 $n+1$（$y$ 方向隐式，$x$ 方向显式）**\n\n根据对称性，$x$ 和 $y$ 的角色互换。$E_y$ 的更新现在是显式的，而 $E_x$ 和 $H_z$ 的更新是耦合的，并且在 $y$ 方向是隐式的。一个平行的推导表明，对于每个固定的列 $i$，未知向量 $\\{E_{x,i,j+1/2}^{n+1}\\}_{j=0...N_y-1}$ 的更新构成了一个三对角系统。\n\n**计算复杂度**\n\n一个大小为 $m \\times m$ 的三对角系统可以通过 Thomas 算法（一种高斯消元法的形式）高效求解，其计算复杂度为 $O(m)$。直接求解（LU 分解和前向/后向替换）的浮点运算次数（flops）大约是 $8m$。\n\n- **扫描 1：** 我们必须为每个水平线 $j$ 求解一个三对角系统。共有 $N_y$ 条这样的线，每条线的长度为 $m = N_x$。成本为 $N_y \\times O(N_x)$。每行约 $8N_x$ 次浮点运算，总计约为 $\\approx 8 N_x N_y$ 次浮点运算。\n- **扫描 2：** 我们必须为每个垂直线 $i$ 求解一个三对角系统。共有 $N_x$ 条这样的线，每条线的长度为 $m = N_y$。成本为 $N_x \\times O(N_y)$，总计约为 $\\approx 8 N_x N_y$ 次浮点运算。\n\n每个完整时间步（$n \\to n+1$）中隐式求解的总计算成本是两次扫描成本的总和，约为 $16 N_x N_y$ 次浮点运算。这不包括显式更新和构建右侧向量的成本，这些操作的复杂度也是 $O(N_x N_y)$。\n\n### 逐项分析\n\n**A. 在每次 ADI 扫描中，沿隐式方向的网格线更新通过二阶中心差分仅耦合最近的邻居，从而产生一个三对角系统，该系统可由 Thomas 算法以 $O(m)$ 的复杂度求解，每行大约需要 $8m$ 次浮点运算；因此，每个时间步的两次扫描成本约为 $16\\,N_x N_y$ 次浮点运算，不包括用于辅助显式更新的常数项。**\n\n-   **三对角系统：** 我们的推导证实了隐式更新耦合了最近的邻居，从而产生一个三对角系统。这是使用二阶中心差分的直接结果。**正确**。\n-   **Thomas 算法和复杂度：** Thomas 算法是标准的 $O(m)$ 求解器。对于一次完整的求解（分解和替换），约 $8m$ 次浮点运算的估计是准确的。**正确**。\n-   **总成本：** 总成本计算 $\\approx 8 N_x N_y + 8 N_x N_y = 16 N_x N_y$ 是直接得出的。关于辅助显式更新的说明也是正确的。**正确**。\n\n这个陈述是对推导过程的完整而准确的总结。\n**结论：正确。**\n\n**B. Yee 网格的交错布局在每个半步中导致了与最近邻和次近邻的耦合，因此行系统是五对角的；需要一个带宽为 5 的带状求解器，每个时间步的成本尺度约为 $O\\!\\left(5\\,N_x N_y\\right)$。**\n\n-   **五对角系统：** 推导表明，耦合的 $E_y$ 和 $H_z$ 方程中的一阶导数算子（$\\delta_x$）的组合，最终作用在 $E_y$ 上时，会产生一个类似二阶导数的算子（$\\delta_x^2$）。标准的二阶导数模板是一个 3 点模板，它产生一个三对角矩阵，而不是一个会产生五对角矩阵的 5 点模板。Yee 网格的交错布局对于生成三对角系统至关重要，它不会产生更宽的模板。**不正确**。\n\n**结论：不正确。**\n\n**C. 使用理想电导体（PEC）边界，在最外层节点上对切向电场施加 Dirichlet 条件时，三对角结构保持不变；只有第一个和最后一个对角线元素被修改。如果 $\\epsilon$ 和 $\\mu$ 在空间上是均匀的，使得每次扫描中的行矩阵都相同，那么可以对所有行重复使用一次 LU 分解，从而将摊销成本降低到每次前向/后向替换约 $4m$ 次浮点运算，每个时间步约 $8\\,N_x N_y$ 次。**\n\n-   **边界条件：** PEC 边界施加了 Dirichlet 条件（切向 $E = 0$）。这将已知量从系统中移除。虽然有多种实现方式，但剩余未知数的三对角结构得以保留。关于修改对角线元素的说法指的是一种具体的实现方法。关键点是结构保持不变。**合理/正确**。\n-   **均匀介质优化：** 如果 $\\epsilon$ 和 $\\mu$ 是均匀的，则三对角矩阵的系数在一次扫描中的每一行都是相同的。一个标准且高效的优化是每次扫描只计算一次矩阵的 LU 分解，并对所有行求解重复使用它。**正确**。\n-   **摊销成本：** 重复使用 LU 分解意味着每行的成本从完整的求解（约 $8m$）降低到仅进行前向和后向替换。对于 LDU 分解，前向替换约需 $2m$ 次，后向替换约需 $2m$ 次，因此每行约 $4m$ 次浮点运算是一个合理的估计。**正确**。\n-   **总优化成本：** 通过此优化，两次扫描的成本约为 $(N_y \\times 4N_x) + (N_x \\times 4N_y) = 8 N_x N_y$ 次浮点运算，外加每次扫描可忽略不计的一次性分解成本。此计算是一致且正确的。**正确**。\n\n这个陈述准确地描述了在均匀介质中对 ADI-FDTD 的一个关键优化。\n**结论：正确。**\n\n**D. 与显式时域有限差分（FDTD）相比，ADI-FDTD 在每个时间步都需要对一个稠密的全局矩阵求逆，对于总共 $N$ 个未知数，这会产生 $O(N^3)$ 的计算复杂度和 $O(N^2)$ 的内存需求。**\n\n-   **矩阵结构：** ADI 分裂的全部目的就是为了避免形成和求解一个大型的全局系统。ADI 将多维问题转化为一系列一维隐式问题，每个问题都产生一个稀疏的三对角矩阵。它不会生成一个*稠密的全局矩阵*。**不正确**。\n-   **复杂度：** ADI 的复杂度是 $O(N_x N_y)$，这在总网格单元数 $N_{tot} \\propto N_x N_y$ 上是线性的，$O(N_{tot})$。求解一个大小为 $N_{tot}$ 的稠密系统将是 $O(N_{tot}^3)$，这要昂贵好几个数量级。这个陈述从根本上误解了 ADI 方法。**不正确**。\n\n**结论：不正确。**", "answer": "$$\\boxed{AC}$$", "id": "3318720"}, {"introduction": "任何隐式方法的核心步骤都是求解一个大规模线性方程组。本练习将理论与实践相结合，要求您通过编程来解决这一关键问题。您将为一个半隐式格式构建并求解一个对称正定（SPD）线性系统，并比较直接求解器与强大的预条件共轭梯度（PCG）迭代方法的性能[@problem_id:3318730]。这项实践将使您对隐式方法在实际应用中的性能权衡有更深刻的认识。", "problem": "考虑一个一维电磁介质，其标量电场为 $E(x,t)$，磁场为 $H(x,t)$，由介电常数 $\\varepsilon$、磁导率 $\\mu$ 和电导率 $\\sigma$ 表征。从一维空间中的麦克斯韦方程组出发，\n$$\\varepsilon\\,\\partial_t E + \\sigma\\,E = \\partial_x H,\\quad \\mu\\,\\partial_t H = \\partial_x E,$$\n推导一个半隐式时间更新方案，该方案对传导项进行隐式处理，并通过时间中心的空间旋度耦合场。假设在均匀网格上，边界条件为狄利克雷边界条件 $E(0,t)=0$ 和 $E(L,t)=0$，其中 $L$ 是区域长度。使用空间上的交错 Yee 网格离散化和时间上的半隐式更新（基于后向欧拉法处理传导项，中心耦合处理旋度项），消去磁场，从而为内部网格点上的新时刻电场 $E^{n+1}$ 得到一个对称正定（SPD）线性系统。证明在 $N$ 个内部未知数上得到的系统可以写成 $A\\,\\mathbf{e}^{n+1} = \\mathbf{b}$ 的形式，其中 $A$ 是对称正定（SPD）的三对角矩阵，其值取决于 $\\Delta t$、$\\Delta x$、$\\varepsilon$、$\\mu$ 和 $\\sigma$，而 $\\mathbf{b}$ 是由前一时刻的场和源确定的已知右端项。明确指出在给定边界条件下保证对称性和正定性的离散算子结构。\n\n实现一项算法研究，以量化带预处理的共轭梯度（CG）法在求解由半隐式传导更新产生的 SPD 子系统时的性能。使用以下要求：\n\n- 构造 SPD 三对角矩阵 $A$，该矩阵对应于在包含 $N$ 个内部点、区域长度为 $L$、时间步长为 $\\Delta t$、介电常数为 $\\varepsilon$、磁导率为 $\\mu$、电导率为 $\\sigma$ 的均匀网格上的半隐式更新。对 $E$ 使用狄利克雷边界条件，使得内部点上的离散负拉普拉斯算子表现为三对角算子。连续光速为 $c = 1/\\sqrt{\\mu \\varepsilon}$，离散拉普拉斯算子的尺度为 $\\Delta x^{-2}$，其中 $\\Delta x = L/(N+1)$。\n- 定义一个三对角预处理器 $M$，它通过保留 $A$ 的对角线元素，并将其非对角线元素乘以一个强度参数 $s \\in [0,1]$ 来近似 $A$。其中 $s=0$ 对应于对角（Jacobi）预处理器，$s=1$ 对应于精确的矩阵结构。\n- 为 $A\\,\\mathbf{e}=\\mathbf{b}$ 实现一个预处理共轭梯度（PCG）求解器，使用 $M$ 作为预处理器。当相对残差范数 $\\|\\mathbf{r}_k\\|_2/\\|\\mathbf{b}\\|_2$ 低于容差 $\\tau = 10^{-8}$ 时，终止 PCG 算法，并报告达到此容差所需的整数迭代次数 $k$。\n- 为 $A\\,\\mathbf{e}=\\mathbf{b}$ 实现一个直接三对角求解器（Thomas 算法），并计算最终残差范数 $\\|\\mathbf{b} - A\\,\\mathbf{e}\\|_2$ 作为数值精度参考。对所有残差均使用欧几里得范数。\n\n所有测试用例使用以下固定的物理和数值参数：区域长度 $L = 1$（米），时间步长 $\\Delta t = 10^{-10}$（秒），介电常数 $\\varepsilon = 8.854187817\\times 10^{-12}$（法拉/米），磁导率 $\\mu = 4\\pi\\times 10^{-7}$（亨利/米），电导率 $\\sigma = 0.1$（西门子/米）。将右端项 $\\mathbf{b}$ 构造为在 $N$ 个内部网格点上全为 1 的均匀向量。所有输出均为无量纲的整数或浮点数。\n\n测试套件规范：\n\n- 网格大小 $N \\in \\{32,128,512\\}$。\n- 预处理器强度 $s \\in \\{0,0.5,1\\}$。\n- 这产生了 9 个由数对 $(N,s)$ 指定的不同测试用例：\n$$ (32,0),\\ (32,0.5),\\ (32,1),\\ (128,0),\\ (128,0.5),\\ (128,1),\\ (512,0),\\ (512,0.5),\\ (512,1). $$\n\n对每个测试用例，计算：\n- 达到 $\\tau = 10^{-8}$ 所需的 PCG 整数迭代次数 $k$。\n- 直接三对角求解的浮点数残差范数。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，包含按上述顺序列出的 9 个结果，其中每个结果以方括号对 $[k,r]$ 的形式报告，$k$ 是 PCG 整数迭代次数，$r$ 是直接求解得到的浮点数残差范数。\n- 该单行必须是一个由 9 个方括号对组成的逗号分隔列表，并用方括号括起来，例如：\n$$ [[k_1,r_1],[k_2,r_2],\\dots,[k_9,r_9]]. $$", "solution": "该问题要求为一维麦克斯韦方程组推导一个半隐式时域有限差分（FDTD）格式，并对得到的线性系统进行数值研究。\n\n### 第一部分：半隐式更新格式的推导\n\n导电介质中的控制麦克斯韦方程组如下所示：\n$$ \\varepsilon\\,\\partial_t E + \\sigma\\,E = \\partial_x H $$\n$$ \\mu\\,\\partial_t H = \\partial_x E $$\n\n我们在交错 Yee 网格上离散这些方程。电场 $E$ 定义在整数网格点 $x_i = i\\Delta x$ 上，磁场 $H$ 定义在半整数网格点 $x_{i+1/2} = (i+1/2)\\Delta x$ 上。离散场记为 $E_i^n = E(x_i, n\\Delta t)$ 和 $H_{i+1/2}^n = H(x_{i+1/2}, n\\Delta t)$。空间导数使用中心差分：\n$$ (\\partial_x H)_i \\approx \\frac{H_{i+1/2} - H_{i-1/2}}{\\Delta x} $$\n$$ (\\partial_x E)_{i+1/2} \\approx \\frac{E_{i+1} - E_i}{\\Delta x} $$\n\n问题指定了一个半隐式更新，其中传导项使用后向欧拉法进行隐式处理，场通过时间中心的空间旋度耦合。为了得到关于新时刻电场 $E^{n+1}$ 的单一线性系统，我们必须能够消去磁场。这意味着两个方程必须推进到相同的时间层。导致所需结构的最直接解释是对所有项都使用全隐式（后向欧拉）离散化，这是此类问题的常见选择。\n\n让我们在时间 $t^{n+1}$ 处离散化两个方程：\n$$ \\varepsilon \\frac{E_i^{n+1} - E_i^n}{\\Delta t} + \\sigma E_i^{n+1} = \\frac{H_{i+1/2}^{n+1} - H_{i-1/2}^{n+1}}{\\Delta x} $$\n$$ \\mu \\frac{H_{i+1/2}^{n+1} - H_{i+1/2}^n}{\\Delta t} = \\frac{E_{i+1}^{n+1} - E_i^{n+1}}{\\Delta x} $$\n\n从第二个方程中，我们用新时刻电场 $E^{n+1}$ 和旧时刻磁场 $H^n$ 来表示新时刻磁场 $H^{n+1}$：\n$$ H_{i+1/2}^{n+1} = H_{i+1/2}^n + \\frac{\\Delta t}{\\mu \\Delta x} (E_{i+1}^{n+1} - E_i^{n+1}) $$\n\n现在，将 $H^{n+1}$ 的这个表达式代入第一个离散方程：\n$$ \\left(\\frac{\\varepsilon}{\\Delta t} + \\sigma\\right) E_i^{n+1} - \\frac{\\varepsilon}{\\Delta t} E_i^n = \\frac{1}{\\Delta x} \\left[ \\left( H_{i+1/2}^n + \\frac{\\Delta t}{\\mu \\Delta x} (E_{i+1}^{n+1} - E_i^{n+1}) \\right) - \\left( H_{i-1/2}^n + \\frac{\\Delta t}{\\mu \\Delta x} (E_i^{n+1} - E_{i-1}^{n+1}) \\right) \\right] $$\n\n我们将包含未知量 $E^{n+1}$ 的项组合在左侧（LHS），将来自时间 $t^n$ 的已知项组合在右側（RHS）：\n$$ \\left(\\frac{\\varepsilon}{\\Delta t} + \\sigma\\right) E_i^{n+1} - \\frac{\\Delta t}{\\mu (\\Delta x)^2} (E_{i+1}^{n+1} - 2E_i^{n+1} + E_{i-1}^{n+1}) = \\frac{\\varepsilon}{\\Delta t} E_i^n + \\frac{H_{i+1/2}^n - H_{i-1/2}^n}{\\Delta x} $$\n\n这个方程可以为每个内部网格点 $i=1, 2, \\dots, N$ 重写。狄利克雷边界条件 $E_0^{n+1} = 0$ 和 $E_{N+1}^{n+1} = 0$ 被并入。这就产生了一个形式为 $A\\,\\mathbf{e}^{n+1} = \\mathbf{b}$ 的线性方程组，其中 $\\mathbf{e}^{n+1} = [E_1^{n+1}, \\dots, E_N^{n+1}]^T$。\n\n矩阵 $A$ 是三对角的，其元素如下：\n- 对角线元素：$A_{i,i} = \\frac{\\varepsilon}{\\Delta t} + \\sigma + \\frac{2\\Delta t}{\\mu (\\Delta x)^2}$\n- 非对角线元素：$A_{i, i\\pm 1} = -\\frac{\\Delta t}{\\mu (\\Delta x)^2}$\n\n右端向量 $\\mathbf{b}$ 由下式给出：\n$$ b_i = \\frac{\\varepsilon}{\\Delta t} E_i^n + \\frac{H_{i+1/2}^n - H_{i-1/2}^n}{\\Delta x} = \\frac{\\varepsilon}{\\Delta t} E_i^n + (\\partial_x H)^n_i $$\n为了数值研究的目的，问题指定使用全为 1 的均匀向量作为 $\\mathbf{b}$。\n\n### 第二部分：系统矩阵 $A$ 的性质\n\n矩阵 $A$ 可以用单位矩阵 $I$ 和狄利克雷边界条件下的离散负拉普拉斯算子 $L_D$ 来表示。$L_D$ 的矩阵是 $\\frac{1}{(\\Delta x)^2} \\textnormal{tridiag}(-1, 2, -1)$。\n系统矩阵 $A$ 可以写成：\n$$ A = \\left(\\frac{\\varepsilon}{\\Delta t} + \\sigma\\right)I + \\frac{\\Delta t}{\\mu} L_D $$\n\n**对称性：**\n矩阵 $A$ 沿其对角线为常数（$A_{i,j}$仅取决于$|i-j|$）。因此，$A_{i,j} = A_{j,i}$，所以 $A$ 是对称的。\n\n**正定性：**\n如果对于任何非零向量 $\\mathbf{v}$，二次型 $\\mathbf{v}^T A \\mathbf{v}  0$，则矩阵是正定的。\n令 $\\alpha = \\frac{\\varepsilon}{\\Delta t} + \\sigma$ 且 $\\beta = \\frac{\\Delta t}{\\mu}$。由于 $\\varepsilon, \\mu, \\sigma, \\Delta t$ 都是正的物理常数，所以 $\\alpha  0$ 且 $\\beta  0$。\n二次型为：\n$$ \\mathbf{v}^T A \\mathbf{v} = \\mathbf{v}^T (\\alpha I + \\beta L_D) \\mathbf{v} = \\alpha (\\mathbf{v}^T I \\mathbf{v}) + \\beta (\\mathbf{v}^T L_D \\mathbf{v}) = \\alpha \\|\\mathbf{v}\\|_2^2 + \\beta (\\mathbf{v}^T L_D \\mathbf{v})$$\n具有狄利克雷边界条件的离散拉普拉斯算子 $L_D$ 已知是对称正定的。其所有特征值均为正，因此 $\\mathbf{v}^T L_D \\mathbf{v} \\ge 0$。由于 $\\alpha  0$ 且 $\\beta  0$，对于任何非零向量 $\\mathbf{v}$，我们有 $\\alpha \\|\\mathbf{v}\\|_2^2  0$ 和 $\\beta (\\mathbf{v}^T L_D \\mathbf{v}) \\ge 0$。因此，$\\mathbf{v}^T A \\mathbf{v}  0$。\n这证明了矩阵 $A$ 是对称正定（SPD）的。此性质至关重要，因为它保证了唯一解的存在，并使得可以使用如共轭梯度法等高效且稳定的迭代求解器。\n\n### 第三部分：算法实现与研究\n\n数值任务是针对不同的网格大小 $N$ 和预处理器设置 $s$ 求解 SPD 系统 $A\\mathbf{e} = \\mathbf{b}$。\n- **矩阵 $A$** 是使用推导出的对角线（$d$）和非对角线（$o$）元素构造的。\n- **预处理器 $M$** 是一个三对角矩阵，其对角线元素与 $A$ 相同，但非对角线元素按 $s \\in \\{0, 0.5, 1\\}$ 进行缩放。\n- 实现了一个**预处理共轭梯度（PCG）**求解器。每次 PCG 迭代的核心涉及一次与 $A$ 的矩阵-向量乘积和一次预处理器求解 $M\\mathbf{z}=\\mathbf{r}$。当 $s0$ 时，预处理器求解由 Thomas 算法处理；当 $s=0$ 时（Jacobi 预处理），则通过简单的逐元素除法处理。\n- 实现了一个**Thomas 算法**用于直接求解三对角系统。它既用于直接求解 $A\\mathbf{e}=\\mathbf{b}$ 以找到参考残差，也用于 PCG 中当 $s0$ 时的预处理器求解。\n- 性能通过达到相对残差容差 $\\tau=10^{-8}$ 所需的 PCG 迭代次数 $k$ 来量化。直接求解（Thomas 算法）的精度通过其最终残差范数 $\\|\\mathbf{b} - A\\,\\mathbf{e}\\|_2$ 进行评估。\n\n该实现将遍历指定的测试用例，执行计算，并将结果格式化为 $[k, r]$ 对的单个列表。", "answer": "```python\nimport numpy as np\n\ndef thomas_solver(sub, diag, sup, r):\n    \"\"\"\n    Solves a tridiagonal system T*x = r, where T = tridiagonal(sub, diag, sup).\n    This is an implementation of the Thomas algorithm.\n    \n    Args:\n        sub (np.ndarray): The sub-diagonal of length N-1.\n        diag (np.ndarray): The main diagonal of length N.\n        sup (np.ndarray): The super-diagonal of length N-1.\n        r (np.ndarray): The right-hand side vector of length N.\n\n    Returns:\n        np.ndarray: The solution vector x of length N.\n    \"\"\"\n    n = len(diag)\n    # Create copies to avoid modifying the original arrays passed to the function.\n    c_prime = np.zeros(n - 1)\n    d_prime = np.zeros(n)\n    \n    # Forward elimination phase\n    if diag[0] == 0:\n        raise ValueError(\"Thomas algorithm failed: zero on main diagonal.\")\n    c_prime[0] = sup[0] / diag[0]\n    d_prime[0] = r[0] / diag[0]\n    \n    for i in range(1, n):\n        denom = diag[i] - sub[i-1] * c_prime[i-1]\n        if denom == 0:\n            raise ValueError(\"Thomas algorithm failed: zero pivot.\")\n        if i  n - 1:\n            c_prime[i] = sup[i] / denom\n        d_prime[i] = (r[i] - sub[i-1] * d_prime[i-1]) / denom\n\n    # Backward substitution phase\n    x = np.zeros(n)\n    x[n - 1] = d_prime[n - 1]\n    for i in range(n - 2, -1, -1):\n        x[i] = d_prime[i] - c_prime[i] * x[i+1]\n        \n    return x\n\ndef matvec_tridiagonal(d, o, x):\n    \"\"\"\n    Computes the matrix-vector product y = A*x for a tridiagonal matrix A\n    with a constant main diagonal 'd' and constant off-diagonals 'o'.\n    \"\"\"\n    n = len(x)\n    y = d * x\n    if n > 1:\n        y[1:] += o * x[:-1]\n        y[:-1] += o * x[1:]\n    return y\n\ndef pcg_solver(N, d_A, o_A, d_M, o_M, b, tol):\n    \"\"\"\n    Preconditioned Conjugate Gradient (PCG) solver for Ax=b.\n    A is the symmetric tridiagonal system matrix.\n    M is the tridiagonal preconditioner matrix.\n    \"\"\"\n    x = np.zeros(N)\n    r = b.copy()  # Since x0=0, r0 = b - A*x0 = b\n    b_norm = np.linalg.norm(b)\n    \n    # Preconditioning step: solve Mz = r\n    if np.abs(o_M)  1e-15: # Case s=0: Jacobi preconditioner (M is diagonal)\n        z = r / d_M\n    else: # Case s>0: Tridiagonal preconditioner\n        sub_M = np.full(N - 1, o_M)\n        diag_M = np.full(N, d_M)\n        sup_M = np.full(N - 1, o_M)\n        z = thomas_solver(sub_M, diag_M, sup_M, r)\n        \n    p = z.copy()\n    rs_old = np.dot(r, z)\n    \n    max_iter = 2 * N\n    for k in range(1, max_iter + 1):\n        Ap = matvec_tridiagonal(d_A, o_A, p)\n        alpha = rs_old / np.dot(p, Ap)\n        \n        x += alpha * p\n        r -= alpha * Ap\n        \n        rel_residual_norm = np.linalg.norm(r) / b_norm\n        if rel_residual_norm  tol:\n            return k\n        \n        # Preconditioning step: solve Mz = r\n        if np.abs(o_M)  1e-15:\n            z = r / d_M\n        else:\n            z = thomas_solver(sub_M, diag_M, sup_M, r)\n            \n        rs_new = np.dot(r, z)\n        if rs_old == 0:\n            return k\n        \n        beta = rs_new / rs_old\n        p = z + beta * p\n        rs_old = rs_new\n        \n    return max_iter\n\ndef solve():\n    \"\"\"\n    Main function to run the defined algorithmic study and print results.\n    \"\"\"\n    # Physical and numerical constants\n    L = 1.0\n    DT = 1.0e-10\n    EPS = 8.854187817e-12\n    MU = 4 * np.pi * 1.0e-7\n    SIGMA = 0.1\n    TOL = 1.0e-8\n\n    test_cases = [\n        (32, 0.0), (32, 0.5), (32, 1.0),\n        (128, 0.0), (128, 0.5), (128, 1.0),\n        (512, 0.0), (512, 0.5), (512, 1.0)\n    ]\n\n    results_list = []\n\n    for N, s in test_cases:\n        DX = L / (N + 1)\n        \n        # Construct diagonals of the system matrix A\n        d_A = (EPS / DT) + SIGMA + (2 * DT) / (MU * DX**2)\n        o_A = -DT / (MU * DX**2)\n\n        # Construct diagonals of the preconditioner matrix M\n        d_M = d_A\n        o_M = s * o_A\n        \n        b = np.ones(N, dtype=float)\n\n        # 1. Run PCG solver and get iteration count k\n        k = pcg_solver(N, d_A, o_A, d_M, o_M, b, TOL)\n\n        # 2. Run direct tridiagonal solver for Ax=e\n        sub_A = np.full(N - 1, o_A)\n        diag_A = np.full(N, d_A)\n        sup_A = np.full(N - 1, o_A)\n        e_direct = thomas_solver(sub_A, diag_A, sup_A, b)\n        \n        # 3. Calculate the residual norm r of the direct solve\n        residual_vector = b - matvec_tridiagonal(d_A, o_A, e_direct)\n        r_norm = np.linalg.norm(residual_vector)\n        \n        results_list.append(f\"[{k},{r_norm}]\")\n\n    print(f\"[{','.join(results_list)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3318730"}]}