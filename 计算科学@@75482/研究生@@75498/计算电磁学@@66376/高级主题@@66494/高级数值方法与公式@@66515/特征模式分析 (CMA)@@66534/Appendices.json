{"hands_on_practices": [{"introduction": "特征模分析不仅仅是数学上的抽象，它为我们理解辐射体的物理行为提供了深刻的见解。本练习将理论与实践相结合，探讨了有限电导率（即欧姆损耗）对关键模态参数的影响。通过计算不同模式的品质因数 $Q_l$ 和辐射效率 $\\eta_l$，我们将直观地理解材料损耗如何逐个模式地影响天线的性能，这是评估和优化实际天线设计的基础 [@problem_id:3292846]。", "problem": "在自由空间中，给定一个半径为 $a$ 的薄的、闭合的、完美光滑的金属球壳，考虑在电场积分方程 (EFIE) 框架下的特征模式分析 (CMA)。该球壳的阻抗算子建模为 $$[Z(\\omega)] = [R_\\text{rad}(\\omega)] + [R_\\text{ohm}(\\omega)] + j[X(\\omega)],$$ 其中 $[R_\\text{rad}]$ 是表示辐射功率的辐射电阻算子，$[R_\\text{ohm}]$ 是表示由有限电导率引起的传导损耗的欧姆电阻算子，$[X]$ 是电抗算子。CMA 特征问题由广义特征值方程 $$[X(\\omega)] \\mathbf{J}_n(\\omega) = \\lambda_n(\\omega) [R_\\text{rad}(\\omega)] \\mathbf{J}_n(\\omega)$$ 构成，其中 $\\mathbf{J}_n$ 是第 $n$ 个特征电流模式，$\\lambda_n$ 是对应的特征值。\n\n假设就 $ka$ 而言，该球壳为电小到中等尺寸，其中 $k = \\omega/c$ 是自由空间波数，$c$ 是光速。在球壳上使用一个由 $l$ 阶切向矢量球谐函数构成的模式基，其中 $l = 1,2,\\dots,L$ 为模式族的索引。在此基下，将算子近似为关于 $l$ 的对角阵，并采用以下具有物理动机的标度关系：\n\n- 每个模式的辐射电阻：\n$$R_{\\text{rad},l}(\\omega) = Z_0 \\, C_l \\, (ka)^{2l+1},$$\n其中 $Z_0 = \\sqrt{\\mu_0/\\epsilon_0}$ 是自由空间波阻抗，$\\mu_0$ 是真空磁导率，$\\epsilon_0$ 是真空介电常数，$C_l  0$ 是一个无量纲、与几何相关的模式辐射系数。\n\n- 使用良导体表面电阻模型计算的每个模式的欧姆电阻：\n$$R_{\\text{ohm},l}(\\omega) = R_s(\\omega,\\sigma) \\, D_l,$$\n表面电阻为\n$$R_s(\\omega,\\sigma) = \\sqrt{\\frac{\\omega \\mu_0}{2\\sigma}} = \\sqrt{\\frac{\\pi f \\mu_0}{\\sigma}},$$\n角频率为 $\\omega = 2\\pi f$，电导率为 $\\sigma$。$D_l  0$ 是一个无量纲的模式耗散系数，表示第 $l$ 个模式在球壳上的电流集中和路径长度效应。\n\n- 使用存储能量和辐射功率计算的模式品质因数：\n$$Q_l(ka) = \\frac{\\omega \\, W_l(ka)}{P_{\\text{rad},l}(ka)},$$\n其中 $W_l$ 是第 $l$ 个模式的时间平均存储无功能量，$P_{\\text{rad},l}$ 是时间平均辐射功率。对于电小球壳，$Q_l$ 主要由近场储能项决定，这些项与 $ka$ 的负幂成比例，从而得到一个复合渐近模型\n$$Q_l(ka) \\approx \\frac{A_l}{(ka)^3} + \\frac{B_l}{ka},$$\n其中 $A_l0$ 和 $B_l0$ 是无量纲的模式形状因子，分别表示电场型和磁场型储能的贡献。\n\n定义第 $l$ 个模式的辐射效率为\n$$\\eta_l(\\omega) = \\frac{R_{\\text{rad},l}(\\omega)}{R_{\\text{rad},l}(\\omega) + R_{\\text{ohm},l}(\\omega)}.$$\n\n你的任务是实现一个程序，使用上述算子标度关系，评估有限电导率对于薄金属壳的不同模式的模式品质因数 $Q_l$ 和辐射效率 $\\eta_l$ 的影响。使用以下模式形状因子来表示随模式指数 $l$ 增加的近场储能和耗散的预期增长：\n- $$A_l = \\frac{l(l+1)}{2}, \\quad B_l = l, \\quad C_l = 10^{-3}, \\quad D_l = l(l+1)。$$\n\n为以下测试套件计算这些量（所有量均采用国际单位制 (SI)）：\n\n- 案例 1 (通用理想路径)：$a = 0.05$ 米, $f = 300 \\times 10^6$ 赫兹, $\\sigma = 5.8 \\times 10^7$ 西门子/米, $L = 4$。\n- 案例 2 (电小边界)：$a = 0.05$ 米, $f = 30 \\times 10^6$ 赫兹, $\\sigma = 5.8 \\times 10^7$ 西门子/米, $L = 4$。\n- 案例 3 (弱导体边缘情况)：$a = 0.05$ 米, $f = 1 \\times 10^9$ 赫兹, $\\sigma = 1 \\times 10^5$ 西门子/米, $L = 4$。\n- 案例 4 (更高频率理想路径)：$a = 0.05$ 米, $f = 3 \\times 10^9$ 赫兹, $\\sigma = 5.8 \\times 10^7$ 西门子/米, $L = 4$。\n\n对于每个案例，计算 $l = 1,2,3,4$ 时的 $Q_l$ 和 $\\eta_l$。程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。结果按案例和模式指数 $l$ 的升序排列，对于案例 1，每对结果作为连续条目 $[Q_1,\\eta_1,Q_2,\\eta_2,\\dots,Q_4,\\eta_4]$，随后依次附加案例 2、案例 3 和案例 4 的结果。所有输出均为无量纲实数。不使用角度。不使用百分比。", "solution": "问题陈述经过了严格评估，并被确定为有效。它是自洽的，在计算电磁学原理上有科学依据，并且在数学上是适定的。它为薄金属球壳的特征模式分析 (CMA) 提供了一个简化但一致的模型。任务是使用提供的公式和参数来计算定义的物理量。\n\n目标是针对一组测试案例，计算模式品质因数 $Q_l$ 和模式辐射效率 $\\eta_l$。这些计算基于一系列为球壳模式特性指定的解析模型。使用的基本物理常数是真空中的光速 $c \\approx 299792458 \\, \\text{m/s}$ 和真空磁导率 $\\mu_0 = 4\\pi \\times 10^{-7} \\, \\text{H/m}$。由此，自由空间的阻抗推导为 $Z_0 = \\sqrt{\\mu_0/\\epsilon_0} = c\\mu_0 \\approx 376.73 \\, \\Omega$。\n\n每个测试案例（由球壳半径 $a$、工作频率 $f$ 和球壳电导率 $\\sigma$ 定义）的计算流程如下。对于从 $1$ 到最大指定阶数 $L=4$ 的每个模式指数 $l$：\n\n1.  **计算派生物理参数**：首先，我们计算依赖于工作频率 $f$ 的参数。\n    -   角频率为 $\\omega = 2\\pi f$。\n    -   自由空间波数为 $k = \\omega/c$。\n    -   球体的无量纲尺寸参数为 $ka$。\n\n2.  **确定依赖于模式的系数**：问题指定了以下依赖于模式指数 $l$ 的无量纲系数：\n    -   $A_l = \\frac{l(l+1)}{2}$\n    -   $B_l = l$\n    -   $C_l = 10^{-3}$ (对所有 $l$ 均为常数)\n    -   $D_l = l(l+1)$\n\n3.  **计算模式品质因数 $Q_l$**：使用提供的渐近模型，第 $l$ 个模式的品质因数计算如下：\n    $$Q_l(ka) = \\frac{A_l}{(ka)^3} + \\frac{B_l}{ka}$$\n    此公式结合了电场型 ($A_l$) 和磁场型 ($B_l$) 储能机制的贡献，这些机制在电小结构中占主导地位。\n\n4.  **计算模式电阻**：辐射效率取决于模式辐射电阻 $R_{\\text{rad},l}$ 和模式欧姆电阻 $R_{\\text{ohm},l}$。\n    -   首先，计算金属壳的表面电阻 $R_s$。该值取决于频率和电导率：\n        $$R_s(\\omega,\\sigma) = \\sqrt{\\frac{\\pi f \\mu_0}{\\sigma}}$$\n    -   然后，通过用耗散系数 $D_l$ 对表面电阻进行缩放，得到模式欧姆电阻 $R_{\\text{ohm},l}$：\n        $$R_{\\text{ohm},l}(\\omega) = R_s(\\omega,\\sigma) \\cdot D_l$$\n    -   模式辐射电阻 $R_{\\text{rad},l}$ 根据其与 $ka$ 的指定标度关系进行计算：\n        $$R_{\\text{rad},l}(\\omega) = Z_0 \\cdot C_l \\cdot (ka)^{2l+1}$$\n\n5.  **计算模式辐射效率 $\\eta_l$**：最后，第 $l$ 个模式的辐射效率计算为辐射功率（与 $R_{\\text{rad},l}$ 成正比）与通过辐射和欧姆损耗消耗的总功率（与 $R_{\\text{rad},l} + R_{\\text{ohm},l}$ 成正比）之比：\n    $$\\eta_l(\\omega) = \\frac{R_{\\text{rad},l}(\\omega)}{R_{\\text{rad},l}(\\omega) + R_{\\text{ohm},l}(\\omega)}$$\n\n对于四个指定的测试案例中的每一个，都对每个模式指数 $l \\in \\{1, 2, 3, 4\\}$ 执行这一完整的计算序列。所得的 $Q_l$ 和 $\\eta_l$ 值然后按规定的顺序连接起来，以形成最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Characteristic Mode Analysis problem for a spherical shell.\n    \"\"\"\n    # Define fundamental physical constants in SI units.\n    C0 = 299792458.0  # Speed of light in vacuum (m/s)\n    MU0 = 4.0 * np.pi * 1e-7  # Vacuum permeability (H/m)\n    Z0 = C0 * MU0  # Free-space wave impedance (Ohms)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, f, sigma, L)\n        (0.05, 300e6, 5.8e7, 4),   # Case 1\n        (0.05, 30e6, 5.8e7, 4),    # Case 2\n        (0.05, 1e9, 1e5, 4),     # Case 3\n        (0.05, 3e9, 5.8e7, 4),     # Case 4\n    ]\n\n    def calculate_metrics_for_case(a, f, sigma, l_max):\n        \"\"\"\n        Calculates Q_l and eta_l for a single test case for l from 1 to l_max.\n        \n        Args:\n            a (float): Radius of the spherical shell in meters.\n            f (float): Frequency in Hertz.\n            sigma (float): Conductivity in Siemens per meter.\n            l_max (int): Maximum mode index to compute.\n            \n        Returns:\n            list: A flat list of [Q1, eta1, Q2, eta2, ...].\n        \"\"\"\n        # Calculate derived physical parameters\n        omega = 2.0 * np.pi * f\n        k = omega / C0\n        ka = k * a\n\n        # Calculate surface resistance Rs\n        Rs = np.sqrt((np.pi * f * MU0) / sigma)\n\n        case_results = []\n        for l in range(1, l_max + 1):\n            # Define mode-dependent coefficients\n            A_l = float(l * (l + 1)) / 2.0\n            B_l = float(l)\n            C_l = 1e-3\n            D_l = float(l * (l + 1))\n\n            # Compute modal quality factor Q_l\n            # The problem context ensures ka  0\n            Q_l = (A_l / np.power(ka, 3)) + (B_l / ka)\n\n            # Compute modal resistances\n            R_ohm_l = Rs * D_l\n            R_rad_l = Z0 * C_l * np.power(ka, 2 * l + 1)\n            \n            # Compute modal radiation efficiency eta_l\n            denominator = R_rad_l + R_ohm_l\n            if denominator == 0.0:\n                 # This case is unlikely with the given formulas but handled for robustness.\n                eta_l = 0.0\n            else:\n                eta_l = R_rad_l / denominator\n\n            case_results.append(Q_l)\n            case_results.append(eta_l)\n        \n        return case_results\n\n    # Process all test cases and collect results\n    all_results = []\n    for case in test_cases:\n        a, f, sigma, l_max = case\n        all_results.extend(calculate_metrics_for_case(a, f, sigma, l_max))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3292846"}, {"introduction": "在理解了单个特征模的特性之后，下一步是探究它们之间的相互作用，这对于分析复杂结构或可调谐天线至关重要。本练习通过一个简化的、对称性自适应的模型，揭示了“模式交叉”与“模式趋避（避免交叉）”这一基本现象 [@problem_id:3292914]。你将学习到结构的几何对称性是如何通过群论选择定则来支配模式行为的，这对于理解天线结构在微小扰动下模态的稳定性和演化至关重要。", "problem": "要求您设计并实现一个有理据的数值实验，用于在理想电导体 (PEC) 的特征模式分析框架下，探究特征本征值的趋避（避免交叉）与真实交叉现象。您的出发点必须是电场积分方程 (EFIE) 的算子形式和特征模式的定义：一个电流模式被定义为一个非平凡向量 $\\mathbf{J}$ 和一个实标量 $\\lambda$，使得实对称电抗算子 $\\mathbf{X}(\\omega)$ 和实对称辐射算子 $\\mathbf{R}(\\omega)$ 满足广义厄米本征值问题\n$$\n\\mathbf{X}(\\omega)\\,\\mathbf{J} \\;=\\; \\lambda(\\omega)\\,\\mathbf{R}(\\omega)\\,\\mathbf{J}.\n$$\n对于在对称性参数 $s=0$ 时具有高几何对称性的 PEC，当对称群的不可约表示的维度大于1时，会发生模式简并。当对称性被一个小的微扰 $s0$ 破坏时，只有属于剩余对称群的相同不可约表示的模式才允许耦合（群论选择定则），这通常会产生避免交叉。在简化的对称性下，保持在不同不可约表示中的模式不会耦合，因此会发生交叉。\n\n为了使本实验在没有完全电磁离散化的情况下自成体系且计算上适定，您将实现一个降阶、对称性适应的 $4\\times 4$ 实对称矩阵束模型 $\\left(\\mathbf{X}(\\omega,s),\\mathbf{R}(s)\\right)$，该模型是通过在四个对称性适应的基函数上进行 Galerkin 截断得到的。这些基函数由两个族 $A$ 和 $B$ 标记，每个族在 $s=0$ 时都具有由高对称性引起的二重简并度，并由一个残余宇称标签 $p\\in\\{+,-\\}$ 标记，该标签编码了简化对称性的不可约表示：\n- 索引 $0$：族 $A$，宇称为 $+$，\n- 索引 $1$：族 $A$，宇称为 $-$，\n- 索引 $2$：族 $B$，宇称为 $+$，\n- 索引 $3$：族 $B$，宇称为 $-$。\n\n您的构建必须满足以下基于物理的结构规则：\n- 算子 $\\mathbf{R}(s)$ 在所选基中是正定、实对称和对角化的，每个族内有重复的条目。\n- 算子 $\\mathbf{X}(\\omega,s)$ 在 $s=0$ 时是实对称和对角化的，每个族内有两个相同的对角线条目，从而产生与高对称性一致的简并。对于 $s0$，对称性破缺通过以下方式引入：(i) 每个族内部的小的宇称分裂对角线偏移，其大小与 $s^2$ 成比例，并在 $+$ 和 $-$ 宇称之间改变符号；以及 (ii) 仅在共享相同残余宇称标签 $p$ 的基函数之间允许的非对角耦合，这模拟了群论选择定则。\n\n使用以下显式参数化，该参数化在物理上一致、数值上稳定且无量纲：\n- 辐射算子：\n$$\n\\mathbf{R}(s)=\\operatorname{diag}\\big(r_A,\\,r_A,\\,r_B,\\,r_B\\big),\\quad r_A=1.0,\\quad r_B=1.1.\n$$\n- 在对称性参数 $s$ 和角频率 $\\omega$ 下的电抗算子：\n$$\n\\mathbf{X}(\\omega,s)=\\operatorname{diag}\\big(x_A(\\omega)+\\delta_A(s,+),\\;x_A(\\omega)+\\delta_A(s,-),\\;x_B(\\omega)+\\delta_B(s,+),\\;x_B(\\omega)+\\delta_B(s,-)\\big)\\;+\\;\\mathbf{C}(s),\n$$\n其中对角色散函数为\n$$\nx_A(\\omega)=\\omega-2.0,\\qquad x_B(\\omega)=0.6\\,(\\omega-1.0),\n$$\n宇称分裂偏移为\n$$\n\\delta_A(s,\\pm)=\\pm d_A\\,s^2,\\quad d_A=0.03,\\qquad \\delta_B(s,\\pm)=\\pm d_B\\,s^2,\\quad d_B=0.02,\n$$\n对称性允许的非对角耦合矩阵 $\\mathbf{C}(s)$ 定义为\n$$\n\\mathbf{C}(s)_{0,2}=\\mathbf{C}(s)_{2,0}=g_{+}\\,s,\\quad g_{+}=0.12,\\qquad \\mathbf{C}(s)_{1,3}=\\mathbf{C}(s)_{3,1}=g_{-}\\,s,\\quad g_{-}=0.0,\n$$\n$\\mathbf{C}(s)$ 的所有其他条目均为 $0$。这种构造强制要求耦合仅在相同的残余宇称 $p$ 扇区内发生，即 $p=+$ 的索引 $\\{0,2\\}$ 和 $p=-$ 的索引 $\\{1,3\\}$，这与群论选择定则一致。\n\n将与给定有序索引对 $(i,j)$ 相关联的二乘二子矩阵束表示为 $\\left(\\mathbf{X}_{ij}(\\omega,s),\\mathbf{R}_{ij}(s)\\right)$，其中 $\\mathbf{X}_{ij}$ 和 $\\mathbf{R}_{ij}$ 是 $\\mathbf{X}$ 和 $\\mathbf{R}$ 在索引 $(i,j)$ 上的主子矩阵。限制在该子空间内的特征本征值被定义为下式的两个实根 $\\lambda_1(\\omega,s)\\le \\lambda_2(\\omega,s)$\n$$\n\\det\\!\\left(\\mathbf{X}_{ij}(\\omega,s)-\\lambda\\,\\mathbf{R}_{ij}(s)\\right)=0.\n$$\n将对 $(i,j)$ 的频率相关间隙定义为\n$$\n\\Delta_{ij}(\\omega,s)=\\left|\\lambda_2(\\omega,s)-\\lambda_1(\\omega,s)\\right|,\n$$\n并将闭合频率区间 $[\\omega_{\\min},\\omega_{\\max}]$ 上的最小间隙定义为\n$$\n\\Delta^{\\star}_{ij}(s;[\\omega_{\\min},\\omega_{\\max}])=\\min_{\\omega\\in[\\omega_{\\min},\\omega_{\\max}]}\\Delta_{ij}(\\omega,s).\n$$\n\n您的任务是：\n- 实现一个程序，该程序构建如上的 $\\mathbf{R}(s)$ 和 $\\mathbf{X}(\\omega,s)$，提取指定对 $(i,j)$ 的二乘二子矩阵束，在每个采样频率下使用数值稳定的方法（简化为标准对称本征问题）求解广义厄米本征问题，并通过在区间 $[\\omega_{\\min},\\omega_{\\max}]$ 上的密集采样计算 $\\Delta^{\\star}_{ij}$。\n- 使用 $\\mathbf{R}_{ij}(s)$ 的 Cholesky 分解来构建一个标准对称本征问题，以确保数值稳定性。\n- 在包含 $N$ 个均匀间隔样本的频率网格上进行评估，其中 $N$ 在下面的每个测试用例中指定。\n\n测试套件：\n- 案例1（高对称性边界，存在简并）：$s=0.0$，对 $(i,j)=(0,2)$，$\\omega\\in[2.5,\\,3.9]$，$N=20001$。\n- 案例2（$p=+$ 扇区中的弱对称性破缺，预期出现避免交叉）：$s=0.05$，对 $(i,j)=(0,2)$，$\\omega\\in[2.5,\\,3.9]$，$N=20001$。\n- 案例3（$p=-$ 扇区中受对称性保护的交叉，根据选择定则无耦合）：$s=0.2$，对 $(i,j)=(1,3)$，$\\omega\\in[2.5,\\,3.9]$，$N=20001$。\n\n要求输出：\n- 对于每个案例，计算最小间隙 $\\Delta^{\\star}_{ij}$，结果为浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表的结果（例如，“[$r_1$,$r_2$,$r_3$]”），其中每个 $r_k$ 是对应案例的最小间隙，四舍五入到6位小数。\n- 本问题不需要物理单位；所有量都是无量纲的。", "solution": "该任务是设计一个数值实验，为一个理想电导体 (PEC) 的简化 $4 \\times 4$ 矩阵束模型计算特征本征值之间的最小频率相关间隙。我们感兴趣的现象是模式趋避（避免交叉）和真实模式交叉之间的区别，这由一个对称性破缺参数 $s$ 控制。\n\n问题的核心是广义厄米本征值问题\n$$\n\\mathbf{X}(\\omega,s)\\,\\mathbf{J} \\;=\\; \\lambda(\\omega,s)\\,\\mathbf{R}(s)\\,\\mathbf{J}\n$$\n其中 $\\mathbf{X}(\\omega,s)$ 是实对称电抗算子，$\\mathbf{R}(s)$ 是实对称且正定的辐射算子。两者都以参数化的 $4 \\times 4$ 矩阵形式给出。目标是为特定的 $2 \\times 2$ 子矩阵束计算在某一频率区间内的最小间隙 $\\Delta^{\\star}_{ij}$。\n\n解决方案分为四个主要步骤：模型构建、子问题提取、子问题的解析解和数值计算。\n\n1.  **模型构建**：\n根据问题的显式参数化，构建 $4 \\times 4$ 矩阵 $\\mathbf{R}(s)$ 和 $\\mathbf{X}(\\omega,s)$。\n辐射算子 $\\mathbf{R}(s)$ 是常数对角矩阵：\n$$\n\\mathbf{R}(s)=\\operatorname{diag}\\big(r_A,\\,r_A,\\,r_B,\\,r_B\\big)\n$$\n其中 $r_A=1.0$，$r_B=1.1$。\n\n电抗算子 $\\mathbf{X}(\\omega,s)$ 是对角部分和非对角耦合部分之和，$\\mathbf{X}(\\omega,s) = \\mathbf{D}(\\omega, s) + \\mathbf{C}(s)$。对角元素由下式给出：\n$$\n\\begin{aligned}\n\\mathbf{D}(\\omega,s)_{0,0} = x_A(\\omega) + \\delta_A(s,+) = (\\omega-2.0) + d_A s^2 \\\\\n\\mathbf{D}(\\omega,s)_{1,1} = x_A(\\omega) + \\delta_A(s,-) = (\\omega-2.0) - d_A s^2 \\\\\n\\mathbf{D}(\\omega,s)_{2,2} = x_B(\\omega) + \\delta_B(s,+) = 0.6(\\omega-1.0) + d_B s^2 \\\\\n\\mathbf{D}(\\omega,s)_{3,3} = x_B(\\omega) + \\delta_B(s,-) = 0.6(\\omega-1.0) - d_B s^2\n\\end{aligned}\n$$\n其中 $d_A=0.03$，$d_B=0.02$。非对角耦合矩阵 $\\mathbf{C}(s)$ 仅有两对非零元素，由群论选择定则支配，该定则规定耦合仅允许在具有相同宇称 $p$ 的模式之间发生：\n$$\n\\mathbf{C}(s)_{0,2}=\\mathbf{C}(s)_{2,0}=g_{+}\\,s \\quad (p=+) \\\\\n\\mathbf{C}(s)_{1,3}=\\mathbf{C}(s)_{3,1}=g_{-}\\,s \\quad (p=-)\n$$\n其中 $g_{+}=0.12$，$g_{-}=0.0$。\n\n2.  **子问题提取**：\n对于给定的索引对 $(i,j)$，从完整的 $4 \\times 4$ 矩阵中提取 $2 \\times 2$ 子矩阵 $\\mathbf{X}_{ij}(\\omega,s)$ 和 $\\mathbf{R}_{ij}(s)$。$\\mathbf{R}_{ij}(s)$ 是一个对角矩阵，其条目取自 $\\{r_A, r_B\\}$。$\\mathbf{X}_{ij}(\\omega,s)$ 包含来自 $\\mathbf{D}(\\omega,s)$ 的相应对角元素和来自 $\\mathbf{C}(s)$ 的唯一相关耦合项。\n\n3.  **$2 \\times 2$ 子问题的解析解**：\n分析的重点是 $2 \\times 2$ 广义本征问题：\n$$\n\\det\\!\\left(\\mathbf{X}_{ij}(\\omega,s)-\\lambda\\,\\mathbf{R}_{ij}(s)\\right)=0\n$$\n由于 $\\mathbf{R}_{ij}(s)$ 是对角且正定的，这个问题可以转化为一个标准对称本征问题。设 $\\mathbf{R}_{ij} = \\mathbf{L}\\mathbf{L}^T$ 是 $\\mathbf{R}_{ij}$ 的 Cholesky 分解。该问题等价于求矩阵 $\\mathbf{A} = \\mathbf{L}^{-1}\\mathbf{X}_{ij}(\\mathbf{L}^T)^{-1}$ 的本征值。\n\n对于 $2 \\times 2$ 的情况，一个更直接的方法是解析地求解特征多项式。设子矩阵为\n$$\n\\mathbf{X}_{ij}(\\omega,s) = \\begin{pmatrix} a(\\omega, s)  c(s) \\\\ c(s)  b(\\omega, s) \\end{pmatrix}, \\quad \\mathbf{R}_{ij}(s) = \\begin{pmatrix} r_i  0 \\\\ 0  r_j \\end{pmatrix}.\n$$\n特征方程是 $(a - \\lambda r_i)(b - \\lambda r_j) - c^2 = 0$，这是一个关于 $\\lambda$ 的二次方程：\n$$\n(r_i r_j)\\lambda^2 - (a r_j + b r_i)\\lambda + (ab - c^2) = 0.\n$$\n两个根 $\\lambda_1$ 和 $\\lambda_2$ 可以使用二次公式求得。间隙 $\\Delta_{ij} = |\\lambda_2 - \\lambda_1|$ 由判别式除以首项系数给出：\n$$\n\\Delta_{ij}(\\omega,s) = \\frac{\\sqrt{(a r_j + b r_i)^2 - 4 r_i r_j (ab - c^2)}}{r_i r_j} = \\frac{\\sqrt{(a r_j - b r_i)^2 + 4 c^2 r_i r_j}}{r_i r_j}.\n$$\n这个间隙的解析表达式允许进行高效的向量化计算。该公式在数学上等价于求解通过 Cholesky 分解得到的标准对称本征问题。\n\n4.  **数值计算**：\n实现的核心是在密集的频率网格上评估此解析间隙公式。对于由 $s$、$(i,j)$ 和区间 $[\\omega_{\\min}, \\omega_{\\max}]$ 定义的每个测试用例，执行以下算法：\na.  在 $[\\omega_{\\min}, \\omega_{\\max}]$ 上生成一个包含 $N$ 个频率的均匀网格 $\\{\\omega_k\\}$。\nb.  为指定的子矩阵束 $(i,j)$ 确定频率相关的对角项 $a(\\omega_k, s)$ 和 $b(\\omega_k, s)$，以及常数项 $c(s)$、$r_i$ 和 $r_j$。\nc.  使用 NumPy 以向量化的方式，根据推导出的解析公式，对网格中所有的 $\\omega_k$ 计算间隙函数 $\\Delta_{ij}(\\omega_k, s)$。这将产生一个间隙值数组。\nd.  通过取该数组中的最小值来找到最小间隙：\n$$\n\\Delta^{\\star}_{ij}(s;[\\omega_{\\min},\\omega_{\\max}])=\\min_{k} \\Delta_{ij}(\\omega_k,s).\n$$\n对三个测试用例中的每一个重复此过程，并收集结果。当非对角耦合 $c(s)$ 为零时（如案例1和3），间隙公式简化为 $\\Delta_{ij}(\\omega, s) = |a(\\omega, s) r_j - b(\\omega, s) r_i| / (r_i r_j)$。如果交叉频率（即 $a(\\omega, s) r_j = b(\\omega, s) r_i$ 成立时的频率）位于采样区间内，则最小间隙将为零。如果交叉频率是一个精确的网格点，计算出的最小值在数值上为零。否则，它是一个由网格分辨率决定的小的非零值。当 $c(s) \\neq 0$ 时（案例2，避免交叉），间隙永远不为零，其最小值为 $\\frac{2|c(s)|}{\\sqrt{r_i r_j}}$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the minimal characteristic eigenvalue gap for three test cases\n    of a symmetry-adapted 4x4 matrix pencil model.\n    \"\"\"\n\n    # Define physical and model parameters from the problem statement\n    r_A = 1.0\n    r_B = 1.1\n    d_A = 0.03\n    d_B = 0.02\n    g_plus = 0.12\n    g_minus = 0.0\n\n    # Test suite: (s, (i, j), omega_min, omega_max, N)\n    test_cases = [\n        (0.0, (0, 2), 2.5, 3.9, 20001),\n        (0.05, (0, 2), 2.5, 3.9, 20001),\n        (0.2, (1, 3), 2.5, 3.9, 20001),\n    ]\n\n    results = []\n\n    # Map of indices to basis function properties: (family_type, parity_sign)\n    # family_type 'A' or 'B'. parity_sign +1 or -1.\n    basis_map = {\n        0: ('A', 1),  # Family A, parity +\n        1: ('A', -1), # Family A, parity -\n        2: ('B', 1),  # Family B, parity +\n        3: ('B', -1), # Family B, parity -\n    }\n\n    for s, (i, j), omega_min, omega_max, N in test_cases:\n        # Generate the frequency grid\n        omegas = np.linspace(omega_min, omega_max, N, dtype=np.float64)\n\n        # Get properties for the selected indices i and j\n        family_i, parity_i = basis_map[i]\n        family_j, parity_j = basis_map[j]\n\n        # Determine the diagonal elements of the X_ij submatrix as functions of omega\n        if family_i == 'A':\n            a_omega = omegas - 2.0\n            delta_a = parity_i * d_A * s**2\n        else: # family 'B'\n            a_omega = 0.6 * (omegas - 1.0)\n            delta_a = parity_i * d_B * s**2\n        \n        if family_j == 'A':\n            b_omega = omegas - 2.0\n            delta_b = parity_j * d_A * s**2\n        else: # family 'B'\n            b_omega = 0.6 * (omegas - 1.0)\n            delta_b = parity_j * d_B * s**2\n\n        # a(omega, s) and b(omega, s) are the diagonal elements of X_ij\n        a_vals = a_omega + delta_a\n        b_vals = b_omega + delta_b\n\n        # Determine the off-diagonal element c(s) of X_ij\n        # Coupling is only between indices {0,2} (p=+) or {1,3} (p=-)\n        if {i, j} == {0, 2}:\n            c_val = g_plus * s\n        elif {i, j} == {1, 3}:\n            c_val = g_minus * s\n        else:\n            c_val = 0.0\n\n        # Determine diagonal elements r_i, r_j of the R_ij submatrix\n        r_i = r_A if family_i == 'A' else r_B\n        r_j = r_A if family_j == 'A' else r_B\n\n        # Calculate the eigenvalue gap using the derived analytical formula\n        # Delta = sqrt((a*r_j - b*r_i)^2 + 4*c^2*r_i*r_j) / (r_i*r_j)\n        term1 = (a_vals * r_j - b_vals * r_i)**2\n        term2 = 4.0 * c_val**2 * r_i * r_j\n        \n        gaps = np.sqrt(term1 + term2) / (r_i * r_j)\n\n        # Find the minimum gap over the frequency grid\n        min_gap = np.min(gaps)\n        results.append(min_gap)\n\n    # Format the final output string as required\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3292914"}]}