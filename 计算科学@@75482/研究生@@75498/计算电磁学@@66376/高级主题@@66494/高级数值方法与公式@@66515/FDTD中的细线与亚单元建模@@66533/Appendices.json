{"hands_on_practices": [{"introduction": "在时域有限差分（FDTD）方法中，对尺寸小于网格的细导线进行建模的首要挑战是如何精确地表示其任意的空间走向。当导线不与网格轴对齐，而是倾斜或弯曲时，简单的阶梯近似会引入显著误差。本练习将指导你从基本原理出发，通过体积平均化的方法，推导出一个倾斜或弯曲的导线段在其所在的Yee元胞中所贡献的等效电导率，这是将连续的几何结构映射到离散网格上的核心技术。[@problem_id:3354986]", "problem": "考虑一个三维时域有限差分（FDTD）Yee网格，其空间步长为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$。一根半径为 $a$、体电导率为 $\\sigma_{\\mathrm{w}}$ 的细金属线穿过与每个电场边分量相关的局部更新体积。该导线在几何上是亚元胞尺寸的（$a \\ll \\min\\{\\Delta x,\\Delta y,\\Delta z\\}$），并由一个可微空间曲线 $\\mathbf{r}(u)$ 表示，其中参数为 $u$，弧长坐标为 $s$，单位切向量为 $\\hat{\\mathbf{t}}(s)$。与第 $i$ 个电场分量（$i \\in \\{x,y,z\\}$）相关的局部更新体积被建模为具有纵向尺寸 $\\Delta i$ 和横向截面积 $A_{\\perp,i}$，其中 $A_{\\perp,x} = \\Delta y \\Delta z$、$A_{\\perp,y} = \\Delta x \\Delta z$ 和 $A_{\\perp,z} = \\Delta x \\Delta y$。\n\n严格从麦克斯韦-安培定律和导线内的线性导电本构关系出发，定义在 $i$ 边更新体积内由导线引起的体平均电流密度分量 $J_i$，用局部电场分量 $E_i$、导线的单位切向量 $\\hat{\\mathbf{t}}(s)$ 以及导线与该更新体积的几何重叠来表示。使用适合在 $i$ 边更新体积上进行平均的积分形式，并通过将 $\\hat{\\mathbf{t}}(s)$ 投影到坐标轴上来形式化倾斜或弯曲导线的各向异性效应。\n\n以此为基础，推导并实现一个可计算的表达式，用于计算沿第 $i$ 个电场边的有效并联电导率，记为 $\\sigma_{\\mathrm{eff},i}$，其定义为在 $i$ 边更新体积内，将体平均 $J_i$ 与 $E_i$ 关联起来的比例常数。您的表达式必须通过沿位于更新体积内的导线曲线部分积分得到，并且必须正确地包含方向投影 $\\hat{\\mathbf{t}}(s)$ 和导线的微分弧长 $\\mathrm{d}s$。\n\n您的程序必须对以下每种情况进行数值评估 $\\sigma_{\\mathrm{eff},x}$、$\\sigma_{\\mathrm{eff},y}$ 和 $\\sigma_{\\mathrm{eff},z}$，并为每种情况返回标量和 $\\sigma_{\\mathrm{eff},x}+\\sigma_{\\mathrm{eff},y}+\\sigma_{\\mathrm{eff},z}$，以 $\\mathrm{S/m}$ 为单位的浮点数表示。角度变量必须以弧度为单位。输入规范中的所有物理量均以国际单位制（SI）给出，最终输出必须以 $\\mathrm{S/m}$ 为单位。\n\n所有情况通用的网格和导线参数：\n- $\\Delta x = \\Delta y = \\Delta z = 1\\times 10^{-3}\\,\\mathrm{m}$，\n- $a = 25\\times 10^{-6}\\,\\mathrm{m}$，\n- $\\sigma_{\\mathrm{w}} = 5.8\\times 10^{7}\\,\\mathrm{S/m}$。\n\n测试套件（三种不同的导线几何形状，限制在单个 $i$ 边更新体积内；在每种情况下，导线段完全位于更新体积内，因此重叠长度等于导线段长度）：\n\n1. $x$–$y$ 平面内的倾斜直线段：\n   - 按弧长 $s$ 参数化：$\\mathbf{r}(s) = \\mathbf{r}_0 + \\hat{\\mathbf{t}}\\, s$，其中 $s \\in [0,\\ell]$，\n   - 单位切向量 $\\hat{\\mathbf{t}} = \\left(\\dfrac{1}{\\sqrt{5}}, \\dfrac{2}{\\sqrt{5}}, 0\\right)$，\n   - 长度 $\\ell = 0.8\\times 10^{-3}\\,\\mathrm{m}$。\n\n2. $x$–$y$ 平面内的四分之一圆弧：\n   - 按角度 $\\theta$ 参数化：$\\mathbf{r}(\\theta) = \\left(R\\cos\\theta, R\\sin\\theta, 0\\right)$，其中 $\\theta \\in [0,\\pi/2]$，\n   - 半径 $R = 0.5\\times 10^{-3}\\,\\mathrm{m}$，\n   - 使用 $\\dfrac{\\mathrm{d}s}{\\mathrm{d}\\theta} = R$ 和 $\\hat{\\mathbf{t}}(\\theta) = \\dfrac{\\mathrm{d}\\mathbf{r}/\\mathrm{d}\\theta}{\\|\\mathrm{d}\\mathbf{r}/\\mathrm{d}\\theta\\|}$。\n\n3. 几乎与 $x$ 轴对齐、略向 $z$ 轴倾斜的短直线段：\n   - 按弧长 $s$ 参数化：$\\mathbf{r}(s) = \\mathbf{r}_0 + \\hat{\\mathbf{t}}\\, s$，其中 $s \\in [0,\\ell]$，\n   - 原始方向向量 $\\mathbf{v} = (1, 0, 0.01)$ 且 $\\hat{\\mathbf{t}} = \\dfrac{\\mathbf{v}}{\\|\\mathbf{v}\\|}$，\n   - 长度 $\\ell = 1\\times 10^{-5}\\,\\mathrm{m}$。\n\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来（例如，$\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$），其中每个条目是相应测试用例的和 $\\sigma_{\\mathrm{eff},x}+\\sigma_{\\mathrm{eff},y}+\\sigma_{\\mathrm{eff},z}$。输出必须是单位为 $\\mathrm{S/m}$ 的数值浮点值。", "solution": "该问题是有效的，因为它在计算电磁学方面具有科学依据，问题陈述清晰，并且为获得唯一解提供了所有必要的参数。\n\n目标是推导在时域有限差分（FDTD）网格单元中，亚元胞细导线对第 $i$ 个电场分量贡献的有效电导率 $\\sigma_{\\mathrm{eff},i}$ 的表达式。这是通过将导线的电流贡献在与电场分量 $E_i$ 相关的 FDTD 单元体积上进行体平均来实现的。\n\n基本原理是导体的欧姆定律 $\\mathbf{J} = \\sigma \\mathbf{E}$ 和体平均量的定义。问题将有效电导率 $\\sigma_{\\mathrm{eff},i}$ 定义为将体平均电流密度分量 $J_i$ 与相应的局部电场分量 $E_i$ 联系起来的比例常数，使得 $J_i = \\sigma_{\\mathrm{eff},i} E_i$。\n\n设与第 $i$ 个电场分量（$i \\in \\{x,y,z\\}$）相关的 FDTD 网格单元的体积为 $V_i = \\Delta x \\Delta y \\Delta z$。体平均电流密度分量 $J_i$ 定义为导线电流密度的第 $i$ 个分量 $\\mathbf{J}_{\\mathrm{w}}$ 在单元体积上的积分，再除以单元体积本身：\n$$\nJ_i = \\frac{1}{V_i} \\int_{V_i} \\mathbf{J}_{\\mathrm{w}}(\\mathbf{r}) \\cdot \\hat{\\mathbf{i}} \\, \\mathrm{d}V\n$$\n其中 $\\hat{\\mathbf{i}}$ 是沿第 $i$ 个坐标轴的单位向量（例如，对于 $i=x$，为 $\\hat{\\mathbf{x}}$）。\n\n电流密度 $\\mathbf{J}_{\\mathrm{w}}$ 仅存在于导线的体积内。在导线内部，它由本构关系 $\\mathbf{J}_{\\mathrm{w}} = \\sigma_{\\mathrm{w}} \\mathbf{E}_{\\mathrm{w}}$ 给出，其中 $\\sigma_{\\mathrm{w}}$ 是导线的体电导率，$\\mathbf{E}_{\\mathrm{w}}$ 是导线内部的电场。对于细导线，该电场主要平行于导线的轴线，该轴线由单位切向量 $\\hat{\\mathbf{t}}(s)$ 定义。导线内部的场强大小是环境网格电场 $\\mathbf{E}_{\\mathrm{grid}}$ 在切向量上的投影：$\\mathbf{E}_{\\mathrm{w}} \\approx (\\mathbf{E}_{\\mathrm{grid}} \\cdot \\hat{\\mathbf{t}}(s))\\hat{\\mathbf{t}}(s)$。\n\n由于问题寻求 $J_i$ 和 $E_i$ 之间的直接关系，我们做出标准的建模近似，即在第 $i$ 个更新体积内驱动电流的环境场主要由分量 $E_i$ 主导。因此，我们近似 $\\mathbf{E}_{\\mathrm{grid}} \\approx E_i \\hat{\\mathbf{i}}$。将此代入 $\\mathbf{E}_{\\mathrm{w}}$ 的表达式中：\n$$\n\\mathbf{E}_{\\mathrm{w}} \\approx ((E_i \\hat{\\mathbf{i}}) \\cdot \\hat{\\mathbf{t}}(s))\\hat{\\mathbf{t}}(s) = E_i (\\hat{\\mathbf{t}}(s) \\cdot \\hat{\\mathbf{i}}) \\hat{\\mathbf{t}}(s)\n$$\n令 $t_i(s) = \\hat{\\mathbf{t}}(s) \\cdot \\hat{\\mathbf{i}}$ 为单位切向量沿 $i$ 轴的分量。导线内部的电流密度向量则为：\n$$\n\\mathbf{J}_{\\mathrm{w}}(s) = \\sigma_{\\mathrm{w}} E_i t_i(s) \\hat{\\mathbf{t}}(s)\n$$\n此电流密度沿 $i$ 轴的分量是：\n$$\n\\mathbf{J}_{\\mathrm{w}}(s) \\cdot \\hat{\\mathbf{i}} = \\sigma_{\\mathrm{w}} E_i t_i(s) (\\hat{\\mathbf{t}}(s) \\cdot \\hat{\\mathbf{i}}) = \\sigma_{\\mathrm{w}} E_i t_i^2(s)\n$$\n现在我们可以计算 $J_i$ 的体积积分。由于 $\\mathbf{J}_{\\mathrm{w}}$ 在导线外部为零，积分被限制在单元内的导线体积 $V_{\\mathrm{w}, \\text{cell}}$ 上。该体积可以通过将导线的横截面积 $A_{\\mathrm{w}} = \\pi a^2$ 沿其弧长 $s$ 积分来描述：\n$$\n\\int_{V_i} \\mathbf{J}_{\\mathrm{w}} \\cdot \\hat{\\mathbf{i}} \\, \\mathrm{d}V = \\int_{V_{\\mathrm{w}, \\text{cell}}} \\sigma_{\\mathrm{w}} E_i t_i^2(s) \\, \\mathrm{d}V = \\int_{\\text{segment}} \\left( \\int_{A_{\\mathrm{w}}} \\sigma_{\\mathrm{w}} E_i t_i^2(s) \\, \\mathrm{d}A \\right) \\mathrm{d}s\n$$\n由于 $\\sigma_{\\mathrm{w}}$、$E_i$ 和 $t_i(s)$ 在导线的亚元胞横截面上被假定为常数，内部积分仅产生一个横截面积因子 $A_{\\mathrm{w}} = \\pi a^2$。假设 $E_i$ 在其整个更新体积内是恒定的（FDTD方法的一个基石），我们也可以将其从外部积分中提出：\n$$\n\\int_{V_i} \\mathbf{J}_{\\mathrm{w}} \\cdot \\hat{\\mathbf{i}} \\, \\mathrm{d}V = \\sigma_{\\mathrm{w}} E_i (\\pi a^2) \\int_{\\text{segment}} t_i^2(s) \\, \\mathrm{d}s\n$$\n其中积分是沿单元内导线段的弧长进行的。将此代回 $J_i$ 的表达式中：\n$$\nJ_i = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{V_i} \\left( \\int_{\\text{segment}} t_i^2(s) \\, \\mathrm{d}s \\right) E_i\n$$\n通过与定义 $J_i = \\sigma_{\\mathrm{eff},i} E_i$ 进行比较，我们确定了第 $i$ 个分量的有效电导率：\n$$\n\\sigma_{\\mathrm{eff},i} = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{\\Delta x \\Delta y \\Delta z} \\int_{\\text{segment}} t_i^2(s) \\, \\mathrm{d}s\n$$\n问题要求计算和 $\\sigma_{\\mathrm{eff},x} + \\sigma_{\\mathrm{eff},y} + \\sigma_{\\mathrm{eff},z}$。这个和有一个显著的简化：\n$$\n\\sum_{i=x,y,z} \\sigma_{\\mathrm{eff},i} = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{V_{\\mathrm{cell}}} \\sum_{i=x,y,z} \\int_{\\text{segment}} t_i^2(s) \\, \\mathrm{d}s = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{V_{\\mathrm{cell}}} \\int_{\\text{segment}} (t_x^2 + t_y^2 + t_z^2) \\, \\mathrm{d}s\n$$\n因为 $\\hat{\\mathbf{t}}(s)$ 是一个单位向量，其分量的平方和为 $t_x^2(s) + t_y^2(s) + t_z^2(s) = \\|\\hat{\\mathbf{t}}(s)\\|^2 = 1$。表达式简化为：\n$$\n\\sum_{i=x,y,z} \\sigma_{\\mathrm{eff},i} = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{V_{\\mathrm{cell}}} \\int_{\\text{segment}} 1 \\, \\mathrm{d}s = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{V_{\\mathrm{cell}}} L\n$$\n其中 $L$ 是单元内导线段的总弧长。\n\n通用参数为：\n$\\Delta x = \\Delta y = \\Delta z = 1 \\times 10^{-3}\\,\\mathrm{m} \\implies V_{\\mathrm{cell}} = 10^{-9}\\,\\mathrm{m}^3$\n$a = 25 \\times 10^{-6}\\,\\mathrm{m}$\n$\\sigma_{\\mathrm{w}} = 5.8 \\times 10^7\\,\\mathrm{S/m}$\n前置因子为 $C_{\\Sigma} = \\frac{\\pi a^2 \\sigma_{\\mathrm{w}}}{V_{\\mathrm{cell}}} = \\frac{\\pi (25 \\times 10^{-6})^2 (5.8 \\times 10^7)}{10^{-9}} \\approx 113882733.9\\,\\mathrm{S/m^2}$。\n\n情况1：倾斜直线段\n导线是直的，所以其长度为 $L = \\ell = 0.8 \\times 10^{-3}\\,\\mathrm{m}$。\n总和 = $C_{\\Sigma} \\cdot L = 113882733.9 \\times (0.8 \\times 10^{-3}) \\approx 91106.187\\,\\mathrm{S/m}$。\n\n情况2：四分之一圆弧\n弧长为 $L = R \\theta$，其中 $\\theta \\in [0, \\pi/2]$。\n$L = R (\\pi/2 - 0) = (0.5 \\times 10^{-3}) \\cdot (\\pi/2) = \\frac{\\pi}{4} \\times 10^{-3}\\,\\mathrm{m} \\approx 0.7854 \\times 10^{-3}\\,\\mathrm{m}$。\n总和 = $C_{\\Sigma} \\cdot L = 113882733.9 \\times (\\frac{\\pi}{4} \\times 10^{-3}) \\approx 89445.542\\,\\mathrm{S/m}$。\n\n情况3：几乎与 $x$ 轴对齐的短直线段\n导线是直的，所以其长度为 $L = \\ell = 1 \\times 10^{-5}\\,\\mathrm{m}$。\n单位切向量是 $\\hat{\\mathbf{t}} = \\frac{(1, 0, 0.01)}{\\sqrt{1^2+0.01^2}}$，但无论其方向如何，$\\|\\hat{\\mathbf{t}}\\|^2=1$。\n总和 = $C_{\\Sigma} \\cdot L = 113882733.9 \\times (1 \\times 10^{-5}) \\approx 1138.827\\,\\mathrm{S/m}$。\n\n以下程序实现了 $\\sigma_{\\mathrm{eff},i}$ 的分量计算并对结果求和，如规范所述。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and calculates the effective conductivity of a subcell thin wire\n    in an FDTD grid for three different wire geometries.\n    \"\"\"\n    # Define common grid and wire parameters from the problem statement\n    dx = 1e-3  # Grid spacing in x (m)\n    dy = 1e-3  # Grid spacing in y (m)\n    dz = 1e-3  # Grid spacing in z (m)\n    a = 25e-6  # Wire radius (m)\n    sigma_w = 5.8e7  # Wire bulk conductivity (S/m)\n\n    # Calculate common constants for the effective conductivity formula\n    V_cell = dx * dy * dz\n    A_w = np.pi * a**2  # Wire cross-sectional area\n    \n    # C_factor = (sigma_w * A_w) / V_cell\n    # sigma_eff_i = C_factor * integral(t_i^2 ds)\n    C_factor = (sigma_w * A_w) / V_cell\n\n    test_cases = [\n        # Case 1: Oblique straight segment in the x-y plane\n        {\n            \"type\": \"straight\",\n            \"t_hat\": np.array([1/np.sqrt(5), 2/np.sqrt(5), 0]),\n            \"length\": 0.8e-3\n        },\n        # Case 2: Quarter-circle arc in the x-y plane\n        {\n            \"type\": \"arc\",\n            \"R\": 0.5e-3,\n            \"theta_range\": (0, np.pi/2)\n        },\n        # Case 3: Nearly x-aligned short straight segment\n        {\n            \"type\": \"straight_from_v\",\n            \"v\": np.array([1.0, 0.0, 0.01]),\n            \"length\": 1e-5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_eff_components = np.zeros(3)  # To store [sigma_eff_x, sigma_eff_y, sigma_eff_z]\n\n        if case[\"type\"] in (\"straight\", \"straight_from_v\"):\n            length = case[\"length\"]\n            if case[\"type\"] == \"straight\":\n                t_hat = case[\"t_hat\"]\n            else: # straight_from_v\n                v = case[\"v\"]\n                t_hat = v / np.linalg.norm(v)\n\n            # For a straight wire, the tangent vector is constant.\n            # The integral of t_i^2 ds becomes t_i^2 * length.\n            integrals = (t_hat**2) * length\n            sigma_eff_components = C_factor * integrals\n\n        elif case[\"type\"] == \"arc\":\n            R = case[\"R\"]\n            theta_min, theta_max = case[\"theta_range\"]\n            \n            # For this specific arc, the tangent vector is t(theta) = [-sin(theta), cos(theta), 0].\n            # The differential arc length ds = R * d(theta).\n            # We need to compute integral_{theta_min}^{theta_max} t_i(theta)^2 * R d(theta).\n            \n            # Integral of t_x^2 ds = R * integral(sin(theta)^2 d(theta))\n            # Antiderivative of sin(theta)^2 is theta/2 - sin(2*theta)/4\n            def int_sin_sq(th): return th / 2.0 - np.sin(2.0 * th) / 4.0\n            integral_tx2_ds = R * (int_sin_sq(theta_max) - int_sin_sq(theta_min))\n            \n            # Integral of t_y^2 ds = R * integral(cos(theta)^2 d(theta))\n            # Antiderivative of cos(theta)^2 is theta/2 + sin(2*theta)/4\n            def int_cos_sq(th): return th / 2.0 + np.sin(2.0 * th) / 4.0\n            integral_ty2_ds = R * (int_cos_sq(theta_max) - int_cos_sq(theta_min))\n\n            # Integral of t_z^2 ds is 0 since t_z = 0.\n            integral_tz2_ds = 0.0\n            \n            sigma_eff_components[0] = C_factor * integral_tx2_ds\n            sigma_eff_components[1] = C_factor * integral_ty2_ds\n            sigma_eff_components[2] = C_factor * integral_tz2_ds\n\n        # The result for the case is the sum of the components\n        total_sigma_eff = np.sum(sigma_eff_components)\n        results.append(total_sigma_eff)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3354986"}, {"introduction": "在网格中表示导线的几何形状后，下一步是施加物理定律，将导线周围的电磁场与导线中的电流联系起来。这个过程通常涉及在环绕导线的闭合回路上计算场的环路积分。本练习旨在让你通过一个精心设计的思想实验，亲手实现并比较两种常用的数值积分路径（方形与圆形），从而深刻理解在保证数值各向同性与贴合网格结构以简化计算之间的权衡。[@problem_id:3354943]", "problem": "考虑使用时域有限差分 (FDTD) 方法对一根沿 $\\hat{z}$ 轴排列并置于自由空间中的长直细电阻丝进行建模。在细线亚元胞建模中，一个常见的约束条件是基于环绕细丝的一个小轮廓上切向电场的环流。通常使用两种轮廓选择：与 Yee 网格相称的轴对齐正方形，以及几何上各向同性的圆形。您将比较这两种选择在恢复细丝电流和数值各向同性方面的能力。\n\n从以下基本原理出发：\n\n- 麦克斯韦-法拉第定律的积分形式：$\\oint_{\\Gamma} \\mathbf{E}\\cdot d\\boldsymbol{\\ell} = -\\dfrac{d}{dt}\\int_{S} \\mathbf{B}\\cdot \\hat{\\mathbf{n}}\\, dS$。\n- 麦克斯韦-安培定律的积分形式：$\\oint_{\\partial S} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} = \\int_{S} \\mathbf{J}\\cdot \\hat{\\mathbf{n}}\\, dS + \\dfrac{d}{dt}\\int_{S} \\mathbf{D}\\cdot \\hat{\\mathbf{n}}\\, dS$。\n- Leontovich 阻抗边界条件 (LIBC)：在一个良好但非理想的导体表面上，切向电场和磁场通过 $\\mathbf{E}_{t} = Z_{s} \\left( \\hat{\\mathbf{n}} \\times \\mathbf{H}_{t} \\right)$ 相关联，其中 $Z_{s}$ 是表面阻抗，$\\hat{\\mathbf{n}}$ 是向外法线。\n\n假设处于时谐体制，电流沿细丝缓慢变化，使得横截面中的横向场是准静态的。对于半径为 $a$ 的圆形细丝，当纵向电流为 $I$ 时，其方位角磁场为 $\\mathbf{H}_{\\phi}(r) = \\dfrac{I}{2\\pi r}\\,\\hat{\\boldsymbol{\\phi}}$（对于 $r \\ge a$）。在 Leontovich 阻抗边界条件下，这意味着细丝表面存在非零的切向电场。请从这些基础出发，推导出一个关系，该关系关联了环绕并连接细丝的任意简单闭合轮廓 $\\Gamma$ 上的环流 $\\oint_{\\Gamma}\\mathbf{E}\\cdot d\\boldsymbol{\\ell}$ 与细丝电流 $I$。然后，设计两种离散数值算子来近似该轮廓积分：\n1. 一种正方形轮廓算子，它沿着边长为 $s$、可能旋转了角度 $\\alpha$（以弧度为单位）的轴对齐正方形上的场进行采样，并在每条边上使用中点法则近似积分。\n2. 一种圆形轮廓算子，它沿着半径为 $r_{c}$ 的圆形上的场进行采样，并使用中点法则进行均匀角度采样来近似积分。\n\n为了使比较独立于全场 FDTD 细节，同时又植根于基本原理，请在横截面中使用以下合成的、各向同性的方位角电场模型：\n$$\n\\mathbf{E}(x,y) = \\frac{Z_{s}\\,I}{2\\pi}\\,\\frac{1}{(x-x_{0})^{2}+(y-y_{0})^{2}}\n\\begin{bmatrix}\n-(y-y_{0}) \\\\\n\\phantom{-}(x-x_{0})\n\\end{bmatrix},\n$$\n其中 $(x_{0},y_{0})$ 是细丝在横截面中的中心。该场具有一个特性，即它围绕任何包围 $(x_{0},y_{0})$ 的平滑轮廓的精确线积分计算结果为 $Z_s I$，从而模拟了从 Leontovich 阻抗边界条件预期的约束关系，而无需进行完整的电磁仿真。您的数值算子将对这个连续场进行采样以近似该积分。\n\n实现这两种算子并计算恢复的电流\n$$\nI_{\\mathrm{rec}} = \\frac{1}{Z_{s}} \\oint_{\\Gamma} \\mathbf{E}\\cdot d\\boldsymbol{\\ell},\n$$\n以安培为单位。量化两个性能指标：\n- 在标称方向 $\\alpha=0$ 时，电流恢复的相对误差，\n$$\n\\varepsilon = \\frac{I_{\\mathrm{rec}}-I}{I},\n$$\n以小数形式报告。\n- 在一组旋转角度 $\\{\\alpha_{k}\\}$（以弧度为单位）上，方形算子和圆形算子的数值各向同性度量，\n$$\n\\eta = \\frac{\\sigma\\left( I_{\\mathrm{rec}}(\\alpha_{k}) \\right)}{\\mu\\left( I_{\\mathrm{rec}}(\\alpha_{k}) \\right)},\n$$\n其中 $\\sigma(\\cdot)$ 表示标准差，$\\mu(\\cdot)$ 表示在旋转角度集上的平均值。\n\n在每个分段/样本上使用中点求积法。对于正方形，将总采样数 $N$ 尽可能均匀地分布在四条边上；对于圆形，按角度均匀分布样本。角度必须以弧度表示。恢复的电流必须以安培表示。相对误差和各向同性度量必须以小数表示。\n\n测试套件：\n对于下面的每种情况，按以下顺序计算四个浮点数：方形算子在 $\\alpha=0$ 时的相对误差、圆形算子在 $\\alpha=0$ 时的相对误差、方形算子在角度集上的各向同性度量，以及圆形算子在角度集上的各向同性度量。角度集是 $\\{\\alpha_{k}\\} = \\{0, \\pi/8, \\pi/4, 3\\pi/8\\}$。\n\n- 情况1 (理想路径)：$I=1.0$ A, $Z_{s}=0.05$ $\\Omega$, 细丝中心 $(x_{0},y_{0})=(0.0,0.0)$ m, 正方形边长 $s=1.0\\times 10^{-3}$ m, 圆形半径 $r_{c}=5.0\\times 10^{-4}$ m, 正方形样本数 $N=4$, 圆形样本数 $N=32$。\n- 情况2 (偏置细丝，粗糙方形)：$I=1.0$ A, $Z_{s}=0.05$ $\\Omega$, 细丝中心 $(x_{0},y_{0})=(0.4s,-0.3s)$ m，其中 $s$ 为此情况下的值, 正方形边长 $s=5.0\\times 10^{-3}$ m, 圆形半径 $r_{c}=2.5\\times 10^{-3}$ m, 正方形样本数 $N=4$, 圆形样本数 $N=32$。\n- 情况3 (不同参数，更精细采样)：$I=2.5$ A, $Z_{s}=0.2$ $\\Omega$, 细丝中心 $(x_{0},y_{0})=(0.2s,0.2s)$ m，其中 $s$ 为此情况下的值, 正方形边长 $s=1.5\\times 10^{-3}$ m, 圆形半径 $r_{c}=7.5\\times 10^{-4}$ m, 正方形样本数 $N=16$, 圆形样本数 $N=64$。\n\n最终输出格式：\n您的程序应产生单行输出，其中包含 12 个浮点结果（每种情况四个，按情况1、情况2、情况3的上述指定顺序排列），格式为一个由方括号括起来的逗号分隔列表（例如，\"[r1,r2,r3,r4,r5,...,r12]\"）。所有角度必须以弧度为单位，恢复的电流以安培为单位，误差和各向同性度量以小数表示。", "solution": "该问题要求比较两种数值求积方案——一种在正方形轮廓上，另一种在圆形轮廓上——在模拟的细线建模环境中它们的准确性和数值各向同性。核心任务是近似给定合成矢量场的线积分，该矢量场可作为载流细丝附近电场的代理。\n\n首先，我们验证合成电场的性质及其与细丝电流的关系。问题在横截面 $(x,y)$ 平面中提供了一个合成电场：\n$$\n\\mathbf{E}(x,y) = \\frac{Z_{s}\\,I}{2\\pi}\\,\\frac{1}{(x-x_{0})^{2}+(y-y_{0})^{2}}\n\\begin{bmatrix}\n-(y-y_{0}) \\\\\n(x-x_{0})\n\\end{bmatrix}\n$$\n其中 $(x_0, y_0)$ 是细丝的位置，$I$ 是电流，$Z_s$ 是给定的阻抗。为了分析这个场，我们可以使用以 $(x_0, y_0)$ 为中心的极坐标系 $(\\rho, \\phi)$，其中 $x-x_0 = \\rho\\cos\\phi$ 且 $y-y_0 = \\rho\\sin\\phi$。该场的矢量分量变为 $(-\\rho\\sin\\phi, \\rho\\cos\\phi)$，这对应于方位角方向向量 $\\hat{\\boldsymbol{\\phi}}$ 乘以 $\\rho$。分母是 $\\rho^2$。因此，该场简化为：\n$$\n\\mathbf{E}(\\rho, \\phi) = \\frac{Z_s I}{2\\pi\\rho} \\hat{\\boldsymbol{\\phi}}\n$$\n这是一个方位角场，其大小以 $1/\\rho$ 的形式从细丝中心衰减，这与长直细丝周围预期的场相符。\n\n问题假设该场的环流与电流 $I$ 之间存在一个关系。我们可以通过直接积分来验证这个关系。设 $\\Gamma$ 为 $(x,y)$ 平面内包围细丝于 $(x_0, y_0)$ 的任意简单闭合轮廓。线积分为 $\\oint_{\\Gamma} \\mathbf{E}\\cdot d\\boldsymbol{\\ell}$。根据无旋场（当 $\\rho \\neq 0$ 时，此场为无旋场）的路径无关特性，积分值仅取决于所包围的奇点。我们可以选择一个以 $(x_0, y_0)$ 为中心、半径为 $R$ 的简单圆形路径。沿此路径，路径微分元为 $d\\boldsymbol{\\ell} = R\\,d\\phi\\,\\hat{\\boldsymbol{\\phi}}$。点积为：\n$$\n\\mathbf{E}\\cdot d\\boldsymbol{\\ell} = \\left(\\frac{Z_s I}{2\\pi R} \\hat{\\boldsymbol{\\phi}}\\right) \\cdot (R\\,d\\phi\\,\\hat{\\boldsymbol{\\phi}}) = \\frac{Z_s I}{2\\pi} d\\phi\n$$\n环流则为：\n$$\n\\oint_{\\Gamma} \\mathbf{E}\\cdot d\\boldsymbol{\\ell} = \\int_{0}^{2\\pi} \\frac{Z_s I}{2\\pi} d\\phi = Z_s I\n$$\n这证实了合成场围绕任何包围细丝的轮廓的精确线积分结果为 $Z_s I$。因此，定义的精确恢复电流 $I_{\\mathrm{rec}} = \\frac{1}{Z_s}\\oint_{\\Gamma} \\mathbf{E}\\cdot d\\boldsymbol{\\ell}$ 精确等于真实电流 $I$。因此，计算出的 $I_{\\mathrm{rec}}$ 中的任何偏差都可归因于数值积分方案的误差。\n\n我们现在将设计两种指定的数值算子。两种算子都将在以坐标原点 $(0,0)$ 为中心的轮廓上进行评估。\n\n**1. 正方形轮廓算子**\n该算子近似计算边长为 $s$、以原点为中心的正方形上的线积分。该正方形可以旋转一个角度 $\\alpha$。未旋转正方形的顶点是 $P_1(-s/2, -s/2)$、$P_2(s/2, -s/2)$、$P_3(s/2, s/2)$ 和 $P_4(-s/2, s/2)$。旋转 $\\alpha$ 会将顶点 $P_i=(x_i, y_i)$ 变换为 $P'_i=(x_i\\cos\\alpha - y_i\\sin\\alpha, x_i\\sin\\alpha + y_i\\cos\\alpha)$。积分计算为沿四条边 $P'_1 \\to P'_2$、$P'_2 \\to P'_3$、$P'_3 \\to P'_4$ 和 $P'_4 \\to P'_1$ 的积分之和。\n\n总样本数 $N$ 被均匀分布，每条边有 $N_{\\text{edge}} = N/4$ 个样本。对于从顶点 $A$ 到顶点 $B$ 的一条边，应用中点法则。该边被分成 $N_{\\text{edge}}$ 个段。代表第 $j$ 段（对于 $j=0, \\dots, N_{\\text{edge}}-1$）的矢量是 $\\Delta\\boldsymbol{\\ell} = (B - A) / N_{\\text{edge}}$。该段的中点是 $M_j = A + (j+0.5)\\Delta\\boldsymbol{\\ell}$。该段对积分的贡献是 $\\mathbf{E}(M_j) \\cdot \\Delta\\boldsymbol{\\ell}$。总积分是所有四条边上所有这些段的贡献之和。\n\n**2. 圆形轮廓算子**\n该算子近似计算半径为 $r_c$、以原点为中心的圆形上的线积分。该圆被离散为 $N$ 个均匀的角度段。每个段的角度宽度为 $\\Delta\\theta = 2\\pi/N$。旋转角度 $\\alpha$ 会平移采样角度。第 $j$ 个角度段的中点在角度 $\\theta_j = (j+0.5)\\Delta\\theta + \\alpha$ 处。圆上对应的点是 $p_j = (r_c\\cos\\theta_j, r_c\\sin\\theta_j)$。此弧段的路径元向量近似为中点处的切向直线，其长度等于弧长 $r_c\\Delta\\theta$。在 $\\theta_j$ 处的切向量是 $\\hat{\\mathbf{t}}_j=(-\\sin\\theta_j, \\cos\\theta_j)$。因此，路径元向量为 $\\Delta\\boldsymbol{\\ell}_j = (r_c\\Delta\\theta)\\hat{\\mathbf{t}}_j$。对积分的贡献是 $\\mathbf{E}(p_j)\\cdot\\Delta\\boldsymbol{\\ell}_j$。总积分是 $j=0, \\dots, N-1$ 的这些贡献之和。\n\n**性能度量**\n定义了算子后，我们为每个测试案例计算以下两个度量：\n- **相对误差**：对于未旋转情况（$\\alpha=0$），恢复电流的相对误差为 $\\varepsilon = (I_{\\mathrm{rec}}-I)/I$，其中 $I_{\\mathrm{rec}} = (\\oint \\mathbf{E}\\cdot d\\boldsymbol{\\ell}) / Z_s$。\n- **各向同性度量**：这量化了恢复电流在旋转下的稳定性。它是为一组角度 $\\{\\alpha_k\\}$ 计算的，作为变异系数：$\\eta = \\sigma(I_{\\mathrm{rec}}(\\alpha_k)) / \\mu(I_{\\mathrm{rec}}(\\alpha_k))$，其中 $\\sigma$ 和 $\\mu$ 分别是恢复电流在该角度集上的标准差和平均值。较低的 $\\eta$ 值表示更好的数值各向同性。\n\n实现将通过为每个算子构建函数，然后将它们应用于提供的三个测试案例的参数来进行。", "answer": "```python\nimport numpy as np\n\ndef electric_field(x, y, x0, y0, Zs, I):\n    \"\"\"\n    Computes the synthetic electric field at a point (x, y).\n    \n    Args:\n        x, y (float): Coordinates of the evaluation point.\n        x0, y0 (float): Coordinates of the filament center.\n        Zs (float): Surface impedance.\n        I (float): Filament current.\n        \n    Returns:\n        np.ndarray: A 2-element array for the E-field vector [Ex, Ey].\n    \"\"\"\n    C = Zs * I / (2 * np.pi)\n    dx, dy = x - x0, y - y0\n    den = dx**2 + dy**2\n    if den == 0:\n        # This should not happen if sample points are not at the singularity\n        return np.array([0.0, 0.0])\n    \n    Ex = C * -dy / den\n    Ey = C * dx / den\n    return np.array([Ex, Ey])\n\ndef integrate_square(s, N, alpha, x0, y0, Zs, I):\n    \"\"\"\n    Computes the line integral of E around a rotated square contour.\n    \n    Args:\n        s (float): Side length of the square.\n        N (int): Total number of samples for quadrature.\n        alpha (float): Rotation angle in radians.\n        x0, y0, Zs, I: Parameters for the electric_field function.\n        \n    Returns:\n        float: The numerically calculated line integral.\n    \"\"\"\n    cos_a, sin_a = np.cos(alpha), np.sin(alpha)\n    R = np.array([[cos_a, -sin_a], [sin_a, cos_a]])\n    \n    h = s / 2.0\n    vertices_unrotated = [\n        np.array([-h, -h]),\n        np.array([h, -h]),\n        np.array([h, h]),\n        np.array([-h, h])\n    ]\n    \n    vertices_rotated = [v @ R.T for v in vertices_unrotated]\n    \n    total_integral = 0.0\n    N_edge = N // 4\n    \n    for i in range(4):\n        p_start = vertices_rotated[i]\n        p_end = vertices_rotated[(i + 1) % 4]\n        delta_l_vec = (p_end - p_start) / N_edge\n        \n        for j in range(N_edge):\n            midpoint = p_start + (j + 0.5) * delta_l_vec\n            E_vec = electric_field(midpoint[0], midpoint[1], x0, y0, Zs, I)\n            total_integral += np.dot(E_vec, delta_l_vec)\n            \n    return total_integral\n\ndef integrate_circle(rc, N, alpha, x0, y0, Zs, I):\n    \"\"\"\n    Computes the line integral of E around a circular contour.\n    \n    Args:\n        rc (float): Radius of the circle.\n        N (int): Total number of samples for quadrature.\n        alpha (float): Rotation angle (phase offset) in radians.\n        x0, y0, Zs, I: Parameters for the electric_field function.\n        \n    Returns:\n        float: The numerically calculated line integral.\n    \"\"\"\n    total_integral = 0.0\n    delta_theta = 2 * np.pi / N\n    \n    for j in range(N):\n        theta_mid = (j + 0.5) * delta_theta + alpha\n        \n        # Midpoint position\n        x_mid = rc * np.cos(theta_mid)\n        y_mid = rc * np.sin(theta_mid)\n        \n        # Path element vector dl = (rc * dtheta) * tangent_vector\n        # tangent_vector = (-sin(theta), cos(theta))\n        dl_vec = np.array([-np.sin(theta_mid), np.cos(theta_mid)]) * rc * delta_theta\n        \n        E_vec = electric_field(x_mid, y_mid, x0, y0, Zs, I)\n        total_integral += np.dot(E_vec, dl_vec)\n        \n    return total_integral\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        {'I': 1.0, 'Zs': 0.05, 's': 1.0e-3, 'rc': 5.0e-4, 'N_sq': 4, 'N_circ': 32, 'x0_factor': 0.0, 'y0_factor': 0.0},\n        {'I': 1.0, 'Zs': 0.05, 's': 5.0e-3, 'rc': 2.5e-3, 'N_sq': 4, 'N_circ': 32, 'x0_factor': 0.4, 'y0_factor': -0.3},\n        {'I': 2.5, 'Zs': 0.2, 's': 1.5e-3, 'rc': 7.5e-4, 'N_sq': 16, 'N_circ': 64, 'x0_factor': 0.2, 'y0_factor': 0.2},\n    ]\n\n    angles = [0.0, np.pi/8, np.pi/4, 3*np.pi/8]\n    all_results = []\n\n    for case in test_cases:\n        I, Zs = case['I'], case['Zs']\n        s, rc = case['s'], case['rc']\n        N_sq, N_circ = case['N_sq'], case['N_circ']\n        x0 = case['x0_factor'] * s\n        y0 = case['y0_factor'] * s\n        \n        # 1. Square-operator relative error at alpha=0\n        integral_sq_0 = integrate_square(s, N_sq, 0.0, x0, y0, Zs, I)\n        I_rec_sq_0 = integral_sq_0 / Zs\n        err_sq = (I_rec_sq_0 - I) / I\n        all_results.append(err_sq)\n        \n        # 2. Circular-operator relative error at alpha=0\n        integral_circ_0 = integrate_circle(rc, N_circ, 0.0, x0, y0, Zs, I)\n        I_rec_circ_0 = integral_circ_0 / Zs\n        err_circ = (I_rec_circ_0 - I) / I\n        all_results.append(err_circ)\n        \n        # 3. Square-operator isotropy metric\n        I_rec_sq_vals = []\n        for alpha in angles:\n            integral = integrate_square(s, N_sq, alpha, x0, y0, Zs, I)\n            I_rec_sq_vals.append(integral / Zs)\n        \n        mean_sq = np.mean(I_rec_sq_vals)\n        std_sq = np.std(I_rec_sq_vals)\n        eta_sq = std_sq / mean_sq if mean_sq != 0 else 0\n        all_results.append(eta_sq)\n\n        # 4. Circular-operator isotropy metric\n        I_rec_circ_vals = []\n        for alpha in angles:\n            integral = integrate_circle(rc, N_circ, alpha, x0, y0, Zs, I)\n            I_rec_circ_vals.append(integral / Zs)\n\n        mean_circ = np.mean(I_rec_circ_vals)\n        std_circ = np.std(I_rec_circ_vals)\n        eta_circ = std_circ / mean_circ if mean_circ != 0 else 0\n        all_results.append(eta_circ)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.12g}' for r in all_results)}]\")\n\nsolve()\n```", "id": "3354943"}]}