{"hands_on_practices": [{"introduction": "自由电子气是金属最简单的理论模型，推导其态密度（DOS）是凝聚态物理学中的一项基本练习。通过这个实践，我们可以清晰地看到系统的维度和能量色散关系 $E(\\mathbf{k})$ 如何直接决定态密度的数学形式，特别是其对能量的依赖性。完成这个从第一性原理出发的推导，将帮助您巩固态密度的基本定义，并为理解更复杂材料的电子结构奠定坚实的理论基础 [@problem_id:3443614]。", "problem": "在三维 ($3$D) 空间中，一个无相互作用的电子气被限制在边长为 $L$、体积为 $V=L^3$ 的立方体盒子内，并采用周期性边界条件。单电子能量色散关系为 $E(\\mathbf{k})=\\hbar^2 k^2/(2m)$，其中 $m$ 是电子质量，$\\mathbf{k}$ 是晶体动量。态密度 $D(E)$ 定义为能量小于或等于 $E$ 的单电子量子态数目 $N(E)$ 对能量的导数，即 $D(E)=\\mathrm{d}N(E)/\\mathrm{d}E$。在没有自旋分裂的情况下，自旋自由度导致一个自旋简并因子 $g_s$。\n\n仅从上述定义和周期性边界条件所蕴含的量子化出发，从第一性原理推导电子气的总态密度 $D(E)$ 的闭合形式表达式，该表达式应正确地计入自旋简并。在你的推导过程中，请明确指出自旋简并因子 $g_s$ 是如何引入的，然后通过取 $g_s=2$ 将其具体化到电子的情况。同时，用文字说明在非极化情况下，自旋投影态密度 $D_{\\uparrow}(E)$ 和 $D_{\\downarrow}(E)$ 与总态密度 $D(E)$ 之间的关系。\n\n请提供电子（计入两种自旋）的总态密度 $D(E)$ 的闭合形式解析表达式作为你的最终答案，用 $E$、$V$、$m$ 和 $\\hbar$ 表示。不要在最终表达式中包含单位。", "solution": "所述问题是有效的。这是一个来自基础凝聚态物理学的提法恰当、有科学依据的问题，要求推导自由电子气的态密度。所有必要信息均已提供，术语标准且明确。我们将从第一性原理开始进行推导。\n\n系统是一个在边长为 $L$、体积为 $V=L^3$ 的三维 ($3$D) 立方体盒子中的无相互作用电子气。我们对单电子波函数 $\\psi(\\mathbf{r})$ 施加周期性边界条件。平面波的波函数由 $\\psi_{\\mathbf{k}}(\\mathbf{r}) = C \\exp(i\\mathbf{k} \\cdot \\mathbf{r})$ 给出，其中 $\\mathbf{k}$ 是波矢。周期性边界条件要求波函数对于盒子的尺寸是周期的：\n$$\n\\psi(x+L, y, z) = \\psi(x, y, z) \\\\\n\\psi(x, y+L, z) = \\psi(x, y, z) \\\\\n\\psi(x, y, z+L) = \\psi(x, y, z)\n$$\n将第一个条件应用于平面波解，我们得到：\n$$\n\\exp(ik_x(x+L) + ik_y y + ik_z z) = \\exp(ik_x x + ik_y y + ik_z z)\n$$\n这意味着 $\\exp(ik_x L) = 1$。如果 $k_x L = 2\\pi n_x$（其中 $n_x$ 是一个整数），则此条件成立。将相同的逻辑应用于另外两个方向，我们发现波矢 $\\mathbf{k}$ 的允许分量是量子化的：\n$$\nk_x = n_x \\frac{2\\pi}{L}, \\quad k_y = n_y \\frac{2\\pi}{L}, \\quad k_z = n_z \\frac{2\\pi}{L}\n$$\n其中 $n_x, n_y, n_z$ 是任意整数 ($0, \\pm 1, \\pm 2, \\dots$)。这些允许的 $\\mathbf{k}$ 矢量在倒易空间（k空间）中形成一个离散的立方格子。相邻点之间的间隔为 $\\Delta k = 2\\pi/L$。与每个允许的 $\\mathbf{k}$ 态相关联的k空间体积是：\n$$\n\\Delta V_k = \\left(\\frac{2\\pi}{L}\\right)^3 = \\frac{8\\pi^3}{L^3} = \\frac{8\\pi^3}{V}\n$$\n为了求态密度，我们首先计算 $N(E)$，即能量小于或等于 $E$ 的单电子量子态的总数。能量色散关系为 $E(\\mathbf{k}) = \\hbar^2 k^2 / (2m)$，其中 $k^2 = |\\mathbf{k}|^2 = k_x^2 + k_y^2 + k_z^2$。条件 $E(\\mathbf{k}) \\le E$ 在k空间中定义了一个以原点为中心的球体，其半径 $k_E$ 由下式给出：\n$$\n\\frac{\\hbar^2 k_E^2}{2m} = E \\implies k_E = \\frac{\\sqrt{2mE}}{\\hbar}\n$$\n对于一个大系统，离散的k点非常密集，我们可以将态的分布视为连续的。轨道态的数量（暂时忽略自旋）$N_{\\text{orb}}(E)$ 可以通过将k空间中该球体的体积除以每个k态所占的体积来得到：\n$$\nN_{\\text{orb}}(E) = \\frac{\\text{k空间中半径为 } k_E \\text{ 的球体体积}}{\\text{每个k态的体积}} = \\frac{\\frac{4}{3}\\pi k_E^3}{\\left(\\frac{2\\pi}{L}\\right)^3}\n$$\n代入 $V=L^3$ 和 $k_E$ 的表达式：\n$$\nN_{\\text{orb}}(E) = \\frac{\\frac{4}{3}\\pi \\left(\\frac{2mE}{\\hbar^2}\\right)^{3/2}}{\\frac{8\\pi^3}{V}} = \\frac{4\\pi V}{3 \\cdot 8\\pi^3} \\left(\\frac{2mE}{\\hbar^2}\\right)^{3/2} = \\frac{V}{6\\pi^2} \\left(\\frac{2mE}{\\hbar^2}\\right)^{3/2}\n$$\n这个表达式只计算了轨道态。每个轨道态可以被一个自旋向上或自旋向下的电子占据。在没有自旋分裂的情况下（例如，没有外部磁场），这两个自旋态在能量上是简并的。这引入了一个自旋简并因子 $g_s$。因此，包括自旋在内的单电子量子态的总数 $N(E)$ 是：\n$$\nN(E) = g_s \\cdot N_{\\text{orb}}(E) = g_s \\frac{V}{6\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} E^{3/2}\n$$\n问题明确要求说明自旋简并因子 $g_s$ 是如何引入推导过程的。如上所示，它是作为一个乘法因子引入的，用来表示每个独特的空间（轨道）波函数所对应的可用自旋态的数量。\n\n态密度 $D(E)$ 定义为 $N(E)$ 对能量 $E$ 的导数：\n$$\nD(E) = \\frac{\\mathrm{d}N(E)}{\\mathrm{d}E} = \\frac{\\mathrm{d}}{\\mathrm{d}E} \\left[ g_s \\frac{V}{6\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} E^{3/2} \\right]\n$$\n乘以 $E^{3/2}$ 的项相对于 $E$ 是常数。$E^{3/2}$ 的导数是 $\\frac{3}{2}E^{1/2}$。因此，\n$$\nD(E) = g_s \\frac{V}{6\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} \\left(\\frac{3}{2}E^{1/2}\\right) = g_s \\frac{3V}{12\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} E^{1/2}\n$$\n化简数字前置因子，得到态密度的一般表达式：\n$$\nD(E) = g_s \\frac{V}{4\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} E^{1/2}\n$$\n对于电子，它们是自旋为 $1/2$ 的费米子，自旋简并因子为 $g_s=2$。代入这个值，我们得到电子气的总态密度：\n$$\nD(E) = 2 \\cdot \\frac{V}{4\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} E^{1/2} = \\frac{V}{2\\pi^2} \\left(\\frac{2m}{\\hbar^2}\\right)^{3/2} E^{1/2}\n$$\n这是总态密度的最终解析表达式。\n\n关于非极化系统中的自旋投影态密度 $D_{\\uparrow}(E)$ 和 $D_{\\downarrow}(E)$：总态密度 $D(E)$ 是自旋向上电子和自旋向下电子的态密度之和，即 $D(E) = D_{\\uparrow}(E) + D_{\\downarrow}(E)$。在非极化情况下，自旋向上和自旋向下的态之间没有能量差异。因此，在给定能量 $E$ 下，自旋向上电子的可用态数量与自旋向下电子的完全相同。这意味着它们各自的态密度相等：$D_{\\uparrow}(E) = D_{\\downarrow}(E)$。因此，每个自旋投影态密度恰好是总态密度的一半：$D_{\\uparrow}(E) = D_{\\downarrow}(E) = \\frac{1}{2}D(E)$。这等同于使用简并因子 $g_s=1$ 来计算态密度。", "answer": "$$\n\\boxed{\\frac{V}{2\\pi^2}\\left(\\frac{2m}{\\hbar^2}\\right)^{3/2}E^{1/2}}\n$$", "id": "3443614"}, {"introduction": "在掌握了理想化的自由电子气模型之后，下一步是转向更接近真实材料的原子尺度描述。紧束缚（Tight-Binding）模型为我们提供了这样一个框架，它不仅能计算能带结构，还能揭示不同原子轨道的贡献。这项实践引入了投影态密度（PDOS）的概念，通过构建一个简化的钙钛矿模型，您将亲手实现PDOS的计算，从而直观地理解化学键合、轨道杂化以及特定轨道对费米能级附近电子态的贡献 [@problem_id:2387879]。", "problem": "构建一个最小的、具有物理基础的紧束缚（TB）模型，用以计算代表钒酸锶（化学式为 $\\mathrm{SrVO}_3$）的立方钙钛矿在费米能级附近的轨道分辨投影态密度（PDOS）。每个原胞使用单轨道基 $\\{ \\lvert \\mathrm{V}\\,d \\rangle, \\lvert \\mathrm{O}\\,p \\rangle, \\lvert \\mathrm{Sr}\\,s \\rangle \\}$，以捕捉主要的轨道特性及其杂化。为方便起见，假设一个简单的立方布拉伐格子，其晶格常数设为 $a=1$。设第一布里渊区（BZ）中的晶体动量为 $\\mathbf{k}=(k_x,k_y,k_z)$，取 $k_x,k_y,k_z \\in [-\\pi,\\pi)$，角度单位为弧度。\n\n在上述轨道基中，将 $3\\times 3$ 的布洛赫哈密顿量 $H(\\mathbf{k})$ 定义为\n$$\nH(\\mathbf{k})=\n\\begin{pmatrix}\n\\varepsilon_d + 2 t_{dd} S(\\mathbf{k})  V_{dp}\\, C(\\mathbf{k})  V_{ds}\\, C(\\mathbf{k}) \\\\\nV_{dp}\\, C(\\mathbf{k})  \\varepsilon_p + 2 t_{pp} S(\\mathbf{k})  0 \\\\\nV_{ds}\\, C(\\mathbf{k})  0  \\varepsilon_s + 2 t_{ss} S(\\mathbf{k})\n\\end{pmatrix},\n$$\n其中结构因子为\n$$\nS(\\mathbf{k})=\\cos k_x + \\cos k_y + \\cos k_z,\\qquad\nC(\\mathbf{k})=\\frac{\\sin k_x + \\sin k_y + \\sin k_z}{\\sqrt{3}}.\n$$\n此处 $\\varepsilon_d,\\varepsilon_p,\\varepsilon_s$ 是在位能（单位为电子伏特），$t_{dd},t_{pp},t_{ss}$ 是最近邻跃迁振幅（单位为电子伏特），$V_{dp},V_{ds}$ 是轨道间杂化（单位为电子伏特），它们携带奇宇称结构因子 $C(\\mathbf{k})$。所有能量必须以电子伏特（$\\mathrm{eV}$）为单位处理。\n\n设费米能为 $E_F=0\\,\\mathrm{eV}$。将围绕 $E_F$、半宽为 $W$ 的能量窗内的轨道分辨权重定义为\n$$\nW_\\alpha = \\frac{1}{N_k^3}\\sum_{k_x,k_y,k_z}\\sum_{n=1}^{3} \\left|u_{\\alpha n}(\\mathbf{k})\\right|^2 \\,\\Theta\\!\\left(W - \\left|E_n(\\mathbf{k})-E_F\\right|\\right),\n$$\n其中 $E_n(\\mathbf{k})$ 和 $u_{\\alpha n}(\\mathbf{k})$ 分别是 $H(\\mathbf{k})$ 的本征值和本征矢量分量（归一化使得 $\\sum_\\alpha |u_{\\alpha n}|^2=1$），$\\Theta$ 是亥维赛阶跃函数，$\\alpha \\in \\{\\mathrm{V},\\mathrm{O},\\mathrm{Sr}\\}$ 按照 $\\{\\lvert \\mathrm{V}\\,d\\rangle, \\lvert \\mathrm{O}\\,p\\rangle, \\lvert \\mathrm{Sr}\\,s\\rangle\\}$ 的顺序列举轨道基，对 $\\mathbf{k}$ 的求和在 $N_k=21$ 的 $N_k\\times N_k\\times N_k$ 均匀点网格上进行。将费米能级附近的 PDOS 分数定义为\n$$\nf_\\alpha = \n\\begin{cases}\n\\dfrac{W_\\alpha}{W_{\\mathrm{V}}+W_{\\mathrm{O}}+W_{\\mathrm{Sr}}},  \\text{if } W_{\\mathrm{V}}+W_{\\mathrm{O}}+W_{\\mathrm{Sr}} > 0 \\\\\n0,  \\text{otherwise}\n\\end{cases}\n$$\n对于 $\\alpha \\in \\{\\mathrm{Sr},\\mathrm{V},\\mathrm{O}\\}$。对于下面的每个参数集，报告有序三元组 $\\bigl[f_{\\mathrm{Sr}},f_{\\mathrm{V}},f_{\\mathrm{O}}\\bigr]$，四舍五入到三位小数。如果没有本征值落在能量窗内（即 $W_{\\mathrm{V}}+W_{\\mathrm{O}}+W_{\\mathrm{Sr}}=0$），则该情况返回 $\\bigl[0.000,0.000,0.000\\bigr]$。使用能量半宽 $W=0.5\\,\\mathrm{eV}$。\n\n使用以下参数集测试套件（所有能量单位均为 $\\mathrm{eV}$）：\n\n- 情况 $T_1$（基准混合）：\n  - $\\varepsilon_d=0.0$, $t_{dd}=-0.4$,\n  - $\\varepsilon_p=-3.0$, $t_{pp}=-0.2$,\n  - $V_{dp}=1.0$,\n  - $\\varepsilon_s=6.0$, $t_{ss}=0.2$,\n  - $V_{ds}=0.0$.\n\n- 情况 $T_2$（解耦的 $d$–$p$）：\n  - 除 $V_{dp}=0.0$ 外，与 $T_1$ 相同。\n\n- 情况 $T_3$（$E_F$ 附近增强的 $d$–$p$ 杂化）：\n  - $\\varepsilon_d=0.0$, $t_{dd}=-0.4$,\n  - $\\varepsilon_p=-1.0$, $t_{pp}=-0.2$,\n  - $V_{dp}=1.2$,\n  - $\\varepsilon_s=6.0$, $t_{ss}=0.2$,\n  - $V_{ds}=0.0$.\n\n- 情况 $T_4$（能带远离 $E_F$，窗内无态）：\n  - $\\varepsilon_d=4.0$, $t_{dd}=-0.1$,\n  - $\\varepsilon_p=-4.0$, $t_{pp}=-0.1$,\n  - $V_{dp}=0.5$,\n  - $\\varepsilon_s=8.0$, $t_{ss}=0.1$,\n  - $V_{ds}=0.0$.\n\n您的程序必须使用上述定义计算每种情况下的 PDOS 分数 $\\bigl[f_{\\mathrm{Sr}},f_{\\mathrm{V}},f_{\\mathrm{O}}\\bigr]$，其中 BZ 在每个倒易方向上使用 $N_k=21$ 个点的均匀网格进行采样，且 $W=0.5\\,\\mathrm{eV}$。角度必须以弧度为单位。能量必须以电子伏特为单位。\n\n最终输出格式：您的程序应生成单行输出，包含一个以逗号分隔的列表的列表，顺序为 $\\bigl[T_1,T_2,T_3,T_4\\bigr]$，其中每个列表是四舍五入到三位小数的有序三元组 $\\bigl[f_{\\mathrm{Sr}},f_{\\mathrm{V}},f_{\\mathrm{O}}\\bigr]$。例如：$\\bigl[\\,[0.000,0.950,0.050],[\\dots],\\dots\\,\\bigr]$。", "solution": "问题陈述经过验证，被认为是有效的。它提出了一个计算凝聚态物理学中定义明确的问题，该问题基于紧束缚理论的既定原理。所有必要的参数、定义和数学结构都已完整且无矛盾地提供。任务是为一个简化的钙钛矿模型计算轨道分辨的投影态密度（PDOS），这是该领域一个标准且有意义的练习。\n\n目标是计算每种轨道类型——钒 $d$ 轨道（$\\lvert \\mathrm{V}\\,d \\rangle$）、氧 $p$ 轨道（$\\lvert \\mathrm{O}\\,p \\rangle$）和锶 $s$ 轨道（$\\lvert \\mathrm{Sr}\\,s \\rangle$）——对费米能级 $E_F$ 周围一个小能量窗内电子态的贡献分数。问题将此窗定义为 $[E_F - W, E_F + W]$，其中 $E_F=0\\,\\mathrm{eV}$，半宽 $W=0.5\\,\\mathrm{eV}$。\n\n计算的核心涉及在覆盖第一布里渊区（BZ）的晶体动量矢量 $\\mathbf{k}$ 的离散网格上，对动量依赖的 $3 \\times 3$ 布洛赫哈密顿量 $H(\\mathbf{k})$ 进行对角化。BZ 被定义为一个立方体，其中 $k_x, k_y, k_z \\in [-\\pi, \\pi)$。这个连续空间由一个 $N_k \\times N_k \\times N_k$ 点的均匀网格来近似，其中 $N_k=21$。\n\n对于网格上的每个 $\\mathbf{k}$ 点，我们执行以下步骤：\n$1$. 使用提供的参数 $(\\varepsilon_\\alpha, t_{\\alpha\\beta}, V_{\\alpha\\beta})$ 和结构因子 $S(\\mathbf{k})$ 与 $C(\\mathbf{k})$ 构建哈密顿矩阵 $H(\\mathbf{k})$。\n$$\nH(\\mathbf{k})=\n\\begin{pmatrix}\n\\varepsilon_d + 2 t_{dd} S(\\mathbf{k})  V_{dp}\\, C(\\mathbf{k})  V_{ds}\\, C(\\mathbf{k}) \\\\\nV_{dp}\\, C(\\mathbf{k})  \\varepsilon_p + 2 t_{pp} S(\\mathbf{k})  0 \\\\\nV_{ds}\\, C(\\mathbf{k})  0  \\varepsilon_s + 2 t_{ss} S(\\mathbf{k})\n\\end{pmatrix}\n$$\n基的顺序为 $\\{\\lvert \\mathrm{V}\\,d\\rangle, \\lvert \\mathrm{O}\\,p\\rangle, \\lvert \\mathrm{Sr}\\,s\\rangle\\}$。由于所有参数都是实数，$H(\\mathbf{k})$ 是一个实对称矩阵，这是厄米矩阵的一个特例。\n\n$2$. 对角化 $H(\\mathbf{k})$ 以获得其三个实数本征值 $E_n(\\mathbf{k})$ 和对应的正交归一的本征矢量 $\\mathbf{u}_n(\\mathbf{k})$，其中能带指数 $n=1,2,3$。本征矢量 $\\mathbf{u}_n(\\mathbf{k})$ 是一个列矢量，其分量 $u_{\\alpha n}(\\mathbf{k})$ 给出布洛赫态在轨道基函数上的投影。归一化条件 $\\sum_{\\alpha} |u_{\\alpha n}(\\mathbf{k})|^2 = 1$ 可由标准的数值对角化程序满足。\n\n$3$. 对于每个本征态 $(\\mathbf{k}, n)$，我们检查其能量 $E_n(\\mathbf{k})$ 是否落在指定窗口内，即 $|E_n(\\mathbf{k}) - E_F| \\le W$。\n\n$4$. 如果态在窗口内，其对每个轨道 $\\alpha$ 的态密度的贡献由相应本征矢量分量的模平方 $|u_{\\alpha n}(\\mathbf{k})|^2$ 给出。将满足能量条件的所有态 $(\\mathbf{k}, n)$ 的这些贡献相加。这就得出了每个轨道的总未归一化权重，我们可以将其表示为 $W'_{\\alpha}$：\n$$\nW'_{\\alpha} = \\sum_{\\mathbf{k},n} |u_{\\alpha n}(\\mathbf{k})|^2 \\, \\Theta(W - |E_n(\\mathbf{k}) - E_F|)\n$$\n问题定义 $W_\\alpha$ 中的归一化因子 $1/N_k^3$ 对所有轨道都是一个共同的缩放因子，在计算分数时会被抵消。\n\n$5$. 在对所有 $\\mathbf{k}$ 点求和后，我们得到总的积分权重 $W'_{\\mathrm{V}}$、$W'_{\\mathrm{O}}$ 和 $W'_{\\mathrm{Sr}}$。总权重为 $W'_{\\text{total}} = W'_{\\mathrm{V}} + W'_{\\mathrm{O}} + W'_{\\mathrm{Sr}}$。\n\n$6$. 最后，通过将单个轨道权重除以总权重来计算 PDOS 分数 $f_\\alpha$：$f_\\alpha = W'_{\\alpha} / W'_{\\text{total}}$。如果 $W'_{\\text{total}}$ 为零（意味着在能量窗口内没有找到任何态），则所有分数都定义为零。\n\n每个测试用例的最终输出是有序三元组 $[f_{\\mathrm{Sr}}, f_{\\mathrm{V}}, f_{\\mathrm{O}}]$，每个值都四舍五入到三位小数。对所提供的四个参数集中的每一个重复整个过程。该实现将利用 `numpy` 进行高效的数组运算，并通过 `numpy.linalg.eigh` 对哈密顿量进行对角化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the orbital-resolved projected density of states (PDOS) fractions\n    for a tight-binding model of a cubic perovskite.\n    \"\"\"\n\n    # Define the constants from the problem statement.\n    N_k = 21\n    W = 0.5\n    E_F = 0.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case T1 (baseline mixing)\n        {\n            'eps_d': 0.0, 't_dd': -0.4,\n            'eps_p': -3.0, 't_pp': -0.2,\n            'V_dp': 1.0,\n            'eps_s': 6.0, 't_ss': 0.2,\n            'V_ds': 0.0,\n        },\n        # Case T2 (decoupled d–p)\n        {\n            'eps_d': 0.0, 't_dd': -0.4,\n            'eps_p': -3.0, 't_pp': -0.2,\n            'V_dp': 0.0,\n            'eps_s': 6.0, 't_ss': 0.2,\n            'V_ds': 0.0,\n        },\n        # Case T3 (enhanced d–p hybridization near EF)\n        {\n            'eps_d': 0.0, 't_dd': -0.4,\n            'eps_p': -1.0, 't_pp': -0.2,\n            'V_dp': 1.2,\n            'eps_s': 6.0, 't_ss': 0.2,\n            'V_ds': 0.0,\n        },\n        # Case T4 (bands far from EF, no states in window)\n        {\n            'eps_d': 4.0, 't_dd': -0.1,\n            'eps_p': -4.0, 't_pp': -0.1,\n            'V_dp': 0.5,\n            'eps_s': 8.0, 't_ss': 0.1,\n            'V_ds': 0.0,\n        },\n    ]\n\n    all_results = []\n\n    # Generate the k-point grid for the first Brillouin Zone\n    # k_x, k_y, k_z are in [-pi, pi)\n    k_points = np.linspace(-np.pi, np.pi, N_k, endpoint=False)\n    sqrt3 = np.sqrt(3.0)\n\n    for params in test_cases:\n        # Extract parameters for the current case\n        eps_d, t_dd = params['eps_d'], params['t_dd']\n        eps_p, t_pp = params['eps_p'], params['t_pp']\n        eps_s, t_ss = params['eps_s'], params['t_ss']\n        V_dp, V_ds = params['V_dp'], params['V_ds']\n        \n        # Initialize accumulated weights for V, O, Sr orbitals\n        W_V, W_O, W_Sr = 0.0, 0.0, 0.0\n\n        # Iterate over all k-points in the 3D grid\n        for kx in k_points:\n            for ky in k_points:\n                for kz in k_points:\n                    # Calculate structure factors S(k) and C(k)\n                    S_k = np.cos(kx) + np.cos(ky) + np.cos(kz)\n                    C_k = (np.sin(kx) + np.sin(ky) + np.sin(kz)) / sqrt3\n                    \n                    # Construct the 3x3 Hamiltonian matrix H(k)\n                    # Basis order: {V_d, O_p, Sr_s}\n                    H = np.zeros((3, 3), dtype=np.float64)\n                    H[0, 0] = eps_d + 2.0 * t_dd * S_k\n                    H[1, 1] = eps_p + 2.0 * t_pp * S_k\n                    H[2, 2] = eps_s + 2.0 * t_ss * S_k\n                    H[0, 1] = H[1, 0] = V_dp * C_k\n                    H[0, 2] = H[2, 0] = V_ds * C_k\n                    # H[1, 2] = H[2, 1] = 0.0 is implicit\n                    \n                    # Diagonalize the Hermitian matrix to find eigenvalues and eigenvectors\n                    evals, evecs = np.linalg.eigh(H)\n                    \n                    # Iterate over the 3 bands (eigenstates)\n                    for n in range(3):\n                        # Check if eigenvalue is within the energy window [E_F - W, E_F + W]\n                        if np.abs(evals[n] - E_F) = W:\n                            # Accumulate squared eigenvector components (orbital weights)\n                            # evecs are normalized columns: evecs[:, n] is the nth eigenvector\n                            # evecs[0, n] -> V_d component\n                            # evecs[1, n] -> O_p component\n                            # evecs[2, n] -> Sr_s component\n                            W_V += evecs[0, n]**2\n                            W_O += evecs[1, n]**2\n                            W_Sr += evecs[2, n]**2\n                            \n        # Calculate total weight\n        W_total = W_V + W_O + W_Sr\n\n        # Calculate PDOS fractions, handling the case of zero total weight\n        if W_total > 1e-12: # Use a tolerance for float comparison\n            f_V = W_V / W_total\n            f_O = W_O / W_total\n            f_Sr = W_Sr / W_total\n        else:\n            f_V, f_O, f_Sr = 0.0, 0.0, 0.0\n            \n        # Append the ordered triple [f_Sr, f_V, f_O] for the current case\n        all_results.append([f_Sr, f_V, f_O])\n\n    # Format the final output string as specified: [[...],[...],...]\n    # Each number is rounded to three decimal places without trailing zeros if not needed.\n    # The f-string formatting ensures exactly three decimal places.\n    inner_lists_str = []\n    for res in all_results:\n        # res is [f_Sr, f_V, f_O]\n        inner_lists_str.append(f\"[{res[0]:.3f},{res[1]:.3f},{res[2]:.3f}]\")\n    \n    final_output_str = f\"[{','.join(inner_lists_str)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```", "id": "2387879"}, {"introduction": "计算材料科学的一个核心挑战是评估计算结果的可靠性。这项高级实践将引导您使用PDOS作为一种强大的诊断工具，来检验计算中基组的完备性。该练习模拟了一个常见情景：将一个有限的局域基组的计算结果与一个高精度的平面波基准进行比较。通过系统地分析两者之间的差异，您将学会如何识别特定角动量通道中的基组缺陷，这是确保计算预测准确性的关键一步 [@problem_id:3443589]。", "problem": "要求您设计并实现一个完整的、可运行的程序。该程序给定不同角动量通道的合成投影态密度 (PDOS) 数据，通过比较平面波参考和局域基组，定量评估基组完备性的影响，定义一个数学上合理的差异度量，并通过分析成键峰周围的系统性残差来自动识别缺失的极化函数。\n\n请从以下电子结构理论和信号处理的基础出发：\n\n- 态密度 (DOS) 是电子态在能量上的谱分布。DOS 和投影态密度 (PDOS) 可以从单粒子态的谱表示中定义。对于一组归一化的无自旋本征态 $\\{ \\lvert \\psi_{n\\mathbf{k}} \\rangle \\}$，其能量为 $\\{ \\epsilon_{n\\mathbf{k}} \\}$，DOS为 $D(E) = \\sum_{n,\\mathbf{k}} \\delta(E - \\epsilon_{n\\mathbf{k}})$，而投影到具有投影算符 $\\hat{\\Pi}_{\\alpha}$ 的局域通道 $\\alpha$ 上的 PDOS 为 $P_{\\alpha}(E) = \\sum_{n,\\mathbf{k}} \\langle \\psi_{n\\mathbf{k}} \\rvert \\hat{\\Pi}_{\\alpha} \\lvert \\psi_{n\\mathbf{k}} \\rangle \\, \\delta(E - \\epsilon_{n\\mathbf{k}})$。在实践中，狄拉克δ函数 $\\delta(\\cdot)$ 由一个平滑的展宽核函数近似。\n- 平面波基组是可系统性改进的，通常用作完备性的参考，而局域基组在没有适当的极化函数（例如，$p$ 或 $d$ 函数）来捕捉成键引起的角向畸变时可能是不完备的。不完备性通常表现为在特定角动量通道中，成键峰附近的系统性残差。\n- 对两个信号进行最小二乘对齐和缩放是比较谱图的一种经过充分检验的方法。通过微小的刚性平移来对齐能量轴，并缩放振幅以最小化平方误差，这是计算差异之前的标准预处理步骤。\n\n您的任务如下：\n\n1. 在均匀能量格点上为两种表示构建合成的PDOS数据：一种是平面波参考，另一种是局域基组。每个角动量通道使用高斯展宽峰的总和来模拟谱特征。设能量格点为 $E \\in [E_{\\min}, E_{\\max}]$，单位为电子伏特 (eV)，间距均匀为 $\\Delta E$。每个中心在 $\\mu$、宽度为 $\\sigma$、振幅为 $A$ 的高斯峰贡献 $A \\, g_{\\sigma}(E-\\mu)$，其中 $g_{\\sigma}(x) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{x^2}{2\\sigma^2}\\right)$，使得其能量积分为 $A$。一个通道 $\\alpha$ 的总PDOS是该通道所有峰的总和。总DOS为 $T(E) = \\sum_{\\alpha} P_{\\alpha}(E)$。\n\n2. 通过一个平移量 $\\delta$ 对局域PDOS进行刚性能量对齐，该平移量在有界搜索窗口内最小化与平面波总DOS的最小二乘不匹配。在一个离散的 $\\delta \\in [\\delta_{\\min}, \\delta_{\\max}]$ 范围内进行扫描，并在每个 $\\delta$ 处，通过最小化平面波总DOS与平移、缩放后的局域总DOS之间的平方误差，来获得总DOS的最优振幅缩放 $s_{\\text{tot}}$。使用线性插值在平面波能量格点上评估平移后的局域DOS。不要假设能量具有周期性。\n\n3. 在从步骤2中确定了最优能量平移 $\\delta^{\\star}$后，对于每个角通道 $\\alpha$，通过最小化平面波PDOS $P_{\\alpha}^{\\mathrm{PW}}(E)$ 和平移后的局域PDOS $P_{\\alpha}^{\\mathrm{L}}(E-\\delta^{\\star})$ 之间的最小二乘不匹配来确定一个最优振幅缩放 $s_{\\alpha}$。\n\n4. 定义并计算分通道差异函数 $\\Delta P_{\\alpha}(E)$，即平面波PDOS与缩放、平移后的局域PDOS之差，并计算每个通道的归一化均方根偏差 (NRMSD)。使用一种归一化方法，使该度量无量纲且可在不同通道间进行比较。\n\n5. 通过识别超过全局最大值一定比例的平面波总DOS $T^{\\mathrm{PW}}(E)$ 的局域极大值来检测成键峰，并在每个检测到的峰周围形成固定宽度的窗口。在这些窗口的并集内，对于每个通道 $\\alpha$，测量残差 $\\Delta P_{\\alpha}(E)$ 的正部积分，并用相应的积分平面波PDOS进行归一化。使用这个归一化残差来推断局域基组中可能缺少哪个极化通道。\n\n6. 制定一个决策规则，如果通道 $\\alpha$ 的归一化积分残差足够大，并且显著大于其他通道的残差，则将其标记为缺少极化函数。\n\n所有能量必须以电子伏特 (eV) 为单位。不使用角度。您的程序必须从第一性原理实现以上步骤，并产生浮点单位的数值输出（差异度量为无量纲）。不允许用户输入；程序必须是自包含的。\n\n测试套件与合成数据规范：\n\n- 使用从 $E_{\\min} = -10.0$到 $E_{\\max} = 5.0$ 的均匀能量格点，间距 $\\Delta E = 0.01$，单位均为eV。所有峰使用高斯宽度 $\\sigma = 0.15$ eV。设角动量通道为 $\\alpha \\in \\{s,p,d\\}$。对于每个测试用例，指定平面波峰参数以及生成局域PDOS的修改。局域PDOS的构建方法是：首先将平面波峰的振幅乘以指定的、依赖于通道和峰的因子，然后将得到的整个局域谱进行刚性能量平移 $\\delta_{\\mathrm{L}}$ (eV)。\n\n- 能量对齐的平移搜索范围：$\\delta_{\\min} = -0.2$ eV, $\\delta_{\\max} = +0.2$ eV，均匀扫描步长 $\\Delta \\delta = 0.002$ eV。\n\n- 平面波总DOS中的峰检测：识别 $T^{\\mathrm{PW}}(E)$ 是局域极大值且超过全局最大值 $\\theta_{\\mathrm{peak}} = 0.2$ 倍的索引。在每个检测到的峰中心 $E_{p}$ 周围，定义一个对称窗口 $[E_{p}-W, E_{p}+W]$，其中 $W = 0.45$ eV。如有必要，合并重叠的窗口。\n\n- 通道 $\\alpha$ 的归一化均方根偏差：定义为\n$$\n\\mathrm{NRMSD}_{\\alpha} \\equiv \\sqrt{\\frac{\\sum_{i} \\left(\\Delta P_{\\alpha}(E_{i})\\right)^{2}}{\\sum_{i} \\left(P_{\\alpha}^{\\mathrm{PW}}(E_{i})\\right)^{2} + \\varepsilon}},\n$$\n其中小的 $\\varepsilon$ (无量纲) 仅用于避免在退化情况下除以零。\n\n- 成键窗口周围的分通道归一化正残差：对于每个通道 $\\alpha$，定义为\n$$\nR_{\\alpha} \\equiv \\frac{\\sum_{w \\in \\mathcal{W}} \\int_{w} \\max\\!\\left(\\Delta P_{\\alpha}(E), 0\\right) \\, dE}{\\sum_{w \\in \\mathcal{W}} \\int_{w} P_{\\alpha}^{\\mathrm{PW}}(E) \\, dE + \\varepsilon},\n$$\n其中 $\\mathcal{W}$ 是从 $T^{\\mathrm{PW}}(E)$ 检测到的成键窗口集合。\n\n- 缺少通道 $\\alpha$ 中极化函数的决策规则：如果 $R_{\\alpha} > \\tau$ 并且 $R_{\\alpha} \\ge \\max_{\\beta \\neq \\alpha} R_{\\beta} + \\Delta$，则标记通道 $\\alpha$ 为缺失，其中 $\\tau = 0.15$ 且 $\\Delta = 0.05$。\n\n定义以下四个测试用例；在每个用例中，使用公共参数 $E_{\\min} = -10.0$, $E_{\\max} = 5.0$, $\\Delta E = 0.01$, $\\sigma = 0.15$ eV。每个峰由其中心 $\\mu$ (eV) 和平面波振幅三元组 $(A_{s}, A_{p}, A_{d})$ 指定。局域PDOS是通过将每个通道的振幅乘以一个逐峰因子 $(f_{s}, f_{p}, f_{d})$，然后将得到的局域谱进行刚性能量平移 $\\delta_{\\mathrm{L}}$ (eV) 而形成的。\n\n- 测试用例1 (理想情况，成键峰附近缺少 $p$ 函数)：\n    - 平面波峰：\n        - $\\mu = -6.0$, $(A_{s}, A_{p}, A_{d}) = (1.0, 0.2, 0.0)$\n        - $\\mu = -4.0$, $(A_{s}, A_{p}, A_{d}) = (0.2, 1.5, 0.1)$\n        - $\\mu = -1.0$, $(A_{s}, A_{p}, A_{d}) = (0.1, 0.3, 0.0)$\n    - 每个峰的局域乘子 (顺序同上)：\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 0.6, 1.0)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n    - 局域刚性平移：$\\delta_{\\mathrm{L}} = 0.0$。\n\n- 测试用例2 (完备基组，无缺失极化函数)：\n    - 平面波峰：\n        - $\\mu = -5.0$, $(A_{s}, A_{p}, A_{d}) = (0.8, 0.3, 0.1)$\n        - $\\mu = -2.5$, $(A_{s}, A_{p}, A_{d}) = (0.2, 0.7, 0.2)$\n        - $\\mu = -0.5$, $(A_{s}, A_{p}, A_{d}) = (0.1, 0.2, 0.1)$\n    - 每个峰的局域乘子：\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n    - 局域刚性平移：$\\delta_{\\mathrm{L}} = 0.0$。\n\n- 测试用例3 (主要为d特征的成键峰，缺少d函数)：\n    - 平面波峰：\n        - $\\mu = -6.5$, $(A_{s}, A_{p}, A_{d}) = (0.3, 0.2, 0.1)$\n        - $\\mu = -3.0$, $(A_{s}, A_{p}, A_{d}) = (0.2, 0.4, 1.2)$\n        - $\\mu = -1.5$, $(A_{s}, A_{p}, A_{d}) = (0.1, 0.2, 0.3)$\n    - 每个峰的局域乘子：\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 0.5)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 0.5)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 0.5)$\n    - 局域刚性平移：$\\delta_{\\mathrm{L}} = 0.0$。\n\n- 测试用例4 (与测试用例1相同，但有能量失准和稍强的p函数缺陷)：\n    - 平面波峰：与测试用例1相同。\n    - 每个峰的局域乘子：\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 0.7, 1.0)$\n        - $(f_{s}, f_{p}, f_{d}) = (1.0, 1.0, 1.0)$\n    - 局域刚性平移：$\\delta_{\\mathrm{L}} = +0.1$。\n\n您的程序必须：\n\n- 根据上述规范，为通道 $\\alpha \\in \\{s,p,d\\}$ 生成合成的平面波和局域PDOS。\n- 按照描述通过最小二乘法执行能量对齐和逐通道缩放。\n- 为每个测试用例计算 $\\Delta P_{\\alpha}(E)$ 和逐通道的 $\\mathrm{NRMSD}_{\\alpha}$。\n- 在 $T^{\\mathrm{PW}}(E)$ 中检测成键峰，形成窗口，计算 $R_{\\alpha}$，并应用决策规则获得三个标签，指示 $s, p, d$ 通道是否缺少极化函数。\n- 对每个测试用例，生成一个包含六个条目的结果列表：$[\\mathrm{NRMSD}_{s}, \\mathrm{NRMSD}_{p}, \\mathrm{NRMSD}_{d}, m_{s}, m_{p}, m_{d}]$，其中如果通道被分类为缺失，则 $m_{\\alpha}$ 为 $1$，否则为 $0$。$\\mathrm{NRMSD}_{\\alpha}$ 使用浮点数，四舍五入到四位小数，$m_{\\alpha}$ 使用整数。\n\n最终输出格式要求：\n\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，该列表用方括号括起来，每个元素对应一个测试用例的列表：例如，`[[x_{11},x_{12},\\dots],[x_{21},\\dots],\\dots]`，不含空格。", "solution": "所提出的问题在计算材料科学领域，特别是在电子结构数据分析方面，是一个表述清晰且具有科学依据的练习。它要求实现一系列标准的数值技术来比较两组投影态密度 (PDOS) 数据，目的是自动识别局域基组中的缺陷。该问题是有效的。\n\n解决方案系统地按所需任务进行，从生成合成数据开始，到最终确定基组完备性的决策规则。\n\n### 1. 投影态密度 (PDOS) 的合成\n\n此分析的基础是一组PDOS曲线，它们表示不同角动量通道 ($\\alpha \\in \\{s, p, d\\}$) 对给定能量 $E$ 下总电子态密度的贡献。我们将每个通道的PDOS建模为高斯函数的总和，这是近似DOS形式定义中狄拉克δ函数的常用做法, $D(E) = \\sum_{n,\\mathbf{k}} \\delta(E - \\epsilon_{n\\mathbf{k}})$。\n\n一个中心在能量 $\\mu$、标准差为 $\\sigma$、振幅为 $A$ 的单一谱峰对PDOS的贡献为一个函数 $A \\cdot g_{\\sigma}(E-\\mu)$，其中 $g_{\\sigma}(x)$ 是归一化的高斯函数：\n$$\ng_{\\sigma}(x) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)\n$$\n给定通道 $\\alpha$ 的总PDOS，记为 $P_{\\alpha}(E)$，是该通道所有此类贡献的总和：\n$$\nP_{\\alpha}(E) = \\sum_{j} A_{j,\\alpha} \\, g_{\\sigma}(E-\\mu_j)\n$$\n其中求和遍历所有峰 $j$。总DOS是所有通道的总和：$T(E) = \\sum_{\\alpha} P_{\\alpha}(E)$。\n\n对于这个问题，我们在均匀能量格点 $\\{E_i\\}$ 上生成两组PDOS数据：\n1.  **平面波 (PW) 参考 ($P_{\\alpha}^{\\mathrm{PW}}$)**：这被认为是“精确”或完备基组的结果，直接由指定的峰振幅 $A_{j,\\alpha}$ 生成。\n2.  **局域基组 ($P_{\\alpha}^{\\mathrm{L}}$)**：这代表了来自不完备基组的结果。它是通过首先将平面波峰振幅按通道相关的因子 $f_{j,\\alpha}$ 进行缩放，然后对整个谱应用刚性能量平移 $\\delta_{\\mathrm{L}}$ 来合成的。振幅因子 $f_{j,\\alpha}  1$ 模拟了局域基组无法完全在该通道和能量区域表示波函数特征的情况。\n\n### 2. 最优能量对齐\n\n在进行有意义的比较之前，我们必须考虑能量轴和整体强度上可能由不同计算设置引起（而非基组不完备性本身引起）的微小、系统性差异。这通过一个最小二乘对齐程序来实现。\n\n该程序首先确定一个最优的刚性能量平移 $\\delta^{\\star}$，通过最小化平面波参考的总DOS $T^{\\mathrm{PW}}(E)$与平移后的局域基组DOS $T^{\\mathrm{L}}(E-\\delta)$之间的不匹配度。我们还引入一个缩放因子 $s_{\\text{tot}}$ 来考虑整体强度的差异。目标是找到最小化平方误差的平移量 $\\delta$：\n$$\nJ(\\delta) = \\min_{s_{\\text{tot}}} \\sum_{i} \\left( T^{\\mathrm{PW}}(E_i) - s_{\\text{tot}} T^{\\mathrm{L}}(E_i - \\delta) \\right)^2\n$$\n对于一个固定的 $\\delta$，最小化此表达式的最优缩放因子 $s_{\\text{tot}}$ 由标准的线性最小二乘解给出：\n$$\ns_{\\text{tot}}(\\delta) = \\frac{\\sum_{i} T^{\\mathrm{PW}}(E_i) T^{\\mathrm{L}}_{\\text{interp}}(E_i; \\delta)}{\\sum_{i} \\left( T^{\\mathrm{L}}_{\\text{interp}}(E_i; \\delta) \\right)^2 + \\varepsilon}\n$$\n其中 $T^{\\mathrm{L}}_{\\text{interp}}(E_i; \\delta)$ 是局域总DOS在能量 $E_i$ 处的值，通过将其原始能量轴平移 $-\\delta$ 并使用线性插值在格点 $\\{E_i\\}$ 上求值得到。小常数 $\\varepsilon$ 确保数值稳定性。我们在指定的 $\\delta$ 值范围内进行离散扫描，以找到 $J(\\delta)$ 的全局最小值，从而得到最优平移 $\\delta^{\\star}$。\n\n### 3. 逐通道振幅缩放\n\n在确定最优能量对齐 $\\delta^{\\star}$ 后，我们在逐通道的基础上精细调整振幅缩放。这考虑到不同角动量通道可能具有不同的整体表示质量。对于每个通道 $\\alpha$，我们找到一个最优缩放因子 $s_{\\alpha}$，它最小化参考PDOS $P_{\\alpha}^{\\mathrm{PW}}(E)$ 和平移后的局域PDOS $P_{\\alpha}^{\\mathrm{L}}(E-\\delta^{\\star})$ 之间的平方误差：\n$$\ns_{\\alpha} = \\arg\\min_{s} \\sum_{i} \\left( P_{\\alpha}^{\\mathrm{PW}}(E_i) - s \\cdot P_{\\alpha, \\text{interp}}^{\\mathrm{L}}(E_i; \\delta^{\\star}) \\right)^2\n$$\n解析解类似于总DOS的情况：\n$$\ns_{\\alpha} = \\frac{\\sum_{i} P_{\\alpha}^{\\mathrm{PW}}(E_i) P_{\\alpha, \\text{interp}}^{\\mathrm{L}}(E_i; \\delta^{\\star})}{\\sum_{i} \\left( P_{\\alpha, \\text{interp}}^{\\mathrm{L}}(E_i; \\delta^{\\star}) \\right)^2 + \\varepsilon}\n$$\n其中 $P_{\\alpha, \\text{interp}}^{\\mathrm{L}}(E_i; \\delta^{\\star})$ 是通道 $\\alpha$ 的局域PDOS在应用平移 $\\delta^{\\star}$ 后在能量 $E_i$ 处的插值。\n\n### 4. 量化差异\n\n对齐和缩放之后，两个谱之间的剩余差异归因于局域基组的内在缺陷。我们将分通道差异函数定义为：\n$$\n\\Delta P_{\\alpha}(E) = P_{\\alpha}^{\\mathrm{PW}}(E) - s_{\\alpha} P_{\\alpha, \\text{interp}}^{\\mathrm{L}}(E; \\delta^{\\star})\n$$\n为了用单个数字量化每个通道的整体不匹配程度，我们计算归一化均方根偏差 (NRMSD)，定义为：\n$$\n\\mathrm{NRMSD}_{\\alpha} = \\sqrt{\\frac{\\sum_{i} \\left(\\Delta P_{\\alpha}(E_{i})\\right)^{2}}{\\sum_{i} \\left(P_{\\alpha}^{\\mathrm{PW}}(E_{i})\\right)^{2} + \\varepsilon}}\n$$\n该度量提供了一个无量纲的通道 $\\alpha$ 相对误差度量，使其可在具有不同绝对强度的通道之间进行比较。\n\n### 5. 识别缺失的极化函数\n\n核心假设是基组不完备性，例如在形成共价键的原子上缺少 $p$ 函数，将表现为在与化学键相关的能量区域内，相应PDOS通道中的系统性亏损（即 $\\Delta P_{\\alpha}(E) > 0$）。\n\n检测此现象的算法如下：\n1.  **定位成键区域**：我们通过在参考总DOS $T^{\\mathrm{PW}}(E)$ 中寻找显著的峰来识别成键区域。一个峰被定义为一个局域极大值，其高度超过全局最大DOS的指定分数 $\\theta_{\\text{peak}}$。\n2.  **定义分析窗口**：围绕每个已识别的成键峰构建一个固定宽度的能量窗口 $\\mathcal{W}$。重叠的窗口被合并成一组不相交的分析区间。\n3.  **计算归一化残差**：对于每个通道 $\\alpha$，我们仅在这些成键窗口内计算残差 $\\Delta P_{\\alpha}(E)$ 的正部积分。然后，该值通过相同窗口内参考PDOS的总积分强度进行归一化。这产生了度量 $R_{\\alpha}$：\n    $$\n    R_{\\alpha} = \\frac{\\sum_{w \\in \\mathcal{W}} \\int_{w} \\max\\!\\left(\\Delta P_{\\alpha}(E), 0\\right) \\, dE}{\\sum_{w \\in \\mathcal{W}} \\int_{w} P_{\\alpha}^{\\mathrm{PW}}(E) \\, dE + \\varepsilon}\n    $$\n    积分通过对落在窗口 $\\mathcal{W}$ 内的离散能量格点上的值求和来数值近似。度量 $R_{\\alpha}$ 特别测量了局域基组在关键成键区域的相对*亏损*。\n\n### 6. 决策规则\n\n最后，应用一个正式的决策规则将一个通道分类为“缺失”极化函数。一个通道 $\\alpha$ 被标记，如果其归一化残差 $R_{\\alpha}$ 同时满足：\na.  **绝对值大**：$R_{\\alpha}$ 必须超过一个最小阈值 $\\tau$，表明存在显著亏损。\nb.  **相对值大**：$R_{\\alpha}$ 必须比任何其他通道 $\\beta$ 的残差至少大一个边际量 $\\Delta$。这确保我们标记出具有最显著和特定缺陷的通道。\n\n该条件正式表述为：如果 $R_{\\alpha} > \\tau$ 并且 $R_{\\alpha} \\ge \\max_{\\beta \\neq \\alpha} R_{\\beta} + \\Delta$，则通道 $\\alpha$ 是缺失的。这种方法提供了一个自动、定量且物理上合理的工具，用于从PDOS数据诊断基组不完备性。", "answer": "```python\nimport numpy as np\nimport math\n\n# Self-contained, runnable Python 3 code. No external files or user input needed.\n\ndef solve():\n    \"\"\"\n    Main function to run the PDOS analysis for all test cases.\n    \"\"\"\n    # Common parameters for all test cases\n    E_MIN = -10.0\n    E_MAX = 5.0\n    DELTA_E = 0.01\n    SIGMA = 0.15\n    CHANNELS = ['s', 'p', 'd']\n\n    # Alignment and analysis parameters\n    DELTA_MIN = -0.2\n    DELTA_MAX = 0.2\n    DELTA_DELTA = 0.002\n    THETA_PEAK = 0.2\n    W_PEAK = 0.45\n    TAU = 0.15\n    DELTA_MISSING = 0.05\n    EPSILON = 1e-12\n\n    test_cases = [\n        # Case 1: Missing p near bonding peak\n        {\n            \"pw_peaks\": [\n                (-6.0, (1.0, 0.2, 0.0)),\n                (-4.0, (0.2, 1.5, 0.1)),\n                (-1.0, (0.1, 0.3, 0.0)),\n            ],\n            \"loc_multipliers\": [\n                (1.0, 1.0, 1.0),\n                (1.0, 0.6, 1.0),\n                (1.0, 1.0, 1.0),\n            ],\n            \"loc_shift\": 0.0,\n        },\n        # Case 2: Complete basis\n        {\n            \"pw_peaks\": [\n                (-5.0, (0.8, 0.3, 0.1)),\n                (-2.5, (0.2, 0.7, 0.2)),\n                (-0.5, (0.1, 0.2, 0.1)),\n            ],\n            \"loc_multipliers\": [\n                (1.0, 1.0, 1.0),\n                (1.0, 1.0, 1.0),\n                (1.0, 1.0, 1.0),\n            ],\n            \"loc_shift\": 0.0,\n        },\n        # Case 3: Missing d\n        {\n            \"pw_peaks\": [\n                (-6.5, (0.3, 0.2, 0.1)),\n                (-3.0, (0.2, 0.4, 1.2)),\n                (-1.5, (0.1, 0.2, 0.3)),\n            ],\n            \"loc_multipliers\": [\n                (1.0, 1.0, 0.5),\n                (1.0, 1.0, 0.5),\n                (1.0, 1.0, 0.5),\n            ],\n            \"loc_shift\": 0.0,\n        },\n        # Case 4: Missing p with energy misalignment\n        {\n            \"pw_peaks\": [\n                (-6.0, (1.0, 0.2, 0.0)),\n                (-4.0, (0.2, 1.5, 0.1)),\n                (-1.0, (0.1, 0.3, 0.0)),\n            ],\n            \"loc_multipliers\": [\n                (1.0, 1.0, 1.0),\n                (1.0, 0.7, 1.0),\n                (1.0, 1.0, 1.0),\n            ],\n            \"loc_shift\": 0.1,\n        },\n    ]\n\n    # Pre-calculate common arrays\n    energy_grid = np.arange(E_MIN, E_MAX, DELTA_E)\n    delta_scan_grid = np.arange(DELTA_MIN, DELTA_MAX + DELTA_DELTA / 2, DELTA_DELTA)\n    gaussian_norm = 1.0 / (SIGMA * math.sqrt(2.0 * math.pi))\n\n    def generate_pdos(peaks, multipliers=None):\n        pdos = {ch: np.zeros_like(energy_grid) for ch in CHANNELS}\n        for i, (mu, amps) in enumerate(peaks):\n            for j, ch in enumerate(CHANNELS):\n                amp = amps[j]\n                if multipliers:\n                    amp *= multipliers[i][j]\n                if amp > 0:\n                    exponent = -((energy_grid - mu) ** 2) / (2 * SIGMA ** 2)\n                    pdos[ch] += amp * gaussian_norm * np.exp(exponent)\n        return pdos\n\n    results = []\n    \n    for case in test_cases:\n        # 1. Generate PDOS data\n        pdos_pw = generate_pdos(case[\"pw_peaks\"])\n        pdos_loc_unshifted = generate_pdos(case[\"pw_peaks\"], case[\"loc_multipliers\"])\n\n        pdos_loc = {}\n        if case[\"loc_shift\"] != 0.0:\n            loc_energy_grid = energy_grid - case[\"loc_shift\"]\n            for ch in CHANNELS:\n                pdos_loc[ch] = np.interp(energy_grid, loc_energy_grid, pdos_loc_unshifted[ch], left=0, right=0)\n        else:\n            pdos_loc = pdos_loc_unshifted\n\n        tdos_pw = sum(pdos_pw.values())\n        tdos_loc = sum(pdos_loc.values())\n\n        # 2. Energy Alignment\n        errors = []\n        for delta in delta_scan_grid:\n            shifted_grid = energy_grid - delta\n            tdos_loc_interp = np.interp(energy_grid, shifted_grid, tdos_loc, left=0, right=0)\n            \n            numerator = np.dot(tdos_pw, tdos_loc_interp)\n            denominator = np.dot(tdos_loc_interp, tdos_loc_interp)\n            \n            s_tot = numerator / (denominator + EPSILON)\n            error = np.sum((tdos_pw - s_tot * tdos_loc_interp) ** 2)\n            errors.append(error)\n        \n        delta_star = delta_scan_grid[np.argmin(errors)]\n\n        # 3.  4. Per-channel scaling and discrepancy\n        nrmsd_vals = {}\n        R_vals = {}\n        residuals = {}\n        \n        final_loc_pdos_scaled = {}\n        for ch in CHANNELS:\n            loc_shifted_grid = energy_grid - delta_star\n            pdos_loc_interp = np.interp(energy_grid, loc_shifted_grid, pdos_loc[ch], left=0, right=0)\n            \n            num_s = np.dot(pdos_pw[ch], pdos_loc_interp)\n            den_s = np.dot(pdos_loc_interp, pdos_loc_interp)\n            s_alpha = num_s / (den_s + EPSILON)\n            \n            final_loc_pdos_scaled[ch] = s_alpha * pdos_loc_interp\n            \n            # Discrepancy function\n            delta_p_alpha = pdos_pw[ch] - final_loc_pdos_scaled[ch]\n            residuals[ch] = delta_p_alpha\n            \n            # NRMSD\n            num_nrmsd = np.sum(delta_p_alpha ** 2)\n            den_nrmsd = np.sum(pdos_pw[ch] ** 2)\n            nrmsd_vals[ch] = np.sqrt(num_nrmsd / (den_nrmsd + EPSILON))\n\n        # 5. Bonding analysis\n        # Peak detection\n        peak_indices = []\n        max_tdos_pw = np.max(tdos_pw)\n        if max_tdos_pw > EPSILON:\n            for i in range(1, len(tdos_pw) - 1):\n                if (tdos_pw[i] > tdos_pw[i - 1] and tdos_pw[i] > tdos_pw[i + 1] and\n                        tdos_pw[i] > THETA_PEAK * max_tdos_pw):\n                    peak_indices.append(i)\n\n        # Window creation and merging\n        if peak_indices:\n            intervals = sorted([(energy_grid[i] - W_PEAK, energy_grid[i] + W_PEAK) for i in peak_indices])\n            merged = [intervals[0]]\n            for start, end in intervals[1:]:\n                last_end = merged[-1][1]\n                if start = last_end:\n                    merged[-1] = (merged[-1][0], max(last_end, end))\n                else:\n                    merged.append((start, end))\n            \n            window_mask = np.zeros_like(energy_grid, dtype=bool)\n            for start, end in merged:\n                window_mask |= (energy_grid >= start)  (energy_grid = end)\n        else:\n            window_mask = np.zeros_like(energy_grid, dtype=bool)\n\n        # Calculate R_alpha\n        for ch in CHANNELS:\n            if np.any(window_mask):\n                num_R = np.sum(np.maximum(residuals[ch][window_mask], 0))\n                den_R = np.sum(pdos_pw[ch][window_mask])\n                R_vals[ch] = num_R / (den_R + EPSILON)\n            else:\n                R_vals[ch] = 0.0\n\n        # 6. Decision rule\n        missing_flags = {}\n        for ch in CHANNELS:\n            r_alpha = R_vals[ch]\n            max_r_beta = 0.0\n            for other_ch in CHANNELS:\n                if other_ch != ch:\n                    max_r_beta = max(max_r_beta, R_vals[other_ch])\n            \n            if r_alpha > TAU and r_alpha >= max_r_beta + DELTA_MISSING:\n                missing_flags[ch] = 1\n            else:\n                missing_flags[ch] = 0\n        \n        # Format results for this case\n        case_result = [\n            round(nrmsd_vals['s'], 4), round(nrmsd_vals['p'], 4), round(nrmsd_vals['d'], 4),\n            missing_flags['s'], missing_flags['p'], missing_flags['d']\n        ]\n        results.append(case_result)\n\n    # Final output format\n    result_str = \",\".join([str(r) for r in results])\n    result_str = result_str.replace(\" \", \"\").replace(\"'\", \"\")\n    print(result_str)\n\nsolve()\n```", "id": "3443589"}]}