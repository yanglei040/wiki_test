## 引言
在[计算材料科学](@entry_id:145245)领域，准确预测材料的电子结构是理解其物理和化学性质的基石。标准[密度泛函理论](@entry_id:139027)（DFT）及其常见的近似（如LDA和GGA）在描述简单金属和[半导体](@entry_id:141536)方面取得了巨大成功。然而，当面对含有局域化d或f电子的[强关联材料](@entry_id:198946)（如过渡金属氧化物和稀土化合物）时，这些方法往往会遭遇瓶颈。其固有的[自相互作用误差](@entry_id:139981)会导致对电子局域化行为的错误描述，从而严重低估[带隙](@entry_id:191975)，甚至错误地将绝缘体预测为金属。这一根本性的知识鸿沟限制了我们对众多功能材料的理论预测和设计能力。

为了解决这一难题，[DFT+U方法](@entry_id:748357)应运而生。它通过在标准[DFT泛函](@entry_id:182582)中引入一个显式的在位[库仑相互作用](@entry_id:747947)（Hubbard U）修正项，有效地弥补了上述缺陷。本文旨在系统地介绍[DFT+U](@entry_id:142114)这一强大的计算工具。读者将通过本文学习到：

在 **原理与机制** 章节中，我们将深入剖析[自相互作用误差](@entry_id:139981)的根源，并阐明[DFT+U](@entry_id:142114)是如何通过不同的数学形式（如Dudarev和Liechtenstein形式）来修正这一误差的，同时探讨双重计算、投影算符选择等关键技术细节。接着，在 **应用与跨学科联系** 章节中，我们将通过丰富的实例，展示[DFT+U](@entry_id:142114)如何在预测材料的电子、磁学、热力学性质，以及理解[极化子](@entry_id:191083)、[相变](@entry_id:147324)等复杂现象中发挥关键作用。最后，通过 **动手实践** 环节，读者将有机会将理论知识应用于具体的计算问题，学习如何从第一性原理计算[U值](@entry_id:151629)以及如何通[过拟合](@entry_id:139093)实验来[校准模型](@entry_id:180554)。

## 原理与机制

在“引言”章节中，我们已经了解了在处理含局域化 $d$ 或 $f$ 电子的[强关联材料](@entry_id:198946)时，标准[密度泛函理论](@entry_id:139027)（DFT）近似（如[局域密度近似LDA](@entry_id:182197)和[广义梯度近似GGA](@entry_id:191155)）所面临的挑战。本章节将深入探讨这些挑战背后的基本原理，并系统地阐述作为一种重要修正方案的[DFT+U方法](@entry_id:748357)的内在机制。我们将从问题的根源——自相互作用误差——出发，逐步建立起对[DFT+U方法](@entry_id:748357)从理论构建到实际应用的全面理解。

### 密度泛函理论的局限性：[自相互作用误差](@entry_id:139981)

在精确的[电子结构理论](@entry_id:172375)中，一个电子不应与自身发生相互作用。然而，在大多数近似的[DFT泛函](@entry_id:182582)中，这种理想情况并未实现。问题的核心在于[Hartree能量](@entry_id:167303) $E_{\mathrm{H}}[n]$ 和[交换相关能](@entry_id:138029)量 $E_{\mathrm{xc}}[n]$ 的近似处理。[Hartree能量](@entry_id:167303)，作为电子密度的经典静电排斥能，其形式为：
$$
E_{\mathrm{H}}[n] = \frac{1}{2} \int \int \frac{n(\mathbf{r}) n(\mathbf{r}')}{|\mathbf{r} - \mathbf{r}'|} \, d\mathbf{r} \, d\mathbf{r}'
$$
对于一个单电子体系，其密度为 $n_1(\mathbf{r})$，上式计算的是该电子密度[分布](@entry_id:182848)与自身的[静电排斥](@entry_id:162128)能，这显然是虚假的。在精确理论中，这一虚假的自排斥能必须被交换能量项完全抵消。例如，在[Hartree-Fock理论](@entry_id:160358)中，由于其交换项的非局域性，对于任意单电子体系，[交换能](@entry_id:137069)恰好等于负的[Hartree能量](@entry_id:167303)，从而完美地消除了[自相互作用](@entry_id:201333)。

然而，LDA和GGA等（半）局域泛函的[交换相关能](@entry_id:138029)量是在某一点 $\mathbf{r}$ 处，仅由该点的电子密度 $n(\mathbf{r})$ (以及可能的梯度 $\nabla n(\mathbf{r})$) 决定的。这种局域的近似形式无法完全抵消非局域的Hartree自相互作用。其结果是，对于一个单电子体系，[Hartree能量](@entry_id:167303)与近似[交换相关能](@entry_id:138029)量之和不为零，留下了一个虚假的正值残[余能](@entry_id:192009)量。这个残余能量就是所谓的 **[自相互作用误差](@entry_id:139981) (Self-Interaction Error, SIE)** [@problem_id:3457081]。

对于具有强局域化 $d$ 或 $f$ 电子的体系，自相互作用误差的影响尤为严重。这是因为这些电子的[波函数](@entry_id:147440)被高度束缚在原子周围一个很小的空间区域内。这种高度局域化导致电子密度 $n(\mathbf{r})$ 很大，从而使得Hartree自排斥能 $E_{\mathrm{H}}[n]$ 异常巨大。由于（半）局域泛函对这一巨大自排斥能的抵消非常不完全，最终产生的自相互作用误差也相应地被放大了 [@problem_id:3457081]。

[自相互作用误差](@entry_id:139981)的一个更深层次的后果体现在总能量 $E$ 作为电子数 $N$ 的函数的行为上。根据量子力学基本原理，对于一个给定的多电子体系，其[基态能量](@entry_id:263704) $E(N)$ 在整数电子数之间应呈 **[分段线性](@entry_id:201467)** 行为。在每个整数 $N$ 处，能量对电子数的导数 $\partial E/\partial N$ 会发生跳变，这个跳变的大小等于体系的基本[带隙](@entry_id:191975)。这个导数的[不连续性](@entry_id:144108)，即 **[导数不连续性](@entry_id:136336) (derivative discontinuity)**，是产生[能隙](@entry_id:191975)的物理根源。

然而，由于[自相互作用误差](@entry_id:139981)的存在，（半）局域泛函计算出的总能量 $E(N)$ 在整数之间不再是线性的，而是呈现出一种病态的 **凸性 (convexity)**。这种[凸函数](@entry_id:143075)行为意味着，一个具有分数电子占据的体系（例如，一个电子“涂抹”在多个原子位点上）的能量，会低于对应整数占据态的统计[平均能量](@entry_id:145892)。这从能量上错误地偏爱了电子的 **[离域](@entry_id:183327) (delocalization)** 和分数占据。对于像Mott绝缘体这样电子本应局域在特定原子位点上的材料，这种人为的离域效应会破坏[库仑相互作用](@entry_id:747947)驱动的局域化[基态](@entry_id:150928)，从而错误地预测其为金属性，或者严重低估其[带隙](@entry_id:191975) [@problem_id:3457108]。这正是[DFT+U方法](@entry_id:748357)所要解决的核心问题。

### [DFT+U](@entry_id:142114) 方法：一个旨在修正错误的局域化势

[DFT+U方法](@entry_id:748357)通过在标准的DFT总能量泛函上引入一个额外的、依赖于[轨道](@entry_id:137151)的势——即Hubbard $U$ 修正项——来直接处理[自相互作用误差](@entry_id:139981)问题。这个修正项专门作用于选定的局域化[轨道](@entry_id:137151)[子空间](@entry_id:150286)（如过渡金属的 $d$ [轨道](@entry_id:137151)或[稀土元素](@entry_id:150323)的 $f$ [轨道](@entry_id:137151)）。

其核心思想是引入一个类似于Hubbard模型中的[在位库仑排斥](@entry_id:269911)的能量惩罚项。这个惩罚项的设计目标是：对于分数占据的[轨道](@entry_id:137151)态，施加一个能量惩罚，而对于整数占据（即[轨道](@entry_id:137151)被完全占据或完全空着）的态，不施加或施加较小的惩罚。通过这种方式，[DFT+U](@entry_id:142114)有效地抵消了（半）局域泛函中由自相互作用误差引起的虚假能量增益，从而抑制了电子的人为[离域](@entry_id:183327)。

从总能量 $E(N)$ 的角度看，这个惩罚项的作用是校正能量[曲线的曲率](@entry_id:267366)。标准的GGA/LDA给出的能量曲线是凸的，而Hubbard修正项本身通常是一个关于占据数的[凹函数](@entry_id:274100)。将两者相加，$E_{\text{DFT+U}} = E_{\text{GGA/LDA}} + E_{U}$，可以在很大程度上恢[复能量](@entry_id:263929) $E(N)$ 的分段线性行为。一旦能量曲线趋于分段线性，分数占据态就不再是能量上有利的，体系会自发地选择电子局域化的整数占据[基态](@entry_id:150928)。这种局域化的恢复同时重新引入了[能量导数](@entry_id:170468)在整数占据数附近的[不连续性](@entry_id:144108)，从而打开了Mott-Hubbard[能隙](@entry_id:191975)，使得对强[关联绝缘体](@entry_id:139618)的描述成为可能 [@problem_id:3457081] [@problem_id:3457108]。

### Hubbard U 修正的具体形式

为了施加这种依赖于[轨道](@entry_id:137151)占据的修正，我们需要一个量来描述关联[子空间](@entry_id:150286)的状态。这个量就是 **在位占据数矩阵 (on-site occupation matrix)** $n_{mm'}^{I\sigma}$，其定义为在原子位点 $I$ 上，自旋为 $\sigma$ 的局域化[轨道](@entry_id:137151)[基矢](@entry_id:199546) $\{|\phi_m^I\rangle\}$ 之间的密度矩阵元。该矩阵的对角元 $n_{mm}^{I\sigma}$ 表示[轨道](@entry_id:137151) $m$ 的电子占据数，而非对角元则描述了不同[轨道](@entry_id:137151)间的[量子相干性](@entry_id:143031)。[DFT+U](@entry_id:142114)的[能量修正](@entry_id:198270)项 $E_U$ 就是这个占据数矩阵的函数。目前主要有两种流行的[DFT+U](@entry_id:142114)能量形式。

#### 简化的 Dudarev 形式

Dudarev等人提出的形式是一种简化且保持[旋转不变性](@entry_id:137644)的方法，它在计算中非常高效和常用。其能量表达式为：
$$
E_{U} = \frac{U_{\mathrm{eff}}}{2} \sum_{I, \sigma} \mathrm{Tr}\left[n^{I\sigma}(1 - n^{I\sigma})\right]
$$
这里，$I$ 是原子位点，$\sigma$ 是自旋，$\mathrm{Tr}$ 表示对局域化[轨道](@entry_id:137151)指标求迹。$n^{I\sigma}$ 是位点 $I$、自旋 $\sigma$ 的占据数矩阵。这个表达式的核心特征是它只依赖于一个参数 $U_{\mathrm{eff}} = U - J$，其中 $U$ 是平均在位库仑相互作用，$J$ 是平均在位交换相互作用。

这个形式的物理意义非常清晰。矩阵 $n^{I\sigma}$ 的[本征值](@entry_id:154894)代表了在该自旋通道下，各个自然[轨道](@entry_id:137151)的占据数。如果所有[轨道](@entry_id:137151)都是整数占据（[本征值](@entry_id:154894)为0或1），那么矩阵 $n^{I\sigma}$ 就是一个投影算符，满足 $n^{I\sigma} = (n^{I\sigma})^2$。在这种情况下，$n^{I\sigma}(1 - n^{I\sigma}) = 0$，[能量修正](@entry_id:198270)项为零。而当出现分数占据时（[本征值](@entry_id:154894)介于0和1之间），$n^{I\sigma}(1 - n^{I\sigma})$ 的迹为正，从而施加一个能量惩罚。这个惩罚项的大小正比于 $U_{\mathrm{eff}}$。因此，该形式直接实现了惩罚分数占据、鼓励电子局域化的目的 [@problem_id:3457193]。

为了理解这一[能量修正](@entry_id:198270)如何影响[电子结构](@entry_id:145158)，我们可以推导它所产生的[有效势](@entry_id:142581)。Hubbard势矩阵 $V^{I\sigma}$ 是能量 $E_U$ 对占据数矩阵 $n^{I\sigma}$ 的泛函导数：
$$
V^{I\sigma} = \frac{\partial E_{U}}{\partial n^{I\sigma}} = U_{\mathrm{eff}} \left( \frac{1}{2} I - n^{I\sigma} \right)
$$
其中 $I$ 是[单位矩阵](@entry_id:156724)。这个势被加到DFT的Kohn-Sham[哈密顿量](@entry_id:172864)中。现在考虑一个特殊情况：只有一个局域化[轨道](@entry_id:137151)被部分占据，占据数为 $n$（$0  n  1$）。那么，这个势对该[轨道](@entry_id:137151)单粒子能级的修正（即[能级移动](@entry_id:156631)）为 [@problem_id:3457141]：
$$
\Delta \epsilon = U_{\mathrm{eff}} \left(\frac{1}{2} - n\right)
$$
从这个简单的表达式可以看出，对于一个接近占据的态（$n \to 1$），[能级移动](@entry_id:156631) $\Delta \epsilon \to -U_{\mathrm{eff}}/2$，即能级被向下拉低。而对于一个接近空的态（$n \to 0$），[能级移动](@entry_id:156631) $\Delta \epsilon \to +U_{\mathrm{eff}}/2$，即能级被向上推高。正是这种对占据态和空态截然相反的作用，有效地在[费米能级](@entry_id:143215)附近撕开了一个[能隙](@entry_id:191975)。

#### 普适的 Liechtenstein 形式

Dudarev形式虽然简洁，但它将所有的相互作用细节都压缩到了一个参数 $U_{\mathrm{eff}}$ 中，忽略了相互作用的各向异性。Liechtenstein等人提出的形式则更为普适和精确，它源于对在位库仑[相互作用[哈密顿](@entry_id:181720)量](@entry_id:172864)的[Hartree-Fock近似](@entry_id:146529)。其能量表达式涉及完整的四指数库仑张量 $U_{mm'm''m'''}$ 和交换张量 $J_{mm'm''m'''}$ [@problem_id:3457091]：
$$
E_{U} = \frac{1}{2}\sum_{I}\sum_{\sigma \sigma'}\sum_{m m' m'' m'''} \Big[ U_{m m' m'' m'''}\, n^{I \sigma}_{m m''}\, n^{I \sigma'}_{m' m'''} - \delta_{\sigma \sigma'}\, J_{m m' m'' m'''}\, n^{I \sigma}_{m m'''}\, n^{I \sigma}_{m' m''} \Big] - E_{\mathrm{dc}}
$$
这个表达式的结构要复杂得多，但包含了更丰富的物理。
1.  **直接项与交换项**：第一项是直接[库仑相互作用](@entry_id:747947)（Hartree项），它对所有自旋对 ($\sigma, \sigma'$) 都起作用。第二项是交换相互作用（Fock项），由于[泡利不相容原理](@entry_id:141850)，它只存在于自旋相同的电子之间，由 $\delta_{\sigma \sigma'}$ 体现。
2.  **[旋转不变性](@entry_id:137644)**：尽管形式复杂，但张量与占据数矩阵的这种特殊缩并方式保证了总能量在关联[子空间](@entry_id:150286)的[轨道](@entry_id:137151)[基矢](@entry_id:199546)选择（[酉变换](@entry_id:152599)）下保持不变，即 **[旋转不变性](@entry_id:137644)**。
3.  **各向异性**：该形式通过完整的张量 $U$ 和 $J$ 描述了相互作用的各向异性。这些张量元素的值取决于[轨道](@entry_id:137151)的形状和相对朝向，而不仅仅是一个平均值。例如，在[球谐函数](@entry_id:178380)基底下，这些张量可以由少数几个[Slater积分](@entry_id:182201) $F^k$ 参数化。

#### 不同形式的比较：何时需要考虑 $J$？

选择Dudarev的 $U_{\mathrm{eff}}$ 形式还是Liechtenstein的 $(U,J)$ 形式，取决于所研究体系的物理性质。
- **$U_{\mathrm{eff}}$ 形式** (如Dudarev方法) 实质上只考虑了相互作用中球对称的密度-密度部分。它对于描述没有[轨道极化](@entry_id:148886)（即同一子壳层内的不同[轨道](@entry_id:137151)占据数相等）的高对称性、共线磁性体系通常是足够好的。在这些情况下，各向异性效应平均为零，两种方法会给出相似的结果 [@problem_id:3457092]。

- **$(U,J)$ 形式** (如Liechtenstein方法) 则在以下情况中至关重要：
    1.  **[轨道有序](@entry_id:140046)/极化**：当体系中出现Jahn-Teller畸变等效应，导致不同 $d$ [轨道](@entry_id:137151)（如 $t_{2g}$ 和 $e_g$ 中的[轨道](@entry_id:137151)）的占据数不相等时，就出现了[电荷密度](@entry_id:144672)的各向异性[分布](@entry_id:182848)。此时，能量不仅依赖于总占据数，还依赖于电子具体占据了哪个[轨道](@entry_id:137151)。这种依赖性是由相互作用的[多极矩](@entry_id:191120)部分（由 $J$ [参数化](@entry_id:272587)）所决定的。只有 $(U,J)$ 形式能够正确描述不同[轨道](@entry_id:137151)序的能量差异 [@problem_id:3457092]。
    2.  **多重态分裂**：要精确计算原子或离子的[光谱项](@entry_id:175979)（多重态），必须考虑Hund氏规则，而Hund氏第二和第三规则的能量效应是由[交换相互作用](@entry_id:140006)的各向异性部分主导的，这需要一个显式的 $J$。
    3.  **[非共线磁性](@entry_id:181233)与自旋-轨道耦合**：在处理[非共线磁性](@entry_id:181233)结构或包含强[自旋-轨道耦合](@entry_id:143520)（SOC）的体系时，自旋不再是一个好的量子数，占据数矩阵会出现自旋非对角元 ($n^{\uparrow\downarrow}_{mm'} \neq 0$)。Liechtenstein形式可以自然地处理这种情况，而 $U_{\mathrm{eff}}$ 形式则无法描述这些效应。

总之，参数 $J$ 并非可有可无，它承载了超越简单[电荷](@entry_id:275494)排斥的关键[物理信息](@entry_id:152556)，即Hund氏交换能和相互作用的各向异性。

### [DFT+U](@entry_id:142114) 实现中的关键细节

在实际应用[DFT+U方法](@entry_id:748357)时，还有两个重要的技术细节需要仔细考虑：双重计算问题和关联[子空间](@entry_id:150286)的定义。

#### 双重计算问题

在将Hubbard修正项 $E_U$ 加到DFT总能量中时，我们必须意识到，底层的LDA/[GGA泛函](@entry_id:190164)本身已经以一种平均的、近似的方式包含了电子间的相互作用，其中也包括了对在位相互作用的某种描述。如果我们直接加上 $E_U$，就相当于把这部分相互作用计算了两次。为了避免这种情况，必须从 $E_U$ 中减去一个 **双重计算 (double-counting)** 项 $E_{\mathrm{dc}}$。这个减去的部分，理论上应该等于[LDA](@entry_id:138982)/[GGA泛函](@entry_id:190164)中已经包含的在位相互作用的平均值。

由于我们无法精确知道[LDA](@entry_id:138982)/GGA到底包含了多少在位相互作用，因此双重计算项没有唯一的、精确的表达式，需要采用某种近似形式。两种最常见的形式是 **[全局域](@entry_id:196542)化极限 (Fully Localized Limit, FLL)** 和 **平均场环绕 (Around Mean Field, AMF)**。

对于一个包含 $N_d$ 个电子的 $d$ 壳层，其自旋分解为 $N_{d\uparrow}$ 和 $N_{d\downarrow}$，两种双重计算能量的形式为 [@problem_id:3457099]：
$$
E_{\mathrm{dc}}^{\mathrm{FLL}} = \frac{U}{2}N_d(N_d - 1) - \frac{J}{2}\sum_{\sigma} N_{d\sigma}(N_{d\sigma} - 1)
$$
$$
E_{\mathrm{dc}}^{\mathrm{AMF}} = \frac{U}{2}N_d^{2} - \frac{J}{2}\sum_{\sigma} N_{d\sigma}^{2}
$$
这两种形式的物理图像不同：FLL假设[关联电子](@entry_id:138307)处于一个由整数占据[轨道](@entry_id:137151)构成的原子[极限状态](@entry_id:756280)，而AMF则假设[关联电子](@entry_id:138307)处于一个所有[轨道](@entry_id:137151)均被平均占据的金属态。

尽管表达式不同，我们可以推导它们产生的双重计算势 $V_{\mathrm{dc}}^\sigma = \partial E_{\mathrm{dc}} / \partial N_{d\sigma}$ 的差异。令人惊讶的是，这个差异是一个与占据数无关的常数 [@problem_id:3457099]：
$$
\Delta V_{\mathrm{dc}}^{\sigma} = V_{\mathrm{dc}}^{\sigma}(\mathrm{FLL}) - V_{\mathrm{dc}}^{\sigma}(\mathrm{AMF}) = \frac{J - U}{2}
$$
由于总的[有效势](@entry_id:142581)是 $V_{\text{eff}} = V_U - V_{\mathrm{dc}}$，这意味着FLL方法施加的净[排斥势](@entry_id:185622)比AMF方法高出一个常数 $\frac{1}{2}(U-J)$。因为通常 $U  J$，这个差值是正的。因此，在 $U$ 和 $J$ 参数相同的情况下，FLL方法会施加更强的排斥作用，从而更倾向于稳定绝缘相。在选择双重计算方案时，需要考虑到这种系统性的差异。

#### 定义关联[子空间](@entry_id:150286)：投影算符的选择

[DFT+U方法](@entry_id:748357)的核心是作用在一个特定的“关联[子空间](@entry_id:150286)”上，这个[子空间](@entry_id:150286)由一组局域化的 **[投影算符](@entry_id:154142) (projectors)** $\{|\phi_m\rangle\}$ 定义。占据数矩阵正是通过将Kohn-Sham[密度算符](@entry_id:138151)投影到这个[子空间](@entry_id:150286)上得到的：
$$
n_{m'm} = \sum_{i} f_{i} \langle m' | \psi_i \rangle \langle \psi_i | m \rangle
$$
其中 $\{|\psi_i\rangle\}$ 是Kohn-Sham[本征态](@entry_id:149904)，$f_i$ 是其占据数。因此，[投影算符](@entry_id:154142)的选择直接决定了我们所修正的“[关联电子](@entry_id:138307)”究竟是什么，这反过来会影响计算出的占据数矩阵以及 $U$ 值本身。

在实践中，两种常见的投影算符选择是 [@problem_id:3457168]：
1.  **类[原子轨道](@entry_id:140819) (Atomic-like partial waves)**：这些投影算符是在目标原子（如过渡金属）中心定义的、具有特定角动量（如 $d$ 对称性）的类原子函数。它们通常被严格限制在一个[截断半径](@entry_id:136708)（如增广球半径）之内。这种方法的优点是定义清晰、计算简单。但其缺点也很明显：在[共价性](@entry_id:154718)较强的材料中，实际的 $d$ 电子[波函数](@entry_id:147440)会与邻近的[配体](@entry_id:146449)原子（如氧）的[轨道](@entry_id:137151)发生杂化，形成延展的成键和反键态。类原子[投影算符](@entry_id:154142)只捕捉了这些[杂化轨道](@entry_id:260757)在金属原子内部的分量，忽略了其在[配体](@entry_id:146449)上的“尾巴”。这导致投影不完备，计算出的占据数 $n_{mm}$ 通常偏小。同时，由于类原子轨道本身是高度局域的，用它们计算出的裸[库仑积分](@entry_id:275345) $U$ 值会相对较大。

2.  **最大局域化Wannier函数 (Maximally Localized Wannier Functions, MLWFs)**：这种方法首先识别出[能带结构](@entry_id:139379)中具有目标[轨道](@entry_id:137151)特征（如 $d$ 特征）的能带集，然后通过一个[酉变换](@entry_id:152599)将这些[布洛赫态](@entry_id:147552)转换为一组在实空间中尽可能局域的Wannier函数。这些MLWFs构成了所选能带[子空间](@entry_id:150286)的一组完备正交基。因为它们是从杂化的[布洛赫态](@entry_id:147552)构建的，所以MLWFs能够正确地包含金属 $d$ [轨道](@entry_id:137151)与[配体](@entry_id:146449) $p$ [轨道杂化](@entry_id:140298)的信息，自然地带有延伸到[配体](@entry_id:146449)原子上的尾巴。因此，用MLWFs作为[投影算符](@entry_id:154142)可以得到更准确的占据数。然而，由于MLWFs比截断的类原子轨道在空间上更延展，用它们计算出的裸[库仑积分](@entry_id:275345) $U$ 值会相对较小。

一个更根本的区别在于，类原子轨道和MLWFs定义的关联[子空间](@entry_id:150286)是不同的。因此，投影到这两个不同[子空间](@entry_id:150286)上的占据数矩阵，其[本征值](@entry_id:154894)（自然占据数）也可能不同，它们之间并非简单的[基矢](@entry_id:199546)旋转关系 [@problem_id:3457168]。选择哪种[投影算符](@entry_id:154142)是一个需要仔细权衡的决定，它影响着[DFT+U](@entry_id:142114)计算的[自洽性](@entry_id:160889)和最终结果的物理解释。

### Hubbard 参数的第一性原理计算

到目前为止，我们都将 $U$ 和 $J$ 视为给定的参数。在早期研究中，它们常被当作经验参数来拟合实验结果。然而，为了使[DFT+U](@entry_id:142114)成为一个真正具有预测能力的[第一性原理方法](@entry_id:268553)，我们需要不依赖于实验的、从头计算这些参数的方法。

#### [线性响应方法](@entry_id:751324)

由Cococcioni和de Gironcoli等人发展的 **[线性响应方法](@entry_id:751324) (linear response approach)** 是一种广泛应用的计算静态 $U$ 值的方案。其核心思想是，在位库仑相互作用 $U$ 是将一个电子添加到局域化[轨道](@entry_id:137151)上所引起的该[轨道](@entry_id:137151)自身势能的变化。

在计算上，该方法通过向体系施加一个微扰势 $\alpha_I$，该势只作用于位点 $I$ 的关联[子空间](@entry_id:150286)，然后计算该[子空间](@entry_id:150286)占据数 $n_I$ 的响应。通过这个过程可以定义两个[响应函数](@entry_id:142629)矩阵：
- **裸响应函数 $\chi_0$**：它描述了无相互作用的Kohn-Sham体系对势的响应，即在计算响应时，保持Hartree和[交换相关势](@entry_id:180254)不变。其矩阵元为 $\chi_{0,IJ} = (\partial n_I / \partial \alpha_J)_{\text{KS}}$。
- **屏蔽响应函数 $\chi$**：它描述了真实的、完全自洽的体系对外部微扰的响应，包含了所有电子（包括关联[子空间](@entry_id:150286)内和[子空间](@entry_id:150286)外的电子）的屏蔽效应。其[矩阵元](@entry_id:186505)为 $\chi_{IJ} = \partial n_I / \partial \alpha_J$。

可以证明，有效的在位相互作用矩阵 $U$（对于多位点体系，它是一个矩阵）与这两个[响应函数](@entry_id:142629)之间存在一个类似[戴森方程](@entry_id:146246)的关系 [@problem_id:3457207]：
$$
U = \chi_0^{-1} - \chi^{-1}
$$
这个表达式的物理意义是，相互作用 $U$ 是“裸”的Kohn-Sham体系的[逆响应](@entry_id:274510)与完全“屏蔽”后的体系的[逆响应](@entry_id:274510)之差。这个差值恰好量化了由关联[子空间](@entry_id:150286)自身[电荷](@entry_id:275494)变化所引起的、未被体系其余部分屏蔽掉的相互作用。

#### 受限[随机相位近似](@entry_id:754035) (cRPA)

[线性响应方法](@entry_id:751324)计算的是一个静态的（零频率）$U$ 值。一个更先进的方法是 **受限[随机相位近似](@entry_id:754035) (constrained Random Phase Approximation, cRPA)**，它可以计算出频率依赖的有效相互作用 $U(\omega)$。

该方法的基础是RPA理论，它将屏蔽效应描述为由[电子-空穴对](@entry_id:142506)激发（即极化）引起的。总的不可约[极化函数](@entry_id:265572) $P(\omega)$ 描述了体系中所有可能的电子-空穴激发。cRPA的核心思想是，在构建用于低能有效模型（如Hubbard模型或[DFT+U](@entry_id:142114)）的参数 $U$ 时，必须避免 **双重计算** 关联效应。这意味着，那些完全发生在关联[子空间](@entry_id:150286)内部的激发过程（其极化贡献记为 $P^d(\omega)$）所带来的屏蔽效应，不应该包含在 $U$ 参数中，因为这些过程将在求解低能模型时被显式处理。

因此，cRPA通过一个“受限”的计算过程来获得 $U(\omega)$：它只包含那些发生在关联[子空间](@entry_id:150286)之外的、或者一端在[子空间](@entry_id:150286)内一端在[子空间](@entry_id:150286)外的激发过程所带来的[屏蔽效应](@entry_id:136974)。这些过程的极化贡献被统一记为[剩余极化](@entry_id:160843) $P^r(\omega) = P(\omega) - P^d(\omega)$。

在RPA框架下，有效相互作用 $U(\omega)$ 就是由裸[库仑相互作用](@entry_id:747947) $v$ 被这个[剩余极化](@entry_id:160843) $P^r(\omega)$ 所屏蔽的结果。其表达式为 [@problem_id:3457126]：
$$
U(\omega) = [1 - v P^r(\omega)]^{-1} v
$$
或者等价地，以逆形式写出，更为直观：
$$
U^{-1}(\omega) = v^{-1} - P^r(\omega)
$$
这个公式清晰地表明，有效的相互作用 $U(\omega)$ 是通过从裸相互作用的逆 $v^{-1}$ 中减去一部分屏蔽（$P^r$），但不是全部屏蔽（$P$），得到的。在[DFT+U](@entry_id:142114)计算中，通常使用cRPA计算的[静态极限](@entry_id:262480)值 $U(\omega=0)$ 作为Hubbard参数。cRPA为从第一性原理出发、系统地确定[DFT+U](@entry_id:142114)等方法的参数提供了坚实的理论基础。