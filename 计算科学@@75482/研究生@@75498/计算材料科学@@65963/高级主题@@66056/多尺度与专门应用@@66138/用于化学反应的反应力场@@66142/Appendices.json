{"hands_on_practices": [{"introduction": "本练习将聚焦于许多反应力场的数学核心：电荷平衡（QEq）方法。我们将通过实践来解决决定原子部分电荷的线性方程组，该方程组基于电负性均衡原理。通过这个过程，我们将看到不同的电荷模型（如ACKS2和传统QEq）如何对体系能量和偶极矩等物理量产生不同的预测，从而揭示动态电荷分配的具体实现方式。[@problem_id:3485008]", "problem": "一名研究人员正在研究电荷平衡模型对反应力场中锂金属界面处电解质分解反应的能量学和静电学的影响，具体模型为原子凝聚科恩-沈密度泛函理论二阶近似（ACKS2）和电荷平衡（QEq）。其基础是电负性均衡原理，该原理通过二次型对构型的电荷依赖能量进行建模，而平衡电荷是通过在满足电荷守恒的条件下最小化该能量得到的。给定构型的二次能量写作 $E(\\mathbf{q}) = \\frac{1}{2} \\mathbf{q}^{\\mathsf{T}} \\mathbf{A} \\mathbf{q} - \\mathbf{b}^{\\mathsf{T}} \\mathbf{q}$，其中 $\\mathbf{A}$ 是对称正定的硬度和相互作用矩阵，$\\mathbf{b}$ 是电负性向量。电荷守恒通过 $\\sum_{i=1}^{N} q_i = Q_{\\mathrm{total}}$ 强制执行。最终的平衡电荷通过求解增广线性系统得到\n$$\n\\begin{bmatrix}\n\\mathbf{A}  \\mathbf{1} \\\\\n\\mathbf{1}^{\\mathsf{T}}  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{q} \\\\ \\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\mathbf{b} \\\\ Q_{\\mathrm{total}}\n\\end{bmatrix},\n$$\n其中 $\\mathbf{1}$ 是所有分量均为 $1$ 的长度为 $N$ 的向量，$\\lambda$ 是拉格朗日乘子。离散为多个状态的反应路径的能垒定义为 $\\max_k E_k - E_{\\mathrm{IS}}$，其中 $E_k$ 表示状态 $k$ 的能量，$\\mathrm{IS}$ 是初始态。偶极矩矢量定义为 $\\boldsymbol{\\mu} = \\sum_{i=1}^{N} q_i \\mathbf{r}_i$，单位为电子-埃（$\\mathrm{e\\AA}$），其大小使用 $1\\,\\mathrm{e\\AA} = 4.803204712\\,\\mathrm{D}$ 转换为德拜（Debye）。\n\n您的任务是实现一个程序，对每个测试用例和两种模型，通过求解增广系统计算每个状态下的平衡电荷 $\\mathbf{q}$，评估以电子伏特（eV）为单位的二次能量 $E(\\mathbf{q})$，计算以 eV 为单位的反应能垒，并计算以德拜为单位的过渡态偶极矩大小。然后，对于每个测试用例，您必须输出 QEq 和 ACKS2 反应能垒之差（$\\Delta E_{\\mathrm{barrier}} = E_{\\mathrm{barrier}}^{\\mathrm{QEq}} - E_{\\mathrm{barrier}}^{\\mathrm{ACKS2}}$）以及 QEq 和 ACKS2 过渡态偶极矩大小之差（$\\Delta \\mu_{\\mathrm{TS}} = \\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}}^{\\mathrm{QEq}} \\rVert - \\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}}^{\\mathrm{ACKS2}} \\rVert$）。所有能量必须以 $\\mathrm{eV}$ 表示，所有偶极矩大小必须以 $\\mathrm{D}$ 表示。\n\n使用以下反应路径测试套件。在每个案例中，$Q_{\\mathrm{total}}$ 已被指定，状态被给出为初始态（IS）、过渡态（TS）和最终态（FS）。对于每个状态，数据包括电荷平衡（QEq）和原子凝聚科恩-沈密度泛函理论二阶近似（ACKS2）的 $\\mathbf{A}$ 和 $\\mathbf{b}$，以及该状态下所有原子的原子位置 $\\{\\mathbf{r}_i\\}$（以埃为单位的笛卡尔坐标）。原子数量为 $N$。\n\n测试用例 1（锂金属附近的电解质碎片，$N = 4$，$Q_{\\mathrm{total}} = 0$）：\n- IS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n7.0  0.9  0.6  0.5\\\\\n0.9  7.2  0.7  0.6\\\\\n0.6  0.7  11.5  1.2\\\\\n0.5  0.6  1.2  8.8\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.0 \\\\ 1.1 \\\\ 6.2 \\\\ 4.8 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.6  0.8  0.5  0.4\\\\\n0.8  7.7  0.6  0.5\\\\\n0.5  0.6  12.1  1.1\\\\\n0.4  0.5  1.1  9.3\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 0.9 \\\\ 1.0 \\\\ 6.0 \\\\ 4.9 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}2.8\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}1.3\\\\0.8\\\\2.0\\end{bmatrix},\n\\begin{bmatrix}1.6\\\\-0.7\\\\2.4\\end{bmatrix}\n\\right\\}.\n$$\n- TS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n6.8  1.2  0.9  0.7\\\\\n1.2  7.1  1.0  0.8\\\\\n0.9  1.0  11.2  1.6\\\\\n0.7  0.8  1.6  8.6\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.2 \\\\ 1.2 \\\\ 6.6 \\\\ 4.7 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.4  1.0  0.8  0.6\\\\\n1.0  7.5  0.9  0.7\\\\\n0.8  0.9  12.0  1.4\\\\\n0.6  0.7  1.4  9.2\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 1.1 \\\\ 1.1 \\\\ 6.4 \\\\ 4.8 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}2.8\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}1.1\\\\0.4\\\\1.6\\end{bmatrix},\n\\begin{bmatrix}1.4\\\\-0.5\\\\2.0\\end{bmatrix}\n\\right\\}.\n$$\n- FS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n6.9  0.8  0.7  0.6\\\\\n0.8  7.0  0.7  0.6\\\\\n0.7  0.7  11.0  1.3\\\\\n0.6  0.6  1.3  8.5\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 6.3 \\\\ 4.9 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.5  0.7  0.6  0.5\\\\\n0.7  7.6  0.6  0.5\\\\\n0.6  0.6  12.0  1.2\\\\\n0.5  0.5  1.2  9.1\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 0.9 \\\\ 0.9 \\\\ 6.1 \\\\ 5.0 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}2.8\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}2.2\\\\0.2\\\\1.7\\end{bmatrix},\n\\begin{bmatrix}1.8\\\\-0.6\\\\2.6\\end{bmatrix}\n\\right\\}.\n$$\n\n测试用例 2（替代电解质路径，$N = 5$，$Q_{\\mathrm{total}} = 0$）：\n- IS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n7.0  0.8  0.5  0.4  0.3\\\\\n0.8  7.1  0.6  0.5  0.4\\\\\n0.5  0.6  12.2  1.2  1.0\\\\\n0.4  0.5  1.2  9.1  0.7\\\\\n0.3  0.4  1.0  0.7  14.5\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 6.0 \\\\ 5.0 \\\\ 7.0 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.6  0.7  0.4  0.3  0.2\\\\\n0.7  7.6  0.5  0.4  0.3\\\\\n0.4  0.5  12.6  1.0  0.9\\\\\n0.3  0.4  1.0  9.4  0.6\\\\\n0.2  0.3  0.9  0.6  14.8\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 0.9 \\\\ 0.9 \\\\ 5.8 \\\\ 5.2 \\\\ 6.8 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}3.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}1.5\\\\1.0\\\\2.5\\end{bmatrix},\n\\begin{bmatrix}1.7\\\\-0.8\\\\2.8\\end{bmatrix},\n\\begin{bmatrix}2.2\\\\0.5\\\\3.0\\end{bmatrix}\n\\right\\}.\n$$\n- TS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n6.9  1.0  0.7  0.6  0.5\\\\\n1.0  7.0  0.8  0.7  0.6\\\\\n0.7  0.8  11.9  1.5  1.1\\\\\n0.6  0.7  1.5  8.9  0.8\\\\\n0.5  0.6  1.1  0.8  14.2\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.2 \\\\ 1.2 \\\\ 6.2 \\\\ 4.9 \\\\ 6.9 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.5  0.9  0.6  0.5  0.4\\\\\n0.9  7.5  0.7  0.6  0.5\\\\\n0.6  0.7  12.5  1.3  1.0\\\\\n0.5  0.6  1.3  9.3  0.7\\\\\n0.4  0.5  1.0  0.7  14.6\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 1.1 \\\\ 1.1 \\\\ 6.1 \\\\ 5.0 \\\\ 6.7 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}3.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}1.3\\\\0.6\\\\2.0\\end{bmatrix},\n\\begin{bmatrix}1.5\\\\-0.6\\\\2.3\\end{bmatrix},\n\\begin{bmatrix}2.1\\\\0.4\\\\2.6\\end{bmatrix}\n\\right\\}.\n$$\n- FS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n6.8  0.9  0.6  0.5  0.4\\\\\n0.9  6.9  0.7  0.6  0.5\\\\\n0.6  0.7  11.7  1.3  1.0\\\\\n0.5  0.6  1.3  8.8  0.7\\\\\n0.4  0.5  1.0  0.7  14.0\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 6.1 \\\\ 5.1 \\\\ 6.8 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.4  0.8  0.5  0.4  0.3\\\\\n0.8  7.4  0.6  0.5  0.4\\\\\n0.5  0.6  12.4  1.1  0.9\\\\\n0.4  0.5  1.1  9.2  0.6\\\\\n0.3  0.4  0.9  0.6  14.4\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 0.9 \\\\ 0.9 \\\\ 5.9 \\\\ 5.2 \\\\ 6.6 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}3.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}2.4\\\\0.2\\\\1.8\\end{bmatrix},\n\\begin{bmatrix}1.9\\\\-0.7\\\\2.9\\end{bmatrix},\n\\begin{bmatrix}2.5\\\\0.6\\\\3.2\\end{bmatrix}\n\\right\\}.\n$$\n\n测试用例 3（弱相互作用的最小边界情况，$N = 3$，$Q_{\\mathrm{total}} = 0$）：\n- IS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n7.0  0.2  0.1\\\\\n0.2  12.0  0.3\\\\\n0.1  0.3  13.0\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.0 \\\\ 6.0 \\\\ 7.5 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.6  0.15  0.08\\\\\n0.15  12.6  0.25\\\\\n0.08  0.25  13.4\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 0.9 \\\\ 5.8 \\\\ 7.2 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}1.2\\\\0.9\\\\2.0\\end{bmatrix},\n\\begin{bmatrix}1.4\\\\-0.2\\\\2.3\\end{bmatrix}\n\\right\\}.\n$$\n- TS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n6.8  0.3  0.2\\\\\n0.3  11.8  0.4\\\\\n0.2  0.4  12.8\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.1 \\\\ 6.3 \\\\ 7.6 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.5  0.25  0.15\\\\\n0.25  12.5  0.35\\\\\n0.15  0.35  13.3\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 1.0 \\\\ 6.1 \\\\ 7.4 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}1.1\\\\0.5\\\\1.7\\end{bmatrix},\n\\begin{bmatrix}1.3\\\\-0.1\\\\2.0\\end{bmatrix}\n\\right\\}.\n$$\n- FS:\n$$\n\\mathbf{A}^{\\mathrm{QEq}} = \\begin{bmatrix}\n6.9  0.2  0.1\\\\\n0.2  11.9  0.3\\\\\n0.1  0.3  12.9\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{QEq}} = \\begin{bmatrix} 1.0 \\\\ 6.2 \\\\ 7.4 \\end{bmatrix};\n$$\n$$\n\\mathbf{A}^{\\mathrm{ACKS2}} = \\begin{bmatrix}\n7.4  0.18  0.10\\\\\n0.18  12.4  0.28\\\\\n0.10  0.28  13.2\n\\end{bmatrix},\\quad\n\\mathbf{b}^{\\mathrm{ACKS2}} = \\begin{bmatrix} 0.95 \\\\ 6.0 \\\\ 7.3 \\end{bmatrix};\n$$\n位置\n$$\n\\{\\mathbf{r}_i\\} = \\left\\{\n\\begin{bmatrix}0.0\\\\0.0\\\\0.0\\end{bmatrix},\n\\begin{bmatrix}2.0\\\\0.2\\\\1.6\\end{bmatrix},\n\\begin{bmatrix}1.7\\\\-0.3\\\\2.4\\end{bmatrix}\n\\right\\}.\n$$\n\n对于每个测试用例，独立地对两种模型执行以下步骤：使用增广系统和 $Q_{\\mathrm{total}} = 0$ 求解每个状态下的 $\\mathbf{q}$，计算每个状态下以 $\\mathrm{eV}$ 为单位的 $E(\\mathbf{q})$，计算反应能垒为 $\\max(E_{\\mathrm{IS}}, E_{\\mathrm{TS}}, E_{\\mathrm{FS}}) - E_{\\mathrm{IS}}$，计算以德拜为单位的过渡态偶极矩大小，然后计算 QEq 和 ACKS2 之间的差值 $\\Delta E_{\\mathrm{barrier}}$（以 $\\mathrm{eV}$ 为单位）和 $\\Delta \\mu_{\\mathrm{TS}}$（以 $\\mathrm{D}$ 为单位）。您的程序应生成单行输出，其中包含这些结果，形式为方括号内的逗号分隔列表，顺序为 $[\\Delta E_{\\mathrm{barrier}}^{(1)}, \\Delta \\mu_{\\mathrm{TS}}^{(1)}, \\Delta E_{\\mathrm{barrier}}^{(2)}, \\Delta \\mu_{\\mathrm{TS}}^{(2)}, \\Delta E_{\\mathrm{barrier}}^{(3)}, \\Delta \\mu_{\\mathrm{TS}}^{(3)}]$，每个浮点数四舍五入到六位小数。不得打印任何其他文本。", "solution": "该问题是有效的。它在科学上是合理的、提法得当、内容完整且客观。其方法论基于计算化学中用于电荷建模的既有电负性均衡原理。其数学表述涉及在线性约束下最小化二次能量泛函，这导出一个可解的增广线性系统。所有必要的数据和定义均已提供。\n\n任务是计算三种不同反应路径下，两种电荷模型——电荷平衡（QEq）和二阶原子凝聚科恩-沈近似（ACKS2）——在反应能垒和过渡态偶极矩大小上的差异。\n\n每个测试用例的步骤如下：\n1.  对于每个模型（QEq 和 ACKS2）和反应路径上的每个状态（初始态，IS；过渡态，TS；最终态，FS），我们必须首先确定平衡原子部分电荷 $\\mathbf{q}$。\n2.  平衡电荷通过求解增广线性系统找到：\n    $$\n    \\begin{bmatrix}\n    \\mathbf{A}  \\mathbf{1} \\\\\n    \\mathbf{1}^{\\mathsf{T}}  0\n    \\end{bmatrix}\n    \\begin{bmatrix}\n    \\mathbf{q} \\\\ \\lambda\n    \\end{bmatrix}\n    =\n    \\begin{bmatrix}\n    \\mathbf{b} \\\\ Q_{\\mathrm{total}}\n    \\end{bmatrix}\n    $$\n    其中 $\\mathbf{A}$ 是硬度矩阵，$\\mathbf{b}$ 是电负性向量，$\\mathbf{1}$ 是全一向量，$Q_{\\mathrm{total}}$ 是系统的总电荷，$\\lambda$ 是强制执行电荷守恒的拉格朗日乘子。这个 $(N+1) \\times (N+1)$ 的系统（其中 $N$ 是原子数）可以使用标准线性代数程序求解。\n\n3.  一旦获得给定状态的电荷向量 $\\mathbf{q}$，其能量 $E(\\mathbf{q})$ 使用提供的二次型计算：\n    $$\n    E(\\mathbf{q}) = \\frac{1}{2} \\mathbf{q}^{\\mathsf{T}} \\mathbf{A} \\mathbf{q} - \\mathbf{b}^{\\mathsf{T}} \\mathbf{q}\n    $$\n    根据问题参数的上下文，能量单位是电子伏特（eV）。\n\n4.  在为给定模型计算完所有三个状态的能量（$E_{\\mathrm{IS}}, E_{\\mathrm{TS}}, E_{\\mathrm{FS}}$）后，根据指定的定义计算反应能垒：\n    $$\n    E_{\\mathrm{barrier}} = \\max(E_{\\mathrm{IS}}, E_{\\mathrm{TS}}, E_{\\mathrm{FS}}) - E_{\\mathrm{IS}}\n    $$\n\n5.  对于每个模型的过渡态（TS），使用平衡电荷 $\\mathbf{q}_{\\mathrm{TS}}$ 和原子位置 $\\mathbf{r}_{\\mathrm{TS}}$ 计算偶极矩矢量 $\\boldsymbol{\\mu}_{\\mathrm{TS}}$：\n    $$\n    \\boldsymbol{\\mu}_{\\mathrm{TS}} = \\sum_{i=1}^{N} q_{\\mathrm{TS},i} \\mathbf{r}_{\\mathrm{TS},i}\n    $$\n    然后计算该矢量的大小 $\\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}} \\rVert$。初始单位是电子-埃（$\\mathrm{e\\AA}$），必须使用提供的转换因子 $1\\,\\mathrm{e\\AA} = 4.803204712\\,\\mathrm{D}$ 转换为德拜（D）。\n\n6.  在为给定测试用例计算出 $E_{\\mathrm{barrier}}^{\\mathrm{QEq}}$、$E_{\\mathrm{barrier}}^{\\mathrm{ACKS2}}$、$\\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}}^{\\mathrm{QEq}} \\rVert$ 和 $\\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}}^{\\mathrm{ACKS2}} \\rVert$ 后，最终关注的量是它们的差值：\n    $$\n    \\Delta E_{\\mathrm{barrier}} = E_{\\mathrm{barrier}}^{\\mathrm{QEq}} - E_{\\mathrm{barrier}}^{\\mathrm{ACKS2}}\n    $$\n    $$\n    \\Delta \\mu_{\\mathrm{TS}} = \\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}}^{\\mathrm{QEq}} \\rVert - \\lVert \\boldsymbol{\\mu}_{\\mathrm{TS}}^{\\mathrm{ACKS2}} \\rVert\n    $$\n\n对所提供的三个测试用例中的每一个都重复此整个过程。实现时将组织每个用例的数据，系统地遍历模型和状态以执行计算，并最终将结果编译成所需的输出格式。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the charge equilibration problem for multiple test cases and models.\n    \"\"\"\n    \n    eA_to_Debye = 4.803204712\n\n    test_cases = [\n        # Test Case 1\n        {\n            \"N\": 4, \"Q_total\": 0.0,\n            \"states\": {\n                \"IS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [2.8, 0.0, 0.0], [1.3, 0.8, 2.0], [1.6, -0.7, 2.4]]),\n                    \"QEq\": {\"A\": np.array([[7.0, 0.9, 0.6, 0.5], [0.9, 7.2, 0.7, 0.6], [0.6, 0.7, 11.5, 1.2], [0.5, 0.6, 1.2, 8.8]]), \"b\": np.array([1.0, 1.1, 6.2, 4.8])},\n                    \"ACKS2\": {\"A\": np.array([[7.6, 0.8, 0.5, 0.4], [0.8, 7.7, 0.6, 0.5], [0.5, 0.6, 12.1, 1.1], [0.4, 0.5, 1.1, 9.3]]), \"b\": np.array([0.9, 1.0, 6.0, 4.9])}\n                },\n                \"TS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [2.8, 0.0, 0.0], [1.1, 0.4, 1.6], [1.4, -0.5, 2.0]]),\n                    \"QEq\": {\"A\": np.array([[6.8, 1.2, 0.9, 0.7], [1.2, 7.1, 1.0, 0.8], [0.9, 1.0, 11.2, 1.6], [0.7, 0.8, 1.6, 8.6]]), \"b\": np.array([1.2, 1.2, 6.6, 4.7])},\n                    \"ACKS2\": {\"A\": np.array([[7.4, 1.0, 0.8, 0.6], [1.0, 7.5, 0.9, 0.7], [0.8, 0.9, 12.0, 1.4], [0.6, 0.7, 1.4, 9.2]]), \"b\": np.array([1.1, 1.1, 6.4, 4.8])}\n                },\n                \"FS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [2.8, 0.0, 0.0], [2.2, 0.2, 1.7], [1.8, -0.6, 2.6]]),\n                    \"QEq\": {\"A\": np.array([[6.9, 0.8, 0.7, 0.6], [0.8, 7.0, 0.7, 0.6], [0.7, 0.7, 11.0, 1.3], [0.6, 0.6, 1.3, 8.5]]), \"b\": np.array([1.0, 1.0, 6.3, 4.9])},\n                    \"ACKS2\": {\"A\": np.array([[7.5, 0.7, 0.6, 0.5], [0.7, 7.6, 0.6, 0.5], [0.6, 0.6, 12.0, 1.2], [0.5, 0.5, 1.2, 9.1]]), \"b\": np.array([0.9, 0.9, 6.1, 5.0])}\n                }\n            }\n        },\n        # Test Case 2\n        {\n            \"N\": 5, \"Q_total\": 0.0,\n            \"states\": {\n                \"IS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [3.0, 0.0, 0.0], [1.5, 1.0, 2.5], [1.7, -0.8, 2.8], [2.2, 0.5, 3.0]]),\n                    \"QEq\": {\"A\": np.array([[7.0, 0.8, 0.5, 0.4, 0.3], [0.8, 7.1, 0.6, 0.5, 0.4], [0.5, 0.6, 12.2, 1.2, 1.0], [0.4, 0.5, 1.2, 9.1, 0.7], [0.3, 0.4, 1.0, 0.7, 14.5]]), \"b\": np.array([1.0, 1.0, 6.0, 5.0, 7.0])},\n                    \"ACKS2\": {\"A\": np.array([[7.6, 0.7, 0.4, 0.3, 0.2], [0.7, 7.6, 0.5, 0.4, 0.3], [0.4, 0.5, 12.6, 1.0, 0.9], [0.3, 0.4, 1.0, 9.4, 0.6], [0.2, 0.3, 0.9, 0.6, 14.8]]), \"b\": np.array([0.9, 0.9, 5.8, 5.2, 6.8])}\n                },\n                \"TS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [3.0, 0.0, 0.0], [1.3, 0.6, 2.0], [1.5, -0.6, 2.3], [2.1, 0.4, 2.6]]),\n                    \"QEq\": {\"A\": np.array([[6.9, 1.0, 0.7, 0.6, 0.5], [1.0, 7.0, 0.8, 0.7, 0.6], [0.7, 0.8, 11.9, 1.5, 1.1], [0.6, 0.7, 1.5, 8.9, 0.8], [0.5, 0.6, 1.1, 0.8, 14.2]]), \"b\": np.array([1.2, 1.2, 6.2, 4.9, 6.9])},\n                    \"ACKS2\": {\"A\": np.array([[7.5, 0.9, 0.6, 0.5, 0.4], [0.9, 7.5, 0.7, 0.6, 0.5], [0.6, 0.7, 12.5, 1.3, 1.0], [0.5, 0.6, 1.3, 9.3, 0.7], [0.4, 0.5, 1.0, 0.7, 14.6]]), \"b\": np.array([1.1, 1.1, 6.1, 5.0, 6.7])}\n                },\n                \"FS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [3.0, 0.0, 0.0], [2.4, 0.2, 1.8], [1.9, -0.7, 2.9], [2.5, 0.6, 3.2]]),\n                    \"QEq\": {\"A\": np.array([[6.8, 0.9, 0.6, 0.5, 0.4], [0.9, 6.9, 0.7, 0.6, 0.5], [0.6, 0.7, 11.7, 1.3, 1.0], [0.5, 0.6, 1.3, 8.8, 0.7], [0.4, 0.5, 1.0, 0.7, 14.0]]), \"b\": np.array([1.0, 1.0, 6.1, 5.1, 6.8])},\n                    \"ACKS2\": {\"A\": np.array([[7.4, 0.8, 0.5, 0.4, 0.3], [0.8, 7.4, 0.6, 0.5, 0.4], [0.5, 0.6, 12.4, 1.1, 0.9], [0.4, 0.5, 1.1, 9.2, 0.6], [0.3, 0.4, 0.9, 0.6, 14.4]]), \"b\": np.array([0.9, 0.9, 5.9, 5.2, 6.6])}\n                }\n            }\n        },\n        # Test Case 3\n        {\n            \"N\": 3, \"Q_total\": 0.0,\n            \"states\": {\n                \"IS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [1.2, 0.9, 2.0], [1.4, -0.2, 2.3]]),\n                    \"QEq\": {\"A\": np.array([[7.0, 0.2, 0.1], [0.2, 12.0, 0.3], [0.1, 0.3, 13.0]]), \"b\": np.array([1.0, 6.0, 7.5])},\n                    \"ACKS2\": {\"A\": np.array([[7.6, 0.15, 0.08], [0.15, 12.6, 0.25], [0.08, 0.25, 13.4]]), \"b\": np.array([0.9, 5.8, 7.2])}\n                },\n                \"TS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [1.1, 0.5, 1.7], [1.3, -0.1, 2.0]]),\n                    \"QEq\": {\"A\": np.array([[6.8, 0.3, 0.2], [0.3, 11.8, 0.4], [0.2, 0.4, 12.8]]), \"b\": np.array([1.1, 6.3, 7.6])},\n                    \"ACKS2\": {\"A\": np.array([[7.5, 0.25, 0.15], [0.25, 12.5, 0.35], [0.15, 0.35, 13.3]]), \"b\": np.array([1.0, 6.1, 7.4])}\n                },\n                \"FS\": {\n                    \"r\": np.array([[0.0, 0.0, 0.0], [2.0, 0.2, 1.6], [1.7, -0.3, 2.4]]),\n                    \"QEq\": {\"A\": np.array([[6.9, 0.2, 0.1], [0.2, 11.9, 0.3], [0.1, 0.3, 12.9]]), \"b\": np.array([1.0, 6.2, 7.4])},\n                    \"ACKS2\": {\"A\": np.array([[7.4, 0.18, 0.10], [0.18, 12.4, 0.28], [0.10, 0.28, 13.2]]), \"b\": np.array([0.95, 6.0, 7.3])}\n                }\n            }\n        },\n    ]\n\n    final_results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        Q_total = case[\"Q_total\"]\n\n        models = [\"QEq\", \"ACKS2\"]\n        barriers = {}\n        dipoles_ts = {}\n\n        for model in models:\n            energies = {}\n            for state_name, state_data in case[\"states\"].items():\n                \n                model_data = state_data[model]\n                A = model_data[\"A\"]\n                b = model_data[\"b\"]\n                r = state_data[\"r\"]\n\n                # Construct and solve the augmented system\n                M = np.zeros((N + 1, N + 1))\n                M[:N, :N] = A\n                M[:N, N] = 1.0\n                M[N, :N] = 1.0\n\n                v = np.zeros(N + 1)\n                v[:N] = b\n                v[N] = Q_total\n\n                solution = np.linalg.solve(M, v)\n                q = solution[:N]\n\n                # Calculate energy\n                energy = 0.5 * q.T @ A @ q - b.T @ q\n                energies[state_name] = energy\n\n                # Calculate dipole moment for the transition state\n                if state_name == \"TS\":\n                    mu_vec = r.T @ q\n                    mu_mag_eA = np.linalg.norm(mu_vec)\n                    dipoles_ts[model] = mu_mag_eA * eA_to_Debye\n\n            # Calculate reaction barrier\n            e_is = energies[\"IS\"]\n            barrier = max(energies.values()) - e_is\n            barriers[model] = barrier\n        \n        # Calculate differences between models\n        delta_barrier = barriers[\"QEq\"] - barriers[\"ACKS2\"]\n        delta_dipole = dipoles_ts[\"QEq\"] - dipoles_ts[\"ACKS2\"]\n\n        final_results.extend([delta_barrier, delta_dipole])\n\n    # Format and print the final results\n    formatted_results = [f'{r:.6f}' for r in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3485008"}, {"introduction": "在掌握了电荷平衡的基本概念之后，本练习将演示如何为一个化学反应构建一个完整的势能面。我们将一个短程键合势与一个长程静电项相结合，并探讨一个关键的细节：库仑阻尼函数，它对于防止原子间距过近时的非物理行为至关重要。这次实践将阐明力场模型中的设计选择如何直接影响计算出的反应能垒。[@problem_id:3485014]", "problem": "考虑一个氢键二聚体的一维、共线、三原子模型，其中原子氧一位于坐标 $x=0$，氢位于坐标 $x$，氧二位于坐标 $x=R$。沿着质子转移坐标 $x$ 的总势能被建模为通过电荷均衡获得的短程键能和长程静电能之和。键能由两个独立的莫尔斯势之和给出，分别对应两个氧-氢间距，\n$$\nE_{\\mathrm{bond}}(x) \\;=\\; \\sum_{b \\in \\{ \\mathrm{O}_1\\text{-}\\mathrm{H},\\, \\mathrm{H}\\text{-}\\mathrm{O}_2 \\}} D_e \\left[1 - e^{-a\\,(r_b(x) - r_e)}\\right]^2,\n$$\n其中 $r_{\\mathrm{O}_1\\text{-}\\mathrm{H}}(x)=x$ 且 $r_{\\mathrm{H}\\text{-}\\mathrm{O}_2}(x)=R-x$。使用以下以电子伏特 (eV) 和埃 (Å) 为单位的参数：$D_e = 5.0 \\text{ eV}$，$a=2.2 \\text{ Å}^{-1}$，$r_e = 0.97 \\text{ Å}$。\n\n对于静电能，使用电荷均衡原理：通过最小化二次能量泛函，为原子 $i \\in \\{\\mathrm{O}_1, \\mathrm{H}, \\mathrm{O}_2\\}$ 分配部分电荷 $q_i$，\n$$\nE_{\\mathrm{QEq}}(q; x) \\;=\\; \\sum_{i} \\left(\\chi_i\\, q_i + \\tfrac{1}{2} J_i\\, q_i^2\\right) \\;+\\; \\tfrac{1}{2} \\sum_{i \\neq j} k_e\\, \\frac{f(r_{ij}(x))}{r_{ij}(x)}\\, q_i q_j,\n$$\n并遵循电中性约束 $\\sum_i q_i = 0$。此处，$r_{ij}(x)$ 是原子间距，$k_e = 14.399645478$ eV·Å，特定于原子的参数（单位为 eV）为 $\\chi_{\\mathrm{O}} = 6.6$，$J_{\\mathrm{O}} = 13.364$，$\\chi_{\\mathrm{H}} = 4.528$，$J_{\\mathrm{H}} = 13.890$。对两个氧原子使用相同的参数。原子间距为 $r_{\\mathrm{O}_1\\mathrm{H}}(x)=x$，$r_{\\mathrm{HO}_2}(x)=R-x$ 和 $r_{\\mathrm{O}_1\\mathrm{O}_2}(x)=R$。阻尼函数 $f(r)$ 用于修正长程库仑相互作用，并且必须从以下三个族中选择：\n- 无阻尼：$f_{\\mathrm{U}}(r) = 1$。\n- 指数趋近于1：$f_{\\mathrm{E}}(r) = 1 - e^{-\\alpha r}$，参数 $\\alpha$ 的单位为 $\\text{Å}^{-1}$。\n- 屏蔽（类 ReaxFF）：$f_{\\mathrm{S}}(r) = \\dfrac{r}{\\sqrt{r^2 + \\gamma^2}}$，参数 $\\gamma$ 的单位为 $\\text{Å}$。\n\n对于 $f(r)$ 的每一种选择，坐标 $x$ 处的总能量为 $E_{\\mathrm{tot}}(x) = E_{\\mathrm{bond}}(x) + E_{\\mathrm{QEq}}(q^*(x); x)$，其中 $q^*(x)$ 是在电中性约束下 $E_{\\mathrm{QEq}}$ 的唯一最小化子。质子转移能垒高度定义为\n$$\n\\Delta E^\\ddagger \\;=\\; \\max_{x \\in [x_{\\min},\\, R - x_{\\min}]} E_{\\mathrm{tot}}(x) \\;-\\; \\min\\left(E_{\\mathrm{tot}}(x_i),\\, E_{\\mathrm{tot}}(x_f)\\right),\n$$\n其中 $x_{\\min} = 0.35$ Å 以避免奇异构型，$x_i = \\max(r_e, x_{\\min})$，$x_f = \\min(R - r_e, R - x_{\\min})$。所有能量必须以 eV 表示。\n\n实现一个程序，该程序：\n- 在每个网格点 $x$ 处，通过使用拉格朗日乘子强制执行 $\\sum_i q_i = 0$ 来构建并求解因最小化 $E_{\\mathrm{QEq}}$ 而产生的电荷均衡线性系统。\n- 使用 $N$ 个点（$N=2001$）将坐标 $x$ 在闭区间 $[x_{\\min},\\, R - x_{\\min}]$ 上进行均匀离散化。\n- 为每个网格点计算 $E_{\\mathrm{tot}}(x)$，并返回如上定义的能垒高度 $\\Delta E^\\ddagger$。\n\n测试组。对于以下每组参数，计算并返回 $\\Delta E^\\ddagger$：\n- 情况 A：$R = 2.6 \\text{ Å}$, $f_{\\mathrm{U}}$。\n- 情况 B：$R = 2.6 \\text{ Å}$, $f_{\\mathrm{E}}$，其中 $\\alpha = 2.0 \\text{ Å}^{-1}$。\n- 情况 C：$R = 2.6 \\text{ Å}$, $f_{\\mathrm{S}}$，其中 $\\gamma = 0.6 \\text{ Å}$。\n- 情况 D：$R = 3.0 \\text{ Å}$, $f_{\\mathrm{E}}$，其中 $\\alpha = 2.0 \\text{ Å}^{-1}$。\n- 情况 E：$R = 2.4 \\text{ Å}$, $f_{\\mathrm{S}}$，其中 $\\gamma = 0.6 \\text{ Å}$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[resultA,resultB,resultC,resultD,resultE]”），每个条目是对应情况的浮点能垒高度（单位为 eV），顺序与上面列出的一致。所有输出都必须以 eV 为单位，不附加单位符号。", "solution": "该问题要求计算一维、共线 O-H-O 模型的质子转移活化能垒 $\\Delta E^\\ddagger$。沿质子转移坐标 $x$ 的总势能 $E_{\\mathrm{tot}}(x)$ 由两项组成：短程共价键能 $E_{\\mathrm{bond}}(x)$ 和通过电荷均衡方法确定的长程静电能 $E_{\\mathrm{QEq}}(x)$。\n\n首先，验证给定的数据和模型参数在科学上是合理的、自洽的，并且足以获得唯一解。该模型结合了计算化学和材料科学中流行的标准经验势（莫尔斯势）和电荷分配方案（电荷均衡，QEq），尤其是在像 ReaxFF 这样的反应力场的背景下。所有参数都以一致的单位（电子伏特 eV 和埃 Å）提供，且该问题是适定的。\n\n势能 $E_{\\mathrm{tot}}(x)$ 由下式给出：\n$$\nE_{\\mathrm{tot}}(x) = E_{\\mathrm{bond}}(x) + E_{\\mathrm{QEq}}(q^*(x); x)\n$$\n其中 $x$ 是氢原子的坐标，第一个氧原子 $\\mathrm{O}_1$ 位于 $x=0$，第二个氧原子 $\\mathrm{O}_2$ 位于 $x=R$。$q^*(x)$ 代表在每个坐标 $x$ 处使静电能最小化的原子部分电荷矢量。\n\n键能 $E_{\\mathrm{bond}}(x)$ 被建模为两个莫尔斯势之和，一个用于 $\\mathrm{O}_1$-H 键，另一个用于 H-$\\mathrm{O}_2$ 键：\n$$\nE_{\\mathrm{bond}}(x) = D_e \\left[1 - e^{-a\\,(r_{\\mathrm{O}_1\\text{-}\\mathrm{H}}(x) - r_e)}\\right]^2 + D_e \\left[1 - e^{-a\\,(r_{\\mathrm{H}\\text{-}\\mathrm{O}_2}(x) - r_e)}\\right]^2\n$$\n原子间距是质子坐标的函数：$r_{\\mathrm{O}_1\\text{-}\\mathrm{H}}(x) = x$ 和 $r_{\\mathrm{H}\\text{-}\\mathrm{O}_2}(x) = R - x$。提供的参数为 $D_e = 5.0$\\,eV，$a = 2.2$\\,Å$^{-1}$，$r_e = 0.97$\\,Å。\n\n静电能 $E_{\\mathrm{QEq}}(q; x)$ 通过找到一组原子 $\\{\\mathrm{O}_1, \\mathrm{H}, \\mathrm{O}_2\\}$ 的部分电荷 $\\{q_1, q_2, q_3\\}$ 来确定，这组电荷使能量泛函最小化：\n$$\nE_{\\mathrm{QEq}}(q; x) = \\sum_{i=1}^{3} \\left(\\chi_i q_i + \\tfrac{1}{2} J_i q_i^2\\right) + \\tfrac{1}{2} \\sum_{i \\neq j} k_e \\frac{f(r_{ij}(x))}{r_{ij}(x)} q_i q_j\n$$\n并遵循电中性约束 $\\sum_i q_i = 0$。参数是原子电负性 $\\chi_i$ 和硬度 $J_i$。给定 $\\chi_{\\mathrm{O}} = 6.6$\\,eV，$J_{\\mathrm{O}} = 13.364$\\,eV，$\\chi_{\\mathrm{H}} = 4.528$\\,eV，$J_{\\mathrm{H}} = 13.890$\\,eV。库仑常数为 $k_e = 14.399645478$\\,eV·Å。函数 $f(r)$ 是一个用于处理短程相互作用的阻尼函数。\n\n为了找到在约束条件下使 $E_{\\mathrm{QEq}}$ 最小化的电荷矢量 $q^*(x)$，我们采用拉格朗日乘子法。拉格朗日量 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(q_1, q_2, q_3, \\lambda) = E_{\\mathrm{QEq}}(q_1, q_2, q_3; x) - \\lambda \\left(\\sum_{i=1}^{3} q_i\\right)\n$$\n将关于每个 $q_k$ 和 $\\lambda$ 的偏导数设为零，得到一个线性方程组。\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial q_k} = \\chi_k + J_k q_k + \\sum_{j \\neq k} k_e \\frac{f(r_{kj})}{r_{kj}} q_j - \\lambda = 0 \\quad \\text{for } k=1,2,3\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = -\\sum_{i=1}^{3} q_i = 0\n$$\n该系统可以表示为矩阵形式 $M \\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} = [q_1, q_2, q_3, -\\lambda]^T$。\n$$\n\\begin{pmatrix}\nJ_{\\mathrm{O}}  V_{12}  V_{13}  1 \\\\\nV_{21}  J_{\\mathrm{H}}  V_{23}  1 \\\\\nV_{31}  V_{32}  J_{\\mathrm{O}}  1 \\\\\n1  1  1  0\n\\end{pmatrix}\n\\begin{pmatrix}\nq_1 \\\\ q_2 \\\\ q_3 \\\\ -\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\chi_{\\mathrm{O}} \\\\ -\\chi_{\\mathrm{H}} \\\\ -\\chi_{\\mathrm{O}} \\\\ 0\n\\end{pmatrix}\n$$\n其中 $V_{ij}(x) = k_e f(r_{ij}(x))/r_{ij}(x)$。距离为 $r_{12}=x$，$r_{23}=R-x$，$r_{13}=R$。该矩阵是对称的，即 $V_{ij} = V_{ji}$。对于每个 $x$ 值，求解这个 $4 \\times 4$ 系统以找到平衡电荷 $q^*(x) = \\{q_1, q_2, q_3\\}$。然后使用这些电荷，通过其定义公式计算 $E_{\\mathrm{QEq}}$。\n\n数值算法流程如下：\n1. 将质子坐标 $x$ 在闭区间 $[x_{\\min}, R - x_{\\min}]$（其中 $x_{\\min}=0.35$\\,Å）上离散化为 $N=2001$ 个等距点。\n2. 对于网格中的每个点 $x$，计算总能量 $E_{\\mathrm{tot}}(x)$。这包括：\n    a. 计算 $E_{\\mathrm{bond}}(x)$。\n    b. 构建并求解关于电荷 $q^*(x)$ 的 $4 \\times 4$ 线性系统。\n    c. 计算 $E_{\\mathrm{QEq}}(q^*(x); x)$。\n    d. 将两个能量分量相加。\n3. 找出整个网格上的最大能量值 $\\max_{x} E_{\\mathrm{tot}}(x)$。\n4. 参考能量由反应物和产物状态确定。反应物坐标为 $x_i = \\max(r_e, x_{\\min}) = \\max(0.97, 0.35) = 0.97$\\,Å。产物坐标为 $x_f = \\min(R - r_e, R - x_{\\min})$。由于势的对称性（$E_{\\mathrm{tot}}(x) = E_{\\mathrm{tot}}(R-x)$），反应物和产物极小值处的能量相等：$E_{\\mathrm{tot}}(x_i) = E_{\\mathrm{tot}}(x_f)$。因此，参考能量为 $E_{\\mathrm{ref}} = E_{\\mathrm{tot}}(x_i)$。此能量通过在 $x=x_i$ 处进行最终的单独评估来计算。\n5. 质子转移能垒计算为 $\\Delta E^\\ddagger = \\max_{x} E_{\\mathrm{tot}}(x) - E_{\\mathrm{ref}}$。\n\n对五个测试案例中的每一个重复此过程，这些案例在 O-O 距离 $R$ 以及阻尼函数 $f(r)$ 及其参数的选择上有所不同。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the proton transfer energy barrier for a 1D O-H-O model.\n    The total energy is the sum of a Morse potential for bonding and a\n    charge-equilibration potential for electrostatics. The barrier is found\n    by scanning the potential energy surface along the proton coordinate.\n    \"\"\"\n\n    # --- Problem Constants ---\n    DE = 5.0  # eV, Morse potential depth\n    A_MORSE = 2.2  # Angstrom^-1, Morse potential width parameter\n    RE = 0.97  # Angstrom, equilibrium O-H bond length\n    KE = 14.399645478  # eV * Angstrom, Coulomb constant\n    CHI_O, J_O = 6.6, 13.364  # eV, O electronegativity and hardness\n    CHI_H, J_H = 4.528, 13.890  # eV, H electronegativity and hardness\n    X_MIN = 0.35  # Angstrom, minimum H coordinate to avoid singularity\n    N_POINTS = 2001  # Number of grid points for discretization\n\n    # --- Damping Functions ---\n    def f_U(r, param):\n        \"\"\"Undamped Coulomb interaction.\"\"\"\n        return 1.0\n\n    def f_E(r, param_alpha):\n        \"\"\"Exponentially damped Coulomb interaction.\"\"\"\n        return 1.0 - np.exp(-param_alpha * r)\n\n    def f_S(r, param_gamma):\n        \"\"\"Shielded (ReaxFF-like) Coulomb interaction.\"\"\"\n        return r / np.sqrt(r**2 + param_gamma**2)\n    \n    # --- Test Cases ---\n    test_cases = [\n        {'R': 2.6, 'func': f_U, 'param': None, 'name': 'A'},\n        {'R': 2.6, 'func': f_E, 'param': 2.0, 'name': 'B'},\n        {'R': 2.6, 'func': f_S, 'param': 0.6, 'name': 'C'},\n        {'R': 3.0, 'func': f_E, 'param': 2.0, 'name': 'D'},\n        {'R': 2.4, 'func': f_S, 'param': 0.6, 'name': 'E'},\n    ]\n    \n    # --- Helper function for total energy calculation ---\n    def get_total_energy_at_x(x, R, f_damping, f_param):\n        \"\"\"\n        Calculates the total potential energy at a given proton coordinate x.\n        \"\"\"\n        # 1. Bond Energy (Morse Potential)\n        r_oh1 = x\n        r_oh2 = R - x\n        morse1 = (1.0 - np.exp(-A_MORSE * (r_oh1 - RE)))**2\n        morse2 = (1.0 - np.exp(-A_MORSE * (r_oh2 - RE)))**2\n        e_bond = DE * (morse1 + morse2)\n\n        # 2. Electrostatic Energy (Charge Equilibration)\n        # Distances for QEq\n        r_o1h, r_ho2, r_o1o2 = x, R - x, R\n\n        # Off-diagonal matrix elements V_ij = k_e * f(r_ij) / r_ij\n        J12 = KE * f_damping(r_o1h, f_param) / r_o1h\n        J23 = KE * f_damping(r_ho2, f_param) / r_ho2\n        J13 = KE * f_damping(r_o1o2, f_param) / r_o1o2\n        \n        # QEq energy matrix A (3x3)\n        A_qeq = np.array([\n            [J_O, J12, J13],\n            [J12, J_H, J23],\n            [J13, J23, J_O]\n        ])\n        \n        # Bordered matrix M for solving the linear system (4x4)\n        M = np.zeros((4, 4))\n        M[:3, :3] = A_qeq\n        M[:3, 3] = 1.0\n        M[3, :3] = 1.0\n        \n        # Right-hand side vector b\n        chi_vec_neg = np.array([-CHI_O, -CHI_H, -CHI_O])\n        b = np.zeros(4)\n        b[:3] = chi_vec_neg\n\n        # Solve for charges q and Lagrange multiplier\n        try:\n            sol = np.linalg.solve(M, b)\n        except np.linalg.LinAlgError:\n            return np.inf # Return infinity if matrix is singular\n        \n        q = sol[:3] # Charges are the first 3 elements\n\n        # Calculate QEq energy using E = chi^T*q + 0.5*q^T*A*q\n        chi_vec_pos = np.array([CHI_O, CHI_H, CHI_O])\n        e_qeq = np.dot(chi_vec_pos, q) + 0.5 * np.dot(q, np.dot(A_qeq, q))\n\n        return e_bond + e_qeq\n\n    results = []\n    for case in test_cases:\n        R = case['R']\n        f_damping = case['func']\n        f_param = case['param']\n\n        # Discretize the proton coordinate x\n        x_grid = np.linspace(X_MIN, R - X_MIN, N_POINTS)\n        \n        # Calculate total energy across the grid\n        energy_profile = np.array([get_total_energy_at_x(x, R, f_damping, f_param) for x in x_grid])\n        \n        # Find the maximum energy on the profile\n        e_max = np.max(energy_profile)\n        \n        # Define reactant/product coordinates\n        x_i = max(RE, X_MIN)\n        # x_f = min(R - RE, R - X_MIN) # Not needed due to symmetry\n        \n        # By symmetry, E_tot(x_i) == E_tot(x_f), so we only need one\n        e_ref = get_total_energy_at_x(x_i, R, f_damping, f_param)\n        \n        # Calculate barrier height\n        barrier_height = e_max - e_ref\n        results.append(barrier_height)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3485014"}, {"introduction": "最后的这个练习将解决一个根本性问题：力场中的参数从何而来？我们将通过实践构建一个多目标优化函数来探索参数化的原理，该函数旨在匹配量子力学的计算数据。本练习将展示如何将不同的物理可观测量——能量、力，甚至是与反应动力学相关的过渡态曲率——组合成一个单一、均衡的度量标准，用于开发和优化反应力场。[@problem_id:3485001]", "problem": "您的任务是为一个简化的反应力场设计并实现一个组合参数优化目标。该力场沿单一有效反应坐标捕捉化学反应性。目标是整合来自力、能量和过渡态曲率的信息，以更好地匹配能垒形状和动力学指前因子。您的程序必须为几个候选参数集计算此标量目标，并在单行中输出结果。\n\n使用的基础理论：\n- Newton 第二定律：$F = m \\, a$ 以及保守力的定义 $F(x) = -\\frac{\\partial U(x)}{\\partial x}$，其中 $U(x)$ 为势能。\n- 一维坐标的 Hessian 曲率：$\\lambda(x) = \\frac{\\partial^2 U(x)}{\\partial x^2}$。\n- 过渡态理论 (TST) 中过渡态的谐振近似：不稳定模式角频率的大小为 $|\\omega_b| = \\sqrt{\\frac{|k|}{m}}$，其中 $k$ 是以 $\\mathrm{N/m}$ 为单位的曲率，$m$ 是以 $\\mathrm{kg}$ 为单位的质量。尝试频率为 $\\nu = \\frac{|\\omega_b|}{2\\pi}$。\n- 使用以电子伏特 (electron-volts) 为单位的能量 $U$ 和以埃 (ångström) 为单位的位置所需的单位转换：$1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$，$1\\,\\text{\\AA} = 1.0\\times 10^{-10}\\,\\mathrm{m}$，以及 $1\\,\\mathrm{amu} = 1.66053906660\\times 10^{-27}\\,\\mathrm{kg}$。以 $\\mathrm{eV/\\text{\\AA}^2}$ 为单位的曲率通过乘以 $1.602176634\\times 10^{-19} / (1.0\\times 10^{-10})^2$ 转换为 $\\mathrm{N/m}$。\n\n模型与场景：\n- 考虑一个有效的一维反应坐标 $x$，其具有可以表示反应能垒的双阱势。势能定义为 $U(x; \\boldsymbol{\\theta}) = \\theta_a \\left(x^2 - \\theta_b^2\\right)^2 + \\theta_c \\, x + \\theta_d$，其中 $\\boldsymbol{\\theta} = (\\theta_a, \\theta_b, \\theta_c, \\theta_d)$ 是参数。\n- 力为 $F(x; \\boldsymbol{\\theta}) = -\\frac{\\partial U(x; \\boldsymbol{\\theta})}{\\partial x}$，曲率（一维 Hessian）为 $\\lambda(x; \\boldsymbol{\\theta}) = \\frac{\\partial^2 U(x; \\boldsymbol{\\theta})}{\\partial x^2}$。\n- 假设在 $x_{\\mathrm{ts}} = 0$ 附近存在一个过渡态 (TS)，对于给定的形式，当 $\\theta_a > 0$ 且 $\\theta_b \\neq 0$ 时，过渡态曲率为负。不稳定模式频率的大小由过渡态的绝对曲率计算得出，动力学指前因子为 $\\nu = \\frac{|\\omega_b|}{2\\pi}$。\n\n待计算的目标：\n- 构建一个标量目标，该目标聚合了来自能量匹配、力匹配、过渡态曲率匹配和动力学指前因子匹配的贡献。每个贡献是模型值与参考值之间的平方残差，通过特征尺度进行归一化以使各项无量纲化，并乘以权重以平衡其影响。能量和力的残差是在一组位置上累积的。对于给定的 $\\boldsymbol{\\theta}$，此目标应为单个实数。\n- 目标必须物理上一致且量纲上协调。归一化由以下尺度提供：$E_{\\mathrm{scale}}$ 单位为 $\\mathrm{eV}$，$F_{\\mathrm{scale}}$ 单位为 $\\mathrm{eV/\\text{\\AA}}$，$\\lambda_{\\mathrm{scale}}$ 单位为 $\\mathrm{eV/\\text{\\AA}^2}$，以及 $\\nu_{\\mathrm{scale}}$ 单位为 $\\mathrm{s^{-1}}$。\n- 权重是用于力、曲率和指前因子贡献的非负无量纲乘数。\n\n单位：\n- 能量必须以 $\\mathrm{eV}$ 为单位。\n- 位置必须以 $\\text{\\AA}$ 为单位。\n- 力必须以 $\\mathrm{eV/\\text{\\AA}}$ 为单位。\n- 曲率必须以 $\\mathrm{eV/\\text{\\AA}^2}$ 为单位。\n- 指前因子必须以 $\\mathrm{s^{-1}}$ 为单位。\n- 最终目标值为无单位的实数。\n\n给定数据：\n- 用于生成参考值（不用于评估）的参考参数：$\\boldsymbol{\\theta}^{\\mathrm{ref}} = (\\theta_a^{\\mathrm{ref}}, \\theta_b^{\\mathrm{ref}}, \\theta_c^{\\mathrm{ref}}, \\theta_d^{\\mathrm{ref}}) = (\\,0.4,\\, 1.0,\\, 0.05,\\, 0.0\\,)$。\n- 反应坐标的质量：$m = 12.0\\,\\mathrm{amu}$。\n- 过渡态坐标：$x_{\\mathrm{ts}} = 0.0\\,\\text{\\AA}$。\n- 用于能量和力评估的位置：$x \\in \\{ -1.5,\\, -1.0,\\, -0.5,\\, 0.0,\\, 0.5,\\, 1.0,\\, 1.5 \\}\\,\\text{\\AA}$。\n- 特征尺度：$E_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV}$，$F_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}}$，$\\lambda_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}^2}$，$\\nu_{\\mathrm{scale}} = 1.0\\times 10^{13}\\,\\mathrm{s^{-1}}$。\n- 权重：力的权重 $\\alpha = 1.0$，过渡态曲率的权重 $\\beta = 0.5$，动力学指前因子的权重 $\\gamma = 0.5$。\n\n待匹配的参考值由 $\\boldsymbol{\\theta}^{\\mathrm{ref}}$ 生成：\n- 对于每个列出的位置 $x$，计算 $U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和 $F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$。\n- 在 $x_{\\mathrm{ts}}$ 处，计算 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}})$。将此曲率转换为 $\\mathrm{N/m}$ 以计算 $|\\omega_b|$，然后计算 $\\nu^{\\mathrm{ref}} = \\frac{|\\omega_b|}{2\\pi}$，最终以 $\\mathrm{s^{-1}}$ 表示。\n\n测试套件：\n- 为以下候选参数集 $\\boldsymbol{\\theta}$ 评估目标：\n  1. $\\boldsymbol{\\theta}^{(1)} = (\\,0.4,\\, 1.0,\\, 0.05,\\, 0.0\\,)$。\n  2. $\\boldsymbol{\\theta}^{(2)} = (\\,0.35,\\, 0.9,\\, 0.04,\\, 0.02\\,)$。\n  3. $\\boldsymbol{\\theta}^{(3)} = (\\,0.2,\\, 0.5,\\, 0.01,\\, -0.01\\,)$。\n  4. $\\boldsymbol{\\theta}^{(4)} = (\\,0.0,\\, 1.0,\\, 0.0,\\, 0.0\\,)$。\n\n您的任务：\n- 根据提供的势能形式，从第一性原理推导出计算力、曲率和动力学指前因子所需的表达式，密切关注单位和转换。\n- 实现一个程序，该程序：\n  - 从 $\\boldsymbol{\\theta}^{\\mathrm{ref}}$ 生成参考能量、力、过渡态曲率和指前因子。\n  - 对于测试套件中的每个候选 $\\boldsymbol{\\theta}^{(j)}$，计算如上所述的标量目标。\n  - 生成单行输出，其中包含按测试套件顺序排列的结果，形式为逗号分隔的列表并用方括号括起来：$[J(\\boldsymbol{\\theta}^{(1)}), J(\\boldsymbol{\\theta}^{(2)}), J(\\boldsymbol{\\theta}^{(3)}), J(\\boldsymbol{\\theta}^{(4)})]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[r_1,r_2,r_3,r_4]$）。", "solution": "我们首先构建一个有效的一维模型，该模型使用解析双阱势来捕捉过渡态附近化学反应性的关键特征。沿反应坐标的势能定义为 $U(x; \\boldsymbol{\\theta}) = \\theta_a \\left(x^2 - \\theta_b^2\\right)^2 + \\theta_c \\, x + \\theta_d$。当 $\\theta_a > 0$ 时，此函数形式在 $x \\approx \\pm \\theta_b$ 附近提供两个极小值，由 $x \\approx 0$ 附近的能垒隔开；线性项倾斜了势能面以打破对称性。\n\n根据基本原理，保守力定义为 $F(x; \\boldsymbol{\\theta}) = -\\frac{\\partial U(x; \\boldsymbol{\\theta})}{\\partial x}$。对 $U(x; \\boldsymbol{\\theta})$ 求导，我们得到\n$$\n\\frac{\\partial U(x; \\boldsymbol{\\theta})}{\\partial x} = \\theta_a \\, \\frac{\\partial}{\\partial x}\\left(x^2 - \\theta_b^2\\right)^2 + \\theta_c = \\theta_a \\cdot 4x\\left(x^2 - \\theta_b^2\\right) + \\theta_c,\n$$\n因此\n$$\nF(x; \\boldsymbol{\\theta}) = -\\left(4\\theta_a\\, x \\left(x^2 - \\theta_b^2\\right) + \\theta_c \\right).\n$$\n\n一维 Hessian 曲率是势能对位置的二阶导数，\n$$\n\\lambda(x; \\boldsymbol{\\theta}) = \\frac{\\partial^2 U(x; \\boldsymbol{\\theta})}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(4\\theta_a\\, x \\left(x^2 - \\theta_b^2\\right) + \\theta_c\\right) = 4\\theta_a\\left(3x^2 - \\theta_b^2\\right).\n$$\n在过渡态坐标 $x_{\\mathrm{ts}} = 0$ 处，曲率简化为 $\\lambda(x_{\\mathrm{ts}}; \\boldsymbol{\\theta}) = -4 \\theta_a \\theta_b^2$。只要 $\\theta_a > 0$ 且 $\\theta_b \\neq 0$，该曲率就为负，表明势能沿反应坐标存在一个局部极大值。\n\n为了在谐振近似下根据过渡态理论 (TST) 计算动力学指前因子，我们使用关系式 $|\\omega_b| = \\sqrt{\\frac{|k|}{m}}$，其中 $k$ 是以 $\\mathrm{N/m}$ 为单位的曲率，$m$ 是以 $\\mathrm{kg}$ 为单位的有效质量。由于我们的曲率以 $\\mathrm{eV/\\text{\\AA}^2}$ 为单位给出，因此需要进行单位转换：\n- $1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$,\n- $1\\,\\text{\\AA} = 1.0\\times 10^{-10}\\,\\mathrm{m}$,\n- $1\\,\\mathrm{amu} = 1.66053906660\\times 10^{-27}\\,\\mathrm{kg}$,\n因此\n$$\nk \\;[\\mathrm{N/m}] = \\lambda \\;[\\mathrm{eV/\\text{\\AA}^2}] \\cdot \\frac{1.602176634\\times 10^{-19}\\,\\mathrm{J}}{(1.0\\times 10^{-10}\\,\\mathrm{m})^2}.\n$$\n给定以 $\\mathrm{kg}$ 为单位的质量 $m$，不稳定模式角频率的大小为\n$$\n|\\omega_b| = \\sqrt{\\frac{|k|}{m}},\n$$\n动力学指前因子为\n$$\n\\nu = \\frac{|\\omega_b|}{2\\pi},\n$$\n单位为 $\\mathrm{s^{-1}}$。\n\n我们使用 $\\boldsymbol{\\theta}^{\\mathrm{ref}} = (\\,0.4,\\, 1.0,\\, 0.05,\\, 0.0\\,)$ 生成参考值：\n- 对于位置 $x \\in \\{ -1.5,\\, -1.0,\\, -0.5,\\, 0.0,\\, 0.5,\\, 1.0,\\, 1.5 \\}\\,\\text{\\AA}$，使用上述推导的公式计算以 $\\mathrm{eV}$ 为单位的 $U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和以 $\\mathrm{eV/\\text{\\AA}}$ 为单位的 $F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$。\n- 在 $x_{\\mathrm{ts}} = 0.0\\,\\text{\\AA}$ 处，计算以 $\\mathrm{eV/\\text{\\AA}^2}$ 为单位的 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}})$，将其转换为以 $\\mathrm{N/m}$ 为单位的 $k$，并使用转换为 $\\mathrm{kg}$ 的质量 $m = 12.0\\,\\mathrm{amu}$，计算以 $\\mathrm{s^{-1}}$ 为单位的 $\\nu^{\\mathrm{ref}}$。\n\n为了获得候选参数集 $\\boldsymbol{\\theta}$ 的标量目标，我们聚合四个贡献：\n- 在一组位置上的能量匹配，使用由 $E_{\\mathrm{scale}}^2$ 归一化的平方残差 $(U(x;\\boldsymbol{\\theta}) - U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}}))^2$，\n- 在一组位置上的力匹配，使用由 $F_{\\mathrm{scale}}^2$ 归一化并由 $\\alpha$ 加权的平方残差 $(F(x;\\boldsymbol{\\theta}) - F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}}))^2$，\n- 在 $x_{\\mathrm{ts}}$ 处的过渡态曲率匹配，使用由 $\\lambda_{\\mathrm{scale}}^2$ 归一化并由 $\\beta$ 加权的 $(\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}) - \\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}}))^2$，\n- 动力学指前因子匹配，使用由 $\\nu_{\\mathrm{scale}}^2$ 归一化并由 $\\gamma$ 加权的 $(\\nu(\\boldsymbol{\\theta}) - \\nu^{\\mathrm{ref}})^2$，\n其中 $\\nu(\\boldsymbol{\\theta})$ 是通过将 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 转换为以 $\\mathrm{N/m}$ 为单位的 $k$ 并使用质量 $m$ 来计算的。\n\n特征尺度设置为 $E_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV}$、$F_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}}$、$\\lambda_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}^2}$ 和 $\\nu_{\\mathrm{scale}} = 1.0\\times 10^{13}\\,\\mathrm{s^{-1}}$，以确保无量纲贡献具有可比的量级。权重选择为 $\\alpha = 1.0$、$\\beta = 0.5$ 和 $\\gamma = 0.5$，以在保持物理缩放的同时平衡各项的重点。\n\n算法步骤：\n1. 根据 $\\boldsymbol{\\theta}$ 定义用于单位转换的常数以及势能、力和曲率的函数。\n2. 在指定位置上生成参考数组 $U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和 $F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$，并计算 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和 $\\nu^{\\mathrm{ref}}$。\n3. 对于测试套件中的每个候选 $\\boldsymbol{\\theta}$，计算 $U(x;\\boldsymbol{\\theta})$、$F(x;\\boldsymbol{\\theta})$、$\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 和 $\\nu(\\boldsymbol{\\theta})$。\n4. 如上所述聚合归一化的平方残差，以获得标量目标 $J(\\boldsymbol{\\theta})$。\n5. 以单行逗号分隔列表的形式输出列表 $[J(\\boldsymbol{\\theta}^{(1)}), J(\\boldsymbol{\\theta}^{(2)}), J(\\boldsymbol{\\theta}^{(3)}), J(\\boldsymbol{\\theta}^{(4)})]$，并用方括号括起来。\n\n边缘情况：\n- 如果 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 为零，则不稳定模式频率的大小为零，指前因子 $\\nu$ 也为零，目标函数应能自然处理这种情况。\n- 如果 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 为正，表明在过渡态坐标处没有能垒，计算将使用绝对曲率来定义 $|\\omega_b|$ 的大小；曲率和指前因子的不匹配将反映在目标中，从而惩罚此类参数集。\n\n此过程提供了一个基于物理的、无量纲的标量目标，该目标可同时拟合能量、力、过渡态曲率和尝试频率指前因子，适用于根据高保真度参考数据校准反应力场，同时保持科学真实性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Unit conversions\nEV_TO_J = 1.602176634e-19         # J/eV\nANGSTROM_TO_M = 1.0e-10           # m/Angstrom\nAMU_TO_KG = 1.66053906660e-27     # kg/amu\n\n# Characteristic scales for normalization (dimensionless objective)\nE_SCALE = 1.0            # eV\nF_SCALE = 1.0            # eV/Angstrom\nLAMBDA_SCALE = 1.0       # eV/Angstrom^2\nNU_SCALE = 1.0e13        # s^-1\n\n# Weights for contributions\nALPHA = 1.0  # force weight\nBETA = 0.5   # curvature weight\nGAMMA = 0.5  # prefactor weight\n\n# Mass and TS coordinate\nMASS_AMU = 12.0          # amu\nX_TS = 0.0               # Angstrom\n\n# Reference parameters to generate reference data\nTHETA_REF = np.array([0.4, 1.0, 0.05, 0.0])  # (theta_a, theta_b, theta_c, theta_d)\n\n# Positions for energy/force evaluation\nX_POINTS = np.array([-1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5])  # Angstrom\n\n\ndef potential_U(x, theta):\n    \"\"\"\n    Potential energy U(x; theta) = theta_a * (x^2 - theta_b^2)^2 + theta_c * x + theta_d\n    Units: U in eV when x in Angstrom and parameters carry corresponding units.\n    \"\"\"\n    a, b, c, d = theta\n    return a * (x**2 - b**2)**2 + c * x + d\n\n\ndef force_F(x, theta):\n    \"\"\"\n    Conservative force F(x; theta) = -dU/dx\n    dU/dx = 4 * theta_a * x * (x^2 - theta_b^2) + theta_c\n    Units: F in eV/Angstrom\n    \"\"\"\n    a, b, c, d = theta\n    return -(4.0 * a * x * (x**2 - b**2) + c)\n\n\ndef hessian_lambda(x, theta):\n    \"\"\"\n    One-dimensional curvature (Hessian) lambda(x; theta) = d^2U/dx^2\n    d^2U/dx^2 = 4 * theta_a * (3*x^2 - theta_b^2)\n    Units: eV/Angstrom^2\n    \"\"\"\n    a, b, c, d = theta\n    return 4.0 * a * (3.0 * x**2 - b**2)\n\n\ndef prefactor_nu_from_lambda(lambda_eVA2, mass_amu):\n    \"\"\"\n    Compute attempt frequency prefactor nu from curvature (lambda) at TS.\n    Uses harmonic TST approximation: |omega_b| = sqrt(|k| / m), nu = |omega_b| / (2*pi).\n    lambda is in eV/Angstrom^2, convert to k (N/m). Mass in amu -> kg.\n    Returns nu in s^-1.\n    \"\"\"\n    # Convert curvature from eV/Angstrom^2 to N/m\n    k_N_per_m = lambda_eVA2 * (EV_TO_J / (ANGSTROM_TO_M**2))\n    # Convert mass to kg\n    mass_kg = mass_amu * AMU_TO_KG\n    # Handle non-positive mass (should not happen here)\n    if mass_kg == 0.0:\n        raise ValueError(\"Mass must be positive.\")\n    # Angular frequency magnitude from absolute curvature\n    omega = np.sqrt(np.abs(k_N_per_m) / mass_kg)\n    nu = omega / (2.0 * np.pi)\n    return nu\n\n\ndef compute_reference_data(theta_ref, x_points, x_ts, mass_amu):\n    \"\"\"\n    Generate reference energies, forces, curvature at TS, and prefactor using theta_ref.\n    \"\"\"\n    E_ref = potential_U(x_points, theta_ref)\n    F_ref = force_F(x_points, theta_ref)\n    lambda_ref = hessian_lambda(x_ts, theta_ref)\n    nu_ref = prefactor_nu_from_lambda(lambda_ref, mass_amu)\n    return E_ref, F_ref, lambda_ref, nu_ref\n\n\ndef objective(theta, x_points, E_ref, F_ref, lambda_ref, nu_ref, x_ts, mass_amu):\n    \"\"\"\n    Compute scalar objective combining normalized squared residuals for:\n      - Energies across x_points\n      - Forces across x_points (weighted by ALPHA)\n      - Curvature at TS (weighted by BETA)\n      - Prefactor (weighted by GAMMA)\n    \"\"\"\n    # Model predictions\n    E_model = potential_U(x_points, theta)\n    F_model = force_F(x_points, theta)\n    lambda_model = hessian_lambda(x_ts, theta)\n    nu_model = prefactor_nu_from_lambda(lambda_model, mass_amu)\n\n    # Residuals normalized by scales\n    energy_residuals = (E_model - E_ref) / E_SCALE\n    force_residuals = (F_model - F_ref) / F_SCALE\n    lambda_residual = (lambda_model - lambda_ref) / LAMBDA_SCALE\n    nu_residual = (nu_model - nu_ref) / NU_SCALE\n\n    # Aggregate squared residuals\n    J_energy = np.sum(energy_residuals**2)\n    J_force = ALPHA * np.sum(force_residuals**2)\n    J_lambda = BETA * (lambda_residual**2)\n    J_nu = GAMMA * (nu_residual**2)\n\n    J_total = float(J_energy + J_force + J_lambda + J_nu)\n    return J_total\n\n\ndef solve():\n    # Build reference data\n    E_ref, F_ref, lambda_ref, nu_ref = compute_reference_data(THETA_REF, X_POINTS, X_TS, MASS_AMU)\n\n    # Define the test cases (candidate parameter sets)\n    test_cases = [\n        np.array([0.4, 1.0, 0.05, 0.0]),   # Case 1: exact match\n        np.array([0.35, 0.9, 0.04, 0.02]), # Case 2: moderate mismatch\n        np.array([0.2, 0.5, 0.01, -0.01]), # Case 3: flatter barrier\n        np.array([0.0, 1.0, 0.0, 0.0]),    # Case 4: no quartic term (edge case)\n    ]\n\n    results = []\n    for theta in test_cases:\n        J = objective(theta, X_POINTS, E_ref, F_ref, lambda_ref, nu_ref, X_TS, MASS_AMU)\n        results.append(J)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3485001"}]}