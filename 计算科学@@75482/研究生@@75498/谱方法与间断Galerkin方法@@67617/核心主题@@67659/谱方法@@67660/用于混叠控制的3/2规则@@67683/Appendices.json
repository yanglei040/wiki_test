{"hands_on_practices": [{"introduction": "为了直观地理解混叠误差是如何产生的，我们从一个基础的傅里叶伪谱方法中的例子开始。通过分析两个高波数正弦函数乘积的频谱，本练习将具体展示高频分量如何“伪装”成低频分量，从而污染计算结果。这个计算练习 [@problem_id:3423339] 将帮助你精确识别在没有进行去混叠处理时产生的虚假波数，并将其与应用了三分之二规则后得到的真实波数进行对比。", "problem": "考虑一个在 $[0,2\\pi)$ 上的 $2\\pi$ 周期函数，使用 $N$ 个等距网格点 $x_j = 2\\pi j/N$ 对其进行标准的伪谱离散化，其中 $N$ 是一个偶数。在此网格上的离散傅里叶变换 (DFT) 表示傅里叶模态，其整数波数指数位于主集 $\\{-\\frac{N}{2}+1,\\ldots,-1,0,1,\\ldots,\\frac{N}{2}\\}$ 中，并且谱空间中的卷积使指数以 $N$ 为模进行环绕。设 $u(x)=\\sin(kx)$ 和 $v(x)=\\sin(\\ell x)$，其中 $k=\\frac{N}{2}-1$ 且 $\\ell=\\frac{N}{2}-2$。逐点乘积 $w(x)=u(x)v(x)$ 在物理网格上计算，然后变换回谱空间。\n\n从第一性原理出发：\n- 三角函数的积化和差恒等式。\n- 将傅里叶乘法解释为模态系数的卷积。\n- DFT 卷积以 $N$ 为模的环绕效应，这会导致混叠进入主指数集。\n\n在二次混叠控制的背景下回答以下问题。\n1) 如果乘积 $w(x)$ 在原始的 $N$ 点网格上计算，不进行任何填充，请确定主集中与 $w(x)$ 中的高频和声波对应的混叠波数指数。\n2) 如果改用“三分之二”去混叠规则（即，在谱空间中零填充至大小为 $P=\\frac{3N}{2}$ 的网格，变换到物理空间，在 $P$ 点网格上计算乘积，再变换回来，然后截断至原始的 $N$ 模态带），请确定截断前和声波的未混叠高频波数指数（即，整数波数线上的真实和声波指数）。\n\n将最终答案表示为一个包含两个条目的行矩阵 $\\big(m_{\\text{alias}},\\,m_{\\text{true}}\\big)$，其中 $m_{\\text{alias}}$ 是在第 (1) 部分中找到的混叠指数，$m_{\\text{true}}$ 是在第 (2) 部分中找到的真实高频和声波指数。不需要四舍五入。不要包含单位。", "solution": "该问题要求我们在伪谱方法的背景下分析混叠现象。给定两个正弦函数 $u(x)$ 和 $v(x)$，我们需要在两种不同的计算场景下，确定它们乘积 $w(x)=u(x)v(x)$ 中和声波的波数。\n\n这两个函数由 $u(x) = \\sin(kx)$ 和 $v(x) = \\sin(\\ell x)$ 给出，其整数波数为 $k=\\frac{N}{2}-1$ 和 $\\ell=\\frac{N}{2}-2$。这里，$N$ 是区间 $[0, 2\\pi)$ 上等距网格点的数量，并且是一个偶数。\n\n首先，我们使用三角积化和差恒等式来确定乘积 $w(x)$ 的解析形式：\n$$ \n\\sin(A)\\sin(B) = \\frac{1}{2}\\left[\\cos(A-B) - \\cos(A+B)\\right] \n$$\n将此恒等式应用于 $w(x)=u(x)v(x)$，我们得到：\n$$ \nw(x) = \\sin(kx)\\sin(\\ell x) = \\frac{1}{2}\\left[\\cos((k-\\ell)x) - \\cos((k+\\ell)x)\\right] \n$$\n这表明乘积 $w(x)$ 是两个余弦波的叠加。这些分量的波数分别是差声波 $m_{\\text{diff}} = k-\\ell$ 和和声波 $m_{\\text{sum}} = k+\\ell$。\n\n代入 $k$ 和 $\\ell$ 的给定值：\n$$ \nm_{\\text{diff}} = k-\\ell = \\left(\\frac{N}{2}-1\\right) - \\left(\\frac{N}{2}-2\\right) = 1 \n$$\n$$ \nm_{\\text{sum}} = k+\\ell = \\left(\\frac{N}{2}-1\\right) + \\left(\\frac{N}{2}-2\\right) = N-3 \n$$\n因此，精确的解析乘积是 $w(x) = \\frac{1}{2}\\left[\\cos(x) - \\cos((N-3)x)\\right]$。高频和声波对应于项 $\\cos((N-3)x)$，该项由波数为 $\\pm(N-3)$ 的复指数组成。\n\n**第 1 部分：$N$ 点网格上的混叠波数**\n\n$N$ 点网格上的伪谱方法只能无歧义地表示有限的一组波数。问题将此集合（主集）指定为 $\\{-\\frac{N}{2}+1, \\ldots, \\frac{N}{2}\\}$。任何在此集合之外的波数 $m$ 都会混叠到集合内的一个波数 $m_{\\text{alias}}$，其中 $m_{\\text{alias}}$ 与 $m$ 模 $N$ 同余。也就是说，$m_{\\text{alias}} = m + qN$，对于某个整数 $q$，使得 $m_{\\text{alias}}$ 位于主集中。\n\n高频和声波的真实波数为 $m = N-3$。我们需要在主集中找到它的混叠别名。我们在寻找一个整数 $q$，使得 $-\\frac{N}{2}+1 \\le (N-3) + qN \\le \\frac{N}{2}$。\n选择 $q=-1$，我们得到：\n$$ m_{\\text{alias}} = (N-3) - N = -3 $$\n我们必须验证这个混叠波数位于主集 $\\{-\\frac{N}{2}+1, \\ldots, \\frac{N}{2}\\}$ 内。条件是 $-\\frac{N}{2}+1 \\le -3$。这可以简化为 $4 \\le \\frac{N}{2}$，即 $N \\ge 8$。该问题是为一般的偶数 $N$ 提出的，并且波数 $k$ 和 $\\ell$ 被选择得接近奈奎斯特频率 $\\frac{N}{2}$，这是混叠成为主要问题的场景的特征。对于较小的 $N$（例如，$N=4$ 或 $N=6$），和声波 $N-3$ 可能落入主集中，这意味着该特定分量不会发生混叠。然而，由混叠控制规则的上下文所暗示的一般情况是，对于足够大的 $N$，和声波会落在可表示范围之外。因此，假设 $N \\ge 8$，由和声波 $k+\\ell=N-3$ 产生的混叠波数是 $m_{\\text{alias}} = -3$。\n\n**第 2 部分：使用三分之二规则的未混叠波数**\n\n问题的第二部分要求给出和声波的未混叠、真实波数。所提供的背景是“三分之二”去混叠规则，这是一个旨在无混叠地计算非线性乘积的程序。该程序涉及用零填充函数的光谱表示以提高分辨率，在更精细的物理网格（$P=\\frac{3N}{2}$ 个点）上执行乘积，然后进行逆变换。\n\n问题是：“确定截断前和声波的未混叠高频波数指数（即，整数波数线上的真实和声波指数）”。这个问题的括号部分明确定义了所求的量：它是存在于解析乘积中的和声波分量的真实波数，在考虑任何离散网格效应（如混叠）之前。这种去混叠程序是人们试图数值计算这个真实值时会使用的工具。问题要求的是这个计算的理论目标。\n\n根据积化和差恒等式确定，真实的和声波是 $m_{\\text{sum}} = k+\\ell$。\n$$ \nm_{\\text{true}} = k+\\ell = \\left(\\frac{N}{2}-1\\right) + \\left(\\frac{N}{2}-2\\right) = N-3 \n$$\n这是精确解中高频分量的波数。去混叠规则的目的是准确地捕捉这个分量。虽然对于给定的特定高波数，如果 $N \\ge 12$（因为真实波数 $N-3$ 会超过填充网格的奈奎斯特极限 $P/2 = 3N/4$），$P=\\frac{3N}{2}$ 网格可能不足以防止混叠，但问题要求的是这个程序*意图*找到的值，也就是真实的解析波数。\n\n因此，真实的高频和声波指数是 $m_{\\text{true}} = N-3$。\n\n**结果总结**\n$N$ 点网格上的混叠波数指数是 $m_{\\text{alias}} = -3$。\n真实的高频和声波指数是 $m_{\\text{true}} = N-3$。\n\n最终答案要求以行矩阵 $\\begin{pmatrix} m_{\\text{alias}} & m_{\\text{true}} \\end{pmatrix}$ 的形式给出。", "answer": "$$ \\boxed{ \\begin{pmatrix} -3 & N-3 \\end{pmatrix} } $$", "id": "3423339"}, {"introduction": "将去混叠的原理从傅里叶谱方法推广到基于多项式的数值方法（如间断伽辽金方法）是至关重要的。本练习 [@problem_id:3423327] 探讨了一个包含线性和二次非线性项的反应-平流方程。通过分析弱形式中各项积分的精确度要求，你将学会如何判断哪些项需要通过过积分（overintegration）来控制混叠，而哪些项则不需要，这在优化计算效率方面是一个关键技能。", "problem": "考虑一个一维反应-平流初值问题，定义在周期性区间上，坐标为 $x \\in [0,1]$，时间为 $t \\ge 0$，\n$$\n\\partial_t u(x,t) + a\\,\\partial_x u(x,t) = R(u(x,t)), \\quad R(u) = \\beta\\,u^2,\n$$\n其中 $a \\in \\mathbb{R}$ 和 $\\beta \\in \\mathbb{R}$ 是常数。解 $u$ 在每个单元中由一个 $N$ 次多项式 $u_h$ 来近似，空间离散化采用间断Galerkin (DG) 方法，并使用 $N$ 次的标准节点基。体积分使用高斯-洛巴托-勒让德求积进行计算，每个单元有 $n_q$ 个节点。对于高斯-洛巴托-勒让德求积，一个经过充分检验的事实是，次数不高于 $2 n_q - 3$ 的多项式被积函数可以被精确积分。\n\n在基于多项式的谱方法/DG离散化中，当非线性被积函数被欠积分（即，求积公式不能精确积分由离散非线性运算产生的多项式次数）时，会产生混叠现象。过积分通过增加 $n_q$ 来减轻混叠，使得求积公式能够精确积分体积分中出现的最高次多项式。所谓的“三分之二法则”指的是，对于二次非线性项，选择一个求积点数满足 $n_q \\approx \\tfrac{3}{2}(N+1)$ 的求积法则。\n\n从 DG 弱形式和被积函数的多项式次数结构出发，判断是必须对二次反应项 $R(u_h)$ 和平流项都应用三分之二过积分，还是选择性过积分就足够了。假设 $a$ 是一个常数，界面上的数值通量是一致且稳定的，并关注单元内部体积分中的混叠问题。\n\n哪个陈述是正确的？\n\nA. 对于 $N$ 次 DG 方法，二次反应项 $R(u_h)$ 和线性平流项都需要三分之二过积分来避免体积分中的混叠。\n\nB. 只有二次反应项 $R(u_h)$ 需要三分之二过积分；线性平流项可以被标准的 $n_q = N+1$ 高斯-洛巴托-勒让德求积精确积分，因此平流项不需要过积分。\n\nC. 只有平流项需要三分之二过积分，因为 $\\partial_x u_h$ 中的导数使得多项式次数超出了 $n_q = N+1$ 高斯-洛巴托-勒让德求积的精确积分极限。\n\nD. 两个项都不需要过积分；对于光滑解，标准的 $n_q = N+1$ 高斯-洛巴托-勒让德求积足以避免反应项和平流项中的混叠。", "solution": "用户需要对问题陈述进行严格验证，然后给出详细的解题过程和对所提供选项的评估。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n-   **方程**：一维反应-平流初值问题由 $\\partial_t u(x,t) + a\\,\\partial_x u(x,t) = R(u(x,t))$ 给出，其中反应项为 $R(u) = \\beta\\,u^2$。\n-   **定义域**：空间坐标为 $x \\in [0,1]$，具有周期性边界条件，时间为 $t \\ge 0$。\n-   **常数**：$a \\in \\mathbb{R}$ 和 $\\beta \\in \\mathbb{R}$ 是常数。\n-   **数值近似**：解 $u$ 在每个单元中由一个 $N$ 次多项式 $u_h$ 来近似。\n-   **离散化方法**：空间离散化采用间断 Galerkin (DG) 方法，并使用 $N$ 次的标准节点基。\n-   **求积法则**：体积分使用高斯-洛巴托-勒让德 (GLL) 求积进行计算，每个单元有 $n_q$ 个节点。\n-   **求积精确性**：GLL 求积被陈述为可以精确积分次数至多为 $2 n_q - 3$ 的多项式被积函数。\n-   **过积分法则**：“三分之二法则”被定义为对二次非线性项选择一个求积点数满足 $n_q \\approx \\tfrac{3}{2}(N+1)$ 的求积法则。\n-   **问题**：任务是判断是否需要对二次反应项 $R(u_h)$ 和/或平流项应用三分之二过积分，特别关注单元内部体积分中的混叠。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n-   **科学依据**：该问题在数值分析领域有坚实的基础，特别是关于求解偏微分方程的谱方法和间断 Galerkin 方法。该方程是一个标准的模型问题（平流-反应），并且多项式近似、DG 弱形式、求积、混叠和三分之二法则等概念都是基础且被准确描述的。GLL 求积对于次数 $\\le 2 n_q - 3$ 的多项式具有精确性的性质是正确的。\n-   **适定性**：该问题是适定的。它要求确定弱形式中的哪些项需要过积分才能被精确计算。这可以通过分析被积函数的多项式次数来回答，这是一个标准且定义明确的程序。\n-   **客观性**：问题以精确、客观和标准的数学语言陈述。没有主观或基于观点的元素。\n-   **缺陷清单**：该问题没有违反任何无效性标准。它在科学上是合理的，可形式化的，对于所提问题是完整的，在其背景下是现实的，结构良好，并且不是微不足道的。\n\n**第 3 步：结论与行动**\n\n问题陈述是**有效的**。将推导一个完整的解。\n\n### 推导过程\n\n问题的核心是确定 DG 弱形式中被积函数的多项式次数，并将其与求积法则的精度阶进行比较。DG 弱形式是通过将偏微分方程乘以一个测试函数 $v_h$ 并在单个单元 $\\Omega_k$ 上积分得到的。在次数至多为 $N$ 的多项式空间（记为 $\\mathcal{P}^N$）中，近似解 $u_h$ 和测试函数 $v_h$ 都属于 $\\mathcal{P}^N$。\n\n单元 $\\Omega_k$ 上的半离散弱形式为：\n$$\n\\int_{\\Omega_k} (\\partial_t u_h) v_h \\, dx + \\int_{\\Omega_k} (a\\,\\partial_x u_h) v_h \\, dx - \\int_{\\Omega_k} R(u_h) v_h \\, dx + \\text{surface terms} = 0\n$$\n问题明确指出我们关注单元内部的**体积分**。需要通过求积计算的体积分是针对平流项和反应项的。我们来逐一分析。\n\n**1. 二次反应项分析**\n\n反应项的体积分是：\n$$\n\\int_{\\Omega_k} R(u_h) v_h \\, dx = \\int_{\\Omega_k} (\\beta u_h^2) v_h \\, dx\n$$\n被积函数为 $I_R(x) = \\beta \\, u_h(x)^2 v_h(x)$。我们必须确定它的多项式次数。\n-   近似解 $u_h$ 是一个次数至多为 $N$ 的多项式，所以 $u_h \\in \\mathcal{P}^N$。\n-   $u_h$ 的平方，即 $u_h^2$，是一个次数至多为 $N+N = 2N$ 的多项式。\n-   测试函数 $v_h$ 也是一个次数至多为 $N$ 的多项式，所以 $v_h \\in \\mathcal{P}^N$。\n-   因此，被积函数 $I_R = \\beta u_h^2 v_h$ 是一个次数至多为 $2N + N = 3N$ 的多项式。\n\n为了精确计算这个积分，求积法则必须对次数为 $3N$ 的多项式精确。根据问题陈述，具有 $n_q$ 个点的 GLL 求积对次数高达 $2n_q - 3$ 的多项式被积函数是精确的。因此，我们需要：\n$$\n2n_q - 3 \\ge 3N\n$$\n$$\n2n_q \\ge 3N + 3\n$$\n$$\nn_q \\ge \\frac{3N + 3}{2} = \\frac{3}{2}(N+1)\n$$\n这恰好是三分之二法则。对于 $N$ 次节点基，标准求积使用 $n_q = N+1$ 个点。由于对于任何 $N \\ge 0$ 都有 $N+1  \\frac{3}{2}(N+1)$，标准求积是不够的。因此，为了避免混叠，二次反应项需要根据三分之二法则进行过积分。\n\n**2. 线性平流项分析**\n\n平流项的体积分是：\n$$\n\\int_{\\Omega_k} (a\\,\\partial_x u_h) v_h \\, dx\n$$\n被积函数为 $I_A(x) = a \\, (\\partial_x u_h(x)) v_h(x)$。我们确定它的多项式次数。\n-   近似解 $u_h$ 是一个次数至多为 $N$ 的多项式，所以 $u_h \\in \\mathcal{P}^N$。\n-   它的空间导数 $\\partial_x u_h$ 是一个次数至多为 $N-1$ 的多项式，所以 $\\partial_x u_h \\in \\mathcal{P}^{N-1}$。\n-   测试函数 $v_h$ 是一个次数至多为 $N$ 的多项式，所以 $v_h \\in \\mathcal{P}^N$。\n-   因此，被积函数 $I_A = a (\\partial_x u_h) v_h$ 是一个次数至多为 $(N-1) + N = 2N-1$ 的多项式。\n\n为了精确计算这个积分，求积法则必须对次数为 $2N-1$ 的多项式精确。我们需要：\n$$\n2n_q - 3 \\ge 2N-1\n$$\n$$\n2n_q \\ge 2N + 2\n$$\n$$\nn_q \\ge N+1\n$$\n对于 $N$ 次节点 DG 方法，一个标准的选择是同时使用 $N+1$ 个高斯-洛巴托-勒让德节点来表示基函数和作为求积规则。因此，对于标准 DG，我们有 $n_q = N+1$。这个选择恰好满足条件 $n_q \\ge N+1$。因此，标准求积足以精确积分平流项的体积分，不需要过积分。\n\n（注：如果使用平流积分的“弱”形式，即 $-\\int_{\\Omega_k} (a u_h) (\\partial_x v_h) dx$，被积函数 $u_h (\\partial_x v_h)$ 的次数也将是 $N + (N-1) = 2N-1$，从而得出相同的结论。）\n\n**推导结论**\n\n-   二次反应项产生一个次数为 $3N$ 的多项式被积函数，需要 $n_q \\ge \\frac{3}{2}(N+1)$ 个点才能精确积分。这使得应用三分之二过积分法则是必要的。\n-   线性平流项产生一个次数为 $2N-1$ 的多项式被积函数，需要 $n_q \\ge N+1$ 个点。这恰好被 $n_q=N+1$ 个求积点的标准选择所满足，因此该项不需要过积分。\n\n### 选项评估\n\n**A. 对于 $N$ 次 DG 方法，二次反应项 $R(u_h)$ 和线性平流项都需要三分之二过积分来避免体积分中的混叠。**\n这是**不正确的**。根据推导，线性平流项产生的被积函数次数为 $2N-1$，可以被标准的 $n_q = N+1$ 求积精确积分。它不需要三分之二过积分。\n\n**B. 只有二次反应项 $R(u_h)$ 需要三分之二过积分；线性平流项可以被标准的 $n_q = N+1$ 高斯-洛巴托-勒让德求积精确积分，因此平流项不需要过积分。**\n这是**正确的**。该陈述准确地反映了推导结果。反应项需要 $n_q \\ge \\frac{3}{2}(N+1)$，而平流项只需要 $n_q \\ge N+1$，这被标准求积所满足。\n\n**C. 只有平流项需要三分之二过积分，因为 $\\partial_x u_h$ 中的导数使得多项式次数超出了 $n_q = N+1$ 高斯-洛巴托-勒让德求积的精确积分极限。**\n这是**不正确的**。该陈述包含两个基本错误。首先，多项式的微分会*降低*其次数，而不是增加。其次，需要过积分的是反应项，而不是平流项。\n\n**D. 两个项都不需要过积分；对于光滑解，标准的 $n_q = N+1$ 高斯-洛巴托-勒让德求积足以避免反应项和平流项中的混叠。**\n这是**不正确的**。二次反应项 $R(u_h) = \\beta u_h^2$ 导致一个次数为 $3N$ 的三次多项式乘积 $u_h^2 v_h$。使用 $n_q=N+1$ 的标准求积仅对次数最高为 $2(N+1)-3 = 2N-1$ 的多项式是精确的。由于对于所有 $N \\ge 0$ 都有 $3N > 2N-1$，标准求积对于反应项总是不足的。真实解析解 $u$ 的光滑性与数值方法中离散多项式乘积产生的混叠误差无关。", "answer": "$$\\boxed{B}$$", "id": "3423327"}, {"introduction": "混叠误差最严重的影响之一是它可能破坏离散格式所应遵循的基本守恒律。本练习 [@problem_id:3423344] 提供了一个具体的计算实验，通过对无粘伯格斯方程的间断伽辽金离散，你将亲眼见证积分不足（underintegration）如何导致离散能量不守恒。更重要的是，你将通过实施三分之二过积分规则，数值验证该守恒律是如何被精确恢复的，从而深刻体会到去混叠在保证模拟物理真实性中的核心作用。", "problem": "构建一个最小化的、纯数学的测试，以展示在间断 Galerkin (DG) 方法中，混叠误差如何破坏一个守恒不变量，以及三分之二超积分法则如何恢复周期性边界条件下的精确离散守恒性。考虑在周期性域上的无粘性 Burgers 方程，该域被映射到参考区间 $[-1,1]$：\n$$\n\\partial_t u + \\partial_x \\left(\\tfrac{1}{2} u^2 \\right) = 0.\n$$\n在单个参考单元上，使用一个带有 Legendre 多项式基 $\\{P_k(x)\\}_{k=0}^N$ 的模态间断 Galerkin (DG) 方法。假设采用周期性边界条件，从而在半离散格式中，表面项的贡献恒为零。在弱形式下，系数 $\\{\\hat{u}_k(t)\\}_{k=0}^N$ 的半离散方程为\n$$\n\\sum_{j=0}^N M_{ij} \\frac{d \\hat{u}_j}{dt} = - \\int_{-1}^1 \\frac{d P_i}{dx}(x)\\, \\tfrac{1}{2} u_h(x)^2 \\, dx, \\quad i=0,\\dots,N,\n$$\n其中 $u_h(x) = \\sum_{k=0}^N \\hat{u}_k P_k(x)$，且 $M_{ij} = \\int_{-1}^1 P_i(x) P_j(x) \\, dx$ 是质量矩阵。由于 Legendre 多项式的正交性，$i \\neq j$ 时 $M_{ij} = 0$，$M_{ii} = \\tfrac{2}{2i+1}$。\n\n对于周期域上的光滑解，该连续方程守恒一个二次不变量（能量）\n$$\nE(t) = \\tfrac{1}{2} \\int_{-1}^1 u(x,t)^2 \\, dx.\n$$\n在采用精确体积积分的 DG 半离散化中，离散能量\n$$\nE_h(t) = \\tfrac{1}{2} \\sum_{i=0}^N \\sum_{j=0}^N \\hat{u}_i(t) \\, M_{ij} \\, \\hat{u}_j(t) = \\tfrac{1}{2} \\sum_{i=0}^N \\tfrac{2}{2i+1} \\, \\hat{u}_i(t)^2\n$$\n对于光滑解也同样守恒。然而，如果非线性体积积分通过欠积分求积法进行计算，混叠效应会破坏精确的离散守恒性，导致在 $t=0$ 时产生一个非零的离散能量导数。三分之二超积分法则要求使用具有足够节点的 Gauss-Legendre 求积，以便对于二次非线性项，能够精确积分最高达 $3N-1$ 次的多项式积分，即选择求积点数 $Q$ 满足 $2Q-1 \\ge 3N-1$，也就是 $Q \\ge \\lceil \\tfrac{3N}{2} \\rceil$。\n\n从模态 DG 弱形式、Gauss-Legendre 求积和 Legendre 多项式正交性的核心定义出发，实现以下最小化测试。\n\n1. 固定一个多项式阶数 $N \\in \\mathbb{N}$ 和一个多项式子空间中的初始条件\n$$\nu_h(x,0) = \\sum_{k=0}^N \\hat{u}_k(0)\\, P_k(x), \\quad \\hat{u}_k(0) = \\frac{(-1)^k}{k+1}.\n$$\n2. 使用具有 $Q$ 个点的 Gauss-Legendre 求积来组装右端项：\n$$\nK_i(Q) \\approx \\sum_{q=1}^Q w_q \\, \\frac{dP_i}{dx}(x_q)\\, \\tfrac{1}{2} \\left(u_h(x_q,0)\\right)^2,\n$$\n其中 $\\{x_q,w_q\\}_{q=1}^Q$ 是 Gauss-Legendre 节点和权重。通过下式定义半离散系数的时间导数：\n$$\n\\frac{d \\hat{u}_i}{dt}(0;Q) = - M_{ii}^{-1} \\, K_i(Q), \\quad i=0,\\dots,N.\n$$\n3. 计算 $t=0$ 时的离散能量时间导数：\n$$\n\\frac{d E_h}{dt}(0;Q) = \\sum_{i=0}^N \\frac{2}{2i+1} \\, \\hat{u}_i(0) \\, \\frac{d \\hat{u}_i}{dt}(0;Q) = - \\sum_{i=0}^N \\hat{u}_i(0) \\, K_i(Q).\n$$\n4. 对每个给定的 $N$，使用两种求积选择来评估 $\\tfrac{d E_h}{dt}(0;Q)$：\n   - 欠积分：$Q_{\\text{under}} = N+1$。\n   - 三分之二超积分：$Q_{3/2} = \\lceil \\tfrac{3N}{2} \\rceil$。\n   使用精确算术，后者对于光滑数据应得出 $\\tfrac{d E_h}{dt}(0;Q_{3/2}) = 0$；有限精度计算应得到一个接近机器精度的值。\n\n5. 使用以下多项式阶数的测试套件：\n   - 情况 A（一般情况）：$N=3$。\n   - 情况 B（偶数阶）：$N=4$。\n   - 情况 C（高阶压力测试）：$N=7$。\n\n对于每种情况，产生两个布尔值结果：\n- $b_1$：$|\\tfrac{d E_h}{dt}(0;Q_{\\text{under}})|  10^{-10}$ 是否成立（检测到混叠导致的能量不守恒）。\n- $b_2$：$|\\tfrac{d E_h}{dt}(0;Q_{3/2})|  10^{-12}$ 是否成立（通过三分之二超积分恢复了能量守恒）。\n\n您的程序应生成单行输出，其中包含三种情况下六个布尔值结果，顺序为 $[b_1^{(A)}, b_2^{(A)}, b_1^{(B)}, b_2^{(B)}, b_1^{(C)}, b_2^{(C)}]$，形式为一个用逗号分隔并用方括号括起来的列表，例如 $[{\\rm True},{\\rm True},{\\rm True},{\\rm True},{\\rm True},{\\rm True}]$。\n\n本问题不涉及任何物理单位。所有计算都是纯无量纲的，并且在任何涉及正交多项式求值的角度解释中都必须隐式使用弧度（尽管这里没有直接使用角度）。", "solution": "该问题要求构建一个数值测试，以展示在间断 Galerkin (DG) 方法中由混叠引起的守恒量破坏现象，以及如何通过三分之二超积分法则将其恢复。模型是一维无粘性 Burgers 方程，$\\partial_t u + \\partial_x \\left(\\tfrac{1}{2} u^2 \\right) = 0$，定义在单个周期性参考单元 $[-1,1]$ 上。\n\n采用模态 DG 方法，基函数为 Legendre 多项式 $\\{P_k(x)\\}_{k=0}^N$。近似解为 $u_h(x,t) = \\sum_{k=0}^N \\hat{u}_k(t) P_k(x)$。模态系数 $\\hat{u}_i(t)$ 演化的半离散弱形式由下式给出：\n$$\nM_{ij} \\frac{d \\hat{u}_j}{dt} = - \\int_{-1}^1 \\frac{d P_i}{dx}(x)\\, \\tfrac{1}{2} u_h(x)^2 \\, dx\n$$\n其中隐含了对重复指标的求和。质量矩阵为 $M_{ij} = \\int_{-1}^1 P_i(x) P_j(x) \\, dx$。由于 Legendre 多项式的正交性，$M_{ij} = \\delta_{ij} \\frac{2}{2i+1}$。\n\n连续方程守恒能量 $E(t) = \\tfrac{1}{2} \\int_{-1}^1 u(x,t)^2 \\, dx$。相应的离散能量为：\n$$\nE_h(t) = \\tfrac{1}{2} \\int_{-1}^1 u_h(x,t)^2 \\, dx = \\tfrac{1}{2} \\int_{-1}^1 \\left(\\sum_i \\hat{u}_i P_i\\right) \\left(\\sum_j \\hat{u}_j P_j\\right) dx = \\tfrac{1}{2} \\sum_{i,j} \\hat{u}_i \\hat{u}_j M_{ij} = \\tfrac{1}{2} \\sum_{i=0}^N \\frac{2}{2i+1} \\hat{u}_i(t)^2\n$$\n离散能量的时间导数为：\n$$\n\\frac{d E_h}{dt} = \\sum_{i=0}^N \\frac{2}{2i+1} \\hat{u}_i \\frac{d \\hat{u}_i}{dt} = \\sum_{i=0}^N \\hat{u}_i \\left( M_{ii} \\frac{d \\hat{u}_i}{dt} \\right)\n$$\n代入半离散方程：\n$$\n\\frac{d E_h}{dt} = \\sum_{i=0}^N \\hat{u}_i \\left( - \\int_{-1}^1 \\frac{dP_i}{dx} \\frac{1}{2} u_h^2 \\, dx \\right) = - \\int_{-1}^1 \\left( \\sum_{i=0}^N \\hat{u}_i \\frac{dP_i}{dx} \\right) \\frac{1}{2} u_h^2 \\, dx\n$$\n注意到 $\\sum_{i=0}^N \\hat{u}_i \\frac{dP_i}{dx} = \\frac{d}{dx} \\left( \\sum_{i=0}^N \\hat{u}_i P_i \\right) = \\frac{du_h}{dx}$，我们有：\n$$\n\\frac{d E_h}{dt} = - \\frac{1}{2} \\int_{-1}^1 u_h^2 \\frac{du_h}{dx} \\, dx = - \\frac{1}{2} \\int_{-1}^1 \\frac{d}{dx} \\left(\\frac{1}{3} u_h^3 \\right) dx = - \\frac{1}{6} \\left[ u_h^3(x) \\right]_{-1}^1\n$$\n对于周期性边界条件，$u_h(1) = u_h(-1)$，因此 $\\frac{dE_h}{dt} = 0$。这证实了如果体积积分被精确计算，离散能量是守恒的。\n\n数值方法通常使用求积法来近似积分。我们将右端项积分记为 $R_i = \\int_{-1}^1 \\frac{dP_i}{dx} \\frac{1}{2} u_h^2 \\, dx$，它使用具有 $Q$ 个点 $\\{x_q, w_q\\}$ 的 Gauss-Legendre 求积法进行近似：\n$$\nK_i(Q) = \\sum_{q=1}^Q w_q \\, \\frac{dP_i}{dx}(x_q)\\, \\tfrac{1}{2} \\left(u_h(x_q)\\right)^2\n$$\n被积函数是一个多项式。由于 $u_h(x)$ 是一个 $N$ 次多项式，所以 $u_h(x)^2$ 是一个 $2N$ 次多项式。Legendre 多项式的导数 $\\frac{dP_i}{dx}$ 是一个 $i-1$ 次多项式。因此，被积函数 $\\frac{dP_i}{dx} u_h^2$ 是一个最高次数为 $2N + (i-1)$ 的多项式，当 $i=N$ 时，最大次数为 $3N-1$。\n\n一个具有 $Q$ 个点的 Gauss-Legendre 求积法则能精确地积分最高 $2Q-1$ 次的多项式。为了确保对所有 $i=0,\\dots,N$ 的积分都是精确的，我们需要 $2Q-1 \\ge 3N-1$，化简为 $Q \\ge \\frac{3N}{2}$。由于 $Q$ 必须是整数，条件为 $Q \\ge \\lceil \\frac{3N}{2} \\rceil$。这就是针对二次非线性项的“三分之二法则”。\n\n当不满足此规则时，例如仅使用 $Q=N+1$ 个点（这对于线性问题是足够的），求积是不精确的。这种不精确性被称为混叠误差。它会引入虚假的能量产生或耗散，导致计算出的 $\\frac{dE_h}{dt}$ 值为非零。\n\n该实现计算了在 $t=0$ 时的离散能量导数 $\\frac{d E_h}{dt}(0;Q) = - \\sum_{i=0}^N \\hat{u}_i(0) K_i(Q)$，初始条件为 $\\hat{u}_k(0) = \\frac{(-1)^k}{k+1}$。算法如下：\n1. 对于给定的多项式阶数 $N$ 和求积点数 $Q$，获取 $[-1,1]$ 上的 Gauss-Legendre 节点 $x_q$ 和权重 $w_q$。\n2. 定义大小为 $N+1$ 的初始模态系数向量 $\\hat{\\mathbf{u}}(0)$。\n3. 对每个节点 $x_q$，计算所有 $k=0,\\dots,N$ 的基多项式 $P_k(x_q)$ 及其导数 $\\frac{dP_k}{dx}(x_q)$。将这些值存储在矩阵中，例如大小为 $(N+1) \\times Q$ 的矩阵 $\\mathbf{P}$ 和大小为 $(N+1) \\times Q$ 的矩阵 $\\mathbf{P'}$。\n4. 计算在求积节点处的解值：$u_h(x_q,0) = \\sum_{k=0}^N \\hat{u}_k(0) P_k(x_q)$。以向量形式表示，即 $\\mathbf{u}_h = \\mathbf{P}^T \\hat{\\mathbf{u}}(0)$。\n5. 计算每个节点处的非线性通量项：$F_q = \\frac{1}{2} u_h(x_q,0)^2$。\n6. 组装通过求积近似的积分向量 $\\mathbf{K}(Q)$：$K_i(Q) = \\sum_{q=1}^Q w_q P'_{iq} F_q$。\n7. 最后，通过点积计算能量导数：$\\frac{dE_h}{dt}(0;Q) = - \\hat{\\mathbf{u}}(0)^T \\mathbf{K}(Q)$。\n\n此过程对每个测试案例（$N=3, 4, 7$）执行两次，使用两种不同的求积规则：\n-   欠积分：$Q_{\\text{under}} = N+1$。测试期望发现一个显著的非零能量导数，即 $|\\frac{dE_h}{dt}|  10^{-10}$。\n-   超积分：$Q_{3/2} = \\lceil \\frac{3N}{2} \\rceil$。测试期望能量导数在机器精度范围内为零，即 $|\\frac{dE_h}{dt}|  10^{-12}$，这表明守恒性质已恢复。\n这些检查的布尔结果证实了关于混叠及其控制的理论预测。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_energy_derivative(N, Q):\n    \"\"\"\n    Calculates the discrete energy time derivative for the DG-discretized\n    Burgers equation using Q-point Gauss-Legendre quadrature.\n\n    Args:\n        N (int): The polynomial degree of the DG basis.\n        Q (int): The number of quadrature points.\n\n    Returns:\n        float: The value of dE_h/dt at t=0.\n    \"\"\"\n    # 1. Get Gauss-Legendre quadrature points and weights for the interval [-1, 1]\n    x_q, w_q = np.polynomial.legendre.leggauss(Q)\n\n    # 2. Get initial modal coefficients u_k(0)\n    u_hat_0 = np.array([((-1.0)**k) / (k + 1.0) for k in range(N + 1)])\n\n    # 3. Evaluate basis polynomials P_k(x_q) and their derivatives dP_k/dx(x_q)\n    # P_mat will store P_k(x_q) in entry (k, q)\n    # P_prime_mat will store dP_k/dx(x_q) in entry (k, q)\n    P_mat = np.zeros((N + 1, Q))\n    P_prime_mat = np.zeros((N + 1, Q))\n\n    for k in range(N + 1):\n        # Create Legendre basis polynomial P_k\n        leg_poly_k = np.polynomial.legendre.Legendre.basis(k)\n        # Evaluate P_k at all quadrature points\n        P_mat[k, :] = leg_poly_k(x_q)\n        \n        # Get the derivative polynomial dP_k/dx\n        leg_poly_k_deriv = leg_poly_k.deriv()\n        # Evaluate dP_k/dx at all quadrature points\n        P_prime_mat[k, :] = leg_poly_k_deriv(x_q)\n\n    # 4. Evaluate u_h(x_q, 0) at each quadrature node\n    # u_h(x_q, 0) = sum_k u_hat_k(0) * P_k(x_q)\n    u_h_at_q = P_mat.T @ u_hat_0\n    \n    # 5. Compute the nonlinear function F(q) = 0.5 * u_h(x_q, 0)^2\n    F_q = 0.5 * u_h_at_q**2\n\n    # 6. Compute K_i(Q) vector using quadrature\n    # K_i = sum_q w_q * dP_i/dx(x_q) * F(q)\n    K = P_prime_mat @ (w_q * F_q)\n\n    # 7. Compute the discrete energy time derivative\n    # dE_h/dt = - sum_i u_hat_i(0) * K_i\n    dE_h_dt = -np.dot(u_hat_0, K)\n\n    return dE_h_dt\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        3,  # Case A: N=3\n        4,  # Case B: N=4\n        7,  # Case C: N=7\n    ]\n\n    results = []\n    for N in test_cases:\n        # Underintegrated case\n        Q_under = N + 1\n        dE_dt_under = calculate_energy_derivative(N, Q_under)\n        b1 = abs(dE_dt_under) > 1e-10\n        results.append(b1)\n        \n        # Three-halves overintegrated case\n        Q_3_2 = int(np.ceil(3.0 * N / 2.0))\n        dE_dt_3_2 = calculate_energy_derivative(N, Q_3_2)\n        b2 = abs(dE_dt_3_2)  1e-12\n        results.append(b2)\n\n    # Final print statement in the exact required format.\n    # The output format for boolean values is 'True' or 'False'.\n    boolean_strings = [str(b) for b in results]\n    print(f\"[{','.join(boolean_strings)}]\")\n\nsolve()\n```", "id": "3423344"}]}