{"hands_on_practices": [{"introduction": "施加本质边界条件（狄利克雷条件）是计算力学中的一项基本操作，其中罚函数法是一种常见且易于实现的技术。此方法通过在系统中引入一个非常大的“弹簧”刚度来近似约束，但这种简便性带来了数值上的权衡。本练习将通过分析推导，揭示罚参数如何影响系统刚度矩阵的条件数，从而帮助您理解该方法在实践中可能遇到的数值病态问题及其根源。[@problem_id:3563169]", "problem": "考虑一根长度为 $h$、杨氏模量为 $E$、单位横截面积的一维等截面线性弹性杆，占据区间 $x \\in [0,h]$。其位移 $u(x)$ 由虚功原理导出的平衡方程决定，对称双线性形式为\n$$\na(u,v) \\;=\\; \\int_{0}^{h} E \\, u'(x)\\, v'(x)\\, dx \\;+\\; \\alpha\\, u(0)\\, v(0),\n$$\n且外功的线性泛函置为零。含有 $\\alpha > 0$ 的项通过模拟一个连接在 $x=0$ 处的非常刚硬的弹簧来惩罚对本质边界条件 $u(0)=0$ 的违反，而右端 $x=h$ 是无应力的，这是一个自然边界条件。\n\n使用标准的双节点线性有限元将杆离散化，节点位移为 $u_1 \\approx u(0)$ 和 $u_2 \\approx u(h)$。使用双线性形式的定义，组装对应于二次型 $a(\\cdot,\\cdot)$ 的离散 $2 \\times 2$ 刚度矩阵，并观察惩罚刚度 $\\alpha$ 如何进入代数系统。将所得矩阵记为 $K(\\alpha,E,h)$，并将其在欧几里得范数下的条件数（谱条件数）定义为\n$$\n\\kappa_2\\big(K(\\alpha,E,h)\\big) \\;=\\; \\frac{\\lambda_{\\max}\\big(K(\\alpha,E,h)\\big)}{\\lambda_{\\min}\\big(K(\\alpha,E,h)\\big)},\n$$\n其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是最大和最小特征值。从第一性原理出发，不假设任何关于特征值或条件数的已有公式，推导出 $K(\\alpha,E,h)$ 的两个特征值的精确解析表达式，然后在 $E$ 和 $h$ 保持不变的情况下，当 $\\alpha \\to \\infty$ 时，求出其主阶渐近表达式。\n\n你的最终答案必须是条件数增长的主阶渐近表达式，以 $\\alpha$、$E$ 和 $h$ 的闭式函数形式给出。最终答案中不要包含任何单位。条件数是无量綱的。", "solution": "问题陈述已经过验证，并被确定为有效。它具有科学依据，是适定的、客观的，并且不含任何矛盾或歧义。我们可以继续进行解答。\n\n该问题要求推导一维杆单元刚度矩阵条件数的主阶渐近表达式，其中本质边界条件是通过罚函数法施加的。\n\n首先，我们使用一个双节点线性有限元对域 $x \\in [0, h]$ 上的位移场 $u(x)$ 进行离散化。节点位于 $x=0$ 和 $x=h$ 处。节点位移分别表示为 $u_1$ 和 $u_2$。插值位移场由下式给出：\n$$u(x) = N_1(x) u_1 + N_2(x) u_2,$$\n其中 $N_1(x)$ 和 $N_2(x)$ 是线性形函数。对于一个定义在 $[0, h]$ 上长度为 $h$ 的单元，它们是：\n$$N_1(x) = 1 - \\frac{x}{h}$$\n$$N_2(x) = \\frac{x}{h}$$\n形函数关于 $x$ 的导数是常数：\n$$N_1'(x) = -\\frac{1}{h}$$\n$$N_2'(x) = \\frac{1}{h}$$\n\n刚度矩阵 $K$ 是一个 $2 \\times 2$ 的矩阵，其分量 $K_{ij}$ 由给定的对称双线性形式 $a(\\cdot,\\cdot)$ 应用于基函数来定义：$K_{ij} = a(N_j, N_i)$。\n双线性形式为\n$$a(u,v) = \\int_{0}^{h} E \\, u'(x)\\, v'(x)\\, dx \\;+\\; \\alpha\\, u(0)\\, v(0).$$\n我们计算刚度矩阵 $K(\\alpha, E, h)$ 的四个分量。\n\n对于 $K_{11}$：\n$$K_{11} = a(N_1, N_1) = \\int_{0}^{h} E \\, (N_1'(x))^2 \\, dx + \\alpha \\, N_1(0) \\, N_1(0).$$\n在 $x=0$ 处，我们有 $N_1(0)=1$ 和 $N_2(0)=0$。\n$$K_{11} = \\int_{0}^{h} E \\left(-\\frac{1}{h}\\right)^2 dx + \\alpha (1)(1) = \\frac{E}{h^2} \\int_{0}^{h} dx + \\alpha = \\frac{E}{h^2} [x]_0^h + \\alpha = \\frac{E}{h} + \\alpha.$$\n\n对于 $K_{12}$：\n$$K_{12} = a(N_2, N_1) = \\int_{0}^{h} E \\, N_2'(x) \\, N_1'(x) \\, dx + \\alpha \\, N_2(0) \\, N_1(0).$$\n$$K_{12} = \\int_{0}^{h} E \\left(\\frac{1}{h}\\right) \\left(-\\frac{1}{h}\\right) dx + \\alpha (0)(1) = -\\frac{E}{h^2} \\int_{0}^{h} dx = -\\frac{E}{h}.$$\n\n对于 $K_{21}$：\n由于双线性形式是对称的，$K_{21} = a(N_1, N_2) = K_{12} = -E/h$。\n\n对于 $K_{22}$：\n$$K_{22} = a(N_2, N_2) = \\int_{0}^{h} E \\, (N_2'(x))^2 \\, dx + \\alpha \\, N_2(0) \\, N_2(0).$$\n$$K_{22} = \\int_{0}^{h} E \\left(\\frac{1}{h}\\right)^2 dx + \\alpha (0)(0) = \\frac{E}{h^2} \\int_{0}^{h} dx = \\frac{E}{h}.$$\n\n组合这些分量，刚度矩阵为：\n$$K(\\alpha, E, h) = \\begin{pmatrix} \\frac{E}{h} + \\alpha  & -\\frac{E}{h} \\\\ -\\frac{E}{h}  & \\frac{E}{h} \\end{pmatrix}.$$\n通过将力向量的相应分量设置为零，在 $x=h$ 处的无应力端的自然边界条件被隐式满足，这与问题陈述中外功的线性泛函为零是一致的。\n\n接下来，我们求 $K$ 的特征值 $\\lambda$。特征值是特征方程 $\\det(K - \\lambda I) = 0$ 的根，其中 $I$ 是单位矩阵。\n$$\\det \\begin{pmatrix} \\frac{E}{h} + \\alpha - \\lambda  & -\\frac{E}{h} \\\\ -\\frac{E}{h}  & \\frac{E}{h} - \\lambda \\end{pmatrix} = 0.$$\n展开行列式得到特征多项式：\n$$\\left(\\frac{E}{h} + \\alpha - \\lambda\\right)\\left(\\frac{E}{h} - \\lambda\\right) - \\left(-\\frac{E}{h}\\right)^2 = 0$$\n$$\\left(\\frac{E}{h}\\right)^2 - \\frac{E}{h}\\lambda + \\alpha\\frac{E}{h} - \\alpha\\lambda - \\frac{E}{h}\\lambda + \\lambda^2 - \\left(\\frac{E}{h}\\right)^2 = 0$$\n$$\\lambda^2 - \\left(2\\frac{E}{h} + \\alpha\\right)\\lambda + \\alpha\\frac{E}{h} = 0.$$\n这是一个关于 $\\lambda$ 的二次方程。我们使用二次求根公式求解 $\\lambda$：\n$$\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a},$$\n其中 $a=1$，$b = -(2E/h + \\alpha)$，$c = \\alpha E/h$。\n$$\\lambda = \\frac{ (2\\frac{E}{h} + \\alpha) \\pm \\sqrt{\\left(2\\frac{E}{h} + \\alpha\\right)^2 - 4(1)\\left(\\alpha\\frac{E}{h}\\right)} }{2}.$$\n让我们化简平方根下的项（判别式）：\n$$\\left(2\\frac{E}{h} + \\alpha\\right)^2 - 4\\alpha\\frac{E}{h} = \\left(4\\left(\\frac{E}{h}\\right)^2 + 4\\alpha\\frac{E}{h} + \\alpha^2\\right) - 4\\alpha\\frac{E}{h} = 4\\left(\\frac{E}{h}\\right)^2 + \\alpha^2.$$\n因此，精确的特征值是：\n$$\\lambda = \\frac{1}{2} \\left[ \\left(2\\frac{E}{h} + \\alpha\\right) \\pm \\sqrt{4\\left(\\frac{E}{h}\\right)^2 + \\alpha^2} \\right].$$\n最大和最小特征值分别为：\n$$\\lambda_{\\max} = \\frac{1}{2} \\left[ \\left(2\\frac{E}{h} + \\alpha\\right) + \\sqrt{4\\left(\\frac{E}{h}\\right)^2 + \\alpha^2} \\right]$$\n$$\\lambda_{\\min} = \\frac{1}{2} \\left[ \\left(2\\frac{E}{h} + \\alpha\\right) - \\sqrt{4\\left(\\frac{E}{h}\\right)^2 + \\alpha^2} \\right].$$\n\n现在，我们求当 $\\alpha \\to \\infty$ 时这些特征值的主阶渐近表达式。我们通过提取因子 $\\alpha$ 来分析平方根项：\n$$\\sqrt{4\\left(\\frac{E}{h}\\right)^2 + \\alpha^2} = \\alpha \\sqrt{1 + 4\\left(\\frac{E}{h\\alpha}\\right)^2}.$$\n对于小的 $x$，使用泰勒展开 $\\sqrt{1+x} = 1 + \\frac{1}{2}x + O(x^2)$，其中当 $\\alpha \\to \\infty$ 时，$x = 4(E/(h\\alpha))^2 \\to 0$：\n$$\\sqrt{4\\left(\\frac{E}{h}\\right)^2 + \\alpha^2} = \\alpha \\left[ 1 + \\frac{1}{2} \\left(4\\left(\\frac{E}{h\\alpha}\\right)^2\\right) + O(\\alpha^{-4}) \\right] = \\alpha \\left[ 1 + 2\\frac{E^2}{h^2\\alpha^2} + O(\\alpha^{-4}) \\right] = \\alpha + \\frac{2E^2}{h^2\\alpha} + O(\\alpha^{-3}).$$\n\n将此展开式代回特征值的表达式中。\n对于 $\\lambda_{\\max}$：\n$$\\lambda_{\\max} = \\frac{1}{2} \\left[ 2\\frac{E}{h} + \\alpha + \\left(\\alpha + \\frac{2E^2}{h^2\\alpha} + O(\\alpha^{-3})\\right) \\right] = \\frac{1}{2} \\left[ 2\\alpha + 2\\frac{E}{h} + O(\\alpha^{-1}) \\right] = \\alpha + \\frac{E}{h} + O(\\alpha^{-1}).$$\n$\\lambda_{\\max}$ 的主阶项是 $\\alpha$。\n\n对于 $\\lambda_{\\min}$：\n$$\\lambda_{\\min} = \\frac{1}{2} \\left[ 2\\frac{E}{h} + \\alpha - \\left(\\alpha + \\frac{2E^2}{h^2\\alpha} + O(\\alpha^{-3})\\right) \\right] = \\frac{1}{2} \\left[ 2\\frac{E}{h} - \\frac{2E^2}{h^2\\alpha} + O(\\alpha^{-3}) \\right] = \\frac{E}{h} - \\frac{E^2}{h^2\\alpha} + O(\\alpha^{-3}).$$\n$\\lambda_{\\min}$ 的主阶项是一个常数 $E/h$。\n\n条件数 $\\kappa_2$ 是最大特征值与最小特征值之比：\n$$\\kappa_2(K(\\alpha,E,h)) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{\\alpha + \\frac{E}{h} + O(\\alpha^{-1})}{\\frac{E}{h} - \\frac{E^2}{h^2\\alpha} + O(\\alpha^{-3})}.$$\n为了找到当 $\\alpha \\to \\infty$ 时 $\\kappa_2$ 增长的主阶渐近表达式，我们取分子和分母的主阶项之比：\n$$\\kappa_2 \\sim \\frac{\\alpha}{E/h} \\quad \\text{as } \\alpha \\to \\infty.$$\n因此，主阶渐近表达式为：\n$$\\kappa_2 \\sim \\frac{\\alpha h}{E}.$$\n这个结果表明条件数随惩罚参数 $\\alpha$ 线性增长，这是基于罚函数的有限元方法中病态的一个典型特征。", "answer": "$$\\boxed{\\frac{\\alpha h}{E}}$$", "id": "3563169"}, {"introduction": "在分析了罚函数法的理论缺陷后，我们有必要将其与精确施加边界条件的“强”施加法进行实践层面的比较。这个练习要求您为一个简单的杆单元问题编写代码，分别实现罚函数法（弱施加）和高斯消元法（强施加）。通过亲手实现这两种方法并比较其计算出的反力和边界位移误差，您将验证罚函数法是如何在罚参数增大时收敛于强施加法的精确解，并深化对这两种主流技术实现细节的理解。[@problem_id:3563196]", "problem": "考虑一根长度为 $L$、横截面积为常数 $A$、杨氏模量为 $E$ 的一维线性弹性杆。令 $x \\in [0,L]$ 表示轴向坐标。未知位移场为 $u(x)$（单位：米）。该杆受到均匀体力密度 $b$（单位：牛顿/米）和施加在 $x=L$ 处的端点力 $F$（单位：牛顿）的作用。轴向应变为 $\\varepsilon(x) = u'(x)$，轴向应力为 $\\sigma(x) = E \\varepsilon(x)$。乘积 $EA$（单位：牛顿）是杆的轴向刚度。\n\n我们研究两种方法来施加 $x=0$ 处形式为 $u(0) = \\bar{u}$ 的本质（Dirichlet）边界条件，其中 $\\bar{u}$ 是一个给定的位移（单位：米）：\n- 强施加：在第一个节点上精确施加 Dirichlet 条件于离散位移。\n- 弱（罚）施加：通过为离散系统增加一个大小为 $\\gamma$（单位：牛顿/米）的罚项来施加 Dirichlet 条件，该罚项惩罚 $u(0)$ 与 $\\bar{u}$ 的偏差。\n\n在 $x=L$ 处的自然（Neumann）边界条件是施加的端点力 $F$（单位：牛顿）。体力密度 $b$ 构成了沿杆的分布载荷。控制弱形式建立在虚功原理之上：对于所有运动学允许的虚位移，内虚功等于外虚功。\n\n你的任务：\n1. 使用有限元法（FEM），将杆离散化为 $n$ 个等长的线性单元，节点为 $x_i = i h$，其中 $i=0,\\dots,n$，$h = L/n$ 是单元长度。使用标准的线性单元公式组装全局刚度矩阵 $K \\in \\mathbb{R}^{(n+1) \\times (n+1)}$ 和载荷向量 $f \\in \\mathbb{R}^{n+1}$：\n   - 每个单元的单元刚度矩阵 $k_e = \\dfrac{EA}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$。\n   - 由均匀体力引起的每个单元的一致单元载荷向量 $f_e = \\dfrac{b h}{2} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$。\n   - 端点力 $F$ 被加到最后一个节点上：$f_{n} \\leftarrow f_{n} + F$。\n2. 强施加 $u(0) = \\bar{u}$：在线性系统中消去第一个自由度以求解剩余未知数，然后构建完整位移向量 $u^{\\star}$，其中 $u^{\\star}_0 = \\bar{u}$。将在 $x=0$ 处的反力定义为平衡第一个节点上外载荷的节点内力：\n   $$ r_{\\infty} := \\left( K u^{\\star} - f \\right)_0 \\quad \\text{单位：牛顿。} $$\n3. 罚施加 $u(0) = \\bar{u}$：构建罚化系统\n   $$ (K + \\gamma e_0 e_0^{\\top}) u_{\\gamma} = f + \\gamma \\bar{u} \\, e_0, $$\n   其中 $e_0 \\in \\mathbb{R}^{n+1}$ 是第一个分量为1，其余分量为0的单位向量，$\\gamma > 0$ 是罚参数。求解 $u_{\\gamma}$，并将罚反力定义为\n   $$ r_{\\gamma} := \\gamma \\left( \\bar{u} - u_{\\gamma,0} \\right) \\quad \\text{单位：牛顿，} $$\n   其中 $u_{\\gamma,0}$ 是 $u_{\\gamma}$ 的第一个分量。同时定义 Dirichlet 违背量\n   $$ v_{\\gamma} := \\left| u_{\\gamma,0} - \\bar{u} \\right| \\quad \\text{单位：米。} $$\n4. 通过比较 $r_{\\gamma}$ 与 $r_{\\infty}$ 来证明反力计算的一致性。具体来说，对于每个测试用例，计算绝对反力误差\n   $$ e_{\\gamma} := \\left| r_{\\gamma} - r_{\\infty} \\right| \\quad \\text{单位：牛顿} $$\n   和 Dirichlet 违背量 $v_{\\gamma}$（单位：米）。\n\n程序必须为以下参数集测试套件实现上述步骤。每个测试用例是一个元组 $(L, E, A, n, F, b, \\bar{u}, \\gamma)$，单位如指定：\n- 测试 1（正常路径，小罚参数）：$(1.0 \\text{ m}, 210\\times 10^{9} \\text{ Pa}, 1.0\\times 10^{-4} \\text{ m}^2, 20, 1000 \\text{ N}, 0 \\text{ N/m}, 0 \\text{ m}, 1.0\\times 10^{3} \\text{ N/m})$。\n- 测试 2（正常路径，中等罚参数）：$(1.0 \\text{ m}, 210\\times 10^{9} \\text{ Pa}, 1.0\\times 10^{-4} \\text{ m}^2, 20, 1000 \\text{ N}, 0 \\text{ N/m}, 0 \\text{ m}, 1.0\\times 10^{6} \\text{ N/m})$。\n- 测试 3（极限行为，非常大的罚参数）：$(1.0 \\text{ m}, 210\\times 10^{9} \\text{ Pa}, 1.0\\times 10^{-4} \\text{ m}^2, 20, 1000 \\text{ N}, 0 \\text{ N/m}, 0 \\text{ m}, 1.0\\times 10^{12} \\text{ N/m})$。\n- 测试 4（含体力）：$(1.0 \\text{ m}, 70\\times 10^{9} \\text{ Pa}, 5.0\\times 10^{-5} \\text{ m}^2, 30, 500 \\text{ N}, 200 \\text{ N/m}, 0 \\text{ m}, 1.0\\times 10^{6} \\text{ N/m})$。\n- 测试 5（软杆）：$(1.0 \\text{ m}, 1.0\\times 10^{6} \\text{ Pa}, 1.0\\times 10^{-6} \\text{ m}^2, 10, 1.0 \\text{ N}, 1.0 \\text{ N/m}, 0 \\text{ m}, 1.0\\times 10^{6} \\text{ N/m})$。\n\n所有反力以牛顿表示，所有位移以米表示。不涉及角度。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表。对于每个测试用例，按顺序附加四个数字：$r_{\\infty}$、$r_{\\gamma}$、$e_{\\gamma}$、$v_{\\gamma}$。因此，最终输出是对应于5个测试用例的20个数字的扁平列表。", "solution": "该问题陈述被评估为具有科学依据、良定且客观。它展示了有限元法（FEM）在一维线性弹性问题上的一个标准应用，这是计算固体力学中的一个基本课题。所提供的物理参数、控制方程、单元公式以及边界条件施加（强施加和罚方法）的定义都与已建立的理论一致。该问题是内容完整的，为每个测试用例提供了所有必要的数据。因此，可以构建一个完整且合理的解。\n\n求解过程分四个阶段进行：\n1.  连续问题的离散化及全局线性方程组的组装。\n2.  使用强（消元）法施加本质边界条件并计算反力。\n3.  使用弱（罚）法施加本质边界条件并计算近似反力和边界位移违背量。\n4.  比较两种方法得到的反力。\n\n**1. 有限元离散化与组装**\n\n长度为 $L$ 的一维域 $x \\in [0, L]$ 被离散化为 $n$ 个等长 $h = L/n$ 的线性有限元。这创建了 $n+1$ 个节点，位于 $x_i = i h$（$i=0, 1, \\dots, n$）处。位移场 $u(x)$ 在这些单元上被近似为分段线性函数。未知的节点位移被收集在一个向量 $u \\in \\mathbb{R}^{n+1}$ 中。\n\n虚功原理导出一个线性方程组 $K u = f$，其中 $K$ 是全局刚度矩阵，$f$ 是全局载荷向量。它们由单元级的贡献组装而成。\n\n对于每个单元 $e$（连接局部节点0和1，对应于全局节点 $i$ 和 $i+1$），单元刚度矩阵 $k_e$ 由下式给出：\n$$\nk_e = \\frac{EA}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n其中 $E$ 是杨氏模量，$A$ 是横截面积，$h$ 是单元长度。\n\n由均匀体力 $b$ 引起的一致单元载荷向量 $f_e$ 为：\n$$\nf_e = \\frac{b h}{2} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}\n$$\n\n全局刚度矩阵 $K \\in \\mathbb{R}^{(n+1) \\times (n+1)}$ 和载荷向量 $f \\in \\mathbb{R}^{n+1}$ 被初始化为零矩阵。然后，对于每个跨越全局节点 $i$ 和 $i+1$ 的单元 $e$（$i=0, \\dots, n-1$），$k_e$ 和 $f_e$ 的项被加到 $K$ 和 $f$ 中的相应位置。这是标准的“组装”过程。例如，$K_{i,i}$ 接收来自单元 $i-1$ 和 $i$ 的贡献。\n\n最后，将位于 $x=L$（节点 $n$）的外部点载荷 $F$ 添加到全局载荷向量的最后一个分量上：$f_n \\leftarrow f_n + F$。\n\n**2. 本质边界条件的强施加**\n\n本质（Dirichlet）边界条件是 $u(0) = \\bar{u}$。在离散系统中，这对应于将第一个节点的位移设置为给定值：$u_0 = \\bar{u}$。这是“强”施加，因为该条件被精确满足。\n\n全局系统 $K u = f$ 可以根据已知和未知的自由度（DOFs）进行分块。这里，$u_0$ 是已知的，而剩余的位移 $u_R = [u_1, u_2, \\dots, u_n]^\\top$ 是未知的。\n$$\n\\begin{bmatrix}\nK_{00}  K_{0R} \\\\\nK_{R0}  K_{RR}\n\\end{bmatrix}\n\\begin{Bmatrix}\nu_0 \\\\\nu_R\n\\end{Bmatrix}\n=\n\\begin{Bmatrix}\nf_0 \\\\\nf_R\n\\end{Bmatrix}\n$$\n从该分块系统的第二行，我们可以求解未知位移 $u_R$：\n$$\nK_{R0} u_0 + K_{RR} u_R = f_R \\implies K_{RR} u_R = f_R - K_{R0} u_0\n$$\n由于 $u_0 = \\bar{u}$ 是已知的，我们求解规模为 $n \\times n$ 的简化系统以得到 $u_R$。设该解为 $u_R^{\\star}$。然后通过组合给定值和计算值来构建完整位移向量，记为 $u^{\\star}$：$u^{\\star} = [\\bar{u}, (u_R^{\\star})^\\top]^\\top$。\n\n约束节点（$x=0$）处的反力是维持给定 displace 所需的力。它是在求解出所有位移 *之后*，从原始系统的第一行计算得出的：\n$$\nr_{\\infty} := (K u^{\\star} - f)_0 = K_{00} u^{\\star}_0 + K_{0R} u^{\\star}_R - f_0\n$$\n下标 $\\infty$ 概念上表示这是精确反力，对应于无穷大的罚参数。\n\n**3. 本质边界条件的罚施加**\n\n罚方法以近似的、“弱”的意义施加边界条件 $u_0 = \\bar{u}$。其思想是在系统的节点0处添加一个刚度为 $\\gamma$ 的大“弹簧”，将该节点拉向位置 $\\bar{u}$。这在数学上通过为势能泛函增加一个罚项 $\\frac{1}{2}\\gamma(u_0 - \\bar{u})^2$ 来实现。\n\n这一修改导致一个修正后的线性系统：\n$$\nK_{\\gamma} u_{\\gamma} = f_{\\gamma}\n$$\n其中 $K_{\\gamma}$ 和 $f_{\\gamma}$ 分别是罚化刚度矩阵和载荷向量。它们通过修改原始系统中对应于边界条件（索引为0）的自由度而形成：\n$$\nK_{\\gamma} = K + \\gamma e_0 e_0^{\\top} \\quad \\text{(即 } K_{\\gamma,00} = K_{00} + \\gamma \\text{)}\n$$\n$$\nf_{\\gamma} = f + \\gamma \\bar{u} \\, e_0 \\quad \\text{(即 } f_{\\gamma,0} = f_0 + \\gamma \\bar{u} \\text{)}\n$$\n这里，$e_0$ 是索引0处为1、其余处为0的标准基向量。这个修正后的 $(n+1) \\times (n+1)$ 系统是非奇异的（如果原始的简化系统是非奇异的），可以直接求解以获得完整位移向量 $u_{\\gamma}$。\n\n罚化系统的第一个方程是 $(K_{00} + \\gamma) u_{\\gamma,0} + \\sum_{j=1}^{n} K_{0j} u_{\\gamma,j} = f_0 + \\gamma \\bar{u}$。重新整理得到 $\\gamma (\\bar{u} - u_{\\gamma,0}) = \\sum_{j=0}^{n} K_{0j} u_{\\gamma,j} - f_0$，其中右侧代表节点内力。这启发了罚反力的定义：\n$$\nr_{\\gamma} := \\gamma \\left( \\bar{u} - u_{\\gamma,0} \\right)\n$$\n与强施加不同，计算出的位移 $u_{\\gamma,0}$ 不会精确等于 $\\bar{u}$。这个偏差的大小就是 Dirichlet 违背量：\n$$\nv_{\\gamma} := \\left| u_{\\gamma,0} - \\bar{u} \\right|\n$$\n可以证明，当罚参数 $\\gamma \\to \\infty$ 时，$u_{\\gamma} \\to u^{\\star}$ 且 $r_{\\gamma} \\to r_{\\infty}$。\n\n**4. 误差分析**\n\n为了证明罚方法收敛于强解，我们计算反力之间的绝对误差：\n$$\ne_{\\gamma} := \\left| r_{\\gamma} - r_{\\infty} \\right|\n$$\n所提供的测试用例探讨了罚参数 $\\gamma$ 的选择如何影响计算反力的精度（由 $e_{\\gamma}$衡量）和本质边界条件的满足程度（由 $v_{\\gamma}$衡量）。通常，较大的 $\\gamma$ 会导致 $v_{\\gamma}$ 和 $e_{\\gamma}$ 的值都较小，但如果 $\\gamma$ 相对于 $K$ 的对角元过大，则可能导致数值病态问题。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves a 1D linear elastic bar problem using FEM with both strong and penalty\n    enforcement of Dirichlet boundary conditions and compares the results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (L, E, A, n, F, b, u_bar, gamma)\n    test_cases = [\n        # (L, E, A, n, F, b, u_bar, gamma)\n        (1.0, 210e9, 1.0e-4, 20, 1000.0, 0.0, 0.0, 1.0e3),\n        (1.0, 210e9, 1.0e-4, 20, 1000.0, 0.0, 0.0, 1.0e6),\n        (1.0, 210e9, 1.0e-4, 20, 1000.0, 0.0, 0.0, 1.0e12),\n        (1.0, 70e9, 5.0e-5, 30, 500.0, 200.0, 0.0, 1.0e6),\n        (1.0, 1.0e6, 1.0e-6, 10, 1.0, 1.0, 0.0, 1.0e6),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, E, A, n, F, b, u_bar, gamma = case\n\n        # 1. Discretization and Assembly\n        h = L / n\n        n_nodes = n + 1\n        \n        # Initialize global stiffness matrix and load vector\n        K_global = np.zeros((n_nodes, n_nodes))\n        f_global = np.zeros(n_nodes)\n        \n        # Element properties\n        axial_stiffness = E * A\n        k_elem_val = axial_stiffness / h\n        k_elem = k_elem_val * np.array([[1, -1], [-1, 1]])\n        \n        f_elem_val = b * h / 2\n        f_elem = f_elem_val * np.array([1, 1])\n\n        # Assembly loop\n        for i in range(n):\n            # Global node indices for element i\n            nodes = [i, i + 1]\n            # Add element contributions to global system\n            K_global[np.ix_(nodes, nodes)] += k_elem\n            f_global[nodes] += f_elem\n            \n        # Apply natural boundary condition (point force F at x=L)\n        f_global[n] += F\n\n        # 2. Strong Enforcement\n        # Partition the system: K u = f\n        K_RR = K_global[1:, 1:]\n        f_R = f_global[1:]\n        K_R0 = K_global[1:, 0]\n\n        # Solve for unknown displacements: K_RR * u_R = f_R - K_R0 * u_bar\n        rhs_strong = f_R - K_R0 * u_bar\n        u_R_star = np.linalg.solve(K_RR, rhs_strong)\n        \n        # Reconstruct the full displacement vector\n        u_star = np.concatenate(([u_bar], u_R_star))\n\n        # Calculate reaction force r_inf = (K*u_star - f)[0]\n        r_inf = (K_global @ u_star - f_global)[0]\n\n        # 3. Penalty Enforcement\n        # Form the penalized system\n        K_penalty = K_global.copy()\n        K_penalty[0, 0] += gamma\n        \n        f_penalty = f_global.copy()\n        f_penalty[0] += gamma * u_bar\n        \n        # Solve for displacements u_gamma\n        u_gamma = np.linalg.solve(K_penalty, f_penalty)\n        u_gamma_0 = u_gamma[0]\n\n        # Calculate penalty reaction r_gamma\n        r_gamma = gamma * (u_bar - u_gamma_0)\n        \n        # Calculate Dirichlet violation v_gamma\n        v_gamma = np.abs(u_gamma_0 - u_bar)\n\n        # 4. Comparison\n        # Calculate absolute reaction error e_gamma\n        e_gamma = np.abs(r_gamma - r_inf)\n        \n        # Append results for this test case\n        results.extend([r_inf, r_gamma, e_gamma, v_gamma])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.8e}' for x in results)}]\")\n\nsolve()\n```", "id": "3563196"}, {"introduction": "现在我们将注意力从本质边界条件转向自然边界条件（诺伊曼条件），后者通常涉及指定的力或通量。在有限元法中，连续分布的载荷必须被转化为在节点上施加的离散载荷，且这些离散载荷所做的虚功与原分布载荷等效。本练习将指导您完成一个典型的计算过程：为一个板单元边缘上分布的弯矩计算其等效节点力矩，这个过程将加深您对虚功原理、形函数以及如何连接连续弱形式和离散有限元方程的理解。[@problem_id:3563213]", "problem": "一块基于 Kirchhoff–Love 假说建模的薄板被离散化以进行有限元法 (FEM) 分析。考虑一个长度为 $L$ 的单元的单条直边，该边由弧长坐标 $s \\in [0, L]$ 参数化，并通过仿射关系 $s = \\tfrac{L}{2}(\\xi + 1)$（其中 $ds = \\tfrac{L}{2}\\,d\\xi$）映射到一维母坐标 $\\xi \\in [-1, 1]$。沿着该边，绕切线轴的单位长度弯矩（法向彎矩）被指定为 $m_{n}(s) = m_{0} + m_{1}\\,s$，这构成了板问题弱形式中的自然边界条件。功共轭的边运动场是绕切线轴的边转角，记为 $\\theta_{n}(s)$，它使用与位于 $\\xi = -1, 0, 1$ 的三个边节点相关的二次 Lagrange 形函数进行插值：\n$$\nN_{1}(\\xi) = \\frac{\\xi(\\xi - 1)}{2}, \\qquad\nN_{2}(\\xi) = 1 - \\xi^{2}, \\qquad\nN_{3}(\\xi) = \\frac{\\xi(\\xi + 1)}{2}.\n$$\n以虚功原理为基本出发点，推导沿该边的等效节点弯矩向量的表达式，其节点分量对应于 $\\xi = -1, 0, 1$ 处与 $\\theta_{n}$ 相关的自由度。然后，使用横坐标为 $\\xi = \\pm 1/\\sqrt{3}$ 且权重为 $1$ 的两点 Gauss–Legendre 求积法计算得到的边积分。最终答案需用 $L$、$m_{0}$ 和 $m_{1}$ 的符号形式表示。等效节点弯矩应以牛顿·米 (N·m) 为单位表示。无需进行数值代入，也无需四舍五入。最终答案必须是单个复合表达式。", "solution": "该问题经核实具有科学依据、提法恰当且客观。所有必要信息均已提供，且设置一致。该问题是虚功原理在结构力学有限元法背景下的一个标准应用。\n\n等效节点弯矩的推导始于虚功原理。由沿单元边界的指定单位长度法向弯矩 $m_{n}(s)$ 所做的外虚功 $\\delta W_{\\text{ext}}$，由该弯矩乘以相应的虚转角 $\\delta\\theta_{n}(s)$ 的积分给出：\n$$\n\\delta W_{\\text{ext}} = \\int_{s=0}^{s=L} m_{n}(s) \\delta\\theta_{n}(s) \\, ds\n$$\n在有限元法中，运动场 $\\theta_{n}(s)$ 及其变分 $\\delta\\theta_{n}(s)$ 是利用形函数从节点自由度插值得到的。对于沿该边的三个节点，转角 $\\theta_{n}(s)$ 表示为：\n$$\n\\theta_{n}(s) = \\sum_{i=1}^{3} N_{i}(\\xi(s)) \\theta_{ni}\n$$\n其中 $\\theta_{ni}$ 是节点 $i=1, 2, 3$（对应于 $\\xi = -1, 0, 1$）处的转角节点值。那么虚转角为：\n$$\n\\delta\\theta_{n}(s) = \\sum_{i=1}^{3} N_{i}(\\xi(s)) \\delta\\theta_{ni}\n$$\n将此代入虚功表达式：\n$$\n\\delta W_{\\text{ext}} = \\int_{s=0}^{s=L} m_{n}(s) \\left( \\sum_{i=1}^{3} N_{i}(\\xi(s)) \\delta\\theta_{ni} \\right) \\, ds\n$$\n由于虚节点转角 $\\delta\\theta_{ni}$ 相对于积分变量 $s$ 是任意常数，我们可以重排该表达式：\n$$\n\\delta W_{\\text{ext}} = \\sum_{i=1}^{3} \\left( \\int_{s=0}^{s=L} m_{n}(s) N_{i}(\\xi(s)) \\, ds \\right) \\delta\\theta_{ni}\n$$\n外虚功也可以直接表示为与虚节点转角 $\\delta\\theta_{ni}$ 共轭的等效节点弯矩 $M_{i}$ 所做的功之和：\n$$\n\\delta W_{\\text{ext}} = \\sum_{i=1}^{3} M_{i} \\delta\\theta_{ni}\n$$\n通过比较 $\\delta W_{\\text{ext}}$ 的两个表达式，我们确定了第 $i$ 个等效节点弯矩的公式：\n$$\nM_{i} = \\int_{s=0}^{s=L} m_{n}(s) N_{i}(\\xi(s)) \\, ds\n$$\n为计算该积分，我们将积分变量从弧长坐标 $s$ 变换到母坐标 $\\xi$。题目给出了仿射映射 $s = \\frac{L}{2}(\\xi + 1)$，这意味着微分关系 $ds = \\frac{L}{2} d\\xi$。积分限 $s \\in [0, L]$ 映射到 $\\xi \\in [-1, 1]$。分布弯矩 $m_{n}(s)$ 也必须用 $\\xi$ 表示：\n$$\nm_{n}(s(\\xi)) = m_{0} + m_{1}s(\\xi) = m_{0} + m_{1} \\frac{L}{2}(\\xi + 1)\n$$\n$M_{i}$ 的积分变为：\n$$\nM_{i} = \\int_{-1}^{1} \\left( m_{0} + m_{1} \\frac{L}{2}(\\xi + 1) \\right) N_{i}(\\xi) \\frac{L}{2} \\, d\\xi\n$$\n题目指定使用两点 Gauss–Legendre 求积法来计算该积分。该数值积分的公式为：\n$$\n\\int_{-1}^{1} f(\\xi) \\, d\\xi \\approx \\sum_{j=1}^{2} w_{j} f(\\xi_{j})\n$$\n横坐标为 $\\xi_{1} = -1/\\sqrt{3}$、$\\xi_{2} = 1/\\sqrt{3}$，权重为 $w_{1}=w_{2}=1$。第 $i$ 个弯矩的被积函数为 $f_i(\\xi) = \\frac{L}{2} \\left[ m_{0} + m_{1} \\frac{L}{2}(\\xi + 1) \\right] N_{i}(\\xi)$。因此，节点弯矩近似为：\n$$\nM_{i} \\approx f_i(-\\frac{1}{\\sqrt{3}}) + f_i(\\frac{1}{\\sqrt{3}})\n$$\n首先，我们计算形函数 $N_i(\\xi)$ 和分布弯矩 $m_n(\\xi)$ 在 Gauss 点 $\\xi = \\pm 1/\\sqrt{3}$ 处的值。\n\nGauss 点处的形函数：\n$N_{1}(\\xi) = \\frac{\\xi(\\xi-1)}{2} \\implies N_{1}(-\\frac{1}{\\sqrt{3}}) = \\frac{1}{6} + \\frac{1}{2\\sqrt{3}}, \\quad N_{1}(\\frac{1}{\\sqrt{3}}) = \\frac{1}{6} - \\frac{1}{2\\sqrt{3}}$\n$N_{2}(\\xi) = 1 - \\xi^{2} \\implies N_{2}(-\\frac{1}{\\sqrt{3}}) = \\frac{2}{3}, \\quad N_{2}(\\frac{1}{\\sqrt{3}}) = \\frac{2}{3}$\n$N_{3}(\\xi) = \\frac{\\xi(\\xi+1)}{2} \\implies N_{3}(-\\frac{1}{\\sqrt{3}}) = \\frac{1}{6} - \\frac{1}{2\\sqrt{3}}, \\quad N_{3}(\\frac{1}{\\sqrt{3}}) = \\frac{1}{6} + \\frac{1}{2\\sqrt{3}}$\n\nGauss 点处的分布弯矩：\n$m_n(\\xi) = m_{0} + m_{1} \\frac{L}{2}(\\xi + 1)$\n$m_n(-\\frac{1}{\\sqrt{3}}) = m_{0} + m_{1} \\frac{L}{2}(1 - \\frac{1}{\\sqrt{3}})$\n$m_n(\\frac{1}{\\sqrt{3}}) = m_{0} + m_{1} \\frac{L}{2}(1 + \\frac{1}{\\sqrt{3}})$\n\n现在我们计算每个节点弯矩 $M_i$：\n$M_i \\approx \\frac{L}{2} \\left[ m_n(-\\frac{1}{\\sqrt{3}}) N_i(-\\frac{1}{\\sqrt{3}}) + m_n(\\frac{1}{\\sqrt{3}}) N_i(\\frac{1}{\\sqrt{3}}) \\right]$\n\n对于 $M_1$：\n$M_1 \\approx \\frac{L}{2} \\left[ \\left(m_{0} + \\frac{m_{1}L}{2} - \\frac{m_{1}L}{2\\sqrt{3}}\\right) \\left(\\frac{1}{6} + \\frac{1}{2\\sqrt{3}}\\right) + \\left(m_{0} + \\frac{m_{1}L}{2} + \\frac{m_{1}L}{2\\sqrt{3}}\\right) \\left(\\frac{1}{6} - \\frac{1}{2\\sqrt{3}}\\right) \\right]$\n令 $A = m_0 + \\frac{m_1L}{2}$, $B = \\frac{m_1L}{2\\sqrt{3}}$, $C = \\frac{1}{6}$, $D = \\frac{1}{2\\sqrt{3}}$。表达式为 $\\frac{L}{2}[(A-B)(C+D) + (A+B)(C-D)] = \\frac{L}{2}[2AC - 2BD] = L(AC-BD)$。\n$AC = (m_0 + \\frac{m_1L}{2})\\frac{1}{6} = \\frac{m_0}{6} + \\frac{m_1L}{12}$。\n$BD = (\\frac{m_1L}{2\\sqrt{3}})(\\frac{1}{2\\sqrt{3}}) = \\frac{m_1L}{12}$。\n$M_1 = L \\left( \\frac{m_0}{6} + \\frac{m_1L}{12} - \\frac{m_1L}{12} \\right) = \\frac{m_0L}{6}$。\n\n对于 $M_2$：\n$N_2$ 在两个 Gauss 点处为常数，$N_2(\\pm\\frac{1}{\\sqrt{3}}) = 2/3$。\n$M_2 \\approx \\frac{L}{2} \\cdot \\frac{2}{3} \\left[ m_n(-\\frac{1}{\\sqrt{3}}) + m_n(\\frac{1}{\\sqrt{3}}) \\right] = \\frac{L}{3} \\left[ \\left(m_0 + \\frac{m_1L}{2} - \\frac{m_1L}{2\\sqrt{3}}\\right) + \\left(m_0 + \\frac{m_1L}{2} + \\frac{m_1L}{2\\sqrt{3}}\\right) \\right]$\n$M_2 \\approx \\frac{L}{3} \\left[ 2m_0 + m_1L \\right] = \\frac{2m_0L}{3} + \\frac{m_1L^2}{3}$。\n\n对于 $M_3$：\n表达式为 $\\frac{L}{2}[(A-B)(C-D) + (A+B)(C+D)] = \\frac{L}{2}[2AC + 2BD] = L(AC+BD)$。\n$M_3 = L \\left( (\\frac{m_0}{6} + \\frac{m_1L}{12}) + \\frac{m_1L}{12} \\right) = L \\left( \\frac{m_0}{6} + \\frac{m_1L}{6} \\right) = \\frac{m_0L}{6} + \\frac{m_1L^2}{6}$。\n\n被积函数是关于 $\\xi$ 的 3 次多项式，而两点 Gauss 求积法对于次数最高为 $2(2)-1=3$ 的多项式是精确的。因此，这些结果是精确值，而非近似值。\n等效节点弯矩向量的分量为：\n$M_{1} = \\frac{m_{0}L}{6}$\n$M_{2} = \\frac{2m_{0}L}{3} + \\frac{m_{1}L^{2}}{3} = \\frac{2m_{0}L + m_{1}L^{2}}{3}$\n$M_{3} = \\frac{m_{0}L}{6} + \\frac{m_{1}L^{2}}{6} = \\frac{m_{0}L + m_{1}L^{2}}{6}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix} \\frac{m_{0}L}{6} \\\\ \\frac{2m_{0}L + m_{1}L^{2}}{3} \\\\ \\frac{m_{0}L + m_{1}L^{2}}{6} \\end{pmatrix}\n}\n$$", "id": "3563213"}]}