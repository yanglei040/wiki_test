{"hands_on_practices": [{"introduction": "在使用任何算法之前，理解其固有的敏感性至关重要。本练习引入了 Cholesky 映射的逐分量条件数的概念，旨在量化输出因子 $L$ 对输入矩阵 $A$ 中微小变化的敏感程度。通过对一个具体的 $2 \\times 2$ 矩阵进行一阶扰动分析，你将亲手计算出这种敏感性，从而深刻理解误差如何在分解过程中被放大。[@problem_id:3568076]", "problem": "考虑一个实对称正定 (SPD) 矩阵的 Cholesky 分解，该分解由等式 $A = L L^{\\top}$ 定义，其中 $L$ 是一个对角线元素为正的下三角矩阵。设 $A \\in \\mathbb{R}^{2 \\times 2}$ 是 SPD 矩阵\n$$\nA = \\begin{pmatrix} 4  1 \\\\ 1  3 \\end{pmatrix},\n$$\n并设 $L$ 表示其 Cholesky 因子。对于一个小的对称扰动 $\\delta A$，通过在 $A$ 处的 Cholesky 映射的 Fréchet 导数来定义相应的一阶扰动 $\\delta L$。在矩阵上的标准逐元素最大范数 $\\| \\cdot \\|_{\\max}$ (定义为 $\\|M\\|_{\\max} = \\max_{i,j} |m_{ij}|$) 下进行计算，并设扰动域是由其独立元素参数化的对称矩阵空间。\n\n从基本原理（定义关系 $A = L L^{\\top}$ 和一阶扰动分析）出发，推导连接 $\\delta A$ 和 $\\delta L$ 的线性化关系，并用它来构建在给定 $A$ 处 Cholesky 映射 $A \\mapsto L$ 的分量形式条件数，该条件数在一阶上定义为\n$$\n\\kappa_{\\max}(A) = \\sup_{\\delta A \\neq 0} \\frac{\\|\\delta L\\|_{\\max}}{\\|\\delta A\\|_{\\max}}\n$$\n。对给定的 $A$ 精确计算 $\\kappa_{\\max}(A)$，并确定当 $\\|\\delta A\\|_{\\max} = 1$ 时，$\\delta A$ 的哪些元素使得该界取等，从而评估特定元素的紧致性和敏感性。你的最终答案必须是 $\\kappa_{\\max}(A)$ 的唯一精确值，不需要四舍五入。", "solution": "用户想要找到给定 $2 \\times 2$ 对称正定 (SPD) 矩阵 Cholesky 分解的分量形式条件数。\n\n### 步骤 1：A 的验证和 Cholesky 分解\n\n给定矩阵为 $A = \\begin{pmatrix} 4  1 \\\\ 1  3 \\end{pmatrix}$。\n首先，我们验证 $A$ 是对称正定的。$A$ 显然是对称的。其顺序主子式为 $\\det(A_1) = 4  0$ 和 $\\det(A_2) = \\det(A) = 4 \\times 3 - 1 \\times 1 = 11  0$。由于所有顺序主子式都为正，因此 $A$ 是 SPD，其 Cholesky 分解存在且唯一。\n\nCholesky 分解为 $A = L L^{\\top}$，其中 $L$ 是一个对角线元素为正的下三角矩阵。设 $L = \\begin{pmatrix} l_{11}  0 \\\\ l_{21}  l_{22} \\end{pmatrix}$。\n那么 $A = L L^{\\top}$ 展开为：\n$$\n\\begin{pmatrix} 4  1 \\\\ 1  3 \\end{pmatrix} = \\begin{pmatrix} l_{11}  0 \\\\ l_{21}  l_{22} \\end{pmatrix} \\begin{pmatrix} l_{11}  l_{21} \\\\ 0  l_{22} \\end{pmatrix} = \\begin{pmatrix} l_{11}^2  l_{11}l_{21} \\\\ l_{11}l_{21}  l_{21}^2 + l_{22}^2 \\end{pmatrix}\n$$\n令矩阵各项相等，我们求解 $L$ 的分量：\n$l_{11}^2 = 4 \\implies l_{11} = 2$ (因为 $l_{11}  0$)。\n$l_{11}l_{21} = 1 \\implies 2l_{21} = 1 \\implies l_{21} = \\frac{1}{2}$。\n$l_{21}^2 + l_{22}^2 = 3 \\implies \\left(\\frac{1}{2}\\right)^2 + l_{22}^2 = 3 \\implies \\frac{1}{4} + l_{22}^2 = 3 \\implies l_{22}^2 = 3 - \\frac{1}{4} = \\frac{11}{4}$。\n因为 $l_{22}  0$，我们有 $l_{22} = \\frac{\\sqrt{11}}{2}$。\n因此，Cholesky 因子为 $L = \\begin{pmatrix} 2  0 \\\\ \\frac{1}{2}  \\frac{\\sqrt{11}}{2} \\end{pmatrix}$。\n\n### 步骤 2：线性化扰动方程的推导\n\n我们从定义关系 $A = L L^{\\top}$ 出发，并考虑一阶扰动。设 $A$ 被对称矩阵 $\\delta A$ 扰动，且 $L$ 中相应的扰动为 $\\delta L$。\n$$\nA + \\delta A = (L + \\delta L)(L + \\delta L)^{\\top} = (L + \\delta L)(L^{\\top} + \\delta L^{\\top}) = L L^{\\top} + L \\delta L^{\\top} + \\delta L L^{\\top} + \\delta L \\delta L^{\\top}\n$$\n减去 $A = L L^{\\top}$ 并只保留一阶项，得到线性化关系：\n$$\n\\delta A = L \\delta L^{\\top} + \\delta L L^{\\top}\n$$\n由于 $L$ 是下三角矩阵，$\\delta L$ 也必须是下三角矩阵（$L$ 的零元素不能被扰动）。设 $\\delta A = \\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix}$ 和 $\\delta L = \\begin{pmatrix} x_{11}  0 \\\\ x_{21}  x_{22} \\end{pmatrix}$。\n将 $L$、$ \\delta L$ 和 $\\delta A$ 的表达式代入扰动方程：\n$$\n\\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix} = \\begin{pmatrix} 2  0 \\\\ \\frac{1}{2}  \\frac{\\sqrt{11}}{2} \\end{pmatrix} \\begin{pmatrix} x_{11}  x_{21} \\\\ 0  x_{22} \\end{pmatrix} + \\begin{pmatrix} x_{11}  0 \\\\ x_{21}  x_{22} \\end{pmatrix} \\begin{pmatrix} 2  \\frac{1}{2} \\\\ 0  \\frac{\\sqrt{11}}{2} \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix} = \\begin{pmatrix} 2x_{11}  2x_{21} \\\\ \\frac{1}{2}x_{11}  \\frac{1}{2}x_{21} + \\frac{\\sqrt{11}}{2}x_{22} \\end{pmatrix} + \\begin{pmatrix} 2x_{11}  \\frac{1}{2}x_{11} \\\\ 2x_{21}  \\frac{1}{2}x_{21} + \\frac{\\sqrt{11}}{2}x_{22} \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix} = \\begin{pmatrix} 4x_{11}  \\frac{1}{2}x_{11} + 2x_{21} \\\\ \\frac{1}{2}x_{11} + 2x_{21}  x_{21} + \\sqrt{11}x_{22} \\end{pmatrix}\n$$\n这给出了一个线性方程组，它将 $\\delta A$ 的独立元素（$s_{11}, s_{12}, s_{22}$）与 $\\delta L$ 的独立元素（$x_{11}, x_{21}, x_{22}$）联系起来：\n1.  $s_{11} = 4x_{11}$\n2.  $s_{12} = \\frac{1}{2}x_{11} + 2x_{21}$\n3.  $s_{22} = x_{21} + \\sqrt{11}x_{22}$\n\n### 步骤 3：用 $\\delta A$ 求解 $\\delta L$\n\n我们求解这个方程组，得到 $x_{11}$、$x_{21}$ 和 $x_{22}$：\n从方程 (1) 可得：\n$$\nx_{11} = \\frac{1}{4}s_{11}\n$$\n将此代入方程 (2)：\n$s_{12} = \\frac{1}{2}\\left(\\frac{1}{4}s_{11}\\right) + 2x_{21} \\implies 2x_{21} = s_{12} - \\frac{1}{8}s_{11} \\implies x_{21} = \\frac{1}{2}s_{12} - \\frac{1}{16}s_{11}$。\n所以，\n$$\nx_{21} = -\\frac{1}{16}s_{11} + \\frac{1}{2}s_{12}\n$$\n将 $x_{21}$ 的这个表达式代入方程 (3)：\n$s_{22} = \\left(-\\frac{1}{16}s_{11} + \\frac{1}{2}s_{12}\\right) + \\sqrt{11}x_{22} \\implies \\sqrt{11}x_{22} = s_{22} + \\frac{1}{16}s_{11} - \\frac{1}{2}s_{12}$。\n所以，\n$$\nx_{22} = \\frac{1}{16\\sqrt{11}}s_{11} - \\frac{1}{2\\sqrt{11}}s_{12} + \\frac{1}{\\sqrt{11}}s_{22}\n$$\n\n### 步骤 4：计算条件数\n\n条件数 $\\kappa_{\\max}(A)$ 定义为 $\\sup_{\\delta A \\neq 0} \\frac{\\|\\delta L\\|_{\\max}}{\\|\\delta A\\|_{\\max}}$。设 $\\delta A$ 的独立元素向量为 $\\mathbf{s} = (s_{11}, s_{12}, s_{22})^{\\top}$，$\\delta L$ 的为 $\\mathbf{x} = (x_{11}, x_{21}, x_{22})^{\\top}$。线性关系为 $\\mathbf{x} = M \\mathbf{s}$，其中 $M$ 是雅可比矩阵：\n$$\nM = \\begin{pmatrix}\n\\frac{1}{4}  0  0 \\\\\n-\\frac{1}{16}  \\frac{1}{2}  0 \\\\\n\\frac{1}{16\\sqrt{11}}  -\\frac{1}{2\\sqrt{11}}  \\frac{1}{\\sqrt{11}}\n\\end{pmatrix}\n$$\n问题使用逐元素最大范数，这对应于向量 $\\mathbf{s}$ 和 $\\mathbf{x}$ 上的无穷范数。因此，条件数是诱导矩阵范数 $\\|M\\|_{\\infty \\to \\infty} = \\|M\\|_{\\infty}$，即 $M$ 的最大绝对行和。\n绝对行和为：\n第 1 行: $\\left|\\frac{1}{4}\\right| + |0| + |0| = \\frac{1}{4}$。\n第 2 行: $\\left|-\\frac{1}{16}\\right| + \\left|\\frac{1}{2}\\right| + |0| = \\frac{1}{16} + \\frac{8}{16} = \\frac{9}{16}$。\n第 3 行: $\\left|\\frac{1}{16\\sqrt{11}}\\right| + \\left|-\\frac{1}{2\\sqrt{11}}\\right| + \\left|\\frac{1}{\\sqrt{11}}\\right| = \\frac{1}{16\\sqrt{11}} + \\frac{8}{16\\sqrt{11}} + \\frac{16}{16\\sqrt{11}} = \\frac{1+8+16}{16\\sqrt{11}} = \\frac{25}{16\\sqrt{11}}$。\n\n我们必须找到这三个值的最大值：$\\frac{1}{4}$、$\\frac{9}{16}$ 和 $\\frac{25}{16\\sqrt{11}}$。\n$\\frac{1}{4} = \\frac{4}{16}$，小于 $\\frac{9}{16}$。\n现在我们比较 $\\frac{9}{16}$ 和 $\\frac{25}{16\\sqrt{11}}$。这等价于比较 $9$ 和 $\\frac{25}{\\sqrt{11}}$。\n由于两个量都为正，我们可以比较它们的平方：\n$9^2 = 81$。\n$\\left(\\frac{25}{\\sqrt{11}}\\right)^2 = \\frac{625}{11} \\approx 56.8$。\n由于 $81  \\frac{625}{11}$，我们有 $9  \\frac{25}{\\sqrt{11}}$，因此 $\\frac{9}{16}  \\frac{25}{16\\sqrt{11}}$。\n\n最大绝对行和是 $\\frac{9}{16}$。\n因此，条件数是 $\\kappa_{\\max}(A) = \\|M\\|_{\\infty} = \\frac{9}{16}$。\n\n### 步骤 5：确定最敏感的扰动\n\n最大行和对应于 $M$ 的第二行，该行定义了扰动分量 $x_{21} = \\delta l_{21}$。这意味着 Cholesky 因子的元素 $l_{21}$ 对 $A$ 中的扰动最敏感。当扰动 $\\delta A$ 使 $|\\delta l_{21}|$ 最大化时，上确界中的等号成立。\n$|x_{21}| = |-\\frac{1}{16}s_{11} + \\frac{1}{2}s_{12}|$。\n为了在 $\\|\\delta A\\|_{\\max} = \\max(|s_{11}|, |s_{12}|, |s_{22}|) = 1$ 的约束下最大化这个值，我们选择 $|s_{11}|=1$ 和 $|s_{12}|=1$ 以使各项相加。例如，设 $s_{11}=-1$ 和 $s_{12}=1$。那么\n$|x_{21}| = |(-\\frac{1}{16})(-1) + (\\frac{1}{2})(1)| = \\frac{1}{16} + \\frac{1}{2} = \\frac{9}{16}$。\n对于这个选择，我们必须验证这确实是 $|\\delta L|$ 的最大分量。\n$|x_{11}| = |\\frac{1}{4}s_{11}| = \\frac{1}{4}$。\n$|x_{22}| = |\\frac{1}{16\\sqrt{11}}s_{11} - \\frac{1}{2\\sqrt{11}}s_{12} + \\frac{1}{\\sqrt{11}}s_{22}| = |\\frac{-1}{16\\sqrt{11}} - \\frac{1}{2\\sqrt{11}} + \\frac{s_{22}}{\\sqrt{11}}| = \\frac{1}{\\sqrt{11}} |-\\frac{9}{16} + s_{22}|$。\n对于任何 $|s_{22}| \\le 1$，$|-\\frac{9}{16} + s_{22}|$ 的最大值在 $s_{22}=-1$ 时取得，得到 $|-\\frac{9}{16}-1| = \\frac{25}{16}$。因此，在这种情况下 $|x_{22}|$ 的最大可能值为 $\\frac{25}{16\\sqrt{11}}$，而我们已经证明这个值小于 $\\frac{9}{16}$。\n因此，任何具有独立元素 $(s_{11}, s_{12}, s_{22})$ 且满足 $s_{11} = \\pm 1$、$s_{12} = \\mp 1$ 和 $|s_{22}| \\le 1$ 的扰动 $\\delta A$ 都将产生 $\\frac{\\|\\delta L\\|_{\\max}}{\\|\\delta A\\|_{\\max}} = \\frac{9/16}{1} = \\frac{9}{16}$。这证实了上确界是可以达到的，并且该值是精确的。\n\n分量形式条件数的最终结果是 $\\frac{9}{16}$。", "answer": "$$\\boxed{\\frac{9}{16}}$$", "id": "3568076"}, {"introduction": "矩阵缩放是数值线性代数中一种常用的预处理技术，用以改善问题的条件数。本练习旨在探究一个矩阵 $A$ 与其对角缩放后版本 $\\tilde{A} = DAD$ 的 Cholesky 因子之间的解析关系。你将有机会推导这一关系，并进一步分析后向误差是如何传播的，从而揭示不良的缩放可能如何损害整个计算过程的数值稳定性。[@problem_id:3568113]", "problem": "设 $A \\in \\mathbb{R}^{n \\times n}$ 是对称正定 (SPD) 矩阵，因此存在唯一的对角线元素为正的下三角矩阵 $L$，使得 $A = L L^{\\top}$，这被称为 Cholesky 分解。设 $D = \\mathrm{diag}(d_{1}, \\dots, d_{n})$ 是一个正对角矩阵，其中对所有 $i$ 都有 $d_{i}  0$，并考虑乘法对角缩放 $\\tilde{A} = D A D$。记 $\\tilde{L}$ 为 $\\tilde{A}$ 的 Cholesky 因子，即唯一的对角线元素为正的下三角矩阵，使得 $\\tilde{A} = \\tilde{L} \\tilde{L}^{\\top}$。\n\n从 Cholesky 分解的定义性质以及正对角矩阵对 SPD 矩阵的合同变换效应出发，分析通过 $D$ 进行的缩放如何影响分解结构和唯一性。然后，推导一个从 $\\tilde{L}$ 和 $D$ 恢复原始 Cholesky 因子 $L$ 的显式解析表达式。\n\n此外，假设一个后向稳定的 Cholesky 算法应用于 $\\tilde{A}$，产生一个计算得到的因子 $\\tilde{L}_{\\mathrm{comp}}$，使得存在一个扰动 $\\Delta \\tilde{A}$ 满足 $\\tilde{L}_{\\mathrm{comp}} \\tilde{L}_{\\mathrm{comp}}^{\\top} = \\tilde{A} + \\Delta \\tilde{A}$ 且 $\\|\\Delta \\tilde{A}\\|_{2} \\leq \\gamma \\|\\tilde{A}\\|_{2}$，其中 $\\gamma = c n \\epsilon$，$c$ 是一个适中的常数，$n$ 是维度，$\\epsilon$ 是机器精度。利用基本的范数性质，解释构造 $L_{\\mathrm{rec}} = D^{-1} \\tilde{L}_{\\mathrm{comp}}$ 如何在分解 $A$ 时引入后向误差，以及该误差如何通过 $D$ 的谱条件数依赖于 $D$，但最终答案中不要提供任何不等式或数值界。\n\n你的最终答案必须是关于 $\\tilde{L}$ 和 $D$ 的 $L$ 的单一闭式解析表达式。不需要四舍五入，也没有物理单位适用。", "solution": "首先验证问题陈述，以确保其自洽、科学上合理且适定。\n\n### 步骤1：提取已知条件\n- $A \\in \\mathbb{R}^{n \\times n}$ 是一个对称正定 (SPD) 矩阵。\n- $A$ 的 Cholesky 分解为 $A = L L^{\\top}$，其中 $L$ 是唯一的对角线元素为正的下三角矩阵。\n- $D = \\mathrm{diag}(d_{1}, \\dots, d_{n})$ 是一个正对角矩阵，意味着对所有 $i = 1, \\dots, n$ 都有 $d_i  0$。\n- 一个乘法缩放矩阵 $\\tilde{A}$ 定义为 $\\tilde{A} = D A D$。\n- $\\tilde{A}$ 的 Cholesky 分解为 $\\tilde{A} = \\tilde{L} \\tilde{L}^{\\top}$，其中 $\\tilde{L}$ 是唯一的对角线元素为正的下三角矩阵。\n- 一个后向稳定的 Cholesky 算法计算 $\\tilde{A}$ 的因子 $\\tilde{L}_{\\mathrm{comp}}$，使得 $\\tilde{L}_{\\mathrm{comp}} \\tilde{L}_{\\mathrm{comp}}^{\\top} = \\tilde{A} + \\Delta \\tilde{A}$，且后向误差满足 $\\|\\Delta \\tilde{A}\\|_{2} \\leq \\gamma \\|\\tilde{A}\\|_{2}$，其中 $\\gamma = c n \\epsilon$，$c$ 为一个适中的常数，$n$ 为矩阵维度，$\\epsilon$ 为机器精度。\n- 为 $A$ 恢复的因子形如 $L_{\\mathrm{rec}} = D^{-1} \\tilde{L}_{\\mathrm{comp}}$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题设置在数值线性代数的背景下。所有概念——对称正定矩阵、Cholesky 分解、对角缩放和后向误差分析——都是标准的且有严格定义。一个 SPD 矩阵 $A$ 经由一个非奇异矩阵 $D$ 的合同变换，例如 $\\tilde{A} = DAD = DAD^{\\top}$，会保持其 SPD 性质。因此，$\\tilde{A}$ 保证是 SPD 矩阵并拥有其自己唯一的 Cholesky 分解。该问题在事实上和数学上都是合理的。\n- **适定性**：该问题要求两件事：一个解析表达式和一个概念性解释。从缩放后的 Cholesky 因子推导另一个 Cholesky 因子是一个确定性的代数操作。Cholesky 分解的唯一性是关键，并且被正确陈述。后向误差分析是数值分析中的标准程序。该问题没有歧义，并有通往唯一解的清晰路径。\n- **客观性**：该问题使用形式化的数学语言和符号陈述。不存在主观或基于观点的断言。\n- **完整性**：所有必要的定义和关系都已提供。该问题是自洽的。\n- **结论**：该问题有效。\n\n### 解答推导\n\n第一个任务是推导一个关于缩放后的 Cholesky 因子 $\\tilde{L}$ 和缩放矩阵 $D$ 的原始 Cholesky 因子 $L$ 的显式解析表达式。\n\n我们已知以下关系：\n1.  $\\tilde{A} = D A D$\n2.  $A = L L^{\\top}$\n3.  $\\tilde{A} = \\tilde{L} \\tilde{L}^{\\top}$\n\n我们将 (2) 中 $A$ 的表达式代入 (1)：\n$$\n\\tilde{A} = D (L L^{\\top}) D\n$$\n由于 $D$ 是对角矩阵，它是对称的，即 $D = D^{\\top}$。我们可以将表达式重写为：\n$$\n\\tilde{A} = D L L^{\\top} D^{\\top}\n$$\n利用矩阵乘积转置的性质 $(XY)^{\\top} = Y^{\\top}X^{\\top}$，我们可以将各项组合为：\n$$\n\\tilde{A} = (D L) (L^{\\top} D^{\\top}) = (D L) (D L)^{\\top}\n$$\n我们现在有两个关于 $\\tilde{A}$ 的 Cholesky 分解的表达式：\n$$\n\\tilde{A} = \\tilde{L} \\tilde{L}^{\\top} \\quad \\text{和} \\quad \\tilde{A} = (D L) (D L)^{\\top}\n$$\n对称正定矩阵的 Cholesky 分解是唯一的。该唯一因子要求是一个对角线元素严格为正的下三角矩阵。让我们来检验矩阵 $(D L)$ 的性质。\n- **三角性：**$L$ 是下三角矩阵，$D$ 是对角矩阵。对角矩阵与下三角矩阵的乘积是下三角矩阵。具体来说，乘积的第 $(i,j)$ 个元素是 $(DL)_{ij} = \\sum_{k=1}^{n} D_{ik}L_{kj}$。由于 $D$ 是对角的，$D_{ik} = 0$ 对于 $k \\ne i$，所以 $(DL)_{ij} = D_{ii}L_{ij} = d_i L_{ij}$。如果 $j  i$，$L_{ij} = 0$，这意味着 $(DL)_{ij} = 0$。因此，$DL$ 是下三角矩阵。\n- **正对角线：**$L$ 的对角线元素，记作 $L_{ii}$，都是正数。$D$ 的对角线元素 $d_i$ 也被给定为正数。乘积 $DL$ 的对角线元素是 $(DL)_{ii} = d_i L_{ii}$。因为 $d_i  0$ 且 $L_{ii}  0$，它们的乘积 $d_i L_{ii}$ 也严格为正。\n\n因此，矩阵 $(D L)$ 是一个对角线元素为正的下三角矩阵。根据 Cholesky 分解的唯一性，我们必有：\n$$\n\\tilde{L} = D L\n$$\n问题要求一个从 $\\tilde{L}$ 和 $D$ 恢复 $L$ 的表达式。由于 $D$ 的所有对角线元素 $d_i$ 都是正数，所以 $D$ 是可逆的。其逆矩阵 $D^{-1}$ 是一个对角线元素为 $1/d_i$ 的对角矩阵。我们可以用 $D^{-1}$ 左乘该方程来解出 $L$：\n$$\nD^{-1} \\tilde{L} = D^{-1} (D L) = (D^{-1} D) L = I L = L\n$$\n因此，$L$ 的表达式是：\n$$\nL = D^{-1} \\tilde{L}\n$$\n\n第二个任务是解释使用计算得到的因子时的后向误差传播。我们已知关于计算因子 $\\tilde{L}_{\\mathrm{comp}}$ 的关系：\n$$\n\\tilde{L}_{\\mathrm{comp}} \\tilde{L}_{\\mathrm{comp}}^{\\top} = \\tilde{A} + \\Delta \\tilde{A}\n$$\n为原始矩阵 $A$ 恢复的因子定义为 $L_{\\mathrm{rec}} = D^{-1} \\tilde{L}_{\\mathrm{comp}}$。让我们确定 $L_{\\mathrm{rec}}$ 是哪个矩阵的精确 Cholesky 因子。设这个矩阵为 $A + \\Delta A$。\n$$\nA + \\Delta A = L_{\\mathrm{rec}} L_{\\mathrm{rec}}^{\\top} = (D^{-1} \\tilde{L}_{\\mathrm{comp}}) (D^{-1} \\tilde{L}_{\\mathrm{comp}})^{\\top}\n$$\n利用转置性质和 $D^{-1} = (D^{-1})^{\\top}$（因为 $D^{-1}$ 是对角矩阵）：\n$$\nA + \\Delta A = D^{-1} \\tilde{L}_{\\mathrm{comp}} \\tilde{L}_{\\mathrm{comp}}^{\\top} (D^{-1})^{\\top} = D^{-1} (\\tilde{L}_{\\mathrm{comp}} \\tilde{L}_{\\mathrm{comp}}^{\\top}) D^{-1}\n$$\n代入计算因子的后向误差关系：\n$$\nA + \\Delta A = D^{-1} (\\tilde{A} + \\Delta \\tilde{A}) D^{-1} = D^{-1} \\tilde{A} D^{-1} + D^{-1} \\Delta \\tilde{A} D^{-1}\n$$\n我们知道 $\\tilde{A} = D A D$。将此代入第一项：\n$$\nD^{-1} \\tilde{A} D^{-1} = D^{-1} (D A D) D^{-1} = (D^{-1} D) A (D D^{-1}) = I A I = A\n$$\n因此，扰动后的矩阵是 $A + \\Delta A = A + D^{-1} \\Delta \\tilde{A} D^{-1}$。这意味着在 $A$ 的分解中引入的后向误差是 $\\Delta A = D^{-1} \\Delta \\tilde{A} D^{-1}$。\n\n为了理解这个误差如何依赖于 $D$，我们可以分析其范数。后向误差 $\\Delta A$ 的范数通过一个涉及 $D^{-1}$ 的合同变换与 $\\Delta \\tilde{A}$ 的范数相关。$\\Delta A$ 的 2-范数边界如下：\n$$\n\\|\\Delta A\\|_2 = \\|D^{-1} \\Delta \\tilde{A} D^{-1}\\|_2 \\leq \\|D^{-1}\\|_2 \\|\\Delta \\tilde{A}\\|_2 \\|D^{-1}\\|_2 = \\|D^{-1}\\|_2^2 \\|\\Delta \\tilde{A}\\|_2\n$$\n应用于 $\\tilde{A}$ 的算法的后向稳定性保证了 $\\|\\Delta \\tilde{A}\\|_2$ 相对于 $\\|\\tilde{A}\\|_2$ 是小的。具体来说，$\\|\\Delta \\tilde{A}\\|_2 \\leq \\gamma \\|\\tilde{A}\\|_2 = \\gamma \\|DAD\\|_2$。\n$$\n\\|\\Delta A\\|_2 \\leq \\gamma \\|D^{-1}\\|_2^2 \\|DAD\\|_2 \\leq \\gamma \\|D^{-1}\\|_2^2 \\|D\\|_2^2 \\|A\\|_2\n$$\n乘积 $\\|D\\|_2 \\|D^{-1}\\|_2$ 是 $D$ 的谱条件数，记作 $\\kappa_2(D)$。因此，$A$ 中的相对后向误差由以下不等式界定：\n$$\n\\frac{\\|\\Delta A\\|_2}{\\|A\\|_2} \\leq \\gamma (\\kappa_2(D))^2\n$$\n这表明，通过从缩放问题中恢复其因子而得到的原始矩阵 $A$ 的后向误差不保证是小的。误差被一个因子 $(\\kappa_2(D))^2$ 放大。条件数 $\\kappa_2(D)$ 是最大缩放因子与最小缩放因子之比，$\\kappa_2(D) = (\\max_i d_i) / (\\min_i d_i)$。如果缩放因子 $d_i$ 差异很大，$\\kappa_2(D)$ 将会很大，并且即使对缩放矩阵 $\\tilde{A}$ 的计算是后向稳定的，恢复的 $A$ 的解也可能不是后向稳定的。因此，整个过程的稳定性关键取决于缩放矩阵 $D$ 的条件数。", "answer": "$$\n\\boxed{L = D^{-1} \\tilde{L}}\n$$", "id": "3568113"}, {"introduction": "在精确算术中，Cholesky 分解对任何对称正定矩阵都能成功，但在浮点运算中，舍入误差可能导致算法对病态或接近半定的矩阵失败。这个动手编程练习将带你直面这一现实挑战，并实践一种常用的解决方案：对角正则化。你将需要从后向误差分析出发，推导保证分解成功的理论正则化量，并将其与通过数值实验找到的经验阈值进行比较，从而连接理论分析与实际应用。[@problem_id:3568148]", "problem": "给定一些实对称矩阵，它们是半正定 (PSD) 或近似半正定的，因此在精确算术中，它们至少不是强不定的。在单位舍入（机器 epsilon）为 $\\varepsilon$ 的浮点算术中，即使矩阵是半正定的，当计算出的主元因舍入而变为微小的负数时，不带主元选择的标准 Cholesky 分解也可能失败。减轻这种失败的一个稳健方法是添加一个对角扰动并分解 $A + \\delta I$，其中 $\\delta \\ge 0$，$I$ 是单位矩阵。您的任务是设计这样一个扰动，并比较理论推导的阈值与经验观察到的阈值。\n\n使用的基本原理：\n- 浮点算术满足标准模型 $\\operatorname{fl}(x \\circ y) = (x \\circ y)(1 + \\theta)$，其中对于每个基本算术运算 $\\circ$，都有 $|\\theta| \\le \\varepsilon$。\n- Cholesky 算法在以下意义上是后向稳定的：计算出的分解对应于 $A + \\Delta$ 的精确 Cholesky 分解，其中 $\\Delta$ 是一个对称矩阵，其谱范数由 $n \\varepsilon \\lVert A \\rVert_2$ 的一个常数倍所界定，$n$ 是矩阵维度，该常数不依赖于 $A$。\n\n问题要求：\n1. 仅从上述基本原理以及特征值和算子范数的定义出发，推导一个关于 $\\delta$ 的充分条件，以保证 $A + \\delta I$ 的 Cholesky 分解在浮点算术中能够成功。您的推导必须将满足您充分条件的最小 $\\delta$ 表示为最小特征值 $\\lambda_{\\min}(A)$、谱范数 $\\lVert A \\rVert_2$、维度 $n$、机器 epsilon $\\varepsilon$ 以及与 Cholesky 后向误差界相关的适度绝对常数 $c_{\\text{chol}}$ 的函数。除上述基本原理外，不要使用任何特殊公式。\n\n2. 使用您推导出的界，通过代入 $c_{\\text{chol}} = 5$ 和 $n = 3$ 来定义理论阈值 $\\delta_{\\text{th}}(A,\\varepsilon)$。\n\n3. 对于下面列出的每个测试矩阵 $A$，计算：\n   - 理论阈值 $\\delta_{\\text{th}}(A,\\varepsilon)$。\n   - 经验阈值 $\\delta_{\\text{emp}}(A,\\varepsilon)$，定义为能使标准双精度 Cholesky 分解 $A + \\delta I$ 无误成功的最小 $\\delta \\ge 0$（在固定的绝对或相对容差范围内）。必须通过一个从 $\\delta = 0$ 开始、仅在需要时增加 $\\delta$ 的确定性搜索过程来找到该经验阈值。\n\n4. 测试必须在双精度（IEEE $754$ binary64）下进行，$\\varepsilon$ 必须从执行环境中获取。不涉及物理单位。\n\n5. 测试套件。使用以下对称矩阵（每个矩阵大小为 $3 \\times 3$），此处以精确十进制形式写出其元素：\n   - $A_1 = \\begin{bmatrix}\n      1.0  0.999999999999  0.0 \\\\\n      0.999999999999  1.0  0.0 \\\\\n      0.0  0.0  1.0\\times 10^{-12}\n   \\end{bmatrix}$\n   - $A_2 = \\begin{bmatrix}\n      1.0  1.0  1.0 \\\\\n      1.0  1.0  1.0 \\\\\n      1.0  1.0  1.0\n   \\end{bmatrix}$\n   - $A_3 = \\begin{bmatrix}\n      1.0  0.0  0.0 \\\\\n      0.0  1.0\\times 10^{-8}  0.0 \\\\\n      0.0  0.0  -1.0\\times 10^{-14}\n   \\end{bmatrix}$\n   - $A_4 = \\begin{bmatrix}\n      1.0\\times 10^{-16}  0.0  0.0 \\\\\n      0.0  2.0\\times 10^{-16}  0.0 \\\\\n      0.0  0.0  3.0\\times 10^{-16}\n   \\end{bmatrix}$\n\n6. 输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个 $A_i$，按顺序输出 $\\delta_{\\text{th}}(A_i,\\varepsilon)$ 和 $\\delta_{\\text{emp}}(A_i,\\varepsilon)$ 对，并将所有测试用例的结果展开。具体来说，输出必须是以下形式\n   $[\\delta_{\\text{th}}(A_1,\\varepsilon),\\delta_{\\text{emp}}(A_1,\\varepsilon),\\delta_{\\text{th}}(A_2,\\varepsilon),\\delta_{\\text{emp}}(A_2,\\varepsilon),\\delta_{\\text{th}}(A_3,\\varepsilon),\\delta_{\\text{emp}}(A_3,\\varepsilon),\\delta_{\\text{th}}(A_4,\\varepsilon),\\delta_{\\text{emp}}(A_4,\\varepsilon)]$\n   其中每个条目都是使用所用语言原生格式的浮点数。\n\n澄清与约束：\n- 您必须使用对称特征值分解（即通过 $A$ 的特征值）来计算谱范数 $\\lVert A \\rVert_2$ 和最小特征值 $\\lambda_{\\min}(A)$。\n- 对于经验阈值，您必须实现一个确定性搜索策略，该策略首先测试 $\\delta = 0$，然后单调增加 $\\delta$ 直至成功，最后进行精化以在合理容差内逼近最小的 $\\delta$。您的方法必须对 $\\delta_{\\text{emp}}$ 极小的情况具有稳健性。\n- 程序必须是自包含的，并以上述指定的精确格式生成单行输出。", "solution": "该问题经评估为**有效**。这是一个数值线性代数中的良置问题，基于浮点误差分析和矩阵理论的标准原理。所有必要的数据和定义都已提供，要求具体且客观。\n\n### 1. 理论阈值 $\\delta_{\\text{th}}$ 的推导\n\n实对称矩阵的 Cholesky 分解当且仅当该矩阵是正定时才能成功。在浮点算术中，矩阵 $B$ 计算出的 Cholesky 因子 $\\hat{L}$ 是一个扰动矩阵 $B+E$ 的精确因子，其中 $E$ 是表示后向误差的对称矩阵。问题给出了这个误差谱范数的一个界：\n$$ \\|E\\|_2 \\le c_{\\text{chol}} n \\varepsilon \\|B\\|_2 $$\n其中 $n$ 是矩阵的维度，$\\varepsilon$ 是机器 epsilon，$c_{\\text{chol}}$ 是一个适度的常数。\n\n我们的目标是找到一个关于 $\\delta \\ge 0$ 的充分条件，使得 $B = A + \\delta I$ 的 Cholesky 分解能够成功。这意味着矩阵 $B+E = (A + \\delta I) + E$ 必须是正定的。一个矩阵是正定的当且仅当其所有特征值都严格为正。因此，我们要求 $\\lambda_{\\min}((A + \\delta I) + E)  0$。\n\n使用关于对称矩阵之和的特征值的 Weyl 不等式，我们有：\n$$ \\lambda_{\\min}((A + \\delta I) + E) \\ge \\lambda_{\\min}(A + \\delta I) + \\lambda_{\\min}(E) $$\n对称矩阵 $E$ 的特征值都是实数。其谱范数为 $\\|E\\|_2 = \\max_i |\\lambda_i(E)|$。这意味着最小特征值 $\\lambda_{\\min}(E)$ 的下界是 $-\\|E\\|_2$。因此，$\\lambda_{\\min}((A + \\delta I) + E)  0$ 的一个充分条件是：\n$$ \\lambda_{\\min}(A + \\delta I) - \\|E\\|_2  0 \\quad \\implies \\quad \\lambda_{\\min}(A + \\delta I)  \\|E\\|_2 $$\n$A + \\delta I$ 的特征值是 $\\lambda_i(A) + \\delta$。因此，$\\lambda_{\\min}(A + \\delta I) = \\lambda_{\\min}(A) + \\delta$。将此式以及 $E$ 的后向误差界（其中 $B = A + \\delta I$）代入不等式，我们得到：\n$$ \\lambda_{\\min}(A) + \\delta  c_{\\text{chol}} n \\varepsilon \\|A + \\delta I\\|_2 $$\n为了继续推导，我们需要用已知量来表示 $\\|A + \\delta I\\|_2$。对于对称矩阵，谱范数是其特征值的最大绝对值。我们选择的 $\\delta$ 是为了使 $A+\\delta I$ 成为正定或至少是半正定矩阵。对于一个半正定矩阵 $M$，$\\|M\\|_2 = \\lambda_{\\max}(M)$。假设我们选择的 $\\delta$ 足以使 $A+\\delta I$ 至少是半正定的（即 $\\lambda_{\\min}(A) + \\delta \\ge 0$），那么：\n$$ \\|A + \\delta I\\|_2 = \\lambda_{\\max}(A + \\delta I) = \\lambda_{\\max}(A) + \\delta $$\n对于问题中给出的近似半正定矩阵，$\\lambda_{\\max}(A) = \\|A\\|_2$。用 $\\|A\\|_2$ 替换 $\\lambda_{\\max}(A)$ 得到：\n$$ \\|A + \\delta I\\|_2 = \\|A\\|_2 + \\delta $$\n不等式变为：\n$$ \\lambda_{\\min}(A) + \\delta  c_{\\text{chol}} n \\varepsilon (\\|A\\|_2 + \\delta) $$\n我们现在解出 $\\delta$：\n$$ \\lambda_{\\min}(A) + \\delta  c_{\\text{chol}} n \\varepsilon \\|A\\|_2 + c_{\\text{chol}} n \\varepsilon \\delta $$\n$$ \\delta (1 - c_{\\text{chol}} n \\varepsilon)  c_{\\text{chol}} n \\varepsilon \\|A\\|_2 - \\lambda_{\\min}(A) $$\n由于 $c_{\\text{chol}} n \\varepsilon \\ll 1$，项 $(1 - c_{\\text{chol}} n \\varepsilon)$ 是正的。因此，我们可以用它来除不等式两边而不改变不等式的方向：\n$$ \\delta  \\frac{c_{\\text{chol}} n \\varepsilon \\|A\\|_2 - \\lambda_{\\min}(A)}{1 - c_{\\text{chol}} n \\varepsilon} $$\n满足此充分条件的最小 $\\delta$ 是右侧的表达式。由于 $\\delta$ 必须是非负的，我们取该表达式与 $0$ 的最大值。\n\n问题指定 $c_{\\text{chol}} = 5$ 和 $n = 3$。因此，理论阈值 $\\delta_{\\text{th}}(A, \\varepsilon)$ 定义为：\n$$ \\delta_{\\text{th}}(A, \\varepsilon) = \\max\\left(0, \\frac{15 \\varepsilon \\|A\\|_2 - \\lambda_{\\min}(A)}{1 - 15 \\varepsilon}\\right) $$\n$\\lambda_{\\min}(A)$ 和 $\\|A\\|_2$ 的值由 $A$ 的特征值计算得出。\n\n### 2. 经验阈值 $\\delta_{\\text{emp}}$ 的方法\n\n经验阈值 $\\delta_{\\text{emp}}(A, \\varepsilon)$ 是使 $A + \\delta I$ 的浮点 Cholesky 分解成功的最小非负值 $\\delta$。我们使用确定性搜索过程来找到这个值：\n\n1.  **检查 $\\delta = 0$**：首先，尝试计算 $A$ 的 Cholesky 分解。如果成功，则 $\\delta_{\\text{emp}}(A, \\varepsilon) = 0$。\n\n2.  **寻找上界**：如果 $\\delta=0$ 时的分解失败，我们需要找到一个 $\\delta  0$ 使其成功。我们从一个小的初始猜测值 $\\delta_{\\text{high}} = \\varepsilon \\cdot \\max(1, \\|A\\|_2)$ 开始，并重复将其加倍 ($\\delta_{\\text{high}} \\leftarrow 2\\delta_{\\text{high}}$)，直到 $A + \\delta_{\\text{high}} I$ 的分解成功。这个过程保证能找到 $\\delta_{\\text{emp}}$ 的一个上界。\n\n3.  **二分搜索**：一旦我们有了一个区间 $[\\delta_{\\text{low}}, \\delta_{\\text{high}}]$，其中分解在 $\\delta_{\\text{low}}$ 处失败，在 $\\delta_{\\text{high}}$ 处成功（初始时，$\\delta_{\\text{low}}$ 为 $0$ 或 $\\delta_{\\text{high}}/2$），我们使用二分法来精化估计。我们反复测试中点 $\\delta_{\\text{mid}} = (\\delta_{\\text{low}} + \\delta_{\\text{high}})/2$。如果分解成功，我们设置 $\\delta_{\\text{high}} = \\delta_{\\text{mid}}$；否则，我们设置 $\\delta_{\\text{low}} = \\delta_{\\text{mid}}$。这个过程会持续固定的迭代次数（$100$ 次），以收敛到一个非常接近真实阈的值。最终的 $\\delta_{\\text{emp}}$ 是找到的能通过测试的最小值，即最终的 $\\delta_{\\text{high}}$。\n\n这种指数搜索后接二分搜索的组合既是确定性的又高效。所有 Cholesky 分解的尝试都包装在一个 try-except 块中，以捕获标志失败的 `numpy.linalg.LinAlgError`。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_delta_th(A, epsilon):\n    \"\"\"\n    Computes the theoretical threshold delta_th based on the derived formula.\n    \"\"\"\n    n = 3\n    c_chol = 5\n    \n    # For a symmetric matrix, eigenvalues are real. np.linalg.eigvalsh is efficient and stable.\n    eigvals = np.linalg.eigvalsh(A)\n    lambda_min = np.min(eigvals)\n    # The spectral norm of a symmetric matrix is the maximum absolute eigenvalue.\n    norm_A = np.max(np.abs(eigvals))\n    \n    cne = c_chol * n * epsilon\n    \n    # Formula derived in the solution part:\n    # delta  (c_chol * n * epsilon * ||A||_2 - lambda_min(A)) / (1 - c_chol * n * epsilon)\n    numerator = cne * norm_A - lambda_min\n    \n    # If numerator is non-positive, the original matrix is already \"sufficiently\" positive definite.\n    if numerator = 0:\n        return 0.0\n    \n    denominator = 1 - cne\n    \n    return numerator / denominator\n\ndef compute_delta_emp(A):\n    \"\"\"\n    Computes the empirical threshold delta_emp using a deterministic search.\n    \"\"\"\n    def check_cholesky(delta):\n        \"\"\"Helper function to test Cholesky factorization for A + delta*I.\"\"\"\n        try:\n            # Use a copy of A to avoid modifying the original test case matrix\n            A_pert = A + delta * np.identity(A.shape[0])\n            np.linalg.cholesky(A_pert)\n            return True\n        except np.linalg.LinAlgError:\n            return False\n\n    # 1. Check if delta = 0 works.\n    if check_cholesky(0.0):\n        return 0.0\n\n    # 2. Find an upper bound for delta where Cholesky succeeds.\n    # Start with a small guess related to machine epsilon and the matrix norm.\n    norm_A = np.linalg.norm(A, 2)\n    delta_high = np.finfo(float).eps * max(1.0, norm_A)\n    if delta_high == 0: # Case where A is the zero matrix\n        delta_high = np.finfo(float).eps\n\n    # Exponentially increase delta until we find a working value.\n    initial_guess = delta_high\n    while not check_cholesky(delta_high):\n        delta_high *= 2.0\n\n    # 3. Bisection search to refine the threshold.\n    # The lower bound is a value we know fails.\n    if delta_high == initial_guess:\n        delta_low = 0.0\n    else:\n        delta_low = delta_high / 2.0\n\n    # 100 iterations are more than sufficient for double precision convergence.\n    for _ in range(100):\n        delta_mid = delta_low + (delta_high - delta_low) / 2.0\n        # If we reach the limit of floating point precision, stop.\n        if delta_mid == delta_low or delta_mid == delta_high:\n            break\n        \n        if check_cholesky(delta_mid):\n            delta_high = delta_mid  # Midpoint works, try smaller values.\n        else:\n            delta_low = delta_mid   # Midpoint fails, need larger values.\n            \n    # Return the smallest value found that allows Cholesky to succeed.\n    return delta_high\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the results.\n    \"\"\"\n    # Get machine epsilon for double precision from the execution environment.\n    epsilon = np.finfo(float).eps\n    \n    # Define the test cases from the problem statement.\n    a12 = 0.999999999999\n    \n    test_cases = [\n        np.array([\n            [1.0, a12, 0.0],\n            [a12, 1.0, 0.0],\n            [0.0, 0.0, 1.0e-12]\n        ]),\n        np.array([\n            [1.0, 1.0, 1.0],\n            [1.0, 1.0, 1.0],\n            [1.0, 1.0, 1.0]\n        ]),\n        np.array([\n            [1.0, 0.0, 0.0],\n            [0.0, 1.0e-8, 0.0],\n            [0.0, 0.0, -1.0e-14]\n        ]),\n        np.array([\n            [1.0e-16, 0.0, 0.0],\n            [0.0, 2.0e-16, 0.0],\n            [0.0, 0.0, 3.0e-16]\n        ]),\n    ]\n\n    results = []\n    for A in test_cases:\n        delta_th = compute_delta_th(A, epsilon)\n        delta_emp = compute_delta_emp(A)\n        results.extend([delta_th, delta_emp])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3568148"}]}