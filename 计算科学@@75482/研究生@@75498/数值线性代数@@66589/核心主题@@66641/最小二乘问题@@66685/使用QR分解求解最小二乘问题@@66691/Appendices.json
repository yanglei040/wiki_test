{"hands_on_practices": [{"introduction": "要掌握使用 QR 分解求解最小二乘问题的核心思想，最好的方法莫过于从一个清晰的数值示例开始。这个练习将引导你完成一个完整的计算流程，从构建 QR 分解到求解最终解。我们特意选择了一个列向量已经正交的矩阵 $A$，这使得 QR 分解的计算（即列的归一化）变得异常简单，从而让你能更专注于理解求解过程的整体结构以及验证残差向量与 $A$ 的列空间正交这一关键性质。[@problem_id:3577850]", "problem": "设 $A \\in \\mathbb{R}^{5 \\times 3}$ 和 $B \\in \\mathbb{R}^{5 \\times 2}$ 由下式给出\n$$\nA \\;=\\; \\begin{pmatrix}\n2  0  0 \\\\\n0  2  0 \\\\\n0  0  3 \\\\\n1  0  0 \\\\\n0  1  0\n\\end{pmatrix},\n\\qquad\nB \\;=\\; \\begin{pmatrix}\n1  -1 \\\\\n2  0 \\\\\n3  1 \\\\\n4  -2 \\\\\n5  2\n\\end{pmatrix}.\n$$\n考虑寻找 $X \\in \\mathbb{R}^{3 \\times 2}$ 的线性最小二乘问题，该问题旨在最小化残差的弗罗贝尼乌斯范数，即最小化 $\\|A X - B\\|_{F}$，其中 $\\|\\cdot\\|_{F}$ 表示弗罗贝尼乌斯范数。使用最小二乘法的一阶最优性条件和 $A$ 的正交三角分解 (QR)，推导在 $A$ 具有满列秩的假设下获得唯一最小化子 $X$ 的计算过程。然后，使用这些具体矩阵，进行 $X$ 的计算，并对 $B$ 的每个右端列 $b_{1}$ 和 $b_{2}$，验证相应的残差向量 $r_{1} = b_{1} - A x_{1}$ 和 $r_{2} = b_{2} - A x_{2}$ 与 $A$ 的每一列都正交。作为最终的标量输出，报告 $\\|B - A X\\|_{F}$ 的精确值。不要近似或四舍五入；提供精确值。", "solution": "该问题按如下方式进行验证。\n\n**步骤1：提取已知条件**\n- 矩阵 $A \\in \\mathbb{R}^{5 \\times 3}$ 和 $B \\in \\mathbb{R}^{5 \\times 2}$ 如下所示：\n$$\nA \\;=\\; \\begin{pmatrix}\n2  0  0 \\\\\n0  2  0 \\\\\n0  0  3 \\\\\n1  0  0 \\\\\n0  1  0\n\\end{pmatrix},\n\\qquad\nB \\;=\\; \\begin{pmatrix}\n1  -1 \\\\\n2  0 \\\\\n3  1 \\\\\n4  -2 \\\\\n5  2\n\\end{pmatrix}.\n$$\n- 问题是寻找 $X \\in \\mathbb{R}^{3 \\times 2}$ 以最小化残差的弗罗贝尼乌斯范数 $\\|A X - B\\|_{F}$。\n- 所使用的方法基于一阶最优性条件和 $A$ 的QR分解。\n- 假设 $A$ 具有满列秩。\n- 需要一个验证步骤：对于解 $X = \\begin{pmatrix} x_1  x_2 \\end{pmatrix}$，必须证明残差向量 $r_1 = b_1 - A x_1$ 和 $r_2 = b_2 - A x_2$ 与 $A$ 的每一列都正交。\n- 最终输出必须是 $\\|B - A X\\|_{F}$ 的精确值。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题是数值线性代数的一个标准应用，特别是求解矩阵最小二乘问题。弗罗贝尼乌斯范数、QR分解和正规方程等概念是基础且成熟的。该问题在科学上是合理的。\n- **适定性：** $\\|A X - B\\|_{F}$ 的唯一最小化子存在的充分必要条件是矩阵 $A$ 具有满列秩。$A$ 的列向量为 $a_1 = (2, 0, 0, 1, 0)^T$，$a_2 = (0, 2, 0, 0, 1)^T$ 和 $a_3 = (0, 0, 3, 0, 0)^T$。线性组合 $c_1 a_1 + c_2 a_2 + c_3 a_3 = 0$ 导出方程组 $2c_1 = 0$，$2c_2 = 0$，$3c_3 = 0$，$c_1=0$ 和 $c_2=0$。唯一的解是 $c_1=c_2=c_3=0$，这证明了 $A$ 的列是线性无关的。因此，$A$ 具有满列秩（秩为3），该问题是适定的。\n- **客观性：** 问题以精确、客观的数学语言陈述。\n\n**步骤3：结论与行动**\n该问题是有效的。将提供完整的解答。\n\n**计算过程的推导**\n问题在于找到 $X \\in \\mathbb{R}^{3 \\times 2}$ 来最小化 $\\|AX - B\\|_F$。这等价于最小化弗罗贝尼乌斯范数的平方，$F(X) = \\|AX - B\\|_F^2$。矩阵的弗罗贝尼乌斯范数是其所有元素的平方和，因此最小化 $\\|AX-B\\|_F$ 等价于为 $X$ 的每一列求解两个独立的向量最小二乘问题：\n$$\n\\min_{x_j \\in \\mathbb{R}^{3 \\times 1}} \\|Ax_j - b_j\\|_2 \\quad \\text{for } j=1, 2\n$$\n其中 $X = \\begin{pmatrix} x_1  x_2 \\end{pmatrix}$ 且 $B = \\begin{pmatrix} b_1  b_2 \\end{pmatrix}$。\n\n一阶最优性条件是目标函数关于 $X$ 的梯度为零矩阵。目标函数为 $F(X) = \\operatorname{tr}((AX-B)^T(AX-B))$。\n$$\nF(X) = \\operatorname{tr}(X^T A^T A X - X^T A^T B - B^T A X + B^T B)\n$$\n对 $X$ 求导并令其为零，得到矩阵形式的正规方程：\n$$\n\\nabla_X F(X) = 2A^T A X - 2A^T B = 0 \\implies A^T A X = A^T B\n$$\n一阶条件要求残差 $AX - B$ 必须与 $A$ 的列空间正交，表示为 $A^T(AX-B)=0$。\n\n为稳健地求解此系统，我们使用 $A$ 的简约QR分解，即 $A = Q_1 R_1$。这里，$A \\in \\mathbb{R}^{m \\times n}$ ($m=5, n=3$)，$Q_1 \\in \\mathbb{R}^{m \\times n}$ 具有标准正交列，而 $R_1 \\in \\mathbb{R}^{n \\times n}$ 是一个上三角矩阵。由于 $A$ 具有满列秩，$R_1$ 是可逆的。\n\n将 $A = Q_1 R_1$ 代入正规方程：\n$$\n(Q_1 R_1)^T (Q_1 R_1) X = (Q_1 R_1)^T B\n$$\n$$\nR_1^T Q_1^T Q_1 R_1 X = R_1^T Q_1^T B\n$$\n由于 $Q_1$ 具有标准正交列，$Q_1^T Q_1 = I_n$，即 $n \\times n$ 单位矩阵。\n$$\nR_1^T R_1 X = R_1^T Q_1^T B\n$$\n由于 $R_1$ 是可逆的，$R_1^T$ 也是可逆的。从左侧乘以 $(R_1^T)^{-1}$ 得到：\n$$\nR_1 X = Q_1^T B\n$$\n这是一个上三角方程组，可以通过回代法高效地求解 $X$。\n\n**解的计算**\n首先，我们计算 $A$ 的简约QR分解。$A$ 的列是 $a_1, a_2, a_3$。\n$a_1 = (2, 0, 0, 1, 0)^T$, $a_2 = (0, 2, 0, 0, 1)^T$, $a_3 = (0, 0, 3, 0, 0)^T$。\n我们检查正交性：\n$a_1^T a_2 = 2 \\cdot 0 + 0 \\cdot 2 + 0 \\cdot 0 + 1 \\cdot 0 + 0 \\cdot 1 = 0$\n$a_1^T a_3 = 2 \\cdot 0 + 0 \\cdot 0 + 0 \\cdot 3 + 1 \\cdot 0 + 0 \\cdot 0 = 0$\n$a_2^T a_3 = 0 \\cdot 0 + 2 \\cdot 0 + 0 \\cdot 3 + 0 \\cdot 0 + 1 \\cdot 0 = 0$\n$A$ 的列已经是正交的。因此，Gram-Schmidt过程简化为对每列进行单位化。\n$\\|a_1\\|_2 = \\sqrt{2^2 + 0^2 + 0^2 + 1^2 + 0^2} = \\sqrt{5}$\n$\\|a_2\\|_2 = \\sqrt{0^2 + 2^2 + 0^2 + 0^2 + 1^2} = \\sqrt{5}$\n$\\|a_3\\|_2 = \\sqrt{0^2 + 0^2 + 3^2 + 0^2 + 0^2} = 3$\n矩阵 $Q_1$ 的列为 $q_j = a_j / \\|a_j\\|_2$：\n$$\nQ_1 = \\begin{pmatrix}\n2/\\sqrt{5}  0  0 \\\\\n0  2/\\sqrt{5}  0 \\\\\n0  0  1 \\\\\n1/\\sqrt{5}  0  0 \\\\\n0  1/\\sqrt{5}  0\n\\end{pmatrix}\n$$\n矩阵 $R_1$ 通过 $R_1 = Q_1^T A$ 求得。由于 $A$ 的列是正交的，$R_1$ 是一个对角矩阵，其对角元素为 $r_{jj} = \\|a_j\\|_2$：\n$$\nR_1 = \\begin{pmatrix}\n\\sqrt{5}  0  0 \\\\\n0  \\sqrt{5}  0 \\\\\n0  0  3\n\\end{pmatrix}\n$$\n接下来，我们计算乘积 $Q_1^T B$：\n$$\nQ_1^T B = \\begin{pmatrix}\n2/\\sqrt{5}  0  0  1/\\sqrt{5}  0 \\\\\n0  2/\\sqrt{5}  0  0  1/\\sqrt{5} \\\\\n0  0  1  0  0\n\\end{pmatrix}\n\\begin{pmatrix}\n1  -1 \\\\\n2  0 \\\\\n3  1 \\\\\n4  -2 \\\\\n5  2\n\\end{pmatrix}\n= \\begin{pmatrix}\n\\frac{2(1)+1(4)}{\\sqrt{5}}  \\frac{2(-1)+1(-2)}{\\sqrt{5}} \\\\\n\\frac{2(2)+1(5)}{\\sqrt{5}}  \\frac{2(0)+1(2)}{\\sqrt{5}} \\\\\n3  1\n\\end{pmatrix}\n= \\begin{pmatrix}\n6/\\sqrt{5}  -4/\\sqrt{5} \\\\\n9/\\sqrt{5}  2/\\sqrt{5} \\\\\n3  1\n\\end{pmatrix}\n$$\n现在我们求解系统 $R_1 X = Q_1^T B$：\n$$\n\\begin{pmatrix}\n\\sqrt{5}  0  0 \\\\\n0  \\sqrt{5}  0 \\\\\n0  0  3\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{11}  x_{12} \\\\\nx_{21}  x_{22} \\\\\nx_{31}  x_{32}\n\\end{pmatrix}\n= \\begin{pmatrix}\n6/\\sqrt{5}  -4/\\sqrt{5} \\\\\n9/\\sqrt{5}  2/\\sqrt{5} \\\\\n3  1\n\\end{pmatrix}\n$$\n由于 $R_1$ 是对角矩阵，解的计算很简单：\n$x_{11} = (6/\\sqrt{5}) / \\sqrt{5} = 6/5$\n$x_{12} = (-4/\\sqrt{5}) / \\sqrt{5} = -4/5$\n$x_{21} = (9/\\sqrt{5}) / \\sqrt{5} = 9/5$\n$x_{22} = (2/\\sqrt{5}) / \\sqrt{5} = 2/5$\n$x_{31} = 3/3 = 1$\n$x_{32} = 1/3$\n唯一的最小化子是：\n$$\nX = \\begin{pmatrix}\n6/5  -4/5 \\\\\n9/5  2/5 \\\\\n1  1/3\n\\end{pmatrix}\n$$\n\n**残差正交性的验证**\n我们计算残差矩阵 $R = B - AX$。\n$$\nAX = \\begin{pmatrix}\n2  0  0 \\\\\n0  2  0 \\\\\n0  0  3 \\\\\n1  0  0 \\\\\n0  1  0\n\\end{pmatrix}\n\\begin{pmatrix}\n6/5  -4/5 \\\\\n9/5  2/5 \\\\\n1  1/3\n\\end{pmatrix}\n= \\begin{pmatrix}\n12/5  -8/5 \\\\\n18/5  4/5 \\\\\n3  1 \\\\\n6/5  -4/5 \\\\\n9/5  2/5\n\\end{pmatrix}\n$$\n$$\nR = B - AX = \\begin{pmatrix}\n1 - 12/5  -1 - (-8/5) \\\\\n2 - 18/5  0 - 4/5 \\\\\n3 - 3  1 - 1 \\\\\n4 - 6/5  -2 - (-4/5) \\\\\n5 - 9/5  2 - 2/5\n\\end{pmatrix}\n= \\begin{pmatrix}\n-7/5  3/5 \\\\\n-8/5  -4/5 \\\\\n0  0 \\\\\n14/5  -6/5 \\\\\n16/5  8/5\n\\end{pmatrix}\n$$\n残差向量为 $r_1 = (-7/5, -8/5, 0, 14/5, 16/5)^T$ 和 $r_2 = (3/5, -4/5, 0, -6/5, 8/5)^T$。我们必须验证 $A^T r_1 = 0$ 和 $A^T r_2 = 0$。\n$A^T = \\begin{pmatrix} 2  0  0  1  0 \\\\ 0  2  0  0  1 \\\\ 0  0  3  0  0 \\end{pmatrix}$。\n对于 $r_1$：\n$a_1^T r_1 = 2(-7/5) + 1(14/5) = -14/5 + 14/5 = 0$\n$a_2^T r_1 = 2(-8/5) + 1(16/5) = -16/5 + 16/5 = 0$\n$a_3^T r_1 = 3(0) = 0$\n对于 $r_2$：\n$a_1^T r_2 = 2(3/5) + 1(-6/5) = 6/5 - 6/5 = 0$\n$a_2^T r_2 = 2(-4/5) + 1(8/5) = -8/5 + 8/5 = 0$\n$a_3^T r_2 = 3(0) = 0$\n两个残差向量均满足正交性条件。\n\n**残差范数的最终计算**\n最后一步是计算 $\\|B - AX\\|_F = \\|R\\|_F$。\n$\\|R\\|_F^2 = \\|r_1\\|_2^2 + \\|r_2\\|_2^2$\n$$\n\\|r_1\\|_2^2 = (-7/5)^2 + (-8/5)^2 + 0^2 + (14/5)^2 + (16/5)^2 = \\frac{1}{25}(49 + 64 + 196 + 256) = \\frac{565}{25} = \\frac{113}{5}\n$$\n$$\n\\|r_2\\|_2^2 = (3/5)^2 + (-4/5)^2 + 0^2 + (-6/5)^2 + (8/5)^2 = \\frac{1}{25}(9 + 16 + 36 + 64) = \\frac{125}{25} = 5\n$$\n$$\n\\|R\\|_F^2 = \\frac{113}{5} + 5 = \\frac{113 + 25}{5} = \\frac{138}{5}\n$$\n因此，残差的弗罗贝尼乌斯范数是：\n$$\n\\|B - AX\\|_F = \\sqrt{\\frac{138}{5}}\n$$\n这就是所要求的精确值。", "answer": "$$\\boxed{\\sqrt{\\frac{138}{5}}}$$", "id": "3577850"}, {"introduction": "理论上的满秩矩阵在实际计算中可能由于列向量间的近似线性相关而表现出“病态”或“近秩亏”。这个练习引入了列主元 QR (CPQR) 分解，这是一种更稳健的算法，能够揭示并处理这种情况。通过手动执行列主元选择和正交化过程，你将深入理解算法如何识别并分离出矩阵中最重要的部分，并学会如何根据设定的容差 $\\tau$ 来确定矩阵的“数值秩”。[@problem_id:3577867]", "problem": "考虑一个欧几里得空间中的超定线性系统，其由一个设计矩阵和一个观测向量给出。设矩阵为\n$$\nA \\in \\mathbb{R}^{5 \\times 3}, \\quad\nA =\n\\begin{pmatrix}\n10  0  0.1 \\\\\n0  9  0.1 \\\\\n0  0  10^{-12} \\\\\n0  0  0 \\\\\n0  0  0\n\\end{pmatrix},\n$$\n设观测向量为\n$$\nb \\in \\mathbb{R}^{5}, \\quad\nb =\n\\begin{pmatrix}\n10 \\\\ -9 \\\\ 3 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n使用最小二乘问题 $\\min_{x \\in \\mathbb{R}^{3}} \\|A x - b\\|_{2}$ 的基本定义和列主元 QR (CPQR) 分解的定义，该分解定义为 $A P = Q R$，其中 $Q \\in \\mathbb{R}^{5 \\times 3}$ 具有标准正交列，$R \\in \\mathbb{R}^{3 \\times 3}$ 是一个上三角矩阵，而 $P \\in \\mathbb{R}^{3 \\times 3}$ 是一个置换矩阵，执行以下操作：\n\n1. 根据正交投影和三角化的第一性原理计算 $A$ 的列主元 QR 分解（不要使用任何现成的分解公式）。\n2. 使用得到的 $Q$、$R$ 和 $P$ 写出无需正规方程的三角系统，该系统通过正交-三角结构来求解最小二乘解。\n3. 将 $A$ 的数值秩定义为 $R$ 的对角线元素中绝对值超过容差 $\\tau = 10^{-8}$ 的数量，直接应用于对角线 $\\mathrm{diag}(R)$。确定此数值秩。\n\n提供上述定义的数值秩作为唯一的最终答案。无需四舍五入。", "solution": "用户希望我验证并解决一个数值线性代数问题。\n\n### 步骤 1：提取已知条件\n- **设计矩阵**:\n$$\nA \\in \\mathbb{R}^{5 \\times 3}, \\quad\nA =\n\\begin{pmatrix}\n10  0  0.1 \\\\\n0  9  0.1 \\\\\n0  0  10^{-12} \\\\\n0  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\n- **观测向量**:\n$$\nb \\in \\mathbb{R}^{5}, \\quad\nb =\n\\begin{pmatrix}\n10 \\\\ -9 \\\\ 3 \\\\ 0 \\\\ 0\n\\end{pmatrix}\n$$\n- **任务**: 求解最小二乘问题 $\\min_{x \\in \\mathbb{R}^{3}} \\|A x - b\\|_{2}$。\n- **方法**: 使用列主元 QR (CPQR) 分解。\n- **CPQR 定义**: $A P = Q R$，其中 $Q \\in \\mathbb{R}^{5 \\times 3}$ 具有标准正交列，$R \\in \\mathbb{R}^{3 \\times 3}$ 是上三角矩阵，而 $P \\in \\mathbb{R}^{3 \\times 3}$ 是置换矩阵。\n- **要求步骤**:\n    1. 根据第一性原理计算 $A$ 的 CPQR 分解。\n    2. 为最小二乘解写出得到的三角系统。\n    3. 确定 $A$ 的数值秩。\n- **数值秩定义**: $R$ 的对角线元素中满足 $|\\mathrm{diag}(R)_i| > \\tau$ 的数量。\n- **容差**: $\\tau = 10^{-8}$。\n- **最终答案**: $A$ 的数值秩。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在数值线性代数方面有坚实的科学基础，采用了最小二乘、QR 分解和数值秩等标准概念。这是一个适定问题，因为 CPQR 分解是一种标准的、定义明确的算法，适用于任何矩阵。求解所需的所有数据和定义都已明确给出且相互一致。矩阵 $A$ 有一列的元素范数非常小，这是测试算法鲁棒性和数值秩概念的一个关键特征，使得该问题不那么简单。问题陈述客观，并使用了精确的数学语言。不存在矛盾、歧义或违反科学原理之处。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n\n本题要求我们基于矩阵 $A$ 的列主元 QR (CPQR) 分解来计算其数值秩。我们将遵循指定的步骤进行。\n\n#### 1. 计算列主元 QR 分解 ($AP=QR$)\n\nCPQR 分解是通过一种类似于在每一步都进行列主元选择的修正 Gram-Schmidt 过程的算法来迭代计算的。设 $A$ 的列向量为 $a_1, a_2, a_3$。\n\n$a_1 = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$, $a_2 = \\begin{pmatrix} 0 \\\\ 9 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$, $a_3 = \\begin{pmatrix} 0.1 \\\\ 0.1 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n**步骤 1：**\n我们首先找到 $A$ 中欧几里得范数最大的列。\n- $\\|a_1\\|_2^2 = 10^2 = 100$。\n- $\\|a_2\\|_2^2 = 9^2 = 81$。\n- $\\|a_3\\|_2^2 = (0.1)^2 + (0.1)^2 + (10^{-12})^2 = 0.01 + 0.01 + 10^{-24} = 0.02 + 10^{-24}$。\n由于 $\\|a_1\\|_2$ 最大，我们选择 $a_1$ 作为第一个主元列。不需要进行列交换，因此置换矩阵 $P$ 暂时保持为单位矩阵。设待分解的矩阵为 $A^{(1)} = A$。\n$R$ 的第一个对角元素是 $r_{11} = \\|a_1\\|_2 = 10$。\n$Q$ 的第一列是 $q_1 = \\frac{a_1}{r_{11}} = \\frac{1}{10} \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n然后我们将剩余的列 $a_2$ 和 $a_3$ 投影到 $q_1$ 上，以求出 $R$ 的第一行。\n$r_{12} = q_1^T a_2 = \\begin{pmatrix} 1  0  0  0  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 9 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = 0$。\n$r_{13} = q_1^T a_3 = \\begin{pmatrix} 1  0  0  0  0 \\end{pmatrix} \\begin{pmatrix} 0.1 \\\\ 0.1 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix} = 0.1$。\n接下来，我们通过减去它们在 $q_1$ 上的投影来更新列 $a_2$ 和 $a_3$：\n$a_2^{(2)} = a_2 - r_{12} q_1 = a_2 - 0 \\cdot q_1 = a_2 = \\begin{pmatrix} 0 \\\\ 9 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n$a_3^{(2)} = a_3 - r_{13} q_1 = \\begin{pmatrix} 0.1 \\\\ 0.1 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix} - 0.1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0.1 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n**步骤 2：**\n现在我们从剩余的更新列 $a_2^{(2)}$ 和 $a_3^{(2)}$ 中选择主元。我们比较它们的范数：\n- $\\|a_2^{(2)}\\|_2^2 = 9^2 = 81$。\n- $\\|a_3^{(2)}\\|_2^2 = (0.1)^2 + (10^{-12})^2 = 0.01 + 10^{-24}$。\n$a_2^{(2)}$ 的范数更大。因此，我们选择它作为第二个主元列。同样，不需要进行列交换，$P$ 仍然是单位矩阵。\n$R$ 的第二个对角元素是 $r_{22} = \\|a_2^{(2)}\\|_2 = 9$。\n$Q$ 的第二列是 $q_2 = \\frac{a_2^{(2)}}{r_{22}} = \\frac{1}{9} \\begin{pmatrix} 0 \\\\ 9 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n我们将最后一个剩余的列 $a_3^{(2)}$ 投影到 $q_2$ 上：\n$r_{23} = q_2^T a_3^{(2)} = \\begin{pmatrix} 0  1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0.1 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix} = 0.1$。\n我们更新 $a_3^{(2)}$：\n$a_3^{(3)} = a_3^{(2)} - r_{23} q_2 = \\begin{pmatrix} 0 \\\\ 0.1 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix} - 0.1 \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n**步骤 3：**\n只剩下一列 $a_3^{(3)}$。\n$R$ 的第三个对角元素是 $r_{33} = \\|a_3^{(3)}\\|_2 = \\sqrt{(10^{-12})^2} = 10^{-12}$。\n$Q$ 的第三列是 $q_3 = \\frac{a_3^{(3)}}{r_{33}} = \\frac{1}{10^{-12}} \\begin{pmatrix} 0 \\\\ 0 \\\\ 10^{-12} \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n**分解总结：**\n由于没有进行列交换，置换矩阵是单位矩阵，$P = I$。\n分解为 $A = QR$，其中：\n$Q = \\begin{pmatrix} q_1  q_2  q_3 \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\\\ 0  0  0 \\\\ 0  0  0 \\end{pmatrix} \\in \\mathbb{R}^{5 \\times 3}$。\n$R = \\begin{pmatrix} r_{11}  r_{12}  r_{13} \\\\ 0  r_{22}  r_{23} \\\\ 0  0  r_{33} \\end{pmatrix} = \\begin{pmatrix} 10  0  0.1 \\\\ 0  9  0.1 \\\\ 0  0  10^{-12} \\end{pmatrix} \\in \\mathbb{R}^{3 \\times 3}$。\n\n#### 2. 免正规方程的三角系统\n\n最小二乘问题是最小化 $\\|Ax-b\\|_2$。代入 CPQR 分解 $AP=QR$，我们得到 $\\min_{x} \\|QRP^{-1}x - b\\|_2$。令 $y = P^{-1}x$。由于 $P$ 是一个置换矩阵，这只是对 $x$ 分量的一次重新排序。问题变为 $\\min_{y} \\|QRy - b\\|_2$。\n当残差向量 $QRy-b$ 与 $A$ 的列空间（即 $Q$ 的列空间）正交时，范数达到最小。这通过在变换后的空间中求解正规方程来实现：\n$(QR)^T(QRy) = (QR)^T b$\n$R^T Q^T Q R y = R^T Q^T b$\n由于 $Q$ 具有标准正交列，所以 $Q^T Q = I$。由此得出：\n$R^T R y = R^T Q^T b$。\n假设 $R$ 是可逆的，这可以简化为 $Ry=Q^Tb$，从而避免了形成可能病态的乘积 $A^TA$。这就是我们需要定义的三角系统。\n\n首先，我们计算向量 $Q^T b$：\n$Q^T b = \\begin{pmatrix} 1  0  0  0  0 \\\\ 0  1  0  0  0 \\\\ 0  0  1  0  0 \\end{pmatrix} \\begin{pmatrix} 10 \\\\ -9 \\\\ 3 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ -9 \\\\ 3 \\end{pmatrix}$。\n\n三角系统 $Ry=Q^Tb$ 为：\n$$\n\\begin{pmatrix} 10  0  0.1 \\\\ 0  9  0.1 \\\\ 0  0  10^{-12} \\end{pmatrix}\n\\begin{pmatrix} y_1 \\\\ y_2 \\\\ y_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 10 \\\\ -9 \\\\ 3 \\end{pmatrix}\n$$\n由于 $P=I$，我们有 $y=x$，因此针对原始解向量 $x$ 的系统是 $Rx=Q^Tb$。\n\n#### 3. 确定数值秩\n\n$A$ 的数值秩定义为 $R$ 的对角线元素中绝对值超过容差 $\\tau = 10^{-8}$ 的数量。\n$R$ 的对角元素是 $r_{11}=10$，$r_{22}=9$ 和 $r_{33}=10^{-12}$。\n我们将每个元素与容差 $\\tau$ 进行比较：\n- $|r_{11}| = 10$。我们检查 $10 > 10^{-8}$ 是否成立。这是成立的。\n- $|r_{22}| = 9$。我们检查 $9 > 10^{-8}$ 是否成立。这是成立的。\n- $|r_{33}| = 10^{-12}$。我们检查 $10^{-12} > 10^{-8}$ 是否成立。这不成立，因为 $-12  -8$。\n\n两个对角元素 $r_{11}$ 和 $r_{22}$ 的绝对值大于容差 $\\tau = 10^{-8}$。因此，对于给定的容差，矩阵 $A$ 的数值秩为 $2$。\n这个结果表明 $A$ 的第三列几乎与前两列线性相关，使得该矩阵在计算上接近一个秩为 2 的矩阵。$r_{33}$ 的小值是这种近似线性相关的直接结果。如果不进行正则化求解该系统，将会得到一个分量非常大的解向量 $x$，因为该系统是病态的。", "answer": "$$\\boxed{2}$$", "id": "3577867"}, {"introduction": "为什么在数值计算中 QR 分解通常优于看似更直接的正规方程法？本练习旨在通过一个精心设计的计算实验来回答这个问题。你将构建一个包含几乎共线列的矩阵，并分别使用正规方程和列主元 QR 分解来求解最小二乘问题，从而亲眼见证正规方程法由于条件数的平方效应而导致的数值失败，以及 QR 方法如何稳健地识别出正确的数值秩并给出可靠的解。[@problem_id:3275467]", "problem": "您将实现一个程序，通过构造和测量来演示：当设计矩阵的两列几乎相同时，线性最小二乘问题的正规方程法如何在数值上出现秩亏损，而基于带列主元的QR分解的秩揭示分解法则仍然可以识别正确的数值秩并产生一个稳定的最小二乘解。请完全使用纯数值线性代数的术语进行操作。\n\n考虑一个超定线性系统的最小二乘问题，即最小化残差的欧几里得范数，\n$$\n\\min_{x \\in \\mathbb{R}^n} \\| A x - b \\|_2,\n$$\n其中合成矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 按如下方式构造。设 $m = 5$ 且 $n = 3$。定义标准基向量 $e_1, e_2, e_3 \\in \\mathbb{R}^5$。对于给定的参数 $\\epsilon \\ge 0$，设置\n$$\nc_1 = e_1, \\quad c_2 = e_1 + \\epsilon\\, e_2, \\quad c_3 = e_3,\n$$\n并组装\n$$\nA(\\epsilon) = \\begin{bmatrix} c_1  c_2  c_3 \\end{bmatrix} \\in \\mathbb{R}^{5 \\times 3}.\n$$\n取右侧向量为\n$$\nb = \\begin{bmatrix} 1 \\\\ -3 \\\\ 2 \\\\ 0 \\\\ 0 \\end{bmatrix} \\in \\mathbb{R}^5.\n$$\n\n推导的基本依据：\n- 根据最小二乘法的一阶最优性条件，任何最小化向量 $x$ 都满足正规方程\n$$\nA^\\top A \\, x = A^\\top b.\n$$\n- 对于一个满秩矩阵 $M$，$2$-范数下的条件数定义为 $\\kappa_2(M) = \\sigma_{\\max}(M) / \\sigma_{\\min}(M)$，其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是最大和最小奇异值。\n- 对于任意矩阵 $A$，$A^\\top A$ 的奇异值是 $A$ 的奇异值的平方，因此当 $A$ 为列满秩时，有 $\\kappa_2(A^\\top A) = \\kappa_2(A)^2$。\n- 带列主元的QR分解是一种形式为 $A P = Q R$ 的分解，其中 $P$ 是一个置换矩阵，$Q$ 的列是标准正交的，$R$ 是一个上三角矩阵。将 $R$ 的对角线元素的大小与一个容差 $\\tau = \\max(m,n)\\,\\varepsilon_{\\mathrm{mach}}\\,\\|A\\|_2$ 进行比较，可以揭示数值秩 $r$，其中 $\\varepsilon_{\\mathrm{mach}}$ 是浮点运算的机器epsilon。\n\n您的任务：\n1. 使用修正的Gram-Schmidt方法实现一个带列主元的秩揭示QR分解，以计算 $Q$、$R$ 和一个编码 $P$ 的置换，以及通过将 $R$ 的对角线元素与上述容差 $\\tau$ 比较确定的数值秩 $r$。请使用双精度浮点运算。\n2. 对每个指定的 $\\epsilon$ 值，计算以下量：\n   - 通过奇异值分解计算的 $A(\\epsilon)$ 的秩，记为 $\\mathrm{rank}(A)$。\n   - 通过奇异值分解计算的 $A(\\epsilon)^\\top A(\\epsilon)$ 的秩，记为 $\\mathrm{rank}(A^\\top A)$。\n   - 由您实现的带列主元的QR分解所识别的数值秩 $r_{\\mathrm{QR}}$，如上所述。\n   - $2$-范数条件数 $\\kappa_2(A)$ 和 $\\kappa_2(A^\\top A)$。\n   - 通过正规方程计算的最小二乘解，具体方法是显式构造 $G = A^\\top A$ 并用直接线性求解器求解 $G x = A^\\top b$。如果 $\\mathrm{rank}(G)  n$，则将系统视为数值奇异且不进行求解；在这种情况下，报告一个如下所述的特殊值。\n   - 通过您实现的带列主元的QR分解计算的最小二乘解。使用数值秩 $r_{\\mathrm{QR}}$ 求解简化的三角系统 $R_{1:r,1:r} y = (Q^\\top b)_{1:r}$，然后通过置换映射回原始变量顺序以获得 $x_{\\mathrm{QR}}$，其余分量设置为零。这将得到一个与检测到的数值秩一致的最小范数最小二乘解。\n3. 对每种情况，报告残差范数和解的范数：\n   - 正规方程解的残差范数 $\\|A x_{\\mathrm{NE}} - b\\|_2$。如果 $\\mathrm{rank}(A^\\top A)  n$，则将此残差报告为浮点数 NaN (非数字)。\n   - QR解的残差范数 $\\|A x_{\\mathrm{QR}} - b\\|_2$。\n   - QR解的欧几里得范数 $\\|x_{\\mathrm{QR}}\\|_2$。\n4. 对 $\\epsilon$ 使用以下测试集：\n   - $\\epsilon = 10^{-8}$，代表两列相差 $10^{-8}$。\n   - $\\epsilon = 0$，代表两列完全相同（真正的秩亏损）。\n   - $\\epsilon = 10^{-4}$，代表一种较轻微的近共线性。\n5. 最终输出格式：\n   - 您的程序应生成一行输出，其中包含一个由三个项目组成的逗号分隔列表，每个项目是对应上述测试集顺序的一个测试用例的列表。\n   - 对每个测试用例，输出列表\n     $$\n     [\\mathrm{rank}(A),\\ \\mathrm{rank}(A^\\top A),\\ r_{\\mathrm{QR}},\\ \\kappa_2(A),\\ \\kappa_2(A^\\top A),\\ \\|A x_{\\mathrm{NE}} - b\\|_2,\\ \\|A x_{\\mathrm{QR}} - b\\|_2,\\ \\|x_{\\mathrm{QR}}\\|_2].\n     $$\n   - 如果 $\\mathrm{rank}(A^\\top A)  n$，则按前述说明将正规方程的残差输出为 NaN。所有条目必须是基本数值类型（整数或浮点数）。全部输出必须是单行的Python风格列表的列表，例如：[[...],[...],[...]]。\n\n注：\n- 不涉及角度；不需要角度单位。\n- 没有物理单位；报告纯标量值。\n- 确保您的实现是确定性的，并且核心计算仅使用双精度算术，除非语言默认指定了其他方式。", "solution": "该问题已经过验证，并被确定为数值线性代数领域中一个有效且适定的问题。它具有科学依据，是客观的，并包含了进行下一步所需的所有必要信息。\n\n任务是证明，在求解线性最小二乘问题时，特别是当设计矩阵 $A$ 具有近共线列时，使用带列主元的秩揭示QR分解相比于传统的正规方程法具有更优的数值稳定性。\n\n线性最小二乘问题是对于给定的矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 和向量 $b \\in \\mathbb{R}^m$，找到一个 $x \\in \\mathbb{R}^n$ 来最小化残差的欧几里得范数 $\\|Ax - b\\|_2$。\n\n具体的矩阵 $A(\\epsilon)$ 是为 $m=5$ 和 $n=3$ 构造的，其列向量 $c_1, c_2, c_3 \\in \\mathbb{R}^5$ 如下：\n$$\nc_1 = \\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nc_2 = \\begin{bmatrix} 1 \\\\ \\epsilon \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nc_3 = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{bmatrix}.\n$$\n矩阵 $A(\\epsilon)$ 由这些列向量组成，$A(\\epsilon) = \\begin{bmatrix} c_1  c_2  c_3 \\end{bmatrix}$。右侧向量给定为 $b = [1, -3, 2, 0, 0]^\\top$。\n\n当参数 $\\epsilon$ 接近 $0$ 时，列向量 $c_1$ 和 $c_2$ 变得近线性相关。这使得矩阵 $A(\\epsilon)$ 成为病态矩阵。将在 $\\epsilon \\in \\{10^{-8}, 0, 10^{-4}\\}$ 的情况下进行分析。\n\n### 方法论\n\n将实现并比较两种方法。\n\n**1. 正规方程法 (NE)**\n最小二乘问题的解必须满足正规方程：\n$$\nA^\\top A x = A^\\top b.\n$$\n该方法涉及显式地构造格拉姆矩阵 $G = A^\\top A$ 和一个修正的右侧向量 $A^\\top b$，然后求解 $n \\times n$ 线性系统 $Gx = A^\\top b$。此方法的一个关键问题是 $G$ 的条件数是 $A$ 的条件数的平方，即 $\\kappa_2(A^\\top A) = \\kappa_2(A)^2$。这种平方关系可能导致数值精度的显著损失，并可能使一个计算上满秩的问题表现为奇异。\n\n对于每个 $\\epsilon$，我们首先使用基于标准奇异值分解 (SVD) 的方法计算 $G = A^\\top A$ 的秩。如果 $\\mathrm{rank}(G)  n$，则该矩阵被认为是数值奇异的，我们不会尝试求解该系统。在这种情况下，残差范数 $\\|A x_{\\mathrm{NE}} - b\\|_2$ 将被报告为“非数字”(NaN)。否则，我们求解系统得到 $x_{\\mathrm{NE}}$ 并计算相应的残差范数。\n\n**2. 带列主元的QR分解**\n一种数值上更稳定的方法是使用 $A$ 的 QR 分解。具体来说，我们将使用带列主元的秩揭示 QR 分解，其形式如下：\n$$\nAP = QR,\n$$\n其中 $P$ 是一个置换矩阵，$Q$ 是一个具有标准正交列的矩阵，$R$ 是一个上三角矩阵。最小二乘问题变为 $\\min_x \\|Q R P^\\top x - b\\|_2$。令 $y = P^\\top x$，由于乘以正交矩阵 $Q^\\top$ 不会改变欧几里得范数，该问题等价于 $\\min_y \\|Ry - Q^\\top b\\|_2$。\n\n实现将使用带列主元的修正格拉姆-施密特(MGS)算法。在分解的每一步 $k$，选择剩余欧几里得范数最大的列作为主元，换到第 $k$ 个位置，然后用于形成 $Q$ 的第 $k$ 列和 $R$ 的第 $k$ 行。\n\n一个关键方面是确定数值秩 $r_{\\mathrm{QR}}$。这是通过将 $R$ 的对角线元素的大小与一个容差 $\\tau$ 进行比较来完成的：\n$$\n\\tau = \\max(m,n)\\,\\varepsilon_{\\mathrm{mach}}\\,\\|A\\|_2,\n$$\n其中 $\\varepsilon_{\\mathrm{mach}}$ 是双精度浮点运算的机器epsilon。如果 $|R_{kk}|  \\tau$，则矩阵在第 $k$ 步被视为数值秩亏，数值秩设为 $r_{\\mathrm{QR}} = k-1$。\n\n一旦找到 $Q$、$R$、置换 $P$（由一个索引向量表示）和数值秩 $r_{\\mathrm{QR}}$，就可以计算解 $x_{\\mathrm{QR}}$。我们求解降秩的上三角系统：\n$$\nR_{1:r, 1:r} \\, y_{1:r} = (Q^\\top b)_{1:r},\n$$\n其中 $r=r_{\\mathrm{QR}}$，使用回代法求解。通过将其前 $r$ 个分量设置为 $y_{1:r}$，其余 $n-r$ 个分量设置为零，来构成大小为 $n$ 的解向量 $y$。这对应于找到一个基本解。最后，通过逆置换找到原始坐标系下的解：$x_{\\mathrm{QR}} = Py$。这是通过根据置换向量将 $y$ 的分量赋给 $x_{\\mathrm{QR}}$ 来实现的。\n\n### 计算量\n对于每个 $\\epsilon$ 值，将计算并报告以下量：\n- $\\mathrm{rank}(A)$: 通过SVD计算的 $A(\\epsilon)$ 的秩。\n- $\\mathrm{rank}(A^\\top A)$: 通过SVD计算的 $A(\\epsilon)^\\top A(\\epsilon)$ 的秩。\n- $r_{\\mathrm{QR}}$: 从我们实现的带列主元的QR分解得到的数值秩。\n- $\\kappa_2(A)$: $A(\\epsilon)$ 的 $2$-范数条件数。\n- $\\kappa_2(A^\\top A)$: $A(\\epsilon)^\\top A(\\epsilon)$ 的 $2$-范数条件数。\n- $\\|A x_{\\mathrm{NE}} - b\\|_2$: 正规方程解的残差范数（或 NaN）。\n- $\\|A x_{\\mathrm{QR}} - b\\|_2$: QR解的残差范数。\n- $\\|x_{\\mathrm{QR}}\\|_2$: QR解的欧几里得范数。\n\n此比较分析旨在突显正规方程法的数值陷阱以及使用秩揭示QR方法解决最小二乘问题的稳健性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef qr_pivot_mgs(A):\n    \"\"\"\n    Computes a rank-revealing QR factorization with column pivoting using\n    Modified Gram-Schmidt. The factorization is of the form AP = QR.\n\n    Args:\n        A (np.ndarray): The matrix to factorize, of size m x n.\n\n    Returns:\n        Q (np.ndarray): m x n matrix with orthonormal columns.\n        R (np.ndarray): n x n upper triangular matrix.\n        p (list): Permutation vector of length n. A_permuted[:, k] is A[:, p[k]].\n        rank (int): Numerical rank of the matrix.\n    \"\"\"\n    m, n = A.shape\n    V = A.copy()\n    Q = np.zeros((m, n))\n    R = np.zeros((n, n))\n    p = list(range(n))\n\n    A_norm = np.linalg.norm(A, 2)\n    # Handle the case of a zero matrix for robustness\n    if A_norm == 0:\n        return Q, R, p, 0\n    \n    tol = max(m, n) * np.finfo(float).eps * A_norm\n    \n    numerical_rank = n  # Assume full rank initially\n\n    for k in range(n):\n        # Find the column with the largest 2-norm in the remaining submatrix V[:, k:]\n        col_norms = np.linalg.norm(V[:, k:], axis=0)\n        best_col_idx_local = np.argmax(col_norms)\n        best_col_idx_global = k + best_col_idx_local\n        \n        # Swap columns in V and update the permutation vector p\n        if best_col_idx_global != k:\n            V[:, [k, best_col_idx_global]] = V[:, [best_col_idx_global, k]]\n            p[k], p[best_col_idx_global] = p[best_col_idx_global], p[k]\n            \n        # The diagonal element R[k, k] is the norm of the current pivot column\n        R[k, k] = np.linalg.norm(V[:, k])\n\n        # Check for rank deficiency against the tolerance\n        if R[k, k]  tol:\n            numerical_rank = k\n            break\n\n        # Normalize the k-th column of V to get the k-th column of Q\n        Q[:, k] = V[:, k] / R[k, k]\n\n        # Orthogonalize the remaining columns of V against the new basis vector Q[:, k]\n        for j in range(k + 1, n):\n            R[k, j] = np.dot(Q[:, k], V[:, j])\n            V[:, j] -= R[k, j] * Q[:, k]\n            \n    return Q, R, p, numerical_rank\n\ndef back_substitution(R, c):\n    \"\"\"Solves Rx = c for an upper triangular matrix R.\"\"\"\n    n = R.shape[0]\n    x = np.zeros(n)\n    for i in range(n - 1, -1, -1):\n        if R[i, i] == 0:\n            # This should ideally not be reached if the system is well-posed.\n            # R is from a rank-revealing QR, so R[i,i] > tol > 0.\n            raise np.linalg.LinAlgError(\"Singular matrix in back substitution.\")\n        dot_product = np.dot(R[i, i+1:], x[i+1:])\n        x[i] = (c[i] - dot_product) / R[i, i]\n    return x\n\ndef solve():\n    \"\"\"\n    Main function to run the numerical experiment for the specified epsilon values.\n    \"\"\"\n    test_cases = [1e-8, 0.0, 1e-4]\n    m, n = 5, 3\n    b = np.array([1., -3., 2., 0., 0.])\n    \n    results = []\n\n    for epsilon in test_cases:\n        # 1. Construct the matrix A for the given epsilon\n        A = np.zeros((m, n), dtype=float)\n        A[0, 0] = 1.0\n        A[0, 1] = 1.0\n        A[1, 1] = epsilon\n        A[2, 2] = 1.0\n\n        # 2. Compute ranks and condition numbers\n        rank_A = np.linalg.matrix_rank(A)\n        G = A.T @ A\n        rank_G = np.linalg.matrix_rank(G)\n        \n        # Condition number is Inf for singular matrices\n        cond_A = np.linalg.cond(A, 2)\n        cond_G = np.linalg.cond(G, 2)\n      \n        # 3. Solve via Normal Equations\n        if rank_G  n:\n            res_norm_NE = np.nan\n        else:\n            try:\n                x_NE = np.linalg.solve(G, A.T @ b)\n                res_norm_NE = np.linalg.norm(A @ x_NE - b, 2)\n            except np.linalg.LinAlgError:\n                # Fails if G is singular despite rank check, due to floating point limits\n                res_norm_NE = np.nan\n\n        # 4. Solve via QR with column pivoting\n        Q, R, p_indices, r_QR = qr_pivot_mgs(A)\n        \n        c = Q.T @ b\n        \n        y = np.zeros(n)\n        if r_QR > 0:\n            # Solve the reduced upper-triangular system\n            R_r = R[:r_QR, :r_QR]\n            c_r = c[:r_QR]\n            y_r = back_substitution(R_r, c_r)\n            y[:r_QR] = y_r\n        \n        # Un-permute the solution vector y to get x_QR\n        x_QR_permuted = np.zeros(n)\n        x_QR_permuted[p_indices] = y # This is incorrect, need to reverse the permutation\n        \n        x_QR = np.zeros_like(y)\n        for i in range(n):\n            x_QR[p_indices[i]] = y[i]\n\n        res_norm_QR = np.linalg.norm(A @ x_QR - b, 2)\n        sol_norm_QR = np.linalg.norm(x_QR, 2)\n\n        # 5. Assemble and store results for this case\n        case_result = [\n            int(rank_A),\n            int(rank_G),\n            int(r_QR),\n            cond_A,\n            cond_G,\n            res_norm_NE,\n            res_norm_QR,\n            sol_norm_QR\n        ]\n        results.append(case_result)\n        \n    # Print the final list of lists in the required format.\n    # The str() function provides the specified \"Python-style list-of-lists\" format.\n    print(str(results))\n\nsolve()\n```", "id": "3275467"}]}