{"hands_on_practices": [{"introduction": "在构建强大的机器学习模型之前，我们必须首先正确处理用于训练的实验数据。核质量数据通常来自多个具有不同精度的实验。本练习将指导您掌握融合这些测量数据的基本统计原理，从最大似然原理出发，一步步推导出逆方差加权方案。理解这一点对于构建正确的加权损失函数至关重要，它能确保我们的模型更多地关注更精确的数据。[@problem_id:3568202]", "problem": "考虑一个单一核素，其质量过剩由两次独立的实验测量。设其潜在的真实质量过剩为 $m \\in \\mathbb{R}$。每个报告值 $y_{i}$ 由高斯测量方程 $y_{i} = m + \\epsilon_{i}$ 建模，其中 $\\epsilon_{i} \\sim \\mathcal{N}(0, \\sigma_{i}^{2})$ 且 $(\\epsilon_{1}, \\epsilon_{2})$ 是独立的。对于同一核素，给定以下两份报告：$y_{1} = -72382.6\\,\\mathrm{keV}$，标准不确定度为 $\\sigma_{1} = 4.0\\,\\mathrm{keV}$；以及 $y_{2} = -72385.1\\,\\mathrm{keV}$，标准不确定度为 $\\sigma_{2} = 2.5\\,\\mathrm{keV}$。从高斯似然函数出发，并且不使用任何快捷公式，推导 $m$ 的最大似然估计量 $\\hat{m}$ 及其标准不确定度 $\\sigma_{\\hat{m}}$。然后，在机器学习（ML）的加权最小二乘法训练目标的背景下，其中训练损失的形式为 $L = \\sum_{i} w_{i} \\left(y_{i} - f(x_{i})\\right)^{2}$，推导能够恢复高斯最大似然原理的样本权重 $w_{i}$ 的选择，并确定如果将两次测量首先聚合为位于 $y = \\hat{m}$ 的单个标签并用作单个训练样本时，应分配的单一等效损失权重 $w_{\\mathrm{agg}}$。根据给定数据，数值计算 $\\hat{m}$、$\\sigma_{\\hat{m}}$ 和 $w_{\\mathrm{agg}}$。将 $\\hat{m}$ 以 $\\mathrm{keV}$ 为单位表示，并四舍五入到五位有效数字；将 $\\sigma_{\\hat{m}}$ 以 $\\mathrm{keV}$ 为单位表示，并四舍五入到四位有效数字；将 $w_{\\mathrm{agg}}$ 以 $\\mathrm{keV}^{-2}$ 为单位表示，并四舍五入到四位有效数字。", "solution": "这个问题提法明确且具有科学依据。我们着手进行推导和计算。\n\n问题陈述，对真实质量过剩 $m$ 的每次测量 $y_i$ 都由高斯分布建模。在给定真实值 $m$ 和标准不确定度 $\\sigma_i$ 的情况下，观测到值 $y_i$ 的概率密度函数（PDF）为：\n$$p(y_i|m, \\sigma_i) = \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(y_i - m)^2}{2\\sigma_i^2}\\right)$$\n我们有两次独立的测量 $(y_1, \\sigma_1)$ 和 $(y_2, \\sigma_2)$。由于独立性，同时观测到 $y_1$ 和 $y_2$ 的联合概率，即似然函数 $L(m)$，是各个 PDF 的乘积：\n$$L(m; y_1, y_2) = p(y_1|m, \\sigma_1) \\cdot p(y_2|m, \\sigma_2) = \\frac{1}{2\\pi\\sigma_1\\sigma_2} \\exp\\left(-\\frac{(y_1 - m)^2}{2\\sigma_1^2} - \\frac{(y_2 - m)^2}{2\\sigma_2^2}\\right)$$\n最大似然估计量（MLE）$\\hat{m}$ 是使 $L(m)$ 最大化的 $m$ 值。最大化对数似然函数 $\\ell(m) = \\ln(L(m))$ 是等价的，并且计算上更简单：\n$$\\ell(m) = \\ln\\left(\\frac{1}{2\\pi\\sigma_1\\sigma_2}\\right) - \\frac{(y_1 - m)^2}{2\\sigma_1^2} - \\frac{(y_2 - m)^2}{2\\sigma_2^2}$$\n为求最大值，我们将 $\\ell(m)$ 对 $m$ 求导并令其为零。常数项在微分后消失。\n$$\\frac{d\\ell(m)}{dm} = -\\frac{2(y_1 - m)(-1)}{2\\sigma_1^2} - \\frac{2(y_2 - m)(-1)}{2\\sigma_2^2} = \\frac{y_1 - m}{\\sigma_1^2} + \\frac{y_2 - m}{\\sigma_2^2}$$\n将导数设为零以求得估计量 $\\hat{m}$：\n$$\\frac{y_1 - \\hat{m}}{\\sigma_1^2} + \\frac{y_2 - \\hat{m}}{\\sigma_2^2} = 0$$\n$$\\frac{y_1}{\\sigma_1^2} + \\frac{y_2}{\\sigma_2^2} = \\hat{m}\\left(\\frac{1}{\\sigma_1^2} + \\frac{1}{\\sigma_2^2}\\right)$$\n解出 $\\hat{m}$：\n$$\\hat{m} = \\frac{\\frac{y_1}{\\sigma_1^2} + \\frac{y_2}{\\sigma_2^2}}{\\frac{1}{\\sigma_1^2} + \\frac{1}{\\sigma_2^2}} = \\frac{\\sum_{i=1}^{2} \\frac{y_i}{\\sigma_i^2}}{\\sum_{i=1}^{2} \\frac{1}{\\sigma_i^2}}$$\n这是测量的反方差加权平均值。\n\n接下来，我们推导估计量 $\\sigma_{\\hat{m}}$ 的标准不确定度。MLE 的方差 $\\sigma_{\\hat{m}}^2$ 由 Cramér-Rao 下界给出，对于无偏估计量，它等于费雪信息（Fisher information）$I(m)$ 的倒数。费雪信息为 $I(m) = -E\\left[\\frac{d^2\\ell(m)}{dm^2}\\right]$。我们计算对数似然函数的二阶导数：\n$$\\frac{d^2\\ell(m)}{dm^2} = \\frac{d}{dm}\\left(\\frac{y_1 - m}{\\sigma_1^2} + \\frac{y_2 - m}{\\sigma_2^2}\\right) = -\\frac{1}{\\sigma_1^2} - \\frac{1}{\\sigma_2^2} = -\\sum_{i=1}^{2}\\frac{1}{\\sigma_i^2}$$\n由于二阶导数是常数，不依赖于数据 $y_i$，其期望就是它本身的值。\n$$I(m) = -E\\left[-\\sum_{i=1}^{2}\\frac{1}{\\sigma_i^2}\\right] = \\sum_{i=1}^{2}\\frac{1}{\\sigma_i^2}$$\n$\\hat{m}$ 的方差是费雪信息的倒数：\n$$\\sigma_{\\hat{m}}^2 = [I(m)]^{-1} = \\left(\\sum_{i=1}^{2}\\frac{1}{\\sigma_i^2}\\right)^{-1} = \\frac{1}{\\frac{1}{\\sigma_1^2} + \\frac{1}{\\sigma_2^2}}$$\n标准不确定度 $\\sigma_{\\hat{m}}$ 是方差的平方根：\n$$\\sigma_{\\hat{m}} = \\sqrt{\\sigma_{\\hat{m}}^2} = \\left(\\sum_{i=1}^{2}\\frac{1}{\\sigma_i^2}\\right)^{-1/2}$$\n\n现在，我们将其与机器学习（ML）中的加权最小二乘训练目标联系起来。损失函数给定为 $L = \\sum_{i} w_{i} \\left(y_{i} - f(x_{i})\\right)^{2}$。在我们的案例中，我们为一个核素估计单个参数 $m$，因此模型预测是常数 $f(x_i) = m$。损失函数简化为：\n$$L(m) = \\sum_{i=1}^{2} w_i (y_i - m)^2$$\n最小化此损失函数应等价于最大化高斯似然函数。最大化似然函数等价于最小化负对数似然函数。忽略常数项，要最小化的目标是：\n$$-\\ell(m) \\propto \\sum_{i=1}^{2} \\frac{(y_i - m)^2}{2\\sigma_i^2}$$\n为使 ML 损失 $L(m)$ 与此目标等价，它们关于 $m$ 的函数形式必须匹配。比较这两个表达式：\n$$\\sum_{i=1}^{2} w_i (y_i - m)^2 \\quad \\text{vs.} \\quad \\sum_{i=1}^{2} \\frac{1}{2\\sigma_i^2} (y_i - m)^2$$\n如果权重 $w_i$ 与 $1/\\sigma_i^2$ 成正比，则此等价性成立。统计加权中的常规选择是设 $w_i = 1/\\sigma_i^2$。这使得损失函数等于卡方统计量 $\\chi^2$。\n\n最后，我们考虑将两次测量聚合成单个数据点 $(y, \\sigma_y)$，其中 $y = \\hat{m}$ 且 $\\sigma_y = \\sigma_{\\hat{m}}$。这个单一聚合样本的训练损失将是 $L_{\\mathrm{agg}} = w_{\\mathrm{agg}}(y - m)^2 = w_{\\mathrm{agg}}(\\hat{m} - m)^2$。遵循刚才推导的原理，合适的权重 $w_{\\mathrm{agg}}$ 是此聚合数据点方差的倒数。我们的聚合点 $\\hat{m}$ 的方差是 $\\sigma_{\\hat{m}}^2$。因此：\n$$w_{\\mathrm{agg}} = \\frac{1}{\\sigma_{\\hat{m}}^2}$$\n代入 $\\sigma_{\\hat{m}}^2$ 的表达式：\n$$w_{\\mathrm{agg}} = \\frac{1}{\\left(\\frac{1}{\\frac{1}{\\sigma_1^2} + \\frac{1}{\\sigma_2^2}}\\right)} = \\frac{1}{\\sigma_1^2} + \\frac{1}{\\sigma_2^2}$$\n由于 $w_i = 1/\\sigma_i^2$，我们看到 $w_{\\mathrm{agg}} = w_1 + w_2$。聚合权重是各个权重的总和。\n\n数值计算：\n给定数据：$y_{1} = -72382.6\\,\\mathrm{keV}$，$\\sigma_{1} = 4.0\\,\\mathrm{keV}$；以及 $y_{2} = -72385.1\\,\\mathrm{keV}$，$\\sigma_{2} = 2.5\\,\\mathrm{keV}$。\n首先，计算方差和权重：\n$\\sigma_1^2 = (4.0)^2 = 16.0\\,\\mathrm{keV}^2 \\implies w_1 = 1/16.0 = 0.0625\\,\\mathrm{keV}^{-2}$\n$\\sigma_2^2 = (2.5)^2 = 6.25\\,\\mathrm{keV}^2 \\implies w_2 = 1/6.25 = 0.16\\,\\mathrm{keV}^{-2}$\n\n计算 $\\hat{m}$：\n$$\\hat{m} = \\frac{w_1 y_1 + w_2 y_2}{w_1 + w_2} = \\frac{(0.0625)(-72382.6) + (0.16)(-72385.1)}{0.0625 + 0.16} = \\frac{-4523.9125 - 11581.616}{0.2225} = \\frac{-16105.5285}{0.2225} \\approx -72384.4000\\,\\mathrm{keV}$$\n四舍五入到五位有效数字，$\\hat{m} = -72384\\,\\mathrm{keV}$。\n\n计算 $\\sigma_{\\hat{m}}$：\n$$\\sigma_{\\hat{m}} = (w_1 + w_2)^{-1/2} = (0.2225)^{-1/2} \\approx \\sqrt{4.494382...} \\approx 2.119995...\\,\\mathrm{keV}$$\n四舍五入到四位有效数字，$\\sigma_{\\hat{m}} = 2.120\\,\\mathrm{keV}$。\n\n计算 $w_{\\mathrm{agg}}$：\n$$w_{\\mathrm{agg}} = w_1 + w_2 = 0.0625 + 0.16 = 0.2225\\,\\mathrm{keV}^{-2}$$\n四舍五入到四位有效数字，$w_{\\mathrm{agg}} = 0.2225\\,\\mathrm{keV}^{-2}$。", "answer": "$$\\boxed{\\begin{pmatrix} -72384  2.120  0.2225 \\end{pmatrix}}$$", "id": "3568202"}, {"introduction": "在核物理学中，我们常常同时拥有大量但精度较低的理论计算结果和稀疏但高度精确的实验测量值。本实践介绍了一种强大的技术——多保真度高斯过程，用于融合这些异构数据源。通过实现一个自回归协同克里金模型，您将亲手量化低保真度的理论数据如何在提升高保真度实验可观测量预测的准确性并减小其不确定性方面发挥作用。[@problem_id:3568164]", "problem": "要求您实现一个基于统计原理的多保真度高斯过程预测器，用于预测核质量残差，并将其预测不确定性与单保真度基线进行比较。考虑一个由质子数 $Z$ 和中子数 $N$ 表征的新原子核，目标量为以兆电子伏特 (MeV) 为单位的残余核质量可观测量。低保真度模型是计算理论残差 $f_{L}(x)$，高保真度模型是实验残差 $f_{H}(x)$，其中 $x = [Z, N]$。多保真度关系遵循 Kennedy 和 O’Hagan 引入的自回归协同克里金结构：\n$$\nf_{H}(x) = \\rho f_{L}(x) + \\delta(x),\n$$\n其中 $f_{L}(x)$ 和 $\\delta(x)$ 是独立的高斯过程 (GP)，每个都具有平方指数协方差。观测值包含加性的独立高斯噪声。您必须使用多保真度模型（利用低保真度和高保真度数据）和单保真度基线（仅使用高保真度数据及隐含的复合核函数），计算指定新原子核处的高保真度残差的预测均值和方差，然后量化由多保真度方法带来的不确定性降低。\n\n基本基础和模型定义：\n- 高斯过程 (GP)：一组随机变量的集合，其中任意有限个变量都服从联合高斯分布。在高斯过程先验和高斯似然下，预测分布是高斯的，其均值和方差可以解析计算。\n- 多保真度自回归模型：$f_{H}(x) = \\rho f_{L}(x) + \\delta(x)$，其中 $f_{L} \\sim \\mathcal{GP}(0, k_{L})$ 和 $\\delta \\sim \\mathcal{GP}(0, k_{\\delta})$ 相互独立。\n- 带各向异性长度尺度的平方指数核函数：\n$$\nk_{\\text{SE}}(x, x'; \\sigma^{2}, \\ell_{Z}, \\ell_{N}) = \\sigma^{2} \\exp\\left(-\\frac{(Z-Z')^{2}}{\\ell_{Z}^{2}} - \\frac{(N-N')^{2}}{\\ell_{N}^{2}}\\right).\n$$\n\n观测模型：\n- 低保真度观测值：$y_{L}(x) = f_{L}(x) + \\epsilon_{L}(x)$，其中 $\\epsilon_{L}(x) \\sim \\mathcal{N}(0, \\sigma_{L,n}^{2})$。\n- 高保真度观测值：$y_{H}(x) = f_{H}(x) + \\epsilon_{H}(x)$，其中 $\\epsilon_{H}(x) \\sim \\mathcal{N}(0, \\sigma_{H,n}^{2})$。\n\n给定的超参数为：\n- 自回归系数：$\\rho = 0.8$。\n- 低保真度核函数参数：$\\sigma_{L,f}^{2} = 25$ $\\text{MeV}^{2}$，$\\ell_{Z,L} = 15$，$\\ell_{N,L} = 18$。\n- 高保真度差异核函数参数：$\\sigma_{\\delta,f}^{2} = 9$ $\\text{MeV}^{2}$，$\\ell_{Z,\\delta} = 12$，$\\ell_{N,\\delta} = 10$。\n- 观测噪声方差：$\\sigma_{L,n}^{2} = 4$ $\\text{MeV}^{2}$，$\\sigma_{H,n}^{2} = 1$ $\\text{MeV}^{2}$。\n\n训练数据（所有残差单位为 MeV）：\n- 低保真度训练输入 $X_{L}$ 和输出 $y_{L}$：\n  $$\n  X_{L} = \\{(20,20), (26,30), (28,34), (50,62), (82,126), (92,146)\\},\n  $$\n  $$\n  y_{L} = \\{-3.0, -1.5, -0.5, 2.0, 4.0, 5.5\\}.\n  $$\n- 高保真度训练输入 $X_{H}$ 和输出 $y_{H}$：\n  $$\n  X_{H} = \\{(26,30), (50,62), (82,126), (92,146)\\},\n  $$\n  $$\n  y_{H} = \\{-1.8, 2.1, 4.4, 6.0\\}.\n  $$\n\n需要计算的预测分布：\n1. 使用联合的低保真度和高保真度训练数据，计算新输入 $x^{*}$ 处 $f_{H}(x^{*})$ 的多保真度预测分布。令 $K$ 表示堆叠观测值 $[y_{L}; y_{H}]$ 的联合协方差，令 $k$ 表示 $[y_{L}; y_{H}]$ 与 $f_{H}(x^{*})$ 之间的互协方差向量。$f_{H}(x^{*})$ 的先验方差为 $\\rho^{2} k_{L}(x^{*}, x^{*}) + k_{\\delta}(x^{*}, x^{*})$。后验均值和方差为：\n   $$\n   \\mu_{\\text{MF}}(x^{*}) = k^{\\top} K^{-1} \\begin{bmatrix} y_{L} \\\\ y_{H} \\end{bmatrix},\n   \\quad\n   \\sigma^{2}_{\\text{MF}}(x^{*}) = \\rho^{2} k_{L}(x^{*}, x^{*}) + k_{\\delta}(x^{*}, x^{*}) - k^{\\top} K^{-1} k.\n   $$\n   这里，\n   $$\n   K = \n   \\begin{bmatrix}\n   K_{LL} + \\sigma_{L,n}^{2} I  \\rho K_{LH} \\\\\n   \\rho K_{HL}  \\rho^{2} K_{HH}^{(L)} + K_{HH}^{(\\delta)} + \\sigma_{H,n}^{2} I\n   \\end{bmatrix},\n   $$\n   其中 $K_{LL} = k_{L}(X_{L}, X_{L})$，$K_{LH} = k_{L}(X_{L}, X_{H})$，$K_{HH}^{(L)} = k_{L}(X_{H}, X_{H})$，$K_{HH}^{(\\delta)} = k_{\\delta}(X_{H}, X_{H})$，以及\n   $$\n   k = \n   \\begin{bmatrix}\n   \\rho \\, k_{L}(x^{*}, X_{L}) \\\\\n   \\rho^{2} \\, k_{L}(x^{*}, X_{H}) + k_{\\delta}(x^{*}, X_{H})\n   \\end{bmatrix}.\n   $$\n2. 仅使用高保真度数据，计算 $f_{H}(x^{*})$ 的单保真度预测分布，其隐含的复合核函数为 $k_{H}(x, x') = \\rho^{2} k_{L}(x, x') + k_{\\delta}(x, x')$。令 $K_{H} = k_{H}(X_{H}, X_{H}) + \\sigma_{H,n}^{2} I$，$k_{H,*} = k_{H}(x^{*}, X_{H})$，以及 $v_{H} = k_{H}(x^{*}, x^{*})$。则：\n   $$\n   \\mu_{\\text{SF}}(x^{*}) = k_{H,*}^{\\top} K_{H}^{-1} y_{H},\n   \\quad\n   \\sigma^{2}_{\\text{SF}}(x^{*}) = v_{H} - k_{H,*}^{\\top} K_{H}^{-1} k_{H,*}.\n   $$\n\n每个 $x^{*}$ 需要报告的不确定性降低度量：\n$$\nr(x^{*}) = \\frac{\\sigma^{2}_{\\text{SF}}(x^{*}) - \\sigma^{2}_{\\text{MF}}(x^{*})}{\\sigma^{2}_{\\text{SF}}(x^{*})},\n$$\n以小数形式表示。\n\n单位和数值报告：\n- 所有均值单位为 MeV，所有方差单位为 $\\text{MeV}^{2}$，缩减率 $r$ 无单位。\n- 报告每个浮点数，四舍五入至六位小数。\n\n测试集（待评估的新原子核）：\n- 用例 1：$x^{*} = (28, 34)$。\n- 用例 2：$x^{*} = (90, 150)$。\n- 用例 3：$x^{*} = (20, 20)$。\n\n程序要求：\n- 使用给定的超参数和训练数据，实现上述预测计算。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，按顺序附加五个数字 $[\\mu_{\\text{MF}}, \\sigma^{2}_{\\text{MF}}, \\mu_{\\text{SF}}, \\sigma^{2}_{\\text{SF}}, r]$（四舍五入到六位小数），最终形成一个包含所有测试用例结果的扁平列表。例如，输出格式必须与此完全一样：\n$$\n[\\mu_{\\text{MF}}^{(1)}, \\sigma_{\\text{MF}}^{2\\,(1)}, \\mu_{\\text{SF}}^{(1)}, \\sigma_{\\text{SF}}^{2\\,(1)}, r^{(1)}, \\mu_{\\text{MF}}^{(2)}, \\ldots, r^{(3)}].\n$$\n不得打印任何额外文本。", "solution": "首先将根据科学合理性、适定性和客观性的指定标准对用户提供的问题进行验证。\n\n### 步骤 1：提取给定条件\n\n问题陈述中逐字给出的条件如下：\n\n**模型与函数形式**：\n- 多保真度自回归模型：$f_{H}(x) = \\rho f_{L}(x) + \\delta(x)$，其中 $x = [Z, N]$。\n- 先验：$f_{L} \\sim \\mathcal{GP}(0, k_{L})$ 和 $\\delta \\sim \\mathcal{GP}(0, k_{\\delta})$ 是独立的高斯过程。\n- 平方指数核函数：$k_{\\text{SE}}(x, x'; \\sigma^{2}, \\ell_{Z}, \\ell_{N}) = \\sigma^{2} \\exp\\left(-\\frac{(Z-Z')^{2}}{\\ell_{Z}^{2}} - \\frac{(N-N')^{2}}{\\ell_{N}^{2}}\\right)$。\n- 低保真度观测模型：$y_{L}(x) = f_{L}(x) + \\epsilon_{L}(x)$，其中 $\\epsilon_{L}(x) \\sim \\mathcal{N}(0, \\sigma_{L,n}^{2})$。\n- 高保真度观测模型：$y_{H}(x) = f_{H}(x) + \\epsilon_{H}(x)$，其中 $\\epsilon_{H}(x) \\sim \\mathcal{N}(0, \\sigma_{H,n}^{2})$。\n\n**超参数**：\n- 自回归系数：$\\rho = 0.8$。\n- 低保真度核函数参数：$\\sigma_{L,f}^{2} = 25$ $\\text{MeV}^{2}$，$\\ell_{Z,L} = 15$，$\\ell_{N,L} = 18$。\n- 差异核函数参数：$\\sigma_{\\delta,f}^{2} = 9$ $\\text{MeV}^{2}$，$\\ell_{Z,\\delta} = 12$，$\\ell_{N,\\delta} = 10$。\n- 观测噪声方差：$\\sigma_{L,n}^{2} = 4$ $\\text{MeV}^{2}$，$\\sigma_{H,n}^{2} = 1$ $\\text{MeV}^{2}$。\n\n**训练数据**：\n- 低保真度输入：$X_{L} = \\{(20,20), (26,30), (28,34), (50,62), (82,126), (92,146)\\}$。\n- 低保真度输出：$y_{L} = \\{-3.0, -1.5, -0.5, 2.0, 4.0, 5.5\\}$ MeV。\n- 高保真度输入：$X_{H} = \\{(26,30), (50,62), (82,126), (92,146)\\}$。\n- 高保真度输出：$y_{H} = \\{-1.8, 2.1, 4.4, 6.0\\}$ MeV。\n\n**预测方程**：\n1.  **多保真度 (MF) 模型**：\n    - 后验均值：$\\mu_{\\text{MF}}(x^{*}) = k^{\\top} K^{-1} \\begin{bmatrix} y_{L} \\\\ y_{H} \\end{bmatrix}$。\n    - 后验方差：$\\sigma^{2}_{\\text{MF}}(x^{*}) = \\rho^{2} k_{L}(x^{*}, x^{*}) + k_{\\delta}(x^{*}, x^{*}) - k^{\\top} K^{-1} k$。\n    - 协方差矩阵：$K = \\begin{bmatrix} K_{LL} + \\sigma_{L,n}^{2} I  \\rho K_{LH} \\\\ \\rho K_{HL}  \\rho^{2} K_{HH}^{(L)} + K_{HH}^{(\\delta)} + \\sigma_{H,n}^{2} I \\end{bmatrix}$。\n    - 互协方差向量：$k = \\begin{bmatrix} \\rho \\, k_{L}(x^{*}, X_{L}) \\\\ \\rho^{2} \\, k_{L}(x^{*}, X_{H}) + k_{\\delta}(x^{*}, X_{H}) \\end{bmatrix}$。\n2.  **单保真度 (SF) 模型**：\n    - 隐含核函数：$k_{H}(x, x') = \\rho^{2} k_{L}(x, x') + k_{\\delta}(x, x')$。\n    - 后验均值：$\\mu_{\\text{SF}}(x^{*}) = k_{H,*}^{\\top} K_{H}^{-1} y_{H}$。\n    - 后验方差：$\\sigma^{2}_{\\text{SF}}(x^{*}) = v_{H} - k_{H,*}^{\\top} K_{H}^{-1} k_{H,*}$。\n    - 各项：$K_{H} = k_{H}(X_{H}, X_{H}) + \\sigma_{H,n}^{2} I$，$k_{H,*} = k_{H}(x^{*}, X_{H})$，$v_{H} = k_{H}(x^{*}, x^{*})$。\n\n**任务定义**：\n- 为三个测试原子核计算 $\\mu_{\\text{MF}}$、$\\sigma^{2}_{\\text{MF}}$、$\\mu_{\\text{SF}}$、$\\sigma^{2}_{\\text{SF}}$。\n- 计算不确定性降低度量：$r(x^{*}) = \\frac{\\sigma^{2}_{\\text{SF}}(x^{*}) - \\sigma^{2}_{\\text{MF}}(x^{*})}{\\sigma^{2}_{\\text{SF}}(x^{*})}$。\n- 测试用例：$x^{*} = (28, 34)$、$x^{*} = (90, 150)$、$x^{*} = (20, 20)$。\n- 输出格式：单行扁平列表，包含每个用例的 $[\\mu_{\\text{MF}}, \\sigma^{2}_{\\text{MF}}, \\mu_{\\text{SF}}, \\sigma^{2}_{\\text{SF}}, r]$，数值四舍五入至六位小数。\n\n### 步骤 2：使用提取的给定条件进行验证\n\n根据验证标准对问题进行评估：\n- **科学依据**：该问题基于高斯过程回归，这是机器学习和统计学中一个标准且强大的非参数方法。多保真度自回归模型，也称为协同克里金法，是由 Kennedy 和 O'Hagan (2000) 引入的一种成熟技术，用于整合不同保真度的数据源。将其应用于核质量预测是计算物理学中一个有效且活跃的研究领域。所提供的预测均值和方差公式是在高斯似然下进行高斯过程贝叶斯推断的正确和标准结果。该问题在科学和数学上是合理的。\n- **适定性**：该问题是适定的。它为获得唯一解提供了完整的信息集：模型结构、所有必要的超参数、核函数的明确形式、完整的训练数据集和测试点。任务是基于这些给定条件的直接计算。协方差矩阵是对称的，并且加上正定的噪声方差矩阵 $\\sigma_n^2 I$ 后，保证是正定的，因此是可逆的，从而确保所涉及的线性系统存在唯一解。\n- **客观性**：问题以精确、客观、明确的数学语言陈述。不存在主观或基于意见的元素。\n- **完整性与一致性**：问题是自包含的。所有变量、常数和方程都已定义。单位（$\\text{MeV}$、$\\text{MeV}^2$）使用一致。数据结构（$X_L, y_L, X_H, y_H$）与模型定义一致。例如，高保真度训练位置 $X_H$ 是低保真度位置 $X_L$ 的子集，这是协同克里金法中常见（尽管非必需）的设置。\n- **其他缺陷**：该问题是可形式化的，与指定主题相关，计算上可行且非平凡的。它没有循环推理或其他逻辑谬误。\n\n### 步骤 3：结论与行动\n\n基于以上分析，该问题是**有效的**。下面将提供一个完整的、有理有据的解决方案。\n\n### 解法\n\n该问题要求我们实现并比较一个多保真度高斯过程 (GP) 模型和一个单保真度 GP 基线，用于预测核质量残差。任何 GP 模型的核心是协方差函数，或称核函数，它编码了我们对函数属性（如平滑度）的先验信念。\n\n**1. 核函数**\n\n指定的核函数是各向异性平方指数 (SE) 核函数。给定两组输入点 $X_1 \\in \\mathbb{R}^{N_1 \\times 2}$ 和 $X_2 \\in \\mathbb{R}^{N_2 \\times 2}$，协方差矩阵 $K \\in \\mathbb{R}^{N_1 \\times N_2}$ 是逐元素计算的。对于任意两点 $x=[Z, N]$ 和 $x'=[Z', N']$，核函数为：\n$$\nk(x, x'; \\sigma_{f}^{2}, \\ell_{Z}, \\ell_{N}) = \\sigma_{f}^{2} \\exp\\left(-\\frac{(Z-Z')^{2}}{\\ell_{Z}^{2}} - \\frac{(N-N')^{2}}{\\ell_{N}^{2}}\\right)\n$$\n其中 $\\sigma_{f}^{2}$ 是信号方差，$\\ell_{Z}, \\ell_{N}$ 分别是沿质子 ($Z$) 和中子 ($N$) 轴的特征长度尺度。我们将把这个函数实现为一个可复用的模块。使用了两个不同的核函数：$k_L$ 用于低保真度过程 $f_L(x)$，$k_\\delta$ 用于差异过程 $\\delta(x)$。\n\n**2. 单保真度 (SF) 预测分布**\n\nSF 模型仅使用高保真度数据 $\\{X_H, y_H\\}$ 进行预测。该模型假设高保真度函数 $f_H(x)$ 是一个 GP。问题指明，该 GP 的核函数是由多保真度结构隐含的复合核函数：\n$$\nk_{H}(x, x') = \\text{Cov}(f_H(x), f_H(x')) = \\text{Cov}(\\rho f_L(x) + \\delta(x), \\rho f_L(x') + \\delta(x'))\n$$\n由于 $f_L$ 和 $\\delta$ 的独立性，这可以简化为：\n$$\nk_{H}(x, x') = \\rho^2 \\text{Cov}(f_L(x), f_L(x')) + \\text{Cov}(\\delta(x), \\delta(x')) = \\rho^2 k_L(x, x') + k_\\delta(x, x')\n$$\n观测模型为 $y_H(x) = f_H(x) + \\epsilon_H(x)$。令 $Y_H$ 为高保真度观测向量。$f_H(x^*)$ 在新点 $x^*$ 处的预测分布是高斯分布，$p(f_H(x^*) | Y_H, X_H) = \\mathcal{N}(\\mu_{\\text{SF}}(x^*), \\sigma^2_{\\text{SF}}(x^*))$，其均值和方差由标准 GP 条件化方程给出：\n$$\n\\mu_{\\text{SF}}(x^{*}) = k_{H,*}^{\\top} K_{H}^{-1} Y_{H}\n$$\n$$\n\\sigma^{2}_{\\text{SF}}(x^{*}) = v_{H} - k_{H,*}^{\\top} K_{H}^{-1} k_{H,*}\n$$\n其中：\n- $K_{H} = k_{H}(X_{H}, X_{H}) + \\sigma_{H,n}^{2} I$ 是观测值 $y_H$ 的 $(N_H \\times N_H)$ 协方差矩阵。\n- $k_{H,*} = k_{H}(X_{H}, x^{*})$ 是训练点和测试点之间的 $(N_H \\times 1)$ 协方差向量。\n- $v_{H} = k_{H}(x^{*}, x^{*}) = \\rho^2 k_L(x^*, x^*) + k_\\delta(x^*, x^*) = \\rho^2 \\sigma_{L,f}^2 + \\sigma_{\\delta,f}^2$ 是 $f_H$ 在 $x^*$ 处的先验方差。\n为了计算这个，我们首先构建复合核矩阵 $k_H(X_H, X_H)$，将其对角线加上噪声方差，然后求解线性系统以找到均值和方差。\n\n**3. 多保真度 (MF) 预测分布**\n\nMF 模型同时利用了低保真度数据 $\\{X_L, y_L\\}$ 和高保真度数据 $\\{X_H, y_H\\}$。我们将观测值堆叠成一个单一向量 $Y = [Y_L; Y_H]$。目标是找到以该联合数据集为条件的 $f_H(x^*)$ 的预测分布。预测分布同样是高斯分布，$p(f_H(x^*) | Y, X_L, X_H) = \\mathcal{N}(\\mu_{\\text{MF}}(x^*), \\sigma^2_{\\text{MF}}(x^*))$。总体结构是相同的，但协方差矩阵变成了反映所有数据点之间相关性的块状矩阵。\n\n联合协方差矩阵 $K = \\text{Cov}(Y, Y)$ 是一个 $( (N_L+N_H) \\times (N_L+N_H) )$ 的块状矩阵：\n$$\nK = \\begin{bmatrix} \\text{Cov}(Y_L, Y_L)  \\text{Cov}(Y_L, Y_H) \\\\ \\text{Cov}(Y_H, Y_L)  \\text{Cov}(Y_H, Y_H) \\end{bmatrix}\n$$\n这些块由模型结构推导得出：\n- $\\text{Cov}(Y_L, Y_L) = k_L(X_L, X_L) + \\sigma_{L,n}^2 I = K_{LL} + \\sigma_{L,n}^2 I$。\n- $\\text{Cov}(Y_L, Y_H) = \\text{Cov}(f_L(X_L), \\rho f_L(X_H) + \\delta(X_H)) = \\rho k_L(X_L, X_H) = \\rho K_{LH}$。\n- $\\text{Cov}(Y_H, Y_H) = \\text{Cov}(\\rho f_L(X_H) + \\delta(X_H), \\rho f_L(X_H) + \\delta(X_H)) + \\sigma_{H,n}^2 I = \\rho^2 k_L(X_H, X_H) + k_\\delta(X_H, X_H) + \\sigma_{H,n}^2 I = \\rho^2 K_{HH}^{(L)} + K_{HH}^{(\\delta)} + \\sigma_{H,n}^2 I$。\n\n互协方差向量 $k = \\text{Cov}(Y, f_H(x^*))$ 是一个 $( (N_L+N_H) \\times 1 )$ 的块状向量：\n$$\nk = \\begin{bmatrix} \\text{Cov}(Y_L, f_H(x^*)) \\\\ \\text{Cov}(Y_H, f_H(x^*)) \\end{bmatrix}\n$$\n- $\\text{Cov}(Y_L, f_H(x^*)) = \\text{Cov}(f_L(X_L), \\rho f_L(x^*) + \\delta(x^*)) = \\rho k_L(X_L, x^*)$。\n- $\\text{Cov}(Y_H, f_H(x^*)) = \\text{Cov}(\\rho f_L(X_H) + \\delta(X_H), \\rho f_L(x^*) + \\delta(x^*)) = \\rho^2 k_L(X_H, x^*) + k_\\delta(X_H, x^*)$。\n\n目标量的先验方差是 $v_H = k_H(x^*, x^*)$，这与单保真度情况下的先验方差相同。预测均值和方差则为：\n$$\n\\mu_{\\text{MF}}(x^{*}) = k^{\\top} K^{-1} Y\n$$\n$$\n\\sigma^{2}_{\\text{MF}}(x^{*}) = v_{H} - k^{\\top} K^{-1} k\n$$\n\n**4. 实现与计算**\n\n对于每个测试点 $x^*$，算法按以下步骤进行：\n1.  定义所有超参数和数据集。\n2.  实现 SE 核函数。\n3.  **对于 SF 模型**：\n    a. 构建复合核矩阵 $k_H(X_H, X_H)$ 和互协方差向量 $k_H(X_H, x^*)$。\n    b. 通过添加噪声形成最终的协方差矩阵 $K_H$。\n    c. 求解必要的线性系统以找到 $\\mu_{\\text{SF}}(x^*)$ 和 $\\sigma^2_{\\text{SF}}(x^*)$。在数值上，求解 $K_H \\alpha = Y_H$ 以得到 $\\alpha$，然后计算 $\\mu = k^\\top \\alpha$，比显式地求 $K_H$ 的逆更稳定。\n4.  **对于 MF 模型**：\n    a. 构建所有需要的核子矩阵：$K_{LL}$、$K_{LH}$、$K_{HH}^{(L)}$、$K_{HH}^{(\\delta)}$。\n    b. 组装完整的块状矩阵 $K$ 和块状向量 $k$。\n    c. 求解涉及 $K$ 的线性系统以找到 $\\mu_{\\text{MF}}(x^*)$ 和 $\\sigma^2_{\\text{MF}}(x^*)$。\n5.  计算不确定性降低率 $r(x^*)$。\n6.  为每个测试点收集并格式化所有五个结果值。\n\n低保真度数据作为对共享的底层过程 $f_L(x)$ 的附加约束，通过自回归结构，这有助于更好地约束高保真度过程 $f_H(x)$。这通常会导致 $\\sigma^2_{\\text{MF}}  \\sigma^2_{\\text{SF}}$，从而得到一个正的不确定性降低率 $r  0$。", "answer": "[-0.704284,0.852460,-0.608351,1.341381,0.364478,6.071536,1.403565,6.103043,2.571439,0.454045,-2.915729,3.504245,-3.000000,10.026422,0.650494]", "id": "3568164"}, {"introduction": "机器学习在科学领域的终极目标不仅仅是为现有数据建模，更是为了加速新发现。这项高级练习将让您扮演策略家的角色，利用模型的预测不确定性来指导未来的实验。您将实现一个基于决策理论的采集函数，以确定测量哪个新原子核的质量最有助于精确圈定中子滴线的位置——这是核素图的关键特征。本实践展示了不确定性量化如何将预测模型转变为主动科学探索的工具。[@problem_id:3568168]", "problem": "您的任务是设计并实现一个单步、决策论的采集函数，用于建议对双中子分离能进行一次新的测量，以在质子数固定的情况下，最大程度地减少双中子滴线位置的不确定性。您的程序必须计算指定候选集上该采集分数并对多个测试用例进行排序。\n\n对于固定的质子数 $Z$，定义双中子分离能 $S_{2n}(Z,N)$ 为原子核结合能之差，即 $S_{2n}(Z,N) = B(Z,N) - B(Z,N-2)$。质子数为 $Z$ 的元素的双中子滴线位置是满足 $S_{2n}(Z,N_{\\mathrm{d}})  0$ 且 $S_{2n}(Z,N_{\\mathrm{d}}+2) \\le 0$ 的最大中子数 $N_{\\mathrm{d}}$。在此问题中，您将在一个离散的中子网格上工作，并将 $S_{2n}(Z,N)$ 视为定义在一组整数 $N$ 值上的潜函数 $g(N)$。假设 $g(N)$ 服从一个高斯过程先验（等价于离散网格上的联合高斯先验），其均值向量为 $\\boldsymbol{\\mu}$，协方差矩阵为 $\\mathbf{K}$，并伴有方差为 $\\tau^2$ 的附加独立高斯观测噪声。\n\n您必须从第一性原理出发，推导出一个单步采集分数，该分数用于量化如果在候选的中子数 $N_{\\mathrm{c}}$ 处测量 $g(N)$，滴线位置 $N_{\\mathrm{d}}$ 的后验方差的期望减少量。然后，为提供的候选集中的每个候选者计算并排序该分数。请使用以下基本事实作为您的出发点：\n\n- 如果 $\\begin{bmatrix} g(N_*) \\\\ g(N_{\\mathrm{c}}) \\end{bmatrix}$ 是联合高斯分布，其协方差矩阵条目为 $k_{**} = \\mathrm{Var}\\!\\left[g(N_*)\\right]$、$k_{\\mathrm{cc}} = \\mathrm{Var}\\!\\left[g(N_{\\mathrm{c}})\\right]$ 和 $k_{*\\mathrm{c}} = \\mathrm{Cov}\\!\\left[g(N_*), g(N_{\\mathrm{c}})\\right]$，并且获得了一个带噪声的观测 $y_{\\mathrm{c}} = g(N_{\\mathrm{c}}) + \\epsilon$，其中 $\\epsilon \\sim \\mathcal{N}(0,\\tau^2)$，那么 $N_*$ 处的后验方差将从 $k_{**}$ 减少到 $k_{**} - \\dfrac{k_{*\\mathrm{c}}^2}{k_{\\mathrm{cc}} + \\tau^2}$。\n- 如果标量参数 $\\theta$ 由一个平滑函数 $h$ 的根通过 $h(\\theta) = 0$ 隐式定义，并且在某名义点上 $h$ 存在高斯不确定性，那么 delta 方法给出的方差传播近似为 $\\mathrm{Var}(\\theta) \\approx \\dfrac{\\mathrm{Var}\\!\\left[h(\\theta_0)\\right]}{\\left(h'(\\theta_0)\\right)^2}$，其中 $\\theta_0$ 是一个合适的线性化点，且 $h'(\\theta_0) \\neq 0$。\n\n请按如下方式将上述内容具体化。对于给定的测试用例：\n\n1. 固定一个离散的中子数网格 $N \\in \\{N_{\\min}, N_{\\min}+1, \\dots, N_{\\max}\\}$。将此网格上的 $g(N)$ 视为联合高斯分布，其均值 $\\mu(N)$ 和协方差 $K(N,N')$ 由整数网格上的平方指数核函数给出：\n$$\nK(N,N') = \\sigma_f^2 \\exp\\!\\left(-\\frac{(N - N')^2}{2 \\ell^2}\\right),\n$$\n其中 $\\sigma_f^2$ 是信号方差，$\\ell$ 是以中子数单位表示的相关长度。测量噪声为 $\\tau^2$。\n\n2. 将名义线性化索引 $N_*$ 定义为在网格上使 $|\\mu(N)|$ 最小化的网格点（即，在当前均值下，最有可能是 $S_{2n} = 0$ 水平集附近的点）。通过网格上的有限差分来近似斜率 $g'(N_*)$：\n- 如果 $N_*$ 严格位于 $N_{\\min}$ 和 $N_{\\max}$ 之间，使用中心差分 $g'(N_*) \\approx \\dfrac{\\mu(N_*+1) - \\mu(N_*-1)}{2}$。\n- 如果 $N_* = N_{\\min}$，使用前向差分 $g'(N_*) \\approx \\mu(N_{\\min}+1) - \\mu(N_{\\min})$。\n- 如果 $N_* = N_{\\max}$，使用后向差分 $g'(N_*) \\approx \\mu(N_{\\max}) - \\mu(N_{\\max}-1)$。\n\n3. 对于提供的候选集 $\\mathcal{C}$（网格的一个子集）中的每个候选者 $N_{\\mathrm{c}}$，计算一个与 $\\mathrm{Var}(N_{\\mathrm{d}})$ 的期望减少量成正比的采集分数，假设在 $N_{\\mathrm{c}}$ 处进行了一次观测并被吸收。使用高斯条件化事实来量化 $\\mathrm{Var}\\!\\left[g(N_*)\\right]$ 的减少量，并使用 delta 方法将此减少量传播到 $\\mathrm{Var}(N_{\\mathrm{d}})$。为确保在 $|g'(N_*)|$ 非常小时的数值稳定性，通过在 $g'(N_*)^2$ 上加上一个小的 $\\varepsilon  0$ 来对分母进行正则化，其中 $\\varepsilon = 10^{-12}$。\n\n4. 按采集分数降序对 $\\mathcal{C}$ 中的候选者进行排序，若分数相同则按 $N_{\\mathrm{c}}$ 升序排列。\n\n您必须实现以上步骤，并在以下三个测试用例上运行它。在每个案例中，所有能量单位均为兆电子伏特，但您的代码应纯粹进行数值计算；无需单位转换。最终的程序输出应为单行，包含一个由三个列表组成的列表，其中每个内部列表是针对该测试用例按采集分数降序排序的候选集。\n\n测试用例 A（理想交叉情况）：\n- 质子数 $Z = 50$。\n- 中子网格 $N \\in \\{60, 61, \\dots, 90\\}$。\n- 均值函数 $\\mu(N) = 8.0 - 0.3 \\times (N - 60)$。\n- 核函数超参数 $\\sigma_f = 2.0$, $\\ell = 2.5$。\n- 观测噪声方差 $\\tau^2 = 0.16$。\n- 候选集 $\\mathcal{C} = \\{65, 80, 85, 86, 87, 90\\}$。\n\n测试用例 B（网格上所有均值为正）：\n- 质子数 $Z = 20$。\n- 中子网格 $N \\in \\{20, 21, \\dots, 40\\}$。\n- 均值函数 $\\mu(N) = 12.0 - 0.1 \\times (N - 20)$。\n- 核函数超参数 $\\sigma_f = 1.5$, $\\ell = 3.0$。\n- 观测噪声方差 $\\tau^2 = 0.09$。\n- 候选集 $\\mathcal{C} = \\{20, 30, 40\\}$。\n\n测试用例 C（网格上所有均值为负）：\n- 质子数 $Z = 28$。\n- 中子网格 $N \\in \\{52, 53, \\dots, 62\\}$。\n- 均值函数 $\\mu(N) = -2.0 - 0.1 \\times (N - 52)$。\n- 核函数超参数 $\\sigma_f = 1.0$, $\\ell = 2.0$。\n- 观测噪声方差 $\\tau^2 = 0.04$。\n- 候选集 $\\mathcal{C} = \\{52, 56, 60, 62\\}$。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是一个用方括号括起来的、由按采集分数降序排序的候选中子数组成的逗号分隔列表。例如，一个有效的输出格式是 $[[n_{1,1},n_{1,2}], [n_{2,1},n_{2,2},n_{2,3}], [n_{3,1}]]$，但在打印的字符串中任何地方都没有空格。具体来说，输出必须看起来像一个没有空格的 $[[\\cdots],[\\cdots],[\\cdots]]$ 形式的字符串。", "solution": "该问题要求设计并实现一个单步决策论的采集函数。其目标是从一组候选点中确定一个未来的测量点，该点有望最大程度地减少双中子滴线位置的不确定性。此问题的基础在于贝叶斯建模，特别是使用高斯过程（GP）来表示我们关于双中子分离能 $S_{2n}$ 的知识。\n\n首先，我们将问题形式化。对于固定的质子数 $Z$，双中子分离能被建模为一个在离散中子数网格 $N$ 上的潜函数 $g(N)$。此函数被假定遵循高斯过程先验，这意味着对于任何有限点集 $\\{N_1, N_2, \\dots, N_m\\}$，函数值向量 $[g(N_1), g(N_2), \\dots, g(N_m)]^T$ 遵循一个多元高斯分布。该分布由一个均值函数 $\\mu(N)$ 和一个协方差函数（或称核函数）$K(N,N')$ 完全指定。问题提供了这些信息：\n- 均值函数：$\\mu(N)$，为每个测试用例指定。\n- 协方差函数：一个平方指数核函数，$K(N,N') = \\sigma_f^2 \\exp\\left(-\\frac{(N - N')^2}{2 \\ell^2}\\right)$，其中 $\\sigma_f^2$ 是信号方差，$\\ell$ 是相关长度。\n\n双中子滴线 $N_{\\mathrm{d}}$ 定义为满足 $S_{2n}(Z,N_{\\mathrm{d}})  0$ 且 $S_{2n}(Z,N_{\\mathrm{d}}+2) \\le 0$ 的最大中子数。对于一个平滑变化的 $S_{2n}$ 函数，这可近似为求根条件 $g(N_{\\mathrm{d}}) = S_{2n}(Z,N_{\\mathrm{d}}) \\approx 0$。\n\n我们的目标是量化在候选位置 $N_{\\mathrm{c}}$ 进行一次新的带噪声的测量 $y_{\\mathrm{c}} = g(N_{\\mathrm{c}}) + \\epsilon$ 的效用，其中噪声 $\\epsilon$ 是均值为 $0$、方差为 $\\tau^2$ 的高斯噪声。效用，或称采集分数，被定义为滴线位置方差 $\\mathrm{Var}(N_{\\mathrm{d}})$ 的期望减少量。\n\n为了将我们函数的方差 $\\mathrm{Var}[g(N)]$ 与滴线位置的方差 $\\mathrm{Var}(N_{\\mathrm{d}})$ 联系起来，我们采用 delta 方法。滴线由 $g(N_{\\mathrm{d}}) = 0$ 隐式定义。将 $g(N)$ 在一个合适的点 $N_*$ 周围进行线性化，我们得到 $g(N) \\approx g(N_*) + g'(N_*)(N - N_*)$。设 $g(N_{\\mathrm{d}}) = 0$ 可得 $0 \\approx g(N_*) + g'(N_*)(N_{\\mathrm{d}} - N_*)$，整理后可得到滴线位置的估计值：$N_{\\mathrm{d}} \\approx N_* - \\frac{g(N_*)}{g'(N_*)}$。通过此线性化表达式传播方差，得到 delta 方法的近似：\n$$\n\\mathrm{Var}(N_{\\mathrm{d}}) \\approx \\mathrm{Var}\\left(N_* - \\frac{g(N_*)}{g'(N_*)}\\right) = \\frac{\\mathrm{Var}[g(N_*)]}{(g'(N_*))^2}\n$$\n问题指定线性化点 $N_*$ 应为先验均值 $|\\mu(N)|$ 最小的网格点。这是我们当前对根位置的最佳猜测。斜率 $g'(N_*)$ 是通过在 $N_*$ 处对均值函数 $\\mu(N)$ 应用所提供的规则进行有限差分来近似的。\n\n在任何测量之前，$g(N_*)$ 的方差是先验方差，由核函数给出：$\\mathrm{Var}_{prior}[g(N_*)] = K(N_*, N_*) = k_{**}$。\n问题提供了在 $N_{\\mathrm{c}}$ 处进行一次带噪声的测量后，$g(N_*)$ 的后验方差的标准公式：\n$$\n\\mathrm{Var}_{post}[g(N_*)] = k_{**} - \\frac{k_{*\\mathrm{c}}^2}{k_{\\mathrm{cc}} + \\tau^2}\n$$\n其中 $k_{**} = K(N_*,N_*)$，$k_{\\mathrm{cc}} = K(N_{\\mathrm{c}},N_{\\mathrm{c}})$，以及 $k_{*\\mathrm{c}} = K(N_*,N_{\\mathrm{c}})$。\n\n因此，$g(N_*)$ 的方差减少量为：\n$$\n\\Delta \\mathrm{Var}[g(N_*)] = \\mathrm{Var}_{prior}[g(N_*)] - \\mathrm{Var}_{post}[g(N_*)] = \\frac{k_{*\\mathrm{c}}^2}{k_{\\mathrm{cc}} + \\tau^2}\n$$\n采集分数 $A(N_{\\mathrm{c}})$ 是滴线位置方差的期望减少量。使用 delta 方法，我们将 $\\mathrm{Var}[g(N_*)]$ 的减少量传播到 $\\mathrm{Var}(N_{\\mathrm{d}})$ 的减少量：\n$$\nA(N_{\\mathrm{c}}) = \\Delta \\mathrm{Var}(N_{\\mathrm{d}}) \\approx \\frac{\\Delta \\mathrm{Var}[g(N_*)]}{(g'(N_*))^2} = \\frac{1}{(g'(N_*))^2} \\left(\\frac{k_{*\\mathrm{c}}^2}{k_{\\mathrm{cc}} + \\tau^2}\\right)\n$$\n为处理斜率可能非常接近零的情况，在分母的斜率平方项中加入一个小的正则化项 $\\varepsilon = 10^{-12}$。采集分数的最终表达式为：\n$$\nA(N_{\\mathrm{c}}) = \\frac{k_{*\\mathrm{c}}^2}{((g'(N_*))^2 + \\varepsilon)(k_{\\mathrm{cc}} + \\tau^2)}\n$$\n对于平方指数核函数，$k_{\\mathrm{cc}} = K(N_{\\mathrm{c}}, N_{\\mathrm{c}}) = \\sigma_f^2$ 且 $k_{*\\mathrm{c}} = K(N_*, N_{\\mathrm{c}}) = \\sigma_f^2 \\exp\\left(-\\frac{(N_* - N_{\\mathrm{c}})^2}{2 \\ell^2}\\right)$。\n\n每个测试用例的总体算法如下：\n1.  从 $N_{\\min}$ 到 $N_{\\max}$ 构建完整的中子网格 $\\mathcal{N}$。\n2.  对所有 $N \\in \\mathcal{N}$ 计算均值函数 $\\mu(N)$。\n3.  确定线性化点 $N_* = \\arg\\min_{N \\in \\mathcal{N}} |\\mu(N)|$。\n4.  通过对 $N_*$ 处的 $\\mu(N)$ 应用指定的有限差分规则（前向、后向或中心）来计算斜率 $g'(N_*)$。\n5.  对于候选集 $\\mathcal{C}$ 中的每个候选中子数 $N_{\\mathrm{c}}$：\n    a. 计算核函数项 $k_{\\mathrm{cc}} = \\sigma_f^2$ 和 $k_{*\\mathrm{c}} = \\sigma_f^2 \\exp\\left(-\\frac{(N_* - N_{\\mathrm{c}})^2}{2 \\ell^2}\\right)$。\n    b. 使用推导出的公式计算采集分数 $A(N_{\\mathrm{c}})$。\n6.  按分数 $A(N_{\\mathrm{c}})$ 的降序对候选者 $N_{\\mathrm{c}} \\in \\mathcal{C}$ 进行排序，若分数相同则选择较小的 $N_{\\mathrm{c}}$。这将为该测试用例生成最终的排序列表。", "answer": "[[87,86,85,80,90,65],[40,30,20],[52,56,60,62]]", "id": "3568168"}]}