{"hands_on_practices": [{"introduction": "重要性采样的核心思想是使提案分布 $g(x)$ 的形状尽可能接近被积函数 $|f(x)|$ 的形状。本次实践将通过一个在核物理中常见的径向积分，带你深入探索这一原理。你将亲自推导能够最小化方差的最优提案参数，并看到在这个理想情况下，方差可以降为零，这是一个对理论核心原则的有力证明 ([@problem_id:3570766])。", "problem": "在计算核物理中，当在球坐标中计算期望值时，会出现形式为 $\\int_{0}^{\\infty} e^{-\\alpha r} r^{2} \\, dr$ 的径向积分，其中 $r$ 是径向坐标，单位为飞米 ($\\mathrm{fm}$)，$\\alpha$ 是一个正速率参数，单位为 $\\mathrm{fm}^{-1}$。考虑使用重要性采样进行蒙特卡洛（MC）积分来估计该积分，使用一个在 $[0,\\infty)$ 上与 $r^{2} e^{-\\beta r}$ 成正比的提议概率密度函数 (PDF) $g(r)$，其中 $\\beta0$ 且 $g(r) = c \\, r^{2} e^{-\\beta r}$，$c$ 是一个待定的归一化常数。目标被积函数为 $f(r) = e^{-\\alpha r} r^{2}$。\n\n仅从核心定义出发，按以下步骤进行：\n- 使用概率密度函数的定义，通过强制 $\\int_{0}^{\\infty} g(r) \\, dr = 1$ 来确定常数 $c$，以使 $g(r)$ 归一化。\n- 使用重要性采样的定义，基于从 $g(r)$ 中抽取的独立样本，推导出积分 $\\int_{0}^{\\infty} f(r) \\, dr$ 的无偏蒙特卡洛估计量，并推导出相应的权重函数 $w(r)$，使得该估计量是 $w(r)$ 的样本均值。\n- 推导在 $g(r)$ 下重要性采样估计量的方差，并将其表示为 $\\alpha$ 和 $\\beta$ 的闭式函数。确定使该方差为有限的 $\\beta$ 值的范围。然后，选择 $\\beta$ 以最小化方差，并严格证明你的选择。\n- 实现一个完整、可运行的程序，该程序：\n  1. 使用带有提议 $g(r)$ 的蒙特卡洛重要性采样，通过从形状参数 $k=3$ 和速率参数 $\\beta$（等价于尺度参数 $1/\\beta$）的 Gamma 分布中采样，来抽取 $g(r)$ 的独立样本。\n  2. 对每个测试用例，计算积分的两个估计值：一个使用给定的提议参数 $\\beta$，另一个使用你的推导所蕴含的方差最小化的 $\\beta$ 选择。\n  3. 使用固定的随机数种子以保证可复现性。\n  4. 生成单行输出，其中包含所有测试用例的结果，格式为一个由方括号括起来的、逗号分隔的列表的列表，每个内部列表包含两个浮点数，分别对应于使用给定 $\\beta$ 的估计值和使用最优 $\\beta$ 的估计值。这些值必须以立方飞米 ($\\mathrm{fm}^{3}$) 表示。除了标准的双精度行为外，沒有其他四舍五入的要求。\n\n使用以下测试套件，该套件旨在探测典型行为、低方差最优采样以及近边界高方差区域：\n- 测试用例 $1$：$\\alpha = 0.5 \\ \\mathrm{fm}^{-1}$，$\\beta = 0.5 \\ \\mathrm{fm}^{-1}$，$N = 2000$ 样本，种子 $= 123$。\n- 测试用例 $2$：$\\alpha = 1.0 \\ \\mathrm{fm}^{-1}$，$\\beta = 0.7 \\ \\mathrm{fm}^{-1}$，$N = 50000$ 样本，种子 $= 456$。\n- 测试用例 $3$：$\\alpha = 1.0 \\ \\mathrm{fm}^{-1}$，$\\beta = 1.99 \\ \\mathrm{fm}^{-1}$，$N = 50000$ 样本，种子 $= 789$。\n- 测试用例 $4$：$\\alpha = 2.0 \\ \\mathrm{fm}^{-1}$，$\\beta = 0.2 \\ \\mathrm{fm}^{-1}$，$N = 100000$ 样本，种子 $= 321$。\n\n你的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表形式的结果，其中每个元素都是 $[\\text{estimate\\_given\\_}\\beta,\\text{estimate\\_optimal\\_}\\beta]$ 形式的内部列表。例如，输出格式必须与 $[[x_{1},y_{1}],[x_{2},y_{2}],[x_{3},y_{3}],[x_{4},y_{4}]]$ 完全一样，其中每个 $x_{i}$ 和 $y_{i}$ 都是一个以 $\\mathrm{fm}^{3}$ 为单位的浮点数。", "solution": "我们从第一性原理出发，建立积分和重要性采样估计量。目标积分为\n$$\nI(\\alpha) = \\int_{0}^{\\infty} f(r) \\, dr = \\int_{0}^{\\infty} e^{-\\alpha r} r^{2} \\, dr,\n$$\n其中 $r \\ge 0$，$\\alpha  0$，$r$ 的单位为飞米 ($\\mathrm{fm}$)，$\\alpha$ 的单位为反比飞米 ($\\mathrm{fm}^{-1}$)，从而得到 $I(\\alpha)$ 的单位为立方飞米 ($\\mathrm{fm}^{3}$)。我们引入一个与 $r^{2} e^{-\\beta r}$ 成正比的提议概率密度函数 $g(r)$，其中 $\\beta0$：\n$$\ng(r) = c \\, r^{2} e^{-\\beta r}, \\quad r \\in [0,\\infty).\n$$\n根据概率密度函数的定义，$g$ 必须满足 $\\int_{0}^{\\infty} g(r) \\, dr = 1$。因此，\n$$\n1 = \\int_{0}^{\\infty} g(r) \\, dr = c \\int_{0}^{\\infty} r^{2} e^{-\\beta r} \\, dr.\n$$\n积分 $\\int_{0}^{\\infty} r^{n} e^{-\\lambda r} \\, dr$ 是一个标准的基于 Gamma 函数的积分。使用 Gamma 函数 $\\Gamma(z)$ 的定义 $\\Gamma(z) = \\int_{0}^{\\infty} t^{z-1} e^{-t} \\, dt$（对于 $z0$），并进行换元 $t = \\lambda r$可得\n$$\n\\int_{0}^{\\infty} r^{n} e^{-\\lambda r} \\, dr = \\frac{n!}{\\lambda^{n+1}}, \\quad \\lambda  0, \\ n \\in \\mathbb{N}.\n$$\n对于 $n = 2$ 和 $\\lambda = \\beta$，我们有\n$$\n\\int_{0}^{\\infty} r^{2} e^{-\\beta r} \\, dr = \\frac{2!}{\\beta^{3}} = \\frac{2}{\\beta^{3}}.\n$$\n因此，\n$$\n1 = c \\cdot \\frac{2}{\\beta^{3}} \\quad \\Rightarrow \\quad c = \\frac{\\beta^{3}}{2}.\n$$\n于是，归一化的提议函数为\n$$\ng(r) = \\frac{\\beta^{3}}{2} r^{2} e^{-\\beta r}, \\quad r \\ge 0,\n$$\n这正是形状参数 $k = 3$ 和速率参数 $\\beta$（等价于尺度参数 $1/\\beta$）的 Gamma 分布的概率密度函数，因为通用的 Gamma PDF 为\n$$\n\\text{Gamma}(k,\\beta): \\quad g(r) = \\frac{\\beta^{k}}{\\Gamma(k)} r^{k-1} e^{-\\beta r}.\n$$\n对于 $k=3$，$\\Gamma(3) = 2$，这与 $g(r) = (\\beta^{3}/2) r^{2} e^{-\\beta r}$ 相匹配。\n\n在重要性采样中，精确积分可以写成在 $g$ 分布下的期望：\n$$\nI(\\alpha) = \\int_{0}^{\\infty} f(r) \\, dr = \\int_{0}^{\\infty} \\frac{f(r)}{g(r)} g(r) \\, dr = \\mathbb{E}_{g}[w(r)],\n$$\n其中权重函数 $w(r)$ 定义为\n$$\nw(r) = \\frac{f(r)}{g(r)} = \\frac{e^{-\\alpha r} r^{2}}{(\\beta^{3}/2) r^{2} e^{-\\beta r}} = \\frac{2}{\\beta^{3}} \\exp\\left( -(\\alpha - \\beta) r \\right).\n$$\n设 $r_{1}, r_{2}, \\dots, r_{N}$ 是从 $g(r)$ 中抽取的独立同分布样本。蒙特卡洛估计量是权重的样本均值：\n$$\n\\widehat{I}_{N} = \\frac{1}{N} \\sum_{i=1}^{N} w(r_{i}),\n$$\n根据构造，该估计量是无偏的，因为 $\\mathbb{E}_{g}[\\widehat{I}_{N}] = \\mathbb{E}_{g}[w(r)] = I(\\alpha)$。\n\n为了研究并最小化方差，我们计算\n$$\n\\operatorname{Var}_{g}[w(r)] = \\mathbb{E}_{g}[w(r)^{2}] - I(\\alpha)^{2}.\n$$\n首先，\n$$\nw(r)^{2} = \\left( \\frac{2}{\\beta^{3}} \\right)^{2} \\exp\\left( -2(\\alpha - \\beta) r \\right),\n$$\n并且\n$$\n\\mathbb{E}_{g}[w(r)^{2}] = \\int_{0}^{\\infty} w(r)^{2} g(r) \\, dr = \\int_{0}^{\\infty} \\left( \\frac{4}{\\beta^{6}} \\exp\\left( -2(\\alpha - \\beta) r \\right) \\right) \\left( \\frac{\\beta^{3}}{2} r^{2} e^{-\\beta r} \\right) \\, dr.\n$$\n化简被积函数，\n$$\n\\mathbb{E}_{g}[w(r)^{2}] = \\frac{2}{\\beta^{3}} \\int_{0}^{\\infty} r^{2} \\exp\\left( -(2\\alpha - \\beta) r \\right) \\, dr.\n$$\n应用 $n=2$ 和 $\\lambda = 2\\alpha - \\beta$ 的 Gamma 积分，\n$$\n\\int_{0}^{\\infty} r^{2} e^{-(2\\alpha - \\beta) r} \\, dr = \\frac{2}{(2\\alpha - \\beta)^{3}},\n$$\n该积分仅在 $2\\alpha - \\beta  0$ 时有限，即 $\\beta \\in (0, 2\\alpha)$。因此，\n$$\n\\mathbb{E}_{g}[w(r)^{2}] = \\frac{4}{\\beta^{3} (2\\alpha - \\beta)^{3}},\n$$\n并且\n$$\n\\operatorname{Var}_{g}[w(r)] = \\frac{4}{\\beta^{3} (2\\alpha - \\beta)^{3}} - I(\\alpha)^{2}, \\quad \\text{for } \\beta \\in (0, 2\\alpha).\n$$\n为了最小化关于 $\\beta$ 的方差，我们只需最小化 $\\mathbb{E}_{g}[w(r)^{2}]$，因为 $I(\\alpha)$不依赖于 $\\beta$。考虑函数\n$$\n\\phi(\\beta) = \\frac{4}{\\beta^{3} (2\\alpha - \\beta)^{3}}, \\quad \\beta \\in (0, 2\\alpha).\n$$\n引入无量纲参数 $y = \\beta / (2\\alpha)$，则 $y \\in (0,1)$，并重写为\n$$\n\\phi(y) = \\frac{4}{(2\\alpha)^{6}} \\cdot \\frac{1}{y^{3} (1 - y)^{3}}.\n$$\n因子 $4/(2\\alpha)^{6}$ 相对于 $y$ 是常数。因此，在 $y \\in (0,1)$ 上最小化 $\\phi(y)$ 等价于最大化 $y^{3} (1 - y)^{3}$，该函数是对称的，并在 $y = 1/2$ 处取得最大值。因此，方差在以下点最小化：\n$$\n\\beta^{\\star} = \\alpha.\n$$\n在此选择下，权重简化为\n$$\nw(r) = \\frac{2}{\\alpha^{3}} \\exp(0) = \\frac{2}{\\alpha^{3}},\n$$\n这是一个常数，并产生零方差，因为 $\\mathbb{E}_{g}[w(r)^{2}] = I(\\alpha)^{2}$，因此 $\\operatorname{Var}_{g}[w(r)] = 0$。这是理想重要性采样器的一种体现，其中 $g(r)$ 与目标被积函数 $f(r)$ 成正比。\n\n程序的算法设计：\n- 对每个测试用例，计算 $I(\\alpha)$ 的两个估计值：\n  1. 使用给定的提议参数 $\\beta$。\n  2. 使用最优提议参数 $\\beta^{\\star} = \\alpha$。\n- 为了从 $g(r)$ 中采样，使用形状参数 $k = 3$ 和尺度参数 $\\theta = 1/\\beta$ 的 Gamma 分布。此 Gamma 分布的概率密度函数与推导出的 $g(r)$ 相匹配。\n- 对每个样本 $r_{i}$，计算权重 $w(r_{i}) = (2/\\beta^{3}) \\exp( -(\\alpha - \\beta) r_{i} )$，并对 $N$ 个样本取平均以获得 $\\widehat{I}_{N}$。\n- 使用每个测试用例提供的固定随机数种子以确保可复现性。\n- 将结果聚合为指定的单行输出格式。每个报告的浮点数单位为 $\\mathrm{fm}^{3}$，这与 $r$ 的单位 $\\mathrm{fm}$ 和 $\\alpha$ 的单位 $\\mathrm{fm}^{-1}$ 一致。\n\n该方法遵循概率密度函数、期望和方差的基本定义，并利用 Gamma 函数经过充分检验的性质来执行精确的归一化和方差分析，确保在所提供的测试套件上实现科学上合理且数值上稳定的程序。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef mc_importance_integral(alpha, beta, N, seed):\n    \"\"\"\n    Monte Carlo importance sampling estimator for I(alpha) = ∫_0^∞ e^{-alpha r} r^2 dr\n    using proposal g(r) = (beta^3/2) r^2 e^{-beta r}, i.e., Gamma(k=3, rate=beta).\n    Returns the estimate in fm^3.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    # Sample from Gamma with shape k=3 and scale theta=1/beta (rate=beta).\n    r_samples = rng.gamma(shape=3.0, scale=1.0 / beta, size=N)\n    # Importance weight: w(r) = (2 / beta^3) * exp(-(alpha - beta) * r)\n    weights = (2.0 / (beta ** 3)) * np.exp(-(alpha - beta) * r_samples)\n    return float(np.mean(weights))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (alpha [fm^-1], beta_given [fm^-1], N samples, seed)\n    test_cases = [\n        (0.5, 0.5, 2000, 123),      # Case 1: optimal beta equals alpha\n        (1.0, 0.7, 50000, 456),     # Case 2: typical case\n        (1.0, 1.99, 50000, 789),    # Case 3: near boundary beta  2*alpha\n        (2.0, 0.2, 100000, 321),    # Case 4: small beta relative to alpha\n    ]\n\n    results = []\n    for alpha, beta_given, N, seed in test_cases:\n        # Estimate with the given beta\n        estimate_given = mc_importance_integral(alpha, beta_given, N, seed)\n        # Estimate with the optimal beta (beta_star = alpha)\n        estimate_opt = mc_importance_integral(alpha, alpha, N, seed)\n        results.append([estimate_given, estimate_opt])\n\n    # Final print statement in the exact required format.\n    # Single line output: list of lists of floats.\n    print(f\"[{','.join('[' + ','.join(map(str, pair)) + ']' for pair in results)}]\")\n\nsolve()\n```", "id": "3570766"}, {"introduction": "许多物理量，例如动态响应函数或结构因子，是通过对时间相关函数进行傅里叶变换来计算的，这自然而然地引出了振荡积分。本次练习将利用重要性采样来处理这类积分，这需要你在蒙特卡洛模拟中处理复数权重的计算与统计。通过完成这项实践，你将学会处理一类常见且具有挑战性的积分问题，并分析当被积函数非正定时采样方差的行为 ([@problem_id:3570794])。", "problem": "考虑在计算核物理的线性响应表述中出现的含时微扰响应积分，其形式为一个振荡积分\n$$\nI(\\omega)=\\int_{0}^{\\infty} \\mathrm{d}t\\, e^{i\\,\\omega\\, t}\\, C(t),\n$$\n其中 $C(t)$ 是一个随时间衰减的因果关联函数。对于本问题，假设模型关联函数为\n$$\nC(t)=\\exp\\!\\big(-(\\lambda+i\\,\\Omega)\\,t\\big),\n$$\n其中参数 $\\lambda0$ 和实数 $\\Omega$ 为固定值，因此 $C(t)$ 是指数衰减和振荡的。类频率参数 $\\omega$ 和 $\\Omega$ 应被解释为弧度每单位时间。角度必须以弧度处理。最终的数值答案中不需要物理单位。\n\n您的任务是使用重要性采样进行蒙特卡洛积分来计算 $I(\\omega)$，采用的采样概率密度为\n$$\nq_{\\gamma}(t)=\\gamma\\,e^{-\\gamma t},\\quad t\\ge 0,\n$$\n其中速率参数 $\\gamma0$ 由用户指定。相应的蒙特卡洛估计量（使用从 $q_{\\gamma}$ 分布中抽取的 $N$ 个独立样本 $t_n$）是复数权重的样本均值：\n$$\n\\widehat{I}_N(\\omega;\\gamma)=\\frac{1}{N}\\sum_{n=1}^{N} w(t_n),\\qquad\nw(t)=\\frac{e^{i\\,\\omega\\,t}C(t)}{q_{\\gamma}(t)}.\n$$\n您必须实现带有复数权重的估计量，并为每个测试用例计算：\n- 绝对误差大小\n$$\n\\Delta(\\omega,\\gamma)=\\left|\\widehat{I}_N(\\omega;\\gamma)-I(\\omega)\\right|.\n$$\n- 复数蒙特卡洛均值的估计标准差（均方根不确定度），\n$$\n\\sigma_{\\mathrm{MC}}(\\omega,\\gamma)=\\sqrt{\\frac{1}{N}\\,\\widehat{\\operatorname{Var}}\\!\\left[w(t)\\right]},\n$$\n其中 $\\widehat{\\operatorname{Var}}\\!\\left[w(t)\\right]$ 是复数权重的无偏样本方差，定义为\n$$\n\\widehat{\\operatorname{Var}}\\!\\left[w(t)\\right]=\\frac{1}{N-1}\\sum_{n=1}^{N}\\left|w(t_n)-\\frac{1}{N}\\sum_{m=1}^{N} w(t_m)\\right|^2.\n$$\n此外，您必须从上述积分定义出发，推导并使用 $I(\\omega)$ 的闭式表达式，作为 $\\Delta(\\omega,\\gamma)$ 中的参考值，不得引用问题陈述中的任何简便公式。\n\n实现要求：\n- 每个测试用例使用 $N=200{,}000$ 个独立样本。\n- 使用固定的伪随机数生成器种子 $s=20231105$，并为确保测试用例之间的独立性，按顺序使用种子 $s, s+1, s+2, \\ldots$。\n- 所有角度均以弧度为单位。\n- 输出不需要物理单位。\n\n测试套件：\n使用固定参数 $\\lambda=0.9$ 和 $\\Omega=2.5$，以及以下五个测试用例 $(\\omega,\\gamma)$：\n1. $(\\omega,\\gamma)=\\big(2.5,\\,0.9\\big)$,\n2. $(\\omega,\\gamma)=\\big(12.5,\\,0.9\\big)$,\n3. $(\\omega,\\gamma)=\\big(2.5,\\,1.38\\big)$,\n4. $(\\omega,\\gamma)=\\big(2.5,\\,0.3\\big)$,\n5. $(\\omega,\\gamma)=\\big(2.5,\\,1.79\\big)$.\n\n选择这些案例分别是为了探究平衡的采样选择、与阻尼匹配的强振荡、接近边界的大方差行为、长尾的欠采样，以及一个几乎发散的二阶矩情况。对于每个案例，报告两个实数：$\\Delta(\\omega,\\gamma)$ 和 $\\sigma_{\\mathrm{MC}}(\\omega,\\gamma)$。\n\n最终输出格式：\n您的程序必须生成单行输出，其中包含一个由方括号括起来的、包含10个实数的逗号分隔的扁平列表，顺序如下\n$$\n\\left[\\Delta(\\omega_1,\\gamma_1),\\,\\sigma_{\\mathrm{MC}}(\\omega_1,\\gamma_1),\\,\\ldots,\\,\\Delta(\\omega_5,\\gamma_5),\\,\\sigma_{\\mathrm{MC}}(\\omega_5,\\gamma_5)\\right].\n$$\n不应打印任何其他文本。结果值为无单位的纯数字，必须以标准十进制浮点字面量形式打印。", "solution": "解决方案分四个阶段进行：（1）推导积分 $I(\\omega)$ 的精确解析表达式，（2）构建带重要性采样的蒙特卡洛估计量，（3）描述统计误差分析，以及（4）指定计算的算法。\n\n**1. $I(\\omega)$ 的解析推导**\n\n待计算的积分是 $I(\\omega)=\\int_{0}^{\\infty} \\mathrm{d}t\\, e^{i\\,\\omega\\, t}\\, C(t)$。代入给定的关联函数 $C(t)=\\exp\\!\\big(-(\\lambda+i\\,\\Omega)\\,t\\big)$，我们得到：\n$$\nI(\\omega) = \\int_{0}^{\\infty} e^{i\\,\\omega\\, t} e^{-(\\lambda+i\\,\\Omega)\\,t} \\mathrm{d}t\n$$\n合并指数：\n$$\nI(\\omega) = \\int_{0}^{\\infty} e^{(i\\omega - \\lambda - i\\Omega)t} \\mathrm{d}t = \\int_{0}^{\\infty} e^{-(\\lambda - i(\\omega - \\Omega))t} \\mathrm{d}t\n$$\n这是一个标准复指数积分，形式为 $\\int_0^\\infty e^{-at} dt$，当 $a$ 的实部为正时，其值为 $1/a$。这里，$a = \\lambda - i(\\omega - \\Omega)$，其实部为 $\\operatorname{Re}(a) = \\lambda$。问题陈述 $\\lambda  0$，因此积分收敛。求值过程如下：\n$$\nI(\\omega) = \\left[ \\frac{e^{-(\\lambda - i(\\omega - \\Omega))t}}{-(\\lambda - i(\\omega - \\Omega))} \\right]_0^\\infty = 0 - \\frac{e^0}{-(\\lambda - i(\\omega - \\Omega))} = \\frac{1}{\\lambda - i(\\omega - \\Omega)}\n$$\n这个 $I(\\omega)$ 的闭式复数表达式将作为计算蒙特卡洛估计误差的精确参考值。\n\n**2. 使用重要性采样的蒙特卡洛估计**\n\n积分 $I(\\omega) = \\int_0^\\infty f(t) dt$（其中 $f(t) = e^{i\\omega t} C(t)$）使用重要性采样进行估计。我们通过引入一个可以从中抽样的概率密度函数 $q_\\gamma(t)$ 来重写该积分：\n$$\nI(\\omega) = \\int_0^\\infty \\frac{f(t)}{q_\\gamma(t)} q_\\gamma(t) dt = \\mathbb{E}_{t \\sim q_\\gamma}\\left[ \\frac{f(t)}{q_\\gamma(t)} \\right]\n$$\n量 $w(t) = f(t)/q_\\gamma(t)$ 是权重函数。该积分通过在从 $q_\\gamma(t)$ 中抽取的 $N$ 个独立随机样本 $t_n$ 上计算这些权重的样本均值来估计：\n$$\n\\widehat{I}_N(\\omega;\\gamma) = \\frac{1}{N} \\sum_{n=1}^{N} w(t_n)\n$$\n代入 $f(t)=e^{i\\omega t}e^{-(\\lambda+i\\Omega)t}$ 和 $q_\\gamma(t)=\\gamma e^{-\\gamma t}$ 的表达式，权重函数为：\n$$\nw(t) = \\frac{e^{i\\omega t} e^{-\\lambda t} e^{-i\\Omega t}}{\\gamma e^{-\\gamma t}} = \\frac{1}{\\gamma} e^{-(\\lambda-\\gamma)t} e^{i(\\omega-\\Omega)t}\n$$\n这是一个复值函数。为了从指数分布 $q_\\gamma(t)$ 生成样本 $t_n$，我们使用逆变换采样法。如果 $u_n$ 是一个来自 $[0,1)$ 上均匀分布的随机变量，那么一个来自 $q_\\gamma(t)$ 的样本 $t_n$ 由 $t_n = -\\frac{1}{\\gamma}\\ln(u_n)$ 给出。这在数值上通过从尺度为 $1/\\gamma$ 的标准指数分布中抽样来实现。\n\n**3. 统计误差估计**\n\n蒙特卡洛估计 $\\widehat{I}_N$ 的质量由其统计不确定性来量化。中心极限定理表明，对于大的 $N$，$\\widehat{I}_N$ 的分布接近一个以真值 $I(\\omega)$ 为中心、方差为 $\\operatorname{Var}[w(t)]/N$ 的高斯分布。因此，均值的标准差，也称为标准误差，是 $\\sigma_N = \\sqrt{\\operatorname{Var}[w(t)]/N}$。\n\n由于权重的真实方差 $\\operatorname{Var}[w(t)]$ 是未知的，我们使用无偏样本方差估计量从样本中估计它。对于一组 $N$ 个复数权重 $\\{w_1, \\dots, w_N\\}$，其样本均值为 $\\bar{w} = \\widehat{I}_N$，该估计量由下式给出：\n$$\n\\widehat{\\operatorname{Var}}[w(t)] = \\frac{1}{N-1} \\sum_{n=1}^N |w_n - \\bar{w}|^2\n$$\n蒙特卡洛均值的估计标准差则为：\n$$\n\\sigma_{\\mathrm{MC}}(\\omega,\\gamma) = \\sqrt{\\frac{\\widehat{\\operatorname{Var}}[w(t)]}{N}}\n$$\n这个值 $\\sigma_{\\mathrm{MC}}$ 代表了 $1$-sigma 置信区间，意味着真值 $I(\\omega)$ 有大约 $68\\%$ 的概率落在以 $\\widehat{I}_N$ 为中心、半径为 $\\sigma_{\\mathrm{MC}}$ 的复数圆盘内。另一个要求解的量是绝对误差大小 $\\Delta(\\omega,\\gamma) = |\\widehat{I}_N - I(\\omega)|$，它衡量我们特定估计值与已知精确值的实际偏差。\n\n**4. 算法**\n\n对于测试套件中的每个测试用例 $(\\omega, \\gamma)$：\n1.  使用为该案例指定的种子初始化一个伪随机数生成器。\n2.  从速率参数为 $\\gamma$ 的指数分布 $q_\\gamma(t)$ 中生成 $N=200,000$ 个随机样本 $t_n$。这等效于从尺度为 $\\beta=1/\\gamma$ 的指数分布中采样。\n3.  对于每个样本 $t_n$，计算复数权重 $w(t_n) = \\frac{1}{\\gamma} e^{-(\\lambda-\\gamma)t_n} e^{i(\\omega-\\Omega)t_n}$。\n4.  通过计算 $w(t_n)$ 值的复数平均值来计算蒙特卡洛估计 $\\widehat{I}_N$。\n5.  计算精确值 $I(\\omega) = 1/(\\lambda - i(\\omega - \\Omega))$。\n6.  计算绝对误差 $\\Delta = |\\widehat{I}_N - I(\\omega)|$。\n7.  计算复数权重的无偏样本方差 $\\widehat{\\operatorname{Var}}[w(t)]$。\n8.  计算均值的标准差 $\\sigma_{\\mathrm{MC}} = \\sqrt{\\widehat{\\operatorname{Var}}[w(t)]/N}$。\n9.  存储数对 $(\\Delta, \\sigma_{\\mathrm{MC}})$。\n\n处理完所有测试用例后，将得到的实数列表扁平化并按要求的格式打印。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Monte Carlo estimate of a complex integral using importance sampling\n    for several test cases, and reports the error and statistical uncertainty.\n    \"\"\"\n    \n    # Fixed parameters from the problem statement\n    LAMBDA = 0.9\n    OMEGA = 2.5\n    N_SAMPLES = 200_000\n    INITIAL_SEED = 20231105\n\n    # Test suite: (omega, gamma)\n    test_cases = [\n        (2.5, 0.9),\n        (12.5, 0.9),\n        (2.5, 1.38),\n        (2.5, 0.3),\n        (2.5, 1.79),\n    ]\n\n    results = []\n\n    for i, (omega, gamma) in enumerate(test_cases):\n        # Set up the random number generator with a unique seed for each case\n        seed = INITIAL_SEED + i\n        rng = np.random.default_rng(seed)\n\n        # 1. Generate N samples from the sampling distribution q_gamma(t)\n        # q_gamma(t) is an exponential distribution with rate gamma, which\n        # corresponds to a scale of 1/gamma in numpy's convention.\n        t_samples = rng.exponential(scale=1.0/gamma, size=N_SAMPLES)\n\n        # 2. Compute the complex weights w(t_n)\n        # w(t) = (1/gamma) * exp(-(lambda-gamma)*t) * exp(i*(omega-Omega)*t)\n        exponent_real = -(LAMBDA - gamma) * t_samples\n        exponent_imag = 1j * (omega - OMEGA) * t_samples\n        weights = (1.0 / gamma) * np.exp(exponent_real + exponent_imag)\n\n        # 3. Compute the Monte Carlo estimate I_hat\n        # I_hat is the sample mean of the weights.\n        I_hat = np.mean(weights)\n\n        # 4. Compute the exact analytical value of the integral I(omega)\n        # I(omega) = 1 / (lambda - i*(omega - Omega))\n        I_exact = 1.0 / (LAMBDA - 1j * (omega - OMEGA))\n\n        # 5. Compute the absolute error Delta\n        # Delta = |I_hat - I_exact|\n        delta = np.abs(I_hat - I_exact)\n\n        # 6. Compute the estimated standard deviation of the mean, sigma_MC\n        # This requires the unbiased sample variance of the complex weights.\n        # np.var with ddof=1 computes sum(|w - mean(w)|^2) / (N-1)\n        var_w_hat = np.var(weights, ddof=1)\n        sigma_mc = np.sqrt(var_w_hat / N_SAMPLES)\n\n        # Store the two required real-valued results for this case\n        results.append(delta)\n        results.append(sigma_mc)\n\n    # Final print statement in the exact required format\n    # Example: [delta_1, sigma_mc_1, delta_2, sigma_mc_2, ...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3570794"}, {"introduction": "在实践中，被积函数通常具有多种不同的特征，例如核反应截面中常见的宽缓背景和尖锐共振峰。对于这类多尺度问题，任何单一的提案分布都难以同时高效地对所有特征进行采样。本次练习将引入多重重要性采样（Multiple Importance Sampling, MIS）作为解决方案，它通过组合多个为被积函数不同部分量身定制的提案分布来解决这一难题 ([@problem_id:3570791])。你将通过量化比较单一提案策略与 MIS 策略的效率，亲身体会为何 MIS 是解决复杂多尺度问题时，实现稳健且高效蒙特卡洛积分的重要工具。", "problem": "考虑估计一个无量纲被积函数 $f(E)$ 在能量区间 $E \\in [0,E_{\\max}]$ 上的一维积分，其动机源于计算核物理中的共振行为。该被积函数是一个宽背景和一个窄共振峰的叠加，具体表示为\n$$\nf(E) = B \\,\\exp\\!\\left(-\\frac{E}{E_b}\\right) + A \\,\\frac{1}{\\pi \\Gamma \\left(1 + \\left(\\frac{E - E_0}{\\Gamma}\\right)^2\\right)} ,\n$$\n其中 $B  0$ 控制背景的振幅，$E_b  0$ 是背景尺度，$A \\ge 0$ 控制共振强度，$E_0$ 是共振中心，$\\Gamma  0$ 是共振宽度。$f(E)$ 的函数形式是无量纲的，答案无需以物理单位表示。\n\n您将比较三种重要性采样策略，用于蒙特卡洛积分 $I = \\int_0^{E_{\\max}} f(E) \\, dE$：\n- 一个针对背景的宽提议分布 $g_1(E)$，\n- 一个针对峰值的窄提议分布 $g_2(E)$，\n- 一个多重重要性采样 (MIS) 估计量，它以相等的采样分数平衡两种提议分布。\n\n提议分布由在 $[0, E_{\\max}]$ 上被正确归一化的概率密度函数给出：\n1. 用于背景的截断指数提议分布，\n$$\ng_1(E) = C_1 \\,\\exp\\!\\left(-\\frac{E}{E_b}\\right), \\quad C_1 = \\frac{1}{E_b \\left(1 - \\exp\\!\\left(-\\frac{E_{\\max}}{E_b}\\right)\\right)} .\n$$\n2. 以共振为中心的截断柯西 (洛伦兹) 提议分布，\n$$\ng_2(E) = \\frac{1}{Z_2}\\,\\frac{1}{\\pi \\Gamma \\left(1 + \\left(\\frac{E - E_0}{\\Gamma}\\right)^2\\right)} , \\quad Z_2 = \\frac{1}{\\pi}\\left[ \\arctan\\!\\left(\\frac{E_{\\max}-E_0}{\\Gamma}\\right) - \\arctan\\!\\left(\\frac{-E_0}{\\Gamma}\\right) \\right] .\n$$\n\n您必须使用以下方法实现蒙特卡洛重要性采样：\n- 对于单个提议分布 $g(E)$，从 $g$ 中抽取 $N$ 个独立样本 $\\{E_n\\}_{n=1}^N \\sim g$，并基于 $f(E_n)$ 和 $g(E_n)$ 构建一个对 $I$ 的无偏估计量。\n- 对于多重重要性采样情况，从 $g_1$ 中抽取 $N_1$ 个样本，从 $g_2$ 中抽取 $N_2$ 个样本，其中 $N_1 = \\lfloor \\alpha_1 N \\rfloor$ 和 $N_2 = N - N_1$，使用相等的采样分数 $\\alpha_1 = \\alpha_2 = \\tfrac{1}{2}$，并使用平衡启发法将它们结合起来以获得一个无偏估计量。您的实现必须以一种与 $[0,E_{\\max}]$ 上的混合采样密度一致的方式使用平衡启发法。\n\n对于每种策略，根据生成的样本权重估计蒙特卡洛估计量的方差。使用常规的估计量方差与样本数 $N$ 的缩放关系：对于每种策略，计算相应逐样本权重的经验方差，然后除以 $N$，以获得对 $I$ 的估计量方差的估计。使用固定的随机种子以确保确定性输出。\n\n您必须在截断域上实现从提议分布的精确采样：\n- 对于 $g_1(E)$，通过逆变换采样法为 $[0,E_{\\max}]$ 上的截断指数分布采样 $E$。\n- 对于 $g_2(E)$，通过逆变换采样法为 $[0,E_{\\max}]$ 上的截断柯西分布采样 $E$，这可以通过在截断的反正切边界之间采样一个均匀角度并通过正切函数映射来构建。\n\n测试套件：\n针对五组参数集评估这三种策略。对于每种情况，使用指定的参数和样本数。每种情况都包含了能量区间上限 $E_{\\max}$。在所有情况下，采样分数必须为 $\\alpha_1 = \\alpha_2 = \\tfrac{1}{2}$。\n\n- 案例 $1$ (理想情况，尺度分离)：$E_{\\max} = 10$，$B = 1$，$E_b = 3$，$A = 4$，$E_0 = 3$，$\\Gamma = 0.2$，$N = 300000$。\n- 案例 $2$ (非常窄的峰，强共振)：$E_{\\max} = 10$，$B = 1$，$E_b = 3$，$A = 20$，$E_0 = 5$，$\\Gamma = 0.01$，$N = 500000$。\n- 案例 $3$ (较宽的峰，中等强度)：$E_{\\max} = 10$，$B = 1$，$E_b = 3$，$A = 2$，$E_0 = 4$，$\\Gamma = 1.0$，$N = 250000$。\n- 案例 $4$ (峰值靠近下边界)：$E_{\\max} = 10$，$B = 1$，$E_b = 3$，$A = 8$，$E_0 = 0.2$，$\\Gamma = 0.05$，$N = 400000$。\n- 案例 $5$ (不存在峰值)：$E_{\\max} = 10$，$B = 1$，$E_b = 3$，$A = 0$，$E_0 = 4$，$\\Gamma = 0.5$，$N = 200000$。\n\n随机性要求：\n对所有随机抽取使用固定的伪随机种子 $s = 123456$，以产生确定性结果。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个测试案例的结果，格式为列表的列表。对于每个测试案例，输出列表\n$$\n\\left[ \\widehat{\\operatorname{Var}}_{g_1}, \\widehat{\\operatorname{Var}}_{g_2}, \\widehat{\\operatorname{Var}}_{\\mathrm{MIS}}, \\frac{\\widehat{\\operatorname{Var}}_{g_1}}{\\widehat{\\operatorname{Var}}_{\\mathrm{MIS}}}, \\frac{\\widehat{\\operatorname{Var}}_{g_2}}{\\widehat{\\operatorname{Var}}_{\\mathrm{MIS}}} \\right] ,\n$$\n其中每个方差是如上所述的经验估计量方差。将五个特定案例的列表按案例 $1$ 到案例 $5$ 的顺序聚合到一个列表中，并以 Python 列表语法精确打印该聚合列表，例如\n$$\n\\left[ [v_{1,1}, v_{1,2}, v_{1,3}, v_{1,4}, v_{1,5}], \\ldots, [v_{5,1}, v_{5,2}, v_{5,3}, v_{5,4}, v_{5,5}] \\right] .\n$$", "solution": "本文提出了一个完整的解决方案。问题的核心是评估三种不同的蒙特卡洛重要性采样策略在估计一个函数 $f(E)$ 积分时的性能，该函数模拟一个既有背景分量又有尖锐共振的物理过程。需要估计的积分是：\n$$\nI = \\int_0^{E_{\\max}} f(E) \\, dE\n$$\n被积函数 $f(E)$ 是能量 $E$ 的一个无量纲函数，由一个指数背景和一个洛伦兹 (柯西) 峰的叠加给出：\n$$\nf(E) = B \\,\\exp\\!\\left(-\\frac{E}{E_b}\\right) + A \\,\\frac{1}{\\pi \\Gamma \\left(1 + \\left(\\frac{E - E_0}{\\Gamma}\\right)^2\\right)}\n$$\n其中 $B  0$ 是背景振幅，$E_b  0$ 是背景衰减常数，$A \\ge 0$ 是共振强度，$E_0$ 是共振中心的能量，而 $\\Gamma  0$ 是共振的半峰全宽。\n\n目标是为三种提议的采样策略中的每一种计算蒙特卡洛估计量 $I$ 的方差。对于给定的样本数 $N$，较低的方差表明估计量更有效。\n\n重要性采样的基本原理是通过从一个提议概率密度函数 (PDF) $g(x)$ 中抽取样本 $\\{x_i\\}$ 来估计积分 $I = \\int f(x) dx$，并形成估计量 $\\hat{I} = \\frac{1}{N} \\sum_{i=1}^N \\frac{f(x_i)}{g(x_i)}$。当提议 PDF $g(x)$ 与被积函数的绝对值成正比，即 $g(x) \\propto |f(x)|$ 时，该估计量的方差最小。由于我们的 $f(E)$ 是两种不同函数形式的和，单个提议 PDF 不能同时对两部分都达到最优。这激发了对不同策略的比较。\n\n估计量 $\\hat{I}$ 的方差由 $\\operatorname{Var}(\\hat{I}) = \\frac{1}{N} \\operatorname{Var}\\left( \\frac{f(E)}{g(E)} \\right)$ 给出。我们将使用计算出的权重 $w_n = f(E_n)/g(E_n)$ 的样本方差来经验地估计这个量：\n$$\n\\widehat{\\operatorname{Var}}(\\hat{I}) = \\frac{1}{N} \\cdot \\frac{1}{N-1} \\sum_{n=1}^N (w_n - \\bar{w})^2\n$$\n其中 $\\bar{w} = \\frac{1}{N} \\sum_{n=1}^N w_n$。\n\n我们现在将详细说明三种策略中每一种的具体公式。\n\n**策略 1：针对背景的提议分布 $g_1(E)$**\n\n该策略使用一个模拟 $f(E)$ 指数背景项的提议 PDF。该提议分布是区间 $[0, E_{\\max}]$ 上的一个截断指数分布：\n$$\ng_1(E) = C_1 \\,\\exp\\!\\left(-\\frac{E}{E_b}\\right), \\quad \\text{for } E \\in [0, E_{\\max}]\n$$\n归一化常数 $C_1$ 由条件 $\\int_0^{E_{\\max}} g_1(E) dE = 1$ 确定，得到：\n$$\nC_1 = \\left( \\int_0^{E_{\\max}} \\exp\\!\\left(-\\frac{E}{E_b}\\right) dE \\right)^{-1} = \\frac{1}{E_b \\left(1 - \\exp\\!\\left(-\\frac{E_{\\max}}{E_b}\\right)\\right)}\n$$\n为了从 $g_1(E)$ 中抽取样本，我们使用逆变换采样法。累积分布函数 (CDF) 是：\n$$\nF_1(E) = \\int_0^E g_1(t) dt = \\frac{1 - \\exp(-E/E_b)}{1 - \\exp(-E_{\\max}/E_b)}\n$$\n对于一个均匀随机数 $u \\in [0,1]$，设 $F_1(E) = u$ 并反解 $E$，我们得到采样公式：\n$$\nE = -E_b \\ln\\left(1 - u\\left(1 - \\exp\\left(-\\frac{E_{\\max}}{E_b}\\right)\\right)\\right)\n$$\n对于使用此公式抽取的 $N$ 个样本 $\\{E_n\\}_{n=1}^N$，重要性权重为 $w_{1,n} = f(E_n)/g_1(E_n)$。估计量方差 $\\widehat{\\operatorname{Var}}_{g_1}$ 从这些权重计算得出。\n\n**策略 2：针对峰值的提议分布 $g_2(E)$**\n\n该策略使用一个匹配洛伦兹 (柯西) 共振峰的提议 PDF。该提议分布是一个截断柯西分布：\n$$\ng_2(E) = \\frac{1}{Z_2}\\,\\frac{1}{\\pi \\Gamma \\left(1 + \\left(\\frac{E - E_0}{\\Gamma}\\right)^2\\right)}, \\quad \\text{for } E \\in [0, E_{\\max}]\n$$\n归一化常数 $Z_2$ 是通过在域 $[0, E_{\\max}]$ 上对未归一化的柯西分布进行积分得到的：\n$$\nZ_2 = \\int_0^{E_{\\max}} \\frac{1}{\\pi \\Gamma \\left(1 + \\left(\\frac{E - E_0}{\\Gamma}\\right)^2\\right)} dE = \\frac{1}{\\pi}\\left[ \\arctan\\!\\left(\\frac{E_{\\max}-E_0}{\\Gamma}\\right) - \\arctan\\!\\left(\\frac{-E_0}{\\Gamma}\\right) \\right]\n$$\n采样同样通过逆变换法完成。其 CDF 为 $F_2(E) = \\frac{\\arctan((E-E_0)/\\Gamma) - \\theta_{\\min}}{\\theta_{\\max} - \\theta_{\\min}}$，其中 $\\theta_{\\min} = \\arctan(-E_0/\\Gamma)$ 且 $\\theta_{\\max} = \\arctan((E_{\\max}-E_0)/\\Gamma)$。设 $F_2(E)=u$ 并反解，得到：\n$$\nE = E_0 + \\Gamma \\tan(\\theta_{\\min} + u(\\theta_{\\max}-\\theta_{\\min}))\n$$\n这等同于在范围 $[\\theta_{\\min}, \\theta_{\\max}]$ 内采样一个均匀角度 $\\theta$ 并应用变换。对于以这种方式抽取的 $N$ 个样本 $\\{E_n\\}_{n=1}^N$，权重为 $w_{2,n} = f(E_n)/g_2(E_n)$，从中计算出估计量方差 $\\widehat{\\operatorname{Var}}_{g_2}$。\n\n**策略 3：多重重要性采样 (MIS)**\n\n该策略结合了两种提议分布，以稳健地处理背景和峰值。问题指定了一种与从混合 PDF 采样一致的方法：\n$$\ng_{\\text{mix}}(E) = \\alpha_1 g_1(E) + \\alpha_2 g_2(E)\n$$\n采样分数相等，$\\alpha_1 = \\alpha_2 = 1/2$。具体过程是，从 $g_1(E)$ 中抽取 $N_1 = \\lfloor N/2 \\rfloor$ 个样本，从 $g_2(E)$ 中抽取 $N_2 = N - N_1$ 个样本，然后将这 $N=N_1+N_2$ 个样本的组合集视为从 $g_{\\text{mix}}(E)$ 中抽取的。\n\n对于这个组合集中的每个样本 $E_n$，使用平衡启发法计算权重，对于混合 PDF，这对应于：\n$$\nw_{\\text{MIS},n} = \\frac{f(E_n)}{g_{\\text{mix}}(E_n)} = \\frac{f(E_n)}{\\frac{1}{2} g_1(E_n) + \\frac{1}{2} g_2(E_n)}\n$$\n这个公式非常强大，因为只要 $g_1(E_n)$ 或 $g_2(E_n)$ 中任意一个能很好地匹配 $f(E_n)$，分母就会很大（从而使得权重小而稳定）。估计量方差 $\\widehat{\\operatorname{Var}}_{\\text{MIS}}$ 是根据这 $N$ 个权重的样本方差计算得出的。\n\n通过在不同的物理场景（五个测试案例）下比较这三种方差（$\\widehat{\\operatorname{Var}}_{g_1}$、$\\widehat{\\operatorname{Var}}_{g_2}$、$\\widehat{\\operatorname{Var}}_{\\text{MIS}}$），我们可以定量地了解每种策略的有效性以及 MIS 方法的强大之处。比率 $\\widehat{\\operatorname{Var}}_{g_1}/\\widehat{\\operatorname{Var}}_{\\text{MIS}}$ 和 $\\widehat{\\operatorname{Var}}_{g_2}/\\widehat{\\operatorname{Var}}_{\\text{MIS}}$ 直接衡量了 MIS 相对于单一提议分布策略所带来的效率提升。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy is not strictly needed as np covers all required functions.\n\ndef solve():\n    \"\"\"\n    Main function to run the Monte Carlo integration comparison for all test cases.\n    \"\"\"\n    \n    # Use a fixed pseudorandom seed for all random draws to produce deterministic results.\n    rng = np.random.default_rng(123456)\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path, separated scales\n        {'E_max': 10.0, 'B': 1.0, 'E_b': 3.0, 'A': 4.0, 'E_0': 3.0, 'Gamma': 0.2, 'N': 300000},\n        # Case 2: very narrow peak, strong resonance\n        {'E_max': 10.0, 'B': 1.0, 'E_b': 3.0, 'A': 20.0, 'E_0': 5.0, 'Gamma': 0.01, 'N': 500000},\n        # Case 3: broader peak, moderate strength\n        {'E_max': 10.0, 'B': 1.0, 'E_b': 3.0, 'A': 2.0, 'E_0': 4.0, 'Gamma': 1.0, 'N': 250000},\n        # Case 4: peak near lower boundary\n        {'E_max': 10.0, 'B': 1.0, 'E_b': 3.0, 'A': 8.0, 'E_0': 0.2, 'Gamma': 0.05, 'N': 400000},\n        # Case 5: no peak present\n        {'E_max': 10.0, 'B': 1.0, 'E_b': 3.0, 'A': 0.0, 'E_0': 4.0, 'Gamma': 0.5, 'N': 200000},\n    ]\n\n    results = []\n    \n    # Integrand f(E)\n    def integrand(E, B, E_b, A, E_0, Gamma):\n        background = B * np.exp(-E / E_b)\n        # Avoid division by zero if Gamma is very small, although problem constraints ensure Gamma  0\n        cauchy_part = A / (np.pi * Gamma * (1 + ((E - E_0) / Gamma)**2))\n        return background + cauchy_part\n\n    # Proposal g1(E) - Truncated Exponential\n    def g1(E, E_b, E_max):\n        C1 = 1.0 / (E_b * (1.0 - np.exp(-E_max / E_b)))\n        return C1 * np.exp(-E / E_b)\n    \n    # Sampler for g1(E) using inverse transform sampling\n    def sample_g1(num_samples, E_b, E_max):\n        u = rng.uniform(0.0, 1.0, num_samples)\n        return -E_b * np.log(1.0 - u * (1.0 - np.exp(-E_max / E_b)))\n\n    # Proposal g2(E) - Truncated Cauchy\n    def g2(E, E_0, Gamma, E_max):\n        theta_min = np.arctan(-E_0 / Gamma)\n        theta_max = np.arctan((E_max - E_0) / Gamma)\n        Z2 = (theta_max - theta_min) / np.pi\n        return (1.0 / Z2) * (1.0 / (np.pi * Gamma * (1.0 + ((E - E_0) / Gamma)**2)))\n    \n    # Sampler for g2(E) using inverse transform sampling\n    def sample_g2(num_samples, E_0, Gamma, E_max):\n        u = rng.uniform(0.0, 1.0, num_samples)\n        theta_min = np.arctan(-E_0 / Gamma)\n        theta_max = np.arctan((E_max - E_0) / Gamma)\n        theta = theta_min + u * (theta_max - theta_min)\n        return E_0 + Gamma * np.tan(theta)\n\n    for case in test_cases:\n        p = case\n        N = p['N']\n\n        # --- Strategy 1: Importance sampling with g1 ---\n        E1_samples = sample_g1(N, p['E_b'], p['E_max'])\n        f_vals = integrand(E1_samples, p['B'], p['E_b'], p['A'], p['E_0'], p['Gamma'])\n        g1_vals = g1(E1_samples, p['E_b'], p['E_max'])\n        weights1 = f_vals / g1_vals\n        var_g1 = np.var(weights1, ddof=1) / N\n        \n        # --- Strategy 2: Importance sampling with g2 ---\n        E2_samples = sample_g2(N, p['E_0'], p['Gamma'], p['E_max'])\n        f_vals = integrand(E2_samples, p['B'], p['E_b'], p['A'], p['E_0'], p['Gamma'])\n        g2_vals = g2(E2_samples, p['E_0'], p['Gamma'], p['E_max'])\n        weights2 = f_vals / g2_vals\n        var_g2 = np.var(weights2, ddof=1) / N\n\n        # --- Strategy 3: Multiple Importance Sampling (MIS) ---\n        alpha1 = 0.5\n        alpha2 = 0.5\n        N1 = int(np.floor(alpha1 * N))\n        N2 = N - N1\n\n        E_mis_1 = sample_g1(N1, p['E_b'], p['E_max'])\n        E_mis_2 = sample_g2(N2, p['E_0'], p['Gamma'], p['E_max'])\n        E_mis_samples = np.concatenate((E_mis_1, E_mis_2))\n        \n        f_vals_mis = integrand(E_mis_samples, p['B'], p['E_b'], p['A'], p['E_0'], p['Gamma'])\n        g1_vals_mis = g1(E_mis_samples, p['E_b'], p['E_max'])\n        g2_vals_mis = g2(E_mis_samples, p['E_0'], p['Gamma'], p['E_max'])\n        \n        g_mix = alpha1 * g1_vals_mis + alpha2 * g2_vals_mis\n        weights_mis = f_vals_mis / g_mix\n        var_mis = np.var(weights_mis, ddof=1) / N\n\n        # Calculate ratios\n        ratio1_mis = var_g1 / var_mis\n        ratio2_mis = var_g2 / var_mis\n\n        case_results = [var_g1, var_g2, var_mis, ratio1_mis, ratio2_mis]\n        results.append(case_results)\n    \n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n```", "id": "3570791"}]}