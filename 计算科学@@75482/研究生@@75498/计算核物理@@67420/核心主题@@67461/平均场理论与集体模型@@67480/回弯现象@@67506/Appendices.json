{"hands_on_practices": [{"introduction": "研究原子核的回弯现象，第一步是从实验测量中提取关键的物理量。这个练习将指导你如何处理实验测量的 $\\gamma$ 射线跃迁能，并使用数值方法计算原子核的转动频率 $\\omega$。通过对比不同的有限差分方法，你将深入理解在处理像回弯这样物理性质剧烈变化的区域时，各种数值估计量的偏差、方差及其适用性。[@problem_id:3543329]", "problem": "在一个形变良好的偶偶核中，一个转动带表现出回弯现象，其中运动学转动惯量 (MOI) 随自旋发生快速变化。根据第一性原理，转动频率由曲柄关系定义为激发能对角动量的导数，即$\\hbar\\omega(I)=\\frac{dE(I)}{dI}$，其中$\\hbar$是约化普朗克常数，$E(I)$是自旋为$I$时的能级能量。在谱学中，只有跃迁能量是直接测量的：$E_\\gamma(I\\to I-2)=E(I)-E(I-2)$。一个实际的计算任务是根据测得的离散的$E_\\gamma$值来估算$\\hbar\\omega(I)$。\n\n给定以下测得的$\\gamma$射线跃遷能量（均具有$\\pm 2~\\mathrm{keV}$的独立单标准偏差不确定度），这些能量覆盖了$I\\approx 18$附近一个疑似回弯的区域：\n- $E_\\gamma(12\\to 10)=400~\\mathrm{keV}$，\n- $E_\\gamma(14\\to 12)=460~\\mathrm{keV}$，\n- $E_\\gamma(16\\to 14)=520~\\mathrm{keV}$，\n- $E_\\gamma(18\\to 16)=560~\\mathrm{keV}$，\n- $E_\\gamma(20\\to 18)=500~\\mathrm{keV}$，\n- $E_\\gamma(22\\to 20)=540~\\mathrm{keV}$。\n\n从定义$\\hbar\\omega(I)=\\frac{dE}{dI}$出发，并仅基于测得的$E_\\gamma$值，使用一致的有限差分法，判断下列哪些陈述是正确的。选择所有适用的选项。\n\nA. 从$\\hbar\\omega(I)=\\frac{dE}{dI}$和$E_\\gamma(I\\to I-2)=E(I)-E(I-2)$出发，在步长$h=2$的自旋网格上，一个对称（中心）有限差分估计量是\n$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I\\to I-2)+E_\\gamma(I+2\\to I)}{4}$。利用所给数据，这得出$\\hbar\\omega(18)\\approx 265~\\mathrm{keV}$，并且如果每个$E_\\gamma$都有$2~\\mathrm{keV}$的独立标准偏差，则由此估计量算出的$\\hbar\\omega(18)$的标准偏差约为$0.71~\\mathrm{keV}$。\n\nB. 一个前向单边估计量仅使用$E_\\gamma(I+2\\to I)$，通过$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I+2\\to I)}{2}$计算。在$I=18$时，估计值为$250~\\mathrm{keV}$；这个单边估计量比对称估计量具有更小的统计方差，并且即使在剧烈回弯处也是无偏的。\n\nC. 对于一个平滑的转动带，在自旋步长$h=2$下，对称估计量的截断误差尺度为$\\mathcal{O}(h^2)$，而单边估计量的尺度为$\\mathcal{O}(h)$。在回弯附近，位于$I=18$的对称估计量有效地平均了回弯前后的局域频率，相对于任何一侧都引入了额外的偏差，尽管其测量噪声方差低于单边估计。\n\nD. 使用这些数据，在$I=18$处的后向单边估计量给出$\\hbar\\omega\\approx 280~\\mathrm{keV}$，并且对称估计量等于相同自旋下前向和后向单边估计量的算术平均值。\n\nE. 正确的对称公式是$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I\\to I-2)+E_\\gamma(I+2\\to I)}{2}$，用数据计算得出$\\hbar\\omega(18)\\approx 530~\\mathrm{keV}$，并且它比分母为$\\dfrac{1}{4}$的版本有更低的截断误差。", "solution": "问题陈述已经过严格验证，并被确定为有效。它在科学上基于核结构物理的原理，特别是曲柄模型和转动带的唯象学。这个问题是适定的，提供了使用标准数值方法（有限差分）进行定量分析所需的所有定义和数据。其语言是客观的，数据在物理上是符合实际的。\n\n核心任务是使用离散的跃迁能量数据$E_\\gamma(I \\to I-2) = E(I) - E(I-2)$来近似计算转动频率，其定义为能量对角动量的导数，即$\\hbar\\omega(I) = \\frac{dE(I)}{dI}$。自旋$I$是以$\\hbar$为单位的无量纲量，能级间隔为$\\Delta I = 2$。\n\n我们首先推导必要的有限差分估计量$\\hbar\\omega(I)$。\n\n一阶导数$f'(x)$的标准中心差分公式（使用步长$h$）是$f'(x) \\approx \\frac{f(x+h) - f(x-h)}{2h}$。在我们这里，函数是$E(I)$，变量是$I$，对于对称差分，连接数据点的最小步长为$h=2$。因此，我们有：\n$$ \\hbar\\omega(I) = \\frac{dE}{dI}\\bigg|_I \\approx \\frac{E(I+2) - E(I-2)}{(I+2)-(I-2)} = \\frac{E(I+2) - E(I-2)}{4} $$\n我们可以用可测量的跃迁能量来表示分子：\n$ E(I+2) - E(I-2) = [E(I+2) - E(I)] + [E(I) - E(I-2)] = E_\\gamma(I+2 \\to I) + E_\\gamma(I \\to I-2) $。\n因此，**对称（中心）估计量**是：\n$$ \\hbar\\omega_S(I) \\approx \\frac{E_\\gamma(I+2 \\to I) + E_\\gamma(I \\to I-2)}{4} $$\n\n单边有限差分估计量可以用类似的方法推导。**前向估计量**使用点$I$和$I+2$：\n$$ \\hbar\\omega_F(I) = \\frac{dE}{dI}\\bigg|_I \\approx \\frac{E(I+2) - E(I)}{(I+2)-I} = \\frac{E(I+2) - E(I)}{2} = \\frac{E_\\gamma(I+2 \\to I)}{2} $$\n**后向估计量**使用点$I-2$和$I$：\n$$ \\hbar\\omega_B(I) = \\frac{dE}{dI}\\bigg|_I \\approx \\frac{E(I) - E(I-2)}{I-(I-2)} = \\frac{E(I) - E(I-2)}{2} = \\frac{E_\\gamma(I \\to I-2)}{2} $$\n\n对于自旋$I=18$的相关数据是：\n- $E_\\gamma(18 \\to 16) = 560~\\mathrm{keV}$\n- $E_\\gamma(20 \\to 18) = 500~\\mathrm{keV}$\n每次独立测量的标准偏差是$\\sigma_{E_\\gamma} = 2~\\mathrm{keV}$。\n\n现在我们来评估每个陈述。\n\n**A. 从$\\hbar\\omega(I)=\\frac{dE}{dI}$和$E_\\gamma(I\\to I-2)=E(I)-E(I-2)$出发，在步长$h=2$的自旋网格上，一个对称（中心）有限差分估计量是$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I\\to I-2)+E_\\gamma(I+2\\to I)}{4}$。利用所给数据，这得出$\\hbar\\omega(18)\\approx 265~\\mathrm{keV}$，并且如果每个$E_\\gamma$都有$2~\\mathrm{keV}$的独立标准偏差，则由此估计量算出的$\\hbar\\omega(18)$的标准偏差约为$0.71~\\mathrm{keV}$。**\n\n所提供的公式$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I\\to I-2)+E_\\gamma(I+2\\to I)}{4}$与我们推导的对称估计量$\\hbar\\omega_S(I)$相符。\n使用$I=18$的数据：\n$$ \\hbar\\omega_S(18) \\approx \\frac{E_\\gamma(18 \\to 16) + E_\\gamma(20 \\to 18)}{4} = \\frac{560~\\mathrm{keV} + 500~\\mathrm{keV}}{4} = \\frac{1060~\\mathrm{keV}}{4} = 265~\\mathrm{keV} $$\n这个计算是正确的。\n对于不确定度，令$X = E_\\gamma(I \\to I-2)$和$Y = E_\\gamma(I+2 \\to I)$，则$\\hbar\\omega_S = (X+Y)/4$。给定$\\sigma_X = \\sigma_Y = 2~\\mathrm{keV}$并且测量是独立的，方差为：\n$$ \\sigma^2_{\\omega_S} = \\left(\\frac{\\partial \\omega_S}{\\partial X}\\right)^2 \\sigma_X^2 + \\left(\\frac{\\partial \\omega_S}{\\partial Y}\\right)^2 \\sigma_Y^2 = \\left(\\frac{1}{4}\\right)^2 \\sigma_X^2 + \\left(\\frac{1}{4}\\right)^2 \\sigma_Y^2 = \\frac{1}{16} (\\sigma_X^2 + \\sigma_Y^2) $$\n$$ \\sigma^2_{\\omega_S} = \\frac{1}{16} ((2~\\mathrm{keV})^2 + (2~\\mathrm{keV})^2) = \\frac{1}{16} (4+4)~\\mathrm{keV}^2 = \\frac{8}{16}~\\mathrm{keV}^2 = 0.5~\\mathrm{keV}^2 $$\n标准偏差是$\\sigma_{\\omega_S} = \\sqrt{0.5}~\\mathrm{keV} \\approx 0.7071~\\mathrm{keV}$。这被正确地报告为约$0.71~\\mathrm{keV}$。\n这个陈述的所有部分都是正确的。\n结论：**正确**。\n\n**B. 一个前向单边估计量仅使用$E_\\gamma(I+2\\to I)$，通过$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I+2\\to I)}{2}$计算。在$I=18$时，估计值为$250~\\mathrm{keV}$；这个单边估计量比对称估计量具有更小的统计方差，并且即使在剧烈回弯处也是无偏的。**\n\n公式$\\hbar\\omega_F(I) \\approx \\frac{E_\\gamma(I+2 \\to I)}{2}$与我们的推导相符。\n使用$I=18$的数据：\n$$ \\hbar\\omega_F(18) \\approx \\frac{E_\\gamma(20 \\to 18)}{2} = \\frac{500~\\mathrm{keV}}{2} = 250~\\mathrm{keV} $$\n这个计算是正确的。\n现在，我们评估统计方差。令$Y = E_\\gamma(I+2 \\to I)$。$\\hbar\\omega_F = Y/2$的方差是：\n$$ \\sigma^2_{\\omega_F} = \\left(\\frac{1}{2}\\right)^2 \\sigma_Y^2 = \\frac{1}{4} (2~\\mathrm{keV})^2 = 1~\\mathrm{keV}^2 $$\n在A中，我们发现对称估计量的方差为$\\sigma^2_{\\omega_S} = 0.5~\\mathrm{keV}^2$。由于$1~\\mathrm{keV}^2 > 0.5~\\mathrm{keV}^2$，前向估计量有*更大*的统计方差，而不是更小。陈述的这一部分是错误的。\n此外，声称该估计量是“无偏的”是不正确的。所有导数的有限差分近似都有截断误差，这是系统偏差的一个来源。单边估计量的截断误差量级为$\\mathcal{O}(h)$，其中$h$是步长。只有当函数是完全线性的，它才是无偏的，而$E(I)$的情况并非如此。\n结论：**不正确**。\n\n**C. 对于一个平滑的转动带，在自旋步长$h=2$下，对称估计量的截断误差尺度为$\\mathcal{O}(h^2)$，而单边估计量的尺度为$\\mathcal{O}(h)$。在回弯附近，位于$I=18$的对称估计量有效地平均了回弯前后的局域频率，相对于任何一侧都引入了额外的偏差，尽管其测量噪声方差低于单边估计。**\n\n关于截断误差缩放的陈述是数值分析的标准结果。泰勒级数展开表明，中心差分$\\frac{f(x+h)-f(x-h)}{2h}$的误差是$\\mathcal{O}(h^2)$，而单边差分$\\frac{f(x+h)-f(x)}{h}$的误差是$\\mathcal{O}(h)$。这里，步长$h$是2。这一部分是正确的。\n回弯现象意味着转动性质的快速变化。在$I=18$处，对称估计量使用$E_\\gamma(18 \\to 16) = 560~\\mathrm{keV}$（回弯前）和$E_\\gamma(20 \\to 18) = 500~\\mathrm{keV}$（回弯后）。对称公式平均了来自两侧的信息，这会因混合两个不同的物理机制而引入偏差。单边估计量将它们分离开来：$\\hbar\\omega_B(18) \\approx 280~\\mathrm{keV}$和$\\hbar\\omega_F(18) \\approx 250~\\mathrm{keV}$。对称估计是$\\hbar\\omega_S(18) = 265~\\mathrm{keV}$，它是这两者的平均值，因此“平均”了它们。这是一个正确的物理和数值解释。\n最后，对称估计量的测量噪声方差低于单边估计量的说法在选项B的分析中得到了证明。$\\sigma^2_{\\omega_S} = 0.5~\\mathrm{keV}^2$小于$\\sigma^2_{\\omega_F} = \\sigma^2_{\\omega_B} = 1~\\mathrm{keV}^2$。\n这个陈述中的所有主张都是正确的。\n结论：**正确**。\n\n**D. 使用这些数据，在$I=18$处的后向单边估计量给出$\\hbar\\omega\\approx 280~\\mathrm{keV}$，并且对称估计量等于相同自旋下前向和后向单边估计量的算术平均值。**\n\n后向估计量是$\\hbar\\omega_B(I) \\approx \\frac{E_\\gamma(I \\to I-2)}{2}$。\n在$I=18$处：\n$$ \\hbar\\omega_B(18) \\approx \\frac{E_\\gamma(18 \\to 16)}{2} = \\frac{560~\\mathrm{keV}}{2} = 280~\\mathrm{keV} $$\n这个计算是正确的。\n现在，我们检查这些估计量之间的关系。前向和后向估计量的算术平均值是：\n$$ \\frac{\\hbar\\omega_F(I) + \\hbar\\omega_B(I)}{2} = \\frac{1}{2} \\left( \\frac{E_\\gamma(I+2 \\to I)}{2} + \\frac{E_\\gamma(I \\to I-2)}{2} \\right) = \\frac{E_\\gamma(I+2 \\to I) + E_\\gamma(I \\to I-2)}{4} $$\n这正是对称估计量$\\hbar\\omega_S(I)$的公式。这个性质是一个数学恒等式。\n陈述的两个部分都是正确的。\n结论：**正确**。\n\n**E. 正确的对称公式是$\\hbar\\omega(I)\\approx \\dfrac{E_\\gamma(I\\to I-2)+E_\\gamma(I+2\\to I)}{2}$，用数据计算得出$\\hbar\\omega(18)\\approx 530~\\mathrm{keV}$，并且它比分母为$\\dfrac{1}{4}$的版本有更低的截断误差。**\n\n提出的公式是$\\hbar\\omega(I) \\approx \\frac{E_\\gamma(I \\to I-2) + E_\\gamma(I+2 \\to I)}{2}$。\n正如开头所推导的，正确的对称估计量是$\\hbar\\omega_S(I) \\approx \\frac{E_\\gamma(I+2 \\to I) + E_\\gamma(I \\to I-2)}{4}$。提出的公式差了一个因子$2$。它是$2\\hbar\\omega(I)$的近似，而不是$\\hbar\\omega(I)$的。这个公式是不正确的。\n计算$\\hbar\\omega(18) \\approx \\frac{560 + 500}{2} = 530~\\mathrm{keV}$在算术上与错误的公式是一致的。\n声称这个公式有更低的截断误差是错误的。分母为$4$的公式是标准的二阶精度中心差分近似。分母为$2$的公式根本不近似$\\hbar\\omega(I)$，所以它不可能是“更好”的近似。它在近似$\\hbar\\omega(I)$时的误差大约是$\\hbar\\omega(I)$本身，这远大于正确公式的截断误差。\n结论：**不正确**。\n\n总之，选项A、C和D是正确的。", "answer": "$$\\boxed{ACD}$$", "id": "3543329"}, {"introduction": "在从实验数据中获得转动频率后，我们需要一个标准化的方法来量化回弯的程度。这个练习将引导你使用 Harris 模型建立一个平滑的转动参考，并计算出关键的诊断量——增量排列 $i_x$，它能清晰地揭示由准粒子对破裂和排列所引起的额外角动量。通过完成这个实践，你将掌握从转动能谱中识别并量化回弯现象的核心分析技术。[@problem_id:3543269]", "problem": "偶偶核中的转动带可以在摇摆模型框架内研究，其中转动频率与激发能相对于自旋的导数有关。作为转动频率函数的增量排列是回弯现象的标准诊断方法。在此问题中，您将实现一个计算程序，使用 Harris 参数化方法估计参考转动惯量，并为表现出受控回弯行为的合成带计算作为转动频率函数的增量排列。您必须编写一个可运行的程序来解决以下问题。\n\n给定以约化普朗克常数（$\\hbar$）为单位的自旋 $I$ 标记的离散能级，其转动频率（单位为兆电子伏每$\\hbar$，即 MeV$/\\hbar$）可通过测量到的激发能（单位为兆电子伏，即 MeV）的中心有限差分来近似。如果自旋步长为 $\\Delta I=2$（偶偶核），那么对于自旋为 $I$ 的内部能级，\n$$\n\\omega(I) \\approx \\frac{E(I+\\Delta I)-E(I-\\Delta I)}{2\\,\\Delta I},\n$$\n其中所有能量 $E(\\cdot)$ 的单位为 MeV，当 $I$ 以 $\\hbar$ 为单位计数且 $\\hbar$ 设为1时，得出 $\\omega$ 的单位为 MeV$/\\hbar$。作为转动频率函数的低频参考自旋由 Harris 展开式建模\n$$\nI_{\\mathrm{ref}}(\\omega) = J_0\\,\\omega + J_1\\,\\omega^3,\n$$\n其中 $J_0$ 的单位为 $\\hbar^2/\\mathrm{MeV}$，$J_1$ 的单位为 $\\hbar^4/\\mathrm{MeV}^3$。增量排列定义为\n$$\ni_x(\\omega) = I(\\omega) - I_{\\mathrm{ref}}(\\omega),\n$$\n并以 $\\hbar$ 为单位报告。\n\n您的任务是：\n- 使用一组参数控制的回弯模型，为偶数自旋 $I \\in \\{0,2,4,\\dots,I_{\\max}\\}$ 生成合成转动带能量 $E(I)$。对于每组参数，通过求解隐式方程来定义平滑的自旋-频率关系，从而解出 $\\omega$：\n$$\nI = J_0^{(\\mathrm{true})}\\,\\omega + J_1^{(\\mathrm{true})}\\,\\omega^3 + \\frac{i_{\\mathrm{align}}}{1+\\exp\\!\\left(-\\frac{\\omega-\\omega_c}{\\Delta\\omega}\\right)},\n$$\n其中 $J_0^{(\\mathrm{true})}$ 和 $J_1^{(\\mathrm{true})}$ 定义了低频参考，最后一项提供了一个 $S$ 形的排列增益，其大小为 $i_{\\mathrm{align}}$，中心位于 $\\omega_c$，宽度为 $\\Delta\\omega$。然后，使用梯形法则对自旋进行数值积分来构建 $E(I)$，自旋步长为 $\\Delta I=2$：\n$$\nE(0)=0,\\quad E(I_k)=E(I_{k-1}) + \\frac{\\omega(I_k)+\\omega(I_{k-1})}{2}\\,\\Delta I,\n$$\n并为每个 $E(I)$ 添加一个确定性噪声项 $n(I)=A_{\\mathrm{noise}}\\sin\\!\\left(\\pi I/6\\right)$（单位为 MeV），其中角度使用弧度。能量必须以 MeV 为单位报告。\n- 根据合成的 $E(I)$ 值，使用 $\\Delta I=2$ 的中心有限差分公式计算内部自旋处的离散转动频率 $\\omega(I)$，\n$$\n\\omega(I)=\\frac{E(I+2)-E(I-2)}{4}.\n$$\n- 仅使用由 $\\omega(I)\\le \\omega_{\\max}^{(\\mathrm{fit})}$ 定义的低频子集，通过将 $I$ 对回归量 $\\omega$ 和 $\\omega^3$ 进行线性最小二乘拟合来估计 $J_0$ 和 $J_1$：\n$$\nI \\approx J_0\\,\\omega + J_1\\,\\omega^3\\quad\\text{for}\\quad \\omega\\le \\omega_{\\max}^{(\\mathrm{fit})}.\n$$\n- 使用拟合出的 $\\hat J_0$ 和 $\\hat J_1$ 计算所有可用内部频率处的增量排列 $i_x(\\omega)$。然后，通过在可用频率范围内进行带钳位的线性插值，在三个指定的评估频率 $\\omega_{\\mathrm{eval}}\\in\\{0.20,0.30,0.40\\}$ MeV$/\\hbar$ 处计算 $i_x(\\omega)$ 的值。如果评估频率低于最小可用离散 $\\omega$ 或高于最大可用离散 $\\omega$，则在插值前将其钳位至最近的可用 $\\omega$。以 $\\hbar$ 为单位报告 $i_x(\\omega_{\\mathrm{eval}})$。\n- 将所有报告的浮点输出四舍五入到三位小数。\n\n物理单位：自旋 $I$ 以 $\\hbar$ 为单位。能量 $E$ 以 MeV 为单位。转动频率 $\\omega$ 以 MeV$/\\hbar$ 为单位。参数 $J_0$ 和 $J_1$ 分别以 $\\hbar^2/\\mathrm{MeV}$ 和 $\\hbar^4/\\mathrm{MeV}^3$ 为单位。增量排列 $i_x$ 以 $\\hbar$ 为单位。\n\n测试套件和所需输出：\n- 您必须实现您的程序来处理以下三组参数；每组参数定义一个合成带和一个拟合与评估任务。对于每组，您的程序必须输出一个包含五个浮点数的列表：拟合出的 $\\hat J_0$、拟合出的 $\\hat J_1$ 以及三个值 $i_x(0.20)$、$i_x(0.30)$、$i_x(0.40)$，按此顺序排列。程序必须将这三个列表聚合为一个单一的外部列表，并将其作为唯一的输出行打印。\n\n- 参数集：\n    1. A 组 (理想路径):\n        - $J_0^{(\\mathrm{true})}=30.0$, $J_1^{(\\mathrm{true})}=80.0$, $i_{\\mathrm{align}}=8.0$, $\\omega_c=0.32$, $\\Delta\\omega=0.03$, $I_{\\max}=28$, $\\omega_{\\max}^{(\\mathrm{fit})}=0.28$, $A_{\\mathrm{noise}}=0.0$.\n    2. B 组 (有噪声，能级较少):\n        - $J_0^{(\\mathrm{true})}=28.0$, $J_1^{(\\mathrm{true})}=60.0$, $i_{\\mathrm{align}}=7.0$, $\\omega_c=0.30$, $\\Delta\\omega=0.02$, $I_{\\max}=20$, $\\omega_{\\max}^{(\\mathrm{fit})}=0.26$, $A_{\\mathrm{noise}}=0.001$.\n    3. C 组 (较弱、延迟的回弯):\n        - $J_0^{(\\mathrm{true})}=32.0$, $J_1^{(\\mathrm{true})}=70.0$, $i_{\\mathrm{align}}=4.0$, $\\omega_c=0.42$, $\\Delta\\omega=0.04$, $I_{\\max}=28$, $\\omega_{\\max}^{(\\mathrm{fit})}=0.30$, $A_{\\mathrm{noise}}=0.0$.\n\n算法约束和数值细节：\n- 对于给定 $I$ 求解 $\\omega$ 的隐式方程，请在 $\\omega\\in[0,\\omega_{\\max}]$ 上使用一个稳健的求根区间法，并使用一个足够大的 $\\omega_{\\max}$ 以确保集合中所有 $I$ 的解都有界；如果需要，自动扩展区间。将 $I=0$ 视为 $\\omega=0$。\n- 使用关于 $I$ 的梯形法则，从解出的 $\\omega(I)$ 构建 $E(I)$。\n- 对于拟合，如果满足 $\\omega\\le\\omega_{\\max}^{(\\mathrm{fit})}$ 的点少于两个，则通过包含最小 $\\omega$ 的点来扩展拟合集，直到至少有两个点可用。\n- 对于评估频率处的 $i_x(\\omega)$ 插值，使用关于 $\\omega$ 的线性插值并在边界处进行钳位。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个含三个内部列表的单一列表，每个内部列表按 A、B、C 的顺序对应一组参数，并包含五个四舍五入到三位小数的浮点数：$[\\hat J_0,\\hat J_1,i_x(0.20),i_x(0.30),i_x(0.40)]$。打印的行必须只包含此列表，不得有任何附加文本。数字必须用上述指定的单位表示。", "solution": "用户提供了一个关于核物理的计算问题，涉及分析偶偶核转动带中的回弯现象。该问题具有科学依据，阐述清晰，并为多步数值程序提供了完整的指令。因此，该问题被视为有效。解决方案将按照概述的任务序列构建。\n\n问题的核心是模拟并分析一个转动带。这包括四个主要阶段：\n1.  基于自旋 $I$ 作为转动频率 $\\omega$ 函数的唯象模型，生成合成转动带能量 $E(I)$。\n2.  使用有限差分近似，从合成能量中计算离散转动频率 $\\omega(I)$，模拟对实验数据的分析。\n3.  通过对转动带的低频部分进行线性最小二乘拟合，估计定义平滑参考转动惯量的 Harris 参数 $J_0$ 和 $J_1$。\n4.  计算和评估增量排列 $i_x$，它量化了转动带自旋与平滑参考的偏差。\n\n每个步骤都将按照规定进行算法实现。\n\n**1. 合成带生成**\n\n合成数据的基础是自旋 $I$ 和转动频率 $\\omega$ 之间的关系。提供的模型是：\n$$\nI(\\omega) = J_0^{(\\mathrm{true})}\\,\\omega + J_1^{(\\mathrm{true})}\\,\\omega^3 + \\frac{i_{\\mathrm{align}}}{1+\\exp\\!\\left(-\\frac{\\omega-\\omega_c}{\\Delta\\omega}\\right)}\n$$\n该方程定义了给定频率下的自旋。前两项 $J_0^{(\\mathrm{true})}\\,\\omega + J_1^{(\\mathrm{true})}\\,\\omega^3$ 代表了平滑、无相互作用转子的 Harris 参数化。第三项是一个逻辑斯谛函数，它引入了一个快速、局域化的自旋增长，称为排列增益，其量值为 $i_{\\mathrm{align}}$，中心位于临界频率 $\\omega_c$ 附近。该项模拟了一对高 $j$ 核子与转动轴的排列，这是回弯的微观原因。\n\n为了生成转动带，我们需要对于一组给定的离散偶数自旋 $I \\in \\{0, 2, 4, \\dots, I_{\\max}\\}$ 求出频率 $\\omega$。这需要对每个自旋 $I$ 求解隐式方程 $I = I(\\omega)$ 以得到 $\\omega$。对于 $I=0$，解显然是 $\\omega=0$。对于 $I>0$，方程 $I(\\omega) - I = 0$ 必须数值求解。由于对于正参数，函数 $I(\\omega)$ 是单调递增的，因此对于任何 $I > 0$ 都存在一个唯一的根 $\\omega > 0$。一个稳健的求根算法，如 Brent-Dekker 方法，适用于此任务。我们将定义函数 $f(\\omega, I) = I(\\omega) - I$ 并在一个搜索区间内（例如 $[0, 1.0]$ MeV$/\\hbar$）找到它的根，必要时扩展该区间。\n\n一旦确定了每个自旋 $I$ 对应的平滑频率 $\\omega(I)$，就可以通过对基本关系 $dE = \\omega\\,dI$ 进行数值积分来构建相应的激发能 $E(I)$。使用梯形法则，自旋步长为 $\\Delta I = 2$，能级 $I_k$ 的能量可以从前一个能级 $I_{k-1}$ 递推计算得出：\n$$\nE(I_k) = E(I_{k-1}) + \\int_{I_{k-1}}^{I_k} \\omega(I') dI' \\approx E(I_{k-1}) + \\frac{\\omega(I_k) + \\omega(I_{k-1})}{2} \\Delta I\n$$\n当 $I_k = 2k$，$I_{k-1}=2(k-1)$，且 $\\Delta I = 2$ 时，这简化为 $E(2k) = E(2(k-1)) + \\omega(2k) + \\omega(2(k-1))$。转动带从 $E(0)=0$ 开始。\n\n最后，将一个确定性噪声项 $n(I) = A_{\\mathrm{noise}}\\sin(\\pi I/6)$ 添加到每个计算出的能量 $E(I)$ 中，以模拟实验不确定性或微小的非转动效应。\n\n**2. 转动频率计算**\n\n从离散的合成能量集合 $\\{E(I)\\}$ 中，我们使用标准的中心有限差分近似来计算导数 $\\omega = dE/dI$ 从而得到转动频率：\n$$\n\\omega(I) \\approx \\frac{E(I+\\Delta I/2) - E(I-\\Delta I/2)}{\\Delta I}\n$$\n对于自旋步长为 $\\Delta I=2$ 的偶偶核，频率通常在能级之间的中间自旋处计算。然而，该问题指定了一个以能级为中心的对称有限差分，这需要来自相邻能级的能量：\n$$\n\\omega(I) = \\frac{E(I+2) - E(I-2)}{4}\n$$\n该公式应用于转动带的所有内部自旋，即 $I \\in \\{2, 4, \\dots, I_{\\max}-2\\}$，其中必要的能量值 $E(I\\pm2)$ 是可用的。\n\n**3. Harris 参数估计**\n\n下一步是拟合 Harris 参数 $J_0$ 和 $J_1$，以为转动带的行为建立一个参考。模型为 $I \\approx J_0 \\omega + J_1 \\omega^3$。这是一个线性回归问题，其中因变量是 $I$，自变量（回归量）是 $\\omega$ 和 $\\omega^3$。待确定的系数是 $\\hat J_0$ 和 $\\hat J_1$。\n\n拟合仅限于低频数据点，即 $\\omega(I) \\le \\omega_{\\max}^{(\\mathrm{fit})}$ 的点，因为 Harris 参数化旨在描述排列发生前的转动带。如果此条件产生的数据点少于两个，则通过包含频率最小的点来扩展该集合，直到至少有两个点可用，以确保问题是适定的。\n\n拟合使用普通最小二乘法进行。我们求解矩阵方程 $A\\mathbf{x} = \\mathbf{b}$ 以获得参数向量 $\\mathbf{x} = [\\hat J_0, \\hat J_1]^T$，其中 $\\mathbf{b}$ 是自旋值 $I$ 的向量，$A$ 是设计矩阵，其列是对应的 $\\omega$ 和 $\\omega^3$ 值。最小二乘解由 $\\hat{\\mathbf{x}} = (A^T A)^{-1} A^T \\mathbf{b}$ 给出。\n\n**4. 增量排列**\n\n增量排列 $i_x$ 衡量在给定频率下，原子核相对于平滑 Harris 参考所获得的自旋。其定义为：\n$$\ni_x(\\omega) = I(\\omega) - I_{\\mathrm{ref}}(\\omega) = I(\\omega) - (\\hat J_0 \\omega + \\hat J_1 \\omega^3)\n$$\n使用拟合出的参数 $\\hat J_0$ 和 $\\hat J_1$，我们利用所有内部自旋及其对应的离散频率 $\\{\\omega(I)\\}$，计算出一组离散的排列值 $\\{i_x(I)\\}$。\n\n最后的任务是在三个特定的评估频率 $\\omega_{\\mathrm{eval}} \\in \\{0.20, 0.30, 0.40\\}$ MeV$/\\hbar$ 处确定排列值。这通过对离散数据对 $(\\omega(I), i_x(I))$ 进行线性插值来实现。问题指定了钳位：如果一个评估频率超出了计算出的离散频率范围 $[\\min(\\omega), \\max(\\omega)]$，则使用最近边界点的排列值。标准插值函数，如 `numpy.interp`，自然地处理了这种行为。\n\n对于每个参数集，得到的五个值——拟合的 $\\hat J_0$ 和 $\\hat J_1$，以及三个插值得到的排列值 $i_x(\\omega_{\\mathrm{eval}})$——被四舍五入到三位小数，并作为最终输出。整个过程被封装在一个程序中，该程序遍历所提供的测试用例。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\nimport math\n\ndef process_case(params):\n    \"\"\"\n    Executes the full analysis workflow for a single parameter set.\n    \"\"\"\n    I_max = params[\"I_max\"]\n    spins = np.arange(0, I_max + 1, 2, dtype=float)\n\n    # Helper for the implicit model I(omega)\n    def i_of_omega_model(omega, j0, j1, ialign, wc, dw):\n        if omega = 0.0:\n            return 0.0\n        harris_term = j0 * omega + j1 * omega**3\n        alignment_term = ialign / (1.0 + np.exp(-(omega - wc) / dw))\n        return harris_term + alignment_term\n\n    # Helper to find omega for a given spin I\n    def find_omega_for_spin(I):\n        if I == 0:\n            return 0.0\n        \n        j0t, j1t, ia, wc, dw = params[\"J0_true\"], params[\"J1_true\"], params[\"ialign\"], params[\"wc\"], params[\"dw\"]\n        \n        def root_func(omega):\n            return i_of_omega_model(omega, j0t, j1t, ia, wc, dw) - I\n\n        try:\n            return brentq(root_func, 1e-9, 2.0) # Search in a reasonable range\n        except ValueError: # Bracket might not contain a root, expand it\n            a, b = 1e-9, 2.0\n            fa, fb = root_func(a), root_func(b)\n            while np.sign(fa) == np.sign(fb):\n                b *= 1.5\n                if b > 100: # Safety break\n                    raise RuntimeError(f\"Could not bracket root for I={I}\")\n                fb = root_func(b)\n            return brentq(root_func, a, b)\n\n    # 1. Generate synthetic band data\n    omega_smooth = np.array([find_omega_for_spin(I) for I in spins])\n    \n    n_levels = len(spins)\n    E_synth = np.zeros(n_levels)\n    # Integrate E(I) using trapezoidal rule: E_k = E_{k-1} + (w_k+w_{k-1})/2 * deltaI, with deltaI=2.\n    for k in range(1, n_levels):\n        E_synth[k] = E_synth[k-1] + (omega_smooth[k] + omega_smooth[k-1])\n\n    # Add deterministic noise\n    A_noise = params[\"A_noise\"]\n    if A_noise != 0.0:\n        noise = A_noise * np.sin(math.pi * spins / 6.0)\n        E_synth += noise\n\n    # 2. Compute discrete frequencies omega(I) from energies\n    I_interior = spins[1:-1]\n    # omega(I=2k) = (E(I+2) - E(I-2))/4 = (E_synth[k+1] - E_synth[k-1]) / 4\n    omega_discrete = (E_synth[2:] - E_synth[:-2]) / 4.0\n\n    # 3. Fit Harris parameters J0 and J1\n    omega_max_fit = params[\"omega_max_fit\"]\n    fit_mask = omega_discrete = omega_max_fit\n    \n    if np.sum(fit_mask)  2:\n        sorted_indices = np.argsort(omega_discrete)\n        fit_indices = sorted_indices[:2]\n        I_fit = I_interior[fit_indices]\n        omega_fit = omega_discrete[fit_indices]\n    else:\n        I_fit = I_interior[fit_mask]\n        omega_fit = omega_discrete[fit_mask]\n\n    # Perform linear least squares fit: I = J0*w + J1*w^3\n    A = np.vstack([omega_fit, omega_fit**3]).T\n    b = I_fit\n    J_hat, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n    J0_hat, J1_hat = J_hat[0], J_hat[1]\n\n    # 4. Compute and interpolate incremental alignment i_x\n    I_ref = J0_hat * omega_discrete + J1_hat * omega_discrete**3\n    ix_discrete = I_interior - I_ref\n\n    omega_eval = np.array([0.20, 0.30, 0.40])\n    ix_interpolated = np.interp(omega_eval, omega_discrete, ix_discrete, left=ix_discrete[0], right=ix_discrete[-1])\n    \n    # 5. Collate and return results, rounded to 3 decimal places\n    return [\n        round(J0_hat, 3), round(J1_hat, 3), \n        round(ix_interpolated[0], 3), round(ix_interpolated[1], 3), round(ix_interpolated[2], 3)\n    ]\n\ndef solve():\n    test_cases = [\n        {\"J0_true\": 30.0, \"J1_true\": 80.0, \"ialign\": 8.0, \"wc\": 0.32, \"dw\": 0.03, \"I_max\": 28, \"omega_max_fit\": 0.28, \"A_noise\": 0.0},\n        {\"J0_true\": 28.0, \"J1_true\": 60.0, \"ialign\": 7.0, \"wc\": 0.30, \"dw\": 0.02, \"I_max\": 20, \"omega_max_fit\": 0.26, \"A_noise\": 0.001},\n        {\"J0_true\": 32.0, \"J1_true\": 70.0, \"ialign\": 4.0, \"wc\": 0.42, \"dw\": 0.04, \"I_max\": 28, \"omega_max_fit\": 0.30, \"A_noise\": 0.0}\n    ]\n    all_results = [process_case(params) for params in test_cases]\n    print(all_results)\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3543269"}, {"introduction": "回弯现象的微观理论模型不可避免地涉及到不同准粒子组态之间的交叉。这个练习将带你应对一个高级计算挑战：如何在计算中正确地追踪这些穿过“避免交叉”区域的组态。你将亲手实现并比较简单的“绝热”选择方法与更复杂的“非绝热”追踪算法，并最终理解为什么后者对于获得物理上平滑且有意义的动态转动惯量 $J^{(2)}$ 至关重要。[@problem_id:3543273]", "problem": "实现一个完整的程序，构建一个展示回弯现象的最小但物理上自洽的曲柄平均场玩具模型，并用它来比较准粒子组态在避免交叉处的绝热选择与非绝热追踪。目标是证明非绝热追踪能够改善计算出的动态转动惯量 $J^{(2)}(\\omega)$ 在交叉处的连续性和光滑性。\n\n使用以下基本基矢和定义。\n\n1. 在曲柄平均场描述中，转动频率为 $\\omega$ 时的单准粒子哈密顿量 (Routhian) 被建模为\n$$\nH(\\omega) = E_0 - \\omega J_x + \\Delta,\n$$\n其中 $E_0$ 是非曲柄单准粒子能量 $\\{\\varepsilon_i\\}$（单位为兆电子伏，MeV）的对角矩阵，$J_x$ 是排列角动量期望值 $\\{j_i\\}$（单位为约化普朗克常数）的对角矩阵，而 $\\Delta$ 是一个混合近简并轨道的实对称剩余耦合矩阵（单位为 MeV）。在固定基中，我们取 $J_x=\\mathrm{diag}(j_1,\\dots,j_N)$ 和 $E_0=\\mathrm{diag}(\\varepsilon_1,\\dots,\\varepsilon_N)$。\n\n2. 对于每个 $\\omega$，对角化 $H(\\omega)$ 以获得按 $E_k(\\omega)$ 升序排列的本征对 $\\{E_k(\\omega),\\ |\\psi_k(\\omega)\\rangle\\}$。根据 Hellmann–Feynman 定理，\n$$\n\\frac{\\partial E_k(\\omega)}{\\partial \\omega} = \\langle \\psi_k(\\omega)|\\frac{\\partial H(\\omega)}{\\partial \\omega}|\\psi_k(\\omega)\\rangle = -\\langle \\psi_k(\\omega)|J_x|\\psi_k(\\omega)\\rangle,\n$$\n因此，本征态 $k$ 的排列角动量为\n$$\nJ_k(\\omega) = \\langle \\psi_k(\\omega)|J_x|\\psi_k(\\omega)\\rangle.\n$$\n\n3. 对于一个 $K$-准粒子组态，定义总排列角动量为\n$$\nJ(\\omega) = \\sum_{k \\in \\mathcal{O}(\\omega)} J_k(\\omega),\n$$\n其中 $\\mathcal{O}(\\omega)$ 是在 $\\omega$ 处已占据本征态的集合。\n\n4. 定义动态转动惯量为\n$$\nJ^{(2)}(\\omega) = \\frac{dJ(\\omega)}{d\\omega},\n$$\n该值将在均匀频率网格上使用对称三点有限差分格式进行数值计算。\n\n5. 为 $\\mathcal{O}(\\omega)$ 在频率网格上定义两种组态追踪策略。\n- 绝热选择：在每个 $\\omega$ 处，独立地占据能量 $E_k(\\omega)$ 最低的 $K$ 个本征态。\n- 非绝热追踪：在第一个网格点 $\\omega_0$ 处，用 $K$ 个最低能量态初始化 $\\mathcal{O}(\\omega_0)$，然后对于每个后续网格点 $\\omega_{i+1}$，通过最大化总单步单位交叠，\n$$\n\\sum_{a=1}^{K} \\left|\\langle \\psi_{a}(\\omega_i) \\mid \\psi_{b_a}(\\omega_{i+1}) \\rangle\\right|^2,\n$$\n来分配 $K$ 个被追踪的态。该最大化是在所有从 $\\omega_{i+1}$ 处完整本征向量集合中选取的一一对应分配 $b_1,\\dots,b_K$ 上进行的。每一步都使用全局最优的一一分配。\n\n6. 通过 $J^{(2)}(\\omega)$ 在内部网格上的离散样本的总变差来量化其光滑性，\n$$\n\\mathcal{R} = \\sum_{i} \\left| J^{(2)}(\\omega_{i+1}) - J^{(2)}(\\omega_{i}) \\right|,\n$$\n该计算在存在有限差分值的内部点上进行。定义改进因子\n$$\nF = \\frac{\\mathcal{R}_{\\mathrm{adiabatic}}}{\\mathcal{R}_{\\mathrm{diabatic}}}.\n$$\n如果 $F1$，则相对于绝热选择，非绝热追踪降低了粗糙度。为保证数值稳健性，当分母小于一个很小的容差时，如果分子和分母都低于该容差，则定义 $F$ 为 $1$，否则定义为一个大的哨兵值（例如，一个封顶值）。\n\n程序要求和待实现的数值细节。\n\n- 在均匀网格 $\\omega_0,\\dots,\\omega_{M-1}$ 上构建 $H(\\omega)$，网格间距均匀，单位为兆电子伏除以约化普朗克常数，记为 $\\mathrm{MeV}/\\hbar$。对 $\\Delta$ 使用实对称三对角耦合，其最近邻矩阵元为 $\\{\\delta_i\\}$（单位为 MeV）：\n$$\n\\Delta_{i,i+1}=\\Delta_{i+1,i}=\\delta_i,\\quad \\Delta_{ij}=0\\ \\text{otherwise}.\n$$\n\n- 对于每个 $\\omega$：\n  - 求解 $H(\\omega)$ 以获得有序的本征对。\n  - 计算两种策略下的 $J(\\omega)$。\n- 使用中心差分计算 $J^{(2)}(\\omega)$：\n$$\nJ^{(2)}(\\omega_i) = \\frac{J(\\omega_{i+1})-J(\\omega_{i-1})}{\\omega_{i+1}-\\omega_{i-1}},\n$$\n其中内部索引 $i \\in \\{1,\\dots,M-2\\}$。\n\n- 对每种策略，计算 $\\mathcal{R}$ 为 $J^{(2)}(\\omega_i)$ 在内部点 $\\{1,\\dots,M-3\\}$ 上的一阶差分绝对值之和。\n\n- 返回指定测试套件的 $F$ 值列表，每个值四舍五入到六位小数（无量纲）。\n\n使用以下测试套件。对于所有情况，能量单位为兆电子伏，排列转动惯量单位为约化普朗克常数，频率单位为兆电子伏除以约化普朗克常数。动态转动惯量的单位是约化普朗克常数的平方每兆电子伏。所有情况下都占据 $K=2$ 个准粒子。\n\n- 情况 1 (强混合，光滑的绝热参考):\n  - $N=4$, $\\varepsilon=[0.9,\\,1.7,\\,2.1,\\,2.8]$, $j=[6.0,\\,10.0,\\,13.0,\\,16.0]$, $\\delta=[0.35,\\,0.35,\\,0.35]$, $\\omega \\in [0.05,\\,0.35]$, $M=601$.\n\n- 情况 2 (弱混合，尖锐的避免交叉):\n  - $N=4$, $\\varepsilon=[0.9,\\,1.7,\\,2.1,\\,2.8]$, $j=[6.0,\\,10.0,\\,13.0,\\,16.0]$, $\\delta=[0.001,\\,0.001,\\,0.001]$, $\\omega \\in [0.05,\\,0.35]$, $M=601$.\n\n- 情况 3 (混合耦合：一个强，两个弱):\n  - $N=4$, $\\varepsilon=[0.9,\\,1.7,\\,2.1,\\,2.8]$, $j=[6.0,\\,10.0,\\,13.0,\\,16.0]$, $\\delta=[0.02,\\,0.40,\\,0.02]$, $\\omega \\in [0.05,\\,0.35]$, $M=601$.\n\n- 情况 4 (交叉点靠近窗口边界):\n  - $N=4$, $\\varepsilon=[0.95,\\,1.10,\\,2.1,\\,2.8]$, $j=[6.0,\\,10.0,\\,13.0,\\,16.0]$, $\\delta=[0.002,\\,0.35,\\,0.35]$, $\\omega \\in [0.03,\\,0.22]$, $M=381$.\n\n- 情况 5 (一对轨道的斜率平行，无真实交叉):\n  - $N=4$, $\\varepsilon=[0.9,\\,1.7,\\,2.1,\\,2.8]$, $j=[10.0,\\,10.0,\\,13.0,\\,16.0]$, $\\delta=[0.20,\\,0.20,\\,0.20]$, $\\omega \\in [0.05,\\,0.35]$, $M=601$.\n\n你的程序应生成单行输出，其中包含五个改进因子，格式为方括号内的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是一个四舍五入到六位小数的浮点数。由于是比值 $\\mathcal{R}_{\\mathrm{adiabatic}}/\\mathcal{R}_{\\mathrm{diabatic}}$，输出是无量纲的。", "solution": "曲柄平均场框架通过在平均场哈密顿量中增加一个与转动频率 $\\omega$ 和排列角动量算符 $J_x$ 成正比的科里奥利项来描述转动的原子核。得到的单准粒子哈密顿量 (Routhian) 是 $H(\\omega)=E_0-\\omega J_x+\\Delta$，其中 $E_0$ 是非曲柄能量矩阵，$J_x$ 包含排列角动量期望值，$\\Delta$ 则编码了剩余耦合。在一个使 $E_0$ 和 $J_x$ 对角化的固定基中，混合完全由 $\\Delta$ 驱动。\n\n对于每个 $\\omega$，本征问题 $H(\\omega)|\\psi_k(\\omega)\\rangle = E_k(\\omega)|\\psi_k(\\omega)\\rangle$ 产生本征值 $E_k(\\omega)$ 和归一化的本征向量 $|\\psi_k(\\omega)\\rangle$。Hellmann–Feynman 定理在本征值的导数与哈密顿量导数的期望值之间建立了直接联系，即\n$\n\\frac{\\partial E_k(\\omega)}{\\partial \\omega} = \\left\\langle \\psi_k(\\omega)\\left|\\frac{\\partial H(\\omega)}{\\partial \\omega}\\right|\\psi_k(\\omega)\\right\\rangle = -\\langle \\psi_k(\\omega)|J_x|\\psi_k(\\omega)\\rangle.\n$\n因此，本征态 $k$ 的排列角动量是 $J_k(\\omega) = \\langle \\psi_k(\\omega)|J_x|\\psi_k(\\omega)\\rangle$。对于一个有 $K$ 个已占据准粒子的组态，总排列角动量为 $J(\\omega)=\\sum_{k\\in\\mathcal{O}(\\omega)}J_k(\\omega)$。\n\n动态转动惯量是诊断回弯现象的核心，定义为 $J^{(2)}(\\omega)=dJ/d\\omega$。在数值上，我们在均匀网格 $\\{\\omega_i\\}$ 上通过对称三点格式 $J^{(2)}(\\omega_i) = \\left[J(\\omega_{i+1})-J(\\omega_{i-1})\\right]/\\left(\\omega_{i+1}-\\omega_{i-1}\\right)$ 对内部索引进行近似。如果 $J(\\omega)$ 是连续且可微的，这种方法能提供二阶精确的估计并保持光滑性。\n\n回弯现象与能带交叉有关，通常涉及内禀组态的改变。在纯粹的绝热选择方案中，在每个频率 $\\omega$ 处，人们占据能量最低的 $K$ 个 Routhian（本征态）。在避免交叉附近，当 $\\omega$ 穿过交叉区域时，这 $K$ 个最低本征态的“身份”会迅速交换。这可能导致 $J(\\omega)$ 出现非光滑行为，从而在 $J^{(2)}(\\omega)$ 中引起尖峰或大的变化。相比之下，非绝热追踪旨在通过追踪准粒子穿过避免交叉来保持已占据准粒子的身份在 $\\omega$ 变化时不变，并以波函数的连续性为指导原则。一种稳健的计算实现方式是最大化被追踪的本征向量 $|\\psi_a(\\omega_i)\\rangle$ 与下一个频率处的本征向量 $|\\psi_b(\\omega_{i+1})\\rangle$ 之间的总交叠。具体来说，定义交叠矩阵，其矩阵元为 $O_{ab}=\\left|\\langle \\psi_a(\\omega_i)\\mid \\psi_b(\\omega_{i+1})\\rangle\\right|^2$。然后找到一个能最大化 $\\sum_{a=1}^K O_{ab_a}$ 的 $K$ 个下一步本征向量的一一对应分配。这种构造基于波函数身份强制实现非绝热连续性，并且是曲柄 Hartree–Fock–Bogoliubov 计算中的标准做法。\n\n为量化光滑性，我们采用离散的 $J^{(2)}(\\omega_i)$ 序列在内部点上的总变差：$\\mathcal{R}=\\sum_i |J^{(2)}(\\omega_{i+1})-J^{(2)}(\\omega_i)|$。这个度量突出了快速振荡和尖峰；较小的 $\\mathcal{R}$ 表示更光滑的 $J^{(2)}(\\omega)$。改进因子 $F=\\mathcal{R}_{\\mathrm{adiabatic}}/\\mathcal{R}_{\\mathrm{diabatic}}$ 比较了绝热追踪和非绝热追踪；通常在尖锐交叉附近 $F1$，因为非绝热追踪消除了引发非光滑导数的组态转换。\n\n算法设计直接遵循这些原则。\n\n1. 构建模型。\n- 固定 $N$ 个基态，用 $\\varepsilon_i$ 和 $j_i$ 定义 $E_0=\\mathrm{diag}(\\varepsilon_i)$ 和 $J_x=\\mathrm{diag}(j_i)$。\n- 将 $\\Delta$ 构建为具有最近邻耦合 $\\delta_i$ 的实对称三对角矩阵。\n\n2. 频率网格和本征问题。\n- 为 $i\\in\\{0,\\dots,M-1\\}$ 定义一个均匀网格 $\\omega_i=\\omega_{\\min}+i\\Delta \\omega$。\n- 对于每个 $\\omega_i$：\n  - 组装 $H(\\omega_i)=E_0-\\omega_i J_x+\\Delta$。\n  - 对角化 $H(\\omega_i)$ 以获得有序的本征对 $\\{E_k(\\omega_i),|\\psi_k(\\omega_i)\\rangle\\}$。\n  - 通过与 $J_x$ 的二次型计算 $J_k(\\omega_i)=\\langle \\psi_k(\\omega_i)|J_x|\\psi_k(\\omega_i)\\rangle$，在此基中简化为 $J_k(\\omega_i)=\\sum_{\\ell} j_\\ell \\left| \\langle \\ell|\\psi_k(\\omega_i)\\rangle \\right|^2$。\n\n3. 绝热选择。\n- 在每个 $\\omega_i$ 处，按能量占据 $K$ 个最低的本征态，并将 $J_{\\mathrm{adi}}(\\omega_i)$ 设置为其 $J_k(\\omega_i)$ 的总和。\n\n4. 非绝热追踪。\n- 通过在 $\\omega_0$ 处占据 $K$ 个最低本征态来初始化，并存储它们的本征向量。\n- 对于每个后续的 $\\omega_{i+1}$：\n  - 对于 $a\\in\\{1,\\dots,K\\}$ 和 $b\\in\\{1,\\dots,N\\}$，构建交叠矩阵 $O_{ab}=\\left|\\langle \\psi_a(\\omega_i) \\mid \\psi_b(\\omega_{i+1})\\rangle\\right|^2$。\n  - 解决最大化总交叠（等效于最小化负交叠）的一一分配问题；选择在 $\\omega_{i+1}$ 处的 $K$ 个已分配的本征向量以继续非绝热追踪。\n  - 将 $J_{\\mathrm{dia}}(\\omega_{i+1})$ 计算为所选轨道上 $J_k(\\omega_{i+1})$ 的总和。\n\n5. 数值微分和粗糙度。\n- 使用中心差分计算内部索引的 $J^{(2)}_{\\mathrm{adi}}(\\omega_i)$ 和 $J^{(2)}_{\\mathrm{dia}}(\\omega_i)$。\n- 将 $\\mathcal{R}_{\\mathrm{adi}}$ 和 $\\mathcal{R}_{\\mathrm{dia}}$ 计算为 $J^{(2)}$ 在内部序列上的一阶差分绝对值之和。\n- 构建 $F=\\mathcal{R}_{\\mathrm{adi}}/\\mathcal{R}_{\\mathrm{dia}}$，并设置容差保护以防止除以低于小阈限的值。\n\n该测试套件涵盖了几个不同情况。强混合使绝热组态平滑，导致 $F$ 接近 $1$。弱混合产生尖锐的避免交叉，其中绝热选择在 $J(\\omega)$ 中引入不连续性并在 $J^{(2)}(\\omega)$ 中产生尖峰，因此 $F1$。混合耦合提供中间效应。边界附近的交叉点检查了有限差分格式在有限内部点下的稳健性。一对轨道的平行斜率消除了该对轨道的真实交叉，因此非绝热和绝热结果接近，使得 $F$ 接近 $1$。\n\n最终程序将这些元素组合在一起，在指定的网格上解决本征问题，执行绝热和非绝热追踪，计算 $J^{(2)}(\\omega)$ 和粗糙度，并以 $[x_1,x_2,x_3,x_4,x_5]$ 的格式打印一行包含五个改进因子的结果，每个因子四舍五入到六位小数。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linear_sum_assignment\n\ndef build_hamiltonian(omega, eps, jx_diag, deltas):\n    n = len(eps)\n    H = np.diag(eps - omega * jx_diag)\n    for i in range(n - 1):\n        d = deltas[i]\n        if d != 0.0:\n            H[i, i + 1] = d\n            H[i + 1, i] = d\n    return H\n\ndef sorted_eigensystem(H):\n    w, v = np.linalg.eigh(H)\n    idx = np.argsort(w)\n    return w[idx], v[:, idx]\n\ndef j_expectations(vectors, jx_diag):\n    # H is real symmetric, so eigenvectors are real\n    return np.sum(vectors**2 * jx_diag[:, np.newaxis], axis=0)\n\ndef calculate_roughness(J_total, dw):\n    if len(J_total)  3:\n        return 0.0\n    J2 = (J_total[2:] - J_total[:-2]) / (2 * dw)\n    if len(J2)  2:\n        return 0.0\n    roughness = np.sum(np.abs(np.diff(J2)))\n    return roughness\n\ndef solve_case(params):\n    N = params['N']\n    eps = np.array(params['eps'])\n    j = np.array(params['j'])\n    delta = np.array(params['delta'])\n    omega_range = params['omega']\n    M = params['M']\n    K = 2  # Number of occupied states\n\n    omega_grid = np.linspace(omega_range[0], omega_range[1], M)\n    dw = omega_grid[1] - omega_grid[0]\n\n    # Store eigensystem history\n    e_vals_hist = np.zeros((M, N))\n    e_vecs_hist = np.zeros((M, N, N))\n    j_k_hist = np.zeros((M, N))\n\n    for i, omega in enumerate(omega_grid):\n        H = build_hamiltonian(omega, eps, j, delta)\n        e_vals, e_vecs = sorted_eigensystem(H)\n        e_vals_hist[i] = e_vals\n        e_vecs_hist[i] = e_vecs\n        j_k_hist[i] = j_expectations(e_vecs, j)\n\n    # Adiabatic Tracking\n    J_total_adi = np.sum(j_k_hist[:, :K], axis=1)\n\n    # Diabatic Tracking\n    J_total_dia = np.zeros(M)\n    tracked_indices = np.arange(K)\n    J_total_dia[0] = np.sum(j_k_hist[0, tracked_indices])\n    \n    for i in range(M - 1):\n        prev_vecs = e_vecs_hist[i][:, tracked_indices]\n        next_vecs = e_vecs_hist[i + 1]\n        \n        overlap_matrix_sq = (prev_vecs.T @ next_vecs)**2\n        cost_matrix = -overlap_matrix_sq\n        \n        row_ind, col_ind = linear_sum_assignment(cost_matrix)\n        \n        tracked_indices = col_ind\n        J_total_dia[i + 1] = np.sum(j_k_hist[i + 1, tracked_indices])\n\n    # Calculate Roughness\n    R_adi = calculate_roughness(J_total_adi, dw)\n    R_dia = calculate_roughness(J_total_dia, dw)\n\n    # Improvement Factor\n    tolerance = 1e-9\n    if R_dia  tolerance:\n        F = 1.0 if R_adi  tolerance else 1e9\n    else:\n        F = R_adi / R_dia\n        \n    return round(F, 6)\n\ndef solve():\n    test_suite = [\n        {'N': 4, 'eps': [0.9, 1.7, 2.1, 2.8], 'j': [6.0, 10.0, 13.0, 16.0], 'delta': [0.35, 0.35, 0.35], 'omega': [0.05, 0.35], 'M': 601},\n        {'N': 4, 'eps': [0.9, 1.7, 2.1, 2.8], 'j': [6.0, 10.0, 13.0, 16.0], 'delta': [0.001, 0.001, 0.001], 'omega': [0.05, 0.35], 'M': 601},\n        {'N': 4, 'eps': [0.9, 1.7, 2.1, 2.8], 'j': [6.0, 10.0, 13.0, 16.0], 'delta': [0.02, 0.40, 0.02], 'omega': [0.05, 0.35], 'M': 601},\n        {'N': 4, 'eps': [0.95, 1.10, 2.1, 2.8], 'j': [6.0, 10.0, 13.0, 16.0], 'delta': [0.002, 0.35, 0.35], 'omega': [0.03, 0.22], 'M': 381},\n        {'N': 4, 'eps': [0.9, 1.7, 2.1, 2.8], 'j': [10.0, 10.0, 13.0, 16.0], 'delta': [0.20, 0.20, 0.20], 'omega': [0.05, 0.35], 'M': 601}\n    ]\n    \n    results = [solve_case(case) for case in test_suite]\n    print(results)\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3543273"}]}