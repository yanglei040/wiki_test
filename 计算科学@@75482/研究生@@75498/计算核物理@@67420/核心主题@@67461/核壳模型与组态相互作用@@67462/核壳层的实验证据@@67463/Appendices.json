{"hands_on_practices": [{"introduction": "原子核壳层闭合会在多种实验可观测量中表现为独特的信号。这项练习将引导您围绕众所周知的质子幻数 $Z=50$ 来识别这些关键特征：分离能的“拐点”、偶偶核第一激发 $2^+$ 态的高能量以及镜像核位移能的反常行为。通过将这些来自不同数据流的证据综合成一个定量的“壳闭合分数”，您将掌握一种从原始核数据中识别和表征壳效应的稳健方法 [@problem_id:3558348]。", "problem": "给定一组人工合成的、自洽的结合能数据，请您利用几条同中子素链上的双质子分离能来分析质子壳层闭合，并将推断出的闭合与偶偶核的第一激发四极态能量以及镜像位移能的系统性规律进行比较。请基于以下基本原理进行分析：核结合能的定义，分离能作为能量差的定义，以及以下事实：壳层闭合在分离能系统性规律中表现为增大的曲率（“扭折”），在偶偶核中表现为较大的第一 $2^{+}$ 激发能，并且由于电荷半径和能级间距的变化，在镜像位移能中表现出反常趋势。\n\n定义：\n- 核结合能 $B(Z,N)$ 是将一个原子核分离为其组分中的 $Z$ 个质子和 $N$ 个中子所需的能量。\n- 双质子分离能为 $S_{2p}(Z,N)=B(Z,N)-B(Z-2,N)$。\n- 序列 $f(z)$ 在 $z=z_{0}$ 处的离散二阶差分为 $\\Delta^{(2)} f(z_{0})=f(z_{0}+2)-2 f(z_{0})+f(z_{0}-2)$，它用于检测局域曲率（“扭折”）。\n\n数据集 A (对于偶数 $Z$ 和固定中子数的结合能；所有 $B$ 的单位均为 $\\mathrm{MeV}$):\n- 对于 $N=78$:\n  - $B(46,78)=973.0$, $B(48,78)=985.9$, $B(50,78)=998.1$, $B(52,78)=1006.0$, $B(54,78)=1013.2$。\n- 对于 $N=80$:\n  - $B(46,80)=989.0$, $B(48,80)=1002.2$, $B(50,80)=1014.7$, $B(52,80)=1022.8$, $B(54,80)=1030.2$。\n- 对于 $N=82$:\n  - $B(46,82)=1005.0$, $B(48,82)=1018.5$, $B(50,82)=1031.3$, $B(52,82)=1039.7$, $B(54,82)=1047.3$。\n- 对于 $N=84$:\n  - $B(46,84)=1021.0$, $B(48,84)=1034.8$, $B(50,84)=1047.8$, $B(52,84)=1056.5$, $B(54,84)=1064.5$。\n\n数据集 B (在 $N=82$ 时的偶偶核第一 $2^{+}$ 激发能，单位均为 $\\mathrm{MeV}$):\n- $E_{2^{+}}(Z=48,N=82)=1.20$, $E_{2^{+}}(Z=50,N=82)=4.10$, $E_{2^{+}}(Z=52,N=82)=1.25$。\n\n数据集 C (在 $Z\\approx 50$ 附近，同位旋 $T=\\frac{1}{2}$ 的同量异位素对的镜像核结合能；所有 $B$ 的单位均为 $\\mathrm{MeV}$):\n- 对于 $A=97$ (核对 $(Z,N)=(49,48)$ 和 $(48,49)$): $B(49,48)=824.0$, $B(48,49)=832.0$。\n- 对于 $A=101$ (核对 $(Z,N)=(51,50)$ 和 $(50,51)$): $B(51,50)=860.5$, $B(50,51)=869.5$。\n- 对于 $A=105$ (核对 $(Z,N)=(53,52)$ 和 $(52,53)$): $B(53,52)=896.0$, $B(52,53)=904.2$。\n\n任务：\n1. 使用数据集 A，计算当 $Z\\in\\{48,50,52\\}$ 和 $N\\in\\{78,80,82,84\\}$ 时的 $S_{2p}(Z,N)$。然后对每个 $N$，计算在 $Z=50$ 处的离散二阶差分，\n   $$\\Delta^{(2)} S_{2p}(Z=50,N)=S_{2p}(52,N)-2\\,S_{2p}(50,N)+S_{2p}(48,N).$$\n   将这四个值对 $N$ 求平均，得到 $C_{S}$。将分离能闭合强度定义为 $Q_{S}=-C_{S}$。\n2. 使用数据集 B，计算在 $Z=50$ 处的第一 $2^{+}$ 激发能的曲率，\n   $$C_{E}=E_{2^{+}}(50,82)-\\frac{E_{2^{+}}(48,82)+E_{2^{+}}(52,82)}{2}.$$\n   将 $E_{2^{+}}$ 闭合强度定义为 $Q_{E}=C_{E}$。\n3. 将固定 $A$ 值的 $T=\\frac{1}{2}$ 镜像核对的镜像位移能 (MDE) 定义为\n   $$\\Delta_{\\mathrm{MDE}}(A)=B(Z+1,Z)-B(Z,Z+1),\\quad A=2Z+1.$$\n   使用数据集 C，计算 $\\Delta_{\\mathrm{MDE}}(97)$、$\\Delta_{\\mathrm{MDE}}(101)$ 和 $\\Delta_{\\mathrm{MDE}}(105)$。然后构建在 $A=101$ 处的反常曲率，\n   $$C_{M}=\\Delta_{\\mathrm{MDE}}(101)-\\frac{\\Delta_{\\mathrm{MDE}}(97)+\\Delta_{\\mathrm{MDE}}(105)}{2}.$$\n   将镜像能闭合强度定义为 $Q_{M}=-C_{M}$。\n4. 复合的、量纲齐次的闭合分数定义为\n   $$Q=Q_{S}+Q_{E}+Q_{M}.$$\n   这个 $Q$ 值将双质子分离能中的扭折、高的 $2^{+}$ 激发能以及镜像位移能反常聚合成一个以 $Z=50$ 为中心的质子壳层闭合的单一量化指标。\n5. 根据 $C_{S}$、$C_{E}$ 和 $C_{M}$ 的符号和大小，确定这些系统性规律所揭示的质子壳层闭合。然后计算并报告 $Q$ 的单一数值。最终能量以 $\\mathrm{MeV}$ 为单位表示，并将您的答案四舍五入到三位有效数字。在最终的方框答案中不要包含单位。", "solution": "该问题要求计算一个复合闭合分数 $Q$，它聚合了质子数 $Z=50$ 处原子核壳层闭合的三个独立实验特征。计算过程是通过分析结合能、第一 $2^+$ 激发能和镜像位移能的人工合成数据来完成的。该分析通过一系列连续的任务来执行。\n\n首先，作为任务5的一部分，我们确定质子壳层闭合。在质子数 $Z_0$ 处发生壳层闭合的一个关键特征是，对于 $Z > Z_0$ 的原子核，其双质子分离能 $S_{2p}$ 会出现急剧下降。二阶差分分析就是为了检测这种“扭折”。在 $Z_0$ 处的一个负二阶差分 $C_S  0$ 表明了这一特征。另一个特征是在幻数 $Z_0$ 处的偶偶核中，第一激发 $2^+$ 态 $E_{2^+}$ 具有反常高能量。这对应一个大的正曲率 $C_E  0$。最后，壳层闭合处的核电荷半径变化会导致原本平滑的镜像位移能 $\\Delta_{\\mathrm{MDE}}$ 趋势出现反常，从而产生非零曲率 $C_M$。计算出的量 $C_S$、$C_E$ 和 $C_M$ 的符号将证实我们所研究的壳层闭合的存在和位置。本问题将所有计算都集中在 $Z=50$ 上，暗中假定闭合就在此处。接下来的计算将验证这一假定。\n\n现在，解题过程将按照指定的计算任务逐步进行。\n\n**任务1：计算分离能闭合强度 $Q_S$**\n\n双质子分离能定义为 $S_{2p}(Z,N)=B(Z,N)-B(Z-2,N)$。我们计算在四个同中子素链（$N=78, 80, 82, 84$）上，$Z\\in\\{48,50,52\\}$ 的这个值。所有能量单位均为 $\\mathrm{MeV}$。\n\n对于 $N=78$:\n$S_{2p}(48,78) = B(48,78) - B(46,78) = 985.9 - 973.0 = 12.9$\n$S_{2p}(50,78) = B(50,78) - B(48,78) = 998.1 - 985.9 = 12.2$\n$S_{2p}(52,78) = B(52,78) - B(50,78) = 1006.0 - 998.1 = 7.9$\n\n对于 $N=80$:\n$S_{2p}(48,80) = B(48,80) - B(46,80) = 1002.2 - 989.0 = 13.2$\n$S_{2p}(50,80) = B(50,80) - B(48,80) = 1014.7 - 1002.2 = 12.5$\n$S_{2p}(52,80) = B(52,80) - B(50,80) = 1022.8 - 1014.7 = 8.1$\n\n对于 $N=82$:\n$S_{2p}(48,82) = B(48,82) - B(46,82) = 1018.5 - 1005.0 = 13.5$\n$S_{2p}(50,82) = B(50,82) - B(48,82) = 1031.3 - 1018.5 = 12.8$\n$S_{2p}(52,82) = B(52,82) - B(50,82) = 1039.7 - 1031.3 = 8.4$\n\n对于 $N=84$:\n$S_{2p}(48,84) = B(48,84) - B(46,84) = 1034.8 - 1021.0 = 13.8$\n$S_{2p}(50,84) = B(50,84) - B(48,84) = 1047.8 - 1034.8 = 13.0$\n$S_{2p}(52,84) = B(52,84) - B(50,84) = 1056.5 - 1047.8 = 8.7$\n\n接下来，我们为每个 $N$ 计算离散二阶差分 $\\Delta^{(2)} S_{2p}(Z=50,N)=S_{2p}(52,N)-2\\,S_{2p}(50,N)+S_{2p}(48,N)$:\n$\\Delta^{(2)} S_{2p}(50,78) = 7.9 - 2(12.2) + 12.9 = 7.9 - 24.4 + 12.9 = -3.6$\n$\\Delta^{(2)} S_{2p}(50,80) = 8.1 - 2(12.5) + 13.2 = 8.1 - 25.0 + 13.2 = -3.7$\n$\\Delta^{(2)} S_{2p}(50,82) = 8.4 - 2(12.8) + 13.5 = 8.4 - 25.6 + 13.5 = -3.7$\n$\\Delta^{(2)} S_{2p}(50,84) = 8.7 - 2(13.0) + 13.8 = 8.7 - 26.0 + 13.8 = -3.5$\n\n平均曲率 $C_S$ 是这些值的平均值：\n$$C_S = \\frac{(-3.6) + (-3.7) + (-3.7) + (-3.5)}{4} = \\frac{-14.5}{4} = -3.625 \\, \\mathrm{MeV}$$\n$C_S$ 的强负值表明在 $Z=50$ 处存在一个显著的扭折，这是壳层闭合的特征。\n分离能闭合强度为 $Q_S = -C_S$:\n$$Q_S = -(-3.625) = 3.625 \\, \\mathrm{MeV}$$\n\n**任务2：计算 $E_{2^{+}}$ 闭合强度 $Q_E$**\n\n对于 $N=82$ 的同中子素，在 $Z=50$ 处的第一 $2^{+}$ 激发能的曲率由 $C_{E}=E_{2^{+}}(50,82)-\\frac{E_{2^{+}}(48,82)+E_{2^{+}}(52,82)}{2}$ 给出。使用数据集 B 中提供的数据：\n$$C_{E} = 4.10 - \\frac{1.20 + 1.25}{2} = 4.10 - \\frac{2.45}{2} = 4.10 - 1.225 = 2.875 \\, \\mathrm{MeV}$$\n$C_E$ 的大的正值反映了在 $Z=50$ 处异常高的 $E_{2^+}$ 能量，这是幻数核的一个经典特征。\n$E_{2^{+}}$ 闭合强度为 $Q_E = C_E$:\n$$Q_E = 2.875 \\, \\mathrm{MeV}$$\n\n**任务3：计算镜像能闭合强度 $Q_M$**\n\n镜像位移能 (MDE) 对于同量异位素质量数 $A=2Z+1$ 由 $\\Delta_{\\mathrm{MDE}}(A)=B(Z+1,Z)-B(Z,Z+1)$ 给出。我们使用数据集 C 为给定的三个同量异位素对计算该值。\n\n对于 $A=97$, $Z=48$:\n$\\Delta_{\\mathrm{MDE}}(97) = B(49,48) - B(48,49) = 824.0 - 832.0 = -8.0 \\, \\mathrm{MeV}$\n\n对于 $A=101$, $Z=50$:\n$\\Delta_{\\mathrm{MDE}}(101) = B(51,50) - B(50,51) = 860.5 - 869.5 = -9.0 \\, \\mathrm{MeV}$\n\n对于 $A=105$, $Z=52$:\n$\\Delta_{\\mathrm{MDE}}(105) = B(53,52) - B(52,53) = 896.0 - 904.2 = -8.2 \\, \\mathrm{MeV}$\n\n在 $A=101$（它跨越了 $Z=50$ 壳层）处的反常曲率为 $C_{M}=\\Delta_{\\mathrm{MDE}}(101)-\\frac{\\Delta_{\\mathrm{MDE}}(97)+\\Delta_{\\mathrm{MDE}}(105)}{2}$:\n$$C_{M} = -9.0 - \\frac{(-8.0) + (-8.2)}{2} = -9.0 - \\frac{-16.2}{2} = -9.0 - (-8.1) = -0.9 \\, \\mathrm{MeV}$$\n$C_M$ 的负值表示在 $Z=50$ 附近的 MDE 趋势中存在反常。\n镜像能闭合强度为 $Q_M = -C_M$:\n$$Q_M = -(-0.9) = 0.9 \\, \\mathrm{MeV}$$\n\n**任务4和5：计算复合闭合分数 $Q$**\n\n三个独立的度量 $Q_S  0$、$Q_E  0$ 和 $Q_M  0$ 都一致地表明在 $Z=50$ 处存在一个强的质子壳层闭合。我们现在将它们组合成复合的、量纲齐次的闭合分数 $Q = Q_{S}+Q_{E}+Q_{M}$:\n$$Q = 3.625 + 2.875 + 0.9 = 7.4 \\, \\mathrm{MeV}$$\n问题要求最终答案四舍五入到三位有效数字。精确值为 $7.4$。为了用三位有效数字表示，我们写作 $7.40$。\n\n最终数值：\n$$Q = 7.40 \\, \\mathrm{MeV}$$", "answer": "$$\\boxed{7.40}$$", "id": "3558348"}, {"introduction": "除了基态性质，粒子转移反应是直接探测核轨道单粒子性质的有力工具，而这正是壳层模型的微观基础。本练习模拟了从 $(d,p)$ 反应数据中提取谱因子的过程，谱因子是量化原子核态单粒子成分的关键物理量。通过这项实践，您将学习如何将理论反应模型（如 DWBA/ADWA）与实验角分布数据相结合，以提取关键的核结构信息，并将其与壳层模型的理论预言进行比较 [@problem_id:3558390]。", "problem": "考虑类型为 $(d,p)$ 的中子增添转移反应，该反应用于探测一个假定存在的壳层间隙周围的单粒子结构。在转移反应分析中广泛使用的一步因子分解法中，测得的在角度 $\\theta$ 处的微分截面被建模为\n$$\n\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}(\\theta) \\approx C^2S \\times \\sigma_{\\text{sp}}(\\theta),\n$$\n其中 $C^2S$ 是所布居的态的谱因子（无量纲），$\\sigma_{\\text{sp}}(\\theta)$ 是在选定的反应框架下计算出的单粒子截面（单位为毫靶/球面度，记作 $\\text{mb/sr}$）。两个标准的框架是畸波玻恩近似 (DWBA) 和绝热畸波近似 (ADWA)。为了分离角动量转移 $l$ 在角分布中的作用，假设以下简化的、依赖于 $l$ 的“玩具”单粒子模型，该模型能捕捉随 $l$ 变化的主要形状特征：\n$$\n\\sigma_{\\text{sp}}^{(\\text{method})}(\\theta; l) = D_{\\text{method}} \\, M_l \\, \\left[P_l\\big(\\cos(\\theta_{\\text{rad}})\\big)\\right]^2,\n$$\n其中 $P_l$ 是 $l$ 阶勒让德多项式，$\\theta_{\\text{rad}}$ 是以弧度为单位的散射角，$M_l$ 是一个依赖于 $l$ 的标度（单位为 $\\text{mb/sr}$），而 $D_{\\text{method}}$ 是一个依赖于方法的重整化因子（无量纲），它包含了全局畸变效应。使用 $D_{\\text{DWBA}}=1.0$ 和 $D_{\\text{ADWA}}=0.85$。假设转移过程布居到一个由已知 $l$ 表征的单一态上，并且测量角分布是在一小组实验室角度下提供的。你需要通过对每种方法分别将模型与测量值进行加权线性最小二乘拟合来提取 $C^2S$，然后将提取的 $C^2S$（来自 ADWA）与壳模型对同一态的 $C^2S$ 预测值进行比较。\n\n使用的基本原理：\n- 线性响应和玻恩近似原理：测量的振幅与单粒子振幅成正比，比例系数由谱因子给出。\n- 加权最小二乘法作为独立高斯误差下的统计有效线性估计器：给定数据 $\\{(\\theta_i, y_i, \\delta y_i)\\}$ 和模型 $y_i \\approx a \\, m_i$（其中 $m_i$ 已知），最佳拟合振幅 $a$ 使 $\\sum_i w_i (y_i - a m_i)^2$ 最小化，其中 $w_i = 1/(\\delta y_i)^2$。\n\n你的任务：\n1) 对于下面列出的每个测试用例，为每种方法（DWBA 和 ADWA）计算在给定角度下的单粒子模型值 $m_i = \\sigma_{\\text{sp}}^{(\\text{method})}(\\theta_i; l)$。角度以度为单位给出，在计算 $P_l(\\cos\\theta)$ 时必须转换为弧度。\n2) 对每种方法分别执行加权线性最小二乘拟合，以确定 $C^2S$（振幅 $a$）：\n   - 输入：测量值 $y_i$（单位 $\\text{mb/sr}$）及其标准不确定度 $\\delta y_i$（单位 $\\text{mb/sr}$）。\n   - 输出：最佳拟合的 $C^2S$（无量纲）和未加权的均方根 (RMS) 残差，\n     $$\n     \\text{RMS} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N \\left(y_i - C^2S \\cdot m_i\\right)^2},\n     $$\n     以 $\\text{mb/sr}$ 表示，其中 $N$ 是测试用例中的角度数量。\n3) 对于每个测试用例，将 ADWA 提取的 $C^2S$ 与提供的壳模型预测值 $\\left(C^2S\\right)_{\\text{SM}}$ 进行比较。报告其相对偏差是否在 $0.15$ 的容差范围内（百分之十五表示为小数），即\n   $$\n   \\frac{\\left|C^2S_{\\text{ADWA}} - \\left(C^2S\\right)_{\\text{SM}}\\right|}{\\left(C^2S\\right)_{\\text{SM}}} \\le 0.15.\n   $$\n   返回一个布尔值用于此比较。\n\n物理和数值单位：\n- 截面必须以 $\\text{mb/sr}$ 为单位处理。\n- 角度以度为单位提供；在计算三角函数时使用弧度。\n- 谱因子 $C^2S$ 是无量纲的。\n\n测试套件：\n使用以下三个测试用例。在所有用例中，角度网格为 $\\theta = [10,20,30,40,50]$ 度，即 $\\theta = [10,20,30,40,50]$（以度为单位），并理解三角函数求值使用弧度。态的角动量 $l$ 和模型标度 $M_l$ 是特定于用例的。不确定度为一个标准差。\n\n- 用例 A (靠近闭合壳层，$l=3$ 的“类 $f$”转移)：\n  - $l = 3$, $M_3 = 60.0$ $\\text{mb/sr}$。\n  - 角度 (度): $[10,20,30,40,50]$。\n  - 测量的 $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}$ (单位 $\\text{mb/sr}$): $[38.0567,\\,20.2910,\\,4.8412,\\,0.02923,\\,4.1371]$。\n  - 不确定度 $\\delta y$ (单位 $\\text{mb/sr}$): $[0.5,\\,0.3,\\,0.1,\\,0.02,\\,0.1]$。\n  - 壳模型预测的 $C^2S$: $0.88$。\n\n- 用例 B (碎片化强度情景，$l=1$ 的“类 $p$”转移)：\n  - $l = 1$, $M_1 = 12.0$ $\\text{mb/sr}$。\n  - 角度 (度): $[10,20,30,40,50]$。\n  - 测量的 $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}$ (单位 $\\text{mb/sr}$): $[3.462,\\,3.153,\\,2.678,\\,2.095,\\,1.475]$。\n  - 不确定度 $\\delta y$ (单位 $\\text{mb/sr}$): $[0.15,\\,0.12,\\,0.10,\\,0.10,\\,0.09]$。\n  - 壳模型预测的 $C^2S$: $0.32$。\n\n- 用例 C (阈值附近的弱 $s$ 波分量，$l=0$ 的“类 $s$”转移)：\n  - $l = 0$, $M_0 = 8.0$ $\\text{mb/sr}$。\n  - 角度 (度): $[10,20,30,40,50]$。\n  - 测量的 $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}$ (单位 $\\text{mb/sr}$): $[1.02,\\,1.02,\\,1.02,\\,1.02,\\,1.02]$。\n  - 不确定度 $\\delta y$ (单位 $\\text{mb/sr}$): $[0.05,\\,0.05,\\,0.05,\\,0.05,\\,0.05]$。\n  - 壳模型预测的 $C^2S$: $0.18$。\n\n所有用例的反应模型设置：\n- 使用 $D_{\\text{DWBA}}=1.0$ 和 $D_{\\text{ADWA}}=0.85$。\n- 模型形状: $\\sigma_{\\text{sp}}^{(\\text{method})}(\\theta; l) = D_{\\text{method}} \\, M_l \\, \\left[P_l\\big(\\cos(\\theta_{\\text{rad}})\\big)\\right]^2$，其中 $\\theta_{\\text{rad}}$ 以弧度为单位。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例（按 A、B、C 的顺序），输出一个包含五个条目的子列表：\n$[C^2S_{\\text{DWBA}},\\,C^2S_{\\text{ADWA}},\\,\\text{RMS}_{\\text{DWBA}},\\,\\text{RMS}_{\\text{ADWA}},\\,\\text{agree}]$，\n其中 $C^2S_{\\text{DWBA}}$ 和 $C^2S_{\\text{ADWA}}$ 是浮点数（无量纲），$\\text{RMS}_{\\text{DWBA}}$ 和 $\\text{RMS}_{\\text{ADWA}}$ 是以 $\\text{mb/sr}$ 为单位的浮点数，$\\text{agree}$ 是一个布尔值，反映 ADWA 提取的 $C^2S$ 是否在规定容差内与壳模型预测值一致。最终输出必须只有一行，例如：\n$[[0.123456,0.234567,0.010000,0.020000,True],[...],[...]]$.", "solution": "该问题是有效的。它在科学上基于核反应理论的原理，特别是直接反应模型，其中测量的截面被分解为结构部分（谱因子 $C^2S$）和反应动力学部分（单粒子截面 $\\sigma_{\\text{sp}}$）。该问题是适定的，提供了所有必要的数据和方程，可以使用标准统计方法唯一地确定所需量。\n\n问题的核心是通过拟合理论模型从实验数据中提取谱因子 $C^2S$。测量的微分截面 $y_i = (\\frac{d\\sigma}{d\\Omega})_{\\text{meas}}(\\theta_i)$ 与模型之间的关系如下：\n$$\ny_i \\approx C^2S \\cdot m_i\n$$\n其中 $m_i = \\sigma_{\\text{sp}}^{(\\text{method})}(\\theta_i; l)$ 表示在角度 $\\theta_i$ 处计算的单粒子截面。这是一个形式为 $y = a \\cdot m$ 的线性模型，待定参数是振幅 $a = C^2S$。\n\n为了找到 $C^2S$ 的最佳拟合值，我们使用加权最小二乘法，这在测量不确定度 $\\delta y_i$ 已知并假设为独立高斯分布时是合适的。任务是最小化关于 $C^2S$ 的卡方函数 $\\chi^2$：\n$$\n\\chi^2 = \\sum_{i=1}^{N} w_i \\left(y_i - C^2S \\cdot m_i\\right)^2\n$$\n其中权重 $w_i$ 是不确定度的平方反比，$w_i = 1/(\\delta y_i)^2$。为了找到最小值，我们将 $\\chi^2$ 对 $C^2S$ 的导数设为零：\n$$\n\\frac{\\partial \\chi^2}{\\partial (C^2S)} = \\sum_{i=1}^{N} -2 w_i m_i \\left(y_i - C^2S \\cdot m_i\\right) = 0\n$$\n求解 $C^2S$ 得到通过原点的加权线性拟合的标准公式：\n$$\nC^2S = \\frac{\\sum_{i=1}^{N} w_i y_i m_i}{\\sum_{i=1}^{N} w_i m_i^2} = \\frac{\\sum_{i=1}^{N} (y_i m_i / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (m_i^2 / (\\delta y_i)^2)}\n$$\n\n单粒子截面建模为：\n$$\nm_i = \\sigma_{\\text{sp}}^{(\\text{method})}(\\theta_i; l) = D_{\\text{method}} \\, M_l \\, \\left[P_l\\big(\\cos(\\theta_{i, \\text{rad}})\\big)\\right]^2\n$$\n我们必须对两种反应框架进行此计算：DWBA ($D_{\\text{DWBA}}=1.0$) 和 ADWA ($D_{\\text{ADWA}}=0.85$)。让我们将不含方法依赖因子的单粒子截面表示为 $m'_i = M_l \\, \\left[P_l\\big(\\cos(\\theta_{i, \\text{rad}})\\big)\\right]^2$。那么，$m_{i, \\text{DWBA}} = D_{\\text{DWBA}} \\cdot m'_i = m'_i$ 且 $m_{i, \\text{ADWA}} = D_{\\text{ADWA}} \\cdot m'_i$。\n\nDWBA 方法的谱因子为：\n$$\nC^2S_{\\text{DWBA}} = \\frac{\\sum_{i=1}^{N} (y_i m'_{i} / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (m'_{i})^2 / (\\delta y_i)^2}\n$$\n对于 ADWA 方法，我们有：\n$$\nC^2S_{\\text{ADWA}} = \\frac{\\sum_{i=1}^{N} (y_i m_{i, \\text{ADWA}} / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (m_{i, \\text{ADWA}})^2 / (\\delta y_i)^2} = \\frac{\\sum_{i=1}^{N} (y_i (D_{\\text{ADWA}} m'_{i}) / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (D_{\\text{ADWA}} m'_{i})^2 / (\\delta y_i)^2}\n$$\n$$\nC^2S_{\\text{ADWA}} = \\frac{D_{\\text{ADWA}} \\sum_{i=1}^{N} (y_i m'_{i} / (\\delta y_i)^2)}{D_{\\text{ADWA}}^2 \\sum_{i=1}^{N} (m'_{i})^2 / (\\delta y_i)^2} = \\frac{1}{D_{\\text{ADWA}}} C^2S_{\\text{DWBA}}\n$$\n这表明用 ADWA 模型提取的谱因子仅仅是 DWBA 结果乘以 ADWA 重整化因子的倒数。\n\n接下来，我们计算未加权的均方根 (RMS) 残差来量化拟合优度：\n$$\n\\text{RMS} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N \\left(y_i - C^2S \\cdot m_i\\right)^2}\n$$\n让我们检查两种方法的拟合截面 $y_{i, \\text{fit}} = C^2S \\cdot m_i$。\n$$\ny_{i, \\text{fit, DWBA}} = C^2S_{\\text{DWBA}} \\cdot m_{i, \\text{DWBA}} = C^2S_{\\text{DWBA}} \\cdot m'_i\n$$\n$$\ny_{i, \\text{fit, ADWA}} = C^2S_{\\text{ADWA}} \\cdot m_{i, \\text{ADWA}} = \\left(\\frac{C^2S_{\\text{DWBA}}}{D_{\\text{ADWA}}}\\right) \\cdot (D_{\\text{ADWA}} m'_i) = C^2S_{\\text{DWBA}} \\cdot m'_i\n$$\n两种方法的拟合截面值是相同的。因此，残差 $(y_i - y_{i, \\text{fit}})$ 也相同，这意味着 $\\text{RMS}_{\\text{DWBA}} = \\text{RMS}_{\\text{ADWA}}$。\n\n最后一步是将提取的 $C^2S_{\\text{ADWA}}$ 与理论壳模型预测值 $(C^2S)_{\\text{SM}}$ 进行比较，检查相对偏差是否在 $15\\%$ 的容差内：\n$$\n\\frac{\\left|C^2S_{\\text{ADWA}} - \\left(C^2S\\right)_{\\text{SM}}\\right|}{\\left(C^2S\\right)_{\\text{SM}}} \\le 0.15\n$$\n\n每个测试用例的求解算法如下：\n1.  将给定的角度从度转换为弧度。\n2.  使用提供的 $l$ 和 $M_l$ 计算模型形状因子 $m'_i = M_l \\, \\left[P_l\\big(\\cos(\\theta_{i, \\text{rad}})\\big)\\right]^2$。勒让德多项式 $P_l(x)$ 使用 `scipy.special.legendre` 进行求值。\n3.  使用加权最小二乘公式和 $m_{i, \\text{DWBA}} = m'_i$ 计算 $C^2S_{\\text{DWBA}}$。\n4.  计算 $C^2S_{\\text{ADWA}} = C^2S_{\\text{DWBA}} / D_{\\text{ADWA}}$，其中 $D_{\\text{ADWA}}=0.85$。\n5.  计算未加权 RMS 残差，两种方法相同：$\\text{RMS} = \\sqrt{\\frac{1}{N}\\sum(y_i - C^2S_{\\text{DWBA}} \\cdot m'_i)^2}$。\n6.  将 $C^2S_{\\text{ADWA}}$ 与 $(C^2S)_{\\text{SM}}$ 比较以确定布尔标志 `agree`。\n7.  收集该用例的五个结果（$C^2S_{\\text{DWBA}}$, $C^2S_{\\text{ADWA}}$, $\\text{RMS}_{\\text{DWBA}}$, $\\text{RMS}_{\\text{ADWA}}$, `agree`）。\n对所有提供的测试用例重复此过程。", "answer": "```python\nimport numpy as np\nfrom scipy.special import legendre\n\ndef solve():\n    \"\"\"\n    Solves the nuclear reaction analysis problem for all test cases.\n    \"\"\"\n    # Reaction model settings\n    D_DWBA = 1.0\n    D_ADWA = 0.85\n    TOLERANCE = 0.15\n\n    # Test suite\n    test_cases = [\n        {\n            \"l\": 3, \"Ml\": 60.0,\n            \"y\": np.array([38.0567, 20.2910, 4.8412, 0.02923, 4.1371]),\n            \"dy\": np.array([0.5, 0.3, 0.1, 0.02, 0.1]),\n            \"C2S_SM\": 0.88,\n            \"angles_deg\": np.array([10, 20, 30, 40, 50])\n        },\n        {\n            \"l\": 1, \"Ml\": 12.0,\n            \"y\": np.array([3.462, 3.153, 2.678, 2.095, 1.475]),\n            \"dy\": np.array([0.15, 0.12, 0.10, 0.10, 0.09]),\n            \"C2S_SM\": 0.32,\n            \"angles_deg\": np.array([10, 20, 30, 40, 50])\n        },\n        {\n            \"l\": 0, \"Ml\": 8.0,\n            \"y\": np.array([1.02, 1.02, 1.02, 1.02, 1.02]),\n            \"dy\": np.array([0.05, 0.05, 0.05, 0.05, 0.05]),\n            \"C2S_SM\": 0.18,\n            \"angles_deg\": np.array([10, 20, 30, 40, 50])\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        l, Ml = case[\"l\"], case[\"Ml\"]\n        y, dy = case[\"y\"], case[\"dy\"]\n        C2S_SM = case[\"C2S_SM\"]\n        angles_deg = case[\"angles_deg\"]\n        \n        # 1) Compute single-particle model values\n        angles_rad = np.deg2rad(angles_deg)\n        cos_theta = np.cos(angles_rad)\n        \n        # Get Legendre polynomial object from SciPy\n        Pl = legendre(l)\n        Pl_cos_theta = Pl(cos_theta)\n        \n        # This is the model shape part, m'_i in the explanation.\n        # It corresponds to the DWBA model with D_DWBA = 1.0.\n        m_dwba = Ml * (Pl_cos_theta**2)\n        \n        # 2) Perform weighted linear least-squares fit for DWBA\n        # C2S = sum(y*m/dy^2) / sum(m^2/dy^2)\n        weights = 1.0 / dy**2\n        numerator_dwba = np.sum(weights * y * m_dwba)\n        denominator_dwba = np.sum(weights * m_dwba**2)\n        \n        if denominator_dwba == 0:\n            c2s_dwba = 0.0\n        else:\n            c2s_dwba = numerator_dwba / denominator_dwba\n\n        # As derived, C2S_ADWA = C2S_DWBA / D_ADWA\n        c2s_adwa = c2s_dwba / D_ADWA\n\n        # Calculate unweighted RMS residual\n        # As derived, the fitted values and thus the RMS are identical for both methods.\n        y_fit = c2s_dwba * m_dwba\n        residuals = y - y_fit\n        rms = np.sqrt(np.mean(residuals**2))\n        rms_dwba = rms\n        rms_adwa = rms\n\n        # 3) Compare ADWA-extracted C2S to shell-model prediction\n        relative_deviation = np.abs(c2s_adwa - C2S_SM) / C2S_SM\n        agree = relative_deviation = TOLERANCE\n\n        all_results.append([c2s_dwba, c2s_adwa, rms_dwba, rms_adwa, agree])\n\n    # Format the final output string\n    results_str = \",\".join([str(res) for res in all_results])\n    print(f\"[{results_str}]\")\n\nsolve()\n```", "id": "3558390"}, {"introduction": "发现新的幻数是核物理学的前沿领域，这需要对实验证据进行严格的统计评估。这项练习引入了一个强大的贝叶斯模型比较框架，用于量化支持某个壳层隙存在的证据强度。您将不再仅仅是定性地识别现象，而是学习使用贝叶斯因子，根据来自多个可观测量的组合数据，来正式权衡相互竞争的科学假设，例如在 $N=32$ 处是否存在壳层隙 [@problem_id:3558398]。", "problem": "你的任务是形式化并计算实验证据的综合强度，以证明中子数 $N=32$ 处存在核壳层间隙。为此，你需要使用贝叶斯因子比较两个统计模型，并利用双中子分离能 ($S_{2n}$)、第一 $2^+$ 激发能 ($E(2^+)$) 以及约化电四极跃迁几率 ($B(E2)$) 的数据。你的答案必须是一个完整且可运行的程序，该程序能够为提供的测试套件计算指定的输出。\n\n此任务的基础是贝叶斯定理、测量误差的高斯似然以及贝叶斯模型证据的定义。设 $M_0$ 表示在 $N=32$ 处没有特殊特征的零模型，而 $M_1$ 表示备择模型，该模型包含一个显式参数，用于为每个可观测量模拟在 $N=32$ 处的局部效应。你将假设，在给定模型的条件下，所有数据点都是独立的，并围绕一个线性预测变量呈高斯分布，且标准差已知。\n\n对于每个可观测量 $o \\in \\{S_{2n}, E(2^+), B(E2)\\}$，以及每个数据点 $i$（其中子数为 $N_i$，测量值为 $y_{o,i}$，报告的标准差为 $\\sigma_{o,i}$（假设已知且为高斯分布）），定义模型如下：\n- 在 $M_0$（无 $N=32$ 壳层间隙项）下，预测变量为\n$$\n\\mu_{o,i}^{(0)} = \\beta_{o,0} + \\beta_{o,1} N_i,\n$$\n参数为 $\\beta_{o,0}$ 和 $\\beta_{o,1}$。\n- 在 $M_1$（有 $N=32$ 壳层间隙项）下，预测变量为\n$$\n\\mu_{o,i}^{(1)} = \\beta_{o,0} + \\beta_{o,1} N_i + \\gamma_o \\, d(N_i),\n$$\n其中，如果 $N_i=32$，则 $d(N_i)=1$，否则 $d(N_i)=0$。$\\gamma_o$ 捕获了在 $N=32$ 处的局部偏差。\n\n假设所有回归参数都具有独立的、均值为零的高斯先验，且每个可观测量 $o$ 中各参数的先验方差为 $s_o^2$。也就是说，在 $M_0$ 下，$(\\beta_{o,0}, \\beta_{o,1}) \\sim \\mathcal{N}(0, s_o^2 I)$；在 $M_1$ 下，$(\\beta_{o,0}, \\beta_{o,1}, \\gamma_o) \\sim \\mathcal{N}(0, s_o^2 I)$。对于每个可观测量 $o$，参数尺度 $s_o$ 将在下文的测试用例中指定。可观测量 $o$ 中数据点 $i$ 的高斯似然为\n$$\ny_{o,i} \\sim \\mathcal{N}\\!\\left( \\mu_{o,i}^{(m)}, \\, \\sigma_{o,i}^2 \\right),\n$$\n其中 $m \\in \\{0,1\\}$ 表示模型。\n\n对于每个可观测量，贝叶斯模型证据是通过对先验进行似然积分得到的边缘似然。由于先验和似然都是高斯分布，每个可观测量的证据是一个闭式高斯积分。假设在给定模型的情况下，三个可观测量之间是独立的，因此组合证据是同一模型下三个可观测量证据的乘积。比较模型的贝叶斯因子 $K$ 定义为\n$$\nK \\equiv \\frac{Z_1}{Z_0},\n$$\n其中 $Z_1$ 和 $Z_0$ 分别是 $M_1$ 和 $M_0$ 的组合证据。报告贝叶斯因子的以 10 为底的对数 $\\log_{10} K$，该值是无量纲的。\n\n建模说明：\n- 将 $N$ 完全按照提供的方式视为数值预测变量。\n- 将 $d(N)$ 完全视为指示函数，当 $N=32$ 时等于 $1$，否则等于 $0$。\n- 对于每个可观测量，在 $M_0$ 下，设计矩阵有 2 列，对应于截距和 $N$。在 $M_1$ 下，设计矩阵有 3 列，对应于截距、$N$ 和 $d(N)$。\n- 先验方差 $s_o^2$ 相同且独立地应用于可观测量 $o$ 内的每个参数。\n- 直接使用提供的数值和不确定性；不要进行任何单位转换。结果 $\\log_{10} K$ 是无量纲的。为确保真实性，输入的物理单位已指定，并且在模型规范中必须遵守，但不需要进行单位转换。\n\n测试套件：\n为以下三个测试用例中的每一个计算 $\\log_{10} K$，每个用例包含三个可观测量及其数据。所有中子数 $N$ 均为无单位计数。所有角度均不适用。每个可观测量的单位已指定。对于所有列出的数字，请完全按原样使用。\n\n- 测试用例 A（代表在 $N=32$ 处存在显著壳层间隙）：\n    - 双中子分离能 ($S_{2n}$)，单位 $\\mathrm{MeV}$：\n        - $N = [30, 32, 34]$\n        - $y = [20.0, 16.8, 17.6]$\n        - $\\sigma = [0.2, 0.2, 0.2]$\n        - 先验尺度 $s_{S_{2n}} = 10.0$\n    - 第一 $2^+$ 激发能 ($E(2^+)$)，单位 $\\mathrm{MeV}$：\n        - $N = [30, 32, 34]$\n        - $y = [1.0, 2.3, 1.2]$\n        - $\\sigma = [0.05, 0.05, 0.05]$\n        - 先验尺度 $s_{E(2^+)} = 3.0$\n    - 约化电四极跃迁几率 ($B(E2)$)，单位 $e^2 b^2$：\n        - $N = [30, 32, 34]$\n        - $y = [0.20, 0.06, 0.16]$\n        - $\\sigma = [0.01, 0.01, 0.01]$\n        - 先验尺度 $s_{B(E2)} = 0.5$\n\n- 测试用例 B（代表无壳层间隙，趋势平滑）：\n    - 双中子分离能 ($S_{2n}$)，单位 $\\mathrm{MeV}$：\n        - $N = [30, 32, 34]$\n        - $y = [20.0, 18.8, 17.6]$\n        - $\\sigma = [0.2, 0.2, 0.2]$\n        - 先验尺度 $s_{S_{2n}} = 10.0$\n    - 第一 $2^+$ 激发能 ($E(2^+)$)，单位 $\\mathrm{MeV}$：\n        - $N = [30, 32, 34]$\n        - $y = [1.0, 1.1, 1.2]$\n        - $\\sigma = [0.05, 0.05, 0.05]$\n        - 先验尺度 $s_{E(2^+)} = 3.0$\n    - 约化电四极跃迁几率 ($B(E2)$)，单位 $e^2 b^2$：\n        - $N = [30, 32, 34]$\n        - $y = [0.20, 0.18, 0.16]$\n        - $\\sigma = [0.01, 0.01, 0.01]$\n        - 先验尺度 $s_{B(E2)} = 0.5$\n\n- 测试用例 C（测量数据稀疏且不确定性较大）：\n    - 双中子分离能 ($S_{2n}$)，单位 $\\mathrm{MeV}$：\n        - $N = [30, 32]$\n        - $y = [20.0, 18.8]$\n        - $\\sigma = [0.5, 0.5]$\n        - 先验尺度 $s_{S_{2n}} = 10.0$\n    - 第一 $2^+$ 激发能 ($E(2^+)$)，单位 $\\mathrm{MeV}$：\n        - $N = [30, 32]$\n        - $y = [1.0, 1.1]$\n        - $\\sigma = [0.2, 0.2]$\n        - 先验尺度 $s_{E(2^+)} = 3.0$\n    - 约化电四极跃迁几率 ($B(E2)$)，单位 $e^2 b^2$：\n        - $N = [30, 32]$\n        - $y = [0.20, 0.18]$\n        - $\\sigma = [0.05, 0.05]$\n        - 先验尺度 $s_{B(E2)} = 0.5$\n\n你的程序必须：\n- 实现上述具有先验和似然的线性高斯模型 $M_0$ 和 $M_1$。\n- 对于每个测试用例中的每个可观测量，通过对高斯先验进行解析积分来计算贝叶斯模型证据。\n- 通过乘法合并三个可观测量的证据，以获得该用例的 $Z_0$ 和 $Z_1$。\n- 计算贝叶斯因子 $K = Z_1/Z_0$ 并报告 $\\log_{10} K$。\n- 输出一行，包含一个由三个浮点数组成的列表，分别对应测试用例 A、测试用例 B 和测试用例 C 的 $\\log_{10} K$ 值，保留三位小数，格式为 $[x_1,x_2,x_3]$。\n\n测试套件中的所有数值输入必须完全按提供的方式使用。所有物理输入都以正确的物理单位指定：$S_{2n}$ 单位为 $\\mathrm{MeV}$，$E(2^+)$ 单位为 $\\mathrm{MeV}$，以及 $B(E2)$ 单位为 $e^2 b^2$。最终报告的值 $\\log_{10} K$ 是无量纲的。角度单位不适用于此问题。程序必须生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，例如 $[x_1,x_2,x_3]$。", "solution": "用户要求形式化并计算贝叶斯因子，以比较两个关于中子数 $N=32$ 处可能存在的核壳层间隙的统计模型。解决方案需要为每个模型计算贝叶斯模型证据，然后计算它们的比率。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n*   **模型**：\n    *   零模型 ($M_0$)：线性预测变量 $\\mu_{o,i}^{(0)} = \\beta_{o,0} + \\beta_{o,1} N_i$。\n    *   备择模型 ($M_1$)：线性预测变量 $\\mu_{o,i}^{(1)} = \\beta_{o,0} + \\beta_{o,1} N_i + \\gamma_o \\, d(N_i)$，其中如果 $N_i=32$ 则 $d(N_i) = 1$，否则为 $0$。\n*   **似然**：对于每个可观测量 $o$ 和数据点 $i$，测量值 $y_{o,i}$ 假定围绕模型的预测值 $\\mu_{o,i}^{(m)}$ 呈高斯分布，其标准差已知为 $\\sigma_{o,i}$：$y_{o,i} \\sim \\mathcal{N}(\\mu_{o,i}^{(m)}, \\sigma_{o,i}^2)$。数据点是独立的。\n*   **先验**：\n    *   对于 $M_0$，参数 $(\\beta_{o,0}, \\beta_{o,1})$ 服从独立的、均值为零、方差为 $s_o^2$ 的高斯先验：$(\\beta_{o,0}, \\beta_{o,1}) \\sim \\mathcal{N}(\\mathbf{0}, s_o^2 I_2)$。\n    *   对于 $M_1$，参数 $(\\beta_{o,0}, \\beta_{o,1}, \\gamma_o)$ 服从独立的、均值为零、方差为 $s_o^2$ 的高斯先验：$(\\beta_{o,0}, \\beta_{o,1}, \\gamma_o) \\sim \\mathcal{N}(\\mathbf{0}, s_o^2 I_3)$。\n*   **贝叶斯因子**：$K = Z_1 / Z_0$，其中 $Z_m$ 是模型 $M_m$ 的组合证据。\n*   **组合证据**：一个模型的总证据是三个可观测量各自证据的乘积，这是基于独立性假设：$Z_m = \\prod_{o} Z_{o,m}$。\n*   **输出**：贝叶斯因子的以 10 为底的对数，$\\log_{10} K$。\n*   **数据**：提供了三个测试用例（A、B、C），每个用例包含三个可观测量的数据（$N$, $y$, $\\sigma$）和一个先验尺度参数 $s_o$：$S_{2n}$, $E(2^+)$ 和 $B(E2)$。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题使用标准的核物理可观测量（$S_{2n}$、$E(2^+)$、$B(E2)$）来检验关于核壳结构的假设，这是该领域的核心课题。其统计框架（使用线性模型、高斯先验和高斯似然的贝叶斯模型比较）是定量数据分析中严谨且标准的方法。该问题在科学上是合理的。\n*   **适定性**：该问题被表述为一个贝叶斯线性回归问题。对于具有高斯先验和高斯似然的此类模型，其边缘似然（模型证据）具有明确的解析解。所有必要的输入（数据、不确定性、先验参数）均已提供。该问题具有唯一、稳定且有意义的解。\n*   **客观性**：问题陈述精确、量化，没有含糊或主观的语言。任务是基于所提供的公式和数据进行直接计算。\n\n**第 3 步：结论与行动**\n\n该问题是有效的。它具有科学依据，适定，客观，并包含了获得唯一解所需的所有信息。我将继续进行详细的解决方案。\n\n### 基于原理的解决方案\n\n问题的核心是为两个竞争模型 $M_0$ 和 $M_1$ 计算每个可观测量的贝叶斯模型证据，也称为边缘似然。证据表示给定模型下观测数据的概率，$Z = p(\\mathbf{y}|M)$，通过对所有可能的模型参数值按其先验概率加权积分得到。\n\n对于一个给定的可观测量 $o$，我们可以用向量-矩阵形式来表示贝叶斯模型。设 $\\mathbf{y}$ 为观测数据点的 $n \\times 1$ 向量，$X$ 为 $n \\times p$ 的设计矩阵，$\\mathbf{\\beta}$ 为模型参数的 $p \\times 1$ 向量。\n似然为 $p(\\mathbf{y}|\\mathbf{\\beta}, M) = \\mathcal{N}(\\mathbf{y} | X\\mathbf{\\beta}, \\Sigma_y)$，其中 $\\Sigma_y$ 是测量误差的 $n \\times n$ 对角协方差矩阵，其对角元素为 $\\left(\\Sigma_y\\right)_{ii} = \\sigma_i^2$。\n参数的先验为 $p(\\mathbf{\\beta}|M) = \\mathcal{N}(\\mathbf{\\beta} | \\mathbf{\\beta}_0, \\Sigma_\\beta)$。在这个问题中，先验均值为 $\\mathbf{\\beta}_0 = \\mathbf{0}$，先验协方差为 $\\Sigma_\\beta = s_o^2 I_p$，其中 $p$ 是参数数量（$M_0$ 为 2，$M_1$ 为 3），$I_p$ 是 $p \\times p$ 的单位矩阵。\n\n模型证据 $Z$ 是积分：\n$$\nZ = \\int p(\\mathbf{y}|\\mathbf{\\beta}, M) p(\\mathbf{\\beta}|M) d\\mathbf{\\beta}\n$$\n这是一个标准的高斯积分。结果是数据向量 $\\mathbf{y}$ 本身服从一个多变量正态分布，其均值为 $E[\\mathbf{y}] = X\\mathbf{\\beta}_0$，协方差矩阵为 $\\text{Cov}(\\mathbf{y}) = \\Sigma_y + X\\Sigma_\\beta X^T$。\n鉴于我们的先验均值为 $\\mathbf{\\beta}_0 = \\mathbf{0}$，$\\mathbf{y}$ 的预测分布为：\n$$\np(\\mathbf{y}|M) = \\mathcal{N}(\\mathbf{y} | \\mathbf{0}, C)\n$$\n其中 $C = \\Sigma_y + s_o^2 X X^T$。证据 $Z$ 是在观测数据 $\\mathbf{y}$ 处评估此概率密度函数的值：\n$$\nZ = (2\\pi)^{-n/2} |C|^{-1/2} \\exp\\left(-\\frac{1}{2} \\mathbf{y}^T C^{-1} \\mathbf{y}\\right)\n$$\n为了避免数值下溢并简化计算，我们计算证据的自然对数：\n$$\n\\ln Z = -\\frac{n}{2}\\ln(2\\pi) - \\frac{1}{2}\\ln|C| - \\frac{1}{2}\\mathbf{y}^T C^{-1} \\mathbf{y}\n$$\n此计算需要对每个可观测量在模型 $M_0$ 和 $M_1$ 下分别执行。\n\n**对于模型 $M_0$**：参数向量为 $\\mathbf{\\beta} = (\\beta_0, \\beta_1)^T$。$n \\times 2$ 的设计矩阵 $X_0$ 由一列全为 1（对应截距 $\\beta_0$）和一列中子数 $N_i$（对应斜率 $\\beta_1$）构成。\n$$\nX_0 = \\begin{pmatrix} 1  N_1 \\\\ 1  N_2 \\\\ \\vdots  \\vdots \\\\ 1  N_n \\end{pmatrix}\n$$\n\n**对于模型 $M_1$**：参数向量为 $\\mathbf{\\beta} = (\\beta_0, \\beta_1, \\gamma)^T$。$n \\times 3$ 的设计矩阵 $X_1$ 增加了第三列 $d(N_i)$，这是一个当 $N_i=32$ 时为 1 的指示变量。\n$$\nX_1 = \\begin{pmatrix} 1  N_1  d(N_1) \\\\ 1  N_2  d(N_2) \\\\ \\vdots  \\vdots  \\vdots \\\\ 1  N_n  d(N_n) \\end{pmatrix}\n$$\n\n一个模型（$Z_0$ 或 $Z_1$）的总证据是三个可观测量（$S_{2n}$、$E(2^+)$、$B(E2)$）证据的乘积，这是基于它们的独立性假设。在对数空间中，这对应于求和：\n$$\n\\ln Z_m^{\\text{total}} = \\ln Z_{S_{2n},m} + \\ln Z_{E(2^+),m} + \\ln Z_{B(E2),m}\n$$\n其中 $m \\in \\{0, 1\\}$。\n\n最后，计算贝叶斯因子 $K = Z_1 / Z_0$。期望的输出是其以 10 为底的对数，该值由总对数证据计算得出：\n$$\n\\log_{10} K = \\frac{\\ln K}{\\ln 10} = \\frac{\\ln Z_1^{\\text{total}} - \\ln Z_0^{\\text{total}}}{\\ln 10}\n$$\n\n对于每个测试用例，算法按以下步骤进行：\n1.  初始化总对数证据 $\\ln Z_0^{\\text{total}} = 0$ 和 $\\ln Z_1^{\\text{total}} = 0$。\n2.  对于三个可观测量中的每一个：\n    a. 构建数据向量 $\\mathbf{y}$、数据协方差矩阵 $\\Sigma_y$ 以及设计矩阵 $X_0$ 和 $X_1$。\n    b. 对模型 $M_0$ 和 $M_1$，计算矩阵 $C = \\Sigma_y + s_o^2 X X^T$。\n    c. 使用涉及 $C$ 的行列式和逆的公式计算对数证据 $\\ln Z$。\n    d. 将结果累加到相应的总对数证据累加器中。\n3.  根据总对数证据计算最终的 $\\log_{10} K$。\n对所有三个测试用例重复此过程。", "answer": "```python\nimport numpy as np\n\ndef calculate_log_evidence(y, sigma, N, s, model_type):\n    \"\"\"\n    Calculates the log-marginal-likelihood (log-evidence) for a Bayesian linear model.\n\n    Args:\n        y (list): List of measurement values.\n        sigma (list): List of measurement standard deviations.\n        N (list): List of neutron numbers.\n        s (float): Prior standard deviation for model parameters.\n        model_type (str): 'M0' for the null model, 'M1' for the alternative model.\n\n    Returns:\n        float: The natural logarithm of the model evidence, ln(Z).\n    \"\"\"\n    n = len(y)\n    y_vec = np.array(y)\n    \n    # Construct the design matrix X based on the model type\n    ones = np.ones(n)\n    neutrons = np.array(N)\n    \n    if model_type == 'M0':\n        # Model M0: y = beta_0 + beta_1 * N\n        X = np.stack([ones, neutrons], axis=1)\n    elif model_type == 'M1':\n        # Model M1: y = beta_0 + beta_1 * N + gamma * d(N)\n        d_N = (neutrons == 32).astype(float)\n        X = np.stack([ones, neutrons, d_N], axis=1)\n    else:\n        raise ValueError(\"Invalid model type specified. Must be 'M0' or 'M1'.\")\n\n    # Construct the covariance matrix of the measurement errors (likelihood)\n    Sigma_y = np.diag(np.array(sigma)**2)\n    \n    # The prior covariance is s^2 * I.\n    # The covariance of the predictive distribution for y is C = Sigma_y + X * Sigma_beta * X.T\n    # which simplifies to C = Sigma_y + s^2 * X @ X.T\n    C = Sigma_y + (s**2) * (X @ X.T)\n    \n    # Calculate the log-determinant of C. slogdet is used for numerical stability.\n    sign, logdet_C = np.linalg.slogdet(C)\n    if sign = 0:\n        # For a valid covariance matrix, the determinant must be positive.\n        # This case should not be reached with the given problem setup.\n        raise RuntimeError(\"Determinant of the predictive covariance matrix C is not positive.\")\n\n    # Calculate the inverse of C\n    try:\n        inv_C = np.linalg.inv(C)\n    except np.linalg.LinAlgError:\n        # C is singular, evidence is effectively zero.\n        raise RuntimeError(\"Predictive covariance matrix C is singular and cannot be inverted.\")\n\n    # Calculate the quadratic form y.T * C^-1 * y\n    quad_term = y_vec.T @ inv_C @ y_vec\n    \n    # Calculate the log-evidence using the formula for the log of a multivariate normal PDF\n    # evaluated at y, with mean 0 and covariance C.\n    # ln(Z) = -n/2*ln(2*pi) - 1/2*ln|C| - 1/2 * y.T * C^-1 * y\n    log_Z = -0.5 * n * np.log(2 * np.pi) - 0.5 * logdet_C - 0.5 * quad_term\n    \n    return log_Z\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test Case A (pronounced shell gap at N=32)\n        [\n            {'N': [30, 32, 34], 'y': [20.0, 16.8, 17.6], 'sigma': [0.2, 0.2, 0.2], 's': 10.0},\n            {'N': [30, 32, 34], 'y': [1.0, 2.3, 1.2], 'sigma': [0.05, 0.05, 0.05], 's': 3.0},\n            {'N': [30, 32, 34], 'y': [0.20, 0.06, 0.16], 'sigma': [0.01, 0.01, 0.01], 's': 0.5}\n        ],\n        # Test Case B (no shell gap, smooth trend)\n        [\n            {'N': [30, 32, 34], 'y': [20.0, 18.8, 17.6], 'sigma': [0.2, 0.2, 0.2], 's': 10.0},\n            {'N': [30, 32, 34], 'y': [1.0, 1.1, 1.2], 'sigma': [0.05, 0.05, 0.05], 's': 3.0},\n            {'N': [30, 32, 34], 'y': [0.20, 0.18, 0.16], 'sigma': [0.01, 0.01, 0.01], 's': 0.5}\n        ],\n        # Test Case C (sparse measurements, larger uncertainties)\n        [\n            {'N': [30, 32], 'y': [20.0, 18.8], 'sigma': [0.5, 0.5], 's': 10.0},\n            {'N': [30, 32], 'y': [1.0, 1.1], 'sigma': [0.2, 0.2], 's': 3.0},\n            {'N': [30, 32], 'y': [0.20, 0.18], 'sigma': [0.05, 0.05], 's': 0.5}\n        ]\n    ]\n\n    results = []\n    for case_data in test_cases:\n        total_log_Z0 = 0.0\n        total_log_Z1 = 0.0\n        \n        for obs_data in case_data:\n            # Unpack data for the current observable\n            y, sigma, N, s = obs_data['y'], obs_data['sigma'], obs_data['N'], obs_data['s']\n            \n            # Calculate and accumulate log-evidence for model M0\n            log_Z0 = calculate_log_evidence(y, sigma, N, s, 'M0')\n            total_log_Z0 += log_Z0\n            \n            # Calculate and accumulate log-evidence for model M1\n            log_Z1 = calculate_log_evidence(y, sigma, N, s, 'M1')\n            total_log_Z1 += log_Z1\n            \n        # Compute the natural logarithm of the Bayes factor K = Z1/Z0\n        log_K = total_log_Z1 - total_log_Z0\n        \n        # Convert to base-10 logarithm\n        log10_K = log_K / np.log(10)\n        \n        results.append(round(log10_K, 3))\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3558398"}]}