## 引言
在模拟宇宙尺度上[星系的形成与演化](@entry_id:160862)时，我们面临一个根本性的挑战：驱动[星系演化](@entry_id:158840)的关键物理过程，如恒星爆发和[黑洞](@entry_id:158571)活动，发生在远小于模拟分辨率的尺度上。直接解析这些过程在计算上是不可能的，这在理论与模拟之间造成了巨大的鸿沟。为了弥合这一鸿沟，现代[计算宇宙学](@entry_id:747605)严重依赖于**[次网格模型](@entry_id:755601)**——一系列旨在将无法解析的微观物理效应以物理上合理的方式施加于可解析尺度的算法处方。

本文深入探讨了用于模拟[超新星](@entry_id:161773)（SN）和[活动星系核](@entry_id:158029)（AGN）反馈的[次网格模型](@entry_id:755601)。通过三个层次的递进，我们将系统性地揭示这些模型的复杂性与强大功能。在**“原理与机制”**一章中，我们将剖析这些模型背后的核心物理思想，包括能量与动量的核算，以及为克服“[过冷问题](@entry_id:753036)”而设计的各种巧妙的数值策略。接着，在**“应用与跨学科联系”**一章中，我们将展示这些模型如何应用于区分不同的物理渠道，整合更丰富的微观物理，并最终连接理论与天文观测。最后，通过**“动手实践”**部分，读者将有机会通过具体的编程练习，加深对模型实现细节和潜在数值挑战的理解。

## 原理与机制

在宇宙学尺度上对星系形成和演化进行[数值模拟](@entry_id:137087)，本质上面临着一个巨大的尺度鸿沟问题。一方面，模拟需要涵盖广阔的宇宙网结构，尺度可达数百兆秒差距（Mpc）；另一方面，驱动[星系演化](@entry_id:158840)的关键物理过程——如恒星的诞生、超新星（SN）爆发和[活动星系核](@entry_id:158029)（AGN）的能量释放——却发生在远小于单个模拟分辨率单元的尺度上。直接在宇宙学体积内解析这些过程在计算上是不可行的。因此，现代[数值宇宙学](@entry_id:752779)严重依赖于**[次网格模型](@entry_id:755601)（subgrid models）**。这些模型是物理和现象学的处方，旨在将那些无法解析的微观物理过程的净效应，以一种有物理依据的方式，施加到模拟能够解析的宏观尺度上。

本章深入探讨了为超新星和[活动星系核反馈](@entry_id:161731)设计的[次网格模型](@entry_id:755601)的中心原理和机制。我们将阐明为何需要这些模型，它们如何从基本物理原理构建，以及在实践中如何实现，以确保数值的稳定性和结果的物理真实性。

### [超新星反馈](@entry_id:755651)机制

[超新星](@entry_id:161773)是宇宙中能量最强大的事件之一，由[大质量恒星](@entry_id:159884)生命终结时的核心塌缩或[白矮星](@entry_id:159122)的[热核](@entry_id:172041)爆炸引起。它们向周围的星际介质（ISM）注入大量的能量、动量、质量和重元素（金属）。有效模拟这种**超新-星反馈**对于解释观测到的星系[质量函数](@entry_id:158970)、[星系风](@entry_id:749689)的产生以及[星系际介质](@entry_id:157642)的化学增丰至关重要。

#### 能量、动量与化学物质收支

构建一个[次网格模型](@entry_id:755601)的第一步是精确核算单个恒星族（a single stellar population）随时间演化所释放的各种物理量。当一个质量为 $M_*$ 的恒星族形成时，它会通过一系列超新星事件，在后续的时间步长内逐渐将其影响施加于周围环境。这些影响必须被仔细核算。

- **能量**：[恒星演化](@entry_id:150430)理论和初始[质量函数](@entry_id:158970)（IMF）预测，每形成单位质量的恒星，将有多少能量以[超新星](@entry_id:161773)形式释放。这个量通常表示为比能量 $e_{\mathrm{SN}}$（例如，单位为 $\mathrm{J} \, M_{\odot}^{-1}$）。然而，并非所有能量都能有效地驱动气体运动。大部分能量以辐射形式迅速损失。因此，模型引入一个**耦合效率**（coupling efficiency），如 $f_{k,\mathrm{SN}}$，表示实际转化为流出物体动能的能量分数 [@problem_id:3491419]。

- **动量**：每个[超新星遗迹](@entry_id:267906)在其演化后期（即雪犁期或动量守恒期）会向周围介质传递一个净动量。[次网格模型](@entry_id:755601)可以直接注入这个“末端动量”$p_0$，而不是能量，因为动量在稠密环境中更难通过辐射损失。对于一个给定的恒星族，总注入动量是每个超新星的贡献总和 [@problem_id:3491419]。

- **质量与金属**：超新星爆发会将恒星的物质，包括在[核合成](@entry_id:161587)过程中新生成的金属，抛射回星际介质。模型通过**质量返回分数** $R_{\mathrm{SN}}$（抛射物质量与初始[恒星质量](@entry_id:157648)之比）和**净金属产率** $y_{\mathrm{SN}}$（新[合成金属](@entry_id:148135)质量与初始[恒星质量](@entry_id:157648)之比）来量化此过程。这些抛射物与周围被卷入的星际介质混合，从而改变了流出气体的金属丰度 [@problem_id:3491419]。

通过综合考虑能量和动量注入，我们可以估算由反馈驱动的[星系风](@entry_id:749689)的总质量 $M_w$。一个简单的模型是，将注入的总动能 $E_k$ 和总动量 $p_{\mathrm{tot}}$ 赋予一个质量为 $M_w$、速度为 $v$ 的单一气体“壳层”。根据[能量和动量守恒](@entry_id:193044)，$E_k = \frac{1}{2} M_w v^2$ 和 $p_{\mathrm{tot}} = M_w v$，我们可以推导出流出物质量：

$$M_w = \frac{p_{\mathrm{tot}}^2}{2 E_k}$$

这个关系式揭示了动量和能量在驱动[星系风](@entry_id:749689)中的不同角色，并且是许多[次网格模型](@entry_id:755601)估算**质量加载因子**（mass-loading factor）$\eta = \dot{M}_w / \dot{M}_*$ 的基础。

#### 数值实现策略与[过冷问题](@entry_id:753036)

将能量注入模拟中面临一个核心的数值挑战，即**[过冷问题](@entry_id:753036)（overcooling problem）**。如果将超新星能量作为热能直接注入到模拟中非常稠密的气体单元中，其极高的密度会导致[辐射冷却](@entry_id:754014)时标远小于[流体动力学](@entry_id:136788)时标。结果，注入的能量会几乎瞬间辐射掉，无法产生任何有意义的动力学效应（如驱动外流）。[次网格模型](@entry_id:755601)必须采用巧妙的策略来克服这个问题。

##### 策略一：动能反馈与[Sedov-Taylor解](@entry_id:265895)的匹配

一种直接的方法是绕[过热](@entry_id:147261)能阶段，直接注入动量或动能。但这引出了一个问题：应该注入多少动能？一个物理上自洽的方案是将数值解与已知的物理分析解相匹配。对于点状爆炸，**Sedov-Taylor[自相似解](@entry_id:164839)**描述了在均匀介质中[能量守恒](@entry_id:140514)的[冲击波](@entry_id:199561)的演化。其冲击波半径 $R(t)$ 和速度 $v_s(t)$ 的演化规律为：

$$R(t) = \xi \left(\frac{E_{\mathrm{SN}}}{\rho}\right)^{1/5} t^{2/5}$$
$$v_s(t) = \frac{2}{5} \frac{R(t)}{t}$$

其中 $E_{\mathrm{SN}}$ 是爆炸能量，$\rho$ 是介质密度，$\xi$ 是一个与气体绝热指数相关的常数。

一个先进的[次网格模型](@entry_id:755601)可以在每个时间步 $\Delta t$ 检查[超新星遗迹](@entry_id:267906)的物理尺度 $R(\Delta t)$ 是否被模拟的网格分辨率 $\Delta x$ 所解析 [@problem_id:3491430]。

- 如果 $R(\Delta t) > \Delta x$（**已解析阶段**），则说明[冲击波](@entry_id:199561)的尺度大于一个网格单元，[流体动力学](@entry_id:136788)求解器可以自行处理其演化。此时，模型可以简单地将 $E_{\mathrm{SN}}$ 作为热能注入。
- 如果 $R(\Delta t) \le \Delta x$（**未解析阶段**），则[流体动力学](@entry_id:136788)求解器无法捕捉[冲击波](@entry_id:199561)的正确演化。此时，模型必须手动确保正确的物理效应。它会计算在 $t=\Delta t$ 时刻，[Sedov-Taylor解](@entry_id:265895)所要求的动能 $E_{k, \mathrm{req}} = \frac{1}{2} (\rho V_c) v_s(\Delta t)^2$，其中 $V_c$ 是耦合体积。然后，模型将 $E_{\mathrm{SN}}$ 的一部分作为动能 $E_{k, \mathrm{req}}$ 注入，剩余部分 $E_{\mathrm{SN}} - E_{k, \mathrm{req}}$ 作为热能注入。

这种方法确保了无论分辨率如何，模拟都能在宏观上再现爆炸的正确动量，从而实现**分辨率收敛**。

##### 策略二：能量累积与阈值释放

另一种克服过冷的策略是暂时阻止注入的能量被辐射掉。一种常见技术是**能量累积模型** [@problem_id:3491447]。在这种方案中，来自随机反馈事件的能量 $E_i$ 不会立即释放，而是被添加到一个虚拟的**能量水库** $E_{\mathrm{res}}$ 中。只有当水库中的能量累积到超过一个预设的**能量阈值** $E_{\mathrm{th}}$ 时，全部累积的能量 $E_{\mathrm{res}}$ 才会被一次性注入到周围的 $N_{\mathrm{ngb}}$ 个气体单元中。

这个阈值 $E_{\mathrm{th}}$ 被设定得足够高，以确保释放的能量能将目标气体加热到一个非常高的温度 $\Delta T_{\min}$（例如 $10^7$ K），在此温度下[辐射冷却](@entry_id:754014)效率很低。这样，气体就有足够的时间通过[绝热膨胀](@entry_id:144584)将热能转化为动能，从而驱动外流。

然而，这种随机[累积和](@entry_id:748124)阈值释放的机制会引入一个微妙的[统计偏差](@entry_id:275818)。由于能量注入是随机的（例如，遵循[指数分布](@entry_id:273894)），当 $E_{\mathrm{res}}$ 达到并超过 $E_{\mathrm{th}}$ 时，它通常会“过冲”该阈值。由于[指数分布](@entry_id:273894)的无记忆性，这个[过冲](@entry_id:147201)量的[期望值](@entry_id:153208)恰好等于单次能量注入的平均值 $\bar{E}$。因此，每次释放的[平均能量](@entry_id:145892)是 $\langle E_{\mathrm{dep}} \rangle = E_{\mathrm{th}} + \bar{E}$。这导致平均温度跳变的观测值会系统性地高于设计的目标值 $\Delta T_{\min}$。这个理论上的**相对偏差**可以被精确预测 [@problem_id:3491447]：

$$\delta_{\mathrm{th}} = \frac{\langle \Delta T_{\mathrm{dep}} \rangle}{\Delta T_{\min}} - 1 = \frac{\bar{E}}{E_{\mathrm{th}}}$$

理解并量化这种偏差对于精确校准反馈模型至关重要。

##### 策略三：有效状态方程与[湍流](@entry_id:151300)压力

更复杂的模型将未解析的[超新星反馈](@entry_id:755651)视为驱动ISM中**亚格子[湍流](@entry_id:151300)**的能量来源。这些模型引入一个额外的[演化方程](@entry_id:268137)，用于描述每个分辨率单元内未解析的湍功能量 $e_t$。能量的注入率与局域的[恒星形成](@entry_id:159940)率成正比，而耗散则遵循[湍流](@entry_id:151300)级联理论（[Kolmogorov理论](@entry_id:200055)），耗散率与 $\sigma^3/L$ 成正比，其中 $\sigma = \sqrt{2e_t}$ 是[湍流](@entry_id:151300)速度弥散，L是[湍流](@entry_id:151300)的驱动尺度。

在[稳态](@entry_id:182458)下（注入=耗散），可以推导出[湍流](@entry_id:151300)压力 $P_t = \rho \sigma^2$ 与气体密度 $\rho$ 之间的关系。例如，在一个[恒星形成](@entry_id:159940)率 $\dot{\rho}_{\star} \propto \rho^{1.5}$（与自由落体时标相关）的模型中，可以证明[湍流](@entry_id:151300)压力与密度的关系为 $P_t \propto \rho^{4/3}$ [@problem_id:3491445]。这意味着，次网格[湍流](@entry_id:151300)为星形成气体提供了一个**有效的状态方程**，其有效[多方指数](@entry_id:137268) $\gamma_{\mathrm{eff}} = 4/3$。这种压力支持可以稳定气体盘，抑制过度碎片化和恒星形成，从而实现自我调节。

##### 随机注入 vs. 连续注入

在实现上，能量和动量的注入可以是**连续的**（在每个时间步注入平均[期望值](@entry_id:153208)）或**随机的**（在每个时间步从一个统计分布中抽样离散的事件数）。[连续模](@entry_id:158807)型在计算上更简单平滑，但在低[恒星形成](@entry_id:159940)率区域可能不物理——因为[超新星](@entry_id:161773)是离散事件。随机模型，例如通过[泊松分布](@entry_id:147769)对超新星事件数进行抽样，更能捕捉反馈的离散和随机性质 [@problem_id:3491462]。

这两种方法的选择会对模拟结果产生可观测的影响。由于随机模型引入了额外的随机性，它会自然地导致更高的恒星形成历史**爆发性（burstiness）**和更强的瞬时[外流](@entry_id:274280)。这种差异在低质量星系或高红移星系中尤为重要，因为在这些系统中，单个[超新星](@entry_id:161773)事件就可能对整个星系产生巨大影响。

### [活动星系核](@entry_id:158029)（AGN）反馈机制

虽然[超新星反馈](@entry_id:755651)在调节低质量星系中至关重要，但它不足以抑制宇宙中最 massive 的星系中的恒星形成，也无法解释星系团内部介质的性质。在这些大质量系统中，来自中央超大质量黑洞（SMBH）的**[活动星系核](@entry_id:158029)（AGN）反馈**被认为是主导的调节机制。

#### 超大质量黑洞的数值建模

在模拟中引入AGN反馈的第一步是可靠地追踪SMBH的演化。这本身就是一个复杂的次网格问题，涉及三个关键方面 [@problem_id:3491427]：

1.  **播种（Seeding）**：由于从[第一代恒星](@entry_id:158491)种子成长到[超大质量黑洞](@entry_id:157796)的过程无法被解析，模拟通常会在满足特定条件的[暗物质晕](@entry_id:147523)中“播种”一个中等质量的[黑洞](@entry_id:158571)粒子。播种的晕质量阈值 $M_{\mathrm{halo,seed}}$ 必须足够高，以确保该晕被足够多的暗物[质粒](@entry_id:263777)子解析（例如，超过100-1000个粒子），从而拥有一个明确定义的[引力势](@entry_id:160378)阱。

2.  **动力学与定位（Dynamics and Repositioning）**：由于数值分辨率有限，[黑洞](@entry_id:158571)粒子受到的动力学摩擦可能被低估，导致它们在星系中心附近不物理地“游荡”。为了修正这一点，许多模型采用了一种**人工重定位方案**，在每个时间步将[黑洞](@entry_id:158571)粒子向其周围气体或恒星[分布](@entry_id:182848)的引力势能最低点移动。为保证数值稳定性和动量守恒，这种移动的速度必须被限制，通常不能超过局域的动力学速度（如[恒星速度弥散](@entry_id:161232) $\sigma$）或一个由时间步长决定的数值速度上限 $h/\Delta t$。

3.  **[并合](@entry_id:147963)（Merging）**：当两个星系并合时，它们各自的SMBH最终会形成一个[双黑洞](@entry_id:159272)系统。由于模拟无法解析到[引力](@entry_id:175476)波辐射[并合](@entry_id:147963)的尺度，模型采用了一个次网格并合判据。一个物理上合理的判据是，当两个[黑洞](@entry_id:158571)粒子的距离小于气体平滑长度 $h$ 并且它们的相对速度 $v_{\mathrm{rel}}$ 小于它们彼此的**[逃逸速度](@entry_id:157685)** $v_{\mathrm{esc}}$ 时，它们被认为是[引力](@entry_id:175476)束缚的，可以并合。重要的是，在计算[逃逸速度](@entry_id:157685)时，必须使用模拟中实际采用的**[引力软化](@entry_id:146273)**（softened gravity）势能，即 $U(r) = -G M_1 M_2 / \sqrt{r^2 + \epsilon^2}$，其中 $\epsilon$ 是[引力软化](@entry_id:146273)长度。

#### 能量来源：[爱丁顿光度](@entry_id:158704)

AGN的能量来源于物质落入SMBH引力势阱时释放的[引力势能](@entry_id:269038)。对于一个辐射有效（radiatively efficient）的吸积盘，其辐射光度 $L$ 与[质量吸积率](@entry_id:161925) $\dot{M}_{\mathrm{BH}}$ 成正比，$L = \epsilon_r \dot{M}_{\mathrm{BH}} c^2$，其中 $\epsilon_r$ 是[辐射效率](@entry_id:260651)（通常取 $\sim 0.1$）。

然而，吸积率和光度存在一个物理上限，即**[爱丁顿光度](@entry_id:158704)（Eddington luminosity）** $L_{\mathrm{Edd}}$。这个极限出现在当辐射产生的外向辐射压力刚好平衡了作用在吸积物质上的内向[引力](@entry_id:175476)时。考虑一个位于距离[黑洞](@entry_id:158571) $r$ 处的电子-质子对，[引力](@entry_id:175476)主要作用于质子（质量 $m_p$），而辐射压力主要作用于电子（通过汤姆逊散射，[截面](@entry_id:154995) $\sigma_T$）。力平衡的条件为 [@problem_id:3491442]：

$$\frac{G M_{\mathrm{BH}} m_p}{r^2} = \frac{L_{\mathrm{Edd}} \sigma_T}{4\pi r^2 c}$$

解出 $L_{\mathrm{Edd}}$，我们得到一个只依赖于[黑洞质量](@entry_id:160874)的表达式：

$$L_{\mathrm{Edd}} = \frac{4\pi G M_{\mathrm{BH}} m_p c}{\sigma_T}$$

这个极限光度是许多AGN反馈模型中能量注入率的基础。例如，一个常见的热反馈模型会将一部分光度能量，通过一个耦合效率 $\epsilon_f$，作为热能注入到周围气体中，其功率为 $P_{\mathrm{fb}} = \epsilon_f L_{\mathrm{Edd}}$ [@problem_id:3491442]。

#### AGN反馈模式与触发机制

AGN反馈被认为以两种主要模式运行，这取决于[黑洞](@entry_id:158571)的吸积率：

- **类星体/辐射模式（Quasar/Radiative Mode）**：在高吸积率（接近[爱丁顿极限](@entry_id:159921)）时，AGN以辐射为主，产生强烈的辐射压和热风。在[次网格模型](@entry_id:755601)中，这通常被实现为热能注入或辐射动量注入 [@problem_id:3491419]。

- **喷流/动力学模式（Jet/Kinetic Mode）**：在低吸积率时，AGN可以通过[磁场](@entry_id:153296)过程驱动强大的、准直的喷流。这种模式在能量上可能同样强大，但其能量主要以动能形式存在。模型通常通过向特定方向注入动能或动量来实现。

一个更高级的反馈模型试图建立一个物理的**触发机制**，而不是简单地将反馈与吸积率联系起来。**“[降水](@entry_id:144409)”调节模型（precipitation-regulated model）**是一个著名的例子 [@problem_id:3491420]。其核心思想是，AGN反馈是星系热晕（hot halo）中一个[热力学](@entry_id:141121)调节循环的一部分。当热晕气体的**[辐射冷却](@entry_id:754014)时标** $t_{\mathrm{cool}}$ 相对于其**[引力](@entry_id:175476)自由落体时标** $t_{\mathrm{ff}}$ 变得足够短时，即满足条件：

$$\frac{t_{\mathrm{cool}}}{t_{\mathrm{ff}}}  \chi$$

其中 $\chi$ 是一个量级为10左右的无量纲阈值，热晕就会发生[热不稳定性](@entry_id:151762)，凝结（“降水”）出冷气体云。这些冷云会向星系中心下落，为SMBH提供燃料，从而触发AGN反馈。反馈产生的能量又会重新加热热晕，增加其 $t_{\mathrm{cool}}$，从而关闭“[降水](@entry_id:144409)”过程，形成一个自我调节的循环。

在湍动的热晕中，气体密度 $\rho$ 是一个遵循对数正态分布的[随机变量](@entry_id:195330)。由于 $t_{\mathrm{cool}} \propto T/\rho$ 和 $t_{\mathrm{ff}}$ 对密度不敏感，这个触发条件主要取决于局域密度。因此，可以通过校准阈值 $\chi$，使得在给定[湍流](@entry_id:151300)状态下，满足条件的流体单元的期望分数达到某个目标值（例如，$f_*=0.5$）。这提供了一种将宏观的反馈循环与介质的微观[湍流](@entry_id:151300)特性联系起来的物理方法 [@problem_id:3491420]。

### 共同原则与收敛性挑战

无论是SN反馈还是AGN反馈，所有[次网格模型](@entry_id:755601)都遵循一些共同的设计原则，并面临着确保数值收敛性的共同挑战。

#### 组合效应

在真实的星系中，SN和AGN反馈是同时发生的。[次网格模型](@entry_id:755601)必须能够处理它们的组合效应。一个直接的方法是在每个时间步独立计算来自每个渠道的能量、动量和质量注入，然后将它们相加，共同驱动一个统一的[星系风](@entry_id:749689) [@problem_id:3491419]。这种方法允许模型自然地过渡：在低质量星系和星暴区域，SN反馈占主导；而在大质量星系的中心，AGN反馈成为关键。

#### 分辨率收敛性

理想的[次网格模型](@entry_id:755601)应该在数值分辨率提高时，其产生的宏观结果（如星系质量或[恒星形成](@entry_id:159940)率）保持不变或收敛。这是一个极具挑战性的要求，因为它意味着模型的参数可能需要根据分辨率进行调整。

一个基本原则是，模型的**物理效应**（如温度跳变或速度冲击）应该与分辨率无关。考虑一个简单的热反馈模型，其中能量 $E_{\mathrm{th}}$ 被注入到 $N_h$ 个总质量为 $M_h = N_h m_{\mathrm{cell}}$ 的气体单元中。产生的温度跳变为：

$$\Delta T \propto \frac{E_{\mathrm{th}}}{M_h}$$

如果我们进行一次分辨率精化，使得每个气体单元的质量变为 $m_{\mathrm{cell}}' = r \cdot m_{\mathrm{cell}}$（其中 $r  1$ 是[质量分辨率](@entry_id:197946)的提升因子），那么新的加[热质量](@entry_id:188101)变为 $M_h' = r M_h$。为了保持 $\Delta T$ 不变，注入的能量 $E_{\mathrm{th}}'$ 必须相应地缩放 [@problem_id:3491464]：

$$\frac{E_{\mathrm{th}}'}{M_h'} = \frac{E_{\mathrm{th}}}{M_h} \implies E_{\mathrm{th}}' = r E_{\mathrm{th}}$$

如果注入的能量是通过一个耦合效率（如 $f_{\mathrm{th,SN}}$ 或 $\epsilon_f$）与一个固定的总能量（如 $E_{\mathrm{SN}}$）相联系的，即 $E_{\mathrm{th}} = f \cdot E_{\mathrm{total}}$，那么为了保持物理效应不变，耦合效率本身必须随分辨率缩放：

$$f' E_{\mathrm{total}} = r (f E_{\mathrm{total}}) \implies f' = r \cdot f$$

这个简单的缩放关系揭示了一个深刻的观点：[次网格模型](@entry_id:755601)的参数并非[普适常数](@entry_id:165600)，而是可能依赖于数值设置。设计和校准能够跨越不同分辨率并产生一致结果的反馈模型，是当前[计算宇宙学](@entry_id:747605)领域一个活跃的研究前沿。

总之，次网格反馈模型是连接[星系形成](@entry_id:160121)理论与[数值模拟](@entry_id:137087)的关键桥梁。它们不是任意的“修正因子”，而是基于物理原理和对未解析过程的深刻理解而构建的复杂算法。从[能量和动量守恒](@entry_id:193044)，到与解析解的匹配，再到[湍流](@entry_id:151300)和[热不稳定性](@entry_id:151762)理论的应用，这些模型体现了理论天体物理与高性能计算的精妙结合。