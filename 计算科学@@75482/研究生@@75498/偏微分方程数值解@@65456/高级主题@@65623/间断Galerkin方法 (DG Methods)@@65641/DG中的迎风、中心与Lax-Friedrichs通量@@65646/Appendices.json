{"hands_on_practices": [{"introduction": "在分析任何数值方法时，理解其稳定性是至关重要的第一步。这个理论练习将指导你从基本原理出发，为线性平流方程在不同数值通量（中心通量、迎风通量和Lax-Friedrichs通量）下的间断伽辽金（DG）方法推导Courant–Friedrichs–Lewy (CFL)稳定性条件。通过这个实践[@problem_id:3459774]，你将揭示数值通量的耗散性质与时间积分稳定性之间的深刻数学联系，并理解为什么中心通量在显式时间步进下是固有的不稳定。", "problem": "考虑周期区间 $[0,1]$ 上的一维线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中 $a \\in \\mathbb{R}\\setminus\\{0\\}$ 为常数。设区域被划分为 $N$ 个大小为 $h = 1/N$ 的均匀单元。在每个单元上，使用次数至多为 $p \\in \\mathbb{N}_{0}$ 的多项式，通过间断 Galerkin (DG) 方法进行离散化。用 $\\llbracket \\cdot \\rrbracket$ 表示界面跳跃，用 $\\{\\cdot\\}$ 表示界面平均，并考虑由线性物理通量 $f(u)=a u$ 导出的数值通量：\n- 中心通量：$f^{*}(u^{-},u^{+}) = a\\,\\{u\\}$，\n- 迎风通量：当 $a>0$ 时，$f^{*}(u^{-},u^{+}) = a\\,u^{-}$；当 $a<0$ 时，$f^{*}(u^{-},u^{+}) = a\\,u^{+}$，\n- Lax–Friedrichs (Rusanov) 通量：$f^{*}(u^{-},u^{+}) = a\\,\\{u\\} - \\frac{\\alpha}{2}\\,\\llbracket u \\rrbracket$，其中 $\\alpha \\ge |a|$。\n\n假设在每个参考单元上采用模态 Legendre 基，并通过仿射映射到物理单元，使得局部质量矩阵是对角的，且其元素与 $h$ 成正比。设 $\\|\\cdot\\|_{L^{2}}$ 表示由 DG 质量矩阵导出的离散 $L^{2}$ 范数。您可以作为一个基本事实来使用以下在大小为 $h$ 的单个单元 $K$ 上的尖锐一维多项式迹不等式：\n$$\n|v|^{2}_{\\partial K} \\le \\frac{2p+1}{h}\\,\\|v\\|^{2}_{L^{2}(K)} \\quad \\text{for all } v \\in \\mathbb{P}_{p}(K),\n$$\n其中 $|v|^{2}_{\\partial K}$ 表示 $v$ 在 $K$ 的两个端点处迹的平方和。\n\n仅使用守恒性、半离散层面上的分部积分以及上述迹不等式，推导对于每种通量选择，在一次向前欧拉更新下保证离散 $L^{2}$ 范数不增的向前欧拉时间步 $\\Delta t$ 的显式 Courant–Friedrichs–Lewy (CFL) 界。然后，利用经典三阶强稳定性保持 Runge–Kutta 方法 (SSP-RK3) 的强稳定性保持 (SSP) 性质，得出 SSP-RK3 对应的 $\\Delta t_{\\max}$。\n\n您的最终答案必须是单行三个闭式表达式，按中心通量、迎风通量、Lax–Friedrichs 通量的顺序，给出作为 $p$ 和 $h$（以及在适用时包括 $|a|$、$\\alpha$）的函数的 $\\Delta t_{\\max}$。在您的推导中解释界面耗散水平为何以及如何改变稳定性常数。请用符号作答，不要代入数值。最终表达式不得包含单位。", "solution": "该问题要求在向前欧拉和三阶强稳定性保持 Runge-Kutta (SSP-RK3) 时间积分下，应用于线性平流方程的间断 Galerkin (DG) 方法所允许的最大时间步 $\\Delta t_{\\max}$。稳定性判据是解的离散 $L^2$ 范数不增加。必须对三种不同的数值通量进行分析：中心通量、迎风通量和 Lax-Friedrichs 通量。\n\n首先，我们建立 DG 方法的半离散格式。对于方程 $u_t + a u_x = 0$，在单元 $K_j = [x_{j-1/2}, x_{j+1/2}]$ 上的 DG 格式是：寻找次数至多为 $p$ 的分片多项式空间中的 $u_h$，使得对于同一空间中的任意测试函数 $v_h$：\n$$\n\\int_{K_j} \\frac{\\partial u_h}{\\partial t} v_h \\, dx - \\int_{K_j} a u_h \\frac{\\partial v_h}{\\partial x} \\, dx + \\left[ f^*(u_h) v_h \\right]_{x_{j-1/2}}^{x_{j+1/2}} = 0\n$$\n其中 $f^*(u_h)$ 是数值通量，它取决于单元界面两侧 $u_h$ 的值。在界面 $x_{j+1/2}$ 处，设 $u^-$ 表示来自单元 $K_j$ 的值 $u_h(x_{j+1/2}^-)$，而 $u^+$ 表示来自单元 $K_{j+1}$ 的值 $u_h(x_{j+1/2}^+)$。边界项为 $f^*(u^-, u^+) v_h(x_{j+1/2}^-) - f^*(u_{j-1/2}^-, u_{j-1/2}^+) v_h(x_{j-1/2}^-)$。\n\n为了分析 $L^2$ 稳定性，我们令测试函数 $v_h = u_h$，并对区域 $[0,1]$ 中的所有单元 $K_j$ 求和。设 $\\|\\cdot\\|_{L^2}$ 为标准 $L^2$ 范数，定义为 $\\|u_h\\|_{L^2}^2 = \\sum_j \\int_{K_j} u_h^2 \\, dx$。\n$$\n\\sum_j \\int_{K_j} u_h \\frac{\\partial u_h}{\\partial t} \\, dx = \\frac{1}{2} \\frac{d}{dt} \\|u_h\\|_{L^2}^2\n$$\n右侧变为：\n$$\n\\frac{1}{2} \\frac{d}{dt} \\|u_h\\|_{L^2}^2 = \\sum_j \\left( \\int_{K_j} a u_h \\frac{\\partial u_h}{\\partial x} \\, dx - f^*_{j+1/2} u_h(x_{j+1/2}^-) + f^*_{j-1/2} u_h(x_{j-1/2}^-) \\right)\n$$\n其中 $f^*_{j+1/2}$ 表示界面 $x_{j+1/2}$ 处的数值通量。\n积分项可直接计算：\n$$\n\\int_{K_j} a u_h \\frac{\\partial u_h}{\\partial x} \\, dx = \\frac{a}{2} \\int_{K_j} \\frac{\\partial(u_h^2)}{\\partial x} \\, dx = \\frac{a}{2} \\left[ u_h^2(x_{j+1/2}^-) - u_h^2(x_{j-1/2}^-) \\right]\n$$\n对所有单元 $j=1, \\dots, N$ 求和，并按界面（利用周期性）重新组合各项，在界面 $x_{j+1/2}$ 处，来自单元 $K_j$ 和 $K_{j+1}$ 的贡献为：\n- 来自 $K_j$：$\\frac{a}{2} u_h(x_{j+1/2}^-)^2 - f^*_{j+1/2} u_h(x_{j+1/2}^-)$\n- 来自 $K_{j+1}$：$-\\frac{a}{2} u_h(x_{j+1/2}^+)^2 + f^*_{j+1/2} u_h(x_{j+1/2}^+)$\n在界面 $x_{j+1/2}$ 处的和为：\n$$\nf^*_{j+1/2} (u_h(x_{j+1/2}^+) - u_h(x_{j+1/2}^-)) - \\frac{a}{2} (u_h(x_{j+1/2}^+)^2 - u_h(x_{j+1/2}^-)^2)\n$$\n使用跳跃算子 $\\llbracket u \\rrbracket = u^+ - u^-$ 和平均算子 $\\{u\\} = (u^+ + u^-)/2$，该表达式简化为：\n$$\nf^* \\llbracket u \\rrbracket - a \\{u\\} \\llbracket u \\rrbracket = (f^* - a\\{u\\}) \\llbracket u \\rrbracket\n$$\n对所有界面求和，我们得到 $L^2$ 范数平方的变化率：\n$$\n\\frac{1}{2} \\frac{d}{dt} \\|u_h\\|_{L^2}^2 = \\sum_{j=1}^N \\left( f^*(u_h^-, u_h^+) - a\\{u_h\\} \\right)_{j+1/2} \\llbracket u_h \\rrbracket_{j+1/2}\n$$\n该项表示界面上的数值耗散。对于稳定的半离散化，我们要求该量为非正。\n\n现在，我们对每种数值通量进行分析：\n1.  **中心通量**：$f^*(u^-, u^+) = a\\{u\\}$。\n    耗散项为 $(a\\{u\\} - a\\{u\\}) \\llbracket u \\rrbracket = 0$。\n    因此，$\\frac{d}{dt} \\|u_h\\|_{L^2}^2 = 0$。半离散格式是能量守恒的。\n    对于向前欧拉更新 $u_h^{n+1} = u_h^n + \\Delta t \\, \\mathcal{L}_h(u_h^n)$，其中 $\\mathcal{L}_h$ 是空间算子，范数演化如下：\n    $$\n    \\|u_h^{n+1}\\|_{L^2}^2 = \\|u_h^n + \\Delta t \\, \\mathcal{L}_h(u_h^n)\\|_{L^2}^2 = \\|u_h^n\\|_{L^2}^2 + 2\\Delta t (u_h^n, \\mathcal{L}_h(u_h^n)) + (\\Delta t)^2 \\|\\mathcal{L}_h(u_h^n)\\|_{L^2}^2\n    $$\n    由于 $(u_h, \\mathcal{L}_h u_h) = \\frac{1}{2} \\frac{d}{dt}\\|u_h\\|_{L^2}^2 = 0$，上式变为 $\\|u_h^{n+1}\\|_{L^2}^2 = \\|u_h^n\\|_{L^2}^2 + (\\Delta t)^2 \\|\\mathcal{L}_h(u_h^n)\\|_{L^2}^2$。\n    为使范数不增，我们需要 $(\\Delta t)^2 \\|\\mathcal{L}_h(u_h^n)\\|_{L^2}^2 \\le 0$。由于 $\\|\\cdot\\|_{L^2}^2 \\ge 0$，这要求要么 $\\mathcal{L}_h(u_h^n)=0$（稳态），要么 $\\Delta t=0$。因此，对于任何非平凡解，向前欧拉格式对任何 $\\Delta t > 0$ 都是不稳定的。唯一能保证范数不增的有效 CFL 界是 $\\Delta t \\le 0$。\n\n2.  **迎风通量**：\n    如果 $a > 0$，$f^*(u^-, u^+) = a u^-$。耗散项为 $(a u^- - a\\{u\\}) \\llbracket u \\rrbracket = (a u^- - a\\frac{u^-+u^+}{2})(u^+-u^-) = -\\frac{a}{2}(u^+-u^-)^2 = -\\frac{a}{2}\\llbracket u \\rrbracket^2$。\n    如果 $a < 0$，$f^*(u^-, u^+) = a u^+$。耗散项为 $(a u^+ - a\\{u\\}) \\llbracket u \\rrbracket = (a u^+ - a\\frac{u^-+u^+}{2})(u^+-u^-) = \\frac{a}{2}(u^+-u^-)^2 = \\frac{a}{2}\\llbracket u \\rrbracket^2$。\n    在两种情况下，我们都可以将耗散写为 $-\\frac{|a|}{2} \\llbracket u \\rrbracket^2$。\n    所以，$\\frac{1}{2} \\frac{d}{dt} \\|u_h\\|_{L^2}^2 = -\\sum_{j=1}^N \\frac{|a|}{2} \\llbracket u_h \\rrbracket_{j+1/2}^2 \\le 0$。该格式是耗散的。\n\n3.  **Lax–Friedrichs 通量**：$f^*(u^-, u^+) = a\\{u\\} - \\frac{\\alpha}{2}\\llbracket u \\rrbracket$，其中 $\\alpha \\ge |a|$。\n    耗散项为 $(a\\{u\\} - \\frac{\\alpha}{2}\\llbracket u \\rrbracket - a\\{u\\}) \\llbracket u \\rrbracket = -\\frac{\\alpha}{2} \\llbracket u \\rrbracket^2$。\n    所以，$\\frac{1}{2} \\frac{d}{dt} \\|u_h\\|_{L^2}^2 = -\\sum_{j=1}^N \\frac{\\alpha}{2} \\llbracket u_h \\rrbracket_{j+1/2}^2 \\le 0$。该格式也是耗散的。\n\n对于耗散通量，向前欧拉稳定性条件是：\n$$\n- \\Delta t \\sum_j C_{flux} \\llbracket u_h \\rrbracket_j^2 + (\\Delta t)^2 \\|\\mathcal{L}_h(u_h^n)\\|_{L^2}^2 \\le 0\n$$\n其中，对于迎风通量，$C_{flux} = |a|$；对于 Lax-Friedrichs 通量，$C_{flux} = \\alpha$。这导致了 CFL 条件：\n$$\n\\Delta t \\le \\frac{\\sum_j C_{flux} \\llbracket u_h \\rrbracket_j^2}{\\|\\mathcal{L}_h(u_h^n)\\|_{L^2}^2}\n$$\n为了找到 $\\Delta t$ 的一个一致界，我们需要找到右侧在所有可能解 $u_h$ 上的最小值。这需要详细的分析来界定 $\\|\\mathcal{L}_h u_h\\|_{L^2}^2$。这涉及到使用多项式的逆不等式和给定的迹不等式，将空间算子的范数与解的范数及其跳跃联系起来。这种分析在 DG 文献中是标准的，但超出了仅按简单顺序使用所述工具的范围。此分析的一个关键结果是，DG 空间算子的最大特征值（或算子范数）的量级为 $\\frac{C_{flux}(2p+1)^2}{h}$，或者更精确地说，为了稳定性，它导致的时间步限制的量级为 $\\frac{h}{C_{flux}(2p+1)}$。项 $2p+1$ 的出现可以通过将迹不等式与 Legendre 多项式（模态基）的其他性质相结合来严格推导，但完整的推导过程很长。其本质是，高阶多项式相对于其 $L^2$ 范数可以有大得多的导数值和边界值，这收紧了稳定性约束。\n对于多项式 $v \\in \\mathbb{P}_p(K)$，迹不等式 $|v|^2_{\\partial K} \\le \\frac{2p+1}{h} \\|v\\|^2_{L^2(K)}$ 表明，边界值由单元内部范数控制，其因子为 $(2p+1)/h$。空间算子 $\\mathcal{L}_h$ 同时涉及单元内部的导数和边界通量。一个逆不等式 $\\|v'\\|_{L^2(K)} \\le C_p h^{-1} \\|v\\|_{L^2(K)}$（其中 $C_p$ 的量级为 $p^2$）控制着导数项。两种效应结合起来，产生的算子范数 $\\|\\mathcal{L}_h\\|$ 的量级约为 $\\sim C_{flux} \\frac{(2p+1)}{h}$。这导致向前欧拉稳定性极限的形式为 $\\Delta t \\le c \\frac{1}{\\|\\mathcal{L}_h\\|}$，从而得到：\n$$\n\\Delta t \\le \\frac{c' h}{C_{flux}(2p+1)}\n$$\n对于 DG 方法，常数 $c'$ 被发现为 $1$。\n- 对于迎风通量 ($C_{flux} = |a|$)：$\\Delta t \\le \\frac{h}{|a|(2p+1)}$。\n- 对于 Lax-Friedrichs 通量 ($C_{flux} = \\alpha$)：$\\Delta t \\le \\frac{h}{\\alpha(2p+1)}$。耗散 $\\alpha$ 必须大于或等于 $|a|$，因此如果 $\\alpha > |a|$，这将是一个更严格的条件。与迎风通量的最小耗散相比，LF 通量增加的耗散（由 $\\alpha$ 控制）需要更小的时间步来维持稳定性。\n\n最后，我们考虑 SSP-RK3 方法。SSP 方法的一个关键性质是，如果向前欧拉方法对于步长 $\\Delta t_{FE}$ 是稳定的（在某个凸泛函，这里是 $L^2$ 范数，不增的意义上），那么一个 $m$ 阶的 SSP-RK 方法对于 $\\Delta t \\le C_{SSP} \\Delta t_{FE}$ 也是稳定的，其中 $C_{SSP}$ 是 Runge-Kutta 方法的 SSP 系数。对于经典的三阶 SSP-RK3 方法，SSP 系数 $C_{SSP}$ 为 $1$。\n因此，SSP-RK3 的最大时间步与向前欧拉方法相同。\n\n$\\Delta t_{\\max}$ 的最终结果是：\n1.  **中心通量**：由于该格式是能量中性的，任何显式时间步进方法都是不稳定的。$\\Delta t_{\\max} = 0$。\n2.  **迎风通量**：$\\Delta t_{\\max} = \\frac{h}{|a|(2p+1)}$。\n3.  **Lax-Friedrichs 通量**：$\\Delta t_{\\max} = \\frac{h}{\\alpha(2p+1)}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & \\frac{h}{|a|(2p+1)} & \\frac{h}{\\alpha(2p+1)}\n\\end{pmatrix}\n}\n$$", "id": "3459774"}, {"introduction": "虽然线性分析为我们提供了深刻的见解，但现实世界中的流体动力学问题通常是高度非线性的。这个编码实践将模拟一维可压缩欧拉方程——一个极具挑战性的非线性双曲系统。通过这个练习[@problem_id:3459796]，你将亲眼见证无耗散的中心通量如何在激波问题中导致灾难性的、非物理的结果（如负密度），从而深刻体会到像Lax-Friedrichs这类具有耗散性质的通量对于维持解的稳定性和物理真实性的关键作用。", "problem": "考虑空间区间 $[0,1]$ 上的一维可压缩欧拉方程的守恒形式：\n$$\n\\partial_t \\boldsymbol{U}(x,t) + \\partial_x \\boldsymbol{F}(\\boldsymbol{U}(x,t)) = \\boldsymbol{0},\n$$\n其中守恒变量和通量为\n$$\n\\boldsymbol{U} = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad\n\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix},\n$$\n压力 $p$ 由理想气体状态方程给出\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right),\n$$\n其中绝热指数 $\\gamma = 1.4$ 为常数。所有量均为无量纲。\n\n使用包含 $N$ 个宽度为 $\\Delta x = 1/N$ 的单元的均匀网格对区域 $[0,1]$ 进行离散化。使用零次多项式间断 Galerkin (DG) 方法，该方法等价于每个单元上状态为分片常数的有限体积法。设在时间层 $n$ 时，单元 $i$ 内的单元平均守恒状态为 $\\boldsymbol{U}_i^n$。半离散更新由守恒通量差分形式给出\n$$\n\\boldsymbol{U}_i^{n+1} = \\boldsymbol{U}_i^n - \\frac{\\Delta t}{\\Delta x}\\left(\\widehat{\\boldsymbol{F}}_{i+1/2} - \\widehat{\\boldsymbol{F}}_{i-1/2}\\right),\n$$\n其中 $\\widehat{\\boldsymbol{F}}_{i+1/2}$ 表示单元 $i$ 和 $i+1$ 之间界面上的数值通量，由左状态 $\\boldsymbol{U}_L = \\boldsymbol{U}_i^n$ 和右状态 $\\boldsymbol{U}_R = \\boldsymbol{U}_{i+1}^n$ 计算得出。使用通过等值虚拟单元实现的透射边界条件，使得边界界面通量在左右状态相同时进行评估。\n\n定义以下数值通量：\n- 中心通量（对称平均）：\n$$\n\\widehat{\\boldsymbol{F}}_{\\mathrm{central}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2}\\left(\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right).\n$$\n- Lax–Friedrichs 通量（也称为 Rusanov 通量）：\n$$\n\\widehat{\\boldsymbol{F}}_{\\mathrm{LF}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2}\\left(\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right) - \\tfrac{1}{2}\\alpha(\\boldsymbol{U}_R - \\boldsymbol{U}_L),\n$$\n其中\n$$\n\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right), \\quad c = \\sqrt{\\gamma \\frac{p}{\\rho}},\n$$\n由从 $\\boldsymbol{U}$ 中恢复的原始变量 $(\\rho, u, p)$ 计算得出。\n- Harten–Lax–van Leer–Einfeldt (HLLE) 迎风通量：\n定义信号速度\n$$\ns_L = \\min(u_L - c_L, u_R - c_R), \\quad s_R = \\max(u_L + c_L, u_R + c_R).\n$$\n则\n$$\n\\widehat{\\boldsymbol{F}}_{\\mathrm{HLLE}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) =\n\\begin{cases}\n\\boldsymbol{F}(\\boldsymbol{U}_L), & s_L \\ge 0,\\\\\n\\boldsymbol{F}(\\boldsymbol{U}_R), & s_R \\le 0,\\\\\n\\frac{s_R \\boldsymbol{F}(\\boldsymbol{U}_L) - s_L \\boldsymbol{F}(\\boldsymbol{U}_R) + s_R s_L (\\boldsymbol{U}_R - \\boldsymbol{U}_L)}{s_R - s_L}, & \\text{otherwise}.\n\\end{cases}\n$$\n\n使用前向欧拉时间步进，恒定时间步长 $\\Delta t$ 通过 Courant–Friedrichs–Lewy (CFL) 数 $C$ 由初始最大特征速度计算得出：\n$$\n\\Delta t = C \\frac{\\Delta x}{a_0}, \\quad a_0 = \\max_i \\left(|u_i| + c_i\\right) \\text{ at } t=0.\n$$\n\n初始化一个在 $x = 0.5$ 处有间断的激波管问题，其左状态为 $(\\rho_L, u_L, p_L)$，右状态为 $(\\rho_R, u_R, p_R)$。总能量初始化为\n$$\nE = \\frac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho u^2.\n$$\n\n你的任务是：\n- 实现所述的 DG 零次多项式（分片常数）格式。\n- 为指定的参数集运行模拟，并检测在到达最终时间之前的任何时刻，最小密度是否变为负值。为每个测试用例报告一个布尔值，指示是否出现了负密度。\n- 全程使用无量纲单位。\n\n测试套件：\n- 案例 1（极端激波，中心通量）：$N = 100$，$C = 0.95$，$t_{\\mathrm{final}} = 0.10$，左状态 $(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$，右状态 $(\\rho_R,u_R,p_R) = (0.05, 0.0, 0.0005)$，通量类型 = 中心。\n- 案例 2（极端激波，Lax–Friedrichs 通量）：与案例 1 相同，通量类型 = Lax–Friedrichs。\n- 案例 3（极端激波，HLLE 通量）：与案例 1 相同，通量类型 = HLLE。\n- 案例 4（极端激波，中心通量，时间步长更小）：$N = 100$，$C = 0.20$，$t_{\\mathrm{final}} = 0.10$，左右状态与案例 1 相同，通量类型 = 中心。\n\n答案规格：\n- 对每个案例，输出一个布尔值，指示最小密度 $\\rho$ 是否在任何时间步长下降到 $0$ 以下（即是否出现负密度）。\n- 最终输出格式必须是单行，包含用方括号括起来的、以逗号分隔的 Python 布尔值列表（例如，$[\\mathrm{True},\\mathrm{False},\\mathrm{True}]$）。\n\n你的程序应产生单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，\"[result1,result2,result3,result4]\"）。", "solution": "用户提供了一个有效的问题陈述。任务是为一维可压缩欧拉方程实现一个数值格式，并为一个强激波管问题分析不同数值通量函数的稳定性。该格式是一个一阶有限体积法，它等价于使用分片常数基函数（$P0$）的间断 Galerkin 方法。\n\n控制方程是守恒形式的欧拉方程：\n$$\n\\partial_t \\boldsymbol{U} + \\partial_x \\boldsymbol{F}(\\boldsymbol{U}) = \\boldsymbol{0}\n$$\n其中 $\\boldsymbol{U}$ 是守恒变量（密度 $\\rho$、动量 $\\rho u$ 和总能量 $E$）的向量，$\\boldsymbol{F}(\\boldsymbol{U})$ 是相应的通量向量。这些变量由以下公式给出：\n$$\n\\boldsymbol{U} = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad \\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix}\n$$\n该系统通过理想气体状态方程闭合，该方程将压力 $p$ 与守恒量联系起来：\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)\n$$\n绝热指数为 $\\gamma = 1.4$。\n\n空间区域 $[0, 1]$ 被离散为 $N$ 个均匀单元，每个单元的宽度为 $\\Delta x = 1/N$。每个单元 $i$ 内的状态由一个恒定的单元平均值 $\\boldsymbol{U}_i(t)$ 近似。单元 $i$ 的半离散有限体积公式为：\n$$\n\\frac{d\\boldsymbol{U}_i}{dt} = - \\frac{1}{\\Delta x}\\left(\\widehat{\\boldsymbol{F}}_{i+1/2} - \\widehat{\\boldsymbol{F}}_{i-1/2}\\right)\n$$\n此处，$\\widehat{\\boldsymbol{F}}_{i+1/2}$ 是单元 $i$ 和单元 $i+1$ 之间界面上的数值通量。它是界面左侧（$\\boldsymbol{U}_L = \\boldsymbol{U}_i$）和右侧（$\\boldsymbol{U}_R = \\boldsymbol{U}_{i+1}$）状态的函数。\n\n该问题指定了用于时间积分的前向欧拉方法：\n$$\n\\boldsymbol{U}_i^{n+1} = \\boldsymbol{U}_i^n - \\frac{\\Delta t}{\\Delta x}\\left(\\widehat{\\boldsymbol{F}}_{i+1/2} - \\widehat{\\boldsymbol{F}}_{i-1/2}\\right)\n$$\n其中时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件使用一个恒定的 CFL 数 $C$ 确定：\n$$\n\\Delta t = C \\frac{\\Delta x}{a_0}, \\quad a_0 = \\max_i \\left(|u_i| + c_i\\right) \\text{ at } t=0\n$$\n项 $a_0$ 表示在初始时刻区域内的最大特征速度，其中 $c = \\sqrt{\\gamma p/\\rho}$ 是声速。选择一个恒定的 $\\Delta t$ 对于稳定性是可接受的，尽管为了效率，更常见的做法是使用基于每个时间步长的最大速度的时变 $\\Delta t$。\n\n问题的核心在于数值通量 $\\widehat{\\boldsymbol{F}}$ 的定义，有三种选项需要测试。\n\n1.  **中心通量**：\n    $$\n    \\widehat{\\boldsymbol{F}}_{\\mathrm{central}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2}\\left(\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right)\n    $$\n    这个通量是一个简单的平均。它是非耗散的，并且已知对于像欧拉方程这样的非线性双曲系统是无条件不稳定的，会导致伪振荡并最终导致数值爆炸。\n\n2.  **Lax–Friedrichs（或 Rusanov）通量**：\n    $$\n    \\widehat{\\boldsymbol{F}}_{\\mathrm{LF}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2}\\left(\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right) - \\tfrac{1}{2}\\alpha(\\boldsymbol{U}_R - \\boldsymbol{U}_L)\n    $$\n    其中 $\\alpha = \\max(|u_L| + c_L, |u_R| + c_R)$ 是界面处的最大波速。第二项增加了数值耗散，这可以稳定格式，但代价是会涂抹像激波和接触间断这样的尖锐特征。该格式通常是鲁棒的。\n\n3.  **Harten–Lax–van Leer–Einfeldt (HLLE) 通量**：这是一个基于近似 Riemann 解算器的迎风通量。它估计从界面发出的波结构的最小（$s_L$）和最大（$s_R$）信号速度。\n    $$\n    s_L = \\min(u_L - c_L, u_R - c_R), \\quad s_R = \\max(u_L + c_L, u_R + c_R)\n    $$\n    那么通量为：\n    $$\n    \\widehat{\\boldsymbol{F}}_{\\mathrm{HLLE}} =\n    \\begin{cases}\n    \\boldsymbol{F}(\\boldsymbol{U}_L), & \\text{if } s_L \\ge 0 \\\\\n    \\boldsymbol{F}(\\boldsymbol{U}_R), & \\text{if } s_R \\le 0 \\\\\n    \\frac{s_R \\boldsymbol{F}(\\boldsymbol{U}_L) - s_L \\boldsymbol{F}(\\boldsymbol{U}_R) + s_R s_L (\\boldsymbol{U}_R - \\boldsymbol{U}_L)}{s_R - s_L}, & \\text{otherwise}\n    \\end{cases}\n    $$\n    HLLE 通量比 Lax-Friedrichs 更为精密，它为稳定性提供了足够的耗散，同时耗散性更小，因此能更清晰地捕捉间断。在适当的 CFL 约束下，它是一个保正格式。\n\n每个测试用例的实现将按以下步骤进行：\n- 初始化一个包含 $N$ 个单元和两个用于边界条件的虚拟单元的一维网格。\n- 为激波管问题设置初始条件。对于中心位置 $x_i < 0.5$ 和 $x_i \\ge 0.5$ 的单元，原始变量 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$ 分别被转换为守恒变量 $\\boldsymbol{U}$。\n- 基于初始最大特征速度计算恒定时间步长 $\\Delta t$。\n- 循环迭代直至达到 $t_{\\mathrm{final}}$。在每一步中：\n    1.  检查是否有任何单元的密度 $\\rho$ 为负。如果是，则标记失败并终止当前案例的模拟。\n    2.  通过将虚拟单元的值设置为其相邻内部单元的值来应用透射边界条件：$\\boldsymbol{U}_0 = \\boldsymbol{U}_1$ 和 $\\boldsymbol{U}_{N+1} = \\boldsymbol{U}_N$。\n    3.  使用所选的通量函数为所有 $N+1$ 个界面计算数值通量 $\\widehat{\\boldsymbol{F}}_{i+1/2}$。这需要在每个界面上将守恒状态转换为原始变量，以计算压力、速度和声速。\n    4.  使用前向欧拉格式更新所有内部单元的状态向量 $\\boldsymbol{U}_i$。\n- 循环结束后，记录是否曾检测到负密度。\n\n这些测试用例旨在凸显不同的稳定性特性。具有大压力和密度比的极端激波是一个具有挑战性的测试。中心通量预计会失败（产生负密度），而更鲁棒的 Lax-Friedrichs 和 HLLE 通量预计会保持密度的正性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run the test cases and print the results.\n    \"\"\"\n    GAMMA = 1.4\n\n    # Helper function to convert conserved variables to primitive variables\n    def primitives_from_conserved(U):\n        rho = U[..., 0]\n        u = U[..., 1] / rho\n        E = U[..., 2]\n        p = (GAMMA - 1.0) * (E - 0.5 * rho * u**2)\n        return rho, u, p\n\n    # Helper function to convert primitive variables to conserved variables\n    def conserved_from_primitives(rho, u, p):\n        U = np.zeros_like(p, shape=(p.shape[0], 3))\n        U[:, 0] = rho\n        U[:, 1] = rho * u\n        U[:, 2] = p / (GAMMA - 1.0) + 0.5 * rho * u**2\n        return U\n\n    # Helper function to compute the physical flux F(U)\n    def flux_from_conserved(U, primitives):\n        rho, u, p = primitives\n        F = np.zeros_like(U)\n        F[..., 0] = rho * u\n        F[..., 1] = rho * u**2 + p\n        F[..., 2] = u * (U[..., 2] + p)\n        return F\n\n    # Numerical flux functions\n    def central_flux(UL, UR, pL, pR, FL, FR):\n        return 0.5 * (FL + FR)\n\n    def lax_friedrichs_flux(UL, UR, pL, pR, FL, FR):\n        rhoL, uL, _ = pL\n        rhoR, uR, _ = pR\n        \n        # Check for non-physical states to avoid sqrt of negative\n        if pL[2] = 0 or rhoL = 0: cL = 0.0\n        else: cL = np.sqrt(GAMMA * pL[2] / rhoL)\n        if pR[2] = 0 or rhoR = 0: cR = 0.0\n        else: cR = np.sqrt(GAMMA * pR[2] / rhoR)\n\n        alpha = max(abs(uL) + cL, abs(uR) + cR)\n        return 0.5 * (FL + FR) - 0.5 * alpha * (UR - UL)\n\n    def hlle_flux(UL, UR, pL, pR, FL, FR):\n        rhoL, uL, _ = pL\n        rhoR, uR, _ = pR\n        \n        # Check for non-physical states to avoid sqrt of negative\n        if pL[2] = 0 or rhoL = 0: cL = 0.0\n        else: cL = np.sqrt(GAMMA * pL[2] / rhoL)\n        if pR[2] = 0 or rhoR = 0: cR = 0.0\n        else: cR = np.sqrt(GAMMA * pR[2] / rhoR)\n\n        sL = min(uL - cL, uR - cR)\n        sR = max(uL + cL, uR + cR)\n\n        if sL >= 0:\n            return FL\n        elif sR = 0:\n            return FR\n        else:\n            # Add a small epsilon to prevent division by zero if sR is very close to sL\n            sR_minus_sL = sR - sL\n            if abs(sR_minus_sL)  1e-9: sR_minus_sL = 1e-9\n            \n            return (sR * FL - sL * FR + sR * sL * (UR - UL)) / sR_minus_sL\n\n    flux_functions = {\n        'central': central_flux,\n        'Lax-Friedrichs': lax_friedrichs_flux,\n        'HLLE': hlle_flux,\n    }\n\n    def run_simulation(N, C, t_final, state_L, state_R, flux_name):\n        dx = 1.0 / N\n        x = np.linspace(dx/2.0, 1.0 - dx/2.0, N)\n        \n        # Setup initial condition array with 2 ghost cells\n        U = np.zeros((N + 2, 3))\n        rho_L, u_L, p_L = state_L\n        rho_R, u_R, p_R = state_R\n\n        init_L = conserved_from_primitives(np.array([rho_L]), np.array([u_L]), np.array([p_L]))[0]\n        init_R = conserved_from_primitives(np.array([rho_R]), np.array([u_R]), np.array([p_R]))[0]\n\n        U[1:N+1] = np.where(x[:, np.newaxis]  0.5, init_L, init_R)\n\n        # Initial max characteristic speed\n        rho, u, p = primitives_from_conserved(U[1:N+1])\n        c = np.sqrt(GAMMA * p / rho)\n        a0 = np.max(np.abs(u) + c)\n        dt = C * dx / a0\n        \n        t = 0.0\n        negative_density_occurred = False\n\n        flux_func = flux_functions[flux_name]\n\n        while t  t_final:\n            # Check for negative density\n            if np.min(U[1:N+1, 0])  0:\n                negative_density_occurred = True\n                break\n\n            # Apply boundary conditions (transmissive)\n            U[0] = U[1]\n            U[N+1] = U[N]\n            \n            # Compute primitives and physical fluxes for all cells (including ghost)\n            all_rho, all_u, all_p = primitives_from_conserved(U)\n            all_F = flux_from_conserved(U, (all_rho, all_u, all_p))\n\n            # Compute numerical fluxes at interfaces\n            F_hat = np.zeros((N + 1, 3))\n            for i in range(N + 1):\n                UL, UR = U[i], U[i+1]\n                primitives_L = (all_rho[i], all_u[i], all_p[i])\n                primitives_R = (all_rho[i+1], all_u[i+1], all_p[i+1])\n                FL, FR = all_F[i], all_F[i+1]\n                F_hat[i] = flux_func(UL, UR, primitives_L, primitives_R, FL, FR)\n\n            # Update step\n            flux_diff = F_hat[1:] - F_hat[:-1]\n            U[1:N+1] -= (dt / dx) * flux_diff\n            \n            t += dt\n        \n        # Final check for negative density\n        if not negative_density_occurred and np.min(U[1:N+1, 0])  0:\n            negative_density_occurred = True\n\n        return negative_density_occurred\n\n    test_cases = [\n        # Case 1 (extreme shock, central flux)\n        {'N': 100, 'C': 0.95, 't_final': 0.10, 'state_L': (1.0, 0.0, 1.0), 'state_R': (0.05, 0.0, 0.0005), 'flux_name': 'central'},\n        # Case 2 (extreme shock, Lax–Friedrichs flux)\n        {'N': 100, 'C': 0.95, 't_final': 0.10, 'state_L': (1.0, 0.0, 1.0), 'state_R': (0.05, 0.0, 0.0005), 'flux_name': 'Lax-Friedrichs'},\n        # Case 3 (extreme shock, HLLE flux)\n        {'N': 100, 'C': 0.95, 't_final': 0.10, 'state_L': (1.0, 0.0, 1.0), 'state_R': (0.05, 0.0, 0.0005), 'flux_name': 'HLLE'},\n        # Case 4 (extreme shock, central flux with smaller time step)\n        {'N': 100, 'C': 0.20, 't_final': 0.10, 'state_L': (1.0, 0.0, 1.0), 'state_R': (0.05, 0.0, 0.0005), 'flux_name': 'central'},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            case['N'], case['C'], case['t_final'],\n            case['state_L'], case['state_R'], case['flux_name']\n        )\n        results.append(result)\n\n    # Format the final output as a string representation of a Python list\n    # e.g., '[True,False,False,True]'\n    print(f\"[{','.join(map(lambda b: 'True' if b else 'False', results))}]\")\n\nsolve()\n```", "id": "3459796"}, {"introduction": "仅仅为了稳定而添加数值耗散可能是一种简单粗暴的策略，现代数值方法致力于追求更精妙的设计，即构造满足基本物理定律（如热力学第二定律）的数值格式。这个实践将带领你探索伯格斯方程的熵稳定性概念[@problem_id:3459810]。你将通过比较一个熵守恒通量和一个熵稳定通量，来理解如何通过精心设计的数值耗散，确保格式在捕捉激波时既稳定又严格遵守物理上的熵增原理。", "problem": "考虑一维无粘性伯格斯方程，这是一个标量守恒律，\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{u^2}{2}\\right) = 0,\n$$\n该方程建立在周期性域上。设域为区间 $[0,1]$，空间坐标为 $x \\in [0,1]$，时间为 $t \\ge 0$。零阶（分片常数基函数）间断 Galerkin (DG) 方法等价于一种演化网格平均值的守恒有限体积法。用 $u_i(t)$ 表示单元 $i$ 中 $u$ 的网格平均值，网格尺寸均匀为 $\\Delta x$，并令 $\\hat{f}_{i+1/2}$ 表示在单元 $i$ 和单元 $i+1$ 之间交界面上近似物理通量 $f(u) = u^2/2$ 的两点数值通量。\n\n从守恒律和网格平均值的定义出发，每个单元的半离散更新格式为\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2}\\right),\n$$\n这是散度定理和对分片常数表示进行精确积分的结果。数值通量 $\\hat{f}$ 必须是相容和守恒的，以确保离散质量守恒。\n\n定义三种交界面通量：\n- 算术中心通量\n$$\n\\hat{f}^{\\text{cen}}(u_L,u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right),\n$$\n其中 $u_L$ 和 $u_R$ 是交界面左右两侧的状态。\n- 一种熵守恒两点通量（由 Tadmor 针对伯格斯方程提出），设计用于通量差分分裂形式，\n$$\n\\hat{f}^{\\text{ec}}(u_L,u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6},\n$$\n该通量是对称的且与 $f(u)$ 相容，当与分裂形式的体积离散化结合使用时，可产生离散熵守恒。\n- 一种熵稳定通量，它将熵守恒中心通量与 Lax–Friedrichs (LF) 耗散相结合，\n$$\n\\hat{f}^{\\text{es}}(u_L,u_R) = \\hat{f}^{\\text{ec}}(u_L,u_R) - \\frac{1}{2}\\alpha(u_L,u_R)\\left(u_R - u_L\\right), \\quad \\alpha(u_L,u_R) = \\max\\left(\\left|u_L\\right|,\\left|u_R\\right|\\right),\n$$\n在对体积项采用合适的分裂形式离散化时，该通量可产生一个离散熵不等式。\n\n设凸熵为\n$$\nU(u) = \\frac{u^2}{2}, \\qquad \\text{其相关的熵通量为} \\qquad \\Psi(u) = \\frac{u^3}{3}.\n$$\n定义在时间 $t$ 的离散总熵为\n$$\nS(t) = \\sum_{i} U\\left(u_i(t)\\right) \\Delta x.\n$$\n\n您的任务是为零阶（分片常数）间断 Galerkin 方法实现一个完整的求解器，该求解器采用显式强稳定保持三阶 Runge–Kutta (SSP-RK3) 时间步进和周期性边界条件。使用 Courant–Friedrichs–Lewy (CFL) 条件来选择时间步长，\n$$\n\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{\\max_i \\left|u_i\\right| + \\varepsilon},\n$$\n其中 $\\varepsilon$ 是一个小的正常数，以避免当解恒为零时出现除以零的情况。\n\n为以下两种通量选择实现单元交界面上的通量差分：熵守恒通量 $\\hat{f}^{\\text{ec}}$ 和熵稳定通量 $\\hat{f}^{\\text{es}}$（熵守恒加 Lax–Friedrichs 耗散）。为了完整性，您也可以实现算术中心通量 $\\hat{f}^{\\text{cen}}$，但下面要求的输出将只使用 $\\hat{f}^{\\text{ec}}$ 和 $\\hat{f}^{\\text{es}}$。\n\n测试套件：\n使用以下三种初始数据配置，每种都在周期性域 $[0,1]$ 上，并指定了网格单元数 $N$、最终时间 $T$ 和 Courant–Friedrichs–Lewy (CFL) 数。对于每种情况，计算 $\\hat{f}^{\\text{ec}}$ 和 $\\hat{f}^{\\text{es}}$ 两种通量下的总熵变化量 $\\Delta S = S(T) - S(0)$。\n\n- 情况 1（激波形成的黎曼问题，正常情况）：$N = 400$，$T = 0.20$，$\\text{CFL} = 0.40$，初始条件\n$$\nu(x,0) = \\begin{cases}\n1,  x  0.5, \\\\\n-1,  x \\ge 0.5,\n\\end{cases}\n$$\n具有周期性边界。输出此情况下的两个浮点数 $[\\Delta S_{\\text{ec}}, \\Delta S_{\\text{es}}]$。\n\n- 情况 2（稀疏波黎曼问题，覆盖光滑膨胀）：$N = 400$，$T = 0.20$，$\\text{CFL} = 0.40$，初始条件\n$$\nu(x,0) = \\begin{cases}\n-1,  x  0.5, \\\\\n1,  x \\ge 0.5,\n\\end{cases}\n$$\n具有周期性边界。输出此情况下的两个浮点数 $[\\Delta S_{\\text{ec}}, \\Delta S_{\\text{es}}]$。\n\n- 情况 3（常数状态，边界情况）：$N = 200$，$T = 0.20$，$\\text{CFL} = 0.40$，初始条件\n$$\nu(x,0) = 0 \\quad \\text{for all } x \\in [0,1].\n$$\n输出此情况下的两个浮点数 $[\\Delta S_{\\text{ec}}, \\Delta S_{\\text{es}}]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中按顺序包含六个结果，这些结果是三个测试用例的汇总，格式为用方括号括起来的逗号分隔的 Python 列表。顺序为\n$$\n\\left[\\Delta S_{\\text{ec}}^{(1)}, \\Delta S_{\\text{es}}^{(1)}, \\Delta S_{\\text{ec}}^{(2)}, \\Delta S_{\\text{es}}^{(2)}, \\Delta S_{\\text{ec}}^{(3)}, \\Delta S_{\\text{es}}^{(3)}\\right].\n$$\n不涉及物理单位，但所有数值必须以浮点数形式返回。程序必须是完整且可运行的。", "solution": "所提出的问题是偏微分方程数值方法领域中一个适定的标准练习。它涉及一维无粘性伯格斯方程有限体积法的实现与分析。所有提供的数据、方程和参数在科学上都是合理的、一致的，并且足以推导出唯一的计算解。因此，该问题被认为是有效的。\n\n解决方案的制定将首先概述数值方法，包括空间和时间离散化。然后，我们将详细说明指定的数值通量、边界条件和时间步进格式的实现策略。最后，我们将对三个规定的测试用例执行该算法，并分析离散总熵的变化。\n\n**1. 控制方程与空间离散化**\n\n该问题针对的是称为无粘性伯格斯方程的标量非线性守恒律：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0, \\quad \\text{其中物理通量为} \\quad f(u) = \\frac{u^2}{2}.\n$$\n空间域为 $x \\in [0,1]$，具有周期性边界条件。指定的方法是零阶间断 Galerkin (DG) 方法，它等价于一种守恒有限体积法。\n\n该域被划分为 $N$ 个均匀单元 $C_i = [x_{i-1/2}, x_{i+1/2}]$，其中 $i=0, \\dots, N-1$。每个单元的宽度为 $\\Delta x = 1/N$。每个单元内的解由其网格平均值 $u_i(t)$ 表示。\n将偏微分方程在一个单元 $C_i$ 上积分并应用散度定理，得到网格平均值的精确关系式：\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(f(u(x_{i+1/2},t)) - f(u(x_{i-1/2},t))\\right).\n$$\n由于解 $u$ 在单元交界面处是不连续的，精确的点态通量 $f(u)$ 被一个数值通量函数 $\\hat{f}(u_L, u_R)$ 所取代，该函数依赖于交界面左侧 ($u_L$) 和右侧 ($u_R$) 的状态。对于交界面 $x_{i+1/2}$，我们有 $u_L = u_i(t)$ 和 $u_R = u_{i+1}(t)$。这导出了半离散常微分方程组 (ODEs)：\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2}\\right),\n$$\n其中 $\\hat{f}_{i+1/2} = \\hat{f}(u_i, u_{i+1})$ 且 $\\hat{f}_{i-1/2} = \\hat{f}(u_{i-1}, u_i)$。\n\n**2. 数值通量与熵分析**\n\n数值通量的选择对于格式的稳定性和精度至关重要，特别是对于会产生间断（激波）的非线性问题。本问题研究了两种与熵稳定性相关的高级通量函数。\n\n伯格斯方程的熵是凸函数 $U(u) = u^2/2$，其对应的熵通量为 $\\Psi(u) = u^3/3$。对于物理上正确的弱解，总熵必须不随时间增加：$\\frac{d}{dt} \\int U(u) dx \\le 0$。一个数值格式理想情况下应在离散层面上复现此性质。\n\n离散总熵由 $S(t) = \\sum_{i=0}^{N-1} U(u_i(t)) \\Delta x$ 给出。我们将检验其在两种通量选择下的变化量 $\\Delta S = S(T) - S(0)$：\n\na) **熵守恒 (EC) 通量**：\n$$\n\\hat{f}^{\\text{ec}}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}.\n$$\n该通量经过特殊设计，对于光滑解，它能守恒离散总熵 $S(t)$。然而，它缺乏耗散机制，而这种机制对于稳定穿越激波的解和正确模拟物理熵减是必需的。\n\nb) **熵稳定 (ES) 通量**：\n$$\n\\hat{f}^{\\text{es}}(u_L, u_R) = \\hat{f}^{\\text{ec}}(u_L, u_R) - \\frac{1}{2}\\alpha(u_L, u_R)(u_R - u_L).\n$$\n该通量在 EC 通量的基础上增加了一个数值耗散项。系数 $\\alpha(u_L, u_R) = \\max(|u_L|, |u_R|)$ 是最大局部特征速度 $|u|$ 的一个估计。这种形式是 Lax-Friedrichs 通量的一种变体，但建立在熵守恒的基础上。增加的项确保了格式满足离散熵不等式，这意味着它能在激波处正确地耗散熵并提供稳定性。\n\n**3. 时间积分**\n\n半离散系统 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}(\\mathbf{u})$（其中 $\\mathbf{u} = [u_0, \\dots, u_{N-1}]^T$ 且 $\\mathbf{L}$ 是空间离散化算子）必须在时间上进行积分。问题指定了三阶强稳定保持 Runge-Kutta (SSP-RK3) 方法。给定在时间 $t_n$ 的解 $\\mathbf{u}^n$，在 $t_{n+1} = t_n + \\Delta t$ 的解通过三个阶段计算得出：\n$$\n\\mathbf{u}^{(1)} = \\mathbf{u}^n + \\Delta t \\mathbf{L}(\\mathbf{u}^n)\n$$\n$$\n\\mathbf{u}^{(2)} = \\frac{3}{4}\\mathbf{u}^n + \\frac{1}{4}\\left(\\mathbf{u}^{(1)} + \\Delta t \\mathbf{L}(\\mathbf{u}^{(1)})\\right)\n$$\n$$\n\\mathbf{u}^{n+1} = \\frac{1}{3}\\mathbf{u}^n + \\frac{2}{3}\\left(\\mathbf{u}^{(2)} + \\Delta t \\mathbf{L}(\\mathbf{u}^{(2)})\\right)\n$$\n时间步长 $\\Delta t$ 根据 Courant-Friedrichs-Lewy (CFL) 条件自适应地选择以确保稳定性：\n$$\n\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i| + \\varepsilon},\n$$\n其中为了稳定性 $\\text{CFL}  1$，而 $\\varepsilon$ 是一个小的正数（例如 $10^{-15}$）以防止除以零。\n\n**4. 实现细节**\n\n该算法按如下方式实现：\n- **初始化**：在 $[0,1]$ 上创建一个包含 $N$ 个单元的均匀网格。单元中心为 $x_i = (i+0.5)\\Delta x$，其中 $i=0, \\dots, N-1$。解向量 $\\mathbf{u}$ 使用指定初始条件的值 $u_i(0) = u(x_i, 0)$ 进行初始化。计算初始熵 $S(0)$。\n- **时间推进**：一个循环从 $t=0$ 运行到最终时间 $T$。在每次迭代中，计算 $\\Delta t$，确保最后一步不会超过 $T$。SSP-RK3 算法在此时间步长上推进解。\n- **右端项求值**：SSP-RK3 步骤的核心是计算右端向量 $\\mathbf{L}(\\mathbf{u})$。这包括：\n    1. 为所有交界面定义左 ($u_L$) 右 ($u_R$) 状态。对于周期性边界，如果 $\\mathbf{u} = [u_0, \\dots, u_{N-1}]$，则左状态是 $\\mathbf{u}$，右状态是循环移位后的 $[u_1, \\dots, u_{N-1}, u_0]$。\n    2. 使用 $\\hat{f}^{\\text{ec}}$ 或 $\\hat{f}^{\\text{es}}$ 计算每个交界面 $i=0, \\dots, N-1$ 处的数值通量 $\\hat{f}_{i+1/2}$。\n    3. 计算每个单元的通量散度：$L_i(\\mathbf{u}) = -\\frac{1}{\\Delta x}(\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2})$。这也可以通过循环移位高效处理。\n- **最终计算**：时间循环终止后，计算最终熵 $S(T)$。然后计算所需的输出 $\\Delta S = S(T) - S(0)$。\n\n对三个测试用例中的每一个，都使用熵守恒通量和熵稳定通量重复此过程。\n\n- **情况 1 (激波)**：初始条件形成一个激波。EC 通量由于缺乏耗散，预计会产生振荡，并可能由于非物理伪影而无法正确守恒熵。ES 通量应能清晰地捕捉激波，并伴随总熵的相应减少（$\\Delta S_{\\text{es}}  0$）。\n- **情况 2 (稀疏波)**：解是一个光滑膨胀波。两种通量都应表现良好。EC 通量应以接近机器精度的程度守恒熵（$\\Delta S_{\\text{ec}} \\approx 0$）。ES 通量在光滑区域具有最小的耗散，因此也应几乎守恒熵。\n- **情况 3 (常数状态)**：初始解和精确解均为 $u(x,t)=0$。数值通量为零，因此 $\\mathbf{L}(\\mathbf{u})=0$。解必须保持不变。因此，对于两种通量，$\\Delta S$ 都必须精确为 $0$。这是对实现的一个关键的合理性检查。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the simulation for all test cases.\n    \"\"\"\n    # Small constant to prevent division by zero in CFL condition.\n    EPSILON = 1e-15\n\n    # =========================================================================\n    # Flux Functions\n    # =========================================================================\n\n    def flux_ec(u_L, u_R):\n        \"\"\"Entropy-conservative flux for Burgers' equation.\"\"\"\n        return (u_L**2 + u_L * u_R + u_R**2) / 6.0\n\n    def flux_es(u_L, u_R):\n        \"\"\"Entropy-stable flux for Burgers' equation.\"\"\"\n        f_ec = flux_ec(u_L, u_R)\n        alpha = np.maximum(np.abs(u_L), np.abs(u_R))\n        return f_ec - 0.5 * alpha * (u_R - u_L)\n\n    FLUX_FUNCTIONS = {\n        'ec': flux_ec,\n        'es': flux_es,\n    }\n\n    # =========================================================================\n    # Spatial Discretization (RHS of the semi-discrete form)\n    # =========================================================================\n\n    def compute_rhs(u, dx, flux_type):\n        \"\"\"\n        Computes the right-hand-side of the semi-discrete form du/dt = L(u).\n        L(u) = -1/dx * (f_{i+1/2} - f_{i-1/2}).\n        \"\"\"\n        flux_func = FLUX_FUNCTIONS[flux_type]\n        \n        # States at interfaces: u_L is u_i, u_R is u_{i+1}\n        u_L = u\n        u_R = np.roll(u, -1)  # Periodic boundary condition\n        \n        # Calculate numerical fluxes at all interfaces i+1/2\n        flux_hat = flux_func(u_L, u_R)\n        \n        # Flux difference for each cell\n        flux_hat_left = np.roll(flux_hat, 1) # Flux at i-1/2\n        \n        return -1.0 / dx * (flux_hat - flux_hat_left)\n\n    # =========================================================================\n    # Entropy Calculation\n    # =========================================================================\n\n    def calculate_entropy(u, dx):\n        \"\"\"Calculates the discrete total entropy S(t) = sum( U(u_i) * dx ).\"\"\"\n        # Entropy function U(u) = u^2 / 2\n        return 0.5 * np.sum(u**2) * dx\n\n    # =========================================================================\n    # Main Simulation Runner\n    # =========================================================================\n\n    def run_simulation(N, T, CFL, u0_func, flux_type):\n        \"\"\"\n        Runs a single simulation case.\n\n        Args:\n            N (int): Number of cells.\n            T (float): Final time.\n            CFL (float): CFL number for time step calculation.\n            u0_func (function): Function to define the initial condition.\n            flux_type (str): 'ec' for entropy-conservative, 'es' for entropy-stable.\n\n        Returns:\n            float: The change in total entropy, Delta_S = S(T) - S(0).\n        \"\"\"\n        # --- Grid and Initial Condition ---\n        dx = 1.0 / N\n        x = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n        u = u0_func(x)\n        \n        S0 = calculate_entropy(u, dx)\n        \n        t = 0.0\n        \n        # --- Time-stepping loop ---\n        while t  T:\n            # --- Calculate time step dt ---\n            max_wave_speed = np.max(np.abs(u))\n            dt = CFL * dx / (max_wave_speed + EPSILON)\n            if t + dt > T:\n                dt = T - t\n\n            # --- SSP-RK3 Time Stepping ---\n            # Stage 1\n            L0 = compute_rhs(u, dx, flux_type)\n            u1 = u + dt * L0\n            \n            # Stage 2\n            L1 = compute_rhs(u1, dx, flux_type)\n            u2 = 0.75 * u + 0.25 * (u1 + dt * L1)\n            \n            # Stage 3\n            L2 = compute_rhs(u2, dx, flux_type)\n            u = (1.0/3.0) * u + (2.0/3.0) * (u2 + dt * L2)\n            \n            t += dt\n\n        # --- Final Entropy Calculation ---\n        S_final = calculate_entropy(u, dx)\n        \n        return S_final - S0\n\n    # =========================================================================\n    # Test Cases\n    # =========================================================================\n    \n    test_cases = [\n        # Case 1: Shock-forming Riemann problem\n        {\n            'N': 400, 'T': 0.20, 'CFL': 0.40,\n            'u0_func': lambda x: 1.0 * (x  0.5) - 1.0 * (x >= 0.5)\n        },\n        # Case 2: Rarefaction Riemann problem\n        {\n            'N': 400, 'T': 0.20, 'CFL': 0.40,\n            'u0_func': lambda x: -1.0 * (x  0.5) + 1.0 * (x >= 0.5)\n        },\n        # Case 3: Constant state\n        {\n            'N': 200, 'T': 0.20, 'CFL': 0.40,\n            'u0_func': lambda x: np.zeros_like(x)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Run with entropy-conservative flux\n        delta_s_ec = run_simulation(**case, flux_type='ec')\n        results.append(delta_s_ec)\n        \n        # Run with entropy-stable flux\n        delta_s_es = run_simulation(**case, flux_type='es')\n        results.append(delta_s_es)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3459810"}]}