{"hands_on_practices": [{"introduction": "在间断伽辽金（DG）方法中，为了简化计算和实现代码的通用性，我们通常在统一的参考单元上定义基函数和进行数值积分。然而，实际的计算域被划分为各种大小和位置的物理单元。本练习将指导你推导从参考单元到物理单元的坐标变换法则，这是连接理论与实践的桥梁。通过这个练习，你将掌握雅可比行列式 $J$ 如何影响质量矩阵和刚度矩阵，这是实现任何有限元或DG代码的基石。[@problem_id:3424466]", "problem": "考虑在一个单元 $e = [x_L, x_R]$ 上，对一个二阶标量偏微分方程进行一维间断Galerkin (DG) 离散化。令参考单元为 $[-1, 1]$，并考虑仿射映射 $x(\\xi) = \\dfrac{x_R - x_L}{2}\\,\\xi + \\dfrac{x_R + x_L}{2}$，其雅可比为 $J = \\dfrac{x_R - x_L}{2}$。设 $\\{\\hat{\\phi}_i(\\xi)\\}_{i=0}^{p}$ 是参考单元上的一个多项式基（可以是节点基或模态基），并通过 $\\phi_i(x) = \\hat{\\phi}_i(\\xi(x))$ 定义相应的物理单元基。单元质量矩阵和刚度矩阵定义如下\n$$\nM_{ij}^{e} = \\int_{x_L}^{x_R} \\phi_i(x)\\,\\phi_j(x)\\,dx,\\qquad \nK_{ij}^{e} = \\int_{x_L}^{x_R} \\frac{d\\phi_i}{dx}(x)\\,\\frac{d\\phi_j}{dx}(x)\\,dx.\n$$\n在参考单元上，定义质量矩阵和刚度矩阵\n$$\n\\hat{M}_{ij} = \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,d\\xi,\\qquad \n\\hat{K}_{ij} = \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi.\n$$\n从积分的变量替换定理和导数的链式法则出发，推导在仿射映射下，$[x_L, x_R]$ 上的积分如何变换，并用 $\\hat{M}_{ij}$ 和 $\\hat{K}_{ij}$ 精确确定雅可比 $J$ 在 $M_{ij}^{e}$ 和 $K_{ij}^{e}$ 中如何出现。请给出你推理的所有步骤，并且除了多项式性和拉回关系 $\\phi_i(x) = \\hat{\\phi}_i(\\xi(x))$ 外，不要假设基函数具有任何其他特殊性质。\n\n以数对 $(M_{ij}^{e}, K_{ij}^{e})$ 的形式给出你的最终答案，只用 $J$、$\\hat{M}_{ij}$ 和 $\\hat{K}_{ij}$ 表示。你的最终答案必须是单个解析表达式，并且不包含等式或不等式。", "solution": "所述问题是有效的。它是有限元和间断Galerkin方法理论中一个标准的、适定的问题，基于已建立的数学原理。所有术语都有明确定义，前提条件是自洽的，并且足以推导出所需的关系。我们现在开始进行求解。\n\n目标是将定义在物理单元 $e = [x_L, x_R]$ 上的物理单元矩阵 $M_{ij}^{e}$ 和 $K_{ij}^{e}$ 与定义在参考单元 $[-1, 1]$ 上的参考单元矩阵 $\\hat{M}_{ij}$ 和 $\\hat{K}_{ij}$ 联系起来。这是通过所提供的仿射映射及其雅可比来实现的。\n\n设从参考坐标 $\\xi \\in [-1, 1]$ 到物理坐标 $x \\in [x_L, x_R]$ 的仿射映射为\n$$\nx(\\xi) = \\frac{x_R - x_L}{2}\\,\\xi + \\frac{x_R + x_L}{2}.\n$$\n该变换的雅可比 $J$ 是 $x$ 关于 $\\xi$ 的导数：\n$$\nJ = \\frac{dx}{d\\xi} = \\frac{d}{d\\xi}\\left(\\frac{x_R - x_L}{2}\\,\\xi + \\frac{x_R + x_L}{2}\\right) = \\frac{x_R - x_L}{2}.\n$$\n由于对于给定单元，$x_L$ 和 $x_R$ 是常数，所以雅可比 $J$ 是一个常数。从 $x$ 到 $\\xi$ 的逆映射也可以求导：\n$$\n\\frac{d\\xi}{dx} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} = J^{-1} = \\frac{1}{J}.\n$$\n\n我们现在将分别推导质量矩阵 $M_{ij}^{e}$ 和刚度矩阵 $K_{ij}^{e}$ 的表达式。\n\n### 质量矩阵 $M_{ij}^{e}$ 的变换\n\n物理单元质量矩阵的定义是\n$$\nM_{ij}^{e} = \\int_{x_L}^{x_R} \\phi_i(x)\\,\\phi_j(x)\\,dx.\n$$\n为了计算这个积分，我们进行从物理坐标 $x$ 到参考坐标 $\\xi$ 的变量替换。积分限从 $[x_L, x_R]$ 变为 $[-1, 1]$。微分元变换为 $dx = \\frac{dx}{d\\xi}\\,d\\xi = J\\,d\\xi$。物理单元上的基函数 $\\phi_i(x)$ 被定义为参考基函数 $\\hat{\\phi}_i(\\xi)$ 的拉回，使得 $\\phi_i(x(\\xi)) = \\hat{\\phi}_i(\\xi)$。\n\n将这些变换代入 $M_{ij}^{e}$ 的积分中：\n$$\nM_{ij}^{e} = \\int_{-1}^{1} \\phi_i(x(\\xi))\\,\\phi_j(x(\\xi))\\,(J\\,d\\xi).\n$$\n使用拉回关系 $\\phi_k(x(\\xi)) = \\hat{\\phi}_k(\\xi)$，我们得到：\n$$\nM_{ij}^{e} = \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,J\\,d\\xi.\n$$\n由于雅可比 $J$ 相对于积分变量 $\\xi$ 是常数，所以可以将其从积分中提出来：\n$$\nM_{ij}^{e} = J \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,d\\xi.\n$$\n剩余的积分根据定义就是参考质量矩阵 $\\hat{M}_{ij}$：\n$$\n\\hat{M}_{ij} = \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,d\\xi.\n$$\n因此，质量矩阵的关系是：\n$$\nM_{ij}^{e} = J \\hat{M}_{ij}.\n$$\n\n### 刚度矩阵 $K_{ij}^{e}$ 的变换\n\n物理单元刚度矩阵的定义是\n$$\nK_{ij}^{e} = \\int_{x_L}^{x_R} \\frac{d\\phi_i}{dx}(x)\\,\\frac{d\\phi_j}{dx}(x)\\,dx.\n$$\n这个变换需要两个步骤：首先，变换导数 $\\frac{d\\phi_k}{dx}$，其次，变换积分本身。\n\n我们使用链式法则将关于 $x$ 的导数与关于 $\\xi$ 的导数联系起来：\n$$\n\\frac{d\\phi_k}{dx} = \\frac{d\\phi_k}{d\\xi}\\,\\frac{d\\xi}{dx}.\n$$\n项 $\\frac{d\\phi_k}{d\\xi}$ 是复合函数 $\\phi_k(x(\\xi))$ 关于 $\\xi$ 的导数。根据定义，这等于参考基函数 $\\frac{d\\hat{\\phi}_k}{d\\xi}$ 的导数。项 $\\frac{d\\xi}{dx}$ 是雅可比的逆，我们已求得其为 $J^{-1}$。因此，\n$$\n\\frac{d\\phi_k}{dx}(x) = \\frac{d\\hat{\\phi}_k}{d\\xi}(\\xi(x)) \\cdot \\frac{1}{J}.\n$$\n将 $\\phi_i$ 和 $\\phi_j$ 的导数的这个表达式代入 $K_{ij}^{e}$ 的定义中：\n$$\nK_{ij}^{e} = \\int_{x_L}^{x_R} \\left(\\frac{1}{J}\\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi(x))\\right) \\left(\\frac{1}{J}\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi(x))\\right) dx.\n$$\n合并 $J$ 的常数因子：\n$$\nK_{ij}^{e} = \\int_{x_L}^{x_R} \\frac{1}{J^2} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi(x)) \\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi(x)) dx.\n$$\n接下来，我们对积分进行变量替换，这与质量矩阵的情况类似。积分域变为 $[-1, 1]$，微分元 $dx$ 变为 $J\\,d\\xi$：\n$$\nK_{ij}^{e} = \\int_{-1}^{1} \\frac{1}{J^2} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi) \\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi) (J\\,d\\xi).\n$$\n包含常数雅可比 $J$ 的因子可以被化简并移出积分：\n$$\nK_{ij}^{e} = \\frac{J}{J^2} \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi = \\frac{1}{J} \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi.\n$$\n剩余的积分是参考刚度矩阵 $\\hat{K}_{ij}$ 的定义：\n$$\n\\hat{K}_{ij} = \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi.\n$$\n因此，刚度矩阵的关系是：\n$$\nK_{ij}^{e} = \\frac{1}{J} \\hat{K}_{ij}.\n$$\n\n最终答案是用 $J$、$\\hat{M}_{ij}$ 和 $\\hat{K}_{ij}$ 表示的数对 $(M_{ij}^{e}, K_{ij}^{e})$。根据以上推导，这个数对是 $\\left(J\\,\\hat{M}_{ij}, \\frac{1}{J}\\hat{K}_{ij}\\right)$。", "answer": "$$\n\\boxed{\n\\left(J\\hat{M}_{ij}, \\frac{1}{J}\\hat{K}_{ij}\\right)\n}\n$$", "id": "3424466"}, {"introduction": "掌握了基本的坐标变换之后，我们将深入探究算子本身的内部结构。本练习聚焦于使用勒让德多项式作为模态基时，弱微分算子的具体形式。通过从第一性原理出发推导刚度矩阵 $S_{mn}$，你将揭示其稀疏性和奇偶耦合等关键特性。理解这些结构对于分析模态DG格式的稳定性和收敛性至关重要。[@problem_id:3424476]", "problem": "考虑用于偏微分方程（PDE）数值解的间断伽辽金（DG）方法中的一维参考单元 $[-1,1]$。设 $\\{\\phi_{n}(\\xi)\\}_{n=0}^{p}$ 是 $[-1,1]$ 上基于勒让德（Legendre）多项式的模态基，具体取 $\\phi_{n}(\\xi)=P_{n}(\\xi)$，即 $n$ 次勒让德多项式，其中 $P_{n}$ 在 $[-1,1]$ 上带权重 $1$ 正交，并满足 $\\int_{-1}^{1} P_{m}(\\xi)P_{n}(\\xi)\\,d\\xi=\\frac{2}{2n+1}\\delta_{mn}$ 以及 $P_{n}(\\pm 1)=(\\pm 1)^{n}$。定义刚度矩阵 $S\\in\\mathbb{R}^{(p+1)\\times(p+1)}$ 为\n$$\nS_{mn}=\\int_{-1}^{1}\\phi_{m}'(\\xi)\\,\\phi_{n}(\\xi)\\,d\\xi=\\int_{-1}^{1}P_{m}'(\\xi)\\,P_{n}(\\xi)\\,d\\xi,\n$$\n对于 $0\\le m,n\\le p$。从勒让德多项式的基本性质和伽辽金投影的第一性原理出发，为所有非负整数 $m,n$ 推导出 $S_{mn}$ 的一个显式闭式表达式。然后，解释 $S$ 如何在模态空间中表示微分算子，包括其稀疏性和奇偶耦合结构。\n\n你的最终答案必须是关于整数 $m$ 和 $n$ 的 $S_{mn}$ 的单一闭式解析表达式。如果使用亥维赛阶跃函数 $H(k)$，定义为对于整数 $k\\ge 1$ 时 $H(k)=1$，对于整数 $k\\le 0$ 时 $H(k)=0$。无需进行四舍五入。", "solution": "问题要求推导刚度矩阵元素 $S_{mn}$ 并解释其性质。该问题陈述经核实具有科学依据、适定且客观。它基于数值分析的标准原理和正交多项式理论。所有必要信息均已提供。\n\n刚度矩阵元素 $S_{mn}$ 定义为\n$$ S_{mn} = \\int_{-1}^{1} \\phi_{m}'(\\xi)\\,\\phi_{n}(\\xi)\\,d\\xi = \\int_{-1}^{1} P_{m}'(\\xi)\\,P_{n}(\\xi)\\,d\\xi $$\n其中 $P_k(\\xi)$ 是 $k$ 次勒让德多项式。\n\n为了推导 $S_{mn}$ 的显式表达式，我们将使用勒让德多项式的基本性质。\n\n首先，考虑被积函数各项的次数。勒让德多项式 $P_m(\\xi)$ 是一个 $m$ 次多项式。其导数 $P_m'(\\xi)$ 是一个 $m-1$ 次多项式。勒让德多项式在区间 $[-1,1]$ 上构成一个权重函数为 $1$ 的正交基。这种正交性的一个关键性质是，对于任何次数小于 $n$ 的多项式 $q(\\xi)$，\n$$ \\int_{-1}^{1} q(\\xi)P_{n}(\\xi)\\,d\\xi = 0 $$\n在我们的情况中，$S_{mn}$ 的积分包含项 $P_m'(\\xi)$，其次数为 $m-1$。如果 $P_m'(\\xi)$ 的次数小于 $P_n(\\xi)$ 的次数（即 $n$），则积分为零。这个条件是 $m-1  n$，等价于 $m \\le n$。\n因此，对于所有 $m \\le n$，矩阵元素为\n$$ S_{mn} = 0 \\quad \\text{对于 } m \\le n $$\n这表明刚度矩阵 $S$ 是严格下三角矩阵，意味着其所有对角线和上三角项都为零。\n\n接下来，我们考虑 $m  n$ 的情况。我们对 $S_{mn}$ 的定义使用分部积分法：\n令 $u = P_n(\\xi)$ 且 $dv = P_m'(\\xi)d\\xi$。则 $du = P_n'(\\xi)d\\xi$ 且 $v = P_m(\\xi)$。\n$$ S_{mn} = \\int_{-1}^{1} P_m'(\\xi)P_n(\\xi)\\,d\\xi = \\left[ P_m(\\xi)P_n(\\xi) \\right]_{-1}^{1} - \\int_{-1}^{1} P_m(\\xi)P_n'(\\xi)\\,d\\xi $$\n右侧的积分根据定义即为 $S_{nm} = \\int_{-1}^{1} P_n'(\\xi)P_m(\\xi)\\,d\\xi$。\n边界项使用给定性质 $P_k(\\pm 1) = (\\pm 1)^k$ 进行计算：\n$$ \\left[ P_m(\\xi)P_n(\\xi) \\right]_{-1}^{1} = P_m(1)P_n(1) - P_m(-1)P_n(-1) = (1)^m (1)^n - (-1)^m (-1)^n = 1 - (-1)^{m+n} $$\n将这些代回，我们得到关系式：\n$$ S_{mn} = 1 - (-1)^{m+n} - S_{nm} $$\n这个关系对所有 $m, n$ 都成立。我们目前正在研究 $m  n$ 的情况。对于项 $S_{nm}$，行索引 $n$ 严格小于列索引 $m$。由于我们已经确定对于 $i \\le j$ 时 $S_{ij}=0$，因此因为 $n  m$，所以 $S_{nm} = 0$。\n因此，对于 $m  n$，$S_{mn}$ 的表达式简化为：\n$$ S_{mn} = 1 - (-1)^{m+n} \\quad \\text{对于 } m  n $$\n我们可以进一步分析这个表达式：\n- 如果 $m$ 和 $n$ 具有相同的奇偶性（即，都是偶数或都是奇数），那么它们的和 $m+n$ 是偶数。在这种情况下，$S_{mn} = 1 - (-1)^{\\text{偶数}} = 1 - 1 = 0$。\n- 如果 $m$ 和 $n$ 具有相反的奇偶性（即，一个是偶数，一个是奇数），那么它们的和 $m+n$ 是奇数。在这种情况下，$S_{mn} = 1 - (-1)^{\\text{奇数}} = 1 - (-1) = 2$。\n$m+n$ 的奇偶性与 $m-n$ 的奇偶性相同。所以，对于 $m  n$，$S_{mn}$ 在 $m-n$ 为奇数时为 $2$，在 $m-n$ 为偶数时为 $0$。\n\n我们可以使用亥维赛阶跃函数 $H(k)$（定义为对于整数 $k \\ge 1$ 时 $H(k)=1$，对于整数 $k \\le 0$ 时 $H(k)=0$）将这些结果合并成一个单一的闭式表达式。对于非负整数 $m, n$，$m>n$ 的条件等价于 $m-n \\ge 1$，因此该条件的指示函数是 $H(m-n)$。非零项的条件是 $m-n$ 为奇数，这可以通过因子 $(1 - (-1)^{m-n})$ 来体现。\n这就给出了 $S_{mn}$ 的最终表达式：\n$$ S_{mn} = H(m-n) \\left( 1 - (-1)^{m-n} \\right) $$\n\n现在，我们来解释 $S$ 的作用和结构。\n在 DG 方法中，函数 $u(\\xi)$ 被近似为一个多项式 $u_h(\\xi) = \\sum_{n=0}^{p} \\hat{u}_n \\phi_n(\\xi)$，其中 $\\{\\hat{u}_n\\}$ 是模态系数。其导数为 $u_h'(\\xi) = \\sum_{n=0}^{p} \\hat{u}_n \\phi_n'(\\xi)$。为了在同一基中表示这个导数，我们将其投影回去，寻找系数 $\\{\\widehat{u'}_m\\}$ 使得 $u_h' \\approx \\sum_{m=0}^{p} \\widehat{u'}_m \\phi_m(\\xi)$。伽辽金投影给出了以下方程组：\n$$ \\sum_{m=0}^{p} \\widehat{u'}_m \\int_{-1}^1 \\phi_m(\\xi) \\phi_j(\\xi) d\\xi = \\sum_{n=0}^{p} \\hat{u}_n \\int_{-1}^1 \\phi_n'(\\xi) \\phi_j(\\xi) d\\xi $$\n写成矩阵形式为 $M\\widehat{\\mathbf{u'}} = S^T \\mathbf{\\hat{u}}$，其中 $M$ 是质量矩阵，其元素为 $M_{jm} = \\int_{-1}^1 \\phi_j \\phi_m d\\xi = \\frac{2}{2j+1}\\delta_{jm}$，$\\mathbf{\\hat{u}}$ 是 $u_h$ 的系数向量，$\\widehat{\\mathbf{u'}}$ 是其导数的系数向量。因此，刚度矩阵 $S$（或者更确切地说是其转置 $S^T$）将一个函数的系数映射到其弱导数的系数，然后通过（对角）质量矩阵的逆进行归一化。所以，$S$ 是模态基中弱微分算子的积分核。\n\n$S$ 的结构揭示了微分算子的性质。\n- **稀疏性**：矩阵 $S$ 是严格下三角的。此外，下三角部分中有一半的元素也为零。具体来说，$S_{mn} \\neq 0$ 仅当 $m  n$ 且 $m-n$ 为奇数时成立。这种非零元素的棋盘格模式意味着，对于一个 $p$ 阶多项式，非零元素的数量约为 $\\frac{1}{4}(p+1)^2$。虽然它不是带状矩阵意义上的稀疏，但其大部分元素都为零。\n- **奇偶耦合结构**：$S_{mn} \\neq 0$ 仅当 $m$ 和 $n$ 具有相反奇偶性时成立的条件，反映了对对称函数求导的一个基本性质。勒让德多项式 $P_k(\\xi)$ 具有确定的奇偶性：$P_k(-\\xi) = (-1)^k P_k(\\xi)$，因此当 $k$ 为偶数时 $P_k$ 是偶函数，当 $k$ 为奇数时是奇函数。偶函数的导数是奇函数，奇函数的导数是偶函数。因此，导数 $P_m'(\\xi)$ 的模态展开只包含与 $P_m(\\xi)$ 奇偶性相反的基函数 $P_n(\\xi)$。这意味着 $m$ 和 $n$ 必须具有相反的奇偶性。因此，矩阵 $S$ 将偶数索引基函数的系数与奇数索引基函数的系数耦合起来，反之亦然。这就是奇偶耦合结构。如果基向量按奇偶性重新排序，矩阵 $S^T$（作用于系数向量）将呈现分块反对角形式。", "answer": "$$ \\boxed{S_{mn} = H(m-n) \\left( 1 - (-1)^{m-n} \\right)} $$", "id": "3424476"}, {"introduction": "理论上的算子结构差异，会直接影响数值格式模拟物理现象（如波传播）的性能。本节的最终实践是一个计算实验，旨在量化和比较模态基与节点基在波传播问题上的表现。通过分析数值波在网格中的传播特性，我们将测量由不同基函数选择所引入的色散误差（相位误差）和耗散误差（振幅误差），从而为评估它们的优劣提供清晰、可量化的依据。[@problem_id:3424500]", "problem": "考虑一维线性平流方程 $u_t + a u_x = 0$，其中平流速度 $a  0$ 为常数，定义在一个周期性域上。该域被划分为一个由大小为 $h$ 的单元组成的均匀网格。使用间断 Galerkin (DG) 方法，在每个单元上用 $p$ 次多项式逼近 $u$，并在界面处采用迎风数值通量。比较表示局部多项式空间的两种基：模态基（标准正交 Legendre 多项式）和节点基（Gauss-Lobatto-Legendre (GLL) 节点上的 Lagrange 多项式）。在半离散（时间连续，空间离散）的框架下进行。\n\n从单个单元上的 DG 方法的弱形式出发，该单元通过 $x = x_j + (h/2)\\xi$ 从物理区间 $[x_{j-1/2}, x_{j+1/2}]$ 映射到参考区间 $[-1,1]$，其中 $x_j$ 是单元中心，$\\xi \\in [-1,1]$。令 $\\{\\phi_i(\\xi)\\}_{i=0}^p$ 表示参考单元上的模态或节点基函数，令 $u_j(\\xi,t) = \\sum_{i=0}^p u_{j,i}(t) \\phi_i(\\xi)$ 为局部展开式。定义参考质量矩阵 $M_{\\text{ref}}$ 和参考刚度矩阵 $S_{\\text{ref}}$ 为\n$$\n(M_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i(\\xi)\\,\\phi_k(\\xi)\\,d\\xi,\\qquad\n(S_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i'(\\xi)\\,\\phi_k(\\xi)\\,d\\xi,\n$$\n并定义边界求值向量 $b_- \\in \\mathbb{R}^{p+1}$ 和 $b_+ \\in \\mathbb{R}^{p+1}$ 为 $b_{\\pm,i} = \\phi_i(\\pm 1)$，以及相关的边界双线性形式\n$$\nB_R = b_+\\,b_+^\\top,\\qquad B_L = b_-\\,b_+^\\top.\n$$\n对于 $a0$（向右流动）并使用迎风通量，半离散单元算子可以写成以下形式\n$$\n\\frac{h}{a}\\,\\dot{\\boldsymbol{u}}_j = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R\\right)\\boldsymbol{u}_j - 2\\,M_{\\text{ref}}^{-1}B_L\\,\\boldsymbol{u}_{j-1},\n$$\n其中 $\\boldsymbol{u}_j \\in \\mathbb{R}^{p+1}$ 汇集了单元 $j$ 上的自由度。\n\n在均匀周期网格上，通过假设一个形式为 $\\boldsymbol{u}_j(t) = \\boldsymbol{v}\\,e^{\\lambda t} e^{\\mathrm{i}\\theta j}$ 的模态来进行 Fourier (Bloch) 分析，其中 $\\theta \\in \\mathbb{R}$ 是无量纲波数（角度），单位为弧度，并定义无量纲特征值\n$$\n\\mu(\\theta) = \\frac{h}{a}\\,\\lambda(\\theta).\n$$\n证明 $\\mu(\\theta)$ 由 $(p+1)\\times(p+1)$ Fourier 符号矩阵的特征值给出\n$$\n\\mathcal{G}(\\theta) = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R - e^{-\\mathrm{i}\\theta} B_L\\right).\n$$\n对于每种基（模态或节点），构造 $\\mathcal{G}(\\theta)$ 并计算其在给定的 $(p,\\theta)$ 对上的特征值。在每种情况下，将虚部最接近 $-\\theta$ 的特征值确定为主分支特征值 $\\mu_\\star(\\theta)$（$u_t + a u_x = 0$ 的精确连续色散关系为 $\\lambda_{\\text{exact}} = -\\mathrm{i} a k$，因此无量纲形式为 $\\mu_{\\text{exact}} = -\\mathrm{i}\\theta$）。将色散误差和数值耗散量化为：\n- 色散误差：$\\mathrm{Im}(\\mu_\\star(\\theta)) + \\theta$，\n- 耗散：$\\mathrm{Re}(\\mu_\\star(\\theta))$。\n\n此外，通过以下方式量化在相同 $(p,\\theta)$ 下模态和节点算子特征结构之间的差异：\n- 主特征值差异：$\\left|\\mu_{\\star,\\text{modal}}(\\theta) - \\mu_{\\star,\\text{nodal}}(\\theta)\\right|$，\n- 特征值集合之间的双向 Hausdorff 距离：两个有向距离中的最大值，其中从集合 $A$ 到集合 $B$ 的有向距离为 $\\max_{\\alpha\\in A}\\min_{\\beta\\in B}|\\alpha-\\beta|$。\n\n按照以下方式从第一性原理严格实现所有构造：\n- 对于模态基，使用 $[-1,1]$ 上的标准正交 Legendre 多项式，即 $\\phi_n(\\xi) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(\\xi)$，其中 $P_n$ 是第 $n$ 个 Legendre 多项式。对于积分，使用足够高阶的 Gauss-Legendre 求积法来精确计算 $S_{\\text{ref}}$。使用 $M_{\\text{ref}} = I$。\n- 对于节点基，使用 $N=p+1$ 个 Gauss-Lobatto-Legendre 节点上的 Lagrange 多项式及其相关的求积权重，体积积分由 GLL 求积法近似，质量矩阵为对角矩阵 $M_{\\text{ref}} = \\mathrm{diag}(w_0,\\dots,w_p)$。使用节点基所隐含的精确边界求值 $\\phi_i(\\pm 1)$。\n\n你的程序必须为下面测试套件中的每个测试用例 $(p,\\theta)$ 计算六个量：\n1. 模态基中的色散误差，\n2. 模态基中的耗散，\n3. 节点基中的色散误差，\n4. 节点基中的耗散，\n5. 模态基和节点基之间的主特征值差异，\n6. 完整特征值集合之间的双向 Hausdorff 距离。\n\n角度以弧度为单位提供和解释。最终输出不需要物理单位，因为所有量都是无量纲的。\n\n测试套件：\n- $(p,\\theta) = (1, 10^{-6})$,\n- $(p,\\theta) = (3, \\pi/4)$,\n- $(p,\\theta) = (4, 0.9\\pi)$,\n- $(p,\\theta) = (2, \\pi/2)$.\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例对应一个子列表，包含按上述顺序排列的六个浮点数。例如，输出格式应完全如下所示：\n$[ [r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}, r_{1,5}, r_{1,6}], [r_{2,1}, r_{2,2}, r_{2,3}, r_{2,4}, r_{2,5}, r_{2,6}], \\dots ]$。", "solution": "用户在偏微分方程数值分析领域提供了一个定义明确的问题。该问题具有科学依据，形式规范，并要求实现已有的数值方法。不存在矛盾、歧义或不合理的假设。因此，该问题是有效的。\n\n### 第 1 步：已知条件提取\n\n问题陈述提供了以下数据和定义：\n1.  **控制方程**：一维线性平流方程 $u_t + a u_x = 0$，其中平流速度 $a  0$ 为常数。\n2.  **域和网格**：周期性域，具有大小为 $h$ 的单元组成的均匀网格。\n3.  **数值方法**：间断 Galerkin (DG) 方法，使用 $p$ 次局部多项式逼近。\n4.  **数值通量**：迎风通量。\n5.  **局部基**：\n    -   模态：$[-1,1]$ 上的标准正交 Legendre 多项式，$\\phi_n(\\xi) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(\\xi)$。\n    -   节点：$[-1,1]$ 上 $p+1$ 个 Gauss-Lobatto-Legendre (GLL) 节点上的 Lagrange 多项式。\n6.  **坐标映射**：对于 $\\xi \\in [-1,1]$，有 $x = x_j + (h/2)\\xi$。\n7.  **局部解展开**：$u_j(\\xi,t) = \\sum_{i=0}^p u_{j,i}(t) \\phi_i(\\xi)$。\n8.  **参考矩阵和向量**：\n    -   质量矩阵：$(M_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i(\\xi)\\,\\phi_k(\\xi)\\,d\\xi$。\n    -   刚度矩阵：$(S_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i'(\\xi)\\,\\phi_k(\\xi)\\,d\\xi$。\n    -   边界向量：$b_{\\pm,i} = \\phi_i(\\pm 1)$。\n    -   边界双线性形式：$B_R = b_+\\,b_+^\\top$, $B_L = b_-\\,b_+^\\top$。\n9.  **半离散系统**：单元 $j$ 上自由度 $\\boldsymbol{u}_j$ 的演化由下式给出\n    $$\n    \\frac{h}{a}\\,\\dot{\\boldsymbol{u}}_j = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R\\right)\\boldsymbol{u}_j - 2\\,M_{\\text{ref}}^{-1}B_L\\,\\boldsymbol{u}_{j-1}.\n    $$\n10. **Fourier 分析**：\n    -   Ansatz：$\\boldsymbol{u}_j(t) = \\boldsymbol{v}\\,e^{\\lambda t} e^{\\mathrm{i}\\theta j}$，其中 $\\theta$ 是无量纲波数。\n    -   无量纲特征值：$\\mu(\\theta) = \\frac{h}{a}\\,\\lambda(\\theta)$。\n    -   Fourier 符号矩阵：$\\mathcal{G}(\\theta) = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R - e^{-\\mathrm{i}\\theta} B_L\\right)$。值 $\\mu(\\theta)$ 是 $\\mathcal{G}(\\theta)$ 的特征值。\n11. **分析量**：\n    -   主特征值 $\\mu_\\star(\\theta)$：虚部最接近 $-\\theta$ 的特征值。\n    -   色散误差：$\\mathrm{Im}(\\mu_\\star(\\theta)) + \\theta$。\n    -   耗散：$\\mathrm{Re}(\\mu_\\star(\\theta))$。\n    -   主特征值差异：$|\\mu_{\\star,\\text{modal}}(\\theta) - \\mu_{\\star,\\text{nodal}}(\\theta)|$。\n    -   双向 Hausdorff 距离：模态和节点特征值集合之间的两个有向距离的最大值。\n12. **特定基的实现**：\n    -   模态：$M_{\\text{ref}} = I$。$S_{\\text{ref}}$ 使用足够高阶的 Gauss-Legendre 求积法精确计算。\n    -   节点：$M_{\\text{ref}}$ 是来自 GLL 求积的对角质量矩阵，$M_{\\text{ref}} = \\mathrm{diag}(w_0,\\dots,w_p)$。积分由 GLL 求积法近似。\n13. **测试套件**：\n    -   $(p,\\theta) = (1, 10^{-6})$\n    -   $(p,\\theta) = (3, \\pi/4)$\n    -   $(p,\\theta) = (4, 0.9\\pi)$\n    -   $(p,\\theta) = (2, \\pi/2)$\n\n### 第 2 步：问题验证\n\n该问题是 DG 方法数值分析中的一个标准练习。所有组成部分都在既定的数学框架内有明确定义。\n-   **科学依据和客观性**：该问题基于偏微分方程数值方法的数学理论。DG 方法、基函数、Fourier 稳定性分析、色散和耗散等概念都是标准的、客观的。\n-   **适定性和完整性**：该问题提供了构造所需矩阵和执行分析所需的所有必要方程、定义和数据。任务具体，并导向一组唯一的可计算数值。其表述是自洽的。\n-   **无缺陷**：该问题不违反任何科学原理，不基于错误的前提，是可形式化的，并且计算上是可行的。这是一个需要仔细实现多个数值组件的非平凡问题。\n\n### 第 3 步：结论与行动\n\n问题陈述是 **有效** 的。将通过实现指定的构造来提供解决方案。\n\n### 方法与实现\n\n解决方案涉及为每个给定的 $(p, \\theta)$ 对，针对模态基和节点基构造 Fourier 符号矩阵 $\\mathcal{G}(\\theta)$。这需要以下步骤：\n\n**A. 模态基构造 ($\\phi_n(\\xi) = \\sqrt{(2n+1)/2} P_n(\\xi)$)**\n1.  **质量矩阵 ($M_{\\text{ref}}$)**：由于基的标准正交性，$M_{\\text{ref}}$ 是大小为 $(p+1) \\times (p+1)$ 的单位矩阵 $I$。\n2.  **刚度矩阵 ($S_{\\text{ref}}$)**：矩阵元素为 $(S_{\\text{ref}})_{ik} = \\int_{-1}^{1} \\phi_i'(\\xi)\\phi_k(\\xi)d\\xi$。被积函数 $\\phi_i'(\\xi)\\phi_k(\\xi)$ 是一个次数为 $(i-1)+k$ 的多项式。对于 $i,k \\in \\{0, \\dots, p\\}$，最大次数为 $2p-1$。具有 $N_q$ 个点的 Gauss-Legendre 求积法对于次数最高为 $2N_q-1$ 的多项式是精确的。因此，我们需要 $N_q \\ge p$。为保证稳健性，我们将使用 $N_q = p+2$ 个点。积分通过计算被积函数在求积节点上的值的加权和来求得。\n3.  **边界向量 ($b_{\\pm}$)**：矩阵元素为 $b_{\\pm,i} = \\phi_i(\\pm 1)$。由于 $P_i(1)=1$ 和 $P_i(-1)=(-1)^i$，这些值可以很容易地计算为 $b_{+,i} = \\sqrt{(2i+1)/2}$ 和 $b_{-,i} = (-1)^i \\sqrt{(2i+1)/2}$。\n4.  **边界矩阵**：$B_R$ 和 $B_L$ 分别由外积 $b_+ b_+^T$ 和 $b_- b_+^T$ 形成。\n\n**B. 节点基构造 (GLL 节点上的 Lagrange 多项式 $\\ell_i(\\xi_j) = \\delta_{ij}$)**\n1.  **GLL 节点和权重**：对于给定的次数 $p$，$p+1$ 个 GLL 节点 $\\{\\xi_j\\}_{j=0}^p$ 是 $(1-\\xi^2)P_p'(\\xi)=0$ 的根。这些节点包括 $\\xi_0 = -1$，$\\xi_p=1$，以及 $P_p'(\\xi)$ 的 $p-1$ 个根，这些根也是 Jacobi 多项式 $P_{p-1}^{(1,1)}(\\xi)$ 的根。相应的权重 $\\{w_j\\}_{j=0}^p$ 由公式 $w_j = \\frac{2}{p(p+1)[P_p(\\xi_j)]^2}$ 给出。\n2.  **质量矩阵 ($M_{\\text{ref}}$)**：对质量矩阵积分使用 GLL 求积法会得到一个对角（“集总”）质量矩阵，其对角线上是求积权重：$M_{\\text{ref}} = \\mathrm{diag}(w_0, \\dots, w_p)$。\n3.  **刚度矩阵 ($S_{\\text{ref}}$)**：将 GLL 求积法应用于刚度矩阵积分，得到 $(S_{\\text{ref}})_{ik} = \\int \\phi_i' \\phi_k d\\xi \\approx \\sum_j w_j \\phi_i'(\\xi_j) \\phi_k(\\xi_j) = w_k \\phi_i'(\\xi_k)$。令 $D$ 为微分矩阵，其中 $D_{ki} = \\phi_i'(\\xi_k)$（第 $i$ 个基函数在第 $k$ 个节点上的导数）。则 $(S_{\\text{ref}})_{ik} = w_k D_{ki}$。用矩阵表示，即为 $S_{\\text{ref}} = (D^T W)$，其中 $W=\\mathrm{diag}(w_0, \\dots, w_p)$。微分矩阵 $D$ 可以通过其已知的涉及 Legendre 多项式的解析公式构造。\n4.  **边界向量 ($b_{\\pm}$)**：由于 $\\xi_0=-1$ 和 $\\xi_p=1$，基的性质 $\\phi_i(\\xi_j)=\\delta_{ij}$ 直接给出 $b_{+,i} = \\phi_i(1) = \\phi_i(\\xi_p) = \\delta_{ip}$ 和 $b_{-,i} = \\phi_i(-1) = \\phi_i(\\xi_0) = \\delta_{i0}$。因此，$b_+$ 是最后一个标准基向量，$b_-$ 是第一个。\n5.  **边界矩阵**：$B_R = e_p e_p^T$ 和 $B_L = e_0 e_p^T$。\n\n**C. 分析**\n对于每种基，一旦构造了 $M_{\\text{ref}}$、$S_{\\text{ref}}$、$B_R$ 和 $B_L$：\n1.  组装 Fourier 符号矩阵 $\\mathcal{G}(\\theta)$。\n2.  使用标准数值库函数计算其特征值 $\\mu(\\theta)$。\n3.  通过找到虚部最接近精确无量纲色散关系 $-\\theta$ 的特征值，来确定主特征值 $\\mu_\\star$。\n4.  根据计算出的特征值，计算所要求的六个指标（两种基的色散误差、耗散，主特征值差异以及 Hausdorff 距离）。", "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_jacobi, legendre\n\ndef get_modal_matrices(p):\n    \"\"\"\n    Constructs matrices for the modal basis (orthonormal Legendre polynomials).\n    \"\"\"\n    # Orthonormal Legendre polynomials: phi_n(x) = sqrt((2n+1)/2) * P_n(x)\n    # Mass matrix M_ref is the identity matrix due to orthonormality.\n    M_ref = np.identity(p + 1)\n    \n    # Stiffness matrix S_ref: (S_ref)_ik = integral(phi_i' * phi_k) dx\n    # We use high-order Gauss-Legendre quadrature for exact integration.\n    # Integrand phi_i' * phi_k is a polynomial of degree (i-1) + k.\n    # Max degree is (p-1) + p = 2p-1. We need n_quad points such that 2*n_quad - 1 = 2p - 1.\n    # Using p+2 points is sufficient.\n    n_quad = p + 2\n    xi_q, w_q = np.polynomial.legendre.leggauss(n_quad)\n    \n    S_ref = np.zeros((p + 1, p + 1))\n    \n    phi_vals = np.zeros((p + 1, n_quad))\n    phi_deriv_vals = np.zeros((p + 1, n_quad))\n    \n    for i in range(p + 1):\n        P_i = legendre(i)\n        P_i_deriv = P_i.deriv(1)\n        c_i = np.sqrt((2 * i + 1) / 2.0)\n        phi_vals[i, :] = c_i * P_i(xi_q)\n        phi_deriv_vals[i, :] = c_i * P_i_deriv(xi_q)\n\n    # Compute S_ref using quadrature\n    for i in range(p + 1):\n        for k in range(p + 1):\n            integrand = phi_deriv_vals[i, :] * phi_vals[k, :]\n            S_ref[i, k] = np.sum(w_q * integrand)\n\n    # Boundary vectors b_plus and b_minus\n    b_plus = np.array([np.sqrt((2 * i + 1) / 2.0) for i in range(p + 1)])\n    b_minus = np.array([np.sqrt((2 * i + 1) / 2.0) * (-1)**i for i in range(p + 1)])\n\n    B_R = np.outer(b_plus, b_plus)\n    B_L = np.outer(b_minus, b_plus)\n    \n    return M_ref, S_ref, B_R, B_L\n\ndef get_gll_nodes_weights(p):\n    \"\"\"\n    Computes Gauss-Lobatto-Legendre nodes and weights for degree p.\n    \"\"\"\n    if p == 0:\n        return np.array([0.0]), np.array([2.0])\n    if p == 1:\n        return np.array([-1.0, 1.0]), np.array([1.0, 1.0])\n        \n    interior_nodes = roots_jacobi(p - 1, 1, 1)[0]\n    nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n    \n    P_p = legendre(p)\n    weights = 2.0 / (p * (p + 1) * P_p(nodes)**2)\n    \n    return nodes, weights\n\ndef get_differentiation_matrix(p, nodes):\n    \"\"\"\n    Computes the differentiation matrix for Lagrange basis at GLL nodes.\n    D_ij = phi_j'(xi_i)\n    \"\"\"\n    N = p + 1\n    D = np.zeros((N, N))\n    P_p = legendre(p)\n    \n    for i in range(N):\n        for j in range(N):\n            if i == j:\n                if i == 0:\n                    D[i, j] = -p * (p + 1) / 4.0\n                elif i == p:\n                    D[i, j] = p * (p + 1) / 4.0\n                else:\n                    D[i, j] = 0.0\n            else:\n                D[i, j] = P_p(nodes[i]) / (P_p(nodes[j]) * (nodes[i] - nodes[j]))\n    return D\n\ndef get_nodal_matrices(p):\n    \"\"\"\n    Constructs matrices for the nodal basis (Lagrange at GLL nodes).\n    \"\"\"\n    nodes, weights = get_gll_nodes_weights(p)\n    \n    M_ref = np.diag(weights)\n    \n    D = get_differentiation_matrix(p, nodes) # D_ij = phi_j'(xi_i)\n    \n    # S_ref_ik = integral(phi_i' phi_k) approx sum_j w_j phi_i'(xi_j) phi_k(xi_j)\n    # = w_k phi_i'(xi_k) = w_k D_ki\n    # In matrix form: S_ref = (D.T @ W), where W=diag(weights)\n    S_ref = D.T @ np.diag(weights)\n    \n    B_R = np.zeros((p + 1, p + 1))\n    B_R[p, p] = 1.0\n    \n    B_L = np.zeros((p + 1, p + 1))\n    B_L[0, p] = 1.0\n    \n    return M_ref, S_ref, B_R, B_L\n\ndef bidirectional_hausdorff(A, B):\n    \"\"\"\n    Calculates the bidirectional Hausdorff distance between two sets of numbers.\n    \"\"\"\n    # Reshape for broadcasting\n    A_col = A[:, np.newaxis]\n    B_row = B[np.newaxis, :]\n    \n    dist_mat_abs = np.abs(A_col - B_row)\n    \n    d_A_to_B = np.max(np.min(dist_mat_abs, axis=1))\n    d_B_to_A = np.max(np.min(dist_mat_abs, axis=0))\n    \n    return max(d_A_to_B, d_B_to_A)\n\ndef analyze_basis(p, theta, basis_type):\n    if basis_type == 'modal':\n        M_ref, S_ref, B_R, B_L = get_modal_matrices(p)\n    elif basis_type == 'nodal':\n        M_ref, S_ref, B_R, B_L = get_nodal_matrices(p)\n    else:\n        raise ValueError(\"Unknown basis type\")\n\n    M_inv = np.linalg.inv(M_ref)\n    \n    G = 2 * M_inv @ (-S_ref + B_R - np.exp(-1j * theta) * B_L)\n    \n    eigenvalues = np.linalg.eigvals(G)\n    \n    idx = np.argmin(np.abs(np.imag(eigenvalues) + theta))\n    mu_star = eigenvalues[idx]\n    \n    dispersion_error = np.imag(mu_star) + theta\n    dissipation = np.real(mu_star)\n    \n    return dispersion_error, dissipation, mu_star, eigenvalues\n\ndef solve():\n    test_cases = [\n        (1, 1e-6),\n        (3, np.pi/4),\n        (4, 0.9*np.pi),\n        (2, np.pi/2),\n    ]\n\n    results = []\n    for p, theta in test_cases:\n        disp_err_modal, diss_modal, mu_star_modal, eig_modal = analyze_basis(p, theta, 'modal')\n        disp_err_nodal, diss_nodal, mu_star_nodal, eig_nodal = analyze_basis(p, theta, 'nodal')\n        \n        principal_eig_diff = np.abs(mu_star_modal - mu_star_nodal)\n        hausdorff_dist = bidirectional_hausdorff(eig_modal, eig_nodal)\n        \n        case_results = [\n            disp_err_modal,\n            diss_modal,\n            disp_err_nodal,\n            diss_nodal,\n            principal_eig_diff,\n            hausdorff_dist\n        ]\n        results.append(case_results)\n\n    # Format output as a list of lists strings\n    formatted_results = []\n    for case_res in results:\n        formatted_results.append(f\"[{', '.join(f'{x:.15e}' for x in case_res)}]\")\n    \n    print(f\"[{', '.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3424500"}]}