{"hands_on_practices": [{"introduction": "在求解偏微分方程时，一种强大的技术是“线方法”（Method of Lines），它将空间和时间维度解耦。我们首先对空间进行离散，将偏微分方程（PDE）转化为一个大型的常微分方程（ODE）组，然后使用ODE求解器进行时间积分。然而，空间离散格式的选择会深刻影响ODE系统的性质，从而决定了哪些时间积分方案是可行的。这个练习 [@problem_id:3389318] 将引导您探索一个经典的组合：用中心差分格式离散平流方程，并尝试用最简单的显式方法——前向欧拉法——来求解。通过分析这个半离散系统的特征值，您将亲手揭示为何这种看似自然的选择会导致数值上的灾难。", "problem": "考虑一维线性平流偏微分方程（PDE）$u_{t} + a\\,u_{x} = 0$，其中平流速度 $a \\in \\mathbb{R}$ 为常数，定义在长度为 $L  0$ 的周期性区域上。设该区域被一个包含 $N \\in \\mathbb{N}$ 个点、间距为 $\\Delta x = L/N$ 的均匀网格离散化，并令 $U(t) \\in \\mathbb{C}^{N}$ 收集时间 $t$ 的节点值。空间导数的中心差分近似由循环矩阵 $D_{0} \\in \\mathbb{R}^{N \\times N}$ 定义，该矩阵对应于具有周期性环绕的模板 $\\left(-\\tfrac{1}{2\\Delta x},\\,0,\\,\\tfrac{1}{2\\Delta x}\\right)$。因此，半离散线方法系统为 $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$。\n\n仅利用以下基本事实：(i) 循环矩阵可由离散傅里叶基对角化；(ii) 对于网格波数 $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$，离散傅里叶模态为 $\\varphi^{(\\theta)}_{j} = \\exp(i\\,j\\,\\theta)$（其中 $j \\in \\{0,1,\\dots,N-1\\}$），完成以下任务：\n\n1. 从第一性原理出发，推导半离散算子 $-a\\,D_{0}$ 的特征值 $\\lambda(\\theta)$，将其表示为 $a$、$\\Delta x$ 和 $\\theta$ 的显式函数。\n\n2. 考虑将时间步长为 $\\Delta t  0$ 的前向欧拉（FE）时间积分器应用于半离散系统，即 $U^{n+1} = U^{n} + \\Delta t\\,(-a\\,D_{0}\\,U^{n})$。利用您推导出的特征值，从第一性原理出发解释为何对于周期性网格上的平流问题的这种空间离散化，前向欧拉方法是无条件不稳定的。\n\n请给出您在第 1 项中找到的 $\\lambda(\\theta)$ 关于 $a$、$\\Delta x$ 和 $\\theta$ 的闭式表达式作为最终答案。无需进行数值计算，也无需四舍五入。", "solution": "我们从半离散线方法系统 $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$ 开始，其中 $D_{0}$ 是实现带有周期性边界条件的一阶导数中心差分近似的循环矩阵。离散傅里叶模态构成了循环矩阵的一个特征基。具体来说，对于每个网格波数 $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$，分量为 $\\varphi^{(\\theta)}_{j} = \\exp(i\\,j\\,\\theta)$ 的向量 $\\varphi^{(\\theta)} \\in \\mathbb{C}^{N}$ 是任何循环矩阵的特征向量，其相关特征值通过将模板符号应用于此模态得到。\n\n对于带有模板 $\\left(-\\tfrac{1}{2\\Delta x},\\,0,\\,\\tfrac{1}{2\\Delta x}\\right)$ 的中心差分导数算子 $D_{0}$，我们计算其在离散傅里叶模态上的作用。对于一个固定的 $\\theta$，$D_{0}\\,\\varphi^{(\\theta)}$ 的第 $j$ 个分量是\n\n$$\n\\left(D_{0}\\,\\varphi^{(\\theta)}\\right)_{j} \\;=\\; \\frac{1}{2\\Delta x}\\left(\\varphi^{(\\theta)}_{j+1} - \\varphi^{(\\theta)}_{j-1}\\right)\n\\;=\\; \\frac{1}{2\\Delta x}\\left(\\exp(i\\,(j+1)\\,\\theta) - \\exp(i\\,(j-1)\\,\\theta)\\right).\n$$\n\n提出因子 $\\exp(i\\,j\\,\\theta)$ 可得\n\n$$\n\\left(D_{0}\\,\\varphi^{(\\theta)}\\right)_{j}\n= \\exp(i\\,j\\,\\theta)\\,\\frac{1}{2\\Delta x}\\left(\\exp(i\\,\\theta) - \\exp(-i\\,\\theta)\\right)\n= \\exp(i\\,j\\,\\theta)\\,\\frac{i}{\\Delta x}\\,\\sin(\\theta).\n$$\n\n因此，$\\varphi^{(\\theta)}$ 是 $D_{0}$ 的一个特征向量，其特征值为\n\n$$\n\\mu(\\theta) \\;=\\; \\frac{i}{\\Delta x}\\,\\sin(\\theta).\n$$\n\n因此，半离散算子 $-a\\,D_{0}$ 的特征值为\n\n$$\n\\lambda(\\theta) \\;=\\; -a\\,\\mu(\\theta) \\;=\\; -\\,i\\,\\frac{a}{\\Delta x}\\,\\sin(\\theta),\n$$\n\n对于每个 $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$。这些特征值是纯虚数，即对于每个 $\\theta$，都有 $\\lambda(\\theta) \\in i\\,\\mathbb{R}$。\n\n接下来，考虑将前向欧拉（FE）时间积分器应用于 $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$。对于线性测试问题 $y^{\\prime} = \\lambda\\,y$，前向欧拉的更新公式为 $y^{n+1} = (1 + \\Delta t\\,\\lambda)\\,y^{n}$，因此放大因子为 $R(z) = 1 + z$，其中 $z = \\Delta t\\,\\lambda$。给定模态的稳定性要求 $|1 + \\Delta t\\,\\lambda(\\theta)| \\leq 1$。\n\n代入 $\\lambda(\\theta) = -\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)$：\n\n$$\n1 + \\Delta t\\,\\lambda(\\theta) \\;=\\; 1 - i\\,\\frac{a\\,\\Delta t}{\\Delta x}\\,\\sin(\\theta).\n$$\n\n其模为\n\n$$\n\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right|\n= \\sqrt{1 + \\left(\\frac{a\\,\\Delta t}{\\Delta x}\\right)^{2}\\,\\sin^{2}(\\theta)}.\n$$\n\n对于任何 $\\Delta t  0$ 以及任何满足 $\\sin(\\theta) \\neq 0$ 的波数，我们有 $\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right|  1$。唯一满足 $\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right| = 1$ 的模态是那些 $\\sin(\\theta) = 0$ 的模态，即 $\\theta \\in \\{0, \\pi\\}$（模 $2\\pi$），这对应于常数模态和奈奎斯特模态。因此，不存在任何 $\\Delta t  0$ 能使所有模态都非放大，因为对于任何这样的 $\\Delta t$，总存在一些模态满足 $\\sin(\\theta) \\neq 0$，其放大因子的模大于 1。\n\n等价地，前向欧拉的绝对稳定域 $\\{z \\in \\mathbb{C} : |1 + z| \\leq 1\\}$ 不包含任何非零的纯虚数 $z = i\\,y$，因为对于所有 $y \\neq 0$，有 $|1 + i\\,y| = \\sqrt{1 + y^{2}}  1$。由于 $-a\\,D_{0}$ 的半离散谱除了可能在原点外都是纯虚数，因此对于周期性网格上的平流问题的这种中心差分空间离散化，前向欧拉方法是无条件不稳定的。\n\n因此，所要求的半离散特征值的闭式表达式为 $\\lambda(\\theta) = -\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)$。", "answer": "$$\\boxed{-\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)}$$", "id": "3389318"}, {"introduction": "前一个练习揭示了，对于具有纯虚数特征值的半离散系统（如中心差分格式下的平流方程），前向欧拉法是无条件不稳定的。这促使我们寻找更优秀的时间积分方案，比如经典的四阶龙格-库塔（RK4）方法。为了从根本上理解RK4为何更强大，我们需要一个量化其稳定性的工具，这就是“稳定函数” $R(z)$。本练习 [@problem_id:3389392] 将指导您为RK4方法推导出其稳定函数，并分析其在负实轴上的稳定区间。这个过程是理解和比较不同显式时间积分格式稳定性的核心技能。", "problem": "考虑一个由扩散型偏微分方程（PDE）的直线法产生的线性自治半离散系统：$\\,\\frac{d \\boldsymbol{u}}{dt} = \\boldsymbol{L} \\boldsymbol{u}\\,$，其中 $\\,\\boldsymbol{L}\\,$ 是一个常数矩阵，其谱满足对于 $\\,\\boldsymbol{L}\\,$ 的每一个特征值 $\\,\\lambda\\,$，都有 $\\,\\operatorname{Re}(\\lambda) \\le 0\\,$。时间积分通过经典的显式 $\\,4\\,$ 级龙格－库塔（RK）方法进行，通常记为 RK$\\,4$。对于半离散系统，显式单步法的线性绝对稳定性是通过将该方法应用于线性测试常微分方程（ODE）$\\,y'=\\lambda y\\,$，并将更新形式写成 $\\,y_{n+1} = R(z)\\,y_n\\,$（其中 $\\,z=\\Delta t\\,\\lambda\\,$）来评估的。这里 $\\,R(z)\\,$ 称为稳定性函数，$\\,\\Delta t\\,$ 是时间步长。\n\n从经典显式 RK$\\,4$ 方法的定义的 $\\,4\\,$ 级形式出发，仅使用测试 ODE $\\,y'=\\lambda y\\,$（其中 $\\,z=\\Delta t\\,\\lambda\\,$），通过显式地消去中间级来推导该方法的稳定性函数 $\\,R(z)\\,$。然后，使用绝对稳定域的定义 $\\,\\mathcal{S}=\\{z\\in\\mathbb{C}:|R(z)|\\le 1\\}\\,$，确定最大的实数 $\\,\\alpha0\\,$，使得负实轴上的区间 $\\,[-\\alpha,0]\\,$ 包含在 $\\,\\mathcal{S}\\,$ 中。\n\n报告单个数字 $\\,\\alpha\\,$，并四舍五入到 $\\,4\\,$ 位有效数字。", "solution": "**稳定性函数 $R(z)$ 的推导**\n\n经典的 $\\,4\\,$ 级显式龙格－库塔方法（RK$\\,4$）由以下适用于一般常微分方程 $y' = f(t, y)$ 的方程组定义：\n$$ k_1 = f(t_n, y_n) $$\n$$ k_2 = f(t_n + \\frac{1}{2}\\Delta t, y_n + \\frac{1}{2}\\Delta t k_1) $$\n$$ k_3 = f(t_n + \\frac{1}{2}\\Delta t, y_n + \\frac{1}{2}\\Delta t k_2) $$\n$$ k_4 = f(t_n + \\Delta t, y_n + \\Delta t k_3) $$\n$$ y_{n+1} = y_n + \\frac{\\Delta t}{6} (k_1 + 2k_2 + 2k_3 + k_4) $$\n\n为了求稳定性函数 $R(z)$，我们将此方法应用于线性测试方程 $y' = \\lambda y$，因此 $f(t, y) = \\lambda y$。令 $z = \\Delta t \\lambda$。我们通过依次代入来显式计算各级 $k_i$：\n\n1.  第一级是：\n    $$ k_1 = \\lambda y_n $$\n\n2.  第二级依赖于 $k_1$：\n    $$ k_2 = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t k_1\\right) = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t (\\lambda y_n)\\right) = \\lambda y_n \\left(1 + \\frac{1}{2}\\Delta t \\lambda\\right) = \\lambda y_n \\left(1 + \\frac{z}{2}\\right) $$\n\n3.  第三级依赖于 $k_2$：\n    $$ k_3 = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t k_2\\right) = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t \\left[\\lambda y_n \\left(1 + \\frac{z}{2}\\right)\\right]\\right) = \\lambda y_n \\left(1 + \\frac{z}{2}\\left(1 + \\frac{z}{2}\\right)\\right) = \\lambda y_n \\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right) $$\n\n4.  第四级依赖于 $k_3$：\n    $$ k_4 = \\lambda (y_n + \\Delta t k_3) = \\lambda \\left(y_n + \\Delta t \\left[\\lambda y_n \\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right)\\right]\\right) = \\lambda y_n \\left(1 + z\\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right)\\right) = \\lambda y_n \\left(1 + z + \\frac{z^2}{2} + \\frac{z^3}{4}\\right) $$\n\n现在，我们将 $k_1, k_2, k_3, k_4$ 的这些表达式代入 $y_{n+1}$ 的最终更新公式中：\n$$ y_{n+1} = y_n + \\frac{\\Delta t}{6} \\left( (\\lambda y_n) + 2\\left[\\lambda y_n \\left(1 + \\frac{z}{2}\\right)\\right] + 2\\left[\\lambda y_n \\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right)\\right] + \\left[\\lambda y_n \\left(1 + z + \\frac{z^2}{2} + \\frac{z^3}{4}\\right)\\right] \\right) $$\n提取公因子 $y_n$ 和 $\\lambda$，并使用 $z = \\Delta t \\lambda$：\n$$ y_{n+1} = y_n \\left( 1 + \\frac{\\Delta t \\lambda}{6} \\left[ 1 + 2\\left(1 + \\frac{z}{2}\\right) + 2\\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right) + \\left(1 + z + \\frac{z^2}{2} + \\frac{z^3}{4}\\right) \\right] \\right) $$\n$$ y_{n+1} = y_n \\left( 1 + \\frac{z}{6} \\left[ 1 + (2+z) + (2+z+\\frac{z^2}{2}) + (1+z+\\frac{z^2}{2}+\\frac{z^3}{4}) \\right] \\right) $$\n按 $z$ 的幂次对中括号内的项求和：\n-   常数项：$1 + 2 + 2 + 1 = 6$\n-   $z$ 的一次项：$z + z + z = 3z$\n-   $z$ 的二次项：$\\frac{z^2}{2} + \\frac{z^2}{2} = z^2$\n-   $z$ 的三次项：$\\frac{z^3}{4}$\n\n中括号内的表达式是 $6 + 3z + z^2 + \\frac{z^3}{4}$。将其代回：\n$$ y_{n+1} = y_n \\left( 1 + \\frac{z}{6} \\left( 6 + 3z + z^2 + \\frac{z^3}{4} \\right) \\right) $$\n$$ y_{n+1} = y_n \\left( 1 + z + \\frac{3z^2}{6} + \\frac{z^3}{6} + \\frac{z^4}{24} \\right) $$\n$$ y_{n+1} = y_n \\left( 1 + z + \\frac{z^2}{2} + \\frac{z^3}{6} + \\frac{z^4}{24} \\right) $$\n根据定义，$y_{n+1} = R(z) y_n$，所以稳定性函数是：\n$$ R(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!} $$\n这是 $\\exp(z)$ 的泰勒级数展开式截断到 $\\,4\\,$ 阶项的结果。\n\n**稳定区间 $[-\\alpha, 0]$ 的确定**\n\n问题要求最大的实数 $\\alpha  0$，使得区间 $[-\\alpha, 0]$ 包含在绝对稳定域 $\\mathcal{S}$ 中。对于实轴上的点 $z = x$，稳定性的条件是 $|R(x)| \\le 1$，这等价于 $-1 \\le R(x) \\le 1$。我们针对 $x \\in [-\\alpha, 0]$ 来分析这个条件。\n\n1.  **分析条件 $R(x) \\le 1$**：\n    我们需要找到满足 $1 + x + \\frac{x^2}{2} + \\frac{x^3}{6} + \\frac{x^4}{24} \\le 1$ 的范围。\n    $$ x + \\frac{x^2}{2} + \\frac{x^3}{6} + \\frac{x^4}{24} \\le 0 $$\n    $$ x \\left( 1 + \\frac{x}{2} + \\frac{x^2}{6} + \\frac{x^3}{24} \\right) \\le 0 $$\n    当 $x=0$ 时，此不等式成立。对于 $x0$，如果括号内的项非负，则该不等式成立：$P(x) = 1 + \\frac{x}{2} + \\frac{x^2}{6} + \\frac{x^3}{24} \\ge 0$。我们需要找到使此条件成立的 $x$ 的范围。当 $x$ 从 $0$ 向负方向减小时，多项式 $P(x)$ 的值会减小，直到达到其第一个负实根 $x_1$。因此，$R(x) \\le 1$ 对于 $x \\in [x_1, 0]$ 成立。\n\n2.  **分析条件 $R(x) \\ge -1$**：\n    这等价于 $R(x) + 1 \\ge 0$。\n    $$ S(x) = 2 + x + \\frac{x^2}{2} + \\frac{x^3}{6} + \\frac{x^4}{24} \\ge 0 $$\n    为了找到 $S(x)$ 的最小值，我们分析其导数：\n    $S'(x) = R'(x) = 1 + x + \\frac{x^2}{2} + \\frac{x^3}{6}$。$S'(x)$ 是一个三次多项式。可以证明，$S(x)$ 对所有实数 $x$ 都是正的。因此，条件 $R(x) \\ge -1$ 对所有实数 $x$ 都成立。\n\n因此，稳定区间仅由条件 $R(x) \\le 1$ 约束。该区间是 $[x_1, 0]$，其中 $x_1$ 是 $R(x) = 1$ 的非零负实根。区间的长度为 $\\alpha = -x_1$。\n我们需要求解 $1 + \\frac{x_1}{2} + \\frac{x_1^2}{6} + \\frac{x_1^3}{24} = 0$ 的根。\n令 $\\alpha = -x_1 > 0$。代入 $x_1 = -\\alpha$：\n$$ 1 + \\frac{-\\alpha}{2} + \\frac{(-\\alpha)^2}{6} + \\frac{(-\\alpha)^3}{24} = 0 $$\n$$ 1 - \\frac{\\alpha}{2} + \\frac{\\alpha^2}{6} - \\frac{\\alpha^3}{24} = 0 $$\n两边乘以 $24$ 得到多项式方程：\n$$ 24 - 12\\alpha + 4\\alpha^2 - \\alpha^3 = 0 $$\n$$ \\alpha^3 - 4\\alpha^2 + 12\\alpha - 24 = 0 $$\n我们用数值方法求解这个关于 $\\alpha$ 的三次方程。通过数值求解器（如牛顿法），可以找到根 $\\alpha \\approx 2.78529...$。\n\n四舍五入到 $\\,4\\,$ 位有效数字，我们得到 $\\alpha = 2.785$。\n因此，负实轴上的稳定区间约为 $[-2.785, 0]$。$\\alpha$ 的最大值是 $2.785$。", "answer": "$$ \\boxed{2.785} $$", "id": "3389392"}, {"introduction": "稳定性是数值方法能够收敛的必要条件，但对于许多物理问题（如流体密度、物种浓度）而言，我们还需要解保持非负性，即“保正性”。一个数值格式即使是稳定的，也可能在计算中产生无物理意义的负值。这个练习 [@problem_id:3389375] 将理论分析与编程实践相结合，探讨了著名的RK4方法在处理一个本身具有良好保正性（单调的）空间离散格式时的表现。您将通过推导RK4更新的显式“模板”权重，并在一个编程任务中验证您的发现，从而深刻理解高阶方法在保正性方面所面临的挑战与限制。", "problem": "考虑一维线性平流偏微分方程 (PDE) $u_t + a\\,u_x = 0$，定义在周期性域 $x \\in [0,1]$上，其中平流速度 $a  0$ 为常数。在 $N$ 个均匀间隔的单元上，使用一阶迎风守恒半离散格式对空间导数进行离散化，网格间距为 $\\Delta x = 1/N$，单元平均值为 $u_i(t)$，并采用周期性索引。该半离散系统为\n$$\n\\frac{d}{dt} u_i(t) = -\\frac{a}{\\Delta x}\\left(u_i(t) - u_{i-1}(t)\\right),\n$$\n可以写成线性系统 $\\frac{d}{dt} \\mathbf{u}(t) = \\mathbf{L}\\,\\mathbf{u}(t)$，其中 $\\mathbf{L}$ 是一个托普利茨 (Toeplitz) 矩阵，其元素为 $L_{ii} = -\\lambda$，$L_{i,i-1} = \\lambda$，其他元素 $L_{ij}=0$。这里 $\\lambda = a/\\Delta x$，索引采用周期性环绕。\n\n定义：\n- 如果半离散算子 $\\mathbf{L}$ 与前向欧拉 (Forward Euler) 时间步进法结合时，在时间步长 $\\Delta t$ 满足一个与算子相关的界限的条件下，更新 $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^n$ 对任意非负的 $\\mathbf{u}^n$ 保持非负性，则该算子称为单调的 (monotone)。\n- 对于给定的半离散系统，如果对于所选的 $\\Delta t$，分量上的 $\\mathbf{u}^n \\ge 0$ 意味着分量上的 $\\mathbf{u}^{n+1} \\ge 0$，则该时间积分格式称为保正的 (positivity-preserving)。\n- 经典的四阶龙格-库塔 (Runge-Kutta) 方法（RK4）通过四个阶段和阶段导数的特定凸组合，将方程 $\\mathbf{u}' = \\mathbf{L}\\,\\mathbf{u}$ 的解从 $\\mathbf{u}^n$推进到 $\\mathbf{u}^{n+1}$。\n\n任务：\n1. 从半离散迎风格式及其前向欧拉更新出发，推导保证前向欧拉法保正性的时间步长界限。你的推导必须从每个单元上前向欧拉更新的显式形式开始，并展示其如何形成相邻单元值的凸组合。\n2. 考虑将经典的四阶龙格-库塔 (RK4) 方法应用于同一半离散系统。令 $\\mathbf{S}$ 表示后向位移算子，作用于网格函数为 $(\\mathbf{S}\\,\\mathbf{u})_i = u_{i-1}$，并注意到 $\\mathbf{L} = \\lambda(\\mathbf{S} - \\mathbf{I})$，其中 $\\mathbf{I}$ 是单位算子。通过将 $\\mathbf{L}$ 的幂展开为 $\\mathbf{S}$ 和 $\\mathbf{I}$ 的多项式，将单步 RK4 更新写成如下形式\n$$\nu_i^{n+1} = \\sum_{m=0}^{4} w_m(r)\\,u_{i-m}^n,\n$$\n其中 $r = \\lambda\\,\\Delta t$ 是库朗数 (Courant number)（无量纲），$w_m(r)$ 是仅依赖于 $r$ 的标量权重。推导每个 $w_m(r)$ 的显式多项式表达式。\n3. 使用推导出的权重，确定 $r$ 的一个阈值，使得当 $r$ 小于或等于该阈值时所有权重均为非负，并证明当 $r$ 超过该阈值时至少有一个权重变为负值。解释为什么这表明，当 $\\Delta t$ 超过一个与方法相关的阈值时，即使对于单调的半离散算子，经典的 RK4 方法也可能违反正性。\n4. 实现一个程序，该程序：\n   - 根据上述定义，使用参数 $N = 128$ 和 $a = 1$ 构建半离散算子 $\\mathbf{L}$。\n   - 初始化一个非负状态 $\\mathbf{u}^0$，在索引 $i_0 = 10$ 处有一个尖峰：$u_{i_0}^0 = 1$ 且对于 $i \\ne i_0$ 有 $u_i^0 = 0$。\n   - 对于下面测试套件中的每个 $r = \\lambda\\,\\Delta t$ 测试值，使用精确的半离散算子和标准的 RK4 阶段方程，将解推进一个 RK4 时间步长。\n   - 检查结果 $\\mathbf{u}^{1}$ 是否有任何负分量（严格小于 $0$，使用 $10^{-12}$ 的数值容差以忽略舍入误差）。\n   - 生成一行输出，包含一个用方括号括起来的逗号分隔列表，其中每个条目是一个布尔值，指示是否违反正性（如果任何分量为负，则为 True，否则为 False）。\n\n测试套件（要使用的库朗数 $r = \\lambda\\,\\Delta t$ 的值）：\n- 情况1（零步长）：$r = 0.0$。\n- 情况2（低于阈值）：$r = 0.5$。\n- 情况3（边界值）：$r = 1.0$。\n- 情况4（略高于阈值）：$r = 1.05$。\n- 情况5（远高于阈值）：$r = 1.60$。\n\n你的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3,result4,result5]”）。不涉及物理单位；所有量均为无量纲。每个测试用例的最终输出必须是布尔值，指示在一步 RK4 后是否违反正性。", "solution": "### 任务1：前向欧拉格式的保正性条件\n\n问题考虑在周期性域上的一维线性平流方程 $u_t + a\\,u_x = 0$，其中 $a  0$。空间导数使用一阶迎风格式进行离散，得到关于单元平均值 $u_i(t)$ 的半离散系统：\n$$\n\\frac{d}{dt} u_i(t) = -\\frac{a}{\\Delta x}\\left(u_i(t) - u_{i-1}(t)\\right)\n$$\n应用前向欧拉 (Forward Euler) 时间积分方法，从时间步 $n$到 $n+1$ 的更新由 $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t \\, \\frac{d\\mathbf{u}}{dt}\\big|_{\\mathbf{u}=\\mathbf{u}^n}$ 给出。对于单个单元 $i$，这变为：\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left( -\\frac{a}{\\Delta x}\\left(u_i^n - u_{i-1}^n\\right) \\right)\n$$\n我们引入无量纲的库朗数，定义为 $r = \\frac{a\\,\\Delta t}{\\Delta x}$。将其代入更新方程，得到：\n$$\nu_i^{n+1} = u_i^n - r \\left(u_i^n - u_{i-1}^n\\right)\n$$\n重新整理各项，将 $u_i^{n+1}$ 表示为时间 $n$ 处值的线性组合：\n$$\nu_i^{n+1} = (1 - r)u_i^n + r\\,u_{i-1}^n\n$$\n为使格式保持正性，我们要求如果 $\\mathbf{u}^n$ 的所有分量都是非负的（即对所有 $j$ 有 $u_j^n \\ge 0$），那么 $\\mathbf{u}^{n+1}$ 的所有分量也必须是非负的。从 $u_i^{n+1}$ 的方程来看，如果 $u_i^n \\ge 0$ 且 $u_{i-1}^n \\ge 0$，那么只要线性组合的系数是非负的，$u_i^{n+1}$ 就保证是非负的。\n这给出了两个条件：\n1. $r \\ge 0$：由于 $a  0$，$\\Delta t  0$ 且 $\\Delta x  0$，这个条件是内在地满足的。\n2. $1 - r \\ge 0 \\implies r \\le 1$。\n\n综合这些条件，对于此半离散系统，前向欧拉方法是保正的当且仅当库朗数 $r$ 满足 $0 \\le r \\le 1$。这对应于时间步长界限 $\\Delta t \\le \\frac{\\Delta x}{a}$，即该格式的 Courant-Friedrichs-Lewy (CFL) 条件。因此，在这一条件下，所提供的算子 $\\mathbf{L}$ 是单调的。\n\n### 任务2：RK4 模板权重的推导\n\n对于自治系统 $\\mathbf{u}' = \\mathbf{L}\\mathbf{u}$，经典的四阶龙格-库塔 (RK4) 方法可以表示为算子 $\\Delta t \\mathbf{L}$ 的多项式。单步更新由下式给出：\n$$\n\\mathbf{u}^{n+1} = \\left( \\mathbf{I} + \\Delta t \\mathbf{L} + \\frac{(\\Delta t \\mathbf{L})^2}{2!} + \\frac{(\\Delta t \\mathbf{L})^3}{3!} + \\frac{(\\Delta t \\mathbf{L})^4}{4!} \\right) \\mathbf{u}^n\n$$\n问题指定半离散算子为 $\\mathbf{L} = \\lambda(\\mathbf{S} - \\mathbf{I})$，其中 $\\lambda = a/\\Delta x$，$\\mathbf{S}$ 是后向位移算子，$(\\mathbf{S}\\mathbf{u})_i = u_{i-1}$。我们定义库朗数为 $r = \\lambda \\Delta t = a \\Delta t / \\Delta x$。\n算子项 $\\Delta t \\mathbf{L}$ 可以写为：\n$$\n\\Delta t \\mathbf{L} = \\Delta t \\lambda (\\mathbf{S} - \\mathbf{I}) = r(\\mathbf{S} - \\mathbf{I})\n$$\n将此代入 RK4 更新公式，单步更新算子 $\\mathbf{W}(r)$ 为：\n$$\n\\mathbf{W}(r) = \\mathbf{I} + r(\\mathbf{S} - \\mathbf{I}) + \\frac{r^2}{2}(\\mathbf{S} - \\mathbf{I})^2 + \\frac{r^3}{6}(\\mathbf{S} - \\mathbf{I})^3 + \\frac{r^4}{24}(\\mathbf{S} - \\mathbf{I})^4\n$$\n我们需要在表达式 $\\mathbf{u}^{n+1} = \\left(\\sum_{m=0}^{4} w_m(r) \\mathbf{S}^m\\right) \\mathbf{u}^n$ 中找到系数 $w_m(r)$。这需要使用二项式定理 $(\\mathbf{A}+\\mathbf{B})^k = \\sum_{j=0}^k \\binom{k}{j} \\mathbf{A}^{k-j}\\mathbf{B}^j$ 来展开 $(\\mathbf{S} - \\mathbf{I})$ 的幂：\n- $(\\mathbf{S} - \\mathbf{I})^1 = \\mathbf{S} - \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^2 = \\mathbf{S}^2 - 2\\mathbf{S} + \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^3 = \\mathbf{S}^3 - 3\\mathbf{S}^2 + 3\\mathbf{S} - \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^4 = \\mathbf{S}^4 - 4\\mathbf{S}^3 + 6\\mathbf{S}^2 - 4\\mathbf{S} + \\mathbf{I}$\n\n我们收集从 $\\mathbf{S}^0$ 到 $\\mathbf{S}^4$ 的每个 $\\mathbf{S}$ 次幂的系数。\n\n- $\\mathbf{S}^4$ 的系数 ($w_4(r)$)：唯一的贡献来自 $(\\mathbf{S} - \\mathbf{I})^4$ 项。\n$$ w_4(r) = \\frac{r^4}{24} \\binom{4}{4} = \\frac{r^4}{24} $$\n\n- $\\mathbf{S}^3$ 的系数 ($w_3(r)$)：贡献来自 $(\\mathbf{S} - \\mathbf{I})^3$ 和 $(\\mathbf{S} - \\mathbf{I})^4$。\n$$ w_3(r) = \\frac{r^3}{6} \\binom{3}{3} + \\frac{r^4}{24} \\binom{4}{3}(-1)^1 = \\frac{r^3}{6} - \\frac{4r^4}{24} = \\frac{r^3}{6} - \\frac{r^4}{6} $$\n\n- $\\mathbf{S}^2$ 的系数 ($w_2(r)$)：贡献来自 $(\\mathbf{S} - \\mathbf{I})^2$、$(\\mathbf{S} - \\mathbf{I})^3$ 和 $(\\mathbf{S} - \\mathbf{I})^4$。\n$$ w_2(r) = \\frac{r^2}{2} \\binom{2}{2} + \\frac{r^3}{6} \\binom{3}{2}(-1)^1 + \\frac{r^4}{24} \\binom{4}{2}(-1)^2 = \\frac{r^2}{2} - \\frac{3r^3}{6} + \\frac{6r^4}{24} = \\frac{r^2}{2} - \\frac{r^3}{2} + \\frac{r^4}{4} $$\n\n- $\\mathbf{S}^1$ 的系数 ($w_1(r)$)：贡献来自从 $1$ 到 $4$ 的所有次幂。\n$$ w_1(r) = r \\binom{1}{1} + \\frac{r^2}{2} \\binom{2}{1}(-1)^1 + \\frac{r^3}{6} \\binom{3}{1}(-1)^2 + \\frac{r^4}{24} \\binom{4}{1}(-1)^3 = r - r^2 + \\frac{r^3}{2} - \\frac{r^4}{6} $$\n\n- $\\mathbf{S}^0 = \\mathbf{I}$ 的系数 ($w_0(r)$)：贡献来自所有项。\n$$ w_0(r) = 1 + r \\binom{1}{0}(-1)^1 + \\frac{r^2}{2} \\binom{2}{0}(-1)^2 + \\frac{r^3}{6} \\binom{3}{0}(-1)^3 + \\frac{r^4}{24} \\binom{4}{0}(-1)^4 = 1 - r + \\frac{r^2}{2} - \\frac{r^3}{6} + \\frac{r^4}{24} $$\n\n### 任务3：RK4 的保正性阈值\n\n为了使 RK4 格式保持正性，更新 $u_i^{n+1} = \\sum_{m=0}^{4} w_m(r)\\,u_{i-m}^n$ 对于任何非负的初始状态 $\\mathbf{u}^n$ 都必须产生非负的结果。如果所有模板权重 $w_m(r)$ 都是非负的，则可以保证这一点（考虑到它们的和为1，这使得更新成为一个凸组合）。让我们分析当 $r \\ge 0$ 时每个权重的符号。\n\n1.  $w_4(r) = \\frac{r^4}{24}$：对于任何实数 $r$，这始终是非负的。\n2.  $w_3(r) = \\frac{r^3}{6} - \\frac{r^4}{6} = \\frac{r^3}{6}(1-r)$：对于 $r \\ge 0$，此权重为非负当且仅当 $1-r \\ge 0$，即 $r \\le 1$。对于任何 $r1$，$w_3(r)$ 是严格负的。\n3.  $w_2(r) = \\frac{r^2}{2} - \\frac{r^3}{2} + \\frac{r^4}{4} = \\frac{r^2}{4}(2 - 2r + r^2)$：二次项 $q(r) = r^2 - 2r + 2$ 的判别式为 $\\Delta = (-2)^2 - 4(1)(2) = -4  0$。由于其首项系数为正，$q(r)$ 对所有实数 $r$ 都为正。因此，对于 $r \\ge 0$，$w_2(r)$ 始终是非负的。\n4.  $w_1(r) = r - r^2 + \\frac{r^3}{2} - \\frac{r^4}{6}$：对于 $r \\in [0, 1]$，此权重是非负的。例如，当 $r=1$ 时，$w_1(1) = 1 - 1 + 1/2 - 1/6 = 1/3  0$。对于 $r0$，$w_1(r)=0$ 的第一个根约为 $r \\approx 1.596$。\n5.  $w_0(r) = 1 - r + \\frac{r^2}{2} - \\frac{r^3}{6} + \\frac{r^4}{24}$：这是 $e^{-r}$ 的四阶泰勒多项式。它在 $[0,1]$ 上是一个递减函数，并且在该区间内始终为正 ($w_0(0)=1$, $w_0(1) = 9/24  0$)。对于 $r0$，$w_0(r)=0$ 的第一个根约为 $r \\approx 2.785$。\n\n所有权重均为非负的最严格条件来自 $w_3(r) \\ge 0$，这要求 $r \\le 1$。当 $r$ 超过 $1$ 时，$w_3(r)$ 变为负值。这违背了保正性的条件。对于单尖峰初始条件 $u_{i-3}^n  0$ 且所有其他 $u_j^n = 0$，得到的值 $u_i^{n+1} = w_3(r) u_{i-3}^n$ 将是负的。\n\n因此，对于此半离散系统，经典 RK4 方法保持正性的库朗数阈值是 $r=1$。超过这个阈值，例如 $r=1.05$，会导致一个负权重 ($w_3(1.05)  0$)，这表明即使将该格式应用于单调算子，如果时间步长过大，它也可能违反正性。在这种特定情况下，RK4 的方法相关保正性极限 ($r \\le 1$) 恰好与前向欧拉法的 CFL 极限 ($r \\le 1$) 一致。\n\n### 任务4：数值验证\n\n所提供的 Python 代码实现了所述的数值实验。它设置了一个包含 $N=128$ 个单元的域，平流速度 $a=1$，并计算出 $\\lambda = a/\\Delta x = 128$。它初始化了一个大小为 $128$ 的向量 $\\mathbf{u}^0$，其中只有一个非零项 $u_{10}^0 = 1$。对于测试套件中的每个库朗数 $r$，它计算相应的时间步长 $\\Delta t = r/\\lambda$，并使用应用于半离散算子 $\\mathbf{L}\\mathbf{u} = \\lambda(\\mathbf{S}\\mathbf{u} - \\mathbf{u})$ 的经典 RK4 方法将解推进一个步长。`numpy.roll` 函数被用来高效地实现周期性位移算子 $\\mathbf{S}$。最后，它检查结果向量 $\\mathbf{u}^1$ 的任何分量是否为负（低于 $-10^{-12}$ 的小容差），并为每种情况报告一个布尔值。这些结果将证实任务3中的理论发现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of checking positivity violation for the RK4 scheme\n    applied to a first-order upwind semi-discretization of the linear\n    advection equation.\n    \"\"\"\n\n    # Define problem parameters\n    N = 128  # Number of cells\n    a = 1.0  # Advection speed\n    i_0 = 10 # Index of the initial spike\n\n    # Derived parameters\n    delta_x = 1.0 / N\n    lambda_val = a / delta_x\n\n    # Define the initial condition: a single spike at i_0\n    u0 = np.zeros(N)\n    u0[i_0] = 1.0\n\n    # Define the test cases for the Courant number r = lambda * delta_t\n    test_cases_r = [0.0, 0.5, 1.0, 1.05, 1.60]\n    \n    results = []\n    \n    # Numerical tolerance for checking negativity\n    tolerance = -1e-12\n\n    # Define the semi-discrete operator L such that du/dt = L(u)\n    # L(u)_i = -a/dx * (u_i - u_{i-1}) = -lambda * (u_i - u_{i-1})\n    # This is equivalent to lambda * (u_shifted - u)\n    def L_operator(u_vec):\n        \"\"\"\n        Applies the semi-discrete upwind operator L to a vector u.\n        Uses periodic boundary conditions via np.roll.\n        \"\"\"\n        # np.roll(u, 1) shifts elements to the right, so u_i - u_{i-1}\n        u_shifted = np.roll(u_vec, 1)\n        return lambda_val * (u_shifted - u_vec)\n\n    for r in test_cases_r:\n        # Calculate the time step delta_t for the current test case\n        if lambda_val > 0:\n            delta_t = r / lambda_val\n        else: # Handle the case of zero advection speed\n            delta_t = 0.0\n\n        # Perform one step of the classical four-stage Runge-Kutta method\n        u_n = u0.copy()\n        \n        # k1 = L(u_n)\n        k1 = L_operator(u_n)\n        \n        # k2 = L(u_n + dt/2 * k1)\n        k2 = L_operator(u_n + (delta_t / 2.0) * k1)\n        \n        # k3 = L(u_n + dt/2 * k2)\n        k3 = L_operator(u_n + (delta_t / 2.0) * k2)\n        \n        # k4 = L(u_n + dt * k3)\n        k4 = L_operator(u_n + delta_t * k3)\n        \n        # u_{n+1} = u_n + dt/6 * (k1 + 2*k2 + 2*k3 + k4)\n        u_next = u_n + (delta_t / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n        \n        # Check for positivity violation\n        # np.any returns True if any element in the array satisfies the condition\n        violation = np.any(u_next  tolerance)\n        results.append(violation)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [r.capitalize() for r in map(str, results)]))}]\")\n\nsolve()\n```", "id": "3389375"}]}