{"hands_on_practices": [{"introduction": "有限元方法的核心在于将物理域（通常形状复杂）上的积分变换到简单、标准化的参考单元上。这个过程是基础，但需要我们仔细处理坐标映射中产生的几何项。这个练习探讨了等参单元数值求积的核心原理。通过确定精确积分所需的最小求积点数，你将深入理解基函数的次数和几何映射是如何相互作用的。仿射与非仿射映射的对比将阐明为什么精确积分对于弯曲单元通常是不可行的，这是有限元实际应用中的一个关键概念。[@problem_id:3439558]", "problem": "考虑二维空间中单个等参四边形单元上的标量扩散双线性形式，其表达式为\n$$\na_{K}(u,v) \\;=\\; \\int_{K} \\nabla u \\cdot \\nabla v \\, \\mathrm{d}x,\n$$\n其中 $K = F(\\widehat{K})$ 且 $\\widehat{K} = [-1,1]^{2}$ 是参考正方形。映射 $F : \\widehat{K} \\to K$ 是一个次数为 $k_{g}$ 的多项式等参映射，试探空间和测试空间是 $\\widehat{K}$ 上次数为 $p$ 的张量积多项式空间，即 $u \\circ F, v \\circ F \\in \\mathbb{Q}_{p}(\\widehat{K})$，该空间由每个参考坐标中次数最多为 $p$ 的多项式组成。该双线性形式到参考域上的拉回为\n$$\na_{K}(u,v) \\;=\\; \\int_{\\widehat{K}} \\big(\\nabla_{\\xi} \\widehat{u}\\big)^{\\top} \\, \\big(J^{-1} J^{-T}\\big) \\, \\nabla_{\\xi} \\widehat{v} \\; |\\det J| \\, \\mathrm{d}\\xi,\n$$\n其中 $\\widehat{u} = u \\circ F$，$\\widehat{v} = v \\circ F$，$J = \\nabla_{\\xi} F$ 是 $F$ 的雅可比矩阵，$\\nabla_{\\xi}$ 表示关于参考坐标的梯度。\n\n假设单元积分通过在 $\\widehat{K}$ 上使用张量积高斯-勒让德求积法进行计算，每个坐标方向有 $q$ 个点。在仿射几何映射（即 $k_{g} = 1$）的情况下，对于所有的 $u, v \\in \\mathbb{Q}_{p}(\\widehat{K})$，请确定保证 $a_{K}(u,v)$ 精确计算的最小整数 $q$（作为 $p$ 的函数）。请从链式法则以及 $\\mathbb{Q}_{p}(\\widehat{K})$ 和基于雅可比矩阵的因子的多项式次数结构出发，论证得出所选 $q$ 值的次数计算过程。此外，简要判断对于 $k_{g} \\ge 2$ 的非仿射映射，是否存在这样一个有限的 $q$，并解释你的理由。\n\n对于仿射情况 $k_{g} = 1$，你的最终答案必须是关于 $p$ 的单个闭式表达式。", "solution": "该问题要求在等参四边形单元上精确计算标量扩散双线性形式时，每个维度所需的最小高斯-勒让德求积点数 $q$。分析分为两种情况：仿射映射和非仿射映射。\n\n首先，我们必须阐明“仿射几何映射，即 $k_g = 1$”的含义。在参考正方形 $\\widehat{K}=[-1,1]^2$ 上，次数为 $k_g=1$ 的等参映射是一个双线性映射，其中映射 $F$ 的每个分量都在空间 $\\mathbb{Q}_1(\\widehat{K})$ 中。一个常规双线性映射的雅可比矩阵 $J$ 不是常数；其元素是关于参考坐标 $\\xi = (\\xi_1, \\xi_2)$ 的线性多项式。然而，形式为 $F(\\xi) = A\\xi+b$ 的仿射映射具有一个常数雅可比矩阵 $J=A$。当且仅当物理单元 $K$ 是一个平行四边形时，双线性映射才简化为仿射映射。在这种情况下，拉回后的双线性形式的被积函数成为一个多项式，可以通过高斯求积法精确积分。对于一个常规的（非平行四边形）双线性单元，雅可比矩阵 $J$ 不是常数，其行列式 $\\det J$ 也不是常数，因此，项 $(J^{-1}J^{-T})|\\det J|$ 是一个由有理函数组成的矩阵。高斯求积法无法精确积分一般的有理函数。因此，“仿射几何映射”这一短语必须被解释为将 $k_g=1$ 的情况限制为具有常数雅可比矩阵的映射，即单元为平行四边形的情况。\n\n**情况1：仿射映射（$k_g = 1$，常数雅可比矩阵）**\n\n拉回到参考单元 $\\widehat{K}$ 上的双线性形式为：\n$$\na_{K}(u,v) = \\int_{\\widehat{K}} \\underbrace{\\big(\\nabla_{\\xi} \\widehat{u}\\big)^{\\top} \\, \\big(J^{-1} J^{-T}\\big) \\, \\nabla_{\\xi} \\widehat{v} \\; |\\det J|}_{I(\\xi_1, \\xi_2)} \\, \\mathrm{d}\\xi_1 \\mathrm{d}\\xi_2\n$$\n我们需要确定被积函数 $I(\\xi_1, \\xi_2)$ 在每个坐标方向 $\\xi_1$ 和 $\\xi_2$ 上的最高多项式次数。\n\n1.  **几何因子**：对于仿射映射，雅可比矩阵 $J = \\nabla_{\\xi} F$ 是一个常数 $2 \\times 2$ 矩阵。因此，其逆矩阵 $J^{-1}$、转置逆矩阵 $J^{-T}$ 以及行列式 $\\det J$ 也都是常数。整个几何因子 $G = (J^{-1} J^{-T}) |\\det J|$ 是一个常数矩阵。\n\n2.  **试探函数和测试函数因子**：试探函数 $u$ 和测试函数 $v$ 的拉回 $\\widehat{u} = u \\circ F$ 和 $\\widehat{v} = v \\circ F$ 是 $\\mathbb{Q}_{p}(\\widehat{K})$ 中的元素。这是在每个变量中次数最多为 $p$ 的张量积多项式空间，即 $\\widehat{u}(\\xi_1, \\xi_2) = \\sum_{i=0}^{p} \\sum_{j=0}^{p} c_{ij} \\xi_1^i \\xi_2^j$。\n\n3.  **梯度的次数**：我们分析梯度 $\\nabla_{\\xi} \\widehat{u} = (\\frac{\\partial \\widehat{u}}{\\partial \\xi_1}, \\frac{\\partial \\widehat{u}}{\\partial \\xi_2})^{\\top}$ 各分量的多项式次数。\n    -   关于 $\\xi_1$ 的偏导数 $\\frac{\\partial \\widehat{u}}{\\partial \\xi_1}$ 是通过对 $\\widehat{u}$ 求关于 $\\xi_1$ 的导数得到的。这会使 $\\xi_1$ 的最高次数减少 $1$，而 $\\xi_2$ 的最高次数保持不变。因此，$\\frac{\\partial \\widehat{u}}{\\partial \\xi_1}$ 是一个在 $\\xi_1$ 方向上次数最多为 $p-1$，在 $\\xi_2$ 方向上次数最多为 $p$ 的多项式。我们将其所在空间表示为 $\\mathbb{Q}_{p-1, p}$。\n    -   类似地，偏导数 $\\frac{\\partial \\widehat{u}}{\\partial \\xi_2}$ 是一个在 $\\xi_1$ 方向上次数最多为 $p$，在 $\\xi_2$ 方向上次数最多为 $p-1$ 的多项式，属于空间 $\\mathbb{Q}_{p, p-1}$。\n    $\\widehat{v}$ 的梯度也是如此。\n\n4.  **被积函数的次数**：被积函数可以展开为：\n    $$\n    I(\\xi) = G_{11} \\frac{\\partial \\widehat{u}}{\\partial \\xi_1} \\frac{\\partial \\widehat{v}}{\\partial \\xi_1} + G_{12} \\frac{\\partial \\widehat{u}}{\\partial \\xi_1} \\frac{\\partial \\widehat{v}}{\\partial \\xi_2} + G_{21} \\frac{\\partial \\widehat{u}}{\\partial \\xi_2} \\frac{\\partial \\widehat{v}}{\\partial \\xi_1} + G_{22} \\frac{\\partial \\widehat{u}}{\\partial \\xi_2} \\frac{\\partial \\widehat{v}}{\\partial \\xi_2}\n    $$\n    由于 $G_{ij}$ 是常数，每一项的次数由导数的乘积决定。让我们计算这些乘积在每个变量中的最高次数：\n    -   $\\frac{\\partial \\widehat{u}}{\\partial \\xi_1} \\frac{\\partial \\widehat{v}}{\\partial \\xi_1}$：在 $\\xi_1$ 方向的次数最多为 $(p-1)+(p-1) = 2p-2$。在 $\\xi_2$ 方向的次数最多为 $p+p=2p$。\n    -   $\\frac{\\partial \\widehat{u}}{\\partial \\xi_1} \\frac{\\partial \\widehat{v}}{\\partial \\xi_2}$：在 $\\xi_1$ 方向的次数最多为 $(p-1)+p = 2p-1$。在 $\\xi_2$ 方向的次数最多为 $p+(p-1)=2p-1$。\n    -   $\\frac{\\partial \\widehat{u}}{\\partial \\xi_2} \\frac{\\partial \\widehat{v}}{\\partial \\xi_1}$：在 $\\xi_1$ 方向的次数最多为 $p+(p-1) = 2p-1$。在 $\\xi_2$ 方向的次数最多为 $(p-1)+p=2p-1$。\n    -   $\\frac{\\partial \\widehat{u}}{\\partial \\xi_2} \\frac{\\partial \\widehat{v}}{\\partial \\xi_2}$：在 $\\xi_1$ 方向的次数最多为 $p+p = 2p$。在 $\\xi_2$ 方向的次数最多为 $(p-1)+(p-1)=2p-2$。\n\n    这些项的和 $I(\\xi_1, \\xi_2)$ 是一个多项式。在 $\\xi_1$ 方向的最高次数为 $\\max(2p-2, 2p-1, 2p) = 2p$。在 $\\xi_2$ 方向的最高次数为 $\\max(2p, 2p-1, 2p-2) = 2p$。因此，被积函数 $I(\\xi_1, \\xi_2)$ 是空间 $\\mathbb{Q}_{2p}(\\widehat{K})$ 中的一个多项式。\n\n5.  **求积法则要求**：具有 $q$ 个点的一维高斯-勒让德求积法则可以精确积分最高次数为 $2q-1$ 的多项式。为了使张量积法则对二维积分精确，一维法则必须对被积函数在各个维度上的最高多项式次数都精确。因此，我们要求该法则对最高次数为 $2p$ 的多项式是精确的。条件是：\n    $$\n    2q - 1 \\ge 2p\n    $$\n    求解 $q$，我们得到 $2q \\ge 2p+1$，即 $q \\ge p + \\frac{1}{2}$。由于 $q$ 必须是整数，所以 $q$ 的最小值为 $p+1$。\n\n**情况2：非仿射映射 ($k_g \\ge 2$)**\n\n对于次数为 $k_g \\ge 2$ 的非仿射多项式映射，或者甚至是对于一般的双线性映射（在非平行四边形单元上 $k_g=1$），雅可比矩阵 $J$ 不是常数。\n-   $F$ 的分量是关于 $\\xi_1, \\xi_2$ 的多项式，在每个变量中的次数最高为 $k_g$。\n-   $J = \\nabla_\\xi F$ 的分量是多项式，在一个变量中的次数最高为 $k_g-1$，在另一个变量中最高为 $k_g$。\n-   因此，行列式 $\\det J$ 是一个关于 $\\xi_1, \\xi_2$ 的非常数多项式。\n-   雅可比矩阵的逆 $J^{-1} = \\frac{1}{\\det J} \\text{adj}(J)$ 的元素是有理函数（两个多项式之比），因为 $\\det J$ 出现在分母中。\n-   完整的被积函数 $I(\\xi)$ 是来自梯度 $(\\nabla_\\xi \\widehat{u}, \\nabla_\\xi \\widehat{v})$ 的多项式项和来自几何因子 $(J^{-1}J^{-T})|\\det J|$ 的有理函数项的乘积。因此，得到的被积函数通常是一个有理函数，而不是多项式。\n\n高斯-勒让德求积法是为精确积分多项式而设计的。它无法用任何有限数量的点来精确积分一般的有理函数。因此，对于非仿射映射，使用有限的求积法则是无法实现精确积分的。不存在一个有限的 $q$ 值，能够保证对所有函数 $\\widehat{u}, \\widehat{v} \\in \\mathbb{Q}_p$ 和所有次数为 $k_g \\ge 2$ 的非仿射映射都精确。在实践中，必须使用足够高阶的求积法则来将积分近似到所需的精度，这种方法被称为“超积分”(over-integration)。\n\n题目要求的最终答案是针对仿射情况的。", "answer": "$$\n\\boxed{p+1}\n$$", "id": "3439558"}, {"introduction": "从参考单元到物理单元的坐标映射不仅定义了几何形状，它还从根本上改变了离散系统的性质。单元的尺寸和形状对解的数值行为有着深远的影响。这个实践将研究质量矩阵和刚度矩阵随单元尺寸变化的缩放行为。通过分析这些矩阵的特征值如何缩放，你将揭示单元几何与显式时间积分格式稳定性之间的直接联系。这个练习提供了关键的洞察，解释了为什么包含高度扭曲或非常小的单元的网格会对时间步长施加严苛的限制，这是计算模拟中的一个常见挑战。[@problem_id:3439531]", "problem": "考虑二维空间中的标量扩散方程，该方程建立在单个有限元上，及其半离散有限元方法 (FEM) 表述。设参考单元为方形 $\\hat K = [-1,1]^2$，其双线性形函数为 $\\{\\hat N_i\\}_{i=1}^4$，对应于四个角点。使用一个等参映射 $F_\\varepsilon : \\hat K \\to K_\\varepsilon$，定义为 $x = F_\\varepsilon(\\hat x) = s(\\varepsilon) \\hat x$，其中 $s(\\varepsilon) = \\sqrt{\\varepsilon}$，$\\varepsilon \\in (0,1]$ 是一个给定参数。该映射产生的雅可比矩阵为 $J(\\hat x) = s(\\varepsilon) I$，其中 $I$ 是单位矩阵，因此对于所有 $\\hat x \\in \\hat K$，有 $\\det J(\\hat x) = \\varepsilon$，所以 $\\min_{\\hat K} \\det J = \\varepsilon$。尽管此映射是仿射的，但请将其解释为一个弯曲单元均匀压缩以达到相同最小雅可比行列式的极限情况。\n\n从等参映射下局部质量矩阵 $M(\\varepsilon)$ 和刚度矩阵 $K(\\varepsilon)$ 的标准定义出发：\n$$\nM_{ij}(\\varepsilon) = \\int_{K_\\varepsilon} N_i(x) N_j(x) \\, dx = \\int_{\\hat K} \\hat N_i(\\hat x) \\hat N_j(\\hat x)\\, \\det J(\\hat x) \\, d\\hat x,\n$$\n$$\nK_{ij}(\\varepsilon) = \\int_{K_\\varepsilon} \\nabla N_i(x) \\cdot \\nabla N_j(x) \\, dx = \\int_{\\hat K} \\hat \\nabla \\hat N_i(\\hat x)^{\\top} \\Big(J(\\hat x)^{-1} J(\\hat x)^{-T}\\Big) \\hat \\nabla \\hat N_j(\\hat x) \\, \\det J(\\hat x)\\, d\\hat x,\n$$\n请从第一性原理出发，推导 $M(\\varepsilon)$ 和 $K(\\varepsilon)$ 的谱如何随 $\\varepsilon$ 缩放。特别地，使用梯度变换 $\\nabla N = J^{-T} \\hat \\nabla \\hat N$ 和变量替换公式，展示当 $\\varepsilon \\to 0^+$ 时，$M(\\varepsilon) = \\mathcal{O}(\\varepsilon)$ 和 $K(\\varepsilon) = \\mathcal{O}(1)$ 的渐近行为。\n\n然后，考虑具有单位扩散系数的扩散方程的半离散系统：\n$$\nM(\\varepsilon)\\, \\frac{d u}{d t} + K(\\varepsilon)\\, u = 0,\n$$\n并根据 $M(\\varepsilon)^{-1} K(\\varepsilon)$ 的谱半径解释显式前向欧拉 (FE) 时间步长约束。展示最大稳定时间步长 $\\Delta t_{\\max}$ 如何随 $\\varepsilon$ 缩放。\n\n您的程序必须：\n- 使用双线性形函数 $\\{\\hat N_i\\}_{i=1}^4$ 和映射 $F_\\varepsilon(\\hat x) = s(\\varepsilon) \\hat x$，在 $\\hat K$ 上通过高斯积分来组装 $M(\\varepsilon)$ 和 $K(\\varepsilon)$。\n- 对每个测试用例，计算以下三个量：\n  1. 比率 $\\lambda_{\\max}\\big(M(\\varepsilon)\\big)/\\varepsilon$，其中 $\\lambda_{\\max}$ 表示最大特征值。\n  2. 最大特征值 $\\lambda_{\\max}\\big(K(\\varepsilon)\\big)$。\n  3. 最大稳定前向欧拉时间步长 $\\Delta t_{\\max} = \\frac{2}{\\rho\\big(M(\\varepsilon)^{-1} K(\\varepsilon)\\big)}$，其中 $\\rho(\\cdot)$ 表示谱半径。\n- 使用双精度浮点运算，并将所有量报告为无量纲浮点数。\n\n测试套件：\n- 对参数值 $\\varepsilon \\in \\{10^{0}, 10^{-2}, 10^{-6}, 10^{-10}\\}$ 评估程序。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表被方括号括起。列表中的每个元素是对应测试用例的 $[\\lambda_{\\max}(M(\\varepsilon))/\\varepsilon,\\ \\lambda_{\\max}(K(\\varepsilon)),\\ \\Delta t_{\\max}]$ 列表。例如，具有两个用例的输出应类似于 $[[a_1,b_1,c_1],[a_2,b_2,c_2]]$，但使用实际数值。", "solution": "### 理论推导\n\n问题的核心是理解由 $\\varepsilon$ 参数化的有限元几何形状如何影响离散系统的代数性质。\n\n**1. 质量矩阵 $M(\\varepsilon)$ 的缩放**\n\n局部质量矩阵 $M(\\varepsilon)$ 由参考单元 $\\hat K$ 上的积分定义：\n$$\nM_{ij}(\\varepsilon) = \\int_{\\hat K} \\hat N_i(\\hat x) \\hat N_j(\\hat x)\\, \\det J(\\hat x) \\, d\\hat x\n$$\n根据问题陈述，雅可比行列式是常数，$\\det J(\\hat x) = \\varepsilon$。我们可以将这个常数从积分中提出来：\n$$\nM_{ij}(\\varepsilon) = \\varepsilon \\int_{\\hat K} \\hat N_i(\\hat x) \\hat N_j(\\hat x) \\, d\\hat x\n$$\n剩余的积分与 $\\varepsilon$ 无关。它定义了参考质量矩阵 $\\hat M$：\n$$\n\\hat M_{ij} = \\int_{\\hat K} \\hat N_i(\\hat x) \\hat N_j(\\hat x) \\, d\\hat x\n$$\n因此，单元 $K_\\varepsilon$ 上 的质量矩阵与参考质量矩阵之间的关系是一个简单的缩放关系：\n$$\nM(\\varepsilon) = \\varepsilon \\hat M\n$$\n$M(\\varepsilon)$ 的特征值与 $\\hat M$ 的特征值直接相关。设 $\\lambda_{\\hat M}$ 是 $\\hat M$ 的一个特征值。那么 $M(\\varepsilon) v = (\\varepsilon \\hat M) v = \\varepsilon (\\lambda_{\\hat M} v) = (\\varepsilon \\lambda_{\\hat M}) v$。这表明 $M(\\varepsilon)$ 的特征值是 $\\hat M$ 特征值的 $\\varepsilon$ 倍。因此，$M(\\varepsilon)$ 的谱与 $\\varepsilon$ 呈线性缩放关系，我们可以写出当 $\\varepsilon \\to 0^+$ 时，$M(\\varepsilon) = \\mathcal{O}(\\varepsilon)$。比率 $\\lambda_{\\max}(M(\\varepsilon)) / \\varepsilon$ 等于常数 $\\lambda_{\\max}(\\hat M)$。\n\n**2. 刚度矩阵 $K(\\varepsilon)$ 的缩放**\n\n局部刚度矩阵 $K(\\varepsilon)$ 由下式给出：\n$$\nK_{ij}(\\varepsilon) = \\int_{\\hat K} \\hat \\nabla \\hat N_i(\\hat x)^{\\top} \\Big(J(\\hat x)^{-1} J(\\hat x)^{-T}\\Big) \\hat \\nabla \\hat N_j(\\hat x) \\, \\det J(\\hat x)\\, d\\hat x\n$$\n我们需要计算几何项 $G(\\hat x) = J(\\hat x)^{-1} J(\\hat x)^{-T}$。雅可比矩阵是 $J(\\hat x) = \\sqrt{\\varepsilon}I$。其逆矩阵是 $J(\\hat x)^{-1} = \\frac{1}{\\sqrt{\\varepsilon}}I$，它也等于其自身的转置，即 $J(\\hat x)^{-T} = \\frac{1}{\\sqrt{\\varepsilon}}I$。\n因此，\n$$\nG(\\hat x) = \\left(\\frac{1}{\\sqrt{\\varepsilon}}I\\right) \\left(\\frac{1}{\\sqrt{\\varepsilon}}I\\right) = \\frac{1}{\\varepsilon}I\n$$\n将此式和 $\\det J(\\hat x) = \\varepsilon$ 代入 $K_{ij}(\\varepsilon)$ 的积分中：\n$$\nK_{ij}(\\varepsilon) = \\int_{\\hat K} \\hat \\nabla \\hat N_i(\\hat x)^{\\top} \\left(\\frac{1}{\\varepsilon}I\\right) \\hat \\nabla \\hat N_j(\\hat x) \\, (\\varepsilon) \\, d\\hat x\n$$\n标量因子 $\\frac{1}{\\varepsilon}$ 和 $\\varepsilon$相互抵消：\n$$\nK_{ij}(\\varepsilon) = \\int_{\\hat K} \\hat \\nabla \\hat N_i(\\hat x)^{\\top} I \\hat \\nabla \\hat N_j(\\hat x) \\, d\\hat x = \\int_{\\hat K} \\hat \\nabla \\hat N_i(\\hat x) \\cdot \\hat \\nabla \\hat N_j(\\hat x) \\, d\\hat x\n$$\n此表达式是参考刚度矩阵 $\\hat K$ 的定义，它与 $\\varepsilon$ 无关。\n$$\nK(\\varepsilon) = \\hat K\n$$\n因此，刚度矩阵 $K(\\varepsilon)$ 及其谱不随 $\\varepsilon$ 变化。这证实了当 $\\varepsilon \\to 0^+$ 时，$K(\\varepsilon) = \\mathcal{O}(1)$ 的渐近行为。量 $\\lambda_{\\max}(K(\\varepsilon))$ 等于常数 $\\lambda_{\\max}(\\hat K)$。\n\n**3. 最大稳定时间步长 $\\Delta t_{\\max}$ 的缩放**\n\n半离散系统由 $M(\\varepsilon)\\, \\frac{d u}{d t} + K(\\varepsilon)\\, u = 0$ 给出。应用前向欧拉时间积分格式 $u^{n+1} = u^n + \\Delta t \\frac{du}{dt}\\big|_{t=t_n}$，得到：\n$$\nM(\\varepsilon) \\left(\\frac{u^{n+1} - u^n}{\\Delta t}\\right) + K(\\varepsilon) u^n = 0\n$$\n求解新状态 $u^{n+1}$：\n$$\nu^{n+1} = \\left(I - \\Delta t M(\\varepsilon)^{-1} K(\\varepsilon)\\right) u^n\n$$\n为保证稳定性，放大矩阵 $A = I - \\Delta t M(\\varepsilon)^{-1} K(\\varepsilon)$ 的谱半径必须不大于 $1$。$A$ 的特征值为 $1 - \\Delta t \\lambda_G$，其中 $\\lambda_G$ 是矩阵 $M(\\varepsilon)^{-1} K(\\varepsilon)$ 的特征值，它们是广义特征值问题 $K(\\varepsilon)v = \\lambda_G M(\\varepsilon)v$ 的解。由于 $M$ 和 $K$ 是对称和正（半）定的，特征值 $\\lambda_G$ 是实数且非负。\n\n稳定性条件 $|1 - \\Delta t \\lambda_G| \\le 1$对所有 $\\lambda_G$ 成立，意味着 $-1 \\le 1 - \\Delta t \\lambda_G \\le 1$，可简化为 $\\Delta t \\lambda_G \\le 2$。这必须对最大特征值成立，因此约束为：\n$$\n\\Delta t \\le \\frac{2}{\\max(\\lambda_G)} = \\frac{2}{\\rho(M(\\varepsilon)^{-1} K(\\varepsilon))}\n$$\n因此，最大稳定时间步长为 $\\Delta t_{\\max} = \\frac{2}{\\rho(M(\\varepsilon)^{-1} K(\\varepsilon))}$。\n\n现在我们分析其随 $\\varepsilon$ 的缩放。使用我们之前的结果，$M(\\varepsilon) = \\varepsilon \\hat M$ 和 $K(\\varepsilon) = \\hat K$。广义特征值问题变为：\n$$\n\\hat K v = \\lambda_G (\\varepsilon \\hat M) v\n$$\n整理得：\n$$\n\\frac{1}{\\varepsilon} \\hat K v = \\lambda_G \\hat M v\n$$\n这表明 $M(\\varepsilon)^{-1}K(\\varepsilon)$ 的特征值 $\\lambda_G$ 等于参考系统 $\\hat M^{-1}\\hat K$ 特征值的 $\\frac{1}{\\varepsilon}$ 倍。谱半径也相应地缩放：\n$$\n\\rho(M(\\varepsilon)^{-1} K(\\varepsilon)) = \\frac{1}{\\varepsilon} \\rho(\\hat M^{-1} \\hat K)\n$$\n将此代入 $\\Delta t_{\\max}$ 的表达式中：\n$$\n\\Delta t_{\\max}(\\varepsilon) = \\frac{2}{\\frac{1}{\\varepsilon} \\rho(\\hat M^{-1} \\hat K)} = \\varepsilon \\left(\\frac{2}{\\rho(\\hat M^{-1} \\hat K)}\\right)\n$$\n由于括号中的项是一个常数，我们已经证明了 $\\Delta t_{\\max}(\\varepsilon) = \\mathcal{O}(\\varepsilon)$。这个关键结果表明，随着单元变得更小（即 $\\varepsilon \\to 0$），显式时间步长的稳定性约束变得成比例地更加严格。\n\n### 数值实现\n\n程序将实现以下步骤：\n1.  在参考方形 $\\hat K = [-1,1]^2$ 上定义双线性形函数 $\\{\\hat N_i(\\xi, \\eta)\\}_{i=1}^4$ 及其梯度 $\\{\\hat \\nabla \\hat N_i(\\xi, \\eta)\\}_{i=1}^4$。\n2.  对于每个给定的 $\\varepsilon$，使用 $2 \\times 2$ 高斯积分规则组装 $4 \\times 4$ 矩阵 $M(\\varepsilon)$ 和 $K(\\varepsilon)$，该规则对于遇到的多项式被积函数是精确的。\n3.  使用推导出的公式计算被积函数：$M_{ij}$ 的被积函数是 $\\varepsilon (\\hat N_i \\hat N_j)$，$K_{ij}$ 的被积函数是 $(\\hat \\nabla \\hat N_i \\cdot \\hat \\nabla \\hat N_j)$。\n4.  对于每个组装好的矩阵对 $(M(\\varepsilon), K(\\varepsilon))$，计算所需的量：\n    a. $M(\\varepsilon)$ 的最大特征值除以 $\\varepsilon$。这应该是一个等于 $\\lambda_{\\max}(\\hat M)$ 的常数。\n    b. $K(\\varepsilon)$ 的最大特征值。这应该是一个等于 $\\lambda_{\\max}(\\hat K)$ 的常数。\n    c. 最大稳定时间步长 $\\Delta t_{\\max}$，首先通过求解广义特征值问题 $K(\\varepsilon)v = \\lambda_G M(\\varepsilon)v$ 找到 $\\rho(M(\\varepsilon)^{-1} K(\\varepsilon))$，然后应用公式。\n5.  将每个 $\\varepsilon$ 的结果收集并格式化为指定的字符串输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Solves the FEM scaling problem for various values of epsilon.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [1.0, 1e-2, 1e-6, 1e-10]\n\n    def get_bilinear_basis(xi, eta):\n        \"\"\"\n        Evaluates bilinear shape functions and their gradients at a point (xi, eta)\n        in the reference element [-1, 1]^2.\n\n        Node ordering:\n        1: (-1, -1)\n        2: ( 1, -1)\n        3: ( 1,  1)\n        4: (-1,  1)\n\n        Returns:\n            - N: A (4,) array of shape function values.\n            - dN: A (4, 2) array of shape function gradients [d/dxi, d/deta].\n        \"\"\"\n        N = 0.25 * np.array([\n            (1 - xi) * (1 - eta),\n            (1 + xi) * (1 - eta),\n            (1 + xi) * (1 + eta),\n            (1 - xi) * (1 + eta)\n        ])\n\n        dN = 0.25 * np.array([\n            [-(1 - eta), -(1 - xi)],\n            [ (1 - eta), -(1 + xi)],\n            [ (1 + eta),  (1 + xi)],\n            [-(1 + eta),  (1 - xi)]\n        ])\n        return N, dN\n\n    def assemble_matrices(epsilon):\n        \"\"\"\n        Assembles the mass matrix M(epsilon) and stiffness matrix K(epsilon)\n        for a given epsilon using 2x2 Gaussian quadrature.\n        \"\"\"\n        M_eps = np.zeros((4, 4), dtype=np.float64)\n        K_eps = np.zeros((4, 4), dtype=np.float64)\n\n        # 2-point Gauss-Legendre quadrature points and weights\n        quad_points = [-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)]\n        quad_weights = [1.0, 1.0]\n\n        # Get Jacobian related terms (constant over the element)\n        det_J = epsilon\n        # J_inv_J_invT is (J^-1)(J^-T). For J = sqrt(eps)*I, this is (1/eps)*I.\n        # The geometric factor in the stiffness integral is (J^-1)(J^-T) * det(J)\n        # which is ((1/eps)*I) * eps = I.\n        # This means K(eps) is independent of epsilon.\n\n        for i, weight_i in enumerate(quad_weights):\n            for j, weight_j in enumerate(quad_weights):\n                xi = quad_points[i]\n                eta = quad_points[j]\n                weight = weight_i * weight_j\n\n                N_vals, dN_vals = get_bilinear_basis(xi, eta)\n\n                # Assemble mass matrix M(epsilon)\n                # Integrand is N_i * N_j * det(J)\n                M_integrand = np.outer(N_vals, N_vals)\n                M_eps += M_integrand * det_J * weight\n\n                # Assemble stiffness matrix K(epsilon)\n                # Integrand is (grad_N_i^T * J_inv_J_invT * grad_N_j) * det(J)\n                # which simplifies to (grad_N_i . grad_N_j)\n                K_integrand = dN_vals @ dN_vals.T\n                K_eps += K_integrand * weight\n        \n        return M_eps, K_eps\n\n    results = []\n    for epsilon in test_cases:\n        M, K = assemble_matrices(epsilon)\n\n        # 1. Compute lambda_max(M(epsilon)) / epsilon\n        # Use eigvalsh for symmetric matrices\n        lambda_max_M = linalg.eigvalsh(M).max()\n        ratio_1 = lambda_max_M / epsilon\n\n        # 2. Compute lambda_max(K(epsilon))\n        lambda_max_K = linalg.eigvalsh(K).max()\n\n        # 3. Compute largest stable Forward Euler time step\n        # dt_max = 2 / rho(M^-1 * K)\n        # We solve the generalized eigenvalue problem K*v = lambda*M*v\n        # This is more stable than inverting M.\n        # The eigenvalues are real since K, M are symmetric and M is pos-def.\n        gen_eigenvalues = linalg.eigh(K, M, eigvals_only=True)\n        spectral_radius = np.max(gen_eigenvalues)\n        \n        # Handle the case where the spectral radius is zero (e.g., if K is all zeros)\n        if np.isclose(spectral_radius, 0):\n            dt_max = np.inf\n        else:\n            dt_max = 2.0 / spectral_radius\n        \n        results.append([ratio_1, lambda_max_K, dt_max])\n\n    # Format the final output string exactly as required.\n    formatted_results = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3439531"}, {"introduction": "在开发数值方法时，为了简化计算，人们有时会引入近似，例如使用平均或“冻结”的雅可比矩阵。虽然这可以节省计算成本，但可能会破坏离散系统的基本数学性质。本练习展示了在保持双线性形式对称性方面，一致的几何变换的至关重要性。通过计算一个不一致近似的双线性形式的“对称性缺陷”，你将亲眼见证看似无害的简化如何破坏底层的数学结构。这强调了严格应用变量替换公式的必要性，并突出了有限元方法实现中的一个潜在陷阱。[@problem_id:3439550]", "problem": "考虑一个参考域为 $\\hat K = [0,1]^{2}$ 的单元等参元，以及一个 $C^{1}$ 等参映射 $F_{K}:\\hat K \\to K$，其雅可比矩阵为 $J(\\hat{\\boldsymbol{x}})$，其中 $\\hat{\\boldsymbol{x}} = (\\xi,\\eta)$。对于一个标量二阶椭圆型偏微分方程（PDE），其单元双线性形式定义为 $a_{K}(u,v) = \\int_{K} \\nabla_{x} u \\cdot \\nabla_{x} v \\, \\mathrm{d}x$，其中 $u$ 和 $v$ 是定义在 $K$ 上的足够光滑的函数。仅从链式法则和变量替换公式出发，推导参考元 $\\hat K$ 上的拉回双线性形式的表达式，用 $J(\\hat{\\boldsymbol{x}})$ 和关于参考坐标的梯度来表示。\n\n接下来，定义一个特定的等参映射 $F_{K}(\\xi,\\eta) = \\big(\\xi + \\gamma\\,\\xi\\eta,\\;\\eta\\big)$，其中参数 $\\gamma \\in \\mathbb{R}$ 满足对于所有 $\\eta\\in[0,1]$ 都有 $1+\\gamma\\eta0$（以确保定向保持）。令 $\\hat J = J(\\xi_{0},\\eta_{0})$ 是一个常数近似雅可比矩阵，通过将 $J$ 在单元中心点 $(\\xi_{0},\\eta_{0}) = \\left(\\tfrac{1}{2},\\tfrac{1}{2}\\right)$ 处的值固定而得到。考虑一种非协调的近似拉回，其中度量张量由“试验”侧的近似逆和“测试”侧的精确逆混合而成，即\n$$\nG_{\\mathrm{appr}}(\\hat{\\boldsymbol{x}}) = \\det\\big(J(\\hat{\\boldsymbol{x}})\\big)\\,\\hat J^{-1}\\,J(\\hat{\\boldsymbol{x}})^{-T},\n$$\n由此得到的近似双线性形式为\n$$\na_{\\mathrm{appr}}(u,v) = \\int_{\\hat K} \\nabla_{\\hat{\\boldsymbol{x}}} u(\\hat{\\boldsymbol{x}})^{\\!T}\\,G_{\\mathrm{appr}}(\\hat{\\boldsymbol{x}})\\,\\nabla_{\\hat{\\boldsymbol{x}}} v(\\hat{\\boldsymbol{x}})\\,\\mathrm{d}\\hat{\\boldsymbol{x}}.\n$$\n使用测试函数 $u(\\xi,\\eta) = \\xi$ 和 $v(\\xi,\\eta) = \\eta^{2}$，计算对称性缺陷\n$$\na_{\\mathrm{appr}}(u,v)\\;-\\;a_{\\mathrm{appr}}(v,u)\n$$\n的解析值，以关于 $\\gamma$ 的闭式表达式给出。无需进行数值舍入；请提供精确表达式作为最终答案。", "solution": "**第1部分：拉回双线性形式的推导**\n\n令 $\\hat{u}(\\hat{\\boldsymbol{x}}) = u(F_K(\\hat{\\boldsymbol{x}}))$ 和 $\\hat{v}(\\hat{\\boldsymbol{x}}) = v(F_K(\\hat{\\boldsymbol{x}}))$ 是函数 $u$ 和 $v$ 与映射 $F_K$ 的复合。函数关于物理坐标 $\\boldsymbol{x}$ 的梯度记为 $\\nabla_x$，关于参考坐标 $\\hat{\\boldsymbol{x}}$ 的梯度记为 $\\nabla_{\\hat{\\boldsymbol{x}}}$。链式法则关联了这些梯度：\n$$\n\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{u} = J(\\hat{\\boldsymbol{x}})^T \\nabla_x u\n$$\n其中 $J(\\hat{\\boldsymbol{x}})$ 是变换 $F_K$ 的雅可比矩阵。为了用参考梯度表示物理梯度，我们对此关系求逆：\n$$\n\\nabla_x u = J(\\hat{\\boldsymbol{x}})^{-T} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{u}\n$$\n物理元 $K$ 上的双线性形式由 $a_{K}(u,v) = \\int_{K} \\nabla_{x} u \\cdot \\nabla_{x} v \\, \\mathrm{d}x$ 给出。我们可以使用矩阵表示法将点积重写为 $(\\nabla_x u)^T (\\nabla_x v)$。代入物理梯度的表达式，我们得到：\n$$\n\\nabla_{x} u \\cdot \\nabla_{x} v = \\left( J^{-T} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{u} \\right)^T \\left( J^{-T} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{v} \\right) = (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{u})^T J^{-1} J^{-T} (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{v})\n$$\n接下来，我们应用积分的变量替换公式，它关联了微分体积元：\n$$\n\\mathrm{d}x = \\det(J(\\hat{\\boldsymbol{x}})) \\, \\mathrm{d}\\hat{\\boldsymbol{x}}\n$$\n将这些代入 $a_K(u,v)$ 的定义中，我们得到参考元 $\\hat{K}$ 上的拉回双线性形式 $\\hat{a}_K(\\hat{u},\\hat{v})$：\n$$\n\\hat{a}_K(\\hat{u},\\hat{v}) = \\int_{\\hat{K}} (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{u})^T \\left( \\det(J) J^{-1} J^{-T} \\right) (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{v}) \\, \\mathrm{d}\\hat{\\boldsymbol{x}}\n$$\n矩阵 $G(\\hat{\\boldsymbol{x}}) = \\det(J(\\hat{\\boldsymbol{x}})) J(\\hat{\\boldsymbol{x}})^{-1} J(\\hat{\\boldsymbol{x}})^{-T}$ 通常被称为变换到参考坐标的度量张量。这就完成了问题的第一部分。\n\n**第2部分：对称性缺陷的计算**\n\n我们得到特定的映射 $F_{K}(\\xi,\\eta) = (x_1, x_2) = (\\xi + \\gamma\\xi\\eta, \\eta)$。\n\n1.  **计算雅可比矩阵 $J(\\hat{\\boldsymbol{x}})$ 及相关量。**\n    雅可比矩阵是 $J = \\begin{pmatrix} \\frac{\\partial x_1}{\\partial \\xi}  \\frac{\\partial x_1}{\\partial \\eta} \\\\ \\frac{\\partial x_2}{\\partial \\xi}  \\frac{\\partial x_2}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} 1+\\gamma\\eta  \\gamma\\xi \\\\ 0  1 \\end{pmatrix}$。\n    行列式是 $\\det(J) = 1+\\gamma\\eta$。条件 $1+\\gamma\\eta0$ 确保了映射是保向的。\n    逆转置是 $J^{-T} = \\left( \\frac{1}{1+\\gamma\\eta} \\begin{pmatrix} 1  -\\gamma\\xi \\\\ 0  1+\\gamma\\eta \\end{pmatrix} \\right)^T = \\begin{pmatrix} \\frac{1}{1+\\gamma\\eta}  0 \\\\ \\frac{-\\gamma\\xi}{1+\\gamma\\eta}  1 \\end{pmatrix}$。\n\n2.  **计算常数近似雅可比矩阵 $\\hat{J}$ 及其逆矩阵。**\n    $\\hat{J}$ 是 $J$ 在 $(\\xi_0, \\eta_0) = (\\frac{1}{2}, \\frac{1}{2})$ 处的值：\n    $\\hat{J} = J(\\tfrac{1}{2}, \\tfrac{1}{2}) = \\begin{pmatrix} 1+\\frac{\\gamma}{2}  \\frac{\\gamma}{2} \\\\ 0  1 \\end{pmatrix}$。\n    $\\hat{J}$ 的逆是 $\\hat{J}^{-1} = \\frac{1}{1+\\gamma/2} \\begin{pmatrix} 1  -\\frac{\\gamma}{2} \\\\ 0  1+\\frac{\\gamma}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{1+\\gamma/2}  \\frac{-\\gamma/2}{1+\\gamma/2} \\\\ 0  1 \\end{pmatrix}$。\n\n3.  **构建近似度量张量 $G_{\\mathrm{appr}}(\\hat{\\boldsymbol{x}})$。**\n    $G_{\\mathrm{appr}} = \\det(J) \\hat{J}^{-1} J^{-T}$。\n    $$\n    G_{\\mathrm{appr}} = (1+\\gamma\\eta) \\begin{pmatrix} \\frac{1}{1+\\gamma/2}  \\frac{-\\gamma/2}{1+\\gamma/2} \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{1+\\gamma\\eta}  0 \\\\ \\frac{-\\gamma\\xi}{1+\\gamma\\eta}  1 \\end{pmatrix}\n    $$\n    将矩阵相乘：\n    $$\n    G_{\\mathrm{appr}} = \\frac{1}{1+\\gamma/2} \\begin{pmatrix} 1+\\gamma^2\\xi/2  -\\frac{\\gamma}{2}(1+\\gamma\\eta) \\\\ -(1+\\gamma/2)\\gamma\\xi  (1+\\gamma/2)(1+\\gamma\\eta) \\end{pmatrix}\n    $$\n    矩阵 $G_{\\mathrm{appr}}$ 通常不是对称的，这是产生缺陷的根源。\n\n4.  **计算 $a_{\\mathrm{appr}}(u,v)$ 和 $a_{\\mathrm{appr}}(v,u)$ 的被积函数。**\n    测试函数为 $u(\\xi, \\eta) = \\xi$ 和 $v(\\xi, \\eta) = \\eta^2$。它们的梯度是：\n    $$\n    \\nabla_{\\hat{\\boldsymbol{x}}} u = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_{\\hat{\\boldsymbol{x}}} v = \\begin{pmatrix} 0 \\\\ 2\\eta \\end{pmatrix}\n    $$\n    $a_{\\mathrm{appr}}(u,v)$ 的被积函数是 $(\\nabla_{\\hat{\\boldsymbol{x}}}u)^T G_{\\mathrm{appr}} (\\nabla_{\\hat{\\boldsymbol{x}}}v)$：\n    $$\n    \\begin{pmatrix} 1  0 \\end{pmatrix} G_{\\mathrm{appr}} \\begin{pmatrix} 0 \\\\ 2\\eta \\end{pmatrix} = 2\\eta \\cdot (G_{\\mathrm{appr}})_{12} = 2\\eta \\left( \\frac{-\\frac{\\gamma}{2}(1+\\gamma\\eta)}{1+\\gamma/2} \\right) = \\frac{-\\gamma\\eta(1+\\gamma\\eta)}{1+\\gamma/2}\n    $$\n    $a_{\\mathrm{appr}}(v,u)$ 的被积函数是 $(\\nabla_{\\hat{\\boldsymbol{x}}}v)^T G_{\\mathrm{appr}} (\\nabla_{\\hat{\\boldsymbol{x}}}u)$：\n    $$\n    \\begin{pmatrix} 0  2\\eta \\end{pmatrix} G_{\\mathrm{appr}} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = 2\\eta \\cdot (G_{\\mathrm{appr}})_{21} = 2\\eta \\left( \\frac{-(1+\\gamma/2)\\gamma\\xi}{1+\\gamma/2} \\right) = -2\\gamma\\xi\\eta\n    $$\n\n5.  **计算积分。**\n    积分区域是 $\\hat{K} = [0,1]^2$。\n    $$\n    a_{\\mathrm{appr}}(u,v) = \\int_0^1 \\int_0^1 \\frac{-\\gamma(\\eta+\\gamma\\eta^2)}{1+\\gamma/2} \\,d\\xi d\\eta = \\frac{-\\gamma}{1+\\gamma/2} \\left( \\int_0^1 d\\xi \\right) \\left( \\int_0^1 (\\eta+\\gamma\\eta^2)d\\eta \\right)\n    $$\n    $$\n    a_{\\mathrm{appr}}(u,v) = \\frac{-\\gamma}{1+\\gamma/2} (1) \\left[ \\frac{\\eta^2}{2} + \\frac{\\gamma\\eta^3}{3} \\right]_0^1 = \\frac{-\\gamma}{1+\\gamma/2} \\left( \\frac{1}{2} + \\frac{\\gamma}{3} \\right)\n    $$\n    $$\n    a_{\\mathrm{appr}}(v,u) = \\int_0^1 \\int_0^1 -2\\gamma\\xi\\eta \\,d\\xi d\\eta = -2\\gamma \\left( \\int_0^1 \\xi d\\xi \\right) \\left( \\int_0^1 \\eta d\\eta \\right)\n    $$\n    $$\n    a_{\\mathrm{appr}}(v,u) = -2\\gamma \\left( \\frac{1}{2} \\right) \\left( \\frac{1}{2} \\right) = -\\frac{\\gamma}{2}\n    $$\n\n6.  **计算对称性缺陷。**\n    缺陷是 $a_{\\mathrm{appr}}(u,v) - a_{\\mathrm{appr}}(v,u)$。\n    $$\n    \\text{Defect} = \\frac{-\\gamma}{1+\\gamma/2} \\left( \\frac{1}{2} + \\frac{\\gamma}{3} \\right) - \\left(-\\frac{\\gamma}{2}\\right) = \\frac{-\\gamma(\\frac{3+2\\gamma}{6})}{\\frac{2+\\gamma}{2}} + \\frac{\\gamma}{2}\n    $$\n    $$\n    \\text{Defect} = \\frac{-2\\gamma(3+2\\gamma)}{6(2+\\gamma)} + \\frac{\\gamma}{2} = \\frac{-\\gamma(3+2\\gamma)}{3(2+\\gamma)} + \\frac{\\gamma}{2}\n    $$\n    通分到 $6(2+\\gamma)$：\n    $$\n    \\text{Defect} = \\frac{-2\\gamma(3+2\\gamma) + 3\\gamma(2+\\gamma)}{6(2+\\gamma)} = \\frac{-6\\gamma - 4\\gamma^2 + 6\\gamma + 3\\gamma^2}{6(2+\\gamma)}\n    $$\n    $$\n    \\text{Defect} = \\frac{-\\gamma^2}{6(2+\\gamma)}\n    $$\n    这是对称性缺陷的最终闭式表达式。", "answer": "$$\\boxed{\\frac{-\\gamma^2}{6(2+\\gamma)}}$$", "id": "3439550"}]}