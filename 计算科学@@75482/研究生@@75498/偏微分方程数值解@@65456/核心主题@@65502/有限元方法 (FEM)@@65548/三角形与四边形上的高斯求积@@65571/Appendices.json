{"hands_on_practices": [{"introduction": "在三角形上直接应用张量积求积法则通常是不可行的，但我们可以通过坐标变换来解决这个问题。本练习将介绍一种强大的技术——Duffy变换，它能将标准三角形映射到标准正方形上。通过完成这个变换过程 [@problem_id:3398652]，您将亲手实践坐标变换、计算雅可比行列式，并学会如何为变换后的积分确定保证精确结果所需的求积阶数。", "problem": "设 $T$ 为参考三角形 $T=\\{(x,y)\\in\\mathbb{R}^{2}: x\\ge 0,\\ y\\ge 0,\\ x+y\\le 1\\}$，并设 $S=[0,1]^{2}$ 为单位正方形。考虑积分\n$$\nI=\\iint_{T} x^{2}\\,y^{5}\\,\\bigl(1-x-y\\bigr)^{3}\\,dx\\,dy.\n$$\n仅从多元积分的变量替换定理和 $[-1,1]$ 上 $m$ 点 Gauss–Legendre 法则的多项式精确性（该法则对所有次数最高为 $2m-1$ 的多项式都精确）出发，完成以下任务：\n\n(i) 构造一个 Duffy 型映射 $F:S\\to T$，它将 $S$ 中的一条坐标线压缩到 $T$ 的一个顶点，并将 $S$ 的边映射到 $T$ 的边。推导其雅可比行列式 $J(u,v)$。\n\n(ii) 使用此映射将 $I$ 变换为 $S$ 上的一个累次积分，并尽可能简化变换后的被积函数，将其表示为 $u$ 和 $v$ 的一维因子与 $|J(u,v)|$ 的乘积。\n\n(iii) 根据所得的 $u$ 和 $v$ 的一维多项式因子的次数，确定最小的 Gauss–Legendre 阶数 $m_{u}$ 和 $m_{v}$，使得 $S$ 上的张量积法则对变换后的被积函数是精确的。\n\n(iv) 精确计算 $I$。\n\n你的最终答案必须是 $I$ 的精确值，形式为一个简化的数字或一个闭式解析表达式，不带单位。不要四舍五入。", "solution": "该问题被评估为有效，因为它在科学上基于多元微积分和数值分析理论，提法恰当，目标明确，并且没有任何矛盾、歧义或不合理的假设。\n\n问题要求在参考三角形 $T=\\{(x,y)\\in\\mathbb{R}^{2}: x\\ge 0,\\ y\\ge 0,\\ x+y\\le 1\\}$ 上计算积分\n$$\nI=\\iint_{T} x^{2}\\,y^{5}\\,\\bigl(1-x-y\\bigr)^{3}\\,dx\\,dy\n$$\n，并遵循一个涉及 Duffy 型变换的特定步骤。\n\n(i) 映射的构造及其雅可比行列式\n一个从单位正方形 $S=[0,1]^{2}$ 到参考三角形 $T$ 的 Duffy 型映射 $F:S \\to T$ 可以通过以下方式定义：让第一个坐标直接映射到 $x$，然后缩放第二个坐标以适应剩余的三角形区域。设 $(u,v) \\in S$。我们将映射 $F(u,v) = (x,y)$ 定义为：\n$$\nx(u,v) = u\n$$\n$$\ny(u,v) = v(1-u)\n$$\n我们验证这个映射。定义域为 $(u,v) \\in [0,1] \\times [0,1]$。\n对于任何 $(u,v) \\in S$：\n- $x=u \\ge 0$。\n- 因为 $u \\le 1$ 且 $v \\ge 0$，我们有 $y = v(1-u) \\ge 0$。\n- $x+y = u+v(1-u)$。因为 $v \\le 1$，所以 $x+y \\le u+(1-u)=1$。\n因此，$S$ 的像包含在 $T$ 中。\n我们来检查边界：\n- $S$ 中的边 $u=0$ 映射到 $(x,y)=(0,v)$（其中 $v \\in [0,1]$），这是 $T$ 的垂直边。\n- $S$ 中的边 $u=1$ 映射到 $(x,y)=(1,0)$，这是 $T$ 的一个顶点。这满足了将一条坐标线压缩到一个顶点的要求。\n- $S$ 中的边 $v=0$ 映射到 $(x,y)=(u,0)$（其中 $u \\in [0,1]$），这是 $T$ 的水平边。\n- $S$ 中的边 $v=1$ 映射到 $(x,y)=(u, 1-u)$，这对应于 $T$ 的斜边 $x+y=1$。\n该映射是从 $S$ 的内部到 $T$ 的内部的一个双射。\n\n为了求雅可比行列式，我们首先计算雅可比矩阵 $\\mathbf{J}_F(u,v)$：\n$$\n\\mathbf{J}_F(u,v) = \\begin{pmatrix} \\frac{\\partial x}{\\partial u}  \\frac{\\partial x}{\\partial v} \\\\ \\frac{\\partial y}{\\partial u}  \\frac{\\partial y}{\\partial v} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ -v  1-u \\end{pmatrix}\n$$\n雅可比行列式，记为 $J(u,v)$，是：\n$$\nJ(u,v) = \\det(\\mathbf{J}_F(u,v)) = (1)(1-u) - (0)(-v) = 1-u\n$$\n\n(ii) 积分的变换\n使用多重积分的变量替换定理，我们有 $dx\\,dy = |J(u,v)|\\,du\\,dv$。由于 $u \\in [0,1]$，所以 $|J(u,v)| = |1-u| = 1-u$。\n积分 $I$ 变换如下：\n$$\nI = \\iint_{S} f(x(u,v), y(u,v)) |J(u,v)| \\,du\\,dv\n$$\n其中 $f(x,y) = x^2 y^5 (1-x-y)^3$。我们用 $u$ 和 $v$ 的表达式代入 $x$、$y$ 和 $1-x-y$：\n- $x = u$\n- $y = v(1-u)$\n- $1-x-y = 1-u-v(1-u) = (1-u)(1-v)$\n$f(x(u,v), y(u,v))$ 项变为：\n$$\n(u)^2 [v(1-u)]^5 [(1-u)(1-v)]^3 = u^2 v^5 (1-u)^5 (1-u)^3 (1-v)^3 = u^2 v^5 (1-u)^8 (1-v)^3\n$$\n在 $(u,v)$ 坐标系下的完整被积函数是这个表达式乘以 $|J(u,v)| = 1-u$：\n$$\n\\text{被积函数} = \\left( u^2 v^5 (1-u)^8 (1-v)^3 \\right) (1-u) = u^2 v^5 (1-u)^9 (1-v)^3\n$$\n在正方形 $S=[0,1]^2$ 上的积分 $I$ 是：\n$$\nI = \\int_{0}^{1} \\int_{0}^{1} u^2 (1-u)^9 v^5 (1-v)^3 \\,du\\,dv\n$$\n被积函数是一个关于 $u$ 的函数和一个关于 $v$ 的函数的乘积。我们可以将累次积分分离成两个一维积分的乘积：\n$$\nI = \\left(\\int_{0}^{1} u^2 (1-u)^9 \\,du\\right) \\left(\\int_{0}^{1} v^5 (1-v)^3 \\,dv\\right)\n$$\n\n(iii) 最小 Gauss-Legendre 阶数\n如果一维求积法则对各自的多项式因子是精确的，那么张量积求积法则对于变换后的积分将是精确的。$m$ 点 Gauss-Legendre 法则对次数最高为 $2m-1$ 的多项式是精确的。该法则的积分区间是 $[-1,1]$，但其精确次数与区间的线性映射无关。\n$u$-积分中的多项式因子是 $P_u(u) = u^2(1-u)^9$。其次数为 $2+9=11$。\n为了使 $u$-积分能被一个 $m_u$ 点的 Gauss-Legendre 法则精确计算，我们必须有：\n$$\n2m_u - 1 \\ge 11 \\implies 2m_u \\ge 12 \\implies m_u \\ge 6\n$$\n$u$-方向的最小阶数是 $m_u = 6$。\n\n$v$-积分中的多项式因子是 $P_v(v) = v^5(1-v)^3$。其次数为 $5+3=8$。\n为了使 $v$-积分能被一个 $m_v$ 点的 Gauss-Legendre 法则精确计算，我们必须有：\n$$\n2m_v - 1 \\ge 8 \\implies 2m_v \\ge 9 \\implies m_v \\ge 4.5\n$$\n由于点数 $m_v$ 必须是整数，因此 $v$-方向的最小阶数是 $m_v = 5$。\n\n(iv) 积分的精确计算\n这两个一维积分是欧拉 Beta 函数的实例，其定义为：\n$$\nB(z_1, z_2) = \\int_{0}^{1} t^{z_1-1} (1-t)^{z_2-1} \\,dt = \\frac{\\Gamma(z_1)\\Gamma(z_2)}{\\Gamma(z_1+z_2)}\n$$\n其中 $\\Gamma(z)$ 是伽马函数。对于正整数 $n$，$\\Gamma(n)=(n-1)!$。\n\n关于 $u$ 的积分是：\n$$\n\\int_{0}^{1} u^2 (1-u)^9 \\,du = B(3, 10) = \\frac{\\Gamma(3)\\Gamma(10)}{\\Gamma(13)} = \\frac{2!\\,9!}{12!} = \\frac{2 \\cdot 1}{12 \\cdot 11 \\cdot 10} = \\frac{2}{1320} = \\frac{1}{660}\n$$\n关于 $v$ 的积分是：\n$$\n\\int_{0}^{1} v^5 (1-v)^3 \\,dv = B(6, 4) = \\frac{\\Gamma(6)\\Gamma(4)}{\\Gamma(10)} = \\frac{5!\\,3!}{9!} = \\frac{120 \\cdot 6}{9 \\cdot 8 \\cdot 7 \\cdot 6 \\cdot 5!} = \\frac{720}{362880} = \\frac{1}{504}\n$$\n最后，$I$ 的值是这两个结果的乘积：\n$$\nI = \\left(\\frac{1}{660}\\right) \\left(\\frac{1}{504}\\right) = \\frac{1}{660 \\times 504}\n$$\n乘积是 $660 \\times 504 = 660 \\times (500 + 4) = 330000 + 2640 = 332640$。\n因此，该积分的精确值是：\n$$\nI = \\frac{1}{332640}\n$$\n或者，不提早约去公因数：\n$$\nI = B(3,10) \\cdot B(6,4) = \\frac{\\Gamma(3)\\Gamma(10)}{\\Gamma(13)} \\cdot \\frac{\\Gamma(6)\\Gamma(4)}{\\Gamma(10)} = \\frac{\\Gamma(3)\\Gamma(6)\\Gamma(4)}{\\Gamma(13)} = \\frac{2!\\,5!\\,3!}{12!}\n$$\n$$\nI = \\frac{(2)(120)(6)}{479001600} = \\frac{1440}{479001600} = \\frac{144}{47900160} = \\frac{1}{332640}\n$$", "answer": "$$\\boxed{\\frac{1}{332640}}$$", "id": "3398652"}, {"introduction": "在有限元方法中，理论上的积分几乎总是通过数值方法计算的。这个编程练习 [@problem_id:3398694] 要求您量化高斯求积（尤其是在扭曲单元上）的误差如何传递到刚度矩阵，并最终影响解的能量（$H^1$-半范数）。这项实践为您在抽象的求积理论与其实际影响（物理模拟的准确性和可靠性）之间架起了一座至关重要的桥梁。", "problem": "考虑二维单个四边形有限元上的标量泊松方程，其中局部刚度矩阵源于弱形式，节点函数的离散 $H^1$半范数由该刚度矩阵引发的双线性形式表示。该问题的基本原理包括泊松方程的弱形式、四边形单元的等参映射以及张量积域上的高斯求积。具体而言，从弱形式出发，单元级刚度矩阵的各项定义为\n$$K_{ij} = \\int_{\\hat{\\Omega}} \\left(\\nabla N_i(\\boldsymbol{x}(\\boldsymbol{\\xi}))\\right) \\cdot \\left(\\nabla N_j(\\boldsymbol{x}(\\boldsymbol{\\xi}))\\right) \\,\\det\\left(J(\\boldsymbol{\\xi})\\right)\\, \\mathrm{d}\\boldsymbol{\\xi},$$\n其中 $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ 是参考正方形，$\\boldsymbol{\\xi} = (\\xi,\\eta)$ 是参考坐标，$\\boldsymbol{x}(\\boldsymbol{\\xi})$ 是到物理坐标的等参映射，$N_i$ 是参考正方形上的双线性（$Q_1$）形函数，$J(\\boldsymbol{\\xi})$ 是映射的雅可比矩阵。物理梯度满足\n$$\\nabla N_i(\\boldsymbol{x}(\\boldsymbol{\\xi})) = J(\\boldsymbol{\\xi})^{-\\top} \\, \\nabla_{\\boldsymbol{\\xi}} N_i(\\boldsymbol{\\xi}),$$\n其中 $J(\\boldsymbol{\\xi})$ 通常随 $\\boldsymbol{\\xi}$ 变化。单元上节点向量 $\\boldsymbol{u}$ 的离散 $H^1$半范数由下式给出\n$$|\\!|\\!|u_h|\\!|\\!|_{H^1(\\Omega_e)}^2 = \\boldsymbol{u}^\\top K \\boldsymbol{u}。$$\n在 $\\hat{\\Omega}$ 上使用每个坐标方向 $n$ 个点的张量积高斯求积法则，可得到近似值\n$$K_{ij}^{(n)} = \\sum_{a=1}^{n}\\sum_{b=1}^{n} w_a w_b \\left(\\nabla N_i(\\boldsymbol{x}(\\xi_a,\\eta_b))\\right) \\cdot \\left(\\nabla N_j(\\boldsymbol{x}(\\xi_a,\\eta_b))\\right) \\,\\det\\left(J(\\xi_a,\\eta_b)\\right),$$\n其中 $\\{(\\xi_a,w_a)\\}_{a=1}^n$ 和 $\\{(\\eta_b,w_b)\\}_{b=1}^n$ 分别是 $[-1,1]$ 上的一维高斯求积节点和权重。求积误差会以标量差的形式传播到离散 $H^1$半范数中\n$$\\Delta_n(\\boldsymbol{u}) = \\left|\\boldsymbol{u}^\\top K \\boldsymbol{u} - \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u}\\right|。$$\n您的任务是为一组具有不同扭曲程度的四边形单元定量评估 $\\Delta_n(\\boldsymbol{u})$，其中包括雅可比行列式 $\\det(J(\\boldsymbol{\\xi}))$ 在 $\\hat{\\Omega}$ 上快速变化的情况。使用每个坐标方向有 $n_{\\text{exact}}$ 个点的高阶张量积高斯求积作为精确积分的替代。对于 $Q_1$ 单元，定义参考双线性基函数 $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$、$N_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$、$N_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$、$N_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$，并解析计算它们的参考梯度 $\\nabla_{\\boldsymbol{\\xi}} N_i(\\xi,\\eta)$。通过标准插值 $\\boldsymbol{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\boldsymbol{x}_i$ 构建等参映射，其中 $\\{\\boldsymbol{x}_i\\}_{i=1}^4$ 是下面以逆时针顺序列出的物理顶点坐标。\n\n实现一个程序，该程序：\n- 使用每个坐标方向 $n$ 个点的张量积高斯求积来组装局部刚度矩阵 $K^{(n)}$。\n- 使用每个坐标方向 $n_{\\text{exact}} = 20$ 个点来组装一个高精度的参考矩阵 $K^{(n_{\\text{exact}})}$。\n- 计算离散 $H^1$半范数差 $\\Delta_n(\\boldsymbol{u}) = \\left|\\boldsymbol{u}^\\top K^{(n_{\\text{exact}})} \\boldsymbol{u} - \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u}\\right|$。\n\n使用以下参数值测试套件，其选择旨在检验不同的行为：\n- 测试用例 1（仿射，常数函数；边界行为）：单元顶点 $\\left((0.0,0.0),(1.0,0.0),(1.0,1.0),(0.0,1.0)\\right)$，节点向量 $\\boldsymbol{u} = (1.0,1.0,1.0,1.0)$，求积阶数 $n=1$。\n- 测试用例 2（仿射，平行四边形；理想路径）：单元顶点 $\\left((0.0,0.0),(2.0,0.1),(2.2,1.1),(0.2,1.0)\\right)$，节点向量 $\\boldsymbol{u} = (0.3,0.7,1.1,-0.2)$，求积阶数 $n=1$。\n- 测试用例 3（轻度扭曲；非仿射，不存在快速变化的雅可比行列式）：单元顶点 $\\left((0.0,0.0),(2.0,0.0),(1.9,1.0),(0.0,1.0)\\right)$，节点向量 $\\boldsymbol{u} = (0.3,0.7,1.1,-0.2)$，求积阶数 $n=1$。\n- 测试用例 4（轻度扭曲；改进的求积）：与测试用例 3 相同的顶点，相同的 $\\boldsymbol{u}$，求积阶数 $n=2$。\n- 测试用例 5（重度扭曲；具有快速变化的雅可比行列式的非仿射情况）：单元顶点 $\\left((0.0,0.0),(2.0,-0.3),(2.3,1.1),(0.0,1.0)\\right)$，节点向量 $\\boldsymbol{u} = (0.3,0.7,1.1,-0.2)$，求积阶数 $n=2$。\n- 测试用例 6（重度扭曲；更高阶的求积）：与测试用例 5 相同的顶点，相同的 $\\boldsymbol{u}$，求积阶数 $n=3$。\n\n对于所有测试用例，设置 $n_{\\text{exact}} = 20$ 以获得参考刚度矩阵。最终所需的输出是单行文本，包含一个逗号分隔的列表，其中是与给定顺序的测试用例相对应的六个标量误差 $\\left[\\Delta_{n}(\\boldsymbol{u})\\right]$。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\left[ r_1, r_2, r_3, r_4, r_5, r_6 \\right]$）。此处不涉及物理单位；返回纯实数。不出现角度。将每个结果表示为浮点数。", "solution": "用户提供的问题经确认为具有科学依据、适定、完整且客观。它代表了有限元法（FEM）分析领域中的一个标准数值验证任务。所有必要的数据、方程和定义均已提供。该问题没有矛盾、歧义或伪科学论断。因此，我们可以着手求解。\n\n### 第1步：理论公式\n\n该问题要求计算四边形有限元上离散 $H^1$半范数的误差，该误差源于使用 $n$ 阶数值求积来近似单元刚度矩阵。\n\n对于双线性四边形（$Q_1$）单元，单元刚度矩阵 $K$ 是一个 $4 \\times 4$ 矩阵，其各项由在参考正方形 $\\hat{\\Omega} = [-1,1] \\times [-1,1]$ 上的积分给出：\n$$\nK_{ij} = \\int_{\\hat{\\Omega}} \\left(\\nabla_{\\boldsymbol{x}} N_i\\right) \\cdot \\left(\\nabla_{\\boldsymbol{x}} N_j\\right) \\det(J(\\boldsymbol{\\xi})) \\, \\mathrm{d}\\boldsymbol{\\xi}\n$$\n此处，$N_i(\\boldsymbol{\\xi})$ 是参考单元上的双线性形函数，$\\boldsymbol{\\xi} = (\\xi, \\eta)$ 是 $\\hat{\\Omega}$ 上的坐标，$J(\\boldsymbol{\\xi})$ 是等参映射 $\\boldsymbol{x}(\\boldsymbol{\\xi})$ 的雅可比矩阵，$\\nabla_{\\boldsymbol{x}}$ 表示关于物理坐标 $\\boldsymbol{x}$ 的梯度。\n\n等参映射利用形函数自身将参考坐标 $\\boldsymbol{\\xi}$ 与物理坐标 $\\boldsymbol{x}$ 关联起来：\n$$\n\\boldsymbol{x}(\\boldsymbol{\\xi}) = \\sum_{k=1}^{4} N_k(\\boldsymbol{\\xi}) \\boldsymbol{x}_k\n$$\n其中 $\\boldsymbol{x}_k$ 是单元四个顶点的物理坐标。该映射的雅可比矩阵为：\n$$\nJ(\\boldsymbol{\\xi}) = \\frac{\\partial \\boldsymbol{x}}{\\partial \\boldsymbol{\\xi}} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\sum_k \\frac{\\partial N_k}{\\partial \\xi} x_k  \\sum_k \\frac{\\partial N_k}{\\partial \\eta} x_k \\\\ \\sum_k \\frac{\\partial N_k}{\\partial \\xi} y_k  \\sum_k \\frac{\\partial N_k}{\\partial \\eta} y_k \\end{pmatrix}\n$$\n链式法则将物理梯度 $\\nabla_{\\boldsymbol{x}} N_i$ 与参考梯度 $\\nabla_{\\boldsymbol{\\xi}} N_i$ 关联起来：\n$$\n\\nabla_{\\boldsymbol{\\xi}} N_i = J(\\boldsymbol{\\xi})^\\top \\nabla_{\\boldsymbol{x}} N_i \\quad \\implies \\quad \\nabla_{\\boldsymbol{x}} N_i = J(\\boldsymbol{\\xi})^{-\\top} \\nabla_{\\boldsymbol{\\xi}} N_i\n$$\n$Q_1$ 基函数 $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$、$N_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$、$N_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$ 和 $N_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$ 的参考梯度可解析计算如下：\n\\begin{align*}\n\\nabla_{\\boldsymbol{\\xi}} N_1 = \\frac{1}{4} \\begin{pmatrix} -(1-\\eta) \\\\ -(1-\\xi) \\end{pmatrix},  \\quad \\nabla_{\\boldsymbol{\\xi}} N_2 = \\frac{1}{4} \\begin{pmatrix} 1-\\eta \\\\ -(1+\\xi) \\end{pmatrix} \\\\\n\\nabla_{\\boldsymbol{\\xi}} N_3 = \\frac{1}{4} \\begin{pmatrix} 1+\\eta \\\\ 1+\\xi \\end{pmatrix},  \\quad \\nabla_{\\boldsymbol{\\xi}} N_4 = \\frac{1}{4} \\begin{pmatrix} -(1+\\eta) \\\\ 1-\\xi \\end{pmatrix}\n\\end{align*}\n\n$K_{ij}$ 的积分使用 $n \\times n$ 张量积高斯求积法则进行近似：\n$$\nK_{ij}^{(n)} \\approx \\sum_{a=1}^{n}\\sum_{b=1}^{n} w_a w_b \\left[ \\left( J^{-\\top} \\nabla_{\\boldsymbol{\\xi}} N_i \\right) \\cdot \\left( J^{-\\top} \\nabla_{\\boldsymbol{\\xi}} N_j \\right) \\det(J) \\right]_{\\boldsymbol{\\xi}=(\\xi_a,\\eta_b)}\n$$\n其中 $(\\xi_a, w_a)$ 和 $(\\eta_b, w_b)$ 是 $[-1,1]$ 上的一维高斯-勒让德求积节点和权重。\n\n最后，由其节点向量 $\\boldsymbol{u}$ 表示的函数 $u_h = \\sum_i u_i N_i$ 的离散 $H^1$半范数为 $|\\!|\\!|u_h|\\!|\\!|_{H^1(\\Omega_e)}^2 = \\boldsymbol{u}^\\top K \\boldsymbol{u}$。由求积引起的主​​要关注量是误差：\n$$\n\\Delta_n(\\boldsymbol{u}) = \\left| \\boldsymbol{u}^\\top K^{(n_{\\text{exact}})} \\boldsymbol{u} - \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u} \\right|\n$$\n其中 $K^{(n_{\\text{exact}})}$ 是使用 $n_{\\text{exact}} = 20$ 计算的高精度参考矩阵。\n\n### 第2步：算法实现\n\n我们开发一个函数 `assemble_stiffness_matrix(vertices, n)`，该函数实现基于求积的 $K^{(n)}$ 组装。\n\n1.  **获取求积法则**：对于给定的阶数 $n$，获取 $[-1,1]$ 上的一维高斯-勒让德节点 $\\{\\xi_a\\}_{a=1}^n$ 和权重 $\\{w_a\\}_{a=1}^n$。`numpy.polynomial.legendre.leggauss` 函数适用于此任务。\n\n2.  **初始化矩阵**：创建一个初始化为零的 $4 \\times 4$ 矩阵 $K^{(n)}$。\n\n3.  **遍历求积点**：遍历所有 $n \\times n$ 对求积点 $(\\xi_a, \\eta_b)$。对于每个点：\n    a.  **计算参考梯度**：在 $(\\xi_a, \\eta_b)$ 处计算 $\\nabla_{\\boldsymbol{\\xi}} N_i$ 对 $i=1..4$ 的解析表达式。将这些存储在一个 $4 \\times 2$ 的矩阵 `ref_grads` 中，其中 `ref_grads[i,:]` 是 $N_{i+1}$ 的梯度向量。\n    b.  **计算雅可比矩阵**：计算 $2 \\times 2$ 的雅可比矩阵 $J$。这可以通过矩阵乘积高效计算：$J = \\boldsymbol{V}^\\top \\cdot \\boldsymbol{G}_{\\boldsymbol{\\xi}}$，其中 $\\boldsymbol{V}$ 是 $4 \\times 2$ 的顶点坐标矩阵，$\\boldsymbol{G}_{\\boldsymbol{\\xi}}$ 是 $4 \\times 2$ 的 `ref_grads` 矩阵。\n    c.  **变换梯度**：计算雅可比矩阵的逆 $J^{-1}$。使用关系 $(\\nabla_{\\boldsymbol{x}} N_i)^\\top = (\\nabla_{\\boldsymbol{\\xi}} N_i)^\\top J^{-1}$ 将所有四个基函数的参考梯度转换为物理梯度。这可以通过单个矩阵运算完成：`phys_grads = ref_grads @ inv_J`。\n    d.  **构造被积函数**：计算物理梯度点积的矩阵 $D_{ij} = (\\nabla_{\\boldsymbol{x}} N_i) \\cdot (\\nabla_{\\boldsymbol{x}} N_j)$。这可计算为 `phys_grads @ phys_grads.T`。\n    e.  **累加**：获取雅可比行列式 $\\det(J)$ 并更新刚度矩阵：$K^{(n)} \\mathrel{+}= D \\times \\det(J) \\times w_a \\times w_b$。\n\n4.  **主循环**：对于提供的每个测试用例：\n    a.  使用给定的求积阶数 $n$ 调用 `assemble_stiffness_matrix` 以获得 $K^{(n)}$。\n    b.  使用 $n_{\\text{exact}}=20$ 调用 `assemble_stiffness_matrix` 以获得参考矩阵 $K^{(n_{\\text{exact}})}$。\n    c.  计算两个二次型 $S_n = \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u}$ 和 $S_{\\text{exact}} = \\boldsymbol{u}^\\top K^{(n_{\\text{exact}})} \\boldsymbol{u}$。\n    d.  计算绝对差 $\\Delta_n(\\boldsymbol{u}) = |S_{\\text{exact}} - S_n|$ 并存储结果。\n\n5.  **输出**：将结果列表格式化为所需的逗号分隔字符串。\n\n此过程在提供的 Python 代码中实现，该代码正确计算了指定测试用例的半范数差异，反映了单元扭曲和求积阶数对刚度矩阵积分精度的影响。", "answer": "```python\nimport numpy as np\n# The problem can be solved using only numpy. Scipy is not required.\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating quadrature error in the H1-seminorm \n    for 2D quadrilateral finite elements.\n    \"\"\"\n\n    def get_ref_grads(xi, eta):\n        \"\"\"\n        Computes the gradients of the 4 bilinear shape functions on the\n        reference element [-1,1]x[-1,1] at point (xi, eta).\n        Ordering is CCW from (-1,-1).\n        \n        Args:\n            xi (float): First coordinate in the reference domain.\n            eta (float): Second coordinate in the reference domain.\n        \n        Returns:\n            numpy.ndarray: A 4x2 array where row i is [dN_i/dxi, dN_i/deta].\n        \"\"\"\n        dN_dxi = 0.25 * np.array([\n            -(1.0 - eta),\n             (1.0 - eta),\n             (1.0 + eta),\n            -(1.0 + eta)\n        ])\n        dN_deta = 0.25 * np.array([\n            -(1.0 - xi),\n            -(1.0 + xi),\n             (1.0 + xi),\n             (1.0 - xi)\n        ])\n        return np.vstack((dN_dxi, dN_deta)).T\n\n    def assemble_stiffness_matrix(vertices, n):\n        \"\"\"\n        Assembles the 4x4 local stiffness matrix for a Q1 quadrilateral element\n        using n-point tensor-product Gaussian quadrature.\n        \n        Args:\n            vertices (numpy.ndarray): 4x2 array of vertex coordinates in CCW order.\n            n (int): Number of Gaussian quadrature points in each direction.\n        \n        Returns:\n            numpy.ndarray: The 4x4 element stiffness matrix.\n        \"\"\"\n        K = np.zeros((4, 4))\n        \n        if n == 0:\n            return K\n\n        # Get 1D Gauss-Legendre quadrature nodes and weights\n        nodes, weights = np.polynomial.legendre.leggauss(n)\n        \n        # Tensor-product quadrature loops\n        for i in range(n):\n            xi = nodes[i]\n            w_xi = weights[i]\n            for j in range(n):\n                eta = nodes[j]\n                w_eta = weights[j]\n                \n                # Gradients of shape functions in reference coordinates (4x2 matrix)\n                ref_grads = get_ref_grads(xi, eta)\n                \n                # Jacobian matrix of the isoparametric mapping (2x2 matrix)\n                # J = V.T @ G_ref, where V are vertices and G_ref are ref_grads\n                J = np.dot(vertices.T, ref_grads)\n                \n                det_J = np.linalg.det(J)\n                \n                # A negative or zero determinant indicates an invalid mapping\n                # at the quadrature point. We assume this doesn't occur for the\n                # given test cases.\n                if det_J = 0:\n                   # A robust implementation might raise an error or handle this.\n                   # For this problem, we continue, which may lead to nan/inf results\n                   # if the matrix becomes singular, but it doesn't for these cases.\n                   pass\n                \n                inv_J = np.linalg.inv(J)\n                \n                # Gradients in physical coordinates\n                # (grad_phys_i)^T = (grad_ref_i)^T @ J^{-1}\n                # This applies to all shape functions simultaneously.\n                phys_grads = np.dot(ref_grads, inv_J)\n                \n                # Integrand for the stiffness matrix at the current quad point.\n                # The (i,j) element is (grad_phys_i) . (grad_phys_j)\n                integrand_matrix = np.dot(phys_grads, phys_grads.T)\n                \n                # Add weighted contribution to the stiffness matrix\n                K += integrand_matrix * det_J * w_xi * w_eta\n                \n        return K\n\n    # Test cases as defined in the problem statement\n    test_cases = [\n        {'vertices': np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n         'u': np.array([1.0, 1.0, 1.0, 1.0]), 'n': 1},\n        {'vertices': np.array([[0.0, 0.0], [2.0, 0.1], [2.2, 1.1], [0.2, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 1},\n        {'vertices': np.array([[0.0, 0.0], [2.0, 0.0], [1.9, 1.0], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 1},\n        {'vertices': np.array([[0.0, 0.0], [2.0, 0.0], [1.9, 1.0], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 2},\n        {'vertices': np.array([[0.0, 0.0], [2.0, -0.3], [2.3, 1.1], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 2},\n        {'vertices': np.array([[0.0, 0.0], [2.0, -0.3], [2.3, 1.1], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 3},\n    ]\n\n    n_exact = 20\n    results = []\n\n    for case in test_cases:\n        vertices = case['vertices']\n        u_vec = case['u']\n        n = case['n']\n\n        # Assemble stiffness matrices: one with order n, one with high order\n        K_n = assemble_stiffness_matrix(vertices, n)\n        K_exact = assemble_stiffness_matrix(vertices, n_exact)\n        \n        # Compute the quadratic forms, u^T * K * u\n        seminorm_sq_n = np.dot(u_vec.T, np.dot(K_n, u_vec))\n        seminorm_sq_exact = np.dot(u_vec.T, np.dot(K_exact, u_vec))\n        \n        # Calculate the absolute difference (error)\n        delta_n = abs(seminorm_sq_exact - seminorm_sq_n)\n        results.append(delta_n)\n\n    # Print the final result in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3398694"}, {"introduction": "高质量的数值方法不仅应保证准确性，还应能保持基本的物理和数学定律。本练习 [@problem_id:3398695] 将引导您对散度定理进行一次数值验证，展示精心选择的高斯-洛巴托（Gauss-Lobatto）求积法则如何能够精确地平衡体积分与边界通量积分。这个练习突显了求积精度与数值格式守恒性质之间的深刻联系。", "problem": "设 $Q = [-1,1] \\times [-1,1]$ 为参考正方形，并设 $K \\subset \\mathbb{R}^{2}$ 为一个凸四边形，其顶点（逆时针序）为 $P_{1} = (0,0)$、$P_{2} = (2,0)$、$P_{3} = (2,1)$、$P_{4} = \\left(\\tfrac{1}{2}, \\tfrac{3}{2}\\right)$。考虑由双线性形函数定义的标准双线性等参映射 $\\Phi : Q \\to K$\n$$\nN_{1}(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1-\\eta), \\quad\nN_{2}(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1-\\eta), \\\\\nN_{3}(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1+\\eta), \\quad\nN_{4}(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1+\\eta),\n$$\n使得 $\\Phi(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta) P_{i}$。设 $\\mathbf{F}(x,y) = \\big(x^{3} + x y,\\; y - x y^{2}\\big)$，并用 $\\nabla \\cdot \\mathbf{F}$ 表示其散度。\n\n- A部分。在区间 $[-1,1]$ 上，通过要求对最高3次的多项式精确成立，确定3点高斯-洛巴托求积法则的节点和权重。你必须直接从精确性条件推导权重。\n\n- B部分。根据A部分中的一维3点高斯-洛巴托法则，在 $Q$ 上定义张量积求积。使用换元公式，根据节点 $(\\xi_{i},\\eta_{j})$、权重和雅可比行列式 $\\det D\\Phi(\\xi,\\eta)$ 定义对应的体积求积 $Q_{\\mathrm{vol}}$ 用于计算 $\\int_{K} (\\nabla \\cdot \\mathbf{F})(x,y)\\, \\mathrm{d}x\\,\\mathrm{d}y$。\n\n- C部分。对于每个物理边 $e \\subset \\partial K$，考虑其参数化 $\\gamma_{e}(s) = \\Phi(\\pm 1, s)$ 或 $\\gamma_{e}(s) = \\Phi(s, \\pm 1)$，其中 $s \\in [-1,1]$。对于光滑参数化曲线 $\\gamma(s)$，其通量积分满足 $\\int_{e} \\mathbf{F} \\cdot \\mathbf{n}\\, \\mathrm{d}s = \\int_{-1}^{1} \\mathbf{F}(\\gamma(s)) \\cdot R\\, \\gamma'(s)\\, \\mathrm{d}s$，其中 $R = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$ 是逆时针旋转 $\\pi/2$ 角的旋转矩阵。利用此关系，定义边求积 $Q_{\\mathrm{bnd}}$，该求积沿每条边（在参数 $s$ 上）应用3点高斯-洛巴托法则，并将各部分的贡献相加。\n\n- D部分。仅使用基于A-C部分的定义和双线性映射结构的次数论证，证明对于给定的 $\\mathbf{F}$ 和 $K$，$Q_{\\mathrm{vol}}$ 等于精确的体积积分，$Q_{\\mathrm{bnd}}$ 等于精确的边界通量积分。然后计算差异\n$$\nD := Q_{\\mathrm{bnd}}\\big[\\mathbf{F}\\cdot \\mathbf{n}\\big] \\;-\\; Q_{\\mathrm{vol}}\\big[\\nabla \\cdot \\mathbf{F}\\big].\n$$\n给出 $D$ 的最终数值。如果需要任何数值近似，你应四舍五入到四位有效数字；然而，如果得到精确值，请报告精确值。", "solution": "该问题需要进行验证。\n\n### 第一步：提取已知条件\n- 参考正方形：$Q = [-1,1] \\times [-1,1]$。\n- 物理四边形：$K \\subset \\mathbb{R}^{2}$ 是一个凸四边形，其顶点（逆时针序）为 $P_{1} = (0,0)$、$P_{2} = (2,0)$、$P_{3} = (2,1)$ 和 $P_{4} = \\left(\\frac{1}{2}, \\frac{3}{2}\\right)$。\n- 双线性形函数：\n  $N_{1}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$\n  $N_{2}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$\n  $N_{3}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$\n  $N_{4}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$\n- 等参映射：$\\Phi(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta) P_{i}$。\n- 矢量场：$\\mathbf{F}(x,y) = \\left(x^{3} + x y, y - x y^{2}\\right)$。\n- 散度：$\\nabla \\cdot \\mathbf{F}$。\n- A部分：通过要求对最高3次的多项式精确成立，确定在 $[-1,1]$ 上的3点高斯-洛巴托求积法则的节点和权重。\n- B部分：为 $\\int_{K} (\\nabla \\cdot \\mathbf{F})(x,y)\\, \\mathrm{d}x\\,\\mathrm{d}y$ 定义张量积求积 $Q_{\\mathrm{vol}}$。\n- C部分：为边界通量 $\\int_{\\partial K} \\mathbf{F} \\cdot \\mathbf{n}\\, \\mathrm{d}s$ 定义边求积 $Q_{\\mathrm{bnd}}$。\n- D部分：使用次数论证证明求积对给定问题是精确的，并计算差异 $D := Q_{\\mathrm{bnd}}\\big[\\mathbf{F}\\cdot \\mathbf{n}\\big] - Q_{\\mathrm{vol}}\\big[\\nabla \\cdot \\mathbf{F}\\big]$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题在科学上基于数值分析和有限元法领域。所有概念，如等参映射、高斯求积和矢量微积分，都是标准的且定义明确。该问题是适定的；它提供了所有必要的数据和函数，并要求进行一系列明确的推导和最终计算。语言客观而精确。该问题没有违反任何科学原理，不是不完整的，也不是微不足道的，因为它需要仔细应用数值积分中几个相互关联的概念。该设置是偏微分方程数值方法中的一个标准、可验证的练习。\n\n### 第三步：结论与行动\n该问题是有效的。将提供一个完整的解答。\n\n### 解答\n\n对于A部分，我们推导在区间 $[-1,1]$ 上的3点高斯-洛巴托求积法则。该法则使用 $n=3$ 个点，并包括端点。因此其节点为 $x_1 = -1$ 和 $x_3 = 1$。设第三个节点为 $x_2$。该法则的形式为 $\\int_{-1}^{1} f(x) \\,dx \\approx w_1 f(-1) + w_2 f(x_2) + w_3 f(1)$。对于对称区间上具有奇数个点的求积法则要达到最高精度，其节点和权重必须是对称的。因此，$x_2 = 0$ 且 $w_1 = w_3$。该法则为 $\\int_{-1}^{1} f(x) \\,dx \\approx w_1 f(-1) + w_2 f(0) + w_1 f(1)$。问题指出该法则对最高3次的多项式是精确的。我们对单项式 $x^0=1$ 和 $x^2$ 强加精确性。对于奇次幂 $x$ 和 $x^3$ 的精确性由对称性保证。\n\n对于 $f(x)=1$：\n$$ \\int_{-1}^{1} 1 \\,dx = 2 $$\n求积给出 $w_1(1) + w_2(1) + w_1(1) = 2w_1 + w_2$。因此，我们得到方程 $2w_1 + w_2 = 2$。\n\n对于 $f(x)=x^2$：\n$$ \\int_{-1}^{1} x^2 \\,dx = \\left[\\frac{x^3}{3}\\right]_{-1}^{1} = \\frac{1}{3} - \\left(-\\frac{1}{3}\\right) = \\frac{2}{3} $$\n求积给出 $w_1(-1)^2 + w_2(0)^2 + w_1(1)^2 = w_1 + 0 + w_1 = 2w_1$。因此，我们得到方程 $2w_1 = \\frac{2}{3}$，这意味着 $w_1 = \\frac{1}{3}$。\n\n将 $w_1 = \\frac{1}{3}$ 代入第一个方程，得到 $2\\left(\\frac{1}{3}\\right) + w_2 = 2$，解得 $w_2 = 2 - \\frac{2}{3} = \\frac{4}{3}$。\n节点为 $\\{-1, 0, 1\\}$，对应的权重为 $\\{\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3}\\}$。一个3点高斯-洛巴托法则对最高 $2n-3 = 2(3)-3 = 3$ 次的多项式是精确的，这与问题陈述相符。\n\n对于B部分，我们定义体积求积 $Q_{\\mathrm{vol}}$。积分被变换到参考正方形 $Q$上：\n$$ \\int_{K} g(x,y)\\, \\mathrm{d}x\\,\\mathrm{d}y = \\int_{-1}^{1}\\int_{-1}^{1} g(\\Phi(\\xi,\\eta)) \\det(D\\Phi(\\xi,\\eta)) \\,d\\xi\\,d\\eta $$\n在 $Q$ 上使用A部分中的一维法则得到的张量积求积法则由下式给出\n$$ Q_{\\mathrm{vol}}[g] = \\sum_{i=1}^{3} \\sum_{j=1}^{3} w_i w_j g(\\Phi(\\xi_i, \\eta_j)) \\det(D\\Phi(\\xi_i, \\eta_j)) $$\n其中 $(\\xi_i, \\eta_j)$ 是9个节点，满足 $\\xi_i, \\eta_j \\in \\{-1, 0, 1\\}$，而 $w_i, w_j$ 是来自 $\\{\\frac{1}{3}, \\frac{4}{3}\\}$ 的相应权重。\n具体的被积函数是 $\\mathbf{F}$ 的散度，$\\nabla \\cdot \\mathbf{F}$：\n$$ \\nabla \\cdot \\mathbf{F} = \\frac{\\partial}{\\partial x}(x^3 + xy) + \\frac{\\partial}{\\partial y}(y - xy^2) = (3x^2 + y) + (1 - 2xy) = 3x^2 - 2xy + y + 1 $$\n我们还需要映射 $\\Phi(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$ 的雅可比行列式。\n我们来求 $\\Phi$ 的显式形式。使用 $P_1=(0,0)$、$P_2=(2,0)$、$P_3=(2,1)$、$P_4=(\\frac{1}{2}, \\frac{3}{2})$：\n$$ x(\\xi,\\eta) = N_2(2) + N_3(2) + N_4(\\tfrac{1}{2}) = \\tfrac{1}{4}(1+\\xi)(1-\\eta)(2) + \\tfrac{1}{4}(1+\\xi)(1+\\eta)(2) + \\tfrac{1}{4}(1-\\xi)(1+\\eta)(\\tfrac{1}{2}) $$\n$$ y(\\xi,\\eta) = N_3(1) + N_4(\\tfrac{3}{2}) = \\tfrac{1}{4}(1+\\xi)(1+\\eta)(1) + \\tfrac{1}{4}(1-\\xi)(1+\\eta)(\\tfrac{3}{2}) $$\n化简这些双线性多项式：\n$$ x(\\xi,\\eta) = \\tfrac{1}{2}(1+\\xi)(1-\\eta+1+\\eta) + \\tfrac{1}{8}(1-\\xi)(1+\\eta) = (1+\\xi) + \\tfrac{1}{8}(1-\\xi+\\eta-\\xi\\eta) = \\tfrac{9}{8} + \\tfrac{7}{8}\\xi + \\tfrac{1}{8}\\eta - \\tfrac{1}{8}\\xi\\eta $$\n$$ y(\\xi,\\eta) = \\tfrac{1}{4}(1+\\eta)( (1+\\xi) + \\tfrac{3}{2}(1-\\xi) ) = \\tfrac{1}{4}(1+\\eta)(\\tfrac{5}{2}-\\tfrac{1}{2}\\xi) = \\tfrac{1}{8}(5-\\xi+5\\eta-\\xi\\eta) $$\n偏导数为：\n$$ \\frac{\\partial x}{\\partial \\xi} = \\frac{7}{8} - \\frac{1}{8}\\eta, \\quad \\frac{\\partial x}{\\partial \\eta} = \\frac{1}{8} - \\frac{1}{8}\\xi $$\n$$ \\frac{\\partial y}{\\partial \\xi} = -\\frac{1}{8} - \\frac{1}{8}\\eta, \\quad \\frac{\\partial y}{\\partial \\eta} = \\frac{5}{8} - \\frac{1}{8}\\xi $$\n雅可比行列式是：\n$$ \\det(D\\Phi) = \\left(\\frac{7}{8} - \\frac{1}{8}\\eta\\right)\\left(\\frac{5}{8} - \\frac{1}{8}\\xi\\right) - \\left(\\frac{1}{8} - \\frac{1}{8}\\xi\\right)\\left(-\\frac{1}{8} - \\frac{1}{8}\\eta\\right) $$\n$$ = \\frac{1}{64} \\left[ (7-\\eta)(5-\\xi) - (1-\\xi)(-1-\\eta) \\right] = \\frac{1}{64} \\left[ (35-7\\xi-5\\eta+\\xi\\eta) + (1+\\eta-\\xi-\\xi\\eta) \\right] $$\n$$ = \\frac{1}{64} (36 - 8\\xi - 4\\eta) = \\frac{1}{16}(9 - 2\\xi - \\eta) $$\n\n对于C部分，我们定义边界求积 $Q_{\\mathrm{bnd}}$。边界 $\\partial K$ 由四条边 $e_1, e_2, e_3, e_4$ 组成，分别对应参考正方形的边 $\\xi=\\pm 1, \\eta=\\pm 1$。边界是逆时针遍历的。\n- $e_1$ ($P_1 \\to P_2$)：$\\eta=-1$，$\\xi$ 从 $-1$ 到 $1$。参数化为 $\\gamma_1(s) = \\Phi(s,-1)$，其中 $s \\in [-1,1]$。\n- $e_2$ ($P_2 \\to P_3$)：$\\xi=1$，$\\eta$ 从 $-1$ 到 $1$。参数化为 $\\gamma_2(s) = \\Phi(1,s)$，其中 $s \\in [-1,1]$。\n- $e_3$ ($P_3 \\to P_4$)：$\\eta=1$，$\\xi$ 从 $1$ 到 $-1$。参数化为 $\\gamma_3(s) = \\Phi(-s,1)$，其中 $s \\in [-1,1]$。\n- $e_4$ ($P_4 \\to P_1$)：$\\xi=-1$，$\\eta$ 从 $1$ 到 $-1$。参数化为 $\\gamma_4(s) = \\Phi(-1,-s)$，其中 $s \\in [-1,1]$。\n\n在一条参数化为 $\\gamma(s)$ 的边 $e$ 上的通量积分为 $\\int_{-1}^{1} \\mathbf{F}(\\gamma(s)) \\cdot R\\, \\gamma'(s)\\, \\mathrm{d}s$，其中 $R=\\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$。\n边界求积 $Q_{\\mathrm{bnd}}$ 是四条边上的求积之和，其中每条边上的积分都用A部分的3点高斯-洛巴托法则来近似。\n$$ Q_{\\mathrm{bnd}}[\\mathbf{F}\\cdot\\mathbf{n}] = \\sum_{k=1}^4 \\sum_{j=1}^3 w_j \\left( \\mathbf{F}(\\gamma_k(s_j)) \\cdot R\\, \\gamma_k'(s_j) \\right) $$\n其中 $s_j \\in \\{-1,0,1\\}$ 是求积节点，$w_j$ 是相应的权重。\n\n对于D部分，我们证明其精确性并计算差异 $D$。\n$Q_{\\mathrm{vol}}$ 的精确性：在参考域中的完整被积函数是 $(\\nabla \\cdot \\mathbf{F})(\\Phi(\\xi,\\eta)) \\det(D\\Phi(\\xi,\\eta))$。\n- $\\nabla \\cdot \\mathbf{F} = 3x^2 - 2xy + y + 1$ 是一个关于 $(x,y)$ 的总次数为2的多项式。\n- 映射分量 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 是双线性的，即关于 $\\xi$ 的次数为1，关于 $\\eta$ 的次数为1。\n- 复合函数 $(\\nabla \\cdot \\mathbf{F})(\\Phi(\\xi,\\eta))$ 是一个关于 $(\\xi,\\eta)$ 的多项式。项 $x^2$ 和 $xy$ 关于 $\\xi$ 的次数最多为2，关于 $\\eta$ 的次数最多为2（例如，$(\\xi\\eta)^2 = \\xi^2\\eta^2$）。\n- 雅可比行列式 $\\det(D\\Phi) = \\frac{1}{16}(9 - 2\\xi - \\eta)$ 是一个关于 $\\xi$ 次数为1，关于 $\\eta$ 次数为1的多项式。\n- 总被积函数是这两个多项式的乘积。它关于 $\\xi$ 的次数最多为 $2+1=3$，关于 $\\eta$ 的次数最多为 $2+1=3$。\n- 3点高斯-洛巴托法则的张量积对所有关于 $\\xi$ 次数最高为3、关于 $\\eta$ 次数最高为3的多项式 $P(\\xi,\\eta)$ 都是精确的。由于我们的被积函数满足这个条件，所以该求积是精确的。\n- 因此，$Q_{\\mathrm{vol}}[\\nabla \\cdot \\mathbf{F}] = \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}x\\,\\mathrm{d}y$。\n\n$Q_{\\mathrm{bnd}}$ 的精确性：考虑一条由 $\\gamma(s)$ 参数化的单一边。由于映射 $\\Phi$ 是双线性的，限制一个变量（例如 $\\eta=-1$）会使 $\\gamma(s) = (x(s), y(s))$ 的分量成为关于 $s$ 的线性多项式。\n- 矢量场是 $\\mathbf{F}(x,y) = (x^3+xy, y-xy^2)$。\n- 边上的被积函数是 $\\mathbf{F}(\\gamma(s)) \\cdot R \\gamma'(s)$。\n- $\\gamma'(s)$ 是一个常数矢量，因为 $\\gamma(s)$ 是线性的。\n- $\\mathbf{F}(\\gamma(s))$ 的分量是关于 $s$ 的多项式。由于 $x(s)$ 和 $y(s)$ 是关于 $s$ 的线性函数，像 $x(s)^3$ 和 $x(s)y(s)^2$ 这样的项是关于 $s$ 的3次多项式。\n- 整个被积函数是这些项的线性组合，因此是关于 $s$ 的最高3次多项式。\n- 3点高斯-洛巴托法则对最高3次的多项式是精确的。\n- 因此，求积在每条边上都是精确的。精确结果的和也是精确的。\n- 因此，$Q_{\\mathrm{bnd}}[\\mathbf{F}\\cdot\\mathbf{n}] = \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s$。\n\n差异 $D$ 的计算：\n差异为 $D = Q_{\\mathrm{bnd}}[\\mathbf{F}\\cdot \\mathbf{n}] - Q_{\\mathrm{vol}}[\\nabla \\cdot \\mathbf{F}]$。\n根据上面的精确性分析，这等价于：\n$$ D = \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s - \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}x\\,\\mathrm{d}y $$\n散度定理指出，对于区域 $K$ 上具有分段光滑边界 $\\partial K$ 的连续可微矢量场 $\\mathbf{F}$，\n$$ \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}A = \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s $$\n矢量场 $\\mathbf{F}$ 的分量是多项式，因此是光滑的。区域 $K$ 是一个凸四边形，这是该定理的有效区域。因此，散度定理直接适用。\n由此可知，精确的通量积分等于精确的体积积分。\n$$ \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s = \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}x\\,\\mathrm{d}y $$\n因此，差异 $D$ 必须为零。\n$$ D = 0 $$", "answer": "$$\\boxed{0}$$", "id": "3398695"}]}