## 引言
在[随机模拟](@entry_id:168869)领域，特别是马尔可夫链蒙特卡洛（MCMC）方法中，理解并控制[马尔可夫链的长期行为](@entry_id:272323)至关重要。除了不可约性（irreducibility）外，**非周期性（aperiodicity）**是确保链能够从任意初始状态收敛到其目标平稳分布的另一核心性质。

然而，许多自然模型和[算法设计](@entry_id:634229)中固有的确定性结构，如在离散[晶格](@entry_id:196752)上的[随机游走](@entry_id:142620)或系统性扫描的[吉布斯采样器](@entry_id:265671)，会不可避免地引入周期性。这种周期性会导致链的[分布](@entry_id:182848)陷入系统性[振荡](@entry_id:267781)，永远无法稳定下来，从而使得基于[遍历定理](@entry_id:261967)的统计推断失效。本文旨在系统性地解决这一知识鸿沟，阐明周期性的本质、危害以及应对策略。

通过本文的学习，你将全面掌握周期性的理论与实践。在“**原理与机制**”章节中，我们将深入探讨周期的数学定义、谱特征以及它如何影响链的收敛性。接着，在“**应用与[交叉](@entry_id:147634)学科联系**”中，我们将通过来自计算统计、物理和排队论等领域的丰富案例，展示周期性在实际问题中是如何产生的，以及为何必须处理它。最后，在“**动手实践**”部分，你将通过具体的编程练习，学习如何诊断和修复周期性问题，从而构建出更稳健的[随机模拟算法](@entry_id:189454)。

## 原理与机制

在马尔可夫链蒙特卡洛（MCMC）方法中，确保模拟的链能够收敛到目标[平稳分布](@entry_id:194199)是其理论有效性的基石。除了不可约性（irreducibility）保证了链可以探索整个状态空间外，另一个关键属性是**[非周期性](@entry_id:275873)（aperiodicity）**。周期性会引入一种系统性的[振荡](@entry_id:267781)行为，阻碍链的[分布](@entry_id:182848)收敛到唯一的[平稳分布](@entry_id:194199)。本章将深入探讨离散时间与[连续时间马尔可夫链](@entry_id:276307)中[状态的周期性](@entry_id:193569)与[非周期性](@entry_id:275873)，阐明其定义、结构后果、谱特征以及在实践中如何确保非周期性。

### [离散时间马尔可夫链](@entry_id:263188)中的周期性概念

#### 周期的定义

对于一个[离散时间马尔可夫链](@entry_id:263188)，状态 $i$ 的**周期（period）**是一个整数 $d(i)$，它被定义为所有从状态 $i$ 出发并返回到状态 $i$ 的可能步数 $n \ge 1$ 的[最大公约数](@entry_id:142947)（greatest common divisor, GCD）。形式上，如果我们用 $P_{ii}^{(n)}$ 表示从状态 $i$ 经过 $n$ 步回到状态 $i$ 的概率，那么周期的定义为：

$d(i) = \gcd\{ n \ge 1 : P_{ii}^{(n)} > 0 \}$

其中 $\gcd$ 表示[最大公约数](@entry_id:142947)。如果集合 $\{ n \ge 1 : P_{ii}^{(n)} > 0 \}$ 为空（即从状态 $i$ 出发后永远无法返回），则周期未定义。然而，在 MCMC 的语境中，我们通常处理的是常返链（recurrent chains），其中返回是必然发生的。

这个定义的直接推论是，任何可能的返回步数 $n$ 都必须是周期 $d(i)$ 的倍数 [@problem_id:3329371]。如果 $P_{ii}^{(n)} > 0$，那么 $n$ 必然能被 $d(i)$ 整除。因此，当周期 $d(i) > 1$ 时，链的返回行为表现出一种刚性的算术结构：返回只能在 $d(i), 2d(i), 3d(i), \dots$ 等时刻发生。

一个经典的例子是双状态的确定性交替链，其[转移矩阵](@entry_id:145510)为：
$P = \begin{pmatrix} 0  1 \\ 1  0 \end{pmatrix}$

如果从状态 1 开始，链的轨迹是 $1 \to 2 \to 1 \to 2 \to \dots$。返回状态 1 只可能在偶数步后发生，即 $n=2, 4, 6, \dots$。因此，返回步数的集合是 $\{2, 4, 6, \dots\}$，其最大公约数是 2。所以，两个[状态的周期](@entry_id:276903)都是 $d(1)=d(2)=2$。值得注意的是，这条链是常返的，但这并不意味着它是非周期的。**常返性与周期性是两个独立的概念** [@problem_id:3329363]。

#### 非周期性

如果一个[状态的周期](@entry_id:276903) $d(i)=1$，我们称该状态是**非周期的（aperiodic）**。这意味着返回状态 $i$ 的步数没有公因子大于 1，也就是说返回时间不局限于任何特定的算术级数。从定义可知，如果存在两个[互质](@entry_id:143119)（coprime）的返回步数 $n$ 和 $m$（即 $\gcd(n,m)=1$），那么[状态的周期](@entry_id:276903)必然是 1 [@problem_id:3329363]。

在实践中，一个非常简单且常见的确保非周期性的条件是状态存在**自环（self-loop）**，即 $P_{ii} > 0$。如果从状态 $i$ 出发可以在一步之内返回自身，那么数字 1 就在返回步数的集合中。任何包含 1 的正整数集合，其[最大公约数](@entry_id:142947)必然是 1。

更进一步，即使 $P_{ii}=0$，只要状态 $i$ 属于一个不可约的类，并且该类中**任何一个**状态存在[自环](@entry_id:274670)，通常也能保证整个类的非周期性。例如，考虑一个三状态[马尔可夫链](@entry_id:150828) [@problem_id:3329380]，其转移矩阵为：
$P = \begin{pmatrix} \frac{1}{2}  \frac{1}{2}  0 \\ 0  0  1 \\ \frac{1}{3}  \frac{2}{3}  0 \end{pmatrix}$

对于状态 1，我们有 $P_{11}^{(1)} = \frac{1}{2} > 0$，这意味着返回步数的集合包含 1，因此 $d(1)=1$，状态 1 是非周期的。事实上，我们可以通过归纳法证明，对于所有 $n \ge 1$，都有 $P_{11}^{(n)} > 0$。根据查普曼-科尔莫戈罗夫方程（Chapman-Kolmogorov equation）：
$P_{11}^{(k+1)} = \sum_{l \in \{1,2,3\}} P_{1l}^{(k)} P_{l1} = P_{11}^{(k)} P_{11} + P_{12}^{(k)} P_{21} + P_{13}^{(k)} P_{31}$
由于 $P_{11} > 0$，只要 $P_{11}^{(k)} > 0$，那么第一项 $P_{11}^{(k)} P_{11}$ 就是正的，而其他项非负，因此 $P_{11}^{(k+1)} > 0$。既然 $P_{11}^{(1)} > 0$，通过[数学归纳法](@entry_id:138544)，所有 $n \ge 1$ 的 $P_{11}^{(n)}$ 均为正。返回步数的集合是 $\{1, 2, 3, \dots\}$，其[最大公约数](@entry_id:142947)自然是 1。

#### 周期性是一个类属性

在[马尔可夫链](@entry_id:150828)理论中，一个基本结论是：**在同一个通信类（communicating class）中的所有状态都具有相同的周期** [@problem_id:3329363]。如果状态 $i$ 和 $j$ 互通（即 $i \leftrightarrow j$），那么 $d(i)=d(j)$。

这个结论的直观解释是，如果可以从 $i$ 到 $j$（例如用 $n_1$ 步），也可以从 $j$ 到 $i$（例如用 $n_2$ 步），那么任何一个从 $i$ 出发返回自身的闭环（长度为 $k$）都可以被嵌入到一个从 $j$ 出发的更长的闭环中：$j \to \dots \to i \to \dots \to i \to \dots \to j$。这个新闭环的长度为 $n_2 + k + n_1$。这个论证可以被形式化，以证明 $d(j)$ 整除 $d(i)$，反之亦然，因此两者必须相等。

由于不可约[马尔可夫链](@entry_id:150828)只有一个通信类，因此链中所有[状态的周期](@entry_id:276903)都相同。这使我们能够谈论**不[可约链](@entry_id:200553)的周期**。如果一个不[可约链](@entry_id:200553)中有一个状态是非周期的，那么所有状态都是非周期的，整个链就是非周期的。

### 周期性的结构与谱征

周期性不仅是一个数值属性，它还深刻地决定了[马尔可夫链](@entry_id:150828)的结构和动态行为。

#### [循环类](@entry_id:748139)分解

一个周期为 $d$ 的不可约[马尔可夫链](@entry_id:150828)，其[状态空间](@entry_id:177074) $\mathcal{X}$ 可以被唯一地划分为 $d$ 个不相交的[子集](@entry_id:261956)，称为**[循环类](@entry_id:748139)（cyclic classes）**：
$\mathcal{X} = C_0 \cup C_1 \cup \dots \cup C_{d-1}$

这些类具有一种刚性的循环转移结构：从任何一个类 $C_r$ 出发，经过一步转移，链必然会进入下一个类 $C_{(r+1) \bmod d}$ [@problem_id:3329371]。这意味着从 $C_r$ 到达 $C_s$ 的任何路径，其长度 $n$ 都必须满足 $n \equiv (s-r) \pmod d$。

一个清晰的例子是基于图论的分析 [@problem_id:3329431]。考虑一个具有 6 个顶点的[有向图](@entry_id:272310)，其顶点集可以划分为 $V_1=\{1,2\}, V_2=\{3,4\}, V_3=\{5,6\}$。如果转移结构规定了只能从 $V_1 \to V_2$，从 $V_2 \to V_3$，以及从 $V_3 \to V_1$，那么任何从 $V_1$ 中的一个状态（如状态 1）出发的路径，必须在 1 步后到达 $V_2$，2 步后到达 $V_3$，3 步后才能首次返回 $V_1$。这立即表明任何返回状态 1 的路径长度都必须是 3 的倍数。如果我们能找到一个实际长度为 3 的回路（例如 $1 \to 3 \to 5 \to 1$），我们就证明了 3 是一个可能的返回长度。综合这两个事实——所有返回长度都是 3 的倍数，且 3 本身是一个可能的返回长度——我们便确定该链的周期为 $d=3$。

#### 周期性的谱特征

周期性在转移矩阵 $P$ 的谱（即其[特征值](@entry_id:154894)集合）中留下了清晰的印记。根据佩龙-[弗罗贝尼乌斯定理](@entry_id:181858)（Perron-Frobenius theorem）的一个推广，对于一个不可约的非负矩阵 $P$：

**一个不可约[马尔可夫链的周期](@entry_id:265835)为 $d$，当且仅当其[转移矩阵](@entry_id:145510) $P$ 恰好有 $d$ 个模为 1 的[特征值](@entry_id:154894)。**

这些[特征值](@entry_id:154894)是单位圆上的 $d$ 次[单位根](@entry_id:143302)，即 $\exp(2\pi i k / d)$，其中 $k=0, 1, \dots, d-1$。

例如，如果一个不可约的 $3 \times 3$ 转移矩阵的[特征值](@entry_id:154894)被告知为 $\{1, -1, 0.5\}$ [@problem_id:3329403]，我们可以立即推断其周期。此处的[谱半径](@entry_id:138984)（最大[特征值](@entry_id:154894)模）为 1。模为 1 的[特征值](@entry_id:154894)有两个：$1$ 和 $-1$。这两个值正是 2 次单位根 $\{e^{2\pi i \cdot 0 / 2}, e^{2\pi i \cdot 1 / 2}\} = \{1, -1\}$。因此，该链的周期必然是 $d=2$。

### 周期性与[长期行为](@entry_id:192358)

周期性的存在从根本上改变了[马尔可夫链](@entry_id:150828)的长期收敛行为，这也是为什么在 MCMC 中必须处理它的原因。

#### 转移概率的收敛性

对于一个不可约且非周期的[马尔可夫链](@entry_id:150828)，其 $n$ 步转移矩阵 $P^n$ 会随着 $n \to \infty$ 收敛到一个所有行都相同的矩阵 $\Pi$。这个矩阵的每一行都是该链唯一的[平稳分布](@entry_id:194199) $\pi$。
$\lim_{n \to \infty} P^n = \Pi = \begin{pmatrix} \pi \\ \pi \\ \vdots \\ \pi \end{pmatrix}$

然而，如果链是周期的（$d > 1$），这个极限**不存在**。链的[分布](@entry_id:182848)不会稳定下来，而是会永恒地在 $d$ 个[循环类](@entry_id:748139)之间[振荡](@entry_id:267781)。谱分析清晰地揭示了这一点 [@problem_id:3329403]。$P^n$ 的表达式包含形如 $\lambda_k^n$ 的项。如果存在模为 1 但不等于 1 的[特征值](@entry_id:154894)（例如 $\lambda = -1$），那么 $\lambda^n$（例如 $(-1)^n$）将不会收敛，导致 $P^n$ 整体不收敛。

#### 子序列收敛与[切萨罗平均](@entry_id:146967)

虽然 $P^n$ 本身不收敛，但周期链的行为仍然是有规律的。对于一个周期为 $d$ 的链，其[转移矩阵](@entry_id:145510)的子序列会收敛 [@problem_id:3329394]。具体来说，对于每个余数 $r \in \{0, 1, \dots, d-1\}$，序列 $\{P^{nd+r}\}_{n=1}^\infty$ 都会收敛到一个极限矩阵 $M_r$。对于前面提到的周期为 2 的交替链 $P = \begin{pmatrix} 0  1 \\ 1  0 \end{pmatrix}$，我们有 $P^{2n} = I$（单位矩阵）和 $P^{2n+1} = P$。因此，偶数步的子[序列收敛](@entry_id:143579)到 $I$，奇数步的子[序列收敛](@entry_id:143579)到 $P$。

更重要的是，即使 $P^n$ 不收敛，其**[切萨罗平均](@entry_id:146967)（Cesàro average）**或时间平均总是收敛的。对于任何不[可约链](@entry_id:200553)（无论是否周期），[遍历定理](@entry_id:261967)（ergodic theorem）保证：
$\lim_{N \to \infty} \frac{1}{N} \sum_{n=0}^{N-1} P^n = \Pi$

这个性质保证了基于长[时间平均](@entry_id:267915)的估计在理论上是稳健的。然而，标准的 MCMC 估计量通常是简单的时间平均 $\frac{1}{N}\sum_{t=1}^N f(X_t)$，而不是对整个转移矩阵求平均。对于周期链，这个简单的[函数平均值](@entry_id:140668)可能不会收敛到[期望值](@entry_id:153208) $\mathbb{E}_\pi[f]$，因为它会继承链的[振荡](@entry_id:267781)行为 [@problem_id:3329367]。为了获得正确的估计，可能需要采用更复杂的平均策略，例如分别对每个[循环类](@entry_id:748139)进行平均，但这在实践中很不方便。因此，在 MCMC 中，我们倾向于直接消除周期性。

### 在实践中确保[非周期性](@entry_id:275873)

#### 懒惰[马尔可夫链](@entry_id:150828)

在 MCMC 实践中，最常用和最简单的确保[非周期性](@entry_id:275873)的方法是构造一个**懒惰[马尔可夫链](@entry_id:150828)（lazy Markov chain）**。给定一个转移核 $P$，我们可以定义一个新的核 $P'$：
$P' = \alpha I + (1-\alpha)P$
其中 $\alpha \in (0,1)$ 是一个“懒惰参数”，$I$是单位矩阵。

这个新链的含义是：在每一步，链以 $\alpha$ 的概率停留在当前状态，以 $1-\alpha$ 的概率按照原始核 $P$ 进行转移。由于 $\alpha>0$，每个状态现在都有一个正的自环概率 $P'_{ii} = \alpha + (1-\alpha)P_{ii} \ge \alpha > 0$。如前所述，只要存在返回步长为 1 的路径，周期就必然是 1。因此，只要原始链是不可约的，懒惰链 $P'$ 就既不可约又非周期 [@problem_id:3329371]。更重要的是，如果 $\pi$ 是 $P$ 的[平稳分布](@entry_id:194199)，那么它也是 $P'$ 的平稳分布，因为 $\pi P' = \pi(\alpha I + (1-\alpha)P) = \alpha\pi I + (1-\alpha)\pi P = \alpha\pi + (1-\alpha)\pi = \pi$。

从谱的角度看，懒惰化操作的效果是“收缩”除佩龙-弗罗贝尼乌斯[特征值](@entry_id:154894)（即 $\lambda=1$）之外的所有[特征值](@entry_id:154894) [@problem_id:3329416]。新的[特征值](@entry_id:154894) $\lambda'_k$ 与旧的[特征值](@entry_id:154894) $\lambda_k$ 的关系是 $\lambda'_k = \alpha + (1-\alpha)\lambda_k$。在复平面上，这个变换将单位圆上的所有其他[特征值](@entry_id:154894)（周期性的根源）严格地拉向圆内，从而消除了周期性并通常会改善链的收敛速度（通过增大谱隙）。

### 特殊主题与辨析

#### 瞬时态的周期性

周期的定义同样适用于**瞬时态（transient states）**，只要从该状态出发至少有一次返回自身的可能 [@problem_id:3329397]。瞬时态的周期性在 MCMC 中通常不是一个主要问题，因为根据定义，链在有限步后会以概率 1 离开任何瞬时态并进入一个[常返类](@entry_id:273689)。因此，链的长期行为完全由其[常返类](@entry_id:273689)（或对于遍历链而言，是唯一的[常返类](@entry_id:273689)）的性质决定。

值得注意的是，瞬时态既可以是周期的，也可以是非周期的。例如，在一个可以从状态 $A$ 逃逸到[吸收态](@entry_id:161036) $C$ 的链中，如果 $A$ 的返回路径长度包括 2 和 3，那么 $A$ 就是一个非周期的瞬时态。然而，我们也可以构造一个瞬时态是周期的例子：想象一个在状态 1 和 2 之间以周期 2 [振荡](@entry_id:267781)的链，但状态 1 有一个很小的概率逃逸到[吸收态](@entry_id:161036) 3。在这种情况下，状态 1 是瞬时态，但其返回时间仍然都是偶数，使其周期为 2 [@problem_id:3329397]。

#### 连续时间中的周期性

在**[连续时间马尔可夫链](@entry_id:276307)（CTMC）**中，周期性的概念与离散时间有本质区别 [@problem_id:3329373]。只要一个 CTMC 的所有离开率 $q_i$ 都为正，那么该链本质上就是**非周期的**。这是因为在任意状态 $i$ 的停留时间是指数分布的，这是一个连续型[随机变量](@entry_id:195330)。这意味着链可以在任何时刻 $t>0$ 离开状态。从状态 $i$ 出发，一种返回方式是根本不离开，这个事件在时刻 $t$ 发生的概率是 $e^{-q_i t}$，对于任何 $t>0$ 都是正的。因此，返回时间集合 $\{t>0 : p_{ii}(t)>0\}$ 通常是整个正[实数轴](@entry_id:147286) $(0, \infty)$。对这样一个[连续集](@entry_id:186725)合取[最大公约数](@entry_id:142947)是没有意义的。因此，在连续时间框架下，[非周期性](@entry_id:275873)通常被定义为：存在某个 $t_0 > 0$，使得对所有 $t \ge t_0$，都有 $p_{ii}(t)>0$。对于具有正离开率的不可约 CTMC, 这个条件总是满足的。

然而，一个 CTMC 的**嵌入离散时间跳跃链（embedded jump chain）**却可能是周期的。跳跃链只记录了状态转移的序列，忽略了在每个状态停留的时间。例如，一个在状态 1 和 2 之间交替的 CTMC，其[生成矩阵](@entry_id:275809)为：
$Q = \begin{pmatrix} -\lambda_1  \lambda_1 \\ \lambda_2  -\lambda_2 \end{pmatrix}$
其嵌入的跳跃链的[转移矩阵](@entry_id:145510)是 $R = \begin{pmatrix} 0  1 \\ 1  0 \end{pmatrix}$，这个跳跃链的周期是 2。尽管跳跃序列是周期性的，但由于在每个状态停留的时间是随机的（服从指数分布），这种周期性在连续时间上被“平滑”掉了，使得整个 CTMC 过程是非周期的。

总之，[非周期性](@entry_id:275873)是确保[马尔可夫链蒙特卡洛](@entry_id:138779)模拟收敛到唯一平稳分布的一个核心要求。理解其定义、后果以及如何通过懒惰化等技巧来强制实现[非周期性](@entry_id:275873)，对于设计和分析 MCMC 算法至关重要。