{"hands_on_practices": [{"introduction": "模拟退火的动态行为由 Metropolis 接受准则在微观层面控制，但能量变化 $\\Delta E$ 本身是一个随机变量。为了理解算法在给定温度 $T$ 下的平均行为，我们必须通过对所有可能的能量变化进行积分来计算期望接受率。这个练习 ([@problem_id:3339540]) 提供了一个将微观接受规则与宏观可观测量（平均接受率）联系起来的具体方法，并帮助你理解其对温度的依赖性，这对于控制退火过程至关重要。", "problem": "考虑一个使用 Metropolis 接受准则的模拟退火（SA）算法，该准则以概率 $a(\\Delta E, T) = \\min\\{1, \\exp(-\\Delta E/T)\\}$ 接受一个提议的移动，其中 $\\Delta E$ 是提议状态与当前状态之间的能量差，而 $T  0$ 是当前温度。假设在给定的提议机制下，能量差的分布可以很好地由一个正态分布 $\\Delta E \\sim \\mathcal{N}(\\mu, \\sigma^{2})$ 近似，其均值为 $\\mu \\in \\mathbb{R}$，标准差为 $\\sigma  0$。仅使用 Metropolis 接受准则和正态分布的定义，推导期望接受率\n$$A(T) = \\mathbb{E}\\big[\\min\\{1, \\exp(-\\Delta E/T)\\}\\big],$$\n的一个精确的闭式表达式，该表达式用 $\\mu$、$\\sigma$、$T$ 以及标准正态分布的累积分布函数表示。在你的推导中，从期望的积分表示开始，并使用正态分布的基本性质来证明任何变换的合理性。然后，用文字讨论在极限 $T \\to 0^{+}$ 和 $T \\to \\infty$ 下，$A(T)$ 如何依赖于 $T$，无需计算任何导数。提供你最终的 $A(T)$ 表达式，不要四舍五入，也不要包含任何物理单位。将标准正态累积分布函数 $\\Phi(z)$ 定义为 $\\Phi(z) = \\int_{-\\infty}^{z} \\frac{1}{\\sqrt{2\\pi}} \\exp\\big(-\\frac{y^{2}}{2}\\big)\\,dy$。", "solution": "该问题是有效的，因为它具有科学依据、问题明确且客观。这是随机算法研究中的一个标准问题，没有任何事实错误、歧义或信息缺失。\n\n目标是在模拟退火算法中推导期望接受率 $A(T)$ 的闭式表达式。在温度 $T$ 下，对于能量变化为 $\\Delta E$ 的移动，其接受概率由 Metropolis 准则给出：\n$$a(\\Delta E, T) = \\min\\{1, \\exp(-\\Delta E/T)\\}$$\n能量变化 $\\Delta E$ 是一个服从正态分布 $\\Delta E \\sim \\mathcal{N}(\\mu, \\sigma^{2})$ 的随机变量，其概率密度函数（PDF）由下式给出：\n$$p(x) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)$$\n期望接受率 $A(T)$ 是 $a(\\Delta E, T)$ 在 $\\Delta E$ 分布上的期望。对于一个连续随机变量，这由积分给出：\n$$A(T) = \\mathbb{E}[a(\\Delta E, T)] = \\int_{-\\infty}^{\\infty} \\min\\{1, \\exp(-x/T)\\} p(x) dx$$\n函数 $\\min\\{1, \\exp(-x/T)\\}$ 取决于 $x$ 的符号。\n- 如果 $x \\ge 0$，则 $-x/T \\le 0$，所以 $\\exp(-x/T) \\le 1$。因此，$\\min\\{1, \\exp(-x/T)\\} = \\exp(-x/T)$。\n- 如果 $x  0$，则 $-x/T > 0$，所以 $\\exp(-x/T) > 1$。因此，$\\min\\{1, \\exp(-x/T)\\} = 1$。\n\n根据这一观察，我们可以在 $x=0$ 处将积分分开：\n$$A(T) = \\int_{-\\infty}^{0} 1 \\cdot p(x) dx + \\int_{0}^{\\infty} \\exp(-x/T) p(x) dx$$\n我们分别计算每个积分。\n\n第一个积分 $I_1 = \\int_{-\\infty}^{0} p(x) dx$ 代表能量差 $\\Delta E$ 小于或等于 $0$ 的概率，即 $P(\\Delta E \\le 0)$。我们可以使用标准正态分布的累积分布函数（CDF）$\\Phi(z)$ 来表示这个概率。我们首先对变量进行标准化：\n$$P(\\Delta E \\le 0) = P\\left(\\frac{\\Delta E - \\mu}{\\sigma} \\le \\frac{0 - \\mu}{\\sigma}\\right)$$\n由于 $Z = (\\Delta E - \\mu)/\\sigma$ 是一个标准正态随机变量，这个概率是：\n$$I_1 = P\\left(Z \\le -\\frac{\\mu}{\\sigma}\\right) = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right)$$\n\n第二个积分是 $I_2 = \\int_{0}^{\\infty} \\exp(-x/T) p(x) dx$。代入 PDF $p(x)$：\n$$I_2 = \\int_{0}^{\\infty} \\exp(-x/T) \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right) dx$$\n我们可以合并指数函数的参数：\n$$I_2 = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\int_{0}^{\\infty} \\exp\\left(-\\frac{x}{T} - \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right) dx$$\n为了求解这个积分，我们对指数中包含 $x$ 的项进行配方。设指数的参数为 $\\mathcal{E}$。\n$$\\mathcal{E} = -\\frac{1}{2\\sigma^{2}} \\left[ \\frac{2\\sigma^{2}x}{T} + (x-\\mu)^{2} \\right] = -\\frac{1}{2\\sigma^{2}} \\left[ \\frac{2\\sigma^{2}x}{T} + x^{2} - 2\\mu x + \\mu^{2} \\right]$$\n$$\\mathcal{E} = -\\frac{1}{2\\sigma^{2}} \\left[ x^{2} - 2\\left(\\mu - \\frac{\\sigma^{2}}{T}\\right)x + \\mu^{2} \\right]$$\n对 $x^{2} - 2(\\mu - \\sigma^{2}/T)x$ 进行配方：\n$$\\mathcal{E} = -\\frac{1}{2\\sigma^{2}} \\left[ \\left(x - \\left(\\mu - \\frac{\\sigma^{2}}{T}\\right)\\right)^{2} - \\left(\\mu - \\frac{\\sigma^{2}}{T}\\right)^{2} + \\mu^{2} \\right]$$\n$$\\mathcal{E} = -\\frac{\\left(x - (\\mu - \\sigma^{2}/T)\\right)^{2}}{2\\sigma^{2}} + \\frac{1}{2\\sigma^{2}} \\left[ \\left(\\mu - \\frac{\\sigma^{2}}{T}\\right)^{2} - \\mu^{2} \\right]$$\n第二项简化为：\n$$\\frac{1}{2\\sigma^{2}} \\left[ \\mu^{2} - \\frac{2\\mu\\sigma^{2}}{T} + \\frac{\\sigma^{4}}{T^{2}} - \\mu^{2} \\right] = \\frac{1}{2\\sigma^{2}} \\left[ -\\frac{2\\mu\\sigma^{2}}{T} + \\frac{\\sigma^{4}}{T^{2}} \\right] = -\\frac{\\mu}{T} + \\frac{\\sigma^{2}}{2T^{2}}$$\n所以，指数为：\n$$\\mathcal{E} = -\\frac{\\left(x - (\\mu - \\sigma^{2}/T)\\right)^{2}}{2\\sigma^{2}} + \\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}$$\n将此代回 $I_2$ 的积分中：\n$$I_2 = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\int_{0}^{\\infty} \\exp\\left(-\\frac{\\left(x - (\\mu - \\sigma^{2}/T)\\right)^{2}}{2\\sigma^{2}} + \\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) dx$$\n项 $\\exp(\\sigma^{2}/(2T^{2}) - \\mu/T)$ 相对于 $x$ 是常数，可以被提出来：\n$$I_2 = \\exp\\left(\\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) \\int_{0}^{\\infty} \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(x - \\mu')^{2}}{2\\sigma^{2}}\\right) dx$$\n其中我们定义了一个新的均值 $\\mu' = \\mu - \\sigma^{2}/T$。该积分是随机变量 $X' \\sim \\mathcal{N}(\\mu', \\sigma^{2})$ 的概率 $P(X' \\ge 0)$。我们对其进行标准化来求此概率：\n$$P(X' \\ge 0) = P\\left(\\frac{X' - \\mu'}{\\sigma} \\ge \\frac{0 - \\mu'}{\\sigma}\\right) = P\\left(Z \\ge -\\frac{\\mu'}{\\sigma}\\right)$$\n利用标准正态分布的对称性，$P(Z \\ge -z) = P(Z \\le z) = \\Phi(z)$。因此，该积分的计算结果为 $\\Phi(\\mu'/\\sigma)$。\n代回 $\\mu'$：\n$$\\Phi\\left(\\frac{\\mu'}{\\sigma}\\right) = \\Phi\\left(\\frac{\\mu - \\sigma^{2}/T}{\\sigma}\\right) = \\Phi\\left(\\frac{\\mu}{\\sigma} - \\frac{\\sigma}{T}\\right)$$\n因此，第二个积分是：\n$$I_2 = \\exp\\left(\\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) \\Phi\\left(\\frac{\\mu}{\\sigma} - \\frac{\\sigma}{T}\\right)$$\n结合 $I_1$ 和 $I_2$，我们得到期望接受率的最终表达式：\n$$A(T) = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\exp\\left(\\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) \\Phi\\left(\\frac{\\mu}{\\sigma} - \\frac{\\sigma}{T}\\right)$$\n\n接下来，我们讨论 $A(T)$ 在极限 $T \\to 0^{+}$ 和 $T \\to \\infty$ 下的行为。\n\n对于高温极限，$T \\to \\infty$：\n从物理上看，当温度变得非常大时，对于任何有限的能量变化 $\\Delta E$，项 $-\\Delta E/T$ 趋近于 $0$。接受概率 $\\exp(-\\Delta E/T)$ 趋近于 $\\exp(0)=1$。因此，$\\min\\{1, \\exp(-\\Delta E/T)\\}$ 趋近于 $1$，意味着几乎所有提议的移动都被接受。因此，期望接受率 $A(T)$ 应该趋近于 $1$。\n从数学上讲，我们考察我们推导出的表达式的极限：\n$$\\lim_{T\\to\\infty} A(T) = \\lim_{T\\to\\infty} \\left[ \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\exp\\left(\\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) \\Phi\\left(\\frac{\\mu}{\\sigma} - \\frac{\\sigma}{T}\\right) \\right]$$\n当 $T \\to \\infty$ 时，我们有 $\\sigma^{2}/(2T^{2}) \\to 0$，$\\mu/T \\to 0$，以及 $\\sigma/T \\to 0$。\n极限变为：\n$$A(\\infty) = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\exp(0 - 0) \\Phi\\left(\\frac{\\mu}{\\sigma} - 0\\right) = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\Phi\\left(\\frac{\\mu}{\\sigma}\\right)$$\n使用性质 $\\Phi(-z) = 1 - \\Phi(z)$，这可以简化为：\n$$A(\\infty) = \\left(1 - \\Phi\\left(\\frac{\\mu}{\\sigma}\\right)\\right) + \\Phi\\left(\\frac{\\mu}{\\sigma}\\right) = 1$$\n这证实了物理直觉。\n\n对于低温极限，$T \\to 0^{+}$：\n从物理上看，当温度趋近于零时，系统表现得像一个贪婪算法。如果一个提议的移动是“下坡”的（$\\Delta E  0$），那么 $-\\Delta E/T \\to +\\infty$ 且 $\\exp(-\\Delta E/T) \\to \\infty$，使得接受概率为 $1$。如果一个移动是“上坡”的（$\\Delta E > 0$），那么 $-\\Delta E/T \\to -\\infty$ 且 $\\exp(-\\Delta E/T) \\to 0$，使得接受概率为 $0$。因此，在零温度下，只有下坡的移动被接受。期望接受率应该收敛到提议一个下坡移动的概率，即 $P(\\Delta E \\le 0)$。\n正如为 $I_1$ 计算的那样，这个概率是 $P(\\Delta E \\le 0) = \\Phi(-\\mu/\\sigma)$。\n从数学上讲，我们考察 $A(T)$ 表达式中第二项的极限：\n$$\\lim_{T\\to 0^{+}} \\exp\\left(\\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) \\Phi\\left(\\frac{\\mu}{\\sigma} - \\frac{\\sigma}{T}\\right)$$\n当 $T \\to 0^{+}$ 时，$\\Phi$ 的参数 $z(T) = \\mu/\\sigma - \\sigma/T$ 趋于 $-\\infty$。因此，$\\Phi(z(T)) \\to 0$。指数的参数 $\\sigma^{2}/(2T^{2}) - \\mu/T$ 趋于 $+\\infty$，所以指数项发散到 $+\\infty$。这给出了一个 $\\infty \\cdot 0$ 的不定形式。\n通过设置 $u=1/T$ 并令 $u \\to \\infty$ 来应用洛必达法则，可以表明这个乘积趋于 $0$。正态累积分布函数尾部的指数衰减速度快于前置因子的指数增长速度。因此，第二项在极限中消失。\n$$\\lim_{T\\to 0^{+}} A(T) = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + 0 = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right)$$\n这个结果证实了物理直觉，即在零温度下，接受率就是提议一个非上坡移动的概率。", "answer": "$$\\boxed{\\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\exp\\left(\\frac{\\sigma^{2}}{2T^{2}} - \\frac{\\mu}{T}\\right) \\Phi\\left(\\frac{\\mu}{\\sigma} - \\frac{\\sigma}{T}\\right)}$$", "id": "3339540"}, {"introduction": "虽然接受率告诉我们系统移动的频率，但它并未揭示这些移动对系统能量的净效应。在高温下，高接受率可能导致收敛缓慢，因为能量上升和下降的移动可能相互抵消。单步期望能量变化 $\\mathbb{E}[\\Delta E_{\\text{step}}]$ 精确地捕捉了每次迭代的平均能量降低量，量化了在接受降低能量的“下坡”移动和增加能量的“上坡”移动之间的平衡。通过推导这个量 ([@problem_id:3339546])，你将对在给定温度下的探索-利用权衡获得定量的理解，这是选择合适初始温度 $T_0$ 的核心。", "problem": "考虑使用 Metropolis 接受准则的模拟退火 (SA)，其初始温度固定为 $T_0$。能量增量提议 $\\Delta E$ 由一个尺度参数为 $b>0$ 的对称拉普拉斯 (双指数) 分布生成，其概率密度函数为 $f(\\Delta E) = \\frac{1}{2b}\\exp\\big(-|\\Delta E|/b\\big)$。假设玻尔兹曼常数归一化为 $k_B = 1$，使得温度和能量都使用相同的无量纲单位。在温度 $T$ 下，对于一个使能量改变 $\\Delta E$ 的提议移动，其 Metropolis 接受概率为 $a(\\Delta E; T) = \\min\\big(1, \\exp(-\\Delta E/T)\\big)$。\n\n仅从这些定义出发，推导在初始温度 $T_0$ 下，根据 Metropolis 准则的单步能量变化的期望值的闭式解析表达式，记为 $\\mathbb{E}[\\Delta E_{\\text{step}}]$。其中，被拒绝的提议贡献的能量变化为零。您的推导必须量化这样一个权衡：即较大的 $T_0$ 会增加对能量增加的移动的接受概率，从而减缓期望的能量下降速度。\n\n请用 $b$ 和 $T_0$ 将您的最终答案表示为单一的闭式表达式。不需要进行数值近似或四舍五入。", "solution": "该问题陈述经核实具有科学依据、适定且客观。这是一个随机模拟和蒙特卡洛方法领域的标准理论问题，具体涉及模拟退火 (SA) 算法。推导所需的所有要素均已提供，不存在矛盾或歧义。\n\n目标是推导在固定初始温度 $T_0$ 下，单步能量变化的期望值 $\\mathbb{E}[\\Delta E_{\\text{step}}]$ 的闭式表达式。一个提议的能量变化 $\\Delta E$ 由一个对称拉普拉斯分布生成，其概率密度函数 (PDF) 为 $f(\\Delta E) = \\frac{1}{2b}\\exp(-|\\Delta E|/b)$，其中 $b>0$。此提议根据 Metropolis 接受准则 $a(\\Delta E; T_0) = \\min(1, \\exp(-\\Delta E/T_0))$ 被接受或拒绝。玻尔兹曼常数归一化为 $k_B=1$。如果一个移动被接受，系统的能量改变 $\\Delta E$。如果移动被拒绝，能量变化为 $0$。\n\n单步能量变化的期望值可以通过对所有可能的能量增量提议 $\\Delta E$ 进行积分来求得。对于每个提议，如果移动被接受（概率为 $a(\\Delta E; T_0)$），产生的能量变化为 $\\Delta E$；如果移动被拒绝（概率为 $1 - a(\\Delta E; T_0)$），能量变化为 $0$。因此，期望值是提议的变化量 $\\Delta E$ 乘以其接受概率，再由提议本身的概率密度加权的积分。\n\n$$\n\\mathbb{E}[\\Delta E_{\\text{step}}] = \\int_{-\\infty}^{\\infty} \\Delta E \\cdot a(\\Delta E; T_0) \\cdot f(\\Delta E) \\, d(\\Delta E)\n$$\n\nMetropolis 接受概率 $a(\\Delta E; T_0)$ 根据 $\\Delta E$ 的符号有一个分段定义：\n1.  如果 $\\Delta E \\le 0$ (一个能量降低的移动，能量减少或保持不变)，那么 $-\\Delta E/T_0 \\ge 0$，且 $\\exp(-\\Delta E/T_0) \\ge 1$。因此，$a(\\Delta E; T_0) = 1$。\n2.  如果 $\\Delta E > 0$ (一个能量增加的移动，能量增加)，那么 $-\\Delta E/T_0  0$，且 $\\exp(-\\Delta E/T_0)  1$。因此，$a(\\Delta E; T_0) = \\exp(-\\Delta E/T_0)$。\n\n我们可以根据这两种情况将积分分成两部分：\n$$\n\\mathbb{E}[\\Delta E_{\\text{step}}] = \\int_{-\\infty}^{0} \\Delta E \\cdot (1) \\cdot f(\\Delta E) \\, d(\\Delta E) + \\int_{0}^{\\infty} \\Delta E \\cdot \\exp(-\\Delta E/T_0) \\cdot f(\\Delta E) \\, d(\\Delta E)\n$$\n\n接下来，我们代入给定的 PDF $f(\\Delta E) = \\frac{1}{2b}\\exp(-|\\Delta E|/b)$，注意当 $\\Delta E  0$ 时 $|\\Delta E| = -\\Delta E$，当 $\\Delta E > 0$ 时 $|\\Delta E| = \\Delta E$。\n\n对于第一个积分 $I_1$ (能量降低的移动)：\n$$\nI_1 = \\int_{-\\infty}^{0} \\Delta E \\cdot \\frac{1}{2b}\\exp(-(-\\Delta E)/b) \\, d(\\Delta E) = \\frac{1}{2b} \\int_{-\\infty}^{0} \\Delta E \\exp(\\Delta E/b) \\, d(\\Delta E)\n$$\n我们使用分部积分法 $\\int u \\, dv = uv - \\int v \\, du$。令 $u = \\Delta E$ 且 $dv = \\exp(\\Delta E/b) \\, d(\\Delta E)$。则 $du = d(\\Delta E)$ 且 $v = b\\exp(\\Delta E/b)$。\n$$\nI_1 = \\frac{1}{2b} \\left( \\left[ \\Delta E \\cdot b\\exp(\\Delta E/b) \\right]_{-\\infty}^{0} - \\int_{-\\infty}^{0} b\\exp(\\Delta E/b) \\, d(\\Delta E) \\right)\n$$\n$$\nI_1 = \\frac{1}{2} \\left( \\left[ \\Delta E \\exp(\\Delta E/b) \\right]_{-\\infty}^{0} - \\int_{-\\infty}^{0} \\exp(\\Delta E/b) \\, d(\\Delta E) \\right)\n$$\n第一项的计算结果为 $(0 \\cdot \\exp(0)) - \\lim_{\\Delta E \\to -\\infty} (\\Delta E \\exp(\\Delta E/b)) = 0 - 0 = 0$。该积分的计算结果为：\n$$\nI_1 = -\\frac{1}{2} \\left[ b\\exp(\\Delta E/b) \\right]_{-\\infty}^{0} = -\\frac{b}{2} \\left( \\exp(0) - \\lim_{\\Delta E \\to -\\infty} \\exp(\\Delta E/b) \\right) = -\\frac{b}{2}(1 - 0) = -\\frac{b}{2}\n$$\n\n对于第二个积分 $I_2$ (能量增加的移动)：\n$$\nI_2 = \\int_{0}^{\\infty} \\Delta E \\cdot \\exp(-\\Delta E/T_0) \\cdot \\frac{1}{2b}\\exp(-\\Delta E/b) \\, d(\\Delta E)\n$$\n$$\nI_2 = \\frac{1}{2b} \\int_{0}^{\\infty} \\Delta E \\cdot \\exp\\left(-\\Delta E\\left(\\frac{1}{T_0} + \\frac{1}{b}\\right)\\right) \\, d(\\Delta E)\n$$\n令指数中的系数为 $\\alpha = \\frac{1}{T_0} + \\frac{1}{b} = \\frac{b+T_0}{bT_0}$。\n$$\nI_2 = \\frac{1}{2b} \\int_{0}^{\\infty} \\Delta E \\cdot \\exp(-\\alpha \\Delta E) \\, d(\\Delta E)\n$$\n我们再次使用分部积分法。令 $u = \\Delta E$ 且 $dv = \\exp(-\\alpha \\Delta E) \\, d(\\Delta E)$。则 $du = d(\\Delta E)$ 且 $v = -\\frac{1}{\\alpha}\\exp(-\\alpha \\Delta E)$。\n$$\nI_2 = \\frac{1}{2b} \\left( \\left[ -\\frac{\\Delta E}{\\alpha}\\exp(-\\alpha \\Delta E) \\right]_{0}^{\\infty} - \\int_{0}^{\\infty} \\left(-\\frac{1}{\\alpha}\\right)\\exp(-\\alpha \\Delta E) \\, d(\\Delta E) \\right)\n$$\n第一项的计算结果为 $\\lim_{\\Delta E \\to \\infty}(-\\frac{\\Delta E}{\\alpha}\\exp(-\\alpha \\Delta E)) - (0) = 0 - 0 = 0$。该积分变为：\n$$\nI_2 = \\frac{1}{2b} \\cdot \\frac{1}{\\alpha} \\int_{0}^{\\infty} \\exp(-\\alpha \\Delta E) \\, d(\\Delta E) = \\frac{1}{2b\\alpha} \\left[ -\\frac{1}{\\alpha}\\exp(-\\alpha \\Delta E) \\right]_{0}^{\\infty}\n$$\n$$\nI_2 = \\frac{1}{2b\\alpha^2} \\left( - \\lim_{\\Delta E \\to \\infty} \\exp(-\\alpha \\Delta E) - (-\\exp(0)) \\right) = \\frac{1}{2b\\alpha^2} (0 + 1) = \\frac{1}{2b\\alpha^2}\n$$\n代入 $\\alpha = \\frac{b+T_0}{bT_0}$：\n$$\nI_2 = \\frac{1}{2b} \\left( \\frac{bT_0}{b+T_0} \\right)^2 = \\frac{1}{2b} \\frac{b^2 T_0^2}{(b+T_0)^2} = \\frac{b T_0^2}{2(b+T_0)^2}\n$$\n总的期望能量变化是这两部分之和：\n$$\n\\mathbb{E}[\\Delta E_{\\text{step}}] = I_1 + I_2 = -\\frac{b}{2} + \\frac{b T_0^2}{2(b+T_0)^2}\n$$\n为了得到一个单一的分数表达式，我们进行通分：\n$$\n\\mathbb{E}[\\Delta E_{\\text{step}}] = \\frac{-b(b+T_0)^2 + bT_0^2}{2(b+T_0)^2} = \\frac{b \\left( T_0^2 - (b+T_0)^2 \\right)}{2(b+T_0)^2}\n$$\n$$\n= \\frac{b \\left( T_0^2 - (b^2 + 2bT_0 + T_0^2) \\right)}{2(b+T_0)^2} = \\frac{b(-b^2 - 2bT_0)}{2(b+T_0)^2}\n$$\n$$\n= \\frac{-b^2(b+2T_0)}{2(b+T_0)^2}\n$$\n这个最终表达式量化了其中的权衡。当 $T_0 \\to 0$ 时，$\\mathbb{E}[\\Delta E_{\\text{step}}] \\to -\\frac{b^2(b)}{2b^2} = -b/2$，这表明由于只接受能量降低的移动，能量会快速下降。当 $T_0 \\to \\infty$ 时，$\\mathbb{E}[\\Delta E_{\\text{step}}] \\to 0$，因为所有移动都被接受，期望变化等于对称提议分布的均值（即 0）。因此，较大的 $T_0$ 会减慢期望的下降速率，从而允许进行更多的探索。", "answer": "$$\n\\boxed{-\\frac{b^2(b+2T_0)}{2(b+T_0)^2}}\n$$", "id": "3339546"}, {"introduction": "诸如指数或对数退火等简单的降温方案通常是启发式的。一种更有原则的方法是根据系统演化的属性来调整温度方案，以确保退火过程平稳而高效。这个练习介绍了一种基于退火重要性采样（AIS）中有效样本大小（ESS）概念的先进降温方案设计方法，其目标是选择连续的温度 $T_k$ 和 $T_{k+1}$，使得在它们之间转换时的“信息损失”保持恒定。通过确保恒定的 ESS ([@problem_id:3339559])，所得到的方案能够自适应于系统的特性（如维度），从而避免了步长过大（导致信息丢失）或过小（导致进展缓慢）的问题。", "problem": "考虑一个具有二次能量景观的系统，在模拟退火 (SA) 中使用退火重要性采样 (AIS)。设能量函数为 $E(x) = \\frac{\\kappa}{2}\\|x\\|^{2}$，其中状态 $x \\in \\mathbb{R}^{d}$，刚度参数 $\\kappa > 0$，并设玻尔兹曼常数 $k_{B} = 1$。在温度 $T > 0$ 时，$x$ 上的玻尔兹曼分布为 $p_{T}(x) \\propto \\exp\\left(-\\frac{E(x)}{T}\\right)$。在 AIS 中，从温度 $T_{k}$ 到 $T_{k+1}$ 的桥接过程使用重要性权重 $w(x) = \\exp\\left(-\\left(\\frac{E(x)}{T_{k+1}} - \\frac{E(x)}{T_{k}}\\right)\\right)$，这些权重是根据服从 $p_{T_{k}}$ 分布的样本 $x$ 计算的。\n\n将第 $k$ 步 AIS 的有效样本量 (ESS) 近似定义为 $\\operatorname{ESS} \\approx \\left(\\mathbb{E}[w(x)^{2}]\\right)^{-1}$，其中期望是关于 $x \\sim p_{T_{k}}$ 的。你的目标是通过选择 $T_{k+1}$ 作为 $T_{k}$、ESS 的目标常数 $\\eta > 0$ 以及维度 $d$ 的函数，来设计一个降温方案，使得连续温度之间的 ESS 相等。具体来说，确定 $T_{k+1}$ 的闭式表达式，使其对于二次能量 $E(x) = \\frac{\\kappa}{2}\\|x\\|^{2}$ 满足\n$$\n\\left(\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big]\\right)^{-1} = \\eta\n$$\n用 $T_{k}$、$\\eta$ 和 $d$ 来表示你的答案。如果你假设一个降温机制，请确保你的表达式对于 $T_{k+1}  T_{k}$ 是有效的。\n\n请提供 $T_{k+1}$ 的单一闭式解析表达式；不要进行任何数值近似或四舍五入。", "solution": "问题要求推导一个降温方案，具体来说，是温度 $T_{k+1}$ 作为前一个温度 $T_k$、目标有效样本量 (ESS) $\\eta$ 以及状态空间维度 $d$ 的函数表达式。该系统由一个二次能量函数定义，而 ESS 是通过退火重要性采样 (AIS) 权重的二阶矩来定义的。\n\n出发点是问题陈述中给出的约束条件：\n$$\n\\left(\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big]\\right)^{-1} = \\eta\n$$\n其中 $\\eta > 0$ 是目标 ESS。这等价于在以下方程中求解 $T_{k+1}$：\n$$\n\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big] = \\frac{1}{\\eta}\n$$\n\n期望是关于温度 $T_k$ 下的玻尔兹曼分布计算的，该分布由 $p_{T_{k}}(x) = \\frac{1}{Z_{T_k}} \\exp\\left(-\\frac{E(x)}{T_k}\\right)$ 给出。这里，$Z_{T_k}$ 是温度 $T_k$ 下的配分函数，定义为 $Z_{T_k} = \\int_{\\mathbb{R}^d} \\exp\\left(-\\frac{E(x)}{T_k}\\right) d^d x$。玻尔兹曼常数设为 $k_B=1$。\n\n从 $T_k$ 到 $T_{k+1}$ 过渡的重要性权重 $w(x)$ 是 $w(x) = \\exp\\left(-\\left(\\frac{E(x)}{T_{k+1}} - \\frac{E(x)}{T_k}\\right)\\right)$。因此，权重的平方是：\n$$\nw(x)^2 = \\exp\\left(-2E(x)\\left(\\frac{1}{T_{k+1}} - \\frac{1}{T_k}\\right)\\right)\n$$\n现在，我们可以将期望明确地写成一个积分：\n$$\n\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big] = \\int_{\\mathbb{R}^d} w(x)^2 p_{T_{k}}(x) d^d x = \\frac{1}{Z_{T_k}} \\int_{\\mathbb{R}^d} \\exp\\left(-2E(x)\\left(\\frac{1}{T_{k+1}} - \\frac{1}{T_k}\\right)\\right) \\exp\\left(-\\frac{E(x)}{T_k}\\right) d^d x\n$$\n合并指数中的项可得：\n$$\n\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big] = \\frac{1}{Z_{T_k}} \\int_{\\mathbb{R}^d} \\exp\\left(-E(x)\\left[2\\left(\\frac{1}{T_{k+1}} - \\frac{1}{T_k}\\right) + \\frac{1}{T_k}\\right]\\right) d^d x\n$$\n方括号中的项化简为：\n$$\n\\frac{2}{T_{k+1}} - \\frac{2}{T_k} + \\frac{1}{T_k} = \\frac{2}{T_{k+1}} - \\frac{1}{T_k}\n$$\n让我们定义一个有效逆温度 $\\beta' = \\frac{2}{T_{k+1}} - \\frac{1}{T_k}$。该积分变为 $\\int_{\\mathbb{R}^d} \\exp(-\\beta' E(x)) d^d x$。这是系统在该有效逆温度下的配分函数的定义，我们称之为 $Z(\\beta')$。所以，期望是配分函数之比：\n$$\n\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big] = \\frac{Z(\\beta')}{Z_{T_k}}\n$$\n其中 $Z_{T_k}$ 是对应于逆温度 $\\beta_k = 1/T_k$ 的配分函数。\n\n接下来，我们计算在一般逆温度 $\\beta = 1/T$ 和给定能量函数 $E(x) = \\frac{\\kappa}{2}\\|x\\|^2 = \\frac{\\kappa}{2}\\sum_{i=1}^d x_i^2$ 下的配分函数 $Z(\\beta)$。\n$$\nZ(\\beta) = \\int_{\\mathbb{R}^d} \\exp\\left(-\\beta \\frac{\\kappa}{2} \\sum_{i=1}^d x_i^2\\right) d^d x\n$$\n这是一个 $d$ 个相同的一维高斯积分的乘积：\n$$\nZ(\\beta) = \\prod_{i=1}^d \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta\\kappa}{2} x_i^2\\right) dx_i\n$$\n使用高斯积分的标准结果 $\\int_{-\\infty}^{\\infty} e^{-ax^2} dx = \\sqrt{\\frac{\\pi}{a}}$，并令 $a = \\frac{\\beta\\kappa}{2}$，我们得到：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta\\kappa}{2} x_i^2\\right) dx_i = \\sqrt{\\frac{\\pi}{(\\beta\\kappa/2)}} = \\sqrt{\\frac{2\\pi}{\\beta\\kappa}}\n$$\n因此，$d$ 维配分函数为：\n$$\nZ(\\beta) = \\left(\\sqrt{\\frac{2\\pi}{\\beta\\kappa}}\\right)^d = \\left(\\frac{2\\pi}{\\beta\\kappa}\\right)^{d/2}\n$$\n现在我们可以计算比值 $\\frac{Z(\\beta')}{Z(\\beta_k)}$：\n$$\n\\frac{Z(\\beta')}{Z(\\beta_k)} = \\frac{\\left(\\frac{2\\pi}{\\beta'\\kappa}\\right)^{d/2}}{\\left(\\frac{2\\pi}{\\beta_k\\kappa}\\right)^{d/2}} = \\left(\\frac{2\\pi}{\\beta'\\kappa} \\cdot \\frac{\\beta_k\\kappa}{2\\pi}\\right)^{d/2} = \\left(\\frac{\\beta_k}{\\beta'}\\right)^{d/2}\n$$\n注意刚度参数 $\\kappa$ 被消掉了。我们将 $\\beta_k=1/T_k$ 和 $\\beta' = 2/T_{k+1} - 1/T_k$ 的表达式代回：\n$$\n\\frac{\\beta_k}{\\beta'} = \\frac{1/T_k}{2/T_{k+1} - 1/T_k} = \\frac{1/T_k}{(2T_k - T_{k+1})/(T_k T_{k+1})} = \\frac{1}{T_k} \\frac{T_k T_{k+1}}{2T_k - T_{k+1}} = \\frac{T_{k+1}}{2T_k - T_{k+1}}\n$$\n因此，期望值为：\n$$\n\\mathbb{E}_{x \\sim p_{T_{k}}}\\!\\big[w(x)^{2}\\big] = \\left(\\frac{T_{k+1}}{2T_k - T_{k+1}}\\right)^{d/2}\n$$\n现在我们令其等于 $1/\\eta$ 并求解 $T_{k+1}$：\n$$\n\\left(\\frac{T_{k+1}}{2T_k - T_{k+1}}\\right)^{d/2} = \\frac{1}{\\eta}\n$$\n将两边都取 $2/d$ 次方：\n$$\n\\frac{T_{k+1}}{2T_k - T_{k+1}} = \\left(\\frac{1}{\\eta}\\right)^{2/d} = \\eta^{-2/d}\n$$\n让我们求解 $T_{k+1}$：\n$$\nT_{k+1} = \\eta^{-2/d} (2T_k - T_{k+1})\n$$\n$$\nT_{k+1} = 2T_k \\eta^{-2/d} - T_{k+1} \\eta^{-2/d}\n$$\n$$\nT_{k+1} + T_{k+1} \\eta^{-2/d} = 2T_k \\eta^{-2/d}\n$$\n$$\nT_{k+1} (1 + \\eta^{-2/d}) = 2T_k \\eta^{-2/d}\n$$\n$$\nT_{k+1} = \\frac{2T_k \\eta^{-2/d}}{1 + \\eta^{-2/d}}\n$$\n为了得到更简洁的形式，我们可以将分子和分母同乘以 $\\eta^{2/d}$：\n$$\nT_{k+1} = \\frac{2T_k \\eta^{-2/d} \\cdot \\eta^{2/d}}{(1 + \\eta^{-2/d}) \\cdot \\eta^{2/d}} = \\frac{2T_k}{\\eta^{2/d} + 1}\n$$\n这就是 $T_{k+1}$ 的闭式表达式。\n\n最后，我们检验降温机制的条件，$T_{k+1}  T_k$。\n$$\n\\frac{2T_k}{1 + \\eta^{2/d}}  T_k\n$$\n由于 $T_k > 0$，我们可以用它来除：\n$$\n\\frac{2}{1 + \\eta^{2/d}}  1\n$$\n$$\n2  1 + \\eta^{2/d}\n$$\n$$\n1  \\eta^{2/d}\n$$\n由于 $d \\ge 1$，指数 $2/d$ 是正的。将两边都取 $d/2$ 次方，不等式方向保持不变：\n$$\n1^{d/2}  (\\eta^{2/d})^{d/2} \\implies 1  \\eta\n$$\n因此，推导出的表达式会得到一个降温方案（$T_{k+1}  T_k$），当且仅当目标 ESS $\\eta > 1$。这与问题中 ESS 的定义在物理上是一致的。ESS 为 $\\eta=1$ 对应于 $T_{k+1} = T_k$，此时分布相同，重要性权重均为1。为了在维持期望 ESS $\\eta > 1$ 的同时实现降温步骤，此公式提供了必要的温度更新。", "answer": "$$\n\\boxed{\\frac{2 T_k}{1 + \\eta^{2/d}}}\n$$", "id": "3339559"}]}