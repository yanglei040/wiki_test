{"hands_on_practices": [{"introduction": "理论是抽象的，但通过具体例子可以变得清晰。这个练习是理解指数倾斜（一种重要的测度变换技术）的经典起点。我们将探讨如何估计正态分布变量之和超过某个罕见阈值的概率。通过精确计算，你将亲手推导出最优的倾斜参数，并看到在新的测度下，原本的罕见事件如何变得“典型”，而似然比又是如何精确地修正估计，从而实现方差的显著降低。[@problem_id:3335110]", "problem": "考虑独立同分布的随机变量 $X_1,\\dots,X_n$，其共同分布为 $\\mathcal{N}(m,\\sigma^2)$，其中 $m \\in \\mathbb{R}$ 且 $\\sigma^2 \\in (0,\\infty)$。令 $S_n \\doteq \\sum_{i=1}^{n} X_i$ 并固定一个常数 $a \\in \\mathbb{R}$ 且 $a>m$。我们关注的稀有事件概率为 $p_n \\doteq \\mathbb{P}(S_n \\ge a n)$。为对 $p_n$ 进行重要性抽样，考虑基于累积量生成函数 $K(t) \\doteq \\ln \\mathbb{E}[\\exp(t X_1)]$ 的指数倾斜（Esscher 变换）。对于 $K$ 的有效域中的每个 $t$，该变换会引出一个倾斜分布 $\\mathbb{P}_t$。在此分布下，单步密度被修改为 $f_t(x) \\propto \\exp(t x) f(x)$，并且对于轨迹 $(X_1,\\dots,X_n)$ 的路径似然比（Radon–Nikodym 导数）为 $L_n(t) \\doteq \\frac{\\mathrm{d}\\mathbb{P}}{\\mathrm{d}\\mathbb{P}_t}(X_1,\\dots,X_n)$。由大偏差理论启发的选择 $t=\\theta^\\star$ 是 $K'(\\theta^\\star)=a$ 的唯一解，这强制倾斜均值等于稀有事件的阈值水平。\n\n从这些定义出发，除了矩生成函数的标准性质外，不假设任何特定于高斯分布的捷径，显式计算：\n- 最优倾斜参数 $\\theta^\\star$，\n- 在 $\\mathbb{P}_{\\theta^\\star}$ 下 $X_i$ 的倾斜分布，\n- 以及与指示函数 $\\mathbf{1}\\{S_n \\ge a n\\}$ 一起使用的相应似然比 $L_n^\\star \\doteq L_n(\\theta^\\star)$。\n\n用 $m$、$\\sigma^2$、$a$、$n$ 和 $S_n$ 的符号形式表示所有结果。将最终答案表示为一个行矩阵，其中依次包含 $\\theta^\\star$、倾斜的单步分布和 $L_n^\\star$。不需要数值近似。", "solution": "该问题是有效的，因为它具有科学依据、问题设定良好且客观。这是稀有事件模拟和大偏差理论领域的一个标准问题。我们分三步计算所要求的量来解决它。\n\n随机变量 $X_i$ 是独立同分布 (i.i.d.) 的，服从正态分布 $X_i \\sim \\mathcal{N}(m, \\sigma^2)$。$X_i$ 的概率密度函数 (PDF) 由下式给出\n$$f(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x-m)^2}{2\\sigma^2}\\right)$$\n问题要求我们找到最优倾斜参数 $\\theta^\\star$、此参数下的倾斜分布以及相应的似然比 $L_n^\\star$。\n\n### 1. 最优倾斜参数 $\\theta^\\star$ 的计算\n\n最优倾斜参数 $\\theta^\\star$ 被定义为方程 $K'(\\theta^\\star) = a$ 的唯一解，其中 $K(t)$ 是 $X_1$ 的累积量生成函数 (CGF)。\n\nCGF 是矩生成函数 (MGF) 的自然对数，$K(t) = \\ln \\mathbb{E}[\\exp(t X_1)]$。首先，我们计算 $X_1 \\sim \\mathcal{N}(m, \\sigma^2)$ 的 MGF。\n$$\n\\mathbb{E}[\\exp(t X_1)] = \\int_{-\\infty}^{\\infty} \\exp(tx) \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x-m)^2}{2\\sigma^2}\\right) \\mathrm{d}x\n$$\n指数的参数是\n$$\ntx - \\frac{(x-m)^2}{2\\sigma^2} = tx - \\frac{x^2 - 2mx + m^2}{2\\sigma^2} = -\\frac{1}{2\\sigma^2} [x^2 - 2mx - 2\\sigma^2tx + m^2]\n$$\n我们对含 $x$ 的项进行配方：\n$$\nx^2 - 2(m + \\sigma^2 t)x + m^2 = [x - (m + \\sigma^2 t)]^2 - (m + \\sigma^2 t)^2 + m^2\n$$\n$$\n= [x - (m + \\sigma^2 t)]^2 - (m^2 + 2m\\sigma^2 t + \\sigma^4 t^2) + m^2 = [x - (m + \\sigma^2 t)]^2 - 2m\\sigma^2 t - \\sigma^4 t^2\n$$\n将此代回指数的参数中：\n$$\n-\\frac{1}{2\\sigma^2} \\left( [x - (m + \\sigma^2 t)]^2 - 2m\\sigma^2 t - \\sigma^4 t^2 \\right) = -\\frac{[x - (m + \\sigma^2 t)]^2}{2\\sigma^2} + mt + \\frac{1}{2}\\sigma^2 t^2\n$$\nMGF 变为：\n$$\n\\mathbb{E}[\\exp(t X_1)] = \\exp\\left(mt + \\frac{1}{2}\\sigma^2 t^2\\right) \\int_{-\\infty}^{\\infty} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{[x - (m + \\sigma^2 t)]^2}{2\\sigma^2}\\right) \\mathrm{d}x\n$$\n该积分是关于一个均值为 $m + \\sigma^2 t$、方差为 $\\sigma^2$ 的正态分布的 PDF 的积分，因此其值为 $1$。所以，MGF 是：\n$$\nM_{X_1}(t) = \\exp\\left(mt + \\frac{1}{2}\\sigma^2 t^2\\right)\n$$\nCGF 是 MGF 的自然对数：\n$$\nK(t) = \\ln(M_{X_1}(t)) = mt + \\frac{1}{2}\\sigma^2 t^2\n$$\n$t$ 的有效域是 $\\mathbb{R}$。现在，我们求它关于 $t$ 的导数：\n$$\nK'(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left(mt + \\frac{1}{2}\\sigma^2 t^2\\right) = m + \\sigma^2 t\n$$\n最优参数 $\\theta^\\star$ 解方程 $K'(\\theta^\\star) = a$：\n$$\nm + \\sigma^2 \\theta^\\star = a\n$$\n解出 $\\theta^\\star$，我们得到：\n$$\n\\theta^\\star = \\frac{a - m}{\\sigma^2}\n$$\n鉴于 $a > m$ 且 $\\sigma^2 > 0$，我们有 $\\theta^\\star > 0$。\n\n### 2. 倾斜分布的计算\n\n倾斜密度 $f_t(x)$ 由 $f_t(x) \\propto \\exp(tx)f(x)$ 定义。归一化的密度是：\n$$\nf_t(x) = \\frac{\\exp(tx)f(x)}{\\mathbb{E}[\\exp(tX_1)]} = \\exp(tx - K(t)) f(x)\n$$\n我们将 $t=\\theta^\\star$ 时 $f(x)$ 和 $K(t)$ 的表达式代入：\n$$\nf_{\\theta^\\star}(x) = \\exp\\left(\\theta^\\star x - K(\\theta^\\star)\\right) \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x-m)^2}{2\\sigma^2}\\right)\n$$\n$$\nf_{\\theta^\\star}(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(\\theta^\\star x - K(\\theta^\\star) - \\frac{(x-m)^2}{2\\sigma^2}\\right)\n$$\n我们来分析指数的参数。我们使用前面找到的 $\\theta^\\star$ 和 $K(\\theta^\\star)$ 的表达式。\n指数的参数是：\n$$\n\\theta^\\star x - (m\\theta^\\star + \\frac{1}{2}\\sigma^2(\\theta^\\star)^2) - \\frac{x^2 - 2mx + m^2}{2\\sigma^2}\n$$\n$$\n= -\\frac{x^2}{2\\sigma^2} + \\left(\\frac{m}{\\sigma^2} + \\theta^\\star\\right)x - \\left(\\frac{m^2}{2\\sigma^2} + m\\theta^\\star + \\frac{1}{2}\\sigma^2(\\theta^\\star)^2\\right)\n$$\n我们从 $x$ 的线性项中确定新的均值 $m_{\\theta^\\star}$。对于方差为 $\\sigma^2$ 的正态密度，其指数形式为 $-\\frac{(x-m_{\\theta^\\star})^2}{2\\sigma^2} = -\\frac{x^2}{2\\sigma^2} + \\frac{m_{\\theta^\\star}}{\\sigma^2}x - \\frac{m_{\\theta^\\star}^2}{2\\sigma^2}$。\n比较 $x$ 的系数，我们有：\n$$\n\\frac{m_{\\theta^\\star}}{\\sigma^2} = \\frac{m}{\\sigma^2} + \\theta^\\star \\implies m_{\\theta^\\star} = m + \\sigma^2 \\theta^\\star\n$$\n代入 $\\theta^\\star = \\frac{a-m}{\\sigma^2}$：\n$$\nm_{\\theta^\\star} = m + \\sigma^2 \\left(\\frac{a-m}{\\sigma^2}\\right) = m + a - m = a\n$$\n这与倾斜分布的均值为 $K'(\\theta^\\star)=a$ 的性质是一致的。由 $x^2$ 的系数决定的方差项保持为 $\\sigma^2$。得到的倾斜密度是：\n$$\nf_{\\theta^\\star}(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x-a)^2}{2\\sigma^2}\\right)\n$$\n这是一个均值为 $a$、方差为 $\\sigma^2$ 的正态分布的 PDF。因此，倾斜的单步分布是 $\\mathcal{N}(a, \\sigma^2)$。\n\n### 3. 似然比 $L_n^\\star$ 的计算\n\n路径似然比是 Radon-Nikodym 导数 $L_n(t) = \\frac{\\mathrm{d}\\mathbb{P}}{\\mathrm{d}\\mathbb{P}_t}$。由于变量 $X_1, \\dots, X_n$ 在两种测度下都是独立同分布的，联合密度的比率是边际密度比率的乘积：\n$$\nL_n(t) = \\frac{\\prod_{i=1}^n f(X_i)}{\\prod_{i=1}^n f_t(X_i)} = \\prod_{i=1}^n \\frac{f(X_i)}{f_t(X_i)}\n$$\n根据 $f_t(x)$ 的定义，我们有 $\\frac{f(x)}{f_t(x)} = \\exp(-tx + K(t))$。因此：\n$$\nL_n(t) = \\prod_{i=1}^n \\exp(-tX_i + K(t)) = \\exp\\left(\\sum_{i=1}^n (-tX_i + K(t))\\right)\n$$\n$$\nL_n(t) = \\exp\\left(-t \\sum_{i=1}^n X_i + n K(t)\\right) = \\exp(-t S_n + nK(t))\n$$\n我们需要在 $t=\\theta^\\star$ 处计算该表达式。令 $L_n^\\star = L_n(\\theta^\\star)$:\n$$\nL_n^\\star = \\exp(-\\theta^\\star S_n + nK(\\theta^\\star))\n$$\n我们代入 $\\theta^\\star = \\frac{a-m}{\\sigma^2}$ 并计算 $K(\\theta^\\star)$:\n$$\nK(\\theta^\\star) = m\\theta^\\star + \\frac{1}{2}\\sigma^2 (\\theta^\\star)^2 = m\\left(\\frac{a-m}{\\sigma^2}\\right) + \\frac{1}{2}\\sigma^2 \\left(\\frac{a-m}{\\sigma^2}\\right)^2\n$$\n$$\nK(\\theta^\\star) = \\frac{m(a-m)}{\\sigma^2} + \\frac{(a-m)^2}{2\\sigma^2} = \\frac{2m(a-m) + (a-m)^2}{2\\sigma^2} = \\frac{(a-m)(2m + a - m)}{2\\sigma^2}\n$$\n$$\nK(\\theta^\\star) = \\frac{(a-m)(a+m)}{2\\sigma^2} = \\frac{a^2 - m^2}{2\\sigma^2}\n$$\n最后，我们将 $\\theta^\\star$ 和 $K(\\theta^\\star)$ 代入 $L_n^\\star$ 的表达式中：\n$$\nL_n^\\star = \\exp\\left( - \\left(\\frac{a-m}{\\sigma^2}\\right) S_n + n \\left(\\frac{a^2-m^2}{2\\sigma^2}\\right) \\right)\n$$\n该表达式取决于指定的变量 $m, \\sigma^2, a, n$ 和样本和 $S_n$。\n\n所要求的三个量是：\n1.  $\\theta^\\star = \\frac{a-m}{\\sigma^2}$\n2.  倾斜的单步分布是 $\\mathcal{N}(a, \\sigma^2)$\n3.  $L_n^\\star = \\exp\\left( - \\frac{a-m}{\\sigma^2} S_n + n\\frac{a^2-m^2}{2\\sigma^2} \\right)$\n将这些结果收集到一个行矩阵中作为最终答案。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{a-m}{\\sigma^2}  \\mathcal{N}(a, \\sigma^2)  \\exp\\left( - \\frac{a-m}{\\sigma^2} S_n + n\\frac{a^2-m^2}{2\\sigma^2} \\right) \\end{pmatrix}}\n$$", "id": "3335110"}, {"introduction": "在掌握了一维情形后，我们将挑战推广到更高维度。此练习探讨了多维正态向量的二次型所产生的罕见事件，这在金融和工程领域有广泛应用。你将首先运用大偏差理论中的优化思想，找到导致罕见事件发生的最“可能”路径，即“控制点”（dominating point）。这个练习不仅展示了如何将指数倾斜推广到多维，还引入了另一种由控制点启发的有效方法——均值漂移法，从而深化你对测度变换背后几何直觉的理解。[@problem_id:3335057]", "problem": "设 $X \\in \\mathbb{R}^{d}$ 是一个服从 $d$ 维标准多元正态分布的随机向量，$X \\sim \\mathcal{N}(0, I_{d})$，并设 $A \\in \\mathbb{R}^{d \\times d}$ 是一个对称半正定矩阵。将 $A$ 的特征值记为 $\\lambda_{1} \\ge \\lambda_{2} \\ge \\cdots \\ge \\lambda_{d} \\ge 0$，其相应的特征向量标准正交基记为 $v_{1}, \\dots, v_{d}$，其中 $(\\lambda_{1}, v_{1})$ 为顶层特征对。考虑稀有事件概率\n$$\np \\;=\\; \\mathbb{P}\\!\\left( X^{\\top} A X \\,\\ge\\, c \\right),\n$$\n其中阈值 $c$ 满足 $c > \\operatorname{tr}(A)$，从而使得该事件在标称测度下确实是稀有事件。从第一性原理出发，即标准多元正态密度、通过对统计量进行 Esscher 变换的测度变换、以及变分法的定义，进行以下推导：\n\n1. 使用与高斯测度的大偏差原理 (LDP) 一致的约束优化论证，确定在约束 $x^{\\top} A x \\ge c$ 下使高斯速率函数 $\\frac{1}{2}\\|x\\|^{2}$ 最小化的主导点 $x^{\\star}$。用 $c$ 和 $A$ 的顶层特征对 $(\\lambda_{1}, v_{1})$ 表示 $x^{\\star}$。\n\n2. 为二次型 $S = X^{\\top} A X$ 构建一个指数加权方案（Esscher 变换），其中使用一个正的倾斜参数 $\\theta$，使得加权后的抽样分布相对于标称分布是绝对连续的。推导加权抽样分布的闭式解，并写出相应的似然比（权重）$w_{\\theta}(x)$，在加权测度下，该似然比可以为 $p$ 产生一个无偏的重要性抽样 (IS) 估计量。明确定义所有量。\n\n3. 通过施加在加权分布下 $S$ 的期望等于阈值 $c$ 的条件，来确定倾斜参数 $\\theta^{\\star}$。用 $A$ 的谱 $\\{\\lambda_{i}\\}_{i=1}^{d}$ 给出由此得到的 $\\theta^{\\star}$ 的解析刻画，并证明在加权分布有定义的域内 $\\theta^{\\star}$ 的存在性和唯一性。\n\n4. 作为一种由主导点引导的替代方案，设计一个均值漂移重要性抽样策略，通过从 $\\mathcal{N}(\\mu, I_{d})$ 中抽样，其中均值向量 $\\mu$ 是确定性的且与 $v_{1}$ 对齐。推导相应的似然比 $w_{\\mu}(x)$，并指明与第 1 部分中的主导点一致的 $\\mu$ 的选择。\n\n你的最终答案必须是包含以下内容的单个闭式解析表达式或由闭式解析表达式组成的单行矩阵：主导点 $x^{\\star}$、最优倾斜参数 $\\theta^{\\star}$ 的刻画、指数加权权重 $w_{\\theta}(x)$、以及在 $\\mu$ 与 $v_{1}$ 对齐选择下的均值漂移权重 $w_{\\mu}(x)$。无需进行数值评估。", "solution": "该问题被评估为有效。它在科学上基于概率论、大偏差和随机模拟的原理。它是适定的、客观的，并包含足够的信息来为每个部分推导出唯一的解。我们开始求解。\n\n分析的关键在于对称矩阵 $A$ 的谱分解，它可以写成 $A = V \\Lambda V^{\\top}$，其中 $V$ 是一个正交矩阵，其列是特征向量 $v_1, \\dots, v_d$，而 $\\Lambda = \\operatorname{diag}(\\lambda_1, \\dots, \\lambda_d)$ 是相应特征值的对角矩阵。\n\n**1. 主导点 $x^{\\star}$ 的推导**\n\n根据高斯测度的大偏差原理，稀有事件的概率由事件集中的“最可能”点所主导。对于一个标准高斯向量 $X \\in \\mathbb{R}^d$，其可能性由速率函数 $I(x) = \\frac{1}{2}\\|x\\|^2$ 决定。主导点 $x^{\\star}$ 是在定义稀有事件的约束条件下使该速率函数最小化的点。\n\n优化问题是：\n$$\n\\text{minimize} \\quad \\frac{1}{2} x^{\\top}x \\quad \\text{subject to} \\quad x^{\\top}Ax \\ge c.\n$$\n由于目标函数 $\\frac{1}{2}x^{\\top}x$ 随 $x$ 的范数严格递增，且可行集被推离原点（因为 $c > \\operatorname{tr}(A) \\ge 0$），最小值将出现在可行集的边界上，即 $x^{\\top}Ax = c$ 处。\n\n我们为此约束优化问题构建拉格朗日函数：\n$$\n\\mathcal{L}(x, \\mu) = \\frac{1}{2}x^{\\top}x - \\mu \\left(x^{\\top}Ax - c\\right)\n$$\n其中 $\\mu \\ge 0$ 是拉格朗日乘子。对 $x$ 求梯度并令其为零，得到一阶条件：\n$$\n\\nabla_x \\mathcal{L}(x, \\mu) = x - 2\\mu A x = 0 \\implies (I - 2\\mu A)x = 0.\n$$\n该方程意味着对于非零解 $x$，它必须是矩阵 $A$ 的特征向量。设 $x$ 是 $A$ 的一个特征向量，其对应的特征值为 $\\lambda_i$。那么：\n$$\nAx = \\lambda_i x\n$$\n将此代入条件中可得 $x - 2\\mu \\lambda_i x = 0$，对于 $x \\neq 0$ 这意味着 $1 - 2\\mu \\lambda_i = 0$。这要求 $\\lambda_i > 0$（如果 $\\lambda_i=0$，则 $1=0$，产生矛盾）并得出 $\\mu = \\frac{1}{2\\lambda_i}$。由于 $\\mu>0$，这是一个有效的拉格朗日乘子。\n\n解 $x$ 必须是 $A$ 的特征向量。设 $x = k v_i$，其中 $k$ 为某个标量，$v_i$ 为单位特征向量。根据边界约束 $x^{\\top}Ax=c$：\n$$\n(k v_i)^{\\top} A (k v_i) = k^2 v_i^{\\top} A v_i = k^2 \\lambda_i = c \\implies k^2 = \\frac{c}{\\lambda_i}.\n$$\n目标函数的值为 $\\frac{1}{2}\\|x\\|^2 = \\frac{1}{2} \\|k v_i\\|^2 = \\frac{1}{2} k^2 \\|v_i\\|^2 = \\frac{1}{2} k^2 = \\frac{c}{2\\lambda_i}$。为使该值最小化，我们必须最大化特征值 $\\lambda_i$。$A$ 的最大特征值是 $\\lambda_1$。这意味着最小化解所对应的特征向量必须是与 $\\lambda_1$ 相关的特征向量。我们注意到，为了使这个解有意义，我们必须有 $\\lambda_1 > 0$。如果 $\\lambda_1=0$，那么 $A=0$，$\\operatorname{tr}(A)=0$。条件 $c>\\operatorname{tr}(A)$ 意味着 $c>0$。约束 $x^\\top A x \\ge c$ 变为 $0 \\ge c$，这是一个矛盾。因此，可行集为空，我们必须假设 $\\lambda_1>0$。\n\n主导点的范数平方为 $\\|x^{\\star}\\|^2 = c/\\lambda_1$。一个可能的解是 $x^{\\star} = \\sqrt{\\frac{c}{\\lambda_1}} v_1$。这里存在符号不确定性，$x^{\\star} = \\pm\\sqrt{\\frac{c}{\\lambda_1}} v_1$，但两个点都使得速率函数取得相同的最小值。按照惯例，我们选择其中一个，例如带正号的那个。\n$$\nx^{\\star} = \\sqrt{\\frac{c}{\\lambda_1}} v_1.\n$$\n\n**2. 指数加权与似然比**\n\n$X \\sim \\mathcal{N}(0, I_d)$ 的标称密度为 $f(x) = (2\\pi)^{-d/2} \\exp\\left(-\\frac{1}{2}x^{\\top}x\\right)$。对统计量 $S = X^{\\top}AX$ 使用参数 $\\theta>0$ 进行 Esscher 变换，定义了一个新的概率密度 $f_\\theta(x)$ 如下：\n$$\nf_{\\theta}(x) = \\frac{f(x)\\exp(\\theta S(x))}{\\mathbb{E}[\\exp(\\theta S(x))]} = \\frac{f(x)\\exp(\\theta x^{\\top}Ax)}{M_S(\\theta)},\n$$\n其中 $M_S(\\theta)$ 是 $S$ 的矩生成函数 (MGF)。分子正比于：\n$$\n\\exp\\left(-\\frac{1}{2}x^{\\top}x + \\theta x^{\\top}Ax\\right) = \\exp\\left(-\\frac{1}{2}x^{\\top}(I - 2\\theta A)x\\right).\n$$\n该表达式对应于一个高斯密度的核，条件是矩阵 $I - 2\\theta A$ 是对称正定的。由于 $A$ 是对称的，$I-2\\theta A$ 也是对称的。为保证正定性，其所有特征值必须为正。$I-2\\theta A$ 的特征值为 $1-2\\theta\\lambda_i$。我们要求对所有的 $i=1, \\dots, d$ 都有 $1-2\\theta\\lambda_i > 0$。考虑到 $\\theta>0$，这等价于对所有 $\\lambda_i > 0$ 都有 $\\theta  \\frac{1}{2\\lambda_i}$。这个条件必须对最大特征值 $\\lambda_1$ 成立，因此 $\\theta$ 的定义域是 $0  \\theta  \\frac{1}{2\\lambda_1}$。\n\nMGF $M_S(\\theta)$ 是未归一化密度的积分：\n$$\nM_S(\\theta) = \\int_{\\mathbb{R}^d} (2\\pi)^{-d/2} \\exp\\left(-\\frac{1}{2}x^{\\top}(I - 2\\theta A)x\\right) dx.\n$$\n这个积分可以看作是 $\\mathcal{N}(0, (I-2\\theta A)^{-1})$ 分布的归一化常数，即 $\\det(I-2\\theta A)^{-1/2}$。\n行列式是特征值的乘积：\n$$\n\\det(I - 2\\theta A) = \\prod_{i=1}^d (1 - 2\\theta \\lambda_i).\n$$\n所以，$M_S(\\theta) = \\left(\\prod_{i=1}^d (1 - 2\\theta\\lambda_i)\\right)^{-1/2}$。\n\n因此，加权抽样分布是一个均值为零、协方差矩阵为 $\\Sigma_\\theta = (I - 2\\theta A)^{-1}$ 的高斯分布。其密度为：\n$$\nf_\\theta(x) = (2\\pi)^{-d/2} \\det(I-2\\theta A)^{1/2} \\exp\\left(-\\frac{1}{2}x^{\\top}(I-2\\theta A)x\\right).\n$$\n重要性抽样权重（似然比）是 $w_{\\theta}(x) = f(x)/f_{\\theta}(x)$。\n$$\nw_{\\theta}(x) = \\frac{f(x)}{f(x)\\exp(\\theta x^{\\top}Ax) / M_S(\\theta)} = M_S(\\theta)\\exp(-\\theta x^{\\top}Ax).\n$$\n代入 $M_S(\\theta)$ 的表达式，我们得到：\n$$\nw_{\\theta}(x) = \\exp(-\\theta x^{\\top}A x) \\left(\\prod_{i=1}^{d} (1 - 2\\theta\\lambda_i)\\right)^{-\\frac{1}{2}}.\n$$\n\n**3. 最优倾斜参数 $\\theta^{\\star}$**\n\n在这种情况下，最优傾斜参数 $\\theta^{\\star}$ 的选择需要满足条件 $\\mathbb{E}_\\theta[S] = c$，这意味着在某种意义上，加权分布的中心位于稀有事件的边界上。期望 $\\mathbb{E}_\\theta[S]$ 可以从累积量生成函数 (CGF) $K_S(\\theta) = \\ln M_S(\\theta)$ 计算得出。\n$$\nK_S(\\theta) = \\ln\\left[ \\left(\\prod_{i=1}^d (1 - 2\\theta\\lambda_i)\\right)^{-1/2} \\right] = -\\frac{1}{2} \\sum_{i=1}^d \\ln(1-2\\theta\\lambda_i).\n$$\n期望由 CGF 的导数给出：\n$$\n\\mathbb{E}_{\\theta}[S] = \\frac{d}{d\\theta} K_S(\\theta) = -\\frac{1}{2} \\sum_{i=1}^d \\frac{-2\\lambda_i}{1 - 2\\theta\\lambda_i} = \\sum_{i=1}^d \\frac{\\lambda_i}{1 - 2\\theta\\lambda_i}.\n$$\n我们需要找到 $\\theta^{\\star} > 0$ 来求解方程：\n$$\n\\sum_{i=1}^d \\frac{\\lambda_i}{1-2\\theta^{\\star}\\lambda_i} = c.\n$$\n令 $g(\\theta) = \\sum_{i=1}^d \\frac{\\lambda_i}{1-2\\theta\\lambda_i}$。$\\theta$ 的定义域是 $(0, 1/(2\\lambda_1))$。在 $\\theta=0$ 时，$g(0) = \\sum_{i=1}^d \\lambda_i = \\operatorname{tr}(A)$。导数是 $g'(\\theta) = \\sum_{i=1}^d \\frac{2\\lambda_i^2}{(1-2\\theta\\lambda_i)^2} \\ge 0$。由于我们假设了 $\\lambda_1 > 0$，所以 $g'(\\theta)>0$，因此 $g(\\theta)$ 在其定义域上是严格递增的。当 $\\theta \\to (1/(2\\lambda_1))^-$ 时，含有 $\\lambda_1$ 的项占主导地位，且 $g(\\theta) \\to \\infty$。由于问题陈述 $c > \\operatorname{tr}(A)$，我们有 $g(0)  c$ 且 $\\lim_{\\theta \\to (1/(2\\lambda_1))^-} g(\\theta) = \\infty$。根据介值定理，方程 $g(\\theta) = c$ 在 $(0, 1/(2\\lambda_1))$ 内存在唯一解 $\\theta^{\\star}$。通常无法得到 $\\theta^{\\star}$ 的解析闭式表达式。该方程本身就是 $\\theta^{\\star}$ 的解析刻画。\n\n**4. 均值漂移重要性抽样**\n\n在此方案中，我们从一个分布 $X_\\mu \\sim \\mathcal{N}(\\mu, I_d)$ 中抽样，其中协方差不变，但均值发生了漂移。其密度为 $f_{\\mu}(x) = (2\\pi)^{-d/2}\\exp\\left(-\\frac{1}{2}(x-\\mu)^{\\top}(x-\\mu)\\right)$。似然比为 $w_{\\mu}(x) = f(x) / f_{\\mu}(x)$：\n$$\nw_{\\mu}(x) = \\frac{(2\\pi)^{-d/2}\\exp\\left(-\\frac{1}{2}x^{\\top}x\\right)}{(2\\pi)^{-d/2}\\exp\\left(-\\frac{1}{2}(x-\\mu)^{\\top}(x-\\mu)\\right)} = \\exp\\left(-\\frac{1}{2}x^{\\top}x + \\frac{1}{2}(x^{\\top}x - 2\\mu^{\\top}x + \\mu^{\\top}\\mu)\\right)\n$$\n$$\nw_{\\mu}(x) = \\exp\\left(-\\mu^{\\top}x + \\frac{1}{2}\\mu^{\\top}\\mu\\right).\n$$\n漂移向量 $\\mu$ 被选择为与 $v_1$ 对齐，因此 $\\mu = \\alpha v_1$。与第 1 部分中的主导点一致的一个自然选择是，将抽样分布的均值漂移到该点。因此，我们设置 $\\mu = x^{\\star}$。\n$$\n\\mu = x^{\\star} = \\sqrt{\\frac{c}{\\lambda_1}} v_1.\n$$\n通过此选择，我们计算权重表达式中的各项：\n$$\n\\mu^{\\top}\\mu = \\left(\\sqrt{\\frac{c}{\\lambda_1}} v_1\\right)^{\\top} \\left(\\sqrt{\\frac{c}{\\lambda_1}} v_1\\right) = \\frac{c}{\\lambda_1} v_1^{\\top}v_1 = \\frac{c}{\\lambda_1},\n$$\n因为 $v_1$ 是单位向量。项 $\\mu^{\\top}x$ 是：\n$$\n\\mu^{\\top}x = \\left(\\sqrt{\\frac{c}{\\lambda_1}} v_1\\right)^{\\top} x = \\sqrt{\\frac{c}{\\lambda_1}} v_1^{\\top}x.\n$$\n将这些代入 $w_{\\mu}(x)$ 的表达式中得到：\n$$\nw_{\\mu}(x) = \\exp\\left(-\\sqrt{\\frac{c}{\\lambda_1}} v_1^{\\top}x + \\frac{c}{2\\lambda_1}\\right).\n$$\n这就完成了所要求的推导。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{\\frac{c}{\\lambda_1}} v_1  \\sum_{i=1}^{d} \\frac{\\lambda_i}{1-2\\theta^{\\star}\\lambda_i} = c  \\exp(-\\theta x^{\\top}A x) \\left(\\prod_{i=1}^{d} (1 - 2\\theta\\lambda_i)\\right)^{-\\frac{1}{2}}  \\exp\\left(-\\sqrt{\\frac{c}{\\lambda_1}} v_1^{\\top}x + \\frac{c}{2\\lambda_1}\\right) \\end{pmatrix}}\n$$", "id": "3335057"}, {"introduction": "理论的最终目的是解决实际问题。最后的这个动手实践将带领你从连续的理论世界进入离散且高度复杂的网络可靠性估计问题。你将为一个网络图设计并实现一个重要性抽样方案，以估计其因边随机失效而断开的概率。这个练习的精髓在于，当解析“控制点”难以获得时，如何利用如图的有效电阻等启发式指标来指导测度变换，智能地探索重要的失效模式，这是将罕见事件模拟应用于复杂系统的关键一步。[@problem_id:3335056]", "problem": "考虑一个无向简单连通图，其节点从$0$开始以整数索引。在基准概率测度$\\mathbb{P}$下，每条边$e$的失效遵循独立的伯努利随机变量$E_e \\sim \\mathrm{Bern}(p_e)$。将失效后图变得不连通的事件定义为稀有事件。任务是为重要性采样设计并实现一种测度变换，以估计图的不连通概率 $\\theta = \\mathbb{P}(\\text{disconnected})$。\n\n从以下基本要素开始：\n- 独立的伯努利失效 $E_e \\sim \\mathrm{Bern}(p_e)$。\n- 使用测度变换$\\mathbb{Q}$的重要性采样，该变换保持独立性，但将$p_e$替换为倾斜概率$p_e'$。\n- 节点间的有效电阻，作为边的重要性度量，其源于图拉普拉斯矩阵及其Moore–Penrose伪逆。\n\n您必须使用有效电阻，实现一种针对每条边且与边的重要性成正比的倾斜。具体而言，对于每条边$e = (i,j)$，使用原始图（边权重为单位1）的拉普拉斯矩阵$L$、Moore-Penrose伪逆$L^{+}$以及以下公式计算其有效电阻$R_{ij}$：\n$$\nR_{ij} = (e_i - e_j)^\\top L^{+} (e_i - e_j),\n$$\n其中$e_k$是$\\mathbb{R}^n$中的标准基向量，其在位置$k$处为$1$，其余位置为$0$，$n$是节点数。\n\n通过以下公式归一化边的重要性权重：\n$$\nw_e = \\frac{R_{ij}}{\\max_{f} R_f},\n$$\n以使$w_e \\in [0,1]$且所有边都保留一个有效的重要性得分。使用这些权重，实现一个强度参数为$\\alpha > 0$的逻辑斯谛倾斜：\n$$\n\\mathrm{logit}(p_e') = \\mathrm{logit}(p_e) + \\alpha w_e,\n$$\n其中$\\mathrm{logit}(x) = \\log\\left(\\frac{x}{1-x}\\right)$，以及inverse-logit函数$\\sigma(x) = \\frac{1}{1 + e^{-x}}$给出$p_e' = \\sigma(\\mathrm{logit}(p_e) + \\alpha w_e)$。\n\n在倾斜测度$\\mathbb{Q}$下（其中各边的$E_e \\sim \\mathrm{Bern}(p_e')$相互独立），使用无偏估计量通过重要性采样来估计$\\theta$：\n$$\n\\hat{\\theta}_N = \\frac{1}{N} \\sum_{k=1}^N \\mathbf{1}\\{\\text{disconnected after failures } \\mathbf{E}^{(k)}\\} \\cdot L(\\mathbf{E}^{(k)}),\n$$\n其中$\\mathbf{E}^{(k)} = (E_e^{(k)})_e$是$\\mathbb{Q}$下的第$k$个样本，似然比$L(\\mathbf{E})$为\n$$\nL(\\mathbf{E}) = \\prod_{e} \\frac{p_e^{E_e} (1-p_e)^{1-E_e}}{(p_e')^{E_e} (1-p_e')^{1-E_e}}.\n$$\n\n必须在失效后的图上测试连通性，该图保留所有节点和幸存的边（即$E_e = 0$的边）。从节点$0$开始使用广度优先搜索，并验证访问到的节点数是否等于$n$。如果出现角度或物理单位，您需要指定弧度或物理单位；然而，本问题仅涉及无量纲的概率和图论量，因此不需要物理单位。\n\n实现上述估计量，并为以下测试套件生成数值输出。为保证可复现性，请为每个用例使用指定的伪随机数生成器种子。\n\n测试套件：\n- 用例1（中等概率，路径图）：\n  - 节点数 $n = 5$。\n  - 边列表 $[(0,1),(1,2),(2,3),(3,4)]$。\n  - 所有$e$的基准概率 $p_e = 0.02$。\n  - 倾斜强度 $\\alpha = 2.0$。\n  - 样本量 $N = 30000$。\n  - 种子 $s = 12345$。\n- 用例2（稀有事件，完全图）：\n  - 节点数 $n = 5$。\n  - 边列表是所有满足$0 \\le i  j \\le 4$的无序对$(i,j)$。\n  - 所有$e$的基准概率 $p_e = 0.005$。\n  - 倾斜强度 $\\alpha = 4.0$。\n  - 样本量 $N = 40000$。\n  - 种子 $s = 23456$。\n- 用例3（异构重要性，梯子图）：\n  - 节点数 $n = 6$。\n  - 边列表 $[(0,1),(2,3),(4,5),(0,2),(2,4),(1,3),(3,5)]$。\n  - 按照给定边的顺序，基准概率为 $p_e = [0.01,0.01,0.01,0.02,0.02,0.02,0.02]$。\n  - 倾斜强度 $\\alpha = 3.0$。\n  - 样本量 $N = 40000$。\n  - 种子 $s = 34567$。\n- 用例4（边界检查，无倾斜，星形图）：\n  - 节点数 $n = 6$。\n  - 边列表 $[(0,1),(0,2),(0,3),(0,4),(0,5)]$。\n  - 所有$e$的基准概率 $p_e = 0.01$。\n  - 倾斜强度 $\\alpha = 0.0$。\n  - 样本量 $N = 30000$。\n  - 种子 $s = 45678$。\n\n您的程序必须：\n- 从原始图拉普拉斯矩阵$L$及其伪逆$L^{+}$计算有效电阻$R_{ij}$。\n- 通过使用权重$w_e$和强度$\\alpha$的逻辑斯谛倾斜，从$p_e$构建倾斜概率$p_e'$。\n- 在$\\mathbb{Q}$下模拟$N$个独立的$\\mathbf{E}$样本。\n- 对每个样本，计算连通性指示符和似然比$L(\\mathbf{E})$。\n- 输出所有测试用例的最终估计值$\\hat{\\theta}_N$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，`[result_1,result_2,result_3,result_4]`）。每个条目必须是浮点数。", "solution": "该问题要求使用重要性采样蒙特卡洛方法来估计图不连通的概率，这是一个稀有事件。任务的核心是设计并实现一种特定的测度变换，其中模拟概率向导致不连通的构型“倾斜”。这种倾斜由图论概念中的有效电阻引导，它可作为衡量边关键性的指标。\n\n解决方案分为两个阶段。首先是预计算阶段，在该阶段我们分析图结构以确定边的重要性并推导出倾斜概率。其次是模拟阶段，在该阶段我们在新的概率下运行蒙特卡洛实验，并计算不连通概率$\\theta$的无偏估计量。\n\n**1. 图拉普拉斯矩阵与有效电阻**\n\n边重要性度量的基础是图拉普拉斯矩阵。对于一个给定的具有$n = |V|$个节点的无向简单图$G=(V, E)$，我们首先考虑其所有边权重为1的版本。其结构由邻接矩阵$A$捕捉，其中如果节点$i$和$j$之间存在边，则$A_{ij} = 1$，否则$A_{ij} = 0$。度矩阵$D$是一个对角矩阵，其中$D_{ii}$是节点$i$的度。图拉普拉斯矩阵$L$定义为：\n$$\nL = D - A\n$$\n拉普拉斯矩阵是奇异的；其最小特征值为$0$，对应的特征向量是全1向量$(1, 1, \\dots, 1)^\\top$。这种奇异性使其无法直接求逆。为了继续，我们使用Moore-Penrose伪逆，记为$L^{+}$。\n\n两个节点$i$和$j$之间的有效电阻$R_{ij}$，是一个源于将图解释为电气网络的概念，其中每条边都是一个单位电阻。它量化了当在$i$注入单位电流并在$j$取出时，$i$和$j$之间出现的电压差。边$(i,j)$的高有效电阻意味着它是图连通性的一个瓶颈。它使用拉普拉斯矩阵的伪逆计算：\n$$\nR_{ij} = (e_i - e_j)^\\top L^{+} (e_i - e_j)\n$$\n其中$e_k$是$\\mathbb{R}^n$中位置$k$为$1$的标准基向量。这等价于$R_{ij} = L^{+}_{ii} + L^{+}_{jj} - 2L^{+}_{ij}$。\n\n然后将这些电阻归一化，为每条边$e$创建无量纲的重要性权重$w_e \\in [0, 1]$：\n$$\nw_e = \\frac{R_e}{\\max_{f} R_f}\n$$\n这种归一化确保了倾斜机制在不同图结构中的一致应用。\n\n**2. 使用逻辑斯谛倾斜的重要性采样**\n\n目标是估计$\\theta = \\mathbb{P}(\\mathcal{D})$，其中$\\mathcal{D}$是图不连通的事件。在基准测度$\\mathbb{P}$下，每条边$e$以概率$p_e$独立地失效（被移除）。朴素的蒙特卡洛模拟效率会很低，因为$\\mathcal{D}$是一个稀有事件。\n\n重要性采样通过引入一个新的概率测度$\\mathbb{Q}$来解决这个问题，在该测度下事件$\\mathcal{D}$更频繁地发生。然后我们使用似然比来校正这种测度变换。$\\theta$的重要性采样估计量为：\n$$\n\\hat{\\theta}_N = \\frac{1}{N} \\sum_{k=1}^N \\mathbf{1}\\{\\mathbf{E}^{(k)} \\in \\mathcal{D}\\} \\cdot L(\\mathbf{E}^{(k)})\n$$\n这里，$\\mathbf{E}^{(k)}$是从倾斜分布$\\mathbb{Q}$中抽取的第$k$个边失效样本，$\\mathbf{1}\\{\\cdot\\}$是指示函数，$L(\\mathbf{E}^{(k)})$是似然比。\n\n问题指定了逻辑斯谛倾斜。边$e$的新失效概率$p_e'$通过logit函数$\\mathrm{logit}(x) = \\log(x/(1-x))$定义：\n$$\n\\mathrm{logit}(p_e') = \\mathrm{logit}(p_e) + \\alpha w_e\n$$\n其中$\\alpha > 0$是控制倾斜强度的参数。正的$\\alpha$会增加高重要性（$w_e > 0$）边的失效概率，从而使不连通事件更可能发生。新的概率$p_e'$通过inverse-logit（sigmoid）函数$\\sigma(x) = (1 + e^{-x})^{-1}$恢复：\n$$\np_e' = \\sigma(\\mathrm{logit}(p_e) + \\alpha w_e)\n$$\n在$\\mathbb{Q}$下，边的失效仍然是独立的，但概率为$p_e'$。对于给定的失效构型$\\mathbf{E} = (E_e)_e$，其中$E_e=1$表示失效，$E_e=0$表示幸存，其似然比$L(\\mathbf{E})$是各条边似然比的乘积：\n$$\nL(\\mathbf{E}) = \\frac{d\\mathbb{P}}{d\\mathbb{Q}}(\\mathbf{E}) = \\prod_e \\frac{p_e^{E_e} (1-p_e)^{1-E_e}}{(p_e')^{E_e} (1-p_e')^{1-E_e}}\n$$\n为保证数值稳定性，最好先计算对数似然比：\n$$\n\\log L(\\mathbf{E}) = \\sum_e \\left[ E_e (\\log p_e - \\log p_e') + (1-E_e) (\\log(1-p_e) - \\log(1-p_e')) \\right]\n$$\n然后对结果取指数。\n\n**3. 算法实现**\n\n每个测试用例的总体算法流程如下：\n\n1.  **初始化**：给定节点数$n$、边列表、基准失效概率$p_e$、倾斜强度$\\alpha$、样本量$N$和随机种子$s$。设置种子以确保可复现性。\n\n2.  **预计算**：\n    a. 假设单位边权重，构建$n \\times n$的图拉普拉斯矩阵$L$。\n    b. 使用标准线性代数库函数计算Moore-Penrose伪逆$L^{+}$。\n    c. 对图中的每条边$e=(i,j)$，计算其有效电阻$R_{ij}$。\n    d. 找到最大有效电阻并计算归一化权重$w_e$。\n    e. 使用逻辑斯谛倾斜公式计算所有边的倾斜失效概率$p_e'$。\n    f. 为所有边预先计算对数似然比的各分量，即$\\log p_e, \\log(1-p_e), \\log p_e', \\log(1-p_e')$，以在主循环中使用。\n\n3.  **蒙特卡洛模拟**：\n    a. 初始化总估计量值，$\\Sigma = 0$。\n    b. 从$k=1$到$N$循环$N$次：\n        i.  通过抽取独立的伯努利随机变量$E_e^{(k)} \\sim \\mathrm{Bern}(p_e')$，生成边失效向量$\\mathbf{E}^{(k)}$。\n        ii. 构建失效后的图，该图包含所有节点但仅包含幸存的边（即$E_e^{(k)} = 0$的边）。\n        iii. 检查连通性。从一个起始节点（如节点$0$）开始进行广度优先搜索（BFS）或深度优先搜索（DFS）。如果访问的节点数小于$n$，则图是不连通的。\n        iv. 如果图是不连通的：\n            - 使用预先计算的值和采样的失效向量$\\mathbf{E}^{(k)}$，计算对数似然比$\\log L(\\mathbf{E}^{(k)})$。\n            - 计算似然比$L(\\mathbf{E}^{(k)}) = \\exp(\\log L(\\mathbf{E}^{(k)}))$。\n            - 将此值加到总和中：$\\Sigma = \\Sigma + L(\\mathbf{E}^{(k)})$。\n\n4.  **最终估计**：\n    a. 最终估计的不连通概率为$\\hat{\\theta}_N = \\Sigma / N$。\n\n对问题陈述中指定的四个测试用例中的每一个重复此过程。$\\alpha=0$的情况作为基准，对应于标准的蒙特卡洛模拟，因为此时$p_e' = p_e$且似然比始终为$1$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\nimport collections\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: (n, edges, p_e, alpha, N, seed)\n        (\n            5,\n            [(0, 1), (1, 2), (2, 3), (3, 4)],\n            0.02,\n            2.0,\n            30000,\n            12345\n        ),\n        # Case 2:\n        (\n            5,\n            [(i, j) for i in range(5) for j in range(i + 1, 5)],\n            0.005,\n            4.0,\n            40000,\n            23456\n        ),\n        # Case 3:\n        (\n            6,\n            [(0, 1), (2, 3), (4, 5), (0, 2), (2, 4), (1, 3), (3, 5)],\n            np.array([0.01, 0.01, 0.01, 0.02, 0.02, 0.02, 0.02]),\n            3.0,\n            40000,\n            34567\n        ),\n        # Case 4:\n        (\n            6,\n            [(0, 1), (0, 2), (0, 3), (0, 4), (0, 5)],\n            0.01,\n            0.0,\n            30000,\n            45678\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        n, edges, p_e, alpha, N, seed = case\n        estimate = estimate_disconnection_prob(n, edges, p_e, alpha, N, seed)\n        results.append(estimate)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef estimate_disconnection_prob(n, edges, p_e, alpha, N, seed):\n    \"\"\"\n    Estimates graph disconnection probability using importance sampling.\n\n    Args:\n        n (int): Number of nodes.\n        edges (list): List of tuples representing edges.\n        p_e (float or np.ndarray): Baseline edge failure probabilities.\n        alpha (float): Tilt intensity parameter.\n        N (int): Number of simulation samples.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        float: The estimated probability of disconnection.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    num_edges = len(edges)\n\n    # 1. Pre-computation Stage\n    \n    # Ensure p_e is a numpy array\n    if isinstance(p_e, (float, int)):\n        p_e = np.full(num_edges, float(p_e))\n\n    # a. Construct Graph Laplacian (L) for unit-weight graph\n    A = np.zeros((n, n))\n    for u, v in edges:\n        A[u, v] = A[v, u] = 1\n    D = np.diag(np.sum(A, axis=1))\n    L = D - A\n\n    # b. Compute Moore-Penrose Pseudoinverse (L+)\n    L_plus = linalg.pinv(L)\n\n    # c. Calculate Effective Resistances (R_ij)\n    R_e = np.zeros(num_edges)\n    for i, (u, v) in enumerate(edges):\n        R_e[i] = L_plus[u, u] + L_plus[v, v] - 2 * L_plus[u, v]\n    \n    # d. Normalize resistances to get weights (w_e)\n    max_R = np.max(R_e)\n    w_e = R_e / max_R if max_R > 0 else np.zeros_like(R_e)\n    \n    # e. Compute tilted probabilities (p_e')\n    # Use small epsilon to avoid log(0) for p=0 or p=1\n    epsilon = 1e-12\n    p_e_clipped = np.clip(p_e, epsilon, 1 - epsilon)\n    \n    logit_p = np.log(p_e_clipped / (1 - p_e_clipped))\n    logit_p_prime = logit_p + alpha * w_e\n    p_prime_e = 1 / (1 + np.exp(-logit_p_prime))\n    p_prime_e_clipped = np.clip(p_prime_e, epsilon, 1 - epsilon)\n\n    # f. Pre-compute log-probabilities for the likelihood ratio\n    log_p = np.log(p_e_clipped)\n    log_1_minus_p = np.log(1 - p_e_clipped)\n    log_p_prime = np.log(p_prime_e_clipped)\n    log_1_minus_p_prime = np.log(1 - p_prime_e_clipped)\n\n    log_ratio_fail = log_p - log_p_prime\n    log_ratio_survive = log_1_minus_p - log_1_minus_p_prime\n\n    # 2. Monte Carlo Simulation Stage\n    total_estimator_val = 0.0\n\n    for _ in range(N):\n        # a. Generate edge failures from tilted distribution Q\n        failures = rng.random(num_edges)  p_prime_e\n        \n        # b. Check for connectivity using Breadth-First Search (BFS)\n        adj = [[] for _ in range(n)]\n        surviving_edges_indices = np.where(failures == 0)[0]\n        for edge_idx in surviving_edges_indices:\n            u, v = edges[edge_idx]\n            adj[u].append(v)\n            adj[v].append(u)\n\n        queue = collections.deque([0])\n        visited = {0}\n        while queue:\n            u_curr = queue.popleft()\n            for v_neighbor in adj[u_curr]:\n                if v_neighbor not in visited:\n                    visited.add(v_neighbor)\n                    queue.append(v_neighbor)\n\n        # c. If disconnected, compute likelihood and add to total\n        if len(visited)  n:\n            log_L = np.sum(failures * log_ratio_fail) + np.sum((1 - failures) * log_ratio_survive)\n            likelihood_ratio = np.exp(log_L)\n            total_estimator_val += likelihood_ratio\n\n    # 3. Final Estimate\n    return total_estimator_val / N\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3335056"}]}