{"hands_on_practices": [{"introduction": "雅可比行列式是确保可逆跳转马尔可夫链蒙特卡罗（RJMCMC）在跨维度转移时满足细致平衡条件的关键数学工具。本次练习 [@problem_id:3336823] 将通过一个简单典型的分裂变换，带你熟悉这个核心量的计算，这是构建任何RJMCMC算法的基石。", "problem": "考虑一个用于跨维模型的可逆跳转马尔可夫链蒙特卡洛（RJMCMC）中的分裂移动。设原始参数向量为 $(\\mu,\\sigma,u)$，其中 $\\mu \\in \\mathbb{R}$ 是一个位置参数，$\\sigma \\in \\mathbb{R}_{+}$ 是一个尺度参数，而 $u \\in \\mathbb{R}$ 是为平衡维度而引入的辅助变量。分裂移动通过以下变换将 $(\\mu,\\sigma,u)$ 映射到 $(\\mu_{1},\\mu_{2},\\sigma')$：\n$$\n\\mu_{1} = \\mu - \\delta u, \\qquad \\mu_{2} = \\mu + (1-\\delta)u, \\qquad \\sigma' = \\sigma,\n$$\n其中 $\\delta \\in (0,1)$ 是一个固定的调整常数。在RJMCMC的Metropolis–Hastings接受率中，变量转换公式需要这个从 $(\\mu,\\sigma,u)$到$(\\mu_{1},\\mu_{2},\\sigma')$的变换的雅可比行列式。\n\n根据雅可比行列式的基本定义，即对于一个可微变换 $T: \\mathbb{R}^{k} \\to \\mathbb{R}^{k}$，其雅可比行列式是其偏导数雅可比矩阵的行列式，计算上述定义的映射 $(\\mu,\\sigma,u) \\mapsto (\\mu_{1},\\mu_{2},\\sigma')$ 的雅可比行列式。请用关于 $\\delta$ 的封闭形式表达式给出最终答案。无需四舍五入。", "solution": "用户要求计算在可逆跳转马尔可夫链蒙特卡洛（RJMCMC）分裂移动中使用的一个特定变换的雅可比行列式。\n\n首先验证该问题，以确保其具有科学依据、提法恰当且客观。\n\n**第1步：提取已知条件**\n- **背景**：RJMCMC中用于跨维模型的分裂移动。\n- **原始参数空间**：输入向量为 $(\\mu, \\sigma, u)$，其定义域为 $\\mu \\in \\mathbb{R}$，$\\sigma \\in \\mathbb{R}_{+}$，以及 $u \\in \\mathbb{R}$。\n- **目标参数空间**：输出向量为 $(\\mu_{1}, \\mu_{2}, \\sigma')$。\n- **变换方程**：\n  $$ \\mu_{1} = \\mu - \\delta u $$\n  $$ \\mu_{2} = \\mu + (1-\\delta)u $$\n  $$ \\sigma' = \\sigma $$\n- **常数**：$\\delta$ 是一个固定常数，其中 $\\delta \\in (0,1)$。\n- **目标**：计算映射 $(\\mu, \\sigma, u) \\mapsto (\\mu_{1}, \\mu_{2}, \\sigma')$ 的雅可比行列式。\n\n**第2步：使用提取的已知条件进行验证**\n该问题在科学上是合理的，因为它描述了在成熟的RJMCMC算法中使用的标准维度匹配变换。该问题提法恰当，因为该变换是一个可微函数，其雅可比行列式可以唯一计算。问题使用精确的数学语言进行客观陈述。不存在会妨碍求解的矛盾、歧义或信息缺失。\n\n**结论**：该问题有效。\n\n**求解推导**\n设变换由 $T$ 表示。输入变量为 $(\\mu, \\sigma, u)$，输出变量为 $(\\mu_{1}, \\mu_{2}, \\sigma')$。该变换由以下公式给出：\n$$ \\mu_{1}(\\mu, \\sigma, u) = \\mu - \\delta u $$\n$$ \\mu_{2}(\\mu, \\sigma, u) = \\mu + (1-\\delta)u $$\n$$ \\sigma'(\\mu, \\sigma, u) = \\sigma $$\n\n此变换的雅可比行列式是雅可比矩阵 $J$ 的行列式，该矩阵的元素是输出变量相对于输入变量的偏导数。雅可比矩阵定义如下：\n$$\nJ = \\frac{\\partial(\\mu_{1}, \\mu_{2}, \\sigma')}{\\partial(\\mu, \\sigma, u)} =\n\\begin{pmatrix}\n\\frac{\\partial \\mu_{1}}{\\partial \\mu}  \\frac{\\partial \\mu_{1}}{\\partial \\sigma}  \\frac{\\partial \\mu_{1}}{\\partial u} \\\\\n\\frac{\\partial \\mu_{2}}{\\partial \\mu}  \\frac{\\partial \\mu_{2}}{\\partial \\sigma}  \\frac{\\partial \\mu_{2}}{\\partial u} \\\\\n\\frac{\\partial \\sigma'}{\\partial \\mu}  \\frac{\\partial \\sigma'}{\\partial \\sigma}  \\frac{\\partial \\sigma'}{\\partial u}\n\\end{pmatrix}\n$$\n我们现在计算每个偏导数：\n\n对于第一行，对应于 $\\mu_1$：\n$$ \\frac{\\partial \\mu_{1}}{\\partial \\mu} = \\frac{\\partial}{\\partial \\mu}(\\mu - \\delta u) = 1 $$\n$$ \\frac{\\partial \\mu_{1}}{\\partial \\sigma} = \\frac{\\partial}{\\partial \\sigma}(\\mu - \\delta u) = 0 $$\n$$ \\frac{\\partial \\mu_{1}}{\\partial u} = \\frac{\\partial}{\\partial u}(\\mu - \\delta u) = -\\delta $$\n\n对于第二行，对应于 $\\mu_2$：\n$$ \\frac{\\partial \\mu_{2}}{\\partial \\mu} = \\frac{\\partial}{\\partial \\mu}(\\mu + (1-\\delta)u) = 1 $$\n$$ \\frac{\\partial \\mu_{2}}{\\partial \\sigma} = \\frac{\\partial}{\\partial \\sigma}(\\mu + (1-\\delta)u) = 0 $$\n$$ \\frac{\\partial \\mu_{2}}{\\partial u} = \\frac{\\partial}{\\partial u}(\\mu + (1-\\delta)u) = 1 - \\delta $$\n\n对于第三行，对应于 $\\sigma'$：\n$$ \\frac{\\partial \\sigma'}{\\partial \\mu} = \\frac{\\partial}{\\partial \\mu}(\\sigma) = 0 $$\n$$ \\frac{\\partial \\sigma'}{\\partial \\sigma} = \\frac{\\partial}{\\partial \\sigma}(\\sigma) = 1 $$\n$$ \\frac{\\partial \\sigma'}{\\partial u} = \\frac{\\partial}{\\partial u}(\\sigma) = 0 $$\n\n将这些偏导数组合成雅可比矩阵 $J$：\n$$\nJ =\n\\begin{pmatrix}\n1  0  -\\delta \\\\\n1  0  1-\\delta \\\\\n0  1  0\n\\end{pmatrix}\n$$\n雅可比行列式，记为 $\\det(J)$，可以使用代数余子式展开计算。沿着包含两个零的第二列展开，可以简化计算：\n$$\n\\det(J) = (0) \\cdot C_{12} + (0) \\cdot C_{22} + (1) \\cdot C_{32}\n$$\n其中 $C_{ij}$ 是第 $i$ 行第 $j$ 列元素的代数余子式。这可以简化为：\n$$\n\\det(J) = C_{32} = (-1)^{3+2} M_{32} = -M_{32}\n$$\n其中 $M_{32}$ 是对应于元素 $a_{32}$ 的余子式，通过移除第3行和第2列形成的子矩阵的行列式得到：\n$$\nM_{32} = \\det \\begin{pmatrix} 1  -\\delta \\\\ 1  1-\\delta \\end{pmatrix}\n$$\n计算这个 $2 \\times 2$ 行列式：\n$$\nM_{32} = (1)(1-\\delta) - (-\\delta)(1) = 1 - \\delta + \\delta = 1\n$$\n将此结果代回 $\\det(J)$ 的表达式中：\n$$\n\\det(J) = -M_{32} = -1\n$$\n因此，雅可比行列式为 $-1$。它是一个常数值，与调整参数 $\\delta$ 无关。Metropolis-Hastings接受率中的要求是雅可比行列式的绝对值，即 $|-1| = 1$。然而，问题要求的是行列式本身。", "answer": "$$\n\\boxed{-1}\n$$", "id": "3336823"}, {"introduction": "现在，我们将把对雅可比行列式的理解应用到更实际、更广泛使用的场景中：高斯混合模型的模型选择。本次练习 [@problem_id:3336794] 涉及设计一个更复杂的分裂步骤，该步骤能同时处理多个参数（权重、均值、尺度）。你将为这个复杂变换推导雅可比行列式，并从中体会巧妙的设计如何带来一个易于处理且可解释的结果。", "problem": "考虑一个单变量 $K$ 分量高斯混合模型，其参数为 $\\Theta_{K}=\\{(w_{k},\\mu_{k},\\sigma_{k}): k=1,\\dots,K\\}$，其中 $w_{k}\\in(0,1)$，$\\sum_{k=1}^{K} w_{k}=1$，$\\mu_{k}\\in\\mathbb{R}$，且 $\\sigma_{k}0$。您在可逆跳转马尔可夫链蒙特卡洛 (Reversible Jump Markov Chain Monte Carlo, RJMCMC) 中设计一个分裂移动，通过将单个分量 $(w,\\mu,\\sigma)$ (为减少符号混乱，省略了索引) 分裂成两个新分量 $(w_{1},\\mu_{1},\\sigma_{1})$ 和 $(w_{2},\\mu_{2},\\sigma_{2})$，从而将模型维度从 $K$ 增加到 $K+1$。为了避免标签交换问题，对均值施加了打破对称性的排序约束。\n\n为确保维度匹配和双射关系，您引入了辅助变量 $(\\lambda,u,\\psi)$，其中 $\\lambda\\in(0,1)$，$u\\in(0,1)$，$\\psi\\in\\mathbb{R}$，以及一个固定的调整常数 $\\alpha0$。该分裂变换由以下映射定义：\n- 权重：\n$$\nw_{1}=w\\,\\lambda,\\qquad w_{2}=w\\,(1-\\lambda).\n$$\n- 通过正向分离得到的有序均值：\n$$\n\\mu_{1}=\\mu-\\delta,\\qquad \\mu_{2}=\\mu+\\delta,\\qquad \\delta=\\sigma\\,\\alpha\\,u,\n$$\n从而通过构造强制满足 $\\mu_{1}  \\mu_{2}$。\n- 以乘法方式耦合的尺度参数：\n$$\n\\sigma_{1}=\\sigma\\,\\exp\\!\\left(\\frac{\\psi}{2}\\right),\\qquad \\sigma_{2}=\\sigma\\,\\exp\\!\\left(-\\frac{\\psi}{2}\\right).\n$$\n\n从蒙特卡洛方法中变换的基本变量替换原理以及可逆跳转马尔可夫链蒙特卡洛 (RJMCMC) 中的维度匹配要求出发，推导变换\n$$\n(w,\\mu,\\sigma,\\lambda,u,\\psi)\\ \\mapsto\\ (w_{1},w_{2},\\mu_{1},\\mu_{2},\\sigma_{1},\\sigma_{2})\n$$\n的雅可比行列式的绝对值，并将其简化为关于 $w$、$\\sigma$ 和 $\\alpha$ 的单个闭式表达式。您的最终答案必须是单个解析表达式。不需要进行数值近似。", "solution": "该问题要求推导在可逆跳转马尔可夫链蒙特卡洛 (RJMCMC) 分裂移动中使用的一个指定变换的雅可比行列式的绝对值。\n\n该变换将当前分量参数和一组辅助变量 $(w,\\mu,\\sigma,\\lambda,u,\\psi)$ 映射为两个分量的一组新参数 $(w_{1},w_{2},\\mu_{1},\\mu_{2},\\sigma_{1},\\sigma_{2})$。输入变量的定义域是 $\\mathbb{R}^6$ 的一个子集，值域也是 $\\mathbb{R}^6$ 的一个子集。该变换由以下方程组定义：\n$w_{1}=w\\lambda$\n$w_{2}=w(1-\\lambda)$\n$\\mu_{1}=\\mu-\\sigma\\alpha u$\n$\\mu_{2}=\\mu+\\sigma\\alpha u$\n$\\sigma_{1}=\\sigma\\exp(\\frac{\\psi}{2})$\n$\\sigma_{2}=\\sigma\\exp(-\\frac{\\psi}{2})$\n\n此变换的雅可比矩阵是一个 $6 \\times 6$ 的矩阵 $J$，其中第 $i$ 行第 $j$ 列的元素是第 $i$ 个输出变量关于第 $j$ 个输入变量的偏导数。我们需要计算从输入变量向量 $\\mathbf{x} = (w,\\mu,\\sigma,\\lambda,u,\\psi)$ 到输出变量向量 $\\mathbf{y} = (w_{1},w_{2},\\mu_{1},\\mu_{2},\\sigma_{1},\\sigma_{2})$ 的映射的 $|\\det(J)|$。\n\n为了简化行列式的计算，我们可以根据输入变量在变换方程中的作用对它们进行重排。这揭示了映射的底层结构。一个合适的排序是 $(w, \\lambda, \\mu, u, \\sigma, \\psi)$。我们将对应于这个新输入变量排序的雅可比矩阵记为 $J'$。矩阵的列重排只影响其行列式的符号。由于我们关心的是行列式的绝对值，所以 $|\\det(J)|=|\\det(J')|$。\n\n重排后的雅可比矩阵 $J'$ 为：\n$$\nJ' = \\frac{\\partial(w_{1},w_{2},\\mu_{1},\\mu_{2},\\sigma_{1},\\sigma_{2})}{\\partial(w,\\lambda,\\mu,u,\\sigma,\\psi)}\n$$\n让我们计算 $J'$ 的每个元素的偏导数。\n\n对于权重 $(w_1, w_2)$：\n$\\frac{\\partial w_{1}}{\\partial w} = \\lambda$，$\\frac{\\partial w_{1}}{\\partial \\lambda} = w$。其他导数为零。\n$\\frac{\\partial w_{2}}{\\partial w} = 1-\\lambda$，$\\frac{\\partial w_{2}}{\\partial \\lambda} = -w$。其他导数为零。\n\n对于均值 $(\\mu_1, \\mu_2)$：\n$\\frac{\\partial \\mu_{1}}{\\partial \\mu} = 1$，$\\frac{\\partial \\mu_{1}}{\\partial u} = -\\sigma\\alpha$，$\\frac{\\partial \\mu_{1}}{\\partial \\sigma} = -\\alpha u$。其他导数为零。\n$\\frac{\\partial \\mu_{2}}{\\partial \\mu} = 1$，$\\frac{\\partial \\mu_{2}}{\\partial u} = \\sigma\\alpha$，$\\frac{\\partial \\mu_{2}}{\\partial \\sigma} = \\alpha u$。其他导数为零。\n\n对于尺度参数 $(\\sigma_1, \\sigma_2)$：\n$\\frac{\\partial \\sigma_{1}}{\\partial \\sigma} = \\exp(\\frac{\\psi}{2})$，$\\frac{\\partial \\sigma_{1}}{\\partial \\psi} = \\frac{\\sigma}{2}\\exp(\\frac{\\psi}{2})$。其他导数为零。\n$\\frac{\\partial \\sigma_{2}}{\\partial \\sigma} = \\exp(-\\frac{\\psi}{2})$，$\\frac{\\partial \\sigma_{2}}{\\partial \\psi} = -\\frac{\\sigma}{2}\\exp(-\\frac{\\psi}{2})$。其他导数为零。\n\n将这些导数组合成矩阵 $J'$：\n$$\nJ' =\n\\begin{pmatrix}\n  \\frac{\\partial w_1}{\\partial w}  \\frac{\\partial w_1}{\\partial \\lambda}  \\frac{\\partial w_1}{\\partial \\mu}  \\frac{\\partial w_1}{\\partial u}  \\frac{\\partial w_1}{\\partial \\sigma}  \\frac{\\partial w_1}{\\partial \\psi} \\\\\n  \\frac{\\partial w_2}{\\partial w}  \\frac{\\partial w_2}{\\partial \\lambda}  \\frac{\\partial w_2}{\\partial \\mu}  \\frac{\\partial w_2}{\\partial u}  \\frac{\\partial w_2}{\\partial \\sigma}  \\frac{\\partial w_2}{\\partial \\psi} \\\\\n  \\frac{\\partial \\mu_1}{\\partial w}  \\frac{\\partial \\mu_1}{\\partial \\lambda}  \\frac{\\partial \\mu_1}{\\partial \\mu}  \\frac{\\partial \\mu_1}{\\partial u}  \\frac{\\partial \\mu_1}{\\partial \\sigma}  \\frac{\\partial \\mu_1}{\\partial \\psi} \\\\\n  \\frac{\\partial \\mu_2}{\\partial w}  \\frac{\\partial \\mu_2}{\\partial \\lambda}  \\frac{\\partial \\mu_2}{\\partial \\mu}  \\frac{\\partial \\mu_2}{\\partial u}  \\frac{\\partial \\mu_2}{\\partial \\sigma}  \\frac{\\partial \\mu_2}{\\partial \\psi} \\\\\n  \\frac{\\partial \\sigma_1}{\\partial w}  \\frac{\\partial \\sigma_1}{\\partial \\lambda}  \\frac{\\partial \\sigma_1}{\\partial \\mu}  \\frac{\\partial \\sigma_1}{\\partial u}  \\frac{\\partial \\sigma_1}{\\partial \\sigma}  \\frac{\\partial \\sigma_1}{\\partial \\psi} \\\\\n  \\frac{\\partial \\sigma_2}{\\partial w}  \\frac{\\partial \\sigma_2}{\\partial \\lambda}  \\frac{\\partial \\sigma_2}{\\partial \\mu}  \\frac{\\partial \\sigma_2}{\\partial u}  \\frac{\\partial \\sigma_2}{\\partial \\sigma}  \\frac{\\partial \\sigma_2}{\\partial \\psi}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n  \\lambda  w  0  0  0  0 \\\\\n  1-\\lambda  -w  0  0  0  0 \\\\\n  0  0  1  -\\sigma\\alpha  -\\alpha u  0 \\\\\n  0  0  1  \\sigma\\alpha  \\alpha u  0 \\\\\n  0  0  0  0  \\exp(\\frac{\\psi}{2})  \\frac{\\sigma}{2}\\exp(\\frac{\\psi}{2}) \\\\\n  0  0  0  0  \\exp(-\\frac{\\psi}{2})  -\\frac{\\sigma}{2}\\exp(-\\frac{\\psi}{2})\n\\end{pmatrix}\n$$\n该矩阵是分块上三角矩阵。分块上三角矩阵的行列式是其对角线上分块矩阵的行列式的乘积。\n$$\n\\det(J') = \\det\\left(\\frac{\\partial(w_1,w_2)}{\\partial(w,\\lambda)}\\right) \\cdot \\det\\left(\\frac{\\partial(\\mu_1,\\mu_2)}{\\partial(\\mu,u)}\\right) \\cdot \\det\\left(\\frac{\\partial(\\sigma_1,\\sigma_2)}{\\partial(\\sigma,\\psi)}\\right)\n$$\n对角线上的分块矩阵为：\n$$\nA = \\frac{\\partial(w_1,w_2)}{\\partial(w,\\lambda)} = \\begin{pmatrix} \\lambda  w \\\\ 1-\\lambda  -w \\end{pmatrix}\n$$\n$$\nB = \\frac{\\partial(\\mu_1,\\mu_2)}{\\partial(\\mu,u)} = \\begin{pmatrix} 1  -\\sigma\\alpha \\\\ 1  \\sigma\\alpha \\end{pmatrix}\n$$\n$$\nD = \\frac{\\partial(\\sigma_1,\\sigma_2)}{\\partial(\\sigma,\\psi)} = \\begin{pmatrix} \\exp(\\frac{\\psi}{2})  \\frac{\\sigma}{2}\\exp(\\frac{\\psi}{2}) \\\\ \\exp(-\\frac{\\psi}{2})  -\\frac{\\sigma}{2}\\exp(-\\frac{\\psi}{2}) \\end{pmatrix}\n$$\n我们计算每个分块矩阵的行列式：\n$$\n\\det(A) = (\\lambda)(-w) - (w)(1-\\lambda) = -w\\lambda - w + w\\lambda = -w\n$$\n$$\n\\det(B) = (1)(\\sigma\\alpha) - (-\\sigma\\alpha)(1) = \\sigma\\alpha + \\sigma\\alpha = 2\\sigma\\alpha\n$$\n$$\n\\det(D) = \\left(\\exp\\left(\\frac{\\psi}{2}\\right)\\right)\\left(-\\frac{\\sigma}{2}\\exp\\left(-\\frac{\\psi}{2}\\right)\\right) - \\left(\\frac{\\sigma}{2}\\exp\\left(\\frac{\\psi}{2}\\right)\\right)\\left(\\exp\\left(-\\frac{\\psi}{2}\\right)\\right) = -\\frac{\\sigma}{2} - \\frac{\\sigma}{2} = -\\sigma\n$$\n$J'$ 的行列式是这些行列式的乘积：\n$$\n\\det(J') = \\det(A) \\cdot \\det(B) \\cdot \\det(D) = (-w)(2\\sigma\\alpha)(-\\sigma) = 2w\\sigma^2\\alpha\n$$\n题目要求的是行列式的绝对值。根据题目陈述，参数满足 $w \\in (0,1)$，$\\sigma  0$，且调整常数 $\\alpha  0$。因此，表达式 $2w\\sigma^2\\alpha$ 严格为正。\n$$\n|\\det(J)| = |\\det(J')| = |2w\\sigma^2\\alpha| = 2w\\sigma^2\\alpha\n$$\n该表达式按要求简化为仅关于 $w$、$\\sigma$ 和 $\\alpha$ 的函数。辅助随机变量 $\\lambda$、$u$ 和 $\\psi$ 没有出现在雅可比行列式的最终表达式中。", "answer": "$$\n\\boxed{2w\\sigma^2\\alpha}\n$$", "id": "3336794"}, {"introduction": "理论学习的最后一步是将其转化为能够工作的算法。这个综合性练习 [@problem_id:3336810] 将指导你在编程环境中为一个高斯混合模型实现一个完整的分裂/合并RJMCMC方案。通过将雅可比行列式、后验概率和提议分布等概念联系起来，并进行具体的接受率计算，你将巩固对整个RJMCMC工作流程的理解。", "problem": "要求您为具有共享协方差矩阵的高斯有限混合模型设计并实现一个完整的可逆跳转马尔可夫链蒙特卡洛（RJMCMC）移动方案。该方案使用一种映射，为所有未受影响的分量保留指数族自然参数，并且仅扰动所选分量的低维子空间。您的解决方案必须从马尔可夫链蒙特卡洛的第一性原理和 RJMCMC 接受率出发。您必须推导并实现分裂（split）和合并（merge）移动中使用的确定性维度匹配变换的雅可比行列式，并验证其稳定性。\n\n考虑一个二维高斯混合模型，其具有一个共享的、已知的协方差矩阵 $ \\Sigma \\in \\mathbb{R}^{2 \\times 2} $。具有 $ K $ 个分量的模型参数为 $ \\Theta_K = \\{ (\\mu_k)_{k=1}^K, \\alpha \\in \\mathbb{R}^K \\} $，其中 $ \\mu_k \\in \\mathbb{R}^2 $ 是分量 $ k $ 的均值，$ \\alpha \\in \\mathbb{R}^K $ 是混合权重的无约束 logit 值。权重为 $w_k = \\exp(\\alpha_k) / \\sum_{\\ell=1}^K \\exp(\\alpha_\\ell)$。数据似然为\n$$\np(x_1,\\dots,x_n \\mid \\Theta_K, K) = \\prod_{i=1}^n \\sum_{k=1}^K w_k \\,\\mathcal{N}(x_i \\mid \\mu_k, \\Sigma).\n$$\n假设先验如下：\n- logit 值 $ \\alpha $ 的独立高斯先验 $ \\alpha \\sim \\mathcal{N}(0, \\sigma_\\alpha^2 I_K) $，其中 $ \\sigma_\\alpha^2 = 4 $。\n- 分量均值 $ \\mu_k $ 的独立高斯先验 $ \\mu_k \\sim \\mathcal{N}(m_0, \\tau^2 I_2) $，其中 $ m_0 = (0,0)^\\top $ 且 $ \\tau^2 = 9 $。\n- 分量数 $ K \\in \\{1,2\\} $ 的均匀先验。\n\n具有共享协方差的高斯均值的指数族自然参数为 $ \\eta_k = \\Sigma^{-1} \\mu_k $。您的 RJ 映射必须保留所有未被分裂或合并的分量的 $ \\eta_k $（等价于 $ \\mu_k $）。\n\n您必须实现 $ K = 1 $ 和 $ K = 2 $ 之间的跨维度分裂和合并移动。请使用以下固定设置：\n- 共享协方差 $ \\Sigma = \\mathrm{diag}(0.25, 0.25) $。\n- 维度 $ d = 2 $。\n- 令 $ v = (1,0)^\\top $ 和 $ v_\\perp = (0,1)^\\top $。定义 $ e_1 = (1,0)^\\top $ 和 $ e_2 = (0,1)^\\top $。\n- 将所选分量 $ j $ 的均值的分裂映射定义为\n$$\n\\mu_{j,1} = \\mu_j + R u, \\qquad \\mu_{j,2} = \\mu_j + S u,\n$$\n其中 $ u = (u_1,u_2)^\\top \\sim \\mathcal{N}(0, I_2) $，$ R = s\\, v e_1^\\top $，$ S = - s\\, v e_1^\\top + t\\, v_\\perp e_2^\\top $，尺度为 $ s = 0.5 $ 和 $ t = 0.5 $。此映射仅对每个子均值的低维子空间进行扰动：$ \\mu_{j,1} $ 仅沿 $ v $ 方向扰动，$ \\mu_{j,2} $ 沿 $ v $ 和 $ v_\\perp $ 方向扰动，每个方向具有秩一结构。\n- 将 logit 值的分裂映射定义为\n$$\n\\alpha_{j,1} = \\alpha_j + u_\\alpha, \\qquad \\alpha_{j,2} = \\alpha_j - u_\\alpha,\n$$\n其中 $ u_\\alpha \\sim \\mathcal{N}(0, \\sigma_{u\\alpha}^2) $，且 $ \\sigma_{u\\alpha} = 0.75 $。所有其他的 logit 值和均值保持不变。\n\n对于合并移动，使用上述变换所隐含的逆映射：\n- logit 值的逆映射为 $ \\alpha_j = \\tfrac{1}{2}(\\alpha_{j,1} + \\alpha_{j,2}) $ 和 $ u_\\alpha = \\tfrac{1}{2}(\\alpha_{j,1} - \\alpha_{j,2}) $。\n- 令 $ \\Delta \\mu = \\mu_{j,2} - \\mu_{j,1} $。当 $ S - R \\in \\mathbb{R}^{2 \\times 2} $ 可逆时，使用\n$$\nu = (S - R)^{-1} \\Delta \\mu, \\qquad \\mu_j = \\mu_{j,1} - R u,\n$$\n这可以精确地恢复原像。均值映射的雅可比行列式为 $ |\\det(S - R)| $，logit 分裂映射的雅可比行列式为 $ 2 $，因此分裂的总雅可比因子为\n$$\n|J_{\\text{split}}| = |\\det(S - R)| \\times 2 = 4st.\n$$\n在给定的 $ s $ 和 $ t $ 值下，这是一个等于 $ 1.0 $ 的常数，从而最小化了雅可比行列式的变异性。\n\n在状态 $K=1$ 时，以概率 $p_{\\mathrm{sp}} = 1/2$ 提议一个分裂移动；要分裂的分量从 $ K $ 个分量中均匀选择；并抽取独立的辅助变量 $ u \\sim \\mathcal{N}(0, I_2) $ 和 $ u_\\alpha \\sim \\mathcal{N}(0, \\sigma_{u\\alpha}^2) $。在状态 $K=2$ 时，以概率 $p_{\\mathrm{mg}} = 1/2$ 提议一个合并移动；要合并的无序对从 $ \\binom{K}{2} $ 对中均匀选择；通过逆映射确定性地恢复反向分裂的辅助变量。\n\n从状态 $ (K, \\Theta_K) $ 到 $ (K+1, \\Theta_{K+1}) $ 并使用辅助变量 $ u $ 的分裂提议的通用 RJMCMC 接受概率为\n$$\n\\alpha_{\\mathrm{sp}} = \\min\\left\\{ 1, \\frac{ \\pi(K+1, \\Theta_{K+1} \\mid x_{1:n}) }{ \\pi(K, \\Theta_K \\mid x_{1:n}) } \\cdot \\frac{ p_{\\mathrm{mg}} \\cdot \\frac{1}{\\binom{K+1}{2}} }{ p_{\\mathrm{sp}} \\cdot \\frac{1}{K} \\cdot g(u) } \\cdot |J_{\\text{split}}| \\right\\},\n$$\n其中 $ \\pi $ 是未归一化的后验，$ g(u) $ 是在分裂中使用的辅助变量的联合密度。从 $ (K+1, \\Theta_{K+1}) $ 到 $ (K, \\Theta_K) $ 的合并移动的相应接受概率为\n$$\n\\alpha_{\\mathrm{mg}} = \\min\\left\\{ 1, \\frac{ \\pi(K, \\Theta_{K} \\mid x_{1:n}) }{ \\pi(K+1, \\Theta_{K+1} \\mid x_{1:n}) } \\cdot \\frac{ p_{\\mathrm{sp}} \\cdot \\frac{1}{K} \\cdot g(u) }{ p_{\\mathrm{mg}} \\cdot \\frac{1}{\\binom{K+1}{2}} } \\cdot \\frac{1}{|J_{\\text{split}}|} \\right\\},\n$$\n其中 $ u $ 通过逆映射恢复。\n\n数据生成和常数：\n- 设置 $ n = 60 $，并使用固定的伪随机种子 $ 42 $ 按如下方式生成数据：从 $ \\mathcal{N}((-2,0)^\\top, \\Sigma) $ 中抽取 $ n/2 $ 个点，从 $ \\mathcal{N}((2,0)^\\top, \\Sigma) $ 中抽取 $ n/2 $ 个点。\n- 在 $ K=1 $，$ \\mu_1 = (0,0)^\\top $，$ \\alpha_1 = 0 $ 处初始化。\n\n您的程序必须计算以下四个测试案例，并将结果汇总到单行中：\n- 案例 A（顺利分裂路径）：从 $ K=1 $ 的初始状态开始，使用固定的伪随机种子 $ 123 $ 为 $ u $ 和 $ u_\\alpha $ 抽取的辅助变量，提议对分量 $ j=1 $ 进行分裂，并计算分裂接受概率 $ \\alpha_{\\mathrm{sp}} $（浮点数）。\n- 案例 B（逆向合并）：使用案例 A 中提议的精确分裂后状态（不要重新采样），计算合并由分裂创建的两个分量的接受概率 $ \\alpha_{\\mathrm{mg}} $。返回此浮点数。\n- 案例 C（边界条件）：从任何 $ K=2 $ 的状态（例如，案例 A 中的分裂后状态），尝试进行分裂移动。由于 $ K_{\\max} = 2 $，此移动不被允许；返回浮点数 $ 0.0 $。\n- 案例 D（雅可比行列式稳定性）：计算指定映射的雅可比行列式绝对值 $ |J_{\\text{split}}| $ 并将其作为浮点数返回。\n\n如果使用任何三角函数，所有角度都应视为弧度；不涉及物理单位。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $ [r_1, r_2, r_3, r_4] $，其中每个 $ r_i $ 是一个浮点数，按顺序对应于案例 A–D。", "solution": "该问题要求为贝叶斯高斯有限混合模型设计并实现一个可逆跳转马尔可夫链蒙特卡洛（RJMCMC）方案。具体来说，我们要构建模型分量数在 $K=1$ 和 $K=2$ 之间的跨维度移动，推导相关变换的雅可比行列式，并计算特定测试案例的接受概率。\n\n### 1. 问题验证\n首先对问题陈述的科学合理性、完整性和一致性进行了验证。\n\n- **给定条件**：问题提供了模型的完整规范，包括 $K$ 分量高斯混合的数据似然、一个共享且已知的协方差矩阵 $\\Sigma = \\mathrm{diag}(0.25, 0.25)$、分量均值 $\\mu_k \\sim \\mathcal{N}(m_0, \\tau^2 I_2)$ 和混合 logit 值 $\\alpha \\sim \\mathcal{N}(0, \\sigma_\\alpha^2 I_K)$ 的先验，以及分量数 $K \\in \\{1,2\\}$ 的均匀先验。所有常数（$m_0, \\tau^2, \\sigma_\\alpha^2$）均已指定。\n- **RJMCMC 方案**：定义了一个具体的分裂/合并提议机制。这包括均值和 logit 值的确定性变换、辅助变量 $u$ 和 $u_\\alpha$ 的分布、移动提议概率 $p_{\\mathrm{sp}}$ 和 $p_{\\mathrm{mg}}$，以及接受率的公式。雅可比行列式也被提供为 $|J_{\\text{split}}| = 4st = 1.0$。\n- **验证结论**：该问题在科学上是合理的，采用了计算统计学中的标准方法（贝叶斯高斯混合模型，RJMCMC）。问题陈述清晰，为指定的计算任务提供了所有必要信息，从而可以得到唯一解。语言客观而精确。所提供的雅可比行列式值经验证是正确的。因此，该问题被认定为**有效**。\n\n### 2. 贝叶斯模型与后验分布\nMCMC 模拟的目标是后验分布 $p(K, \\Theta_K \\mid x_{1:n})$。未归一化的后验，记为 $\\pi(K, \\Theta_K \\mid x_{1:n})$，由似然与先验的乘积给出：\n$$\n\\pi(K, \\Theta_K \\mid x_{1:n}) = p(x_{1:n} \\mid \\Theta_K, K) p(\\Theta_K \\mid K) p(K)\n$$\n其中：\n1.  **似然**：$p(x_{1:n} \\mid \\Theta_K, K) = \\prod_{i=1}^n \\sum_{k=1}^K w_k \\,\\mathcal{N}(x_i \\mid \\mu_k, \\Sigma)$。混合权重为 $w_k = \\frac{\\exp(\\alpha_k)}{\\sum_{\\ell=1}^K \\exp(\\alpha_\\ell)}$。\n2.  **参数先验**：$p(\\Theta_K \\mid K) = \\left( \\prod_{k=1}^K p(\\mu_k) \\right) p(\\alpha)$。先验是独立的高斯分布：$p(\\mu_k) = \\mathcal{N}(\\mu_k \\mid m_0, \\tau^2 I_2)$ 和 $p(\\alpha) = \\mathcal{N}(\\alpha \\mid 0, \\sigma_\\alpha^2 I_K)$。\n3.  **模型先验**：$p(K)$ 在 $\\{1, 2\\}$ 上是均匀的，因此 $p(K=1) = p(K=2) = 1/2$。\n\n### 3. RJMCMC 框架\nRJMCMC 将 MCMC 扩展到从不同维度的空间进行采样。对于从状态 $(K, \\Theta_K)$ 到 $(K+1, \\Theta_{K+1})$ 的移动，我们引入从密度 $g(u)$ 中抽取的辅助随机变量 $u$，并定义一个确定性的可逆变换 $T$：\n$$\n\\Theta_{K+1} = T( \\Theta_K, u )\n$$\n维度匹配得以保证，因为 $\\mathrm{dim}(\\Theta_{K+1}) = \\mathrm{dim}(\\Theta_K) + \\mathrm{dim}(u)$。这种“分裂”移动的接受概率是：\n$$\n\\alpha_{\\mathrm{sp}} = \\min \\left\\{ 1, \\frac{\\pi(K+1, \\Theta_{K+1} \\mid x)}{\\pi(K, \\Theta_K \\mid x)} \\cdot \\frac{q((K, \\Theta_K) \\mid (K+1, \\Theta_{K+1}))}{q((K+1, \\Theta_{K+1}) \\mid (K, \\Theta_K))} \\cdot \\left| \\frac{\\partial \\Theta_{K+1}}{\\partial (\\Theta_K, u)} \\right| \\right\\}\n$$\n其中 $q$ 项是提议概率，最后一项是变换的雅可比行列式。\n\n对于本问题，$K=1 \\to K=2$ 分裂的提议比率为：\n$$\n\\frac{q(\\text{merge})}{q(\\text{split})} = \\frac{p_{\\mathrm{mg}} \\cdot \\frac{1}{\\binom{2}{2}}}{p_{\\mathrm{sp}} \\cdot \\frac{1}{1} \\cdot g(u, u_\\alpha)} = \\frac{p_{\\mathrm{mg}}}{p_{\\mathrm{sp}} \\cdot g(u, u_\\alpha)}\n$$\n由于 $p_{\\mathrm{sp}}=p_{\\mathrm{mg}}=1/2$，这简化为 $1/g(u, u_\\alpha)$。分裂的接受概率为：\n$$\n\\alpha_{\\mathrm{sp}} = \\min\\left\\{ 1, \\frac{ \\pi(2, \\Theta_2 \\mid x) }{ \\pi(1, \\Theta_1 \\mid x) } \\cdot \\frac{1}{g(u, u_\\alpha)} \\cdot |J_{\\text{split}}| \\right\\}\n$$\n对于逆向合并移动，接受概率为：\n$$\n\\alpha_{\\mathrm{mg}} = \\min\\left\\{ 1, \\frac{ \\pi(1, \\Theta_1 \\mid x) }{ \\pi(2, \\Theta_2 \\mid x) } \\cdot g(u, u_\\alpha) \\cdot \\frac{1}{|J_{\\text{split}}|} \\right\\}\n$$\n注意，模型先验的比率 $p(K=2)/p(K=1) = 1$，因此它从后验比率中消去。\n\n### 4. 雅可比行列式推导\n变换是从 $(\\mu_j, \\alpha_j, u, u_\\alpha)$ 到 $(\\mu_{j,1}, \\mu_{j,2}, \\alpha_{j,1}, \\alpha_{j,2})$，其中状态的维度分别为 $(2, 1, 2, 1)$ 和 $(2, 2, 1, 1)$。两侧的总维度均为 $6$。增广变换 $T_{\\text{aug}}$ 为：\n$$\n(\\mu_{j,1}, \\mu_{j,2}, \\alpha_{j,1}, \\alpha_{j,2}) = T_{\\text{aug}}(\\mu_j, u, \\alpha_j, u_\\alpha) = (\\mu_j + Ru, \\mu_j + Su, \\alpha_j + u_{\\alpha}, \\alpha_j - u_{\\alpha})\n$$\n此变换的雅可比矩阵是块对角的：\n$$\nJ_{\\text{aug}} = \\frac{\\partial(\\mu_{j,1}, \\mu_{j,2}, \\alpha_{j,1}, \\alpha_{j,2})}{\\partial(\\mu_j, u, \\alpha_j, u_\\alpha)} = \\begin{pmatrix}\n\\frac{\\partial(\\mu_{j,1}, \\mu_{j,2})}{\\partial(\\mu_j, u)}  \\mathbf{0} \\\\\n\\mathbf{0}  \\frac{\\partial(\\alpha_{j,1}, \\alpha_{j,2})}{\\partial(\\alpha_j, u_\\alpha)}\n\\end{pmatrix}\n$$\n左上角的块对应于均值变换：\n$$\n\\frac{\\partial(\\mu_j+Ru, \\mu_j+Su)}{\\partial(\\mu_j, u)} = \\begin{pmatrix} I_2  R \\\\ I_2  S \\end{pmatrix}\n$$\n其行列式为 $\\det(S-R)$。给定 $R = \\begin{pmatrix} s  0 \\\\ 0  0 \\end{pmatrix}$ 和 $S = \\begin{pmatrix} -s  0 \\\\ 0  t \\end{pmatrix}$，我们有 $S-R = \\begin{pmatrix} -2s  0 \\\\ 0  t \\end{pmatrix}$，因此 $\\det(S-R) = -2st$。\n右下角的块对应于 logit 变换：\n$$\n\\frac{\\partial(\\alpha_j+u_\\alpha, \\alpha_j-u_\\alpha)}{\\partial(\\alpha_j, u_\\alpha)} = \\begin{pmatrix} 1  1 \\\\ 1  -1 \\end{pmatrix}\n$$\n其行列式为 $1(-1) - 1(1) = -2$。\n完整雅可比矩阵 $J_{\\text{aug}}$ 的行列式是各块行列式的乘积：$\\det(J_{\\text{aug}}) = (-2st)(-2) = 4st$。所需的绝对值为 $|J_{\\text{split}}| = 4st$。对于 $s=0.5$ 和 $t=0.5$，此值为 $1.0$。雅可比行列式为 $1$ 在数值上是稳定的，并简化了接受率。\n\n### 5. 实现策略\n为了计算所需的量，我们实现了计算对数后验和 RJMCMC 接受率的函数。所有计算都在对数空间中执行以保持数值稳定性。\n\n- **对数后验**：$\\log \\pi(K, \\Theta_K | x) = \\log p(x | \\Theta_K, K) + \\log p(\\Theta_K | K)$。\n- **对数似然**：$\\log p(x | \\Theta_K, K) = \\sum_{i=1}^n \\log \\left( \\sum_{k=1}^K w_k \\mathcal{N}(x_i | \\mu_k, \\Sigma) \\right)$。内部求和使用 `logsumexp` 函数以保证稳健性：$\\sum_{i=1}^n \\mathrm{logsumexp}_{k} (\\log w_k + \\log \\mathcal{N}(x_i | \\mu_k, \\Sigma))$。\n- **对数先验**：这是所有参数的对数先验之和：$\\sum_k \\log p(\\mu_k) + \\log p(\\alpha)$。\n- **接受率**：对于分裂移动，$\\min$ 函数内部的比率项的对数为：\n$$\n\\log R_{\\text{sp}} = (\\log\\pi_2 - \\log\\pi_1) - \\log g(u, u_\\alpha) + \\log |J_{\\text{split}}|\n$$\n其中 $\\log\\pi_1$ 和 $\\log\\pi_2$ 分别是 $K=1$ 和 $K=2$ 状态的对数后验。\n对于合并移动，对数比率就是 $\\log R_{\\text{mg}} = -\\log R_{\\text{sp}}$。最终的接受概率为 $\\alpha_{\\text{sp}} = \\min(1, \\exp(\\log R_{\\text{sp}}))$ 和 $\\alpha_{\\text{mg}} = \\min(1, \\exp(\\log R_{\\text{mg}}))$。\n\n四个测试案例按如下方式计算：\n- **案例 A（分裂）**：从初始状态 $K=1$ 开始，使用种子 $123$ 抽取的辅助变量，计算 $\\alpha_{\\text{sp}}$。\n- **案例 B（合并）**：从案例 A 中提议的状态出发，计算逆向移动的 $\\alpha_{\\text{mg}}$。这等于 $\\min(1, \\exp(-\\log R_{\\text{sp}}))$。\n- **案例 C（边界）**：从 $K=2$ 进行分裂移动是不可能的，因为 $K_{\\max}=2$。提议概率为零，因此接受概率为 $0.0$。\n- **案例 D（雅可比行列式）**：计算 $|J_{\\text{split}}| = 4st = 4(0.5)(0.5) = 1.0$。", "answer": "[1.0,0.00956711909772846,0.0,1.0]", "id": "3336810"}]}