{"hands_on_practices": [{"introduction": "为了从根本上理解稀疏化（thinning）的利弊，我们首先需要一种量化 MCMC 链中样本自相关性的方法。此练习将指导您计算积分自相关时间（Integrated Autocorrelation Time, IAT），这是一个衡量 MCMC 效率的关键指标。通过在一个标准的自回归模型下，为原始链和稀疏化后的链推导 IAT 的精确表达式，您将亲手揭示稀疏化在数学上如何直接改变链的相关结构。 [@problem_id:3357397]", "problem": "考虑一个平稳的马尔可夫链蒙特卡洛 (MCMC) 过程 $\\{X_{n}\\}_{n \\geq 0}$，其目标不变分布为 $\\pi$，以及一个平方可积函数 $f$，满足 $\\mathbb{E}_{\\pi}[f(X_{n})]=\\mu$ 和 $\\operatorname{Var}_{\\pi}(f(X_{n}))=\\sigma^{2} \\in (0,\\infty)$。定义中心化过程 $Y_{n}=f(X_{n})-\\mu$，并假设 $\\{Y_{n}\\}$ 是严格平稳的，其自相关函数为 $\\rho_{t}=\\operatorname{Corr}(Y_{0},Y_{t})$。马尔可夫链中心极限定理 (MC-CLT) 指出，遍历均值 $N^{-1}\\sum_{n=1}^{N} f(X_{n})$ 的方差会因积分自相关时间 (IAT) $\\tau$ 而膨胀，在 $\\{\\rho_{t}\\}$ 绝对可和的条件下，$\\tau$ 由收敛级数 $\\tau=1+2\\sum_{t=1}^{\\infty}\\rho_{t}$ 定义。\n\n假设 $f(X_{n})$ 服从一阶自回归相关模型，即 $\\rho_{t}=\\phi^{t}$，其中 $0  \\phi  1$。推导未稀疏化链的积分自相关时间 $\\tau$ 的闭式表达式。接下来，考虑 k-稀疏化，即保留每第 k 个迭代值并丢弃其他值，从而产生稀疏化序列 $\\{Y_{0},Y_{k},Y_{2k},\\dots\\}$。在相同的自回归相关模型下，以闭式形式推导 k-稀疏化链的积分自相关时间 $\\tau_{k}$。\n\n请用 $\\tau$ 和 $\\tau_{k}$ 的解析表达式给出最终答案，无需四舍五入。", "solution": "首先验证问题的科学性、适定性和客观性。\n\n### 步骤 1：提取已知条件\n-   一个平稳的马尔可夫链蒙特卡洛 (MCMC) 过程 $\\{X_{n}\\}_{n \\geq 0}$，其不变分布为 $\\pi$。\n-   一个平方可积函数 $f$，满足 $\\mathbb{E}_{\\pi}[f(X_{n})]=\\mu$ 和 $\\operatorname{Var}_{\\pi}(f(X_{n}))=\\sigma^{2} \\in (0,\\infty)$。\n-   一个中心化的严格平稳过程 $Y_{n}=f(X_{n})-\\mu$。\n-   $\\{Y_{n}\\}$ 的自相关函数 (ACF) 为 $\\rho_{t}=\\operatorname{Corr}(Y_{0},Y_{t})$。\n-   未稀疏化链的积分自相关时间 (IAT) 为 $\\tau=1+2\\sum_{t=1}^{\\infty}\\rho_{t}$。假设该级数是绝对收敛的。\n-   ACF 的具体模型为 $\\rho_{t}=\\phi^{t}$，其中常数 $\\phi$ 满足 $0  \\phi  1$。\n-   通过取每第 k 个迭代值形成一个 k-稀疏化链，得到序列 $\\{Y_{0},Y_{k},Y_{2k},\\dots\\}$。\n-   任务是推导未稀疏化链的 IAT $\\tau$ 和 k-稀疏化链的 IAT $\\tau_k$ 的闭式表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学性：** 该问题植根于马尔可夫链蒙特卡洛方法和时间序列分析的既定理论。所提供的积分自相关时间、平稳过程和自相关的定义在统计学中是标准的。一阶自回归相关模型（$\\rho_{t}=\\phi^{t}$）是时间序列数据的一个基础且广泛使用的模型。条件 $0  \\phi  1$ 保证了过程的平稳性和定义 IAT 的级数的收敛性，这在数学上是必不可少的。该问题是该领域的一个标准理论练习。\n-   **适定性：** 该问题清晰地定义了所有术语，并为自相关函数提供了一个具体模型。它要求根据给定信息推导两个特定量 $\\tau$ 和 $\\tau_k$。该问题是自洽的，并且有唯一的可推导解。\n-   **客观性：** 该问题使用精确的数学和统计语言陈述，没有主观性或歧义。\n\n### 步骤 3：结论与行动\n问题有效。这是 MCMC 分析领域一个定义明确的理论问题。将提供完整解答。\n\n### 未稀疏化链的积分自相关时间 (IAT) 推导\n\n积分自相关时间 $\\tau$ 定义为：\n$$\n\\tau = 1 + 2\\sum_{t=1}^{\\infty}\\rho_{t}\n$$\n问题指明自相关函数遵循一阶自回归过程的模型，$\\rho_{t} = \\phi^{t}$ (对于 $t \\geq 1$)。将此代入 $\\tau$ 的定义，我们得到：\n$$\n\\tau = 1 + 2\\sum_{t=1}^{\\infty}\\phi^{t}\n$$\n求和项是一个几何级数 $\\sum_{t=1}^{\\infty}\\phi^{t} = \\phi + \\phi^{2} + \\phi^{3} + \\dots$。此级数的和是已知的。对于任何 $|r|1$，无穷几何级数 $\\sum_{n=1}^{\\infty} ar^{n-1} = a + ar + ar^2 + \\dots$ 的和为 $\\frac{a}{1-r}$。在我们的例子中，首项是 $a=\\phi$，公比是 $r=\\phi$。因此，和为：\n$$\n\\sum_{t=1}^{\\infty}\\phi^{t} = \\frac{\\phi}{1-\\phi}\n$$\n这是有效的，因为问题陈述了 $0  \\phi  1$，满足条件 $|\\phi|1$。\n\n将此结果代回 $\\tau$ 的表达式中：\n$$\n\\tau = 1 + 2\\left(\\frac{\\phi}{1-\\phi}\\right)\n$$\n为了简化，我们通分：\n$$\n\\tau = \\frac{1-\\phi}{1-\\phi} + \\frac{2\\phi}{1-\\phi} = \\frac{1-\\phi+2\\phi}{1-\\phi} = \\frac{1+\\phi}{1-\\phi}\n$$\n这就是未稀疏化链 IAT 的闭式表达式。\n\n### k-稀疏化链的 IAT 推导\n\nk-稀疏化链是通过保留原始链中每第 k 个样本来构建的。设新的稀疏化过程为 $\\{Z_{m}\\}_{m \\geq 0}$，其中 $Z_{m} = Y_{mk}$。过程 $\\{Z_{m}\\}$ 也是平稳的。我们需要求出它的 IAT，即 $\\tau_{k}$。\n\n首先，我们确定稀疏化过程的自相关函数，记为 $\\rho_{m}^{(k)}$。\n$$\n\\rho_{m}^{(k)} = \\operatorname{Corr}(Z_{0}, Z_{m}) = \\operatorname{Corr}(Y_{0}, Y_{mk})\n$$\n根据原始过程 ACF 的定义，$\\operatorname{Corr}(Y_{0}, Y_{mk}) = \\rho_{mk}$。\n使用给定模型 $\\rho_{t} = \\phi^{t}$，我们求出稀疏化过程的 ACF：\n$$\n\\rho_{m}^{(k)} = \\rho_{mk} = \\phi^{mk} = (\\phi^{k})^{m}\n$$\n稀疏化链的 IAT $\\tau_{k}$ 的定义与 $\\tau$ 类似：\n$$\n\\tau_{k} = 1 + 2\\sum_{m=1}^{\\infty}\\rho_{m}^{(k)}\n$$\n代入 $\\rho_{m}^{(k)}$ 的表达式：\n$$\n\\tau_{k} = 1 + 2\\sum_{m=1}^{\\infty}(\\phi^{k})^{m}\n$$\n这个和同样是一个几何级数，但公比为 $\\phi^{k}$。由于 $0  \\phi  1$ 且 k 是一个整数（假定 $k \\geq 1$），我们有 $0  \\phi^{k}  1$。因此，该级数收敛。\n这个几何级数的和为：\n$$\n\\sum_{m=1}^{\\infty}(\\phi^{k})^{m} = \\frac{\\phi^{k}}{1-\\phi^{k}}\n$$\n将此代回 $\\tau_{k}$ 的表达式中：\n$$\n\\tau_{k} = 1 + 2\\left(\\frac{\\phi^{k}}{1-\\phi^{k}}\\right)\n$$\n通过通分进行简化：\n$$\n\\tau_{k} = \\frac{1-\\phi^{k}}{1-\\phi^{k}} + \\frac{2\\phi^{k}}{1-\\phi^{k}} = \\frac{1-\\phi^{k}+2\\phi^{k}}{1-\\phi^{k}} = \\frac{1+\\phi^{k}}{1-\\phi^{k}}\n$$\n这就是 k-稀疏化链 IAT 的闭式表达式。\n\n最终结果是 $\\tau$ 和 $\\tau_{k}$ 的表达式。\n对于未稀疏化链：$\\tau = \\frac{1+\\phi}{1-\\phi}$。\n对于 k-稀疏化链：$\\tau_{k} = \\frac{1+\\phi^{k}}{1-\\phi^{k}}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1+\\phi}{1-\\phi}  \\frac{1+\\phi^k}{1-\\phi^k}\n\\end{pmatrix}\n}\n$$", "id": "3357397"}, {"introduction": "既然我们已经掌握了如何计算积分自相关时间，一个自然的实践问题便是：稀疏化能否提高我们从 MCMC 模拟中获取信息的效率？这个问题在高维空间中尤为重要，因为在高维空间中，Metropolis-Hastings 算法的性能对参数选择非常敏感。本练习将此问题置于一个现实的高维高斯目标分布场景中，要求您推导一个综合考虑计算成本和统计精度的效率指标，并找出最优的稀疏策略，最终得出一个可能出乎意料但至关重要的结论。 [@problem_id:3357394]", "problem": "考虑一个$d$维高斯目标分布$\\pi(\\mathbf{x}) \\propto \\exp\\!\\big(-\\|\\mathbf{x}\\|^{2}/(2\\tau^{2})\\big)$，其尺度为$\\tau > 0$，以及一个随机游走Metropolis–Hastings算法（马尔可夫链蒙特卡洛（MCMC）中的一种方法），该算法从当前状态$\\mathbf{x}$提出一个新状态$\\mathbf{y} \\sim \\mathcal{N}(\\mathbf{x}, s^{2}\\mathbf{I}_{d})$。假设实践者使用一个不等于真实$\\tau$的代理$\\tau_{\\text{prop}}$来选择提议尺度，使得$s^{2} = (l^{2}\\tau_{\\text{prop}}^{2})/d$，其中$l > 0$是一个无量纲的步长参数，这引入了一个尺度错配比$c = \\tau_{\\text{prop}}/\\tau$。假设在高维乘积结构和正则性条件下，当$d \\to \\infty$时，对于任意固定坐标，随机游走Metropolis–Hastings链允许一个扩散极限。\n\n从Metropolis–Hastings对称提议的接受规则和乘积目标扩散极限的基本定义出发，完成以下任务：\n\n- 在大$d$的扩散近似下，推导提议尺度$s$（通过$l$和$c$）如何控制滞后为$t \\in \\mathbb{N}$的第一坐标自相关函数$\\rho_{t}$。你的推导必须从接受概率的定义和随机游走Metropolis扩散极限的生成元形式开始，并以一个关于$l$、$c$、$\\tau$和$d$的$\\rho_{t}$的闭式表达式结束。\n- 定义以一个正整数因子$m \\in \\mathbb{N}$进行的稀疏化为保留每第$m$个迭代值并丢弃其余的。设每个保存样本的计算效率定义为\n$$\nE(m) \\;=\\; \\frac{1/m}{1 \\;+\\; 2\\sum_{t=1}^{\\infty} \\rho_{tm}} \\, ,\n$$\n这是每个保存样本的积分自相关时间的倒数，并按每个保存的迭代值需要$m$步的成本进行了缩放。使用你推导出的$\\rho_{t}$的形式，获得$E(m)$的闭式表达式，并确定在$m \\in \\mathbb{N}$上使$E(m)$最大化的$m$值。\n\n你的最终答案必须是最大化值$m^{\\star}$，作为一个单独的数字。不需要四舍五入，也不涉及单位。在你的推导中，将所有常数视为符号；不要为$l$、$c$、$\\tau$或$d$中的任何一个代入数值。", "solution": "该问题要求分析对一个由随机游走Metropolis–Hastings (RWMH) 算法为高维高斯目标生成的MCMC链进行稀疏化的问题。我们被要求在扩散近似下推导自相关函数，然后用它来找到最大化给定计算效率度量的最优稀疏化因子$m$。\n\n### 第一部分：自相关函数$\\rho_t$的推导\n\n目标分布是一个$d$维高斯分布$\\pi(\\mathbf{x}) \\propto \\exp(-\\|\\mathbf{x}\\|^{2}/(2\\tau^{2}))$，这对应于$\\mathcal{N}(\\mathbf{0}, \\tau^{2}\\mathbf{I}_{d})$。RWMH的提议分布是$\\mathbf{y} \\sim \\mathcal{N}(\\mathbf{x}, s^{2}\\mathbf{I}_{d})$，其中$\\mathbf{x}$是当前状态。该提议是对称的，所以接受概率为$\\alpha(\\mathbf{x}, \\mathbf{y}) = \\min\\left(1, \\frac{\\pi(\\mathbf{y})}{\\pi(\\mathbf{x})}\\right)$。\n\n概率密度的对数比为：\n$$ \\ln\\left(\\frac{\\pi(\\mathbf{y})}{\\pi(\\mathbf{x})}\\right) = -\\frac{\\|\\mathbf{y}\\|^{2}}{2\\tau^{2}} - \\left(-\\frac{\\|\\mathbf{x}\\|^{2}}{2\\tau^{2}}\\right) = \\frac{1}{2\\tau^{2}}\\left(\\|\\mathbf{x}\\|^{2} - \\|\\mathbf{y}\\|^{2}\\right) $$\n令提议写为$\\mathbf{y} = \\mathbf{x} + s\\mathbf{Z}$，其中$\\mathbf{Z} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{d})$。\n那么，$\\|\\mathbf{y}\\|^{2} - \\|\\mathbf{x}\\|^{2} = \\|\\mathbf{x} + s\\mathbf{Z}\\|^{2} - \\|\\mathbf{x}\\|^{2} = 2s(\\mathbf{x} \\cdot \\mathbf{Z}) + s^{2}\\|\\mathbf{Z}\\|^{2}$。\n对数接受比为：\n$$ A = -\\frac{1}{2\\tau^{2}}\\left(2s(\\mathbf{x} \\cdot \\mathbf{Z}) + s^{2}\\|\\mathbf{Z}\\|^{2}\\right) = -\\frac{s(\\mathbf{x} \\cdot \\mathbf{Z})}{\\tau^{2}} - \\frac{s^{2}\\|\\mathbf{Z}\\|^{2}}{2\\tau^{2}} $$\n提议方差由$s^{2} = (l^{2}\\tau_{\\text{prop}}^{2})/d$给出。利用尺度错配比$c = \\tau_{\\text{prop}}/\\tau$，我们可以写出$s^{2} = (l^{2}c^{2}\\tau^{2})/d$，所以$s = (lc\\tau)/\\sqrt{d}$。将此代入$A$的表达式中：\n$$ A = -\\frac{lc\\tau}{\\sqrt{d}\\tau^{2}}(\\mathbf{x} \\cdot \\mathbf{Z}) - \\frac{l^{2}c^{2}\\tau^{2}}{d(2\\tau^{2})}\\|\\mathbf{Z}\\|^{2} = -\\frac{lc}{\\sqrt{d}\\tau}(\\mathbf{x} \\cdot \\mathbf{Z}) - \\frac{l^{2}c^{2}}{2d}\\|\\mathbf{Z}\\|^{2} $$\n在高维极限($d \\to \\infty$)下，我们分析这些项的行为。当链处于其平稳分布$\\pi$时，每个分量$x_i \\sim \\mathcal{N}(0, \\tau^2)$是独立的。项$\\mathbf{x} \\cdot \\mathbf{Z} = \\sum_{i=1}^d x_i Z_i$是独立同分布随机变量的和，其均值为$0$，方差为$E[x_i^2]E[Z_i^2] = \\tau^2 \\cdot 1 = \\tau^2$。因此，根据中心极限定理，$(\\mathbf{x} \\cdot \\mathbf{Z}) / \\sqrt{d\\tau^2}$在分布上收敛到一个标准正态变量$W \\sim \\mathcal{N}(0,1)$。$A$中的第一项变为：\n$$ -\\frac{lc}{\\sqrt{d}\\tau}(\\mathbf{x} \\cdot \\mathbf{Z}) = -lc \\left(\\frac{\\mathbf{x} \\cdot \\mathbf{Z}}{\\sqrt{d}\\tau}\\right) \\xrightarrow{d} -lcW $$\n对于第二项，根据大数定律，$\\|\\mathbf{Z}\\|^{2}/d = \\frac{1}{d}\\sum_{i=1}^d Z_i^2 \\xrightarrow{p} E[Z_1^2] = 1$。\n所以，在极限$d \\to \\infty$下，对数接受比$A$在分布上收敛到一个随机变量$V$：\n$$ V = -lcW - \\frac{l^{2}c^{2}}{2} $$\n其中$W \\sim \\mathcal{N}(0,1)$。$V$是一个高斯随机变量，其均值为$E[V] = -l^{2}c^{2}/2$，方差为$\\text{Var}(V) = (-lc)^{2}\\text{Var}(W) = l^{2}c^{2}$。\n\n极限平均接受概率$\\bar{\\alpha}$是$\\min(1, \\exp(V))$的期望：\n$$ \\bar{\\alpha}(l,c) = E[\\min(1, \\exp(V))] = E[\\exp(\\min(0,V))] $$\n对于一个正态变量$V \\sim \\mathcal{N}(\\mu, \\sigma^{2})$，这个期望已知为$\\exp(\\mu+\\sigma^{2}/2)\\Phi(-\\mu/\\sigma - \\sigma) + \\Phi(\\mu/\\sigma)$，其中$\\Phi$是标准正态累积分布函数（CDF）。这里，$\\mu = -l^{2}c^{2}/2$且$\\sigma = lc$。\n$$ \\bar{\\alpha}(l,c) = \\exp\\left(-\\frac{l^2c^2}{2} + \\frac{l^2c^2}{2}\\right) \\Phi\\left(-\\frac{-l^2c^2/2}{lc} - lc \\right) + \\Phi\\left(\\frac{-l^2c^2/2}{lc}\\right) $$\n$$ \\bar{\\alpha}(l,c) = \\Phi\\left(\\frac{lc}{2} - lc\\right) + \\Phi\\left(-\\frac{lc}{2}\\right) = \\Phi\\left(-\\frac{lc}{2}\\right) + \\Phi\\left(-\\frac{lc}{2}\\right) = 2\\Phi(-lc/2) $$\n在指定的正则性条件下，当$d \\to \\infty$时，任何单个坐标的过程，在时间上按$u = k/d$（其中$k$是MCMC迭代次数）进行缩放后，弱收敛到一个Ornstein-Uhlenbeck (OU) 过程。向量过程$\\mathbf{X}(u)$的随机微分方程(SDE)为：\n$$ d\\mathbf{X}(u) = -\\frac{h}{2\\tau^2}\\mathbf{X}(u)du + \\sqrt{h} d\\mathbf{W}(u) $$\n其中$h = \\lim_{d\\to\\infty} d s^2 \\bar{\\alpha}$是极限扩散常数，$\\mathbf{W}(u)$是一个标准的$d$维维纳过程。\n代入$s^2$和$\\bar{\\alpha}$的表达式：\n$$ h = \\lim_{d\\to\\infty} d \\left(\\frac{l^2c^2\\tau^2}{d}\\right) \\left(2\\Phi(-lc/2)\\right) = 2l^2c^2\\tau^2\\Phi(-lc/2) $$\n单个坐标$X_i(u)$的SDE为：\n$$ dX_i(u) = -\\Lambda X_i(u)du + \\sqrt{2\\Lambda\\tau^2}dW_i(u) $$\n其中$\\Lambda = h/(2\\tau^2)$是速率参数。\n$$ \\Lambda = \\frac{2l^2c^2\\tau^2\\Phi(-lc/2)}{2\\tau^2} = l^2c^2\\Phi(-lc/2) $$\n速率为$\\Lambda$的OU过程在时间滞后$\\Delta u$时的自相关函数为$\\exp(-\\Lambda \\Delta u)$。离散MCMC链具有$t$步的滞后。在连续时间尺度下，这对应于$\\Delta u = t/d$的时间滞后。因此，原始MCMC链在滞后$t$时的自相关为：\n$$ \\rho_t = \\exp(-\\Lambda t/d) = \\exp\\left(-\\frac{t}{d} l^2c^2\\Phi(-lc/2)\\right) $$\n这个$\\rho_t$的表达式依赖于$l$、$c$和$d$，但不依赖于$\\tau$，因为目标尺度$\\tau$在速率参数$\\Lambda$中被消掉了。\n\n### 第二部分：计算效率$E(m)$的最大化\n\n计算效率由下式给出：\n$$ E(m) = \\frac{1/m}{1 + 2\\sum_{t=1}^{\\infty} \\rho_{tm}} $$\n自相关函数的形式为$\\rho_t = r^t$，其中$r = \\exp(-\\gamma)$且$\\gamma = \\frac{1}{d} l^2c^2\\Phi(-lc/2)$。\n分母中的和是一个几何级数：\n$$ \\sum_{t=1}^{\\infty} \\rho_{tm} = \\sum_{t=1}^{\\infty} (r^m)^t = \\frac{r^m}{1-r^m} $$\n分母，即稀疏化后链的积分自相关时间，是：\n$$ 1 + 2\\sum_{t=1}^{\\infty} \\rho_{tm} = 1 + \\frac{2r^m}{1-r^m} = \\frac{1-r^m+2r^m}{1-r^m} = \\frac{1+r^m}{1-r^m} $$\n将此代回$E(m)$的表达式：\n$$ E(m) = \\frac{1/m}{(1+r^m)/(1-r^m)} = \\frac{1 - r^m}{m(1 + r^m)} $$\n令$x = \\gamma m$。由于$l, c > 0$，所以$\\Phi(-lc/2) > 0$，因此$\\gamma > 0$。对于$m \\in \\mathbb{N}$，$x > 0$。\n$$ E(m) = \\frac{1 - \\exp(-\\gamma m)}{m(1 + \\exp(-\\gamma m))} = \\frac{\\gamma(1 - \\exp(-x))}{x(1 + \\exp(-x))} $$\n为了关于$m \\in \\mathbb{N}$最大化$E(m)$，我们分析函数$g(x) = \\frac{1 - \\exp(-x)}{x(1 + \\exp(-x))}$在$x>0$时的行为。\n我们可以使用双曲正切函数$\\tanh(z) = \\frac{\\exp(z)-\\exp(-z)}{\\exp(z)+\\exp(-z)} = \\frac{1-\\exp(-2z)}{1+\\exp(-2z)}$重写$g(x)$：\n$$ g(x) = \\frac{1}{x} \\frac{\\exp(x/2)(1 - \\exp(-x))}{\\exp(x/2)(1 + \\exp(-x))} = \\frac{1}{x} \\frac{\\exp(x/2)-\\exp(-x/2)}{\\exp(x/2)+\\exp(-x/2)} = \\frac{\\tanh(x/2)}{x} $$\n我们求$g(x)$关于$x$的导数：\n$$ g'(x) = \\frac{\\frac{1}{2}\\text{sech}^2(x/2) \\cdot x - \\tanh(x/2) \\cdot 1}{x^2} = \\frac{1}{x^2} \\left(\\frac{x}{2\\cosh^2(x/2)} - \\frac{\\sinh(x/2)}{\\cosh(x/2)}\\right) $$\n$$ g'(x) = \\frac{1}{x^2\\cosh^2(x/2)} \\left(\\frac{x}{2} - \\sinh(x/2)\\cosh(x/2)\\right) $$\n使用恒等式$\\sinh(z)\\cosh(z) = \\frac{1}{2}\\sinh(2z)$：\n$$ g'(x) = \\frac{1}{x^2\\cosh^2(x/2)} \\left(\\frac{x}{2} - \\frac{1}{2}\\sinh(x)\\right) = \\frac{1}{2x^2\\cosh^2(x/2)} (x - \\sinh(x)) $$\n对于任何实数$x>0$，这是一个标准结论：$\\sinh(x) > x$。这可以通过考虑函数$h(x) = \\sinh(x) - x$来证明，对于该函数$h(0)=0$且当$x>0$时$h'(x) = \\cosh(x) - 1 > 0$。\n因此，对于$x>0$，项$(x - \\sinh(x))$是严格负的。前置因子$\\frac{1}{2x^2\\cosh^2(x/2)}$是严格正的。\n这意味着对于所有$x > 0$，$g'(x)  0$。\n函数$g(x)$在$x > 0$上是严格递减的。由于$x = \\gamma m$且$\\gamma > 0$，效率$E(m)$是$m$在$m \\ge 1$上的一个严格递减函数。\n\n我们被要求在正整数集合$m \\in \\mathbb{N} = \\{1, 2, 3, \\dots\\}$上最大化$E(m)$。对于一个定义在正整数上的严格递减函数，其最大值在最小可能的整数处取得。\n因此，使$E(m)$最大化的$m$值为$m=1$。这意味着，对于最大化此计算效率定义而言，不进行稀疏化是最优策略。", "answer": "$$\\boxed{1}$$", "id": "3357394"}, {"introduction": "前面的练习表明，从统计效率的角度看，稀疏化似乎并无益处。那么，我们该如何解释它在实践中的广泛应用，以及它所带来的潜在风险呢？本练习探讨了一个在 MCMC 诊断中微妙但极其危险的陷阱。它揭示了在存在多模式混合缓慢的情况下，不恰当的稀疏化会如何“欺骗”诸如 Gelman-Rubin 诊断（$\\widehat{R}$）之类的标准收敛性诊断工具，从而使得未收敛的链看起来已经收敛。[@problem_id:3357402]", "problem": "考虑 $C$ 条独立的马尔可夫链蒙特卡洛 (MCMC) 链，其目标平稳分布为 $\\pi$，并通过一个标量分量 $X_t$ 进行监测。假设在一个亚稳态模式内，该标量分量可以很好地用一个一阶自回归过程 $X_{t+1} = \\mu + \\phi (X_t - \\mu) + \\varepsilon_{t+1}$ 来近似，其中 $|\\phi|1$ 且 $\\varepsilon_t$ 是均值为零、方差有限的独立同分布随机变量，并且稀有的模式间跳跃以每次迭代 $\\lambda0$ 的速率发生（因此模式切换之间的期望等待时间为 $\\lambda^{-1}$）。在舍弃初始的预热期后，您对通过保留每个第 $k$ 个状态（其中 $k \\in \\mathbb{N}$）获得的稀疏化样本计算 Gelman–Rubin 分裂-$\\widehat{R}$ 诊断。\n\n分裂-$\\widehat{R}$ 诊断是为 $M$ 个序列（此处，将 $C$ 条链各自分成两半，得到 $M=2C$ 个序列）定义的，每个序列长度为 $n$。首先计算每个序列的序列内样本方差 $s_m^2$ 和样本均值 $\\bar{X}_m$（$m=1,\\dots,M$），合并的序列内方差 $W = \\frac{1}{M} \\sum_{m=1}^M s_m^2$，以及序列间方差 $B = \\frac{n}{M-1} \\sum_{m=1}^M (\\bar{X}_m - \\bar{X}_\\cdot)^2$，其中 $\\bar{X}_\\cdot = \\frac{1}{M} \\sum_{m=1}^M \\bar{X}_m$。边缘方差估计量为 $\\hat{V} = \\frac{n-1}{n} W + \\frac{1}{n} B$，潜在尺度缩减因子为 $\\widehat{R} = \\sqrt{\\hat{V}/W}$。\n\n从自回归动力学和方差分解的基本原理出发，分析按 $k$ 进行稀疏化如何影响滞后结构和构成 $\\widehat{R}$ 的方差分量，并找出稀疏化可能对慢混合分量错误地指示收敛的条件。特别地，回想一下，对于自回归模型，按 $k$ 稀疏化后的滞后-1 自相关近似变为 $\\phi^k$，并且模式内的积分自相关时间为 $\\tau_{\\mathrm{int}} = \\frac{1+\\phi}{1-\\phi}$，其稀疏化后的对应值为 $\\tau_{\\mathrm{int},k} = \\frac{1+\\phi^k}{1-\\phi^k}$。另外请注意，当稀有跳跃的速率为 $\\lambda$ 时，在 $N$ 次预热后迭代中，模式切换的期望次数为 $\\lambda N$。\n\n以下哪个陈述正确地描述了分裂-$\\widehat{R}$ 对按 $k$ 进行稀疏化的敏感性，并给出了稀疏化可能对慢混合分量错误地指示收敛的有效条件？\n\nA. 在自回归模型下，按 $k$ 稀疏化将 $\\phi$ 替换为 $\\phi^k$，并保证只要 $k(1-\\phi)^{-1}$，无论链是否被困在不同的模式中，都有 $\\widehat{R}  1.1$。\n\nB. 因为 $\\widehat{R}$ 仅依赖于样本均值和方差，所以滞后结构是无关紧要的；对于任何平稳链，按任何 $k$ 进行稀疏化都不会改变 $\\widehat{R}$。\n\nC. 按 $k$ 稀疏化通过将 $\\phi$ 转换为 $\\phi^k$ 来减少模式内的自相关，但样本量的减少导致 $\\widehat{R}$ 通常随 $k$ 增大而增大；因此，对于收敛性评估，稀疏化是一种普遍保守的选择。\n\nD. 如果选择的 $k$ 满足在一个模式内 $k \\gg \\tau_{\\mathrm{int}}$（等价于 $\\phi^k \\approx 0$），同时 $k \\ll \\lambda^{-1}$ 且 $\\lambda N \\ll 1$，那么每条链的每个分裂的一半都近似表现为来自单一模式的独立抽样，导致序列间差异很小，即使链没有在模式间混合，$\\widehat{R}$ 也接近于 $1$。因此，在这些条件下，稀疏化可能对慢混合分量错误地指示收敛。\n\nE. 为完全避免错误的收敛判断，应按 $k = \\lambda^{-1}$ 进行稀疏化，这样可以保证 $\\widehat{R}$ 能揭示出对于任何目标 $\\pi$、任何 $C$ 和 $N$ 在模式间的混合不足。", "solution": "### 步骤 1：问题验证\n\n我将首先从问题陈述中提取已知条件。\n\n**已知条件：**\n1.  **链：** $C$ 条独立的马尔可夫链蒙特卡洛 (MCMC) 链。\n2.  **目标分布：** 平稳分布 $\\pi$。\n3.  **监测分量：** 标量分量 $X_t$。\n4.  **模式内动力学：** 在亚稳态模式内，$X_t$ 可用一阶自回归过程近似：$X_{t+1} = \\mu + \\phi (X_t - \\mu) + \\varepsilon_{t+1}$，其中 $|\\phi|1$ 且 $\\varepsilon_t$ 为均值为零、方差有限的独立同分布变量。\n5.  **模式间动力学：** 稀有的模式间跳跃以每次迭代 $\\lambda > 0$ 的速率发生。模式切换之间的期望等待时间为 $\\lambda^{-1}$。\n6.  **过程：**\n    *   舍弃初始的预热期。\n    *   计算 Gelman–Rubin 分裂-$\\widehat{R}$ 诊断。\n    *   计算是在稀疏化样本上进行的，保留每个第 $k$ 个状态，其中 $k \\in \\mathbb{N}$。\n7.  **分裂-$\\widehat{R}$ 定义：**\n    *   $M = 2C$ 个序列（来自将 $C$ 条链分裂）。\n    *   每个序列长度为 $n$。\n    *   序列内样本方差：$s_m^2$，$m=1, \\dots, M$。\n    *   序列内样本均值：$\\bar{X}_m$，$m=1, \\dots, M$。\n    *   合并的序列内方差：$W = \\frac{1}{M} \\sum_{m=1}^M s_m^2$。\n    *   序列间方差：$B = \\frac{n}{M-1} \\sum_{m=1}^M (\\bar{X}_m - \\bar{X}_\\cdot)^2$，其中 $\\bar{X}_\\cdot = \\frac{1}{M} \\sum_{m=1}^M \\bar{X}_m$。\n    *   边缘方差估计量：$\\hat{V} = \\frac{n-1}{n} W + \\frac{1}{n} B$。\n    *   潜在尺度缩减因子：$\\widehat{R} = \\sqrt{\\hat{V}/W}$。\n8.  **附加信息/回顾：**\n    *   按 $k$ 稀疏化后的滞后-1 自相关：近似为 $\\phi^k$。\n    *   模式内的积分自相关时间：$\\tau_{\\mathrm{int}} = \\frac{1+\\phi}{1-\\phi}$。\n    *   稀疏化后的积分自相关时间：$\\tau_{\\mathrm{int},k} = \\frac{1+\\phi^k}{1-\\phi^k}$。\n    *   在 $N$ 次预热后迭代中，模式切换的期望次数：$\\lambda N$。\n\n**问题：**\n分析按 $k$ 进行稀疏化如何影响滞后结构和构成 $\\widehat{R}$ 的方差分量，并找出稀疏化可能对慢混合分量错误地指示收敛的条件。所提供的陈述中哪一个正确地描述了这一点？\n\n---\n\n### 步骤 2：使用提取的已知条件进行验证\n\n现在我将根据准则评估问题陈述的有效性。\n\n1.  **科学上是否成立？** 是。该问题描述了 MCMC 诊断中一个非常标准的情景。使用 AR(1) 过程对模式内动力学进行建模是一种常见且有用的近似。亚稳态模式、稀有跳跃和 Gelman-Rubin 诊断 ($\\widehat{R}$) 的概念都是随机模拟和蒙特卡洛方法领域的核心。$\\widehat{R}$、$W$、$B$ 和 $\\hat{V}$ 的公式是标准的。积分自相关时间的表达式对于 AR(1) 过程也是标准的。稀疏化和自相关函数之间的关系是正确的。该问题深深植根于统计计算领域，并且在科学上是合理的。\n\n2.  **是否定义明确？** 是。该问题要求在给定的一组条件下，找出对某一现象（稀疏化对 $\\widehat{R}$ 的影响）的正确描述。它提供了一个清晰的模型和定义。假设选项中有一个是正确的，那么问题就足够具体，可以有一个正确的答案。进行唯一、稳定且有意义的分析是可能的。\n\n3.  **是否客观？** 是。语言精确且技术性强。它使用了统计学和 MCMC 理论中的标准定义。没有主观或基于意见的陈述。\n\n4.  **科学或事实上是否不健全？** 否。该模型是一个简化模型，但对于这类分析来说是有效且广泛使用的。其前提并非虚假。所提供的数学关系是正确的。\n    *   AR(1) 过程 $X_t-\\mu = \\phi(X_{t-1}-\\mu) + \\varepsilon_t$ 的方差是 $\\text{Var}(X_t) = \\sigma_\\varepsilon^2 / (1-\\phi^2)$。\n    *   滞后 $j$ 的自相关是 $\\rho(j) = \\phi^j$。\n    *   积分自相关时间是 $\\tau_{\\text{int}} = 1 + 2\\sum_{j=1}^\\infty \\rho(j) = 1 + 2\\sum_{j=1}^\\infty \\phi^j = 1 + 2\\frac{\\phi}{1-\\phi} = \\frac{1-\\phi+2\\phi}{1-\\phi} = \\frac{1+\\phi}{1-\\phi}$。这与给定的公式相符。\n    *   对于稀疏化链，新过程的状态为 $Y_t = X_{tk}$。其自相关为 $\\text{Corr}(Y_t, Y_{t-1}) = \\text{Corr}(X_{tk}, X_{(t-1)k}) = \\rho(k) = \\phi^k$。因此，新的有效 $\\phi$ 是 $\\phi^k$。这也是正确的。\n    *   $\\widehat{R}$ 的公式是标准的（源自 Gelman 等人的《贝叶斯数据分析》）。\n    *   模式间混合缓慢是主要的收敛问题，这是一个经典的 MCMC 问题。\n\n5.  **是否非形式化或不相关？** 否。该问题高度形式化，并且是 MCMC 诊断主题的核心，特别是稀疏化。\n\n6.  **设置是否不完整或矛盾？** 否。该设置提供了一个清晰的模型（模式内 AR(1)，模式间稀有跳跃）和所有必要的定义。这是一个概念性问题，因此不需要 $\\phi, \\lambda, C, N$ 的具体数值。信息是自洽的。\n\n7.  **是否不切实际或不可行？** 否。所描述的情景在实际的 MCMC 应用中非常现实，例如在贝叶斯统计中从多峰后验分布中抽样。\n\n8.  **是否病态或结构不良？** 否。问题清晰，可以进行独特概念性分析。\n\n9.  **是否故作高深、琐碎或同义反复？** 否。该问题探讨了 MCMC 实践中一个微妙但重要的问题：稀疏化可能掩盖收敛性差的问题。理解模式内自相关、模式间跳跃、样本量和 $\\widehat{R}$ 统计量之间的相互作用需要实质性的推理。\n\n10. **是否超出科学可验证性？** 否。这些主张可以通过对所提供的统计模型和定义进行数学分析来验证。\n\n**结论：** 问题陈述是**有效的**。这是一个定义明确、科学合理且在统计计算中标准的题目。我可以继续进行解答。\n\n---\n\n### 步骤 3：求解推导\n\n现在我将从基本原理分析问题，然后评估每个选项。\n\n**Gelman-Rubin 诊断 ($\\widehat{R}$) 的原理**\n\n$\\widehat{R}$ 统计量旨在通过比较单个序列内的方差与整个序列集合的方差来诊断 MCMC 的收敛性。潜在尺度缩减因子定义为 $\\widehat{R} = \\sqrt{\\hat{V}/W}$，其中 $W$ 是合并的序列内方差，$\\hat{V}$ 是目标分布 $\\pi$ 的边缘方差的估计量。\n*   $W = \\frac{1}{M} \\sum_{m=1}^M s_m^2$ 通过 $M$ 个序列的样本方差的平均值来估计 $\\pi$ 的方差。\n*   $\\hat{V} = \\frac{n-1}{n} W + \\frac{1}{n} B$ 是序列内方差 ($W$) 和序列间方差 ($B$) 的混合。项 $B = \\frac{n}{M-1} \\sum_{m=1}^M (\\bar{X}_m - \\bar{X}_\\cdot)^2$ 衡量了各序列样本均值之间的方差。\n*   如果链已收敛并正在探索完整的平稳分布 $\\pi$，那么 $W$ 和 $\\hat{V}$ 都应该是真实方差 $\\text{Var}_{\\pi}(X)$ 的一致估计量。因此，它们的比率 $\\hat{V}/W$ 应该接近于 1，从而得到 $\\widehat{R} \\approx 1$。\n*   如果链没有混合，并且被困在状态空间的不同区域（例如，具有不同均值的不同亚稳态模式），那么样本均值 $\\bar{X}_m$ 将会相距甚远。这会使序列间方差 $B$ 膨胀，进而使 $\\hat{V}$ 相对于 $W$ 膨胀。结果，$\\widehat{R}$ 将显著大于 1，正确地指示了收敛性不足。\n\n**问题场景：双尺度慢混合**\n\n问题描述了两种类型的慢混合：\n1.  **模式内（快时间尺度）：** 高自相关，由 $\\phi \\approx 1$ 参数化，导致较大的积分自相关时间 $\\tau_{\\mathrm{int}} = (1+\\phi)/(1-\\phi)$。\n2.  **模式间（慢时间尺度）：** 模式间的稀有跳跃，速率为 $\\lambda \\ll 1$，期望等待时间为 $\\lambda^{-1}$。\n\n核心问题是，按因子 $k$ 进行稀疏化如何能够掩盖第二种、更严重的慢混合类型。当 $\\widehat{R}$ 错误地指示收敛（$\\widehat{R} \\approx 1$），即使链尚未探索分布 $\\pi$ 的所有模式时，这种失效模式就会发生。\n\n**稀疏化分析**\n\n将链 $X_t$ 按因子 $k$ 稀疏化会产生一个新的链 $Y_j = X_{jk}$。这有两个主要影响：\n1.  **自相关的减少：** 稀疏化的 AR(1) 过程的滞后-1 自相关变为 $\\phi^k$。如果我们选择一个大的 $k$，特别是 $k \\gg \\tau_{\\mathrm{int}}$，那么 $\\phi^k \\approx 0$。稀疏化后的样本序列表现得好像是近似独立同分布 (i.i.d.) 的。\n2.  **样本量的减少：** 如果原始的预热后序列长度为 $N_{seq}$，则稀疏化后的序列长度为 $n = N_{seq}/k$。对于分裂-$\\widehat{R}$，原始链长为 $N$，并被分成两半，所以 $n=N/(2k)$。\n\n**错误收敛的条件**\n\n如果我们将两种混合时间尺度分开，就可能出现错误的收敛感。其条件如下：\n1.  总迭代次数 $N$ 不足以观察到模式间的跳跃。如果运行期间的预期跳跃次数很小，即 $\\lambda N \\ll 1$，则很可能发生这种情况。在此条件下，$C$ 条链中的每一条都可能停留在其开始（或预热后最终所在）的单一模式中。\n2.  选择的稀疏化因子 $k$ 足够大，以消除模式内的自相关，即 $k \\gg \\tau_{\\mathrm{int}}$。\n\n让我们看看在这些条件下 $\\widehat{R}$ 统计量会发生什么。\n$M=2C$ 个分裂序列中的每一个现在都是一组长度为 $n=N/(2k)$ 的近似 i.i.d. 样本。由于每条完整的链都被困在一个单一模式中，其分裂的两半也是来自同一模式的样本。\n如果不同的链被困在不同的模式中（例如，链 $1, \\dots, C/2$ 在模式 A；链 $C/2+1, \\dots, C$ 在模式 B），那么这 $M$ 个序列的集合就包含了来自不同分布（$\\pi_A$, $\\pi_B$ 等）的样本。\n\n关键的后果是这种情况如何影响估计量 $W$ 和 $B$。\n*   $W_k$：稀疏化链的合并序列内方差将是平均*模式内*方差 $\\sigma_w^2$ 的一个良好估计。当我们进行稀疏化时，我们消除了高自相关在样本方差计算中引入的向下偏差。因此，$W_k$（对于大的 $k$）是对 $\\sigma_w^2$ 的一个比未稀疏化的对应项 $W_{k=1}$ 更准确和更大的估计。\n*   $B_k$：序列间方差衡量了均值 $\\bar{X}_{m,k}$ 的离散程度。因为不同的链处于具有不同均值的不同模式中（例如 $\\mu_A \\neq \\mu_B$），样本均值 $\\bar{X}_{m,k}$ 将围绕这些不同的模式均值聚类。这将导致平方和 $\\sum (\\bar{X}_{m,k} - \\bar{X}_{\\cdot,k})^2$ 很大。\n\n因此，$B_k$ 项（以及 $\\hat{V}_k$）包含了模式间方差的贡献，而 $W_k$ 只包含了模式内方差。比率 $\\hat{V}_k/W_k$ 应该仍然显著大于 1。\n\n然而，存在一个已知的微妙之处。问题的原始表述和统计学界的普遍理解是，稀疏化确实可能掩盖收敛性。让我们分析这些选项，以找到对这一现象的正确描述。\n\n**逐项分析**\n\n*   **A. 在自回归模型下，按 $k$ 稀疏化将 $\\phi$ 替换为 $\\phi^k$，并保证只要 $k(1-\\phi)^{-1}$，无论链是否被困在不同的模式中，都有 $\\widehat{R}  1.1$。**\n    该陈述基于一个简单的启发式 $k$ 值，做出了一个强有力的定量保证（$\\widehat{R}  1.1$）。$\\widehat{R}$ 的值严重依赖于模式的分离程度。如果模式相距很远，$\\widehat{R}$ 可以任意大。声称这“无论链是否被困”都成立是错误的。如果链被困在相距甚远的模式中，$\\widehat{R}$ 将会很大，而不能保证很小。**不正确**。\n\n*   **B. 因为 $\\widehat{R}$ 仅依赖于样本均值和方差，所以滞后结构是无关紧要的；对于任何平稳链，按任何 $k$ 进行稀疏化都不会改变 $\\widehat{R}$。**\n    这从根本上是错误的。样本均值和方差本身就是统计量，它们的分布强烈依赖于链的滞后结构（自相关）。例如，来自自相关序列的样本均值的方差不是 $\\sigma^2/n$，而是被一个与积分自相关时间相关的因子放大了。高自相关也会使样本方差 $s_m^2$ 向下偏倚。因此，改变滞后结构的稀疏化会改变 $W$ 和 $B$ 的值，从而改变 $\\widehat{R}$。**不正确**。\n\n*   **C. 按 $k$ 稀疏化通过将 $\\phi$ 转换为 $\\phi^k$ 来减少模式内的自相关，但样本量的减少导致 $\\widehat{R}$ 通常随 $k$ 增大而增大；因此，对于收敛性评估，稀疏化是一种普遍保守的选择。**\n    第一部分是正确的。第二部分，即 $\\widehat{R}$ 通常随 $k$ 增大而增大，是有争议的，并且取决于具体的动力学；一些分析表明情况相反。更重要的是，稀疏化是“普遍保守”选择的结论是错误的。一个保守的程序更可能指示不收敛。如果稀疏化有时可以降低 $\\widehat{R}$（正如经验上所知），那么它就不是一个保守的选择。问题的根本前提是稀疏化可能错误地指示收敛，这与保守正好相反。**不正确**。\n\n*   **D. 如果选择的 $k$ 满足在一个模式内 $k \\gg \\tau_{\\mathrm{int}}$（等价于 $\\phi^k \\approx 0$），同时 $k \\ll \\lambda^{-1}$ 且 $\\lambda N \\ll 1$，那么每条链的每个分裂的一半都近似表现为来自单一模式的独立抽样，导致序列间差异很小，即使链没有在模式间混合，$\\widehat{R}$ 也接近于 $1$。因此，在这些条件下，稀疏化可能对慢混合分量错误地指示收敛。**\n    该选项列出了这种病态情况发生的确切条件。\n    1.  条件 $\\lambda N \\ll 1$ 确保了链在运行期间不会在模式之间混合。\n    2.  条件 $k \\gg \\tau_{\\mathrm{int}}$ 确保了（快速的）模式内自相关通过稀疏化被消除，使得每个稀疏化序列看起来都是 i.i.d. 的。\n    3.  条件 $k \\ll \\lambda^{-1}$ 确保稀疏化不会意外地跨越模式跳跃（如果发生了的话）。\n    \n    在这种情况下，诊断所面对的是看似来自非真实目标分布 $\\pi$ 而是其条件分量 $\\pi_m$ 的 i.i.d. 样本。该陈述声称这会导致“小的序列间差异”。这一点值得商榷，因为如果链被困在不同的模式中，序列间的均值差异应该会很大。然而，一个更微妙的观点是，由于样本量 $n=N/(2k)$ 减小，对均值 $\\bar{X}_m$ 和方差 $s_m^2$ 的估计变得非常不稳定。$B$ 项（序列间方差）的估计可能不会显著超过 $W$ 项（序列内方差）的估计，因为两者都很嘈杂。结果是 $\\hat{V}/W$ 的比率趋向于 1。这个选项准确地描述了 MCMC 诊断的一个已知失效模式。陈述“导致序列间差异很小”可能在措辞上不完美（应该是“导致估计的序列间方差相对于序列内方差不再显著大”），但它抓住了核心思想，即 $\\widehat{R}$ 会错误地接近于1。在所有选项中，这个最准确地描述了现象和其发生的条件。**正确**。\n\n*   **E. 为完全避免错误的收敛判断，应按 $k = \\lambda^{-1}$ 进行稀疏化，这样可以保证 $\\widehat{R}$ 能揭示出对于任何目标 $\\pi$、任何 $C$ 和 $N$ 在模式间的混合不足。**\n    这建议了一个具体的、启发式的 $k$ 选择。将 $k$ 设置为*平均*等待时间并不能保证观察到跳跃。等待时间是一个随机变量，一条链可能在 $\\lambda^{-1}$ 的几倍时间内都不跳跃。此外，这为“任何目标 $\\pi$、任何 $C$ 和 $N$”做出了保证，这对任何 MCMC 诊断来说都是一个过于强烈的断言。没有一个通用的 $k$ 选择可以保证在所有情况下都能正确诊断。**不正确**。", "answer": "$$\\boxed{D}$$", "id": "3357402"}]}