{"hands_on_practices": [{"introduction": "在投入复杂的计算工具之前，从数学根源上理解谱检验至关重要。本练习将引导您从第一性原理出发，推导对偶格的基本条件，并针对一个简单的小例子进行手工计算。这项实践旨在为您建立一个坚实、直观的基础，让您明白谱检验究竟在衡量什么 [@problem_id:3318079]。", "problem": "线性同余生成器 (LCG) 由递推关系 $X_{n+1} \\equiv a X_n + c \\pmod{m}$ 定义，其中整数 $m \\geq 2$，$0 \\leq a  m$，$0 \\leq c  m$，其归一化输出为 $U_n = X_n/m \\in [0,1)$。在随机模拟和蒙特卡洛方法的背景下，谱检验评估由 $t$ 维输出元组集合 $S_t = \\{(U_n, U_{n+1}, \\dots, U_{n+t-1}) : n \\in \\mathbb{Z}\\}$ 形成的格点结构。\n\n仅使用 LCG 的基本定义以及模算术和线性形式的标准性质，完成以下任务：\n\n1.  严格定义 LCG 在维度 $t$ 上的谱检验，包括 $S_t$ 的对偶格的概念以及基于欧几里得范数下最短非零对偶向量的品质因数。\n2.  从递推关系 $X_{n+1} \\equiv a X_n + c \\pmod{m}$ 和归一化输出 $U_n = X_n/m$ 出发，推导与 $t$ 维元组集合 $(U_n,\\dots,U_{n+t-1})$ 相关的对偶格，并用 $a$ 和 $m$ 将其明确表示为 $\\mathbb{Z}^t$ 的一个子集。\n3.  对于参数为 $(m,a,c) = (31,3,0)$ 且维度 $t=2$ 的特定 LCG，计算你所推导的对偶格中最短非零向量的欧几里得范数。提供精确的最终数值（无舍入），并将其表示为单个实数或单个闭式解析表达式。", "solution": "所述问题是有效的。它在科学上植根于伪随机数生成的既有理论，特别是通过谱检验对线性同余生成器 (LCG) 的分析。该问题是适定的，提供了所有必要的参数和定义，能够导出一个唯一且可验证的解。它是客观的，不包含任何形而上学或主观的主张。这些任务逻辑顺序清晰，与随机模拟和蒙特卡洛方法的主题直接相关。\n\n我们将首先定义谱检验，然后推导 LCG 对偶格的一般形式，最后计算给定特定参数下所需的范数。\n\n### 第1部分：谱检验的定义\n\n线性同余生成器由递推关系 $X_{n+1} \\equiv a X_n + c \\pmod{m}$ 定义，从中获得归一化输出 $U_n = X_n / m$。谱检验通过检查连续输出的 $t$ 维向量集合 $S_t = \\{(U_n, U_{n+1}, \\dots, U_{n+t-1}) : n \\in \\mathbb{Z}\\}$ 的几何结构来评估 LCG 的质量。\n\n$S_t$ 中的点并不均匀地填充 $t$ 维单位超立方体 $[0,1)^t$，而是被限制在有限数量的平行超平面上。这种离散结构是一个称为格点的数学对象的体现。满足 LCG 递推同余式的所有整数向量 $\\mathbf{z} = (z_1, \\dots, z_t)$ 的完整集合构成一个格点 $L_t$。LCG 的点 $(X_n, \\dots, X_{n+t-1})$ 构成该格点的一个子集（如果 $c \\neq 0$，则是它的一个平移版本）。\n\n谱检验是通过分析**对偶格**（记为 $L_t^*$）来定义的。对偶格 $L_t^*$ 是所有整数向量 $\\mathbf{v} = (v_1, \\dots, v_t) \\in \\mathbb{Z}^t$ 的集合，使得对于 $S_t$ 中的每一个向量 $\\mathbf{u}$，点积 $\\mathbf{v} \\cdot \\mathbf{u}$ 都是一个整数：\n$$L_t^* = \\{\\mathbf{v} \\in \\mathbb{Z}^t \\mid \\forall \\mathbf{u} \\in S_t, \\mathbf{v} \\cdot \\mathbf{u} \\in \\mathbb{Z}\\}$$\n从几何上看，一个非零向量 $\\mathbf{v} \\in L_t^*$ 与一族由 $\\mathbf{v} \\cdot \\mathbf{x} = k$（$k$ 为整数）给出的平行超平面垂直，生成器的所有输出点都位于这些超平面上。该族中相邻超平面之间的距离是 $1/||\\mathbf{v}||_2$，其中 $||\\cdot||_2$ 表示欧几里得范数。\n\n要使一个生成器被认为是“好的”，其输出点应尽可能均匀分布，这意味着格点结构应是“细”的而不是“粗”的。这意味着包含所有点的任意一族平行超平面之间的最小距离应尽可能大。这等价于在对偶格中找到最短的非零向量。\n\n因此，维度 $t$ 上谱检验的**品质因数**（记为 $\\nu_t$）是对偶格 $L_t^*$ 中最短非零向量的欧几里得范数：\n$$\\nu_t = \\min \\{ ||\\mathbf{v}||_2 \\mid \\mathbf{v} \\in L_t^*, \\mathbf{v} \\neq \\mathbf{0} \\}$$\n$\\nu_t$ 值越大，表示 LCG 在维度 $t$ 上的格点结构越好（越细）。\n\n### 第2部分：对偶格的推导\n\n为了推导对偶格的显式形式，我们从它的定义开始。一个向量 $\\mathbf{v} = (v_1, \\dots, v_t) \\in \\mathbb{Z}^t$ 属于 $L_t^*$ 当且仅当对于所有生成的向量 $\\mathbf{U}_n = (U_n, \\dots, U_{n+t-1})$，都有 $\\mathbf{v} \\cdot \\mathbf{U}_n \\in \\mathbb{Z}$。使用归一化关系 $U_k = X_k/m$，该条件等价于：\n$$\\frac{1}{m} \\sum_{j=1}^{t} v_j X_{n+j-1} \\in \\mathbb{Z}$$\n这又等价于同余式：\n$$\\sum_{j=1}^{t} v_j X_{n+j-1} \\equiv 0 \\pmod{m}$$\n这个同余式必须对 LCG 生成的所有整数序列 $(X_n, X_{n+1}, \\dots)$ 都成立。\n\n对偶格的结构与生成器格点的基本间距有关，而基本间距由递推关系的乘法部分决定。加法常数 $c$ 仅仅引起整个点格的刚性平移，这不影响对偶格。因此，我们可以通过考虑 $c=0$ 的齐次情况来分析对偶格，即 $X_{n+1} \\equiv a X_n \\pmod{m}$。该递推关系意味着对于任何 $k \\geq 0$，都有 $X_{n+k} \\equiv a^k X_n \\pmod{m}$。\n\n将此代入我们对偶格向量的同余条件中：\n$$\\sum_{j=1}^{t} v_j (a^{j-1} X_n) \\equiv 0 \\pmod{m}$$\n$$X_n \\left( \\sum_{j=1}^{t} v_j a^{j-1} \\right) \\equiv 0 \\pmod{m}$$\n对于一个非平凡的生成器（即不产生恒为零的序列的生成器），状态 $X_n$ 将取遍模 $m$ 的各种非零值。为了使上述同余式对所有可能的 $X_n$ 值都成立，$X_n$ 的系数必须是 $m$ 的倍数。因此，我们得到了对偶格的定义条件：\n$$\\sum_{j=1}^{t} v_j a^{j-1} \\equiv 0 \\pmod{m}$$\n因此，对偶格 $L_t^*$ 是满足此线性同余式的所有整数向量 $\\mathbf{v} = (v_1, \\dots, v_t)$ 的集合：\n$$L_t^* = \\left\\{ \\mathbf{v} \\in \\mathbb{Z}^t \\mid v_1 + a v_2 + a^2 v_3 + \\dots + a^{t-1} v_t \\equiv 0 \\pmod m \\right\\}$$\n这就是用 $a$ 和 $m$ 表示的对偶格的显式表达式。\n\n### 第3部分：针对 $(m,a,c)=(31,3,0)$ 在 $t=2$ 时的计算\n\n我们给定的参数是 $m=31$，$a=3$，和 $t=2$。我们要求解对偶格 $L_2^*$ 中最短非零向量的欧几里得范数。使用第2部分推导出的 $t=2$ 时的条件：\n$$L_2^* = \\left\\{ (v_1, v_2) \\in \\mathbb{Z}^2 \\mid v_1 + a v_2 \\equiv 0 \\pmod m \\right\\}$$\n代入给定值：\n$$v_1 + 3v_2 \\equiv 0 \\pmod{31}$$\n这个同余式意味着 $v_1$ 可以用 $v_2$ 和一个整数 $k$ 来表示：\n$$v_1 = -3v_2 + 31k, \\quad \\text{其中 } v_2, k \\in \\mathbb{Z}$$\n对偶格中的向量形式为 $\\mathbf{v} = (-3v_2 + 31k, v_2)$。我们希望找到这种向量的最小欧几里得范数，约束条件是 $\\mathbf{v} \\neq \\mathbf{0}$，这等价于 $(v_2, k) \\neq (0,0)$。\n\n欧几里得范数的平方是：\n$$||\\mathbf{v}||_2^2 = v_1^2 + v_2^2 = (-3v_2 + 31k)^2 + v_2^2$$\n我们现在寻找整数 $v_2$ 和 $k$ 来最小化这个正定二次型。让我们通过考虑 $k$ 的小整数值来分析这个表达式。\n\n情况 1: $k=0$。\n范数的平方变为 $||\\mathbf{v}||_2^2 = (-3v_2)^2 + v_2^2 = 9v_2^2 + v_2^2 = 10v_2^2$。\n为了找到最短的非零向量，我们取 $v_2$ 的最小非零整数绝对值，即 $|v_2|=1$。我们选择 $v_2=1$。这得到 $v_1 = -3(1) + 31(0) = -3$。向量是 $(-3, 1)$。\n范数的平方是 $||\\mathbf{v}||_2^2 = 10(1)^2 = 10$。\n\n情况 2: $k=1$。\n范数的平方是 $||\\mathbf{v}||_2^2 = (-3v_2 + 31)^2 + v_2^2 = 10v_2^2 - 186v_2 + 961$。\n这是关于 $v_2$ 的一个开口向上的抛物线。其最小值出现在 $v_2 = -(-186)/(2 \\cdot 10) = 9.3$。我们必须检查相邻的整数值，$v_2=9$ 和 $v_2=10$。\n如果 $v_2=9$：$v_1 = -3(9) + 31(1) = -27 + 31 = 4$。向量是 $(4, 9)$。\n$||\\mathbf{v}||_2^2 = 4^2 + 9^2 = 16 + 81 = 97$。\n如果 $v_2=10$：$v_1 = -3(10) + 31(1) = -30 + 31 = 1$。向量是 $(1, 10)$。\n$||\\mathbf{v}||_2^2 = 1^2 + 10^2 = 1 + 100 = 101$。\n对于 $k=1$，最小值为 $97$，大于 $10$。\n\n情况 3: $k=-1$。\n范数的平方是 $||\\mathbf{v}||_2^2 = (-3v_2 - 31)^2 + v_2^2 = 10v_2^2 + 186v_2 + 961$。\n最小值出现在 $v_2 = -186/20 = -9.3$。我们检查整数 $v_2=-9$ 和 $v_2=-10$。\n如果 $v_2=-9$：$v_1 = -3(-9) + 31(-1) = 27 - 31 = -4$。向量是 $(-4, -9)$。\n$||\\mathbf{v}||_2^2 = (-4)^2 + (-9)^2 = 16 + 81 = 97$。\n这个值也大于 $10$。\n\n对于 $|k| \\geq 2$，仅 $(31k)^2$ 这一项就至少是 $(31 \\times 2)^2 = 62^2 = 3844$，远大于 $10$。二次型 $10v_2^2 - 186kv_2 + 961k^2$ 的最小值下界约为 $96.1k^2$，它随 $k$ 迅速增长。很明显，更大绝对值的 $k$ 不会产生更小的范数。\n\n通过比较结果，最小范数平方是 $10$，由向量 $(\\mp 3, \\pm 1)$ 达到。对偶格中最短非零向量的欧几里得范数是这个值的平方根。\n$$\\nu_2 = \\min \\{ ||\\mathbf{v}||_2 \\mid \\mathbf{v} \\in L_2^*, \\mathbf{v} \\neq \\mathbf{0} \\} = \\sqrt{10}$$\n最终答案要求是一个精确的数值。", "answer": "$$\\boxed{\\sqrt{10}}$$", "id": "3318079"}, {"introduction": "理论上的理解固然重要，但亲眼见证一个劣质生成器的实际效果会更有说服力。这项练习将理论与计算统计学相结合，要求您编写代码来测试一个著名的劣质生成器。您将通过可视化方法，直观地确认谱检验旨在量化的平面晶格结构缺陷 [@problem_id:2442705]。", "problem": "您将实现并定量评估线性同余生成器谱检验的三维表现形式，重点关注三元组 $\\left(u_i,u_{i+1},u_{i+2}\\right)$ 是均匀填充单位立方体 $\\left[0,1\\right)^3$ 还是坍缩到少数几近平行的平面上。您的程序必须是一个完整的、可运行的实现，并能按如下规定生成单行输出。\n\n背景和基本原理：线性同余生成器 (LCG) 定义如下：\n$$\nx_{n+1} \\equiv (a x_n + c) \\;\\; \\mathrm{mod} \\;\\; m,\n\\quad\nu_n = \\frac{x_n}{m},\n$$\n其中 $m$ 为整数模数，$a$ 为乘数，$c$ 为增量，$x_0$ 为种子。如果 $u_n$ 是 $\\left[0,1\\right)$ 上的理想独立均匀分布随机变量，那么三元组 $\\left(u_i,u_{i+1},u_{i+2}\\right)$ 的点集应无可见结构地填充 $\\left[0,1\\right)^3$。然而，对于许多 LCG，由于其底层的格点结构，这些点会落在数量相对较少的平面上。$t$ 维谱检验通过检查对偶格中的短向量来评估此特性；在 $3$ 维中，这表现为检测点在平行平面上的分层现象。我们将通过将三元组投影到最小方差方向上，并对量化后所占用的不同层数进行计数来近似此检测。此外，我们将使用三维直方图上的皮尔逊卡方 ($\\chi^2$) 检验来交叉验证均匀填充性。\n\n您的任务：\n- 根据给定的 $(m,a,c,x_0)$ 从头开始实现一个 LCG 生成器，并生成 $N$ 个值 $u_n \\in [0,1)$。\n- 对于 $i=0,\\dots,N-3$，由连续三元组 $\\left(u_i,u_{i+1},u_{i+2}\\right)$ 构成三维点云。\n- 实现两种诊断方法：\n  1. 三维直方图上的皮尔逊卡方 ($\\chi^2$) 占用率检验：\n     - 将每个轴划分为 $B$ 个相等的区间（$B=8$），得到 $B^3$ 个体素。\n     - 设三元组数量为 $M=N-2$。在独立均匀填充的原假设下，每个体素的期望计数为 $E = M / B^3$。\n     - 计算统计量\n       $$\n       \\chi^2 = \\sum_{j=1}^{B^3} \\frac{(O_j - E)^2}{E},\n       $$\n       其中 $O_j$ 是体素 $j$ 中的观测计数。\n     - 使用自由度为 $\\nu = B^3 - 1$ 的卡方分布计算生存函数（即右尾概率，也就是 $p$ 值）。如果 $p$ 值小于 $\\alpha = 0.001$，则判定为直方图均匀性检验失败。\n  2. 近似谱检验的平面层占用分数：\n     - 将行向量为 $\\left(u_i,u_{i+1},u_{i+2}\\right)$ 的 $M \\times 3$ 数据矩阵 $P$ 通过减去列均值进行中心化，得到 $P_c$。\n     - 计算奇异值分解 $P_c = U \\Sigma V^\\top$。令 $v_3$ 为对应最小奇异值的右奇异向量（即最小方差方向）。\n     - 向该方向投影，得到标量序列 $t_i = (P_c v_3)_i$，其中 $i = 0,\\dots,M-1$。\n     - 使用 $t_i' = (t_i - \\min t)/(\\max t - \\min t)$ 将 $\\{t_i\\}$ 线性映射到区间 $\\left[0,1\\right]$。\n     - 将 $\\{t_i'\\}$ 量化到 $B_p = 256$ 个等距区间中，统计被占用的区间数 $K_\\mathrm{occ}$，如果 $K_\\mathrm{occ} \\leq P_\\mathrm{th}$ 且 $P_\\mathrm{th} = 32$，则判定为平面层检验失败。\n- 结合两种诊断方法做出最终判定：如果直方图均匀性检验失败或平面层检验失败，则判定该生成器未能均匀填充立方体。\n\n测试套件：\n为以下由 $(m,a,c,x_0,N)$ 指定的各种情况提供结果：\n- 情况 1 (已知的差三维生成器): $m = 2^{31}, a = 65539, c = 0, x_0 = 1, N = 50000$。\n- 情况 2 (最小标准乘法生成器，在低维下通常表现良好): $m = 2^{31} - 1, a = 16807, c = 0, x_0 = 1, N = 50000$。\n- 情况 3 (故意使用小模数，高度退化): $m = 2^{16}, a = 109, c = 0, x_0 = 1, N = 50000$。\n- 情况 4 (流行的 32 位 LCG，样本量较小): $m = 2^{32}, a = 1664525, c = 1013904223, x_0 = 12345, N = 8192$。\n\n答案规格：\n- 对于每种情况，您的程序必须输出一个布尔值，指示生成器是否根据上述组合标准判定为失败（布尔值 True 表示“失败”，布尔值 False 表示“通过”）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果顺序与上面列出的情况顺序一致（例如 $\\left[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4\\right]$）。\n- 不涉及物理单位或角度。不要打印任何额外文本。\n\n科学真实性、原理和约束：\n- 基于 LCG 的定义、独立均匀变量的概念，以及公认的带有卡方分布的皮尔逊卡方检验进行构建。\n- 平面层占用率是对三维谱检验的一种有原则的近似：如果三元组 $\\left(u_i,u_{i+1},u_{i+2}\\right)$ 落在少数平行平面上，沿法线方向的投影会将数据坍缩到少数几个量化层中，从而使 $K_\\mathrm{occ}$ 变小。\n- 对于所有情况，均需严格使用上述指定的参数值：$\\alpha = 0.001$, $B = 8$, $B^3 = 512$, $B_p = 256$ 和 $P_\\mathrm{th} = 32$。", "solution": "用户已提交一个问题以供验证和求解。\n\n### 步骤 1：提取给定信息\n\n问题陈述提供了以下定义、参数和程序：\n\n1.  **线性同余生成器 (LCG) 定义**：\n    - 递推关系：$x_{n+1} \\equiv (a x_n + c) \\pmod m$\n    - 归一化输出：$u_n = x_n / m$\n    - 参数：模数 $m$，乘数 $a$，增量 $c$，种子 $x_0$。\n\n2.  **点云构成**：\n    - 对于 $i=0, \\dots, N-3$，构成三元组 $(u_i, u_{i+1}, u_{i+2})$。\n    - 三元组总数为 $M = N-2$。\n\n3.  **诊断方法 1：皮尔逊卡方 ($\\chi^2$) 检验**：\n    - 将单位立方体 $[0,1)^3$ 划分为 $B^3$ 个体素。\n    - 每轴区间数：$B = 8$。总体素数：$B^3 = 512$。\n    - 每体素期望计数：$E = M / B^3$。\n    - 卡方统计量：$\\chi^2 = \\sum_{j=1}^{B^3} \\frac{(O_j - E)^2}{E}$，其中 $O_j$ 为体素 $j$ 中的观测计数。\n    - 自由度：$\\nu = B^3 - 1 = 511$。\n    - 失败条件：p 值（$\\chi^2$ 分布的生存函数）小于显著性水平 $\\alpha = 0.001$。\n\n4.  **诊断方法 2：平面层占用分数**：\n    - 将三元组构成的 $M \\times 3$ 数据矩阵 $P$ 中心化得到 $P_c$。\n    - 计算奇异值分解 (SVD): $P_c = U \\Sigma V^\\top$。\n    - 确定最小方差方向 $v_3$，即对应最小奇异值的右奇异向量。\n    - 将中心化后的数据投影到该方向上：$t_i = (P_c v_3)_i$。\n    - 将投影归一化：$t_i' = (t_i - \\min t)/(\\max t - \\min t)$，将其映射到 $[0,1]$。\n    - 将 $\\{t_i'\\}$ 量化到 $B_p = 256$ 个区间中。\n    - 统计被占用的区间数 $K_\\mathrm{occ}$。\n    - 失败条件：$K_\\mathrm{occ} \\leq P_\\mathrm{th}$，其中阈值为 $P_\\mathrm{th} = 32$。\n\n5.  **组合失败判据**：\n    - 如果 $\\chi^2$ 检验失败或平面层检验失败，则生成器判定为失败。\n\n6.  **测试用例** (指定为 $(m, a, c, x_0, N)$):\n    - 情况 1: $(2^{31}, 65539, 0, 1, 50000)$\n    - 情况 2: $(2^{31} - 1, 16807, 0, 1, 50000)$\n    - 情况 3: $(2^{16}, 109, 0, 1, 50000)$\n    - 情况 4: $(2^{32}, 1664525, 1013904223, 12345, 8192)$\n\n### 步骤 2：使用提取的给定信息进行验证\n\n根据指定标准对问题进行验证。\n\n-   **科学性**：该问题坚实地植根于计算物理学和统计学。线性同余生成器、皮尔逊 $\\chi^2$ 检验和谱检验都是标准且成熟的课题。平面层占用分数是谱检验背后原理的直接且实用的实现，它使用奇异值分解来寻找最小方差方向——这是主成分分析中的一种标准技术。该问题科学合理，不含伪科学。\n\n-   **适定性**：该问题是适定的。所有参数（$m, a, c, x_0, N$）、常数（$B, \\alpha, B_p, P_\\mathrm{th}$）和方法论都有明确定义。任务是为四个不同情况中的每一个计算一个布尔结果，这使得解唯一且稳定。\n\n-   **客观性**：语言精确、数学化且算法化，不含主观性或个人观点。\n\n-   **不完整或矛盾的设置**：该问题是自包含的。它提供了进行计算求解所需的所有必要信息。所提供的数据或约束中没有矛盾之处。\n\n-   **不切实际或不可行**：所需的计算在标准硬件上是可行的。LCG 的参数代表了科学文献和实践中常见的生成器。点数 $N$ 足够大以保证统计显著性，但又足够小以实现高效计算。\n\n-   **不适定或结构不良**：该问题结构逻辑清晰，引导用户从数据生成到应用两种不同的检验，并得出最终的综合结论。术语定义明确。\n\n-   **超出科学可验证性**：结果是计算上确定且可验证的。遵循相同规范的独立实现应产生相同的结果。\n\n### 步骤 3：结论与行动\n\n该问题是**有效的**。它科学合理、适定、客观且计算上易于处理。我将继续提供完整的解决方案。\n\n### 解决方案\n\n目标是通过测试连续三元组 $(u_i, u_{i+1}, u_{i+2})$ 构成的点云是否均匀填充三维单位立方体，来评估四个特定线性同余生成器（LCG）的质量。这通过两种定量检验来完成：一种是用于体积占用率的皮尔逊 $\\chi^2$ 检验，另一种是基于平面坍缩的近似谱检验。\n\n**步骤 1：LCG 序列生成**\n首先，对于由参数 $(m, a, c, x_0)$ 定义的每种情况，我们使用递推关系 $x_{n+1} \\equiv (a x_n + c) \\pmod m$ 生成一个包含 $N$ 个整数的序列 $\\{x_n\\}_{n=0}^{N-1}$。初始值为 $x_0$。至关重要的是，要使用足够大的整数类型（例如 64 位整数或 Python 的任意精度整数）来执行中间计算 $a \\cdot x_n$，以防止溢出，因为在几种情况下，该乘积可能超过 32 位整数的容量，而模数 $m$ 正是这个数量级。然后，通过变换 $u_n = x_n / m$ 将整数序列归一化为 $[0,1)$ 区间内的浮点数。\n\n**步骤 2：构成三维点云**\n从序列 $\\{u_n\\}_{n=0}^{N-1}$ 中，我们为 $i = 0, \\dots, N-3$ 构建 $M = N-2$ 个重叠的三元组 $p_i = (u_i, u_{i+1}, u_{i+2})$。这 $M$ 个点在单位立方体 $[0,1)^3$ 中形成一个点云。出于计算目的，它们被排列成一个 $M \\times 3$ 的矩阵 $P$。\n\n**步骤 3：检验 1 - 皮尔逊 $\\chi^2$ 拟合优度检验**\n此检验评估原假设 $H_0$，即三元组从单位立方体上的均匀分布中抽取。\n1.  将立方体划分为 $B^3$ 个不相交的体素网格，其中 $B=8$。这得到 $8^3 = 512$ 个体素。\n2.  对落入每个体素 $j$ 的点数 $O_j$ 进行计数。这通过计算点云 $P$ 的三维直方图来实现。\n3.  在 $H_0$ 假设下，任何给定体素中的期望点数是均匀的：$E = M / B^3 = (N-2) / 512$。\n4.  $\\chi^2$ 统计量计算为观测计数与期望计数之间平方归一化偏差的总和：\n    $$\n    \\chi^2 = \\sum_{j=1}^{B^3} \\frac{(O_j - E)^2}{E}\n    $$\n5.  如果 $H_0$ 为真，该统计量近似服从自由度为 $\\nu = B^3 - 1 = 511$ 的卡方分布。我们计算 $p$ 值，即假设 $H_0$ 为真时，观测到等于或大于实测 $\\chi^2$ 值的概率。这对应于分布的生存函数，$p = P(\\chi^2_\\nu \\geq \\chi^2_\\mathrm{observed})$。\n6.  如果此 $p$ 值低于指定的显著性水平 $\\alpha = 0.001$，则检验被判定为“失败”。小的 $p$ 值表明观测到的点分布与均匀分布有显著差异。\n\n**步骤 4：检验 2 - 平面层占用分数**\n此检验是谱检验的一种实用近似，旨在检测点是否局限于少数平行平面上（这是 LCG 的一种典型失效模式），而不是填充整个空间。\n1.  通过减去每个坐标的均值来中心化点云，得到矩阵 $P_c = P - \\bar{P}$，其中 $\\bar{P}$ 包含 $P$ 的列均值。\n2.  我们对中心化数据矩阵执行奇异值分解 (SVD)：$P_c = U \\Sigma V^\\top$。$V$ 的列（或 $V^\\top$ 的行）代表点云分布的主轴。对角矩阵 $\\Sigma$ 中的相应奇异值与数据沿这些轴的标准差成正比。\n3.  数据中方差最小的方向由对应于最小奇异值的主轴给出。这个向量记为 $v_3$，是 $V$ 的最后一列（或 $V^\\top$ 的最后一行）。如果点位于平面上，则此方向将大致垂直于这些平面。\n4.  通过计算点积 $t = P_c v_3$ 将中心化数据点投影到此方向上。这将三维数据坍缩为一维标量值序列。\n5.  使用变换 $t'_i = (t_i - \\min(t)) / (\\max(t) - \\min(t))$ 将这些标量投影 $\\{t_i\\}$ 线性缩放到 $[0,1]$ 区间。\n6.  将缩放后的投影 $\\{t'_i\\}$ 量化为 $B_p = 256$ 个区间。然后我们统计非空区间的数量，称之为占用层数 $K_\\mathrm{occ}$。\n7.  如果原始点局限于少数平面上，它们的投影将聚集在少数几个位置。如果 $K_\\mathrm{occ}$ 小于或等于阈值 $P_\\mathrm{th} = 32$，则检验被判定为“失败”。\n\n**步骤 5：最终评估**\n对于四个测试用例中的每一个，都执行这两种检验。如果满足条件（`chi2_fails` 或 `plane_fails`），则判定生成器未能均匀填充单位立方体（结果为 `True`）。否则，它通过检验（结果为 `False`）。然后按顺序报告这四种情况的布尔结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2\n\ndef solve():\n    \"\"\"\n    Main function to run the LCG tests and print the final results.\n    \"\"\"\n    \n    # Test cases defined as (m, a, c, x0, N)\n    test_cases = [\n        # Case 1: RANDU, known bad 3D generator\n        {'m': 2**31, 'a': 65539, 'c': 0, 'x0': 1, 'N': 50000},\n        # Case 2: Park-Miller (MINSTD), generally good in low dimensions\n        {'m': 2**31 - 1, 'a': 16807, 'c': 0, 'x0': 1, 'N': 50000},\n        # Case 3: Small modulus, highly degenerate\n        {'m': 2**16, 'a': 109, 'c': 0, 'x0': 1, 'N': 50000},\n        # Case 4: Numerical Recipes LCG, smaller sample size\n        {'m': 2**32, 'a': 1664525, 'c': 1013904223, 'x0': 12345, 'N': 8192},\n    ]\n    \n    # Test parameters\n    params = {\n        'B': 8,           # Number of bins per axis for Chi-square test\n        'alpha': 0.001,   # Significance level for Chi-square p-value\n        'Bp': 256,        # Number of bins for plane-layer test\n        'P_th': 32        # Occupied bin threshold for plane-layer test\n    }\n    \n    results = []\n    for case in test_cases:\n        fails = run_lcg_test(case['m'], case['a'], case['c'], case['x0'], case['N'], params)\n        results.append(fails)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_lcg_test(m, a, c, x0, N, params):\n    \"\"\"\n    Performs the full LCG quality analysis for a single case.\n    \n    Returns:\n        bool: True if the generator fails, False otherwise.\n    \"\"\"\n    # Step 1: Generate LCG sequence\n    # Use Python's arbitrary-precision integers to avoid overflow during generation\n    x_seq = [0] * N\n    x_seq[0] = x0\n    for i in range(N - 1):\n        x_seq[i+1] = (a * x_seq[i] + c) % m\n    \n    u = np.array(x_seq, dtype=np.float64) / m\n    \n    # Step 2: Form 3D point cloud\n    M = N - 2\n    if M = 0:\n        # Not enough points to form even one triplet\n        return True # Fails by default if not enough data\n        \n    # Create triplets (u_i, u_{i+1}, u_{i+2})\n    P = np.stack((u[:-2], u[1:-1], u[2:]), axis=1)\n\n    # Step 3: Pearson Chi-Square Test\n    B = params['B']\n    alpha = params['alpha']\n    \n    observed_counts, _ = np.histogramdd(\n        P, bins=B, range=((0, 1), (0, 1), (0, 1))\n    )\n    \n    B_cubed = B**3\n    expected_count = M / B_cubed\n    \n    # Calculate Chi-square statistic\n    # Use where to avoid division by zero if expected_count is zero\n    chi2_stat = np.sum(\n        np.divide((observed_counts - expected_count)**2, expected_count, \n                  out=np.zeros_like(observed_counts, dtype=np.float64), \n                  where=expected_count!=0)\n    )\n    \n    dof = B_cubed - 1\n    p_value = chi2.sf(chi2_stat, dof)\n    \n    chi2_fails = p_value  alpha\n\n    # Step 4: Plane-Layer Occupancy Score\n    Bp = params['Bp']\n    P_th = params['P_th']\n    \n    # Center the data\n    P_c = P - np.mean(P, axis=0)\n    \n    # Compute SVD. We only need Vh (V transpose).\n    try:\n        _, _, Vh = np.linalg.svd(P_c, full_matrices=False)\n    except np.linalg.LinAlgError:\n        # SVD can fail if the matrix is degenerate, e.g., all points are identical.\n        # This is a catastrophic failure of the generator.\n        return True\n\n    # Direction of minimal variance is the last row of Vh\n    v3 = Vh[-1, :]\n    \n    # Project data onto this direction\n    t = P_c @ v3\n    \n    # Handle case where t has zero range (all projections are identical)\n    t_min, t_max = t.min(), t.max()\n    if t_max == t_min:\n        K_occ = 1\n    else:\n        # Normalize projections to [0, 1]\n        t_prime = (t - t_min) / (t_max - t_min)\n        \n        # Quantize and count occupied bins\n        # np.histogram is robust for this task\n        counts, _ = np.histogram(t_prime, bins=Bp, range=(0, 1))\n        K_occ = np.count_nonzero(counts)\n    \n    plane_fails = K_occ = P_th\n\n    # Step 5: Combined Decision\n    return chi2_fails or plane_fails\n\nsolve()\n```", "id": "2442705"}]}