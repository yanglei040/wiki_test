{"hands_on_practices": [{"introduction": "在实现Metropolis-Hastings算法时，正确计算接受概率是核心步骤。这个练习将带你处理一个带有非对称提议分布的实际场景，并强调在面对可能导致下溢的极大或极小对数后验值时，保持数值稳定性的重要性。通过这个实践[@problem_id:3355587]，你将掌握在对数尺度上稳健地计算接受概率的基本技能。", "problem": "考虑一个 Metropolis-Hastings (MH) 步骤，其目标是 $\\mathbb{R}^{2}$ 上的一个未归一化概率密度，形式为 $\\pi(\\theta) \\propto \\exp(\\ell(\\theta))$，其中 $\\ell(\\theta)$ 是对数后验。当前状态为 $x = (2.0,\\, 0.5)$，提议状态为 $y = (2.1,\\, 0.55)$。对数后验值（这些值汇总了大量数据贡献）如下：\n$$\n\\ell(x) \\;=\\; -1.357913942 \\times 10^{6}, \n\\qquad\n\\ell(y) \\;=\\; -1.357919942 \\times 10^{6}.\n$$\n该提议是一个具有固定尺度参数 $\\sigma_{1} > 0$ 和 $\\sigma_{2} > 0$ 的独立分量乘性对数正态随机游走：\n$$\nq(y \\mid x) \\;=\\; \\prod_{i=1}^{2} \\left[ \\frac{1}{y_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}} \\; \\exp\\!\\left( -\\frac{\\left(\\ln y_{i} - \\ln x_{i}\\right)^{2}}{2\\sigma_{i}^{2}} \\right) \\right].\n$$\n仅使用基本的马尔可夫链蒙特卡洛原理和定义，以数值稳定的方式计算从 $x$ 移动到 $y$ 的 Metropolis-Hastings 接受概率。您的计算不得单独对 $\\ell(x)$ 或 $\\ell(y)$ 进行指数运算。将最终数值答案四舍五入至六位有效数字。", "solution": "用户在马尔可夫链蒙特卡洛方法领域提供了一个适定问题。所有给定条件都是一致的，并且足以得到唯一解。该问题具有科学依据且客观。因此，我将提供完整的解题过程。\n\nMetropolis-Hastings (MH) 算法的基本原理是细致平衡条件，它确保所生成的马尔可夫链以目标分布 $\\pi(\\theta)$ 作为其平稳分布。从当前状态 $x$ 移动到新状态 $y$ 的提议的接受概率 $\\alpha(y \\mid x)$ 被定义为满足此条件。接受概率的公式为：\n$$\n\\alpha(y \\mid x) = \\min\\left(1, A(y \\mid x)\\right)\n$$\n其中 $A(y \\mid x)$ 是 Metropolis-Hastings 接受率，由下式给出：\n$$\nA(y \\mid x) = \\frac{\\pi(y) \\, q(x \\mid y)}{\\pi(x) \\, q(y \\mid x)}\n$$\n在这里，$\\pi(\\cdot)$ 是目标概率密度，而 $q(\\cdot \\mid \\cdot)$ 是提议（或转移）密度。\n\n问题陈述目标密度是一个未归一化的后验，形式为 $\\pi(\\theta) \\propto \\exp(\\ell(\\theta))$，其中 $\\ell(\\theta)$ 是对数后验。因此，在状态 $y$ 和 $x$ 处的目标密度之比为：\n$$\n\\frac{\\pi(y)}{\\pi(x)} = \\frac{C \\exp(\\ell(y))}{C \\exp(\\ell(x))} = \\exp(\\ell(y) - \\ell(x))\n$$\n其中 $C$ 是未知的归一化常数，它被抵消了。\n\n接下来，我们必须确定提议密度之比 $\\frac{q(x \\mid y)}{q(y \\mid x)}$，这被称为 Hastings 修正因子。提议密度由下式给出：\n$$\nq(y \\mid x) = \\prod_{i=1}^{2} \\left[ \\frac{1}{y_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}} \\; \\exp\\!\\left( -\\frac{\\left(\\ln y_{i} - \\ln x_{i}\\right)^{2}}{2\\sigma_{i}^{2}} \\right) \\right]\n$$\n这描述了一个过程，其中新状态 $y=(y_1, y_2)$ 是从 $x=(x_1, x_2)$ 生成的，具体方法是从均值为 $\\ln x_i$、标准差为 $\\sigma_i$ 的正态分布中抽取 $\\ln y_i$。\n\n为了求得 $q(x \\mid y)$，我们只需在 $q(y \\mid x)$ 的表达式中交换 $x$ 和 $y$ 的角色：\n$$\nq(x \\mid y) = \\prod_{i=1}^{2} \\left[ \\frac{1}{x_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}} \\; \\exp\\!\\left( -\\frac{\\left(\\ln x_{i} - \\ln y_{i}\\right)^{2}}{2\\sigma_{i}^{2}} \\right) \\right]\n$$\n现在，我们可以计算这个比率。我们观察到指数中的平方项是对称的：$(\\ln x_i - \\ln y_i)^2 = (-( \\ln y_i - \\ln x_i))^2 = (\\ln y_i - \\ln x_i)^2$。因此，密度的指数部分是相同的，在比率中被抵消。\n\\begin{align*}\n\\frac{q(x \\mid y)}{q(y \\mid x)} = \\frac{\\displaystyle\\prod_{i=1}^{2} \\left[ \\frac{1}{x_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}} \\; \\exp\\!\\left( -\\frac{\\left(\\ln x_{i} - \\ln y_{i}\\right)^{2}}{2\\sigma_{i}^{2}} \\right) \\right]}{\\displaystyle\\prod_{i=1}^{2} \\left[ \\frac{1}{y_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}} \\; \\exp\\!\\left( -\\frac{\\left(\\ln y_{i} - \\ln x_{i}\\right)^{2}}{2\\sigma_{i}^{2}} \\right) \\right]} \\\\\n= \\frac{\\displaystyle\\prod_{i=1}^{2} \\frac{1}{x_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}}}{\\displaystyle\\prod_{i=1}^{2} \\frac{1}{y_{i}\\,\\sigma_{i}\\,\\sqrt{2\\pi}}} \\\\\n= \\frac{\\frac{1}{(x_1 \\sigma_1 \\sqrt{2\\pi})(x_2 \\sigma_2 \\sqrt{2\\pi})}}{\\frac{1}{(y_1 \\sigma_1 \\sqrt{2\\pi})(y_2 \\sigma_2 \\sqrt{2\\pi})}} \\\\\n= \\frac{y_1 y_2 \\sigma_1 \\sigma_2 (2\\pi)}{x_1 x_2 \\sigma_1 \\sigma_2 (2\\pi)} \\\\\n= \\frac{y_1 y_2}{x_1 x_2}\n\\end{align*}\n请注意，未知的尺度参数 $\\sigma_1$ 和 $\\sigma_2$ 已被抵消，因此计算中不需要它们的值。\n\n现在我们可以组合出完整的接受率 $A(y \\mid x)$：\n$$\nA(y \\mid x) = \\frac{\\pi(y)}{\\pi(x)} \\cdot \\frac{q(x \\mid y)}{q(y \\mid x)} = \\exp(\\ell(y) - \\ell(x)) \\cdot \\frac{y_1 y_2}{x_1 x_2}\n$$\n问题要求进行数值稳定的计算，特别禁止对 $\\ell(x)$ 和 $\\ell(y)$ 进行单独的指数运算。这些对数后验的巨大负值会在任何标准的浮点运算中导致 $\\exp(\\ell(x))$ 和 $\\exp(\\ell(y))$ 下溢为零。我们对 $A(y \\mid x)$ 的表达式通过首先计算差值 $\\ell(y) - \\ell(x)$ 来正确地避免了这个问题。\n\n计算 $\\alpha$ 的最稳定方法是首先计算接受率的对数：\n$$\n\\ln A(y \\mid x) = \\ln\\left( \\exp(\\ell(y) - \\ell(x)) \\cdot \\frac{y_1 y_2}{x_1 x_2} \\right) = (\\ell(y) - \\ell(x)) + \\ln\\left(\\frac{y_1 y_2}{x_1 x_2}\\right)\n$$\n然后，接受概率为 $\\alpha(y \\mid x) = \\min(1, \\exp(\\ln A(y \\mid x)))$。\n\n让我们代入给定的数值：\n当前状态： $x = (x_1, x_2) = (2.0, 0.5)$。\n提议状态： $y = (y_1, y_2) = (2.1, 0.55)$。\n对数后验值：\n$\\ell(x) = -1.357913942 \\times 10^{6}$\n$\\ell(y) = -1.357919942 \\times 10^{6}$\n\n首先，我们计算对数后验的差值：\n$$\n\\ell(y) - \\ell(x) = (-1.357919942 \\times 10^{6}) - (-1.357913942 \\times 10^{6}) = -0.000006000 \\times 10^{6} = -6.0\n$$\n接下来，我们计算 Hastings 修正因子的对数：\n$$\n\\ln\\left(\\frac{y_1 y_2}{x_1 x_2}\\right) = \\ln\\left(\\frac{2.1 \\times 0.55}{2.0 \\times 0.5}\\right) = \\ln\\left(\\frac{1.155}{1.0}\\right) = \\ln(1.155)\n$$\n使用标准计算器，$\\ln(1.155) \\approx 0.1441003433$。\n\n现在我们计算 $\\ln A(y \\mid x)$：\n$$\n\\ln A(y \\mid x) = -6.0 + \\ln(1.155) \\approx -6.0 + 0.1441003433 = -5.8558996567\n$$\n由于 $\\ln A(y \\mid x)$ 是负数，其指数 $A(y \\mid x)$ 将小于 1。因此，接受概率为：\n$$\n\\alpha(y \\mid x) = A(y \\mid x) = \\exp(\\ln A(y \\mid x))\n$$\n$$\n\\alpha(y \\mid x) \\approx \\exp(-5.8558996567) \\approx 0.0028631168\n$$\n问题要求将答案四舍五入到六位有效数字。前六位有效数字是 $2, 8, 6, 3, 1, 1$。第七位数字是 $6$，所以我们将第六位数字向上取整。\n$$\n\\alpha(y \\mid x) \\approx 0.00286312\n$$\n这也可以表示为 $2.86312 \\times 10^{-3}$。", "answer": "$$\n\\boxed{0.00286312}\n$$", "id": "3355587"}, {"introduction": "许多实际的统计模型要求参数存在于一个有约束的集合中，例如概率值必须在 $[0,1]$ 区间内。这个练习探讨了一种在约束空间上构建MH采样器的常用方法：高斯游走加投影，并揭示了为什么需要一个经过修正的接受概率来维持细致平衡。通过处理这个混合测度（包含连续密度和边界上的点质量）上的目标[@problem_id:3355557]，你将更深刻地理解支配测度在维持算法正确性中的关键作用。", "problem": "考虑一个目标概率测度 $\\pi$，其支撑集为凸集 $\\mathcal{C} = [0,1]$。该目标是 $(0,1)$ 上一个连续分量和边界上原子测度的混合：在 $0$ 处的权重为 $w_{0} = \\frac{1}{10}$，在 $1$ 处的权重为 $w_{1} = \\frac{1}{5}$，以及连续权重 $w_{c} = 1 - w_{0} - w_{1} = \\frac{7}{10}$ 根据概率密度函数 (pdf) $f(x) = 6 x (1 - x)$ (其中 $x \\in (0,1)$) 分布在 $(0,1)$ 上。因此，$\\pi$ 是 $[0,1]$ 上的一个概率测度，其关于混合支配测度 $\\mu = \\lambda|_{(0,1)} + \\nu_{\\{0,1\\}}$（勒贝格测度 $\\lambda$ 限制在 $(0,1)$ 上，加上 $\\{0,1\\}$ 上的计数测度 $\\nu$）的拉东-尼科迪姆导数为：当 $x \\in (0,1)$ 时，$\\pi(x) = w_{c} f(x)$；$\\pi(0) = w_{0}$；以及 $\\pi(1) = w_{1}$。\n\n通过首先进行一个高斯步长 $\\eta \\sim \\mathcal{N}(0, \\sigma^{2})$，然后使用欧几里得投影 $\\Pi_{\\mathcal{C}}$ 将其投影到约束集上，来构造一个 Metropolis-Hastings (MH) 提议。因此，在一维情况下，$y = \\Pi_{\\mathcal{C}}(x + \\eta) = \\min\\{\\max\\{x + \\eta, 0\\}, 1\\}$。由此产生的提议分布 $q(\\cdot \\mid x)$ 是 $[0,1]$ 上的一个混合测度，它在 $(0,1)$ 上有一个连续密度，并在 $\\{0,1\\}$ 处有由越界提议的投影引起的非零点质量。令 $\\varphi(z) = \\frac{1}{\\sqrt{2 \\pi}} \\exp\\!\\left(-\\frac{z^{2}}{2}\\right)$ 表示标准正态概率密度函数 (pdf)，并令 $\\Phi(z)$ 表示其累积分布函数 (cdf)。对于 $y \\in (0,1)$，有 $q(y \\mid x) = \\frac{1}{\\sigma} \\varphi\\!\\left(\\frac{y - x}{\\sigma}\\right)$，而 $q(0 \\mid x) = \\Phi\\!\\left(\\frac{-x}{\\sigma}\\right)$ 且 $q(1 \\mid x) = 1 - \\Phi\\!\\left(\\frac{1 - x}{\\sigma}\\right)$。\n\n从马尔可夫链的细致平衡原则出发，推导此投影提议的修正后 Metropolis–Hastings 接受概率 $\\alpha(x, y)$，并明确说明 $(0,1)$ 上的连续密度和边界 $\\{0,1\\}$ 上的原子质量所扮演的角色。解释支配测度的选择如何决定接受率的形式，并阐明由投影引起的边界质量对可逆性的影响。\n\n然后，进行一个具体计算，取 $\\sigma = 0.2$，当前状态 $x = \\frac{1}{2}$，提议状态 $y = \\frac{1}{10}$（注意两者都位于 $(0,1)$ 内）。计算此内部移动的 Metropolis–Hastings 接受概率 $\\alpha\\!\\left(\\frac{1}{2}, \\frac{1}{10}\\right)$。将最终数值答案四舍五入到四位有效数字，并报告该值，不带单位。", "solution": "此问题有效。它提出了计算统计学领域中一个适定性问题，具体涉及在约束混合状态空间上的 Metropolis-Hastings 算法。所有提供的信息在科学上都是合理的、内部一致的，并且足以推導所要求的理论解释和执行具体的计算。\n\nMetropolis-Hastings (MH) 算法的核心原则是细致平衡条件，它确保目标概率测度 $\\pi$ 是所构造的马尔可夫链的平稳分布。对于一个转移核为 $P(x, \\cdot)$ 的链，关于 $\\pi$ 的细致平衡条件陈述为：对于任意两个可测集 $A$ 和 $B$，$\\int_A \\pi(dx) P(x, B) = \\int_B \\pi(dy) P(y, A)$。\n\n为了使用密度，我们必须引入一个支配测度 $\\mu$。问题正确地指出了混合目标分布所需的支配测度为 $\\mu = \\lambda|_{(0,1)} + \\nu_{\\{0,1\\}}$，即开区间 $(0,1)$ 上的勒贝格测度与边界点 $\\{0,1\\}$ 上的计数测度之和。$\\pi$ 关于 $\\mu$ 的拉东-尼科迪姆导数（我们遵循问题的约定，简记为 $\\pi(x)$）为：\n$$\n\\pi(x) =\n\\begin{cases}\nw_0 = \\frac{1}{10}   \\text{若 } x=0 \\\\\nw_1 = \\frac{1}{5}   \\text{若 } x=1 \\\\\nw_c f(x) = \\frac{7}{10} \\cdot 6x(1-x) = \\frac{21}{5}x(1-x)   \\text{若 } x \\in (0,1)\n\\end{cases}\n$$\nMH 转移核 $P(x, dy)$ 由一个提议步骤和一个接受/拒绝步骤组成。对于 $x \\neq y$，转移核关于 $\\mu$ 的密度为 $p(x, y) = q(y|x) \\alpha(x,y)$，其中 $q(y|x)$ 是提议分布关于 $\\mu$ 的密度，$\\alpha(x,y)$ 是接受概率。细致平衡条件可以写成关于这些密度的形式：\n$$\n\\pi(x) q(y|x) \\alpha(x,y) = \\pi(y) q(x|y) \\alpha(y,x)\n$$\n满足此方程的接受概率的标准解是：\n$$\n\\alpha(x,y) = \\min\\left\\{1, \\frac{\\pi(y) q(x|y)}{\\pi(x) q(y|x)}\\right\\}\n$$\n这个通用公式适用于任何状态空间（连续、离散或混合），只要密度 $\\pi(\\cdot)$ 和 $q(\\cdot|\\cdot)$ 是相对于同一个支配测度 $\\mu$ 定义的。提议密度 $q(y|x)$ 关于 $\\mu$ 的表达式为：\n$$\nq(y|x) =\n\\begin{cases}\nq(0|x) = \\Phi\\left(\\frac{-x}{\\sigma}\\right)   \\text{若 } y=0 \\\\\nq(1|x) = 1 - \\Phi\\left(\\frac{1-x}{\\sigma}\\right)   \\text{若 } y=1 \\\\\n\\frac{1}{\\sigma}\\varphi\\left(\\frac{y-x}{\\sigma}\\right)   \\text{若 } y \\in (0,1)\n\\end{cases}\n$$\n支配测度 $\\mu$ 的作用是提供一个统一的框架来处理状态空间的连续和离散部分。通过相对于 $\\mu$ 定义密度，MH 接受率保持其标准形式，正确地平衡了连续状态和离散状态之间的概率流。由投影引起的边界质量被 $q(0|x)$ 和 $q(1|x)$ 这两项明确地捕捉到，它们表示从 $x$ 出发的一个提议高斯步长落在区间 $[0,1]$ 之外并被投影到相应边界点的概率。这些项对于维持可逆性至关重要。例如，对于从 $x \\in (0,1)$ 到边界点 $y=0$ 的移动，接受率正确地包含了离散质量 $\\pi(0)$ 和积分提议概率 $q(0|x)$。\n\n我们被要求计算从 $x = \\frac{1}{2}$ 到 $y = \\frac{1}{10}$ 的特定移动的接受概率。由于 $x$ 和 $y$ 都在区间 $(0,1)$ 的内部，我们处理的是连续到连续的转移情况。\n对于 $x, y \\in (0,1)$，相关的密度为：\n$\\pi(x) = w_c f(x)$\n$\\pi(y) = w_c f(y)$\n$q(y|x) = \\frac{1}{\\sigma}\\varphi\\left(\\frac{y-x}{\\sigma}\\right)$\n$q(x|y) = \\frac{1}{\\sigma}\\varphi\\left(\\frac{x-y}{\\sigma}\\right)$\n\n接受率 $R(x,y)$ 为：\n$$\nR(x,y) = \\frac{\\pi(y) q(x|y)}{\\pi(x) q(y|x)} = \\frac{w_c f(y) \\cdot \\frac{1}{\\sigma}\\varphi\\left(\\frac{x-y}{\\sigma}\\right)}{w_c f(x) \\cdot \\frac{1}{\\sigma}\\varphi\\left(\\frac{y-x}{\\sigma}\\right)}\n$$\n标准正态概率密度函数 $\\varphi(z)$ 是一个偶函数，即 $\\varphi(z) = \\varphi(-z)$。因此，$\\varphi\\left(\\frac{x-y}{\\sigma}\\right) = \\varphi\\left(-\\frac{y-x}{\\sigma}\\right) = \\varphi\\left(\\frac{y-x}{\\sigma}\\right)$。\n提议比率简化为 $1$：\n$$\n\\frac{q(x|y)}{q(y|x)} = 1\n$$\n这是对称提议的一個特征，它将 Metropolis-Hastings 算法简化为此类移动的更简单的 Metropolis 算法。接受率变为：\n$$\nR(x,y) = \\frac{f(y)}{f(x)}\n$$\n而接受概率为：\n$$\n\\alpha(x,y) = \\min\\left\\{1, \\frac{f(y)}{f(x)}\\right\\}\n$$\n现在我们用给定的值进行具体计算：\n当前状态：$x = \\frac{1}{2} = 0.5$\n提议状态：$y = \\frac{1}{10} = 0.1$\n密度函数为 $f(z) = 6z(1-z)$。\n\n首先，我们计算 $f(x)$：\n$$\nf\\left(\\frac{1}{2}\\right) = 6 \\cdot \\frac{1}{2} \\cdot \\left(1 - \\frac{1}{2}\\right) = 6 \\cdot \\frac{1}{2} \\cdot \\frac{1}{2} = \\frac{6}{4} = \\frac{3}{2} = 1.5\n$$\n接着，我们计算 $f(y)$：\n$$\nf\\left(\\frac{1}{10}\\right) = 6 \\cdot \\frac{1}{10} \\cdot \\left(1 - \\frac{1}{10}\\right) = 6 \\cdot \\frac{1}{10} \\cdot \\frac{9}{10} = \\frac{54}{100} = 0.54\n$$\n比率为：\n$$\n\\frac{f(y)}{f(x)} = \\frac{0.54}{1.5} = \\frac{54/100}{3/2} = \\frac{54}{100} \\cdot \\frac{2}{3} = \\frac{18}{50} = \\frac{9}{25} = 0.36\n$$\n最后，接受概率为：\n$$\n\\alpha\\left(\\frac{1}{2}, \\frac{1}{10}\\right) = \\min\\left\\{1, 0.36\\right\\} = 0.36\n$$\n问题要求答案四舍五入到四位有效数字，即 $0.3600$。", "answer": "$$\n\\boxed{0.3600}\n$$", "id": "3355557"}, {"introduction": "当标准Metropolis-Hastings算法的接受率较低时，其探索效率会显著下降。延迟拒绝（Delayed Rejection）算法通过在拒绝一个提议后提供“第二次机会”来缓解此问题，从而提升采样效率。本练习[@problem_id:3355578]将指导你从路径细致平衡（pathwise detailed balance）这一基本原理出发，推导延迟拒绝算法的第二阶段接受概率，让你深入理解如何设计更复杂的MCMC方案以优化性能。", "problem": "考虑一个一维目标分布，其未归一化密度为 $\\pi(x) \\propto \\exp\\!\\big(-x^{2}/2\\big)$，以及一个两阶段延迟拒绝 Metropolis–Hastings (MH) 算法。在阶段 1，使用一个独立提议，其密度为 $g(y) \\propto \\exp\\!\\big(-y^{2}/(2\\tau^{2})\\big)$，其中 $\\tau^{2} = 4$。在阶段 2，以第一阶段提议被拒绝为条件。然后从一个对称随机游走高斯提议 $q_{2}(z|x,y)$ 中提议 $z$，该提议由均值为 $x$、方差为 $s_{2}^{2} = 1$ 的正态密度定义。\n\n从关于 $\\pi$ 可逆的马尔可夫链的细致平衡原理出发，推导该延迟拒绝方案的阶段 2 接受概率 $\\alpha_{2}(x,y,z)$，用 $\\pi$、$g$ 和阶段 1 的接受概率 $\\alpha_{1}$ 表示。你的推导必须从路径转移 $x \\to y \\to z$ 及其逆过程 $z \\to y \\to x$ 的细致平衡条件开始，并使用给定提议的性质来证明每一步简化。\n\n然后，为特定值 $x = 0.3$、$y = 2.0$ 和 $z = 0.8$ 计算推导出的 $\\alpha_{2}(x,y,z)$。将你的最终数值答案表示为小数，并四舍五入到四位有效数字。", "solution": "用户想要解决一个关于 Metropolis-Hastings 算法的问题。我将首先验证问题陈述。\n\n### 第 1 步：提取已知条件\n- **目标分布**：未归一化密度 $\\pi(x) \\propto \\exp(-x^2/2)$。\n- **算法**：两阶段延迟拒绝 Metropolis–Hastings (DRMH)。\n- **阶段 1 提议**：独立提议，密度为 $g(y) \\propto \\exp(-y^2/(2\\tau^2))$，其中 $\\tau^2 = 4$。\n- **阶段 2 提议**：在阶段 1 提议 $y$ 被拒绝的条件下，从一个对称随机游走高斯提议 $q_2(z|x,y)$ 中提议一个新状态 $z$，该提议是一个均值为 $x$、方差为 $s_2^2=1$ 的正态密度。\n- **任务 1**：从路径转移 $x \\to y \\to z$ 及其逆过程 $z \\to y \\to x$ 的细致平衡原理出发，推导阶段 2 的接受概率 $\\alpha_2(x,y,z)$。表达式需用 $\\pi$、$g$ 和 $\\alpha_1$ 表示。\n- **任务 2**：计算当 $x = 0.3$，$y = 2.0$，$z = 0.8$ 时 $\\alpha_2(x,y,z)$ 的值。\n- **任务 3**：将最终数值答案四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题基于成熟的延迟拒绝 Metropolis-Hastings 算法，这是马尔可夫链蒙特卡洛方法中的一种标准技术。所涉及的分布（高斯分布）是统计学和物理学中的基本分布。整个设定在科学上和数学上都是合理的。\n- **适定性**：问题定义清晰。它要求进行特定的推导，然后进行数值计算，并提供了所有必要的参数。存在唯一解。\n- **客观性**：问题以精确、正式的语言陈述，没有任何主观或模棱两可的术语。\n\n### 第 3 步：结论与行动\n该问题是有效的。这是计算统计学中的一个标准练习。我现在开始解答。\n\n该问题要求推导延迟拒绝 Metropolis-Hastings (DRMH) 方案的阶段 2 接受概率 $\\alpha_2(x,y,z)$。推导必须从路径细致平衡条件开始。\n\n在一个两阶段 DRMH 算法中，从状态 $x$ 到 $z$ 的转移可以直接在阶段 1 发生，也可以在一次拒绝后间接地在阶段 2 发生。为了保持目标分布 $\\pi(x)$ 为平稳分布，转移核必须满足细致平衡条件。对于 DRMH，这通常通过确保每条可能的转移路径都达到平衡来强制执行。\n\n让我们考虑从状态 $x$ 经过一个被拒绝的中间提议 $y$ 到达状态 $z$ 的路径。事件序列如下：\n1. 从状态 $x$ 开始。\n2. 从阶段 1 提议密度 $g(y|x)$ 中提议 $y$。\n3. 以概率 $1 - \\alpha_1(x,y)$ 拒绝 $y$。\n4. 从阶段 2 提议密度 $q_2(z|x,y)$ 中提议 $z$。\n5. 以概率 $\\alpha_2(x,y,z)$ 接受 $z$。\n\n这条路径 $x \\to y \\to z$ 的通量（或概率密度流）由每一步概率的乘积给出，从处于状态 $x$ 的密度 $\\pi(x)$ 开始：\n$$\n\\text{Flux}(x \\to y \\to z) = \\pi(x) g(y|x) [1-\\alpha_1(x,y)] q_2(z|x,y) \\alpha_2(x,y,z)\n$$\n问题指明阶段 1 的提议是独立采样器，因此 $g(y|x) = g(y)$。\n\n路径细致平衡原理要求这个通量等于“逆”路径（名义上是 $z \\to y \\to x$）的通量。逆路径包括从 $z$ 开始，提议相同的中间状态 $y$ 并被拒绝，然后提议并接受 $x$。这个逆路径的通量是：\n$$\n\\text{Flux}(z \\to y \\to x) = \\pi(z) g(y|z) [1-\\alpha_1(z,y)] q_2(x|z,y) \\alpha_2(z,y,x)\n$$\n同样，由于阶段 1 的提议是独立采样器，所以 $g(y|z) = g(y)$。\n\n令正向和反向通量相等，得到路径细致平衡条件：\n$$\n\\pi(x) g(y) [1-\\alpha_1(x,y)] q_2(z|x,y) \\alpha_2(x,y,z) = \\pi(z) g(y) [1-\\alpha_1(z,y)] q_2(x|z,y) \\alpha_2(z,y,x)\n$$\n阶段 2 的接受概率 $\\alpha_2(x,y,z)$ 以 Metropolis-Hastings 的方式定义，以满足此方程：\n$$\n\\alpha_2(x,y,z) = \\min\\left(1, R_2\\right)\n$$\n其中 $R_2$ 是平衡方程两边乘以 $\\alpha_2$ 的项的比率：\n$$\nR_2 = \\frac{\\pi(z) g(y) [1-\\alpha_1(z,y)] q_2(x|z,y)}{\\pi(x) g(y) [1-\\alpha_1(x,y)] q_2(z|x,y)}\n$$\n我们可以简化这个表达式。与独立采样器对应的项 $g(y)$ 被消掉。\n$$\nR_2 = \\frac{\\pi(z)}{\\pi(x)} \\frac{1-\\alpha_1(z,y)}{1-\\alpha_1(x,y)} \\frac{q_2(x|z,y)}{q_2(z|x,y)}\n$$\n问题陈述阶段 2 的提议 $q_2(z|x,y)$ 是一个均值为 $x$、方差为 $s_2^2 = 1$ 的对称随机游走高斯提议。这意味着给定当前状态 $x$ 和被拒绝的提议 $y$，提议 $z$ 的密度为 $N(z; x, s_2^2)$。注意，这个提议只依赖于 $x$，不依赖于 $y$。所以，$q_2(z|x,y) = q_2(z|x)$。其密度为：\n$$\nq_2(z|x) = \\frac{1}{\\sqrt{2\\pi s_2^2}} \\exp\\left(-\\frac{(z-x)^2}{2s_2^2}\\right)\n$$\n逆向提议密度是从状态 $z$ 提议 $x$，即 $q_2(x|z) = N(x; z, s_2^2)$：\n$$\nq_2(x|z) = \\frac{1}{\\sqrt{2\\pi s_2^2}} \\exp\\left(-\\frac{(x-z)^2}{2s_2^2}\\right)\n$$\n由于 $(z-x)^2 = (x-z)^2$，显然 $q_2(z|x) = q_2(x|z)$。该提议是对称的。因此，阶段 2 提议密度的比值为 1：\n$$\n\\frac{q_2(x|z,y)}{q_2(z|x,y)} = \\frac{q_2(x|z)}{q_2(z|x)} = 1\n$$\n将此代入 $R_2$ 的表达式，得到阶段 2 接受率的最终简化形式：\n$$\nR_2 = \\frac{\\pi(z)}{\\pi(x)} \\frac{1 - \\alpha_1(z,y)}{1 - \\alpha_1(x,y)}\n$$\n因此，阶段 2 的接受概率为：\n$$\n\\alpha_2(x,y,z) = \\min\\left(1, \\frac{\\pi(z)}{\\pi(x)} \\frac{1 - \\alpha_1(z,y)}{1 - \\alpha_1(x,y)}\\right)\n$$\n推导到此完成。现在我们为给定值 $x=0.3$，$y=2.0$ 和 $z=0.8$ 计算此表达式。\n\n未归一化的密度为 $\\pi(u) \\propto \\exp(-u^2/2)$ 和 $g(u) \\propto \\exp(-u^2/(2\\tau^2)) = \\exp(-u^2/8)$，因为 $\\tau^2 = 4$。\n\n首先，我们需要阶段 1 的接受概率 $\\alpha_1(u,v)$：\n$$\n\\alpha_1(u,v) = \\min\\left(1, \\frac{\\pi(v)g(u)}{\\pi(u)g(v)}\\right)\n$$\n让我们计算 $\\min$ 函数内部的比率：\n$$\n\\frac{\\pi(v)g(u)}{\\pi(u)g(v)} = \\frac{\\exp(-v^2/2)\\exp(-u^2/8)}{\\exp(-u^2/2)\\exp(-v^2/8)} = \\exp\\left[\\left(-\\frac{v^2}{2} + \\frac{v^2}{8}\\right) - \\left(-\\frac{u^2}{2} + \\frac{u^2}{8}\\right)\\right] = \\exp\\left[-\\frac{3v^2}{8} + \\frac{3u^2}{8}\\right] = \\exp\\left[\\frac{3}{8}(u^2-v^2)\\right]\n$$\n现在，我们可以计算 $\\alpha_1(x,y) = \\alpha_1(0.3, 2.0)$ 和 $\\alpha_1(z,y) = \\alpha_1(0.8, 2.0)$。\n对于 $\\alpha_1(0.3, 2.0)$：\n$$\n\\frac{3}{8}(0.3^2 - 2.0^2) = \\frac{3}{8}(0.09 - 4.0) = \\frac{3}{8}(-3.91) = -1.46625\n$$\n比率为 $\\exp(-1.46625)  1$。所以，$\\alpha_1(0.3, 2.0) = \\exp(-1.46625)$。\n\n对于 $\\alpha_1(0.8, 2.0)$：\n$$\n\\frac{3}{8}(0.8^2 - 2.0^2) = \\frac{3}{8}(0.64 - 4.0) = \\frac{3}{8}(-3.36) = -1.26\n$$\n比率为 $\\exp(-1.26)  1$。所以，$\\alpha_1(0.8, 2.0) = \\exp(-1.26)$。\n\n接下来，我们计算目标密度的比率 $\\pi(z)/\\pi(x)$：\n$$\n\\frac{\\pi(z)}{\\pi(x)} = \\frac{\\pi(0.8)}{\\pi(0.3)} = \\frac{\\exp(-0.8^2/2)}{\\exp(-0.3^2/2)} = \\exp\\left[-\\frac{1}{2}(0.8^2 - 0.3^2)\\right] = \\exp\\left[-\\frac{1}{2}(0.64 - 0.09)\\right] = \\exp\\left[-\\frac{0.55}{2}\\right] = \\exp(-0.275)\n$$\n现在我们组合比率 $R_2$ 来计算 $\\alpha_2(0.3, 2.0, 0.8)$：\n$$\nR_2 = \\frac{\\pi(0.8)}{\\pi(0.3)} \\frac{1 - \\alpha_1(0.8, 2.0)}{1 - \\alpha_1(0.3, 2.0)} = \\exp(-0.275) \\frac{1 - \\exp(-1.26)}{1 - \\exp(-1.46625)}\n$$\n我们计算数值：\n$$\n\\exp(-0.275) \\approx 0.759572 \\\\\n\\exp(-1.26) \\approx 0.283660 \\\\\n\\exp(-1.46625) \\approx 0.230796\n$$\n代入这些值：\n$$\nR_2 \\approx 0.759572 \\times \\frac{1 - 0.283660}{1 - 0.230796} = 0.759572 \\times \\frac{0.716340}{0.769204} \\approx 0.759572 \\times 0.931274 \\approx 0.707335\n$$\n由于 $R_2 \\approx 0.707335  1$，接受概率为 $\\alpha_2(0.3, 2.0, 0.8) = R_2$。\n将结果四舍五入到四位有效数字得到 $0.7073$。", "answer": "$$\n\\boxed{0.7073}\n$$", "id": "3355578"}]}