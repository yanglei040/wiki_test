{"hands_on_practices": [{"introduction": "第一个实践将我们对按比例分配的理解建立在基本原则之上。通过在特定的常见假设下推导出最小化方差的分配规则，您将明白为什么该方法是分层抽样的一个自然且直观的起点。然后，练习将从理论转向实践，要求您将公式应用于一个假设的总体，并解决将小数分配转换为整数的现实世界问题。[@problem_id:3332354]", "problem": "一个大小为 $N$ 的有限总体被划分为 $H$ 个层，各层的大小为 $\\{N_{h}\\}_{h=1}^{H}$，因此有 $\\sum_{h=1}^{H} N_{h}=N$。您希望使用分层简单无放回随机抽样来估计一个有界响应的有限总体均值，该抽样将被嵌入到一个更大的蒙特卡罗（MC）估计器中。在每个层 $h$ 中，将抽取一个大小为 $n_{h}$ 的简单随机样本，且 $\\sum_{h=1}^{H} n_{h}=n$。假设各层的单位抽样成本相等，并且对于感兴趣的响应，层内有限总体方差 $\\{S_{h}^{2}\\}_{h=1}^{H}$ 相等、未知但有界。从第一性原理（分层估计量的无偏性以及分层无放回抽样的方差公式）出发，推导在所述假设下使分层均值方差最小化的 $\\{n_{h}\\}_{h=1}^{H}$ 的分配规则。\n\n然后，对于 $H=3$，$N=(600,300,100)$，$N=1000$ 和 $n=100$ 的情况，计算得出的实值分配，并处理整数可行性问题。如果任何 $n_{h}$ 不是整数，则应用基于最大余数法的有原则的分配方法：为每个层分配 $n_{h}=\\lfloor n\\,N_{h}/N\\rfloor$，然后将剩余的样本逐一分配给 $n\\,N_{h}/N$ 值小数部分最大的层，直到 $\\sum_{h=1}^{H} n_{h}=n$。\n\n最后，令 $p_{h}=N_{h}/N$ 为总体中各层的比例，$\\hat{p}_{h}=n_{h}/n$ 为分配后实现的样本比例。计算 Kullback–Leibler (KL) 散度 $D_{\\mathrm{KL}}(p\\|\\hat{p})=\\sum_{h=1}^{H} p_{h}\\,\\ln\\!\\big(p_{h}/\\hat{p}_{h}\\big)$，并以单个实数形式提供其值。如果该值不完全为零，请将您的答案四舍五入到六位有效数字。", "solution": "该问题是有效的，因为它在科学上基于抽样调查理论的原理，提法恰当且有唯一解，并使用客观、正式的语言陈述。它是自洽且一致的。\n\n我们首先推导最优分配规则。目标是在总样本量 $n = \\sum_{h=1}^{H} n_h$ 固定的约束下，最小化分层均值估计量 $\\hat{\\mu}_{st} = \\sum_{h=1}^{H} \\frac{N_h}{N} \\bar{y}_h$ 的方差。对于分层简单无放回随机抽样，该估计量的方差由下式给出：\n$$ V(\\hat{\\mu}_{st}) = \\sum_{h=1}^{H} V\\left(\\frac{N_h}{N} \\bar{y}_h\\right) = \\sum_{h=1}^{H} \\left(\\frac{N_h}{N}\\right)^2 V(\\bar{y}_h) $$\n在层 $h$ 中，样本均值 $\\bar{y}_h$ 的方差为 $V(\\bar{y}_h) = \\frac{S_h^2}{n_h} \\left(1 - \\frac{n_h}{N_h}\\right)$，其中 $S_h^2$ 是层 $h$ 的有限总体方差，而项 $(1 - n_h/N_h)$ 是有限总体校正因子。\n将此代入 $V(\\hat{\\mu}_{st})$ 的表达式中：\n$$ V(\\hat{\\mu}_{st}) = \\sum_{h=1}^{H} \\left(\\frac{N_h}{N}\\right)^2 \\frac{S_h^2}{n_h} \\left(\\frac{N_h - n_h}{N_h}\\right) = \\frac{1}{N^2} \\sum_{h=1}^{H} N_h^2 \\frac{S_h^2}{n_h} \\frac{N_h - n_h}{N_h} = \\frac{1}{N^2} \\sum_{h=1}^{H} N_h (N_h - n_h) \\frac{S_h^2}{n_h} $$\n展开表达式：\n$$ V(\\hat{\\mu}_{st}) = \\frac{1}{N^2} \\sum_{h=1}^{H} \\left(\\frac{N_h^2 S_h^2}{n_h} - N_h S_h^2\\right) = \\left(\\frac{1}{N^2} \\sum_{h=1}^{H} \\frac{N_h^2 S_h^2}{n_h}\\right) - \\left(\\frac{1}{N^2} \\sum_{h=1}^{H} N_h S_h^2\\right) $$\n为了最小化关于分配 $\\{n_h\\}_{h=1}^{H}$ 的 $V(\\hat{\\mu}_{st})$，我们只需要考虑依赖于 $n_h$ 的项。第二项 $\\frac{1}{N^2} \\sum_{h=1}^{H} N_h S_h^2$ 相对于分配是常数。因此，问题简化为在约束条件 $\\sum_{h=1}^{H} n_h = n$ 下最小化数量 $\\sum_{h=1}^{H} \\frac{N_h^2 S_h^2}{n_h}$。\n\n问题陈述假设层内方差相等，即对于所有 $h \\in \\{1, \\dots, H\\}$，$S_h^2 = S^2$。要最小化的表达式变为 $\\sum_{h=1}^{H} \\frac{N_h^2 S^2}{n_h} = S^2 \\sum_{h=1}^{H} \\frac{N_h^2}{n_h}$。由于 $S^2$ 是一个正常数，这等价于最小化 $\\sum_{h=1}^{H} \\frac{N_h^2}{n_h}$。\n\n我们使用拉格朗日乘数法。拉格朗日函数为：\n$$ L(n_1, \\dots, n_H, \\lambda) = \\sum_{h=1}^{H} \\frac{N_h^2}{n_h} + \\lambda \\left(\\sum_{h=1}^{H} n_h - n\\right) $$\n对任意 $n_k$ 求偏导数并令其为零，得到：\n$$ \\frac{\\partial L}{\\partial n_k} = -\\frac{N_k^2}{n_k^2} + \\lambda = 0 \\implies n_k^2 = \\frac{N_k^2}{\\lambda} \\implies n_k = \\frac{N_k}{\\sqrt{\\lambda}} $$\n（我们取正根，因为 $n_k$ 必须是正数）。这对所有 $k=1, \\dots, H$ 都必须成立。我们使用约束条件来求解 $\\sqrt{\\lambda}$：\n$$ \\sum_{h=1}^{H} n_h = \\sum_{h=1}^{H} \\frac{N_h}{\\sqrt{\\lambda}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{h=1}^{H} N_h = n $$\n给定 $\\sum_{h=1}^{H} N_h = N$，我们有 $\\frac{N}{\\sqrt{\\lambda}} = n$，这意味着 $\\sqrt{\\lambda} = \\frac{N}{n}$。\n将此代回 $n_k$ 的表达式：\n$$ n_k = \\frac{N_k}{N/n} = n \\frac{N_k}{N} $$\n这就是比例分配规则，它是在单位抽样成本相等和层内方差相等的假设下的最优分配。\n\n我们现在将此规则应用于给定的具体情况：$H=3$，各层大小为 $N_1=600$，$N_2=300$ 和 $N_3=100$。总总体大小为 $N = 600+300+100=1000$。总样本大小为 $n=100$。\n实值分配为：\n$$ n_1 = 100 \\times \\frac{600}{1000} = 100 \\times 0.6 = 60 $$\n$$ n_2 = 100 \\times \\frac{300}{1000} = 100 \\times 0.3 = 30 $$\n$$ n_3 = 100 \\times \\frac{100}{1000} = 100 \\times 0.1 = 10 $$\n这些分配的总和为 $60+30+10=100$，满足约束条件。\n由于所有计算出的最优分配 $\\{n_h\\}$ 都是整数，整数可行性问题迎刃而解。最终的整数分配为 $n_1=60$，$n_2=30$ 和 $n_3=10$。由于没有需要分配的小数部分，因此不需要指定的分配程序（最大余数法）。\n\n最后，我们计算 Kullback–Leibler (KL) 散度，$D_{\\mathrm{KL}}(p\\|\\hat{p})$。\n首先，我们计算总体中各层的比例，$p_h = N_h/N$：\n$$ p_1 = \\frac{600}{1000} = 0.6 $$\n$$ p_2 = \\frac{300}{1000} = 0.3 $$\n$$ p_3 = \\frac{100}{1000} = 0.1 $$\n因此，总体分布为 $p = (0.6, 0.3, 0.1)$。\n\n接下来，我们计算实现的样本比例，$\\hat{p}_h = n_h/n$：\n$$ \\hat{p}_1 = \\frac{60}{100} = 0.6 $$\n$$ \\hat{p}_2 = \\frac{30}{100} = 0.3 $$\n$$ \\hat{p}_3 = \\frac{10}{100} = 0.1 $$\n因此，抽样分布为 $\\hat{p} = (0.6, 0.3, 0.1)$。\n\n这两个分布是相同的，即对于所有 $h$，$p_h = \\hat{p}_h$。KL 散度的定义为：\n$$ D_{\\mathrm{KL}}(p\\|\\hat{p}) = \\sum_{h=1}^{H} p_h \\ln\\left(\\frac{p_h}{\\hat{p}_h}\\right) $$\n由于对于所有 $h=1,2,3$，$p_h/\\hat{p}_h = 1$，并且 $\\ln(1)=0$，表达式变为：\n$$ D_{\\mathrm{KL}}(p\\|\\hat{p}) = \\sum_{h=1}^{3} p_h \\ln(1) = \\sum_{h=1}^{3} p_h \\times 0 = 0 $$\nKL 散度恰好为 $0$。", "answer": "$$\n\\boxed{0}\n$$", "id": "3332354"}, {"introduction": "虽然按比例分配方法简单且通常有效，但它并非总是最高效的策略。本练习通过将按比例分配与考虑了层内方差差异的最优Neyman分配进行比较，为您提供了关键的背景知识。通过计算两种方法的方差并量化效率损失，您将对支配抽样设计性能的因素有更深刻的理解。[@problem_id:3332392]", "problem": "考虑一个标量期望的分层蒙特卡洛（MC）估计量，其中总体被划分为 $H$ 个层，各层权重 $w_{h}$ 已知，且满足 $\\sum_{h=1}^{H} w_{h} = 1$。在第 $h$ 层内，抽取一个大小为 $n_{h}$ 的样本，并由层方差为 $\\sigma_{h}^{2}$ 的独立同分布抽样构成层样本均值 $\\bar{X}_{h}$。总体估计量是加权和 $\\hat{\\mu} = \\sum_{h=1}^{H} w_{h} \\bar{X}_{h}$。总样本量为 $n = \\sum_{h=1}^{H} n_{h}$，且各层之间独立抽样。\n\n仅从以下基本原理出发：\n- 独立随机变量之和的方差等于它们各自方差的和。\n- 样本均值的方差等于总体方差除以样本量。\n- 通过拉格朗日乘数法在一个线性约束条件下最小化一个目标函数。\n\n推导 $\\hat{\\mu}$ 的方差，将其表示为分配向量 $(n_{1},\\dots,n_{H})$ 的函数，并推导在约束条件 $\\sum_{h=1}^{H} n_{h} = n$ 下使该方差最小化的分配方案。将此应用于 $H=2$ 的特定情况，其中 $W=(w_{1},w_{2})=(0.99,0.01)$，$\\sigma^{2}=(\\sigma_{1}^{2},\\sigma_{2}^{2})=(1,100)$ 且 $n=1000$。为了进行解析方差计算，将 $n_{1}$ 和 $n_{2}$ 视为实数。\n\n计算：\n1. 比例分配下的方差，定义为 $n_{h} = n\\,w_{h}$。\n2. 通过约束优化推导出的方差最小化分配（通常称为 Neyman 分配）下的方差。\n3. 比例分配的惩罚，定义为比例分配方差与 Neyman 分配方差的比值。\n4. 效率损失，定义为惩罚减 1，以小数或分数表示（不要使用百分号）。\n\n使用 LaTeX $\\texttt{pmatrix}$ 环境，将您的最终结果以单行矩阵 $\\big[$比例分配下的方差, Neyman 分配下的方差, 惩罚比, 效率损失$\\big]$ 的形式给出，使用精确值，不进行四舍五入。无需单位。", "solution": "首先根据所需标准对问题陈述进行验证。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n- 总体被划分为 $H$ 个层。\n- 层权重为 $w_{h}$，且 $\\sum_{h=1}^{H} w_{h} = 1$。\n- 第 $h$ 层的样本量为 $n_{h}$。\n- 层样本均值为 $\\bar{X}_{h}$，由独立同分布抽样构成。\n- 层方差为 $\\sigma_{h}^{2}$。\n- 总体估计量为 $\\hat{\\mu} = \\sum_{h=1}^{H} w_{h} \\bar{X}_{h}$。\n- 总样本量为 $n = \\sum_{h=1}^{H} n_{h}$。\n- 各层独立抽样。\n- 基本原理：\n    1. 独立随机变量之和的方差等于它们各自方差的和。\n    2. 样本均值的方差等于总体方差除以样本量。\n    3. 通过拉格朗日乘数法进行约束优化。\n- 特定情况：$H=2$，$W=(w_{1},w_{2})=(0.99,0.01)$，$\\sigma^{2}=(\\sigma_{1}^{2},\\sigma_{2}^{2})=(1,100)$ 且 $n=1000$。\n- 为了分析，将 $n_{1}$ 和 $n_{2}$ 视为实数。\n- 比例分配定义为 $n_{h} = n\\,w_{h}$。\n- 需要计算的内容：比例分配下的方差，方差最小化（Neyman）分配的方差，惩罚比（比例/Neyman），以及效率损失（惩罚 - 1）。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学性**：该问题是抽样理论和蒙特卡洛方法中的一个标准基础练习，植根于已有的统计学原理。分层抽样、方差缩减和最优分配等概念是这些领域的核心。\n- **良态性**：问题陈述清晰。它要求推导一个标准结果，并将其应用于一个具体的数值示例。目标函数（方差）和约束条件（总样本量）都得到了精确定义，这保证了在给定假设（$n_h$ 为实数）下，最优分配存在唯一解。\n- **客观性**：问题以客观的数学语言表述，没有歧义或主观论断。\n- **完整性与一致性**：所有必要的数据（$w_h$, $\\sigma_h^2$, $n$）和定义都已提供。不存在矛盾之处。\n\n**步骤 3：结论与行动**\n该问题是有效的，因为它在科学上是合理的、良态的、客观的和完整的。将提供完整解答。\n\n**估计量方差的推导**\n总体均值的估计量为 $\\hat{\\mu} = \\sum_{h=1}^{H} w_{h} \\bar{X}_{h}$。我们求其方差 $Var(\\hat{\\mu})$。\n\n1.  应用方差算子：\n    $$Var(\\hat{\\mu}) = Var\\left(\\sum_{h=1}^{H} w_{h} \\bar{X}_{h}\\right)$$\n2.  由于各层是独立抽样的，随机变量 $\\bar{X}_{h}$ 是独立的。因此，$w_{h} \\bar{X}_{h}$ 各项也是独立的。根据给定的“独立随机变量之和的方差等于它们各自方差的和”这一原理，我们有：\n    $$Var(\\hat{\\mu}) = \\sum_{h=1}^{H} Var(w_{h} \\bar{X}_{h})$$\n3.  对于任意随机变量 $Y$ 和常数 $c$，有 $Var(cY) = c^2 Var(Y)$。此处，$w_h$ 是常数。\n    $$Var(\\hat{\\mu}) = \\sum_{h=1}^{H} w_{h}^{2} Var(\\bar{X}_{h})$$\n4.  根据提供的基本原理，从方差为 $\\sigma_{h}^{2}$ 的总体中抽取的大小为 $n_h$ 的样本均值 $\\bar{X}_{h}$ 的方差为 $Var(\\bar{X}_{h}) = \\frac{\\sigma_{h}^{2}}{n_h}$。代入此式，得到分层估计量的方差：\n    $$Var(\\hat{\\mu}) = \\sum_{h=1}^{H} \\frac{w_{h}^{2} \\sigma_{h}^{2}}{n_{h}}$$\n\n**最优（Neyman）分配的推导**\n我们的目标是在总样本量固定的约束下，即 $g(n_1, \\dots, n_H) = \\sum_{h=1}^{H} n_{h} - n = 0$，最小化方差 $V(n_1, \\dots, n_H) = \\sum_{h=1}^{H} \\frac{w_{h}^{2} \\sigma_{h}^{2}}{n_{h}}$。我们使用拉格朗日乘数法，并将 $n_h$ 视为连续实变量。拉格朗日函数为：\n$$L(n_1, \\dots, n_H, \\lambda) = \\sum_{h=1}^{H} \\frac{w_{h}^{2} \\sigma_{h}^{2}}{n_{h}} + \\lambda \\left( \\left(\\sum_{h=1}^{H} n_{h}\\right) - n \\right)$$\n为求最小值，我们将关于每个 $n_h$ 的偏导数设为零：\n$$\\frac{\\partial L}{\\partial n_h} = -\\frac{w_{h}^{2} \\sigma_{h}^{2}}{n_{h}^{2}} + \\lambda = 0$$\n这意味着对于所有 $h = 1, \\dots, H$ 都有 $\\lambda = \\frac{w_{h}^{2} \\sigma_{h}^{2}}{n_{h}^{2}}$。我们可以解出 $n_h$：\n$$n_{h}^{2} = \\frac{w_{h}^{2} \\sigma_{h}^{2}}{\\lambda} \\implies n_{h} = \\frac{w_{h} \\sigma_{h}}{\\sqrt{\\lambda}}$$\n（我们取正根，因为样本量必须为正）。为了求出 $\\sqrt{\\lambda}$，我们将此表达式代回约束方程：\n$$\\sum_{h=1}^{H} n_{h} = \\sum_{h=1}^{H} \\frac{w_{h} \\sigma_{h}}{\\sqrt{\\lambda}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{h=1}^{H} w_{h} \\sigma_{h} = n$$\n解出 $\\frac{1}{\\sqrt{\\lambda}}$：\n$$\\frac{1}{\\sqrt{\\lambda}} = \\frac{n}{\\sum_{k=1}^{H} w_{k} \\sigma_{k}}$$\n将其代回 $n_h$ 的表达式中，得到最优分配，即所谓的 Neyman 分配：\n$$n_{h}^{\\text{Neyman}} = n \\frac{w_{h} \\sigma_{h}}{\\sum_{k=1}^{H} w_{k} \\sigma_{k}}$$\n\n**特定情况的数值计算**\n给定参数为 $H=2$，$w_1 = 0.99$，$w_2 = 0.01$，$\\sigma_1^2 = 1$，$\\sigma_2^2 = 100$ 且 $n=1000$。这意味着层标准差为 $\\sigma_1 = \\sqrt{1} = 1$ 和 $\\sigma_2 = \\sqrt{100} = 10$。\n\n**1. 比例分配下的方差**\n在比例分配下，$n_h = n w_h$。\n$$n_1 = 1000 \\times 0.99 = 990$$\n$$n_2 = 1000 \\times 0.01 = 10$$\n方差为：\n$$V_{\\text{prop}} = \\frac{w_1^2 \\sigma_1^2}{n_1} + \\frac{w_2^2 \\sigma_2^2}{n_2} = \\frac{0.99^2 \\times 1^2}{990} + \\frac{0.01^2 \\times 100}{10}$$\n$$V_{\\text{prop}} = \\frac{0.9801}{990} + \\frac{0.0001 \\times 100}{10} = \\frac{0.9801}{990} + \\frac{0.01}{10}$$\n比例分配方差的一个更简洁的通用表达式是 $V_{\\text{prop}} = \\frac{1}{n} \\sum_{h=1}^{H} w_h \\sigma_h^2$：\n$$V_{\\text{prop}} = \\frac{1}{1000} (w_1 \\sigma_1^2 + w_2 \\sigma_2^2) = \\frac{1}{1000} (0.99 \\times 1 + 0.01 \\times 100) = \\frac{1}{1000} (0.99 + 1) = \\frac{1.99}{1000}$$\n$$V_{\\text{prop}} = 0.00199 = \\frac{199}{100000}$$\n\n**2. Neyman 分配下的方差**\n首先，我们求出最优分配 $n_h^{\\text{Neyman}}$。分母中的求和项是：\n$$\\sum_{k=1}^{2} w_k \\sigma_k = w_1 \\sigma_1 + w_2 \\sigma_2 = (0.99)(1) + (0.01)(10) = 0.99 + 0.10 = 1.09$$\nNeyman 分配下的方差 $V_{\\text{Neyman}}$ 可以通过将最优的 $n_h$ 代入方差公式来求得。一个更直接的方法是推导最小方差的简化公式：\n$$V_{\\text{Neyman}} = \\sum_{h=1}^{H} \\frac{w_h^2 \\sigma_h^2}{n \\frac{w_h \\sigma_h}{\\sum w_k \\sigma_k}} = \\frac{\\sum w_k \\sigma_k}{n} \\sum_{h=1}^{H} w_h \\sigma_h = \\frac{\\left(\\sum_{h=1}^{H} w_h \\sigma_h\\right)^2}{n}$$\n使用我们的数值：\n$$V_{\\text{Neyman}} = \\frac{(1.09)^2}{1000} = \\frac{1.1881}{1000} = 0.0011881$$\n以精确分数表示：\n$$V_{\\text{Neyman}} = \\frac{\\left(\\frac{109}{100}\\right)^2}{1000} = \\frac{\\frac{11881}{10000}}{1000} = \\frac{11881}{10000000}$$\n\n**3. 比例分配的惩罚**\n惩罚是两种方差的比值：\n$$\\text{Penalty} = \\frac{V_{\\text{prop}}}{V_{\\text{Neyman}}} = \\frac{0.00199}{0.0011881} = \\frac{\\frac{199}{100000}}{\\frac{11881}{10000000}} = \\frac{199}{100000} \\times \\frac{10000000}{11881} = \\frac{199 \\times 100}{11881}$$\n$$\\text{Penalty} = \\frac{19900}{11881}$$\n\n**4. 效率损失**\n效率损失是惩罚减 1：\n$$\\text{Efficiency Loss} = \\frac{19900}{11881} - 1 = \\frac{19900 - 11881}{11881} = \\frac{8019}{11881}$$\n\n四个计算出的值是：比例分配下的方差、Neyman 分配下的方差、惩罚比和效率损失。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{199}{100000}  \\frac{11881}{10000000}  \\frac{19900}{11881}  \\frac{8019}{11881} \\end{pmatrix} } $$", "id": "3332392"}, {"introduction": "分层抽样不仅是调查理论中，也是蒙特卡洛方法中一种强大的方差缩减技术。最后一个实践展示了其在数值积分中的应用，这是随机模拟的基石。通过使用按比例分配来估计一个简单函数的积分，您将亲眼看到对积分域进行分层如何能在相同的计算预算下，比简单蒙特卡洛方法得到更精确的估计。[@problem_id:3332372]", "problem": "考虑在随机模拟和蒙特卡洛 (MC) 方法的框架内，使用分层抽样来估计积分 $I=\\int_{0}^{1} f(x)\\,dx$，其中 $f(x)=x^{2}$。区间 $[0,1]$ 被划分为两个层，$[0,0.5)$ 和 $[0.5,1]$，层权重 $W=(0.5,0.5)$ 等于每层相对于单位区间的勒贝格测度。在每层 $h\\in\\{1,2\\}$ 中，从该层上的均匀分布中抽取 $n_{h}$ 个独立同分布 (i.i.d.) 的样本，采用按比例分配 $n_{h}=W_{h}\\,n$，总样本量为 $n=100$。构建分层估计量 $\\hat{I}=\\sum_{h=1}^{2} W_{h}\\,\\bar{Y}_{h}$，其中 $\\bar{Y}_{h}$ 是根据第 $h$ 层的样本计算出的 $f(X)$ 的样本均值。仅使用期望和方差的定义、层间和层内样本的独立性，以及 $x^{2}$ 相对于每层均匀分布的精确层内方差，计算期望 $\\mathbb{E}[\\hat{I}]$ 和方差 $\\operatorname{Var}(\\hat{I})$。以精确解析形式给出最终值，无需四舍五入。", "solution": "该问题陈述在科学上是合理的、适定的和完整的。它代表了分层抽样在蒙特卡洛积分中的一个标准应用。我们接下来计算分层估计量的期望和方差。\n\n待估计的积分是 $I=\\int_{0}^{1} f(x)\\,dx$，其中 $f(x)=x^2$。区间 $[0,1]$ 被划分为两个层，$S_1 = [0, 0.5)$ 和 $S_2 = [0.5, 1]$。层权重为 $W_1 = 0.5$ 和 $W_2 = 0.5$。总样本量为 $n=100$。由于使用按比例分配，每层中的样本数量为 $n_1 = W_1 n = 0.5 \\times 100 = 50$ 和 $n_2 = W_2 n = 0.5 \\times 100 = 50$。\n\n分层估计量定义为 $\\hat{I}=\\sum_{h=1}^{2} W_{h}\\,\\bar{Y}_{h}$，其中 $\\bar{Y}_{h} = \\frac{1}{n_h}\\sum_{i=1}^{n_h} Y_{h,i}$ 且 $Y_{h,i} = f(X_{h,i})$。随机变量 $X_{h,i}$（其中 $i=1, \\dots, n_h$）是从层 $S_h$ 上的均匀分布中独立抽取的。\n\n**1. 期望 $\\mathbb{E}[\\hat{I}]$ 的计算**\n\n根据期望算子的线性性质，我们有：\n$$\n\\mathbb{E}[\\hat{I}] = \\mathbb{E}\\left[\\sum_{h=1}^{2} W_{h}\\,\\bar{Y}_{h}\\right] = \\sum_{h=1}^{2} W_{h}\\,\\mathbb{E}[\\bar{Y}_{h}]\n$$\n样本均值 $\\bar{Y}_{h}$ 的期望是该层内单个观测值 $Y_{h,i}$ 的期望，我们将其记为 $\\mu_h$。\n$$\n\\mathbb{E}[\\bar{Y}_{h}] = \\mathbb{E}\\left[\\frac{1}{n_h}\\sum_{i=1}^{n_h} Y_{h,i}\\right] = \\frac{1}{n_h}\\sum_{i=1}^{n_h} \\mathbb{E}[Y_{h,i}] = \\mathbb{E}[Y_{h,1}] = \\mu_h\n$$\n值 $\\mu_h$ 是在 $X$ 属于层 $S_h$ 的条件下 $f(X)$ 的条件期望。对于一个随机变量 $X_h \\sim U(S_h)$，这等于：\n$$\n\\mu_h = \\mathbb{E}[f(X_h)]\n$$\n对于层 $S_1 = [0, 0.5)$，随机变量 $X_1$ 服从均匀分布 $U(0, 0.5)$，其概率密度函数 (PDF) 为 $p_1(x) = \\frac{1}{0.5-0} = 2$（对于 $x \\in [0, 0.5)$）。\n$$\n\\mu_1 = \\mathbb{E}[X_1^2] = \\int_{0}^{0.5} x^2 p_1(x) \\,dx = \\int_{0}^{0.5} x^2 (2) \\,dx = 2 \\left[ \\frac{x^3}{3} \\right]_{0}^{0.5} = 2 \\left( \\frac{(1/2)^3}{3} - 0 \\right) = \\frac{2}{3} \\cdot \\frac{1}{8} = \\frac{1}{12}\n$$\n对于层 $S_2 = [0.5, 1]$，随机变量 $X_2$ 服从均匀分布 $U(0.5, 1)$，其概率密度函数 (PDF) 为 $p_2(x) = \\frac{1}{1-0.5} = 2$（对于 $x \\in [0.5, 1]$）。\n$$\n\\mu_2 = \\mathbb{E}[X_2^2] = \\int_{0.5}^{1} x^2 p_2(x) \\,dx = \\int_{0.5}^{1} x^2 (2) \\,dx = 2 \\left[ \\frac{x^3}{3} \\right]_{0.5}^{1} = 2 \\left( \\frac{1^3}{3} - \\frac{(1/2)^3}{3} \\right) = \\frac{2}{3} \\left( 1 - \\frac{1}{8} \\right) = \\frac{2}{3} \\cdot \\frac{7}{8} = \\frac{7}{12}\n$$\n现在，我们可以计算估计量的期望：\n$$\n\\mathbb{E}[\\hat{I}] = W_1 \\mu_1 + W_2 \\mu_2 = (0.5) \\left(\\frac{1}{12}\\right) + (0.5) \\left(\\frac{7}{12}\\right) = \\frac{1}{2} \\left(\\frac{1+7}{12}\\right) = \\frac{1}{2} \\cdot \\frac{8}{12} = \\frac{1}{3}\n$$\n积分的真实值为 $I = \\int_{0}^{1} x^2 \\,dx = [\\frac{x^3}{3}]_0^1 = \\frac{1}{3}$。因此，该估计量是无偏的，因为 $\\mathbb{E}[\\hat{I}] = I$。\n\n**2. 方差 $\\operatorname{Var}(\\hat{I})$ 的计算**\n\n由于来自不同层的样本是独立的，随机变量 $\\bar{Y}_1$ 和 $\\bar{Y}_2$ 也是独立的。它们加权和的方差为：\n$$\n\\operatorname{Var}(\\hat{I}) = \\operatorname{Var}\\left(\\sum_{h=1}^{2} W_{h}\\,\\bar{Y}_{h}\\right) = \\sum_{h=1}^{2} W_{h}^2\\,\\operatorname{Var}(\\bar{Y}_{h})\n$$\n在每层 $h$ 中，样本 $Y_{h,i}$ 是独立同分布的。设 $\\sigma_h^2$ 为层 $h$ 中单个观测值的方差。样本均值的方差为：\n$$\n\\operatorname{Var}(\\bar{Y}_h) = \\operatorname{Var}\\left(\\frac{1}{n_h}\\sum_{i=1}^{n_h} Y_{h,i}\\right) = \\frac{1}{n_h^2} \\sum_{i=1}^{n_h} \\operatorname{Var}(Y_{h,i}) = \\frac{n_h \\sigma_h^2}{n_h^2} = \\frac{\\sigma_h^2}{n_h}\n$$\n将此代入 $\\operatorname{Var}(\\hat{I})$ 的表达式中：\n$$\n\\operatorname{Var}(\\hat{I}) = \\sum_{h=1}^{2} W_h^2 \\frac{\\sigma_h^2}{n_h}\n$$\n使用按比例分配 $n_h = W_h n$，公式简化为：\n$$\n\\operatorname{Var}(\\hat{I}) = \\sum_{h=1}^{2} W_h^2 \\frac{\\sigma_h^2}{W_h n} = \\frac{1}{n} \\sum_{h=1}^{2} W_h \\sigma_h^2\n$$\n我们需要计算层内方差，$\\sigma_h^2 = \\operatorname{Var}(f(X_h)) = \\mathbb{E}[f(X_h)^2] - (\\mathbb{E}[f(X_h)])^2 = \\mathbb{E}[X_h^4] - \\mu_h^2$。\n\n对于层 $S_1 = [0, 0.5)$，其中 $X_1 \\sim U(0, 0.5)$：\n$$\n\\mathbb{E}[X_1^4] = \\int_{0}^{0.5} x^4 p_1(x) \\,dx = \\int_{0}^{0.5} x^4 (2) \\,dx = 2 \\left[ \\frac{x^5}{5} \\right]_{0}^{0.5} = 2 \\left( \\frac{(1/2)^5}{5} \\right) = \\frac{2}{5 \\cdot 32} = \\frac{1}{80}\n$$\n方差 $\\sigma_1^2$ 为：\n$$\n\\sigma_1^2 = \\mathbb{E}[X_1^4] - \\mu_1^2 = \\frac{1}{80} - \\left(\\frac{1}{12}\\right)^2 = \\frac{1}{80} - \\frac{1}{144} = \\frac{9}{720} - \\frac{5}{720} = \\frac{4}{720} = \\frac{1}{180}\n$$\n对于层 $S_2 = [0.5, 1]$，其中 $X_2 \\sim U(0.5, 1)$：\n$$\n\\mathbb{E}[X_2^4] = \\int_{0.5}^{1} x^4 p_2(x) \\,dx = \\int_{0.5}^{1} x^4 (2) \\,dx = 2 \\left[ \\frac{x^5}{5} \\right]_{0.5}^{1} = \\frac{2}{5} \\left( 1^5 - (1/2)^5 \\right) = \\frac{2}{5} \\left( 1 - \\frac{1}{32} \\right) = \\frac{2}{5} \\cdot \\frac{31}{32} = \\frac{31}{80}\n$$\n方差 $\\sigma_2^2$ 为：\n$$\n\\sigma_2^2 = \\mathbb{E}[X_2^4] - \\mu_2^2 = \\frac{31}{80} - \\left(\\frac{7}{12}\\right)^2 = \\frac{31}{80} - \\frac{49}{144} = \\frac{31 \\cdot 9}{720} - \\frac{49 \\cdot 5}{720} = \\frac{279 - 245}{720} = \\frac{34}{720} = \\frac{17}{360}\n$$\n最后，我们计算估计量 $\\hat{I}$ 的方差：\n$$\n\\operatorname{Var}(\\hat{I}) = \\frac{1}{n} (W_1 \\sigma_1^2 + W_2 \\sigma_2^2) = \\frac{1}{100} \\left( (0.5)\\left(\\frac{1}{180}\\right) + (0.5)\\left(\\frac{17}{360}\\right) \\right)\n$$\n$$\n\\operatorname{Var}(\\hat{I}) = \\frac{1}{100} \\cdot \\frac{1}{2} \\left( \\frac{1}{180} + \\frac{17}{360} \\right) = \\frac{1}{200} \\left( \\frac{2}{360} + \\frac{17}{360} \\right) = \\frac{1}{200} \\cdot \\frac{19}{360} = \\frac{19}{72000}\n$$\n期望为 $\\frac{1}{3}$，方差为 $\\frac{19}{72000}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{3}  \\frac{19}{72000} \\end{pmatrix}}\n$$", "id": "3332372"}]}