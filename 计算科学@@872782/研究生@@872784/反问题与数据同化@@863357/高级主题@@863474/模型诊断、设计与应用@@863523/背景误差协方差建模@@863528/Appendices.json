{"hands_on_practices": [{"introduction": "集合方法能够提供随流场变化的背景误差协方差，但有限的集合大小会引入伪长程相关，从而降低分析质量。协方差局地化是一种通过将远距离相关逐渐削减至零来减轻这种采样误差的关键技术。本练习 [@problem_id:3366753] 使用广泛应用的 Gaspari-Cohn 相关函数，提供了一个局地化的具体计算，展示了业务化集合同化中的一个关键步骤。", "problem": "考虑一个数据同化中的背景误差协方差建模任务。设状态向量有两个标量分量，位于局部欧几里得平面上的位置 $\\boldsymbol{x}_{i} = (0\\,\\text{km},\\,0\\,\\text{km})$ 和 $\\boldsymbol{x}_{j} = (90\\,\\text{km},\\,120\\,\\text{km})$。这两个分量之间的样本（未局地化）背景协方差项为 $\\hat{B}_{ij} = 12\\,\\text{K}^{2}$。为减轻伪长程相关，通过样本协方差矩阵与一个由标度化距离的紧支撑各向同性相关函数 $\\rho$ 构建的相关锥削矩阵之间的逐元素（舒尔）乘积来应用协方差局地化。各向同性的 Gaspari–Cohn 锥削函数（5阶）是一个广泛使用的选择；它在 $[0,2]$ 上是紧支撑的，满足 $\\rho(0)=1$，并且对于 $0 \\le r \\le 1$ 由下式给出\n$$\n\\rho(r) \\;=\\; 1 \\;-\\; \\frac{5}{3}\\,r^{2} \\;+\\; \\frac{5}{8}\\,r^{3} \\;+\\; \\frac{1}{2}\\,r^{4} \\;-\\; \\frac{1}{4}\\,r^{5},\n$$\n当 $r \\ge 2$ 时，$\\rho(r)=0$。定义局地化尺度为 $L=150\\,\\text{km}$，无量纲标度化间距为 $r = d_{ij}/L$，其中 $d_{ij} = \\|\\boldsymbol{x}_{i}-\\boldsymbol{x}_{j}\\|_{2}$ 是欧几里得距离。局地化协方差项通过局地化的舒尔乘积定义获得。\n\n计算局地化协方差项 $\\tilde{B}_{ij}$，并以 $\\text{K}^{2}$ 为单位表示您的最终值。如果需要数值近似，请将答案四舍五入到四位有效数字。", "solution": "首先解释计算步骤。局地化协方差 $\\tilde{B}_{ij}$ 是通过将样本协方差 $\\hat{B}_{ij}$ 与在标度化距离 $r$ 处求值的局地化锥削函数 $\\rho(r)$ 相乘得到的。\n写出公式：$\\tilde{B}_{ij} = \\hat{B}_{ij} \\cdot \\rho(d_{ij}/L)$。\n首先，计算点 $\\boldsymbol{x}_{i}$ 和 $\\boldsymbol{x}_{j}$ 之间的欧几里得距离 $d_{ij}$。\n            *   $\\boldsymbol{x}_{i} = (0, 0)\\,\\text{km}$\n            *   $\\boldsymbol{x}_{j} = (90, 120)\\,\\text{km}$\n            *   $d_{ij} = \\sqrt{(90 - 0)^2 + (120 - 0)^2} = \\sqrt{90^2 + 120^2}\\,\\text{km}$。\n            *   $d_{ij} = \\sqrt{8100 + 14400}\\,\\text{km} = \\sqrt{22500}\\,\\text{km} = 150\\,\\text{km}$。\n接下来，计算无量纲标度化间距 $r$。\n            *   $L = 150\\,\\text{km}$。\n            *   $r = d_{ij} / L = 150\\,\\text{km} / 150\\,\\text{km} = 1$。\n现在，在 $r=1$ 处计算 Gaspari–Cohn 锥削函数 $\\rho(r)$ 的值。\n            *   问题中给出了 $0 \\le r \\le 1$ 时的公式：$\\rho(r) = 1 - \\frac{5}{3}r^2 + \\frac{5}{8}r^3 + \\frac{1}{2}r^4 - \\frac{1}{4}r^5$。\n            *   代入 $r=1$：$\\rho(1) = 1 - \\frac{5}{3}(1)^2 + \\frac{5}{8}(1)^3 + \\frac{1}{2}(1)^4 - \\frac{1}{4}(1)^5$。\n            *   $\\rho(1) = 1 - \\frac{5}{3} + \\frac{5}{8} + \\frac{1}{2} - \\frac{1}{4}$。\n            *   通分，以 $24$ 为公分母：$\\rho(1) = \\frac{24}{24} - \\frac{40}{24} + \\frac{15}{24} + \\frac{12}{24} - \\frac{6}{24}$。\n            *   $\\rho(1) = \\frac{24 - 40 + 15 + 12 - 6}{24} = \\frac{5}{24}$。\n最后，计算局地化协方差项 $\\tilde{B}_{ij}$。\n            *   $\\hat{B}_{ij} = 12\\,\\text{K}^2$。\n            *   $\\tilde{B}_{ij} = \\hat{B}_{ij} \\cdot \\rho(1) = 12 \\cdot \\frac{5}{24}\\,\\text{K}^2$。\n            *   $\\tilde{B}_{ij} = \\frac{60}{24}\\,\\text{K}^2 = \\frac{5}{2}\\,\\text{K}^2 = 2.5\\,\\text{K}^2$。\n结果是精确值，因此无需四舍五入。", "answer": "$$\\boxed{2.5}$$", "id": "3366753"}, {"introduction": "任何资料同化系统的性能都严重依赖于背景和观测误差协方差矩阵 $B$ 和 $R$ 的准确设定。Desroziers 诊断提供了一种强大的、数据驱动的方法，通过检查系统输入和输出之间的统计一致性来评估和调整这些协方差矩阵。在这个练习中 [@problem_id:3366745]，您将使用新息和分析残差的样本来估计给定协方差模型的最优缩放因子，从而阐明一种改进系统性能的实用方法。", "problem": "考虑一个线性的高斯数据同化设定，其线性观测算子为 $H \\in \\mathbb{R}^{p \\times n}$，背景误差和观测误差的协方差矩阵分别为 $B \\in \\mathbb{R}^{n \\times n}$ 和 $R \\in \\mathbb{R}^{p \\times p}$。新息定义为 $v = y - H x^{b}$，分析残差定义为 $w = y - H x^{a}$。在 Desroziers 诊断的框架下，使用以下经过充分检验的关系式将新息和分析残差的二阶统计量与误差协方差联系起来：新息的二阶矩近似于 $H B H^{\\top} + R$，分析残差与新息的交叉二阶矩近似于 $R$。假设实际误差协方差被建模为给定模板的标量倍数，即 $B = \\alpha B_{0}$ 和 $R = \\beta R_{0}$，其中 $\\alpha, \\beta \\in \\mathbb{R}$ 是未知标量，而 $B_{0}$ 和 $R_{0}$ 是已知的对称正定模板。\n\n设观测维度为 $p = 2$，观测算子为 $H = I_{2}$，即 $2 \\times 2$ 的单位矩阵。设协方差模板为\n$$\nB_{0} = \\begin{pmatrix} 3  1 \\\\ 1  2 \\end{pmatrix}, \\qquad R_{0} = \\begin{pmatrix} 1  0 \\\\ 0  2 \\end{pmatrix}.\n$$\n给定 $m = 4$ 组新息和分析残差的配对样本 $\\{(v_{i}, w_{i})\\}_{i=1}^{4}$，具体如下\n$$\nv_{1} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix}, \\quad v_{2} = \\begin{pmatrix} 0 \\\\ 2 \\end{pmatrix}, \\quad v_{3} = \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix}, \\quad v_{4} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix},\n$$\n$$\nw_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad w_{2} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\quad w_{3} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\quad w_{4} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.\n$$\n构建样本二阶矩矩阵\n$$\nS_{vv} = \\frac{1}{m} \\sum_{i=1}^{m} v_{i} v_{i}^{\\top}, \\qquad S_{wv} = \\frac{1}{m} \\sum_{i=1}^{m} w_{i} v_{i}^{\\top}.\n$$\n以 Desroziers 关系式为建模基础，通过最小化弗罗贝尼乌斯范数残差的平方和，确定在最小二乘意义下最佳满足这两个关系的标量 $\\alpha$ 和 $\\beta$。\n$$\nJ(\\alpha, \\beta) = \\left\\| S_{vv} - H (\\alpha B_{0}) H^{\\top} - \\beta R_{0} \\right\\|_{F}^{2} + \\left\\| S_{wv} - \\beta R_{0} \\right\\|_{F}^{2},\n$$\n其中 $\\| X \\|_{F}^{2} = \\operatorname{tr}(X^{\\top} X)$。计算最小化 $J(\\alpha, \\beta)$ 的 $\\alpha$ 和 $\\beta$ 的精确值，并将最终答案表示为一个分别包含 $\\alpha$ 和 $\\beta$ 的 $1 \\times 2$ 行矩阵。不需要四舍五入，也不涉及单位。", "solution": "我们从线性的高斯数据同化设定和 Desroziers 诊断开始，后者提供了新息和分析残差的二阶统计量与误差协方差之间经过充分检验的关系。具体来说，在正确的设定和线性假设下，新息的二阶矩满足 $\\mathbb{E}[v v^{\\top}] \\approx H B H^{\\top} + R$，分析残差与新息之间的交叉二阶矩满足 $\\mathbb{E}[w v^{\\top}] \\approx R$。当使用标量乘子对已知模板 $B_{0}$ 和 $R_{0}$ 进行建模，即 $B = \\alpha B_{0}$ 和 $R = \\beta R_{0}$ 时，这些关系建议在弗罗贝尼乌斯范数的最小二乘意义下拟合\n$$\nS_{vv} \\approx H (\\alpha B_{0}) H^{\\top} + \\beta R_{0}, \\qquad S_{wv} \\approx \\beta R_{0},\n$$\n得到目标函数\n$$\nJ(\\alpha, \\beta) = \\left\\| S_{vv} - \\alpha A - \\beta R_{0} \\right\\|_{F}^{2} + \\left\\| S_{wv} - \\beta R_{0} \\right\\|_{F}^{2},\n$$\n其中 $A = H B_{0} H^{\\top}$。在本问题中，$H = I_{2}$，因此 $A = B_{0}$。\n\n步骤 1：根据所提供的数据计算样本二阶矩矩阵 $S_{vv}$ 和 $S_{wv}$。\n\n对于 $S_{vv}$，计算每个 $v_{i} v_{i}^{\\top}$：\n$$\nv_{1} v_{1}^{\\top} = \\begin{pmatrix} 4  0 \\\\ 0  0 \\end{pmatrix}, \\quad\nv_{2} v_{2}^{\\top} = \\begin{pmatrix} 0  0 \\\\ 0  4 \\end{pmatrix}, \\quad\nv_{3} v_{3}^{\\top} = \\begin{pmatrix} 4  4 \\\\ 4  4 \\end{pmatrix}, \\quad\nv_{4} v_{4}^{\\top} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}.\n$$\n求和并除以 $m = 4$ 得\n$$\nS_{vv} = \\frac{1}{4} \\left( \\begin{pmatrix} 4  0 \\\\ 0  0 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  4 \\end{pmatrix} + \\begin{pmatrix} 4  4 \\\\ 4  4 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix} \\right)\n= \\frac{1}{4} \\begin{pmatrix} 8  4 \\\\ 4  8 \\end{pmatrix} = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}.\n$$\n对于 $S_{wv}$，计算每个 $w_{i} v_{i}^{\\top}$：\n$$\nw_{1} v_{1}^{\\top} = \\begin{pmatrix} 2  0 \\\\ 0  0 \\end{pmatrix}, \\quad\nw_{2} v_{2}^{\\top} = \\begin{pmatrix} 0  0 \\\\ 0  2 \\end{pmatrix}, \\quad\nw_{3} v_{3}^{\\top} = \\begin{pmatrix} 2  2 \\\\ 2  2 \\end{pmatrix}, \\quad\nw_{4} v_{4}^{\\top} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}.\n$$\n求和并除以 $m = 4$ 得\n$$\nS_{wv} = \\frac{1}{4} \\left( \\begin{pmatrix} 2  0 \\\\ 0  0 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  2 \\end{pmatrix} + \\begin{pmatrix} 2  2 \\\\ 2  2 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix} \\right)\n= \\frac{1}{4} \\begin{pmatrix} 4  2 \\\\ 2  4 \\end{pmatrix} = \\begin{pmatrix} 1  \\frac{1}{2} \\\\ \\frac{1}{2}  1 \\end{pmatrix}.\n$$\n\n步骤 2：令 $A = H B_{0} H^{\\top} = B_{0} = \\begin{pmatrix} 3  1 \\\\ 1  2 \\end{pmatrix}$ 且 $R_{0} = \\begin{pmatrix} 1  0 \\\\ 0  2 \\end{pmatrix}$。引入弗罗贝尼乌斯内积 $\\langle X, Y \\rangle = \\operatorname{tr}(X^{\\top} Y)$，因此 $\\| X \\|_{F}^{2} = \\langle X, X \\rangle$。目标函数可以展开为\n$$\nJ(\\alpha, \\beta) = \\left\\langle S_{vv} - \\alpha A - \\beta R_{0},\\, S_{vv} - \\alpha A - \\beta R_{0} \\right\\rangle + \\left\\langle S_{wv} - \\beta R_{0},\\, S_{wv} - \\beta R_{0} \\right\\rangle.\n$$\n对 $\\alpha$ 和 $\\beta$ 求导并将梯度设为零，得到最小二乘最小化问题的正规方程组：\n$$\n\\frac{\\partial J}{\\partial \\alpha} = -2 \\langle S_{vv} - \\alpha A - \\beta R_0, A \\rangle = 0 \\implies \\alpha \\langle A, A \\rangle + \\beta \\langle R_0, A \\rangle = \\langle S_{vv}, A \\rangle\n$$\n$$\n\\frac{\\partial J}{\\partial \\beta} = -2 \\langle S_{vv} - \\alpha A - \\beta R_0, R_0 \\rangle - 2 \\langle S_{wv} - \\beta R_0, R_0 \\rangle = 0 \\implies \\alpha \\langle A, R_0 \\rangle + 2\\beta \\langle R_0, R_0 \\rangle = \\langle S_{vv}, R_0 \\rangle + \\langle S_{wv}, R_0 \\rangle\n$$\n将两个方程都除以 $2$，得到 $2 \\times 2$ 线性系统\n$$\n\\alpha \\langle A, A \\rangle + \\beta \\langle A, R_{0} \\rangle = \\langle S_{vv}, A \\rangle,\n$$\n$$\n\\alpha \\langle A, R_{0} \\rangle + 2 \\beta \\langle R_{0}, R_{0} \\rangle = \\langle S_{vv}, R_{0} \\rangle + \\langle S_{wv}, R_{0} \\rangle.\n$$\n\n步骤 3：计算所需的内积。\n首先，计算 $\\langle A, A \\rangle$：\n$$\n\\langle A, A \\rangle = 3^{2} + 1^{2} + 1^{2} + 2^{2} = 9 + 1 + 1 + 4 = 15.\n$$\n接着，计算 $\\langle A, R_{0} \\rangle$：\n$$\n\\langle A, R_{0} \\rangle = 3 \\cdot 1 + 1 \\cdot 0 + 1 \\cdot 0 + 2 \\cdot 2 = 3 + 0 + 0 + 4 = 7.\n$$\n计算 $\\langle S_{vv}, A \\rangle$：\n$$\n\\langle S_{vv}, A \\rangle = 2 \\cdot 3 + 1 \\cdot 1 + 1 \\cdot 1 + 2 \\cdot 2 = 6 + 1 + 1 + 4 = 12.\n$$\n计算 $\\langle R_{0}, R_{0} \\rangle$：\n$$\n\\langle R_{0}, R_{0} \\rangle = 1^{2} + 0^{2} + 0^{2} + 2^{2} = 1 + 0 + 0 + 4 = 5.\n$$\n计算 $\\langle S_{vv}, R_{0} \\rangle$：\n$$\n\\langle S_{vv}, R_{0} \\rangle = 2 \\cdot 1 + 1 \\cdot 0 + 1 \\cdot 0 + 2 \\cdot 2 = 2 + 0 + 0 + 4 = 6.\n$$\n计算 $\\langle S_{wv}, R_{0} \\rangle$：\n$$\n\\langle S_{wv}, R_{0} \\rangle = 1 \\cdot 1 + \\frac{1}{2} \\cdot 0 + \\frac{1}{2} \\cdot 0 + 1 \\cdot 2 = 1 + 0 + 0 + 2 = 3.\n$$\n\n步骤 4：解线性系统\n$$\n15 \\alpha + 7 \\beta = 12, \\qquad 7 \\alpha + 10 \\beta = 9.\n$$\n求解 $\\alpha$ 和 $\\beta$。将第一个方程乘以 $10$，第二个方程乘以 $7$：\n$$\n150 \\alpha + 70 \\beta = 120, \\qquad 49 \\alpha + 70 \\beta = 63.\n$$\n用第一个方程减去第二个方程：\n$$\n(150 - 49) \\alpha = 120 - 63 \\quad \\Rightarrow \\quad 101 \\alpha = 57 \\quad \\Rightarrow \\quad \\alpha = \\frac{57}{101}.\n$$\n代入 $7 \\alpha + 10 \\beta = 9$ 中：\n$$\n10 \\beta = 9 - 7 \\alpha = 9 - 7 \\cdot \\frac{57}{101} = \\frac{909 - 399}{101} = \\frac{510}{101},\n$$\n因此\n$$\n\\beta = \\frac{51}{101}.\n$$\n\n这些精确的有理数值最小化了指定的最小二乘目标函数，并为在给定设定下与 Desroziers 关系式一致的 $B$ 和 $R$ 提供了标量乘子。", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{57}{101}  \\frac{51}{101}\\end{pmatrix}}$$", "id": "3366745"}]}