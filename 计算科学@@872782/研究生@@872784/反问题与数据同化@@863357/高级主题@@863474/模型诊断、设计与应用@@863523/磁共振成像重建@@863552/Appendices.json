{"hands_on_practices": [{"introduction": "磁共振成像（MRI）的核心在于图像域和其傅里叶变换域（即$k$空间）之间的深刻联系。本实践练习旨在通过编写一个模拟程序，让您亲手体验从$k$空间数据重建MR图像的全过程。您将通过实现不同的$k$空间采样轨迹，直观地观察和量化欠采样对图像质量（如混叠伪影和分辨率损失）的影响，从而为理解更高级的重建技术奠定坚实的基础。[@problem_id:2391669]", "problem": "构建一个程序，该程序通过在指定采样集上沿离散网格填充二维离散傅里叶域（通常称为“k空间”），然后通过二维逆变换进行重建，从而执行磁共振成像 (MRI) 重建的离散模拟。该程序必须实现以下精确的数学定义，并为固定的测试套件生成定量误差度量。\n\n定义：\n- 设 $N$ 为一个正偶数。对于 $n \\in \\{0,\\dots,N-1\\}$ 和 $m \\in \\{0,\\dots,N-1\\}$，定义离散图像 $g[n,m]$ 为\n$$\nx_n = \\frac{n - N/2}{N}, \\quad y_m = \\frac{m - N/2}{N},\n$$\n和\n$$\ng[n,m] = \\exp\\!\\left(-\\frac{(x_n - a_1)^2 + (y_m - b_1)^2}{2 \\sigma_1^2}\\right) + \\alpha \\exp\\!\\left(-\\frac{(x_n - a_2)^2 + (y_m - b_2)^2}{2 \\sigma_2^2}\\right),\n$$\n参数固定为 $a_1 = 0.15$，$b_1 = -0.10$，$\\sigma_1 = 0.08$，$\\alpha = 0.8$，$a_2 = -0.20$，$b_2 = 0.25$，$\\sigma_2 = 0.12$。所有量均为无量纲。\n- 定义 $g[n,m]$ 的二维离散傅里叶变换 (DFT) 为\n$$\nG[k,\\ell] = \\sum_{n=0}^{N-1}\\sum_{m=0}^{N-1} g[n,m] \\exp\\!\\left(-2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right),\n$$\n其中 $k,\\ell \\in \\{0,\\dots,N-1\\}$。\n- 通过索引平移定义“中心化”的傅里叶数组 $K[p,q]$：\n$$\nK[p,q] = G[(p + N/2) \\bmod N,\\; (q + N/2) \\bmod N],\n$$\n其中 $p,q \\in \\{0,\\dots,N-1\\}$。在此表示中，零空间频率位于数组索引 $(p,q) = (N/2, N/2)$ 处。\n- 设采样集 $S \\subseteq \\{0,\\dots,N-1\\}^2$ 指定了中心化数组中要保留的索引。采样后的中心化傅里叶数组为\n$$\n\\widetilde{K}[p,q] = \\begin{cases}\nK[p,q],  \\text{if } (p,q) \\in S,\\\\\n0,  \\text{otherwise,}\n\\end{cases}\n$$\n通过逆向平移可获得未中心化的采样数组\n$$\n\\widetilde{G}[k,\\ell] = \\widetilde{K}[(k - N/2) \\bmod N,\\; (\\ell - N/2) \\bmod N].\n$$\n- 重建的图像是逆DFT\n$$\n\\widetilde{g}[n,m] = \\frac{1}{N^2} \\sum_{k=0}^{N-1}\\sum_{\\ell=0}^{N-1} \\widetilde{G}[k,\\ell] \\exp\\!\\left(2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right).\n$$\n- 将归一化均方根误差 (NRMSE) 定义为无量纲标量\n$$\n\\mathrm{NRMSE} = \\frac{\\left\\| \\widetilde{g} - g \\right\\|_2}{\\left\\| g \\right\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示所有 $N^2$ 个像素上的欧几里得范数，并且在求差时仅使用 $\\widetilde{g}$ 的实部。\n\n采样集构建规则：\n- 设 $c = N/2$（一个整数）表示中心索引。所有角度均以弧度为单位。\n- 舍入规则：当需要将实值坐标映射到离散索引时，必须使用“半值向偶数舍入”规则（当平局时，舍入到最近的偶数整数）将其舍入到最近的整数。\n- 定义 $R_{\\max} = \\lfloor N/2 \\rfloor$。\n\n指定以下四个测试用例，其中 $N = 64$：\n1. 全笛卡尔采样：\n   - 采样集 $S_{\\mathrm{full}} = \\{0,\\dots,N-1\\} \\times \\{0,\\dots,N-1\\}$，表示保留所有中心化的傅里叶系数。\n2. 穿过中心的径向辐条：\n   - 设 $M = 16$。对于每个 $j \\in \\{0,\\dots,M-1\\}$，定义 $\\theta_j = j \\pi / M$。对于每个半径 $r \\in \\{0,1,\\dots,R_{\\max}\\}$，生成一个点\n   $$\n   p = c + \\operatorname{round}\\!\\left(r \\cos \\theta_j\\right), \\quad q = c + \\operatorname{round}\\!\\left(r \\sin \\theta_j\\right),\n   $$\n   使用指定的舍入规则，并且如果 $0 \\le p  N$ 且 $0 \\le q  N$，则将 $(p,q)$ 包含在 $S_{\\mathrm{rad}}$ 中。最终的采样集是所有 $j$ 和 $r$ 的并集（如果存在重复点，不影响结果）。\n3. 穿过中心的阿基米德螺旋线：\n   - 设 $L = 3$（圈数）且 $\\Delta\\theta = \\pi/128$。对于 $s \\in \\{0,1,\\dots,S\\}$，其中 $S = \\left\\lfloor \\frac{2\\pi L}{\\Delta\\theta} \\right\\rfloor$，定义 $\\theta_s = s \\Delta \\theta$ 和半径\n   $$\n   r_s = \\frac{R_{\\max}}{2\\pi L} \\theta_s.\n   $$\n   生成\n   $$\n   p = c + \\operatorname{round}\\!\\left(r_s \\cos \\theta_s\\right), \\quad q = c + \\operatorname{round}\\!\\left(r_s \\sin \\theta_s\\right),\n   $$\n   并且如果 $0 \\le p  N$ 且 $0 \\le q  N$，则将 $(p,q)$ 包含在 $S_{\\mathrm{spi}}$ 中。\n4. 中心化的方形低通区域：\n   - 设 $K_c = 8$。将所有满足 $|p - c| \\le K_c$ 且 $|q - c| \\le K_c$ 的 $(p,q)$ 包含在 $S_{\\mathrm{lp}}$ 中。\n\n对于每个测试用例 $t \\in \\{\\mathrm{full}, \\mathrm{rad}, \\mathrm{spi}, \\mathrm{lp}\\}$：\n- 根据给定的参数，为 $N = 64$ 构建 $g[n,m]$。\n- 计算 $G[k,\\ell]$、$K[p,q]$，通过应用指定的采样集 $S_t$ 形成 $\\widetilde{K}$，通过逆向平移获得 $\\widetilde{G}[k,\\ell]$，最后计算 $\\widetilde{g}[n,m]$。\n- 计算如上定义的 NRMSE。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含与测试用例 $\\left[\\mathrm{full}, \\mathrm{rad}, \\mathrm{spi}, \\mathrm{lp}\\right]$ 顺序对应的四个 NRMSE 值，格式为方括号内以逗号分隔的列表，例如，“[$x_1,x_2,x_3,x_4$]”。每个条目必须是浮点数。\n\n角度单位说明：所有角度均以弧度为单位。不需要物理单位；所有量均为无量纲。", "solution": "问题陈述已经过评估，被认为是有效的。其科学基础在于磁共振成像和数字信号处理的原理，在数学上是适定的，且没有歧义。所有定义、参数和步骤都以足够的严谨性进行了规定，能够得出一个唯一且可验证的解。\n\n任务是模拟从傅里叶域数据重建二维图像的过程，这些数据已根据不同模式进行了子采样。此过程是磁共振成像 (MRI) 的核心，其中被称为k空间的傅里叶域数据是按顺序采集的。重建图像的质量关键取决于采集了哪些k空间样本。我们将计算归一化均方根误差 (NRMSE) 来量化四种不同采样方案下的图像质量。\n\n步骤如下：\n\n1.  **体模图像生成**：\n    首先，我们构建原始离散图像 $g[n,m]$，它作为“基准真相”。该图像定义在一个 $N \\times N$ 的网格上，其中 $N=64$。空间坐标 $(x_n, y_m)$ 被归一化到 $[-0.5, 0.5)$ 域。图像本身是两个高斯函数的叠加，代表一个简化的生物结构。\n    坐标由下式给出：\n    $$\n    x_n = \\frac{n - N/2}{N}, \\quad y_m = \\frac{m - N/2}{N} \\quad \\text{for } n,m \\in \\{0, \\dots, N-1\\}\n    $$\n    图像强度为：\n    $$\n    g[n,m] = \\exp\\!\\left(-\\frac{(x_n - a_1)^2 + (y_m - b_1)^2}{2 \\sigma_1^2}\\right) + \\alpha \\exp\\!\\left(-\\frac{(x_n - a_2)^2 + (y_m - b_2)^2}{2 \\sigma_2^2}\\right)\n    $$\n    参数为：$a_1 = 0.15$，$b_1 = -0.10$，$\\sigma_1 = 0.08$，$\\alpha = 0.8$，$a_2 = -0.20$，$b_2 = 0.25$，$\\sigma_2 = 0.12$。由于 $g[n,m]$ 是实值指数函数的和，它是一个实值数组。\n\n2.  **傅里叶变换 (k空间生成)**：\n    MRI 信号采集过程是对图像的傅里叶变换进行采样。我们通过计算 $g[n,m]$ 的二维离散傅里叶变换 (DFT) 来模拟完整的傅里叶系数集：\n    $$\n    G[k,\\ell] = \\sum_{n=0}^{N-1}\\sum_{m=0}^{N-1} g[n,m] \\exp\\!\\left(-2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right)\n    $$\n    这可以使用快速傅里叶变换 (FFT) 算法高效计算。按照数字信号处理的惯例，零频分量（$k=0, \\ell=0$）位于数组 `G` 的原点。为了便于处理和可视化，通常的做法是将此分量移到数组的中心。这个中心化的数组表示为 $K[p,q]$:\n    $$\n    K[p,q] = G[(p + N/2) \\bmod N,\\; (q + N/2) \\bmod N]\n    $$\n    此操作将低空间频率置于 k 空间数组的中心，将高空间频率置于外围，这反映了在 MRI 中 k 空间通常是如何被概念化的。\n\n3.  **k空间采样**：\n    然后，我们通过创建一个与采样集 $S$ 对应的二元掩码来模拟部分 k 空间采集。对于四个测试用例中的每一个，我们都构建一个唯一的集合 $S$。采样后的 k 空间 $\\widetilde{K}[p,q]$ 是通过将完整的 k 空间 $K[p,q]$ 与该掩码进行逐元素相乘得到的：\n    $$\n    \\widetilde{K}[p,q] = \\begin{cases}\n    K[p,q],  \\text{if } (p,q) \\in S,\\\\\n    0,  \\text{otherwise.}\n    \\end{cases}\n    $$\n    四个采样集 $S_t$ 根据所提供的规则构建：\n    -   $S_{\\mathrm{full}}$：一个简单情况，掩码全为1，代表完整的数据采集。\n    -   $S_{\\mathrm{rad}}$：一组由 $M=16$ 条穿过 k 空间中心的径向线（辐条）构成。\n    -   $S_{\\mathrm{spi}}$：一条具有 $L=3$ 圈的阿基米德螺旋轨迹。\n    -   $S_{\\mathrm{lp}}$：一个方形低通滤波器，仅保留 k 空间的中心 $17 \\times 17$ 区域。\n    对于径向和螺旋线情况，浮点坐标使用“半值向偶数舍入”规则映射到离散网格索引，这是 Python 3 `round()` 函数的默认行为。\n\n4.  **图像重建**：\n    要从采样后的k空间数据重建图像，我们必须首先逆转中心化操作：\n    $$\n    \\widetilde{G}[k,\\ell] = \\widetilde{K}[(k - N/2) \\bmod N,\\; (\\ell - N/2) \\bmod N]\n    $$\n    这将零频分量放回数组的原点，这是标准逆 DFT 算法所要求的。然后通过逆 DFT 计算重建图像 $\\widetilde{g}[n,m]$：\n    $$\n    \\widetilde{g}[n,m] = \\frac{1}{N^2} \\sum_{k=0}^{N-1}\\sum_{\\ell=0}^{N-1} \\widetilde{G}[k,\\ell] \\exp\\!\\left(2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right)\n    $$\n    因子 $1/N^2$ 是逆 DFT 的标准归一化。这也可以使用逆 FFT 算法高效计算。由于 k 空间中的数据已被丢弃，$\\widetilde{K}$ 通常不具备使其逆傅里叶变换为纯实数所需的共轭对称性。因此，$\\widetilde{g}[n,m]$ 将是一个复值数组。\n\n5.  **误差量化**：\n    最后，我们量化由于不完全采样导致的图像质量下降。计算归一化均方根误差 (NRMSE)。按照规定，误差是在原始实值图像 $g$ 和重建的复值图像 $\\widetilde{g}$ 的实部之间计算的：\n    $$\n    \\mathrm{NRMSE} = \\frac{\\left\\| \\mathrm{Re}(\\widetilde{g}) - g \\right\\|_2}{\\left\\| g \\right\\|_2}\n    $$\n    此处，$\\|\\cdot\\|_2$ 是欧几里得（或 Frobenius）范数，在所有 $N^2$ 个像素值上计算。该度量提供了一个无量纲的平均重建误差度量，该误差已通过原始图像的“能量”进行了归一化。\n\n将对四种指定的 k 空间采样策略中的每一种执行这整个过程，并报告所得的 NRMSE 值。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates MRI reconstruction for different k-space sampling patterns\n    and calculates the Normalized Root-Mean-Square Error (NRMSE) for each.\n    \"\"\"\n    # Define problem parameters\n    N = 64\n    params_g = {\n        'a1': 0.15, 'b1': -0.10, 'sigma1': 0.08,\n        'alpha': 0.8,\n        'a2': -0.20, 'b2': 0.25, 'sigma2': 0.12\n    }\n    \n    # 1. Phantom Image Generation\n    def create_phantom(N, params):\n        n = np.arange(N)\n        m = np.arange(N)\n        x_n = (n - N / 2) / N\n        y_m = (m - N / 2) / N\n        xx, yy = np.meshgrid(x_n, y_m, indexing='ij')\n\n        g1 = np.exp(-((xx - params['a1'])**2 + (yy - params['b1'])**2) / (2 * params['sigma1']**2))\n        g2 = params['alpha'] * np.exp(-((xx - params['a2'])**2 + (yy - params['b2'])**2) / (2 * params['sigma2']**2))\n        \n        return g1 + g2\n\n    # 3. k-space Sampling Mask Generation\n    def get_sampling_mask(sampling_type, N):\n        mask = np.zeros((N, N), dtype=bool)\n        c = N / 2\n        R_max = np.floor(N / 2)\n\n        if sampling_type == 'full':\n            mask[:, :] = True\n            \n        elif sampling_type == 'rad':\n            M = 16\n            for j in range(M):\n                theta_j = j * np.pi / M\n                cos_theta = np.cos(theta_j)\n                sin_theta = np.sin(theta_j)\n                for r in range(int(R_max) + 1):\n                    p_float = c + r * cos_theta\n                    q_float = c + r * sin_theta\n                    p = int(round(p_float))\n                    q = int(round(q_float))\n                    if 0 = p  N and 0 = q  N:\n                        mask[p, q] = True\n\n        elif sampling_type == 'spi':\n            L = 3\n            delta_theta = np.pi / 128\n            S = int(np.floor(2 * np.pi * L / delta_theta))\n            for s_idx in range(S + 1):\n                theta_s = s_idx * delta_theta\n                r_s = (R_max / (2 * np.pi * L)) * theta_s\n                p_float = c + r_s * np.cos(theta_s)\n                q_float = c + r_s * np.sin(theta_s)\n                p = int(round(p_float))\n                q = int(round(q_float))\n                if 0 = p  N and 0 = q  N:\n                    mask[p, q] = True\n        \n        elif sampling_type == 'lp':\n            K_c = 8\n            c_int = int(c)\n            p_start, p_end = c_int - K_c, c_int + K_c\n            q_start, q_end = c_int - K_c, c_int + K_c\n            mask[p_start : p_end + 1, q_start : q_end + 1] = True\n        \n        else:\n            raise ValueError(\"Unknown sampling type\")\n            \n        return mask\n\n    # Execute simulation for each test case\n    g_true = create_phantom(N, params_g)\n    norm_g_true = np.linalg.norm(g_true)\n    \n    # 2. Fourier Transformation\n    G = np.fft.fft2(g_true)\n    K = np.fft.fftshift(G)\n    \n    results = []\n    test_cases = ['full', 'rad', 'spi', 'lp']\n\n    for case_name in test_cases:\n        # 3. Apply Sampling\n        sampling_mask = get_sampling_mask(case_name, N)\n        K_tilde = K * sampling_mask\n        \n        # 4. Image Reconstruction\n        G_tilde = np.fft.ifftshift(K_tilde)\n        g_tilde = np.fft.ifft2(G_tilde)\n        \n        # 5. Error Quantification\n        g_tilde_real = np.real(g_tilde)\n        nrmse = np.linalg.norm(g_tilde_real - g_true) / norm_g_true\n        results.append(nrmse)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2391669"}, {"introduction": "在第一个实践中，我们观察到$k$空间采样不足会导致图像伪影。本练习将引导您从理论层面深入探究其根本原因，即采样定理在MRI中的具体体现。您将从第一性原理出发，推导为避免混叠（aliasing）所必须满足的$k$空间采样间隔，并建立空间分辨率与$k$空间覆盖范围之间的数学关系，从而将视场（FOV）、分辨率和采样策略这三大关键参数联系起来。[@problem_id:3399736]", "problem": "考虑一维磁共振成像（MRI）重建，其遵循MRI中使用的标准非幺正傅里叶变换约定，其中物体 $x(r)$ 及其 $k$ 空间变换 $X(k)$ 满足\n$$\nX(k) = \\int_{-\\infty}^{\\infty} x(r)\\,\\exp(-i\\,2\\pi\\,k\\,r)\\,dr,\\qquad\nx(r) = \\int_{-\\infty}^{\\infty} X(k)\\,\\exp(i\\,2\\pi\\,k\\,r)\\,dk.\n$$\n假设物体 $x(r)$ 具有有限支撑模型：存在一个有限长度 $L0$，使得当 $|r|\\frac{L}{2}$ 时，$x(r)=0$。假设在笛卡尔网格上以采样间隔 $\\Delta k0$ 均匀采样 $k$ 空间，即在整数 $n$ 的位置 $k_n=n\\,\\Delta k$ 进行采样，并假设采集的样本数量为 $N$，使得 $k$ 空间窗口对称且近似覆盖 $[-K_{\\max},K_{\\max}]$，其中 $K_{\\max}\\approx \\frac{N\\,\\Delta k}{2}$。重建图像是通过与所选采样相对应的离散逆傅里叶变换获得的。\n\n从上述傅里叶变换定义和基本采样理论（Dirac梳状采样和Poisson求和公式）出发，符号化地推导出在 $x(r)$ 的有限支撑模型下避免混叠的最大允许 $k$ 空间采样间隔，记为 $\\Delta k^{\\star}$。然后，使用一个基于有限 $k$ 空间窗口引起的点扩展函数（PSF）主瓣过零点的物理上有意义的分辨率度量，推导出名义空间分辨率 $\\delta r$ 关于视场（FOV）和样本数 $N$ 的解析表达式。此处，根据上述傅里愈约定，将视场定义为 $\\mathrm{FOV} = \\frac{1}{\\Delta k}$。\n\n最后，对以下参数进行数值计算：支撑长度 $L = 0.18\\,\\mathrm{m}$，视场 $\\mathrm{FOV} = 0.25\\,\\mathrm{m}$，以及样本数 $N=256$。将 $\\Delta k^{\\star}$ 的单位表示为 $\\mathrm{m}^{-1}$，$\\delta r$ 的单位表示为 $\\mathrm{mm}$。将每个数值四舍五入到四位有效数字。\n\n你的最终答案必须是数对 $\\left(\\Delta k^{\\star},\\,\\delta r\\right)$。", "solution": "该问题陈述经评估具有科学依据、提法恰当、客观且自洽。它不包含任何逻辑矛盾或事实错误。因此，我们可以进行形式化求解。\n\n该问题分为两个主要部分：第一，基于基本采样理论推导避免混叠的条件，从而得出最大允许的 $k$ 空间采样间隔 $\\Delta k^{\\star}$；第二，基于有限 $k$ 空间采集窗口产生的点扩展函数（PSF）推导空间分辨率 $\\delta r$。\n\n**第一部分：最大采样间隔 $\\Delta k^{\\star}$ 的推导**\n\n一维物体 $x(r)$ 与其 $k$ 空间表示 $X(k)$ 之间的关系由傅里叶变换对给出：\n$$X(k) = \\int_{-\\infty}^{\\infty} x(r) \\exp(-i 2\\pi kr) dr$$\n$$x(r) = \\int_{-\\infty}^{\\infty} X(k) \\exp(i 2\\pi kr) dk$$\n在 $k$ 空间中对离散位置 $k_n = n \\Delta k$ （$n$为整数）进行采样，可以建模为将连续信号 $X(k)$ 乘以一个 Dirac 梳状函数 $S(k) = \\sum_{n=-\\infty}^{\\infty} \\delta(k - n\\Delta k)$，其中 $\\delta(\\cdot)$ 是 Dirac delta 函数。因此，采样后的 $k$ 空间信号为 $X_s(k) = X(k) \\cdot S(k)$。\n\n重建的图像，我们记为 $x_{rep}(r)$，是采样数据 $X_s(k)$ 的逆傅里叶变换：\n$$x_{rep}(r) = \\mathcal{F}^{-1}\\{X_s(k)\\} = \\mathcal{F}^{-1}\\{X(k) \\cdot S(k)\\}$$\n卷积定理指出，频域（此处分别为 $k$ 域和 $r$ 域）中的乘法等价于时域中的卷积。\n$$x_{rep}(r) = \\left(\\mathcal{F}^{-1}\\{X(k)\\}\\right) * \\left(\\mathcal{F}^{-1}\\{S(k)\\}\\right) = x(r) * s(r)$$\n其中 $s(r)$ 是采样函数 $S(k)$ 的逆傅里叶变换。我们计算 $s(r)$：\n$$s(r) = \\mathcal{F}^{-1}\\left\\{\\sum_{n=-\\infty}^{\\infty} \\delta(k - n\\Delta k)\\right\\} = \\int_{-\\infty}^{\\infty} \\left(\\sum_{n=-\\infty}^{\\infty} \\delta(k - n\\Delta k)\\right) \\exp(i 2\\pi kr) dk$$\n根据线性性质，我们可以交换积分和求和的顺序：\n$$s(r) = \\sum_{n=-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\delta(k - n\\Delta k) \\exp(i 2\\pi kr) dk$$\n利用 Dirac delta 函数的筛选性质 $\\int f(\\xi)\\delta(\\xi - \\xi_0)d\\xi = f(\\xi_0)$，我们得到：\n$$s(r) = \\sum_{n=-\\infty}^{\\infty} \\exp(i 2\\pi (n\\Delta k) r)$$\n这是一个周期性 Dirac delta 函数序列的傅里叶级数表示。根据 Poisson 求和公式，这个和等价于：\n$$s(r) = \\frac{1}{\\Delta k} \\sum_{m=-\\infty}^{\\infty} \\delta\\left(r - \\frac{m}{\\Delta k}\\right)$$\n将此代回 $x_{rep}(r)$ 的表达式中：\n$$x_{rep}(r) = x(r) * \\left(\\frac{1}{\\Delta k} \\sum_{m=-\\infty}^{\\infty} \\delta\\left(r - \\frac{m}{\\Delta k}\\right)\\right)$$\n与一个移位的 delta 函数进行卷积会得到一个移位的函数，因此：\n$$x_{rep}(r) = \\frac{1}{\\Delta k} \\sum_{m=-\\infty}^{\\infty} x\\left(r - \\frac{m}{\\Delta k}\\right)$$\n这个结果表明，重建的图像由原始物体 $x(r)$ 的无限多个复制品组成，这些复制品中心位于位置 $r_m = m/\\Delta k$，并按 $1/\\Delta k$ 的比例缩放。\n\n混叠是这些复制品的重叠。问题陈述中指出，物体 $x(r)$ 具有长度为 $L$ 的有限支撑，即当 $|r|  L/2$ 时 $x(r) = 0$。中心复制品（$m=0$）的支撑区间为 $[-L/2, L/2]$。相邻复制品（$m=1$）的支撑区间为 $[1/\\Delta k - L/2, 1/\\Delta k + L/2]$。为防止混叠，这些支撑区间不能重叠。条件是中心复制品支撑区间的上界必须小于或等于相邻复制品支撑区间的下界：\n$$\\frac{L}{2} \\le \\frac{1}{\\Delta k} - \\frac{L}{2} \\implies L \\le \\frac{1}{\\Delta k}$$\n这意味着采样间隔必须满足 $\\Delta k \\le 1/L$。最大允许采样间隔 $\\Delta k^{\\star}$ 是满足此条件极限情况下的值：\n$$\\Delta k^{\\star} = \\frac{1}{L}$$\n\n**第二部分：名义空间分辨率 $\\delta r$ 的推导**\n\n在总宽度为 $2K_{\\max}$ 的对称 $k$ 空间窗口上采集有限数量的样本 $N$。这可以建模为将理想的 $k$ 空间数据 $X(k)$ 乘以一个矩形窗函数 $W(k) = \\mathrm{rect}(k/(2K_{\\max}))$，该函数在 $|k| \\le K_{\\max}$ 时为1，否则为0。重建的图像 $x_{recon}(r)$ 于是为真实物体 $x(r)$ 与点扩展函数（PSF）的卷积，而 PSF 是窗函数 $W(k)$ 的逆傅里叶变换：\n$$x_{recon}(r) = x(r) * \\mathrm{PSF}(r)$$\nPSF 计算如下：\n$$\\mathrm{PSF}(r) = \\mathcal{F}^{-1}\\{W(k)\\} = \\int_{-K_{\\max}}^{K_{\\max}} 1 \\cdot \\exp(i 2\\pi kr) dk$$\n$$\\mathrm{PSF}(r) = \\left[ \\frac{\\exp(i 2\\pi kr)}{i 2\\pi r} \\right]_{-K_{\\max}}^{K_{\\max}} = \\frac{\\exp(i 2\\pi K_{\\max} r) - \\exp(-i 2\\pi K_{\\max} r)}{i 2\\pi r}$$\n使用欧拉恒等式 $\\sin(\\theta) = (\\exp(i\\theta) - \\exp(-i\\theta))/(2i)$，我们简化表达式：\n$$\\mathrm{PSF}(r) = \\frac{2i\\sin(2\\pi K_{\\max} r)}{i 2\\pi r} = \\frac{\\sin(2\\pi K_{\\max} r)}{\\pi r}$$\n这是一个未归一化的 sinc 函数。名义分辨率 $\\delta r$ 由主瓣的过零点定义，它对应于从中心峰值 $r=0$ 到 PSF 第一个零点的距离。当正弦函数的参数是 $\\pi$ 的整数倍时，出现零点。第一个非零过零点发生在：\n$$|2\\pi K_{\\max} r| = \\pi \\implies |r| = \\frac{1}{2K_{\\max}}$$\n因此，分辨率为 $\\delta r = 1/(2K_{\\max})$。\n$k$ 空间采集的总宽度由 $2K_{\\max} \\approx N \\Delta k$ 给出。将此代入 $\\delta r$ 的表达式：\n$$\\delta r = \\frac{1}{N \\Delta k}$$\n问题将视场定义为 $\\mathrm{FOV} = 1/\\Delta k$。使用这个定义，我们得到名义空间分辨率的最终表达式：\n$$\\delta r = \\frac{\\mathrm{FOV}}{N}$$\n\n**第三部分：数值计算**\n\n给定参数：$L = 0.18\\,\\mathrm{m}$，$\\mathrm{FOV} = 0.25\\,\\mathrm{m}$，以及 $N=256$。\n\n1.  **$\\Delta k^{\\star}$ 的计算**：\n    $$\\Delta k^{\\star} = \\frac{1}{L} = \\frac{1}{0.18\\,\\mathrm{m}} \\approx 5.5555... \\,\\mathrm{m}^{-1}$$\n    四舍五入到四位有效数字，我们得到 $\\Delta k^{\\star} = 5.556\\,\\mathrm{m}^{-1}$。\n\n2.  **$\\delta r$ 的计算**：\n    $$\\delta r = \\frac{\\mathrm{FOV}}{N} = \\frac{0.25\\,\\mathrm{m}}{256} = 0.0009765625\\,\\mathrm{m}$$\n    问题要求结果以毫米为单位（$1\\,\\mathrm{m} = 1000\\,\\mathrm{mm}$）：\n    $$\\delta r = 0.0009765625 \\times 1000\\,\\mathrm{mm} = 0.9765625\\,\\mathrm{mm}$$\n    四舍五入到四位有效数字，我们得到 $\\delta r = 0.9766\\,\\mathrm{mm}$。\n\n得到的数对 $(\\Delta k^{\\star}, \\delta r)$ 包含了所推导出的数值。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.556  0.9766\n\\end{pmatrix}\n}\n$$", "id": "3399736"}, {"introduction": "为了突破奈奎斯特采样定理的限制并加速成像，现代MRI广泛采用压缩感知（Compressed Sensing, CS）技术。CS-MRI成功的关键在于设计一种能够产生非相干混叠伪影的欠采样模式，这些伪影随后可以通过稀疏性正则化被有效去除。本练习将带您探索CS-MRI的核心设计原则，通过推导和比较不同采样策略下的互 coherence，您将从数学上理解为何变速采样（variable-density sampling）相比于均匀随机采样是一种更高效的策略。[@problem_id:3399768]", "problem": "考虑一个图像维度为 $N \\in \\mathbb{N}$ 的一维离散磁共振成像 (MRI) 采集模型。令 $F \\in \\mathbb{C}^{N \\times N}$ 表示酉离散傅里叶变换 (DFT) 矩阵，令 $\\Psi \\in \\mathbb{C}^{N \\times N}$ 表示一个固定的酉稀疏化基（例如，小波基）。测量算子是 $F$ 与 $\\Psi$ 复合后的行子采样，即传感矩阵为 $A = S F \\Psi \\in \\mathbb{C}^{m \\times N}$，其中 $S$ 根据 DFT 频率指数上的概率质量函数 $p = \\{p_{k}\\}_{k=0}^{N-1}$ （有放回地）选择 $F$ 的 $m$ 行。为消除非均匀性导致的采样偏差，假设在构成 $A$ 之前，每个由 $k$ 索引的选定行都被缩放了 $1/\\sqrt{p_{k}}$。\n\n定义第 $k$ 个傅里叶行与稀疏化基 $\\Psi$ 之间的局部相干性为 $\\mu_{k} = \\max_{1 \\leq j \\leq N} |(F\\Psi)_{k j}|$。预处理传感矩阵的互相关性则由其所有行和列在按 $1/\\sqrt{p_k}$ 缩放后的最大幅值项给出。\n\n考虑两种采样方案：\n- 均匀随机采样：对于所有 $k$，$p_{k} = 1/N$。\n- 变密度采样，其边际概率与局部相干性的平方成正比：$p_{k} \\propto \\mu_{k}^{2}$。在实践中，泊松盘变密度采样模式在选定的 $k$ 空间位置之间强制实施最小间距，同时尽可能匹配这些边际概率。\n\n仅从 $F$ 和 $\\Psi$ 的酉性质、互相关性的定义以及基本的概率归一化出发，推导每种方案的互相关性，用 $\\{\\mu_{k}\\}_{k=0}^{N-1}$ 和 $N$ 表示。然后，为变密度互相关性与均匀随机互相关性的比率 $R$ 提供一个单一的封闭形式表达式。在您的推导中，简要解释当 $m$ 固定时，该比率对压缩感知 (CS) MRI 重建保证的影响。\n\n您的最终答案必须是关于 $N$ 和 $\\{\\mu_{k}\\}_{k=0}^{N-1}$ 的单一解析表达式 $R$。不需要进行数值计算，也不应进行四舍五入。", "solution": "该问题要求推导压缩感知磁共振成像 (CS-MRI) 中两种不同采样方案的互相关性度量的比率。我将首先验证问题陈述。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   图像维度: $N \\in \\mathbb{N}$。\n-   酉离散傅里叶变换 (DFT) 矩阵: $F \\in \\mathbb{C}^{N \\times N}$。\n-   酉稀疏化基: $\\Psi \\in \\mathbb{C}^{N \\times N}$。\n-   传感矩阵形式: $A = S F \\Psi$，其中 $S$ 选择 $m$ 行。\n-   采样概率质量函数: $p = \\{p_{k}\\}_{k=0}^{N-1}$。\n-   行缩放：每个选定的行（由 $k$ 索引）被缩放 $1/\\sqrt{p_{k}}$。\n-   局部相干性: $\\mu_{k} = \\max_{1 \\leq j \\leq N} |(F\\Psi)_{k j}|$。\n-   方案的“互相关性”定义：预处理矩阵的最大幅值项，其行为 $\\frac{1}{\\sqrt{p_k}}(F\\Psi)_{k,\\cdot}$。\n-   方案 1 (均匀): 对于所有 $k=0, \\dots, N-1$，$p_k = 1/N$。\n-   方案 2 (变密度): $p_k \\propto \\mu_k^2$。\n-   任务：推导比率 $R = \\frac{\\text{coherence}_{\\text{VD}}}{\\text{coherence}_{\\text{U}}}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题牢固地植根于应用于 MRI 的既定压缩感知理论。所有组成部分——DFT、稀疏变换、变密度采样以及相干性概念——都是该领域的标准内容。\n-   **适定性：** 问题为所有量提供了清晰的定义，包括对“互相关性”的一个特定（尽管非标准）定义。推导所需的所有信息都已提供。\n-   **客观性：** 问题以精确、客观的数学语言陈述。\n\n**步骤 3：结论与行动**\n该问题在科学上是合理的、自洽的且适定的。它被判定为**有效**。我将继续进行推导。\n\n### 推导\n\n令复合矩阵为 $\\Phi = F \\Psi$。由于 $F$ 和 $\\Psi$ 是酉矩阵，它们的乘积 $\\Phi$ 也是一个酉矩阵。该矩阵的项为 $\\Phi_{kj} = (F\\Psi)_{kj}$。局部相干性定义为 $\\mu_k = \\max_{1 \\leq j \\leq N} |\\Phi_{kj}|$。\n\n问题陈述，传感矩阵的行被缩放了 $1/\\sqrt{p_k}$。由此产生的预处理传感矩阵的“互相关性”被定义为任何项可能的最大幅值。这个量，我们记为 $\\mathcal{M}$，是由所有可能的缩放行构成的字典决定的，而不仅仅是被选择的 $m$ 行。因此，对于给定的概率分布 $p = \\{p_k\\}$，相干性由下式给出：\n$$\n\\mathcal{M}(p) = \\max_{k \\in \\{0, \\dots, N-1\\}, j \\in \\{1, \\dots, N\\}} \\left| \\frac{\\Phi_{kj}}{\\sqrt{p_k}} \\right|\n$$\n这可以通过分离最大化操作来简化：\n$$\n\\mathcal{M}(p) = \\max_{k \\in \\{0, \\dots, N-1\\}} \\left( \\frac{1}{\\sqrt{p_k}} \\max_{j \\in \\{1, \\dots, N\\}} |\\Phi_{kj}| \\right) = \\max_{k \\in \\{0, \\dots, N-1\\}} \\frac{\\mu_k}{\\sqrt{p_k}}\n$$\n我们现在为两种指定的采样方案计算这个量。\n\n**1. 均匀随机采样的互相关性**\n\n对于均匀随机采样，选择任何频率指数 $k$ 的概率是相同的。\n$$\np_k = \\frac{1}{N} \\quad \\text{for all } k \\in \\{0, \\dots, N-1\\}\n$$\n我们将此方案的相干性表示为 $\\mathcal{M}_{\\text{U}}$。将 $p_k$ 代入 $\\mathcal{M}(p)$ 的表达式中：\n$$\n\\mathcal{M}_{\\text{U}} = \\max_{k} \\frac{\\mu_k}{\\sqrt{1/N}} = \\max_{k} (\\sqrt{N} \\mu_k)\n$$\n$$\n\\mathcal{M}_{\\text{U}} = \\sqrt{N} \\max_{k} \\mu_k\n$$\n\n**2. 变密度采样的互相关性**\n\n对于此方案，采样概率与局部相干性的平方成正比：\n$$\np_k \\propto \\mu_k^2\n$$\n我们可以将其写为 $p_k = C \\mu_k^2$，其中 $C$ 是某个归一化常数。为了找到 $C$，我们利用概率之和必须为 1 的事实：\n$$\n\\sum_{k=0}^{N-1} p_k = 1 \\implies \\sum_{k=0}^{N-1} C \\mu_k^2 = 1\n$$\n求解 $C$：\n$$\nC = \\frac{1}{\\sum_{j=0}^{N-1} \\mu_j^2}\n$$\n因此，每个指数 $k$ 的概率为：\n$$\np_k = \\frac{\\mu_k^2}{\\sum_{j=0}^{N-1} \\mu_j^2}\n$$\n我们将此方案的相干性表示为 $\\mathcal{M}_{\\text{VD}}$。将 $p_k$ 的这个表达式代入 $\\mathcal{M}(p)$ 的公式中：\n$$\n\\mathcal{M}_{\\text{VD}} = \\max_{k} \\frac{\\mu_k}{\\sqrt{p_k}} = \\max_{k} \\frac{\\mu_k}{\\sqrt{\\frac{\\mu_k^2}{\\sum_{j=0}^{N-1} \\mu_j^2}}}\n$$\n$$\n\\mathcal{M}_{\\text{VD}} = \\max_{k} \\frac{\\mu_k}{\\frac{|\\mu_k|}{\\sqrt{\\sum_{j=0}^{N-1} \\mu_j^2}}}\n$$\n因为 $\\mu_k = \\max_j|\\Phi_{kj}| \\ge 0$，我们有 $|\\mu_k|=\\mu_k$。假设对于所有可能被采样的 $k$，$\\mu_k  0$（如果 $\\mu_k = 0$，则 $p_k=0$，该指数永远不会被采样，因此我们可以从最大化中忽略它），表达式简化为：\n$$\n\\mathcal{M}_{\\text{VD}} = \\max_{k} \\sqrt{\\sum_{j=0}^{N-1} \\mu_j^2}\n$$\n最大化内部的表达式与 $k$ 无关，因此最大值就是表达式本身：\n$$\n\\mathcal{M}_{\\text{VD}} = \\sqrt{\\sum_{k=0}^{N-1} \\mu_k^2}\n$$\n\n**3. 相干性比率及其对 CS-MRI 的影响**\n\n问题要求的是变密度互相关性与均匀随机互相关性的比率 $R$。\n$$\nR = \\frac{\\mathcal{M}_{\\text{VD}}}{\\mathcal{M}_{\\text{U}}} = \\frac{\\sqrt{\\sum_{k=0}^{N-1} \\mu_k^2}}{\\sqrt{N} \\max_{k} \\mu_k}\n$$\n为了理解对 CS-MRI 重建的影响，我们分析 $R$ 的值。令 $\\mu_{\\max} = \\max_{k} \\mu_k$。根据定义，对于所有 $k$，有 $\\mu_k \\leq \\mu_{\\max}$。因此，$\\mu_k^2 \\leq \\mu_{\\max}^2$。对所有 $k$ 求和：\n$$\n\\sum_{k=0}^{N-1} \\mu_k^2 \\leq \\sum_{k=0}^{N-1} \\mu_{\\max}^2 = N \\mu_{\\max}^2\n$$\n对两边取平方根，得到：\n$$\n\\sqrt{\\sum_{k=0}^{N-1} \\mu_k^2} \\leq \\sqrt{N \\mu_{\\max}^2} = \\sqrt{N} \\mu_{\\max}\n$$\n将此与 $R$ 的表达式进行比较，我们看到分子小于或等于分母。因此：\n$$\nR \\leq 1\n$$\n当且仅当对于所有 $k=0, \\dots, N-1$，$\\mu_k = \\mu_{\\max}$ 时，等式成立。在这种情况下，局部相干性是均匀的，变密度采样分布 $p_k \\propto \\mu_k^2$ 变为均匀分布，使得两种方案相同。\n\n在压缩感知理论中，对于固定的稀疏度，保证鲁棒信号重建所需的测量次数 $m$ 与传感矩阵相干性的平方（以及像 $\\log N$ 等其他因素）成正比。较低的相干性意味着需要更少的样本来达到相同的重建质量。由于 $R \\le 1$，变密度采样方案实现的相干性 $\\mathcal{M}_{\\text{VD}}$ 小于或等于均匀采样的相干性 $\\mathcal{M}_{\\text{U}}$。这一关键性能保证参数的降低，说明了为什么变密度采样是 CS-MRI 中一种更有效的策略，因为它允许在固定图像尺寸 $N$ 的情况下，与均匀随机采样相比，实现更高的加速因子（即更少的样本 $m$）。\n\n最终推导出的比率 $R$ 的表达式为：\n$$\nR = \\frac{\\sqrt{\\sum_{k=0}^{N-1} \\mu_k^2}}{\\sqrt{N} \\max_{k} \\mu_k}\n$$", "answer": "$$\n\\boxed{\\frac{\\sqrt{\\sum_{k=0}^{N-1} \\mu_k^2}}{\\sqrt{N} \\max_{k \\in \\{0, \\dots, N-1\\}} \\mu_k}}\n$$", "id": "3399768"}]}