{"hands_on_practices": [{"introduction": "第一个练习将抽象的SVGD理论置于一个具体的计算中。通过为一个简单的双粒子系统手动计算单步更新，您将对核函数和目标分布的得分函数如何相互作用以移动粒子获得切实的感受。这个基础练习对于揭开SVGD更新规则的神秘面纱至关重要。[@problem_id:3348310]", "problem": "考虑 Stein 变分梯度下降 (SVGD)，该方法通过在再生核希尔伯特空间 (RKHS) 中的速度场输运粒子分布，从而对 Kullback-Leibler 散度执行泛函梯度下降。在一维情况下，对于可微目标密度 $p(x)$，作用于标量测试函数 $f$ 的 Stein 算子为 $T_{p} f(x) = f^{\\prime}(x) + f(x)\\,\\nabla_{x} \\ln p(x)$。设目标为标准正态密度 $p(x) = \\mathcal{N}(0,1)$，RKHS 由带宽参数为 $h > 0$ 的径向基函数 (RBF) 核 $k_{h}(x,x^{\\prime}) = \\exp\\!\\big(-\\frac{(x-x^{\\prime})^{2}}{2 h^{2}}\\big)$ 导出。给定两个初始粒子，位置分别为 $x_{1}^{(0)} = -1$ 和 $x_{2}^{(0)} = 2$。使用 SVGD 框架，从 Stein 算子定义和 RKHS 的表示定理性质出发（不假定任何预先给定的闭式更新形式），推导步长为 $\\epsilon > 0$ 的单次迭代的经验 SVGD 粒子更新，然后将更新后的粒子位置 $x_{1}^{(1)}$ 和 $x_{2}^{(1)}$ 计算为 $h$ 和 $\\epsilon$ 的显式解析函数。以精确的闭式形式（无舍入）表示你的最终结果。最终答案必须是包含 $x_{1}^{(1)}$ 和 $x_{2}^{(1)}$（作为 $h$ 和 $\\epsilon$ 的函数）的单个行向量。", "solution": "此题要求推导 Stein 变分梯度下降 (SVGD) 的更新规则，并将其应用于一个特定的双粒子系统。\n\n### 步骤 1：问题有效性验证\n根据指定标准对问题陈述进行验证。\n\n- **已知条件**：\n    -   方法：Stein 变分梯度下降 (SVGD)。\n    -   Stein 算子（一维）：$T_{p} f(x) = f^{\\prime}(x) + f(x)\\,\\nabla_{x} \\ln p(x)$。\n    -   目标密度：$p(x) = \\mathcal{N}(0,1)$，即标准正态分布。\n    -   再生核希尔伯特空间 (RKHS)：由带宽为 $h > 0$ 的径向基函数 (RBF) 核 $k_{h}(x,x^{\\prime}) = \\exp(-\\frac{(x-x^{\\prime})^{2}}{2 h^{2}})$ 导出。\n    -   初始粒子位置：$x_{1}^{(0)} = -1$ 和 $x_{2}^{(0)} = 2$。\n    -   粒子数量：$N=2$。\n    -   迭代步长：$\\epsilon > 0$。\n-   **验证**：\n    -   **科学依据：** 该问题使用了贝叶斯推断、机器学习和泛函分析（SVGD、KL 散度、RKHS、Stein 方法）中的标准、成熟概念。该问题在科学上是合理的。\n    -   **适定性：** 该问题提供了计算粒子位置唯一单步更新所需的所有信息（目标密度、核函数、初始条件、步长）。\n    -   **客观性：** 该问题以精确的技术语言表述，没有主观或模糊的成分。\n    -   该问题是自洽、一致且可行的。\n\n-   **结论**：该问题有效。\n\n### 步骤 2：SVGD 更新规则的推导\n\nSVGD 的目标是通过对粒子施加一个速度场 $\\phi(x)$，将初始粒子分布 $q_0$ 输运到目标分布 $p$。粒子更新方式为 $x' = x + \\epsilon \\phi(x)$。最优速度场 $\\phi(x)$ 是在每一步中最大程度减小 Kullback-Leibler (KL) 散度 $\\mathrm{KL}(q_k \\| p)$ 的那个场。这对应于在 RKHS $\\mathcal{H}$ 中对 KL 散度执行泛函梯度下降。\n\nKL 散度关于 $\\phi$ 方向扰动的方向导数由下式给出：\n$$ \\nabla_{\\phi} \\mathrm{KL}(q \\| p) = - \\mathbb{E}_{x \\sim q}[T_p \\phi(x)] $$\n其中 $T_p$ 是 Stein 算子。为实现最速下降，我们必须选择 $\\phi$ 以最大化 $\\mathbb{E}_{x \\sim q}[T_p \\phi(x)]$，并满足 $\\phi$ 位于 RKHS 中单位球内的约束，即 $\\|\\phi\\|_{\\mathcal{H}} \\le 1$。\n\n表达式 $F[\\phi] = \\mathbb{E}_{x \\sim q}[T_p \\phi(x)]$ 是 $\\phi$ 的一个线性泛函。根据 Riesz 表示定理，对于 RKHS 上的任何此类线性泛函，都存在唯一的元素 $\\psi_q \\in \\mathcal{H}$，使得对所有 $\\phi \\in \\mathcal{H}$ 都有 $F[\\phi] = \\langle \\phi, \\psi_q \\rangle_{\\mathcal{H}}$。在范数约束下最大化此内积的函数是 $\\phi = \\psi_q / \\|\\psi_q\\|_{\\mathcal{H}}$。因此，最速上升方向由 $\\psi_q$ 给出。\n\n我们可以利用核函数 $k(x, x')$ 的再生性质找到 $\\psi_q$。对于任何函数 $f \\in \\mathcal{H}$ 和点 $y$，我们有 $f(y) = \\langle f(\\cdot), k(y, \\cdot) \\rangle_{\\mathcal{H}}$。将此应用于 $\\psi_q$：\n$$ \\psi_q(y) = \\langle \\psi_q(\\cdot), k(y, \\cdot) \\rangle_{\\mathcal{H}} $$\n由于内积是对称的，$\\langle f, g \\rangle_{\\mathcal{H}} = \\langle g, f \\rangle_{\\mathcal{H}}$，并且根据 $\\psi_q$ 的定义，我们有 $\\langle k(y, \\cdot), \\psi_q(\\cdot) \\rangle_{\\mathcal{H}} = F[k(y, \\cdot)]$。因此：\n$$ \\psi_q(y) = F[k(y, \\cdot)] = \\mathbb{E}_{x \\sim q}[T_{p,x} k(y, x)] $$\n此处，$T_{p,x}$ 表示 Stein 算子作用于作为其第二个参数 $x$ 的函数的 $k(y,x)$。\n对于对称核 $k(y,x) = k(x,y)$，在点 $y$ 处的​​最优速度场为：\n$$ \\phi^*(y) = \\psi_q(y) = \\mathbb{E}_{x \\sim q}[T_{p,x} k(x,y)] = \\mathbb{E}_{x \\sim q}[\\nabla_x k(x,y) + k(x,y) \\nabla_x \\ln p(x)] $$\n在实践中，对 $q$ 的期望通过当前 $N$ 个粒子集合 $\\{x_i\\}_{i=1}^N$ 上的经验平均来近似：\n$$ \\phi(y) \\approx \\frac{1}{N} \\sum_{i=1}^N [\\nabla_{x_i} k(x_i, y) + k(x_i, y) \\nabla_{x_i} \\ln p(x_i)] $$\n粒子 $x_j$ 的 SVGD 更新则为 $x_j^{(t+1)} = x_j^{(t)} + \\epsilon \\phi(x_j^{(t)})$，其中速度场在粒子的当前位置 $x_j^{(t)}$ 处进行评估：\n$$ \\phi(x_j^{(t)}) = \\frac{1}{N} \\sum_{i=1}^N [\\nabla_{x_i} k(x_i^{(t)}, x_j^{(t)}) + k(x_i^{(t)}, x_j^{(t)}) \\nabla_{x_i} \\ln p(x_i^{(t)})] $$\n\n### 步骤 3：应用于给定问题\n\n我们将推导出的更新规则应用于问题的具体细节。\n1.  **目标分布**：$p(x) = \\mathcal{N}(0,1) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-\\frac{x^2}{2})$。\n    对数密度为 $\\ln p(x) = -\\frac{x^2}{2} - \\frac{1}{2}\\ln(2\\pi)$。\n    分数函数（对数密度的梯度）为 $\\nabla_x \\ln p(x) = -x$。\n\n2.  **核函数**：RBF 核为 $k(x, x') = \\exp(-\\frac{(x-x')^2}{2h^2})$。\n    其关于第一个参数的梯度是：\n    $$ \\nabla_x k(x, x') = \\frac{\\partial}{\\partial x} \\exp\\left(-\\frac{(x-x')^2}{2h^2}\\right) = \\exp\\left(-\\frac{(x-x')^2}{2h^2}\\right) \\cdot \\left(-\\frac{2(x-x')}{2h^2}\\right) = -k(x,x') \\frac{x-x'}{h^2} $$\n\n3.  **粒子更新方程**：设第 $t=0$ 次迭代时的粒子位置为 $\\{x_i^{(0)}\\}_{i=1}^N$。粒子 $x_j^{(0)}$ 的速度场为：\n    $$ \\phi(x_j^{(0)}) = \\frac{1}{N} \\sum_{i=1}^N \\left[ -k(x_i^{(0)}, x_j^{(0)}) \\frac{x_i^{(0)} - x_j^{(0)}}{h^2} + k(x_i^{(0)}, x_j^{(0)}) (-x_i^{(0)}) \\right] $$\n    $$ \\phi(x_j^{(0)}) = \\frac{1}{N} \\sum_{i=1}^N k(x_i^{(0)}, x_j^{(0)}) \\left( -\\frac{x_i^{(0)} - x_j^{(0)}}{h^2} - x_i^{(0)} \\right) $$\n\n4.  **初始条件**：我们有 $N=2$ 个粒子，位于 $x_1^{(0)} = -1$ 和 $x_2^{(0)} = 2$。\n\n5.  **计算 $x_1^{(1)}$ 的更新**：令 $j=1$。\n    $$ \\phi(x_1^{(0)}) = \\frac{1}{2} \\left[ k(x_1^{(0)}, x_1^{(0)}) \\left( -\\frac{x_1^{(0)} - x_1^{(0)}}{h^2} - x_1^{(0)} \\right) + k(x_2^{(0)}, x_1^{(0)}) \\left( -\\frac{x_2^{(0)} - x_1^{(0)}}{h^2} - x_2^{(0)} \\right) \\right] $$\n    我们计算各项：\n    -   $x_1^{(0)} = -1$, $x_2^{(0)} = 2$。\n    -   $k(x_1^{(0)}, x_1^{(0)}) = \\exp(0) = 1$。\n    -   $k(x_2^{(0)}, x_1^{(0)}) = \\exp\\left(-\\frac{(2 - (-1))^2}{2h^2}\\right) = \\exp\\left(-\\frac{9}{2h^2}\\right)$。\n    -   $i=1$ 的项：$1 \\cdot (0 - (-1)) = 1$。\n    -   $i=2$ 的项：$\\exp\\left(-\\frac{9}{2h^2}\\right) \\left( -\\frac{2 - (-1)}{h^2} - 2 \\right) = \\exp\\left(-\\frac{9}{2h^2}\\right) \\left( -\\frac{3}{h^2} - 2 \\right)$。\n    速度为：\n    $$ \\phi(x_1^{(0)}) = \\frac{1}{2} \\left[ 1 - \\left( \\frac{3}{h^2} + 2 \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right] $$\n    更新后的粒子位置是：\n    $$ x_1^{(1)} = x_1^{(0)} + \\epsilon \\phi(x_1^{(0)}) = -1 + \\frac{\\epsilon}{2} \\left[ 1 - \\left( 2 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right] $$\n\n6.  **计算 $x_2^{(1)}$ 的更新**：令 $j=2$。\n    $$ \\phi(x_2^{(0)}) = \\frac{1}{2} \\left[ k(x_1^{(0)}, x_2^{(0)}) \\left( -\\frac{x_1^{(0)} - x_2^{(0)}}{h^2} - x_1^{(0)} \\right) + k(x_2^{(0)}, x_2^{(0)}) \\left( -\\frac{x_2^{(0)} - x_2^{(0)}}{h^2} - x_2^{(0)} \\right) \\right] $$\n    我们计算各项：\n    -   $k(x_1^{(0)}, x_2^{(0)}) = \\exp\\left(-\\frac{(-1 - 2)^2}{2h^2}\\right) = \\exp\\left(-\\frac{9}{2h^2}\\right)$。\n    -   $k(x_2^{(0)}, x_2^{(0)}) = 1$。\n    -   $i=1$ 的项：$\\exp\\left(-\\frac{9}{2h^2}\\right) \\left( -\\frac{-1 - 2}{h^2} - (-1) \\right) = \\exp\\left(-\\frac{9}{2h^2}\\right) \\left( \\frac{3}{h^2} + 1 \\right)$。\n    -   $i=2$ 的项：$1 \\cdot (0 - 2) = -2$。\n    速度为：\n    $$ \\phi(x_2^{(0)}) = \\frac{1}{2} \\left[ \\left( \\frac{3}{h^2} + 1 \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) - 2 \\right] $$\n    更新后的粒子位置是：\n    $$ x_2^{(1)} = x_2^{(0)} + \\epsilon \\phi(x_2^{(0)}) = 2 + \\frac{\\epsilon}{2} \\left[ \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) - 2 \\right] $$\n    化简为：\n    $$ x_2^{(1)} = 2 - \\epsilon + \\frac{\\epsilon}{2} \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) $$\n更新后的粒子位置的最终表达式为：\n$$ x_1^{(1)} = -1 + \\frac{\\epsilon}{2} \\left[ 1 - \\left( 2 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right] $$\n$$ x_2^{(1)} = 2 - \\epsilon + \\frac{\\epsilon}{2} \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-1 + \\frac{\\epsilon}{2} \\left( 1 - \\left(2 + \\frac{3}{h^2}\\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right) & 2 - \\epsilon + \\frac{\\epsilon}{2} \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right)\n\\end{pmatrix}\n}\n$$", "id": "3348310"}, {"introduction": "SVGD的有效性源于两种力量之间的精妙平衡：一个是将粒子拉向高概率区域的“吸引力”，另一个是促进粒子多样性的“排斥力”。本练习将这些分量分离开来，让您能够量化排斥力并确定系统达到平衡的确切条件。理解这种相互作用是掌握SVGD如何避免其他方法中常见的粒子坍缩问题的关键。[@problem_id:3348300]", "problem": "考虑 Stein 变分梯度下降 (SVGD)，它由一个泛函梯度流定义，该梯度流输运一组粒子来逼近目标密度 $p(x)$。对于 $\\mathbb{R}^{d}$ 中的一个包含 $n$ 个粒子的有限集合 $\\{x_{i}\\}_{i=1}^{n}$，粒子 $x_{i}$ 处的经验 SVGD 速度为\n$$\n\\phi(x_{i}) \\;=\\; \\frac{1}{n} \\sum_{j=1}^{n} \\Big( k(x_{j},x_{i}) \\,\\nabla \\ln p(x_{j}) \\;+\\; \\nabla_{x_{j}} k(x_{j},x_{i}) \\Big),\n$$\n其中 $k(x,y)$ 是一个正定核，$\\nabla$ 表示对其参数的梯度。在 SVGD 中，第一项是朝向高密度区域的吸引力，第二项是散开粒子的排斥力。令核函数为高斯径向基函数 (RBF) 核 $k(x,y) = \\exp\\!\\big(-\\|x-y\\|^{2}/(2 h^{2})\\big)$，其带宽 $h>0$。\n\n任务 A (排斥力的尺度)：在一维 ($d=1$) 情况下，对于位于 $x_{1}$ 和 $x_{2}$ 的 $n=2$ 个粒子，其粒子间距离为 $d = |x_{1}-x_{2}|$，推导出来自 $x_{2}$ 对 $x_{1}$ 速度的成对排斥贡献的大小，该大小应是 $d$ 和 $h$ 的函数。您必须只使用 $d$ 和 $h$ 以闭合形式表达它。\n\n任务 B (模式坍塌的量化避免)：考虑一维高斯目标 $p(x) = \\mathcal{N}(0,\\sigma^{2})$，其方差 $\\sigma^{2} > 0$。将 $n=2$ 个粒子对称地放置在 $x_{1}=a$ 和 $x_{2}=-a$ 处，其中 $a>0$。仅使用上述 SVGD 定义和给定的 RBF 核，计算 $x_{1}$ 处的 SVGD 速度的径向分量指向外部（即，增加 $|a|$）的精确条件。然后，求解唯一的临界分离距离 $a_{c}(h,\\sigma)$，在该距离下 $x_{1}$ 处的径向 SVGD 速度恰好为零。您的最终答案必须是 $a_{c}(h,\\sigma)$ 的单个闭合形式解析表达式，不含未求值的极限或隐式定义。\n\n答案格式要求：仅提供 $a_{c}(h,\\sigma)$ 的解析表达式作为最终答案。不包括单位。无需四舍五入。", "solution": "用户提供了一个关于 Stein 变分梯度下降 (SVGD) 性质的有效问题陈述。该问题具有科学依据，提法明确，并包含了进行严格数学推导所需的所有信息。我将着手给出一个完整的解答。\n\n问题分为两个任务。我将按顺序解决它们，以得出最终所需的临界分离距离 $a_{c}(h, \\sigma)$ 的表达式。\n\n首先，让我们建立必要的数学组件。\n粒子 $x_i$ 处的 SVGD 速度由下式给出：\n$$ \\phi(x_{i}) = \\frac{1}{n} \\sum_{j=1}^{n} \\left( k(x_{j},x_{i}) \\nabla \\ln p(x_{j}) + \\nabla_{x_{j}} k(x_{j},x_{i}) \\right) $$\n核函数是一维 ($d=1$) 高斯 RBF 核：\n$$ k(x,y) = \\exp\\left(-\\frac{(x-y)^2}{2h^2}\\right) $$\n核函数对其第一个参数 $x_j$ 的梯度为：\n$$ \\nabla_{x_{j}} k(x_{j},x_{i}) = \\frac{\\partial}{\\partial x_j} \\exp\\left(-\\frac{(x_j-x_i)^2}{2h^2}\\right) = \\exp\\left(-\\frac{(x_j-x_i)^2}{2h^2}\\right) \\cdot \\left(-\\frac{2(x_j-x_i)}{2h^2}\\right) = -\\frac{x_j-x_i}{h^2} k(x_j,x_i) $$\n\n**任务 A：排斥力的尺度**\n\n此任务要求计算来自粒子 $x_2$ 对粒子 $x_1$ 速度的成对排斥贡献的大小。粒子数量为 $n=2$。排斥贡献是速度更新中涉及核梯度的部分。对于速度 $\\phi(x_1)$，对应于 $j=2$ 的项包含了来自 $x_2$ 的排斥。此贡献由 $\\frac{1}{n} \\nabla_{x_2} k(x_2, x_1)$ 给出。\n\n使用 $n=2$ 和上面计算出的导数：\n$$ \\text{来自 } x_2 \\text{ 对 } x_1 \\text{ 的排斥力} = \\frac{1}{2} \\nabla_{x_2} k(x_2, x_1) = \\frac{1}{2} \\left( -\\frac{x_2-x_1}{h^2} k(x_2, x_1) \\right) = \\frac{x_1-x_2}{2h^2} k(x_1, x_2) $$\n问题要求此项的大小。令 $d = |x_1 - x_2|$。核 $k(x_1, x_2)$ 总是正的。\n$$ k(x_1, x_2) = \\exp\\left(-\\frac{(x_1-x_2)^2}{2h^2}\\right) = \\exp\\left(-\\frac{d^2}{2h^2}\\right) $$\n因此，大小为：\n$$ \\left| \\frac{x_1-x_2}{2h^2} k(x_1, x_2) \\right| = \\frac{|x_1-x_2|}{2h^2} k(x_1, x_2) = \\frac{d}{2h^2} \\exp\\left(-\\frac{d^2}{2h^2}\\right) $$\n该表达式表示一个粒子对另一个粒子施加的排斥力的大小，它是它们之间距离 $d$ 和核带宽 $h$ 的函数。\n\n**任务 B：模式坍塌的量化避免**\n\n此任务要求我们为一个特定的设置找到临界分离距离 $a_c(h, \\sigma)$。\n给定的设置为：\n- 维度：$d=1$。\n- 粒子数量：$n=2$。\n- 粒子位置：$x_1 = a$ 和 $x_2 = -a$，其中 $a > 0$。\n- 目标密度：$p(x) = \\mathcal{N}(0, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$。\n\n我们首先计算对数目标密度的梯度：\n$$ \\ln p(x) = -\\ln(\\sqrt{2\\pi}\\sigma) - \\frac{x^2}{2\\sigma^2} $$\n$$ \\nabla \\ln p(x) = \\frac{d}{dx} \\ln p(x) = -\\frac{x}{\\sigma^2} $$\n在粒子位置处，我们有：\n$$ \\nabla \\ln p(x_1) = \\nabla \\ln p(a) = -\\frac{a}{\\sigma^2} $$\n$$ \\nabla \\ln p(x_2) = \\nabla \\ln p(-a) = -\\frac{-a}{\\sigma^2} = \\frac{a}{\\sigma^2} $$\n\n接下来，我们计算在 $x_1 = a$ 处的 SVGD 速度。速度表达式为：\n$$ \\phi(x_1) = \\frac{1}{2} \\left[ \\left( k(x_1, x_1) \\nabla\\ln p(x_1) + \\nabla_{x_1} k(x_1, x_1) \\right) + \\left( k(x_2, x_1) \\nabla\\ln p(x_2) + \\nabla_{x_2} k(x_2, x_1) \\right) \\right] $$\n我们计算和中的每一项：\n\n第 1 项（与自身相互作用，j=1）：\n- $k(x_1, x_1) = k(a,a) = \\exp(0) = 1$。\n- $\\nabla\\ln p(x_1) = -a/\\sigma^2$。\n- $\\nabla_{x_1} k(x_1, x_1) = -\\frac{x_1-x_1}{h^2} k(x_1,x_1) = 0$。\n所以，方括号中的第一项是 $(1 \\cdot (-a/\\sigma^2) + 0) = -a/\\sigma^2$。\n\n第 2 项（与 $x_2$ 相互作用，j=2）：\n- $x_2 - x_1 = -a - a = -2a$。\n- $k(x_2, x_1) = k(-a, a) = \\exp\\left(-\\frac{(-2a)^2}{2h^2}\\right) = \\exp\\left(-\\frac{2a^2}{h^2}\\right)$。\n- $\\nabla\\ln p(x_2) = a/\\sigma^2$。\n- $\\nabla_{x_2} k(x_2, x_1) = -\\frac{x_2-x_1}{h^2} k(x_2, x_1) = -\\frac{-2a}{h^2} \\exp\\left(-\\frac{2a^2}{h^2}\\right) = \\frac{2a}{h^2} \\exp\\left(-\\frac{2a^2}{h^2}\\right)$。\n所以，方括号中的第二项是：\n$$ \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\cdot \\left(\\frac{a}{\\sigma^2}\\right) + \\frac{2a}{h^2} \\exp\\left(-\\frac{2a^2}{h^2}\\right) = \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\left( \\frac{a}{\\sigma^2} + \\frac{2a}{h^2} \\right) $$\n\n现在，我们组合出 $\\phi(x_1)$ 的完整表达式：\n$$ \\phi(x_1) = \\frac{1}{2} \\left[ -\\frac{a}{\\sigma^2} + \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\left( \\frac{a}{\\sigma^2} + \\frac{2a}{h^2} \\right) \\right] $$\n提出因子 $a/2$：\n$$ \\phi(x_1) = \\frac{a}{2} \\left[ -\\frac{1}{\\sigma^2} + \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\left( \\frac{1}{\\sigma^2} + \\frac{2}{h^2} \\right) \\right] $$\n临界分离距离 $a_c$ 被定义为速度为零时的 $a$ 值，即 $\\phi(x_1) = 0$。因为给定 $a>0$，我们需要方括号中的项为零。令 $a = a_c$：\n$$ -\\frac{1}{\\sigma^2} + \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) \\left( \\frac{1}{\\sigma^2} + \\frac{2}{h^2} \\right) = 0 $$\n$$ \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) \\left( \\frac{1}{\\sigma^2} + \\frac{2}{h^2} \\right) = \\frac{1}{\\sigma^2} $$\n$$ \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) = \\frac{1/\\sigma^2}{1/\\sigma^2 + 2/h^2} $$\n为简化右侧，我们通分：\n$$ \\frac{1/\\sigma^2}{(h^2 + 2\\sigma^2)/(\\sigma^2 h^2)} = \\frac{1}{\\sigma^2} \\cdot \\frac{\\sigma^2 h^2}{h^2 + 2\\sigma^2} = \\frac{h^2}{h^2 + 2\\sigma^2} $$\n$a_c$ 的方程是：\n$$ \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) = \\frac{h^2}{h^2 + 2\\sigma^2} $$\n为求解 $a_c$，我们对两边取自然对数：\n$$ -\\frac{2a_c^2}{h^2} = \\ln\\left(\\frac{h^2}{h^2 + 2\\sigma^2}\\right) $$\n使用性质 $\\ln(x/y) = -\\ln(y/x)$：\n$$ \\frac{2a_c^2}{h^2} = \\ln\\left(\\frac{h^2 + 2\\sigma^2}{h^2}\\right) = \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right) $$\n现在，我们求解 $a_c^2$：\n$$ a_c^2 = \\frac{h^2}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right) $$\n由于 $a > 0$，我们取正平方根：\n$$ a_c(h, \\sigma) = \\sqrt{\\frac{h^2}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right)} $$\n这可以写成：\n$$ a_c(h, \\sigma) = h \\sqrt{\\frac{1}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right)} $$\n这是使得 $x_1=a$ 处的 SVGD 速度为零的唯一临界分离距离。当 $a < a_c$ 时，项 $\\exp(-2a^2/h^2)$ 更大，使得速度为正（向外的排斥力占主导）。当 $a > a_c$ 时，速度为负（朝向 $x=0$ 处模式的吸引力占主导）。", "answer": "$$ \\boxed{h \\sqrt{\\frac{1}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right)}} $$", "id": "3348300"}, {"introduction": "SVGD如何在一个复杂的多模态概率景观中进行探索？这个高级练习要求您分析算法的稳定性，并预测其在面对双峰目标分布时的行为。通过对SVGD动态进行线性化，您将推导出一个条件，用以判断初始位于两峰之间的粒子是会分裂并探索两个模式，还是会被困住。这种分析为了解SVGD的全局探索能力提供了深刻的洞见。[@problem_id:3348233]", "problem": "考虑一个一维目标概率密度，它是由两个相隔一定距离的对称高斯分量混合而成，以及从以原点为中心的单峰初始化开始的 Stein 变分梯度下降 (SVGD) 动力学。目标是从第一性原理出发，推导出一个条件，用以预测在早期，SVGD 粒子系统是否会分裂成两组，并分别向目标的两个模式移动。\n\n您已获得以下基本定义：\n\n- 目标密度是一个对称混合分布\n$$\np(x) = \\tfrac{1}{2} \\,\\mathcal{N}(x \\mid -m, s^2) + \\tfrac{1}{2} \\,\\mathcal{N}(x \\mid m, s^2),\n$$\n其中 $\\mathcal{N}(x \\mid \\mu, \\sigma^2)$ 表示均值为 $\\mu$、方差为 $\\sigma^2$ 的高斯密度，参数 $m > 0$ 和 $s > 0$ 分别代表半分离距离和分量标准差。\n\n- Stein 变分梯度下降 (SVGD) 根据再生核希尔伯特空间 (RKHS) 中的泛函梯度更新 $n$ 个粒子 $\\{x_i\\}_{i=1}^n$，得到向量场\n$$\n\\phi(x) \\;=\\; \\mathbb{E}_{X \\sim q}\\Big[\\,k(X,x)\\,\\nabla \\log p(X) \\;+\\; \\nabla_X k(X,x)\\,\\Big],\n$$\n其中 $q$ 是当前的粒子经验分布， $k$ 是一个正定核， $\\nabla$ 表示对参数的导数。在连续极限下，作用于粒子位置 $x$ 的 SVGD 输运场由上述期望给出。径向基函数 (RBF) 核定义为\n$$\nk(x,y) \\;=\\; \\exp\\!\\left(-\\frac{(x-y)^2}{2 h^2}\\right),\n$$\n带宽 $h > 0$。\n\n- 初始化是在原点处的单峰分布，具有一个很小但非零的方差，\n$$\nq_0 \\;=\\; \\mathcal{N}(x \\mid 0, v_0),\n$$\n其中 $v_0 > 0$ 表示粒子在 $x = 0$ 周围的初始散布程度。\n\n任务：\n\n1. 仅使用上述定义以及高斯积分和导数的标准性质，在连续近似 $q \\approx q_0$ 下，推导 SVGD 输运场 $\\phi(x)$ 在 $x = 0$ 附近的线性化。证明位于位置 $x$ 的粒子在早期的动力学满足以下形式的方程\n$$\n\\frac{dx}{dt} \\;\\approx\\; A\\,x,\n$$\n并从第一性原理出发，得到增长系数 $A$ 作为 $m$、$s$、$h$ 和 $v_0$ 的函数的显式表达式。\n\n2. 论证为什么 $A$ 的符号决定了分裂行为：如果 $A > 0$，一个无穷小的位移 $x > 0$ 会增长，导致质量朝两个模式分裂；如果 $A \\le 0$，则原点不是线性不稳定的，在线性化动力学下质量不会分裂。\n\n3. 实现一个程序，对下面的每个测试用例，计算 $A$ 的值并输出一个布尔值，以指示是否预测会发生分裂（如果 $A > 0$ 则为 $\\text{True}$，否则为 $\\text{False}$）。您的计算必须在科学上是合理的，并且在可用时可以使用精确的高斯期望，在需要计算涉及 $\\tanh(\\cdot)$ 的期望时可以使用数值积分。\n\n测试套件：\n\n- 情况 1： $(m, s, h, v_0) = (3, 1, 1, 0.01)$\n- 情况 2： $(m, s, h, v_0) = (3, 1, 3.0, 0.01)$\n- 情况 3： $(m, s, h, v_0) = (0.5, 1, 1.0, 0.01)$\n- 情况 4： $(m, s, h, v_0) = (3, 1, 0.05, 0.001)$\n- 情况 5： $(m, s, h, v_0) = (3, 1, 1.0, 1.0)$\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果；例如，对于三个测试用例，格式将是\n$$\n[\\text{True},\\text{False},\\text{True}].\n$$\n不应打印任何额外文本。", "solution": "用户希望我推导出一个用于 Stein 变分梯度下降 (SVGD) 中粒子系统分裂的条件，并实现一个程序来测试该条件。\n\n### 步骤 1：提取已知条件\n- **目标密度 ($p(x)$)**：两个高斯分布的对称混合：\n  $$p(x) = \\frac{1}{2} \\mathcal{N}(x \\mid -m, s^2) + \\frac{1}{2} \\mathcal{N}(x \\mid m, s^2)$$\n  其中 $m > 0$ 是半分离距离，$s > 0$ 是分量的标准差。\n\n- **SVGD 输运场 ($\\phi(x)$)**：在连续极限下，粒子分布为 $q(x)$：\n  $$\\phi(x) = \\mathbb{E}_{X \\sim q}\\left[ k(X,x) \\nabla \\log p(X) + \\nabla_X k(X,x) \\right]$$\n\n- **核函数 ($k(x,y)$)**：一个径向基函数 (RBF) 核：\n  $$k(x,y) = \\exp\\left(-\\frac{(x-y)^2}{2 h^2}\\right)$$\n  带宽 $h > 0$。\n\n- **初始分布 ($q_0$)**：一个以原点为中心的单峰高斯分布：\n  $$q_0(x) = \\mathcal{N}(x \\mid 0, v_0)$$\n  其中 $v_0 > 0$ 是初始方差。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据、提法明确且客观。它要求在特定的、数学上合理的条件下，对一个明确定义的动力学系统（SVGD）进行稳定性分析。问题设定是自洽且一致的，没有违反任何科学原理。该任务是随机方法分析中的一个标准练习。问题有效。\n\n### 步骤 3：增长系数 A 的推导\n\n问题要求分析粒子在早期的动力学。该动力学由常微分方程 $\\frac{dx}{dt} = \\phi(x)$ 给出。在早期，粒子分布 $q$ 可以很好地用初始分布 $q_0 = \\mathcal{N}(x \\mid 0, v_0)$ 来近似。因此，输运场为：\n$$ \\phi(x) \\approx \\mathbb{E}_{X \\sim q_0}\\left[ k(X,x) \\nabla \\log p(X) + \\nabla_X k(X,x) \\right] $$\n我们将该场在原点 x=0 附近线性化。泰勒展开为 $\\phi(x) \\approx \\phi(0) + x \\phi'(0)$。\n\n首先，我们计算 $\\phi(0)$。期望的参数是关于 $X \\sim \\mathcal{N}(0, v_0)$ 的，这是一个关于 0 对称的分布。\n$$ \\phi(0) = \\mathbb{E}_{X \\sim q_0}\\left[ k(X,0) \\nabla \\log p(X) + \\nabla_X k(X,0) \\right] $$\n核导数为 $\\nabla_X k(X,x) = \\frac{x-X}{h^2} k(X,x)$。在 $x=0$ 时，这变为 $-\\frac{X}{h^2} k(X,0)$。\n必须计算得分函数 $\\nabla \\log p(X)$。首先，我们将 $p(x)$ 写为：\n$$ p(x) \\propto \\exp\\left(-\\frac{(x+m)^2}{2s^2}\\right) + \\exp\\left(-\\frac{(x-m)^2}{2s^2}\\right) = \\exp\\left(-\\frac{x^2+m^2}{2s^2}\\right) \\left[ \\exp\\left(-\\frac{xm}{s^2}\\right) + \\exp\\left(\\frac{xm}{s^2}\\right) \\right] $$\n$$ p(x) \\propto \\exp\\left(-\\frac{x^2+m^2}{2s^2}\\right) \\cosh\\left(\\frac{xm}{s^2}\\right) $$\n取对数并对 $x$ 求导：\n$$ \\log p(x) = C - \\frac{x^2+m^2}{2s^2} + \\log\\left(\\cosh\\left(\\frac{xm}{s^2}\\right)\\right) $$\n$$ \\nabla \\log p(x) = \\frac{d}{dx}\\log p(x) = -\\frac{x}{s^2} + \\frac{1}{\\cosh\\left(\\frac{xm}{s^2}\\right)} \\sinh\\left(\\frac{xm}{s^2}\\right) \\frac{m}{s^2} = -\\frac{x}{s^2} + \\frac{m}{s^2} \\tanh\\left(\\frac{xm}{s^2}\\right) $$\n令 $\\psi(X) = \\nabla \\log p(X)$。\n$\\phi(0)$ 的完整表达式是：\n$$ \\phi(0) = \\mathbb{E}_{X \\sim q_0}\\left[ k(X,0) \\left(-\\frac{X}{s^2} + \\frac{m}{s^2} \\tanh\\left(\\frac{Xm}{s^2}\\right)\\right) - \\frac{X}{h^2} k(X,0) \\right] $$\n期望内的项是 $k(X,0) \\left[ -X\\left(\\frac{1}{s^2}+\\frac{1}{h^2}\\right) + \\frac{m}{s^2} \\tanh\\left(\\frac{Xm}{s^2}\\right) \\right]$。\n由于 $k(X,0) = \\exp(-X^2/2h^2)$ 是 $X$ 的偶函数，而方括号内的项是 $X$ 的奇函数，整个被积函数是奇函数。奇函数在对称分布 $\\mathcal{N}(0, v_0)$ 上的期望为零。因此，$\\phi(0) = 0$。\n\n因此，线性化动力学为 $\\frac{dx}{dt} \\approx x \\phi'(0)$，这意味着增长系数是 $A = \\phi'(0)$。我们计算这个导数：\n$$ A = \\phi'(0) = \\frac{d}{dx} \\mathbb{E}_{X \\sim q_0}\\left[ k(X,x) \\psi(X) + \\nabla_X k(X,x) \\right] \\bigg|_{x=0} $$\n我们可以交换期望和微分：\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ \\frac{d}{dx} \\left( k(X,x) \\psi(X) + \\frac{x-X}{h^2}k(X,x) \\right) \\bigg|_{x=0} \\right] $$\n使用乘法法则并在 $x=0$ 处求值：\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ (\\nabla_x k(X,x)|_{x=0}) \\psi(X) + \\left(\\frac{1}{h^2}k(X,x) + \\frac{x-X}{h^2}\\nabla_x k(X,x)\\right)\\bigg|_{x=0} \\right] $$\n注意 $\\nabla_x k(X,x)|_{x=0} = \\frac{X-x}{h^2}k(X,x)|_{x=0} = \\frac{X}{h^2}k(X,0)$。\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ \\frac{X}{h^2}k(X,0) \\psi(X) + \\frac{1}{h^2}k(X,0) - \\frac{X}{h^2}\\frac{X}{h^2}k(X,0) \\right] $$\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ k(X,0) \\left( \\frac{X}{h^2}\\psi(X) + \\frac{1}{h^2} - \\frac{X^2}{h^4} \\right) \\right] $$\n代入 $\\psi(X) = -X/s^2 + (m/s^2) \\tanh(Xm/s^2)$:\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ e^{-X^2/2h^2} \\left( \\frac{X}{h^2}\\left(-\\frac{X}{s^2} + \\frac{m}{s^2}\\tanh\\left(\\frac{Xm}{s^2}\\right)\\right) + \\frac{1}{h^2} - \\frac{X^2}{h^4} \\right) \\right] $$\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ e^{-X^2/2h^2} \\left( \\frac{1}{h^2} - X^2\\left(\\frac{1}{s^2h^2} + \\frac{1}{h^4}\\right) + \\frac{Xm}{s^2h^2}\\tanh\\left(\\frac{Xm}{s^2}\\right) \\right) \\right] $$\n根据期望的线性性质，此表达式可分为三项：\n$$ A = \\frac{1}{h^2}\\mathbb{E}[e^{-X^2/2h^2}] - \\left(\\frac{s^2+h^2}{s^2h^4}\\right)\\mathbb{E}[X^2e^{-X^2/2h^2}] + \\frac{m}{s^2h^2}\\mathbb{E}\\left[X\\tanh\\left(\\frac{Xm}{s^2}\\right)e^{-X^2/2h^2}\\right] $$\n其中期望是关于 $X \\sim \\mathcal{N}(0, v_0)$ 的。前两个期望有解析解。对于随机变量 $X \\sim \\mathcal{N}(0, v_0)$，我们使用高斯积分的标准结果：\n$$ I_0 = \\mathbb{E}[e^{-X^2/2h^2}] = \\int_{-\\infty}^{\\infty} e^{-X^2/2h^2} \\frac{1}{\\sqrt{2\\pi v_0}} e^{-X^2/2v_0} dX = \\frac{h}{\\sqrt{v_0+h^2}} $$\n$$ I_2 = \\mathbb{E}[X^2e^{-X^2/2h^2}] = \\int_{-\\infty}^{\\infty} X^2 \\frac{1}{\\sqrt{2\\pi v_0}} e^{-X^2(1/2v_0+1/2h^2)} dX = \\frac{v_0 h^3}{(v_0+h^2)^{3/2}} $$\n第三个期望涉及 $\\tanh(\\cdot)$，没有简单的闭式解，将进行数值计算：\n$$ I_{\\tanh} = \\mathbb{E}\\left[X\\tanh\\left(\\frac{Xm}{s^2}\\right)e^{-X^2/2h^2}\\right] = \\int_{-\\infty}^{\\infty} X \\tanh\\left(\\frac{Xm}{s^2}\\right) e^{-X^2/2h^2} \\frac{1}{\\sqrt{2\\pi v_0}} e^{-X^2/2v_0} dX $$\n综合这些，A 的最终表达式为：\n$$ A = \\frac{1}{h^2} \\frac{h}{\\sqrt{v_0+h^2}} - \\frac{s^2+h^2}{s^2h^4} \\frac{v_0 h^3}{(v_0+h^2)^{3/2}} + \\frac{m}{s^2h^2} I_{\\tanh} $$\n$$ A = \\frac{1}{h\\sqrt{v_0+h^2}} - \\frac{(s^2+h^2)v_0}{s^2h(v_0+h^2)^{3/2}} + \\frac{m}{s^2h^2} I_{\\tanh} $$\n\n### 分裂准则的论证\n\n原点附近的线性化动力学由常微分方程 $\\frac{dx}{dt} = A x$ 给出。该方程的解为 $x(t) = x(0) e^{At}$。\n- 如果 $A > 0$，任何无穷小扰动 $x(0) \\neq 0$ 都会随时间指数级增长。初始位置为 $x(0) > 0$ 的粒子将向正无穷移动（即朝向位于 $+m$ 的模式），而 $x(0) < 0$ 的粒子将向负无穷移动（朝向位于 $-m$ 的模式）。此行为描述了粒子系统分裂成两组。\n- 如果 $A \\leq 0$，扰动 $x(0)$ 将在线性化动力学下衰减到零（$A<0$）或保持不变（$A=0$）。在任何一种情况下，原点都是稳定或中性稳定的，粒子不会发生指数级分离。因此，粒子系统不会分裂。\n\n在此线性化模型中，$A$ 的符号是分裂的唯一决定因素。\n\n### 实现细节\n\n将实现一个 Python 程序来计算每个测试用例的 $A$ 值。\n1. $A$ 的公式中的解析部分将直接计算。\n2. 积分 $I_{\\tanh}$ 将使用数值积分计算，特别是 `scipy.integrate.quad`。被积函数是一个性质良好且快速衰减到零的函数。\n3. 通过将各项相加计算出 $A$ 的最终值。\n4. 每个测试用例的结果在 $A > 0$ 时为 `True`，否则为 `False`。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the splitting condition for SVGD dynamics for a set of test cases.\n    \"\"\"\n\n    test_cases = [\n        (3.0, 1.0, 1.0, 0.01),\n        (3.0, 1.0, 3.0, 0.01),\n        (0.5, 1.0, 1.0, 0.01),\n        (3.0, 1.0, 0.05, 0.001),\n        (3.0, 1.0, 1.0, 1.0),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        m, s, h, v0 = case\n        \n        # Avoid division by zero for parameters\n        if s == 0 or h == 0 or v0 == 0:\n            results.append(False)\n            continue\n\n        # Term 1 of A\n        term1 = 1.0 / (h * np.sqrt(v0 + h**2))\n\n        # Term 2 of A\n        term2_numerator = (s**2 + h**2) * v0\n        term2_denominator = (s**2 * h * (v0 + h**2)**1.5)\n        term2 = -term2_numerator / term2_denominator\n\n        # Term 3 of A involves a numerical integral for I_tanh\n        def integrand(X):\n            \"\"\"\n            The function to be integrated for I_tanh calculation.\n            Integrand = X * tanh(X*m/s^2) * exp(-X^2/(2*h^2)) * PDF_of_N(0,v0)\n            \"\"\"\n            pdf_q0 = (1.0 / np.sqrt(2.0 * np.pi * v0)) * np.exp(-X**2 / (2.0 * v0))\n            return X * np.tanh(X * m / s**2) * np.exp(-X**2 / (2.0 * h**2)) * pdf_q0\n\n        # Perform numerical integration\n        i_tanh, _ = quad(integrand, -np.inf, np.inf)\n\n        # A3 = (m / (s^2 * h^2)) * I_tanh\n        term3 = (m / (s**2 * h**2)) * i_tanh\n\n        # The growth coefficient A is the sum of the three terms.\n        A = term1 + term2 + term3\n\n        # Splitting is predicted if A > 0\n        results.append(A > 0)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3348233"}]}