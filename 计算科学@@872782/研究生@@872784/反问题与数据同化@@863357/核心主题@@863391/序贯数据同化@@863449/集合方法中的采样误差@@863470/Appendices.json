{"hands_on_practices": [{"introduction": "第一个练习从一个基础问题入手，探讨采样误差如何在系统中传播。通过为一个简单的标量模型推导过程噪声估计量的偏差，您将亲手揭示使用集合样本估计一个参数（如背景误差协方差）如何系统性地影响另一个参数（如模式误差）的估计 [@problem_id:3418800]。", "problem": "考虑一个标量线性高斯数据同化设置，其中状态根据随机游走模型 $x_{k+1} = x_{k} + w_{k}$ 演变，过程噪声为 $w_{k} \\sim \\mathcal{N}(0,Q)$，观测由 $y_{k} = x_{k} + \\epsilon_{k}$ 给出，观测噪声为 $\\epsilon_{k} \\sim \\mathcal{N}(0,R)$，其中 $Q  0$ 和 $R  0$ 分别是未知的和已知的方差。假设预报是无偏的，因此新息 $v_{k} = y_{k} - \\hat{x}_{k}^{-}$ 的均值为零。在此标量模型的稳态条件下，新息方差是预报误差方差和观测噪声方差之和，可以写为 $S(Q) = P + Q + R$，其中 $P$ 表示从前一个分析带入当前循环的预报误差方差。\n\n假设收集了 $M$ 个序列新息 $\\{v_{1},\\dots,v_{M}\\}$，并将其建模为来自均值为零、方差为 $S(Q)$ 的高斯分布的独立同分布抽样。目标是使用新息构造过程方差 $Q$ 的最大似然估计（MLE），其中预报误差方差 $P$ 被一个由 $N$ 个集合成员 $\\{x^{(i)}\\}_{i=1}^{N}$ 计算出的集合协方差估计量 $\\hat{P}$ 所替代。集合协方差是使用样本均值 $\\bar{x} = \\frac{1}{N}\\sum_{i=1}^{N}x^{(i)}$ 和最大似然（ML）归一化形成的，\n$$\n\\hat{P} = \\frac{1}{N}\\sum_{i=1}^{N}\\left(x^{(i)} - \\bar{x}\\right)^{2}.\n$$\n在集合为高斯分布的假设下，缩放后的协方差 $\\frac{N\\,\\hat{P}}{P}$ 的分布是自由度为 $N-1$ 的威沙特分布，因此由于有限的 $N$ 而表现出抽样误差。\n\n从新息的高斯似然定义和样本协方差矩阵的威沙特分布的典型矩性质出发，当 $P$ 被 $\\hat{P}$ 替代时，基于新息推导出 $Q$ 的 MLE，然后分析此估计量偏差中关于 $1/N$ 的一阶项。您的推导必须从关于高斯似然和样本协方差性质的经过充分检验的事实开始，不得调用任何预先推导出的估计量快捷公式。假设新息的均值已知为零。最终答案必须是 $Q$ 估计量偏差的主导 $O(1/N)$ 项的单个闭式解析表达式。不需要四舍五入，也不应提供单位。", "solution": "该问题要求推导过程噪声方差 $Q$ 的最大似然估计（MLE）并分析其偏差。解答过程分为两部分：首先，推导估计量 $\\hat{Q}_{MLE}$，其次，计算其偏差中关于 $1/N$ 的一阶项。\n\n### 步骤1：提取已知条件\n- 状态演变模型：$x_{k+1} = x_{k} + w_{k}$\n- 过程噪声：$w_{k} \\sim \\mathcal{N}(0,Q)$，其中 $Q  0$ 是一个未知方差。\n- 观测模型：$y_{k} = x_{k} + \\epsilon_{k}$\n- 观测噪声：$\\epsilon_{k} \\sim \\mathcal{N}(0,R)$，其中 $R  0$ 是一个已知方差。\n- 新息：$v_{k} = y_{k} - \\hat{x}_{k}^{-}$\n- 新息建模：一组 $M$ 个新息 $\\{v_{1},\\dots,v_{M}\\}$ 被建模为来自均值为零的高斯分布 $\\mathcal{N}(0, S(Q))$ 的独立同分布（i.i.d.）抽样。\n- 真实新息方差（给定）：$S(Q) = P + Q + R$，其中 $P$ 是从前一个分析带入当前循环的预报误差方差。\n- 基于集合的估计：真实方差 $P$ 被一个由 $N$ 个集合成员 $\\{x^{(i)}\\}_{i=1}^{N}$ 计算出的集合协方差估计量 $\\hat{P}$ 所替代。\n- 集合协方差估计量定义：$\\hat{P} = \\frac{1}{N}\\sum_{i=1}^{N}\\left(x^{(i)} - \\bar{x}\\right)^{2}$，其中 $\\bar{x} = \\frac{1}{N}\\sum_{i=1}^{N}x^{(i)}$。这是样本方差的最大似然形式。\n- $\\hat{P}$ 的统计性质：缩放后的样本协方差 $\\frac{N\\,\\hat{P}}{P}$ 服从自由度为 $N-1$ 的威沙特分布。在此标量情况下，这等价于卡方分布，$\\frac{N\\,\\hat{P}}{P} \\sim \\chi^2_{N-1}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是客观且适定的。它描述了数据同化中一个关于在存在抽样不确定性时进行参数估计的标准问题。使用集合来估计背景误差协方差以及对新息进行统计建模是集合卡尔曼滤波器等方法的核心概念。\n\n这些术语的物理解释存在潜在的模糊性。对于给定的状态模型，标准的卡尔曼滤波器理论意味着预报误差方差 $P_f$ 是传播的分析误差方差 $P_a$ 和过程噪声方差 $Q$ 的和，即 $P_f = P_a + Q$。那么新息方差将是 $S = P_f + R = P_a + Q + R$。问题陈述给出的新息方差为 $S(Q) = P + Q + R$，这表明 $P$ 意在代表分析误差方差 $P_a$。然而，估计量 $\\hat{P}$ 是从一个预报集合计算得出的，这意味着它是预报误差方差 $P_f$ 的一个估计量。\n\n尽管存在这种物理解释上的模糊性，但该问题在数学上是自洽的。我们被给予了要使用的明确的新息方差公式（$S(Q)=P+Q+R$），以及一个估计量 $\\hat{P}$ 与该公式中出现的参数 $P$ 之间的特定统计关系（$\\frac{N\\,\\hat{P}}{P} \\sim \\chi^2_{N-1}$）。任务是遵循这些数学定义的推论。我们必须假设 $\\hat{P}$ 被用作给定 $S(Q)$ 公式中量 $P$ 的一个（可能不完美的）估计。因此，该问题作为一个形式化的数学练习被认为是有效的。\n\n### 步骤3：结论与行动\n该问题有效。我们继续进行求解。\n\n### A部分：$Q$ 的最大似然估计的推导\n\n$Q$ 的 MLE 是基于所提供的独立同分布新息 $\\{v_1, \\dots, v_M\\}$ 构建的。问题陈述，为了估计的目的，真实但未知的预报误差方差 $P$ 被其集合估计 $\\hat{P}$ 所替代。因此，在我们的统计模型中，新息的方差被视为 $S_{model}(Q) = \\hat{P} + Q + R$。\n\n鉴于新息 $\\{v_k\\}$ 是来自均值为 $0$、方差为 $S_{model}(Q)$ 的高斯分布的独立同分布样本，其似然函数为：\n$$\nL(Q; \\{v_k\\}, \\hat{P}, R) = \\prod_{k=1}^{M} \\frac{1}{\\sqrt{2\\pi (\\hat{P} + Q + R)}} \\exp\\left(-\\frac{v_k^2}{2(\\hat{P} + Q + R)}\\right)\n$$\n使用对数似然函数 $\\ell(Q) = \\ln L(Q)$ 更为方便：\n$$\n\\ell(Q) = \\sum_{k=1}^{M} \\left[ -\\frac{1}{2}\\ln(2\\pi) - \\frac{1}{2}\\ln(\\hat{P} + Q + R) - \\frac{v_k^2}{2(\\hat{P} + Q + R)} \\right]\n$$\n$$\n\\ell(Q) = -\\frac{M}{2}\\ln(2\\pi) - \\frac{M}{2}\\ln(\\hat{P} + Q + R) - \\frac{1}{2(\\hat{P} + Q + R)}\\sum_{k=1}^{M}v_k^2\n$$\n为了找到 MLE，我们将 $\\ell(Q)$ 对 $Q$ 求导，并令结果为零。\n$$\n\\frac{d\\ell}{dQ} = -\\frac{M}{2} \\frac{1}{\\hat{P} + Q + R} + \\frac{1}{2(\\hat{P} + Q + R)^2} \\sum_{k=1}^{M}v_k^2 = 0\n$$\n两边乘以 $2(\\hat{P} + Q + R)^2$（假设方差为正）得到：\n$$\n-M(\\hat{P} + Q + R) + \\sum_{k=1}^{M}v_k^2 = 0\n$$\n令 $\\hat{S}_{innov} = \\frac{1}{M}\\sum_{k=1}^{M}v_k^2$ 表示新息的样本方差。方程变为：\n$$\n-M(\\hat{P} + Q + R) + M\\hat{S}_{innov} = 0\n$$\n$$\n\\hat{P} + Q + R = \\hat{S}_{innov}\n$$\n解出 $Q$ 得到最大似然估计量 $\\hat{Q}_{MLE}$：\n$$\n\\hat{Q}_{MLE} = \\hat{S}_{innov} - \\hat{P} - R\n$$\n\n### B部分：$\\hat{Q}_{MLE}$ 的偏差分析\n\n估计量的偏差是其期望值与被估计参数真值之间的差。这里，$\\hat{Q}_{MLE}$ 的偏差由下式给出：\n$$\n\\text{Bias}(\\hat{Q}_{MLE}) = \\mathbb{E}[\\hat{Q}_{MLE}] - Q\n$$\n期望 $\\mathbb{E}[\\cdot]$ 必须是关于真实数据生成过程的。这涉及到对集合成员的分布（决定了 $\\hat{P}$）和新息的分布（决定了 $\\hat{S}_{innov}$）进行平均。\n\n代入 $\\hat{Q}_{MLE}$ 的表达式：\n$$\n\\text{Bias}(\\hat{Q}_{MLE}) = \\mathbb{E}[\\hat{S}_{innov} - \\hat{P} - R] - Q\n$$\n利用期望算子的线性性质：\n$$\n\\text{Bias}(\\hat{Q}_{MLE}) = \\mathbb{E}[\\hat{S}_{innov}] - \\mathbb{E}[\\hat{P}] - \\mathbb{E}[R] - Q\n$$\n由于 $R$ 是一个已知常数，$\\mathbb{E}[R] = R$。问题没有说明集合的生成与新息之间存在任何依赖关系，因此在计算它们的期望时，我们可以将 $\\hat{P}$ 和 $\\hat{S}_{innov}$ 视为独立的随机变量。\n\n1.  **计算 $\\mathbb{E}[\\hat{P}]$：**\n    我们已知 $\\frac{N\\hat{P}}{P} \\sim \\chi^2_{N-1}$。一个自由度为 $k$ 的卡方随机变量的期望值为 $k$。因此：\n    $$\n    \\mathbb{E}\\left[\\frac{N\\hat{P}}{P}\\right] = N-1\n    $$\n    $$\n    \\frac{N}{P}\\mathbb{E}[\\hat{P}] = N-1 \\implies \\mathbb{E}[\\hat{P}] = \\frac{N-1}{N}P = \\left(1 - \\frac{1}{N}\\right)P\n    $$\n    这表明 $\\hat{P}$ 是 $P$ 的一个有偏估计量。\n\n2.  **计算 $\\mathbb{E}[\\hat{S}_{innov}]$：**\n    新息 $\\{v_k\\}$ 是来自*真实*分布的独立同分布抽样，该分布为 $\\mathcal{N}(0, S(Q))$，其中 $S(Q) = P + Q + R$。样本方差为 $\\hat{S}_{innov} = \\frac{1}{M}\\sum_{k=1}^{M}v_k^2$。其期望值为：\n    $$\n    \\mathbb{E}[\\hat{S}_{innov}] = \\mathbb{E}\\left[\\frac{1}{M}\\sum_{k=1}^{M}v_k^2\\right] = \\frac{1}{M}\\sum_{k=1}^{M}\\mathbb{E}[v_k^2]\n    $$\n    对于一个来自均值为 $0$、方差为 $S(Q)$ 的分布的随机变量 $v_k$，其平方的期望为 $\\mathbb{E}[v_k^2] = \\text{Var}(v_k) + (\\mathbb{E}[v_k])^2 = S(Q) + 0^2 = S(Q)$。\n    $$\n    \\mathbb{E}[\\hat{S}_{innov}] = \\frac{1}{M}\\sum_{k=1}^{M}S(Q) = \\frac{M \\cdot S(Q)}{M} = S(Q) = P + Q + R\n    $$\n\n3.  **合并各项以求得偏差：**\n    将 $\\mathbb{E}[\\hat{P}]$ 和 $\\mathbb{E}[\\hat{S}_{innov}]$ 的表达式代入偏差公式：\n    $$\n    \\text{Bias}(\\hat{Q}_{MLE}) = (P + Q + R) - \\left(1 - \\frac{1}{N}\\right)P - R - Q\n    $$\n    $$\n    \\text{Bias}(\\hat{Q}_{MLE}) = P + Q + R - P + \\frac{P}{N} - R - Q\n    $$\n    各项相消，剩下：\n    $$\n    \\text{Bias}(\\hat{Q}_{MLE}) = \\frac{P}{N}\n    $$\n这个表达式给出了在问题假设下估计量的精确偏差。由于它已经是 $O(1/N)$ 阶的项，因此这就是所要求的主导阶项。偏差为正，意味着估计量 $\\hat{Q}_{MLE}$ 倾向于高估真实的过程方差 $Q$。这种高估是由于ML样本方差估计量 $\\hat{P}$ 对 $P$ 的低估造成的，而 $\\hat{P}$ 在 $\\hat{Q}_{MLE}$ 的表达式中带负号。", "answer": "$$\n\\boxed{\\frac{P}{N}}\n$$", "id": "3418800"}, {"introduction": "在偏差概念的基础上，本练习将深入探讨采样误差在高级迭代集合平滑器（如EnRML）中的实际影响。您将推导高斯-牛顿优化步骤中核心组件的偏差，并分析其对算法收敛速度的影响，从而揭示有限集合大小如何降低优化性能 [@problem_id:3418799]。", "problem": "考虑一个线性反问题，其观测模型为 $y = J x + \\varepsilon$，其中 $J \\in \\mathbb{R}^{m \\times n}$ 是雅可比（或敏感性）矩阵，$x \\in \\mathbb{R}^{n}$ 是状态，$y \\in \\mathbb{R}^{m}$ 是观测，$\\varepsilon \\sim \\mathcal{N}(0, R)$，其中 $R \\in \\mathbb{R}^{m \\times m}$ 是已知的对称正定观测误差协方差矩阵。在一次给定的高斯-牛顿迭代中，设残差为 $r \\in \\mathbb{R}^{m}$，并将其视为确定性的。在诸如集合随机最大似然法（Ensemble Randomized Maximum Likelihood, EnRML）和多重数据同化集合平滑器（Ensemble Smoother with Multiple Data Assimilation, ES-MDA）的集成实现中，雅可比矩阵 $J$ 通过对大小为 $N$ 的集成进行线性回归来估计，过程如下。从已知的对称正定先验协方差为 $C \\in \\mathbb{R}^{n \\times n}$ 的 $\\mathcal{N}(0, C)$ 分布中独立抽取状态扰动作为列向量 $\\{x^{(i)}\\}_{i=1}^{N}$，并构成距平矩阵 $X = [x^{(1)}, \\dots, x^{(N)}] \\in \\mathbb{R}^{n \\times N}$。通过 $Y = J X + E$ 生成相应的观测距平 $Y = [y^{(1)}, \\dots, y^{(N)}] \\in \\mathbb{R}^{m \\times N}$，其中噪声矩阵 $E = [\\varepsilon^{(1)}, \\dots, \\varepsilon^{(N)}] \\in \\mathbb{R}^{m \\times N}$ 的列向量 $\\varepsilon^{(i)} \\sim \\mathcal{N}(0, R)$ 是独立的，并且 $E$ 与 $X$ 独立。$J$ 的集成回归估计量为 $\\widehat{J} = Y X^{\\top} (X X^{\\top})^{-1}$。将高斯-牛顿步的正规矩阵和右端项定义为 $A = J^{\\top} R^{-1} J$ 和 $b = J^{\\top} R^{-1} r$，以及它们对应的集成回归项 $\\widehat{A} = \\widehat{J}^{\\top} R^{-1} \\widehat{J}$ 和 $\\widehat{b} = \\widehat{J}^{\\top} R^{-1} r$。假设 $N  n + 1$，因此 $(X X^{\\top})^{-1}$ 几乎必然存在，并且其逆的期望存在。\n\n仅使用关于多元高斯变量和威沙特分布的基础概率事实，从第一性原理推导由有限 $N$ 引起的 $\\widehat{A}$ 和 $\\widehat{b}$ 中的期望偏差。然后，考虑一个求解 $(\\widehat{A}) s = b$ 的高斯-牛頓步（即使用集成回归正规矩阵但使用精确的右端项），此步骤针对无额外正则化的线性最小二乘目标。对于线性模型，从一次迭代到下一次迭代的误差传播可以用误差 $e = x - x^{\\star}$（其中 $x^{\\star}$ 是真解）表示为 $e^{+} = M e$，其中 $M$ 是一个收缩矩阵，它依赖于 $A$ 的选择和 $\\widehat{A}$ 中的偏差。在可交换性和各向同性假设 $A = \\lambda C^{-1}$（对于某个标量 $\\lambda  0$）下（等价于白化敏感度 $C^{1/2} A C^{1/2}$ 与单位矩阵成正比），计算 $M$ 的期望谱半径（其等于期望线性收敛因子），以 $m$、$n$、$N$ 和 $\\lambda$ 的函数形式给出闭式解。请以单个简化的解析表达式给出最终答案。无需四舍五入，也不涉及任何单位。", "solution": "该问题被评估为有效，因为它在科学上基于数据同化和反问题的理论，数学上是适定的，具有充分且一致的定义，并以客观、正式的语言陈述。因此，我们可以开始求解。\n\n该问题分为两部分：首先，推导集成估计的高斯-牛顿正规矩阵 $\\widehat{A}$ 和右端项 $\\widehat{b}$ 中的期望偏差；其次，计算特定迭代方案的期望收敛因子。\n\n**第一部分：期望偏差的推导**\n\n我们已知雅可比矩阵 $J$ 的集成回归估计量为：\n$$ \\widehat{J} = Y X^{\\top} (X X^{\\top})^{-1} $$\n代入定义 $Y = JX + E$，我们得到：\n$$ \\widehat{J} = (JX + E) X^{\\top} (X X^{\\top})^{-1} = JX X^{\\top} (X X^{\\top})^{-1} + E X^{\\top} (X X^{\\top})^{-1} = J + E X^{\\top} (X X^{\\top})^{-1} $$\n为了求 $\\widehat{J}$ 的期望值，我们对 $X$ 和 $E$ 的分布取期望。由于状态扰动 $X$ 和观测误差 $E$ 是独立的，并且 $E$ 的列向量是从零均值分布中抽取的（$\\mathbb{E}[E]=0$），我们可以使用全期望定律，以 $X$ 为条件：\n$$ \\mathbb{E}[\\widehat{J}] = \\mathbb{E}[J + E X^{\\top} (X X^{\\top})^{-1}] = J + \\mathbb{E}_{X}[\\mathbb{E}_{E}[E X^{\\top} (X X^{\\top})^{-1} | X]] $$\n内层期望为 $\\mathbb{E}_{E}[E] X^{\\top} (X X^{\\top})^{-1} = 0 \\cdot X^{\\top} (X X^{\\top})^{-1} = 0$。\n因此，$\\mathbb{E}[\\widehat{J}] = J$。估计量 $\\widehat{J}$ 是无偏的。\n\n现在，我们计算估计的右端项向量 $\\widehat{b} = \\widehat{J}^{\\top} R^{-1} r$ 的期望。由于残差 $r$ 被视为确定性的：\n$$ \\mathbb{E}[\\widehat{b}] = \\mathbb{E}[\\widehat{J}^{\\top} R^{-1} r] = \\mathbb{E}[\\widehat{J}]^{\\top} R^{-1} r = J^{\\top} R^{-1} r = b $$\n因此，估计量 $\\widehat{b}$ 也是无偏的，其期望偏差 $\\mathbb{E}[\\widehat{b}-b]$ 为零。\n\n接下来，我们计算估计的正规矩阵 $\\widehat{A} = \\widehat{J}^{\\top} R^{-1} \\widehat{J}$ 的期望：\n$$ \\widehat{A} = (J + E X^{\\top} (X X^{\\top})^{-1})^{\\top} R^{-1} (J + E X^{\\top} (X X^{\\top})^{-1}) $$\n展开此表达式得到：\n$$ \\widehat{A} = J^{\\top}R^{-1}J + J^{\\top}R^{-1}E X^{\\top}(XX^{\\top})^{-1} + ((XX^{\\top})^{-1})^{\\top}X E^{\\top}R^{-1}J + ((XX^{\\top})^{-1})^{\\top}X E^{\\top}R^{-1}E X^{\\top}(XX^{\\top})^{-1} $$\n取期望后，由于 $\\mathbb{E}[E] = 0$ 且 $E$ 与 $X$ 独立，两个交叉项消失。我们剩下：\n$$ \\mathbb{E}[\\widehat{A}] = J^{\\top}R^{-1}J + \\mathbb{E}[ (X X^{\\top})^{-1} X E^{\\top} R^{-1} E X^{\\top} (X X^{\\top})^{-1}] $$\n注意到 $XX^\\top$ 是对称的，因此逆矩阵上的转置是多余的。使用全期望定律，我们首先以 $X$ 为条件：\n$$ \\mathbb{E}[\\widehat{A}] = A + \\mathbb{E}_{X}[ (X X^{\\top})^{-1} X \\mathbb{E}_{E}[E^{\\top} R^{-1} E | X] X^{\\top} (X X^{\\top})^{-1}] $$\n矩阵 $E^{\\top} R^{-1} E$ 是一个 $N \\times N$ 矩阵。其第 $(i, j)$ 个元素是 $(\\varepsilon^{(i)})^{\\top} R^{-1} \\varepsilon^{(j)}$。$E$ 的列向量 $\\varepsilon^{(i)}$ 是独立的，并且从 $\\mathcal{N}(0, R)$ 中抽取。对于 $i \\neq j$，$\\mathbb{E}[(\\varepsilon^{(i)})^{\\top} R^{-1} \\varepsilon^{(j)}] = \\mathbb{E}[(\\varepsilon^{(i)})^{\\top}] R^{-1} \\mathbb{E}[\\varepsilon^{(j)}] = 0$。对于 $i = j$，我们得到一个二次型。对于一个随机向量 $z \\sim \\mathcal{N}(\\mu, \\Sigma)$，有 $\\mathbb{E}[z^{\\top}Qz] = \\mathrm{tr}(Q\\Sigma) + \\mu^{\\top}Q\\mu$。这里，$z=\\varepsilon^{(i)}$，$\\mu=0$，$\\Sigma=R$，$Q=R^{-1}$。因此，$\\mathbb{E}[(\\varepsilon^{(i)})^{\\top} R^{-1} \\varepsilon^{(i)}] = \\mathrm{tr}(R^{-1}R) = \\mathrm{tr}(I_m) = m$。\n因此，$\\mathbb{E}_{E}[E^{\\top} R^{-1} E] = m I_N$。将其代回：\n$$ \\mathbb{E}[\\widehat{A}] = A + \\mathbb{E}_{X}[ (X X^{\\top})^{-1} X (m I_N) X^{\\top} (X X^{\\top})^{-1}] $$\n$$ \\mathbb{E}[\\widehat{A}] = A + m \\, \\mathbb{E}_{X}[ (X X^{\\top})^{-1} (X X^{\\top}) (X X^{\\top})^{-1}] = A + m \\, \\mathbb{E}[(X X^{\\top})^{-1}] $$\n矩阵 $S_X = X X^{\\top} = \\sum_{i=1}^N x^{(i)} (x^{(i)})^\\top$。由于 $x^{(i)} \\sim \\mathcal{N}(0, C)$ 是独立同分布的，$S_X$ 服从威沙特分布，$S_X \\sim \\mathcal{W}_n(C, N)$。对于一个威沙特矩阵 $S \\sim \\mathcal{W}_p(\\Sigma, k)$，当 $k  p+1$ 时，其逆矩阵的期望为 $\\mathbb{E}[S^{-1}] = \\frac{1}{k-p-1} \\Sigma^{-1}$。这里，$p=n$，$k=N$，并且给定了条件 $N  n+1$。\n因此，$\\mathbb{E}[(X X^{\\top})^{-1}] = \\frac{1}{N-n-1} C^{-1}$。\n$\\widehat{A}$ 的期望值为：\n$$ \\mathbb{E}[\\widehat{A}] = A + \\frac{m}{N-n-1} C^{-1} $$\n$\\widehat{A}$ 中的期望偏差是 $\\mathbb{E}[\\widehat{A} - A] = \\frac{m}{N-n-1} C^{-1}$。\n\n**第二部分：期望收敛因子**\n\n问题陈述误差 $e=x-x^\\star$ 通过 $e^+ = Me$ 传播。这对应于一个不动点迭代 $x_{k+1} = T x_k + c'$，其误差传播为 $e_{k+1} = T e_k$。高斯-牛顿更新为 $x_{k+1} = x_k + s$，其中 $\\widehat{A} s = b$。如果这是求解线性系统 $Ax=b_{true}$ 的一个步骤，则右端项应为 $b = J^\\top R^{-1}(y-Jx_k) = b_{true} - Ax_k$。更新变为 $x_{k+1} = x_k + \\widehat{A}^{-1}(b_{true}-Ax_k)$。误差 $e_k=x_k-x^\\star$ 随之更新为 $e_{k+1} = (I - \\widehat{A}^{-1}A)e_k$。因此，传播矩阵为 $M = I - \\widehat{A}^{-1}A$。\n\n我们需要计算期望谱半径 $\\mathbb{E}[\\rho(M)]$。直接计算通常是难以处理的。在集成方法的背景下，这个量通常用期望算子的谱半径 $\\rho(\\mathbb{E}[M])$ 来近似，后者也被称为期望线性收斂因子。我们采用这种标准的认定方法继续。\n$$ \\mathbb{E}[M] = \\mathbb{E}[I - \\widehat{A}^{-1}A] = I - \\mathbb{E}[\\widehat{A}^{-1}]A $$\n逆矩阵的期望 $\\mathbb{E}[\\widehat{A}^{-1}]$ 同样难以计算。我们使用一阶近似 $\\mathbb{E}[\\widehat{A}^{-1}] \\approx (\\mathbb{E}[\\widehat{A}])^{-1}$，当 $\\widehat{A}$ 的方差与其均值相比很小（例如，对于大的 $N$）时，这个近似是准确的。\n$$ \\mathbb{E}[M] \\approx I - (\\mathbb{E}[\\widehat{A}])^{-1} A $$\n使用我们得到的 $\\mathbb{E}[\\widehat{A}]$ 的结果和给定的各向同性假设 $A = \\lambda C^{-1}$（这意味着 $C^{-1} = \\frac{1}{\\lambda}A$）：\n$$ \\mathbb{E}[\\widehat{A}] = A + \\frac{m}{N-n-1} C^{-1} = A + \\frac{m}{N-n-1} \\left(\\frac{1}{\\lambda}A\\right) = \\left(1 + \\frac{m}{\\lambda(N-n-1)}\\right)A $$\n现在我们对这个期望矩阵求逆：\n$$ (\\mathbb{E}[\\widehat{A}])^{-1} = \\left(1 + \\frac{m}{\\lambda(N-n-1)}\\right)^{-1} A^{-1} $$\n将此代入 $\\mathbb{E}[M]$ 的表达式中：\n$$ \\mathbb{E}[M] \\approx I - \\left(1 + \\frac{m}{\\lambda(N-n-1)}\\right)^{-1} A^{-1} A = \\left(1 - \\left(1 + \\frac{m}{\\lambda(N-n-1)}\\right)^{-1}\\right)I $$\n设 $\\gamma = \\frac{m}{\\lambda(N-n-1)}$。\n$$ \\mathbb{E}[M] \\approx \\left(1 - \\frac{1}{1+\\gamma}\\right)I = \\left(\\frac{1+\\gamma-1}{1+\\gamma}\\right)I = \\frac{\\gamma}{1+\\gamma}I $$\n谱半径是最大绝对值特征值。由于 $\\lambda, m  0$ 且 $N  n+1$，因此 $\\gamma  0$，所以该特征值为正。\n$$ \\rho(\\mathbb{E}[M]) \\approx \\frac{\\gamma}{1+\\gamma} = \\frac{\\frac{m}{\\lambda(N-n-1)}}{1 + \\frac{m}{\\lambda(N-n-1)}} $$\n将分子和分母同乘以 $\\lambda(N-n-1)$ 得到简化表达式：\n$$ \\rho(\\mathbb{E}[M]) \\approx \\frac{m}{m + \\lambda(N-n-1)} $$\n这就是期望线性收敛因子。", "answer": "$$\\boxed{\\frac{m}{m + \\lambda(N - n - 1)}}$$", "id": "3418799"}, {"introduction": "最后一个练习将重点从诊断采样误差转移到评估一种关键的缓解技术：协方差局地化。通过一个计算实验，您将探索局地化的双重性——它在抑制虚假相关性的同时，也可能扭曲或破坏真实存在的长程物理相关（遥相关），从而可能降低分析质量。此练习突显了在复杂系统中应用局地化时所涉及的关键权衡 [@problem_id:3418750]。", "problem": "考虑一个一维周期性网格，其上有$n$个等距点，索引为$i \\in \\{0,1,\\dots,n-1\\}$。定义索引$i$和$j$之间的周期性距离为$d(i,j) = \\min\\{|i-j|, n-|i-j|\\}$。设预报误差为一个零均值的二阶平稳高斯随机场，其协方差矩阵$P^f \\in \\mathbb{R}^{n \\times n}$是循环矩阵，并由一个仅依赖于$r = d(i,j)$的相关函数$p(r)$指定。假设一类遥相关预报协方差由下式给出\n$$\np(r) = \\exp\\!\\left(-\\frac{r}{L_c}\\right)\\,\\Big((1-a) + a \\cos\\!\\big(2\\pi \\frac{k_0}{n} r\\big)\\Big),\n$$\n其参数为$L_c  0$（相关长度，以网格步长为单位）、$a \\in [0,1)$（遥相关振幅）和整数$k_0 \\in \\{0,1,\\dots,\\lfloor n/2 \\rfloor\\}$（遥相关波数）。在所有网格点上进行观测，观测算子为单位矩阵$H = I_n$，观测噪声为独立的方差为$\\sigma^2$的高斯噪声，即$R = \\sigma^2 I_n$。\n\nSchur积局地化形成一个局地化先验协方差$P^L = P^f \\circ \\rho$，其中$\\circ$表示Hadamard（逐元素）积，而$\\rho \\in \\mathbb{R}^{n \\times n}$是一个由平稳、循环的局地化函数$\\rho(r)$指定的相关矩阵。使用高斯局地化\n$$\n\\rho(r) = \\exp\\!\\left(-\\frac{1}{2}\\left(\\frac{r}{\\ell}\\right)^2\\right),\n$$\n其局地化半宽为$\\ell  0$（以网格步长为单位）。令$\\Phi(k)$表示$P^f$的离散功率谱，$\\Phi_L(k)$表示$P^L$的离散功率谱（两者均定义为相应循环矩阵第一行的离散傅里叶变换）。定义局地化的谱失真为\n$$\nS(k) = \\frac{\\Phi_L(k)}{\\Phi(k)},\n$$\n其中$k$为$\\Phi(k)$不可忽略的那些模态。\n\n对于协方差矩阵$Q$以及$H=I_n$和$R=\\sigma^2 I_n$的情况，构建的Kalman增益定义为$K(Q) = Q\\,(Q + R)^{-1}$。从真实$P^f$获得的最优分析使用$K(P^f)$，而局地化分析使用$K(P^L)$。考虑线性分析估计量$\\hat{x}^a = \\hat{x}^f + K(y - \\hat{x}^f)$，其中$y = x + \\varepsilon$，$x$是真实状态，$\\varepsilon$是观测噪声，$\\hat{x}^f$是先验估计。对于任意线性增益$K$以及$H=I_n$和$R=\\sigma^2 I_n$的情况，所达到的均方分析误差协方差由以下基本关系定义\n$$\n\\Sigma^a(K) = (I_n - K)\\,P^f\\,(I_n - K)^\\top + K\\,R\\,K^\\top.\n$$\n\n您的任务是：\n- 仅从上述核心定义（平稳性和循环结构、离散傅里叶变换的定义、Hadamard积以及线性估计量的均方分析误差协方差）出发，推导逐模态的表达式，以便计算：\n  1. 离散谱$\\Phi(k)$和$\\Phi_L(k)$。\n  2. 在每个$\\Phi(k)$大于小阈值$\\tau$的模态$k$上的谱失真$S(k)$。\n  3. 使用$K(P^f)$所得到的最优逐模态分析误差方差。\n  4. 当真实先验协方差仍为$P^f$时，使用局地化增益$K(P^L)$实际达到的逐模态分析误差方差。\n- 使用这些表达式，为每个参数集定义两个聚合标量：\n  1. 显著模态上的均方根谱失真，\n     $$\n     D_{\\mathrm{rms}} = \\sqrt{\\frac{1}{|\\mathcal{K}|} \\sum_{k \\in \\mathcal{K}} \\big(S(k) - 1\\big)^2},\n     $$\n     其中$\\mathcal{K} = \\{k : \\Phi(k) \\ge \\tau\\}$。\n  2. 由局地化引起的每个网格点平均分析误差方差的增量：\n     $$\n     \\Delta \\bar{\\sigma}^2 = \\frac{1}{n} \\sum_{k=0}^{n-1} \\left(\\sigma^2_{a,\\mathrm{loc}}(k) - \\sigma^2_{a,\\mathrm{opt}}(k)\\right),\n     $$\n     其中$\\sigma^2_{a,\\mathrm{loc}}(k)$使用$K(P^L)$，$\\sigma^2_{a,\\mathrm{opt}}(k)$使用$K(P^f)$，两者均逐模态进行评估。\n- 此外，报告一个布尔标志，用于指示相对退化是否显著，定义为\n  $$\n  \\frac{\\Delta \\bar{\\sigma}^2}{\\frac{1}{n}\\sum_{k=0}^{n-1} \\sigma^2_{a,\\mathrm{opt}}(k)}  0.05.\n  $$\n\n实现一个程序，为以下每个测试参数集计算$(D_{\\mathrm{rms}}, \\Delta \\bar{\\sigma}^2, \\text{significant})$，所有参数均以网格步长为单位指定：\n- 测试A（强遥相关，窄局地化）：\n  $$\n  n=64,\\quad L_c=12,\\quad a=0.8,\\quad k_0=4,\\quad \\ell=2.5,\\quad \\sigma^2=0.2,\\quad \\tau=10^{-8}.\n  $$\n- 测试B（强遥相关，宽局地化）：\n  $$\n  n=64,\\quad L_c=12,\\quad a=0.8,\\quad k_0=4,\\quad \\ell=10.0,\\quad \\sigma^2=0.2,\\quad \\tau=10^{-8}.\n  $$\n- 测试C（无有效局地化）：\n  $$\n  n=64,\\quad L_c=12,\\quad a=0.8,\\quad k_0=4,\\quad \\ell=10^{6},\\quad \\sigma^2=0.2,\\quad \\tau=10^{-8}.\n  $$\n- 测试D（更高频遥相关，窄局地化）：\n  $$\n  n=64,\\quad L_c=8,\\quad a=0.9,\\quad k_0=16,\\quad \\ell=3.0,\\quad \\sigma^2=0.5,\\quad \\tau=10^{-8}.\n  $$\n\n最终输出格式要求：\n- 您的程序必须生成单行输出，其中包含一个含四个条目的列表，每个条目对应一个测试用例，顺序为$(\\text{A},\\text{B},\\text{C},\\text{D})$。\n- 每个条目必须是$[D_{\\mathrm{rms}},\\,\\Delta \\bar{\\sigma}^2,\\,\\text{significant}]$形式的列表，其中$D_{\\mathrm{rms}}$和$\\Delta \\bar{\\sigma}^2$是小数点后保留六位的小数，$\\text{significant}$是布尔值。\n- 因此，整体输出必须看起来像\n  $$\n  \\big[\\,[d_A,\\delta_A,s_A],\\,[d_B,\\delta_B,s_B],\\,[d_C,\\delta_C,s_C],\\,[d_D,\\delta_D,s_D]\\,\\big],\n  $$\n  打印在单行上，无多余字符。", "solution": "我们从基本结构和定义开始。在一个大小为$n$的一维周期性网格上，平稳协方差$P^f$是循环矩阵：其$(i,j)$元素仅取决于$r = d(i,j)$，其中$d$是周期性距离。第一行$p(r)$，$r \\in \\{0,1,\\dots,n-1\\}$，完全确定了$P^f$。对于遥相关先验，我们有\n$$\np(r) = \\exp\\!\\left(-\\frac{r}{L_c}\\right)\\,\\Big((1-a) + a \\cos\\!\\big(2\\pi \\frac{k_0}{n} r\\big)\\Big),\n$$\n它通过波数为$k_0$、振幅为$a$的振荡因子来编码长程遥相关，并受到相关长度为$L_c$的指数衰减的调制。Schur积局地化构造了$P^L = P^f \\circ \\rho$，其中$\\rho$是循环矩阵，其第一行为\n$$\n\\rho(r) = \\exp\\!\\left(-\\frac{1}{2}\\left(\\frac{r}{\\ell}\\right)^2\\right).\n$$\n\n循环矩阵的关键谱特性（可从离散傅里叶变换的定义推导）如下：\n- 任何循环矩阵的特征向量都是离散傅里叶模态。如果$c(r)$是循环矩阵$C$的第一行，那么其特征值$\\Lambda_C(k)$由离散傅里叶变换给出\n$$\n\\Lambda_C(k) = \\sum_{r=0}^{n-1} c(r)\\, \\exp\\!\\left(-2\\pi i \\frac{k r}{n}\\right), \\quad k = 0,1,\\dots,n-1.\n$$\n对于协方差矩阵，由于其半正定性，这些特征值是实数且非负的，我们可以称之为离散功率谱。记$\\Phi(k) = \\Lambda_{P^f}(k)$和$\\Phi_L(k) = \\Lambda_{P^L}(k)$。\n\n- 物理空间中的Hadamard积对应于频域中的循环卷积。具体来说，如果$P^L = P^f \\circ \\rho$，则\n$$\n\\Phi_L(k) = \\sum_{m=0}^{n-1} \\Phi(m)\\, \\widehat{\\rho}(k - m) \\quad \\text{其中索引模 } n,\n$$\n其中$\\widehat{\\rho}$是$\\rho$的第一行的离散傅里叶变换，求和是循环卷积。这表达了由局地化引起的谱泄漏：空间中的急剧局地化（小$\\ell$）会展宽$\\rho$的谱，从而混合$\\Phi$的各个模态。\n\n逐点定义谱失真为\n$$\nS(k) = \\frac{\\Phi_L(k)}{\\Phi(k)},\n$$\n其中$k$是$\\Phi(k)$不可忽略的模态。设$\\tau  0$为一个阈值；我们考虑显著集$\\mathcal{K} = \\{ k : \\Phi(k) \\ge \\tau \\}$并定义均方根失真\n$$\nD_{\\mathrm{rms}} = \\sqrt{\\frac{1}{|\\mathcal{K}|} \\sum_{k \\in \\mathcal{K}} \\big(S(k) - 1\\big)^2}.\n$$\n\n接下来，我们刻画线性估计下的分析误差。增益为$K$且$H = I_n$的线性分析估计量为$\\hat{x}^a = \\hat{x}^f + K(y - \\hat{x}^f)$，其中$y = x + \\varepsilon$。所达到的分析误差协方差的基本表达式为\n$$\n\\Sigma^a(K) = (I_n - K)\\,P^f\\,(I_n - K)^\\top + K\\,R\\,K^\\top,\n$$\n其中$R = \\sigma^2 I_n$。对于$H=I_n$，从协方差$Q$计算出的最优（最小均方误差）增益是Wiener滤波器\n$$\nK(Q) = Q\\,(Q + R)^{-1},\n$$\n这个结果可以通过使用标准二次型对$\\mathrm{trace}(\\Sigma^a(K))$关于$K$进行最小化，或通过经典的Gauss–Markov论证得到。常规的Kalman滤波器使用$Q = P^f$并达到最优后验协方差$( (P^f)^{-1} + R^{-1} )^{-1}$。然而，我们感兴趣的是使用从局地化协方差$P^L$计算出的增益$K(P^L)$所进行的次优分析，而此时真实的先验协方差仍然是$P^f$。\n\n因为$P^f$、$P^L$和$R$都是循环矩阵，所以它们在同一傅里叶基下可对角化。如上所述，令$\\Phi(k)$和$\\Phi_L(k)$。在傅里叶域中，$K(P^L)$以对角方式作用，其逐模态增益为\n$$\ng_{\\mathrm{loc}}(k) = \\frac{\\Phi_L(k)}{\\Phi_L(k) + \\sigma^2}.\n$$\n如果我们改用真实先验，最优的逐模态增益是\n$$\ng_{\\mathrm{opt}}(k) = \\frac{\\Phi(k)}{\\Phi(k) + \\sigma^2}.\n$$\n将$K = K(P^L)$代入$\\Sigma^a(K)$的基本表达式，并利用同时对角化，对每个模态$k$可得\n$$\n\\sigma^2_{a,\\mathrm{loc}}(k) = \\big(1 - g_{\\mathrm{loc}}(k)\\big)^2\\,\\Phi(k) + g_{\\mathrm{loc}}(k)^2\\,\\sigma^2,\n$$\n而最优的逐模态后验方差是众所周知的恒等式\n$$\n\\sigma^2_{a,\\mathrm{opt}}(k) = \\frac{\\Phi(k)\\,\\sigma^2}{\\Phi(k) + \\sigma^2},\n$$\n这也可以通过将$g_{\\mathrm{opt}}(k)$代入相同表达式，或通过对每个模态的$(\\Phi(k)^{-1} + \\sigma^{-2})$求逆得到。每个网格点的平均分析误差方差是模态方差的均值，\n$$\n\\bar{\\sigma}^2_{a,\\mathrm{loc}} = \\frac{1}{n} \\sum_{k=0}^{n-1} \\sigma^2_{a,\\mathrm{loc}}(k), \\quad\n\\bar{\\sigma}^2_{a,\\mathrm{opt}} = \\frac{1}{n} \\sum_{k=0}^{n-1} \\sigma^2_{a,\\mathrm{opt}}(k),\n$$\n由局地化引起的退化为\n$$\n\\Delta \\bar{\\sigma}^2 = \\bar{\\sigma}^2_{a,\\mathrm{loc}} - \\bar{\\sigma}^2_{a,\\mathrm{opt}} \\ge 0,\n$$\n当且仅当在逐模态增益相等的意义上$K(P^L) = K(P^f)$时，等号成立。一个表示实际显著退化的标志可以定义为\n$$\n\\frac{\\Delta \\bar{\\sigma}^2}{\\bar{\\sigma}^2_{a,\\mathrm{opt}}}  0.05.\n$$\n\n每个测试用例的算法步骤：\n1. 使用给定的$n, L_c, a, k_0$为$r=0,\\dots,n-1$构造$P^f$的第一行$p(r)$。\n2. 使用$\\ell$构造局地化矩阵的第一行$\\rho(r)$。\n3. 计算局地化的第一行$p_L(r) = p(r)\\,\\rho(r)$。\n4. 分别计算$p(r)$和$p_L(r)$的离散傅里叶变换的实部，作为离散谱$\\Phi(k)$和$\\Phi_L(k)$。通过将小的负数值舍入误差截断为零来确保非负性。\n5. 使用阈值$\\tau$，定义$\\mathcal{K} = \\{k : \\Phi(k) \\ge \\tau\\}$，在$\\mathcal{K}$上计算$S(k) = \\Phi_L(k)/\\Phi(k)$，然后计算$D_{\\mathrm{rms}}$。\n6. 计算逐模态增益$g_{\\mathrm{loc}}(k)$和达到的逐模态分析方差$\\sigma^2_{a,\\mathrm{loc}}(k)$。计算最优的$\\sigma^2_{a,\\mathrm{opt}}(k)$。对所有$k$求平均以获得$\\Delta \\bar{\\sigma}^2$和相对退化，并通过与$0.05$比较来确定布尔标志。\n\n从谱的观点可以立即得出局地化会使分析退化的条件：如果$\\ell$与遥相关波长（由$k_0$设定）相比很小，而相关长度$L_c$很大，那么谱$\\widehat{\\rho}$就会很宽，并混合$\\Phi$中分离的遥相关峰值，导致在许多$k$上产生显著的$S(k) \\ne 1$。这导致相对于$g_{\\mathrm{opt}}(k)$的增益$g_{\\mathrm{loc}}(k)$被错误指定，从而增加了$\\bar{\\sigma}^2_{a}$。相反，如果$\\ell$很大（以至于$\\rho \\approx 1$），则$S(k) \\approx 1$且$\\Delta \\bar{\\sigma}^2 \\approx 0$。\n\n我们为四个指定的测试用例实现此过程：\n- 测试A：$n=64$, $L_c=12$, $a=0.8$, $k_0=4$, $\\ell=2.5$, $\\sigma^2=0.2$, $\\tau=10^{-8}$。\n- 测试B：$n=64$, $L_c=12$, $a=0.8$, $k_0=4$, $\\ell=10.0$, $\\sigma^2=0.2$, $\\tau=10^{-8}$。\n- 测试C：$n=64$, $L_c=12$, $a=0.8$, $k_0=4$, $\\ell=10^{6}$, $\\sigma^2=0.2$, $\\tau=10^{-8}$。\n- 测试D：$n=64$, $L_c=8$, $a=0.9$, $k_0=16$, $\\ell=3.0$, $\\sigma^2=0.5$, $\\tau=10^{-8}$。\n\n程序为每个用例计算$(D_{\\mathrm{rms}}, \\Delta \\bar{\\sigma}^2, \\text{significant})$，将前两个数值四舍五入到小数点后六位，并按要求的顺序将它们打印为单行列表。", "answer": "[[0.589886,0.007621,true],[0.046938,0.000085,false],[0.000000,0.000000,false],[0.704257,0.038166,true]]", "id": "3418750"}]}