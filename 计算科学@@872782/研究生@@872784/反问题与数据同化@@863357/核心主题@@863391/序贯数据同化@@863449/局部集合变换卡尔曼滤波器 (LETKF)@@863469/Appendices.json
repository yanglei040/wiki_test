{"hands_on_practices": [{"introduction": "乘性膨胀是抑制滤波器发散的关键技术，而发散通常源于集合对真实预报误差的低估。本练习将揭示这一过程的内在机理，要求你证明“缩放集合异常”这一简单操作如何在数学上精确地转化为“膨胀预报误差协方差”。理解这一直接联系是在实际应用中有效调节滤波器的第一步。[@problem_id:3399177]", "problem": "考虑将局地集合变换卡尔曼滤波 (LETKF) 应用于单个局地区域上的线性高斯资料同化问题。设状态为标量，维数 $n=1$，预报集合的大小为 $m \\geq 3$。用 $1 \\times m$ 矩阵 $X^{f}$ 表示预报集合扰动，其列是每个集合成员相对于预报均值的零均值偏差。样本预报误差方差为 $p^{f} = \\frac{1}{m-1} X^{f} (X^{f})^{\\top}$。在 LETKF 中，通过使用膨胀因子 $\\lambda > 0$ 缩放扰动 $X^{f} \\mapsto \\sqrt{\\lambda}\\, X^{f}$ 来局地执行乘性膨胀。观测由线性模型 $y = H x + \\varepsilon$ 给出，其中 $H=1$，标量观测误差 $\\varepsilon \\sim \\mathcal{N}(0, r)$，观测误差方差 $r > 0$ 为已知的正数。假设资料同化采用标准的线性高斯贝叶斯框架，其中分析是在膨胀先验下的二次负对数后验的最小值点。\n\n从集合扰动、样本协方差和线性高斯贝叶斯同化框架的定义出发，执行以下操作：\n\n- 证明将 $X^{f}$ 缩放 $\\sqrt{\\lambda}$ 倍实现了乘性膨胀 $p^{f} \\mapsto \\lambda p^{f}$。\n- 推导此标量系统的卡尔曼增益作为 $\\lambda$ 的函数，记为 $K(\\lambda)$。\n- 在相同膨胀下，推导分析离散度 $s^{a}(\\lambda)$，其定义为分析集合扰动的标准差。\n\n请用 $\\lambda$、$p^{f}$ 和 $r$ 表示 $K(\\lambda)$ 和 $s^{a}(\\lambda)$ 的闭式解析表达式。不需要进行数值计算，也不允许四舍五入。最终答案必须按照指定的输出规则，以包含两个表达式的单个对象形式呈现。", "solution": "所述问题具有科学依据、是适定的、客观且内部一致的。它呈现了一个标准（尽管是简化的）集合资料同化场景。推导所需量所需的所有必要定义和条件均已提供。因此，我们可以着手求解。\n\n问题要求对一个使用大小为 $m$ 的集合的标量 ($n=1$) 线性高斯资料同化系统进行三项推导。\n\n首先，我们证明将预报集合扰动 $X^{f}$ 缩放因子 $\\sqrt{\\lambda}$ 会导致样本预报误差方差 $p^{f}$ 发生因子为 $\\lambda$ 的乘性膨胀。\n\n预报集合扰动由 $1 \\times m$ 矩阵 $X^{f}$ 给出。样本预报误差方差定义为：\n$$p^{f} = \\frac{1}{m-1} X^{f} (X^{f})^{\\top}$$\n通过缩放扰动来执行乘性膨胀：\n$$X^{f}_{\\lambda} = \\sqrt{\\lambda} X^{f}$$\n其中 $\\lambda > 0$ 是膨胀因子。\n新的、膨胀后的样本预报误差方差记为 $p^{f}_{\\lambda}$，使用缩放后的扰动 $X^{f}_{\\lambda}$ 计算：\n$$p^{f}_{\\lambda} = \\frac{1}{m-1} X^{f}_{\\lambda} (X^{f}_{\\lambda})^{\\top}$$\n代入 $X^{f}_{\\lambda}$ 的表达式：\n$$p^{f}_{\\lambda} = \\frac{1}{m-1} (\\sqrt{\\lambda} X^{f}) (\\sqrt{\\lambda} X^{f})^{\\top}$$\n由于 $\\sqrt{\\lambda}$ 是一个标量，我们可以对标量 $c$ 和矩阵 $A$ 使用性质 $(cA)^{\\top} = cA^{\\top}$：\n$$p^{f}_{\\lambda} = \\frac{1}{m-1} (\\sqrt{\\lambda} X^{f}) (\\sqrt{\\lambda} (X^{f})^{\\top})$$\n重新排列标量项：\n$$p^{f}_{\\lambda} = \\frac{\\sqrt{\\lambda} \\sqrt{\\lambda}}{m-1} X^{f} (X^{f})^{\\top} = \\frac{\\lambda}{m-1} X^{f} (X^{f})^{\\top}$$\n通过代入原始预报误差方差 $p^{f}$ 的定义，我们得到：\n$$p^{f}_{\\lambda} = \\lambda \\left( \\frac{1}{m-1} X^{f} (X^{f})^{\\top} \\right) = \\lambda p^{f}$$\n这完成了证明：将扰动 $X^{f}$ 缩放 $\\sqrt{\\lambda}$ 倍等同于对预报误差方差应用乘性膨胀 $p^{f} \\mapsto \\lambda p^{f}$。\n\n其次，我们推导作为膨胀因子 $\\lambda$ 函数的卡尔曼增益 $K(\\lambda)$。问题假设了一个标准的线性高斯贝叶斯框架。在此背景下，卡尔曼增益 $K$ 由以下公式给出：\n$$K = P^{f} H^{\\top} (H P^{f} H^{\\top} + R)^{-1}$$\n对于这个标量系统，我们进行以下替换：\n- 预报误差方差是膨胀后的方差，$P^{f} \\rightarrow p^{f}_{\\lambda} = \\lambda p^{f}$。\n- 观测算子为 $H=1$。\n- 观测误差方差为 $R=r$。\n\n由于所有量都是标量，矩阵运算（转置、求逆）变为简单的代数运算。\n$$K(\\lambda) = (\\lambda p^{f}) (1) ((1)(\\lambda p^{f})(1) + r)^{-1}$$\n$$K(\\lambda) = \\lambda p^{f} (\\lambda p^{f} + r)^{-1}$$\n$$K(\\lambda) = \\frac{\\lambda p^{f}}{\\lambda p^{f} + r}$$\n这是卡尔曼增益作为 $\\lambda$ 函数的闭式表达式。\n\n第三，我们推导分析离散度 $s^{a}(\\lambda)$，它是与分析误差方差 $p^{a}(\\lambda)$ 对应的标准差。在标准卡尔曼滤波公式中，分析误差协方差由以下公式给出：\n$$P^{a} = (I - KH) P^{f}$$\n再次，我们使用膨胀后的预报方差和推导出的卡尔曼增益 $K(\\lambda)$，替换此问题中的标量：\n$$p^{a}(\\lambda) = (1 - K(\\lambda) H) (\\lambda p^{f})$$\n当 $H=1$ 并使用 $K(\\lambda)$ 的表达式时：\n$$p^{a}(\\lambda) = \\left(1 - \\frac{\\lambda p^{f}}{\\lambda p^{f} + r}\\right) (\\lambda p^{f})$$\n我们对括号中的项进行通分：\n$$p^{a}(\\lambda) = \\left(\\frac{(\\lambda p^{f} + r) - \\lambda p^{f}}{\\lambda p^{f} + r}\\right) (\\lambda p^{f})$$\n$$p^{a}(\\lambda) = \\left(\\frac{r}{\\lambda p^{f} + r}\\right) (\\lambda p^{f})$$\n$$p^{a}(\\lambda) = \\frac{r \\lambda p^{f}}{\\lambda p^{f} + r}$$\n这是分析误差方差。问题要求的是分析离散度，即分析集合的标准差。这对应于分析误差方差的平方根。\n$$s^{a}(\\lambda) = \\sqrt{p^{a}(\\lambda)}$$\n$$s^{a}(\\lambda) = \\sqrt{\\frac{r \\lambda p^{f}}{\\lambda p^{f} + r}}$$\n这提供了分析离散度作为 $\\lambda$、$p^{f}$ 和 $r$ 函数的闭式表达式。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{\\lambda p^{f}}{\\lambda p^{f} + r} \\\\ \\sqrt{\\frac{r \\lambda p^{f}}{\\lambda p^{f} + r}} \\end{pmatrix}}$$", "id": "3399177"}, {"introduction": "任何集合滤波器的性能都取决于如何从有限的成员中准确估计方差等统计矩。本练习探讨了一个常见而微妙的陷阱：有偏（$1/k$）与无偏（$1/(k-1)$）样本方差估计量之间的区别。通过量化这个看似微小的实现选择所引入的系统性偏差，你将更深刻地体会到统计严谨性在数据同化中的重要作用。[@problem_id:3399132]", "problem": "考虑在局部集合变换卡尔曼滤波（LETKF）中，于单个空间位置进行的局部分析。此处，局部状态维度为一，且同化一个同位观测。集合成员数量为 $k$。局部状态的集合预报异常由去均值扰动矩阵构造，并按 $1/\\sqrt{k-1}$ 进行缩放，从而使得局部预报协方差估计等于无偏样本方差。设正确估计的局部预报方差表示为 $\\sigma_f^2$。观测算子为单位算子，$H=1$，观测误差方差为 $r$。假设在线性高斯设定下，该位置的 LETKF 后验协方差等于具有高斯误差的线性观测模型下的贝叶斯后验方差。\n\n假设一位实践者在构造集合异常时，错误地使用了归一化因子 $1/\\sqrt{k}$ 而非 $1/\\sqrt{k-1}$，然后用这个错误缩放的预报协方差计算了局部分析方差。请推导一个以 $k$、$\\sigma_f^2$ 和 $r$ 表示的闭式解析表达式，该表达式为错误缩放的局部分析方差与正确缩放的局部分析方差之比。\n\n最终答案必须是单个简化的解析表达式。不需要进行数值舍入，且最终答案中不应包含任何单位。", "solution": "该问题被认为是有效的，因为它具有科学依据、是适定的且客观的。它在数据同化和局部集合变换卡尔曼滤波（LETKF）的既定理论框架内，提出了一个清晰、可形式化的问题。所有必要的参数和条件都已提供，并且没有内部矛盾或事实不准确之处。\n\n目标是求出错误缩放的局部分析方差与正确缩放的局部分析方差之比。我们将首先建立错误缩放和正确缩放的预报方差之间的关系，然后应用标准的卡尔曼滤波方差更新方程，最后计算所求的比率。\n\n设局部状态为一个标量。集合预报由 $k$ 个成员组成。问题陈述，正确估计的局部预报方差（表示为 $\\sigma_f^2$）是集合的无偏样本方差。如果我们将 $k$ 个集合预报成员表示为 $\\{x_i^f\\}_{i=1}^k$，其均值为 $\\bar{x}^f = \\frac{1}{k} \\sum_{i=1}^k x_i^f$，那么无偏样本方差由下式给出：\n$$\nP^f_{correct} = \\sigma_f^2 = \\frac{1}{k-1} \\sum_{i=1}^k (x_i^f - \\bar{x}^f)^2\n$$\n实践者错误地使用了归一化因子 $1/\\sqrt{k}$ 而非 $1/\\sqrt{k-1}$ 来构造集合异常。这对应于将预报方差计算为高斯分布的最大似然估计（如果样本均值是真实均值），即：\n$$\n\\tilde{P}^f = \\frac{1}{k} \\sum_{i=1}^k (x_i^f - \\bar{x}^f)^2\n$$\n我们可以建立错误缩放的预报方差 $\\tilde{P}^f$ 与正确预报方差 $\\sigma_f^2$ 之间的直接关系。根据 $\\sigma_f^2$ 的定义，我们有：\n$$\n\\sum_{i=1}^k (x_i^f - \\bar{x}^f)^2 = (k-1)\\sigma_f^2\n$$\n将此代入 $\\tilde{P}^f$ 的表达式中，得到：\n$$\n\\tilde{P}^f = \\frac{1}{k} \\left((k-1)\\sigma_f^2\\right) = \\frac{k-1}{k}\\sigma_f^2\n$$\n问题设置在线性高斯背景下，其中局部状态和观测都是标量。观测算子是单位算子（$H=1$），观测误差方差为 $r$。后验（分析）方差 $P^a$ 与先验（预报）方差 $P^f$ 以及观测误差方差 $R=r$ 通过基于精度的更新公式相关联：\n$$\n(P^a)^{-1} = (P^f)^{-1} + H^T R^{-1} H\n$$\n对于我们的标量情况，其中 $H=1$ 且 $R=r$：\n$$\n\\frac{1}{P^a} = \\frac{1}{P^f} + \\frac{1}{r} = \\frac{r + P^f}{r P^f}\n$$\n对此表达式求逆，得到分析方差的公式：\n$$\nP^a = \\frac{r P^f}{r + P^f}\n$$\n首先，我们通过使用正确的预报方差 $P^f_{correct} = \\sigma_f^2$ 来计算正确缩放的局部分析方差 $P^a_{correct}$：\n$$\nP^a_{correct} = \\frac{r \\sigma_f^2}{r + \\sigma_f^2}\n$$\n接下来，我们通过使用错误缩放的预报方差 $\\tilde{P}^f = \\frac{k-1}{k}\\sigma_f^2$ 来计算错误缩放的局部分析方差 $\\tilde{P}^a$：\n$$\n\\tilde{P}^a = \\frac{r \\tilde{P}^f}{r + \\tilde{P}^f} = \\frac{r \\left(\\frac{k-1}{k}\\sigma_f^2\\right)}{r + \\frac{k-1}{k}\\sigma_f^2}\n$$\n问题要求的是错误缩放的分析方差与正确缩放的分析方差之比，即 $\\frac{\\tilde{P}^a}{P^a_{correct}}$：\n$$\n\\frac{\\tilde{P}^a}{P^a_{correct}} = \\frac{\\frac{r \\left(\\frac{k-1}{k}\\sigma_f^2\\right)}{r + \\frac{k-1}{k}\\sigma_f^2}}{\\frac{r \\sigma_f^2}{r + \\sigma_f^2}}\n$$\n我们可以从主分数的分子和主分母的分子中消去公因子 $r\\sigma_f^2$：\n$$\n\\frac{\\tilde{P}^a}{P^a_{correct}} = \\frac{\\frac{k-1}{k}}{r + \\frac{k-1}{k}\\sigma_f^2} \\cdot (r + \\sigma_f^2) = \\frac{k-1}{k} \\cdot \\frac{r + \\sigma_f^2}{r + \\frac{k-1}{k}\\sigma_f^2}\n$$\n为简化第二项的分母，我们通分：\n$$\nr + \\frac{k-1}{k}\\sigma_f^2 = \\frac{kr + (k-1)\\sigma_f^2}{k}\n$$\n将此代回比率的表达式中，得到：\n$$\n\\frac{\\tilde{P}^a}{P^a_{correct}} = \\frac{k-1}{k} \\cdot \\frac{r + \\sigma_f^2}{\\frac{kr + (k-1)\\sigma_f^2}{k}}\n$$\n分母中的因子 $k$ 被消去：\n$$\n\\frac{\\tilde{P}^a}{P^a_{correct}} = (k-1) \\cdot \\frac{r + \\sigma_f^2}{kr + (k-1)\\sigma_f^2}\n$$\n这给出了该比率的最终简化解析表达式：\n$$\n\\frac{\\tilde{P}^a}{P^a_{correct}} = \\frac{(k-1)(r + \\sigma_f^2)}{kr + (k-1)\\sigma_f^2}\n$$\n此表达式由所要求的变量 $k$、$\\sigma_f^2$ 和 $r$ 表示。", "answer": "$$\n\\boxed{\\frac{(k-1)(r + \\sigma_f^2)}{kr + (k-1)\\sigma_f^2}}\n$$", "id": "3399132"}, {"introduction": "应用集合方法的一个核心挑战是确定一个足够大的集合大小 $k$ 以防止滤波器发散，尤其是在高维混沌系统中。本练习将超越经验法则，进行形式化的稳定性分析。你将基于系统中不稳定且被观测到的模态数量，推导出集合大小所需满足的必要条件，从而为任何LETKF配置中最关键的参数之一奠定理论基础。[@problem_id:3399179]", "problem": "考虑在一个单一局地化区域上应用局地集合变换卡尔曼滤波 (LETKF) 的离散时间、线性、高斯数据同化设置。设局地状态维数为 $n_P$，局地观测维数为 $m_P$，集合大小为 $k$。LETKF 使用集合扰动来更新局地预报误差协方差，这些扰动存在于与集合平均正交的 $(k-1)$ 维子空间中。观测是线性的，由 $y = H_P x + \\eta$ 给出，其中 $H_P \\in \\mathbb{R}^{m_P \\times n_P}$ 的秩为 $m_P$，观测噪声 $\\eta \\sim \\mathcal{N}(0, R_P)$，且 $R_P$ 是正定矩阵。\n\n从经典的卡尔曼滤波协方差更新原理（即分析协方差沿着状态空间中那些在先验中不确定且被观测充分告知的方向减小）出发，并利用 LETKF 仅在维度至多为 $k-1$ 的集合扰动子空间内减小协方差这一事实，推导一个条件，使得当 $k$ 相对于 $n_P$ 和 $m_P$ 非常小时，滤波器很可能发散。该条件需用 $k$、$n_P$、$m_P$ 以及局地不稳定且被观测到的方向数量来表示。在此，将该区域上的局地线性预报算子定义为 $A_P \\in \\mathbb{R}^{n_P \\times n_P}$，并令 $V_+ \\in \\mathbb{R}^{n_P \\times n_+}$ 表示与 $A_P$ 的 $n_+$ 个模大于 1 的特征值相關聯的特征向量矩阵，这些方向代表局地不稳定方向。将被观测看到的局地不稳定方向的数量定义为 $r_u = \\operatorname{rank}(H_P V_+)$。\n\n然后，对于一个特定的区域，其中 $n_P = 20$，$m_P = 8$，$A_P$ 有 $n_+ = 6$ 个不稳定特征值，且观测算子 $H_P$ 使得这 $n_+$ 个不稳定方向中恰好有 $r_u = \\operatorname{rank}(H_P V_+) = 4$ 个被观测到（其余的不稳定方向位于 $H_P$ 的零空间中），计算为避免您推导出的因表示不足而引起的发散所必须满足的最小集合大小 $k_{\\min}$。请以单个整数形式给出最终答案。无需四舍五入。", "solution": "问题要求推导局地集合变换卡尔曼滤波 (LETKF) 中滤波器发散的条件，并随后针对一个特定情景计算最小集合大小。推导将基于数据同化的基本原理以及基于集合方法特有的约束。\n\n让我们首先阐明其中的核心原理。任何卡尔曼滤波的目标都是利用新的观测来更新预报（先验）状态估计，从而产生一个改进的分析（后验）状态估计。这个更新减小了状态估计中的不确定性，这种不确定性由误差协方差矩阵来量化。协方差的减小在状态空间中那些先验不确定性大且观测能提供重要信息的方向上最为显著。\n\n在一个受动力学（特别是混沌或不稳定动力学）支配的系统中，预报误差倾向于沿着一组特定的方向增长最快，这组方向被称为不稳定-中性流形。对于由算子 $A_P \\in \\mathbb{R}^{n_P \\times n_P}$ 描述的局地区域上的线性系统，这些方向由与模大于等于一的特征值相关联的特征向量所张成。问题特别关注严格不稳定方向，这些方向由矩阵 $V_+ \\in \\mathbb{R}^{n_P \\times n_+}$ 的列向量张成，该矩阵包含与模大于 $1$ 的特征值对应的 $n_+$ 个特征向量。记这个子空间为 $\\mathcal{S}_+ = \\operatorname{span}(V_+)$。未能控制这个 $n_+$ 维子空间中的误差增长是滤波器发散的一个主要原因。\n\n由线性算子 $H_P \\in \\mathbb{R}^{m_P \\times n_P}$ 描述的观测提供了纠正这些增长误差所必需的信息。然而，一个观测算子只能提供关于状态空间中不在其零空间 $\\operatorname{Null}(H_P)$ 内的方向的信息。一个不稳定方向 $v \\in \\mathcal{S}_+$ 只有在被观测“看到”时才能被纠正，即 $H_P v \\neq 0$。所有同时被观测到的不稳定方向的集合构成一个子空间。这个我们可以称之为“被观测不稳定子空间”的关键子空间的维度由 $r_u = \\operatorname{rank}(H_P V_+)$ 给出。这 $r_u$ 个维度代表了误差既在活跃增长，又原则上可以被现有观测所纠正的方向。因此，数据同化系统必须纠正这 $r_u$ 个方向上的误差以维持稳定性。\n\n现在，我们必须考虑任何基于集合的滤波器（包括 LETKF）的核心局限性。用于计算对预报状态修正的分析更新，是作为集合预报扰动（即集合成员与集合平均的偏差）的线性组合来构造的。因此，整个修正量都位于由这些扰動向量张成的子空间内。这个子空间，我们称之为集合子空间 $\\mathcal{E}$，其维度至多为 $k-1$，其中 $k$ 是集合大小。任何与 $\\mathcal{E}$ 正交的预报误差分量都不能通过分析更新得到修正。\n\n当存在滤波器在结构上无法修正的关键误差增长方向时，滤波器发散就变得非常可能。在我们的情景中，如果集合子空间 $\\mathcal{E}$ 不能充分张成维度为 $r_u$ 的被观测不稳定子空间，这种情况就会发生。如果集合子空间的维度小于它需要控制的关键空间的维度，即 $\\operatorname{dim}(\\mathcal{E})  r_u$，那么在被观测不稳定子空间中必然存在至少一个与集合子空间正交的方向。由于系统动力学（这是一个不稳定方向），该方向上的误差分量将呈指数级增长，但又不会被数据同化更新所减小（因为它在集合子空间之外）。这种未经修正的误差增长将不可避免地导致滤波器发散。\n\n因此，为了避免这种系统性的、由表示不足引起的发散，一个必要条件是，可以进行修正的空间的维度必须至少与迫切需要修正的空间的维度一样大。这导出了不等式：\n$$ \\operatorname{dim}(\\mathcal{E}) \\ge r_u $$\n考虑到集合扰动子空间的维度至多为 $k-1$，我们得到：\n$$ k-1 \\ge r_u $$\n这是集合拥有足够自由度，从而原则上能够表示和控制所有被观测不稳定方向上增长的误差的条件。如果 $k-1  r_u$，发散几乎是必然的。\n\n问题要求为避免这种发散必须满足的最小集合大小 $k_{\\min}$。这对应于满足所推导条件的最小整数 $k$。整理该不等式，我们得到：\n$$ k \\ge r_u + 1 $$\n因此，最小集合大小为：\n$$ k_{\\min} = r_u + 1 $$\n\n现在我们可以将这个结果应用于所提供的具体数值案例。\n该区域的已知条件如下：\n- 局地状态维数，$n_P = 20$。\n- 局地观测维数，$m_P = 8$。\n- 局地不稳定方向的数量，$n_+ = 6$。\n- 同时被观测到的局地不稳定方向的数量，$r_u = \\operatorname{rank}(H_P V_+) = 4$。\n\n使用我们推导出的最小集合大小公式，代入 $r_u$ 的值：\n$$ k_{\\min} = 4 + 1 $$\n$$ k_{\\min} = 5 $$\n\n因此，至少需要 $k=5$ 的集合大小。对于这个大小的集合，集合扰动子空间的 $k-1 = 4$ 个维度刚好足够潜在地张成被观测不稳定子空间的 $r_u=4$ 个维度，从而提供了防止因增长误差模态表示不足而导致发散的最小必要能力。", "answer": "$$\\boxed{5}$$", "id": "3399179"}]}