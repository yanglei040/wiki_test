{"hands_on_practices": [{"introduction": "为了真正理解无迹卡尔曼滤波器（UKF）的优势，我们首先需要将其与扩展卡尔曼滤波器（EKF）进行对比。EKF通过在当前均值 $\\mu$ 处对非线性函数 $f(x)$ 进行一阶泰勒展开来近似状态的演化，这种方法在高度非线性系统中会引入显著的偏差。这个练习 [@problem_id:3380789] 将通过一个简单的二次非线性系统，从解析上揭示UKF如何精确地捕捉到EKF所忽略的、与协方差 $P$ 相关的二阶矩信息，从而提供一个更准确的状态预测。通过亲自推导两种滤波器的预测均值并与真实值进行比较，您将从根本上理解UKF为何通常优于EKF，并洞察EKF偏差的来源。", "problem": "考虑一个标量、离散时间、噪声驱动的非线性动力学系统，其状态 $x \\in \\mathbb{R}$ 由下式给出\n$$\nx_{k+1} = f(x_k) + w_k, \\quad f(x) = x + \\beta x^{2},\n$$\n其中 $\\beta \\in \\mathbb{R}$ 是一个已知参数，$w_k$ 是独立于 $x_k$ 的零均值过程噪声。假设在时间 $k$ 的先验分布是高斯分布，其均值和方差为\n$$\nx_k \\sim \\mathcal{N}(m, P), \\quad P  0.\n$$\n要求您在两种高斯滤波近似下分析预测均值。\n\n任务：\n1. 使用扩展卡尔曼滤波器 (EKF) 的定义，将函数 $f$ 在先验均值附近进行一阶线性化，推导出预测均值 $\\mu_{\\mathrm{EKF}}$。\n2. 使用无迹卡尔曼滤波器 (UKF) 和无迹变换 (UT)，设维度 $L=1$，通用缩放参数 $\\alpha  0$ 和 $\\kappa \\in \\mathbb{R}$，推导出预测均值 $\\mu_{\\mathrm{UKF}}$。使用 $L=1$ 的标准sigma点构造方法：\n   - 定义 $\\lambda = \\alpha^{2}(L+\\kappa) - L$。\n   - 定义sigma点\n     $$\n     \\chi_{0} = m, \\quad \\chi_{1} = m + \\sqrt{(L+\\lambda)P}, \\quad \\chi_{2} = m - \\sqrt{(L+\\lambda)P}.\n     $$\n   - 使用均值权重\n     $$\n     W_{0}^{(m)} = \\frac{\\lambda}{L+\\lambda}, \\quad W_{1}^{(m)} = W_{2}^{(m)} = \\frac{1}{2(L+\\lambda)}.\n     $$\n   此处不需要出现在协方差公式中的第三个UT参数。请明确显示结果对UT参数的依赖性或独立性。\n3. 仅使用高斯多项式期望的性质，将精确的预测均值 $\\mu_{\\mathrm{exact}} = \\mathbb{E}[f(x_k)]$ 写成关于 $m$、$P$ 和 $\\beta$ 的函数。\n4. 通过比较您的EKF和UKF表达式，量化二阶偏差差异，此处定义为预测均值之差 $\\mu_{\\mathrm{UKF}} - \\mu_{\\mathrm{EKF}}$，并将其表示为 $P$、$m$ 和 $\\beta$ 的函数。请以单一简化的解析表达式形式给出最终答案。无需进行数值计算。\n\n答案形式要求：您最终提交的答案必须是单一的闭式解析表达式。不包含单位。不要四舍五入。", "solution": "该问题要求在三种不同的计算方法下，对一个标量非线性系统的预测均值进行分析：扩展卡尔曼滤波器 (EKF)、无迹卡尔曼滤波器 (UKF) 和精确解析期望。最终目标是量化UKF和EKF预测均值之间的差异。\n\n该系统由状态空间模型 $x_{k+1} = f(x_k) + w_k$ 描述，其中非线性函数为 $f(x) = x + \\beta x^2$。在时间 $k$ 的状态 $x_k$ 是一个服从高斯分布的随机变量，$x_k \\sim \\mathcal{N}(m, P)$，其中 $m$ 是均值，$P$ 是方差。过程噪声 $w_k$ 是零均值的，即 $\\mathbb{E}[w_k] = 0$，并且独立于 $x_k$。在时间 $k+1$ 的预测均值为 $\\mathbb{E}[x_{k+1}] = \\mathbb{E}[f(x_k) + w_k] = \\mathbb{E}[f(x_k)] + \\mathbb{E}[w_k] = \\mathbb{E}[f(x_k)]$。因此，任务简化为使用指定方法计算变换后状态的期望 $\\mathbb{E}[f(x_k)]$。\n\n1. EKF预测均值 $\\mu_{\\mathrm{EKF}}$ 的推导\n\n扩展卡尔曼滤波器通过在状态均值 $m$ 附近对非线性函数 $f(x)$ 进行一阶泰勒级数展开来近似该函数。近似式为：\n$$\nf(x_k) \\approx f(m) + f'(m)(x_k - m)\n$$\n函数 $f(x) = x + \\beta x^2$ 对 $x$ 的导数是 $f'(x) = 1 + 2\\beta x$。在 $x=m$ 处求值得到 $f'(m) = 1 + 2\\beta m$。\n\nEKF预测均值 $\\mu_{\\mathrm{EKF}}$ 是这个线性化函数的期望：\n$$\n\\mu_{\\mathrm{EKF}} = \\mathbb{E}[f(m) + f'(m)(x_k - m)]\n$$\n根据期望的线性性质：\n$$\n\\mu_{\\mathrm{EKF}} = \\mathbb{E}[f(m)] + \\mathbb{E}[f'(m)(x_k - m)]\n$$\n由于 $m$ 是一个常数，因此 $f(m)$ 和 $f'(m)$ 对于关于 $x_k$ 的期望也是常数。因此，我们可以写出：\n$$\n\\mu_{\\mathrm{EKF}} = f(m) + f'(m)\\mathbb{E}[x_k - m]\n$$\n根据定义，$x_k$ 的期望是 $m$，所以 $\\mathbb{E}[x_k - m] = \\mathbb{E}[x_k] - m = m - m = 0$。\n因此，第二项为零：\n$$\n\\mu_{\\mathrm{EKF}} = f(m) = m + \\beta m^2\n$$\n\n2. UKF预测均值 $\\mu_{\\mathrm{UKF}}$ 的推导\n\n无迹卡尔曼滤波器使用无迹变换 (UT) 来估计变换后分布的均值。该方法包括将一组确定性选择的sigma点通过真实的非线性函数 $f(x)$ 进行传播，并计算其加权平均值。\n\n对于维度 $L=1$，UT的参数如下：\n- 缩放参数 $\\lambda = \\alpha^2(L+\\kappa) - L = \\alpha^2(1+\\kappa) - 1$。\n- 项 $L+\\lambda = \\alpha^2(1+\\kappa)$。\n- sigma点为：\n  - $\\chi_0 = m$\n  - $\\chi_1 = m + \\sqrt{(L+\\lambda)P} = m + \\sqrt{\\alpha^2(1+\\kappa)P}$\n  - $\\chi_2 = m - \\sqrt{(L+\\lambda)P} = m - \\sqrt{\\alpha^2(1+\\kappa)P}$\n- 均值的权重为：\n  - $W_0^{(m)} = \\frac{\\lambda}{L+\\lambda} = \\frac{\\lambda}{1+\\lambda}$\n  - $W_1^{(m)} = W_2^{(m)} = \\frac{1}{2(L+\\lambda)} = \\frac{1}{2(1+\\lambda)}$\n\n权重之和为 $W_0^{(m)} + W_1^{(m)} + W_2^{(m)} = \\frac{\\lambda}{1+\\lambda} + 2\\left(\\frac{1}{2(1+\\lambda)}\\right) = \\frac{\\lambda+1}{1+\\lambda} = 1$。\n\nUKF预测均值为 $\\mu_{\\mathrm{UKF}} = \\sum_{i=0}^{2} W_i^{(m)} f(\\chi_i)$。首先，在每个sigma点处计算 $f(x) = x + \\beta x^2$ 的值：\n- $f(\\chi_0) = f(m) = m + \\beta m^2$\n- $f(\\chi_1) = (m + \\sqrt{(1+\\lambda)P}) + \\beta(m + \\sqrt{(1+\\lambda)P})^2 = m + \\sqrt{(1+\\lambda)P} + \\beta(m^2 + 2m\\sqrt{(1+\\lambda)P} + (1+\\lambda)P)$\n- $f(\\chi_2) = (m - \\sqrt{(1+\\lambda)P}) + \\beta(m - \\sqrt{(1+\\lambda)P})^2 = m - \\sqrt{(1+\\lambda)P} + \\beta(m^2 - 2m\\sqrt{(1+\\lambda)P} + (1+\\lambda)P)$\n\n现在，我们计算加权和：\n$$\n\\mu_{\\mathrm{UKF}} = W_0^{(m)}f(\\chi_0) + W_1^{(m)}f(\\chi_1) + W_2^{(m)}f(\\chi_2)\n$$\n由于 $W_1^{(m)} = W_2^{(m)}$，我们可以对各项进行分组：\n$$\n\\mu_{\\mathrm{UKF}} = W_0^{(m)}f(\\chi_0) + W_1^{(m)}(f(\\chi_1) + f(\\chi_2))\n$$\n我们来计算和 $f(\\chi_1) + f(\\chi_2)$：\n$$\nf(\\chi_1) + f(\\chi_2) = (2m) + \\beta( (m^2 + 2m\\sqrt{\\dots} + (1+\\lambda)P) + (m^2 - 2m\\sqrt{\\dots} + (1+\\lambda)P) )\n$$\n$$\nf(\\chi_1) + f(\\chi_2) = 2m + \\beta(2m^2 + 2(1+\\lambda)P) = 2(m + \\beta m^2) + 2\\beta(1+\\lambda)P\n$$\n将此结果代回 $\\mu_{\\mathrm{UKF}}$ 的表达式中：\n$$\n\\mu_{\\mathrm{UKF}} = W_0^{(m)}(m + \\beta m^2) + W_1^{(m)}[2(m + \\beta m^2) + 2\\beta(1+\\lambda)P]\n$$\n$$\n\\mu_{\\mathrm{UKF}} = (W_0^{(m)} + 2W_1^{(m)})(m + \\beta m^2) + 2W_1^{(m)}\\beta(1+\\lambda)P\n$$\n由于权重之和为 $W_0^{(m)} + 2W_1^{(m)} = 1$，且 $2W_1^{(m)} = 2\\left(\\frac{1}{2(1+\\lambda)}\\right) = \\frac{1}{1+\\lambda}$，上式可简化为：\n$$\n\\mu_{\\mathrm{UKF}} = 1 \\cdot (m + \\beta m^2) + \\frac{1}{1+\\lambda}\\beta(1+\\lambda)P = m + \\beta m^2 + \\beta P\n$$\nUKF预测均值为 $\\mu_{\\mathrm{UKF}} = m + \\beta m^2 + \\beta P$。值得注意的是，这个结果与UT的缩放参数 $\\alpha$ 和 $\\kappa$ 无关。\n\n3. 精确预测均值 $\\mu_{\\mathrm{exact}}$ 的推导\n\n精确预测均值是在给定 $x_k \\sim \\mathcal{N}(m, P)$ 的条件下 $f(x_k)$ 的真实期望。\n$$\n\\mu_{\\mathrm{exact}} = \\mathbb{E}[f(x_k)] = \\mathbb{E}[x_k + \\beta x_k^2]\n$$\n利用期望的线性性质：\n$$\n\\mu_{\\mathrm{exact}} = \\mathbb{E}[x_k] + \\beta \\mathbb{E}[x_k^2]\n$$\n给定 $\\mathbb{E}[x_k] = m$。二阶矩 $\\mathbb{E}[x_k^2]$ 与均值和方差的关系式为 $\\mathrm{Var}(x_k) = \\mathbb{E}[x_k^2] - (\\mathbb{E}[x_k])^2$。\n由于 $\\mathrm{Var}(x_k) = P$，我们有：\n$$\n\\mathbb{E}[x_k^2] = \\mathrm{Var}(x_k) + (\\mathbb{E}[x_k])^2 = P + m^2\n$$\n将此结果代入 $\\mu_{\\mathrm{exact}}$ 的表达式中：\n$$\n\\mu_{\\mathrm{exact}} = m + \\beta (P + m^2) = m + \\beta m^2 + \\beta P\n$$\n这表明对于二次非线性系统，无迹变换能够提供精确的预测均值，即 $\\mu_{\\mathrm{UKF}} = \\mu_{\\mathrm{exact}}$。\n\n4. 二阶偏差差异的计算\n\n问题将二阶偏差差异定义为UKF和EKF预测均值之差，即 $\\mu_{\\mathrm{UKF}} - \\mu_{\\mathrm{EKF}}$。利用前面部分的结果：\n- $\\mu_{\\mathrm{EKF}} = m + \\beta m^2$\n- $\\mu_{\\mathrm{UKF}} = m + \\beta m^2 + \\beta P$\n\n差异为：\n$$\n\\mu_{\\mathrm{UKF}} - \\mu_{\\mathrm{EKF}} = (m + \\beta m^2 + \\beta P) - (m + \\beta m^2)\n$$\n$$\n\\mu_{\\mathrm{UKF}} - \\mu_{\\mathrm{EKF}} = \\beta P\n$$\n这一项 $\\beta P$ 代表了EKF均值预测中的主阶误差或偏差。这种偏差的产生是因为EKF近似对函数进行了线性化，从而忽略了其曲率（二阶导数）对变换后分布均值的影响。而UKF通过其对称的sigma点集，正确地捕捉到了这个二阶项，从而得到了一个更精确的均值估计，在这个二次函数的情况下，这个估计是精确的。两种滤波器预测值之间的差异正是这个二阶项。\n最终要求的表达式就是这个差异的解析形式。", "answer": "$$\\boxed{\\beta P}$$", "id": "3380789"}, {"introduction": "在理解了UKF的理论优势之后，掌握其核心计算机制至关重要。UKF的预测步骤涉及一套确定性的采样流程，即无迹变换（Unscented Transform），初看起来可能有些抽象。本练习 [@problem_id:2888306] 为一个二维非线性系统提供了一个具体、分步的UKF预测步骤计算，目标是从先验估计 $(\\hat{x}_{k|k}, P_{k|k})$ 计算出预测均值 $\\hat{x}_{k+1|k}$。您将亲手实践如何生成sigma点，如何将它们通过非线性动力学函数进行传播，并最终如何加权组合这些点来估计预测的状态均值。通过完成这个数值算例，您将揭开无迹变换的神秘面纱，巩固关于sigma点和加权平均的核心概念，并为将来实现或调试UKF打下坚实的计算基础。", "problem": "考虑离散时间非线性随机系统\n$$\nx_{k+1} \\;=\\; \\begin{bmatrix} x_{1,k} + \\sin(x_{2,k}) \\\\ x_{2,k} \\end{bmatrix} \\;+\\; w_k,\n\\qquad\ny_k \\;=\\; \\begin{bmatrix} x_{1,k}^2 \\end{bmatrix} \\;+\\; v_k,\n$$\n其中 $w_k$ 和 $v_k$ 是相互独立的零均值高斯白噪声，其协方差矩阵分别为 $Q$ 和 $R$。假设 $Q = 0.01 I_2$，并注意过程噪声是加性噪声。在时间 $k$，先验状态估计为高斯分布，其均值为\n$$\n\\hat{x}_{k|k} \\;=\\; \\begin{bmatrix} 0.5 \\\\ 0.1 \\end{bmatrix}\n$$\n协方差为\n$$\nP_{k|k} \\;=\\; \\begin{bmatrix} 0.04  0.01 \\\\ \n0.01  0.09 \\end{bmatrix}.\n$$\n您将执行无迹卡尔曼滤波器 (Unscented Kalman Filter, UKF) 的一个预测步骤，使用无迹变换（Unscented Transform），其参数为 $\\alpha = 10^{-3}$，$\\beta = 2$，$\\kappa = 0$，并采用标准的 sigma 点构造方法。假设正弦函数的参数单位为弧度。\n\n从预测步骤的基本定义出发，即通过匹配从高斯先验中抽取的、经过变换的一组确定性选择的 sigma 点的矩，来近似随机变量 $x_{k+1} = f(x_k) + w_k$（其中 $f(x) = [x_1 + \\sin(x_2),\\; x_2]^\\top$）的前两阶矩。请推导基于无迹变换的第一个状态分量的预测均值 $\\hat{x}_{1,k+1|k}$。\n\n报告标量值 $\\hat{x}_{1,k+1|k}$。将您的答案四舍五入至八位有效数字。无需单位。", "solution": "该问题要求使用无迹卡尔曼滤波器 (UKF) 的预测步骤，为一个给定的离散时间非线性系统计算预测状态均值，特别是其第一个分量 $\\hat{x}_{1,k+1|k}$。\n\n首先对问题进行验证。\n已知条件：\n- 状态动力学：$x_{k+1} = f(x_k) + w_k$，其中 $f(x) = \\begin{bmatrix} x_1 + \\sin(x_2) \\\\ x_2 \\end{bmatrix}$。\n- 过程噪声：$w_k \\sim \\mathcal{N}(0, Q)$，其中 $Q = 0.01 I_2 = \\begin{bmatrix} 0.01  0 \\\\ 0  0.01 \\end{bmatrix}$。\n- 测量方程：$y_k = h(x_k) + v_k$，其中 $h(x) = [x_1^2]$。\n- 时间 $k$ 的状态估计均值：$\\hat{x}_{k|k} = \\begin{bmatrix} 0.5 \\\\ 0.1 \\end{bmatrix}$。\n- 时间 $k$ 的状态估计协方差：$P_{k|k} = \\begin{bmatrix} 0.04  0.01 \\\\ 0.01  0.09 \\end{bmatrix}$。\n- UKF 参数：$\\alpha = 10^{-3}$，$\\beta = 2$，$\\kappa = 0$。正弦函数参数单位为弧度。\n\n验证结论：\n该问题具有科学依据，提法恰当，客观且信息完整，足以完成所要求的任务。这是无迹卡尔曼滤波器的一个标准应用。所提供的数据一致且足以执行预测步骤。该问题被认定为有效。\n\nUKF 预测步骤通过将一组确定性选择的“sigma 点”通过非线性状态动力学进行传播，来计算预测均值 $\\hat{x}_{k+1|k}$ 和协方差 $P_{k+1|k}$。由于过程噪声 $w_k$ 是加性的且均值为零，因此它对预测均值的贡献为零。预测均值计算为传播后的 sigma 点的加权平均值：\n$$ \\hat{x}_{k+1|k} = \\sum_{i=0}^{2n} W_i^{(m)} \\mathcal{X}_{i, k+1|k}^* $$\n其中 $\\mathcal{X}_{i, k+1|k}^* = f(\\mathcal{X}_{i, k|k})$ 是传播后的 sigma 点，$W_i^{(m)}$ 是用于计算均值的权重。\n\n步骤 1：计算 UKF 权重\n状态维度为 $n=2$。缩放参数 $\\lambda$ 由下式给出：\n$$ \\lambda = \\alpha^2(n + \\kappa) - n $$\n代入给定值：\n$$ \\lambda = (10^{-3})^2(2 + 0) - 2 = 2 \\times 10^{-6} - 2 = -1.999998 $$\n用于计算均值的权重 $W_i^{(m)}$ 为：\n$$ W_0^{(m)} = \\frac{\\lambda}{n+\\lambda} = \\frac{-1.999998}{2 - 1.999998} = \\frac{-1.999998}{0.000002} = -999999 $$\n$$ W_i^{(m)} = \\frac{1}{2(n+\\lambda)} = \\frac{1}{2(0.000002)} = 250000 \\quad \\text{对于 } i=1, \\dots, 2n $$\n注意，权重之和为 $1$：$W_0^{(m)} + 2n \\cdot W_i^{(m)} = -999999 + 4 \\cdot 250000 = 1$。这些权重的大数值警示了如果进行朴素计算，可能会由于灾难性抵消而导致数值不稳定。\n\n步骤 2：生成 Sigma 点\n$2n+1 = 5$ 个 sigma 点 $\\mathcal{X}_{i, k|k}$ 是基于均值 $\\hat{x}_{k|k}$ 和协方差 $P_{k|k}$ 生成的。\n$$ \\mathcal{X}_{0, k|k} = \\hat{x}_{k|k} $$\n$$ \\mathcal{X}_{i, k|k} = \\hat{x}_{k|k} + (\\sqrt{(n+\\lambda)P_{k|k}})_i \\quad \\text{对于 } i=1, \\dots, n $$\n$$ \\mathcal{X}_{i+n, k|k} = \\hat{x}_{k|k} - (\\sqrt{(n+\\lambda)P_{k|k}})_i \\quad \\text{对于 } i=1, \\dots, n $$\n其中 $(\\cdot)_i$ 表示矩阵平方根的第 $i$ 列，通常通过 Cholesky 分解计算。令 $S = \\sqrt{(n+\\lambda)P_{k|k}}$。\n$$ (n+\\lambda)P_{k|k} = 2 \\times 10^{-6} \\begin{bmatrix} 0.04  0.01 \\\\ 0.01  0.09 \\end{bmatrix} = \\begin{bmatrix} 8 \\times 10^{-8}  2 \\times 10^{-8} \\\\ 2 \\times 10^{-8}  1.8 \\times 10^{-7} \\end{bmatrix} $$\nCholesky 分解 $S S^\\top = (n+\\lambda)P_{k|k}$ 得到一个下三角矩阵 $S$：\n$$ S_{11} = \\sqrt{8 \\times 10^{-8}} = 2\\sqrt{2} \\times 10^{-4} \\approx 2.8284 \\times 10^{-4} $$\n$$ S_{21} = \\frac{2 \\times 10^{-8}}{S_{11}} = \\frac{1}{\\sqrt{2}} \\times 10^{-4} \\approx 0.7071 \\times 10^{-4} $$\n$$ S_{12} = 0 $$\n$$ S_{22} = \\sqrt{(1.8 \\times 10^{-7}) - S_{21}^2} = \\sqrt{1.8 \\times 10^{-7} - 0.5 \\times 10^{-8}} = \\sqrt{17.5 \\times 10^{-8}} \\approx 4.1833 \\times 10^{-4} $$\n位移向量（$S$ 的列向量）是 $d_1 = [S_{11}, S_{21}]^\\top$ 和 $d_2 = [S_{12}, S_{22}]^\\top = [0, S_{22}]^\\top$。\n\n步骤 3：传播 Sigma 点并计算预测均值\nsigma 点通过状态转移函数 $f(x) = [x_1 + \\sin(x_2), x_2]^\\top$ 进行传播。我们关心的是预测均值的第一个分量 $\\hat{x}_{1, k+1|k}$。\n传播后的点的第一个分量是：\n$$ \\mathcal{X}_{1,0}^* = (\\hat{x}_{1,k|k}) + \\sin(\\hat{x}_{2,k|k}) = 0.5 + \\sin(0.1) $$\n$$ \\mathcal{X}_{1,1}^* = (\\hat{x}_{1,k|k} + S_{11}) + \\sin(\\hat{x}_{2,k|k} + S_{21}) $$\n$$ \\mathcal{X}_{1,2}^* = (\\hat{x}_{1,k|k} + S_{12}) + \\sin(\\hat{x}_{2,k|k} + S_{22}) = 0.5 + \\sin(0.1 + S_{22}) $$\n$$ \\mathcal{X}_{1,3}^* = (\\hat{x}_{1,k|k} - S_{11}) + \\sin(\\hat{x}_{2,k|k} - S_{21}) $$\n$$ \\mathcal{X}_{1,4}^* = (\\hat{x}_{1,k|k} - S_{12}) + \\sin(\\hat{x}_{2,k|k} - S_{22}) = 0.5 + \\sin(0.1 - S_{22}) $$\n预测均值是加权和：\n$$ \\hat{x}_{1,k+1|k} = W_0^{(m)} \\mathcal{X}_{1,0}^* + \\sum_{i=1}^{4} W_i^{(m)} \\mathcal{X}_{1,i}^* $$\n为避免大数相减导致的数值不稳定，我们简化此表达式。使用 $W_0^{(m)} = 1 - 4W_i^{(m)}$：\n$$ \\hat{x}_{1,k+1|k} = (1 - 4W_i^{(m)})\\mathcal{X}_{1,0}^* + W_i^{(m)} \\sum_{i=1}^{4} \\mathcal{X}_{1,i}^* = \\mathcal{X}_{1,0}^* + W_i^{(m)} \\left(\\sum_{i=1}^{4} \\mathcal{X}_{1,i}^* - 4\\mathcal{X}_{1,0}^* \\right) $$\n让我们分析求和项：\n$$ \\sum_{i=1}^{4} \\mathcal{X}_{1,i}^* = (0.5+S_{11})+(0.5)+(0.5-S_{11})+(0.5) + \\sin(0.1+S_{21}) + \\sin(0.1+S_{22}) + \\sin(0.1-S_{21}) + \\sin(0.1-S_{22}) $$\n$$ = 2 + [\\sin(0.1+S_{21}) + \\sin(0.1-S_{21})] + [\\sin(0.1+S_{22}) + \\sin(0.1-S_{22})] $$\n使用恒等式 $\\sin(A+B)+\\sin(A-B) = 2\\sin(A)\\cos(B)$：\n$$ = 2 + 2\\sin(0.1)\\cos(S_{21}) + 2\\sin(0.1)\\cos(S_{22}) $$\n均值公式中括号内的项变为：\n$$ \\sum_{i=1}^{4} \\mathcal{X}_{1,i}^* - 4\\mathcal{X}_{1,0}^* = 2 + 2\\sin(0.1)[\\cos(S_{21}) + \\cos(S_{22})] - 4(0.5 + \\sin(0.1)) $$\n$$ = 2 + 2\\sin(0.1)[\\cos(S_{21}) + \\cos(S_{22})] - 2 - 4\\sin(0.1) $$\n$$ = 2\\sin(0.1)[\\cos(S_{21}) + \\cos(S_{22}) - 2] $$\n将此代回 $\\hat{x}_{1,k+1|k}$ 的公式，并使用 $W_i^{(m)} = 1/(2(n+\\lambda))$：\n$$ \\hat{x}_{1,k+1|k} = \\mathcal{X}_{1,0}^* + \\frac{1}{2(n+\\lambda)} \\left( 2\\sin(0.1)[\\cos(S_{21}) + \\cos(S_{22}) - 2] \\right) $$\n$$ \\hat{x}_{1,k+1|k} = 0.5 + \\sin(0.1) + \\frac{\\sin(0.1)}{n+\\lambda} [\\cos(S_{21}) + \\cos(S_{22}) - 2] $$\n由于 $S_{21}$ 和 $S_{22}$ 非常小，我们使用泰勒展开式 $\\cos(x) \\approx 1 - x^2/2$。方括号中的项变为：\n$$ [\\cos(S_{21}) + \\cos(S_{22}) - 2] \\approx (1 - S_{21}^2/2) + (1 - S_{22}^2/2) - 2 = -\\frac{1}{2}(S_{21}^2 + S_{22}^2) $$\n根据 Cholesky 分解的性质，$S_{21}^2 + S_{22}^2 = ((n+\\lambda)P_{k|k})_{22} = (n+\\lambda)P_{22,k|k}$。\n$$ [\\cos(S_{21}) + \\cos(S_{22}) - 2] \\approx -\\frac{1}{2}(n+\\lambda)P_{22,k|k} $$\n对于给定的参数，这个近似非常精确。代入均值的表达式中：\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5 + \\sin(0.1) + \\frac{\\sin(0.1)}{n+\\lambda} \\left[ -\\frac{1}{2}(n+\\lambda)P_{22,k|k} \\right] $$\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5 + \\sin(0.1) - \\frac{1}{2} P_{22,k|k} \\sin(0.1) $$\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5 + \\sin(0.1) \\left( 1 - \\frac{P_{22,k|k}}{2} \\right) $$\n现在，我们代入数值：$P_{22,k|k}=0.09$。\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5 + \\sin(0.1) \\left( 1 - \\frac{0.09}{2} \\right) = 0.5 + 0.955 \\sin(0.1) $$\n使用高精度的 $\\sin(0.1) \\approx 0.09983341664682815$ 值：\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5 + 0.955 \\times 0.09983341664682815 $$\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5 + 0.0953409128977209 $$\n$$ \\hat{x}_{1,k+1|k} \\approx 0.5953409128977209 $$\n四舍五入到八位有效数字，结果是 $0.59534091$。\n\n这个结果与期望值的二阶泰勒级数展开一致，而无迹变换正是为了精确近似该值而设计的。为了获得数值稳定的计算结果，符号简化是必要的。", "answer": "$$\\boxed{0.59534091}$$", "id": "2888306"}, {"introduction": "尽管UKF在大多数情况下比EKF更精确，但没有一种滤波器是普适最优的。理解一个算法的局限性和潜在的失效模式，是达到专家级水平的标志。这个练习 [@problem_id:3429813] 展示了一个精心设计的场景，其中包含一个分段线性函数 $f(x)=a|x|$。出人意料的是，EKF在这种情况下能给出精确解，而UKF却可能因为其sigma点 $\\mathcal{X}_i$ 跨越了函数在原点的不可导“拐点”而发散。这个“折叠”现象会导致被传播的点分布被严重扭曲，从而产生一个不正确的状态估计。通过实现并分析这个案例，您将对UKF形成一种批判性的视角，认识到滤波器的性能不仅取决于非线性的程度，还与非线性的结构以及由参数 $(\\alpha, \\kappa)$ 决定的sigma点分布密切相关。", "problem": "考虑一个确定性的、离散时间的、一维的状态空间系统，该系统没有过程噪声或观测噪声。设状态由 $x_k \\in \\mathbb{R}$ 表示，并根据一个分段线性切换映射演化，该映射由一个线性映射和一个符号切换复合而成。具体来说，定义动力学函数 $f$ 和观测函数 $h$ 如下\n- $f(x) = a \\, s(x) \\, x$，其中当 $x \\ge 0$ 时 $s(x) = 1$，否则 $s(x) = -1$，并且 $a \\in \\mathbb{R}$ 是一个已知常数，\n- $h(x) = x$。\n假设系统中没有任何过程噪声和测量噪声，并且不进行任何测量数据融合；只执行时间传播。\n\n给定时间 $k=0$ 时的初始高斯先验状态分布，记为 $\\mathcal{N}(m_0, P_0)$，其中 $m_0 \\in \\mathbb{R}$ 且 $P_0  0$。真实状态 $x_k$ 从 $x_0 = m_0$ 开始，通过 $x_{k+1} = f(x_k)$ 进行确定性演化。由于 $s(x)$ 的符号结构和下面所选的参数，在所有关心的时间内，真实状态都保持在单个线性分支上。\n\n您的任务是：\n- 为上述系统实现扩展卡尔曼滤波器 (EKF) 和无迹卡尔曼滤波器 (UKF) 的均值和协方差传播器。对于 UKF，使用带有参数 $\\alpha$、$\\kappa$ 和 $\\beta$ 的标准无迹变换，其中状态维度 $n=1$。参数 $\\beta$ 应设置为高斯先验的标准值。\n- 在没有任何测量更新的情况下，将两个滤波器传播 $T$ 个时间步。\n- 对于每个测试的 $(\\alpha,\\kappa)$ 对，计算 UKF 在时间 $T$ 的均值相对于从 $x_0 = m_0$ 开始的真实状态 $x_T$ 的绝对误差。使用 EKF 验证其在这种情况下保持精确（此验证是内部的，不需要在最终输出中报告；但必须在您的代码中使用，以确保科学和数值的正确性）。\n- 对于每个 $(\\alpha,\\kappa)$，根据下述标准返回一个布尔标志，指示 UKF 是否发散。\n\n基本原理和约束条件：\n- 确定性传播：$x_{k+1} = f(x_k)$，其中 $f(x) = a \\, s(x) \\, x$，系统中没有任何噪声。\n- 确定性映射下的高斯先验传播：对于 $X_k \\sim \\mathcal{N}(m_k, P_k)$，精确均值按 $m_{k+1} = \\mathbb{E}[f(X_k)]$ 演化，而 EKF 和 UKF 以不同方式逼近此均值。\n- 扩展卡尔曼滤波器 (EKF) 在当前均值处对动力学进行线性化，并使用局部雅可比矩阵传播均值和协方差，就好像该映射在均值的邻域内是线性的一样。\n- 无迹卡尔曼滤波器 (UKF) 通过无迹变换，使用由 $\\alpha$、$\\kappa$ 和 $\\beta$ 决定的权重的 $2n+1$ 个 sigma 点来逼近均值和协方差。\n\n使用的场景参数：\n- $n = 1$，\n- $a = 1.5$（无量纲），\n- $m_0 = 0.05$（无量纲），\n- $P_0 = 0.04$（无量纲），\n- $T = 10$（无量纲时间步），\n- $\\beta = 2$（高斯先验的标准选择）。\n\n发散的定义：\n- 定义发散阈值 $\\tau = 0.5$（无量纲）。对于给定的 $(\\alpha,\\kappa)$，如果绝对误差 $|m_T^{\\text{UKF}} - x_T|$ 超过 $\\tau$，则称 UKF 发散。其中 $m_T^{\\text{UKF}}$ 是经过 $T$ 次传播后的 UKF 均值，而 $x_T$ 是从 $x_0 = m_0$ 开始经过 $T$ 步后的真实状态。\n\n测试套件：\n为以下 $(\\alpha,\\kappa)$ 对评估发散标志：\n- 情况 1：$(\\alpha,\\kappa) = (0.1, 0.0)$，\n- 情况 2：$(\\alpha,\\kappa) = (0.5, 0.0)$，\n- 情况 3：$(\\alpha,\\kappa) = (1.0, 0.0)$，\n- 情况 4：$(\\alpha,\\kappa) = (0.9, -0.5)$，\n- 情况 5：$(\\alpha,\\kappa) = (0.05, 2.0)$。\n\n附加要求和说明：\n- 确保对于所有测试用例，无迹变换的缩放量 $n+\\lambda$ 均为正，其中 $\\lambda = \\alpha^2 (n+\\kappa) - n$，以便 sigma 点有良好定义。以上测试值满足此条件。\n- 不涉及角度；除了提供的无量纲标量外，不需要特殊的单位处理。\n- 程序必须为每个测试用例计算一个布尔结果，根据上述标准指示 UKF 是否发散（true）或不发散（false）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，布尔值应采用编程语言原生的布尔字符串格式（例如，$[True,False,True,False,True]$）。顺序必须与上述五个情况匹配。", "solution": "问题陈述经评估有效。它在科学上基于估计理论，在数学上是适定的，并且所有参数和条件都得到了明确的规定。\n\n核心任务是通过随时间传播一个初始高斯分布，并将滤波器的预测均值与真实的确定性状态演化进行比较，来分析无迹卡尔曼滤波器 (UKF) 对于一维非线性系统的性能。\n\n**1. 系统动力学与真实状态演化**\n\n系统状态根据离散时间映射 $x_{k+1} = f(x_k)$ 演化。函数 $f(x)$ 定义为 $f(x) = a \\cdot s(x) \\cdot x$，其中 $a = 1.5$，$s(x)$ 是一个类符号函数，当 $x \\ge 0$ 时 $s(x) = 1$，当 $x  0$ 时 $s(x) = -1$。我们可以更紧凑地表示 $f(x)$。\n- 若 $x \\ge 0$，$f(x) = a \\cdot (1) \\cdot x = ax = a|x|$。\n- 若 $x  0$，$f(x) = a \\cdot (-1) \\cdot x = -ax = a|x|$。\n因此，对于所有 $x \\in \\mathbb{R}$，动力学由函数 $f(x) = a|x|$ 给出。\n\n真实状态在 $x_0 = m_0 = 0.05$ 处初始化，并进行确定性演化。由于 $x_0  0$ 且 $a = 1.5  1$，第一个状态是 $x_1 = f(x_0) = 1.5 \\cdot |0.05| = 0.075$。通过归纳法，如果 $x_k  0$，那么 $x_{k+1} = a x_k  x_k  0$。因此，对于所有 $k \\ge 0$，真实状态 $x_k$ 保持为正。其演化是一个简单的几何级数：\n$$x_k = a^k x_0$$\n经过 $T=10$ 个时间步后，真实状态为 $x_T = a^T m_0 = (1.5)^{10} \\cdot 0.05$。该值作为评估 UKF 准确性的基准真相。\n\n**2. 作为参考的扩展卡尔曼滤波器 (EKF)**\n\nEKF 通过在当前均值周围对动力学进行线性化来传播均值 $m_k$ 和协方差 $P_k$。预测均值由 $m_{k+1}^{\\text{EKF}} = f(m_k^{\\text{EKF}})$ 给出。\n从 $m_0^{\\text{EKF}} = m_0 = 0.05  0$ 开始，EKF 均值在所有后续步骤中也保持为正，遵循与真实状态相同的逻辑。因此，$f(m_k^{\\text{EKF}}) = a \\cdot |m_k^{\\text{EKF}}| = a \\cdot m_k^{\\text{EKF}}$。EKF 均值演化如下：\n$$m_{k+1}^{\\text{EKF}} = a \\cdot m_k^{\\text{EKF}}$$\n这与真实状态 $x_k$ 的递推关系相同。由于它们从相同的初始条件 ($m_0^{\\text{EKF}} = x_0$) 开始，EKF 均值在所有时间点都能完美跟踪真实状态：$m_k^{\\text{EKF}} = x_k$。\n问题中提到 EKF 是“精确的”指的就是这个事实：其均值估计 $m_T^{\\text{EKF}}$ 与真实的确定性状态 $x_T$ 完全相同。因此，误差 $|m_T^{\\text{UKF}} - x_T|$ 等价于 $|m_T^{\\text{UKF}} - m_T^{\\text{EKF}}|$。\n\n**3. 无迹卡尔曼滤波器 (UKF) 传播算法**\n\nUKF 通过将一组确定性选择的“sigma 点”通过真实的非线性函数进行传播，从而避免了直接线性化。然后从这些传播后的点重构均值和协方差。\n\n对于状态维度 $n=1$，UKF 使用 $2n+1=3$ 个 sigma 点。它们的位置由当前均值 $m_k$、协方差 $P_k$ 以及参数 $\\alpha$、$\\kappa$ 决定。缩放参数 $\\lambda$ 计算如下：\n$$\\lambda = \\alpha^2 (n+\\kappa) - n = \\alpha^2 (1+\\kappa) - 1$$\n第 $k$ 步的 sigma 点为：\n$$\n\\begin{align*}\n\\mathcal{X}_k^{(0)} = m_k^{\\text{UKF}} \\\\\n\\mathcal{X}_k^{(1)} = m_k^{\\text{UKF}} + \\sqrt{(n+\\lambda)P_k^{\\text{UKF}}} \\\\\n\\mathcal{X}_k^{(2)} = m_k^{\\text{UKF}} - \\sqrt{(n+\\lambda)P_k^{\\text{UKF}}}\n\\end{align*}\n$$\n用于重构均值 ($W^{(m)}$) 和协方差 ($W^{(c)}$) 的权重由 $\\lambda$、$\\alpha$ 和 $\\beta=2$ 定义如下：\n$$\n\\begin{align*}\nW_0^{(m)} = \\frac{\\lambda}{n+\\lambda}  W_i^{(m)} = \\frac{1}{2(n+\\lambda)} \\quad \\text{for } i=1,2 \\\\\nW_0^{(c)} = \\frac{\\lambda}{n+\\lambda} + (1-\\alpha^2+\\beta)  W_i^{(c)} = \\frac{1}{2(n+\\lambda)} \\quad \\text{for } i=1,2\n\\end{align*}\n$$\n每个时间步 $k$ 的传播过程如下：\n1.  **传播点**：每个 sigma 点都通过非线性函数 $f(x)=a|x|$ 进行传播：\n    $$\\mathcal{Y}_k^{(i)} = f(\\mathcal{X}_k^{(i)}) = a|\\mathcal{X}_k^{(i)}| \\quad \\text{for } i=0,1,2$$\n2.  **预测均值**：预测均值 $m_{k+1}^{\\text{UKF}}$ 是传播后各点的加权平均值：\n    $$m_{k+1}^{\\text{UKF}} = \\sum_{i=0}^{2} W_i^{(m)} \\mathcal{Y}_k^{(i)}$$\n3.  **预测协方差**：预测协方差 $P_{k+1}^{\\text{UKF}}$ 是平方偏差的加权和：\n    $$P_{k+1}^{\\text{UKF}} = \\sum_{i=0}^{2} W_i^{(c)} (\\mathcal{Y}_k^{(i)} - m_{k+1}^{\\text{UKF}})^2$$\n\n**4. UKF 行为与发散分析**\n\nUKF 行为的关键在于其 sigma 点如何与 $x=0$ 处的非线性相互作用。sigma 点的散布由项 $\\sqrt{(n+\\lambda)P_k} = \\sqrt{\\alpha^2(1+\\kappa)P_k} = |\\alpha|\\sqrt{(1+\\kappa)P_k}$ 控制。\n-   如果所有三个 sigma 点 $\\mathcal{X}_k^{(0)}、\\mathcal{X}_k^{(1)}、\\mathcal{X}_k^{(2)}$ 均为非负数，则变换在这些点上实际上是线性的 ($f(x)=ax$)。在这种情况下，UKF 均值更新得到 $m_{k+1}^{\\text{UKF}} = a m_k^{\\text{UKF}}$，其行为与 EKF 完全相同。这发生在散布足够小，使得 $m_k^{\\text{UKF}} - |\\alpha|\\sqrt{(1+\\kappa)P_k^{\\text{UKF}}} \\ge 0$ 时。\n-   如果散布足够大，下 sigma 点 $\\mathcal{X}_k^{(2)}$ 可能变为负数，而中心点 $m_k^{\\text{UKF}}$ 保持为正。函数 $f(x)=a|x|$ 会将这个负点“折叠”到一个正值：$\\mathcal{Y}_k^{(2)} = a|\\mathcal{X}_k^{(2)}|  0$。由于传播后的点 $\\mathcal{Y}_k^{(1)}$ 和 $\\mathcal{Y}_k^{(2)}$ 相对于传播后的中心点 $\\mathcal{Y}_k^{(0)}$ 的位置不再对称，重构的均值 $m_{k+1}^{\\text{UKF}}$ 会出现偏斜，通常会偏向一个比真实状态演化所暗示的要大得多的值。\n\n这个误差会在 $T=10$ 步中累积。导致 sigma 点散布更大的参数 $(\\alpha, \\kappa)$ 会使这种穿越发生得更早、更严重，从而增加最终误差 $|m_T^{\\text{UKF}} - x_T|$。如果该误差超过阈值 $\\tau=0.5$，则认为滤波器已经发散。\n\n**5. 实现与评估**\n\n所描述的 UKF 传播算法将针对五个测试用例 $(\\alpha, \\kappa)$ 中的每一个进行实现。从初始状态 $m_0=0.05$ 和 $P_0=0.04$ 开始，滤波器迭代 $T=10$ 步。计算最终的 UKF 均值 $m_T^{\\text{UKF}}$，并与真实状态 $x_T=(1.5)^{10} \\cdot 0.05$ 进行比较。然后为每种情况确定发散的布尔标志 $|m_T^{\\text{UKF}} - x_T|  0.5$。程序将按指定顺序输出这些布尔标志。", "answer": "$$\\boxed{[False, True, True, True, False]}$$", "id": "3429813"}]}