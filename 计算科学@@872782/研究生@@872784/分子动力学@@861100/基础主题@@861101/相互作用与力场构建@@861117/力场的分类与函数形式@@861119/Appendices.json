{"hands_on_practices": [{"introduction": "我们的实践将从分子的基本构成单元——化学键开始。我们将比较简谐近似与更真实的莫尔斯势（Morse potential），来描述化学键的伸缩振动。通过推导两种势函数下的作用力并分析键长涨落，您将对非谐性的概念及其在分子模拟中的物理效应有更深刻的理解 [@problem_id:3413996]。", "problem": "考虑分子动力学（MD）中的单个双原子键坐标 $r$，它被建模为一个与其他模式解耦的内自由度，并在温度 $T$ 下从正则系综中进行采样。键伸缩相互作用由 Morse 泛函形式描述，该形式属于非谐键势能类别：\n$$U_{b}(r) = D_{e}\\left[1 - \\exp\\!\\left(-a\\,(r - r_{0})\\right)\\right]^{2},$$\n其中 $D_{e}  0$ 是解离能，$a  0$ 是一个逆长度参数，$r_{0}$ 是平衡键长。\n\n1. 使用力的定义 $F(r) = -\\partial U_{b}/\\partial r$ 和基本微积分，推导 $F(r)$ 作为 $r$ 的函数的精确解析表达式。\n\n2. 为了比较不同力场类别下键长围绕 $r_{0}$ 的平衡涨落，定义谐振（二次）参考势\n$$U_{H}(r) = \\frac{1}{2}k\\,(r - r_{0})^{2},$$\n其中 $k$ 的选择应使 $r_{0}$ 处的谐振曲率与 Morse 曲率 $U_{b}''(r_{0})$ 相匹配。在正则系综（逆温度 $\\beta = 1/(k_{B}T)$，其中 $k_{B}$ 是玻尔兹曼常数）的框架下，从第一性原理推导谐振模型的平衡均方涨落 $\\sigma_{H}^{2} = \\langle (r - r_{0})^{2}\\rangle$。\n\n3. 现在，将在 $r_{0}$ 附近的 Morse 势通过其关于位移 $x = r - r_{0}$ 的泰勒级数展开到四阶来进行近似，\n$$U_{b}(r) \\approx c_{2}\\,x^{2} + c_{3}\\,x^{3} + c_{4}\\,x^{4},$$\n其中系数 $c_{2}$、$c_{3}$ 和 $c_{4}$ 从给定的 $U_{b}(r)$ 的展开式中获得。假设处于低温、弱非谐性区域 $k_{B}T \\ll D_{e}$，并使用关于由 $U_{H}(r)$ 定义的高斯基线的微扰理论，计算四阶近似 Morse 势的平衡均方涨落 $\\sigma_{M}^{2} = \\langle x^{2}\\rangle$，保留至 $\\mathcal{O}((k_{B}T)^{2})$ 阶的项。\n\n4. 提供比率 $\\sigma_{M}^{2}/\\sigma_{H}^{2}$ 在 $k_{B}T/D_{e}$ 的领头非平凡阶上的闭式解析表达式，以及在第1部分中得到的 $F(r)$ 的精确解析表达式。题目未给出数值，无需进行舍入。将最终比率表示为 $D_{e}$、$a$ 和 $T$（以及 $k_{B}$）的无量纲表达式，并将力 $F(r)$ 表示为 $r$ 的函数。", "solution": "该问题经评估是有效的，因为它具有科学依据、问题明确且客观。这是一个应用于分子建模的统计力学标准问题，并为得出唯一解提供了所有必要的信息。\n\n解答根据题目要求分为四个部分进行推导。\n\n**第1部分：力 $F(r)$ 的推导**\n\n键坐标 $r$ 上的力 $F(r)$ 定义为势能 $U_{b}(r)$ 的负梯度。\nMorse 势由下式给出：\n$$U_{b}(r) = D_{e}\\left[1 - \\exp(-a\\,(r - r_{0}))\\right]^{2}$$\n为了求出力，我们必须计算 $U_{b}(r)$ 对 $r$ 的导数。使用链式法则：\n$$\\frac{\\partial U_{b}}{\\partial r} = D_{e} \\cdot 2 \\left[1 - \\exp(-a\\,(r - r_{0}))\\right] \\cdot \\frac{\\partial}{\\partial r} \\left[1 - \\exp(-a\\,(r - r_{0}))\\right]$$\n方括号中项的导数是：\n$$\\frac{\\partial}{\\partial r} \\left[1 - \\exp(-a\\,(r - r_{0}))\\right] = - \\exp(-a\\,(r - r_{0})) \\cdot \\frac{\\partial}{\\partial r} \\left[-a\\,(r - r_{0})\\right] = - \\exp(-a\\,(r - r_{0})) \\cdot (-a) = a \\exp(-a\\,(r - r_{0}))$$\n将此代回，我们得到势的梯度：\n$$\\frac{\\partial U_{b}}{\\partial r} = 2 D_{e} \\left[1 - \\exp(-a\\,(r - r_{0}))\\right] \\cdot a \\exp(-a\\,(r - r_{0})) = 2aD_{e} \\left(\\exp(-a\\,(r - r_{0})) - \\exp(-2a\\,(r - r_{0}))\\right)$$\n力是该梯度的负值：\n$$F(r) = -\\frac{\\partial U_{b}}{\\partial r} = -2aD_{e} \\left(\\exp(-a\\,(r - r_{0})) - \\exp(-2a\\,(r - r_{0}))\\right) = 2aD_{e} \\left(\\exp(-2a\\,(r - r_{0})) - \\exp(-a\\,(r - r_{0}))\\right)$$\n\n**第2部分：谐振近似下的均方涨落，$\\sigma_{H}^{2}$**\n\n首先，我们通过使谐振势 $U_{H}(r)$ 的曲率与 Morse 势 $U_{b}(r)$ 在平衡位置 $r_{0}$ 处的曲率相匹配来确定谐振力常数 $k$。曲率由二阶导数给出。\n从第1部分可知，一阶导数为 $U_{b}'(r) = 2aD_{e} (\\exp(-a(r - r_{0})) - \\exp(-2a(r - r_{0})))$。\n二阶导数为：\n$$U_{b}''(r) = \\frac{\\partial}{\\partial r} \\left[2aD_{e} \\left(\\exp(-a(r - r_{0})) - \\exp(-2a(r - r_{0}))\\right)\\right] = 2aD_{e} \\left(-a\\exp(-a(r - r_{0})) + 2a\\exp(-2a(r - r_{0}))\\right)$$\n在 $r = r_{0}$ 处求值：\n$$k = U_{b}''(r_{0}) = 2aD_{e} \\left(-a\\exp(0) + 2a\\exp(0)\\right) = 2aD_{e}(-a + 2a) = 2a^{2}D_{e}$$\n谐振势为 $U_{H}(r) = \\frac{1}{2}k(r - r_{0})^{2}$。令 $x = r - r_{0}$。均方涨落 $\\sigma_{H}^{2}$ 是正则系综中对此谐振势的期望值 $\\langle x^{2} \\rangle$：\n$$\\sigma_{H}^{2} = \\langle x^{2} \\rangle_{H} = \\frac{\\int_{-\\infty}^{\\infty} x^{2} \\exp(-\\beta U_{H}(x)) \\,dx}{\\int_{-\\infty}^{\\infty} \\exp(-\\beta U_{H}(x)) \\,dx} = \\frac{\\int_{-\\infty}^{\\infty} x^{2} \\exp(-\\frac{1}{2}\\beta k x^{2}) \\,dx}{\\int_{-\\infty}^{\\infty} \\exp(-\\frac{1}{2}\\beta k x^{2}) \\,dx}$$\n这些是标准高斯积分。分母为 $\\sqrt{2\\pi/(\\beta k)}$，分子为 $\\frac{1}{\\beta k}\\sqrt{2\\pi/(\\beta k)}$。\n因此，谐振模型的均方涨落为：\n$$\\sigma_{H}^{2} = \\frac{1}{\\beta k} = \\frac{1}{\\beta(2a^{2}D_{e})} = \\frac{k_{B}T}{2a^{2}D_{e}}$$\n\n**第3部分：四阶近似下的均方涨落，$\\sigma_{M}^{2}$**\n\n我们通过将 Morse 势在 $x = r - r_{0}$ 处进行泰勒级数展开至四阶来近似它：\n$$U_{b}(r) \\approx U_{b}(r_0) + U_{b}'(r_0)x + \\frac{U_{b}''(r_0)}{2!}x^2 + \\frac{U_{b}'''(r_0)}{3!}x^3 + \\frac{U_{b}''''(r_0)}{4!}x^4$$\n在最小值点 $r_{0}$ 处，$U_{b}(r_0) = 0$ 且 $U_{b}'(r_0) = 0$。势能变为 $U_{approx}(x) = c_{2}x^{2} + c_{3}x^{3} + c_{4}x^{4}$。我们需要 $U_b(r)$ 的三阶和四阶导数：\n$$U_{b}'''(r) = 2a^2D_{e}\\frac{\\partial}{\\partial r}\\left(2\\exp(-2a(r-r_0)) - \\exp(-a(r-r_0))\\right) = 2a^2D_{e}\\left(-4a\\exp(-2a(r-r_0)) + a\\exp(-a(r-r_0))\\right)$$\n$$U_{b}''''(r) = 2a^3D_{e}\\frac{\\partial}{\\partial r}\\left(\\exp(-a(r-r_0)) - 4\\exp(-2a(r-r_0))\\right) = 2a^3D_{e}\\left(-a\\exp(-a(r-r_0)) + 8a\\exp(-2a(r-r_0))\\right)$$\n在 $r=r_{0}$ 处求值：\n$$U_{b}'''(r_0) = 2a^3D_{e}(1 - 4) = -6a^3D_{e}$$\n$$U_{b}''''(r_0) = 2a^4D_{e}(-1 + 8) = 14a^4D_{e}$$\n系数为：\n$$c_{2} = \\frac{U_{b}''(r_0)}{2} = \\frac{2a^2D_{e}}{2} = a^2D_{e}$$\n$$c_{3} = \\frac{U_{b}'''(r_0)}{6} = \\frac{-6a^3D_{e}}{6} = -a^3D_{e}$$\n$$c_{4} = \\frac{U_{b}''''(r_0)}{24} = \\frac{14a^4D_{e}}{24} = \\frac{7}{12}a^4D_{e}$$\n未微扰势是谐振部分 $U_0(x) = c_2 x^2$，微扰项是 $U_{pert}(x) = c_3 x^3 + c_4 x^4$。\n我们使用配分函数 $Z$ 计算期望值 $\\sigma_{M}^{2} = \\langle x^{2} \\rangle$：\n$$\\sigma_{M}^{2} = -\\frac{1}{\\beta} \\frac{\\partial}{\\partial c_{2}} \\ln Z, \\quad \\text{where} \\quad Z = \\int_{-\\infty}^{\\infty} \\exp(-\\beta(c_2 x^2 + c_3 x^3 + c_4 x^4)) \\,dx$$\n使用 $\\ln Z$ 的累积量展开：\n$$\\ln Z \\approx \\ln Z_0 + \\ln \\langle \\exp(-\\beta U_{pert}) \\rangle_0 \\approx \\ln Z_0 - \\beta \\langle U_{pert} \\rangle_0 + \\frac{\\beta^2}{2} (\\langle U_{pert}^2 \\rangle_0 - \\langle U_{pert} \\rangle_0^2)$$\n其中 $\\langle \\cdot \\rangle_0$ 表示在谐振分布 $\\exp(-\\beta c_2 x^2)$ 上的平均值。\n奇数阶矩为零，所以 $\\langle x^3 \\rangle_0 = 0$。因此，$\\langle U_{pert} \\rangle_0 = c_4 \\langle x^4 \\rangle_0$。\n此外，$\\langle U_{pert}^2 \\rangle_0 = \\langle (c_3 x^3 + c_4 x^4)^2 \\rangle_0 = c_3^2 \\langle x^6 \\rangle_0 + c_4^2 \\langle x^8 \\rangle_0$。\n$$\\ln Z \\approx \\ln Z_0 - \\beta c_4 \\langle x^4 \\rangle_0 + \\frac{\\beta^2}{2} c_3^2 \\langle x^6 \\rangle_0 - \\frac{\\beta^2}{2} c_4^2 \\langle x^4 \\rangle_0^2 + \\dots$$\n保留对 $\\langle x^2 \\rangle$ 的修正贡献至 $\\mathcal{O}((k_B T)^2) = \\mathcal{O}(\\beta^{-2})$ 阶的项，我们可以忽略 $c_4^2$ 项。\n$$\\sigma_{M}^{2} = -\\frac{1}{\\beta} \\frac{\\partial}{\\partial c_2} \\left[ \\ln Z_0 - \\beta c_4 \\langle x^4 \\rangle_0 + \\frac{\\beta^2}{2} c_3^2 \\langle x^6 \\rangle_0 \\right]$$\n未微扰部分给出 $\\sigma_H^2$：$-\\frac{1}{\\beta} \\frac{\\partial \\ln Z_0}{\\partial c_2} = \\langle x^2 \\rangle_0 = \\frac{1}{2\\beta c_2}$。我们使用 $\\frac{\\partial \\langle x^{2n} \\rangle_0}{\\partial c_2} = -n \\frac{\\langle x^{2n} \\rangle_0}{c_2}$。\n$$\\sigma_{M}^{2} \\approx \\langle x^2 \\rangle_0 + c_4 \\frac{\\partial \\langle x^4 \\rangle_0}{\\partial c_2} - \\frac{\\beta c_3^2}{2} \\frac{\\partial \\langle x^6 \\rangle_0}{\\partial c_2} = \\langle x^2 \\rangle_0 + c_4 \\left(-2 \\frac{\\langle x^4 \\rangle_0}{c_2}\\right) - \\frac{\\beta c_3^2}{2} \\left(-3 \\frac{\\langle x^6 \\rangle_0}{c_2}\\right)$$\n$$\\sigma_{M}^{2} \\approx \\langle x^2 \\rangle_0 - \\frac{2c_4}{c_2} \\langle x^4 \\rangle_0 + \\frac{3\\beta c_3^2}{2c_2} \\langle x^6 \\rangle_0$$\n使用高斯矩 $\\langle x^4 \\rangle_0 = 3(\\langle x^2 \\rangle_0)^2$ 和 $\\langle x^6 \\rangle_0 = 15(\\langle x^2 \\rangle_0)^3$：\n$$\\sigma_{M}^{2} \\approx \\langle x^2 \\rangle_0 - \\frac{6c_4}{c_2}(\\langle x^2 \\rangle_0)^2 + \\frac{45\\beta c_3^2}{2c_2}(\\langle x^2 \\rangle_0)^3$$\n\n**第4部分：比率 $\\sigma_{M}^{2}/\\sigma_{H}^{2}$**\n\n除以 $\\sigma_H^2 = \\langle x^2 \\rangle_0$：\n$$\\frac{\\sigma_{M}^{2}}{\\sigma_{H}^{2}} \\approx 1 - \\frac{6c_4}{c_2}\\langle x^2 \\rangle_0 + \\frac{45\\beta c_3^2}{2c_2}(\\langle x^2 \\rangle_0)^2$$\n代入 $\\langle x^2 \\rangle_0 = \\frac{1}{2\\beta c_2}$：\n$$\\frac{\\sigma_{M}^{2}}{\\sigma_{H}^{2}} \\approx 1 - \\frac{6c_4}{c_2} \\frac{1}{2\\beta c_2} + \\frac{45\\beta c_3^2}{2c_2} \\left(\\frac{1}{2\\beta c_2}\\right)^2 = 1 - \\frac{3c_4}{\\beta c_2^2} + \\frac{45c_3^2}{8\\beta c_2^3}$$\n现在，代入系数 $c_2, c_3, c_4$ 的表达式：\n$$c_2 = a^2D_e, \\quad c_3 = -a^3D_e, \\quad c_4 = \\frac{7}{12}a^4D_e$$\n修正项为：\n$$-\\frac{3}{\\beta} \\frac{\\frac{7}{12}a^4D_e}{(a^2D_e)^2} + \\frac{45}{8\\beta} \\frac{(-a^3D_e)^2}{(a^2D_e)^3} = -\\frac{7}{4\\beta} \\frac{a^4D_e}{a^4D_e^2} + \\frac{45}{8\\beta} \\frac{a^6D_e^2}{a^6D_e^3}$$\n$$= -\\frac{7}{4\\beta D_e} + \\frac{45}{8\\beta D_e} = \\frac{-14 + 45}{8\\beta D_e} = \\frac{31}{8\\beta D_e}$$\n代入 $\\beta = 1/(k_B T)$：\n$$\\frac{\\sigma_{M}^{2}}{\\sigma_{H}^{2}} \\approx 1 + \\frac{31 k_B T}{8D_e}$$\n这是比率的最终表达式。\n\n最终答案要求给出此比率和第1部分得到的力 $F(r)$。\n$F(r) = 2aD_{e} \\left(\\exp(-2a\\,(r - r_{0})) - \\exp(-a\\,(r - r_{0}))\\right)$\n$\\frac{\\sigma_{M}^{2}}{\\sigma_{H}^{2}} = 1 + \\frac{31 k_B T}{8D_e}$", "answer": "$$ \\boxed{ \\begin{pmatrix} 2aD_{e} \\left(\\exp(-2a(r - r_{0})) - \\exp(-a(r - r_{0}))\\right) \\\\ 1 + \\frac{31 k_{B} T}{8 D_{e}} \\end{pmatrix} } $$", "id": "3413996"}, {"introduction": "在理解了简单的键振动之后，我们将处理更复杂的、决定分子构象的二面角扭转。您将学习如何通过将傅里叶级数（Fourier series）拟合到一组能量数据来参数化扭转势。这个练习将理论函数形式与其实际应用联系起来，展示了如何使用力场预测构象异构体布居数等热力学性质 [@problem_id:3414003]。", "problem": "给定一个丁烷围绕其中心碳-碳键的一维扭转能量扫描。该扫描包含了作为二面角函数的测量相对势能。角度域的周期为 $2\\pi$，扭转势是二面角 $\\phi$ 的函数，测量的能量单位为千焦/摩尔。角度值以度为单位提供，在进行任何三角函数计算时必须转换为弧度。\n\n基于以下事实：(i) 扭转势是二面角的周期函数，因此可以用三角级数表示；(ii) 对于温度 $T$ 下的能量 $E(\\phi)$，玻尔兹曼分布给出了构象的相对概率为 $p(\\phi) \\propto \\exp\\!\\left(-E(\\phi)/k_{\\mathrm{B}}T\\right)$。请建立一个计算方法，以拟合一个截断的傅里叶表示，然后计算构象异构体布居。你的方法必须基于三角函数的正交性和最小二乘拟合，除了通用的三角级数外，不假设任何特定的函数形式。\n\n数据与要求：\n- 令二面角 $\\phi$（单位：度）和相应的相对能量 $E$（单位：千焦/摩尔）为：\n  - $\\phi \\in \\{0,30,60,90,120,150,180,210,240,270,300,330\\}$ 度\n  - $E(\\phi) \\in \\{19.0,10.0,3.8,8.0,6.5,2.0,0.0,2.0,6.5,8.0,3.8,10.0\\}$ 千焦/摩尔\n- 使用最高阶为 $n_{\\max}=3$ 的截断三角级数对能量进行建模：\n  $$E(\\phi) \\approx c_{0} + \\sum_{n=1}^{n_{\\max}} \\left(a_{n}\\cos(n\\phi) + b_{n}\\sin(n\\phi)\\right),$$\n  其中 $\\phi$ 以弧度为单位，系数 $c_{0}$、$a_{n}$ 和 $b_{n}$ 将通过线性最小二乘法确定。\n- 将拟合级数表示为振幅-相位形式。对于每个 $n \\in \\{1,2,3\\}$，通过使级数等效于以下形式的关系来定义振幅 $V_{n}$ 和相位 $\\gamma_{n}$：\n  $$E(\\phi) \\approx c_{0} + \\sum_{n=1}^{3} V_{n}\\cos\\!\\left(n\\phi - \\gamma_{n}\\right).$$\n  以千焦/摩尔为单位报告 $V_{n}$，以弧度为单位报告 $\\gamma_{n}$。\n- 使用拟合的 $E(\\phi)$，在一个分辨率为 $1^\\circ$、范围为 $[0^\\circ,360^\\circ)$ 的均匀角度网格上，通过离散玻尔兹曼采样计算构象异构体布居。在能量评估时，需将角度转换为弧度。使用玻尔兹曼因子 $\\exp\\!\\left(-E(\\phi)/k_{\\mathrm{B}}T\\right)$，其中玻尔兹曼常数 $k_{\\mathrm{B}}$ 必须取值为 $k_{\\mathrm{B}}=8.314462618\\times 10^{-3}$ 千焦/摩尔/开尔文。\n- 通过以度为单位的角度窗口定义三种构象异构体家族：\n  - 反式 (trans): $\\phi \\in [165^\\circ,195^\\circ]$\n  - 邻位+ (gauche$+$): $\\phi \\in [45^\\circ,75^\\circ]$\n  - 邻位- (gauche$-$): $\\phi \\in [285^\\circ,315^\\circ]$\n  对于每个家族，计算其窗口内的玻尔兹曼权重之和，再除以整个网格上的玻尔兹曼权重之和，以此作为其布居。\n- 在三角函数内部，角度必须以弧度处理；能量必须以千焦/摩尔为单位；温度必须以开尔文为单位；相位 $\\gamma_{n}$ 必须以弧度报告。布居必须以小数形式返回。\n\n测试组：\n- 使用上述指定的单一能量扫描，并评估在以下温度 $T$（开尔文）下的构象异构体布居：$298.15$、$50.0$、$1000.0$ 和 $1.0$。\n- 对于每个测试用例（温度 $T$），按以下顺序输出一个包含十个值的列表：\n  - $V_{1}$、$V_{2}$、$V_{3}$ (千焦/摩尔)\n  - $\\gamma_{1}$、$\\gamma_{2}$、$\\gamma_{3}$ (弧度)\n  - $p_{\\text{反式}}$、$p_{\\text{邻位}+}$、$p_{\\text{邻位}-}$ (小数)\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素对应一个温度，其本身就是上面描述的列表。例如，格式必须如下所示：\n  $$[\\,[V_{1},V_{2},V_{3},\\gamma_{1},\\gamma_{2},\\gamma_{3},p_{\\text{反式}},p_{\\text{邻位}+},p_{\\text{邻位}-}],\\ldots\\,].$$", "solution": "该问题要求我们基于一组离散的能量-角度数据点，为丁烷的扭转势能开发一个计算模型。这涉及三个主要步骤：首先，将数据拟合到一个有物理动机的数学函数；其次，将拟合参数转换为一种物理上直观的表示；第三，使用得到的势能函数通过统计力学计算平衡构象异构体布居。\n\n问题陈述已经过验证，被认为是科学上合理、良态的且计算上可行的。所有必要的数据、常数和程序性定义都已提供。因此，我们可以着手提供一个完整的解决方案。\n\n### 1. 扭转势的建模：傅里叶级数\n\n与化学键扭转相关的势能 $E$ 是二面角 $\\phi$ 的周期函数，周期为 $2\\pi$ 弧度（$360^\\circ$）。一个强大而基础的数学成果，即傅里叶定理，指出任何良态的周期函数都可以表示为正弦和余弦函数的无穷级数，称为傅里叶级数。在化学的实际建模中，该级数在有限阶 $n_{\\max}$ 处被截断，这足以捕捉势能面的基本特征。\n\n问题指定了一个最高阶为 $n_{\\max}=3$ 的截断傅里叶级数模型：\n$$E(\\phi) \\approx c_{0} + \\sum_{n=1}^{3} \\left(a_{n}\\cos(n\\phi) + b_{n}\\sin(n\\phi)\\right)$$\n此处，$\\phi$ 必须以弧度为单位。$c_0$ 项是完整旋转一周的平均能量。系数 $a_n$ 和 $b_n$ 决定了势的形状。指数 $n$ 对应于扭转势垒的重数；例如，$n=3$ 的项描述了像乙烷那样的三重旋转，而 $n=1$ 和 $n=2$ 的项则捕捉了定义丁烷中反式和邻位构象的相互作用。\n\n### 2. 通过线性最小二乘法确定参数\n\n该模型对于未知系数 $\\mathbf{x} = [c_0, a_1, b_1, a_2, b_2, a_3, b_3]^T$ 是线性的。给定一组 $M$ 个数据点 $(\\phi_i, E_i)$，我们寻求最小化模型与数据之间差异的系数。这是一个经典的线性最小二乘问题。我们可以将该系统表示为矩阵形式：\n$$ \\mathbf{A} \\mathbf{x} \\approx \\mathbf{E} $$\n其中 $\\mathbf{E}$ 是 $M$ 个观测能量的向量，$\\mathbf{A}$ 是 $M \\times 7$ 的设计矩阵，其中每一行对应一个数据点 $\\phi_i$，每一列对应一个基函数：\n$$ \\mathbf{A}_{i,j} = \\begin{cases} 1   j=0 \\\\ \\cos(n\\phi_i)  j=2n-1, n \\in \\{1,2,3\\} \\\\ \\sin(n\\phi_i)  j=2n, n \\in \\{1,2,3\\} \\end{cases} $$\n对于我们的特定数据，我们有 $M=12$ 个角度-能量对。以度为单位给出的角度 $\\phi$ 必须首先转换为弧度才能在三角函数中使用。最小二乘解 $\\mathbf{x}$ 最小化了残差平方和 $||\\mathbf{A}\\mathbf{x} - \\mathbf{E}||^2$。该解通过求解正规方程得到：\n$$ \\mathbf{x} = (\\mathbf{A}^T\\mathbf{A})^{-1}\\mathbf{A}^T\\mathbf{E} $$\n此计算将以数值方式进行。由于所提供能量数据的对称性（$E(\\phi) = E(2\\pi - \\phi)$），我们预计奇正弦函数 $b_n$ 的系数将接近于零。\n\n### 3. 振幅-相位表示\n\n$a_{n}\\cos(n\\phi) + b_{n}\\sin(n\\phi)$ 的形式在数学上很方便，但不如振幅-相位形式 $V_{n}\\cos(n\\phi - \\gamma_{n})$ 在物理上直观。参数 $V_n$ 表示第 $n$ 个扭转势垒分量的振幅（或“高度”），而 $\\gamma_n$ 是其相角，表示该分量达到其最大值时的二面角。\n\n使用三角恒等式 $\\cos(A-B) = \\cos A \\cos B + \\sin A \\sin B$，我们可以写出：\n$$ V_{n}\\cos(n\\phi - \\gamma_{n}) = (V_{n}\\cos\\gamma_{n})\\cos(n\\phi) + (V_{n}\\sin\\gamma_{n})\\sin(n\\phi) $$\n通过与 $a_{n}\\cos(n\\phi) + b_{n}\\sin(n\\phi)$ 比较系数，我们建立以下关系：\n$$ a_n = V_n \\cos\\gamma_n $$\n$$ b_n = V_n \\sin\\gamma_n $$\n这些方程可解出 $V_n$ 和 $\\gamma_n$：\n$$ V_n = \\sqrt{a_n^2 + b_n^2} $$\n$$ \\gamma_n = \\mathrm{atan2}(b_n, a_n) $$\n双参数反正切函数 $\\mathrm{atan2}(y,x)$ 至关重要，因为它能正确确定角度 $\\gamma_n$ 所在的象限，从而得到一个在 $(-\\pi, \\pi]$ 区间内的值。振幅 $V_n$ 的单位将是千焦/摩尔，相位 $\\gamma_n$ 的单位将是弧度。\n\n### 4. 从玻尔兹曼分布计算构象异构体布居\n\n在热平衡状态下，连接势能与构象分布的基本原理是玻尔兹曼分布。在特定二面角 $\\phi$ 处观察到系统的概率 $P(\\phi)$ 与玻尔兹曼因子成正比：\n$$ P(\\phi) \\propto e^{-E(\\phi) / (k_{\\mathrm{B}}T)} $$\n其中 $E(\\phi)$ 是该构象的势能，$T$ 是以开尔文为单位的绝对温度，$k_{\\mathrm{B}}$ 是玻尔兹曼常数（在此上下文中，即摩尔气体常数 $R = 8.314462618 \\times 10^{-3} \\, \\text{kJ}\\,\\text{mol}^{-1}\\text{K}^{-1}$）。\n\n为了计算归一化概率（或布居），我们必须在所有可能的角度上对该概率密度进行积分。在计算上，我们通过在一个精细的均匀角度网格上求和来近似此积分。归一化常数是配分函数 $Q$，定义为在完整状态空间上所有玻尔兹曼权重的总和：\n$$ Q = \\sum_{j=0}^{N-1} e^{-E_{fit}(\\phi_j) / (k_{\\mathrm{B}}T)} $$\n其中求和是在覆盖整个圆周 $[0^\\circ, 360^\\circ)$ 的 $N$ 个角度的网格上进行的。\n\n特定构象异构体（例如，反式、邻位）的布居是其定义的角度窗口内所有角度的玻尔兹曼权重之和，除以总配分函数 $Q$：\n$$ p_{\\text{构象}} = \\frac{1}{Q} \\sum_{\\phi_j \\in \\text{window}} e^{-E_{fit}(\\phi_j) / (k_{\\mathrm{B}}T)} $$\n对每个指定温度都执行此计算。降低温度将导致系统优先占据最低能量状态，从而导致高度偏斜的布居。相反，在非常高的温度下，项 $E(\\phi)/(k_B T)$ 趋近于零，导致所有玻尔兹曼权重都趋近于 $1$，布居与其角度窗口的大小成正比，表明所有构象的概率几乎相等。\n\n整个过程为从离散的实验或计算数据到分子构象和动力学的连续、具有物理意义的模型提供了一座稳健的桥梁。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the butane torsional potential problem by fitting a Fourier series to energy data\n    and calculating conformer populations at various temperatures.\n    \"\"\"\n    \n    # Step 1: Extract Givens\n    # Data from the problem statement\n    phi_deg = np.array([0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330])\n    energies = np.array([19.0, 10.0, 3.8, 8.0, 6.5, 2.0, 0.0, 2.0, 6.5, 8.0, 3.8, 10.0])\n    \n    # Constants and definitions\n    k_B = 8.314462618e-3  # kJ/(mol*K)\n    n_max = 3\n    temperatures = [298.15, 50.0, 1000.0, 1.0]\n\n    # Convert angles from degrees to radians for trigonometric calculations\n    phi_rad = np.deg2rad(phi_deg)\n\n    # Step 2: Perform Linear Least-Squares Fit\n    # Construct the design matrix A for the model:\n    # E(phi) = c0 + a1*cos(phi) + b1*sin(phi) + ...\n    # The columns of A are the basis functions: 1, cos(phi), sin(phi), cos(2*phi), ...\n    A = np.zeros((len(phi_rad), 1 + 2 * n_max))\n    A[:, 0] = 1.0\n    for n in range(1, n_max + 1):\n        A[:, 2*n - 1] = np.cos(n * phi_rad)\n        A[:, 2*n] = np.sin(n * phi_rad)\n    \n    # Solve the linear system Ax = b for the coefficients x, where b is the energy vector.\n    # np.linalg.lstsq returns the solution vector, residuals, rank, and singular values.\n    # We only need the solution vector of coefficients.\n    coeffs, _, _, _ = np.linalg.lstsq(A, energies, rcond=None)\n    \n    c0 = coeffs[0]\n    a_coeffs = coeffs[1::2]\n    b_coeffs = coeffs[2::2]\n\n    # Step 3: Convert to Amplitude-Phase Form\n    # V_n = sqrt(a_n^2 + b_n^2)\n    # gamma_n = atan2(b_n, a_n)\n    V_n = np.sqrt(a_coeffs**2 + b_coeffs**2)\n    gamma_n = np.arctan2(b_coeffs, a_coeffs)\n    \n    V1, V2, V3 = V_n[0], V_n[1], V_n[2]\n    gamma1, gamma2, gamma3 = gamma_n[0], gamma_n[1], gamma_n[2]\n\n    # Step 4: Calculate Conformer Populations for each temperature\n    \n    # Define the fitted energy function\n    def E_fit(phi_rad_grid):\n        energy = c0\n        for n in range(1, n_max + 1):\n            energy += a_coeffs[n-1] * np.cos(n * phi_rad_grid) + b_coeffs[n-1] * np.sin(n * phi_rad_grid)\n        return energy\n        \n    # Create a fine grid for numerical integration (Boltzmann summation)\n    fine_grid_deg = np.arange(0, 360, 1)\n    fine_grid_rad = np.deg2rad(fine_grid_deg)\n    \n    # Calculate energies on the fine grid\n    E_values = E_fit(fine_grid_rad)\n    \n    # Define conformer windows\n    trans_indices = (fine_grid_deg >= 165)  (fine_grid_deg = 195)\n    gauche_p_indices = (fine_grid_deg >= 45)  (fine_grid_deg = 75)\n    gauche_m_indices = (fine_grid_deg >= 285)  (fine_grid_deg = 315)\n    \n    all_results = []\n    \n    for T in temperatures:\n        # Calculate Boltzmann weights\n        # Avoid potential overflow/underflow by subtracting min energy, which cancels out in population calculation.\n        E_ref = E_values - np.min(E_values)\n        weights = np.exp(-E_ref / (k_B * T))\n        \n        # Calculate Partition Function Q (normalization constant)\n        Q = np.sum(weights)\n        \n        # Calculate sum of weights within each conformer window\n        W_trans = np.sum(weights[trans_indices])\n        W_gauche_p = np.sum(weights[gauche_p_indices])\n        W_gauche_m = np.sum(weights[gauche_m_indices])\n        \n        # Calculate populations\n        p_trans = W_trans / Q\n        p_gauche_p = W_gauche_p / Q\n        p_gauche_m = W_gauche_m / Q\n        \n        # Assemble the results for this temperature\n        # The fitted parameters V_n and gamma_n are independent of temperature\n        current_result = [\n            V1, V2, V3,\n            gamma1, gamma2, gamma3,\n            p_trans, p_gauche_p, p_gauche_m\n        ]\n        all_results.append(current_result)\n\n    # Step 5: Format and print the final output\n    # The required format is a string representation of a list of lists.\n    # Ex: [[...], [...], ...]\n    results_str = [str(res) for res in all_results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```", "id": "3414003"}, {"introduction": "最后的这项实践将探讨非键相互作用势的复杂设计，这种势函数必须在不同距离尺度上都保持准确。您将通过一个自行推导的光滑切换函数（switching function），将短程的白金汉势（Buckingham potential）与长程的色散展开势平滑地结合起来，构建一个复合势。这个高级练习展示了现代力场开发中的一项关键技术，即如何创建精确且计算高效的多尺度模型 [@problem_id:3414034]。", "problem": "要求您使用多分辨率方法，构建并实现一个适用于分子动力学 (MD) 的复合双体势能模型。短程相互作用应通过 Buckingham 势进行建模，而长程相互作用则使用有限色散展开。这两个区域必须通过一个平滑的标量切换函数进行混合，以确保势及其导数的连续性。\n\n您必须从基本定义出发，并完全根据边界平滑条件来构建切换函数，不得假设任何现成的标准模板。最终的程序必须为提供的测试集计算总势能和相应的径向力。所有距离单位为纳米 (nm)，能量单位为千焦/摩尔 (kJ/mol)，力单位为千焦/摩尔/纳米 (kJ mol^{-1} nm^{-1})。不涉及角度。所有数值结果必须四舍五入到八位小数。\n\n定义与要求：\n- 短程势为 Buckingham 形式\n  $$U_{\\mathrm{short}}(r) = A \\exp\\!\\left(-\\frac{r}{\\rho}\\right) - \\frac{C_6}{r^6} - \\frac{C_8}{r^8},$$\n  其中 $A  0$ 和 $\\rho  0$ 控制排斥指数墙，而 $C_6, C_8  0$ 是色散系数。\n- 长程色散势是一个截断的偶次逆幂级数\n  $$U_{\\mathrm{long}}(r) = - \\frac{C_6}{r^6} - \\frac{C_8}{r^8} - \\frac{C_{10}}{r^{10}},$$\n  其中 $C_{10}  0$ 是一个额外的色散系数。\n- 定义一个切换区间 $[r_{\\mathrm{sw}}, r_{\\mathrm{c}}]$，其中 $0  r_{\\mathrm{sw}}  r_{\\mathrm{c}}$。设 $s(r)$ 是一个标量切换函数，使得：\n  - $s(r) = 1$ 对于 $r \\le r_{\\mathrm{sw}}$，\n  - $s(r) = 0$ 对于 $r \\ge r_{\\mathrm{c}}$，\n  - $s(r)$ 在 $\\mathbb{R}^{+}$ 上至少二阶连续可导，且满足 $s'(r_{\\mathrm{sw}}) = s''(r_{\\mathrm{sw}}) = 0$ 和 $s'(r_{\\mathrm{c}}) = s''(r_{\\mathrm{c}}) = 0$。\n- 在开区间 $(r_{\\mathrm{sw}}, r_{\\mathrm{c}})$ 上，将 $s(r)$ 构建为归一化坐标的多项式\n  $$x = \\frac{r - r_{\\mathrm{sw}}}{r_{\\mathrm{c}} - r_{\\mathrm{sw}}},$$\n  此区间上 $x \\in (0,1)$，使得它满足上述六个边界条件。不要假设任何已有的封闭形式；从边界条件推导出多项式系数。\n- 定义复合势\n  $$U_{\\mathrm{tot}}(r) = s(r)\\,U_{\\mathrm{short}}(r) + \\bigl(1 - s(r)\\bigr)\\,U_{\\mathrm{long}}(r)。$$\n- 根据牛顿第二定律，将相应的径向力定义为\n  $$F(r) = -\\frac{dU_{\\mathrm{tot}}}{dr}。$$\n  您必须使用乘法法则和链式法则，推导并实现 $\\frac{dU_{\\mathrm{tot}}}{dr}$ 的表达式，其中包括 $s'(r)$。\n\n测试集的参数值：\n- $A = 1000\\,\\mathrm{kJ/mol}$,\n- $\\rho = 0.35\\,\\mathrm{nm}$,\n- $C_6 = 0.005\\,\\mathrm{kJ\\,nm^6/mol}$,\n- $C_8 = 0.0001\\,\\mathrm{kJ\\,nm^8/mol}$,\n- $C_{10} = 0.000002\\,\\mathrm{kJ\\,nm^{10}/mol}$,\n- $r_{\\mathrm{sw}} = 0.4\\,\\mathrm{nm}$,\n- $r_{\\mathrm{c}} = 0.8\\,\\mathrm{nm}$.\n\n测试半径：\n- $r = 0.35\\,\\mathrm{nm}$,\n- $r = 0.40\\,\\mathrm{nm}$,\n- $r = 0.60\\,\\mathrm{nm}$,\n- $r = 0.80\\,\\mathrm{nm}$,\n- $r = 1.00\\,\\mathrm{nm}$.\n\n任务：\n- 根据 $s(r)$ 的边界条件，推导在 $x \\in (0,1)$ 上满足 $s(0) = 1$、$s(1) = 0$ 以及 $s'(0) = s''(0) = s'(1) = s''(1) = 0$ 的最低阶多项式 $s(x)$ 的系数。通过链式法则，用 $x$ 和区间长度 $(r_{\\mathrm{c}} - r_{\\mathrm{sw}})$ 来表示 $s'(r)$。\n- 推导 $\\frac{dU_{\\mathrm{short}}}{dr}$ 和 $\\frac{dU_{\\mathrm{long}}}{dr}$ 的表达式，然后使用乘法法则推导 $\\frac{dU_{\\mathrm{tot}}}{dr}$。\n- 实现一个程序，该程序：\n  1. 使用上述参数为每个测试半径 $r$ 计算 $U_{\\mathrm{tot}}(r)$ 和 $F(r)$。\n  2. 将每个数字四舍五入到八位小数。\n  3. 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含测试集中每个 $r$ 的势能和力，即 $[U_{\\mathrm{tot}}(0.35),F(0.35),U_{\\mathrm{tot}}(0.40),F(0.40),\\dots]$，所有单位均按指定。\n\n科学真实性约束：\n- 仅在 $r  0$ 处进行评估，以避免逆幂项的奇点。\n- 确保切换函数及其导数在边界处有良好定义且为有限值。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,...]”）。", "solution": "问题陈述经过严格评估，被认为是有效的。它以分子力学原理为科学基础，在数学上是适定的，并提供了一套完整且一致的定义和参数。\n\n任务是构建一个复合势能函数 $U_{\\mathrm{tot}}(r)$ 及其对应的力 $F(r)$，方法是使用一个切换函数 $s(r)$ 平滑地连接短程 Buckingham 势 $U_{\\mathrm{short}}(r)$ 和长程色散势 $U_{\\mathrm{long}}(r)$。我们必须首先从一组边界条件中推导出 $s(r)$ 的解析形式，然后推导出 $U_{\\mathrm{tot}}(r)$ 和 $F(r)$ 的表达式，最后实现这些公式以计算给定测试集的值。\n\n提供的参数如下：\n- 排斥项常数: $A = 1000\\,\\mathrm{kJ/mol}$\n- 排斥项范围: $\\rho = 0.35\\,\\mathrm{nm}$\n- 色散系数: $C_6 = 0.005\\,\\mathrm{kJ\\,nm^6/mol}$, $C_8 = 0.0001\\,\\mathrm{kJ\\,nm^8/mol}$, $C_{10} = 0.000002\\,\\mathrm{kJ\\,nm^{10}/mol}$\n- 切换区间: $[r_{\\mathrm{sw}}, r_{\\mathrm{c}}] = [0.4\\,\\mathrm{nm}, 0.8\\,\\mathrm{nm}]$\n\n势能定义如下：\n$$U_{\\mathrm{short}}(r) = A \\exp\\!\\left(-\\frac{r}{\\rho}\\right) - \\frac{C_6}{r^6} - \\frac{C_8}{r^8}$$\n$$U_{\\mathrm{long}}(r) = - \\frac{C_6}{r^6} - \\frac{C_8}{r^8} - \\frac{C_{10}}{r^{10}}$$\n\n复合势为：\n$$U_{\\mathrm{tot}}(r) = s(r)\\,U_{\\mathrm{short}}(r) + \\bigl(1 - s(r)\\bigr)\\,U_{\\mathrm{long}}(r)$$\n\n力为：\n$$F(r) = -\\frac{dU_{\\mathrm{tot}}}{dr}$$\n\n步骤如下：\n1. 推导切换函数 $s(r)$。\n2. 推导复合势 $U_{\\mathrm{tot}}(r)$。\n3. 推导径向力 $F(r)$。\n4. 计算指定测试用例。\n\n**1. 切换函数 $s(r)$ 的推导**\n\n切换函数 $s(r)$ 定义在区间 $[r_{\\mathrm{sw}}, r_{\\mathrm{c}}]$ 上。它使用归一化坐标 $x = \\frac{r - r_{\\mathrm{sw}}}{r_{\\mathrm{c}} - r_{\\mathrm{sw}}}$ 构建，该坐标将 $r \\in [r_{\\mathrm{sw}}, r_{\\mathrm{c}}]$ 映射到 $x \\in [0, 1]$。该函数必须满足六个边界条件，以确保它本身及其一阶和二阶导数在切换区域的边界处连续且为零：\n- 在 $r = r_{\\mathrm{sw}}$ (或 $x=0$) 处：$s(0) = 1$, $s'(0)=0$, $s''(0)=0$。\n- 在 $r = r_{\\mathrm{c}}$ (或 $x=1$) 处：$s(1) = 0$, $s'(1)=0$, $s''(1)=0$。\n注意，这些导数是关于 $x$ 的。对于关于 $r$ 的导数，我们将使用链式法则。\n\n一个 5 次多项式 $s(x) = a_5 x^5 + a_4 x^4 + a_3 x^3 + a_2 x^2 + a_1 x + a_0$ 具有六个系数，是能够满足六个独立条件的最低次多项式。\n其导数为：\n$$s'(x) = 5 a_5 x^4 + 4 a_4 x^3 + 3 a_3 x^2 + 2 a_2 x + a_1$$\n$$s''(x) = 20 a_5 x^3 + 12 a_4 x^2 + 6 a_3 x + 2 a_2$$\n\n应用 $x=0$ 处的条件：\n- $s(0) = a_0 = 1$\n- $s'(0) = a_1 = 0$\n- $s''(0) = 2a_2 = 0 \\implies a_2 = 0$\n\n到目前为止，$s(x) = a_5 x^5 + a_4 x^4 + a_3 x^3 + 1$。应用 $x=1$ 处的条件：\n1. $s(1) = a_5 + a_4 + a_3 + 1 = 0 \\implies a_5 + a_4 + a_3 = -1$\n2. $s'(1) = 5a_5 + 4a_4 + 3a_3 = 0$\n3. $s''(1) = 20a_5 + 12a_4 + 6a_3 = 0 \\implies 10a_5 + 6a_4 + 3a_3 = 0$\n\n这是一个关于 $a_3, a_4, a_5$ 的三元线性方程组。(3) 式减去 (2) 式：\n$$(10a_5 - 5a_5) + (6a_4 - 4a_4) + (3a_3 - 3a_3) = 0 - 0 \\implies 5a_5 + 2a_4 = 0 \\implies a_4 = -\\frac{5}{2}a_5$$\n将 $a_4$ 代入 (2) 式：\n$$5a_5 + 4\\left(-\\frac{5}{2}a_5\\right) + 3a_3 = 0 \\implies 5a_5 - 10a_5 + 3a_3 = 0 \\implies -5a_5 + 3a_3 = 0 \\implies a_3 = \\frac{5}{3}a_5$$\n将 $a_3$ 和 $a_4$ 代入 (1) 式：\n$$a_5 + \\left(-\\frac{5}{2}a_5\\right) + \\left(\\frac{5}{3}a_5\\right) = -1 \\implies \\left(\\frac{6 - 15 + 10}{6}\\right)a_5 = -1 \\implies \\frac{1}{6}a_5 = -1 \\implies a_5 = -6$$\n反向代入，我们得到其他系数：\n$$a_4 = -\\frac{5}{2}(-6) = 15$$\n$$a_3 = \\frac{5}{3}(-6) = -10$$\n因此，切换区域的多项式为：\n$$s(x) = -6x^5 + 15x^4 - 10x^3 + 1$$\n$s(r)$ 的完整定义是：\n$$\ns(r) =\n\\begin{cases}\n1  \\text{if } r \\le r_{\\mathrm{sw}} \\\\\n-6x^5 + 15x^4 - 10x^3 + 1, \\quad x = \\frac{r - r_{\\mathrm{sw}}}{r_{\\mathrm{c}} - r_{\\mathrm{sw}}}  \\text{if } r_{\\mathrm{sw}}  r  r_{\\mathrm{c}} \\\\\n0  \\text{if } r \\ge r_{\\mathrm{c}}\n\\end{cases}\n$$\n计算力需要 $s(r)$ 对 $r$ 的导数 $s'(r)$。使用链式法则，$s'(r) = \\frac{ds}{dx} \\frac{dx}{dr}$。\n$$\\frac{dx}{dr} = \\frac{1}{r_{\\mathrm{c}} - r_{\\mathrm{sw}}}$$\n$$\\frac{ds}{dx} = -30x^4 + 60x^3 - 30x^2$$\n所以，对于 $r_{\\mathrm{sw}}  r  r_{\\mathrm{c}}$，\n$$s'(r) = \\frac{1}{r_{\\mathrm{c}} - r_{\\mathrm{sw}}} (-30x^4 + 60x^3 - 30x^2)$$\n在此区间之外，$s'(r) = 0$。\n\n**2. 复合势 $U_{\\mathrm{tot}}(r)$ 的推导**\n\n从 $U_{\\mathrm{tot}}(r)$ 的定义开始：\n$$U_{\\mathrm{tot}}(r) = s(r)\\left(A e^{-r/\\rho} - \\frac{C_6}{r^6} - \\frac{C_8}{r^8}\\right) + (1-s(r))\\left(-\\frac{C_6}{r^6} - \\frac{C_8}{r^8} - \\frac{C_{10}}{r^{10}}\\right)$$\n我们可以通过提取公因式来重新排列这个表达式，使其计算效率更高：\n$$U_{\\mathrm{tot}}(r) = s(r) A e^{-r/\\rho} + s(r)\\left(-\\frac{C_6}{r^6} - \\frac{C_8}{r^8}\\right) + (1-s(r))\\left(-\\frac{C_6}{r^6} - \\frac{C_8}{r^8}\\right) - (1-s(r))\\frac{C_{10}}{r^{10}}$$\n涉及 $C_6$ 和 $C_8$ 的项之和为 $-\\frac{C_6}{r^6} - \\frac{C_8}{r^8}$，与 $s(r)$ 无关：\n$$s(r)(\\dots) + (1-s(r))(\\dots) = (s(r) + 1 - s(r))(\\dots) = (\\dots)$$\n这导出了简化后的势能：\n$$U_{\\mathrm{tot}}(r) = s(r) A e^{-r/\\rho} - \\frac{C_6}{r^6} - \\frac{C_8}{r^8} - (1-s(r))\\frac{C_{10}}{r^{10}}$$\n\n**3. 径向力 $F(r)$ 的推导**\n\n力是势的负梯度，$F(r) = -dU_{\\mathrm{tot}}/dr$。我们使用乘法法则对复合势 $U_{\\mathrm{tot}}(r) = s(r) U_{\\mathrm{short}}(r) + (1 - s(r)) U_{\\mathrm{long}}(r)$ 求关于 $r$ 的导数：\n$$\\frac{dU_{\\mathrm{tot}}}{dr} = \\frac{d}{dr}\\left[s(r)U_{\\mathrm{short}}(r)\\right] + \\frac{d}{dr}\\left[(1-s(r))U_{\\mathrm{long}}(r)\\right]$$\n$$\\frac{dU_{\\mathrm{tot}}}{dr} = \\left(s'(r)U_{\\mathrm{short}}(r) + s(r)\\frac{dU_{\\mathrm{short}}}{dr}\\right) + \\left(-s'(r)U_{\\mathrm{long}}(r) + (1-s(r))\\frac{dU_{\\mathrm{long}}}{dr}\\right)$$\n重新整理各项可得：\n$$\\frac{dU_{\\mathrm{tot}}}{dr} = s(r)\\frac{dU_{\\mathrm{short}}}{dr} + (1-s(r))\\frac{dU_{\\mathrm{long}}}{dr} + s'(r)\\left[U_{\\mathrm{short}}(r) - U_{\\mathrm{long}}(r)\\right]$$\n各分量势的导数是：\n$$\\frac{dU_{\\mathrm{short}}}{dr} = -\\frac{A}{\\rho}e^{-r/\\rho} + \\frac{6C_6}{r^7} + \\frac{8C_8}{r^9}$$\n$$\\frac{dU_{\\mathrm{long}}}{dr} = \\frac{6C_6}{r^7} + \\frac{8C_8}{r^9} + \\frac{10C_{10}}{r^{11}}$$\n差值项是：\n$$U_{\\mathrm{short}}(r) - U_{\\mathrm{long}}(r) = \\left(A e^{-r/\\rho} - \\frac{C_6}{r^6} - \\frac{C_8}{r^8}\\right) - \\left(-\\frac{C_6}{r^6} - \\frac{C_8}{r^8} - \\frac{C_{10}}{r^{10}}\\right) = A e^{-r/\\rho} + \\frac{C_{10}}{r^{10}}$$\n总力为 $F(r) = -dU_{\\mathrm{tot}}/dr$。如果我们将短程和长程势对应的力定义为 $F_{\\mathrm{short}}(r) = -dU_{\\mathrm{short}}/dr$ 和 $F_{\\mathrm{long}}(r) = -dU_{\\mathrm{long}}/dr$，我们可以写出：\n$$F_{\\mathrm{tot}}(r) = s(r)F_{\\mathrm{short}}(r) + (1-s(r))F_{\\mathrm{long}}(r) - s'(r)\\left[U_{\\mathrm{short}}(r) - U_{\\mathrm{long}}(r)\\right]$$\n其中：\n$$F_{\\mathrm{short}}(r) = \\frac{A}{\\rho}e^{-r/\\rho} - \\frac{6C_6}{r^7} - \\frac{8C_8}{r^9}$$\n$$F_{\\mathrm{long}}(r) = -\\left(\\frac{6C_6}{r^7} + \\frac{8C_8}{r^9} + \\frac{10C_{10}}{r^{11}}\\right)$$\n\n**4. 计算总结**\n\n势能和力根据 $r$ 的值进行计算：\n- 对于 $r \\le r_{\\mathrm{sw}}$：\n    $U_{\\mathrm{tot}}(r) = U_{\\mathrm{short}}(r) = A e^{-r/\\rho} - \\frac{C_6}{r^6} - \\frac{C_8}{r^8}$\n    $F(r) = F_{\\mathrm{short}}(r) = \\frac{A}{\\rho}e^{-r/\\rho} - \\frac{6C_6}{r^7} - \\frac{8C_8}{r^9}$\n- 对于 $r \\ge r_{\\mathrm{c}}$：\n    $U_{\\mathrm{tot}}(r) = U_{\\mathrm{long}}(r) = -\\frac{C_6}{r^6} - \\frac{C_8}{r^8} - \\frac{C_{10}}{r^{10}}$\n    $F(r) = F_{\\mathrm{long}}(r) = -\\left(\\frac{6C_6}{r^7} + \\frac{8C_8}{r^9} + \\frac{10C_{10}}{r^{11}}\\right)$\n- 对于 $r_{\\mathrm{sw}}  r  r_{\\mathrm{c}}$：\n    计算 $x$、$s(x)$ 和 $s'(r)$。\n    然后使用上面推导的完整复合表达式计算 $U_{\\mathrm{tot}}(r)$ 和 $F(r)$。建议在实现时使用简化后的势能表达式和结构化的力表达式。\n    $$U_{\\mathrm{tot}}(r) = s(x) A e^{-r/\\rho} - \\frac{C_6}{r^6} - \\frac{C_8}{r^8} - (1-s(x))\\frac{C_{10}}{r^{10}}$$\n    $$F(r) = s(x)F_{\\mathrm{short}}(r) + (1-s(x))F_{\\mathrm{long}}(r) - s'(r)\\left(A e^{-r/\\rho} + \\frac{C_{10}}{r^{10}}\\right)$$\n现在将实施这些公式来求解给定的测试半径。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and evaluates a composite potential energy model for Molecular Dynamics.\n    \"\"\"\n\n    # Define parameters from the problem statement.\n    # Energies in kJ/mol, distances in nm.\n    A = 1000.0  # kJ/mol\n    rho = 0.35  # nm\n    C6 = 0.005  # kJ nm^6 / mol\n    C8 = 0.0001 # kJ nm^8 / mol\n    C10 = 0.000002 # kJ nm^10 / mol\n    r_sw = 0.4  # nm\n    r_c = 0.8   # nm\n    \n    params = {\n        'A': A, 'rho': rho, 'C6': C6, 'C8': C8, 'C10': C10,\n        'r_sw': r_sw, 'r_c': r_c\n    }\n\n    # Define the test cases from the problem statement.\n    test_radii = [0.35, 0.40, 0.60, 0.80, 1.00]\n\n    results = []\n    for r in test_radii:\n        potential, force = calculate_potential_and_force(r, params)\n        results.append(round(potential, 8))\n        results.append(round(force, 8))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_potential_and_force(r, params):\n    \"\"\"\n    Calculates the total potential energy and force for a given radius r.\n    \n    Args:\n        r (float): The interatomic distance in nm.\n        params (dict): A dictionary of model parameters.\n\n    Returns:\n        tuple: A tuple containing the total potential (kJ/mol) and force (kJ/mol/nm).\n    \"\"\"\n    A = params['A']\n    rho = params['rho']\n    C6 = params['C6']\n    C8 = params['C8']\n    C10 = params['C10']\n    r_sw = params['r_sw']\n    r_c = params['r_c']\n    \n    r_inv2 = 1.0 / (r * r)\n    r_inv6 = r_inv2 * r_inv2 * r_inv2\n    r_inv7 = r_inv6 / r\n    r_inv8 = r_inv6 * r_inv2\n    r_inv9 = r_inv8 / r\n    r_inv10 = r_inv8 * r_inv2\n    r_inv11 = r_inv10 / r\n    \n    # Potential and force components\n    exp_term_val = np.exp(-r / rho)\n    U_short = A * exp_term_val - C6 * r_inv6 - C8 * r_inv8\n    F_short = (A / rho) * exp_term_val - 6 * C6 * r_inv7 - 8 * C8 * r_inv9\n\n    U_long = -C6 * r_inv6 - C8 * r_inv8 - C10 * r_inv10\n    F_long = -(6 * C6 * r_inv7 + 8 * C8 * r_inv9 + 10 * C10 * r_inv11)\n\n    # Main logic to calculate the result for one case goes here.\n    if r = r_sw:\n        # Short-range regime\n        return U_short, F_short\n    \n    elif r >= r_c:\n        # Long-range regime\n        return U_long, F_long\n        \n    else: # r_sw  r  r_c\n        # Switching regime\n        x = (r - r_sw) / (r_c - r_sw)\n        x2 = x * x\n        x3 = x2 * x\n        x4 = x3 * x\n        x5 = x4 * x\n\n        # Switching function s(x) and its derivative ds/dx\n        s_x = -6 * x5 + 15 * x4 - 10 * x3 + 1\n        ds_dx = -30 * x4 + 60 * x3 - 30 * x2\n        \n        # ds/dr by chain rule\n        ds_dr = ds_dx / (r_c - r_sw)\n        \n        # Composite potential U_tot\n        # U_tot = s_x * U_short + (1 - s_x) * U_long\n        # Simplified form for better numerical stability:\n        U_tot = s_x * A * exp_term_val - C6 * r_inv6 - C8 * r_inv8 - (1 - s_x) * C10 * r_inv10\n\n        # Composite force F_tot\n        U_diff = U_short - U_long  # This is A*exp(-r/rho) + C10/r^10\n        F_tot = s_x * F_short + (1 - s_x) * F_long - ds_dr * U_diff\n        \n        return U_tot, F_tot\n\nsolve()\n```", "id": "3414034"}]}