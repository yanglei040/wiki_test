{"hands_on_practices": [{"introduction": "在进行复杂的数值拟合之前，我们通常可以利用分子对称性来简化问题。对于对称分子，那些可以通过对称操作相互转换的原子在化学上是等价的，因此应具有相同的局部电荷。本练习将演示如何运用群论原理系统地识别这些等价类，从而显著减少独立电荷参数的数量，并确保电荷分布的物理意义。[@problem_id:3433005]", "problem": "考虑一个处于其平衡构型、化学式为 $C_{6}H_{6}$ 的中性苯分子，其点群对称性为 $D_{6h}$。在一个约束静电势 (RESP) 拟合过程中，我们使用一组位于原子核位置 $\\{\\mathbf{R}_{i}\\}$ 上的原子部分电荷 $\\{q_{i}\\}$ 来模拟场点 $\\{\\mathbf{r}_{k}\\}$ 处的分子静电势。根据电荷产生的经典静电势的定义，$V(\\mathbf{r}) = \\sum_{i} q_{i} \\, \\Phi(\\mathbf{r}-\\mathbf{R}_{i})$，其中 $\\Phi(\\mathbf{r}-\\mathbf{R}_{i})$ 是与 $|\\mathbf{r}-\\mathbf{R}_{i}|^{-1}$ 成正比的库仑核。代价函数惩罚与量子力学静电势 $V_{\\mathrm{QM}}(\\mathbf{r})$ 的偏差，同时对 $\\{q_{i}\\}$ 进行正则化。\n\n令对称群 $G = D_{6h}$ 通过分子刚性运动引起的原子核置换作用于原子指数集。对于每个 $g \\in G$，用 $\\pi_{g}$ 表示原子指数的置换，用 $P(g)$ 表示作用于电荷向量 $\\mathbf{q} \\in \\mathbb{R}^{N}$（$N = 12$）的相应置换矩阵。假设 RESP 目标函数在此群作用下不变，即分子的构型、场点集以及 $V_{\\mathrm{QM}}(\\mathbf{r})$ 都是 $G$-对称的，因此最优电荷向量 $\\mathbf{q}^{\\star}$ 存在于由 $G$ 固定的子空间中，即对于所有 $g \\in G$ 都有 $P(g)\\mathbf{q}^{\\star} = \\mathbf{q}^{\\star}$。该分子整体呈电中性，因此电荷满足净电荷约束 $\\sum_{i=1}^{N} q_{i} = 0$。\n\n仅使用：\n- 群在集合上的作用的定义以及导出的轨道，\n- RESP 目标函数在 $G$ 作用下的不变性，\n- 以及电中性约束，\n\n推导由苯的 $D_{6h}$ 对称性所蕴含的原子电荷等式约束，并在施加对称性等价类和电中性约束后，确定独立电荷参数的数量。请以单一整数形式提供最终答案，该整数等于在这些约束下独立电荷参数空间的维度。答案无需四舍五入，也无需单位。", "solution": "本题要求在 $D_{6h}$ 点群对称性和整体电中性约束下，确定中性苯分子 ($C_6H_6$) 的独立原子电荷参数的数量。\n\n问题的核心在于规定了最优电荷向量 $\\mathbf{q}^{\\star} \\in \\mathbb{R}^{N}$（其中 $N=12$）在对称群 $G = D_{6h}$ 的作用下是不变的。这可以形式化地表述为，对于所有群元 $g \\in G$，都有 $P(g)\\mathbf{q}^{\\star} = \\mathbf{q}^{\\star}$，其中 $P(g)$ 是对称操作 $g$ 作用于原子指数集所对应的置换矩阵。\n\n这个数学条件的物理含义是，任何两个可以通过群中的某个对称操作相互映射的原子，必须被赋予相同的局部电荷。用群论的语言来说，在群 $G$ 的作用下属于同一轨道的所有原子必须具有相同的电荷值。因此，我们的第一步是确定这些轨道。\n\n被群作用置换的对象集合 $\\mathcal{S}$ 由苯分子的12个原子组成。这个集合可以划分为一个包含6个碳原子的集合 $\\mathcal{S}_C = \\{C_1, \\dots, C_6\\}$ 和一个包含6个氢原子的集合 $\\mathcal{S}_H = \\{H_1, \\dots, H_6\\}$。苯的平衡构型拥有一个垂直于分子平面并穿过其中心的主 $C_6$ 旋转轴。\n\n1.  我们分析 $\\mathcal{S}$ 中原子在群 $G = D_{6h}$ 作用下的轨道。\n    原子 $s \\in \\mathcal{S}$ 的轨道是指通过 $G$ 中的各种对称操作可以将 $s$ 映射到的所有原子的集合。\n    -   考虑任意一个碳原子，例如 $C_1$。$C_6$ 旋转操作及其各次幂（$C_6^k$，其中 $k=1, \\dots, 5$）将 $C_1$ 映射到芳香环中的其他五个碳原子。因此，所有6个碳原子都通过对称性相连，属于同一个轨道。我们把这个轨道记为 $\\mathcal{O}_C = \\mathcal{S}_C$。\n    -   类似地，考虑一个氢原子，例如与 $C_1$ 成键的 $H_1$。置换碳原子的那些对称操作同样也会置换与它们成键的氢原子。$C_6$ 旋转将 $H_1$ 映射到 $H_2$，$H_2$ 映射到 $H_3$，以此类推。因此，所有6个氢原子也是对称等价的，构成第二个不同的轨道。我们把这个轨道记为 $\\mathcal{O}_H = \\mathcal{S}_H$。\n\n对称操作是将分子映为自身的等距变换，并保持每个原子的化学性质不变。碳原子永远不能被映射到氢原子上。因此，所有原子的集合 $\\mathcal{S}$ 被划分为两个不相交的轨道：$\\mathcal{O}_C$ 和 $\\mathcal{O}_H$。\n\n两个轨道的存在意味着整个分子只有两种不同的电荷值。设 $q_C$ 为6个碳原子上各自的电荷， $q_H$ 为6个氢原子上各自的电荷。\n$$ q_i = q_C \\quad \\forall i \\in \\mathcal{O}_C $$\n$$ q_j = q_H \\quad \\forall j \\in \\mathcal{O}_H $$\n因此，$D_{6h}$ 对称性约束将12维的可能电荷向量空间约化为一个由两个参数 $q_C$ 和 $q_H$ 定义的2维子空间。\n\n接下来，我们应用电中性约束。题目说明该分子整体呈电中性，意味着所有原子电荷的总和必须为零。\n$$ \\sum_{k=1}^{12} q_k = 0 $$\n我们可以用我们通过对称性得到的两个参数 $q_C$ 和 $q_H$ 来表示这个约束。由于有6个碳原子和6个氢原子，该方程变为：\n$$ 6q_C + 6q_H = 0 $$\n这个方程可以简化为对这两个参数的一个线性约束：\n$$ q_C + q_H = 0 $$\n这个约束意味着一个参数由另一个参数决定（例如，$q_C = -q_H$）。\n\n为了求出独立参数的数量，我们从对称性所要求的参数数量开始，减去独立线性约束的数量。\n独立电荷参数的数量等于不同原子轨道的数量减去电荷约束的数量。对于单个中性分子，总存在一个这样的约束。\n\n独立参数数量 = (轨道数) - $1$\n独立参数数量 = $2 - 1 = 1$\n\n因此，在同时施加 $D_{6h}$ 对称性要求和净电荷约束后，该系统由一个独立的电荷参数描述。", "answer": "$$\\boxed{1}$$", "id": "3433005"}, {"introduction": "拟合整个静电势场的一种替代方法是构建一个能够再现关键宏观静电性质的电荷模型。本练习将探讨如何建立一个最小化的点电荷模型（可能包括偏离原子中心的虚拟位点），使其精确匹配分子已知的偶极矩和四极矩。这种多极矩匹配方法在电荷模型和物理可观测量之间建立了直接联系，为参数化提供了一种强有力的方法。[@problem_id:3433023]", "problem": "一个刚性分子需要用一个经典分子动力学模型来表示，该模型由一组最少的偏离中心的点电荷（虚位点）构成，这些点电荷能够再现其在分子固定主轴坐标系中的永久偶极矩和无迹四极矩。总电荷必须为零。在一个与分子主轴对齐的坐标系中进行计算，使得永久偶极矩矢量为 $\\boldsymbol{\\mu} = (0, 0, \\mu_{z})$，并且无迹四极矩张量是对角且轴对称的，其分量为 $Q_{xx} = Q_{yy} = -Q/2$ 和 $Q_{zz} = Q$，其中 $Q_{xx} + Q_{yy} + Q_{zz} = 0$。\n\n从点电荷集合 $\\{q_i\\}$（位于位置 $\\{\\mathbf{r}_i\\}$）的标准定义出发：\n- 总电荷 $Q_{\\text{tot}} = \\sum_{i} q_i$，\n- 偶极矩 $\\boldsymbol{\\mu} = \\sum_{i} q_i \\mathbf{r}_i$，\n- 无迹四极矩 $Q_{\\alpha\\beta} = \\sum_{i} q_i \\left( 3 r_{i\\alpha} r_{i\\beta} - r_i^2 \\delta_{\\alpha\\beta} \\right)$，\n\n完成以下任务：\n\n1) 使用自由度计数的方法，论证在总电荷为零（$Q_{\\text{tot}} = 0$）的约束下，为何至少需要 $3$ 个虚位点才能再现一个普遍的非零 $\\mu_{z}$ 和非零 $Q$。\n\n2) 提出一个仅含 $3$ 个虚位点的最小构造，这些位点限制在分子 $z$ 轴上，位置分别为 $z = 0$、$z = +d$ 和 $z = -d$，对应未知电荷 $q_0$、$q_1$ 和 $q_2$。仅使用上述定义，推导这些电荷为精确再现目标矩 $\\mu_{z}$ 和 $Q$ 所必须满足的线性方程组。\n\n3) 对该方程组进行符号求解，得到 $q_0$、$q_1$ 和 $q_2$ 关于 $\\mu_{z}$、$Q$ 和 $d$ 的闭式表达式。\n\n4) 使用具体的目标矩值 $\\mu_{z} = 0.80$（单位为基本电荷-埃，$e\\cdot\\text{\\AA}$）和 $Q = 1.20$（单位为基本电荷-平方埃，$e\\cdot\\text{\\AA}^{2}$），并取 $d = 1.000$ 埃，来计算你的表达式。报告最终的五元组 $(q_0, q_1, q_2, z_1, z_2)$，其中 $z_1 = +d$，$z_2 = -d$，电荷单位为基本电荷 $e$，距离单位为埃。将你的答案四舍五入到四位有效数字。", "solution": "该问题要求对构建一个具有特定偶极矩和四极矩的分子最小点电荷模型进行四部分分析。在尝试求解之前，首先对问题进行验证。\n\n### 问题验证\n\n**第1步：提取已知信息**\n- 模型必须由一组最少的偏离中心的点电荷（虚位点）构成。\n- 总电荷必须为零：$Q_{\\text{tot}} = \\sum_{i} q_i = 0$。\n- 模型必须再现一个永久偶极矩 $\\boldsymbol{\\mu} = (0, 0, \\mu_{z})$ 在主轴坐标系中。\n- 模型必须再现一个无迹、对角且轴对称的四极矩张量，其分量为 $Q_{xx} = Q_{yy} = -Q/2$ 和 $Q_{zz} = Q$。无迹条件 $Q_{xx} + Q_{yy} + Q_{zz} = 0$ 被明确说明。\n- 点电荷集合 $\\{q_i\\}$（位于位置 $\\{\\mathbf{r}_i\\}$）的矩的定义已给出：\n  - 总电荷：$Q_{\\text{tot}} = \\sum_{i} q_i$\n  - 偶极矩：$\\boldsymbol{\\mu} = \\sum_{i} q_i \\mathbf{r}_i$\n  - 无迹四极矩：$Q_{\\alpha\\beta} = \\sum_{i} q_i \\left( 3 r_{i\\alpha} r_{i\\beta} - r_i^2 \\delta_{\\alpha\\beta} \\right)$，其中 $\\alpha, \\beta \\in \\{x, y, z\\}$。\n- 对于第2部分，提出了一个特定的3位点模型，其电荷为 $q_0, q_1, q_2$，位置沿 $z$ 轴分布：$z_0=0$，$z_1=+d$，和 $z_2=-d$。\n- 对于第4部分，给出了数值：$\\mu_{z} = 0.80 \\, e\\cdot\\text{\\AA}$，$Q = 1.20 \\, e\\cdot\\text{\\AA}^{2}$，和 $d = 1.000 \\, \\text{\\AA}$。\n\n**第2步：使用提取的已知信息进行验证**\n- **科学依据：** 该问题使用了经典静电学中多极矩的标准定义。在分子动力学模拟的经典力场开发中（例如 TIP4P, TIP5P 水模型），使用虚位点来模拟分子电荷分布是一种标准且物理上合理的技术。该设置是科学有效的。\n- **良态性：** 问题提供了进行求解所需的所有定义和约束。任务划分清晰，并且对于指定的3位点模型，可以得到唯一解。这些约束是独立且一致的。\n- **客观性：** 问题以精确、定量且无偏见的技術语言陈述。\n\n**第3步：结论与行动**\n该问题科学合理、定义明確、客观且自洽。它是理论化学/物理学中的一个有效问题。将提供解答。\n\n### 解答\n\n**第1部分：自由度论证**\n一个电荷模型必须有足够数量的可调参数（自由度）来满足目标多極矩所施加的一组独立约束。\n需要再现的目标电荷分布的独立属性如下：\n1. 总电荷，$Q_{\\text{tot}} = 0$。\n2. 偶极矩大小，$|\\boldsymbol{\\mu}| = \\mu_z$。（方向由主轴坐标系的选择固定）。\n3. 四极矩大小，由给定轴对称张量的单个参数 $Q$ 指定。\n对于普遍的非零 $\\mu_z$ 和 $Q$，这构成了 3 个独立的约束。\n\n我们来分析一个具有 $N$ 个虚位点的模型所拥有的参数数量。\n- 一个 $N=1$ 的模型，其电荷为 $q_1$，为了满足 $Q_{\\text{tot}}=0$，必须有 $q_1=0$。这将导致所有多极矩为零，无法再现一个普遍的非零 $\\mu_z$ 或 $Q$。\n- 一个 $N=2$ 的模型，其电荷为 $q_1$ 和 $q_2$，位置为 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$。\n  - 电中性约束要求 $q_2 = -q_1$。这种布局本质上是一个偶极子。\n  - 偶极矩为 $\\boldsymbol{\\mu} = q_1 \\mathbf{r}_1 + q_2 \\mathbf{r}_2 = q_1(\\mathbf{r}_1 - \\mathbf{r}_2)$。其大小和方向由 $q_1$ 和矢量差 $\\mathbf{r}_1 - \\mathbf{r}_2$ 决定。\n  - 无迹四极矩取决于原点的选择。设偶极矩矢量沿 $z$ 轴方向，因此 $\\mathbf{r}_1 - \\mathbf{r}_2 = (0, 0, L)$。偶极子的中心位于 $(\\mathbf{r}_1+\\mathbf{r}_2)/2$。如果我们将坐标原点放在这个中心，位置就变为 $\\mathbf{r}_1' = (0,0,L/2)$ 和 $\\mathbf{r}_2' = (0,0,-L/2)$。四极矩分量 $Q_{zz}$ 则为 $Q_{zz} = \\sum q_i (3z_i^2 - r_i^2) = q_1(3(L/2)^2 - (L/2)^2) - q_1(3(-L/2)^2 - (-L/2)^2) = q_1(2(L/2)^2) - q_1(2(L/2)^2) = 0$。\n  - 要生成一个非零的 $Q_{zz}$，原点必须偏离偶极子的中心。如果原点沿 $z$ 轴移动了 $z_c$，则 $z$ 坐标变为 $z_c+L/2$ 和 $z_c-L/2$。产生的四极矩为 $Q_{zz} = 4 z_c q_1 L = 4 z_c \\mu_z$。\n  - 这表明对于一个2位点模型，四极矩 $Q_{zz}$与偶极矩 $\\mu_z$ 成正比。我们无法独立地指定一个普遍的 $\\mu_z$ 和一个普遍的 $Q$。因此，2位点模型是不够的。\n- 一个 $N=3$ 的模型具有更多的自由度。例如，三个电荷（$q_0, q_1, q_2$）及其位置提供了足够的参数来独立地满足这三个约束，正如将在接下来的部分中演示的那样。\n因此，至少需要 $3$ 个虚位点。\n\n**第2部分：线性方程组的推导**\n我们考虑所提出的在 $z$ 轴上含 3 个电荷的最小构造：\n- 电荷 $q_0$ 位于 $\\mathbf{r}_0 = (0, 0, 0)$。\n- 电荷 $q_1$ 位于 $\\mathbf{r}_1 = (0, 0, d)$。\n- 电荷 $q_2$ 位于 $\\mathbf{r}_2 = (0, 0, -d)$。\n\n我们将多极矩的定义应用于这个特定布局。\n1. **总电荷**：电荷总和必须为零。\n$$Q_{\\text{tot}} = q_0 + q_1 + q_2 = 0$$\n这是我们的第一个方程。\n\n2. **偶极矩**：偶极矩矢量必须为 $\\boldsymbol{\\mu} = (0,0, \\mu_z)$。\n$$\\boldsymbol{\\mu} = \\sum_{i=0}^2 q_i \\mathbf{r}_i = q_0\\mathbf{r}_0 + q_1\\mathbf{r}_1 + q_2\\mathbf{r}_2$$\n代入位置坐标：\n$$\\boldsymbol{\\mu} = q_0(0,0,0) + q_1(0,0,d) + q_2(0,0,-d) = (0, 0, q_1 d - q_2 d)$$\n将 $z$ 分量与目标值 $\\mu_z$ 相等：\n$$(q_1 - q_2)d = \\mu_z$$\n这是我们的第二个方程。\n\n3. **四极矩**：我们需要再现 $Q_{zz}=Q$。对于位于 $(0, 0, z_i)$ 的电荷 $q_i$，我们有 $r_i^2 = z_i^2$。对于 $zz$ 分量，通用公式简化为：\n$$Q_{zz} = \\sum_{i=0}^2 q_i (3z_i^2 - r_i^2) = \\sum_{i=0}^2 q_i (3z_i^2 - z_i^2) = \\sum_{i=0}^2 2q_i z_i^2$$\n计算我们的三个位点：\n- 位点0：$z_0=0$，贡献为 $2q_0(0)^2 = 0$。\n- 位点1：$z_1=d$，贡献为 $2q_1 d^2$。\n- 位点2：$z_2=-d$，贡献为 $2q_2(-d)^2 = 2q_2 d^2$。\n将贡献相加：\n$$Q_{zz} = 0 + 2q_1 d^2 + 2q_2 d^2 = 2d^2(q_1 + q_2)$$\n将其与目标值 $Q$ 相等：\n$$2d^2(q_1 + q_2) = Q$$\n这是我们的第三个方程。\n\n未知电荷 $(q_0, q_1, q_2)$ 的线性方程组为：\n$$\n\\begin{cases}\nq_0 + q_1 + q_2 = 0 \\\\\nd q_1 - d q_2 = \\mu_z \\\\\n2d^2 q_1 + 2d^2 q_2 = Q\n\\end{cases}\n$$\n\n**第3部分：符号解**\n我们求解在第2部分中推导出的三元线性方程组。让我们重写该方程组：\n(I) $q_0 + q_1 + q_2 = 0$\n(II) $q_1 - q_2 = \\frac{\\mu_z}{d}$\n(III) $q_1 + q_2 = \\frac{Q}{2d^2}$\n\n从方程(I)中，我们可以用 $q_1$ 和 $q_2$ 表示 $q_0$：\n$$q_0 = -(q_1 + q_2)$$\n代入方程(III)中 $(q_1+q_2)$ 的表达式：\n$$q_0 = -\\frac{Q}{2d^2}$$\n\n接下来，我们使用方程(II)和(III)求解关于 $q_1$ 和 $q_2$ 的子系统。\n将(II)和(III)相加：\n$$2q_1 = \\frac{\\mu_z}{d} + \\frac{Q}{2d^2} \\implies q_1 = \\frac{1}{2}\\left(\\frac{\\mu_z}{d} + \\frac{Q}{2d^2}\\right)$$\n这可以写作：\n$$q_1 = \\frac{\\mu_z}{2d} + \\frac{Q}{4d^2}$$\n\n从(III)中减去(II)：\n$$2q_2 = \\frac{Q}{2d^2} - \\frac{\\mu_z}{d} \\implies q_2 = \\frac{1}{2}\\left(\\frac{Q}{2d^2} - \\frac{\\mu_z}{d}\\right)$$\n这可以写作：\n$$q_2 = \\frac{Q}{4d^2} - \\frac{\\mu_z}{2d}$$\n\n电荷的完整符号解为：\n$$q_0 = -\\frac{Q}{2d^2}$$\n$$q_1 = \\frac{\\mu_z}{2d} + \\frac{Q}{4d^2}$$\n$$q_2 = \\frac{Q}{4d^2} - \\frac{\\mu_z}{2d}$$\n\n**第4部分：数值计算**\n我们使用第3部分中的符号表达式和给定的数值进行计算：\n- $\\mu_z = 0.80 \\, e\\cdot\\text{\\AA}$\n- $Q = 1.20 \\, e\\cdot\\text{\\AA}^2$\n- $d = 1.000 \\, \\text{\\AA}$\n\n单位是一致的，因此电荷将以基本电荷 $e$ 为单位计算。\n$$q_0 = -\\frac{1.20}{2(1.000)^2} = -\\frac{1.20}{2.000} = -0.60 \\, e$$\n$$q_1 = \\frac{0.80}{2(1.000)} + \\frac{1.20}{4(1.000)^2} = \\frac{0.80}{2.000} + \\frac{1.20}{4.000} = 0.40 + 0.30 = 0.70 \\, e$$\n$$q_2 = \\frac{1.20}{4(1.000)^2} - \\frac{0.80}{2(1.000)} = \\frac{1.20}{4.000} - \\frac{0.80}{2.000} = 0.30 - 0.40 = -0.10 \\, e$$\n\n问题要求答案保留四位有效数字。\n$q_0 = -0.6000 \\, e$\n$q_1 = 0.7000 \\, e$\n$q_2 = -0.1000 \\, e$\n\n位置 $z_1$ 和 $z_2$ 由 $d$ 给出：\n$z_1 = +d = 1.000 \\, \\text{\\AA}$\n$z_2 = -d = -1.000 \\, \\text{\\AA}$\n\n最终的五元组 $(q_0, q_1, q_2, z_1, z_2)$ 是 $(-0.6000, 0.7000, -0.1000, 1.000, -1.000)$，其中电荷单位为 $e$，距离单位为 $\\text{\\AA}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.6000  0.7000  -0.1000  1.000  -1.000\n\\end{pmatrix}\n}\n$$", "id": "3433023"}, {"introduction": "最流行的电荷分配方法（如 RESP）涉及在特定约束下，将电荷拟合到量子力学计算出的静电势上。本练习通过将拉格朗日乘子法应用于约束最小二乘问题，深入探讨了该过程的数学核心。你将推导并求解由此产生的 Karush-Kuhn-Tucker (KKT) 系统，从而对如何在满足电荷中性及对称性等关键物理约束的同时确定最优电荷，获得严谨的第一性原理层面的理解。[@problem_id:3433040]", "problem": "在分子动力学 (MD) 中，部分原子电荷 $q$ 通常通过将分子周围网格上测量的静电势 (ESP) 模型拟合到原子贡献的线性叠加来确定。考虑一个加权最小二乘公式，其中电荷 $q \\in \\mathbb{R}^{n}$ 通过最小化 $ \\frac{1}{2} \\| M q - y \\|_{W}^{2}$ 来确定，其中 $M \\in \\mathbb{R}^{m \\times n}$ 将电荷映射到网格上的预测 ESP 值，$y \\in \\mathbb{R}^{m}$ 是目标 ESP 值，$W \\in \\mathbb{R}^{m \\times m}$ 是一个对称正定加权矩阵。假设电荷必须满足线性等式约束 $A q = b$，其中 $A \\in \\mathbb{R}^{p \\times n}$，$b \\in \\mathbb{R}^{p}$。这些约束编码了例如分子总电荷等于一个指定值，以及某些原子具有对称等价性等信息。\n\n1. 从加权最小二乘法的基本定义和拉格朗日乘子法出发，推导该约束问题的拉格朗日函数和 Karush–Kuhn–Tucker (KKT) 最优性条件。您的推导应从目标函数 $\\frac{1}{2}(M q - y)^{\\top} W (M q - y)$ 和约束 $A q = b$ 开始，并逐步推导出平稳性条件和可行性条件，而不使用任何预先给定的“捷径”公式。\n\n2. 证明 KKT 条件可以写成一个单一的分块线性系统。然后，对于以下代表 ESP 拟合简化为其正规方程的特定实例，其中已预先计算正规矩阵 $H = M^{\\top} W M$ 和向量 $f = M^{\\top} W y$：\n$$\nH = \\begin{pmatrix}\n4  0  0  0 \\\\\n0  6  0  0 \\\\\n0  0  5  0 \\\\\n0  0  0  3\n\\end{pmatrix}, \\quad\nf = \\begin{pmatrix}\n2 \\\\\n3 \\\\\n1 \\\\\n0\n\\end{pmatrix},\n$$\n以及编码对称性和总电荷的等式约束：\n$$\nA = \\begin{pmatrix}\n1  -1  0  0 \\\\\n1  \\phantom{-}1  1  1\n\\end{pmatrix}, \\quad\nb = \\begin{pmatrix}\n0 \\\\\n1\n\\end{pmatrix},\n$$\n求解最优电荷 $q \\in \\mathbb{R}^{4}$ 和与约束相关的拉格朗日乘子 $\\lambda \\in \\mathbb{R}^{2}$。\n\n3. 从线性代数和优化的第一性原理出发，解释正规矩阵 $H$ 和与约束相关的舒尔补的数值条件如何影响计算出的电荷和乘子的稳定性和准确性。在您的解释中，说明 $M$ 的列之间的近似线性相关或 $W$ 中的不良缩放如何影响条件数，这种影响如何通过 KKT 系统传播，以及有哪些原则性的补救措施。\n\n以基本电荷 $e$ 为单位表示部分原子电荷；仅报告数值，不带单位。对于此实例，不要四舍五入；以精确的有理数形式报告您的最终数值答案。使用精确分数，在一行中提供六个值 $(q_1, q_2, q_3, q_4, \\lambda_1, \\lambda_2)$。", "solution": "该问题要求完成三项任务：1. 推导约束加权最小二乘问题的 Karush–Kuhn–Tucker (KKT) 条件。2. 求解该问题的一个具体实例。3. 讨论该问题的数值条件。\n\n### 第一部分：拉格朗日函数和 KKT 条件的推导\n\n问题是找到部分原子电荷向量 $q \\in \\mathbb{R}^{n}$，使其在满足线性等式约束 $A q = b$ 的条件下，最小化加权最小二乘目标函数\n$$ J(q) = \\frac{1}{2} \\| M q - y \\|_{W}^{2} $$\n\n加权范数的平方定义为 $\\|v\\|_{W}^{2} = v^{\\top} W v$。因此，目标函数可以写成：\n$$ J(q) = \\frac{1}{2} (M q - y)^{\\top} W (M q - y) $$\n我们展开这个表达式：\n$$ J(q) = \\frac{1}{2} (q^{\\top} M^{\\top} - y^{\\top}) W (M q - y) $$\n$$ J(q) = \\frac{1}{2} (q^{\\top} M^{\\top} W M q - q^{\\top} M^{\\top} W y - y^{\\top} W M q + y^{\\top} W y) $$\n由于 $y^{\\top} W M q$ 是一个标量，它等于其转置 $(y^{\\top} W M q)^{\\top} = q^{\\top} M^{\\top} W^{\\top} y$。鉴于加权矩阵 $W$ 是对称的 ($W^{\\top} = W$)，这变成 $q^{\\top} M^{\\top} W y$。这两个交叉项是相同的。\n$$ J(q) = \\frac{1}{2} q^{\\top} (M^{\\top} W M) q - q^{\\top} (M^{\\top} W y) + \\frac{1}{2} y^{\\top} W y $$\n$\\frac{1}{2} y^{\\top} W y$ 项对于 $q$ 是一个常数，不影响最小值的位置。\n\n这是一个约束优化问题。我们使用拉格朗日乘子法。约束是 $A q - b = 0$。我们引入一个拉格朗日乘子向量 $\\lambda \\in \\mathbb{R}^{p}$ 并构造拉格朗日函数 $\\mathcal{L}(q, \\lambda)$：\n$$ \\mathcal{L}(q, \\lambda) = J(q) + \\lambda^{\\top} (A q - b) $$\n$$ \\mathcal{L}(q, \\lambda) = \\frac{1}{2} q^{\\top} (M^{\\top} W M) q - q^{\\top} (M^{\\top} W y) + \\frac{1}{2} y^{\\top} W y + \\lambda^{\\top} (A q - b) $$\n\nKarush–Kuhn–Tucker (KKT) 最优性条件是通过将拉格朗日函数对主变量 $q$ 和对偶变量 $\\lambda$ 的梯度设置为零来找到的。\n\n1.  **平稳性条件**：关于 $q$ 的梯度必须为零：$\\nabla_{q} \\mathcal{L}(q, \\lambda) = 0$。\n    我们使用标准的矩阵微积分恒等式 $\\nabla_{x} (x^{\\top} B x) = (B+B^{\\top})x$（如果 $B$ 是对称的，则为 $2Bx$）和 $\\nabla_{x} (c^{\\top} x) = c$。\n    令 $H = M^{\\top} W M$ 和 $f = M^{\\top} W y$。由于 $W$ 是对称的，矩阵 $H$ 也是对称的。\n    $$ \\nabla_{q} \\mathcal{L}(q, \\lambda) = \\nabla_{q} \\left( \\frac{1}{2} q^{\\top} H q - q^{\\top} f + \\lambda^{\\top} A q - \\lambda^{\\top} b \\right) $$\n    $$ \\nabla_{q} \\mathcal{L}(q, \\lambda) = H q - f + A^{\\top} \\lambda $$\n    将其设为零得到平稳性条件：\n    $$ H q + A^{\\top} \\lambda = f $$\n    或者，用原始矩阵表示：\n    $$ (M^{\\top} W M) q + A^{\\top} \\lambda = M^{\\top} W y $$\n\n2.  **主可行性条件**：关于 $\\lambda$ 的梯度必须为零：$\\nabla_{\\lambda} \\mathcal{L}(q, \\lambda) = 0$。\n    $$ \\nabla_{\\lambda} \\mathcal{L}(q, \\lambda) = \\nabla_{\\lambda} \\left( \\dots + \\lambda^{\\top} (A q - b) \\right) = A q - b $$\n    将其设为零可以恢复原始约束：\n    $$ A q = b $$\n\n因此，该问题的 KKT 条件是由平稳性条件和主可行性条件组成的线性方程组：\n1.  $(M^{\\top} W M) q + A^{\\top} \\lambda = M^{\\top} W y$\n2.  $A q = b$\n\n### 第二部分：具体实例的求解\n\n上面推导的 KKT 条件构成了关于变量 $q$ 和 $\\lambda$ 的一个线性方程组。使用 $H = M^{\\top} W M$ 和 $f = M^{\\top} W y$，这些条件是：\n$$ Hq + A^{\\top} \\lambda = f $$\n$$ Aq = b $$\n这些可以写成一个单一的分块线性系统：\n$$\n\\begin{pmatrix}\nH  A^{\\top} \\\\\nA  0\n\\end{pmatrix}\n\\begin{pmatrix}\nq \\\\\n\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nf \\\\\nb\n\\end{pmatrix}\n$$\n这就是 KKT 系统。对于给定的实例，我们有 $n=4$ 个电荷和 $p=2$ 个约束。\n给定的矩阵是：\n$$\nH = \\begin{pmatrix}\n4  0  0  0 \\\\\n0  6  0  0 \\\\\n0  0  5  0 \\\\\n0  0  0  3\n\\end{pmatrix}, \\quad\nf = \\begin{pmatrix}\n2 \\\\\n3 \\\\\n1 \\\\\n0\n\\end{pmatrix}, \\quad\nA = \\begin{pmatrix}\n1  -1  0  0 \\\\\n1  \\phantom{-}1  1  1\n\\end{pmatrix}, \\quad\nb = \\begin{pmatrix}\n0 \\\\\n1\n\\end{pmatrix}\n$$\n$A$ 的转置是 $A^{\\top} = \\begin{pmatrix} 1  1 \\\\ -1  1 \\\\ 0  1 \\\\ 0  1 \\end{pmatrix}$。\n分块系统变成一个 $6 \\times 6$ 的方程组：\n$$\n\\begin{pmatrix}\n4  0  0  0  1  1 \\\\\n0  6  0  0  -1  1 \\\\\n0  0  5  0  0  1 \\\\\n0  0  0  3  0  1 \\\\\n1  -1  0  0  0  0 \\\\\n1  1  1  1  0  0\n\\end{pmatrix}\n\\begin{pmatrix} q_1 \\\\ q_2 \\\\ q_3 \\\\ q_4 \\\\ \\lambda_1 \\\\ \\lambda_2 \\end{pmatrix}\n=\n\\begin{pmatrix} 2 \\\\ 3 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n我们可以将其写成六个线性方程：\n(1) $4q_1 + \\lambda_1 + \\lambda_2 = 2$\n(2) $6q_2 - \\lambda_1 + \\lambda_2 = 3$\n(3) $5q_3 + \\lambda_2 = 1$\n(4) $3q_4 + \\lambda_2 = 0$\n(5) $q_1 - q_2 = 0$\n(6) $q_1 + q_2 + q_3 + q_4 = 1$\n\n从 (5) 式，我们有 $q_1 = q_2$。\n从 (3) 式，$q_3 = \\frac{1 - \\lambda_2}{5}$。\n从 (4) 式，$q_4 = \\frac{-\\lambda_2}{3}$。\n将 $q_1 = q_2$ 代入 (1) 和 (2)：\n(1') $4q_1 + \\lambda_1 + \\lambda_2 = 2$\n(2') $6q_1 - \\lambda_1 + \\lambda_2 = 3$\n将 (1') 和 (2') 相加：$10q_1 + 2\\lambda_2 = 5 \\implies 5q_1 + \\lambda_2 = \\frac{5}{2}$。由此，$\\lambda_2 = \\frac{5}{2} - 5q_1$。\n从 (2') 中减去 (1')：$2q_1 - 2\\lambda_1 = 1 \\implies \\lambda_1 = q_1 - \\frac{1}{2}$。\n\n现在我们用 $q_1$ 表示 $q_3$ 和 $q_4$：\n$q_3 = \\frac{1 - (\\frac{5}{2} - 5q_1)}{5} = \\frac{-\\frac{3}{2} + 5q_1}{5} = q_1 - \\frac{3}{10}$。\n$q_4 = \\frac{-(\\frac{5}{2} - 5q_1)}{3} = \\frac{5q_1 - \\frac{5}{2}}{3}$。\n\n现在将所有变量代入最后一个约束方程 (6)，注意 $q_2=q_1$：\n$q_1 + q_1 + \\left(q_1 - \\frac{3}{10}\\right) + \\frac{5q_1 - \\frac{5}{2}}{3} = 1$\n$3q_1 - \\frac{3}{10} + \\frac{5q_1}{3} - \\frac{5}{6} = 1$\n为了合并各项，我们找到公分母 30：\n$3q_1(30/30) - 3/10(3/3) + 5q_1/3(10/10) - 5/6(5/5) = 1(30/30)$\n$\\frac{90q_1 - 9 + 50q_1 - 25}{30} = \\frac{30}{30}$\n$140q_1 - 34 = 30$\n$140q_1 = 64$\n$q_1 = \\frac{64}{140} = \\frac{16}{35}$。\n\n现在我们求其他变量：\n$q_2 = q_1 = \\frac{16}{35}$\n$\\lambda_2 = \\frac{5}{2} - 5q_1 = \\frac{5}{2} - 5\\left(\\frac{16}{35}\\right) = \\frac{5}{2} - \\frac{16}{7} = \\frac{35 - 32}{14} = \\frac{3}{14}$\n$\\lambda_1 = q_1 - \\frac{1}{2} = \\frac{16}{35} - \\frac{1}{2} = \\frac{32 - 35}{70} = -\\frac{3}{70}$\n$q_3 = q_1 - \\frac{3}{10} = \\frac{16}{35} - \\frac{3}{10} = \\frac{32 - 21}{70} = \\frac{11}{70}$\n$q_4 = \\frac{-\\lambda_2}{3} = \\frac{-(3/14)}{3} = -\\frac{1}{14}$\n\n解是 $(q_1, q_2, q_3, q_4, \\lambda_1, \\lambda_2) = \\left(\\frac{16}{35}, \\frac{16}{35}, \\frac{11}{70}, -\\frac{1}{14}, -\\frac{3}{70}, \\frac{3}{14}\\right)$。\n\n### 第三部分：数值条件的解释\n\n计算出的电荷 $q$ 和乘子 $\\lambda$ 的稳定性和准确性取决于必须求解的线性系统的数值条件。\n\n1.  **正规矩阵 H 的条件**：正规矩阵为 $H = M^{\\top} W M$。其条件数 $\\kappa(H) = \\|H\\|\\|H^{-1}\\|$ 是一个主要因素。\n    - **M 的影响**：矩阵 $M$ 将原子电荷映射到网格上的 ESP。如果 $M$ 的列近似线性相关，这意味着两个或多个原子产生的 ESP 分布非常相似。这使得区分它们对总 ESP 的各自贡献变得困难，导致 $H$ 近似奇异（病态）。这对于空间上相近或深埋在分子内部的原子来说是一个常见问题。在线性相关的极限情况下，$M$ 将是秩亏的，$H$ 将是奇异且不可逆的，这意味着在没有约束的情况下问题没有唯一解。$H$ 的条件数大约是 $M$ (或 $\\sqrt{W}M$) 条件数的平方，即 $\\kappa(H) \\approx \\kappa(M)^{2}$。这种平方效应意味着即使是中等病态的映射矩阵 $M$ 也可能导致严重病态的正规矩阵 $H$。\n    - **W 的影响**：加权矩阵 $W$ 考虑了不同网格点上 ESP 值的重要性或不确定性的变化。如果 $W$ 的元素相差多个数量级（不良缩放），它会以一种显著增加 $H$ 条件数的方式拉伸问题空间，即使 $M$ 本身是良态的。\n\n2.  **通过 KKT 系统的传播**：解是从 KKT 系统 $\\begin{pmatrix} H  A^{\\top} \\\\ A  0 \\end{pmatrix} \\begin{pmatrix} q \\\\ \\lambda \\end{pmatrix} = \\begin{pmatrix} f \\\\ b \\end{pmatrix}$ 中获得的。$H$ 的病态性直接影响该系统的稳定性。通过舒尔补方法形式上求解此系统可以说明这一点。首先从 $(A H^{-1} A^{\\top}) \\lambda = A H^{-1} f - b$ 求解 $\\lambda$，然后通过 $q = H^{-1}(f - A^{\\top}\\lambda)$ 找到 $q$。\n    - 矩阵 $S = A H^{-1} A^{\\top}$ 是 KKT 矩阵中 $H$ 的舒尔补。计算 $\\lambda$ 的稳定性取决于 $\\kappa(S)$。如果 $H$ 是病态的，$H^{-1}$ 会有很大的数值误差，这些误差会传播到 $S$、$A H^{-1} f$ 的计算中，从而影响到 $\\lambda$。\n    - $q$ 的计算直接涉及 $H^{-1}$。因此，在求 $H$ 的逆或用其求解方程组时的任何数值不稳定性都会直接影响计算出的电荷 $q$ 的准确性。输入数据（影响 $f$ 的 $y$）中的微小扰动会被一个与 $\\kappa(H)$ 成正比的因子放大，导致 $q$ 的解出现巨大变化。\n\n3.  **原则性的补救措施**：\n    - **正则化**：一种广泛使用的技术是 Tikhonov 正则化（或岭回归）。在目标函数中添加一个惩罚项，通常是 $\\frac{1}{2}\\alpha \\|q\\|^2$（其中 $\\alpha > 0$ 是一个小数）。这将平稳性条件改变为 $(H + \\alpha I)q + A^{\\top}\\lambda = f$。矩阵 $(H + \\alpha I)$ 保证比 $H$ 有更好的条件，因为加上 $\\alpha I$ 会将 $H$ 的所有特征值增加 $\\alpha$，从而使最小的特征值远离零。这通过引入一个偏向于较小量级电荷的偏置来稳定解。\n    - **对增广系统使用直接方法**：可以完全不构造正规矩阵 $H$，而是对原始“高瘦”矩阵 $M$ 的增广版本使用 QR 或 SVD 分解等方法。这避免了构造 $H = M^{\\top}W M$ 时带来的条件数平方问题，并且通常在数值上更稳定。对于约束问题，可以使用诸如广义 QR 分解之类的专门方法。\n    - **预处理**：对于迭代求解器，可以使用预条件子矩阵 $P$ 将 KKT 系统转换为条件更好的系统。目标是找到一个能够近似 KKT 矩阵，并且方程组 $Pz=r$ 易于求解的 $P$。为 KKT 系统设计有效的预条件子是数值线性代数的一个主要领域。\n    - **加强约束**：如果病态性源于物理上的模糊性（例如，近乎等效的原子），增加更多约束（例如，强制对称等效原子的电荷相等）可以移除自由度并对问题进行正则化。这基本上就是本问题中约束矩阵 $A$ 的部分作用。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{16}{35}  \\frac{16}{35}  \\frac{11}{70}  -\\frac{1}{14}  -\\frac{3}{70}  \\frac{3}{14} \\end{pmatrix} } $$", "id": "3433040"}]}