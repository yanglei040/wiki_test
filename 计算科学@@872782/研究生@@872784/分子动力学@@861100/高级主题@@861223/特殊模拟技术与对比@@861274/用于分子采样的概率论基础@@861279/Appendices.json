{"hands_on_practices": [{"introduction": "在分子模拟中，重加权轨迹是一种强大的技术，它允许我们使用从参考系统生成的数据来估计目标系统的性质。本练习将指导您从第一性原理出发，基于 Girsanov 定理推导连续时间朗之万动力学下的精确路径似然比 [@problem_id:3437718]。通过计算该重加权因子的方差，您将直面重要性采样中的一个基本挑战：统计误差随模拟时间的指数发散。", "problem": "考虑一个分子坐标 $x_t \\in \\mathbb{R}^{d}$ 的过阻尼朗之万随机微分方程 (SDE)，\n$$\ndx_t = f_0(x_t)\\,dt + \\sigma\\,dW_t,\n$$\n其中 $f_0:\\mathbb{R}^{d}\\to\\mathbb{R}^{d}$ 是一个漂移场，$\\sigma \\in \\mathbb{R}^{+}$ 是一个常数标量扩散幅度，而 $W_t$ 是一个 $d$ 维标准维纳过程。假设轨迹是通过显式欧拉-丸山积分器在均匀时间网格 $t_n = n h$（对于 $n=0,1,\\dots,N$ 且 $T = N h$）上生成的，其形式为\n$$\nx_{n+1} = x_n + f_0(x_n)\\,h + \\sigma \\sqrt{h}\\,\\xi_n,\n$$\n其中 $\\xi_n \\sim \\mathcal{N}(0, I_d)$ 是 $\\mathbb{R}^{d}$ 中的独立标准正态向量。设目标漂移为 $f_1(x) = f_0(x) + \\delta b(x)$，其中 $\\delta b:\\mathbb{R}^{d}\\to\\mathbb{R}^{d}$ 是有界可测的扰动，并定义缩放后的漂移差\n$$\n\\Delta f(t) := \\sigma^{-1}\\,\\delta b(x_t).\n$$\n您希望对在参考漂移 $f_0$ 下生成的轨迹计算出的路径依赖可观测量 $\\varphi[x_{0:T}]$ 进行重加权，以获得它们在目标漂移 $f_1$ 下的期望值。\n\n从第一性原理出发，即由相同扩散的两个漂移所诱导的路径测度之间的拉东-尼科迪姆导数，以及欧拉-丸山格式的高斯增量性质：\n- 推导在 $[0,T]$ 上与 $f_1$ 和 $f_0$ 相关联的路径测度之间的连续时间似然比 $L$（用 $\\Delta f(t)$ 表示），并展示当 $h \\to 0$ 时，每一步正态密度比的离散时间乘积如何收敛到该极限。\n- 在一维情况 $d=1$ 下，当 $\\Delta f(t) \\equiv \\Delta f \\in \\mathbb{R}$ 为常数且 $\\sigma \\in \\mathbb{R}^{+}$ 为常数时，计算在由 $f_0$ 生成的参考测度下，对于持续时间为 $T$ 的轨迹，其二阶矩 $\\mathbb{E}_{0}[L^{2}]$，并由此计算方差 $\\mathrm{Var}_{0}(L)$。用 $\\Delta f$ 和 $T$ 将您的最终答案表示为单个封闭形式的解析表达式。不需要四舍五入。您的最终答案必须是 $\\mathrm{Var}_{0}(L)$ 的表达式，且最终答案中不包含任何单位。", "solution": "该问题要求推导由不同漂移指定的两个路径测度之间的连续时间似然比，并在特定条件下计算该比率的方差。该问题是适定的，在随机微积分和统计物理理论中有科学依据，并且所有必要信息均已提供。\n\n首先，我们推导由目标漂移 $f_1$ 和参考漂移 $f_0$ 诱导的路径测度之间的似然比，也称为拉东-尼科迪姆导数。设 $P_1$ 和 $P_0$ 分别是由 SDE $dx_t = f_1(x_t)\\,dt + \\sigma\\,dW_t$ 和 $dx_t = f_0(x_t)\\,dt + \\sigma\\,dW_t$ 生成的连续路径空间上的概率测度，两者都从 $x_0$ 开始。\n\n我们从离散的欧拉-丸山格式开始。对于从时间 $t_n$ 到 $t_{n+1}=t_n+h$ 的轨迹段，位置更新由 $x_{n+1} = x_n + f(x_n)h + \\sigma\\sqrt{h}\\xi_n$ 给出，其中 $\\xi_n \\sim \\mathcal{N}(0, I_d)$。这意味着在给定 $x_n$ 的条件下观测到 $x_{n+1}$ 的条件概率密度是高斯分布。具体来说，对于参考过程（由 $f_0$ 控制），增量 $x_{n+1}-x_n$ 是均值为 $f_0(x_n)h$、协方差为 $\\sigma^2 h I_d$ 的正态分布。条件概率密度为：\n$$\np_0(x_{n+1} | x_n) = \\frac{1}{(2\\pi \\sigma^2 h)^{d/2}} \\exp\\left(-\\frac{\\|x_{n+1} - x_n - f_0(x_n)h\\|^2}{2\\sigma^2 h}\\right)\n$$\n类似地，对于目标过程（由 $f_1$ 控制），条件密度为：\n$$\np_1(x_{n+1} | x_n) = \\frac{1}{(2\\pi \\sigma^2 h)^{d/2}} \\exp\\left(-\\frac{\\|x_{n+1} - x_n - f_1(x_n)h\\|^2}{2\\sigma^2 h}\\right)\n$$\n此单时间步的似然比是这两个密度的比率：\n$$\nL_n = \\frac{p_1(x_{n+1} | x_n)}{p_0(x_{n+1} | x_n)} = \\exp\\left( \\frac{1}{2\\sigma^2 h} \\left( \\|x_{n+1} - x_n - f_0(x_n)h\\|^2 - \\|x_{n+1} - x_n - f_1(x_n)h\\|^2 \\right) \\right)\n$$\n我们展开指数中的平方范数，使用 $\\delta b(x) = f_1(x) - f_0(x)$ 以及简写 $\\Delta x_n = x_{n+1} - x_n$，$f_{0,n} = f_0(x_n)$ 和 $\\delta b_n = \\delta b(x_n)$：\n\\begin{align*}\n\\|\\Delta x_n - f_{0,n}h\\|^2 - \\|\\Delta x_n - (f_{0,n} + \\delta b_n)h\\|^2 = (\\|\\Delta x_n\\|^2 - 2h\\langle\\Delta x_n, f_{0,n}\\rangle + h^2\\|f_{0,n}\\|^2) \\\\\n\\quad - (\\|\\Delta x_n\\|^2 - 2h\\langle\\Delta x_n, f_{0,n} + \\delta b_n\\rangle + h^2\\|f_{0,n} + \\delta b_n\\|^2) \\\\\n= 2h\\langle\\Delta x_n, \\delta b_n\\rangle - h^2(\\|f_{0,n} + \\delta b_n\\|^2 - \\|f_{0,n}\\|^2) \\\\\n= 2h\\langle\\Delta x_n, \\delta b_n\\rangle - h^2(2\\langle f_{0,n}, \\delta b_n \\rangle + \\|\\delta b_n\\|^2)\n\\end{align*}\n将此代回 $L_n$ 的表达式中：\n$$\nL_n = \\exp\\left( \\frac{1}{2\\sigma^2 h} \\left( 2h\\langle\\Delta x_n, \\delta b_n\\rangle - 2h^2\\langle f_{0,n}, \\delta b_n \\rangle - h^2\\|\\delta b_n\\|^2 \\right) \\right) = \\exp\\left( \\frac{\\langle\\Delta x_n, \\delta b_n\\rangle}{\\sigma^2} - \\frac{h\\langle f_{0,n}, \\delta b_n \\rangle}{\\sigma^2} - \\frac{h\\|\\delta b_n\\|^2}{2\\sigma^2} \\right)\n$$\n为了继续，我们必须用参考过程 $P_0$ 的动力学来表示 $\\Delta x_n$，因为我们是在由 $P_0$ 生成的路径上评估似然比。根据 $f_0$ 的欧拉-丸山格式，我们有 $\\Delta x_n = f_{0,n}h + \\sigma\\sqrt{h}\\xi_n$。将此代入指数的第一项：\n$$\n\\frac{\\langle\\Delta x_n, \\delta b_n\\rangle}{\\sigma^2} = \\frac{\\langle f_{0,n}h + \\sigma\\sqrt{h}\\xi_n, \\delta b_n\\rangle}{\\sigma^2} = \\frac{h\\langle f_{0,n}, \\delta b_n \\rangle}{\\sigma^2} + \\frac{\\sqrt{h}\\langle\\xi_n, \\delta b_n\\rangle}{\\sigma}\n$$\n将此代回 $\\ln(L_n)$ 的表达式中：\n$$\n\\ln(L_n) = \\left( \\frac{h\\langle f_{0,n}, \\delta b_n \\rangle}{\\sigma^2} + \\frac{\\sqrt{h}\\langle\\xi_n, \\delta b_n\\rangle}{\\sigma} \\right) - \\frac{h\\langle f_{0,n}, \\delta b_n \\rangle}{\\sigma^2} - \\frac{h\\|\\delta b_n\\|^2}{2\\sigma^2} = \\frac{\\sqrt{h}\\langle\\xi_n, \\delta b_n\\rangle}{\\sigma} - \\frac{h\\|\\delta b_n\\|^2}{2\\sigma^2}\n$$\n使用定义 $\\Delta f(x) = \\sigma^{-1}\\delta b(x)$，我们可以写出：\n$$\n\\ln(L_n) = \\langle\\Delta f(x_n), \\sqrt{h}\\xi_n\\rangle - \\frac{1}{2}\\|\\Delta f(x_n)\\|^2 h\n$$\n持续时间为 $T=Nh$ 的路径的总似然比是单步比率的乘积，$L = \\prod_{n=0}^{N-1} L_n$。取对数得到：\n$$\n\\ln(L) = \\sum_{n=0}^{N-1} \\ln(L_n) = \\sum_{n=0}^{N-1} \\left( \\langle\\Delta f(x_{t_n}), \\sqrt{h}\\xi_n\\rangle - \\frac{1}{2}\\|\\Delta f(x_{t_n})\\|^2 h \\right)\n$$\n在极限 $h \\to 0$ 下，离散维纳增量 $\\sqrt{h}\\xi_n$ 变为连续增量 $dW_t$。第一项变为收敛到伊藤积分的黎曼-斯蒂尔杰斯和，第二项是收敛到勒贝格积分的标准黎曼和：\n$$\n\\lim_{h \\to 0} \\ln(L) = \\int_0^T \\langle\\Delta f(x_s), dW_s\\rangle - \\frac{1}{2}\\int_0^T \\|\\Delta f(x_s)\\|^2 ds\n$$\n取指数得到连续时间似然比，这是 Girsanov-Cameron-Martin 定理的结果：\n$$\nL = \\frac{dP_1}{dP_0} = \\exp\\left( \\int_0^T \\langle\\Delta f(x_s), dW_s\\rangle - \\frac{1}{2}\\int_0^T \\|\\Delta f(x_s)\\|^2 ds \\right)\n$$\n这就完成了问题的第一部分。\n\n对于第二部分，我们必须计算参考测度 $P_0$ 下的方差 $\\mathrm{Var}_{0}(L)$。我们被给予了简化条件，即系统是一维的（$d=1$），且缩放后的漂移差是常数 $\\Delta f(t) \\equiv \\Delta f \\in \\mathbb{R}$。似然比 $L$ 显著简化。内积变为简单乘积，常数 $\\Delta f$ 可以从积分中提出：\n$$\nL = \\exp\\left( \\int_0^T \\Delta f \\, dW_s - \\frac{1}{2}\\int_0^T (\\Delta f)^2 ds \\right) = \\exp\\left( \\Delta f \\int_0^T dW_s - \\frac{1}{2}(\\Delta f)^2 \\int_0^T ds \\right)\n$$\n由于 $\\int_0^T dW_s = W_T - W_0 = W_T$（因为 $W_0=0$）且 $\\int_0^T ds = T$，所以 $L$ 的表达式变为：\n$$\nL = \\exp\\left( \\Delta f \\, W_T - \\frac{1}{2}(\\Delta f)^2 T \\right)\n$$\n方差定义为 $\\mathrm{Var}_{0}(L) = \\mathbb{E}_{0}[L^2] - (\\mathbb{E}_{0}[L])^2$。我们分别计算一阶矩和二阶矩。\n\n一阶矩 $\\mathbb{E}_{0}[L]$：过程 $L_t = \\exp\\left( \\int_0^t \\Delta f \\, dW_s - \\frac{1}{2}\\int_0^t (\\Delta f)^2 ds \\right)$ 是 Doléans-Dade 指数鞅的一个特例。对于常数被积函数 $\\Delta f$，Novikov 条件 $\\mathbb{E}\\left[\\exp\\left(\\frac{1}{2}\\int_0^T (\\Delta f)^2 ds\\right)\\right]  \\infty$ 是满足的，因为该积分是确定性的。鞅 $M_t$ 的一个基本性质是 $\\mathbb{E}[M_T] = M_0$。这里，$L_0 = \\exp(0-0) = 1$。因此：\n$$\n\\mathbb{E}_{0}[L] = 1\n$$\n这证实了重加权方案的一致性。\n\n二阶矩 $\\mathbb{E}_{0}[L^2]$：我们首先找到 $L^2$ 的表达式：\n$$\nL^2 = \\left[ \\exp\\left( \\Delta f \\, W_T - \\frac{1}{2}(\\Delta f)^2 T \\right) \\right]^2 = \\exp\\left( 2\\Delta f \\, W_T - (\\Delta f)^2 T \\right)\n$$\n现在我们在参考测度 $P_0$ 下取期望。项 $\\exp(-(\\Delta f)^2 T)$ 是一个确定性常数，可以从期望中分解出来：\n$$\n\\mathbb{E}_{0}[L^2] = \\mathbb{E}_{0}\\left[ \\exp\\left( 2\\Delta f \\, W_T - (\\Delta f)^2 T \\right) \\right] = \\exp(-(\\Delta f)^2 T) \\, \\mathbb{E}_{0}\\left[ \\exp(2\\Delta f \\, W_T) \\right]\n$$\n期望 $\\mathbb{E}_{0}[\\exp(k Z)]$ 是随机变量 $Z$ 的矩生成函数 (MGF)。在 $P_0$ 下，时间 $T$ 的维纳过程 $W_T$ 是一个均值为 $0$、方差为 $T$ 的正态分布随机变量，即 $W_T \\sim \\mathcal{N}(0, T)$。一个一般正态变量 $X \\sim \\mathcal{N}(\\mu, \\nu)$ 的 MGF 是 $M_X(k) = \\mathbb{E}[\\exp(kX)] = \\exp(k\\mu + \\frac{1}{2}k^2\\nu)$。\n在我们的例子中，随机变量是 $W_T$，其均值 $\\mu=0$，方差 $\\nu=T$。系数是 $k = 2\\Delta f$。应用 MGF 公式：\n$$\n\\mathbb{E}_{0}\\left[ \\exp(2\\Delta f \\, W_T) \\right] = \\exp\\left( (2\\Delta f) \\cdot 0 + \\frac{1}{2}(2\\Delta f)^2 T \\right) = \\exp\\left( \\frac{1}{2} \\cdot 4(\\Delta f)^2 T \\right) = \\exp\\left( 2(\\Delta f)^2 T \\right)\n$$\n将此结果代回二阶矩的表达式中：\n$$\n\\mathbb{E}_{0}[L^2] = \\exp(-(\\Delta f)^2 T) \\cdot \\exp(2(\\Delta f)^2 T) = \\exp\\left( -(\\Delta f)^2 T + 2(\\Delta f)^2 T \\right) = \\exp\\left( (\\Delta f)^2 T \\right)\n$$\n最后，我们可以计算方差：\n$$\n\\mathrm{Var}_{0}(L) = \\mathbb{E}_{0}[L^2] - (\\mathbb{E}_{0}[L])^2 = \\exp\\left( (\\Delta f)^2 T \\right) - (1)^2 = \\exp\\left( (\\Delta f)^2 T \\right) - 1\n$$\n这个表达式表明，似然比的方差随着轨迹持续时间 $T$ 和缩放漂移差 $\\Delta f$ 的平方呈指数增长。这是将重要性采样应用于动力学系统长时间模拟时的一个众所周知的挑战。", "answer": "$$\n\\boxed{\\exp\\left((\\Delta f)^{2} T\\right) - 1}\n$$", "id": "3437718"}, {"introduction": "前一个练习中发现的方差爆炸问题，为实际的非平衡计算带来了巨大障碍。本问题聚焦于 Jarzynski 等式，其中具有大功值的稀有事件可能主导统计平均，导致收敛性差 [@problem_id:3437697]。您将通过设计一个最优的重要性采样方案来解决此问题，展示指数倾斜如何抑制方差，并即使对于重尾功分布也能产生可靠的自由能估计。", "problem": "在逆温度 $\\beta  0$下进行了一个单分子拉伸实验，该实验沿着一个驱动协议的独立实现过程产生了非平衡功值 $W$。亥姆霍兹自由能差 $\\Delta F$ 与功通过 Jarzynski 等式相关联，该等式表述为 $\\Delta F = -\\beta^{-1} \\ln \\langle \\exp(-\\beta W) \\rangle$，其中 $\\langle \\cdot \\rangle$ 表示对真实功分布的期望。在远离平衡的协议中，功分布在能量提取侧（大的负功 $W$）可以是重尾的。考虑以下功 $W$ 的统计上合理的模型：它遵循非对称拉普拉斯定律，其位置参数为 $m \\in \\mathbb{R}$，左/右尺度参数为 $s_{-}  0$ 和 $s_{+}  0$，其概率密度函数为\n$$\nf(w) = \\begin{cases}\n\\dfrac{1}{s_{-} + s_{+}} \\exp\\!\\left(\\dfrac{w - m}{s_{-}}\\right),  w  m, \\\\\n\\dfrac{1}{s_{-} + s_{+}} \\exp\\!\\left(-\\dfrac{w - m}{s_{+}}\\right),  w \\ge m.\n\\end{cases}\n$$\n当 $s_{-}$ 较大时，此模型可以捕捉到较重的左尾，这与主导 $\\langle \\exp(-\\beta W)\\rangle$ 的罕见、大的能量提取事件相关。\n\n你将通过对数矩生成函数分析估计量的可靠性，并设计一个重要性抽样方案来控制方差：\n\n1. 从矩生成函数 $M(t) = \\langle \\exp(t W) \\rangle$ 及其对数 $\\kappa(t) = \\ln M(t)$ 的定义出发，推导上述 $f(w)$ 的 $\\kappa(t)$，并确定 $\\kappa(t)$ 为有限的 $t$ 的定义域。用 $s_{-}$ 和 $s_{+}$ 表述 $\\beta$ 需满足的条件，在该条件下 Jarzynski 期望 $\\langle \\exp(-\\beta W) \\rangle$ 存在，并表述在该条件下 $\\langle \\exp(-\\beta W)\\rangle$ 的朴素样本均值估计量具有有限方差的更严格条件。\n\n2. 考虑参数为 $\\lambda$ 的指数倾斜重要性抽样器，\n$$\ng_{\\lambda}(w) = \\exp\\!\\big(\\lambda w - \\kappa(\\lambda)\\big)\\, f(w),\n$$\n只要 $\\kappa(\\lambda)$ 有限，它就是良定义的。当从 $g_{\\lambda}$ 中抽取独立样本 $W^{(1)},\\dots,W^{(N)}$ 时，使用无偏重要性抽样估计量\n$$\n\\widehat{Z}_{N}(\\lambda) = \\frac{1}{N} \\sum_{i=1}^{N} \\exp\\!\\big(-( \\beta + \\lambda ) W^{(i)} + \\kappa(\\lambda)\\big),\n$$\n来估计 Jarzynski 期望，使得 $\\langle \\widehat{Z}_{N}(\\lambda) \\rangle = \\langle \\exp(-\\beta W) \\rangle \\equiv Z$。仅使用上述定义和矩生成函数的标准性质，计算单样本二阶矩 $\\langle Y_1(\\lambda)^2 \\rangle$（其中$Y_1(\\lambda)$是和中的一项）的闭式解，并用它来获得单个样本估计量的方差 $V_1(\\lambda) = \\langle Y_1(\\lambda)^2 \\rangle - Z^2$。\n\n3. 在所有使所涉表达式有限的容许 $\\lambda$ 中，确定最小化 $V_1(\\lambda)$ 的最优倾斜参数 $\\lambda^{\\ast}$ 的解析表达式。\n\n将 $\\lambda^{\\ast}$ 的最终答案表示为仅含 $\\beta$ 的闭式符号表达式。不需要数值四舍五入。最终答案中不要包含单位，但在推导过程中可以假设 $\\beta$ 和 $\\lambda$ 具有相同的物理单位（能量的倒数）。", "solution": "该问题要求对单分子实验中功值的非对称拉普拉斯分布模型进行三部分分析，重点关注 Jarzynski 等式和重要性抽样。\n\n### 第1部分：对数矩生成函数和存在性条件\n\n首先，我们为给定的概率密度函数 $f(w)$ 推导矩生成函数（MGF），$M(t) = \\langle \\exp(t W) \\rangle$。\n$$\nf(w) = \\begin{cases}\n\\dfrac{1}{s_{-} + s_{+}} \\exp\\left(\\dfrac{w - m}{s_{-}}\\right),  w  m \\\\\n\\dfrac{1}{s_{-} + s_{+}} \\exp\\left(-\\dfrac{w - m}{s_{+}}\\right),  w \\ge m\n\\end{cases}\n$$\nMGF通过在 $W$ 的定义域上对 $\\exp(tw)f(w)$ 进行积分来计算：\n$$\nM(t) = \\int_{-\\infty}^{\\infty} \\exp(tw) f(w) dw = \\int_{-\\infty}^{m} \\exp(tw) f(w) dw + \\int_{m}^{\\infty} \\exp(tw) f(w) dw\n$$\n让我们分别计算这两个积分。第一个积分是：\n$$\nI_1 = \\frac{1}{s_{-} + s_{+}} \\int_{-\\infty}^{m} \\exp(tw) \\exp\\left(\\frac{w - m}{s_{-}}\\right) dw = \\frac{\\exp(-m/s_{-})}{s_{-} + s_{+}} \\int_{-\\infty}^{m} \\exp\\left(w\\left(t + \\frac{1}{s_{-}}\\right)\\right) dw\n$$\n为使此积分收敛，指数的系数必须为正：$t + \\frac{1}{s_{-}} > 0$，即 $t > -1/s_{-}$。在此条件下：\n$$\nI_1 = \\frac{\\exp(-m/s_{-})}{s_{-} + s_{+}} \\left[ \\frac{\\exp(w(t + 1/s_{-}))}{t + 1/s_{-}} \\right]_{-\\infty}^{m} = \\frac{\\exp(-m/s_{-})}{s_{-} + s_{+}} \\frac{\\exp(m(t+1/s_{-}))}{t+1/s_{-}} = \\frac{\\exp(mt)}{s_{-} + s_{+}} \\frac{s_{-}}{1 + ts_{-}}\n$$\n第二个积分是：\n$$\nI_2 = \\frac{1}{s_{-} + s_{+}} \\int_{m}^{\\infty} \\exp(tw) \\exp\\left(-\\frac{w - m}{s_{+}}\\right) dw = \\frac{\\exp(m/s_{+})}{s_{-} + s_{+}} \\int_{m}^{\\infty} \\exp\\left(w\\left(t - \\frac{1}{s_{+}}\\right)\\right) dw\n$$\n为使积分收敛，指数的系数必须为负：$t - \\frac{1}{s_{+}}  0$，即 $t  1/s_{+}$。在此条件下：\n$$\nI_2 = \\frac{\\exp(m/s_{+})}{s_{-} + s_{+}} \\left[ \\frac{\\exp(w(t - 1/s_{+}))}{t - 1/s_{+}} \\right]_{m}^{\\infty} = \\frac{\\exp(m/s_{+})}{s_{-} + s_{+}} \\left( 0 - \\frac{\\exp(m(t-1/s_{+}))}{t-1/s_{+}} \\right) = \\frac{\\exp(mt)}{s_{-} + s_{+}} \\frac{s_{+}}{1 - ts_{+}}\n$$\n合并两部分，对于 $t \\in (-1/s_{-}, 1/s_{+})$：\n$$\nM(t) = I_1 + I_2 = \\frac{\\exp(mt)}{s_{-} + s_{+}} \\left( \\frac{s_{-}}{1 + ts_{-}} + \\frac{s_{+}}{1 - ts_{+}} \\right) = \\frac{\\exp(mt)}{s_{-} + s_{+}} \\frac{s_{-}(1-ts_{+}) + s_{+}(1+ts_{-})}{(1+ts_{-})(1-ts_{+})}\n$$\n$$\nM(t) = \\frac{\\exp(mt)}{s_{-} + s_{+}} \\frac{s_{-} + s_{+}}{1 + t(s_{-} - s_{+}) - t^2 s_{-} s_{+}} = \\frac{\\exp(mt)}{1 + t(s_{-} - s_{+}) - t^2 s_{-} s_{+}}\n$$\n因此，对数矩生成函数 $\\kappa(t) = \\ln M(t)$ 为：\n$$\n\\kappa(t) = mt - \\ln\\left(1 + t(s_{-} - s_{+}) - t^2 s_{-} s_{+}\\right)\n$$\n该函数在开区间 $(-1/s_{-}, 1/s_{+})$ 内对 $t$ 是有限的。\n\nJarzynski 期望为 $\\langle \\exp(-\\beta W) \\rangle = M(-\\beta)$。为使其存在，$-\\beta$ 必须在 $M(t)$ 的定义域内。所以，$-1/s_{-}  -\\beta  1/s_{+}$。\n由于 $\\beta > 0$ 且 $s_{+} > 0$，右侧不等式 $-\\beta  1/s_{+}$ 总是满足的。\n左侧不等式是 $-1/s_{-}  -\\beta$，两边乘以 $-1$ 后变为 $1/s_{-} > \\beta$。因此，Jarzynski 期望存在的条件是 $\\beta  1/s_{-}$。\n\n$\\langle \\exp(-\\beta W) \\rangle$ 的朴素样本均值估计量的方差是有限的，条件是被平均的量 $\\exp(-\\beta W)$ 的二阶矩是有限的。这个二阶矩是 $\\langle (\\exp(-\\beta W))^2 \\rangle = \\langle \\exp(-2\\beta W) \\rangle = M(-2\\beta)$。为使其存在，$-2\\beta$ 必须在 $M(t)$ 的定义域内。所以，$-1/s_{-}  -2\\beta  1/s_{+}$。\n右侧不等式 $-2\\beta  1/s_{+}$ 总是满足的。左侧不等式是 $-1/s_{-}  -2\\beta$，这意味着 $1/s_{-} > 2\\beta$，即 $\\beta  1/(2s_{-})$。这是一个更严格的条件。\n\n### 第2部分：重要性抽样估计量的方差\n\n重要性抽样估计量是 $\\widehat{Z}_{N}(\\lambda) = \\frac{1}{N} \\sum_{i=1}^{N} Y_i(\\lambda)$，其中 $Y_i(\\lambda) = \\exp(-( \\beta + \\lambda ) W^{(i)} + \\kappa(\\lambda))$ 并且 $W^{(i)}$ 是从 $g_{\\lambda}(w)$ 中抽取的独立同分布样本。我们已知 $\\langle \\widehat{Z}_{N}(\\lambda) \\rangle = \\mathbb{E}_{g_\\lambda}[Y_1(\\lambda)] = Z$。\n\n问题要求计算单样本二阶矩 $\\langle Y_1(\\lambda)^2 \\rangle$。这是相对于抽样分布 $g_{\\lambda}(w)$ 计算的：\n$$\n\\mathbb{E}_{g_\\lambda}[Y_1(\\lambda)^2] = \\int_{-\\infty}^{\\infty} \\left[\\exp(-( \\beta + \\lambda ) w + \\kappa(\\lambda))\\right]^2 g_{\\lambda}(w) dw\n$$\n代入 $g_{\\lambda}(w) = \\exp(\\lambda w - \\kappa(\\lambda)) f(w)$：\n$$\n\\mathbb{E}_{g_\\lambda}[Y_1(\\lambda)^2] = \\int_{-\\infty}^{\\infty} \\exp(-2(\\beta + \\lambda)w + 2\\kappa(\\lambda)) \\exp(\\lambda w - \\kappa(\\lambda)) f(w) dw\n$$\n$$\n= \\exp(\\kappa(\\lambda)) \\int_{-\\infty}^{\\infty} \\exp(-(2\\beta + \\lambda)w) f(w) dw\n$$\n该积分是 $W$ 的 MGF 在 $t=-(2\\beta+\\lambda)$ 处的值，即 $M(-(2\\beta+\\lambda)) = \\exp(\\kappa(-(2\\beta+\\lambda)))$。\n$$\n\\langle Y_1(\\lambda)^2 \\rangle = \\exp(\\kappa(\\lambda)) M(-(2\\beta+\\lambda)) = \\exp(\\kappa(\\lambda) + \\kappa(-(2\\beta+\\lambda)))\n$$\n单个样本估计量的方差 $V_1(\\lambda)$ 为：\n$$\nV_1(\\lambda) = \\langle Y_1(\\lambda)^2 \\rangle - Z^2 = \\exp(\\kappa(\\lambda) + \\kappa(-(2\\beta+\\lambda))) - Z^2\n$$\n其中 $Z = \\langle \\exp(-\\beta W) \\rangle = \\exp(\\kappa(-\\beta))$。\n\n### 第3部分：最优倾斜参数\n\n为了找到最小化 $V_1(\\lambda)$ 的最优倾斜参数 $\\lambda^{\\ast}$，我们需要最小化函数 $\\langle Y_1(\\lambda)^2 \\rangle = \\exp(\\kappa(\\lambda) + \\kappa(-(2\\beta+\\lambda)))$。这等价于最小化其对数 $L(\\lambda) = \\kappa(\\lambda) + \\kappa(-(2\\beta+\\lambda))$。我们通过将其关于 $\\lambda$ 的导数设为零来找到最小值：\n$$\n\\frac{dL}{d\\lambda} = \\frac{d}{d\\lambda} \\left[ \\kappa(\\lambda) + \\kappa(-(2\\beta+\\lambda)) \\right] = \\kappa'(\\lambda) + \\kappa'(-(2\\beta+\\lambda)) \\cdot (-1) = 0\n$$\n这给出了最优 $\\lambda^{\\ast}$ 的条件：\n$$\n\\kappa'(\\lambda^{\\ast}) = \\kappa'(-2\\beta-\\lambda^{\\ast})\n$$\n函数 $\\kappa(t)$ 是一个累积量生成函数。它的二阶导数 $\\kappa''(t)$ 对应于指数倾斜分布的方差，该方差必须为非负。让我们来计算它：\n$$\n\\kappa'(t) = m - \\frac{s_{-} - s_{+} - 2t s_{-}s_{+}}{1 + t(s_{-} - s_{+}) - t^2 s_{-} s_{+}}\n$$\n$$\n\\kappa''(t) = \\frac{d}{dt} \\left( m - \\frac{s_{-} - s_{+} - 2t s_{-}s_{+}}{P(t)} \\right) = - \\frac{-2s_{-}s_{+}P(t) - (s_{-} - s_{+} - 2t s_{-}s_{+})P'(t)}{P(t)^2}\n$$\n设 $P(t) = (1+ts_{-})(1-ts_{+})$ 和 $P'(t) = s_{-} - s_{+} - 2t s_{-}s_{+}$，我们得到：\n$$\n\\kappa''(t) = \\frac{2s_{-}s_{+}(1+ts_{-})(1-ts_{+}) + (s_{-} - s_{+} - 2t s_{-}s_{+})^2}{((1+ts_{-})(1-ts_{+}))^2}\n$$\n在收敛域 $t \\in (-1/s_{-}, 1/s_{+})$ 内，分母为正。分子是一个正项 $2s_{-}s_{+}(...)$ 和一个非负平方项的和。因此，对于定义域内的所有 $t$，$\\kappa''(t)>0$。这表明 $\\kappa(t)$ 是一个严格凸函数。\n严格凸性的一个推论是其导数 $\\kappa'(t)$ 是一个严格递增函数。对于严格递增函数，等式 $\\kappa'(a) = \\kappa'(b)$ 成立当且仅当 $a=b$。\n将此应用于我们的条件 $\\kappa'(\\lambda^{\\ast}) = \\kappa'(-2\\beta-\\lambda^{\\ast})$，我们必须有：\n$$\n\\lambda^{\\ast} = -2\\beta - \\lambda^{\\ast}\n$$\n$$\n2\\lambda^{\\ast} = -2\\beta\n$$\n$$\n\\lambda^{\\ast} = -\\beta\n$$\n如果此解位于方差为有限的定义域内，那么它就是容许的。方差涉及 $\\kappa(\\lambda)$ 和 $\\kappa(-2\\beta-\\lambda)$。它们的自变量必须在 $(-1/s_{-}, 1/s_{+})$ 内。\n对于 $\\lambda = -\\beta$：\n1. $-\\beta \\in (-1/s_{-}, 1/s_{+})$ 要求 $\\beta  1/s_{-}$。这是 Jarzynski 平均本身存在的条件，是问题的隐含假设。\n2. $-2\\beta-\\lambda = -2\\beta-(-\\beta) = -\\beta$。条件相同。\n因此，最优倾斜参数 $\\lambda^{\\ast}$ 是 $-\\beta$。", "answer": "$$\n\\boxed{-\\beta}\n$$", "id": "3437697"}, {"introduction": "除了方差，估计器偏差是有限样本统计力学中一个微妙但关键的问题。这个高级练习将重点从控制误差转向理解其来源，使用大偏差理论这一强大框架来分析 Jarzynski 估计器的偏差 [@problem_id:3437752]。通过将偏差与功分布的尾部行为及有限的样本量联系起来，您将对从非平衡模拟中提取平衡信息的根本挑战获得深刻的理论洞察。", "problem": "考虑一个驱动的分子系统，其演化轨迹长度为 $n$（例如，时间步数或与系统大小成正比的广延量）。设在协议过程中所做的随机功 $W_n$ 是广延的，并定义单位轨迹长度的功为 $w = W_n / n$。假设随机变量 $w$ 的序列满足大偏差原理，其速率函数 $I(w)$ 是严格凸且连续可微的，因此当 $n \\to \\infty$ 时，$w$ 的概率密度 $p_n(w)$ 服从 $p_n(w) \\asymp \\exp(-n I(w))$。令 $\\beta  0$ 表示逆温度。\n\n根据 Jarzynski 等式，单位轨迹长度的平衡自由能差为 $f_{\\mathrm{eq}} = \\Delta F_n / n$，其中 $\\exp(-\\beta \\Delta F_n) = \\mathbb{E}[\\exp(-\\beta W_n)]$。给定 $W_n$ 的 $N$ 个独立同分布样本 $\\{W_n^{(i)}\\}_{i=1}^{N}$，可以构建有限样本 Jarzynski 估计量\n$$\nf_N \\equiv -\\frac{1}{\\beta n} \\ln\\left(\\frac{1}{N} \\sum_{i=1}^{N} \\exp(-\\beta W_n^{(i)})\\right).\n$$\n假设样本大小随轨迹长度指数增长，$N = \\exp(\\gamma n)$，其中 $\\gamma  0$ 是一个与 $n$ 无关的常数。从大偏差原理和拉普拉斯（鞍点）方法的第一性原理出发，分析当 $n \\to \\infty$ 时估计量 $f_N$ 相对于 $f_{\\mathrm{eq}}$ 的主阶渐近偏差，并通过 $I(w)$ 将其与 $p_n(w)$ 的尾部行为联系起来。\n\n在你的分析中，你可以使用以下信息：拉普拉斯原理通过最小化作用量 $I(w) + \\beta w$ 来计算 $\\mathbb{E}[\\exp(-\\beta W_n)]$；$N$ 个样本中 $w$ 的典型最小值由大偏差尾部控制。\n\n定义 $w_J$ 为 $I'(w_J) + \\beta = 0$ 的唯一解，定义 $m_{\\gamma}$ 为满足 $I(m_{\\gamma}) = \\gamma$ 的唯一值。将最终答案表示为主阶无量纲偏差\n$$\nb_{\\beta} \\equiv \\beta\\left(\\mathbb{E}[f_N] - f_{\\mathrm{eq}}\\right),\n$$\n形式为一个仅包含 $\\beta$、$\\gamma$、$I(w_J)$、$w_J$ 和 $m_{\\gamma}$ 的单一闭式解析表达式。无需进行数值计算，最终表达式中不应包含任何单位。", "solution": "该问题要求解有限样本 Jarzynski 估计量 $f_N$ 相对于单位轨迹长度的平衡自由能差 $f_{\\mathrm{eq}}$ 的主阶渐近偏差。该偏差定义为 $b_{\\beta} \\equiv \\beta\\left(\\mathbb{E}[f_N] - f_{\\mathrm{eq}}\\right)$。我们将在轨迹长度 $n \\to \\infty$ 且样本大小 $N$ 按 $N = \\exp(\\gamma n)$ 缩放的极限下确定此偏差。\n\n我们的方法包括两个主要部分。首先，我们将利用给定的大偏差原理和 Jarzynski 等式的定义来确定真实自由能密度 $f_{\\mathrm{eq}}$ 的渐近值。其次，我们将通过分析估计量在 $n$ 和 $N$ 较大时的行为，来确定其期望 $\\mathbb{E}[f_N]$ 的渐近值。这两个量之差将给出我们所求的偏差。\n\n**第一部分：真实自由能密度 $f_{\\mathrm{eq}}$ 的渐近值**\n\n单位轨迹长度的平衡自由能差由 $f_{\\mathrm{eq}} = \\Delta F_n / n$ 给出。Jarzynski 等式将 $\\Delta F_n$ 与随机功 $W_n$ 联系起来：\n$$\n\\exp(-\\beta \\Delta F_n) = \\mathbb{E}[\\exp(-\\beta W_n)]\n$$\n使用强度变量 $f_{\\mathrm{eq}}$ 和 $w = W_n/n$，上式可以改写为：\n$$\n\\exp(-\\beta n f_{\\mathrm{eq}}) = \\mathbb{E}[\\exp(-\\beta n w)]\n$$\n取对数并除以 $-\\beta n$，我们得到：\n$$\nf_{\\mathrm{eq}} = -\\frac{1}{\\beta n} \\ln\\left(\\mathbb{E}[\\exp(-\\beta n w)]\\right)\n$$\n该期望是关于单位长度功 $w$ 的概率密度 $p_n(w)$ 的积分：\n$$\n\\mathbb{E}[\\exp(-\\beta n w)] = \\int p_n(w) \\exp(-\\beta n w) dw\n$$\n问题陈述了 $w$ 满足一个速率函数为 $I(w)$ 的大偏差原理，使得对于较大的 $n$，$p_n(w) \\asymp \\exp(-n I(w))$。将此代入积分：\n$$\n\\mathbb{E}[\\exp(-\\beta n w)] \\asymp \\int \\exp(-n I(w)) \\exp(-\\beta n w) dw = \\int \\exp(-n(I(w) + \\beta w)) dw\n$$\n这个积分是拉普拉斯积分的形式。对于较大的 $n$，其值由指数部分 $\\phi(w) = I(w) + \\beta w$ 的最小值主导。由于 $I(w)$ 是严格凸的，$\\phi(w)$ 也是严格凸的，并有唯一的最小值。问题将此最小值的位置定义为 $w_J$，它满足条件 $\\phi'(w_J) = I'(w_J) + \\beta = 0$。\n\n根据拉普拉斯方法（或者，更正式地，根据大偏差理论中的 Varadhan 引理），我们有：\n$$\n\\lim_{n \\to \\infty} \\frac{1}{n} \\ln \\mathbb{E}[\\exp(-\\beta n w)] = - \\inf_{w} (I(w) + \\beta w) = -(I(w_J) + \\beta w_J)\n$$\n现在我们可以求出 $f_{\\mathrm{eq}}$ 的极限：\n$$\n\\lim_{n \\to \\infty} f_{\\mathrm{eq}} = \\lim_{n \\to \\infty} -\\frac{1}{\\beta n} \\ln\\left(\\mathbb{E}[\\exp(-\\beta n w)]\\right) = -\\frac{1}{\\beta}\\left[-(I(w_J) + \\beta w_J)\\right] = \\frac{I(w_J)}{\\beta} + w_J\n$$\n这就是真实自由能密度的渐近值。\n\n**第二部分：期望估计量 $\\mathbb{E}[f_N]$ 的渐近值**\n\n有限样本 Jarzynski 估计量定义为：\n$$\nf_N = -\\frac{1}{\\beta n} \\ln\\left(\\frac{1}{N} \\sum_{i=1}^{N} \\exp(-\\beta W_n^{(i)})\\right)\n$$\n使用 $W_n^{(i)} = n w^{(i)}$ 和 $N = \\exp(\\gamma n)$，我们可以将其改写为：\n$$\nf_N = -\\frac{1}{\\beta n} \\ln\\left(\\frac{1}{\\exp(\\gamma n)} \\sum_{i=1}^{N} \\exp(-\\beta n w^{(i)})\\right) = -\\frac{1}{\\beta n} \\left[\\ln\\left(\\sum_{i=1}^{N} \\exp(-\\beta n w^{(i)})\\right) - \\gamma n\\right] = \\frac{\\gamma}{\\beta} - \\frac{1}{\\beta n} \\ln\\left(\\sum_{i=1}^{N} \\exp(-\\beta n w^{(i)})\\right)\n$$\n求和项 $\\sum_{i=1}^{N} \\exp(-\\beta n w^{(i)})$ 由正项组成。对于较大的 $n$，指数函数 $\\exp(-\\beta n w)$ 对 $w$ 的值极其敏感。该和将由 $w^{(i)}$ 最小的单项，即 $w_{\\min} = \\min_{1 \\le i \\le N} \\{w^{(i)}\\}$，绝对主导。所有其他项相比之下都可以忽略不计。因此，我们可以用其最大项来近似这个和：\n$$\n\\sum_{i=1}^{N} \\exp(-\\beta n w^{(i)}) \\asymp \\exp(-\\beta n w_{\\min})\n$$\n将此近似代入 $f_N$ 的表达式中：\n$$\nf_N \\approx \\frac{\\gamma}{\\beta} - \\frac{1}{\\beta n} \\ln\\left(\\exp(-\\beta n w_{\\min})\\right) = \\frac{\\gamma}{\\beta} - \\frac{-\\beta n w_{\\min}}{\\beta n} = \\frac{\\gamma}{\\beta} + w_{\\min}\n$$\n现在，我们需要计算期望 $\\mathbb{E}[f_N]$。在 $n$ 很大的极限下，这变为：\n$$\n\\lim_{n \\to \\infty} \\mathbb{E}[f_N] \\approx \\lim_{n \\to \\infty} \\mathbb{E}\\left[\\frac{\\gamma}{\\beta} + w_{\\min}\\right] = \\frac{\\gamma}{\\beta} + \\lim_{n \\to \\infty} \\mathbb{E}[w_{\\min}]\n$$\n为了找到 $\\mathbb{E}[w_{\\min}]$ 的行为，我们分析 $N$ 个独立同分布样本的最小值的统计特性。观察到功值处于左尾 $w  x$ 的概率由大偏差原理给出，为 $P(w  x) \\asymp \\exp(-nI(x))$。$N$ 个样本的最小值的典型值 $\\hat{w}_{\\min}$ 可以通过小于该值的样本期望数为 1 的量级这一条件来估计：$N \\cdot P(w  \\hat{w}_{\\min}) \\approx 1$。\n使用 $N = \\exp(\\gamma n)$ 和大偏差原理（LDP），我们得到：\n$$\n\\exp(\\gamma n) \\cdot \\exp(-n I(\\hat{w}_{\\min})) \\approx 1 \\implies \\exp(n(\\gamma-I(\\hat{w}_{\\min}))) \\approx 1\n$$\n这意味着 $\\gamma \\approx I(\\hat{w}_{\\min})$。问题将 $m_{\\gamma}$ 定义为满足 $I(m_{\\gamma}) = \\gamma$ 的唯一值。因此，最小值的典型值是 $m_{\\gamma}$。对于较大的 $n$，$w_{\\min}$ 的分布尖锐地集中在这个值附近，因此我们可以在极限情况下将其期望等同于这个典型值：\n$$\n\\lim_{n \\to \\infty} \\mathbb{E}[w_{\\min}] = m_{\\gamma}\n$$\n因此，期望估计量的渐近值为：\n$$\n\\lim_{n \\to \\infty} \\mathbb{E}[f_N] = \\frac{\\gamma}{\\beta} + m_{\\gamma}\n$$\n\n**第三部分：主阶渐近偏差**\n\n主阶渐近偏差是当 $n \\to \\infty$ 时 $b_{\\beta} = \\beta(\\mathbb{E}[f_N] - f_{\\mathrm{eq}})$ 的极限。使用第一部分和第二部分的结果：\n$$\n\\lim_{n \\to \\infty} b_{\\beta} = \\beta \\left( \\lim_{n \\to \\infty} \\mathbb{E}[f_N] - \\lim_{n \\to \\infty} f_{\\mathrm{eq}} \\right)\n$$\n$$\n\\lim_{n \\to \\infty} b_{\\beta} = \\beta \\left[ \\left(\\frac{\\gamma}{\\beta} + m_{\\gamma}\\right) - \\left(\\frac{I(w_J)}{\\beta} + w_J\\right) \\right]\n$$\n分配 $\\beta$ 因子：\n$$\n\\lim_{n \\to \\infty} b_{\\beta} = (\\gamma + \\beta m_{\\gamma}) - (I(w_J) + \\beta w_J)\n$$\n这是主阶渐近偏差的最终表达式，用给定的量表示。", "answer": "$$\n\\boxed{\\gamma + \\beta m_{\\gamma} - (I(w_J) + \\beta w_J)}\n$$", "id": "3437752"}]}