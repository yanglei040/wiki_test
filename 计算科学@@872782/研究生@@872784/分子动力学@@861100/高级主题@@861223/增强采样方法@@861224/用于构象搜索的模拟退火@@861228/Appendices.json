{"hands_on_practices": [{"introduction": "模拟退火的有效性在很大程度上取决于精心设计的温度方案。温度过低会使系统陷入局部最小值，而温度过高则会导致搜索效率低下，接近于随机漫步。本练习 ([@problem_id:3445992]) 为这一挑战提供了定量的解决方法。你将计算出以特定概率跨越某个能量垒所需的精确温度，从而将温度这一抽象概念与构象采样的具体目标直接联系起来。", "problem": "一个模型肽有三个侧链二面角，其旋转异构态之间的转变主要由扭转势垒决定。势垒高度定义为相对于当前旋转异构体能量极小值达到过渡态所需的能量增量，测量值为 $\\Delta E_{\\chi_1} = 12 \\ \\mathrm{kJ/mol}$，$\\Delta E_{\\chi_2} = 18 \\ \\mathrm{kJ/mol}$，以及 $\\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol}$。考虑一个用于分子动力学中构象搜索的模拟退火方案，该方案采用Metropolis接受准则，并对二面角旋转使用对称提议。\n\n使用以下基本原理：\n- 在温度$T$下，对于一个使能量增加$\\Delta U$的提议移动，其Metropolis接受概率为$p_{\\mathrm{acc}} = \\exp(-\\Delta U/(k_B T))$，其中$k_B$是玻尔兹曼常数。\n- 当势垒高度以每摩尔为单位指定时，相关的热因子是摩尔气体常数$R$，定义为$R = N_A k_B$，因此穿越摩尔势垒$\\Delta E$的接受概率为$p(T) = \\exp(-\\Delta E/(R T))$。\n- 对于在固定温度下$N$个统计独立的提议，每个提议的成功概率为$p(T)$，则在该批次中至少有一次成功穿越的概率为$P_{\\mathrm{block}} = 1 - (1 - p(T))^{N}$。\n\n假设在一批$N = 100$个提议中，在固定温度$T$下跨越势垒的提议是相互独立的，这是一个合理的近似。对于每个势垒$\\Delta E_{\\chi_i}$，计算在$N = 100$个提议中至少穿越一次势垒的概率满足$P_{\\mathrm{block}} = 0.10$时的温度$T_i$。然后，设计一个几何降温方案$T_k = T_0 \\alpha^k$（其中$0  \\alpha  1$且$k$为整数，$k \\geq 0$），该方案从足以访问最高势垒的温度$T_0$开始，然后分阶段降低温度，以便在骤冷前能够访问与$\\chi_2$和$\\chi_1$相关的所有旋转异构体。\n\n最后，确定最低初始温度$T_0$（以开尔文为单位），该温度保证在$N = 100$个提议中以$P_{\\mathrm{block}} = 0.10$的概率穿越最高势垒$\\Delta E_{\\chi_3}$。将最终的$T_0$以开尔文表示，并将答案四舍五入至四位有效数字。", "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤1：提取已知条件\n从问题陈述中逐字提取的已知条件如下：\n-   肽侧链扭转势垒高度：$\\Delta E_{\\chi_1} = 12 \\ \\mathrm{kJ/mol}$，$\\Delta E_{\\chi_2} = 18 \\ \\mathrm{kJ/mol}$，以及 $\\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol}$。\n-   该方案是使用Metropolis接受准则的模拟退火。\n-   在温度$T$下能量增加$\\Delta U$的Metropolis接受概率：$p_{\\mathrm{acc}} = \\exp(-\\Delta U/(k_B T))$。\n-   玻尔兹曼常数记为$k_B$。\n-   摩尔势垒$\\Delta E$的接受概率：$p(T) = \\exp(-\\Delta E/(R T))$，其中摩尔气体常数$R = N_A k_B$。\n-   一批次中统计独立的提议数量：$N = 100$。\n-   在一批$N$个提议中至少有一次成功穿越的概率：$P_{\\mathrm{block}} = 1 - (1 - p(T))^{N}$。\n-   至少穿越一次的目标概率：$P_{\\mathrm{block}} = 0.10$。\n-   几何降温方案形式：$T_k = T_0 \\alpha^k$，其中$0  \\alpha  1$且$k$为整数，$k \\geq 0$。\n-   目标：确定穿越最高势垒$\\Delta E_{\\chi_3}$的最低初始温度$T_0$（以开尔文为单位），使其在$P_{\\mathrm{block}} = 0.10$的概率下被穿越，结果四舍五入至四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n评估问题的有效性：\n-   **科学依据**：该问题牢固地植根于统计力学和计算化学的原理。扭转能垒、模拟退火、Metropolis-Hastings算法和玻尔兹曼分布等概念是分子动力学和构象分析的基石。所有提供的方程和原理都是标准且正确的。\n-   **良态问题**：该问题是良态的。它提供了一个明确的目标（计算$T_0$），并包含了所有必要的数学关系和数值，以得出一个唯一且有意义的解。所提供的关于完整降温方案的背景信息用于定义$T_0$的角色，但并未引入歧义，因为最终任务是明确孤立的。\n-   **客观性**：问题以精确、定量且无偏见的语言陈述。\n-   **一致性与完整性**：问题是自洽且内部一致的。尽管没有明确给出摩尔气体常数$R$的值，但它是一个普适物理常数，在此类问题中使用它是标准做法。该问题不包含相互矛盾的约束条件。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。这是一个物理化学或生物物理学中的标准、定义明确的问题。现在将推导完整的解答。\n\n主要目标是确定模拟退火方案的初始温度$T_0$。这个温度必须足够高，以允许系统以指定的概率克服最高的能量势垒$\\Delta E_{\\chi_3}$。条件是在一批$N=100$个提议中至少有一次成功穿越的概率为$P_{\\mathrm{block}} = 0.10$。\n\n至少有一次成功穿越的概率$P_{\\mathrm{block}}$与单次尝试成功概率$p(T)$通过给定公式相关联：\n$$P_{\\mathrm{block}} = 1 - (1 - p(T))^{N}$$\n\n给定$P_{\\mathrm{block}} = 0.10$和$N = 100$。我们可以重排此方程以求解所需的单次尝试概率$p(T_0)$：\n$$1 - P_{\\mathrm{block}} = (1 - p(T_0))^{N}$$\n$$(1 - P_{\\mathrm{block}})^{1/N} = 1 - p(T_0)$$\n$$p(T_0) = 1 - (1 - P_{\\mathrm{block}})^{1/N}$$\n\n根据Metropolis准则，接受一个使能量增加势垒高度$\\Delta E$的移动的单次尝试概率（适用于摩尔能量）为：\n$$p(T) = \\exp\\left(-\\frac{\\Delta E}{R T}\\right)$$\n\n将$p(T_0)$的两个表达式相等，我们得到：\n$$\\exp\\left(-\\frac{\\Delta E}{R T_0}\\right) = 1 - (1 - P_{\\mathrm{block}})^{1/N}$$\n\n为了求解$T_0$，我们对两边取自然对数：\n$$-\\frac{\\Delta E}{R T_0} = \\ln\\left(1 - (1 - P_{\\mathrm{block}})^{1/N}\\right)$$\n\n最后，我们分离出$T_0$：\n$$T_0 = -\\frac{\\Delta E}{R \\ln\\left(1 - (1 - P_{\\mathrm{block}})^{1/N}\\right)}$$\n\n这是穿越势垒$\\Delta E$所需温度的通用公式。问题指定$T_0$是初始温度，其设计旨在足够高以穿越最高的能量势垒，即$\\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol}$。\n\n我们将给定值代入这个推导出的表达式中：\n-   $\\Delta E = \\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol} = 2.5 \\times 10^4 \\ \\mathrm{J/mol}$\n-   $N = 100$\n-   $P_{\\mathrm{block}} = 0.10$\n-   摩尔气体常数$R$是一个基本常数。我们将使用其CODATA值，$R \\approx 8.314462618 \\ \\mathrm{J \\cdot mol^{-1} \\cdot K^{-1}}$。\n\n$T_0$的表达式变为：\n$$T_0 = -\\frac{2.5 \\times 10^4}{R \\ln\\left(1 - (1 - 0.10)^{1/100}\\right)}$$\n$$T_0 = -\\frac{2.5 \\times 10^4}{R \\ln\\left(1 - (0.9)^{0.01}\\right)}$$\n\n现在，我们进行数值计算。\n首先，计算对数中的项：\n$$(0.9)^{0.01} \\approx 0.99894709$$\n$$1 - (0.9)^{0.01} \\approx 1 - 0.99894709 = 0.00105291$$\n该值的自然对数是：\n$$\\ln(0.00105291) \\approx -6.85549$$\n将此值代入$T_0$的方程中：\n$$T_0 = -\\frac{2.5 \\times 10^4 \\ \\mathrm{J/mol}}{8.31446 \\ \\mathrm{J \\cdot mol^{-1} \\cdot K^{-1}} \\times (-6.85549)}$$\n$$T_0 = \\frac{2.5 \\times 10^4}{8.31446 \\times 6.85549} \\ \\mathrm{K}$$\n$$T_0 = \\frac{2.5 \\times 10^4}{56.9935} \\ \\mathrm{K}$$\n$$T_0 \\approx 438.647 \\ \\mathrm{K}$$\n\n问题要求答案四舍五入到四位有效数字。\n$$T_0 \\approx 438.6 \\ \\mathrm{K}$$\n这是模拟退火方案所需的最低初始温度，以确保最高的构象势垒能够以指定的概率被穿越。", "answer": "$$\\boxed{438.6}$$", "id": "3445992"}, {"introduction": "现实世界中的科学计算总是受到有限计算资源的制约。在进行构象搜索时，这一限制迫使我们做出战略选择：是应该投入资源进行少数几次长时间、深度的退火模拟，还是进行大量短时间、独立的模拟？这个实践问题 ([@problem_id:3445986]) 直面了这一挑战。通过运用数学优化方法，你将学会如何确定重启次数和单次运行时长之间的最佳资源分配，以最大化找到全局最小值的总概率。", "problem": "在分子动力学（MD）中使用模拟退火（SA）的构象搜索工作流中，您有一个固定的总计算预算 $B$（以基本积分步为单位），需要将其分配给 $R$ 次独立的SA重启和每次重启的退火长度 $L$。每次重启都会产生 $L_{0}$ 步的确定性初始化开销（用于恒温器重新初始化、速度随机化和局部最小化），之后使用 $L$ 步进行退火方案。因此，资源约束为 $R(L + L_{0}) = B$。假设重启是统计独立的，并且单次重启成功概率（在长度为 $L$ 的单次重启中发现真正的全局最小值）的经验表征为\n$$\np(L) = 1 - \\exp\\!\\big(-a\\, L^{\\beta}\\big),\n$$\n其中 $a > 0$ 和 $0  \\beta  1$ 是描述依赖于势能面的动力学的常数。仅使用重启的独立性和预算约束，从第一性原理出发，推导出在预算 $B$ 内最大化至少有一次成功概率的分配 $(R,L)$，然后评估在特定参数 $B = 2.5 \\times 10^{6}$、$L_{0} = 2.0 \\times 10^{3}$、$a = 7.5 \\times 10^{-4}$ 和 $\\beta = \\tfrac{1}{2}$ 下的最优重启次数。请以精确整数形式表示您的最终答案，该整数等于在这些参数下由连续最优点所隐含的最优重启次数 $R^{\\star}$（假设对于所提供的数据，$R^{\\star}$ 恰好是一个整数）。最终答案無需单位。不要四舍五入；报告精确整数。", "solution": "用户要求我解决以下问题：\n在分子动力学（MD）中使用模拟退火（SA）的构象搜索工作流中，您有一个固定的总计算预算 $B$（以基本积分步为单位），需要将其分配给 $R$ 次独立的SA重启和每次重启的退火长度 $L$。每次重启都会产生 $L_{0}$ 步的确定性初始化开销（用于恒温器重新初始化、速度随机化和局部最小化），之后使用 $L$ 步进行退火方案。因此，资源约束为 $R(L + L_{0}) = B$。假设重启是统计独立的，并且单次重启成功概率（在长度为 $L$ 的单次重启中发现真正的全局最小值）的经验表征为\n$$\np(L) = 1 - \\exp\\!\\big(-a\\, L^{\\beta}\\big),\n$$\n其中 $a > 0$ 和 $0  \\beta  1$ 是描述依赖于势能面的动力学的常数。仅使用重启的独立性和预算约束，从第一性原理出发，推导出在预算 $B$ 内最大化至少有一次成功概率的分配 $(R,L)$，然后评估在特定参数 $B = 2.5 \\times 10^{6}$、$L_{0} = 2.0 \\times 10^{3}$、$a = 7.5 \\times 10^{-4}$ 和 $\\beta = \\tfrac{1}{2}$ 下的最优重启次数。请以精确整数形式表示您的最终答案，该整数等于在这些参数下由连续最优点所隐含的最优重启次数 $R^{\\star}$（假设对于所提供的数据，$R^{\\star}$ 恰好是一个整数）。最终答案無需单位。不要四舍五入；报告精确整数。\n\n### 第1步：提取已知条件\n-   总计算预算: $B$\n-   独立模拟退火重启次数: $R$\n-   每次重启的退火长度: $L$\n-   每次重启的初始化开销: $L_0$\n-   预算约束: $R(L + L_0) = B$\n-   单次重启成功概率: $p(L) = 1 - \\exp(-a L^{\\beta})$\n-   常数: $a > 0$, $0  \\beta  1$\n-   特定参数值: $B = 2.5 \\times 10^{6}$, $L_0 = 2.0 \\times 10^{3}$, $a = 7.5 \\times 10^{-4}$, $\\beta = \\frac{1}{2}$\n\n### 第2步：使用提取的已知条件进行验证\n该问题在计算化学和优化理论领域具有科学依据。模拟退火是寻找全局最小值的标准启发式方法。该问题描述了在固定计算预算下，独立搜索次数 ($R$) 与每次搜索长度 ($L$) 之间的现实权衡。成功概率 $p(L)$ 的函数形式是一个合理的经验模型。问题是自洽的，提供了所有必要的数据和约束。语言精确且客观。没有矛盾、歧义或违反科学原理的地方。\n\n### 第3步：结论与行动\n问题有效。将提供一个完整的、有理有据的解决方案。\n\n### 解题推导\n\n目标是最大化在 $R$ 次独立重启中至少成功一次的概率。长度为 $L$ 的单次重启的成功概率由 $p(L) = 1 - \\exp(-a L^{\\beta})$ 给出。因此，单次重启的失败概率为 $1 - p(L) = \\exp(-a L^{\\beta})$。\n\n由于 $R$ 次重启在统计上是独立的，所有 $R$ 次重启都失败的概率是它们各自失败概率的乘积：\n$$\nP_{\\text{all fail}} = (1 - p(L))^R = \\left( \\exp(-a L^{\\beta}) \\right)^R = \\exp(-R a L^{\\beta})\n$$\n至少有一次成功的概率 $P_{\\text{success}}$ 是所有重启都失败的互补事件：\n$$\nP_{\\text{success}}(R,L) = 1 - P_{\\text{all fail}} = 1 - \\exp(-R a L^{\\beta})\n$$\n为了最大化 $P_{\\text{success}}$，我们必须最大化指数项的参数 $R a L^{\\beta}$。由于 $a$ 是一个正常数，这等效于在预算约束 $R(L + L_0) = B$ 下最大化函数 $f(R,L) = R L^{\\beta}$。\n\n对于此优化问题，我们将 $R$ 和 $L$ 视为连续正变量。该约束可用于用一个变量表示另一个变量。让我们将 $L$ 表示为 $R$ 的函数：\n$$\nL(R) = \\frac{B}{R} - L_0\n$$\n对于一个有物理意义的退火过程，我们必须有 $L > 0$，这意味着 $\\frac{B}{R} > L_0$，或者 $R  \\frac{B}{L_0}$。\n\n现在我们可以将待最大化的函数写成单变量 $R$ 的形式：\n$$\nf(R) = R \\left( \\frac{B}{R} - L_0 \\right)^{\\beta}\n$$\n为了找到最优重启次数 $R^{\\star}$，我们对 $f(R)$ 关于 $R$ 求导，并令导数为零。我们使用乘法法则进行微分，$\\frac{d}{dR}(uv) = u \\frac{dv}{dR} + v \\frac{du}{dR}$。令 $u(R) = R$ 且 $v(R) = (\\frac{B}{R} - L_0)^{\\beta}$。\n$$\n\\frac{du}{dR} = 1\n$$\n$$\n\\frac{dv}{dR} = \\beta \\left( \\frac{B}{R} - L_0 \\right)^{\\beta - 1} \\cdot \\left( -\\frac{B}{R^2} \\right)\n$$\n$f(R)$ 的导数为：\n$$\n\\frac{df}{dR} = (1) \\cdot \\left( \\frac{B}{R} - L_0 \\right)^{\\beta} + R \\cdot \\left[ \\beta \\left( \\frac{B}{R} - L_0 \\right)^{\\beta - 1} \\left( -\\frac{B}{R^2} \\right) \\right]\n$$\n令 $\\frac{df}{dR} = 0$ 以找到极值：\n$$\n\\left( \\frac{B}{R} - L_0 \\right)^{\\beta} - \\frac{\\beta B}{R} \\left( \\frac{B}{R} - L_0 \\right)^{\\beta - 1} = 0\n$$\n由于 $L = \\frac{B}{R} - L_0 > 0$，我们可以将方程两边同除以 $(\\frac{B}{R} - L_0)^{\\beta - 1}$：\n$$\n\\left( \\frac{B}{R} - L_0 \\right) - \\frac{\\beta B}{R} = 0\n$$\n整理各项以求解 $R$：\n$$\n\\frac{B}{R} - \\frac{\\beta B}{R} = L_0\n$$\n$$\n\\frac{B}{R} (1 - \\beta) = L_0\n$$\n这就得到了最优重启次数 $R^{\\star}$：\n$$\nR^{\\star} = \\frac{B(1 - \\beta)}{L_0}\n$$\n这个表达式给出了最优重启次数 $R^{\\star}$ 作为预算 $B$、开销 $L_0$ 和动力学参数 $\\beta$ 的函数。值得注意的是，最优分配与参数 $a$ 无关。\n\n现在，我们代入给定的数值以求出 $R^{\\star}$ 的具体值：\n-   $B = 2.5 \\times 10^6$\n-   $L_0 = 2.0 \\times 10^3$\n-   $\\beta = \\frac{1}{2}$\n\n$$\nR^{\\star} = \\frac{(2.5 \\times 10^6) \\left(1 - \\frac{1}{2}\\right)}{2.0 \\times 10^3}\n$$\n$$\nR^{\\star} = \\frac{(2.5 \\times 10^6) \\left(\\frac{1}{2}\\right)}{2.0 \\times 10^3}\n$$\n$$\nR^{\\star} = \\frac{1.25 \\times 10^6}{2.0 \\times 10^3}\n$$\n$$\nR^{\\star} = \\frac{1.25}{2.0} \\times 10^{6-3}\n$$\n$$\nR^{\\star} = 0.625 \\times 10^3\n$$\n$$\nR^{\\star} = 625\n$$\n问题陈述假设 $R^{\\star}$ 是一个整数，我们的计算结果恰好是 $625$。因此，最优重启次数是 $625$。", "answer": "$$\\boxed{625}$$", "id": "3445986"}, {"introduction": "现在，我们从理想化的能量景观转向更复杂、更现实的场景，在这些场景中，实验数据被用来指导搜索。这些数据通常以约束的形式加入，但有时可能会偏向于错误的、动力学上被捕获的非天然状态，而不是真正的全局最小值。这个编程练习 ([@problem_id:3446033]) 模拟了这一关键竞争。你将实现一个包含两个竞争过程的模拟——向天然态的全局重排与对误导性约束的“过度承诺”——从而理解冷却和约束方案如何导致动力学陷阱，这是实际应用中一个常见的陷阱。", "problem": "考虑一个正在进行模拟退火的大分子的一维粗粒化构象坐标 $x \\in \\mathbb{R}$。构型能量建模为\n$$\nU(x,t) = U_0(x) + w(t)R(x)\n$$,\n其中 $U_0(x)$ 是一个表示全局盆地的天然双阱势，$R(x)$ 是一个编码了含噪声的实验约束的二次约束。天然双阱势为\n$$\nU_0(x) = a(x^2 - 1)^2 + \\delta x\n$$,\n其中 $a>0$，还有一个小的倾斜 $\\delta  0$，这使得 $x\\approx -1$ 成为能量较低的全局盆地，而 $x\\approx +1$ 成为能量较高的非天然盆地。约束为\n$$\nR(x) = (x - x_r)^2\n$$,\n其目标 $x_r$ 位于非天然盆地 $x_r = +1$ 处，这是为了有意模拟一个偏向错误盆地的含噪声或错误分配的约束。\n\n模拟退火的温度方案是指数型的，\n$$\nT(t) = T_0\\exp\\left(-\\frac{t}{\\tau_{\\text{cool}}}\\right)\n$$,\n其中 $T_0>0$ 是初始温度，$\\tau_{\\text{cool}}>0$ 是冷却时间尺度。约束权重 $w(t)$ 随时间收紧，遵循\n$$\nw(t) = w_0 + b_w\\left( 1 - \\exp\\left(-\\frac{t}{\\tau_{\\text{rest}}}\\right)\\right)\n$$,\n其中 $w_0\\ge 0$ 是初始权重，$b_w>0$ 是总增量，$\\tau_{\\text{rest}}>0$ 是约束收紧的时间尺度。这种同步收紧是实际方案中的一个常见特征。\n\n我们对两个过程之间的竞争进行建模：\n- 从约束偏向的非天然盆地到全局盆地的重排，其瞬时速率为\n$$\nk_{\\text{rearr}}(t) = \\nu_r \\exp\\left(-\\frac{\\Delta E_{\\text{eff}}(t)}{T(t)}\\right)\n$$,\n其中 $\\nu_r>0$ 是尝试频率，$\\Delta E_{\\text{eff}}(t)$ 是在当前约束权重下，从非天然盆地 $x\\approx +1$ 到鞍点 $x\\approx 0$ 的有效势垒，\n$$\n\\Delta E_{\\text{eff}}(t) = \\big[U_0(0) - U_0(+1)\\big] + w(t)\\big[R(0) - R(+1)\\big]\n$$.\n- 在非天然盆地内过度满足含噪声约束，表示为一个具有瞬时速率的竞争事件\n$$\nk_{\\text{commit}}(t) = c w(t)\n$$,\n其中 $c>0$ 是一个比例常数，反映了随着约束收紧，局部弛豫加快。该项捕捉了收紧含噪声的约束如何将轨迹锁定在错误的盆地中。\n\n假设这两个过程是独立的竞争指数时钟。那么，在时间 $t=N$（以离散的蒙特卡洛步长为单位，此处视为单位时间步长）之前，重排先于约束过度满足而发生的概率为\n$$\nP_{\\text{rearr}}(N) = \\int_0^N k_{\\text{rearr}}(t)\\exp\\left(-\\int_0^t \\big[k_{\\text{rearr}}(u) + k_{\\text{commit}}(u)\\big]\\,du\\right)dt\n$$.\n该表示源于竞争性非齐次泊松过程的标准性质，当关注竞争过程中首个事件发生的时间时，它为随机模拟退火动力学提供了一个易于处理的近似。\n\n您的任务是实现一个程序，对于指定的参数，通过将积分数值近似为单位时间步长的离散和来计算 $P_{\\text{rearr}}(N)$。请使用以下固定的参数，这些参数的选择在科学上是合理的且内部一致的：\n- 天然双阱势参数：$a = 20.0$，$\\delta = -0.25$。\n- 约束目标：$x_r = +1.0$。\n- 约束方案参数：$w_0 = 0.0$，$b_w = 12.0$，$\\tau_{\\text{rest}} = 200.0$。\n- 退火参数：$T_0 = 3.0$。\n- 速率：$\\nu_r = 0.3$，$c = 0.01$。\n所有量都采用无量纲的蒙特卡洛单位。时间 $t$ 和总步数 $N$ 以蒙特卡洛步长为单位进行测量。\n\n根据双阱势和约束，明确定义有效势垒的各个部分：\n- 鞍点和非天然盆地的坐标值满足 $x_{\\text{saddle}} = 0$ 和 $x_{\\text{non-native}} = +1$，因此\n$$\n\\Delta E_0 \\equiv U_0(0) - U_0(+1) = a - \\delta\n$$,\n并且\n$$\n\\Delta R \\equiv R(0) - R(+1) = (0-1)^2 - (1-1)^2 = 1\n$$.\n因此，\n$$\n\\Delta E_{\\text{eff}}(t) = \\Delta E_0 + w(t)\\Delta R = (a - \\delta) + w(t)\n$$.\n\n测试套件：\n计算以下三种情况下的 $P_{\\text{rearr}}(N)$，这些情况旨在探究冷却与重排及约束收紧的不同时间尺度机制：\n- 情况1（理想路径）：$\\tau_{\\text{cool}} = 100.0$，$N = 4000$。\n- 情况2（过慢冷却与延长方案）：$\\tau_{\\text{cool}} = 1000.0$，$N = 20000$。\n- 情况3（极速淬火）：$\\tau_{\\text{cool}} = 1.0$，$N = 4000$。\n\n对于每种情况，您的程序应将 $P_{\\text{rearr}}(N)$ 计算为一个浮点数。最终输出格式必须是单行，其中包含一个由方括号括起来的、逗号分隔的三个概率列表，例如 $[p_1,p_2,p_3]$，其中 $p_i$ 是使用标准 Python 字符串格式计算出的浮点数。无需报告物理单位，因为所有量都是无量纲的蒙特卡洛步长和约化单位的能量。\n\n您的实现必须稳健且数值稳定，使用单位时间步长的简单黎曼和离散化来处理积分：\n$$\nP_{\\text{rearr}}(N) \\approx \\sum_{t=0}^{N-1} k_{\\text{rearr}}(t)\\exp\\left(-\\sum_{u=0}^{t-1}\\big[k_{\\text{rearr}}(u)+k_{\\text{commit}}(u)\\big]\\right)\n$$.\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的、逗号分隔的结果列表（例如，$[p_1,p_2,p_3]$）。", "solution": "所提出的问题是在模拟随机过程方面一个定义明确且具有科学依据的练习，特别是在大分子构象搜索的模拟退火背景下。它自成体系，提供了所有必要的参数和函数形式，并提出了一个明确的计算任务。该模型虽然经过简化，但抓住了在探索构象空间以寻找全局能量最小值与被可能错误的外部约束所偏好的局部最小值动力学捕获之间的本质竞争。该问题是有效的，并且可以进行直接的数值求解。\n\n问题的核心是计算在总共 $N$ 步的模拟时间内，期望的构象重排在不期望的对非天然态的“过度满足”之前发生的概率 $P_{\\text{rearr}}(N)$。该场景被建模为两个独立、时间非齐次泊松过程之间的竞争。\n\n系统的总构型能量由 $U(x,t) = U_0(x) + w(t)R(x)$ 给出，其中 $x$ 是一维构象坐标。\n\n固有能量分量 $U_0(x) = a(x^2 - 1)^2 + \\delta x$ 是一个双阱势，其参数为 $a=20.0$ 和 $\\delta=-0.25$。负的倾斜 $\\delta$ 使得 $x \\approx -1$ 附近的盆地成为全局最小值（天然态），而 $x \\approx +1$ 附近的盆地成为能量较高的局部最小值（非天然态）。\n\n约束分量为 $R(x) = (x - x_r)^2$，其目标 $x_r = +1.0$ 被有意地放置在非天然最小值处。该约束的强度由一个随时间变化的权重 $w(t) = w_0 + b_w\\left( 1 - \\exp(-t/\\tau_{\\text{rest}})\\right)$ 调节。在参数 $w_0=0.0$、$b_w=12.0$ 和 $\\tau_{\\text{rest}}=200.0$ 下，约束的强度从零开始并随时间增加，逐渐偏向不正确的盆地。\n\n模拟退火协议由一个用于温度的指数冷却方案 $T(t) = T_0\\exp(-t/\\tau_{\\text{cool}})$ 定义，其初始温度为 $T_0=3.0$。冷却时间尺度 $\\tau_{\\text{cool}}$ 在不同测试用例中有所变化。\n\n竞争发生在两个具有瞬时速率的过程之间：\n1.  从非天然态到天然态的重排，这是一个具有类阿伦尼乌斯速率的活化过程：\n    $$\n    k_{\\text{rearr}}(t) = \\nu_r \\exp\\left(-\\frac{\\Delta E_{\\text{eff}}(t)}{T(t)}\\right)\n    $$\n    这里，$\\nu_r = 0.3$ 是一个尝试频率。有效活化能垒 $\\Delta E_{\\text{eff}}(t)$ 是在当前约束影响下，鞍点 ($x \\approx 0$) 和非天然最小值 ($x \\approx +1$) 之间的能量差。问题提供了简化后的表达式：\n    $$\n    \\Delta E_{\\text{eff}}(t) = (a - \\delta) + w(t)\n    $$\n    这由 $\\Delta E_0 = U_0(0) - U_0(+1) = a - \\delta$ 和 $\\Delta R = R(0) - R(+1) = 1$ 推导得出。项 $w(t)$ 表明，收紧的约束增加了逃离非天然盆地的势垒。\n\n2.  对非天然态的过度满足，这是一个捕获过程，其速率被建模为与约束强度成正比：\n    $$\n    k_{\\text{commit}}(t) = c\\,w(t)\n    $$\n    比例常数为 $c = 0.01$。这个唯象项反映了这样一种思想：更强的约束导致更快的局部弛豫，从而有更高的几率被锁定在错误的状态。\n\n在时间 $N$ 之前，重排先于过度满足发生的概率由竞争性泊松过程中首过时间概率的标准公式给出：\n$$\nP_{\\text{rearr}}(N) = \\int_0^N k_{\\text{rearr}}(t) \\exp\\left(-\\int_0^t \\left[k_{\\text{rearr}}(u) + k_{\\text{commit}}(u)\\right] du\\right) dt\n$$\n指数项代表“存活概率”，即在时间 $t$ 之前两个事件都未发生的概率。项 $k_{\\text{rearr}}(t)$ 是重排事件在时间 $t$ 发生的概率密度。该积分将这些概率在整个区间 $[0, N]$ 上求和。\n\n任务是使用数值近似来计算这个量，其中积分被替换为大小为 $\\Delta t=1$ 的离散时间步长的和：\n$$\nP_{\\text{rearr}}(N) \\approx \\sum_{t=0}^{N-1} k_{\\text{rearr}}(t) \\exp\\left(-\\sum_{u=0}^{t-1} \\left[k_{\\text{rearr}}(u) + k_{\\text{commit}}(u)\\right]\\right)\n$$\n这个计算针对三个不同的测试用例进行，这些用例改变了 $\\tau_{\\text{cool}}$ 和 $N$。一个高效的实现应避免嵌套循环结构，因为其复杂度将为 $O(N^2)$。取而代之的是，我们可以将所有 $t \\in [0, N-1]$ 的时间相关速率预先计算为向量。设 $K(t) = k_{\\text{rearr}}(t) + k_{\\text{commit}}(t)$。内部的和 $\\sum_{u=0}^{t-1} K(u)$ 可以通过首先计算 $K(t)$ 值的向量，然后使用累加和操作来为所有 $t$ 高效地计算。最终结果则是项 $k_{\\text{rearr}}(t) \\exp(-\\sum_{u=0}^{t-1} K(u))$ 的总和。这种向量化方法的总时间复杂度为 $O(N)$，适用于指定的 $N$ 值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_prearr(tau_cool, N, a, delta, w0, bw, tau_rest, T0, nu_r, c):\n    \"\"\"\n    Computes the probability of rearrangement P_rearr(N) using numerical discretization.\n\n    Args:\n        tau_cool (float): Cooling timescale.\n        N (int): Total number of Monte Carlo steps.\n        a (float): Parameter for the native double-well potential.\n        delta (float): Tilt parameter for the native double-well potential.\n        w0 (float): Initial restraint weight.\n        bw (float): Total increase in restraint weight.\n        tau_rest (float): Restraint-tightening timescale.\n        T0 (float): Initial temperature.\n        nu_r (float): Attempt frequency for rearrangement.\n        c (float): Proportionality constant for the commitment rate.\n\n    Returns:\n        float: The calculated probability P_rearr(N).\n    \"\"\"\n    # Use float64 for better precision in numerical sums and exponents.\n    t_steps = np.arange(N, dtype=np.float64)\n\n    # Calculate time-dependent temperature and restraint weight schedules\n    T_t = T0 * np.exp(-t_steps / tau_cool)\n    w_t = w0 + bw * (1.0 - np.exp(-t_steps / tau_rest))\n\n    # Calculate the effective energy barrier\n    # delta_E_eff(t) = (a - delta) + w(t)\n    delta_E0 = a - delta\n    delta_E_eff_t = delta_E0 + w_t\n\n    # Calculate the instantaneous rates for rearrangement and commitment\n    # The argument to np.exp is negative, so overflow is not a concern.\n    # Underflow to zero is handled correctly and is physically meaningful.\n    k_rearr_t = nu_r * np.exp(-delta_E_eff_t / T_t)\n    k_commit_t = c * w_t\n\n    # Total rate of any event occurring\n    K_t = k_rearr_t + k_commit_t\n\n    # The discrete approximation for the probability is:\n    # Sum_{t=0}^{N-1} k_rearr(t) * exp(-Sum_{u=0}^{t-1} K(u))\n    # We can compute this efficiently using vectorization.\n\n    # 1. Compute the inner sum for the survival probability exponent.\n    # inner_sum_at_t corresponds to Sum_{u=0}^{t-1} K(u)\n    inner_sum = np.zeros_like(K_t)\n    # np.cumsum(K_t) at index `i` is sum up to `i`. We need sum up to `i-1`.\n    inner_sum[1:] = np.cumsum(K_t[:-1])\n\n    # 2. Compute the survival probability S(t) = exp(-inner_sum_at_t)\n    survival_prob_t = np.exp(-inner_sum)\n\n    # 3. Compute the full term to be summed at each time step t\n    # This is k_rearr(t) * S(t), which is the probability density of\n    # rearranging at time t, given no event occurred before t.\n    summand_t = k_rearr_t * survival_prob_t\n\n    # 4. Sum all terms to get the total probability over the horizon N\n    # The time step Delta_t is 1, so it's a direct sum.\n    total_prob = np.sum(summand_t)\n\n    return total_prob\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the fixed parameters from the problem statement.\n    # All quantities are in nondimensional Monte Carlo units.\n    a = 20.0\n    delta = -0.25\n    w0 = 0.0\n    bw = 12.0\n    tau_rest = 200.0\n    T0 = 3.0\n    nu_r = 0.3\n    c = 0.01\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (tau_cool, N)\n    test_cases = [\n        (100.0, 4000),   # Case 1: happy path\n        (1000.0, 20000), # Case 2: overly slow cooling with extended schedule\n        (1.0, 4000),     # Case 3: extremely fast quench\n    ]\n\n    results = []\n    for tau_cool, N in test_cases:\n        p_rearr = calculate_prearr(tau_cool, N, a, delta, w0, bw, tau_rest, T0, nu_r, c)\n        results.append(p_rearr)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3446033"}]}