{"hands_on_practices": [{"introduction": "将动能与温度联系起来的均分定理，其有效性依赖于对系统自由度的精确计数。在分子动力学模拟中，由于引入了全息约束（例如，维持刚性键长）以及为了消除整体平动和转动而移除守恒量，并非所有原子的运动都是相互独立的。这个练习将指导你从第一性原理出发，推导出在计算动力学温度时，所使用的有效二次自由度数量 $f$ 的正确表达式[@problem_id:3451703]。", "problem": "考虑一个包含 $N$ 个粒子的通用、非简并气相团簇的三维原子分子动力学模拟，其中粒子的质量为 $m_i$，位置为 $\\mathbf{r}_i$，速度为 $\\mathbf{v}_i$，且 $i \\in \\{1,\\dots,N\\}$。假设 $C$ 个独立的完整约束 $\\phi_{\\alpha}(\\mathbf{r}) = 0$（其中 $\\alpha \\in \\{1,\\dots,C\\}$）通过诸如 SHAKE 方法之类的完整约束算法时刻被强制施加，从而使运动被限制在约束流形上。动能为 $K = \\frac{1}{2}\\sum_{i=1}^{N} m_i |\\mathbf{v}_i|^2$，动能温度 $T_{\\mathrm{kin}}$ 通过能量均分定理定义为 $\\langle K \\rangle = \\frac{f}{2} k_B T_{\\mathrm{kin}}$，其中 $k_B$ 是玻尔兹曼常数，$f$ 是对 $K$ 有贡献的有效二次自由度数目。\n\n除了完整约束之外，积分器还在每个时间步强制施加总线性动量为零，并可能强制施加绕瞬时质心的总角动量为零。具体而言，可能施加以下线性速度约束：\n- 总线性动量为零：$\\mathbf{P} \\equiv \\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0}$。\n- 总角动量为零：$\\mathbf{L} \\equiv \\sum_{i=1}^{N} \\mathbf{r}_i \\times (m_i \\mathbf{v}_i) = \\mathbf{0}$。\n\n假设团簇的惯性张量是满秩的，且完整约束与全局平动和转动无关，因此它们自身不会固定质心或整体取向。\n\n从通过拉格朗日乘子施加完整约束的牛顿定律、能量均分定理以及关于约束速度空间的基本线性代数出发，推导在所有约束下动力学可及的速度子空间的维度。由此，确定进入 $T_{\\mathrm{kin}}$ 定义的有效二次自由度 $f$ 的正确数目。引入指示变量 $\\chi_t$ 和 $\\chi_r$ 来编码是否施加了全局速度约束：如果施加了总线性动量为零的约束，则 $\\chi_t = 1$，否则 $\\chi_t = 0$；如果施加了总角动量为零的约束，则 $\\chi_r = 1$，否则 $\\chi_r = 0$。最后，用 $\\chi_t$ 和 $\\chi_r$ 表示 $d_{\\mathrm{rigid}}$，即被这些全局约束移除的剛体自由度的总数。\n\n将最终结果表示为一个双元素行向量 $(f, d_{\\mathrm{rigid}})$。无需进行数值计算。请用封闭形式的解析表达式给出答案。", "solution": "该问题要求确定一个受多种约束的 $N$ 粒子系统的有效二次自由度数 $f$ 和被移除的刚体自由度数 $d_{\\mathrm{rigid}}$。解决方案通过系统地计算可及速度空间的维度来推导。\n\n系统在任意时刻的状态可以由三维空间中 $N$ 个粒子的位置 $\\mathbf{r}_i$ 和速度 $\\mathbf{v}_i$ 来描述。速度分量的总数为 $3N$，这对应于无约束速度空间的维度。有效二次自由度数 $f$ 是系统在所有施加的约束下动力学可及的速度子空间的维度。\n\n1.  **初始自由度**：对于三维空间中的 $N$ 个自由粒子系统，存在 $3N$ 个平动自由度，每个自由度对应粒子速度矢量 $\\mathbf{v}_i$ 的一个分量。总动能是这 $3N$ 个速度分量的二次函数。在没有任何约束的情况下，我们有 $f = 3N$。\n\n2.  **完整约束**：系统受到 $C$ 个独立的完整约束 $\\phi_{\\alpha}(\\mathbf{r}_1, \\dots, \\mathbf{r}_N) = 0$（其中 $\\alpha \\in \\{1, \\dots, C\\}$）。为了使这些约束时刻保持，它们的时间导数必须为零。这对粒子速度施加了约束：\n    $$ \\frac{d\\phi_{\\alpha}}{dt} = \\sum_{i=1}^{N} \\frac{\\partial \\phi_{\\alpha}}{\\partial \\mathbf{r}_i} \\cdot \\frac{d\\mathbf{r}_i}{dt} = \\sum_{i=1}^{N} (\\nabla_{\\mathbf{r}_i} \\phi_{\\alpha}) \\cdot \\mathbf{v}_i = 0 $$\n    这 $C$ 个方程中的每一个都代表了对 $3N$ 个速度分量的一个线性约束。正如问题所述，这些约束是独立的，因此它们在 $3N$ 维速度空间中定义了 $C$ 个线性无关的超平面。这些超平面的交集将可及速度子空间的维度减少了 $C$。\n    施加完整约束后的自由度数：$3N - C$。\n\n3.  **全局平动约束**：总线性动量为零的约束 $\\mathbf{P} = \\mathbf{0}$ 由下式给出：\n    $$ \\mathbf{P} = \\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0} $$\n    这是一个矢量方程，等效于对速度分量的三个独立的标量线性约束：\n    $$ \\sum_{i=1}^{N} m_i v_{i,x} = 0 $$\n    $$ \\sum_{i=1}^{N} m_i v_{i,y} = 0 $$\n    $$ \\sum_{i=1}^{N} m_i v_{i,z} = 0 $$\n    这些约束移除了对应于质心集体运动的 $3$ 个自由度。指示变量 $\\chi_t$ 决定是否施加这些约束。因此，它们将自由度数减少 $3\\chi_t$。\n\n4.  **全局转动约束**：绕质心的总角动量为零的约束 $\\mathbf{L} = \\mathbf{0}$ 由下式给出：\n    $$ \\mathbf{L} = \\sum_{i=1}^{N} (\\mathbf{r}_i - \\mathbf{R}_{\\mathrm{CM}}) \\times (m_i \\mathbf{v}_i) = \\mathbf{0} $$\n    其中 $\\mathbf{R}_{\\mathrm{CM}}$ 是质心的位置。（注意：如问题陈述中那样直接使用 $\\mathbf{r}_i$ 是有效的，前提是原点被选为质心，这是在移除质心运动时的一种常见约定）。这个矢量方程等效于对速度分量的三个独立的标量线性约束，移除了对应于团簇整体刚性转动的 $3$ 个自由度。指示变量 $\\chi_r$ 决定是否施加这些约束。因此，它们将自由度数减少 $3\\chi_r$。\n\n5.  **约束的独立性**：问题陈述完整约束与全局平动和转动无关。这是一个关键条件。这意味着 $C$ 个内部约束（例如，固定键长）不会与关于总动量或总角动量的约束相冲突或预先确定它们。此外，对于一个通用的非简并团簇（即，并非所有粒子都共线），平动和转动约束是相互独立的。因此，独立约束的总数是每个类别计数之和。\n\n6.  **$f$的计算**：有效二次自由度的最终数目 $f$ 是初始总数 $3N$ 减去独立约束的总数。\n    $$ f = 3N - C - 3\\chi_t - 3\\chi_r $$\n    这就是动力学可及速度子空间的维度，也正是这个数目正确地进入了动能温度的能量均分公式：$\\langle K \\rangle = \\frac{f}{2} k_B T_{\\mathrm{kin}}$。\n\n7.  **$d_{\\mathrm{rigid}}$的计算**：问题将 $d_{\\mathrm{rigid}}$ 定义为被关于线性和角动量的全局约束所移除的刚体自由度的总数。\n    - 移除的平动自由度数为 $3$（如果 $\\chi_t=1$）或 $0$（如果 $\\chi_t=0$）。这等于 $3\\chi_t$。\n    - 移除的转动自由度数为 $3$（如果 $\\chi_r=1$）或 $0$（如果 $\\chi_r=0$）。这等于 $3\\chi_r$。\n    被移除的刚体自由度总数是这两个量之和：\n    $$ d_{\\mathrm{rigid}} = 3\\chi_t + 3\\chi_r $$\n    这使我们可以更紧凑地写出 $f$，$f = 3N - C - d_{\\mathrm{rigid}}$，这清晰地分开了来自内部约束 ($C$) 和刚体约束 ($d_{\\mathrm{rigid}}$) 的贡献。\n\n最终结果是 $f$ 和 $d_{\\mathrm{rigid}}$ 的表达式对。", "answer": "$$\n\\boxed{\\begin{pmatrix} 3N - C - 3\\chi_t - 3\\chi_r  3\\chi_t + 3\\chi_r \\end{pmatrix}}\n$$", "id": "3451703"}, {"introduction": "理论的价值在于其在实践中的应用。现在，我们将前一个练习中建立的原理应用于一个非常常见的模拟场景：刚性水模型。通过这项实践，你将亲手计算并量化当自由度被错误计算时，所报告的温度会产生多大的系统性偏差，从而深刻理解精确计算在实际模拟中的重要性[@problem_id:3451676]。", "problem": "对一个刚性三位点水模型，在微正则系综中进行了一次经典的分子动力学 (MD) 模拟。该系统包含 $N_{\\mathrm{mol}} = 1000$ 个水分子，每个水分子有 $3$ 个原子。每个水分子的几何构型由每个分子的 $3$ 个完整约束来维持，并且系统的总线性动量被移除，从而消除了 $3$ 个全局自由度。动能温度是通过动能和活性自由度的数量来定义的。然而，一个简陋的后处理脚本在计算动能温度时，使用的自由度计数忽略了因约束而移除的自由度，但仍然考虑了总线性动量的移除。\n\n假设该简陋脚本报告的动能温度为 $T_{\\mathrm{kin}}^{\\mathrm{naive}} = 200 \\ \\mathrm{K}$，这是根据轨迹的瞬时动能和自由度计数 $f_{\\mathrm{naive}} = 3 N_{\\mathrm{atoms}} - 3$ 计算得出的，其中 $N_{\\mathrm{atoms}} = 3 N_{\\mathrm{mol}}$。使用适用于经典 MD 和刚性约束的第一性原理推导，确定：\n- 简陋动能温度中的有符号偏差 $\\Delta T$（定义为 $\\Delta T = T_{\\mathrm{kin}}^{\\mathrm{naive}} - T_{\\mathrm{kin}}^{\\mathrm{corr}}$），以及\n- 一致地考虑了约束自由度的修正动能温度 $T_{\\mathrm{kin}}^{\\mathrm{corr}}$。\n\n假设在两种动能温度的定义中，瞬时动能是相同的，唯一的区别源于自由度的计数。将 $\\Delta T$ 和 $T_{\\mathrm{kin}}^{\\mathrm{corr}}$ 均以开尔文表示。将您的答案四舍五入到四位有效数字。", "solution": "该问题要求在分子动力学模拟中，确定修正后的动能温度及其与简陋计算值的偏差。验证问题陈述的有效性是必需的第一步。\n\n### 问题验证\n\n**第一步：提取已知条件**\n- 系统类型：经典分子动力学模拟，对象为刚性三位点水模型。\n- 系综：微正则。\n- 分子数：$N_{\\mathrm{mol}} = 1000$。\n- 每分子原子数：$3$。\n- 总原子数：$N_{\\mathrm{atoms}} = 3 N_{\\mathrm{mol}}$。\n- 约束：每分子施加 $3$ 个完整约束以维持刚性几何构型。\n- 全局自由度：移除系统总线性动量，消除 $3$ 个全局自由度。\n- 简陋动能温度：$T_{\\mathrm{kin}}^{\\mathrm{naive}} = 200 \\ \\mathrm{K}$。\n- 简陋自由度公式：$f_{\\mathrm{naive}} = 3 N_{\\mathrm{atoms}} - 3$。\n- 偏差定义：$\\Delta T = T_{\\mathrm{kin}}^{\\mathrm{naive}} - T_{\\mathrm{kin}}^{\\mathrm{corr}}$。\n- 核心假设：在简陋和修正的温度计算中，瞬时动能 $E_k$ 相同。\n\n**第二步：使用已知条件进行验证**\n- **科学性（关键）：** 该问题牢固地植根于经典统计力学和计算物理学的原理。通过能量均分定理定义动能温度、自由度的概念、对刚体使用完整约束以及移除质心运动，这些都是分子动力学模拟的标准和基本方面。该设定在科学上是合理的。\n- **适定性：** 该问题是适定的。它提供了所有必需的数值数据（$N_{\\mathrm{mol}}$, $T_{\\mathrm{kin}}^{\\mathrm{naive}}$）和清晰的定义（$f_{\\mathrm{naive}}$, $\\Delta T$），足以确定所求量（$T_{\\mathrm{kin}}^{\\mathrm{corr}}$, $\\Delta T$）的唯一解。\n- **客观性（关键）：** 问题陈述使用了精确、定量且无偏见的语言，没有主观或模糊的术语。\n\n该问题没有任何使其无效的缺陷。它在科学上不是不合理的，也不是不完整、不适定或有其他瑕疵的。\n\n**第三步：结论与行动**\n该问题是 **有效的**。将提供完整解答。\n\n### 解答\n\n将经典系统的总动能 $E_k$ 与其动能温度 $T_{\\mathrm{kin}}$ 联系起来的基本原理源于能量均分定理。对于一个具有 $f$ 个二次自由度的系统，其关系为：\n$$ E_k = \\frac{1}{2} f k_B T_{\\mathrm{kin}} $$\n其中 $k_B$ 是玻尔兹曼常数。由此，动能温度定义为：\n$$ T_{\\mathrm{kin}} = \\frac{2 E_k}{f k_B} $$\n问题源于对自由度 $f$ 的不正确计数。\n\n首先，我们确定系统中的分子数和原子数。\n给定 $N_{\\mathrm{mol}} = 1000$ 个分子，每个分子有 $3$ 个原子，总原子数为：\n$$ N_{\\mathrm{atoms}} = 3 N_{\\mathrm{mol}} = 3 \\times 1000 = 3000 $$\n\n接下来，我们计算脚本所使用的简陋自由度数 $f_{\\mathrm{naive}}$。问题给出了所用的公式：\n$$ f_{\\mathrm{naive}} = 3 N_{\\mathrm{atoms}} - 3 $$\n这个计数正确地减去了因移除系统总线性动量而减少的 $3$ 个自由度，但错误地未能减去因刚性约束而移除的自由度。\n$$ f_{\\mathrm{naive}} = 3(3000) - 3 = 9000 - 3 = 8997 $$\n\n现在，我们必须确定正确的自由度数 $f_{\\mathrm{corr}}$。一个由 $N_{\\mathrm{atoms}}$ 个质点组成的系统最初有 $3 N_{\\mathrm{atoms}}$ 个自由度。我们必须减去独立完整约束的数量和被移除的全局自由度的数量。\n- 系统有 $N_{\\mathrm{mol}}$ 个分子。\n- 每个分子通过 $3$ 个约束变为刚体。\n- 总约束数：$N_{\\mathrm{constraints}} = 3 N_{\\mathrm{mol}} = 3 \\times 1000 = 3000$。\n- 因总线性动量为零而移除的全局自由度：$3$。\n\n因此，修正后的自由度数为：\n$$ f_{\\mathrm{corr}} = 3 N_{\\mathrm{atoms}} - N_{\\mathrm{constraints}} - 3 = 3(3000) - 3000 - 3 = 9000 - 3000 - 3 = 5997 $$\n或者，对于一个由 $N_{\\mathrm{mol}}$ 个刚性非线性分子组成的系统（三位点水模型是非线性的），每个分子拥有 $3$ 个平动自由度和 $3$ 个转动自由度，每个分子总共有 $6$ 个自由度。对于独立的分子系统，总自由度将是 $6 N_{\\mathrm{mol}}$。减去整个系统质心平动的 $3$ 个自由度，得到：\n$$ f_{\\mathrm{corr}} = 6 N_{\\mathrm{mol}} - 3 = 6(1000) - 3 = 6000 - 3 = 5997 $$\n两种方法的结果是一致的。\n\n问题陈述指出，两种温度计算中的瞬时动能 $E_k$ 是相同的。因此，我们可以陈述：\n$$ T_{\\mathrm{kin}}^{\\mathrm{naive}} = \\frac{2 E_k}{f_{\\mathrm{naive}} k_B} \\quad \\implies \\quad \\frac{2 E_k}{k_B} = f_{\\mathrm{naive}} T_{\\mathrm{kin}}^{\\mathrm{naive}} $$\n$$ T_{\\mathrm{kin}}^{\\mathrm{corr}} = \\frac{2 E_k}{f_{\\mathrm{corr}} k_B} $$\n通过将 $\\frac{2 E_k}{k_B}$ 的表达式代入第二个方程，我们找到了两种温度之间的关系：\n$$ T_{\\mathrm{kin}}^{\\mathrm{corr}} = \\frac{f_{\\mathrm{naive}} T_{\\mathrm{kin}}^{\\mathrm{naive}}}{f_{\\mathrm{corr}}} = T_{\\mathrm{kin}}^{\\mathrm{naive}} \\left( \\frac{f_{\\mathrm{naive}}}{f_{\\mathrm{corr}}} \\right) $$\n使用已知值 $T_{\\mathrm{kin}}^{\\mathrm{naive}} = 200 \\ \\mathrm{K}$，$f_{\\mathrm{naive}} = 8997$ 和 $f_{\\mathrm{corr}} = 5997$：\n$$ T_{\\mathrm{kin}}^{\\mathrm{corr}} = 200 \\ \\mathrm{K} \\times \\left( \\frac{8997}{5997} \\right) \\approx 200 \\ \\mathrm{K} \\times 1.5002501... \\approx 300.050025... \\ \\mathrm{K} $$\n四舍五入到四位有效数字，修正后的动能温度为 $T_{\\mathrm{kin}}^{\\mathrm{corr}} = 300.1 \\ \\mathrm{K}$。\n\n最后，我们计算问题中定义的有符号偏差 $\\Delta T$：\n$$ \\Delta T = T_{\\mathrm{kin}}^{\\mathrm{naive}} - T_{\\mathrm{kin}}^{\\mathrm{corr}} $$\n$$ \\Delta T = 200 \\ \\mathrm{K} - 300.050025... \\ \\mathrm{K} = -100.050025... \\ \\mathrm{K} $$\n四舍五入到四位有效数字，有符号偏差为 $\\Delta T = -100.1 \\ \\mathrm{K}$。负号表示简陋的计算低估了真实的动能温度。这是符合预期的，因为简陋计算错误地假设了相同的动能分布在更多的自由度上。\n\n所求的值是有符号偏差 $\\Delta T$ 和修正后的动能温度 $T_{\\mathrm{kin}}^{\\mathrm{corr}}$。", "answer": "$$\\boxed{\\begin{pmatrix}-100.1  300.1\\end{pmatrix}}$$", "id": "3451676"}, {"introduction": "一次精确的模拟不仅需要正确的物理模型，还需要我们妥善处理由数值方法自身引入的系统误差。由于分子动力学模拟使用有限的时间步长 $h$ 来积分运动方程，这会导致像温度这样的观测量产生离散化偏差。本练习将介绍一种强大的数据分析技术——理查森外推法，它能够帮助我们根据在不同时间步长下的测量结果，估计出当 $h \\to 0$ 时的物理真实值，从而有效地修正数值伪影[@problem_id:3451698]。", "problem": "在分子动力学 (MD) 中，动能温度根据能量均分定理定义为满足 $K = \\frac{f}{2} k_{\\mathrm{B}} T$ 的标量 $T$，其中 $K$ 是在一条轨迹样本上平均的动能，$f$ 是二次自由度的数量，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。当轨迹由一个近似牛顿定律的有限时间步长积分器生成时，有限步长离散化会使测量的时间平均动能温度产生偏差。对于一个一致的、$p$ 阶精度的时间可逆积分器，一个公认的结论是，光滑可观测量 (smooth observables) 的偏差允许一个以时间步长 $h$ 的幂次表示的渐近展开，当 $p$ 为偶数时，其首项与 $h^{p}$ 成正比。特别地，假设作为时间步长函数的测量动能温度可以很好地用以下模型描述\n$$\nT(h) = T_0 + c\\, h^{p} + \\varepsilon(h),\n$$\n其中 $T_0$ 是连续极限 ($h \\to 0$) 下的动能温度，单位为开尔文，$c$ 是一个未知系数，而 $\\varepsilon(h)$ 代表高阶截断误差项和测量噪声。对于几个测试数据集，您会获得一组测量的时间步长 $h_i$ (单位为飞秒)、测量的动能温度 $T_i$ (单位为开尔文)、积分器的已知阶数 $p$，以及每个 $T_i$ 的独立单标准差不确定度 $\\sigma_i$ (单位为开尔文)。假设 $\\varepsilon(h)$ 的实现是独立的、零均值的高斯分布，其方差为 $\\sigma_i^2$，并且在给定的 $h_i$ 下，高阶截断项可以忽略不计。\n\n任务：实现一个程序，对每个数据集执行 Richardson 式外推来估计 $T_0$ 并量化其单标准差不确定度。使用一个与模型 $T(h) = T_0 + c\\, h^p + \\text{noise}$ 一致且符合统计学原理的方法：\n- 对于 $n \\ge 2$ 个数据点，使用加权最小二乘法拟合线性模型 $y_i = a + b x_i$ (其中 $x_i = h_i^{p}$，$y_i = T_i$)，权重为 $w_i = 1/\\sigma_i^2$，以获得 $a$ ($T_0$ 的估计值) 及其从估计量协方差得出的标准不确定度。这种多点线性拟合通过在最佳线性无偏估计的意义上消除首阶项，实现了一种多点 Richardson 外推。如果只给定两个点，这将简化为 $h^p$ 项的两点消除法，并产生与两点 Richardson 公式相同的 $T_0$。\n- $(a,b)$ 的估计量为\n$$\n\\hat{\\beta} = \\begin{bmatrix} \\hat{a} \\\\ \\hat{b} \\end{bmatrix} = \\left(X^\\top W X\\right)^{-1} X^\\top W y,\n$$\n其中 $X$ 是 $n \\times 2$ 的设计矩阵，其行为 $[1, x_i]$，$W = \\mathrm{diag}(w_1,\\dots,w_n)$，$y$ 是 $y_i$ 值的向量。$\\hat{\\beta}$ 的协方差为\n$$\n\\mathrm{Cov}(\\hat{\\beta}) = \\left(X^\\top W X\\right)^{-1},\n$$\n因此 $T_0$ 的单标准差不确定度为 $u_{T_0} = \\sqrt{\\left[\\mathrm{Cov}(\\hat{\\beta})\\right]_{11}}$（$(1,1)$ 项的平方根）。\n- 报告 $T_0$ 和 $u_{T_0}$，单位均为开尔文，四舍五入到三位小数。\n\n输入嵌入在程序中；无需外部输入。使用以下数据集测试套件，每个数据集由三元组 $(p,\\{h_i\\},\\{T_i\\},\\{\\sigma_i\\})$ 指定：\n- 数据集 A (二阶积分器，三点，同方差): $p = 2$, $h = [4, 2, 1]$ (飞秒), $T = [308.1, 301.8, 300.6]$ (开尔文), $\\sigma = [0.2, 0.2, 0.2]$ (开尔文)。\n- 数据集 B (二阶积分器，两点，同方差): $p = 2$, $h = [3, 1.5]$ (飞秒), $T = [305.0, 301.3]$ (开尔文), $\\sigma = [0.1, 0.1]$ (开尔文)。\n- 数据集 C (二阶积分器，三点，异方差): $p = 2$, $h = [5, 2, 1]$ (飞秒), $T = [319.4, 303.5, 301.1]$ (开尔文), $\\sigma = [0.5, 0.2, 0.1]$ (开尔文)。\n- 数据集 D (四阶积分器，三点，同方差): $p = 4$, $h = [4, 2, 1]$ (飞秒), $T = [302.5, 300.2, 300.0]$ (开尔文), $\\sigma = [0.05, 0.05, 0.05]$ (开尔文)。\n\n角度单位不适用。所有温度必须以开尔文表示。您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表的结果，每个内部列表包含一个数据集的 $[T_0, u_{T_0}]$，两者都四舍五入到三位小数，按 A、B、C、D 的顺序排列。例如，输出格式必须与\n$[[T_{0,A},u_{A}],[T_{0,B},u_{B}],[T_{0,C},u_{C}],[T_{0,D},u_{D}]]$ 完全一致。", "solution": "用户想要解决一个问题。用户是一个机器人。用户希望我解决这个问题。\n\n### 问题验证\n\n这个问题是有效的。\n- **科学依据：** 所提出的模型 $T(h) = T_0 + c h^p + \\varepsilon(h)$，是针对由对称 $p$ 阶数值积分器生成的轨迹计算出的可观测量误差的标准渐近展开。这是几何数值积分领域一个公认的结果，尤其与分子动力学 (MD) 相关。使用加权最小二乘法 (WLS) 将此模型拟合到具有已知异方差噪声的数据，是一种统计上严谨且标准的参数估计方法。Richardson 外推，在这里被构建为线性拟合，是数值分析中的一种经典技术。整个设置完全符合物理学、数值分析和统计学的既定原理。\n- **适定性：** 问题定义清晰。数据 ($h_i, T_i, \\sigma_i, p$)、模型和估计方法 (WLS) 都已明確提供。对于每个数据集，至少有两个数据点 ($n \\ge 2$)，且自变量 $x_i = h_i^p$ 是互不相同的，这确保了矩阵 $X^\\top W X$ 是可逆的。因此，参数及其不确定度的唯一解存在。\n- **客观性：** 问题以客观的数学语言表述。所有量都已精确定义，任务是将指定的算法应用于给定的数据。没有主观成分。\n- **完整性：** 问题为每个数据集的计算提供了所有必要的信息。\n- **一致性：** 在给定的统计假设下，为 WLS 估计量及其协方差矩阵提供的公式是正确的。\n\n问题被认定为有效，并将提供完整解决方案。\n\n### 基于原理的解决方案设计\n\n核心任务是根据在不同时间步长 $h$下获得的一组 MD 模拟结果，估计连续极限温度 $T_0$ 及其不确定度。问题提供了一个模型，描述了测量温度 $T(h)$ 如何依赖于时间步长：\n\n$$\nT_i = T_0 + c h_i^p + \\varepsilon_i\n$$\n\n其中 $T_i = T(h_i)$ 是在时间步长 $h_i$ 处的测量温度，$p$ 是积分器的阶数，$T_0$ 和 $c$ 是未知常数，$\\varepsilon_i$ 是一个随机误差项。假设误差 $\\varepsilon_i$ 是独立的，服从均值为零、已知方差为 $\\sigma_i^2$ 的正态分布。\n\n这个模型可以被重构为一个线性回归问题。通过定义新的自变量 $x_i = h_i^p$ 和因变量 $y_i = T_i$，模型变为：\n\n$$\ny_i = a + b x_i + \\varepsilon_i\n$$\n\n在这里，截距 $a$ 对应于所求的连续极限温度 $T_0$，斜率 $b$ 对应于系数 $c$。\n\n由于测量不确定度 $\\sigma_i$ 在所有数据点上并非一致（异方差噪声），拟合该线性模型最合适的方法是加权最小二乘法 (WLS)。每个数据点 $(x_i, y_i)$ 的权重选择为相应误差项方差的倒数，即 $w_i = 1/\\sigma_i^2$。这种选择赋予了更精确的测量更大的影响力，并得出参数 $(a, b)$ 的最佳线性无偏估计量 (BLUE)。\n\nWLS 解是通过求解矩阵形式的正规方程得到的。参数 $\\hat{\\beta} = \\begin{bmatrix} \\hat{a} \\\\ \\hat{b} \\end{bmatrix}$ 的估计如下：\n\n$$\n\\hat{\\beta} = \\left(X^\\top W X\\right)^{-1} X^\\top W y\n$$\n\n其中：\n- $y$ 是观测温度 $T_i$ 的列向量。\n- $X$ 是 $n \\times 2$ 的设计矩阵，其第 $i$ 行为 $[1, x_i] = [1, h_i^p]$。\n- $W$ 是 $n \\times n$ 的对角权重矩阵，其中 $W_{ii} = w_i = 1/\\sigma_i^2$。\n\n估计参数的统计不确定性由协方差矩阵捕获，其公式为：\n\n$$\n\\mathrm{Cov}(\\hat{\\beta}) = \\left(X^\\top W X\\right)^{-1}\n$$\n\n$T_0$ 的估计值是 $\\hat{a}$，即向量 $\\hat{\\beta}$ 的第一个元素。该估计的方差 $\\mathrm{Var}(\\hat{a})$ 是协方差矩阵的左上角元素 $[\\mathrm{Cov}(\\hat{\\beta})]_{11}$。$T_0$ 的单标准差不确定度，记为 $u_{T_0}$，是该方差的平方根：\n\n$$\nu_{T_0} = \\sqrt{[\\mathrm{Cov}(\\hat{\\beta})]_{11}}\n$$\n\n对每个数据集，实现将按以下步骤进行：\n1.  从提供的数据构建向量 $h$、$T$ 和 $\\sigma$。\n2.  定义阶数 $p$。\n3.  计算变换后的变量 $x_i = h_i^p$。\n4.  构建设计矩阵 $X$ 和权重矩阵 $W$。\n5.  使用矩阵代数，最好是用像 `NumPy` 这样鲁棒的库，来使用上述公式计算 $\\hat{\\beta}$ 和 $\\mathrm{Cov}(\\hat{\\beta})$。\n6.  提取 $T_0$ 的估计值 $\\hat{a}$ 并计算其不确定度 $u_{T_0}$。\n7.  按要求将最终结果四舍五入到三位小数。\n8.  收集所有数据集的结果，并根据指定格式化输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Dataset A: 2nd-order, 3 points, homoscedastic\n        {'p': 2, 'h': [4, 2, 1], 'T': [308.1, 301.8, 300.6], 'sigma': [0.2, 0.2, 0.2]},\n        # Dataset B: 2nd-order, 2 points, homoscedastic\n        {'p': 2, 'h': [3, 1.5], 'T': [305.0, 301.3], 'sigma': [0.1, 0.1]},\n        # Dataset C: 2nd-order, 3 points, heteroscedastic\n        {'p': 2, 'h': [5, 2, 1], 'T': [319.4, 303.5, 301.1], 'sigma': [0.5, 0.2, 0.1]},\n        # Dataset D: 4th-order, 3 points, homoscedastic\n        {'p': 4, 'h': [4, 2, 1], 'T': [302.5, 300.2, 300.0], 'sigma': [0.05, 0.05, 0.05]}\n    ]\n\n    results = []\n    for case in test_cases:\n        # Pass the parameters of each case to the solver function.\n        result = calculate_extrapolation(\n            p=case['p'],\n            h_data=case['h'],\n            T_data=case['T'],\n            sigma_data=case['sigma']\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists is already in the correct format.\n    # We remove whitespace to make it compact as per the example.\n    print(str(results).replace(\" \", \"\"))\n\ndef calculate_extrapolation(p, h_data, T_data, sigma_data):\n    \"\"\"\n    Performs weighted least squares fitting to estimate T0 and its uncertainty.\n\n    Args:\n        p (int): The order of the integrator.\n        h_data (list of float): Measured time steps.\n        T_data (list of float): Measured kinetic temperatures.\n        sigma_data (list of float): Uncertainties for each temperature measurement.\n\n    Returns:\n        list: A list containing [T0, u_T0], rounded to three decimal places.\n    \"\"\"\n    # Convert input lists to NumPy arrays for vectorized operations.\n    # Using float64 for better precision in matrix calculations.\n    h = np.array(h_data, dtype=np.float64)\n    T = np.array(T_data, dtype=np.float64)\n    sigma = np.array(sigma_data, dtype=np.float64)\n\n    # 1. Transform variables for the linear model y = a + b*x\n    #    y = T_i, x = h_i^p, a = T0, b = c\n    x = h**p\n    y = T\n\n    # 2. Construct matrices for Weighted Least Squares (WLS).\n    # The weight matrix W is diagonal with weights w_i = 1/sigma_i^2.\n    weights = 1.0 / sigma**2\n    W = np.diag(weights)\n\n    # The design matrix X has a column of ones for the intercept and a column for x.\n    X = np.vstack([np.ones(len(x)), x]).T\n\n    # 3. Solve for the parameters using the WLS normal equations.\n    # The parameter vector beta_hat = [a, b] is given by:\n    # beta_hat = (X^T * W * X)^(-1) * (X^T * W * y)\n    \n    # Calculate the matrix (X^T * W * X)\n    XTWX = X.T @ W @ X\n    \n    # Calculate the vector (X^T * W * y)\n    XTWy = X.T @ W @ y\n\n    # The covariance matrix of the parameters is the inverse of XTWX.\n    # Using np.linalg.inv is numerically stable and robust.\n    cov_beta = np.linalg.inv(XTWX)\n\n    # The parameter estimates are found by multiplying cov_beta by XTWy.\n    beta_hat = cov_beta @ XTWy\n\n    # 4. Extract results for T0.\n    # The estimate for T0 is the intercept 'a', which is the first element of beta_hat.\n    T0_estimate = beta_hat[0]\n\n    # The uncertainty in T0 is the square root of the corresponding diagonal element\n    # of the covariance matrix, which is cov_beta[0, 0].\n    uncertainty_T0 = np.sqrt(cov_beta[0, 0])\n    \n    # 5. Round the results to three decimal places as required.\n    T0_rounded = round(T0_estimate, 3)\n    u_T0_rounded = round(uncertainty_T0, 3)\n\n    return [T0_rounded, u_T0_rounded]\n\n# Execute the main function when the script is run.\nsolve()\n```", "id": "3451698"}]}