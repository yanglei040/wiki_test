{"hands_on_practices": [{"introduction": "要真正掌握 GMRES，我们必须深入其内部，探究每个循环中执行的核心计算。这个练习 [@problem_id:3542064] 将单个 GMRES 步骤分解为其基本组成部分：一个小的最小二乘问题。通过直接求解该问题，然后使用更数值稳定的基于 Givens 旋转的 QR 分解法，您将对实践中如何最小化残差有一个具体的理解。", "problem": "考虑将重启动参数为 $m=2$ 的 Generalized Minimal Residual (GMRES) 方法应用于线性系统 $A x = b$。经过两步 Arnoldi 迭代，该方法构建了一个标准正交基 $V_{3}$ 和一个 $(m+1)\\times m$ 的上 Hessenberg 矩阵 $\\underline{H}_{2} \\in \\mathbb{R}^{3 \\times 2}$，使得残差通过求解最小二乘问题 $\\min_{y \\in \\mathbb{R}^{2}} \\| \\beta e_{1} - \\underline{H}_{2} y \\|_{2}$ 来最小化，其中 $\\beta = \\|r_{0}\\|_{2}$ 且 $e_{1} = (1,0,0)^{\\top} \\in \\mathbb{R}^{3}$。取\n$$\n\\underline{H}_{2} \\;=\\; \\begin{pmatrix}\n3  3 \\\\\n4  4 \\\\\n0  7\n\\end{pmatrix},\n\\qquad\n\\beta \\;=\\; 10,\n\\qquad\ne_{1} \\;=\\; \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n您的任务是：\n- 通过显式求解 2 步最小二乘问题 $\\min_{y \\in \\mathbb{R}^{2}} \\| \\beta e_{1} - \\underline{H}_{2} y \\|_{2}$ 来计算最小残差范数，并计算所得残差的范数。\n- 独立地，对 $\\underline{H}_{2}$ 应用两次连续的 Givens 旋转，将其转换为上三角形式，并将相同的旋转应用于右侧向量 $\\beta e_{1}$。确定两次旋转后，旋转后的右侧向量最后一个分量的大小，并验证它等于从最小二乘解中获得的残差范数。\n\n将残差范数报告为单个实数。如果您选择近似中间量，请确保最终报告的残差范数是精确的；无需四舍五入。", "solution": "问题陈述已经过验证，并被确定为数值线性代数中一个适定且有科学依据的问题。所有必要数据均已提供，任务也已明确定义。\n\n该问题要求计算一个 2 步 Generalized Minimal Residual (GMRES) 方法的最小残差范数。最小化问题由下式给出：\n$$\n\\min_{y \\in \\mathbb{R}^{2}} \\| \\beta e_{1} - \\underline{H}_{2} y \\|_{2}\n$$\n其中 $\\mathbb{R}$ 是实数集，给定的量为：\n$$\n\\underline{H}_{2} = \\begin{pmatrix} 3  3 \\\\ 4  4 \\\\ 0  7 \\end{pmatrix}, \\quad \\beta = 10, \\quad e_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n最小二乘问题右侧的向量是 $\\beta e_{1} = 10 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix}$。我们用 $g$ 表示这个向量。\n\n我们将按要求使用两种方法计算残差范数。\n\n### 方法 1：通过正规方程组的显式解\n\n使欧几里得范数 $\\| g - \\underline{H}_{2} y \\|_{2}$ 最小化的向量 $y \\in \\mathbb{R}^{2}$ 是以下正规方程组的解：\n$$\n(\\underline{H}_{2}^{\\top} \\underline{H}_{2}) y = \\underline{H}_{2}^{\\top} g\n$$\n首先，我们计算矩阵 $\\underline{H}_{2}^{\\top} \\underline{H}_{2}$：\n$$\n\\underline{H}_{2}^{\\top} \\underline{H}_{2} = \\begin{pmatrix} 3  4  0 \\\\ 3  4  7 \\end{pmatrix} \\begin{pmatrix} 3  3 \\\\ 4  4 \\\\ 0  7 \\end{pmatrix} = \\begin{pmatrix} 3 \\cdot 3 + 4 \\cdot 4 + 0 \\cdot 0   3 \\cdot 3 + 4 \\cdot 4 + 0 \\cdot 7 \\\\ 3 \\cdot 3 + 4 \\cdot 4 + 7 \\cdot 0   3 \\cdot 3 + 4 \\cdot 4 + 7 \\cdot 7 \\end{pmatrix}\n$$\n$$\n\\underline{H}_{2}^{\\top} \\underline{H}_{2} = \\begin{pmatrix} 9 + 16   9 + 16 \\\\ 9 + 16   9 + 16 + 49 \\end{pmatrix} = \\begin{pmatrix} 25   25 \\\\ 25   74 \\end{pmatrix}\n$$\n接下来，我们计算向量 $\\underline{H}_{2}^{\\top} g$：\n$$\n\\underline{H}_{2}^{\\top} g = \\begin{pmatrix} 3  4  0 \\\\ 3  4  7 \\end{pmatrix} \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 3 \\cdot 10 + 4 \\cdot 0 + 0 \\cdot 0 \\\\ 3 \\cdot 10 + 4 \\cdot 0 + 7 \\cdot 0 \\end{pmatrix} = \\begin{pmatrix} 30 \\\\ 30 \\end{pmatrix}\n$$\n现在我们求解关于 $y = \\begin{pmatrix} y_1 \\\\ y_2 \\end{pmatrix}$ 的 $2 \\times 2$ 线性系统：\n$$\n\\begin{pmatrix} 25  25 \\\\ 25  74 \\end{pmatrix} \\begin{pmatrix} y_1 \\\\ y_2 \\end{pmatrix} = \\begin{pmatrix} 30 \\\\ 30 \\end{pmatrix}\n$$\n这对应于以下方程组：\n$25 y_1 + 25 y_2 = 30$\n$25 y_1 + 74 y_2 = 30$\n用第二个方程减去第一个方程得到：\n$$\n(74 - 25) y_2 = 30 - 30 \\implies 49 y_2 = 0 \\implies y_2 = 0\n$$\n将 $y_2 = 0$ 代入第一个方程：\n$$\n25 y_1 + 25(0) = 30 \\implies 25 y_1 = 30 \\implies y_1 = \\frac{30}{25} = \\frac{6}{5}\n$$\n最优解是 $y^* = \\begin{pmatrix} 6/5 \\\\ 0 \\end{pmatrix}$。\n残差向量是 $r = g - \\underline{H}_{2} y^*$：\n$$\nr = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 3  3 \\\\ 4  4 \\\\ 0  7 \\end{pmatrix} \\begin{pmatrix} 6/5 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 3 \\cdot (6/5) \\\\ 4 \\cdot (6/5) \\\\ 0 \\cdot (6/5) \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 18/5 \\\\ 24/5 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 50/5 - 18/5 \\\\ -24/5 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 32/5 \\\\ -24/5 \\\\ 0 \\end{pmatrix}\n$$\n最小残差范数是 $\\|r\\|_{2}$：\n$$\n\\|r\\|_{2} = \\sqrt{\\left(\\frac{32}{5}\\right)^2 + \\left(-\\frac{24}{5}\\right)^2 + 0^2} = \\frac{1}{5}\\sqrt{32^2 + 24^2} = \\frac{1}{5}\\sqrt{1024 + 576} = \\frac{1}{5}\\sqrt{1600} = \\frac{40}{5} = 8\n$$\n\n### 方法 2：使用 Givens 旋转的 QR 分解\n\n该最小二乘问题可以通过应用一系列正交变换（Givens 旋转）将 $\\underline{H}_{2}$ 变换为上三角形式来求解。这等价于计算 $\\underline{H}_{2}$ 的 QR 分解。设 $Q$ 是这些正交矩阵的乘积。范数在此类变换下保持不变：\n$$\n\\| g - \\underline{H}_{2} y \\|_{2} = \\| Q(g - \\underline{H}_{2} y) \\|_{2} = \\| Qg - Q\\underline{H}_{2} y \\|_{2}\n$$\n我们将此过程应用于增广系统 $[\\underline{H}_{2} | g]$。\n$$\n\\left[ \\underline{H}_{2} | g \\right] = \\left( \\begin{array}{cc|c} 3   3  10 \\\\ 4   4  0 \\\\ 0   7  0 \\end{array} \\right)\n$$\n**第一次 Givens 旋转：**\n我们的目标是将位置 $(2,1)$ 处的元素 $h_{21} = 4$ 置零。我们在 $(1,2)$ 平面内使用一个旋转 $G_1$。参数 $c_1 = \\cos(\\theta_1)$ 和 $s_1 = \\sin(\\theta_1)$ 由第一列向量的元素 $\\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$ 决定。\n$$\nr_1 = \\sqrt{3^2 + 4^2} = \\sqrt{25} = 5\n$$\n$$\nc_1 = \\frac{3}{r_1} = \\frac{3}{5}, \\quad s_1 = \\frac{4}{r_1} = \\frac{4}{5}\n$$\n旋转矩阵为 $G_1 = \\begin{pmatrix} c_1   s_1  0 \\\\ -s_1   c_1  0 \\\\ 0   0  1 \\end{pmatrix} = \\begin{pmatrix} 3/5   4/5  0 \\\\ -4/5   3/5  0 \\\\ 0   0  1 \\end{pmatrix}$。\n将 $G_1$ 应用于增广系统：\n$$\nG_1 \\left[ \\underline{H}_{2} | g \\right] = \\begin{pmatrix} 3/5   4/5  0 \\\\ -4/5   3/5  0 \\\\ 0   0  1 \\end{pmatrix} \\left( \\begin{array}{cc|c} 3   3  10 \\\\ 4   4  0 \\\\ 0   7  0 \\end{array} \\right) = \\left( \\begin{array}{cc|c} 5   5  6 \\\\ 0   0  -8 \\\\ 0   7  0 \\end{array} \\right)\n$$\n**第二次 Givens 旋转：**\n接下来，我们的目标是第二列的次对角线元素，它现在位于位置 $(3,2)$，值为 $7$。我们在 $(2,3)$ 平面内应用一个旋转 $G_2$，利用位置 $(2,2)$ 处的元素将该元素置零。要旋转的向量是来自第二列的 $\\begin{pmatrix} 0 \\\\ 7 \\end{pmatrix}$。\n$$\nr_2 = \\sqrt{0^2 + 7^2} = 7\n$$\n$$\nc_2 = \\frac{0}{r_2} = 0, \\quad s_2 = \\frac{7}{r_2} = 1\n$$\n旋转矩阵为 $G_2 = \\begin{pmatrix} 1   0  0 \\\\ 0   c_2  s_2 \\\\ 0   -s_2  c_2 \\end{pmatrix} = \\begin{pmatrix} 1   0  0 \\\\ 0   0  1 \\\\ 0   -1  0 \\end{pmatrix}$。\n将 $G_2$ 应用于第一步的结果：\n$$\nG_2 (G_1 \\left[ \\underline{H}_{2} | g \\right]) = \\begin{pmatrix} 1   0  0 \\\\ 0   0  1 \\\\ 0   -1  0 \\end{pmatrix} \\left( \\begin{array}{cc|c} 5   5  6 \\\\ 0   0  -8 \\\\ 0   7  0 \\end{array} \\right) = \\left( \\begin{array}{cc|c} 5   5  6 \\\\ 0   7  0 \\\\ 0   0  8 \\end{array} \\right)\n$$\n原始问题现在转化为最小化：\n$$\n\\left\\| \\begin{pmatrix} 6 \\\\ 0 \\\\ 8 \\end{pmatrix} - \\begin{pmatrix} 5   5 \\\\ 0   7 \\\\ 0   0 \\end{pmatrix} y \\right\\|_{2}\n$$\n范数的平方为：\n$$\n\\left\\| \\begin{pmatrix} 6 - (5y_1 + 5y_2) \\\\ 0 - 7y_2 \\\\ 8 - 0 \\end{pmatrix} \\right\\|_{2}^{2} = (6 - 5y_1 - 5y_2)^2 + (-7y_2)^2 + 8^2\n$$\n为了最小化这个表达式，我们选择 $y_1$ 和 $y_2$ 使前两项为零。这可以通过求解以下上三角系统来实现：\n$$\n\\begin{pmatrix} 5   5 \\\\ 0   7 \\end{pmatrix} \\begin{pmatrix} y_1 \\\\ y_2 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 0 \\end{pmatrix}\n$$\n这得出 $y_2=0$ 和 $y_1=6/5$，这与之前找到的 $y^*$ 相同。\n通过选择这个 $y^*$，残差范数就是剩余项的平方根：\n$$\n\\text{最小残差范数} = \\sqrt{8^2} = 8\n$$\n这个值 $8$ 是旋转后的右侧向量 $Qg = \\begin{pmatrix} 6 \\\\ 0 \\\\ 8 \\end{pmatrix}$ 最后一个分量的大小。\n\n### 结论\n两种方法都得出了相同的最小残差范数值。\n方法 1 得到的残差范数为 $8$。\n方法 2 表明残差范数是变换后右侧向量最后一个分量的大小，即 $|8| = 8$。\n所求的残差范数为 $8$。", "answer": "$$\\boxed{8}$$", "id": "3542064"}, {"introduction": "GMRES 的收敛性可以通过多项式逼近的视角得到优雅的描述。这个练习 [@problem_id:3542092] 阐明了重启动 GMRES 的每个循环都会生成一个“残差多项式”，而重启动的整体效果是这些多项式的复合。通过一个简单的例子，您将看到这个理论框架如何直接解释算法的行为和残差的演变。", "problem": "考虑$\\mathbb{R}^{n}$上的线性系统 $A x = b$ 和广义最小残差法 (GMRES)，该方法在第 $k$ 次迭代时计算 $x_{k} \\in x_{0} + \\mathcal{K}_{k}(A,r_{0})$，以最小化残差 $r_{k} = b - A x_{k}$ 的欧几里得 2-范数，其中 $r_{0} = b - A x_{0}$，$ \\mathcal{K}_{k}(A,r_{0}) = \\operatorname{span}\\{r_{0}, A r_{0}, \\dots, A^{k-1} r_{0}\\}$。重启 GMRES($m$) 方法（重启参数为 $m$ 的 GMRES）运行 $m$ 次迭代以获得 $r_{m}$，然后以 $x_{m}$ 为新的初始猜测值、$r_{m}$ 为新的初始残差进行重启；重复此过程，在第二个循环后产生一个新的 $m$ 步残差 $r_{2m}$。\n\n从核心定义出发，推导每个 $m$ 步循环如何产生一个满足 $p(0) = 1$ 的 $m$ 次残差多项式 $p(z)$，使得 $r_{m} = p_{1}(A) r_{0}$，以及重启 GMRES($m$) 方法在两个循环后如何产生 $r_{2m} = p_{2}(A) p_{1}(A) r_{0}$，作为循环多项式的乘积。\n\n然后，将此框架实例化到以下具体情况：\n$$\nA = \\begin{pmatrix}\n1  0 \\\\\n0  3\n\\end{pmatrix}, \\quad\nb = \\begin{pmatrix}\n1 \\\\\n2\n\\end{pmatrix}, \\quad\nx_{0} = \\begin{pmatrix}\n0 \\\\\n0\n\\end{pmatrix}, \\quad\nm = 1.\n$$\n仅使用在 $\\mathcal{K}_{1}(A,r)$ 上进行 GMRES 最小残差计算的基本原理，精确执行两个 GMRES(1) 循环（即，计算两次连续的单步最小残差更新，并在其间重启），明确追踪产生的 1 次多项式 $p_{1}(z)$ 和 $p_{2}(z)$，并表示出 $r_{2} = p_{2}(A) p_{1}(A) r_{0}$。最后，以封闭形式表达式计算确切的欧几里得 2-范数 $\\|r_{2}\\|_{2}$。无需四舍五入；报告精确值。", "solution": "该问题陈述已经过验证，被认为是可靠、适定且客观的。这是数值线性代数中的一个标准问题。我们可以开始进行解答。\n\n解答分为两部分。首先，我们给出 GMRES 和重启 GMRES 中残差多项式的一般推导。其次，我们将此框架应用于给定的具体数值案例。\n\n### 第 1 部分：GMRES 中残差多项式的推导\n\n广义最小残差 (GMRES) 法是一种求解线性方程组 $A x = b$ 的迭代方法，其中 $A \\in \\mathbb{R}^{n \\times n}$ 是一个非奇异矩阵，$x, b \\in \\mathbb{R}^{n}$。从一个初始猜测值 $x_0$ 开始，GMRES 计算真实解 $x$ 的一系列近似值 $x_k$。\n\n在第 $k$ 次迭代时，近似值 $x_k$ 从仿射克雷洛夫子空间 $x_0 + \\mathcal{K}_{k}(A, r_0)$ 中选取，其中 $r_0 = b - A x_0$ 是初始残差，$\\mathcal{K}_{k}(A, r_0) = \\operatorname{span}\\{r_0, A r_0, \\dots, A^{k-1} r_0\\}$ 是由 $A$ 和 $r_0$ 生成的第 $k$ 个克雷洛夫子空间。\n$x_0 + \\mathcal{K}_{k}(A, r_0)$ 中的任意向量可以写为：\n$$\nx_k = x_0 + \\sum_{j=0}^{k-1} c_j A^j r_0\n$$\n其中 $\\{c_j\\}_{j=0}^{k-1}$ 为一些标量系数。设 $q_{k-1}(z) = \\sum_{j=0}^{k-1} c_j z^j$ 是一个次数至多为 $k-1$ 的多项式。那么，我们可以将 $x_k$ 紧凑地表示为：\n$$\nx_k = x_0 + q_{k-1}(A) r_0\n$$\n相应的残差为 $r_k = b - A x_k$。代入 $x_k$ 的表达式：\n$$\nr_k = b - A(x_0 + q_{k-1}(A) r_0) = (b - A x_0) - A q_{k-1}(A) r_0 = r_0 - A q_{k-1}(A) r_0\n$$\n这可以因式分解为：\n$$\nr_k = (I - A q_{k-1}(A)) r_0\n$$\n我们定义一个多项式 $p_k(z) = 1 - z q_{k-1}(z)$。$p_k(z)$ 的次数至多为 $k$。一个关键性质是 $p_k(0) = 1 - 0 \\cdot q_{k-1}(0) = 1$。根据这个定义，残差可以表示为：\n$$\nr_k = p_k(A) r_0\n$$\nGMRES 的核心原理是选择系数 $\\{c_j\\}$（从而选择多项式 $q_{k-1}(z)$ 和 $p_k(z)$）以最小化残差的欧几里得 2-范数 $\\|r_k\\|_2$。这等价于求解以下最小化问题：\n$$\n\\min_{p \\in \\mathcal{P}_k, p(0)=1} \\|p(A) r_0\\|_2\n$$\n其中 $\\mathcal{P}_k$ 是所有次数至多为 $k$ 的多项式的集合。\n\n对于重启 GMRES($m$) 方法，算法运行 $m$ 次迭代然后重启。GMRES($m$) 的一个完整循环会生成一个近似值 $x_m$ 和一个残差 $r_m$。根据上述推导，这个残差由 $r_m = p_1(A) r_0$ 给出，其中 $p_1(z)$ 是次数至多为 $m$、满足 $p_1(0)=1$ 且解决 $k=m$ 时最小化问题的唯一多项式。\n\n重启过程开始一个新的 GMRES 循环。新的初始猜测值是 $x'_0 = x_m$，新的初始残差是 $r'_0 = b - A x'_0 = b - A x_m = r_m$。第二个循环再运行 $m$ 步以产生残差 $r_{2m}$。这第二个循环是应用于初始残差 $r'_0$ 的标准 $m$ 步 GMRES 运行。因此，最终残差 $r_{2m}$ 由下式给出：\n$$\nr_{2m} = p_2(A) r'_0\n$$\n其中 $p_2(z)$ 是次数至多为 $m$、满足 $p_2(0)=1$ 且解决 $\\min_{p \\in \\mathcal{P}_m, p(0)=1} \\|p(A) r'_0\\|_2$ 的多项式。\n代入 $r'_0 = r_m = p_1(A) r_0$，我们得到两次循环后残差的关系式：\n$$\nr_{2m} = p_2(A) r_m = p_2(A) p_1(A) r_0\n$$\n这表明，GMRES($m$) 两次循环后的残差是通过将两个循环多项式的乘积应用于初始残差 $r_0$ 得到的。\n\n### 第 2 部分：应用于具体案例\n\n我们给定的系统为：\n$$\nA = \\begin{pmatrix} 1  0 \\\\ 0  3 \\end{pmatrix}, \\quad\nb = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}, \\quad\nx_{0} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\quad\nm = 1.\n$$\n我们需要执行两次 GMRES(1) 循环。\n\n首先，计算初始残差：\n$$\nr_0 = b - A x_0 = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} - A \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}.\n$$\n\n**循环 1：计算 $r_1$ 和 $p_1(z)$**\n\n我们执行一步 GMRES ($k=1$)。下一个迭代值 $x_1$ 必须在 $x_0 + \\mathcal{K}_1(A, r_0) = x_0 + \\operatorname{span}\\{r_0\\}$ 中。所以，对于某个标量 $\\alpha$，$x_1 = x_0 + \\alpha r_0$。残差为 $r_1 = b - A x_1 = r_0 - \\alpha A r_0 = (I - \\alpha A) r_0$。我们必须找到使 $\\|r_1\\|_2$ 最小化的 $\\alpha$。这定义了一个最小二乘问题：\n$$\n\\min_{\\alpha} \\|r_0 - \\alpha A r_0\\|_2^2\n$$\n解由 $\\alpha = \\frac{(A r_0)^T r_0}{\\|A r_0\\|_2^2}$ 给出。我们来计算必要的量：\n$$\nA r_0 = \\begin{pmatrix} 1  0 \\\\ 0  3 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 6 \\end{pmatrix}\n$$\n$$\n(A r_0)^T r_0 = \\begin{pmatrix} 1   6 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = 1 \\cdot 1 + 6 \\cdot 2 = 13\n$$\n$$\n\\|A r_0\\|_2^2 = 1^2 + 6^2 = 37\n$$\n所以，最优系数是 $\\alpha = \\frac{13}{37}$。\n这个循环的残差多项式是 $p_1(z) = 1 - \\alpha z$。因此，\n$$\np_1(z) = 1 - \\frac{13}{37}z\n$$\n第一个循环后的残差是 $r_1 = (I - \\frac{13}{37}A) r_0$。我们来计算它：\n$$\nr_1 = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} - \\frac{13}{37} \\begin{pmatrix} 1 \\\\ 6 \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{13}{37} \\\\ 2 - \\frac{78}{37} \\end{pmatrix} = \\begin{pmatrix} \\frac{24}{37} \\\\ \\frac{74-78}{37} \\end{pmatrix} = \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -4 \\end{pmatrix}\n$$\n\n**循环 2：计算 $r_2$ 和 $p_2(z)$**\n\n我们以 $r_1$ 作为新的初始残差重启。我们再执行一步 GMRES。下一个残差 $r_2$ 由 $r_2 = (I - \\beta A) r_1$ 给出，其中 $\\beta$ 最小化 $\\|r_1 - \\beta A r_1\\|_2$。最优的 $\\beta$ 是：\n$$\n\\beta = \\frac{(A r_1)^T r_1}{\\|A r_1\\|_2^2}\n$$\n首先，计算 $A r_1$:\n$$\nA r_1 = A \\left( \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -4 \\end{pmatrix} \\right) = \\frac{1}{37} \\begin{pmatrix} 1  0 \\\\ 0  3 \\end{pmatrix} \\begin{pmatrix} 24 \\\\ -4 \\end{pmatrix} = \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -12 \\end{pmatrix}\n$$\n现在计算 $\\beta$ 的分子和分母：\n$$\n(A r_1)^T r_1 = \\left( \\frac{1}{37} \\begin{pmatrix} 24   -12 \\end{pmatrix} \\right) \\left( \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -4 \\end{pmatrix} \\right) = \\frac{1}{37^2} (24 \\cdot 24 + (-12) \\cdot (-4)) = \\frac{576 + 48}{37^2} = \\frac{624}{37^2}\n$$\n$$\n\\|A r_1\\|_2^2 = \\left\\| \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -12 \\end{pmatrix} \\right\\|_2^2 = \\frac{1}{37^2} (24^2 + (-12)^2) = \\frac{576 + 144}{37^2} = \\frac{720}{37^2}\n$$\n最优系数是 $\\beta = \\frac{624/37^2}{720/37^2} = \\frac{624}{720} = \\frac{13 \\cdot 48}{15 \\cdot 48} = \\frac{13}{15}$。\n这个循环的残差多项式是 $p_2(z) = 1 - \\beta z$。因此，\n$$\np_2(z) = 1 - \\frac{13}{15}z\n$$\n\n**最终计算**\n\n来自两个循环的多项式是 $p_1(z) = 1 - \\frac{13}{37}z$ 和 $p_2(z) = 1 - \\frac{13}{15}z$。两次 GMRES(1) 循环后的最终残差由 $r_2 = p_2(A) p_1(A) r_0$ 给出。\n\n我们可以计算向量 $r_2 = (I - \\frac{13}{15}A) r_1$:\n$$\nr_2 = r_1 - \\frac{13}{15} A r_1 = \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -4 \\end{pmatrix} - \\frac{13}{15} \\left( \\frac{1}{37} \\begin{pmatrix} 24 \\\\ -12 \\end{pmatrix} \\right) = \\frac{1}{37} \\left( \\begin{pmatrix} 24 \\\\ -4 \\end{pmatrix} - \\frac{13}{15} \\begin{pmatrix} 24 \\\\ -12 \\end{pmatrix} \\right)\n$$\n各分量为：\n$$\nr_{2,1} = \\frac{1}{37} \\left( 24 - \\frac{13 \\cdot 24}{15} \\right) = \\frac{24}{37} \\left( 1 - \\frac{13}{15} \\right) = \\frac{24}{37} \\left( \\frac{2}{15} \\right) = \\frac{48}{555} = \\frac{16}{185}\n$$\n$$\nr_{2,2} = \\frac{1}{37} \\left( -4 - \\frac{13(-12)}{15} \\right) = \\frac{4}{37} \\left( -1 + \\frac{13 \\cdot 3}{15} \\right) = \\frac{4}{37} \\left( -1 + \\frac{13}{5} \\right) = \\frac{4}{37} \\left( \\frac{8}{5} \\right) = \\frac{32}{185}\n$$\n所以，最终残差向量是 $r_2 = \\begin{pmatrix} 16/185 \\\\ 32/185 \\end{pmatrix} = \\frac{16}{185} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n\n最后，我们计算其欧几里得 2-范数：\n$$\n\\|r_2\\|_2 = \\left\\| \\frac{16}{185} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} \\right\\|_2 = \\frac{16}{185} \\left\\| \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} \\right\\|_2 = \\frac{16}{185} \\sqrt{1^2 + 2^2} = \\frac{16}{185}\\sqrt{5}\n$$\n值 $185$ 可以因式分解为 $5 \\times 37$。因此，我们可以将范数写为 $\\frac{16\\sqrt{5}}{5 \\cdot 37}$，它不能再化简。", "answer": "$$\\boxed{\\frac{16\\sqrt{5}}{185}}$$", "id": "3542092"}, {"introduction": "虽然重启动是管理内存所必需的折衷方案，但它有时会导致收敛完全停滞，这种现象被称为“停滞”。这项高级练习 [@problem_id:3593977] 要求您构建并分析一个场景，其中重启动的 GMRES(m) 停滞不前，而未重启动的 GMRES 却能完美收敛。通过识别导致此失败的特定几何条件，您将对重启动方法的局限性以及克雷洛夫子空间结构的重要性形成更深刻的直觉。", "problem": "你需要构造一个严格的例子，在其中广义最小残差方法（GMRES）在重启动下表现出根本不同的行为。该任务涉及数值线性代数中的预处理 GMRES 算法。设预处理为左预处理，因此变换后的系统为 $M^{-1} A x = M^{-1} b$，且该算法最小化的残差为 $\\lVert M^{-1} (b - A x) \\rVert_2$。构造和分析必须从关于 Krylov 子空间和残差多项式的基本原理出发。\n\n起始基本定义和事实：\n- 广义最小残差方法 (GMRES) 构造迭代解 $x_k$，使得预处理后的残差满足 $r_k = p_k(M^{-1} A) r_0$，其中 $r_0 = b - A x_0$，$p_k$ 是一个阶数至多为 $k$ 且满足 $p_k(0) = 1$ 的多项式，并且预处理后残差的欧几里得范数在所有此类多项式中被最小化。\n- 由矩阵 $B$ 和向量 $v$ 生成的 Krylov 子空间为 $\\mathcal{K}_k(B, v) = \\operatorname{span}\\{v, B v, B^2 v, \\dots, B^{k-1} v\\}$。\n- 重启动的 GMRES($m$) 在连续的循环中应用 $m$ 阶残差多项式，因此在 $j$ 次循环后，残差为 $r_{jm} = \\left(\\prod_{i=1}^j p_m^{(i)}(M^{-1} A)\\right) r_0$，其中每个 $p_m^{(i)}$ 是一个满足 $p_m^{(i)}(0) = 1$ 且在那个循环中生成的相应 Krylov 子空间上最小化残差的 $m$ 阶多项式。\n\n问题：\n1. 构造一个具体的矩阵 $A \\in \\mathbb{R}^{n \\times n}$、一个左预处理器 $M \\in \\mathbb{R}^{n \\times n}$、一个右端项 $b \\in \\mathbb{R}^n$、一个初始猜测 $x_0 \\in \\mathbb{R}^n$ 以及一个重启动长度 $m$，使得重启动的 GMRES($m$) 停滞（残差范数在不同循环间没有减小），而非重启动的 GMRES 在至多 $n$ 次迭代内收敛到解。使用残差多项式表征以及关于 Krylov 子空间和正交性的几何论证来证明此行为。\n2. 为构建一个科学上合理且可测试的场景，考虑以下使用维度 $n = 4$ 和左预处理的明确测试套件：\n   - 将 $A$ 定义为 $\\mathbb{R}^{4 \\times 4}$ 中的循环下移置换矩阵，即 $A e_1 = e_2$，$A e_2 = e_3$，$A e_3 = e_4$，以及 $A e_4 = e_1$，其中 $(e_i)_{i=1}^4$ 是 $\\mathbb{R}^4$ 中的标准基向量。\n   - 定义左预处理器 $M = \\operatorname{diag}(1, 2, 3, 4)$。\n   - 定义 $b = e_1$ 和 $x_0 = 0$。\n   - 使用重启动长度 $m = 1$ 来演示停滞，使用非重启动的 GMRES 来演示收敛。\n   - 同时测试 $m = 2$ 和 $m = 4$ 以探测中间和边界行为，并测试一个修改后的右端项 $b = e_1 + e_2$ 以打破导致停滞的正交性条件。\n3. 您的程序必须在变换后的系统 $M^{-1} A x = M^{-1} b$ 上实现左预处理 GMRES，并测量原始残差范数 $\\lVert b - A x \\rVert_2$ 进行报告。它必须为指定的测试套件计算以下可量化的输出：\n   - 测试 1（停滞，重启动 GMRES($m=1$)）：在使用 $m = 1$ 进行 $8$ 次重启动循环后，比率 $\\rho_1 = \\lVert r_{\\text{final}} \\rVert_2 / \\lVert r_{\\text{initial}} \\rVert_2$，其中 $r_{\\text{initial}} = b - A x_0$，$r_{\\text{final}}$ 是最终残差。这是一个浮点数。\n   - 测试 2（非重启动 GMRES 收敛）：在不重启动的情况下，经过至多 $n$ 次迭代后的最终残差范数 $\\rho_2 = \\lVert r_{\\text{final}} \\rVert_2$。这是一个浮点数。\n   - 测试 3（$m = 2$ 时的进展）：一个布尔值，指示使用 $m=2$ 的重启动 GMRES 在 $4$ 次重启动循环后是否减小了残差范数，即最终范数是否严格小于初始范数。这是一个布尔值。\n   - 测试 4（边界，$m = n$）：对于使用 $m = 4$ 的重启动 GMRES，在单次循环后的最终残差范数 $\\rho_4 = \\lVert r_{\\text{final}} \\rVert_2$。这是一个浮点数。\n   - 测试 5（通过改变 $b$ 打破停滞）：一个布尔值，指示对于修改后的右端项 $b = e_1 + e_2$，使用 $m=1$ 的重启动 GMRES 在 $8$ 次循环后是否减小了残差范数。这是一个布尔值。\n4. 角度单位和物理单位不适用于这个纯数学问题。所有范数均为 $\\mathbb{R}^n$ 中的欧几里得范数。矩阵和向量的元素是无单位的实数。\n5. 最终输出格式：您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔结果列表（例如，\"[result1,result2,result3,result4,result5]\"），其中 result1 和 result2 是浮点数，result3 和 result5 是布尔值，result4 是浮点数。\n\n您的解答必须使用残差多项式表征 $r_k = p_k(M^{-1} A) r_0$（其中 $p_k(0) = 1$）以及 Krylov 子空间的几何性质来证明您的构造的合理性。代码必须是完整的、可“按原样”运行的，并为给定的测试套件生成指定的输出。", "solution": "该问题要求构造一个数值线性代数中的例子，其中重启动的广义最小残差方法（GMRES）停滞，而非重启动的 GMRES 收敛。分析必须基于 Krylov 子空间和残差多项式的基本原理。\n\nGMRES 算法的核心在于从一个仿射子空间 $x_0 + \\mathcal{K}_k(B, \\tilde{r}_0)$ 中找到线性系统 $Bx=c$ 的一个近似解 $x_k$，其中 $x_0$ 是一个初始猜测，$\\mathcal{K}_k(B, \\tilde{r}_0) = \\operatorname{span}\\{\\tilde{r}_0, B\\tilde{r}_0, \\dots, B^{k-1}\\tilde{r}_0\\}$ 是由矩阵 $B$ 和初始残差 $\\tilde{r}_0 = c - Bx_0$ 生成的 $k$ 阶 Krylov 子空间。迭代解 $x_k$ 的选择方式是使其残差 $r_k = c - Bx_k$ 具有最小可能的欧几里得范数 $\\lVert r_k \\rVert_2$。对于一个左预处理系统 $M^{-1}Ax = M^{-1}b$，我们令 $B = M^{-1}A$ 和 $c = M^{-1}b$。GMRES 随后最小化预处理后残差的范数，即 $\\lVert M^{-1}(b-Ax_k) \\rVert_2$。\n\nGMRES 的一个关键几何性质是，新的预处理残差 $\\tilde{r}_k = M^{-1}(b - Ax_k)$ 与子空间 $B \\mathcal{K}_k(B, \\tilde{r}_0)$ 正交，其中 $\\tilde{r}_0 = M^{-1}(b - Ax_0)$ 是初始的预处理残差。重启动 GMRES($m$) 中的停滞发生在算法从一个循环到下一个循环没有任何进展时。如果在一个循环结束时的预处理残差向量 $\\tilde{r}_m$ 与该循环开始时的向量 $\\tilde{r}_0$ 成比例，并且范数的减小为零或可忽略不计，就会发生这种情况。如果 $\\tilde{r}_m=\\tilde{r}_0$，则完全没有进展（零减小）。这在特定条件下发生：如果初始预处理残差 $\\tilde{r}_0$ 已经与用于残差更新的搜索空间 $B\\mathcal{K}_m(B, \\tilde{r}_0)$ 正交。在这种情况下，零更新满足了最小性条件，导致 $\\tilde{r}_m = \\tilde{r}_0$。\n\n我们使用指定的参数构造这样一个例子。\n设 $n=4$。系统矩阵是循环下移置换矩阵：\n$$A = \\begin{pmatrix} 0  0  0  1 \\\\ 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\end{pmatrix}$$\n左预处理器是一个对角矩阵：\n$$M = \\operatorname{diag}(1, 2, 3, 4) = \\begin{pmatrix} 1  0  0  0 \\\\ 0  2  0  0 \\\\ 0  0  3  0 \\\\ 0  0  0  4 \\end{pmatrix}$$\n右端项向量是 $b = e_1 = (1, 0, 0, 0)^T$，初始猜测是 $x_0 = 0$。\n\n预处理后的矩阵是 $B = M^{-1}A$：\n$$B = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1/2  0  0 \\\\ 0  0  1/3  0 \\\\ 0  0  0  1/4 \\end{pmatrix} \\begin{pmatrix} 0  0  0  1 \\\\ 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\end{pmatrix} = \\begin{pmatrix} 0  0  0  1 \\\\ 1/2  0  0  0 \\\\ 0  1/3  0  0 \\\\ 0  0  1/4  0 \\end{pmatrix}$$\n初始残差是 $r_0 = b - Ax_0 = e_1$。初始预处理残差是 $\\tilde{r}_0 = M^{-1}r_0 = M^{-1}e_1 = e_1$。\n\n**1. 重启动 GMRES(m) 停滞分析 ($m  4$)**\n\n考虑重启动长度为 $m  4$ 的 GMRES($m$)。第一个循环从 $\\tilde{r}_0=e_1$ 开始。Krylov 子空间是 $\\mathcal{K}_m(B, e_1)$。\n我们来计算基向量：\n$e_1$\n$B e_1 = (1/2)e_2$\n$B^2 e_1 = (1/6)e_3$\n$B^3 e_1 = (1/24)e_4$\nKrylov 子空间是 $\\mathcal{K}_m(B, e_1) = \\operatorname{span}\\{e_1, e_2, \\dots, e_m\\}$。\n新残差必须与之正交的子空间是 $B \\mathcal{K}_m(B, e_1) = \\operatorname{span}\\{B e_1, \\dots, B^m e_1\\} = \\operatorname{span}\\{e_2, e_3, \\dots, e_{m+1}\\}$。\n\n对于任何 $m  4$，子空间 $\\mathcal{K}_m(B, e_1)$ 和 $B\\mathcal{K}_m(B, e_1)$ 关于标准内积是正交的，因为它们由不相交的标准基向量集合张成。例如，对于 $m=1$，$\\mathcal{K}_1(B, e_1) = \\operatorname{span}\\{e_1\\}$ 且 $B\\mathcal{K}_1(B, e_1) = \\operatorname{span}\\{e_2\\}$，它们是正交的。\n初始预处理残差 $\\tilde{r}_0 = e_1$ 位于 $\\mathcal{K}_m(B, e_1)$ 中，因此与 $B\\mathcal{K}_m(B, e_1)$ 中的每个向量都正交。\nGMRES 条件要求新残差 $\\tilde{r}_m$ 与 $B\\mathcal{K}_m(B, e_1)$ 正交。由于 $\\tilde{r}_0$ 已经满足此正交性条件，算法发现最优选择是 $\\tilde{r}_m = \\tilde{r}_0$，这对应于零校正，$x_m = x_0$。残差范数不减小。这就是停滞。此推理适用于任何重启动循环，以及任何重启动长度 $m=1, 2, 3$。\n从残差多项式的角度来看，该算法寻求一个阶数至多为 $m$ 且满足 $p_m(0)=1$ 的多项式 $p_m(z)$，以最小化 $\\lVert p_m(B) \\tilde{r}_0 \\rVert_2$。这个范数是 $\\lVert p_m(B) e_1 \\rVert_2$。因为向量 $e_1, Be_1, \\dots, B^m e_1$ 是相互正交的，我们有 $\\lVert p_m(B) e_1 \\rVert_2^2 = \\sum_{j=0}^m c_j^2 \\lVert B^j e_1 \\rVert_2^2$ 对于 $p_m(z)=\\sum c_j z^j$。由于 $c_0=p_m(0)=1$，当所有其他系数都为零时达到最小值，即 $p_m(z)=1$。因此，$\\tilde{r}_m = p_m(B)\\tilde{r}_0 = \\tilde{r}_0$。\n\n**2. 非重启动 GMRES 收敛性分析 ($m=4$)**\n\n对于非重启动的 GMRES，算法最多运行 $n=4$ 次迭代，构建子空间 $\\mathcal{K}_4(B, e_1) = \\operatorname{span}\\{e_1, (1/2)e_2, (1/6)e_3, (1/24)e_4\\} = \\operatorname{span}\\{e_1, e_2, e_3, e_4\\} = \\mathbb{R}^4$。由于 Krylov 子空间是整个解空间，GMRES 保证能找到使残差为零的精确校正量 $z_4 = x_{exact} - x_0$。因此，非重启动的 GMRES（等价于一个周期的 GMRES(4)）收敛到精确解，最终的残差范数，无论是预处理后的还是原始的，都将为零（或机器精度）。\n\n**3. 打破停滞的分析 ($b = e_1+e_2$)**\n\n让我们将右端项改为 $b = e_1 + e_2$。初始残差为 $r_0 = e_1 + e_2$，预处理后的初始残差为 $\\tilde{r}_0 = M^{-1}(e_1 + e_2) = e_1 + (1/2)e_2$。\n现在考虑 GMRES(1)。Krylov 子空间是 $\\mathcal{K}_1(B, \\tilde{r}_0) = \\operatorname{span}\\{e_1 + (1/2)e_2\\}$。\n用于残差更新的子空间是 $B\\mathcal{K}_1(B, \\tilde{r}_0) = \\operatorname{span}\\{B(e_1 + (1/2)e_2)\\}$。\n$B(e_1 + (1/2)e_2) = B e_1 + (1/2)B e_2 = (1/2)e_2 + (1/2)M^{-1}Ae_2 = (1/2)e_2 + (1/2)M^{-1}e_3 = (1/2)e_2 + (1/6)e_3$。\n通过内积检查关键的正交性条件：\n$$ \\tilde{r}_0^T (B \\tilde{r}_0) = (e_1 + (1/2)e_2)^T ((1/2)e_2 + (1/6)e_3) = (1/2)(1/2) = 1/4 \\neq 0 $$\n由于 $\\tilde{r}_0$ 与 $B\\mathcal{K}_1(B, \\tilde{r}_0)$ 不正交，GMRES 更新将是非零的。算法会将 $\\tilde{r}_0$ 投影到 $B\\mathcal{K}_1(B, \\tilde{r}_0)$ 的正交补上，从而得到一个新的残差 $\\tilde{r}_1$，其范数满足 $\\lVert\\tilde{r}_1\\rVert_2  \\lVert\\tilde{r}_0\\rVert_2$。因此，停滞被打破，GMRES(1) 将在每个循环中取得进展。\n\n这完成了对指定测试用例中观察到的行为的理论证明。所构造的例子巧妙地分离出了导致重启动 GMRES 中停滞的几何条件。", "answer": "```python\nimport numpy as np\nfrom scipy.sparse.linalg import gmres\n\ndef solve():\n    \"\"\"\n    Constructs and solves the test cases for GMRES stagnation and convergence.\n    \"\"\"\n    n = 4\n    # Define standard basis vectors\n    e1 = np.zeros(n)\n    e1[0] = 1.0\n    e2 = np.zeros(n)\n    e2[1] = 1.0\n\n    # Define the matrix A as the cyclic down-shift permutation matrix\n    A = np.roll(np.eye(n), 1, axis=0)\n\n    # Define the diagonal preconditioner M\n    M = np.diag(np.arange(1, n + 1).astype(float))\n    \n    # Define the initial guess\n    x0 = np.zeros(n)\n    \n    # Define the inverse of the preconditioner\n    M_inv = np.linalg.inv(M)\n    \n    # Pre-compute the transformed matrix for the left-preconditioned system\n    A_tilde = M_inv @ A\n\n    results = []\n\n    # --- Test 1: Stagnation with m=1 ---\n    # b = e1, m=1, 8 restart cycles\n    b1 = e1\n    r_initial_norm_1 = np.linalg.norm(b1 - A @ x0)\n    b_tilde_1 = M_inv @ b1\n    # For m=1 and 8 cycles, restart=1 and maxiter=8\n    x_final_1, _ = gmres(A_tilde, b_tilde_1, x0=x0, restart=1, maxiter=8, atol=1e-12)\n    r_final_1 = b1 - A @ x_final_1\n    rho1 = np.linalg.norm(r_final_1) / r_initial_norm_1\n    results.append(rho1)\n\n    # --- Test 2: Unrestarted GMRES convergence ---\n    # b = e1, unrestarted (m=n=4), max n iterations\n    # For unrestarted GMRES with n=4, restart=4 and maxiter=4\n    x_final_2, _ = gmres(A_tilde, b_tilde_1, x0=x0, restart=4, maxiter=4, atol=1e-12)\n    r_final_2 = b1 - A @ x_final_2\n    rho2 = np.linalg.norm(r_final_2)\n    results.append(rho2)\n\n    # --- Test 3: Progress for m=2 ---\n    # b = e1, m=2, 4 restart cycles. Check for any reduction in norm.\n    r_initial_norm_3 = np.linalg.norm(b1 - A @ x0)\n    # For m=2 and 4 cycles, restart=2 and maxiter=8\n    x_final_3, _ = gmres(A_tilde, b_tilde_1, x0=x0, restart=2, maxiter=8, atol=1e-12)\n    r_final_norm_3 = np.linalg.norm(b1 - A @ x_final_3)\n    progress_3 = r_final_norm_3  r_initial_norm_3\n    results.append(progress_3)\n\n    # --- Test 4: Boundary case m=n ---\n    # b = e1, m=4, 1 cycle. This is identical to unrestarted GMRES.\n    # For m=4 and 1 cycle, restart=4 and maxiter=4\n    x_final_4, _ = gmres(A_tilde, b_tilde_1, x0=x0, restart=4, maxiter=4, atol=1e-12)\n    r_final_4 = b1 - A @ x_final_4\n    rho4 = np.linalg.norm(r_final_4)\n    results.append(rho4)\n\n    # --- Test 5: Breaking stagnation by changing b ---\n    # b = e1+e2, m=1, 8 cycles. Check for any reduction in norm.\n    b5 = e1 + e2\n    r_initial_norm_5 = np.linalg.norm(b5 - A @ x0)\n    b_tilde_5 = M_inv @ b5\n    # For m=1 and 8 cycles, restart=1 and maxiter=8\n    x_final_5, _ = gmres(A_tilde, b_tilde_5, x0=x0, restart=1, maxiter=8, atol=1e-12)\n    r_final_norm_5 = np.linalg.norm(b5 - A @ x_final_5)\n    progress_5 = r_final_norm_5  r_initial_norm_5\n    results.append(progress_5)\n\n    # Format the final output string exactly as specified\n    formatted_results = []\n    for res in results:\n        if isinstance(res, bool):\n            formatted_results.append(str(res).lower())\n        else:\n            formatted_results.append(f\"{res:.15e}\") # Use scientific notation for precision\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3593977"}]}