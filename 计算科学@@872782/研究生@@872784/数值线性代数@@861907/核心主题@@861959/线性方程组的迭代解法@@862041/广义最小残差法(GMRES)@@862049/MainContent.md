## 引言
在现代科学与工程计算的前沿，求解大规模线性方程组 $Ax=b$ 是一项基础而又充满挑战的任务。当系数矩阵 $A$ 既非对称也非正定时——这种情况在[流体力学](@entry_id:136788)、电磁学和[复杂系统建模](@entry_id:203520)中屡见不鲜——诸如[共轭梯度法](@entry_id:143436)等经典迭代方法便[无能](@entry_id:201612)为力。为了填补这一空白，[广义最小残差](@entry_id:637119)方法（GMRES）应运而生，它凭借其稳健性和普适性，已成为数值线性代数领域中不可或缺的工具。GMRES 的优雅之处在于其核心思想：在每一步迭代中，总能保证找到一个使[残差范数](@entry_id:754273)最小的近似解。

本文将带领您系统地探索 GMRES 的世界。我们将从第一性原理出发，逐步揭示其深刻的数学内涵与高效的算法实现。
*   在“**原理与机制**”一章中，我们将深入剖析 GMRES 的核心——克雷洛夫子空间与[残差最小化](@entry_id:754272)，并详细阐述其算法基石 Arnoldi 过程，同时探讨其收敛行为与实际挑战。
*   接下来，“**应用与交叉学科联系**”一章将展示 GMRES 如何从理论走向实践，通过无矩阵[范式](@entry_id:161181)、在[偏微分方程](@entry_id:141332)求解中的关键作用以及与多学科的深刻联系，彰显其强大的应用价值。
*   最后，“**动手实践**”部分提供了一系列精心设计的练习，旨在通过具体的计算和概念性问题，巩固您对 GMRES 运行机制和性能特点的理解。

通过本次学习，您将不仅掌握 GMRES 的“如何做”，更将理解其“为什么”如此设计，从而能够在自己的研究和工程问题中更自信、更有效地运用这一强大的数值方法。让我们首先进入第一章，探究 GMRES 背后的基本原理。

## 原理与机制

在求解[大型稀疏线性系统](@entry_id:137968) $Ax=b$ 的迭代方法中，[广义最小残差](@entry_id:637119)方法（GMRES）占据着核心地位。它专为求解[系数矩阵](@entry_id:151473) $A$ 为非对称、非正定的系统而设计，这在科学与工程计算中是常见情况。本章旨在深入剖析 GMRES 的核心原理、算法机制、收敛特性以及关键的实践考量。我们将从第一性原理出发，系统地构建 GMRES 方法的理论框架。

### 核心原理：在[克雷洛夫子空间](@entry_id:751067)中最小化残差

GMRES 的基本思想是，从一个初始猜测 $x_0$ 出发，在某个精心挑选的[子空间](@entry_id:150286)内寻找一个“修正量”，使得修正后的解对应的[残差范数](@entry_id:754273)最小。GMRES 所选择的这个[子空间](@entry_id:150286)，正是著名的 **克雷洛夫子空间 (Krylov subspace)**。

给定一个矩阵 $A \in \mathbb{C}^{n \times n}$ 和一个初始向量 $r_0$（通常是初始残差 $r_0 = b - Ax_0$），由 $A$ 和 $r_0$ 生成的 $m$ 阶[克雷洛夫子空间](@entry_id:751067)定义为：
$$
\mathcal{K}_m(A, r_0) = \operatorname{span}\{r_0, Ar_0, A^2r_0, \dots, A^{m-1}r_0\}
$$
这个[子空间](@entry_id:150286)包含了 $A$ 的幂次重复作用于初始残差所能触及的所有向量的线性组合。GMRES 方法在第 $m$ 步迭[代时](@entry_id:173412)，在一个仿射[子空间](@entry_id:150286) $x_0 + \mathcal{K}_m(A, r_0)$ 中寻找近似解 $x_m$。

GMRES 的 **核心定义** 是：在每一步 $m$，它都选择一个 $x_m \in x_0 + \mathcal{K}_m(A, r_0)$，使得欧几里得范数下的残差 $\|r_m\|_2 = \|b - Ax_m\|_2$ 达到最小 [@problem_id:3588153]。

理解[克雷洛夫子空间](@entry_id:751067)的性质至关重要。首先，它显式地依赖于初始向量 $r_0$；不同的 $r_0$ 会生成不同的[子空间](@entry_id:150286)。其次，克雷洛夫子空间通常 **不是** $A$ 的 **不变子空间 (invariant subspace)**。一个[子空间](@entry_id:150286) $\mathcal{S}$ 是不变的，如果 $A\mathcal{S} \subseteq \mathcal{S}$。然而，克雷洛夫子空间仅满足一个较弱的嵌套属性：$A\mathcal{K}_m(A, r_0) \subseteq \mathcal{K}_{m+1}(A, r_0)$。这意味着 $A$ 的作用会将一个 $m$ 阶克雷洛夫子空间映射到一个 $m+1$ 阶的[子空间](@entry_id:150286)内，但通常不会停留在 $m$ 阶[子空间](@entry_id:150286)自身。这个“扩张”的特性是算法能够不断探索新方向、逼近真实解的关键。只有在特殊情况下，例如当 $\mathcal{K}_m(A, r_0)$ 恰好成为一个不变子空间时，这种扩张才会停止。一个极端的例子是，如果初始残差 $r_0$ 恰好是 $A$ 的一个[特征向量](@entry_id:151813)，那么 $\mathcal{K}_m(A, r_0)$ 对所有 $m$ 都退化为一维[子空间](@entry_id:150286) $\operatorname{span}\{r_0\}$，而这个[子空间](@entry_id:150286)本身就是一个[不变子空间](@entry_id:152829) [@problem_id:3588192]。

由于搜索空间是嵌套的，即 $\mathcal{K}_m(A, r_0) \subseteq \mathcal{K}_{m+1}(A, r_0)$，因此仿射搜索空间也是嵌套的 $x_0 + \mathcal{K}_m(A, r_0) \subseteq x_0 + \mathcal{K}_{m+1}(A, r_0)$。在嵌套的集合上最小化同一个[目标函数](@entry_id:267263)，得到的最小值必然是单调不增的。因此，GMRES 生成的[残差范数](@entry_id:754273)序列 $\{\|r_m\|_2\}_{m \ge 0}$ 是 **单调不增** 的。值得注意的是，这并不意味着[残差范数](@entry_id:754273)是 *严格* 单调递减的。在某些情况下，算法可能会“停滞”，即 $\|r_{m+1}\|_2 = \|r_m\|_2 > 0$ [@problem_id:3616830]。我们稍后会深入探讨这种停滞现象。

### [最优性条件](@entry_id:634091)：[Petrov-Galerkin](@entry_id:174072) 视角

GMRES 的[最小化原理](@entry_id:169952)可以转化为一个几何上的[正交性条件](@entry_id:168905)。设 $x_m = x_0 + z_m$，其中 $z_m \in \mathcal{K}_m(A, r_0)$。残差为 $r_m = b - A(x_0 + z_m) = r_0 - Az_m$。GMRES 的目标是寻找 $z_m$，使得 $\|r_0 - Az_m\|_2$ 最小。

这本质上是一个线性[最小二乘问题](@entry_id:164198)：在[子空间](@entry_id:150286) $A\mathcal{K}_m(A, r_0)$ 中寻找向量 $Az_m$，使其成为 $r_0$ 的最佳逼近。线性[最小二乘问题](@entry_id:164198)的解具有一个众所周知的性质：误差向量（即新的残差 $r_m$）必须与逼近所在的[子空间](@entry_id:150286)（即 $A\mathcal{K}_m(A, r_0)$）正交。

因此，GMRES 的[最优性条件](@entry_id:634091)是：
$$
r_m \perp A\mathcal{K}_m(A, r_0)
$$
这意味着对于任何向量 $v \in A\mathcal{K}_m(A, r_0)$，我们都有 $\langle r_m, v \rangle = 0$。这个条件也被称为 **[Petrov-Galerkin](@entry_id:174072) 条件** [@problem_id:3616830] [@problem_id:3588153]。在这个视角下，GMRES 在 **試探子空間 (trial subspace)** $\mathcal{K}_m(A, r_0)$ 中寻找修正量，并要求残差与 **測試子空間 (test subspace)** $A\mathcal{K}_m(A, r_0)$ 正交。

这个条件揭示了 GMRES 的深刻内涵。如果我们用误差 $e_m = x - x_m$ 来表示（其中 $x$ 是真实解），那么 $r_m = Ae_m$。[正交性条件](@entry_id:168905) $r_m \perp A\mathcal{K}_m(A, r_0)$ 可以改写为 $\langle Ae_m, Aw \rangle = 0$ 对所有 $w \in \mathcal{K}_m(A, r_0)$ 成立。这等价于 $(A^T A e_m, w) = 0$，即 $e_m$ 在由 $A^T A$ 定义的[能量内积](@entry_id:167297)下与試探子空間 $\mathcal{K}_m(A, r_0)$ 正交 [@problem_id:3616888]。

将此与针对对称正定（SPD）矩阵的共轭梯度法（CG）对比是很有启发性的。CG 方法在 $A$ 定义的[能量范数](@entry_id:274966) $\|e_m\|_A = \sqrt{e_m^T A e_m}$ 下最小化误差，其[最优性条件](@entry_id:634091)是 $r_m \perp \mathcal{K}_m(A, r_0)$，这被称为 Galerkin 条件。GMRES 的 [Petrov-Galerkin](@entry_id:174072) 条件 ($r_m \perp A\mathcal{K}_m$) 与 CG 的 Galerkin 条件 ($r_m \perp \mathcal{K}_m$) 在一般情况下是不同的，除非 $A\mathcal{K}_m = \mathcal{K}_m$（即[子空间](@entry_id:150286)不变），这只在非常特殊的情况下发生。只有当 $A$ 是[单位矩阵](@entry_id:156724)的正数倍（$A = \alpha I, \alpha > 0$）时，这两种方法对于任意 $m$ 和 $r_0$ 才产生相同的迭代序列 [@problem_id:3588153]。

### 算法机制：Arnoldi 过程

我们已经确立了 GMRES 的“做什么”（最小化残差）和“满足什么条件”（[Petrov-Galerkin](@entry_id:174072) 正交性），现在的问题是“如何高效地做到”。直接构造克雷洛夫基 $\{r_0, Ar_0, \dots\}$ 并求解[最小二乘问题](@entry_id:164198)是数值不稳定的，因为 $A^k r_0$ 会逐渐趋向于 $A$ 的[主特征向量](@entry_id:264358)方向。

GMRES 的核心机制是 **Arnoldi 过程**，这是一种稳健的算法，用于构建[克雷洛夫子空间](@entry_id:751067)的一组 **[标准正交基](@entry_id:147779)**。从 $v_1 = r_0 / \|r_0\|_2$ 开始，Arnoldi 过程逐步生成一组[标准正交向量](@entry_id:152061) $\{v_1, v_2, \dots, v_m\}$，使得它们张成的空间与 $\mathcal{K}_m(A, r_0)$ 完全相同。

该过程的第 $j$ 步如下 [@problem_id:3588177]：
1. 计算 $w = Av_j$。
2. 对 $w$ 与所有已生成的[基向量](@entry_id:199546) $\{v_1, \dots, v_j\}$ 进行正交化（通常使用更稳定的修正 Gram-Schmidt 法）。对于 $i=1, \dots, j$，计算投影系数 $h_{ij} = \langle w, v_i \rangle$ 并从 $w$ 中减去投影分量：$w \leftarrow w - h_{ij}v_i$。
3. 计算新[向量的范数](@entry_id:154882) $h_{j+1, j} = \|w\|_2$。
4. 如果 $h_{j+1, j} = 0$，[算法终止](@entry_id:143996)（稍后讨论）。否则，进行标准化得到下一个[基向量](@entry_id:199546) $v_{j+1} = w / h_{j+1, j}$。

经过 $m$ 步后，这个过程产生了一个 $n \times (m+1)$ 的矩阵 $V_{m+1} = [v_1, \dots, v_{m+1}]$，其列向量标准正交；以及一个 $(m+1) \times m$ 的 **上 Hessenberg 矩阵** $\bar{H}_m$，其元素为 $h_{ij}$。它们满足一个至关重要的关系式，即 **Arnoldi 关系**：
$$
AV_m = V_{m+1} \bar{H}_m
$$
其中 $V_m = [v_1, \dots, v_m]$。这个关系式是 GMRES 算法的核心，它将高维空间中 $A$ 的作用，投影到了由标准正交基 $V_{m+1}$ 张成的低维空间中，并用一个小规模的 Hessenberg 矩阵 $\bar{H}_m$ 来表示。

现在，我们可以利用 Arnoldi 关系来转化 GMRES 的最小化问题。我们寻找的解 $x_m = x_0 + z_m$，其中 $z_m \in \mathcal{K}_m(A, r_0)$。由于 $V_m$ 是 $\mathcal{K}_m$ 的一组基，我们可以设 $z_m = V_m y_m$，其中 $y_m \in \mathbb{C}^m$ 是待求的[坐标向量](@entry_id:153319)。残差可以表示为：
$$
\begin{align*}
r_m  = r_0 - A z_m \\
 = r_0 - A V_m y_m \\
 = \|r_0\|_2 v_1 - V_{m+1} \bar{H}_m y_m
\end{align*}
$$
令 $\beta = \|r_0\|_2$，并注意到 $v_1$ 是 $V_{m+1}$ 的第一列，即 $v_1 = V_{m+1} e_1$（其中 $e_1 = [1, 0, \dots, 0]^T$），我们得到：
$$
r_m = V_{m+1} (\beta e_1 - \bar{H}_m y_m)
$$
由于 $V_{m+1}$ 的列是标准正交的，它是一个保范变换（isometry），即 $\|V_{m+1}z\|_2 = \|z\|_2$。因此，最小化 $\|r_m\|_2$ 等价于最小化 $\|\beta e_1 - \bar{H}_m y_m\|_2$。

至此，GMRES 成功地将一个 $n$ 维空间中的抽象[优化问题](@entry_id:266749)，转化为了一个 $(m+1) \times m$ 的、小规模的、具体的[最小二乘问题](@entry_id:164198) [@problem_id:3588177]：
$$
\min_{y_m \in \mathbb{C}^m} \|\beta e_1 - \bar{H}_m y_m\|_2
$$
这个问题可以使用 QR 分解等标准方法高效求解。一旦求得 $y_m$，即可更新解 $x_m = x_0 + V_m y_m$。

值得注意的是，如果矩阵 $A$ 是 Hermite 的（在实数情况下是对称的），Arnoldi 过程会自然简化。Hessenberg 矩阵 $\bar{H}_m$ 会退化为一个实[对称三对角矩阵](@entry_id:755732)。这导致了著名的 **Lanczos 过程**，它只需要一个[三项递推关系](@entry_id:176845)，大大降低了计算和存储成本。基于 Lanczos 过程的 [MINRES](@entry_id:752003) 和[共轭梯度](@entry_id:145712)（CG）等方法比 GMRES 更高效，但它们仅适用于 Hermite (或对称) 矩阵 [@problem_id:3588177]。GMRES 的普适性正源于它对一般非 Hermite 矩阵的处理能力。

### 收敛行为与病态问题

#### 有限步收敛与“幸运” breakdown
GMRES 是一个精确算法，在没有[舍入误差](@entry_id:162651)的情况下，它保证在最多 $n$ 步内找到[方程组](@entry_id:193238)的精确解。收敛也可能提前发生。如果在 Arnoldi 过程的第 $m$ 步出现 $h_{m+1, m}=0$，这被称为“**幸运 breakdown**”。这意味着 $A v_m$ 完全落在已生成的[子空间](@entry_id:150286) $\mathcal{K}_m(A, r_0)$ 中，即 $\mathcal{K}_m(A, r_0)$ 是一个不变子空间。此时，最小二乘问题 $\|\beta e_1 - \bar{H}_m y_m\|_2$ 的残差可以被优化到零。这意味着 GMRES 可以在第 $m$ 步找到精确解，从而使得 $\|r_m\|_2=0$ [@problem_id:3616892]。

#### 停滞现象
与幸运 breakdown 相对的是算法的停滞。当算法无法进一步减小[残差范数](@entry_id:754273)时，即 $\|r_m\|_2 = \|r_{m-1}\|_2 > 0$，就会发生 **停滞 (stagnation)**。这种情况的发生机制是，新的搜索方向 $A^m r_0$ 对减小残差没有任何贡献。一个典型的例子是，当初始残差 $r_0$ 属于 $A$ 的某个[不变子空间](@entry_id:152829) $S$，并且 $r_0$ 与 $A$ 在该[子空间](@entry_id:150286)上的像 $A(S)$ 正交时。此时，任何来自 $S$ 的修正量 $z \in S$ 都会被 $A$ 映射到 $A(S)$ 内，因此 $Az$ 与 $r_0$ 正交。根据勾股定理，$\|r_0 - Az\|_2^2 = \|r_0\|_2^2 + \|Az\|_2^2 \ge \|r_0\|_2^2$。最小化这个表达式的唯一方法是取 $z=0$，这意味着算法无法做出任何有效更新，残差从第一步开始就 stagnate [@problem_id:3588155]。

#### 收敛界与[非正规性](@entry_id:752585)
GMRES 的收敛速度与矩阵 $A$ 的谱特性密切相关。可以将 GMRES 的残差表示为 $r_m = p_m(A)r_0$，其中 $p_m(z)$ 是一个次数不超过 $m$ 且满足 $p_m(0)=1$ 的多项式。GMRES 实际上是在寻找最优的此类多项式，以最小化 $\|p_m(A)r_0\|_2$。

如果 $A$ 是 **[正规矩阵](@entry_id:185943) (normal matrix)**（即 $A^TA=AA^T$），收敛行为可以用其[特征值](@entry_id:154894) $\Lambda(A)$ 很好地刻画。[残差范数](@entry_id:754273)满足如下上界：
$$
\frac{\|r_m\|_2}{\|r_0\|_2} \le \min_{\substack{p \in \Pi_m \\ p(0)=1}} \max_{\lambda \in \Lambda(A)} |p(\lambda)|
$$
其中 $\Pi_m$ 是所有次数不超过 $m$ 的复多项式集合 [@problem_id:3616830]。这个界表明，如果 $A$ 的[特征值](@entry_id:154894)远离原点且聚集在一起，我们就能找到一个低阶多项式 $p_m(z)$，使其在所有[特征值](@entry_id:154894)上都取很小的值，从而实现快速收敛。

然而，对于 **[非正规矩阵](@entry_id:752668) (non-normal matrix)**，仅靠[特征值](@entry_id:154894)信息是远远不够的。矩阵的[非正规性](@entry_id:752585)会导致 $\|p(A)\|_2$ 的值远大于 $\max_{\lambda \in \Lambda(A)} |p(\lambda)|$。更精确的收敛界需要引入 $A$ 的[特征向量](@entry_id:151813)矩阵 $X$ 的谱条件数 $\kappa_2(X) = \|X\|_2 \|X^{-1}\|_2$：
$$
\frac{\|r_m\|_2}{\|r_0\|_2} \le \kappa_2(X) \min_{\substack{p \in \Pi_m \\ p(0)=1}} \max_{\lambda \in \Lambda(A)} |p(\lambda)|
$$
即使[特征值分布](@entry_id:194746)非常“有利”（例如，都在单位圆上），一个巨大的 $\kappa_2(X)$（表示[特征向量](@entry_id:151813)之间接近线性相关）也会导致收敛[上界](@entry_id:274738)非常宽松，并可能伴随实际收敛过程中的初始平台期或“驼峰”现象。此时，矩阵的 **[数值域](@entry_id:752817) (field of values)** 或 **伪谱 (pseudospectra)** 更能准确预测 GMRES 的收敛行为 [@problem_id:3588158]。

### 实用变体：重启动与预处理

#### 重启动 GMRES
标准的 GMRES 方法（有时称为 “full” GMRES）在每一步都需要存储所有已生成的[基向量](@entry_id:199546) $v_i$，并与新的向量进行正交化。随着迭代步数 $m$ 的增加，存储和计算成本会变得难以承受。

为了解决这个问题，**重启动 GMRES (restarted GMRES)**，记作 GMRES($k$)，被广泛使用。该方法运行 $k$ 步标准的 GMRES，然后用得到的解 $x_k$ 作为新的初始猜测，计算新的残差，并“丢弃”所有已生成的克雷洛夫子空间信息，重新开始新一轮的 $k$ 步迭代 [@problem_id:3588189]。

重启动的代价是牺牲了 full GMRES 的最优性。Full GMRES 在第 $m$ 步时，其残差多项式是在所有次数不超过 $m$ 且 $p(0)=1$ 的多项式集合 $\mathcal{P}_m^1$ 中进行[全局优化](@entry_id:634460)。而经过 $s$ 轮的 GMRES($k$) 后，总迭代步数为 $m=sk$，其残差多项式 $p(z)$ 是一系列次数为 $k$ 的多项式 $q_j(z)$ 的乘积：$p(z) = q_s(z) \cdots q_1(z)$。虽然这个乘积 $p(z)$ 仍然属于 $\mathcal{P}_{sk}^1$ 集合，但算法是通过 $s$ 次独立的、贪心的局部优化来构造它的，而不是一次性地在整个 $\mathcal{P}_{sk}^1$ 集合中寻找全局最优解。

这种次优性可能导致[收敛速度](@entry_id:636873)变慢，甚至在 full GMRES 能快速收敛的情况下出现停滞。尽管如此，GMRES($k$) 保证了在每个重启周期内以及周期之间，[残差范数](@entry_id:754273)都是单调不增的 [@problem_id:3588189]。选择合适的重启参数 $k$ 是在[收敛速度](@entry_id:636873)和资源消耗之间的一种权衡。

#### 预处理
**[预处理](@entry_id:141204) (preconditioning)** 是加速迭代方法收敛的最重要技术之一。其思想是将原系统 $Ax=b$ 转化为一个谱特性更好（例如，[特征值](@entry_id:154894)更聚集，或更接近正规）的等价系统。对于 GMRES，主要有两种预处理方式：

1.  **[左预处理](@entry_id:165660) (Left Preconditioning)**：选择一个非奇异矩阵 $M$（预处理器），应用 GMRES 求解变换后的系统 $(M^{-1}A)x = M^{-1}b$。在这种情况下，GMRES 最小化的是 **[预处理](@entry_id:141204)后的[残差范数](@entry_id:754273)**，即 $\|M^{-1}(b-Ax)\|_2$。这意味着算法的[收敛判据](@entry_id:158093)是基于变换后的残差，而不是原始系统的残差 [@problem_id:3588169]。

2.  **[右预处理](@entry_id:173546) (Right Preconditioning)**：通过变量替换 $x = M^{-1}y$ 将原系统变为 $(AM^{-1})y = b$。首先用 GMRES 求解关于 $y$ 的系统，然后通过 $x_m = M^{-1}y_m$ 得到原问题的解。在这种情况下，GMRES 最小化的是 $\|b - (AM^{-1})y\|_2$。由于 $b - (AM^{-1})y_m = b - Ax_m$，[右预处理](@entry_id:173546)实际上最小化的是 **原始系统的真实[残差范数](@entry_id:754273)** $\|b-Ax\|_2$。因此，当我们需要精确控制原始残差的大小时，[右预处理](@entry_id:173546)是更自然的选择 [@problem_id:3588169] [@problem_id:3616830]。

理想的[预处理器](@entry_id:753679) $M$ 应满足两个条件：$M$ 应该近似于 $A$，使得[预处理](@entry_id:141204)后的系统 $M^{-1}A$ 或 $AM^{-1}$ 的[条件数](@entry_id:145150)远小于 $A$；同时，求解形如 $Mz=c$ 的系统应该比求解原系统容易得多。寻找高效的[预处理器](@entry_id:753679)是数值线性代数研究中的一个核心和活跃领域。