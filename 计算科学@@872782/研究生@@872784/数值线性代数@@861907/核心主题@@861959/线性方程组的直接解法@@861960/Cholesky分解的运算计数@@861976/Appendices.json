{"hands_on_practices": [{"introduction": "理解任何算法的第一步都是分析其计算成本。本练习将引导你从第一性原理出发，精确推导稠密矩阵Cholesky分解的浮点运算（flop）计数。通过这种方式，你不仅能验证其经典的 $O(n^3)$ 复杂度，还能深入理解算法每个阶段（分解、前向替换和后向替换）的计算细节，为后续更复杂的稀疏算法分析打下坚实基础。", "problem": "考虑一个由均匀网格上的二维泊松方程等一致椭圆型偏微分方程（PDE）通过有限差分方法离散化得到的对称正定线性系统 $A x = b$。假设矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 被视为稠密矩阵，并通过 Cholesky 分解 $A = L L^{\\top}$ 进行因式分解，其中 $L$ 是一个对角线元素为正的下三角矩阵。采用以下算术成本模型：每次浮点加法、减法、乘法、除法和平方根运算都计为1次浮点运算（flop）。\n\n任务：\n- 从使用内积逐列计算 $L$ 的标准非分块 Cholesky 算法出发，从第一性原理推导出分解 $A$ 所需的精确总浮点运算次数，表示为关于 $n$ 的多项式，并由此证明其为 $n^{3}/3 + O(n^{2})$。\n- 使用标准的前向替换法求解 $L y = b$ 和反向替换法求解 $L^{\\top} x = y$，推导出每次三角求解的精确浮点运算次数。\n- 结合您的结果，得出一个关于 $n$ 的单一简化闭式表达式，表示通过 Cholesky 分解对 $A$ 进行因式分解，然后通过前向和反向替换法求解单个右端项的 $A x = b$ 所需的精确总浮点运算次数。\n\n仅报告合并步骤得到的精确总浮点运算次数作为最终答案，并简化为关于 $n$ 的单个多项式。无需四舍五入。", "solution": "### 解答推导\n\n设 $A = (a_{ij})$ 和 $L = (l_{ij})$ 是 $n \\times n$ 矩阵，其中 $L$ 是下三角矩阵（即当 $j > i$ 时 $l_{ij}=0$）。Cholesky 分解由矩阵方程 $A = L L^{\\top}$ 定义。我们将推导求解过程三个阶段中每个阶段的浮点运算次数。\n\n**1. Cholesky 分解 ($A = L L^{\\top}$) 的浮点运算次数**\n\n我们采用基于内积的逐列算法。对于每一列 $j = 1, \\dots, n$，我们计算对角元素 $l_{jj}$ 和其下的非对角元素 $l_{ij}$ ($i > j$)。\n\n- **计算 $l_{jj}$**:\n  公式为 $l_{jj} = \\sqrt{a_{jj} - \\sum_{k=1}^{j-1} l_{jk}^2}$。\n  对于 $j>1$，求和项需要 $j-1$ 次乘法和 $j-2$ 次加法。之后，需要1次减法和1次平方根。总计 $(j-1) + (j-2) + 1 + 1 = 2j-1$ 次浮点运算。\n  对于 $j=1$，只需1次平方根。公式 $2j-1$ 在 $j=1$ 时也成立。\n\n- **计算 $l_{ij}$ ($i > j$)**:\n  公式为 $l_{ij} = \\frac{1}{l_{jj}} \\left( a_{ij} - \\sum_{k=1}^{j-1} l_{ik} l_{jk} \\right)$。\n  对于 $j>1$，求和项（一个长度为 $j-1$ 的内积）需要 $j-1$ 次乘法和 $j-2$ 次加法。之后，需要1次减法和1次除法。总计 $(j-1) + (j-2) + 1 + 1 = 2j-1$ 次浮点运算。\n  对于 $j=1$，只需1次除法。公式 $2j-1$ 在 $j=1$ 时也成立。\n\n- **第 $j$ 列的总浮点运算次数**:\n  该列有1个对角元素和 $n-j$ 个非对角元素。\n  $C_j = (2j-1) + (n-j)(2j-1) = (n-j+1)(2j-1)$。\n\n- **分解的总浮点运算次数 $C_{fact}$**:\n  $C_{fact} = \\sum_{j=1}^{n} (n-j+1)(2j-1) = \\sum_{j=1}^{n} (-2j^2 + (2n+3)j - (n+1))$\n  使用标准幂和公式 $\\sum j = \\frac{n(n+1)}{2}$ 和 $\\sum j^2 = \\frac{n(n+1)(2n+1)}{6}$：\n  $C_{fact} = -2 \\left( \\frac{n(n+1)(2n+1)}{6} \\right) + (2n+3) \\left( \\frac{n(n+1)}{2} \\right) - n(n+1)$\n  $C_{fact} = n(n+1) \\left[ -\\frac{2n+1}{3} + \\frac{2n+3}{2} - 1 \\right] = n(n+1) \\left[ \\frac{-2(2n+1) + 3(2n+3) - 6}{6} \\right]$\n  $C_{fact} = n(n+1) \\left[ \\frac{-4n-2+6n+9-6}{6} \\right] = \\frac{n(n+1)(2n+1)}{6}$\n  展开后得到：\n  $$C_{fact} = \\frac{2n^3 + 3n^2 + n}{6} = \\frac{n^3}{3} + \\frac{n^2}{2} + \\frac{n}{6}$$\n  这验证了分解成本为 $\\frac{n^3}{3} + O(n^2)$。\n\n**2. 三角求解的浮点运算次数**\n\n- **前向替换 ($L y = b$)**:\n  我们求解 $y_i = \\frac{1}{l_{ii}} \\left( b_i - \\sum_{j=1}^{i-1} l_{ij} y_j \\right)$。\n  对于每个 $i$，计算内积需要 $i-1$ 次乘法和 $i-1$ 次减法/加法（总计 $2(i-1)$ 次浮点运算），之后进行1次除法。总共需要 $2(i-1)+1 = 2i-1$ 次浮点运算。\n  $C_{fwd} = \\sum_{i=1}^{n} (2i-1) = 2 \\sum_{i=1}^{n} i - \\sum_{i=1}^{n} 1 = 2 \\frac{n(n+1)}{2} - n = n^2+n-n = n^2$。\n\n- **反向替换 ($L^{\\top} x = y$)**:\n  结构对称，求解 $L^\\top x = y$ 的成本与求解 $Ly=b$ 相同。\n  $C_{bwd} = n^2$。\n\n**3. 总浮点运算次数**\n\n求解 $A x = b$ 的总浮点运算次数是三个阶段成本的总和：\n$$C_{total} = C_{fact} + C_{fwd} + C_{bwd}$$\n$$C_{total} = \\left( \\frac{2n^3 + 3n^2 + n}{6} \\right) + n^2 + n^2 = \\frac{2n^3 + 3n^2 + n + 12n^2}{6}$$\n$$C_{total} = \\frac{2n^3 + 15n^2 + n}{6}$$\n这是精确总浮点运算次数的简化闭式多项式表达式。", "answer": "$$\\boxed{\\frac{2n^3 + 15n^2 + n}{6}}$$", "id": "3370813"}, {"introduction": "在获得矩阵的Cholesky因子 $L$ 后，一个常见的策略问题是：当需要求解多个右侧向量时，是显式计算 $L^{-1}$ 并进行矩阵乘法更有效，还是对每个向量重复进行三角求解更佳？本练习通过量化两种策略的运算成本来直接回答这个问题。这个对比揭示了数值线性代数中的一个核心准则，并强调了在实践中应如何高效地利用矩阵分解。[@problem_id:3370813]", "problem": "考虑一个稠密对称正定矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和一个稠密右端项矩阵 $B \\in \\mathbb{R}^{n \\times p}$。您希望计算满足 $A X = B$ 的矩阵 $X \\in \\mathbb{R}^{n \\times p}$。假设采用以下浮点运算计数模型：每次标量加法、减法、乘法或除法计为一次浮点运算 (flop)，并忽略数据移动和内存效应。\n\n考虑以下两种策略：\n\n1.  分解求解 (Factor-and-solve)：计算 Cholesky 分解 $A = L L^{\\top}$，其中 $L$ 为下三角矩阵，然后通过前向替换法求解 $L Y = B$，并通过后向替换法求解 $L^{\\top} X = Y$。\n2.  分解-求逆-应用 (Factor–invert–apply)：计算 Cholesky 分解 $A = L L^{\\top}$，然后通过三角矩阵求逆显式地构造 $L^{-1}$（求解 $L Z = I$ 得到 $Z = L^{-1}$），最后计算 $Y = L^{-1} B$，接着计算 $X = L^{-\\top} Y$。\n\n从运算计数的第一性原理出发，推导三角矩阵求逆 $L^{-1}$ 的浮点运算数，方法是将其建模为求解 $n$ 个以单位矩阵的列作为右端项的三角方程组。仔细计算每一列的算术运算次数，然后对所有列求和，以获得关于 $n$ 的封闭形式表达式。然后比较两种策略的总浮点运算数，并提取在稠密数据情况下，策略2相对于策略1的领先阶额外成本。\n\n请将您的最终答案表示为策略2相对于策略1的额外浮点运算数的单个简化领先阶项（关于 $n$）。无需四舍五入，不涉及单位。", "solution": "### 解答推导\n\n我们分析并比较两种策略的总浮点运算 (flop) 次数，其中每次算术运算（加、减、乘、除）计为一次 flop。\n\n**基本运算成本（领先阶项）**\n\n1.  **Cholesky 分解 ($A = LL^{\\top}$)**: 对于一个 $n \\times n$ 的稠密矩阵，成本约为 $C_{chol} \\approx \\frac{1}{3}n^3$ flops。\n2.  **三角求解 (多个右端项)**: 求解 $LY=B$ 或 $L^{\\top}X=Y$ (其中 $B, Y \\in \\mathbb{R}^{n \\times p}$) 需要对 $p$ 个列向量进行三角求解。单次求解成本为 $n^2$ flops，因此总成本为 $C_{solve} = p n^2$ flops。\n\n**策略1：分解求解 (Factor-and-solve)**\n\n该策略包括三个步骤：\n1.  Cholesky 分解 $A = L L^{\\top}$: $C_{chol} \\approx \\frac{1}{3}n^3$ flops。\n2.  前向替换求解 $LY=B$: $p n^2$ flops。\n3.  后向替换求解 $L^{\\top}X=Y$: $p n^2$ flops。\n\n策略1的总成本 $C_1$ 为：\n$$C_1 \\approx \\frac{1}{3}n^3 + 2pn^2$$\n\n**策略2：分解-求逆-应用 (Factor–invert–apply)**\n\n该策略包括四个步骤：\n1.  Cholesky 分解 $A = L L^{\\top}$: $C_{chol} \\approx \\frac{1}{3}n^3$ flops。\n2.  **显式计算 $L^{-1}$**: 这相当于求解矩阵方程 $LZ = I$，其中 $Z=L^{-1}$。我们可以通过对单位矩阵 $I$ 的每一列 $e_j$ 进行前向替换来求解 $Z$ 的每一列 $z_j$。\n    - 求解 $Lz_j = e_j$ 的成本取决于 $e_j$ 的稀疏性。由于 $e_j$ 的前 $j-1$ 个元素为零，因此 $z_j$ 的前 $j-1$ 个元素也为零。我们只需计算 $z_{ij}$ 其中 $i \\ge j$。\n    - 计算 $z_{jj} = 1/L_{jj}$ 需要 1 flop。\n    - 对于 $i > j$，计算 $z_{ij}$ 需要一个长度为 $i-j$ 的内积，即 $i-j$ 次乘法和 $i-j-1$ 次加法，然后是1次除法。总计 $(i-j) + (i-j-1) + 1 = 2(i-j)$ flops。\n    - 计算第 $j$ 列的总成本为 $1 + \\sum_{i=j+1}^{n} 2(i-j) = 1 + 2\\sum_{k=1}^{n-j}k = 1+(n-j)(n-j+1)$。\n    - 总求逆成本 $C_{inv} = \\sum_{j=1}^{n} [1 + (n-j)(n-j+1)]$。令 $k=n-j$，我们得到 $\\sum_{j=1}^{n}1 + \\sum_{k=0}^{n-1}k(k+1) = n + \\frac{(n-1)n(n+1)}{3} = \\frac{3n + n^3 - n}{3} = \\frac{n^3+2n}{3}$。\n    - 因此，求逆成本的领先阶为 $C_{inv} \\approx \\frac{1}{3}n^3$ flops。\n\n3.  矩阵乘法 $Y = L^{-1} B$: $L^{-1}$ 是一个稠密下三角矩阵。该乘法需要 $p \\times (\\frac{n(n+1)}{2}) \\times 2 \\approx p n^2$ flops。\n4.  矩阵乘法 $X = L^{-\\top} Y$: $L^{-\\top}$ 是一个稠密上三角矩阵。同样，成本约为 $p n^2$ flops。\n\n策略2的总成本 $C_2$ 为：\n$$C_2 \\approx C_{chol} + C_{inv} + C_{L^{-1}B} + C_{L^{-T}Y} \\approx \\frac{1}{3}n^3 + \\frac{1}{3}n^3 + pn^2 + pn^2 = \\frac{2}{3}n^3 + 2pn^2$$\n\n**比较与结论**\n\n策略2相对于策略1的额外成本是 $C_2 - C_1$。\n$$\\text{额外成本} = C_2 - C_1 \\approx \\left(\\frac{2}{3}n^3 + 2pn^2\\right) - \\left(\\frac{1}{3}n^3 + 2pn^2\\right) = \\frac{1}{3}n^3$$\n额外的计算主要来自于显式计算 $L^{-1}$ 的步骤，这是一个 $O(n^3)$ 的过程。这清楚地表明，除非需要矩阵的逆本身，否则显式求逆并在之后进行矩阵乘法，其计算成本要比重复进行三角求解高得多。因此，分解求解策略在数值上更受青睐且效率更高。\n\n策略2的额外成本的领先阶项是 $\\frac{1}{3}n^3$。", "answer": "$$\\boxed{\\frac{n^3}{3}}$$", "id": "3562008"}, {"introduction": "对于源于物理模拟的大型系统，稠密矩阵的 $O(n^3)$ 分解成本往往高得令人却步。本练习为你打开了通往高性能稀疏直接求解器世界的大门。你将探索嵌套剖分法（nested dissection）——一种强大的图划分技术——如何能够显著降低稀疏矩阵的分解成本，通过建立并求解一个递推关系，你将亲手证明对于二维问题，计算复杂度可以从 $O(n^3)$ 降至 $O(n^{3/2})$。[@problem_id:3370813]", "problem": "考虑一个方形网格图上的二维离散化问题，其中有 $n$ 个未知数，假设 $n$ 是 2 的幂，即对于某个整数 $k \\geq 0$，$n = 2^{k}$。其底层矩阵是​​对称正定 (SPD) 的。一种基于平面图分离子的嵌套剖分排序通过移除一个大小为 $s = \\alpha \\sqrt{n}$ 的分离子（其中 $\\alpha \\in (0,\\infty)$ 为某个固定常数），将图划分为两个大小各为 $n/2$ 的子图。假设在消除每个子图的内部节点后，分离子块是维度为 $s \\times s$ 的稠密块，并且其 Cholesky 分解的成本为 $(1/3) s^{3}$ 次浮点运算 (flops)，这与经过充分测试的 SPD 矩阵的稠密 Cholesky 成本模型一致。所有其他与分离子相关的操作（例如更新限制在分离子上的舒尔补）都被假定为低阶项，并且可以被归入相同的常数倍数中。\n\n1. 仅使用分离子属性 $s = \\alpha \\sqrt{n}$ 和稠密 Cholesky 成本模型，为嵌套剖分下稀疏 Cholesky 分解的总浮点运算数 $T(n)$ 建立一个形式为\n$T(n) = 2T(n/2) + cn^{3/2}$ 的递推关系，并用 $\\alpha$ 显式表示常数 $c$。\n\n2. 在基准条件 $T(1) = 0$ 下，对 $n = 2^{k}$ 精确求解该递推关系，并将您的结果简化为关于 $n$ 和 $c$ 的单一闭式表达式。您的最终答案必须以这个关于 $T(n)$ 的单一闭式解析表达式的形式给出；不需要也不允许进行数值近似。", "solution": "### 第 1 部分：建立递推关系\n\n根据嵌套剖分的分治思想，处理一个大小为 $n$ 的问题的总浮点运算次数 $T(n)$ 等于递归处理两个大小为 $n/2$ 的子图的成本之和，再加上在当前层级处理分离子的成本。\n\n- 递归部分的成本为 $2T(n/2)$。\n- 在当前层级，主要的工作量（根据问题假设）是分解与分离子对应的稠密块。\n  - 分离子的大小为 $s = \\alpha \\sqrt{n}$。\n  - 对这个 $s \\times s$ 稠密块进行 Cholesky 分解的成本为 $W(n) = \\frac{1}{3}s^3$。\n- 将 $s$ 的表达式代入成本公式：\n  $$W(n) = \\frac{1}{3}(\\alpha \\sqrt{n})^3 = \\frac{1}{3}\\alpha^3 (n^{1/2})^3 = \\frac{\\alpha^3}{3}n^{3/2}$$\n- 因此，总成本的递推关系为：\n  $$T(n) = 2T\\left(\\frac{n}{2}\\right) + \\frac{\\alpha^3}{3}n^{3/2}$$\n- 将此与所要求的形式 $T(n) = 2T(n/2) + cn^{3/2}$ 进行比较，我们得到常数 $c$ 的表达式：\n  $$c = \\frac{\\alpha^3}{3}$$\n\n### 第 2 部分：求解递推关系\n\n我们需要求解递推关系 $T(n) = 2T(n/2) + cn^{3/2}$，基准条件为 $T(1)=0$，且 $n=2^k$。\n\n设 $n = 2^k$，则 $k = \\log_2 n$。我们将递推关系展开：\n$$\n\\begin{aligned}\nT(n) = 2T(n/2) + cn^{3/2} \\\\\n= 2\\left[2T(n/4) + c(n/2)^{3/2}\\right] + cn^{3/2} \\\\\n= 4T(n/4) + 2c\\frac{n^{3/2}}{2^{3/2}} + cn^{3/2} \\\\\n= 4T(n/4) + c n^{3/2} \\left( \\frac{1}{\\sqrt{2}} \\right) + cn^{3/2} \\\\\n= \\dots \\\\\n= 2^k T(n/2^k) + c n^{3/2} \\sum_{j=0}^{k-1} \\left(\\frac{1}{\\sqrt{2}}\\right)^j\n\\end{aligned}\n$$\n由于 $n=2^k$，我们有 $T(n/2^k) = T(1) = 0$。因此，第一项消失。我们只需计算几何级数的和：\n$$\nT(n) = cn^{3/2} \\sum_{j=0}^{k-1} \\left(\\frac{1}{\\sqrt{2}}\\right)^j\n$$\n这是一个公比 $r = 1/\\sqrt{2}$ 的有限几何级数。其和为：\n$$\n\\sum_{j=0}^{k-1} r^j = \\frac{1-r^k}{1-r} = \\frac{1 - (1/\\sqrt{2})^k}{1 - 1/\\sqrt{2}}\n$$\n我们知道 $k=\\log_2 n$，所以 $(1/\\sqrt{2})^k = (2^{-1/2})^k = 2^{-k/2} = (2^k)^{-1/2} = n^{-1/2}$。\n分母可以有理化：\n$$\n\\frac{1}{1 - 1/\\sqrt{2}} = \\frac{1}{(\\sqrt{2}-1)/\\sqrt{2}} = \\frac{\\sqrt{2}}{\\sqrt{2}-1} = \\frac{\\sqrt{2}(\\sqrt{2}+1)}{(\\sqrt{2}-1)(\\sqrt{2}+1)} = 2+\\sqrt{2}\n$$\n将这些结果代回 $T(n)$ 的表达式：\n$$\nT(n) = cn^{3/2} (2+\\sqrt{2}) (1 - n^{-1/2})\n$$\n展开括号，得到最终的闭式表达式：\n$$\nT(n) = c(2+\\sqrt{2}) (n^{3/2} \\cdot 1 - n^{3/2} \\cdot n^{-1/2}) = c(2+\\sqrt{2}) (n^{3/2} - n)\n$$", "answer": "$$\\boxed{c(2+\\sqrt{2})(n^{3/2}-n)}$$", "id": "3561956"}]}