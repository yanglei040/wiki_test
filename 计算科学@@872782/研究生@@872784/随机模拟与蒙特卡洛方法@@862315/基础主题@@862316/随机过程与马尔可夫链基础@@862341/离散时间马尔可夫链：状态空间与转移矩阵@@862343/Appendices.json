{"hands_on_practices": [{"introduction": "在我们深入分析或模拟马尔可夫链之前，首先必须确定我们研究的随机过程确实具备马尔可夫性质。该性质——即未来状态在给定当前状态的条件下独立于过去状态——是整个理论的基石。本练习旨在加深你对这一定义的理解 ([@problem_id:3303951])。通过分析一个其转移概率以一种非平凡的方式依赖于其历史的随机过程，你将学会如何严格地识别对马尔可夫性质的违背，并理解为何并非所有随机过程都是马尔可夫链。", "problem": "考虑一个在可数状态空间 $\\mathcal{S} = \\{0,1\\}$ 上的随机过程 $\\{X_{n}\\}_{n \\geq 0}$。设初始分布为 $\\mathbb{P}(X_{0}=0) = \\mathbb{P}(X_{0}=1) = \\frac{1}{2}$。定义历史相关计数 $H_{n} := \\sum_{k=0}^{n} \\mathbf{1}\\{X_{k} = 1\\}$，并假设对所有 $n \\geq 0$，该过程根据以下规则演化：\n- 若 $X_{n} = 0$，则 $\\mathbb{P}(X_{n+1} = 1 \\mid X_{0}, X_{1}, \\dots, X_{n}) = 1$。\n- 若 $X_{n} = 1$ 且 $H_{n}$ 为奇数，则 $\\mathbb{P}(X_{n+1} = 1 \\mid X_{0}, X_{1}, \\dots, X_{n}) = 1$。\n- 若 $X_{n} = 1$ 且 $H_{n}$ 为偶数，则 $\\mathbb{P}(X_{n+1} = 0 \\mid X_{0}, X_{1}, \\dots, X_{n}) = 1$。\n\n从离散时间马尔可夫性质的基本定义出发，即对于所有可测集 $A \\subseteq \\mathcal{S}$ 和所有历史 $(x_{0}, x_{1}, \\dots, x_{n})$，要求 $\\mathbb{P}(X_{n+1} \\in A \\mid X_{n} = x_{n}, X_{n-1} = x_{n-1}, \\dots, X_{0} = x_{0}) = \\mathbb{P}(X_{n+1} \\in A \\mid X_{n} = x_{n})$，请分析过程 $\\{X_{n}\\}$ 是否为离散时间马尔可夫链 (DTMC)。严格地指出上述构造中违反了马尔可夫性质所要求的条件独立性结构的具体特征。\n\n为了在状态空间和转移机制的框架内使你的分析具体化，请计算以下量\n$$\nD := \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1, X_{0} = 0) \\;-\\; \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1).\n$$\n你的最终答案必须是一个实数。无需四舍五入。", "solution": "问题要求我们判断给定的随机过程 $\\{X_{n}\\}_{n \\geq 0}$ 是否为离散时间马尔可夫链 (DTMC)，并计算一个特定的量 $D$ 来阐明结论。\n\n首先，我们根据 DTMC 的定义来分析该过程。一个过程 $\\{X_n\\}$ 如果满足马尔可夫性质，则它是一个 DTMC。马尔可夫性质指出，在给定当前状态和所有过去状态的条件下，过程未来状态的条件概率分布仅依赖于当前状态，而与之前的事件序列无关。形式上，对于任何时间步 $n \\ge 0$、任何状态序列 $x_0, x_1, \\dots, x_n$ 以及任何未来状态的可测集 $A$，以下等式必须成立：\n$$\n\\mathbb{P}(X_{n+1} \\in A \\mid X_{n} = x_{n}, X_{n-1} = x_{n-1}, \\dots, X_{0} = x_{0}) = \\mathbb{P}(X_{n+1} \\in A \\mid X_{n} = x_{n})\n$$\n在给定当前状态的条件下，过程的未来必须与其过去条件独立。\n\n过程 $\\{X_n\\}$ 的演化由依赖于当前状态 $X_n$ 和一个历史相关计数 $H_{n} := \\sum_{k=0}^{n} \\mathbf{1}\\{X_{k} = 1\\}$ 的规则所支配，其中 $H_n$ 是截至时间 $n$（包括 $n$）过程处于状态 1 的总次数。转移规则如下：\n1. 若 $X_{n} = 0$，则 $\\mathbb{P}(X_{n+1} = 1 \\mid X_{0}, \\dots, X_{n}) = 1$。\n2. 若 $X_{n} = 1$ 且 $H_{n}$ 为奇数，则 $\\mathbb{P}(X_{n+1} = 1 \\mid X_{0}, \\dots, X_{n}) = 1$。\n3. 若 $X_{n} = 1$ 且 $H_{n}$ 为偶数，则 $\\mathbb{P}(X_{n+1} = 0 \\mid X_{0}, \\dots, X_{n}) = 1$，这意味着 $\\mathbb{P}(X_{n+1} = 1 \\mid X_{0}, \\dots, X_{n}) = 0$。\n\n违反马尔可夫性质的具体特征是转移概率对 $H_n$ 的依赖性。$H_n$ 的值不仅仅由当前状态 $X_n$ 决定。对于一个给定的状态 $X_n=x_n$，不同的过去历史 $(x_0, \\dots, x_{n-1})$ 可能导致不同的 $H_n$ 值。如果这些不同的 $H_n$ 值（例如，一个是奇数，另一个是偶数）导致 $X_{n+1}$ 有不同的转移概率，那么马尔可夫性质就被违反了。\n\n为了严格地证明这一点，我们计算量 $D := \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1, X_{0} = 0) - \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1)$。如果 $\\{X_n\\}$ 是一个马尔可夫链，这两个概率将会相等，且 $D$ 将为 $0$。\n\n我们来计算第一项，$\\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1, X_{0} = 0)$。\n这个概率是以特定历史 $(X_0, X_1) = (0, 1)$ 为条件的。我们在时间 $n=1$，当前状态为 $X_1 = 1$。为了确定到 $X_2$ 的转移，我们必须评估 $H_1$ 的奇偶性。\n对于这段历史，$H_1 = \\sum_{k=0}^{1} \\mathbf{1}\\{X_k=1\\} = \\mathbf{1}\\{X_0=1\\} + \\mathbf{1}\\{X_1=1\\} = 0 + 1 = 1$。\n由于 $H_1 = 1$ 是奇数，我们使用第二条转移规则：若 $X_n=1$ 且 $H_n$ 为奇数，过程以概率 $1$ 转移到状态 $1$。\n因此，$\\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1, X_{0} = 0) = 1$。\n\n接下来，我们计算第二项，$\\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1)$。\n根据条件概率的定义，我们有：\n$$\n\\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1) = \\frac{\\mathbb{P}(X_{2} = 1, X_{1} = 1)}{\\mathbb{P}(X_{1} = 1)}\n$$\n我们必须计算分子和分母。\n\n为了计算分母 $\\mathbb{P}(X_{1} = 1)$，我们使用全概率公式，以初始状态 $X_0$ 为条件：\n$$\n\\mathbb{P}(X_{1} = 1) = \\mathbb{P}(X_{1} = 1 \\mid X_{0} = 0)\\mathbb{P}(X_{0} = 0) + \\mathbb{P}(X_{1} = 1 \\mid X_{0} = 1)\\mathbb{P}(X_{0} = 1)\n$$\n给定 $\\mathbb{P}(X_0=0) = \\mathbb{P}(X_0=1) = \\frac{1}{2}$。\n- 若 $X_0 = 0$，应用规则1：$\\mathbb{P}(X_{1} = 1 \\mid X_0=0) = 1$。\n- 若 $X_0 = 1$，我们评估 $H_0 = \\mathbf{1}\\{X_0=1\\} = 1$。由于 $H_0$ 是奇数，应用规则2：$\\mathbb{P}(X_{1} = 1 \\mid X_0=1) = 1$。\n代入这些值：\n$$\n\\mathbb{P}(X_{1} = 1) = (1) \\cdot \\left(\\frac{1}{2}\\right) + (1) \\cdot \\left(\\frac{1}{2}\\right) = 1\n$$\n\n现在，我们计算分子 $\\mathbb{P}(X_{2} = 1, X_{1} = 1)$。再次，我们使用全概率公式，以 $X_0$ 为条件：\n$$\n\\mathbb{P}(X_2=1, X_1=1) = \\mathbb{P}(X_2=1, X_1=1 \\mid X_0=0)\\mathbb{P}(X_0=0) + \\mathbb{P}(X_2=1, X_1=1 \\mid X_0=1)\\mathbb{P}(X_0=1)\n$$\n使用概率的链式法则：\n- 第一项是 $\\mathbb{P}(X_2=1 \\mid X_1=1, X_0=0) \\mathbb{P}(X_1=1 \\mid X_0=0) \\mathbb{P}(X_0=0)$。我们已经求得 $\\mathbb{P}(X_2=1 \\mid X_1=1, X_0=0) = 1$ 和 $\\mathbb{P}(X_1=1 \\mid X_0=0) = 1$。所以这一项是 $1 \\cdot 1 \\cdot \\frac{1}{2} = \\frac{1}{2}$。\n- 第二项是 $\\mathbb{P}(X_2=1 \\mid X_1=1, X_0=1) \\mathbb{P}(X_1=1 \\mid X_0=1) \\mathbb{P}(X_0=1)$。我们需要计算 $\\mathbb{P}(X_2=1 \\mid X_1=1, X_0=1)$。对于历史 $(X_0, X_1) = (1, 1)$，我们有 $H_1 = \\mathbf{1}\\{X_0=1\\} + \\mathbf{1}\\{X_1=1\\} = 1 + 1 = 2$。由于 $H_1=2$ 是偶数，应用规则3：$\\mathbb{P}(X_2=0 \\mid X_1=1, X_0=1) = 1$，这意味着 $\\mathbb{P}(X_2=1 \\mid X_1=1, X_0=1) = 0$。所以这一项是 $0 \\cdot 1 \\cdot \\frac{1}{2} = 0$。\n\n将两项相加：\n$$\n\\mathbb{P}(X_{2} = 1, X_{1} = 1) = \\frac{1}{2} + 0 = \\frac{1}{2}\n$$\n现在我们可以计算 $D$ 的第二项：\n$$\n\\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1) = \\frac{\\mathbb{P}(X_{2} = 1, X_{1} = 1)}{\\mathbb{P}(X_{1} = 1)} = \\frac{1/2}{1} = \\frac{1}{2}\n$$\n\n最后，我们计算 $D$：\n$$\nD = \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1, X_{0} = 0) - \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1) = 1 - \\frac{1}{2} = \\frac{1}{2}\n$$\n由于 $D \\neq 0$，我们明确地证明了 $\\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1, X_{0} = 0) \\neq \\mathbb{P}(X_{2} = 1 \\mid X_{1} = 1)$。下一个状态的概率不仅依赖于当前状态 $X_1=1$，还依赖于过去的状态 $X_0$。这直接违反了马尔可夫性质。因此，该过程 $\\{X_n\\}$ 不是一个离散时间马尔可夫链。", "answer": "$$\n\\boxed{\\frac{1}{2}}\n$$", "id": "3303951"}, {"introduction": "研究马尔可夫链的一个关键方面是理解系统如何随时间演变。$n$步转移矩阵 $P^n$ 包含了关于这一演变的所有信息，而当 $n \\to \\infty$ 时，其长期行为通常会揭示出一个稳定且可预测的模式。本练习将指导你运用一种强大的分析技术：通过矩阵对角化来推导 $P^n$ 的闭式表达式 ([@problem_id:3303948])。这不仅能巩固你的线性代数技能，还能让你深刻理解链的初始状态如何影响其未来路径，以及它最终如何收敛到平稳分布。", "problem": "考虑一个离散时间马尔可夫链 (DTMC)，其有限状态空间为 $\\{1,2,3\\}$，转移矩阵 $P \\in \\mathbb{R}^{3 \\times 3}$ 由下式给出\n$$\nP \\;=\\; \\begin{pmatrix}\n0 & \\frac{1}{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 0 & \\frac{1}{2} \\\\\n\\frac{1}{2} & \\frac{1}{2} & 0\n\\end{pmatrix}.\n$$\n所有元素均为非负且每行之和为 $1$，因此 $P$ 是一个行随机矩阵。根据 DTMC 中 n 步转移概率的定义，$P^{n}$ 的第 $(i,j)$ 个元素等于在 n 步内从状态 i 转移到状态 j 的概率。仅使用基本事实——即 DTMC 转移矩阵的定义、将矩阵的幂 $P^{n}$ 解释为 n 步转移概率，以及对称矩阵的线性代数对角化——通过对角化（如果需要，可使用若尔当分解）推导 $P^{n}$ 的闭式表达式，并将其元素解释为 n 步转移概率。你的推导必须确定与 $P$ 的特征结构相关的不变子空间，并论证该结构如何蕴含当 $n \\to \\infty$ 时 $P^{n}$ 的极限行为。\n\n将你的最终答案表示为 $P^{n}$ 的第 $(1,3)$ 个元素关于正整数 n 的精确符号表达式。无需四舍五入。不包含单位。最终答案必须是单一的闭式解析表达式。", "solution": "该问题被评估为有效。这是一个属于随机过程和线性代数领域的适定、有科学依据且客观的问题。所有必要信息均已提供，任务是使用标准的、指定数学方法推导出一个结果。\n\n目标是找到给定离散时间马尔可夫链的 n 步转移矩阵 $P^n$ 的闭式表达式。转移矩阵为\n$$\nP = \\begin{pmatrix}\n0 & \\frac{1}{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 0 & \\frac{1}{2} \\\\\n\\frac{1}{2} & \\frac{1}{2} & 0\n\\end{pmatrix}.\n$$\n由于 $P$ 是一个实对称矩阵，因此保证它可以通过一个正交矩阵对角化。我们将使用 $P$ 的谱分解来计算 $P^n$。这涉及到求 $P$ 的特征值和相应的特征空间。\n\n首先，我们通过求解特征方程 $\\det(P - \\lambda I) = 0$ 来求特征值，其中 $I$ 是 $3 \\times 3$ 单位矩阵。\n$$\n\\det \\begin{pmatrix}\n-\\lambda & \\frac{1}{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & -\\lambda & \\frac{1}{2} \\\\\n\\frac{1}{2} & \\frac{1}{2} & -\\lambda\n\\end{pmatrix} = 0\n$$\n$$\n-\\lambda \\left( \\lambda^2 - \\frac{1}{4} \\right) - \\frac{1}{2} \\left( -\\frac{\\lambda}{2} - \\frac{1}{4} \\right) + \\frac{1}{2} \\left( \\frac{1}{4} + \\frac{\\lambda}{2} \\right) = 0\n$$\n$$\n-\\lambda^3 + \\frac{\\lambda}{4} + \\frac{\\lambda}{4} + \\frac{1}{8} + \\frac{1}{8} + \\frac{\\lambda}{4} = 0\n$$\n$$\n-\\lambda^3 + \\frac{3}{4}\\lambda + \\frac{1}{4} = 0\n$$\n乘以 $-4$ 得到一个首一多项式：\n$$\n4\\lambda^3 - 3\\lambda - 1 = 0\n$$\n由于 $P$ 是一个随机矩阵，$\\lambda_1 = 1$ 必定是一个特征值。我们验证：$4(1)^3 - 3(1) - 1 = 4 - 3 - 1 = 0$。\n分解出因子 $(\\lambda - 1)$，我们进行多项式除法，得到：\n$$\n(\\lambda - 1)(4\\lambda^2 + 4\\lambda + 1) = 0\n$$\n二次因子是一个完全平方：$4\\lambda^2 + 4\\lambda + 1 = (2\\lambda + 1)^2$。\n因此，特征方程为 $(\\lambda - 1)(2\\lambda + 1)^2 = 0$。\n特征值为 $\\lambda_1 = 1$（代数重数为 1）和 $\\lambda_2 = -\\frac{1}{2}$（代数重数为 2）。\n\n接下来，我们求每个特征值对应的特征空间。\n对于 $\\lambda_1 = 1$，我们求 $(P - I)$ 的零空间：\n$$\nP - I = \\begin{pmatrix}\n-1 & \\frac{1}{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & -1 & \\frac{1}{2} \\\\\n\\frac{1}{2} & \\frac{1}{2} & -1\n\\end{pmatrix}\n$$\n行化简得到方程组 $x_1 = x_2 = x_3$。特征空间 $E_1$ 由向量 $v_1 = \\begin{pmatrix} 1 & 1 & 1 \\end{pmatrix}^T$ 张成。这是与马尔可夫链的平稳分布相关联的不变子空间。\n\n对于 $\\lambda_2 = -\\frac{1}{2}$，我们求 $(P + \\frac{1}{2}I)$ 的零空间：\n$$\nP + \\frac{1}{2}I = \\begin{pmatrix}\n\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2}\n\\end{pmatrix}\n$$\n这可以简化为单个方程 $x_1 + x_2 + x_3 = 0$。这定义了一个通过原点的平面，即特征空间 $E_2$。$\\lambda_2 = -\\frac{1}{2}$ 的几何重数为 2，与其代数重数相符。这个子空间的一组正交基可以由向量 $v_2 = \\begin{pmatrix} 1 & -1 & 0 \\end{pmatrix}^T$ 和 $v_3 = \\begin{pmatrix} 1 & 1 & -2 \\end{pmatrix}^T$ 构成。这是暂态子空间；初始分布在此子空间中的任何分量都将在 $n \\to \\infty$ 时衰减到零。\n\n由于 $P$ 是可对角化的，它可以写成其谱分解形式 $P = \\sum_k \\lambda_k \\Pi_k$，其中 $\\Pi_k$ 是到特征空间 $E_k$ 上的投影矩阵。于是，$P^n$ 由下式给出 $P^n = \\sum_k \\lambda_k^n \\Pi_k$。\n$$\nP^n = (1)^n \\Pi_1 + \\left(-\\frac{1}{2}\\right)^n \\Pi_2 = \\Pi_1 + \\left(-\\frac{1}{2}\\right)^n \\Pi_2\n$$\n到特征空间 $E_1$（由 $v_1$ 张成）上的投影矩阵 $\\Pi_1$ 由下式给出 $\\Pi_1 = \\frac{v_1 v_1^T}{v_1^T v_1}$：\n$$\n\\Pi_1 = \\frac{1}{1^2+1^2+1^2} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} \\begin{pmatrix} 1 & 1 & 1 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 1 \\\\ 1 & 1 & 1 \\end{pmatrix}\n$$\n由于特征空间是正交的且张成 $\\mathbb{R}^3$，我们有 $\\Pi_1 + \\Pi_2 = I$。因此，到特征空间 $E_2$ 上的投影矩阵是 $\\Pi_2 = I - \\Pi_1$：\n$$\n\\Pi_2 = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} - \\frac{1}{3} \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 1 \\\\ 1 & 1 & 1 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 2 & -1 & -1 \\\\ -1 & 2 & -1 \\\\ -1 & -1 & 2 \\end{pmatrix}\n$$\n现在我们可以构造 $P^n$：\n$$\nP^n = \\frac{1}{3} \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 1 \\\\ 1 & 1 & 1 \\end{pmatrix} + \\left(-\\frac{1}{2}\\right)^n \\frac{1}{3} \\begin{pmatrix} 2 & -1 & -1 \\\\ -1 & 2 & -1 \\\\ -1 & -1 & 2 \\end{pmatrix}\n$$\n合并这些矩阵，得到 $P^n$ 的通用闭式表达式：\n$$\nP^n = \\frac{1}{3} \\begin{pmatrix}\n1 + 2\\left(-\\frac{1}{2}\\right)^n & 1 - \\left(-\\frac{1}{2}\\right)^n & 1 - \\left(-\\frac{1}{2}\\right)^n \\\\\n1 - \\left(-\\frac{1}{2}\\right)^n & 1 + 2\\left(-\\frac{1}{2}\\right)^n & 1 - \\left(-\\frac{1}{2}\\right)^n \\\\\n1 - \\left(-\\frac{1}{2}\\right)^n & 1 - \\left(-\\frac{1}{2}\\right)^n & 1 + 2\\left(-\\frac{1}{2}\\right)^n\n\\end{pmatrix}\n$$\n当 $n \\to \\infty$ 时，项 $\\left(-\\frac{1}{2}\\right)^n \\to 0$。转移矩阵的极限为：\n$$\n\\lim_{n \\to \\infty} P^n = \\Pi_1 = \\frac{1}{3} \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 1 \\\\ 1 & 1 & 1 \\end{pmatrix}\n$$\n这表明无论起始状态如何，处于任何状态的长期概率都是 $\\frac{1}{3}$。极限矩阵的行对应于唯一的平稳分布 $\\pi = \\begin{pmatrix} \\frac{1}{3} & \\frac{1}{3} & \\frac{1}{3} \\end{pmatrix}$。对于不可约、有限状态的马尔可夫链，这个极限的存在性和唯一性由 Perron-Frobenius theorem 保证，该定理指出，对于这样的链，特征值 1 的重数为 1，所有其他特征值的模都严格小于 1。我们的分析证实了这一点，即 $|\\lambda_2|=|-\\frac{1}{2}|  1$。\n\n问题要求的是特定元素 $(P^n)_{1,3}$，即在 $n$ 步内从状态 1 转移到状态 3 的概率。从我们推导出的 $P^n$ 矩阵中，该元素为：\n$$\n(P^n)_{1,3} = \\frac{1}{3} \\left(1 - \\left(-\\frac{1}{2}\\right)^n\\right)\n$$\n这就是所要求的闭式表达式。", "answer": "$$\n\\boxed{\\frac{1}{3} \\left(1 - \\left(-\\frac{1}{2}\\right)^{n}\\right)}\n$$", "id": "3303948"}, {"introduction": "尽管理论分析至关重要，但在物理、金融和计算机科学等领域，马尔可夫链的真正威力通常来自于计算机模拟。我们如何将转移矩阵这一抽象概念转化为能够生成样本路径的具体算法呢？最后的这个实践练习将理论与应用联系起来 ([@problem_id:3303994])。你将首先从第一性原理出发，证明任何离散时间马尔可夫链都可以通过一系列均匀分布的随机数进行模拟（一种称为逆变换采样的方法），然后将这一证明转化为一个可执行的算法，从而巩固你对随机过程在实践中如何实现的理解。", "problem": "考虑一个具有有限状态空间 $S=\\{0,1,\\dots,m-1\\}$ 和转移矩阵 $P=\\bigl(p_{ij}\\bigr)_{0\\leq i,j\\leq m-1}$ 的离散时间马尔可夫链 (DTMC)。其中，$P$ 的每一行都是一个概率分布，即对于每一个 $i\\in S$，都有 $p_{ij}\\geq 0$ 且 $\\sum_{j=0}^{m-1} p_{ij}=1$。设 $\\{U_n\\}_{n\\geq 0}$ 是一个独立同分布 (i.i.d.) 的随机变量序列，其中 $U_n\\sim \\mathrm{Uniform}(0,1)$ 且与该链无关。请从第一性原理出发，在不假设任何预先构建的构造的情况下，证明存在一个可测映射 $F:S\\times[0,1)\\to S$，使得随机递推 $X_{n+1}=F(X_n,U_n)$ 能够实现具有转移矩阵 $P$ 的 DTMC，即对于所有的 $i,j\\in S$，满足\n$$\\mathbb{P}\\bigl(X_{n+1}=j\\mid X_n=i\\bigr)=p_{ij}.$$\n使用 $P$ 的行累积和以及一个在 $[0,1)$ 上能正确处理边界值和零概率的一致半开区间约定，来显式地构造 $F$。\n\n然后，通过算法实现该构造。您的程序必须：\n- 不接受任何输入，仅使用提供的测试套件。\n- 将状态表示为 $\\{0,1,\\dots,m-1\\}$ 中的整数。\n- 预先计算 $P$ 的行累积和来定义 $F$，其规则为：对于给定的当前状态 $i$ 和一个值 $u\\in[0,1)$，$F(i,u)$ 是使得 $u$ 严格小于第 $i$ 行截至索引 $j$ 的累积和的最小索引 $j$。\n- 对每个测试用例，使用给定的初始状态和确定性序列 $\\{u_k\\}$ 来模拟 DTMC，以生成状态序列 $\\{X_1,\\dots,X_T\\}$，其中 $T$ 是所提供 $\\{u_k\\}$ 的长度。\n\n测试套件：\n1. 通用情况，三个状态：\n   - 转移矩阵\n     $$\n     P_1=\\begin{bmatrix}\n     0.3  0.4  0.3 \\\\\n     0.1  0.2  0.7 \\\\\n     0.0  0.5  0.5\n     \\end{bmatrix}.\n     $$\n   - 初始状态 $X_0=0$。\n   - 均匀序列 $\\{u_k\\}=\\{0.25,\\,0.65,\\,0.05,\\,0.9,\\,0.5\\}$。\n\n2. 边界处理和确定性行，两个状态：\n   - 转移矩阵\n     $$\n     P_2=\\begin{bmatrix}\n     1.0  0.0 \\\\\n     0.0  1.0\n     \\end{bmatrix}.\n     $$\n   - 初始状态 $X_0=1$。\n   - 均匀序列 $\\{u_k\\}=\\{0.0,\\,0.999999,\\,0.1\\}$。\n\n3. 混合概率、零元素和精确边界值，四个状态：\n   - 转移矩阵\n     $$\n     P_3=\\begin{bmatrix}\n     0.3  0.4  0.0  0.3 \\\\\n     0.0  0.0  1.0  0.0 \\\\\n     0.25  0.25  0.25  0.25 \\\\\n     0.5  0.5  0.0  0.0\n     \\end{bmatrix}.\n     $$\n   - 初始状态 $X_0=0$。\n   - 均匀序列 $\\{u_k\\}=\\{0.3,\\,0.7,\\,0.25,\\,0.5\\}$。\n\n输出规范：\n- 对于每个测试用例，将模拟出的状态序列 $\\{X_1,\\dots,X_T\\}$ 作为整数列表输出。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个元素是对应一个测试用例的方括号列表，例如 $\\bigl[[x_{1,1},\\dots,x_{1,T_1}],\\,[x_{2,1},\\dots,x_{2,T_2}],\\,[x_{3,1},\\dots,x_{3,T_3}]\\bigr]$。[@problem_id:803]", "solution": "该问题要求从第一性原理出发，证明一个能够实现离散时间马尔可夫链 (DTMC) 的函数 $F$ 的存在性并给出其构造，然后通过算法实现来模拟 DTMC 的样本路径。\n\n### 第1部分：$F$ 的存在性证明和显式构造\n\n设有限状态空间为 $S = \\{0, 1, \\dots, m-1\\}$，转移矩阵为 $P = (p_{ij})$，其中 $p_{ij} = \\mathbb{P}(X_{n+1}=j \\mid X_n=i)$。对于每个状态 $i \\in S$，$P$ 的第 $i$ 行 $(p_{i0}, p_{i1}, \\dots, p_{i,m-1})$ 是一个离散概率分布，因为对于所有 $j \\in S$ 都有 $p_{ij} \\geq 0$ 且 $\\sum_{j=0}^{m-1} p_{ij} = 1$。\n\n我们的目标是构造一个可测映射 $F: S \\times [0,1) \\to S$，使得由递推式 $X_{n+1} = F(X_n, U_n)$ 定义的随机过程（其中 $\\{U_n\\}_{n \\geq 0}$ 是独立同分布 (i.i.d.) 的随机变量，且 $U_n \\sim \\mathrm{Uniform}(0,1)$）满足具有给定转移概率的马尔可夫性质。\n\n所使用的方法是逆变换采样的一种形式，专为离散分布量身定制。对于每个状态 $i \\in S$，我们定义一组累积概率。设 $c_{i,j}$ 为第 $i$ 行截至状态 $j$ 的概率累积和：\n$$c_{i,j} = \\sum_{k=0}^{j} p_{ik} \\quad \\text{for } j \\in \\{0, 1, \\dots, m-1\\}.$$\n为方便起见，我们定义 $c_{i,-1} = 0$。这样，对于 $j \\in S$，我们有 $p_{ij} = c_{i,j} - c_{i,j-1}$。$P$ 的性质确保对于任意固定的 $i$，序列 $(c_{i,0}, c_{i,1}, \\dots, c_{i,m-1})$ 是非递减的，以 $c_{i,0} \\geq 0$ 开始，并以 $c_{i,m-1} = 1$ 结束。\n\n这些累积概率将区间 $[0,1)$ 划分为 $m$ 个子区间：\n$$ I_{i,j} = [c_{i,j-1}, c_{i,j}) \\quad \\text{for } j \\in \\{0, 1, \\dots, m-1\\}.$$\n每个子区间 $I_{i,j}$ 的长度，记为 $\\lambda(I_{i,j})$，是：\n$$ \\lambda(I_{i,j}) = c_{i,j} - c_{i,j-1} = p_{ij}. $$\n区间集合 $\\{I_{i,j}\\}_{j=0}^{m-1}$ 构成 $[0,1)$ 的一个划分，即它们互不相交且其并集为 $[0,1)$。如果 $p_{ij}=0$，则区间 $I_{i,j}$ 为空。\n\n现在，我们按照规定构造函数 $F(i,u)$。对于给定的状态 $i \\in S$ 和一个值 $u \\in [0,1)$，$F(i,u)$ 被定义为下一个状态 $j$。其规则是 $F(i,u) = j$ 当且仅当 $u$ 落入区间 $I_{i,j}$。问题中给出的一个等价且显式的定义是：\n$$ F(i, u) = \\min \\{j \\in S \\mid u  c_{i,j}\\} $$\n这个定义是合理定义的，因为 $u \\in [0,1)$ 且 $c_{i,m-1}=1$，所以集合 $\\{j \\in S \\mid u  c_{i,j}\\}$ 永不为空（它总是包含 $m-1$）。\n\n我们现在必须从第一性原理证明这个构造能正确地为 DTMC 建模。我们需要证明 $\\mathbb{P}(X_{n+1} = j \\mid X_n = i) = p_{ij}$。\n根据递推定义 $X_{n+1} = F(X_n, U_n)$，我们有：\n$$ \\mathbb{P}(X_{n+1} = j \\mid X_n = i) = \\mathbb{P}(F(X_n, U_n) = j \\mid X_n = i). $$\n在事件 $X_n=i$ 的条件下，表达式变为：\n$$ \\mathbb{P}(F(i, U_n) = j \\mid X_n = i). $$\n由于序列 $\\{U_n\\}$ 与链 $\\{X_n\\}$ 无关，事件 $X_n=i$ 不提供关于 $U_n$ 值的任何信息。因此，我们可以移除对 $X_n=i$ 的条件：\n$$ \\mathbb{P}(X_{n+1} = j \\mid X_n = i) = \\mathbb{P}(F(i, U_n) = j). $$\n根据我们对 $F$ 的构造，事件 $F(i, U_n) = j$ 等价于 $U_n$ 落入特定区间 $I_{i,j}$ 的事件：\n$$ F(i, U_n) = j \\iff c_{i,j-1} \\le U_n  c_{i,j}. $$\n因此，概率为：\n$$ \\mathbb{P}(X_{n+1} = j \\mid X_n = i) = \\mathbb{P}(c_{i,j-1} \\le U_n  c_{i,j}). $$\n由于 $U_n$ 服从 Uniform$(0,1)$ 分布，它落在任何子区间 $[a,b) \\subseteq [0,1)$ 的概率等于该区间的长度 $b-a$。在我们的例子中，区间 $[c_{i,j-1}, c_{i,j})$ 的长度是 $\\lambda(I_{i,j}) = c_{i,j} - c_{i,j-1} = p_{ij}$。\n$$ \\mathbb{P}(X_{n+1} = j \\mid X_n = i) = p_{ij}. $$\n这证实了随机递推 $X_{n+1}=F(X_n, U_n)$ 与我们构造的 $F$ 一起，正确地实现了具有转移矩阵 $P$ 的 DTMC。\n\n最后，函数 $F$ 是一个可测映射。对于任何 $j \\in S$，其原像 $F^{-1}(\\{j\\})$ 是集合 $\\bigcup_{i \\in S} (\\{i\\} \\times I_{i,j})$。每个集合 $\\{i\\}$ 在 $S$ 上的离散 $\\sigma$-代数中是可测的，每个区间 $I_{i,j}$ 是一个 Borel 集，因此在 $[0,1)$ 中是可测的。乘积 $\\{i\\} \\times I_{i,j}$ 是乘积空间 $S \\times [0,1)$ 中的一个可测矩形，而这类集合的有限并集是可测的。因此，$F$ 是一个可测函数。\n\n### 第2部分：算法设计\n\n该构造性证明直接为模拟算法提供了指导。\n1.  **预处理**：对于给定的 $m \\times m$ 转移矩阵 $P$，我们首先计算累积和矩阵 $C$。元素 $C_{ij}$ 是 $P$ 的第 $i$ 行到第 $j$ 列的累积和，即 $C_{ij} = \\sum_{k=0}^{j} P_{ik}$。这可以对所有行同时进行高效计算。\n2.  **状态转移函数**：模拟的核心是实现 $F(i,u)$。给定当前状态 $i$ 和一个均匀采样的值 $u \\in [0,1)$，下一个状态 $j$ 通过应用规则 $j = \\min \\{k \\in S \\mid u  C_{ik}\\}$ 来找到。在算法上，这意味着我们在 $C$ 的第 $i$ 行中搜索第一个索引 $k$，使得 $C_{ik}$ 的值严格大于 $u$。\n3.  **模拟循环**：\n    -   初始化当前状态，$X_{current} \\leftarrow X_0$。\n    -   初始化一个空列表 `results` 来存储生成的状态序列。\n    -   对于确定性序列 $\\{u_k\\}$ 中提供的每个值 $u_k$：\n        a.  识别与当前状态对应的累积概率行：`cum_probs = C[X_current, :]`。\n        b.  通过找到满足 $u_k  \\text{cum\\_probs}[j]$ 的最小索引 $j$ 来确定下一个状态 $X_{next}$。这可以高效地实现，例如，通过在比较 $u_k  \\text{cum\\_probs}$ 产生的布尔数组中找到第一个 `True` 值的索引。\n        c.  将 $X_{next}$ 追加到 `results` 列表中。\n        d.  更新当前状态：$X_{current} \\leftarrow X_{next}$。\n4.  **输出格式化**：收集所有测试用例生成的序列，并将其格式化为指定的单行字符串格式。\n\n这个设计是已证实方法的直接转换，确保了正确性，并利用高效的数组操作来完成搜索步骤。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DTMC simulation problem for a given set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"P\": np.array([\n                [0.3, 0.4, 0.3],\n                [0.1, 0.2, 0.7],\n                [0.0, 0.5, 0.5]\n            ]),\n            \"X0\": 0,\n            \"u_seq\": [0.25, 0.65, 0.05, 0.9, 0.5]\n        },\n        {\n            \"P\": np.array([\n                [1.0, 0.0],\n                [0.0, 1.0]\n            ]),\n            \"X0\": 1,\n            \"u_seq\": [0.0, 0.999999, 0.1]\n        },\n        {\n            \"P\": np.array([\n                [0.3, 0.4, 0.0, 0.3],\n                [0.0, 0.0, 1.0, 0.0],\n                [0.25, 0.25, 0.25, 0.25],\n                [0.5, 0.5, 0.0, 0.0]\n            ]),\n            \"X0\": 0,\n            \"u_seq\": [0.3, 0.7, 0.25, 0.5]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        P = case[\"P\"]\n        current_state = case[\"X0\"]\n        u_seq = case[\"u_seq\"]\n        \n        # Precompute row-wise cumulative sums of the transition matrix P.\n        # This creates the matrix C where C[i,j] = sum_{k=0 to j} P[i,k].\n        C = np.cumsum(P, axis=1)\n        \n        state_sequence = []\n        for u in u_seq:\n            # Get the cumulative probabilities for the current state.\n            cum_probs_row = C[current_state, :]\n            \n            # Find the next state. The rule is to find the smallest index j such that\n            # u is strictly less than the cumulative sum up to j.\n            # np.argmax(u  cum_probs_row) finds the index of the first True\n            # value, which corresponds to the smallest j satisfying the condition.\n            next_state = np.argmax(u  cum_probs_row)\n            \n            state_sequence.append(next_state)\n            current_state = next_state\n            \n        all_results.append(state_sequence)\n\n    # Format the final output string to be exactly as specified, without spaces.\n    # E.g., [[0,1,0,2,2],[1,1,1],[1,2,1,2]]\n    result_str_parts = []\n    for res_list in all_results:\n        # Format each inner list like '[0,1,2]'\n        part = '[' + ','.join(map(str, res_list)) + ']'\n        result_str_parts.append(part)\n    \n    # Join the parts and wrap in outer brackets\n    final_output_str = '[' + ','.join(result_str_parts) + ']'\n    \n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```", "id": "3303994"}]}