{"hands_on_practices": [{"introduction": "本章节的第一个练习为理解精确模拟算法的价值提供了理论基础。通过比较经典的 Euler–Maruyama 方法与理想化的精确模拟算法的计算成本，您将定量地分析效率上的权衡，并确定在何种情况下（尤其是在要求高精度时）精确模拟会变得更优越。这项分析强调了开发更复杂但最终功能更强大的模拟技术背后的根本动机 [@problem_id:3306858]。", "problem": "考虑在时间区间 $[0,T]$ 上由随机微分方程 $dX_{t}=\\mu(X_{t})\\,dt+\\sigma(X_{t})\\,dW_{t}$ 定义的一维伊藤扩散，其具有确定性初始条件 $X_{0}=x_{0}$，其中 $W_{t}$ 是标准布朗运动。设 $\\varphi:\\mathbb{R}\\to\\mathbb{R}$ 是一个有界的、具有有界导数的二次连续可微函数。计算任务是使用两种方法来估计 $I=\\mathbb{E}[\\varphi(X_{T})]$：\n- 方法A：采用均匀步长 $h$ 的 Euler–Maruyama 时间离散化，并结合标准蒙特卡洛 (MC) 方法。\n- 方法B：采用扩散过程的精确模拟算法（例如，接受-拒绝精确算法），并结合标准蒙特卡洛 (MC) 方法。\n\n假设对于足够小的 $h$，以下性质一致成立：\n- Euler–Maruyama 的弱（分布）误差是一阶的：存在一个常数 $b>0$，使得 $\\big|\\mathbb{E}[\\varphi(X_{T}^{(h)})]-\\mathbb{E}[\\varphi(X_{T})]\\big|\\leq b\\,h$，其中 $X_{T}^{(h)}$ 表示在时间 $T$ 的 Euler–Maruyama 近似值。\n- 在 Euler–Maruyama 方法下，可观测量的方差是一致有界的：存在一个常数 $v>0$，使得对于所有足够小的 $h$，都有 $\\operatorname{Var}(\\varphi(X_{T}^{(h)}))\\leq v$。\n- 每条 Euler–Maruyama 路径的计算成本与步数成线性关系：存在一个常数 $c_{E}>0$，使得每条路径的期望成本为 $c_{E}\\,(T/h)$。\n- 精确模拟算法从 $X_{T}$ 的分布中生成无偏样本，且每个样本的期望成本有限：存在常数 $c_{X}>0$ 和 $v_{X}>0$，使得每条精确路径的期望成本为 $c_{X}$ 并且 $\\operatorname{Var}(\\varphi(X_{T}))\\leq v_{X}$。\n\n对于每种方法，设 $\\widehat{I}$ 是基于 $N$ 条独立路径的标准蒙特卡洛估计量。均方误差 (MSE) 分解为 $\\mathbb{E}\\big[(\\widehat{I}-I)^{2}\\big]=\\text{偏差}^{2}+\\operatorname{Var}(\\widehat{I})$，其中 $\\operatorname{Var}(\\widehat{I})$ 与 $1/N$ 成比例。\n\n将总期望计算功定义为样本数量与每个样本期望成本的乘积。假设对于方法A，您选择 $h$ 和 $N$ 以最小的计算功达到目标均方误差 $\\epsilon^{2}$；对于方法B，您选择 $N$ 以最小的计算功达到相同的目标。\n\n推导两种方法的渐近最优计算功，将其表示为 $\\epsilon$ 的函数，然后确定交叉容差 $\\epsilon_{\\star}$ 的闭式表达式。交叉容差 $\\epsilon_{\\star}$ 定义为使方法A的最小期望计算功等于方法B的最小期望计算功的 $\\epsilon$ 的正值。用 $b$, $v$, $v_{X}$, $c_{E}$, $c_{X}$ 和 $T$ 将您的最终答案表示为单个解析表达式。", "solution": "用户要求比较两种不同数值方法在估计期望 $I = \\mathbb{E}[\\varphi(X_{T})]$ 时所需的计算功，其中 $X_t$ 是一维伊藤扩散。我们需要找到交叉容差 $\\epsilon_{\\star}$，在该容差下，对于目标均方误差 $\\epsilon^2 = \\epsilon_{\\star}^2$，两种方法的最小计算功相等。\n\n首先，我们分别分析每种方法，以确定达到均方误差 (MSE) $\\epsilon^2$ 所需的最小计算功。MSE 定义为 $\\mathbb{E}[(\\widehat{I}-I)^2] = (\\text{偏差})^2 + \\operatorname{Var}(\\widehat{I})$。\n\n**方法A：Euler-Maruyama 结合蒙特卡洛**\n\n对于此方法，估计量 $\\widehat{I}_A$ 是基于 $N_A$ 条步长为 $h$ 的 Euler-Maruyama 离散化路径。\n\n偏差平方的上界为 $(b h)^2$，其中 $b > 0$ 是与该格式的弱误差相关的常数。为了优化的目的，我们将其视为等式：$(\\text{偏差}_A)^2 = b^2 h^2$。\n\n蒙特卡洛估计量的方差为 $\\operatorname{Var}(\\widehat{I}_A) = \\frac{\\operatorname{Var}(\\varphi(X_T^{(h)}))}{N_A}$。问题提供了一个一致上界 $\\operatorname{Var}(\\varphi(X_T^{(h)})) \\le v$，其中 $v > 0$ 为某个常数。我们在分析中使用该上界，因此 $\\operatorname{Var}(\\widehat{I}_A) = \\frac{v}{N_A}$。\n\n总 MSE 是这两个误差分量之和：\n$$\n\\text{MSE}_A = b^2 h^2 + \\frac{v}{N_A}\n$$\n我们施加约束，要求 MSE 必须等于目标容差 $\\epsilon^2$：\n$$\nb^2 h^2 + \\frac{v}{N_A} = \\epsilon^2\n$$\n总期望计算功 $W_A$ 是路径数量与每条路径成本的乘积：\n$$\nW_A = N_A \\times \\left( c_{E} \\frac{T}{h} \\right)\n$$\n其中 $c_{E} > 0$ 是 Euler-Maruyama 方法的成本常数。\n\n我们的目标是在 MSE 约束下最小化 $W_A$。我们可以从约束中解出 $N_A$ 为 $N_A = \\frac{v}{\\epsilon^2 - b^2 h^2}$（这在 $h < \\epsilon/b$ 时有效）。将其代入计算功的表达式得到：\n$$\nW_A(h) = \\frac{v c_{E} T}{h(\\epsilon^2 - b^2 h^2)}\n$$\n为求最小值，我们可以求分母 $f(h) = h\\epsilon^2 - b^2 h^3$ 的最大值。我们计算其关于 $h$ 的导数并令其为 0：\n$$\nf'(h) = \\epsilon^2 - 3 b^2 h^2 = 0\n$$\n解出 $h^2$ 得到最优选择 $h^{*2} = \\frac{\\epsilon^2}{3b^2}$，从而得出最优步长 $h^* = \\frac{\\epsilon}{\\sqrt{3} b}$。\n\n这个结果意味着，为获得最优性能，误差应被分配，使得偏差平方项占总 MSE 的三分之一：\n$$\nb^2 (h^*)^2 = b^2 \\left( \\frac{\\epsilon^2}{3b^2} \\right) = \\frac{\\epsilon^2}{3}\n$$\n剩余的三分之二 MSE 来自方差项：\n$$\n\\frac{v}{N_A^*} = \\epsilon^2 - \\frac{\\epsilon^2}{3} = \\frac{2\\epsilon^2}{3}\n$$\n解出最优路径数 $N_A^*$ 得到：\n$$\nN_A^* = \\frac{3v}{2\\epsilon^2}\n$$\n现在我们可以将最优值 $h^*$ 和 $N_A^*$ 代入计算功方程，计算出最小计算功 $W_A^*$：\n$$\nW_A^*(\\epsilon) = N_A^* \\left( \\frac{c_{E} T}{h^*} \\right) = \\left( \\frac{3v}{2\\epsilon^2} \\right) \\left( \\frac{c_{E} T}{\\frac{\\epsilon}{\\sqrt{3} b}} \\right) = \\frac{3\\sqrt{3}}{2} \\frac{b v c_{E} T}{\\epsilon^3}\n$$\n方法A的最小计算功与 $\\epsilon^{-3}$ 成比例。\n\n**方法B：精确算法结合蒙特卡洛**\n\n对于此方法，估计量 $\\widehat{I}_B$ 基于来自精确模拟算法的 $N_B$ 条路径。该算法产生无偏样本，因此偏差为 0。\n$$\n\\text{偏差}_B = 0\n$$\n因此，MSE 完全由蒙特卡洛估计量的方差引起：\n$$\n\\text{MSE}_B = \\operatorname{Var}(\\widehat{I}_B) = \\frac{\\operatorname{Var}(\\varphi(X_T))}{N_B}\n$$\n使用所给出的界 $\\operatorname{Var}(\\varphi(X_T)) \\le v_{X}$，我们有 $\\text{MSE}_B = \\frac{v_{X}}{N_B}$。\n我们令其等于目标容差 $\\epsilon^2$：\n$$\n\\frac{v_{X}}{N_B} = \\epsilon^2\n$$\n这直接确定了所需的路径数：\n$$\nN_B = \\frac{v_{X}}{\\epsilon^2}\n$$\n计算功 $W_B$ 是路径数与每条路径的恒定期望成本 $c_{X}$ 的乘积：\n$$\nW_B = N_B \\times c_{X}\n$$\n代入 $N_B$ 的表达式，我们得到方法B所需的最小计算功：\n$$\nW_B^*(\\epsilon) = \\left( \\frac{v_{X}}{\\epsilon^2} \\right) c_{X} = \\frac{c_{X} v_{X}}{\\epsilon^2}\n$$\n方法B的最小计算功与 $\\epsilon^{-2}$ 成比例。\n\n**交叉容差 $\\epsilon_{\\star}$**\n\n交叉容差 $\\epsilon_{\\star}$ 是使得两种方法的最小计算功相等的 $\\epsilon$ 的正值：$W_A^*(\\epsilon_{\\star}) = W_B^*(\\epsilon_{\\star})$。\n$$\n\\frac{3\\sqrt{3}}{2} \\frac{b v c_{E} T}{\\epsilon_{\\star}^3} = \\frac{c_{X} v_{X}}{\\epsilon_{\\star}^2}\n$$\n由于 $\\epsilon_{\\star} > 0$，我们可以将等式两边同乘以 $\\epsilon_{\\star}^3$ 得到：\n$$\n\\frac{3\\sqrt{3}}{2} b v c_{E} T = c_{X} v_{X} \\epsilon_{\\star}\n$$\n最后，我们解出 $\\epsilon_{\\star}$：\n$$\n\\epsilon_{\\star} = \\frac{3\\sqrt{3}}{2} \\frac{b v c_{E} T}{c_{X} v_{X}}\n$$\n该表达式给出了一个容差水平，在该水平上，优化后的 Euler-Maruyama 方法的计算成本等于精确算法的计算成本。对于目标误差 $\\epsilon < \\epsilon_{\\star}$，精确算法（计算功与 $\\epsilon^{-2}$ 成比例）比 Euler-Maruyama 方法（计算功与 $\\epsilon^{-3}$ 成比例）更有效率。相反地，对于 $\\epsilon > \\epsilon_{\\star}$，Euler-Maruyama 方法更有效率。", "answer": "$$\n\\boxed{\\frac{3\\sqrt{3}}{2}\\frac{b v c_{E} T}{c_{X} v_{X}}}\n$$", "id": "3306858"}, {"introduction": "在理解了精确模拟的动机之后，这个实践将引导您从零开始构建一个完整的扩散桥精确模拟算法。您将应用 Lamperti 变换来统一波动率，利用 Girsanov 定理推导关键的势函数，并实现基于路径的泊松细化方法进行接受-拒绝采样。这项综合性练习将巩固您对核心理论组成部分及其实际实现的理解 [@problem_id:3306885]。", "problem": "要求您设计并实现一个一维扩散的精确模拟方案，该方案使用 Lamperti 变换将其转换为单位波动率，采用布朗桥作为提议，并基于一个可计算的势进行路径泊松细化。目标是从第一性原理出发，推导出变换、势和细化接受准则，然后研究势在紧区间上的最小包络常数。您的最终答案必须是一个完整的、可运行的程序。\n\n使用的基本原理：\n- 一维 Itô 扩散的随机微分方程 (SDE) 的定义：$dX_t = b(X_t)\\,dt + \\sigma(X_t)\\,dW_t$，其中 $b$ 是漂移，$\\sigma$ 是波动率，$W_t$ 是标准布朗运动。\n- 用于 Itô 扩散变换的 Itô 公式。\n- 用于带漂移布朗运动和标准布朗运动之间测度变换的 Girsanov 定理，以及与路径积分相关的 Feynman–Kac 表示。\n- 布朗桥和泊松点过程的性质。\n\n精确模拟目标与推导范围：\n- 从 SDE $dX_t = b(X_t)\\,dt + \\sigma(X_t)\\,dW_t$ 出发，定义 Lamperti 变换 $Y_t = \\eta(X_t)$，其中对所有 $x$ 都有 $\\eta'(x) = 1/\\sigma(x)$ 且 $\\eta$ 是严格递增的。证明 $Y_t$ 具有单位波动率 $dY_t = \\alpha(Y_t)\\,dt + dW_t$，并使用 Itô 公式从 $b(x)$ 和 $\\sigma(x)$ 推导出 $\\alpha(y)$。\n- 使用 Girsanov 定理和针对单位波动率扩散的 Feynman–Kac 框架，推导出一个势函数 $V(y)$。当为给定端点间的 $Y_t$ 提议一个布朗桥时，该势函数出现在精确路径采样的接受概率中。\n- 阐述如何在 $[0,T]\\times[0,M]$ 上针对一个非齐次速率函数 $\\phi(y) \\ge 0$ 的图像构建一个路径泊松细化接受准则。其中 $\\phi(y)$ 是通过将 $V(y)$ 平移一个常数 $l$ 得到的，使得在目标紧区间上 $\\phi(y) = V(y) - l \\ge 0$。论证“没有泊松点落在 $\\phi(Y_t)$ 图像下方”这一接受事件，会产生一个精确的接受概率 $\\exp\\big(-\\int_0^T \\phi(Y_s)\\,ds\\big)$。\n- 研究最小包络常数：对于 $y$ 空间中的一个给定紧区间 $I = [a,b] \\subset \\mathbb{R}$，定义 $l = \\inf_{y\\in I} V(y)$ 和 $M = \\sup_{y\\in I} \\phi(y) = \\sup_{y\\in I} (V(y) - l)$。解释为什么 $M$ 是满足对所有 $y \\in I$ 都有 $\\phi(y) \\le M$ 的最小常数，并讨论这个最小包络常数在细化方案效率中的作用。\n\n实现要求：\n- 您的程序必须使用路径泊松细化结构，为 $y$ 空间中的布朗桥实现精确模拟接受检验：\n  - 模拟一个均值为 $M T$ 的泊松随机变量 $N$，其中 $M$ 是紧区间 $I$ 上的包络常数，$T > 0$ 是时间范围。\n  - 在给定 $N$ 的条件下，独立地在 $[0,T]$ 上均匀模拟 $N$ 个提议时间 $\\{t_i\\}_{i=1}^N$，并在 $[0,M]$ 上独立均匀地模拟 $N$ 个标记 $\\{v_i\\}_{i=1}^N$。\n  - 从一个在 $[0,T]$ 上从 $y_0$ 到 $y_T$ 的单位波动率布朗桥中，联合采样向量 $\\{Y_{t_i}\\}_{i=1}^N$。在时间 $\\{t_i\\}_{i=1}^N$ 处的布朗桥是一个多元正态分布，其均值向量为 $m_i = y_0 + (t_i/T)(y_T - y_0)$，协方差为 $\\mathrm{Cov}(Y_{t_i},Y_{t_j}) = \\min(t_i,t_j) - (t_i t_j)/T$。\n  - 当且仅当对于所有 $i \\in \\{1,\\dots,N\\}$ 都有 $v_i > \\phi(Y_{t_i})$ 时，接受提议的路径，其中 $\\phi(y) = V(y) - l$ 且 $l = \\inf_{y\\in I} V(y)$。\n- 您的程序必须通过首先计算 $\\alpha(y)$ 及其关于 $y$ 的导数来为每个 $y$ 计算 $V(y)$。如果需要，您可以使用数值微分来计算 $\\alpha'(y)$，但要确保在区间 $I$ 上的数值稳定性。\n\n测试套件：\n实现并运行以下三个测试用例。对于每个测试，令 $I$ 为 $y$ 空间中指定的紧区间，并使用端点为 $y_0 = \\eta(x_0)$ 和 $y_T = \\eta(x_T)$ 的布朗桥，其中 $(x_0,x_T)$ 已给出。\n\n- 测试 1（理想情况，常数势）：几何布朗运动，其中 $b(x) = \\mu x$，$\\sigma(x) = \\sigma x$，参数 $\\mu = 0.2$，$\\sigma = 0.5$，时间范围 $T = 0.7$，端点 $x_0 = 1.0$, $x_T = 1.3$。对于此情况，$\\eta(x) = \\frac{1}{\\sigma}\\log(x)$ 且 $I = [\\min(\\eta(x_0),\\eta(x_T)) - 0.5,\\max(\\eta(x_0),\\eta(x_T)) + 0.5]$。\n- 测试 2（常数波动率的 Ornstein–Uhlenbeck 过程，非平凡凸函数 $\\phi$）：Ornstein–Uhlenbeck 过程，其中 $b(x) = \\kappa(\\theta - x)$，$\\sigma(x) = \\sigma_0$，参数 $\\kappa = 1.0$，$\\theta = 0.0$，$\\sigma_0 = 1.0$，时间范围 $T = 1.0$，端点 $x_0 = 0.2$，$x_T = -0.1$。此处 $\\eta(x) = x/\\sigma_0$，且在 $y$ 空间中 $I = [-1.0,1.0]$。\n- 测试 3（状态依赖波动率，非常数但有界的 $\\phi$）：无漂移扩散，其中 $b(x) = 0$，$\\sigma(x) = \\sqrt{1+x^2}$，时间范围 $T = 0.5$，端点 $x_0 = 0.5$，$x_T = -0.2$。此处 $\\eta(x) = \\mathrm{arcsinh}(x)$，且在 $y$ 空间中 $I = [-1.0,1.0]$。\n\n数值要求：\n- 使用固定的随机种子，以确保结果可复现。\n- 对于每个测试用例，通过在 $I$ 上的一个精细网格上评估 $V(y)$ 并取其经验下确界和上确界，来数值计算 $l = \\inf_{y\\in I} V(y)$ 和 $M = \\sup_{y\\in I} (V(y) - l)$。\n- 通过在采样时间点从正确的多元正态分布中抽样，对向量 $\\{Y_{t_i}\\}$ 使用精确的布朗桥采样。\n\n答案规格与输出格式：\n- 对于每个测试用例，返回一个列表，其中包含作为浮点数的最小包络常数 $M$、作为浮点数的基线平移 $l$ 以及作为布尔值的接受决策。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，其中按顺序包含三个测试用例的列表。例如，最终输出必须类似于 $[[M_1,l_1,\\mathrm{accept}_1],[M_2,l_2,\\mathrm{accept}_2],[M_3,l_3,\\mathrm{accept}_3]]$。\n\n此问题不涉及物理单位或角度。如需报告分数或小数，请使用十进制表示法。", "solution": "该问题是有效的，因为它在科学上基于随机微积分和蒙特卡洛方法的理论，问题陈述清晰且提供了所有必要信息，并且表述客观。我们着手进行推导和求解。\n\n目标是为由以下随机微分方程 (SDE) 给定的一维 Itô 扩散构建一个精确的模拟算法：\n$$\ndX_t = b(X_t)\\,dt + \\sigma(X_t)\\,dW_t\n$$\n其中 $X_t$ 是过程在时间 $t$ 的状态，$b(x)$ 是漂移函数，$\\sigma(x)$ 是波动率函数，$W_t$ 是标准的一维布朗运动。该算法将基于 Lamperti 变换、测度变换论证和用于路径接受的泊松细化。\n\n首先，我们执行 Lamperti 变换以简化 SDE。设 $Y_t = \\eta(X_t)$ 为过程 $X_t$ 的一个变换，其中选择函数 $\\eta(x)$ 以使新过程 $Y_t$ 的波动率恒为 1。我们要求 $\\eta(x)$ 是二次连续可微且严格递增的。对 $Y_t = \\eta(X_t)$ 应用 Itô 公式，我们得到：\n$$\ndY_t = \\eta'(X_t)dX_t + \\frac{1}{2}\\eta''(X_t)(dX_t)^2\n$$\n使用 Itô 微积分的法则，$(dX_t)^2 = (\\sigma(X_t)dW_t)^2 = \\sigma(X_t)^2 dt$。代入 $dX_t$ 的 SDE：\n$$\ndY_t = \\eta'(X_t) \\left( b(X_t)dt + \\sigma(X_t)dW_t \\right) + \\frac{1}{2}\\eta''(X_t)\\sigma(X_t)^2 dt\n$$\n$$\ndY_t = \\left( b(X_t)\\eta'(X_t) + \\frac{1}{2}\\sigma(X_t)^2\\eta''(X_t) \\right)dt + \\eta'(X_t)\\sigma(X_t)dW_t\n$$\n为实现单位波动率，我们必须将 $dW_t$ 项的系数设为 1。这给出了 $\\eta'(x)$ 的条件：\n$$\n\\eta'(x)\\sigma(x) = 1 \\implies \\eta'(x) = \\frac{1}{\\sigma(x)}\n$$\n由于通常假设 $\\sigma(x)$ 为正，所以 $\\eta'(x) > 0$，且 $\\eta(x)$ 是严格递增的。我们可以定义 $\\eta(x) = \\int^x \\frac{1}{\\sigma(u)} du$。逆函数 $x = \\eta^{-1}(y)$ 存在。通过此选择，$Y_t$ 的 SDE 变为：\n$$\ndY_t = \\alpha(Y_t)dt + dW_t\n$$\n新的漂移函数 $\\alpha(y)$ 由变换后 SDE 中的漂移项给出，在 $x = \\eta^{-1}(y)$ 处求值：\n$$\n\\alpha(y) = \\left[ b(x)\\eta'(x) + \\frac{1}{2}\\sigma(x)^2\\eta''(x) \\right]_{x=\\eta^{-1}(y)}\n$$\n使用 $\\eta'(x) = 1/\\sigma(x)$ 和 $\\eta''(x) = -\\sigma'(x)/\\sigma(x)^2$，我们可以简化 $\\alpha(y)$：\n$$\n\\alpha(y) = \\left[ \\frac{b(x)}{\\sigma(x)} - \\frac{1}{2}\\sigma'(x) \\right]_{x=\\eta^{-1}(y)}\n$$\n\n接下来，我们推导接受准则。过程 $Y_t$ 遵循带漂移的布朗运动。我们希望在时间区间 $[0,T]$ 上，以其端点 $Y_0 = y_0$ 和 $Y_T = y_T$ 为条件，模拟 $Y_t$ 的路径。精确模拟的核心思想是从一个更简单的过程（布朗桥）中提议一个候选路径，然后通过一种能够校正概率测度差异的方式来接受或拒绝它。布朗桥是以上下端点为条件的标准布朗运动。令 $\\mathbb{Q}$ 为从 $y_0$ 到 $y_T$ 的布朗桥的定律，令 $\\mathbb{P}$ 为目标过程 $Y_t$ （遵循 $dY_t = \\alpha(Y_t)dt+dW_t$）的定律，同样以相同的端点为条件。\n\n根据 Girsanov 定理，将测度 $\\mathbb{P}$ 与标准（无漂移）布朗运动的测度相关联的 Radon-Nikodym 导数为：\n$$\n\\frac{d\\mathbb{P}}{d\\mathbb{Q}_{\\text{BM}}} = \\exp\\left( \\int_0^T \\alpha(Y_s)dY_s - \\frac{1}{2}\\int_0^T \\alpha(Y_s)^2 ds \\right)\n$$\n布朗桥的测度 $\\mathbb{Q}$ 通过一个条件因子与标准布朗运动测度 $\\mathbb{Q}_{\\text{BM}}$ 相关联，该因子对于固定的端点是常数。因此，目标定律相对于提议定律的密度与此指数因子成正比。项 $\\int_0^T \\alpha(Y_s)dY_s$ 是一个随机积分，对于路径拒绝采样来说不方便。我们可以通过定义一个势 $A(y)$ 使得 $A'(y) = \\alpha(y)$，将其表示为常规积分。对 $A(Y_t)$ 应用 Itô 公式：\n$$\ndA(Y_t) = A'(Y_t)dY_t + \\frac{1}{2}A''(Y_t)dt = \\alpha(Y_t)dY_t + \\frac{1}{2}\\alpha'(Y_t)dt\n$$\n从 $0$ 积分到 $T$ 得到 $\\int_0^T \\alpha(Y_s)dY_s = A(Y_T) - A(Y_0) - \\frac{1}{2}\\int_0^T \\alpha'(Y_s)ds$。将此代入 Radon-Nikodym 导数中：\n$$\n\\frac{d\\mathbb{P}}{d\\mathbb{Q}} \\propto \\exp\\left( A(Y_T) - A(Y_0) - \\frac{1}{2}\\int_0^T \\alpha'(Y_s)ds - \\frac{1}{2}\\int_0^T \\alpha(Y_s)^2 ds \\right)\n$$\n由于端点 $Y_0$ 和 $Y_T$ 是固定的，$A(Y_T) - A(Y_0)$ 是一个常数，可以被吸收到概率的归一化因子中。因此，提议的布朗桥路径 $\\{Y_s\\}_{s\\in[0,T]}$ 的接受概率正比于：\n$$\nP_{\\text{accept}} \\propto \\exp\\left( -\\int_0^T \\left( \\frac{1}{2}\\alpha(Y_s)^2 + \\frac{1}{2}\\alpha'(Y_s) \\right) ds \\right)\n$$\n这定义了势函数 $V(y)$：\n$$\nV(y) = \\frac{1}{2}\\left( \\alpha(y)^2 + \\alpha'(y) \\right)\n$$\n\n为了实现具有此接受概率的拒绝采样方案，我们使用泊松细化。势 $V(y)$ 可以是负数，但泊松过程的速率必须是非负的。我们在一个目标紧区间 $I = [a,b]$ 上定义一个平移过的、非负的速率函数 $\\phi(y)$：\n$$\n\\phi(y) = V(y) - l, \\quad \\text{其中 } l = \\inf_{y \\in I} V(y)\n$$\n根据构造，对于所有 $y \\in I$，$\\phi(y) \\ge 0$。接受概率可以重写为：\n$$\nP_{\\text{accept}} \\propto \\exp\\left( -\\int_0^T (\\phi(Y_s) + l) ds \\right) = e^{-lT} \\exp\\left( -\\int_0^T \\phi(Y_s) ds \\right)\n$$\n项 $e^{-lT}$ 是一个常数。我们可以通过以下方法模拟概率为 $\\exp(-\\int_0^T \\phi(Y_s) ds)$ 的事件。考虑在矩形 $[0,T] \\times [0,M]$ 上的一个强度为 1 的二维齐次泊松点过程，其中 $M$ 是 $\\phi(y)$ 在 $I$ 上的一个上界，即 $M = \\sup_{y \\in I} \\phi(y)$。该过程中没有点 $(t_i, v_i)$ 落入 $\\phi(Y_s)$ 曲线下方区域（即 $v_i \\le \\phi(Y_{t_i})$）的概率恰好是 $\\exp(-\\int_0^T \\phi(Y_s) ds)$。\n\n这引出了路径泊松细化算法：\n1. 对于给定的紧区间 $I$ 和时间范围 $T$，计算 $l = \\inf_{y\\in I} V(y)$ 和 $M = \\sup_{y\\in I} (V(y) - l)$。这个 $M$ 是最小包络常数。其最小性对算法的效率至关重要，因为需要检查的提议点数量与 $M$ 成正比。\n2. 从均值为 $\\lambda = M \\cdot T$ 的泊松分布中生成提议点的数量 $N$。\n3. 如果 $N=0$，则接受路径。否则，在 $[0,T]$ 上独立均匀地生成 $N$ 个提议时间 $t_1, \\dots, t_N$，并在 $[0,M]$ 上独立均匀地生成 $N$ 个标记 $v_1, \\dots, v_N$。\n4. 通过在所需时间 $\\{t_i\\}$ 处对端点为 $y_0, y_T$ 的布朗桥 $\\{Y_s\\}_{s\\in[0,T]}$ 的值进行采样来提议路径。向量 $(Y_{t_1}, \\dots, Y_{t_N})$ 从一个多元正态分布中抽取，其均值向量为 $\\mu_i = y_0 + (t_i/T)(y_T-y_0)$，协方差矩阵为 $\\Sigma_{ij} = \\min(t_i, t_j) - t_i t_j / T$。\n5. 当且仅当对于所有 $i \\in \\{1,\\dots,N\\}$，点 $(t_i, v_i)$ 都在速率函数图像上方时，即 $v_i > \\phi(Y_{t_i})$，接受提议的路径。否则，拒绝路径。", "answer": "```python\nimport numpy as np\nfrom scipy.special import erf\n\n# Per the problem spec, we can use numpy and scipy.\n# scipy.special is part of scipy.\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for exact diffusion simulation.\n    \"\"\"\n    np.random.seed(42)\n\n    # --- Test Case Definitions ---\n\n    # Test Case 1: Geometric Brownian Motion\n    mu1, sigma1 = 0.2, 0.5\n    eta1 = lambda x: (1 / sigma1) * np.log(x)\n    alpha1_val = mu1 / sigma1 - sigma1 / 2\n    # V(y) is constant because alpha(y) is constant and alpha'(y) = 0\n    V1 = lambda y: 0.5 * (alpha1_val**2)\n    T1, x0_1, xT_1 = 0.7, 1.0, 1.3\n    y0_1, yT_1 = eta1(x0_1), eta1(xT_1)\n    I1 = [min(y0_1, yT_1) - 0.5, max(y0_1, yT_1) + 0.5]\n    case1 = (V1, T1, y0_1, yT_1, I1)\n\n    # Test Case 2: Ornstein-Uhlenbeck\n    kappa2, theta2, sigma0_2 = 1.0, 0.0, 1.0\n    # eta(x) = x/sigma0, so just x\n    # alpha(y) = kappa*theta/sigma0 - kappa*y. With given params, alpha(y) = -y\n    # alpha'(y) = -1\n    V2 = lambda y: 0.5 * ((-y)**2 - 1)\n    T2, x0_2, xT_2 = 1.0, 0.2, -0.1\n    y0_2, yT_2 = x0_2, xT_2  # Since eta(x) = x\n    I2 = [-1.0, 1.0]\n    case2 = (V2, T2, y0_2, yT_2, I2)\n\n    # Test Case 3: Driftless diffusion\n    # b(x) = 0, sigma(x) = sqrt(1+x^2)\n    # eta(x) = arcsinh(x)\n    # alpha(y) = -0.5 * tanh(y)\n    # alpha'(y) = -0.5 * sech^2(y)\n    # V(y) = 0.5 * (alpha^2 + alpha') = 0.5 * (0.25*tanh^2(y) - 0.5*sech^2(y))\n    # Using sech^2 = 1 - tanh^2, V(y) = 1/8 * (3*tanh^2(y) - 2)\n    V3 = lambda y: (1 / 8) * (3 * np.tanh(y)**2 - 2)\n    T3, x0_3, xT_3 = 0.5, 0.5, -0.2\n    y0_3, yT_3 = np.arcsinh(x0_3), np.arcsinh(xT_3)\n    I3 = [-1.0, 1.0]\n    case3 = (V3, T3, y0_3, yT_3, I3)\n\n    test_cases = [case1, case2, case3]\n    results = []\n\n    for case in test_cases:\n        result = run_simulation(*case)\n        results.append(result)\n\n    # --- Final Output Formatting ---\n    def format_result(res):\n        # Manually format the list string to avoid spaces and format the boolean\n        return f\"[{res[0]},{res[1]},{str(res[2]).lower()}]\"\n\n    formatted_results = [format_result(r) for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef run_simulation(V, T, y0, yT, I):\n    \"\"\"\n    Executes one instance of the exact simulation algorithm.\n    \n    Args:\n        V (callable): The potential function V(y).\n        T (float): The time horizon.\n        y0 (float): The starting point in y-space.\n        yT (float): The ending point in y-space.\n        I (list or tuple): The compact interval [a, b].\n\n    Returns:\n        list: A list containing [M, l, accept].\n    \"\"\"\n    # Step 1: Numerically compute l and M\n    y_grid = np.linspace(I[0], I[1], 10001)\n    V_values = V(y_grid)\n    \n    l = np.min(V_values)\n    phi_values = V_values - l\n    M = np.max(phi_values)\n\n    # Step 2: Simulate Poisson points\n    if M * T == 0:\n        N = 0\n    else:\n        N = np.random.poisson(M * T)\n\n    if N == 0:\n        return [M, l, True]\n\n    t_proposals = np.random.uniform(0, T, N)\n    v_proposals = np.random.uniform(0, M, N)\n\n    # Step 3: Sample Brownian bridge\n    # Sort times for easier covariance matrix construction\n    sorted_indices = np.argsort(t_proposals)\n    t = t_proposals[sorted_indices]\n    v = v_proposals[sorted_indices]\n\n    # Mean vector\n    mu_bridge = y0 + (t / T) * (yT - y0)\n\n    # Covariance matrix\n    t_i_matrix = np.tile(t, (N, 1))\n    t_j_matrix = t_i_matrix.T\n    cov_bridge = np.minimum(t_i_matrix, t_j_matrix) - (t_i_matrix * t_j_matrix) / T\n    # Add small jitter for numerical stability, though often not needed for bridge\n    cov_bridge += np.eye(N) * 1e-12\n\n    Y_samples = np.random.multivariate_normal(mu_bridge, cov_bridge)\n\n    # Step 4: Acceptance test\n    phi_samples = V(Y_samples) - l\n    \n    accept = np.all(v > phi_samples)\n\n    return [M, l, bool(accept)]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3306885"}, {"introduction": "在构建了完整算法之后，这个实践将聚焦于优化其关键组成部分：拒绝采样步骤。您将探索一种“单次接受检验”技术，这是一种巧妙的方法，它利用势函数的全局界来尝试接受一个提议的路径，而无需进行高成本的逐点检查。通过为特定的物理势推导这些界限并实现效率检查，您将深入了解精确算法的实际性能考量和优化策略 [@problem_id:3306946]。", "problem": "考虑由随机微分方程 $dX_t = b(X_t)\\,dt + dW_t$ 定义在实数轴上的一维伊藤扩散，其中 $W_t$ 是一个标准维纳过程，漂移 $b(x)$ 是一个凸势 $U(x)$ 的负梯度，即 $b(x) = -U'(x)$。假设 $U$ 是二次连续可微的，$U''(x) \\ge 0$ 对所有 $x$ 成立，并且 $U'$ 和 $U''$ 都是全局有界的，意味着存在有限常数 $G \\ge 0$ 和 $L \\ge 0$ 使得 $\\sup_{x \\in \\mathbb{R}} |U'(x)| \\le G$ 和 $\\sup_{x \\in \\mathbb{R}} U''(x) \\le L$。令 $Y_t$ 表示在时间区间 $[0,T]$ 上从 $x_0$ 到 $x_T$ 的一个布朗桥，在用于模拟扩散桥的Beskos–Roberts类型的测度变换精确算法中用作参考路径。在此框架下，在 $[0,T]$ 上扩散路径定律与布朗桥路径定律之间的Radon–Nikodym导数涉及带有被积函数 \n$$\nV(y) = \\frac{1}{2}\\left(b(y)^2 + b'(y)\\right) = \\frac{1}{2}\\left((U'(y))^2 - U''(y)\\right).\n$$\n的Feynman–Kac泛函。基于拒绝采样的标准精确算法可以通过非齐次泊松细化构造来表达，其中以 $(Y_t)_{t \\in [0,T]}$ 的一个实现为条件，并给定一个全局常数 $M \\ge \\sup_{y \\in \\mathbb{R}} V(y)$，接受等价于一个在 $[0,T]$ 上瞬时速率为 $\\lambda(t) = M - V(Y_t)$ 的泊松过程没有点（即点数为零）的事件，其条件概率等于 $\\exp\\left(-\\int_0^T (M - V(Y_t))\\,dt\\right)$。一个单次接受检验可以通过使用一个指数时钟 $E \\sim \\mathrm{Exp}(1)$ 来实现，当且仅当 $E \\ge \\int_0^T (M - V(Y_t))\\,dt$ 时接受，这在分布上等价于零事件准则。一般而言，路径积分 $\\int_0^T V(Y_t)\\,dt$ 无法直接计算；然而，在所述的全局有界性假设下并利用 $U$ 的凸性，可以对 $V$ 进行全局定界：\n$$\nm \\le V(y) \\le M \\quad \\text{对所有 } y \\in \\mathbb{R},\n$$\n其中 $m = \\inf_{y \\in \\mathbb{R}} V(y)$ 且 $M = \\sup_{y \\in \\mathbb{R}} V(y)$。这在积分风险上产生了一个确定性区间：\n$$\n0 \\le \\int_0^T (M - V(Y_t))\\,dt \\le T\\,(M - m).\n$$\n因此，一个永不出错但可能保守的单次指数时钟检验是：生成 $E \\sim \\mathrm{Exp}(1)$，如果 $E \\ge T\\,(M - m)$ 则立即接受；否则，推迟（在一个完整的精确算法中，人们会精化局部界或选择性地评估路径；这里，我们只关注这个全局单次检验）。这个单次检验无需任何进一步计算即接受的概率至少为\n$$\np_{\\mathrm{lb}}(T) = \\mathbb{P}\\big(E \\ge T\\,(M - m)\\big) = \\exp\\big(-T\\,(M - m)\\big).\n$$\n您的任务是：\n- 从伊藤测度变换恒等式和上面 $V(y)$ 的定义出发，仅使用所提供的假设，从第一性原理推导出全局界 $m$ 和 $M$（用凸势 $U$ 及其导数表示）。将您的推导明确地具体化到以下两个满足有界条件的凸势：\n    1. $U_{\\mathrm{ch}}(x) = \\log\\cosh(\\alpha x)$，参数 $\\alpha > 0$。\n    2. $U_{\\mathrm{sq}}(x) = \\sqrt{1 + (\\alpha x)^2}$，参数 $\\alpha > 0$。\n  对每种势，通过分析 $U'$ 和 $U''$ 推导出 $m$ 和 $M$ 的精确闭式解值，从而获得 $M - m$ 作为 $\\alpha$ 的函数的精确值。\n- 使用上述单次指数检验，将此第一阶段检验的效率代理指标定义为 $p_{\\mathrm{lb}}(T) = \\exp(-T\\,(M - m))$。对于给定的效率阈值 $\\tau \\in (0,1)$，如果 $p_{\\mathrm{lb}}(T) \\ge \\tau$，则称该单次检验是高效的。\n- 实现一个程序，对于下面测试套件中的每个测试用例 $(\\text{potential\\_type}, \\alpha, T, \\tau)$，计算：\n    - 您推导出的 $M - m$ 的精确值。\n    - 效率代理指标 $p_{\\mathrm{lb}}(T) = \\exp(-T\\,(M - m))$。\n    - 效率指示器，定义为：如果 $p_{\\mathrm{lb}}(T) \\ge \\tau$，则为 $1$，否则为 $0$。\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，其中每个条目是针对一个测试用例的三元素列表 $[M\\_minus\\_m, p\\_lb, efficient]$，并按此顺序排列。所有浮点输出都应采用标准十进制形式。此问题不涉及物理单位。\n\n测试套件：\n- 情况 1：$(\\text{potential\\_type} = \\text{\"ch\"}, \\alpha = 0.8, T = 1.0, \\tau = 0.6)$。\n- 情况 2：$(\\text{potential\\_type} = \\text{\"ch\"}, \\alpha = 1.5, T = 1.0, \\tau = 0.2)$。\n- 情况 3：$(\\text{potential\\_type} = \\text{\"sq\"}, \\alpha = 1.0, T = 0.5, \\tau = 0.6)$。\n- 情况 4：$(\\text{potential\\_type} = \\text{\"ch\"}, \\alpha = 0.5, T = 0.0, \\tau = 0.9)$。\n- 情况 5：$(\\text{potential\\_type} = \\text{\"sq\"}, \\alpha = 0.3, T = 3.0, \\tau = 0.7)$。\n\n最终输出格式：\n您的程序应精确地打印一行，格式如下\n$[\\,[M\\_minus\\_m^{(1)},p\\_lb^{(1)},\\text{efficient}^{(1)}],\\ldots,[M\\_minus\\_m^{(5)},p\\_lb^{(5)},\\text{efficient}^{(5)}]\\,]$\n逗号后无空格。", "solution": "首先验证问题，以确保其科学基础扎实、内容自洽且定义明确。\n\n### 步骤1：提取已知条件\n- **随机微分方程 (SDE):** $dX_t = b(X_t)\\,dt + dW_t$。\n- **漂移:** $b(x) = -U'(x)$，其中 $U(x)$ 是一个凸势。\n- **势的性质:**\n    - $U$ 是二次连续可微的 ($C^2$)。\n    - 对所有 $x \\in \\mathbb{R}$，$U''(x) \\ge 0$。\n    - $\\sup_{x \\in \\mathbb{R}} |U'(x)| \\le G < \\infty$。\n    - $\\sup_{x \\in \\mathbb{R}} U''(x) \\le L < \\infty$。\n- **Feynman–Kac被积函数:** $V(y) = \\frac{1}{2}\\left(b(y)^2 + b'(y)\\right) = \\frac{1}{2}\\left((U'(y))^2 - U''(y)\\right)$。\n- **全局界:** $m = \\inf_{y \\in \\mathbb{R}} V(y)$ 和 $M = \\sup_{y \\in \\mathbb{R}} V(y)$。\n- **效率代理指标:** $p_{\\mathrm{lb}}(T) = \\exp(-T(M - m))$。\n- **效率条件:** 如果 $p_{\\mathrm{lb}}(T) \\ge \\tau$，则检验是高效的，其中阈值 $\\tau \\in (0,1)$。\n- **具体势:**\n    1. $U_{\\mathrm{ch}}(x) = \\log\\cosh(\\alpha x)$，其中 $\\alpha > 0$。\n    2. $U_{\\mathrm{sq}}(x) = \\sqrt{1 + (\\alpha x)^2}$，其中 $\\alpha > 0$。\n- **任务:**\n    1. 为每种势推导出 $M-m$ 的闭式表达式。\n    2. 实现一个程序，为给定的测试用例计算 $M-m$、$p_{\\mathrm{lb}}(T)$ 和一个效率指示器。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学基础:** 该问题深植于随机分析和计算统计学理论，特别是关于扩散过程的精确模拟算法（Beskos–Roberts框架）。从扩散定律到布朗桥定律的测度变换、由此产生的涉及Feynman–Kac项的Radon–Nikodym导数，以及通过泊松细化进行的拒绝采样，都是该领域中标准且数学上严谨的概念。所选的势是常见的良态函数。该问题在科学上是合理的。\n- **适定性:** 定义精确，目标明确。任务是推导解析表达式，然后基于它们进行数值计算。所涉及的函数是光滑的，其全局极值可以使用标准微积分找到，确保存在唯一解。\n- **客观性:** 问题陈述是形式化的、定量的，并且没有任何主观或模糊的语言。\n- **结论:** 该问题不违反任何无效性标准。它是一个在计算统计学领域中定义明确的数学问题。\n\n### 步骤3：判定与行动\n问题有效。将提供完整解答。\n\n### 全局界的推导\n\n问题的核心是为两种指定的势函数，找出函数 $V(y) = \\frac{1}{2}\\left((U'(y))^2 - U''(y)\\right)$ 的下确界 $m$ 和上确界 $M$。我们关心的量是 $M-m$。\n\n#### 情况1：势 $U_{\\mathrm{ch}}(x) = \\log\\cosh(\\alpha x)$\n\n首先，我们计算当 $\\alpha > 0$ 时 $U_{\\mathrm{ch}}(x)$ 的一阶和二阶导数。\n一阶导数为：\n$$\nU'_{\\mathrm{ch}}(x) = \\frac{d}{dx} \\log\\cosh(\\alpha x) = \\frac{1}{\\cosh(\\alpha x)} \\cdot \\sinh(\\alpha x) \\cdot \\alpha = \\alpha \\tanh(\\alpha x)\n$$\n二阶导数为：\n$$\nU''_{\\mathrm{ch}}(x) = \\frac{d}{dx} (\\alpha \\tanh(\\alpha x)) = \\alpha \\cdot (\\text{sech}^2(\\alpha x) \\cdot \\alpha) = \\alpha^2 \\text{sech}^2(\\alpha x)\n$$\n现在，我们使用这些导数构造函数 $V(y)$：\n$$\nV(y) = \\frac{1}{2}\\left((U'_{\\mathrm{ch}}(y))^2 - U''_{\\mathrm{ch}}(y)\\right) = \\frac{1}{2}\\left((\\alpha \\tanh(\\alpha y))^2 - \\alpha^2 \\text{sech}^2(\\alpha y)\\right)\n$$\n使用三角恒等式 $\\text{sech}^2(z) = 1 - \\tanh^2(z)$，我们可以简化 $V(y)$：\n$$\nV(y) = \\frac{1}{2}\\left(\\alpha^2 \\tanh^2(\\alpha y) - \\alpha^2(1 - \\tanh^2(\\alpha y))\\right) = \\frac{1}{2}\\left(\\alpha^2 \\tanh^2(\\alpha y) - \\alpha^2 + \\alpha^2 \\tanh^2(\\alpha y)\\right)\n$$\n$$\nV(y) = \\frac{1}{2}\\left(2\\alpha^2 \\tanh^2(\\alpha y) - \\alpha^2\\right) = \\alpha^2 \\tanh^2(\\alpha y) - \\frac{\\alpha^2}{2}\n$$\n为求全局界 $m$ 和 $M$，我们分析 $V(y)$ 的值域。函数 $\\tanh(z)$ 的值域为 $(-1, 1)$。因此，$\\tanh^2(z)$ 的值域为 $[0, 1)$。\n$\\tanh^2(\\alpha y)$ 在 $y \\in \\mathbb{R}$ 上的下确界为 $0$，在 $y=0$ 处取得。\n$\\tanh^2(\\alpha y)$ 在 $y \\in \\mathbb{R}$ 上的上确界为 $1$，在 $|y| \\to \\infty$ 时趋近。\n\n$V(y)$ 的下确界因此为：\n$$\nm = \\inf_{y \\in \\mathbb{R}} V(y) = \\alpha^2 \\cdot 0 - \\frac{\\alpha^2}{2} = -\\frac{\\alpha^2}{2}\n$$\n$V(y)$ 的上确界为：\n$$\nM = \\sup_{y \\in \\mathbb{R}} V(y) = \\alpha^2 \\cdot 1 - \\frac{\\alpha^2}{2} = \\frac{\\alpha^2}{2}\n$$\n差值 $M-m$ 为：\n$$\nM - m = \\frac{\\alpha^2}{2} - \\left(-\\frac{\\alpha^2}{2}\\right) = \\alpha^2\n$$\n\n#### 情况2：势 $U_{\\mathrm{sq}}(x) = \\sqrt{1 + (\\alpha x)^2}$\n\n接下来，我们分析当 $\\alpha > 0$ 时的势 $U_{\\mathrm{sq}}(x) = (1 + \\alpha^2 x^2)^{1/2}$。\n一阶导数为：\n$$\nU'_{\\mathrm{sq}}(x) = \\frac{d}{dx} (1 + \\alpha^2 x^2)^{1/2} = \\frac{1}{2}(1 + \\alpha^2 x^2)^{-1/2} \\cdot (2\\alpha^2 x) = \\frac{\\alpha^2 x}{\\sqrt{1 + \\alpha^2 x^2}}\n$$\n使用商法则求二阶导数：\n$$\nU''_{\\mathrm{sq}}(x) = \\frac{\\alpha^2 \\sqrt{1 + \\alpha^2 x^2} - \\alpha^2 x \\left(\\frac{\\alpha^2 x}{\\sqrt{1 + \\alpha^2 x^2}}\\right)}{1 + \\alpha^2 x^2}\n$$\n分子分母同乘 $\\sqrt{1 + \\alpha^2 x^2}$ 可以简化表达式：\n$$\nU''_{\\mathrm{sq}}(x) = \\frac{\\alpha^2 (1 + \\alpha^2 x^2) - (\\alpha^2 x)^2}{(1 + \\alpha^2 x^2)^{3/2}} = \\frac{\\alpha^2 + \\alpha^4 x^2 - \\alpha^4 x^2}{(1 + \\alpha^2 x^2)^{3/2}} = \\frac{\\alpha^2}{(1 + \\alpha^2 x^2)^{3/2}}\n$$\n现在，我们构造函数 $V(y)$：\n$$\n(U'_{\\mathrm{sq}}(y))^2 = \\frac{\\alpha^4 y^2}{1 + \\alpha^2 y^2}\n$$\n$$\nV(y) = \\frac{1}{2}\\left((U'_{\\mathrm{sq}}(y))^2 - U''_{\\mathrm{sq}}(y)\\right) = \\frac{1}{2}\\left(\\frac{\\alpha^4 y^2}{1 + \\alpha^2 y^2} - \\frac{\\alpha^2}{(1 + \\alpha^2 y^2)^{3/2}}\\right)\n$$\n我们提出因子 $\\frac{\\alpha^2}{2}$ 并代换 $z = \\alpha y$：\n$$\nV(y) = \\frac{\\alpha^2}{2} \\left(\\frac{z^2}{1 + z^2} - \\frac{1}{(1 + z^2)^{3/2}}\\right)\n$$\n为求括号内项的极值，设 $f(z) = \\frac{z^2}{1 + z^2} - \\frac{1}{(1 + z^2)^{3/2}}$。我们可以通过注意到此函数为偶函数（即 $f(z)=f(-z)$）并且其行为取决于 $|z|$ 来分析它。设 $u = 1+z^2$，其中 $u \\in [1, \\infty)$。则 $z^2 = u-1$。我们可以将 $f(z)$ 重写为 $u$ 的函数：\n$$\ng(u) = \\frac{u-1}{u} - u^{-3/2} = 1 - u^{-1} - u^{-3/2}\n$$\n为求 $u \\ge 1$ 时 $g(u)$ 的极值，我们计算其导数：\n$$\ng'(u) = (-1)(-1)u^{-2} - (-\\frac{3}{2})u^{-5/2} = u^{-2} + \\frac{3}{2}u^{-5/2}\n$$\n对于 $u \\ge 1$， $u^{-2}$ 和 $u^{-5/2}$ 均为正，因此 $g'(u) > 0$。这意味着 $g(u)$ 是 $u$ 的严格递增函数。由于 $u=1+z^2$ 是 $|z|$ 的递增函数，所以 $f(z)=g(1+z^2)$ 是 $|z|$ 的严格递增函数。\n$f(z)$ 的最小值在 $|z|$ 的最小值处取得，即 $z=0$ (对应于 $u=1$）。\n$$\n\\inf_{z \\in \\mathbb{R}} f(z) = f(0) = g(1) = 1 - 1^{-1} - 1^{-3/2} = 1 - 1 - 1 = -1\n$$\n$f(z)$ 的上确界是 $|z| \\to \\infty$ 时的极限 (对应于 $u \\to \\infty$）。\n$$\n\\sup_{z \\in \\mathbb{R}} f(z) = \\lim_{u \\to \\infty} g(u) = \\lim_{u \\to \\infty} \\left(1 - \\frac{1}{u} - \\frac{1}{u^{3/2}}\\right) = 1\n$$\n现在我们可以求出 $V(y)$ 的界：\n$$\nm = \\inf_{y \\in \\mathbb{R}} V(y) = \\frac{\\alpha^2}{2} \\cdot (\\inf f(\\alpha y)) = \\frac{\\alpha^2}{2} \\cdot (-1) = -\\frac{\\alpha^2}{2}\n$$\n$$\nM = \\sup_{y \\in \\mathbb{R}} V(y) = \\frac{\\alpha^2}{2} \\cdot (\\sup f(\\alpha y)) = \\frac{\\alpha^2}{2} \\cdot (1) = \\frac{\\alpha^2}{2}\n$$\n差值 $M-m$ 为：\n$$\nM - m = \\frac{\\alpha^2}{2} - \\left(-\\frac{\\alpha^2}{2}\\right) = \\alpha^2\n$$\n\n### 推导结论\n对于势 $U_{\\mathrm{ch}}(x)$ 和 $U_{\\mathrm{sq}}(x)$，Feynman-Kac被积函数 $V(y)$ 的全局上确界与下确界之差由一个简单的表达式给出：\n$$\nM - m = \\alpha^2\n$$\n因此，效率代理指标为 $p_{\\mathrm{lb}}(T) = \\exp(-T(M-m)) = \\exp(-T\\alpha^2)$。如果 $\\exp(-T\\alpha^2) \\ge \\tau$，则该检验被认为是高效的。此结果将在实现中使用。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the efficiency metrics for a single-shot exponential test\n    in an exact algorithm for simulating diffusion bridges.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (potential_type, alpha, T, tau)\n    test_cases = [\n        (\"ch\", 0.8, 1.0, 0.6),\n        (\"ch\", 1.5, 1.0, 0.2),\n        (\"sq\", 1.0, 0.5, 0.6),\n        (\"ch\", 0.5, 0.0, 0.9),\n        (\"sq\", 0.3, 3.0, 0.7),\n    ]\n\n    results = []\n    for case in test_cases:\n        potential_type, alpha, T, tau = case\n\n        # As derived in the solution, for both potential types (\"ch\" and \"sq\"),\n        # the difference M - m is given by alpha^2.\n        # M = sup V(y) and m = inf V(y) where V(y) = 0.5 * ((U'(y))^2 - U''(y)).\n        # For U_ch(x) = log(cosh(alpha*x)), M = alpha^2/2, m = -alpha^2/2.\n        # For U_sq(x) = sqrt(1 + (alpha*x)^2), M = alpha^2/2, m = -alpha^2/2.\n        # In both cases, M - m = alpha^2.\n        M_minus_m = alpha**2\n\n        # The efficiency proxy is p_lb(T) = exp(-T * (M - m)).\n        p_lb = np.exp(-T * M_minus_m)\n\n        # The efficiency indicator is 1 if p_lb >= tau, and 0 otherwise.\n        efficient = 1 if p_lb >= tau else 0\n        \n        # Store the results for this case.\n        results.append([M_minus_m, p_lb, efficient])\n\n    # Format the final output string as specified:\n    # [[M_minus_m_1,p_lb_1,efficient_1],...,[M_minus_m_5,p_lb_5,efficient_5]]\n    # No spaces are allowed after commas.\n    output_str = \"[\" + \",\".join([f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]) + \"]\"\n\n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```", "id": "3306946"}]}