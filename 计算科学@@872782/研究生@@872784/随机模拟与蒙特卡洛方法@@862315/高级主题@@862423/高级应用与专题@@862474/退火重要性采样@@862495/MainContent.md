## 引言
在[高维统计](@entry_id:173687)建模、[物理模拟](@entry_id:144318)和机器学习中，计算[概率分布](@entry_id:146404)的[归一化常数](@entry_id:752675)（或称[配分函数](@entry_id:193625)、边缘[似然](@entry_id:167119)）是一个普遍存在的核心挑战。直接应用标准重要性抽样等方法往往因[方差](@entry_id:200758)爆炸而失效，导致结果不可靠。[退火](@entry_id:159359)重要性抽样（Annealed Importance Sampling, AIS）作为一种先进的蒙特卡洛技术，为解决这一难题提供了优雅而强大的框架。

本文旨在系统性地介绍[退火](@entry_id:159359)重要性抽样。我们将首先在“原理和机制”一节中，从重要性抽样的局限性出发，逐步构建AIS的理论基础，阐明其算法流程、无偏性以及[方差](@entry_id:200758)等关键性质。接着，在“应用与跨学科联系”一节中，我们将展示AIS如何在统计物理、贝叶斯统计和机器学习等领域解决实际问题，例如计算自由能、进行模型选择和评估[深度生成模型](@entry_id:748264)。最后，“动手实践”部分将通过一系列精心设计的练习，引导读者应对实际应用中的挑战并掌握[优化算法](@entry_id:147840)性能的技巧。通过本文的学习，您将深刻理解AIS的内在逻辑，并具备将其应用于自己研究领域的能力。

## 原理和机制

[退火](@entry_id:159359)重要性抽样（Annealed Importance Sampling, AIS）是一种强大的[蒙特卡洛方法](@entry_id:136978)，用于处理复杂[概率分布](@entry_id:146404)，特别是计算其[归一化常数](@entry_id:752675)（或[配分函数](@entry_id:193625)）的挑战。本节将深入探讨 AIS 的核心原理和工作机制。我们将从标准重要性抽样的局限性出发，逐步构建 AIS 的理论框架，阐明其算法流程、关键性质以及在实践中面临的挑战和解决方案。

### 重要性抽样的局限性：为何需要退火？

在许多统计和物理问题中，一个核心任务是估计[目标分布](@entry_id:634522) $\pi_T(x) \propto f_T(x)$ 的归一化常数 $Z_T = \int f_T(x) dx$。一个常见的方法是相对于一个更简单的、已知[归一化常数](@entry_id:752675) $Z_0$ 的基础[分布](@entry_id:182848) $\pi_0(x) = f_0(x)/Z_0$ 来计算比率 $R = Z_T/Z_0$。

标准的重要性抽样 (Importance Sampling, IS) 为此提供了一个直接的估计器。通过从基础[分布](@entry_id:182848) $\pi_0$ 中抽取独立同分布的样本 $X_1, \dots, X_n$，我们可以构建如下的[无偏估计](@entry_id:756289)器：
$$
\widehat{R}_{\text{IS}} = \frac{1}{n} \sum_{i=1}^{n} w(X_i) \quad \text{其中} \quad w(X) = \frac{f_T(X)}{f_0(X)}
$$
这个估计器的无偏性源于一个简单的期望恒等式：
$$
\mathbb{E}_{\pi_0}[w(X)] = \int \frac{f_T(x)}{f_0(x)} \pi_0(x) dx = \int \frac{f_T(x)}{f_0(x)} \frac{f_0(x)}{Z_0} dx = \frac{1}{Z_0} \int f_T(x) dx = \frac{Z_T}{Z_0}
$$
[@problem_id:3288047] [@problem_id:3288132]

尽管在理论上很优雅，但这个简单的 IS 估计器在实践中常常会失效，尤其是在高维空间中。其可靠性取决于权重 $w(X)$ 的[方差](@entry_id:200758)，而这个[方差](@entry_id:200758)可能极大，甚至无穷大，从而导致估计完全不可靠。这种失效主要源于以下两个问题：

1.  **支撑集不匹配 (Support Mismatch)**：重要性抽样的一个基本要求是，如果目标分布在某个区域 $A$ 中有不可忽略的概率质量（即 $\pi_T(A) > 0$），那么[提议分布](@entry_id:144814)在该区域也必须有非零的概率（即 $\pi_0(A) > 0$）。如果这个条件不满足，即 $\text{supp}(\pi_T) \not\subseteq \text{supp}(\pi_0)$，那么从 $\pi_0$ 中抽取的样本将永远无法覆盖 $\pi_T$ 的整个支撑集。这将导致对 $Z_T$ 的系统性低估，使得估计器有偏。[@problem_id:3288049]

2.  **权重简并 (Weight Degeneracy)**：即使支撑集条件满足，如果提议分布 $\pi_0$ 和[目标分布](@entry_id:634522) $\pi_T$ 的[形态差异](@entry_id:172490)巨大，权重的[方差](@entry_id:200758)也会爆炸。这种情况在高维空间中尤其严重。假设 $x \in \mathbb{R}^d$，且[分布](@entry_id:182848)具有乘积形式，如 $f_0(x) = \prod_{j=1}^d f_0^{(j)}(x_j)$ 和 $f_T(x) = \prod_{j=1}^d f_T^{(j)}(x_j)$。此时，重要性权重也成为一个乘积：$w(x) = \prod_{j=1}^d \frac{f_T^{(j)}(x_j)}{f_0^{(j)}(x_j)}$。权重的二阶矩 $\mathbb{E}[w(X)^2]$ 会随着维度 $d$ [指数增长](@entry_id:141869)，除非每个维度上的[分布](@entry_id:182848)都非常匹配。这会导致“权重简并”现象：在所有样本中，绝大多数权重都接近于零，而极少数样本的权重异常巨大。最终的估计值完全由这几个异常大的权重决定，极其不稳定。[@problem_id:3288047] 同样，如果[目标分布](@entry_id:634522)的尾部比[提议分布](@entry_id:144814)更重（例如，用[标准正态分布](@entry_id:184509)去估计[学生t分布](@entry_id:267063)的期望），权重的二阶矩也可能不存在（即[方差](@entry_id:200758)无穷大），使得估计器无效。[@problem_id:3288049]

这些局限性表明，从一个简单的[提议分布](@entry_id:144814)直接跳到复杂的目标分布通常是不可行的。我们需要一种方法来平滑地连接这两个[分布](@entry_id:182848)。

### [退火](@entry_id:159359)原理：构建桥接[分布](@entry_id:182848)

[退火](@entry_id:159359)重要性抽样的核心思想是“[分而治之](@entry_id:273215)”。与其尝试一次性跨越从 $f_0$ 到 $f_T$ 的巨大鸿沟，不如沿着一条由中间[分布](@entry_id:182848)构成的“桥梁”逐步前行。这个过程被称为**[退火](@entry_id:159359) (annealing)**，类比于物理学中通过缓慢降温使系统达到低能态的过程。

我们构建一个以“[逆温](@entry_id:140086)度”参数 $\beta \in [0, 1]$ 索引的路径，连接基础密度 $f_0$ 和目标密度 $f_T$。一个标准的选择是**几何路径 (geometric path)**：
$$
f_{\beta}(x) = f_0(x)^{1-\beta} f_T(x)^{\beta}
$$
这条路径上的[分布](@entry_id:182848) $f_\beta$ 平滑地从 $f_0$（当 $\beta=0$）过渡到 $f_T$（当 $\beta=1$）。然后，我们选择一个离散的、单调递增的[温度计](@entry_id:187929)划（schedule）$0 = \beta_0  \beta_1  \dots  \beta_K = 1$。我们的目标——估计比率 $Z_T/Z_0$——现在可以分解为一个伸缩积 (telescoping product)：
$$
\frac{Z_T}{Z_0} = \frac{Z_{\beta_K}}{Z_{\beta_0}} = \prod_{k=1}^{K} \frac{Z_{\beta_k}}{Z_{\beta_{k-1}}}
$$
其中 $Z_{\beta_k}$ 是 $f_{\beta_k}$ 的[归一化常数](@entry_id:752675)。通过引入 $K-1$ 个中间[分布](@entry_id:182848)，我们将一个可能极具挑战性的估计问题，分解成了 $K$ 个更容易处理的子问题：估计相邻[分布](@entry_id:182848)之间的归一化常数比率。由于 $\beta_k$ 和 $\beta_{k-1}$ 很接近，[分布](@entry_id:182848) $f_{\beta_k}$ 和 $f_{\beta_{k-1}}$ 的重叠程度会远高于 $f_0$ 和 $f_T$，从而有望控制每一步重要性权重的[方差](@entry_id:200758)。

### AIS 算法：路径抽样与权重构造

AIS 巧妙地在扩展的路径空间上实现了重要性抽样，以估计上述伸缩积。一个 AIS 算法的完[整流](@entry_id:197363)程包含路径生成和权重计算两个部分。

#### 路径生成

AIS 在一个由[状态和](@entry_id:193625)温度索引构成的扩展空间中生成一条路径 $(x_0, x_1, \dots, x_K)$。这个过程定义了路径空间上的一个[提议分布](@entry_id:144814) $q(x_{0:K})$。

1.  **初始化**：从初始的归一化[分布](@entry_id:182848) $\pi_0(x) = f_0(x)/Z_0$ 中抽取一个精确样本 $x_0 \sim \pi_0$。这通常要求 $\pi_0$ 是一个易于采样的[分布](@entry_id:182848)（例如标准正态分布）。

2.  **马尔可夫跃迁**：对于每个后续步骤 $k=1, \dots, K$，我们使用一个马尔可夫转移核 (Markov transition kernel) $T_k(\cdot | x_{k-1})$ 从前一个状态 $x_{k-1}$ 生成新状态 $x_k$。这里的关键设计在于，核 $T_k$ 必须保持**下一个**温度的[分布](@entry_id:182848) $\pi_{\beta_k}(x) \propto f_{\beta_k}(x)$ **不变 (invariant)**。这意味着如果一个[随机变量](@entry_id:195330)服从 $\pi_{\beta_k}$，经过 $T_k$ 转移后，它仍然服从 $\pi_{\beta_k}$。这通常通过构造一个以 $\pi_{\beta_k}$ 为[目标分布](@entry_id:634522)的[马尔可夫链蒙特卡洛](@entry_id:138779) (Markov Chain Monte Carlo, MCMC) 步骤来实现，例如 Metropolis-Hastings 算法。

这个序贯采样过程定义的路径提议分布为：
$$
q(x_{0:K}) = \pi_0(x_0) \prod_{k=1}^K T_k(x_k | x_{k-1})
$$
[@problem_id:3288068]

#### 权重构造

AIS 权重的构造旨在使得其在路径[提议分布](@entry_id:144814) $q(x_{0:K})$ 下的期望恰好等于目标比率 $Z_T/Z_0$。对于上述定义的几何路径，每个子问题 $\frac{Z_{\beta_k}}{Z_{\beta_{k-1}}}$ 可以通过在 $\pi_{\beta_{k-1}}$ 下计算期望来估计。AIS 算法将这一思想应用于生成的路径上。

在从第 $k-1$ 步过渡到第 $k$ 步时，我们计算一个增量权重。这个权重的关键在于它在路径的**哪个点**上被评估。正确的选择是在进行 MCMC 转移**之前**，即在状态 $x_{k-1}$ 处评估。因此，第 $k$ 步的增量权重为：
$$
r_k = \frac{f_{\beta_k}(x_{k-1})}{f_{\beta_{k-1}}(x_{k-1})}
$$
将这个表达式代入几何路径的定义，我们得到：
$$
r_k = \frac{f_0(x_{k-1})^{1-\beta_k} f_T(x_{k-1})^{\beta_k}}{f_0(x_{k-1})^{1-\beta_{k-1}} f_T(x_{k-1})^{\beta_{k-1}}} = \left( \frac{f_T(x_{k-1})}{f_0(x_{k-1})} \right)^{\beta_k - \beta_{k-1}}
$$
[@problem_id:3288069] [@problem_id:3288122]

整个 AIS 路径的总权重 $W$ 就是所有这些增量权重的乘积：
$$
W = \prod_{k=1}^{K} r_k = \prod_{k=1}^{K} \frac{f_{\beta_k}(x_{k-1})}{f_{\beta_{k-1}}(x_{k-1})}
$$
注意，最终的权重 $W$ 不依赖于路径的最后一个点 $x_K$。通过运行 $N$ 次独立的 AIS 过程，我们可以得到一组权重 $\{W^{(i)}\}_{i=1}^N$，其算术平均值 $\widehat{R}_{\text{AIS}} = \frac{1}{N} \sum_{i=1}^N W^{(i)}$ 就是对 $Z_T/Z_0$ 的最终估计。

**示例：高斯分布之间的[退火](@entry_id:159359)**

让我们通过一个具体的例子来阐明权重的计算过程。假设基础[分布](@entry_id:182848)的未归一化密度为 $f_0(x) = \exp(-x^2/2)$，目标分布的未归一化密度为 $f_T(x) = \exp(-(x-2)^2)$（这是一个均值为 2、[方差](@entry_id:200758)为 0.5 的[高斯分布](@entry_id:154414)的未归一化形式）。我们采用温度计划 $\beta_0=0, \beta_1=0.3, \beta_2=0.6, \beta_3=1$。假设一次运行生成的路径为 $x_0=0.5, x_1=1.2, x_2=1.8$。

增量权重比为 $\left(\frac{f_T(x)}{f_0(x)}\right)^{\Delta\beta}$，其中对数比为 $L(x) = \ln(\frac{f_T(x)}{f_0(x)}) = -\frac{x^2}{2} + 4x - 4$。
总的对数权重为：
$$
\ln W = \sum_{k=1}^3 (\beta_k - \beta_{k-1}) L(x_{k-1}) = (0.3)L(0.5) + (0.3)L(1.2) + (0.4)L(1.8)
$$
计算 $L(x)$ 的值：
$L(0.5) = -2.125$
$L(1.2) = 0.08$
$L(1.8) = 1.58$

代入后得到 $\ln W = (0.3)(-2.125) + (0.3)(0.08) + (0.4)(1.58) = 0.0185$。
因此，这次运行得到的 AIS 权重为 $W = \exp(0.0185) \approx 1.019$。 [@problem_id:3288031]

### AIS 估计器的基本性质

理解 AIS 估计器的统计性质对于正确使用和评估该方法至关重要。

#### 无偏性

AIS 估计器最引人注目的理论性质之一是其**无偏性**。对于单个 AIS 路径产生的权重 $W$，其[期望值](@entry_id:153208)精确地等于目标比率：
$$
\mathbb{E}[W] = \frac{Z_T}{Z_0}
$$
这个性质的证明依赖于一个精巧的伸缩论证，它利用了马尔可夫核 $T_k$ 对其目标分布 $\pi_{\beta_k}$ 的不变性。具体来说，当我们对路径的[联合分布](@entry_id:263960)求期望时，每一步的积分都会利用[不变性](@entry_id:140168) $\int f_{\beta_k}(x_{k-1}) T_k(x_k|x_{k-1}) dx_{k-1} = f_{\beta_k}(x_k)$，这使得权重中的因子可以逐一抵消，最终得到 $Z_T/Z_0$。[@problem_id:3288132] [@problem_id:3288042]

至关重要的是，这个无偏性**仅仅**依赖于核的[不变性](@entry_id:140168)，而与 MCMC 采样的**混合效率 (mixing efficiency)**无关。即使 MCMC 核混合得非常慢（例如，在多模态[分布](@entry_id:182848)中被困在单个模态里），只要它形式上保持了[不变性](@entry_id:140168)，AIS 估计器在理论上仍然是无偏的。这是一个强大但同时也可能产生误导的特性，我们将在后面详细讨论。[@problem_id:3288122] 此外，[不变性](@entry_id:140168)是一个比细致平衡 (detailed balance, or reversibility) 更弱的条件，后者是构造 Metropolis-Hastings 算法的常用条件，但对无偏性而言并非必需。[@problem_id:3288132]

#### [方差](@entry_id:200758)与权重简并

尽管 AIS 估计器是无偏的，但其实用价值完全取决于其[方差](@entry_id:200758)。一个无偏但[方差](@entry_id:200758)极大的估计器在实践中是无用的。正如在标准 IS 中一样，AIS 的主要挑战仍然是控制权重 $W$ 的[方差](@entry_id:200758)，避免权重简并。

为了诊断权重简并的程度，我们引入**[有效样本量](@entry_id:271661) (Effective Sample Size, ESS)** 的概念。对于一组从 $N$ 次独立 AIS 运行中获得的权重 $\{w_i\}_{i=1}^N$，ESS 定义为：
$$
\mathrm{ESS} = \frac{\left(\sum_{i=1}^N w_i\right)^2}{\sum_{i=1}^N w_i^2}
$$
这个量可以被方便地改写为 $\mathrm{ESS} = \frac{N}{1 + \mathrm{CV}^2}$，其中 $\mathrm{CV}^2$ 是权重的样本[变异系数](@entry_id:272423)的平方。ESS 的值域为 $[1, N]$。

*   当所有权重都相等时（理想情况），$\mathrm{CV}^2 = 0$，$\mathrm{ESS} = N$。
*   当权重极度简并时（例如，只有一个权重远大于其他所有权重），$\mathrm{ESS} \to 1$。

在实践中，ESS 是一个至关重要的诊断工具。如果计算出的 ESS 远小于样本数 $N$（例如，小于 $N/10$），这表明权重[方差](@entry_id:200758)过大，估计结果不可靠。这通常意味着[退火](@entry_id:159359)路径太“陡峭”，需要插入更多的中间温度来平滑过渡。[@problem_id:3288041]

#### 对[数域](@entry_id:155558)中的偏差

在许多应用中，我们更关心对数比率 $\ln(Z_T/Z_0)$。一个自然的估计器是 $\widehat{L}_{\text{AIS}} = \ln(\widehat{R}_{\text{AIS}}) = \ln(\frac{1}{N} \sum W^{(i)})$。然而，由于对数函数是[凹函数](@entry_id:274100)，根据**琴生不等式 (Jensen's inequality)**，这个估计器是**有偏**的，并且是系统性地低估真实值：
$$
\mathbb{E}[\ln(\widehat{R}_{\text{AIS}})] \le \ln(\mathbb{E}[\widehat{R}_{\text{AIS}}]) = \ln(Z_T/Z_0)
$$
这种负向偏差的大小与权重的[方差](@entry_id:200758)成正比，与样本量 $N$ 成反比。当 $N$ 很大时，偏差会减小，但在权重[方差](@entry_id:200758)很大的情况下，这种偏差可能仍然很显著。[@problem_id:3288028]

### 实践挑战与高级技术

将 AIS 从理论转化为可靠的实践工具，需要解决数值稳定性、多模态采样等一系列挑战。

#### [数值稳定性](@entry_id:146550)：对数域计算

AIS 权重是许多增量权重的连乘积。如果这些增量权重普遍小于 1，直接相乘很容易导致[浮点数](@entry_id:173316)**下溢 (underflow)**，使得最终权重错误地变为零。例如，在标准的双精度[浮点数](@entry_id:173316)表示中，任何小于约 $10^{-324}$ 的正数都会被舍入为零。如果对数权重 $S_T = \ln W_T$ 小于约 -744，其指数 $\exp(S_T)$ 就会[下溢](@entry_id:635171)。[@problem_id:3288076]

为了避免这个问题，标准做法是在**对数域 (log-domain)** 中进行所有计算。我们不存储和累乘权重 $r_k$，而是累加它们的对数 $\ell_k = \ln r_k$：
$$
S_T = \sum_{k=1}^K \ell_k = \ln W_T
$$
在获得了 $N$ 个独立的对数权重 $\{S_T^{(i)}\}_{i=1}^N$ 后，我们需要计算[算术平均值](@entry_id:165355)的对数 $\ln(\frac{1}{N} \sum \exp(S_T^{(i)}))$。直接计算[指数和](@entry_id:199860)仍然可能导致[溢出](@entry_id:172355)。这里，我们使用**log-sum-exp 技巧**来保证数值稳定性。令 $a = \max_i S_T^{(i)}$，则：
$$
\ln\left(\frac{1}{N}\sum_{i=1}^N \exp(S_T^{(i)})\right) = a + \ln\left(\frac{1}{N}\sum_{i=1}^N \exp(S_T^{(i)} - a)\right)
$$
在右侧的表达式中，指数的参数都是非正数，避免了上溢，同时通过提出[最大项](@entry_id:171771)也减少了下溢的风险。这个技巧是实现稳健 AIS 的标准组成部分。[@problem_id:3288076]

#### 核心挑战：多模态与混合效率

AIS 理论上的无偏性掩盖了其在实践中最大的挑战：处理**多模态 (multimodal)** [分布](@entry_id:182848)。当 MCMC 核的混合效率低下时，AIS 估计器的[方差](@entry_id:200758)会急剧增大。

考虑一个从单峰的[高斯分布](@entry_id:154414)退火到一个双峰高斯[混合分布](@entry_id:276506)的经典问题。在退火路径的中间，当 $\beta$ 超过某个临界值时，中间[分布](@entry_id:182848) $\pi_\beta$ 会从单峰变为双峰。如果此时我们使用的 MCMC 核是局部性的（例如，小步长的[随机游走](@entry_id:142620) Metropolis），那么一旦采样路径进入其中一个模态，它将很难“跳跃”到另一个模态。[@problem_id:3288122]

这种“模式囚禁” (mode trapping) 对 AIS 是灾难性的。尽管估计器在理论上仍然无偏，但单次运行的路径将只能探索[分布](@entry_id:182848)的一部分，导致其权重不能代表真实的归一化常数比率。在多次运行中，有些路径探索一个模态，有些探索另一个，这将导致权重[分布](@entry_id:182848)极度分散（即[方差](@entry_id:200758)极大），从而使得平均值极不稳定。这正是 ESS 诊断会发出严重警告的情况。

#### 性能提升策略

为了应对这些挑战，研究者们发展了多种策略来提升 AIS 的性能：

1.  **退火计划设计 (Schedule Design)**：增加中间温度点的数量 $K$ 通常可以降低[方差](@entry_id:200758)，因为它使得相邻[分布](@entry_id:182848)更加相似。更重要的是，温度点的[分布](@entry_id:182848)应该是不均匀的。在[分布](@entry_id:182848)形态随 $\beta$ 变化剧烈的区域（通常对应于[相变](@entry_id:147324)或模态结构出现区域），我们需要更密集的温度点来确保平滑过渡。这些区域可以通过相邻[分布](@entry_id:182848)之间的 KL 散度等指标来识别。[@problem_id:3288122]

2.  **高级 MCMC 核 (Advanced Kernels)**：对于多模态问题，局部 MCMC 移动是不足够的。我们需要能够实现全局移动的核。一种强大的技术是**[回火](@entry_id:182408)转移 (tempered transitions)**。在每个温度 $\beta_k$ 的 MCMC 更新步骤中，我们可以设计一个特殊的 Metropolis-Hastings 提议，该提议通过一个辅助的、更“热”的温度阶梯（即 $\beta'  \beta_k$）进行探索。在这些辅助的“热”系统中，模式之间的能量壁垒较低，使得采样器可以更容易地在模式间移动。然后将[辅助系统](@entry_id:142219)最终的状态提议为原始系统的下一个状态，其接受概率经过精心设计以确保对 $\pi_{\beta_k}$ 的[不变性](@entry_id:140168)。将这种高级核嵌入 AIS 框架可以显著改善混合效率，降低[方差](@entry_id:200758)，同时不破坏估计器的无偏性。[@problem_id:3288122]

### 与其他方法的联系与比较

最后，我们将 AIS 置于更广阔的计算方法领域中进行审视。

#### AIS 与[序贯蒙特卡洛](@entry_id:147384) (SMC)

AIS 可以被视为**[序贯蒙特卡洛](@entry_id:147384) (Sequential [Monte Carlo](@entry_id:144354), SMC)** 方法（也称为粒子滤波器）的一个特例。具体来说，AIS 相当于一个粒子数为 1 且没有[重采样](@entry_id:142583)步骤的 SMC 算法。这个视角有助于将 AIS 与一系列更广泛的、基于粒[子群](@entry_id:146164)的[抽样方法](@entry_id:141232)联系起来，并为理解其理论性质提供了另一个途径。[@problem_id:3288042]

#### AIS 与[热力学积分](@entry_id:156321) (TI)

**[热力学积分](@entry_id:156321) (Thermodynamic Integration, TI)** 是另一种计算对数归一化常数比率的经典方法。它基于一个精确的物理恒等式：
$$
\ln\left(\frac{Z_T}{Z_0}\right) = \int_0^1 \mathbb{E}_{\pi_\beta}\left[ \frac{\partial \ln f_\beta(X)}{\partial \beta} \right] d\beta
$$
TI 通过在离散的 $\beta$ 网格上用 MCMC 估计[期望值](@entry_id:153208)，然后用数值积分（如梯形法则）来近似该积分。

AIS 和 TI 在误差来源上有所不同：

*   **TI 的误差**：主要来自两个方面：(1) [数值积分](@entry_id:136578)引入的**积分偏差 (quadrature bias)**，这取决于被积函数的平滑程度和积分网格的密度；(2) 在每个 $\beta$ 点上 MCMC 估计[期望值](@entry_id:153208)引入的**蒙特卡洛[方差](@entry_id:200758)**。
*   **AIS 的误差**：对于比率 $Z_T/Z_0$ 的估计是无偏的，其误差完全由**权重[方差](@entry_id:200758)**决定。对于对数比率 $\ln(Z_T/Z_0)$ 的估计，则存在一个（对于大 $N$）较小的**负向偏差**和权重[方差](@entry_id:200758)。

在选择哪种方法时，通常有以下考虑：如果被积函数 $\mathbb{E}_{\pi_\beta}[\dots]$ 随 $\beta$ 变化平滑，且在每个温度下 MCMC 混合良好，TI 通常表现出色，因为其积分[偏差和方差](@entry_id:170697)都易于控制。相反，如果退火计划可以被精心设计以保持相邻[分布](@entry_id:182848)的低散度，AIS 可能是更优的选择。在面对具有“[相变](@entry_id:147324)”的复杂问题时，两种方法都会遇到困难：TI 的被积函数可能出现尖峰，导致巨大的积分偏差；而 AIS 的权重[方差](@entry_id:200758)则可能在[相变](@entry_id:147324)点附近爆炸。[@problem_id:3288028]

总之，[退火](@entry_id:159359)重要性抽样是一种原理深刻、应用广泛的强大工具。理解其从重要性抽样基本原理出发的构造、其无偏性与[方差](@entry_id:200758)的权衡、以及在数值实现和应对多模态[分布](@entry_id:182848)方面的挑战，是有效运用这一方法的关键。