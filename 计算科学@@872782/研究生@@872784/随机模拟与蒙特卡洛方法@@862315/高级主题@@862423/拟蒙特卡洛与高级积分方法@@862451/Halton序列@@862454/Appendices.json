{"hands_on_practices": [{"introduction": "虽然哈顿序列等准蒙特卡洛方法在许多应用中表现出色，但理解其局限性也至关重要。本练习 [@problem_id:3285819] 通过构建一个特例函数，揭示了哈顿序列确定性结构的潜在陷阱，即当被积函数的特征与序列点的分布“不匹配”时，会导致积分估计产生极大误差。这个思想实验旨在强调批判性思维的重要性，并提醒我们在应用任何数值方法前都需审视其基本假设。", "problem": "考虑在单位区间上使用以 $2$ 为底的 Halton 序列 (即 van der Corput 序列) 进行一维拟蒙特卡洛 (QMC) 积分。对于一个可积函数 $f:[0,1]\\to\\mathbb{R}$，具有 $N$ 个点的 QMC 估计量为\n$$\nQ_N \\;=\\; \\frac{1}{N}\\sum_{n=0}^{N-1} f\\big(h_n\\big),\n$$\n其中 $h_n$ 是通过将 $n$ 写成二进制，反转其数字，并将结果解释为一个二进制小数而得到的。取 $N=2^{10}$。\n\n定义一个光滑的凸起函数 $g:(-\\infty,\\infty)\\to\\mathbb{R}$ 如下\n$$\ng(t) \\;=\\; \\begin{cases}\n\\exp\\!\\Big(-\\dfrac{1}{t\\,(1-t)}\\Big), & \\text{if } 0 < t < 1 \\\\\n0, & \\text{otherwise}\n\\end{cases}\n$$\n令 $A = \\int_0^1 g(t)\\,\\mathrm{d}t$。定义被积函数为 $f(x) = \\frac{N}{A} g(N(1-x))$。\n\n计算绝对积分误差 $|I - Q_N|$，其中 $I=\\int_0^1 f(x)\\,\\mathrm{d}x$。", "solution": "题目要求在使用一个含 $N=2^{10}$ 个点的拟蒙特卡洛 (QMC) 方法时，对区间 $[0,1]$ 上的特定函数 $f(x)$ 计算绝对积分误差 $|I - Q_N|$。该积分为 $I=\\int_{0}^{1}f(x)\\,dx$，QMC 估计量为 $Q_N = \\frac{1}{N}\\sum_{n=0}^{N-1} f(h_n)$，其中 $\\{h_n\\}$ 是以 $2$ 为底的 Halton 序列。\n\n首先，我们必须确定 QMC 样本点集 $\\{h_n\\}_{n=0}^{N-1}$。题目说明这些是底为 $b=2$ 的 Halton 序列的前 $N=2^{10}$ 个点，也称为 van der Corput 序列。对于一个整数 $n \\in \\{0, 1, \\dots, N-1\\}$，其二进制表示可以用 10 个比特写出 (因为 $N=2^{10}$)，即 $n = \\sum_{j=0}^{9} a_j 2^j$，其中 $a_j \\in \\{0, 1\\}$。相应的 Halton 点 $h_n$ 是通过反转比特 $a_j$ 的顺序并将结果解释为一个二进制小数得到的：\n$$\nh_n = \\sum_{j=0}^{9} a_j 2^{-(j+1)}\n$$\n以 $b$ 为底的 Halton 序列的前 $N=b^m$ 个点的一个基本性质是，它们构成了一个以 $b$ 为底的 $(0,m,1)$-网。在我们的例子中，$b=2$ 且 $m=10$，这意味着点集 $\\{h_n\\}_{n=0}^{N-1}$ 正是所有分母为 $N$ 的分数的集合：\n$$\n\\{h_n\\}_{n=0}^{N-1} = \\left\\{\\frac{k}{N} \\;\\bigg|\\; k=0, 1, \\dots, N-1\\right\\}\n$$\n为了验证这一点，考虑一个任意点 $h_n$。将其乘以 $N=2^{10}$ 会得到一个整数：\n$$\nN h_n = 2^{10} \\sum_{j=0}^{9} a_j 2^{-(j+1)} = \\sum_{j=0}^{9} a_j 2^{9-j}\n$$\n令求和索引为 $k=9-j$。当 $j$ 从 $0$ 到 $9$ 取值时，$k$ 从 $9$ 到 $0$ 取值。该表达式变为 $N h_n = \\sum_{k=0}^{9} a_{9-k} 2^k$。这个整数的二进制表示是 $(a_0 a_1 \\dots a_9)_2$。原始整数 $n$ 的表示是 $(a_9 a_8 \\dots a_0)_2$。从 $n$ 到 $N h_n$ 的映射是整数集 $\\{0, 1, \\dots, N-1\\}$ 上的一个比特反转置换。由于这是一个置换，当 $n$ 遍历从 $0$ 到 $N-1$ 的所有整数时，$N h_n$ 也恰好一次地遍历从 $0$ 到 $N-1$ 的所有整数。因此，点集 $\\{h_n\\}$ 确实是 $\\{k/N\\}_{k=0}^{N-1}$。\n\n接下来，我们分析被积函数 $f(x) = \\frac{N}{A}\\, g(N(1-x))$。函数 $g(t)$ 仅在 $t \\in (0,1)$ 时非零。因此，$f(x)$ 仅当其自变量 $N(1-x)$ 在区间 $(0,1)$ 内时才非零。这导致了以下不等式：\n$$\n0 < N(1-x) < 1\n$$\n左边的不等式 $0 < N(1-x)$ 意味着 $0 < 1-x$，即 $x < 1$。\n右边的不等式 $N(1-x) < 1$ 意味着 $1-x < \\frac{1}{N}$，即 $x > 1 - \\frac{1}{N}$。\n因此，$f(x)$ 的支集是开区间 $\\left(1-\\frac{1}{N}, 1\\right)$。对于此区间外的任何 $x$，都有 $f(x)=0$。\n\n现在我们可以计算 QMC 估计量 $Q_N$：\n$$\nQ_N = \\frac{1}{N}\\sum_{n=0}^{N-1} f(h_n)\n$$\n我们必须在每个 QMC 点 $h_n = k/N$（其中 $k \\in \\{0, 1, \\dots, N-1\\}$）处计算 $f(x)$ 的值。为了使 $f(h_n)$ 可能非零，点 $h_n$ 必须位于 $f(x)$ 的支集内。我们必须检查是否有任何点 $k/N$ 落入区间 $\\left(1-\\frac{1}{N}, 1\\right)$：\n$$\n1-\\frac{1}{N} < \\frac{k}{N} < 1\n$$\n将不等式的所有部分乘以 $N$（一个正数），得到：\n$$\nN-1 < k < N\n$$\n由于 $k$ 必须是整数，没有整数 $k$ 满足这个严格不等式。这意味着没有任何 QMC 样本点 $h_n$ 落入 $f(x)$ 非零的开区间。所有点 $h_n$ 都小于或等于支集的左边界 $1-\\frac{1}{N}$。具体来说，最大的点是当 $k=N-1$ 时，即 $h_n = \\frac{N-1}{N} = 1-\\frac{1}{N}$。\n在这个边界点上，$g$ 的自变量是 $t = N(1-x) = N\\left(1 - \\left(1-\\frac{1}{N}\\right)\\right) = N\\left(\\frac{1}{N}\\right) = 1$。$g(t)$ 的定义指明它仅在 $0<t<1$ 时非零，在边界处为 $0$。因此，对于所有的 QMC 点，都有 $f(h_n)=0$。\n因此，QMC 估计量为\n$$\nQ_N = \\frac{1}{N}\\sum_{n=0}^{N-1} 0 = 0\n$$\n\n接下来，我们计算精确积分 $I = \\int_0^1 f(x)\\,\\mathrm{d}x$。\n$$\nI = \\int_0^1 \\frac{N}{A} g(N(1-x)) \\,\\mathrm{d}x\n$$\n进行变量替换，令 $t = N(1-x)$。那么 $x = 1 - t/N$，以及 $\\mathrm{d}x = -\\frac{1}{N}\\mathrm{d}t$。\n当 $x=0$ 时，$t=N$。当 $x=1$ 时，$t=0$。\n$$\nI = \\frac{N}{A} \\int_N^0 g(t) \\left(-\\frac{1}{N}\\right)\\,\\mathrm{d}t = \\frac{N}{A} \\frac{1}{N} \\int_0^N g(t)\\,\\mathrm{d}t = \\frac{1}{A} \\int_0^N g(t)\\,\\mathrm{d}t\n$$\n由于 $g(t)$ 仅在 $(0,1)$ 上非零，积分的上限可以从 $N$ 降为 $1$：\n$$\nI = \\frac{1}{A} \\int_0^1 g(t)\\,\\mathrm{d}t\n$$\n根据 $A$ 的定义，$A = \\int_0^1 g(t)\\,\\mathrm{d}t$，我们得到\n$$\nI = \\frac{1}{A} \\cdot A = 1\n$$\n\n最后，计算绝对积分误差：\n$$\n|I - Q_N| = |1 - 0| = 1\n$$\n这个结果说明，尽管 QMC 通常很有效，但可以构造一个光滑的被积函数，使得基于 Halton 序列的 QMC 估计量产生最大可能的误差。这是因为函数的“特征”（在这种情况下是其支集）与样本点的确定性结构“不协调”。", "answer": "$$\\boxed{1}$$", "id": "3285819"}, {"introduction": "在了解了哈顿序列的潜在失效模式后，我们现在转向其核心优势——卓越的均匀性。本练习 [@problem_id:3310926] 要求您生成一个三维哈顿序列的初始点集，并量化其二维投影在单位正方形内的分布均匀度。通过计算卡方统计量，您将亲手验证低差异序列如何有效地填充空间，这为它们在高维积分中的优越性能提供了直观的解释。", "problem": "考虑由根基倒置构造法定义的，以 $(2,3,5)$ 为基的 $3$ 维 Halton 序列。对于每个整数 $n \\geq 1$，将 $n$ 写成以 $b$ 为基的形式 $n=\\sum_{k=0}^{K} a_k b^k$，其中数字 $a_k \\in \\{0,1,\\dots,b-1\\}$，并定义根基倒置函数 $\\phi_b(n)=\\sum_{k=0}^{K} a_k b^{-(k+1)}$。$3$ 维 Halton 序列的第 $n$ 个点是 $H_n = \\big(\\phi_2(n),\\phi_3(n),\\phi_5(n)\\big)$。\n\n令 $N=16$ 且 $m=4$。对于前 $N$ 个点 $\\{H_n\\}_{n=1}^{N}$ 的三个二维坐标投影 $(x,y)$、$(x,z)$ 和 $(y,z)$ 中的每一个，使用沿每个轴的区间 $[k/m,(k+1)/m)$（其中 $k \\in \\{0,1,2,3\\}$）将单位正方形 $[0,1)^2$ 划分为一个 $m \\times m$ 的轴对齐的全等单元格网格。令 $C_{ij}^{(\\pi)}$ 表示对于投影 $\\pi \\in \\{xy,xz,yz\\}$，落在单元格 $(i,j)$ 中的投影点的数量，并令均匀分布下的期望数量为 $E = N/m^2$。\n\n将投影 $\\pi$ 的 Pearson 卡方统计量定义为\n$$\n\\chi^2_{\\pi} \\;=\\; \\sum_{i=0}^{m-1}\\sum_{j=0}^{m-1} \\frac{\\big(C_{ij}^{(\\pi)} - E\\big)^2}{E}.\n$$\n将聚合均匀度得分定义为所有投影的总和，\n$$\nS \\;=\\; \\chi^2_{xy} + \\chi^2_{xz} + \\chi^2_{yz}.\n$$\n\n对于基为 $(2,3,5)$ 的 Halton 序列的前 $N=16$ 个点，精确计算 $S$。您的最终答案必须是一个无单位的实数。无需四舍五入。", "solution": "用户需要计算一个 $3$ 维 Halton 序列的前 $16$ 个点的聚合均匀度得分 $S$。\n\n### 步骤 1：问题验证\n问题陈述提供了一个完全指定、自成体系的数学任务。所有术语，如 Halton 序列、根基倒置函数和 Pearson 卡方统计量，都得到了正式定义。给定的参数为 $N=16$ 个点，基为 $(2,3,5)$，网格大小为 $m=4$。任务是基于这些定义计算一个单一的数值。\n该问题在 quasi-Monte Carlo 方法和统计学领域有科学依据。它适定、客观，且不包含矛盾或歧义。因此，该问题被认为是有效的。\n\n### 步骤 2：常数和公式的计算\n点的总数是 $N=16$。\n网格是一个 $m \\times m$ 的网格，其中 $m=4$。\n在均匀分布下，每个单元格的期望点数为 $E = \\frac{N}{m^2} = \\frac{16}{4^2} = \\frac{16}{16} = 1$。\n投影 $\\pi$ 的 Pearson 卡方统计量简化为：\n$$\n\\chi^2_{\\pi} = \\sum_{i=0}^{m-1}\\sum_{j=0}^{m-1} \\frac{\\big(C_{ij}^{(\\pi)} - E\\big)^2}{E} = \\sum_{i=0}^{3}\\sum_{j=0}^{3} \\frac{\\big(C_{ij}^{(\\pi)} - 1\\big)^2}{1} = \\sum_{i=0}^{3}\\sum_{j=0}^{3} \\big(C_{ij}^{(\\pi)} - 1\\big)^2\n$$\n聚合均匀度得分是 $S = \\chi^2_{xy} + \\chi^2_{xz} + \\chi^2_{yz}$。\n\n### 步骤 3：生成 Halton 序列点并进行分箱\n我们需要生成 Halton 序列的前 $N=16$ 个点，$H_n = (\\phi_2(n), \\phi_3(n), \\phi_5(n))$，其中 $n=1, \\dots, 16$。然后将坐标分配到网格单元格中。如果 $i = \\lfloor 4u \\rfloor$ 且 $j = \\lfloor 4v \\rfloor$，则一个点 $(u,v)$ 落在 $4 \\times 4$ 网格的单元格 $(i,j)$ 中。我们为每个点 $H_n = (x_n, y_n, z_n)$ 计算整数单元格索引 $(i_n, j_n, k_n)$，其中 $i_n = \\lfloor 4x_n \\rfloor$，$j_n = \\lfloor 4y_n \\rfloor$，$k_n = \\lfloor 4z_n \\rfloor$。\n\n下表总结了 $n=1, \\dots, 16$ 时各点的坐标及其对应的单元格索引。\n\n| $n$ | $x_n = \\phi_2(n)$ | $y_n = \\phi_3(n)$ | $z_n = \\phi_5(n)$ | $i_n = \\lfloor 4x_n \\rfloor$ | $j_n = \\lfloor 4y_n \\rfloor$ | $k_n = \\lfloor 4z_n \\rfloor$ |\n|-----|:-----------------:|:-----------------:|:-----------------:|:----------------------------:|:----------------------------:|:----------------------------:|\n| 1   | $1/2$             | $1/3$             | $1/5$             | $2$                          | $1$                          | $0$                          |\n| 2   | $1/4$             | $2/3$             | $2/5$             | $1$                          | $2$                          | $1$                          |\n| 3   | $3/4$             | $1/9$             | $3/5$             | $3$                          | $0$                          | $2$                          |\n| 4   | $1/8$             | $4/9$             | $4/5$             | $0$                          | $1$                          | $3$                          |\n| 5   | $5/8$             | $7/9$             | $1/25$            | $2$                          | $3$                          | $0$                          |\n| 6   | $3/8$             | $2/9$             | $6/25$            | $1$                          | $0$                          | $0$                          |\n| 7   | $7/8$             | $5/9$             | $11/25$           | $3$                          | $2$                          | $1$                          |\n| 8   | $1/16$            | $8/9$             | $16/25$           | $0$                          | $3$                          | $2$                          |\n| 9   | $9/16$            | $1/27$            | $21/25$           | $2$                          | $0$                          | $3$                          |\n| 10  | $5/16$            | $10/27$           | $2/25$            | $1$                          | $1$                          | $0$                          |\n| 11  | $13/16$           | $19/27$           | $7/25$            | $3$                          | $2$                          | $1$                          |\n| 12  | $3/16$            | $4/27$            | $12/25$           | $0$                          | $0$                          | $1$                          |\n| 13  | $11/16$           | $13/27$           | $17/25$           | $2$                          | $1$                          | $2$                          |\n| 14  | $7/16$            | $22/27$           | $22/25$           | $1$                          | $3$                          | $3$                          |\n| 15  | $15/16$           | $7/27$            | $3/25$            | $3$                          | $1$                          | $0$                          |\n| 16  | $1/32$            | $16/27$           | $8/25$            | $0$                          | $2$                          | $1$                          |\n\n### 步骤 4：构建计数矩阵\n我们为每个投影 $\\pi \\in \\{xy, xz, yz\\}$ 构建 $4 \\times 4$ 的计数矩阵 $C_{ij}^{(\\pi)}$。\n\n- **投影 $\\pi=xy$**：我们对点对 $(i_n, j_n)$ 进行计数。\n行索引对应于 $i$，列索引对应于 $j$。\n$$\nC^{(xy)} = \\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & 2 & 0 & 1 \\\\\n1 & 1 & 2 & 0\n\\end{pmatrix}\n$$\n条目总和为 $12 \\times 1 + 1 \\times 2 + 1 \\times 0 + 1 \\times 1 + 1 \\times 2 + 1 \\times 0 = 16$。\n\n- **投影 $\\pi=xz$**：我们对点对 $(i_n, k_n)$ 进行计数。\n行索引对应于 $i$，列索引对应于 $k$。\n$$\nC^{(xz)} = \\begin{pmatrix}\n0 & 2 & 1 & 1 \\\\\n2 & 1 & 0 & 1 \\\\\n2 & 0 & 1 & 1 \\\\\n1 & 2 & 1 & 0\n\\end{pmatrix}\n$$\n条目总和为 $16$。\n\n- **投影 $\\pi=yz$**：我们对点对 $(j_n, k_n)$ 进行计数。\n行索引对应于 $j$，列索引对应于 $k$。\n$$\nC^{(yz)} = \\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n3 & 0 & 1 & 1 \\\\\n0 & 4 & 0 & 0 \\\\\n1 & 0 & 1 & 1\n\\end{pmatrix}\n$$\n条目总和为 $16$。\n\n### 步骤 5：计算卡方统计量\n我们使用公式 $\\chi^2_{\\pi} = \\sum_{i,j} (C_{ij}^{(\\pi)} - 1)^2$ 计算每个投影的卡方统计量。\n\n- 对于 $\\chi^2_{xy}$：\n矩阵 $C^{(xy)}$ 有 12 个等于 $1$ 的条目，2 个等于 $2$ 的条目，以及 2 个等于 $0$ 的条目。\n$$\n\\chi^2_{xy} = 12 \\times (1-1)^2 + 2 \\times (2-1)^2 + 2 \\times (0-1)^2 = 0 + 2 \\times 1 + 2 \\times 1 = 4\n$$\n\n- 对于 $\\chi^2_{xz}$：\n矩阵 $C^{(xz)}$ 有 8 个等于 $1$ 的条目，4 个等于 $2$ 的条目，以及 4 个等于 $0$ 的条目。\n$$\n\\chi^2_{xz} = 8 \\times (1-1)^2 + 4 \\times (2-1)^2 + 4 \\times (0-1)^2 = 0 + 4 \\times 1 + 4 \\times 1 = 8\n$$\n\n- 对于 $\\chi^2_{yz}$：\n矩阵 $C^{(yz)}$ 有 9 个等于 $1$ 的条目，5 个等于 $0$ 的条目，1 个等于 $3$ 的条目，以及 1 个等于 $4$ 的条目。\n$$\n\\chi^2_{yz} = 9 \\times (1-1)^2 + 5 \\times (0-1)^2 + 1 \\times (3-1)^2 + 1 \\times (4-1)^2 = 0 + 5 \\times 1 + 1 \\times 4 + 1 \\times 9 = 5+4+9=18\n$$\n\n### 步骤 6：计算聚合均匀度得分\n最后，我们将各个卡方统计量相加，得到聚合得分 $S$。\n$$\nS = \\chi^2_{xy} + \\chi^2_{xz} + \\chi^2_{yz} = 4 + 8 + 18 = 30\n$$\n$S$ 的最终计算值为 $30$。", "answer": "$$\n\\boxed{30}\n$$", "id": "3310926"}, {"introduction": "理论理解的最终目的是指导和优化实践。本练习 [@problem_id:3310947] 是一个综合性的编程任务，它将带您深入探究QMC积分中一个被称为“混叠”或“共振”的关键现象。您不仅需要从第一性原理出发识别导致积分误差的共振条件，还需设计并实现一种“反共振”基底分配策略，以主动最小化系统性误差，从而将理论洞察转化为实际的算法改进。", "problem": "要求您通过在 $d$ 维单位超立方体上对可分离三角被积函数 $f(\\mathbf{x})=\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_j\\big)$ 进行积分，来研究使用 Halton 序列的拟蒙特卡罗积分中的混叠现象。您必须仅从以下第一性原理出发来完成此任务：乘积在独立变量上的积分的定义、通过 $b$ 进制根倒数定义的 Halton 序列，以及三角积分和有限几何级数的基本性质。\n\n您的任务如下。\n\n1. 推导积分的精确值\n$$\nI=\\int_{[0,1]^d}\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_j\\big)\\,\\mathrm{d}\\mathbf{x},\n$$\n仅从以下基本依据出发：\n- 可分离乘积在独立变量上的积分分解。\n- 对于任意整数 $m$，若 $m\\neq 0$ 则 $\\int_{0}^{1}\\cos(2\\pi m x)\\,\\mathrm{d}x=0$，若 $m=0$ 则等于 $1$ 这一事实。\n您的程序必须使用此结果来计算给定向量 $\\mathbf{m}=(m_1,\\dots,m_d)$ 的精确积分值。\n\n2. 使用根倒数映射，实现具有两两互质整数基底 $\\mathbf{b}=(b_1,\\dots,b_d)$ 的 $d$ 维 Halton 序列。对于每个坐标 $j$，第 $n$ 个点的坐标是\n$$\nx_{n,j}=\\phi_{b_j}(n)=\\sum_{r=0}^{\\infty} a_r(n;b_j)\\,b_j^{-(r+1)},\n$$\n其中 $n=\\sum_{r=0}^{R} a_r(n;b_j)\\,b_j^{r}$ 是 $n$ 的 $b_j$ 进制展开，其数字 $a_r(n;b_j)\\in\\{0,1,\\dots,b_j-1\\}$ 且只有有限个非零数字。使用前 $N$ 个点 $\\{\\mathbf{x}_n\\}_{n=0}^{N-1}$ 构成拟蒙特卡罗估计量\n$$\n\\widehat{I}_N=\\frac{1}{N}\\sum_{n=0}^{N-1}\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_{n,j}\\big).\n$$\n\n3. 识别导致系统性非零样本均值的频率 $m_j$ 和基底 $b_j$ 之间的共振（混叠）。您必须仅使用以下第一性原理进行推理：\n- 以基底 $b$ 的一维 van der Corput 序列的前 $b^K$ 项按某种顺序列举了有理数网格 $\\{0,1/b^K,\\dots,(b^K-1)/b^K\\}$ 这一事实。\n- 均匀网格上复指数的有限几何级数恒等式，即\n$$\n\\frac{1}{B}\\sum_{i=0}^{B-1} \\exp\\!\\big(2\\pi \\mathrm{i}\\, m\\, i/B\\big)=\n\\begin{cases}\n1, \\text{如果 } B \\text{ 整除 } m,\\\\\n0, \\text{其他情况。}\n\\end{cases}\n$$\n使用这些原理来确定，对于给定的 $N$、$b_j$ 和 $m_j$，坐标 $j$ 的贡献是否在前 $N$ 个样本上与基底 $b_j$ 发生共振，其含义是它导致对于每个 $n\\in\\{0,\\dots,N-1\\}$ 都有 $\\cos\\!\\big(2\\pi m_j x_{n,j}\\big)=1$。您的程序必须输出一个布尔标志，当且仅当所有坐标在此标准下同时共振时，该标志为真。\n\n4. 抗共振基底分配：对于固定的频率向量 $\\mathbf{m}$ 和基底多重集 $\\{b_1,\\dots,b_d\\}$，设计一个将基底分配给维度的方案（即，跨坐标的基底排列），对于给定的 $N$，该方案能最小化共振坐标的数量。在所有最小化共振坐标数量的分配方案中，您可以任选其一。您的程序必须计算原始分配方案下和您设计的最佳抗共振分配方案下的估计量误差。\n\n您必须实现一个完整的程序，对以下测试套件执行上述任务。对于每个测试用例，使用指定的维度 $d$、基底 $\\mathbf{b}$、样本量 $N$ 和频率向量 $\\mathbf{m}$ 来运行估计量。使用任务1中推导的精确积分值作为精确值。所有角度均以弧度为单位。没有物理单位。对于浮点数，输出必须四舍五入到六位小数。\n\n测试套件：\n- 情况 A（无共振情况）：$d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(1,1)$。此情况所需输出：一个列表 $[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n- 情况 B（完全共振与抗共振设计）：$d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(1024,2187)$。此情况所需输出：一个列表 $[|\\widehat{I}_N-I|,|\\widehat{I}_N^{\\mathrm{anti}}-I|]$，其中 $\\widehat{I}_N^{\\mathrm{anti}}$ 使用您设计的最佳抗共振基底分配。\n- 情况 C（部分共振）：$d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(1024,1)$。所需输出：$[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n- 情况 D（边界条件 $N=1$）：$d=3$, $\\mathbf{b}=(2,3,5)$, $N=1$, $\\mathbf{m}=(7,11,13)$。所需输出：$[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n- 情况 E（零频率精确性）：$d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(0,0)$。所需输出：$[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含情况 A 到 E 的结果，按顺序排列，作为一个用方括号括起来的、以逗号分隔的列表，其中每个情况的结果本身也是一个如上所述格式的列表。例如：[[a1,a2,a3],[b1,b2],[c1,c2,c3],[d1,d2,d3],[e1,e2,e3]]。", "solution": "对问题陈述进行验证。\n\n### 步骤1：提取给定信息\n- **被积函数**: $f(\\mathbf{x})=\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_j\\big)$\n- **积分域**: $d$ 维单位超立方体, $[0,1]^d$。\n- **精确积分定义**: $I=\\int_{[0,1]^d}\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_j\\big)\\,\\mathrm{d}\\mathbf{x}$。\n- **积分计算的第一原理**: 假设可分离乘积在独立变量上的积分可分解。\n- **积分计算的第二原理**: 对于任意整数 $m$，若 $m=0$ 则 $\\int_{0}^{1}\\cos(2\\pi m x)\\,\\mathrm{d}x=1$，若 $m\\neq 0$ 则 $\\int_{0}^{1}\\cos(2\\pi m x)\\,\\mathrm{d}x=0$。\n- **Halton 序列定义**: 对于每个坐标 $j$，第 $n$ 个点的坐标是 $x_{n,j}=\\phi_{b_j}(n)=\\sum_{r=0}^{\\infty} a_r(n;b_j)\\,b_j^{-(r+1)}$，其中 $n=\\sum_{r=0}^{R} a_r(n;b_j)\\,b_j^{r}$ 是 $n$ 的 $b_j$ 进制展开。基底 $\\mathbf{b}=(b_1,\\dots,b_d)$ 是两两互质的整数。\n- **拟蒙特卡罗估计量**: $\\widehat{I}_N=\\frac{1}{N}\\sum_{n=0}^{N-1}\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_{n,j}\\big)$，使用前 $N$ 个点 $\\{\\mathbf{x}_n\\}_{n=0}^{N-1}$。\n- **共振分析的第一原理**: 以基底 $b$ 的一维 Halton 序列 (van der Corput 序列) 的前 $b^K$ 项按某种排列列举了有理数网格 $\\{0,1/b^K,\\dots,(b^K-1)/b^K\\}$。\n- **共振分析的第二原理**: 有限几何级数恒等式: $\\frac{1}{B}\\sum_{i=0}^{B-1} \\exp\\!\\big(2\\pi \\mathrm{i}\\, m\\, i/B\\big)$ 的值若 $B$ 整除 $m$ 则为 $1$，否则为 $0$。\n- **共振定义**: 如果对于每个 $n\\in\\{0,\\dots,N-1\\}$ 都有 $\\cos\\!\\big(2\\pi m_j x_{n,j}\\big)=1$，则坐标 $j$ 发生共振。\n- **抗共振任务**: 对于固定的 $\\mathbf{m}$ 和 $N$，找到基底 $\\mathbf{b}$ 的一个排列，以最小化共振坐标的数量。\n- **测试用例**:\n    - 情况 A: $d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(1,1)$。输出: $[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n    - 情况 B: $d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(1024,2187)$。输出: $[|\\widehat{I}_N-I|,|\\widehat{I}_N^{\\mathrm{anti}}-I|]$。\n    - 情况 C: $d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(1024,1)$。输出: $[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n    - 情况 D: $d=3$, $\\mathbf{b}=(2,3,5)$, $N=1$, $\\mathbf{m}=(7,11,13)$。输出: $[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n    - 情况 E: $d=2$, $\\mathbf{b}=(2,3)$, $N=1000$, $\\mathbf{m}=(0,0)$。输出: $[\\widehat{I}_N,|\\widehat{I}_N-I|,\\text{full\\_resonance}]$。\n- **格式化**: 浮点数四舍五入到六位小数。\n\n### 步骤2：使用提取的给定信息进行验证\n1.  **科学依据**：该问题植根于成熟的数学领域——数值分析，特别是拟蒙特卡罗 (QMC) 方法。Halton 序列、根倒数函数以及混叠（共振）分析都是标准课题。所提供的原理是正确的。\n2.  **适定性**：问题是适定的。任务定义明确，可以得出唯一或可证明是可计算的结果。对于抗共振分配，任何能达到最小共振数的排列都是可接受的，这不违反适定性。\n3.  **客观性**：语言精确、正式，不含主观性。所有术语要么是标准的，要么有明确定义。\n4.  **自洽且一致**：问题提供了执行所需任务的所有必要定义、原理和数据。没有内部矛盾。\n5.  **相关性**：该问题直接且根本地关系到 Halton 序列及其在 QMC 积分中的应用，这是随机模拟和蒙特卡罗方法的核心课题。\n\n### 步骤3：结论与行动\n问题是**有效的**。这是一个结构良好的数值分析练习，要求基于第一性原理进行推导和实现。现在开始解题过程。\n\n### 推导与算法设计\n\n#### 任务1：积分的精确值\n需要计算的积分是 $I=\\int_{[0,1]^d}\\prod_{j=1}^{d}\\cos\\!\\big(2\\pi m_j x_j\\big)\\,\\mathrm{d}\\mathbf{x}$。被积函数 $f(\\mathbf{x}) = \\prod_{j=1}^{d} f_j(x_j)$ 其中 $f_j(x_j) = \\cos(2\\pi m_j x_j)$ 是变量 $x_1, \\dots, x_d$ 的一个可分离函数。对于此类函数，根据 Fubini 定理，超立方体 $[0,1]^d$ 上的积分可分解为一维积分的乘积：\n$$\nI = \\prod_{j=1}^{d} \\int_{0}^{1} \\cos(2\\pi m_j x_j) \\, \\mathrm{d}x_j\n$$\n问题给出了对于整数频率 $m$ 的一维积分值：\n$$\n\\int_{0}^{1} \\cos(2\\pi m x) \\, \\mathrm{d}x = \\begin{cases} 1  \\text{若 } m=0 \\\\ 0  \\text{若 } m \\neq 0 \\end{cases}\n$$\n这个结果很容易验证：如果 $m \\neq 0$，反导数是 $\\frac{1}{2\\pi m}\\sin(2\\pi m x)$，它在积分上下限 $x=0$ 和 $x=1$ 处的值都为 $0$。如果 $m=0$，被积函数是 $\\cos(0)=1$，且 $\\int_0^1 1\\,\\mathrm{d}x = 1$。\n\n要使积分的乘积不为零，每个因子都必须不为零。第 $j$ 个因子不为零当且仅当 $m_j=0$，此时其值为 $1$。因此，当且仅当对于所有的 $j=1, \\dots, d$ 都有 $m_j=0$ 时，整个乘积 $I$ 等于 $1$。只要有一个 $m_j$ 不为零，其对应的积分就是 $0$，从而使得整个乘积 $I$ 等于 $0$。\n因此，精确积分的值为：\n$$\nI = \\begin{cases} 1  \\text{若 } \\mathbf{m} = \\mathbf{0} \\text{ (即对于所有 } j \\text{ 都有 } m_j=0) \\\\ 0  \\text{其他情况} \\end{cases}\n$$\n\n#### 任务2：Halton 序列和 QMC 估计量\nHalton 序列的基础是根倒数函数 $\\phi_b(n)$。给定一个整数 $n \\ge 0$ 和一个基底 $b \\ge 2$，我们首先找到 $n$ 的 $b$ 进制表示：$n = \\sum_{r=0}^{R} a_r b^r$。通过用 $b$ 的负幂次重新解释这个展开式，可以得到根倒数：\n$$\nx_n = \\phi_b(n) = \\sum_{r=0}^{R} a_r b^{-(r+1)}\n$$\n这个操作有效地将 $n$ 在 $b$ 进制下的数字反转，并置于小数点后。例如，在基底 $b=10$下，如果 $n=123$，那么 $\\phi_{10}(123) = 0.321$。计算该值的算法如下：\n1. 初始化 `result = 0.0` 和 `f = 1.0 / b`。\n2. 当 `n > 0` 时：\n   a. 获取最低有效位：`digit = n % b`。\n   b. 加上其贡献：`result += digit * f`。\n   c. 更新 `n`: `n //= b`。\n   d. 更新分数幂次：`f /= b`。\n3. 返回 `result`。\n\n$d$ 维 Halton 序列使用一组 $d$ 个两两互质的基底 $\\mathbf{b}=(b_1, \\dots, b_d)$。序列的第 $n$ 个点是 $\\mathbf{x}_n = (\\phi_{b_1}(n), \\phi_{b_2}(n), \\dots, \\phi_{b_d}(n))$。\n积分 $I$ 的 QMC 估计量是在前 $N$ 个 Halton 点（对于 $n=0, \\dots, N-1$）上计算的被积函数的样本均值：\n$$\n\\widehat{I}_N = \\frac{1}{N} \\sum_{n=0}^{N-1} f(\\mathbf{x}_n) = \\frac{1}{N} \\sum_{n=0}^{N-1} \\prod_{j=1}^{d} \\cos(2\\pi m_j x_{n,j})\n$$\n\n#### 任务3：共振条件\n坐标 $j$ 的共振由严格条件 $\\cos(2\\pi m_j x_{n,j}) = 1$ 对所有 $n \\in \\{0, \\dots, N-1\\}$ 定义。这成立当且仅当余弦函数的参数是 $2\\pi$ 的整数倍，这意味着 $m_j x_{n,j}$ 对所有 $n \\in \\{0, \\dots, N-1\\}$都必须是整数。\n\n我们来分析点 $x_{n,j} = \\phi_{b_j}(n)$ 的结构。根据定义，对于任意 $n$，$\\phi_{b_j}(n)$ 是一个有理数，其分母是基底 $b_j$ 的幂。我们来确定前 $N$ 个点的分母所需 $b_j$ 的最高次幂。\n一个整数 $n < N$ 在其 $b_j$ 进制展开中最多有 $K$ 位数字，其中 $K$ 是满足 $b_j^K \\ge N$ 的最小整数。对于 $N>1$，这个值是 $K=\\lceil\\log_{b_j}N\\rceil$。对于 $N=1$，我们只考虑 $n=0$，所以 $K=0$。\n根倒数 $\\phi_{b_j}(n)$ 是通过对项 $a_r b_j^{-(r+1)}$求和形成的。对于一个需要 $K$ 位数字的 $n$（即 $b_j^{K-1} \\le n < b_j^K$），得到的点 $\\phi_{b_j}(n)$ 可以写成一个分母为 $b_j^K$ 的分数。具体来说，$\\phi_{b_j}(n) = \\text{整数} / b_j^K$。\n\n要使 $m_j \\phi_{b_j}(n)$ 对所有 $n \\in \\{0, \\dots, N-1\\}$ 都是整数，$m_j$ 必须是所有这些点的分母的倍数。点集 $\\{\\phi_{b_j}(n)\\}_{n=0}^{N-1}$ 包含了一些其最简分数形式的分母高达 $b_j^K$ 的值。例如，对于 $N > b_j^{K-1}$，对应于 $n=b_j^{K-1}$ 的点是 $\\phi_{b_j}(b_j^{K-1}) = 1/b_j^K$。要使 $m_j \\cdot (1/b_j^K)$ 为整数，$m_j$ 是 $b_j^K$ 的倍数是必要条件。这个条件也是充分的，因为如果 $m_j = c \\cdot b_j^K$（其中 $c$ 为整数），那么对于任何点 $x_{n,j} = \\text{整数} / b_j^K$，乘积 $m_j x_{n,j} = c \\cdot (\\text{整数})$ 是一个整数。\n\n因此，坐标 $j$ 发生共振的条件是 $m_j$ 能被 $b_j^K$ 整除，其中对于 $N>1$，$K = \\lceil\\log_{b_j}N\\rceil$，对于 $N=1$，$K=0$。这可以表述为 $m_j \\equiv 0 \\pmod{b_j^K}$。对于 $N>1$，一个基于整数运算的寻找 $K$ 的方法是找到满足 $b_j^K \\ge N$ 的最小整数 $K$。\n\n#### 任务4：抗共振基底分配\n给定一个频率向量 $\\mathbf{m}$ 和一个基底多重集，目标是找到基底的一个排列，以最小化共振坐标对的数量。对于一个具有频率 $m_j$ 和分配的基底 $b'$ 的维度 $j$，如果满足任务3中推导的条件，就会发生共振。\n算法如下：\n1. 识别频率 $\\{m_1, \\dots, m_d\\}$ 与给定基底 $\\{b_1, \\dots, b_d\\}$ 的所有可能配对。这些对应于基底的 $d!$ 种排列。\n2. 对于基底的每一种排列，比如 $\\mathbf{b}'=(b'_{\\pi(1)}, \\dots, b'_{\\pi(d)})$，计算共振对 $(m_j, b'_{\\pi(j)})$ 的总数。\n3. 选择一个导致共振数量最小的排列。\n4. 使用这个最优基底分配计算 QMC 估计量 $\\widehat{I}_N^{\\mathrm{anti}}$。\n\n在本问题的情况下，$d$ 很小（2或3），这使得对所有排列进行穷举搜索在计算上是微不足道的。对于 $d=2$，只有两种可能性：原始分配 $(b_1, b_2)$ 和交换后的分配 $(b_2, b_1)$。我们比较每种情况下的共振数，并选择更好的一种。", "answer": "[[0.000000,0.000000,false],[1.000000,0.000000],[0.000000,0.000000,false],[1.000000,1.000000,true],[1.000000,0.000000,true]]", "id": "3310947"}]}