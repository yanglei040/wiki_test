## 引言
在[统计计算](@entry_id:637594)和机器学习领域，从复杂[概率分布](@entry_id:146404)中生成样本是一项基础而关键的任务。[拒绝采样](@entry_id:142084)（Rejection Sampling）作为一种经典且构思巧妙的[蒙特卡洛方法](@entry_id:136978)，提供了一个无需知道[归一化常数](@entry_id:752675)即可从任意[目标分布](@entry_id:634522)中进行精确采样的通用框架。尽管其原理直观，但在实际应用中，朴素的[拒绝采样](@entry_id:142084)方法常常面临效率低下的挑战，尤其是在处理高维或形态复杂的[目标分布](@entry_id:634522)时，大量的提议样本被拒绝，造成了巨大的计算资源浪费。

本文旨在系统性地解决这一知识缺口，深入剖析[拒绝采样](@entry_id:142084)的核心机制，并聚焦于通过精巧的提议分布选择、包络（envelopes）和挤压（squeezes）技术来大幅提升其[采样效率](@entry_id:754496)。通过本文的学习，读者将不仅掌握一种算法，更将理解一种强大的、可扩展的模拟思想[范式](@entry_id:161181)。

文章结构如下：第一章 **“原理与机制”** 将从第一性原理出发，严格证明[拒绝采样](@entry_id:142084)的正确性，并详细阐述包络常数、挤压函数以及自适应策略等优化效率的关键数学工具。第二章 **“应用与交叉学科联系”** 将视野拓宽至实际应用，展示这些核心原理如何在高级提议分布工程、[随机过程](@entry_id:159502)模拟、[凸优化](@entry_id:137441)以及机器学习等多个领域中发挥作用，揭示其深刻的理论联系。最后，在 **“动手实践”** 环节，读者将通过解决一系列精心设计的问题，将理论知识应用于具体挑战，如处理[数值精度](@entry_id:173145)问题和为[并行计算](@entry_id:139241)硬件优化算法，从而巩固并深化理解。

## 原理与机制

在介绍了[拒绝采样](@entry_id:142084)的基本思想之后，本章将深入探讨其核心数学原理、控制其效率的关键机制，以及一系列旨在提高其性能的高级技术。我们将从基本算法的[正确性证明](@entry_id:636428)出发，逐步引入包络常数、挤压函数、自适应方法和组合策略等概念，为在复杂场景中有效应用[拒绝采样](@entry_id:142084)奠定坚实的理论基础。

### [拒绝采样](@entry_id:142084)的核心机制与正确性

[拒绝采样](@entry_id:142084)的核心在于构建一个概率性的“接受-拒绝”准则，使得从一个易于采样的[提议分布](@entry_id:144814)中获得的样本，在经过筛选后，其统计分布恰好符合我们期望的目标分布。

让我们形式化地描述这个过程。假设我们的目标是从一个[概率密度函数](@entry_id:140610)（PDF）为 $f(x)$ 的[分布](@entry_id:182848)中抽取样本，但直接从 $f(x)$ 采样很困难。我们选择另一个易于采样的[提议分布](@entry_id:144814)，其 PDF 为 $g(x)$。该方法的一个关键前提是，我们必须找到一个常数 $M \ge 1$，使得对于定义域内所有的 $x$，都满足 **包络条件**（envelope condition）：$f(x) \le M g(x)$。函数 $M g(x)$ 称作 $f(x)$ 的 **[包络函数](@entry_id:749028)**（envelope function）。

**标准接受-拒绝算法** 的步骤如下 [@problem_id:3335735]：
1.  从[提议分布](@entry_id:144814) $g(x)$ 中抽取一个样本 $X$。
2.  从区间 $(0, 1)$ 上的[均匀分布](@entry_id:194597) $\mathrm{Unif}(0,1)$ 中抽取一个独立的样本 $U$。
3.  检验 **接受条件**（acceptance condition）：如果 $U \le \frac{f(X)}{M g(X)}$，则接受样本 $X$。否则，拒绝该样本。
4.  重复步骤 1-3，直到获得一个被接受的样本。

这个算法的正确性，即被接受的样本确实服从目标分布 $f(x)$，可以从第一性原理推导得出。令 $Y$ 代表一个被接受的样本。我们想要求出 $Y$ 的[概率密度函数](@entry_id:140610)。根据[条件概率](@entry_id:151013)的定义，对于任意[可测集](@entry_id:159173) $B$，事件“$Y$ 属于 $B$”的概率为：
$$ P(Y \in B) = P(X \in B \mid \text{接受}) = \frac{P(X \in B \text{ 且 接受})}{P(\text{接受})} $$

我们首先计算分母，即单次提议的 **无条件接受概率** $P(\text{接受})$。通过对 $X$ 的所有可[能值](@entry_id:187992)进行积分（即应用[全概率定律](@entry_id:268479)），我们可以得到：
$$ P(\text{接受}) = \int P(\text{接受} \mid X=x) g(x) \,dx $$
给定 $X=x$，接受条件变为 $U \le \frac{f(x)}{M g(x)}$。由于 $U \sim \mathrm{Unif}(0,1)$ 且独立于 $X$，这个[条件概率](@entry_id:151013)就是：
$$ P(\text{接受} \mid X=x) = P\left(U \le \frac{f(x)}{M g(x)}\right) = \frac{f(x)}{M g(x)} $$
包络条件 $f(x) \le M g(x)$ 保证了这个概率值位于 $[0, 1]$ 区间内。将其代入积分，我们得到：
$$ P(\text{接受}) = \int \left(\frac{f(x)}{M g(x)}\right) g(x) \,dx = \frac{1}{M} \int f(x) \,dx $$
如果 $f(x)$ 是一个已经归一化的 PDF，那么 $\int f(x) \,dx = 1$，此时无条件[接受概率](@entry_id:138494)恰好为 $1/M$ [@problem_id:3335741]。

接下来，我们计算分子 $P(X \in B \text{ 且 接受})$。这同样通过积分得到：
$$ P(X \in B \text{ 且 接受}) = \int_B P(\text{接受} \mid X=x) g(x) \,dx = \int_B \frac{f(x)}{M g(x)} g(x) \,dx = \frac{1}{M} \int_B f(x) \,dx $$
将分子和分母代回原式：
$$ P(Y \in B) = \frac{\frac{1}{M} \int_B f(x) \,dx}{\frac{1}{M} \int f(x) \,dx} = \frac{\int_B f(x) \,dx}{\int f(x) \,dx} $$
如果 $f(x)$ 是一个归一化的 PDF，则分母为 1，我们得到 $P(Y \in B) = \int_B f(x) \,dx$。这正是“一个[随机变量](@entry_id:195330)的 PDF 是 $f(x)$”的定义。因此，该算法是正确的。

从几何上看，这个过程可以等价地描述为：我们首先从 $g(x)$ 中抽取一个 $X$，然后在 $y$ 轴的 $[0, M g(X)]$ 区间上均匀地抽取一个点 $V$。如果这个点 $(X, V)$ 落在函数 $f(x)$ 图像的下方（即 $V \le f(x)$），我们就接受 $X$。这与标准算法是等价的，因为条件 $V \le f(x)$ 可以改写为 $\frac{V}{M g(X)} \le \frac{f(x)}{M g(X)}$。如果我们定义 $U = V / (M g(X))$，那么 $U$ 就是一个 $\mathrm{Unif}(0,1)$ 的[随机变量](@entry_id:195330)，这就回到了我们的标准接受条件 [@problem_id:3335735]。这个视角直观地展示了算法是在函数 $f(x)$ 图像下方的区域进行均匀采样。

### 效率、成本与包络常数 $M$

从上一节的推导中我们看到，对于一个归一化的目标 $f(x)$，单次提议的[接受概率](@entry_id:138494)为 $\alpha = 1/M$ [@problem_id:3335741]。这个概率直接衡量了采样器的 **效率**（efficiency）。为了使接受率尽可能高，我们必须选择尽可能小的包络常数 $M$。

满足包络条件 $f(x) \le M g(x)$ 的最小 $M$ 值，被称为 **最优包络常数**（optimal envelope constant），记为 $M^\star$，其定义为：
$$ M^\star = \sup_{x} \frac{f(x)}{g(x)} $$
任何大于等于 $M^\star$ 的 $M$ 都可以保证算法的正确性，但只有当 $M=M^\star$ 时，[采样效率](@entry_id:754496)最高 [@problem_id:3335735]。因此，选择一个好的提议分布 $g(x)$，使其“形状”尽可能地接近[目标分布](@entry_id:634522) $f(x)$，是优化[拒绝采样](@entry_id:142084)的关键。

采样过程的计算成本不仅与单次接受概率有关。更实际的度量是获得一个有效样本所需的提议次数。设[随机变量](@entry_id:195330) $N$ 为获得第一个接受样本所需的提议次数。由于每次提议都是一次独立的[伯努利试验](@entry_id:268355)，成功概率为 $p = 1/M$，所以 $N$ 服从成功概率为 $p$ 的[几何分布](@entry_id:154371)，其[概率质量函数](@entry_id:265484)为 $P(N=k) = (1-p)^{k-1}p$，$k=1, 2, \dots$。

根据几何分布的性质，获得一个接受样本所需的 **平均提议次数** 为：
$$ E[N] = \frac{1}{p} = M $$
这个次数的 **[方差](@entry_id:200758)** 为：
$$ \text{Var}(N) = \frac{1-p}{p^2} = \frac{1-1/M}{(1/M)^2} = M(M-1) $$
这些结果量化了我们的直觉：$M$ 越大，[采样效率](@entry_id:754496)越低，平均需要等待更长的时间才能获得一个样本，并且等待时间的不确定性也越大 [@problem_id:3335772]。

### 未归一化密度与常数估计

在许多实际应用中，我们可能只知道目标密度的未归一化形式 $\tilde{f}(x)$，即 $f(x) = \tilde{f}(x) / Z$，其中[归一化常数](@entry_id:752675) $Z = \int \tilde{f}(x) \,dx$ 是未知的。[拒绝采样](@entry_id:142084)的一个强大之处在于，它在这种情况下依然适用。

我们只需找到一个常数 $M$ 使得 $\tilde{f}(x) \le M g(x)$。接受条件变为 $U \le \frac{\tilde{f}(X)}{M g(X)}$。此时，无条件接受概率变为：
$$ \alpha = \int \frac{\tilde{f}(x)}{M g(x)} g(x) \,dx = \frac{1}{M} \int \tilde{f}(x) \,dx = \frac{Z}{M} $$
由于接受样本的密度正比于 $\frac{\tilde{f}(x)}{M g(x)} g(x) = \frac{\tilde{f}(x)}{M}$，它仍然正比于 $\tilde{f}(x)$，因此被接受的样本仍然正确地来自[目标分布](@entry_id:634522) $f(x)$。

更有趣的是，这个过程为我们提供了一种估计未知归一化常数 $Z$ 的蒙特卡洛方法。如果我们进行了 $N$ 次提议，其中有 $A$ 次被接受，那么接受频率 $A/N$ 是对真实[接受概率](@entry_id:138494) $\alpha = Z/M$ 的一个估计。这启发我们构造 $Z$ 的估计量 $\hat{Z}$：
$$ \hat{Z} = M \frac{A}{N} $$
我们可以分析这个估计量的统计性质。由于 $A$ 服从[二项分布](@entry_id:141181) $\text{Binomial}(N, \alpha)$，其期望 $E[A] = N\alpha = N(Z/M)$。因此，$\hat{Z}$ 的期望为：
$$ E[\hat{Z}] = E\left[M \frac{A}{N}\right] = \frac{M}{N} E[A] = \frac{M}{N} \left(N \frac{Z}{M}\right) = Z $$
这表明 $\hat{Z}$ 是 $Z$ 的一个 **[无偏估计量](@entry_id:756290)**。其[方差](@entry_id:200758)为：
$$ \text{Var}(\hat{Z}) = \text{Var}\left(M \frac{A}{N}\right) = \frac{M^2}{N^2} \text{Var}(A) = \frac{M^2}{N^2} [N \alpha (1-\alpha)] = \frac{M^2}{N} \frac{Z}{M} \left(1 - \frac{Z}{M}\right) = \frac{MZ - Z^2}{N} $$
这个结果表明，通过[拒绝采样](@entry_id:142084)，我们不仅可以从一个未归一化的密度中采样，还能同时得到其归一化常数的[无偏估计](@entry_id:756289) [@problem_id:3335793]。

### 挤压技术：降低计算成本

在许多问题中，评估目标密度 $f(x)$（或 $\tilde{f}(x)$）本身可能是计算密集型的。如果我们能避免在每次提议时都进行这个昂贵的评估，就可以显著提高算法的整体速度。**挤压技术**（squeeze technique）正是为此而设计的。

该技术引入了一个 **挤压函数**（squeeze function）$s(x)$，它必须满足 $0 \le s(x) \le f(x)$ 对所有 $x$ 成立，并且 $s(x)$ 的评估成本远低于 $f(x)$。

带有挤压的[拒绝采样算法](@entry_id:260966)修改如下 [@problem_id:3335788]：
1.  从 $g(x)$ 抽取 $X$，从 $\mathrm{Unif}(0,1)$ 抽取 $U$。
2.  **廉价接受测试**：如果 $U \le \frac{s(X)}{M g(X)}$，则 **立即接受** $X$，无需评估 $f(X)$。
3.  **昂贵接受测试**：如果步骤 2 未通过（即 $U > \frac{s(X)}{M g(X)}$），则评估 $f(X)$。如果 $U \le \frac{f(X)}{M g(X)}$，则接受 $X$。
4.  否则，拒绝 $X$。

这个修改是否会改变最终样本的[分布](@entry_id:182848)？答案是不会。让我们分析总的接受事件。一个样本被接受，当且仅当 `(U ≤ s(X)/Mg(X))` **或者** `(U > s(X)/Mg(X) 并且 U ≤ f(X)/Mg(X))`。由于 $s(x) \le f(x)$，所以 $\frac{s(x)}{M g(x)} \le \frac{f(x)}{M g(x)}$。这两个条件的并集等价于单个条件 $U \le \frac{f(X)}{M g(X)}$。这意味着，总的接受区域与标准[拒绝采样](@entry_id:142084)完全相同，因此算法的正确性得到了保持 [@problem_id:3335735]。

挤压技术的优势在于效率。在一次试验中，避免评估 $f(X)$ 的概率等于廉价接受测试通过的概率，即：
$$ P\left(U \le \frac{s(X)}{M g(X)}\right) = \int \frac{s(x)}{M g(x)} g(x) \,dx = \frac{1}{M} \int s(x) \,dx $$
只要我们能找到一个非平凡的（即积分不为零的）挤压函数 $s(x)$，就能以一定的概率节省 $f(x)$ 的评估成本。挤压函数 $s(x)$ 越接近 $f(x)$，这种节省就越显著。

一个常见的构造挤压函数的方法是利用函数的凸性。例如，如果 $\log f(x)$ 是一个[凹函数](@entry_id:274100)（即 $f(x)$ 是对数凹的），我们可以通过 $\log f(x)$ 的任意全局仿射下界 $h(x)$ (即 $h(x) \le \log f(x)$) 来构造一个有效的挤压函数 $s(x) = \exp(h(x))$，因为指数化保持了不等关系 [@problem_id:3335788]。

### 高级包络与提议策略

为了进一步提升效率，我们可以设计更复杂的提议和包络结构，而不是依赖于单一、全局的[提议分布](@entry_id:144814) $g(x)$ 和包络常数 $M$。

#### 分区[拒绝采样](@entry_id:142084)

一种有效的策略是将定义域 $\mathcal{X}$ 划分为多个不相交的区域 $\{A_i\}_{i=1}^K$，并在每个区域 $A_i$ 内使用一个局部的、更紧致的包络。具体来说，我们为每个区域定义一个局部包络常数：
$$ M_i = \sup_{x \in A_i} \frac{f(x)}{g(x)} $$
显然，$M_i$ 通常会远小于全局的 $M^\star$。那么，如何设计一个正确的采样算法来利用这些 $M_i$ 呢？

一个直接的想法是，先从全局提议 $g(x)$ 中采样一个 $X$，然后根据 $X$ 所在的区域 $A_i$ 使用对应的 $M_i$ 进行接受测试，即[接受概率](@entry_id:138494)为 $f(X)/M_i$。然而，这种方法是 **错误** 的，因为它产生的样本密度将正比于 $f(x)/M_i$，而 $M_i$ 是随区域变化的，导致最终[分布](@entry_id:182848)被扭曲。

正确的 **分区[拒绝采样](@entry_id:142084)**（regional rejection sampling）或称 **分层[拒绝采样](@entry_id:142084)**（stratified rejection sampling）算法是一个两阶段过程 [@problem_id:3335746]：
1.  **选择区域**：以正比于 $M_i \int_{A_i} g(x) dx$ 的概率选择一个区域索引 $I=i$。
2.  **在区域内提议**：从限制在区域 $A_I$ 内的提议分布（即密度为 $g(x) / \int_{A_I} g(y) dy$）中抽取一个样本 $X$。
3.  **接受/拒绝**：以概率 $f(X) / (M_I g(X))$ 接受 $X$。

我们可以证明这种方法是正确的。对于位于区域 $A_i$ 中的任意点 $x$，其总的提议密度为（选择区域 $i$ 的概率乘以在该区域内提议 $x$ 的条件密度）：
$$ g_{\text{prop}}(x) = \left( \frac{M_i \int_{A_i} g(y) dy}{\sum_j M_j \int_{A_j} g(y) dy} \right) \left( \frac{g(x)}{\int_{A_i} g(y) dy} \right) = \frac{M_i g(x)}{\sum_j M_j \int_{A_j} g(y) dy} $$
接受 $x$ 的未归一化密度是 $g_{\text{prop}}(x)$ 乘以[接受概率](@entry_id:138494) $p(x) = f(x)/(M_i g(x))$:
$$ g_{\text{prop}}(x) p(x) = \left( \frac{M_i g(x)}{C} \right) \left( \frac{f(x)}{M_i g(x)} \right) = \frac{f(x)}{C} $$
其中 $C = \sum_j M_j \int_{A_j} g(y) dy$ 是一个与 $x$ 无关的常数。由于未归一化密度处处正比于 $f(x)$，该算法是正确的。其总接受概率为 $1/C$。

这种方法的优势在于，$\sum_i M_i \int_{A_i} g(x) dx$ 通常小于全局的 $M \int g(x) dx = M$。对于[连续函数](@entry_id:137361) $f(x)$，当分区越来越精细时，该总和将收敛到 $\int f(x) dx = 1$，从而使接受率趋向于 1 [@problem_id:3335746]。

#### 组合[拒绝采样](@entry_id:142084)

另一种强大的[范式](@entry_id:161181)是 **组合[拒绝采样](@entry_id:142084)**（compositional rejection sampling），它适用于目标、包络和挤压函数本身可以被分解为多个组件之和的情况。假设：
$$ f(x) = \sum_i f_i(x), \quad u(x) = \sum_i U_i(x), \quad s(x) = \sum_i S_i(x) $$
其中，对每个组件 $i$ 都满足 $s_i(x) \le f_i(x) \le U_i(x)$。通常，$U_i(x)$ 和 $S_i(x)$ 与某个简单的提议组件 $g_i(x)$ 成比例，例如 $U_i(x) = M_i g_i(x)$。

在这种设定下，一个自然且正确的采样方式是将[提议分布](@entry_id:144814)视为由总包络 $u(x)$ 加权的[混合分布](@entry_id:276506)，其密度为 $p_u(x) = u(x) / \int u(t) dt$。然后，以概率 $f(X)/u(X)$ 接受提议的样本 $X$。总接受概率为：
$$ P(\text{接受}) = \frac{\int f(x) dx}{\int u(x) dx} = \frac{\sum_i \int f_i(x) dx}{\sum_i \int U_i(x) dx} $$
同样，可以引入挤压函数 $s(x)$ 以提高效率。廉价接受的概率为 [@problem_id:3335748]：
$$ P(\text{廉价接受}) = \frac{\int s(x) dx}{\int u(x) dx} = \frac{\sum_i \int S_i(x) dx}{\sum_i \int U_i(x) dx} $$
这种组合方法在处理由多个模态或复杂部分组成的目标分布时特别有用。

#### [自适应拒绝采样](@entry_id:746261) (ARS)

对于一类重要的 **对数[凹函数](@entry_id:274100)**（log-concave functions），即其对数 $\log f(x)$ 是[凹函数](@entry_id:274100)的密度函数，我们可以使用一种更智能的方法，即 **[自适应拒绝采样](@entry_id:746261)**（Adaptive Rejection Sampling, ARS）。

ARS 的核心思想是，它会“学习”[目标函数](@entry_id:267263)的形状，并随着采样的进行动态地更新和改进[包络函数](@entry_id:749028)（以及挤压函数）。具体来说，ARS 维护一个点集（abscissae），在这些点上评估 $\log f(x)$ 及其导数。
-   **[包络函数](@entry_id:749028) $u(x)$** 是通过在这些点上构造 $\log f(x)$ 的[切线](@entry_id:268870)，然后取这些[切线](@entry_id:268870)的指数化结果的逐点最小值来构建的。由于 $\log f(x)$ 是凹的，[切线](@entry_id:268870)总是在函数图像的上方，因此 $u(x)$ 确实是 $f(x)$ 的一个包络。
-   **挤压函数 $s(x)$** 是通过连接相邻点形成弦，并取这些弦的指数化结果来构建的。由于[凹性](@entry_id:139843)，弦总是在函数图像的下方，因此 $s(x)$ 是一个有效的挤压函数。

ARS 的“自适应”特性体现在其更新规则上：每当一个提议的样本 $x^*$ 被 **拒绝** 时，该点 $x^*$ 就会被添加到点集中。然后，[包络函数](@entry_id:749028)和挤压函数会利用这个新信息进行更新。

这个[更新过程](@entry_id:273573)会严格提高[采样效率](@entry_id:754496)。因为当一个新的点 $x^*$ 被加入时，新的包络 $u_{k+1}(x)$ 是在旧包络 $u_k(x)$ 和一条过点 $(x^*, f(x^*))$ 的新[切线](@entry_id:268870)之间取最小值。由于 $u_k(x^*) > f(x^*)$（严格[凹函数](@entry_id:274100)的性质），新包络在 $x^*$ 及其邻域内会严格小于旧包络，而在其他地方则小于等于旧包络。这意味着包络下方的总面积 $\int u_{k+1}(x) dx  \int u_k(x) dx$。由于接受概率为 $\int f(x) dx / \int u(x) dx$，分母的减小导致[接受概率](@entry_id:138494) **严格增加** [@problem_id:3335751]。因此，ARS 采样器会随着时间的推移变得越来越高效。

### 理论视角与实践考量

#### 信息论视角：Rényi 散度

选择一个好的[提议分布](@entry_id:144814) $g(x)$ 是决定[拒绝采样](@entry_id:142084)效率的核心。信息论为我们提供了衡量两个[分布](@entry_id:182848)之间“差异”的工具，这可以指导我们进行选择。具体来说，接受率与 **Rényi 散度**（Rényi divergence）密切相关。

对于 $\alpha > 1$， $f$ 相对于 $g$ 的 $\alpha$-阶 Rényi 散度定义为：
$$ D_{\alpha}(f\|g) = \frac{1}{\alpha-1} \ln\left(\int f(x)^{\alpha} g(x)^{1-\alpha} \,dx\right) $$
我们可以证明，接受率 $\alpha(g) = 1/M^\star$ 满足一个重要的不等式：
$$ \alpha(g) \le \exp(-D_{\alpha}(f\|g)) $$
更有力的是，在极限情况下 $\alpha \to \infty$，Rényi 散度收敛到对数[上确界](@entry_id:140512)散度 $D_{\infty}(f\|g) = \ln(\sup_x f(x)/g(x))$。这给出了一个精确的关系：
$$ \alpha(g) = \exp(-D_{\infty}(f\|g)) $$
这个关系告诉我们，最大化接受率等价于最小化 $f$ 和 $g$ 之间的无穷阶 Rényi 散度。这为在某个[参数化](@entry_id:272587)的[提议分布](@entry_id:144814)族中选择最佳[分布](@entry_id:182848)提供了一个理论框架 [@problem_id:3335759]。

#### 实践考量：包络常数的近似

在许多实际问题中，解析地计算最优包络常数 $M^\star = \sup_x f(x)/g(x)$ 是不可行的。一个常见的替代方法是在一个离散的网格上计算 $f(x)/g(x)$ 的值，并取其最大值作为 $M^\star$ 的近似。

然而，这种近似 $\widehat{M}_{\text{grid}}$ 可能小于真正的 $M^\star$，导致包络条件 $f(x) \le \widehat{M}_{\text{grid}} g(x)$ 在某些点上不成立，从而破坏算法的正确性。为了修正这一点，我们可以利用函数 $r(x)=f(x)/g(x)$ 的平滑性信息。例如，如果我们知道 $r(x)$ 的导数的[上界](@entry_id:274738)，即它的 **[利普希茨常数](@entry_id:146583)** $L = \sup_x |r'(x)|$，那么我们可以保证在任意网格点 $x_k$ 和其邻近点 $x$ 之间，函数值的差异 $|r(x)-r(x_k)|$ 不会太大。

一个确保包络条件成立的安全做法是，使用一个修正后的包络常数 $\widehat{M}$，它在网格最大值的基础上增加一个“安全边际”。例如，对于间距为 $h$ 的均匀网格，可以证明 $\widehat{M} = \widehat{M}_{\text{grid}} + Lh/2$ 是一个有效的（即大于等于 $M^\star$）包络常数。

使用这个近似的包络常数 $\widehat{M}$ 会导致效率的损失，因为 $\widehat{M} \ge M^\star$。我们可以量化这种损失。[接受概率](@entry_id:138494)变为 $\alpha(h) = 1/\widehat{M}$。我们可以为其推导一个下界，以评估在给定网格精度 $h$ 下的最差性能。这个下界通常依赖于真实的 $M^\star$、$L$ 和 $h$，例如形式为 $\alpha(h) \ge 1/(M^\star + Lh/2)$ [@problem_id:3335754]。这为在计算成本（更精细的网格）和[采样效率](@entry_id:754496)（更低的 $\widehat{M}$）之间进行权衡提供了理论依据。