{"hands_on_practices": [{"introduction": "在任何实际的宇宙学观测中，我们都只能观测到部分天区，而非整个天空。这项练习将深入探讨这一局限性如何从根本上影响我们测量的精度。我们将推导交叉功率谱方差的“Knox公式” ([@problem_id:3469920])，这是一个基石性的结果，它量化了部分天区巡天中的统计不确定性（包括宇宙方差和噪声），并揭示了两个巡天足迹之间的重叠区域是如何成为一个关键参数的。", "problem": "考虑定义在天球上的两个统计各向同性、零均值的高斯标量宇宙学场 $X(\\hat{\\boldsymbol{n}})$ 和 $Y(\\hat{\\boldsymbol{n}})$，其中 $\\hat{\\boldsymbol{n}}$ 是一个单位方向。令其球谐系数为 $a_{\\ell m}^{X}$ 和 $a_{\\ell m}^{Y}$，定义为 $X(\\hat{\\boldsymbol{n}})=\\sum_{\\ell m} a_{\\ell m}^{X} Y_{\\ell m}(\\hat{\\boldsymbol{n}})$ 和 $Y(\\hat{\\boldsymbol{n}})=\\sum_{\\ell m} a_{\\ell m}^{Y} Y_{\\ell m}(\\hat{\\boldsymbol{n}})$，其中 $Y_{\\ell m}$ 是球谐函数。在全天上的系综平均两点统计量为\n$$\n\\langle a_{\\ell m}^{X} a_{\\ell' m'}^{Y*} \\rangle = \\delta_{\\ell \\ell'} \\delta_{m m'} C_{\\ell}^{XY}, \\quad\n\\langle a_{\\ell m}^{X} a_{\\ell' m'}^{X*} \\rangle = \\delta_{\\ell \\ell'} \\delta_{m m'} C_{\\ell}^{XX}, \\quad\n\\langle a_{\\ell m}^{Y} a_{\\ell' m'}^{Y*} \\rangle = \\delta_{\\ell \\ell'} \\delta_{m m'} C_{\\ell}^{YY},\n$$\n其中 $C_{\\ell}^{XY}$ 是全天交叉功率谱，$C_{\\ell}^{XX}$、$C_{\\ell}^{YY}$ 是自功率谱。假设观测图分别被确定性窗函数 $W_{X}(\\hat{\\boldsymbol{n}})$ 和 $W_{Y}(\\hat{\\boldsymbol{n}})$ 所掩膜，其中 $0 \\le W_{X}, W_{Y} \\le 1$，且两者不必相同，并定义掩膜（伪）球谐系数\n$$\n\\tilde{a}_{\\ell m}^{X} = \\int \\mathrm{d}\\Omega\\, W_{X}(\\hat{\\boldsymbol{n}})\\, X(\\hat{\\boldsymbol{n}})\\, Y_{\\ell m}^{*}(\\hat{\\boldsymbol{n}}), \\quad\n\\tilde{a}_{\\ell m}^{Y} = \\int \\mathrm{d}\\Omega\\, W_{Y}(\\hat{\\boldsymbol{n}})\\, Y(\\hat{\\boldsymbol{n}})\\, Y_{\\ell m}^{*}(\\hat{\\boldsymbol{n}}),\n$$\n以及伪交叉谱估计量\n$$\n\\tilde{C}_{\\ell}^{XY} \\equiv \\frac{1}{2\\ell+1} \\sum_{m=-\\ell}^{\\ell} \\tilde{a}_{\\ell m}^{X}\\, \\tilde{a}_{\\ell m}^{Y*}.\n$$\n假设存在附加的仪器噪声或散粒噪声贡献 $n^{X}$ 和 $n^{Y}$，它们是统计各向同性、高斯的，并且在两个探针之间不相关，因此观测到的自功率谱为 $C_{\\ell}^{XX,\\mathrm{tot}} = C_{\\ell}^{XX} + N_{\\ell}^{X}$ 和 $C_{\\ell}^{YY,\\mathrm{tot}} = C_{\\ell}^{YY} + N_{\\ell}^{Y}$，且满足 $\\langle a_{\\ell m}^{X} n_{\\ell' m'}^{Y*} \\rangle = 0$ 和 $\\langle n_{\\ell m}^{X} n_{\\ell' m'}^{Y*} \\rangle = 0$。定义有效重叠天区覆盖率\n$$\nf_{\\mathrm{sky}}^{XY} \\equiv \\frac{1}{4\\pi} \\int \\mathrm{d}\\Omega\\, W_{X}(\\hat{\\boldsymbol{n}})\\, W_{Y}(\\hat{\\boldsymbol{n}}),\n$$\n对于二值掩膜，该值简化为几何重叠覆盖率。\n\n从上述统计假设和定义出发，仅使用高斯性、统计各向同性以及球谐函数的正交归一性，推导部分天区重叠如何作为对有效独立 m 模式数量的压低而进入 $\\tilde{C}_{\\ell}^{XY}$ 的协方差。然后，考虑通过模式耦合矩阵 $M_{\\ell \\ell'}^{XY}$ 对掩膜引起的模式耦合进行标准解卷积，定义一个解卷积估计量 $\\hat{C}_{\\ell}^{XY} \\equiv \\sum_{\\ell'} (M^{-1})_{\\ell \\ell'}^{XY}\\, \\tilde{C}_{\\ell'}^{XY}$，并在 $M_{\\ell \\ell'}^{XY}$ 在对角线附近足够窄的近似下，传播伪谱协方差，以获得 $\\hat{C}_{\\ell}^{XY}$ 方差的一个近似解析表达式，该表达式用 $f_{\\mathrm{sky}}^{XY}$ 和基础的全天谱表示。\n\n你的最终答案必须是 $\\mathrm{Var}\\!\\left(\\hat{C}_{\\ell}^{XY}\\right)$ 的一个单一闭式表达式，用 $\\ell$、$f_{\\mathrm{sky}}^{XY}$、$C_{\\ell}^{XX}$、$C_{\\ell}^{YY}$、$C_{\\ell}^{XY}$、$N_{\\ell}^{X}$ 和 $N_{\\ell}^{Y}$ 表示。不需要进行数值计算。如果引入任何额外的定义或中间量，请确保它们在最终表达式中被消去。最终结果表示为无单位形式。", "solution": "该问题被评估为有效，因为它代表了宇宙学数据分析中一个标准（尽管是高级的）计算，其基础是已建立的统计方法和物理模型。在指定的近似条件下，该问题是适定的，并寻求一个形式化的、客观的结果。\n\n目标是在一组简化近似下推导解卷积交叉功率谱估计量 $\\mathrm{Var}(\\hat{C}_{\\ell}^{XY})$ 的方差。推导过程分为三个主要阶段：首先，表达伪谱估计量 $\\tilde{C}_{\\ell}^{XY}$ 的协方差；其次，使用窄带近似将此协方差传播到解卷积估计量 $\\hat{C}_{\\ell}^{XY}$；第三，对窗函数的几何形状应用一个关键简化，以匹配答案所需的形式。\n\n令观测场为 $X'(\\hat{\\boldsymbol{n}}) = X(\\hat{\\boldsymbol{n}}) + n^X(\\hat{\\boldsymbol{n}})$ 和 $Y'(\\hat{\\boldsymbol{n}}) = Y(\\hat{\\boldsymbol{n}}) + n^Y(\\hat{\\boldsymbol{n}})$。总自功率谱为 $C_{\\ell}^{XX, \\mathrm{tot}} = C_{\\ell}^{XX} + N_{\\ell}^{X}$ 和 $C_{\\ell}^{YY, \\mathrm{tot}} = C_{\\ell}^{YY} + N_{\\ell}^{Y}$。由于信号和噪声在两个探针之间不相关，总交叉功率谱就是 $C_{\\ell}^{XY, \\mathrm{tot}} = C_{\\ell}^{XY}$。\n\n场 $X$、$Y$、$n^X$ 和 $n^Y$ 被假定为统计各向同性、零均值和高斯的。因此，掩膜球谐系数 $\\tilde{a}_{\\ell m}^{X}$ 和 $\\tilde{a}_{\\ell m}^{Y}$ 也是零均值的高斯随机变量。\n\n伪交叉谱估计量 $\\tilde{C}_{\\ell}^{XY}$ 的方差是协方差 $\\mathrm{Cov}(\\tilde{C}_{\\ell_1}^{XY}, \\tilde{C}_{\\ell_2}^{XY}) = \\langle \\tilde{C}_{\\ell_1}^{XY} \\tilde{C}_{\\ell_2}^{XY} \\rangle - \\langle \\tilde{C}_{\\ell_1}^{XY} \\rangle \\langle \\tilde{C}_{\\ell_2}^{XY} \\rangle$ 的一个特例。对于 $\\ell_1 = \\ell_2 = \\ell$：\n$$\n\\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) = \\left\\langle \\left( \\frac{1}{2\\ell+1} \\sum_{m} \\tilde{a}_{\\ell m}^{X} \\tilde{a}_{\\ell m}^{Y*} \\right)^2 \\right\\rangle - \\left\\langle \\frac{1}{2\\ell+1} \\sum_{m} \\tilde{a}_{\\ell m}^{X} \\tilde{a}_{\\ell m}^{Y*} \\right\\rangle^2\n$$\n$$\n\\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) = \\frac{1}{(2\\ell+1)^2} \\sum_{m_1, m_2} \\left[ \\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_1}^{Y*} \\tilde{a}_{\\ell m_2}^{X} \\tilde{a}_{\\ell m_2}^{Y*} \\rangle - \\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_1}^{Y*} \\rangle \\langle \\tilde{a}_{\\ell m_2}^{X} \\tilde{a}_{\\ell m_2}^{Y*} \\rangle \\right]\n$$\n对零均值复高斯变量应用 Wick 定理，四点函数展开为：\n$$\n\\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_1}^{Y*} \\tilde{a}_{\\ell m_2}^{X} \\tilde{a}_{\\ell m_2}^{Y*} \\rangle = \\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_1}^{Y*} \\rangle \\langle \\tilde{a}_{\\ell m_2}^{X} \\tilde{a}_{\\ell m_2}^{Y*} \\rangle + \\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_2}^{X*} \\rangle \\langle \\tilde{a}_{\\ell m_1}^{Y*} \\tilde{a}_{\\ell m_2}^{Y} \\rangle + \\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_2}^{Y*} \\rangle \\langle \\tilde{a}_{\\ell m_1}^{Y*} \\tilde{a}_{\\ell m_2}^{X} \\rangle\n$$\n假设场具有统计实性（即 $\\langle ab \\rangle = 0$），最后一项消失。第一项与方差表达式中的减去项相互抵消。因此，\n$$\n\\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) = \\frac{1}{(2\\ell+1)^2} \\sum_{m_1, m_2} \\langle \\tilde{a}_{\\ell m_1}^{X} \\tilde{a}_{\\ell m_2}^{X*} \\rangle \\langle \\tilde{a}_{\\ell m_1}^{Y*} \\tilde{a}_{\\ell m_2}^{Y} \\rangle\n$$\n伪球谐系数的协方差可以表示为：\n$$\n\\langle \\tilde{a}_{\\ell m_1}^{A} \\tilde{a}_{\\ell m_2}^{B*} \\rangle = \\iint d\\Omega_1 d\\Omega_2 W_A(\\hat{\\boldsymbol{n}}_1) W_B(\\hat{\\boldsymbol{n}}_2) \\langle A'(\\hat{\\boldsymbol{n}}_1) B'(\\hat{\\boldsymbol{n}}_2)^* \\rangle Y_{\\ell m_1}^*(\\hat{\\boldsymbol{n}}_1) Y_{\\ell m_2}(\\hat{\\boldsymbol{n}}_2)\n$$\n使用两点相关函数 $\\langle A'(\\hat{\\boldsymbol{n}}_1) B'(\\hat{\\boldsymbol{n}}_2)^* \\rangle = \\sum_{\\ell'} \\frac{2\\ell'+1}{4\\pi} C_{\\ell'}^{AB,\\mathrm{tot}} P_{\\ell'}(\\hat{\\boldsymbol{n}}_1 \\cdot \\hat{\\boldsymbol{n}}_2)$，我们可以写出：\n$$\n\\langle \\tilde{a}_{\\ell m_1}^{A} \\tilde{a}_{\\ell m_2}^{B*} \\rangle = \\sum_{\\ell'} C_{\\ell'}^{AB,\\mathrm{tot}} \\iint d\\Omega_1 d\\Omega_2 W_A(\\hat{\\boldsymbol{n}}_1) W_B(\\hat{\\boldsymbol{n}}_2) \\frac{2\\ell'+1}{4\\pi} P_{\\ell'}(\\hat{\\boldsymbol{n}}_1 \\cdot \\hat{\\boldsymbol{n}}_2) Y_{\\ell m_1}^*(\\hat{\\boldsymbol{n}}_1) Y_{\\ell m_2}(\\hat{\\boldsymbol{n}}_2)\n$$\n在谱 $C_{\\ell'}^{AB,\\mathrm{tot}}$ 随 $\\ell'$ 缓变的近似下，我们可以用 $C_{\\ell}^{AB,\\mathrm{tot}}$ 替换 $C_{\\ell'}^{AB,\\mathrm{tot}}$，并使用完备性关系 $\\sum_{\\ell'} \\frac{2\\ell'+1}{4\\pi} P_{\\ell'}(\\hat{\\boldsymbol{n}}_1 \\cdot \\hat{\\boldsymbol{n}}_2) = \\delta(\\hat{\\boldsymbol{n}}_1 - \\hat{\\boldsymbol{n}}_2)$。这给出了协方差的小角度或高-$\\ell$近似：\n$$\n\\langle \\tilde{a}_{\\ell m_1}^{A} \\tilde{a}_{\\ell m_2}^{B*} \\rangle \\approx C_{\\ell}^{AB,\\mathrm{tot}} \\int d\\Omega\\, W_A(\\hat{\\boldsymbol{n}}) W_B(\\hat{\\boldsymbol{n}}) Y_{\\ell m_1}^*(\\hat{\\boldsymbol{n}}) Y_{\\ell m_2}(\\hat{\\boldsymbol{n}}) \\equiv C_{\\ell}^{AB,\\mathrm{tot}} K_{\\ell m_1, \\ell m_2}^{W_A W_B}\n$$\n这里 $K_{\\ell m_1, \\ell m_2}^{W_A W_B}$ 是乘积窗 $W_A W_B$ 的模式耦合矩阵。将此代入方差表达式中：\n$$\n\\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) \\approx \\frac{1}{(2\\ell+1)^2} \\sum_{m_1, m_2} (C_{\\ell}^{XX,\\mathrm{tot}} K_{\\ell m_1, \\ell m_2}^{W_X^2}) (C_{\\ell}^{YY,\\mathrm{tot}} K_{\\ell m_2, \\ell m_1}^{W_Y^2}) = \\frac{C_{\\ell}^{XX,\\mathrm{tot}} C_{\\ell}^{YY,\\mathrm{tot}}}{(2\\ell+1)^2} \\mathrm{Tr}( \\mathbf{K}^{W_X^2} \\mathbf{K}^{W_Y^2} )\n$$\n注意，对于实场，我们使用了 $C_{\\ell}^{YX}=(C_{\\ell}^{XY})^*=C_{\\ell}^{XY}$，方差的交叉部分变为 $\\langle \\tilde{a}^X \\tilde{a}^{Y*} \\rangle \\langle \\tilde{a}^Y \\tilde{a}^{X*} \\rangle = |\\langle \\tilde{a}^X \\tilde{a}^{Y*} \\rangle|^2$。完整的方差应包括来自 Wick 展开的自相关项和交叉项：\n$$\n\\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) \\approx \\frac{1}{(2\\ell+1)^2} \\left[ C_{\\ell}^{XX,\\mathrm{tot}} C_{\\ell}^{YY,\\mathrm{tot}} \\mathrm{Tr}(\\mathbf{K}^{W_X^2} \\mathbf{K}^{W_Y^2}) + (C_{\\ell}^{XY})^2 \\mathrm{Tr}(\\mathbf{K}^{W_X W_Y} \\mathbf{K}^{W_Y W_X}) \\right]\n$$\n耦合矩阵乘积的迹在高-$\\ell$极限下可以近似为：\n$$\n\\mathrm{Tr}(\\mathbf{K}^{W_A} \\mathbf{K}^{W_B}) = \\iint d\\Omega_1 d\\Omega_2 W_A(\\hat{\\boldsymbol{n}}_1)W_B(\\hat{\\boldsymbol{n}}_2) \\left(\\frac{2\\ell+1}{4\\pi} P_\\ell(\\hat{\\boldsymbol{n}}_1 \\cdot \\hat{\\boldsymbol{n}}_2)\\right)^2 \\approx (2\\ell+1)\\frac{\\int W_A(\\hat{\\boldsymbol{n}})W_B(\\hat{\\boldsymbol{n}}) d\\Omega}{4\\pi}\n$$\n应用此近似可得：\n$$\n\\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) \\approx \\frac{1}{2\\ell+1} \\left[ C_{\\ell}^{XX,\\mathrm{tot}} C_{\\ell}^{YY,\\mathrm{tot}} \\frac{\\int W_X^2 W_Y^2 d\\Omega}{4\\pi} + (C_{\\ell}^{XY})^2 \\frac{\\int (W_X W_Y)^2 d\\Omega}{4\\pi} \\right]\n$$\n接下来，我们将其传播到解卷积估计量 $\\hat{C}_{\\ell}^{XY} = \\sum_{\\ell'} (M^{-1})_{\\ell \\ell'}^{XY} \\tilde{C}_{\\ell'}^{XY}$。窄带近似意味着 $M_{\\ell\\ell'}^{XY}$ 是对角占优的，因此 $(M^{-1})_{\\ell\\ell'}^{XY} \\approx \\delta_{\\ell\\ell'} (M_{\\ell\\ell}^{XY})^{-1}$。伪谱的期望值为 $\\langle \\tilde{C}_\\ell^{XY} \\rangle = \\sum_{\\ell'} M_{\\ell\\ell'}^{XY} C_{\\ell'}^{XY}$。在相同的近似下，$\\langle \\tilde{C}_\\ell^{XY} \\rangle \\approx C_\\ell^{XY} \\sum_{\\ell'} M_{\\ell\\ell'}^{XY} \\approx C_\\ell^{XY} f_{\\mathrm{sky}}^{XY, \\mathrm{quad}}$，其中 $f_{\\mathrm{sky}}^{XY, \\mathrm{quad}}=\\frac{1}{4\\pi}\\int W_X W_Y d\\Omega = f_{\\mathrm{sky}}^{XY}$。因此，解卷积步骤近似为除以 $f_{\\mathrm{sky}}^{XY}$，所以 $\\hat{C}_{\\ell}^{XY} \\approx \\tilde{C}_{\\ell}^{XY} / f_{\\mathrm{sky}}^{XY}$。\n那么方差为 $\\mathrm{Var}(\\hat{C}_{\\ell}^{XY}) \\approx \\mathrm{Var}(\\tilde{C}_{\\ell}^{XY}) / (f_{\\mathrm{sky}}^{XY})^2$。\n$$\n\\mathrm{Var}(\\hat{C}_{\\ell}^{XY}) \\approx \\frac{1}{(f_{\\mathrm{sky}}^{XY})^2 (2\\ell+1)} \\left[ C_{\\ell}^{XX,\\mathrm{tot}} C_{\\ell}^{YY,\\mathrm{tot}} \\frac{\\int W_X^2 W_Y^2 d\\Omega}{4\\pi} + (C_{\\ell}^{XY})^2 \\frac{\\int (W_X W_Y)^2 d\\Omega}{4\\pi} \\right]\n$$\n这个表达式仍然包含未在最终变量要求列表中指定的积分。为了继续，我们必须做一个进一步的简化。问题文本中提到“对于二值掩膜，该值简化为几何重叠覆盖率”给出了一个提示。如果我们假设掩膜是二值的，即 $W_X, W_Y \\in \\{0, 1\\}$，那么 $W_X^2 = W_X$ 且 $W_Y^2 = W_Y$。\n这极大地简化了积分：\n$$\n\\frac{\\int W_X^2 W_Y^2 d\\Omega}{4\\pi} = \\frac{\\int W_X W_Y d\\Omega}{4\\pi} = f_{\\mathrm{sky}}^{XY}\n$$\n$$\n\\frac{\\int (W_X W_Y)^2 d\\Omega}{4\\pi} = \\frac{\\int W_X W_Y d\\Omega}{4\\pi} = f_{\\mathrm{sky}}^{XY}\n$$\n尽管这个假设很强，并且不是条件 $0 \\le W_{X,Y} \\le 1$ 严格要求的，但为了将表达式简化为最终答案所允许的变量，这是必要的。代入这些结果：\n$$\n\\mathrm{Var}(\\hat{C}_{\\ell}^{XY}) \\approx \\frac{1}{(f_{\\mathrm{sky}}^{XY})^2 (2\\ell+1)} \\left[ C_{\\ell}^{XX,\\mathrm{tot}} C_{\\ell}^{YY,\\mathrm{tot}} f_{\\mathrm{sky}}^{XY} + (C_{\\ell}^{XY})^2 f_{\\mathrm{sky}}^{XY} \\right]\n$$\n$$\n\\mathrm{Var}(\\hat{C}_{\\ell}^{XY}) \\approx \\frac{f_{\\mathrm{sky}}^{XY}}{(f_{\\mathrm{sky}}^{XY})^2 (2\\ell+1)} \\left[ C_{\\ell}^{XX,\\mathrm{tot}} C_{\\ell}^{YY,\\mathrm{tot}} + (C_{\\ell}^{XY})^2 \\right]\n$$\n$$\n\\mathrm{Var}(\\hat{C}_{\\ell}^{XY}) \\approx \\frac{1}{(2\\ell+1) f_{\\mathrm{sky}}^{XY}} \\left[ (C_{\\ell}^{XX} + N_{\\ell}^{X})(C_{\\ell}^{YY} + N_{\\ell}^{Y}) + (C_{\\ell}^{XY})^2 \\right]\n$$\n这是在所述近似下（最值得注意的是高-$\\ell$极限和二值掩膜假设）解卷积交叉功率谱方差的最终表达式。因子 $1/f_{\\mathrm{sky}}^{XY}$ 表示由于仅观测一部分天区导致模式数量减少而引起的方差增加。", "answer": "$$\\boxed{\\frac{1}{(2\\ell+1) f_{\\mathrm{sky}}^{XY}} \\left[ \\left(C_{\\ell}^{XX} + N_{\\ell}^{X}\\right) \\left(C_{\\ell}^{YY} + N_{\\ell}^{Y}\\right) + \\left(C_{\\ell}^{XY}\\right)^2 \\right]}$$", "id": "3469920"}, {"introduction": "在理解了基本的统计误差之后，我们现在转向交叉相关研究中的一个主要挑战：来自前景和观测系统误差的污染。这项练习介绍“模式投影” ([@problem_id:3469891])，这是一种强大且广泛使用的技术，用于移除那些可以用空间模板建构的污染物。我们将从第一性原理出发，推导这种“清洗”过程所带来的统计代价，量化一个朴素估计量中的残留偏差，以及一个经过适当修正的估计量中的方差增加（即“方差膨胀”）。", "problem": "考虑宇宙微波背景 (CMB) 引力透镜汇聚场（用场 $\\kappa$ 表示）与星系超密度场（用 $g$ 表示）之间的交叉相关分析。在多极矩为 $\\ell$ 的单个球谐频带上，假设设置如下。\n\n基本基础包括球谐系数 $a_{\\ell m}$ 的定义、高斯随机场性质以及由这些系数构建的无偏估计量。设 $a_{\\ell m}^{\\kappa}$ 和 $a_{\\ell m}^{g}$ 分别表示 $\\kappa$ 和 $g$ 在固定多极矩 $\\ell$ 上的球谐系数，其中 $m$ 遍历频带中可用的 $M$ 个模式。假设这些场是零均值、统计各向同性的高斯随机场，其每模式协方差为\n$$\n\\mathbb{E}\\left[a_{\\ell m}^{\\kappa} a_{\\ell m}^{\\kappa}\\right] = C_{\\ell}^{\\kappa\\kappa}, \\quad\n\\mathbb{E}\\left[a_{\\ell m}^{g} a_{\\ell m}^{g}\\right] = C_{\\ell}^{gg}, \\quad\n\\mathbb{E}\\left[a_{\\ell m}^{\\kappa} a_{\\ell m}^{g}\\right] = C_{\\ell}^{\\kappa g},\n$$\n且不同 $m$ 的模式是独立的。观测到的星系场被观测系统误差（例如，恒星密度、尘埃、视宁度）所污染，这些系统误差由一组 $p$ 个线性无关的模板向量建模，这些向量构成一个矩阵 $T \\in \\mathbb{R}^{M \\times p}$ 的列。这些模板张成了待移除的污染模式的子空间。定义模式投影算子\n$$\nP \\equiv I - T\\left(T^{\\top}T\\right)^{-1}T^{\\top},\n$$\n它将任意向量投影到模板子空间的正交补上。投影后的观测星系系数为 $P\\,a_{\\ell}^{g,\\mathrm{obs}}$，朴素交叉谱估计量为\n$$\n\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g} \\equiv \\frac{1}{M}\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} P\\, a_{\\ell}^{g,\\mathrm{obs}}.\n$$\n\n从这些定义和高斯场性质（包括威克定理）出发，从第一性原理推导：\n1. $\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}$ 的期望值，用 $M$、$p$ 和 $C_{\\ell}^{\\kappa g}$ 表示，并定义残余偏差\n$$\nb_{\\ell} \\equiv \\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}\\right] - C_{\\ell}^{\\kappa g}.\n$$\n2. 无偏、修正后估计量的方差\n$$\n\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g} \\equiv \\frac{1}{M-p}\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} P\\, a_{\\ell}^{g,\\mathrm{obs}},\n$$\n以及无投影的基准估计量的方差\n$$\n\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g} \\equiv \\frac{1}{M}\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} a_{\\ell}^{g},\n$$\n以获得由模板边缘化引起的方差膨胀因子，\n$$\nF_{\\ell} \\equiv \\frac{\\mathrm{Var}\\left(\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g}\\right)}{\\mathrm{Var}\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right)}.\n$$\n你的推导必须仅从所述的高斯场性质和 $P$ 的定义开始，避免使用任何快捷公式，并且必须通过将问题转换到一个使投影算子 $P$ 对角化的标准正交基来展示其逻辑。\n\n算法任务。实现一个程序，给定模式数 $M$、模板数 $p$ 以及功率谱带值 $C_{\\ell}^{\\kappa g}$、$C_{\\ell}^{\\kappa\\kappa}$ 和 $C_{\\ell}^{gg}$，计算：\n- 上述定义的朴素估计量的残余偏差 $b_{\\ell}$（一个浮点数）。\n- 修正后估计量相对于基准估计量的方差膨胀因子 $F_{\\ell}$（一个浮点数）。\n\n两个量都是无量纲数。请使用推导出的封闭形式表达式，而非蒙特卡洛模拟。\n\n测试套件。在以下四个参数集上评估程序，涵盖一般情况、中度边缘化、重度边缘化和接近边界的情况：\n- 情况 1：$M=1024$, $p=1$, $C_{\\ell}^{\\kappa g}=2.0$, $C_{\\ell}^{\\kappa\\kappa}=10.0$, $C_{\\ell}^{gg}=8.0$。\n- 情况 2：$M=64$, $p=8$, $C_{\\ell}^{\\kappa g}=2.0$, $C_{\\ell}^{\\kappa\\kappa}=10.0$, $C_{\\ell}^{gg}=8.0$。\n- 情况 3：$M=200$, $p=100$, $C_{\\ell}^{\\kappa g}=1.2$, $C_{\\ell}^{\\kappa\\kappa}=5.0$, $C_{\\ell}^{gg}=4.0$。\n- 情况 4：$M=20$, $p=19$, $C_{\\ell}^{\\kappa g}=0.5$, $C_{\\ell}^{\\kappa\\kappa}=3.0$, $C_{\\ell}^{gg}=2.0$。\n\n答案规格与最终输出格式。对于每种情况，按顺序 $(b_{\\ell}, F_{\\ell})$ 计算两个浮点数，并将所有八个浮点数聚合到一个列表中。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个浮点数四舍五入到六位小数（例如，$\\left[\\dots\\right]$）。不应打印任何其他文本。", "solution": "该问题被评估为具有科学依据、提法恰当且客观。它提出了一个宇宙学统计学中标准的、尽管不那么简单的练习。所有必要信息都已提供，并且其前提与宇宙学中应用的高斯随机场和线性代数的既定原理相符。因此，我们可以进行形式推导。\n\n问题的核心是确定当受系统误差污染的模式通过投影被移除时，交叉谱估计量的统计特性。我们给定在固定多极矩 $\\ell$ 上的球谐系数向量 $a_{\\ell}^{\\kappa}$ 和 $a_{\\ell}^{g}$，每个向量包含 $M$ 个模式。这些是零均值高斯随机场的实例。它们的协方差结构由下式给出：\n$$\n\\mathbb{E}\\left[a_{\\ell i}^{X} a_{\\ell j}^{Y}\\right] = \\delta_{ij} C_{\\ell}^{XY}\n$$\n其中 $X, Y \\in \\{\\kappa, g\\}$，$i$ 和 $j$ 是从 $1$ 到 $M$ 的模式索引，$\\delta_{ij}$ 是克罗内克 δ 符号，$C_{\\ell}^{XY}$ 是自功率谱和交叉功率谱。我们按照标准做法假设，为了本次计算的目的，进行投影所依据的观测星系场 $a_{\\ell}^{g, \\mathrm{obs}}$ 等同于真实的宇宙学信号 $a_{\\ell}^{g}$。这使我们能够分离出投影操作本身的统计成本。\n\n投影算子 $P = I - T(T^{\\top}T)^{-1}T^{\\top}$ 将向量投影到由 $T$ 中 $p$ 个模板向量所张成的子空间的正交补空间上。$P$ 是一个对称 ($P=P^\\top$) 和幂等 ($P^2=P$) 的矩阵。它的秩等于它的迹，即 $\\mathrm{rank}(P) = \\mathrm{Tr}(P) = \\mathrm{Tr}(I) - \\mathrm{Tr}(T(T^{\\top}T)^{-1}T^{\\top}) = M - \\mathrm{Tr}((T^{\\top}T)^{-1}T^{\\top}T) = M - \\mathrm{Tr}(I_p) = M-p$。\n\n### 1. 残余偏差 $b_{\\ell}$ 的推导\n\n朴素估计量定义为 $\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g} \\equiv \\frac{1}{M}\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} P a_{\\ell}^{g}$。用索引符号表示，即：\n$$\n\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g} = \\frac{1}{M} \\sum_{i=1}^{M} \\sum_{j=1}^{M} a_{\\ell i}^{\\kappa} P_{ij} a_{\\ell j}^{g}\n$$\n为了求其期望值，我们应用期望算子并利用其线性性质：\n$$\n\\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}\\right] = \\frac{1}{M} \\sum_{i=1}^{M} \\sum_{j=1}^{M} P_{ij} \\mathbb{E}\\left[a_{\\ell i}^{\\kappa} a_{\\ell j}^{g}\\right]\n$$\n使用给定的协方差性质 $\\mathbb{E}\\left[a_{\\ell i}^{\\kappa} a_{\\ell j}^{g}\\right] = \\delta_{ij} C_{\\ell}^{\\kappa g}$：\n$$\n\\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}\\right] = \\frac{1}{M} \\sum_{i=1}^{M} \\sum_{j=1}^{M} P_{ij} \\delta_{ij} C_{\\ell}^{\\kappa g}\n$$\n克罗内克 δ 符号 $\\delta_{ij}$ 使对 $j$ 的求和坍缩，令 $j=i$：\n$$\n\\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}\\right] = \\frac{C_{\\ell}^{\\kappa g}}{M} \\sum_{i=1}^{M} P_{ii}\n$$\n$P$ 的对角元素之和是它的迹 $\\mathrm{Tr}(P)$。如前所示，$\\mathrm{Tr}(P) = M-p$。\n$$\n\\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}\\right] = \\frac{C_{\\ell}^{\\kappa g}}{M} (M-p) = C_{\\ell}^{\\kappa g} \\left(1 - \\frac{p}{M}\\right)\n$$\n残余偏差 $b_{\\ell}$ 定义为该期望与真值 $C_{\\ell}^{\\kappa g}$ 之间的差：\n$$\nb_{\\ell} \\equiv \\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{naive}}^{\\kappa g}\\right] - C_{\\ell}^{\\kappa g} = C_{\\ell}^{\\kappa g} \\left(1 - \\frac{p}{M}\\right) - C_{\\ell}^{\\kappa g} = -C_{\\ell}^{\\kappa g} \\frac{p}{M}\n$$\n这个偏差是由于从总共 $M$ 个可用模式中移除了 $p$ 个模式，导致总信号功率按比例减少，而朴素的 $1/M$ 归一化并未对此进行说明。\n\n### 2. 方差膨胀因子 $F_{\\ell}$ 的推导\n\n方差膨胀因子是修正后估计量与基准估计量方差的比值。我们必须首先推导各自的方差。\n\n#### 基准估计量的方差\n基准估计量是 $\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g} = \\frac{1}{M}\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} a_{\\ell}^{g} = \\frac{1}{M} \\sum_{i=1}^{M} a_{\\ell i}^{\\kappa} a_{\\ell i}^{g}$。\n首先，其期望值为 $\\mathbb{E}[\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}] = \\frac{1}{M} \\sum_{i=1}^{M} \\mathbb{E}[a_{\\ell i}^{\\kappa} a_{\\ell i}^{g}] = \\frac{1}{M} \\sum_{i=1}^{M} C_{\\ell}^{\\kappa g} = C_{\\ell}^{\\kappa g}$。它是一个无偏估计量。\n方差是 $\\mathrm{Var}(\\hat{C}) = \\mathbb{E}[\\hat{C}^2] - (\\mathbb{E}[\\hat{C}])^2$。我们需要计算二阶矩：\n$$\n\\mathbb{E}\\left[\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right)^2\\right] = \\frac{1}{M^2} \\mathbb{E}\\left[ \\left(\\sum_{i=1}^{M} a_{\\ell i}^{\\kappa} a_{\\ell i}^{g}\\right) \\left(\\sum_{j=1}^{M} a_{\\ell j}^{\\kappa} a_{\\ell j}^{g}\\right) \\right] = \\frac{1}{M^2} \\sum_{i,j=1}^{M} \\mathbb{E}\\left[a_{\\ell i}^{\\kappa} a_{\\ell i}^{g} a_{\\ell j}^{\\kappa} a_{\\ell j}^{g}\\right]\n$$\n这是一个高斯随机变量四点乘积的期望。我们应用威克定理：\n$$\n\\mathbb{E}[X_1 X_2 X_3 X_4] = \\mathbb{E}[X_1 X_2]\\mathbb{E}[X_3 X_4] + \\mathbb{E}[X_1 X_3]\\mathbb{E}[X_2 X_4] + \\mathbb{E}[X_1 X_4]\\mathbb{E}[X_2 X_3]\n$$\n对于 $X_1=a_{\\ell i}^{\\kappa}, X_2=a_{\\ell i}^{g}, X_3=a_{\\ell j}^{\\kappa}, X_4=a_{\\ell j}^{g}$，并使用 $\\mathbb{E}[a_{\\ell i}^{A} a_{\\ell j}^{B}] = \\delta_{ij} C_{\\ell}^{AB}$，我们有：\n$$\n\\begin{aligned}\n\\mathbb{E}\\left[a_{\\ell i}^{\\kappa} a_{\\ell i}^{g} a_{\\ell j}^{\\kappa} a_{\\ell j}^{g}\\right] &= \\mathbb{E}[a_{\\ell i}^{\\kappa} a_{\\ell i}^{g}] \\mathbb{E}[a_{\\ell j}^{\\kappa} a_{\\ell j}^{g}] + \\mathbb{E}[a_{\\ell i}^{\\kappa} a_{\\ell j}^{\\kappa}] \\mathbb{E}[a_{\\ell i}^{g} a_{\\ell j}^{g}] + \\mathbb{E}[a_{\\ell i}^{\\kappa} a_{\\ell j}^{g}] \\mathbb{E}[a_{\\ell i}^{g} a_{\\ell j}^{\\kappa}] \\\\\n&= \\left(C_{\\ell}^{\\kappa g}\\right)^2 + \\left(\\delta_{ij} C_{\\ell}^{\\kappa\\kappa}\\right) \\left(\\delta_{ij} C_{\\ell}^{gg}\\right) + \\left(\\delta_{ij} C_{\\ell}^{\\kappa g}\\right) \\left(\\delta_{ij} C_{\\ell}^{\\kappa g}\\right) \\\\\n&= \\left(C_{\\ell}^{\\kappa g}\\right)^2 + \\delta_{ij} \\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right)\n\\end{aligned}\n$$\n注意 $\\delta_{ij}^2 = \\delta_{ij}$。现在我们将其代回求和式中：\n$$\n\\mathbb{E}\\left[\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right)^2\\right] = \\frac{1}{M^2} \\sum_{i,j=1}^{M} \\left[ \\left(C_{\\ell}^{\\kappa g}\\right)^2 + \\delta_{ij} \\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right) \\right]\n$$\n第一项求和得到 $M^2 (C_{\\ell}^{\\kappa g})^2$。第二项仅在 $i=j$ 时非零，因此对 $i,j$ 的求和得到 $M$ 项。\n$$\n\\mathbb{E}\\left[\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right)^2\\right] = \\frac{1}{M^2} \\left[ M^2\\left(C_{\\ell}^{\\kappa g}\\right)^2 + M\\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right) \\right] = \\left(C_{\\ell}^{\\kappa g}\\right)^2 + \\frac{1}{M}\\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right)\n$$\n因此，方差为：\n$$\n\\mathrm{Var}\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right) = \\mathbb{E}\\left[\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right)^2\\right] - \\left(\\mathbb{E}\\left[\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right]\\right)^2 = \\frac{1}{M}\\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right)\n$$\n\n#### 修正后估计量的方差\n修正后估计量为 $\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g} = \\frac{1}{M-p}\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} P a_{\\ell}^{g}$。按照指示，我们变换到一个使 $P$ 对角化的标准正交基。由于 $P$ 是一个实对称投影矩阵，它可以被一个正交矩阵 $U$ 对角化，使得 $P = U D U^{\\top}$。对角矩阵 $D$ 包含 $P$ 的特征值，即 $1$（多重度为 $M-p$）和 $0$（多重度为 $p$）。我们对基进行排序，使得 $D = \\mathrm{diag}(\\underbrace{1,\\dots,1}_{M-p}, \\underbrace{0,\\dots,0}_{p})$。\n\n定义旋转后的谐波系数向量 $b_{\\ell}^{\\kappa} \\equiv U^{\\top}a_{\\ell}^{\\kappa}$ 和 $b_{\\ell}^{g} \\equiv U^{\\top}a_{\\ell}^{g}$。它们仍然是零均值高斯变量。它们的协方差为：\n$$\n\\mathbb{E}\\left[b_{\\ell i}^{X} b_{\\ell j}^{Y}\\right] = \\mathbb{E}\\left[ (U^{\\top}a_{\\ell}^{X})_i (U^{\\top}a_{\\ell}^{Y})_j \\right] = \\sum_{k,m} U_{ki} U_{mj} \\mathbb{E}\\left[a_{\\ell k}^{X} a_{\\ell m}^{Y}\\right] = \\sum_{k,m} U_{ki} U_{mj} \\delta_{km}C_{\\ell}^{XY} = C_{\\ell}^{XY} \\sum_k U_{ki} U_{kj}\n$$\n由于 $U$ 是正交的，$U^{\\top}U=I$，这意味着 $\\sum_k U_{ki} U_{kj} = (U^{\\top}U)_{ij} = \\delta_{ij}$。因此：\n$$\n\\mathbb{E}\\left[b_{\\ell i}^{X} b_{\\ell j}^{Y}\\right] = \\delta_{ij} C_{\\ell}^{XY}\n$$\n在这次旋转下，模式的统计特性是不变的。模式 $b_{\\ell i}$ 是独立的，并且具有与原始模式 $a_{\\ell i}$ 相同的方差。\n\n现在，重写估计量中的二次型：\n$$\n\\left(a_{\\ell}^{\\kappa}\\right)^{\\top} P a_{\\ell}^{g} = \\left(a_{\\ell}^{\\kappa}\\right)^{\\top} U D U^{\\top} a_{\\ell}^{g} = \\left(U^{\\top} a_{\\ell}^{\\kappa}\\right)^{\\top} D \\left(U^{\\top} a_{\\ell}^{g}\\right) = \\left(b_{\\ell}^{\\kappa}\\right)^{\\top} D b_{\\ell}^{g}\n$$\n用索引符号表示，这变成：\n$$\n\\sum_{i=1}^{M} b_{\\ell i}^{\\kappa} D_{ii} b_{\\ell i}^{g} = \\sum_{i=1}^{M-p} b_{\\ell i}^{\\kappa} b_{\\ell i}^{g}\n$$\n估计量转化为：\n$$\n\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g} = \\frac{1}{M-p} \\sum_{i=1}^{M-p} b_{\\ell i}^{\\kappa} b_{\\ell i}^{g}\n$$\n该表达式在形式上与基准估计量 $\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}$ 相同，但模式数是 $M-p$ 而不是 $M$。通过与基准方差推导的直接类比，我们可以用 $M-p$ 替换 $M$ 来找到修正后估计量的方差：\n$$\n\\mathrm{Var}\\left(\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g}\\right) = \\frac{1}{M-p}\\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right)\n$$\n前因子 $1/(M-p)$ 使得该估计量是无偏的，因为 $\\mathbb{E}[\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g}] = \\frac{1}{M-p} \\sum_{i=1}^{M-p} C_{\\ell}^{\\kappa g} = C_{\\ell}^{\\kappa g}$。\n\n#### 方差膨胀因子\n最后，膨胀因子 $F_{\\ell}$ 是这两个方差的比值：\n$$\nF_{\\ell} \\equiv \\frac{\\mathrm{Var}\\left(\\widehat{C}_{\\ell,\\mathrm{corr}}^{\\kappa g}\\right)}{\\mathrm{Var}\\left(\\widehat{C}_{\\ell,\\mathrm{base}}^{\\kappa g}\\right)} = \\frac{\\frac{1}{M-p}\\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right)}{\\frac{1}{M}\\left( C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + \\left(C_{\\ell}^{\\kappa g}\\right)^2 \\right)}\n$$\n谱项 $(C_{\\ell}^{\\kappa\\kappa} C_{\\ell}^{gg} + (C_{\\ell}^{\\kappa g})^2)$ 被消去，得到：\n$$\nF_{\\ell} = \\frac{M}{M-p}\n$$\n该因子量化了因投影掉 $p$ 个模板而导致的统计不确定性（方差）的增加，这实际上将用于估计的可用模式数从 $M$ 减少到了 $M-p$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the residual bias and variance inflation factor for a cosmological\n    cross-correlation analysis with template marginalization, based on derived\n    closed-form expressions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains (M, p, C_lgk, C_lkk, C_lgg).\n    # M: number of modes\n    # p: number of templates\n    # C_lgk: cross-power spectrum C_l^{kappa g}\n    # C_lkk: auto-power spectrum C_l^{kappa kappa}\n    # C_lgg: auto-power spectrum C_l^{gg}\n    test_cases = [\n        (1024, 1, 2.0, 10.0, 8.0),\n        (64, 8, 2.0, 10.0, 8.0),\n        (200, 100, 1.2, 5.0, 4.0),\n        (20, 19, 0.5, 3.0, 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        M, p, C_lgk, C_lkk, C_lgg = case\n\n        # 1. Calculate the residual bias for the naive estimator.\n        # The derived formula is b_l = -C_l^{kg} * (p / M).\n        # This represents the systematic underestimation of the cross-spectrum\n        # when using a naive 1/M normalization after projecting out p modes.\n        b_l = -C_lgk * p / M\n\n        # 2. Calculate the variance inflation factor for the corrected estimator.\n        # The corrected estimator's variance is higher than the baseline\n        # estimator's variance because fewer modes are used.\n        # The derived formula is F_l = M / (M - p).\n        # This factor is always > 1 for p > 0.\n        # The problem statement ensures M > p, so M - p != 0.\n        F_l = M / (M - p)\n\n        results.append(b_l)\n        results.append(F_l)\n\n    # Final print statement must produce a single line containing a\n    # comma-separated list of 8 floats (b_l, F_l for each of the 4 cases),\n    # enclosed in square brackets. Each float must be rounded to six decimal places.\n    formatted_results = [f\"{x:.6f}\" for x in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3469891"}, {"introduction": "在应用了系统误差缓解技术后，我们如何确信我们的测量结果没有残留的、未知的系统误差？这最后一项练习将演示“零检验” ([@problem_id:3469900]) 的设计与应用，这是进行内部一致性检查的重要工具。我们将利用宇宙微波背景辐射（CMB）的引力透镜效应的旋度模式（在标准宇宙学模型中，其期望值为零），并计算其与星系巡天交叉相关的零信号周围预期的统计涨落，从而为探测显著的系统污染定义一个阈值。", "problem": "在宇宙学探针间的互相关研究中，一个核心挑战是如何区分真实的宇宙学信号与由系统误差引起的伪相关。考虑一个从宇宙微波背景（CMB）引力透镜重构构建的零检验，其中偏转场被分解为一个梯度（汇聚）分量和一个旋度分量。在包含标量微扰的标准宇宙学模型中，旋度分量为零，因此它与大尺度结构示踪物的互相关应该为空。该检验可以通过将重构的CMB引力透镜旋度模式场（记为 $\\omega$）与星系超密度图（记为 $g$）进行互相关来实现。在零假设下，真实互功率谱 $C_{L}^{\\omega g}$ 为零，任何测得的残差都源于噪声以及对部分天区的有限采样。\n\n从球面上高斯随机场和统计各向同性的假设出发，并采用标准的全天球谐形式，两个各向同性场 $X$ 和 $Y$ 在多极矩 $L$ 处的互功率谱估计量的协方差由下式给出：\n$$\n\\mathrm{Var}\\!\\left(\\hat{C}_{L}^{XY}\\right)=\\frac{\\left(C_{L}^{XX}+N_{L}^{X}\\right)\\left(C_{L}^{YY}+N_{L}^{Y}\\right)}{f_{\\mathrm{sky}}\\left(2L+1\\right)},\n$$\n其中 $f_{\\mathrm{sky}}$ 是观测天区的覆盖率，$C_{L}^{XX}$ 和 $C_{L}^{YY}$ 是真实的自功率谱，而 $N_{L}^{X}$ 和 $N_{L}^{Y}$ 是相应的噪声功率谱。通过在多极矩带 $L\\in[L_{\\min},L_{\\max}]$ 上对互谱进行逆方差加权，构建一个单带功率振幅估计量：\n$$\n\\hat{A}=\\frac{\\sum_{L=L_{\\min}}^{L_{\\max}}w_{L}\\,\\hat{C}_{L}^{\\omega g}}{\\sum_{L=L_{\\min}}^{L_{\\max}}w_{L}},\n\\quad\\text{with}\\quad\nw_{L}=\\frac{f_{\\mathrm{sky}}\\left(2L+1\\right)}{\\left(C_{L}^{\\omega\\omega}+N_{L}^{\\omega}\\right)\\left(C_{L}^{gg}+N_{L}^{g}\\right)}.\n$$\n在零假设下，期望值 $\\mathbb{E}\\!\\left[\\hat{A}\\right]=0$，残差水平由均方根（RMS）$\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)}$ 来量化，其中对于独立的多极矩和最优的逆方差权重，\n$$\n\\mathrm{Var}\\!\\left(\\hat{A}\\right)=\\left[\\sum_{L=L_{\\min}}^{L_{\\max}}w_{L}\\right]^{-1}.\n$$\n\n假设在多极矩范围 $L\\in[100,1000]$ 和天区覆盖率 $f_{\\mathrm{sky}}=0.25$ 上，具有以下科学上合理的自功率谱和仪器/噪声特性：\n- CMB引力透镜旋度模式自功率可忽略不计：$C_{L}^{\\omega\\omega}=0$。\n- CMB引力透镜旋度模式重构噪声在该频带上近似为白噪声：$N_{L}^{\\omega}=N_{0}$，其中 $N_{0}=2.0\\times 10^{-8}$。\n- 星系超密度自功率遵循弱幂律：$C_{L}^{gg}=A_{g}L^{-1}$，其中 $A_{g}=5.0\\times 10^{-7}$。\n- 星系散粒噪声是平坦的：$N_{L}^{g}=n^{-1}$，其中 $n^{-1}=2.0\\times 10^{-6}$。\n\n将多极矩视为独立的，并忽略除 $f_{\\mathrm{sky}}$ 因子之外的任何残余模式耦合。在这些假设下，推导 $\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)}$ 的闭式表达式，并对指定的参数计算其数值。将最终数值答案四舍五入至三位有效数字。以无量纲单位表示最终振幅。", "solution": "该问题是有效的，因为它在科学上基于标准宇宙学形式体系，所有必要信息均已提供，问题是适定的，并且措辞客观。它提出了一个在观测宇宙学中对零检验的期望误差进行标准计算的方法。\n\n目标是计算带功率振幅估计量的均方根（RMS），即 $\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)}$。根据问题陈述，估计量 $\\hat{A}$ 的方差由在指定多极矩带上最优权重 $w_L$ 之和的倒数给出。\n$$\n\\mathrm{Var}\\!\\left(\\hat{A}\\right) = \\left[\\sum_{L=L_{\\min}}^{L_{\\max}} w_{L}\\right]^{-1}\n$$\n权重 $w_L$ 定义为在每个多极矩 $L$ 处互功率谱估计量 $\\hat{C}_{L}^{\\omega g}$ 的方差的倒数。权重的表达式如下：\n$$\nw_{L} = \\frac{f_{\\mathrm{sky}}\\left(2L+1\\right)}{\\left(C_{L}^{\\omega\\omega}+N_{L}^{\\omega}\\right)\\left(C_{L}^{gg}+N_{L}^{g}\\right)}\n$$\n给定了以下自功率谱和噪声功率谱的模型：\n- CMB引力透镜旋度模式信号：$C_{L}^{\\omega\\omega}=0$。\n- CMB引力透镜旋度模式噪声：$N_{L}^{\\omega}=N_{0}$。\n- 星系超密度信号：$C_{L}^{gg}=A_{g}L^{-1}$。\n- 星系散粒噪声：$N_{L}^{g}=n^{-1}$。\n\n将这些表达式代入权重 $w_L$ 的公式中，我们得到：\n$$\nw_{L} = \\frac{f_{\\mathrm{sky}}\\left(2L+1\\right)}{\\left(0+N_{0}\\right)\\left(A_{g}L^{-1}+n^{-1}\\right)} = \\frac{f_{\\mathrm{sky}}\\left(2L+1\\right)}{N_{0}\\left(\\frac{A_{g}}{L}+n^{-1}\\right)}\n$$\n为了简化分母，我们为括号中的项找到一个公分母：\n$$\nw_{L} = \\frac{f_{\\mathrm{sky}}\\left(2L+1\\right)}{N_{0}\\left(\\frac{A_{g}+n^{-1}L}{L}\\right)} = \\frac{f_{\\mathrm{sky}}L\\left(2L+1\\right)}{N_{0}\\left(A_{g}+n^{-1}L\\right)}\n$$\n现在，我们必须计算在多极矩范围 $L\\in[L_{\\min}, L_{\\max}]$ 上这些权重的和。\n$$\n\\sum_{L=L_{\\min}}^{L_{\\max}} w_{L} = \\sum_{L=L_{\\min}}^{L_{\\max}} \\frac{f_{\\mathrm{sky}}L\\left(2L+1\\right)}{N_{0}\\left(A_{g}+n^{-1}L\\right)} = \\frac{f_{\\mathrm{sky}}}{N_{0}} \\sum_{L=L_{\\min}}^{L_{\\max}} \\frac{2L^2+L}{A_{g}+n^{-1}L}\n$$\n由于多极矩范围很大（$L_{\\min}=100$ 到 $L_{\\max}=1000$），求和可以精确地用积分来近似。我们将 $L$ 视为一个连续变量：\n$$\n\\sum_{L=L_{\\min}}^{L_{\\max}} w_{L} \\approx \\int_{L_{\\min}}^{L_{\\max}} \\frac{f_{\\mathrm{sky}}L\\left(2L+1\\right)}{N_{0}\\left(A_{g}+n^{-1}L\\right)} dL = \\frac{f_{\\mathrm{sky}}}{N_{0}} \\int_{L_{\\min}}^{L_{\\max}} \\frac{2L^2+L}{A_{g}+n^{-1}L} dL\n$$\n为了计算该积分，我们对被积函数 $\\frac{2L^2+L}{n^{-1}L+A_{g}}$ 进行多项式长除法。我们通过从分母中提取因子 $n^{-1}$ 来重写被积函数：$\\frac{2L^2+L}{n^{-1}(L+A_g n)}$。积分变为：\n$$\n\\int \\frac{2L^2+L}{A_{g}+n^{-1}L} dL = n \\int \\frac{2L^2+L}{L+A_{g}n} dL\n$$\n$\\frac{2L^2+L}{L+A_{g}n}$ 的多项式除法得到：\n$$\n\\frac{2L^2+L}{L+A_{g}n} = 2L + (1-2A_{g}n) - \\frac{A_{g}n(1-2A_{g}n)}{L+A_{g}n}\n$$\n将此表达式对 $L$ 积分，得到：\n$$\n\\int \\left( 2L + (1-2A_{g}n) - \\frac{A_{g}n(1-2A_{g}n)}{L+A_{g}n} \\right) dL = L^2 + (1-2A_{g}n)L - A_{g}n(1-2A_{g}n)\\ln\\left|L+A_{g}n\\right|\n$$\n我们定义 $F(L) = L^2 + (1-2A_{g}n)L - A_{g}n(1-2A_{g}n)\\ln\\left(L+A_{g}n\\right)$。在积分范围内，项 $L+A_{g}n$ 是正的，所以不需要绝对值符号。\n权重的和则为：\n$$\n\\sum_{L=L_{\\min}}^{L_{\\max}} w_{L} \\approx \\frac{n f_{\\mathrm{sky}}}{N_{0}} \\left[ F(L) \\right]_{L_{\\min}}^{L_{\\max}} = \\frac{n f_{\\mathrm{sky}}}{N_{0}} \\left( F(L_{\\max}) - F(L_{\\min}) \\right)\n$$\n这提供了权重之和的闭式表达式。所求的量是 $\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)} = \\left(\\sum w_{L}\\right)^{-1/2}$。\n\n现在我们代入给定的数值：\n- $f_{\\mathrm{sky}} = 0.25$\n- $L_{\\min} = 100$, $L_{\\max} = 1000$\n- $N_{0} = 2.0 \\times 10^{-8}$\n- $A_{g} = 5.0 \\times 10^{-7}$\n- $n^{-1} = 2.0 \\times 10^{-6}$，这意味着 $n = \\frac{1}{2.0 \\times 10^{-6}} = 5.0 \\times 10^{5}$\n\n首先，我们计算无量纲常数项：\n$$\nA_g n = (5.0 \\times 10^{-7}) (5.0 \\times 10^{5}) = 0.25\n$$\n$$\n1-2A_{g}n = 1 - 2(0.25) = 0.5\n$$\n$$\nA_{g}n(1-2A_{g}n) = 0.25 \\times 0.5 = 0.125\n$$\n因此函数 $F(L)$ 简化为：\n$$\nF(L) = L^2 + 0.5L - 0.125\\ln(L+0.25)\n$$\n接下来，我们计算积分的预因子：\n$$\n\\frac{n f_{\\mathrm{sky}}}{N_{0}} = \\frac{(5.0 \\times 10^{5})(0.25)}{2.0 \\times 10^{-8}} = \\frac{1.25 \\times 10^{5}}{2.0 \\times 10^{-8}} = 0.625 \\times 10^{13} = 6.25 \\times 10^{12}\n$$\n现在我们计算 $F(L_{\\max}) - F(L_{\\min})$：\n$$\nF(1000) = (1000)^2 + 0.5(1000) - 0.125\\ln(1000+0.25) = 1000500 - 0.125\\ln(1000.25)\n$$\n$$\nF(100) = (100)^2 + 0.5(100) - 0.125\\ln(100+0.25) = 10050 - 0.125\\ln(100.25)\n$$\n差值为：\n$$\nF(1000) - F(100) = (1000500 - 10050) - 0.125\\left(\\ln(1000.25) - \\ln(100.25)\\right)\n$$\n$$\nF(1000) - F(100) = 990450 - 0.125\\ln\\left(\\frac{1000.25}{100.25}\\right)\n$$\n使用自然对数：$\\ln(1000.25) \\approx 6.907995$ 且 $\\ln(100.25) \\approx 4.607650$。\n$$\nF(1000) - F(100) = 990450 - 0.125(6.907995 - 4.607650) = 990450 - 0.125(2.300345) \\approx 990450 - 0.287543 \\approx 990449.712\n$$\n权重的和是：\n$$\n\\sum w_L \\approx (6.25 \\times 10^{12}) \\times 990449.712 \\approx 6.19031 \\times 10^{18}\n$$\n方差是这个和的倒数：\n$$\n\\mathrm{Var}\\!\\left(\\hat{A}\\right) = \\left(\\sum w_L\\right)^{-1} \\approx \\frac{1}{6.19031 \\times 10^{18}} \\approx 1.61542 \\times 10^{-19}\n$$\n最后，RMS值是方差的平方根：\n$$\n\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)} \\approx \\sqrt{1.61542 \\times 10^{-19}} = \\sqrt{16.1542 \\times 10^{-20}} = \\sqrt{16.1542} \\times 10^{-10}\n$$\n$$\n\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)} \\approx 4.01923 \\times 10^{-10}\n$$\n四舍五入到三位有效数字，我们得到最终结果。\n$$\n\\sqrt{\\mathrm{Var}\\!\\left(\\hat{A}\\right)} \\approx 4.02 \\times 10^{-10}\n$$\n这个值表示由于仪器噪声和有限天区上的宇宙方差，对零检验振幅 $\\hat{A}$ 的期望 $1\\sigma$ 统计不确定度。", "answer": "$$\\boxed{4.02 \\times 10^{-10}}$$", "id": "3469900"}]}