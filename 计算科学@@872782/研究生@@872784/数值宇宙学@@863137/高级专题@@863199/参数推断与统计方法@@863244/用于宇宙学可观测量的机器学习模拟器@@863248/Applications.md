## 应用与[交叉](@entry_id:147634)学科联系

### 引言

在前面的章节中，我们已经探讨了构建[宇宙学可观测量](@entry_id:747921)[机器学习模拟器](@entry_id:751586)的核心原理与机制。我们理解了模拟器如何通过高斯过程或[神经网](@entry_id:276355)络等模型，学习[宇宙学参数](@entry_id:161338) $\boldsymbol{\theta}$ 与[可观测量](@entry_id:267133)（如[功率谱](@entry_id:159996)）之间的复杂函数关系。然而，模拟器的真正价值并不仅仅在于其作为“快速计算器”的能力。它们是强大的科学工具，能够实现以往因计算成本过高而难以企及的分析，并且为我们提供了处理和传播不确定性的新[范式](@entry_id:161181)。

本章的目标是从构建模拟器的“如何做”转向其应用的“为何”与“何处”。我们将探索模拟器在多样化、真实世界和跨学科背景下的实际应用。我们将看到，这些应用常常要求我们超越简单的点预测，去精心设计能够体现物理结构、处理复杂不确定性、并与先进推断引擎无缝集成的模拟器。通过一系列的应用实例，本章旨在展示模拟器如何从一种便利工具，演变为现代[数值宇宙学](@entry_id:752779)研究的基石。

### 模拟高维与结构化[可观测量](@entry_id:267133)

宇宙学中的许多关键[可观测量](@entry_id:267133)并非简单的标量，而是具有丰富内部结构的高维向量、矩阵或函数。一个成功的模拟器必须能够识别、学习并再现这些结构。这不仅是出于[计算效率](@entry_id:270255)的考虑，更是为了保证模拟结果的物理真实性。

#### 捕捉矢量值[可观测量](@entry_id:267133)中的物理关联

一个典型的例子是宇宙微波背景（CMB）的[角功率谱](@entry_id:161125) $C_\ell$。这是一个覆盖数千个[多极矩](@entry_id:191120) $\ell$ 的高维向量。尽管输出维度很高，但其所有分量都由少数几个（通常为6个）[宇宙学参数](@entry_id:161338) $\boldsymbol{\theta}$ 决定。这意味着不同 $\ell$ 值的 $C_\ell$ 之间存在着强烈的物理关联。任何对 $\boldsymbol{\theta}$ 的微小扰动，都会在整个 $\ell$ 范围内引起一种平滑且协调的变化。

因此，为每个 $C_\ell$ 独立训练一个模拟器是极其低效且物理上不合理的，因为这种方法忽略了它们之间共享的底层依赖关系。一种更优越、更符合物理原理的策略是采用具有“共享主干”（Shared Backbone）的[神经网络架构](@entry_id:637524)。在这种设计中，输入的[宇宙学参数](@entry_id:161338) $\boldsymbol{\theta}$首先被一个共享的[神经网](@entry_id:276355)络（主干）映射到一个低维的潜在空间表示 $\mathbf{z}$。然后，这个共享的潜在向量 $\mathbf{z}$ 被送入一个（通常是线性的）输出层，一次性地预测出整个 $C_\ell$ 向量。这种“[信息瓶颈](@entry_id:263638)”结构迫使网络学习一个能够捕捉所有 $C_\ell$ 共享信息的压缩表示，从而天然地再现了它们之间的物理关联。从数学上看，这种架构的雅可比矩阵 $\partial \hat{\mathbf{C}} / \partial \boldsymbol{\theta}$ 的秩受到潜在空间维度的限制，这恰好反映了真实物理[雅可比矩阵](@entry_id:264467)的低秩特性。

另一种强大的方法是先对训练数据集进行[降维](@entry_id:142982)。例如，主成分分析（PCA）可以从一组模拟的 $C_\ell$ 向量中提取出主要的、正交的变化模式。这些模式（即主成分）本身就编码了不同 $\ell$ 之间的协变结构。然后，模拟器的任务不再是预测高维的 $C_\ell$ 向量本身，而是预测其在这些主成分基上的低维系数。通过预测少量系数并将其与PCA[基向量](@entry_id:199546)[线性组合](@entry_id:154743)，我们就可以重构出具有正确内禀相关性的整个[功率谱](@entry_id:159996)。这两种方法——无论是通过架构设计（共享主干）还是通过[数据表示](@entry_id:636977)（PCA）——都体现了一个核心思想：将问题的物理约束（即由低维参数空间驱动）直接构建到模拟器模型中，从而实现更高效、更鲁棒的学习 [@problem_id:3478411]。

#### 在多探针协[方差](@entry_id:200758)中强制执行结构对称性

当我们处理多个相关探针的协[方差](@entry_id:200758)时，输出的结构变得更加复杂。以[弱引力透镜](@entry_id:158468)的层析成像分析为例，其关键可观测量是不同红移分层（Tomographic Bins）$i$ 和 $j$ 之间的剪切[角功率谱](@entry_id:161125) $C_\ell^{ij}$。对于每一个[多极矩](@entry_id:191120) $\ell$，这些功率谱分量可以被组织成一个矩阵 $\mathbf{C}_\ell$。

这个矩阵并非任意的。基于[统计场论](@entry_id:155447)的基本原理，它必须是实数、对称（即 $C_\ell^{ij} = C_\ell^{ji}$）且正半定（Symmetric Positive Definite, SPD）的。对称性源于两个实数场相关函数的[交换对称性](@entry_id:151892)，而正半定性则是一个更深层次的要求，保证了任意探针[线性组合](@entry_id:154743)的[方差](@entry_id:200758)都是非负的。一个模拟器的输出如果不能保证这些属性，那么它产生的就不是一个物理上有效的[协方差矩阵](@entry_id:139155)，这可能导致下游的[贝叶斯推断](@entry_id:146958)（例如，参数约束）出现严重问题，如[似然函数](@entry_id:141927)评估失败或产生无意义的结果。因此，设计能够固有地或通过正则化强制输出这些数学结构的模拟器是至关重要的。这不仅仅是技术细节，而是确保模拟器物理有效性的核心要求 [@problem_id:3478345]。

#### 利用基[函数分解](@entry_id:197881)处理各向异性场

许多[宇宙学可观测量](@entry_id:747921)表现出相对于某个优选方向的各向异性。一个典型的例子是在红移空间中测量的星系[两点相关函数](@entry_id:185074) $\xi(s, \mu)$，其中 $s$ 是星系对的距离，$\mu$ 是星系对分离方向与观测视线（Line Of Sight, LOS）夹角的余弦。[红移空间畸变](@entry_id:157636)（RSD）效应使得 $\xi$ 依赖于 $\mu$。

直接模拟二维函数 $\xi(s, \mu)$ 是一个复杂的挑战。一个更有效的方法是利用问题的对称性。由于物理过程关于视线方向是[轴对称](@entry_id:173333)的，$\xi(s, \mu)$ 可以被分解为一系列关于 $\mu$ 的勒让德多项式 $L_\ell(\mu)$。由于 $\xi(s, \mu)$ 在 $\mu \to -\mu$ 变换下是偶对称的，这个级数只包含偶数阶的[勒让德多项式](@entry_id:141510)：
$$
\xi(s, \mu) = \xi_0(s) L_0(\mu) + \xi_2(s) L_2(\mu) + \xi_4(s) L_4(\mu) + \dots
$$
这里的系数 $\xi_0(s)$、$\xi_2(s)$ 和 $\xi_4(s)$ 分别被称为[单极矩](@entry_id:267768)、[四极矩](@entry_id:157717)和六极矩。它们是只依赖于距离 $s$ 的一维函数，并且由于[勒让德多项式的正交性](@entry_id:264861)，它们捕获了不同角度尺度的独立信息。

因此，一个明智的模拟策略不是去学习复杂的二维函数 $\xi(s, \mu)$，而是将训练数据预先分解，为每一个重要的多极矩（如 $\xi_0, \xi_2, \xi_4$）分别或联合地训练模拟器。这种方法将一个复杂的二维学习问题简化为几个更简单的一维学习问题，不仅降低了模型的复杂性，而且保证了输出的各个分量具有清晰的物理意义，便于解释和诊断 [@problem_id:3478346]。

#### 为[高阶统计量](@entry_id:193349)引入[置换不变性](@entry_id:753356)

当我们转向更高阶的统计量，例如宇宙学密度场的能谱（Bispectrum）$B(k_1, k_2, k_3)$，新的对称性挑战便会出现。[能谱](@entry_id:181780)是傅立叶空间三点相关函数的幅度，它依赖于构成三角形的三个[波矢](@entry_id:178620)量的模长 $k_1, k_2, k_3$。由于底层的三点函数是对三个 $\delta(\mathbf{k})$ 场的期望，它在交换任意两个场时保持不变，这意味着 $B(k_1, k_2, k_3)$ 必须在其三个参数的任意[置换](@entry_id:136432)下保持不变。

一个朴素的模拟器，如果将 $(k_1, k_2, k_3)$ 当作一个普通的三维输入向量，将无法自动满足这一对称性要求。虽然可以通过[数据增强](@entry_id:266029)（即用所有6种[置换](@entry_id:136432)来扩充训练数据）来学习这种对称性，但这是一种低效且不完备的方法。一个更为根本和优雅的解决方案是利用[对称多项式](@entry_id:153581)理论。任何关于 $(k_1, k_2, k_3)$ 的[对称函数](@entry_id:177113)，都可以表示为[基本对称多项式](@entry_id:152224)的函数。对于三个变量，[基本对称多项式](@entry_id:152224)是：
$$
s_1 = k_1+k_2+k_3, \quad s_2 = k_1 k_2 + k_2 k_3 + k_3 k_1, \quad s_3 = k_1 k_2 k_3
$$
通过构建一个只使用这些[置换](@entry_id:136432)[不变量](@entry_id:148850)（或它们的组合，如 $s_1^a s_2^b s_3^c$）作为特征的模拟器，我们可以从架构层面保证其输出在 $(k_1, k_2, k_3)$ 的任意[置换](@entry_id:136432)下都严格不变。这种方法将物理对称性硬编码到模型中，大大提高了数据效率和模型的物理真实性。此外，对于能谱，输入还必须满足三角形不等式（例如，$k_1 \le k_2 + k_3$），这意味着训练点的采样必须在这一受限的物理域内进行，这也是设计有效模拟器时必须考虑的一个实际问题 [@problem_id:3478386]。

### 面向[不确定性量化](@entry_id:138597)与传播的模拟

模拟器的预测从来都不是绝对精确的。它们自身存在预测不确定性，这种不确定性来源于有限的训练数据和模型的局限性。此外，宇宙学分析中的不确定性还包括来自不同物理效应或分析选择的系统误差。一个成熟的模拟器应用框架必须能够量化、传播并最终将这些不确定性纳入科学结论中。

#### 联合建模宇宙学依赖与系统误差

在[现代宇宙学](@entry_id:752086)中，一个主要的挑战是处理来自不同数值模拟代码或分析流程的系统差异。例如，使用不同的[N体模拟](@entry_id:157492)代码（如 TreePM、Gadget、AREPO）来模拟相同的宇宙学，可能会因为算法、分辨率或包含的物理过程不同而产生略有差异的预测结果。忽略这些差异会低估我们对[宇宙学参数](@entry_id:161338)的最终不确定性。

[分层贝叶斯模型](@entry_id:169496)（Hierarchical Bayesian Models），特别是与[高斯过程](@entry_id:182192)相结合，为解决这个问题提供了一个强大的框架。我们可以构建一个分层模拟器，它包含：
1.  一个共享的、底层的潜函数 $f(\boldsymbol{\theta})$，用于描述对[宇宙学参数](@entry_id:161338) $\boldsymbol{\theta}$ 的共同物理响应。这个函数可以用一个GP来建模。
2.  一组代码特异性的偏置项 $b_c$，其中 $c$ 是代码标签（如 "Gadget"）。每一项 $b_c$ 代表了特定代码相对于共享物理响应的系统性偏差。这些偏置项也可以被建模为从一个共同的[先验分布](@entry_id:141376)（例如，零均值高斯分布）中抽取的[随机变量](@entry_id:195330)。

整个模型可以写为 $y(\boldsymbol{\theta}, c) = f(\boldsymbol{\theta}) + b_c$。通过在包含不同代码模拟结果的混合数据集上训练这个分层GP，模型能够同时学习底层的宇宙学依赖关系和每个代码的系统偏差。当对一个新宇宙学进行预测时，这个模型不仅能给出预测值，还能提供一个包含了“代码不确定性”的完整不确定性预算，从而能够更诚实地评估我们知识的边界 [@problem_id:3478331]。

#### 在联合分析中传播相关的模拟器误差

当我们将多个[宇宙学探针](@entry_id:160927)（例如，CMB和大型结构巡天）结合起来进行联合[参数推断](@entry_id:753157)时，正确传播所有不确定性来源至关重要。如果两个探针的理论预测都依赖于同一个（或相关的）[机器学习模拟器](@entry_id:751586)，那么它们的模拟器[预测误差](@entry_id:753692)很可能是相关的。例如，一个模拟器如果系统性地高估了某个[宇宙学参数](@entry_id:161338)下的[物质功率谱](@entry_id:161407)，那么它可能会同时影响对[弱引力透镜](@entry_id:158468)和星系聚类的预测。

忽略这种相关性将导致对[参数不确定性](@entry_id:264387)的不切实际的乐观估计。正确的做法是在构建[联合似然](@entry_id:750952)函数时，将模拟器误差的协[方差](@entry_id:200758)明确地包含在内。总的[数据协方差](@entry_id:748192)矩阵 $\mathbf{C}$ 应该是统计噪声协[方差](@entry_id:200758) $\boldsymbol{\Sigma}_{\mathrm{stat}}$（通常是对角或块对角的）和模拟器[误差协方差](@entry_id:194780) $\boldsymbol{\Sigma}_{\mathrm{emu}}$ 的和：
$$
\mathbf{C} = \boldsymbol{\Sigma}_{\mathrm{stat}} + \boldsymbol{\Sigma}_{\mathrm{emu}}
$$
这里的 $\boldsymbol{\Sigma}_{\mathrm{emu}}$ 不再是对角的；它的非对角项 $\rho \sigma_{eA} \sigma_{eB}$ 捕捉了探针 A 和 B 之间模拟器误差的相关性。将这个完整的、包含非对角误差项的[协方差矩阵](@entry_id:139155)用于[参数推断](@entry_id:753157)，可以确保我们从联合分析中获得的参数约束是稳健和保守的，因为它正确地考虑了我们的理论模型（模拟器）并非完美的事实 [@problem_id:3478384]。

#### 跨多重量测强制执行物理一致性

宇宙中的不同[可观测量](@entry_id:267133)并非总是独立的，它们常常被底层的物理定律联系在一起。一个经典的例子是密度场 $\delta$ 和[速度场散度](@entry_id:178755) $\theta$ 之间的关系。在线性理论中，[连续性方程](@entry_id:195013)要求 $\theta(\mathbf{k}) = -aHf \delta(\mathbf{k})$，其中 $a$ 是尺度因子，$H$ 是哈勃参数，$f$ 是增长率。这个关系直接导致了它们的[功率谱](@entry_id:159996)之间的确定性联系：$P_{vv}(k) = (aHf)^2 P_{dd}(k)$ 和 $P_{dv}(k) = -aHf P_{dd}(k)$。

如果我们独立地为 $P_{dd}$、$P_{vv}$ 和 $P_{dv}$ 构建模拟器，那么由于各自的模拟器误差，预测结果很可能会违反这些物理[一致性关系](@entry_id:157858)。一个更先进的方法是在模拟器设计中主动强制这种一致性。例如，我们可以不直接模拟 $P_{vv}$ 和 $P_{dv}$，而是模拟它们与 $P_{dd}$ 的比例。具体来说，我们可以将模拟器构建为：
$$
\hat{P}_{vv}(k) = (aHf)^2 P_{dd}(k) g_v(k), \quad \hat{P}_{dv}(k) = -aHf P_{dd}(k) g_d(k)
$$
其中 $g_v(k)$ 和 $g_d(k)$ 是需要学习的修正函数，它们描述了与线性理论的偏差。然后，我们可以设计一个带有惩罚项的损失函数，该惩罚项会惩罚 $g_v$ 和 $g_d$ 偏离1。这种方法将物理先验知识（连续性方程）嵌入到模型结构和训练目标中，使得模拟器在学习数据中微小偏差的同时，被“拉向”物理上一致的解，从而获得更稳健、更可信的预测 [@problem_id:3478360]。

#### 协方差矩阵的稳定模拟

在某些高级分析中，我们不仅需要模拟可观测量的均值，还需要模拟其随[宇宙学参数](@entry_id:161338)变化的协方差矩阵 $\mathrm{Cov}(\boldsymbol{\theta})$。直接模拟一个协方差矩阵是困难的，因为它必须始终满足对称正半定（SPD）的约束。

一个非常有效且数值稳定的策略是，不直接模拟协方差矩阵本身，而是模拟其[Cholesky分解](@entry_id:147066)因子 $\mathbf{L}(\boldsymbol{\theta})$。[Cholesky分解](@entry_id:147066)将任何一个[SPD矩阵](@entry_id:136714)唯一地分解为一个下[三角矩阵](@entry_id:636278) $\mathbf{L}$ 与其转置的乘积：$\mathrm{Cov} = \mathbf{L}\mathbf{L}^{\top}$。通过构建一个模拟器来预测下[三角矩阵](@entry_id:636278) $\mathbf{L}(\boldsymbol{\theta})$ 的元素，我们可以通过简单的后处理来保证最终的协方差矩阵是SPD的：
1.  模拟 $\mathbf{L}(\boldsymbol{\theta})$ 的所有下三角元素。
2.  通过应用softplus函数（$\log(1+e^x)$）等操作，强制其对角[线元](@entry_id:196833)素为正。
3.  通过 $\hat{\mathrm{Cov}}(\boldsymbol{\theta}) = \hat{\mathbf{L}}(\boldsymbol{\theta})\hat{\mathbf{L}}(\boldsymbol{\theta})^{\top}$ 重构出协方差矩阵。

由于具有正对角元的下三角矩阵 $\hat{\mathbf{L}}$ 总是可逆的，其乘积 $\hat{\mathbf{L}}\hat{\mathbf{L}}^{\top}$ 保证是[SPD矩阵](@entry_id:136714)。这种方法将一个复杂的约束优化问题转化为一个无约束的模拟问题，极大地提高了稳定性和鲁棒性。这种技术对于需要快速评估参数依赖性协[方差](@entry_id:200758)的分析（例如，在似然函数中）至关重要 [@problem_id:3478316]。

### 模拟器作为先进推断引擎的核心组件

[机器学习模拟器](@entry_id:751586)的出现，特别是那些能够提供精确梯度的模拟器，已经催生了新一代的[贝叶斯推断](@entry_id:146958)方法。这些方法在计算效率和采样能力上都远超传统的[马尔可夫链蒙特卡洛](@entry_id:138779)（MCMC）方法。

#### 模拟似然函数与[后验分布](@entry_id:145605)

传统上，模拟器被用来加速前向模型的评估，即给定参数 $\boldsymbol{\theta}$ 计算可观测量 $\mathbf{d}$。然而，一种更具革命性的[范式](@entry_id:161181)是直接模拟[贝叶斯推断](@entry_id:146958)中的核心[概率分布](@entry_id:146404)。这主要有两种形式：

1.  **神经[似然](@entry_id:167119)估计（NLE）**：在这种方法中，我们训练一个模型（如[归一化流](@entry_id:272573)）来学习[条件概率分布](@entry_id:163069) $p(\mathbf{d}|\boldsymbol{\theta})$。给定一个参数 $\boldsymbol{\theta}$，这个模型可以直接生成符合该宇宙学似然函数的数据样本 $\mathbf{d}$，或者直接计算给定 $(\mathbf{d}, \boldsymbol{\theta})$ 对的[似然](@entry_id:167119)值。[归一化流](@entry_id:272573)通过一个可逆的、具有易于计算的[雅可比行列式](@entry_id:137120)的[神经网](@entry_id:276355)络，将一个简单的基础[分布](@entry_id:182848)（如[高斯分布](@entry_id:154414)）映射到复杂的目标分布（[似然函数](@entry_id:141927)）。其训练目标是最大化在训练数据对 $(\mathbf{d}_i, \boldsymbol{\theta}_i)$ 上的[对数似然](@entry_id:273783) [@problem_id:3478377]。

2.  **[神经后验估计](@entry_id:752449)（NPE）**：这是更大胆的一步，我们训练一个模型直接学习[后验分布](@entry_id:145605) $p(\boldsymbol{\theta}|\mathbf{d})$。训练完成后，给定一个新的观测数据 $\mathbf{d}_{\text{obs}}$，这个“摊销”的模拟器可以立即生成来自近似[后验分布](@entry_id:145605)的样本，完全绕过了传统的[MCMC采样](@entry_id:751801)过程。其训练目标是最小化真实后验与模型后验之间的[KL散度](@entry_id:140001)，这等价于最大化在联合样本 $(\mathbf{d}_i, \boldsymbol{\theta}_i)$ 上的模型对数[后验概率](@entry_id:153467) [@problem_id:3478343]。

这两种方法都将原本需要在每次分析时都重复进行的昂贵推断过程，“摊销”到了一个一次性的、大规模的训练阶段，为快速、反复的科学探索打开了大门。

#### 摊销推断的关键诊断工具

直接模拟[概率分布](@entry_id:146404)的强大能力也带来了新的风险。这些模型可能会在训练数据覆盖不足的区域产生错误的推断，特别是可能变得“过分自信”，即产生比真实后验更窄的置信区间，从而导致对参数的错误紧凑约束。因此，严格的验证和诊断是必不可少的。

-   **基于模拟的校准（SBC）**：这是一种基础的全局校准检查。我们从先验中抽取大量“伪真实”参数 $\boldsymbol{\theta}^*$，用模拟器生成对应的“伪观测”数据 $\mathbf{d}^*$，然后用我们的NP[E模](@entry_id:160271)型从 $\mathbf{d}^*$ 推断后验。如果模型是校准的，那么真实的参数 $\boldsymbol{\theta}^*$ 在其自身的后验分布中的[分位数](@entry_id:178417)（rank）应该是[均匀分布](@entry_id:194597)的。任何偏离[均匀分布](@entry_id:194597)的系统性模式，例如U形[分布](@entry_id:182848)，都表明模型存在过分自信（欠覆盖）的问题。

-   **条件覆盖测试**：SBC是一个全局测试，它可能会掩盖在特定区域（例如，我们真实观测数据 $\mathbf{d}_{\text{obs}}$ 所在的区域）的局部问题。条件覆盖测试通过在 $\mathbf{d}_{\text{obs}}$ 周围生成测试数据来专门检查局部性能。如果在该区域发现后验的[置信区间](@entry_id:142297)系统性地未能覆盖真实参数，这就暴露了局部过分自信的问题。

-   **分类器双样本检验（C2ST）**：这是一种更通用的诊断方法。我们可以训练一个分类器来区分两个样本集：一个来自真实的联合分布 $p(\boldsymbol{\theta}, \mathbf{d})$，另一个来自模型重构的联合分布 $q_{\boldsymbol{\phi}}(\boldsymbol{\theta}|\mathbf{d})p(\mathbf{d})$。如果分类器的准确率显著高于随机猜测（50%），则说明模型未能完美地学习真实[分布](@entry_id:182848)，这可能表现为偏差、错误的[方差](@entry_id:200758)（过分自信）或其他更[高阶矩](@entry_id:266936)的失配 [@problem_id:3478343]。

#### 赋能[基于梯度的采样](@entry_id:749987)（HMC）

对于那些仍然依赖于逐点评估[后验概率](@entry_id:153467)的[MCMC方法](@entry_id:137183)，模拟器可以通过提供快速且精确的梯度来极大地提升其效率。[哈密顿蒙特卡洛](@entry_id:144208)（HMC）是一种先进的[MCMC算法](@entry_id:751788)，它利用后验对数概率的梯度信息来引导采样器在[参数空间](@entry_id:178581)中进行长程、高效的移动，从而大大减少样本之间的相关性。

然而，对于基于[数值模拟](@entry_id:137087)的宇宙学后验，梯度通常是无法解析获得的。传统的有限差分法来估计梯度，不仅计算成本高（需要多次模型评估），而且数值不稳定。[机器学习模拟器](@entry_id:751586)，特别是基于[神经网](@entry_id:276355)络的模拟器，可以通过[自动微分](@entry_id:144512)（AD）技术以几乎与单次前向评估相当的计算成本，提供精确到[机器精度](@entry_id:756332)的解析梯度。

这种能力是革命性的。它使得HMC等强大的梯度基[采样方法](@entry_id:141232)可以被应用于原本棘手的模拟基推断问题。当然，这也对模拟器提出了新的要求：不仅函数值的预测要准确，其梯度的预测也必须准确。任何在梯度预测中的系统性误差都会破坏HMC的[能量守恒](@entry_id:140514)性，导致采样接受率下降和[采样效率](@entry_id:754496)降低。因此，在训练模拟器时，可能需要将梯度匹配作为损失函数的一部分，以确保其不仅是一个好的函数逼近器，也是一个好的梯度逼近器 [@problem_id:3478330] [@problem_id:3478367]。

### 闭环：模拟器驱动的实验设计

模拟器不仅可以被动地分析现有数据，还可以主动地指导未来的科学活动。通过利用模拟器自身的不确定性量化能力，我们可以设计出更智能的[数据采集](@entry_id:273490)策略，无论是 для 模拟训练还是真实观测。

#### 模拟器训练的主动学习

[数值模拟](@entry_id:137087)是昂贵的。与其在[参数空间](@entry_id:178581)中进行网格状的蛮力模拟，一个更智能的策略是让模拟器自己告诉我们，在哪个参数点运行下一次模拟会带来最大的[信息增益](@entry_id:262008)。这就是主动学习（Active Learning）或[贝叶斯实验设计](@entry_id:169377)（Bayesian Experimental Design）的思想。

一个具体的目标可能是，选择下一个训练点 $\boldsymbol{\theta}_{\text{new}}$，使得在加入这个点后，预期的[宇宙学参数](@entry_id:161338)后验不确定性最小化。例如，我们可以寻求最大化对[后验协方差矩阵](@entry_id:753631)迹（A-optimality）或[行列式](@entry_id:142978)（D-optimality）的预期改进。利用[高斯过程模拟器](@entry_id:749754)，我们可以解析地计算出，在某个候选点 $\boldsymbol{\theta}_c$ 添加一个新训练点后，模拟器在其他任意点 $\boldsymbol{\theta}_\star$ 处的预测[方差](@entry_id:200758)会减少多少。这个[方差](@entry_id:200758)的减少量，可以通过费雪信息矩阵传播，最终转化为对参数后验[方差](@entry_id:200758)的预期减少量的估计。这个估计值可以作为一个“采集分数”（acquisition score），用于在所有候选点中进行选择。通过迭代地选择具有最高分数的点进行新的模拟并更新模拟器，我们可以用最少的计算资源构建出一个在最关键参数区域最精确的模拟器 [@problem_id:3478366]。

#### 混合模拟：结合物理模型与数据驱动校准

在许多情况下，我们拥有一个快速但可能不完整的解析或半解析物理模型。与其用一个纯粹的黑箱[机器学习模型](@entry_id:262335)完全取代它，一种更强大的方法是构建[混合模型](@entry_id:266571)。在这种[范式](@entry_id:161181)中，解析模型提供了理论的主干，而模拟器则被用来学习和校准解析模型未能捕捉的复杂、[非线性](@entry_id:637147)的修正项。

一个很好的例子是[弱引力透镜](@entry_id:158468)协[方差](@entry_id:200758)的建模。其大部分（高斯部分）可以通过基于[林伯近似](@entry_id:751282)（Limber approximation）的解析积分快速计算。然而，存在一些重要的非高斯贡献，如超样本协[方差](@entry_id:200758)（Supersample Covariance, SSC），它源于观测贴片内的模式与更大尺度模式的耦合，这很难从第一性原理精确计算。在这种情况下，我们可以使用昂贵但精确的射线追踪（Ray-tracing）模拟来生成SSC的“真值”，然后训练一个简单的机器学习模型（甚至是一个简单的[幂律](@entry_id:143404)拟合）来学习SSC如何依赖于宇宙学和巡天参数。最终的总[协方差模型](@entry_id:165727)就是快速解析部分和数据驱动校准部分的和。这种混合方法结合了物理模型的洞察力和数据驱动模型的灵活性，是当前宇宙学分析中一种非常实用和强大的技术 [@problem_id:3478389]。

### 结论

本章的旅程揭示了[机器学习模拟器](@entry_id:751586)在[现代宇宙学](@entry_id:752086)中扮演的多方面角色。我们已经看到，它们远不止是加速计算的工具。它们是复杂的统计模型，其设计必须深植于我们对可观测量物理结构、对称性和内在约束的理解中。它们是严谨的不确定性量化框架的核心，能够帮助我们建模和传播从模拟器自身误差到不同分析流程间系统差异的各种不确定性。它们是新一代[贝叶斯推断](@entry_id:146958)方法的引擎，通过直接模[拟似然](@entry_id:169341)和后验或提供精确梯度，使得过去无法想象的分析成为可能。最后，通过主动学习和实验设计，它们甚至可以闭合“理论-观测”的循环，主动指导我们未来的研究方向。模拟器已经从一个边缘的便利工具，成长为连接理论、模拟和数据分析的不可或缺的桥梁，是推动[数值宇宙学](@entry_id:752779)前沿发展的关键力量。