{"hands_on_practices": [{"introduction": "标记相关函数（Marked Correlation Functions）是探测星系集合偏差的强大统计工具。与简单地计算星系对不同，它通过星系的次级属性（如年龄或光度）为每个星系对加权。这项练习将引导你推导在一个简单的线性模型下该统计量的具体形式，从而揭示星系属性与其环境之间的关联如何直接影响测量的成团信号 [@problem_id:3473125]。", "problem": "考虑一个统计上均匀和各向同性的物质过密度场 $\\delta(\\mathbf{x})$，它是一个高斯随机场，其均值为零，方差为 $\\sigma_{\\delta}^{2} \\equiv \\langle \\delta^{2} \\rangle$，两点相关函数为 $\\xi(r) \\equiv \\langle \\delta(\\mathbf{x}) \\delta(\\mathbf{x}+\\mathbf{r}) \\rangle$。星系是物质场的有偏示踪物，具有线性的、确定性的偏差，因此星系过密度为 $\\delta_{g}(\\mathbf{x}) = b \\, \\delta(\\mathbf{x})$，其中 $b$ 是一个常数线性偏差因子。设每个星系带有一个标量标记 $m(\\mathbf{x})$，其均值为 $\\bar{m} \\equiv \\langle m \\rangle$，方差为 $\\sigma_{m}^{2} \\equiv \\langle [m - \\bar{m}]^{2} \\rangle$。假设一个线性随机标记模型，其中标记通过相关系数与局域环境（由 $\\delta$ 测量）相关\n$$\n\\rho \\equiv \\frac{\\langle [m(\\mathbf{x}) - \\bar{m}] \\, \\delta(\\mathbf{x}) \\rangle}{\\sigma_{m} \\, \\sigma_{\\delta}} \\, ,\n$$\n并且在其他情况下是不相关的噪声。在与此相关性一致的最小线性投影下，写出\n$$\nm(\\mathbf{x}) = \\bar{m} + \\gamma \\, \\delta(\\mathbf{x}) + \\epsilon(\\mathbf{x}) \\, ,\n$$\n其中 $\\epsilon$ 独立于 $\\delta$，均值为零 $\\langle \\epsilon \\rangle = 0$，并被选择以使 $\\mathrm{corr}(m,\\delta) = \\rho$，这确定了 $\\gamma = \\rho \\, \\sigma_{m}/\\sigma_{\\delta}$。假设 $\\epsilon$ 在空间上不相关，即对于 $r > 0$，有 $\\langle \\epsilon(\\mathbf{x}) \\epsilon(\\mathbf{x}+\\mathbf{r}) \\rangle = 0$。\n\n在连续场近似中，将标记相关函数定义为标记加权的对数量比，\n$$\nM(r) \\equiv \\frac{\\left\\langle m(\\mathbf{x}) \\, m(\\mathbf{x}+\\mathbf{r}) \\, \\bigl[1+\\delta_{g}(\\mathbf{x})\\bigr] \\, \\bigl[1+\\delta_{g}(\\mathbf{x}+\\mathbf{r})\\bigr] \\right\\rangle}{\\bar{m}^{2} \\, \\bigl[1 + \\xi_{gg}(r)\\bigr]} \\, ,\n$$\n其中 $\\xi_{gg}(r) \\equiv \\langle \\delta_{g}(\\mathbf{x}) \\delta_{g}(\\mathbf{x}+\\mathbf{r}) \\rangle = b^{2} \\, \\xi(r)$ 是星系两点相关函数。\n\n从以上定义出发，利用高斯统计和 Wick 定理来截断连通高阶矩，推导出 $M(r)$ 在物质两点相关函数 $\\xi(r)$ 的主导阶下的闭合形式表达式。你的最终表达式必须用 $b$、$\\bar{m}$、$\\sigma_{\\delta}$、$\\sigma_{m}$、$\\rho$ 和 $\\xi(r)$ 显式写出。将答案表示为单个解析表达式；不需要进行数值计算。", "solution": "该问题要求推导标记相关函数 $M(r)$ 在物质两点相关函数 $\\xi(r)$ 的主导阶下的表达式。标记相关函数定义为\n$$\nM(r) \\equiv \\frac{\\left\\langle m(\\mathbf{x}) \\, m(\\mathbf{x}+\\mathbf{r}) \\, \\bigl[1+\\delta_{g}(\\mathbf{x})\\bigr] \\, \\bigl[1+\\delta_{g}(\\mathbf{x}+\\mathbf{r})\\bigr] \\right\\rangle}{\\bar{m}^{2} \\, \\bigl[1 + \\xi_{gg}(r)\\bigr]}\n$$\n让我们将此表达式的分子记为 $N(r)$，分母记为 $D(r)$。任务是通过代入给定的星系过密度 $\\delta_g(\\mathbf{x})$ 和标记 $m(\\mathbf{x})$ 的模型来计算 $N(r)$，然后计算期望值。\n\n提供的模型是：\n1.  星系过密度：$\\delta_{g}(\\mathbf{x}) = b \\, \\delta(\\mathbf{x})$\n2.  标量标记：$m(\\mathbf{x}) = \\bar{m} + \\gamma \\, \\delta(\\mathbf{x}) + \\epsilon(\\mathbf{x})$\n\n让我们用下标 $1$ 表示位置 $\\mathbf{x}$ 处的场，用下标 $2$ 表示位置 $\\mathbf{x}+\\mathbf{r}$ 处的场。因此，$\\delta_1 = \\delta(\\mathbf{x})$，$\\delta_2 = \\delta(\\mathbf{x}+\\mathbf{r})$，依此类推。\n\n分子是 $N(r) = \\langle m_1 m_2 (1+\\delta_{g1})(1+\\delta_{g2}) \\rangle$。\n代入模型，我们得到：\n$$\nN(r) = \\left\\langle (\\bar{m} + \\gamma\\delta_1 + \\epsilon_1)(\\bar{m} + \\gamma\\delta_2 + \\epsilon_2)(1 + b\\delta_1)(1 + b\\delta_2) \\right\\rangle\n$$\n期望是针对高斯随机场 $\\delta$ 和噪声场 $\\epsilon$ 的分布来计算的。我们将使用的关键性质是：\n-   $\\langle\\delta\\rangle = 0$, $\\langle\\delta_1\\delta_2\\rangle = \\xi(r)$，以及 $\\langle\\delta_1^2\\rangle = \\langle\\delta_2^2\\rangle = \\sigma_\\delta^2$。\n-   $\\langle\\epsilon\\rangle = 0$。\n-   $\\delta$ 和 $\\epsilon$ 是独立的，所以对于任何整数 $k,l$，有 $\\langle \\delta^k \\epsilon^l \\rangle = \\langle \\delta^k \\rangle \\langle \\epsilon^l \\rangle$。这意味着任何包含单个 $\\epsilon$ 因子并乘以任意数量 $\\delta$ 场的项的期望值都为零，例如，$\\langle \\delta_1 \\epsilon_1 \\rangle = \\langle\\delta_1\\rangle\\langle\\epsilon_1\\rangle = 0$。\n-   对于 $r > 0$，有 $\\langle\\epsilon_1\\epsilon_2\\rangle = 0$。我们计算 $M(r)$ 是针对间距 $r>0$ 的情况。\n-   对于高斯场 $\\delta$，所有奇数阶相关函数都为零（例如，$\\langle\\delta_1\\delta_2\\delta_1\\rangle=0$）。偶数阶相关函数可以使用 Wick 定理展开。\n\n为了简化计算，让我们用标记场的分数过密度 $\\delta_m = (m-\\bar{m})/\\bar{m} = (\\gamma\\delta+\\epsilon)/\\bar{m}$ 来表示分子。\n$$\nN(r) = \\bar{m}^2 \\left\\langle (1 + \\delta_{m1})(1 + \\delta_{m2})(1 + \\delta_{g1})(1 + \\delta_{g2}) \\right\\rangle\n$$\n展开期望内的乘积：\n$$\n\\left\\langle (1 + \\delta_{m1} + \\delta_{m2} + \\delta_{m1}\\delta_{m2}) (1 + \\delta_{g1} + \\delta_{g2} + \\delta_{g1}\\delta_{g2}) \\right\\rangle\n$$\n我们逐项计算期望，只保留非零项。非零项是那些具有偶数个场（或零个）的项。\n\\begin{enumerate}\n    \\item $\\langle 1 \\rangle = 1$。\n    \\item 所有含单个场的项，如 $\\langle\\delta_{m1}\\rangle$、$\\langle\\delta_{g2}\\rangle$，都为零。\n    \\item 两个场的交叉项：$\\langle \\delta_{m1}\\delta_{g1} \\rangle$, $\\langle \\delta_{m1}\\delta_{g2} \\rangle$, $\\langle \\delta_{m1}\\delta_{m2} \\rangle$ 等。\n    \\item 四个场的项：$\\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle$ 等。\n\\end{enumerate}\n让我们计算必要的相关项：\n-   $\\langle \\delta_{g1}\\delta_{g2} \\rangle = \\langle (b\\delta_1)(b\\delta_2) \\rangle = b^2\\langle\\delta_1\\delta_2\\rangle = b^2\\xi(r)$。\n-   $\\langle \\delta_{m1}\\delta_{m2} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} \\frac{\\gamma\\delta_2+\\epsilon_2}{\\bar{m}} \\rangle = \\frac{1}{\\bar{m}^2} \\left( \\gamma^2\\langle\\delta_1\\delta_2\\rangle + \\gamma\\langle\\delta_1\\epsilon_2\\rangle + \\gamma\\langle\\epsilon_1\\delta_2\\rangle + \\langle\\epsilon_1\\epsilon_2\\rangle \\right) = \\frac{\\gamma^2}{\\bar{m}^2}\\xi(r)$。\n-   $\\langle \\delta_{m1}\\delta_{g2} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} (b\\delta_2) \\rangle = \\frac{b\\gamma}{\\bar{m}}\\langle\\delta_1\\delta_2\\rangle = \\frac{b\\gamma}{\\bar{m}}\\xi(r)$。类似地，$\\langle\\delta_{m2}\\delta_{g1}\\rangle = \\frac{b\\gamma}{\\bar{m}}\\xi(r)$。\n-   $\\langle \\delta_{m1}\\delta_{g1} \\rangle = \\langle \\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}} (b\\delta_1) \\rangle = \\frac{b\\gamma}{\\bar{m}}\\langle\\delta_1^2\\rangle = \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}}$。这是一个单点相关，是一个不依赖于 $r$ 的常数。\n\n完全展开，只保留期望值非零的项：\n$$\n\\langle \\dots \\rangle = \\langle 1 + \\delta_{g1}\\delta_{g2} + \\delta_{m1}\\delta_{m2} + \\delta_{m1}\\delta_{g1} + \\delta_{m1}\\delta_{g2} + \\delta_{m2}\\delta_{g1} + \\delta_{m2}\\delta_{g2} + \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} + \\dots \\rangle\n$$\n对于高斯场，所有像 $\\langle \\delta_{m1}\\delta_{g1}\\delta_{g2}\\rangle$ 这样的三点相关函数都为零。唯一剩下的项是四点项。\n-   $\\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle = \\langle (\\frac{\\gamma\\delta_1+\\epsilon_1}{\\bar{m}}) (\\frac{\\gamma\\delta_2+\\epsilon_2}{\\bar{m}}) (b\\delta_1)(b\\delta_2) \\rangle = \\frac{b^2\\gamma^2}{\\bar{m}^2} \\langle \\delta_1^2 \\delta_2^2 \\rangle$。使用 Wick 定理：\n$$\n\\langle \\delta_1^2 \\delta_2^2 \\rangle = \\langle\\delta_1\\delta_1\\delta_2\\delta_2\\rangle = \\langle\\delta_1\\delta_1\\rangle\\langle\\delta_2\\delta_2\\rangle + 2\\langle\\delta_1\\delta_2\\rangle^2 = \\sigma_\\delta^2 \\sigma_\\delta^2 + 2\\xi(r)^2 = \\sigma_\\delta^4 + 2\\xi(r)^2\n$$\n问题要求结果到 $\\xi(r)$ 的主导阶。因此，我们忽略 $2\\xi(r)^2$ 这一项，因为它是二阶项。\n$\\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle \\approx \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2}$。\n\n现在，对分子的期望值的所有贡献求和：\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx 1 + \\langle \\delta_{g1}\\delta_{g2} \\rangle + \\langle \\delta_{m1}\\delta_{m2} \\rangle + \\langle \\delta_{m1}\\delta_{g1} \\rangle + \\langle \\delta_{m2}\\delta_{g2} \\rangle + \\langle \\delta_{m1}\\delta_{g2} \\rangle + \\langle \\delta_{m2}\\delta_{g1} \\rangle + \\langle \\delta_{m1}\\delta_{m2}\\delta_{g1}\\delta_{g2} \\rangle\n$$\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx 1 + b^2\\xi(r) + \\frac{\\gamma^2}{\\bar{m}^2}\\xi(r) + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} + \\frac{b\\gamma}{\\bar{m}}\\xi(r) + \\frac{b\\gamma}{\\bar{m}}\\xi(r) + \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2}\n$$\n合并常数项和与 $\\xi(r)$ 成正比的项：\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx \\left( 1 + \\frac{2b\\gamma\\sigma_\\delta^2}{\\bar{m}} + \\frac{b^2\\gamma^2\\sigma_\\delta^4}{\\bar{m}^2} \\right) + \\left( b^2 + \\frac{2b\\gamma}{\\bar{m}} + \\frac{\\gamma^2}{\\bar{m}^2} \\right) \\xi(r)\n$$\n将括号中的项识别为完全平方：\n$$\n\\frac{N(r)}{\\bar{m}^2} \\approx \\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r)\n$$\n分母是 $D(r) = \\bar{m}^2(1+\\xi_{gg}(r)) = \\bar{m}^2(1+b^2\\xi(r))$。\n因此，标记相关函数是：\n$$\nM(r) = \\frac{N(r)}{D(r)} \\approx \\frac{\\bar{m}^2 \\left[ \\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r) \\right]}{\\bar{m}^2 (1+b^2\\xi(r))} = \\frac{\\left( 1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} \\right)^2 + \\left( b + \\frac{\\gamma}{\\bar{m}} \\right)^2 \\xi(r)}{1+b^2\\xi(r)}\n$$\n最后，我们代入 $\\gamma = \\rho \\frac{\\sigma_m}{\\sigma_\\delta}$：\n分子常数部分的项变为：\n$$\n1 + \\frac{b\\gamma\\sigma_\\delta^2}{\\bar{m}} = 1 + \\frac{b}{\\bar{m}} \\left(\\rho \\frac{\\sigma_m}{\\sigma_\\delta}\\right) \\sigma_\\delta^2 = 1 + \\frac{b\\rho\\sigma_m\\sigma_\\delta}{\\bar{m}}\n$$\n乘以 $\\xi(r)$ 的项变为：\n$$\nb + \\frac{\\gamma}{\\bar{m}} = b + \\frac{1}{\\bar{m}} \\left(\\rho \\frac{\\sigma_m}{\\sigma_\\delta}\\right) = b \\left( 1 + \\frac{\\rho\\sigma_m}{b\\bar{m}\\sigma_\\delta} \\right)\n$$\n所以 $\\xi(r)$ 的分子系数是 $b^2 \\left( 1 + \\frac{\\rho\\sigma_m}{b\\bar{m}\\sigma_\\delta} \\right)^2$。\n将这些代入 $M(r)$ 的表达式中：\n$$\nM(r) = \\frac{\\left( 1 + \\frac{b\\rho\\sigma_m\\sigma_\\delta}{\\bar{m}} \\right)^2 + b^2\\left( 1 + \\frac{\\rho\\sigma_m}{b\\bar{m}\\sigma_\\delta} \\right)^2 \\xi(r)}{1+b^2\\xi(r)}\n$$\n这是 $M(r)$ 在 $\\xi(r)$ 主导阶下的最终闭合形式表达式，与高阶相关函数的截断一致。", "answer": "$$\n\\boxed{\\frac{\\left( 1 + \\frac{b \\rho \\sigma_{m} \\sigma_{\\delta}}{\\bar{m}} \\right)^{2} + b^{2} \\left( 1 + \\frac{\\rho \\sigma_{m}}{b \\bar{m} \\sigma_{\\delta}} \\right)^{2} \\xi(r)}{1 + b^{2} \\xi(r)}}\n$$", "id": "3473125"}, {"introduction": "在真实的巡天观测中，许多选择效应会产生类似于集合偏差的成团信号，这使得区分物理效应和观测系统误差成为一项挑战。这项练习要求你像观测者一样思考，剖析关于颜色、恒星形成率的选择，甚至是光纤碰撞等技术限制，如何与大尺度环境产生关联，并系统地改变测量的相关函数。这是一项识别和理解物理测量中潜在污染源的关键练习 [@problem_id:3473119]。", "problem": "考虑一个假设的光谱巡天，其目标是平坦、物质主导的低红移宇宙学模型中的一个质量有限星系样本。假设在母体、完全完备的星表目录中，不存在真实的星系形成偏倚：在固定的暗晕质量 $M$ 下，星系的占据数和成团性仅依赖于 $M$ 而非次级暗晕属性，因此在足够大的尺度上，星系过密度场 $g(\\mathbf{x})$ 服从线性偏倚 $g(\\mathbf{x}) \\approx b_{g} \\,\\delta(\\mathbf{x})$，其中 $\\delta(\\mathbf{x})$ 是物质过密度，$b_{g}$ 是质量有限样本的线性星系偏倚。令 $n(\\mathbf{x})$ 为真实的星系数量密度场，其均值为 $\\bar{n}$，并定义 $g(\\mathbf{x}) \\equiv n(\\mathbf{x})/\\bar{n} - 1$。观测到的星表目录受到额外的选择效应影响，这些效应可以用一个完备性场 $c(\\mathbf{x}) \\in [0,1]$ 来描述，使得观测到的数量密度为 $n_{\\mathrm{obs}}(\\mathbf{x}) = c(\\mathbf{x})\\,n(\\mathbf{x})$。定义观测到的过密度为 $g_{\\mathrm{obs}}(\\mathbf{x}) \\equiv n_{\\mathrm{obs}}(\\mathbf{x})/\\bar{n}_{\\mathrm{obs}} - 1$，其中 $\\bar{n}_{\\mathrm{obs}} \\equiv \\langle n_{\\mathrm{obs}} \\rangle$。两点相关函数 (2PCF) 为 $\\xi(r) \\equiv \\langle g(\\mathbf{x})\\,g(\\mathbf{x}+\\mathbf{r}) \\rangle$，类似地，$\\xi_{\\mathrm{obs}}(r) \\equiv \\langle g_{\\mathrm{obs}}(\\mathbf{x})\\,g_{\\mathrm{obs}}(\\mathbf{x}+\\mathbf{r}) \\rangle$。\n\n假设在尺度 $r \\gg R$ 上，完备性涨落 $s(\\mathbf{x}) \\equiv c(\\mathbf{x})/\\langle c \\rangle - 1$ 可以通过 $s(\\mathbf{x}) \\approx \\beta \\,\\delta_{R}(\\mathbf{x})$ 与一个平滑后的环境场 $\\delta_{R}(\\mathbf{x})$ 线性相关，其中 $|\\beta| \\ll 1$ 且平滑尺度 $R$ 固定。平滑后的场 $\\delta_{R}(\\mathbf{x})$ 在大尺度上与 $\\delta(\\mathbf{x})$ 相关。考虑以下四种应用于定义来自同一母体质量有限星表的子样本的观测切割：\n\n(1) 一个静止标架颜色切割，用于在固定恒星质量下选择淬灭/红色星系，其中淬灭星系比例 $f_{Q}(\\delta_{R})$ 在固定质量下随大尺度过密度 $\\delta_{R}$ 增加而增加。\n\n(2) 一个比恒星形成率 (sSFR) 阈值，用于在固定恒星质量下仅选择恒星形成星系，其中恒星形成星系比例 $f_{\\mathrm{SF}}(\\delta_{R})$ 在固定质量下随 $\\delta_{R}$ 增加而减小。\n\n(3) 一个表面亮度限制，使得平均有效表面亮度低于固定阈值的星系无法被探测到；假设在固定质量下，低表面亮度星系的比例 $f_{\\mathrm{LSB}}(\\delta_{R})$ 朝着低密度区域增加（即随 $\\delta_{R}$ 增加而减小）。\n\n(4) 一个光纤分配约束（“光纤碰撞”），它阻止在角距离 $\\theta_{\\mathrm{fc}}$ 内分配两根光纤，导致在 $\\theta \\lesssim \\theta_{\\mathrm{fc}}$ 内的星系对中损失一个成员。设巡天红移处对应的共动投影尺度为 $r_{\\mathrm{fc}}$。\n\n从上述定义和线性偏倚、大尺度极限出发，推断 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间的非零协方差如何相对于 $\\xi(r)$ 修改 $\\xi_{\\mathrm{obs}}(r)$，既包括在大尺度 $r \\gg R$ 上的情况，也包括在适用的小尺度 $r \\lesssim r_{\\mathrm{fc}}$ 上的情况。然后，选择最能总结每种切割对观测到的成团性的净定性影响的选项，从大尺度偏倚移动的符号和任何独有的小尺度行为方面进行描述：\n\nA. 选择红色/淬灭星系使得 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 正相关，从而增加了大尺度成团性幅度；选择高 sSFR 星系使得 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 反相关，从而减小了大尺度成团性幅度；遗漏低表面亮度星系使得 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 正相关，从而增加了大尺度成团性幅度；光纤碰撞优先移除了拥挤区域中的近邻星系，因此在 $r \\lesssim r_{\\mathrm{fc}}$ 处压低了 $\\xi_{\\mathrm{obs}}(r)$，并可能通过使 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 反相关而轻微减小大尺度幅度。\n\nB. 选择红色/淬灭星系减小了大尺度成团性幅度；选择高 sSFR 星系增加了大尺度成团性幅度；遗漏低表面亮度星系减小了大尺度成团性幅度；光纤碰撞通过优先保留孤立星系来增强小尺度成团性。\n\nC. 所有四种效应仅对数量密度的整体归一化和散粒噪声有贡献；如果使用随机星表，2PCF $\\xi_{\\mathrm{obs}}(r)$ 在所有尺度上仍然是 $\\xi(r)$ 的无偏估计。\n\nD. 光纤碰撞只影响红移空间各向异性，而不影响位形空间 2PCF；颜色、sSFR 和表面亮度切割只修改单暗晕项，不能改变 $r \\gg R$ 上的大尺度偏倚。\n\n选择唯一的最佳选项。", "solution": "用户希望分析各种观测选择效应对测量的星系两点相关函数 (2PCF) 的影响。我必须首先验证问题陈述，如果有效，则推导解决方案并评估给出的选项。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   宇宙学：平坦、物质主导、低红移。\n-   母体星表：质量有限、完全完备、无真实星系形成偏倚（在固定暗晕质量 $M$ 下，星系属性仅依赖于 $M$）。\n-   真实星系过密度：$g(\\mathbf{x}) \\equiv n(\\mathbf{x})/\\bar{n} - 1$。\n-   真实线性偏倚：在大尺度上 $g(\\mathbf{x}) \\approx b_{g} \\,\\delta(\\mathbf{x})$，其中 $\\delta(\\mathbf{x})$ 是物质过密度。\n-   观测数量密度：$n_{\\mathrm{obs}}(\\mathbf{x}) = c(\\mathbf{x})\\,n(\\mathbf{x})$，其中 $c(\\mathbf{x}) \\in [0,1]$ 是完备性场。\n-   观测过密度：$g_{\\mathrm{obs}}(\\mathbf{x}) \\equiv n_{\\mathrm{obs}}(\\mathbf{x})/\\bar{n}_{\\mathrm{obs}} - 1$，其中 $\\bar{n}_{\\mathrm{obs}} \\equiv \\langle n_{\\mathrm{obs}} \\rangle$。\n-   两点相关函数 (2PCF)：$\\xi(r) \\equiv \\langle g(\\mathbf{x})\\,g(\\mathbf{x}+\\mathbf{r}) \\rangle$（真实的）和 $\\xi_{\\mathrm{obs}}(r) \\equiv \\langle g_{\\mathrm{obs}}(\\mathbf{x})\\,g_{\\mathrm{obs}}(\\mathbf{x}+\\mathbf{r}) \\rangle$（观测的）。\n-   完备性涨落：$s(\\mathbf{x}) \\equiv c(\\mathbf{x})/\\langle c \\rangle - 1$。\n-   完备性-环境相关性：在大尺度（$r \\gg R$）上 $s(\\mathbf{x}) \\approx \\beta \\,\\delta_{R}(\\mathbf{x})$，对于一个平滑后的场 $\\delta_{R}(\\mathbf{x})$ 且 $|\\beta| \\ll 1$。\n-   观测切割：\n    1.  红色/淬灭星系选择：淬灭星系比例 $f_{Q}(\\delta_{R})$ 随 $\\delta_{R}$ 增加。\n    2.  高 sSFR 选择：恒星形成星系比例 $f_{\\mathrm{SF}}(\\delta_{R})$ 随 $\\delta_{R}$ 减小。\n    3.  表面亮度限制：遗漏的低表面亮度星系比例 $f_{\\mathrm{LSB}}(\\delta_{R})$ 随 $\\delta_{R}$ 减小。\n    4.  光纤碰撞：角距离 $\\theta \\lesssim \\theta_{\\mathrm{fc}}$（共动尺度 $r_{\\mathrm{fc}}$）的星系对中损失一个星系。\n\n**步骤2：使用提取的已知条件进行验证**\n问题陈述在科学上是合理的、定义明确且客观的。它基于宇宙学中大尺度结构分析的标准框架。线性偏倚、2PCF 和观测完备性等概念都是标准概念。所描述的特定选择切割是真实光谱巡天中众所周知的系统误差。“无真实形成偏倚”的假设提供了一个清晰的基线，可以用来研究由选择效应引起的“表观”形成偏倚，这是一种标准的教学和研究方法。数学表述清晰且自洽。没有矛盾、模糊或事实错误。该问题是观测宇宙学中一个有效且表述良好的问题。\n\n**步骤3：结论和行动**\n问题有效。我将继续进行推导和求解。\n\n### 推导\n\n目标是在完备性场 $c(\\mathbf{x})$ 的影响下，将观测到的 2PCF $\\xi_{\\mathrm{obs}}(r)$ 与真实的 2PCF $\\xi(r)$ 联系起来。\n\n观测到的星系过密度定义为 $g_{\\mathrm{obs}}(\\mathbf{x}) = \\frac{n_{\\mathrm{obs}}(\\mathbf{x})}{\\bar{n}_{\\mathrm{obs}}} - 1$。\n让我们用涨落 $g(\\mathbf{x})$ 和 $s(\\mathbf{x})$ 来表示 $n_{\\mathrm{obs}}$ 和 $\\bar{n}_{\\mathrm{obs}}$。\n$n(\\mathbf{x}) = \\bar{n}(1+g(\\mathbf{x}))$\n$c(\\mathbf{x}) = \\bar{c}(1+s(\\mathbf{x}))$，其中 $\\bar{c} = \\langle c \\rangle$。\n观测到的数量密度是 $n_{\\mathrm{obs}}(\\mathbf{x}) = c(\\mathbf{x})n(\\mathbf{x}) = \\bar{c}\\bar{n}(1+s(\\mathbf{x}))(1+g(\\mathbf{x}))$。\n平均观测数量密度是 $\\bar{n}_{\\mathrm{obs}} = \\langle n_{\\mathrm{obs}}(\\mathbf{x}) \\rangle = \\langle \\bar{c}\\bar{n}(1+s)(1+g) \\rangle = \\bar{c}\\bar{n}(1 + \\langle s \\rangle + \\langle g \\rangle + \\langle sg \\rangle)$。根据定义 $\\langle s \\rangle = 0$ 和 $\\langle g \\rangle = 0$，我们有 $\\bar{n}_{\\mathrm{obs}} = \\bar{c}\\bar{n}(1 + \\langle sg \\rangle)$。\n\n现在，将这些代入 $g_{\\mathrm{obs}}(\\mathbf{x})$ 的定义中：\n$$1 + g_{\\mathrm{obs}}(\\mathbf{x}) = \\frac{n_{\\mathrm{obs}}(\\mathbf{x})}{\\bar{n}_{\\mathrm{obs}}} = \\frac{\\bar{c}\\bar{n}(1+s(\\mathbf{x}))(1+g(\\mathbf{x}))}{\\bar{c}\\bar{n}(1 + \\langle sg \\rangle)} = \\frac{1+g(\\mathbf{x})+s(\\mathbf{x})+s(\\mathbf{x})g(\\mathbf{x})}{1 + \\langle sg \\rangle}$$\n在小涨落极限下（$|g| \\ll 1, |s| \\ll 1$），我们可以展开分母 $(1 + \\langle sg \\rangle)^{-1} \\approx 1 - \\langle sg \\rangle$，并忽略涨落中的二阶及更高阶项，例如 $s(\\mathbf{x})g(\\mathbf{x})$ 和 $\\langle sg \\rangle$。\n$$g_{\\mathrm{obs}}(\\mathbf{x}) \\approx g(\\mathbf{x}) + s(\\mathbf{x})$$\n这个近似是分析系统效应大尺度影响的标准方法。\n\n观测到的 2PCF 是 $\\xi_{\\mathrm{obs}}(r) = \\langle g_{\\mathrm{obs}}(\\mathbf{x})g_{\\mathrm{obs}}(\\mathbf{x}+\\mathbf{r}) \\rangle$。使用该近似：\n$$\\xi_{\\mathrm{obs}}(r) \\approx \\langle (g(\\mathbf{x})+s(\\mathbf{x}))(g(\\mathbf{x}+\\mathbf{r})+s(\\mathbf{x}+\\mathbf{r})) \\rangle$$\n$$\\xi_{\\mathrm{obs}}(r) \\approx \\langle g(\\mathbf{x})g(\\mathbf{x}+\\mathbf{r}) \\rangle + \\langle s(\\mathbf{x})s(\\mathbf{x}+\\mathbf{r}) \\rangle + 2\\langle g(\\mathbf{x})s(\\mathbf{x}+\\mathbf{r}) \\rangle $$\n$$\\xi_{\\mathrm{obs}}(r) \\approx \\xi(r) + \\xi_{ss}(r) + 2\\xi_{gs}(r)$$\n其中 $\\xi_{ss}$ 是完备性场的自相关函数，$\\xi_{gs}$ 是星系场和完备性场之间的互相关函数。\n\n在大尺度上（$r \\gg R$），我们有关系式 $g(\\mathbf{x}) \\approx b_g \\delta(\\mathbf{x})$ 和 $s(\\mathbf{x}) \\approx \\beta \\delta_R(\\mathbf{x})$。在这些尺度上，平滑后的场 $\\delta_R(\\mathbf{x})$ 几乎与未平滑的场 $\\delta(\\mathbf{x})$ 相同。因此，我们可以近似为 $s(\\mathbf{x}) \\approx \\beta \\delta(\\mathbf{x})$。\n将这些代入 $g_{\\mathrm{obs}}(\\mathbf{x})$ 的表达式中：\n$$g_{\\mathrm{obs}}(\\mathbf{x}) \\approx b_g \\delta(\\mathbf{x}) + \\beta \\delta(\\mathbf{x}) = (b_g + \\beta)\\delta(\\mathbf{x})$$\n这表明观测到的星系样本以一个修正后的有效线性偏倚 $b_{\\mathrm{obs}} \\approx b_g + \\beta$ 来追踪物质密度。\n\n因此，大尺度上的观测 2PCF 与物质 2PCF $\\xi_m(r) \\equiv \\langle \\delta(\\mathbf{x})\\delta(\\mathbf{x}+\\mathbf{r}) \\rangle$ 的关系为：\n$$\\xi_{\\mathrm{obs}}(r) \\approx (b_g + \\beta)^2 \\xi_m(r)$$\n真实的星系 2PCF 是 $\\xi(r) \\approx b_g^2 \\xi_m(r)$。\n观测 2PCF 与真实 2PCF 的比值为：\n$$\\frac{\\xi_{\\mathrm{obs}}(r)}{\\xi(r)} \\approx \\frac{(b_g + \\beta)^2}{b_g^2} = \\left(1 + \\frac{\\beta}{b_g}\\right)^2 \\approx 1 + 2\\frac{\\beta}{b_g}$$\n最后一个近似在 $|\\beta| \\ll b_g$ 时成立。关键结果是，成团性幅度变化的符号由 $\\beta$ 的符号决定。正的 $\\beta$ 意味着完备性与环境密度正相关，这会增加观测到的成团性。负的 $\\beta$ 意味着完备性与密度反相关，这会减小观测到的成团性。\n\n现在我们分析四种切割中的每一种：\n\n**1. 红色/淬灭星系选择：**\n-   该子样本的完备性场 $c(\\mathbf{x})$ 是淬灭比例，$c(\\mathbf{x}) = f_{Q}(\\delta_{R}(\\mathbf{x}))$。\n-   已知 $f_{Q}$ 随 $\\delta_{R}$ 增加而增加。因此，$c(\\mathbf{x})$ 在更稠密的区域更高。\n-   这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在正相关，即 $\\beta > 0$。\n-   因此，观测到的大尺度成团性幅度增加。\n\n**2. 高 sSFR（恒星形成）星系选择：**\n-   完备性场 $c(\\mathbf{x})$ 是恒星形成比例，$c(\\mathbf{x}) = f_{\\mathrm{SF}}(\\delta_{R}(\\mathbf{x}))$。\n-   已知 $f_{\\mathrm{SF}}$ 随 $\\delta_{R}$ 增加而减小。因此，$c(\\mathbf{x})$ 在更稠密的区域更低。\n-   这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在反相关，即 $\\beta < 0$。\n-   因此，观测到的大尺度成团性幅度减小。\n\n**3. 遗漏低表面亮度 (LSB) 星系：**\n-   这是一种不完备性效应。完备性 $c(\\mathbf{x})$ 是被探测到的星系的比例，即*不是* LSB 星系的比例。所以，$c(\\mathbf{x}) = 1 - f_{\\mathrm{LSB}}(\\delta_{R}(\\mathbf{x}))$。\n-   已知 LSB 比例 $f_{\\mathrm{LSB}}$ 随 $\\delta_{R}$ 增加而减小。\n-   因此，$c(\\mathbf{x}) = 1 - f_{\\mathrm{LSB}}(\\delta_{R}(\\mathbf{x}))$ 必然随 $\\delta_{R}$ 增加而增加。\n-   这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在正相关，即 $\\beta > 0$。\n-   因此，观测到的大尺度成团性幅度增加。\n\n**4. 光纤碰撞：**\n-   这种效应通过未能观测到近距对（$r \\lesssim r_{\\mathrm{fc}}$）中的一个星系而导致不完备性。\n-   **小尺度效应**：根据定义，我们正在移除小间距的星系对。2PCF 测量的是相对于随机分布的星系对的超额。移除星系对直接压低了这种超额。因此，对于 $r \\lesssim r_{\\mathrm{fc}}$，$\\xi_{\\mathrm{obs}}(r)$ 将被显著压低。\n-   **大尺度效应**：光纤碰撞更可能发生在星系数量密度高的区域，因为那里有更多的近距对。高星系密度区域与高质量密度区域（$\\delta_{R}$）相关。因此，完备性 $c(\\mathbf{x})$ 在更稠密的环境中更低。\n-   这意味着 $s(\\mathbf{x})$ 和 $\\delta_{R}(\\mathbf{x})$ 之间存在反相关，即 $\\beta < 0$。\n-   因此，观测到的大尺度成团性幅度减小。与小尺度上的压低相比，这种效应的幅度通常很小，因此常被描述为“轻微”减小。\n\n### 逐项分析\n\n**A. 选择红色/淬灭星系使得 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 正相关，从而增加了大尺度成团性幅度；选择高 sSFR 星系使得 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 反相关，从而减小了大尺度成团性幅度；遗漏低表面亮度星系使得 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 正相关，从而增加了大尺度成团性幅度；光纤碰撞优先移除了拥挤区域中的近邻星系，因此在 $r \\lesssim r_{\\mathrm{fc}}$ 处压低了 $\\xi_{\\mathrm{obs}}(r)$，并可能通过使 $s(\\mathbf{x})$ 与 $\\delta_{R}(\\mathbf{x})$ 反相关而轻微减小大尺度幅度。**\n-   这个陈述正确地指出了：\n    -   红色星系的成团性增加（$\\beta > 0$）。\n    -   高 sSFR 星系的成团性减小（$\\beta < 0$）。\n    -   因遗漏 LSB 星系导致的成团性增加（$\\beta > 0$）。\n    -   光纤碰撞的双重效应：在小尺度（$r \\lesssim r_\\mathrm{fc}$）上对 $\\xi_{\\mathrm{obs}}(r)$ 的强烈压低，以及大尺度幅度的轻微减小（$\\beta < 0$）。\n-   该选项的所有部分都与我们的推导一致。\n-   **结论：正确。**\n\n**B. 选择红色/淬灭星系减小了大尺度成团性幅度；选择高 sSFR 星系增加了大尺度成团性幅度；遗漏低表面亮度星系减小了大尺度成团性幅度；光纤碰撞通过优先保留孤立星系来增强小尺度成团性。**\n-   前三种切割效应的符号都错了。选择红色星系增加成团性，选择高 sSFR 星系减小成团性，遗漏 LSB 星系增加成团性。\n-   光纤碰撞压低而非增强小尺度成团性。\n-   **结论：错误。**\n\n**C. 所有四种效应仅对数量密度的整体归一化和散粒噪声有贡献；如果使用随机星表，2PCF $\\xi_{\\mathrm{obs}}(r)$ 在所有尺度上仍然是 $\\xi(r)$ 的无偏估计。**\n-   这从根本上是错误的。如推导所示，这些效应会修改有效偏倚 $b_{\\mathrm{obs}}$，从而改变相关函数的幅度。这是一种物理系统误差，而不是可以通过随机星表校正的巡天几何效应。偏倚的改变意味着 $\\xi_{\\mathrm{obs}}$ 确实是 $\\xi$ 的有偏估计。\n-   **结论：错误。**\n\n**D. 光纤碰撞只影响红移空间各向异性，而不影响位形空间 2PCF；颜色、sSFR 和表面亮度切割只修改单暗晕项，不能改变 $r \\gg R$ 上的大尺度偏倚。**\n-   第一部分是错误的。光纤碰撞是由于角距离造成的，它直接从三维星表中移除星系对，从而在小尺度上压低了位形空间 2PCF。\n-   第二部分是错误的。问题的核心是证明这些切割通过与大尺度环境相关，*确实*改变了大尺度偏倚 $b_g$（它参数化了双暗晕项），从而产生了一个有效偏倚 $b_{\\mathrm{obs}} \\approx b_g + \\beta$。\n-   **结论：错误。**", "answer": "$$\\boxed{A}$$", "id": "3473119"}, {"introduction": "这项练习是一个综合性的计算项目，它微缩了从理论到模拟分析的整个研究过程，让你能亲手实践。你将构建一个存在集合偏差的模拟宇宙，将暗晕属性与星系属性联系起来（年龄匹配），然后进行模拟分析，以探究这种偏差如何系统性地影响一个关键的宇宙学测量——重子声学振荡（BAO）尺度。这个练习将抽象的集合偏差概念与其对精确宇宙学的具体、且具有潜在风险的影响联系起来 [@problem_id:3473083]。", "problem": "您需要实现一个独立的数值实验，该实验基于子晕丰度匹配（SubHalo Abundance Matching, SHAM）和年龄匹配的原理，旨在量化色择样本中的星系形成偏倚如何影响推断出的位形空间重子声学振荡（Baryon Acoustic Oscillation, BAO）膨胀参数。该实验包括：生成一个包含最大环状速度的合成暗晕星表，为其分配形成红移，执行年龄匹配以将星系颜色与固定最大环状速度下的形成红移关联起来，构建位形空间中的星系两点相关函数模型，并通过拟合模板来提取BAO膨胀参数。您将计算由色择引起的BAO膨胀参数的偏移，作为每个测试用例的单个标量值。\n\n实验的基础理论包括：位形空间中两点相关函数 $\\xi(r)$ 的定义，即在共动距离 $r$ 处找到一个星系对的超额概率（相较于随机分布）；线性欧拉偏倚 $b$ 的概念，它在领头阶上通过 $\\delta_{\\mathrm{g}} = b \\,\\delta_{\\mathrm{m}}$ 关联了星系和物质的涨落；子晕丰度匹配的概念，它在固定的共动数密度下，通过一个单调代理量对暗晕进行排序；以及年龄匹配的概念，它在固定的暗晕代理量下，将次级星系属性与暗晕形成时间关联起来。BAO膨胀参数 $\\alpha_{\\mathrm{BAO}}$ 会重新缩放模板 $\\xi_{\\mathrm{m}}(\\alpha \\, r)$ 中的距离，而恢复出的 $\\alpha_{\\mathrm{BAO}}$ 中的偏倚反映了推断出的距离标度的系统性偏移。\n\n请严格按照指定的单位和形式，实现以下步骤和模型选择：\n\n1. 生成一个包含 $N$ 个暗晕的合成暗晕星表，每个暗晕具有最大环状速度 $V_{\\mathrm{max}}$ 和形成红移 $z_{\\mathrm{f}}$：\n   - 从截断的幂律概率密度 $p(V_{\\mathrm{max}}) \\propto V_{\\mathrm{max}}^{-\\beta}$ 中抽取 $V_{\\mathrm{max}}$，其中 $V_{\\mathrm{min}} \\le V_{\\mathrm{max}} \\le V_{\\mathrm{max,up}}$，$V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$，$V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$，$\\beta = 3.5$，且 $N = 10^5$。\n   - 从一个零均值、方差为 $\\sigma_{\\mathrm{env}}^2$ 的高斯分布中抽取一个大尺度环境代理量 $\\delta_{\\mathrm{env}}$，其中 $\\sigma_{\\mathrm{env}} = 0.8$。\n   - 定义形成红移为 $z_{\\mathrm{f}} = z_0 + s_1 \\ln\\!\\left(V_{\\mathrm{max}}/V_0\\right) + s_2 \\delta_{\\mathrm{env}} + \\epsilon$，其中 $z_0 = 1.5$，$V_0 = 200\\,\\mathrm{km/s}$，$s_1 = 0.2$，$s_2 = 0.6$，而 $\\epsilon$ 从一个零均值、方差为 $\\sigma_{z}^2$ 的高斯分布中抽取，其中 $\\sigma_{z} = 0.4$。\n   - 将形成红移归一化为一个无量纲量 $Z = \\left(z_{\\mathrm{f}} - \\overline{z_{\\mathrm{f}}}\\right)/\\sigma(z_{\\mathrm{f}})$，其中 $\\overline{z_{\\mathrm{f}}}$ 是样本均值，$\\sigma(z_{\\mathrm{f}})$ 是样本标准差。\n\n2. 在固定的 $V_{\\mathrm{max}}$ 下实现基于年龄匹配的SHAM颜色分配：\n   - 将暗晕按 $V_{\\mathrm{max}}$ 从 $V_{\\mathrm{min}}$ 到 $V_{\\mathrm{max,up}}$ 划分到宽度为 $\\Delta V = 20\\,\\mathrm{km/s}$ 的区间中。\n   - 在每个 $V_{\\mathrm{max}}$ 区间内，按 $z_{\\mathrm{f}}$ 降序排列暗晕，并将前 $f_{\\mathrm{red}}$ 的比例指定为“红”星系，其余为“蓝”星系（此问题中您只需要用到红星系的选择）。\n   - 计算红星系样本的平均归一化形成红移 $\\overline{Z}_{\\mathrm{red}}$，使用所有分箱中被指定为红色的暗晕进行计算。\n\n3. 在固定的 $V_{\\mathrm{max}}$ 下为暗晕偏倚建模，并考虑形成偏倚的依赖性：\n   - 定义纯质量暗晕偏倚 $b_{\\mathrm{mass}}(V_{\\mathrm{max}}) = b_\\ast + c \\ln\\!\\left(V_{\\mathrm{max}}/V_0\\right)$，其中 $b_\\ast = 1.2$，$c = 0.3$。\n   - 定义形成偏倚振幅 $A_{\\mathrm{ab}}$，使得暗晕偏倚为 $b_{\\mathrm{h}}(V_{\\mathrm{max}}, Z) = b_{\\mathrm{mass}}(V_{\\mathrm{max}})\\,\\left[1 + A_{\\mathrm{ab}}\\, Z\\right]$。\n   - 将红星系样本的有效星系偏倚 $b_{\\mathrm{g,red}}$ 定义为 $b_{\\mathrm{h}}$ 在所有被指定为红色的暗晕上的平均值。类似地，将完整（所有暗晕）样本的有效星系偏倚 $b_{\\mathrm{g,all}}$ 定义为在所有暗晕上的平均值。这些偏倚控制着振幅，并通过一个自由的模板振幅在拟合中被边缘化。\n\n4. 构建位形空间中的物质相关函数模板，使用共动距离 $r$，单位为 $\\mathrm{Mpc}/h$：\n   - 使用一个基线平滑项 $S(r) = -A_{\\mathrm{s}} / r^\\gamma$，其中 $A_{\\mathrm{s}} = 0.2$，$\\gamma = 1.8$。\n   - 使用一个高斯BAO峰 $W(r) = A_{\\mathrm{w}} \\exp\\!\\left[-\\dfrac{(r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right]$，其中 $A_{\\mathrm{w}} = 0.01$，$r_{\\mathrm{b}} = 105\\,\\mathrm{Mpc}/h$，$\\sigma_{\\mathrm{w}} = 8\\,\\mathrm{Mpc}/h$。\n   - 定义 $\\xi_{\\mathrm{m}}(r) = S(r) + W(r)$。\n\n5. 构建观测到的星系相关函数：\n   - 对于全星系样本，定义 $\\xi_{\\mathrm{g,all}}(r) = b_{\\mathrm{g,all}}^2 \\,\\xi_{\\mathrm{m}}(r)$。\n   - 对于红星系样本，引入一个由形成偏倚引起的BAO峰位移 $\\Delta r = k_{\\mathrm{shift}}\\,A_{\\mathrm{ab}}\\,\\overline{Z}_{\\mathrm{red}}$，并定义 $\\xi_{\\mathrm{g,red}}(r) = b_{\\mathrm{g,red}}^2 \\,\\left[S(r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\dfrac{(r - (r_{\\mathrm{b}} + \\Delta r))^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right]$。这种形式编码了数据与基准模板之间的轻微模型失配，这可能会使恢复的膨胀参数产生偏倚。\n\n6. 通过拟合一个重新缩放物质相关函数中距离的模板来估计BAO膨胀参数，同时边缘化宽带项：\n   - 将模型 $\\xi_{\\mathrm{model}}(r;\\alpha,B,a_0,a_1,a_2) = B^2 \\left[S(\\alpha \\, r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\dfrac{(\\alpha \\, r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] + a_0 + \\dfrac{a_1}{r} + \\dfrac{a_2}{r^2}$ 分别拟合到 $\\xi_{\\mathrm{g,all}}(r)$ 和 $\\xi_{\\mathrm{g,red}}(r)$ 上，拟合范围为 $r \\in [60,140]\\,\\mathrm{Mpc}/h$，在整数 $r$ 值上采样。\n   - 使用非线性最小二乘法估计 $\\alpha$、$B$、$a_0$、$a_1$ 和 $a_2$，并设置物理上合理的边界：$0.9 \\le \\alpha \\le 1.1$，$0.5 \\le B \\le 3.0$，$-1 \\le a_0 \\le 1$，$-10 \\le a_1 \\le 10$，$-100 \\le a_2 \\le 100$。\n   - 需要报告的BAO偏移为 $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$，表示为一个无量纲小数。\n\n7. 要求的单位和输出：\n   - 距离 $r$ 必须以 $\\mathrm{Mpc}/h$ 为单位。\n   - 速度 $V_{\\mathrm{max}}$ 必须以 $\\mathrm{km/s}$ 为单位。\n   - 形成红移 $z_{\\mathrm{f}}$ 和归一化的 $Z$ 是无量纲的。\n   - 最终输出 $\\Delta \\alpha_{\\mathrm{BAO}}$ 必须是无量纲的，并以四舍五入到六位小数的小数形式打印。\n\n您的程序必须生成单行输出，其中包含以下测试套件的结果，结果为逗号分隔的列表，并用方括号括起来，按所列顺序排列。每个测试用例由 $(\\mathrm{seed}, f_{\\mathrm{red}}, A_{\\mathrm{ab}}, k_{\\mathrm{shift}})$ 定义：\n\n- 测试 1: $(42, 0.5, 0.2, 0.4)$\n- 测试 2: $(7, 0.3, 0.4, 0.6)$\n- 测试 3: $(13, 0.7, 0.0, 0.6)$\n- 测试 4: $(101, 0.1, 0.5, 0.3)$\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果（例如，$[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4]$），其中每个条目是对应测试用例的 $\\Delta \\alpha_{\\mathrm{BAO}}$，四舍五入到六位小数。不允许有其他输出。", "solution": "用户提供的问题已被分析并被认为是有效的。它构成了宇宙学领域一个定义明确的数值实验，基于大尺度结构分析的既定原则。问题陈述是自包含的，所有必要的参数、模型和程序都得到了明确的规定。它没有科学上的不准确之处、逻辑矛盾和主观论断。因此，我们可以着手解决。\n\n目标是量化在分析色择星系样本时，由星系形成偏倚对重子声学振荡（BAO）膨胀参数 $\\alpha_{\\mathrm{BAO}}$ 造成的系统性偏倚。该实验模拟了一个合成暗晕星表，根据暗晕形成年龄（年龄匹配）分配星系颜色，为不同样本的相关函数建模，并拟合一个模板来提取 $\\alpha_{\\mathrm{BAO}}$。最终输出是偏移量 $\\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}}$。\n\n解决方案通过遵循问题陈述中指定的步骤顺序来实现。\n\n**步骤1：合成暗晕星表的生成**\n\n我们生成一个包含 $N = 10^5$ 个暗晕的合成星表。每个暗晕由其最大环状速度 $V_{\\mathrm{max}}$、一个大尺度环境代理量 $\\delta_{\\mathrm{env}}$ 和一个形成红移 $z_{\\mathrm{f}}$ 定义。\n\n- 速度 $V_{\\mathrm{max}}$ 从区间 $[V_{\\mathrm{min}}, V_{\\mathrm{max,up}}]$ 上的截断幂律概率密度函数 $p(V_{\\mathrm{max}}) \\propto V_{\\mathrm{max}}^{-\\beta}$ 中抽取，参数为 $V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$、$V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$ 和 $\\beta = 3.5$。这通过逆变换采样实现。对于一个均匀随机变量 $u \\in [0, 1]$，速度由下式给出：\n$$ V_{\\mathrm{max}}(u) = \\left[ u \\left(V_{\\mathrm{max,up}}^{1-\\beta} - V_{\\mathrm{min}}^{1-\\beta}\\right) + V_{\\mathrm{min}}^{1-\\beta} \\right]^{\\frac{1}{1-\\beta}} $$\n- 每个暗晕的环境代理量 $\\delta_{\\mathrm{env}}$ 从一个均值为 $0$、标准差为 $\\sigma_{\\mathrm{env}} = 0.8$ 的高斯分布中抽取。\n- 形成红移 $z_{\\mathrm{f}}$ 随后被建模为 $V_{\\mathrm{max}}$ 和 $\\delta_{\\mathrm{env}}$ 的函数，并包含一个随机分量 $\\epsilon$：\n$$ z_{\\mathrm{f}} = z_0 + s_1 \\ln\\!\\left(\\frac{V_{\\mathrm{max}}}{V_0}\\right) + s_2 \\delta_{\\mathrm{env}} + \\epsilon $$\n这里，$z_0 = 1.5$，$V_0 = 200\\,\\mathrm{km/s}$，$s_1 = 0.2$，$s_2 = 0.6$。随机项 $\\epsilon$ 从一个均值为 $0$、标准差为 $\\sigma_{z} = 0.4$ 的高斯分布中抽取。\n- 最后，通过对样本进行标准化，将每个暗晕的形成红移归一化为一个无量纲量 $Z$：\n$$ Z = \\frac{z_{\\mathrm{f}} - \\overline{z_{\\mathrm{f}}}}{\\sigma(z_{\\mathrm{f}})} $$\n其中 $\\overline{z_{\\mathrm{f}}}$ 和 $\\sigma(z_{\\mathrm{f}})$ 分别是生成的 $z_{\\mathrm{f}}$ 值的均值和标准差。\n\n**步骤2：年龄匹配与颜色指定**\n\n我们实施一个年龄匹配方案来为每个暗晕指定“颜色”，其中颜色是形成时间的代理。\n- 暗晕星表按最大环状速度 $V_{\\mathrm{max}}$ 被划分到多个区间中，每个区间的宽度为 $\\Delta V = 20\\,\\mathrm{km/s}$，范围从 $V_{\\mathrm{min}} = 100\\,\\mathrm{km/s}$ 到 $V_{\\mathrm{max,up}} = 400\\,\\mathrm{km/s}$。\n- 在每个 $V_{\\mathrm{max}}$ 区间内，暗晕按其形成红移 $z_{\\mathrm{f}}$ 的降序排列。由于年龄较大的星系通常更红，更高的 $z_{\\mathrm{f}}$（更早形成）对应于一个红星系。\n- 每个区间中前 $f_{\\mathrm{red}}$ 比例的暗晕被指定为“红色”。$f_{\\mathrm{red}}$ 的值由每个测试用例提供。\n- 然后，我们通过对所有分箱中被分类为红色的所有暗晕的 $Z$ 值进行平均，计算出平均归一化形成红移 $\\overline{Z}_{\\mathrm{red}}$。这个量 $\\overline{Z}_{\\mathrm{red}}$ 衡量了红星系样本相对于完整总体的平均形成时期。\n\n**步骤3：具有形成偏倚依赖的暗晕偏倚**\n\n暗晕的成团强度，由暗晕偏倚 $b_{\\mathrm{h}}$ 量化，被建模为不仅依赖于质量（由 $V_{\\mathrm{max}}$ 代理），还依赖于形成时间（由 $Z$ 代理），这种效应被称为形成偏倚。\n- 偏倚的质量依赖分量由一个对数关系给出：\n$$ b_{\\mathrm{mass}}(V_{\\mathrm{max}}) = b_\\ast + c \\ln\\!\\left(\\frac{V_{\\mathrm{max}}}{V_0}\\right) $$\n参数为 $b_\\ast = 1.2$，$c = 0.3$，$V_0 = 200\\,\\mathrm{km/s}$。\n- 完整的暗晕偏倚通过对归一化形成红移 $Z$ 的线性依赖关系来包含形成偏倚：\n$$ b_{\\mathrm{h}}(V_{\\mathrm{max}}, Z) = b_{\\mathrm{mass}}(V_{\\mathrm{max}})\\,\\left[1 + A_{\\mathrm{ab}}\\, Z\\right] $$\n其中 $A_{\\mathrm{ab}}$ 是形成偏倚振幅，一个由每个测试用例指定的参数。\n- 完整星系样本的有效线性偏倚 $b_{\\mathrm{g,all}}$ 是 $b_{\\mathrm{h}}$ 在所有暗晕上的平均值。类似地，红星系样本的有效偏倚 $b_{\\mathrm{g,red}}$ 是 $b_{\\mathrm{h}}$ 仅在红星系样本上的平均值。\n\n**步骤4和5：构建星系相关函数**\n\n我们对两点相关函数 $\\xi(r)$ 进行建模，该函数描述了在共动分离距离 $r$ 处找到星系对的超额概率。\n- 一个基准物质相关函数模板 $\\xi_{\\mathrm{m}}(r)$ 被构建为一个平滑的幂律分量 $S(r)$ 和一个高斯BAO峰 $W(r)$ 的和：\n$$ \\xi_{\\mathrm{m}}(r) = S(r) + W(r) = -\\frac{A_{\\mathrm{s}}}{r^\\gamma} + A_{\\mathrm{w}} \\exp\\!\\left[-\\frac{(r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right] $$\n参数为 $A_{\\mathrm{s}} = 0.2$，$\\gamma = 1.8$，$A_{\\mathrm{w}} = 0.01$，$r_{\\mathrm{b}} = 105\\,\\mathrm{Mpc}/h$，$_w = 8\\,\\mathrm{Mpc}/h$。\n- 完整星系样本的“观测”相关函数使用线性偏倚建模：\n$$ \\xi_{\\mathrm{g,all}}(r) = b_{\\mathrm{g,all}}^2 \\,\\xi_{\\mathrm{m}}(r) $$\n- 对于红星系样本，形成偏倚在BAO峰的位置引入了一个物理位移 $\\Delta r$。这个位移与形成偏倚强度和样本的平均年龄成正比：\n$$ \\Delta r = k_{\\mathrm{shift}}\\,A_{\\mathrm{ab}}\\,\\overline{Z}_{\\mathrm{red}} $$\n其中 $k_{\\mathrm{shift}}$ 是每个测试用例的参数。因此，红星系样本的相关函数为：\n$$ \\xi_{\\mathrm{g,red}}(r) = b_{\\mathrm{g,red}}^2 \\,\\left[S(r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\frac{(r - (r_{\\mathrm{b}} + \\Delta r))^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] $$\n$\\xi_{\\mathrm{g,red}}(r)$ 中的真实峰位置与模板峰位置 $r_b$ 之间的这种失配是我们旨在测量的系统性偏倚的来源。\n\n**步骤6：BAO膨胀参数的估计**\n\nBAO膨胀参数 $\\alpha_{\\mathrm{BAO}}$ 是通过将一个模型拟合到“观测”到的相关函数 $\\xi_{\\mathrm{g,all}}(r)$ 和 $\\xi_{\\mathrm{g,red}}(r)$ 来提取的。该拟合模型允许对分离轴进行膨胀、一个整体振幅缩放以及宽带冗余项，以边缘化平滑形状的不确定性：\n$$ \\xi_{\\mathrm{model}}(r;\\alpha,B,a_0,a_1,a_2) = B^2 \\left[S(\\alpha \\, r) + A_{\\mathrm{w}} \\exp\\!\\left(-\\frac{(\\alpha \\, r - r_{\\mathrm{b}})^2}{2\\,\\sigma_{\\mathrm{w}}^2}\\right)\\right] + a_0 + \\frac{a_1}{r} + \\frac{a_2}{r^2} $$\n- 在 $r \\in [60, 140]\\,\\mathrm{Mpc}/h$ 的范围内进行非线性最小二乘拟合，以找到最佳拟合参数 $(\\alpha, B, a_0, a_1, a_2)$。\n- 拟合产生两个膨胀参数：从拟合 $\\xi_{\\mathrm{g,all}}(r)$ 得到的 $\\alpha_{\\mathrm{all}}$ 和从拟合 $\\xi_{\\mathrm{g,red}}(r)$ 得到的 $\\alpha_{\\mathrm{red}}$。对于无偏测量，我们期望 $\\alpha_{\\mathrm{all}} \\approx 1$。然而，红星系样本相关函数中的物理位移 $\\Delta r$ 将导致拟合返回 $\\alpha_{\\mathrm{red}} \\ne 1$。\n- 每个测试用例的最终结果是BAO膨胀参数的系统性偏移：\n$$ \\Delta \\alpha_{\\mathrm{BAO}} = \\alpha_{\\mathrm{red}} - \\alpha_{\\mathrm{all}} $$\n\n这个值是一个无量纲的小数，它量化了在分析色择星系样本时因忽略形成偏倚而导致的宇宙学距离标度测量中的误差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Main function to run the full analysis for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (seed, f_red, A_ab, k_shift)\n        (42, 0.5, 0.2, 0.4),\n        (7, 0.3, 0.4, 0.6),\n        (13, 0.7, 0.0, 0.6),\n        (101, 0.1, 0.5, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_alpha = _solve_single_case(*case)\n        results.append(delta_alpha)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef _solve_single_case(seed, f_red, A_ab, k_shift):\n    \"\"\"\n    Performs the numerical experiment for a single test case.\n    \"\"\"\n    # 1. Define model constants and generate halo catalog\n    # Catalog generation\n    N = 100000\n    V_min, V_max_up, beta = 100.0, 400.0, 3.5\n    # Formation redshift model\n    z0, V0, s1, s2 = 1.5, 200.0, 0.2, 0.6\n    sigma_env, sigma_z = 0.8, 0.4\n    # Age matching\n    delta_v_bin = 20.0\n    # Halo bias model\n    b_star, c = 1.2, 0.3\n    # Correlation function model\n    A_s, gamma = 0.2, 1.8\n    A_w, r_b, sigma_w = 0.01, 105.0, 8.0\n\n    rng = np.random.default_rng(seed)\n\n    # Generate V_max from a truncated power law using inverse transform sampling\n    u = rng.uniform(size=N)\n    inv_beta_m1 = 1.0 / (1.0 - beta)\n    v_min_pow = V_min**(1.0 - beta)\n    v_max_pow = V_max_up**(1.0 - beta)\n    V_max = (v_min_pow + u * (v_max_pow - v_min_pow))**inv_beta_m1\n\n    # Generate formation redshift z_f\n    delta_env = rng.normal(loc=0.0, scale=sigma_env, size=N)\n    epsilon = rng.normal(loc=0.0, scale=sigma_z, size=N)\n    z_f = z0 + s1 * np.log(V_max / V0) + s2 * delta_env + epsilon\n\n    # Normalize formation redshift\n    Z = (z_f - np.mean(z_f)) / np.std(z_f)\n\n    # 2. Implement age-matching SHAM\n    v_bins = np.arange(V_min, V_max_up + delta_v_bin, delta_v_bin)\n    bin_indices = np.digitize(V_max, bins=v_bins)\n    \n    red_halo_indices = []\n    for i in range(1, len(v_bins)):\n        halos_in_bin_mask = (bin_indices == i)\n        halos_in_bin_idx = np.where(halos_in_bin_mask)[0]\n        \n        if len(halos_in_bin_idx) == 0:\n            continue\n            \n        z_f_in_bin = z_f[halos_in_bin_idx]\n        # Sort halos in bin by z_f descending to find the \"oldest\"\n        sorted_indices = np.argsort(z_f_in_bin)[::-1]\n        \n        # Select the top f_red fraction as \"red\"\n        n_red_in_bin = int(len(halos_in_bin_idx) * f_red)\n        red_indices_in_bin = halos_in_bin_idx[sorted_indices[:n_red_in_bin]]\n        red_halo_indices.extend(red_indices_in_bin)\n    \n    red_halo_indices = np.array(red_halo_indices)\n    mean_Z_red = np.mean(Z[red_halo_indices])\n\n    # 3. Model halo bias\n    b_mass = b_star + c * np.log(V_max / V0)\n    b_h = b_mass * (1.0 + A_ab * Z)\n    \n    b_g_all = np.mean(b_h)\n    b_g_red = np.mean(b_h[red_halo_indices])\n\n    # 4  5. Construct the galaxy correlation functions\n    r_vals = np.arange(60, 141)\n\n    def S_func(r_): return -A_s / r_**gamma\n    def W_func(r_): return A_w * np.exp(-(r_ - r_b)**2 / (2.0 * sigma_w**2))\n    \n    xi_m = S_func(r_vals) + W_func(r_vals)\n    xi_g_all = b_g_all**2 * xi_m\n    \n    delta_r = k_shift * A_ab * mean_Z_red\n    xi_g_red = b_g_red**2 * (S_func(r_vals) + A_w * np.exp(-(r_vals - (r_b + delta_r))**2 / (2.0 * sigma_w**2)))\n    \n    # 6. Estimate BAO dilation parameters via fitting\n    def xi_model(r, alpha, B, a0, a1, a2):\n        S_fit = -A_s / (alpha * r)**gamma\n        W_fit = A_w * np.exp(-(alpha * r - r_b)**2 / (2.0 * sigma_w**2))\n        poly = a0 + a1 / r + a2 / r**2\n        return B**2 * (S_fit + W_fit) + poly\n        \n    bounds = ([0.9, 0.5, -1., -10., -100.], [1.1, 3.0, 1., 10., 100.])\n    \n    # Fit all-galaxies sample\n    popt_all, _ = curve_fit(xi_model, r_vals, xi_g_all, bounds=bounds, method='trf')\n    alpha_all = popt_all[0]\n    \n    # Fit red-selected sample\n    popt_red, _ = curve_fit(xi_model, r_vals, xi_g_red, bounds=bounds, method='trf')\n    alpha_red = popt_red[0]\n    \n    # Calculate the shift\n    delta_alpha_bao = alpha_red - alpha_all\n    \n    return delta_alpha_bao\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3473083"}]}