{"hands_on_practices": [{"introduction": "本练习关注数值方法的一个基石：代码验证。我们将模拟一个简单的引力平面波（由一维标量波动方程建模），并将数值结果与已知的精确解析解进行比较。这项实践对于建立对数值求解器的信心，以及量化其在振幅和相位方面的精度至关重要。[@problem_id:3502846]", "problem": "考虑在平直背景时空中的真空线性化广义相对论。设时空度规写作 $g_{\\mu\\nu} = \\eta_{\\mu\\nu} + h_{\\mu\\nu}$，其中 $\\eta_{\\mu\\nu}$ 是闵可夫斯基度规，$h_{\\mu\\nu}$ 是一个满足 $\\lvert h_{\\mu\\nu} \\rvert \\ll 1$ 的小微扰。在洛伦兹规范和真空中，迹反转微扰满足齐次波动方程。在横向无迹 (TT) 规范中，每个独立的度规微扰分量 $h_{ij}^{\\mathrm{TT}}$ 满足标量波动方程\n$$\n\\frac{\\partial^2 h}{\\partial t^2} = c^2 \\frac{\\partial^2 h}{\\partial x^2},\n$$\n对于一个代表性分量，在一维空间 $x$ 中，其中 $c$ 是光速。在数值相对论中常用的几何单位制中，设 $c=1$。\n\n要求您通过演化一个精确的弱场平面波解析解，并量化相位和振幅误差作为时间步长 $\\Delta t$ 和网格间距 $\\Delta x$ 的函数，来验证一个数值时间演化代码。使用的解析解为\n$$\nh(x,t) = A \\cos(k x - \\omega t),\n$$\n其中 $A=10^{-6}$，$k = 2\\pi m$，$m=4$，$\\omega = c k$，且在 $x \\in [0,L)$ 上采用周期性边界条件，其中 $L=1$。在 $t=0$ 时的初始条件为\n$$\nh(x,0) = A \\cos(k x), \\quad \\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0} = \\omega A \\sin(k x).\n$$\n\n在具有 $N_x$ 个点和间距 $\\Delta x = L/N_x$ 的均匀网格上，使用在空间和时间上均为二阶精度的显式有限差分格式。施加周期性边界条件。定义库朗数 $C = c \\Delta t / \\Delta x$。对于 $n \\ge 1$ 的时间更新必须实现为\n$$\nh_j^{n+1} = 2 h_j^n - h_j^{n-1} + C^2 \\left(h_{j+1}^n - 2 h_j^n + h_{j-1}^n\\right),\n$$\n其中 $j$ 是网格点的索引，$n$ 是时间层的索引。第一步 $h_j^{1}$ 必须通过与波动方程一致的泰勒展开得到，并使用离散拉普拉斯算子：\n$$\nh_j^{1} = h_j^{0} + \\Delta t \\left(\\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0}\\right)_j + \\frac{1}{2} \\Delta t^2 \\, c^2 \\, \\left(\\frac{\\partial^2 h}{\\partial x^2}\\right)_j^{0,\\mathrm{disc}},\n$$\n其中离散拉普拉斯算子为\n$$\n\\left(\\frac{\\partial^2 h}{\\partial x^2}\\right)_j^{0,\\mathrm{disc}} = \\frac{h_{j+1}^0 - 2 h_{j}^0 + h_{j-1}^0}{\\Delta x^2}.\n$$\n\n将解演化至目标时间 $t_{\\mathrm{target}} = \\alpha T$，其中 $T = 2\\pi / \\omega$ 是解析周期，$\\alpha = 0.37$。使用整数个时间步 $N_t = \\mathrm{round}(t_{\\mathrm{target}}/\\Delta t)$ 并设置 $t_{\\mathrm{final}} = N_t \\Delta t$。\n\n在 $t_{\\mathrm{final}}$ 时刻，通过将数值解投影到基函数 $\\cos(k x)$ 和 $\\sin(k x)$ 上，计算具有指数 $m$ 的平面波模式的数值振幅 $A_{\\mathrm{num}}$ 和相位 $\\phi_{\\mathrm{num}}$：\n$$\nC = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\cos(k x_j), \\quad S = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\sin(k x_j),\n$$\n$$\nA_{\\mathrm{num}} = \\frac{2}{N_x} \\sqrt{C^2 + S^2}, \\quad \\phi_{\\mathrm{num}} = \\mathrm{atan2}(S, C).\n$$\n在 $t_{\\mathrm{final}}$ 时的解析相位为 $\\phi_{\\mathrm{true}} = \\omega t_{\\mathrm{final}}$。量化：\n- 振幅误差，定义为绝对差 $E_A = \\lvert A_{\\mathrm{num}} - A \\rvert$（无量纲，与 $h$ 的单位相同）。\n- 相位误差，定义为绝对主值差 $E_\\phi = \\left\\lvert \\mathrm{Arg}\\left(e^{i(\\phi_{\\mathrm{num}} - \\phi_{\\mathrm{true}})}\\right) \\right\\rvert$（单位为弧度），其中 $\\mathrm{Arg}(\\cdot)$ 将角度映射到 $(-\\pi,\\pi]$。\n\n使用以下参数值测试套件，以探究在不同稳定库朗数和分辨率下的误差行为：\n- 情况 1：$N_x = 128$，$\\Delta x = L/N_x$，$\\Delta t = 0.5 \\Delta x$。\n- 情况 2：$N_x = 64$，$\\Delta x = L/N_x$，$\\Delta t = 0.8 \\Delta x$。\n- 情况 3：$N_x = 32$，$\\Delta x = L/N_x$，$\\Delta t = 0.99 \\Delta x$。\n- 情况 4：$N_x = 16$，$\\Delta x = L/N_x$，$\\Delta t = 0.5 \\Delta x$。\n\n所有量均为无量纲，除了相位误差 $E_\\phi$ 必须以弧度表示。您的程序必须为每个测试用例计算 $(E_A, E_\\phi)$，并生成单行输出，其中包含一个逗号分隔的列表形式的结果，并用方括号括起来，格式如下\n$$\n\\left[ [E_{A,1},E_{\\phi,1}], [E_{A,2},E_{\\phi,2}], [E_{A,3},E_{\\phi,3}], [E_{A,4},E_{\\phi,4}] \\right],\n$$\n每个条目都是一个浮点数。角度必须以弧度处理。无需用户输入；所有参数均已在上方指定，并且必须在您的解决方案中硬编码。", "solution": "该问题要求验证一个用于一维标量波动方程的数值格式，该方程可作为横向无迹 (TT) 规范下弱场引力波的模型。验证过程通过演化一个精确的平面波解析解，并量化数值振幅和相位误差来完成。\n\n控制方程是空间一维 $x$ 和时间 $t$ 的标量波动方程：\n$$\n\\frac{\\partial^2 h}{\\partial t^2} = c^2 \\frac{\\partial^2 h}{\\partial x^2}\n$$\n根据问题陈述，我们采用光速 $c=1$ 的几何单位制。该问题在一个周期性空间域 $x \\in [0,L)$ 上求解，其中 $L=1$。\n\n用作基准的精确解析解是一个平面波：\n$$\nh(x,t) = A \\cos(k x - \\omega t)\n$$\n参数给定为振幅 $A=10^{-6}$、模数 $m=4$、波数 $k=2\\pi m$ 和角频率 $\\omega=ck=k$。$t=0$ 时的初始条件从此解析解导出：\n$$\nh(x,0) = A \\cos(k x)\n$$\n$$\n\\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0} = \\omega A \\sin(k x)\n$$\n\n数值解在具有 $N_x$ 个空间点 $x_j = j \\Delta x$（$j=0, 1, \\dots, N_x-1$）的均匀网格上计算，其中网格间距为 $\\Delta x = L/N_x$。时间以恒定的时间步长 $\\Delta t$ 进行离散化。库朗数定义为 $C = c \\Delta t / \\Delta x = \\Delta t / \\Delta x$。\n\n该数值格式是一种二阶精度的有限差分方法。空间二阶导数由标准的三点中心差分模板近似：\n$$\n\\left.\\frac{\\partial^2 h}{\\partial x^2}\\right|_{x_j, t^n} \\approx \\frac{h_{j+1}^n - 2 h_j^n + h_{j-1}^n}{\\Delta x^2}\n$$\n其中 $h_j^n$ 表示 $h(x_j, t^n = n\\Delta t)$ 的数值近似。将此代入波动方程得到显式蛙跳时间步进格式，经整理可求解下一个时间层的解 $h_j^{n+1}$：\n$$\nh_j^{n+1} = 2 h_j^n - h_j^{n-1} + \\left(\\frac{\\Delta t}{\\Delta x}\\right)^2 \\left(h_{j+1}^n - 2 h_j^n + h_{j-1}^n\\right) = 2 h_j^n - h_j^{n-1} + C^2 \\left(h_{j+1}^n - 2 h_j^n + h_{j-1}^n\\right)\n$$\n此公式对时间层 $n \\ge 1$ 有效。周期性边界条件通过将网格点 $j=N_x$ 与 $j=0$ 等同，以及将 $j=-1$ 与 $j=N_x-1$ 等同来施加。\n\n为开始模拟，由于蛙跳格式是一种三层方法，因此第一个时间步需要一个特殊步骤。在 $t^1 = \\Delta t$ 处的解由与控制方程一致的时间二阶泰勒级数展开计算得出：\n$$\nh(x, \\Delta t) \\approx h(x,0) + \\Delta t \\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0} + \\frac{\\Delta t^2}{2} \\left.\\frac{\\partial^2 h}{\\partial t^2}\\right|_{t=0}\n$$\n使用波动方程 $\\frac{\\partial^2 h}{\\partial t^2} = c^2 \\frac{\\partial^2 h}{\\partial x^2}$ 和空间导数的离散近似， $h_j^1$ 的公式变为：\n$$\nh_j^1 = h_j^0 + \\Delta t \\left(\\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0}\\right)_j + \\frac{c^2 \\Delta t^2}{2} \\left(\\frac{h_{j+1}^0 - 2 h_j^0 + h_{j-1}^0}{\\Delta x^2}\\right)\n$$\n其中 $h_j^0 = h(x_j,0)$ 及其时间导数由初始条件给出。\n\n每个测试用例的模拟按以下步骤进行：\n1.  初始化参数：$A, m, L, \\alpha, c, N_x, \\Delta t/\\Delta x$。\n2.  计算导出量：$\\Delta x = L/N_x$, $\\Delta t$, $k=2\\pi m$, $\\omega=k$, $T=2\\pi/\\omega$, $t_{\\mathrm{target}}=\\alpha T$, $N_t = \\mathrm{round}(t_{\\mathrm{target}}/\\Delta t)$ 以及 $t_{\\mathrm{final}} = N_t \\Delta t$。\n3.  设置网格 $x_j$ 以及 $h_j^0$ 和 $\\left(\\partial_t h\\right)_j^0$ 的初始数据数组。\n4.  使用第一步公式计算 $h_j^1$。\n5.  迭代主蛙跳更新规则 $N_t-1$ 步以达到 $t_{\\mathrm{final}}$，将解演化到 $h_j^{N_t}$。\n\n在最终时间 $t_{\\mathrm{final}}$，分析数值解 $h_j^{N_t}$ 以提取其振幅和相位。由于初始条件是纯余弦模式，预期数值解将由相同模式主导。我们将数值解投影到对应于模式 $m$ 的余弦和正弦基函数上：\n$$\nC = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\cos(k x_j), \\quad S = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\sin(k x_j)\n$$\n数值振幅 $A_{\\mathrm{num}}$ 和相位 $\\phi_{\\mathrm{num}}$ 随之计算如下：\n$$\nA_{\\mathrm{num}} = \\frac{2}{N_x} \\sqrt{C^2 + S^2}, \\quad \\phi_{\\mathrm{num}} = \\mathrm{atan2}(S, C)\n$$\n因子 $2/N_x$ 是实值信号离散傅里叶变换的标准归一化因子。相位 $\\phi_{\\mathrm{num}}$ 代表在 $t=t_{\\mathrm{final}}$ 时时间相位 $\\omega t$ 的测量值。\n\n通过将这些数值结果与解析值进行比较来计算误差。真实振幅为 $A = 10^{-6}$，真实相位为 $\\phi_{\\mathrm{true}} = \\omega t_{\\mathrm{final}}$。\n振幅误差是绝对差：\n$$\nE_A = \\lvert A_{\\mathrm{num}} - A \\rvert\n$$\n相位误差 $E_\\phi$ 是数值相位和真实相位之间的绝对差，并包裹到区间 $[0, \\pi]$ 以找到最短夹角。这可以稳健地计算为：\n$$\nE_\\phi = \\left\\lvert \\mathrm{Arg}\\left(e^{i(\\phi_{\\mathrm{num}} - \\phi_{\\mathrm{true}})}\\right) \\right\\rvert\n$$\n其中 $\\mathrm{Arg}(z)$ 是复数 $z$ 的辐角主值，映射到 $(-\\pi, \\pi]$。对四个指定的测试用例中的每一个都实施此过程，以生成所需的输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_case(Nx, dt_dx_ratio):\n    \"\"\"\n    Runs a single simulation case for the 1D wave equation and computes errors.\n\n    Args:\n        Nx (int): Number of spatial grid points.\n        dt_dx_ratio (float): Ratio of timestep to grid spacing, Delta_t / Delta_x.\n\n    Returns:\n        tuple[float, float]: A tuple containing the amplitude error (E_A) and\n                             the phase error (E_phi) in radians.\n    \"\"\"\n    # 1. Define constants and parameters\n    A = 1.0e-6\n    m = 4.0\n    L = 1.0\n    alpha = 0.37\n    c_light = 1.0\n\n    # 2. Calculate derived quantities\n    dx = L / Nx\n    dt = dt_dx_ratio * dx\n    courant_num = c_light * dt / dx\n\n    k = 2.0 * np.pi * m / L\n    omega = c_light * k\n    period = 2.0 * np.pi / omega\n    t_target = alpha * period\n    \n    # Ensure Nt is an integer, as specified\n    Nt = int(np.round(t_target / dt))\n    t_final = Nt * dt\n\n    # 3. Set up the grid and initial conditions\n    x = np.linspace(0.0, L, Nx, endpoint=False)\n    h0 = A * np.cos(k * x)\n    h_dot_0 = omega * A * np.sin(k * x)\n\n    # 4. Perform the first timestep using a second-order Taylor expansion\n    # h_prev corresponds to h^0, h_curr will be h^1\n    h_prev = h0\n    \n    # Discrete Laplacian of h^0 with periodic boundaries\n    laplacian_h0 = (np.roll(h0, -1) - 2.0 * h0 + np.roll(h0, 1)) / (dx**2)\n    \n    h_curr = h0 + dt * h_dot_0 + 0.5 * dt**2 * c_light**2 * laplacian_h0\n\n    # 5. Main time-stepping loop (Leapfrog)\n    # The loop runs from n=1 to Nt-1, calculating h^(n+1)\n    for _ in range(1, Nt):\n        # Laplacian of h_curr (h^n)\n        laplacian_h_curr = np.roll(h_curr, -1) - 2.0 * h_curr + np.roll(h_curr, 1)\n        \n        # Calculate h_next (h^(n+1))\n        # Note: courant_num**2 = (c*dt/dx)**2\n        h_next = 2.0 * h_curr - h_prev + courant_num**2 * laplacian_h_curr\n        \n        # Update time levels\n        h_prev = h_curr\n        h_curr = h_next\n\n    # h_curr now holds the solution at t_final, i.e., h^{N_t}\n    h_final = h_curr\n\n    # 6. Error analysis at t_final\n    # Project numerical solution onto basis functions\n    cos_kx = np.cos(k * x)\n    sin_kx = np.sin(k * x)\n\n    C_proj = np.sum(h_final * cos_kx)\n    S_proj = np.sum(h_final * sin_kx)\n\n    # Calculate numerical amplitude and phase\n    A_num = (2.0 / Nx) * np.sqrt(C_proj**2 + S_proj**2)\n    phi_num = np.arctan2(S_proj, C_proj)\n\n    # Calculate true phase\n    phi_true = omega * t_final\n\n    # Calculate errors\n    E_A = np.abs(A_num - A)\n    \n    # Phase error calculation, wrapping the difference to (-pi, pi]\n    delta_phi = phi_num - phi_true\n    # Arg(exp(i*delta_phi)) is equivalent to wrapping delta_phi to (-pi, pi]\n    E_phi = np.abs(np.arctan2(np.sin(delta_phi), np.cos(delta_phi)))\n\n    return E_A, E_phi\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, dt/dx)\n        (128, 0.5),\n        (64, 0.8),\n        (32, 0.99),\n        (16, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, dt_dx_ratio = case\n        errors = run_case(Nx, dt_dx_ratio)\n        results.append(errors)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{e_a},{e_phi}]\" for e_a, e_phi in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "3502846"}, {"introduction": "在弱场近似下，泊松方程是确定物质分布产生的引力势的基础。本练习旨在深入探究求解该方程的数值方法的精度，特别是通过推导有限差分法相对于精确解的误差。理解这一关键步骤中的误差来源，对于精确的宇宙学模拟至关重要。[@problem_id:3502863]", "problem": "考虑一个在移动坐标系下边长为 $L$ 的周期性立方宇宙学盒子，该盒子被一个均匀的笛卡尔网格离散化，每个方向上有 $N$ 个点，间距为 $\\Delta x = L/N$。在广义相对论的弱场近似下，共形牛顿规范中的标量势 $ \\Phi $ 在移动坐标系中遵循一个泊松型方程，\n$$\n\\nabla^{2} \\Phi(\\mathbf{x}) = S(\\mathbf{x}),\n$$\n其中 $S(\\mathbf{x})$ 与 $4 \\pi G a^{2} \\bar{\\rho}\\,\\delta(\\mathbf{x})$ 成正比，但在此可被视为一个空间平均值为零的通用源。假设在 $[0,L]^{3}$ 上采用周期性边界条件。\n\n专注于一个沿 $x$ 轴方向的、被解析的、可分离的单一平面波源，\n$$\nS(\\mathbf{x}) = S_{0} \\cos(k x),\n$$\n其中 $k = 2 \\pi m / L$，整数模数 $m$ 满足 $1 \\leq m \\leq \\frac{N}{2} - 1$ 以避免奈奎斯特混叠。\n\n考虑使用两种数值方法来求解该方程的离散版本：\n\n- 一种使用离散傅里叶变换 (DFT) 的谱方法，该方法在傅里叶空间中对非零波矢逐个模式地反演拉普拉斯算子，并将零波数模式 $ \\Phi_{\\mathbf{k}=\\mathbf{0}} $ 设置为零以固定势的规范（常数偏移）。\n\n- 一种在具有周期性边界条件的网格上使用的二阶中心差分有限差分方法，在 $x$ 方向上使用离散拉普拉斯算子模板，\n$$\n(\\nabla^{2} \\Phi)_{j} \\equiv \\frac{\\Phi_{j+1} - 2 \\Phi_{j} + \\Phi_{j-1}}{\\Delta x^{2}},\n$$\n并在 $y$ 和 $z$ 方向上使用类似的模板，其中索引对 $N$ 取模。\n\n从连续拉普拉斯算子及其离散二阶中心差分近似的基本定义出发，并仅使用所述的 DFT 和周期性性质，推导作用于一维采样平面波的有限差分拉普拉斯算子的离散特征值。然后利用此结果，获得针对单模源的有限差分解相对于精确连续解的相对振幅误差的闭式表达式，\n$$\nE_{\\mathrm{fd}}(k,N,L) \\equiv \\frac{\\Phi^{\\mathrm{fd}}_{k} - \\Phi^{\\mathrm{exact}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}},\n$$\n遵循两种方法中都将势的零波数模式设置为零的约定。你的最终答案必须是关于 $k$、$N$ 和 $L$ 的 $E_{\\mathrm{fd}}(k,N,L)$ 的单一闭式解析表达式。不要提供任何中间步骤，最终答案中也不要包含任何单位。此外，在你的推导中说明谱方法如何处理零模式，以及这对该源的误差有何影响。\n\n无需四舍五入。将最终相对误差表示为无量纲的解析表达式。", "solution": "问题陈述需经过验证。\n\n### 步骤1：提取已知条件\n- **控制方程：** 泊松型方程 $\\nabla^{2} \\Phi(\\mathbf{x}) = S(\\mathbf{x})$。\n- **域：** 在移动坐标系下边长为 $L$ 的周期性立方盒子，$[0,L]^{3}$。\n- **离散化：** 均匀笛卡尔网格，每个方向 $N$ 个点，网格间距 $\\Delta x = L/N$。\n- **源项：** 单一平面波 $S(\\mathbf{x}) = S_{0} \\cos(k x)$。\n- **波数：** $k = 2 \\pi m / L$，整数 $m$ 满足 $1 \\leq m \\leq \\frac{N}{2} - 1$。\n- **源属性：** 空间平均值为零。\n- **边界条件：** 周期性。\n- **谱方法：** 在傅里叶空间中逐模式反演拉普拉斯算子。将势的零波数模式 $\\Phi_{\\mathbf{k}=\\mathbf{0}}$ 设置为零。\n- **有限差分 (FD) 方法：** 对拉普拉斯算子使用二阶中心差分模板，例如，在 $x$ 方向上为 $(\\nabla^{2} \\Phi)_{j} \\equiv \\frac{\\Phi_{j+1} - 2 \\Phi_{j} + \\Phi_{j-1}}{\\Delta x^{2}}$，索引对 $N$ 取模。\n- **误差定义：** 相对振幅误差为 $E_{\\mathrm{fd}}(k,N,L) \\equiv \\frac{\\Phi^{\\mathrm{fd}}_{k} - \\Phi^{\\mathrm{exact}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}}$。\n- **规范约定：** 所有解的势的零波数模式均设置为零。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是适定的、客观的。它提出了一个计算物理背景下的标准数值分析问题。控制方程是基础的，源项定义明确，并且对于 $m \\ge 1$ 满足所述的“空间平均值为零”的性质。边界条件和规范固定 ($\\Phi_{\\mathbf{k}=\\mathbf{0}}=0$) 保证了解的唯一性。对模数 $m$ 的约束确保了波被解析且不处于奈奎斯特频率，这是离散方法中的一个标准考虑因素。问题是自洽的，其术语定义明确。未发现任何缺陷。\n\n### 步骤3：结论与行动\n问题有效。将提供一个完整的、有理有据的解答。\n\n### 解答推导\n目标是求出单个傅里叶模式下，有限差分解的振幅相对于精确连续解的振幅的相对误差。\n\n**1. 精确连续解**\n给定方程为 $\\nabla^{2} \\Phi(\\mathbf{x}) = S(\\mathbf{x})$。由于源项 $S(\\mathbf{x}) = S_{0} \\cos(k x)$ 仅依赖于坐标 $x$，势 $\\Phi$ 也将仅依赖于 $x$，因此 $\\nabla^{2} \\Phi = \\frac{d^{2}\\Phi}{dx^{2}}$。方程简化为：\n$$\n\\frac{d^{2}\\Phi}{dx^{2}} = S_{0} \\cos(k x)\n$$\n我们寻求一个形式为 $\\Phi(x) = \\Phi^{\\mathrm{exact}}_{k} \\cos(k x)$ 的解，其中 $\\Phi^{\\mathrm{exact}}_{k}$ 是该模式的振幅。将此拟设对 $x$ 求导两次，得到：\n$$\n\\frac{d\\Phi}{dx} = -\\Phi^{\\mathrm{exact}}_{k} k \\sin(k x)\n$$\n$$\n\\frac{d^{2}\\Phi}{dx^{2}} = -\\Phi^{\\mathrm{exact}}_{k} k^{2} \\cos(k x)\n$$\n将此代入微分方程，得到：\n$$\n-\\Phi^{\\mathrm{exact}}_{k} k^{2} \\cos(k x) = S_{0} \\cos(k x)\n$$\n为使此等式对所有 $x$ 成立，系数必须相等。这给出了精确解的振幅：\n$$\n\\Phi^{\\mathrm{exact}}_{k} = -\\frac{S_{0}}{k^{2}}\n$$\n问题指定势的零波数模式为零。对于 $k = 2\\pi m/L$ 且 $m \\ge 1$，$\\cos(kx)$ 在一个周期 $L$ 上的积分为零。因此，精确解 $\\Phi(x) = -\\frac{S_{0}}{k^{2}} \\cos(k x)$ 的平均值为零，满足此条件。\n\n**2. 关于谱方法的说明**\n问题提到了谱方法。此方法在傅里叶空间中求解方程，其中拉普拉斯算子 $\\nabla^2$ 变为与 $-|\\mathbf{k}|^2$ 的代数乘法。对于离散数据，使用离散傅里叶变换 (DFT)。在网格上，源被采样为 $S_j = S_{0} \\cos(k x_j)$。这个采样函数的 DFT 仅在对应于 $\\pm k$ 的离散波数处有非零分量。对于非零波数，谱方法通过 $\\hat{\\Phi}_{\\mathbf{k}} = - \\hat{S}_{\\mathbf{k}} / |\\mathbf{k}|^2$ 从源的系数 $\\hat{S}_{\\mathbf{k}}$ 计算傅里叶系数 $\\hat{\\Phi}_{\\mathbf{k}}$。由于源是单一的平面波，并且在网格上是周期性的（由 $k = 2\\pi m/L$ 保证），因此 DFT 和离散拉普拉斯算子在傅里叶空间中的作用是精确的。因此，对于这个特定的源，谱方法产生精确解，其误差为零。将 $\\Phi_{\\mathbf{k}=\\mathbf{0}}=0$ 的条件是一个规范固定选择。源的平均值为零，所以其 $\\mathbf{k}=\\mathbf{0}$ 傅里叶分量也为零，即 $\\hat{S}_{\\mathbf{k}=\\mathbf{0}}=0$。零模式的方程 $0 \\cdot \\hat{\\Phi}_{\\mathbf{k}=\\mathbf{0}} = \\hat{S}_{\\mathbf{k}=\\mathbf{0}} = 0$ 是不确定的。设置 $\\hat{\\Phi}_{\\mathbf{k}=\\mathbf{0}}=0$ 使解唯一，并与精确连续解相匹配。\n\n**3. 有限差分解**\n泊松方程的离散形式为 $(\\nabla^{2}_{\\mathrm{fd}} \\Phi)_{j} = S_j$，其中 $(\\nabla^{2}_{\\mathrm{fd}} \\Phi)_{j}$ 是拉普拉斯算子的二阶中心差分近似，而 $S_j = S_0 \\cos(k x_j)$ 是在网格点 $x_j = j \\Delta x$（对于 $j \\in \\{0, 1, ..., N-1\\}$）上采样的源。我们寻找形式为 $\\Phi^{\\mathrm{fd}}_{j} = \\Phi^{\\mathrm{fd}}_{k} \\cos(k x_j)$ 的解。为了找到振幅 $\\Phi^{\\mathrm{fd}}_{k}$，我们首先确定作用于模式 $\\cos(k x_j)$ 的有限差分拉普拉斯算子的离散特征值。\n$$\n(\\nabla^{2}_{\\mathrm{fd}} \\cos(k x_j)) = \\frac{\\cos(k x_{j+1}) - 2 \\cos(k x_j) + \\cos(k x_{j-1})}{(\\Delta x)^{2}}\n$$\n使用 $x_{j \\pm 1} = x_j \\pm \\Delta x$ 和三角恒等式 $\\cos(A+B) + \\cos(A-B) = 2\\cos(A)\\cos(B)$，我们有：\n$$\n\\cos(k(x_j + \\Delta x)) + \\cos(k(x_j - \\Delta x)) = 2 \\cos(k x_j) \\cos(k \\Delta x)\n$$\n将此代入有限差分表达式中：\n$$\n(\\nabla^{2}_{\\mathrm{fd}} \\cos(k x_j)) = \\frac{2 \\cos(k x_j) \\cos(k \\Delta x) - 2 \\cos(k x_j)}{(\\Delta x)^{2}} = \\left[ \\frac{2(\\cos(k \\Delta x) - 1)}{(\\Delta x)^{2}} \\right] \\cos(k x_j)\n$$\n方括号中的项是波数为 $k$ 的模式的离散拉普拉斯算子的特征值。离散方程变为：\n$$\n\\Phi^{\\mathrm{fd}}_{k} \\left[ \\frac{2(\\cos(k \\Delta x) - 1)}{(\\Delta x)^{2}} \\right] \\cos(k x_j) = S_{0} \\cos(k x_j)\n$$\n求解有限差分振幅 $\\Phi^{\\mathrm{fd}}_{k}$：\n$$\n\\Phi^{\\mathrm{fd}}_{k} = \\frac{S_{0}}{ \\frac{2(\\cos(k \\Delta x) - 1)}{(\\Delta x)^{2}} } = \\frac{S_{0} (\\Delta x)^{2}}{2(\\cos(k \\Delta x) - 1)}\n$$\n\n**4. 相对振幅误差**\n相对误差定义为 $E_{\\mathrm{fd}} = \\frac{\\Phi^{\\mathrm{fd}}_{k} - \\Phi^{\\mathrm{exact}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} = \\frac{\\Phi^{\\mathrm{fd}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} - 1$。我们计算振幅之比：\n$$\n\\frac{\\Phi^{\\mathrm{fd}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} = \\frac{ \\frac{S_{0} (\\Delta x)^{2}}{2(\\cos(k \\Delta x) - 1)} }{ -\\frac{S_{0}}{k^{2}} } = -\\frac{k^{2} (\\Delta x)^{2}}{2(\\cos(k \\Delta x) - 1)}\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2 \\sin^{2}(\\theta/2)$，我们可以写出 $\\cos(k \\Delta x) - 1 = -2 \\sin^{2}(k \\Delta x / 2)$。\n$$\n\\frac{\\Phi^{\\mathrm{fd}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} = -\\frac{k^{2} (\\Delta x)^{2}}{2(-2 \\sin^{2}(k \\Delta x / 2))} = \\frac{k^{2} (\\Delta x)^{2}}{4 \\sin^{2}(k \\Delta x / 2)}\n$$\n因此，相对误差为：\n$$\nE_{\\mathrm{fd}} = \\frac{k^{2} (\\Delta x)^{2}}{4 \\sin^{2}(k \\Delta x / 2)} - 1\n$$\n最后，我们代入 $\\Delta x = L/N$，用给定的参数 $k$、$N$ 和 $L$ 来表示误差。\n$$\nE_{\\mathrm{fd}}(k,N,L) = \\frac{k^{2} (L/N)^{2}}{4 \\sin^{2}(k L / (2N))} - 1 = \\frac{k^{2} L^{2}}{4 N^{2} \\sin^{2}\\left(\\frac{k L}{2 N}\\right)} - 1\n$$\n这就是有限差分解的相对振幅误差的闭式表达式。", "answer": "$$\n\\boxed{\\frac{k^{2} L^{2}}{4 N^{2} \\sin^{2}\\left(\\frac{k L}{2 N}\\right)} - 1}\n$$", "id": "3502863"}, {"introduction": "一个稳健的数值相对论代码必须能在适当的极限条件下正确地再现更简单、更成熟的物理理论。这个综合性实践提供了一系列数值实验，以证明宇宙学微扰方程能正确地退化为牛顿引力和狭义相对论流体力学。成功通过这些测试是任何用于宇宙学模拟的代码的关键验证步骤。[@problem_id:3502781]", "problem": "考虑一个在牛顿规范下空间平坦、弱微扰的 Friedmann–Lemaître–Robertson–Walker 时空，其线元为\n$$\nds^2 = -(1+2\\Phi)\\,dt^2 + a^2(1-2\\Psi)\\,\\delta_{ij}\\,dx^i\\,dx^j,\n$$\n其中 $a$ 是标度因子，$\\Phi$ 是引力势，$\\Psi$ 是空间曲率势。在 $a=1$、$\\Phi \\to 0$ 且 $\\Psi=\\Phi$ 的弱场极限下，该度规趋近于闵可夫斯基度规，且广义相对论 (GR) 退化为狭义相对论 (SR)。在数值宇宙学中，我们期望离散化方程能收敛到：\n- 当 $a=1$ 且 $\\Phi$ 很小时，由标量微扰的泊松方程所支配的牛顿引力。\n- 当 $a=1$ 且 $\\Phi = 0$ 时，在闵可夫斯基背景上的狭义相对论流体动力学。\n\n从以下基本依据出发：\n- 线性化弱场极限下的爱因斯坦场方程意味着标量微扰满足泊松方程\n$$\n\\nabla^2 \\Phi = 4\\pi G\\,\\bar{\\rho}\\,\\delta,\n$$\n该方程描述了引力势 $\\Phi$、背景密度 $\\bar{\\rho}$ 和密度对比 $\\delta$ 之间的关系。这是在弱场、亚视界范围中标量微扰的一个经过广泛检验的结果。\n- 对于理想流体，能量动量张量的守恒 $\\nabla_\\mu T^{\\mu\\nu}=0$ 在闵可夫斯基时空中退化为狭义相对论 (SR) 流体动力学方程。对于无压流体（尘埃），守恒密度为 $U=\\gamma \\rho$，其中 $\\rho$ 是静质量密度，$\\gamma$ 是洛伦兹因子，定义为 $\\gamma = 1/\\sqrt{1-v^2/c^2}$。\n\n您必须实现数值实验来验证这些极限的恢复，并进行收敛性研究。使用自然单位制，其中光速 $c=1$，引力常数 $G=1$。所有物理量都必须作为无量纲量处理。\n\n定义域和初始数据：\n- 长度为 $L=2\\pi$ 的一维周期性定义域，坐标 $x\\in[0,L)$。\n- 密度对比 $\\delta(x)$ 是一个单一正弦模式：\n$$\n\\delta(x) = A \\sin(kx),\n$$\n其中 $k=1$，振幅 $A$ 根据每个测试案例指定。背景密度为 $\\bar{\\rho}=1$。\n\n任务：\n1) 弱场极限 ($a=1$) 下的牛顿引力收敛性：\n   - 使用二阶有限差分拉普拉斯算子在周期性定义域上求解离散泊松方程。在傅里叶空间中，对于间距为 $\\Delta x=L/N$ 的均匀网格上的模式 $m$，离散拉普拉斯算子的特征值为\n   $$\n   \\lambda_m = \\frac{2\\left(1-\\cos\\left(\\frac{2\\pi m}{N}\\right)\\right)}{\\Delta x^2}.\n   $$\n   表示源项 $S(x) = 4\\pi G \\bar{\\rho}\\, \\delta(x)$，计算其离散傅里叶变换，并求解\n   $$\n   \\hat{\\Phi}_m = -\\frac{\\hat{S}_m}{\\lambda_m}, \\quad m\\neq 0,\n   $$\n   将零模式设置为 $\\hat{\\Phi}_0=0$ 以强制势为零均值。进行逆变换以获得网格上的 $\\Phi(x)$。与连续解析解\n   $$\n   \\Phi_{\\mathrm{ana}}(x) = -\\frac{4\\pi G \\bar{\\rho}}{k^2}\\,A \\sin(kx),\n   $$\n   进行比较，并计算离散 $L^2$ 误差\n   $$\n   E_N = \\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[\\Phi_i - \\Phi_{\\mathrm{ana}}(x_i)\\right]^2\\right)^{1/2}.\n   $$\n   对于 $A=10^{-3}$，计算 $N=64,128,256$ 时的 $E_N$，然后计算观测到的收敛阶\n   $$\n   p_{64\\to 128} = \\log_2\\left(\\frac{E_{64}}{E_{128}}\\right), \\quad p_{128\\to 256} = \\log_2\\left(\\frac{E_{128}}{E_{256}}\\right).\n   $$\n   同时计算 $N=128$ 和 $A=0$ 的边界情况误差 $E_{A=0}$，该值应接近于零。\n\n2) 闵可夫斯基时空 ($a=1$, $\\Phi=0$) 中的狭义相对论流体动力学：\n   - 使用用于线性平流方程的二阶 Lax–Wendroff 格式，在匀速平流 $v$ 下演化守恒的狭义相对论密度 $U=\\gamma \\rho$\n   $$\n   \\partial_t U + v\\,\\partial_x U = 0.\n   $$\n   网格索引 $i$ 处的更新公式为\n   $$\n   U_i^{n+1} = U_i^{n} - \\frac{v\\Delta t}{2\\Delta x}\\left(U_{i+1}^{n}-U_{i-1}^{n}\\right) + \\frac{v^2\\Delta t^2}{2\\Delta x^2}\\left(U_{i+1}^{n} - 2U_i^{n} + U_{i-1}^{n}\\right).\n   $$\n   使用周期性边界条件，库朗因子 $\\mathrm{CFL}=0.5$，从 $t=0$ 演化到 $t=T=1$，初始条件为 $\\rho(x,0) = \\bar{\\rho} + A \\sin(kx)$，速度恒为 $v=0.5$。守恒变量的狭义相对论解析解为\n   $$\n   U_{\\mathrm{ana}}(x,t) = \\gamma \\left[\\bar{\\rho} + A \\sin\\left(k(x-vt)\\right)\\right].\n   $$\n   计算 $N=64,128,256$ 时的离散 $L^2$ 误差\n   $$\n   E^{\\mathrm{SR}}_N = \\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[U_i(T) - U_{\\mathrm{ana}}(x_i,T)\\right]^2\\right)^{1/2}\n   $$\n   以及观测到的收敛阶\n   $$\n   p^{\\mathrm{SR}}_{64\\to 128} = \\log_2\\left(\\frac{E^{\\mathrm{SR}}_{64}}{E^{\\mathrm{SR}}_{128}}\\right), \\quad p^{\\mathrm{SR}}_{128\\to 256} = \\log_2\\left(\\frac{E^{\\mathrm{SR}}_{128}}{E^{\\mathrm{SR}}_{256}}\\right).\n   $$\n\n3) 狭义相对论动量密度的牛顿极限：\n   - 对于无压流体（尘埃），闵可夫斯基时空中的狭义相对论动量密度为\n   $$\n   S_{\\mathrm{SR}}(x,t) = \\rho(x,t)\\,\\gamma^2\\,v,\n   $$\n   而牛顿动量密度为\n   $$\n   S_{\\mathrm{N}}(x,t) = \\rho(x,t)\\,v.\n   $$\n   使用 $t=T=1$ 时的解析解 $\\rho(x,t) = \\bar{\\rho} + A \\sin(k(x-vt))$，计算在速度 $v\\in\\{0.3,0.1,0.05\\}$ 下定义域平均的相对 $L^2$ 差异，\n   $$\n   R(v) = \\frac{\\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[S_{\\mathrm{SR}}(x_i,T) - S_{\\mathrm{N}}(x_i,T)\\right]^2\\right)^{1/2}}{\\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[S_{\\mathrm{SR}}(x_i,T)\\right]^2\\right)^{1/2}},\n   $$\n   随着 $v\\to 0$，该值应减小并趋向于零，从而证明狭义相对论的牛顿极限。\n\n角度单位：所有三角函数均使用弧度。\n\n单位：使用自然单位制，其中 $c=1$ 和 $G=1$；所有量均为无量纲。\n\n测试套件：\n- 引力求解器：$A=10^{-3}$， $N\\in\\{64,128,256\\}$；边界情况 $A=0$，$N=128$。\n- 狭义相对论平流：$A=10^{-3}$，$v=0.5$，$T=1$，$N\\in\\{64,128,256\\}$。\n- 牛顿极限（动量）：$A=10^{-3}$，$T=1$，$N=1024$，$v\\in\\{0.3,0.1,0.05\\}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列\n$$\n\\left[p_{64\\to 128},\\,p_{128\\to 256},\\,p^{\\mathrm{SR}}_{64\\to 128},\\,p^{\\mathrm{SR}}_{128\\to 256},\\,R(0.3),\\,R(0.1),\\,R(0.05),\\,E_{A=0}\\right].\n$$\n每个条目必须是一个浮点数。例如，输出应类似于“[result1,result2,result3,result4,result5,result6,result7,result8]”。", "solution": "该问题提出了一系列数值实验，旨在从数值宇宙学方程中验证基本物理极限的恢复。具体来说，我们将展示在广义相对论的适当弱场近似下，方程向牛顿引力和狭义相对论 (SR) 流体动力学的收敛性。所有计算都在自然单位制中进行，其中引力常数 $G=1$ 且光速 $c=1$。该问题分为三个不同的任务。\n\n**任务 1：牛顿引力收敛性分析**\n\n第一个任务是证明在弱场、非相对论极限（$a=1$，小 $\\Phi$）下，标量微扰方程能够恢复牛顿引力。控制方程是引力势 $\\Phi$ 的泊松方程：\n$$\n\\nabla^2 \\Phi = 4\\pi G\\,\\bar{\\rho}\\,\\delta\n$$\n在此，$\\bar{\\rho}$ 是背景物质密度，$\\delta$ 是密度对比。该问题定义在一个长度为 $L=2\\pi$ 的一维周期性定义域上，坐标 $x\\in[0,L)$。密度对比是一个单一正弦模式 $\\delta(x) = A \\sin(kx)$，其中波数 $k=1$，背景密度 $\\bar{\\rho}=1$。泊松方程的源项为 $S(x) = 4\\pi G \\bar{\\rho} \\delta(x) = 4\\pi A \\sin(x)$。\n\n在该定义域上，假设势的均值为零，通过设 $\\Phi_{\\mathrm{ana}}(x) = C\\sin(kx)$ 可以找到连续解析解。将其代入泊松方程得到 $\\frac{d^2}{dx^2}(C\\sin(x)) = -C\\sin(x) = 4\\pi A \\sin(x)$，从而得出 $C = -4\\pi A$。在 $k=1$，$G=1$，$\\bar{\\rho}=1$ 的条件下，解析解为：\n$$\n\\Phi_{\\mathrm{ana}}(x) = -\\frac{4\\pi G \\bar{\\rho}}{k^2}A \\sin(kx) = -4\\pi A \\sin(x)\n$$\n在数值上，我们在一个有 $N$ 个点、间距为 $\\Delta x = L/N$ 的离散网格上求解泊松方程。我们采用傅里叶伪谱方法。方程 $\\nabla^2 \\Phi = S$ 在傅里叶空间中变换为 $(\\widehat{\\nabla^2 \\Phi})_m = \\hat{S}_m$，其中 $\\hat{f}_m$ 表示函数 $f(x)$ 的第 $m$ 个离散傅里叶系数。离散拉普拉斯算子作用于傅里叶模式 $e^{i2\\pi mx/L}$ 的效果是乘以其特征值。对于二阶有限差分拉普拉斯算子，与模式 $m$ 对应的特征值为 $-(k^{\\text{eff}}_m)^2$，其中 $k^{\\text{eff}}_m$ 是有效波数。问题陈述了负拉普拉斯算子 $-\\nabla^2$ 的特征值为：\n$$\n\\lambda_m = \\frac{2\\left(1-\\cos\\left(\\frac{2\\pi m}{N}\\right)\\right)}{\\Delta x^2}\n$$\n因此，傅里叶空间中的代数方程变为 $-\\lambda_m \\hat{\\Phi}_m = \\hat{S}_m$。对于非零模式 ($m \\neq 0$)，我们可以求解势的傅里叶系数：\n$$\n\\hat{\\Phi}_m = -\\frac{\\hat{S}_m}{\\lambda_m}\n$$\n源项的均值 $\\int_0^{2\\pi} \\sin(x) dx = 0$，所以其零频分量 $\\hat{S}_0=0$。我们通过设置 $\\hat{\\Phi}_0=0$ 来强制势为零均值。然后通过对系数 $\\hat{\\Phi}_m$ 应用离散傅里叶逆变换来恢复数值解 $\\Phi(x)$。\n\n我们在大小为 $N \\in \\{64, 128, 256\\}$ 的网格上，计算数值解 $\\Phi_i$ 和解析解 $\\Phi_{\\mathrm{ana}}(x_i)$ 之间的离散 $L^2$ 误差 $E_N$。然后使用公式 $p = \\log_2(E_{N_1}/E_{N_2})$ 确定收敛阶 $p$。由于拉普拉斯算子的有限差分模板是二阶精度的，我们期望收敛阶为 $p \\approx 2$。我们还计算了振幅 $A=0$ 的边界情况的误差，该误差应接近机器精度。\n\n**任务 2：狭义相对论流体动力学收敛性分析**\n\n第二个任务演示了在闵可夫斯基背景（$a=1$，$\\Phi=0$）下狭义相对论流体动力学的恢复。我们考虑一个静质量密度为 $\\rho$、速度恒为 $v$ 的无压流体（尘埃）。守恒量是实验室参考系中的密度 $U = \\gamma \\rho$，其中 $\\gamma = (1-v^2/c^2)^{-1/2}$ 是洛伦兹因子。在一维情况下，其演化由线性平流方程支配：\n$$\n\\partial_t U + v\\,\\partial_x U = 0\n$$\n$t=0$ 时的初始条件是在恒定背景上的正弦密度微扰，$\\rho(x,0) = \\bar{\\rho} + A \\sin(kx)$，其中 $\\bar{\\rho}=1$，$A=10^{-3}$，$k=1$。初始守恒密度为 $U(x,0) = \\gamma (\\bar{\\rho} + A \\sin(kx))$。解析解是初始剖面的一个简单平移：\n$$\nU_{\\mathrm{ana}}(x,t) = \\gamma \\left[\\bar{\\rho} + A \\sin\\left(k(x-vt)\\right)\\right]\n$$\n我们使用二阶 Lax–Wendroff 格式数值求解该平流方程。对于时间步长 $\\Delta t$ 和网格间距 $\\Delta x$，从时间步 $n$ 到 $n+1$ 的更新规则是：\n$$\nU_i^{n+1} = U_i^{n} - \\frac{v\\Delta t}{2\\Delta x}\\left(U_{i+1}^{n}-U_{i-1}^{n}\\right) + \\frac{v^2\\Delta t^2}{2\\Delta x^2}\\left(U_{i+1}^{n} - 2U_i^{n} + U_{i-1}^{n}\\right)\n$$\n使用库朗因子 $\\mathrm{CFL} = v\\Delta t/\\Delta x = 0.5$ 将该格式从 $t=0$ 演化到 $T=1$，这保证了数值稳定性。应用周期性边界条件。我们计算在网格大小 $N \\in \\{64, 128, 256\\}$ 下，$T=1$ 时的数值解与解析解之间的 $L^2$ 误差 $E^{\\mathrm{SR}}_N$，并从这些误差中计算收敛阶。由于 Lax-Wendroff 格式是二阶精度的，我们期望收敛阶 $p^{\\mathrm{SR}} \\approx 2$。\n\n**任务 3：狭义相对论动量的牛顿极限**\n\n最后一个任务是验证在非相对论极限 ($v \\ll c$) 下，狭义相对论动量密度趋近于牛顿动量密度。尘埃的狭义相对论动量密度为 $S_{\\mathrm{SR}} = T^{0i} = \\rho h u^0 u^i = \\rho \\gamma^2 v$（因为对于尘埃，比焓 $h=1$，且 $u^\\mu = \\gamma(1, \\vec{v})$）。相应的牛顿动量密度为 $S_{\\mathrm{N}} = \\rho v$。\n我们在一个高分辨率网格 ($N=1024$) 上，使用平流后的密度剖面 $\\rho(x,T) = \\bar{\\rho} + A \\sin(k(x-vT))$ 来分析 $T=1$ 时的解析解。两种表述之间的一致性由定义域平均的相对 $L^2$ 差异来量化：\n$$\nR(v) = \\frac{\\|S_{\\mathrm{SR}} - S_{\\mathrm{N}}\\|_{L^2}}{\\|S_{\\mathrmSR}}\\|_{L^2}}\n$$\n我们可以对此表达式进行解析简化：\n$$\nS_{\\mathrm{SR}} - S_{\\mathrm{N}} = \\rho \\gamma^2 v - \\rho v = \\rho v (\\gamma^2 - 1)\n$$\n范数之比变为：\n$$\nR(v) = \\frac{\\|\\rho v (\\gamma^2 - 1)\\|}{\\|\\rho v \\gamma^2\\|} = \\frac{|v(\\gamma^2-1)|}{|v\\gamma^2|} \\frac{\\|\\rho\\|}{\\|\\rho\\|} = \\frac{\\gamma^2-1}{\\gamma^2} = 1 - \\frac{1}{\\gamma^2} = 1 - (1-v^2) = v^2\n$$\n这证明了狭义相对论和牛顿动量之间的相对差异与 $v^2$ 成正比。我们为一系列递减的速度 $v \\in \\{0.3, 0.1, 0.05\\}$ 计算该值，以在数值上确认这一行为。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_poisson_error(N: int, A: float) - float:\n    \"\"\"\n    Solves the 1D periodic Poisson equation using a Fourier method and\n    computes the L2 error against the analytic solution.\n\n    Args:\n        N: Number of grid points.\n        A: Amplitude of the density contrast.\n\n    Returns:\n        The discrete L2 error.\n    \"\"\"\n    # Constants and domain setup\n    G = 1.0\n    rho_bar = 1.0\n    k = 1.0\n    L = 2.0 * np.pi\n    \n    # Grid setup\n    dx = L / N\n    x = np.linspace(0, L, N, endpoint=False)\n    \n    # Source term\n    delta = A * np.sin(k * x)\n    S = 4.0 * np.pi * G * rho_bar * delta\n    \n    # Solve in Fourier space\n    S_hat = np.fft.fft(S)\n    \n    # Wavenumbers (integer mode numbers)\n    m = np.fft.fftfreq(N) * N\n    \n    # Eigenvalues of the negative discrete Laplacian (-nabla^2)\n    # The m=0 mode gives lambda_0 = 0, leading to a singularity.\n    # We handle it by setting Phi_hat[0] = 0.\n    with np.errstate(divide='ignore', invalid='ignore'):\n        lambda_m = (2.0 * (1.0 - np.cos(2.0 * np.pi * m / N))) / (dx**2)\n    \n    Phi_hat = np.zeros_like(S_hat)\n    # The source term has zero mean, so S_hat[0] is zero.\n    # The condition Phi_hat[0]=0 enforces a zero-mean potential.\n    non_zero_modes = (m != 0)\n    Phi_hat[non_zero_modes] = -S_hat[non_zero_modes] / lambda_m[non_zero_modes]\n\n    # Transform back to real space\n    Phi_num = np.fft.ifft(Phi_hat).real\n    \n    # Analytical solution\n    Phi_ana = -(4.0 * np.pi * G * rho_bar / k**2) * A * np.sin(k * x)\n    \n    # Compute L2 error\n    error = np.linalg.norm(Phi_num - Phi_ana) / np.sqrt(N)\n    \n    return error\n\ndef run_lax_wendroff_advection(N: int, A: float, v: float, T: float) - float:\n    \"\"\"\n    Evolves the SR linear advection equation using the Lax-Wendroff scheme\n    and computes the L2 error.\n\n    Args:\n        N: Number of grid points.\n        A: Amplitude of the density perturbation.\n        v: Advection velocity.\n        T: Final evolution time.\n\n    Returns:\n        The discrete L2 error at time T.\n    \"\"\"\n    # Constants and domain setup\n    rho_bar = 1.0\n    k = 1.0\n    L = 2.0 * np.pi\n    CFL = 0.5\n    \n    # Grid setup\n    dx = L / N\n    x = np.linspace(0, L, N, endpoint=False)\n    \n    # Time stepping setup\n    # Adjust dt to land exactly on T\n    dt_provisional = CFL * dx / v\n    n_steps = int(np.ceil(T / dt_provisional))\n    dt = T / n_steps\n\n    # Initial condition for conserved density U = gamma * rho\n    gamma = 1.0 / np.sqrt(1.0 - v**2)\n    rho0 = rho_bar + A * np.sin(k * x)\n    U = gamma * rho0\n    \n    # Coefficients for Lax-Wendroff update\n    c1 = v * dt / (2.0 * dx)\n    c2 = (v**2 * dt**2) / (2.0 * dx**2)\n\n    # Time evolution loop\n    for _ in range(n_steps):\n        U_p1 = np.roll(U, -1)  # U_{i+1}\n        U_m1 = np.roll(U, 1)   # U_{i-1}\n        \n        # Second-order stencil for first derivative\n        advection_term = c1 * (U_p1 - U_m1)\n        # Second-order stencil for second derivative\n        diffusion_term = c2 * (U_p1 - 2.0 * U + U_m1)\n        \n        U = U - advection_term + diffusion_term\n\n    # Analytical solution at T\n    U_ana = gamma * (rho_bar + A * np.sin(k * (x - v * T)))\n\n    # Compute L2 error\n    error = np.linalg.norm(U - U_ana) / np.sqrt(N)\n    \n    return error\n    \ndef calculate_momentum_difference(N: int, A: float, v: float, T: float) - float:\n    \"\"\"\n    Computes the relative L2 difference between SR and Newtonian momentum densities.\n\n    Args:\n        N: Number of grid points.\n        A: Amplitude of the density perturbation.\n        v: Velocity of the fluid.\n        T: Time of evaluation.\n\n    Returns:\n        The relative L2 difference R(v).\n    \"\"\"\n    # Constants and domain\n    rho_bar = 1.0\n    k = 1.0\n    L = 2.0 * np.pi\n    \n    # Grid\n    x = np.linspace(0, L, N, endpoint=False)\n    \n    # Lorentz factor\n    gamma = 1.0 / np.sqrt(1.0 - v**2)\n    \n    # Analytic density at time T\n    rho = rho_bar + A * np.sin(k * (x - v * T))\n    \n    # Momentum densities\n    S_N = rho * v\n    S_SR = rho * gamma**2 * v\n    \n    # Relative L2 difference\n    norm_diff = np.linalg.norm(S_SR - S_N)\n    norm_SR = np.linalg.norm(S_SR)\n    \n    # Avoid division by zero if S_SR is zero everywhere\n    if norm_SR == 0:\n        return 0.0\n    \n    return norm_diff / norm_SR\n\ndef solve():\n    \"\"\"\n    Runs all tasks and prints the final results.\n    \"\"\"\n    # --- Task 1: Newtonian Gravity Convergence ---\n    A_grav = 1.0e-3\n    Ns_grav = [64, 128, 256]\n    errors_grav = [calculate_poisson_error(N, A_grav) for N in Ns_grav]\n    \n    p_64_128 = np.log2(errors_grav[0] / errors_grav[1])\n    p_128_256 = np.log2(errors_grav[1] / errors_grav[2])\n    \n    # Boundary case A=0\n    error_A0 = calculate_poisson_error(N=128, A=0.0)\n\n    # --- Task 2: Special-Relativistic Hydrodynamics Convergence ---\n    A_hydro = 1.0e-3\n    v_hydro = 0.5\n    T_hydro = 1.0\n    Ns_hydro = [64, 128, 256]\n    errors_hydro = [run_lax_wendroff_advection(N, A_hydro, v_hydro, T_hydro) for N in Ns_hydro]\n    \n    p_sr_64_128 = np.log2(errors_hydro[0] / errors_hydro[1])\n    p_sr_128_256 = np.log2(errors_hydro[1] / errors_hydro[2])\n\n    # --- Task 3: Newtonian Limit of Momentum Density ---\n    A_limit = 1.0e-3\n    T_limit = 1.0\n    N_limit = 1024\n    vs_limit = [0.3, 0.1, 0.05]\n    R_values = [calculate_momentum_difference(N_limit, A_limit, v, T_limit) for v in vs_limit]\n\n    # --- Assemble and Print Final Results ---\n    results = [\n        p_64_128,\n        p_128_256,\n        p_sr_64_128,\n        p_sr_128_256,\n        R_values[0],\n        R_values[1],\n        R_values[2],\n        error_A0\n    ]\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3502781"}]}