{"hands_on_practices": [{"introduction": "温暗物质（WDM）与冷暗物质（CDM）的主要区别在于其固有的热速度，这导致了在小尺度上的自由流（free-streaming），从而抑制了小尺度结构的形成。在数值模拟中，这种效应通常通过一个转移函数（transfer function）来对初始物质功率谱进行修正。本练习旨在通过一个解析计算，加深您对如何量化这种功率谱抑制的理解，并熟悉由WDM模型参数决定的抑制特征尺度。[@problem_id:3489311]", "problem": "在数值宇宙学中，为了将温暗物质（WDM）热速度所致的结构形成小尺度抑制效应纳入初始条件，可将冷暗物质（CDM）的线性物质功率谱乘以WDM传递函数的平方。考虑一个模拟设置，其中WDM传递函数由以下广泛使用的拟合形式建模：\n$$\nT(k)=\\left[1+\\left(\\alpha\\,k\\right)^{2\\mu}\\right]^{-5/\\mu},\n$$\n其中，$k$ 是共动波数，$\\alpha$ 是由自由流尺度设定的一个尺度参数，而 $\\mu$ 是一个无量纲的形状参数。于是，WDM功率谱为\n$$\nP_{\\mathrm{wdm}}(k)=T^{2}(k)\\,P_{\\mathrm{cdm}}(k),\n$$\n抑制比为\n$$\nR(k)\\equiv \\frac{P_{\\mathrm{wdm}}(k)}{P_{\\mathrm{cdm}}(k)}=T^{2}(k)=\\left[1+\\left(\\alpha\\,k\\right)^{2\\mu}\\right]^{-10/\\mu}.\n$$\n将半模波数 $k_{\\mathrm{hm}}$ 定义为在该尺度上功率被抑制因子 $1/2$ 的条件，即：\n$$\nR\\!\\left(k_{\\mathrm{hm}}\\right)=\\frac{1}{2}.\n$$\n为了量化 $k_{\\mathrm{hm}}$ 附近的抑制程度，我们将围绕 $k_{\\mathrm{hm}}$ 的对称三点平均抑制定义为：\n$$\n\\mathcal{A}(\\mu)\\equiv \\frac{1}{3}\\left[R\\!\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right)+R\\!\\left(k_{\\mathrm{hm}}\\right)+R\\!\\left(2\\,k_{\\mathrm{hm}}\\right)\\right].\n$$\n仅从给定的定义出发，推导出一个关于 $\\mathcal{A}(\\mu)$ 的闭式解析表达式，该表达式仅依赖于无量纲参数 $\\mu$，而不依赖于 $\\alpha$ 或 $k_{\\mathrm{hm}}$。您的最终答案必须是单个闭式表达式（不需要数值计算）。请精确表达最终结果；无需四舍五入，也无需单位，因为 $\\mathcal{A}(\\mu)$ 是无量纲的。", "solution": "问题陈述经核实具有科学依据、定义明确且客观。它基于数值宇宙学中用于解释温暗物质（WDM）效应的标准模型，特别是使用传递函数来抑制冷暗物质（CDM）功率谱。所有变量和函数都有明确定义，任务是一个自洽的、数学上严谨的推导。因此，我将开始进行解答。\n\n目标是推导对称三点平均抑制 $\\mathcal{A}(\\mu)$ 的闭式表达式，该表达式仅依赖于形状参数 $\\mu$。$\\mathcal{A}(\\mu)$ 的定义如下：\n$$\n\\mathcal{A}(\\mu) \\equiv \\frac{1}{3}\\left[R\\!\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right)+R\\!\\left(k_{\\mathrm{hm}}\\right)+R\\!\\left(2\\,k_{\\mathrm{hm}}\\right)\\right].\n$$\n抑制比 $R(k)$ 定义为：\n$$\nR(k) = \\left[1+\\left(\\alpha\\,k\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}}.\n$$\n半模波数 $k_{\\mathrm{hm}}$ 由条件 $R(k_{\\mathrm{hm}}) = \\frac{1}{2}$ 定义。这为消除参数 $\\alpha$ 和 $k_{\\mathrm{hm}}$ 提供了出发点。\n\n首先，我们将 $k_{\\mathrm{hm}}$ 的定义应用于 $R(k)$ 的表达式：\n$$\nR(k_{\\mathrm{hm}}) = \\left[1+\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}} = \\frac{1}{2}.\n$$\n为了求解组合项 $(\\alpha k_{\\mathrm{hm}})^{2\\mu}$，我们将方程两边同时取 $-\\frac{\\mu}{10}$ 次幂：\n$$\n\\left(\\left[1+\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}}\\right)^{-\\frac{\\mu}{10}} = \\left(\\frac{1}{2}\\right)^{-\\frac{\\mu}{10}}.\n$$\n这简化为：\n$$\n1+\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu} = 2^{\\frac{\\mu}{10}}.\n$$\n分离出我们感兴趣的项，得到：\n$$\n\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu} = 2^{\\frac{\\mu}{10}} - 1.\n$$\n这个关键的中间结果用 $\\mu$ 表示了乘积 $(\\alpha k_{\\mathrm{hm}})$，这将使我们能够从 $\\mathcal{A}(\\mu)$ 的最终表达式中消除其依赖性。\n\n$\\mathcal{A}(\\mu)$ 的表达式需要三项：$R(k_{\\mathrm{hm}})$、$R(\\frac{k_{\\mathrm{hm}}}{2})$ 和 $R(2 k_{\\mathrm{hm}})$。第一项由定义给出：$R(k_{\\mathrm{hm}})=\\frac{1}{2}$。我们现在推导另外两项的表达式。\n\n对于项 $R(\\frac{k_{\\mathrm{hm}}}{2})$，我们将 $k = \\frac{k_{\\mathrm{hm}}}{2}$ 代入 $R(k)$ 的定义中：\n$$\nR\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right) = \\left[1+\\left(\\alpha\\,\\frac{k_{\\mathrm{hm}}}{2}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}} = \\left[1+\\frac{\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}}.\n$$\n现在，我们代入 $(\\alpha k_{\\mathrm{hm}})^{2\\mu}$ 的表达式：\n$$\nR\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right) = \\left[1+\\frac{2^{\\frac{\\mu}{10}} - 1}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}}.\n$$\n这一项现在只依赖于 $\\mu$。\n\n接下来，对于项 $R(2 k_{\\mathrm{hm}})$，我们将 $k = 2 k_{\\mathrm{hm}}$ 代入 $R(k)$ 的定义中：\n$$\nR\\left(2\\,k_{\\mathrm{hm}}\\right) = \\left[1+\\left(\\alpha\\,(2 k_{\\mathrm{hm}})\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}} = \\left[1+2^{2\\mu}\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}}.\n$$\n再次，我们代入 $(\\alpha k_{\\mathrm{hm}})^{2\\mu}$ 的表达式：\n$$\nR\\left(2\\,k_{\\mathrm{hm}}\\right) = \\left[1+2^{2\\mu}\\left(2^{\\frac{\\mu}{10}} - 1\\right)\\right]^{-\\frac{10}{\\mu}}.\n$$\n这一项也只依赖于 $\\mu$。\n\n最后，我们将这三项代回 $\\mathcal{A}(\\mu)$ 的定义中：\n$$\n\\mathcal{A}(\\mu) = \\frac{1}{3}\\left[R\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right) + R\\left(k_{\\mathrm{hm}}\\right) + R\\left(2\\,k_{\\mathrm{hm}}\\right)\\right].\n$$\n$$\n\\mathcal{A}(\\mu) = \\frac{1}{3}\\left( \\left[1+\\frac{2^{\\frac{\\mu}{10}} - 1}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}} + \\frac{1}{2} + \\left[1+2^{2\\mu}\\left(2^{\\frac{\\mu}{10}} - 1\\right)\\right]^{-\\frac{10}{\\mu}} \\right).\n$$\n这就是 $\\mathcal{A}(\\mu)$ 的闭式解析表达式。它是一个仅与无量纲形状参数 $\\mu$ 有关的函数，所有对尺度参数 $\\alpha$ 和半模波数 $k_{\\mathrm{hm}}$ 的依赖都已通过基于问题定义的严格代数代换消除。推导到此完成。", "answer": "$$\n\\boxed{\\frac{1}{3}\\left(\\left[1 + \\frac{2^{\\frac{\\mu}{10}} - 1}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}} + \\frac{1}{2} + \\left[1 + 2^{2\\mu}\\left(2^{\\frac{\\mu}{10}} - 1\\right)\\right]^{-\\frac{10}{\\mu}}\\right)}\n$$", "id": "3489311"}, {"introduction": "温暗物质的热速度不仅影响宇宙的初始条件，还根据刘维尔定理（Liouville’s theorem）为已形成结构的相空间密度设定了一个上限。这个基本限制是WDM的一个关键物理特征，可以用来预测暗物质晕中心的密度分布，与CDM模型中预测的密度尖峰（cusp）形成对比。本练习将引导您从动力学平衡的基本方程出发，推导出一个简单的球对称模型，并利用相空间密度约束来估算WDM晕的核心半径。[@problem_id:3489284]", "problem": "一个由温暗物质 (WDM) 组成的矮星系尺度暗物质晕，在小半径尺度上可以被理想化为一个处于动力学平衡状态的球形、无碰撞、各向同性系统。粗粒化相空间密度代理定义为 $Q(r) \\equiv \\rho(r)/\\sigma(r)^{3}$，其中 $\\rho(r)$ 是质量密度，$\\sigma(r)$ 是一维速度弥散。根据应用于无碰撞玻尔兹曼方程 (CBE) 的 Liouville 定理，粗粒化相空间密度不能超过其原初值，因此 $Q(r) \\leq Q_{0}$，其中 $Q_{0}$ 是一个由 WDM 热遗迹微观物理决定的常数。在数值宇宙学中，这个约束常被用来估算一个最小核心半径，在此半径之内，一个有心尖的平衡模型会违反该界限。\n\n考虑一个矮星系晕的内部区域，它被建模为一个具有恒定一维速度弥散 $\\sigma(r) = \\sigma$ 的各向同性等温球体，并处于其自身引力的作用下。球对称各向同性金斯方程和质量连续性是支配平衡的基本定律：\n$$\\frac{d}{dr}\\big(\\rho(r)\\,\\sigma^{2}\\big) = -\\rho(r)\\,\\frac{G\\,M(r)}{r^{2}}, \\quad \\frac{dM(r)}{dr} = 4\\pi r^{2}\\,\\rho(r),$$\n其中 $M(r)$ 是包围质量，$G$ 是引力常数。使用这些关系式推导各向同性等温球体的自洽密度剖面 $\\rho(r)$。\n\n然后，设置相空间密度代理使其达到原初界限的饱和值，$Q(r_{\\mathrm{core}}) = Q_{0}$，并求解在这个简单球模型中该界限所蕴含的最小核心半径 $r_{\\mathrm{core}}$。\n\n对于一个代表性的矮星系晕和 WDM 模型，取：\n- 恒定一维速度弥散 $\\sigma = 8.0\\,\\mathrm{km}\\,\\mathrm{s}^{-1}$，\n- 原初界限 $Q_{0} = 5.0 \\times 10^{-4}\\, M_{\\odot}\\,\\mathrm{pc}^{-3}\\,(\\mathrm{km}\\,\\mathrm{s}^{-1})^{-3}$，\n- 引力常数 $G = 4.302 \\times 10^{-3}\\,\\mathrm{pc}\\, M_{\\odot}^{-1}\\,(\\mathrm{km}\\,\\mathrm{s}^{-1})^{2}$。\n\n仅从给定的平衡关系式出发，推导各向同性等温密度剖面，然后计算刚好使 $Q_{0}$ 饱和的 $r_{\\mathrm{core}}$ 的值。\n\n将最终数值答案四舍五入至四位有效数字，并以秒差距 (pc) 表示。", "solution": "首先对问题进行验证，以确保其具有科学依据、提法恰当且客观。\n\n**步骤1：提取已知条件**\n- 系统描述：一个由温暗物质 (WDM) 组成的矮星系尺度暗物质晕，被建模为一个处于动力学平衡状态的球形、无碰撞、各向同性系统。\n- 相空间密度代理：$Q(r) \\equiv \\rho(r)/\\sigma(r)^{3}$。\n- 相空间约束：$Q(r) \\leq Q_{0}$。\n- 模型：内部区域是一个具有恒定一维速度弥散 $\\sigma(r) = \\sigma$ 的各向同性等温球体。\n- 控制方程：\n  - 球对称各向同性金斯方程：$\\frac{d}{dr}\\big(\\rho(r)\\,\\sigma^{2}\\big) = -\\rho(r)\\,\\frac{G\\,M(r)}{r^{2}}$。\n  - 质量连续性方程：$\\frac{dM(r)}{dr} = 4\\pi r^{2}\\,\\rho(r)$。\n- 任务：推导自洽密度剖面 $\\rho(r)$，然后求解当 $Q(r_{\\mathrm{core}}) = Q_{0}$ 时的核心半径 $r_{\\mathrm{core}}$。\n- 数值常数：\n  - $\\sigma = 8.0\\,\\mathrm{km}\\,\\mathrm{s}^{-1}$。\n  - $Q_{0} = 5.0 \\times 10^{-4}\\, M_{\\odot}\\,\\mathrm{pc}^{-3}\\,(\\mathrm{km}\\,\\mathrm{s}^{-1})^{-3}$。\n  - $G = 4.302 \\times 10^{-3}\\,\\mathrm{pc}\\, M_{\\odot}^{-1}\\,(\\mathrm{km}\\,\\mathrm{s}^{-1})^{2}$。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题使用了由金斯方程和质量连续性方程控制的等温球体标准模型，这些是恒星和星系动力学中的基本原理。WDM 的相空间密度极限概念（Liouville 定理的一个推论）是数值宇宙学和结构形成中的一个成熟课题。所有概念在科学上都是合理的。\n- **提法恰当性**：该问题提供了一套完整的微分方程和常数，以确定密度剖面的特定解，并随后计算核心半径。存在唯一且有意义的解。\n- **客观性**：问题以精确、无偏见的科学语言陈述。\n- **结论**：问题有效。这是理论天体物理学中的一个标准计算。\n\n**步骤3：判定与行动**\n问题有效。将提供完整解答。\n\n**自洽密度剖面的推导**\n\n该系统由两个基本方程描述。首先是球对称各向同性金斯方程：\n$$ \\frac{d}{dr}\\big(\\rho(r)\\,\\sigma^{2}\\big) = -\\rho(r)\\,\\frac{G\\,M(r)}{r^{2}} $$\n其次是质量连续性方程，它定义了包围质量 $M(r)$：\n$$ \\frac{dM(r)}{dr} = 4\\pi r^{2}\\,\\rho(r) $$\n问题指定了一个等温模型，意味着一维速度弥散 $\\sigma$ 是常数。因此，金斯方程简化为：\n$$ \\sigma^{2}\\frac{d\\rho(r)}{dr} = -\\rho(r)\\,\\frac{G\\,M(r)}{r^{2}} $$\n我们寻求该方程组的一个自洽解 $\\rho(r)$。为了找到这样的解，我们寻找密度的幂律形式，$\\rho(r) = A r^{n}$，其中 $A$ 和 $n$ 是待定常数。\n\n首先，我们假设密度剖面为幂律形式，通过对质量连续性方程积分来求得包围质量 $M(r)$：\n$$ M(r) = \\int_0^r 4\\pi r'^{2} \\rho(r') dr' = \\int_0^r 4\\pi r'^{2} (A r'^{n}) dr' = 4\\pi A \\int_0^r r'^{n+2} dr' $$\n为了使积分在下限 $r'=0$ 处收敛，我们需要 $n+2  -1$，即 $n  -3$。积分结果为：\n$$ M(r) = \\frac{4\\pi A}{n+3} r^{n+3} $$\n接下来，我们将这个 $M(r)$ 的表达式和 $\\rho(r)$ 的幂律形式代入简化的金斯方程。$\\rho(r)$ 的导数为 $\\frac{d\\rho}{dr} = n A r^{n-1}$。\n金斯方程变为：\n$$ \\sigma^{2} (n A r^{n-1}) = -(A r^{n}) \\frac{G}{r^{2}} \\left( \\frac{4\\pi A}{n+3} r^{n+3} \\right) $$\n我们简化该表达式：\n$$ n \\sigma^2 A r^{n-1} = -\\frac{4\\pi G A^2}{n+3} r^{n+n+3-2} = -\\frac{4\\pi G A^2}{n+3} r^{2n+1} $$\n为使此等式对所有半径 $r$ 成立，两边 $r$ 的指数必须相同：\n$$ n-1 = 2n+1 \\implies n = -2 $$\n这个 $n=-2$ 的值满足收敛条件 $n  -3$。现在，我们令系数相等：\n$$ n \\sigma^2 A = -\\frac{4\\pi G A^2}{n+3} $$\n代入 $n=-2$：\n$$ -2 \\sigma^2 A = -\\frac{4\\pi G A^2}{-2+3} = -4\\pi G A^2 $$\n因为我们寻找的是 $A \\neq 0$ 的非平凡解，我们可以两边同除以 $-A$：\n$$ 2 \\sigma^2 = 4\\pi G A $$\n求解系数 $A$：\n$$ A = \\frac{2\\sigma^2}{4\\pi G} = \\frac{\\sigma^2}{2\\pi G} $$\n因此，奇异等温球体的自洽密度剖面为：\n$$ \\rho(r) = \\frac{\\sigma^2}{2\\pi G r^2} $$\n这就是问题陈述中提到的“有心尖的”剖面，它表现出中心密度奇点。\n\n**最小核心半径的计算**\n\n粗粒化相空间密度代理由 $Q(r) = \\rho(r)/\\sigma(r)^3$ 给出。对于这个等温模型，$\\sigma(r)=\\sigma$ 是常数。代入推导出的密度剖面，我们得到：\n$$ Q(r) = \\frac{1}{\\sigma^3} \\left( \\frac{\\sigma^2}{2\\pi G r^2} \\right) = \\frac{1}{2\\pi G \\sigma r^2} $$\nWDM 约束规定该值不能超过原初值 $Q_0$，即 $Q(r) \\leq Q_0$。对于小的 $r$，该剖面违反了此界限，因为当 $r \\to 0$ 时 $Q(r) \\to \\infty$。最小核心半径 $r_{\\mathrm{core}}$ 定义为刚好使该界限饱和的半径：\n$$ Q(r_{\\mathrm{core}}) = Q_0 $$\n代入我们关于 $Q(r)$ 的表达式：\n$$ \\frac{1}{2\\pi G \\sigma r_{\\mathrm{core}}^2} = Q_0 $$\n我们现在求解 $r_{\\mathrm{core}}$：\n$$ r_{\\mathrm{core}}^2 = \\frac{1}{2\\pi G \\sigma Q_0} $$\n$$ r_{\\mathrm{core}} = \\sqrt{\\frac{1}{2\\pi G \\sigma Q_0}} = (2\\pi G \\sigma Q_0)^{-1/2} $$\n现在，我们代入给定的数值：\n- $\\sigma = 8.0\\,\\mathrm{km}\\,\\mathrm{s}^{-1}$\n- $Q_{0} = 5.0 \\times 10^{-4}\\, M_{\\odot}\\,\\mathrm{pc}^{-3}\\,(\\mathrm{km}\\,\\mathrm{s}^{-1})^{-3}$\n- $G = 4.302 \\times 10^{-3}\\,\\mathrm{pc}\\, M_{\\odot}^{-1}\\,(\\mathrm{km}\\,\\mathrm{s}^{-1})^{2}$\n\n首先，我们计算分母中的项 $2\\pi G \\sigma Q_0$：\n$$ 2\\pi G \\sigma Q_0 = 2\\pi (4.302 \\times 10^{-3}) (8.0) (5.0 \\times 10^{-4}) \\,\\mathrm{pc}^{-2} $$\n$$ 2\\pi G \\sigma Q_0 = 2\\pi (4.302 \\times 10^{-3}) (40.0 \\times 10^{-4}) \\,\\mathrm{pc}^{-2} $$\n$$ 2\\pi G \\sigma Q_0 = 80\\pi \\times 4.302 \\times 10^{-7} \\,\\mathrm{pc}^{-2} $$\n$$ 2\\pi G \\sigma Q_0 \\approx 1.08121 \\times 10^{-4} \\,\\mathrm{pc}^{-2} $$\n现在我们可以计算 $r_{\\mathrm{core}}^2$：\n$$ r_{\\mathrm{core}}^2 = \\frac{1}{1.08121 \\times 10^{-4} \\,\\mathrm{pc}^{-2}} \\approx 9248.9 \\,\\mathrm{pc}^2 $$\n最后，我们取平方根求得 $r_{\\mathrm{core}}$：\n$$ r_{\\mathrm{core}} = \\sqrt{9248.9} \\,\\mathrm{pc} \\approx 96.17117 \\,\\mathrm{pc} $$\n按要求将结果四舍五入至四位有效数字：\n$$ r_{\\mathrm{core}} \\approx 96.17 \\,\\mathrm{pc} $$\n这个值代表了为避免违反 WDM 模型施加的基本相空间密度约束而必须形成的常密度核心的估计半径。", "answer": "$$\\boxed{96.17}$$", "id": "3489284"}, {"introduction": "将温暗物质的理论模型转化为可靠的数值模拟，关键在于正确地为模拟粒子赋予初始热速度。这一过程涉及在不同的宇宙学坐标系（物理坐标系与共动坐标系）之间进行精确转换，并必须正确处理宇宙膨胀带来的影响。本练习是一个结合了理论推导与编程实践的综合任务，旨在揭示如何正确地从共动动量分布中采样并映射到物理速度，同时量化常见的实现错误，如忽略尺度因子或混淆哈勃流，以确保模拟的物理保真度。[@problem_id:3489237]", "problem": "您的任务是编写一个完整的、可运行的程序，该程序定量对比在共动参考系与物理参考系中，对一个无碰撞温暗物质粒子在初始化红移处的热本动速度进行采样的差异，并展示哈勃流和标度因子映射如何影响采样得到的速度分布以及一个简单的离散噪声代理。\n\n您的推理和实现必须仅基于以下物理基础：\n- 无碰撞粒子的相空间密度守恒（刘维尔定理）以及共动动量分布在宇宙膨胀下的不变性。\n- 物理位置与共动位置之间的关系 $\\; \\mathbf{r} = a \\, \\mathbf{x} \\,$，及其时间导数 $\\; \\dot{\\mathbf{r}} = a \\, \\dot{\\mathbf{x}} + H \\, \\mathbf{r} \\,$，其中 $\\, a \\,$ 是标度因子，$\\, H \\,$ 是哈勃参数。\n- 物理动量与本动速度之间的非相对论性关系 $\\; \\mathbf{p}_\\mathrm{phys} = m \\, \\mathbf{v}_\\mathrm{pec} \\,$。\n- 共动动量的定义 $\\; \\mathbf{q} \\equiv a \\, \\mathbf{p}_\\mathrm{phys} \\,$。\n- 一个包含物质、辐射和暗能量的平坦宇宙学模型，其哈勃参数作为标度因子的函数由 $\\; H(a) = H_0 \\sqrt{\\Omega_r a^{-4} + \\Omega_m a^{-3} + \\Omega_\\Lambda} \\,$ 给出，且 $\\; \\Omega_r + \\Omega_m + \\Omega_\\Lambda = 1 \\,$。\n\n仅使用这些基础，您必须：\n1. 推导一个各向同性的、不随时间变化的共动分布 $\\, f(\\mathbf{q}) \\,$ 如何映射到标度因子为 $\\, a \\,$ 时的物理本动速度分布 $\\, f(\\mathbf{v}_\\mathrm{pec}; a) \\,$，包括雅可比因子。然后，假设 $\\, \\mathbf{q} \\,$ 的单个分量服从均值为零、标准差为 $\\, \\sigma_q \\,$ 的高斯（麦克斯韦-玻尔兹曼代理）统计，将推导特化到一维边际分布。根据您的推导，以 $\\, \\sigma_q \\,$、$\\, a \\,$ 和 $\\, m \\,$ 表示物理本动速度分量的一维标准差 $\\, \\sigma_v(a) \\,$。\n2. 考虑一种不正确的采样实践，其中热本动速度从共动动量分布中抽取，但在映射到速度时错误地省略了因子 $\\, a \\,$。根据您的推导，仅用 $\\, a \\,$ 表示乘性偏差 $\\, r_\\mathrm{wrong}(a) \\equiv \\tilde{\\sigma}_v(a) / \\sigma_v(a) \\,$。\n3. 考虑第二种不正确的实践，其中在测量一维均方根速率之前，错误地将哈勃流加到了本动热速度上，而粒子的共动位置 $\\, x \\,$ 在区间 $\\, [-L/2, L/2] \\,$ 内均匀分布。使用均匀分布的方差 $\\, \\mathrm{Var}(x) = L^2/12 \\,$ 和您关于 $\\, H(a) \\,$ 的表达式，推导一个乘性偏差因子 $\\, R(a, L) \\,$，该因子量化了相对于仅有本动热速度的情况，均方根速率产生的偏差。用 $\\, H(a) \\,$、$\\, a \\,$、$\\, L \\,$ 和一维本动热弥散 $\\, \\sigma_v(a) \\,$ 表示 $\\, R(a, L) \\,$。\n4. 实现一个程序，对于下述每个测试用例，执行以下数值实验，以数值方式验证第 $\\, 1 \\,$ 项，并报告来自第 $\\, 2 \\,$ 项和第 $\\, 3 \\,$ 项的偏差：\n   - 使用固定的随机种子 $\\, s = 12345 \\,$ 以保证可复现性。\n   - 给定参数 $\\, (a, \\sigma_{v,1}, m, L, H_0, \\Omega_m, \\Omega_\\Lambda, \\Omega_r, N) \\,$，构造一个均值为零、标准差为 $\\, \\sigma_q = m \\, \\sigma_{v,1} \\,$ 的一维高斯共动动量分量分布，其中 $\\, \\sigma_{v,1} \\,$ 是在 $\\, a = 1 \\,$ 时会实现的一维本动速度弥散。\n   - 生成 $\\, N \\,$ 个独立样本 $\\, q \\sim \\mathcal{N}(0, \\sigma_q^2) \\,$，并使用您的推导将它们映射到本动速度，以获得一个采样集 $\\, v_\\mathrm{comoving} \\,$。\n   - 独立地使用您推导出的 $\\, \\sigma_v(a) \\,$ 生成 $\\, N \\,$ 个样本 $\\, v_\\mathrm{physical} \\sim \\mathcal{N}\\!\\big(0, \\sigma_v(a)^2\\big) \\,$。\n   - 计算经验一维标准差 $\\, \\hat{\\sigma}_\\mathrm{comoving} \\,$ 和 $\\, \\hat{\\sigma}_\\mathrm{physical} \\,$，并报告绝对分数差\n     $$ \\Delta \\;\\equiv\\; \\frac{\\left|\\hat{\\sigma}_\\mathrm{comoving} - \\hat{\\sigma}_\\mathrm{physical}\\right|}{\\sigma_v(a)} \\, . $$\n   - 计算并报告来自第 $\\, 2 \\,$ 项的解析错映射因子 $\\, r_\\mathrm{wrong}(a) \\,$。\n   - 使用每个测试中给出的宇宙学参数，计算并报告来自第 $\\, 3 \\,$ 项的解析哈勃污染偏差 $\\, R(a, L) \\,$。\n\n物理和数值单位：\n- 将速度 $\\, \\mathbf{v}_\\mathrm{pec} \\,$ 和 $\\, \\sigma_{v,1} \\,$ 以 $\\mathrm{km\\,s^{-1}}$ 为单位处理。\n- 将长度 $\\, L \\,$ 以 $\\mathrm{Mpc}$ 为单位处理。\n- 将哈勃常数 $\\, H_0 \\,$ 以 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$ 为单位处理。\n- 质量 $\\, m \\,$ 是一个任意正常数，用于通过 $\\, \\sigma_q = m \\, \\sigma_{v,1} \\,$ 来参数化 $\\, \\sigma_q \\,$；程序必须在量纲上保持一致，使得 $\\, \\sigma_v(a) \\,$ 的单位为 $\\mathrm{km\\,s^{-1}}$。\n- 所有输出 $\\, \\Delta \\,$、$\\, r_\\mathrm{wrong}(a) \\,$ 和 $\\, R(a, L) \\,$ 都是无量纲的。将数值报告为浮点数。\n\n测试套件：\n- 使用以下四个测试用例，每个用例指定为一个元组 $\\, (a, \\sigma_{v,1}, m, L, H_0, \\Omega_m, \\Omega_\\Lambda, \\Omega_r, N) \\,$：\n  1. $\\, \\left(\\frac{1}{50},\\, 10,\\, 1,\\, 10,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$。\n  2. $\\, \\left(\\frac{1}{200},\\, 10,\\, 1,\\, 10,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$。\n  3. $\\, \\left(\\frac{1}{5},\\, 10,\\, 1,\\, 50,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$。\n  4. $\\, \\left(1,\\, 10,\\, 1,\\, 10,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于上述顺序的每个测试用例，依次附加 $\\, \\Delta \\,$，然后是 $\\, r_\\mathrm{wrong}(a) \\,$，然后是 $\\, R(a, L) \\,$。因此，最终输出应包含 $\\, 12 \\,$ 个浮点数。将每个数字四舍五入到六位小数。例如，一个包含两个虚构测试用例的输出将类似于 $\\, \\left[\\Delta_1, r_{\\mathrm{wrong},1}, R_1, \\Delta_2, r_{\\mathrm{wrong},2}, R_2\\right] \\,$。", "solution": "该问题经评估在科学上是合理的、提法得当且客观的。所有必要信息均已提供，物理和数学关系在宇宙学中是标准的，任务定义清晰。因此，我将继续提供完整的解决方案。\n\n解决方案按照问题陈述分为四个部分展开。首先，我们推导共动动量分布与物理本动速度分布之间的关系。其次，我们量化不正确映射所带来的偏差。第三，我们量化错误地计入哈勃流所带来的偏差。最后，我们描述一个数值实验的实现，以验证这些发现。\n\n### 1. 物理本动速度分布的推导\n\n我们从给定的定义开始，这些定义将共动动量 $\\mathbf{q}$ 与物理本动速度 $\\mathbf{v}_\\mathrm{pec}$ 联系起来：\n1. 共动动量的定义：$\\mathbf{q} \\equiv a \\, \\mathbf{p}_\\mathrm{phys}$，其中 $a$ 是标度因子，$\\mathbf{p}_\\mathrm{phys}$ 是物理动量。\n2. 物理动量与本动速度之间的非相对论性关系：$\\mathbf{p}_\\mathrm{phys} = m \\, \\mathbf{v}_\\mathrm{pec}$，其中 $m$ 是粒子质量。\n\n结合这两个方程，我们用 $\\mathbf{v}_\\mathrm{pec}$ 来表示 $\\mathbf{q}$：\n$$\n\\mathbf{q} = a \\, (m \\, \\mathbf{v}_\\mathrm{pec}) = a \\, m \\, \\mathbf{v}_\\mathrm{pec}\n$$\n求解物理本动速度 $\\mathbf{v}_\\mathrm{pec}$，我们找到了从共动动量的映射关系：\n$$\n\\mathbf{v}_\\mathrm{pec} = \\frac{\\mathbf{q}}{a \\, m}\n$$\n问题指出，刘维尔定理意味着共动动量分布 $f(\\mathbf{q})$ 是不随时间变化的。为了找到在标度因子为 $a$ 时的物理本动速度分布 $f(\\mathbf{v}_\\mathrm{pec}; a)$，我们进行变量替换。相空间密度的守恒要求概率元相等：\n$$\nf(\\mathbf{v}_\\mathrm{pec}; a) \\, d^3v_\\mathrm{pec} = f(\\mathbf{q}) \\, d^3q\n$$\n因此，物理速度分布通过变换的雅可比行列式与共动动量分布相关联：\n$$\nf(\\mathbf{v}_\\mathrm{pec}; a) = f(\\mathbf{q}(\\mathbf{v}_\\mathrm{pec})) \\left| \\det\\left(\\frac{\\partial q_i}{\\partial v_{\\mathrm{pec},j}}\\right) \\right|\n$$\n变换关系为 $\\mathbf{q} = a \\, m \\, \\mathbf{v}_\\mathrm{pec}$。雅可比矩阵的元素是 $\\frac{\\partial q_i}{\\partial v_{\\mathrm{pec},j}} = a \\, m \\, \\delta_{ij}$。其行列式为 $(a \\, m)^3$。\n\n我们现在将问题特化到一维边际分布。让我们考虑单个分量，比如 $q_x$。相应的物理速度分量是 $v_{\\mathrm{pec},x} = \\frac{q_x}{a \\, m}$。问题假设 $q_x$ 服从均值为零、标准差为 $\\sigma_q$ 的高斯分布，即 $q_x \\sim \\mathcal{N}(0, \\sigma_q^2)$。\n\n正态分布的一个性质是，如果一个随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，那么用一个常数 $c$ 对其进行缩放会得到一个新的随机变量 $c X \\sim \\mathcal{N}(c\\mu, (c\\sigma)^2)$。在我们的例子中，缩放常数是 $1/(a \\, m)$。因此，物理本动速度分量 $v_{\\mathrm{pec},x}$ 也服从正态分布，其均值为 $E[v_{\\mathrm{pec},x}] = \\frac{1}{a \\, m} E[q_x] = 0$，方差为 $\\mathrm{Var}(v_{\\mathrm{pec},x}) = \\left(\\frac{1}{a \\, m}\\right)^2 \\mathrm{Var}(q_x) = \\left(\\frac{\\sigma_q}{a \\, m}\\right)^2$。\n\n物理本动速度分量的一维标准差，记作 $\\sigma_v(a)$，是该方差的平方根：\n$$\n\\sigma_v(a) = \\frac{\\sigma_q}{a \\, m}\n$$\n问题进一步规定 $\\sigma_q$ 被参数化为 $\\sigma_q = m \\, \\sigma_{v,1}$，其中 $\\sigma_{v,1}$ 是在 $a=1$ 时的本动速度弥散。将此代入我们对 $\\sigma_v(a)$ 的表达式中，得到：\n$$\n\\sigma_v(a) = \\frac{m \\, \\sigma_{v,1}}{a \\, m} = \\frac{\\sigma_{v,1}}{a}\n$$\n这个结果正确地显示了随着宇宙的膨胀，本动速度会以 $1/a$ 的形式衰减。\n\n### 2. 错误速度映射带来的偏差\n\n第一种不正确的做法是在映射中省略了标度因子 $a$。错误采样的速度 $\\tilde{\\mathbf{v}}_\\mathrm{pec}$ 计算如下：\n$$\n\\tilde{\\mathbf{v}}_\\mathrm{pec} = \\frac{\\mathbf{q}}{m}\n$$\n遵循与上述相同的统计论证，这个不正确速度的单个分量的标准差 $\\tilde{\\sigma}_v(a)$ 为：\n$$\n\\tilde{\\sigma}_v(a) = \\frac{\\sigma_q}{m}\n$$\n乘性偏差因子 $r_\\mathrm{wrong}(a)$ 是不正确的标准差与正确的标准差之比：\n$$\nr_\\mathrm{wrong}(a) \\equiv \\frac{\\tilde{\\sigma}_v(a)}{\\sigma_v(a)} = \\frac{\\sigma_q / m}{\\sigma_q / (a \\, m)} = \\frac{a \\, m}{m} = a\n$$\n该偏差就是标度因子 $a$。对于在早期宇宙（$a \\ll 1$）设定的初始条件，这个错误会导致对真实热速度的显著低估。\n\n### 3. 哈勃流污染带来的偏差\n\n第二种不正确的做法是在计算速度弥散之前，错误地将哈勃流加到本动速度上。一个粒子的总一维速度是其本动速度与局部哈勃流之和：\n$$\nv_\\mathrm{total,x} = \\mathbf{v}_\\mathrm{pec} \\cdot \\hat{\\mathbf{x}} + (H(a) \\mathbf{r}) \\cdot \\hat{\\mathbf{x}} = v_{\\mathrm{pec},x} + H(a) r_x\n$$\n使用关系式 $\\mathbf{r} = a \\, \\mathbf{x}$，我们有 $r_x = a \\, x$。因此：\n$$\nv_\\mathrm{total,x} = v_{\\mathrm{pec},x} + H(a) \\, a \\, x\n$$\n乘性偏差 $R(a, L)$ 是总速度的均方根（RMS）与仅本动速度的均方根之比。一个零均值随机变量的均方根就是其标准差。\n$$\nR(a, L) = \\frac{\\sqrt{E[v_\\mathrm{total,x}^2]}}{\\sqrt{E[v_{\\mathrm{pec},x}^2]}}\n$$\n我们知道 $E[v_{\\mathrm{pec},x}^2] = \\mathrm{Var}(v_{\\mathrm{pec},x}) = \\sigma_v(a)^2$，因为其均值为零。现在我们计算总速度的均方值：\n$$\nE[v_\\mathrm{total,x}^2] = E[(v_{\\mathrm{pec},x} + H(a) \\, a \\, x)^2] = E[v_{\\mathrm{pec},x}^2 + 2 H(a) \\, a \\, x \\, v_{\\mathrm{pec},x} + (H(a) \\, a \\, x)^2]\n$$\n根据期望的线性性质：\n$$\nE[v_\\mathrm{total,x}^2] = E[v_{\\mathrm{pec},x}^2] + 2 H(a) \\, a \\, E[x \\, v_{\\mathrm{pec},x}] + (H(a) \\, a)^2 E[x^2]\n$$\n粒子的本动热速度 $v_{\\mathrm{pec},x}$ 与其共动位置 $x$ 在统计上是独立的。因此，$E[x \\, v_{\\mathrm{pec},x}] = E[x] E[v_{\\mathrm{pec},x}]$。位置 $x$ 从区间 $[-L/2, L/2]$ 上的均匀分布中抽取，其均值为 $E[x] = 0$。本动速度来自均值为 $E[v_{\\mathrm{pec},x}] = 0$ 的高斯分布。因此，交叉项为零。\n\n表达式简化为：\n$$\nE[v_\\mathrm{total,x}^2] = E[v_{\\mathrm{pec},x}^2] + (H(a) \\, a)^2 E[x^2]\n$$\n对于 $[-L/2, L/2]$ 上的均匀分布，其方差为 $\\mathrm{Var}(x) = L^2/12$。由于 $E[x]=0$，我们有 $E[x^2] = \\mathrm{Var}(x) = L^2/12$。将此式和 $E[v_{\\mathrm{pec},x}^2] = \\sigma_v(a)^2$ 代入，我们得到：\n$$\nE[v_\\mathrm{total,x}^2] = \\sigma_v(a)^2 + (H(a) \\, a)^2 \\frac{L^2}{12}\n$$\n偏差因子 $R(a, L)$ 于是为：\n$$\nR(a, L) = \\frac{\\sqrt{\\sigma_v(a)^2 + (H(a) \\, a \\, L)^2 / 12}}{\\sigma_v(a)} = \\sqrt{1 + \\frac{(H(a) \\, a \\, L)^2}{12 \\sigma_v(a)^2}}\n$$\n哈勃参数 $H(a)$ 由平坦宇宙的弗里德曼方程给出：\n$$\nH(a) = H_0 \\sqrt{\\Omega_r a^{-4} + \\Omega_m a^{-3} + \\Omega_\\Lambda}\n$$\n\n### 4. 数值实现\n\n程序将为每个测试用例实现推导出的公式。\n- 对于给定的测试用例 $(a, \\sigma_{v,1}, m, L, H_0, \\Omega_m, \\Omega_\\Lambda, \\Omega_r, N)$:\n  1. 将随机种子固定为 $s=12345$ 以保证所有测试的可复现性。\n  2. 计算理论速度弥散 $\\sigma_v(a) = \\sigma_{v,1}/a$。\n  3. 计算共动动量弥散 $\\sigma_q = m \\, \\sigma_{v,1}$。\n  4. 生成 $N$ 个样本 $q_i \\sim \\mathcal{N}(0, \\sigma_q^2)$。将它们映射到物理速度 $v_i = q_i / (a \\, m)$ 并计算样本标准差 $\\hat{\\sigma}_\\mathrm{comoving}$。\n  5. 独立地从目标物理分布 $v'_i \\sim \\mathcal{N}(0, \\sigma_v(a)^2)$ 生成 $N$ 个样本，并计算它们的样本标准差 $\\hat{\\sigma}_\\mathrm{physical}$。\n  6. 计算分数差 $\\Delta = |\\hat{\\sigma}_\\mathrm{comoving} - \\hat{\\sigma}_\\mathrm{physical}| / \\sigma_v(a)$。此值应很小，与采样噪声一致，从而验证两种采样方法是等效的。\n  7. 计算错误映射的解析偏差：$r_\\mathrm{wrong}(a) = a$。\n  8. 使用给定的 $H(a)$ 公式，计算哈勃流污染的解析偏差：$R(a, L) = \\sqrt{1 + (H(a) a L)^2 / (12 \\sigma_v(a)^2)}$。\n  9. 对于每个用例，报告三个无量纲量 $\\Delta$、 $r_\\mathrm{wrong}(a)$ 和 $R(a, L)$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the warm dark matter thermal velocity sampling problem.\n\n    This function iterates through a set of test cases, each defining a cosmological\n    scenario. For each case, it:\n    1. Numerically validates that sampling from a comoving momentum distribution and\n       correctly mapping to physical velocity is equivalent to sampling directly\n       from the physical velocity distribution. The result is the fractional \n       difference Delta.\n    2. Analytically calculates the multiplicative bias factor `r_wrong` that arises \n       from an incorrect mapping (omitting the scale factor).\n    3. Analytically calculates the multiplicative bias factor `R` that arises from\n       contaminating peculiar velocity measurements with the Hubble flow.\n\n    The results from all test cases are collated and printed in the required format.\n    \"\"\"\n    \n    # Test suite: (a, sigma_v1, m, L, H0, Omega_m, Omega_Lambda, Omega_r, N)\n    test_cases = [\n        (1/50, 10, 1, 10, 70, 0.3, 0.7, 8.4e-5, 200000),\n        (1/200, 10, 1, 10, 70, 0.3, 0.7, 8.4e-5, 200000),\n        (1/5, 10, 1, 50, 70, 0.3, 0.7, 8.4e-5, 200000),\n        (1, 10, 1, 10, 70, 0.3, 0.7, 8.4e-5, 200000),\n    ]\n\n    all_results = []\n    \n    # Use a single random number generator for the entire process for reproducibility.\n    # The seed is fixed as per the problem statement.\n    rng = np.random.default_rng(12345)\n\n    for case in test_cases:\n        a, sigma_v1, m, L, H0, Omega_m, Omega_Lambda, Omega_r, N = case\n\n        # ----------------------------------------------------------------------\n        # Part 1: Numerical validation and calculation of Delta\n        # ----------------------------------------------------------------------\n        \n        # Theoretical 1D peculiar velocity dispersion at scale factor a\n        # sigma_v(a) = sigma_{v,1} / a\n        sigma_v_a = sigma_v1 / a\n\n        # 1D comoving momentum dispersion\n        # sigma_q = m * sigma_{v,1}\n        sigma_q = m * sigma_v1\n\n        # Method 1: Sample from comoving momentum and map to physical velocity\n        # q ~ N(0, sigma_q^2)\n        q_samples = rng.normal(loc=0.0, scale=sigma_q, size=N)\n        # v_pec = q / (a * m)\n        v_comoving_samples = q_samples / (a * m)\n        hat_sigma_comoving = np.std(v_comoving_samples)\n\n        # Method 2: Sample directly from the physical velocity distribution\n        # v_pec ~ N(0, sigma_v(a)^2)\n        v_physical_samples = rng.normal(loc=0.0, scale=sigma_v_a, size=N)\n        hat_sigma_physical = np.std(v_physical_samples)\n\n        # Compute the absolute fractional difference Delta\n        delta = np.abs(hat_sigma_comoving - hat_sigma_physical) / sigma_v_a\n        all_results.append(delta)\n\n        # ----------------------------------------------------------------------\n        # Part 2: Analytic calculation of the wrong-mapping factor r_wrong\n        # ----------------------------------------------------------------------\n        \n        # r_wrong(a) = a\n        r_wrong = a\n        all_results.append(r_wrong)\n\n        # ----------------------------------------------------------------------\n        # Part 3: Analytic calculation of the Hubble-contamination bias R\n        # ----------------------------------------------------------------------\n\n        # Hubble parameter at scale factor a\n        # H(a) = H0 * sqrt(Omega_r*a^-4 + Omega_m*a^-3 + Omega_Lambda)\n        H_a = H0 * np.sqrt(Omega_r * a**-4 + Omega_m * a**-3 + Omega_Lambda)\n\n        # Multiplicative bias factor R(a, L)\n        # R(a, L) = sqrt(1 + (H(a)*a*L)^2 / (12*sigma_v(a)^2))\n        R_a_L = np.sqrt(1.0 + (H_a * a * L)**2 / (12.0 * sigma_v_a**2))\n        all_results.append(R_a_L)\n\n    # Print all results in the specified format, rounded to 6 decimal places.\n    print(f\"[{','.join([f'{val:.6f}' for val in all_results])}]\")\n\nsolve()\n\n```", "id": "3489237"}]}