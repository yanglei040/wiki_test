{"hands_on_practices": [{"introduction": "在大型模拟中，进行完全依赖频率的辐射转移计算量巨大，因此我们通常使用频率平均的“灰色”不透明度。本练习 [@problem_id:3483018] 探讨了两个关键的平均值——普朗克平均不透明度和罗斯兰平均不透明度——是如何导出的。通过这个练习，您将理解它们如何依赖于温度，从而将微观的频率相关属性（$\\kappa_{\\nu}$）与宏观的温度相关量（$\\kappa_P, \\kappa_R$）联系起来。", "problem": "在数值宇宙学中，辐射-流体力学（RHD）耦合需要使用灰色不透明度，它将频率相关的微观物理聚合成有效的、与温度相关的系数。两个这样的系数是 Planck 平均不透明度和 Rosseland 平均不透明度。设单色吸收不透明度是频率的幂律，$\\kappa_{\\nu} \\propto \\nu^{2}$，且辐射场是温度为 $T$ 的黑体，由 Planck 定律 $B_{\\nu}(T)$ 描述。\n\n从核心定义\n$$\\kappa_{P}(T) \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu}{\\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu}, \\quad \\text{和} \\quad \\frac{1}{\\kappa_{R}(T)} \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu}{\\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu},$$\n并使用 Planck 定律\n$$B_{\\nu}(T) = \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\!\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1},$$\n通过评估相关积分的温度依赖性，推导 $\\kappa_{P}$ 和 $\\kappa_{R}$ 如何随 $T$ 变化（不计乘法常数）。假设纯吸收（无散射）、空间均匀性和各向同性。将最终答案表示为一个行矩阵，其两个元素分别为 $\\kappa_{P}(T)$ 和 $\\kappa_{R}(T)$ 对 $T$ 的依赖关系。不需要进行数值计算或四舍五入，并省略所有与 $T$ 无关的乘法常数。", "solution": "问题陈述经评估有效。它在科学上基于辐射转移和统计力学的原理，问题表述清晰，提供了足够的信息以获得关于温度标度的唯一解，并以客观、正式的语言表达。所提供的定义和函数形式是天体物理学和数值宇宙学中的标准形式。我们可以开始推导。\n\n目标是在给定单色不透明度 $\\kappa_{\\nu} \\propto \\nu^{2}$ 的情况下，确定 Planck 平均不透明度 $\\kappa_{P}(T)$ 和 Rosseland 平均不透明度 $\\kappa_{R}(T)$ 的温度依赖性。我们将通过检查定义积分的温度标度关系来分别分析每种情况。设不透明度的比例常数为 $A$，使得 $\\kappa_{\\nu} = A \\nu^{2}$，其中 $A$ 与频率 $\\nu$ 和温度 $T$ 无关。\n\n首先，我们分析 Planck 平均不透明度 $\\kappa_{P}(T)$，其定义为：\n$$ \\kappa_{P}(T) \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu}{\\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu} $$\n我们将分别评估分子和分母的温度依赖性。\n\n分母是黑体的总强度，通过对 Planck 函数 $B_{\\nu}(T)$ 在所有频率上积分得到：\n$$ \\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu = \\int_{0}^{\\infty} \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} d\\nu $$\n为了评估温度依赖性，我们进行变量替换，引入无量纲频率 $x = \\frac{h \\nu}{k_{B} T}$。这意味着 $\\nu = \\frac{k_{B} T}{h} x$ 和 $d\\nu = \\frac{k_{B} T}{h} dx$。将这些代入积分中：\n$$ \\int_{0}^{\\infty} \\frac{2h}{c^{2}} \\left(\\frac{k_{B} T}{h}x\\right)^{3} \\frac{1}{\\exp(x) - 1} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2h}{c^{2}} \\left(\\frac{k_{B}}{h}\\right)^{4} T^{4} \\int_{0}^{\\infty} \\frac{x^{3}}{\\exp(x) - 1} dx $$\n积分 $\\int_{0}^{\\infty} \\frac{x^{3}}{\\exp(x) - 1} dx = \\frac{\\pi^{4}}{15}$ 是一个无量纲常数。因此，分母与 $T^{4}$ 成正比。这与 Stefan-Boltzmann 定律一致，其中总辐射功率与 $T^{4}$ 成正比。\n$$ \\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu \\propto T^{4} $$\n\n接下来，我们分析 $\\kappa_{P}(T)$ 表达式的分子，代入 $\\kappa_{\\nu} = A \\nu^{2}$：\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu = \\int_{0}^{\\infty} (A \\nu^{2}) \\left( \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} \\right) d\\nu = \\frac{2hA}{c^{2}} \\int_{0}^{\\infty} \\nu^{5} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} d\\nu $$\n使用相同的变量替换 $x = \\frac{h \\nu}{k_{B} T}$：\n$$ \\frac{2hA}{c^{2}} \\int_{0}^{\\infty} \\left(\\frac{k_{B} T}{h}x\\right)^{5} \\frac{1}{\\exp(x) - 1} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2hA}{c^{2}} \\left(\\frac{k_{B}}{h}\\right)^{6} T^{6} \\int_{0}^{\\infty} \\frac{x^{5}}{\\exp(x) - 1} dx $$\n积分 $\\int_{0}^{\\infty} \\frac{x^{5}}{\\exp(x) - 1} dx$ 是另一个无量纲常数。因此，分子与 $T^{6}$ 成正比：\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu \\propto T^{6} $$\n结合分子和分母的结果，Planck 平均不透明度的温度标度关系是：\n$$ \\kappa_{P}(T) \\propto \\frac{T^{6}}{T^{4}} = T^{2} $$\n\n其次，我们分析 Rosseland 平均不透明度 $\\kappa_{R}(T)$，其通过倒数定义：\n$$ \\frac{1}{\\kappa_{R}(T)} \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu}{\\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu} $$\n从 $\\kappa_{\\nu} = A \\nu^{2}$，我们得到 $\\kappa_{\\nu}^{-1} = A^{-1} \\nu^{-2}$。我们首先需要 Planck 函数对温度的偏导数：\n$$ \\frac{\\partial B_{\\nu}(T)}{\\partial T} = \\frac{\\partial}{\\partial T} \\left( \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} \\right) $$\n$$ = \\frac{2 h \\nu^{3}}{c^{2}} (-1) \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-2} \\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) \\left(-\\frac{h \\nu}{k_{B} T^{2}}\\right) $$\n$$ = \\frac{2 h^{2} \\nu^{4}}{c^{2} k_{B} T^{2}} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} $$\n现在，我们评估 $1/\\kappa_{R}(T)$ 表达式的分母。我们可以注意到，因为 $\\int_{0}^{\\infty} B_{\\nu}(T) d\\nu \\propto T^{4}$，所以 $\\frac{\\partial}{\\partial T}\\int_{0}^{\\infty} B_{\\nu}(T) d\\nu \\propto T^{3}$。交换求导和积分的顺序，$\\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu \\propto T^{3}$。让我们通过直接积分来验证这一点。\n$$ \\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu = \\int_{0}^{\\infty} \\frac{2 h^{2} \\nu^{4}}{c^{2} k_{B} T^{2}} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} d\\nu $$\n使用变量替换 $x = \\frac{h \\nu}{k_{B} T}$：\n$$ \\frac{2 h^{2}}{c^{2} k_{B} T^{2}} \\int_{0}^{\\infty} \\left(\\frac{k_{B} T}{h}x\\right)^{4} \\frac{\\exp(x)}{[\\exp(x) - 1]^{2}} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2 k_{B}^{4}}{c^{2} h^{3}} T^{3} \\int_{0}^{\\infty} \\frac{x^{4} \\exp(x)}{[\\exp(x) - 1]^{2}} dx $$\n积分是一个常数，所以分母的标度关系为 $T^{3}$：\n$$ \\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu \\propto T^{3} $$\n接下来，我们评估 $1/\\kappa_{R}(T)$ 表达式的分子，其中 $\\kappa_{\\nu}^{-1} = A^{-1} \\nu^{-2}$：\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu = \\int_{0}^{\\infty} (A^{-1} \\nu^{-2}) \\left( \\frac{2 h^{2} \\nu^{4}}{c^{2} k_{B} T^{2}} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} \\right) d\\nu $$\n$$ = \\frac{2 h^{2} A^{-1}}{c^{2} k_{B} T^{2}} \\int_{0}^{\\infty} \\nu^{2} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} d\\nu $$\n使用变量替换 $x = \\frac{h \\nu}{k_{B} T}$：\n$$ \\frac{2 h^{2} A^{-1}}{c^{2} k_{B} T^{2}} \\int_{0}^{\\infty} \\left(\\frac{k_{B} T}{h}x\\right)^{2} \\frac{\\exp(x)}{[\\exp(x)-1]^{2}} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2 k_{B}^{2} A^{-1}}{c^{2} h} T^{1} \\int_{0}^{\\infty} \\frac{x^{2} \\exp(x)}{[\\exp(x) - 1]^{2}} dx $$\n积分是一个常数，所以分子的标度关系为 $T^{1}$：\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu \\propto T $$\n结合 $1/\\kappa_{R}(T)$ 的分子和分母的结果：\n$$ \\frac{1}{\\kappa_{R}(T)} \\propto \\frac{T}{T^{3}} = T^{-2} $$\n因此，Rosseland 平均不透明度的温度标度关系是：\n$$ \\kappa_{R}(T) \\propto (T^{-2})^{-1} = T^{2} $$\nPlanck 和 Rosseland 平均不透明度的标度关系均为温度的平方。", "answer": "$$\\boxed{\\begin{pmatrix} T^{2}  T^{2} \\end{pmatrix}}$$", "id": "3483018"}, {"introduction": "在确定了辐射场后，下一步是计算其对气体状态的改变，特别是光致电离率和光致加热率。本练习 [@problem_id:3482933] 演示了如何使用“多组”方法，为一个假设的幂律谱计算这些关键的源项。这是一种在实际数值代码中用于平衡计算精度和效率的实用近似方法，对于理解辐射如何驱动气体演化至关重要。", "problem": "考虑一个嵌入在空间均匀、静态、光学薄的氢介质中的电离辐射点源，这是数值宇宙学中辐射-流体力学（RHD）耦合的典型设置。该源以谱光度 $L_{\\nu}$ 进行各向同性发射，该光度在氢光致电离阈值频率 $\\nu_0$ 以下为零，在 $\\nu_0$ 以上遵循幂律，具体为 $L_{\\nu} = L_0 \\left(\\nu/\\nu_0\\right)^{-3/2}$（对于 $\\nu \\ge \\nu_0$），其中 $L_0$ 是一个常数。介质是纯中性氢，其光致电离截面为 $\\sigma_{\\nu} = \\sigma_0 \\left(\\nu/\\nu_0\\right)^{-3}$（对于 $\\nu \\ge \\nu_0$），其中 $\\sigma_0$ 是阈值处的截面。假设辐射在传播过程中没有衰减，并到达距离源 $r$ 的一个场点。令 $h$ 表示普朗克常数。\n\n在基于矩的辐射输运中常用的双组近似法中，将电离频率域划分为两组：第1组覆盖 $[\\nu_0, 2\\nu_0]$，第2组覆盖 $[2\\nu_0, \\infty)$。使用每个中性氢原子的光致电离和光致加热的第一性原理定义：\n- 在频率区间 $[\\nu_a,\\nu_b]$ 中，每个原子的光致电离率为 $\\Gamma = \\int_{\\nu_a}^{\\nu_b} \\left(F_{\\nu}/(h\\nu)\\right) \\sigma_{\\nu}\\,\\mathrm{d}\\nu$，其中 $F_{\\nu}$ 是场点处的谱能量通量。\n- 在频率区间 $[\\nu_a,\\nu_b]$ 中，每个原子的光致加热率为 $H = \\int_{\\nu_a}^{\\nu_b} \\left(F_{\\nu}/(h\\nu)\\right) \\sigma_{\\nu}\\,(h\\nu - h\\nu_0)\\,\\mathrm{d}\\nu$。\n\n假设仅有几何稀释，因此 $F_{\\nu} = L_{\\nu}/(4\\pi r^{2})$。推导双组光致电离率 $\\Gamma_1$ 和 $\\Gamma_2$，以及双组光致加热率 $H_1$ 和 $H_2$ 的闭式表达式，用 $L_0$、$\\sigma_0$、$\\nu_0$、$r$ 和 $h$ 表示。将你的最终答案表示为一个包含 $(\\Gamma_1, \\Gamma_2, H_1, H_2)$ 的单行矩阵。不要代入常数的数值。光致电离率应以 $\\mathrm{s}^{-1}$ 表示，光致加热率应以每个原子的单位时间能量表示（例如 $\\mathrm{J}\\,\\mathrm{s}^{-1}$）。不需要四舍五入；提供精确的解析表达式。", "solution": "该问题是有效的，因为它在科学上基于辐射转移的原理，信息完备、问题明确，并且以客观、正式的语言陈述。我们可以继续推导所要求的量。\n\n核心任务是为双组光致电离率（$\\Gamma_1, \\Gamma_2$）和光致加热率（$H_1, H_2$）计算四个定积分。\n\n首先，我们确定公共的被积项。距离各向同性源 $r$ 处的谱能量通量 $F_{\\nu}$ 由几何稀释给出：\n$$ F_{\\nu} = \\frac{L_{\\nu}}{4\\pi r^{2}} $$\n代入给定的谱光度幂律 $L_{\\nu} = L_0 \\left(\\nu/\\nu_0\\right)^{-3/2}$（对于 $\\nu \\ge \\nu_0$）：\n$$ F_{\\nu} = \\frac{L_0}{4\\pi r^{2}} \\left(\\frac{\\nu}{\\nu_0}\\right)^{-3/2} $$\n光致电离截面给定为 $\\sigma_{\\nu} = \\sigma_0 \\left(\\nu/\\nu_0\\right)^{-3}$（对于 $\\nu \\ge \\nu_0$）。\n\n单位面积、单位时间、单位频率的电离光子数为 $F_{\\nu}/(h\\nu)$。每个原子单位频率的光致电离事件率是这个量乘以截面 $\\sigma_{\\nu}$：\n$$ \\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}\\nu} = \\frac{F_{\\nu}}{h\\nu}\\sigma_{\\nu} = \\frac{1}{h\\nu} \\left( \\frac{L_0}{4\\pi r^{2}} \\left(\\frac{\\nu}{\\nu_0}\\right)^{-3/2} \\right) \\left( \\sigma_0 \\left(\\frac{\\nu}{\\nu_0}\\right)^{-3} \\right) $$\n$$ = \\frac{L_0 \\sigma_0}{4\\pi h r^{2}} \\frac{1}{\\nu} \\left(\\frac{\\nu}{\\nu_0}\\right)^{-9/2} = \\frac{L_0 \\sigma_0}{4\\pi h r^{2}} \\frac{\\nu_0^{9/2}}{\\nu^{11/2}} = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\nu^{-11/2} $$\n我们为这组项定义一个常数，$C_{\\Gamma} = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}}$。微分光致电离率为 $C_{\\Gamma} \\nu^{-11/2}$。\n\n每个原子的光致加热率 $H$ 由频率为 $\\nu$ 的光致电离率乘以光子的剩余能量 $h\\nu - h\\nu_0$ 的积分给出。\n$$ \\frac{\\mathrm{d}H}{\\mathrm{d}\\nu} = \\frac{F_{\\nu}}{h\\nu}\\sigma_{\\nu} (h\\nu - h\\nu_0) = \\left(\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}\\nu}\\right) h(\\nu - \\nu_0) = F_{\\nu}\\sigma_{\\nu}\\left(1 - \\frac{\\nu_0}{\\nu}\\right) $$\n让我们代入 $F_{\\nu}$ 和 $\\sigma_{\\nu}$ 的表达式：\n$$ F_{\\nu}\\sigma_{\\nu} = \\left( \\frac{L_0}{4\\pi r^{2}} \\left(\\frac{\\nu}{\\nu_0}\\right)^{-3/2} \\right) \\left( \\sigma_0 \\left(\\frac{\\nu}{\\nu_0}\\right)^{-3} \\right) = \\frac{L_0 \\sigma_0}{4\\pi r^{2}} \\left(\\frac{\\nu}{\\nu_0}\\right)^{-9/2} = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\nu^{-9/2} $$\n因此微分光致加热率为：\n$$ \\frac{\\mathrm{d}H}{\\mathrm{d}\\nu} = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\nu^{-9/2} \\left(1 - \\frac{\\nu_0}{\\nu}\\right) = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\left(\\nu^{-9/2} - \\nu_0 \\nu^{-11/2}\\right) $$\n\n现在我们可以通过在指定的频率组上对这些微分形式进行积分来计算这四个率。\n\n**1. 第1组的光致电离率 ($\\Gamma_1$)**：\n第1组覆盖频率范围 $[\\nu_0, 2\\nu_0]$。\n$$ \\Gamma_1 = \\int_{\\nu_0}^{2\\nu_0} \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\nu^{-11/2} \\, \\mathrm{d}\\nu = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\int_{\\nu_0}^{2\\nu_0} \\nu^{-11/2} \\, \\mathrm{d}\\nu $$\n积分为 $\\int \\nu^{-11/2} \\, \\mathrm{d}\\nu = \\frac{\\nu^{-9/2}}{-9/2} = -\\frac{2}{9}\\nu^{-9/2}$。\n$$ \\int_{\\nu_0}^{2\\nu_0} \\nu^{-11/2} \\, \\mathrm{d}\\nu = \\left[-\\frac{2}{9}\\nu^{-9/2}\\right]_{\\nu_0}^{2\\nu_0} = -\\frac{2}{9}\\left((2\\nu_0)^{-9/2} - \\nu_0^{-9/2}\\right) = \\frac{2}{9}\\nu_0^{-9/2}\\left(1 - 2^{-9/2}\\right) $$\n将此结果代回 $\\Gamma_1$ 的表达式中：\n$$ \\Gamma_1 = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\left( \\frac{2}{9}\\nu_0^{-9/2}\\left(1 - 2^{-9/2}\\right) \\right) = \\frac{2 L_0 \\sigma_0}{36 \\pi h r^{2}} \\left(1 - 2^{-9/2}\\right) = \\frac{L_0 \\sigma_0}{18 \\pi h r^{2}} \\left(1 - 2^{-9/2}\\right) $$\n\n**2. 第2组的光致电离率 ($\\Gamma_2$)**：\n第2组覆盖范围 $[2\\nu_0, \\infty)$。\n$$ \\Gamma_2 = \\int_{2\\nu_0}^{\\infty} \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\nu^{-11/2} \\, \\mathrm{d}\\nu = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\left[-\\frac{2}{9}\\nu^{-9/2}\\right]_{2\\nu_0}^{\\infty} $$\n$$ = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\left(0 - \\left(-\\frac{2}{9}(2\\nu_0)^{-9/2}\\right)\\right) = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi h r^{2}} \\left(\\frac{2}{9} 2^{-9/2} \\nu_0^{-9/2}\\right) = \\frac{L_0 \\sigma_0}{18 \\pi h r^{2}} 2^{-9/2} $$\n\n**3. 第1组的光致加热率 ($H_1$)**：\n第1组覆盖 $[\\nu_0, 2\\nu_0]$。\n$$ H_1 = \\int_{\\nu_0}^{2\\nu_0} \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\left(\\nu^{-9/2} - \\nu_0 \\nu^{-11/2}\\right) \\, \\mathrm{d}\\nu $$\n括号内项的积分为：\n$$ \\int \\left(\\nu^{-9/2} - \\nu_0 \\nu^{-11/2}\\right) \\, \\mathrm{d}\\nu = \\frac{\\nu^{-7/2}}{-7/2} - \\nu_0 \\left(\\frac{\\nu^{-9/2}}{-9/2}\\right) = -\\frac{2}{7}\\nu^{-7/2} + \\frac{2\\nu_0}{9}\\nu^{-9/2} $$\n计算定积分：\n$$ \\left[-\\frac{2}{7}\\nu^{-7/2} + \\frac{2\\nu_0}{9}\\nu^{-9/2}\\right]_{\\nu_0}^{2\\nu_0} = \\left(-\\frac{2}{7}(2\\nu_0)^{-7/2} + \\frac{2\\nu_0}{9}(2\\nu_0)^{-9/2}\\right) - \\left(-\\frac{2}{7}\\nu_0^{-7/2} + \\frac{2}{9}\\nu_0^{-7/2}\\right) $$\n$$ = \\nu_0^{-7/2}\\left(-\\frac{2}{7}2^{-7/2} + \\frac{2}{9}2^{-9/2}\\right) - \\nu_0^{-7/2}\\left(-\\frac{2}{7} + \\frac{2}{9}\\right) $$\n$$ = \\nu_0^{-7/2}\\left(-\\frac{18}{63}2^{-7/2} + \\frac{14}{63}2^{-9/2} + \\frac{18-14}{63}\\right) = \\frac{\\nu_0^{-7/2}}{63}\\left(-18 \\cdot 2^{-7/2} + 14 \\cdot 2^{-9/2} + 4\\right) $$\n使用 $14 \\cdot 2^{-9/2} = 7 \\cdot 2 \\cdot 2^{-9/2} = 7 \\cdot 2^{-7/2}$：\n$$ = \\frac{\\nu_0^{-7/2}}{63}\\left(-18 \\cdot 2^{-7/2} + 7 \\cdot 2^{-7/2} + 4\\right) = \\frac{\\nu_0^{-7/2}}{63}\\left(4 - 11 \\cdot 2^{-7/2}\\right) $$\n将此结果代回 $H_1$ 的表达式中：\n$$ H_1 = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\frac{\\nu_0^{-7/2}}{63}\\left(4 - 11 \\cdot 2^{-7/2}\\right) = \\frac{L_0 \\sigma_0 \\nu_0}{252 \\pi r^{2}}\\left(4 - 11 \\cdot 2^{-7/2}\\right) $$\n\n**4. 第2组的光致加热率 ($H_2$)**：\n第2组覆盖 $[2\\nu_0, \\infty)$。\n$$ H_2 = \\int_{2\\nu_0}^{\\infty} \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\left(\\nu^{-9/2} - \\nu_0 \\nu^{-11/2}\\right) \\, \\mathrm{d}\\nu $$\n使用 $H_1$ 计算中的反导数：\n$$ \\left[-\\frac{2}{7}\\nu^{-7/2} + \\frac{2\\nu_0}{9}\\nu^{-9/2}\\right]_{2\\nu_0}^{\\infty} = 0 - \\left(-\\frac{2}{7}(2\\nu_0)^{-7/2} + \\frac{2\\nu_0}{9}(2\\nu_0)^{-9/2}\\right) $$\n括号中的项是反导数在 $2\\nu_0$ 处的值。如 $H_1$ 计算中所示，这部分可简化为：\n$$ -\\frac{2}{7}2^{-7/2}\\nu_0^{-7/2} + \\frac{2}{9}2^{-9/2}\\nu_0^{-7/2} = \\frac{\\nu_0^{-7/2}}{63}(-18 \\cdot 2^{-7/2} + 7 \\cdot 2^{-7/2}) = -\\frac{11}{63} 2^{-7/2} \\nu_0^{-7/2} $$\n因此积分值为 $0 - \\left(-\\frac{11}{63} 2^{-7/2} \\nu_0^{-7/2}\\right) = \\frac{11}{63} 2^{-7/2} \\nu_0^{-7/2}$。\n将此结果代回 $H_2$ 的表达式中：\n$$ H_2 = \\frac{L_0 \\sigma_0 \\nu_0^{9/2}}{4\\pi r^{2}} \\left(\\frac{11}{63} 2^{-7/2} \\nu_0^{-7/2}\\right) = \\frac{11 L_0 \\sigma_0 \\nu_0}{252 \\pi r^{2}} 2^{-7/2} $$\n\n推导出的四个量为：\n$\\Gamma_1 = \\frac{L_0 \\sigma_0}{18 \\pi h r^2} \\left(1 - 2^{-9/2}\\right)$\n$\\Gamma_2 = \\frac{L_0 \\sigma_0}{18 \\pi h r^2} 2^{-9/2}$\n$H_1 = \\frac{L_0 \\sigma_0 \\nu_0}{252 \\pi r^2} \\left(4 - 11 \\cdot 2^{-7/2}\\right)$\n$H_2 = \\frac{11 L_0 \\sigma_0 \\nu_0}{252 \\pi r^2} 2^{-7/2}$\n这些是最终的闭式表达式。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{L_0 \\sigma_0}{18 \\pi h r^{2}} \\left(1 - 2^{-9/2}\\right)  \\frac{L_0 \\sigma_0}{18 \\pi h r^{2}} 2^{-9/2}  \\frac{L_0 \\sigma_0 \\nu_0}{252 \\pi r^{2}} \\left(4 - 11 \\cdot 2^{-7/2}\\right)  \\frac{11 L_0 \\sigma_0 \\nu_0}{252 \\pi r^{2}} 2^{-7/2} \\end{pmatrix} } $$", "id": "3482933"}, {"introduction": "辐射流体力学模拟中的一个主要挑战是光传播时间尺度与流体动力学时间尺度之间的巨大差异，这给数值计算带来了困难。降速光速近似（RSLA）是解决这一问题的强大技术。本练习 [@problem_id:3482963] 提供了一个动手实践的机会，通过编写代码来量化 RSLA 引入的误差，帮助您深入理解这种近似在光学薄和光学厚两种不同物理情境下对关键物理量的影响。", "problem": "你需要量化由减速光速近似（reduced speed-of-light approximation, RSLA）引入的数值误差，该近似由一个减小的速度 $c_{\\rm red}$（其中 $0  c_{\\rm red}  c$）定义。你需要在一系列光学薄（流体）和光学厚（扩散）的区制中，对数值宇宙学中的三个核心耦合辐射流体动力学可观测量进行量化：电离前沿速度、辐射压强以及一个辐射修正的激波指示符。你的推导和实现必须从第一性原理和经过充分检验的公式出发，并保证科学上的一致性。\n\n从以下在一维空间和灰体辐射下的基本原理、定义和闭合关系开始：\n- 辐射能量密度 $E$ 和辐射通量 $F$ 满足由爱丁顿因子闭合的矩方程。在光学薄的流体极限下，$F$ 沿着射线方向趋近于 $c E$，辐射压强 $P_r$ 趋近于 $E$。在光学厚的扩散极限下，通量遵循菲克定律 $F \\approx -D \\,\\partial_x E$，其中扩散系数 $D = \\frac{c}{3 \\kappa \\rho}$，$\\kappa$ 为吸收不透明度，$\\rho$ 为质量密度，辐射压强闭合关系为 $P_r \\approx \\frac{E}{3}$。\n- 在数密度为 $n_{\\rm H}$ 的均匀氢介质中，电离前沿（I-front）速度 $v_I$ 在早期可以通过平衡光子数通量 $\\Phi_\\gamma$ 与单位面积所需的电离速率来估算，其上限由有限的传播速度决定。光子数通量为 $\\Phi_\\gamma = \\frac{F}{\\epsilon}$，其中 $\\epsilon$ 是平均电离光子能量。减速光速近似（RSLA）在辐射输运项中用 $c_{\\rm red}$ 替换 $c$。\n- 气体压强为 $P_g = n_g k_{\\rm B} T$，其中 $n_g$ 为气体数密度，$k_{\\rm B}$ 为玻尔兹曼常数，$T$ 为温度。对于纯原子氢气体，取 $n_g = n_{\\rm H}$ 和 $\\rho = n_{\\rm H} m_p$，其中 $m_p$ 为质子质量。\n- 定义一个上游辐射修正的激波指示符 $\\Theta$，其为上游总压强中由辐射贡献的分数，$\\Theta = \\frac{P_r}{P_r + P_g}$，这是一个无量纲的度量，用于衡量辐射压强在修正激波结构中的相对重要性。\n\n你的任务：\n- 从上述基本原理出发，推导适用于流体区和扩散区的公式，以计算：\n  - 使用 $c$ 计算的真实电离前沿速度 $v_I^{\\rm true}$，以及使用 $c_{\\rm red}$ 计算的RSLA电离前沿速度 $v_I^{\\rm red}$。\n  - 在两种区制下的真实辐射压强 $P_r^{\\rm true}$ 和RSLA辐射压强 $P_r^{\\rm red}$。\n  - 上游激波指示符 $\\Theta^{\\rm true}$ 和 $\\Theta^{\\rm red}$。\n- 基于这些，为每种情况计算三种相对误差：\n  - 电离前沿速度的相对误差 $\\delta_{v_I} = \\frac{v_I^{\\rm red} - v_I^{\\rm true}}{v_I^{\\rm true}}$。\n  - 辐射压强的相对误差 $\\delta_{P_r} = \\frac{P_r^{\\rm red} - P_r^{\\rm true}}{P_r^{\\rm true}}$。\n  - 激波指示符的相对误差 $\\delta_{\\Theta} = \\frac{\\Theta^{\\rm red} - \\Theta^{\\rm true}}{\\Theta^{\\rm true}}$。\n\n在整个过程中使用国际单位制（SI）。速度单位必须为米/秒 (m/s)，通量单位为瓦特/平方米 (W/m$^2$)，能量单位为焦耳 (J)，压强单位为帕斯卡 (Pa)，密度单位为千克/立方米 (kg/m$^3$)，不透明度单位为平方米/千克 (m$^2$/kg)，长度单位为米 (m)，温度单位为开尔文 (K)。最终输出是无量纲的相对误差。使用以下常数 $c = 2.99792458 \\times 10^8$ (m/s)，$k_{\\rm B} = 1.380649 \\times 10^{-23}$ (J/K)，$m_p = 1.67262192369 \\times 10^{-27}$ (kg)，以及 $\\epsilon = 20 \\times 1.602176634 \\times 10^{-19}$ (J)。\n\n实现以下参数集的测试套件，以确保覆盖流体区和扩散区，包括正常路径和边界情况。对于每种情况，介质都是纯氢，因此 $n_g = n_{\\rm H}$ 且 $\\rho = n_{\\rm H} m_p$，区制分类应基于光学深度 $\\tau = \\kappa \\rho L$：\n- 情况1（流体，受 $c$ 饱和）：$n_{\\rm H} = 10^6$ (m$^{-3}$)，$F = 1.024 \\times 10^{-1}$ (W/m$^2$)，$\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg)，$L = 10^9$ (m)，$T = 10^4$ (K)，$c_{\\rm red}/c = 10^{-2}$。\n- 情况2（流体，光子受限）：$n_{\\rm H} = 10^{10}$ (m$^{-3}$)，$F = 10^{-3}$ (W/m$^2$)，$\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg)，$L = 10^9$ (m)，$T = 10^4$ (K)，$c_{\\rm red}/c = 10^{-1}$。\n- 情况3（扩散，高光学深度）：$n_{\\rm H} = 10^{16}$ (m$^{-3}$)，$F = 10$ (W/m$^2$)，$\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg)，$L = 10^{13}$ (m)，$T = 10^5$ (K)，$c_{\\rm red}/c = 10^{-2}$。\n- 情况4（流体，边界 $\\Phi_\\gamma/n_{\\rm H} = c$）：$n_{\\rm H} = 10^8$ (m$^{-3}$)，$F = c \\, n_{\\rm H} \\, \\epsilon$ (W/m$^2$)，$\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg)，$L = 10^9$ (m)，$T = 10^4$ (K)，$c_{\\rm red}/c = 3 \\times 10^{-2}$。\n\n计算中的区制使用：\n- 如果 $\\tau  10^{-2}$，按流体处理。\n- 否则，按扩散处理。\n\n你的程序必须计算每种情况下的三种相对误差 $\\delta_{v_I}$、$\\delta_{P_r}$ 和 $\\delta_{\\Theta}$，并将它们以方括号括起来的逗号分隔列表形式单行输出，按情况1到4的顺序，每种情况贡献三个按所列顺序排列的数字，每个数字四舍五入到六位小数。例如，要求输出格式为 $[x_1,y_1,z_1,x_2,y_2,z_2,x_3,y_3,z_3,x_4,y_4,z_4]$，并且在单行上无附加文本。", "solution": "该问题要求在一维辐射流体动力学背景下，对减速光速近似（RSLA）引入的数值误差进行定量分析。我们必须推导三个关键可观测量——电离前沿速度（$v_I$）、辐射压强（$P_r$）和辐射修正的激波指示符（$\\Theta$）——在光学薄（流体）和光学厚（扩散）两种区制下的相对误差表达式。推导将基于所给定的第一性原理，然后针对一组指定的测试用例进行数值实现。\n\n首先，我们建立物理和计算框架。该系统由辐射能量密度 $E$ 和通量 $F$ 的矩方程控制。RSLA在于将辐射输运项中的真实光速 $c$ 替换为一个减小的值 $c_{\\rm red}$，其中 $0  c_{\\rm red}  c$。我们将用 $c$ 计算的量表示为“真”（`true`）（例如，$v_I^{\\rm true}$），用 $c_{\\rm red}$ 计算的量表示为“减”（`red`）（例如，$v_I^{\\rm red}$）。\n\n区制由光学深度 $\\tau = \\kappa \\rho L$ 决定，其中 $\\kappa$ 是质量吸收不透明度，$\\rho$ 是质量密度，$L$ 是特征长度尺度。介质是纯氢，因此 $\\rho = n_{\\rm H} m_p$，其中 $n_{\\rm H}$ 是氢数密度，$m_p$ 是质子质量。根据问题规范，如果 $\\tau  10^{-2}$，则适用流体区制，否则适用扩散区制。\n\n气体压强由理想气体定律 $P_g = n_g k_{\\rm B} T$ 给出。对于纯氢气体，气体数密度 $n_g$ 与 $n_{\\rm H}$ 相同，因此 $P_g = n_{\\rm H} k_{\\rm B} T$。此量不受RSLA影响。\n\n让我们为每个区制推导必要的公式。\n\n**1. 光学薄（流体）区制（$\\tau  10^{-2}$）**\n\n在流体极限下，辐射自由传播。闭合关系为 $F = cE$ 和 $P_r = E$。\n将它们结合起来，得到辐射压强和通量之间的直接关系：$P_r = F/c$。\n\n真实量（使用 $c$）：\n- 辐射压强：$P_r^{\\rm true} = \\frac{F}{c}$。通量 $F$ 是一个给定参数。\n- 电离前沿速度：R型电离前沿的速度 $v_I$ 由电离光子的供应与光速极限之间的平衡决定。光子数通量为 $\\Phi_\\gamma = F/\\epsilon$，其中 $\\epsilon$ 是每个电离光子的平均能量。将其与电离速率 $v_I n_{\\rm H}$ 相平衡，得到光子受限速度 $v_{phot} = \\frac{F}{\\epsilon n_{\\rm H}}$。前沿速度不能超过光子速度，因此其上限为 $c$。因此，$v_I^{\\rm true} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, c\\right)$。\n- 激波指示符：$\\Theta^{\\rm true} = \\frac{P_r^{\\rm true}}{P_r^{\\rm true} + P_g} = \\frac{F/c}{F/c + n_{\\rm H} k_{\\rm B} T}$。\n\n受RSLA影响的量（使用 $c_{\\rm red}$）：\nRSLA将输运关系修改为 $F = c_{\\rm red}E$。闭合关系 $P_r = E$ 是各向异性辐射的属性，予以保留。\n- RSLA辐射压强：$P_r^{\\rm red} = \\frac{F}{c_{\\rm red}}$。\n- RSLA电离前沿速度：光子通量不变，但传播速度极限现在是 $c_{\\rm red}$。因此，$v_I^{\\rm red} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, c_{\\rm red}\\right)$。\n- RSLA激波指示符：$\\Theta^{\\rm red} = \\frac{P_r^{\\rm red}}{P_r^{\\rm red} + P_g} = \\frac{F/c_{\\rm red}}{F/c_{\\rm red} + n_{\\rm H} k_{\\rm B} T}$。\n\n**2. 光学厚（扩散）区制（$\\tau \\ge 10^{-2}$）**\n\n在扩散极限下，辐射输运由菲克定律 $F \\approx -D \\nabla E$ 描述，扩散系数为 $D = \\frac{c\\lambda}{3} = \\frac{c}{3\\kappa\\rho}$。对于近各向同性的辐射，闭合关系为 $P_r \\approx E/3$。\n在一维中，我们将梯度近似为 $|\\nabla E| \\approx E/L$，其中 $L$ 是特征长度尺度。通量大小则为 $F \\approx \\frac{c E}{3 \\kappa \\rho L} = \\frac{c E}{3\\tau}$。我们可以用通量表示能量密度：$E \\approx \\frac{3 \\tau F}{c}$。\n\n真实量（使用 $c$）：\n- 辐射压强：$P_r^{\\rm true} \\approx \\frac{E}{3} \\approx \\frac{\\tau F}{c}$。\n- 电离前沿速度：光子供应速率 $v_{phot} = \\frac{F}{\\epsilon n_{\\rm H}}$ 仍然是一个关键因素。然而，辐射前沿的有效传播速度是扩散速度，$v_{diff} \\approx D/L = \\frac{c}{3\\kappa\\rho L} = \\frac{c}{3\\tau}$。这作为上限。因此，$v_I^{\\rm true} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, \\frac{c}{3\\tau}\\right)$。\n- 激波指示符：$\\Theta^{\\rm true} = \\frac{P_r^{\\rm true}}{P_r^{\\rm true} + P_g} = \\frac{\\tau F / c}{\\tau F / c + n_{\\rm H} k_{\\rm B} T}$。\n\n受RSLA影响的量（使用 $c_{\\rm red}$）：\nRSLA将扩散系数修改为 $D_{\\rm red} = \\frac{c_{\\rm red}}{3\\kappa\\rho}$。\n- RSLA辐射压强：通量-能量关系变为 $F \\approx \\frac{c_{\\rm red} E}{3\\tau}$，导致 $E \\approx \\frac{3\\tau F}{c_{\\rm red}}$。压强则为 $P_r^{\\rm red} \\approx \\frac{E}{3} \\approx \\frac{\\tau F}{c_{\\rm red}}$。\n- RSLA电离前沿速度：传播速度极限现在是减小的扩散速度，$v_{diff}^{\\rm red} \\approx \\frac{c_{\\rm red}}{3\\tau}$。因此，$v_I^{\\rm red} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, \\frac{c_{\\rm red}}{3\\tau}\\right)$。\n- RSLA激波指示符：$\\Theta^{\\rm red} = \\frac{P_r^{\\rm red}}{P_r^{\\rm red} + P_g} = \\frac{\\tau F / c_{\\rm red}}{\\tau F / c_{\\rm red} + n_{\\rm H} k_{\\rm B} T}$。\n\n**3. 相对误差**\n\n对于每种情况，我们计算以下相对误差：\n- $\\delta_{v_I} = \\frac{v_I^{\\rm red} - v_I^{\\rm true}}{v_I^{\\rm true}}}$\n- $\\delta_{P_r} = \\frac{P_r^{\\rm red} - P_r^{\\rm true}}{P_r^{\\rm true}}}$\n- $\\delta_{\\Theta} = \\frac{\\Theta^{\\rm red} - \\Theta^{\\rm true}}{\\Theta^{\\rm true}}}$\n\n通过观察可以发现，辐射压强的相对误差与区制无关。设 $f = c/c_{\\rm red}$。\n在流体区制中，$P_r^{\\rm red} = F/c_{\\rm red} = (c/c_{\\rm red})(F/c) = f P_r^{\\rm true}$。\n在扩散区制中，$P_r^{\\rm red} = \\tau F/c_{\\rm red} = (c/c_{\\rm red})(\\tau F/c) = f P_r^{\\rm true}$。\n在两种区制中，我们都发现了关于压强误差的相同简单关系：\n$\\delta_{P_r} = \\frac{f P_r^{\\rm true} - P_r^{\\rm true}}{P_r^{\\rm true}} = f - 1 = \\frac{c}{c_{\\rm red}} - 1$。\n\n激波指示符的误差也可以解析地表示出来。设 $X = P_r^{\\rm true}$ 和 $Y = P_g$。\n$\\Theta^{\\rm true} = \\frac{X}{X+Y}$ 和 $\\Theta^{\\rm red} = \\frac{fX}{fX+Y}$。\n相对误差为：\n$\\delta_{\\Theta} = \\frac{\\Theta^{\\rm red}}{\\Theta^{\\rm true}} - 1 = \\left(\\frac{fX}{fX+Y}\\right) \\left(\\frac{X+Y}{X}\\right) - 1 = \\frac{f(X+Y)}{fX+Y} - 1 = \\frac{fX + fY - fX - Y}{fX+Y} = \\frac{(f-1)Y}{fX+Y}$。\n这可以写成 $\\Theta^{\\rm true}$ 的形式：$\\delta_{\\Theta} = \\frac{(f-1)(1-\\Theta^{\\rm true})}{1+(f-1)\\Theta^{\\rm true}}$。\n\nI-front速度的误差 $\\delta_{v_I}$ 由于 `min` 函数的存在而更为复杂，必须根据具体情况逐一评估。\n\n**4. 测试用例的计算步骤**\n\n对于每组参数（$n_{\\rm H}$、$F$、$\\kappa$、$L$、$T$、$c_{\\rm red}/c$）：\n1. 定义物理常数：$c = 2.99792458 \\times 10^8$ m/s，$k_{\\rm B} = 1.380649 \\times 10^{-23}$ J/K，$m_p = 1.67262192369 \\times 10^{-27}$ kg，$\\epsilon = 20 \\times 1.602176634 \\times 10^{-19}$ J。\n2. 计算派生参数：$\\rho = n_{\\rm H} m_p$，$\\tau = \\kappa \\rho L$，$P_g = n_{\\rm H} k_{\\rm B} T$，以及 $c_{\\rm red} = (c_{\\rm red}/c) \\times c$。对于情况4，必须首先计算通量 $F = c n_{\\rm H} \\epsilon$。\n3. 通过将 $\\tau$ 与 $10^{-2}$ 比较来确定区制。\n4. 应用适当的公式集（流体或扩散）来计算 $P_r^{\\rm true}$、$P_r^{\\rm red}$、$v_I^{\\rm true}$、$v_I^{\\rm red}$、$\\Theta^{\\rm true}$ 和 $\\Theta^{\\rm red}$。\n5. 计算三种相对误差 $\\delta_{P_r}$、$\\delta_{v_I}$ 和 $\\delta_{\\Theta}$。这些分式的分母必须非零，这一点由问题参数保证。\n6. 然后将结果汇总并按要求格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the fractional numerical error introduced by the reduced\n    speed-of-light approximation (RSLA) on key radiation-hydrodynamics\n    observables in numerical cosmology.\n    \"\"\"\n    # Physical Constants in SI units\n    C = 2.99792458e8  # Speed of light (m/s)\n    K_B = 1.380649e-23  # Boltzmann constant (J/K)\n    M_P = 1.67262192369e-27  # Proton mass (kg)\n    EPSILON_eV = 20.0  # Mean ionizing photon energy in eV\n    e_charge = 1.602176634e-19 # Elementary charge in C\n    EPSILON = EPSILON_eV * e_charge # Mean ionizing photon energy (J)\n\n    # Test cases from the problem statement\n    # Each case is a tuple: (n_H, F_or_calc_flag, kappa, L, T, c_red_ratio)\n    # F_or_calc_flag is either the flux F or a string 'calc' for Case 4\n    test_cases = [\n        # Case 1 (streaming, saturation by c)\n        (1e6, 1.024e-1, 4.0e-2, 1e9, 1e4, 1e-2),\n        # Case 2 (streaming, photon-limited)\n        (1e10, 1e-3, 4.0e-2, 1e9, 1e4, 1e-1),\n        # Case 3 (diffusion, high optical depth)\n        (1e16, 10.0, 4.0e-2, 1e13, 1e5, 1e-2),\n        # Case 4 (streaming, boundary phi/n_H = c)\n        (1e8, 'calc', 4.0e-2, 1e9, 1e4, 3e-2),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n_H, F_val, kappa, L, T, c_red_ratio = case\n\n        # Calculate flux for Case 4\n        if F_val == 'calc':\n            F = C * n_H * EPSILON\n        else:\n            F = F_val\n\n        # Preliminiary calculations\n        rho = n_H * M_P\n        tau = kappa * rho * L\n        P_g = n_H * K_B * T\n        c_red = c_red_ratio * C\n\n        # Determine regime\n        is_streaming = tau  1e-2\n\n        if is_streaming:\n            # --- Streaming Regime ---\n            # I-front Speed\n            v_phot = F / (EPSILON * n_H)\n            v_I_true = min(v_phot, C)\n            v_I_red = min(v_phot, c_red)\n            \n            # Radiation Pressure\n            P_r_true = F / C\n            P_r_red = F / c_red\n        else:\n            # --- Diffusive Regime ---\n            # I-front Speed\n            v_phot = F / (EPSILON * n_H)\n            v_diff_true = C / (3 * tau)\n            v_diff_red = c_red / (3 * tau)\n            v_I_true = min(v_phot, v_diff_true)\n            v_I_red = min(v_phot, v_diff_red)\n\n            # Radiation Pressure\n            P_r_true = tau * F / C\n            P_r_red = tau * F / c_red\n\n        # Shock indicator (calculation is the same form for both regimes)\n        # Avoid division by zero if P_r_true + P_g is zero\n        denom_true = P_r_true + P_g\n        Theta_true = P_r_true / denom_true if denom_true != 0 else 0.0\n\n        denom_red = P_r_red + P_g\n        Theta_red = P_r_red / denom_red if denom_red != 0 else 0.0\n\n        # Calculate fractional errors\n        # Avoid division by zero if true values are zero\n        delta_vI = (v_I_red - v_I_true) / v_I_true if v_I_true != 0 else 0.0\n        delta_Pr = (P_r_red - P_r_true) / P_r_true if P_r_true != 0 else 0.0\n        delta_Theta = (Theta_red - Theta_true) / Theta_true if Theta_true != 0 else 0.0\n\n        results.extend([delta_vI, delta_Pr, delta_Theta])\n\n    # Format the final output string\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3482963"}]}