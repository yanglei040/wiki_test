{"hands_on_practices": [{"introduction": "在星系形成的数值模拟中，一个经典的挑战是“数值过冷”问题，即注入的反馈能量在能够产生流体动力学效应之前就因数值原因被过快地辐射掉。本练习旨在通过探索辐射冷却和流体动力学响应时间尺度之间的竞争，来揭示这一问题的核心。通过从第一性原理推导并用代码验证一个无量纲参数 $\\Pi$，您将具体理解为何以及何时反馈能量会发生数值损失，这是设计有效次网格模型的关键第一步 [@problem_id:3491443]。", "problem": "考虑在数值宇宙学中用于超新星（SN）和活动星系核（AGN）反馈的亚网格模型中的理想化单区能量注入事件。单个流体动力学分辨率单元（边长为 $\\Delta x$ 的立方单元）接收瞬时的热能注入。我们希望通过比较辐射冷却和流体动力学响应时间尺度，定义一个无量纲参数来预测数值过冷问题的发生。你的任务是推导、实现并验证这样一个参数。\n\n从基本原理和广为接受的近似出发：\n\n- 使用理想气体内部能量关系和绝热指数 $\\gamma = 5/3$ 的单原子理想气体的声速。假设气体已电离，平均分子量 $\\mu = 0.6$。\n- 使用将热能 $E$ 注入体积为 $V = \\Delta x^3$、氢数密度为 $n$ 的单元后，温度 $T$ 的定义，假设所有 $E$ 都转化为热内能。\n- 使用声波穿越分辨率单元 $\\Delta x$ 的声跨越时间 $t_{\\mathrm{sc}}$ 的定义：声速为 $c_s = \\sqrt{\\gamma k_B T / (\\mu m_p)}$，其中 $k_B$ 是玻尔兹曼常数，$m_p$ 是质子质量。声跨越时间为 $t_{\\mathrm{sc}} = \\Delta x / c_s$。\n- 使用等容极限下的光学薄辐射冷却时间 $t_{\\mathrm{cool}} = \\dfrac{(3/2) n k_B T}{n_e n_i \\Lambda(T)}$。对于完全电离的氢，假设 $n_e \\approx n_i \\approx n$，因此 $n_e n_i \\approx n^2$。辐射冷却函数为 $\\Lambda(T)$，单位为 $\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n\n将无量纲参数 $\\Pi$ 定义为注入能量、气体密度、网格尺度和冷却函数的函数：\n$$\n\\Pi \\equiv \\frac{t_{\\mathrm{cool}}}{t_{\\mathrm{sc}}}.\n$$\n$\\Pi  1$ 的值表示冷却时间短于单个分辨率单元上的流体动力学响应时间，预示着数值过冷的发生。\n\n通过受控能量注入测试的验证协议：\n- 在纯辐射损失下，将单区内能 $E(t)$ 演化一个初始声跨越时间 $t_{\\mathrm{sc}}$ 的时长：\n$$\n\\frac{dE}{dt} = - n^2 \\Lambda(T) V,\n$$\n并使用热力学闭合关系：\n$$\nE = \\frac{3}{2} n V k_B T \\quad \\Rightarrow \\quad T(E) = \\frac{2 E}{3 n V k_B}.\n$$\n- 如果在一个初始声跨越时间后，保留的能量分数小于二分之一，即 $E(t_{\\mathrm{sc}})/E(0)  1/2$，则将该演化分类为“过冷”。\n- 将此测量分类与基于 $\\Pi$ 的预测进行比较：当且仅当 $\\Pi  1$ 时，预测为过冷。\n\n采用以下常数和单位约定：\n- 对所有物理量使用 cgs 单位：$E$ 的单位是 $\\mathrm{erg}$，$n$ 的单位是 $\\mathrm{cm^{-3}}$，$\\Delta x$ 的单位是 $\\mathrm{pc}$（使用 $1\\,\\mathrm{pc} = 3.08567758\\times 10^{18}\\,\\mathrm{cm}$ 转换为 $\\mathrm{cm}$），$k_B = 1.380649\\times 10^{-16}\\,\\mathrm{erg\\,K^{-1}}$，$m_p = 1.67262192369\\times 10^{-24}\\,\\mathrm{g}$，$\\mu = 0.6$，以及 $\\gamma = 5/3$。\n- 对冷却函数 $\\Lambda(T)$（完全电离，近太阳金属丰度，光学薄）使用以下分段解析近似，该近似在各区间连续且对 $T \\ge 10^{4}\\,\\mathrm{K}$ 有效：\n  - 对于 $10^{4}\\,\\mathrm{K} \\le T  10^{5}\\,\\mathrm{K}$：$\\Lambda(T) = 10^{-22}\\,\\left(\\dfrac{T}{10^{5}\\,\\mathrm{K}}\\right)^{1/2}\\,\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n  - 对于 $10^{5}\\,\\mathrm{K} \\le T \\le 10^{7}\\,\\mathrm{K}$：$\\Lambda(T) = 2\\times 10^{-23}\\,\\left(\\dfrac{T}{10^{6}\\,\\mathrm{K}}\\right)^{-0.7}\\,\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n  - 对于 $T  10^{7}\\,\\mathrm{K}$：$\\Lambda(T) = 10^{-23}\\,\\left(\\dfrac{T}{10^{7}\\,\\mathrm{K}}\\right)^{1/2}\\,\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n为保证数值稳定性，你应该在 $\\Lambda(T)$ 内部强制设置一个 $T \\ge 10^{4}\\,\\mathrm{K}$ 的下限。\n\n数值积分要求：\n- 在 $[0, t_{\\mathrm{sc}}]$ 上使用固定时间步长和稳定方法对 $E(t)$ 的常微分方程进行积分。使用四阶显式龙格—库塔方法，并至少采用 $N = 10^{4}$ 个等长步长，以确保在这些测试案例中收敛。\n- 使用初始温度 $T(0)$ 计算 $t_{\\mathrm{sc}}$；在演化过程中保持 $\\Delta x$ 不变。\n\n测试套件：\n实现你的程序以评估以下四个受控能量注入测试。对每个测试，计算无量纲参数 $\\Pi$，执行单区演化，并返回一个布尔值，指示基于 $\\Pi$ 的预测是否与测量分类一致。所有输入均以 $(E, n, \\Delta x)$ 的形式列出：\n\n1. 密稠气体中的超新星，粗分辨率（预期过冷）：$(E = 10^{51}\\,\\mathrm{erg},\\; n = 10\\,\\mathrm{cm^{-3}},\\; \\Delta x = 100\\,\\mathrm{pc})$。\n2. 稀疏气体中的超新星，高分辨率（预期不过冷）：$(E = 10^{51}\\,\\mathrm{erg},\\; n = 1\\,\\mathrm{cm^{-3}},\\; \\Delta x = 1\\,\\mathrm{pc})$。\n3. 簇内介质中的活动星系核（AGN）气泡（预期不过冷）：$(E = 10^{57}\\,\\mathrm{erg},\\; n = 10^{-3}\\,\\mathrm{cm^{-3}},\\; \\Delta x = 1000\\,\\mathrm{pc})$。\n4. 近阈值超新星案例（临界分辨率）：$(E = 10^{51}\\,\\mathrm{erg},\\; n = 1\\,\\mathrm{cm^{-3}},\\; \\Delta x = 60\\,\\mathrm{pc})$。\n\n最终输出规范：\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，且无空格。每个条目必须是一个布尔值，其中每个布尔值为 `true` 当且仅当基于 $\\Pi$ 的过冷预测与该测试案例的测量分类匹配，顺序与上面列出的一致。例如：\"[True,False,True,True]\"。", "solution": "问题要求推导和验证一个无量纲参数 $\\Pi$，该参数旨在预测天体物理反馈模拟中数值过冷的发生。当辐射冷却时间尺度短于单个分辨率单元内的流体动力学响应时间时，就会发生这种现象，导致注入的能量在对周围气体做机械功之前就被辐射掉。\n\n首先，我们根据问题的基本物理参数推导 $\\Pi$ 的表达式：注入的能量 $E$、环境氢数密度 $n$ 和网格单元大小 $\\Delta x$。\n\n无量纲参数 $\\Pi$ 定义为冷却时间 $t_{\\mathrm{cool}}$ 与声跨越时间 $t_{\\mathrm{sc}}$ 之比：\n$$\n\\Pi \\equiv \\frac{t_{\\mathrm{cool}}}{t_{\\mathrm{sc}}}\n$$\n\n声跨越时间 $t_{\\mathrm{sc}}$ 是声波穿过大小为 $\\Delta x$ 的分辨率单元所需的时间。它由下式给出：\n$$\nt_{\\mathrm{sc}} = \\frac{\\Delta x}{c_s}\n$$\n其中 $c_s$ 是气体中的声速。对于绝热指数 $\\gamma = 5/3$、平均分子量 $\\mu = 0.6$ 的单原子理想气体，声速为：\n$$\nc_s = \\sqrt{\\frac{\\gamma k_B T}{\\mu m_p}}\n$$\n此处，$k_B$ 是玻尔兹曼常数，$T$ 是温度，$m_p$ 是质子质量。将热能 $E$ 瞬时注入体积为 $V = \\Delta x^3$ 的立方单元后，其温度 $T$ 由理想气体内部能量关系确定：\n$$\nE = \\frac{3}{2} n V k_B T = \\frac{3}{2} n (\\Delta x)^3 k_B T\n$$\n解出 $T$，我们得到初始温度 $T_0$：\n$$\nT_0 = \\frac{2 E}{3 n (\\Delta x)^3 k_B}\n$$\n将 $T_0$ 的这个表达式代入 $c_s$ 的公式，我们可以用主要变量表示初始声跨越时间 $t_{\\mathrm{sc},0}$：\n$$\nt_{\\mathrm{sc},0} = \\frac{\\Delta x}{\\sqrt{\\frac{\\gamma k_B}{\\mu m_p} \\left( \\frac{2 E}{3 n (\\Delta x)^3 k_B} \\right)}} = \\frac{\\Delta x}{\\sqrt{\\frac{2 \\gamma E}{3 n (\\Delta x)^3 \\mu m_p}}} = \\Delta x \\sqrt{\\frac{3 n (\\Delta x)^3 \\mu m_p}{2 \\gamma E}} = (\\Delta x)^{5/2} \\sqrt{\\frac{3 n \\mu m_p}{2 \\gamma E}}\n$$\n\n接下来，我们推导初始冷却时间 $t_{\\mathrm{cool},0}$。它被定义为热能密度与单位体积辐射冷却率之比。对于等容过程：\n$$\nt_{\\mathrm{cool}} = \\frac{(3/2) n k_B T}{n_e n_i \\Lambda(T)}\n$$\n其中 $\\Lambda(T)$ 是辐射冷却函数。对于完全电离的氢气，电子和离子的数密度约等于氢数密度，$n_e \\approx n_i \\approx n$。热能密度 $(3/2) n k_B T$ 就是总能量 $E$ 除以体积 $V = (\\Delta x)^3$。因此，初始冷却时间为：\n$$\nt_{\\mathrm{cool},0} = \\frac{E/V}{n^2 \\Lambda(T_0)} = \\frac{E}{(\\Delta x)^3 n^2 \\Lambda(T_0)}\n$$\n\n现在我们可以通过将 $t_{\\mathrm{cool},0}$ 除以 $t_{\\mathrm{sc},0}$ 来构成无量纲参数 $\\Pi$：\n$$\n\\Pi = \\frac{t_{\\mathrm{cool},0}}{t_{\\mathrm{sc},0}} = \\frac{E / ((\\Delta x)^3 n^2 \\Lambda(T_0))}{(\\Delta x)^{5/2} \\sqrt{3 n \\mu m_p / (2 \\gamma E)}} = \\frac{E}{n^2 (\\Delta x)^{11/2} \\Lambda(T_0)} \\sqrt{\\frac{2 \\gamma E}{3 n \\mu m_p}}\n$$\n$$\n\\Pi = \\frac{E^{3/2}}{n^{5/2} (\\Delta x)^{11/2} \\Lambda(T_0)} \\sqrt{\\frac{2 \\gamma}{3 \\mu m_p}}\n$$\n$\\Pi  1$ 的值表明冷却主导了流体动力学，导致数值过冷。\n\n为验证此标准，我们按规定执行一个数值实验。我们求解纯辐射损失下内能 $E(t)$ 演化的常微分方程（ODE）：\n$$\n\\frac{dE}{dt} = -n^2 \\Lambda(T(E)) V\n$$\n其中温度 $T$ 通过热力学闭合关系与任意时刻的能量 $E$ 相关联：\n$$\nT(E) = \\frac{2 E}{3 n V k_B}\n$$\n该 ODE 从 $t=0$ 积分到 $t=t_{\\mathrm{sc},0}$（初始声跨越时间）。我们使用四阶显式龙格—库塔（RK4）方法，总共 $N=10^4$ 个固定时间步长，$\\Delta t = t_{\\mathrm{sc},0}/N$。对于给定的时间步 $i$，能量从 $E_i$ 更新到 $E_{i+1}$ 的过程如下，其中 $f(E) = dE/dt$：\n$$\nk_1 = \\Delta t \\cdot f(E_i)\n$$\n$$\nk_2 = \\Delta t \\cdot f(E_i + 0.5 k_1)\n$$\n$$\nk_3 = \\Delta t \\cdot f(E_i + 0.5 k_2)\n$$\n$$\nk_4 = \\Delta t \\cdot f(E_i + k_3)\n$$\n$$\nE_{i+1} = E_i + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\n在积分到 $t=t_{\\mathrm{sc},0}$ 以找到最终能量 $E(t_{\\mathrm{sc},0})$ 后，如果保留的能量分数小于二分之一，我们便将该演化分类为“测量到的过冷”：\n$$\n\\frac{E(t_{\\mathrm{sc},0})}{E(0)}  \\frac{1}{2}\n$$\n每个测试案例的验证包括检查预测（如果 $\\Pi  1$ 则为过冷，如果 $\\Pi \\ge 1$ 则为不过冷）是否与数值实验的分类相匹配。\n\n分段冷却函数 $\\Lambda(T)$ 按规定实现，温度下限为 $T=10^4\\,\\mathrm{K}$。所有计算均在 cgs 单位制下进行。所提供的测试案例均按照此程序进行评估。最终输出是一个布尔值列表，其中每个条目为 `True` 表示 $\\Pi$ 的预测与相应测试案例的测量结果一致。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and validates a dimensionless parameter for numerical\n    overcooling in astrophysical simulations.\n    \"\"\"\n\n    # Physical constants in cgs units\n    K_B = 1.380649e-16  # Boltzmann constant in erg/K\n    M_P = 1.67262192369e-24  # Proton mass in g\n    PC_TO_CM = 3.08567758e18  # Parsec to cm conversion\n\n    # Gas properties\n    GAMMA = 5.0 / 3.0  # Adiabatic index for monatomic gas\n    MU = 0.6  # Mean molecular weight for ionized gas\n\n    def lambda_cooling_func(T):\n        \"\"\"\n        Calculates the radiative cooling function Lambda(T) in erg cm^3 s^-1.\n        The function is a piecewise power-law approximation.\n        A temperature floor of 1e4 K is enforced.\n        \"\"\"\n        T_eff = np.maximum(T, 1.0e4)\n\n        if T_eff  1.0e5:\n            return 1.0e-22 * np.sqrt(T_eff / 1.0e5)\n        elif T_eff = 1.0e7:\n            return 2.0e-23 * (T_eff / 1.0e6)**(-0.7)\n        else:  # T_eff > 1.0e7\n            return 1.0e-23 * np.sqrt(T_eff / 1.0e7)\n\n    def run_simulation(E_init, n, delta_x_pc):\n        \"\"\"\n        Runs a single simulation case to compare the Pi-based prediction\n        with the measured overcooling outcome.\n        \"\"\"\n        # --- Convert units and calculate cell volume ---\n        delta_x_cm = delta_x_pc * PC_TO_CM\n        V = delta_x_cm**3\n\n        # --- Calculate initial state and Pi parameter ---\n        # Initial Temperature\n        T_0 = (2.0 * E_init) / (3.0 * n * V * K_B)\n        \n        # Initial cooling function value\n        lambda_0 = lambda_cooling_func(T_0)\n        \n        # Initial cooling time\n        if lambda_0 > 0:\n            t_cool_0 = E_init / (n**2 * V * lambda_0)\n        else:\n            t_cool_0 = np.inf\n\n        # Initial sound speed\n        c_s_0 = np.sqrt(GAMMA * K_B * T_0 / (MU * M_P))\n        \n        # Initial sound crossing time\n        t_sc_0 = delta_x_cm / c_s_0\n        \n        # Dimensionless parameter Pi\n        Pi = t_cool_0 / t_sc_0\n\n        # Prediction based on Pi\n        predicted_overcooling = (Pi  1.0)\n        \n        # --- Perform numerical integration using RK4 ---\n        N_steps = 10000\n        dt = t_sc_0 / N_steps\n        \n        E_current = E_init\n\n        # Define the ODE function dE/dt = f(E)\n        def dE_dt(E):\n            if E = 0:\n                return 0.0\n            T_current = (2.0 * E) / (3.0 * n * V * K_B)\n            lambda_val = lambda_cooling_func(T_current)\n            return -n**2 * V * lambda_val\n\n        for _ in range(N_steps):\n            k1 = dt * dE_dt(E_current)\n            k2 = dt * dE_dt(E_current + 0.5 * k1)\n            k3 = dt * dE_dt(E_current + 0.5 * k2)\n            k4 = dt * dE_dt(E_current + k3)\n            E_current += (k1 + 2*k2 + 2*k3 + k4) / 6.0\n            if E_current  0:\n                 E_current = 0\n                 break # Energy fully radiated away\n\n        E_final = E_current\n\n        # Measurement from simulation\n        measured_overcooling = (E_final / E_init)  0.5\n        \n        # Compare prediction and measurement\n        return predicted_overcooling == measured_overcooling\n\n    # Test suite: (E [erg], n [cm^-3], delta_x [pc])\n    test_cases = [\n        # 1. Supernova in dense gas, coarse resolution\n        (1.0e51, 10.0, 100.0),\n        # 2. Supernova in diffuse gas, fine resolution\n        (1.0e51, 1.0, 1.0),\n        # 3. AGN bubble in intracluster medium\n        (1.0e57, 1.0e-3, 1000.0),\n        # 4. Near-threshold supernova case\n        (1.0e51, 1.0, 60.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        E, n, dx = case\n        agreement = run_simulation(E, n, dx)\n        results.append(agreement)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3491443"}, {"introduction": "在实现反馈模型时，数值算法的细节与物理模型本身同等重要。本练习深入探讨了“算子分裂误差”，这种误差源于对不同物理过程（如能量注入和阻力）的顺序应用。通过将一个数值方案与一个精确的解析解进行对比，您将能够直接量化算法设计中的选择（例如算子顺序和时间步长）如何影响模拟的准确性和守恒性 [@problem_id:3491413]。", "problem": "考虑一个用于数值宇宙学中反馈耦合的单区子网格模型，其中由超新星（SN）和活动星系核（AGN）反馈驱动的风被建模为一个速度为 $v(t)$、质量为 $m$ 的单一包裹。反馈表示为在有限持续时间 $T_{\\mathrm{inj}}$ 内均匀注入的恒定能量注入率（功率）$L$。与周围星际介质的动量耦合通过一个以时间尺度 $\\tau_{\\mathrm{d}}$ 为特征的线性阻力来近似，该阻力根据耗散功率 $P_{\\mathrm{drag}}(t) = m v(t)^2 / \\tau_{\\mathrm{d}}$ 来移除动能。其基本控制原理是动能定理、牛顿第二定律以及动能的定义 $K(t) = \\tfrac{1}{2} m v(t)^2$。由此，连续能量平衡方程为\n$$\n\\frac{dK}{dt} = L - \\frac{m v(t)^2}{\\tau_{\\mathrm{d}}}.\n$$\n假设在时间 $t=0$ 时，风速为 $v_0$，动能为 $K_0 = \\tfrac{1}{2} m v_0^2$。我们考虑在一个数值时间积分方案中使用算子分裂方法，该方案在注入算子和带有子循环的阻力算子之间交替进行。\n\n定义一个全局时间步长 $\\Delta t$ 和一个整数子循环次数 $n_{\\mathrm{sub}} \\geq 1$。在每个全局步长内，根据两种算子排序之一，执行 $n_{\\mathrm{sub}}$ 个大小为 $\\delta t = \\Delta t / n_{\\mathrm{sub}}$ 的子循环：\n- 先注入后阻力（$\\mathrm{I} \\rightarrow \\mathrm{D}$）：对于每个子循环，首先应用注入算子，使动能增加 $L \\delta t$（即，更新 $v$ 使得 $K \\leftarrow K + L \\delta t$），然后应用阻力算子，使用带有线性阻力的前向欧拉递减来更新 $v$，$v \\leftarrow v \\left( 1 - \\delta t / \\tau_{\\mathrm{d}} \\right)$，并将该子循环中由阻力耗散的能量近似为 $D_{\\mathrm{sub}} \\approx m v_{\\mathrm{pre}}^2 \\delta t / \\tau_{\\mathrm{d}}$，其中 $v_{\\mathrm{pre}}$ 是在该子循环中应用阻力算子之前的速度。\n- 先阻力后注入（$\\mathrm{D} \\rightarrow \\mathrm{I}$）：对于每个子循环，首先如上所述应用阻力算子，然后应用注入算子，使动能增加 $L \\delta t$。\n\n在整个注入持续时间 $T_{\\mathrm{inj}}$ 内，使用大小为 $\\Delta t$ 的全局步长进行积分，直到 $t = T_{\\mathrm{inj}}$（如有必要，可缩短最后一个全局步长，以使总时间恰好等于 $T_{\\mathrm{inj}}$）。总注入能量为 $E_{\\mathrm{in}} = L T_{\\mathrm{inj}}$（以焦耳为单位），总耗散能量为 $D_{\\mathrm{num}}$（所有阻力子循环中 $D_{\\mathrm{sub}}$ 的总和，以焦耳为单位）。数值动能变化为 $\\Delta K_{\\mathrm{num}} = \\tfrac{1}{2} m v(T_{\\mathrm{inj}})^2 - \\tfrac{1}{2} m v_0^2$（以焦耳为单位）。将能量守恒误差定义为无量纲分数\n$$\n\\varepsilon_E = \\frac{E_{\\mathrm{in}} - \\Delta K_{\\mathrm{num}} - D_{\\mathrm{num}}}{E_{\\mathrm{in}}}.\n$$\n对于连续系统，通过在 $[0, T_{\\mathrm{inj}}]$ 上积分基本能量平衡方程，从第一性原理推导出精确的 $v(t)$ 和精确的阻力能量 $D_{\\mathrm{exact}}$。利用这些，计算最终的精确风速 $v_{\\mathrm{exact}} = v(T_{\\mathrm{inj}})$，并将风速的相对偏差（无量纲）定义为\n$$\n\\varepsilon_v = \\begin{cases}\n\\dfrac{v_{\\mathrm{num}} - v_{\\mathrm{exact}}}{v_{\\mathrm{exact}}},  v_{\\mathrm{exact}} \\neq 0,\\\\\n0,  v_{\\mathrm{exact}} = 0,\n\\end{cases}\n$$\n其中 $v_{\\mathrm{num}}$ 是在 $t = T_{\\mathrm{inj}}$ 时数值计算得到的风速。所有速度必须以 $\\mathrm{m/s}$ 表示，所有时间以 $\\mathrm{s}$ 表示，功率以 $\\mathrm{J/s}$ 表示，质量以 $\\mathrm{kg}$ 表示，能量以 $\\mathrm{J}$ 表示。每个测试用例的最终答案 $\\varepsilon_E$ 和 $\\varepsilon_v$ 都必须作为不带单位符号的实数返回，并且必须表示为小数（浮点数）。\n\n实现一个程序，给定固定的物理参数 $(m, \\tau_{\\mathrm{d}}, L, v_0, T_{\\mathrm{inj}})$ 和一组数值参数 $(\\Delta t, n_{\\mathrm{sub}}, \\text{ordering})$，为每个测试用例计算如上指定的 $(\\varepsilon_E, \\varepsilon_v)$。注入算子必须通过强制执行动能增量 $L \\delta t$ 来更新速度。阻力算子必须使用前向欧拉速度更新 $v \\leftarrow v (1 - \\delta t/\\tau_{\\mathrm{d}})$，并且必须将该子循环中的耗散能量近似为 $m v_{\\mathrm{pre}}^2 \\delta t/\\tau_{\\mathrm{d}}$。\n\n你的程序应该处理以下测试套件，其通用物理参数为 $m = 1.0$（单位 $\\mathrm{kg}$），$\\tau_{\\mathrm{d}} = 2.0$（单位 $\\mathrm{s}$），$L = 1.0$（单位 $\\mathrm{J/s}$），$v_0 = 0.0$（单位 $\\mathrm{m/s}$），$T_{\\mathrm{inj}} = 4.0$（单位 $\\mathrm{s}$）。每个用例的数值参数为：\n- 用例 1：$\\Delta t = 0.1$（单位 $\\mathrm{s}$），$n_{\\mathrm{sub}} = 1$，排序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n- 用例 2：$\\Delta t = 0.1$（单位 $\\mathrm{s}$），$n_{\\mathrm{sub}} = 1$，排序 = $\\mathrm{D} \\rightarrow \\mathrm{I}$。\n- 用例 3：$\\Delta t = 0.5$（单位 $\\mathrm{s}$），$n_{\\mathrm{sub}} = 1$，排序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n- 用例 4：$\\Delta t = 0.5$（单位 $\\mathrm{s}$），$n_{\\mathrm{sub}} = 5$，排序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n- 用例 5：$\\Delta t = 2.0$（单位 $\\mathrm{s}$），$n_{\\mathrm{sub}} = 1$，排序 = $\\mathrm{D} \\rightarrow \\mathrm{I}$。\n\n你的程序应该生成单行输出，其中包含一个以逗号分隔的 Python 风格列表的结果，其中每个元素对应一个测试用例，并且本身是一个包含两个浮点数 $[\\varepsilon_E, \\varepsilon_v]$ 的列表。例如，输出格式必须是\n$$\n[[\\varepsilon_{E,1}, \\varepsilon_{v,1}], [\\varepsilon_{E,2}, \\varepsilon_{v,2}], \\dots ].\n$$\n排序标签必须完全按照上面的写法来解释。此问题不涉及角度。所有必需的单位均已指定；确保为能量和速度推导的任何数值答案都基于这些单位。程序不得读取输入；它必须嵌入测试套件并打印单行输出。数值方案必须实现所描述的算子分裂和子循环，并且精确参考值必须从给定的基本定律推导出来。将每个 $\\varepsilon_E$ 和 $\\varepsilon_v$ 报告为浮点数，不要四舍五入到固定的小数位数。", "solution": "为了量化算子分裂误差，我们首先推导风速演化的精确解析解作为基准，然后实现指定的数值方案并计算其与精确解的偏差。\n\n#### 1. 精确解析解\n\n动能 $K(t) = \\frac{1}{2} m v(t)^2$ 的控制方程为一阶线性常微分方程：\n$$ \\frac{dK}{dt} = L - \\frac{m v(t)^2}{\\tau_{\\mathrm{d}}} = L - \\frac{2K(t)}{\\tau_{\\mathrm{d}}} $$\n$$ \\frac{dK}{dt} + \\frac{2}{\\tau_{\\mathrm{d}}} K(t) = L $$\n使用积分因子法，该方程在初始条件 $K(0) = K_0$ 下的解为：\n$$ K(t) = \\frac{L\\tau_{\\mathrm{d}}}{2} + \\left(K_0 - \\frac{L\\tau_{\\mathrm{d}}}{2}\\right) e^{-2t/\\tau_{\\mathrm{d}}} $$\n在时刻 $t=T_{\\mathrm{inj}}$ 时的精确最终速度 $v_{\\mathrm{exact}}$ 由 $v_{\\mathrm{exact}} = \\sqrt{2 K(T_{\\mathrm{inj}})/m}$ 给出。\n总注入能量为 $E_{\\mathrm{in}} = L T_{\\mathrm{inj}}$。动能的精确变化为 $\\Delta K_{\\mathrm{exact}} = K(T_{\\mathrm{inj}}) - K_0$。根据能量守恒，由阻力耗散的总能量 $D_{\\mathrm{exact}}$ 是 $D_{\\mathrm{exact}} = E_{\\mathrm{in}} - \\Delta K_{\\mathrm{exact}}$。\n\n#### 2. 数值方案与误差计算\n\n数值方案在时间 $[0, T_{\\mathrm{inj}}]$ 内使用大小为 $\\Delta t$ 的全局步长进行积分，每个全局步长包含 $n_{\\mathrm{sub}}$ 个持续时间为 $\\delta t = \\Delta t/n_{\\mathrm{sub}}$ 的子循环。风速 $v$ 按以下算子更新：\n\n- **注入算子 ($\\mathrm{I}$)**：$K_{\\mathrm{new}} = K_{\\mathrm{old}} + L\\delta t$，因此 $v_{\\mathrm{new}} = \\sqrt{v_{\\mathrm{old}}^2 + 2L\\delta t/m}$。\n- **阻力算子 ($\\mathrm{D}$)**：$v_{\\mathrm{new}} = v_{\\mathrm{old}}(1 - \\delta t/\\tau_{\\mathrm{d}})$。该子循环耗散的能量近似为 $D_{\\mathrm{sub}} = m v_{\\mathrm{old}}^2 \\delta t/\\tau_{\\mathrm{d}}$。\n\n根据指定的 `ordering`（$\\mathrm{I} \\rightarrow \\mathrm{D}$ 或 $\\mathrm{D} \\rightarrow \\mathrm{I}$）顺序应用这些算子。总数值耗散能量 $D_{\\mathrm{num}}$ 是所有 $D_{\\mathrm{sub}}$ 的总和。\n\n模拟结束后，我们得到最终数值速度 $v_{\\mathrm{num}}$ 和总耗散能量 $D_{\\mathrm{num}}$。然后计算：\n- **能量守恒误差** $\\varepsilon_E = (E_{\\mathrm{in}} - \\Delta K_{\\mathrm{num}} - D_{\\mathrm{num}})/E_{\\mathrm{in}}$，其中 $\\Delta K_{\\mathrm{num}} = \\frac{1}{2}m v_{\\mathrm{num}}^2 - K_0$。\n- **速度相对偏差** $\\varepsilon_v = (v_{\\mathrm{num}} - v_{\\mathrm{exact}})/v_{\\mathrm{exact}}$。\n\n对每个测试用例执行此过程，以获得 $(\\varepsilon_E, \\varepsilon_v)$ 对。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the subgrid feedback model problem for a suite of test cases.\n    It calculates the exact solution and then runs a numerical simulation\n    for each case to determine the energy conservation error and velocity bias.\n    \"\"\"\n\n    # Common physical parameters\n    m = 1.0  # kg\n    tau_d = 2.0  # s\n    L = 1.0  # J/s\n    v0 = 0.0  # m/s\n    T_inj = 4.0  # s\n\n    # Test suite\n    test_cases = [\n        {'dt': 0.1, 'n_sub': 1, 'ordering': 'I-D'},\n        {'dt': 0.1, 'n_sub': 1, 'ordering': 'D-I'},\n        {'dt': 0.5, 'n_sub': 1, 'ordering': 'I-D'},\n        {'dt': 0.5, 'n_sub': 5, 'ordering': 'I-D'},\n        {'dt': 2.0, 'n_sub': 1, 'ordering': 'D-I'},\n    ]\n\n    # --- Exact Solution Calculation ---\n    K0 = 0.5 * m * v0**2\n    \n    # Exact kinetic energy at T_inj\n    K_exact_final = (L * tau_d / 2.0) + (K0 - L * tau_d / 2.0) * np.exp(-2 * T_inj / tau_d)\n    \n    # Exact final velocity\n    if K_exact_final >= 0:\n        v_exact = np.sqrt(2 * K_exact_final / m)\n    else:\n        # Should not happen with given parameters\n        v_exact = 0.0\n\n    results = []\n    for case in test_cases:\n        dt = case['dt']\n        n_sub = case['n_sub']\n        ordering = case['ordering']\n\n        # --- Numerical Simulation ---\n        v = v0\n        current_time = 0.0\n        D_num = 0.0\n\n        # Loop over global time steps until T_inj is reached\n        while not np.isclose(current_time, T_inj):\n            time_step = min(dt, T_inj - current_time)\n            delta_t_sub = time_step / n_sub\n\n            # Subcycling loop\n            for _ in range(n_sub):\n                if ordering == 'I-D':\n                    # 1. Injection Operator\n                    v = np.sqrt(v**2 + 2 * L * delta_t_sub / m)\n                    \n                    # 2. Drag Operator\n                    v_pre_drag = v\n                    D_sub = m * v_pre_drag**2 * delta_t_sub / tau_d\n                    D_num += D_sub\n                    v = v_pre_drag * (1.0 - delta_t_sub / tau_d)\n\n                elif ordering == 'D-I':\n                    # 1. Drag Operator\n                    v_pre_drag = v\n                    D_sub = m * v_pre_drag**2 * delta_t_sub / tau_d\n                    D_num += D_sub\n                    v = v_pre_drag * (1.0 - delta_t_sub / tau_d)\n                    \n                    # 2. Injection Operator\n                    v = np.sqrt(v**2 + 2 * L * delta_t_sub / m)\n            \n            current_time += time_step\n\n        v_num = v\n        \n        # --- Error Calculation ---\n        E_in = L * T_inj\n        K_num_final = 0.5 * m * v_num**2\n        delta_K_num = K_num_final - K0\n        \n        # Energy conservation error\n        # Avoid division by zero if E_in is zero, though not possible in this problem.\n        epsilon_E = (E_in - delta_K_num - D_num) / E_in if E_in != 0 else 0.0\n        \n        # Fractional bias in wind speed\n        if v_exact != 0:\n            epsilon_v = (v_num - v_exact) / v_exact\n        else:\n            epsilon_v = 0.0\n            \n        results.append([epsilon_E, epsilon_v])\n\n    # Final print statement in the exact required format.\n    # The default string representation for a list includes spaces, which\n    # aligns with the Python-style list format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3491413"}, {"introduction": "超越简单的热能注入，更先进的次网格模型开始考虑湍流的产生。此实践将构建一个次网格湍动能的稳态模型，在该模型中，由反馈驱动的能量产生与能量耗散及浮力汇相平衡。通过这个练习，您将接触到次网格“闭合关系”和求解平衡态的概念，这为实现更复杂、追踪非热能量成分的多变量反馈模型奠定了基础 [@problem_id:3491461]。", "problem": "您将设计并实现一个最小亚格子模型，用于描述在一维分层盒子中，由超新星（SN）和活动星系核（AGN）的体积能量注入驱动的比湍动能 $k$。该盒子具有恒定的引力加速度 $g$。该模型应通过在以下假设下求解 $k$ 的稳态值，在中心平面 $z=0$ 处进行验证。\n\n建模假设（作为基础出发点）：\n- 气体是等温的，声速为 $c_s$，中心平面密度为 $\\rho_0$，在恒定引力加速度 $g$ 下处于静流体平衡状态，因此特征等温压力标高为 $H = c_s^2/g$。\n- 亚格子混合长度建模为 $\\ell = \\alpha H$，其中 $\\alpha$ 是一个无量纲常数参数。\n- 在 $z=0$ 处，一部分比例为 $f_{\\mathrm{SN}}$ 的超新星体积能量注入率 $e_{\\mathrm{SN},0}$ 和一部分比例为 $f_{\\mathrm{AGN}}$ 的活动星系核体积能量注入率 $e_{\\mathrm{AGN},0}$ 被转化为亚格子湍流能量。相应的比湍流能量注入率为 $S = \\left(f_{\\mathrm{SN}} e_{\\mathrm{SN},0} + f_{\\mathrm{AGN}} e_{\\mathrm{AGN},0}\\right)/\\rho_0$。\n- 湍流能量的耗散遵循 Kolmogorov 标度闭合关系 $\\varepsilon = C_\\varepsilon k^{3/2}/\\ell$，其中 $C_\\varepsilon$ 是一个量级为1的常数。\n- 稳定分层引起一个浮力汇，建模为 $B = - C_b (g/c_s) k$，其中 $C_b$ 是一个无量纲常数。\n\n从湍动能收支方程出发，在中心平面忽略平流项，通过平衡产生项和汇项来施加稳态条件 $\\partial_t k = 0$ (在 $z=0$ 处)。仅使用上述给出的定义，推导出一个关于 $k \\ge 0$ 的可解代数条件。\n\n您的程序必须针对下面的每个测试用例，计算出中心平面的稳态值 $k$（单位为 $\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$），该值满足上述闭合关系所隐含的稳态平衡。计算需满足 $k \\ge 0$ 的约束条件，且物理上相关的解是所隐含的稳态方程的唯一非负实根。\n\n全程使用的物理单位：\n- $g$ 单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-2}$，\n- $c_s$ 单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$，\n- $\\rho_0$ 单位为 $\\mathrm{g}\\,\\mathrm{cm}^{-3}$，\n- $e_{\\mathrm{SN},0}$ 和 $e_{\\mathrm{AGN},0}$ 单位为 $\\mathrm{erg}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$，\n- $k$ 单位为 $\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$。\n\n所有测试用例共享的常数：\n- $\\alpha = 0.5$，\n- $C_\\varepsilon = 1.0$，\n- $C_b = 0.5$。\n\n测试组参数集（每个用例给出一个元组 $(g, c_s, \\rho_0, e_{\\mathrm{SN},0}, f_{\\mathrm{SN}}, e_{\\mathrm{AGN},0}, f_{\\mathrm{AGN}})$）：\n1. 用例A（超新星主导的暖盘）：$(g = 2.0\\times 10^{-9},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 1.67\\times 10^{-24},\\ e_{\\mathrm{SN},0} = 1.0\\times 10^{-26},\\ f_{\\mathrm{SN}} = 0.10,\\ e_{\\mathrm{AGN},0} = 0.0,\\ f_{\\mathrm{AGN}} = 0.0)$。\n2. 用例B（AGN主导的热晕）：$(g = 1.0\\times 10^{-8},\\ c_s = 1.0\\times 10^{7},\\ \\rho_0 = 1.0\\times 10^{-26},\\ e_{\\mathrm{SN},0} = 0.0,\\ f_{\\mathrm{SN}} = 0.0,\\ e_{\\mathrm{AGN},0} = 1.0\\times 10^{-25},\\ f_{\\mathrm{AGN}} = 0.30)$。\n3. 用例C（联合驱动）：$(g = 5.0\\times 10^{-9},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 5.0\\times 10^{-25},\\ e_{\\mathrm{SN},0} = 3.0\\times 10^{-26},\\ f_{\\mathrm{SN}} = 0.20,\\ e_{\\mathrm{AGN},0} = 1.0\\times 10^{-25},\\ f_{\\mathrm{AGN}} = 0.05)$。\n4. 用例D（无源边界情况）：$(g = 2.0\\times 10^{-9},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 1.67\\times 10^{-24},\\ e_{\\mathrm{SN},0} = 0.0,\\ f_{\\mathrm{SN}} = 0.0,\\ e_{\\mathrm{AGN},0} = 0.0,\\ f_{\\mathrm{AGN}} = 0.0)$。\n5. 用例E（强引力抑制）：$(g = 3.0\\times 10^{-8},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 1.67\\times 10^{-24},\\ e_{\\mathrm{SN},0} = 1.0\\times 10^{-26},\\ f_{\\mathrm{SN}} = 0.10,\\ e_{\\mathrm{AGN},0} = 0.0,\\ f_{\\mathrm{AGN}} = 0.0)$。\n\n数值要求：\n- 对每个用例，使用给定的 $g$ 和 $c_s$ 计算 $H = c_s^2/g$ 和 $\\ell = \\alpha H$。\n- 构建由上述闭合关系所隐含的稳态方程，并求解唯一的非负实数解 $k$。\n- 将每个得到的 $k$ 以 $\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$ 为单位表示，并四舍五入到三位有效数字。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含按顺序排列的五个四舍五入后的值，格式为用方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是一个四舍五入到三位有效数字的浮点数。不允许有任何额外的字符或空格。", "solution": "该问题要求解在分层环境中中心平面（$z=0$）处比湍动能 $k$ 的稳态值。稳态解通过平衡湍流的能量源项和汇项得到。\n\n比湍动能 $k$ 的收支方程（忽略平流项）为：\n$$\n\\frac{\\partial k}{\\partial t} = S - \\varepsilon + B\n$$\n其中 $S$ 是比湍流能量注入率，$\\varepsilon$ 是湍流耗散率，而 $B$ 是由稳定分层引起的浮力做功项。\n\n根据问题中的模型假设：\n1.  **能量注入率** $S$ 结合了超新星（SN）和活动星系核（AGN）的贡献：\n    $$\n    S = \\frac{f_{\\mathrm{SN}} e_{\\mathrm{SN},0} + f_{\\mathrm{AGN}} e_{\\mathrm{AGN},0}}{\\rho_0}\n    $$\n2.  **湍流耗散率** $\\varepsilon$ 遵循 Kolmogorov 标度：\n    $$\n    \\varepsilon = \\frac{C_\\varepsilon k^{3/2}}{\\ell}\n    $$\n3.  **浮力项** $B$ 对能量是汇项，其模型为：\n    $$\n    B = -C_b \\frac{g}{c_s} k\n    $$\n    其中负号表示浮力在稳定分层中消耗湍动能。\n\n混合长度 $\\ell$ 与等温压力标高 $H = c_s^2/g$ 相关，即 $\\ell = \\alpha H = \\alpha c_s^2/g$。\n\n在稳态条件下（$\\partial k / \\partial t = 0$），源项和汇项必须平衡：\n$$\nS - \\frac{C_\\varepsilon k^{3/2}}{\\alpha c_s^2 / g} - C_b \\frac{g}{c_s} k = 0\n$$\n整理后得到一个关于 $k$ 的代数方程：\n$$\n\\left(\\frac{C_\\varepsilon g}{\\alpha c_s^2}\\right) k^{3/2} + \\left(C_b \\frac{g}{c_s}\\right) k - S = 0\n$$\n为了求解，我们引入变量 $x = \\sqrt{k}$（由于 $k \\ge 0$，我们只关心非负实数解 $x \\ge 0$）。方程变为关于 $x$ 的三次多项式：\n$$\n\\left(\\frac{C_\\varepsilon g}{\\alpha c_s^2}\\right) x^3 + \\left(C_b \\frac{g}{c_s}\\right) x^2 - S = 0\n$$\n该方程的形式为 $P_3 x^3 + P_2 x^2 + P_0 = 0$，其中系数 $P_3, P_2 > 0$ 且 $P_0 = -S \\le 0$。对于 $x \\ge 0$，该多项式函数是单调递增的，因此保证存在唯一的非负实数根。\n\n如果 $S=0$，则唯一的非负解是 $x=0$，即 $k=0$。如果 $S>0$，则可以通过数值方法（如 `numpy.roots`）求解该三次方程，找到唯一的正实根 $x_{\\mathrm{sol}}$。最终的稳态湍动能为 $k = x_{\\mathrm{sol}}^2$。对每个测试用例执行此计算，并将结果四舍五入到三位有效数字。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the steady-state midplane turbulent kinetic energy k for a series of test cases.\n    \"\"\"\n    # Shared constants from the problem statement.\n    ALPHA = 0.5\n    C_EPS = 1.0\n    C_B = 0.5\n\n    # Test suite parameter sets:\n    # (g, c_s, rho_0, e_SN,0, f_SN, e_AGN,0, f_AGN)\n    test_cases = [\n        # Case A (SN-dominated warm disk)\n        (2.0e-9, 1.0e6, 1.67e-24, 1.0e-26, 0.10, 0.0, 0.0),\n        # Case B (AGN-dominated hot halo)\n        (1.0e-8, 1.0e7, 1.0e-26, 0.0, 0.0, 1.0e-25, 0.30),\n        # Case C (combined driving)\n        (5.0e-9, 1.0e6, 5.0e-25, 3.0e-26, 0.20, 1.0e-25, 0.05),\n        # Case D (no sources boundary case)\n        (2.0e-9, 1.0e6, 1.67e-24, 0.0, 0.0, 0.0, 0.0),\n        # Case E (strong gravity suppression)\n        (3.0e-8, 1.0e6, 1.67e-24, 1.0e-26, 0.10, 0.0, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        g, c_s, rho_0, e_sn_0, f_sn, e_agn_0, f_agn = case\n\n        # Calculate the specific turbulent energy injection rate S.\n        # Erg = g * cm^2 / s^2. S has units of cm^2/s^3.\n        s_term = (f_sn * e_sn_0 + f_agn * e_agn_0) / rho_0\n\n        if s_term == 0:\n            # If there are no sources, the turbulent kinetic energy is zero.\n            k_val = 0.0\n        else:\n            # Set up the cubic equation for x = sqrt(k): P3*x^3 + P2*x^2 - S = 0\n            # P3 = (C_epsilon * g) / (alpha * c_s^2)\n            # P2 = C_b * g / c_s\n            # P1 = 0\n            # P0 = -S\n            \n            p3 = (C_EPS * g) / (ALPHA * c_s**2)\n            p2 = (C_B * g) / c_s\n            p1 = 0.0\n            p0 = -s_term\n            \n            coeffs = [p3, p2, p1, p0]\n            \n            # Find the roots of the polynomial.\n            roots = np.roots(coeffs)\n            \n            # Find the unique non-negative real root for x = sqrt(k).\n            x_sol = None\n            for root in roots:\n                if np.isreal(root) and root.real >= 0:\n                    x_sol = root.real\n                    break\n            \n            if x_sol is None:\n                # This should not happen based on the problem analysis.\n                # Raise an error for robustness.\n                raise ValueError(\"No non-negative real root found.\")\n\n            # Calculate k from x.\n            k_val = x_sol**2\n\n        # Format the result to 3 significant figures.\n        # The 'g' format specifier handles general number formatting,\n        # switching to scientific notation for large/small numbers.\n        if k_val == 0.0:\n            formatted_k = '0.0'\n        else:\n            # Use a helper function for proper significant figure formatting.\n            def format_to_sig_figs(num, sig_figs):\n                if num == 0:\n                    return \"0.0\"\n                return f\"{num:.{sig_figs-1}e}\" if abs(np.log10(abs(num))) > 3 else f\"{num:.{sig_figs}g}\"\n\n            # The problem asks for standard float representation if possible.\n            # '.3g' format in python is close to what's needed.\n            formatted_k = format(k_val, '.3g')\n\n        results.append(formatted_k)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3491461"}]}