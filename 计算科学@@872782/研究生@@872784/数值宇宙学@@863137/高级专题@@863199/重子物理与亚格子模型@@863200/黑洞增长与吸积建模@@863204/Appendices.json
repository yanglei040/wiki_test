{"hands_on_practices": [{"introduction": "在理想磁流体动力学（MHD）中，无散（$\\nabla\\cdot\\mathbf{B}=0$）条件是磁场必须遵守的基本物理约束。数值模拟中的离散化误差可能会破坏这一约束，引入非物理性的力，从而污染模拟结果。本练习聚焦于约束输运（Constrained Transport, CT）方法，这是一种强大的数值技术，旨在确保磁场散度在机器精度内保持为零，是进行可靠的磁化吸积盘模拟的基石 [@problem_id:3479125]。", "problem": "您必须使用约束输运 (CT) 方法，在理想磁流体力学 (MHD) 中实现并研究磁场的演化。目标是解析和数值地证明，在一个有限体积格式中，离散磁散度约束 $\\nabla\\cdot\\mathbf{B}=0$ 能够保持到机器精度。在背景上，这代表了黑洞吸积流的几何薄片中的磁动力学，其中理想MHD感应主导场演化。数学基础应从法拉第定律和理想欧姆定律开始，不引入任何快捷公式。\n\n基本基础：\n- 理想磁流体动力学 (MHD) 中的理想欧姆定律：$\\mathbf{E}=-\\mathbf{v}\\times\\mathbf{B}$。\n- 法拉第定律：$\\partial_t\\mathbf{B}=-\\nabla\\times\\mathbf{E}$。\n- 磁场无散度约束：$\\nabla\\cdot\\mathbf{B}=0$。\n\n离散几何与变量：\n- 在一个长度为 $L_x=L_y=1$（以无量纲代码单位计）的方形域上，使用一个均匀、周期性的笛卡尔网格。设沿 $x$ 和 $y$ 方向的单元格数量分别为 $N_x$ 和 $N_y$，间距为 $\\Delta x=L_x/N_x$ 和 $\\Delta y=L_y/N_y$。\n- 将 $B_x$ 存储在索引为 $(i+\\tfrac{1}{2},j)$ 的 $x$ 面上，将 $B_y$ 存储在索引为 $(i,j+\\tfrac{1}{2})$ 的 $y$ 面上。将电场电动势分量 $E_z$ 存储在单元格角点 $(i+\\tfrac{1}{2},j+\\tfrac{1}{2})$ 上。\n- 从一个角点中心的矢量势 $A_z$ 初始化磁场，使得离散散度精确为零，具体方法是在面上使用源自角点差分的 $B_x=\\partial_y A_z$ 和 $B_y=-\\partial_x A_z$ 的离散形式。所有量均为无量纲。\n\n有限体积约束输运更新：\n- 从法拉第定律的积分形式推导 CT 更新，该定律应用于面平均磁通量和角点中心电动势。更新必须使用一套由 $B_x$ 和 $B_y$ 更新一致共享的角点 $E_z$ 值。您必须得到一个面心的更新，该更新是角点中心 $E_z$ 的离散旋度，并证明通过面心有限体积差分计算的离散散度在此更新下是不变的。\n\n速度场：\n- 使用预先确定的无散速度场来计算角点处的 $\\mathbf{E}=-\\mathbf{v}\\times\\mathbf{B}$。速度场应在角点处求值，并且可以是随时间变化的。所有场都是周期性的。\n\n要求的数值演示：\n- 在代码单位（无量纲）中实现 CT 格式，使用根据最大角点速度量值计算的、CFL数在 $(0,1)$ 内的 Courant–Friedrichs–Lewy (CFL) 条件，将磁场演化指定的步数，并为每个测试案例计算演化后网格中的最大绝对离散散度。\n\n测试套件：\n- 提供恰好四个测试案例，使用以下参数集，每个都以无量纲代码单位表示：\n  1. $N_x=32$, $N_y=32$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ 且 $B_0=1$，刚体旋转 $\\mathbf{v}(x,y)=(-\\Omega y,\\ \\Omega x)$ 且 $\\Omega=0.1$，时间步数 $N_{\\text{step}}=50$，CFL 数 $C=0.3$。\n  2. $N_x=16$, $N_y=16$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ 且 $B_0=0.5$，静态速度 $\\mathbf{v}=(0,0)$，时间步数 $N_{\\text{step}}=10$，CFL 数 $C=0.5$。\n  3. $N_x=8$, $N_y=8$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ 且 $B_0=1$，线性剪切 $\\mathbf{v}(x,y)=(S y,\\ 0)$ 且 $S=0.2$，时间步数 $N_{\\text{step}}=40$，CFL 数 $C=0.4$。\n  4. $N_x=12$, $N_y=10$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ 且 $B_0=1$，随时间变化的不可压缩涡流 $\\mathbf{v}(x,y,t)=(\\sin(2\\pi y)\\cos(2\\pi t),\\ -\\sin(2\\pi x)\\cos(2\\pi t))$，时间步数 $N_{\\text{step}}=25$，CFL 数 $C=0.3$。\n\n算法约束：\n- 角点中心的 $E_z$ 必须由角点中心的速度和通过将相邻面心的值平均到角点得到的角点中心磁场分量计算得出。\n- 在所有插值和差分中都必须强制执行周期性。\n- 时间步长 $\\Delta t$ 必须计算为 $\\Delta t=C\\min(\\Delta x,\\Delta y)/v_{\\max}$，其中 $v_{\\max}$ 是角点速度的最大量值；如果 $v_{\\max}=0$，则设 $\\Delta t=C\\min(\\Delta x,\\Delta y)$。\n\n输出规范：\n- 对于每个测试案例，计算最后时间步后单元格中心离散散度的最大绝对值。单元格 $(i,j)$ 处的离散散度为\n  $$D_{i,j}=\\frac{B_x|_{i+\\frac{1}{2},j}-B_x|_{i-\\frac{1}{2},j}}{\\Delta x}+\\frac{B_y|_{i,j+\\frac{1}{2}}-B_y|_{i,j-\\frac{1}{2}}}{\\Delta y}。$$\n- 以无量纲浮点数形式表示输出。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4]\"）。\n\n角度单位：\n- 所有三角函数均使用弧度。\n\n单位：\n- 全程使用无量纲代码单位。\n\n您的程序必须是一个完整的、可运行的实现，能够产生指定的输出，且无需用户输入。", "solution": "该问题要求在二维笛卡尔网格上实现并验证用于理想磁流体力学（MHD）感应方程的约束输运（CT）方法。主要目标是解析和数值地证明，磁场的离散散度随时间推移能保持在机器精度。\n\n我们从控制理想MHD中磁场 $\\mathbf{B}$ 演化的基本方程开始。这些是法拉第感应定律和理想欧姆定律：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = -\\nabla \\times \\mathbf{E}\n$$\n$$\n\\mathbf{E} = -\\mathbf{v} \\times \\mathbf{B}\n$$\n其中 $\\mathbf{E}$ 是电场，$\\mathbf{v}$ 是等离子体速度。将两者结合得到理想感应方程：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B})\n$$\n磁场的一个基本性质是无散度约束，$\\nabla \\cdot \\mathbf{B} = 0$。该条件被感应方程所保持。对法拉第定律取散度，我们发现：\n$$\n\\frac{\\partial}{\\partial t}(\\nabla \\cdot \\mathbf{B}) = \\nabla \\cdot \\left(\\frac{\\partial \\mathbf{B}}{\\partial t}\\right) = -\\nabla \\cdot (\\nabla \\times \\mathbf{E})\n$$\n由于任何矢量场旋度的散度恒为零（$\\nabla \\cdot (\\nabla \\times \\mathbf{F}) \\equiv 0$），因此可得 $\\frac{\\partial}{\\partial t}(\\nabla \\cdot \\mathbf{B}) = 0$。这意味着如果 $\\nabla \\cdot \\mathbf{B} = 0$ 在初始时刻 $t=0$ 成立，那么它在所有后续时刻都将保持为零。数值MHD中的一个关键挑战是构建一个在离散层面上尊重此属性的格式。约束输运方法正是为此目的而设计的。\n\n我们在一个尺寸为 $N_x \\times N_y$、定义域为 $[0, L_x] \\times [0, L_y]$（其中 $L_x=L_y=1$）的均匀、周期性笛卡尔网格上离散化问题。网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$。我们采用交错网格（一种类Yee网格），其中不同的场分量位于相对于网格单元 $(i,j)$ 的不同位置：\n- 单元格中心量位于 $(x_i, y_j) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$。\n- 磁场的 $x$ 分量 $B_x$ 定义在 $x$ 面上，位于 $(x_{i+1/2}, y_j) = ((i+1)\\Delta x, (j+0.5)\\Delta y)$。\n- $y$ 分量 $B_y$ 定义在 $y$ 面上，位于 $(x_i, y_{j+1/2}) = ((i+0.5)\\Delta x, (j+1)\\Delta y)$。\n- 电场的 $z$ 分量 $E_z$ 位于单元格角点，位于 $(x_{i+1/2}, y_{j+1/2}) = ((i+1)\\Delta x, (j+1)\\Delta y)$。\n\n$\\mathbf{B}$ 的离散散度自然地定义在单元格中心 $(i,j)$ 处，使用中心有限差分格式：\n$$\nD_{i,j} = \\left(\\nabla \\cdot \\mathbf{B}\\right)_{i,j} = \\frac{B_x|_{i+1/2,j} - B_x|_{i-1/2,j}}{\\Delta x} + \\frac{B_y|_{i,j+1/2} - B_y|_{i,j-1/2}}{\\Delta y}\n$$\n为确保初始离散散度为零，我们从一个角点中心的矢量势 $A_z$ 初始化磁场，该矢量势与 $E_z$ 位于相同的位置。磁场定义为 $A_z$ 的离散旋度：\n$$\nB_x|_{i+1/2,j} = \\frac{A_z|_{i+1/2,j+1/2} - A_z|_{i+1/2,j-1/2}}{\\Delta y}\n$$\n$$\nB_y|_{i,j+1/2} = -\\frac{A_z|_{i+1/2,j+1/2} - A_z|_{i-1/2,j+1/2}}{\\Delta x}\n$$\n将这些定义代入离散散度公式，会得到一个代数上为零的和，因为各项以逐项相消的方式完美抵消。因此，在初始化时，$D_{i,j}=0$，其精度可达机器浮点精度。\n\nCT 方法使用源自法拉第定律积分形式 $\\oint_{\\partial S} \\mathbf{E} \\cdot d\\mathbf{l} = -\\frac{d}{dt}\\int_S \\mathbf{B} \\cdot d\\mathbf{A}$ 的有限体积更新来演化磁场。将此定律应用于 $x$ 面（面积为 $\\Delta y \\times 1$）和 $y$ 面（面积为 $\\Delta x \\times 1$），可得到 $B_x$ 和 $B_y$ 的更新方程：\n$$\n\\frac{\\partial B_x|_{i+1/2,j}}{\\partial t} = -\\frac{E_z|_{i+1/2,j+1/2} - E_z|_{i+1/2,j-1/2}}{\\Delta y}\n$$\n$$\n\\frac{\\partial B_y|_{i,j+1/2}}{\\partial t} = \\frac{E_z|_{i+1/2,j+1/2} - E_z|_{i-1/2,j+1/2}}{\\Delta x}\n$$\n注意，面中心磁场分量的时间演化由角点中心电场 $E_z$ 的离散旋度给出。此结构与从 $A_z$ 定义 $\\mathbf{B}$ 的方式相同。\n\n为证明此格式保持零散度条件，我们考察离散散度的时间演化。为简单起见，使用前向欧拉时间步 $B^{n+1} = B^n + \\Delta t (\\partial B/\\partial t)$，第 $n+1$ 步的散度为：\n$$\nD^{n+1}_{i,j} = D^n_{i,j} + \\Delta t \\left( \\frac{(\\partial_t B_x)|_{i+1/2,j} - (\\partial_t B_x)|_{i-1/2,j}}{\\Delta x} + \\frac{(\\partial_t B_y)|_{i,j+1/2} - (\\partial_t B_y)|_{i,j-1/2}}{\\Delta y} \\right)\n$$\n乘以 $\\Delta t$ 的项是时间导数场 $\\nabla \\cdot (\\partial_t \\mathbf{B})$ 的离散散度。代入 CT 更新方程，该项恰好变为从 $E_z$ 的旋度派生的场的离散散度。正如从 $A_z$ 初始化时所展示的，这种构造导致代数上为零的离散散度。因此，$D^{n+1}_{i,j} = D^n_{i,j}$。由于 $D^0_{i,j} = 0$，离散散度在所有时间都保持为零，仅受浮点舍入误差累积的限制。\n\n数值算法如下：\n1.  为给定的测试案例初始化网格和参数。\n2.  定义角点坐标并计算这些角点上的初始矢量势 $A_z$。\n3.  计算初始的面中心场 $B_x$ 和 $B_y$ 作为 $A_z$ 的离散旋度，确保初始离散散度为零。\n4.  计算恒定时间步长 $\\Delta t = C \\min(\\Delta x, \\Delta y) / v_{\\max}$，其中 $v_{\\max}$ 是整个模拟过程中角点速度可能的最大量值。\n5.  开始 $N_{\\text{step}}$ 次迭代的时间步进循环：\n    a.  计算当前时刻 $t$ 每个角点上的速度分量 $(v_x, v_y)$。\n    b.  将面中心的磁场分量 $B_x$ 和 $B_y$ 平均到角点。例如，$B_x|_{i+1/2,j+1/2} = 0.5 \\left( B_x|_{i+1/2,j} + B_x|_{i+1/2,j+1} \\right)$，同时遵守周期性边界。\n    c.  计算角点电场 $E_z = v_y B_x - v_x B_y$。\n    d.  使用前向欧拉步和由 $E_z$ 的离散旋度计算出的时间导数来更新 $B_x$ 和 $B_y$。\n6.  在最后一步之后，计算所有单元格中心的离散散度 $D_{i,j}$。\n7.  该测试案例的最终结果是此散度数组的最大绝对值 $\\max |D_{i,j}|$。该值预期在机器精度的数量级上。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Constrained Transport MHD simulation for all test cases.\n    \"\"\"\n    test_cases = [\n        {\n            'Nx': 32, 'Ny': 32, 'B0': 1.0, 'vel_type': 'rotation',\n            'vel_param': 0.1, 'N_step': 50, 'CFL': 0.3\n        },\n        {\n            'Nx': 16, 'Ny': 16, 'B0': 0.5, 'vel_type': 'static',\n            'vel_param': 0.0, 'N_step': 10, 'CFL': 0.5\n        },\n        {\n            'Nx': 8, 'Ny': 8, 'B0': 1.0, 'vel_type': 'shear',\n            'vel_param': 0.2, 'N_step': 40, 'CFL': 0.4\n        },\n        {\n            'Nx': 12, 'Ny': 10, 'B0': 1.0, 'vel_type': 'swirl',\n            'vel_param': None, 'N_step': 25, 'CFL': 0.3\n        }\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        max_div = run_simulation(params)\n        results.append(max_div)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(params):\n    \"\"\"\n    Executes a single 2D ideal MHD simulation using the Constrained Transport method.\n    \"\"\"\n    # Unpack parameters\n    Nx, Ny = params['Nx'], params['Ny']\n    B0 = params['B0']\n    vel_type = params['vel_type']\n    vel_param = params['vel_param']\n    N_step = params['N_step']\n    CFL = params['CFL']\n\n    # Grid setup\n    Lx, Ly = 1.0, 1.0\n    dx, dy = Lx / Nx, Ly / Ny\n\n    # Define corner coordinates. These are at ((i+1)dx, (j+1)dy) for i,j in [0,N-1]\n    # np.linspace with endpoint=False gives [0, L-d], so we add d to get [d, L]\n    x_corner_1d = np.linspace(0, Lx, Nx, endpoint=False) + dx\n    y_corner_1d = np.linspace(0, Ly, Ny, endpoint=False) + dy\n    xx_c, yy_c = np.meshgrid(x_corner_1d, y_corner_1d, indexing='ij')\n    \n    # Initialize Vector Potential Az at corners\n    Az = B0 * np.sin(2 * np.pi * xx_c) * np.sin(2 * np.pi * yy_c)\n\n    # Initialize Magnetic Field Bx, By from Az to ensure div(B)=0\n    # Bx lives on x-faces (i+1/2, j)\n    # By lives on y-faces (i, j+1/2)\n    # B = curl(A), Bx=dAz/dy, By=-dAz/dx\n    # Using np.roll for periodic boundary conditions\n    Bx = (Az - np.roll(Az, 1, axis=1)) / dy\n    By = -(Az - np.roll(Az, 1, axis=0)) / dx\n\n    # Determine maximum velocity for timestep calculation\n    v_max = 0.0\n    if vel_type == 'rotation':\n        # v = (-omega*y, omega*x), max |v| at corner (Lx, Ly)\n        v_max = vel_param * np.sqrt(Lx**2 + Ly**2)\n    elif vel_type == 'static':\n        v_max = 0.0\n    elif vel_type == 'shear':\n        # v = (S*y, 0), max |v| at max y\n        v_max = vel_param * Ly\n    elif vel_type == 'swirl':\n        # v = (sin(2py)cos(2pt), -sin(2px)cos(2pt))\n        # max |v| over space and time is sqrt(1^2+1^2) = sqrt(2)\n        v_max = np.sqrt(2.0)\n\n    # Calculate timestep dt using CFL condition\n    min_ds = min(dx, dy)\n    if v_max == 0.0:\n        dt = CFL * min_ds\n    else:\n        dt = CFL * min_ds / v_max\n\n    # --- Time Evolution Loop ---\n    t = 0.0\n    for _ in range(N_step):\n        # 1. Compute velocity at corners (vx_c, vy_c)\n        if vel_type == 'rotation':\n            vx_c = -vel_param * yy_c\n            vy_c =  vel_param * xx_c\n        elif vel_type == 'static':\n            vx_c = np.zeros_like(xx_c)\n            vy_c = np.zeros_like(yy_c)\n        elif vel_type == 'shear':\n            vx_c = vel_param * yy_c\n            vy_c = np.zeros_like(yy_c)\n        elif vel_type == 'swirl':\n            cos_t = np.cos(2 * np.pi * t)\n            vx_c = np.sin(2 * np.pi * yy_c) * cos_t\n            vy_c = -np.sin(2 * np.pi * xx_c) * cos_t\n        \n        # 2. Average B from faces to corners\n        Bx_c = 0.5 * (Bx + np.roll(Bx, -1, axis=1))\n        By_c = 0.5 * (By + np.roll(By, -1, axis=0))\n\n        # 3. Compute Electric Field Ez at corners: E = -v x B => Ez = -(vx*By - vy*Bx)\n        Ez = vy_c * Bx_c - vx_c * By_c\n\n        # 4. Update B using CT: dB/dt = -curl(E)\n        # dBx/dt = -dEz/dy\n        # dBy/dt = dEz/dx\n        dBx_dt = -(Ez - np.roll(Ez, 1, axis=1)) / dy\n        dBy_dt = (Ez - np.roll(Ez, 1, axis=0)) / dx\n\n        # 5. Simple forward Euler step\n        Bx += dBx_dt * dt\n        By += dBy_dt * dt\n\n        # Update time\n        t += dt\n\n    # --- Post-simulation: Compute final divergence ---\n    # div(B) at cell centers (i,j)\n    divB = (Bx - np.roll(Bx, 1, axis=0)) / dx + \\\n           (By - np.roll(By, 1, axis=1)) / dy\n           \n    return np.max(np.abs(divB))\n\nsolve()\n```", "id": "3479125"}, {"introduction": "将理论模型与天文观测联系起来是数值天体物理学的一个核心目标。吸积率的时变性是吸积系统（如活动星系核）的一个关键可观测量，通常通过其功率谱密度（PSD）进行表征。本练习将理论与实践相结合，引导您从一个给定的“闪烁噪声”功率谱（$P(f) \\propto f^{-1}$）出发，推导并计算出特征时变尺度，并将其与吸积盘的基本物理时间尺度（如动力学和粘滞时间尺度）联系起来 [@problem_id:3479056]。", "problem": "考虑一个围绕质量为 $M=10^8\\,M_\\odot$ 的不旋转黑洞的、几何薄的、辐射有效的 Shakura–Sunyaev $\\alpha$盘。设所关注的柱半径为 $R=50\\,r_g$，其中引力半径为 $r_g \\equiv GM/c^2$。假设在半径 $R$ 处的局域质量吸积率的随机涨落，在一个由低频截断 $f_{\\min}$ 和高频截断 $f_{\\max}$ 界定的有限频带上，具有闪烁噪声功率谱密度 (PSD) $P(f)\\propto f^{-1}$。采用以下基于物理动机的认定：高频截断由局域动力学（轨道）时标决定，$f_{\\max} = 1/t_{\\mathrm{dyn}}(R)$，低频截断由局域粘滞时标决定，$f_{\\min} = 1/t_{\\mathrm{visc}}(R)$。使用具有 $\\alpha$粘滞的标准薄盘时标层级：开普勒角频率 $\\Omega_K(R)=\\sqrt{GM/R^3}$，动力学时标 $t_{\\mathrm{dyn}}(R)=2\\pi/\\Omega_K(R)$，热时标 $t_{\\mathrm{th}}(R)=\\alpha^{-1} t_{\\mathrm{dyn}}(R)$，以及粘滞时标 $t_{\\mathrm{visc}}(R)=(r/h)^2 t_{\\mathrm{th}}(R)$，其中 $h/r$ 是常数盘高宽比。在半径 $R=50\\,r_g$ 处，取 $\\alpha=0.1$ 和 $h/r=0.05$。\n\n将频带 $[f_{\\min}, f_{\\max}]$ 上闪烁噪声过程的特征时变频率 $f_{\\mathrm{var}}$ 定义为每对数频率区间的方差的对数质心，\n$$\nf_{\\mathrm{var}} \\equiv \\exp\\!\\left(\\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, w(f)\\, d\\ln f}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} w(f)\\, d\\ln f}\\right),\n$$\n其中权重是每对数区间的方差密度 $w(f)\\propto f P(f)$。相应的特征时变时标为 $t_{\\mathrm{var}} \\equiv 1/f_{\\mathrm{var}}$。\n\n从上述定义以及 $f_{\\min}$ 和 $f_{\\max}$ 的认定出发，推导在 $R=50\\,r_g$ 处 $t_{\\mathrm{var}}$ 的解析表达式，用基本常数和给定的盘参数表示。然后对 $M=10^8\\,M_\\odot$ 的情况进行数值计算，并将最终结果以天为单位表示。将最终数值答案四舍五入到3位有效数字。\n\n使用常数 $G=6.67430\\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$, $c=2.99792458\\times 10^8\\,\\mathrm{m\\,s^{-1}}$, 及 $M_\\odot=1.98847\\times 10^{30}\\,\\mathrm{kg}$。", "solution": "### 步骤1：提取已知条件\n问题陈述提供了以下信息：\n-   黑洞质量：$M=10^8\\,M_\\odot$\n-   自旋：不旋转黑洞\n-   吸积盘模型：几何薄的、辐射有效的 Shakura–Sunyaev $\\alpha$盘\n-   所关注的半径：$R=50\\,r_g$\n-   引力半径定义：$r_g \\equiv GM/c^2$\n-   质量吸积率涨落的功率谱密度(PSD)：$P(f)\\propto f^{-1}$\n-   频带：$[f_{\\min}, f_{\\max}]$\n-   高频截断：$f_{\\max} = 1/t_{\\mathrm{dyn}}(R)$\n-   低频截断：$f_{\\min} = 1/t_{\\mathrm{visc}}(R)$\n-   时标层级定义：\n    -   开普勒角频率：$\\Omega_K(R)=\\sqrt{GM/R^3}$\n    -   动力学时标：$t_{\\mathrm{dyn}}(R)=2\\pi/\\Omega_K(R)$\n    -   热时标：$t_{\\mathrm{th}}(R)=\\alpha^{-1} t_{\\mathrm{dyn}}(R)$\n    -   粘滞时标：$t_{\\mathrm{visc}}(R)=(r/h)^2 t_{\\mathrm{th}}(R)$，其中 $h/r$ 是常数盘高宽比\n-   半径 $R$ 处的盘参数：\n    -   粘滞参数：$\\alpha=0.1$\n    -   盘高宽比：$h/r=0.05$\n-   特征时变频率的定义：\n    $f_{\\mathrm{var}} \\equiv \\exp\\!\\left(\\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, w(f)\\, d(\\ln f)}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} w(f)\\, d(\\ln f)}\\right)$\n-   权重函数：$w(f)\\propto f P(f)$\n-   特征时变时标的定义：$t_{\\mathrm{var}} \\equiv 1/f_{\\mathrm{var}}$\n-   常数：\n    -   $G=6.67430\\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$\n    -   $c=2.99792458\\times 10^8\\,\\mathrm{m\\,s^{-1}}$\n    -   $M_\\odot=1.98847\\times 10^{30}\\,\\mathrm{kg}$\n-   要求输出：$t_{\\mathrm{var}}$ 的解析表达式及其以天为单位的数值，四舍五入到3位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上基于公认的黑洞吸积盘理论，特别是Shakura-Sunyaev模型。物理时标（动力学、热、粘滞）的定义是该领域的标准定义。闪烁噪声功率谱密度（$f^{-1}$）的概念在吸积系统中普遍观测到。将特征频率定义为对数质心在数学上是适定的、客观的。所有参数都有明确定义，给定的数值对于超大质量黑洞是物理上现实的。该问题是自洽的、一致的，并且要求基于已建立的物理和数学原理进行求解，没有明显缺陷。\n\n### 步骤3：结论与行动\n问题有效。我将继续进行求解。\n\n### 解析表达式的推导\n\n首先，我们确定特征时变频率 $f_{\\mathrm{var}}$。权重函数 $w(f)$ 与 $f P(f)$ 成正比。已知功率谱密度 $P(f) \\propto f^{-1}$，我们可以写成 $P(f) = k f^{-1}$，其中 $k$ 是某个常数。因此，权重函数 $w(f) \\propto f (k f^{-1}) = k$，是一个常数。我们将其记为 $C$。\n\n$f_{\\mathrm{var}}$ 的定义涉及量 $\\ln f_{\\mathrm{var}}$：\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, w(f)\\, d(\\ln f)}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} w(f)\\, d(\\ln f)} $$\n由于 $w(f)=C$ 是一个常数，它可以从积分中提出并消去：\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, d(\\ln f)}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} d(\\ln f)} $$\n令 $u = \\ln f$。积分变为：\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} u \\, du}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} du} = \\frac{\\left[ \\frac{1}{2}u^2 \\right]_{\\ln f_{\\min}}^{\\ln f_{\\max}}  }{ \\left[ u \\right]_{\\ln f_{\\min}}^{\\ln f_{\\max}} } = \\frac{\\frac{1}{2}((\\ln f_{\\max})^2 - (\\ln f_{\\min})^2)}{\\ln f_{\\max} - \\ln f_{\\min}} $$\n使用平方差公式，$a^2-b^2=(a-b)(a+b)$：\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\frac{1}{2}(\\ln f_{\\max} - \\ln f_{\\min})(\\ln f_{\\max} + \\ln f_{\\min})}{\\ln f_{\\max} - \\ln f_{\\min}} = \\frac{1}{2}(\\ln f_{\\max} + \\ln f_{\\min}) $$\n使用对数性质，这可以简化为：\n$$ \\ln f_{\\mathrm{var}} = \\ln((f_{\\max} f_{\\min})^{1/2}) $$\n对两边取指数，得到特征频率是边界频率的几何平均值：\n$$ f_{\\mathrm{var}} = \\sqrt{f_{\\max}f_{\\min}} $$\n特征时标是 $t_{\\mathrm{var}} = 1/f_{\\mathrm{var}}$。代入 $f_{\\mathrm{var}}$ 的表达式：\n$$ t_{\\mathrm{var}} = \\frac{1}{\\sqrt{f_{\\max}f_{\\min}}} $$\n问题认定 $f_{\\max} = 1/t_{\\mathrm{dyn}}(R)$ 和 $f_{\\min} = 1/t_{\\mathrm{visc}}(R)$。将这些代入 $t_{\\mathrm{var}}$ 的表达式中，得到：\n$$ t_{\\mathrm{var}} = \\frac{1}{\\sqrt{(1/t_{\\mathrm{dyn}}(R))(1/t_{\\mathrm{visc}}(R))}} = \\sqrt{t_{\\mathrm{dyn}}(R) t_{\\mathrm{visc}}(R)} $$\n接下来，我们用 $t_{\\mathrm{dyn}}(R)$ 和盘参数来表示 $t_{\\mathrm{visc}}(R)$。定义为 $t_{\\mathrm{th}}(R) = \\alpha^{-1} t_{\\mathrm{dyn}}(R)$ 和 $t_{\\mathrm{visc}}(R)=(r/h)^2 t_{\\mathrm{th}}(R)$。我们已知高宽比为 $h/r$，所以 $(r/h)=(h/r)^{-1}$。\n$$ t_{\\mathrm{visc}}(R) = \\left(\\frac{h}{r}\\right)^{-2} t_{\\mathrm{th}}(R) = \\left(\\frac{h}{r}\\right)^{-2} \\alpha^{-1} t_{\\mathrm{dyn}}(R) $$\n现在，我们将其代入 $t_{\\mathrm{var}}$ 的表达式中：\n$$ t_{\\mathrm{var}} = \\sqrt{t_{\\mathrm{dyn}}(R) \\left[ \\left(\\frac{h}{r}\\right)^{-2} \\alpha^{-1} t_{\\mathrm{dyn}}(R) \\right]} = \\sqrt{t_{\\mathrm{dyn}}(R)^2 \\left(\\frac{h}{r}\\right)^{-2} \\alpha^{-1}} $$\n$$ t_{\\mathrm{var}} = t_{\\mathrm{dyn}}(R) \\left(\\frac{h}{r}\\right)^{-1} \\alpha^{-1/2} $$\n动力学时标为 $t_{\\mathrm{dyn}}(R) = 2\\pi / \\Omega_K(R) = 2\\pi \\sqrt{R^3/(GM)}$。半径为 $R=50\\,r_g = 50\\,GM/c^2$。\n$$ t_{\\mathrm{dyn}}(R) = 2\\pi \\sqrt{\\frac{(50GM/c^2)^3}{GM}} = 2\\pi \\sqrt{\\frac{50^3 G^3 M^3 / c^6}{GM}} = 2\\pi \\sqrt{\\frac{50^3 G^2 M^2}{c^6}} $$\n$$ t_{\\mathrm{dyn}}(R) = 2\\pi \\cdot 50^{3/2} \\frac{GM}{c^3} $$\n最后，我们将 $t_{\\mathrm{dyn}}(R)$ 的这个表达式代入 $t_{\\mathrm{var}}$ 的方程，以获得完整的解析表达式：\n$$ t_{\\mathrm{var}} = \\left( 2\\pi \\cdot 50^{3/2} \\frac{GM}{c^3} \\right) \\left(\\frac{h}{r}\\right)^{-1} \\alpha^{-1/2} $$\n这个 $t_{\\mathrm{var}}$ 的表达式是根据要求，用基本常数 $G$ 和 $c$、黑洞质量 $M$以及盘参数 $\\alpha$ 和 $h/r$ 表示的。\n\n### 数值计算\n\n我们已知以下数值：\n-   $M = 10^8 M_\\odot = 10^8 \\times 1.98847 \\times 10^{30}\\,\\mathrm{kg} = 1.98847 \\times 10^{38}\\,\\mathrm{kg}$\n-   $G = 6.67430 \\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$\n-   $c = 2.99792458 \\times 10^8\\,\\mathrm{m\\,s^{-1}}$\n-   $\\alpha = 0.1$\n-   $h/r = 0.05$\n\n首先，我们计算引力半径的光渡时标，$t_g = GM/c^3$：\n$$ t_g = \\frac{(6.67430 \\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}) \\times (1.98847 \\times 10^{38}\\,\\mathrm{kg})}{(2.99792458 \\times 10^8\\,\\mathrm{m\\,s^{-1}})^3} $$\n$$ t_g \\approx \\frac{1.32712 \\times 10^{28}\\,\\mathrm{m^3\\,s^{-2}}}{2.69440 \\times 10^{25}\\,\\mathrm{m^3\\,s^{-3}}} \\approx 492.549\\,\\mathrm{s} $$\n接下来，我们计算在 $R=50\\,r_g$ 处的动力学时标 $t_{\\mathrm{dyn}}$：\n$$ t_{\\mathrm{dyn}} = 2\\pi \\cdot 50^{3/2} t_g = 2\\pi \\cdot (50 \\sqrt{50}) \\cdot t_g \\approx 2\\pi \\cdot 353.553 \\cdot 492.549\\,\\mathrm{s} \\approx 1094060\\,\\mathrm{s} $$\n现在，我们计算特征时标 $t_{\\mathrm{var}}$：\n$$ t_{\\mathrm{var}} = t_{\\mathrm{dyn}} \\left(\\frac{h}{r}\\right)^{-1} \\alpha^{-1/2} = t_{\\mathrm{dyn}} \\cdot (0.05)^{-1} \\cdot (0.1)^{-1/2} $$\n$$ t_{\\mathrm{var}} = t_{\\mathrm{dyn}} \\cdot (20) \\cdot \\sqrt{10} \\approx 1094060\\,\\mathrm{s} \\times 20 \\times 3.16228 \\approx 69192430\\,\\mathrm{s} $$\n最后，我们将结果从秒转换为天。一天中的秒数为 $24 \\times 60 \\times 60 = 86400\\,\\mathrm{s}$。\n$$ t_{\\mathrm{var}} \\text{ (以天为单位)} = \\frac{69192430\\,\\mathrm{s}}{86400\\,\\mathrm{s/day}} \\approx 800.838\\,\\text{天} $$\n四舍五入到3位有效数字，我们得到 $801$ 天。", "answer": "$$\n\\boxed{801}\n$$", "id": "3479056"}, {"introduction": "在宇宙学尺度的大规模模拟中，由于计算资源的限制，我们往往无法直接解析黑洞周围的吸积盘。这使得开发和使用“次网格”（subgrid）模型成为必需，这些模型能以较低的计算成本捕捉关键的吸积物理过程。本练习提供了一个构建和校准次网格模型的实践机会：您将基于更精细的物理模型（作为“基准真相”）来校准一个更简单的吸积率模型，这是在多尺度天体物理模拟中一项至关重要的技能 [@problem_id:3479059]。", "problem": "您的任务是为嵌入在孤立气体盘中的黑洞，构建并校准一个有物理动机但为次网格的、受角动量输运限制的吸积方案。校准是通过与一个在固定银心半径处的、受控的引力湍动粘性盘块“基准”模型进行比较来执行的。目标是在一系列具有不同 Toomre 稳定性和垂直厚度的案例中，推导、实现并测试一个将次网格模型与盘模型关联起来的校准常数。\n\n基本依据和假设：\n- 从 Toomre 稳定性参数 $Q$ 的定义、盘标高的静流体关系以及标准的粘性吸积质量通量出发。具体采用：\n  - 对于一个薄旋转盘，Toomre 参数 $Q$ 定义为 $Q \\equiv \\dfrac{c_s \\kappa}{\\pi G \\Sigma}$，其中 $c_s$ 是声速，$\\kappa$ 是周转频率， $G$ 是引力常数，$\\Sigma$ 是表面密度。\n  - 局部垂直静流体平衡 $H \\equiv \\dfrac{c_s}{\\Omega}$，并且对于所考虑的孤立盘块，取 $\\kappa \\approx \\Omega$。\n  - 粘性质量吸积率关系 $\\dot{M} \\equiv 3 \\pi \\nu \\Sigma$，其中 $\\nu \\equiv \\alpha_{\\mathrm{grav}} c_s H$ 是由引力矩产生的有效运动粘度，$\\alpha_{\\mathrm{grav}}$ 是一个无量纲的输运效率。\n\n- 使用一个经过充分测试的、随稳定性增加和厚度增加而单调抑制的函数，来封闭 $\\alpha_{\\mathrm{grav}}$ 的“基准”模型：\n  - 令 $Q_{\\mathrm{crit}} \\equiv 1$，并定义\n    $$\\alpha_{\\mathrm{grav}}(Q,H/R) \\equiv \\dfrac{\\alpha_0}{1 + \\left(\\dfrac{Q}{Q_{\\mathrm{crit}}}\\right)^2} \\times \\dfrac{1}{1 + \\left(\\dfrac{H}{R}\\right)^2},$$\n    其中 $\\alpha_0$ 是一个量级为 1 的常数，$R$ 是盘块的柱半径，$H/R$ 是盘的展弦比。这一选择反映了引力矩效率会随着 $Q$ 的增加（稳定性更高）和厚度的增加（自引力更弱）而降低。\n\n- 使用以上关系，用 $Q$ 和 $H$ 消去 $\\Sigma$，并得到一个仅用 $c_s$、$G$、$Q$、$\\alpha_0$ 和 $H/R$ 表示的“基准”吸积率 $\\dot{M}_{\\mathrm{sim}}$。您必须使用基本关系，不得引入任何非由它们推导的特设公式。\n\n待校准的次网格模型：\n- 考虑一个通过以下形式估算吸积率的次网格模型\n  $$\\dot{M}_{\\mathrm{model}} \\equiv \\kappa_c \\, M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q},$$\n  其中 $M_{\\mathrm{gas}}$ 是数值盘块中包含的气体质量，$\\kappa_c$ 是一个单位为 $\\mathrm{kg}^{-1}$ 的校准常数，以确保量纲一致性。因子 $M_{\\mathrm{gas}}$ 代表了分辨率尺度上可被力矩作用向内吸积的气体储库。\n\n- 为保持 $Q$、$H$ 和 $M_{\\mathrm{gas}}$ 之间的物理一致性，首先从基本关系计算 $\\Sigma$，然后取盘块气体质量为 $M_{\\mathrm{gas}} \\equiv \\Sigma \\, A$ 来确定 $M_{\\mathrm{gas}}$，其中盘块面积 $A$ 是固定的，由 $A \\equiv 2 \\pi R \\, \\Delta R$ 给出，半径 $R$ 和径向宽度 $\\Delta R$ 也是固定的。\n\n校准任务：\n- 在指定的案例子集（“训练”子集）上，通过最小化 $\\dot{M}_{\\mathrm{model}}$ 和 $\\dot{M}_{\\mathrm{sim}}$ 之间的残差平方和来校准单个常数 $\\kappa_c$。由于模型在 $\\kappa_c$ 上是线性的，您应该使用线性模型 $y = \\kappa_c x$ 的最小二乘解，其中\n  $$x \\equiv M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q}, \\quad y \\equiv \\dot{M}_{\\mathrm{sim}}.$$\n\n物理、常数和单位：\n- 全部使用国际单位制 (SI)。\n- 引力常数：$G \\equiv 6.67430 \\times 10^{-11} \\ \\mathrm{m}^3\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-2}$。\n- 声速：$c_s \\equiv 1.0 \\times 10^{4} \\ \\mathrm{m\\,s^{-1}}$。\n- 基准半径和环带宽度：$R \\equiv 100 \\ \\mathrm{pc}$，$\\Delta R \\equiv 10 \\ \\mathrm{pc}$，其中 $1 \\ \\mathrm{pc} \\equiv 3.085677581 \\times 10^{16} \\ \\mathrm{m}$。您必须将其转换为米。\n- 粘性效率归一化：$\\alpha_0 \\equiv 0.2$ (无量纲)。\n- 临界 Toomre 稳定性：$Q_{\\mathrm{crit}} \\equiv 1$ (无量纲)。\n- 不需要角度单位，因为没有角度显式出现。\n- 最终校准的常数 $\\kappa_c$ 必须以 $\\mathrm{kg}^{-1}$ 为单位报告。\n- 任何中间或派生的吸积率，如果在最终输出中使用，必须以 $\\mathrm{kg\\,s^{-1}}$ 为单位。下面要求的最终输出是无量纲的相对误差和一个有量纲的常数；它们必须以指定的单位报告。\n\n您的程序必须实现的步骤：\n1. 对于每个测试案例，取给定的对 $(Q,H)$ 并使用上面的 $R$ 计算 $H/R$。使用基本关系 $Q \\equiv \\dfrac{c_s \\kappa}{\\pi G \\Sigma}$（其中 $\\kappa \\approx \\Omega$）和 $H \\equiv \\dfrac{c_s}{\\Omega}$ 来用 $Q$、$H$、$c_s$ 和 $G$ 表示 $\\Sigma$。然后用 $A \\equiv 2 \\pi R \\Delta R$ 计算 $M_{\\mathrm{gas}} \\equiv \\Sigma \\, A$。\n2. 使用上面的定义计算 $\\alpha_{\\mathrm{grav}}(Q,H/R)$，并由此通过粘性吸积关系和基本定义计算出“基准”吸积率 $\\dot{M}_{\\mathrm{sim}}$。\n3. 仅使用测试套件中的前四个案例（按下面提供的顺序），通过最小二乘法校准 $\\kappa_c$。\n4. 使用这个校准后的 $\\kappa_c$，对所有测试案例计算 $\\dot{M}_{\\mathrm{model}}$，并按如下方式计算每个案例的相对误差\n   $$\\epsilon \\equiv \\dfrac{\\dot{M}_{\\mathrm{model}} - \\dot{M}_{\\mathrm{sim}}}{\\dot{M}_{\\mathrm{sim}}}.$$\n   每个 $\\epsilon$ 都必须以小数形式报告（无量纲）。\n\n测试套件：\n- 使用以下八个案例，每个由 $(Q, H_{\\mathrm{pc}})$ 指定，其中 $H_{\\mathrm{pc}}$ 是以秒差距为单位的标高：\n  - 案例 1：$(Q = 0.7, \\ H_{\\mathrm{pc}} = 5)$\n  - 案例 2：$(Q = 1.0, \\ H_{\\mathrm{pc}} = 10)$\n  - 案例 3：$(Q = 2.0, \\ H_{\\mathrm{pc}} = 10)$\n  - 案例 4：$(Q = 1.5, \\ H_{\\mathrm{pc}} = 50)$\n  - 案例 5：$(Q = 3.0, \\ H_{\\mathrm{pc}} = 5)$\n  - 案例 6：$(Q = 1.2, \\ H_{\\mathrm{pc}} = 30)$\n  - 案例 7：$(Q = 5.0, \\ H_{\\mathrm{pc}} = 100)$\n  - 案例 8：$(Q = 0.9, \\ H_{\\mathrm{pc}} = 20)$\n\n最终输出规格：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，并按顺序包含以下条目：\n  - 校准后的常数 $\\kappa_c$（单位为 $\\mathrm{kg}^{-1}$），随后是\n  - 案例 1 到 8 的相对误差 $\\epsilon$，每个都为小数。\n- 所需输出格式示例（此处的值为占位符）：\n  - \"[1.23e-45,0.01,-0.02,0.005,0.1,-0.03,0.2,-0.15,0.0]\"", "solution": "问题陈述已经过分析，并被确定为有效。它在科学上基于吸积盘理论和唯象建模的标准框架，数学上是适定的，并提供了一套完整且一致的定义、数据和目标。该任务是推导并实现一个次网格吸积模型的校准程序。\n\n解决方案分几步进行：首先，从提供的基本关系中推导关键物理量的表达式；其次，制定校准程序；第三，概述计算算法。\n\n首先，我们推导必要的物理量。表面密度 $\\Sigma$ 用 Toomre 参数 $Q$ 和标高 $H$ 表示。\n我们已知：\n$Q \\equiv \\dfrac{c_s \\kappa}{\\pi G \\Sigma}$\n$H \\equiv \\dfrac{c_s}{\\Omega}$\n$\\kappa \\approx \\Omega$\n从 $H$ 和 $\\kappa$ 的关系中，我们得到周转频率 $\\kappa \\approx \\Omega = \\dfrac{c_s}{H}$。将此代入 $Q$ 的定义中：\n$Q = \\dfrac{c_s (c_s/H)}{\\pi G \\Sigma} = \\dfrac{c_s^2}{\\pi G \\Sigma H}$\n解出表面密度 $\\Sigma$ 可得：\n$$ \\Sigma = \\dfrac{c_s^2}{\\pi G Q H} $$\n在指定的面积为 $A \\equiv 2 \\pi R \\Delta R$ 的环形盘块内的气体质量 $M_{\\mathrm{gas}}$ 则是：\n$$ M_{\\mathrm{gas}} = \\Sigma A = \\left(\\dfrac{c_s^2}{\\pi G Q H}\\right) (2 \\pi R \\Delta R) = \\dfrac{2 c_s^2 R \\Delta R}{G Q H} $$\n\n接下来，我们构建“基准”吸积率 $\\dot{M}_{\\mathrm{sim}}$。粘性吸积率由 $\\dot{M} \\equiv 3 \\pi \\nu \\Sigma$ 给出。有效运动粘度为 $\\nu \\equiv \\alpha_{\\mathrm{grav}} c_s H$。将它们结合起来得到：\n$$ \\dot{M}_{\\mathrm{sim}} = 3 \\pi (\\alpha_{\\mathrm{grav}} c_s H) \\Sigma $$\n代入我们推导出的 $\\Sigma$ 表达式：\n$$ \\dot{M}_{\\mathrm{sim}} = 3 \\pi (\\alpha_{\\mathrm{grav}} c_s H) \\left( \\dfrac{c_s^2}{\\pi G Q H} \\right) = \\dfrac{3 \\alpha_{\\mathrm{grav}} c_s^3}{G Q} $$\n无量纲输运效率 $\\alpha_{\\mathrm{grav}}$ 由以下函数给出：\n$$ \\alpha_{\\mathrm{grav}}(Q, H/R) = \\dfrac{\\alpha_0}{1 + (Q/Q_{\\mathrm{crit}})^2} \\times \\dfrac{1}{1 + (H/R)^2} $$\n其中 $\\alpha_0$ 和 $Q_{\\mathrm{crit}}$ 是常数。因此，用于比较的基准吸积率的完整表达式为：\n$$ \\dot{M}_{\\mathrm{sim}} = \\dfrac{3 c_s^3}{G Q} \\left[ \\dfrac{\\alpha_0}{1 + (Q/Q_{\\mathrm{crit}})^2} \\times \\dfrac{1}{1 + (H/R)^2} \\right] $$\n\n问题提出了一个形式为 $\\dot{M}_{\\mathrm{model}} \\equiv \\kappa_c \\, M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q}$ 的次网格模型。这是一个线性模型 $y = \\kappa_c x$，其中因变量是 $y \\equiv \\dot{M}_{\\mathrm{sim}}$，自变量是 $x \\equiv M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q}$。\n校准常数 $\\kappa_c$ 通过在一个训练数据集 $(x_i, y_i)$ 上最小化残差平方和 $\\sum (y_i - \\kappa_c x_i)^2$ 来确定。该模型（通过原点的回归）的标准最小二乘解是：\n$$ \\kappa_c = \\dfrac{\\sum_i x_i y_i}{\\sum_i x_i^2} $$\n如问题陈述中所指定，求和是在前四个测试案例上进行的。\n\n计算步骤如下：\n1. 以 SI 单位定义所有物理常数（$G$、$c_s$、$\\alpha_0$、$Q_{\\mathrm{crit}}$）和几何参数（$R$、$\\Delta R$）。使用转换公式 $1 \\ \\mathrm{pc} = 3.085677581 \\times 10^{16} \\ \\mathrm{m}$。\n2. 对于由 $(Q, H_{\\mathrm{pc}})$ 给出的八个测试案例中的每一个：\n    a. 将标高 $H_{\\mathrm{pc}}$ 从秒差距转换为米，得到 $H$。\n    b. 计算展弦比 $H/R$。\n    c. 使用其推导公式计算基准吸积率 $\\dot{M}_{\\mathrm{sim}}$。这作为目标值 $y_i$。\n    d. 使用其推导公式计算气体质量 $M_{\\mathrm{gas}}$。\n    e. 计算模型的自变量 $x_i = M_{\\mathrm{gas}} \\dfrac{c_s^3}{G Q}$。\n3. 使用前四个案例（$i=1, 2, 3, 4$）的 $x_i$ 和 $y_i$ 的计算值，通过最小二乘公式计算校准常数 $\\kappa_c$。\n4. 使用校准后的 $\\kappa_c$，为所有八个案例计算建模的吸积率 $\\dot{M}_{\\mathrm{model},i} = \\kappa_c x_i$。\n5. 对于每个案例，计算相对误差 $\\epsilon_i = (\\dot{M}_{\\mathrm{model},i} - \\dot{M}_{\\mathrm{sim},i}) / \\dot{M}_{\\mathrm{sim},i}$。\n6. 最终输出是一个有序列表，包含 $\\kappa_c$ 的值，后跟八个相对误差 $\\epsilon_1, \\dots, \\epsilon_8$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the black hole accretion subgrid model calibration problem.\n    \"\"\"\n    # Physics, constants, and units in SI\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    c_s = 1.0e4      # m s^-1\n    PC_TO_M = 3.085677581e16  # m/pc\n    \n    # Fiducial radius and annulus width\n    R_pc = 100.0     # pc\n    DeltaR_pc = 10.0 # pc\n    R = R_pc * PC_TO_M      # m\n    DeltaR = DeltaR_pc * PC_TO_M  # m\n    \n    # Model parameters\n    alpha_0 = 0.2          # dimensionless\n    Q_crit = 1.0           # dimensionless\n\n    # Test suite: (Q, H_pc)\n    test_cases = [\n        (0.7, 5.0),   # Case 1\n        (1.0, 10.0),  # Case 2\n        (2.0, 10.0),  # Case 3\n        (1.5, 50.0),  # Case 4\n        (3.0, 5.0),   # Case 5\n        (1.2, 30.0),  # Case 6\n        (5.0, 100.0), # Case 7\n        (0.9, 20.0),  # Case 8\n    ]\n\n    # Lists to store intermediate values for all cases\n    y_values = []  # Stores M_dot_sim\n    x_values = []  # Stores M_gas * c_s^3 / (G * Q)\n\n    # Step 1  2: Process each test case\n    for Q, H_pc in test_cases:\n        H = H_pc * PC_TO_M  # m\n        H_over_R = H / R\n\n        # Compute alpha_grav\n        alpha_grav = (alpha_0 / (1 + (Q / Q_crit)**2)) * (1 / (1 + H_over_R**2))\n        \n        # Compute ground-truth accretion rate M_dot_sim (y_i)\n        # M_dot_sim = (3 * alpha_grav * c_s^3) / (G * Q)\n        M_dot_sim = (3 * alpha_grav * c_s**3) / (G * Q)\n        y_values.append(M_dot_sim)\n\n        # Compute M_gas\n        # M_gas = (2 * c_s^2 * R * DeltaR) / (G * Q * H)\n        M_gas = (2 * c_s**2 * R * DeltaR) / (G * Q * H)\n        \n        # Compute the independent variable for the model (x_i)\n        # x = M_gas * c_s^3 / (G * Q)\n        x_val = M_gas * (c_s**3 / (G * Q))\n        x_values.append(x_val)\n\n    # Convert lists to numpy arrays for vectorized operations\n    y_all = np.array(y_values)\n    x_all = np.array(x_values)\n\n    # Step 3: Calibrate kappa_c using the training subset (first 4 cases)\n    x_train = x_all[:4]\n    y_train = y_all[:4]\n    \n    # kappa_c = sum(x_i * y_i) / sum(x_i^2)\n    sum_xy = np.sum(x_train * y_train)\n    sum_x2 = np.sum(x_train**2)\n    \n    # Handle potential division by zero, although not expected here\n    if sum_x2 == 0:\n        kappa_c = 0.0\n    else:\n        kappa_c = sum_xy / sum_x2\n    \n    # Step 4: Evaluate the model and compute relative errors for all cases\n    M_dot_model_all = kappa_c * x_all\n    \n    # epsilon = (M_dot_model - M_dot_sim) / M_dot_sim\n    # Avoid division by zero if M_dot_sim is zero\n    # np.divide handles this by returning inf or nan, which is fine\n    with np.errstate(divide='ignore', invalid='ignore'):\n         relative_errors = (M_dot_model_all - y_all) / y_all\n\n    # Prepare final output list\n    results = [kappa_c] + list(relative_errors)\n    \n    # Print in the required format\n    # The format specifier \"{}\" for float uses a default representation that's\n    # similar to 'g', switching to scientific notation for large/small numbers.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3479059"}]}