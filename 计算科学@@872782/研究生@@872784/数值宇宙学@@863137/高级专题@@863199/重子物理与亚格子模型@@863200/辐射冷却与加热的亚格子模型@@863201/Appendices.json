{"hands_on_practices": [{"introduction": "在宇宙学模拟中，理解气体热状态的基础是掌握加热与冷却过程之间的平衡。本练习将指导您计算低密度宇宙介质（Intergalactic Medium, IGM）在光致电离平衡（Photoionization Equilibrium, PIE）下的平衡温度。通过这个实践，您不仅能应用辐射过程的基本原理，还能揭示一个关键的物理洞见：在特定条件下，平衡温度如何变得与气体密度无关，这是理解弥散气体热行为的一个重要结论 [@problem_id:3491059]。", "problem": "考虑一团光学薄、空间均匀的低密度星系际介质 (IGM)，其处于光致电离平衡 (PIE) 状态。设总氢数密度为 $n$ (单位为 $\\mathrm{cm}^{-3}$)，中性氢数密度为 $n_\\mathrm{HI}$ (单位为 $\\mathrm{cm}^{-3}$)，电子数密度为 $n_e$ (单位为 $\\mathrm{cm}^{-3}$)，质子数密度为 $n_p$ (单位为 $\\mathrm{cm}^{-3}$)，金属丰度为 $Z$ (表示为太阳金属丰度的一部分)。假设电离平衡中只考虑纯氢，并采用一个简单的子网格冷却参数化方案，该方案包括一个原生项和一个金属线项。\n\n基本的能量平衡要求单位体积的冷却率等于单位体积的加热率。从第一性原理出发，令单位体积的辐射冷却率等于单位体积的光致加热率。假设氢是电离平衡中唯一的电离物质，电子由氢电离提供，并且气体是光学薄的，因此每次电离都会沉积平均的过剩能量。本问题的目标是计算满足能量平衡的平衡温度 $T_\\mathrm{eq}$ (单位为 $\\mathrm{K}$)，并讨论在 PIE 条件下其对 $n$ 的依赖性。\n\n从以下基础出发：\n- 单位体积的辐射冷却率为 $n_e n_\\mathrm{H} \\Lambda(T,Z)$，其中 $n_\\mathrm{H}$ 是总氢数密度，$\\Lambda(T,Z)$ (单位为 $\\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$) 是冷却函数。\n- 单位体积的光致加热率为 $n_\\mathrm{HI} \\Gamma \\langle E \\rangle$，其中 $\\Gamma$ (单位为 $\\mathrm{s}^{-1}$) 是氢光致电离率，$\\langle E \\rangle$ (单位为 $\\mathrm{erg}$) 是每次光致电离沉积的平均过剩能量。\n- 光致电离平衡 (PIE) 给出 $\\Gamma n_\\mathrm{HI} = \\alpha_\\mathrm{A}(T)\\, n_e n_p$，其中 $\\alpha_\\mathrm{A}(T)$ 是情况A (Case A) 复合系数 (单位为 $\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$)。\n\n利用这些基础，推导出一个关于 $T_\\mathrm{eq}$ 的自洽标量方程，并进行数值实现。为解决此问题，采用以下科学上合理且广泛使用的参数化方案：\n- 氢的情况A (Case A) 复合系数：\n$$\n\\alpha_\\mathrm{A}(T) = 4.2\\times10^{-13}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{-0.7}\\ \\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}.\n$$\n- 一个由原生氢项和金属线项组成的子网格冷却函数：\n$$\n\\Lambda(T,Z) = \\Lambda_{0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{a} + Z\\, \\Lambda_{Z,0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{b},\n$$\n其中常数为 $\\Lambda_{0} = 1.2\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，$a = 0.3$，$\\Lambda_{Z,0} = 3.0\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，以及 $b = -0.2$。此处 $Z$ 是相对于太阳丰度的无量纲金属丰度 (例如，$Z=0.1$ 表示太阳丰度的十分之一)。\n\n对于低密度、高度电离的 IGM，假设 $n_e \\approx n_p \\approx n_\\mathrm{H}$。推导平衡条件并数值求解 $T_\\mathrm{eq}$。\n\n您的程序必须：\n- 使用 $1\\,\\mathrm{eV} = 1.602176634\\times10^{-12}\\,\\mathrm{erg}$ 将光致加热过剩能量 $\\langle E \\rangle$ 从电子伏特转换为尔格。\n- 通过在区间 $[3000\\,\\mathrm{K},\\,30000\\,\\mathrm{K}]$ 上求解一个由能量平衡和 PIE 推导出的关于 $T$ 的标量函数的根，来求解 $T_\\mathrm{eq}$ (单位为 $\\mathrm{K}$)。如果某个测试用例需要更宽的范围来找到根，您可以将上界扩展到 $100000\\,\\mathrm{K}$。\n- 将每个计算出的平衡温度以 $\\mathrm{K}$ 为单位表示为浮点数。\n\n在您的解答中讨论在 PIE 条件下，推导过程所蕴含的 $T_\\mathrm{eq}$ 对 $n$ 的依赖性。\n\n测试套件：\n对 $(n, Z, \\Gamma, \\langle E \\rangle)$ 使用以下参数集，其中 $n$ 的单位是 $\\mathrm{cm}^{-3}$，$Z$ 是无量纲的 (相对于太阳丰度)，$\\Gamma$ 的单位是 $\\mathrm{s}^{-1}$，$\\langle E \\rangle$ 的单位是 $\\mathrm{eV}$。\n1. $(10^{-5},\\ 0.0,\\ 10^{-12},\\ 2.0)$\n2. $(10^{-4},\\ 0.0,\\ 10^{-12},\\ 2.0)$\n3. $(10^{-5},\\ 0.1,\\ 10^{-12},\\ 2.0)$\n4. $(10^{-5},\\ 0.0,\\ 10^{-12},\\ 4.0)$\n5. $(10^{-7},\\ 0.0,\\ 10^{-13},\\ 2.0)$\n\n您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来 (例如 $[T_1,T_2,T_3,T_4,T_5]$)，其中每个 $T_i$ 是第 $i$ 个测试用例的平衡温度，单位为 $\\mathrm{K}$。", "solution": "该问题要求推导并数值求解在光致电离平衡 (PIE) 条件下一团星系际介质 (IGM) 的平衡温度 $T_\\mathrm{eq}$。解必须按照问题陈述中概述的第一性原理进行推导。\n\n控制气体热状态的基本原理是能量平衡。在平衡状态下，总体积加热率 $\\mathcal{H}$ (单位为 $\\mathrm{erg}\\,\\mathrm{s}^{-1}\\,\\mathrm{cm}^{-3}$) 必须等于总体积冷却率 $\\mathcal{C}$ (单位相同)。\n$$\n\\mathcal{H} = \\mathcal{C}\n$$\n问题给出了这些率的表达式。单位体积的光致加热率由下式给出：\n$$\n\\mathcal{H} = n_\\mathrm{HI} \\Gamma \\langle E \\rangle\n$$\n其中 $n_\\mathrm{HI}$ 是中性氢的数密度，$\\Gamma$ 是光致电离率，而 $\\langle E \\rangle$ 是每次光致电离沉积到气体中的平均过剩能量。\n\n单位体积的辐射冷却率由下式给出：\n$$\n\\mathcal{C} = n_e n_\\mathrm{H} \\Lambda(T,Z)\n$$\n其中 $n_e$ 是电子数密度，$n_\\mathrm{H}$ 是总氢数密度 (我们将其表示为 $n$)，$\\Lambda(T,Z)$ 是依赖于温度和金属丰度的冷却函数。\n\n令加热率和冷却率相等，得到热平衡方程：\n$$\nn_\\mathrm{HI} \\Gamma \\langle E \\rangle = n_e n \\Lambda(T_\\mathrm{eq}, Z)\n$$\n这个方程包含多个密度项 ($n_\\mathrm{HI}$, $n_e$, $n$)。为简化它，我们必须援引所提供的第二个条件：光致电离平衡 (PIE)。PIE 规定光致电离的速率等于复合的速率。对于纯氢气体，这表示为：\n$$\n\\Gamma n_\\mathrm{HI} = \\alpha_\\mathrm{A}(T) n_e n_p\n$$\n其中 $\\alpha_\\mathrm{A}(T)$ 是情况A (Case A) 复合系数，$n_p$ 是质子数密度。\n\n现在，我们可以将 PIE 方程中 $\\Gamma n_\\mathrm{HI}$ 的表达式代入热平衡方程。这是将电离状态与热状态联系起来的关键一步。\n$$\n\\left( \\alpha_\\mathrm{A}(T_\\mathrm{eq}) n_e n_p \\right) \\langle E \\rangle = n_e n \\Lambda(T_\\mathrm{eq}, Z)\n$$\n问题陈述，对于低密度、高度电离的 IGM，我们可以近似认为气体几乎完全电离。这意味着电子和质子的密度约等于总氢密度：\n$$\nn_e \\approx n_p \\approx n_\\mathrm{H} = n\n$$\n将这些近似代入方程得到：\n$$\n\\alpha_\\mathrm{A}(T_\\mathrm{eq}) (n) (n) \\langle E \\rangle = (n) (n) \\Lambda(T_\\mathrm{eq}, Z)\n$$\n简化后得到：\n$$\nn^2 \\alpha_\\mathrm{A}(T_\\mathrm{eq}) \\langle E \\rangle = n^2 \\Lambda(T_\\mathrm{eq}, Z)\n$$\n从这个推导中出现了一个关键结果。因子 $n^2$ 出现在方程的两边，并且可以被消去，前提是 $n \\neq 0$。\n$$\n\\alpha_\\mathrm{A}(T_\\mathrm{eq}) \\langle E \\rangle = \\Lambda(T_\\mathrm{eq}, Z)\n$$\n这个最终方程定义了平衡温度 $T_\\mathrm{eq}$。它是一个关于单变量 $T_\\mathrm{eq}$ 的标量方程。\n\n这一结果带来了一个重要的物理洞见：**在光学薄介质中，特定的 PIE 条件下，平衡温度 $T_\\mathrm{eq}$ 与气体密度 $n$ 无关**。这是因为主导的加热机制 (光致加热) 和主导的冷却机制 (包括碰撞激发和复合冷却，两者都是双体过程) 都与密度的平方 ($n^2$) 成正比，因为它们的速率取决于相互作用粒子的密度乘积 (例如 $n_e n_p$)。当平衡这两个速率时，对密度的依赖性就抵消了。因此，平衡温度完全由每次复合事件的能量输入 (与来自电离辐射场的能量 $\\langle E \\rangle$ 相关) 和单位“冷却系数”所辐射的能量之间的平衡决定，后者也依赖于复合和碰撞，并被封装在 $\\Lambda(T,Z)/\\alpha_A(T)$ 中。\n\n为了数值求解 $T_\\mathrm{eq}$，我们定义一个函数 $f(T)$，其根即为平衡温度。\n$$\nf(T) = \\Lambda(T, Z) - \\alpha_\\mathrm{A}(T) \\langle E \\rangle = 0\n$$\n我们必须代入给定的 $\\Lambda(T, Z)$ 和 $\\alpha_\\mathrm{A}(T)$ 的参数化形式：\n$$\n\\Lambda(T,Z) = \\Lambda_{0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{a} + Z\\, \\Lambda_{Z,0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{b}\n$$\n$$\n\\alpha_\\mathrm{A}(T) = 4.2\\times10^{-13}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{-0.7}\\ \\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}\n$$\n给定的常数为 $\\Lambda_{0} = 1.2\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，$a = 0.3$，$\\Lambda_{Z,0} = 3.0\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，以及 $b = -0.2$。我们记 $T_0 = 10^4\\,\\mathrm{K}$ 和 $\\alpha_{A,0} = 4.2\\times10^{-13}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$。用于求根算法的方程变为：\n$$\nf(T) = \\left[ \\Lambda_{0} \\left(\\frac{T}{T_0}\\right)^{a} + Z \\Lambda_{Z,0} \\left(\\frac{T}{T_0}\\right)^{b} \\right] - \\left[ \\alpha_{A,0} \\left(\\frac{T}{T_0}\\right)^{-0.7} \\right] \\langle E \\rangle_{\\mathrm{erg}} = 0\n$$\n能量 $\\langle E \\rangle$ 以电子伏特 ($\\mathrm{eV}$) 给出，必须使用提供的转换因子 $1\\,\\mathrm{eV} = 1.602176634\\times10^{-12}\\,\\mathrm{erg}$ 将其转换为尔格。\n\n对于每个测试用例，将 $Z$ 和 $\\langle E \\rangle$ 的值代入此方程，然后在指定的温度区间 $[3000\\,\\mathrm{K}, 30000\\,\\mathrm{K}]$ 内数值求解 $T = T_\\mathrm{eq}$。测试套件中的参数 $n$ 和 $\\Gamma$ 虽然对于定义物理场景至关重要，但并未进入 $T_\\mathrm{eq}$ 的最终代数方程，这再次证实了在这些假设下平衡温度与密度和电离率无关的结论。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for the equilibrium temperature of an IGM parcel for multiple test cases.\n    \"\"\"\n    \n    # Define physical and numerical constants from the problem statement.\n    Lambda_0 = 1.2e-24  # erg cm^3 s^-1\n    a = 0.3             # dimensionless power-law index\n    Lambda_Z0 = 3.0e-24 # erg cm^3 s^-1\n    b = -0.2            # dimensionless power-law index\n    alpha_A0 = 4.2e-13  # cm^3 s^-1\n    alpha_power = -0.7  # dimensionless power-law index for recombination\n    T0 = 1.0e4          # K, reference temperature\n    eV_to_erg = 1.602176634e-12 # erg/eV\n\n    # Define the search interval for the root finder.\n    T_min = 3000.0  # K\n    T_max = 30000.0 # K\n    \n    # Test cases parameters: (n_H [cm^-3], Z [solar], Gamma [s^-1], E_mean [eV])\n    # Note: n_H and Gamma are not used in the final equation for T_eq,\n    # as they cancel out under the assumption of photoionization equilibrium.\n    test_cases = [\n        (1e-5, 0.0, 1e-12, 2.0),\n        (1e-4, 0.0, 1e-12, 2.0),\n        (1e-5, 0.1, 1e-12, 2.0),\n        (1e-5, 0.0, 1e-12, 4.0),\n        (1e-7, 0.0, 1e-13, 2.0),\n    ]\n\n    def equilibrium_function(T, Z, E_erg):\n        \"\"\"\n        The scalar function f(T) = Lambda(T, Z) - alpha_A(T) * E_erg,\n        whose root is the equilibrium temperature.\n        \"\"\"\n        T_norm = T / T0\n        \n        lambda_val = Lambda_0 * (T_norm**a) + Z * Lambda_Z0 * (T_norm**b)\n        alpha_val = alpha_A0 * (T_norm**alpha_power)\n        \n        return lambda_val - alpha_val * E_erg\n\n    results = []\n    for _, Z, _, E_eV in test_cases:\n        E_erg = E_eV * eV_to_erg\n        \n        # Use a robust root-finding algorithm within the specified bounds.\n        # If the standard range doesn't work, extend it as per the problem description.\n        try:\n            temp_eq = optimize.brentq(equilibrium_function, T_min, T_max, args=(Z, E_erg))\n        except ValueError:\n            # Extend the upper bound if the root is not in the initial bracket\n            T_max_extended = 100000.0\n            temp_eq = optimize.brentq(equilibrium_function, T_min, T_max_extended, args=(Z, E_erg))\n        \n        results.append(temp_eq)\n\n    # Format the output as a comma-separated list in brackets\n    # Note: problem asks for a list of floats, so minimal formatting is best.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3491059"}, {"introduction": "由于辐射冷却率是温度、密度和化学成分的复杂函数，在模拟中直接计算其成本高昂。因此，常见的做法是预先计算一个冷却表，并在运行时进行插值。本练习旨在探讨如何在预计算的冷却表上高效且准确地进行插值，通过比较线性和对数空间中的双线性插值方案，您将量化不同数值方法的误差，并理解为何对数值跨越多个数量级的函数（如冷却函数）采用对数空间插值通常是更优的选择 [@problem_id:3491056]。", "problem": "考虑一个与数值宇宙学中辐射冷却和加热的次网格模型相关的二维制表冷却函数。令 $T$ 表示以开尔文为单位的温度，$Z$ 表示无量纲金属丰度（相对于太阳金属丰度）。定义以10为底的对数坐标 $u = \\log_{10} T$ 和 $v = \\log_{10} Z$。给定一个辐射冷却系数 $\\Lambda(T,Z)$ 的光滑解析测试函数，该函数被构造成严格为正，并在整个定义域上表现出结构性变化：\n$$\n\\Lambda(T,Z) = 10^{-27}\\,T^{1/2} \\;+\\; 2\\times 10^{-23}\\, Z \\,\\exp\\!\\left(-\\frac{(\\log_{10} T - 5.5)^2}{0.4^2}\\right) \\;+\\; 10^{-24}\\, Z^{1/2}\\,\\exp\\!\\left(-\\frac{(\\log_{10} T - 6.7)^2}{0.6^2}\\right).\n$$\n计算域指定为 $T \\in [10^4, 10^8]$（单位：开尔文）和 $Z \\in [10^{-3}, 2]$（无量纲）。因此，$u \\in [4, 8]$ 且 $v \\in [\\log_{10}(10^{-3}), \\log_{10}(2)] = [-3, \\log_{10} 2]$。\n\n您必须比较在 $(u,v)$ 平面上的直角网格上定义的两种插值方案：\n\n- 方案 A（对 $\\Lambda$ 在 $(u,v)$ 上进行双线性插值）：给定网格节点 $(u_i, v_j)$，计算 $\\Lambda_{ij} = \\Lambda(10^{u_i}, 10^{v_j})$，并直接对 $\\Lambda$ 在 $(u,v)$ 上使用标准双线性插值，以近似计算查询点 $(u^*, v^*)$ 处的 $\\Lambda$ 值。\n- 方案 B（对 $\\log_{10}\\Lambda$ 在 $(u,v)$ 上进行对数线性插值）：使用相同的网格节点 $(u_i, v_j)$，计算 $L_{ij} = \\log_{10}\\Lambda(10^{u_i}, 10^{v_j})$，并对 $L$ 在 $(u,v)$ 上使用标准双线性插值，以近似计算 $L(u^*, v^*)$。在 $(u^*, v^*)$ 处 $\\Lambda$ 的近似值则为 $\\hat{\\Lambda}(u^*, v^*) = 10^{\\,\\widehat{L}(u^*, v^*)}$。\n\n对于每种方案，查询点 $(u^*, v^*)$ 处的相对误差定义为\n$$\n\\varepsilon(u^*, v^*) \\;=\\; \\frac{\\left|\\hat{\\Lambda}(u^*, v^*) \\;-\\; \\Lambda\\big(10^{u^*}, 10^{v^*}\\big)\\right|}{\\Lambda\\big(10^{u^*}, 10^{v^*}\\big)}.\n$$\n目标是计算在指定的密集查询网格 $\\mathcal{Q}$ 上的最大相对误差，该网格在 $(u,v)$ 上均匀覆盖 $[4,8]\\times[-3,\\log_{10}2]$，其中 $u$ 方向有 $256$ 个等间距点，$v$ 方向有 $256$ 个等间距点。\n\n您必须使用的基本原理：\n- 以10为底的对数 $u = \\log_{10} T$ 和 $v = \\log_{10} Z$ 的定义。\n- 矩形网格上双线性插值的定义。\n- 作为无量纲比率的相对误差的定义。\n- 上面提供的函数 $\\Lambda(T,Z)$ 及其定义域约束。\n\n您的任务是实现一个程序，对于每个指定的网格分辨率，该程序在 $(u,v)$ 中构建一个均匀网格，用 $\\Lambda$ 的精确值填充该网格，在密集查询网格上执行方案 A 和方案 B 的插值，并报告每种方案的最大相对误差。\n\n测试套件：\n- 案例 1：$(N_T, N_Z) = (16, 16)$，其中 $N_T$ 和 $N_Z$ 分别表示沿 $u$ 和 $v$ 的网格节点数。\n- 案例 2：$(N_T, N_Z) = (8, 8)$。\n- 案例 3：$(N_T, N_Z) = (64, 8)$。\n- 案例 4：$(N_T, N_Z) = (32, 64)$。\n\n对于每个案例，网格节点 $(u_i)$ 在 $[4,8]$ 上均匀分布，有 $N_T$ 个点；$(v_j)$ 在 $[-3, \\log_{10} 2]$ 上均匀分布，有 $N_Z$ 个点。查询网格 $\\mathcal{Q}$ 固定为 $256 \\times 256$ 个点，均匀跨越相同的 $(u,v)$ 定义域。\n\n输出规范：\n- 最终输出必须是每个案例和每种方案的无量纲最大相对误差，以列表的列表形式聚合到单行中：对于每个案例，输出一个数对 $[\\varepsilon_{\\max}^{\\text{A}}, \\varepsilon_{\\max}^{\\text{B}}]$，其中 $\\varepsilon_{\\max}^{\\text{A}}$ 和 $\\varepsilon_{\\max}^{\\text{B}}$ 分别是通过在 $\\mathcal{Q}$ 上计算得到的方案 A 和方案 B 的最大相对误差。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，例如：$[[e_{11},e_{12}],[e_{21},e_{22}],\\dots]$，其中每个 $e_{ij}$ 是一个浮点数。\n\n所有报告的量都是无量纲的；输出中不得出现任何物理单位。不涉及角度。不得使用百分比；以小数形式报告比率。您的程序必须是完全自包含的，不接受任何输入，并且只打印所需的单行内容。", "solution": "目标是针对一个给定的二维宇宙学冷却函数 $\\Lambda(T,Z)$（其中 $T$ 为温度，$Z$ 为金属丰度），比较一个双线性插值方案和一个对数线性插值方案。该比较基于每种方案在密集查询网格上的最大相对误差。插值在对数坐标系 $(u, v)$ 中执行，其中 $u = \\log_{10} T$，$v = \\log_{10} Z$。\n\n冷却函数由下式给出：\n$$\n\\Lambda(T,Z) = 10^{-27}\\,T^{1/2} \\;+\\; 2\\times 10^{-23}\\, Z \\,\\exp\\!\\left(-\\frac{(\\log_{10} T - 5.5)^2}{0.4^2}\\right) \\;+\\; 10^{-24}\\, Z^{1/2}\\,\\exp\\!\\left(-\\frac{(\\log_{10} T - 6.7)^2}{0.6^2}\\right)\n$$\n为了计算方便，我们通过代入 $T = 10^u$ 和 $Z = 10^v$ 将该函数用对数坐标 $u$ 和 $v$ 表示：\n$$\n\\Lambda(10^u, 10^v) = 10^{-27} \\cdot 10^{0.5u} + 2 \\times 10^{-23} \\cdot 10^v \\cdot \\exp\\left(-\\frac{(u - 5.5)^2}{0.16}\\right) + 10^{-24} \\cdot 10^{0.5v} \\cdot \\exp\\left(-\\frac{(u - 6.7)^2}{0.36}\\right)\n$$\n该函数在定义域 $u \\in [4, 8]$ 和 $v \\in [-3, \\log_{10} 2]$ 上进行求值。\n\n每个由网格分辨率 $(N_T, N_Z)$ 指定的测试案例的数值步骤如下：\n\n首先，我们定义计算网格：\n1.  一个制表网格，函数在该网格上被采样以构建插值器。网格点是在 $[4, 8]$ 上大小为 $N_T$ 的等间距数组 $u_i$ 和在 $[-3, \\log_{10} 2]$ 上大小为 $N_Z$ 的等间距数组 $v_j$。\n2.  一个密集查询网格 $\\mathcal{Q}$，分辨率固定为 $256 \\times 256$ 个点，均匀覆盖相同的 $(u,v)$ 定义域。该网格用于评估插值的准确性。\n\n接下来，我们在 $256 \\times 256$ 查询网格的每个点上计算冷却函数的精确值 $\\Lambda_{\\text{true}} = \\Lambda(10^u, 10^v)$。这些值将作为计算相对误差的真实值。\n\n对于每种插值方案，我们接着执行以下步骤：\n\n**方案 A：对 $\\Lambda$ 进行双线性插值**\n1.  在 $(N_T, N_Z)$ 制表网格的每个节点 $(u_i,v_j)$ 处计算冷却函数 $\\Lambda(u, v)$ 的值，创建一个数据表 $\\Lambda_{ij}$。\n2.  从网格点 $(u_i, v_j)$ 和相应的值 $\\Lambda_{ij}$ 构建一个二元线性插值器 $\\hat{\\Lambda}_A(u, v)$。这是一种标准的双线性插值。\n3.  在密集查询网格的每个点上对插值器 $\\hat{\\Lambda}_A(u, v)$ 进行求值，以获得插值 $\\hat{\\Lambda}_A^{\\text{query}}$。\n4.  使用公式 $\\varepsilon = |\\hat{\\Lambda} - \\Lambda_{\\text{true}}| / \\Lambda_{\\text{true}}$ 计算查询网格上每个点的相对误差 $\\varepsilon_A$。\n5.  记录整个查询网格上该误差的最大值 $\\varepsilon_{\\max}^{\\text{A}}$。\n\n**方案 B：对数线性插值（对 $\\log_{10}\\Lambda$ 进行双线性插值）**\n1.  在制表网格的每个节点 $(u_i,v_j)$ 处计算冷却函数的以10为底的对数值 $L(u, v) = \\log_{10}(\\Lambda(u, v))$，创建一个数据表 $L_{ij}$。函数 $\\Lambda$ 在其定义域上严格为正，因此其对数总是有良好定义的。\n2.  从网格点 $(u_i, v_j)$ 和相应的对数值 $L_{ij}$ 构建一个二元线性插值器 $\\hat{L}(u, v)$。\n3.  在密集查询网格的每个点上对插值器 $\\hat{L}(u, v)$ 进行求值，以获得插值后的对数值 $\\hat{L}^{\\text{query}}$。\n4.  通过反对数变换恢复插值后的冷却函数值：$\\hat{\\Lambda}_B^{\\text{query}} = 10^{\\hat{L}^{\\text{query}}}$。\n5.  类似地计算相对误差 $\\varepsilon_B$：$\\varepsilon_B = |\\hat{\\Lambda}_B^{\\text{query}} - \\Lambda_{\\text{true}}| / \\Lambda_{\\text{true}}$。\n6.  记录该误差在查询网格上的最大值 $\\varepsilon_{\\max}^{\\text{B}}$。\n\n对四个指定的 $(N_T, N_Z)$ 测试案例中的每一个重复此过程。最终结果是每个案例的数对 $[\\varepsilon_{\\max}^{\\text{A}}, \\varepsilon_{\\max}^{\\text{B}}]$ 的聚合。该实现利用 `numpy` 进行基于数组的计算，并使用 `scipy.interpolate.RegularGridInterpolator` 来高效地执行双线性插值。", "answer": "```python\nimport numpy as np\nfrom scipy.interpolate import RegularGridInterpolator\n\ndef solve():\n    \"\"\"\n    Computes and compares the maximum relative errors for two interpolation schemes\n    on a cosmological cooling function.\n    \"\"\"\n\n    # Test suite: grid resolutions (N_T, N_Z)\n    test_cases = [\n        (16, 16),\n        (8, 8),\n        (64, 8),\n        (32, 64)\n    ]\n\n    # Define the computational domain in logarithmic coordinates (u, v)\n    u_min, u_max = 4.0, 8.0\n    v_min, v_max = -3.0, np.log10(2.0)\n\n    # Define the dense query mesh resolution\n    N_query = 256\n\n    def lambda_uv(u, v):\n        \"\"\"\n        Computes the cooling function Lambda in terms of log-coordinates u and v.\n        u = log10(T), v = log10(Z)\n        T = 10**u, Z = 10**v\n        \"\"\"\n        # Ensure input are numpy arrays for vectorization\n        u = np.asarray(u)\n        v = np.asarray(v)\n\n        # Term 1: Proportional to T^(1/2)\n        term1 = 1e-27 * 10**(0.5 * u)\n        \n        # Term 2: Gaussian peak in T at log10(T)=5.5, linear in Z\n        term2 = 2e-23 * 10**v * np.exp(-(u - 5.5)**2 / (0.4**2))\n        \n        # Term 3: Gaussian peak in T at log10(T)=6.7, proportional to Z^(1/2)\n        term3 = 1e-24 * 10**(0.5 * v) * np.exp(-(u - 6.7)**2 / (0.6**2))\n        \n        return term1 + term2 + term3\n\n    # Create the dense query mesh\n    u_query_pts = np.linspace(u_min, u_max, N_query)\n    v_query_pts = np.linspace(v_min, v_max, N_query)\n    U_query, V_query = np.meshgrid(u_query_pts, v_query_pts, indexing='ij')\n\n    # Calculate exact values of Lambda on the query mesh (ground truth)\n    lambda_true = lambda_uv(U_query, V_query)\n\n    # Prepare query points for the interpolator\n    query_points = np.stack((U_query.ravel(), V_query.ravel()), axis=-1)\n\n    all_results = []\n\n    for N_T, N_Z in test_cases:\n        # 1. Define the tabulation grid\n        u_grid = np.linspace(u_min, u_max, N_T)\n        v_grid = np.linspace(v_min, v_max, N_Z)\n\n        # 2. Scheme A: Bilinear interpolation on Lambda\n        U_grid, V_grid = np.meshgrid(u_grid, v_grid, indexing='ij')\n        lambda_table = lambda_uv(U_grid, V_grid)\n        \n        # Create and apply the interpolator for Scheme A\n        interpolator_A = RegularGridInterpolator((u_grid, v_grid), lambda_table, method='linear', bounds_error=False, fill_value=None)\n        lambda_hat_A = interpolator_A(query_points).reshape(N_query, N_query)\n        \n        # Calculate maximum relative error for Scheme A\n        error_A = np.abs(lambda_hat_A - lambda_true) / lambda_true\n        max_error_A = np.max(error_A)\n\n        # 3. Scheme B: Bilinear interpolation on log10(Lambda)\n        L_table = np.log10(lambda_table)\n        \n        # Create and apply the interpolator for Scheme B\n        interpolator_B = RegularGridInterpolator((u_grid, v_grid), L_table, method='linear', bounds_error=False, fill_value=None)\n        L_hat = interpolator_B(query_points).reshape(N_query, N_query)\n        \n        # Convert back from log-space\n        lambda_hat_B = 10**L_hat\n        \n        # Calculate maximum relative error for Scheme B\n        error_B = np.abs(lambda_hat_B - lambda_true) / lambda_true\n        max_error_B = np.max(error_B)\n\n        all_results.append([max_error_A, max_error_B])\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3491056"}, {"introduction": "在包含化学反应的流体动力学模拟中，热力学状态和化学状态是紧密耦合的。当气体的电离度 $x$ 发生变化时，其平均分子量 $\\mu$ 也会随之改变，这直接影响了比内能 $u$ 和温度 $T$ 之间的关系。这个“纸笔”练习将通过推导因使用过时的 $\\mu$ 值而产生的温度误差，来阐明在多物理场模拟的算子分裂（operator-split）时间积分方案中，确保热化学状态一致性更新的至关重要性 [@problem_id:3491083]。", "problem": "考虑一个宇宙学流体动力学模拟中的单个计算单元，其子网格模型在一个时长为 $\\Delta t$ 的算子分裂子步中推进辐射冷却、加热和原初氢化学过程。气体为纯氢，质量密度为 $\\rho$，绝热指数为 $\\gamma$，并遵循理想气体状态方程（EOS）。设 $m_p$ 为质子质量，$k_B$ 为玻尔兹曼常数。热状态由比内能 $u$（单位质量的能量）表示，电离状态由氢电离分数 $x$ 表示，其定义为电离氢数密度与总氢数密度之比。以 $m_p$ 为单位的平均分子量为 $\\mu(x)$。\n\n在子步开始时 $(t^n)$，状态为 $(u^n, x^n)$。子网格模型执行一个算子分裂显式更新，其中：\n- 比内能使用在步长开始时计算的净比加热/冷却率 $\\dot{u}^n$ 进行推进，因此 $u^{n+1} = u^n + \\Delta t\\, \\dot{u}^n$。\n- 电离分数使用光致电离率 $\\Gamma$（每个原子）和B类复合系数 $\\alpha_B$（假设在步长内为常数），通过前向欧拉法进行推进，其中氢数密度 $n_H = \\rho/m_p$，根据\n$$\nx^{n+1} = x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, n_H\\, \\left(x^n\\right)^2 \\right].\n$$\n\n假设理想气体状态方程将内能 $u$ 和温度 $T$ 通过以下关系联系起来\n$$\nu = \\frac{k_B}{(\\gamma - 1)\\, \\mu\\, m_p}\\, T,\n$$\n其中纯氢的 $\\mu(x)$ 由下式给出\n$$\n\\mu(x) = \\frac{1}{1 + x}.\n$$\n\n在推进 $(u, x)$ 后，考虑两种在 $t^{n+1}$ 时刻获取温度的可能方法：\n- 一种使用旧平均分子量 $\\mu^n \\equiv \\mu(x^n)$ 的朴素转换：\n$$\nT_{\\mathrm{naive}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^n\\, m_p}{k_B}\\, u^{n+1}.\n$$\n- 一种使用更新后平均分子量 $\\mu^{n+1} \\equiv \\mu(x^{n+1})$ 的自洽转换：\n$$\nT_{\\mathrm{cons}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^{n+1}\\, m_p}{k_B}\\, u^{n+1}.\n$$\n\n将由朴素方法引入的温度误差定义为 $\\Delta T \\equiv T_{\\mathrm{naive}}^{n+1} - T_{\\mathrm{cons}}^{n+1}$。从上面给出的基本定义和定律出发，且不使用任何未引入的快捷公式，推导此单个子步后 $\\Delta T$ 的精确闭式解析表达式，该表达式仅用符号 $\\rho$、$\\gamma$、$m_p$、$k_B$、$u^n$、$\\dot{u}^n$、$\\Delta t$、$x^n$、$\\Gamma$ 和 $\\alpha_B$ 表示。将您的最终结果表示为一个单一的简化代数表达式。量 $\\Delta T$ 应以开尔文为单位进行解释，但不要在最终的方框表达式中包含单位。无需进行数值计算。", "solution": "该问题已被验证为科学上合理、定义明确且客观。它基于数值宇宙学和天体物理学中使用的标准（尽管简化了的）方程。所有必要的信息均已提供，该任务是一个直接的形式推导。因此我们可以开始解题。\n\n目标是推导单个子网格步长后温度误差 $\\Delta T \\equiv T_{\\mathrm{naive}}^{n+1} - T_{\\mathrm{cons}}^{n+1}$ 的精确闭式解析表达式。最终表达式必须用给定的基本量表示：$\\rho$、$\\gamma$、$m_p$、$k_B$、$u^n$、$\\dot{u}^n$、$\\Delta t$、$x^n$、$\\Gamma$ 和 $\\alpha_B$。\n\n我们从温度误差 $\\Delta T$ 的定义开始：\n$$\n\\Delta T = T_{\\mathrm{naive}}^{n+1} - T_{\\mathrm{cons}}^{n+1}\n$$\n问题给出了在 $t^{n+1}$ 时刻朴素计算和自洽计算的温度表达式：\n$$\nT_{\\mathrm{naive}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^n\\, m_p}{k_B}\\, u^{n+1}\n$$\n$$\nT_{\\mathrm{cons}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^{n+1}\\, m_p}{k_B}\\, u^{n+1}\n$$\n其中 $\\mu^n \\equiv \\mu(x^n)$ 且 $\\mu^{n+1} \\equiv \\mu(x^{n+1})$。\n\n将这些表达式代入 $\\Delta T$ 的定义中，得到：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, \\mu^n\\, m_p}{k_B}\\, u^{n+1} - \\frac{(\\gamma - 1)\\, \\mu^{n+1}\\, m_p}{k_B}\\, u^{n+1}\n$$\n我们可以提取公因式来简化此表达式：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, m_p}{k_B}\\, u^{n+1} \\left( \\mu^n - \\mu^{n+1} \\right)\n$$\n接下来，我们使用所给的定义 $\\mu(x) = \\frac{1}{1 + x}$ 来表示平均分子量的差值 $\\mu^n - \\mu^{n+1}$：\n$$\n\\mu^n - \\mu^{n+1} = \\frac{1}{1 + x^n} - \\frac{1}{1 + x^{n+1}}\n$$\n将各项通分：\n$$\n\\mu^n - \\mu^{n+1} = \\frac{(1 + x^{n+1}) - (1 + x^n)}{(1 + x^n)(1 + x^{n+1})} = \\frac{x^{n+1} - x^n}{(1 + x^n)(1 + x^{n+1})}\n$$\n现在，我们将此结果代回我们关于 $\\Delta T$ 的表达式中：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, m_p}{k_B}\\, u^{n+1} \\left( \\frac{x^{n+1} - x^n}{(1 + x^n)(1 + x^{n+1})} \\right)\n$$\n为了使此表达式用 $t^n$ 时刻的量显式表示，我们必须代入给定的更新方案。比内能 $u$ 按如下方式推进：\n$$\nu^{n+1} = u^n + \\Delta t\\, \\dot{u}^n\n$$\n电离分数 $x$ 按如下方式推进：\n$$\nx^{n+1} = x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, n_H\\, \\left(x^n\\right)^2 \\right]\n$$\n由此，子步内电离分数的变化是：\n$$\nx^{n+1} - x^n = \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, n_H\\, \\left(x^n\\right)^2 \\right]\n$$\n问题指出，总氢数密度为 $n_H = \\rho/m_p$。将其代入 $x^{n+1}$ 和 $x^{n+1}-x^n$ 的表达式中：\n$$\nx^{n+1} - x^n = \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]\n$$\n因此，\n$$\nx^{n+1} = x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]\n$$\n我们现在拥有了写出 $\\Delta T$ 最终表达式所需的所有组成部分。我们将 $u^{n+1}$、$x^{n+1} - x^n$ 和 $x^{n+1}$ 的表达式代入我们关于 $\\Delta T$ 的方程中：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, m_p}{k_B} (u^n + \\Delta t\\, \\dot{u}^n) \\frac{\\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]}{(1 + x^n)\\left(1 + x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]\\right)}\n$$\n该表达式是一个单一的代数分式，并且完全由允许的符号 $\\rho$、$\\gamma$、$m_p$、$k_B$、$u^n$、$\\dot{u}^n$、$\\Delta t$、$x^n$、$\\Gamma$ 和 $\\alpha_B$ 表示。这是温度误差的最终、精确的闭式解析表达式。", "answer": "$$\n\\boxed{\\frac{(\\gamma - 1) m_p \\Delta t (u^n + \\Delta t \\dot{u}^n) \\left[ \\Gamma(1 - x^n) - \\alpha_B \\frac{\\rho}{m_p} (x^n)^2 \\right]}{k_B (1 + x^n) \\left( 1 + x^n + \\Delta t \\left[ \\Gamma(1 - x^n) - \\alpha_B \\frac{\\rho}{m_p} (x^n)^2 \\right] \\right)}}\n$$", "id": "3491083"}]}