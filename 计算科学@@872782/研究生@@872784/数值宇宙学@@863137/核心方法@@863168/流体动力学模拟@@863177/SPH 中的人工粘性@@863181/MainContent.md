## 引言
[光滑粒子流体动力学](@entry_id:637248)（SPH）作为一种强大的拉格朗日数值方法，在天体物理学和[宇宙学模拟](@entry_id:747928)中被广泛应用。然而，其标准的无耗散形式在处理一个关键物理现象——激波时面临着根本性的挑战。由于无法内在地产熵，纯粹的SPH模拟在遭遇强压缩流时会出现非物理的粒子穿透和数值崩溃。本文旨在深入探讨解决这一核心问题的关键技术：[人工黏性](@entry_id:756576)（artificial viscosity）。

通过本文的学习，读者将全面掌握[人工黏性](@entry_id:756576)的理论与实践。我们将在第一章“原理与机制”中，从激波的物理本质出发，详细阐述引入[人工黏性](@entry_id:756576)的必要性，并解析其[标准形式](@entry_id:153058)的构造与工作原理。接着，在第二章“应用与跨学科联系”中，我们将探索[人工黏性](@entry_id:756576)在天体物理学等前沿领域的实际应用、其带来的数值挑战（如角动量问题）以及相应的先进解决方案，并揭示其思想如何启发其他学科。最后，在第三章“动手实践”中，读者将通过一系列计算练习，将理论知识应用于实际问题，加深对黏性开关、[时间步长约束](@entry_id:174412)和等效[雷诺数](@entry_id:136372)等关键概念的理解。

## 原理与机制

在上一章引言的基础上，本章将深入探讨[光滑粒子流体动力学](@entry_id:637248)（SPH）中[人工黏性](@entry_id:756576)（artificial viscosity）的基本原理和具体实现机制。我们将从[理想流体](@entry_id:161909)中激波的物理本质出发，阐述为何[数值模拟](@entry_id:137087)需要引入[人工黏性](@entry_id:756576)，然后详细介绍其[标准形式](@entry_id:153058)的构造、在SPH[方程组](@entry_id:193238)中的整合，以及为克服其局限性而发展的先进开关机制。

### [理想流体动力学](@entry_id:750508)中的基本挑战：激波

在[宇宙学结构形成](@entry_id:160031)等许多天体物理场景中，气体的行为在很大程度上可以由无黏的欧拉方程（Euler equations）来描述。这些方程是双曲型守恒律，其一个显著特征是，即使从光滑的初始条件出发，其解也可能在有限时间内发展出[不连续性](@entry_id:144108)，即**激波（shocks）**。

在数学上，激波被理想化为一个无限薄的[间断面](@entry_id:180188)。虽然[欧拉方程](@entry_id:177914)的[微分形式](@entry_id:146747)在该[间断面](@entry_id:180188)上失效，但其积分形式仍然成立。通过对一个跨越激波[间断面](@entry_id:180188)的无限小[控制体](@entry_id:143882)应用[积分守恒律](@entry_id:202878)，我们可以推导出**朗肯-雨贡纽[跳跃条件](@entry_id:750965)（Rankine-Hugoniot jump conditions）**[@problem_id:3465332]。对于一个位于其静止参考系中、沿 $x$ 方向传播的定常平面激波，这些条件可以写作：

$ [ \rho u ] = 0 $

$ [ \rho u^2 + p ] = 0 $

$ [ \rho u (e + \frac{1}{2}u^2 + p/\rho) ] = 0 $

其中，$\rho$ 是密度，$u$ 是沿激波法向的速度，$p$ 是压力，$e$ 是比内能。方括号 $[q]$ 表示物理量 $q$ 穿过激波前后的跳跃值，即 $q_2 - q_1$（下标1代表上游未受扰动状态，下标2代表下游已受扰动状态）。这些方程分别表示质量通量、[动量通量](@entry_id:199796)（加上压力）和能量通量的守恒。

然而，仅有这些守恒律还不足以唯一确定激波的解。为了排除诸如“稀疏激波”这类非物理的解，我们必须引入热力学第二定律作为额外的物理约束。该定律要求，对于任何自发的不可逆过程，熵都不能减少。激波是一个典型的不[可逆过程](@entry_id:276625)，流体的宏观动能通过激波内部的微观物理过程（真实的物理黏性）转化为热能。因此，一个物理上允许的激波必须满足**[熵增](@entry_id:138799)条件（entropy condition）**：流体粒子穿过激波后，其比熵必须增加，即 $s_2 > s_1$ [@problem_id:3465332] [@problem_id:3465269]。

### SPH离散化及其局限性

标准的[SPH方法](@entry_id:755216)是基于离散拉格朗日量的，这使得它在描述无黏、[绝热流](@entry_id:262576)动时具有出色的守恒性质。在一个纯粹的SPH离散化方案中，总质量、[总动量](@entry_id:173071)、总角动量和总能量都能在没有额外源项的情况下精确守恒。这种[能量守恒](@entry_id:140514)的特性意味着系统是时间可逆的，每个SPH粒子的熵都保持恒定，即 $\mathrm{d}s_i/\mathrm{d}t = 0$（在[数值精度](@entry_id:173145)范围内）[@problem_id:3504476]。

这种特性与激波物理的[熵增](@entry_id:138799)条件直接矛盾。因此，一个“纯粹”的、不包含任何耗散项的SPH模拟无法正确地捕捉激波。在数值实践中，当模拟中出现强压缩流时，这种矛盾会表现为灾难性的后果：SPH粒子不会在激波面处被减速和加热，而是会非物理地相互穿透（particle interpenetration），并在激波后方产生剧烈的、非物理的[数值振荡](@entry_id:163720)（[吉布斯现象](@entry_id:138701)）[@problem_id:3465273] [@problem_id:3465269]。这不仅破坏了模拟的物理真实性，也常常导致数值不稳定性，使整个模拟崩溃。

因此，为了在SPH中稳定地模拟激波，我们必须在欧拉方程的离散化中明确地引入一个**数值耗散机制（numerical dissipation mechanism）**。这个机制的任务就是模拟真实激波层内的物理耗散过程，确保动能在压缩区被正确地转化为热能，从而满足[熵增](@entry_id:138799)条件。这个机制就是**[人工黏性](@entry_id:756576)**。

### [人工黏性](@entry_id:756576)的核心设计原则

[人工黏性](@entry_id:756576)并非旨在模拟流体的真实物理黏性，而是一个纯粹的数值工具，其设计目标是精确地在需要的地方——也即激波处——引入适量的耗散。一个有效的[人工黏性](@entry_id:756576)方案必须遵循以下核心设计原则：

1.  **仅在压缩区激活**：黏性只应该在粒子相互靠近时起作用，以避免在膨胀流或纯剪切流中引入不必要的耗散。这个条件通常通过检查粒子对的相对速度和相对位置来实现，即只对满足 $\mathbf{v}_{ij} \cdot \mathbf{r}_{ij}  0$ 的粒子对 $(\mathbf{v}_{ij} \equiv \mathbf{v}_i - \mathbf{v}_j, \mathbf{r}_{ij} \equiv \mathbf{r}_i - \mathbf{r}_j)$ 施加黏性力 [@problem_id:3504476]。

2.  **保证[动量守恒](@entry_id:149964)**：[人工黏性](@entry_id:756576)力必须是成对且对称的（满足[牛顿第三定律](@entry_id:166652)），以确保系统的[总线动量](@entry_id:173071)和总角动量守恒 [@problem_id:3465273]。

3.  **保证总[能量守恒](@entry_id:140514)和[熵增](@entry_id:138799)**：[人工黏性](@entry_id:756576)力所做的功必须完全转化为内能（加热），从而确保总[能量守恒](@entry_id:140514)。同时，这种能量转化必须是正定的，即黏性加热率 $Q_{\mathrm{av}} \ge 0$，以保证熵的非负产生（$T\mathrm{d}s/\mathrm{d}t = Q_{\mathrm{av}} \ge 0$）[@problem_id:3504476] [@problem_id:3465269]。违反这一条将导致非物理的“冷激波”，即粒子在压缩中反而冷却。

4.  **伽利略不变性**：黏性的大小应该只依赖于粒子间的相对运动，与观测者的[惯性参考系](@entry_id:276742)无关。

### [标准形式](@entry_id:153058)：Monaghan-Gingold黏性

在SPH中，最经典和广泛使用的[人工黏性](@entry_id:756576)形式由Monaghan和Gingold提出。它通过在动量方程的压力项中增加一个黏性压力项 $\Pi_{ij}$ 来实现。其标准形式为 [@problem_id:3504531] [@problem_id:3465317]：

$$
\Pi_{ij} = 
\begin{cases}
\dfrac{-\alpha c_{ij} \mu_{ij} + \beta \mu_{ij}^2}{\rho_{ij}},   \text{if } \mathbf{v}_{ij}\cdot\mathbf{r}_{ij}  0 \\
0,   \text{otherwise}
\end{cases}
$$

其中，各项定义如下：

*   $\alpha$ 和 $\beta$ 是无量纲参数，通常取 $\mathcal{O}(1)$ 的值（例如 $\alpha=1, \beta=2$），分别控制线性和[非线性](@entry_id:637147)黏性项的强度。

*   $c_{ij} = \frac{1}{2}(c_i + c_j)$ 和 $\rho_{ij} = \frac{1}{2}(\rho_i + \rho_j)$ 分别是粒子对的平均声速和平均密度。

*   $\mu_{ij}$ 是一个关键的无量纲量（在一些文献中被定义为有量纲的速度），用于衡量粒子对之间的接近速率：
    $$
    \mu_{ij} = \frac{h_{ij} \mathbf{v}_{ij} \cdot \mathbf{r}_{ij}}{r_{ij}^2 + \eta^2}
    $$
    这里，$h_{ij} = \frac{1}{2}(h_i + h_j)$ 是平均光滑长度，$r_{ij} = |\mathbf{r}_{ij}|$ 是粒子间距。$\eta^2$ 是一个小的正则化项（例如 $\eta^2 = 0.01 h_{ij}^2$），用于防止当 $r_{ij} \to 0$ 时分母为零 [@problem_id:3465317]。

该黏性项由两部分组成：

1.  **线性项**（与 $\alpha$ 相关）：该项与 $\mu_{ij}$ 成正比，提供了类似于物理体积黏性的作用，对于捕捉弱激波和抑制激波后的[振荡](@entry_id:267781)是有效的。

2.  **二次项**（与 $\beta$ 相关）：该项与 $\mu_{ij}^2$ 成正比，对于处理强激波至关重要。其物理动机在于，强激波处的动量通量（或称冲压压力）与速度的平方 $\rho v^2$ 成正比。一个仅与速度成[线性关系](@entry_id:267880)的黏性项在高马赫数下不足以提供足够的制动力来阻止粒子穿透。二次项提供了所需的 $\propto v^2$ 依赖关系，从而能在高速碰撞中有效地产生耗散 [@problem_id:3465341]。

我们可以估算二次项开始主导线性项的[临界马赫数](@entry_id:202785) $\mathcal{M}_\star$。通过令两项相等，即 $\alpha c_{ij} |\mu_{ij}| = \beta \mu_{ij}^2$，并定义径向接近速度 $v_r = - \mathbf{v}_{ij} \cdot \hat{\mathbf{r}}_{ij}$ 和[马赫数](@entry_id:274014) $\mathcal{M} = v_r/c_{ij}$，我们得到 [@problem_id:3465341]：
$$
\mathcal{M}_\star = \frac{\alpha}{\beta} \left( \frac{h_{ij}}{r_{ij}} \right)^{-1}
$$
对于典型的SPH配置，粒子间距约等于光滑长度（$h_{ij}/r_{ij} \approx 1$），并取标准参数 $\alpha=1, \beta=2$，[临界马赫数](@entry_id:202785)约为 $\mathcal{M}_\star = 0.5$。这意味着，即使在亚音速的汇聚流中，二次项也开始发挥重要作用。

### 在SPH[方程组](@entry_id:193238)中的整合

[人工黏性](@entry_id:756576)项 $\Pi_{ij}$ 被对称地引入到SPH的动量和能量方程中，以确保守恒性 [@problem_id:3504531]。

**[动量方程](@entry_id:197225)**的黏性贡献为：
$$
\left.\frac{d\mathbf{v}_i}{dt}\right|_{\mathrm{AV}} = -\sum_j m_j \Pi_{ij} \nabla_i W_{ij}
$$
由于 $\Pi_{ij}$ 被设计为正值（对于接近的粒子），且对于标准核函数 $\nabla_i W_{ij}$ 指向远离粒子 $i$ 的方向，负号确保了黏性力是排斥力，阻碍粒子相互靠近。

**内能方程**的黏性贡献（加热项）为：
$$
\left.\frac{du_i}{dt}\right|_{\mathrm{AV}} = \frac{1}{2}\sum_j m_j \Pi_{ij} \mathbf{v}_{ij} \cdot \nabla_i W_{ij}
$$
此项精确地表示了黏性力所做的功转化为内能的过程。其中 $\frac{1}{2}$ 的因子至关重要，它源于对成对相互作用的总能量变化进行对称分配，确保了整个系统的总[能量守恒](@entry_id:140514)。同时，可以证明对于接近的粒子，该项总是非负的，从而满足了熵增的物理要求。

值得再次强调的是，[人工黏性](@entry_id:756576)与**物理黏性**有本质区别。物理黏性（如纳维-斯托克斯方程中的剪切黏性和体积黏性）是流体固有的属性，只要存在[速度梯度](@entry_id:261686)，它就始终起作用。而[人工黏性](@entry_id:756576)是一个数值构造，它被设计成仅在特定的流动条件下（强压缩）才被激活，其目的是稳定数值解，而非模拟流体在所有尺度上的真实黏性行为 [@problem_id:3504531]。

### 先进机制：黏性开关

虽然标准的Monaghan-Gingold黏性在捕捉激波方面非常成功，但它也存在一些已知的缺陷。主要问题是，简单的激活条件 $\mathbf{v}_{ij} \cdot \mathbf{r}_{ij}  0$ 并不足以将压缩流与[剪切流](@entry_id:266817)完全区分开。在纯[剪切流](@entry_id:266817)（例如[开尔文-亥姆霍兹不稳定性](@entry_id:154138)）中，粒子对也可能满足这个条件，从而导致[人工黏性](@entry_id:756576)被错误地激活，对物理不稳定性产生过度的、非物理的阻尼 [@problem_id:3504476]。

为了解决这个问题，研究者们开发了多种**黏性开关（viscosity switches）**，旨在更智能地控制黏性的施加。

#### Balsara开关

一个广泛采用的解决方案是**Balsara开关** [@problem_id:3465350]。该开关通过比较流场的局部散度（压缩的度量）和旋度（剪切或旋转的度量）来调节黏性参数 $\alpha$。开关因子 $f_i$ 定义为：
$$
f_i = \frac{|\nabla\cdot\mathbf{v}|_i}{|\nabla\cdot\mathbf{v}|_i + |\nabla\times\mathbf{v}|_i + \epsilon \frac{c_i}{h_i}}
$$
其中，散度 $|\nabla\cdot\mathbf{v}|_i$ 和旋度 $|\nabla\times\mathbf{v}|_i$ 在每个粒子位置 $i$ 处通过SPH插值计算。$\epsilon c_i/h_i$ 是一个小的正则化项，用于防止在静止区域分母为零。

Balsara开关的逻辑非常直观：
*   在纯压缩流（如一维激波）中，$|\nabla\times\mathbf{v}|_i \approx 0$，因此 $f_i \to 1$，黏性被完全激活。
*   在纯剪切流中，$|\nabla\cdot\mathbf{v}|_i \approx 0$，因此 $f_i \to 0$，黏性被有效抑制。

通过将每对粒子的[人工黏性](@entry_id:756576)项乘以一个平均开关因子（如 $f_{ij} = \frac{1}{2}(f_i+f_j)$），就可以在保持激波捕捉能力的同时，显著减少在[剪切流](@entry_id:266817)中的[数值耗散](@entry_id:168584)。

#### 时间依赖黏性与亚音速[湍流](@entry_id:151300)问题

另一个挑战出现在亚音速[湍流](@entry_id:151300)的模拟中。使用一个固定的、较大的 $\alpha \sim 1$ 值，虽然对激波是必要的，但在[亚音速流](@entry_id:192984)动中会产生过度的耗散。这种黏性的有效大小与声速 $c_s$ 成正比，导致在[低马赫数](@entry_id:751528)下，系统的有效雷诺数 $\mathrm{Re}$ 过低，从而抑制了[湍流](@entry_id:151300)的物理发展 [@problem_id:3504527]。

现代[SPH方法](@entry_id:755216)倾向于采用**时间依赖黏性**方案来解决此问题。其核心思想是让黏性参数 $\alpha_i$ 成为一个随时间演化的动态变量。当一个粒子进入一个强压缩区（由 $\nabla \cdot \mathbf{v}  0$ 检测）时，它的 $\alpha_i$ 会迅速增长到一个较大值（如 $\alpha_{\max} \sim 1-2$）以处理激波。一旦粒子离开激波区，它的 $\alpha_i$ 会以一定的速率衰减到一个很小甚至为零的基准值。这种“用后即弃”的策略，确保了强黏性只在时空上需要它的地方存在，而在其他区域（如亚音速[湍流](@entry_id:151300)）则保持低耗散，从而能够模拟出更高有效雷诺数的流动。

更先进的方案还引入了**[信号速度](@entry_id:261601)（signal velocity）**的概念，例如 $v_{\text{sig}} = c_i + c_j - \beta \mathbf{v}_{ij} \cdot \hat{\mathbf{r}}_{ij}$，它为粒子间信息传播的最快速度提供了一个更有物理动机的上限 [@problem_id:3465283]。这些[信号速度](@entry_id:261601)被用来构建更复杂的黏性形式和时间步长准则，进一步提高了[SPH方法](@entry_id:755216)在处理包含激波、接触间断和[湍流](@entry_id:151300)等复杂现象时的准确性和鲁棒性。