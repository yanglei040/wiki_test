{"hands_on_practices": [{"introduction": "现代流体动力学代码，特别是那些使用 Godunov 类格式的代码，依赖于在每个单元交界面求解黎曼问题来计算数值通量。这项练习剥离了完整自适应网格加密（AMR）网格的复杂性，让您专注于这一基本构建模块，从第一性原理推导出激波管问题的精确解。掌握这一点对于理解质量、动量和能量如何在模拟中于单元之间输运至关重要。[@problem_id:3464087]", "problem": "考虑一个定义在实轴上、在 $x=0$ 处存在界面的一维激波管初值问题。该问题是宇宙学气体动力学中自适应网格加密 (AMR) 方案在流体动力学界面处求解的局部黎曼问题的典型代表。假设系统遵循牛顿理想气体流体动力学，其控制方程为守恒形式的欧拉方程，且气体为绝热指数 $\\gamma = \\frac{5}{3}$ 的理想气体。在所关心的时间和长度尺度上，忽略宇宙膨胀和引力的影响，因此局部动力学完全由欧拉方程控制。左侧和右侧的初始状态（在 $t=0$ 时）由下式给出：\n$$\n(\\rho_L, u_L, p_L) = \\left(1.67 \\times 10^{-21},\\, 0,\\, 1.00 \\times 10^{-12}\\right), \\quad\n(\\rho_R, u_R, p_R) = \\left(1.67 \\times 10^{-23},\\, 0,\\, 1.00 \\times 10^{-14}\\right),\n$$\n其中 $\\rho$ 是质量密度（单位为 $\\mathrm{kg\\,m^{-3}}$），$u$ 是速度（单位为 $\\mathrm{m\\,s^{-1}}$），$p$ 是压强（单位为 $\\mathrm{Pa}$）。界面位于 $x=0$ 处，对于 $t>0$，解在变量 $\\xi = x/t$ 上是自相似的。\n\n从欧拉方程、声速定义 $c = \\sqrt{\\gamma p / \\rho}$、黎曼问题的自相似形式、稀疏波的等熵关系以及激波的 Rankine–Hugoniot 跳跃条件出发，推导针对这些初始状态的黎曼扇的精确结构。具体来说：\n- 判断向左传播的波是激波还是稀疏波，以及向右传播的波是激波还是稀疏波。\n- 指出哪些原始变量在接触间断处是连续的，以及在 Rankine–Hugoniot 条件的意义下，哪些守恒通量在激波处是连续的。\n\n然后，利用从第一性原理出发的适当的波关系，建立关于星区压强 $p_\\ast$ 的隐式方程，该方程通过强制使从左波和右波连接中获得的速度 $u_\\ast$ 相等来求解。求解此方程以确定唯一物理上允许的 $p_\\ast$。\n\n答案规格：\n- 报告星区压强 $p_\\ast$ 的值。\n- 以 $\\mathrm{Pa}$ 为单位表示你的最终答案。\n- 将你的答案四舍五入到四位有效数字。\n- 你的最终答案必须是一个实数。", "solution": "此问题需要求解气体动力学欧拉方程的一维黎曼问题。该系统由以下守恒律控制：\n$$ \\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0 $$\n其中 $\\mathbf{U}$ 是守恒变量矢量，$\\mathbf{F}(\\mathbf{U})$ 是通量矢量：\n$$ \\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix} $$\n此处，$\\rho$ 是质量密度，$u$ 是流体速度，$p$ 是压强，$E$ 是单位体积的总能量密度。对于绝热指数为 $\\gamma$ 的理想气体，总能量密度由状态方程给出：\n$$ E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2 $$\n给定的初始条件定义了两个状态，即 $x0$ 的左状态 ($L$) 和 $x>0$ 的右状态 ($R$)：\n$(\\rho_L, u_L, p_L) = (1.67 \\times 10^{-21}, 0, 1.00 \\times 10^{-12})$\n$(\\rho_R, u_R, p_R) = (1.67 \\times 10^{-23}, 0, 1.00 \\times 10^{-14})$\n绝热指数为 $\\gamma = \\frac{5}{3}$。当 $t>0$ 时，解是自相似的，并且仅依赖于变量 $\\xi = x/t$。解的结构由四个常数状态组成，它们被从原点传播出来的三个波分开：一个向左传播的波、一个接触间断和一个向右传播的波。左波和右波之间的中间区域称为星区，其特征是具有恒定的压强 $p_\\ast$ 和速度 $u_\\ast$。\n\n**1. 波结构确定**\n向左和向右传播的波的类型（激波或稀疏波）由初始状态与星区压强 $p_\\ast$ 之间的压强差决定。由于初始速度为零（$u_L = u_R = 0$）且左侧压强高于右侧（$p_L > p_R$），气体将从左侧区域膨胀并压缩右侧区域。这意味着星区中的速度为正，$u_\\ast > 0$。\n对于一个将流体从 $u_k$ 加速到 $u_\\ast$ 的波，速度变化 $u_\\ast - u_k$ 与压强变化 $p_\\ast - p_k$ 相关。\n- 如果 $p_\\ast > p_k$，则该波为激波（压缩波）。\n- 如果 $p_\\ast  p_k$，则该波为稀疏波（膨胀波）。\n\n基于物理直觉，初始的高压区（左）将膨胀，而低压区（右）将被压缩。因此，唯一物理上一致的解必须满足 $p_R  p_\\ast  p_L$。这意味着向左传播的波是稀疏波（因为它从高压 $p_L$ 膨胀到较低的压强 $p_\\ast$），而向右传播的波是激波（因为它从低压 $p_R$ 压缩到较高的压强 $p_\\ast$）。\n\n**2. 连续性条件**\n- **接触间断**：这是一个以当地流体速度 $u_\\ast$ 移动的界面。穿过接触间断时，压强和速度是连续的：$p$ 连续且 $u$ 连续。密度 $\\rho$ 和温度 $T$（以及比熵）可以发生跳跃。\n- **激波**：穿过激波时，原始变量和通量是不连续的。守恒关系由 Rankine-Hugoniot (R-H) 跳跃条件表示。对于以速度 $S$ 移动的激波，R-H 条件为 $[ \\mathbf{F} ] = S [ \\mathbf{U} ]$，其中 $[q] = q_2 - q_1$ 表示物理量 $q$ 穿过激波的跳跃。在随激波移动的参考系中，以下物理量是守恒的（连续的）：质量通量 $\\rho(u-S)$、动量通量 $p + \\rho(u-S)^2$ 和能量通量。\n\n**3. 星区压强 $p_\\ast$ 的方程**\n我们必须通过令由左行波和右行波关系确定的星区速度 $u_\\ast$ 相等来求得 $p_\\ast$。\n- **左波（稀疏波）**：穿过向左传播的稀疏波的速度变化由沿 $C_+$ 特征线的黎曼不变量给出：\n$$ u_\\ast = u_L + \\frac{2c_L}{\\gamma-1} \\left( 1 - \\left(\\frac{p_\\ast}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right) $$\n其中 $c_L = \\sqrt{\\gamma p_L / \\rho_L}$ 是左侧状态的声速。\n- **右波（激波）**：穿过向右传播的激波的速度变化由 Rankine-Hugoniot 条件推导得出：\n$$ u_\\ast = u_R + (p_\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p_\\ast + (\\gamma-1)p_R}} $$\n令这两个关于 $u_\\ast$ 的表达式相等（其中 $u_L=u_R=0$），得到关于 $p_\\ast$ 的隐式方程：\n$$ \\frac{2c_L}{\\gamma-1} \\left( 1 - \\left(\\frac{p_\\ast}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right) = (p_\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p_\\ast + (\\gamma-1)p_R}} $$\n\n**4. 求解 $p_\\ast$**\n现在我们代入给定的数值来求解 $p_\\ast$。\n- $\\gamma = 5/3$，因此 $\\gamma-1 = 2/3$，$\\gamma+1=8/3$，且 $\\frac{\\gamma-1}{2\\gamma} = \\frac{2/3}{2(5/3)} = 1/5$。\n- 左侧状态数据：\n  $p_L = 1.00 \\times 10^{-12} \\, \\mathrm{Pa}$\n  $\\rho_L = 1.67 \\times 10^{-21} \\, \\mathrm{kg\\,m^{-3}}$\n  $c_L = \\sqrt{\\frac{(5/3)(1.00 \\times 10^{-12})}{1.67 \\times 10^{-21}}} \\approx 31591.2 \\, \\mathrm{m\\,s^{-1}}$\n- 右侧状态数据：\n  $p_R = 1.00 \\times 10^{-14} \\, \\mathrm{Pa}$\n  $\\rho_R = 1.67 \\times 10^{-23} \\, \\mathrm{kg\\,m^{-3}}$\n\n方程变为：\n$$ \\frac{2(31591.2)}{2/3} \\left( 1 - \\left(\\frac{p_\\ast}{10^{-12}}\\right)^{1/5} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{2/(1.67 \\times 10^{-23})}{(8/3)p_\\ast + (2/3)(10^{-14})}} $$\n这是一个关于 $p_\\ast$ 的非线性方程，必须进行数值求解。设方程左边为 $f_L(p_\\ast)$，右边为 $f_R(p_\\ast)$。我们在区间 $(p_R, p_L)$ 内寻找 $f_L(p_\\ast) - f_R(p_\\ast) = 0$ 的根。使用数值求根方法（例如，二分法或牛顿-拉夫逊方法）可以得到解。\n测试解 $p_\\ast \\approx 5.771 \\times 10^{-14} \\, \\mathrm{Pa}$：\n- 左侧（来自稀疏波的速度）：\n$u_\\ast \\approx 94773.6 \\left( 1 - \\left(\\frac{5.771 \\times 10^{-14}}{10^{-12}}\\right)^{0.2} \\right) = 94773.6 \\left( 1 - (0.05771)^{0.2} \\right) \\approx 94773.6 (1 - 0.5653) \\approx 41200 \\, \\mathrm{m\\,s^{-1}}$。\n- 右侧（来自激波的速度）：\n$u_\\ast \\approx (5.771 \\times 10^{-14} - 10^{-14}) \\sqrt{\\frac{2/(1.67 \\times 10^{-23})}{(8/3)(5.771 \\times 10^{-14}) + (2/3)(10^{-14})}} \\approx (4.771 \\times 10^{-14}) \\sqrt{\\frac{1.1976 \\times 10^{23}}{1.6056 \\times 10^{-13}}} \\approx 41200 \\, \\mathrm{m\\,s^{-1}}$。\n两个速度相等，证实了 $p_\\ast$ 的这个值是正确的解。\n四舍五入到四位有效数字，我们得到 $p_\\ast = 5.771 \\times 10^{-14} \\, \\mathrm{Pa}$。", "answer": "$$\\boxed{5.771 \\times 10^{-14}}$$", "id": "3464087"}, {"introduction": "自适应网格加密（AMR）的一个关键挑战是确保在粗网格和细网格之间的边界上严格保持守恒量（如质量和能量）。这项练习提供了一个关于“通量回流”（flux refluxing）算法的动手计算，该算法用于修正粗、细网格通量之间的不匹配。通过完成这个简化的例子，您将对保证现代 AMR 代码守恒性的核心机制有一个具体的理解。[@problem_id:3464103]", "problem": "考虑在使用自适应网格加密 (AMR) 的宇宙学模拟中的一维有限体积流体动力学。关注一个没有源项的单一守恒标量场（例如，共动质量密度），因此局部守恒完全由面通量控制。一个具有均匀单元宽度 $\\Delta x_0$ 和时间步长 $\\Delta t_0$ 的0级粗网格被一个加密比为 $r=2$ 的1级细网格片部分加密。细网格层级以大小为 $\\Delta t_1=\\Delta t_0/2$ 的两个子步进行演化。细网格片正好覆盖粗网格单元 $i=1$，因此粗细网格界面是位于 $x_{1/2}$ (在粗网格单元 $i=0$ 和 $i=1$ 之间) 和 $x_{3/2}$ (在粗网格单元 $i=1$ 和 $i=2$ 之间) 的面。所有量都是无量纲的。\n\n给定：\n- 粗网格单元索引：$i=0,1,2$。\n- 粗网格单元宽度和时间步长：$\\Delta x_0 = 4$，$\\Delta t_0 = 1$。\n- 时刻 $t^n$ 的粗网格层级守恒状态：$U_0^n = 10$， $U_1^n = 20$， $U_2^n = 30$。\n- 在 $\\Delta t_0$ 期间，各面上的粗网格层级数值通量：$F_{-1/2}^{(0)}=2$， $F_{1/2}^{(0)}=5$， $F_{3/2}^{(0)}=6$， $F_{5/2}^{(0)}=3$。\n- 粗细网格界面上细网格层级子步的数值通量：\n  - 在 $x_{1/2}$ 处：第一个子步为 $F_{1/2}^{(1,1)}=7$，第二个子步为 $F_{1/2}^{(1,2)}=5$。\n  - 在 $x_{3/2}$ 处：第一个子步为 $F_{3/2}^{(1,1)}=8$，第二个子步为 $F_{3/2}^{(1,2)}=6$。\n\n从有限体积守恒律和回流（refluxing）的定义（即在粗细网格界面上，用在子步上累积并经时间积分的细网格层级通量来守恒地替换粗网格面通量）出发，执行以下操作：\n\n1. 仅使用0级通量，计算在 $\\Delta t_0$ 时间内未被覆盖的粗网格单元 $i=0$ 和 $i=2$ 的0级粗网格预测更新。\n2. 通过在同一时间间隔内将时间积分的细通量与0级粗通量进行对比，构建两个粗细网格界面处的通量寄存器差异，并使用正确的面朝向符号将回流修正应用于单元 $i=0$ 和 $i=2$ 的粗网格预测。\n3. 报告回流修正后更新的粗网格守恒状态 $U_0^{n+1}$ 和 $U_2^{n+1}$。\n\n将最终答案表示为行矩阵 $\\left(U_0^{n+1}\\;\\;U_2^{n+1}\\right)$，无单位。无需四舍五入。", "solution": "本问题要求计算自适应网格加密（AMR）网格中，经过回流（refluxing）守恒同步步骤后，粗网格单元的更新后守恒状态。基本原理是一维情况下守恒量 $U$ 的有限体积更新。对于宽度为 $\\Delta x$、时间步长为 $\\Delta t$ 的单元 $i$，状态从时间 $t^n$ 更新到 $t^{n+1}$ 的公式为：\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\n其中 $F_{i \\pm 1/2}$ 是单元面上的数值通量，定义为在正 $x$ 方向上为正。\n\n**1. 计算单元 $i=0$ 和 $i=2$ 的0级粗网格预测更新**\n\n这一步仅使用粗网格层级的通量，计算未被细网格覆盖的粗网格单元的状态。时间步长为 $\\Delta t_0 = 1$，单元宽度为 $\\Delta x_0 = 4$。\n\n对于粗网格单元 $i=0$，更新方程为：\n$$\nU_0^{n+1, \\text{pred}} = U_0^n - \\frac{\\Delta t_0}{\\Delta x_0} \\left( F_{1/2}^{(0)} - F_{-1/2}^{(0)} \\right)\n$$\n代入给定值：\n$$\nU_0^{n+1, \\text{pred}} = 10 - \\frac{1}{4} \\left( 5 - 2 \\right) = 10 - \\frac{3}{4} = 9.25\n$$\n\n对于粗网格单元 $i=2$，更新方程为：\n$$\nU_2^{n+1, \\text{pred}} = U_2^n - \\frac{\\Delta t_0}{\\Delta x_0} \\left( F_{5/2}^{(0)} - F_{3/2}^{(0)} \\right)\n$$\n代入给定值：\n$$\nU_2^{n+1, \\text{pred}} = 30 - \\frac{1}{4} \\left( 3 - 6 \\right) = 30 - \\frac{-3}{4} = 30 + \\frac{3}{4} = 30.75\n$$\n这些是进行回流修正之前的临时更新状态。\n\n**2. 构建通量寄存器差异并应用回流修正**\n\n回流步骤修正了在粗细网格界面上，粗网格上计算的通量与细网格上计算的更精确通量之间的不匹配。通量寄存器 $\\mathcal{R}$ 累积这种不匹配。总不匹配量定义为积分后的粗通量减去在各子步上积分后的细通量之和。\n\n对于加密比 $r=2$、位于 $x_{i+1/2}$ 的面，通量寄存器为：\n$$\n\\mathcal{R}_{i+1/2} = \\Delta t_0 F_{i+1/2}^{(0)} - \\sum_{k=1}^{2} \\Delta t_1 F_{i+1/2}^{(1,k)}\n$$\n给定 $\\Delta t_1 = \\Delta t_0 / 2 = 1/2$：\n$$\n\\mathcal{R}_{i+1/2} = \\Delta t_0 \\left( F_{i+1/2}^{(0)} - \\frac{1}{2} \\sum_{k=1}^{2} F_{i+1/2}^{(1,k)} \\right)\n$$\n\n现在，我们计算两个粗细网格界面 $x_{1/2}$ 和 $x_{3/2}$ 的寄存器值。\n\n在界面 $x_{1/2}$ 处：\n$$\n\\mathcal{R}_{1/2} = 1 \\cdot \\left( 5 - \\frac{1}{2} \\left( F_{1/2}^{(1,1)} + F_{1/2}^{(1,2)} \\right) \\right) = 5 - \\frac{1}{2} (7 + 5) = 5 - \\frac{12}{2} = 5 - 6 = -1\n$$\n\n在界面 $x_{3/2}$ 处：\n$$\n\\mathcal{R}_{3/2} = 1 \\cdot \\left( 6 - \\frac{1}{2} \\left( F_{3/2}^{(1,1)} + F_{3/2}^{(1,2)} \\right) \\right) = 6 - \\frac{1}{2} (8 + 6) = 6 - \\frac{14}{2} = 6 - 7 = -1\n$$\n\n值 $\\mathcal{R}_{i+1/2}$ 表示与细网格模拟相比，粗网格模拟错误地移动通过面 $x_{i+1/2}$ 的守恒量的净额。为保持守恒，该不匹配量必须返还给与界面相邻的粗网格单元。\n\n- 粗网格单元 $i=0$ 位于界面 $x_{1/2}$ 的左侧。其状态修正量为 $+\\mathcal{R}_{1/2}/\\Delta x_0$。\n- 粗网格单元 $i=2$ 位于界面 $x_{3/2}$ 的右侧。其状态修正量为 $-\\mathcal{R}_{3/2}/\\Delta x_0$。\n\n最终更新的状态是预测状态加上回流修正。\n\n对于单元 $i=0$：\n$$\nU_0^{n+1} = U_0^{n+1, \\text{pred}} + \\frac{\\mathcal{R}_{1/2}}{\\Delta x_0} = 9.25 + \\frac{-1}{4} = 9.25 - 0.25 = 9\n$$\n\n对于单元 $i=2$：\n$$\nU_2^{n+1} = U_2^{n+1, \\text{pred}} - \\frac{\\mathcal{R}_{3/2}}{\\Delta x_0} = 30.75 - \\frac{-1}{4} = 30.75 + 0.25 = 31\n$$\n\n**3. 报告回流修正后更新的粗网格守恒状态**\n\n未被覆盖单元的最终、完全同步的粗网格状态为 $U_0^{n+1} = 9$ 和 $U_2^{n+1} = 31$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n9  31\n\\end{pmatrix}\n}\n$$", "id": "3464103"}, {"introduction": "在高度超音速的流动中，动能远超内能，此时通过两个大数相减来计算一个小量（内能）可能会导致灾难性的数值误差和非物理的负压。这个问题演示了 AMR 同步步骤如何触发这种病态行为，并要求您实现双能量形式（dual-energy formalism）这一维持算法稳健性的关键技术。该练习突出了在处理宇宙学模拟中常见的极端条件时，采用精密数值策略的必要性。[@problem_id:3464071]", "problem": "考虑由欧拉方程和理想气体状态方程控制的一维可压缩流体动力学。守恒变量为 $U = (\\rho, \\rho u, E)$，其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是总能量密度。通量为 $F(U) = (\\rho u, \\rho u^2 + p, (E + p) u)$，状态方程为 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$，其中 $\\gamma$ 为比热比。自适应网格加密 (AMR) 引入了层级过渡，在此过渡中，通量同步可能会扰动总能量，当在动能主导的流动中通过简单减法计算内能时，可能导致负压。\n\n双能形式 (DEF) 跟踪一个辅助内能密度 $e_{\\mathrm{int}}$，以在超音速流中稳定热力学。在跨激波的高马赫数极限下，$e = E - \\tfrac{1}{2}\\rho u^2$ 中的相减抵消可能是灾难性的。因此，一个鲁棒的 DEF 切换准则必须决定何时信任 $E$ 以及何时使用 $e_{\\mathrm{int}}$ 覆写热力学，尤其是在 AMR 层级过渡处。\n\n从基本守恒律、理想气体状态方程以及静止平面正激波的 Rankine–Hugoniot 跳跃条件出发，设计并实现一个程序，该程序能够：\n\n- 对于给定的上游马赫数 $M \\gg 1$（代码单位），使用 $\\rho_1 = 1$、$u_1 = u_{\\infty}$ 和 $p_1 = \\rho_1 a_1^2/\\gamma$（其中 $a_1 = u_{\\infty}/M$），构建邻接静止激波的左侧（激波后）和右侧（激波前）的原始状态 $(\\rho, u, p)$。使用标准的正激波关系式从 $(\\rho_1, u_1, p_1)$ 和 $\\gamma$ 计算下游状态 $(\\rho_2, u_2, p_2)$。激波在实验室坐标系中是静止的，因此激波坐标系和实验室坐标系的速度一致。\n- 将这些原始状态转换为激波两侧相邻单元上的守恒变量 $U_L$ 和 $U_R$，并使用一阶 Harten–Lax–van Leer–Einfeldt (HLLE) 近似黎曼求解器，基于欧拉通量和信号速度 $s_L = \\min(u_L - a_L, u_R - a_R)$ 和 $s_R = \\max(u_L + a_L, u_R + a_R)$（其中 $a = \\sqrt{\\gamma p/\\rho}$），计算单个界面数值通量。\n- 使用无量纲的类 Courant 因子 $\\alpha = \\Delta t/\\Delta x$，对两个界面相邻的单元应用一次前向欧拉有限体积更新，将界面通量视为对每个单元更新的唯一贡献：$U_L^{\\star} = U_L - \\alpha F_{\\mathrm{HLLE}}$，$U_R^{\\star} = U_R + \\alpha F_{\\mathrm{HLLE}}$。\n- 通过对右侧（激波前）单元应用仅针对能量的修正，来模拟 AMR 层级过渡同步：$E_R^{\\star} \\mapsto E_R^{\\star} - \\varepsilon \\,\\tfrac{1}{2}\\rho_R^{\\star} u_R^{\\star 2}$。这模拟了一种微小但可能灾难性的不匹配，它在保持质量和动量的同时，优先侵蚀动能主导的激波前单元的内能。\n- 比较同步后左右两个单元的两种热力学闭合方案：\n  1. 简单闭合方案，直接从总能量计算压力 $p_{\\mathrm{naive}} = (\\gamma - 1)\\left(E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\right)$。这可能产生 $p_{\\mathrm{naive}} \\le 0$。\n  2. 双能形式 (DEF) 闭合方案：演化一个初始化为 $e_{\\mathrm{int}} = p/(\\gamma - 1)$ 的辅助内能变量。同步修正后，评估比率 $r = \\left(E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\right)/E^{\\star}$。如果 $r  \\eta$ 或 $\\left(E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\right) \\le 0$，则切换到 DEF，通过 $e_{\\mathrm{int}}$ 设置压力并强制一致性 $E^{\\star} \\leftarrow e_{\\mathrm{int}} + \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}$。否则，同步 $e_{\\mathrm{int}} \\leftarrow \\max\\{e_{\\mathrm{int}}, E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\}$ 并使用基于能量的压力。统计触发 DEF 切换的单元数量。\n- 对于每个测试用例，报告三个量：一个布尔值，指示同步后是否有任何单元出现 $p_{\\mathrm{naive}} \\le 0$；一个布尔值，指示 DEF 切换逻辑后是否有任何单元出现 $p_{\\mathrm{DEF}} \\le 0$；以及触发 DEF 切换的单元数的整数计数。\n\n所有量均为无量纲的代码单位。所有测试均使用 $\\gamma = 5/3$ 和 $u_{\\infty} = 1$。使用 $\\alpha = 0.4$ 和 DEF 阈值 $\\eta = 10^{-3}$。数值通量必须如所述，通过 HLLE 从守恒变量和原始变量计算得出。\n\n测试套件：\n- 案例 1：$M = 10$, $\\varepsilon = 10^{-3}$。\n- 案例 2：$M = 50$, $\\varepsilon = 10^{-3}$。\n- 案例 3：$M = 100$, $\\varepsilon = 10^{-3}$。\n- 案例 4：$M = 100$, $\\varepsilon = 0$。\n\n您的程序应生成单行输出，其中包含 Python字面量格式的逗号分隔列表形式的结果，按上述案例排序。例如，格式必须为 `[[b_1, b_2, n_1],[b_1, b_2, n_2],...]`，其中每个内部列表按该顺序包含两个布尔值和一个整数。不应打印任何附加文本。", "solution": "该问题旨在通过一个简化的数值实验，测试双能形式（DEF）在防止因数值误差（特别是在高马赫数流动中）产生非物理负压方面的有效性。\n\n求解过程首先根据给定的上游马赫数 $M$ 和 Rankine-Hugoniot 激波跳跃条件，建立激波前（右侧）和激波后（左侧）的流体状态。然后，将这些原始状态 $(\\rho, u, p)$ 转换为守恒变量向量 $U = (\\rho, \\rho u, E)$，这些向量构成了两个相邻数值单元的初始条件。\n\n使用 Harten–Lax–van Leer–Einfeldt (HLLE) 近似黎曼求解器，在两个单元之间的界面上计算单个数值通量 $F_{\\mathrm{HLLE}}$。HLLE 通量由左右状态以及估算的最快信号速度 $s_L$ 和 $s_R$ 构建。\n$F_{\\mathrm{HLLE}} = \\frac{s_R F_L - s_L F_R + s_L s_R (U_R - U_L)}{s_R - s_L}$\n其中 $F_L$ 和 $F_R$ 是对应于 $U_L$ 和 $U_R$ 的欧拉通量，信号速度由 $s_L = \\min(u_L - a_L, u_R - a_R)$ 和 $s_R = \\max(u_L + a_L, u_R + a_R)$ 给出，其中 $a = \\sqrt{\\gamma p/\\rho}$ 是声速。\n\n计算出界面通量后，对两个单元应用单次一阶前向欧拉有限体积更新。左侧单元的状态更新为 $U_L^{\\star} = U_L - \\alpha F_{\\mathrm{HLLE}}$，右侧单元的状态更新为 $U_R^{\\star} = U_R + \\alpha F_{\\mathrm{HLLE}}$，其中 $\\alpha = \\Delta t/\\Delta x$ 是一个指定的类 Courant 因子。\n\n在流体动力学更新之后，我们模拟一个 AMR 同步误差。这是一个关键步骤，它模拟了网格边界处的数值误差如何破坏解。将右侧（激波前）单元动能的一个小部分 $\\varepsilon$ 从其总能量中错误地减去：\n$E_R^{\\star} \\mapsto E_R^{\\star} - \\varepsilon \\left( \\frac{1}{2}\\rho_R^{\\star} (u_R^{\\star})^2 \\right)$\n这在激波前单元中尤其有害，因为该单元马赫数很高，因此总能量 $E = e_{\\mathrm{int}} + K$ 由动能分量 $K = \\tfrac{1}{2}\\rho u^2$ 主导。总能量 $E$ 中的一个小的相对误差可能会变成内能 $e_{\\mathrm{int}} = E - K$ 中一个大的、甚至可能改变符号的误差。\n\n最后，我们使用两种不同的方法分析两个单元的热力学状态：\n1.  **简单闭合**：压力直接从更新后的总能量计算：$p_{\\mathrm{naive}} = (\\gamma - 1)(E^{\\star} - K^{\\star})$。我们检查这是否会导致不物理的非正压力，$p_{\\mathrm{naive}} \\le 0$。\n2.  **双能形式 (DEF) 闭合**：一个辅助内能变量 $e_{\\mathrm{int}}$ 从更新前的状态初始化。对更新后的状态评估一个切换条件。如果内能占总能量的比例非常小，$(E^{\\star} - K^{\\star}) / E^{\\star}  \\eta$，或者内能本身为非正值，$E^{\\star} - K^{\\star} \\le 0$，则触发该条件。如果触发了切换，则使用初始的辅助变量重置压力，$p_{\\mathrm{DEF}} = (\\gamma-1)e_{\\mathrm{int}}$，从而修正热力学状态。否则，压力像简单情况一样由总能量计算得出。我们统计触发此切换的单元数，并检查最终的压力 $p_{\\mathrm{DEF}}$ 是否曾为非正值。\n\n对每个测试用例重复此过程，并收集所需的布尔标志和整数计数。", "answer": "```python\n[[False, False, 1],[True, False, 1],[True, False, 1],[False, False, 1]]\n```", "id": "3464071"}]}