{"hands_on_practices": [{"introduction": "在从离散场估计功率谱之前，我们必须首先理解由我们的模拟盒和网格所决定的离散傅里叶空间的结构。本练习将通过一个具体的计算任务，帮助您巩固对基本频率 $k_f$、奈奎斯特频率 $k_{\\mathrm{Ny}}$ 以及如何在给定的 $k$ 壳层中对傅里叶模式进行计数的理解。这些概念是构建任何功率谱估计量的基础 [@problem_id:3481934]。", "problem": "考虑一个在边长为 $L$ 的周期性立方体盒子内的、大小为 $N^{3}$ 的离散均匀网格上采样的统计均匀标量场。在此盒子上进行离散傅里叶变换，因此允许的波矢是那些与周期性边界条件相容的波矢。对于一个将用于估计功率谱的网格，假设输入场是实值的，因此其傅里叶变换具有厄米对称性。球平均功率谱的分箱使用波矢空间中的球壳。\n\n从将连续场采样到离散格点上的第一性原理以及周期性域中离散傅里叶表示的定义出发，确定网格一维轴上的最高可分辨波数（奈奎斯特频率）$k_{\\mathrm{Ny}}$。然后，为了从实值场估计功率谱，采用标准约定，即通过使用字典序规则选择三维波矢格点的一半来仅计数独立的傅里叶模式：包括满足 $m_{z} > 0$ 的模式，或者满足 $m_{z} = 0$ 且 $m_{y} > 0$ 的模式，或者满足 $m_{z} = m_{y} = 0$ 且 $m_{x} \\geq 0$ 的模式，其中 $\\boldsymbol{m} = (m_{x}, m_{y}, m_{z})$ 是离散波矢的整数索引。\n\n使用具体参数 $N = 16$ 和 $L = 2\\pi$，此时基频为 $k_{f} = 2\\pi/L$。考虑一个波矢大小的球壳，其中心位于 $k = \\sqrt{5}\\,k_{f}$，宽度为 $\\Delta k = 0.1\\,k_{f}$，并枚举所有波矢大小落在此球壳内的整数索引三元组 $\\boldsymbol{m}$ 的集合。使用上述的独立模式计数约定，返回此球壳内独立模式的总数 $N_{\\mathrm{modes}}$。\n\n以基频 $k_{f}$ 为单位表示 $k_{\\mathrm{Ny}}$，并以无量纲整数形式提供 $N_{\\mathrm{modes}}$。最终答案必须以一个包含 $k_{\\mathrm{Ny}}/k_{f}$ 和 $N_{\\mathrm{modes}}$ 的双元素行矩阵形式呈现。", "solution": "该问题被验证为具有科学依据、良定且客观。这是数值宇宙学中一个涉及分析网格上离散傅里叶模式的标准练习。所有必要信息均已提供。\n\n问题要求计算两个量：以基频 $k_f$ 为单位的奈奎斯特频率 $k_{\\mathrm{Ny}}$，以及在波矢空间中指定球壳内的独立傅里叶模式数量 $N_{\\mathrm{modes}}$。\n\n首先，我们确定奈奎斯特频率。在边长为 $L$ 的立方体盒子中，一个大小为 $N^3$ 的离散均匀网格的网格间距为 $\\Delta x = L/N$。根据 Nyquist-Shannon 采样定理，该网格上可表示的最短波长是网格间距的两倍，即 $\\lambda_{\\mathrm{min}} = 2\\Delta x$。奈奎斯特频率是与此最小波长对应的波数：\n$$k_{\\mathrm{Ny}} = \\frac{2\\pi}{\\lambda_{\\mathrm{min}}} = \\frac{2\\pi}{2\\Delta x} = \\frac{\\pi}{\\Delta x}$$\n代入 $\\Delta x = L/N$，我们得到：\n$$k_{\\mathrm{Ny}} = \\frac{\\pi N}{L}$$\n边长为 $L$ 的周期性盒子的基频（波数）$k_f$ 由最大可能波长 $L$ 决定。因此：\n$$k_f = \\frac{2\\pi}{L}$$\n奈奎斯特频率与基频之比为：\n$$\\frac{k_{\\mathrm{Ny}}}{k_f} = \\frac{\\pi N / L}{2\\pi / L} = \\frac{N}{2}$$\n给定网格尺寸参数 $N=16$，该比值为：\n$$\\frac{k_{\\mathrm{Ny}}}{k_f} = \\frac{16}{2} = 8$$\n\n接下来，我们计算指定球壳内的独立模式数量 $N_{\\mathrm{modes}}$。周期性立方体盒子中允许的波矢 $\\boldsymbol{k}$ 由下式给出：\n$$\\boldsymbol{k} = \\frac{2\\pi}{L} \\boldsymbol{m} = k_f \\boldsymbol{m}$$\n其中 $\\boldsymbol{m} = (m_x, m_y, m_z)$ 是一个整数索引向量。对于特定参数 $L = 2\\pi$，基频为：\n$$k_f = \\frac{2\\pi}{2\\pi} = 1$$\n这将波矢简化为 $\\boldsymbol{k} = \\boldsymbol{m}$。因此，波矢的大小为 $|\\boldsymbol{k}| = \\sqrt{m_x^2 + m_y^2 + m_z^2}$。每个维度的整数索引 $m_i$ 受网格分辨率的限制。对于离散网格，波数通常被认为在 $[-k_{\\mathrm{Ny}}, k_{\\mathrm{Ny}}]$ 范围内。用整数索引表示，这对应于 $|m_i k_f| \\le k_{\\mathrm{Ny}}$，即 $|m_i| \\le k_{\\mathrm{Ny}}/k_f = N/2$。对于 $N=16$，索引必须满足 $|m_i| \\le 8$。\n\n问题指定了一个中心位于 $k = \\sqrt{5}\\,k_f$、宽度为 $\\Delta k = 0.1\\,k_f$ 的球壳。当 $k_f=1$ 时，球壳中心位于 $k=\\sqrt{5}$，宽度为 $\\Delta k = 0.1$。此球壳内的波数满足不等式：\n$$\\sqrt{5} - \\frac{0.1}{2} \\le |\\boldsymbol{k}| \\le \\sqrt{5} + \\frac{0.1}{2}$$\n$$ \\sqrt{5} - 0.05 \\le \\sqrt{m_x^2 + m_y^2 + m_z^2} \\le \\sqrt{5} + 0.05 $$\n将各项平方以便处理平方和，得到：\n$$ (\\sqrt{5} - 0.05)^2 \\le m_x^2 + m_y^2 + m_z^2 \\le (\\sqrt{5} + 0.05)^2 $$\n数值计算边界：\n$$ (2.2360679... - 0.05)^2 \\le m_x^2 + m_y^2 + m_z^2 \\le (2.2360679... + 0.05)^2 $$\n$$ (2.1860679...)^2 \\le m_x^2 + m_y^2 + m_z^2 \\le (2.2860679...)^2 $$\n$$ 4.77887... \\le m_x^2 + m_y^2 + m_z^2 \\le 5.22607... $$\n由于 $m_x$、$m_y$ 和 $m_z$ 是整数，它们的平方和也必须是整数。在区间 $[4.77887..., 5.22607...]$ 内唯一的整数是 $5$。因此，我们必须找到所有满足以下条件的整数三元组 $(m_x, m_y, m_z)$：\n$$ m_x^2 + m_y^2 + m_z^2 = 5 $$\n将 $5$ 写成三个整数平方和的唯一方法是 $5 = 2^2 + 1^2 + 0^2$。因此，分量 $(|m_x|, |m_y|, |m_z|)$ 的绝对值必须是 $(2, 1, 0)$ 的一个排列。所有索引都满足 $|m_i| \\le 2$，这完全在要求的 $|m_i| \\le 8$ 范围内。\n\n我们现在列出所有可能的整数三元组 $\\boldsymbol{m}$，并应用给定的字典序规则来计数独立模式。规则是，如果一个模式 $\\boldsymbol{m}$ 满足以下条件之一，则将其包括在内：\n1. $m_z > 0$，或\n2. $m_z = 0$ 且 $m_y > 0$，或\n3. $m_z = 0$，$m_y = 0$ 且 $m_x \\geq 0$。\n\n让我们计算满足这些条件的模式数量。\n\n条件1：$m_z > 0$。\n三元组必须满足 $m_z^2+m_y^2+m_x^2=5$。\n如果 $m_z = 1$，则 $m_x^2 + m_y^2 = 4$。解是 $(\\pm 2, 0)$ 的排列。\n模式为 $(2, 0, 1)$、$(-2, 0, 1)$、$(0, 2, 1)$、$(0, -2, 1)$。这给出了 $4$ 个模式。\n如果 $m_z = 2$，则 $m_x^2 + m_y^2 = 1$。解是 $(\\pm 1, 0)$ 的排列。\n模式为 $(1, 0, 2)$、$(-1, 0, 2)$、$(0, 1, 2)$、$(0, -1, 2)$。这给出了 $4$ 个模式。\n来自条件1的总模式数：$4 + 4 = 8$。\n\n条件2：$m_z = 0$ 且 $m_y > 0$。\n如果 $m_z = 0$，则 $m_x^2 + m_y^2 = 5$。$(|m_x|,|m_y|)$ 的整数解是 $(2, 1)$ 的排列。\n我们需要 $m_y > 0$，所以 $m_y$ 可以是 $1$ 或 $2$。\n如果 $m_y = 1$，则 $m_x^2 = 4$，所以 $m_x = \\pm 2$。这给出了模式 $(2, 1, 0)$ 和 $(-2, 1, 0)$。\n如果 $m_y = 2$，则 $m_x^2 = 1$，所以 $m_x = \\pm 1$。这给出了模式 $(1, 2, 0)$ 和 $(-1, 2, 0)$。\n来自条件2的总模式数：$2 + 2 = 4$。\n\n条件3：$m_z = 0$，$m_y = 0$ 且 $m_x \\geq 0$。\n如果 $m_z=0$ 且 $m_y=0$，则 $m_x^2=5$。该方程对于 $m_x$ 没有整数解。\n来自条件3的总模式数：$0$。\n\n独立模式的总数 $N_{\\mathrm{modes}}$ 是这三个互斥条件下的计数之和：\n$$ N_{\\mathrm{modes}} = 8 + 4 + 0 = 12 $$\n\n最终答案由 $k_{\\mathrm{Ny}}/k_f$ 和 $N_{\\mathrm{modes}}$ 组成。\n$k_{\\mathrm{Ny}}/k_f = 8$。\n$N_{\\mathrm{modes}} = 12$。\n结果将以一个双元素行矩阵的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n8  12\n\\end{pmatrix}\n}\n$$", "id": "3481934"}, {"introduction": "在掌握了离散傅里叶网格的特性后，我们将进一步探讨功率谱估计量本身的统计属性。通过分析估计量的方差如何随模拟体积变化，我们将对“宇宙方差”这一概念获得实践性的理解。宇宙方差是源于我们仅能观测到宇宙的一个实现（或一个模拟盒）而产生的内在不确定性，本练习将揭示其与巡天或模拟设计的直接关系 [@problem_id:3481984]。", "problem": "考虑一个边长为 $L$、体积为 $V=L^3$ 的周期性立方体中的一个统计上均匀和各向同性、零均值的高斯物质过密场 $\\delta(\\boldsymbol{x})$。该场在具有周期性边界条件的规则笛卡尔网格上进行采样，每个维度有 $N$ 个单元，总共有 $N^3$ 个网格点。通过体积归一化的傅里叶变换定义离散傅里叶模式 $\\delta_{\\boldsymbol{k}}$\n$$\n\\delta_{\\boldsymbol{k}} \\equiv \\frac{1}{V} \\int_{V} \\delta(\\boldsymbol{x}) \\exp\\!\\left(-i \\boldsymbol{k}\\cdot\\boldsymbol{x}\\right) \\,\\mathrm{d}^{3}x,\n$$\n其中允许的波矢为 $\\boldsymbol{k} = \\boldsymbol{n}\\,k_{\\mathrm{f}}$，$\\boldsymbol{n}\\in\\mathbb{Z}^{3}$ 为整数三元组，基本波数为 $k_{\\mathrm{f}} = 2\\pi/L$。网格的奈奎斯特波数值为 $k_{\\mathrm{Ny}}=\\pi N/L$。假设在傅里叶空间中的球壳内构建了标准的球壳平均功率谱估计量，\n$$\n\\hat{P}(k\\text{-bin}) \\equiv \\frac{V}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{k}\\in \\text{bin}} \\left| \\delta_{\\boldsymbol{k}} \\right|^{2},\n$$\n其中求和遍历球壳内的所有离散模式 $\\boldsymbol{k}$，$N_{\\mathrm{m}}$ 是该壳层中的模式数。分箱是根据无量纲波数 $q \\equiv k/k_{\\mathrm{f}}$ 定义的，因此每个箱对应 $q \\in [q_{\\min},q_{\\max}]$，其中 $q_{\\min}$ 和 $q_{\\max}$ 是固定的数值，与 $L$ 无关。假设没有网格分配窗函数效应、没有混叠，也没有散粒噪声污染。\n\n令基础系综功率谱为幂律形式，$P(k)=A\\,k^{n}$，其中振幅 $A>0$，谱指数 $n \\in \\mathbb{R}$。考虑第二种设置，其中盒子边长被重新标度为 $L \\to L'=\\alpha L$（$\\alpha>0$），而网格分辨率 $N$ 和以 $q$ 定义的分箱保持不变。数据分析流程和估计量定义保持不变。得到的新的基本波数和奈奎斯特波数分别记为 $k_{\\mathrm{f}}'$ 和 $k_{\\mathrm{Ny}}'$，在给定的 $q$ 箱中的估计量和模式数分别记为 $\\hat{P}'$ 和 $N_{\\mathrm{m}}'$。\n\n从周期性体积中的傅里叶分析和高斯随机场的第一性原理出发，并且仅使用关于此类估计量的广泛接受的事实，在 $L \\to \\alpha L$ 的重新标度下（保持 $N$ 和 $q$ 箱固定），推导以下内容：\n1. $k_{\\mathrm{f}}$ 和 $k_{\\mathrm{Ny}}$ 如何变化。\n2. $N_{\\mathrm{m}}$ 是否改变，为什么。\n3. 在一个给定的 $q$ 箱中，期望 $\\mathbb{E}[\\hat{P}]$ 如何变化，用 $\\alpha$ 和 $n$ 表示。\n4. 在一个给定的 $q$ 箱中，球壳平均估计量的方差 $\\mathrm{Var}[\\hat{P}]$ 如何变化，并由此推导出乘法因子\n$$\nR(\\alpha,n) \\equiv \\frac{\\mathrm{Var}[\\hat{P}']}{\\mathrm{Var}[\\hat{P}]}.\n$$\n\n以 $R(\\alpha,n)$ 的闭式解析表达式的形式给出最终答案。不需要数值。最终答案必须是无单位的单一解析表达式。", "solution": "所陈述的问题具有科学依据、是良定的、客观的且内部一致。它提出了一个数值宇宙学领域的标准问题（尽管是理想化的），该问题涉及功率谱估计量的统计性质。所有的定义和条件都已形式化地指定，允许进行严格的数学推导。因此，该问题被认为是有效的，并将提供解答。\n\n目标是在模拟盒子尺寸进行标度变换的情况下，推导球壳平均功率谱估计量方差的比率，$R(\\alpha,n) = \\mathrm{Var}[\\hat{P}'] / \\mathrm{Var}[\\hat{P}]$。我们将通过分析所有相关量的标度变换行为来进行推导。\n\n1.  **特征波数的标度变换**\n\n基本波数 $k_{\\mathrm{f}}$ 定义为 $k_{\\mathrm{f}} = 2\\pi/L$。网格的奈奎斯特波数为 $k_{\\mathrm{Ny}} = \\pi N/L$。模拟盒子的边长从 $L$ 重新标度为 $L' = \\alpha L$。网格尺寸 $N$ 保持不变。因此，新的基本波数和奈奎斯特波数（记为 $k_{\\mathrm{f}}'$ 和 $k_{\\mathrm{Ny}}'$）为：\n$$\nk_{\\mathrm{f}}' = \\frac{2\\pi}{L'} = \\frac{2\\pi}{\\alpha L} = \\alpha^{-1} \\left(\\frac{2\\pi}{L}\\right) = \\alpha^{-1} k_{\\mathrm{f}}\n$$\n$$\nk_{\\mathrm{Ny}}' = \\frac{\\pi N}{L'} = \\frac{\\pi N}{\\alpha L} = \\alpha^{-1} \\left(\\frac{\\pi N}{L}\\right) = \\alpha^{-1} k_{\\mathrm{Ny}}\n$$\n两个波数都与盒子标度因子 $\\alpha$ 成反比。\n\n2.  **每个箱中模式数 $N_{\\mathrm{m}}$ 的不变性**\n\n离散波矢由 $\\boldsymbol{k} = \\boldsymbol{n}\\,k_{\\mathrm{f}}$ 给出，其中 $\\boldsymbol{n}=(n_x, n_y, n_z)$ 是一个整数三元组。波矢的模为 $k = |\\boldsymbol{k}| = \\sqrt{n_x^2+n_y^2+n_z^2} \\, k_{\\mathrm{f}} = |\\boldsymbol{n}| k_{\\mathrm{f}}$。\n\n问题陈述中指出，箱是根据无量纲波数 $q \\equiv k/k_{\\mathrm{f}}$ 定义的。一个箱由条件 $q_{\\min} \\le q \\le q_{\\max}$ 定义，其中 $q_{\\min}$ 和 $q_{\\max}$ 是固定的。代入 $q$ 的定义，我们得到：\n$$\nq_{\\min} \\le \\frac{k}{k_{\\mathrm{f}}} \\le q_{\\max}\n$$\n代入 $k = |\\boldsymbol{n}|k_{\\mathrm{f}}$，条件变为：\n$$\nq_{\\min} \\le |\\boldsymbol{n}| \\le q_{\\max}\n$$\n箱中的模式数 $N_{\\mathrm{m}}$ 是满足此条件的整数三元组 $\\boldsymbol{n} \\in \\mathbb{Z}^3$ 的数量。由于分箱参数 $q_{\\min}$ 和 $q_{\\max}$ 是固定的，属于任何给定箱的整数向量集合 $\\boldsymbol{n}$ 与盒子尺寸 $L$ 无关。因此，每个箱的模式数 $N_{\\mathrm{m}}$ 在 $L \\to \\alpha L$ 的标度变换下是不变的。即，$N_{\\mathrm{m}}' = N_{\\mathrm{m}}$。\n\n3.  **估计量期望值 $\\mathbb{E}[\\hat{P}]$ 的标度变换**\n\n功率谱估计量定义为 $\\hat{P}(\\text{bin}) = \\frac{V}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{k}\\in \\text{bin}} |\\delta_{\\boldsymbol{k}}|^2$。其期望值通过对求和项取期望得到：\n$$\n\\mathbb{E}[\\hat{P}] = \\frac{V}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{k}\\in \\text{bin}} \\mathbb{E}[|\\delta_{\\boldsymbol{k}}|^2]\n$$\n对于一个统计上均匀、零均值的高斯随机场，傅里叶模式的方差与功率谱 $P(k)$ 的关系为 $\\mathbb{E}[|\\delta_{\\boldsymbol{k}}|^2] = P(k)/V$。将此代入 $\\mathbb{E}[\\hat{P}]$ 的表达式中：\n$$\n\\mathbb{E}[\\hat{P}] = \\frac{V}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{k}\\in \\text{bin}} \\frac{P(k)}{V} = \\frac{1}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{k}\\in \\text{bin}} P(k)\n$$\n基础功率谱为幂律形式，$P(k) = A k^n$。我们代入这个以及 $k = |\\boldsymbol{n}| k_{\\mathrm{f}}$：\n$$\n\\mathbb{E}[\\hat{P}] = \\frac{1}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{n}\\in \\text{bin}} A (|\\boldsymbol{n}| k_{\\mathrm{f}})^n = \\frac{A (k_{\\mathrm{f}})^n}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{n}\\in \\text{bin}} |\\boldsymbol{n}|^n\n$$\n求和项 $\\sum_{\\boldsymbol{n}\\in \\text{bin}} |\\boldsymbol{n}|^n$ 仅依赖于箱中的整数向量集合，我们已经证明了该集合是不变的。令此和为常数 $S_n$。那么，期望值与 $(k_{\\mathrm{f}})^n$ 成正比：\n$$\n\\mathbb{E}[\\hat{P}] = \\frac{A S_n}{N_{\\mathrm{m}}} (k_{\\mathrm{f}})^n\n$$\n在标度变换 $L \\to L'=\\alpha L$ 下，我们有 $k_{\\mathrm{f}}' = \\alpha^{-1} k_{\\mathrm{f}}$。量 $A$、$n$、$N_{\\mathrm{m}}$ 和 $S_n$ 都保持不变。新的期望值 $\\mathbb{E}[\\hat{P}']$ 为：\n$$\n\\mathbb{E}[\\hat{P}'] = \\frac{A S_n}{N_{\\mathrm{m}}} (k_{\\mathrm{f}}')^n = \\frac{A S_n}{N_{\\mathrm{m}}} (\\alpha^{-1} k_{\\mathrm{f}})^n = \\alpha^{-n} \\left(\\frac{A S_n}{N_{\\mathrm{m}}} (k_{\\mathrm{f}})^n \\right) = \\alpha^{-n} \\mathbb{E}[\\hat{P}]\n$$\n估计量的期望值按 $\\alpha^{-n}$ 进行标度变换。\n\n4.  **估计量方差 $\\mathrm{Var}[\\hat{P}]$ 的标度变换及比率 $R(\\alpha,n)$**\n\n估计量的方差由下式给出：\n$$\n\\mathrm{Var}[\\hat{P}] = \\mathrm{Var}\\left[\\frac{V}{N_{\\mathrm{m}}} \\sum_{\\boldsymbol{k}\\in \\text{bin}} |\\delta_{\\boldsymbol{k}}|^2\\right] = \\left(\\frac{V}{N_{\\mathrm{m}}}\\right)^2 \\mathrm{Var}\\left[\\sum_{\\boldsymbol{k}\\in \\text{bin}} |\\delta_{\\boldsymbol{k}}|^2\\right]\n$$\n对于一个实高斯场 $\\delta(\\boldsymbol{x})$，复傅里叶模式 $\\delta_{\\boldsymbol{k}}$ 是零均值高斯变量。根据 Wick 定理，它们模平方的协方差由下式给出：\n$$\n\\mathrm{Cov}(|\\delta_{\\boldsymbol{k}}|^2, |\\delta_{\\boldsymbol{q}}|^2) = \\mathbb{E}[|\\delta_{\\boldsymbol{k}}|^2 |\\delta_{\\boldsymbol{q}}|^2] - \\mathbb{E}[|\\delta_{\\boldsymbol{k}}|^2]\\mathbb{E}[|\\delta_{\\boldsymbol{q}}|^2] = |\\mathbb{E}[\\delta_{\\boldsymbol{k}}\\delta_{\\boldsymbol{q}}^*]|^2 + |\\mathbb{E}[\\delta_{\\boldsymbol{k}}\\delta_{\\boldsymbol{q}}]|^2\n$$\n使用实数场离散傅里叶模式的标准关系式 $\\mathbb{E}[\\delta_{\\boldsymbol{k}}\\delta_{\\boldsymbol{q}}^*] = (P(k)/V) \\delta_{\\boldsymbol{k},\\boldsymbol{q}}^{\\mathrm{K}}$ 和 $\\mathbb{E}[\\delta_{\\boldsymbol{k}}\\delta_{\\boldsymbol{q}}] = (P(k)/V) \\delta_{\\boldsymbol{k},-\\boldsymbol{q}}^{\\mathrm{K}}$（其中 $\\delta^{\\mathrm{K}}$ 是克罗内克 δ），我们得到：\n$$\n\\mathrm{Cov}(|\\delta_{\\boldsymbol{k}}|^2, |\\delta_{\\boldsymbol{q}}|^2) = \\left(\\frac{P(k)}{V}\\right)^2 \\delta_{\\boldsymbol{k},\\boldsymbol{q}}^{\\mathrm{K}} + \\left(\\frac{P(k)}{V}\\right)^2 \\delta_{\\boldsymbol{k},-\\boldsymbol{q}}^{\\mathrm{K}}\n$$\n（这对于模式 $\\boldsymbol{k} \\neq \\boldsymbol{0}$ 和 $\\boldsymbol{k} \\neq -\\boldsymbol{k}$ 成立）。和的方差是协方差之和：\n$$\n\\mathrm{Var}\\left[\\sum_{\\boldsymbol{k}\\in\\text{bin}} |\\delta_{\\boldsymbol{k}}|^2\\right] = \\sum_{\\boldsymbol{k},\\boldsymbol{q}\\in\\text{bin}} \\mathrm{Cov}(|\\delta_{\\boldsymbol{k}}|^2, |\\delta_{\\boldsymbol{q}}|^2) = \\sum_{\\boldsymbol{k}\\in\\text{bin}} \\sum_{\\boldsymbol{q}\\in\\text{bin}} \\left(\\frac{P(k)}{V}\\right)^2 (\\delta_{\\boldsymbol{k},\\boldsymbol{q}}^{\\mathrm{K}} + \\delta_{\\boldsymbol{k},-\\boldsymbol{q}}^{\\mathrm{K}})\n$$\n由于箱是关于原点对称的球壳，如果 $\\boldsymbol{k}$ 在箱中，那么 $-\\boldsymbol{k}$ 也在箱中。对于求和中的每个 $\\boldsymbol{k}$，$\\boldsymbol{q}=\\boldsymbol{k}$ 和 $\\boldsymbol{q}=-\\boldsymbol{k}$ 的项都有贡献。因此，方差变为：\n$$\n\\mathrm{Var}\\left[\\sum_{\\boldsymbol{k}\\in\\text{bin}} |\\delta_{\\boldsymbol{k}}|^2\\right] = \\sum_{\\boldsymbol{k}\\in\\text{bin}} 2 \\left(\\frac{P(k)}{V}\\right)^2 = \\frac{2}{V^2} \\sum_{\\boldsymbol{k}\\in\\text{bin}} P(k)^2\n$$\n将此代入 $\\mathrm{Var}[\\hat{P}]$ 的表达式中：\n$$\n\\mathrm{Var}[\\hat{P}] = \\left(\\frac{V}{N_{\\mathrm{m}}}\\right)^2 \\frac{2}{V^2} \\sum_{\\boldsymbol{k}\\in\\text{bin}} P(k)^2 = \\frac{2}{N_{\\mathrm{m}}^2} \\sum_{\\boldsymbol{k}\\in\\text{bin}} P(k)^2\n$$\n使用 $P(k) = A k^n$ 和 $k=|\\boldsymbol{n}|k_{\\mathrm{f}}$，我们找到方差对 $k_{\\mathrm{f}}$ 的依赖关系：\n$$\n\\mathrm{Var}[\\hat{P}] = \\frac{2}{N_{\\mathrm{m}}^2} \\sum_{\\boldsymbol{n}\\in\\text{bin}} (A (|\\boldsymbol{n}|k_{\\mathrm{f}})^n)^2 = \\frac{2 A^2 (k_{\\mathrm{f}})^{2n}}{N_{\\mathrm{m}}^2} \\sum_{\\boldsymbol{n}\\in\\text{bin}} |\\boldsymbol{n}|^{2n}\n$$\n对于固定的 $q$ 箱，求和项 $\\sum_{\\boldsymbol{n}\\in\\text{bin}} |\\boldsymbol{n}|^{2n}$ 同样是一个常数 $S_{2n}$。因此，方差与 $(k_{\\mathrm{f}})^{2n}$ 成正比：\n$$\n\\mathrm{Var}[\\hat{P}] = \\frac{2 A^2 S_{2n}}{N_{\\mathrm{m}}^2} (k_{\\mathrm{f}})^{2n}\n$$\n在标度变换下，$A$、$n$、$N_{\\mathrm{m}}$ 和 $S_{2n}$ 保持不变，而 $k_{\\mathrm{f}}'=\\alpha^{-1}k_{\\mathrm{f}}$。新的方差为：\n$$\n\\mathrm{Var}[\\hat{P}'] = \\frac{2 A^2 S_{2n}}{N_{\\mathrm{m}}^2} (k_{\\mathrm{f}}')^{2n} = \\frac{2 A^2 S_{2n}}{N_{\\mathrm{m}}^2} (\\alpha^{-1}k_{\\mathrm{f}})^{2n} = \\alpha^{-2n} \\left( \\frac{2 A^2 S_{2n}}{N_{\\mathrm{m}}^2} (k_{\\mathrm{f}})^{2n} \\right) = \\alpha^{-2n}\\mathrm{Var}[\\hat{P}]\n$$\n因此，所求的比率 $R(\\alpha,n)$ 为：\n$$\nR(\\alpha,n) = \\frac{\\mathrm{Var}[\\hat{P}']}{\\mathrm{Var}[\\hat{P}]} = \\frac{\\alpha^{-2n}\\mathrm{Var}[\\hat{P}]}{\\mathrm{Var}[\\hat{P}]} = \\alpha^{-2n}\n$$\n这个结果展示了功率谱估计量的统计不确定性（宇宙方差）如何随巡天体积而变化，这是大尺度结构分析中的一个基本概念。更大的体积（$\\alpha>1$）会减小方差，对于具有更大正谱指数 $n$ 的功率谱，这种效应更强。", "answer": "$$\n\\boxed{\\alpha^{-2n}}\n$$", "id": "3481984"}, {"introduction": "真实的宇宙学分析通常使用像星系或暗物质晕这样的离散示踪体，而非连续场。本练习将着手处理由此带来的一个关键后果：泊松噪声（shot noise）。我们将从第一性原理出发，推导如何正确处理这种噪声，尤其是在示踪体被赋予不同权重（例如，按质量加权）的情况下，并为功率谱和双谱实现必要的修正 [@problem_id:3481941]。", "problem": "考虑一个离散的加权物体集合，这些物体位于位置 $\\{\\mathbf{x}_i\\}_{i=1}^{N}$，具有严格非负的标量权重 $\\{w_i\\}_{i=1}^{N}$。定义加权数密度场为 $n_w(\\mathbf{x})=\\sum_{i=1}^{N} w_i \\,\\delta_{\\mathrm{D}}(\\mathbf{x}-\\mathbf{x}_i)$，其中 $\\delta_{\\mathrm{D}}$ 表示狄拉克δ函数。令 $S_1=\\sum_{i=1}^{N} w_i$ 为总权重，并考虑归一化加权场 $f(\\mathbf{x})=n_w(\\mathbf{x})/S_1$。对于波矢 $\\mathbf{k}$，定义傅里叶变换 $f(\\mathbf{k})=\\int d^3\\mathbf{x}\\, f(\\mathbf{x}) e^{-i\\mathbf{k}\\cdot\\mathbf{x}}$ 以及在非零波矢处对应的功率谱和双谱的估计量：$P(\\mathbf{k})=\\langle f(\\mathbf{k}) f(-\\mathbf{k}) \\rangle$ 和 $B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)=\\langle f(\\mathbf{k}_1) f(\\mathbf{k}_2) f(\\mathbf{k}_3) \\rangle$，并满足闭合条件 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3=\\mathbf{0}$。\n\n从 $f(\\mathbf{k})$ 的定义出发，并假设离散场的采样遵循统计均匀的泊松点过程，其中权重 $\\{w_i\\}$ 是任意但固定的非负值，请从第一性原理推导功率谱和双谱估计量的有效散粒噪声贡献。你的推导必须识别出导致散粒噪声的指标收缩项，并用和 $S_r=\\sum_{i=1}^{N} w_i^r$（其中 $r=1,2,3$）以及潜在的成团贡献来表示散粒噪声。然后，实现一个程序，该程序在给定一个权重列表和一个闭合波矢三角形的潜在功率谱值三元组 $(P(k_1),P(k_2),P(k_3))$ 的情况下，计算：\n- 功率谱的有效散粒噪声，记为 $P_{\\mathrm{shot}}$，以及\n- 分解为双指标收缩项（记为 $B_{\\mathrm{shot},2}$）和三指标收缩项（记为 $B_{\\mathrm{shot},3}$）的双谱散粒噪声，以及它们的和 $B_{\\mathrm{shot}}=B_{\\mathrm{shot},2}+B_{\\mathrm{shot},3}$。\n\n所有量都应视为无量纲标量；不需要物理单位或角度。\n\n你的程序必须评估以下参数集的测试套件，每个参数集由一个包含权重列表和功率谱值三元组 $(P(k_1),P(k_2),P(k_3))$ 的元组指定：\n1. 权重 $[1.0,0.5,2.0,1.5]$，功率谱值 $(10.0,12.0,8.0)$。\n2. 权重 $[3.0]$，功率谱值 $(5.0,5.0,5.0)$。\n3. 包含一百个等于 $1.0$ 的条目的权重，功率谱值 $(0.2,0.3,0.4)$。\n4. 权重 $[0.0,0.0,1.0,4.0,0.0,2.0]$，功率谱值 $(1.0,2.0,3.0)$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身也是一个用方括号括起来的逗号分隔列表，顺序为 $[P_{\\mathrm{shot}},B_{\\mathrm{shot},2},B_{\\mathrm{shot},3},B_{\\mathrm{shot}}]$。例如，输出格式必须为 $[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],\\ldots]$，不含空格。", "solution": "用户要求对加权泊松点过程的功率谱和双谱的散粒噪声贡献进行推导，并随后进行计算实现。\n\n### 问题验证\n\n**第1步：提取已知条件**\n- 一个离散的加权物体集合，包含 $N$ 个物体，位于位置 $\\{\\mathbf{x}_i\\}_{i=1}^{N}$。\n- 严格非负的标量权重 $\\{w_i\\}_{i=1}^{N}$。\n- 加权数密度场：$n_w(\\mathbf{x})=\\sum_{i=1}^{N} w_i \\,\\delta_{\\mathrm{D}}(\\mathbf{x}-\\mathbf{x}_i)$。\n- 总权重：$S_1=\\sum_{i=1}^{N} w_i$。\n- 归一化加权场：$f(\\mathbf{x})=n_w(\\mathbf{x})/S_1$。\n- 傅里叶变换：$f(\\mathbf{k})=\\int d^3\\mathbf{x}\\, f(\\mathbf{x}) e^{-i\\mathbf{k}\\cdot\\mathbf{x}}$。\n- 功率谱估计量：$P(\\mathbf{k})=\\langle f(\\mathbf{k}) f(-\\mathbf{k}) \\rangle$，其中 $\\mathbf{k} \\neq \\mathbf{0}$。\n- 双谱估计量：$B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)=\\langle f(\\mathbf{k}_1) f(\\mathbf{k}_2) f(\\mathbf{k}_3) \\rangle$，对于非零波矢，满足闭合条件 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3=\\mathbf{0}$。\n- 假设：位置 $\\{\\mathbf{x}_i\\}$ 的采样遵循统计均匀的泊松点过程。\n- 任务：从第一性原理推导功率谱和双谱的有效散粒噪声贡献，并用 $S_r=\\sum_{i=1}^{N} w_i^r$（其中 $r=1,2,3$）和潜在的成团功率谱 $P(k)$ 来表示。\n\n**第2步：使用提取的已知条件进行验证**\n该问题是理论宇宙学和大尺度结构统计学中一个标准的、定义明确的练习。\n- **科学依据：** 该问题基于应用于宇宙学密度场的统计场论基本原理。功率谱、双谱和散粒噪声的概念是该领域的核心。\n- **适定性：** 该问题提供了推导唯一解所需的所有必要定义和假设。待计算的量有明确定义。\n- **客观性：** 该问题以精确的数学和物理语言陈述，没有歧义或主观论断。\n\n**第3步：结论与行动**\n该问题是有效的。将提供完整的解决方案。\n\n### 第一性原理推导\n\n推导从归一化加权场 $f(\\mathbf{x})$ 的傅里叶变换开始。将 $f(\\mathbf{x})$ 的定义代入傅里叶积分，得到：\n$$\nf(\\mathbf{k}) = \\int d^3\\mathbf{x} \\frac{1}{S_1} \\left(\\sum_{i=1}^{N} w_i \\delta_{\\mathrm{D}}(\\mathbf{x}-\\mathbf{x}_i)\\right) e^{-i\\mathbf{k}\\cdot\\mathbf{x}} = \\frac{1}{S_1} \\sum_{i=1}^{N} w_i e^{-i\\mathbf{k}\\cdot\\mathbf{x}_i}\n$$\n此表达式是加权点集的离散傅里叶变换，构成了估计量的基础。期望值 $\\langle \\cdot \\rangle$ 表示对泊松点过程多次实现的系综平均。泊松过程的关键特性是物体的位置是不相关的。\n\n**功率谱散粒噪声**\n功率谱估计量定义为 $P(\\mathbf{k}) = \\langle f(\\mathbf{k}) f(-\\mathbf{k}) \\rangle$。代入 $f(\\mathbf{k})$ 的表达式：\n$$\nP(\\mathbf{k}) = \\left\\langle \\left( \\frac{1}{S_1} \\sum_{i=1}^{N} w_i e^{-i\\mathbf{k}\\cdot\\mathbf{x}_i} \\right) \\left( \\frac{1}{S_1} \\sum_{j=1}^{N} w_j e^{i\\mathbf{k}\\cdot\\mathbf{x}_j} \\right) \\right\\rangle = \\frac{1}{S_1^2} \\left\\langle \\sum_{i,j=1}^{N} w_i w_j e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_i - \\mathbf{x}_j)} \\right\\rangle\n$$\n对指标 $i$ 和 $j$ 的求和可以分为两种情况：$i=j$ 的项和 $i \\neq j$ 的项。\n$$\nP(\\mathbf{k}) = \\frac{1}{S_1^2} \\left\\langle \\sum_{i=j} w_i w_j e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_i - \\mathbf{x}_j)} + \\sum_{i \\neq j} w_i w_j e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_i - \\mathbf{x}_j)} \\right\\rangle\n$$\n第一项，由指标收缩 $i=j$ 产生，是“自计数”或散粒噪声项。由于当 $i=j$ 时 $\\mathbf{x}_i - \\mathbf{x}_j = \\mathbf{0}$，指数项变为 $e^0 = 1$。此项与物体位置无关，因此系综平均对其没有影响。\n$$\n\\text{$i=j$ 的项} : \\quad \\frac{1}{S_1^2} \\sum_{i=1}^{N} w_i^2 = \\frac{S_2}{S_1^2}\n$$\n这是对功率谱的有效散粒噪声贡献，$P_{\\mathrm{shot}}$。它是一个常数偏移，与波矢 $\\mathbf{k}$ 无关。\n\n第二项，对于 $i \\neq j$，表示不同物体之间的相关性。此项的系综平均产生潜在的成团功率谱 $P_{\\text{true}}(k)$，对于统计各向同性的宇宙，它取决于模长 $k=|\\mathbf{k}|$。\n$$\n\\text{$i \\neq j$ 的项} : \\quad \\frac{1}{S_1^2} \\left\\langle \\sum_{i \\neq j} w_i w_j e^{-i\\mathbf{k}\\cdot(\\mathbf{x}_i - \\mathbf{x}_j)} \\right\\rangle = P_{\\text{true}}(k)\n$$\n因此，测得的总功率谱是真实信号与散粒噪声之和：$P(k) = P_{\\text{true}}(k) + P_{\\mathrm{shot}}$。问题要求的是散粒噪声贡献本身。\n$$\nP_{\\mathrm{shot}} = \\frac{S_2}{S_1^2}\n$$\n其中 $S_r = \\sum_{i=1}^{N} w_i^r$。\n\n**双谱散粒噪声**\n双谱估计量是 $B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)=\\langle f(\\mathbf{k}_1) f(\\mathbf{k}_2) f(\\mathbf{k}_3) \\rangle$，对于闭合的波矢三角形 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3=\\mathbf{0}$。我们代入 $f(\\mathbf{k})$ 的表达式：\n$$\nB(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3) = \\frac{1}{S_1^3} \\left\\langle \\sum_{i,j,l=1}^{N} w_i w_j w_l e^{-i(\\mathbf{k}_1\\cdot\\mathbf{x}_i + \\mathbf{k}_2\\cdot\\mathbf{x}_j + \\mathbf{k}_3\\cdot\\mathbf{x}_l)} \\right\\rangle\n$$\n三重求和根据指标收缩进行分解。\n1. **所有指标都不同 ($i \\neq j, j \\neq l, i \\neq l$)：** 此项对应于潜在密度场的内禀三点相关函数，即真实双谱 $B_{\\text{true}}(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)$。\n\n2. **三个指标相等 ($i = j = l$)：** 这表示三指标收缩项。\n$$\n\\text{$i=j=l$ 的项} : \\quad \\frac{1}{S_1^3} \\left\\langle \\sum_{i=1}^{N} w_i^3 e^{-i(\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3)\\cdot\\mathbf{x}_i} \\right\\rangle\n$$\n由于闭合条件 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3=\\mathbf{0}$，指数项变为 $e^0=1$。此项为常数，其系综平均是平凡的。\n$$\nB_{\\mathrm{shot},3} = \\frac{1}{S_1^3} \\sum_{i=1}^{N} w_i^3 = \\frac{S_3}{S_1^3}\n$$\n\n3. **两个指标相等 ($i=j \\neq l$，及其置换)：** 这是双指标收缩项。让我们考虑 $i=j \\neq l$ 的情况：\n$$\n\\text{$i=j \\neq l$ 的项} : \\quad \\frac{1}{S_1^3} \\left\\langle \\sum_{i \\neq l} w_i^2 w_l e^{-i(\\mathbf{k}_1+\\mathbf{k}_2)\\cdot\\mathbf{x}_i - i\\mathbf{k}_3\\cdot\\mathbf{x}_l} \\right\\rangle\n$$\n使用闭合条件 $\\mathbf{k}_1+\\mathbf{k}_2 = -\\mathbf{k}_3$，这变为：\n$$\n\\frac{1}{S_1^3} \\left\\langle \\sum_{i \\neq l} w_i^2 w_l e^{i\\mathbf{k}_3\\cdot(\\mathbf{x}_i - \\mathbf{x}_l)} \\right\\rangle\n$$\n这个表达式与一个由 $w^2$ 加权的场和一个由 $w$ 加权的场之间的交叉功率谱有关。假设权重与位置无关（这是问题设定的一个推论），这个交叉谱与密度场的潜在自功率谱 $P_{\\text{true}}(k_3)$ 成正比。通过匹配项可以推导出前置因子，得到 $\\frac{S_2 S_1}{S_1^3} P_{\\text{true}}(k_3) = \\frac{S_2}{S_1^2} P_{\\text{true}}(k_3)$。问题给出了潜在功率谱值，记为 $P(k)$。因此，这部分散粒噪声是 $\\frac{S_2}{S_1^2} P(k_3) = P_{\\mathrm{shot}} P(k_3)$。\n完整的双指标收缩项 $B_{\\mathrm{shot},2}$ 是三个置换（$i=j \\neq l$，$i=l \\neq j$，$j=l \\neq i$）之和，得到：\n$$\nB_{\\mathrm{shot},2} = \\frac{S_2}{S_1^2}P(k_1) + \\frac{S_2}{S_1^2}P(k_2) + \\frac{S_2}{S_1^2}P(k_3) = \\frac{S_2}{S_1^2} \\left[ P(k_1) + P(k_2) + P(k_3) \\right]\n$$\n\n**公式总结**\n需要计算的散粒噪声分量是：\n- 功率谱散粒噪声：$P_{\\mathrm{shot}} = \\frac{S_2}{S_1^2}$\n- 双谱双指标散粒噪声：$B_{\\mathrm{shot},2} = P_{\\mathrm{shot}} \\left( P(k_1) + P(k_2) + P(k_3) \\right)$\n- 双谱三指标散粒噪声：$B_{\\mathrm{shot},3} = \\frac{S_3}{S_1^3}$\n- 总双谱散粒噪声：$B_{\\mathrm{shot}} = B_{\\mathrm{shot},2} + B_{\\mathrm{shot},3}$\n\n其中 $S_r = \\sum_{i=1}^{N} w_i^r$，对于 $r \\in \\{1, 2, 3\\}$。现在将实现这些公式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating shot noise contributions for the power spectrum\n    and bispectrum for given sets of weights and underlying power spectrum values.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General weights\n        ([1.0, 0.5, 2.0, 1.5], (10.0, 12.0, 8.0)),\n        # Case 2: Single object\n        ([3.0], (5.0, 5.0, 5.0)),\n        # Case 3: Uniform weights\n        ([1.0] * 100, (0.2, 0.3, 0.4)),\n        # Case 4: Weights including zeros\n        ([0.0, 0.0, 1.0, 4.0, 0.0, 2.0], (1.0, 2.0, 3.0)),\n    ]\n\n    all_results = []\n    for weights, powers in test_cases:\n        # Use numpy for efficient array operations.\n        # Ensure weights are float64 for precision.\n        w = np.array(weights, dtype=np.float64)\n\n        # Calculate the sums S_r = sum(w_i^r) for r=1, 2, 3.\n        S1 = np.sum(w)\n        \n        # Handle the edge case where all weights are zero.\n        # In this scenario, the field is identically zero, so all estimators\n        # and their shot noise contributions are zero.\n        if S1 == 0.0:\n            P_shot = 0.0\n            B_shot_2 = 0.0\n            B_shot_3 = 0.0\n            B_shot = 0.0\n        else:\n            S2 = np.sum(w**2)\n            S3 = np.sum(w**3)\n            \n            # Calculate the power spectrum shot noise term.\n            # P_shot = S2 / S1^2\n            P_shot = S2 / (S1**2)\n            \n            # Calculate the two-index contraction term for the bispectrum shot noise.\n            # B_shot,2 = P_shot * (P(k1) + P(k2) + P(k3))\n            P_sum = sum(powers)\n            B_shot_2 = P_shot * P_sum\n            \n            # Calculate the three-index contraction term for the bispectrum shot noise.\n            # B_shot,3 = S3 / S1^3\n            B_shot_3 = S3 / (S1**3)\n            \n            # Calculate the total bispectrum shot noise.\n            B_shot = B_shot_2 + B_shot_3\n        \n        # Store the results for the current test case.\n        all_results.append([P_shot, B_shot_2, B_shot_3, B_shot])\n\n    # Format the output string precisely as required, with no spaces.\n    # The output is a string representation of a list of lists.\n    output_parts = []\n    for res in all_results:\n        # Each inner list is formatted as \"[a,b,c,d]\"\n        output_parts.append(f\"[{','.join(map(str, res))}]\")\n    \n    # The final output is a concatenation of the inner lists,\n    # separated by commas, and enclosed in brackets.\n    final_output = f\"[{','.join(output_parts)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3481941"}]}