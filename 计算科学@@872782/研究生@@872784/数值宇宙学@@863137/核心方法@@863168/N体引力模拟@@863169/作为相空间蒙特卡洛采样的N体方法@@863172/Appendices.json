{"hands_on_practices": [{"introduction": "在蒙特卡洛框架中，$N$体粒子在一个小体积内被视为从局域相空间分布函数中抽取的离散样本。本练习提供了这一思想的具体定量应用。通过从少量粒子速度中计算应力张量——流体动力学中代表动量通量的关键量——你将直接实践如何估算宏观流体属性，以及至关重要的，由有限粒子采样带来的统计不确定性。[@problem_id:3497539]", "problem": "考虑一个无碰撞冷暗物质 $N$ 体模拟中的单个网格单元，该单元通过对 $N$ 个等质量粒子进行蒙特卡洛 (MC) 采样来近似局域相空间分布函数 $f(\\boldsymbol{x},\\boldsymbol{v},t)$。在固定位置 $\\boldsymbol{x}$ 处的应力张量（速度二阶矩）由无碰撞玻尔兹曼方程 (CBE) 的动理论矩定义为\n$$\\Pi_{ij}(\\boldsymbol{x}) \\equiv \\rho(\\boldsymbol{x}) \\left\\langle \\left(v_i - u_i(\\boldsymbol{x})\\right)\\left(v_j - u_j(\\boldsymbol{x})\\right) \\right\\rangle,$$\n其中 $\\rho(\\boldsymbol{x})$ 是质量密度，$\\boldsymbol{u}(\\boldsymbol{x})$ 是平均（整体）速度。在一个 $N$ 体实现中，体积为 $V_{\\mathrm{cell}}$、包含 $N$ 个等质量 $m$ 的粒子的单元中，$\\Pi_{ij}$ 的蒙特卡洛估计量由粒子速度 $\\{\\boldsymbol{v}_k\\}_{k=1}^{N}$ 构建。\n\n给定单个单元的以下数据：\n- 粒子数 $N = 25$ 和粒子质量 $m = 1.98847 \\times 10^{39}\\ \\mathrm{kg}$。\n- 单元体积 $V_{\\mathrm{cell}} = 2.938 \\times 10^{68}\\ \\mathrm{m}^3$。\n- 速度和 (单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$)：$\\sum_{k=1}^{N} v_{k,x} = 5.0 \\times 10^{6}$，$\\sum_{k=1}^{N} v_{k,y} = -2.5 \\times 10^{6}$，$\\sum_{k=1}^{N} v_{k,z} = 1.0 \\times 10^{6}$。\n- 二阶矩和 (单位为 $(\\mathrm{m}\\,\\mathrm{s}^{-1})^2$)：$\\sum_{k=1}^{N} v_{k,x}^{2} = 1.20 \\times 10^{12}$，$\\sum_{k=1}^{N} v_{k,y}^{2} = 1.80 \\times 10^{12}$，$\\sum_{k=1}^{N} v_{k,z}^{2} = 0.80 \\times 10^{12}$。\n- 交叉矩和 (单位为 $(\\mathrm{m}\\,\\mathrm{s}^{-1})^2$)：$\\sum_{k=1}^{N} v_{k,x} v_{k,y} = -1.0 \\times 10^{11}$，$\\sum_{k=1}^{N} v_{k,x} v_{k,z} = 5.0 \\times 10^{10}$，$\\sum_{k=1}^{N} v_{k,y} v_{k,z} = -2.0 \\times 10^{10}$。\n\n任务：\n1. 仅使用样本矩的基本定义，计算此单元中平均速度分量 $\\hat{u}_i$ 和速度弥散张量分量 $\\hat{\\Sigma}_{ij}$ 的蒙特卡洛估计量。\n2. 假设局域速度采样独立地从一个具有真实协方差矩阵 $\\Sigma$ 和未知均值 $\\boldsymbol{u}$ 的多元正态 (MVN) 分布中抽取，将无偏样本协方差 $\\hat{\\Sigma}$ 视为服从自由度为 $\\nu = N - 1$ 的威沙特分布，并传播采样不确定性，以获得对角应力分量 $\\hat{\\Pi}_{ii} = \\hat{\\rho}\\,\\hat{\\Sigma}_{ii}$（其中 $i \\in \\{x,y,z\\}$）的一西格玛标准误差，这里 $\\hat{\\rho} = Nm/V_{\\mathrm{cell}}$。\n3. 将 $\\hat{\\Pi}_{xx}$、$\\hat{\\Pi}_{yy}$ 和 $\\hat{\\Pi}_{zz}$ 的最终一西格玛误差以帕斯卡为单位，表示为单行矩阵，并将最终值四舍五入到三位有效数字。\n\n重要提示：所有内容都必须从给定的定义和经过充分检验的统计事实推导得出。不要引入任何未经第一性原理或这些事实证明的快捷公式。你的最终答案必须是指定格式的单行矩阵，并且在方框内只包含数字，不带单位。", "solution": "该问题被评估为有效。其科学基础在于应用于数值宇宙学的动理论和统计力学原理。问题是良定的，为得到唯一解提供了所有必要数据，并且其语言客观、无歧义。该问题要求将标准统计估计技术应用于 N 体模拟的数据，这是该领域的一项常见任务。\n\n解答过程按任务要求分为三部分。\n\n第 1 部分：蒙特卡洛估计量的计算\n\n第一个任务是计算平均速度分量 $\\hat{u}_i$ 和速度弥散张量分量 $\\hat{\\Sigma}_{ij}$ 的蒙特卡洛估计量。\n\n在一个包含 $N$ 个粒子的单元中，平均速度分量 $\\hat{u}_i$ 的蒙特卡洛估计量是该分量上粒子速度的样本均值：\n$$ \\hat{u}_i = \\frac{1}{N} \\sum_{k=1}^{N} v_{k,i} $$\n使用给定数据：$N=25$，$\\sum_{k=1}^{N} v_{k,x} = 5.0 \\times 10^{6}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$，$\\sum_{k=1}^{N} v_{k,y} = -2.5 \\times 10^{6}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$，以及 $\\sum_{k=1}^{N} v_{k,z} = 1.0 \\times 10^{6}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$。\n平均速度分量为：\n$$ \\hat{u}_x = \\frac{5.0 \\times 10^{6}}{25} = 2.0 \\times 10^{5}\\ \\mathrm{m}\\,\\mathrm{s}^{-1} $$\n$$ \\hat{u}_y = \\frac{-2.5 \\times 10^{6}}{25} = -1.0 \\times 10^{5}\\ \\mathrm{m}\\,\\mathrm{s}^{-1} $$\n$$ \\hat{u}_z = \\frac{1.0 \\times 10^{6}}{25} = 4.0 \\times 10^{4}\\ \\mathrm{m}\\,\\mathrm{s}^{-1} $$\n\n速度弥散张量 $\\Sigma_{ij} = \\left\\langle (v_i - u_i)(v_j - u_j) \\right\\rangle$ 使用无偏样本协方差矩阵 $\\hat{\\Sigma}_{ij}$ 进行估计。该估计量的公式为：\n$$ \\hat{\\Sigma}_{ij} = \\frac{1}{N-1} \\sum_{k=1}^{N} (v_{k,i} - \\hat{u}_i)(v_{k,j} - \\hat{u}_j) $$\n为了计算方便，这个表达式可以展开。该和变为：\n$$ \\sum_{k=1}^{N} (v_{k,i} - \\hat{u}_i)(v_{k,j} - \\hat{u}_j) = \\sum_{k=1}^{N} (v_{k,i}v_{k,j} - v_{k,i}\\hat{u}_j - v_{k,j}\\hat{u}_i + \\hat{u}_i\\hat{u}_j) $$\n$$ = \\left(\\sum_{k=1}^{N} v_{k,i}v_{k,j}\\right) - \\hat{u}_j\\left(\\sum_{k=1}^{N} v_{k,i}\\right) - \\hat{u}_i\\left(\\sum_{k=1}^{N} v_{k,j}\\right) + N\\hat{u}_i\\hat{u}_j $$\n使用定义 $\\sum_{k=1}^{N} v_{k,i} = N\\hat{u}_i$，表达式简化为：\n$$ = \\left(\\sum_{k=1}^{N} v_{k,i}v_{k,j}\\right) - N\\hat{u}_i\\hat{u}_j - N\\hat{u}_i\\hat{u}_j + N\\hat{u}_i\\hat{u}_j = \\left(\\sum_{k=1}^{N} v_{k,i}v_{k,j}\\right) - N\\hat{u}_i\\hat{u}_j $$\n因此，估计量为：\n$$ \\hat{\\Sigma}_{ij} = \\frac{1}{N-1} \\left[ \\left(\\sum_{k=1}^{N} v_{k,i}v_{k,j}\\right) - N\\hat{u}_i\\hat{u}_j \\right] $$\n我们需要计算对角分量 $\\hat{\\Sigma}_{ii}$，其中 $i \\in \\{x,y,z\\}$。根据 $N-1 = 24$ 和给定的和：\n对于 $i=x$：\n$$ \\hat{\\Sigma}_{xx} = \\frac{1}{24} \\left[ \\left(\\sum_{k=1}^{25} v_{k,x}^2\\right) - 25 \\cdot \\hat{u}_x^2 \\right] = \\frac{1}{24} \\left[ 1.20 \\times 10^{12} - 25 \\cdot (2.0 \\times 10^5)^2 \\right] $$\n$$ \\hat{\\Sigma}_{xx} = \\frac{1}{24} \\left[ 1.20 \\times 10^{12} - 25 \\cdot (4.0 \\times 10^{10}) \\right] = \\frac{1}{24} \\left[ 1.20 \\times 10^{12} - 1.0 \\times 10^{12} \\right] = \\frac{0.20 \\times 10^{12}}{24} = \\frac{5}{6} \\times 10^{10}\\ (\\mathrm{m}\\,\\mathrm{s}^{-1})^2 $$\n对于 $i=y$：\n$$ \\hat{\\Sigma}_{yy} = \\frac{1}{24} \\left[ \\left(\\sum_{k=1}^{25} v_{k,y}^2\\right) - 25 \\cdot \\hat{u}_y^2 \\right] = \\frac{1}{24} \\left[ 1.80 \\times 10^{12} - 25 \\cdot (-1.0 \\times 10^5)^2 \\right] $$\n$$ \\hat{\\Sigma}_{yy} = \\frac{1}{24} \\left[ 1.80 \\times 10^{12} - 25 \\cdot (1.0 \\times 10^{10}) \\right] = \\frac{1}{24} \\left[ 1.80 \\times 10^{12} - 0.25 \\times 10^{12} \\right] = \\frac{1.55 \\times 10^{12}}{24}\\ (\\mathrm{m}\\,\\mathrm{s}^{-1})^2 $$\n对于 $i=z$：\n$$ \\hat{\\Sigma}_{zz} = \\frac{1}{24} \\left[ \\left(\\sum_{k=1}^{25} v_{k,z}^2\\right) - 25 \\cdot \\hat{u}_z^2 \\right] = \\frac{1}{24} \\left[ 0.80 \\times 10^{12} - 25 \\cdot (4.0 \\times 10^4)^2 \\right] $$\n$$ \\hat{\\Sigma}_{zz} = \\frac{1}{24} \\left[ 0.80 \\times 10^{12} - 25 \\cdot (1.6 \\times 10^9) \\right] = \\frac{1}{24} \\left[ 0.80 \\times 10^{12} - 0.04 \\times 10^{12} \\right] = \\frac{0.76 \\times 10^{12}}{24}\\ (\\mathrm{m}\\,\\mathrm{s}^{-1})^2 $$\n\n第 2 部分：采样不确定性的传播\n\n应力张量为 $\\Pi_{ij} = \\rho \\Sigma_{ij}$。其蒙特卡洛估计量为 $\\hat{\\Pi}_{ij} = \\hat{\\rho} \\hat{\\Sigma}_{ij}$。质量密度估计量 $\\hat{\\rho}$ 由单元中的总质量除以单元体积给出：\n$$ \\hat{\\rho} = \\frac{Nm}{V_{\\mathrm{cell}}} = \\frac{25 \\cdot (1.98847 \\times 10^{39}\\ \\mathrm{kg})}{2.938 \\times 10^{68}\\ \\mathrm{m}^3} \\approx 1.69199 \\times 10^{-28}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3} $$\n估计的应力张量的对角分量为 $\\hat{\\Pi}_{ii} = \\hat{\\rho}\\hat{\\Sigma}_{ii}$。\n为了找到这些分量的标准误差，我们使用样本协方差矩阵的统计特性。假设速度从一个多元正态分布 $\\mathcal{N}(\\boldsymbol{u}, \\Sigma)$ 中抽取，则矩阵 $(N-1)\\hat{\\Sigma}$ 服从威沙特分布 $W_p(N-1, \\Sigma)$，其中维度 $p=3$。\n威沙特分布的一个标准结果是，$\\hat{\\Sigma}$ 的对角元素的方差由下式给出：\n$$ \\mathrm{Var}(\\hat{\\Sigma}_{ii}) = \\frac{2(\\Sigma_{ii})^2}{N-1} $$\n因此，估计量 $\\hat{\\Sigma}_{ii}$ 的标准差为 $\\mathrm{SD}(\\hat{\\Sigma}_{ii}) = \\sqrt{\\frac{2}{N-1}} \\Sigma_{ii}$。\n$\\hat{\\Sigma}_{ii}$ 的标准误差通过用其无偏估计量 $\\hat{\\Sigma}_{ii}$ 替换真实（未知）方差 $\\Sigma_{ii}$ 来估计：\n$$ \\sigma(\\hat{\\Sigma}_{ii}) \\approx \\sqrt{\\frac{2}{N-1}} \\hat{\\Sigma}_{ii} $$\n由于在此背景下 $\\hat{\\rho}$ 是一个常数（由给定的非随机值组成），应力张量分量 $\\hat{\\Pi}_{ii} = \\hat{\\rho}\\hat{\\Sigma}_{ii}$ 的标准误差为：\n$$ \\sigma(\\hat{\\Pi}_{ii}) = \\hat{\\rho} \\sigma(\\hat{\\Sigma}_{ii}) \\approx \\hat{\\rho} \\left( \\sqrt{\\frac{2}{N-1}} \\hat{\\Sigma}_{ii} \\right) = \\sqrt{\\frac{2}{N-1}} (\\hat{\\rho}\\hat{\\Sigma}_{ii}) = \\sqrt{\\frac{2}{N-1}} \\hat{\\Pi}_{ii} $$\n对于 $N=25$，预因子为 $\\sqrt{\\frac{2}{24}} = \\sqrt{\\frac{1}{12}} = \\frac{1}{2\\sqrt{3}} \\approx 0.288675$。\n\n第 3 部分：最终数值计算\n\n我们现在计算标准误差 $\\sigma(\\hat{\\Pi}_{ii})$ 的数值，并以帕斯卡（$\\mathrm{Pa} = \\mathrm{kg}\\cdot\\mathrm{m}^{-1}\\cdot\\mathrm{s}^{-2}$）为单位表示。单位是一致的，因为 $[\\hat{\\rho}] = \\mathrm{kg}\\,\\mathrm{m}^{-3}$ 且 $[\\hat{\\Sigma}_{ii}] = \\mathrm{m}^2\\,\\mathrm{s}^{-2}$，所以 $[\\hat{\\Pi}_{ii}] = \\mathrm{kg}\\cdot\\mathrm{m}^{-1}\\cdot\\mathrm{s}^{-2}$。\n\n首先，我们计算估计的应力张量分量 $\\hat{\\Pi}_{ii}$：\n$$ \\hat{\\Pi}_{xx} = \\hat{\\rho} \\hat{\\Sigma}_{xx} = (1.69199 \\times 10^{-28}) \\cdot \\left(\\frac{0.20 \\times 10^{12}}{24}\\right) \\approx 1.4100 \\times 10^{-18}\\ \\mathrm{Pa} $$\n$$ \\hat{\\Pi}_{yy} = \\hat{\\rho} \\hat{\\Sigma}_{yy} = (1.69199 \\times 10^{-28}) \\cdot \\left(\\frac{1.55 \\times 10^{12}}{24}\\right) \\approx 1.0928 \\times 10^{-17}\\ \\mathrm{Pa} $$\n$$ \\hat{\\Pi}_{zz} = \\hat{\\rho} \\hat{\\Sigma}_{zz} = (1.69199 \\times 10^{-28}) \\cdot \\left(\\frac{0.76 \\times 10^{12}}{24}\\right) \\approx 5.3580 \\times 10^{-18}\\ \\mathrm{Pa} $$\n\n接下来，我们使用 $\\sigma(\\hat{\\Pi}_{ii}) \\approx \\sqrt{1/12} \\cdot \\hat{\\Pi}_{ii}$ 计算一西格玛标准误差：\n$$ \\sigma(\\hat{\\Pi}_{xx}) \\approx (0.288675) \\cdot (1.4100 \\times 10^{-18}) \\approx 4.0704 \\times 10^{-19}\\ \\mathrm{Pa} $$\n$$ \\sigma(\\hat{\\Pi}_{yy}) \\approx (0.288675) \\cdot (1.0928 \\times 10^{-17}) \\approx 3.1544 \\times 10^{-18}\\ \\mathrm{Pa} $$\n$$ \\sigma(\\hat{\\Pi}_{zz}) \\approx (0.288675) \\cdot (5.3580 \\times 10^{-18}) \\approx 1.5469 \\times 10^{-18}\\ \\mathrm{Pa} $$\n将这些结果四舍五入到三位有效数字，我们得到：\n$$ \\sigma(\\hat{\\Pi}_{xx}) \\approx 4.07 \\times 10^{-19}\\ \\mathrm{Pa} $$\n$$ \\sigma(\\hat{\\Pi}_{yy}) \\approx 3.15 \\times 10^{-18}\\ \\mathrm{Pa} $$\n$$ \\sigma(\\hat{\\Pi}_{zz}) \\approx 1.55 \\times 10^{-18}\\ \\mathrm{Pa} $$\n最终答案以包含这三个值的单行矩阵形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4.07 \\times 10^{-19} & 3.15 \\times 10^{-18} & 1.55 \\times 10^{-18}\n\\end{pmatrix}\n}\n$$", "id": "3497539"}, {"introduction": "虽然单个粒子对相空间进行采样，但我们通常需要在网格上分析连续场，例如密度场。这需要一个“质量分配”步骤，相当于施加一个平滑核。本练习将指导你进行理论推导，以理解这一过程的深远影响：它系统性地抑制了小尺度上的功率，并由于粒子的离散性引入了“散粒噪声”。掌握这一推导对于正确解释任何$N$体模拟中测得的功率谱至关重要。[@problem_id:3497535]", "problem": "考虑一个体积为 $V$ 的周期性立方体域中的统计均匀且各向同性的物质密度对比度场 $\\delta(\\boldsymbol{x})$，其功率谱 $P(\\boldsymbol{k})$ 由系综平均 $\\langle \\tilde{\\delta}(\\boldsymbol{k}) \\tilde{\\delta}^{*}(\\boldsymbol{k}') \\rangle = (2\\pi)^{3} \\delta_{\\mathrm{D}}(\\boldsymbol{k} - \\boldsymbol{k}') P(\\boldsymbol{k})$ 定义，其中 $\\tilde{\\delta}(\\boldsymbol{k})$ 表示 $\\delta(\\boldsymbol{x})$ 的傅里叶变换，$\\delta_{\\mathrm{D}}$ 是狄拉克δ分布。将 $N$ 体粒子实现建模为相空间的蒙特卡洛采样，该采样产生一个点过程，其平均数密度为 $\\bar{n}$，强度为 $\\bar{n} [1 + \\delta(\\boldsymbol{x})]$。网格化数密度场 $n_{\\mathrm{g}}(\\boldsymbol{x})$ 是通过质量分配构建的，使用一个积分为1的可分离紧致核 $w(\\boldsymbol{x})$，因此 $n_{\\mathrm{g}}(\\boldsymbol{x}) = \\sum_{i=1}^{N} w(\\boldsymbol{x} - \\boldsymbol{x}_{i})$。将网格化密度对比度定义为 $\\delta_{\\mathrm{g}}(\\boldsymbol{x}) = n_{\\mathrm{g}}(\\boldsymbol{x})/\\bar{n} - 1$，并设其傅里叶变换为 $\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})$。您使用快速傅里叶变换 (FFT) 在间距为 $\\Delta$ 的规则网格上测量功率谱，从 $|\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^{2}$ 中获得一个估计量 $P_{\\mathrm{meas}}(\\boldsymbol{k})$。\n\n假设在奈奎斯特频率 $k_{\\mathrm{Ny}} = \\pi/\\Delta$ 或以上时，底层 $P(\\boldsymbol{k})$ 对于 $|\\boldsymbol{k}|$ 是可忽略的（因此可以忽略网格采样引起的混叠），并且质量分配核是p阶三维B样条，其中 $p \\in \\{1,2,3\\}$ 分别对应最近网格点 (NGP)、云中单元 (CIC) 和三角形云 (TSC)。在这些假设下：\n\n- 从上述定义出发，将粒子实现视为强度为 $\\bar{n} [1 + \\delta(\\boldsymbol{x})]$ 的非齐次泊松过程，推导测量谱 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 的系综期望，用底层 $P(\\boldsymbol{k})$、分配核 $w(\\boldsymbol{x})$ 的傅里叶变换 $\\tilde{W}(\\boldsymbol{k})$ 和平均数密度 $\\bar{n}$ 表示。清晰地指出由泊松散粒噪声产生的项。\n\n- 对于p阶三维B样条分配，用 $\\boldsymbol{k} = (k_{1}, k_{2}, k_{3})$ 和网格间距 $\\Delta$ 显式地写出 $\\tilde{W}(\\boldsymbol{k})$。\n\n- 通过对质量分配窗进行反卷积并考虑散粒噪声，给出一个反卷积估计量 $\\widehat{P}(\\boldsymbol{k})$ 的闭式表达式，该表达式在所述假设下从 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 恢复底层 $P(\\boldsymbol{k})$。\n\n您的最终答案必须是 $\\widehat{P}(\\boldsymbol{k})$ 的单个解析表达式，用 $P_{\\mathrm{meas}}(\\boldsymbol{k})$、$\\bar{n}$、$p$、$\\Delta$ 和 $\\boldsymbol{k}$ 表示。不需要进行数值计算。", "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n-   **密度对比度场：** 一个体积为V的周期性立方体域中的统计均匀且各向同性的物质密度对比度场 $\\delta(\\boldsymbol{x})$。\n-   **功率谱定义：** 系综平均 $\\langle \\tilde{\\delta}(\\boldsymbol{k}) \\tilde{\\delta}^{*}(\\boldsymbol{k}') \\rangle = (2\\pi)^{3} \\delta_{\\mathrm{D}}(\\boldsymbol{k} - \\boldsymbol{k}') P(\\boldsymbol{k})$，其中 $\\tilde{\\delta}(\\boldsymbol{k})$ 是 $\\delta(\\boldsymbol{x})$ 的傅里叶变换，$\\delta_{\\mathrm{D}}$ 是狄拉克δ分布。\n-   **粒子实现模型：** 一个采样相空间的 $N$ 体点过程，平均数密度为 $\\bar{n}$，强度为 $\\lambda(\\boldsymbol{x}) = \\bar{n} [1 + \\delta(\\boldsymbol{x})]$。这被指定为非齐次泊松过程处理。\n-   **网格化数密度：** $n_{\\mathrm{g}}(\\boldsymbol{x}) = \\sum_{i=1}^{N} w(\\boldsymbol{x} - \\boldsymbol{x}_{i})$，使用一个积分为1的可分离、紧致质量分配核 $w(\\boldsymbol{x})$。\n-   **网格化密度对比度：** $\\delta_{\\mathrm{g}}(\\boldsymbol{x}) = n_{\\mathrm{g}}(\\boldsymbol{x})/\\bar{n} - 1$。其傅里叶变换是 $\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})$。\n-   **测量功率谱：** 从 $|\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^{2}$ 获得的估计量 $P_{\\mathrm{meas}}(\\boldsymbol{k})$。\n-   **网格属性：** 间距为 $\\Delta$ 的规则网格。\n-   **假设：**\n    1.  当 $|\\boldsymbol{k}| \\ge k_{\\mathrm{Ny}} = \\pi/\\Delta$ 时，底层功率谱 $P(\\boldsymbol{k})$ 可忽略不计。\n    2.  质量分配核 $w(\\boldsymbol{x})$ 是p阶三维B样条，其中 $p \\in \\{1,2,3\\}$，对应NGP、CIC和TSC方案。\n-   **任务：**\n    1.  推导测量的谱的系综期望 $\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle$，用 $P(\\boldsymbol{k})$、$\\tilde{W}(\\boldsymbol{k})$ 和 $\\bar{n}$ 表示。识别出散粒噪声项。\n    2.  为指定的B样条核提供 $\\tilde{W}(\\boldsymbol{k})$ 的显式表达式。\n    3.  提供一个反卷积估计量 $\\widehat{P}(\\boldsymbol{k})$ 的闭式表达式，用 $P_{\\mathrm{meas}}(\\boldsymbol{k})$、$\\bar{n}$、$p$、$\\Delta$ 和 $\\boldsymbol{k}$ 表示。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题牢固地植根于数值宇宙学和​​大尺度结构分析的标准理论框架中。所有概念——功率谱、密度对比度、泊松采样、散粒噪声和质量分配方案（NGP、CIC、TSC）——都是该领域的基础。将粒子建模为非齐次泊松过程是一个标准且合理的近似。\n-   **适定性：** 该问题是适定的。它提供了清晰的定义、明确的假设以及一系列导向唯一数学结果的任务。诸如忽略混叠之类的假设是此类推导中常见的简化条件。\n-   **客观性：** 语言技术性强、精确，没有任何主观或模糊的术语。\n-   **完整性与一致性：** 问题是自洽的。所提供的信息对于推导是充分且内部一致的。测量的功率谱 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 与 $|\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^{2}$ 之间的关系在此背景下是标准的，其中 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 被视为 $\\delta_{\\mathrm{g}}$ 场的功率谱的估计量。\n\n### 步骤3：结论与行动\n问题有效。将提供一个完整的、有理有据的解答。\n\n### 解答推导\n\n解答按照问题陈述的要求分为三个部分进行。\n\n**第1部分：测量的功率谱期望的推导**\n\n我们从网格化密度对比度 $\\delta_{\\mathrm{g}}(\\boldsymbol{x}) = n_{\\mathrm{g}}(\\boldsymbol{x})/\\bar{n} - 1$ 开始。代入 $n_{\\mathrm{g}}(\\boldsymbol{x})$ 的定义：\n$$\n\\delta_{\\mathrm{g}}(\\boldsymbol{x}) = \\frac{1}{\\bar{n}} \\sum_{i=1}^{N} w(\\boldsymbol{x} - \\boldsymbol{x}_{i}) - 1\n$$\n我们计算其傅里叶变换 $\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k}) = \\int \\delta_{\\mathrm{g}}(\\boldsymbol{x}) e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}} d^3x$。对于 $\\boldsymbol{k} \\neq \\boldsymbol{0}$ 的模式，常数项 $-1$ 的傅里叶变换为零。\n$$\n\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k}) = \\frac{1}{\\bar{n}} \\int \\left( \\sum_{i=1}^{N} w(\\boldsymbol{x} - \\boldsymbol{x}_{i}) \\right) e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}} d^3x\n$$\n使用卷积定理，一串移位核的傅里叶变换是核的傅里叶变换 $\\tilde{W}(\\boldsymbol{k})$ 与粒子位置的结构因子的乘积：\n$$\n\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k}) = \\frac{\\tilde{W}(\\boldsymbol{k})}{\\bar{n}} \\sum_{i=1}^{N} e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}_{i}}\n$$\n此模式下的功率为 $|\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^2$：\n$$\n|\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^2 = \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}^2} \\left( \\sum_{i=1}^{N} e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}_{i}} \\right) \\left( \\sum_{j=1}^{N} e^{i \\boldsymbol{k} \\cdot \\boldsymbol{x}_{j}} \\right) = \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}^2} \\sum_{i,j=1}^{N} e^{-i \\boldsymbol{k} \\cdot (\\boldsymbol{x}_{i} - \\boldsymbol{x}_{j})}\n$$\n我们将这个和分为对角项（$i=j$）和非对角项（$i \\neq j$）：\n$$\n|\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^2 = \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}^2} \\left( N + \\sum_{i \\neq j} e^{-i \\boldsymbol{k} \\cdot (\\boldsymbol{x}_{i} - \\boldsymbol{x}_{j})} \\right)\n$$\n接下来，我们取系综平均。这是一个两步过程：首先，对于一个固定的底层场 $\\delta(\\boldsymbol{x})$，对泊松过程进行平均，记为 $\\langle \\cdot \\rangle_P$；然后，对 $\\delta(\\boldsymbol{x})$ 场的系综进行平均。粒子位置从强度为 $\\lambda(\\boldsymbol{x}) = \\bar{n}[1 + \\delta(\\boldsymbol{x})]$ 的非齐次泊松过程中抽取。对于这样的过程，我们有以下性质（来自Campbell定理的推广）：\n$\\langle N \\rangle_P = \\int \\lambda(\\boldsymbol{x}) d^3x = \\int \\bar{n}[1+\\delta(\\boldsymbol{x})]d^3x = \\bar{n}V$。\n$\\langle \\sum_{i \\neq j} f(\\boldsymbol{x}_i, \\boldsymbol{x}_j) \\rangle_P = \\iint \\lambda(\\boldsymbol{x}_i) \\lambda(\\boldsymbol{x}_j) f(\\boldsymbol{x}_i, \\boldsymbol{x}_j) d^3x_i d^3x_j$。\n\n将此应用于我们的表达式：\n$$\n\\langle \\sum_{i \\neq j} e^{-i \\boldsymbol{k} \\cdot (\\boldsymbol{x}_{i} - \\boldsymbol{x}_{j})} \\rangle_P = \\iint \\bar{n}^2 [1+\\delta(\\boldsymbol{x}_i)][1+\\delta(\\boldsymbol{x}_j)] e^{-i \\boldsymbol{k} \\cdot (\\boldsymbol{x}_i - \\boldsymbol{x}_j)} d^3x_i d^3x_j\n$$\n$$\n= \\bar{n}^2 \\left( \\int [1+\\delta(\\boldsymbol{x})] e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}} d^3x \\right) \\left( \\int [1+\\delta(\\boldsymbol{x}')] e^{i \\boldsymbol{k} \\cdot \\boldsymbol{x}'} d^3x' \\right)\n$$\n对于 $\\boldsymbol{k} \\neq \\boldsymbol{0}$，$\\int e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}} d^3x = 0$。因此，我们剩下：\n$$\n= \\bar{n}^2 \\left( \\int \\delta(\\boldsymbol{x}) e^{-i \\boldsymbol{k} \\cdot \\boldsymbol{x}} d^3x \\right) \\left( \\int \\delta(\\boldsymbol{x}') e^{i \\boldsymbol{k} \\cdot \\boldsymbol{x}'} d^3x' \\right) = \\bar{n}^2 |\\tilde{\\delta}(\\boldsymbol{k})|^2\n$$\n泊松平均后的功率是：\n$$\n\\langle |\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^2 \\rangle_P = \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}^2} \\left[ \\bar{n}V + \\bar{n}^2 |\\tilde{\\delta}(\\boldsymbol{k})|^2 \\right] = |\\tilde{W}(\\boldsymbol{k})|^2 \\left( \\frac{V}{\\bar{n}} + |\\tilde{\\delta}(\\boldsymbol{k})|^2 \\right)\n$$\n现在，我们对 $\\delta(\\boldsymbol{x})$ 场的系综进行平均。对于有限体积 $V$ 中的网格化场，测量的功率谱估计量 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 通过其期望定义为 $\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle = \\frac{1}{V} \\langle |\\tilde{\\delta}_{\\mathrm{g}}(\\boldsymbol{k})|^2 \\rangle$，其中 $\\langle \\cdot \\rangle$ 是完整的系综平均。\n$$\n\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle = \\frac{1}{V} \\langle |\\tilde{W}(\\boldsymbol{k})|^2 \\left(\\frac{V}{\\bar{n}} + |\\tilde{\\delta}(\\boldsymbol{k})|^2\\right) \\rangle = \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{V} \\left( \\frac{V}{\\bar{n}} + \\langle |\\tilde{\\delta}(\\boldsymbol{k})|^2 \\rangle \\right)\n$$\n底层场的功率谱 $P(\\boldsymbol{k})$ 由 $\\langle |\\tilde{\\delta}(\\boldsymbol{k})|^2 \\rangle = V P(\\boldsymbol{k})$ 定义。代入此式可得：\n$$\n\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle = \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{V} \\left(\\frac{V}{\\bar{n}} + V P(\\boldsymbol{k})\\right) = |\\tilde{W}(\\boldsymbol{k})|^2 P(\\boldsymbol{k}) + \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}}\n$$\n第一项代表被窗函数抑制的真实宇宙学功率谱。第二项 $\\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}}$ 是**泊松散粒噪声**的贡献。它对应于一个振幅为 $1/\\bar{n}$ 的白噪声谱，该谱已被质量分配核滤波。\n\n**第2部分：B样条核的傅里叶变换**\n\n分配核 $w(\\boldsymbol{x})$ 是一个可分离的p阶三维B样条。这意味着 $w(\\boldsymbol{x}) = w_p(x_1) w_p(x_2) w_p(x_3)$，其中 $w_p(x)$ 是p阶一维B样条。p阶B样条是通过将顶帽函数（1阶B样条）与自身进行 $p$ 次卷积来构造的。阶数 $p=1$ 的核（NGP）是一个归一化的顶帽函数：\n$$\nw_1(x) = \\frac{1}{\\Delta} \\quad \\text{for } |x| \\le \\frac{\\Delta}{2}, \\text{ and } 0 \\text{ otherwise.}\n$$\n其一维傅里叶变换是：\n$$\n\\tilde{W}_1(k) = \\int_{-\\infty}^{\\infty} w_1(x) e^{-ikx} dx = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} e^{-ikx} dx = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2}\n$$\np阶B样条的傅里叶变换是1阶变换的 $p$ 次方：\n$$\n\\tilde{W}_p(k) = [\\tilde{W}_1(k)]^p = \\left[ \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\right]^p\n$$\n由于三维核是可分离的，其傅里叶变换是一维变换的乘积：\n$$\n\\tilde{W}(\\boldsymbol{k}) = \\tilde{W}(\\boldsymbol{k}=(k_1,k_2,k_3)) = \\tilde{W}_p(k_1) \\tilde{W}_p(k_2) \\tilde{W}_p(k_3) = \\prod_{j=1}^{3} \\left[ \\frac{\\sin(k_j\\Delta/2)}{k_j\\Delta/2} \\right]^p\n$$\n\n**第3部分：反卷积估计量**\n\n我们寻求一个真实功率谱 $P(\\boldsymbol{k})$ 的估计量 $\\widehat{P}(\\boldsymbol{k})$，它由单次测量 $P_{\\text{meas}}(\\boldsymbol{k})$ 构造并且是无偏的，即 $\\langle \\widehat{P}(\\boldsymbol{k}) \\rangle = P(\\boldsymbol{k})$。从第1部分，我们有期望的关系式：\n$$\n\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle = |\\tilde{W}(\\boldsymbol{k})|^2 P(\\boldsymbol{k}) + \\frac{|\\tilde{W}(\\boldsymbol{k})|^2}{\\bar{n}}\n$$\n我们可以解这个方程得到 $P(\\boldsymbol{k})$：\n$$\nP(\\boldsymbol{k}) = \\frac{\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle}{|\\tilde{W}(\\boldsymbol{k})|^2} - \\frac{1}{\\bar{n}}\n$$\n这表明，我们可以用来自单次实现的实际测量值 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 替换期望值 $\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle$，从而得到 $P(\\boldsymbol{k})$ 的一个估计量：\n$$\n\\widehat{P}(\\boldsymbol{k}) = \\frac{P_{\\mathrm{meas}}(\\boldsymbol{k})}{|\\tilde{W}(\\boldsymbol{k})|^2} - \\frac{1}{\\bar{n}}\n$$\n这个估计量是无偏的，因为 $\\langle \\widehat{P}(\\boldsymbol{k}) \\rangle = \\frac{\\langle P_{\\mathrm{meas}}(\\boldsymbol{k}) \\rangle}{|\\tilde{W}(\\boldsymbol{k})|^2} - \\frac{1}{\\bar{n}} = P(\\boldsymbol{k})$。这个过程包括从测量的功率中反卷积窗函数，并减去（未卷积的）散粒噪声功率。\n\n我们现在代入第2部分中 $|\\tilde{W}(\\boldsymbol{k})|^2$ 的表达式。由于对于实数参数，$\\frac{\\sin(x)}{x}$ 是一个实值函数，所以 $|\\tilde{W}(\\boldsymbol{k})|^2 = (\\tilde{W}(\\boldsymbol{k}))^2$。\n$$\n|\\tilde{W}(\\boldsymbol{k})|^2 = \\left( \\prod_{j=1}^{3} \\left[ \\frac{\\sin(k_j\\Delta/2)}{k_j\\Delta/2} \\right]^p \\right)^2 = \\prod_{j=1}^{3} \\left[ \\frac{\\sin(k_j\\Delta/2)}{k_j\\Delta/2} \\right]^{2p}\n$$\n反卷积估计量的最终闭式表达式为：\n$$\n\\widehat{P}(\\boldsymbol{k}) = \\frac{P_{\\mathrm{meas}}(\\boldsymbol{k})}{\\prod_{j=1}^{3} \\left[ \\frac{\\sin(k_j\\Delta/2)}{k_j\\Delta/2} \\right]^{2p}} - \\frac{1}{\\bar{n}}\n$$\n这是最终的表达式，它在指定假设下，通过校正质量分配窗和泊松散粒噪声，从测量的、网格化的功率谱 $P_{\\mathrm{meas}}(\\boldsymbol{k})$ 中恢复了底层的功率谱 $P(\\boldsymbol{k})$。", "answer": "$$\n\\boxed{\\widehat{P}(\\boldsymbol{k}) = P_{\\mathrm{meas}}(\\boldsymbol{k}) \\left( \\prod_{j=1}^{3} \\left[ \\frac{\\sin(k_j\\Delta/2)}{k_j\\Delta/2} \\right]^{2p} \\right)^{-1} - \\frac{1}{\\bar{n}}}\n$$", "id": "3497535"}, {"introduction": "在焦散区等高度非线性区域，简单的蒙特卡洛图像变得具有挑战性，在这些区域，相空间“薄片”发生折叠，空间密度在形式上发散。这个高级问题使用一个简化的1D模型来探讨这个关键问题。你将推导焦散区的密度轮廓，然后研究一种常用估计量——核密度估计（KDE）的性能如何依赖于粒子数$N$和核带宽$h$之间的相互作用，揭示了为解析此类奇异结构所需的特殊处理方法。[@problem_id:3497486]", "problem": "一个一维相空间叶由单一的拉格朗日参数 $q \\in [-Q,Q]$ 指定，其到欧拉相空间 $(x,v)$ 的映射由 $x(q) = q^{2}$ 和 $v(q) = q$ 给出。该叶代表一个冷的无碰撞分布，其单位拉格朗日坐标的质量为常数 $m_{0}$，因此相空间分布函数 (DF) $f(x,v)$ 的支撑集为参数曲线 $(x(q),v(q))$。考虑在 $x=0$ 处产生的折叠焦散，此处的空间密度是发散的。\n\n您的任务是：\n- 从第一性原理出发，推导由映射 $x(q) = q^{2}$，$v(q) = q$ 生成的相空间分布函数 $f(x,v)$ 和欧拉空间密度 $\\rho(x)$ 的精确表达式。仅使用无碰撞流的分布函数定义、狄拉克 $\\delta$ 分布的性质以及变量替换法则。\n- 当相空间叶通过在 $q \\in [-Q,Q]$ 区间内均匀进行蒙特卡洛 (MC) 采样生成 $N$ 个粒子时，推导在焦散位置 $x_{0}=0$ 处对 $\\rho(x)$ 进行核密度估计 (KDE) 的期望值和方差。使用带宽为 $h$ 的帽形核函数 $K_{h}$，其定义为：当 $|x-x_{0}| \\le h/2$ 时，$K_{h}(x-x_{0}) = \\frac{1}{h}$，否则 $K_{h}(x-x_{0})=0$。假设估计量为 $\\hat{\\rho}_{h}(x_{0}) = \\frac{1}{h} \\sum_{i=1}^{N} w \\, \\mathbb{I}(|x_{i}-x_{0}| \\le h/2)$，其中粒子质量为 $w = \\frac{M}{N}$，总质量为 $M = \\int_{-Q}^{Q} m_{0} \\, dq = 2 Q m_{0}$。量化变异系数 $\\mathrm{CV} = \\sqrt{\\mathrm{Var}[\\hat{\\rho}_{h}(x_{0})]}/\\mathbb{E}[\\hat{\\rho}_{h}(x_{0})]$，并推导在存在焦散的情况下，为使 $\\mathrm{CV}$ 在 $N \\to \\infty$ 时保持有界，带宽 $h$ 必须如何随 $N$ 缩放。\n- 实现一个确定性的蒙特卡洛实验来检验在 $x_{0}=0$ 处的标度律。在每个测试案例中，通过在 $[-Q,Q]$ 区间内均匀采样 $q$ 来生成 $N$ 个粒子，将其映射到 $x=q^{2}$，并在 $x_{0}=0$ 处评估帽形核密度估计。使用不同的固定种子，对该实验进行固定次数的重复，计算经验变异系数 $\\mathrm{CV}_{\\mathrm{emp}}$，并与阈值 $\\tau=0.25$ 进行比较。报告该标度选择是否满足 $\\mathrm{CV}_{\\mathrm{emp}} \\le \\tau$。\n\n假设使用无量纲单位，其中 $m_{0}=1$ 且 $Q=1$。使用与角度无关的量。程序必须是自包含的，并通过以可复现的方式为随机数生成器设置种子来产生确定性的结果。\n\n测试套件：\n- 案例 1 (理想路径)：$N=4000$，带宽 $h=c N^{-\\alpha}$，其中 $\\alpha=2$ 且 $c=512$，重复次数 $R=200$，阈值 $\\tau=0.25$。此案例测试了临界标度关系，预期该关系会使 $\\mathrm{CV}$ 随 $N$ 的变化大致保持恒定。\n- 案例 2 (良好解析)：$N=4000$，带宽 $h=c N^{-\\alpha}$，其中 $\\alpha=0.5$ 且 $c=8$，重复次数 $R=200$，阈值 $\\tau=0.25$。此案例测试了较慢的带宽收缩，预期会降低 $\\mathrm{CV}$。\n- 案例 3 (边缘情况失败)：$N=4000$，带宽 $h=c N^{-\\alpha}$，其中 $\\alpha=2.5$ 且 $c=512$，重复次数 $R=200$，阈值 $\\tau=0.25$。此案例测试了过于激进的带宽收缩，预期会增加 $\\mathrm{CV}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个条目都是一个布尔值，表示相应测试案例是否满足 $\\mathrm{CV}_{\\mathrm{emp}} \\le \\tau$，顺序与三个案例的顺序一致。例如，预期的格式是 $[b_{1},b_{2},b_{3}]$，其中每个 $b_{i}$ 是 $True$ 或 $False$。", "solution": "该问题分三个阶段解决。首先，从第一性原理出发，推导相空间分布函数（$DF$）及其对应空间密度的精确解析形式。其次，对所提出的核密度估计（KDE）方法进行统计分析，以理解其行为，尤其是在焦散处的行为。该分析得出了核带宽 $h$ 作为粒子数 $N$ 的函数的理论标度律。最后，设计一个数值算法来实现蒙特卡洛实验，以根据提供的测试案例检验此推导出的标度律。\n\n**第 1 部分：解析推导**\n\n该系统描述了一个一维、冷、无碰撞的叶。叶上任意一点的状态由单一的拉格朗日坐标 $q \\in [-Q, Q]$ 参数化。从该拉格朗日坐标到欧拉相空间 $(x, v)$ 的映射由 $x(q) = q^2$ 和 $v(q) = q$ 给出。单位拉格朗日坐标的质量是一个常数 $m_0$。\n\n对于这样一个连续的叶，其相空间分布函数 $f(x,v)$ 可以表示为对拉格朗日参数 $q$ 的积分。它仅在由映射指定的曲线 $(x(q), v(q))$ 上非零：\n$$f(x,v) = \\int_{-Q}^{Q} m_0 \\, \\delta(x - x(q)) \\, \\delta(v - v(q)) \\, dq$$\n其中 $\\delta(\\cdot)$ 是狄拉克 $\\delta$ 分布。代入给定的映射 $x(q) = q^2$ 和 $v(q) = q$：\n$$f(x,v) = \\int_{-Q}^{Q} m_0 \\, \\delta(x - q^2) \\, \\delta(v - q) \\, dq$$\n由于存在 $\\delta(v-q)$ 项，它强制 $q=v$，因此对 $q$ 的积分得以简化。利用狄拉克 $\\delta$ 分布的筛选性质，我们得到：\n$$f(x,v) = m_0 \\, \\delta(x - v^2)$$\n该表达式仅在 $q=v$ 的值位于积分限内，即 $v \\in [-Q, Q]$ 时有效。在此速度范围之外，分布函数为零。因此，完整的表达式是：\n$$f(x,v) = m_0 \\, \\delta(x - v^2) \\, \\mathbb{I}(v \\in [-Q, Q])$$\n其中 $\\mathbb{I}(\\cdot)$ 是指示函数。问题陈述 $m_0=1$ 和 $Q=1$，可将其简化为 $f(x,v) = \\delta(x - v^2) \\, \\mathbb{I}(v \\in [-1, 1])$。该分布函数的支撑集是当 $v \\in [-1, 1]$ 时的抛物线 $x=v^2$。\n\n欧拉空间密度 $\\rho(x)$ 是分布函数对所有速度的积分：\n$$\\rho(x) = \\int_{-\\infty}^{\\infty} f(x,v) \\, dv = \\int_{-1}^{1} m_0 \\, \\delta(x - v^2) \\, dv$$\n为了计算这个积分，我们使用狄拉克 $\\delta$ 分布的复合函数性质：$\\delta(g(v)) = \\sum_i \\frac{\\delta(v - v_i)}{|g'(v_i)|}$，其中 $v_i$ 是 $g(v)=0$ 的单根。这里，$g(v) = x - v^2$。其根为 $v = \\pm\\sqrt{x}$，当 $x > 0$ 时，它们是实数且不相等。导数为 $g'(v) = -2v$，因此 $|g'(v)| = 2|v|$。在根处， $|g'(\\pm\\sqrt{x})| = 2\\sqrt{x}$。\n因此，对于 $x > 0$：\n$$\\delta(x - v^2) = \\frac{\\delta(v - \\sqrt{x})}{2\\sqrt{x}} + \\frac{\\delta(v + \\sqrt{x})}{2\\sqrt{x}}$$\n将此代入 $\\rho(x)$ 的表达式中：\n$$\\rho(x) = \\int_{-1}^{1} m_0 \\left( \\frac{\\delta(v - \\sqrt{x})}{2\\sqrt{x}} + \\frac{\\delta(v + \\sqrt{x})}{2\\sqrt{x}} \\right) dv$$\n只有当根 $v = \\pm\\sqrt{x}$ 位于积分域 $[-1, 1]$ 内时，积分才非零。如果 $\\sqrt{x} \\le 1$，即 $0  x \\le 1$，则满足此条件。对于这个 $x$ 的范围，两个 $\\delta$ 函数都对积分有贡献：\n$$\\rho(x) = \\frac{m_0}{2\\sqrt{x}} \\left( \\int_{-1}^{1} \\delta(v - \\sqrt{x}) \\, dv + \\int_{-1}^{1} \\delta(v + \\sqrt{x}) \\, dv \\right) = \\frac{m_0}{2\\sqrt{x}} (1 + 1) = \\frac{m_0}{\\sqrt{x}}$$\n对于 $x \\le 0$ 或 $x > 1$，$\\rho(x)=0$。当 $m_0=1$ 时，密度的最终表达式为 $\\rho(x) = 1/\\sqrt{x}$，其中 $x \\in (0, 1]$。当 $x \\to 0^+$ 时，密度发散，这正是折叠焦散的位置。\n\n**第 2 部分：KDE 的统计分析**\n\n问题定义了在 $x_0=0$ 处的 KDE 密度估计量：\n$$\\hat{\\rho}_{h}(0) = \\frac{1}{h} \\sum_{i=1}^{N} w \\, \\mathbb{I}(|x_{i}| \\le h/2)$$\n其中 $w = M/N = 2Qm_0/N$ 是粒子质量，$x_i = q_i^2$，$q_i$ 是从 $[-Q, Q]$ 区间内均匀采样的。由于 $x_i \\ge 0$，条件 $|x_i| \\le h/2$ 简化为 $0 \\le x_i \\le h/2$，这等价于 $q_i^2 \\le h/2$，即 $|q_i| \\le \\sqrt{h/2}$。\n\n令 $Y_i = \\mathbb{I}(|q_i| \\le \\sqrt{h/2})$ 为一个伯努利随机变量。其成功概率 $p$ 是区间 $[-\\sqrt{h/2}, \\sqrt{h/2}]$ 的长度与采样域 $[-Q, Q]$ 长度之比，假设 $\\sqrt{h/2} \\le Q$：\n$$p = P(|q_i| \\le \\sqrt{h/2}) = \\frac{2\\sqrt{h/2}}{2Q} = \\frac{\\sqrt{h}}{\\sqrt{2}Q}$$\n箱中的粒子数 $K = \\sum_{i=1}^{N} Y_i$ 服从二项分布 $B(N, p)$。估计量为 $\\hat{\\rho}_h(0) = \\frac{w}{h} K = \\frac{M}{Nh} K$。\n\n该估计量的期望值为：\n$$\\mathbb{E}[\\hat{\\rho}_{h}(0)] = \\frac{M}{Nh} \\mathbb{E}[K] = \\frac{M}{Nh} (Np) = \\frac{M}{h} p = \\frac{2Qm_0}{h} \\frac{\\sqrt{h}}{\\sqrt{2}Q} = \\frac{\\sqrt{2}m_0}{\\sqrt{h}}$$\n该估计量的方差为：\n$$\\mathrm{Var}[\\hat{\\rho}_{h}(0)] = \\left(\\frac{M}{Nh}\\right)^2 \\mathrm{Var}[K] = \\frac{M^2}{N^2 h^2} (Np(1-p)) = \\frac{M^2 p(1-p)}{N h^2}$$\n变异系数的平方 $\\mathrm{CV}^2$ 是方差与期望平方之比：\n$$\\mathrm{CV}^2 = \\frac{\\mathrm{Var}[\\hat{\\rho}_{h}(0)]}{(\\mathbb{E}[\\hat{\\rho}_{h}(0)])^2} = \\frac{M^2 p(1-p) / (N h^2)}{(Mp/h)^2} = \\frac{1-p}{Np}$$\n当 $N \\to \\infty$ 时，为了解析结构，带宽 $h \\to 0$，因此 $p \\to 0$ 且 $1-p \\approx 1$。表达式简化为：\n$$\\mathrm{CV}^2 \\approx \\frac{1}{Np} = \\frac{1}{N \\frac{\\sqrt{h}}{\\sqrt{2}Q}} = \\frac{\\sqrt{2}Q}{N\\sqrt{h}}$$\n为使 $\\mathrm{CV}$ 在 $N \\to \\infty$ 时保持有界（即为常数），$N\\sqrt{h}$ 项必须为常数。令 $N\\sqrt{h} = \\text{常数}$。两边平方得到 $N^2 h = \\text{常数}$，这意味着带宽必须满足 $h \\propto N^{-2}$ 的标度关系。\n这种 $h \\propto N^{-2}$ 的标度关系比用于非奇异密度（在1D情况下，为最小化均方积分误差，其关系为 $h \\propto N^{-1/5}$）的标准最优标度关系更为激进，这是焦散处 $x^{-1/2}$ 密度分布的直接结果。\n\n对于所提出的标度关系 $h = c N^{-\\alpha}$，变异系数的行为如下：\n$$\\mathrm{CV} \\approx \\sqrt{\\frac{\\sqrt{2}Q}{N\\sqrt{c N^{-\\alpha}}}} = \\sqrt{\\frac{\\sqrt{2}Q}{N \\cdot c^{1/2} N^{-\\alpha/2}}} = \\sqrt{\\frac{\\sqrt{2}Q}{c^{1/2}} N^{\\frac{\\alpha}{2}-1}}$$\n- 如果 $\\alpha = 2$，$\\mathrm{CV} \\propto N^{1-1} = N^0$，为常数。\n- 如果 $\\alpha  2$ (例如 $\\alpha=0.5$)，$\\mathrm{CV} \\propto N^{0.25-1} = N^{-0.75}$，随 $N \\to \\infty$ 而减小。\n- 如果 $\\alpha > 2$ (例如 $\\alpha=2.5$)，$\\mathrm{CV} \\propto N^{1.25-1} = N^{0.25}$，随 $N \\to \\infty$ 而发散。\n这些理论预测与三个测试案例的预期相符。\n\n**第 3 部分：数值实验的算法设计**\n\n数值实验用于验证推导出的标度律。对于每个测试案例，算法按以下步骤进行：\n1.  初始化参数：粒子数 $N$、标度参数 $c$ 和 $\\alpha$、重复次数 $R$ 和阈值 $\\tau$。设置物理常数 $m_0=1$ 和 $Q=1$。\n2.  计算相关量：总质量 $M=2Qm_0=2$、粒子质量 $w=M/N$ 和带宽 $h=c N^{-\\alpha}$。\n3.  执行一个从 $r=1$ 到 $R$ 的循环，以进行重复实验：\n    a. 为每次重复实验设置一个唯一但确定性的随机数生成器种子（例如 `master_seed + r`），以确保可复现性。\n    b. 通过在 $[-Q, Q]$ 上进行均匀分布抽样，生成 $N$ 个拉格朗日坐标 $q_i$。\n    c. 将这些坐标转换为欧拉位置：$x_i = q_i^2$。\n    d. 统计落在 $x_0=0$ 处 KDE 箱内的粒子数 $K_r$，即满足 $0 \\le x_i \\le h/2$ 的粒子数。\n    e. 计算该次重复实验的密度估计值：$\\hat{\\rho}_{h,r}(0) = \\frac{w}{h} K_r$。\n    f. 存储该估计值 $\\hat{\\rho}_{h,r}(0)$。\n4.  所有重复实验完成后，根据存储的 $R$ 个估计值计算经验统计量：\n    a. 经验均值：$\\bar{\\rho} = \\frac{1}{R} \\sum_{r=1}^{R} \\hat{\\rho}_{h,r}(0)$。\n    b. 经验样本方差：$s^2 = \\frac{1}{R-1} \\sum_{r=1}^{R} (\\hat{\\rho}_{h,r}(0) - \\bar{\\rho})^2$。\n    c. 经验变异系数：$\\mathrm{CV}_{\\mathrm{emp}} = s / \\bar{\\rho}$。\n5.  将结果与阈值进行比较：确定是否满足 $\\mathrm{CV}_{\\mathrm{emp}} \\le \\tau$。\n6.  收集三个测试案例的布尔结果，并按要求格式打印。此过程系统地检验了理论标度预测。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running a deterministic Monte Carlo experiment\n    for three specified test cases to validate the scaling law of KDE at a caustic.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path): N=4000, alpha=2.0, c=512, R=200, tau=0.25\n        {'N': 4000, 'alpha': 2.0, 'c': 512.0, 'R': 200, 'tau': 0.25},\n        # Case 2 (well-resolved): N=4000, alpha=0.5, c=8, R=200, tau=0.25\n        {'N': 4000, 'alpha': 0.5, 'c': 8.0, 'R': 200, 'tau': 0.25},\n        # Case 3 (edge-case failure): N=4000, alpha=2.5, c=512, R=200, tau=0.25\n        {'N': 4000, 'alpha': 2.5, 'c': 512.0, 'R': 200, 'tau': 0.25},\n    ]\n\n    results = []\n\n    # A master seed for overall reproducibility of the experiment\n    master_seed = 0\n\n    for case in test_cases:\n        N = case['N']\n        alpha = case['alpha']\n        c = case['c']\n        R = case['R']\n        tau = case['tau']\n        \n        # Physical constants from the problem description\n        m0 = 1.0\n        Q = 1.0\n        \n        # Total mass of the system\n        M = 2.0 * Q * m0\n        # Mass per Monte Carlo particle\n        w = M / N\n        \n        # KDE bandwidth, calculated from the scaling law h = c * N^(-alpha)\n        h = c * (N ** (-alpha))\n        \n        # The location of the caustic where density is estimated\n        x0 = 0.0\n        \n        # Array to store the density estimates from each replicate\n        rho_estimates = np.zeros(R)\n        \n        for r in range(R):\n            # Create a new Random Number Generator for each replicate with a deterministic seed.\n            # This ensures each replicate is statistically independent but the entire experiment\n            # is reproducible.\n            rng = np.random.default_rng(master_seed + r)\n            \n            # Step 1: Generate N particles by sampling the Lagrangian parameter q uniformly in [-Q, Q]\n            q_particles = rng.uniform(-Q, Q, size=N)\n            \n            # Step 2: Map to Eulerian position x using x(q) = q^2\n            x_particles = q_particles**2\n            \n            # Step 3: Evaluate the top-hat Kernel Density Estimator at x0 = 0.\n            # The kernel support is |x_i - x_0| = h/2.\n            # Since x0=0 and x_i are non-negative, this simplifies to 0 = x_i = h/2.\n            \n            # Count the number of particles falling within the kernel's support region\n            count_in_bin = np.sum(x_particles = h / 2.0)\n            \n            # Calculate the density estimate for this replicate using the formula:\n            # rho_hat = (1/h) * sum(w * I(...)) = (w/h) * count_in_bin\n            if h > 0:\n                rho_hat_r = (w / h) * count_in_bin\n                rho_estimates[r] = rho_hat_r\n            else: # If bandwidth is zero, estimate is ill-defined, treat as zero\n                rho_estimates[r] = 0.0\n\n        # Step 4: After all replicates, compute empirical statistics\n        if R > 1:\n            # Empirical mean of the density estimates\n            mean_rho = np.mean(rho_estimates)\n            \n            # Empirical sample variance (using ddof=1 for an unbiased estimator)\n            var_rho = np.var(rho_estimates, ddof=1)\n            \n            # Empirical Coefficient of Variation (CV)\n            # Avoid division by zero if the mean estimate is close to zero\n            if mean_rho > 1e-12:\n                cv_emp = np.sqrt(var_rho) / mean_rho\n            else:\n                # If mean is zero, variance is zero, CV is ill-defined or 0.\n                # In a noisy context, could be considered infinite. Let's use 0.\n                cv_emp = 0.0\n        else: # Handle the case of a single replicate (no variation)\n            cv_emp = 0.0\n\n        # Step 5: Compare the empirical CV against the threshold and store the boolean result\n        results.append(cv_emp = tau)\n        \n    # Print the final results in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3497486"}]}