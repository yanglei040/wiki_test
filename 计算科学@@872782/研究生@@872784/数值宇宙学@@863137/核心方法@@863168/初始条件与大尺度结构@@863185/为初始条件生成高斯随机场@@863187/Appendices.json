{"hands_on_practices": [{"introduction": "要理解宇宙大尺度结构，关键在于连接其统计描述（功率谱 $P(k)$）和更直观的物理量（例如在特定尺度上的物质密度涨落）。这项练习将指导你推导无量纲功率谱 $\\Delta^2(k)$，并计算一个经过平滑处理的密度场的方差 $\\sigma^2(R)$。通过这个过程，你将掌握如何在傅里叶空间中的抽象统计量与实空间中可观测的密度涨落方差之间建立联系，并熟练进行宇宙学中常见的单位跟踪和量纲分析 [@problem_id:3473819]。", "problem": "考虑一个在共动坐标系下的统计均匀且各向同性的高斯物质过密场 $\\delta(\\mathbf{x})$，该场用于在数值宇宙学中生成初始条件。设傅里叶变换约定为 $\\delta(\\mathbf{x}) = \\int \\frac{d^{3}k}{(2\\pi)^{3}}\\,\\delta(\\mathbf{k})\\,\\exp(i\\,\\mathbf{k}\\cdot\\mathbf{x})$，并通过两点函数 $\\langle \\delta(\\mathbf{k})\\,\\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3}\\,\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')\\,P(k)$ 定义功率谱 $P(k)$，其中 $\\delta_{\\mathrm{D}}$ 表示狄拉克 delta 分布。在此背景下，波数 $k$ 的单位是 $h/\\mathrm{Mpc}$，$P(k)$ 的单位是 $(\\mathrm{Mpc}/h)^{3}$。\n\n你用一个实空间中的球对称高斯窗函数对该场进行平滑，其傅里叶空间形式为 $W(kR) = \\exp\\!\\left(-\\frac{(kR)^{2}}{2}\\right)$，其中平滑尺度 $R$ 的单位是 $\\mathrm{Mpc}/h$。平滑方差定义为 $\\sigma^{2}(R) \\equiv \\langle \\delta_{R}^{2} \\rangle$，其中 $\\delta_{R}$ 是平滑场。\n\n从上述核心定义和傅里叶变换约定出发，完成以下任务：\n\n- 从第一性原理出发，推导每个对数波数间隔 $k$ 对 $\\sigma^{2}$ 贡献的表达式，并由此获得每个对数间隔的无量纲功率 $\\Delta^{2}(k)$。请仔细追踪单位，解释单位为 $(\\mathrm{Mpc}/h)^{3}$ 的 $P(k)$ 和单位为 $h/\\mathrm{Mpc}$ 的 $k$ 如何结合产生无量纲的 $\\Delta^{2}(k)$。\n- 对于玩具各向同性功率谱 $P(k) = A\\,\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right)$，其中 $A = 4.0\\times 10^{3}\\,(\\mathrm{Mpc}/h)^{3}$，截断波数 $k_c = 5\\,h/\\mathrm{Mpc}$，使用上面的高斯窗函数 $W(kR)$ 在平滑尺度 $R = 5\\,\\mathrm{Mpc}/h$ 处计算平滑方差 $\\sigma^{2}(R)$。你的推导必须明确显示单位在积分过程中如何传递，从而得到无量纲的 $\\sigma^{2}(R)$。\n\n将你计算出的 $\\sigma^{2}(R)$ 的最终数值结果四舍五入到四位有效数字。将你的最终答案表示为一个纯数（无量纲）。", "solution": "用户希望我根据指定规则验证问题陈述。\n\n### 步骤 1：提取给定条件\n- 场：统计上均匀且各向同性的高斯物质过密场 $\\delta(\\mathbf{x})$。\n- 傅里叶变换约定：$\\delta(\\mathbf{x}) = \\int \\frac{d^{3}k}{(2\\pi)^{3}}\\,\\delta(\\mathbf{k})\\,\\exp(i\\,\\mathbf{k}\\cdot\\mathbf{x})$。\n- 功率谱定义：$\\langle \\delta(\\mathbf{k})\\,\\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3}\\,\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')\\,P(k)$。\n- 波数单位：$k$ 的单位是 $h/\\mathrm{Mpc}$。\n- 功率谱单位：$P(k)$ 的单位是 $(\\mathrm{Mpc}/h)^{3}$。\n- 傅里叶空间高斯窗函数：$W(kR) = \\exp\\!\\left(-\\frac{(kR)^{2}}{2}\\right)$。\n- 平滑尺度单位：$R$ 的单位是 $\\mathrm{Mpc}/h$。\n- 平滑方差定义：$\\sigma^{2}(R) \\equiv \\langle \\delta_{R}^{2} \\rangle$，其中 $\\delta_{R}$ 是平滑场。\n- 用于计算的玩具功率谱：$P(k) = A\\,\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right)$。\n- 常数 $A$：$A = 4.0\\times 10^{3}\\,(\\mathrm{Mpc}/h)^{3}$。\n- 截断波数 $k_c$：$k_{c} = 5\\,h/\\mathrm{Mpc}$。\n- 用于计算的平滑尺度 $R$：$R = 5\\,\\mathrm{Mpc}/h$。\n\n### 步骤 2：使用提取的给定条件进行验证\n- **有科学依据：** 该问题使用了宇宙学大尺度结构理论中的标准定义和形式体系。高斯随机场、其功率谱、傅里叶变换以及使用窗函数进行平滑等概念，是生成宇宙学模拟初始条件的基础。所提供的单位是该领域的常规单位。整个设置在科学上是合理的。\n- **适定的：** 问题陈述清晰，提供了所有必要的定义、常数和函数形式。推导和具体计算这两个任务都定义明确。所涉及的积分是标准的高斯积分，它们是收敛的，并能导出一个唯一且有意义的解。\n- **客观的：** 问题使用精确、客观和形式化的科学语言进行陈述。没有主观或基于观点的元素。\n- **完整性和一致性：** 问题是自洽的。所有需要的变量和常数都已定义并提供了它们的值。单位是一致的：例如，窗函数的参数 $kR$ 是无量纲的，因为 $[k]=L^{-1}$ 且 $[R]=L$，其中长度单位为 $L=\\mathrm{Mpc}/h$。乘积 $k^3 P(k)$ 也是无量纲的：$[k^3 P(k)] = (h/\\mathrm{Mpc})^3 (\\mathrm{Mpc}/h)^3 = 1$。不存在矛盾之处。\n\n### 步骤 3：结论与行动\n该问题是有效的。它在科学上是合理的，问题是适定的，并且所有必要信息都已一致地提供。我现在将着手解决。\n\n按照要求，解答分为两部分：首先，推导无量纲功率谱 $\\Delta^2(k)$；其次，计算平滑方差 $\\sigma^2(R)$。\n\n**第一部分：无量纲功率谱 $\\Delta^2(k)$ 的推导**\n\n平滑过密场 $\\delta_R(\\mathbf{x})$ 是通过将场 $\\delta(\\mathbf{x})$ 与一个实空间窗函数进行卷积得到的。在傅里叶空间中，这个卷积变成了一个乘法。平滑场的傅里叶变换是：\n$$ \\delta_R(\\mathbf{k}) = \\delta(\\mathbf{k}) W(kR) $$\n平滑方差定义为 $\\sigma^2(R) \\equiv \\langle \\delta_R^2(\\mathbf{x}) \\rangle$。由于统计均匀性，这个量与位置 $\\mathbf{x}$ 无关，所以我们可以方便地在 $\\mathbf{x} = 0$ 处计算它。因为场 $\\delta(\\mathbf{x})$ 是实数，所以平滑场 $\\delta_R(\\mathbf{x})$ 也是实数，我们可以写成 $\\delta_R^2 = \\delta_R \\delta_R^*$。\n$$ \\sigma^2(R) = \\langle \\delta_R(0)^2 \\rangle = \\langle \\delta_R(0) \\delta_R^*(0) \\rangle $$\n我们用其傅里叶变换来表示 $\\delta_R(0)$：\n$$ \\delta_R(0) = \\int \\frac{d^3k}{(2\\pi)^3} \\delta_R(\\mathbf{k}) = \\int \\frac{d^3k}{(2\\pi)^3} \\delta(\\mathbf{k}) W(kR) $$\n将此代入方差的表达式中：\n$$ \\sigma^2(R) = \\left\\langle \\left( \\int \\frac{d^3k}{(2\\pi)^3} \\delta(\\mathbf{k}) W(kR) \\right) \\left( \\int \\frac{d^3k'}{(2\\pi)^3} \\delta(\\mathbf{k}') W(k'R) \\right)^* \\right\\rangle $$\n窗函数 $W(kR)$ 是实数。复共轭作用于 $\\delta(\\mathbf{k}')$。\n$$ \\sigma^2(R) = \\int \\frac{d^3k}{(2\\pi)^3} \\int \\frac{d^3k'}{(2\\pi)^3} \\langle \\delta(\\mathbf{k}) \\delta^*(\\mathbf{k}') \\rangle W(kR) W(k'R) $$\n我们使用功率谱的定义，$\\langle \\delta(\\mathbf{k})\\,\\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3}\\,\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')\\,P(k)$：\n$$ \\sigma^2(R) = \\int \\frac{d^3k}{(2\\pi)^3} \\int \\frac{d^3k'}{(2\\pi)^3} (2\\pi)^3 \\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}') P(k) W(kR) W(k'R) $$\n对 $\\mathbf{k}'$ 的积分通过狄拉克 delta 函数 $\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')$ 计算，它使得 $\\mathbf{k}' = \\mathbf{k}$：\n$$ \\sigma^2(R) = \\int \\frac{d^3k}{(2\\pi)^3} P(k) |W(kR)|^2 $$\n为了继续计算，我们在傅里叶空间中切换到球坐标系，其中 $d^3k = k^2 dk \\, d\\Omega = k^2 dk \\sin\\theta d\\theta d\\phi$。由于被积函数只依赖于模 $k = |\\mathbf{k}|$，对立体角 $d\\Omega$ 的积分得出 $4\\pi$。\n$$ \\sigma^2(R) = \\int_0^\\infty \\frac{4\\pi k^2}{(2\\pi)^3} P(k) |W(kR)|^2 dk = \\int_0^\\infty \\frac{k^2 P(k)}{2\\pi^2} |W(kR)|^2 dk $$\n为了找到每个对数间隔的贡献，我们将积分变量从 $k$ 变为 $\\ln k$。令 $u = \\ln k$，则 $k = \\exp(u)$ 且 $dk = k \\, d(\\ln k)$。\n$$ \\sigma^2(R) = \\int_{-\\infty}^\\infty \\frac{k^2 P(k)}{2\\pi^2} |W(kR)|^2 \\cdot (k \\, d(\\ln k)) = \\int_{-\\infty}^\\infty \\left[ \\frac{k^3 P(k)}{2\\pi^2} |W(kR)|^2 \\right] d(\\ln k) $$\n方括号中的项是每个对数间隔 $k$ 对总方差的贡献。每个对数间隔的无量纲功率，记为 $\\Delta^2(k)$，通常定义为在没有平滑（即窗函数 $W=1$）情况下的此贡献。\n$$ \\Delta^2(k) \\equiv \\frac{k^3 P(k)}{2\\pi^2} $$\n让我们分析一下单位。波数 $k$ 的单位是 $[k] = h/\\mathrm{Mpc}$，功率谱 $P(k)$ 的单位是 $[P(k)] = (\\mathrm{Mpc}/h)^3$。因子 $2\\pi^2$ 是无量纲的。\n$$ [\\Delta^2(k)] = [k]^3 [P(k)] = \\left(\\frac{h}{\\mathrm{Mpc}}\\right)^3 \\left(\\frac{\\mathrm{Mpc}}{h}\\right)^3 = 1 $$\n因此，$\\Delta^2(k)$ 是一个无量纲的量。\n\n**第二部分：平滑方差 $\\sigma^2(R)$ 的计算**\n\n我们使用推导出的 $\\sigma^2(R)$ 的积分表达式：\n$$ \\sigma^2(R) = \\int_0^\\infty \\frac{k^2 P(k)}{2\\pi^2} |W(kR)|^2 dk $$\n给定玩具功率谱 $P(k) = A\\,\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right)$ 和高斯窗函数 $W(kR) = \\exp\\!\\left(-\\frac{(kR)^{2}}{2}\\right)$。窗函数的模平方是 $|W(kR)|^2 = \\exp(-(kR)^2)$。\n将这些代入积分中：\n$$ \\sigma^2(R) = \\int_0^\\infty \\frac{k^2}{2\\pi^2} \\left( A\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right) \\right) \\exp\\left(-(kR)^2\\right) dk $$\n$$ \\sigma^2(R) = \\frac{A}{2\\pi^2} \\int_0^\\infty k^2 \\exp\\left(-\\frac{k^2}{k_c^2} - k^2 R^2\\right) dk = \\frac{A}{2\\pi^2} \\int_0^\\infty k^2 \\exp\\left(-k^2 \\left(\\frac{1}{k_c^2} + R^2\\right)\\right) dk $$\n这是一个形式为 $\\int_0^\\infty x^{2n} \\exp(-ax^2) dx$ 的标准高斯积分。当 $n=1$ 时，我们有 $\\int_0^\\infty x^2 \\exp(-ax^2) dx = \\frac{\\sqrt{\\pi}}{4a^{3/2}}$。\n在我们的例子中，积分变量是 $k$，系数 $a$ 是：\n$$ a = \\frac{1}{k_c^2} + R^2 $$\n该积分的计算结果为 $\\frac{\\sqrt{\\pi}}{4a^{3/2}}$。代入这个结果：\n$$ \\sigma^2(R) = \\frac{A}{2\\pi^2} \\left( \\frac{\\sqrt{\\pi}}{4a^{3/2}} \\right) = \\frac{A}{8\\pi^{3/2}} a^{-3/2} = \\frac{A}{8\\pi^{3/2}} \\left(\\frac{1}{k_c^2} + R^2\\right)^{-3/2} $$\n这个 $\\sigma^2(R)$ 的表达式是无量纲的，因为 $A$ 的单位是 $(\\mathrm{Mpc}/h)^3$，而 $a^{3/2}$ 的单位是 $((\\mathrm{Mpc}/h)^2)^{3/2} = (\\mathrm{Mpc}/h)^3$。\n\n现在我们代入给定的数值：\n$A = 4.0 \\times 10^3 \\, (\\mathrm{Mpc}/h)^3$\n$k_c = 5 \\, h/\\mathrm{Mpc}$\n$R = 5 \\, \\mathrm{Mpc}/h$\n\n首先，我们计算项 $a$：\n$$ a = \\frac{1}{(5 \\, h/\\mathrm{Mpc})^2} + (5 \\, \\mathrm{Mpc}/h)^2 = \\left(\\frac{1}{25} + 25\\right) (\\mathrm{Mpc}/h)^2 = (0.04 + 25) \\, (\\mathrm{Mpc}/h)^2 = 25.04 \\, (\\mathrm{Mpc}/h)^2 $$\n现在我们计算 $\\sigma^2(R)$：\n$$ \\sigma^2(R) = \\frac{4.0 \\times 10^3}{8\\pi^{3/2}} (25.04)^{-3/2} = \\frac{500}{\\pi^{3/2}} (25.04)^{-3/2} $$\n对该表达式进行数值计算：\n$$ \\pi^{3/2} \\approx 5.568328 $$\n$$ (25.04)^{-3/2} \\approx (125.30015)^{-1} \\approx 0.007980824 $$\n$$ \\sigma^2(R) \\approx \\frac{500}{5.568328} \\times 0.007980824 \\approx 89.79351 \\times 0.007980824 \\approx 0.7166336 $$\n四舍五入到四位有效数字，我们得到 $0.7166$。", "answer": "$$\\boxed{0.7166}$$", "id": "3473819"}, {"introduction": "将连续的理论模型转化为在计算机上运行的离散算法，是数值宇宙学的核心挑战之一。在生成高斯随机场时，我们必须确保最终得到的实空间密度场 $\\delta(\\mathbf{x})$ 是实数，这就对其傅里叶模式 $\\delta_{\\mathbf{k}}$ 施加了厄米对称性（Hermitian symmetry）的约束。这项练习将引导你处理离散网格上满足自共轭条件 ($\\mathbf{k} \\equiv -\\mathbf{k}$) 的特殊模式，并推导其正确的采样方差，这是编写正确且物理上自洽的初始条件生成代码的关键一步 [@problem_id:3473758]。", "problem": "您正在为一个统计均匀且各向同性的高斯密度对比场 $\\delta(\\mathbf{x})$ 生成初始条件。该场存在于一个边长为 $L$、体积为 $V=L^{3}$ 的周期性立方盒子中，并在一个 $N\\times N\\times N$ 的网格上进行采样，其中 $N$ 为偶数。允许的离散波矢为 $\\mathbf{k}=\\frac{2\\pi}{L}(n_{x},n_{y},n_{z})$，其中整数索引 $n_{i}\\in\\{0,1,\\dots,N-1\\}$，为了方便记录厄米对称性，这些索引可以映射到对称集合 $n_{i}\\in\\{-\\frac{N}{2}+1,\\dots,\\frac{N}{2}\\}$。定义离散傅里叶变换为\n$$\n\\delta(\\mathbf{x})=\\frac{1}{V}\\sum_{\\mathbf{k}}\\delta_{\\mathbf{k}}\\exp(i\\mathbf{k}\\cdot\\mathbf{x}),\\qquad \\delta_{\\mathbf{k}}=\\int_{V}\\delta(\\mathbf{x})\\exp(-i\\mathbf{k}\\cdot\\mathbf{x})\\,d^{3}x.\n$$\n假设以下经过充分检验的统计事实成立：\n- 场 $\\delta(\\mathbf{x})$ 是实数场，因此它满足厄米约束 $\\delta_{-\\mathbf{k}}=\\delta_{\\mathbf{k}}^{\\ast}$。\n- 两点统计量由功率谱 $P(k)$ 通过以下关系表征：\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}'}^{\\ast}\\rangle=V\\,P(k)\\,\\delta_{\\mathbf{k},\\mathbf{k}'},\n$$\n其中 $\\delta_{\\mathbf{k},\\mathbf{k}'}$ 是克罗内克δ函数，且 $k=|\\mathbf{k}|$。\n\n在偶数网格上，存在特殊的自共轭模式，它们满足 $\\mathbf{k}\\equiv -\\mathbf{k}$（模网格），这种情况当且仅当每个分量索引为 $0$ 或 $N/2$ 时发生。这些模式包括零模式 $\\mathbf{k}=\\mathbf{0}$ 和一个或多个分量处于奈奎斯特索引的奈奎斯特模式。在生成与上述定义一致的高斯随机场时，您必须确保 $\\delta(\\mathbf{x})$ 的实数性以及傅里叶模式的正确高斯统计特性。\n\n从上面给出的定义和事实出发（不使用其他公式），推导为任何非零自共轭模式（即 $\\mathbf{k}\\neq\\mathbf{0}$ 且每个分量为 $0$ 或奈奎斯特波数）的 $\\delta_{\\mathbf{k}}$ 采样所使用的单个实数高斯变量应赋予的正确方差。这样，生成的场才能保持实数性并具有目标功率谱。您的答案需要用 $V$ 和 $P(k)$ 表示为一个闭式解析表达式。您还应在推导过程中论证如何处理零模式以保持一个有物理意义的密度对比度。您的最终答案必须是一个单一的解析表达式。不需要四舍五入，最终表达式中也不应包含单位，因为根据定义 $\\delta$ 是无量纲的。", "solution": "问题陈述已经过仔细验证，并被确定为有效。它在数值宇宙学的原理上具有科学依据，提法恰当、客观且内部一致。所有进行严谨推导所需的信息均已提供。\n\n目标是确定用于采样非零自共轭模式 $\\mathbf{k}$ 的傅里叶模式 $\\delta_{\\mathbf{k}}$ 的实值高斯随机变量的方差。自共轭模式被定义为满足 $\\mathbf{k} \\equiv -\\mathbf{k}$（模网格的倒易矢量）的模式。在一个 $N\\times N\\times N$ 的偶数大小网格上，这些模式的整数索引矢量 $(n_x, n_y, n_z)$ 的每个分量为 $0$ 或 $N/2$。问题要求的是当 $\\mathbf{k} \\neq \\mathbf{0}$ 时这些模式的方差。\n\n我们从密度对比场 $\\delta(\\mathbf{x})$ 及其傅里叶变换 $\\delta_{\\mathbf{k}}$ 的基本性质开始。\n\n首先，场 $\\delta(\\mathbf{x})$ 是一个实值函数。这对它的傅里叶系数施加了厄米对称约束：\n$$\n\\delta_{-\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}\n$$\n其中星号表示复共轭。\n\n其次，高斯随机场的统计特性由功率谱 $P(k)$ 通过傅里叶模式的两点相关函数定义：\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}'}^{\\ast}\\rangle = V\\,P(k)\\,\\delta_{\\mathbf{k},\\mathbf{k}'}\n$$\n其中 $V$ 是盒子的体积，$k=|\\mathbf{k}|$，$\\delta_{\\mathbf{k},\\mathbf{k}'}$ 是克罗内克δ函数。尖括号 $\\langle\\dots\\rangle$ 表示系综平均。\n\n现在我们考虑一个非零自共轭模式 $\\mathbf{k}$。对于这样的模式，波矢 $\\mathbf{k}$ 是其自身的负值（相差一个倒易点阵矢量，这对网格上的离散模式是无关紧要的）。因此，厄米对称约束变为：\n$$\n\\delta_{\\mathbf{k}} = \\delta_{-\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}\n$$\n一个等于其自身共轭的复数必须是纯实数。如果我们将 $\\delta_{\\mathbf{k}}$ 写成其实部和虚部的形式，$\\delta_{\\mathbf{k}} = \\text{Re}(\\delta_{\\mathbf{k}}) + i\\,\\text{Im}(\\delta_{\\mathbf{k}})$，那么条件 $\\delta_{\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}$ 意味着 $\\text{Im}(\\delta_{\\mathbf{k}}) = 0$。因此，对于任何自共轭模式，傅里叶系数 $\\delta_{\\mathbf{k}}$ 都是一个实数。\n\n为了生成该场，我们从一个高斯分布中采样 $\\delta_{\\mathbf{k}}$。由于自共轭模式的 $\\delta_{\\mathbf{k}}$ 必须是实数，所以它是从一个实数高斯分布中抽取的。问题要求的就是这个分布的方差。根据定义，一个零均值随机变量 $X$ 的方差是 $\\langle X^2 \\rangle$。零均值随机场的傅里叶模式也具有零均值，即 $\\langle \\delta_{\\mathbf{k}} \\rangle = 0$。因此，我们需要计算 $\\langle \\delta_{\\mathbf{k}}^2 \\rangle$。\n\n我们将给定的功率谱定义应用于 $\\mathbf{k}' = \\mathbf{k}$ 的特定情况：\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}}^{\\ast}\\rangle = V\\,P(k)\n$$\n由于我们已经确定对于自共轭模式 $\\delta_{\\mathbf{k}}$ 是实数，我们有 $\\delta_{\\mathbf{k}}^{\\ast} = \\delta_{\\mathbf{k}}$。将此代入上式可得：\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}}\\rangle = \\langle \\delta_{\\mathbf{k}}^2 \\rangle = V\\,P(k)\n$$\n这个结果正是在采样模式 $\\delta_{\\mathbf{k}}$ 时所使用的单个实数高斯变量的方差。这对于任何非零自共轭模式都成立。\n\n作为对比，对于一个一般的非自共轭模式 $\\mathbf{k}$（其中 $\\mathbf{k} \\neq -\\mathbf{k}$），$\\delta_{\\mathbf{k}}$ 是一个复数，$\\delta_{\\mathbf{k}} = A_{\\mathbf{k}} + iB_{\\mathbf{k}}$，其中 $A_{\\mathbf{k}}$ 和 $B_{\\mathbf{k}}$ 是独立的实数高斯变量。在这种情况下，$\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}}^{\\ast} \\rangle = \\langle (A_{\\mathbf{k}} + iB_{\\mathbf{k}})(A_{\\mathbf{k}} - iB_{\\mathbf{k}}) \\rangle = \\langle A_{\\mathbf{k}}^2 + B_{\\mathbf{k}}^2 \\rangle$。由于统计各向同性，实部和虚部的方差相等，$\\langle A_{\\mathbf{k}}^2 \\rangle = \\langle B_{\\mathbf{k}}^2 \\rangle$。因此，$2\\langle A_{\\mathbf{k}}^2 \\rangle = V P(k)$，这给出 $\\langle A_{\\mathbf{k}}^2 \\rangle = \\langle B_{\\mathbf{k}}^2 \\rangle = \\frac{1}{2}V P(k)$。赋给一般复数模式的实部和虚部的方差是赋给纯实数自共轭模式方差的一半。\n\n最后，问题要求对零模式 $\\mathbf{k}=\\mathbf{0}$ 的处理方式进行论证。零模式是最基本的自共轭模式。其值由傅里叶变换的定义给出：\n$$\n\\delta_{\\mathbf{k}=\\mathbf{0}} = \\int_{V} \\delta(\\mathbf{x}) \\exp(-i\\mathbf{0} \\cdot \\mathbf{x})\\,d^3x = \\int_{V} \\delta(\\mathbf{x})\\,d^3x\n$$\n这是密度对比场在整个体积上的积分。密度对比度定义为 $\\delta(\\mathbf{x}) = (\\rho(\\mathbf{x}) - \\bar{\\rho})/\\bar{\\rho}$，其中 $\\bar{\\rho}$ 是宇宙的平均密度。根据定义，$\\delta(\\mathbf{x})$ 在一个公平、有代表性的体积上的空间平均值必须为零。我们的模拟盒子被假定为这样一个体积。因此，我们必须强制：\n$$\n\\frac{1}{V}\\int_{V}\\delta(\\mathbf{x})\\,d^3x = 0 \\implies \\int_{V}\\delta(\\mathbf{x})\\,d^3x = 0\n$$\n这意味着 $\\delta_{\\mathbf{k}=\\mathbf{0}}$ 必须根据构造设为 $0$。它不是一个要从分布中抽取的随机变量；它的值是固定的，以保持与密度对比度定义的一致性。这个物理约束就是为什么问题正确地要求计算*非零*自共轭模式的方差。\n\n总之，对于任何非零自共轭模式 $\\mathbf{k}$，其傅里叶系数 $\\delta_{\\mathbf{k}}$ 必须是实数，并且从中抽取它的高斯分布的方差是 $V P(k)$。", "answer": "$$\\boxed{V P(k)}$$", "id": "3473758"}, {"introduction": "在N体模拟中，我们用有限数量的离散粒子来表示连续的暗物质密度场，这种离散化本身会引入统计噪声。这项练习旨在让你从第一性原理出发，推导这种由粒子离散性引起的“散粒噪声”（shot noise）的功率谱。理解并能够量化散粒噪声，对于从模拟数据中准确提取真实的宇宙学信号至关重要，因为在分析功率谱时必须将其作为系统误差进行扣除 [@problem_id:3473824]。", "problem": "考虑一个边长为 $L$ 的周期性立方体区域，用于为 $N$ 个无碰撞暗物质粒子生成宇宙学初始条件。初始粒子分布是从一个空间均匀的泊松点过程中抽样得到的，随后在此基础上施加由高斯随机场产生的相关位移。密度场使用 Cloud-In-Cell (CIC) 质量分配方案在网格上测量，并使用离散傅里叶变换 (DFT) 进行傅里叶变换以估计功率谱。从有限周期性体积 $V$ 中点过程的两点相关函数和功率谱的定义出发，推导由泊松抽样的离散性纯粹产生的对估计功率谱的白噪声贡献的期望振幅。然后，在 $L=1000\\,\\mathrm{Mpc}/h$ 和 $N=512^{3}$ 的情况下计算此振幅。\n\n在你的推导中，仅使用泊松点过程的基本性质和周期性盒子中功率谱的标准定义，并一致地处理网格质量分配和傅里叶变换。最后，讨论在估计用于设置初始条件的高斯随机场的功率谱时，在实践中应如何减去或以其他方式减轻这种离散性贡献，并注意与质量分配窗、混叠和非泊松初始粒子分布相关的任何注意事项。\n\n将离散性（散粒噪声）振幅的最终数值结果以 $(\\mathrm{Mpc}/h)^{3}$ 为单位表示，并四舍五入到四位有效数字。", "solution": "合适的出发点是位于有限周期性体积 $V=L^{3}$ 中的一组 $N$ 个点在位置 $\\{\\mathbf{x}_{i}\\}$ 处的数密度场的定义：\n$$\nn(\\mathbf{x}) \\equiv \\sum_{i=1}^{N} \\delta_{D}(\\mathbf{x}-\\mathbf{x}_{i}),\n$$\n其中 $\\delta_{D}$ 表示 Dirac delta 分布，在均匀过程的实现上对 $n(\\mathbf{x})$ 进行系综平均得到 $\\langle n(\\mathbf{x}) \\rangle = \\bar{n}$，其中 $\\bar{n} \\equiv N/V$ 是平均数密度。超密度场为\n$$\n\\delta(\\mathbf{x}) \\equiv \\frac{n(\\mathbf{x})}{\\bar{n}} - 1.\n$$\n对于周期性盒子中的统计均匀和各向同性场，产生具有体积量纲的功率谱的傅里叶变换约定为\n$$\n\\delta(\\mathbf{k}) \\equiv \\int_{V} d^{3}\\mathbf{x}\\, \\delta(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}), \\quad \\langle \\delta(\\mathbf{k}) \\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3} \\delta_{D}(\\mathbf{k}-\\mathbf{k}') P(\\mathbf{k}),\n$$\n其中 $P(\\mathbf{k})$ 是功率谱。在具有与周期性边界条件兼容的离散波矢量 $\\mathbf{k}$ 的有限盒子中，类似的关系变为\n$$\n\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = V\\, P(\\mathbf{k}).\n$$\n为了与点过程联系起来，我们使用关于连续场泊松抽样的一个经过充分检验的事实：$n(\\mathbf{x})$ 的二阶矩有一个体现离散性的接触项。具体来说，对于没有内禀成团性的均匀泊松点过程，两点函数为\n$$\n\\langle n(\\mathbf{x}) n(\\mathbf{y}) \\rangle = \\bar{n}^{2} + \\bar{n}\\, \\delta_{D}(\\mathbf{x}-\\mathbf{y}).\n$$\n第一项对应于平均密度乘积，而第二项是散粒噪声项。转换到傅里叶空间，我们计算 $\\delta(\\mathbf{k})$ 的两点函数：\n\\begin{align*}\n\\delta(\\mathbf{k}) = \\frac{1}{\\bar{n}} \\int_{V} d^{3}\\mathbf{x}\\, n(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) - \\int_{V} d^{3}\\mathbf{x}\\, \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) \\\\\n= \\frac{1}{\\bar{n}} n(\\mathbf{k}) - (2\\pi)^{3} \\delta_{D}(\\mathbf{k})\\,,\n\\end{align*}\n其中 $n(\\mathbf{k}) \\equiv \\int_{V} d^{3}\\mathbf{x}\\, n(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x})$。对于有限盒子中的非零 $\\mathbf{k}$ 模式，平均模式不存在，我们可以专注于 $\\delta(\\mathbf{k})$ 的方差：\n\\begin{align*}\n\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = \\frac{1}{\\bar{n}^{2}} \\langle |n(\\mathbf{k})|^{2} \\rangle \\\\\n= \\frac{1}{\\bar{n}^{2}} \\int_{V} d^{3}\\mathbf{x} \\int_{V} d^{3}\\mathbf{y}\\, \\langle n(\\mathbf{x}) n(\\mathbf{y}) \\rangle \\exp\\!\\left[-i\\mathbf{k}\\cdot(\\mathbf{x}-\\mathbf{y})\\right] \\\\\n= \\frac{1}{\\bar{n}^{2}} \\left[ \\int_{V} d^{3}\\mathbf{x} \\int_{V} d^{3}\\mathbf{y}\\, \\bar{n}^{2} \\exp\\!\\left[-i\\mathbf{k}\\cdot(\\mathbf{x}-\\mathbf{y})\\right] + \\int_{V} d^{3}\\mathbf{x}\\, \\bar{n} \\right] \\\\\n= \\frac{1}{\\bar{n}^{2}} \\left[ \\bar{n}^{2} \\left| \\int_{V} d^{3}\\mathbf{x}\\, \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) \\right|^{2} + \\bar{n}\\, V \\right].\n\\end{align*}\n对于周期性盒子中的非零 $\\mathbf{k}$ 模式，$\\int_{V} d^{3}\\mathbf{x}\\, \\exp(-i\\mathbf{k}\\cdot\\mathbf{x})=0$，因此第一项消失，剩下\n$$\n\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = \\frac{V}{\\bar{n}}.\n$$\n与有限体积归一化 $\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = V\\, P(\\mathbf{k})$ 相比，散粒噪声贡献是一个与 $k$ 无关的项\n$$\nP_{\\mathrm{shot}} = \\frac{1}{\\bar{n}} = \\frac{V}{N}.\n$$\n这是对连续场进行泊松抽样所增加的期望白噪声底。\n\n我们现在根据给定的参数计算这个值。体积是\n$$\nV = L^{3} = \\left(1000\\,\\mathrm{Mpc}/h\\right)^{3} = 10^{9}\\,(\\mathrm{Mpc}/h)^{3}.\n$$\n粒子数为\n$$\nN = 512^{3} = 134{,}217{,}728.\n$$\n因此，\n$$\nP_{\\mathrm{shot}} = \\frac{V}{N} = \\frac{10^{9}}{134{,}217{,}728}\\,(\\mathrm{Mpc}/h)^{3} \\approx 7.4505805969\\,(\\mathrm{Mpc}/h)^{3}.\n$$\n按要求四舍五入到四位有效数字，结果是\n$$\nP_{\\mathrm{shot}} \\approx 7.451\\,(\\mathrm{Mpc}/h)^{3}.\n$$\n\n最后，我们讨论在实践中如何减去或减轻这种影响。当从通过 Cloud-In-Cell (CIC) 分配到网格的密度场估计功率谱时，测得的功率谱会受到质量分配窗 $W_{\\mathrm{CIC}}(\\mathbf{k})$ 的抑制，并且离散抽样会引起来自奈奎斯特频率之外模式的混叠。测量的谱可以建模为\n$$\nP_{\\mathrm{meas}}(\\mathbf{k}) \\approx |W_{\\mathrm{CIC}}(\\mathbf{k})|^{2} P_{\\mathrm{true}}(\\mathbf{k}) + |W_{\\mathrm{CIC}}(\\mathbf{k})|^{2} P_{\\mathrm{shot}} + P_{\\mathrm{alias}}(\\mathbf{k}),\n$$\n其中 $P_{\\mathrm{alias}}(\\mathbf{k})$ 编码了由于有限抽样导致的重复谱的贡献。为了恢复底层的 $P_{\\mathrm{true}}(\\mathbf{k})$，应该：\n- 通过在可靠处将测量谱除以 $|W_{\\mathrm{CIC}}(\\mathbf{k})|^{2}$ 来对质量分配窗进行反卷积，并在反卷积前减去经过适当窗口化的散粒噪声，即从 $P_{\\mathrm{meas}}(\\mathbf{k})$ 中减去 $|W_{\\mathrm{CIC}}(\\mathbf{k})|^{2} P_{\\mathrm{shot}}$，然后除以 $|W_{\\mathrm{CIC}}(\\mathbf{k})|^{2}$。\n- 通过使用交错和更高阶的分配核（例如 Triangular Shaped Cloud）等技术，并通过将分析限制在远低于奈奎斯特频率的波数来减少混叠。\n- 倾向于使用非泊松初始粒子分布（例如，规则格点或“玻璃”状构型）来抑制低 $k$ 处的散粒噪声。在这种情况下，离散性贡献偏离了简单的白色泊松形式，应考虑初始前粒子排布的特定窗口化谱，而不是减去 $1/\\bar{n}$。\n- 增加 $N$（将 $P_{\\mathrm{shot}}$ 减小为 $V/N$）或使用同一场的独立示踪物之间的交叉功率谱来消除或减少散粒噪声偏差，注意对于独立样本，交叉散粒噪声项消失。\n\n在本文所述的假设（泊松分布、CIC 分配、周期性盒子）下，反卷积估计中离散性底的基线扣除是上面计算的 $P_{\\mathrm{shot}} = V/N$。", "answer": "$$\\boxed{7.451}$$", "id": "3473824"}]}