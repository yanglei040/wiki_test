{"hands_on_practices": [{"introduction": "本练习是泽尔多维奇近似的理论基石。它揭示了在该模型中，宇宙结构诞生的标志——壳层穿越（shell-crossing）——与初始形变张量的性质直接相关。通过这个练习，你将推导出形变张量的特征值与首次坍缩时间之间存在的简洁而深刻的联系。[@problem_id:3500966]", "problem": "考虑一个在 Einstein–de Sitter (EdS) 宇宙中演化的无压、自引力的冷暗物质（CDM）流体。在 Zel'dovich 近似中，每个由其拉格朗日坐标 $\\boldsymbol{q}$ 标记的流体元都遵循由共动映射 $\\boldsymbol{x}(\\boldsymbol{q},a) = \\boldsymbol{q} + D(a)\\,\\boldsymbol{s}(\\boldsymbol{q})$ 给出的轨迹，其中 $a$ 是宇宙学尺度因子，$D(a)$ 是线性增长因子，$\\boldsymbol{s}(\\boldsymbol{q})$ 是一个无旋位移场。设局域（对称）形变张量为 $d_{ij}(\\boldsymbol{q}) \\equiv \\partial s_i / \\partial q_j$，其真实特征值为 $\\{\\lambda_1,\\lambda_2,\\lambda_3\\}$，并按 $\\lambda_1 \\le \\lambda_2 \\le \\lambda_3$ 排序。仅使用共动坐标中的质量守恒以及第一个壳层穿越（焦散）发生在拉格朗日到欧拉的映射变为奇异时这一事实，确定形成第一个焦散时的尺度因子 $a_{\\rm sc}$，并用特征值 $\\{\\lambda_i\\}$ 表示。假设在 Einstein–de Sitter 宇宙中，线性增长因子满足 $D(a) \\propto a$ 并被归一化以使得 $D(1)=1$。你的最终答案必须是 $a_{\\rm sc}$ 的一个用 $\\lambda_1$, $\\lambda_2$ 和 $\\lambda_3$ 表示的单一闭式解析表达式（无单位）。", "solution": "问题要求在 Einstein-de Sitter 宇宙中，对于无压流体，在 Zel'dovich 近似下，第一个焦散（或壳层穿越）发生时的尺度因子 $a_{\\rm sc}$。\n\n出发点是 Zel'dovich 近似，它提供了从流体元的初始（拉格朗日）共动坐标 $\\boldsymbol{q}$ 到稍后时刻（由尺度因子 $a$ 参数化）的欧拉共动坐标 $\\boldsymbol{x}$ 的一个映射。该映射由以下公式给出：\n$$\n\\boldsymbol{x}(\\boldsymbol{q}, a) = \\boldsymbol{q} + D(a)\\,\\boldsymbol{s}(\\boldsymbol{q})\n$$\n这里，$D(a)$ 是线性增长因子，它描述了线性密度扰动的时间演化，而 $\\boldsymbol{s}(\\boldsymbol{q})$ 是不依赖于时间的位移场。\n\n当初始时不同的流体元在同一空间位置相遇时，就会发生焦散或壳层穿越。在数学上，这对应于拉格朗日坐标到欧拉坐标的映射变为奇异的点。该映射的奇异性由其雅可比矩阵 $J_{ij}$ 决定。当且仅当雅可比矩阵的行列式为零时，该映射是奇异的。\n\n雅可比矩阵的分量由 $J_{ij} = \\frac{\\partial x_i}{\\partial q_j}$ 给出。使用给定的映射，我们计算其偏导数：\n$$\nJ_{ij}(\\boldsymbol{q}, a) = \\frac{\\partial}{\\partial q_j} \\left( q_i + D(a)\\,s_i(\\boldsymbol{q}) \\right)\n$$\n第一项的导数是克罗内克 δ，$\\frac{\\partial q_i}{\\partial q_j} = \\delta_{ij}$。第二项涉及位移场的导数。问题将局域形变张量定义为 $d_{ij}(\\boldsymbol{q}) \\equiv \\frac{\\partial s_i}{\\partial q_j}$。因此，雅可比矩阵变为：\n$$\nJ_{ij}(\\boldsymbol{q}, a) = \\delta_{ij} + D(a)\\,d_{ij}(\\boldsymbol{q})\n$$\n用矩阵表示法，这可以写作：\n$$\n\\boldsymbol{J} = \\boldsymbol{I} + D(a)\\,\\boldsymbol{d}\n$$\n其中 $\\boldsymbol{I}$ 是 $3 \\times 3$ 单位矩阵，$\\boldsymbol{d}$ 是形变张量矩阵。\n\n壳层穿越的条件是映射变为奇异，即 $\\det(\\boldsymbol{J}) = 0$。\n$$\n\\det(\\boldsymbol{I} + D(a)\\,\\boldsymbol{d}) = 0\n$$\n为了计算这个行列式，我们考虑所涉及矩阵的特征值。问题指出，形变张量 $\\boldsymbol{d}$ 是一个实对称矩阵，其特征值为 $\\{\\lambda_1, \\lambda_2, \\lambda_3\\}$。设 $\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3$ 为相应的标准正交特征向量。对于 $\\boldsymbol{d}$ 的任意一个特征值为 $\\lambda_k$ 的特征向量 $\\boldsymbol{v}_k$，我们有 $\\boldsymbol{d}\\boldsymbol{v}_k = \\lambda_k \\boldsymbol{v}_k$。\n\n我们可以通过将雅可比矩阵 $\\boldsymbol{J}$ 作用于 $\\boldsymbol{d}$ 的特征向量来找到 $\\boldsymbol{J}$ 的特征值：\n$$\n\\boldsymbol{J}\\boldsymbol{v}_k = (\\boldsymbol{I} + D(a)\\,\\boldsymbol{d})\\boldsymbol{v}_k = \\boldsymbol{I}\\boldsymbol{v}_k + D(a)\\,\\boldsymbol{d}\\boldsymbol{v}_k = \\boldsymbol{v}_k + D(a)\\lambda_k\\boldsymbol{v}_k = (1 + D(a)\\lambda_k)\\boldsymbol{v}_k\n$$\n这表明 $\\boldsymbol{d}$ 的特征向量同时也是 $\\boldsymbol{J}$ 的特征向量，并且 $\\boldsymbol{J}$ 的特征值为 $\\{1+D(a)\\lambda_1, 1+D(a)\\lambda_2, 1+D(a)\\lambda_3\\}$。\n\n一个矩阵的行列式是其特征值的乘积。因此，雅可比矩阵的行列式为：\n$$\n\\det(\\boldsymbol{J}) = \\prod_{k=1}^{3} (1 + D(a)\\lambda_k) = (1 + D(a)\\lambda_1)(1 + D(a)\\lambda_2)(1 + D(a)\\lambda_3)\n$$\n当且仅当至少有一个因子为零时，壳层穿越条件 $\\det(\\boldsymbol{J}) = 0$ 才被满足：\n$$\n1 + D(a)\\lambda_k = 0 \\quad \\text{for some } k \\in \\{1, 2, 3\\}\n$$\n这给出了发生壳层穿越时增长因子所需满足的条件：\n$$\nD(a) = -\\frac{1}{\\lambda_k}\n$$\n由于宇宙在早期（小的 $a$）从一个平滑状态开始，并朝着结构形成的方向演化，增长因子 $D(a)$ 是 $a$ 的一个单调递增函数，从 $a \\approx 0$ 时的 $D(a) \\approx 0$ 开始。由于 $D(a)$ 必须为正，壳层穿越只可能在 $\\lambda_k  0$ 的方向上发生。这确保了 $-1/\\lambda_k$ 的值是正的。*第一个*壳层穿越对应于满足该条件的最小尺度因子 $a$。这又对应于发生奇异性时 $D(a)$ 的最小正值。我们必须找到 $D(a)$ 可能取值的最小值：\n$$\nD(a_{\\rm sc}) = \\min \\left\\{ -\\frac{1}{\\lambda_k} \\mid \\lambda_k  0 \\right\\}\n$$\n给定排序 $\\lambda_1 \\le \\lambda_2 \\le \\lambda_3$，我们有：\n$$\n-\\lambda_1 \\ge -\\lambda_2 \\ge -\\lambda_3\n$$\n对于负的特征值，对其取倒数会反转不等号：\n$$\n\\text{if } \\lambda_1, \\lambda_2  0, \\text{ then } -\\frac{1}{\\lambda_1} \\le -\\frac{1}{\\lambda_2}\n$$\n因此，在所有负特征值中，最小的（最负的）特征值 $\\lambda_1$ 将给出 $D(a)$ 的最小值。当增长因子达到这个值时，发生第一次壳层穿越：\n$$\nD(a_{\\rm sc}) = -\\frac{1}{\\lambda_1}\n$$\n这在物理上对应于沿着最负特征值方向（最快压缩主轴）的坍缩。\n\n最后，我们使用 Einstein-de Sitter (EdS) 宇宙中增长因子的具体形式。问题指出 $D(a) \\propto a$ 并且归一化使得 $D(1)=1$。设 $D(a) = C \\cdot a$，其中 $C$ 是某个常数。归一化条件给出 $D(1) = C \\cdot 1 = 1$，所以 $C=1$。因此，对于 EdS 宇宙，增长因子就是 $D(a) = a$。\n\n将此代入我们关于第一个焦散的条件，得到：\n$$\na_{\\rm sc} = -\\frac{1}{\\lambda_1}\n$$\n这就是第一次壳层穿越事件发生时的尺度因子。", "answer": "$$\\boxed{-\\frac{1}{\\lambda_1}}$$", "id": "3500966"}, {"introduction": "这个练习将前一个练习中的抽象理论具体化。通过分析一个特定的一维位移场，你不仅能计算出坍缩发生的具体时间，还能推导出坍缩瞬间的本动速度等物理量。更重要的是，本练习将引导你思考为何泽尔多维奇近似虽然强大，却是一个不完整的模型，在首次壳层穿越后便会失效。[@problem_id:3500923]", "problem": "考虑在空间平坦、物质主导的爱因斯坦-德西特宇宙学中，冷暗物质的一维拉格朗日描述。设拉格朗日坐标为 $q$，在标度因子为 $a$ 时，欧拉（共动）坐标为 $x(q,a)$。假设一个泽尔多维奇型映射 $x(q,a)=q+D(a)\\,s(q)$，其中 $D(a)$ 是线性增长因子，$s(q)$ 是一个给定的、不依赖于时间的拉格朗日位移场。欧拉质量密度由拉格朗日质量守恒定律给出，在一维情况下，可以表示为雅可比 $J(q,a)=\\partial x/\\partial q$ 的函数：$\\rho(x,a)=\\bar{\\rho}(a)\\,J(q,a)^{-1}$，其中 $\\bar{\\rho}(a)$ 是背景密度。壳层穿越发生在雅可比 $J(q,a)=0$ 的 $(q,a)$ 处。\n\n假设初始位移场为 $s(q)=S\\,\\exp\\!\\big(-q^{2}/(2\\sigma^{2})\\big)$，其中 $S$ 和 $\\sigma$ 是具有长度单位的正常数。在爱因斯坦-德西特宇宙学中，哈勃参数为 $H(a)=H_{0}\\,a^{-3/2}$，线性增长因子满足 $D(a)=a$，其中 $H_{0}$ 是 $a=1$ 时的哈勃常数。本动速度场定义为 $v(q,a)=a\\,\\frac{d}{dt}x(q,a)$，其中 $t$ 是宇宙时。\n\n根据以上定义和定律，完成以下任务：\n\n1. 用 $D(a)$ 和 $s(q)$ 推导壳层穿越条件，并对给定的 $s(q)$，确定最早发生壳层穿越的位置 $q_{c}$ 及对应的增长因子 $D(a_{c})$。\n2. 利用你的结果和上述宇宙学模型，计算最早壳层穿越处的无量纲标度化速度，\n$$\n\\tilde{v}\\equiv \\frac{v(q_{c},a_{c})}{H_{0}\\,\\sqrt{S\\,\\sigma}}\\,,\n$$\n作为一个单独的实数。将你的答案四舍五入到六位有效数字。以纯数形式表示答案，不带单位。\n3. 基于拉格朗日映射和雅可比 $J(q,a)$ 的形式，简要解释为什么泽尔多维奇近似无法描述壳层穿越后的多流动力学。\n\n你最终报告的量必须是 $\\tilde{v}$，四舍五入到六位有效数字，并以无单位的纯数形式表示。", "solution": "该问题要求使用泽尔多维奇近似对一维爱因斯坦-德西特宇宙学中的壳层穿越进行分析。解答按要求分为三个部分。\n\n第 $1$ 部分：推导壳层穿越条件并确定最早的壳层穿越事件。\n\n从拉格朗日坐标 $q$ 到欧拉共动坐标 $x$ 的泽尔多维奇映射由下式给出\n$$x(q,a) = q + D(a)\\,s(q)$$\n其中 $D(a)$ 是线性增长因子，$s(q)$ 是拉格朗日位移场。壳层穿越发生在来自相邻拉格朗日位置的粒子相互追越时，这导致密度场出现奇点。在数学上，这对应于从 $q$ 到 $x$ 的变换的雅可比为零。雅可比为\n$$J(q,a) = \\frac{\\partial x}{\\partial q} = \\frac{\\partial}{\\partial q} \\left( q + D(a)\\,s(q) \\right) = 1 + D(a)\\,\\frac{ds}{dq}$$\n令 $s'(q) = ds/dq$。壳层穿越条件为 $J(q,a)=0$，这意味着\n$$1 + D(a)\\,s'(q) = 0 \\quad \\implies \\quad D(a) = -\\frac{1}{s'(q)}$$\n对于给定问题，位移场为 $s(q) = S\\,\\exp\\big(-q^{2}/(2\\sigma^{2})\\big)$。其对 $q$ 的导数为\n$$s'(q) = S \\left( -\\frac{2q}{2\\sigma^2} \\right) \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) = -\\frac{S}{\\sigma^2}\\,q\\,\\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right)$$\n由于 $D(a)$ 是增长因子，它是一个关于时间（以及标度因子 $a$）的正的单调递增函数。壳层穿越条件 $D(a) = -1/s'(q)$ 仅在 $s'(q)  0$ 时才能满足。从 $s'(q)$ 的表达式来看，由于 $S>0$ 和 $\\sigma>0$，这要求 $q>0$。\n\n最早的壳层穿越发生在 $D(a)$ 的最小值处，我们称之为 $D(a_c)$。这对应于使表达式 $-1/s'(q)$ 最小化的位置 $q_c$。这等价于找到使 $s'(q)$ 最小化（即，使其负得最多）的 $q$ 值。为找到这个最小值，我们计算 $s(q)$ 的二阶导数，也就是 $s'(q)$ 的一阶导数，并令其为零。\n$$s''(q) = \\frac{d}{dq} \\left( -\\frac{S}{\\sigma^2}\\,q\\,\\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) \\right) = -\\frac{S}{\\sigma^2} \\left[ \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) + q \\left( -\\frac{q}{\\sigma^2} \\right) \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) \\right]$$\n$$s''(q) = -\\frac{S}{\\sigma^2} \\exp\\left(-\\frac{q^2}{2\\sigma^2}\\right) \\left( 1 - \\frac{q^2}{\\sigma^2} \\right)$$\n令 $s''(q)=0$ 得到 $1 - q^2/\\sigma^2 = 0$，解得 $q = \\pm\\sigma$。由于壳层穿越要求 $q>0$，因此最早壳层穿越的位置是 $q_c = \\sigma$。\n\n在此位置，位移梯度的值为\n$$s'(q_c) = s'(\\sigma) = -\\frac{S}{\\sigma^2}\\,\\sigma\\,\\exp\\left(-\\frac{\\sigma^2}{2\\sigma^2}\\right) = -\\frac{S}{\\sigma}\\,\\exp\\left(-\\frac{1}{2}\\right)$$\n因此，首次壳层穿越时的增长因子为\n$$D(a_c) = -\\frac{1}{s'(q_c)} = -\\frac{1}{-\\frac{S}{\\sigma}\\,\\exp\\left(-\\frac{1}{2}\\right)} = \\frac{\\sigma}{S}\\,\\exp\\left(\\frac{1}{2}\\right)$$\n\n第 $2$ 部分：计算无量纲标度化速度 $\\tilde{v}$。\n\n本动速度场定义为 $v(q,a) = a\\,\\frac{d}{dt}x(q,a)$。代入 $x(q,a)$ 的表达式：\n$$v(q,a) = a\\,\\frac{d}{dt}\\left( q + D(a)\\,s(q) \\right) = a\\,\\frac{dD}{dt}\\,s(q)$$\n对于爱因斯坦-德西特宇宙学，有 $D(a)=a$。我们将时间导数与哈勃参数 $H(a) = \\frac{1}{a}\\frac{da}{dt}$ 联系起来。\n$$\\frac{dD}{dt} = \\frac{da}{dt} = a\\,H(a)$$\n已知 $H(a) = H_0\\,a^{-3/2}$，我们有\n$$\\frac{dD}{dt} = a \\left( H_0\\,a^{-3/2} \\right) = H_0\\,a^{-1/2}$$\n将此代回速度表达式中：\n$$v(q,a) = a \\left( H_0\\,a^{-1/2} \\right) s(q) = H_0\\,a^{1/2}\\,s(q)$$\n我们需要在最早的壳层穿越事件处，即 $(q_c, a_c)$ 处，计算该速度。我们有 $q_c = \\sigma$ 和 $a_c = D(a_c) = \\frac{\\sigma}{S}\\,\\exp\\left(\\frac{1}{2}\\right)$。\n首先，计算 $s(q_c)$：\n$$s(q_c) = s(\\sigma) = S\\,\\exp\\left(-\\frac{\\sigma^2}{2\\sigma^2}\\right) = S\\,\\exp\\left(-\\frac{1}{2}\\right)$$\n接着，计算 $a_c^{1/2}$：\n$$a_c^{1/2} = \\left( \\frac{\\sigma}{S}\\,\\exp\\left(\\frac{1}{2}\\right) \\right)^{1/2} = \\left(\\frac{\\sigma}{S}\\right)^{1/2} \\left(\\exp\\left(\\frac{1}{2}\\right)\\right)^{1/2} = \\left(\\frac{\\sigma}{S}\\right)^{1/2} \\exp\\left(\\frac{1}{4}\\right)$$\n现在，我们计算速度 $v(q_c, a_c)$：\n$$v(q_c, a_c) = H_0\\,a_c^{1/2}\\,s(q_c) = H_0 \\left[ \\left(\\frac{\\sigma}{S}\\right)^{1/2} \\exp\\left(\\frac{1}{4}\\right) \\right] \\left[ S\\,\\exp\\left(-\\frac{1}{2}\\right) \\right]$$\n$$v(q_c, a_c) = H_0\\, \\sigma^{1/2}\\, S^{-1/2}\\, S^1\\, \\exp\\left(\\frac{1}{4} - \\frac{1}{2}\\right) = H_0\\, \\sigma^{1/2}\\, S^{1/2}\\, \\exp\\left(-\\frac{1}{4}\\right)$$\n$$v(q_c, a_c) = H_0\\,\\sqrt{S\\sigma}\\,\\exp\\left(-\\frac{1}{4}\\right)$$\n问题要求的是无量纲标度化速度 $\\tilde{v}$，其定义为\n$$\\tilde{v} = \\frac{v(q_c,a_c)}{H_{0}\\,\\sqrt{S\\,\\sigma}} = \\frac{H_0\\,\\sqrt{S\\sigma}\\,\\exp\\left(-\\frac{1}{4}\\right)}{H_{0}\\,\\sqrt{S\\,\\sigma}} = \\exp\\left(-\\frac{1}{4}\\right)$$\n计算数值并四舍五入到六位有效数字：\n$$\\tilde{v} = \\exp(-0.25) \\approx 0.77880078... \\approx 0.778801$$\n\n第 $3$ 部分：解释泽尔多维奇近似在壳层穿越后的失效原因。\n\n泽尔多维奇近似通过一个映射 $x(q,a)$ 来描述宇宙流体的演化，该映射将粒子的初始（拉格朗日）位置 $q$ 映射到对应于标度因子 $a$ 的稍后时间的最终（欧拉）位置 $x$。在任何给定时间，该映射为每个粒子标签 $q$ 分配一个唯一的位置 $x$。\n\n当此映射的雅可比 $J(q,a)=\\partial x/\\partial q$ 变为零时，发生壳层穿越。在首次壳层穿越之后的时间里，将存在一个拉格朗日坐标范围，使得 $J(q,a)  0$。负的雅可比意味着粒子的顺序被反转，即对于两个拉格朗日坐标为 $q_1 > q_2$ 的邻近粒子，它们的欧拉位置变为 $x(q_1, a)  x(q_2, a)$。\n\n这种粒子顺序的反转导致映射 $q \\mapsto x(q,a)$ 变得不可逆，或称为多值的。也就是说，在穿越后区域中的单个欧拉位置 $x$ 上，可以有多个不同的拉格朗日坐标 $q_1, q_2, q_3, ...$ 都映射到同一个 $x$。这种物理情况被称为多流，即几股源自不同初始位置、具有不同速度的物质流在同一物理位置共存。\n\n泽尔多维奇近似的根本局限在于它被表述为一个从 $q$ 到 $x$ 的单值映射。当试图描述欧拉流体性质（如密度 $\\rho(x,a)$ 和速度 $v_{\\text{Eul}}(x,a)$）时，需要对该映射求逆以找到 $q(x,a)$。在多流区域，这种求逆不是唯一的。因此，简单的欧拉密度公式 $\\rho = \\bar{\\rho} J^{-1}$ 和相应的单值速度场不再是良定义的。该框架无法描述多流流体的物理现实，即在单点 $x$ 处，总密度是不同流的密度之和，而速度是一个多值函数，对应于每个流的速度。泽尔多维奇近似可以正确追踪粒子轨迹直至穿越发生及之后，但它无法表示由此产生的复杂、多值的欧拉场。", "answer": "$$\\boxed{0.778801}$$", "id": "3500923"}, {"introduction": "本练习旨在连接连续理论与离散计算之间的鸿沟。它探讨了数值宇宙学中的一个关键实践问题：我们选择何种算法来计算导数，将如何影响我们的预测结果。通过比较有限差分法和谱方法，你将深入理解基于泽尔多维奇近似的数值模拟的准确性和局限性。[@problem_id:3500950]", "problem": "考虑在空间周期性域中冷暗物质的一维泽尔多维奇近似。拉格朗日坐标用 $q$ 表示，欧拉坐标用 $x$ 表示，线性增长因子用 $D$ 表示。泽尔多维奇映射由基本关系式 $x(q, D) = q + D \\, s(q)$ 给出，其中 $s(q)$ 是一个周期为 $L$ 的可微周期性位移场。共动密度遵循质量守恒，该映射的一维雅可比行列式为 $J(q, D) = \\partial x / \\partial q = 1 + D \\, s'(q)$。在此近似中，首次壳层穿越（首次出现多流现象）发生在使得至少对于一个 $q$ 有 $J(q, D) = 0$ 成立的最早正值 $D$ 处。等价地，如果 $m_{\\min} = \\min_q s'(q)$，且 $m_{\\min}  0$，那么最早的坍缩因子为 $D_{\\mathrm{c}} = - 1 / m_{\\min}$。\n\n您需要构建一个完整的程序，用于在离散网格上比较两种 $s'(q)$ 的数值梯度估计器，并量化它们对预测的 $D_{\\mathrm{c}}$ 的影响：\n- 在间距为 $\\Delta q$ 的均匀周期性网格上的二阶中心有限差分估计器，\n- 使用通过快速傅里叶变换 (FFT) 实现的离散傅里叶变换 (DFT) 的谱方法估计器，其导数通过在傅里叶空间中将模式系数乘以 $\\mathrm{i} k$ 并变换回位形空间来计算。\n\n使用一个长度为 $L = 2\\pi$ 的严格一维周期性域，并将 $s(q)$ 构建为正弦模式的有限和，\n$$\ns(q) = \\sum_{j=1}^{M} A_j \\, \\sin\\!\\big(m_j \\, q + \\phi_j\\big),\n$$\n其中 $m_j$ 是整数模式数，$A_j$ 是实数振幅，$\\phi_j$ 是实数相位。假设在 $[0, L)$ 上采用周期性边界条件，并且所有 $m_j$ 都满足离散采样约束 $m_j  N/2$，其中 $N$ 是网格点数。\n\n您的程序必须实现以下步骤：\n1. 对于给定的参数集 $\\{N, \\{(m_j, A_j, \\phi_j)\\}_{j=1}^{M}\\}$，构建一个均匀网格 $q_n = n \\, \\Delta q$（其中 $n = 0, 1, \\dots, N-1$ 且 $\\Delta q = L/N$），计算 $s(q_n)$，并在网格点上计算 $s'(q)$ 的两种数值近似：\n   - 有限差分法：$s'_{\\mathrm{FD}}(q_n) \\approx \\big(s(q_{n+1}) - s(q_{n-1})\\big) / \\big(2 \\Delta q\\big)$，使用周期性索引。\n   - 谱方法：计算 DFT $\\hat{s}_k$，乘以 $\\mathrm{i} k_{\\nu}$（其中 $k_{\\nu}$ 是与间距 $\\Delta q$ 一致的傅里叶角波数），然后进行逆 DFT 得到 $s'_{\\mathrm{SP}}(q_n)$。\n2. 计算数值壳层穿越预测值 $D_{\\mathrm{c,FD}} = -1 / \\min_n s'_{\\mathrm{FD}}(q_n)$ 和 $D_{\\mathrm{c,SP}} = -1 / \\min_n s'_{\\mathrm{SP}}(q_n)$，前提是各自的最小值都严格为负。\n3. 通过在一个大小为 $N_{\\mathrm{ref}} = 16384$ 的 $[0, L)$ 上的密集网格上计算精确导数\n$$\ns'(q) = \\sum_{j=1}^{M} A_j \\, m_j \\, \\cos\\!\\big(m_j \\, q + \\phi_j\\big)\n$$\n来计算一个高精度参考估计值 $D_{\\mathrm{c,ref}}$，并在最小值严格为负的情况下取 $D_{\\mathrm{c,ref}} = -1 / \\min s'(q)$。\n4. 对每个参数集，输出两个误差度量：\n   - 有限差分预测的相对误差，$E_{\\mathrm{FD}} = \\big|D_{\\mathrm{c,FD}} - D_{\\mathrm{c,ref}}\\big| / D_{\\mathrm{c,ref}}$。\n   - 谱方法预测的相对误差，$E_{\\mathrm{SP}} = \\big|D_{\\mathrm{c,SP}} - D_{\\mathrm{c,ref}}\\big| / D_{\\mathrm{c,ref}}$。\n如果任何方法对 $s'(q)$ 产生的最小值为非负数（因此没有预测到壳层穿越），则将相应的误差定义为浮点数 $\\mathrm{nan}$。\n\n所有量均为无量纲。相位的角度单位为弧度。\n\n测试套件。您的程序必须运行以下参数集：\n- 案例 1（单模式，中等分辨率）：$N = 128$，$M = 1$，$(m_1, A_1, \\phi_1) = (4, 0.2, 0.3)$。\n- 案例 2（靠近紫外端的单模式，较粗分辨率）：$N = 64$，$M = 1$，$(m_1, A_1, \\phi_1) = (20, 0.1, -0.5)$。\n- 案例 3（双模式组合，中等分辨率）：$N = 96$，$M = 2$，$(m_1, A_1, \\phi_1) = (3, 0.15, 0.1)$ 和 $(m_2, A_2, \\phi_2) = (7, 0.1, -1.0)$。\n- 案例 4（单模式，小振幅，较高分辨率）：$N = 128$，$M = 1$，$(m_1, A_1, \\phi_1) = (10, 0.01, 1.2)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为\n$$\n[E_{\\mathrm{FD}}^{(1)}, E_{\\mathrm{SP}}^{(1)}, E_{\\mathrm{FD}}^{(2)}, E_{\\mathrm{SP}}^{(2)}, E_{\\mathrm{FD}}^{(3)}, E_{\\mathrm{SP}}^{(3)}, E_{\\mathrm{FD}}^{(4)}, E_{\\mathrm{SP}}^{(4)}],\n$$\n其中上标表示测试案例索引。每个浮点数必须以科学记数法打印，并保留 $8$ 位有效数字（例如，$1.2345678\\mathrm{e}{-4}$）。不应打印任何其他文本。所有计算都必须由您的程序按所述进行数值计算；不允许任何外部输入。", "solution": "所提出的问题是有效的。它在科学上基于宇宙学结构形成的原理，特别是泽尔多维奇近似，并提出了一个明确定义的数值任务，以比较计算空间导数的两种标准方法（有限差分法和谱方法）的准确性。所有必要的参数、公式和评估标准都已提供，构成了一个自洽且可解的问题。\n\n解决方案的步骤是：首先根据物理和数值规定构建位移场及其导数，然后计算坍缩时间，最后为每个测试案例评估指定的误差度量。\n\n问题的核心在于泽尔多维奇近似，它描述了膨胀宇宙中粒子轨迹的初始演化。在由线性增长因子 $D$ 指定的时刻，粒子的位置 $x$ 由其初始（拉格朗日）位置 $q$ 加上一个位移给出。该映射为 $x(q, D) = q + D \\, s(q)$，其中 $s(q)$ 是位移场。在一个长度为 $L$ 的一维周期性域中，我们给定了 $s(q)$ 的具体形式，即正弦模式之和：\n$$\ns(q) = \\sum_{j=1}^{M} A_j \\, \\sin(m_j \\, q + \\phi_j)\n$$\n这里，$A_j$ 是振幅，$m_j$ 是适用于长度为 $L=2\\pi$ 的域的整数波数，$\\phi_j$ 是相移。\n\n第一个引力坍缩结构（称为壳层穿越或焦散）的形成，发生在具有不同初始位置的粒子相互追越之时。在数学上，这对应于从 $q$到 $x$ 的映射的雅可比行列式变为零。雅可比行列式为 $J(q, D) = \\frac{\\partial x}{\\partial q} = 1 + D \\, s'(q)$。令 $J(q,D)=0$ 得到 $D = -1/s'(q)$。首次壳层穿越发生在满足此条件的最小正值 $D$ 处。这对应于 $s'(q)$ 取最负值的位置 $q$。如果我们定义 $m_{\\min} = \\min_q s'(q)$，则坍缩的临界增长因子为 $D_{\\mathrm{c}} = -1/m_{\\min}$，前提是 $m_{\\min}  0$。任务是使用 $s'(q)$ 的不同数值估计来计算 $D_{\\mathrm{c}}$ 并比较它们的准确性。\n\n位移场的解析导数是精确已知的：\n$$\ns'(q) = \\frac{d s}{d q} = \\sum_{j=1}^{M} A_j \\, m_j \\, \\cos(m_j \\, q + \\phi_j)\n$$\n该表达式用于生成一个高精度的参考值 $D_{\\mathrm{c,ref}}$。\n\n我们在一个均匀离散网格 $q_n = n \\Delta q$（其中 $n = 0, 1, \\dots, N-1$，网格间距 $\\Delta q = L/N = 2\\pi/N$）上评估场。\n\n第一种数值方法是二阶中心有限差分方案。导数 $s'(q_n)$ 的近似值为：\n$$\ns'_{\\mathrm{FD}}(q_n) = \\frac{s(q_{n+1}) - s(q_{n-1})}{2 \\Delta q}\n$$\n索引按周期性处理，即 $q_{N} \\equiv q_0$ 和 $q_{-1} \\equiv q_{N-1}$。此方法是局部的，其截断误差随网格间距的变化尺度为 $\\mathcal{O}((\\Delta q)^2)$。对于相对于网格间距具有高频内容的函数，其精度预计会下降。\n\n第二种数值方法是谱方法或伪谱方法，它利用了快速傅里叶变换 (FFT)。其步骤如下：\n1.  计算采样场 $s(q_n)$ 的离散傅里叶变换 (DFT)，以获得其在傅里叶空间中的系数 $\\hat{s}_k$。\n$$\n\\hat{s}_k = \\sum_{n=0}^{N-1} s(q_n) e^{-2\\pi i k n / N}\n$$\n2.  傅里叶变换的微分定理指出，实空间中的微分等价于傅里叶空间中的乘以 $\\mathrm{i}k_{\\nu}$，其中 $k_{\\nu}$ 是角波数。对于我们的网格，离散角波数由 `scipy.fft.fftfreq(N, d=dq) * 2 * np.pi` 给出。\n3.  导数的傅里叶系数 $\\widehat{s'}_k$ 通过以下方式计算：\n$$\n\\widehat{s'}_k = \\mathrm{i} k_{\\nu} \\hat{s}_k\n$$\n4.  通过对 $\\widehat{s'}_k$ 应用逆离散傅里叶变换 (IDFT)，可以恢复实空间中的导数 $s'_{\\mathrm{SP}}(q_n)$。\n$$\ns'_{\\mathrm{SP}}(q_n) = \\frac{1}{N} \\sum_{k=0}^{N-1} \\widehat{s'}_k e^{2\\pi i k n / N}\n$$\n对于一个由有限数量的正弦模式组成的函数，只要其波数 $m_j$ 均小于网格的奈奎斯特频率（即 $|m_j|  N/2$），正如问题陈述所保证的那样，这种谱方法计算导数的精度可以达到机器精度。它在网格点上实际上是精确的。\n\n对于每种方法（FD、SP）和参考计算（REF），找到相应导数的最小值 $m_{\\min}$。如果 $m_{\\min}  0$，则坍缩因子计算为 $D_{\\mathrm{c}} = -1/m_{\\min}$。如果 $m_{\\min} \\ge 0$，则该方法预测不会发生坍缩，问题规定结果应为 `nan`。\n\n最后，相对于高精度参考值 $D_{\\mathrm{c,ref}}$ 计算有限差分和谱方法预测的相对误差 $E_{\\mathrm{FD}}$ 和 $E_{\\mathrm{SP}}$：\n$$\nE_{\\mathrm{FD}} = \\frac{|D_{\\mathrm{c,FD}} - D_{\\mathrm{c,ref}}|}{D_{\\mathrm{c,ref}}} \\quad \\text{和} \\quad E_{\\mathrm{SP}} = \\frac{|D_{\\mathrm{c,SP}} - D_{\\mathrm{c,ref}}|}{D_{\\mathrm{c,ref}}}\n$$\n如果任何方法产生非物理的（非负的）最小导数值，则相应的误差定义为 `nan`。\n\n每个测试案例的总体算法如下：\n1.  定义参数 $N$ 和模式集 $\\{(m_j, A_j, \\phi_j)\\}$。\n2.  构建网格 $q_n$ 并评估位移场 $s(q_n)$。\n3.  使用周期性中心差分计算 $s'_{\\mathrm{FD}}(q_n)$。\n4.  使用基于 FFT 的谱方法计算 $s'_{\\mathrm{SP}}(q_n)$。\n5.  构建一个高分辨率网格 $q_{\\mathrm{ref}}$ 并评估精确的解析导数 $s'(q_{\\mathrm{ref}})$。\n6.  找到每个导数数组的最小值。\n7.  计算 $D_{\\mathrm{c,FD}}$、$D_{\\mathrm{c,SP}}$ 和 $D_{\\mathrm{c,ref}}$。\n8.  计算并返回相对误差 $E_{\\mathrm{FD}}$ 和 $E_{\\mathrm{SP}}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef compute_errors(N, modes, L=2.0 * np.pi, N_ref=16384):\n    \"\"\"\n    Computes numerical derivatives and their errors for a given parameter set.\n    \n    Args:\n        N (int): Number of grid points.\n        modes (list of tuples): List of mode parameters (m_j, A_j, phi_j).\n        L (float): Length of the periodic domain.\n        N_ref (int): Number of grid points for the reference calculation.\n        \n    Returns:\n        tuple: A pair of floats (E_fd, E_sp) representing the relative errors.\n    \"\"\"\n    # 1. Construct the grid and evaluate s(q)\n    dq = L / N\n    q = np.arange(N) * dq\n    \n    s_q = np.zeros(N)\n    for m, A, phi in modes:\n        s_q += A * np.sin(m * q + phi)\n\n    # 2. Compute finite-difference derivative\n    s_plus_1 = np.roll(s_q, -1)\n    s_minus_1 = np.roll(s_q, 1)\n    s_prime_fd = (s_plus_1 - s_minus_1) / (2.0 * dq)\n\n    # 3. Compute spectral derivative\n    s_hat = fft.fft(s_q)\n    # Wavenumbers for a domain of length L\n    k_nu = fft.fftfreq(N, d=dq) * 2.0 * np.pi\n    s_prime_hat = 1j * k_nu * s_hat\n    s_prime_sp = fft.ifft(s_prime_hat).real\n\n    # 4. Compute high-accuracy reference derivative\n    dq_ref = L / N_ref\n    q_ref = np.arange(N_ref) * dq_ref\n    \n    s_prime_ref_analytic = np.zeros(N_ref)\n    for m, A, phi in modes:\n        s_prime_ref_analytic += A * m * np.cos(m * q_ref + phi)\n\n    # 5. Compute the minimum of each derivative\n    min_s_prime_fd = np.min(s_prime_fd)\n    min_s_prime_sp = np.min(s_prime_sp)\n    min_s_prime_ref = np.min(s_prime_ref_analytic)\n\n    # 6. Compute collapse factors D_c\n    Dc_fd = -1.0 / min_s_prime_fd if min_s_prime_fd  0 else np.nan\n    Dc_sp = -1.0 / min_s_prime_sp if min_s_prime_sp  0 else np.nan\n    Dc_ref = -1.0 / min_s_prime_ref if min_s_prime_ref  0 else np.nan\n    \n    # 7. Compute relative errors\n    # np.nan propagates correctly through these arithmetic operations\n    E_fd = np.abs(Dc_fd - Dc_ref) / Dc_ref\n    E_sp = np.abs(Dc_sp - Dc_ref) / Dc_ref\n    \n    return E_fd, E_sp\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'N': 128, 'modes': [(4, 0.2, 0.3)]},  # Case 1\n        {'N': 64,  'modes': [(20, 0.1, -0.5)]}, # Case 2\n        {'N': 96,  'modes': [(3, 0.15, 0.1), (7, 0.1, -1.0)]}, # Case 3\n        {'N': 128, 'modes': [(10, 0.01, 1.2)]}, # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case['N']\n        modes = case['modes']\n        \n        # Ensure modes satisfy the Nyquist criterion\n        for m, _, _ in modes:\n            if not m  N / 2:\n                raise ValueError(f\"Mode m={m} violates Nyquist criterion for N={N}\")\n\n        E_fd, E_sp = compute_errors(N, modes)\n        results.extend([E_fd, E_sp])\n\n    # Final print statement in the exact required format.\n    # The format specifier \"{:.7e}\" yields 8 significant digits (1 before decimal, 7 after).\n    formatted_results = [f\"{r:.7e}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3500950"}]}