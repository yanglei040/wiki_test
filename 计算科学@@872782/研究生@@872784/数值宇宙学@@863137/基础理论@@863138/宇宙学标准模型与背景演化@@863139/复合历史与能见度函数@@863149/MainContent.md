## 引言
宇宙复合历史与[可见性函数](@entry_id:756540)是现代宇宙学的基石，它们共同描绘了宇宙从一团不透明的炽热等离子体转变为我们今天所见的透明宇宙的壮丽画卷。这一转变过程直接决定了宇宙微波背景（CMB）——这幅宇宙最古老“照片”的最终形态。因此，精确理解和建模这一时期对于从CMB观测中解读宇宙的起源、演化和基本构成至关重要。然而，从理论上精确描述这一过程并非易事，它要求我们跨越从简单的[热平衡](@entry_id:141693)图像到复杂的[非平衡动力学](@entry_id:160262)，并最终将其转化为可与观测直接对比的量。本文旨在填补这一知识体系中的关键环节，系统性地阐明复合历史的物理机制及其在[数值宇宙学](@entry_id:752779)中的核心作用。

在接下来的内容中，读者将踏上一段从第一性原理到前沿应用的探索之旅。在“**原理与机制**”一章，我们将深入探讨描述复合过程的核心方程——从[萨哈方程](@entry_id:139054)的平衡近似到更精确的皮布尔斯方程，并定义连接理论与观测的关键工具：光学深度和[可见性函数](@entry_id:756540)。随后，在“**应用与交叉学科联系**”一章，我们将展示这些理论工具如何被用作强大的[宇宙学探针](@entry_id:160927)，以约束宇宙[再电离](@entry_id:158356)、检验基础物理定律，并揭示其与原子物理及计算科学的深刻联系。最后，在“**动手实践**”部分，我们提供了一系列精心设计的计算练习，旨在帮助读者将理论知识转化为解决实际问题的数值技能。现在，让我们首先深入复合历史的物理心脏，探索其基本原理与机制。

## 原理与机制

在上一章的介绍之后，我们现在深入探讨宇宙复合历史与[可见性函数](@entry_id:756540)的物理原理和计算机制。本章的目标是建立一个从第一性原理出发的理论框架，该框架不仅能解释宇宙从完全电离的等离子体到[电中性](@entry_id:157680)气体的转变，还能将这一过程与宇宙微波背景（CMB）的可观测特性联系起来。我们将从热[动平衡](@entry_id:163330)的简化图像开始，然后过渡到更精确的[非平衡动力学](@entry_id:160262)描述，并最终讨论如何从数值上求解这些过程以及如何验证结果的准确性。

### 热[动平衡](@entry_id:163330)与[萨哈方程](@entry_id:139054)

在[早期宇宙](@entry_id:160168)（例如，[红移](@entry_id:159945) $z \gg 1500$），温度和密度极高，粒子间的相互作用率远大于宇宙的膨胀率。在这种条件下，宇宙中的各种组分——[光子](@entry_id:145192)、电子、质子以及各种[原子核](@entry_id:167902)——处于热[动平衡](@entry_id:163330)与化学平衡状态。描述电离与复合[反应平衡](@entry_id:198488)的工具是**[萨哈方程](@entry_id:139054)（Saha equation）**，它源于[统计力](@entry_id:194984)学中化学势平衡的原理。

#### 氢复合的萨哈近似

考虑宇宙等离子体中的核心反应：氢的电离与复合，$p + e^- \leftrightarrow \mathrm{H} + \gamma$。在化学平衡中，反应物和生成物的化学势相等：$\mu_p + \mu_e = \mu_\mathrm{H}$（黑体[光子的化学势](@entry_id:152894)为零）。对于一个非相对论、非简并的麦克斯韦-玻尔兹曼气体，其化学势 $\mu_i$ 与粒子[数密度](@entry_id:268986) $n_i$、质量 $m_i$、温度 $T$ 和自旋简并度 $g_i$ 相关。通过代入各自的化学势表达式，可以推导出各种粒子数密度之间的关系。

为了方便地描述电离状态，我们定义**自由[电子分数](@entry_id:159166)（free-electron fraction）** $x_e$ 为自由电子数密度 $n_e$ 与氢[原子核](@entry_id:167902)总[数密度](@entry_id:268986) $n_\mathrm{H}$（包括自由质子 $n_p$ 和中性氢原子中的质子 $n_{\mathrm{H,I}}$）之比，即 $x_e \equiv n_e / n_\mathrm{H}$。在只考虑氢的宇宙中，[电中性](@entry_id:157680)要求 $n_e = n_p$。因此，我们可以得到 $n_p = x_e n_\mathrm{H}$ 以及[中性氢](@entry_id:174271)的数密度 $n_{\mathrm{H,I}} = n_\mathrm{H} - n_p = (1-x_e) n_\mathrm{H}$。将这些关系代入由化学势平衡推导出的方程，我们得到氢复合的[萨哈方程](@entry_id:139054) [@problem_id:3483691]：

$$
\frac{x_e^2}{1-x_e} = \frac{1}{n_\mathrm{H}} \left(\frac{2\pi m_e k_B T}{h^2}\right)^{3/2} \exp\left(-\frac{\chi_\mathrm{H}}{k_B T}\right)
$$

其中：
- $m_e$ 是电子质量。
- $k_B$ 是玻尔兹曼常数。
- $h$ 是普朗克常数。
- $T$ 是[光子](@entry_id:145192)和重子的共同温度（在复合早期，[康普顿散射](@entry_id:150648)有效地使它们热耦合）。
- $\chi_\mathrm{H} \approx 13.6\,\mathrm{eV}$ 是氢原子的[基态](@entry_id:150928)电离能。

这个方程描述了在给定总氢核密度 $n_\mathrm{H}$ 和温度 $T$ 的情况下，$x_e$ 的平衡值。右侧的指数项 $\exp(-\chi_\mathrm{H}/(k_B T))$ 表明，当热能 $k_B T$ 远小于电离能 $\chi_\mathrm{H}$ 时，平衡会强烈地偏向于复合（$x_e \to 0$）。然而，由于宇宙中[光子](@entry_id:145192)数与重子数之比极大（约 $10^9$），[光子](@entry_id:145192)[黑体谱](@entry_id:158574)的高能尾部仍然有足够的[光子](@entry_id:145192)来电离新形成的中性氢原子，这使得复合过程发生得比朴素的 $k_B T \sim \chi_\mathrm{H}$ 预言要晚得多。

#### 氦的复合与电子预算

除了氢，[早期宇宙](@entry_id:160168)还包含由[太初核合成](@entry_id:161509)产生的氦。氦的质量分数通常表示为 $Y_p \approx 0.24$。氦的复合分两步进行，其[电离能](@entry_id:136678)更高：
1.  $\mathrm{He}^{++} + e^- \leftrightarrow \mathrm{He}^+$，[电离能](@entry_id:136678)为 $\chi_{\mathrm{He\,II}} \approx 54.4\,\mathrm{eV}$。
2.  $\mathrm{He}^+ + e^- \leftrightarrow \mathrm{He}$，电离能为 $\chi_{\mathrm{He\,I}} \approx 24.6\,\mathrm{eV}$。

由于电离能更高，氦的复合发生得比氢早得多。$\mathrm{He}^{++}$ 的复合大约在 $z \sim 6000$ 完成，而 $\mathrm{He}^+$ 的复合则在 $z \sim 2500$ 左右完成。这两个过程同样可以用各自的[萨哈方程](@entry_id:139054)来描述 [@problem_id:3483687]。例如，对于 $\mathrm{He}^{++} \to \mathrm{He}^+$ 的复合，[萨哈方程](@entry_id:139054)的形式为：

$$
\frac{n_e n_{\mathrm{He\,III}}}{n_{\mathrm{He\,II}}} = \frac{2 g_{\mathrm{He\,III}}}{g_{\mathrm{He\,II}}} \left(\frac{2\pi m_e k_B T}{h^2}\right)^{3/2} \exp\left(-\frac{\chi_{\mathrm{He\,II}}}{k_B T}\right)
$$

其中 $n_{\mathrm{He\,III}}$ 和 $n_{\mathrm{He\,II}}$ 分别是 $\mathrm{He}^{++}$ 和 $\mathrm{He}^+$ 的数密度，$g$ 是相应的[统计权重](@entry_id:186394)。

氦的存在改变了总的自由电子预算。自由[电子分数](@entry_id:159166) $x_e \equiv n_e/n_\mathrm{H}$ 在不同时期有不同的平台值。在氢和氦都完全电离时，$n_e = n_\mathrm{H} + 2 n_{\mathrm{He}}$，因此 $x_e = 1 + 2f_{\mathrm{He}}$。在 $\mathrm{He}^{++}$ 复合为 $\mathrm{He}^+$ 之后，$n_e = n_\mathrm{H} + n_{\mathrm{He}}$，因此 $x_e = 1 + f_{\mathrm{He}}$。在氦完全复合为中性原子之后，但在氢复合之前，$n_e = n_\mathrm{H}$，因此 $x_e = 1$。这里，$f_{\mathrm{He}} \equiv n_{\mathrm{He}}/n_\mathrm{H} = Y_p / [4(1-Y_p)]$ 是氦与氢的[原子核](@entry_id:167902)数密度之比 [@problem_id:3483687]。对于 $Y_p = 0.24$，我们有 $f_{\mathrm{He}} \approx 0.079$，这导致在氢复合开始前，$x_e$ 的初始值约为 $1.079$。

### 平衡的破坏：[非平衡动力学](@entry_id:160262)

[萨哈方程](@entry_id:139054)成立的根本前提是反应率远大于[宇宙膨胀](@entry_id:161474)率 $H$，即 $\Gamma \gg H$。随着宇宙膨胀和冷却，密度和温度下降，导致反应率 $\Gamma$ 迅速降低。当 $\Gamma \sim H$ 时，[化学反应](@entry_id:146973)无法跟上[宇宙膨胀](@entry_id:161474)的步伐，系统偏离[化学平衡](@entry_id:142113)，粒子丰度“冻结”（freeze-out）。对于氢复合，这一偏离尤其重要，需要更精细的动力学描述。

#### 莱曼-$\alpha$ 瓶颈与[双光子衰变](@entry_id:159680)

直接复合到氢[原子基态](@entry_id:194487)（$n=1$）的过程是无效的。因为这个过程会释放一个能量为 $13.6\,\mathrm{eV}$ 的[光子](@entry_id:145192)，而这个[光子](@entry_id:145192)几乎会立刻被周围的另一个中性氢[原子吸收](@entry_id:199242)，导致其再次电离。宇宙对于莱曼[连续谱](@entry_id:155477)[光子](@entry_id:145192)是光学厚的。因此，净复合必须通过电子被俘获到[激发态](@entry_id:261453)（$n \ge 2$），然后通过级联[辐射衰变](@entry_id:159878)到[基态](@entry_id:150928)。

然而，这一级联过程在从第一[激发态](@entry_id:261453)（$n=2$）到[基态](@entry_id:150928)（$n=1$）的跃迁处遇到了一个严重的瓶颈——**莱曼-$\alpha$（Ly$\alpha$）瓶颈（Lyman-$\alpha$ bottleneck）** [@problem_id:3483691]。$2p \to 1s$ 跃迁产生的 Ly$\alpha$ [光子](@entry_id:145192)具有极大的[共振散射](@entry_id:185638)[截面](@entry_id:154995)，它们会被[中性氢](@entry_id:174271)原子反复散射，被“囚禁”在介质中，直到[宇宙学红移](@entry_id:152343)将其频率移出共振线，才能最终逃逸。这是一个非常缓慢的过程。

幸运的是，存在一个绕过此瓶颈的关键机制：[亚稳态](@entry_id:167515) $2s$ 能级的**[双光子衰变](@entry_id:159680)**（$2s \to 1s + 2\gamma$）。这个过程的自发衰变率很慢，$\Lambda_{2s \to 1s} \approx 8.22\,\mathrm{s}^{-1}$，但它产生的两个[光子](@entry_id:145192)的能量之和等于 Ly$\alpha$ 跃迁能量，而单个[光子](@entry_id:145192)的能量则不足以激发[基态](@entry_id:150928)氢原子。因此，这个过程提供了一条不可逆的、通往[基态](@entry_id:150928)的有效路径 [@problem_id:3483727]。

#### 皮布尔斯方程

综合考虑这些效应，Peebles提出了一个描述氢复合非平衡演化的有效三能级[原子模型](@entry_id:137207)（[基态](@entry_id:150928)、n=2[激发态](@entry_id:261453)、[连续态](@entry_id:197473)）。其核心思想是，净复合率由电子复合到[激发态](@entry_id:261453)的速率，乘以一个修正因子 $C$ 决定。这个因子 $C$ 表示一个落入 $n=2$ 能级的电子最终成功到达[基态](@entry_id:150928)而不是被再次[光致电离](@entry_id:157870)的概率。这个概率由向下衰变（[双光子衰变](@entry_id:159680)和Ly$\alpha$逃逸）与向上电离的速率竞争决定 [@problem_id:3483727]：

$$
C = \frac{\Lambda_{2s \to 1s} + R_{\alpha}^{\mathrm{esc}}}{\Lambda_{2s \to 1s} + R_{\alpha}^{\mathrm{esc}} + \beta_B(T)}
$$

其中 $R_{\alpha}^{\mathrm{esc}}$ 是Ly$\alpha$[光子](@entry_id:145192)的红移[逃逸率](@entry_id:199818)，$\beta_B(T)$ 是从 $n=2$ 能级的[光致电离](@entry_id:157870)率（由[细致平衡原理](@entry_id:200508)与“B情况”复合系数 $\alpha_B$ 相关联）。

最终，自由[电子分数](@entry_id:159166) $x_e$ 的演化由一个[非线性](@entry_id:637147)的常微分方程（ODE）——**皮布尔斯方程（Peebles equation）**——描述，其简化形式为：

$$
\frac{dx_e}{dt} = -C \left[ \alpha_B(T) n_\mathrm{H} x_e^2 - \beta_B(T) (1-x_e) \exp\left(-\frac{E_{21}}{k_B T}\right) \right]
$$

其中 $E_{21}$ 是 $n=2$ 到 $n=1$ 的能级差。这个方程取代了[萨哈方程](@entry_id:139054)，成为描述氢复合历史的精确工具。

### 从复合历史到CMB[可观测量](@entry_id:267133)

求解了 $x_e$ 随时间的演化 $x_e(t)$（或等价地，$x_e(z)$），我们就可以计算CMB[光子](@entry_id:145192)在传播路径上经历的相互作用，从而连接到CMB的可观测量。

#### 汤姆逊散射[光学深度](@entry_id:150612)

对于CMB[光子](@entry_id:145192)，主要的相互作用是与自由电子的汤姆逊散射。从某个[共形时间](@entry_id:263727) $\eta$ 到今天 $\eta_0$ 的**光学深度（optical depth）** $\tau(\eta)$ 定义为[光子](@entry_id:145192)在这段路径上发生散射的总概率：

$$
\tau(\eta) = \int_{\eta}^{\eta_0} a(\eta') n_e(\eta') \sigma_T \, d\eta'
$$

其中，$\sigma_T$ 是汤姆逊散射截面，$a(\eta')$是标度因子。此处的定义采用了理论计算中常见的 $c=1$ 单位制，在此单位制下 $dt = a\,d\eta$。更常用的是将 $\tau$ 表示为红移 $z$ 的积分。利用 $dt/dz = -1/[(1+z)H(z)]$ 的关系，我们可以将[光学深度](@entry_id:150612)写为（注意这里显式地恢复了光速 $c$）：

$$
\tau(z) = \int_0^z \frac{c \sigma_T n_e(z')}{(1+z')H(z')} dz'
$$

这里的 $n_e(z') = x_e(z') n_\mathrm{H}(z')$，而 $H(z')$ 是[红移](@entry_id:159945)为 $z'$ 时的哈勃参数。[光学深度](@entry_id:150612) $\tau(z)$ 衡量了从红移 $z$ 发出的[光子](@entry_id:145192)到达我们这里而不发生散射的概率 $P_{\text{no-scatter}} = e^{-\tau(z)}$。

#### [可见性函数](@entry_id:756540)

CMB[光子](@entry_id:145192)并非全部来自一个特定时刻，而是来自一个有一定厚度的“[最后散射面](@entry_id:266191)”。描述这个“面”的[概率分布](@entry_id:146404)的函数被称为**[可见性函数](@entry_id:756540)（visibility function）** $g(\eta)$。它被定义为[光子](@entry_id:145192)在[共形时间](@entry_id:263727) $\eta$ 发生最后一次散射的概率密度函数。从物理上，这等于[光子](@entry_id:145192)存活到 $\eta$ 时刻的概率 $e^{-\tau(\eta)}$ 乘以它在 $\eta$ 时刻发生散射的[微分](@entry_id:158718)概率 $\tau'(\eta) d\eta$（其中 $\tau' \equiv -d\tau/d\eta = a n_e \sigma_T$）。因此 [@problem_id:3483701]：

$$
g(\eta) = -\frac{d\tau}{d\eta} e^{-\tau(\eta)} = a(\eta) n_e(\eta) \sigma_T e^{-\tau(\eta)}
$$

由于 $g(\eta)$ 是一个概率密度函数，它满足[归一化条件](@entry_id:156486) $\int_0^{\eta_0} g(\eta) d\eta = 1 - e^{-\tau(0)} \approx 1$（假设宇宙早期是光学厚的，$\tau(0) \to \infty$）。

[可见性函数](@entry_id:756540) $g(\eta)$ 具有一个尖锐的峰值，其峰值位置对应于最后散射的平均时刻，其宽度对应于[最后散射面](@entry_id:266191)的厚度。我们可以用其矩来量化这些特性 [@problem_id:3483701]：
- **平均时间** $\bar{\eta} = \int \eta g(\eta) d\eta$
- **[方差](@entry_id:200758)（厚度）** $\sigma_\eta^2 = \int (\eta-\bar{\eta})^2 g(\eta) d\eta = M_2 - M_1^2$
- **偏度（不对称性）** $\gamma_1 = \int \left(\frac{\eta-\bar{\eta}}{\sigma_\eta}\right)^3 g(\eta) d\eta = \frac{M_3 - 3 M_1 M_2 + 2 M_1^3}{\sigma_\eta^3}$
其中 $M_n = \int \eta^n g(\eta) d\eta$ 是第 $n$ 阶[原点矩](@entry_id:165197)。复合过程的非对称性（由于复合速率与电子密度的平方成正比）导致[可见性函数](@entry_id:756540)具有一个陡峭的上升沿和一个较缓的下降尾，即正[偏度](@entry_id:178163)。

[可见性函数](@entry_id:756540)是连接理论与观测的核心。[CMB温度各向异性](@entry_id:157777)的最终观测值可以表示为沿视线方向对一个“[源函数](@entry_id:161358)” $S(k, \eta)$ 的积分，而[可见性函数](@entry_id:756540) $g(\eta)$ 正是这个[源函数](@entry_id:161358)中与散射过程相关的各项（如萨克斯-沃尔夫效应、[多普勒效应](@entry_id:160624)）的权重函数 [@problem_id:3483739]。因此，精确计算 $x_e(\eta)$ 和 $g(\eta)$ 对精确预测[CMB功率谱](@entry_id:158529)至关重要。

### 数值实现策略

精确求解复合历史的ODE系统是一个具有挑战性的数值问题，需要仔细[选择算法](@entry_id:637237)和控制策略。

#### 刚性问题与[隐式求解器](@entry_id:140315)

复合过程的ODE系统是典型的**刚性（stiff）**系统。刚性源于系统中存在多个尺度差异巨大的特征时间。在[复合时期](@entry_id:159287)，[化学反应](@entry_id:146973)的时间尺度 $t_{\text{rec}} \sim 1/(\alpha n_e)$ 远小于宇宙膨胀的哈勃时间尺度 $t_H \sim 1/H$ [@problem_id:3483684]。例如，在 $z \sim 1100$ 附近，$t_{\text{rec}} \sim 10^{10}\,\mathrm{s}$，而 $t_H \sim 10^{13}\,\mathrm{s}$，两者相差三个[数量级](@entry_id:264888)。

对于[刚性系统](@entry_id:146021)，若使用标准的显式积分方法（如[龙格-库塔法](@entry_id:140014)），为了保证数值稳定性，积分步长必须由最快的时间尺度（$t_{\text{rec}}$）来限制，这将导致计算效率极其低下。因此，必须使用为[刚性问题](@entry_id:142143)设计的**[隐式积分器](@entry_id:750552)（implicit integrators）**。这类方法（如**[后向差分](@entry_id:637618)格式 BDF**）具有更好的稳定性，允许步长远大于最快的时间尺度，从而可以高效地求解系统在慢时间尺度（$t_H$）上的演化 [@problem_id:3483711]。

#### 完整的数值工作流

一个稳健的数值计算复合历史的工作流应包含以下步骤：
1.  **设置[初始条件](@entry_id:152863)**：在足够高的红移（例如 $z_{\text{init}}=3000$）开始积分。此时，宇宙仍处于良好的热[动平衡](@entry_id:163330)中，[萨哈方程](@entry_id:139054)是 $x_e$ 的精确解。因此，我们可以用[萨哈方程](@entry_id:139054)计算初始的 $x_e$ 值（考虑到氦的贡献，此时 $x_e \approx 1+f_{\text{He}}$）[@problem_id:3483742]。
2.  **从平衡到非平衡的切换**：[萨哈方程](@entry_id:139054)的有效性在复合开始时（$x_e$ 开始显著下降）迅速瓦解。物理上，这是因为维持[激发态](@entry_id:261453)布居数的细致平衡被打破，特别是与 $n=2$ 能级相关的[光致电离](@entry_id:157870)过程因[光子能量](@entry_id:139314)的玻尔兹曼抑制而减弱。这一转变大约发生在 $z_{\text{match}} \sim 1500-1800$ [@problem_id:3483742]。因此，在数值上，我们应在此红移处从萨哈解平滑地切换到对完整非平衡皮布尔斯方程的积分。
3.  **自适应刚性积分**：使用一个[自适应步长](@entry_id:636271)的隐式[刚性求解器](@entry_id:175343)（如BDF）来积分皮布尔斯方程。步长应根据**[局部截断误差](@entry_id:147703)（LTE）**自动调整，以满足预设的绝对和相对精度要求（例如，$\|\text{LTE}\| \le \text{atol} + \text{rtol} \cdot |x_e|$）。
4.  **物理约束与[误差控制](@entry_id:169753)**：在每一步积分后，应强制施加物理约束，即 $0 \le x_e \le 1+f_{\text{He}}$，以防止数值误差导致解偏离物理范围 [@problem_id:3483684]。更精细的[误差控制](@entry_id:169753)可以直接与最终目标——[可见性函数](@entry_id:756540) $g(\eta)$ 的精度——挂钩。通过控制 $x_e$ 的误差 $\delta x_e$，我们可以限制 $g(\eta)$ 的误差 $\delta g \approx e^{-\tau}(\delta\tau' - \tau' \delta\tau)$ 在容忍度之内 [@problem_id:3483684]。

#### 结果验证

在获得数值解 $g_N(\eta)$ 后，必须对其进行严格验证。一个充分的验证协议应包括 [@problem_id:3483700]：
1.  **归一化检验**：验证 $g_N(\eta)$ 的积分是否等于其理论值。根据定义，$\int_{\eta_{\min}}^{\eta_0} g(\eta)d\eta = 1 - e^{-\tau(\eta_{\min})}$。[数值积分](@entry_id:136578)结果应在允许的容差范围内与此值相符。
2.  **正性检验**：[可见性函数](@entry_id:756540)作为概率密度，必须处处非负，$g_N(\eta) \ge 0$。不仅要在网格点上检查，还应在网格点之间进行检查（例如，通过线性插值），以确保没有因[数值振荡](@entry_id:163720)导致的负值。
3.  **收敛性检验**：通过细化网格（例如，将网格点数从 $N$ 增加到 $2N$ 和 $4N$）来检验解的收敛性。对于一个 $p$ 阶精度的数值方案，解的误差应随步长 $\Delta\eta$ 以 $(\Delta\eta)^p$ 的速率减小。一种稳健的检验方法是计算不同分辨率下解的 $L^1$ 范数差，并检查其比率是否趋近于 $2^p$，即 $\|g_{2N}-g_N\|_{L^1} / \|g_{4N}-g_{2N}\|_{L^1} \approx 2^p$。

遵循这一从物理原理到数值实现和验证的系统性方法，我们才能确保对宇宙复合历史和[可见性函数](@entry_id:756540)的计算是准确和可靠的，从而为精确的[宇宙学参数](@entry_id:161338)推断奠定坚实的基础。