{"hands_on_practices": [{"introduction": "在深入研究复合历史的数值细节之前，我们首先通过一个解析练习来理解为什么可见度函数$g(\\eta)$的精确形状至关重要。这个练习 [@problem_id:3483675] 探讨了宇宙微波背景辐射（CMB）计算中一个常见的简化——瞬时复合近似——所引入的误差。通过量化这个误差，你将亲身体会到复合过程的有限持续时间（即$g(\\eta)$的有限宽度）如何影响我们对CMB可观测量的预测。", "problem": "考虑宇宙微波背景 (CMB) 各向异性的视线积分公式，其在共形时间 $\\eta$ 下表述。其中，源项 $s(\\eta)$ 由光子可见度函数 $g(\\eta)$ 加权，并对 $\\eta$ 进行积分，得到观测到的贡献 $I \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$。可见度函数 $g(\\eta)$ 是非负的，在复合时期 $\\eta_{\\star}$ 处有尖锐的峰值，并被归一化，使得 $\\int_{-\\infty}^{\\infty} g(\\eta)\\,d\\eta = 1$。在瞬时复合近似中，我们假设 $g(\\eta)$ 在 $\\eta_{\\star}$ 周围无限窄，实际上是 $g(\\eta)\\to \\delta(\\eta-\\eta_{\\star})$，因此积分被替换为 $I_{\\mathrm{IA}} \\equiv s(\\eta_{\\star})$。\n\n为了量化 $g(\\eta)$ 的狭窄性如何证明瞬时复合近似的合理性并估计由此产生的误差，我们采用以下受控的、有物理动机的模型：\n- 将可见度函数建模为归一化的高斯函数，\n$$\ng(\\eta) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left[-\\frac{(\\eta-\\eta_{\\star})^{2}}{2\\sigma^{2}}\\right],\n$$\n宽度参数 $\\sigma \\ll \\eta_{\\star}$。\n- 将最后散射附近的源项的局域时间依赖性建模为平滑的振荡形式，\n$$\ns(\\eta) \\equiv \\cos\\!\\big(\\omega\\,(\\eta-\\eta_{\\star})\\big),\n$$\n它捕捉了角频率为 $\\omega$ 的声波振荡行为。\n\n任务：\n1. 从平滑函数相对于一个狭窄、归一化的核的中心矩展开出发，推导 $I$ 相对于 $\\sigma$ 幂次的第一个非平凡修正项，并说明在什么 $\\sigma$ 和 $\\omega$ 的条件下 $I \\approx I_{\\mathrm{IA}}$ 是精确的。\n2. 对于给定的 $g(\\eta)$ 和 $s(\\eta)$，计算精确积分 $I_{\\mathrm{exact}} \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$。\n3. 将瞬时复合近似相对于精确积分的分数误差定义为\n$$\nE(\\omega,\\sigma) \\equiv \\frac{I_{\\mathrm{IA}} - I_{\\mathrm{exact}}}{I_{\\mathrm{IA}}}.\n$$\n推导 $E(\\omega,\\sigma)$ 的单个闭式解析表达式。\n\n你的最终答案必须是 $E(\\omega,\\sigma)$ 的单个无单位的闭式解析表达式。如果你选择给出任何中间数值估计，请不要将其包含在最终答案中。如果你为了说明而给出一个数值近似，请将其四舍五入到四位有效数字，并明确指出它仅用于说明，而非最终答案。", "solution": "首先根据科学合理性、适定性和客观性标准对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n- 对 CMB 各向异性的观测贡献由积分 $I \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$ 给出。\n- 可见度函数 $g(\\eta)$ 是非负的，在 $\\eta_{\\star}$ 处有尖锐的峰值，并被归一化，使得 $\\int_{-\\infty}^{\\infty} g(\\eta)\\,d\\eta = 1$。\n- 瞬时复合近似 (IA) 的定义是将 $g(\\eta)$ 替换为狄拉克 δ 函数，$g(\\eta) \\to \\delta(\\eta-\\eta_{\\star})$，从而得到 $I_{\\mathrm{IA}} \\equiv s(\\eta_{\\star})$。\n- 可见度函数的模型是一个归一化的高斯函数：$g(\\eta) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left[-\\frac{(\\eta-\\eta_{\\star})^{2}}{2\\sigma^{2}}\\right]$，宽度 $\\sigma \\ll \\eta_{\\star}$。\n- 源项的模型是一个平滑的振荡函数：$s(\\eta) \\equiv \\cos\\!\\big(\\omega\\,(\\eta-\\eta_{\\star})\\big)$。\n- 精确积分记为 $I_{\\mathrm{exact}} \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$。\n- 分数误差定义为 $E(\\omega,\\sigma) \\equiv \\frac{I_{\\mathrm{IA}} - I_{\\mathrm{exact}}}{I_{\\mathrm{IA}}}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题是理论物理中一个结构良好的练习，特别是在数值宇宙学的背景下。\n- **科学依据**：前提是合理的。视线积分是计算 CMB 各向异性的基本形式。可见度函数描述了最后散射的概率密度，其有限宽度是一个关键的物理特征。瞬时复合近似是一种标准的、广泛使用的简化方法。使用高斯函数表示可见度函数和余弦函数表示源项是具有物理动机的，并且是用于教学和分析目的的常见简化模型。该问题不违反任何科学原理。\n- **适定性**：该问题在数学上是适定的。函数 $g(\\eta)$ 和 $s(\\eta)$ 定义良好，积分 $I$ 是收敛的。任务规定清晰，能够导出一个唯一且有意义的解。\n- **客观性**：语言精确，没有主观性。所有术语都经过解析定义。\n- **完备性**：该问题是自洽的，提供了执行所需推导和计算的所有必要信息。\n\n### 第 3 步：结论与行动\n该问题是有效的。现在开始求解过程。\n\n### 解答推导\n\n按照要求，问题分三部分解答。\n\n#### 1. 第一个非平凡修正项与精度条件\n\n我们从积分 $I = \\int_{-\\infty}^{\\infty} g(\\eta) s(\\eta) d\\eta$ 开始。函数 $s(\\eta)$ 是平滑的，而核 $g(\\eta)$ 在 $\\eta = \\eta_{\\star}$ 处有尖峰。我们可以将 $s(\\eta)$ 在 $\\eta_{\\star}$ 附近进行泰勒展开：\n$$\ns(\\eta) = s(\\eta_{\\star}) + (\\eta - \\eta_{\\star}) s'(\\eta_{\\star}) + \\frac{1}{2!} (\\eta - \\eta_{\\star})^2 s''(\\eta_{\\star}) + \\mathcal{O}((\\eta - \\eta_{\\star})^3)\n$$\n将此展开式代入 $I$ 的积分中：\n$$\nI = \\int_{-\\infty}^{\\infty} g(\\eta) \\left[ s(\\eta_{\\star}) + (\\eta - \\eta_{\\star}) s'(\\eta_{\\star}) + \\frac{1}{2} (\\eta - \\eta_{\\star})^2 s''(\\eta_{\\star}) + \\dots \\right] d\\eta\n$$\n根据积分的线性性质，我们可以将其写成分布 $g(\\eta)$ 的矩的总和：\n$$\nI = s(\\eta_{\\star}) \\int_{-\\infty}^{\\infty} g(\\eta) d\\eta + s'(\\eta_{\\star}) \\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star}) g(\\eta) d\\eta + \\frac{1}{2} s''(\\eta_{\\star}) \\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star})^2 g(\\eta) d\\eta + \\dots\n$$\n这些积分对应于 $g(\\eta)$ 关于其均值 $\\eta_{\\star}$ 的矩。\n- 零阶矩是概率密度的归一化：$\\int_{-\\infty}^{\\infty} g(\\eta) d\\eta = 1$。\n- 一阶中心矩是平均偏差，对于以 $\\eta_{\\star}$ 为中心的对称分布，该值为零：$\\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star}) g(\\eta) d\\eta = 0$。\n- 二阶中心矩是方差，对于给定的高斯模型，该值为 $\\sigma^2$：$\\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star})^2 g(\\eta) d\\eta = \\sigma^2$。\n\n代入这些矩值， $I$ 的展开式变为：\n$$\nI = s(\\eta_{\\star}) + \\frac{\\sigma^2}{2} s''(\\eta_{\\star}) + \\mathcal{O}(\\sigma^4)\n$$\n瞬时复合近似为 $I_{\\mathrm{IA}} = s(\\eta_{\\star})$。对此近似的第一个非平凡修正项是 $\\sigma^2$ 阶的项，即 $\\frac{\\sigma^2}{2} s''(\\eta_{\\star})$。\n\n对于给定的源项 $s(\\eta) = \\cos(\\omega(\\eta - \\eta_{\\star}))$，我们计算其在 $\\eta_{\\star}$ 处的导数：\n- $s(\\eta_{\\star}) = \\cos(0) = 1$。\n- $s'(\\eta) = -\\omega \\sin(\\omega(\\eta - \\eta_{\\star})) \\implies s'(\\eta_{\\star}) = 0$。\n- $s''(\\eta) = -\\omega^2 \\cos(\\omega(\\eta - \\eta_{\\star})) \\implies s''(\\eta_{\\star}) = -\\omega^2$。\n\n因此，$I$ 的近似值为：\n$$\nI \\approx 1 - \\frac{\\omega^2 \\sigma^2}{2}\n$$\n当修正项的量级远小于领头项时，近似 $I \\approx I_{\\mathrm{IA}} = 1$ 是精确的。这给出了条件：\n$$\n\\left| -\\frac{\\omega^2 \\sigma^2}{2} \\right| \\ll 1 \\implies \\frac{\\omega^2 \\sigma^2}{2} \\ll 1\n$$\n这等价于 $\\omega \\sigma \\ll \\sqrt{2}$，或者更普遍地表述为关于尺度的条件，即 $\\omega \\sigma \\ll 1$。这意味着源的振荡周期 ($2\\pi/\\omega$) 远大于复合的持续时间 ($\\sim \\sigma$)。\n\n#### 2. 精确积分计算\n\n我们计算精确积分 $I_{\\mathrm{exact}}$：\n$$\nI_{\\mathrm{exact}} = \\int_{-\\infty}^{\\infty} g(\\eta) s(\\eta) d\\eta = \\int_{-\\infty}^{\\infty} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left[-\\frac{(\\eta-\\eta_{\\star})^{2}}{2\\sigma^{2}}\\right] \\cos(\\omega(\\eta-\\eta_{\\star})) d\\eta\n$$\n让我们引入换元 $x = \\eta - \\eta_{\\star}$，因此 $dx = d\\eta$。积分上下限保持为 $(-\\infty, \\infty)$：\n$$\nI_{\\mathrm{exact}} = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\int_{-\\infty}^{\\infty} \\exp\\left[-\\frac{x^2}{2\\sigma^2}\\right] \\cos(\\omega x) dx\n$$\n这个积分可以通过认识到 $\\cos(\\omega x) = \\Re\\{\\exp(i\\omega x)\\}$ 来求解。该积分是高斯函数的傅里叶变换的实部。\n$$\nI_{\\mathrm{exact}} = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\Re\\left\\{ \\int_{-\\infty}^{\\infty} \\exp\\left[-\\frac{x^2}{2\\sigma^2}\\right] \\exp(i\\omega x) dx \\right\\}\n$$\n内部积分的形式为 $\\int_{-\\infty}^{\\infty} \\exp(-ax^2 + bx) dx$，其中 $a = 1/(2\\sigma^2)$ 且 $b = i\\omega$。这个标准高斯积分的计算结果为 $\\sqrt{\\pi/a} \\exp(b^2/(4a))$。\n- $a = \\frac{1}{2\\sigma^2}$\n- $b^2/(4a) = (i\\omega)^2 / (4 \\cdot \\frac{1}{2\\sigma^2}) = -\\omega^2 / (\\frac{2}{\\sigma^2}) = -\\frac{\\omega^2\\sigma^2}{2}$。\n- $\\sqrt{\\pi/a} = \\sqrt{\\pi \\cdot 2\\sigma^2} = \\sqrt{2\\pi}\\sigma$。\n\n所以复积分是：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left[-\\frac{x^2}{2\\sigma^2}\\right] \\exp(i\\omega x) dx = \\sqrt{2\\pi}\\sigma \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\n$$\n将此结果代回 $I_{\\mathrm{exact}}$ 的表达式中：\n$$\nI_{\\mathrm{exact}} = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\Re\\left\\{ \\sqrt{2\\pi}\\sigma \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right) \\right\\}\n$$\n由于实部算子内的表达式已经是实数，我们得到：\n$$\nI_{\\mathrm{exact}} = \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\n$$\n\n另外，该积分表示均值为 $0$、方差为 $\\sigma^2$ 的正态分布的特征函数在 $\\omega$ 处的值。特征函数 $\\phi_X(t) = \\mathbb{E}[\\exp(itX)] = \\exp(i\\mu t - \\frac{1}{2}\\sigma^2 t^2)$。对于 $\\mu=0$，$\\phi_X(t) = \\exp(-\\frac{1}{2}\\sigma^2 t^2)$。积分 $\\int P(x)\\cos(\\omega x) dx = \\Re\\{\\mathbb{E}[\\exp(i\\omega X)]\\} = \\Re\\{\\phi_X(\\omega)\\} = \\exp(-\\frac{1}{2}\\sigma^2 \\omega^2)$。\n\n#### 3. 分数误差计算\n\n分数误差定义为 $E(\\omega,\\sigma) = \\frac{I_{\\mathrm{IA}} - I_{\\mathrm{exact}}}{I_{\\mathrm{IA}}}$。\n我们有必要的组成部分：\n- $I_{\\mathrm{IA}} = s(\\eta_{\\star}) = \\cos(\\omega(\\eta_{\\star}-\\eta_{\\star})) = \\cos(0) = 1$。\n- $I_{\\mathrm{exact}} = \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)$。\n\n将这些代入误差的定义中：\n$$\nE(\\omega,\\sigma) = \\frac{1 - \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)}{1}\n$$\n这可以简化为分数误差的最终闭式解析表达式：\n$$\nE(\\omega,\\sigma) = 1 - \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\n$$\n作为一致性检查，我们可以对小的 $\\omega\\sigma$ 展开此式。使用泰勒级数 $\\exp(-x) \\approx 1 - x + x^2/2 - \\dots$，其中 $x = \\omega^2\\sigma^2/2$：\n$$\nE(\\omega,\\sigma) \\approx 1 - \\left(1 - \\frac{\\omega^2\\sigma^2}{2}\\right) = \\frac{\\omega^2\\sigma^2}{2}\n$$\n这与第 1 部分中从一阶修正推导出的相对误差 $\\frac{I_{\\mathrm{IA}} - I}{I_{\\mathrm{IA}}} = \\frac{1 - (1 - \\omega^2\\sigma^2/2)}{1} = \\frac{\\omega^2\\sigma^2}{2}$ 相匹配，证实了我们结果的一致性。", "answer": "$$\n\\boxed{1 - \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)}\n$$", "id": "3483675"}, {"introduction": "掌握了可见度函数宽度的重要性之后，我们转向一个核心的数值实践：从第一性原理出发，构建可见度函数本身。这个练习 [@problem_id:3483730] 要求你利用给定的自由电子分数$x_e(z)$和标准的$\\Lambda$CDM宇宙学模型，通过数值积分计算视线光学深度$\\tau(z)$。在此基础上，你将计算出可见度函数$g(z)$，并确定其峰值位置$z_g$，即我们所观测到的“最后散射面”的红移。", "problem": "给定一个空间平坦的 Lambda 冷暗物质 (ΛCDM) 宇宙学模型和一个作为红移函数的光滑自由电子分数模型，记为 $x_e(z)$。您的任务是，从第一性原理出发，利用膨胀宇宙中辐射转移的基本定义，构建一个数值方法来计算到红移 $z$ 处的视线汤姆逊光学深度，记为 $\\tau(z)$。然后，您需要确定在指定红移区间内导数 $d\\tau/dz$ 达到其最大值的位置 $z_\\star$，并将其与可见性函数峰值的位置进行比较，您必须根据 $\\tau(z)$ 和 $d\\tau/dz$ 来定义该可见性函数。\n\n从以下物理基础出发：\n- 光学深度微元定义为 $d\\tau = n_e \\sigma_T c \\, dt$，其中 $n_e$ 是自由电子数密度，$\\sigma_T$ 是汤姆逊散射截面，$c$ 是光速。\n- 在膨胀宇宙中，红移-时间关系为 $dt/dz = -\\big[(1+z) H(z)\\big]^{-1}$，其中 $H(z)$ 是哈勃膨胀率。\n- 在平坦的 $\\Lambda$ 冷暗物质 (ΛCDM) 宇宙学中，哈勃膨胀率由 $H(z) = H_0 \\sqrt{\\Omega_r (1+z)^4 + \\Omega_m (1+z)^3 + \\Omega_\\Lambda}$ 给出，其中 $H_0$ 是今天的哈勃常数，$\\Omega_r$ 是当今的辐射密度参数，$\\Omega_m$ 是当今的物质密度参数，$\\Omega_\\Lambda$ 是当今的宇宙学常数密度参数。假设空间是平坦的，因此 $\\Omega_r + \\Omega_m + \\Omega_\\Lambda = 1$ 在您的实现中无需数值上强制执行，但物理上确实如此。\n- 当今的临界密度为 $\\rho_{c,0} = 3 H_0^2 / (8 \\pi G)$，当今的重子质量密度为 $\\rho_{b,0} = \\Omega_b \\rho_{c,0}$，其中 $\\Omega_b$ 是当今的重子密度参数，$G$ 是引力常数。\n- 用 $Y_p$ 表示原初氦质量分数。氢质量分数为 $X_p = 1 - Y_p$。对于本问题，假设在复合窗口期氦不贡献自由电子，因此 $n_e(z) = x_e(z) \\, n_H(z)$，其中 $n_H(z) = X_p \\rho_b(z) / m_p$ 且 $\\rho_b(z) = \\rho_{b,0} (1+z)^3$，$m_p$ 是质子质量。\n\n自由电子分数 $x_e(z)$ 被建模为一个平滑过渡，从高红移处的完全电离等离子体过渡到低红移处的少量残余电离，使用以复合红移 $z_\\mathrm{rec}$ 为中心、宽度为 $\\Delta_z$、残余电离为 $x_\\mathrm{res}$ 的双曲正切分布：\n$$\nx_e(z) = x_\\mathrm{res} + \\frac{1 - x_\\mathrm{res}}{2} \\left[ 1 + \\tanh\\left( \\frac{z - z_\\mathrm{rec}}{\\Delta_z} \\right) \\right].\n$$\n\n对于本问题，将红移空间中的可见性函数定义为\n$$\ng(z) = e^{-\\tau(z)} \\, \\frac{d\\tau}{dz},\n$$\n并将其最大值位置 $z_g$ 解释为最后散射面的红移。\n\n实现要求：\n- 内部物理常数完全使用国际单位制 (SI)。红移是无量纲的，并且必须如此报告。\n- 为每个测试案例构建一个均匀的红移网格 $z_i$（$i=0,\\dots,N$），覆盖 $z \\in [0, z_{\\max}]$。通过从 $z=0$ 开始使用稳定的累积梯形法则对 $d\\tau/dz$ 进行数值积分，来计算此网格上的 $\\tau(z)$。然后在网格上计算 $g(z)$，并使用简单的 argmax 在闭区间 $[0, z_{\\max}]$ 上找到 $d\\tau/dz$ 和 $g(z)$ 的最大值。\n- 对于每个测试案例，报告两个浮点数红移：$z_\\star$（在 $[0, z_{\\max}]$ 上 $d\\tau/dz$ 达到其最大值的位置）和 $z_g$（在 $[0, z_{\\max}]$ 上 $g(z)$ 达到其最大值的位置）。将每个报告的红移四舍五入到一位小数。红移是无量纲的；不应打印任何物理单位。\n\n使用的物理常数（SI值）：\n- $c = 299{,}792{,}458$ 米/秒。\n- $\\sigma_T = 6.652\\,458\\,7321 \\times 10^{-29}$ 平方米。\n- $G = 6.674\\,30 \\times 10^{-11}$ 立方米/千克/平方秒。\n- $m_p = 1.672\\,621\\,923\\,69 \\times 10^{-27}$ 千克。\n- $1$ 百万秒差距 $= 3.085\\,677\\,581 \\times 10^{22}$ 米。\n\n测试套件：\n实现您的程序以运行以下三个测试案例。对于每个案例，按指定构建网格大小 $N$ 和上限 $z_{\\max}$，并计算所要求的输出。\n\n- 案例 A (正常路径)：\n  - $H_0 = 67.66$ 千米/秒/百万秒差距。\n  - $\\Omega_m = 0.3111$。\n  - $\\Omega_b = 0.0490$。\n  - $\\Omega_r = 9.236 \\times 10^{-5}$。\n  - $\\Omega_\\Lambda = 0.6888064$。\n  - $Y_p = 0.24$。\n  - $z_\\mathrm{rec} = 1090$。\n  - $\\Delta_z = 80$。\n  - $x_\\mathrm{res} = 2 \\times 10^{-4}$。\n  - $z_{\\max} = 1800$。\n  - $N = 20000$。\n\n- 案例 B (窄复合宽度)：\n  - $H_0 = 70.0$ 千米/秒/百万秒差距。\n  - $\\Omega_m = 0.3000$。\n  - $\\Omega_b = 0.0480$。\n  - $\\Omega_r = 9.000 \\times 10^{-5}$。\n  - $\\Omega_\\Lambda = 0.69991$。\n  - $Y_p = 0.24$。\n  - $z_\\mathrm{rec} = 1080$。\n  - $\\Delta_z = 15$。\n  - $x_\\mathrm{res} = 1 \\times 10^{-4}$。\n  - $z_{\\max} = 1600$。\n  - $N = 30000$。\n\n- 案例 C (较低重子分数，不同膨胀)：\n  - $H_0 = 73.0$ 千米/秒/百万秒差距。\n  - $\\Omega_m = 0.2700$。\n  - $\\Omega_b = 0.0300$。\n  - $\\Omega_r = 9.000 \\times 10^{-5}$。\n  - $\\Omega_\\Lambda = 0.72991$。\n  - $Y_p = 0.24$。\n  - $z_\\mathrm{rec} = 1050$。\n  - $\\Delta_z = 50$。\n  - $x_\\mathrm{res} = 5 \\times 10^{-4}$。\n  - $z_{\\max} = 1700$。\n  - $N = 20000$。\n\n答案规范：\n- 对于每个测试案例，输出一个包含 $z_\\star$ 和 $z_g$ 的列表，两者均四舍五入到一位小数。\n- 您的程序应生成单行输出，其中包含作为逗号分隔列表的结果，该列表由三个测试案例列表组成，并用方括号括起来。例如，输出格式必须为 \"[[zstar_A,zg_A],[zstar_B,zg_B],[zstar_C,zg_C]]\" 的形式，并用实际数值替换。红移是无量纲的，打印时不得带任何单位。", "solution": "该问题要求在一个平坦的 $\\Lambda$CDM 宇宙学模型中，数值计算汤姆逊散射光学深度 $\\tau(z)$ 和相关的可见性函数 $g(z)$。目标是确定分别对应于光学深度导数 $d\\tau/dz$ 和可见性函数最大值的红移 $z_\\star$ 和 $z_g$。这将针对三组不同的宇宙学参数进行。\n\n### 步骤 1：理论公式\n\n基本量是光子行进路径长度 $dl$ 时所经历的光学深度微元 $d\\tau$：\n$$d\\tau = n_e \\sigma_T dl$$\n其中 $n_e$ 是自由电子数密度，$\\sigma_T$ 是汤姆逊散射截面。对于在膨胀宇宙中沿视线传播的光子，路径长度元 $dl$ 与时间间隔 $dt$ 的关系为 $dl = c \\, dt$。因此，\n$$d\\tau = n_e \\sigma_T c \\, dt$$\n在宇宙学中，使用红移 $z$ 作为自变量更为方便。微分时间间隔 $dt$ 和微分红移间隔 $dz$ 之间的关系由下式给出：\n$$\\frac{dt}{dz} = -\\frac{1}{(1+z)H(z)}$$\n其中 $H(z)$ 是红移 $z$ 处的哈勃膨胀率。负号表示时间随着红移的减小而增加。\n\n到红移 $z$ 的总光学深度是 $d\\tau$ 从今天（时间 $t_0$，红移 $z=0$）到对应于该红移的更早时间 $t(z)$ 的积分：\n$$\\tau(z) = \\int_{t(z)}^{t_0} n_e(t') \\sigma_T c \\, dt'$$\n通过将积分变量从 $t'$ 更改为 $z'$，我们得到：\n$$\\tau(z) = \\int_{z}^{0} n_e(z') \\sigma_T c \\left( \\frac{dt}{dz'} \\right) dz' = \\int_{z}^{0} n_e(z') \\sigma_T c \\left( -\\frac{1}{(1+z')H(z')} \\right) dz'$$\n反转积分限以消除负号，我们得到 $\\tau(z)$ 作为从 $z'=0$ 到 $z'=z$ 的积分表达式：\n$$\\tau(z) = \\int_{0}^{z} \\frac{n_e(z') \\sigma_T c}{(1+z')H(z')} dz'$$\n从这个积分形式，我们可以确定光学深度相对于红移的导数：\n$$\\frac{d\\tau}{dz} = \\frac{n_e(z) \\sigma_T c}{(1+z)H(z)}$$\n\n### 步骤 2：在 $\\Lambda$CDM 模型中推导各物理量\n\n为了计算 $d\\tau/dz$，我们需要在指定的宇宙学模型中 $n_e(z)$ 和 $H(z)$ 的显式表达式。\n\n在空间平坦的 $\\Lambda$CDM 宇宙中，哈勃膨胀率为：\n$$H(z) = H_0 \\sqrt{\\Omega_r (1+z)^4 + \\Omega_m (1+z)^3 + \\Omega_\\Lambda}$$\n其中 $H_0$ 是哈勃常数，$\\Omega_r$、$\\Omega_m$ 和 $\\Omega_\\Lambda$ 分别是当今的辐射、物质和宇宙学常数的密度参数。我们可以写成 $H(z) = H_0 E(z)$，其中 $E(z)$ 是平方根下的无量纲演化函数。\n\n自由电子数密度 $n_e(z)$ 由自由电子分数 $x_e(z)$ 和氢数密度 $n_H(z)$ 的乘积给出，假设在氢复合时期，氦对自由电子布居的贡献不显著。\n$$n_e(z) = x_e(z) n_H(z)$$\n氢数密度 $n_H(z)$ 与重子质量密度 $\\rho_b(z)$ 相关。给定原初氦质量分数 $Y_p$，氢质量分数为 $X_p = 1 - Y_p$。\n$$n_H(z) = \\frac{X_p \\rho_b(z)}{m_p}$$\n其中 $m_p$ 是质子质量。重子密度随红移的变化关系为 $\\rho_b(z) = \\rho_{b,0}(1+z)^3$，其中 $\\rho_{b,0}$ 是当今的重子密度。这又与当今的临界密度 $\\rho_{c,0}$ 和重子密度参数 $\\Omega_b$ 相关：\n$$\\rho_{b,0} = \\Omega_b \\rho_{c,0} = \\Omega_b \\frac{3 H_0^2}{8 \\pi G}$$\n其中 $G$ 是牛顿引力常数。\n\n合并这些 $n_e(z)$ 的表达式：\n$$n_e(z) = x_e(z) \\frac{(1-Y_p)}{m_p} \\left(\\Omega_b \\frac{3 H_0^2}{8 \\pi G}\\right) (1+z)^3$$\n将 $n_e(z)$ 和 $H(z)$ 代入 $d\\tau/dz$ 的方程中：\n$$\\frac{d\\tau}{dz} = \\frac{x_e(z) \\left[ \\frac{(1-Y_p)\\Omega_b}{m_p} \\frac{3 H_0^2}{8 \\pi G} (1+z)^3 \\right] \\sigma_T c}{(1+z)H_0 E(z)}$$\n通过合并常数来简化此表达式，可得：\n$$\\frac{d\\tau}{dz} = \\left[ \\frac{3 H_0 \\sigma_T c (1-Y_p) \\Omega_b}{8 \\pi G m_p} \\right] x_e(z) \\frac{(1+z)^2}{E(z)}$$\n对于给定的宇宙学模型，方括号中的项是一个常数，我们可以预先计算它以简化数值计算。让我们用 $\\mathcal{C}$ 表示这个常数。自由电子分数 $x_e(z)$ 由指定的双曲正切模型给出。\n\n### 步骤 3：可见性函数和峰值位置\n\n可见性函数 $g(z)$ 定义为：\n$$g(z) = e^{-\\tau(z)} \\frac{d\\tau}{dz}$$\n这个函数可以解释为最后散射红移的概率密度函数。也就是说，$g(z)dz$ 是今天观测到的一个 CMB 光子在红移 $z$ 和 $z+dz$ 之间发生最后散射的概率。因此，该函数的峰值 $z_g$ 是一个关键的可观测量，代表了最后散射面的最概然红移。\n\n我们被要求找出分别使 $d\\tau/dz$ 和 $g(z)$ 最大化的红移 $z_\\star$ 和 $z_g$。\n- $z_\\star$ 是单位红移的相互作用率达到最大的红移。\n- $z_g$ 是最后散射概率达到最大的红移。\n\n为了找到 $g(z)$ 的最大值，我们将其导数设为零。设 $f(z) = d\\tau/dz$。则 $g(z) = f(z)e^{-\\tau(z)}$。\n$$g'(z) = f'(z)e^{-\\tau(z)} - f(z)\\tau'(z)e^{-\\tau(z)} = e^{-\\tau(z)}[f'(z) - (f(z))^2] = 0$$\n这意味着 $f'(z_g) = (f(z_g))^2$。\n$f(z) = d\\tau/dz$ 的峰值出现在 $z_\\star$ 处，此时 $f'(z_\\star) = 0$。在此红移处，可见性函数的导数为 $g'(z_\\star) = -e^{-\\tau(z_\\star)}(f(z_\\star))^2  0$。由于在 $z=z_\\star$ 处 $g(z)$ 的导数为负，这意味着 $g(z)$ 在该点是一个递减函数。因此，可见性函数的峰值必须出现在一个更低的红移处，即 $z_g  z_\\star$。因子 $e^{-\\tau(z)}$ 代表光子在不发生进一步散射的情况下到达观测者的概率，是 $z$ 的一个单调递减函数，因此与 $d\\tau/dz$ 的峰值相比，它将乘积 $g(z)$ 的峰值移向更低的红移。\n\n### 步骤 4：数值算法\n\n对于每个测试案例，按照以下步骤进行数值求解：\n1.  **设置和单位转换**：所有物理常数（$c, \\sigma_T, G, m_p$）均以 SI 单位定义。以 km s$^{-1}$ Mpc$^{-1}$ 为单位给出的哈勃常数 $H_0$ 使用提供的百万秒差距到米的转换因子转换为 s$^{-1}$。\n2.  **红移网格**：创建一个从 $z=0$ 到 $z=z_{\\max}$ 包含 $N+1$ 个点的均匀红移网格 $z_i$。\n3.  **计算 $d\\tau/dz$**：计算常数因子 $\\mathcal{C}$。然后，对于网格上的每个点 $z_i$，计算函数 $E(z_i)$ 和 $x_e(z_i)$，并使用推导出的公式计算 $d\\tau/dz$ 的数组。\n4.  **计算 $\\tau(z)$**：通过从 $z=0$ 到每个 $z_i$ 对 $d\\tau/dz$ 数组进行数值积分来计算光学深度 $\\tau(z_i)$。`scipy.integrate.cumulative_trapezoid` 函数非常适合此任务，因为它高效地实现了累积梯形法则。我们确保 $\\tau(0)=0$。\n5.  **计算 $g(z)$**：使用计算出的 $\\tau(z)$ 和 $d\\tau/dz$ 数组，在每个网格点上计算可见性函数 $g(z_i)$。\n6.  **寻找最大值**：使用 `numpy.argmax` 函数来查找 $d\\tau/dz$ 和 $g(z)$ 数组中最大值的索引。这些索引对应于 $z_\\star$ 和 $z_g$ 的网格位置。\n7.  **报告结果**：将得到的红移值 $z_\\star$ 和 $z_g$ 四舍五入到一位小数并存储。最终输出格式化为列表的列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the redshifts of maximum interaction rate (z_star) and maximum\n    visibility (z_g) for given cosmological models.\n    \"\"\"\n    # Physical constants in SI units\n    C_LIGHT = 299792458.0          # Speed of light (m/s)\n    SIGMA_T = 6.6524587321e-29     # Thomson cross-section (m^2)\n    G_NEWTON = 6.67430e-11         # Gravitational constant (m^3 kg^-1 s^-2)\n    M_P = 1.67262192369e-27        # Proton mass (kg)\n    MPC_TO_M = 3.085677581e22      # Megaparsec to meters conversion\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"H0_km_s_Mpc\": 67.66, \"Omega_m\": 0.3111, \"Omega_b\": 0.0490,\n            \"Omega_r\": 9.236e-5, \"Omega_L\": 0.6888064, \"Yp\": 0.24,\n            \"z_rec\": 1090.0, \"Delta_z\": 80.0, \"x_res\": 2e-4,\n            \"z_max\": 1800, \"N\": 20000\n        },\n        {\n            \"H0_km_s_Mpc\": 70.0, \"Omega_m\": 0.3000, \"Omega_b\": 0.0480,\n            \"Omega_r\": 9.000e-5, \"Omega_L\": 0.69991, \"Yp\": 0.24,\n            \"z_rec\": 1080.0, \"Delta_z\": 15.0, \"x_res\": 1e-4,\n            \"z_max\": 1600, \"N\": 30000\n        },\n        {\n            \"H0_km_s_Mpc\": 73.0, \"Omega_m\": 0.2700, \"Omega_b\": 0.0300,\n            \"Omega_r\": 9.000e-5, \"Omega_L\": 0.72991, \"Yp\": 0.24,\n            \"z_rec\": 1050.0, \"Delta_z\": 50.0, \"x_res\": 5e-4,\n            \"z_max\": 1700, \"N\": 20000\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Convert H0 to SI units (s^-1)\n        H0_si = case[\"H0_km_s_Mpc\"] * 1000.0 / MPC_TO_M\n        \n        # Pre-compute the constant factor for d(tau)/dz\n        # C = (3 * H0 * sigma_T * c * (1 - Yp) * Omega_b) / (8 * pi * G * m_p)\n        prefactor = (3 * H0_si * SIGMA_T * C_LIGHT * (1 - case[\"Yp\"]) * case[\"Omega_b\"]) / \\\n                    (8 * np.pi * G_NEWTON * M_P)\n\n        # Create a uniform redshift grid\n        z_grid = np.linspace(0, case[\"z_max\"], case[\"N\"] + 1)\n        one_plus_z = 1 + z_grid\n        \n        # Dimensionless Hubble parameter evolution E(z) = H(z)/H0\n        E_z = np.sqrt(case[\"Omega_r\"] * one_plus_z**4 + \n                      case[\"Omega_m\"] * one_plus_z**3 + \n                      case[\"Omega_L\"])\n        \n        # Free-electron fraction x_e(z) using the tanh model\n        x_e_z = case[\"x_res\"] + (1 - case[\"x_res\"]) / 2.0 * \\\n              (1 + np.tanh((z_grid - case[\"z_rec\"]) / case[\"Delta_z\"]))\n        \n        # Differential optical depth d(tau)/dz\n        dtau_dz = prefactor * x_e_z * (one_plus_z**2) / E_z\n        \n        # Total optical depth tau(z) by cumulative trapezoidal integration\n        # tau(z) is the integral of d(tau)/dz' from z'=0 to z.\n        # cumulative_trapezoid with initial=0 gives an array of the same size as input.\n        tau_z = cumulative_trapezoid(dtau_dz, z_grid, initial=0)\n        \n        # Visibility function g(z) = exp(-tau(z)) * d(tau)/dz\n        g_z = np.exp(-tau_z) * dtau_dz\n        \n        # Find redshift of maximum d(tau)/dz\n        idx_star = np.argmax(dtau_dz)\n        z_star = z_grid[idx_star]\n        \n        # Find redshift of maximum g(z)\n        idx_g = np.argmax(g_z)\n        z_g = z_grid[idx_g]\n        \n        # Store the rounded results for this case\n        results.append([round(z_star, 1), round(z_g, 1)])\n\n    # Final print statement in the exact required format.\n    print(f\"{results}\".replace(\" \", \"\"))\n\nsolve()\n```", "id": "3483730"}, {"introduction": "为了将我们的理解推向更前沿的应用，最后一个练习将探讨可见度函数如何响应复合物理的微小变化。在共形时间$\\eta$（CMB物理学的自然时间变量）的框架下，你将不仅要构建可见度函数$g(\\eta)$，还要推导并计算其对自由电子分数$x_e(\\eta)$的微扰的线性响应 [@problem_id:3483751]。这项技能对于精确宇宙学至关重要，因为它揭示了复合历史的不确定性如何传递到最终的CMB可观测量中。", "problem": "你需要构建一个数值计算流程，根据 Thomson 光学厚度 $\\tau(\\eta)$ 的定义来构建可见性函数 $g(\\eta)$，并量化 $g(\\eta)$ 对自由电子分数 $x_{e}(\\eta)$ 中小的分数微扰的线性响应。整个计算过程完全在共形时间 $\\eta$ 中进行，并通过将当前共形时间固定为 $\\eta_{0}=1$ 来将所有量视为无量纲量。你的任务必须仅使用下面列出的定义和经过充分检验的关系式来执行，并且必须按照最后一节的规定，实现为一个完整的、可运行的程序。\n\n待使用的基础定义与假设：\n- 共形时间 $\\eta$ 与标度因子 $a(\\eta)$ 相关。在氢复合的红移范围内，物质主导是一个很好的近似，因此你可以将 $a(\\eta)$ 建模为 $a(\\eta)=\\left(\\eta/\\eta_{0}\\right)^{2}$。\n- 从共形时间 $\\eta$ 到当前时刻的光学厚度定义为\n$$\n\\tau(\\eta)=\\int_{\\eta}^{\\eta_{0}} a(\\eta')\\, n_{e}(\\eta')\\, \\sigma_{T}\\, d\\eta' ,\n$$\n其中 $n_{e}(\\eta)$ 是自由电子数密度，$\\sigma_{T}$ 是 Thomson 截面，两者均可视为常数，即 $\\sigma_{T}$ 不依赖于 $\\eta$，而 $n_{e}$ 仅通过下述的 $x_{e}(\\eta)$ 和 $a(\\eta)$ 依赖于 $\\eta$。根据定义，令 $\\dot{\\tau}(\\eta)\\equiv a(\\eta)\\,n_{e}(\\eta)\\,\\sigma_{T}$。\n- 可见性函数 $g(\\eta)$ 是光子在共形时间区间 $[\\eta,\\eta+d\\eta]$ 内发生最后散射的微分概率密度。请基于光子在 $\\eta$ 和 $\\eta_{0}$ 之间无散射地自由传播的概率以及在 $\\eta$ 处的瞬时散射率来构建 $g(\\eta)$。\n- 共动氢数密度满足标度关系 $n_{H}(\\eta)=n_{H0}\\, a(\\eta)^{-3}$，其中 $n_{H0}$ 是一个常数。自由电子密度为 $n_{e}(\\eta)=x_{e}(\\eta)\\, n_{H}(\\eta)$。\n- 使用以下形式对未微扰的复合历史进行建模，该模型描述了 $x_e(\\eta)$ 从早期完全电离状态到晚期少量残余电离状态的平滑过渡：\n$$\nx_{e}^{(0)}(\\eta)=x_{\\mathrm{res}}+\\frac{1}{2}\\,\\bigl(x_{\\mathrm{pre}}-x_{\\mathrm{res}}\\bigr)\\,\\Bigl[1-\\tanh\\Bigl(\\frac{\\eta-\\eta_{c}}{w}\\Bigr)\\Bigr],\n$$\n其中 $x_{\\mathrm{pre}}=1.0$ 是复合前电离分数，$x_{\\mathrm{res}}=2\\times 10^{-4}$ 是复合后残余电离分数，$\\eta_{c}=0.03\\,\\eta_{0}$ 是过渡中心， $w=0.01\\,\\eta_{0}$ 是过渡宽度。\n- 使用 $n_{H0}\\,\\sigma_{T}\\,\\eta_{0}=10^{-4}$ 来设定这些无量纲单位下光学厚度的整体归一化系数。\n- 假设自由电子分数的小微扰以乘法形式施加：$x_{e}(\\eta)\\to x_{e}^{(0)}(\\eta)\\,\\bigl[1+\\delta x_{e}(\\eta)/x_{e}(\\eta)\\bigr]$，其中 $\\left|\\delta x_{e}/x_{e}\\right|\\ll 1$。推导可见性函数的一阶分数变化 $\\delta g(\\eta)/g(\\eta)$，并用 $\\delta x_{e}(\\eta)/x_{e}(\\eta)$ 和未微扰的背景量表示。你的推导必须从上述定义和 $g(\\eta)$ 作为微分概率密度的解释出发，并且不得引入任何额外的经验拟合公式。\n\n待实现的计算任务：\n1. 在共形时间 $\\eta\\in[\\eta_{\\min},\\eta_{0}]$（其中 $\\eta_{\\min}=10^{-4}\\,\\eta_{0}$ 且 $\\eta_{0}=1$）上构建一个均匀网格。在此网格上，计算 $a(\\eta)$、$n_{e}(\\eta)$、$\\dot{\\tau}(\\eta)$、从 $\\eta$ 到 $\\eta_0$ 的光学厚度 $\\tau(\\eta)$，以及可见性函数 $g(\\eta)$。\n2. 确定峰值位置 $\\eta_{\\ast}$，即 $g(\\eta)$ 在 $[\\eta_{\\min},\\eta_{0}]$ 上达到其全局最大值时的 $\\eta$ 值。以 $\\eta_0$ 为单位报告无量纲值 $\\eta_{\\ast}$。\n3. 为 $\\delta x_{e}(\\eta)/x_{e}(\\eta)$ 定义三种具有相同振幅 $\\epsilon=10^{-3}$ 的小微扰轮廓：\n   - 情况 A (常数)：$\\delta x_{e}(\\eta)/x_{e}(\\eta)=\\epsilon$，对所有 $\\eta$ 成立。\n   - 情况 B (高斯型, 局域在复合时期附近)：$\\delta x_{e}(\\eta)/x_{e}(\\eta)=\\epsilon\\,\\exp\\Bigl(-\\frac{(\\eta-\\eta_{c})^{2}}{2\\,\\sigma^{2}}\\Bigr)$，其中 $\\sigma=0.005\\,\\eta_{0}$。\n   - 情况 C (振荡型)：$\\delta x_{e}(\\eta)/x_{e}(\\eta)=\\epsilon\\,\\cos\\Bigl(2\\pi\\,\\frac{\\eta/\\eta_{0}}{P}\\Bigr)$，其中 $P=0.05$。\n4. 使用你推导出的 $\\delta g(\\eta)/g(\\eta)$ 的一阶表达式，在相同的网格上计算每种微扰情况下的响应。为避免可见性权重可忽略不计的时间段产生主导影响，请将最大值的评估限制在 $g(\\eta)/\\max_{\\eta}g(\\eta)\\ge 10^{-8}$ 的网格子集上。\n5. 对每种微扰情况，计算：\n   - 在受限域上的最大绝对分数变化, $\\max_{\\eta}\\left|\\delta g(\\eta)/g(\\eta)\\right|$。\n   - 在基线峰值处的分数变化, $\\left.\\delta g(\\eta)/g(\\eta)\\right|_{\\eta=\\eta_{\\ast}}$。\n6. 数值单位和精度：根据构造，所有量均为无量纲。所有输出均以浮点数形式报告。\n\n测试套件：\n- 严格使用上面列出的参数值。三种微扰情况 A、B 和 C 构成了测试套件。所需的输出为：\n  - 基线峰值位置 $\\eta_{\\ast}$。\n  - 对于每种情况（A、B、C），在 $g/\\max g\\ge 10^{-8}$ 的限制下计算出的浮点数对 $\\bigl[\\max_{\\eta}\\left|\\delta g/g\\right|,\\ \\left.\\delta g/g\\right|_{\\eta=\\eta_{\\ast}}\\bigr]$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下：\n$$\n\\bigl[\\ \\eta_{\\ast},\\ \\max|\\delta g/g|_{\\mathrm{A}},\\ (\\delta g/g)_{\\mathrm{A}}(\\eta_{\\ast}),\\ \\max|\\delta g/g|_{\\mathrm{B}},\\ (\\delta g/g)_{\\mathrm{B}}(\\eta_{\\ast}),\\ \\max|\\delta g/g|_{\\mathrm{C}},\\ (\\delta g/g)_{\\mathrm{C}}(\\eta_{\\ast})\\ \\bigr].\n$$\n所有七个值都必须以浮点数形式打印。不应打印任何额外文本。", "solution": "此问题要求开发一个数值计算流程，用以计算宇宙学可见性函数 $g(\\eta)$ 及其对自由电子分数中的分数微扰 $\\delta x_{e}(\\eta)/x_{e}(\\eta)$ 的线性响应。解决方案的构建过程是：首先从给定的定义中推导出必要的解析表达式，然后对它们进行数值实现。\n\n**1. 理论框架**\n\n**1.1. 可见性函数**\n\n可见性函数 $g(\\eta)$ 代表了今天观测到的一个光子在共形时间 $\\eta$ 发生其最后散射事件的概率密度。这个概率是两个因子的乘积：在无穷小区间 $[\\eta, \\eta+d\\eta]$ 内发生散射的概率，以及从 $\\eta$ 到当前时间 $\\eta_0$ 无需进一步散射即可自由传播的概率。\n\n瞬时散射率由 $\\dot{\\tau}(\\eta) \\equiv a(\\eta)n_{e}(\\eta)\\sigma_{T}$ 给出，其中 $a(\\eta)$ 是标度因子，$n_e(\\eta)$ 是自由电子数密度，$\\sigma_T$ 是 Thomson 散射截面。因此，在 $[\\eta, \\eta+d\\eta]$ 内发生散射的概率是 $\\dot{\\tau}(\\eta) d\\eta$。\n\n一个光子从 $\\eta$ 自由传播到 $\\eta_0$ 的概率由 $e^{-\\tau(\\eta)}$ 给出，其中 $\\tau(\\eta)$ 是 $\\eta$ 和 $\\eta_0$ 之间的散射光学厚度：\n$$\n\\tau(\\eta) = \\int_{\\eta}^{\\eta_0} \\dot{\\tau}(\\eta') d\\eta'\n$$\n结合这些，在 $[\\eta, \\eta+d\\eta]$ 内发生最后散射的概率是 $g(\\eta)d\\eta = \\dot{\\tau}(\\eta)e^{-\\tau(\\eta)}d\\eta$。因此，可见性函数为：\n$$\ng(\\eta) = \\dot{\\tau}(\\eta) e^{-\\tau(\\eta)}\n$$\n注意，根据此定义，有 $\\dot{\\tau}(\\eta) = -d\\tau/d\\eta$。\n\n为了数值实现这一点，我们首先需要根据给定的模型参数得到 $\\dot{\\tau}(\\eta)$ 的显式表达式。给定：\n- 标度因子：$a(\\eta) = (\\eta/\\eta_0)^2$。由于 $\\eta_0=1$，则 $a(\\eta) = \\eta^2$。\n- 自由电子密度：$n_e(\\eta) = x_e(\\eta) n_H(\\eta)$。\n- 氢数密度：$n_H(\\eta) = n_{H0} a(\\eta)^{-3} = n_{H0} \\eta^{-6}$。\n\n将这些代入 $\\dot{\\tau}(\\eta)$ 的定义中：\n$$\n\\dot{\\tau}(\\eta) = a(\\eta) \\bigl(x_e(\\eta) n_H(\\eta)\\bigr) \\sigma_T = \\eta^2 \\bigl(x_e(\\eta) n_{H0} \\eta^{-6}\\bigr) \\sigma_T = (n_{H0}\\sigma_T) x_e(\\eta) \\eta^{-4}\n$$\n问题提供了归一化常数 $C = n_{H0}\\sigma_T\\eta_0 = 10^{-4}$。由于 $\\eta_0=1$，这给出 $n_{H0}\\sigma_T = 10^{-4}$。散射率的最终表达式为：\n$$\n\\dot{\\tau}(\\eta) = C \\frac{x_e(\\eta)}{\\eta^4} \\quad \\text{其中} \\quad C=10^{-4}\n$$\n未微扰的自由电子分数 $x_e^{(0)}(\\eta)$ 由 tanh 模型给出：\n$$\nx_{e}^{(0)}(\\eta)=x_{\\mathrm{res}}+\\frac{1}{2}\\,(x_{\\mathrm{pre}}-x_{\\mathrm{res}})\\,\\Bigl[1-\\tanh\\Bigl(\\frac{\\eta-\\eta_{c}}{w}\\Bigr)\\Bigr]\n$$\n参数为 $x_{\\mathrm{pre}}=1.0$，$x_{\\mathrm{res}}=2\\times 10^{-4}$，$\\eta_{c}=0.03$，以及 $w=0.01$。\n\n**1.2. 可见性函数的线性响应**\n\n我们希望找到由电子分数中的小分数微扰 $\\delta_x(\\eta) \\equiv \\delta x_e(\\eta)/x_e(\\eta)$ 引起的一阶分数变化 $\\delta g(\\eta)/g(\\eta)$。我们用上标 $(0)$ 表示未微扰的量。\n\n微扰后的量为：\n- $x_e(\\eta) = x_e^{(0)}(\\eta) (1 + \\delta_x(\\eta))$\n- $\\dot{\\tau}(\\eta) = \\dot{\\tau}^{(0)}(\\eta) (1 + \\delta_x(\\eta)) \\implies \\delta\\dot{\\tau}(\\eta) = \\dot{\\tau}^{(0)}(\\eta) \\delta_x(\\eta)$\n- $\\tau(\\eta) = \\tau^{(0)}(\\eta) + \\delta\\tau(\\eta)$，其中\n$$\n\\delta\\tau(\\eta) = \\int_{\\eta}^{\\eta_0} \\delta\\dot{\\tau}(\\eta') d\\eta' = \\int_{\\eta}^{\\eta_0} \\dot{\\tau}^{(0)}(\\eta') \\delta_x(\\eta') d\\eta'\n$$\n可见性函数为 $g = \\dot{\\tau}e^{-\\tau}$。取其变分，得到一阶项：\n$$\n\\delta g = \\delta\\dot{\\tau} e^{-\\tau^{(0)}} + \\dot{\\tau}^{(0)} e^{-\\tau^{(0)}} (-\\delta\\tau) = e^{-\\tau^{(0)}} (\\delta\\dot{\\tau} - \\dot{\\tau}^{(0)}\\delta\\tau)\n$$\n除以未微扰的可见性函数 $g^{(0)} = \\dot{\\tau}^{(0)}e^{-\\tau^{(0)}}$，我们得到分数变化：\n$$\n\\frac{\\delta g(\\eta)}{g^{(0)}(\\eta)} = \\frac{\\delta\\dot{\\tau}(\\eta)}{\\dot{\\tau}^{(0)}(\\eta)} - \\delta\\tau(\\eta)\n$$\n代入 $\\delta\\dot{\\tau}$ 和 $\\delta\\tau$ 的表达式：\n$$\n\\frac{\\delta g(\\eta)}{g^{(0)}(\\eta)} = \\delta_x(\\eta) - \\int_{\\eta}^{\\eta_0} \\dot{\\tau}^{(0)}(\\eta') \\delta_x(\\eta') d\\eta'\n$$\n这是线性响应的核心方程。为简化符号，此后我们省略上标 $(0)$。\n\n**2. 数值实现**\n\n数值计算流程遵循推导出的理论框架。\n\n**2.1. 网格和背景量**\n在共形时间 $\\eta$ 上建立一个从 $\\eta_{\\min}=10^{-4}$ 到 $\\eta_0=1$ 的均匀网格。在此网格上，我们按顺序计算以下未微扰的背景量：\n1.  使用给定的 `tanh` 公式计算自由电子分数 $x_e(\\eta)$。\n2.  散射率 $\\dot{\\tau}(\\eta) = C x_e(\\eta) \\eta^{-4}$。\n3.  光学厚度 $\\tau(\\eta) = \\int_{\\eta}^{\\eta_0} \\dot{\\tau}(\\eta') d\\eta'$。对每个网格点 $\\eta_i$ 数值计算此积分。一种标准方法是首先使用梯形法则（例如 `scipy.integrate.cumulative_trapezoid`）计算从网格起点开始的累积积分 $I(\\eta_i) = \\int_{\\eta_{\\min}}^{\\eta_i} \\dot{\\tau}(\\eta')d\\eta'$。然后，通过减法求得 $\\tau(\\eta_i)$：$\\tau(\\eta_i) = I(\\eta_0) - I(\\eta_i)$。\n4.  可见性函数 $g(\\eta) = \\dot{\\tau}(\\eta) e^{-\\tau(\\eta)}$。\n\n**2.2. 峰值位置**\n可见性函数的峰值 $\\eta_\\ast$ 通过找到计算出的数组 $g(\\eta)$ 达到其最大值的网格点来确定。这对应于最可几的最后散射时间。\n\n**2.3. 微扰响应计算**\n对于三种指定的微扰轮廓 $\\delta_x(\\eta) = \\delta x_e(\\eta)/x_e(\\eta)$（常数、高斯型、振荡型），使用推导出的公式计算线性响应 $\\delta g(\\eta)/g(\\eta)$。这包括：\n1.  在网格上计算微扰轮廓 $\\delta_x(\\eta)$。\n2.  计算被积函数 $\\dot{\\tau}(\\eta)\\delta_x(\\eta)$。\n3.  使用与计算 $\\tau(\\eta)$ 相同的累积积分技术，对每个网格点将该乘积从 $\\eta$ 到 $\\eta_0$ 进行数值积分，以找到 $\\delta\\tau(\\eta)$。\n4.  最后，计算 $\\delta g(\\eta)/g(\\eta) = \\delta_x(\\eta) - \\delta\\tau(\\eta)$。\n\n**2.4. 结果分析**\n对于每种微扰情况，提取两个量：\n1.  最大绝对分数变化 $\\max_{\\eta}|\\delta g(\\eta)/g(\\eta)|$。此搜索被限制在 $g(\\eta)$ 不可忽略的区域内，该区域由条件 $g(\\eta) / \\max_{\\eta'}g(\\eta') \\ge 10^{-8}$ 定义，以避免分布尾部的数值伪影。\n2.  在未微扰峰值位置处的分数变化 $(\\delta g/g)(\\eta_\\ast)$。\n\n这些步骤在提供的 Python 代码中实现，该代码产生七个所需的输出值。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the cosmological visibility function and its linear response to\n    perturbations in the free-electron fraction.\n    \"\"\"\n\n    # 1. Define constants and grid\n    eta0 = 1.0\n    eta_min = 1e-4\n    num_points = 20000\n    eta = np.linspace(eta_min, eta0, num_points)\n\n    # Cosmological and model parameters\n    x_pre = 1.0\n    x_res = 2.0e-4\n    eta_c = 0.03 * eta0\n    w = 0.01 * eta0\n    C = 1.0e-4  # n_H0 * sigma_T * eta_0\n\n    # 2. Compute background quantities\n    # Unperturbed free-electron fraction x_e(eta)\n    x_e = x_res + 0.5 * (x_pre - x_res) * (1.0 - np.tanh((eta - eta_c) / w))\n\n    # Scattering rate, \\dot{\\tau} = -d\\tau/d\\eta\n    tau_dot = C * x_e / eta**4\n\n    # Optical depth \\tau(eta) = integral from eta to eta0 of \\dot{\\tau}\n    integral_part = cumulative_trapezoid(tau_dot, eta, initial=0.0)\n    total_integral = integral_part[-1]\n    tau = total_integral - integral_part\n    \n    # Visibility function g(eta)\n    g = tau_dot * np.exp(-tau)\n    \n    # 3. Determine peak location eta_star\n    g_max_idx = np.argmax(g)\n    eta_star = eta[g_max_idx]\n    g_max = g[g_max_idx]\n\n    results = [eta_star]\n\n    # 4. Define perturbation profiles\n    epsilon = 1.0e-3\n    \n    # Case A: Constant perturbation\n    delta_xe_over_xe_A = epsilon * np.ones_like(eta)\n    \n    # Case B: Gaussian perturbation\n    sigma_B = 0.005 * eta0\n    delta_xe_over_xe_B = epsilon * np.exp(-((eta - eta_c)**2) / (2 * sigma_B**2))\n    \n    # Case C: Oscillatory perturbation\n    P_C = 0.05\n    delta_xe_over_xe_C = epsilon * np.cos(2 * np.pi * (eta / eta0) / P_C)\n    \n    perturbations = [\n        delta_xe_over_xe_A, \n        delta_xe_over_xe_B, \n        delta_xe_over_xe_C\n    ]\n    \n    # Define restricted domain for analysis\n    g_threshold = g_max * 1.0e-8\n    valid_indices = np.where(g = g_threshold)[0]\n\n    # 5. Compute and analyze response for each case\n    for delta_xe_over_xe in perturbations:\n        # Compute delta_tau(eta)\n        integrand_delta_tau = tau_dot * delta_xe_over_xe\n        integral_part_delta = cumulative_trapezoid(integrand_delta_tau, eta, initial=0.0)\n        total_integral_delta = integral_part_delta[-1]\n        delta_tau = total_integral_delta - integral_part_delta\n        \n        # Compute fractional change in g(eta)\n        delta_g_over_g = delta_xe_over_xe - delta_tau\n        \n        # 6. Extract required metrics\n        # Max absolute fractional change over the restricted domain\n        max_abs_change = np.max(np.abs(delta_g_over_g[valid_indices]))\n        \n        # Fractional change at the baseline peak\n        change_at_peak = delta_g_over_g[g_max_idx]\n        \n        results.extend([max_abs_change, change_at_peak])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3483751"}]}