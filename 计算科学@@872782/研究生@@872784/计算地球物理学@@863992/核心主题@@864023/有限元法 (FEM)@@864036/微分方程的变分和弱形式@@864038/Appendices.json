{"hands_on_practices": [{"introduction": "标准伽辽金方法在处理对流占优问题时常常会失效，产生伪振荡。流线迎风/彼得罗夫-伽辽金 (Streamline Upwind/Petrov-Galerkin, SUPG) 方法是稳定解的有效技术。本练习将指导您为一个一维模型问题，推导最优的稳定参数。通过确保数值解在节点上精确，您将深入理解稳定方法的设计原理，以及它们如何在扩散主导和对流主导两种机制之间自适应地切换，这是开发稳健数值格式的一项基本技能。[@problem_id:3618368]", "problem": "考虑在一个饱和多孔通道中，被动标量的稳定输运。该通道代表了更大地球物理流中的单条流线，在区间 $\\Omega = [0,L]$ 上由常系数对流-扩散算子建模，其具有与坐标轴对齐的均匀达西(Darcy)速度大小 $|\\mathbf{b}|>0$ 和分子弥散（扩散系数）$\\epsilon>0$：\n$$\n-\\,\\epsilon\\,\\frac{d^{2}u}{dx^{2}} \\;+\\; |\\mathbf{b}|\\,\\frac{du}{dx} \\;=\\; f(x),\n$$\n并辅以在 $x=0$ 和 $x=L$ 处的狄利克雷(Dirichlet)边界条件。设该域由单元尺寸为 $h>0$ 的均匀网格以及连续的分片线性试探和检验空间进行离散化。伽辽金(Galerkin)弱形式通过流线迎风/彼得罗夫-伽辽金(Streamline Upwind/Petrov–Galerkin, SUPG)方法进行稳定化，其中检验函数在流线方向上得到增强，在每个单元 $K$ 上增加一个基于残差的项，形式如下：\n$$\n\\int_{K} \\tau_{K}\\,|\\mathbf{b}|\\,\\frac{dw}{dx}\\,\\Big(\\,-\\,\\epsilon\\,\\frac{d^{2}u}{dx^{2}} \\;+\\; |\\mathbf{b}|\\,\\frac{du}{dx} \\;-\\; f\\,\\Big)\\,dx,\n$$\n其中稳定化参数 $\\tau_{K}$ 有待确定。\n\n从上述算子和弱形式出发，在单个单元 $K$ 上，根据局部佩克莱特数(Peclet number)\n$$\nPe \\;=\\; \\frac{|\\mathbf{b}|\\,h}{2\\,\\epsilon}.\n$$\n推导 SUPG 稳定化参数 $\\tau$ 的闭式表达式。\n你的推导必须基于对精确常系数算子的单元级分析，并要求 SUPG 沿流线的加权模拟算子在 $K$ 上的伴随格林函数。使用佩克莱特数的定义和一维(1D)指数精确解的性质，以获得均匀网格上 $\\tau$ 的解析公式。\n\n最后，解释在小 $Pe$ 和大 $Pe$ 的渐近极限下，得到的 $\\tau$ 如何随 $\\epsilon$、 $|\\mathbf{b}|$ 和 $h$ 缩放，但最终答案只需呈现为 $\\tau$ 关于 $Pe$、 $|\\mathbf{b}|$ 和 $h$ 的闭式解析表达式。无需进行数值评估，也无需四舍五入。将你的最终答案表达为单个解析表达式。", "solution": "用户希望为一个一维常系数对流-扩散问题推导流线迎风/彼得罗夫-伽辽金(SUPG)稳定化参数 $\\tau$。该推导必须基于单元级分析，要求得到的有限元格式对于齐次算子是节点精确的。\n\n### 步骤 1：问题验证\n根据指定标准验证问题陈述。\n\n**1.1. 提取的已知条件：**\n-   **控制方程：** $-\\epsilon \\frac{d^2u}{dx^2} + |\\mathbf{b}| \\frac{du}{dx} = f(x)$ 在 $\\Omega = [0, L]$ 上。\n-   **参数：** 扩散系数 $\\epsilon > 0$，达西速度大小 $|\\mathbf{b}| > 0$。\n-   **边界条件：** 在 $x=0$ 和 $x=L$ 处的狄利克雷(Dirichlet)边界条件。\n-   **离散化：** 单元尺寸为 $h$ 的均匀网格。连续的分片线性试探和检验空间。\n-   **稳定化方法：** SUPG，单元 $K$ 上的稳定项由 $\\int_{K} \\tau_{K}\\,|\\mathbf{b}|\\,\\frac{dw}{dx}\\,\\Big(\\,-\\,\\epsilon\\,\\frac{d^{2}u}{dx^{2}} \\;+\\; |\\mathbf{b}|\\,\\frac{du}{dx} \\;-\\; f\\,\\Big)\\,dx$ 给出。\n-   **局部佩克莱特数 (Peclet Number)：** $Pe = \\frac{|\\mathbf{b}|h}{2\\epsilon}$。\n-   **目标：** 推导单个单元上稳定化参数 $\\tau_K$（记为 $\\tau$）的闭式表达式。\n-   **推导原则：** 推导应基于单元级分析，确保该格式对于精确的常系数算子是节点精确的。\n-   **最终输出：** 用 $Pe$、 $|\\mathbf{b}|$ 和 $h$ 表示的 $\\tau$ 的单个解析表达式。\n\n**1.2. 对照标准进行验证：**\n-   **科学基础：** 该问题涉及对流-扩散方程的稳定化，这是输运现象的基石。SUPG 方法是计算流体力学及相关领域中一个标准的、经过充分检验的技术。为实现模型问题的节点精确性而设计稳定化参数的原则，是有限元方法发展中的一个经典且基础合理的方法。该问题具有科学严谨性。\n-   **适定性：** 该问题提供了明确的目标和定义清晰的推导路径。所有必要的组成部分（算子、离散化、稳定化形式、分析原则）都已指定，从而可以导出一个唯一的解析解。\n-   **客观性：** 该问题使用精确的数学和技术语言陈述，没有歧义或主观内容。\n\n**1.3. 结论：**\n该问题有效。它是微分方程计算方法领域一个标准的、不平凡的推导。可以开始求解过程。\n\n### 步骤 2：稳定化参数 $\\tau$ 的推导\n\n令 $b = |\\mathbf{b}|$。稳态一维对流-扩散方程为：\n$$\n-\\epsilon \\frac{d^2u}{dx^2} + b \\frac{du}{dx} = f(x)\n$$\n标准的伽辽金(Galerkin)弱形式是通过乘以一个检验函数 $w$ 并在一个单元 $K$ 上积分得到的。对二阶项应用分部积分后，我们得到：\n$$\n\\int_K \\left( \\epsilon \\frac{du}{dx} \\frac{dw}{dx} + b \\frac{du}{dx} w \\right) dx = \\int_K f w dx + \\left[ -\\epsilon \\frac{du}{dx} w \\right]_{\\partial K}\n$$\n边界项在组装过程中处理。对于有限元近似 $u_h(x) = \\sum_j U_j \\phi_j(x)$，以 $w_h(x) = \\phi_i(x)$ 为检验函数，其离散弱形式为：\n$$\n\\sum_K \\int_K \\left( \\epsilon \\frac{du_h}{dx} \\frac{d\\phi_i}{dx} + b \\frac{du_h}{dx} \\phi_i \\right) dx = \\sum_K \\int_K f \\phi_i dx\n$$\nSUPG 方法增加了一个稳定项。对于连续分片线性单元，在一个单元 $K$ 内部 $u_h''=0$。离散解 $u_h$ 在 $K$ 内的方程残差为 $R(u_h) = -\\epsilon u_h'' + b u_h' - f = b u_h' - f$。如问题所述，SUPG 修正为每个检验函数 $\\phi_i$ 的弱形式添加了以下项：\n$$\n\\sum_K \\int_K \\tau b \\frac{d\\phi_i}{dx} \\left( b \\frac{du_h}{dx} \\right) dx\n$$\n为简单起见，我们考虑齐次问题，其中 $f(x)=0$。完整的 SUPG 离散方程是：\n$$\n\\sum_K \\int_K \\left( \\epsilon \\frac{du_h}{dx} \\frac{d\\phi_i}{dx} + b \\frac{du_h}{dx} \\phi_i + \\tau b^2 \\frac{d\\phi_i}{dx} \\frac{du_h}{dx} \\right) dx = 0\n$$\n\n我们分析尺寸为 $h$ 的均匀网格上内部节点 $x_j$ 的计算格式。检验函数是帽函数 $\\phi_j$，其支集在 $[x_{j-1}, x_{j+1}]$ 上。我们组装来自两个相邻单元 $[x_{j-1}, x_j]$ 和 $[x_j, x_{j+1}]$ 的贡献。\n\n在单元 $[x_{j-1}, x_j]$上：$\\frac{d\\phi_j}{dx} = \\frac{1}{h}$ 且 $\\frac{du_h}{dx} = \\frac{U_j - U_{j-1}}{h}$。$\\phi_j$ 在此单元上的积分为 $\\frac{h}{2}$。\n对计算格式的贡献是：\n$$\n\\int_{x_{j-1}}^{x_j} \\left( \\epsilon \\left(\\frac{U_j-U_{j-1}}{h}\\right)\\frac{1}{h} + b\\left(\\frac{U_j-U_{j-1}}{h}\\right)\\phi_j + \\tau b^2 \\left(\\frac{U_j-U_{j-1}}{h}\\right)\\frac{1}{h} \\right) dx \\\\\n= \\left( \\frac{\\epsilon}{h} + \\frac{b}{2} + \\frac{\\tau b^2}{h} \\right)(U_j - U_{j-1})\n$$\n\n在单元 $[x_j, x_{j+1}]$上：$\\frac{d\\phi_j}{dx} = -\\frac{1}{h}$ 且 $\\frac{du_h}{dx} = \\frac{U_{j+1} - U_j}{h}$。$\\phi_j$ 在此单元上的积分为 $\\frac{h}{2}$。\n对计算格式的贡献是：\n$$\n\\int_{x_j}^{x_{j+1}} \\left( \\epsilon \\left(\\frac{U_{j+1}-U_j}{h}\\right)\\left(-\\frac{1}{h}\\right) + b\\left(\\frac{U_{j+1}-U_j}{h}\\right)\\phi_j + \\tau b^2 \\left(\\frac{U_{j+1}-U_j}{h}\\right)\\left(-\\frac{1}{h}\\right) \\right) dx \\\\\n= \\left( -\\frac{\\epsilon}{h} + \\frac{b}{2} - \\frac{\\tau b^2}{h} \\right)(U_{j+1} - U_j)\n$$\n\n将这些贡献相加，得到节点 $j$ 的完整计算格式方程：\n$$\n\\left( \\frac{\\epsilon}{h} + \\frac{b}{2} + \\frac{\\tau b^2}{h} \\right)(U_j - U_{j-1}) + \\left( -\\frac{\\epsilon}{h} + \\frac{b}{2} - \\frac{\\tau b^2}{h} \\right)(U_{j+1} - U_j) = 0\n$$\n\n为了找到最优的 $\\tau$，我们强制要求数值解是节点精确的。齐次方程 $-\\epsilon u'' + b u' = 0$ 的精确解是 $u(x) = C_1 + C_2 \\exp(bx/\\epsilon)$。令 $U_j = u(x_j)$。定义 $\\alpha = \\frac{bh}{\\epsilon}$。\n那么 $U_j - U_{j-1} = u(x_j) - u(x_j-h) = C_2(\\exp(bx_j/\\epsilon) - \\exp(b(x_j-h)/\\epsilon)) = C_2 \\exp(bx_j/\\epsilon) (1-e^{-\\alpha})$。\n并且 $U_{j+1} - U_j = u(x_j+h) - u(x_j) = C_2(\\exp(b(x_j+h)/\\epsilon) - \\exp(bx_j/\\epsilon)) = C_2 \\exp(bx_j/\\epsilon) (e^{\\alpha}-1)$。\n\n将这些代入计算格式方程，并消去公因子 $C_2 \\exp(bx_j/\\epsilon)$：\n$$\n\\left( \\frac{\\epsilon}{h} + \\frac{b}{2} + \\frac{\\tau b^2}{h} \\right)(1 - e^{-\\alpha}) + \\left( -\\frac{\\epsilon}{h} + \\frac{b}{2} - \\frac{\\tau b^2}{h} \\right)(e^{\\alpha} - 1) = 0\n$$\n因为 $1-e^{-\\alpha} = e^{-\\alpha}(e^\\alpha-1)$，我们可以除以 $(e^\\alpha-1)$（对于 $\\alpha \\neq 0$）：\n$$\n\\left( \\frac{\\epsilon}{h} + \\frac{b}{2} + \\frac{\\tau b^2}{h} \\right)e^{-\\alpha} + \\left( -\\frac{\\epsilon}{h} + \\frac{b}{2} - \\frac{\\tau b^2}{h} \\right) = 0\n$$\n我们现在求解 $\\tau$。让我们将乘以 $\\tau$ 的项组合起来：\n$$\n\\tau \\frac{b^2}{h} (e^{-\\alpha} - 1) = -\\left(\\frac{\\epsilon}{h} + \\frac{b}{2}\\right)e^{-\\alpha} - \\left(-\\frac{\\epsilon}{h} + \\frac{b}{2}\\right)\n$$\n$$\n\\tau \\frac{b^2}{h} (1 - e^{-\\alpha}) = \\left(\\frac{\\epsilon}{h} + \\frac{b}{2}\\right)e^{-\\alpha} + \\left(-\\frac{\\epsilon}{h} + \\frac{b}{2}\\right) = \\frac{\\epsilon}{h}(e^{-\\alpha}-1) + \\frac{b}{2}(e^{-\\alpha}+1)\n$$\n$$\n\\tau = \\frac{h}{b^2(1-e^{-\\alpha})} \\left[ \\frac{\\epsilon}{h}(e^{-\\alpha}-1) + \\frac{b}{2}(e^{-\\alpha}+1) \\right] = -\\frac{\\epsilon}{b^2} + \\frac{h}{2b} \\frac{e^{-\\alpha}+1}{1-e^{-\\alpha}}\n$$\n使用局部佩克莱特数 $Pe = \\frac{bh}{2\\epsilon}$，我们有 $\\alpha = \\frac{bh}{\\epsilon} = 2Pe$。\n$\\tau$ 的表达式变为：\n$$\n\\tau = -\\frac{\\epsilon}{b^2} + \\frac{h}{2b} \\frac{1+e^{-2Pe}}{1-e^{-2Pe}}\n$$\n该分数是双曲余切的定义：\n$$\n\\frac{1+e^{-2Pe}}{1-e^{-2Pe}} = \\frac{e^{Pe}(e^{-Pe}+e^{Pe})}{e^{Pe}(e^{-Pe}-e^{Pe})} = \\frac{e^{Pe}+e^{-Pe}}{e^{Pe}-e^{-Pe}} = \\coth(Pe)\n$$\n所以，$\\tau = \\frac{h}{2b}\\coth(Pe) - \\frac{\\epsilon}{b^2}$。我们可以用 $Pe$ 来表示 $\\frac{\\epsilon}{b^2}$：$\\frac{\\epsilon}{b^2} = \\frac{h}{2b \\cdot Pe}$。\n$$\n\\tau = \\frac{h}{2b}\\coth(Pe) - \\frac{h}{2b \\cdot Pe} = \\frac{h}{2b} \\left( \\coth(Pe) - \\frac{1}{Pe} \\right)\n$$\n用 $|\\mathbf{b}|$ 替换 $b$，我们得到最终的表达式。\n\n### 步骤 3：渐近分析\n我们研究 $\\tau$ 在两个极限下的行为。\n\n**对流主导极限 ($Pe \\to \\infty$)：**\n对于大的 $x$，$\\coth(x) \\approx 1$。因此，对于 $Pe \\gg 1$：\n$$\n\\tau \\approx \\frac{h}{2|\\mathbf{b}|} \\left( 1 - \\frac{1}{Pe} \\right) \\to \\frac{h}{2|\\mathbf{b}|}\n$$\n在此极限下，$\\tau$ 与扩散系数 $\\epsilon$ 无关，并按 $\\tau \\propto h/|\\mathbf{b}|$ 缩放。这对应于纯对流问题的经典迎风参数。\n\n**扩散主导极限 ($Pe \\to 0$)：**\n对于小的 $x$，$\\coth(x)$ 的泰勒级数为 $\\frac{1}{x} + \\frac{x}{3} - \\frac{x^3}{45} + O(x^5)$。\n因此，对于 $Pe \\ll 1$：\n$$\n\\coth(Pe) - \\frac{1}{Pe} \\approx \\left(\\frac{1}{Pe} + \\frac{Pe}{3}\\right) - \\frac{1}{Pe} = \\frac{Pe}{3}\n$$\n将此代入 $\\tau$ 的表达式中：\n$$\n\\tau \\approx \\frac{h}{2|\\mathbf{b}|} \\left( \\frac{Pe}{3} \\right) = \\frac{h}{2|\\mathbf{b}|} \\frac{|\\mathbf{b}|h}{6\\epsilon} = \\frac{h^2}{12\\epsilon}\n$$\n在此极限下，$\\tau$ 与速度 $|\\mathbf{b}|$ 无关，并按 $\\tau \\propto h^2/\\epsilon$ 缩放。\n\n推导出的公式在这两种物理状态之间提供了平滑的过渡。", "answer": "$$\n\\boxed{\\frac{h}{2|\\mathbf{b}|} \\left( \\coth\\left(\\frac{|\\mathbf{b}|h}{2\\epsilon}\\right) - \\frac{2\\epsilon}{|\\mathbf{b}|h} \\right)}\n$$", "id": "3618368"}, {"introduction": "许多现实世界中的地球物理问题涉及多个物理域，例如饱含流体的岩石与干燥岩石相邻，这些区域可能需要不同的网格分辨率。砂浆法 (Mortar methods) 提供了一种数学上严谨的方式来耦合这些不匹配的子域。在本练习中，您将使用拉格朗日乘子来实现一个基于砂浆法的有限元方法，以弱形式强制施加流固交界面的连续性和平衡条件。这个动手编程问题将让您熟悉鞍点系统的结构——这是约束变分问题中的一个共同特征，并为高级区域分解技术提供一个实践基础。[@problem_id:3618425]", "problem": "考虑一个一维区域分解，包含一个固体子域 $\\Omega_s = (0, L_s)$ 和一个流体子域 $\\Omega_f = (L_s, L_s + L_f)$。状态变量是每个子域上的标量类位移场，对于 $x \\in \\Omega_s$ 记为 $u_s(x)$，对于 $x \\in \\Omega_f$ 记为 $u_f(x)$。假设系统呈准静态行为，具有线性本构响应，其特征为 $\\Omega_s$ 上的正常数系数 $a_s$ 和 $\\Omega_f$ 上的正常数系数 $a_f$。设体源项在 $\\Omega_s$ 上为常数 $q_s$，在 $\\Omega_f$ 上为常数 $q_f$。每个子域上的控制强形式为平衡方程 $-\\frac{d}{dx}\\left(a_s \\frac{du_s}{dx}\\right) = q_s$ (在 $\\Omega_s$ 中) 和 $-\\frac{d}{dx}\\left(a_f \\frac{du_f}{dx}\\right) = q_f$ (在 $\\Omega_f$ 中)，并带有齐次狄利克雷边界条件 $u_s(0) = 0$ 和 $u_f(L_s + L_f) = 0$。在流固界面 $\\Gamma = \\{L_s\\}$ 处，通过跳跃条件 $\\llbracket u \\rrbracket = u_s(L_s) - u_f(L_s) = 0$ 和 $\\llbracket a \\frac{du}{dx} \\rrbracket = a_s \\frac{du_s}{dx}(L_s^-) + a_f \\left(-\\frac{du_f}{dx}(L_s^+)\\right) = 0$ 施加弱连续性和平衡，其中 $\\Omega_s$ 和 $\\Omega_f$ 上的外法线分别定向为 $n_s = +1$ 和 $n_f = -1$。\n\n从虚功原理和跳跃算子的定义出发，推导在乘积空间 $V_s \\times V_f$ 上的弱形式，并使用界面上的拉格朗日乘子空间 $M$ 对其进行增强。具体而言，通过引入两个界面拉格朗日乘子 $\\lambda_u \\in M$ 和 $\\lambda_t \\in M$ 来表达 $\\llbracket u \\rrbracket = 0$ 和 $\\llbracket a \\frac{du}{dx} \\rrbracket = 0$ 的弱施加，并推导耦合 $(u_s, u_f)$ 和 $(\\lambda_u, \\lambda_t)$ 的相应鞍点双线性形式。\n\n然后，在每个子域上独立地使用分段线性有限元对弱形式进行离散化，允许网格尺寸不匹配。在一维情况下，界面 $\\Gamma$ 是一个单点，因此砂浆积分简化为在 $x = L_s$ 处的求值。设固体子域划分为 $N_s$ 个均匀单元，流体子域划分为 $N_f$ 个均匀单元。组装如下形式的块鞍点系统：\n$$\n\\begin{bmatrix}\nK_s  0  C_s  D_s \\\\\n0  K_f  -C_f  D_f \\\\\nC_s^\\top  -C_f^\\top  0  0 \\\\\nD_s^\\top  D_f^\\top  0  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{u}_s \\\\ \\mathbf{u}_f \\\\ \\lambda_u \\\\ \\lambda_t\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\mathbf{f}_s \\\\ \\mathbf{f}_f \\\\ 0 \\\\ 0\n\\end{bmatrix},\n$$\n其中 $K_s$ 和 $K_f$ 是子域刚度矩阵，$\\mathbf{f}_s$ 和 $\\mathbf{f}_f$ 是子域载荷向量，$C_s$ 和 $C_f$ 从子域自由度中提取界面迹值，$D_s$ 和 $D_f$ 表示与外法线方向一致的界面离散法向牵引力。通过消去规定值为 $0$ 的相应自由度，来实现在固体 $x=0$ 处和流体 $x=L_s+L_f$ 处的齐次狄利克雷边界条件。\n\n你的任务是编写一个完整的、可运行的程序，该程序：\n- 为多个测试用例组装指定的离散算子 $K_s$、$K_f$、$\\mathbf{f}_s$、$\\mathbf{f}_f$、$C_s$、$C_f$、$D_s$ 和 $D_f$。\n- 对每个测试用例求解鞍点系统。\n- 对每个测试用例，返回一个由界面位移 $u_\\Gamma = u_s(L_s)$ 和界面牵引力 $t_\\Gamma = a_s \\frac{du_s}{dx}(L_s^-)$ 组成的对，该对根据离散表示一致地计算得出。由于约束强制平衡，$t_\\Gamma$ 应等于 $-a_f \\frac{du_f}{dx}(L_s^+)$；请使用固体侧的表示来计算和报告 $t_\\Gamma$。\n\n在此问题中，所有量均视为无量纲。有限元组装必须使用标准的一维线性单元。对于长度为 $h$、系数为 $a$ 的单元，局部刚度矩阵为 $\\frac{a}{h}\\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$，对于常数源 $q$ 的局部载荷向量为 $\\frac{q h}{2}\\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$。界面迹提取向量的定义使得 $C_s^\\top \\mathbf{u}_s = u_s(L_s)$ 和 $C_f^\\top \\mathbf{u}_f = u_f(L_s)$，而牵引力向量 $D_s$ 和 $D_f$ 使用邻近界面的单元来实现 $D_s^\\top \\mathbf{u}_s \\approx a_s \\frac{du_s}{dx}(L_s^-)$ 和 $D_f^\\top \\mathbf{u}_f \\approx -a_f \\frac{du_f}{dx}(L_s^+)$。\n\n设计你的实现时，要能处理邻近界面的子域只有一个未知自由度的情况（例如，当 $N_s = 1$ 或 $N_f = 1$ 时）。在这些情况下，使用非界面端的已知狄利克雷边界值 $0$ 来一致地定义界面处的离散导数。\n\n测试套件：\n使用以下四个测试用例，每个用例由 $(L_s, L_f, N_s, N_f, a_s, a_f, q_s, q_f)$ 指定：\n- 用例 1： $(L_s, L_f, N_s, N_f, a_s, a_f, q_s, q_f) = (\\,$ $1$, $1$, $4$, $3$, $2$, $1$, $1$, $0.5$ $\\,)$。\n- 用例 2： $(L_s, L_f, N_s, N_f, a_s, a_f, q_s, q_f) = (\\,$ $1$, $2$, $2$, $8$, $10$, $0.1$, $0$, $3$ $\\,)$。\n- 用例 3： $(L_s, L_f, N_s, N_f, a_s, a_f, q_s, q_f) = (\\,$ $0.5$, $0.5$, $2$, $2$, $1$, $1$, $1$, $1$ $\\,)$。\n- 用例 4： $(L_s, L_f, N_s, N_f, a_s, a_f, q_s, q_f) = (\\,$ $1.5$, $0.5$, $5$, $2$, $5$, $5$, $0$, $0$ $\\,)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表。对于每个用例，报告界面位移，后跟界面牵引力，因此输出形式为 $[u_{\\Gamma,1}, t_{\\Gamma,1}, u_{\\Gamma,2}, t_{\\Gamma,2}, u_{\\Gamma,3}, t_{\\Gamma,3}, u_{\\Gamma,4}, t_{\\Gamma,4}]$，其中 $u_{\\Gamma,i}$ 和 $t_{\\Gamma,i}$ 是浮点数。", "solution": "用户希望使用有限元方法和拉格朗日乘子进行界面耦合，来求解一个一维、双区域的稳态问题。\n\n### 步骤 1：问题验证\n\n**步骤 1.1：提取已知条件**\n- **区域**：固体 $\\Omega_s = (0, L_s)$，流体 $\\Omega_f = (L_s, L_s + L_f)$。\n- **状态变量**：$\\Omega_s$ 上的 $u_s(x)$，$\\Omega_f$ 上的 $u_f(x)$。\n- **材料属性**：$\\Omega_s$ 上的正常数系数 $a_s$，$\\Omega_f$ 上的正常数系数 $a_f$。\n- **源项**：$\\Omega_s$ 上的常数体源 $q_s$，$\\Omega_f$ 上的常数体源 $q_f$。\n- **强形式（控制方程）**：\n  - $-\\frac{d}{dx}\\left(a_s \\frac{du_s}{dx}\\right) = q_s$ 在 $\\Omega_s$ 中。\n  - $-\\frac{d}{dx}\\left(a_f \\frac{du_f}{dx}\\right) = q_f$ 在 $\\Omega_f$ 中。\n- **边界条件 (BCs)**：\n  - 外边界上的齐次狄利克雷条件：$u_s(0) = 0$ 和 $u_f(L_s + L_f) = 0$。\n- **界面条件，在 $\\Gamma = \\{L_s\\}$ 处**：\n  - 位移连续性（跳跃 $\\llbracket u \\rrbracket = 0$）：$u_s(L_s) - u_f(L_s) = 0$。\n  - 牵引力平衡（跳跃 $\\llbracket a \\frac{du}{dx} \\rrbracket = 0$）：$a_s \\frac{du_s}{dx}(L_s^-) + a_f \\left(-\\frac{du_f}{dx}(L_s^+)\\right) = 0$。注意：外法线为 $n_s = +1$ 和 $n_f = -1$。\n- **数值方法**：\n  - 在不匹配网格上的分段线性有限元。\n  - 固体区域：$N_s$ 个均匀单元。流体区域：$N_f$ 个均匀单元。\n  - 使用拉格朗日乘子 $\\lambda_u, \\lambda_t$ 来弱施加界面条件。\n- **离散系统结构**：指定了一个块鞍点系统：\n  $$\n  \\begin{bmatrix}\n  K_s  0  C_s  D_s \\\\\n  0  K_f  -C_f  D_f \\\\\n  C_s^\\top  -C_f^\\top  0  0 \\\\\n  D_s^\\top  D_f^\\top  0  0\n  \\end{bmatrix}\n  \\begin{bmatrix}\n  \\mathbf{u}_s \\\\ \\mathbf{u}_f \\\\ \\lambda_u \\\\ \\lambda_t\n  \\end{bmatrix}\n  =\n  \\begin{bmatrix}\n  \\mathbf{f}_s \\\\ \\mathbf{f}_f \\\\ 0 \\\\ 0\n  \\end{bmatrix}\n  $$\n- **离散算子定义**：\n  - $K_s, K_f$：子域刚度矩阵。\n  - $\\mathbf{f}_s, \\mathbf{f}_f$：子域载荷向量。\n  - $C_s^\\top \\mathbf{u}_s = u_s(L_s)$, $C_f^\\top \\mathbf{u}_f = u_f(L_s)$。\n  - $D_s^\\top \\mathbf{u}_s \\approx a_s \\frac{du_s}{dx}(L_s^-)$, $D_f^\\top \\mathbf{u}_f \\approx -a_f \\frac{du_f}{dx}(L_s^+)$。\n- **局部单元矩阵**：对于长度为 $h$、系数为 $a$、源为 $q$ 的单元：\n  - 局部刚度：$\\frac{a}{h}\\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$。\n  - 局部载荷向量：$\\frac{q h}{2}\\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$。\n- **任务**：组装并求解该系统，然后计算界面位移 $u_\\Gamma = u_s(L_s)$ 和牵引力 $t_\\Gamma = a_s \\frac{du_s}{dx}(L_s^-)$。\n- **测试套件**：提供了四组特定的参数 $(L_s, L_f, N_s, N_f, a_s, a_f, q_s, q_f)$。\n\n**步骤 1.2：使用提取的已知条件进行验证**\n- **科学上合理**：该问题描述了一个标准的带区域分解的一维弹性/扩散问题。控制方程是二阶椭圆偏微分方程。使用拉格朗日乘子施加界面约束是计算力学中一种成熟的技术（与 FETI 和砂浆法相关）。该问题在科学和数学上是合理的。\n- **适定的**：所有必要的数据（区域长度、材料属性、源项、网格尺寸）和条件（边界和界面）都已提供。问题的结构确保了对于给定的物理模型及其离散化存在唯一解。得到的线性系统通常是非奇异的，因此是可解的。\n- **客观的**：问题以精确、形式化的数学和计算语言陈述。没有主观或模棱两可的术语。\n- **未检测到缺陷**：该问题不违反任何无效性标准。它是自洽的、一致的，并且在科学上是合理的。\n\n**步骤 1.3：结论与行动**\n- 问题是**有效的**。开始求解。\n\n### 步骤 2：推导与实现策略\n\n任务是为指定的鞍点系统实现一个有限元求解器。任务的核心是正确地构建系统矩阵的每个块和右侧向量。\n\n**1. 子域离散化和自由度 (DOFs)**\n- **固体区域 $\\Omega_s = (0, L_s)$**：离散为 $N_s$ 个长度为 $h_s = L_s / N_s$ 的单元。这会产生 $N_s+1$ 个节点。由于边界条件 $u_s(0)=0$，未知自由度是节点值 $\\{u_{s,1}, u_{s,2}, \\dots, u_{s,N_s}\\}$。向量 $\\mathbf{u}_s$ 的维度是 $N_s$。\n- **流体区域 $\\Omega_f = (L_s, L_s+L_f)$**：离散为 $N_f$ 个长度为 $h_f = L_f / N_f$ 的单元。这会产生 $N_f+1$ 个节点。由于边界条件 $u_f(L_s+L_f)=0$，未知自由度是 $\\{u_{f,0}, u_{f,1}, \\dots, u_{f,N_f-1}\\}$。向量 $\\mathbf{u}_f$ 的维度是 $N_f$。\n\n**2. 子域矩阵的组装 ($K_s, \\mathbf{f}_s, K_f, \\mathbf{f}_f$)**\n使用标准的有限元组装程序。\n- 对于一个有 $N$ 个单元、系数为 $a$、长度为 $L$、源为 $q$ 的子域：\n  - 单元刚度矩阵为 $k_e = \\frac{a}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$，其中 $h=L/N$。\n  - 单元载荷向量为 $f_e = \\frac{q h}{2} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$。\n- 这些局部矩阵被组装成一个大小为 $(N+1) \\times (N+1)$ 的全局系统。\n- 通过消除与固定自由度对应的行和列来施加齐次狄利克雷边界条件。这会得到大小分别为 $N_s \\times N_s$ 和 $N_f \\times N_f$ 的矩阵 $K_s, K_f$ 以及大小分别为 $N_s$ 和 $N_f$ 的向量 $\\mathbf{f}_s, \\mathbf{f}_f$。\n\n**3. 耦合算子的组装 ($C_s, C_f, D_s, D_f$)**\n这些算子是列向量（或 $N \\times 1$ 矩阵），将标量拉格朗日乘子映射到子域自由度上的力。\n- **$C_s$, $C_f$ (迹算子)**：\n  - $C_s^\\top \\mathbf{u}_s = u_s(L_s) = u_{s,N_s}$。由于 $\\mathbf{u}_s = [u_{s,1}, \\dots, u_{s,N_s}]^\\top$，向量 $C_s^\\top$ 必须是 $[0, \\dots, 0, 1]$。因此，$C_s = [0, \\dots, 0, 1]^\\top$，一个大小为 $N_s$ 的列向量。\n  - $C_f^\\top \\mathbf{u}_f = u_f(L_s) = u_{f,0}$。由于 $\\mathbf{u}_f = [u_{f,0}, \\dots, u_{f,N_f-1}]^\\top$，向量 $C_f^\\top$ 必须是 $[1, 0, \\dots, 0]$。因此，$C_f = [1, 0, \\dots, 0]^\\top$，一个大小为 $N_f$ 的列向量。\n\n- **$D_s$, $D_f$ (牵引力算子)**：\n  - $D_s^\\top \\mathbf{u}_s \\approx a_s \\frac{du_s}{dx}(L_s^-)$。最后一个单元上的导数为 $\\frac{u_{s,N_s} - u_{s,N_s-1}}{h_s}$。如果 $N_s=1$，则变为 $\\frac{u_{s,1} - u_{s,0}}{h_s} = \\frac{u_{s,1}}{h_s}$，因为 $u_{s,0}=0$。\n    - 对于 $N_s>1$，$D_s^\\top \\mathbf{u}_s = \\frac{a_s}{h_s} (u_{s,N_s} - u_{s,N_s-1})$。所以 $D_s = \\frac{a_s}{h_s} [0, \\dots, 0, -1, 1]^\\top$。\n    - 对于 $N_s=1$，$D_s^\\top \\mathbf{u}_s = \\frac{a_s}{h_s} u_{s,1}$。所以 $D_s = [\\frac{a_s}{h_s}]^\\top$。\n  - $D_f^\\top \\mathbf{u}_f \\approx -a_f \\frac{du_f}{dx}(L_s^+)$。第一个单元上的导数为 $\\frac{u_{f,1} - u_{f,0}}{h_f}$。近似变为 $-a_f \\frac{u_{f,1} - u_{f,0}}{h_f} = a_f \\frac{u_{f,0} - u_{f,1}}{h_f}$。如果 $N_f=1$，则为 $\\frac{a_f}{h_f}(u_{f,0} - u_{f,1}) = \\frac{a_f}{h_f} u_{f,0}$，因为 $u_{f,1}=0$。\n    - 对于 $N_f>1$，$D_f^\\top \\mathbf{u}_f = \\frac{a_f}{h_f} (u_{f,0} - u_{f,1})$。所以 $D_f = \\frac{a_f}{h_f} [1, -1, 0, \\dots, 0]^\\top$。\n    - 对于 $N_f=1$，$D_f^\\top \\mathbf{u}_f = \\frac{a_f}{h_f} u_{f,0}$。所以 $D_f = [\\frac{a_f}{h_f}]^\\top$。\n\n**4. 全局系统组装与求解**\n根据指定的结构，逐块组装大小为 $(N_s+N_f+2) \\times (N_s+N_f+2)$ 的完整矩阵 $A$ 和右侧向量 $B$。然后求解线性系统 $A\\mathbf{x} = B$ 以获得解向量 $\\mathbf{x} = [\\mathbf{u}_s^\\top, \\mathbf{u}_f^\\top, \\lambda_u, \\lambda_t]^\\top$。\n\n**5. 结果提取**\n- 界面位移是 $u_\\Gamma = u_s(L_s)$，它是解向量 $\\mathbf{u}_s$ 部分的最后一个分量：$u_\\Gamma = \\mathbf{x}[N_s-1]$。\n- 界面牵引力是 $t_\\Gamma = a_s \\frac{du_s}{dx}(L_s^-)$，使用其离散表示计算：$t_\\Gamma = D_s^\\top \\mathbf{u}_s$。\n\n下面的 Python 代码实现了这种结构化的方法。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef build_subdomain_system(N, L, a, q, bc_at_zero):\n    \"\"\"\n    Assembles the stiffness matrix K and load vector f for a 1D subdomain\n    with N elements, length L, coefficient a, and source q.\n    Homogeneous Dirichlet BC is applied at one end.\n\n    bc_at_zero=True: BC at x=0 (e.g., solid domain)\n    bc_at_zero=False: BC at the other end, x=L (e.g., fluid domain)\n    \"\"\"\n    if N == 0:\n        return np.array([]).reshape(0,0), np.array([])\n        \n    num_nodes = N + 1\n    h = L / N\n    \n    # Full stiffness matrix (num_nodes x num_nodes) before BCs\n    K_full = np.zeros((num_nodes, num_nodes))\n    for i in range(N):\n        k_elem = (a / h) * np.array([[1, -1], [-1, 1]])\n        K_full[i:i+2, i:i+2] += k_elem\n        \n    # Full load vector (num_nodes) before BCs\n    f_full = np.zeros(num_nodes)\n    if q != 0:\n        for i in range(N):\n            f_elem = (q * h / 2.0) * np.array([1, 1])\n            f_full[i:i+2] += f_elem\n        \n    if bc_at_zero:\n        # BC at node 0 (u_0 = 0), unknowns are u_1, ..., u_N\n        # Matrix size becomes N x N\n        K = K_full[1:, 1:]\n        f = f_full[1:]\n    else:\n        # BC at node N (u_N = 0), unknowns are u_0, ..., u_{N-1}\n        # Matrix size becomes N x N\n        K = K_full[:-1, :-1]\n        f = f_full[:-1]\n        \n    return K, f\n\ndef solve_case(Ls, Lf, Ns, Nf, a_s, a_f, q_s, q_f):\n    \"\"\"\n    Assembles and solves the saddle-point system for one test case.\n    \"\"\"\n    hs = Ls / Ns\n    hf = Lf / Nf\n    \n    # Assemble subdomain matrices\n    Ks, fs = build_subdomain_system(Ns, Ls, a_s, q_s, bc_at_zero=True)\n    Kf, ff = build_subdomain_system(Nf, Lf, a_f, q_f, bc_at_zero=False)\n\n    # Assemble coupling operators (as column vectors)\n    Cs = np.zeros((Ns, 1))\n    Cs[-1, 0] = 1.0\n    \n    Cf = np.zeros((Nf, 1))\n    if Nf > 0:\n        Cf[0, 0] = 1.0\n\n    Ds = np.zeros((Ns, 1))\n    if Ns > 1:\n        Ds[-2, 0] = -(a_s / hs)\n        Ds[-1, 0] = a_s / hs\n    elif Ns == 1:\n        Ds[0, 0] = a_s / hs\n\n    Df = np.zeros((Nf, 1))\n    if Nf > 1:\n        Df[0, 0] = a_f / hf\n        Df[1, 0] = -(a_f / hf)\n    elif Nf == 1:\n        Df[0, 0] = a_f / hf\n        \n    # Assemble the full saddle-point system\n    total_dofs = Ns + Nf + 2\n    A = np.zeros((total_dofs, total_dofs))\n    B = np.zeros(total_dofs)\n\n    # stiffness blocks\n    if Ns > 0:\n        A[0:Ns, 0:Ns] = Ks\n    if Nf > 0:\n        A[Ns:Ns+Nf, Ns:Ns+Nf] = Kf\n    \n    # RHS load vectors\n    if Ns > 0:\n        B[0:Ns] = fs\n    if Nf > 0:\n        B[Ns:Ns+Nf] = ff\n    \n    # Coupling blocks C\n    if Ns > 0:\n        A[0:Ns, Ns+Nf] = Cs[:, 0]\n        A[Ns+Nf, 0:Ns] = Cs[:, 0].T\n    if Nf > 0:\n        A[Ns:Ns+Nf, Ns+Nf] = -Cf[:, 0]\n        A[Ns+Nf, Ns:Ns+Nf] = -Cf[:, 0].T\n\n    # Coupling blocks D\n    if Ns > 0:\n        A[0:Ns, Ns+Nf+1] = Ds[:, 0]\n        A[Ns+Nf+1, 0:Ns] = Ds[:, 0].T\n    if Nf > 0:\n        A[Ns:Ns+Nf, Ns+Nf+1] = Df[:, 0]\n        A[Ns+Nf+1, Ns:Ns+Nf] = Df[:, 0].T\n\n    # Solve the system\n    x = np.linalg.solve(A, B)\n    \n    # Extract solutions\n    u_s_sol = x[0:Ns]\n    \n    # Interface displacement u_gamma = u_s(Ls)\n    u_gamma = u_s_sol[-1]\n    \n    # Interface traction t_gamma = a_s * du_s/dx(Ls)\n    # Computed as D_s^T * u_s\n    t_gamma = (Ds.T @ u_s_sol)[0]\n    \n    return u_gamma, t_gamma\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Ls, Lf, Ns, Nf, as, af, qs, qf)\n        (1.0, 1.0, 4, 3, 2.0, 1.0, 1.0, 0.5),\n        (1.0, 2.0, 2, 8, 10.0, 0.1, 0.0, 3.0),\n        (0.5, 0.5, 2, 2, 1.0, 1.0, 1.0, 1.0),\n        (1.5, 0.5, 5, 2, 5.0, 5.0, 0.0, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        u_gamma, t_gamma = solve_case(*case)\n        results.append(u_gamma)\n        results.append(t_gamma)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3618425"}, {"introduction": "模拟动态断裂，如地震破裂，是计算地球物理学的前沿挑战。基于变分能量原理的相场模型通过一个连续的损伤场来表示尖锐的裂纹，提供了一种强大的方法。这个高级实践将挑战您实现一个完全耦合的弹性动力学和相场断裂模型。您需要将一个复杂的能量泛函转化为其弱形式，为得到的非线性偏微分方程组构建一个交错时间步进求解器，并探索破裂扩展的动力学，展示了如何运用变分方法来建立和求解复杂的非线性多物理场问题。[@problem_id:3618401]", "problem": "您的任务是为与计算地球物理学中的地震破裂相关的一维耦合相场断裂和线性弹性动力学模型，推导并实现一个弱变分形式。该控制模型基于一个总能量泛函，其中包含了脆性断裂的相场正则化和退化的线性弹性应变能密度。您必须使用无量纲变量（无单位）进行计算，因此不需要物理单位。\n\n从以下基本出发点开始：\n- 一维杆的线性动量守恒：$ \\rho \\, \\partial_{tt} u - \\partial_x \\sigma = 0 $，其中 $ \\rho $ 是质量密度，$ u(x,t) $ 是位移，$ \\sigma(x,t) $ 是 Cauchy 应力。\n- 由标量损伤（相场）$ d(x,t) \\in [0,1] $ 退化的线性弹性本构关系：$ \\sigma = g(d) \\, E \\, \\varepsilon $，其中 $ E $ 是杨氏模量，$ \\varepsilon = \\partial_x u $ 是小应变，$ g(d) = (1-\\kappa) (1-d)^2 + \\kappa $ 是退化函数，带有残余刚度参数 $ \\kappa \\in (0,1) $。\n- 具有内禀长度 $ \\ell > 0 $ 和临界能量释放率 $ G_c > 0 $ 的正则化 Griffith 型断裂能，其总能量密度为\n$$\n\\mathcal{E}(u,d) = G_c \\left( \\frac{(1-d)^2}{\\ell} + \\ell \\, |\\partial_x d|^2 \\right) + \\psi(\\varepsilon(u),d), \\quad \\psi(\\varepsilon,d) = \\frac{1}{2} g(d) \\, E \\, \\varepsilon^2 .\n$$\n\n耦合的偏微分方程（PDE）组为：\n- 弹性动力学：$ \\rho \\, \\partial_{tt} u - \\partial_x \\left( g(d) E \\, \\partial_x u \\right) = 0 $。\n- 相场（在每个时间点对 $d$ 进行准静态最小化）：通过 $ \\int \\mathcal{E}(u,d) \\, dx $ 关于 $d$ 的平稳性得到 Euler–Lagrange 方程，其中 $d$ 具有齐次自然边界条件。\n\n边界条件和初始条件为：\n- 位移边界条件 (Dirichlet)：$ u(0,t) = 0 $ 和 $ u(L,t) = U_0(t) $，其中 $ L > 0 $ 是杆的长度，$ U_0(t) $ 是一个给定的光滑边界位移脉冲。\n- 相场损伤 $ d(x,t) $ 满足齐次 Neumann 边界条件 $ \\partial_x d(0,t) = \\partial_x d(L,t) = 0 $。\n- 初始条件：$ u(x,0) = 0 $，$ \\partial_t u(x,0) = 0 $，以及在区域中心为 $ d(x,0) $ 设置一个小的初始缺陷以引发断裂，具体规定如下。\n\n您的任务：\n\n1) 推导弱形式：\n- 从基本出发点开始，通过乘以一个测试函数 $ v \\in H_0^1(0,L) $（在位移边界上为零的函数）并在空间上进行分部积分，推导弹性动力学方程的弱形式。\n- 通过取总能量关于 $d$ 的一阶变分，乘以一个测试函数 $ \\eta \\in H^1(0,L) $，在空间上进行分部积分，并确定自然边界条件，来推导相场方程的弱形式。\n\n2) 提出并论证一个稳定、一致的数值格式：\n- 对 $u$ 在时间上使用中心差分，并在 $[0,L]$ 上的具有 $N+1$ 个节点的均匀网格上，对 $ \\partial_x \\left( g(d) E \\, \\partial_x u \\right) $ 在空间上使用有限体积或有限元风格的离散化。\n- 在每个时间步通过一个关于 $ d $ 的线性化 Euler–Lagrange 方程来准静态地处理损伤 $ d $。该方程通过代入 $ \\partial \\psi / \\partial d = g'(d) \\, \\frac{E}{2} \\, \\varepsilon^2 $（其中 $ g'(d) = -2(1-\\kappa)(1-d) $）并整理成以下形式的线性椭圆问题得到：\n$$\n\\left( \\frac{2 G_c}{\\ell} + (1-\\kappa) E \\, \\varepsilon^2 \\right) d - 2 G_c \\ell \\, \\partial_{xx} d = \\left( \\frac{2 G_c}{\\ell} + (1-\\kappa) E \\, \\varepsilon^2 \\right).\n$$\n- 通过在每个时间步将解投影到这些约束上，来强制实施 $ d \\in [0,1] $ 和不可逆性 $ d^{n+1}(x) \\ge d^n(x) $，具体方法为节点裁剪 $ d^{n+1} = \\max\\{ d^n, \\min\\{1, \\tilde d^{n+1} \\} \\} $。\n\n3) 在一个程序中实现以下求解器：\n- 空间域：$ [0,L] $，其中 $ L = 1 $。使用 $ N+1 $ 个节点，位置为 $ x_i = i h $，$ i = 0,1,\\dots,N $，其中 $ h = L/N $。\n- $d$的初始缺陷：$ d(x,0) = d_\\text{seed} \\exp\\left( - \\frac{(x - L/2)^2}{2 \\sigma^2} \\right) $，其中 $ d_\\text{seed} = 0.05 $ 且 $ \\sigma = 2 \\ell $。\n- 边界位移：使用 Ricker 脉冲 $ U_0(t) = A \\left(1 - 2 \\pi^2 f^2 (t - t_0)^2 \\right) \\exp\\left( - \\pi^2 f^2 (t - t_0)^2 \\right) $，其中 $ t_0 = 3/f $。\n- $u$ 的时间积分：内部节点的中心差分更新，\n$$\nu^{n+1}_i = 2 u^n_i - u^{n-1}_i + \\frac{\\Delta t^2}{\\rho} \\left[ \\frac{1}{h} \\left( a_{i+\\frac{1}{2}} \\frac{u^n_{i+1} - u^n_i}{h} - a_{i-\\frac{1}{2}} \\frac{u^n_i - u^n_{i-1}}{h} \\right) \\right], \\quad a = g(d) E,\n$$\n其中 $ u^n_0 = 0 $ 且 $ u^n_N = U_0(t_n) $。初始化所有 $i$ 的 $ u^0_i = 0 $ 以及 $ u^{-1}_i = u^0_i $。\n- 损伤更新：在每个时间步上，对具有齐次 Neumann 条件的节点求解线性化椭圆问题，使用 $ \\partial_{xx} d $ 的一致二阶有限差分近似，包括针对零通量的边界修正。然后投影 $d$ 以强制 $ d \\in [0,1] $ 和不可逆性。\n- 在每个测试用例的最终时间 $ t = n_\\text{steps} \\, \\Delta t $ 进行能量诊断：\n  - 动能：$ K = \\frac{1}{2} \\rho \\sum_{i=0}^{N} h \\left( \\frac{u^n_i - u^{n-1}_i}{\\Delta t} \\right)^2 $。\n  - 弹性势能：在单元 $ i = 0,\\dots,N-1 $ 上近似计算，单元应变为 $ \\varepsilon_i = (u^n_{i+1} - u^n_i)/h $，单元退化为 $ g_i = (1-\\kappa) (1 - d_{\\text{cell},i})^2 + \\kappa $，其中 $ d_{\\text{cell},i} = \\frac{1}{2}( d^n_i + d^n_{i+1} ) $，形式如下：\n  $$\n  \\Pi_\\text{el} = \\frac{1}{2} \\sum_{i=0}^{N-1} h \\, g_i \\, E \\, \\varepsilon_i^2 .\n  $$\n  - 断裂能：节点部分加梯度部分，\n  $$\n  \\Pi_\\text{frac} = \\sum_{i=0}^{N} h \\, G_c \\, \\frac{(1 - d^n_i)^2}{\\ell} + \\sum_{i=0}^{N-1} h \\, G_c \\, \\ell \\left( \\frac{d^n_{i+1} - d^n_i}{h} \\right)^2 .\n  $$\n  - 总能量：$ \\Pi_\\text{tot} = K + \\Pi_\\text{el} + \\Pi_\\text{frac} $。\n- 每个测试用例的输出：计算最终最大损伤 $ d_\\text{max} = \\max_i d^n_i $ 和最终总能量 $ \\Pi_\\text{tot} $。\n\n4) 测试套件和要求的最终输出格式：\n运行您的程序以执行以下三个测试用例。所有变量都是无量纲和无单位的。\n\n- 测试用例 1（顺利路径）：\n  - $ N = 200 $, $ L = 1 $, $ \\Delta t = 0.004 $, $ n_\\text{steps} = 600 $,\n  - $ E = 1.0 $, $ \\rho = 1.0 $, $ G_c = 0.002 $, $ \\ell = 0.02 $, $ \\kappa = 10^{-6} $,\n  - $ A = 0.001 $, $ f = 4.0 $。\n\n- 测试用例 2（更小的内禀长度，更容易局部化）：\n  - $ N = 200 $, $ L = 1 $, $ \\Delta t = 0.004 $, $ n_\\text{steps} = 600 $,\n  - $ E = 1.0 $, $ \\rho = 1.0 $, $ G_c = 0.0015 $, $ \\ell = 0.01 $, $ \\kappa = 10^{-6} $,\n  - $ A = 0.001 $, $ f = 4.0 $。\n\n- 测试用例 3（更高的刚度，接近稳定性极限）：\n  - $ N = 200 $, $ L = 1 $, $ \\Delta t = 0.003 $, $ n_\\text{steps} = 700 $,\n  - $ E = 2.0 $, $ \\rho = 1.0 $, $ G_c = 0.0025 $, $ \\ell = 0.02 $, $ \\kappa = 10^{-6} $,\n  - $ A = 0.0008 $, $ f = 5.0 $。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来、无空格的逗号分隔列表，顺序为\n$ [ d_{\\text{max},1}, \\Pi_{\\text{tot},1}, d_{\\text{max},2}, \\Pi_{\\text{tot},2}, d_{\\text{max},3}, \\Pi_{\\text{tot},3} ] $，\n其中下标表示测试用例编号。所有值均为浮点数。", "solution": "用户为耦合弹性动力学和相场断裂模型提供了一个全面的问题陈述。该问题在科学上是有效的、适定的，并包含了推导和实现所需的所有必要细节。\n\n### 1. 弱形式的推导\n\n弱形式（也称为变分形式）的推导是通过将控制偏微分方程（PDE）乘以合适的测试函数并在空间域上积分来完成的。这个过程将导数从解变量（$u, d$）转移到测试函数上，从而放宽了对解的光滑性要求。\n\n#### 1.1 弹性动力学弱形式\n\n一维线性动量守恒由以下公式给出：\n$$\n\\rho \\, \\partial_{tt} u - \\partial_x \\sigma = 0 \\quad \\text{for } x \\in (0, L)\n$$\n其中 $\\rho$ 是质量密度，$u(x,t)$ 是位移，$\\sigma(x,t)$ 是 Cauchy 应力。应力通过损伤退化的本构关系 $\\sigma = g(d) E \\varepsilon$ 与应变 $\\varepsilon = \\partial_x u$ 相关，其中 $E$ 是杨氏模量，$g(d)$ 是退化函数。将本构关系代入动量方程得到：\n$$\n\\rho \\, \\partial_{tt} u - \\partial_x \\left( g(d) E \\, \\partial_x u \\right) = 0\n$$\n为了推导弱形式，我们乘以一个测试函数 $v(x)$ 并在域 $[0,L]$ 上积分。测试函数 $v$ 必须属于一个函数空间，该空间中的函数满足施加在 $u$ 上的 Dirichlet 边界条件的齐次形式。由于 $u(0,t)=0$ 和 $u(L,t)=U_0(t)$，测试函数 $v$ 属于 Sobolev 空间 $H_0^1(0,L)$，该空间包含具有平方可积一阶导数的平方可积函数，并且在边界上为零：$v(0)=0$ 和 $v(L)=0$。\n\n积分后的方程是：\n$$\n\\int_0^L \\left( \\rho \\, (\\partial_{tt} u) v - v \\, \\partial_x \\left( g(d) E \\, \\partial_x u \\right) \\right) dx = 0\n$$\n我们对第二项应用分部积分：\n$$\n\\int_0^L -v \\, \\partial_x \\sigma \\, dx = -[v \\sigma]_0^L + \\int_0^L \\sigma \\partial_x v \\, dx\n$$\n边界项 $[v \\sigma]_0^L = v(L)\\sigma(L,t) - v(0)\\sigma(0,t)$ 为零，因为 $v(0)=v(L)=0$。将其代回，我们得到弹性动力学方程的弱形式：\n\n寻找 $u(\\cdot, t)$（满足 Dirichlet 边界条件），使得对于所有测试函数 $v \\in H_0^1(0,L)$：\n$$\n\\int_0^L \\rho \\, (\\partial_{tt} u) v \\, dx + \\int_0^L \\left( g(d) E \\, \\partial_x u \\right) \\partial_x v \\, dx = 0\n$$\n\n#### 1.2 相场弱形式\n\n相场变量 $d$ 的演化由总能量泛函 $I(d) = \\int_0^L \\mathcal{E}(u,d) \\, dx$ 在每个时间步的平稳性控制，其中应变场 $\\varepsilon = \\partial_x u$ 被视为固定输入。能量密度为：\n$$\n\\mathcal{E}(u,d) = G_c \\left( \\frac{(1-d)^2}{\\ell} + \\ell \\, |\\partial_x d|^2 \\right) + \\frac{1}{2} g(d) \\, E \\, \\varepsilon^2\n$$\n平稳性条件是总能量关于 $d$ 的一阶变分对于所有容许的变分 $\\eta$ 都为零。这里，测试函数 $\\eta$ 属于空间 $H^1(0,L)$，因为没有对 $d$ 施加 Dirichlet 条件。\n$$\n\\delta I(d)[\\eta] = \\left. \\frac{d}{d\\alpha} I(d+\\alpha\\eta) \\right|_{\\alpha=0} = 0 \\quad \\forall \\eta \\in H^1(0,L)\n$$\n计算关于 $\\alpha$ 的导数得到：\n$$\n\\int_0^L \\left[ G_c \\left( \\frac{2(1-d)(-\\eta)}{\\ell} + 2\\ell \\, (\\partial_x d)(\\partial_x \\eta) \\right) + \\frac{1}{2} g'(d)\\eta \\, E \\, \\varepsilon^2 \\right] dx = 0\n$$\n其中 $g'(d) = -2(1-\\kappa)(1-d)$。整理各项，我们得到相场方程的弱形式：\n\n寻找 $d(\\cdot, t) \\in H^1(0,L)$，使得对于所有测试函数 $\\eta \\in H^1(0,L)$：\n$$\n\\int_0^L \\left( 2 G_c \\ell (\\partial_x d) (\\partial_x \\eta) + \\left[ \\frac{2G_c}{\\ell}(1-d) - \\frac{1}{2}g'(d)E\\varepsilon^2 \\right] \\eta \\right) dx = 0\n$$\n为了确定自然边界条件，我们对第一项进行分部积分：\n$$\n\\int_0^L \\left( -\\left(2 G_c \\ell \\partial_{xx} d\\right) \\eta + \\left[ \\frac{2G_c}{\\ell}(1-d) - \\frac{1}{2}g'(d)E\\varepsilon^2 \\right] \\eta \\right) dx + [2 G_c \\ell (\\partial_x d) \\eta]_0^L = 0\n$$\n为使此式对任意 $\\eta$（包括在边界上非零的 $\\eta$）成立，被积函数和边界项必须独立为零。边界项为零意味着 $2 G_c \\ell (\\partial_x d) \\eta \\rvert_{x=L} - 2 G_c \\ell (\\partial_x d) \\eta \\rvert_{x=0} = 0$。由于 $\\eta(0)$ 和 $\\eta(L)$ 可以任意选择，这要求 $\\partial_x d(0,t)=0$ 和 $\\partial_x d(L,t)=0$。这些是问题中陈述的齐次 Neumann 边界条件，它们从变分原理中自然产生。\n\n### 2. 数值格式的论证\n\n问题指定了一个交错数值格式，其合理性论证如下：\n-   **$u$ 的时间积分**：显式中心差分（蛙跳）格式在时间上是二阶精确的，并且计算成本低，因为它不需要求解线性系统。其稳定性是条件性的，由 Courant-Friedrichs-Lewy (CFL) 条件 $\\max(\\sqrt{g(d)E/\\rho}) \\Delta t / h \\le 1$ 控制。测试用例中提供的参数满足此条件。\n-   **$u$ 的空间离散**：提供的弹性动力学方程的有限差分公式是一个二阶精确的模板，可以解释为一种有限体积法。它正确处理了空间变化的刚度 $a(x) = g(d(x))E$，确保了局部动量守恒。\n-   **准静态损伤更新**：在每个时间步，位移场提供一个应变场。然后通过求解对应的 $d$ 的 Euler-Lagrange 方程来更新损伤场。该方程在代入 $g'(d)$ 后，在每个时间步变成一个关于 $d$ 的线性椭圆（Helmholtz 型）方程，假设应变 $\\varepsilon$ 已知：\n    $$\n    \\left( \\frac{2 G_c}{\\ell} + (1-\\kappa) E \\, \\varepsilon^2 \\right) d - 2 G_c \\ell \\, \\partial_{xx} d = \\left( \\frac{2 G_c}{\\ell} + (1-\\kappa) E \\, \\varepsilon^2 \\right)\n    $$\n    该方程可以通过使用 $\\partial_{xx}d$ 的有限差分法高效求解。使用虚点来实现齐次 Neumann 边界条件是一种标准的二阶精确技术。这会产生一个在每个时间步求解的三对角线性系统。\n-   **不可逆性和约束**：损伤是一个耗散过程，必须是不可逆的（$d^{n+1} \\ge d^n$）。相场变量也是有界的，$d \\in [0,1]$。这些物理约束通过一个投影（裁剪）步骤来强制执行：$d^{n+1} = \\max\\{ d^n, \\min\\{1, \\tilde d^{n+1} \\} \\}$，其中 $\\tilde d$ 是线性系统的解。这是一种常用且实用的方法。\n\n### 3. 实现\n\n实现遵循一个时间步进循环。在每个步骤中：\n1.  使用中心差分格式，基于前两个时间层级的场和前一个层级的损伤场，将位移场 `u` 更新到下一个时间层级。\n2.  使用得到的新位移场计算应变场。\n3.  使用新的应变场组装损伤场 `d` 的线性系统的系数。\n4.  求解 `d` 的三对角线性系统。\n5.  对解进行投影以强制执行 `d` 上的物理约束。\n6.  更新场，模拟进入下一个时间步。\n\n在最后一个时间步之后，按照规定计算诊断量（动能、弹性能和断裂能），提供系统状态的快照。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the coupled 1D phase-field fracture and elastodynamics problem\n    for a set of test cases.\n    \"\"\"\n    # Test case parameters\n    test_cases = [\n        # Case 1: Happy path\n        {'N': 200, 'L': 1.0, 'dt': 0.004, 'n_steps': 600,\n         'E': 1.0, 'rho': 1.0, 'Gc': 0.002, 'ell': 0.02, 'kappa': 1e-6,\n         'A': 0.001, 'f': 4.0, 'd_seed': 0.05, 'sigma_d_factor': 2.0},\n        # Case 2: Smaller internal length, easier localization\n        {'N': 200, 'L': 1.0, 'dt': 0.004, 'n_steps': 600,\n         'E': 1.0, 'rho': 1.0, 'Gc': 0.0015, 'ell': 0.01, 'kappa': 1e-6,\n         'A': 0.001, 'f': 4.0, 'd_seed': 0.05, 'sigma_d_factor': 2.0},\n        # Case 3: Higher stiffness, near stability limit\n        {'N': 200, 'L': 1.0, 'dt': 0.003, 'n_steps': 700,\n         'E': 2.0, 'rho': 1.0, 'Gc': 0.0025, 'ell': 0.02, 'kappa': 1e-6,\n         'A': 0.0008, 'f': 5.0, 'd_seed': 0.05, 'sigma_d_factor': 2.0}\n    ]\n\n    all_results = []\n\n    for params in test_cases:\n        # Unpack parameters\n        N = params['N']\n        L = params['L']\n        dt = params['dt']\n        n_steps = params['n_steps']\n        E = params['E']\n        rho = params['rho']\n        Gc = params['Gc']\n        ell = params['ell']\n        kappa = params['kappa']\n        A = params['A']\n        f = params['f']\n        d_seed = params['d_seed']\n        sigma_d_factor = params['sigma_d_factor']\n        \n        # Spatial grid\n        h = L / N\n        x = np.linspace(0, L, N + 1)\n\n        # Time parameter for Ricker pulse\n        t0 = 3.0 / f\n\n        # Ricker pulse function for boundary displacement\n        def ricker_pulse(t):\n            arg = (np.pi * f * (t - t0))**2\n            return A * (1.0 - 2.0 * arg) * np.exp(-arg)\n\n        # Degradation function\n        def g(d_field):\n            return (1 - kappa) * (1 - d_field)**2 + kappa\n\n        # --- Initialization ---\n        # Displacement fields at t(n-1), t(n), t(n+1)\n        u_nm1 = np.zeros(N + 1)\n        u_n = np.zeros(N + 1)\n        u_n1 = np.zeros(N + 1)\n\n        # Initial damage field (small flaw)\n        sigma_d = sigma_d_factor * ell\n        d_n = d_seed * np.exp(-(x - L / 2)**2 / (2 * sigma_d**2))\n        \n        # --- Time-stepping loop ---\n        for n in range(n_steps):\n            t_n = n * dt\n\n            # Apply displacement BC at time t_n\n            u_n[0] = 0.0\n            u_n[N] = ricker_pulse(t_n)\n\n            # Compute stiffness coefficients a = g(d)E at cell centers\n            d_cell = 0.5 * (d_n[:-1] + d_n[1:])\n            a = g(d_cell) * E\n            \n            # --- Update displacement u ---\n            # Central difference update for interior nodes\n            stress_div = (a[1:] * (u_n[2:] - u_n[1:-1]) - a[:-1] * (u_n[1:-1] - u_n[:-2])) / h**2\n            u_n1[1:-1] = 2 * u_n[1:-1] - u_nm1[1:-1] + (dt**2 / rho) * stress_div\n\n            # Apply displacement BC at time t_{n+1}\n            u_n1[0] = 0.0\n            u_n1[N] = ricker_pulse(t_n + dt)\n\n            # --- Update damage d ---\n            # 1. Compute strain at nodes from u_n1\n            eps = np.zeros(N + 1)\n            eps[1:-1] = (u_n1[2:] - u_n1[:-2]) / (2 * h) # Central difference\n            eps[0] = (u_n1[1] - u_n1[0]) / h          # Forward difference\n            eps[N] = (u_n1[N] - u_n1[N-1]) / h      # Backward difference\n\n            # 2. Assemble and solve the linear system for d_tilde\n            C = (2 * Gc / ell) + (1 - kappa) * E * eps**2\n            b = C.copy() # Right-hand side\n\n            ab = np.zeros((3, N + 1))\n            k_h2 = (2 * Gc * ell) / h**2\n            \n            ab[1, :] = C + 2 * k_h2                          # Main diagonal\n            ab[0, 1:] = -k_h2                                 # Upper diagonal\n            ab[2, :N] = -k_h2                                 # Lower diagonal\n            \n            # Boundary conditions (Neumann) modifications\n            ab[0, 1] = -2 * k_h2                              # A[0,1]\n            ab[2, N-1] = -2 * k_h2                              # A[N,N-1]\n            \n            d_tilde_n1 = solve_banded((1, 1), ab, b)\n            \n            # 3. Project d_tilde to enforce constraints\n            d_n1 = np.maximum(d_n, np.minimum(1.0, d_tilde_n1))\n\n            # --- Prepare for next time step ---\n            u_nm1, u_n = u_n, u_n1\n            d_n = d_n1\n\n        # --- Post-processing: Calculate diagnostics at final step ---\n        v_final = (u_n - u_nm1) / dt\n        K = 0.5 * rho * np.sum(h * v_final**2)\n\n        eps_cell = (u_n[1:] - u_n[:-1]) / h\n        d_cell_final = 0.5 * (d_n[:-1] + d_n[1:])\n        g_cell_final = g(d_cell_final)\n        Pi_el = 0.5 * np.sum(h * g_cell_final * E * eps_cell**2)\n\n        d_grad_sq = ((d_n[1:] - d_n[:-1]) / h)**2\n        term1 = np.sum(h * Gc * (1 - d_n)**2 / ell)\n        term2 = np.sum(h * Gc * ell * d_grad_sq)\n        Pi_frac = term1 + term2\n\n        Pi_tot = K + Pi_el + Pi_frac\n        d_max = np.max(d_n)\n        \n        all_results.extend([d_max, Pi_tot])\n        \n    print(f\"[{','.join(f'{val:.6f}' for val in all_results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3618401"}]}