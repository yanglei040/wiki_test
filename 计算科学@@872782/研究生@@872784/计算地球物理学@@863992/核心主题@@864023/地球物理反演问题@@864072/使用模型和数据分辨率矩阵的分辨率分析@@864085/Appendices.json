{"hands_on_practices": [{"introduction": "模型分辨率矩阵 $R_m$ 是连接真实模型与我们估计结果的桥梁，它揭示了反演过程引入的平滑或偏差。通过在一个简单的、可解析的系统中分析 $R_m$ 的特征值，我们可以深刻理解模型不同部分的解析程度，以及病态问题是如何从模型参数中产生的[@problem_id:3613752]。这个练习将通过推导一个特定 $2 \\times 2$ 系统的分辨率矩阵及其最小特征值，来量化分辨率与模型近零空间之间的关系。", "problem": "考虑一个计算地球物理学中的线性反演问题，其中数据向量 $\\mathbf{d} \\in \\mathbb{R}^{2}$ 由 $\\mathbf{d} = G \\mathbf{m} + \\mathbf{e}$ 建模。这里，模型向量为 $\\mathbf{m} \\in \\mathbb{R}^{2}$，正演算子为 $G \\in \\mathbb{R}^{2 \\times 2}$，数据噪声 $\\mathbf{e}$ 被建模为一个零均值高斯随机向量，其协方差矩阵为 $C_{d} = \\sigma^{2} I$，其中 $\\sigma  0$，$I$ 是单位矩阵。正演算子为\n$$\nG = \\begin{bmatrix} 1  1 \\\\ 0  \\alpha \\end{bmatrix},\n$$\n其中 $\\alpha  0$。为了在可能存在的病态性情况下稳定反演，考虑采用阻尼参数 $\\lambda  0$ 的零阶吉洪诺夫正则化，其中模型估计通过最小化目标泛函\n$$\n\\|\\mathbf{d} - G \\mathbf{m}\\|_{C_{d}^{-1}}^{2} + \\lambda^{2} \\|\\mathbf{m}\\|^{2},\n$$\n来获得，而模型分辨率矩阵 $R_{m}$ 是根据估计量对真实模型的作用来定义的。从加权最小二乘法和正则化的第一性原理出发，推导模型分辨率矩阵 $R_{m}$ 并分析其特征结构。\n\n你的任务是提供模型分辨率矩阵 $R_{m}$ 最小特征值的精确闭式表达式，该表达式是关于 $\\alpha$、$\\sigma$ 和 $\\lambda$ 的函数。不要四舍五入；以精确的符号形式提供最终表达式。此外，在你的推导中，解释当 $\\alpha \\to 0$ 时的行为如何揭示反演问题中近零空间的出现。最终答案必须是 $R_{m}$ 最小特征值的单个闭式解析表达式。", "solution": "该问题是有效的，因为它具有科学依据、是适定的且客观的。它代表了计算地球物理学中正则化线性反演问题的一种标准形式。所有提供的信息都是自洽和一致的。\n\n目标是求解使用吉洪诺夫方法正则化的线性反演问题中模型分辨率矩阵 $R_{m}$ 的最小特征值。模型估计 $\\hat{\\mathbf{m}}$ 通过最小化目标泛函 $J(\\mathbf{m})$ 求得：\n$$\nJ(\\mathbf{m}) = \\|\\mathbf{d} - G \\mathbf{m}\\|_{C_{d}^{-1}}^{2} + \\lambda^{2} \\|\\mathbf{m}\\|^{2}\n$$\n给定数据协方差矩阵为 $C_{d} = \\sigma^{2} I$，其逆矩阵为 $C_{d}^{-1} = \\frac{1}{\\sigma^{2}} I$。该泛函变为：\n$$\nJ(\\mathbf{m}) = \\frac{1}{\\sigma^{2}} (\\mathbf{d} - G \\mathbf{m})^{T} (\\mathbf{d} - G \\mathbf{m}) + \\lambda^{2} \\mathbf{m}^{T} \\mathbf{m}\n$$\n为了找到最小化 $J(\\mathbf{m})$ 的模型估计 $\\hat{\\mathbf{m}}$，我们计算其关于 $\\mathbf{m}$ 的梯度并令其为零：\n$$\n\\nabla_{\\mathbf{m}} J(\\mathbf{m}) = \\frac{1}{\\sigma^{2}} \\nabla_{\\mathbf{m}} (\\mathbf{d}^{T}\\mathbf{d} - 2\\mathbf{d}^{T}G\\mathbf{m} + \\mathbf{m}^{T}G^{T}G\\mathbf{m}) + \\lambda^{2} \\nabla_{\\mathbf{m}} (\\mathbf{m}^{T}\\mathbf{m})\n$$\n$$\n\\nabla_{\\mathbf{m}} J(\\mathbf{m}) = \\frac{1}{\\sigma^{2}} (-2G^{T}\\mathbf{d} + 2G^{T}G\\mathbf{m}) + 2\\lambda^{2}\\mathbf{m} = \\mathbf{0}\n$$\n两边乘以 $\\frac{\\sigma^{2}}{2}$ 并整理得到：\n$$\n(G^{T}G)\\mathbf{m} - G^{T}\\mathbf{d} + \\sigma^{2}\\lambda^{2}\\mathbf{m} = \\mathbf{0}\n$$\n$$\n(G^{T}G + \\sigma^{2}\\lambda^{2}I)\\mathbf{m} = G^{T}\\mathbf{d}\n$$\n因此，估计模型 $\\hat{\\mathbf{m}}$ 为：\n$$\n\\hat{\\mathbf{m}} = (G^{T}G + \\sigma^{2}\\lambda^{2}I)^{-1} G^{T}\\mathbf{d}\n$$\n模型分辨率矩阵 $R_{m}$ 将估计量 $\\hat{\\mathbf{m}}$ 的期望值与真实模型 $\\mathbf{m}_{\\text{true}}$ 联系起来。我们将正演模型 $\\mathbf{d} = G \\mathbf{m}_{\\text{true}} + \\mathbf{e}$ 代入 $\\hat{\\mathbf{m}}$ 的表达式中：\n$$\n\\hat{\\mathbf{m}} = (G^{T}G + \\sigma^{2}\\lambda^{2}I)^{-1} G^{T} (G \\mathbf{m}_{\\text{true}} + \\mathbf{e})\n$$\n$$\n\\hat{\\mathbf{m}} = (G^{T}G + \\sigma^{2}\\lambda^{2}I)^{-1} G^{T}G \\mathbf{m}_{\\text{true}} + (G^{T}G + \\sigma^{2}\\lambda^{2}I)^{-1} G^{T} \\mathbf{e}\n$$\n取期望，并利用噪声是零均值 ($\\mathbb{E}[\\mathbf{e}] = \\mathbf{0}$) 的事实：\n$$\n\\mathbb{E}[\\hat{\\mathbf{m}}] = (G^{T}G + \\sigma^{2}\\lambda^{2}I)^{-1} G^{T}G \\mathbf{m}_{\\text{true}}\n$$\n根据定义，$\\mathbb{E}[\\hat{\\mathbf{m}}] = R_{m} \\mathbf{m}_{\\text{true}}$，所以模型分辨率矩阵是：\n$$\nR_{m} = (G^{T}G + \\sigma^{2}\\lambda^{2}I)^{-1} G^{T}G\n$$\n为了求 $R_{m}$ 的特征值，我们首先求矩阵 $A = G^{T}G$ 的特征值。设 $\\eta$ 是 $A$ 的一个特征值，其对应的特征向量为 $\\mathbf{v}$，使得 $A\\mathbf{v} = \\eta\\mathbf{v}$。然后我们可以分析 $R_{m}$ 对 $\\mathbf{v}$ 的作用：\n$$\nR_{m}\\mathbf{v} = (A + \\sigma^{2}\\lambda^{2}I)^{-1} A \\mathbf{v} = (A + \\sigma^{2}\\lambda^{2}I)^{-1} (\\eta \\mathbf{v}) = \\eta (A + \\sigma^{2}\\lambda^{2}I)^{-1} \\mathbf{v}\n$$\n因为 $(A + \\sigma^{2}\\lambda^{2}I)\\mathbf{v} = A\\mathbf{v} + \\sigma^{2}\\lambda^{2}\\mathbf{v} = (\\eta + \\sigma^{2}\\lambda^{2})\\mathbf{v}$，我们有 $(A + \\sigma^{2}\\lambda^{2}I)^{-1}\\mathbf{v} = \\frac{1}{\\eta + \\sigma^{2}\\lambda^{2}}\\mathbf{v}$。将其代回，我们发现：\n$$\nR_{m}\\mathbf{v} = \\eta \\left(\\frac{1}{\\eta + \\sigma^{2}\\lambda^{2}}\\right) \\mathbf{v} = \\frac{\\eta}{\\eta + \\sigma^{2}\\lambda^{2}} \\mathbf{v}\n$$\n因此，$R_{m}$ 的特征值（记为 $\\rho$）与 $G^{T}G$ 的特征值（记为 $\\eta$）通过表达式 $\\rho = \\frac{\\eta}{\\eta + \\sigma^{2}\\lambda^{2}}$ 相关联。函数 $f(\\eta) = \\frac{\\eta}{\\eta + \\mu}$ (其中 $\\mu = \\sigma^{2}\\lambda^{2}  0$) 对于 $\\eta  0$ 是单调递增的。因此，$R_{m}$ 的最小特征值对应于 $G^{T}G$ 的最小特征值。\n\n我们现在计算给定正演算子 $G = \\begin{bmatrix} 1  1 \\\\ 0  \\alpha \\end{bmatrix}$ 的 $G^{T}G$：\n$$\nG^{T}G = \\begin{bmatrix} 1  0 \\\\ 1  \\alpha \\end{bmatrix} \\begin{bmatrix} 1  1 \\\\ 0  \\alpha \\end{bmatrix} = \\begin{bmatrix} 1  1 \\\\ 1  1+\\alpha^{2} \\end{bmatrix}\n$$\n$G^{T}G$ 的特征值 $\\eta$ 是特征方程 $\\det(G^{T}G - \\eta I) = 0$ 的根：\n$$\n\\det \\begin{bmatrix} 1-\\eta  1 \\\\ 1  1+\\alpha^{2}-\\eta \\end{bmatrix} = 0\n$$\n$$\n(1-\\eta)(1+\\alpha^{2}-\\eta) - 1 = 0\n$$\n$$\n\\eta^{2} - (1+\\alpha^{2}+1)\\eta + (1+\\alpha^{2}) - 1 = 0\n$$\n$$\n\\eta^{2} - (2+\\alpha^{2})\\eta + \\alpha^{2} = 0\n$$\n使用二次求根公式求解 $\\eta$：\n$$\n\\eta = \\frac{(2+\\alpha^{2}) \\pm \\sqrt{(2+\\alpha^{2})^{2} - 4\\alpha^{2}}}{2} = \\frac{2+\\alpha^{2} \\pm \\sqrt{4+4\\alpha^{2}+\\alpha^{4} - 4\\alpha^{2}}}{2} = \\frac{2+\\alpha^{2} \\pm \\sqrt{4+\\alpha^{4}}}{2}\n$$\n$G^{T}G$ 的两个特征值是 $\\eta_{1} = \\frac{2+\\alpha^{2} + \\sqrt{4+\\alpha^{4}}}{2}$ 和 $\\eta_{2} = \\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2}$。最小的特征值是 $\\eta_{\\min}$：\n$$\n\\eta_{\\min} = \\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2}\n$$\n模型分辨率矩阵对应的最小特征值 $\\rho_{\\min}$ 是：\n$$\n\\rho_{\\min} = \\frac{\\eta_{\\min}}{\\eta_{\\min} + \\sigma^{2}\\lambda^{2}} = \\frac{\\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2}}{\\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2} + \\sigma^{2}\\lambda^{2}}\n$$\n将分子和分母同乘以 $2$ 得到最终表达式：\n$$\n\\rho_{\\min} = \\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}} + 2\\sigma^{2}\\lambda^{2}}\n$$\n当 $\\alpha \\to 0$ 时，正演算子 $G$ 趋近于 $G_0 = \\begin{bmatrix} 1  1 \\\\ 0  0 \\end{bmatrix}$，这是一个奇异矩阵。$G_0$ 的零空间由满足 $v_{1} + v_{2} = 0$ 的向量 $\\mathbf{v}$ 组成，由向量 $[1, -1]^{T}$ 张成。该向量代表了模型中不产生任何数据的分量，因此是完全不受约束的。$\\alpha \\to 0$ 的极限意味着零空间的出现，使得问题变得病态。\n在此极限下，$G^{T}G$ 的最小特征值变为：\n$$\n\\lim_{\\alpha \\to 0} \\eta_{\\min} = \\lim_{\\alpha \\to 0} \\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2} = \\frac{2 - \\sqrt{4}}{2} = 0\n$$\n$G^T G$ 的一个特征值趋近于零是零空间出现的标志。$G^T G$ 对应的特征向量趋近于零空间向量 $[1, -1]^T$。因此，分辨率矩阵 $R_{m}$ 的最小特征值也趋近于零（给定 $\\lambda  0$）：\n$$\n\\lim_{\\alpha \\to 0} \\rho_{\\min} = \\frac{0}{0 + 2\\sigma^{2}\\lambda^{2}} = 0\n$$\n分辨率矩阵的特征值等于 $0$ 表明对应的模型分量（特征向量）完全没有分辨率。对于小的 $\\alpha  0$，$\\rho_{\\min}$ 将接近于零，这表明与近零空间相关的模型分量被数据分辨得非常差。由 $\\lambda$ 控制的正则化通过抑制这个不受约束的分量来稳定反演，但代价是牺牲了分辨率，这一点可以通过 $\\rho_{\\min}$ 的小值来量化。", "answer": "$$\\boxed{\\frac{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}}}{2+\\alpha^{2} - \\sqrt{4+\\alpha^{4}} + 2\\sigma^{2}\\lambda^{2}}}$$", "id": "3613752"}, {"introduction": "不同的正则化策略，如截断奇异值分解（TSVD）和吉洪诺夫（Tikhonov）正则化，会主动地塑造模型分辨率矩阵 $R_m$。本练习引入“分辨率滤波器因子”$f_i$ 的概念，用于比较这些方法如何权衡模型偏差（平滑效应）与估计方差（噪声放大）[@problem_id:3613654]。通过分析这些滤波器，我们可以理解为什么平滑的滤波器（如吉洪诺夫）通常比尖锐的截断（如TSVD）更能抑制伪影，尽管会引入一些偏差。", "problem": "在一维地震反射率恢复中，考虑线性反演问题 $d = G m + e$，其中 $d$ 是记录的地震道，$G$ 是一个代表带限源子波的线性卷积正演算子，$m$ 是反射率序列，$e$ 是附加噪声。设 $G$ 的奇异值分解为 $G = U \\Sigma V^{\\top}$，其中奇异值 $\\{\\sigma_i\\}$ 按降序排列。模型分辨率矩阵定义为 $R_m = G^{\\dagger} G$，数据分辨率矩阵定义为 $R_d = G G^{\\dagger}$，其中 $G^{\\dagger}$ 表示由正则化策略决定的广义逆。在奇异向量基中，这些分辨率矩阵是对角矩阵，其对角元等于作用于相应奇异向量子空间的分辨率滤波器因子 $f_i$。\n\n假设在固定的采集中，对于一个特定的离散化 $G$，实验确定的奇异值为：$\\{\\sigma_i\\} = \\{10,\\, 3,\\, 1,\\, 0.3\\}$。考虑两种正则化策略：\n- 截断奇异值分解（TSVD），它保留前 $k$ 个模式并丢弃其余部分，即 $f_i \\in \\{0,1\\}$，在 $k$ 处有硬截断。\n- 零阶吉洪诺夫（Tikhonov）正则化，其权衡参数 $\\lambda  0$，这会在 $f_i$ 中引起软滚降。\n\n假设我们选择 $k = 2$ 的TSVD和 $\\lambda = 1$ 的吉洪诺夫正则化。根据 $R_m$ 和 $R_d$ 的定义及其在奇异向量基中的解释，并假设附加白噪声的协方差为 $\\mathrm{Cov}(e) = \\sigma_e^2 I$：\n- 对于给定的 $\\{\\sigma_i\\}$ 和参数，比较两种策略下分辨率滤波器因子 $f_i$ 的行为。\n- 推断其对偏差（通过 $R_m$）、$V$ 基中估计模型系数的方差以及空间点扩散函数中吉布斯型振荡伪影倾向的影响。\n\n选择所有正确的陈述。\n\nA. 在 $k=2$ 的TSVD下，模型分辨率矩阵为 $R_m^{(\\mathrm{TSVD})} = V \\,\\mathrm{diag}(1,\\,1,\\,0,\\,0)\\, V^{\\top}$。在 $\\lambda=1$ 的吉洪诺夫正则化下，滤波器因子约为 $f_i^{(\\mathrm{Tik})} \\approx (0.990,\\, 0.900,\\, 0.500,\\, 0.083)$。TSVD在前两个奇异向量模式上是无偏的，但在对局部反射体成像时，其模型点扩散函数通常比吉洪诺夫正则化表现出更强的振荡旁瓣。\n\nB. 对于吉洪诺夫正则化，模型偏差在任何 $\\sigma_i  \\lambda$ 的模式上消失，并且仅在 $\\sigma_i  \\lambda$ 的模式上非零。\n\nC. 如果 $\\mathrm{Cov}(e) = \\sigma_e^2 I$（白噪声），那么在奇异基中，对于任何对角滤波器正则化，沿 $v_i$ 的恢复模型系数的方差等于 $(f_i/\\sigma_i)^2 \\sigma_e^2$。因此，TSVD在丢弃的模式上产生零方差，在保留的模式上产生 $(1/\\sigma_i^2)\\sigma_e^2$ 的方差，而吉洪诺夫正则化在小 $\\sigma_i$ 模式上产生非零但减小的方差。\n\nD. 对于TSVD和吉洪诺夫正则化，数据分辨率矩阵 $R_d$ 的特征向量为 $U$，特征值与模型分辨率矩阵的特征值相同，均为 $f_i$，因此 $R_d = U\\,\\mathrm{diag}(f_i)\\,U^{\\top}$。\n\nE. 因为TSVD完全消除了高频模式，所以相对于吉洪诺夫正则化的软阻尼（其保留了高频模式的残余贡献），它必然会减少空间振铃。", "solution": "在进行求解之前，对问题陈述进行严格验证。\n\n### 步骤 1：提取已知条件\n- **模型**：线性反演问题 $d = G m + e$。\n- **变量**：$d$ (数据)，$m$ (模型)，$e$ (噪声)。\n- **算子**：$G$ 是一个线性卷积正演算子。\n- **G 的奇异值分解**：$G = U \\Sigma V^{\\top}$。\n- **奇异值**：$\\{\\sigma_i\\} = \\{10,\\, 3,\\, 1,\\, 0.3\\}$。\n- **分辨率矩阵**：模型分辨率 $R_m = G^{\\dagger} G$，数据分辨率 $R_d = G G^{\\dagger}$。\n- **广义逆**：$G^{\\dagger}$ 由正则化策略确定。\n- **滤波器因子**：在 SVD 基中，分辨率矩阵是对角的，其对角元为 $f_i$。\n- **正则化策略 1 (TSVD)**：截断奇异值分解，截断参数 $k = 2$。滤波器因子是二值的：$f_i \\in \\{0,1\\}$。\n- **正则化策略 2 (Tikhonov)**：零阶吉洪诺夫正则化，权衡参数 $\\lambda = 1$。\n- **噪声模型**：附加白噪声，协方差为 $\\mathrm{Cov}(e) = \\sigma_e^2 I$，其中 $I$ 是单位矩阵。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础**：该问题在反演理论和计算地球物理学领域是公认的。模型 $d=Gm+e$、SVD、TSVD、吉洪诺夫正则化以及模型和数据分辨率矩阵的定义都是标准且正确的。\n- **适定的**：该问题提供了计算两种正则化方案的滤波器因子并分析其性质所需的所有必要参数 ($\\{\\sigma_i\\}$, $k$, $\\lambda$)。问题提出的很具体，可以根据所提供的信息进行回答。\n- **客观性**：问题以精确的数学和物理术语陈述，没有任何主观性或模糊性。\n\n该问题不存在科学不健全、不完整、矛盾或模糊等任何缺陷。它是线性反演理论中一个标准的、适定的问题。\n\n### 步骤 3：结论与行动\n- **结论**：问题是 **有效的 (VALID)**。\n- **行动**：继续进行推导和分析。\n\n### 推导与分析\n\n首先，我们建立SVD基中分辨率矩阵和模型协方差的一般形式。对于任何在SVD基中充当滤波器的正则化方案，其广义逆 $G^{\\dagger}$ 可以写为：\n$$\nG^{\\dagger} = V \\Sigma^{\\dagger} U^{\\top}\n$$\n其中 $\\Sigma^{\\dagger}$ 是一个对角矩阵，其元素为 $\\Sigma^{\\dagger}_{ii} = f_i / \\sigma_i$ (当 $\\sigma_i  0$ 时) 或 $0$ (其他情况)。$f_i$ 是分辨率滤波器因子。\n\n模型分辨率矩阵 $R_m$ 为：\n$$\nR_m = G^{\\dagger} G = (V \\Sigma^{\\dagger} U^{\\top}) (U \\Sigma V^{\\top}) = V \\Sigma^{\\dagger} \\Sigma V^{\\top} = V \\, \\mathrm{diag}(f_i) \\, V^{\\top}\n$$\n$R_m$ 的特征值是滤波器因子 $f_i$，特征向量是模型空间奇异向量 $v_i$。\n\n数据分辨率矩阵 $R_d$ 为：\n$$\nR_d = G G^{\\dagger} = (U \\Sigma V^{\\top}) (V \\Sigma^{\\dagger} U^{\\top}) = U \\Sigma \\Sigma^{\\dagger} U^{\\top} = U \\, \\mathrm{diag}(f_i) \\, U^{\\top}\n$$\n$R_d$ 的特征值也是滤波器因子 $f_i$，特征向量是数据空间奇异向量 $u_i$。\n\n估计的模型为 $\\hat{m} = G^{\\dagger} d = G^{\\dagger}(Gm+e) = R_m m + G^{\\dagger}e$。\n估计的偏差为 $E[\\hat{m}] - m = (R_m - I)m$。当且仅当 $f_i = 1$ 时，模型估计在模式 $v_i$ 上是无偏的。\n估计模型的协方差为 $\\mathrm{Cov}(\\hat{m}) = G^{\\dagger} \\mathrm{Cov}(e) (G^{\\dagger})^{\\top}$。给定 $\\mathrm{Cov}(e) = \\sigma_e^2 I$：\n$$\n\\mathrm{Cov}(\\hat{m}) = \\sigma_e^2 G^{\\dagger} (G^{\\dagger})^{\\top} = \\sigma_e^2 (V \\Sigma^{\\dagger} U^{\\top})(U (\\Sigma^{\\dagger})^{\\top} V^{\\top}) = \\sigma_e^2 V (\\Sigma^{\\dagger})^2 V^{\\top}\n$$\n协方差矩阵在 $V$ 基中是对角的。与奇异向量 $v_i$ 对应的估计模型系数的方差是第 $i$ 个对角元素：\n$$\n\\mathrm{Var}(\\hat{m}_i') = \\sigma_e^2 (\\Sigma^{\\dagger}_{ii})^2 = \\sigma_e^2 \\left(\\frac{f_i}{\\sigma_i}\\right)^2\n$$\n\n现在我们将这些一般结果应用于两种具体的正则化策略。\n\n**1. $k=2$ 的截断奇异值分解 (TSVD)**\n滤波器因子对于 $i \\le k$ 为 $f_i=1$，对于 $i  k$ 为 $f_i=0$。当 $k=2$ 时：\n$$\n\\{f_i^{(\\mathrm{TSVD})}\\} = \\{1,\\, 1,\\, 0,\\, 0\\}\n$$\n\n**2. $\\lambda=1$ 的吉洪诺夫正则化 (Tikhonov)**\n滤波器因子由公式 $f_i = \\frac{\\sigma_i^2}{\\sigma_i^2 + \\lambda^2}$ 给出。当 $\\lambda=1$ 且 $\\{\\sigma_i\\} = \\{10,\\, 3,\\, 1,\\, 0.3\\}$ 时：\n- $f_1 = \\frac{10^2}{10^2 + 1^2} = \\frac{100}{101} \\approx 0.9901$\n- $f_2 = \\frac{3^2}{3^2 + 1^2} = \\frac{9}{10} = 0.9$\n- $f_3 = \\frac{1^2}{1^2 + 1^2} = \\frac{1}{2} = 0.5$\n- $f_4 = \\frac{0.3^2}{0.3^2 + 1^2} = \\frac{0.09}{1.09} \\approx 0.0826$\n所以，$\\{f_i^{(\\mathrm{Tik})}\\} \\approx \\{0.990,\\, 0.900,\\, 0.500,\\, 0.083\\}$。\n\n### 逐项评估\n\n**A. 在 $k=2$ 的TSVD下，模型分辨率矩阵为 $R_m^{(\\mathrm{TSVD})} = V \\,\\mathrm{diag}(1,\\,1,\\,0,\\,0)\\, V^{\\top}$。在 $\\lambda=1$ 的吉洪诺夫正则化下，滤波器因子约为 $f_i^{(\\mathrm{Tik})} \\approx (0.990,\\, 0.900,\\, 0.500,\\, 0.083)$。TSVD在前两个奇异向量模式上是无偏的，但在对局部反射体成像时，其模型点扩散函数通常比吉洪诺夫正则化表现出更强的振荡旁瓣。**\n- $R_m^{(\\mathrm{TSVD})}$ 的表达式直接由 $R_m = V \\, \\mathrm{diag}(f_i) \\, V^{\\top}$ 和我们计算的 $f_i^{(\\mathrm{TSVD})} = \\{1,\\,1,\\,0,\\,0\\}$ 得出。这是正确的。\n- $f_i^{(\\mathrm{Tik})}$ 的计算值与选项中给出的值相符。这是正确的。\n- 如果 $f_i=1$，则模式 $v_i$ 上的偏差为零。对于 $k=2$ 的TSVD，$f_1=1$ 和 $f_2=1$，所以解在前两个奇异向量模式上是无偏的。这是正确的。\n- 点扩散函数（PSF）是δ函数的反演成像。其空间特性由滤波器因子决定。TSVD滤波器在谱域（SVD基）中的锐利、阶梯状截断（$\\{1,1,0,0\\}$）等效于在模型域中与一个类sinc函数进行卷积，这会产生被称为吉布斯振铃的强烈振荡伪影。吉洪诺夫滤波器提供了系数的平滑衰减，这减少了这些振铃伪影，但代价是在所有模式上引入一些偏差。因此，TSVD通常比吉洪诺夫正则化表现出更强的旁瓣。这是正确的。\n- **结论：正确。**\n\n**B. 对于吉洪诺夫正则化，模型偏差在任何 $\\sigma_i  \\lambda$ 的模式上消失，并且仅在 $\\sigma_i  \\lambda$ 的模式上非零。**\n- 如果 $f_i=1$，则模式 $v_i$ 上的模型估计是无偏的。对于吉洪诺夫正则化，$f_i = \\frac{\\sigma_i^2}{\\sigma_i^2 + \\lambda^2}$。\n- 要使其等于 $1$，我们需要 $\\lambda^2 = 0$。然而，问题指定 $\\lambda  0$。对于任何 $\\lambda  0$ 和有限的 $\\sigma_i  0$，我们有 $\\sigma_i^2 + \\lambda^2  \\sigma_i^2$，这意味着 $f_i  1$。\n- 因此，对于吉洪诺夫正则化，*所有*模式上都存在非零偏差。当 $\\sigma_i / \\lambda \\to \\infty$ 时，偏差变得非常小，但对于有限的 $\\sigma_i$，它永远不会消失。该陈述根本上是错误的。\n- **结论：不正确。**\n\n**C. 如果 $\\mathrm{Cov}(e) = \\sigma_e^2 I$（白噪声），那么在奇异基中，对于任何对角滤波器正则化，沿 $v_i$ 的恢复模型系数的方差等于 $(f_i/\\sigma_i)^2 \\sigma_e^2$。因此，TSVD在丢弃的模式上产生零方差，在保留的模式上产生 $(1/\\sigma_i^2)\\sigma_e^2$ 的方差，而吉洪诺夫正则化在小 $\\sigma_i$ 模式上产生非零但减小的方差。**\n- 如上所推导，模式 $v_i$ 的模型系数的方差确实是 $\\mathrm{Var}(\\hat{m}_i') = \\sigma_e^2 (f_i/\\sigma_i)^2$。第一部分是正确的。\n- 对于TSVD：在丢弃的模式 $ik=2$ 上，$f_i=0$，所以方差为 $0$。在保留的模式 $i \\le 2$ 上，$f_i=1$，所以方差为 $\\sigma_e^2 (1/\\sigma_i)^2 = \\sigma_e^2/\\sigma_i^2$。这部分是正确的。\n- 对于吉洪诺夫正则化：$f_i = \\frac{\\sigma_i^2}{\\sigma_i^2 + \\lambda^2}$。方差为 $\\sigma_e^2 \\left(\\frac{1}{\\sigma_i} \\frac{\\sigma_i^2}{\\sigma_i^2 + \\lambda^2}\\right)^2 = \\sigma_e^2 \\left(\\frac{\\sigma_i}{\\sigma_i^2 + \\lambda^2}\\right)^2$。对于 $\\sigma_i  0$，这是非零的。对于小的 $\\sigma_i$（在未正则化的反演中，噪声放大最严重的地方），该项约为 $\\approx \\sigma_e^2 (\\sigma_i/\\lambda^2)^2$，这个值很小。与未正则化的解（$f_i=1$）相比，滤波器因子 $f_i$ 减少了所有模式的方差贡献，并且这种减少对于小的 $\\sigma_i$ 最为显著。这部分是正确的。\n- **结论：正确。**\n\n**D. 对于TSVD和吉洪诺夫正则化，数据分辨率矩阵 $R_d$ 的特征向量为 $U$，特征值与模型分辨率矩阵的特征值相同，均为 $f_i$，因此 $R_d = U\\,\\mathrm{diag}(f_i)\\,U^{\\top}$。**\n- 根据第一性原理推导，$R_d = G G^{\\dagger} = U \\Sigma \\Sigma^{\\dagger} U^{\\top} = U \\, \\mathrm{diag}(f_i) \\, U^{\\top}$。\n- 该表达式表明 $R_d$ 的特征向量是 $U$ 的列（数据空间奇异向量），相应的特征值是滤波器因子 $f_i$。\n- 这些确实是与模型分辨率矩阵 $R_m = V \\, \\mathrm{diag}(f_i) \\, V^{\\top}$ 的特征值相同的滤波器因子 $f_i$。该陈述是反演理论中一个正确且标准的结果。\n- **结论：正确。**\n\n**E. 因为TSVD完全消除了高频模式，所以相对于吉洪诺夫正则化的软阻尼（其保留了高频模式的残余贡献），它必然会减少空间振铃。**\n- 该陈述提出了与正确物理推理相反的观点。在信号处理和成像中，频谱分量的急剧截断是吉布斯振铃现象的主要原因。TSVD急剧地切断了“高频模式”（那些对应于小奇异值的模式）。这种在谱域的突然终止导致了在空间域中显著的振荡（振铃）。\n- 吉洪诺夫方法应用了平滑滚降（阻尼），这是一种谱窗或锥化的形式。这种平滑窗专门用于*减少*与锐利（矩形窗）截断相比的振铃伪影。来自高频模式的“残余贡献”正是平滑过渡并抑制振铃的原因。\n- 因此，TSVD引起的振铃比吉洪诺夫正则化*更多*，而不是更少。\n- **结论：不正确。**", "answer": "$$\\boxed{ACD}$$", "id": "3613654"}, {"introduction": "理论最终要通过计算实践来检验。在实际应用中，我们通常不计算完整的模型分辨率矩阵 $R_m$，而是计算它的特定列，即点扩散函数（Point-Spread Functions, PSF）。点扩散函数直观地展示了真实模型中的一个点在反演结果中是如何被“成像”的[@problem_id:3613732]。这个计算练习将指导你从头开始构建一个二维层析成像问题，并通过分析点扩散函数的形状来量化分辨率的各向异性，从而将抽象的矩阵理论与具体的地球物理成像联系起来。", "problem": "给定一个单位正方形域上的二维线性反演问题，该域上有一个均匀的矩形单元网格，这是计算地球物理学中典型的直线射线走时层析成像问题。正演模型是一个线性算子，它将一个单元模型映射为该模型沿直线射线的路径积分。您将通过点扩散函数分析阻尼平滑最小二乘估计的分辨率特性，并以模型为中心的方式量化扩散的各向异性。\n\n从以下基本设定开始：线性方程组由 $\\,\\mathbf{d} = \\mathbf{G}\\,\\mathbf{m} + \\boldsymbol{\\epsilon}\\,$ 给出，其中 $\\,\\mathbf{G}\\,$ 是由沿直线射线路径的单元贡献的线积分构成的灵敏度矩阵，$\\,\\mathbf{m}\\,$ 是在网格上均匀采样的未知模型，$\\,\\mathbf{d}\\,$ 是数据向量（每条射线一个数据点），而 $\\,\\boldsymbol{\\epsilon}\\,$ 是加性噪声。估计值是通过最小化一个带有二次平滑惩罚项的加权最小二乘目标函数获得的。平滑算子 $\\,\\mathbf{L}\\,$ 是根据沿两个网格轴的相邻单元之间的一阶差分构建的，并且可以通过为水平和垂直差分选择不同的权重来使其具有各向异性。\n\n通过在选定的单元注入一个 delta 模型并执行反演来获得估计模型，从而构建点扩散函数。这个估计模型就是点扩散函数，它等于模型分辨率矩阵的相应列。然后，通过计算关于中心单元的二阶矩张量，并形成一个衡量扩散伸長程度的特征值平方根之比，来量化每个扩散函数的各向异性。\n\n需严格遵循的实现细节：\n- 域和网格：\n  - 域是单位正方形 $[\\,0,1\\,]\\times[\\,0,1\\,]$。\n  - 使用一个包含 $\\,n\\times n\\,$ 个单元的均匀网格。记 $\\,N = n^2\\,$。\n  - 使用从零开始的索引，网格索引为 $\\,(\\,i,j\\,)\\,$ 的单元中心坐标是 $\\,\\big(\\,(j+\\tfrac{1}{2})/n,\\,(i+\\tfrac{1}{2})/n\\,\\big)\\,$。\n  - 使用 $\\,n = 16\\,$。\n  - 分析单元（delta 模型注入的单元）是索引为 $\\,(\\,i_0,j_0\\,)=(\\,\\lfloor n/2 \\rfloor,\\lfloor n/2 \\rfloor\\,)\\,$ 的网格单元。对于 $\\,n=16\\,$，这确定为 $\\,(\\,8,8\\,)\\,$。\n- 射线和正演算子 $\\,\\mathbf{G}\\,$：\n  - 每条射线定义为连接单位正方形边界上两点的直线段。\n  - 正演算子 $\\,\\mathbf{G}\\,$ 每行对应一条射线，每列对应一个单元。条目 $\\,G_{r,c}\\,$ 等于射线 $\\,r\\,$ 穿过单元 $\\,c\\,$ 的近似路径长度。\n  - 通过沿每条射线段均匀采样来近似线积分：设端点为 $\\,\\mathbf{p}_0=(x_0,y_0)\\,$ 和 $\\,\\mathbf{p}_1=(x_1,y_1)\\,$。沿线段使用 $\\,S=200\\,$ 个等间距的内部采样点，线段长度为 $\\,\\ell=\\lVert \\mathbf{p}_1-\\mathbf{p}_0\\rVert_2\\,$，步长为 $\\,\\Delta s = \\ell/S\\,$。对于第 $\\,s\\,$ 个样本，$\\,\\mathbf{p}=\\mathbf{p}_0 + \\big(s+\\tfrac{1}{2}\\big)\\,(\\mathbf{p}_1-\\mathbf{p}_0)/S\\,$，其中 $\\,s\\in\\{0,1,\\dots,S-1\\}\\,$。将 $\\,\\Delta s\\,$ 分配给包含 $\\,\\mathbf{p}\\,$ 的单元（通过对 $\\,x\\cdot n\\,$ 和 $\\,y\\cdot n\\,$ 进行整数截断，并丢弃越界样本）。\n- 平滑算子 $\\,\\mathbf{L}\\,$：\n  - 将 $\\,\\mathbf{L}\\,$ 构建为相邻单元之间一阶差分的堆叠。对于在公共行 $\\,i\\,$ 和相邻列 $\\,j-1\\,$、$\\,j\\,$ 的每一对水平相邻单元，包含一个等于 $\\,w_x\\,(m_{i,j}-m_{i,j-1})\\,$ 的行。对于在公共列 $\\,j\\,$ 和相邻行 $\\,i-1\\,$、$\\,i\\,$ 的每一对垂直相邻单元，包含一个等于 $\\,w_y\\,(m_{i,j}-m_{i-1,j})\\,$ 的行。这里 $\\,w_x\\,$ 和 $\\,w_y\\,$ 是控制平滑各向异性的非负权重。平滑惩罚项为 $\\,\\lVert \\mathbf{L}\\,\\mathbf{m}\\rVert_2^2\\,$。\n- 估计：\n  - 使用标准的阻尼平滑最小二乘估计，该估计最小化残差平方和 $+\\,$ 平滑惩罚项的非负倍数 $\\,\\lambda^2\\,$。将数据权重视为单位矩阵。求解相关的正规方程，以获得每个注入的 delta 模型的估计模型。\n- 点扩散函数和各向异性：\n  - 对于给定的索引 $\\,c_0\\,$（对应于单元 $\\,(\\,i_0,j_0\\,)\\,$），形成 delta 模型 $\\,\\mathbf{e}_{c_0}\\,$。\n  - 生成合成数据 $\\,\\mathbf{d}=\\mathbf{G}\\,\\mathbf{e}_{c_0}\\,$，并使用相同的平滑和阻尼求解估计模型 $\\,\\widehat{\\mathbf{m}}\\,$。向量 $\\,\\widehat{\\mathbf{m}}\\,$ 就是点扩散函数。\n  - 为量化各向异性，使用非负权重 $\\,w_k = \\widehat{m}_k^{\\,2}\\,$ 计算关于中心单元坐标 $\\,(\\,x_c,y_c\\,)\\,$ 的加权二阶矩张量，其中 $\\,\\widehat{m}_k\\,$ 是单元 $\\,k\\,$ 的值，$\\,(\\,x_k,y_k\\,)\\,$ 是其中心。令 $\\,\\Delta x_k = x_k - x_c\\,$ 和 $\\,\\Delta y_k = y_k - y_c\\,$。定义 $\\,2\\times 2\\,$ 对称张量\n    $$\\mathbf{M} = \\frac{1}{\\sum_k w_k}\\sum_k w_k \\begin{bmatrix} \\Delta x_k^2  \\Delta x_k \\Delta y_k \\\\ \\Delta x_k \\Delta y_k  \\Delta y_k^2 \\end{bmatrix}.$$\n    令 $\\,\\mu_{\\max}\\,$ 和 $\\,\\mu_{\\min}\\,$ 为 $\\,\\mathbf{M}\\,$ 的特征值，且 $\\,\\mu_{\\max}\\ge \\mu_{\\min}\\ge 0\\,$。定义各向异性比如下\n    $$\\rho = \\sqrt{\\frac{\\mu_{\\max}}{\\mu_{\\min} + \\epsilon}},$$\n    其中 $\\,\\epsilon\\,$ 是一个小的正常则化常数，您应取 $\\,\\epsilon = 10^{-12}\\,$ 以避免除以零。各向异性比 $\\,\\rho\\,$ 是无量纲的。\n- 单位：\n  - 此问题中的所有量都是无量纲的。在任何内部实现中使用的角度，可以方便地按弧度或度处理，但您的实现必须遵守下面的射线定义，这些定义是按边界点对指定的，不需要显式角度输入。\n\n测试套件。对于以下所有情况，使用 $\\,n=16\\,$，每条射线 $\\,S=200\\,$ 个样本，分析单元位于 $\\,(\\,i_0,j_0\\,)=(\\,8,8\\,)\\,$，并按上述定义计算各向异性比 $\\,\\rho\\,$。射线由边界到边界的线段族定义；每个族生成 $\\,8\\,$ 条射线。\n\n定义以下射线族：\n- $\\,\\mathrm{LR\\_hor}\\,$ 族：从左到右的水平射线。对于 $\\,k\\in\\{1,3,5,7,9,11,13,15\\}\\,$，定义 $\\,y_0 = k/16\\,$ 以及从 $\\,(\\,0,\\,y_0\\,)\\,$ 到 $\\,(\\,1,\\,y_0\\,)\\,$ 的线段。\n- $\\,\\mathrm{LR\\_pos}\\,$ 族：从左到右的正斜率射线。使用相同的 $\\,y_0\\,$ 集合，定义从 $\\,(\\,0,\\,y_0\\,)\\,$ 到 $\\,(\\,1,\\,\\min(1,\\,y_0+0.4)\\,)\\,$ 的线段。\n- $\\,\\mathrm{LR\\_neg}\\,$ 族：从左到右的负斜率射线。使用相同的 $\\,y_0\\,$ 集合，定义从 $\\,(\\,0,\\,y_0\\,)\\,$ 到 $\\,(\\,1,\\,\\max(0,\\,y_0-0.4)\\,)\\,$ 的线段。\n- $\\,\\mathrm{BT\\_ver}\\,$ 族：从下到上的垂直射线。对于 $\\,k\\in\\{1,3,5,7,9,11,13,15\\}\\,$，定义 $\\,x_0 = k/16\\,$ 以及从 $\\,(\\,x_0,\\,0\\,)\\,$ 到 $\\,(\\,x_0,\\,1\\,)\\,$ 的线段。\n- $\\,\\mathrm{BT\\_pos}\\,$ 族：从下到上的正斜率射线。使用相同的 $\\,x_0\\,$ 集合，定义从 $\\,(\\,x_0,\\,0\\,)\\,$ 到 $\\,(\\,\\min(1,\\,x_0+0.4),\\,1\\,)\\,$ 的线段。\n- $\\,\\mathrm{BT\\_neg}\\,$ 族：从下到上的负斜率射线。使用相同的 $\\,x_0\\,$ 集合，定义从 $\\,(\\,x_0,\\,0\\,)\\,$ 到 $\\,(\\,\\max(0,\\,x_0-0.4),\\,1\\,)\\,$ 的线段。\n\n要实现的四个测试用例是：\n- 用例 $\\,1\\,$（均衡覆盖，各向同性平滑）：使用所有六个族 $\\,\\{\\mathrm{LR\\_hor},\\mathrm{LR\\_pos},\\mathrm{LR\\_neg},\\mathrm{BT\\_ver},\\mathrm{BT\\_pos},\\mathrm{BT\\_neg}\\}\\,$，共计 $\\,48\\,$ 条射线；使用平滑权重 $\\,w_x = 1\\,$ 和 $\\,w_y = 1\\,$；阻尼参数 $\\,\\lambda = 0.1\\,$。\n- 用例 $\\,2\\,$（方向受限覆盖）：仅使用 $\\,\\{\\mathrm{BT\\_ver}\\}\\,$ 族，共计 $\\,8\\,$ 条射线；使用平滑权重 $\\,w_x = 1\\,$ 和 $\\,w_y = 1\\,$；阻尼参数 $\\,\\lambda = 0.1\\,$。\n- 用例 $\\,3\\,$（均衡覆盖，强平滑）：使用与用例 $\\,1\\,$ 相同的射线；使用平滑权重 $\\,w_x = 1\\,$ 和 $\\,w_y = 1\\,$；阻尼参数 $\\,\\lambda = 1.0\\,$。\n- 用例 $\\,4\\,$（均衡覆盖，各向异性平滑）：使用与用例 $\\,1\\,$ 相同的射线；使用平滑权重 $\\,w_x = 5\\,$ 和 $\\,w_y = 1\\,$；阻尼参数 $\\,\\lambda = 0.1\\,$。\n\n您的任务：\n- 通过上述采样方案实现 $\\,\\mathbf{G}\\,$ 的构建。\n- 通过带权重 $\\,w_x\\,$ 和 $\\,w_y\\,$ 的一阶差分实现 $\\,\\mathbf{L}\\,$ 的构建。\n- 对每个用例，在 $\\,(\\,i_0,j_0\\,)\\,$ 处注入 delta 模型，合成数据 $\\,\\mathbf{d}\\,$，求解对应于单位数据权重以及指定的 $\\,\\lambda\\,$ 和 $\\,\\mathbf{L}\\,$ 的正规方程，以获得点扩散函数 $\\,\\widehat{\\mathbf{m}}\\,$，并计算各向异性比 $\\,\\rho\\,$（其中 $\\,\\epsilon=10^{-12}\\,$）。\n- 您的程序请求的输出是对应于用例 $\\,1\\,$ 到 $\\,4\\,$ 的列表 $[\\rho_1,\\rho_2,\\rho_3,\\rho_4]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个各向异性比率四舍五入到三位小数，例如 $[\\rho_1,\\rho_2,\\rho_3,\\rho_4]$。各向异性比是无量纲的，必须打印为小数，不带任何附加文本。", "solution": "用户提供的问题是计算地球物理学中一个定义明确的任务，具体涉及线性反演问题的分辨率分析。该问题具有科学依据，逻辑上一致，并提供了所有必要的参数和定义，以得出一个唯一的、可计算的解。所有步骤都得到了清晰的说明，从网格和射线几何形状到正则化最小二乘估计器的数学公式以及量化各向异性的方法。因此，该问题被判定为**有效**。\n\n解决方案严格遵循概述的方法论，按以下步骤进行。\n\n**1. 模型离散化与几何结构**\n域是一个单位正方形 $[\\,0,1\\,]\\times[\\,0,1\\,]$，被离散化为一个 $\\,n \\times n\\,$ 的均匀单元网格，其中 $\\,n=16\\,$。模型参数（单元）的总数为 $\\,N = n^2 = 256\\,$。一个二维单元索引 $\\,(\\,i,j\\,)\\,$（其中 $\\,i\\,$ 是行（y轴），$\\,j\\,$ 是列（x轴））被映射到一个单一向量索引 $\\,c = i \\cdot n + j\\,$。单元 $\\,(\\,i,j\\,)\\,$ 的中心位于坐标 $\\,\\big(\\,(j+\\tfrac{1}{2})/n, \\, (i+\\tfrac{1}{2})/n\\,\\big)\\,$。分析集中在索引为 $\\,(\\,i_0,j_0\\,) = (\\,\\lfloor n/2 \\rfloor, \\lfloor n/2 \\rfloor\\,) = (\\,8,8\\,)\\,$ 的单元上，其对应的线性索引为 $\\,c_0 = 8 \\cdot 16 + 8 = 136\\,$。\n\n**2. 正演算子 $\\,\\mathbf{G}\\,$**\n正演问题由线性系统 $\\,\\mathbf{d} = \\mathbf{G}\\,\\mathbf{m}\\,$ 描述，其中 $\\,\\mathbf{G}\\,$ 是灵敏度矩阵。条目 $\\,G_{r,c}\\,$ 表示射线 $\\,r\\,$ 穿过单元 $\\,c\\,$ 的路径长度。这通过在每条射线上采样 $\\,S=200\\,$ 个等距点来近似。对于一个从 $\\,\\mathbf{p}_0\\,$ 到 $\\,\\mathbf{p}_1\\,$、长度为 $\\,\\ell\\,$ 的射线段，每个采样点代表一段长度为 $\\,\\Delta s = \\ell/S\\,$ 的路径段。对于每个落在域内的采样点 $\\,\\mathbf{p}=(x,y)\\,$，相应的单元索引由 $\\,j = \\lfloor x \\cdot n \\rfloor\\,$ 和 $\\,i = \\lfloor y \\cdot n \\rfloor\\,$ 确定。然后将值 $\\,\\Delta s\\,$ 加到条目 $\\,G_{r,c}\\,$ 上，其中 $\\,c = i \\cdot n + j\\,$。射线按指定方式组织成族，并为每个测试用例的射线集构建矩阵 $\\,\\mathbf{G}\\,$。\n\n**3. 平滑算子 $\\,\\mathbf{L}\\,$**\n为了正则化解，引入了二次平滑惩罚项 $\\,\\lVert \\mathbf{L}\\,\\mathbf{m}\\rVert_2^2\\,$。算子 $\\,\\mathbf{L}\\,$ 通过惩罚相邻单元值之间的一阶差分来强制平滑。它被构建为一个稀疏矩阵，其中每一行对应一对相邻单元之间的差分。\n- 对于位于 $\\,(\\,i, j-1\\,)\\,$ 和 $\\,(\\,i, j\\,)\\,$ 的水平相邻单元对，在 $\\,\\mathbf{L}\\,$ 中创建一行，其在对应于这些单元的列上的条目分别为 $\\,-w_x\\,$ 和 $\\,+w_x\\,$。此操作针对所有 $\\,i \\in \\{0, \\dots, n-1\\}\\,$ 和 $\\,j \\in \\{1, \\dots, n-1\\}\\,$。\n- 对于位于 $\\,(\\,i-1, j\\,)\\,$ 和 $\\,(\\,i, j\\,)\\,$ 的垂直相邻单元对，在 $\\,\\mathbf{L}\\,$ 中创建一行，其在相应列上的条目分别为 $\\,-w_y\\,$ 和 $\\,+w_y\\,$。此操作针对所有 $\\,i \\in \\{1, \\dots, n-1\\}\\,$ 和 $\\,j \\in \\{0, \\dots, n-1\\}\\,$。\n权重 $\\,w_x\\,$ 和 $\\,w_y\\,$ 控制平滑各向异性的程度。\n\n**4. 正则化最小二乘估计与点扩散函数 (PSF)**\n估计模型 $\\,\\widehat{\\mathbf{m}}\\,$ 通过最小化以下目标函数得到：\n$$ J(\\mathbf{m}) = \\lVert \\mathbf{G}\\,\\mathbf{m} - \\mathbf{d} \\rVert_2^2 + \\lambda^2 \\lVert \\mathbf{L}\\,\\mathbf{m} \\rVert_2^2 $$\n其最小化解是以下正规方程的解：\n$$ (\\mathbf{G}^T\\mathbf{G} + \\lambda^2 \\mathbf{L}^T\\mathbf{L})\\,\\widehat{\\mathbf{m}} = \\mathbf{G}^T\\mathbf{d} $$\n目标单元 $\\,c_0\\,$ 处的点扩散函数 (PSF) 定义为真实模型为 delta 函数 $\\,\\mathbf{m}_{\\text{true}} = \\mathbf{e}_{c_0}\\,$ 时得到的估计模型 $\\,\\widehat{\\mathbf{m}}\\,$，其中 $\\,\\mathbf{e}_{c_0}\\,$ 是在索引 $\\,c_0\\,$ 处为 $\\,1\\,$ 其余处为零的标准基向量。此模型的合成数据为 $\\,\\mathbf{d} = \\mathbf{G}\\,\\mathbf{e}_{c_0} = \\mathbf{g}_{c_0}\\,$, 其中 $\\,\\mathbf{g}_{c_0}\\,$ 是 $\\,\\mathbf{G}\\,$ 的第 $\\,c_0\\,$ 列。因此，点扩散函数（我们记为 $\\,\\widehat{\\mathbf{m}}_{\\text{psf}}\\,$）通过求解以下方程获得：\n$$ (\\mathbf{G}^T\\mathbf{G} + \\lambda^2 \\mathbf{L}^T\\mathbf{L})\\,\\widehat{\\mathbf{m}}_{\\text{psf}} = \\mathbf{G}^T\\mathbf{g}_{c_0} $$\n对每个测试用例，都求解此线性系统以得到 $\\,\\widehat{\\mathbf{m}}_{\\text{psf}}\\,$。\n\n**5. 各向异性量化**\n分析 PSF 的空间扩散以确定其各向异性。计算一个加权二阶矩张量 $\\,\\mathbf{M}\\,$。每个单元 $\\,k\\,$ 的权重由 PSF 值的平方给出，即 $\\,w_k = (\\widehat{m}_{\\text{psf}, k})^2\\,$。张量分量是相对于目标单元中心 $\\,(\\,x_c, y_c\\,)\\,$ 计算的：\n$$ \\mathbf{M} = \\frac{1}{\\sum_k w_k} \\sum_k w_k \\begin{bmatrix} (\\Delta x_k)^2  \\Delta x_k \\Delta y_k \\\\ \\Delta x_k \\Delta y_k  (\\Delta y_k)^2 \\end{bmatrix} $$\n其中 $\\,\\Delta x_k = x_k - x_c\\,$ 且 $\\,\\Delta y_k = y_k - y_c\\,$。这个 $\\,2 \\times 2\\,$ 对称张量的特征值 $\\,\\mu_{\\max}\\,$ 和 $\\,\\mu_{\\min}\\,$ 代表了扩散沿其主轴的方差。各向异性比 $\\,\\rho\\,$ 定义为：\n$$ \\rho = \\sqrt{\\frac{\\mu_{\\max}}{\\mu_{\\min} + \\epsilon}} $$\n其中 $\\,\\epsilon = 10^{-12}\\,$ 用于防止除以零。$\\,\\rho \\approx 1\\,$ 的值表示各向同性（圆形）扩散，而 $\\,\\rho  1\\,$ 表示各向异性（伸长）扩散。\n\n将此完整过程应用于四个指定的测试用例中的每一个，并计算和报告所得的各向异性比。", "answer": "```python\nimport numpy as np\n\ndef build_ray_families(n):\n    \"\"\"\n    Defines the 6 ray families based on the problem description for a grid of size n.\n    \"\"\"\n    k_vals = [1, 3, 5, 7, 9, 11, 13, 15]\n    \n    families = {\n        \"LR_hor\": [], \"LR_pos\": [], \"LR_neg\": [],\n        \"BT_ver\": [], \"BT_pos\": [], \"BT_neg\": []\n    }\n\n    # Left-to-Right families\n    y0_vals = [k / n for k in k_vals]\n    for y0 in y0_vals:\n        # LR_hor\n        families[\"LR_hor\"].append((np.array([0.0, y0]), np.array([1.0, y0])))\n        # LR_pos\n        families[\"LR_pos\"].append((np.array([0.0, y0]), np.array([1.0, min(1.0, y0 + 0.4)])))\n        # LR_neg\n        families[\"LR_neg\"].append((np.array([0.0, y0]), np.array([1.0, max(0.0, y0 - 0.4)])))\n\n    # Bottom-to-Top families\n    x0_vals = [k / n for k in k_vals]\n    for x0 in x0_vals:\n        # BT_ver\n        families[\"BT_ver\"].append((np.array([x0, 0.0]), np.array([x0, 1.0])))\n        # BT_pos\n        families[\"BT_pos\"].append((np.array([x0, 0.0]), np.array([min(1.0, x0 + 0.4), 1.0])))\n        # BT_neg\n        families[\"BT_neg\"].append((np.array([x0, 0.0]), np.array([max(0.0, x0 - 0.4), 1.0])))\n        \n    return families\n\ndef build_G(rays, n, S):\n    \"\"\"\n    Constructs the sensitivity matrix G by sampling rays.\n    \"\"\"\n    num_rays = len(rays)\n    N = n * n\n    G = np.zeros((num_rays, N))\n    \n    for r_idx, (p0, p1) in enumerate(rays):\n        length = np.linalg.norm(p1 - p0)\n        if length == 0:\n            continue\n        ds = length / S\n        direction_vec = (p1 - p0)\n        \n        for s in range(S):\n            # Sample point at the midpoint of the sub-segment\n            p = p0 + (s + 0.5) * direction_vec / S\n            x, y = p\n            \n            # Assign path length ds to the cell containing the sample point\n            if 0 = x  1.0 and 0 = y  1.0:\n                j = int(x * n)\n                i = int(y * n)\n                c_idx = i * n + j\n                G[r_idx, c_idx] += ds\n                \n    return G\n\ndef build_L(n, wx, wy):\n    \"\"\"\n    Constructs the first-order difference smoothing operator L.\n    \"\"\"\n    N = n * n\n    num_horiz_diffs = n * (n - 1)\n    num_vert_diffs = n * (n - 1)\n    L = np.zeros((num_horiz_diffs + num_vert_diffs, N))\n    \n    row_idx = 0\n    # Horizontal differences\n    for i in range(n):\n        for j in range(1, n):\n            c1 = i * n + j\n            c2 = i * n + (j - 1)\n            L[row_idx, c1] = wx\n            L[row_idx, c2] = -wx\n            row_idx += 1\n            \n    # Vertical differences\n    for i in range(1, n):\n        for j in range(n):\n            c1 = i * n + j\n            c2 = (i - 1) * n + j\n            L[row_idx, c1] = wy\n            L[row_idx, c2] = -wy\n            row_idx += 1\n            \n    return L\n    \ndef calculate_anisotropy(m_hat, n, i0, j0, epsilon):\n    \"\"\"\n    Computes the anisotropy ratio rho for a given point-spread function m_hat.\n    \"\"\"\n    N = n * n\n    \n    # Center of the analysis cell (c_0)\n    xc = (j0 + 0.5) / n\n    yc = (i0 + 0.5) / n\n    \n    # All cell center coordinates\n    j_coords = np.tile(np.arange(n), n)\n    i_coords = np.repeat(np.arange(n), n)\n    x_k = (j_coords + 0.5) / n\n    y_k = (i_coords + 0.5) / n\n    \n    # Displacements from the center\n    dx_k = x_k - xc\n    dy_k = y_k - yc\n    \n    # Weights for second-moment tensor are the squared PSF values\n    w_k = m_hat**2\n    w_sum = np.sum(w_k)\n    \n    if w_sum = 1e-15: # Effectively zero, spread is undefined\n        return 1.0 # Default to isotropic\n        \n    # Second-moment tensor M\n    M = np.zeros((2, 2))\n    M[0, 0] = np.sum(w_k * dx_k**2) / w_sum\n    M[1, 1] = np.sum(w_k * dy_k**2) / w_sum\n    M[0, 1] = M[1, 0] = np.sum(w_k * dx_k * dy_k) / w_sum\n    \n    # Eigenvalues of M\n    eigvals = np.linalg.eigvalsh(M)\n    mu_min, mu_max = eigvals[0], eigvals[1]\n    \n    # Anisotropy ratio rho\n    rho = np.sqrt(mu_max / (mu_min + epsilon))\n    \n    return rho\n\ndef solve():\n    \"\"\"\n    Main function to run the four test cases and compute anisotropy ratios.\n    \"\"\"\n    n = 16\n    S = 200\n    i0, j0 = 8, 8\n    c0 = i0 * n + j0\n    epsilon = 1e-12\n    \n    all_ray_families = build_ray_families(n)\n    \n    test_cases = [\n        {\"families\": [\"LR_hor\", \"LR_pos\", \"LR_neg\", \"BT_ver\", \"BT_pos\", \"BT_neg\"], \"wx\": 1.0, \"wy\": 1.0, \"lambda_val\": 0.1},\n        {\"families\": [\"BT_ver\"], \"wx\": 1.0, \"wy\": 1.0, \"lambda_val\": 0.1},\n        {\"families\": [\"LR_hor\", \"LR_pos\", \"LR_neg\", \"BT_ver\", \"BT_pos\", \"BT_neg\"], \"wx\": 1.0, \"wy\": 1.0, \"lambda_val\": 1.0},\n        {\"families\": [\"LR_hor\", \"LR_pos\", \"LR_neg\", \"BT_ver\", \"BT_pos\", \"BT_neg\"], \"wx\": 5.0, \"wy\": 1.0, \"lambda_val\": 0.1},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # 1. Setup rays and build the sensitivity matrix G\n        rays = []\n        for fam_name in case[\"families\"]:\n            rays.extend(all_ray_families[fam_name])\n        G = build_G(rays, n, S)\n        \n        # 2. Build the smoothing operator L\n        L = build_L(n, case[\"wx\"], case[\"wy\"])\n        \n        # 3. Form and solve the normal equations for the Point-Spread Function (PSF)\n        lambda_sq = case[\"lambda_val\"]**2\n        \n        # System matrix A = G^T G + lambda^2 L^T L\n        A = G.T @ G + lambda_sq * (L.T @ L)\n        \n        # Right-hand side b = G^T g_{c0}, where g_{c0} is the c0-th column of G\n        g_c0 = G[:, c0]\n        b = G.T @ g_c0\n        \n        # Solve A * m_hat = b for the PSF m_hat\n        m_hat = np.linalg.solve(A, b)\n        \n        # 4. Calculate the anisotropy ratio rho\n        rho = calculate_anisotropy(m_hat, n, i0, j0, epsilon)\n        results.append(rho)\n        \n    # Format and print the final results as specified\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```", "id": "3613732"}]}