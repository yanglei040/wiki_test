{"hands_on_practices": [{"introduction": "控制体积上的积分公式不仅是数值方法的基石，也是进行物理推理的强大分析工具。本练习将通过一个斯托克斯流（Stokes flow）的理想实验，来展示如何运用积分动量守恒定律揭示基本物理原理。通过将作用在控制体表面的应力积分，与作用在整个体积上的体力联系起来，你将发现一个深刻的结论：在定常、不可压缩流动中，施加于流体单元的净表面力精确地平衡了作用于其上的体力，这正是流体静力平衡在动力学背景下的体现。[@problem_id:3604912]", "problem": "考虑一种粘性盐水的不可压缩斯托克斯流，其密度 $\\rho$ 和动力粘度 $\\mu$ 恒定，流经位于 $z=0$ 的刚性、不可渗透的平面边界。该流占据 $z>0$ 的半空间。一个矩形控制体 (CV) $V$ 邻接于该边界，由 $0 \\leq x \\leq L_{x}$，$0 \\leq y \\leq L_{y}$ 和 $0 \\leq z \\leq L_{z}$ 定义，其底面与 $z=0$ 处的边界重合。经测量，边界附近的局部速度场在 $z$ 方向上呈线性关系，其分量为 $u_{x}(x,y,z)=\\alpha z$ 和 $u_{y}(x,y,z)=\\beta z$，以及 $u_{z}(x,y,z)=0$，其中 $\\alpha$ 和 $\\beta$ 为常数。流体受到均匀的重力体积力 $\\mathbf{f}=-\\rho g\\,\\mathbf{k}$ 的作用，其中 $g$ 是重力加速度，$\\mathbf{k}$ 是 $z$ 轴正方向的单位向量。\n\n使用适用于不可压缩斯托克斯流的控制体积分公式和第一性原理，计算净牵引力矢量 $\\displaystyle \\int_{\\partial V}\\boldsymbol{\\sigma}\\cdot\\mathbf{n}\\,dS$，其中 $\\boldsymbol{\\sigma}$ 是柯西应力张量，$\\mathbf{n}$ 是 $\\partial V$ 上的外向单位法向量。参数如下：\n$$\\rho=1020\\ \\text{kg m}^{-3},\\quad \\mu=1.5\\ \\text{Pa s},\\quad g=9.81\\ \\text{m s}^{-2},\\quad L_{x}=0.50\\ \\text{m},\\quad L_{y}=0.30\\ \\text{m},\\quad L_{z}=0.020\\ \\text{m},\\quad \\alpha=0.20\\ \\text{s}^{-1},\\quad \\beta=-0.10\\ \\text{s}^{-1}.$$\n将你的最终答案表示为一个 $1\\times 3$ 的行向量，单位为牛顿，并将每个分量四舍五入至四位有效数字。", "solution": "该问题要求计算净牵引力矢量，即牵引力矢量 $\\mathbf{t} = \\boldsymbol{\\sigma}\\cdot\\mathbf{n}$ 在控制体 $V$ 的整个闭合曲面 $\\partial V$ 上的积分。净牵引力矢量 $\\mathbf{T}_{\\text{net}}$ 由以下曲面积分给出：\n$$ \\mathbf{T}_{\\text{net}} = \\oint_{\\partial V} \\boldsymbol{\\sigma}\\cdot\\mathbf{n}\\,dS $$\n其中 $\\boldsymbol{\\sigma}$ 是柯西应力张量，$\\mathbf{n}$ 是边界 $\\partial V$ 上的外向单位法向量。\n\n散度定理将矢量场（或与法向量缩并的张量场）在闭合曲面上的曲面积分与该场在曲面所包围体积上的散度的体积分联系起来。将该定理应用于 $\\mathbf{T}_{\\text{net}}$ 的表达式，得到：\n$$ \\mathbf{T}_{\\text{net}} = \\int_{V} (\\nabla \\cdot \\boldsymbol{\\sigma})\\,dV $$\n\n问题陈述指明流体处于不可压缩斯托克斯流状态。在该情况下，动量守恒的控制方程是斯托克斯方程，它表示表面力与体积力之间的平衡，因为惯性力可以忽略不计。该动量平衡的微分形式为：\n$$ \\nabla \\cdot \\boldsymbol{\\sigma} + \\mathbf{f} = \\mathbf{0} $$\n其中 $\\mathbf{f}$ 是单位体积的体积力。\n\n在继续之前，我们验证给定的速度场 $\\mathbf{u}(x,y,z) = (\\alpha z, \\beta z, 0)$ 是否与假设一致。\n首先，对于不可压缩流，连续性方程要求速度场的散度为零：\n$$ \\nabla \\cdot \\mathbf{u} = \\frac{\\partial u_x}{\\partial x} + \\frac{\\partial u_y}{\\partial y} + \\frac{\\partial u_z}{\\partial z} = \\frac{\\partial(\\alpha z)}{\\partial x} + \\frac{\\partial(\\beta z)}{\\partial y} + \\frac{\\partial(0)}{\\partial z} = 0 + 0 + 0 = 0 $$\n该速度场确实是无散的，因此满足不可压缩性条件。\n\n其次，当纳维-斯托克斯方程中的惯性项可以忽略不计时，斯托克斯流近似是有效的。完整的稳态动量方程为 $\\rho (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = \\nabla \\cdot \\boldsymbol{\\sigma} + \\mathbf{f}$。对于给定的速度场，对流加速度项为：\n$$ (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = u_x \\frac{\\partial \\mathbf{u}}{\\partial x} + u_y \\frac{\\partial \\mathbf{u}}{\\partial y} + u_z \\frac{\\partial \\mathbf{u}}{\\partial z} $$\n由于 $\\mathbf{u}$ 仅是 $z$ 的函数，其关于 $x$ 和 $y$ 的导数均为零：$\\frac{\\partial \\mathbf{u}}{\\partial x} = \\mathbf{0}$ 和 $\\frac{\\partial \\mathbf{u}}{\\partial y} = \\mathbf{0}$。此外，速度的 $z$ 分量 $u_z$ 为零。因此，该表达式简化为：\n$$ (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = (\\alpha z)( \\mathbf{0}) + (\\beta z)(\\mathbf{0}) + (0) \\frac{\\partial \\mathbf{u}}{\\partial z} = \\mathbf{0} $$\n对于这个速度场，惯性项恒等于零，这意味着斯托克斯方程 $\\nabla \\cdot \\boldsymbol{\\sigma} + \\mathbf{f} = \\mathbf{0}$ 是对动量平衡的精确描述，而非近似。\n\n根据斯托克斯方程，我们可以将应力张量的散度表示为：\n$$ \\nabla \\cdot \\boldsymbol{\\sigma} = -\\mathbf{f} $$\n将此代入 $\\mathbf{T}_{\\text{net}}$ 的体积分中：\n$$ \\mathbf{T}_{\\text{net}} = \\int_{V} (-\\mathbf{f})\\,dV $$\n\n问题陈述流体受到均匀的重力体积力 $\\mathbf{f} = -\\rho g \\mathbf{k}$ 的作用，其中 $\\rho$ 是恒定密度，$g$ 是重力加速度，$\\mathbf{k}$ 是 $z$ 轴正方向的单位向量。代入 $\\mathbf{f}$ 的表达式：\n$$ \\mathbf{T}_{\\text{net}} = \\int_{V} -(-\\rho g \\mathbf{k})\\,dV = \\int_{V} \\rho g \\mathbf{k}\\,dV $$\n\n由于 $\\rho$、$g$ 和 $\\mathbf{k}$ 都是常数，它们可以从积分中提出：\n$$ \\mathbf{T}_{\\text{net}} = \\rho g \\mathbf{k} \\int_{V} dV $$\n积分 $\\int_V dV$ 是控制体 $V$ 的体积。该控制体是一个尺寸为 $L_x$、$L_y$ 和 $L_z$ 的长方体。其体积为：\n$$ \\text{Volume}(V) = L_x L_y L_z $$\n因此，净牵引力矢量为：\n$$ \\mathbf{T}_{\\text{net}} = \\rho g (L_x L_y L_z) \\mathbf{k} $$\n\n此结果表明，净牵引力是一个纯粹指向 $z$ 轴正方向的矢量。其大小等于控制体内所含流体的重量。这是阿基米德原理在连续介质力学背景下的表述：周围流体对控制体内流体施加的净力完全平衡了作用于其上的体积力（重力），正如处于静态或非加速平衡状态的物体所要求的那样。描述流动剪切的参数 $\\mu$、$\\alpha$ 和 $\\beta$ 决定了牵引力在控制体各个面上的分布，但它们不影响整个闭合曲面上的净牵引力。\n\n我们现在代入给定的数值来计算最终答案。\n$\\rho = 1020\\ \\text{kg m}^{-3}$\n$g = 9.81\\ \\text{m s}^{-2}$\n$L_x = 0.50\\ \\text{m}$\n$L_y = 0.30\\ \\text{m}$\n$L_z = 0.020\\ \\text{m}$\n\n净牵引力矢量 $\\mathbf{T}_{\\text{net}} = (T_x, T_y, T_z)$ 的分量为：\n$T_x = 0\\ \\text{N}$\n$T_y = 0\\ \\text{N}$\n$T_z = \\rho g L_x L_y L_z = (1020)(9.81)(0.50)(0.30)(0.020)$\n$T_z = (1020)(9.81)(0.0030) = 30.0186\\ \\text{N}$\n\n问题要求将每个分量四舍五入至四位有效数字。\n$T_x = 0.000$\n$T_y = 0.000$\n$T_z = 30.02$\n\n净牵引力矢量为 $(0, 0, 30.02)$，单位为牛顿。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  30.02\n\\end{pmatrix}\n}\n$$", "id": "3604912"}, {"introduction": "从概念理解转向实际应用，有限体积法的核心在于如何近似计算通过控制体边界的通量积分。本练习提供了一个构建最基础、也最重要的通量近似方案——一阶迎风格式（first-order upwind scheme）的实践机会。通过亲手实现这个数值通量，你将深刻理解“信息随流而动”这一物理直觉是如何转化为具体的计算步骤的，从而为更复杂的地球物理流动模拟打下坚实基础。[@problem_id:3604928]", "problem": "考虑一个无源无汇的被动标量浓度场 $c(\\mathbf{x},t)$，其由一个欧拉速度场 $\\mathbf{u}(\\mathbf{x},t)$ 输运。在一个带有边界 $\\partial V$ 的固定控制体 $V$ 上的标量守恒定律，其积分形式为：总标量含量的变化率等于通过边界的净平流流出量的负值。你需要处理一个轴对齐的矩形控制体 $V$，其边长分别为 $L_x$、$L_y$ 和 $L_z$，各个面上的外向单位法向量为 $\\{\\pm \\hat{\\mathbf{x}}, \\pm \\hat{\\mathbf{y}}, \\pm \\hat{\\mathbf{z}}\\}$。\n\n从基本积分守恒定律和散度定理出发，推导出 $\\int_V c\\,dV$ 变化率的平流贡献项的表达式，该表达式是一个在 $\\partial V$ 上涉及 $\\mathbf{u}c \\cdot \\mathbf{n}$ 的面积分，然后将其特化为适用于单个矩形控制体和面平均数据的离散面求和形式。采用以下建模假设和定义进行离散近似：\n- 在 $\\partial V$ 的每个面 $f$ 上，给定：\n  - 面法向速度平均值 $u_{n,f}$，定义为 $\\mathbf{u}\\cdot\\mathbf{n}_f$ 在该面上的平均值（其中 $\\mathbf{n}_f$ 是该面的外向单位法向量），单位为米/秒。\n  - 入流浓度 $c_{\\text{in},f}$，定义为紧邻面外侧 $c$ 的平均值，且仅在流体通过该面流入 $V$ 时使用。\n- 对面浓度使用一阶迎风格式进行近似：对于每个面 $f$，如果 $u_{n,f} \\ge 0$，则取上游侧的施主浓度为单元平均值 $c_V$；如果 $u_{n,f}  0$，则取施主浓度为给定的入流浓度 $c_{\\text{in},f}$；如果 $u_{n,f} = 0$，则该面的通量贡献为零。\n- 面面积为 $A_{+x} = A_{-x} = L_y L_z$，$A_{+y} = A_{-y} = L_x L_z$，$A_{+z} = A_{-z} = L_x L_y$。\n- $V$ 中总标量变化率的平流贡献项，是在 $\\partial V$ 各个面上求和的净平流通量的负值。\n\n物理单位：\n- 长度 $L_x, L_y, L_z$ 的单位必须是米。\n- 速度分量 $u_{n,f}$ 的单位必须是米/秒。\n- 浓度 $c_V$ 和 $c_{\\text{in},f}$ 的单位必须是千克/立方米。\n- 所要求的输出，即 $\\frac{d}{dt}\\int_V c\\,dV$ 的平流贡献项，必须以千克/秒为单位表示，并四舍五入到六位小数。\n\n你的任务是实现一个程序，对下述每个测试用例，计算在上述迎风格式近似下 $\\int_V c\\,dV$ 变化率的平流贡献项。\n\n测试套件（每个用例都是一组完整、独立的参数）：\n- 用例 1：\n  - $L_x = 2.0$ 米，$L_y = 1.0$ 米，$L_z = 1.5$ 米。\n  - $c_V = 3.0$ 千克/立方米。\n  - 面法向速度（米/秒）：$u_{n,+x} = 0.2$, $u_{n,-x} = -0.1$, $u_{n,+y} = -0.05$, $u_{n,-y} = 0.10$, $u_{n,+z} = 0.0$, $u_{n,-z} = -0.2$。\n  - 入流浓度（千克/立方米）：$c_{\\text{in},+x} = 1.0$, $c_{\\text{in},-x} = 4.0$, $c_{\\text{in},+y} = 2.5$, $c_{\\text{in},-y} = 1.0$, $c_{\\text{in},+z} = 3.0$, $c_{\\text{in},-z} = 3.5$。\n- 用例 2：\n  - $L_x = 1.0$ 米，$L_y = 1.0$ 米，$L_z = 1.0$ 米。\n  - $c_V = 1.0$ 千克/立方米。\n  - 面法向速度（米/秒）：$u_{n,+x} = 0.0$, $u_{n,-x} = 0.0$, $u_{n,+y} = 0.0$, $u_{n,-y} = 0.0$, $u_{n,+z} = 0.0$, $u_{n,-z} = 0.0$。\n  - 入流浓度（千克/立方米）：$c_{\\text{in},+x} = 1.0$, $c_{\\text{in},-x} = 1.0$, $c_{\\text{in},+y} = 1.0$, $c_{\\text{in},-y} = 1.0$, $c_{\\text{in},+z} = 1.0$, $c_{\\text{in},-z} = 1.0$。\n- 用例 3：\n  - $L_x = 1.5$ 米，$L_y = 1.0$ 米，$L_z = 2.0$ 米。\n  - $c_V = 3.2$ 千克/立方米。\n  - 面法向速度（米/秒）：$u_{n,+x} = 0.1$, $u_{n,-x} = -0.1$, $u_{n,+y} = 0.05$, $u_{n,-y} = -0.05$, $u_{n,+z} = 0.0$, $u_{n,-z} = 0.0$。\n  - 入流浓度（千克/立方米）：$c_{\\text{in},+x} = 3.2$, $c_{\\text{in},-x} = 3.2$, $c_{\\text{in},+y} = 3.2$, $c_{\\text{in},-y} = 3.2$, $c_{\\text{in},+z} = 3.2$, $c_{\\text{in},-z} = 3.2$。\n- 用例 4：\n  - $L_x = 3.0$ 米，$L_y = 2.0$ 米，$L_z = 1.0$ 米。\n  - $c_V = 5.0$ 千克/立方米。\n  - 面法向速度（米/秒）：$u_{n,+x} = 0.0$, $u_{n,-x} = -1.0$, $u_{n,+y} = 0.2$, $u_{n,-y} = 0.0$, $u_{n,+z} = 0.1$, $u_{n,-z} = 0.0$。\n  - 入流浓度（千克/立方米）：$c_{\\text{in},+x} = 5.0$, $c_{\\text{in},-x} = 0.5$, $c_{\\text{in},+y} = 5.0$, $c_{\\text{in},-y} = 5.0$, $c_{\\text{in},+z} = 5.0$, $c_{\\text{in},-z} = 5.0$。\n\n你的程序应生成单行输出，其中包含用例 1 到 4 的结果，格式为方括号括起来的逗号分隔列表，例如 $[r_1,r_2,r_3,r_4]$，其中每个值都以千克/秒为单位，并四舍五入到六位小数，每个 $r_i$ 是一个小数点后恰好有六位的浮点数。", "solution": "该问题是有效的，因为它在科学上基于质量守恒原理，在数学上是适定的，并且由客观、明确的参数定义。\n\n在一个没有内部源或汇的固定控制体 $V$ 中，由速度场 $\\mathbf{u}(\\mathbf{x}, t)$ 输运的浓度为 $c(\\mathbf{x}, t)$ 的被动标量，其主导的基本原理是守恒定律的积分形式。该定律指出，$V$ 内标量总量的随时间变化率等于穿过边界面 $\\partial V$ 的标量净平流通量的负值。在数学上，这表示为：\n$$\n\\frac{d}{dt} \\int_V c \\, dV = - \\oint_{\\partial V} (c\\mathbf{u}) \\cdot \\mathbf{n} \\, dA\n$$\n此处，$\\mathbf{n}$ 是面元 $dA$ 上的外指单位法向量。项 $c\\mathbf{u}$ 代表平流通量矢量，其与 $\\mathbf{n}$ 的点积给出了垂直于边界的通量分量。\n\n对于离散数值方法，在 $\\partial V$ 上的连续面积分被近似为在构成边界的离散面上的通量之和。给定的控制体是一个长方体，因此其边界 $\\partial V$ 由六个面组成，我们用索引 $f$ 来表示。这些面对应于单元边界处的常数坐标平面，标记为 $\\{+x, -x, +y, -y, +z, -z\\}$。因此，面积分被离散化为：\n$$\n\\oint_{\\partial V} (c\\mathbf{u}) \\cdot \\mathbf{n} \\, dA \\approx \\sum_{f \\in \\partial V} \\text{Flux}_f\n$$\n通过单个面 $f$ 的通量是通过假设相关物理量在面面积 $A_f$ 上是恒定的来近似的。通过面 $f$ 的通量则由下式给出：\n$$\n\\text{Flux}_f = \\int_{A_f} (c\\mathbf{u}) \\cdot \\mathbf{n}_f \\, dA \\approx (c_f u_{n,f}) A_f\n$$\n此处，$u_{n,f}$ 是面平均法向速度分量 $(\\mathbf{u} \\cdot \\mathbf{n}_f)_f$，$c_f$ 是面上的代表性标量浓度。\n\n问题指定了一个一阶迎风格式来确定 $c_f$ 的值。该格式基于这样一个原理：穿过一个面的流体携带了来自“上游”或“供体”侧的浓度。\n- 如果流动是向外的（$u_{n,f} \\ge 0$），则流体源自控制体内部。因此，面上的浓度取为控制体内的平均浓度 $c_V$。\n- 如果流动是向内的（$u_{n,f}  0$），则流体源自控制体外部。面上的浓度取为来自相邻区域的给定入流浓度 $c_{\\text{in},f}$。\n\n综合这些规则，面 $f$ 上的浓度 $c_f$ 确定为：\n$$\nc_f =\n\\begin{cases}\nc_V  \\text{如果 } u_{n,f} \\ge 0 \\\\\nc_{\\text{in},f}  \\text{如果 } u_{n,f}  0\n\\end{cases}\n$$\n净平流出流是所有六个面上的通量之和：\n$$\n\\text{Net Outflow} = \\sum_{f \\in \\partial V} c_f u_{n,f} A_f\n$$\n问题要求的是 $V$ 中总标量变化率的平流贡献项，即净平流出流的负值：\n$$\n\\frac{d}{dt} \\int_V c \\, dV \\bigg|_{\\text{advection}} = - \\sum_{f \\in \\{+x, -x, +y, -y, +z, -z\\}} c_f u_{n,f} A_f\n$$\n面面积 $A_f$ 由边长为 $L_x$、$L_y$ 和 $L_z$ 的矩形控制体的几何形状给出：\n- $A_{\\pm x} = L_y L_z$\n- $A_{\\pm y} = L_x L_z$\n- $A_{\\pm z} = L_x L_y$\n\n为计算每个测试用例的最终值，我们将给定的 $L_x, L_y, L_z, c_V$ 以及特定于每个面的 $u_{n,f}$ 和 $c_{\\text{in},f}$ 的值代入此离散公式。单位是一致的：浓度 $c$ 的单位是 $\\text{kg} \\cdot \\text{m}^{-3}$，速度 $u$ 的单位是 $\\text{m} \\cdot \\text{s}^{-1}$，面积 $A$ 的单位是 $\\text{m}^2$。最终得到的通量项 $c u A$ 的单位是 $\\text{kg} \\cdot \\text{s}^{-1}$，这是总质量变化率的正确单位。\n\n计算过程如下：\n$1$. 对于六个面中的每一个，根据 $u_{n,f}$ 的符号确定流动方向。\n$2$. 选择合适的浓度 $c_f$（出流时为 $c_V$，入流时为 $c_{\\text{in},f}$）。\n$3$. 计算每个面的质量通量 $\\Phi_f = c_f u_{n,f} A_f$。\n$4$. 将所有六个面的通量相加，得到总净流出量 $\\sum \\Phi_f$。\n$5$. 最终结果是该总和的负值，即 $-\\sum \\Phi_f$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the scalar transport problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            \"L\": (2.0, 1.0, 1.5),\n            \"c_V\": 3.0,\n            \"u_n\": {'+x': 0.2, '-x': -0.1, '+y': -0.05, '-y': 0.10, '+z': 0.0, '-z': -0.2},\n            \"c_in\": {'+x': 1.0, '-x': 4.0, '+y': 2.5, '-y': 1.0, '+z': 3.0, '-z': 3.5}\n        },\n        # Case 2\n        {\n            \"L\": (1.0, 1.0, 1.0),\n            \"c_V\": 1.0,\n            \"u_n\": {'+x': 0.0, '-x': 0.0, '+y': 0.0, '-y': 0.0, '+z': 0.0, '-z': 0.0},\n            \"c_in\": {'+x': 1.0, '-x': 1.0, '+y': 1.0, '-y': 1.0, '+z': 1.0, '-z': 1.0}\n        },\n        # Case 3\n        {\n            \"L\": (1.5, 1.0, 2.0),\n            \"c_V\": 3.2,\n            \"u_n\": {'+x': 0.1, '-x': -0.1, '+y': 0.05, '-y': -0.05, '+z': 0.0, '-z': 0.0},\n            \"c_in\": {'+x': 3.2, '-x': 3.2, '+y': 3.2, '-y': 3.2, '+z': 3.2, '-z': 3.2}\n        },\n        # Case 4\n        {\n            \"L\": (3.0, 2.0, 1.0),\n            \"c_V\": 5.0,\n            \"u_n\": {'+x': 0.0, '-x': -1.0, '+y': 0.2, '-y': 0.0, '+z': 0.1, '-z': 0.0},\n            \"c_in\": {'+x': 5.0, '-x': 0.5, '+y': 5.0, '-y': 5.0, '+z': 5.0, '-z': 5.0}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_rate_of_change(case)\n        results.append(f\"{result:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_rate_of_change(case_data):\n    \"\"\"\n    Calculates the advective contribution to the rate of change of the total scalar\n    in a control volume using a first-order upwind scheme.\n    \"\"\"\n    Lx, Ly, Lz = case_data[\"L\"]\n    c_V = case_data[\"c_V\"]\n    u_n = case_data[\"u_n\"]\n    c_in = case_data[\"c_in\"]\n\n    # Define face areas\n    areas = {\n        '+x': Ly * Lz, '-x': Ly * Lz,\n        '+y': Lx * Lz, '-y': Lx * Lz,\n        '+z': Lx * Ly, '-z': Lx * Ly\n    }\n\n    faces = ['+x', '-x', '+y', '-y', '+z', '-z']\n    \n    total_net_outflow = 0.0\n    \n    for face in faces:\n        u_nf = u_n[face]\n        A_f = areas[face]\n        \n        # Apply the first-order upwind scheme to determine face concentration\n        if u_nf >= 0:\n            # Outflow: use the cell-average concentration\n            c_f = c_V\n        else:\n            # Inflow: use the prescribed inflow concentration\n            c_f = c_in[face]\n        \n        # Calculate flux through the face\n        flux = c_f * u_nf * A_f\n        total_net_outflow += flux\n            \n    # The rate of change is the negative of the net outflow\n    rate_of_change = -total_net_outflow\n    return rate_of_change\n\nsolve()\n```", "id": "3604928"}, {"introduction": "许多地球物理流动，例如多孔介质中的多相流或污染物运移，其行为由非线性方程描述，并常常会形成尖锐的锋面或激波。对于这类不连续现象，纯粹的微分方程在间断处会失效，而积分守恒定律则成为正确描述其物理行为的关键。本练习将引导你应用积分形式的质量守恒定律——即兰金-雨贡纽条件（Rankine–Hugoniot condition），来推导一个饱和度激波的传播速度，从而将抽象的控制体理论与真实物理世界中移动的锋面直接联系起来。[@problem_id:3604934]", "problem": "考虑在均匀一维多孔介质中，沿着空间坐标 $x$ 的水和油的不可混溶、不可压缩两相流。该介质具有恒定的孔隙度 $\\phi$，且毛细管压力和重力可忽略不计。一个控制体是区间 $[x_a, x_b]$。令 $S_w(x,t)$ 表示含水饱和度，$S_o(x,t) = 1 - S_w(x,t)$ 表示含油饱和度。总达西通量为 $q_t$，各相通量分别为 $q_w$ 和 $q_o$，且 $q_t = q_w + q_o$。绝对渗透率 $k$ 在空间上是均匀的。在所述假设下，两相的压力相等，因此相同的压力梯度驱动两相流动。水和油的粘度分别为 $\\mu_w$ 和 $\\mu_o$。相对渗透率是含水饱和度的Corey型函数，具有残余饱和度 $S_{wr}$ 和 $S_{or}$，有效含水饱和度 $S_{we} = (S_w - S_{wr})/(1 - S_{wr} - S_{or})$，以及指数 $n_w$ 和 $n_o$：\n$$\nk_{rw}(S_w) = S_{we}^{n_w}, \\qquad k_{ro}(S_w) = (1 - S_{we})^{n_o}.\n$$\n你可以认为流度为 $\\lambda_w(S_w) = k \\, k_{rw}(S_w)/\\mu_w$ 和 $\\lambda_o(S_w) = k \\, k_{ro}(S_w)/\\mu_o$。\n\n从控制体 $[x_a, x_b]$ 上各相的质量守恒积分形式和达西定律出发，推导分流函数 $f_w(S_w)$，其定义为水的积分通量与总积分通量之比。然后，利用守恒律在移动饱和度间断上的积分Rankine–Hugoniot (R–H) 条件，推导穿过左状态 $S_L$ 和右状态 $S_R$ 之间间断的激波速度公式，并使用以下参数集计算激波速度的数值。\n\n假设以下参数值在空间和时间上均为常数：\n- 孔隙度 $\\phi = 0.25$。\n- 总达西通量 $q_t = 1.0 \\times 10^{-5} \\,\\mathrm{m/s}$。\n- 水粘度 $\\mu_w = 1.0 \\times 10^{-3} \\,\\mathrm{Pa \\cdot s}$。\n- 油粘度 $\\mu_o = 5.0 \\times 10^{-3} \\,\\mathrm{Pa \\cdot s}$。\n- 残余饱和度 $S_{wr} = 0.2$ 和 $S_{or} = 0.2$。\n- Corey指数 $n_w = 2$ 和 $n_o = 2$。\n- 间断两侧的左、右含水饱和度分别为 $S_L = 0.2$ 和 $S_R = 0.7$。\n\n你的任务是：\n1. 使用 $[x_a, x_b]$ 上的积分通量，推导 $f_w(S_w)$，先用 $\\lambda_w(S_w)$ 和 $\\lambda_o(S_w)$ 表示，然后用 $S_w$, $\\mu_w$, $\\mu_o$, $S_{wr}$, $S_{or}$, $n_w$ 和 $n_o$ 表示。\n2. 使用积分Rankine–Hugoniot条件，将激波速度 $s$ 用 $q_t$, $\\phi$, $S_L$, $S_R$ 和 $f_w(S)$ 表示，并为给定参数计算其数值。\n\n以 $\\mathrm{m/s}$ 为单位表示最终的激波速度，并将答案四舍五入到四位有效数字。最终答案必须是单个数字。不要在最终方框内的答案中包含单位。", "solution": "我们从固定控制体 $[x_a, x_b]$ 上各相的质量守恒积分形式开始。对水相而言，质量守恒可写为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{x_a}^{x_b} \\phi S_w(x,t) \\, \\mathrm{d}x \\;+\\; \\left[q_w(x_b,t) - q_w(x_a,t)\\right] \\;=\\; 0,\n$$\n对油相也类似，\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{x_a}^{x_b} \\phi S_o(x,t) \\, \\mathrm{d}x \\;+\\; \\left[q_o(x_b,t) - q_o(x_a,t)\\right] \\;=\\; 0.\n$$\n将两个方程相加并使用 $S_o = 1 - S_w$ 可得\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{x_a}^{x_b} \\phi \\, \\mathrm{d}x \\;+\\; \\left[q_t(x_b,t) - q_t(x_a,t)\\right] \\;=\\; 0,\n$$\n其中 $q_t = q_w + q_o$ 是总通量。由于 $\\phi$ 是常数且相是不可压缩的，第一项为零，因此\n$$\nq_t(x_b,t) - q_t(x_a,t) = 0,\n$$\n这意味着 $q_t$ 在空间上是常数。在一维情况下，忽略毛细管压力和重力，各相的达西定律给出\n$$\nq_w = -k \\, \\frac{k_{rw}(S_w)}{\\mu_w} \\, \\frac{\\partial p}{\\partial x} \\;=\\; -\\lambda_w(S_w) \\, \\frac{\\partial p}{\\partial x},\n$$\n$$\nq_o = -k \\, \\frac{k_{ro}(S_w)}{\\mu_o} \\, \\frac{\\partial p}{\\partial x} \\;=\\; -\\lambda_o(S_w) \\, \\frac{\\partial p}{\\partial x},\n$$\n流度为 $\\lambda_w(S_w) = k \\, k_{rw}(S_w)/\\mu_w$ 和 $\\lambda_o(S_w) = k \\, k_{ro}(S_w)/\\mu_o$。总通量为\n$$\nq_t \\;=\\; q_w + q_o \\;=\\; -\\left[\\lambda_w(S_w) + \\lambda_o(S_w)\\right] \\, \\frac{\\partial p}{\\partial x}.\n$$\n因此，水的分流函数，定义为水通量与总通量之比，\n$$\nf_w(S_w) \\;=\\; \\frac{q_w}{q_t},\n$$\n可以用流度表示为\n$$\nf_w(S_w) \\;=\\; \\frac{\\lambda_w(S_w)}{\\lambda_w(S_w) + \\lambda_o(S_w)}.\n$$\n在带有残余饱和度的Corey参数化下，有效饱和度是\n$$\nS_{we} \\;=\\; \\frac{S_w - S_{wr}}{1 - S_{wr} - S_{or}},\n$$\n相对渗透率是\n$$\nk_{rw}(S_w) \\;=\\; S_{we}^{n_w}, \\qquad k_{ro}(S_w) \\;=\\; \\left(1 - S_{we}\\right)^{n_o}.\n$$\n因此，流度变为\n$$\n\\lambda_w(S_w) \\;=\\; k \\, \\frac{S_{we}^{n_w}}{\\mu_w}, \\qquad \\lambda_o(S_w) \\;=\\; k \\, \\frac{\\left(1 - S_{we}\\right)^{n_o}}{\\mu_o},\n$$\n分流函数简化为（绝对渗透率 $k$ 被消去）\n$$\nf_w(S_w) \\;=\\; \\frac{\\dfrac{S_{we}^{n_w}}{\\mu_w}}{\\dfrac{S_{we}^{n_w}}{\\mu_w} + \\dfrac{\\left(1 - S_{we}\\right)^{n_o}}{\\mu_o}}.\n$$\n\n接下来，我们从积分Rankine–Hugoniot (R–H) 条件推导激波速度。通过将积分形式局部化，得到水相守恒律的微分形式：\n$$\n\\phi \\, \\frac{\\partial S_w}{\\partial t} \\;+\\; \\frac{\\partial q_w}{\\partial x} \\;=\\; 0.\n$$\n代入 $q_w = f_w(S_w) \\, q_t$ 并利用在我们的假设下 $q_t$ 在空间和时间上是常数，我们得到守恒形式\n$$\n\\phi \\, \\frac{\\partial S_w}{\\partial t} \\;+\\; \\frac{\\partial}{\\partial x} \\left[q_t \\, f_w(S_w)\\right] \\;=\\; 0.\n$$\n考虑一个以速度 $s$ 移动的间断（激波），它分隔了左状态 $S_L$ 和右状态 $S_R$。对于形式为 $a \\, \\partial_t u + \\partial_x F(u) = 0$ 的守恒律，积分R–H条件给出的激波速度为\n$$\ns \\;=\\; \\frac{F(u_R) - F(u_L)}{a \\, (u_R - u_L)}.\n$$\n此处，$u = S_w$，$a = \\phi$ 且 $F(S_w) = q_t \\, f_w(S_w)$，因此\n$$\ns \\;=\\; \\frac{q_t \\, f_w(S_R) - q_t \\, f_w(S_L)}{\\phi \\, (S_R - S_L)} \\;=\\; \\frac{q_t}{\\phi} \\, \\frac{f_w(S_R) - f_w(S_L)}{S_R - S_L}.\n$$\n\n现在我们使用给定的参数计算 $f_w(S_L)$ 和 $f_w(S_R)$。参数值为\n$$\n\\phi = 0.25, \\quad q_t = 1.0 \\times 10^{-5} \\,\\mathrm{m/s}, \\quad \\mu_w = 1.0 \\times 10^{-3} \\,\\mathrm{Pa \\cdot s}, \\quad \\mu_o = 5.0 \\times 10^{-3} \\,\\mathrm{Pa \\cdot s},\n$$\n$$\nS_{wr} = 0.2, \\quad S_{or} = 0.2, \\quad n_w = 2, \\quad n_o = 2, \\quad S_L = 0.2, \\quad S_R = 0.7.\n$$\n有效饱和度为\n$$\nS_{we}(S_L) \\;=\\; \\frac{S_L - S_{wr}}{1 - S_{wr} - S_{or}} \\;=\\; \\frac{0.2 - 0.2}{1 - 0.2 - 0.2} \\;=\\; \\frac{0}{0.6} \\;=\\; 0,\n$$\n$$\nS_{we}(S_R) \\;=\\; \\frac{0.7 - 0.2}{1 - 0.2 - 0.2} \\;=\\; \\frac{0.5}{0.6} \\;=\\; \\frac{5}{6} \\;=\\; 0.833333\\ldots.\n$$\n因此，\n$$\nk_{rw}(S_L) = 0^{2} = 0, \\qquad k_{ro}(S_L) = (1 - 0)^{2} = 1,\n$$\n$$\nk_{rw}(S_R) = \\left(\\frac{5}{6}\\right)^{2} = \\frac{25}{36} \\approx 0.694444\\ldots, \\qquad k_{ro}(S_R) = \\left(1 - \\frac{5}{6}\\right)^{2} = \\left(\\frac{1}{6}\\right)^{2} = \\frac{1}{36} \\approx 0.027777\\ldots.\n$$\n流度（忽略在 $f_w$ 中被消去的公因子 $k$）为\n$$\n\\lambda_w(S_L) \\propto \\frac{k_{rw}(S_L)}{\\mu_w} = \\frac{0}{\\mu_w} = 0, \\qquad \\lambda_o(S_L) \\propto \\frac{k_{ro}(S_L)}{\\mu_o} = \\frac{1}{5.0 \\times 10^{-3}} = 200,\n$$\n$$\n\\lambda_w(S_R) \\propto \\frac{k_{rw}(S_R)}{\\mu_w} = \\frac{0.694444\\ldots}{1.0 \\times 10^{-3}} \\approx 694.444\\ldots, \\qquad \\lambda_o(S_R) \\propto \\frac{k_{ro}(S_R)}{\\mu_o} = \\frac{0.027777\\ldots}{5.0 \\times 10^{-3}} \\approx 5.555555\\ldots.\n$$\n所以，\n$$\nf_w(S_L) \\;=\\; \\frac{0}{0 + 200} \\;=\\; 0,\n$$\n$$\nf_w(S_R) \\;=\\; \\frac{694.444\\ldots}{694.444\\ldots + 5.555555\\ldots} \\;=\\; \\frac{694.444\\ldots}{700.000\\ldots} \\;=\\; 0.992063\\ldots.\n$$\n激波速度是\n$$\ns \\;=\\; \\frac{q_t \\left[f_w(S_R) - f_w(S_L)\\right]}{\\phi \\, (S_R - S_L)} \\;=\\; \\frac{\\left(1.0 \\times 10^{-5}\\right) \\times 0.992063\\ldots}{0.25 \\times (0.7 - 0.2)}.\n$$\n计算分母：\n$$\n\\phi \\, (S_R - S_L) \\;=\\; 0.25 \\times 0.5 \\;=\\; 0.125.\n$$\n计算分子：\n$$\nq_t \\left[f_w(S_R) - f_w(S_L)\\right] \\;=\\; 1.0 \\times 10^{-5} \\times 0.992063\\ldots \\;=\\; 9.9206349\\ldots \\times 10^{-6}.\n$$\n因此，\n$$\ns \\;=\\; \\frac{9.9206349\\ldots \\times 10^{-6}}{0.125} \\;=\\; 7.9365079\\ldots \\times 10^{-5}.\n$$\n四舍五入到四位有效数字，得到\n$$\ns \\;\\approx\\; 7.937 \\times 10^{-5}.\n$$\n根据说明，最终方框内的答案应省略单位；速度单位为 $\\mathrm{m/s}$。", "answer": "$$\\boxed{7.937 \\times 10^{-5}}$$", "id": "3604934"}]}