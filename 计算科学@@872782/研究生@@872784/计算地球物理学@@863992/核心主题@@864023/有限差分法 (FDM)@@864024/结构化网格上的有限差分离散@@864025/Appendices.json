{"hands_on_practices": [{"introduction": "在有限差分法中，正确地实现边界条件与离散化内部区域同样重要。本练习关注于在计算地球物理学中常见的混合（Robin）边界条件，演示了如何修改计算网格边缘的有限差分格式，以将连续边界条件精确地转化为离散线性系统的一部分。通过这个实践，您将掌握构建能够反映真实物理约束的数值模型的关键一步。[@problem_id:3592039]", "problem": "考虑区间 $[0,L]$ 上的一个一维稳态扩散方程，该方程代表了计算地球物理学中的热传导或压力扩散，\n$$\n- \\frac{d^{2}u}{dx^{2}} = s(x),\n$$\n在 $x=L$ 处具有线性罗宾边界条件，\n$$\n\\alpha\\,u(L) + \\beta\\,\\frac{du}{dx}(L) = f,\n$$\n其中 $\\alpha$、$\\beta$ 和 $f$ 是给定常数，$s(x)$ 是一个给定的源项。假设该区域通过一个均匀结构化网格进行离散化，节点为 $x_{i} = i\\,h$，其中 $i=0,1,\\dots,N$，$h = L/N$。\n\n假设内部二阶导数在结构化网格上通过标准的二阶中心有限差分进行离散化，\n$$\n\\frac{d^{2}u}{dx^{2}}(x_{i}) \\approx \\frac{u_{i-1} - 2u_{i} + u_{i+1}}{h^{2}}, \\quad i = 1,2,\\dots,N-1,\n$$\n并且在 $x=L$ 处的边界导数通过与网格拓扑一致的单边后向有限差分进行近似，\n$$\n\\frac{du}{dx}(L) \\approx \\frac{u_{N} - u_{N-1}}{h}.\n$$\n\n从这些定义和控制方程出发，建立在 $x=L$ 处的离散罗宾边界条件，该条件应与二阶内部拉普拉斯算子兼容，即全局线性系统的最后一个方程用离散边界条件替换 $i=N$ 处的内部模板。由此，计算矩阵方程 $A\\,\\mathbf{u}=\\mathbf{b}$ 最后一行的修改后边界模板，明确给出最后一行中乘以 $u_{N-1}$ 和 $u_{N}$ 的系数，以及相应的右侧项。\n\n将最终答案表示为一个单行向量，按顺序包含 $u_{N-1}$ 和 $u_{N}$ 的最后一行矩阵系数，然后是最后一行的右侧项。不需要进行数值四舍五入。最终答案中不需要单位。", "solution": "此问题经验证是有效的。这是一个计算地球物理学中常见的适定问题，要求将罗宾（Robin）边界条件离散化，以整合到有限差分法的线性系统中。任务是推导构成该系统最后一行的离散方程。\n\n控制连续问题由扩散方程和在 $x=L$ 处的边界条件定义：\n扩散方程为：\n$$\n- \\frac{d^{2}u}{dx^{2}} = s(x) \\quad \\text{for } x \\in [0,L]\n$$\n在 $x=L$ 处的罗宾边界条件为：\n$$\n\\alpha\\,u(L) + \\beta\\,\\frac{du}{dx}(L) = f\n$$\n区域使用均匀网格进行离散化，节点为 $x_i = i\\,h$，其中 $i=0, 1, \\dots, N$，网格间距为 $h=L/N$。函数 $u(x)$ 在网格节点上的离散近似值记为 $u_i \\approx u(x_i)$。\n\n问题指定这个连续边界条件必须转换为一个离散方程，该方程将构成线性系统 $A\\mathbf{u} = \\mathbf{b}$ 的最后一行。为此，我们将边界条件方程中的连续项替换为其指定的离散近似。\n\n函数 $u$ 在边界 $x=L$ 处的值对应于节点 $i=N$。因此，我们将 $u(L)$ 近似为：\n$$\nu(L) \\approx u_N\n$$\n问题为边界 $x=L$ 处的一阶导数提供了一个特定的有限差分公式。这是一个一阶精度的单边后向差分近似：\n$$\n\\frac{du}{dx}(L) \\approx \\frac{u(x_N) - u(x_{N-1})}{h} = \\frac{u_{N} - u_{N-1}}{h}\n$$\n现在我们将这些离散近似代入连续的罗宾边界条件方程中：\n$$\n\\alpha\\,u(L) + \\beta\\,\\frac{du}{dx}(L) = f\n$$\n代入 $u(L)$ 和 $\\frac{du}{dx}(L)$ 的近似值，得到：\n$$\n\\alpha\\,u_N + \\beta \\left( \\frac{u_N - u_{N-1}}{h} \\right) = f\n$$\n这个方程提供了离散值 $u_{N-1}$ 和 $u_N$ 之间的关系，从而施加了边界条件。正是这个方程将构成矩阵系统的最后一行。为了确定这一行的矩阵 $A$ 的系数和右侧向量 $\\mathbf{b}$，我们通过将涉及未知变量 $u_{N-1}$ 和 $u_N$ 的项组合在左侧来重新整理方程。\n\n展开各项：\n$$\n\\alpha\\,u_N + \\frac{\\beta}{h}u_N - \\frac{\\beta}{h}u_{N-1} = f\n$$\n现在，我们收集每个未知数 $u_j$ 的系数：\n$$\n\\left(-\\frac{\\beta}{h}\\right)u_{N-1} + \\left(\\alpha + \\frac{\\beta}{h}\\right)u_N = f\n$$\n这个方程是线性系统 $\\sum_{j} A_{N,j} u_j = b_N$ 中一行的标准形式。通过比较各项，我们可以直接确定最后一行（对应于节点 $i=N$）所要求的系数：\n\n乘以 $u_{N-1}$ 的系数是矩阵元素 $A_{N, N-1}$：\n$$\nA_{N, N-1} = -\\frac{\\beta}{h}\n$$\n乘以 $u_N$ 的系数是矩阵元素 $A_{N, N}$：\n$$\nA_{N, N} = \\alpha + \\frac{\\beta}{h}\n$$\n这一行中所有其他系数 $A_{N,j}$（对于 $j \\neq N, N-1$）均为零。\n\n右侧向量对应的项 $b_N$ 是：\n$$\nb_N = f\n$$\n问题要求按特定顺序给出这三个量：$u_{N-1}$ 的系数、$u_N$ 的系数以及右侧项。", "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\beta}{h} & \\alpha + \\frac{\\beta}{h} & f \\end{pmatrix}}\n$$", "id": "3592039"}, {"introduction": "验证数值代码的正确性是计算科学中的一个核心任务。“人造解法”（Method of Manufactured Solutions）是一种强大的验证技术，尤其是在复杂问题没有解析解的情况下。本练习将指导您为一个二维非均匀介质中的扩散问题执行一个完整的网格收敛性研究，这是任何计算科学家都必须具备的基本技能，以确保其模拟结果的可信度。[@problem_id:3592062]", "problem": "设计并实现一个程序，使用与二阶中心有限差分一致的方法，对二维结构化网格上的非均匀扩散问题进行网格收敛性研究。数学模型是具有空间变化标量传导系数的稳态扩散方程。设定的有界平面域为单位正方形 $\\Omega = [0,1]^2$。考虑以下边值问题\n$$\n- \\nabla \\cdot \\left( k(x,y) \\nabla u(x,y) \\right) = f(x,y) \\quad \\text{in } \\Omega,\\qquad u(x,y) = g(x,y) \\quad \\text{on } \\partial\\Omega ,\n$$\n其中传导系数 $k(x,y) > 0$ 是光滑的正函数，狄利克雷边界数据为 $g(x,y) = u_{\\text{exact}}(x,y)$。使用人工解法：选择一个光滑的 $u_{\\text{exact}}(x,y)$ 和一个光滑的 $k(x,y)$，然后通过以下恒等式定义 $f(x,y)$\n$$\nf(x,y) = -\\nabla \\cdot \\left( k(x,y)\\nabla u_{\\text{exact}}(x,y) \\right) = -\\left(k(x,y) \\, u_{xx}(x,y) + \\frac{\\partial k}{\\partial x}(x,y)\\, u_x(x,y) + k(x,y)\\, u_{yy}(x,y) + \\frac{\\partial k}{\\partial y}(x,y)\\, u_y(x,y)\\right),\n$$\n其中下标表示偏导数。取人工精确解为\n$$\nu_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(\\pi y).\n$$\n你必须在均匀笛卡尔网格上离散化算子 $-\\nabla\\cdot(k\\nabla u)$，网格在 $x$ 和 $y$ 方向上的间距分别为 $h_x$ 和 $h_y$。离散化时，使用一种保守、对称的两点通量近似，其中面传导系数由节点传導系数的调和平均值给出。将未知量置于内部网格节点 $\\{(x_i,y_j)\\}_{i=1,\\dots,N_x}^{j=1,\\dots,N_y}$ 上，其中 $x_i=i\\,h_x$，$y_j=j\\,h_y$，$h_x=1/(N_x+1)$，$h_y=1/(N_y+1)$。通过将边界节点值设为 $u_{\\text{exact}}$ 并将其贡献合并到内部方程的右侧项中来施加狄利克雷边界条件。使用鲁棒的稀疏直接法组装并求解得到的线性系统。在节点网格上（包括边界，其上数值解等于 $u_{\\text{exact}}$）计算出数值解 $u_h$ 后，评估所有网格节点上的离散误差场 $e_{i,j} = u_h(x_i,y_j) - u_{\\text{exact}}(x_i,y_j)$，并计算以下离散误差范数：\n$$\n\\|e\\|_{2,h} = \\left( h_x h_y \\sum_{i=0}^{N_x+1}\\sum_{j=0}^{N_y+1} e_{i,j}^2 \\right)^{1/2}, \\qquad \\|e\\|_{\\infty} = \\max_{0\\le i\\le N_x+1,\\,0\\le j\\le N_y+1} |e_{i,j}|.\n$$\n对于一系列特征网格尺寸为 $h=\\max(h_x,h_y)$ 的网格，计算误差范数，并通过最小二乘法将数据点 $\\log(\\|e\\|)$ 对 $\\log(h)$ 拟合为一条直线来估计观测到的精度阶 $p$；该直线的斜率即为 $p$ 的一个估计量。请使用自然对数。\n\n你的程序必须实现并报告以下三个测试用例的观测收敛率。在所有情况下，都使用上面指定的精确解，在 $\\partial\\Omega$ 上设置 $g=u_{\\text{exact}}$，并根据提供的恒等式定义 $f$。每个测试用例定义了一个传导系数场和一组网格。\n\n- 测试用例 A（光滑、缓变传导系数）：$k(x,y)=1+x+y$。使用方形网格，其中 $(N_x,N_y)\\in\\{(16,16),(32,32),(64,64),(128,128)\\}$。\n- 测试用例 B（光滑、速变但解析的传导系数）：$k(x,y)=\\exp(x+y)$。使用方形网格，其中 $(N_x,N_y)\\in\\{(16,16),(32,32),(64,64),(128,128)\\}$。\n- 测试用例 C（光滑、振荡传导系数和各向异性网格）：$k(x,y)=1+\\tfrac{1}{2}\\sin(5\\pi x)\\sin(5\\pi y)$。使用矩形网格，其中 $(N_x,N_y)\\in\\{(12,24),(24,48),(48,96),(96,192)\\}$。\n\n对每个测试用例，通过 $\\log(\\|e\\|_{2,h})$ 对 $\\log(h)$ 的斜率计算观测阶 $p_2$，通过 $\\log(\\|e\\|_{\\infty})$ 对 $\\log(h)$ 的斜率计算 $p_{\\infty}$。你的程序应该生成单行输出，包含三个测试用例的六个斜率，顺序如下：$[p_2^{\\text{A}},p_{\\infty}^{\\text{A}},p_2^{\\text{B}},p_{\\infty}^{\\text{B}},p_2^{\\text{C}},p_{\\infty}^{\\text{C}}]$。将每个斜率表示为四舍五入到3位小数的浮点数。不需要物理单位。\n\n你的离散化和求解器选择必须在科学上是合理的，并与所述模型和数值方法一致。实现不应接受任何外部输入，且必须按原样运行至完成。该测试套件涵盖一个普遍的光滑情况、一个快速变化的光滑情况，以及一个带有振荡光滑系数的各向异性网格情况，以探究渐近区域和对网格各向异性的潜在敏感性。对于光滑情况，如果离散化是二阶的，期望的观测阶应接近2；在最粗糙的网格层级上，最振荡的情况下可能会出现偏差，但随着 $h\\to 0$，结果应趋向于2。", "solution": "用户提供的问题经评估是有效的。这是一个计算科学领域的适定问题，基于偏微分方程数值分析的既定原则。该问题是自洽的，所有必要的参数、方程和方法都已明确指定。不存在科学、事实或逻辑上的不一致之处。任务是为一个具有可变系数的稳态扩散方程的二阶有限差分离散化执行网格收敛性研究，这是一种标准的验证技术。指定的方法论，包括使用人工解法、采用调和平均的保守通量近似法，以及用于收敛率估计的对数-对数回归，对于此问题而言在科学上是合理且适用的。\n\n### 1. 数学模型\n\n该物理过程由具有空间变化标量传導系数 $k(x,y)$ 的二维稳态扩散方程描述。在单位正方形域 $\\Omega = [0,1]^2$ 上的控制偏微分方程 (PDE) 为：\n$$\n- \\nabla \\cdot \\left( k(x,y) \\nabla u(x,y) \\right) = f(x,y) \\quad \\text{in } \\Omega\n$$\n该方程服从狄利克雷边界条件：\n$$\nu(x,y) = g(x,y) \\quad \\text{on } \\partial\\Omega\n$$\n该问题采用人工解法进行验证。选择一个光滑的精确解 $u_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(\\pi y)$。然后从这个精确解中导出源项 $f(x,y)$ 和边界条件 $g(x,y)$ 以确保一致性。边界条件在 $\\partial\\Omega$ 上设为 $g(x,y) = u_{\\text{exact}}(x,y)$。源项 $f(x,y)$ 是通过将微分算子应用于人工解得到的：\n$$\nf(x,y) = -\\nabla \\cdot \\left( k(x,y)\\nabla u_{\\text{exact}}(x,y) \\right)\n$$\n展开散度算子可得到源项的显式形式：\n$$\nf(x,y) = -\\left(\\frac{\\partial k}{\\partial x}\\frac{\\partial u_{\\text{exact}}}{\\partial x} + k \\frac{\\partial^2 u_{\\text{exact}}}{\\partial x^2} + \\frac{\\partial k}{\\partial y}\\frac{\\partial u_{\\text{exact}}}{\\partial y} + k \\frac{\\partial^2 u_{\\text{exact}}}{\\partial y^2}\\right)\n$$\n代入 $u_{\\text{exact}}(x,y)$ 的偏导数可得：\n$$\nf(x,y) = 2\\pi^2 k(x,y) \\sin(\\pi x)\\sin(\\pi y) - \\pi \\frac{\\partial k}{\\partial x} \\cos(\\pi x)\\sin(\\pi y) - \\pi \\frac{\\partial k}{\\partial y} \\sin(\\pi x)\\cos(\\pi y)\n$$\n\n### 2. 有限差分离散化\n区域 $\\Omega$ 使用均匀笛卡尔网格进行离散化，节点为 $(x_i, y_j)$，其中 $x_i = i h_x$（对于 $i=0, \\dots, N_x+1$）和 $y_j = j h_y$（对于 $j=0, \\dots, N_y+1$）。网格间距为 $h_x = 1/(N_x+1)$ 和 $h_y = 1/(N_y+1)$。未知量是 $N_x \\times N_y$ 个内部节点上的 $u$ 值。\n\nPDE 使用基于控制体方法的保守有限差分格式进行离散化。将 PDE 在以内部节点 $(x_i, y_j)$ 为中心的控制体 $\\Omega_{i,j}$ 上积分，并应用散度定理，我们得到：\n$$\n- \\oint_{\\partial\\Omega_{i,j}} (k \\nabla u) \\cdot \\vec{n} \\,ds = \\iint_{\\Omega_{i,j}} f \\,dA \\approx f(x_i,y_j) h_x h_y\n$$\n左侧的通量积分通过对控制体四个面上的通量求和来近似。穿过 $x = x_{i+1/2}$ 处面的通量使用梯度的中心差分和传导系数的特定平均值来近似。问题指定了一种对称的两点通量近似法，其中面传导系数采用调和平均：\n$$\n-k(x_{i+1/2}, y_j) \\frac{u(x_{i+1},y_j) - u(x_i,y_j)}{h_x} h_y\n$$\n面传导系数 $k_{i+1/2,j} = k(x_{i+1/2},y_j)$ 由相邻节点传导系数的调和平均值近似：\n$$\nk_{i+1/2, j} \\approx \\frac{2 k(x_i,y_j) k(x_{i+1},y_j)}{k(x_i,y_j) + k(x_{i+1},y_j)}\n$$\n这一选择对于精确建模非均匀介质中的通量至关重要。将此近似应用于所有四个面，并除以控制体面积 $h_x h_y$，得到节点 $(i,j)$ 处的离散方程：\n$$\n-\\frac{1}{h_x^2} \\left[ k_{i+1/2, j} (u_{i+1,j} - u_{i,j}) - k_{i-1/2, j} (u_{i,j} - u_{i-1,j}) \\right] - \\frac{1}{h_y^2} \\left[ k_{i, j+1/2} (u_{i,j+1} - u_{i,j}) - k_{i, j-1/2} (u_{i,j} - u_{i,j-1}) \\right] = f_{i,j}\n$$\n该格式产生一个5点模板，对于光滑解和光滑系数具有二阶精度。\n\n### 3. 线性系统构建\n重新整理离散方程，将与每个节点未知数 $u_{i,j}$ 相关的项收集起来。这会产生一个形式为 $A\\vec{U} = \\vec{b}$ 的大型稀疏线性方程组，其中 $\\vec{U}$ 是 $N=N_x N_y$ 个未知内部节点值的向量。\n矩阵 $A$ 是一个 $N \\times N$ 的稀疏矩阵。对于未知量按行主序 $k=(j-1)N_x + (i-1)$ 排列，该矩阵具有五条非零对角线的块三对角结构。节点 $(i,j)$ 处方程的对角线元素为：\n$$\nA_{k,k} = \\frac{k_{i+1/2, j} + k_{i-1/2, j}}{h_x^2} + \\frac{k_{i, j+1/2} + k_{i, j-1/2}}{h_y^2}\n$$\n对应于相邻节点的非对角线元素为：\n$$\nA_{k,k-1} = -\\frac{k_{i-1/2, j}}{h_x^2}, \\quad A_{k,k+1} = -\\frac{k_{i+1/2, j}}{h_x^2}, \\quad A_{k,k-N_x} = -\\frac{k_{i,j-1/2}}{h_y^2}, \\quad A_{k,k+N_x} = -\\frac{k_{i,j+1/2}}{h_y^2}\n$$\n矩阵 $A$ 是对称正定的，这保证了唯一解的存在。\n右端向量 $\\vec{b}$ 包含源项 $f_{i,j}$ 和来自狄利克雷边界条件的贡献。对于一个邻近边界的内部节点 $(i,j)$（例如，在 $i=1$ 处），涉及已知边界值 $u_{0,j} = g(x_0, y_j)$ 的项被移到右侧。例如，项 $-A_{k,k-1}u_{0,j}$ 变为 $+\\frac{k_{1/2,j}}{h_x^2}u_{0,j}$ 并加到 $b_k$ 上。最终得到的线性系统按要求使用稀疏直接求解器求解。\n\n### 4. 误差分析与收敛率\n在求解出内部节点上的数值解 $u_h$ 后，通过包含已知的边界值将解扩展到整个网格。误差在所有节点上计算为数值解与精确解之差，$e_{i,j} = u_h(x_i,y_j) - u_{\\text{exact}}(x_i,y_j)$。误差的大小通过两种离散范数来量化：\n- 离散 $L_2$-范数： $\\|e\\|_{2,h} = \\left( h_x h_y \\sum_{i=0}^{N_x+1}\\sum_{j=0}^{N_y+1} e_{i,j}^2 \\right)^{1/2}$\n- 离散 $L_{\\infty}$-范数（最大误差）： $\\|e\\|_{\\infty} = \\max_{0\\le i\\le N_x+1,\\,0\\le j\\le N_y+1} |e_{i,j}|$\n\n对于一个精度阶为 $p$ 的方法，误差预计表现为 $\\|e\\| \\approx C h^p$，其中 $C$ 是某个常数，$h = \\max(h_x, h_y)$ 是特征网格尺寸。为了估计 $p$，我们对这个关系式取自然对数：\n$$\n\\ln(\\|e\\|) \\approx \\ln(C) + p \\ln(h)\n$$\n这表明 $\\ln(\\|e\\|)$ 与 $\\ln(h)$ 之间存在线性关系。通过在一系列连续细化的网格上计算误差，我们得到一组数据点 $(\\ln(h_k), \\ln(\\|e\\|_k))$。观测到的精度阶 $p$ 被估计为使用最小二乘法拟合这些点的直线的斜率。对于每个测试用例，我们从 $L_2$-范数数据计算 $p_2$，从 $L_{\\infty}$-范数数据计算 $p_{\\infty}$。", "answer": "```python\nimport numpy as np\nimport scipy\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    test_cases = {\n        'A': {\n            'grids': [(16, 16), (32, 32), (64, 64), (128, 128)],\n        },\n        'B': {\n            'grids': [(16, 16), (32, 32), (64, 64), (128, 128)],\n        },\n        'C': {\n            'grids': [(12, 24), (24, 48), (48, 96), (96, 192)],\n        },\n    }\n\n    results = []\n    \n    for case_id in ['A', 'B', 'C']:\n        grids = test_cases[case_id]['grids']\n        p2, pinf = compute_convergence_rates(case_id, grids)\n        results.extend([round(p2, 3), round(pinf, 3)])\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef get_problem_functions(case_id):\n    \"\"\"\n    Returns the conductivity, exact solution, and source term functions for a given case.\n    \"\"\"\n    pi = np.pi\n    if case_id == 'A':\n        k = lambda x, y: 1 + x + y\n        kx = lambda x, y: 1.0 + 0 * x  # Use 0*x to handle array inputs\n        ky = lambda x, y: 1.0 + 0 * y\n    elif case_id == 'B':\n        k = lambda x, y: np.exp(x + y)\n        kx = lambda x, y: np.exp(x + y)\n        ky = lambda x, y: np.exp(x + y)\n    elif case_id == 'C':\n        k = lambda x, y: 1 + 0.5 * np.sin(5*pi*x) * np.sin(5*pi*y)\n        kx = lambda x, y: 0.5 * 5*pi * np.cos(5*pi*x) * np.sin(5*pi*y)\n        ky = lambda x, y: 0.5 * 5*pi * np.sin(5*pi*x) * np.cos(5*pi*y)\n    \n    u_exact = lambda x, y: np.sin(pi*x) * np.sin(pi*y)\n    \n    f_source = lambda x, y: (2 * pi**2 * k(x, y) * np.sin(pi*x) * np.sin(pi*y) -\n                           pi * kx(x, y) * np.cos(pi*x) * np.sin(pi*y) -\n                           pi * ky(x, y) * np.sin(pi*x) * np.cos(pi*y))\n\n    return k, u_exact, f_source\n\ndef harmonic_mean(k1, k2):\n    \"\"\"Computes the harmonic mean of two values.\"\"\"\n    return 2 * k1 * k2 / (k1 + k2)\n\ndef compute_convergence_rates(case_id, grid_resolutions):\n    \"\"\"\n    Performs the grid convergence study for a single test case.\n    \"\"\"\n    k_func, u_exact_func, f_func = get_problem_functions(case_id)\n    \n    h_vals, e2_norms, einf_norms = [], [], []\n\n    for Nx, Ny in grid_resolutions:\n        hx = 1.0 / (Nx + 1)\n        hy = 1.0 / (Ny + 1)\n        h_vals.append(max(hx, hy))\n\n        # Set up grid and evaluate functions\n        x_nodes = np.linspace(0, 1, Nx + 2)\n        y_nodes = np.linspace(0, 1, Ny + 2)\n        xv, yv = np.meshgrid(x_nodes, y_nodes, indexing='xy')\n\n        u_exact_grid = u_exact_func(xv, yv)\n        k_grid = k_func(xv, yv)\n        \n        # Assemble linear system\n        num_unknowns = Nx * Ny\n        A = lil_matrix((num_unknowns, num_unknowns))\n        b = np.zeros(num_unknowns)\n\n        for j in range(1, Ny + 1):\n            for i in range(1, Nx + 1):\n                idx = (j - 1) * Nx + (i - 1)\n                b[idx] = f_func(x_nodes[i], y_nodes[j])\n                \n                # West face\n                k_W = harmonic_mean(k_grid[j, i], k_grid[j, i-1])\n                c_W = k_W / hx**2\n                if i == 1:\n                    b[idx] += c_W * u_exact_grid[j, 0]\n                else:\n                    A[idx, idx - 1] = -c_W\n                \n                # East face\n                k_E = harmonic_mean(k_grid[j, i], k_grid[j, i+1])\n                c_E = k_E / hx**2\n                if i == Nx:\n                    b[idx] += c_E * u_exact_grid[j, Nx+1]\n                else:\n                    A[idx, idx + 1] = -c_E\n                    \n                # South face\n                k_S = harmonic_mean(k_grid[j, i], k_grid[j-1, i])\n                c_S = k_S / hy**2\n                if j == 1:\n                    b[idx] += c_S * u_exact_grid[0, i]\n                else:\n                    A[idx, idx - Nx] = -c_S\n\n                # North face\n                k_N = harmonic_mean(k_grid[j, i], k_grid[j+1, i])\n                c_N = k_N / hy**2\n                if j == Ny:\n                    b[idx] += c_N * u_exact_grid[Ny+1, i]\n                else:\n                    A[idx, idx + Nx] = -c_N\n\n                A[idx, idx] = c_W + c_E + c_S + c_N\n        \n        # Solve system and reconstruct solution\n        u_interior = spsolve(A.tocsc(), b)\n        u_h = np.copy(u_exact_grid)\n        u_h[1:-1, 1:-1] = u_interior.reshape((Ny, Nx))\n        \n        # Compute and store errors\n        error_grid = u_h - u_exact_grid\n        einf_norms.append(np.max(np.abs(error_grid)))\n        e2_norms.append(np.sqrt(hx * hy * np.sum(error_grid**2)))\n    \n    # Calculate convergence rates via linear regression on log-log data\n    log_h = np.log(np.array(h_vals))\n    p2, _ = np.polyfit(log_h, np.log(np.array(e2_norms)), 1)\n    pinf, _ = np.polyfit(log_h, np.log(np.array(einf_norms)), 1)\n    \n    return p2, pinf\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3592062"}, {"introduction": "在波动方程的数值模拟中，一个核心挑战是数值频散，即不同频率的波以错误的相速度传播，导致波形失真。本练习将深入探讨这一现象，通过推导一个关键的渐近关系，揭示网格分辨率、差分格式阶数和相速度误差之间的联系。这个过程将帮助您从第一性原理理解和量化在波传播模拟中保证精度的“每波长采样点数”这一实用准则。[@problem_id:3592024]", "problem": "考虑在一维无限均匀网格上的一维常系数声波方程 $\\,\\partial_{t}^{2} u(x,t) = c^{2}\\,\\partial_{x}^{2} u(x,t)\\,$，网格间距为 $\\,h\\,$。空间二阶导数由结构化网格上的一个中心、$2p\\,$阶有限差分格式近似。令 $\\,\\theta = k h\\,$ 表示无量纲波数，其中 $\\,k\\,$ 是连续波数，并令 $\\,\\widehat{L}(\\theta)\\,$ 为半离散二阶导数算子的傅里叶符号。定义修正波数 $\\,\\widetilde{k}(\\theta)\\,$ 为 $\\, -\\widehat{L}(\\theta) = \\widetilde{k}(\\theta)^{2}\\,$。对于一个 $\\,2p\\,$阶精度的中心二阶导数格式，在 $\\,\\theta=0\\,$ 附近的泰勒展开意味着\n$$\n\\widetilde{k}(\\theta)^{2} = k^{2}\\,\\Big(1 - C_{2p}\\,\\theta^{2p} + \\mathcal{O}(\\theta^{2p+2})\\Big),\n$$\n其中 $\\,C_{2p} > 0\\,$ 是一个仅取决于格式阶数 $\\,2p\\,$ 的常数。\n\n平面波拟设 $\\,u(x,t) = \\exp\\!\\big(i(k x - \\omega t)\\big)\\,$ 满足半离散色散关系 $\\,\\omega^{2} = c^{2}\\,\\widetilde{k}(\\theta)^{2}\\,$，该关系导出相速度 $\\,v_{p} = \\omega/k\\,$。将相位误差定义为相速度与连续波速 $\\,c\\,$ 的相对偏差，即 $\\,E_{p}(\\theta) = \\big|v_{p}/c - 1\\big|\\,$。\n\n仅使用所述基础和小 $\\,\\theta\\,$ 下的渐近一致性，推导出一个闭式渐近表达式，用于表示为确保 $\\,E_{p}(\\theta) \\le \\varepsilon\\,$ 所需的每波长最小网格点数 $\\,n_{\\lambda}\\,$，该表达式对小 $\\,\\varepsilon\\,$ 取主导阶。此处，每波長点数定义为 $\\,n_{\\lambda} = 2\\pi/\\theta\\,$。请将最终答案表示为关于 $\\,p\\,$、$\\,\\varepsilon\\,$ 和 $\\,C_{2p}\\,$ 的单个解析表达式。无需进行数值代入。最终答案必须是单个表达式，且不得包含任何不等式或单位。", "solution": "首先评估问题的有效性。\n\n### 第一步：提取已知条件\n- **控制方程**：一维常系数声波方程，$\\partial_{t}^{2} u(x,t) = c^{2}\\,\\partial_{x}^{2} u(x,t)$。\n- **离散化**：间距为 $h$ 的无限均匀网格。空间二阶导数由一个中心、$2p$ 阶有限差分格式近似。\n- **无量纲波数**：$\\theta = k h$，其中 $k$ 是连续波数。\n- **傅里叶符号和修正波数**：半离散二阶导数算子的傅里叶符号为 $\\widehat{L}(\\theta)$。修正波数 $\\widetilde{k}(\\theta)$ 由 $-\\widehat{L}(\\theta) = \\widetilde{k}(\\theta)^{2}$ 定义。\n- **渐近形式**：对于小 $\\theta$，修正波数的平方有展开式 $\\widetilde{k}(\\theta)^{2} = k^{2}\\,\\Big(1 - C_{2p}\\,\\theta^{2p} + \\mathcal{O}(\\theta^{2p+2})\\Big)$，其中 $C_{2p} > 0$。\n- **色散关系**：平面波拟设导致半离散色散关系 $\\omega^{2} = c^{2}\\,\\widetilde{k}(\\theta)^{2}$。\n- **相速度和误差**：相速度为 $v_{p} = \\omega/k$。相位误差定义为 $E_{p}(\\theta) = \\big|v_{p}/c - 1\\big|$。\n- **约束条件**：相位误差必须满足 $E_{p}(\\theta) \\le \\varepsilon$。\n- **每波长点数**：定义为 $n_{\\lambda} = 2\\pi/\\theta$。\n- **目标**：为满足误差约束所需的每波长最小网格点数 $n_{\\lambda}$ 推导一个闭式渐近表达式。该表达式必须是对小 $\\varepsilon$ 的主导阶，并用 $p$、$\\varepsilon$ 和 $C_{2p}$ 表示。\n\n### 第二步：使用提取的已知条件进行验证\n问题陈述具有科学依据，是适定的、客观的。它概述了有限差分法的标准数值色散分析，这是计算科学与工程中的一个基本课题。所有术语都有明确定义，前提与既有理论一致。该问题可被形式化，且包含推导唯一解所需的充分信息。它没有违反任何科学原理，不基于错误的前提，也没有歧义。\n\n### 第三步：结论与行动\n问题有效。将推导解答。\n\n### 解答推导\n目标是找到每波长的最小网格点数 $n_{\\lambda}$，使得相位误差 $E_{p}(\\theta)$ 不超过指定的容差 $\\varepsilon$。每波长点数 $n_{\\lambda}$ 与无量纲波数 $\\theta$ 通过关系 $n_{\\lambda} = 2\\pi/\\theta$ 成反比。因此，找到最小的 $n_{\\lambda}$ 等价于找到允许的最大 $\\theta$。\n\n我们从半离散色散关系开始：\n$$\n\\omega^{2} = c^{2}\\,\\widetilde{k}(\\theta)^{2}\n$$\n代入给定的 $\\widetilde{k}(\\theta)^{2}$ 的渐近表达式：\n$$\n\\omega^{2} = c^{2}\\,k^{2}\\,\\Big(1 - C_{2p}\\,\\theta^{2p} + \\mathcal{O}(\\theta^{2p+2})\\Big)\n$$\n为了求出相速度 $v_p = \\omega/k$，我们首先解出角频率 $\\omega$。取正平方根（因为频率是非负的）：\n$$\n\\omega = c k \\sqrt{1 - C_{2p}\\,\\theta^{2p} + \\mathcal{O}(\\theta^{2p+2})}\n$$\n那么，数值相速度为：\n$$\nv_{p}(\\theta) = \\frac{\\omega}{k} = c \\sqrt{1 - C_{2p}\\,\\theta^{2p} + \\mathcal{O}(\\theta^{2p+2})}\n$$\n接下来，我们计算数值相速度与真实波速 $c$ 的比值：\n$$\n\\frac{v_{p}(\\theta)}{c} = \\sqrt{1 - C_{2p}\\,\\theta^{2p} + \\mathcal{O}(\\theta^{2p+2})}\n$$\n问题要求对小 $\\varepsilon$ 进行分析，这意味着与真实速度的偏差很小。这对应于 $\\theta$ 很小的情形。因此，我们可以对平方根函数使用泰勒级数展开，$\\sqrt{1+x} \\approx 1 + \\frac{1}{2}x$（对于小 $x$）。令 $x = - C_{2p}\\,\\theta^{2p}$。对于小 $\\theta$，此项很小。\n$$\n\\frac{v_{p}(\\theta)}{c} \\approx 1 - \\frac{1}{2} C_{2p}\\,\\theta^{2p}\n$$\n相位误差 $E_{p}(\\theta)$ 定义为 $E_{p}(\\theta) = |v_{p}/c - 1|$。使用上面推导的主导阶近似：\n$$\nE_{p}(\\theta) = \\left| \\left(1 - \\frac{1}{2} C_{2p}\\,\\theta^{2p}\\right) - 1 \\right| = \\left| -\\frac{1}{2} C_{2p}\\,\\theta^{2p} \\right|\n$$\n因为给定 $C_{2p} > 0$，所以对于 $\\theta > 0$，绝对值内的表达式为负。因此，在主导阶上：\n$$\nE_{p}(\\theta) \\approx \\frac{1}{2} C_{2p}\\,\\theta^{2p}\n$$\n现在，我们施加误差约束 $E_{p}(\\theta) \\le \\varepsilon$。为了找到最小的 $n_{\\lambda}$，我们必须找到允许的最大 $\\theta$，这将在该不等式的边界上发生：\n$$\n\\frac{1}{2} C_{2p}\\,\\theta^{2p} = \\varepsilon\n$$\n我们求解这个方程以得到 $\\theta$：\n$$\n\\theta^{2p} = \\frac{2\\varepsilon}{C_{2p}}\n$$\n$$\n\\theta = \\left(\\frac{2\\varepsilon}{C_{2p}}\\right)^{\\frac{1}{2p}}\n$$\n这个 $\\theta$ 值代表了相位误差约为 $\\varepsilon$ 时的最大无量纲波数。\n最后，我们将这个 $\\theta$ 的表达式代入每波长网格点数的定义 $n_{\\lambda} = 2\\pi/\\theta$ 中，以找到所需的最小 $n_{\\lambda}$ 值：\n$$\nn_{\\lambda} = \\frac{2\\pi}{\\left(\\frac{2\\varepsilon}{C_{2p}}\\right)^{\\frac{1}{2p}}}\n$$\n通过将分母中的项取倒数来简化表达式：\n$$\nn_{\\lambda} = 2\\pi \\left(\\frac{C_{2p}}{2\\varepsilon}\\right)^{\\frac{1}{2p}}\n$$\n这就是确保相位误差不超过 $\\varepsilon$ 所需的每波长最小网格点数的闭式渐近表达式，对小 $\\varepsilon$ 在主导阶上有效。该表达式取决于格式阶数参数 $p$、误差容差 $\\varepsilon$和与格式相关的常数 $C_{2p}$，符合要求。", "answer": "$$\n\\boxed{2\\pi \\left(\\frac{C_{2p}}{2\\varepsilon}\\right)^{\\frac{1}{2p}}}\n$$", "id": "3592024"}]}