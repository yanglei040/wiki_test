{"hands_on_practices": [{"introduction": "在运行任何数值模拟之前，我们必须确保其稳定性。对于交错网格法这样的显式格式，这意味着遵守Courant-Friedrichs-Lewy (CFL) 条件，该条件将物理波速与网格间距和时间步长联系起来。这项基础性练习将引导您通过冯·诺依曼稳定性分析，推导出二维声学方程格式的精确稳定性极限，这是任何计算建模者都必须掌握的关键技能。", "problem": "考虑二维空间中的常系数声学系统，\n$$\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\kappa\\, \\nabla \\cdot \\boldsymbol{v}, \n\\qquad\n\\rho\\,\\frac{\\partial \\boldsymbol{v}}{\\partial t} \\;=\\; -\\nabla p,\n$$\n其中 $p$ 是压力，$\\boldsymbol{v}=(v_{x},v_{y})$ 是质点速度，$\\rho$ 是密度，$\\kappa$ 是体积模量，波速为 $c=\\sqrt{\\kappa/\\rho}$。使用标准的交错网格排列，在间距为 $h$ 的均匀方形网格上对空间进行离散化：$p$ 位于单元中心 $(i h,j h)$，$v_{x}$ 位于 $( (i+\\tfrac{1}{2}) h, j h)$，$v_{y}$ 位于 $( i h, (j+\\tfrac{1}{2}) h)$。使用蛙跳格式对时间进行交错离散：$p$ 位于整数时间 $t^{n}=n\\,\\Delta t$，速度位于半整数时间 $t^{n+\\tfrac{1}{2}}=(n+\\tfrac{1}{2})\\,\\Delta t$。对空间梯度和散度使用二阶中心有限差分：\n$$\nD_{x} p\\big|_{i+\\tfrac{1}{2},j} \\;=\\; \\frac{p_{i+1,j}-p_{i,j}}{h}, \n\\qquad\nD_{y} p\\big|_{i,j+\\tfrac{1}{2}} \\;=\\; \\frac{p_{i,j+1}-p_{i,j}}{h},\n$$\n$$\nD_{x}^{*} v_{x}\\big|_{i,j} \\;=\\; \\frac{v_{x,i+\\tfrac{1}{2},j}-v_{x,i-\\tfrac{1}{2},j}}{h}, \n\\qquad\nD_{y}^{*} v_{y}\\big|_{i,j} \\;=\\; \\frac{v_{y,i,j+\\tfrac{1}{2}}-v_{y,i,j-\\tfrac{1}{2}}}{h}.\n$$\n时间步进格式为\n$$\nv_{x}^{n+\\tfrac{1}{2}} \\;=\\; v_{x}^{n-\\tfrac{1}{2}} \\;-\\; \\frac{\\Delta t}{\\rho}\\, D_{x} p^{n}, \n\\qquad\nv_{y}^{n+\\tfrac{1}{2}} \\;=\\; v_{y}^{n-\\tfrac{1}{2}} \\;-\\; \\frac{\\Delta t}{\\rho}\\, D_{y} p^{n},\n$$\n$$\np^{n+1} \\;=\\; p^{n} \\;-\\; \\kappa\\, \\Delta t \\left( D_{x}^{*} v_{x}^{n+\\tfrac{1}{2}} + D_{y}^{*} v_{y}^{n+\\tfrac{1}{2}} \\right).\n$$\n通过在空间上代入形式为 $\\exp\\!\\big(i(k_{x} i h + k_{y} j h)\\big)$、在时间上代入形式为 $\\exp\\!\\big(i\\omega n \\Delta t\\big)$ 的平面波解，并假设周期性，进行 von Neumann (傅里叶) 稳定性分析。推导保证对所有空间波数都稳定的 Courant-Friedrichs-Lewy (CFL) 条件 $C=\\dfrac{c_{\\max}\\,\\Delta t}{h} \\le C_{\\text{crit}}$，并为上述交错网格上的二阶空间差分显式计算 $C_{\\text{crit}}$。将 $C_{\\text{crit}}$ 的最终值表示为一个无单位的精确实数。", "solution": "该问题陈述是波传播有限差分格式数值分析中的一个标准练习，并且是有效的。它具有科学依据，是适定的、客观的，并提供了推导稳定性条件所需的所有必要信息。\n\n我们开始对给定的二阶交错网格有限差分格式进行 von Neumann 稳定性分析。该格式离散化了二维声波方程：\n$$\n\\frac{\\partial p}{\\partial t} = -\\kappa \\left( \\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y} \\right)\n$$\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = -\\frac{\\partial p}{\\partial x}, \\qquad \\rho \\frac{\\partial v_y}{\\partial t} = -\\frac{\\partial p}{\\partial y}\n$$\n该分析涉及将平面波解（傅里叶模式）代入离散化方程，并确定这些模式的振幅不随时间增长的条件。\n\n我们假设在交错网格上，压力 $p$ 和速度分量 $v_x, v_y$ 具有周期性平面波解。每个变量的试探解在其各自的网格位置和时间层级上定义如下：\n$$\np_{i,j}^{n} = \\hat{p}(t^n) \\, \\exp\\big( i(k_x i h + k_y j h) \\big)\n$$\n$$\nv_{x, i+\\frac{1}{2}, j}^{n \\pm \\frac{1}{2}} = \\hat{v}_x(t^{n \\pm \\frac{1}{2}}) \\, \\exp\\big( i(k_x (i+\\tfrac{1}{2}) h + k_y j h) \\big)\n$$\n$$\nv_{y, i, j+\\frac{1}{2}}^{n \\pm \\frac{1}{2}} = \\hat{v}_y(t^{n \\pm \\frac{1}{2}}) \\, \\exp\\big( i(k_x i h + k_y (j+\\tfrac{1}{2}) h) \\big)\n$$\n其中 $\\hat{p}$、$\\hat{v}_x$ 和 $\\hat{v}_y$ 是随时间变化的傅里叶振幅，$k_x$ 和 $k_y$ 是空间波数，$i, j, n$ 是空间和时间的整数索引。\n\n接下来，我们将有限差分算子转换为其傅里叶空间表示。对于作用在位置 $(i+\\frac{1}{2},j)$ 处 $p$ 上的梯度算子 $D_x$：\n$$\nD_x p_{i+\\frac{1}{2},j}^n = \\frac{p_{i+1,j}^n - p_{i,j}^n}{h} = \\frac{\\hat{p}^n}{h} \\left[ \\exp\\big(i(k_x(i+1)h + k_y j h)\\big) - \\exp\\big(i(k_x i h + k_y j h)\\big) \\right]\n$$\n在目标位置 $(i+\\frac{1}{2},j)$ 处提出平面波项，得到：\n$$\nD_x p_{i+\\frac{1}{2},j}^n = \\frac{\\hat{p}^n}{h} \\exp\\big(i(k_x(i+\\tfrac{1}{2})h + k_y j h)\\big) \\left[ \\exp\\big(i\\frac{k_x h}{2}\\big) - \\exp\\big(-i\\frac{k_x h}{2}\\big) \\right] = \\hat{p}^n \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\exp(\\dots)\n$$\n类似地，对于其他算子：\n$$\nD_y p_{i,j+\\frac{1}{2}}^n \\rightarrow \\hat{p}^n \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right)\n$$\n$$\nD_x^* v_{x,i,j}^{n+\\frac{1}{2}} = \\frac{v_{x,i+\\frac{1}{2},j}^{n+\\frac{1}{2}} - v_{x,i-\\frac{1}{2},j}^{n+\\frac{1}{2}}}{h} \\rightarrow \\hat{v}_x^{n+\\frac{1}{2}} \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right)\n$$\n$$\nD_y^* v_{y,i,j}^{n+\\frac{1}{2}} = \\frac{v_{y,i,j+\\frac{1}{2}}^{n+\\frac{1}{2}} - v_{y,i,j-\\frac{1}{2}}^{n+\\frac{1}{2}}}{h} \\rightarrow \\hat{v}_y^{n+\\frac{1}{2}} \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right)\n$$\n将这些代入时间步进格式，得到一个关于傅里叶振幅的方程组：\n$$\n\\hat{v}_x^{n+\\frac{1}{2}} = \\hat{v}_x^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\right) \\hat{p}^n\n$$\n$$\n\\hat{v}_y^{n+\\frac{1}{2}} = \\hat{v}_y^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\right) \\hat{p}^n\n$$\n$$\n\\hat{p}^{n+1} = \\hat{p}^n - \\kappa \\Delta t \\left[ \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\right) \\hat{v}_x^{n+\\frac{1}{2}} + \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\right) \\hat{v}_y^{n+\\frac{1}{2}} \\right]\n$$\n为了得到关于压力的单一递推关系，我们首先表示两个连续时间步的压力更新：\n$$\n\\hat{p}^{n+1} - \\hat{p}^n = - \\kappa \\Delta t \\left[ \\dots \\hat{v}_x^{n+\\frac{1}{2}} + \\dots \\hat{v}_y^{n+\\frac{1}{2}} \\right]\n$$\n$$\n\\hat{p}^n - \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\dots \\hat{v}_x^{n-\\frac{1}{2}} + \\dots \\hat{v}_y^{n-\\frac{1}{2}} \\right]\n$$\n用第一个方程减去第二个方程，得到压力的中心二阶时间导数：\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) (\\hat{v}_x^{n+\\frac{1}{2}}-\\hat{v}_x^{n-\\frac{1}{2}}) + \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) (\\hat{v}_y^{n+\\frac{1}{2}}-\\hat{v}_y^{n-\\frac{1}{2}}) \\right]\n$$\n我们从速度更新方程中代入 $(\\hat{v}^{n+\\frac{1}{2}}-\\hat{v}^{n-\\frac{1}{2}})$ 的表达式：\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\left(-\\frac{\\Delta t}{\\rho} \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\hat{p}^n\\right) + \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\left(-\\frac{\\Delta t}{\\rho} \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\hat{p}^n\\right) \\right]\n$$\n简化此表达式，我们使用 $i^2 = -1$ 和波速的定义 $c^2=\\kappa/\\rho$：\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = -\\frac{\\kappa \\Delta t^2}{\\rho} \\frac{4}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\hat{p}^n\n$$\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = -4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\hat{p}^n\n$$\n设增长因子为 $g$，使得 $\\hat{p}^n = g^n \\hat{p}^0$。代入后得到关于 $g$ 的二次特征方程：\n$$\ng^2 - 2g + 1 = -4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] g\n$$\n$$\ng^2 - \\left(2 - A\\right)g + 1 = 0\n$$\n其中项 $A$ 定义为：\n$$\nA = 4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right]\n$$\n对于蛙跳格式，稳定性条件 $|g| \\le 1$ 要求此二次方程的根位于复平面的单位圆上，即 $|g|=1$。这在二次方程的判别式为非正数时发生：\n$$\n(2-A)^2 - 4 \\le 0 \\implies (2-A)^2 \\le 4\n$$\n开平方根得到 $-2 \\le 2-A \\le 2$。这蕴含两个条件：\n1. $2-A \\le 2 \\implies A \\ge 0$。由于 $A$ 是平方和，这个条件总是满足的。\n2. $2-A \\ge -2 \\implies 4 \\ge A$。这是稳定性约束条件。\n\n将 $A$ 的表达式代入稳定性约束条件：\n$$\n4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\le 4\n$$\n$$\n\\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\le 1\n$$\n这个条件必须对所有可能的波数 $k_x$ 和 $k_y$ 都成立。为了找到最严格的条件（Courant-Friedrichs-Lewy 条件），我们必须最大化方括号中的项。$\\sin^2(\\theta)$ 的最大值是 $1$。这发生在网格能解析的最高频率模式下，此时 $k_x h = \\pi$ 和 $k_y h = \\pi$。\n$$\n\\max_{k_x, k_y} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] = \\sin^2\\left(\\frac{\\pi}{2}\\right) + \\sin^2\\left(\\frac{\\pi}{2}\\right) = 1^2 + 1^2 = 2\n$$\n将此最大值代入不等式，得到稳定性极限：\n$$\n\\frac{c^2 \\Delta t^2}{h^2} (2) \\le 1 \\implies \\left(\\frac{c \\Delta t}{h}\\right)^2 \\le \\frac{1}{2}\n$$\n对两边取平方根，我们得到二维格式的 CFL 条件：\n$$\n\\frac{c \\Delta t}{h} \\le \\frac{1}{\\sqrt{2}}\n$$\n问题陈述将 Courant 数定义为 $C = \\frac{c_{\\max}\\,\\Delta t}{h}$。在这个常系数情况下，$c_{\\max} = c$。临界 Courant 数 $C_{\\text{crit}}$ 是格式保持稳定时的最大值。因此：\n$$\nC_{\\text{crit}} = \\frac{1}{\\sqrt{2}}\n$$", "answer": "$$\\boxed{\\frac{1}{\\sqrt{2}}}$$", "id": "3615279"}, {"introduction": "现实世界中的地球物理模型很少是均匀的；它们包含材料属性（如密度）发生突变的界面。如何在交错网格上表示这些不连续性，对于模拟的准确性和物理保真度至关重要。本练习挑战您从有限体积的角度出发，确定在界面处进行密度平均的正确方法，从而超越简单的公式应用，进行更深层次的物理推理。", "problem": "考虑描述非均匀流体的一维线性化声学方程，其基态密度 $\\,\\rho(x)\\,$ 和体积模量 $\\,K(x)\\,$ 是分段常数，\n$$\n\\rho(x)\\,\\frac{\\partial v}{\\partial t} \\;=\\; -\\,\\frac{\\partial p}{\\partial x}, \n\\qquad\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\,K(x)\\,\\frac{\\partial v}{\\partial x},\n$$\n方程定义在间距为 $\\,\\Delta x\\,$ 的均匀网格上，采用标准的交错排列：压力 $\\,p_i(t)\\,$ 位于网格中心 $\\,x_i\\,$，速度 $\\,v_{i+\\tfrac{1}{2}}(t)\\,$ 位于网格面 $\\,x_{i+\\tfrac{1}{2}}\\,$。假设 $\\,\\rho(x)\\,$ 在一个界面上存在跳跃间断，该界面恰好位于网格面 $\\,x_{i+\\tfrac{1}{2}}\\,$ 处，其左右极限值分别为 $\\,\\rho_L\\,$ 和 $\\,\\rho_R\\,$。在有限体积半离散化中，当更新 $\\,v_{i+\\tfrac{1}{2}}\\,$ 时，你需要确定在交错网格面上使用的一致性系数。\n\n从写在附于网格面 $\\,x_{i+\\tfrac{1}{2}}\\,$ 的对偶控制体上的积分形式动量平衡方程出发，也即总长度为 $\\,\\Delta x\\,$ 的两个半网格 $[x_i,x_{i+\\tfrac{1}{2}}]$ 和 $[x_{i+\\tfrac{1}{2}},x_{i+1}]$ 的并集，推导在更新 $\\,v_{i+\\tfrac{1}{2}}\\,$ 时乘以离散压力差的恰当面系数。你的选择必须满足以下所有要求：\n- 它源于动量的控制体（有限体积）表述，其中 $\\,v_{i+\\tfrac{1}{2}}\\,$ 被解释为对偶控制体上的分段常数速度。\n- 当 $\\,\\rho_L \\to \\infty\\,$ 或 $\\,\\rho_R \\to \\infty\\,$ 时，它能得出正确的极限行为（在任意一侧的刚性极限下，面速度的加速度应为零）。\n- 在给定的交错离散下，对于光滑的 $\\,\\rho(x)\\,$，它与二阶精度相一致。\n\n当用于半离散更新\n$$\n\\frac{\\mathrm{d} v_{i+\\tfrac{1}{2}}}{\\mathrm{d} t} \\;=\\; -\\,\\Big(\\text{在 }x_{i+\\tfrac{1}{2}}\\text{ 处的面系数}\\Big)\\,\\frac{p_{i+1}-p_i}{\\Delta x}\\,?\n$$\n时，以下哪种面系数的规定与这些要求一致？\n\nA. 在网格面上使用密度的算术平均值，即 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{\\rho_L+\\rho_R}{2}\\,$，并将面系数设为 $\\,1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,$。\n\nB. 在网格面上使用密度的调和平均值，即 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{2}{\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R}}\\,$，并将面系数设为 $\\,1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$。\n\nC. 在网格面上使用密度倒数的算术平均值，即 $\\,\\left(\\dfrac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{1}{2}\\left(\\dfrac{1}{\\rho_L}+\\dfrac{1}{\\rho_R}\\right)\\,,$ 并直接将面系数设为 $\\,\\left(1/\\rho\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$。\n\nD. 在网格面上使用密度的迎风选择，即如果 $\\,p_{i+1}-p_i>0\\,$ 则选择 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\rho_L\\,$，否则选择 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\rho_R\\,$，并将面系数设为 $\\,1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$。\n\nE. B 和 C 是等价的，并且都满足所述要求，因为它们以不同的代数形式表示了相同的物理平均。\n\n选择唯一的最佳答案。", "solution": "我们从附于 $\\,x_{i+\\tfrac{1}{2}}\\,$ 处速度自由度的对偶控制体的线性动量方程的积分形式开始。令 $\\,V_{i+\\tfrac{1}{2}}\\,$ 表示长度为 $\\,\\Delta x\\,$ 的一维控制体 $[x_i,x_{i+1}]$（在多维情况下，这将是面心六面体；一维推导抓住了本质要点）。动量平衡方程表述为\n$$\n\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\frac{\\partial v}{\\partial t}(x,t)\\,\\mathrm{d}x \\;=\\; - \\int_{x_i}^{x_{i+1}} \\frac{\\partial p}{\\partial x}(x,t)\\,\\mathrm{d}x \\;=\\; -\\Big(p_{i+1}(t)-p_i(t)\\Big).\n$$\n在交错网格上，$\\,v_{i+\\tfrac{1}{2}}(t)\\,$ 代表对偶控制体上的平均速度。在标准的有限体积假设下，即 $\\,v\\,$ 在 $\\,V_{i+\\tfrac{1}{2}}\\,$ 上是分段常数，我们可以将 $\\,\\partial v/\\partial t\\,$ 从左侧积分中提出：\n$$\n\\left(\\frac{\\partial v_{i+\\tfrac{1}{2}}}{\\partial t}\\right)\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\mathrm{d}x \\;=\\; -\\Big(p_{i+1}-p_i\\Big).\n$$\n将有效面质量（在更高维度上为单位面积质量）定义为体积平均\n$$\n\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}} \\;=\\; \\frac{1}{\\Delta x}\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\mathrm{d}x.\n$$\n那么，由有限体积动量平衡导出的半离散速度更新为\n$$\n\\frac{\\mathrm{d} v_{i+\\tfrac{1}{2}}}{\\mathrm{d} t} \\;=\\; -\\,\\frac{1}{\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}}\\,\\frac{p_{i+1}-p_i}{\\Delta x}.\n$$\n当界面位于 $\\,x_{i+\\tfrac{1}{2}}\\,$ 处，分段常数 $\\,\\rho(x)\\,$ 在 $[x_i,x_{i+\\tfrac{1}{2}})$ 上取值为 $\\,\\rho_L\\,$，在 $(x_{i+\\tfrac{1}{2}},x_{i+1}]$ 上取值为 $\\,\\rho_R\\,$ 时，对两个半网格的体积平均给出\n$$\n\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}} \\;=\\; \\frac{1}{\\Delta x}\\left(\\int_{x_i}^{x_{i+\\tfrac{1}{2}}} \\rho_L\\,\\mathrm{d}x + \\int_{x_{i+\\tfrac{1}{2}}}^{x_{i+1}} \\rho_R\\,\\mathrm{d}x\\right) \\;=\\; \\frac{\\rho_L+\\rho_R}{2}.\n$$\n因此，速度更新中的一致性面系数为\n$$\n\\left(\\frac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{FV}} \\;=\\; \\frac{1}{\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}} \\;=\\; \\frac{2}{\\rho_L+\\rho_R}.\n$$\n\n我们现在来验证所述要求。\n\n基于控制体动量平衡的要求。上述推导直接源于对偶控制体上的积分表述，因此它保证了离散压力功 $\\,\\big(p_{i+1}-p_i\\big)\\,v_{i+\\tfrac{1}{2}}\\,$ 等于与质量为 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,$ 的面自由度相关的动能变化率。这是标准的有限体积一致性。\n\n刚性极限检验。考虑 $\\,\\rho_L \\to \\infty\\,$ 且 $\\,\\rho_R\\,$ 固定的极限。物理上，面速度代表附于同一自由度的两个半质量的运动；当一个半质量变得无限重时，共享速度的加速度应该趋于零：$\\,\\mathrm{d} v_{i+\\tfrac{1}{2}}/\\mathrm{d} t \\to 0\\,.$ 对于有限体积的选择，\n$$\n\\left(\\frac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{FV}} \\;=\\; \\frac{2}{\\rho_L+\\rho_R} \\;\\longrightarrow\\; 0 \\quad \\text{as} \\quad \\rho_L \\to \\infty,\n$$\n因此 $\\,\\mathrm{d} v_{i+\\tfrac{1}{2}}/\\mathrm{d} t \\to 0\\,$，符合要求。根据对称性，对于 $\\,\\rho_R \\to \\infty\\,$ 也可得出相同结论。\n\n光滑系数下的二阶精度。如果 $\\,\\rho(x)\\,$ 是光滑的，那么中点法则得出，在 $[x_i,x_{i+1}]$ 上的控制体平均是对 $\\,\\rho(x_{i+\\tfrac{1}{2}})\\,$ 的一个二阶精确近似。因此，当 $\\,\\rho_L=\\rho(x_{i+\\tfrac{1}{2}}-\\tfrac{\\Delta x}{2})\\,$ 和 $\\,\\rho_R=\\rho(x_{i+\\tfrac{1}{2}}+\\tfrac{\\Delta x}{2})\\,$ 时，在均匀网格上 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\rho_L+\\rho_R)/2\\,$ 是一个二阶精确的面值。\n\n我们现在来评估每个选项。\n\n选项 A。该选项规定 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\rho_L+\\rho_R)/2\\,$，即跨越两个半网格的密度的控制体（算术）平均值，并将面系数设为其倒数。这与有限体积推导完全匹配。在刚性极限 $\\,\\rho_L\\to\\infty\\,$ 下，系数 $\\,2/(\\rho_L+\\rho_R)\\to 0\\,$，因此加速度按要求消失。对于光滑的 $\\,\\rho(x)\\,$，跨对称模板的算术平均对于面值是二阶精确的。结论：正确。\n\n选项 B。该选项规定了调和平均密度 $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=2/(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})\\,$，并使用其倒数作为面系数，即 $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\tfrac{1}{2})(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})\\,$。虽然对于形如 $\\,\\partial_x\\!\\big(a\\,\\partial_x u\\big)\\,$ 的扩散通量，调和平均适用于在系数不连续时保证通量连续性，但在这里，当方程写为 $\\,\\rho\\,\\partial_t v=-\\partial_x p\\,$ 时，该系数是乘以时间导数的。在刚性极限 $\\,\\rho_L\\to\\infty\\,$ 下，此选择得出 $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\to (\\tfrac{1}{2})(0+\\tfrac{1}{\\rho_R})=\\tfrac{1}{2\\rho_R}\\,$, 一个非零的加速度，这与正确的物理极限相矛盾。它也无法从控制体动量平衡中得出。结论：不正确。\n\n选项 C。该选项直接规定密度倒数的算术平均值作为面系数，即 $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\tfrac{1}{2})(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})\\,$。这在代数上与选项 B 中的调和平均密度的倒数相同，因此具有相同的缺陷。在刚性极限 $\\,\\rho_L\\to\\infty\\,$ 下，它再次得出 $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\to \\tfrac{1}{2\\rho_R}\\,$，意味着一个非零的加速度，违反了刚性极限要求。它也无法从控制体动量平衡中得出，因为动量平衡是对质量的 $\\,\\rho\\,$ 而非 $\\,1/\\rho\\,$ 进行平均。结论：不正确。\n\n选项 D。该选项建议根据 $\\,p_{i+1}-p_i\\,$ 的符号对 $\\,\\rho\\,$ 进行迎风处理。线性化声学系统是非耗散的，且面系数是与波传播方向无关的材料属性；在此处引入迎风格式会破坏离散能量守恒所需的对称性，并在对称构型中导致不正确的行为。特别是，考虑 $\\,\\rho_L \\neq \\rho_R\\,$ 且 $\\,p_{i+1}-p_i=0\\,$ 的情况；此时，根据所述规则，选择是未定义的。此外，在刚性极限 $\\,\\rho_L\\to\\infty\\,$ 下，如果规则选择了有限密度的一侧，它将无法产生零加速度。该选项也无法从控制体动量平衡中推导出来。结论：不正确。\n\n选项 E。选项 B 和 C 在代数上确实是等价的，但是，如上所示，它们不满足刚性极限要求，也非从有限体积动量平衡中得出。因此，无论单独还是共同来看，它们都不正确。结论：不正确。\n\n因此，唯一满足所有既定要求的选项是，在速度更新中，使用对偶控制体上密度的算术平均值的倒数作为面系数，即选项 A。", "answer": "$$\\boxed{A}$$", "id": "3615311"}, {"introduction": "将震源注入数值网格并非像在单个点上设置数值那么简单，因为这可能会引入被称为“混叠”的高频数值噪声。本练习提供了一个实践机会，让您深入设计使用不同插值核的震源加载策略。通过分析产生的波数谱，您将在减少数值伪影方面获得实践经验，并理解其与格式固有频散之间的相互作用。", "problem": "考虑在均匀交错网格上的一维线性声学问题，其中压力 $p$ 在整数空间节点 $x_i = i\\,\\Delta x$ 和半时间层 $t^{n+\\tfrac{1}{2}} = \\left(n+\\tfrac{1}{2}\\right)\\Delta t$ 处采样，质点速度 $v$ 在半整数空间节点 $x_{i+\\tfrac{1}{2}} = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$ 和整数时间层 $t^n = n\\,\\Delta t$ 处采样。其控制连续方程为\n$$\n\\partial_t p(x,t) + \\rho c^2 \\,\\partial_x v(x,t) = s_p(x,t), \\quad \\partial_t v(x,t) + \\frac{1}{\\rho}\\,\\partial_x p(x,t) = s_v(x,t),\n$$\n其中 $\\rho$ 是密度，$c$ 是波速。假设仅存在单极子源，因此 $s_v(x,t) = 0$，并且在固定时间，源的连续空间分布由以 $x_0$ 为中心的正则化 Dirac delta 函数 $\\varphi(x-x_0)$ 建模。对于此交错网格上的二阶精度显式时域有限差分格式，均匀介质的离散更新方程为\n$$\np^{n+\\tfrac{1}{2}}_i = p^{n-\\tfrac{1}{2}}_i - \\rho c^2 \\frac{\\Delta t}{\\Delta x}\\left(v^n_{i+\\tfrac{1}{2}} - v^n_{i-\\tfrac{1}{2}}\\right) + \\Delta t\\, s^n_{p,i},\n$$\n$$\nv^{n+1}_{i+\\tfrac{1}{2}} = v^{n}_{i+\\tfrac{1}{2}} - \\frac{\\Delta t}{\\rho\\,\\Delta x}\\left(p^{n+\\tfrac{1}{2}}_{i+1} - p^{n+\\tfrac{1}{2}}_{i}\\right).\n$$\n您将通过设计 $\\varphi(x-x_0)$ 到整数和半整数空间节点的空间插值，并分析其引起的波数内容及其与数值频散的相互作用，来研究此交错网格中源注入的混叠现象。\n\n定义一个长度为 $L = N\\,\\Delta x$ 的周期性空间域，其中 $N$ 为偶数。令 $y[m]$ 表示在间距为 $\\Delta x/2$ 的复合交错网格上的采样源剖面，其中对于 $m = 0,1,\\dots,2N-1$：\n$$\ny[m] = \\varphi\\!\\left(x_m - x_0\\right), \\quad x_m = \\frac{m}{2}\\,\\Delta x,\n$$\n需要时在 $[0,L)$ 上进行周期性环绕。这种复合采样将偶数索引 $m=2i$ 处的压力节点与奇数索引 $m=2i+1$ 处的速度节点交错排列。您将考虑正则化 delta 函数 $\\varphi(x)$ 的三种选择，所有选择都归一化为单位积分，即 $\\int_{-\\infty}^{\\infty} \\varphi(x)\\,dx = 1$：\n\n- 宽度为 $\\Delta x$ 的箱型（最近邻）核函数：\n$$\n\\varphi_B(x) = \\begin{cases}\n\\frac{1}{\\Delta x},  |x| \\le \\frac{\\Delta x}{2} \\\\\n0,  \\text{其他}\n\\end{cases}\n$$\n\n- 宽度为 $2\\,\\Delta x$ 的帽型（线性）核函数：\n$$\n\\varphi_H(x) = \\frac{1}{\\Delta x}\\,\\max\\!\\left(1 - \\frac{|x|}{\\Delta x},\\,0\\right).\n$$\n\n- 宽度为 $4\\,\\Delta x$ 的三次 $M_4$ B样条核函数，其中 $a = |x|/\\Delta x$：\n$$\n\\varphi_C(x) = \\frac{1}{\\Delta x}\n\\begin{cases}\n\\frac{4 - 6 a^2 + 3 a^3}{6},  0 \\le a  1 \\\\\n\\frac{(2 - a)^3}{6},  1 \\le a  2 \\\\\n0,  a \\ge 2\n\\end{cases}\n$$\n\n使用空间采样间距为 $\\Delta x/2$ 的 $2N$ 点离散傅里葉变换，定义周期域上 $y[m]$ 的离散傅里葉变换，并令 $Y[k]$ 表示其在波数 $k \\in \\mathcal{K}$ 处的复数谱，其中波数网格为\n$$\n\\mathcal{K} = \\left\\{ k_\\ell = 2\\pi\\,\\frac{\\ell}{L} \\,:\\, \\ell = -N, -N+1,\\dots, N-1 \\right\\}.\n$$\n角度必须以弧度处理。考虑由 Courant 数 $r = c\\,\\Delta t / \\Delta x$（其中 $0  r  1$）参数化的格式。\n\n您的任务：\n\n1. 从上面给出的离散更新方程出发，推导连接均匀格式的平面波解的角频率 $\\omega$ 和波数 $k$ 的离散频散关系。然后，将数值相速度 $c_p^{\\text{num}}(k)$ 定义为 $k \\neq 0$ 时的比率 $\\omega(k)/k$。此推导必须从离散更新方程和平面波拟设的定义开始，并且不得假设任何已有的离散频散公式。\n\n2. 对于每个源核函数 $\\varphi \\in \\{\\varphi_B,\\varphi_H,\\varphi_C\\}$，在周期域 $[0,L)$ 上于指定源位置 $x_0$ 处构造复合采样源 $y[m]$。计算其离散谱 $Y[k]$ 并用它来定义两个标量诊断量：\n   - 混叠比 $A$，即总谱能量中位于格式可表示频带 $\\left|k\\right| \\le \\pi/\\Delta x$ 之外的部分，即，\n     $$\n     A = \\frac{\\sum\\limits_{k \\in \\mathcal{K},\\, |k| > \\pi/\\Delta x} \\left|Y[k]\\right|^2}{\\sum\\limits_{k \\in \\mathcal{K}} \\left|Y[k]\\right|^2}.\n     $$\n   - 谱加权平均相对相速度误差 $E$，仅在可表示频带 $\\left|k\\right| \\le \\pi/\\Delta x$ 上计算，公式为\n     $$\n     E = \\frac{\\sum\\limits_{k \\in \\mathcal{K},\\, 0  |k| \\le \\pi/\\Delta x} \\left|Y[k]\\right|^2 \\,\\left|\\frac{c_p^{\\text{num}}(k) - c}{c}\\right|}{\\sum\\limits_{k \\in \\mathcal{K},\\, 0  |k| \\le \\pi/\\Delta x} \\left|Y[k]\\right|^2}.\n     $$\n     在 $k=0$ 处，将其贡献定义为零，并从求和中排除，以避免除以零。\n\n所有物理量必须使用国际单位制：距离以米为单位，时间以秒为单位，波数以弧度每米为单位，速度以米每秒为单位。任何三角函数的角度单位必须是弧度。\n\n实现一个程序，对以下参数集测试套件执行上述分析，每个参数集指定为元组 $(N,\\Delta x,c,r,x_0,\\varphi)$：\n\n- 测试 $1$ （一般偏移，箱型）：$(N=512,\\;\\Delta x=10\\,\\text{m},\\; c=1500\\,\\text{m/s},\\; r=0.5,\\; x_0=\\tfrac{L}{2} + 0.27\\,\\Delta x,\\; \\varphi=\\varphi_B)$。\n- 测试 $2$ （一般偏移，帽型）：$(N=512,\\;\\Delta x=10\\,\\text{m},\\; c=1500\\,\\text{m/s},\\; r=0.5,\\; x_0=\\tfrac{L}{2} + 0.27\\,\\Delta x,\\; \\varphi=\\varphi_H)$。\n- 测试 $3$ （一般偏移，三次样条）：$(N=512,\\;\\Delta x=10\\,\\text{m},\\; c=1500\\,\\text{m/s},\\; r=0.5,\\; x_0=\\tfrac{L}{2} + 0.27\\,\\Delta x,\\; \\varphi=\\varphi_C)$。\n- 测试 $4$ （网格对齐源，帽型；混叠的边界情况）：$(N=512,\\;\\Delta x=10\\,\\text{m},\\; c=1500\\,\\text{m/s},\\; r=0.5,\\; x_0=\\tfrac{L}{2},\\; \\varphi=\\varphi_H)$。\n\n您的程序必须为每个测试计算对 $(A,E)$，如上定义，并生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素都是一个形式为 $[A,E]$ 的双元素列表。例如，输出格式必须是\n$$\n\\texttt{[[A\\_1,E\\_1],[A\\_2,E\\_2],[A\\_3,E\\_3],[A\\_4,E\\_4]]}\n$$\n所有数字都以十进制浮点值的形式呈现，不带单位。不得打印其他任何文本。", "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观。它提出了计算地球物理学中的一个标准任务：分析声波方程有限差分格式中的数值伪影（混叠和频散）。为得到唯一解，所有必要的参数和定义都已提供。\n\n根据要求，解答分为两个主要部分：首先，推导数值频散关系；其次，对指定的源核函数和参数进行混叠和误差诊断的数值计算。\n\n### 第 1 部分：离散频散关系的推导\n\n任务是推导给定均匀介质中二阶交错网格有限差分格式的离散频散关系。控制离散方程为：\n$$\np^{n+\\tfrac{1}{2}}_i = p^{n-\\tfrac{1}{2}}_i - \\rho c^2 \\frac{\\Delta t}{\\Delta x}\\left(v^n_{i+\\tfrac{1}{2}} - v^n_{i-\\tfrac{1}{2}}\\right) \\quad (1)\n$$\n$$\nv^{n+1}_{i+\\tfrac{1}{2}} = v^{n}_{i+\\tfrac{1}{2}} - \\frac{1}{\\rho}\\frac{\\Delta t}{\\Delta x}\\left(p^{n+\\tfrac{1}{2}}_{i+1} - p^{n+\\tfrac{1}{2}}_{i}\\right) \\quad (2)\n$$\n这里，$p$ 是压力，$v$ 是质点速度，$\\rho$ 是密度，$c$ 是波速，$\\Delta t$ 是时间步长，$\\Delta x$ 是网格间距。下标 $i$ 和 $n$ 分别指空间和时间网格点。\n\n我们为这些差分方程寻找平面波解（a von Neumann analysis）。鉴于网格在空间和时间上都具有交错性质，我们定义以下平面波拟设：\n$$\np_i^{n+\\tfrac{1}{2}} = P_0 \\, e^{i(k x_i - \\omega t^{n+\\tfrac{1}{2}})} = P_0 \\, e^{i(k (i\\Delta x) - \\omega (n+\\tfrac{1}{2})\\Delta t)}\n$$\n$$\nv_{i+\\tfrac{1}{2}}^{n} = V_0 \\, e^{i(k x_{i+\\tfrac{1}{2}} - \\omega t^n)} = V_0 \\, e^{i(k (i+\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)}\n$$\n其中 $P_0$ 和 $V_0$ 是复振幅，$k$ 是波数，$\\omega$ 是角频率。\n\n首先，我们将拟设代入方程 $(1)$：\n$$\nP_0 e^{i(ki\\Delta x - \\omega(n+\\tfrac{1}{2})\\Delta t)} = P_0 e^{i(ki\\Delta x - \\omega(n-\\tfrac{1}{2})\\Delta t)} - \\rho c^2 \\frac{\\Delta t}{\\Delta x} \\left( V_0 e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)} - V_0 e^{i(k(i-\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)} \\right)\n$$\n我们将整个方程除以公因式 $e^{i(ki\\Delta x - \\omega n\\Delta t)}$：\n$$\nP_0 e^{-i\\omega\\tfrac{\\Delta t}{2}} = P_0 e^{i\\omega\\tfrac{\\Delta t}{2}} - \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\n整理各项得：\n$$\nP_0 \\left(e^{i\\omega\\tfrac{\\Delta t}{2}} - e^{-i\\omega\\tfrac{\\Delta t}{2}}\\right) = \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\n使用 Euler 恒等式 $\\sin(\\theta) = \\frac{e^{i\\theta} - e^{-i\\theta}}{2i}$，该方程简化为：\n$$\nP_0 \\left(2i \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)\\right) = \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\left(2i \\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\n这给出了振幅 $P_0$ 和 $V_0$ 之间的第一个线性关系：\n$$\nP_0 \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\sin\\left(\\frac{k\\Delta x}{2}\\right) \\quad (A)\n$$\n接下来，我们将拟设代入方程 $(2)$：\n$$\nV_0 e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega(n+1)\\Delta t)} = V_0 e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)} - \\frac{\\Delta t}{\\rho \\Delta x} \\left( P_0 e^{i(k(i+1)\\Delta x - \\omega(n+\\tfrac{1}{2})\\Delta t)} - P_0 e^{i(k i\\Delta x - \\omega(n+\\tfrac{1}{2})\\Delta t)} \\right)\n$$\n这次，我们除以公因式 $e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega (n+\\tfrac{1}{2})\\Delta t)}$：\n$$\nV_0 e^{-i\\omega\\tfrac{\\Delta t}{2}} = V_0 e^{i\\omega\\tfrac{\\Delta t}{2}} - \\frac{P_0}{\\rho V_0} \\frac{\\Delta t}{\\Delta x} \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\n像之前一样整理并应用 Euler 恒等式：\n$$\nV_0 \\left(e^{i\\omega\\tfrac{\\Delta t}{2}} - e^{-i\\omega\\tfrac{\\Delta t}{2}}\\right) = \\frac{P_0}{\\rho} \\frac{\\Delta t}{\\Delta x} \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\n$$\nV_0 \\left(2i\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)\\right) = \\frac{P_0}{\\rho} \\frac{\\Delta t}{\\Delta x} \\left(2i\\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\n这得到了 $P_0$ 和 $V_0$ 之间的第二个线性关系：\n$$\nV_0 \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = \\frac{1}{\\rho} \\frac{\\Delta t}{\\Delta x} P_0 \\sin\\left(\\frac{k\\Delta x}{2}\\right) \\quad (B)\n$$\n为了存在非平凡平面波解（即 $P_0, V_0$ 不全为零），方程 $(A)$ 和 $(B)$ 必须相容。我们可以从两个方程中表达比率 $P_0/V_0$。从 $(A)$ 得：\n$$\n\\frac{P_0}{V_0} = \\frac{\\rho c^2 \\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}{\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)}\n$$\n从 $(B)$ 得：\n$$\n\\frac{P_0}{V_0} = \\frac{\\rho \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)}{\\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}\n$$\n令这两个 $P_0/V_0$ 的表达式相等：\n$$\n\\frac{\\rho c^2 \\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}{\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)} = \\frac{\\rho \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)}{\\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}\n$$\n交叉相乘并化简得：\n$$\nc^2 \\left(\\frac{\\Delta t}{\\Delta x}\\right)^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) = \\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right)\n$$\n引入 Courant 数 $r = c\\,\\Delta t / \\Delta x$：\n$$\nr^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) = \\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right)\n$$\n对于前向传播的波，我们取正平方根，这导出了离散频散关系：\n$$\n\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = r \\sin\\left(\\frac{k\\Delta x}{2}\\right)\n$$\n从此关系中，我们可以解出数值角频率 $\\omega(k)$：\n$$\n\\omega(k) = \\frac{2}{\\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\n数值相速度 $c_p^{\\text{num}}(k)$ 定义为 $k \\ne 0$ 时的比率 $\\omega(k)/k$：\n$$\nc_p^{\\text{num}}(k) = \\frac{\\omega(k)}{k} = \\frac{2}{k \\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\n在 $k \\to 0$ 的极限情况下，我们可以使用近似式 $\\sin(x) \\approx x$ 和 $\\arcsin(x) \\approx x$，这表明 $c_p^{\\text{num}}(k) \\to c$，意味着该格式是一致的，并且对于非常长的波長是非频散的。对于有限的 $k$，$c_p^{\\text{num}}(k)  c$，这是一个被称为数值频散的典型特征。\n\n### 第 2 部分：诊断量的计算\n\n对源混叠及其与数值频散相互作用的分析，需要实现指定的源核函数以及诊断度量 $A$ 和 $E$。整个过程包括：\n1.  为每个测试案例定义物理和数值网格参数。\n2.  构建源函数 $\\varphi_B(x)$、$\\varphi_H(x)$ 和 $\\varphi_C(x)$。\n3.  在间距为 $\\Delta x/2$ 的网格上生成复合采样源剖面 $y[m]$，并遵循域的周期性。\n4.  计算 $y[m]$ 的 $2N$ 点离散傅里葉变换，以获得其在波数网格 $\\mathcal{K}$ 上的谱 $Y[k]$。\n5.  通过比较交错网格的可表示频带 $|k| \\le \\pi/\\Delta x$ 内外的谱能量来计算混叠比 $A$。\n6.  使用导出的 $c_p^{\\text{num}}(k)$ 表达式和可表示频带内的谱能量分布，计算谱加权平均相对相速度误差 $E$。\n\n这个过程在提供的 Python 程序中实现，该程序遍历四个测试案例并为每个案例计算 $(A, E)$ 对。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef phi_B(x, dx):\n    \"\"\"\n    Box (nearest-neighbor) kernel of width dx.\n    Normalized to unit integral.\n    \"\"\"\n    return np.where(np.abs(x) = dx / 2.0, 1.0 / dx, 0.0)\n\ndef phi_H(x, dx):\n    \"\"\"\n    Hat (linear) kernel of width 2*dx.\n    Normalized to unit integral.\n    \"\"\"\n    abs_x = np.abs(x)\n    return (1.0 / dx) * np.maximum(1.0 - abs_x / dx, 0.0)\n\ndef phi_C(x, dx):\n    \"\"\"\n    Cubic M4 B-spline kernel of width 4*dx.\n    Normalized to unit integral.\n    \"\"\"\n    a = np.abs(x) / dx\n    val = np.zeros_like(a)\n    \n    # Mask for 0 = a  1\n    mask1 = a  1\n    a1 = a[mask1]\n    val[mask1] = (4.0 - 6.0 * a1**2 + 3.0 * a1**3) / 6.0\n    \n    # Mask for 1 = a  2\n    mask2 = (a >= 1)  (a  2)\n    a2 = a[mask2]\n    val[mask2] = (2.0 - a2)**3 / 6.0\n    \n    return val / dx\n\ndef compute_diagnostics(N, dx, c, r, x0_str, phi_key):\n    \"\"\"\n    Computes the aliasing ratio (A) and weighted phase velocity error (E)\n    for a given set of parameters.\n    \"\"\"\n    L = N * dx\n    dt = r * dx / c\n    M = 2 * N\n    dx_c = dx / 2.0\n    \n    # Evaluate x0 from its string definition\n    x0 = eval(x0_str, {\"L\": L, \"dx\": dx})\n\n    phi_map = {'B': phi_B, 'H': phi_H, 'C': phi_C}\n    phi_func = phi_map[phi_key]\n\n    # 1. Construct the composite sampled source y[m]\n    x_grid = np.arange(M) * dx_c\n    d = x_grid - x0\n    d_periodic = d - L * np.round(d / L)  # Periodic distance in [-L/2, L/2]\n    y = phi_func(d_periodic, dx)\n\n    # 2. Compute the discrete spectrum Y[k]\n    # The normalization of the DFT cancels in the ratios A and E.\n    Y = np.fft.fftshift(np.fft.fft(y))\n    Y_sq_mag = np.abs(Y)**2\n    \n    # 3. Establish the wavenumber grid K\n    k = 2 * np.pi * np.fft.fftshift(np.fft.fftfreq(M, d=dx_c))\n\n    # 4. Compute aliasing ratio A\n    total_energy = np.sum(Y_sq_mag)\n    if total_energy == 0:\n        A = 0.0\n    else:\n        k_band_limit = np.pi / dx\n        is_aliased = np.abs(k) > k_band_limit\n        aliased_energy = np.sum(Y_sq_mag[is_aliased])\n        A = aliased_energy / total_energy\n\n    # 5. Compute spectrum-weighted average relative phase velocity error E\n    k_band_limit = np.pi / dx\n    repr_mask = (np.abs(k) = k_band_limit)  (k != 0)\n    \n    repr_weights = Y_sq_mag[repr_mask]\n    denom_E = np.sum(repr_weights)\n\n    if denom_E == 0:\n        E = 0.0\n    else:\n        k_repr = k[repr_mask]\n        \n        # Calculate numerical phase velocity for representable wavenumbers\n        # c_num = (2 / (k*dt)) * arcsin(r * sin(k*dx/2))\n        arg_arcsin = r * np.sin(k_repr * dx / 2.0)\n        # The argument is always in [-r, r] with r = 1, so arcsin is safe.\n        c_num_repr = (2.0 / (k_repr * dt)) * np.arcsin(arg_arcsin)\n        \n        rel_err = np.abs(c_num_repr - c) / c\n        \n        num_E = np.sum(repr_weights * rel_err)\n        E = num_E / denom_E\n        \n    return [A, E]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple (N, dx, c, r, x0_string, phi_string)\n    test_cases = [\n        (512, 10.0, 1500.0, 0.5, 'L/2 + 0.27*dx', 'B'),\n        (512, 10.0, 1500.0, 0.5, 'L/2 + 0.27*dx', 'H'),\n        (512, 10.0, 1500.0, 0.5, 'L/2 + 0.27*dx', 'C'),\n        (512, 10.0, 1500.0, 0.5, 'L/2', 'H')\n    ]\n\n    results = []\n    for case in test_cases:\n        N, dx, c, r, x0_str, phi_key = case\n        result_pair = compute_diagnostics(N, dx, c, r, x0_str, phi_key)\n        results.append(result_pair)\n\n    # Final print statement in the exact required format.\n    # The use of map(str, ...) correctly formats the list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3615325"}]}