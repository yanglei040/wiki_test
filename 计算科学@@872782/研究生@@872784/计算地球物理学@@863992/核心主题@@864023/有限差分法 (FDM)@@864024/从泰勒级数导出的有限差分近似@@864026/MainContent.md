## 引言
在[计算地球物理学](@entry_id:747618)以及众多科学与工程领域中，[偏微分方程](@entry_id:141332)（PDEs）是描述物理现象的基本语言。然而，绝大多数实际问题中的PDEs无法求得解析解，这使得数值方法成为不可或缺的研究工具。在众多数值方法中，有限差分法因其概念直观、易于实现且适用性广泛而占据核心地位。它的基本思想是用离散网格点上的函数值组合来近似连续的导数，从而将一个[微分](@entry_id:158718)问题转化为一个代数问题。

然而，一个关键的问题随之而来：我们如何系统性地构建这些离散近似，并科学地评估其可靠性与精确度？本文旨在解决这一核心知识缺口，深入探讨[有限差分近似](@entry_id:749375)的理论根基——[泰勒级数展开](@entry_id:138468)。泰勒级数不仅为我们提供了一把“解剖刀”，能够精确推导出各种差分格式，还能量化其内在的近似误差，即[截断误差](@entry_id:140949)，从而指导我们选择和设计适合特定问题的数值方案。

本文将引导读者完成一次从理论到实践的完整学习旅程。在第一章“原则与机制”中，我们将从泰勒级数出发，建立起[精度阶](@entry_id:145189)、截断误差等核心概念，系统推导标准和高阶的差分格式，并引入[修正波数](@entry_id:141354)这一[频域分析](@entry_id:265642)工具来理解数值频散等[全局误差](@entry_id:147874)效应。接下来的第二章“应用与跨学科联系”将展示这些理论工具的强大威力，通过地球物理学及相关领域的丰富实例，说明[有限差分法](@entry_id:147158)如何用于模拟[位场](@entry_id:143025)、波传播、以及处理复杂几何与边界条件。最后，在第三章“动手实践”中，您将通过一系列精心设计的编程练习，亲手实现并验证前两章学到的关键概念，将理论知识转化为实际的计算能力。

## 原则与机制

在上一章的介绍之后，我们现在深入探讨构建和分析[有限差分近似](@entry_id:749375)的数学原理和核心机制。其理论基石是[泰勒级数](@entry_id:147154)，它为我们提供了一种系统性的方法，不仅可以推导出各种差分格式，还能精确量化其近似误差。本章将从[泰勒级数](@entry_id:147154)出发，阐明截断误差和精度的概念，推导一些经典的差分格式，然后将该方法推广到构建高阶和任意网格上的格式。随后，我们将引入一种强大的[频域分析](@entry_id:265642)工具——[修正波数](@entry_id:141354)，用以研究数值频散和耗散这两种在波传播模拟中至关重要的现象。最后，我们将探讨一些高级主题，包括紧致差分格式和在有限精度计算中不可避免的[舍入误差](@entry_id:162651)问题。

### [泰勒级数](@entry_id:147154)：[有限差分](@entry_id:167874)的核心

[有限差分法](@entry_id:147158)的本质思想是用函数在网格点上的值的[线性组合](@entry_id:154743)来近似其在某点的导数。连接离散函数值与连续导数的桥梁正是泰勒级数。

#### 通用差分算子与[截断误差](@entry_id:140949)

考虑一个在均匀网格上定义的一维光滑函数 $f(x)$，网格间距为 $h$。我们的目标是近似其在点 $x_0$ 处的 $m$ 阶导数 $f^{(m)}(x_0)$。一个通用的线性[有限差分算子](@entry_id:749379) $L_h$ 可以表示为 [@problem_id:3591744]：

$$
L_h[f] = \frac{1}{h^m} \sum_{j=0}^{J} \alpha_j f(x_0 + s_j h)
$$

其中，$\alpha_j$ 是常数权重系数，$s_j$ 是定义了模板（stencil）形状的无量纲偏移量。$h^m$ 这个分母因子是为了确保随着 $h \to 0$，算子具有正确的量纲和收敛行为。

为了分析这个算子的性能，我们对每个 $f(x_0 + s_j h)$ 项在 $x_0$ 点进行[泰勒展开](@entry_id:145057)。假设 $f$ 足够光滑，我们有：

$$
f(x_0 + s_j h) = \sum_{k=0}^{\infty} \frac{(s_j h)^k}{k!} f^{(k)}(x_0) = \sum_{k=0}^{\infty} \frac{s_j^k h^k}{k!} f^{(k)}(x_0)
$$

将此展开式代入 $L_h[f]$ 的表达式，并交换求和顺序，得到：

$$
L_h[f] = \frac{1}{h^m} \sum_{j=0}^{J} \alpha_j \left( \sum_{k=0}^{\infty} \frac{s_j^k h^k}{k!} f^{(k)}(x_0) \right) = \sum_{k=0}^{\infty} \left( \frac{1}{k!} \sum_{j=0}^{J} \alpha_j s_j^k \right) h^{k-m} f^{(k)}(x_0)
$$

这个表达式是分析[有限差分格式](@entry_id:749361)的关键。我们希望当 $h \to 0$ 时，$L_h[f]$ 能够逼近 $f^{(m)}(x_0)$。这就引出了**截断误差**（truncation error）的概念，它被定义为离散算子作用于精确解与连续微分算子作用于精确解之间的差异 [@problem_id:3591744]：

$$
TE_h[f] = L_h[f] - f^{(m)}(x_0)
$$

#### 代数[矩条件](@entry_id:136365)与精度阶

为了使 $L_h[f]$ 成为 $f^{(m)}(x_0)$ 的一个**一致**（consistent）近似，当 $h \to 0$ 时，截断误差必须趋于零。观察 $L_h[f]$ 的[级数展开](@entry_id:142878)，我们发现：
- 对于 $k \lt m$，项的形式为 $h^{k-m} f^{(k)}(x_0)$，当 $h \to 0$ 时会发散。为了消除这些发散项，它们的系数必须为零。
- 对于 $k = m$，项的形式为 $f^{(m)}(x_0)$，其系数必须为 1，以确保我们近似的是正确的导数。
- 对于 $k > m$，项的形式为 $h^{k-m} f^{(k)}(x_0)$，当 $h \to 0$ 时它们自然收敛到零，这些项构成了截断误差。

这些要求产生了一组关于系数 $\alpha_j$ 的线性方程，称为**代数[矩条件](@entry_id:136365)**（algebraic moment conditions）。为了得到一个 $p$ 阶精度的格式，我们不仅要满足上述基本一致性条件，还要消除[截断误差](@entry_id:140949)中尽可能低阶的 $h$ 的幂次项。具体而言，我们要求从 $h^1$ 到 $h^{p-1}$ 的所有误差项的系数都为零。这等价于以下条件：

$$
\sum_{j=0}^{J} \alpha_j s_j^k = \delta_{km} m! \quad \text{对于 } k=0, 1, \dots, m+p-1
$$

其中 $\delta_{km}$ 是克罗内克（Kronecker）符号。如果这些条件满足，并且对于 $k=m+p$ 的矩不为零，则[截断误差](@entry_id:140949)的主项将由 $h^{(m+p)-m} = h^p$ 项决定。此时，我们称该格式为 **$p$ 阶精度**（order of accuracy $p$），其[截断误差](@entry_id:140949)为 $\mathcal{O}(h^p)$。

更严格地，使用带[余项](@entry_id:159839)的[泰勒定理](@entry_id:144253)，可以证明[截断误差](@entry_id:140949) $TE_h[f]$ 的主导项为 [@problem_id:3591744]：

$$
TE_h[f] = C_p h^p f^{(m+p)}(x_0) + \mathcal{O}(h^{p+1})
$$

其中，误差系数 $C_p = \frac{1}{(m+p)!} \sum_{j=0}^{J} \alpha_j s_j^{m+p}$。这个表达式明确指出了[截断误差](@entry_id:140949)与网格间距 $h$ 的 $p$ 次方、函数的[高阶导数](@entry_id:140882)以及模板的几何形状（通过 $\alpha_j$ 和 $s_j$）之间的关系。一个格式的[精度阶](@entry_id:145189)越高，其截断误差随[网格加密](@entry_id:168565)而减小的速度就越快。

### 典型的[有限差分格式](@entry_id:749361)

现在，我们将应用上述理论来推导和分析一些在[计算地球物理学](@entry_id:747618)中广泛使用的标准[有限差分格式](@entry_id:749361)。

#### 一阶导数的近似

近似[一阶导数](@entry_id:749425) $f'(x_0)$ 是最常见的任务之一。

- **前向与[后向差分](@entry_id:637618)**：最简单的格式是单边格式。**[前向差分](@entry_id:173829)**（forward difference）使用点 $x_0$ 和 $x_0+h$：
  $$ D_+[f](x_0) = \frac{f(x_0+h) - f(x_0)}{h} $$
  通过对 $f(x_0+h)$ 进行泰勒展开 $f(x_0+h) = f(x_0) + h f'(x_0) + \frac{h^2}{2} f''(x_0) + \mathcal{O}(h^3)$，我们可以得到截断误差为 $D_+[f](x_0) - f'(x_0) = \frac{h}{2}f''(x_0) + \mathcal{O}(h^2)$。这是一个**一阶**精度格式。类似地，**[后向差分](@entry_id:637618)**（backward difference）使用点 $x_0$ 和 $x_0-h$，其[截断误差](@entry_id:140949)为 $-\frac{h}{2}f''(x_0) + \mathcal{O}(h^2)$，同样是[一阶精度](@entry_id:749410)。由于这两种格式都只使用一侧的信息，它们被认为是**有偏**的 [@problem_id:3591787]。

- **中心差分**：一个更精确的格式是**[中心差分](@entry_id:173198)**（central difference），它使用点 $x_0-h$ 和 $x_0+h$：
  $$ D_c[f](x_0) = \frac{f(x_0+h) - f(x_0-h)}{2h} $$
  为了分析其误差，我们展开 $f(x_0+h)$ 和 $f(x_0-h)$ [@problem_id:3591774]：
  $$ f(x_0 \pm h) = f(x_0) \pm h f'(x_0) + \frac{h^2}{2} f''(x_0) \pm \frac{h^3}{6} f^{(3)}(x_0) + \frac{h^4}{24} f^{(4)}(x_0) \pm \frac{h^5}{120} f^{(5)}(x_0) + \dots $$
  将两式相减，所有偶数阶导数的项都相互抵消了：
  $$ f(x_0+h) - f(x_0-h) = 2h f'(x_0) + \frac{h^3}{3} f^{(3)}(x_0) + \mathcal{O}(h^5) $$
  两边同除以 $2h$ 并整理后，得到[截断误差](@entry_id:140949)：
  $$ TE_h[f] = D_c[f](x_0) - f'(x_0) = \frac{h^2}{6} f^{(3)}(x_0) + \mathcal{O}(h^4) $$
  由于对称性，误差的 $h$ 项被消除了，使得[中心差分格式](@entry_id:747203)具有**二阶**精度，远高于单边格式。它的误差系数是 $\frac{1}{6}$ [@problem_id:3591774]。

在实际应用中，这些格式的选择通常取决于位置。在计算域的**内部**，[中心差分](@entry_id:173198)因其高精度和无偏性而成为首选。然而，在域的**左边界**，我们没有 $x_0-h$ 点的数据，因此只能自然地使用[前向差分](@entry_id:173829)。同理，在**右边界**，[后向差分](@entry_id:637618)是自然的选择 [@problem_id:3591787]。

#### [二阶导数](@entry_id:144508)的近似

在[波动方程](@entry_id:139839)和[位场](@entry_id:143025)模拟等问题中，空间[拉普拉斯算子](@entry_id:146319)（即[二阶导数](@entry_id:144508)）的近似至关重要。一个标准的三点[中心差分格式](@entry_id:747203)用于近似 $f''(x_i)$：

$$
D_2[f](x_i) = \frac{f(x_i+h) - 2f(x_i) + f(x_i-h)}{h^2}
$$

为了推导其[截断误差](@entry_id:140949)，我们再次使用泰勒展开。这次我们将 $f(x_i+h)$ 和 $f(x_i-h)$ 的展开式相加 [@problem_id:3591717]：
$$
f(x_i+h) + f(x_i-h) = 2f(x_i) + h^2 f''(x_i) + \frac{h^4}{12} f^{(4)}(x_i) + \mathcal{O}(h^6)
$$
注意，所有奇数阶导数的项都因对称性而抵消。移项并除以 $h^2$，我们得到：
$$
\frac{f(x_i+h) - 2f(x_i) + f(x_i-h)}{h^2} = f''(x_i) + \frac{h^2}{12} f^{(4)}(x_i) + \mathcal{O}(h^4)
$$
这个格式同样是**二阶**精度的，其主截断误差项为 $\mathcal{T}_2 = \frac{h^2}{12} f^{(4)}(x_i)$ [@problem_id:3591717]。

### 高阶与通用格式的构建

为了提高数值模拟的保真度，尤其是在需要精确捕捉短波长成分的[地震波传播](@entry_id:165726)模拟中，使用比二阶更高精度的差分格式至关重要。

#### [待定系数法](@entry_id:166225)

系统构建[高阶格式](@entry_id:150564)的方法被称为**[待定系数法](@entry_id:166225)**（Method of Undetermined Coefficients）。该方法直接应用代数[矩条件](@entry_id:136365)来求解模板权重。

作为一个例子，我们来构建一个用于[一阶导数](@entry_id:749425) $f'(x_0)$ 的四阶精度[中心差分格式](@entry_id:747203)，该格式使用对称的五个点：$x_0 \pm h$ 和 $x_0 \pm 2h$ [@problem_id:3591756]。其形式为：
$$
D_h f'(x_0) = w_{-2} f(x_0 - 2h) + w_{-1} f(x_0 - h) + w_{+1} f(x_0 + h) + w_{+2} f(x_0 + 2h)
$$
由于格式是中心的且目标是奇数阶导数，权重必然是反对称的，即 $w_{-k} = -w_k$。这样可以自动满足所有关于偶数阶导数的[矩条件](@entry_id:136365)。我们需要满足的[矩条件](@entry_id:136365)是：
1.  近似 $f'(x_0)$：$\sum_j w_j s_j^1 = 1$ （注意权重 $w_j$ 定义中已包含了 $1/h$） $\implies h(-2w_{-2} - w_{-1} + w_{+1} + 2w_{+2}) = 1$
2.  消除 $\mathcal{O}(h^2)$ 误差：$\sum_j w_j s_j^3 = 0 \implies h^3(-8w_{-2} - w_{-1} + w_{+1} + 8w_{+2}) = 0$

利用[反对称性](@entry_id:261893) $w_{-1}=-w_{+1}$ 和 $w_{-2}=-w_{+2}$，上述[方程组](@entry_id:193238)简化为：
$$
\begin{cases}
h(2w_{+1} + 4w_{+2}) = 1 \\
h^3(2w_{+1} + 16w_{+2}) = 0
\end{cases}
$$
解这个关于 $w_{+1}$ 和 $w_{+2}$ 的 $2 \times 2$ 线性方程组，我们得到 $w_{+1} = \frac{2}{3h}$ 和 $w_{+2} = -\frac{1}{12h}$。因此，四阶精度的五点[中心差分格式](@entry_id:747203)为：
$$
D_h f'(x_0) = \frac{1}{12h} \left( f(x_0-2h) - 8f(x_0-h) + 8f(x_0+h) - f(x_0+2h) \right)
$$
其主[截断误差](@entry_id:140949)项可以通过计算下一个非零矩（$k=5$）得到，为 $-\frac{h^4}{30} f^{(5)}(x_0)$ [@problem_id:3591756]。

#### 任意网格的推广与数值稳定性

在处理不规则的采集几何或复杂的网格时，我们需要在任意[分布](@entry_id:182848)的节点 $\{x_j\}_{j=1}^n$ 上构建差分格式。[待定系数法](@entry_id:166225)可以被推广到这种情况 [@problem_id:3591716]。我们的目标是找到权重 $w_j$，使得 $\sum_{j=1}^n w_j f(x_j) \approx f^{(m)}(x_0)$。

通过在 $x_0$ 处对每个 $f(x_j)$ 进行[泰勒展开](@entry_id:145057)，并要求该近似对直到 $n-1$ 次的多项式都精确，我们得到一个 $n \times n$ 的[线性系统](@entry_id:147850) $A w = b$：
$$
\sum_{j=1}^n w_j \frac{(x_j - x_0)^k}{k!} = \delta_{km} \quad \text{对于 } k = 0, 1, \dots, n-1
$$
该系统的矩阵 $A$ 的元素为 $A_{kj} = \frac{(x_j - x_0)^k}{k!}$，它是一个经过平移和行缩放的**范德蒙德（Vandermonde）矩阵**。

在数值计算中，这是一个至关重要的观察，因为范德蒙德矩阵是出了名的**病态**（ill-conditioned）。其条件数会随着矩阵大小 $n$ 的增加而急剧增长。这意味着对输入数据（节点位置 $x_j$）的微小扰动可能会导致解（权重 $w_j$）的巨大变化。

为了缓解这种病态性，必须采取以下两个关键步骤 [@problem_id:3591716]：
1.  **平移（Shifting）**：始终使用相对坐标 $\Delta x_j = x_j - x_0$ 来构建矩阵，而不是绝对坐标 $x_j$。这可以防止当节点远离坐标原点时出现的人为的巨大数值。
2.  **缩放（Scaling）**：通过一个[特征长度](@entry_id:265857) $h$（例如 $h = \max_j |\Delta x_j|$）将相对坐标无量纲化，即使用 $\xi_j = \Delta x_j / h$。这确保了矩阵元素的大小不会过度增长，从而改善了[条件数](@entry_id:145150)。

即使采取了这些措施，求解这个[线性系统](@entry_id:147850)时也应避免使用不稳定的方法，例如构建并求解[正规方程](@entry_id:142238) $A^T A w = A^T b$，因为这会使条件数平方，放大[数值误差](@entry_id:635587)。推荐使用如带主元消去的[LU分解](@entry_id:144767)或[QR分解](@entry_id:139154)等稳定的[直接求解器](@entry_id:152789)。

### [频域分析](@entry_id:265642)：数值频散与耗散

[泰勒级数分析](@entry_id:171242)提供的是一种**局部**误差度量，它描述了在单个点上[截断误差](@entry_id:140949)如何随 $h$ 变化。然而，在求解像[波动方程](@entry_id:139839)这样的演化[偏微分方程](@entry_id:141332)时，我们更关心这些局部误差在空间和时间上累积所产生的**全局**效应。[频域分析](@entry_id:265642)，特别是通过**[修正波数](@entry_id:141354)**（modified wavenumber），为研究这些全局效应提供了强有力的工具。

#### [修正波数](@entry_id:141354)：一种诊断工具

[频域分析](@entry_id:265642)的核心思想是研究差分算子如何作用于一个[单色平面波](@entry_id:264838) $f(x) = \exp(ikx)$，其中 $k$ 是[波数](@entry_id:172452)。精确的微分算子 $\frac{d}{dx}$ 作用于该平面波的结果是：
$$
\frac{d}{dx} \exp(ikx) = ik \exp(ikx)
$$
它仅仅是将原函数乘以因子 $ik$。现在，我们考察一个离散的差分算子 $D_h$ 作用于网格上的平面波 $f(x_j) = \exp(ikx_j)$ 的结果。由于算子的线性和平移不变性，其结果必然也是原函数的倍数 [@problem_id:3591748]：
$$
D_h \exp(ikx_j) = i \tilde{k} \exp(ikx_j)
$$
其中，$\tilde{k}$ 是一个依赖于波数 $k$ 和网格间距 $h$ 的量，我们称之为**[修正波数](@entry_id:141354)**（或离散傅里叶符号）。$\tilde{k}$ 通常是复数。

[修正波数](@entry_id:141354) $\tilde{k}$ 与真实波数 $k$ 之间的差异，直接反映了[数值格式](@entry_id:752822)引入的误差。如果 $\tilde{k} = k$，则格式对于该波数是完美的。

对于一个具有反对称系数（$a_{-m} = -a_m$）的[中心差分格式](@entry_id:747203) $D_h u_j = \frac{1}{h} \sum_{m} a_m u_{j+m}$，其[修正波数](@entry_id:141354)是纯实数，可以表示为 [@problem_id:3591748]：
$$
\tilde{k}(kh) = \frac{2}{h} \sum_{m=1}^{M} a_m \sin(mkh)
$$
例如，对于我们之[前推](@entry_id:158718)导的四阶五点[中心差分格式](@entry_id:747203)，其系数为 $a_1 = 8/12, a_2 = -1/12$（注意这里 $D_h$ 定义中没有 $1/h$ 因子，所以权重不同于之前问题中的 $w_j$ 定义），带入上式可得其[修正波数](@entry_id:141354) [@problem_id:3591748] [@problem_id:3591763]：
$$
\tilde{k}(kh) = \frac{1}{h} \left( \frac{4}{3} \sin(kh) - \frac{1}{6} \sin(2kh) \right)
$$

#### 相位误差与幅度误差

[修正波数](@entry_id:141354) $\tilde{k}$ 与真实[波数](@entry_id:172452) $k$ 的差异可以分解为两部分，分别对应两种主要的数值误差：

1.  **数值频散（Numerical Dispersion）**：当 $\tilde{k}$ 是实数但 $\tilde{k} \neq k$ 时，波的**相位速度**会发生改变。数值相位速度为 $v_p^{\text{num}} = \omega / \tilde{k}$，而真实相位速度为 $v_p^{\text{exact}} = \omega / k$。由于 $\tilde{k}$ 对 $k$ 的依赖关系是[非线性](@entry_id:637147)的，不同波长的波在数值网格上会以不同的速度传播，即使在物理上它们应该以相同的速度传播。这种现象称为数值频散，它会导致[波包](@entry_id:154698)在传播过程中变形和展宽。**[相位误差](@entry_id:162993)**可以量化为 $\tilde{k} - k$ [@problem_id:3591763]。

2.  **数值耗散（Numerical Dissipation）**：当 $\tilde{k}$ 具有非零的虚部时，即 $\tilde{k} = \tilde{k}_R + i \tilde{k}_I$，[平面波解](@entry_id:195230) $\exp(i(kx - \omega t))$ 会被修改为 $\exp(i(\tilde{k}x - \omega t)) = \exp(-\tilde{k}_I x) \exp(i(\tilde{k}_R x - \omega t))$。这会导致波的振幅随传播距离呈指数衰减（如果 $\tilde{k}_I > 0$）或增长（如果 $\tilde{k}_I  0$）。这种非物理性的振幅变化称为数值耗散（或不稳定增长）。**幅度误差**与 $\tilde{k}$ 的虚部相关。对于上面定义的算子 $D_h$，幅度误差为零，因为其 $\tilde{k}$ 是实数 [@problem_id:3591763]。

通过对[修正波数](@entry_id:141354) $\tilde{k}(kh)$ 在 $kh \ll 1$ （即波长远大于网格间距）时进行泰勒展开，我们可以将[频域分析](@entry_id:265642)与之前的[截断误差分析](@entry_id:756198)联系起来。例如，对于四阶格式，其 $\tilde{k}(kh)$ 的展开式为 [@problem_id:3591748] [@problem_id:3591763]：
$$
\tilde{k}(kh) = k \left( 1 - \frac{(kh)^4}{30} + \mathcal{O}((kh)^6) \right)
$$
这表明，对于低波数（长波长）的波，$\tilde{k} \approx k$，近似非常准确。相位误差 $\tilde{k}-k$ 的主导项为 $-\frac{k(kh)^4}{30}$，误差是四阶的，这与我们通过[泰勒级数分析](@entry_id:171242)得到的格式[精度阶](@entry_id:145189)相符。这揭示了一个深刻的联系：一个 $p$ 阶精度的差分格式，其[相位误差](@entry_id:162993)的主导项是 $\mathcal{O}((kh)^p)$。

### 高级主题

#### [紧致有限差分格式](@entry_id:747522)

到目前为止我们讨论的都是**显式**（explicit）格式，即某点的导数可以直接由其邻近点的函数值计算得出。**紧致**（compact）或**隐式**（implicit）格式则是一种不同的思路，它将某点及其邻近点的导数值与函数值关联起来。这通常表现为一个需要求解的矩阵系统。

一个经典的四阶紧致格式用于一阶导数，其形式如下 [@problem_id:3591780]：
$$
\alpha f'_{i-1} + f'_i + \alpha f'_{i+1} = \frac{a}{h}\left(f_{i+1} - f_{i-1}\right)
$$
这里的未知数是网格上所有点的导数值 $f'_i$。通过对等式两边的所有项在 $x_i$ 点进行[泰勒展开](@entry_id:145057)，并匹配 $h$ 的各阶幂次项的系数，我们可以确定常数 $\alpha$ 和 $a$。为了达到四阶精度，我们需要匹配到 $f^{(3)}$ 的系数。求解得到的[方程组](@entry_id:193238)给出：
$$
\alpha = \frac{1}{4}, \quad a = \frac{3}{4}
$$
这便得到了著名的四阶帕德（Padé）格式。尽管紧致格式的模板宽度（涉及的函数值的点数）很小（此例中为3点），但它们能提供非常高的精度，且通常具有比同阶显式格式更优越的频散特性（即在更宽的[波数](@entry_id:172452)范围内 $\tilde{k} \approx k$）。其代价是需要在每个时间步求解一个三对角（或更大带宽）的[线性系统](@entry_id:147850)。

#### 误差的实际考量：[截断误差与舍入误差](@entry_id:164039)的权衡

我们的整个分析都基于理想的数学运算。然而，在实际的计算机中，浮点数运算具有有限的精度。除了由算法本身带来的**[截断误差](@entry_id:140949)**，还存在由计算机硬件限制带来的**舍入误差**（round-off error）。

截断误差随着网格间距 $h$ 的减小而减小。例如，对于[二阶中心差分](@entry_id:170774)，$|E_{\text{trunc}}| \le \frac{M_3}{6}h^2$，其中 $M_3$ 是三阶导数的上界。

然而，[舍入误差](@entry_id:162651)的行为恰恰相反。考虑中心差分的计算 $\frac{f(x+h) - f(x-h)}{2h}$。函数求值 $f(x \pm h)$ 会引入舍入误差，其大小与函数值本身和[机器精度](@entry_id:756332) $\varepsilon$（例如，对于[双精度](@entry_id:636927)浮点数约为 $10^{-16}$）成正比。在相减操作中，如果 $f(x+h)$ 和 $f(x-h)$ 非常接近（当 $h$ 很小时），会发生**灾难性抵消**（catastrophic cancellation），导致[有效数字](@entry_id:144089)大量损失。这个误差随后被一个很小的数 $2h$ 除，从而被放大。一个简单的模型表明，[舍入误差](@entry_id:162651)的界限与 $\frac{\varepsilon}{h}$ 成正比 [@problem_id:3591758]。

因此，总误差 $E(h)$ 是这两类误差之和的某种形式：
$$
E(h) \approx C_1 h^p + \frac{C_2 \varepsilon}{h}
$$
其中 $p$ 是格式的[精度阶](@entry_id:145189)。当 $h$ 很大时，截断误差占主导；当 $h$ 很小时，舍入误差占主导。这意味着存在一个**[最优步长](@entry_id:143372)** $h_{\text{opt}}$，使得总误差最小。通过对总误差函数求导并令其为零，我们可以估算出这个[最优步长](@entry_id:143372)。对于[二阶中心差分](@entry_id:170774)，$h_{\text{opt}}$ 的量级为 [@problem_id:3591758]：
$$
h_{\text{opt}} \propto \left(\frac{\varepsilon}{M_3}\right)^{1/3}
$$
这一重要结果表明，盲目地减小 $h$ 并不能无限提高计算结果的精度。在某个点之后，舍入误差将开始主导，精度反而会下降。这是每个从事数值计算的科学家都必须理解的一个基本限制。