{"hands_on_practices": [{"introduction": "数值方法在近似求解偏微分方程时，往往会引入一些并非源于原始物理模型的非预期效应。修正方程分析是一种强大的工具，可以揭示这些数值效应的本质。在本练习中，你将为一个简单的平流方程格式推导其修正方程，从而揭示一个隐藏的“数值耗散”项，并量化其影响[@problem_id:3590104]。这项实践是分析有限差分格式定性行为的一项基本技能。", "problem": "考虑计算地球物理学中的一维被动示踪剂输运问题，该问题由线性平流方程 $u_{t} + a\\,u_{x} = 0$ 控制，其中平流速度 $a0$ 为常数。在间距为 $\\Delta x$ 的均匀空间网格上，对空间导数采用与 $a0$ 一致的一阶迎风有限差分格式，然后使用时间步长为 $h$ 的显式前向欧拉单步法对得到的半离散常微分方程进行时间积分。设 $u_{i}^{n}$ 表示在网格点 $x_{i}$ 和时间层 $t_{n}$ 上对 $u(x_{i}, t_{n})$ 的数值近似解。\n\n从守恒律和所述离散化方法出发，通过对光滑函数 $u(x,t)$ 的时间和空间离散格式进行系统性展开，并利用原始偏微分方程消去时间导数以空间导数代之，推导该完全离散格式所满足的、在 $h$ 和 $\\Delta x$ 上达到主非平凡阶的修正偏微分方程。从你得到的修正方程中，识别出主阶人工扩散项，并仅用 $a$、$h$ 和 $\\Delta x$ 来量化其系数。\n\n请将你的最终答案以主阶数值扩散项系数的闭式解析表达式形式给出。无需四舍五入，最终表达式中不应包含任何单位。", "solution": "该问题要求推导应用于一维线性平流方程的数值格式的主阶人工扩散项的系数。推导过程通过分析该离散格式所满足的修正偏微分方程来进行。\n\n控制偏微分方程 (PDE) 是线性平流方程：\n$$\nu_{t} + a\\,u_{x} = 0\n$$\n其中 $u = u(x, t)$ 是输运量，$t$ 是时间，$x$ 是空间坐标，$a0$ 是一个恒定的平流速度。\n\n该数值格式构建在空间步长为 $\\Delta x$、时间步长为 $h$ 的均匀网格上。\n空间导数 $u_x$ 使用一阶迎风有限差分进行离散化。由于平流速度 $a$ 为正，所以“迎风”方向是向左（即 $x$ 减小的方向），因此使用一阶后向差分：\n$$\nu_{x}(x_{i}, t_{n}) \\approx \\frac{u(x_{i}, t_{n}) - u(x_{i} - \\Delta x, t_{n})}{\\Delta x} = \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x}\n$$\n将此代入控制偏微分方程，得到半离散常微分方程组 (ODEs)：\n$$\n\\frac{du_{i}(t)}{dt} + a \\left( \\frac{u_{i}(t) - u_{i-1}(t)}{\\Delta x} \\right) = 0\n$$\n然后使用显式前向欧拉法对该系统进行时间积分。对于形式为 $\\frac{dy}{dt} = f(y)$ 的常微分方程，前向欧拉法由 $\\frac{y^{n+1} - y^{n}}{h} = f(y^{n})$ 给出。将此应用于我们的半离散系统，我们得到：\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{h} = -a \\left( \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} \\right)\n$$\n这就是该格式的完全离散有限差分方程。\n\n为了推导修正偏微分方程，我们围绕网格点 $(x_{i}, t_{n})$ 对完全离散方程中的每一项进行泰勒级数展开。我们假设解 $u(x,t)$ 足够光滑。\n\n与时间相关的项 $u_{i}^{n+1}$ 的展开式为：\n$$\nu_{i}^{n+1} = u(x_{i}, t_{n}+h) = u(x_i, t_n) + h \\frac{\\partial u}{\\partial t} + \\frac{h^{2}}{2!} \\frac{\\partial^{2} u}{\\partial t^{2}} + O(h^{3})\n$$\n空间位移项 $u_{i-1}^{n}$ 的展开式为：\n$$\nu_{i-1}^{n} = u(x_{i}-\\Delta x, t_{n}) = u(x_i, t_n) - \\Delta x \\frac{\\partial u}{\\partial x} + \\frac{(\\Delta x)^{2}}{2!} \\frac{\\partial^{2} u}{\\partial x^{2}} - \\frac{(\\Delta x)^{3}}{3!} \\frac{\\partial^{3} u}{\\partial x^{3}} + O((\\Delta x)^{4})\n$$\n使用偏导数的下标表示法（例如，$u_t = \\frac{\\partial u}{\\partial t}$），并在 $(x_i, t_n)$ 处计算所有导数的值，展开式为：\n$$\nu_{i}^{n+1} = u + h u_{t} + \\frac{h^{2}}{2} u_{tt} + O(h^{3})\n$$\n$$\nu_{i-1}^{n} = u - \\Delta x u_{x} + \\frac{(\\Delta x)^{2}}{2} u_{xx} + O((\\Delta x)^{3})\n$$\n现在，将这些展开式代入离散格式。我们首先将格式重新整理为：\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{h} + a\\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = 0\n$$\n代入这两项的展开式：\n时间差分项变为：\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{h} = \\frac{1}{h} \\left( \\left( u + h u_{t} + \\frac{h^{2}}{2} u_{tt} + \\dots \\right) - u \\right) = u_{t} + \\frac{h}{2} u_{tt} + O(h^{2})\n$$\n空间差分项变为：\n$$\na\\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = \\frac{a}{\\Delta x} \\left( u - \\left( u - \\Delta x u_{x} + \\frac{(\\Delta x)^{2}}{2} u_{xx} - \\dots \\right) \\right) = \\frac{a}{\\Delta x} \\left( \\Delta x u_{x} - \\frac{(\\Delta x)^{2}}{2} u_{xx} + \\dots \\right) = a u_{x} - \\frac{a \\Delta x}{2} u_{xx} + O((\\Delta x)^{2})\n$$\n将这些展开项合并回方程中：\n$$\n\\left(u_{t} + \\frac{h}{2} u_{tt} + \\dots \\right) + \\left(a u_{x} - \\frac{a \\Delta x}{2} u_{xx} + \\dots \\right) = 0\n$$\n将各项分组，我们得到：\n$$\n(u_{t} + a u_{x}) + \\left( \\frac{h}{2} u_{tt} - \\frac{a \\Delta x}{2} u_{xx} \\right) + \\text{H.O.T.} = 0\n$$\n其中 H.O.T. 代表高阶项 (higher-order terms)。对于满足原始偏微分方程的光滑解 $u$，项 $(u_{t} + a u_{x})$ 恰好为零。余下的项代表了数值格式的截断误差。修正偏微分方程是数值解实际求解的方程，即原始偏微分方程加上主阶截断误差项：\n$$\nu_{t} + a u_{x} = - \\left( \\frac{h}{2} u_{tt} - \\frac{a \\Delta x}{2} u_{xx} \\right) + \\text{H.O.T.} = \\frac{a \\Delta x}{2} u_{xx} - \\frac{h}{2} u_{tt} + \\text{H.O.T.}\n$$\n题目要求我们使用原始偏微分方程 $u_t = -a u_x$ 来消去时间导数，以空间导数代之。假设 $u$ 足够光滑，我们可以对这个关系式求导，以找到 $u_{tt}$ 的表达式：\n$$\nu_{tt} = \\frac{\\partial}{\\partial t}(u_{t}) = \\frac{\\partial}{\\partial t}(-a u_{x})\n$$\n由于 $a$ 是常数，且对于光滑函数求导次序可以交换（$u_{tx} = u_{xt}$），我们有：\n$$\nu_{tt} = -a \\frac{\\partial}{\\partial t} \\left(\\frac{\\partial u}{\\partial x}\\right) = -a \\frac{\\partial}{\\partial x} \\left(\\frac{\\partial u}{\\partial t}\\right) = -a \\frac{\\partial}{\\partial x}(u_{t})\n$$\n再次代入 $u_t = -a u_x$：\n$$\nu_{tt} = -a \\frac{\\partial}{\\partial x}(-a u_{x}) = a^{2} \\frac{\\partial^{2} u}{\\partial x^{2}} = a^{2} u_{xx}\n$$\n现在，将这个 $u_{tt}$ 的结果代回修正方程：\n$$\nu_{t} + a u_{x} = \\frac{a \\Delta x}{2} u_{xx} - \\frac{h}{2} (a^{2} u_{xx}) + \\text{H.O.T.}\n$$\n合并含有 $u_{xx}$ 的项：\n$$\nu_{t} + a u_{x} = \\left( \\frac{a \\Delta x}{2} - \\frac{a^{2} h}{2} \\right) u_{xx} + \\text{H.O.T.}\n$$\n这就是修正的平流-扩散方程。右边的项，与 $u_{xx}$ 成正比，是主阶人工扩散（或数值扩散）项。该项的系数是人工扩散系数。\n通过观察，$u_{xx}$ 项的系数为：\n$$\nD_{\\text{num}} = \\frac{a \\Delta x}{2} - \\frac{a^{2} h}{2}\n$$\n这就是所求的主阶数值扩散项的系数表达式。", "answer": "$$\\boxed{\\frac{a \\Delta x}{2} - \\frac{a^{2} h}{2}}$$", "id": "3590104"}, {"introduction": "在分析了数值格式的精度之后，下一个关键问题是其稳定性，这直接关系到计算能否顺利进行。本练习将重点从精度转向显式方法在实践中面临的时间步长限制。通过分析空间离散化算子的特征值和时间积分格式（SSPRK3）的稳定性域，你将确定允许的最大 Courant-Friedrichs-Lewy (CFL) 数，这是地球物理模拟中的一个核心参数[@problem_id:3590090]。", "problem": "考虑线性一维平流方程 $u_t + a\\,u_x = 0$，其中常数波速 $a0$，定义在周期性域上，并使用一阶迎风差分在间距为 $\\Delta x0$ 的均匀网格上进行空间离散。将收集了网格点值的半离散状态向量表示为 $y(t) \\in \\mathbb{C}^N$，半离散化表示为 $y'(t) = A\\,y(t)$，其中 $A \\in \\mathbb{C}^{N \\times N}$ 是与迎风格式相关的循环矩阵。您将使用三阶三步强稳定保持 Runge–Kutta 方法 (SSPRK(3,3)) 对该常微分方程 (ODE) 进行时间推进。如果对于线性常系数系统 $y' = A\\,y$，由 SSPRK(3,3) 稳定多项式 $R(z)$ 定义的单步放大因子对所有 $A$ 的特征值 $\\lambda_k$ 都满足 $\\lvert R(h\\,\\lambda_k) \\rvert \\le 1$，则称时间步长 $h0$ 是线性稳定的。\n\n从以下基本原理出发：\n- 使用带有周期性边界条件的迎风差分对 $u_t + a\\,u_x = 0$ 进行半离散化 $y' = A\\,y$，会产生一个正规循环矩阵 $A$，该矩阵可通过离散傅里叶变换进行对角化，其特征值取决于傅里叶波数。\n- 应用于线性系统 $y' = A\\,y$ 的显式单步法的稳定性要求是，该方法的稳定多项式 $R(z)$ 对所有 $A$ 的特征值 $\\lambda_k$ 都满足 $\\lvert R(h\\,\\lambda_k) \\rvert \\le 1$。\n\n您的任务是，从第一性原理出发，不引用任何关于 $R(z)$ 或 $A$ 的特征值的预先给定的公式，推导出应用于此半离散化的 SSPRK(3,3) 方法的最大稳定时间步长 $h_{\\max}$（以秒为单位），并用 $a$ 和 $\\Delta x$ 表示。然后，实现一个程序，为下面指定的每个测试用例计算 $h_{\\max}$。将每个 $h_{\\max}$ 以秒为单位表示，并四舍五入到八位小数。\n\n要求的最终输出格式是单行包含一个用方括号括起来的逗号分隔列表，例如，“[0.12345678,0.87654321]”。列表中不能有空格。\n\n使用以下参数值测试套件，每个参数值被解释为 $(a,\\Delta x)$，其中 $a$ 的单位为米/秒，$\\Delta x$ 的单位为米：\n1. $(1.0,\\,1.0)$\n2. $(2.0,\\,1.0)$\n3. $(0.5,\\,0.1)$\n4. $(1000.0,\\,1.0)$\n5. $(1.0,\\,10^{-3})$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔结果列表，其顺序与上述测试用例相对应，每个条目等于 $h_{\\max}$（以秒为单位），并四舍五入到八位小数。", "solution": "该问题是有效的，因为它具有科学依据、问题明确且客观。它提出了一个偏微分方程数值分析中的标准、可解问题。我们现在将从第一性原理出发进行形式推导。\n\n目标是找到三阶强稳定保持 Runge-Kutta (SSPRK(3,3)) 方法应用于线性平流方程 $u_t + a u_x = 0$（常数波速 $a0$）半离散化的最大稳定时间步长 $h_{\\max}$。空间离散化在周期性域上使用一阶迎风格式，网格间距为 $\\Delta x$。\n\n推导过程分为四个主要步骤：\n1.  推导 SSPRK(3,3) 方法的稳定多项式 $R(z)$。\n2.  推导空间离散矩阵 $A$ 的特征值 $\\lambda_k$。\n3.  通过将离散化系统的特征值与时间步进方法的稳定域相关联，建立稳定性条件。\n4.  求解最大 Courant-Friedrichs-Lewy (CFL) 数，并随后求解 $h_{\\max}$。\n\n**1. SSPRK(3,3) 稳定多项式**\n\nSSPRK(3,3) 方法对一个常微分方程 $y'(t) = f(y(t))$ 由以下三个阶段定义：\n$$ y^{(1)} = y_n + h f(y_n) $$\n$$ y^{(2)} = \\frac{3}{4} y_n + \\frac{1}{4} \\left( y^{(1)} + h f(y^{(1)}) \\right) $$\n$$ y_{n+1} = \\frac{1}{3} y_n + \\frac{2}{3} \\left( y^{(2)} + h f(y^{(2)}) \\right) $$\n为了找到稳定多项式，我们将此方法应用于线性测试方程 $y' = \\lambda y$，其中 $\\lambda \\in \\mathbb{C}$。在这种情况下，$f(y) = \\lambda y$。设 $z = h\\lambda$。各个阶段变为：\n$$ y^{(1)} = y_n + z y_n = (1+z) y_n $$\n$$ y^{(2)} = \\frac{3}{4} y_n + \\frac{1}{4} (y^{(1)} + z y^{(1)}) = \\frac{3}{4} y_n + \\frac{1}{4}(1+z)y^{(1)} = \\left[ \\frac{3}{4} + \\frac{1}{4}(1+z)^2 \\right] y_n $$\n展开括号中的项：\n$$ \\frac{3}{4} + \\frac{1}{4}(1 + 2z + z^2) = \\frac{3}{4} + \\frac{1}{4} + \\frac{1}{2}z + \\frac{1}{4}z^2 = 1 + \\frac{1}{2}z + \\frac{1}{4}z^2 $$\n因此，$y^{(2)} = (1 + \\frac{1}{2}z + \\frac{1}{4}z^2) y_n$。最后，第三个阶段给出 $y_{n+1}$：\n$$ y_{n+1} = \\frac{1}{3} y_n + \\frac{2}{3}(y^{(2)} + z y^{(2)}) = \\frac{1}{3} y_n + \\frac{2}{3}(1+z)y^{(2)} $$\n代入 $y^{(2)}$ 的表达式：\n$$ y_{n+1} = \\left[ \\frac{1}{3} + \\frac{2}{3}(1+z)\\left(1 + \\frac{1}{2}z + \\frac{1}{4}z^2\\right) \\right] y_n $$\n放大因子，即稳定多项式 $R(z)$，是括号中的表达式 $y_{n+1}/y_n$。展开此多项式：\n$$ R(z) = \\frac{1}{3} + \\frac{2}{3}\\left(1 + \\frac{1}{2}z + \\frac{1}{4}z^2 + z + \\frac{1}{2}z^2 + \\frac{1}{4}z^3\\right) $$\n$$ R(z) = \\frac{1}{3} + \\frac{2}{3}\\left(1 + \\frac{3}{2}z + \\frac{3}{4}z^2 + \\frac{1}{4}z^3\\right) $$\n$$ R(z) = \\frac{1}{3} + \\frac{2}{3} + z + \\frac{1}{2}z^2 + \\frac{1}{6}z^3 $$\n因此，SSPRK(3,3) 的稳定多项式为：\n$$ R(z) = 1 + z + \\frac{1}{2}z^2 + \\frac{1}{6}z^3 $$\n这是 $e^z$ 的三阶泰勒级数展开，与三阶方法一致。\n\n**2. 半离散化矩阵的特征值**\n\n平流方程为 $u_t + a u_x = 0$。我们在均匀网格 $x_j = j \\Delta x$（$j=0, \\dots, N-1$）上进行空间离散化。由于波速 $a0$，在网格点 $j$ 处空间导数 $u_x$ 的一阶迎风差分为：\n$$ u_x \\approx \\frac{u(x_j) - u(x_{j-1})}{\\Delta x} $$\n设 $y_j(t) \\approx u(x_j, t)$，则半离散常微分方程组为：\n$$ \\frac{dy_j}{dt} + a \\frac{y_j - y_{j-1}}{\\Delta x} = 0 \\quad \\implies \\quad y_j'(t) = -\\frac{a}{\\Delta x} (y_j - y_{j-1}) $$\n该系统可以写成矩阵形式 $y'(t) = A y(t)$。对于周期性域，索引 $j-1$ 被解释为模 $N$，因此对于 $j=0$，$y_{j-1} = y_{-1} \\equiv y_{N-1}$。这产生一个循环矩阵 $A \\in \\mathbb{C}^{N \\times N}$，其中每一行包含格式的系数。$A$ 的第 $j$ 行在第 $j$ 列的值为 $-\\frac{a}{\\Delta x}$，在第 $j-1$ 列的值为 $+\\frac{a}{\\Delta x}$（带环绕）。\n\n任何循环矩阵的特征值都可以通过将其应用于离散傅里叶模态来找到，这些模态构成了它的特征向量。一个特征向量 $v_k$ 的分量为 $(v_k)_j = e^{i (2\\pi k j / N)}$，其中 $k, j \\in \\{0, \\dots, N-1\\}$。将算子应用于 $v_k$ 的第 $j$ 个分量：\n$$ (A v_k)_j = -\\frac{a}{\\Delta x} \\left( (v_k)_j - (v_k)_{j-1} \\right) = -\\frac{a}{\\Delta x} \\left( e^{i \\frac{2\\pi k j}{N}} - e^{i \\frac{2\\pi k (j-1)}{N}} \\right) $$\n$$ (A v_k)_j = -\\frac{a}{\\Delta x} e^{i \\frac{2\\pi k j}{N}} \\left( 1 - e^{-i \\frac{2\\pi k}{N}} \\right) = \\lambda_k (v_k)_j $$\n因此，对应于特征向量 $v_k$ 的特征值 $\\lambda_k$ 是：\n$$ \\lambda_k = -\\frac{a}{\\Delta x} \\left( 1 - e^{-i \\phi_k} \\right) $$\n其中 $\\phi_k = \\frac{2\\pi k}{N}$ 是由 $\\Delta x$ 归一化的离散波数，范围从 $\\phi_0=0$ 到接近 $2\\pi$。随着 $k$ 的变化，这些特征值在复平面上描绘出一个圆。表达式 $\\lambda_k + \\frac{a}{\\Delta x} = \\frac{a}{\\Delta x} e^{-i\\phi_k}$ 表明这是一个半径为 $\\frac{a}{\\Delta x}$、圆心在实轴上 $-\\frac{a}{\\Delta x}$ 处的圆。\n\n**3. 稳定性分析**\n\n为了使数值方法稳定，对于系统中存在的所有模态，单步放大因子的模不得大于 $1$。这意味着对于 $A$ 的所有特征值 $\\lambda_k$，必须满足条件 $|R(h\\lambda_k)| \\le 1$。\n\n设 $z_k = h\\lambda_k$。所有这些缩放后特征值的集合是算子 $hA$ 的谱。\n$$ z_k = -h \\frac{a}{\\Delta x} \\left( 1 - e^{-i \\phi_k} \\right) $$\n我们将 Courant-Friedrichs-Lewy (CFL) 数定义为 $\\nu = \\frac{a h}{\\Delta x}$。由此，缩放后的特征值变为：\n$$ z_k = -\\nu \\left( 1 - e^{-i \\phi_k} \\right) $$\n这个方程描述了复平面中一个以 $-\\nu$ 为中心、半径为 $\\nu$ 的圆。稳定性条件要求整个圆都位于 SSPRK(3,3) 方法的稳定域内，稳定域定义为集合 $\\mathcal{S} = \\{ z \\in \\mathbb{C} : |R(z)| \\le 1 \\}$。\n\n为了找到最大稳定 CFL 数 $\\nu_{\\max}$，我们必须找到使这个圆包含在 $\\mathcal{S}$ 内的最大 $\\nu  0$。严格的分析会涉及找到扩张的圆与 $\\mathcal{S}$ 边界的切点。然而，对于迎风差分和 RK3 方法的这种特定组合，一个常见且有效的简化是假设稳定性极限由特征值圆上位于负实轴最远处的点决定。该点对应于最高频率的空间模态，即 $\\phi_k = \\pi$。\n对于 $\\phi_k = \\pi$，$e^{-i\\pi} = -1$，因此缩放后的特征值为：\n$$ z = -\\nu(1 - (-1)) = -2\\nu $$\n我们必须找到稳定域在负实轴上的边界。该边界由 $|R(z)|=1$ 给出。由于当 $z$ 为实数时 $R(z)$ 也为实数，这意味着 $R(z)=1$ 或 $R(z)=-1$。对于 $z0$，$R(z)=1$ 仅在 $z=0$ 时成立。因此，稳定性极限由 $R(z)=-1$ 的第一个负根确定。\n$$ 1 + z + \\frac{1}{2}z^2 + \\frac{1}{6}z^3 = -1 $$\n$$ \\frac{1}{6}z^3 + \\frac{1}{2}z^2 + z + 2 = 0 $$\n乘以 $6$ 得到负实轴上稳定性边界的多项式方程：\n$$ z^3 + 3z^2 + 6z + 12 = 0 $$\n当点 $z = -2\\nu$ 位于此边界上时，达到最大稳定时间步长。将 $z = -2\\nu_{\\max}$ 代入此方程：\n$$ (-2\\nu_{\\max})^3 + 3(-2\\nu_{\\max})^2 + 6(-2\\nu_{\\max}) + 12 = 0 $$\n$$ -8\\nu_{\\max}^3 + 12\\nu_{\\max}^2 - 12\\nu_{\\max} + 12 = 0 $$\n除以 $-4$，我们得到关于最大 CFL 数 $\\nu_{\\max}$ 的三次方程：\n$$ 2\\nu_{\\max}^3 - 3\\nu_{\\max}^2 + 3\\nu_{\\max} - 3 = 0 $$\n\n**4. 最大时间步长的计算**\n\n这个三次方程没有简单的有理根，必须进行数值求解。具有物理意义的根是唯一的实根，可以使用数值求解器找到。其值为：\n$$ \\nu_{\\max} \\approx 1.2638360341943411 $$\n根据 CFL 数的定义 $\\nu_{\\max} = \\frac{a h_{\\max}}{\\Delta x}$，我们可以将最大稳定时间步长 $h_{\\max}$ 表示为：\n$$ h_{\\max} = \\nu_{\\max} \\frac{\\Delta x}{a} $$\n使用计算出的 $\\nu_{\\max}$ 值，最终公式为：\n$$ h_{\\max} \\approx 1.26383603 \\times \\frac{\\Delta x}{a} $$\n该公式将被用于实现计算给定测试用例所需的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Calculates the maximal stable time step h_max for the SSPRK(3,3) method\n    applied to the 1D advection equation with first-order upwind discretization.\n    \"\"\"\n    \n    # As derived in the solution, the maximal stable CFL number, nu_max, is the\n    # real root of the cubic equation 2*nu^3 - 3*nu^2 + 3*nu - 3 = 0.\n    # We solve this equation numerically.\n    def poly_for_nu(nu):\n        \"\"\"Cubic polynomial defining the maximal CFL number.\"\"\"\n        return 2 * nu**3 - 3 * nu**2 + 3 * nu - 3\n\n    # The root is known to be between 1.0 and 2.0. We use a bracketing method\n    # for robustness.\n    try:\n        sol = root_scalar(poly_for_nu, bracket=[1.0, 2.0], method='brentq')\n        nu_max = sol.root\n    except (ImportError, ValueError):\n        # Fallback to a hardcoded value if scipy fails, though this should not happen\n        # in the specified environment. The value is pre-calculated to high precision.\n        nu_max = 1.2638360341943411\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (a, delta_x) in units of m/s and m, respectively.\n    test_cases = [\n        (1.0, 1.0),\n        (2.0, 1.0),\n        (0.5, 0.1),\n        (1000.0, 1.0),\n        (1.0, 10**-3)\n    ]\n\n    results = []\n    for a, delta_x in test_cases:\n        # The formula for the maximal stable time step is h_max = nu_max * (delta_x / a).\n        if a = 0 or delta_x = 0:\n            raise ValueError(\"Wave speed 'a' and grid spacing 'delta_x' must be positive.\")\n        \n        h_max = nu_max * (delta_x / a)\n        \n        # Format the result to eight decimal places as required.\n        results.append(f\"{h_max:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3590090"}, {"introduction": "高阶方法以其卓越的精度而著称，但这一优势以解的光滑性为前提。本练习将探讨当这一基本假设被破坏时会发生什么——这在地球物理学中是常见情景，例如涉及断层滑动或油井关停等突变过程。通过一系列概念性问题，你将深入分析阶数退化现象，并学习如何设计策略来检测和处理不连续点，以保持方法的精度[@problem_id:3590073]。", "problem": "在计算地球物理学中使用的时间相关的孔隙弹性压实模型中，体积应变率由一个驱动力驱动，当注入井关闭时，该驱动力会突然改变。一个代表性标量状态变量 $u(t)$ 的简化常微分方程表示为\n$$\n\\frac{du}{dt} = f(t,u) = -\\lambda u + s(t),\n$$\n其中 $\\lambda  0$ 是一个恒定的材料参数，$s(t)$ 是一个分段光滑的源项。考虑在未知时间 $t_d \\in (0,T)$ 处源项存在单个有限跳跃不连续点，\n$$\ns(t) = \\begin{cases}\ns_-  \\text{for } t  t_d,\\\\\ns_+  \\text{for } t  t_d,\n\\end{cases}\n$$\n其中 $s_- \\neq s_+$。您使用一个 $p$ 阶显式单步法（例如，一个 $p$ 阶显式 Runge–Kutta 方法），配合自适应步长 $h_n = t_{n+1} - t_n$ 对此初值问题进行积分，但没有关于 $t_d$ 的先验知识。\n\n在实践中观察到，当一个时间步 $[t_n, t_{n+1}]$ 跨越 $t_d$ 处的跳跃时，精度会恶化。为了保持精度，提出了一种策略来检测这类不连续点，并将步长端点与之对齐。\n\n在这种情况下，关于阶数降低和步长控制的下列陈述中，哪些是正确的？\n\nA. 如果单个步长 $[t_n, t_{n+1}]$ 跨越 $s(t)$ 中的跳跃，并且步长端点未在 $t_d$ 处对齐，则该步长上的局部截断误差为 $\\mathcal{O}(h_n)$，与方法阶数 $p$ 无关。\n\nB. 对于所描述的 $s(t)$ 中的单个跳跃，即使有一个步长跨越了跳跃，有限时间区间 $[0,T]$ 上的全局误差仍然按 $\\mathcal{O}(h^p)$ 缩放（对于一个 $p$ 阶方法），因为只有一个步长受到影响。\n\nC. 如果步长控制器确保一个步长端点与 $t_d$ 精确重合（没有步长跨越不连续点），并且 $s(t)$ 在每一侧都是光滑的，那么在两个子区间上都恢复了标称阶数 $p$，并且全局误差按 $\\mathcal{O}(h^p)$ 缩放。\n\nD. 一个稳健的维持精度的实用策略是监控一个不连续性指标，例如\n$$\nD_n \\equiv \\left\\| f\\!\\left(t_{n+1}, y_{n+1}^{\\mathrm{pred}}\\right) - f(t_n, y_n) \\right\\|,\n$$\n其中 $y_{n+1}^{\\mathrm{pred}}$ 是该方法在 $t_{n+1}$ 处的预测值。如果 $D_n$ 超过一个与用户容差成比例的阈值，控制器会减小 $h_n$，通过缩小步长来包围跳跃点，直到检测到 $t_d \\in [t_n, t_{n+1}]$，然后在一个合适的指标上应用标量求根过程（例如，二分法或割线法）以 $\\mathcal{O}(h^{p+1})$ 的精度定位 $t_d$，之后强制在 $t_d$ 处设置一个步长端点。这可以保持全局 $\\mathcal{O}(h^p)$ 阶精度。\n\nE. 如果 $f(t,u)$ 在 $t_d$ 处连续，但其关于时间的一阶偏导数 $\\partial f/\\partial t$ 在 $t_d$ 处有有限跳跃，则任何显式单步法在跨越 $t_d$ 的步长上都会遭受 $\\mathcal{O}(h_n)$ 阶的局部误差，导致全局误差为 $\\mathcal{O}(h)$，除非步长被对齐。\n\nF. 如果 $f(t,u)$ 在 $t_d$ 处连续，但在 $t_d$ 处 $\\partial f/\\partial t$ 有有限跳跃，那么，在没有对齐的情况下，可达到的全局阶数最多为 $\\mathcal{O}(h^2)$：$p \\leq 2$ 的方法保持其标称阶数，而 $p  2$ 的方法会降至二阶。\n\nG. 标准显式单步法对中可用的嵌入式误差估计器足以检测并精确定位 $t_d$，无需任何额外的逻辑，因为当且仅当步长端点与不连续点重合时，估计器为零。\n\n选择所有适用的选项。", "solution": "用户需要对几个关于带有不连续驱动项的常微分方程（ODE）数值积分的陈述进行批判性分析，这是计算科学与工程领域（如地球物理学）中的一个常见问题。\n\n### 第1步：提取已知条件\n\n-   **ODE**：标量状态变量 $u(t)$ 由 $\\frac{du}{dt} = f(t,u) = -\\lambda u + s(t)$ 控制。\n-   **常数**：$\\lambda  0$。\n-   **源项**：$s(t)$ 是一个分段光滑函数，在某个未知时间 $t_d \\in (0,T)$ 有一个单一的有限跳跃不连续点。\n-   **跳跃定义**：$s(t) = \\begin{cases} s_-  \\text{for } t  t_d \\\\ s_+  \\text{for } t  t_d \\end{cases}$，其中 $s_- \\neq s_+$。\n-   **数值方法**：一个 $p$ 阶显式单步法，采用自适应步长 $h_n = t_{n+1} - t_n$。\n-   **情景**：时间 $t_d$ 先验未知，分析集中于一个时间步 $[t_n, t_{n+1}]$ 跨越不连续点（即 $t_n  t_d  t_{n+1}$）的情况。\n\n### 第2步：使用提取的已知条件进行验证\n\n-   **科学基础**：该问题具有科学基础。ODE $\\frac{du}{dt} = -\\lambda u + s(t)$ 是一个标准的一阶线性 ODE，是受外部驱动的松弛现象的基本模型。驱动项 $s(t)$ 中存在跳跃不连续点在数学上和物理上都是有意义的情景（例如，打开或关闭一个系统）。所提出的问题与 ODE 数值分析的核心理论相关，特别是关于在非光滑性存在时的误差分析和自适应步进。没有违反任何科学原理。\n-   **适定性**：该问题是适定的。它提出了一个清晰的初值问题情景，并要求对数值分析中的标准概念进行评估，如局部截断误差、全局误差和不连续点处理策略。这些问题足够精确，可以根据已建立的理论得出明确的答案。\n-   **客观性**：该问题以数值分析和计算数学中常见的客观、形式化语言陈述。术语如“$p$ 阶”、“局部截断误差”和“全局误差”都有精确的定义。“孔隙弹性压实”的背景起到了启发作用，但没有引入主观性。\n\n### 第3步：结论与行动\n\n问题陈述是**有效的**。它是自洽的、科学上合理的，并在数值分析的既定框架内提出了清晰、客观的问题。接下来进行求解推导和选项分析。\n\n### 基于原理的推导与逐项分析\n\n问题的核心在于理解右侧函数 $f(t,u)$ 的光滑性如何影响解 $u(t)$ 的光滑性，并因此影响数值方法的精度。一个 $p$ 阶单步法的阶数只有在解 $u(t)$ 足够光滑（通常是 $u \\in C^{p+1}$）时才能达到。\n\n首先，我们分析解 $u(t)$ 在不连续点 $t_d$ 处的光滑性。ODE 是 $u'(t) = -\\lambda u(t) + s(t)$。\n由于 $u(t)$ 必须是时间的连续函数（作为一个物理状态变量），$s(t)$ 在 $t_d$ 处的跳跃直接导致导数 $u'(t)$ 的跳跃：\n$$\n\\lim_{t \\to t_d^+} u'(t) - \\lim_{t \\to t_d^-} u'(t) = (-\\lambda u(t_d) + s_+) - (-\\lambda u(t_d) + s_-) = s_+ - s_- \\neq 0.\n$$\n因为 $u'(t)$ 在 $t_d$ 处有跳跃不连续点，所以解 $u(t)$ 是连续的（$u \\in C^0$）但不是连续可微的（$u \\notin C^1$）。第一个不连续的导数是 $u'(t)$ 本身。在不连续性的标准分类中，这对应于解的光滑性为 $q=1$（即，$u^{(q-1)}=u^{(0)}=u$ 是连续的，但 $u^{(q)}=u^{(1)}$ 不是）。所有更高阶的导数，$u''(t), u'''(t)$ 等，在经典意义上在 $t_d$ 处不存在。\n\n**A. 如果单个步长 $[t_n, t_{n+1}]$ 跨越 $s(t)$ 中的跳跃，并且步长端点未在 $t_d$ 处对齐，则该步长上的局部截断误差为 $\\mathcal{O}(h_n)$，与方法阶数 $p$ 无关。**\n\n单步法的局部截断误差（LTE）定义为 $LTE_n = u(t_{n+1}) - y_{n+1}^{\\text{exact}}$，其中 $y_{n+1}^{\\text{exact}}$ 是从精确解 $u(t_n)$ 开始执行一步的结果。对于一个 $p$ 阶方法，LTE 通常为 $\\mathcal{O}(h_n^{p+1})$，这依赖于 $u(t)$ 足够光滑。\n当步长 $[t_n, t_{n+1}]$ 跨越 $t_d$ 时，解是不光滑的。我们来分析误差：\n$LTE_n = \\left(u(t_n) + \\int_{t_n}^{t_{n+1}} u'(\\tau) d\\tau \\right) - \\left(u(t_n) + h_n \\Phi(t_n, u(t_n), h_n)\\right) = \\int_{t_n}^{t_{n+1}} u'(\\tau) d\\tau - h_n \\Phi_n$。\n单步法的增量函数 $\\Phi_n$ 使用区间内一组固定的点来近似 $u'(\\tau)$ 的积分。由于 $u'(\\tau)$ 在积分区间内有跳跃不连续点，任何这种固定点求积法则都无法正确捕捉这个跳跃。用任何标准求积法则来近似一个带有跳跃不连续点的函数的积分，其误差为 $\\mathcal{O}(h_n)$。例如，对于前向欧拉法（$p=1$），局部误差为 $\\int_{t_n}^{t_{n+1}} (u'(\\tau) - u'(t_n))d\\tau$。这个积分包含了跳跃，其大小为 $\\mathcal{O}(h_n)$。同样的道理也适用于更高阶的方法；它们无法“看到”跳跃，并产生一个与步长 $h_n$ 和跳跃幅度 $s_+ - s_-$ 成正比的误差。因此，LTE 会降至 $\\mathcal{O}(h_n)$，无论标称阶数 $p$ 是多少。\n**结论：正确。**\n\n**B. 对于所描述的 $s(t)$ 中的单个跳跃，即使有一个步长跨越了跳跃，有限时间区间 $[0,T]$ 上的全局误差仍然按 $\\mathcal{O}(h^p)$ 缩放（对于一个 $p$ 阶方法），因为只有一个步长受到影响。**\n\n这个陈述是不正确的。在跨越不连续点的步长上，引入了一个大小为 $\\mathcal{O}(h_n)$ 的局部误差。对于一个稳定的 ODE 和方法，这个误差不是孤立的；它会传播并污染所有后续时间步的解。在稍后时间 $t_k$ 的误差是传播的初始误差和后续局部误差累积的总和。在 $t_{n+1}$ 时刻一个 $\\mathcal{O}(h)$ 的初始误差，通常会导致在最终时间 $T$ 产生至少 $\\mathcal{O}(h)$ 的误差。总的全局误差由这个被传播的大误差和在区间其余部分累积的较小的 $\\mathcal{O}(h^p)$ 误差之和主导。最终结果由大误差主导，导致全局误差为 $\\mathcal{O}(h)$。\n**结论：不正确。**\n\n**C. 如果步长控制器确保一个步长端点与 $t_d$ 精确重合（没有步长跨越不连续点），并且 $s(t)$ 在每一侧都是光滑的，那么在两个子区间上都恢复了标称阶数 $p$，并且全局误差按 $\\mathcal{O}(h^p)$ 缩放。**\n\n这是处理已知不连续点的标准、教科书式的策略。积分区间 $[0,T]$ 被分成两个子区间，$[0, t_d]$ 和 $[t_d, T]$。\n1.  从 $t=0$ 积分到 $t=t_d$。在这个子区间上，ODE 是 $u' = -\\lambda u + s_-$，它是光滑的。一个 $p$ 阶方法将在 $t_d$ 处达到 $\\mathcal{O}(h^p)$ 的全局误差。\n2.  从 $t=t_d$ 开始一个新的积分到 $t=T$，使用在 $t_d$ 计算出的值作为初始条件。在第二个子区间上，ODE 是 $u' = -\\lambda u + s_+$，它也是光滑的。局部误差将再次为 $\\mathcal{O}(h^{p+1})$ 阶，导致在这个子区间上累积的误差为 $\\mathcal{O}(h^p)$。\n在时间 $T$ 的总全局误差是在 $t_d$ 处的误差（传播到 $T$）和在 $[t_d, T]$ 上累积的误差的组合。两个贡献都是 $\\mathcal{O}(h^p)$，所以总的全局误差是 $\\mathcal{O}(h^p)$。\n**结论：正确。**\n\n**D. 一个稳健的维持精度的实用策略是... [描述了一个涉及不连续性指标、包围、精度为 $\\mathcal{O}(h^{p+1})$ 的求根，以及强制步长的算法]。这可以保持全局 $\\mathcal{O}(h^p)$ 阶精度。**\n\n这个陈述描述了一个完整且正确的自适应处理未知不连续点的算法。\n1.  **检测**：指标 $D_n \\equiv \\left\\| f(t_{n+1}, y_{n+1}^{\\mathrm{pred}}) - f(t_n, y_n) \\right\\|$ 是检测跳跃的一种有效方法。在光滑区域，$D_n = \\mathcal{O}(h_n)$。如果步长跨越跳跃，由于 $s(t)$ 的原因，$f$ 会有一个 $\\mathcal{O}(1)$ 的变化，所以 $D_n$ 变为 $\\mathcal{O}(1)$ 并将触发阈值。\n2.  **定位**：一旦检测到，可以通过包围程序（例如，对时间步进行二分）来定位跳跃。然后可以在一个合适的函数上应用求根方法来找到其位置 $t_d$。\n3.  **精度要求**：关键部分是以一个近似值 $t_d^*$ 来定位 $t_d$，使得 $|t_d - t_d^*| = \\mathcal{O}(h^{p+1})$。如果我们然后强制一个步长在 $t_d^*$ 结束，那么使用错误源项的微小区间 $[t_d, t_d^*]$（或 $[t_d^*, t_d]$）的长度为 $\\mathcal{O}(h^{p+1})$。在这个微小片段中产生的误差与其长度成正比，使得局部误差为 $\\mathcal{O}(h^{p+1})$。\n4.  **阶数保持**：一个 $\\mathcal{O}(h^{p+1})$ 的诱导局部误差与方法的标称局部截断误差是一致的。因此，它不会降低全局阶数，全局阶数仍然是 $\\mathcal{O}(h^p)$。所描述的策略是合理的。\n**结论：正确。**\n\n**E. 如果 $f(t,u)$ 在 $t_d$ 处连续，但其关于时间的一阶偏导数 $\\partial f/\\partial t$ 在 $t_d$ 处有有限跳跃，则任何显式单步法在跨越 $t_d$ 的步长上都会遭受 $\\mathcal{O}(h_n)$ 阶的局部误差，导致全局误差为 $\\mathcal{O}(h)$，除非步长被对齐。**\n\n在这种情况下，$u'(t) = f(t, u(t))$ 是连续的。二阶导数是 $u''(t) = \\frac{\\partial f}{\\partial t} + \\frac{\\partial f}{\\partial u} f(t,u)$。由于 $\\frac{\\partial f}{\\partial t}$ 有一个跳跃而其他项是连续的，所以 $u''(t)$ 有一个跳跃不连续点。解 $u(t)$ 是连续可微的（$u \\in C^1$），但不是二次连续可微的（$u \\notin C^2$）。光滑性指数是 $q=2$。根据阶数降低的标准理论，对于一个 $p$ 阶方法，全局误差为 $\\mathcal{O}(h^{\\min(p,q)})$。在这里，全局误差是 $\\mathcal{O}(h^{\\min(p,2)})$。这通常不是 $\\mathcal{O}(h)$。对于任何 $p \\ge 2$ 的方法，全局阶数为 $\\mathcal{O}(h^2)$，这比 $\\mathcal{O}(h)$ 要好。局部误差分析也显示出比所声称的更轻微的退化。因此，该陈述不正确。\n**结论：不正确。**\n\n**F. 如果 $f(t,u)$ 在 $t_d$ 处连续，但在 $t_d$ 处 $\\partial f/\\partial t$ 有有限跳跃，那么，在没有对齐的情况下，可达到的全局阶数最多为 $\\mathcal{O}(h^2)$：$p \\leq 2$ 的方法保持其标称阶数，而 $p  2$ 的方法会降至二阶。**\n\n这个陈述准确地描述了选项 E 中情景的后果。正如已确定的，$\\partial f/\\partial t$ 中的跳跃意味着解的光滑性为 $q=2$（$u''$ 有一个跳跃）。一个 $p$ 阶方法的全局阶数被限制为 $\\mathcal{O}(h^{\\min(p,q)})$。代入 $q=2$，全局阶数为 $\\mathcal{O}(h^{\\min(p,2)})$。\n-   如果 $p \\leq 2$，$\\min(p,2) = p$。方法保持其标称全局阶数 $\\mathcal{O}(h^p)$。\n-   如果 $p  2$，$\\min(p,2) = 2$。方法的阶数降低到 2，导致全局误差为 $\\mathcal{O}(h^2)$。\n该陈述准确地总结了这一分析。\n**结论：正确。**\n\n**G. 标准显式单步法对中可用的嵌入式误差估计器足以检测并精确定位 $t_d$，无需任何额外的逻辑，因为当且仅当步长端点与不连续点重合时，估计器为零。**\n\n这个陈述包含几个谬误。\n1.  **检测**：一个嵌入式误差估计器（例如，一个 $p$ 阶和一个 $(p-1)$ 阶解之间的差异）估计 LTE。当跨越 $f$ 中的一个跳跃时，两种方法的 LTE 都会变得很大，因此它们的差异（估计器）也会变得很大。这可以用来*检测*步长上的问题，但它不是唯一的方法。\n2.  **定位**：估计器为整个步长 $[t_n, t_{n+1}]$ 提供一个单一的值。它表明该步长是“坏的”，但没有提供关于不连续点在步长*内部何处*发生的信息。需要额外的逻辑，如选项 D 中描述的二分法/求根法，来定位 $t_d$。\n3.  **零估计器**：声称如果步长端点碰到不连续点，估计器就为零是错误的。如果一个步长正好在 $t_d$ 结束，即 $[t_n, t_d]$，那么问题在该区间上是光滑的。估计器将返回其正常的、非零的值，这是一个 $\\mathcal{O}(h^{p})$ 或 $\\mathcal{O}(h^{p+1})$ 阶的小量。除非方法对于给定的问题是精确的（这里不是这种情况），否则估计器通常不为零。\n**结论：不正确。**", "answer": "$$\\boxed{ACDF}$$", "id": "3590073"}]}