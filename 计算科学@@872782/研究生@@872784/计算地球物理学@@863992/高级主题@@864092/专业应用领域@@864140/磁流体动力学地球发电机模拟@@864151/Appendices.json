{"hands_on_practices": [{"introduction": "理解控制地球发电机的物理过程的第一步是确定主导的力平衡。本练习将指导您通过无量纲化磁流体动力学（MHD）方程，将复杂的物理项提炼为一组关键的无量纲数。通过编写程序计算这些参数并对动力学区域进行分类，您将获得关于不同物理参数如何塑造地核动力学行为的实践经验 [@problem_id:3608743]。", "problem": "您的任务是推导并在程序中评估在Boussinesq近似下，不可压缩、旋转的磁流体动力学地球发电机方程中出现的无量纲群。从基本守恒定律和定义出发，设计一个计算过程，为多个参数集生成诊断性的无量纲数和状态分类。\n\n给定在旋转球壳内部，密度恒定的不可压缩导电流体的有量纲控制方程如下：\n\n- 动量守恒（在以角频率 $\\Omega$ 绕固定轴旋转的参考系中）：\n$$\n\\rho\\left(\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} + 2\\,\\boldsymbol{\\Omega}\\times \\mathbf{u}\\right)\n= -\\nabla p + \\rho \\alpha g T' \\,\\hat{\\mathbf{r}} + \\frac{1}{\\mu_0}(\\nabla\\times \\mathbf{B}) \\times \\mathbf{B} + \\rho \\nu \\nabla^2 \\mathbf{u},\n$$\n其中 $\\rho$ 是密度，$\\mathbf{u}$ 是速度， $t$ 是时间，$\\boldsymbol{\\Omega}$ 是大小为 $\\Omega$ 的旋转矢量，$p$ 是压力，$\\alpha$ 是热膨胀系数，$g$ 是重力加速度大小，$T'$ 是温度扰动，$\\hat{\\mathbf{r}}$ 是径向单位矢量，$\\mu_0$ 是真空磁导率，$\\mathbf{B}$ 是磁通量密度，$\\nu$ 是运动黏度。\n\n- 感应方程：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u}\\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B},\n$$\n其中磁扩散率为 $\\eta$。\n\n- 温度扰动的热方程（线性化Boussinesq形式）：\n$$\n\\frac{\\partial T'}{\\partial t} + \\mathbf{u}\\cdot \\nabla T' + u_r \\frac{\\mathrm{d} \\bar{T}}{\\mathrm{d} r} = \\kappa \\nabla^2 T',\n$$\n其中热扩散率为 $\\kappa$，平均背景温度为 $\\bar{T}$，径向速度为 $u_r$。假设整个球壳的温差是固定的 $\\Delta T$。\n\n- 无散场约束：\n$$\n\\nabla \\cdot \\mathbf{u} = 0,\\quad \\nabla\\cdot \\mathbf{B} = 0.\n$$\n\n使用球壳厚度作为特征长度尺度 $L$，一个特征速度 $U$，旋转时间尺度 $1/\\Omega$，磁场尺度 $B_0$，以及温度尺度 $\\Delta T$ 对这些方程进行无量纲化。从第一性原理仔细辨别每个涌现出的无量纲群。需要表达并计算的预期无量纲群是：\n- Ekman数 $\\mathrm{E}$，\n- 磁Prandtl数 $\\mathrm{Pm}$，\n- Rayleigh数 $\\mathrm{Ra}$，\n- Rossby数 $\\mathrm{Ro}$，\n- 磁Reynolds数 $\\mathrm{Rm}$，\n- Elsasser数 $\\Lambda$。\n\n所有量和参数都用国际单位制（SI）表示：米、千克、秒、开尔文、特斯拉。您的最终程序必须使用您推导的定义为每个测试案例计算这六个无量纲数，并使用以下逻辑对主导力平衡状态进行分类：\n- 惯性主导（代码 $2$）：如果 $\\mathrm{Ro} \\geq 1$。\n- 磁地转（代码 $1$）：如果 $\\mathrm{Ro} < 0.1$，$\\mathrm{E} < 10^{-4}$，并且 $0.1 \\le \\Lambda \\le 10$。\n- 地转（代码 $0$）：如果 $\\mathrm{Ro} < 0.1$，$\\mathrm{E} < 10^{-4}$，并且 $\\Lambda < 0.1$。\n如果一个案例不满足上述任何条件，您可以假设它是过渡状态；但是，所提供的测试集被选择以避免过渡分类。\n\n设计参数扫描，以强调单个目标无量纲群的变化，同时受定义中固有的代数耦合影响。使用以下参数集（测试集），每个都以元组形式提供\n$$\n(L,\\ \\rho,\\ \\Omega,\\ \\nu,\\ \\eta,\\ \\kappa,\\ \\alpha,\\ g,\\ \\Delta T,\\ U,\\ B_0),\n$$\n单位为SI单位：\n- 案例 1（地转基线）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n- 案例 2（通过增加 $\\Lambda$ 实现磁地转）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 2\\times 10^{-3})$。\n- 案例 3（通过慢速旋转增加 $\\mathrm{Ro}$ 实现惯性主导）：$(1\\times 10^{5},\\ 7\\times 10^{3},\\ 1\\times 10^{-6},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-1},\\ 1\\times 10^{-4})$。\n- 案例 4（通过增加 $\\nu$ 实现Ekman扫描）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-3},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n- 案例 5（通过减少 $\\eta$ 实现磁Prandtl扫描）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-2},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n- 案例 6（通过 $B_0 = 0$ 实现零Elsasser数）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 0)$。\n- 案例 7（通过大 $\\eta$ 实现低磁Reynolds数）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8,\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n\n您的程序必须为每个案例计算六个无量纲数和状态代码，然后输出一个单行字符串，表示一个包含七个子列表的列表。每个子列表必须按以下顺序包含六个数和一个整数状态代码\n$$\n[\\mathrm{E},\\ \\mathrm{Pm},\\ \\mathrm{Ra},\\ \\mathrm{Ro},\\ \\mathrm{Rm},\\ \\Lambda,\\ \\text{code}],\n$$\n每个浮点值都精确到六位有效数字。输出不得包含空格。例如，一个有效的整体输出格式是\n$$\n[[x_{11},x_{12},\\dots,x_{17}],[x_{21},x_{22},\\dots,x_{27}],\\dots,[x_{71},x_{72},\\dots,x_{77}]].\n$$\n\n所有输出都是无单位的。如果使用了角度，必须以弧度为单位；但是，所需输出中没有角度。\n\n您的实现必须是一个完整的、可运行的程序，仅使用指定的库，并按指定格式精确打印一行。", "solution": "该问题要求推导和计算地球发电机模型中磁流体动力学（MHD）的六个关键无量纲数，然后对动力学状态进行分类。此过程首先对Boussinesq近似下，旋转参考系中不可压缩导电流体的控制方程进行无量纲化。\n\n提供了动量、磁场（感应）和温度的控制方程，以及无散场约束。我们将使用给定的特征尺度对这些方程进行无量纲化：\n- 长度：$L$（球壳厚度）\n- 速度：$U$（特征速度）\n- 时间：$1/\\Omega$（旋转速率的倒数）\n- 磁场：$B_0$（特征场强）\n- 温度扰动：$\\Delta T$（特征温差）\n\n我们定义无量纲变量（用帽子符号表示）如下：\n$$ \\hat{\\mathbf{r}} = \\frac{\\mathbf{r}}{L}, \\quad \\hat{t} = t\\Omega, \\quad \\hat{\\mathbf{u}} = \\frac{\\mathbf{u}}{U}, \\quad \\hat{\\mathbf{B}} = \\frac{\\mathbf{B}}{B_0}, \\quad \\hat{T'} = \\frac{T'}{\\Delta T} $$\n空间导数算子的尺度为 $\\nabla = \\frac{1}{L}\\hat{\\nabla}$。压力基于地转平衡进行尺度化，其中压力梯度与科里奥利力平衡：$p_0 = \\rho_0 \\Omega U L$。因此，$\\hat{p} = p/p_0$。\n\n**1. 动量方程的无量纲化**\n\n有量纲的动量方程为：\n$$\n\\rho\\left(\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} + 2\\,\\boldsymbol{\\Omega}\\times \\mathbf{u}\\right)\n= -\\nabla p + \\rho \\alpha g T' \\,\\hat{\\mathbf{r}} + \\frac{1}{\\mu_0}(\\nabla\\times \\mathbf{B}) \\times \\mathbf{B} + \\rho \\nu \\nabla^2 \\mathbf{u}\n$$\n代入尺度化变量及其对应的有量纲尺度：\n$$\n\\rho\\left(U\\Omega \\frac{\\partial \\hat{\\mathbf{u}}}{\\partial \\hat{t}} + \\frac{U^2}{L} \\hat{\\mathbf{u}}\\cdot\\hat{\\nabla} \\hat{\\mathbf{u}} + 2\\Omega U (\\hat{\\mathbf{z}}\\times \\hat{\\mathbf{u}})\\right)\n= - \\frac{\\rho \\Omega U L}{L} \\hat{\\nabla} \\hat{p} + \\rho \\alpha g \\Delta T \\hat{T'} \\,\\hat{\\mathbf{r}} + \\frac{B_0^2}{\\mu_0 L}(\\hat{\\nabla}\\times \\hat{\\mathbf{B}}) \\times \\hat{\\mathbf{B}} + \\frac{\\rho \\nu U}{L^2} \\hat{\\nabla}^2 \\hat{\\mathbf{u}}\n$$\n我们将方程除以科里奥利力尺度的量级 $\\rho \\Omega U$ 进行归一化：\n$$\n\\frac{\\partial \\hat{\\mathbf{u}}}{\\partial \\hat{t}} + \\left(\\frac{U}{\\Omega L}\\right) \\hat{\\mathbf{u}}\\cdot\\hat{\\nabla} \\hat{\\mathbf{u}} + 2(\\hat{\\mathbf{z}}\\times \\hat{\\mathbf{u}})\n= - \\hat{\\nabla} \\hat{p} + \\left(\\frac{\\alpha g \\Delta T}{\\Omega U}\\right) \\hat{T'} \\hat{\\mathbf{r}} + \\left(\\frac{B_0^2}{\\mu_0 \\rho \\Omega U L}\\right)(\\hat{\\nabla}\\times \\hat{\\mathbf{B}}) \\times \\hat{\\mathbf{B}} + \\left(\\frac{\\nu}{\\Omega L^2}\\right) \\hat{\\nabla}^2 \\hat{\\mathbf{u}}\n$$\n从各项的系数中，我们直接识别出两个无量纲数：\n- **Rossby数**，$\\mathrm{Ro}$，是惯性项的系数，代表惯性力与科里奥利力之比：$\\mathrm{Ro} = \\frac{U}{\\Omega L}$。\n- **Ekman数**，$\\mathrm{E}$，是黏性项的系数，代表黏性力与科里奥利力之比：$\\mathrm{E} = \\frac{\\nu}{\\Omega L^2}$。\n\n**2. 感应方程的无量纲化**\n\n有量纲的感应方程为：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u}\\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B}\n$$\n代入尺度化变量：\n$$\nB_0 \\Omega \\frac{\\partial \\hat{\\mathbf{B}}}{\\partial \\hat{t}} = \\frac{U B_0}{L} \\hat{\\nabla} \\times (\\hat{\\mathbf{u}}\\times \\hat{\\mathbf{B}}) + \\frac{\\eta B_0}{L^2} \\hat{\\nabla}^2 \\hat{\\mathbf{B}}\n$$\n除以 $B_0 \\Omega$：\n$$\n\\frac{\\partial \\hat{\\mathbf{B}}}{\\partial \\hat{t}} = \\left(\\frac{U}{\\Omega L}\\right) \\hat{\\nabla} \\times (\\hat{\\mathbf{u}}\\times \\hat{\\mathbf{B}}) + \\left(\\frac{\\eta}{\\Omega L^2}\\right) \\hat{\\nabla}^2 \\hat{\\mathbf{B}}\n$$\n感应项的系数是Rossby数，$\\mathrm{Ro}$。磁扩散项的系数 $\\frac{\\eta}{\\Omega L^2}$ 可以与其他数相关联。通过引入**磁Reynolds数**，$\\mathrm{Rm} = \\frac{UL}{\\eta}$，它衡量磁场平流与磁扩散之比，我们可以将该系数写为 $\\frac{\\eta}{UL} \\frac{U}{\\Omega L} = \\frac{\\mathrm{Ro}}{\\mathrm{Rm}}$。\n\n**3. 所需无量纲群的定义**\n\n基于上述推导和标准物理定义，我们建立所需六个数的公式。\n\n- **Ekman数, E**：黏性力与科里奥利力之比。\n$$ \\mathrm{E} = \\frac{\\nu}{\\Omega L^2} $$\n- **磁Prandtl数, Pm**：运动黏度（动量扩散率）与磁扩散率之比。它是一个流体性质，不是从单个方程的尺度分析中得出的，而是通过比较动量和感应方程中各自的扩散项得出的。\n$$ \\mathrm{Pm} = \\frac{\\nu}{\\eta} $$\n- **Rayleigh数, Ra**：代表浮力驱动力与耗散力（黏性和热力）之比。其标准定义在量纲上是一致的：\n$$ \\mathrm{Ra} = \\frac{\\alpha g \\Delta T L^3}{\\nu \\kappa} $$\n- **Rossby数, Ro**：惯性力与科里奥利力之比。\n$$ \\mathrm{Ro} = \\frac{U}{\\Omega L} $$\n- **磁Reynolds数, Rm**：磁场平流与磁扩散之比。\n$$ \\mathrm{Rm} = \\frac{UL}{\\eta} $$\n- **Elsasser数, $\\Lambda$**：洛伦兹力与科里奥利力之比。我们将使用的地球发电机理论中的标准定义包含了磁扩散率。真空磁导率 $\\mu_0$ 取为 $4\\pi\\times 10^{-7} \\, \\mathrm{H/m}$。\n$$ \\Lambda = \\frac{B_0^2}{\\rho \\mu_0 \\eta \\Omega} $$\n\n这些公式被用来计算每个参数集的无量纲数。然后根据给定的 $\\mathrm{Ro}$、$\\mathrm{E}$ 和 $\\Lambda$ 的阈值对动力学状态进行分类。\n- **惯性主导（代码 $2$）**：$\\mathrm{Ro} \\ge 1$。\n- **磁地转（代码 $1$）**：$\\mathrm{Ro}  0.1$，$\\mathrm{E}  10^{-4}$，且 $0.1 \\le \\Lambda \\le 10$。\n- **地转（代码 $0$）**：$\\mathrm{Ro}  0.1$，$\\mathrm{E}  10^{-4}$，且 $\\Lambda  0.1$。\n\n算法将遍历每个测试案例，应用这些定义，确定状态代码，并将输出格式化为表示列表的列表的单行字符串，每个浮点数使用科学记数法格式化为六位有效数字。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes non-dimensional groups for magnetohydrodynamic \n    geodynamo equations and classifies the dynamical regime.\n    \"\"\"\n    \n    # Fundamental constant: magnetic permeability of free space (H/m)\n    MU_0 = 4 * np.pi * 1e-7\n\n    # Each test case is a tuple:\n    # (L, rho, Omega, nu, eta, kappa, alpha, g, DeltaT, U, B0)\n    test_cases = [\n        # Case 1 (geostrophic baseline)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 2 (magnetostrophic via Lambda increase)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 2e-3),\n        # Case 3 (inertia-dominated via Ro increase)\n        (1e5, 7e3, 1e-6, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-1, 1e-4),\n        # Case 4 (Ekman sweep via nu increase)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-3, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 5 (magnetic Prandtl sweep via eta decrease)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-2, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 6 (zero Elsasser via B0 = 0)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 0),\n        # Case 7 (low magnetic Reynolds via large eta)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8.0, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        L, rho, Omega, nu, eta, kappa, alpha, g, DeltaT, U, B0 = case\n\n        # Compute the six non-dimensional numbers\n        E = nu / (Omega * L**2)\n        Pm = nu / eta\n        Ra = (alpha * g * DeltaT * L**3) / (nu * kappa)\n        Ro = U / (Omega * L)\n        Rm = (U * L) / eta\n        \n        # Handle B0=0 case for Lambda to avoid division by zero if rho, eta or Omega is zero (not in tests)\n        if B0 == 0:\n            Lambda = 0.0\n        else:\n            Lambda = B0**2 / (rho * MU_0 * eta * Omega)\n\n        # Classify the regime\n        code = -1 # Default/transitional, though problem states this won't happen\n        if Ro = 1:\n            code = 2  # Inertia-dominated\n        elif Ro  0.1 and E  1e-4 and 0.1 = Lambda = 10:\n            code = 1  # Magnetostrophic\n        elif Ro  0.1 and E  1e-4 and Lambda  0.1:\n            code = 0  # Geostrophic\n\n        # Store results for this case\n        case_results = [E, Pm, Ra, Ro, Rm, Lambda, code]\n        all_results.append(case_results)\n\n    # Format the final output string\n    # Each float must be rendered to exactly six significant figures in scientific notation.\n    # The integer code is rendered as is.\n    output_sublists = []\n    for result_set in all_results:\n        formatted_floats = [f\"{v:.5e}\" for v in result_set[:6]]\n        code_str = str(result_set[6])\n        sublist_str = f\"[{','.join(formatted_floats + [code_str])}]\"\n        output_sublists.append(sublist_str)\n        \n    final_output_str = f\"[{','.join(output_sublists)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```", "id": "3608743"}, {"introduction": "地球发电机模拟涉及在截然不同的时间尺度上运行的物理过程，从快速的阿尔芬波和惯性波到缓慢的对流，这导致了数值求解上具有挑战性的“刚性”方程组。本练习介绍了一种强大的隐式-显式（IMEX）时间积分方案，它通过隐式处理快速线性项来确保稳定性，同时显式处理非线性项以提高计算效率。通过为一个简化的模型实施并分析IMEX积分器，您将掌握为多尺度地球物理问题选择和评估时间积分方法的关键技能 [@problem_id:3608672]。", "problem": "你的任务是为一个简化的磁流体动力学地球发电机模型设计和评估一个一阶隐式-显式 (IMEX) 时间积分器。该模型通过隐式处理线性波动力学来稳定快速的阿尔芬波和惯性波，同时显式处理非线性平流。从线性化、不可压缩、旋转的磁流体动力学 (MHD) 方程出发，围绕均匀磁场，在傅里叶空间中为与旋转轴和磁场轴对齐的单个波矢建立模型。基于第一性原理，为不同参数体系下的显式 Courant-Friedrichs-Lewy (CFL) 限制建立一个性能模型，并基于最快的线性波来量化一个受精度限制的时间步长。\n\n基本基础和模型规范：\n- 从具有均匀背景磁场的不可压缩、旋转 MHD 方程开始。动量方程为\n$$\n\\rho \\, \\frac{\\partial \\mathbf{v}}{\\partial t} = - \\nabla p - 2 \\rho \\, \\mathbf{\\Omega} \\times \\mathbf{v} + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{b}) \\times \\mathbf{B}_0 + \\rho \\, \\nu \\nabla^2 \\mathbf{v},\n$$\n感应方程为\n$$\n\\frac{\\partial \\mathbf{b}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}_0) + \\eta \\nabla^2 \\mathbf{b},\n$$\n其中 $\\,\\mathbf{v}\\,$ 是速度，$\\,\\mathbf{b}\\,$ 是磁场扰动，$\\,p\\,$ 是压力，$\\,\\rho\\,$ 是密度，$\\,\\nu\\,$ 是运动粘度，$\\,\\eta\\,$ 是磁扩散率，$\\,\\mu_0\\,$ 是自由空间磁导率，$\\,\\mathbf{\\Omega}\\,$ 是旋转矢量。假设 $\\,\\nabla \\cdot \\mathbf{v} = 0\\,$ 和 $\\,\\nabla \\cdot \\mathbf{b} = 0\\,$。\n\n- 考虑一个与均匀背景磁场 $\\,\\mathbf{B}_0 = B_0 \\, \\hat{\\mathbf{z}}\\,$ 和旋转 $\\,\\mathbf{\\Omega} = \\Omega \\, \\hat{\\mathbf{z}}\\,$ 对齐的单一傅里叶模式，其波矢为 $\\,\\mathbf{k} = k \\, \\hat{\\mathbf{z}}\\,$。对于垂直于 $\\,\\hat{\\mathbf{z}}\\,$ 的扰动，傅里叶空间中 $\\,x\\,$ 和 $\\,y\\,$ 分量的线性化系统为\n$$\n\\frac{\\partial v_x}{\\partial t} = + 2 \\Omega v_y + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_x - \\nu k^2 v_x, \\quad\n\\frac{\\partial v_y}{\\partial t} = - 2 \\Omega v_x + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_y - \\nu k^2 v_y,\n$$\n$$\n\\frac{\\partial b_x}{\\partial t} = i k B_0 \\, v_x - \\eta k^2 b_x, \\quad\n\\frac{\\partial b_y}{\\partial t} = i k B_0 \\, v_y - \\eta k^2 b_y.\n$$\n定义状态向量 $\\,\\mathbf{U} = [v_x, v_y, b_x, b_y]^\\top\\,$ 并将系统写为 $\\,\\partial_t \\mathbf{U} = \\mathbf{L} \\mathbf{U} + \\mathbf{N}(\\mathbf{U})\\,$，其中 $\\,\\mathbf{L}\\,$ 是包含科里奥利项、阿尔芬项和扩散项的线性算子。在单模截断中，显式平流项 $\\,\\mathbf{N}(\\mathbf{U})\\,$ 不会对相同的傅里叶模式产生贡献；为了稳定性建模，你可以设置 $\\,\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}\\,$，但仍使用速度幅值施加显式 CFL 约束。\n\n- 实现一阶 IMEX 欧拉格式：\n$$\n\\mathbf{U}^{n+1} = \\left( \\mathbf{I} - \\Delta t \\, \\mathbf{L} \\right)^{-1} \\left[ \\mathbf{U}^{n} + \\Delta t \\, \\mathbf{N}(\\mathbf{U}^{n}) \\right],\n$$\n根据上述理由，设 $\\,\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}\\,$。隐式处理 $\\,\\mathbf{L}\\,$ 可以稳定快速的惯性波和阿尔芬波。\n\n性能模型：\n- 将显式平流 CFL 时间步长定义为\n$$\n\\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\, \\frac{\\Delta x}{\\max(|v_x|,|v_y|)},\n$$\n其中 $\\,C_{\\text{cfl}} \\in (0,1)\\,$ 是 Courant 因子，$\\,\\Delta x\\,$ 是网格间距。\n\n- 根据最快的线性波（忽略扩散）定义一个面向精度的时间步长\n$$\n\\Delta t_{\\text{acc}} = \\frac{C_{\\text{acc}}}{\\omega_{\\max}},\n$$\n其中 $\\,C_{\\text{acc}} \\in (0,1)\\,$ 是一个精度因子，$\\,\\omega_{\\max}\\,$ 是通过将扩散项设为零从 $\\,\\mathbf{L}\\,$ 得到的无扩散线性算子 $\\,\\mathbf{L}_0\\,$ 的特征值虚部的最大绝对值。最快的波包括频率为 $\\,\\omega_A = k v_A\\,$ 的阿尔芬波，其中 $\\,v_A = B_0/\\sqrt{\\mu_0 \\rho}\\,$，以及在假定对齐方式下频率为 $\\,\\omega_I = 2 \\Omega\\,$ 的惯性波。\n\n- 选择模型时间步长 $\\,\\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})\\,$. 为了用 IMEX 欧拉格式进行稳定性验证，计算放大矩阵 $\\,\\mathbf{G} = \\left( \\mathbf{I} - \\Delta t_{\\text{model}} \\, \\mathbf{L} \\right)^{-1}\\,$ 及其谱半径。此外，计算总能量\n$$\nE = \\frac{1}{2} \\rho \\left( |v_x|^2 + |v_y|^2 \\right) + \\frac{1}{2 \\mu_0} \\left( |b_x|^2 + |b_y|^2 \\right),\n$$\n在一步 IMEX 步进前后，并使用 $\\,E^{n+1} \\le E^n\\,$ 作为对此隐式格式单调阻尼的实用性检查。\n\n数值单位：\n- 使用 $\\,\\rho\\,$ 单位为 $\\mathrm{kg/m^3}$，$\\,B_0\\,$ 单位为 $\\mathrm{T}$，$\\,\\Omega\\,$ 单位为 $\\mathrm{s^{-1}}$，$\\,k\\,$ 单位为 $\\mathrm{m^{-1}}$，$\\,\\nu\\,$ 和 $\\,\\eta\\,$ 单位为 $\\mathrm{m^2/s}$，$\\,\\Delta x\\,$ 单位为 $\\mathrm{m}$，速度单位为 $\\mathrm{m/s}$。所有时间步长以秒为单位报告。\n\n测试套件：\n使用以下四种参数体系实现上述内容，其中 $\\,\\mu_0 = 4 \\pi \\times 10^{-7}\\,$ 单位为 $\\mathrm{H/m}$，$\\,C_{\\text{cfl}} = 0.5\\,$，$\\,C_{\\text{acc}} = 0.2\\,$，初始状态为 $\\,v_x(0) = U_0\\,$, $\\,v_y(0) = 0.4 U_0\\,$, $\\,b_x(0) = 0\\,$, $\\,b_y(0) = 0\\,$：\n\n- 情况 $\\,1\\,$ (平流限制)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-3}\\,$, $\\,\\Omega = 10^{-3}\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- 情况 $\\,2\\,$ (阿尔芬精度限制)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-1}\\,$, $\\,\\Omega = 10^{-3}\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- 情况 $\\,3\\,$ (惯性精度限制)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-3}\\,$, $\\,\\Omega = 50\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- 情况 $\\,4\\,$ (弱平流，长波)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-2}\\,$, $\\,\\Omega = 10^{-4}\\,$, $\\,k = 1\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 10^{-3}\\,$.\n\n所需输出和格式：\n- 对于每种情况，计算并返回列表 $\\, [\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}}, \\Delta t_{\\text{model}}, \\text{stable}] \\,$，其中前三项是浮点数，单位为秒，四舍五入到六位小数，最后一项是布尔值，表示 $\\,\\mathbf{G}\\,$ 的谱半径是否最多为 $\\,1\\,$ 且一步后 $\\,E^{n+1} \\le E^n\\,$ 是否成立。你的程序应生成一行输出，其中包含这些四元素列表的逗号分隔列表，并用方括号括起来（例如，$\\,[[0.05,0.00448,0.00448,True],\\ldots]\\,$）。", "solution": "该问题要求针对一个与地球发电机模型相关的简化磁流体动力学（MHD）系统，分析一种一阶隐式-显式（IMEX）时间积分格式。分析内容包括推导时间步长约束，为单个傅里叶模式实现该数值格式，并在不同的物理体系下验证其稳定性。\n\n### **问题验证**\n\n该问题在科学和数学上是适定的。控制方程是标准的、线性化的、不可压缩的旋转磁流体动力学方程。简化为与旋转矢量和背景磁场对齐的单个傅里叶模式，是研究基本波动力学（阿尔芬波和惯性波）的一种常见且有效的分析方法。IMEX 欧拉格式是一种标准的数值方法，其在此处的应用有明确定义。所有必需的参数、常数和初始条件均已提供。分析任务，包括计算时间步长限制以及通过谱半径和能量演化进行稳定性验证，是计算物理学中的标准程序。因此，该问题是有效的，可以构建解决方案。\n\n### **理论构建**\n\n该方程组控制状态向量 $\\mathbf{U} = [v_x, v_y, b_x, b_y]^\\top$ 的演化，该向量代表横向速度和磁场扰动的复傅里叶振幅。其演化由 $\\partial_t \\mathbf{U} = \\mathbf{L} \\mathbf{U}$ 描述，对于此单模线性分析，非线性平流项 $\\mathbf{N}(\\mathbf{U})$ 被忽略。\n\n根据所提供的方程：\n$$\n\\frac{\\partial v_x}{\\partial t} = + 2 \\Omega v_y + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_x - \\nu k^2 v_x \\\\\n\\frac{\\partial v_y}{\\partial t} = - 2 \\Omega v_x + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_y - \\nu k^2 v_y \\\\\n\\frac{\\partial b_x}{\\partial t} = i k B_0 \\, v_x - \\eta k^2 b_x \\\\\n\\frac{\\partial b_y}{\\partial t} = i k B_0 \\, v_y - \\eta k^2 b_y\n$$\n\n线性算子 $\\mathbf{L}$ 是一个 $4 \\times 4$ 的复数矩阵：\n$$\n\\mathbf{L} = \\begin{pmatrix}\n-\\nu k^2  2\\Omega  i \\frac{k B_0}{\\mu_0 \\rho}  0 \\\\\n-2\\Omega  -\\nu k^2  0  i \\frac{k B_0}{\\mu_0 \\rho} \\\\\ni k B_0  0  -\\eta k^2  0 \\\\\n0  i k B_0  0  -\\eta k^2\n\\end{pmatrix}\n$$\n\n### **时间步长计算**\n\n模型时间步长 $\\Delta t_{\\text{model}}$ 由两个约束决定：一个平流 CFL 条件和一个基于线性波频率的精度条件。\n\n1.  **平流时间步长, $\\Delta t_{\\text{adv}}$**: 这是一个显式的 CFL 类型约束，与平流的显式处理相关。尽管在我们的线性模型中 $\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}$，我们仍为性能建模计算此值。\n    $$\n    \\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\, \\frac{\\Delta x}{\\max(|v_x|,|v_y|)}\n    $$\n    给定 $C_{\\text{cfl}} = 0.5$ 以及初始速度 $v_x(0) = U_0$ 和 $v_y(0) = 0.4 U_0$，这变为 $\\Delta t_{\\text{adv}} = 0.5 \\frac{\\Delta x}{U_0}$。\n\n2.  **精度时间步长, $\\Delta t_{\\text{acc}}$**: 此步长确保最快的线性波在时间上得到解析。其定义为：\n    $$\n    \\Delta t_{\\text{acc}} = \\frac{C_{\\text{acc}}}{\\omega_{\\max}}\n    $$\n    这里，$C_{\\text{acc}} = 0.2$，而 $\\omega_{\\max}$ 是非耗散线性算子 $\\mathbf{L}_0$（其中 $\\nu = 0$ 和 $\\eta = 0$）的特征值虚部的最大绝对值。\n\n为了找到 $\\omega_{\\max}$，我们分析 $\\mathbf{L}_0$ 的特征值。该系统可以使用圆偏振变量进行解耦。$\\mathbf{L}_0$ 的特征值被发现是纯虚数，$\\lambda = i\\omega$，其中频率 $\\omega$ 满足色散关系：\n$$\n\\omega = \\pm \\left( \\Omega \\pm \\sqrt{\\Omega^2 + \\omega_A^2} \\right)\n$$\n其中 $\\omega_A = k v_A = k B_0 / \\sqrt{\\mu_0 \\rho}$ 是阿尔芬频率。因此，最大绝对频率为：\n$$\n\\omega_{\\max} = \\Omega + \\sqrt{\\Omega^2 + \\omega_A^2}\n$$\n\n3.  **模型时间步长, $\\Delta t_{\\text{model}}$**: 用于积分的最终时间步长是两个约束中的最小值：\n    $$\n    \\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})\n    $$\n\n### **数值格式与稳定性分析**\n\n对于线性系统，当 $\\mathbf{N}(\\mathbf{U})=\\mathbf{0}$ 时，一阶 IMEX 欧拉格式简化为一阶隐式欧拉（或后向欧拉）格式：\n$$\n\\mathbf{U}^{n+1} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1} \\mathbf{U}^{n}\n$$\n该格式的稳定性通过两个标准评估：\n\n1.  **谱半径**: 放大矩阵为 $\\mathbf{G} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1}$。如果谱半径 $\\rho(\\mathbf{G}) = \\max_i |\\lambda_i(\\mathbf{G})| \\le 1$，则该格式是数值稳定的。由于物理系统是耗散的（$\\mathbf{L}$ 的特征值具有非正实部），并且隐式欧拉格式是 A-稳定的，我们预期对于任何 $\\Delta t  0$，都有 $\\rho(\\mathbf{G}) \\le 1$。\n\n2.  **能量演化**: 该模式的单位体积总能量为：\n    $$\n    E = \\frac{1}{2} \\rho \\left( |v_x|^2 + |v_y|^2 \\right) + \\frac{1}{2 \\mu_0} \\left( |b_x|^2 + |b_y|^2 \\right)\n    $$\n    对于用稳定隐式格式积分的耗散系统，能量不应增长。我们检查在一个时间步后是否有 $E^{n+1} \\le E^n$。\n\n如果 $\\rho(\\mathbf{G}) \\le 1$ 和 $E^{n+1} \\le E^n$ 都为真，则认为一个情况是“稳定的”。\n\n### **测试案例的算法和实现**\n\n对于四个测试案例中的每一个，执行以下步骤：\n1.  定义所有物理和数值参数：$\\rho$, $B_0$, $\\Omega$, $k$, $\\nu$, $\\eta$, $\\Delta x$, $U_0$, $\\mu_0$, $C_{\\text{cfl}}$, $C_{\\text{acc}}$。\n2.  计算 $\\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\Delta x / U_0$。\n3.  计算阿尔芬频率 $\\omega_A = k B_0 / \\sqrt{\\mu_0 \\rho}$。\n4.  计算最大波频率 $\\omega_{\\max} = \\Omega + \\sqrt{\\Omega^2 + \\omega_A^2}$。\n5.  计算 $\\Delta t_{\\text{acc}} = C_{\\text{acc}} / \\omega_{\\max}$。\n6.  设置 $\\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})$。\n7.  使用案例参数构建 $4 \\times 4$ 复数矩阵 $\\mathbf{L}$。\n8.  计算放大矩阵 $\\mathbf{G} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1}$。\n9.  计算 $\\mathbf{G}$ 的特征值并找到谱半径 $\\rho(\\mathbf{G})$。\n10. 设置初始状态向量 $\\mathbf{U}^0 = [U_0, 0.4 U_0, 0, 0]^\\top$。\n11. 计算一步之后的状态：$\\mathbf{U}^1 = \\mathbf{G} \\mathbf{U}^0$。\n12. 根据 $\\mathbf{U}^0$ 计算初始能量 $E^0$，根据 $\\mathbf{U}^1$ 计算最终能量 $E^1$。\n13. 根据 $\\rho(\\mathbf{G}) \\le 1$ 和 $E^1 \\le E^0$ 确定稳定性标志。\n14. 存储列表 $[\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}}, \\Delta t_{\\text{model}}, \\text{stable}]$，其中浮点数值四舍五入到六位小数。\n\n对所有四种情况重复此过程，以生成最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the IMEX geodynamo model problem for the given test cases.\n    \"\"\"\n    \n    # Define physical and numerical constants\n    MU_0 = 4 * np.pi * 1e-7  # H/m\n    C_CFL = 0.5\n    C_ACC = 0.2\n    \n    # (rho, B0, Omega, k, nu, eta, dx, U0)\n    test_cases = [\n        # Case 1 (advection-limited)\n        (1e4, 5e-3, 1e-3, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 2 (Alfvén accuracy-limited)\n        (1e4, 5e-1, 1e-3, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 3 (inertial accuracy-limited)\n        (1e4, 5e-3, 50, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 4 (weak advection, long waves)\n        (1e4, 5e-2, 1e-4, 1, 1e-6, 1, 0.1, 1e-3),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        rho, B0, Omega, k, nu, eta, dx, U0 = case\n\n        # Initial state\n        u0_vec = np.array([U0, 0.4 * U0, 0, 0], dtype=np.complex128)\n\n        # 1. Calculate advective time step\n        max_v = max(np.abs(u0_vec[0]), np.abs(u0_vec[1]))\n        dt_adv = C_CFL * dx / max_v\n\n        # 2. Calculate accuracy time step\n        omega_A = k * B0 / np.sqrt(MU_0 * rho)\n        omega_max = Omega + np.sqrt(Omega**2 + omega_A**2)\n        dt_acc = C_ACC / omega_max\n\n        # 3. Determine model time step\n        dt_model = min(dt_adv, dt_acc)\n\n        # 4. Construct linear operator L\n        L = np.zeros((4, 4), dtype=np.complex128)\n        \n        # Diagonal terms\n        L[0, 0] = -nu * k**2\n        L[1, 1] = -nu * k**2\n        L[2, 2] = -eta * k**2\n        L[3, 3] = -eta * k**2\n        \n        # Coriolis terms\n        L[0, 1] = 2 * Omega\n        L[1, 0] = -2 * Omega\n        \n        # Lorentz force terms\n        L[0, 2] = 1j * k * B0 / (MU_0 * rho)\n        L[1, 3] = 1j * k * B0 / (MU_0 * rho)\n        \n        # Induction terms\n        L[2, 0] = 1j * k * B0\n        L[3, 1] = 1j * k * B0\n\n        # 5. Stability Analysis\n        I = np.identity(4)\n        G = np.linalg.inv(I - dt_model * L)\n        \n        # Spectral radius check\n        eigenvalues_G = np.linalg.eigvals(G)\n        spectral_radius = np.max(np.abs(eigenvalues_G))\n        stable_spectral = spectral_radius = 1.0 + 1e-9\n\n        # Energy check\n        def calculate_energy(U):\n            vx, vy, bx, by = U\n            kinetic_energy = 0.5 * rho * (np.abs(vx)**2 + np.abs(vy)**2)\n            magnetic_energy = 0.5 / MU_0 * (np.abs(bx)**2 + np.abs(by)**2)\n            return kinetic_energy + magnetic_energy\n\n        energy_0 = calculate_energy(u0_vec)\n        u1_vec = G @ u0_vec\n        energy_1 = calculate_energy(u1_vec)\n        stable_energy = energy_1 = energy_0 + 1e-9\n\n        is_stable = stable_spectral and stable_energy\n        \n        result = [dt_adv, dt_acc, dt_model, is_stable]\n        all_results.append(result)\n\n    # Format output string\n    str_results = []\n    for r in all_results:\n        # Format floats to 6 decimal places, boolean as is\n        s = f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{r[3]}]\"\n        str_results.append(s)\n        \n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```", "id": "3608672"}, {"introduction": "谱方法因其高精度而在地球发电机模拟中被广泛使用，但其计算成本主要由非线性项的评估所决定。本练习深入探讨了谱方法复杂性的核心，即研究感应方程中非线性平流项所产生的三元相互作用。通过对符合特定选择定则的相互作用谱模式进行计数，并凭经验估计计算量的标度律，您将对这些模拟的计算需求及其来源有一个具体的、定量的理解 [@problem_id:3608698]。", "problem": "您正在对球壳中的地球发电机建立磁流体动力学感应方程的谱形式模型。感应方程中的非线性项通过三元相互作用耦合了各个谱模式。在一个由最大球谐函数阶数和次数定义的谱截断中，您将计算角动量耦合约束下所有容许的三元相互作用，并估计计算量随截断的变化关系。\n\n起点：感应方程由 $\\,\\partial \\mathbf{B} / \\partial t = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B}\\,$ 给出，其中 $\\,\\mathbf{u}\\,$ 是速度场，$\\,\\mathbf{B}\\,$ 是磁场，$\\,\\eta\\,$ 是磁扩散率。在使用球谐函数的球面上伪谱表示中，场的乘积会在谱空间中引起一个由角动量耦合系数（Gaunt积分或等效的Wigner $\\,3j\\,$ 符号）介导的卷积。对于标量球谐函数 $\\,Y_{\\ell}^{m}\\,$，以下选择定则总结了三个球谐函数的三重积分何时非零（当用具有适当宇称的球谐函数基表示时，相同的约束也控制着哪些模式三元组能在感应方程的非线性项中相互作用）：\n\n- 阶的三角不等式：$\\,|\\ell_1 - \\ell_2| \\le L \\le \\ell_1 + \\ell_2\\,$.\n- 方位次守恒：$\\,m_1 + m_2 = M\\,$.\n- 宇称（偶性）约束：$\\,\\ell_1 + \\ell_2 + L\\,$ 为偶数。\n\n假设这些选择定则对耦合的角度部分成立，且与径向结构无关，并且截断限制了哪些模式存在。考虑一个由 $\\,(\\ell_{\\max}, m_{\\max})\\,$ 表征的谱截断，其保留的模式集合为\n$$\n\\mathcal{S}(\\ell_{\\max}, m_{\\max}) = \\left\\{ (\\ell, m) \\,\\middle|\\, 0 \\le \\ell \\le \\ell_{\\max},\\; -\\min(m_{\\max}, \\ell) \\le m \\le \\min(m_{\\max}, \\ell) \\right\\}.\n$$\n定义一个三元相互作用为一个有序的输入模式对 $\\,(\\ell_1, m_1), (\\ell_2, m_2) \\in \\mathcal{S}\\,$，它们产生一个输出模式 $\\,(\\!L, M)\\,$，该输出模式也位于 $\\,\\mathcal{S}\\,$ 中并满足上述三个约束。分别计算每个有序输入对，并对每个这样的有序对，计算在允许范围内满足宇称和方位约束的所有容许输出阶数 $\\,L\\,$。\n\n任务：\n\n1. 从球谐函数的正交性、加法定理以及球谐函数乘积表示中的角动量守恒出发，解释为什么上述三个选择定则是感应方程三元相互作用中非零角度耦合的必要条件。\n\n2. 设计一个算法，对于给定的截断极限 $\\,(\\ell_{\\max}, m_{\\max})\\,$，该算法枚举集合 $\\,\\mathcal{S}\\,$，遍历所有有序输入对 $\\,(\\ell_1,m_1),(\\ell_2,m_2)\\,$，并计算所有满足 $\\,M=m_1+m_2\\,$ 且 $\\,L\\,$ 满足三角不等式、截断边界 $\\,L \\le \\ell_{\\max}\\,$、方位边界 $\\,|M| \\le L\\,$ 以及宇称约束的容许输出 $\\,(\\!L, M)\\,$。将三元组总数记为 $\\,T(\\ell_{\\max}, m_{\\max})\\,$，模式总数记为 $\\,N(\\ell_{\\max}, m_{\\max}) = \\lvert \\mathcal{S} \\rvert\\,$，每个输出模式的平均耦合数记为 $\\,\\bar{C} = T / N\\,$。\n\n3. 对于 $\\,m_{\\max} = \\ell_{\\max}\\,$（全方位带宽）的特殊情况，使用第一性原理计数方法论证朴素三元组枚举算法关于 $\\,\\ell_{\\max}\\,$ 的渐近计算复杂度。给出一个对幂律指数 $\\,p\\,$ 的有理估计，使得当 $\\,\\ell_{\\max} \\to \\infty\\,$ 时，$\\,T(\\ell_{\\max}, \\ell_{\\max}) \\sim \\text{const} \\times \\ell_{\\max}^{\\,p}\\,$，并解释这与您算法循环所隐含的操作计数如何比较。\n\n4. 实现一个完整的程序，该程序：\n   - 使用上述选择定则和计数程序。\n   - 为下面的测试套件中的每个测试用例计算 $\\,N\\,$、$\\,T\\,$ 和 $\\,\\bar{C}\\,$。\n   - 对于测试用例中 $\\,m_{\\max} = \\ell_{\\max}  0\\,$ 的子集，对 $\\,\\log T\\,$ 与 $\\,\\log \\ell_{\\max}\\,$ 进行最小二乘拟合，以估计经验指数 $\\,p\\,$。\n   - 生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个测试用例按顺序贡献一个列表 $[N, T, \\bar{C}]$，并且外部列表的最后一个元素是拟合出的指数 $\\,p\\,$（浮点数）。例如，格式必须严格为\n     $$\n     \\big[ [N_1, T_1, \\bar{C}_1], [N_2, T_2, \\bar{C}_2], \\dots, p \\big].\n     $$\n\n测试套件：\n- 情况 $\\,1\\,$: $(\\ell_{\\max}, m_{\\max}) = (0, 0)$。\n- 情况 $\\,2\\,$: $(\\ell_{\\max}, m_{\\max}) = (1, 0)$。\n- 情况 $\\,3\\,$: $(\\ell_{\\max}, m_{\\max}) = (2, 2)$。\n- 情况 $\\,4\\,$: $(\\ell_{\\max}, m_{\\max}) = (4, 4)$。\n- 情况 $\\,5\\,$: $(\\ell_{\\max}, m_{\\max}) = (8, 8)$。\n- 情况 $\\,6\\,$: $(\\ell_{\\max}, m_{\\max}) = (12, 12)$。\n- 情况 $\\,7\\,$: $(\\ell_{\\max}, m_{\\max}) = (10, 3)$。\n\n所有答案都是无量纲的计数和比率；不需要物理单位。角度（如果有的话）是球谐函数内部的，无需输出。您的程序应生成单行输出，其中包含如上所述的、用方括号括起来的逗号分隔列表形式的结果。数值输出必须是定义的实数或整数，不带任何附加文本。", "solution": "该问题是有效的，因为它在磁流体动力学方面有科学依据，定义和目标明确，没有矛盾或含糊之处。\n\n### 1. 选择定则的理论起源\n\n感应方程中的非线性项 $\\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$ 在转换到球谐函数谱基时，涉及场的乘积。这些乘积的角度依赖性由三个球谐函数乘积的积分控制，这被称为Gaunt积分：\n$$\nI = \\int_{\\Omega} Y_{L}^{M*}(\\theta, \\phi) Y_{\\ell_1}^{m_1}(\\theta, \\phi) Y_{\\ell_2}^{m_2}(\\theta, \\phi) d\\Omega\n$$\n其中 $d\\Omega = \\sin\\theta d\\theta d\\phi$ 是立体角元，星号表示复共轭。选择定则定义了该积分非零的条件，从而确定了哪些谱模式 $(\\ell_1, m_1)$ 和 $(\\ell_2, m_2)$ 可以相互作用以产生模式 $(L, M)$。\n\n**1. 方位次守恒 ($m_1 + m_2 = M$)：**\n球谐函数 $Y_{\\ell}^{m}(\\theta, \\phi)$ 的方位角依赖性由 $e^{im\\phi}$ 给出。对方位角 $\\phi$ 的积分是：\n$$\n\\int_0^{2\\pi} (e^{iM\\phi})^* (e^{im_1\\phi}) (e^{im_2\\phi}) d\\phi = \\int_0^{2\\pi} e^{-iM\\phi} e^{im_1\\phi} e^{im_2\\phi} d\\phi = \\int_0^{2\\pi} e^{i(m_1 + m_2 - M)\\phi} d\\phi\n$$\n由于复指数函数系 $\\{e^{ik\\phi}\\}_{k \\in \\mathbb{Z}}$ 在区间 $[0, 2\\pi]$ 上的正交性，如果指数为零（即 $m_1 + m_2 - M = 0$），该积分等于 $2\\pi$，否则为零。这建立了选择定则 $m_1 + m_2 = M$。\n\n**2. 宇称约束 ($\\ell_1 + \\ell_2 + L$ 为偶数)：**\n球谐函数在反演操作 $\\mathbf{r} \\to -\\mathbf{r}$（在球坐标中为 $(\\theta, \\phi) \\to (\\pi - \\theta, \\phi + \\pi)$）下具有确定的宇称。变换规则为 $Y_{\\ell}^{m}(\\pi - \\theta, \\phi + \\pi) = (-1)^{\\ell} Y_{\\ell}^{m}(\\theta, \\phi)$。将此应用于整个被积函数可得：\n$$\n(-1)^{L} Y_{L}^{M*} \\cdot (-1)^{\\ell_1} Y_{\\ell_1}^{m_1} \\cdot (-1)^{\\ell_2} Y_{\\ell_2}^{m_2} = (-1)^{\\ell_1 + \\ell_2 + L} \\left( Y_{L}^{M*} Y_{\\ell_1}^{m_1} Y_{\\ell_2}^{m_2} \\right)\n$$\n积分是在整个球面 $\\Omega$ 上进行的，该区域关于反演是对称的。如果被积函数在该变换下是奇函数（即，如果宇称因子 $(-1)^{\\ell_1 + \\ell_2 + L} = -1$），则一个半球上的积分将被另一个半球上的积分完全抵消，总和为零。因此，为了使Gaunt积分非零，被积函数必须是偶函数，这要求阶数之和 $\\ell_1 + \\ell_2 + L$ 为偶数。\n\n**3. 三角不等式 ($|\\ell_1 - \\ell_2| \\le L \\le \\ell_1 + \\ell_2$)：**\n此规则源于量子力学中角动量相加的原理，这在数学上类似于球谐函数的合成。两个球谐函数的乘积可以展开为单个球谐函数的和：\n$$\nY_{\\ell_1}^{m_1} Y_{\\ell_2}^{m_2} = \\sum_{\\ell', m'} C(\\ell_1, m_1, \\ell_2, m_2; \\ell', m') Y_{\\ell'}^{m'}\n$$\n其中系数 $C$ 与Clebsch-Gordan系数（或Wigner 3j符号）成正比。这些系数仅在 $m' = m_1 + m_2$ 且阶数满足三角不等式 $|\\ell_1 - \\ell_2| \\le \\ell' \\le \\ell_1 + \\ell_2$ 时非零。将此展开式代入Gaunt积分中，利用球谐函数的正交性 $\\int Y_{L}^{M*} Y_{\\ell'}^{m'} d\\Omega = \\delta_{L\\ell'} \\delta_{Mm'}$，只会选择和式中 $\\ell' = L$ 和 $m' = M$ 的项。因此，只有当三元组 $(\\ell_1, \\ell_2, L)$ 满足从非零Clebsch-Gordan系数继承来的三角不等式条件时，积分才可能非零。这是相互作用模式角动量守恒的直接体现。\n\n### 2. 算法设计\n\n计算给定截断参数 $(\\ell_{\\max}, m_{\\max})$ 下的模式数 $N$、三元相互作用总数 $T$ 和每个模式的平均耦合数 $\\bar{C}$ 的算法设计如下。\n\n**步骤1：生成模式集 $\\mathcal{S}$ 并计算 $N$**\n首先，我们枚举所有满足截断标准的模式并将其存储。\n- 初始化一个空列表 `modes`。\n- 遍历球谐函数阶 $\\ell$ 从 $0$ 到 $\\ell_{\\max}$。\n- 对于每个 $\\ell$，遍历方位次 $m$ 从 $-\\min(m_{\\max}, \\ell)$ 到 $\\min(m_{\\max}, \\ell)$。\n- 将元组 $(\\ell, m)$ 添加到 `modes` 列表中。\n- 模式总数 $N$ 是此列表的最终大小，$N = |\\mathcal{S}|$。\n\n**步骤2：枚举三元组并计算 $T$**\n接下来，我们系统地计算所有有效的三元相互作用。一种直接的枚举方法是遍历所有可能的有序输入模式对，并对每一对计算有效输出模式的数量。\n- 初始化三元组总数计数器 $T = 0$。\n- 对每个输入模式 $(\\ell_1, m_1) \\in \\mathcal{S}$ 进行循环。\n- 在此循环内，嵌套另一个对每个输入模式 $(\\ell_2, m_2) \\in \\mathcal{S}$ 的循环。\n- 对于每个有序对 $((\\ell_1, m_1), (\\ell_2, m_2))$：\n    a. 根据守恒定则计算输出模式的方位次：$M = m_1 + m_2$。\n    b. 对 $M$ 应用截断约束。输出模式 $(L, M)$ 必须属于 $\\mathcal{S}$，这要求 $|M| \\le \\min(m_{\\max}, L)$。因为这必须对某个 $L$ 成立，所以一个必要条件是 $|M| \\le m_{\\max}$。如果 $|M|  m_{\\max}$，则不存在有效的输出模式，因此我们继续处理下一对输入模式。\n    c. 通过组合所有约束来确定输出阶 $L$ 的有效范围：\n        - 三角不等式：$|\\ell_1 - \\ell_2| \\le L \\le \\ell_1 + \\ell_2$\n        - 截断极限：$L \\le \\ell_{\\max}$\n        - 球谐函数要求：$|M| \\le L$\n        这给出了下界 $L_{\\min} = \\max(|\\ell_1 - \\ell_2|, |M|)$ 和上界 $L_{\\max} = \\min(\\ell_1 + \\ell_2, \\ell_{\\max})$。\n    d. 如果 $L_{\\min}  L_{\\max}$，则没有 $L$ 值可以满足所有约束，因此我们继续。\n    e. 计算在 $[L_{\\min}, L_{\\max}]$ 范围内同样满足宇称约束的整数 $L$ 的数量：$\\ell_1 + \\ell_2 + L$ 必须为偶数。这等效于 $L$ 与 $\\ell_1 + \\ell_2$ 具有相同的奇偶性。这个计数可以通过算术方法计算，无需显式循环：\n        i. 找到范围内的第一个有效 $L$，设其为 $L_{start}$。如果 $(\\ell_1 + \\ell_2 + L_{\\min})$ 是偶数，则 $L_{start} = L_{\\min}$，否则 $L_{start} = L_{\\min} + 1$。\n        ii. 如果 $L_{start}  L_{\\max}$，则没有有效的 $L$ 值。\n        iii. 否则，有效 $L$ 值的数量（它们之间相差2）为 $(L_{\\max} - L_{start}) / 2 + 1$。\n    f. 将此计数加到总数 $T$ 中。\n\n**步骤3：计算 $\\bar{C}$**\n最后，计算每个输出模式的平均耦合数。\n- $\\bar{C} = T / N$。需要检查 $N=0$ 的情况，尽管对于任何有效的 $\\ell_{\\max} \\ge 0$，$N \\ge 1$。\n\n### 3. 渐近复杂度分析\n\n我们分析全三角截断情况下的计算复杂度，其中 $m_{\\max} = \\ell_{\\max}$。我们希望找到在 $\\ell_{\\max} \\to \\infty$ 时，标度关系 $T(\\ell_{\\max}, \\ell_{\\max}) \\sim \\text{const} \\times \\ell_{\\max}^{\\,p}$ 中的指数 $p$。\n\n**模式数 ($N$)：**\n对于 $m_{\\max} = \\ell_{\\max}$，模式集为 $\\mathcal{S} = \\{(\\ell, m) \\mid 0 \\le \\ell \\le \\ell_{\\max}, -\\ell \\le m \\le \\ell\\}$。对于每个阶 $\\ell$，有 $2\\ell+1$ 个可能的 $m$ 值。模式总数为：\n$$\nN = \\sum_{\\ell=0}^{\\ell_{\\max}} (2\\ell+1) = (\\ell_{\\max}+1)^2\n$$\n因此，对于大的 $\\ell_{\\max}$，模式数量的标度关系为 $N \\sim \\ell_{\\max}^2$。\n\n**三元组数 ($T$)：**\n三元组总数 $T$ 是对所有输入模式对求和的结果，其中和的每一项是有效输出阶数 $L$ 的数量。\n$$\nT = \\sum_{(\\ell_1, m_1) \\in \\mathcal{S}} \\sum_{(\\ell_2, m_2) \\in \\mathcal{S}} (\\text{对此对的有效 } L \\text{ 的数量})\n$$\n我们可以通过考虑来自高波数模式（其中 $\\ell_1, \\ell_2 \\sim O(\\ell_{\\max})$）的主要贡献来估计其标度关系。\n- 有序输入模式对的数量为 $N^2 \\sim (\\ell_{\\max}^2)^2 = \\ell_{\\max}^4$。\n- 对于 $\\ell_1 \\sim O(\\ell_{\\max})$ 和 $\\ell_2 \\sim O(\\ell_{\\max})$ 的模式之间的典型相互作用，可能的输出阶 $L$ 的范围由 $L \\in [|\\ell_1 - \\ell_2|, \\ell_1 + \\ell_2]$ 给出，并受截断 $L \\le \\ell_{\\max}$ 的限制。下界 $|\\ell_1 - \\ell_2|$ 可能很小，而允许范围的上限是 $\\ell_{\\max}$。因此，$L$ 的这个区间的长度约为 $O(\\ell_{\\max})$。\n- 有效 $L$ 值的数量与此区间的长度成正比。平均而言，对于给定的输入对，有效 $L$ 的数量是 $O(\\ell_{\\max})$。\n\n综合这些估计，三元组总数的标度关系为模式对数量与每对平均完成数的乘积：\n$$\nT \\sim (\\text{模式对数量}) \\times (\\text{平均 } L\\text{ 的数量}) \\sim \\ell_{\\max}^4 \\times \\ell_{\\max} = \\ell_{\\max}^5\n$$\n因此，预测的渐近标度指数为 $p=5$。上一节设计的朴素三元组枚举算法具有反映此标度关系的嵌套循环结构：两个关于模式的嵌套循环给出 $O(N^2) = O(\\ell_{\\max}^4)$，而内部关于 $L$ 的计算在所计数的相互作用数量上贡献了一个有效的 $O(\\ell_{\\max})$ 因子，导致了相同的整体标度关系。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef count_interactions(l_max, m_max):\n    \"\"\"\n    Counts modes and triadic interactions for a given spectral truncation.\n\n    Args:\n        l_max (int): Maximum spherical harmonic degree.\n        m_max (int): Maximum spherical harmonic order.\n\n    Returns:\n        tuple: A tuple containing:\n            - N (int): Total number of modes.\n            - T (int): Total number of triadic interactions.\n            - C_bar (float): Average number of couplings per mode.\n    \"\"\"\n    # Step 1: Generate the set of modes S and count them for N.\n    modes = []\n    for l_val in range(l_max + 1):\n        m_limit = min(m_max, l_val)\n        for m_val in range(-m_limit, m_limit + 1):\n            modes.append((l_val, m_val))\n    \n    N = len(modes)\n    \n    if N == 0:\n        return 0, 0, 0.0\n\n    # Step 2: Enumerate triads and compute T.\n    T = 0\n    # Iterate over all ordered pairs of input modes.\n    for l1, m1 in modes:\n        for l2, m2 in modes:\n            # Calculate output azimuthal order M from conservation rule.\n            M = m1 + m2\n            \n            # Check truncation on M. If |M|  m_max, no valid output mode (L, M)\n            # can exist in the set S, since S requires |M| = min(m_max, L).\n            if abs(M)  m_max:\n                continue\n                \n            # Determine the range for the output degree L from selection rules and truncation.\n            L_min = max(abs(l1 - l2), abs(M))\n            L_max = min(l1 + l2, l_max)\n            \n            # If the range is invalid, no L is possible.\n            if L_min  L_max:\n                continue\n                \n            # Count the number of integers L in [L_min, L_max] that satisfy the\n            # parity constraint: (l1 + l2 + L) must be even.\n            # This is equivalent to L having the same parity as (l1 + l2).\n            # This count can be calculated arithmetically.\n            \n            # Find the first valid L in the range.\n            first_L = L_min\n            if (l1 + l2 + first_L) % 2 != 0:\n                first_L += 1\n            \n            # If the first valid L is outside the range, no triads are formed.\n            if first_L  L_max:\n                continue\n            \n            # The valid L values are {first_L, first_L + 2, ...}.\n            # The number of terms in this arithmetic progression is calculated.\n            num_valid_L = (L_max - first_L) // 2 + 1\n            T += num_valid_L\n\n    # Step 3: Calculate C_bar = T / N.\n    C_bar = T / N if N  0 else 0.0\n    \n    return N, T, C_bar\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite, perform analysis, and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0, 0),    # Case 1\n        (1, 0),    # Case 2\n        (2, 2),    # Case 3\n        (4, 4),    # Case 4\n        (8, 8),    # Case 5\n        (12, 12),  # Case 6\n        (10, 3)    # Case 7\n    ]\n\n    results = []\n    log_l_max_data = []\n    log_T_data = []\n\n    for l_max, m_max in test_cases:\n        N, T, C_bar = count_interactions(l_max, m_max)\n        results.append([N, int(T), float(C_bar)])\n        \n        # Collect data for least-squares fit for cases where l_max = m_max  0.\n        if l_max == m_max and l_max  0:\n            log_l_max_data.append(np.log(l_max))\n            log_T_data.append(np.log(T))\n            \n    # Perform a linear least-squares fit of log(T) vs log(l_max) to find the exponent p.\n    # The model is log(T) = p * log(l_max) + const. The slope of the line is p.\n    p_fit = 0.0\n    if len(log_l_max_data)  1:\n        # Using scipy.stats.linregress to get the slope.\n        slope, _, _, _, _ = stats.linregress(log_l_max_data, log_T_data)\n        p_fit = slope\n\n    # Format the final output string precisely as required.\n    # The output is a single line: [[N1,T1,C1],[N2,T2,C2],...,p] with no spaces.\n    output_parts = []\n    for N_i, T_i, C_bar_i in results:\n        output_parts.append(f\"[{N_i},{T_i},{C_bar_i}]\")\n    \n    # Join the parts for each test case, and append the fitted exponent p.\n    full_output_str = f\"[{','.join(output_parts)},{p_fit}]\"\n    \n    # Final print statement in the exact required format.\n    print(full_output_str)\n\nsolve()\n```", "id": "3608698"}]}