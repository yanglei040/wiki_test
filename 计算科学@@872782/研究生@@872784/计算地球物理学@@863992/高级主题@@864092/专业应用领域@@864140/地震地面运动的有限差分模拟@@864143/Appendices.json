{"hands_on_practices": [{"introduction": "有限差分方法的核心在于使用网格上的离散值来近似导数，而这种近似的精度至关重要。本练习将引导你遵循基本原理，使用泰勒级数展开来推导高阶有限差分格式的系数。掌握这项技术不仅能让你理解数值格式是如何构建的，还能让你深刻体会到算子孔径与精度之间的权衡关系。[@problem_id:3592389]", "problem": "在地震地面运动的有限差分 (FD) 建模中，一维速度-应力公式涉及诸如 $\\partial \\sigma / \\partial x$ 的空间导数，其中 $\\sigma(x,t)$ 是正应力。考虑一个间距为 $h>0$ 的均匀网格 $x_i = x_0 + i h$ 和一个内部点 $x_i$。您的目标是使用采样点 $\\{\\sigma_{i-2},\\sigma_{i-1},\\sigma_i,\\sigma_{i+1},\\sigma_{i+2}\\}$，通过一个中心对称的 5 点格式来近似 $x_i$ 处的 $\\partial \\sigma / \\partial x$：\n$$\nD_x \\sigma_i \\equiv \\frac{1}{h} \\sum_{k=-2}^{2} c_k \\,\\sigma_{i+k},\n$$\n其中系数 $c_k$ 与 $i$ 和 $h$ 无关。仅从光滑函数在 $x_i$ 点的泰勒定理展开式和一阶导数的定义出发，推导系数 $c_k$，使得 $D_x \\sigma_i$ 是在 $x_i$ 处对 $\\partial \\sigma / \\partial x$ 的一个四阶精度近似；也就是说，局部截断误差为 $\\mathcal{O}(h^4)$。然后，从第一性原理出发，验证您的构造所隐含的以下相容性和精度条件：\n$\\,\\,$(i) $\\sum_{k=-2}^{2} c_k = 0$, $\\,\\,$(ii) $\\sum_{k=-2}^{2} k\\,c_k = 1$, $\\,\\,$(iii) $\\sum_{k=-2}^{2} k^m c_k = 0$ for $m=2,3$，并明确确定乘以 $h^4\\,\\sigma^{(5)}(x_i)$ 的主截断误差系数。\n\n将您的最终结果表示为行向量 $(c_{-2},c_{-1},c_{0},c_{1},c_{2})$，其各项为精确有理数。无需四舍五入。最终答案不应包含物理单位。", "solution": "题目要求推导一个 5 点、中心对称的有限差分格式的系数，该格式以四阶精度近似一阶导数 $\\partial \\sigma / \\partial x$。我们还必须验证这些系数的某些性质，并确定主截断误差项。\n\n设在网格点 $x_i$ 处导数 $\\frac{\\partial \\sigma}{\\partial x}$ 的近似值为 $D_x \\sigma_i$。给定的近似形式为：\n$$\nD_x \\sigma_i = \\frac{1}{h} \\sum_{k=-2}^{2} c_k \\,\\sigma_{i+k} = \\frac{1}{h} (c_{-2}\\sigma_{i-2} + c_{-1}\\sigma_{i-1} + c_{0}\\sigma_{i} + c_{1}\\sigma_{i+1} + c_{2}\\sigma_{i+2})\n$$\n其中 $\\sigma_{i+k} = \\sigma(x_i + kh)$。为了确定系数 $c_k$，我们假设 $\\sigma(x)$ 足够光滑，将每一项 $\\sigma_{i+k}$ 在点 $x_i$ 周围进行泰勒级数展开。展开式为：\n$$\n\\sigma(x_i + kh) = \\sigma(x_i) + (kh) \\sigma'(x_i) + \\frac{(kh)^2}{2!} \\sigma''(x_i) + \\frac{(kh)^3}{3!} \\sigma'''(x_i) + \\frac{(kh)^4}{4!} \\sigma^{(4)}(x_i) + \\frac{(kh)^5}{5!} \\sigma^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n其中 $\\sigma^{(m)}(x_i)$ 表示 $\\sigma$ 在 $x_i$ 处计算的 m 阶导数。\n\n将这些展开式代入 $D_x \\sigma_i$ 的公式中，我们得到：\n$$\nD_x \\sigma_i = \\frac{1}{h} \\sum_{k=-2}^{2} c_k \\left[ \\sigma(x_i) + kh \\sigma'(x_i) + \\frac{k^2h^2}{2} \\sigma''(x_i) + \\frac{k^3h^3}{6} \\sigma'''(x_i) + \\frac{k^4h^4}{24} \\sigma^{(4)}(x_i) + \\frac{k^5h^5}{120} \\sigma^{(5)}(x_i) + \\dots \\right]\n$$\n我们可以按 $\\sigma(x_i)$ 的导数重新组合各项：\n$$\nD_x \\sigma_i = \\frac{\\sigma(x_i)}{h}\\left(\\sum_{k=-2}^{2} c_k\\right) + \\sigma'(x_i)\\left(\\sum_{k=-2}^{2} k c_k\\right) + h\\frac{\\sigma''(x_i)}{2}\\left(\\sum_{k=-2}^{2} k^2 c_k\\right) + h^2\\frac{\\sigma'''(x_i)}{6}\\left(\\sum_{k=-2}^{2} k^3 c_k\\right) + h^3\\frac{\\sigma^{(4)}(x_i)}{24}\\left(\\sum_{k=-2}^{2} k^4 c_k\\right) + h^4\\frac{\\sigma^{(5)}(x_i)}{120}\\left(\\sum_{k=-2}^{2} k^5 c_k\\right) + \\dots\n$$\n为使 $D_x \\sigma_i$ 成为 $\\sigma'(x_i)$ 的四阶精度近似，局部截断误差 $T_i = D_x \\sigma_i - \\sigma'(x_i)$ 必须是 $\\mathcal{O}(h^4)$ 阶。这要求在方程 $D_x \\sigma_i = \\sigma'(x_i) + \\mathcal{O}(h^4)$ 的两边匹配导数的系数，直到与 $h^3$ 成比例的项。这为系数 $c_k$ 产生了一个线性方程组：\n\\begin{enumerate}\n    \\item $\\sigma(x_i)$ 的系数：$\\sum_{k=-2}^{2} c_k = 0$\n    \\item $\\sigma'(x_i)$ 的系数：$\\sum_{k=-2}^{2} k c_k = 1$\n    \\item $h\\sigma''(x_i)$ 的系数：$\\sum_{k=-2}^{2} k^2 c_k = 0$\n    \\item $h^2\\sigma'''(x_i)$ 的系数：$\\sum_{k=-2}^{2} k^3 c_k = 0$\n    \\item $h^3\\sigma^{(4)}(x_i)$ 的系数：$\\sum_{k=-2}^{2} k^4 c_k = 0$\n\\end{enumerate}\n这是一个关于 5 个未知数 $(c_{-2}, c_{-1}, c_0, c_1, c_2)$ 的 5 个方程组成的方程组。\n\n根据给定的格式是中心对称的性质，我们预期对于一阶导数近似有 $c_{-k} = -c_k$，这也意味着 $c_0=0$。让我们从方程组中推导这一点。\n方程 3 和 5 涉及 $k$ 的偶次幂：\n方程 3: $4c_{-2} + c_{-1} + c_1 + 4c_2 = 0 \\implies (c_{-1}+c_1) + 4(c_{-2}+c_2) = 0$\n方程 5: $16c_{-2} + c_{-1} + c_1 + 16c_2 = 0 \\implies (c_{-1}+c_1) + 16(c_{-2}+c_2) = 0$\n这两个方程相减得到 $12(c_{-2}+c_2) = 0$，这意味着 $c_{-2} = -c_2$。将此代回任一方程，得到 $c_{-1}+c_1 = 0$，因此 $c_{-1}=-c_1$。\n现在，从方程 1：\n$c_{-2} + c_{-1} + c_0 + c_1 + c_2 = c_0 + (c_{-1}+c_1) + (c_{-2}+c_2) = c_0 + 0 + 0 = 0 \\implies c_0=0$。\n因此，性质 $c_{-k} = -c_k$ 和 $c_0=0$ 是中心格式精度要求的结果。\n\n我们使用剩下的方程（关于 $k$ 的奇次幂）来求解 $c_1$ 和 $c_2$ 的值。\n方程 2: $\\sum k c_k = -2c_{-2} - c_{-1} + c_1 + 2c_2 = 1$。代入 $c_{-k}=-c_k$：\n$-2(-c_2) - (-c_1) + c_1 + 2c_2 = 1 \\implies 2c_2+c_1+c_1+2c_2 = 1 \\implies 2c_1 + 4c_2 = 1$。\n\n方程 4: $\\sum k^3 c_k = -8c_{-2} - c_{-1} + c_1 + 8c_2 = 0$。代入 $c_{-k}=-c_k$：\n$-8(-c_2) - (-c_1) + c_1 + 8c_2 = 0 \\implies 8c_2+c_1+c_1+8c_2 = 0 \\implies 2c_1 + 16c_2 = 0$。\n\n我们现在得到一个关于 $c_1$ 和 $c_2$ 的二元方程组：\n(A) $2c_1 + 4c_2 = 1$\n(B) $2c_1 + 16c_2 = 0$\n(B) 减去 (A)：$(2c_1 + 16c_2) - (2c_1 + 4c_2) = 0 - 1 \\implies 12c_2 = -1 \\implies c_2 = -\\frac{1}{12}$。\n将 $c_2$ 代入 (B)：$2c_1 + 16(-\\frac{1}{12}) = 0 \\implies 2c_1 - \\frac{16}{12} = 0 \\implies 2c_1 = \\frac{4}{3} \\implies c_1 = \\frac{2}{3}$。\n\n因此，这些系数为：\n$c_2 = -\\frac{1}{12}$\n$c_1 = \\frac{2}{3}$\n$c_0 = 0$\n$c_{-1} = -c_1 = -\\frac{2}{3}$\n$c_{-2} = -c_2 = \\frac{1}{12}$\n系数向量为 $(c_{-2}, c_{-1}, c_0, c_1, c_2) = (\\frac{1}{12}, -\\frac{2}{3}, 0, \\frac{2}{3}, -\\frac{1}{12})$。\n\n接下来，我们按要求验证相容性和精度条件。这些条件与推导过程中使用的条件相同。我们证明我们计算出的系数满足这些条件。\n(i) $\\sum_{k=-2}^{2} c_k = \\frac{1}{12} - \\frac{2}{3} + 0 + \\frac{2}{3} - \\frac{1}{12} = 0$。该条件满足。\n(ii) $\\sum_{k=-2}^{2} k\\,c_k = (-2)(\\frac{1}{12}) + (-1)(-\\frac{2}{3}) + (1)(\\frac{2}{3}) + (2)(-\\frac{1}{12}) = -\\frac{2}{12} + \\frac{2}{3} + \\frac{2}{3} - \\frac{2}{12} = -\\frac{4}{12} + \\frac{4}{3} = -\\frac{1}{3} + \\frac{4}{3} = \\frac{3}{3} = 1$。该条件满足。\n(iii) 对于 $m=2,3$，$\\sum_{k=-2}^{2} k^m c_k = 0$。\n对于 $m=2$: $\\sum_{k=-2}^{2} k^2 c_k = (-2)^2(\\frac{1}{12}) + (-1)^2(-\\frac{2}{3}) + (1)^2(\\frac{2}{3}) + (2)^2(-\\frac{1}{12}) = \\frac{4}{12} - \\frac{2}{3} + \\frac{2}{3} - \\frac{4}{12} = 0$。该条件满足。\n对于 $m=3$: $\\sum_{k=-2}^{2} k^3 c_k = (-2)^3(\\frac{1}{12}) + (-1)^3(-\\frac{2}{3}) + (1)^3(\\frac{2}{3}) + (2)^3(-\\frac{1}{12}) = -\\frac{8}{12} + \\frac{2}{3} + \\frac{2}{3} - \\frac{8}{12} = -\\frac{16}{12} + \\frac{4}{3} = -\\frac{4}{3} + \\frac{4}{3} = 0$。该条件满足。\n正如构造所要求的，所有条件都成立。\n\n最后，我们确定主截断误差项。局部截断误差为 $T_i = D_x \\sigma_i - \\sigma'(x_i)$。从我们对 $D_x \\sigma_i$ 的展开式中，$\\sigma'(x_i)$ 之后的第一个非零项定义了主误差项。由于直到 $k^4$ 的所有和都被清零或设置为产生 $\\sigma'(x_i)$，主误差项为：\n$$\nT_i = h^4 \\frac{\\sigma^{(5)}(x_i)}{5!} \\left(\\sum_{k=-2}^{2} k^5 c_k\\right) + \\mathcal{O}(h^5)\n$$\n我们计算和 $\\sum k^5 c_k$：\n$$\n\\sum_{k=-2}^{2} k^5 c_k = (-2)^5 c_{-2} + (-1)^5 c_{-1} + (1)^5 c_1 + (2)^5 c_2\n$$\n使用 $c_{-k}=-c_k$：\n$$\n= (-32)( -c_2 ) + (-1)( -c_1 ) + c_1 + 32 c_2 = 32c_2 + c_1 + c_1 + 32c_2 = 2c_1 + 64c_2\n$$\n代入推导出的值 $c_1 = \\frac{2}{3}$ 和 $c_2 = -\\frac{1}{12}$：\n$$\n\\sum_{k=-2}^{2} k^5 c_k = 2\\left(\\frac{2}{3}\\right) + 64\\left(-\\frac{1}{12}\\right) = \\frac{4}{3} - \\frac{64}{12} = \\frac{4}{3} - \\frac{16}{3} = -\\frac{12}{3} = -4\n$$\n因此，主截断误差项为：\n$$\nT_i = h^4 \\frac{\\sigma^{(5)}(x_i)}{120} (-4) = -\\frac{4}{120} h^4 \\sigma^{(5)}(x_i) = -\\frac{1}{30} h^4 \\sigma^{(5)}(x_i)\n$$\n乘以 $h^4 \\sigma^{(5)}(x_i)$ 的系数是 $-\\frac{1}{30}$。然而，题目只要求将系数向量作为最终答案。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{12}  -\\frac{2}{3}  0  \\frac{2}{3}  -\\frac{1}{12} \\end{pmatrix}}\n$$", "id": "3592389"}, {"introduction": "在设计了精确的显式格式之后，确保其稳定性是下一个关键挑战。如果时间步长 $ \\Delta t $ 相对于网格间距和波速而言过大，模拟结果可能会因数值不稳定而“发散”。本练习聚焦于 Courant–Friedrichs–Lewy (CFL) 条件，你将通过编程来诊断非均匀介质中的不稳定性。这项实践将教会你如何识别数值不稳定性的来源，这是任何计算科学家都需要掌握的关键技能。[@problem_id:3592396]", "problem": "您正在分析一个由非均匀介质中的声波方程控制的地震地面运动二维显式时域有限差分模拟。其基本原理是，在各向同性无损介质中的波传播由以下二阶偏微分方程描述：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c(\\mathbf{x})^2 \\nabla^2 u,\n$$\n其中，$u$是标量位移势，$t$是时间，$\\mathbf{x}=(x,y)$是位置，$c(\\mathbf{x})$是与位置相关的相速度，$\\nabla^2$是拉普拉斯算子。该模拟在空间和时间上都使用显式中心有限差分法，并在一个具有间距$\\Delta x$和$\\Delta y$以及固定时间步长$\\Delta t$的均匀直线网格上进行。网格索引的定义如下：$x$索引$i$沿$x$轴从$0$到$N_x-1$，$y$索引$j$沿$y$轴从$0$到$N_y-1$。\n\nCourant–Friedrichs–Lewy (CFL) 数是一个无量纲量，它将时间步长与最快特征传播穿过一个网格单元所需的时间进行比较。在非均匀介质中，局部CFL数取决于$c(\\mathbf{x})$和网格间距。当局部CFL数超过所选显式格式的稳定性极限时，会触发数值不稳定性，模拟可能会在有限数量的时间步后发散。您的任务是为每个提供的测试用例计算整个网格上的最大局部CFL数，并识别出能够包围所有因超过二维空间二阶精度显式中心差分格式的稳定性准则而触发不稳定性的点的最小轴对齐网格索引边界框。\n\n所有物理量必须使用一致的单位：空间间距使用米（m），速度使用米/秒（m/s），时间使用秒（s）。最大局部CFL数的答案必须报告为无量纲浮点值。索引边界必须报告为表示网格索引的整数。\n\n将不稳定区域定义为局部CFL数严格超过格式稳定性极限的网格点$(i,j)$的集合。如果在某个测试用例中没有触发不稳定性，则不稳定区域为空。需要报告的网格区域是包含所有不稳定点的最小轴对齐边界框$[i_{\\min}, i_{\\max}, j_{\\min}, j_{\\max}]$。如果不稳定区域为空，则为该测试用例返回一个空列表。\n\n您的程序应生成单行输出，其中包含一个按测试用例排列的结果列表，每个测试用例的结果本身是一个包含两个元素的列表：\n- 第一个元素是整个网格上的最大局部CFL数，以浮点值的形式表示。\n- 第二个元素可以是一个空列表（如果没有触发不稳定性），或者是如上定义的四元素整数列表$[i_{\\min}, i_{\\max}, j_{\\min}, j_{\\max}]$。\n\n例如，输出格式必须是\n$$\n[\\,[\\text{cfl}_1, [i_{\\min,1}, i_{\\max,1}, j_{\\min,1}, j_{\\max,1}]], \\; [\\text{cfl}_2, [\\cdots]], \\; \\ldots\\,],\n$$\n打印为单行，不含任何额外文本。\n\n使用以下测试套件，该套件旨在检验计算的不同方面。在所有情况下，介质都是非均匀的，$c(\\mathbf{x})$由均匀网格上已知的空间模式指定。\n\n测试用例1（非均匀透镜；可能因高速夹杂物而不稳定）：\n- 网格尺寸：$N_x = 256$, $N_y = 192$。\n- 网格间距：$\\Delta x = 7.5\\,\\text{m}$, $\\Delta y = 7.5\\,\\text{m}$。\n- 时间步长：$\\Delta t = 0.0012\\,\\text{s}$。\n- 速度场：背景速度为$c(\\mathbf{x}) = 2000\\,\\text{m/s}$，带有一个以网格中心为中心、速度为$4500\\,\\text{m/s}$的椭圆形高速夹杂物。椭圆由满足$((x-x_0)/a)^2 + ((y-y_0)/b)^2 \\le 1$的点集$(x,y)$定义，其中$(x_0,y_0)$是网格中心，$a = 300\\,\\text{m}$，$b = 225\\,\\text{m}$。使用$x=i\\,\\Delta x$，$y=j\\,\\Delta y$。\n\n测试用例2（分层介质；在顶层附近处于临界稳定状态）：\n- 网格尺寸：$N_x = 128$, $N_y = 128$。\n- 网格间距：$\\Delta x = 10\\,\\text{m}$, $\\Delta y = 8\\,\\text{m}$。\n- 时间步长：$\\Delta t = 0.001104\\,\\text{s}$。\n- 速度场：一个占据索引$j \\le 31$的顶层速度为$c(\\mathbf{x}) = 4000\\,\\text{m/s}$；其余部分的速度为$c(\\mathbf{x}) = 1800\\,\\text{m/s}$。\n\n测试用例3（高度各向异性的网格间距；在底部条带附近不稳定）：\n- 网格尺寸：$N_x = 64$, $N_y = 512$。\n- 网格间距：$\\Delta x = 20\\,\\text{m}$, $\\Delta y = 2\\,\\text{m}$。\n- 时间步长：$\\Delta t = 0.0004\\,\\text{s}$。\n- 速度场：背景速度为$c(\\mathbf{x}) = 2500\\,\\text{m/s}$，带有一个占据索引$j \\ge 448$、速度为$c(\\mathbf{x}) = 5000\\,\\text{m/s}$的高速底部条带。\n\n您的程序必须为每个测试用例计算最大局部CFL数，以及包围所有局部CFL数严格超过二维二阶精度显式中心差分格式稳定性极限的点的最小轴对齐网格索引边界框。将CFL数表示为无量纲浮点数，将边界框表示为整数列表。最终输出必须是单行，包含一个用方括号括起来的逗号分隔的结果列表，遵循上述指定的格式。", "solution": "该问题已经过验证，被认为是有效的。它具有科学依据，是适定的、客观的，并包含推导出唯一解所需的所有必要信息。\n\n该问题要求分析非均匀介质中二维声波方程的时域有限差分（FDTD）模拟的数值稳定性。控制偏微分方程由下式给出：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c(\\mathbf{x})^2 \\nabla^2 u\n$$\n其中$u$是标量位移势，$t$是时间，$\\mathbf{x}=(x,y)$表示空间坐标，$c(\\mathbf{x})$是与位置相关的波速，$\\nabla^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$是拉普拉斯算子。\n\n该模拟在具有空间步长$\\Delta x$和$\\Delta y$以及时间步长$\\Delta t$的均匀网格上，采用二阶精度、显式、中心有限差分格式。令$u_{i,j}^n$近似$u(i\\Delta x, j\\Delta y, n\\Delta t)$。导数的标准二阶中心差分近似为：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} \\approx \\frac{u_{i,j}^{n+1} - 2u_{i,j}^n + u_{i,j}^{n-1}}{(\\Delta t)^2}\n$$\n$$\n\\nabla^2 u \\approx \\frac{u_{i+1,j}^n - 2u_{i,j}^n + u_{i-1,j}^n}{(\\Delta x)^2} + \\frac{u_{i,j+1}^n - 2u_{i,j}^n + u_{i,j-1}^n}{(\\Delta y)^2}\n$$\n\n这种显式数值格式的稳定性由Courant–Friedrichs–Lewy (CFL) 条件决定。对于使用上述五点拉普拉斯模板离散化的二维声波方程，其稳定性要求局部CFL数$\\sigma$小于或等于一个特定极限。网格点$(i,j)$处的局部CFL数定义为：\n$$\n\\sigma_{i,j} = c_{i,j} \\Delta t \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}}\n$$\n其中$c_{i,j} = c(i\\Delta x, j\\Delta y)$是该网格点的波速。该格式的稳定性条件是，对于网格中所有的点$(i,j)$，都有$\\sigma_{i,j} \\le 1$。在任何违反此条件的点都会触发数值不稳定性。问题规定，不稳定区域由局部CFL数*严格超过*此极限的所有点组成，即$\\sigma_{i,j} > 1$的所有点。\n\n任务是为每个测试用例计算两个量：\n1. 整个计算域上的最大局部CFL数，$\\sigma_{\\max} = \\max_{i,j}(\\sigma_{i,j})$。\n2. 包围所有$\\sigma_{i,j} > 1$的网格点$(i,j)$的最小轴对齐边界框$[i_{\\min}, i_{\\max}, j_{\\min}, j_{\\max}]$。如果不存在这样的点，则该区域为空。\n\n每个测试用例的一般步骤如下：\n1.  定义网格维度（$N_x, N_y$）和参数（$\\Delta x, \\Delta y, \\Delta t$）。\n2.  根据测试用例的具体规则，为所有网格索引$i \\in [0, N_x-1]$和$j \\in [0, N_y-1]$构建一个表示速度场$c_{i,j}$的二维数组。\n3.  计算CFL表达式的常数部分：$S = \\Delta t \\sqrt{1/(\\Delta x)^2 + 1/(\\Delta y)^2}$。\n4.  计算局部CFL数的二维数组：$\\sigma_{i,j} = c_{i,j} \\cdot S$。\n5.  在$\\sigma_{i,j}$数组中找到最大值。此即$\\sigma_{\\max}$。\n6.  识别所有满足$\\sigma_{i,j} > 1$的网格索引$(i,j)$。\n7.  如果不稳定索引集为空，则边界框报告为空列表。否则，从该集合中确定$i$和$j$坐标的最小值和最大值，以构成边界框$[i_{\\min}, i_{\\max}, j_{\\min}, j_{\\max}]$。\n\n现在将此过程应用于每个测试用例。\n\n**测试用例1：**\n- 参数：$N_x = 256$，$N_y = 192$，$\\Delta x = 7.5\\,\\text{m}$，$\\Delta y = 7.5\\,\\text{m}$，$\\Delta t = 0.0012\\,\\text{s}$。\n- 速度场具有$c_b = 2000\\,\\text{m/s}$的背景和$c_e = 4500\\,\\text{m/s}$的椭圆夹杂物。\n- 空间因子是 $S_1 = 0.0012 \\sqrt{1/(7.5)^2 + 1/(7.5)^2} = \\frac{0.0012\\sqrt{2}}{7.5} \\approx 0.00022627$。\n- 最大速度是 $c_{\\max} = 4500\\,\\text{m/s}$。因此，最大CFL数是 $\\sigma_{\\max} = 4500 \\cdot S_1 \\approx 1.01823$。\n- 由于$\\sigma_{\\max} > 1$，存在不稳定区域。不稳定条件$\\sigma_{i,j} > 1$等价于$c_{i,j} > 1/S_1 \\approx 4419.4\\,\\text{m/s}$。这个条件仅在椭圆形高速夹杂物内部（其中$c_{i,j} = 4500\\,\\text{m/s}$）满足。因此，边界框是包围所有落在指定椭圆内的网格点的最小框。\n\n**测试用例2：**\n- 参数：$N_x = 128$，$N_y = 128$，$\\Delta x = 10\\,\\text{m}$，$\\Delta y = 8\\,\\text{m}$，$\\Delta t = 0.001104\\,\\text{s}$。\n- 速度场由两个层组成：对于$j \\le 31$，$c_1 = 4000\\,\\text{m/s}$；对于$j > 31$，$c_2 = 1800\\,\\text{m/s}$。\n- 空间因子是 $S_2 = 0.001104 \\sqrt{1/(10)^2 + 1/(8)^2} \\approx 0.00017673$。\n- 最大速度是 $c_{\\max} = 4000\\,\\text{m/s}$。最大CFL数是 $\\sigma_{\\max} = 4000 \\cdot S_2 \\approx 0.7069$。\n- 由于$\\sigma_{\\max} \\le 1$，没有网格点违反稳定性准则。不稳定区域为空。\n\n**测试用例3：**\n- 参数：$N_x = 64$，$N_y = 512$，$\\Delta x = 20\\,\\text{m}$，$\\Delta y = 2\\,\\text{m}$，$\\Delta t = 0.0004\\,\\text{s}$。\n- 速度场具有$c_b = 2500\\,\\text{m/s}$的背景和在$j \\ge 448$处$c_s = 5000\\,\\text{m/s}$的高速底部条带。\n- 空间因子是 $S_3 = 0.0004 \\sqrt{1/(20)^2 + 1/(2)^2} \\approx 0.00020100$。\n- 最大速度是 $c_{\\max} = 5000\\,\\text{m/s}$。最大CFL数是 $\\sigma_{\\max} = 5000 \\cdot S_3 \\approx 1.00499$。\n- 由于$\\sigma_{\\max} > 1$，存在不稳定区域。条件$\\sigma_{i,j} > 1$意味着$c_{i,j} > 1/S_3 \\approx 4975.2\\,\\text{m/s}$。这仅在底部条带中（其中$c_{i,j} = 5000\\,\\text{m/s}$）成立。\n- 该条带跨越所有从$0$到$N_x-1=63$的$i$索引，以及所有从$448$到$N_y-1=511$的$j$索引。因此，边界框是$[0, 63, 448, 511]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum local CFL number and the bounding box of the instability\n    region for a series of 2D acoustic wave simulation scenarios.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Case 1: Elliptical Inclusion\",\n            \"Nx\": 256, \"Ny\": 192,\n            \"dx\": 7.5, \"dy\": 7.5,\n            \"dt\": 0.0012,\n            \"velocity_params\": {\n                \"type\": \"ellipse\",\n                \"c_background\": 2000.0,\n                \"c_inclusion\": 4500.0,\n                \"a\": 300.0, \"b\": 225.0\n            }\n        },\n        {\n            \"name\": \"Case 2: Layered Medium\",\n            \"Nx\": 128, \"Ny\": 128,\n            \"dx\": 10.0, \"dy\": 8.0,\n            \"dt\": 0.001104,\n            \"velocity_params\": {\n                \"type\": \"layer\",\n                \"c_top\": 4000.0,\n                \"c_bottom\": 1800.0,\n                \"j_boundary\": 31\n            }\n        },\n        {\n            \"name\": \"Case 3: Bottom Stripe\",\n            \"Nx\": 64, \"Ny\": 512,\n            \"dx\": 20.0, \"dy\": 2.0,\n            \"dt\": 0.0004,\n            \"velocity_params\": {\n                \"type\": \"stripe\",\n                \"c_background\": 2500.0,\n                \"c_stripe\": 5000.0,\n                \"j_boundary\": 448\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny = case[\"Nx\"], case[\"Ny\"]\n        dx, dy, dt = case[\"dx\"], case[\"dy\"], case[\"dt\"]\n        vp = case[\"velocity_params\"]\n        \n        # Construct the velocity grid c(i, j)\n        # We use a grid indexed by (j, i) to match numpy's (row, col) convention\n        c = np.zeros((Ny, Nx))\n        \n        # Create index grids for vectorized calculations\n        i_indices = np.arange(Nx)\n        j_indices = np.arange(Ny)\n        i_grid, j_grid = np.meshgrid(i_indices, j_indices)\n\n        if vp[\"type\"] == \"ellipse\":\n            x0 = (Nx - 1) / 2.0 * dx\n            y0 = (Ny - 1) / 2.0 * dy\n            x_grid = i_grid * dx\n            y_grid = j_grid * dy\n            a, b = vp[\"a\"], vp[\"b\"]\n            \n            ellipse_mask = ((x_grid - x0) / a)**2 + ((y_grid - y0) / b)**2 = 1.0\n            c = np.where(ellipse_mask, vp[\"c_inclusion\"], vp[\"c_background\"])\n\n        elif vp[\"type\"] == \"layer\":\n            c = np.full((Ny, Nx), vp[\"c_bottom\"])\n            c[:vp[\"j_boundary\"] + 1, :] = vp[\"c_top\"]\n            \n        elif vp[\"type\"] == \"stripe\":\n            c = np.full((Ny, Nx), vp[\"c_background\"])\n            c[vp[\"j_boundary\"]:, :] = vp[\"c_stripe\"]\n\n        # Calculate the local CFL number over the grid\n        spatial_factor = dt * np.sqrt(1.0/dx**2 + 1.0/dy**2)\n        cfl_grid = c * spatial_factor\n        \n        # Find the maximum CFL number\n        max_cfl = np.max(cfl_grid)\n        \n        # Identify the instability region and its bounding box\n        unstable_indices = np.argwhere(cfl_grid > 1.0)\n        \n        bounding_box = []\n        if unstable_indices.size > 0:\n            # np.argwhere returns indices as [row, col] -> [j, i]\n            j_unstable = unstable_indices[:, 0]\n            i_unstable = unstable_indices[:, 1]\n            \n            i_min = int(np.min(i_unstable))\n            i_max = int(np.max(i_unstable))\n            j_min = int(np.min(j_unstable))\n            j_max = int(np.max(j_unstable))\n            \n            bounding_box = [i_min, i_max, j_min, j_max]\n        \n        results.append([max_cfl, bounding_box])\n\n    # Convert the results list to the specified string format\n    # The default str() representation of a list of lists matches the required format\n    # with spaces after commas, which is a common and readable convention.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n\n```", "id": "3592396"}, {"introduction": "稳定的模拟不一定能准确反映物理现实。在离散网格上，波可能以错误的速度传播（数值频散），高频成分也可能被误解为低频（混叠）。本练习将指导你使用“修正波数”的概念来量化这些误差，并比较标准格式与先进的频散关系保持 (DRP) 格式的性能。完成此分析将使你能够根据精度要求来明智地选择数值方法。[@problem_id:3592376]", "problem": "你需要设计并实现一个程序，用于量化和比较在地震动有限差分模拟中使用的两种空间微分算子的数值频散和混叠。比较的对象是一个标准的交错网格一阶导数算子和一个保频散关系（DRP）的显式中心差分格式。你的分析和实现必须基于一维线性声波方程和平面波解。\n\n从以下基本和核心定义开始：\n- 一维线性声波方程为 $ \\partial^2 u / \\partial t^2 = c^2 \\, \\partial^2 u / \\partial x^2 $，其中 $u(x,t)$ 是位移，$c$ 是波速。\n- 一个平面波解为 $ u(x,t) = \\Re\\{ \\exp(i(k x - \\omega t)) \\} $，其角频率 $\\omega$ 和波数 $k$ 满足连续频散关系 $ \\omega = c \\, k $。\n- 在间距为 $ \\Delta x $ 的空间网格上进行离散化，会对波进行采样，并要求可分辨的波数位于主布里渊区 $ k \\in (-\\pi/\\Delta x, \\pi/\\Delta x] $ 内。任何超出此区间的真实波数 $k_{\\text{true}}$ 都会通过卷绕的方式被混叠为主区间内的一个观测波数 $k_{\\text{obs}}$。\n\n定义以下数值微分算子及其傅里叶符号（修正波数），它们通过 $ \\omega_{\\text{num}} = c \\, k_{\\text{mod}} $ 与半离散频散关系相关联：\n- 标准交错网格一阶导数（交错节点上的两点差分）：对于一个归一化波数为 $ \\kappa \\equiv k \\, \\Delta x \\in (-\\pi, \\pi] $ 的采样平面波，其修正波数的幅值为\n$$ k_{\\text{mod,stag}}(\\kappa) = \\frac{2}{\\Delta x} \\left| \\sin\\!\\left(\\frac{\\kappa}{2}\\right) \\right|. $$\n- 一个7点显式DRP中心一阶导数算子，其反对称系数 $a_1, a_2, a_3$ 应用如下\n$$ \\left.\\frac{\\partial u}{\\partial x}\\right|_{x_j} \\approx \\frac{1}{\\Delta x} \\left[ a_1 \\left(u_{j+1} - u_{j-1}\\right) + a_2 \\left(u_{j+2} - u_{j-2}\\right) + a_3 \\left(u_{j+3} - u_{j-3}\\right) \\right], $$\n其修正波数的幅值为\n$$ k_{\\text{mod,drp}}(\\kappa) = \\frac{2}{\\Delta x} \\left| a_1 \\sin(\\kappa) + a_2 \\sin(2\\kappa) + a_3 \\sin(3\\kappa) \\right|. $$\n使用保频散关系系数\n$$ a_1 = 0.770882380518225, \\quad a_2 = -0.166705904414580, \\quad a_3 = 0.020843142770311. $$\n\n为了量化高波数下的误差，对于任何真实物理频率 $f$ 定义：\n- 真实物理波数 $ k_{\\text{true}} = \\frac{2\\pi f}{c} $。\n- 真实归一化波数 $ \\kappa_{\\text{true}} = k_{\\text{true}} \\Delta x $。\n- 主区间内的混叠归一化波数\n$$ \\kappa_{\\text{obs}} = \\mathrm{wrap}\\!\\left(\\kappa_{\\text{true}}\\right) \\in (-\\pi,\\pi], \\quad \\text{其中} \\quad \\mathrm{wrap}(\\kappa) = \\kappa - 2\\pi \\left\\lfloor \\frac{\\kappa + \\pi}{2\\pi} \\right\\rfloor. $$\n- 观测波数的幅值 $ |k_{\\text{obs}}| = \\frac{|\\kappa_{\\text{obs}}|}{\\Delta x} $。\n- 混叠比\n$$ r_{\\text{alias}} = \\frac{|k_{\\text{obs}}|}{|k_{\\text{true}}|} = \\frac{|\\kappa_{\\text{obs}}|}{|\\kappa_{\\text{true}}|}, $$\n它衡量了由于混叠，网格对真实物理波数的低估程度。这是一个无量纲数。\n- 空间算子的相位误差，定义为相对于混叠波数处可精确表示的导数的误差，\n$$ \\varepsilon_{\\text{phase,scheme}} = \\frac{k_{\\text{mod,scheme}}(\\kappa_{\\text{obs}})}{|k_{\\text{obs}}|} - 1, $$\n对于每种格式 $\\{\\text{stag}, \\text{drp}\\}$。这是一个无量纲数。\n\n实现一个程序，对于每个测试案例，计算三个输出：\n- $ \\varepsilon_{\\text{phase,stag}} $，\n- $ \\varepsilon_{\\text{phase,drp}} $，\n- $ r_{\\text{alias}} $。\n\n所有案例使用的物理参数：\n- 剪切波速 $ c = 3000 \\, \\text{m/s} $，\n- 网格间距 $ \\Delta x = 10 \\, \\text{m} $。\n\n测试集：\n- 频率 $ f $（单位：赫兹）：$ [30, 75, 120, 150, 160, 225] $。\n\n角度单位：所有三角函数的参数均为弧度。\n\n输入与输出：\n- 程序不得接受用户输入，并将使用上述固定参数。\n- 所有输出均为无量纲小数。\n\n最终输出规范：\n- 对于每个测试频率 $ f $，输出一个列表 $ [\\varepsilon_{\\text{phase,stag}}, \\varepsilon_{\\text{phase,drp}}, r_{\\text{alias}}] $，其中每个值都四舍五入到六位小数。\n- 你的程序应生成单行输出，包含一个由这些列表组成的逗号分隔列表，并用方括号括起来，例如 $ [[x_{11},x_{12},x_{13}],[x_{21},x_{22},x_{23}],\\dots] $，不含任何额外文本。", "solution": "该问题已经过验证，被确定为计算地球物理学中一个适定且科学合理的问题。所有给定的定义、参数和方程都是一致的，并且足以得出一个唯一的解。\n\n任务是计算并比较用于近似空间一阶导数的两种不同有限差分格式的数值误差。需要量化的误差是源于数值频散的相位误差，以及捕捉离散网格上高频波失真的混叠比。该分析基于一维声波方程，针对一系列物理频率进行。\n\n解是通过对每个给定的频率 $f$ 执行一系列计算得出的。\n\n**步骤1：计算真实物理波数和归一化波数**\n\n对于以速度 $c$ 传播的波，角频率 $\\omega$ 和波数 $k$ 之间的基本关系由连续频散关系 $\\omega = c k$ 给出。角频率通过 $\\omega = 2\\pi f$ 与时间频率 $f$ 相关联。因此，对于给定的频率 $f$，真实物理波数 $k_{\\text{true}}$ 为：\n$$ k_{\\text{true}} = \\frac{2\\pi f}{c} $$\n给定的物理参数为 $c = 3000 \\, \\text{m/s}$，网格间距为 $\\Delta x = 10 \\, \\text{m}$。\n\n为了分析基于网格的效应，使用无量纲的归一化波数 $\\kappa$ 会很方便，其定义为 $\\kappa = k \\Delta x$。因此，真实归一化波数为：\n$$ \\kappa_{\\text{true}} = k_{\\text{true}} \\Delta x = \\frac{2\\pi f \\Delta x}{c} $$\n这个量衡量了波在单个网格单元上累积的相角弧度数。\n\n**步骤2：计算混叠波数和混叠比**\n\n间距为 $\\Delta x$ 的离散网格只能唯一地表示主布里渊区 $k \\in (-\\pi/\\Delta x, \\pi/\\Delta x]$ 中的波数。用归一化波数表示，这对应于 $\\kappa \\in (-\\pi, \\pi]$。任何在此区间之外的真实归一化波数 $\\kappa_{\\text{true}}$ 都会发生混叠，意味着它与区间内的一个观测归一化波数 $\\kappa_{\\text{obs}}$ 不可区分。问题提供了卷绕函数来形式化此混叠过程：\n$$ \\kappa_{\\text{obs}} = \\mathrm{wrap}(\\kappa_{\\text{true}}) = \\kappa_{\\text{true}} - 2\\pi \\left\\lfloor \\frac{\\kappa_{\\text{true}} + \\pi}{2\\pi} \\right\\rfloor $$\n此函数将任何实数值 $\\kappa_{\\text{true}}$ 映射到区间 $(-\\pi, \\pi]$ 中。\n\n混叠比 $r_{\\text{alias}}$ 量化了这种波数畸变的程度。它是观测波数的幅值与真实波数的幅值之比。由于 $f  0$，因此 $k_{\\text{true}}$ 和 $\\kappa_{\\text{true}}$ 均为正数。\n$$ r_{\\text{alias}} = \\frac{|k_{\\text{obs}}|}{|k_{\\text{true}}|} = \\frac{|\\kappa_{\\text{obs}} / \\Delta x|}{k_{\\text{true}}} = \\frac{|\\kappa_{\\text{obs}}|}{\\kappa_{\\text{true}}} $$\n$r_{\\text{alias}}=1$ 的值表示没有混叠（波被恰当解析），而 $r_{\\text{alias}}  1$ 表示网格感知到的波长比其实际波长更长（波数更小）。\n\n**步骤3：计算修正波数**\n\n数值微分算子不能完美地再现解析导数。当应用于平面波 $\\exp(i k x)$ 时，数值导数算子的作用相当于乘以 $i k_{\\text{mod}}$，其中 $k_{\\text{mod}}$ 是修正波数。$k_{\\text{mod}}$ 与理想波数 $k$ 的偏差是数值频散的来源。问题提供了两种格式的修正波数幅值，它们是归一化波数 $\\kappa = \\kappa_{\\text{obs}}$ 的函数。\n\n对于标准交错网格算子：\n$$ k_{\\text{mod,stag}}(\\kappa_{\\text{obs}}) = \\frac{2}{\\Delta x} \\left| \\sin\\!\\left(\\frac{\\kappa_{\\text{obs}}}{2}\\right) \\right| $$\n对于系数为 $a_1=0.770882380518225$, $a_2=-0.166705904414580$, $a_3=0.020843142770311$ 的7点保频散关系（DRP）算子：\n$$ k_{\\text{mod,drp}}(\\kappa_{\\text{obs}}) = \\frac{2}{\\Delta x} \\left| a_1 \\sin(\\kappa_{\\text{obs}}) + a_2 \\sin(2\\kappa_{\\text{obs}}) + a_3 \\sin(3\\kappa_{\\text{obs}}) \\right| $$\n\n**步骤4：计算相位误差**\n\n相位误差 $\\varepsilon_{\\text{phase,scheme}}$ 衡量了数值算子相对于混叠波上理想微分的准确性。它被定义为算子的修正波数幅值与观测波数幅值 $|k_{\\text{obs}}| = |\\kappa_{\\text{obs}}| / \\Delta x$ 之间的相对误差：\n$$ \\varepsilon_{\\text{phase,scheme}} = \\frac{k_{\\text{mod,scheme}}(\\kappa_{\\text{obs}})}{|k_{\\text{obs}}|} - 1 $$\n通过代入 $k_{\\text{mod}}$ 和 $|k_{\\text{obs}}|$ 的表达式，可以简化该公式，这揭示了相位误差仅依赖于归一化的观测波数 $\\kappa_{\\text{obs}}$：\n\n对于交错网格格式：\n$$ \\varepsilon_{\\text{phase,stag}} = \\frac{\\frac{2}{\\Delta x} \\left| \\sin(\\frac{\\kappa_{\\text{obs}}}{2}) \\right|}{|\\kappa_{\\text{obs}}| / \\Delta x} - 1 = \\frac{2 \\left| \\sin(\\frac{\\kappa_{\\text{obs}}}{2}) \\right|}{|\\kappa_{\\text{obs}}|} - 1 $$\n对于DRP格式：\n$$ \\varepsilon_{\\text{phase,drp}} = \\frac{\\frac{2}{\\Delta x} \\left| \\sum_{j=1}^{3} a_j \\sin(j\\kappa_{\\text{obs}}) \\right|}{|\\kappa_{\\text{obs}}| / \\Delta x} - 1 = \\frac{2 \\left| \\sum_{j=1}^{3} a_j \\sin(j\\kappa_{\\text{obs}}) \\right|}{|\\kappa_{\\text{obs}}|} - 1 $$\n相位误差为 $0$ 表示对于给定的（混叠）波数，微分是完美的。负误差通常意味着数值格式传播波的速度比应有的速度慢（数值频散）。注意，在极限 $\\kappa_{\\text{obs}} \\to 0$ 时，两种相位误差都趋近于 $0$，这在实现中作为特殊情况处理，以避免除以零。\n\n**算法摘要**\n\n对于测试集 $[30, 75, 120, 150, 160, 225]$ Hz 中的每个频率 $f$：\n1.  计算 $k_{\\text{true}} = 2\\pi f / c$。\n2.  计算 $\\kappa_{\\text{true}} = k_{\\text{true}} \\Delta x$。\n3.  通过将 $\\kappa_{\\text{true}}$ 卷绕到区间 $(-\\pi, \\pi]$ 来计算 $\\kappa_{\\text{obs}}$。\n4.  计算 $r_{\\text{alias}} = |\\kappa_{\\text{obs}}| / \\kappa_{\\text{true}}$。\n5.  使用带有 $\\kappa_{\\text{obs}}$ 的简化公式计算 $\\varepsilon_{\\text{phase,stag}}$。\n6.  使用带有 $\\kappa_{\\text{obs}}$ 的简化公式计算 $\\varepsilon_{\\text{phase,drp}}$。\n7.  收集这三个结果 $[\\varepsilon_{\\text{phase,stag}}, \\varepsilon_{\\text{phase,drp}}, r_{\\text{alias}}]$，将每个值四舍五入到六位小数，并附加到最终的结果列表中。\n最终输出是这些列表的列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes numerical dispersion and aliasing errors for two finite difference\n    schemes used in wave propagation modeling.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [30, 75, 120, 150, 160, 225]\n\n    # Physical and numerical parameters\n    c = 3000.0  # Shear-wave speed in m/s\n    dx = 10.0   # Grid spacing in m\n\n    # DRP operator coefficients\n    a1 = 0.770882380518225\n    a2 = -0.166705904414580\n    a3 = 0.020843142770311\n    \n    all_results = []\n\n    for f in test_cases:\n        # Step 1: Calculate true physical and normalized wavenumbers\n        k_true = 2 * np.pi * f / c\n        kappa_true = k_true * dx\n\n        # Step 2: Calculate aliased normalized wavenumber\n        # The wrap function maps kappa_true to the interval (-pi, pi]\n        kappa_obs = kappa_true - 2 * np.pi * np.floor((kappa_true + np.pi) / (2 * np.pi))\n\n        # Step 3: Calculate the aliasing ratio\n        # Since f > 0, kappa_true is always positive.\n        r_alias = np.abs(kappa_obs) / kappa_true\n\n        # Step 4: Calculate phase errors for each scheme\n        # A check is included for the case where kappa_obs is numerically zero to\n        # avoid division by zero. In this case, the phase error is zero.\n        if np.abs(kappa_obs)  1e-9:\n            eps_stag = 0.0\n            eps_drp = 0.0\n        else:\n            # Staggered-grid scheme phase error\n            eps_stag = (2 * np.abs(np.sin(kappa_obs / 2)) / np.abs(kappa_obs)) - 1\n\n            # DRP scheme phase error\n            drp_sin_term = a1 * np.sin(kappa_obs) + a2 * np.sin(2 * kappa_obs) + a3 * np.sin(3 * kappa_obs)\n            eps_drp = (2 * np.abs(drp_sin_term) / np.abs(kappa_obs)) - 1\n            \n        # Collect results for the current frequency, rounded to 6 decimal places\n        case_results = np.round([eps_stag, eps_drp, r_alias], 6).tolist()\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The format is a list of lists, comma-separated, with no spaces.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3592376"}]}