{"hands_on_practices": [{"introduction": "在我们将数值求解器用于科学探索之前，必须首先验证代码是否正确地求解了其预设的数学方程。造解法（Method of Manufactured Solutions, MMS）是一种严谨的验证方式，它通过“制造”一个具有已知精确解的问题来实现这一目标。本练习 ([@problem_id:3616973]) 将指导你实现一个有限差分求解器，并量化其离散化误差，这是评估和建立对计算模型信心的关键第一步。", "problem": "考虑由亥姆霍兹方程控制的频域声波模拟。从均匀介质中波速$c$为常数的线性声波方程开始，其形式为$$\\frac{1}{c^2}\\frac{\\partial^2 p}{\\partial t^2} - \\nabla^2 p = s(\\mathbf{x}, t),$$ 其中$p(\\mathbf{x}, t)$是声压场，$\\nabla^2$是拉普拉斯算子，$s(\\mathbf{x}, t)$是源项。假设具有时谐依赖性$p(\\mathbf{x}, t) = \\Re\\{u(\\mathbf{x}) e^{-i \\omega t}\\}$以及类似的$s(\\mathbf{x}, t) = \\Re\\{f(\\mathbf{x}) e^{-i \\omega t}\\}$，其中角频率为$\\omega$。记波数$k = \\omega/c$，推导有界域上带有狄利克雷边界数据（边界上压力设为零）的频域控制模型。您应得到一个关联$u(\\mathbf{x})$和$f(\\mathbf{x})$的亥姆霍兹型边值问题。\n\n计算地球物理学中的验证应使用范数度量和人工解方法（MMS）来量化离散误差。在MMS中，首先指定一个光滑的精确解$u_{\\text{exact}}(\\mathbf{x})$，然后通过将其代入连续算子来导出相应的源项$f(\\mathbf{x})$，并确保满足边界条件。\n\n在单位正方形域$$\\Omega = [0,1]\\times[0,1]$$上，使用MMS为亥姆霍兹方程实现一个验证程序，并采用狄利克雷边界条件。使用在$\\partial \\Omega$上为零的人工解$$u_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(2\\pi y),$$。通过将$u_{\\text{exact}}$代入连续算子，导出所需的源函数$f(x,y)$，从而使精确解满足连续亥姆霍兹方程。\n\n使用标准的五点二阶精度中心差分格式，在均匀网格上离散化$-\\nabla^2 u - k^2 u = f$。设每个坐标方向上的内部网格点数为$n$，网格间距为$h = 1/(n+1)$，并通过在边界节点上设置$u=0$来强制施加狄利克雷边界条件。为内部未知数组装得到的线性系统并求解。将计算解$u_h$在内部节点上的采样值与精确解$u_{\\text{exact}}$在相同节点上的采样值进行比较。\n\n计算离散误差$e = u_h - u_{\\text{exact}}$的以下误差范数：\n- 离散$L^2$范数$$\\|e\\|_{L^2,h} = \\left(h^2 \\sum_{i=1}^{n}\\sum_{j=1}^{n} e_{ij}^2\\right)^{1/2}.$$\n- 离散$L^\\infty$范数$$\\|e\\|_{L^\\infty,h} = \\max_{1\\le i,j\\le n} |e_{ij}|.$$\n- 使用中心差分和边界补零近似的离散$H^1$半范数$$|e|_{H^1,h} = \\left(h^2 \\sum_{i=1}^{n}\\sum_{j=1}^{n} \\left[\\left(\\frac{e_{i+1,j}-e_{i-1,j}}{2h}\\right)^2 + \\left(\\frac{e_{i,j+1}-e_{i,j-1}}{2h}\\right)^2\\right]\\right)^{1/2},$$ 其中索引$0$和$n+1$指的是$e=0$的边界节点。\n\n您的程序必须实现上述内容，并为下面指定的每个测试用例生成三种范数的数值。由于问题是无量纲化的，不需要物理单位；所有输出必须是纯实数。\n\n测试套件：\n- 用例 1：$n=32$, $k=\\pi$。\n- 用例 2：$n=64$, $k=8\\pi$。\n- 用例 3：$n=8$, $k=2\\pi$（粗网格边缘情况）。\n- 用例 4：$n=64$, $k=\\pi\\sqrt{4.9}$（与所选人工模态的近共振边缘情况）。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。顺序必须是$$[\\|e\\|_{L^2,h}^{(1)}, \\|e\\|_{L^\\infty,h}^{(1)}, |e|_{H^1,h}^{(1)}, \\|e\\|_{L^2,h}^{(2)}, \\|e\\|_{L^\\infty,h}^{(2)}, |e|_{H^1,h}^{(2)}, \\|e\\|_{L^2,h}^{(3)}, \\|e\\|_{L^\\infty,h}^{(3)}, |e|_{H^1,h}^{(3)}, \\|e\\|_{L^2,h}^{(4)}, \\|e\\|_{L^\\infty,h}^{(4)}, |e|_{H^1,h}^{(4)}],$$ 其中上标${}^{(m)}$表示测试用例$m$。所有条目必须是实值浮点数。", "solution": "用户提供了一个问题，要求使用人工解方法（MMS）来验证亥姆霍兹方程的数值求解器。\n\n### 第1步：提取给定信息\n\n-   **控制方程（时域）：** 均匀介质中的线性声波方程为 $\\frac{1}{c^2}\\frac{\\partial^2 p}{\\partial t^2} - \\nabla^2 p = s(\\mathbf{x}, t)$，其中 $p$ 是压力，$c$ 是波速，$s$ 是源项。\n-   **时谐假设：** 压力 $p(\\mathbf{x}, t)$ 和源 $s(\\mathbf{x}, t)$ 假设具有时谐形式 $p(\\mathbf{x}, t) = \\Re\\{u(\\mathbf{x}) e^{-i \\omega t}\\}$ 和 $s(\\mathbf{x}, t) = \\Re\\{f(\\mathbf{x}) e^{-i \\omega t}\\}$，其中 $\\omega$ 是角频率。\n-   **波数定义：** 波数为 $k = \\omega/c$。\n-   **域和边界条件：** 域是单位正方形 $\\Omega = [0,1]\\times[0,1]$，边界 $\\partial \\Omega$ 上有狄利克雷边界条件 $u=0$。\n-   **人工解：** 指定的精确解是 $u_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(2\\pi y)$。\n-   **离散格式：** 将使用标准的五点二阶精度中心差分格式在均匀网格上进行离散。\n-   **网格参数：** 每个坐标方向上的内部网格点数为 $n$，网格间距为 $h = 1/(n+1)$。\n-   **需要计算的误差范数：**\n    1.  离散 $L^2$ 范数：$\\|e\\|_{L^2,h} = \\left(h^2 \\sum_{i=1}^{n}\\sum_{j=1}^{n} e_{ij}^2\\right)^{1/2}$。\n    2.  离散 $L^\\infty$ 范数：$\\|e\\|_{L^\\infty,h} = \\max_{1\\le i,j\\le n} |e_{ij}|$。\n    3.  离散 $H^1$ 半范数：$|e|_{H^1,h} = \\left(h^2 \\sum_{i=1}^{n}\\sum_{j=1}^{n} \\left[\\left(\\frac{e_{i+1,j}-e_{i-1,j}}{2h}\\right)^2 + \\left(\\frac{e_{i,j+1}-e_{i,j-1}}{2h}\\right)^2\\right]\\right)^{1/2}$，边界补零 $e=0$。\n-   **测试用例：**\n    1.  $n=32$, $k=\\pi$。\n    2.  $n=64$, $k=8\\pi$。\n    3.  $n=8$, $k=2\\pi$。\n    4.  $n=64$, $k=\\pi\\sqrt{4.9}$。\n\n### 第2步：使用提取的给定信息进行验证\n\n根据验证标准对问题进行审查。\n\n-   **科学性：** 该问题基于声波方程及其频域表示——亥姆霍兹方程，这些是物理学和工程学中的基本概念。人工解方法是计算科学中用于代码验证的标准且严谨的技术。离散化和误差分析方法也是数值分析中的标准方法。该问题具有科学合理性。\n-   **适定性：** 对于给定的源项 $f$，带有狄利克雷边界条件的亥姆霍兹方程是一个适定的边值问题，前提是 $k^2$ 不是该域上负拉普拉斯算子的特征值。人工解 $u_{\\text{exact}}$ 对应于拉普拉斯算子的一个特征函数。相应的特征值是 $\\lambda = (1^2+2^2)\\pi^2 = 5\\pi^2$。如果 $k^2=5\\pi^2$，问题将发生共振。测试用例4设置 $k^2=4.9\\pi^2$，接近共振点。这使得问题在数值上具有挑战性（病态），但并非不适定，因为唯一解仍然存在。这是亥姆霍兹求解器的一种常见且有效的测试。问题是适定的。\n-   **客观性：** 问题使用精确的数学和计算术语进行陈述。任务、参数和要求的输出格式都得到了明确的定义。\n-   **完整性和一致性：** 提供了所有必要的信息：偏微分方程、域、边界条件、人工解、离散格式、网格定义、误差范数公式和测试参数。信息内部一致。例如，人工解在单位正方形上正确满足零狄利克雷边界条件。\n\n### 第3步：结论和行动\n\n问题陈述是**有效的**。它科学合理、适定、客观且完整。我将继续进行完整解答。\n\n### 基于原理的解答\n\n求解过程结构如下：首先，我们推导连续频域模型（亥姆霍兹方程）和相应的人工源项。其次，我们描述将此模型离散化为线性方程组的过程。第三，我们概述求解该系统和计算所需误差范数的过程。\n\n**1. 亥姆霍兹方程和人工源的推导**\n\n我们从声波方程开始：\n$$\n\\frac{1}{c^2}\\frac{\\partial^2 p(\\mathbf{x}, t)}{\\partial t^2} - \\nabla^2 p(\\mathbf{x}, t) = s(\\mathbf{x}, t)\n$$\n代入时谐形式 $p(\\mathbf{x}, t) = \\Re\\{u(\\mathbf{x}) e^{-i \\omega t}\\}$ 和 $s(\\mathbf{x}, t) = \\Re\\{f(\\mathbf{x}) e^{-i \\omega t}\\}$ 得到：\n$$\n\\frac{\\partial p}{\\partial t} = \\Re\\{-i\\omega u(\\mathbf{x}) e^{-i\\omega t}\\}, \\quad \\frac{\\partial^2 p}{\\partial t^2} = \\Re\\{(-i\\omega)^2 u(\\mathbf{x}) e^{-i\\omega t}\\} = \\Re\\{-\\omega^2 u(\\mathbf{x}) e^{-i\\omega t}\\}\n$$\n$$\n\\nabla^2 p = \\Re\\{\\nabla^2 u(\\mathbf{x}) e^{-i\\omega t}\\}\n$$\n波方程变为：\n$$\n\\Re\\left\\{-\\frac{\\omega^2}{c^2} u(\\mathbf{x}) e^{-i\\omega t} - \\nabla^2 u(\\mathbf{x}) e^{-i\\omega t} - f(\\mathbf{x}) e^{-i\\omega t}\\right\\} = 0\n$$\n因为此式必须对所有时间 $t$ 成立，所以大括号内的项必须为零。使用波数 $k = \\omega/c$，我们得到亥姆霍兹方程：\n$$\n-\\nabla^2 u(\\mathbf{x}) - k^2 u(\\mathbf{x}) = f(\\mathbf{x})\n$$\n问题定义在域 $\\Omega = [0,1]\\times[0,1]$ 上，边界条件为 $u(\\mathbf{x})=0$ for $\\mathbf{x} \\in \\partial\\Omega$。\n\n对于人工解方法，我们假设一个精确解 $u_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(2\\pi y)$，并推导出使其成为解的源项 $f(x,y)$。这个 $u_{\\text{exact}}$ 满足在 $\\partial\\Omega$ 上的零狄利克雷边界条件。我们将 $u_{\\text{exact}}$ 代入亥姆霍兹算子：\n$$\nf(x,y) = -\\nabla^2 u_{\\text{exact}}(x,y) - k^2 u_{\\text{exact}}(x,y)\n$$\n我们计算偏导数：\n$$\n\\frac{\\partial^2 u_{\\text{exact}}}{\\partial x^2} = \\frac{\\partial^2}{\\partial x^2} \\left[ \\sin(\\pi x)\\sin(2\\pi y) \\right] = -\\pi^2 \\sin(\\pi x)\\sin(2\\pi y) = -\\pi^2 u_{\\text{exact}}\n$$\n$$\n\\frac{\\partial^2 u_{\\text{exact}}}{\\partial y^2} = \\frac{\\partial^2}{\\partial y^2} \\left[ \\sin(\\pi x)\\sin(2\\pi y) \\right] = -4\\pi^2 \\sin(\\pi x)\\sin(2\\pi y) = -4\\pi^2 u_{\\text{exact}}\n$$\n拉普拉斯算子为 $\\nabla^2 u_{\\text{exact}} = \\frac{\\partial^2 u_{\\text{exact}}}{\\partial x^2} + \\frac{\\partial^2 u_{\\text{exact}}}{\\partial y^2} = (-\\pi^2 - 4\\pi^2) u_{\\text{exact}} = -5\\pi^2 u_{\\text{exact}}$。\n将此代入 $f(x,y)$ 的表达式中：\n$$\nf(x,y) = -(-5\\pi^2 u_{\\text{exact}}) - k^2 u_{\\text{exact}} = (5\\pi^2 - k^2) u_{\\text{exact}}\n$$\n因此，所需的源项为：\n$$\nf(x,y) = (5\\pi^2 - k^2) \\sin(\\pi x)\\sin(2\\pi y)\n$$\n\n**2. 离散化和线性系统组装**\n\n我们用一个均匀网格对域进行离散化，网格点的坐标为 $(x_i, y_j) = (ih, jh)$，其中 $i,j \\in \\{0, 1, \\dots, n+1\\}$，网格间距为 $h = 1/(n+1)$。内部点对应于索引 $i,j \\in \\{1, \\dots, n\\}$。\n亥姆霍兹方程在每个内部点 $(x_i, y_j)$ 使用五点中心差分格式对负拉普拉斯算子进行离散：\n$$\n-\\nabla^2 u \\Big|_{(x_i, y_j)} \\approx \\frac{4u_{i,j} - u_{i-1,j} - u_{i+1,j} - u_{i,j-1} - u_{i,j+1}}{h^2}\n$$\n其中 $u_{i,j} \\approx u(x_i, y_j)$。在点 $(i,j)$ 的离散方程是：\n$$\n\\frac{4u_{i,j} - u_{i-1,j} - u_{i+1,j} - u_{i,j-1} - u_{i,j+1}}{h^2} - k^2 u_{i,j} = f_{i,j}\n$$\n其中 $f_{i,j} = f(x_i, y_j)$。这个包含 $n^2$ 个线性方程的系统，用于求解 $n^2$ 个内部未知值 $u_{i,j}$，可以写成矩阵形式 $A \\mathbf{u}_h = \\mathbf{f}_h$。未知向量 $\\mathbf{u}_h$ 是通过将 $n \\times n$ 的 $u_{i,j}$ 值网格展平成一个大小为 $N=n^2$ 的向量而形成的。使用行主序，对应于网格点 $(i,j)$（网格点用1基索引，编程用0基索引）的向量索引 $p$ 是 $p = (i-1)n + (j-1)$。矩阵 $A$ 是一个稀疏对称的 $N \\times N$ 矩阵。其元素由差分格式确定：\n-   对角线元素：$A_{p,p} = \\frac{4}{h^2} - k^2$。\n-   非对角线元素：对于相邻点，为非零值 $-\\frac{1}{h^2}$，对应于向量偏移量 $\\pm 1$ 和 $\\pm n$。\n\n**3. 误差计算**\n\n在求解 $A \\mathbf{u}_h = \\mathbf{f}_h$ 得到数值解 $\\mathbf{u}_h$ 后，我们将其重塑为一个 $n \\times n$ 的网格 $U_h$。精确解 $u_{\\text{exact}}(x,y)$ 在相同的内部网格点上求值，得到网格 $U_{\\text{exact}}$。离散误差是差值 $E = U_h - U_{\\text{exact}}$。然后按如下方式计算所需的范数：\n\n-   **$L^2$ 范数：** 此范数是积分 $\\int |e|^2 d\\mathbf{x}$ 的一个近似。计算公式为 $\\|e\\|_{L^2,h} = h (\\sum_{i=1}^n \\sum_{j=1}^n e_{ij}^2)^{1/2}$。\n\n-   **$L^\\infty$ 范数：** 此范数测量网格上的最大点误差：$\\|e\\|_{L^\\infty,h} = \\max_{1\\le i,j\\le n} |e_{ij}|$。\n\n-   **$H^1$ 半范数：** 此范数近似误差梯度$L^2$范数，即 $\\int |\\nabla e|^2 d\\mathbf{x}$。梯度分量使用中心差分进行近似。为了在差分格式中处理边界点，误差网格 $E$ 用一层零进行填充，这反映了误差在边界上为零的事实。内部点 $(i,j)$ 的导数为 $\\frac{\\partial e}{\\partial x}\\big|_{ij} \\approx \\frac{e_{i+1,j}-e_{i-1,j}}{2h}$ 和 $\\frac{\\partial e}{\\partial y}\\big|_{ij} \\approx \\frac{e_{i,j+1}-e_{i,j-1}}{2h}$。通过将这些近似导数的平方在所有内部点上求和，乘以 $h^2$，然后取平方根来计算该范数。\n\n该实现将为每个测试用例自动化这些步骤。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main solver function that runs all test cases and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: n=32, k=pi\n        (32, np.pi),\n        # Case 2: n=64, k=8*pi\n        (64, 8 * np.pi),\n        # Case 3: n=8, k=2*pi\n        (8, 2 * np.pi),\n        # Case 4: n=64, k=pi*sqrt(4.9)\n        (64, np.pi * np.sqrt(4.9)),\n    ]\n\n    results = []\n    for n, k in test_cases:\n        l2_norm, linf_norm, h1_semi_norm = solve_helmholtz_mms(n, k)\n        results.extend([l2_norm, linf_norm, h1_semi_norm])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_helmholtz_mms(n, k):\n    \"\"\"\n    Solves the Helmholtz BVP using MMS for a given n and k, and returns error norms.\n\n    Args:\n        n (int): Number of interior grid points along one dimension.\n        k (float): Wavenumber.\n\n    Returns:\n        tuple: A tuple containing the L2 norm, L-infinity norm, and H1 semi-norm of the error.\n    \"\"\"\n    # 1. Grid setup\n    h = 1.0 / (n + 1)\n    # Create coordinates for the n interior points\n    interior_coords = np.linspace(h, 1.0 - h, n)\n    # Create a meshgrid for evaluating functions on the 2D interior grid\n    # 'ij' indexing ensures Xi changes along rows (index i) and Yi along columns (index j)\n    Xi, Yi = np.meshgrid(interior_coords, interior_coords, indexing='ij')\n\n    # 2. Define manufactured solution and source term\n    def u_exact_func(x, y):\n        return np.sin(np.pi * x) * np.sin(2 * np.pi * y)\n\n    def source_func(x, y, k_val):\n        # f = (5*pi^2 - k^2) * u_exact\n        return (5 * np.pi**2 - k_val**2) * u_exact_func(x, y)\n\n    # 3. Evaluate exact solution and source on the grid\n    U_exact = u_exact_func(Xi, Yi)\n    F = source_func(Xi, Yi, k)\n    # Flatten the source term grid into a vector for the linear system solver.\n    # 'C' (row-major) order is consistent with the matrix assembly.\n    f_vec = F.flatten(order='C')\n\n    # 4. Assemble the discrete operator matrix A\n    N = n * n\n    h2 = h**2\n\n    # Main diagonal: (4/h^2 - k^2)\n    main_diag = np.full(N, 4.0 / h2 - k**2)\n\n    # Off-diagonals for x- and y-derivatives\n    off_diag_val = -1.0 / h2\n    \n    # Offsets +/- 1 correspond to y-neighbors (-u_j-1, -u_j+1)\n    off_diag1 = np.full(N - 1, off_diag_val)\n    # Remove connections at grid row boundaries\n    off_diag1[n-1::n] = 0.0\n    \n    # Offsets +/- n correspond to x-neighbors (-u_i-1, -u_i+1)\n    off_diagn = np.full(N - n, off_diag_val)\n\n    diagonals = [main_diag, off_diag1, off_diag1, off_diagn, off_diagn]\n    offsets = [0, -1, 1, -n, n]\n    \n    # 'csc' format is efficient for the direct solver spsolve\n    A = diags(diagonals, offsets, shape=(N, N), format='csc')\n\n    # 5. Solve the linear system Au_h = f_h\n    u_h_vec = spsolve(A, f_vec)\n    \n    # Reshape the solution vector back to a 2D grid\n    U_h = u_h_vec.reshape((n, n), order='C')\n\n    # 6. Calculate the error and norms\n    E = U_h - U_exact\n\n    # Discrete L2 norm\n    norm_L2 = h * np.linalg.norm(E.flatten('C'))\n\n    # Discrete L-infinity norm\n    norm_Linf = np.max(np.abs(E))\n\n    # Discrete H1 semi-norm\n    # Pad error grid with zeros to handle boundary conditions in difference stencils\n    E_padded = np.zeros((n + 2, n + 2))\n    E_padded[1:-1, 1:-1] = E\n    \n    # Approximate derivatives using central differences on the interior grid\n    dEdx = (E_padded[2:, 1:-1] - E_padded[:-2, 1:-1]) / (2 * h)\n    dEdy = (E_padded[1:-1, 2:] - E_padded[1:-1, :-2]) / (2 * h)\n    \n    # Calculate the norm from the derivatives\n    h1_seminorm_sq = h**2 * np.sum(dEdx**2 + dEdy**2)\n    norm_H1_semi = np.sqrt(h1_seminorm_sq)\n\n    return norm_L2, norm_Linf, norm_H1_semi\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3616973"}, {"introduction": "有了一个经过验证的求解器，我们就可以开始探索物理定律了。本练习着眼于震源-接收点互易性原理，这是波动算子自伴性质的一个基本推论。在这个实践中 ([@problem_id:3616960])，你将把数值求解器作为一个虚拟实验室，在均匀和更复杂的非均匀介质中检验这一原理，从而加深对物理和数值模型之间联系的理解。", "problem": "您需要为频域声学亥姆霍兹方程实现一个验证程序，该程序通过互易性和算子对称性来验证数值建模。其物理出发点是在各向同性、密度恒定的介质中，压力所满足的二阶标量声波方程，写作 $ \\partial_{tt} p(\\mathbf{x},t) = c(\\mathbf{x})^2 \\nabla^2 p(\\mathbf{x},t) + s(\\mathbf{x},t) $，其中 $ p $ 是压力，$ c(\\mathbf{x}) $ 是波速，$ \\nabla^2 $ 是拉普拉斯算子，$ s $ 是源项。在时谐假设 $ p(\\mathbf{x},t) = \\Re\\{ u(\\mathbf{x}) e^{-i \\omega t} \\} $（角频率 $ \\omega = 2 \\pi f $）下，频域场 $ u(\\mathbf{x}) $ 满足亥姆霍兹方程，形式为 $ \\nabla^2 u(\\mathbf{x}) + k(\\mathbf{x})^2 u(\\mathbf{x}) = q(\\mathbf{x}) $，其中 $ k(\\mathbf{x}) = \\omega m(\\mathbf{x}) $，$ m(\\mathbf{x}) = 1 / c(\\mathbf{x}) $ 是慢度。在频域设置中，对于定义域边界上的齐次狄利克雷边界条件 $ u(\\mathbf{x}) = 0 $，当 $ c(\\mathbf{x}) $ 为实数时，连续算子是自伴的。\n\n您的任务是：\n- 在二维笛卡尔网格上，仅对内部节点使用标准的二阶中心差分法来离散化拉普拉斯算子，从而离散化亥姆霍兹方程（狄利克雷边界值设为 $ 0 $，不属于未知量）。在内部网格上使用五点模板。\n- 组装得到的线性系统 $ A u = b $，其中 $ A $ 是一个实稀疏矩阵。离散波数项 $ k(\\mathbf{x})^2 $ 应作为逐点对角线加法项添加到离散拉普拉斯算子中。\n- 将点源实现为在指定内部网格索引处施加的离散克罗内克-德尔塔函数，即 $ b $ 在除了源索引处为 $ 1 $ 外，其他位置均为零。\n- 针对多种源配置求解线性系统，并数值验证互易性：对于两个源索引 $ i $ 和 $ j $，计算标量残差 $ r = | u^{(i)}_j - u^{(j)}_i | $，其中 $ u^{(i)} $ 表示与右端项 $ b $（在 $ i $ 处有单位源）相关联的解，$ u^{(i)}_j $ 表示该解中在索引 $ j $ 处的值。此外，通过计算相对残差 $ s = \\| A - A^\\top \\| / \\| A \\| $ 来验证算子对称性，其中 $ \\| \\cdot \\| $ 是任意一致的矩阵范数。\n- 所有输出量均视为无量纲量。长度和频率等物理参数应分别解释为米和赫兹，但您输出的任何量都不带物理单位。此问题不涉及角度。\n\n使用以下测试套件，它为三个不同情况指定了输入参数，涵盖了一般情况、非均匀介质情况和边界邻近情况。在每种情况下，域都是一个大小为 $ L_x \\times L_y $ 的矩形，具有均匀的网格间距。设 $ N_x $ 和 $ N_y $ 分别是 $ x $ 和 $ y $ 方向上的总网格点数，内部点数为 $ N_x^\\text{int} = N_x - 2 $ 和 $ N_y^\\text{int} = N_y - 2 $。网格间距为 $ h = L_x / (N_x - 1) = L_y / (N_y - 1) $。慢度 $ m(\\mathbf{x}) $ 按指定为分段常数。\n\n- 测试用例 $ 1 $（均匀介质，内部源）：\n    - $ N_x = 50 $，$ N_y = 50 $。\n    - $ L_x = 1000 $，$ L_y = 1000 $。\n    - 频率 $ f = 5 $ 赫兹，$ \\omega = 2 \\pi f $。\n    - 波速 $ c_0 = 1500 $ 米/秒，慢度 $ m_0 = 1 / c_0 $。\n    - $ m(\\mathbf{x}) = m_0 $ 在所有地方。\n    - 内部坐标系中的源索引：$ i = \\left( \\left\\lfloor N_x^\\text{int} / 3 \\right\\rfloor, \\left\\lfloor N_y^\\text{int} / 2 \\right\\rfloor \\right) $，$ j = \\left( \\left\\lfloor 2 N_x^\\text{int} / 3 \\right\\rfloor, \\left\\lfloor N_y^\\text{int} / 2 \\right\\rfloor \\right) $。\n\n- 测试用例 $ 2 $（含圆形夹杂的非均匀介质）：\n    - $ N_x = 50 $，$ N_y = 50 $。\n    - $ L_x = 1000 $，$ L_y = 1000 $。\n    - 频率 $ f = 5 $ 赫兹，$ \\omega = 2 \\pi f $。\n    - 背景波速 $ c_0 = 1500 $ 米/秒，背景慢度 $ m_0 = 1 / c_0 $。\n    - 夹杂波速 $ c_1 = 2000 $ 米/秒，夹杂慢度 $ m_1 = 1 / c_1 $。\n    - 圆形夹杂中心位于 $ (L_x / 2, L_y / 2) $，半径 $ R = 200 $ 米；在圆内设置 $ m(\\mathbf{x}) = m_1 $，在圆外设置 $ m(\\mathbf{x}) = m_0 $。\n    - 内部坐标系中的源索引：$ i = (10, 30) $，$ j = (35, 15) $。\n\n- 测试用例 $ 3 $（均匀介质，源靠近边界）：\n    - $ N_x = 50 $，$ N_y = 50 $。\n    - $ L_x = 1000 $，$ L_y = 1000 $。\n    - 频率 $ f = 8 $ 赫兹，$ \\omega = 2 \\pi f $。\n    - 波速 $ c_0 = 1500 $ 米/秒，慢度 $ m_0 = 1 / c_0 $。\n    - $ m(\\mathbf{x}) = m_0 $ 在所有地方。\n    - 内部坐标系中的源索引：$ i = (1, 1) $，$ j = (N_x^\\text{int} - 2, N_y^\\text{int} - 2) $。\n\n精确的算法要求：\n- 在间距为 $ h $ 的矩形网格上，使用五点模板对 $ \\nabla^2 $ 进行离散化，并为每个内部节点包含对角项 $ k(\\mathbf{x})^2 $（其中 $ k(\\mathbf{x}) = \\omega m(\\mathbf{x}) $），以组装仅包含内部节点的线性系统 $ A u = b $。边界强制 $ u = 0 $，并且不出现在 $ A $ 或 $ b $ 中。\n- 对于每个测试用例，构建 $ A $ 并计算指定源对的对称性残差 $ s $ 和互易性残差 $ r $。\n- 使用双精度算术。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为 $ [ s_1, r_1, s_2, r_2, s_3, r_3 ] $，其中 $ s_k $ 和 $ r_k $ 分别是测试用例 $ k $ 的对称性残差和互易性残差。每个元素必须是实数（浮点数）。不允许在任何其他行上有额外输出。", "solution": "任务是为二维声学亥姆霍兹方程实现算子对称性和源-接收器互易性的数值验证。该验证将在算子的有限差分-离散化上执行。\n\n频域中的控制方程是亥姆霍兹方程：\n$$ \\nabla^2 u(\\mathbf{x}) + k(\\mathbf{x})^2 u(\\mathbf{x}) = q(\\mathbf{x}) $$\n其中 $u(\\mathbf{x})$ 是角频率为 $\\omega$ 的复值压力场，$\\mathbf{x} \\in \\mathbb{R}^2$ 是空间坐标，$q(\\mathbf{x})$ 是源项，$k(\\mathbf{x})$ 是空间变化的波数。波数定义为 $k(\\mathbf{x}) = \\omega m(\\mathbf{x})$，其中 $m(\\mathbf{x}) = 1/c(\\mathbf{x})$ 是介质的慢度，即波速 $c(\\mathbf{x})$ 的倒数。该问题指定了在矩形域边界上的齐次狄利克雷边界条件 $u(\\mathbf{x}) = 0$。对于实值慢度函数 $m(\\mathbf{x})$，亥姆霍兹算子 $L = \\nabla^2 + k(\\mathbf{x})^2$ 是自伴的，这一性质产生了互易性。\n\n主要步骤是该方程的离散化、相应线性系统的组装以及其基本性质的数值验证。\n\n**1. 有限差分离散化**\n\n我们使用均匀的笛卡尔网格对域 $\\Omega = [0, L_x] \\times [0, L_y]$ 进行离散化，每个方向上有 $N_x$ 和 $N_y$ 个点。网格间距为 $h = L_x / (N_x - 1) = L_y / (N_y - 1)$。未知量集合仅包含内部网格点上的场值 $u$。内部点的数量为 $N_x^\\text{int} = N_x - 2$ 和 $N_y^\\text{int} = N_y - 2$。一个内部网格点由索引 $(i_x, i_y)$ 表示，其中 $i_x \\in \\{0, \\dots, N_x^\\text{int}-1\\}$ 且 $i_y \\in \\{0, \\dots, N_y^\\text{int}-1\\}$。\n\n在内部点 $(i_x, i_y)$ 处的拉普拉斯算子 $\\nabla^2$ 使用二阶、五点中心差分模板进行近似：\n$$ \\nabla^2 u |_{(i_x,i_y)} \\approx \\frac{u_{i_x+1, i_y} + u_{i_x-1, i_y} + u_{i_x, i_y+1} + u_{i_x, i_y-1} - 4u_{i_x, i_y}}{h^2} $$\n将此代入亥姆霍兹方程，得到每个内部节点 $(i_x, i_y)$ 的离散方程：\n$$ \\frac{u_{i_x+1, i_y} + u_{i_x-1, i_y} + u_{i_x, i_y+1} + u_{i_x, i_y-1} - 4u_{i_x, i_y}}{h^2} + k_{i_x, i_y}^2 u_{i_x, i_y} = q_{i_x, i_y} $$\n其中 $u_{i_x, i_y}$ 表示网格点处的场，$k_{i_x, i_y} = \\omega m_{i_x, i_y}$ 是离散波数。由于齐次狄利克雷条件，对应于域边界上邻居的项为零，因此在内部节点的方程组中被省略。\n\n**2. 线性系统组装**\n\n$N_{unk} = N_x^\\text{int} \\times N_y^\\text{int}$ 个离散方程组构成一个线性系统 $A \\mathbf{u} = \\mathbf{b}$。未知量向量 $\\mathbf{u}$ 是通过将内部值 $u_{i_x, i_y}$ 的二维网格展平为一维向量而形成的。我们采用行主序映射，其中对应于二维索引对 $(i_x, i_y)$ 的一维索引 $p$ 为 $p = i_y \\cdot N_x^\\text{int} + i_x$。\n\n矩阵 $A$ 是一个大小为 $N_{unk} \\times N_{unk}$ 的稀疏矩阵。根据离散方程，第 $p$ 行（对应于节点 $(i_x, i_y)$）的元素构造如下：\n- 对角线元素为 $A_{p,p} = k_{i_x,i_y}^2 - \\frac{4}{h^2}$。\n- 对应于四个邻居的非对角线元素为 $A_{p, p'} = \\frac{1}{h^2}$。对于位于 $(i_x', i_y')$ 的邻居，其一维索引为 $p'$。\n这种结构产生一个块三对角矩阵。由于有限差分模板是对称的，且波数项 $k^2$ 只影响主对角线，因此只要所有量都是实数，得到的矩阵 $A$ 就是对称的，即 $A = A^\\top$。\n\n右端向量 $\\mathbf{b}$ 表示离散化的源项 $q(\\mathbf{x})$。对于位于一维索引 $s$ 的内部位置的单位点源，向量 $\\mathbf{b}$ 是一个克罗内克-德尔塔函数：$b_p = \\delta_{ps}$。\n\n**3. 对称性与互易性的验证**\n\n所构建的离散算子 $A$ 的对称性是离散化方案的直接结果。我们通过计算 $A$ 与其转置 $A^\\top$ 之差的相对残差来数值验证这一点：\n$$ s = \\frac{\\| A - A^\\top \\|_F}{\\| A \\|_F} $$\n其中 $\\| \\cdot \\|_F$ 表示弗罗贝尼乌斯范数。对于一个完全对称的矩阵，$s$ 应在机器精度范围内为零。\n\n互易性是源于控制算子自伴性的物理原理。对于自伴算子，格林函数 $G(\\mathbf{x}, \\mathbf{x}')$ 是对称的：$G(\\mathbf{x}, \\mathbf{x}') = G(\\mathbf{x}', \\mathbf{x})$。位于 $\\mathbf{x}_i$ 的点源的解是 $u^{(i)}(\\mathbf{x}) = G(\\mathbf{x}, \\mathbf{x}_i)$。因此，由位于 $\\mathbf{x}_i$ 的源在 $\\mathbf{x}_j$ 处产生的场等于由位于 $\\mathbf{x}_j$ 的源在 $\\mathbf{x}_i$ 处产生的场。\n在离散设置中，这转化为 $u^{(i)}_j = u^{(j)}_i$。这里，$\\mathbf{u}^{(i)} = A^{-1} \\mathbf{b}^{(i)}$ 是索引为 $i$ 的单位源的解向量，$u^{(i)}_j$ 是该解在索引 $j$ 处的分量。这个等式源于逆矩阵的对称性，$(A^{-1})_{ji} = (A^{-1})_{ij}$，而这本身是 $A$ 对称性的结果。我们通过计算绝对残差来验证互易性：\n$$ r = | u^{(i)}_j - u^{(j)}_i | $$\n该值也应接近于零。\n\n**4. 实现步骤**\n\n对于每个测试用例，执行以下步骤：\n1.  计算仿真参数：网格间距 $h$、内部网格尺寸 $N_x^\\text{int}, N_y^\\text{int}$ 和角频率 $\\omega$。\n2.  根据用例规范在内部网格上构建二维慢度模型 $m(x,y)$。对于非均匀情况，需要根据圆形夹杂的几何形状进行逐点检查。\n3.  使用五点模板逻辑和对角线上的平方波数项 $k^2 = (\\omega m)^2$ 来组装大小为 $(N_{unk} \\times N_{unk})$ 的稀疏矩阵 $A$。为提高效率，使用 `scipy.sparse.csc_matrix` 等稀疏格式。\n4.  计算对称性残差 $s$。\n5.  确定两个指定源位置的一维索引 $p_i$ 和 $p_j$。\n6.  构建两个右端向量 $\\mathbf{b}^{(i)}$ 和 $\\mathbf{b}^{(j)}$，每个都代表一个单位脉冲源。\n7.  使用稀疏线性求解器求解两个线性系统 $A \\mathbf{u}^{(i)} = \\mathbf{b}^{(i)}$ 和 $A \\mathbf{u}^{(j)} = \\mathbf{b}^{(j)}$。\n8.  提取所需的解分量：$u^{(i)}_{p_j} = (\\mathbf{u}^{(i)})_{p_j}$ 和 $u^{(j)}_{p_i} = (\\mathbf{u}^{(j)})_{p_i}$。\n9.  计算互易性残差 $r$。\n10. 存储对 $(s, r)$ 以供最终输出。\n对所有三个测试用例重复此过程，并汇总结果。", "answer": "```python\nimport numpy as np\nimport scipy.sparse as sp\nimport scipy.sparse.linalg as spla\nimport math\n\ndef run_case(params):\n    \"\"\"\n    Runs a single test case for Helmholtz equation verification.\n\n    Args:\n        params (dict): A dictionary containing all parameters for the test case.\n\n    Returns:\n        tuple: A tuple containing the symmetry residual (s) and reciprocity residual (r).\n    \"\"\"\n    Nx = params[\"Nx\"]\n    Ny = params[\"Ny\"]\n    Lx = params[\"Lx\"]\n    Ly = params[\"Ly\"]\n    f = params[\"f\"]\n    m_model_spec = params[\"m_model\"]\n    src_indices = params[\"sources\"]\n\n    # 1. Calculate derived parameters\n    Nx_int = Nx - 2\n    Ny_int = Ny - 2\n    N_unk = Nx_int * Ny_int\n    h = Lx / (Nx - 1)\n    omega = 2.0 * np.pi * f\n    \n    # 2. Create slowness model\n    c0 = m_model_spec.get(\"c0\", 1500.0)\n    m0 = 1.0 / c0\n    \n    m_interior = np.full((Ny_int, Nx_int), m0, dtype=np.float64)\n\n    if m_model_spec[\"type\"] == \"heterogeneous\":\n        c1 = m_model_spec[\"c1\"]\n        m1 = 1.0 / c1\n        center_x, center_y = m_model_spec[\"center\"]\n        radius_sq = m_model_spec[\"radius\"]**2\n        \n        for iy in range(Ny_int):\n            for ix in range(Nx_int):\n                # Physical coordinates of the interior grid point\n                x = (ix + 1) * h\n                y = (iy + 1) * h\n                if (x - center_x)**2 + (y - center_y)**2 = radius_sq:\n                    m_interior[iy, ix] = m1\n    \n    # 3. Assemble the sparse matrix A\n    k_sq_flat = (omega * m_interior.flatten())**2\n    h_sq_inv = 1.0 / (h**2)\n    \n    # Using LIL format for easy assembly, then convert to CSC for performance\n    A = sp.lil_matrix((N_unk, N_unk), dtype=np.float64)\n\n    for iy in range(Ny_int):\n        for ix in range(Nx_int):\n            p = iy * Nx_int + ix\n            \n            # Main diagonal: k^2 - 4/h^2\n            A[p, p] = k_sq_flat[p] - 4.0 * h_sq_inv\n            \n            # Off-diagonals: 1/h^2 for neighbors\n            if ix > 0:            # Left neighbor\n                A[p, p - 1] = h_sq_inv\n            if ix  Nx_int - 1:   # Right neighbor\n                A[p, p + 1] = h_sq_inv\n            if iy > 0:            # Top neighbor\n                A[p, p - Nx_int] = h_sq_inv\n            if iy  Ny_int - 1:   # Bottom neighbor\n                A[p, p + Nx_int] = h_sq_inv\n\n    A = A.asformat('csc')\n\n    # 4. Compute symmetry residual\n    # The default norm for scipy.sparse.linalg.norm is the Frobenius norm.\n    s = spla.norm(A - A.T) / spla.norm(A)\n\n    # 5. Define sources and solve systems\n    (ix_i, iy_i), (ix_j, iy_j) = src_indices\n    p_i = iy_i * Nx_int + ix_i\n    p_j = iy_j * Nx_int + ix_j\n    \n    # Source i\n    b_i = np.zeros(N_unk, dtype=np.float64)\n    b_i[p_i] = 1.0\n    u_i = spla.spsolve(A, b_i)\n    \n    # Source j\n    b_j = np.zeros(N_unk, dtype=np.float64)\n    b_j[p_j] = 1.0\n    u_j = spla.spsolve(A, b_j)\n    \n    # 6. Compute reciprocity residual\n    u_i_at_pj = u_i[p_j]\n    u_j_at_pi = u_j[p_i]\n    r = np.abs(u_i_at_pj - u_j_at_pi)\n    \n    return s, r\n\ndef solve():\n    Nx = 50\n    Ny = 50\n    Nx_int = Nx - 2\n    Ny_int = Ny - 2\n    \n    test_cases = [\n        # Test Case 1\n        {\n            \"Nx\": Nx, \"Ny\": Ny, \"Lx\": 1000., \"Ly\": 1000., \"f\": 5.,\n            \"m_model\": {\"type\": \"homogeneous\", \"c0\": 1500.},\n            \"sources\": (\n                (math.floor(Nx_int / 3), math.floor(Ny_int / 2)),\n                (math.floor(2 * Nx_int / 3), math.floor(Ny_int / 2))\n            )\n        },\n        # Test Case 2\n        {\n            \"Nx\": Nx, \"Ny\": Ny, \"Lx\": 1000., \"Ly\": 1000., \"f\": 5.,\n            \"m_model\": {\n                \"type\": \"heterogeneous\", \"c0\": 1500., \"c1\": 2000.,\n                \"center\": (500., 500.), \"radius\": 200.\n            },\n            \"sources\": ((10, 30), (35, 15))\n        },\n        # Test Case 3\n        {\n            \"Nx\": Nx, \"Ny\": Ny, \"Lx\": 1000., \"Ly\": 1000., \"f\": 8.,\n            \"m_model\": {\"type\": \"homogeneous\", \"c0\": 1500.},\n            \"sources\": ((1, 1), (Nx_int - 2, Ny_int - 2))\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        s, r = run_case(case)\n        results.extend([s, r])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3616960"}, {"introduction": "数值解本质上是真实解的近似。对于波动方程，一个最关键的误差来源是“污染效应”（pollution effect），即数值波速会依赖于网格间距，导致相位误差随着传播距离而累积。本解析练习 ([@problem_id:3616936]) 将通过推导数值频散关系，深入探讨此误差的根源，为理解前两个实践中所用方法的局限性提供至关重要的理论洞察。", "problem": "考虑在角频率为 $\\omega$ 的驱动下，单色声波在声速为常数 $c$ 的均匀流体中的传播。从声波方程出发，并引入时谐假设 (time-harmonic ansatz)，推导频域控制方程，并用 $\\omega$ 和 $c$ 定义波数 $k$。在一个$\\text{一维}$无限介质中，考虑复振幅 $u(x)$ 的齐次亥姆霍兹方程，写作 $\\frac{d^{2}u}{dx^{2}} + k^{2} u = 0$。对于频域建模，在一个间距为 $h$ 的均匀网格上，使用 2 阶中心差分格式来近似空间二阶导数，因此在网格索引 $j$ 处的离散算子为 $\\frac{u_{j+1} - 2 u_{j} + u_{j-1}}{h^{2}} + k^{2} u_{j}$。假设一个离散平面波解的形式为 $u_{j} = \\exp(i k_{d} x_{j})$，其中 $x_{j} = j h$，$k_{d}$ 是由有限差分方法离散化所导致的离散波数。将传播距离 $L$ 上累积的污染相移误差定义为 $\\Delta \\phi(L) = (k_{d} - k) L$。仅使用声波方程的基本出发点和所述的离散化方法，并在渐近区域 $\\epsilon = k h \\ll 1$ 中，推导出 $\\Delta \\phi(L)$ 的首阶非零项，其形式为一个关于 $k$、$h$ 和 $L$ 的封闭解析表达式。最终答案以弧度表示。无需进行数值计算。", "solution": "用户要求推导一维亥姆霍兹方程有限差分离散的首阶污染相移误差。\n\n首先，我们验证问题陈述。\n\n**步骤 1：提取给定条件**\n- **物理系统**：单色声波在均匀流体中的传播。\n- **常数**：恒定声速 $c$，角频率 $\\omega$。\n- **控制方程（时域）**：声波方程。\n- **假设 (Ansatz)**：时谐，从而得到频域模型。\n- **控制方程（频域）**：复振幅 $u(x)$ 的一维齐次亥姆霍兹方程，给定为 $\\frac{d^{2}u}{dx^{2}} + k^{2} u = 0$。\n- **波数定义**：波数 $k$ 将用 $\\omega$ 和 $c$ 来定义。\n- **离散化方法**：在间距为 $h$ 的均匀网格上的二阶中心差分格式。\n- **离散方程**：亥姆霍兹方程的离散形式是通过替换二阶导数得到的，其结果是在每个网格点 $j$ 上的代数方程 $\\frac{u_{j+1} - 2 u_{j} + u_{j-1}}{h^{2}} + k^{2} u_{j} = 0$。\n- **离散解形式**：离散平面波，$u_{j} = \\exp(i k_{d} x_{j})$，其中 $x_{j} = j h$，$k_{d}$ 是离散波数。\n- **误差定义**：在距离 $L$ 上的污染相移误差为 $\\Delta \\phi(L) = (k_{d} - k) L$。\n- **渐近区域**：分析将在 $\\epsilon = k h \\ll 1$ 的条件下进行。\n- **目标**：推导 $\\Delta \\phi(L)$ 的首阶非零项，作为关于 $k$、$h$ 和 $L$ 的解析表达式。\n\n**步骤 2：使用提取的给定条件进行验证**\n- **科学依据**：该问题坚实地基于波动物理学的基本原理、亥姆霍兹方程以及标准的数值分析技术（有限差分）。数值频散和污染误差的概念是计算波模拟中一个公认且关键的课题。前提是合理的。\n- **适定性**：该问题是适定的。它提供了一个明确的目标、所有必要的方程、定义以及推导唯一解析解所需的极限条件。\n- **目标**：问题以精确、客观和形式化的数学语言陈述。\n\n问题陈述没有科学缺陷、歧义或矛盾。它代表了偏微分方程数值分析中的一个标准的、非平凡的问题。\n\n**步骤 3：结论与行动**\n问题是有效的。我们继续进行求解。\n\n在声速为常数 $c$ 的均匀介质中，声波方程由下式给出：\n$$\n\\frac{\\partial^2 p(\\boldsymbol{x}, t)}{\\partial t^2} = c^2 \\nabla^2 p(\\boldsymbol{x}, t)\n$$\n其中 $p(\\boldsymbol{x}, t)$ 是声压场。对于角频率为 $\\omega$ 的单色波，我们通过分离变量使用时谐假设 (time-harmonic ansatz)：\n$$\np(\\boldsymbol{x}, t) = u(\\boldsymbol{x}) \\exp(-i \\omega t)\n$$\n其中 $u(\\boldsymbol{x})$ 是复数值的空间振幅。将其代入波动方程，时间导数变为：\n$$\n\\frac{\\partial p}{\\partial t} = -i \\omega u(\\boldsymbol{x}) \\exp(-i \\omega t)\n$$\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = (-i \\omega)^2 u(\\boldsymbol{x}) \\exp(-i \\omega t) = -\\omega^2 u(\\boldsymbol{x}) \\exp(-i \\omega t)\n$$\n空间导数项变为：\n$$\n\\nabla^2 p(\\boldsymbol{x}, t) = (\\nabla^2 u(\\boldsymbol{x})) \\exp(-i \\omega t)\n$$\n将这些代入波动方程得到：\n$$\n-\\omega^2 u(\\boldsymbol{x}) \\exp(-i \\omega t) = c^2 (\\nabla^2 u(\\boldsymbol{x})) \\exp(-i \\omega t)\n$$\n两边除以 $c^2 \\exp(-i \\omega t)$ 并重新整理各项，我们得到亥姆霍兹方程：\n$$\n\\nabla^2 u(\\boldsymbol{x}) + \\frac{\\omega^2}{c^2} u(\\boldsymbol{x}) = 0\n$$\n通过与标准形式 $\\nabla^2 u + k^2 u = 0$ 进行比较，我们定义波数 $k$ 为：\n$$\nk = \\frac{\\omega}{c}\n$$\n在一维空间中，该方程简化为：\n$$\n\\frac{d^2 u(x)}{dx^2} + k^2 u(x) = 0\n$$\n这就是问题中给出的连续、一维齐次亥姆霍兹方程。\n\n接下来，我们分析离散问题。在网格点 $x_j = jh$ 处的二阶导数 $\\frac{d^2 u}{dx^2}$ 使用二阶中心差分模板进行近似：\n$$\n\\frac{d^2 u}{dx^2}\\bigg|_{x=x_j} \\approx \\frac{u(x_{j+1}) - 2u(x_j) + u(x_{j-1})}{h^2} = \\frac{u_{j+1} - 2 u_{j} + u_{j-1}}{h^{2}}\n$$\n其中 $h$ 是均匀的网格间距。将此代入连续方程，得到在每个内部网格点 $j$ 处都成立的离散代数方程：\n$$\n\\frac{u_{j+1} - 2 u_{j} + u_{j-1}}{h^{2}} + k^{2} u_{j} = 0\n$$\n我们检验形式为 $u_j = \\exp(i k_d x_j) = \\exp(i k_d j h)$ 的离散平面波解，其中 $k_d$ 是离散波数。方程中的各项变为：\n- $u_j = \\exp(i k_d j h)$\n- $u_{j+1} = \\exp(i k_d (j+1) h) = u_j \\exp(i k_d h)$\n- $u_{j-1} = \\exp(i k_d (j-1) h) = u_j \\exp(-i k_d h)$\n\n将这些代入离散方程：\n$$\n\\frac{u_j \\exp(i k_d h) - 2 u_j + u_j \\exp(-i k_d h)}{h^2} + k^2 u_j = 0\n$$\n由于 $u_j \\neq 0$，我们可以用它来除，从而得到数值色散关系，该关系将真实波数 $k$ 与离散波数 $k_d$ 联系起来：\n$$\n\\frac{\\exp(i k_d h) - 2 + \\exp(-i k_d h)}{h^2} + k^2 = 0\n$$\n使用恒等式 $\\cos(\\theta) = \\frac{\\exp(i\\theta) + \\exp(-i\\theta)}{2}$，分子可以重写为 $2\\cos(k_d h) - 2$。\n$$\n\\frac{2\\cos(k_d h) - 2}{h^2} + k^2 = 0\n$$\n重新整理以求解 $k^2$：\n$$\nk^2 = \\frac{2(1 - \\cos(k_d h))}{h^2}\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2 \\sin^2(\\frac{\\theta}{2})$，我们得到：\n$$\nk^2 = \\frac{2(2 \\sin^2(\\frac{k_d h}{2}))}{h^2} = \\frac{4}{h^2} \\sin^2\\left(\\frac{k_d h}{2}\\right)\n$$\n取正平方根得到 $k$ 的关系式：\n$$\nk = \\frac{2}{h} \\sin\\left(\\frac{k_d h}{2}\\right)\n$$\n为了求出污染误差，我们必须用 $k$ 来表示 $k_d$。重新整理上述方程：\n$$\n\\sin\\left(\\frac{k_d h}{2}\\right) = \\frac{k h}{2}\n$$\n$$\n\\frac{k_d h}{2} = \\arcsin\\left(\\frac{k h}{2}\\right)\n$$\n$$\nk_d = \\frac{2}{h} \\arcsin\\left(\\frac{k h}{2}\\right)\n$$\n我们关心的是 $\\epsilon = k h \\ll 1$ 的渐近区域。在此极限下，反正弦函数 (arcsin) 的自变量很小。我们使用 $\\arcsin(z)$ 在 $z=0$ 附近的泰勒级数展开：\n$$\n\\arcsin(z) = z + \\frac{1}{6}z^3 + \\frac{3}{40}z^5 + O(z^7)\n$$\n设 $z = \\frac{k h}{2}$。将其代入 $k_d$ 的表达式中：\n$$\nk_d = \\frac{2}{h} \\left[ \\left(\\frac{k h}{2}\\right) + \\frac{1}{6}\\left(\\frac{k h}{2}\\right)^3 + O((kh)^5) \\right]\n$$\n$$\nk_d = \\frac{2}{h} \\left[ \\frac{k h}{2} + \\frac{1}{6} \\frac{k^3 h^3}{8} + O(h^5) \\right]\n$$\n$$\nk_d = k + \\frac{2}{h} \\left( \\frac{k^3 h^3}{48} \\right) + O(h^4)\n$$\n$$\nk_d = k + \\frac{k^3 h^2}{24} + O(h^4)\n$$\n因此，离散波数与连续波数之间的差值为：\n$$\nk_d - k = \\frac{k^3 h^2}{24} + O(h^4)\n$$\n该差值的首阶非零项是 $\\frac{k^3 h^2}{24}$。在传播距离 $L$ 上累积的污染相移误差 $\\Delta \\phi(L)$ 定义为 $(k_d - k)L$。因此，该相移误差的首阶项为：\n$$\n\\Delta \\phi(L) = \\left(\\frac{k^3 h^2}{24}\\right) L = \\frac{k^3 h^2 L}{24}\n$$\n该表达式给出了数值波在距离 $L$ 上相对于真实解析波的累积相位滞后（因为 $\\Delta \\phi  0$）。", "answer": "$$\\boxed{\\frac{k^{3} h^{2} L}{24}}$$", "id": "3616936"}]}