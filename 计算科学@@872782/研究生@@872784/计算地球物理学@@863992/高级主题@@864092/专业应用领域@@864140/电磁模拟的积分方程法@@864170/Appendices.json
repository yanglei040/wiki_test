{"hands_on_practices": [{"introduction": "在电磁积分方程的数值求解中，一个核心挑战是如何处理当源点和场点重合时产生的奇异积分。本练习将引导您探索一种强大的技术——Duffy变换，它通过巧妙的坐标映射来消除积分核的弱奇异性。掌握这项技术对于精确实现基于矩量法的电磁建模至关重要，因为它能将奇异积分转化为可以在标准正交网格上高效计算的常规积分 [@problem_id:3604636]。", "problem": "对于来自理想电导体表面的时谐散射，电场积分方程 (EFIE) 的一种标准形式采用了自由空间格林函数 $G_{k}(\\mathbf{r},\\mathbf{r}') = \\exp(-\\mathrm{i} k |\\mathbf{r}-\\mathbf{r}'|)/(4\\pi |\\mathbf{r}-\\mathbf{r}'|)$，并导致矩量法矩阵元涉及以下形式的弱奇异性曲面积分：\n$$\n\\int_{T} \\frac{\\psi(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\,\\mathrm{d}S',\n$$\n其中 $T$ 是一个平面三角形单元，$\\mathbf{r}$ 位于 $T$ 上，$\\psi$ 是由测试函数、基函数以及核函数的光滑部分所导出的光滑函数。在奇异点 $\\mathbf{r}' \\to \\mathbf{r}$ 的静态极限下，其主导行为由 $1/|\\mathbf{r}-\\mathbf{r}'|$ 决定。\n\n从频域中的麦克斯韦方程组和通过 Stratton–Chu 表示的 EFIE 定义出发，从第一性原理论证，为什么在点 $\\mathbf{r}_{0}\\in T$ 附近的平面三角形单元上的积分的局部奇异结构，是由局部曲面坐标中的二维极坐标距离行为 $\\rho \\mapsto 1/\\rho$ 控制的，并证明为什么一个能分解出径向变量的变量替换会消除该弱奇异性。\n\n提出一种 Duffy 变换，将一个奇异点位于顶点的参考直角三角形映射到一个或多个张量积参数空间，并使其雅可比行列式能够消除 $1/\\rho$ 奇异性。具体来说，考虑参考三角形\n$$\nT_{\\mathrm{ref}} = \\{ (x,y) \\in \\mathbb{R}^{2} : x \\ge 0,\\; y \\ge 0,\\; x + y \\le 1 \\},\n$$\n其奇异点位于顶点 $(0,0)$。请具体说明 $T_{\\mathrm{ref}}$ 的分解、相关的映射 $(u,v)\\mapsto (x,y)$ 及其雅可比行列式。\n\n然后，为展示你所提变换的效果，通过应用你的 Duffy 映射并精确执行得到的张量积积分，来计算带有常数权重的典范弱奇异积分：\n$$\nI_{\\mathrm{ref}} \\equiv \\int_{T_{\\mathrm{ref}}} \\frac{1}{\\sqrt{x^{2}+y^{2}}}\\,\\mathrm{d}x\\,\\mathrm{d}y,\n$$\n请将你的最终答案表示为一个无单位的闭式解析表达式。不要四舍五入；请提供精确表达式。", "solution": "该问题陈述经核实具有科学依据、提法恰当且客观。它提出了计算电磁学领域中一个标准的、非平凡的问题，涉及边界元法中奇异积分的正则化。所有提供的信息都是一致的，并且足以得到唯一解。\n\n根据要求，解答分为三部分：首先，从原理上论证奇异性结构；其次，为典范参考三角形提出 Duffy 变换；第三，使用此变换显式计算一个弱奇异积分。\n\n第一部分：从第一性原理分析奇异性结构\n\n对于嵌入均匀介质中的理想电导体 (PEC) 表面 $S$，时谐电场积分方程 (EFIE) 是从 Stratton-Chu 表示公式推导出来的。它强制执行边界条件，即表面上总电场的切向分量为零：\n$$\n\\mathbf{\\hat{n}} \\times \\mathbf{E}^{\\mathrm{inc}}(\\mathbf{r}) + \\mathbf{\\hat{n}} \\times \\mathbf{E}^{\\mathrm{scat}}(\\mathbf{r}) = \\mathbf{0}, \\quad \\text{for } \\mathbf{r} \\in S\n$$\n其中 $\\mathbf{\\hat{n}}$ 是指向 $S$ 外部的法向量，$\\mathbf{E}^{\\mathrm{inc}}$ 是入射电场，$\\mathbf{E}^{\\mathrm{scat}}$ 是散射电场。散射电场是由在 $S$ 上感应出的等效面电流密度 $\\mathbf{J}(\\mathbf{r}')$ 产生的。它可以通过磁矢量势 $\\mathbf{A}$ 和电标量势 $\\Phi$ 来表示：\n$$\n\\mathbf{E}^{\\mathrm{scat}} = \\mathrm{i}\\omega \\mathbf{A} + \\nabla \\Phi\n$$\n这些势由源电流 $\\mathbf{J}$ 的积分给出：\n$$\n\\mathbf{A}(\\mathbf{r}) = \\mu \\int_{S} G_{k}(\\mathbf{r},\\mathbf{r}') \\mathbf{J}(\\mathbf{r}') \\,\\mathrm{d}S'\n$$\n$$\n\\Phi(\\mathbf{r}) = \\frac{1}{\\epsilon} \\int_{S} G_{k}(\\mathbf{r},\\mathbf{r}') \\rho_{s}(\\mathbf{r}') \\,\\mathrm{d}S' = \\frac{1}{\\mathrm{i}\\omega\\epsilon} \\int_{S} G_{k}(\\mathbf{r},\\mathbf{r}') (\\nabla' \\cdot \\mathbf{J}(\\mathbf{r}')) \\,\\mathrm{d}S'\n$$\n这里我们使用了连续性方程 $\\nabla' \\cdot \\mathbf{J} = \\mathrm{i}\\omega\\rho_s$。自由空间格林函数为 $G_{k}(\\mathbf{r},\\mathbf{r}') = \\frac{\\exp(-\\mathrm{i} k |\\mathbf{r}-\\mathbf{r}'|)}{4\\pi |\\mathbf{r}-\\mathbf{r}'|}$，其中波数 $k=\\omega\\sqrt{\\mu\\epsilon}$。\n\n将这些表达式代入 EFIE 后，我们得到一个积分微分方程。这些积分的核函数都包含格林函数 $G_{k}(\\mathbf{r},\\mathbf{r}')$。当观测点 $\\mathbf{r}$ 接近源点 $\\mathbf{r}'$ 时，这些积分中出现奇异性。项 $\\exp(-\\mathrm{i} k |\\mathbf{r}-\\mathbf{r}'|)$ 是解析的，并且当 $|\\mathbf{r}-\\mathbf{r}'| \\to 0$ 时趋近于 $1$。因此，奇异性主要由格林函数的静态部分主导，其形式为 $1/R$，其中 $R=|\\mathbf{r}-\\mathbf{r}'|$。前述积分 $\\int_{T} \\frac{\\psi(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\,\\mathrm{d}S'$ 是这种奇异行为的典范表示，其中 $\\psi(\\mathbf{r}')$ 整合了被积函数的所有光滑部分。\n\n现在，考虑一个平面三角形单元 $T$ 和一个计算奇异性的点 $\\mathbf{r}_0 \\in T$。我们可以在三角形所在的平面上建立一个以 $\\mathbf{r}_0$ 为原点的局部二维笛卡尔坐标系 $(x', y')$。在 $\\mathbf{r}_0$ 附近、三角形上的点 $\\mathbf{r}'$ 的坐标为 $(x', y')$。距离为 $|\\mathbf{r}' - \\mathbf{r}_0| = \\sqrt{(x')^2 + (y')^2}$。变换到以 $\\mathbf{r}_0$ 为中心的局部极坐标 $(\\rho, \\phi)$，定义为 $x' = \\rho\\cos\\phi$ 和 $y' = \\rho\\sin\\phi$。在这些坐标中，距离变为 $|\\mathbf{r}' - \\mathbf{r}_0| = \\rho$。这些坐标下的曲面元为 $\\mathrm{d}S' = \\rho\\,\\mathrm{d}\\rho\\,\\mathrm{d}\\phi$。\n\n在奇异点附近，即 $\\mathbf{r}' \\to \\mathbf{r}_0$ (也就是 $\\rho \\to 0$)，积分的行为近似为：\n$$\n\\int \\int \\frac{\\psi(\\mathbf{r}')}{|\\mathbf{r}' - \\mathbf{r}_0|} \\,\\mathrm{d}S' \\approx \\int \\int \\frac{\\psi(\\rho, \\phi)}{\\rho} (\\rho\\,\\mathrm{d}\\rho\\,\\mathrm{d}\\phi) = \\int \\int \\psi(\\rho, \\phi)\\,\\mathrm{d}\\rho\\,\\mathrm{d}\\phi\n$$\n这表明核函数中的 $1/\\rho$ 奇异性被从笛卡尔坐标到平面极坐标变换的雅可比行列式中的径向因子 $\\rho$ 完全消除了。只要 $\\psi$ 是光滑的，得到的被积函数就是正则的。这解释了为什么这种奇异性被称为“弱奇异”，以及为什么一个能分解出径向距离的变量替换能够使积分正则化。\n\n第二部分：用于参考三角形的Duffy变换\n\n参考三角形由 $T_{\\mathrm{ref}} = \\{ (x,y) \\in \\mathbb{R}^{2} : x \\ge 0,\\; y \\ge 0,\\; x + y \\le 1 \\}$ 给出。其顶点为 $(0,0)$、$(1,0)$ 和 $(0,1)$。奇异点位于顶点 $(0,0)$。\n\n虽然极坐标变换可以消除奇异性，但它将三角形域映射到 $(\\rho, \\phi)$ 中的一个非矩形域，这对于数值积分来说不方便。Duffy 变换将一个张量积域（一个正方形）映射到三角形，同时在其雅可比行列式中包含了消除奇异性的径向因子。对于奇异点在直角顶点的直角三角形，一个将单位正方形映射到整个三角形的单一变换就足够了；不需要对三角形进行分解。\n\n我们提出以下从单位正方形 $(u,v) \\in [0,1] \\times [0,1]$ 到参考三角形 $(x,y) \\in T_{\\mathrm{ref}}$ 的映射：\n$$\nx = u(1-v)\n$$\n$$\ny = uv\n$$\n这个变换将单位正方形的边界映射如下：\n-   $u=0 \\implies (x,y) = (0,0)$。奇异顶点。\n-   $u=1 \\implies x=1-v, y=v$。这参数化了斜边 $x+y = (1-v) + v = 1$，从 $(1,0)$ (当 $v=0$) 到 $(0,1)$ (当 $v=1$)。\n-   $v=0 \\implies x=u, y=0$。这参数化了底边，从 $(0,0)$ 到 $(1,0)$。\n-   $v=1 \\implies x=0, y=u$。这参数化了垂直边，从 $(0,0)$ 到 $(0,1)$。\n因此，该映射是从正方形 $[0,1]^2$ 到三角形 $T_{\\mathrm{ref}}$ 的一个双射。$(x,y)$ 平面中的奇异点 $(0,0)$ 对应于 $(u,v)$ 平面中的整条边 $u=0$。\n\n该变换的雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial u} & \\frac{\\partial x}{\\partial v} \\\\ \\frac{\\partial y}{\\partial u} & \\frac{\\partial y}{\\partial v} \\end{pmatrix} = \\begin{pmatrix} 1-v & -u \\\\ v & u \\end{pmatrix}\n$$\n雅可比行列式为：\n$$\n\\det(\\mathbf{J}) = u(1-v) - (-u)v = u - uv + uv = u\n$$\n面积元变换为 $\\mathrm{d}x\\,\\mathrm{d}y = |\\det(\\mathbf{J})|\\,\\mathrm{d}u\\,\\mathrm{d}v = u\\,\\mathrm{d}u\\,\\mathrm{d}v$。因子 $u$ 起到了径向变量的作用，消除了在 $u \\to 0$ 时发生的奇异性。\n\n第三部分：典范积分的计算\n\n我们现在使用所提出的变换来计算积分 $I_{\\mathrm{ref}} = \\int_{T_{\\mathrm{ref}}} \\frac{1}{\\sqrt{x^{2}+y^{2}}}\\,\\mathrm{d}x\\,\\mathrm{d}y$。\n首先，我们将距离项 $\\sqrt{x^2+y^2}$ 用新坐标 $(u,v)$ 表示：\n$$\n\\sqrt{x^2+y^2} = \\sqrt{(u(1-v))^2 + (uv)^2} = \\sqrt{u^2((1-v)^2+v^2)} = u \\sqrt{1-2v+v^2+v^2} = u \\sqrt{1-2v+2v^2}\n$$\n积分变换为：\n$$\nI_{\\mathrm{ref}} = \\int_0^1 \\int_0^1 \\frac{1}{u \\sqrt{1-2v+2v^2}} (u\\,\\mathrm{d}u\\,\\mathrm{d}v)\n$$\n来自雅可比行列式的因子 $u$ 消除了来自距离项的因子 $u$，从而使积分正则化：\n$$\nI_{\\mathrm{ref}} = \\int_0^1 \\int_0^1 \\frac{1}{\\sqrt{1-2v+2v^2}}\\,\\mathrm{d}u\\,\\mathrm{d}v\n$$\n被积函数与 $u$ 无关，因此关于 $u$ 的积分是平凡的：\n$$\nI_{\\mathrm{ref}} = \\left(\\int_0^1 \\mathrm{d}u\\right) \\left(\\int_0^1 \\frac{1}{\\sqrt{1-2v+2v^2}}\\,\\mathrm{d}v\\right) = 1 \\cdot \\int_0^1 \\frac{1}{\\sqrt{2v^2-2v+1}}\\,\\mathrm{d}v\n$$\n为了计算剩下的积分，我们对分母进行配方：\n$$\n2v^2-2v+1 = 2(v^2-v) + 1 = 2\\left(\\left(v-\\frac{1}{2}\\right)^2 - \\frac{1}{4}\\right) + 1 = 2\\left(v-\\frac{1}{2}\\right)^2 - \\frac{1}{2} + 1 = 2\\left(v-\\frac{1}{2}\\right)^2 + \\frac{1}{2} = \\frac{1}{2}\\left(4\\left(v-\\frac{1}{2}\\right)^2 + 1\\right) = \\frac{1}{2}\\left((2v-1)^2 + 1\\right)\n$$\n积分变为：\n$$\nI_{\\mathrm{ref}} = \\int_0^1 \\frac{1}{\\sqrt{\\frac{1}{2}((2v-1)^2+1)}}\\,\\mathrm{d}v = \\int_0^1 \\frac{\\sqrt{2}}{\\sqrt{(2v-1)^2+1}}\\,\\mathrm{d}v\n$$\n令 $w = 2v-1$。则 $\\mathrm{d}w = 2\\,\\mathrm{d}v$，所以 $\\mathrm{d}v = \\frac{1}{2}\\mathrm{d}w$。积分限从 $v=0 \\to w=-1$ 和 $v=1 \\to w=1$ 改变。\n$$\nI_{\\mathrm{ref}} = \\int_{-1}^1 \\frac{\\sqrt{2}}{\\sqrt{w^2+1}} \\frac{\\mathrm{d}w}{2} = \\frac{\\sqrt{2}}{2} \\int_{-1}^1 \\frac{1}{\\sqrt{w^2+1}}\\,\\mathrm{d}w\n$$\n$1/\\sqrt{w^2+1}$ 的原函数是 $\\arsinh(w)$。\n$$\nI_{\\mathrm{ref}} = \\frac{\\sqrt{2}}{2} \\left[\\arsinh(w)\\right]_{-1}^1 = \\frac{\\sqrt{2}}{2} (\\arsinh(1) - \\arsinh(-1))\n$$\n由于 $\\arsinh(w)$ 是一个奇函数，$\\arsinh(-1) = -\\arsinh(1)$。\n$$\nI_{\\mathrm{ref}} = \\frac{\\sqrt{2}}{2} (\\arsinh(1) - (-\\arsinh(1))) = \\frac{\\sqrt{2}}{2} (2\\arsinh(1)) = \\sqrt{2}\\arsinh(1)\n$$\n将反双曲正弦函数用其对数形式表示，$\\arsinh(z) = \\ln(z+\\sqrt{z^2+1})$：\n$$\nI_{\\mathrm{ref}} = \\sqrt{2}\\ln(1+\\sqrt{1^2+1}) = \\sqrt{2}\\ln(1+\\sqrt{2})\n$$\n这就是该积分的精确闭式值。", "answer": "$$\n\\boxed{\\sqrt{2}\\ln(1+\\sqrt{2})}\n$$", "id": "3604636"}, {"introduction": "在计算地球物理学中，物理近似（例如在低频时忽略空气中的位移电流）是简化模型的常用手段，但这可能会对数值系统的稳定性产生深远影响。本练习将通过一个简化的分层地球模型，让您亲手构建并分析不同积分方程公式下的系统矩阵。您将直面因物理近似而导致的矩阵病态和数值零空间问题，并探索如何通过改进公式来诊断和解决这一实际工程挑战 [@problem_id:3604626]。", "problem": "考虑一个水平分层地球的频域电磁散射问题，该地球由导电地面上覆高阻空气层构成。从频域中的麦克斯韦方程组（$\\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H}$ 和 $\\nabla \\times \\mathbf{H} = \\mathbf{J} + i \\omega \\epsilon \\mathbf{E}$）以及本构关系（$\\mathbf{J} = \\sigma \\mathbf{E}$、$\\mathbf{D} = \\epsilon \\mathbf{E}$ 和 $\\mathbf{B} = \\mu \\mathbf{H}$）出发，非均匀体中感应的积分方程（IE）可以用材料属性差异和格林函数来表示。在计算地球物理学中，一种常见的数值实践是在低频时忽略空气中的位移电流，近似认为 $\\sigma_{\\text{air}} \\gg \\omega \\epsilon_{\\text{air}} \\rightarrow 0$，从而消除空气的电容效应。然而，这种忽略会恶化矩阵的条件数并引入零空间分量，特别是与那些不受静磁感应约束的纵向（无旋）电场模式相关的分量。\n\n您必须实现、分析和比较一个简化的双区域积分方程公式。该公式通过一个由物理驱动的核函数构建的块算子模型，明确地揭示了这些条件数效应。该模型对两个区域使用一维垂直离散化，并将空气场未知数进行亥姆霍兹型（Helmholtz-type）分裂，分解为螺线管（横向）和纵向（无旋）分量。\n\n使用以下基本依据和定义：\n\n- 频域参数为：角频率 $\\omega = 2 \\pi f$、磁导率 $\\mu_0 = 4 \\pi \\times 10^{-7} \\ \\text{H/m}$、自由空间介电常数 $\\epsilon_0 = 8.854187817 \\times 10^{-12} \\ \\text{F/m}$、地面电导率 $\\sigma_{\\text{ground}}$（单位：S/m）以及空气电导率 $\\sigma_{\\text{air}}$（单位：S/m）。\n- 地面中的趋肤深度为 $L = \\sqrt{\\dfrac{2}{\\omega \\mu_0 \\sigma_{\\text{ground}}}}$（单位：m）。\n- 将垂直坐标 $z$ 离散化，地面厚度 $h_{\\text{ground}}$ 内设置 $N_{\\text{g}}$ 个单元，空气厚度 $h_{\\text{air}}$ 内设置 $N_{\\text{a}}$ 个单元。将空气单元划分为两个不相交的子空间：$N_{\\text{T}}$ 个螺线管（横向）单元和 $N_{\\text{L}}$ 个纵向（无旋）单元，其中 $N_{\\text{a}} = N_{\\text{T}} + N_{\\text{L}}$。\n- 定义一个标量核函数 $g(d)$，用以近似感应格林函数在垂直距离 $d \\ge 0$ 上的衰减：\n$$\ng(d) = \\frac{\\exp\\left(- d / L\\right)}{4 \\pi \\left(d + a\\right)},\n$$\n其中 $a > 0$ 是一个小的正则化长度（单位：m），用于避免奇异的自耦合。该核函数用于根据观测点-源点垂直距离构建块子矩阵。\n\n构建三个算子：\n\n1. 在空气中忽略位移电流的单区域积分方程：\n   - 组合一个块算子 $\\mathbf{A}_{\\text{single}}$，作用于按 $[\\text{ground}, \\text{air-}T, \\text{air-}L]$ 顺序排列的级联未知向量上，其大小分别为 $N_{\\text{g}}$、$N_{\\text{T}}$ 和 $N_{\\text{L}}$。\n   - 对于每个块中的观测位置 $z_i$ 和源位置 $z_j$，使用 $g(|z_i - z_j|)$ 形成核子矩阵 $\\mathbf{K}_{\\text{gg}}$、$\\mathbf{K}_{\\text{gT}}$、$\\mathbf{K}_{\\text{Tg}}$、$\\mathbf{K}_{\\text{TT}}$。\n   - 使用与静磁感应一致的第二类结构，设置：\n     $$\n     \\mathbf{A}_{\\text{gg}} = \\mathbf{I}_{N_{\\text{g}}} - i \\omega \\mu_0 \\sigma_{\\text{ground}} \\, \\mathbf{K}_{\\text{gg}},\n     \\quad\n     \\mathbf{A}_{\\text{gT}} = - i \\omega \\mu_0 \\sigma_{\\text{ground}} \\, \\mathbf{K}_{\\text{gT}},\n     $$\n     $$\n     \\mathbf{A}_{\\text{Tg}} = - i \\omega \\mu_0 \\sigma_{\\text{air}} \\, \\mathbf{K}_{\\text{Tg}},\n     \\quad\n     \\mathbf{A}_{\\text{TT}} = \\mathbf{I}_{N_{\\text{T}}} - i \\omega \\mu_0 \\sigma_{\\text{air}} \\, \\mathbf{K}_{\\text{TT}}.\n     $$\n   - 为了反映位移电流被忽略以及静磁感应仅约束螺线管场这一事实，将纵向行块设置为零：\n     $$\n     \\mathbf{A}_{\\text{Lg}} = \\mathbf{0}_{N_{\\text{L}} \\times N_{\\text{g}}}, \\quad \\mathbf{A}_{\\text{LT}} = \\mathbf{0}_{N_{\\text{L}} \\times N_{\\text{T}}}, \\quad \\mathbf{A}_{\\text{LL}} = \\mathbf{0}_{N_{\\text{L}} \\times N_{\\text{L}}}.\n     $$\n   - 按照观测顺序 $[\\text{g}, \\text{T}, \\text{L}]$，通过这些块组合 $\\mathbf{A}_{\\text{single}}$。\n\n2. 双区域公式（仅含地面未知数）：\n   - 完全消除空气未知数，并计算简化算子\n     $$\n     \\mathbf{A}_{\\text{two}} = \\mathbf{I}_{N_{\\text{g}}} - i \\omega \\mu_0 \\sigma_{\\text{ground}} \\, \\mathbf{K}_{\\text{gg}}.\n     $$\n   - 这代表了计算地球物理学中使用的一种实用公式，通过在忽略位移电流时避免无约束的空气场模式来改善条件数。\n\n3. 在空气-纵向子空间中带位移电流稳定化的单区域积分方程：\n   - 使用 $\\epsilon_{\\text{air}}$ 在纵向块上增加电容稳定项：\n     $$\n     \\mathbf{A}_{\\text{LL}} = i \\omega \\epsilon_{\\text{air}} \\, \\mathbf{I}_{N_{\\text{L}}}.\n     $$\n   - 保留 $\\mathbf{A}_{\\text{single}}$ 中的其他块，得到 $\\mathbf{A}_{\\text{disp}}$。\n\n数值分析任务：\n\n- 对于每个算子 $\\mathbf{A}$，计算奇异值分解（SVD）的奇异值，并将条件数定义为\n$$\n\\kappa(\\mathbf{A}) = \\frac{s_{\\max}}{\\max(s_{\\min}, \\tau s_{\\max})},\n$$\n其中 $s_{\\max}$ 和 $s_{\\min}$ 分别是最大和最小奇异值，$\\tau$ 是一个无量纲容差。将数值零空间维度定义为满足 $s \\le \\tau s_{\\max}$ 的奇异值 $s$ 的数量。\n- 使用 $\\tau = 10^{-10}$。\n- 将条件数报告为无量纲浮点数，零空间维度报告为整数。将所有报告的浮点数四舍五入到三位有效数字。\n- 距离 $d$ 必须以米为单位计算，所有材料参数必须采用国际单位制（SI）：$f$ 的单位为赫兹（Hz），$\\sigma$ 的单位为西门子/米（S/m），$\\mu_0$ 的单位为亨利/米（H/m），$\\epsilon_{\\text{air}}$ 的单位为法拉/米（F/m），几何量以米为单位。\n\n离散化细节：\n\n- 地面单元中心：$z^{\\text{g}}_k = - h_{\\text{ground}} + \\left(k + \\tfrac{1}{2}\\right)\\frac{h_{\\text{ground}}}{N_{\\text{g}}}$，其中 $k = 0, 1, \\dots, N_{\\text{g}} - 1$。\n- 空气螺线管单元中心：$z^{\\text{T}}_m = \\left(m + \\tfrac{1}{2}\\right)\\frac{h_{\\text{air}}}{N_{\\text{T}}}$，其中 $m = 0, 1, \\dots, N_{\\text{T}} - 1$。\n- 空气纵向单元中心：$z^{\\text{L}}_n = \\left(n + \\tfrac{1}{2}\\right)\\frac{h_{\\text{air}}}{N_{\\text{L}}}$，其中 $n = 0, 1, \\dots, N_{\\text{L}} - 1$。\n- 对核正则化长度使用 $a = 1.0 \\ \\text{m}$。\n\n测试套件：\n\n提供三个测试用例，参数元组为 $(f, \\sigma_{\\text{ground}}, \\sigma_{\\text{air}}, \\epsilon_{\\text{air}}, N_{\\text{g}}, N_{\\text{T}}, N_{\\text{L}}, h_{\\text{ground}}, h_{\\text{air}})$：\n\n1. 用例 A（理想情况，高阻空气）：$(1.0 \\ \\text{Hz}, 0.1 \\ \\text{S/m}, 10^{-8} \\ \\text{S/m}, \\epsilon_0, 8, 6, 6, 1000 \\ \\text{m}, 1000 \\ \\text{m})$。\n2. 用例 B（边缘情况，极高阻空气和更低频率）：$(0.1 \\ \\text{Hz}, 0.1 \\ \\text{S/m}, 0.0 \\ \\text{S/m}, \\epsilon_0, 8, 6, 8, 1000 \\ \\text{m}, 1500 \\ \\text{m})$。\n3. 用例 C（更高频率，更强的电容稳定化）：$(10.0 \\ \\text{Hz}, 0.1 \\ \\text{S/m}, 10^{-9} \\ \\text{S/m}, \\epsilon_0, 10, 5, 5, 800 \\ \\text{m}, 800 \\ \\text{m})$。\n\n程序输出规范：\n\n- 对于每个测试用例，计算并返回列表 $[\\kappa(\\mathbf{A}_{\\text{single}}), \\text{null}_{\\text{single}}, \\kappa(\\mathbf{A}_{\\text{two}}), \\kappa(\\mathbf{A}_{\\text{disp}}), \\text{null}_{\\text{disp}}]$，其中 $\\text{null}_{\\text{single}}$ 和 $\\text{null}_{\\text{disp}}$ 是上面定义的数值零空间维度。\n- 你的程序应生成单行输出，其中包含一个逗号分隔的列表，该列表由每个用例的结果列表组成，并用方括号括起来（例如，`[[x_1,x_2,x_3,x_4,x_5],[y_1,y_2,y_3,y_4,y_5],[z_1,z_2,z_3,z_4,z_5]]`）。所有浮点数必须四舍五入到三位有效数字，整数必须是精确的。", "solution": "目标是分析分层地球模型中一维电磁感应问题的三种不同积分方程（IE）算子的条件数。该分析侧重于因忽略空气中位移电流而产生的数值问题，特别是零空间的出现。这三个算子是：$\\mathbf{A}_{\\text{single}}$，一个忽略了位移电流的单区域公式；$\\mathbf{A}_{\\text{two}}$，一个只考虑地面未知数的简化双区域公式；以及 $\\mathbf{A}_{\\text{disp}}$，一个重新引入电容项的稳定化单区域公式。\n\n分析的执行方式是：基于一个简化的核函数将这些算子构建为复值矩阵，然后通过奇异值分解（SVD）计算它们的条件数和数值零空间维度。\n\n基本物理参数是频率 $f$、地面电导率 $\\sigma_{\\text{ground}}$、空气电导率 $\\sigma_{\\text{air}}$ 和空气介电常数 $\\epsilon_{\\text{air}}$。关键常数是自由空间磁导率 $\\mu_0 = 4 \\pi \\times 10^{-7} \\ \\text{H/m}$ 和自由空间介电常数 $\\epsilon_0 = 8.854187817 \\times 10^{-12} \\ \\text{F/m}$。\n\n该方法包括以下步骤：\n\n1.  **参数计算与离散化**：\n    对于每个测试用例，计算角频率 $\\omega = 2 \\pi f$ 和地面中的趋肤深度 $L = \\sqrt{2 / (\\omega \\mu_0 \\sigma_{\\text{ground}})}$。垂直域被离散化为三组单元中心：\n    -   地面单元（在厚度 $h_{\\text{ground}}$ 内有 $N_{\\text{g}}$ 个单元）：\n        $$z^{\\text{g}}_k = - h_{\\text{ground}} + \\left(k + \\tfrac{1}{2}\\right)\\frac{h_{\\text{ground}}}{N_{\\text{g}}}, \\quad k = 0, \\dots, N_{\\text{g}} - 1$$\n    -   空气螺线管单元（在厚度 $h_{\\text{air}}$ 内有 $N_{\\text{T}}$ 个单元）：\n        $$z^{\\text{T}}_m = \\left(m + \\tfrac{1}{2}\\right)\\frac{h_{\\text{air}}}{N_{\\text{T}}}, \\quad m = 0, \\dots, N_{\\text{T}} - 1$$\n    -   空气纵向单元（在厚度 $h_{\\text{air}}$ 内有 $N_{\\text{L}}$ 个单元）：\n        $$z^{\\text{L}}_n = \\left(n + \\tfrac{1}{2}\\right)\\frac{h_{\\text{air}}}{N_{\\text{L}}}, \\quad n = 0, \\dots, N_{\\text{L}} - 1$$\n    将空气场未知数进行亥姆霍兹型（Helmholtz-type）分裂，分解为螺线管（横向）和纵向（无旋）分量，这是对空气区域上基函数的分解，而不是对该区域本身的物理划分。\n\n2.  **核矩阵构建**：\n    一个简化的格林函数核 $g(d)$ 模拟了感应耦合在距离 $d$ 上的衰减。正则化长度为 $a = 1.0 \\ \\text{m}$，其定义如下：\n    $$g(d) = \\frac{\\exp\\left(- d / L\\right)}{4 \\pi \\left(d + a\\right)}$$\n    该核函数用于填充子矩阵 $\\mathbf{K}_{xy}$，其中 $(\\mathbf{K}_{xy})_{ij} = g(|z^x_i - z^y_j|)$，且 $x, y \\in \\{\\text{g}, \\text{T}\\}$。具体来说，我们构建 $\\mathbf{K}_{\\text{gg}}$、$\\mathbf{K}_{\\text{gT}}$、$\\mathbf{K}_{\\text{Tg}}$ 和 $\\mathbf{K}_{\\text{TT}}$。\n\n3.  **算子组合**：\n    这三个算子被组合为块矩阵。设 $i = \\sqrt{-1}$。\n    -   **$\\mathbf{A}_{\\text{single}}$**：该算子模拟了忽略位移电流的系统。纵向分量不受静磁感应的约束，导致出现零块。\n        $$\n        \\mathbf{A}_{\\text{single}} =\n        \\begin{pmatrix}\n        \\mathbf{I} - i\\omega\\mu_0\\sigma_{\\text{g}}\\mathbf{K}_{\\text{gg}} & - i\\omega\\mu_0\\sigma_{\\text{g}}\\mathbf{K}_{\\text{gT}} & \\mathbf{0} \\\\\n        - i\\omega\\mu_0\\sigma_{\\text{a}}\\mathbf{K}_{\\text{Tg}} & \\mathbf{I} - i\\omega\\mu_0\\sigma_{\\text{a}}\\mathbf{K}_{\\text{TT}} & \\mathbf{0} \\\\\n        \\mathbf{0} & \\mathbf{0} & \\mathbf{0}_{N_{\\text{L}} \\times N_{\\text{L}}}\n        \\end{pmatrix}\n        $$\n        对角线上的 $N_{\\text{L}} \\times N_{\\text{L}}$ 零块明确地创建了一个维度至少为 $N_{\\text{L}}$ 的零空间。\n\n    -   **$\\mathbf{A}_{\\text{two}}$**：该算子代表一种实用的公式，通过仅求解导电地面中的未知数来避免零空间问题。它就是 $\\mathbf{A}_{\\text{single}}$ 的左上角块。\n        $$ \\mathbf{A}_{\\text{two}} = \\mathbf{I}_{N_{\\text{g}}} - i \\omega \\mu_0 \\sigma_{\\text{ground}} \\, \\mathbf{K}_{\\text{gg}} $$\n\n    -   **$\\mathbf{A}_{\\text{disp}}$**：该算子通过为空气纵向子空间添加一个电容项来稳定单区域公式，这在物理上对应于重新引入位移电流效应以约束无旋模式。\n        $$\n        \\mathbf{A}_{\\text{disp}} =\n        \\begin{pmatrix}\n        \\mathbf{I} - i\\omega\\mu_0\\sigma_{\\text{g}}\\mathbf{K}_{\\text{gg}} & - i\\omega\\mu_0\\sigma_{\\text{g}}\\mathbf{K}_{\\text{gT}} & \\mathbf{0} \\\\\n        - i\\omega\\mu_0\\sigma_{\\text{a}}\\mathbf{K}_{\\text{Tg}} & \\mathbf{I} - i\\omega\\mu_0\\sigma_{\\text{a}}\\mathbf{K}_{\\text{TT}} & \\mathbf{0} \\\\\n        \\mathbf{0} & \\mathbf{0} & i \\omega \\epsilon_{\\text{air}} \\, \\mathbf{I}_{N_{\\text{L}}}\n        \\end{pmatrix}\n        $$\n    非零的右下块 $i \\omega \\epsilon_{\\text{air}} \\, \\mathbf{I}_{N_{\\text{L}}}$ 消除了 $\\mathbf{A}_{\\text{single}}$ 中存在的零空间。\n\n4.  **数值分析与报告**：\n    对于每个算子矩阵 $\\mathbf{A}$，计算其奇异值 $s$。使用容差 $\\tau = 10^{-10}$ 计算条件数 $\\kappa(\\mathbf{A})$ 和数值零空间维度 $\\text{null}(\\mathbf{A})$：\n    $$ \\kappa(\\mathbf{A}) = \\frac{s_{\\max}}{\\max(s_{\\min}, \\tau s_{\\max})} $$\n    $$ \\text{null}(\\mathbf{A}) = \\text{满足 } s \\le \\tau s_{\\max} \\text{ 的奇异值 } s \\text{ 的数量} $$\n    计算每个测试用例的结果—$[\\kappa(\\mathbf{A}_{\\text{single}}), \\text{null}_{\\text{single}}, \\kappa(\\mathbf{A}_{\\text{two}}), \\kappa(\\mathbf{A}_{\\text{disp}}), \\text{null}_{\\text{disp}}]$—浮点数格式化为三位有效数字。\n\n该实现根据这些原则为提供的测试套件自动化了此过程，构建并分析了每个矩阵。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the analysis of three integral equation operators for a 1D\n    electromagnetic induction problem as specified.\n    \"\"\"\n    # Define constants and test cases as per the problem statement\n    MU0 = 4 * np.pi * 1e-7\n    EPSILON0 = 8.854187817e-12\n    TAU = 1e-10\n    A_REG = 1.0\n\n    test_cases = [\n        # (f, sigma_ground, sigma_air, epsilon_air, Ng, NT, NL, h_ground, h_air)\n        (1.0, 0.1, 1e-8, EPSILON0, 8, 6, 6, 1000.0, 1000.0),\n        (0.1, 0.1, 0.0, EPSILON0, 8, 6, 8, 1000.0, 1500.0),\n        (10.0, 0.1, 1e-9, EPSILON0, 10, 5, 5, 800.0, 800.0),\n    ]\n\n    all_results_lists = []\n\n    for case in test_cases:\n        f, sigma_ground, sigma_air, epsilon_air, N_g, N_T, N_L, h_ground, h_air = case\n\n        # Calculate derived parameters\n        omega = 2 * np.pi * f\n        if omega == 0 or sigma_ground == 0:\n            L_skin = np.inf\n        else:\n            L_skin = np.sqrt(2 / (omega * MU0 * sigma_ground))\n\n        # Discretization: Generate cell centers\n        z_g = -h_ground + (np.arange(N_g) + 0.5) * (h_ground / N_g)\n        z_T = (np.arange(N_T) + 0.5) * (h_air / N_T)\n        z_L = (np.arange(N_L) + 0.5) * (h_air / N_L)\n        \n        # Kernel function and matrix builder\n        def g_kernel(d, L, a):\n            if np.isinf(L):\n                exp_term = 1.0\n            else:\n                exp_term = np.exp(-d / L)\n            return exp_term / (4 * np.pi * (d + a))\n\n        def build_K(z_obs, z_src, L, a):\n            d = np.abs(z_obs[:, np.newaxis] - z_src)\n            return g_kernel(d, L, a)\n\n        # Build Kernel submatrices\n        K_gg = build_K(z_g, z_g, L_skin, A_REG)\n        K_gT = build_K(z_g, z_T, L_skin, A_REG)\n        K_Tg = build_K(z_T, z_g, L_skin, A_REG)\n        K_TT = build_K(z_T, z_T, L_skin, A_REG)\n\n        # Define complex coefficients\n        j = 1j\n        C1 = -j * omega * MU0 * sigma_ground\n        C2 = -j * omega * MU0 * sigma_air\n\n        # Assemble operator blocks\n        A_gg = np.eye(N_g) + C1 * K_gg\n        A_gT = C1 * K_gT\n        A_Tg = C2 * K_Tg\n        A_TT = np.eye(N_T) + C2 * K_TT\n\n        # --- Operator A_single ---\n        N_total = N_g + N_T + N_L\n        A_single = np.zeros((N_total, N_total), dtype=complex)\n        A_single[0:N_g, 0:N_g] = A_gg\n        A_single[0:N_g, N_g:N_g+N_T] = A_gT\n        A_single[N_g:N_g+N_T, 0:N_g] = A_Tg\n        A_single[N_g:N_g+N_T, N_g:N_g+N_T] = A_TT\n\n        # --- Operator A_two ---\n        A_two = A_gg\n\n        # --- Operator A_disp ---\n        A_disp = A_single.copy()\n        C3 = j * omega * epsilon_air\n        A_disp[N_g+N_T:, N_g+N_T:] = C3 * np.eye(N_L)\n\n        # Analysis function\n        def analyze_matrix(A_mat, tau_val):\n            if A_mat.size == 0:\n                return 1.0, 0\n            \n            s = np.linalg.svd(A_mat, compute_uv=False)\n            s_max = s[0] if len(s) > 0 else 0.0\n\n            # Use a machine epsilon-like threshold for a zero matrix.\n            # 1e-15 is a practical choice.\n            if s_max < 1e-15:\n                return 1.0, A_mat.shape[0]\n\n            s_min = s[-1]\n            kappa = s_max / max(s_min, tau_val * s_max)\n            null_dim = np.sum(s <= tau_val * s_max)\n            return kappa, int(null_dim)\n\n        # Perform analysis on all three operators\n        kappa_single, null_single = analyze_matrix(A_single, TAU)\n        kappa_two, null_two = analyze_matrix(A_two, TAU) # null_two is not required in output\n        kappa_disp, null_disp = analyze_matrix(A_disp, TAU)\n        \n        # Helper to format floats to 3 significant figures\n        def format_sig_figs(val):\n            return float(f\"{val:.3g}\")\n        \n        # Assemble and format the results for the current case\n        case_results = [\n            format_sig_figs(kappa_single),\n            null_single,\n            format_sig_figs(kappa_two),\n            format_sig_figs(kappa_disp),\n            null_disp\n        ]\n        all_results_lists.append(case_results)\n\n    # Convert the list of lists into the required final string format\n    results_as_strings = [str(res).replace(\" \", \"\") for res in all_results_lists]\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```", "id": "3604626"}, {"introduction": "对于大规模电磁建模问题，积分方程方法所产生的密集矩阵会导致 $O(N^2)$ 的计算复杂度，这在计算上是难以承受的。本练习介绍了一种类Ewald分解技术，它是现代快速算法（如快速多极子方法）的基本思想之一，旨在将相互作用分解为快速衰减的短程部分和光滑的长程部分以加速计算。通过实现这种分解并推导其截断误差界，您将深入理解加速算法在速度和精度之间权衡的核心原理 [@problem_id:3604682]。", "problem": "考虑适用于水平分层半空间中电磁建模准静态极限的标量格林函数，该函数用于构建积分方程 (IE) 系统的条目。在位于 $z=0$ 平面界面上方的均匀层中，一个简化且科学合理的层状格林函数通过带有恒定反射系数的镜像近似进行建模。对于位置为 $\\mathbf{r}' = (x',y',z')$ 的源和位置为 $\\mathbf{r} = (x,y,z)$ 的接收器，定义欧几里得距离 $R = \\|\\mathbf{r} - \\mathbf{r}'\\|$ 和通过将源点关于平面 $z=0$ 反射得到的镜像源距离 $R_{\\mathrm{im}} = \\|(x-x'),(y-y'),(z+z')\\|$。标量层状格林函数为\n$$\nG(\\mathbf{r},\\mathbf{r}') = \\frac{1}{4\\pi}\\left(\\frac{1}{R} + \\alpha \\frac{1}{R_{\\mathrm{im}}}\\right),\n$$\n其中 $\\alpha \\in (-1,1)$ 是一个物理上合理的恒定反射系数，代表界面两侧的介质差异。\n\n为了加速积分方程的构建，我们引入一个带有分裂参数 $\\eta > 0$ 的类 Ewald 实空间屏蔽，方法是定义短程和长程部分\n$$\nG_{\\mathrm{SR}}(\\mathbf{r},\\mathbf{r}';\\eta) = \\frac{1}{4\\pi}\\left(\\frac{\\operatorname{erfc}(\\eta R)}{R} + \\alpha \\frac{\\operatorname{erfc}(\\eta R_{\\mathrm{im}})}{R_{\\mathrm{im}}}\\right),\n\\quad\nG_{\\mathrm{LR}}(\\mathbf{r},\\mathbf{r}';\\eta) = \\frac{1}{4\\pi}\\left(\\frac{\\operatorname{erf}(\\eta R)}{R} + \\alpha \\frac{\\operatorname{erf}(\\eta R_{\\mathrm{im}})}{R_{\\mathrm{im}}}\\right),\n$$\n使得对于任何 $\\eta > 0$，$G(\\mathbf{r},\\mathbf{r}') = G_{\\mathrm{SR}}(\\mathbf{r},\\mathbf{r}';\\eta) + G_{\\mathrm{LR}}(\\mathbf{r},\\mathbf{r}';\\eta)$ 恒成立。此处，$\\operatorname{erf}(\\cdot)$ 和 $\\operatorname{erfc}(\\cdot)$ 分别表示误差函数和互补误差函数。\n\n假设给定位于 $\\{\\mathbf{r}'_{j}\\}_{j=1}^{N_{\\mathrm{s}}}$ 的 $N_{\\mathrm{s}}$ 个源和位于 $\\{\\mathbf{r}_{i}\\}_{i=1}^{N_{\\mathrm{t}}}$ 的 $N_{\\mathrm{t}}$ 个接收器。考虑总相互作用和的积分方程构建\n$$\nS_{\\mathrm{full}} = \\sum_{i=1}^{N_{\\mathrm{t}}}\\sum_{j=1}^{N_{\\mathrm{s}}} G(\\mathbf{r}_{i},\\mathbf{r}'_{j}),\n$$\n及其类 Ewald 分解 $S_{\\mathrm{full}} = S_{\\mathrm{SR}}(\\eta) + S_{\\mathrm{LR}}(\\eta)$（定义见上文）。为了加速计算，通过仅包含相应距离小于或等于截断半径 $r_{\\mathrm{cut}} > 0$ 的源-接收器对来截断短程和。具体来说，定义截断的短程相互作用\n$$\nS_{\\mathrm{SR}}^{\\mathrm{trunc}}(\\eta,r_{\\mathrm{cut}}) = \\frac{1}{4\\pi}\\sum_{i=1}^{N_{\\mathrm{t}}}\\sum_{j=1}^{N_{\\mathrm{s}}}\\left[\\frac{\\operatorname{erfc}(\\eta R_{ij})}{R_{ij}}\\mathbb{I}\\{R_{ij}\\le r_{\\mathrm{cut}}\\} + \\alpha \\frac{\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}\\le r_{\\mathrm{cut}}\\}\\right],\n$$\n其中 $R_{ij} = \\|\\mathbf{r}_{i}-\\mathbf{r}'_{j}\\|$，$R^{\\mathrm{im}}_{ij} = \\|(x_{i}-x'_{j}),(y_{i}-y'_{j}),(z_{i}+z'_{j})\\|$，且 $\\mathbb{I}\\{\\cdot\\}$ 是指示函数。通过保留全部长程和与截断的短程和，形成实用的加速近似：\n$$\nS_{\\mathrm{approx}}(\\eta,r_{\\mathrm{cut}}) = S_{\\mathrm{SR}}^{\\mathrm{trunc}}(\\eta,r_{\\mathrm{cut}}) + S_{\\mathrm{LR}}(\\eta).\n$$\n由短程截断引起的截断误差为\n$$\nE_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}}) = \\left|S_{\\mathrm{full}} - S_{\\mathrm{approx}}(\\eta,r_{\\mathrm{cut}})\\right|.\n$$\n利用互补误差函数的单调性，推导并实现一个关于截断误差的可计算的、严格的上限。证明\n$$\nE_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}}) \\le E_{\\mathrm{bound}}(\\eta,r_{\\mathrm{cut}}) \\equiv \\frac{\\operatorname{erfc}(\\eta r_{\\mathrm{cut}})}{4\\pi}\\left(\\sum_{i=1}^{N_{\\mathrm{t}}}\\sum_{j=1}^{N_{\\mathrm{s}}}\\frac{\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\}}{R_{ij}} + |\\alpha|\\sum_{i=1}^{N_{\\mathrm{t}}}\\sum_{j=1}^{N_{\\mathrm{s}}}\\frac{\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\}}{R^{\\mathrm{im}}_{ij}}\\right),\n$$\n该上限独立于任何谱截断，并通过 $\\operatorname{erfc}(\\eta r_{\\mathrm{cut}})$ 明确地量化了对 $\\eta$ 的依赖关系。\n\n您的任务是：\n- 从第一性原理出发，推导为何上述类 Ewald 分解在此积分方程 (IE) 情境下有效，以及为何所提出的边界成立。\n- 实现一个程序，对于一组指定的源、接收器、反射系数 $\\alpha$、分裂参数 $\\eta$ 和短程截断半径 $r_{\\mathrm{cut}}$，计算 $S_{\\mathrm{full}}$、$S_{\\mathrm{approx}}(\\eta,r_{\\mathrm{cut}})$、$E_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}})$ 和 $E_{\\mathrm{bound}}(\\eta,r_{\\mathrm{cut}})$。\n- 对每个测试用例，返回一个列表，其中包含以浮点数表示的 $E_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}})$ 和 $E_{\\mathrm{bound}}(\\eta,r_{\\mathrm{cut}})$，单位为 $\\mathrm{m}^{-1}$。\n\n物理和数值单位：\n- 所有坐标均以米 ($\\mathrm{m}$) 为单位。\n- 层状格林函数 $G(\\mathbf{r},\\mathbf{r}')$ 的单位为 $\\mathrm{m}^{-1}$（与拉普拉斯核的归一化一致），截断误差必须以 $\\mathrm{m}^{-1}$ 表示。\n\n本问题不涉及角度单位。\n\n测试套件：\n- 使用以下四个测试用例，每个用例由 $(\\{\\mathbf{r}'_{j}\\}_{j=1}^{N_{\\mathrm{s}}},\\{\\mathbf{r}_{i}\\}_{i=1}^{N_{\\mathrm{t}}},\\alpha,\\eta,r_{\\mathrm{cut}})$ 指定：\n    1. 理想情况：$N_{\\mathrm{s}}=3$，源点 $\\mathbf{r}'_{1}=(0.0,0.0,0.10)$、$\\mathbf{r}'_{2}=(0.20,0.05,0.15)$、$\\mathbf{r}'_{3}=(-0.10,-0.15,0.20)$；$N_{\\mathrm{t}}=2$，接收点 $\\mathbf{r}_{1}=(0.05,-0.05,0.12)$、$\\mathbf{r}_{2}=(0.30,0.20,0.18)$；$\\alpha=-0.5$，$\\eta=20.0\\,\\mathrm{m}^{-1}$，$r_{\\mathrm{cut}}=0.25\\,\\mathrm{m}$。\n    2. 低屏蔽边界：与前例相同的源和接收器；$\\alpha=-0.5$，$\\eta=2.0\\,\\mathrm{m}^{-1}$，$r_{\\mathrm{cut}}=0.25\\,\\mathrm{m}$。\n    3. 高屏蔽和更紧的截断半径：与前例相同的源和接收器；$\\alpha=-0.5$，$\\eta=60.0\\,\\mathrm{m}^{-1}$，$r_{\\mathrm{cut}}=0.15\\,\\mathrm{m}$。\n    4. 自由空间边缘情况：与前例相同的源和接收器；$\\alpha=0.0$，$\\eta=20.0\\,\\mathrm{m}^{-1}$，$r_{\\mathrm{cut}}=0.25\\,\\mathrm{m}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应测试用例的一个包含两个条目 $[E_{\\mathrm{actual}},E_{\\mathrm{bound}}]$ 的列表，例如 $[[e_{1},b_{1}],[e_{2},b_{2}],\\ldots]$，值为数值。", "solution": "该问题要求为截断的类 Ewald 求和推导一个误差上限，并实现一个程序来计算此上限和给定测试用例的实际误差。该问题在科学上和数学上都是适定的，提供了所有必要的定义和数据。\n\n### 第一部分：从第一性原理推导\n\n#### 类 Ewald 分解的有效性\n\nEwald 分解的基础在于将格林函数核 $G(\\mathbf{r},\\mathbf{r}')$ 分裂为两部分：一个在实空间中快速衰减的短程部分 $G_{\\mathrm{SR}}$，以及一个在实空间中光滑的长程部分 $G_{\\mathrm{LR}}$（因此其傅里叶变换快速衰减，这是在完整的 Ewald 方法中利用的一个性质）。分裂是通过使用互补误差函数 $\\operatorname{erfc}(x)$ 和误差函数 $\\operatorname{erf}(x)$ 实现的，它们通过以下恒等式相关联：\n$$\n\\operatorname{erf}(x) + \\operatorname{erfc}(x) = 1\n$$\n此恒等式对任何实数参数 $x$ 都成立。我们将此应用于格林函数中的基本项 $1/R$，其中 $R = \\|\\mathbf{r} - \\mathbf{r}'\\| > 0$。我们引入一个分裂参数 $\\eta > 0$ 来控制分解的“范围”。\n$$\n\\frac{1}{R} = \\frac{1 \\cdot (\\operatorname{erf}(\\eta R) + \\operatorname{erfc}(\\eta R))}{R} = \\frac{\\operatorname{erf}(\\eta R)}{R} + \\frac{\\operatorname{erfc}(\\eta R)}{R}\n$$\n第一项 $\\frac{\\operatorname{erf}(\\eta R)}{R}$ 构成长程部分。当 $R \\to 0$ 时，$\\operatorname{erf}(\\eta R) \\approx \\frac{2}{\\sqrt{\\pi}}\\eta R$，因此该项趋于一个常数 $\\frac{2\\eta}{\\sqrt{\\pi}}$，使其变得光滑并移除了在 $R=0$ 处的奇点。第二项 $\\frac{\\operatorname{erfc}(\\eta R)}{R}$ 是短程部分。对于大的 $R$，$\\operatorname{erfc}(\\eta R)$ 呈指数衰减，使得该项快速消失，适合在实空间中进行截断。\n\n层状格林函数由下式给出：\n$$\nG(\\mathbf{r},\\mathbf{r}') = \\frac{1}{4\\pi}\\left(\\frac{1}{R} + \\alpha \\frac{1}{R_{\\mathrm{im}}}\\right)\n$$\n将该分解应用于直接项 ($1/R$) 和镜像项 ($1/R_{\\mathrm{im}})$，得到：\n$$\nG(\\mathbf{r},\\mathbf{r}') = \\frac{1}{4\\pi}\\left(\\left[\\frac{\\operatorname{erfc}(\\eta R)}{R} + \\frac{\\operatorname{erf}(\\eta R)}{R}\\right] + \\alpha\\left[\\frac{\\operatorname{erfc}(\\eta R_{\\mathrm{im}})}{R_{\\mathrm{im}}} + \\frac{\\operatorname{erf}(\\eta R_{\\mathrm{im}})}{R_{\\mathrm{im}}}\\right]\\right)\n$$\n通过将 $\\operatorname{erfc}$ 项组合在一起，并将 $\\operatorname{erf}$ 项组合在一起，我们恢复了问题描述中提供的定义：\n$$\nG_{\\mathrm{SR}}(\\mathbf{r},\\mathbf{r}';\\eta) = \\frac{1}{4\\pi}\\left(\\frac{\\operatorname{erfc}(\\eta R)}{R} + \\alpha \\frac{\\operatorname{erfc}(\\eta R_{\\mathrm{im}})}{R_{\\mathrm{im}}}\\right)\n$$\n$$\nG_{\\mathrm{LR}}(\\mathbf{r},\\mathbf{r}';\\eta) = \\frac{1}{4\\pi}\\left(\\frac{\\operatorname{erf}(\\eta R)}{R} + \\alpha \\frac{\\operatorname{erf}(\\eta R_{\\mathrm{im}})}{R_{\\mathrm{im}}}\\right)\n$$\n现在很明显，$G(\\mathbf{r},\\mathbf{r}') = G_{\\mathrm{SR}}(\\mathbf{r},\\mathbf{r}';\\eta) + G_{\\mathrm{LR}}(\\mathbf{r},\\mathbf{r}';\\eta)$ 对于任何 $\\eta > 0$ 都是一个精确的恒等式。这验证了总相互作用和 $S_{\\mathrm{full}} = S_{\\mathrm{SR}}(\\eta) + S_{\\mathrm{LR}}(\\eta)$ 的分解是有效的。\n\n#### 截断误差上限的推导\n\n截断误差 $E_{\\mathrm{actual}}$ 源于用 $S_{\\mathrm{approx}}$ 近似完整和 $S_{\\mathrm{full}}$。我们从误差的定义开始：\n$$\nE_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}}) = \\left|S_{\\mathrm{full}} - S_{\\mathrm{approx}}(\\eta,r_{\\mathrm{cut}})\\right|\n$$\n代入 $S_{\\mathrm{full}} = S_{\\mathrm{SR}}(\\eta) + S_{\\mathrm{LR}}(\\eta)$ 和 $S_{\\mathrm{approx}}(\\eta,r_{\\mathrm{cut}}) = S_{\\mathrm{SR}}^{\\mathrm{trunc}}(\\eta,r_{\\mathrm{cut}}) + S_{\\mathrm{LR}}(\\eta)$ 的定义，我们看到长程和完全抵消了：\n$$\nE_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}}) = \\left| (S_{\\mathrm{SR}}(\\eta) + S_{\\mathrm{LR}}(\\eta)) - (S_{\\mathrm{SR}}^{\\mathrm{trunc}}(\\eta,r_{\\mathrm{cut}}) + S_{\\mathrm{LR}}(\\eta)) \\right| = \\left| S_{\\mathrm{SR}}(\\eta) - S_{\\mathrm{SR}}^{\\mathrm{trunc}}(\\eta,r_{\\mathrm{cut}}) \\right|\n$$\n因此，误差是短程和中被截断舍弃部分的绝对值。让我们明确地表达这个差值。使用指示函数属性 $\\mathbb{I}\\{A>c\\} = 1 - \\mathbb{I}\\{A\\le c\\}$，差值为：\n$$\nS_{\\mathrm{SR}} - S_{\\mathrm{SR}}^{\\mathrm{trunc}} = \\frac{1}{4\\pi}\\sum_{i=1}^{N_{\\mathrm{t}}}\\sum_{j=1}^{N_{\\mathrm{s}}}\\left[\\frac{\\operatorname{erfc}(\\eta R_{ij})}{R_{ij}}\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\} + \\alpha \\frac{\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\}\\right]\n$$\n现在我们通过取绝对值来计算误差 $E_{\\mathrm{actual}}$：\n$$\nE_{\\mathrm{actual}} = \\left| \\frac{1}{4\\pi}\\sum_{i,j}\\left(\\frac{\\operatorname{erfc}(\\eta R_{ij})}{R_{ij}}\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\} + \\alpha \\frac{\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\}\\right) \\right|\n$$\n使用三角不等式 $|\\sum_k z_k| \\le \\sum_k |z_k|$ 和 $|a+b| \\le |a|+|b|$，我们可以界定误差：\n$$\nE_{\\mathrm{actual}} \\le \\frac{1}{4\\pi}\\sum_{i,j} \\left| \\frac{\\operatorname{erfc}(\\eta R_{ij})}{R_{ij}}\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\} + \\alpha \\frac{\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\} \\right|\n$$\n$$\nE_{\\mathrm{actual}} \\le \\frac{1}{4\\pi}\\sum_{i,j} \\left( \\left| \\frac{\\operatorname{erfc}(\\eta R_{ij})}{R_{ij}}\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\} \\right| + \\left| \\alpha \\frac{\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\} \\right| \\right)\n$$\n由于所有距离 $R_{ij}$、$R^{\\mathrm{im}}_{ij}$、参数 $\\eta$ 以及因此 $\\operatorname{erfc}(\\cdot)$ 的参数都是正的，函数 $\\operatorname{erfc}(\\cdot)$ 始终为正。指示函数是非负的。因此，我们可以简化绝对值：\n$$\nE_{\\mathrm{actual}} \\le \\frac{1}{4\\pi}\\sum_{i,j} \\left( \\frac{\\operatorname{erfc}(\\eta R_{ij})}{R_{ij}}\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\} + |\\alpha| \\frac{\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\} \\right)\n$$\n这就是互补误差函数的单调性变得至关重要的地方。对于正参数，$\\operatorname{erfc}(x)$ 是一个严格递减的函数。\n对于和中的任何一项，如果指示函数 $\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\}$ 非零，则意味着 $R_{ij} > r_{\\mathrm{cut}}$。这意味着 $\\eta R_{ij} > \\eta r_{\\mathrm{cut}}$。因为 $\\operatorname{erfc}$ 是递减的，我们有：\n$$\n\\operatorname{erfc}(\\eta R_{ij}) < \\operatorname{erfc}(\\eta r_{\\mathrm{cut}}) \\quad \\text{for } R_{ij} > r_{\\mathrm{cut}}\n$$\n类似地，对于镜像项：\n$$\n\\operatorname{erfc}(\\eta R^{\\mathrm{im}}_{ij}) < \\operatorname{erfc}(\\eta r_{\\mathrm{cut}}) \\quad \\text{for } R^{\\mathrm{im}}_{ij} > r_{\\mathrm{cut}}\n$$\n我们可以将这个上限代入我们关于 $E_{\\mathrm{actual}}$ 的不等式中的 $\\operatorname{erfc}$ 项。这产生了一个更宽松但更易于计算的界：\n$$\nE_{\\mathrm{actual}} \\le \\frac{1}{4\\pi}\\sum_{i,j} \\left( \\frac{\\operatorname{erfc}(\\eta r_{\\mathrm{cut}})}{R_{ij}}\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\} + |\\alpha| \\frac{\\operatorname{erfc}(\\eta r_{\\mathrm{cut}})}{R^{\\mathrm{im}}_{ij}}\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\} \\right)\n$$\n最后，我们提出公因子 $\\operatorname{erfc}(\\eta r_{\\mathrm{cut}})$，它相对于求和索引 $i$ 和 $j$ 是一个常数：\n$$\nE_{\\mathrm{actual}} \\le \\frac{\\operatorname{erfc}(\\eta r_{\\mathrm{cut}})}{4\\pi} \\left( \\sum_{i,j} \\frac{\\mathbb{I}\\{R_{ij}> r_{\\mathrm{cut}}\\}}{R_{ij}} + |\\alpha|\\sum_{i,j} \\frac{\\mathbb{I}\\{R^{\\mathrm{im}}_{ij}> r_{\\mathrm{cut}}\\}}{R^{\\mathrm{im}}_{ij}} \\right)\n$$\n这个最终表达式正是问题描述中给出的 $E_{\\mathrm{bound}}(\\eta,r_{\\mathrm{cut}})$ 的定义。推导完成，并严格地建立了不等式 $E_{\\mathrm{actual}}(\\eta,r_{\\mathrm{cut}}) \\le E_{\\mathrm{bound}}(\\eta,r_{\\mathrm{cut}})$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf, erfc\n\ndef solve():\n    \"\"\"\n    Computes the actual and bounded truncation error for an Ewald-like\n    summation in electromagnetic modeling for a series of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Structure: (sources, receivers, alpha, eta, r_cut)\n    # Sources and receivers are NumPy arrays of coordinates.\n    srcs = np.array([\n        [0.0, 0.0, 0.10], \n        [0.20, 0.05, 0.15], \n        [-0.10, -0.15, 0.20]\n    ])\n    rcvs = np.array([\n        [0.05, -0.05, 0.12], \n        [0.30, 0.20, 0.18]\n    ])\n\n    test_cases = [\n        (srcs, rcvs, -0.5, 20.0, 0.25),   # Case 1: Happy path\n        (srcs, rcvs, -0.5, 2.0, 0.25),    # Case 2: Low screening\n        (srcs, rcvs, -0.5, 60.0, 0.15),   # Case 3: High screening, tighter cutoff\n        (srcs, rcvs, 0.0, 20.0, 0.25)     # Case 4: Free-space edge case\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        sources, receivers, alpha, eta, r_cut = case\n        \n        # Create image sources by reflecting across the z=0 plane\n        image_sources = sources.copy()\n        image_sources[:, 2] *= -1\n\n        # Use broadcasting to compute distance matrices efficiently\n        # R_mat[i, j] = ||receivers[i] - sources[j]||\n        R_mat = np.linalg.norm(receivers[:, np.newaxis, :] - sources[np.newaxis, :, :], axis=2)\n        \n        # R_im_mat[i, j] = ||receivers[i] - image_sources[j]||\n        R_im_mat = np.linalg.norm(receivers[:, np.newaxis, :] - image_sources[np.newaxis, :, :], axis=2)\n        \n        # --- Calculate Actual Truncation Error (E_actual) ---\n        # The error is the sum of the short-range terms that were truncated.\n        \n        # Create boolean masks for pairs outside the cutoff radius\n        mask_R = R_mat > r_cut\n        mask_R_im = R_im_mat > r_cut\n        \n        # Calculate the direct term contribution to the error\n        # Set terms to 0 where R = r_cut using the mask\n        # Add a small epsilon to denominator to handle potential R=0 although not in test cases\n        epsilon = 1e-16\n        error_term_R = (erfc(eta * R_mat) / (R_mat + epsilon)) * mask_R\n        \n        # Calculate the image term contribution to the error\n        error_term_R_im = alpha * (erfc(eta * R_im_mat) / (R_im_mat + epsilon)) * mask_R_im\n        \n        # Sum all truncated contributions\n        total_error_sum = np.sum(error_term_R + error_term_R_im)\n        \n        # Final E_actual value with the 1/(4*pi) prefactor\n        E_actual = np.abs(total_error_sum / (4 * np.pi))\n\n        # --- Calculate the Error Bound (E_bound) ---\n        \n        # Sum of 1/R for truncated direct terms\n        bound_sum_R = np.sum((1 / (R_mat + epsilon)) * mask_R)\n        \n        # Sum of 1/R_im for truncated image terms\n        bound_sum_R_im = np.sum((1 / (R_im_mat + epsilon)) * mask_R_im)\n        \n        # Calculate the prefactor for the bound\n        prefactor = erfc(eta * r_cut) / (4 * np.pi)\n        \n        # Final E_bound value\n        E_bound = prefactor * (bound_sum_R + np.abs(alpha) * bound_sum_R_im)\n        \n        results.append([E_actual, E_bound])\n\n    # Final print statement in the exact required format.\n    # Example format: [[e1,b1],[e2,b2],...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3604682"}]}