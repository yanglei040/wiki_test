{"hands_on_practices": [{"introduction": "现实世界中的地质结构极其复杂，常常表现为精细的层状介质，直接对其进行数值模拟在计算上是不可行的。本实践引导您运用“有效介质理论”来解决这一挑战，这是一种将复杂异质结构等效为均匀介质的强大工具。您将首先推导适用于TE模式的有效电导率，然后通过编程实现数值实验，以探索该近似在何种条件下失效，从而深刻理解模型简化的物理基础和适用边界。[@problem_id:3610032]", "problem": "考虑一个一维、水平分层、电各向同性的地球模型，其中，电导率分别为 $ \\sigma_1 $ 和 $ \\sigma_2 $、厚度分别为 $ t_1 $ 和 $ t_2 $ 的两层介质周期性重复，形成一个在 $ z $ 方向上向下延伸的半无限介质。假设角频率为 $ \\omega = 2 \\pi f $ 的谐波时间依赖关系为 $ \\exp(-i \\omega t) $，磁导率 $ \\mu = \\mu_0 $，并忽略位移电流，因此传导电流占主导地位。一个垂直入射的平面波产生的场仅随深度 $ z $ 变化，并呈横向电场（TE）模式极化（电场水平，磁场与其垂直且也水平）。\n\n从以下基本原理出发：\n- 传导主导介质在频域中的麦克斯韦方程组：$ \\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H} $ 和 $ \\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E} $。\n- 本构关系：$ \\mathbf{B} = \\mu \\mathbf{H} $ 和 $ \\mathbf{J} = \\sigma \\mathbf{E} $。\n- TE 极化下的一维简化：场仅依赖于 $ z $，在电导率为 $ \\sigma $ 的均匀层内，切向电场 $ E_x(z) $ 的控制方程为扩散方程形式 $ \\dfrac{d^2 E_x}{dz^2} = i \\omega \\mu \\sigma \\, E_x $。相应的复传播常数为 $ \\gamma = \\sqrt{i \\omega \\mu \\sigma} $。\n- 趋肤深度定义为 $ \\delta(\\omega,\\sigma) = \\sqrt{\\dfrac{2}{\\mu \\, \\omega \\, \\sigma}} $，作为均匀导体中的特征衰减长度。\n\n任务 A（均匀化）：在精细分层介质的极限情况下，即周期 $ p = t_1 + t_2 $ 远小于趋肤深度 $ \\delta(\\omega,\\sigma) $ 时，从一维麦克斯韦系统和适当场分量的连续性出发，推导出一个适用于 TE 极化的、具有单一标量电导率 $ \\sigma_\\mathrm{eff} $ 的等效介质描述。您的推导必须仅依赖于上述基本原理，以及在一个周期内切向电场分量是连续的、而传导电流密度则在周期内取平均值这一事实。明确写出您得到的用 $ \\sigma_1 $、$ \\sigma_2 $、$ t_1 $ 和 $ t_2 $ 表示的 $ \\sigma_\\mathrm{eff} $ 的表达式。\n\n任务 B（表面阻抗和数值实验）：将周期性介质顶部的表面阻抗 $ Z $ 定义为 $ Z = \\dfrac{E_x(0)}{H_y(0)} $，其中 $ E_x(0) $ 和 $ H_y(0) $ 是在 $ z = 0 $ 处的相量值。仅使用给定的基本原理，为以下两种情况构建一个稳定的数值方法来计算 $ Z $：\n- 精确的半无限周期性层系，以及\n- 以 $ \\sigma_\\mathrm{eff} $ 为特征的均匀化半无限半空间。\n对于精确的周期性计算，您的方法必须在任意频率 $ f $ 下都有效，并且不得假设 $ p \\ll \\delta $。算法描述必须能够在现代编程语言中实现，且无需外部数据。\n\n任务 C（当 $ p \\to \\delta(\\omega) $ 时的失效测试）：使用您在任务 B 中得到的方法，为每个测试案例计算相对复阻抗误差\n$$ \\varepsilon = \\frac{|Z_\\mathrm{periodic} - Z_\\mathrm{eff}|}{|Z_\\mathrm{periodic}|} $$\n结果为一个无量纲浮点数。讨论 $ \\varepsilon $ 如何随比率 $ p / \\delta(\\omega,\\sigma_\\mathrm{eff}) $ 变化，并确定均匀化何时失效。\n\n物理和数值单位：$ \\sigma $ 使用 $\\mathrm{S/m}$，$ t $ 和 $ \\delta $ 使用 $\\mathrm{m}$，$ f $ 使用 $\\mathrm{Hz}$，$ \\mu $ 使用 $\\mathrm{H/m}$，$ Z $ 使用 $\\Omega$。将所有最终的 $ \\varepsilon $ 数值输出表示为四舍五入到六位小数的十进制浮点数。\n\n测试套件：您的程序必须为以下五个参数集计算 $ \\varepsilon $，每个参数集以元组 $ (\\sigma_1,\\sigma_2,t_1,t_2,f) $ 的形式给出，其中 $ \\mu = \\mu_0 = 4 \\pi \\times 10^{-7} \\, \\mathrm{H/m} $：\n- 案例 1：$ (1.0, \\, 0.01, \\, 0.6, \\, 1.4, \\, 100.0) $\n- 案例 2：$ (1.0, \\, 0.01, \\, 6.0, \\, 14.0, \\, 100.0) $\n- 案例 3：$ (1.0, \\, 0.01, \\, 15.0, \\, 35.0, \\, 100.0) $\n- 案例 4：$ (1.0, \\, 0.01, \\, 60.0, \\, 140.0, \\, 100.0) $\n- 案例 5：$ (0.5, \\, 0.5, \\, 15.0, \\, 35.0, \\, 100.0) $\n\n最终输出格式：您的程序应生成单行输出，其中包含按上述案例顺序排列的结果，形式为方括号括起来的逗号分隔列表，每个 $ \\varepsilon $ 值四舍五入到六位小数（例如，$ [0.000123,0.045678,0.500000,0.100000,0.000000] $）。", "solution": "经评估，用户提供的问题是有效的，因为它在科学上基于 Maxwell 电磁理论，问题设定良好，目标明确，并提供了一套完整且一致的数据和约束。解决方案将按顺序处理每个任务。\n\n### 任务 A：推导等效电导率 $\\sigma_\\mathrm{eff}$\n\n推导始于横向电场（TE）模式的一维频域麦克斯韦方程组，其中电场 $\\mathbf{E}$ 在 $x$ 方向极化，$\\mathbf{E} = (E_x(z), 0, 0)$，磁场 $\\mathbf{H}$ 在 $y$ 方向，$\\mathbf{H} = (0, H_y(z), 0)$。场仅随深度 $z$ 变化。\n\n由 $\\nabla \\times \\mathbf{E} = -i \\omega \\mu \\mathbf{H}$ 可得其 $y$ 分量：\n$$ \\frac{dE_x}{dz} = -i \\omega \\mu H_y $$\n由 $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E}$ 可得其 $x$ 分量：\n$$ -\\frac{dH_y}{dz} = \\sigma(z) E_x $$\n此处，$\\sigma(z)$ 是电导率，它是关于 $z$ 的周期函数，周期为 $p = t_1 + t_2$。具体而言，对于任何整数 $n \\geq 0$，当 $z \\in [np, np+t_1)$ 时，$\\sigma(z) = \\sigma_1$；当 $z \\in [np+t_1, (n+1)p)$ 时，$\\sigma(z) = \\sigma_2$。\n\n均匀化假设指出，对于长波长情况，即周期 $p$ 远小于特征趋肤深度 $\\delta$ 时，该精细分层介质的行为类似于一个具有等效电导率 $\\sigma_\\mathrm{eff}$ 的单一均匀介质。在此极限下，场在一个周期 $p$ 内变化缓慢。我们可以通过对微观场在一个周期内进行平均来推导 $\\sigma_\\mathrm{eff}$。\n\n令 $\\langle \\cdot \\rangle$ 表示在一个周期 $p$ 上的空间平均：$\\langle f(z) \\rangle = \\frac{1}{p} \\int_z^{z+p} f(z') dz'$。我们将此平均算子应用于我们的一维麦克斯韦方程组。\n\n第一个方程变为：\n$$ \\left\\langle \\frac{dE_x}{dz} \\right\\rangle = \\langle -i \\omega \\mu H_y \\rangle $$\n左侧为 $\\frac{1}{p} \\int_z^{z+p} \\frac{dE_x}{dz'} dz' = \\frac{E_x(z+p) - E_x(z)}{p}$。在长波长极限下，这近似于平均场的导数 $\\frac{d\\langle E_x \\rangle}{dz}$。右侧变为 $-i \\omega \\mu \\langle H_y \\rangle$。因此，第一个平均方程将平均场联系起来：\n$$ \\frac{d\\langle E_x \\rangle}{dz} = -i \\omega \\mu \\langle H_y \\rangle $$\n\n第二个方程变为：\n$$ \\left\\langle -\\frac{dH_y}{dz} \\right\\rangle = \\langle \\sigma(z) E_x \\rangle $$\n类似地，左侧变为 $-\\frac{d\\langle H_y \\rangle}{dz}$。对于右侧，我们利用切向电场 $E_x$ 在所有层边界上都是连续的这一事实。在 $p \\ll \\delta$ 的极限下，$E_x$ 在一个周期内几乎是恒定的，因此对于 $z' \\in [z, z+p]$，有 $E_x(z') \\approx \\langle E_x \\rangle$。这使我们可以将其从积分中提取出来：\n$$ \\langle \\sigma E_x \\rangle \\approx \\langle E_x \\rangle \\langle \\sigma \\rangle $$\n平均电导率 $\\langle \\sigma \\rangle$ 计算如下：\n$$ \\langle \\sigma \\rangle = \\frac{1}{p} \\int_0^p \\sigma(z') dz' = \\frac{1}{t_1+t_2} \\left[ \\int_0^{t_1} \\sigma_1 dz' + \\int_{t_1}^{t_1+t_2} \\sigma_2 dz' \\right] = \\frac{\\sigma_1 t_1 + \\sigma_2 t_2}{t_1 + t_2} $$\n因此，第二个平均方程为：\n$$ -\\frac{d\\langle H_y \\rangle}{dz} = \\left( \\frac{\\sigma_1 t_1 + \\sigma_2 t_2}{t_1 + t_2} \\right) \\langle E_x \\rangle $$\n通过将此平均场方程组与电导率为 $\\sigma_\\mathrm{eff}$ 的均匀介质的宏观麦克斯韦方程组进行比较，我们确定 TE 模式的等效电导率是各层电导率按其厚度加权的算术平均值：\n$$ \\sigma_\\mathrm{eff} = \\frac{\\sigma_1 t_1 + \\sigma_2 t_2}{t_1 + t_2} $$\n\n### 任务 B：表面阻抗的数值方法\n\n#### 均匀化介质的表面阻抗\n均匀化介质是一个具有均匀电导率 $\\sigma_\\mathrm{eff}$ 和磁导率 $\\mu_0$ 的半无限半空间。表面阻抗 $Z_\\mathrm{eff}$ 是该介质的本征阻抗。对于向下传播的平面波，场为 $E_x(z) = E_0 e^{-\\gamma_\\mathrm{eff} z}$ 和 $H_y(z) = \\frac{\\gamma_\\mathrm{eff}}{i\\omega\\mu_0} E_x(z)$，其中 $\\gamma_\\mathrm{eff} = \\sqrt{i \\omega \\mu_0 \\sigma_\\mathrm{eff}}$ 是传播常数。阻抗为：\n$$ Z_\\mathrm{eff} = \\frac{E_x(z)}{H_y(z)} = \\frac{i \\omega \\mu_0}{\\gamma_\\mathrm{eff}} = \\frac{i \\omega \\mu_0}{\\sqrt{i \\omega \\mu_0 \\sigma_\\mathrm{eff}}} = \\sqrt{\\frac{i \\omega \\mu_0}{\\sigma_\\mathrm{eff}}} $$\n为表示无源介质中的衰减波，$\\gamma_\\mathrm{eff}$ 和 $Z_\\mathrm{eff}$ 均选择实部为正的根。\n\n#### 精确周期性介质的表面阻抗\n对于精确的周期性层系，我们使用阻抗递推关系。一个厚度为 $t$、本征阻抗为 $\\eta$、传播常数为 $\\gamma$ 的层，覆盖在表面阻抗为 $Z_\\mathrm{load}$ 的介质之上，其表面阻抗 $Z_\\mathrm{in}$ 由下式给出：\n$$ Z_\\mathrm{in} = \\eta \\frac{Z_\\mathrm{load} + \\eta \\tanh(\\gamma t)}{\\eta + Z_\\mathrm{load} \\tanh(\\gamma t)} $$\n周期性介质是由双层结构组成的半无限层系。设该双层结构由第 1 层（厚度 $t_1$，电导率 $\\sigma_1$）位于第 2 层（厚度 $t_2$，电导率 $\\sigma_2$）之上组成。整个层系顶部的表面阻抗 $Z_\\mathrm{periodic}$ 在增加一个双层结构后必须保持不变。这意味着 $Z_\\mathrm{periodic}$ 是跨越一个双层结构的阻抗变换的不动点。\n\n设 $Z' = Z_\\mathrm{in}(t_2, \\eta_2, \\gamma_2, Z_\\mathrm{periodic})$ 为从第 2 层开始的半无限层系顶部的阻抗，它也是第 1 层的负载阻抗。\n$$ Z' = \\eta_2 \\frac{Z_\\mathrm{periodic} + \\eta_2 \\tanh(\\gamma_2 t_2)}{\\eta_2 + Z_\\mathrm{periodic} \\tanh(\\gamma_2 t_2)} $$\n那么，$Z_\\mathrm{periodic}$ 就是负载为 $Z'$ 的第 1 层顶部的阻抗：\n$$ Z_\\mathrm{periodic} = \\eta_1 \\frac{Z' + \\eta_1 \\tanh(\\gamma_1 t_1)}{\\eta_1 + Z' \\tanh(\\gamma_1 t_1)} $$\n将 $Z'$ 的表达式代入第二个方程，得到一个关于 $Z_\\mathrm{periodic}$ 的二次方程，形式为 $A Z_\\mathrm{periodic}^2 + B Z_\\mathrm{periodic} + C = 0$，其中：\n- $\\gamma_j = \\sqrt{i \\omega \\mu_0 \\sigma_j}$ 是第 $j$ 层的传播常数。\n- $\\eta_j = \\sqrt{i \\omega \\mu_0 / \\sigma_j}$ 是第 $j$ 层的本征阻抗。\n- $T_j = \\tanh(\\gamma_j t_j)$。\n- $A = \\eta_1 T_2 + \\eta_2 T_1$。\n- $B = (\\eta_2^2 - \\eta_1^2) T_1 T_2$。\n- $C = - \\eta_1 \\eta_2 (\\eta_1 T_1 + \\eta_2 T_2)$。\n\n解由二次方程求根公式给出：\n$$ Z_\\mathrm{periodic} = \\frac{-B \\pm \\sqrt{B^2 - 4AC}}{2A} $$\n对于无源耗散介质，阻抗必须具有非负实部，即 $\\mathrm{Re}(Z_\\mathrm{periodic}) \\ge 0$。这个物理约束唯一地确定了二次方程的正确根。\n\n### 任务 C：均匀化的失效\n\n均匀化近似在分层周期 $p = t_1 + t_2$ 远小于电磁波在介质中的趋肤深度 $\\delta$ 时有效。对于无量纲比率 $p/\\delta_\\mathrm{eff}$（其中 $\\delta_\\mathrm{eff} = \\sqrt{2 / (\\mu_0 \\omega \\sigma_\\mathrm{eff})}$）的较小值，误差 $\\varepsilon$ 预期会很小。随着该比率的增加，电磁波开始分辨出单个的层，等效介质近似法失效，从而导致更大的误差 $\\varepsilon$。\n\n测试案例旨在探究这种失效情况：\n- 案例 1 到 4 具有固定的电导率对比度和厚度比，但周期 $p$ 递增。这会系统地增加 $p/\\delta_\\mathrm{eff}$ 的比率，我们预期 $\\varepsilon$ 会相应地增加。\n- 案例 5 代表一个均匀介质（$\\sigma_1 = \\sigma_2$），对此，无论层厚如何，等效介质理论都是精确的。周期性模型和均匀化模型是相同的，因此我们预期 $Z_\\mathrm{periodic} = Z_\\mathrm{eff}$ 且 $\\varepsilon = 0$。这可作为对数值方法的验证。\n\n对于每个测试案例，数值算法按以下步骤进行：\n1. 计算角频率 $\\omega = 2 \\pi f$。\n2. 使用任务 A 中的公式计算等效电导率 $\\sigma_\\mathrm{eff}$。\n3. 使用任务 B 中的公式计算均匀化阻抗 $Z_\\mathrm{eff}$。\n4. 计算特定层的参数 $\\gamma_1, \\eta_1, \\gamma_2, \\eta_2$。\n5. 计算 $Z_\\mathrm{periodic}$ 的二次方程的系数 $A, B, C$。\n6. 求解 $Z_\\mathrm{periodic}$ 的两个根，并选择实部非负的那个根。\n7. 计算相对误差 $\\varepsilon = |Z_\\mathrm{periodic} - Z_\\mathrm{eff}| / |Z_\\mathrm{periodic}|$，其中绝对值使用复数模。\n最终输出是这些误差值的列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the geophysical electromagnetics problem for a set of test cases.\n    It calculates the relative impedance error between an exact periodic model and\n    a homogenized effective medium model.\n    \"\"\"\n\n    # Define physical constants\n    MU_0 = 4 * np.pi * 1e-7  # Magnetic permeability of free space (H/m)\n    I_ = 1j                   # Complex unit\n\n    def calculate_error(sigma1, sigma2, t1, t2, f):\n        \"\"\"\n        Computes the relative complex-impedance error for a single parameter set.\n        \n        Args:\n            sigma1 (float): Conductivity of layer 1 (S/m).\n            sigma2 (float): Conductivity of layer 2 (S/m).\n            t1 (float): Thickness of layer 1 (m).\n            t2 (float): Thickness of layer 2 (m).\n            f (float): Frequency (Hz).\n\n        Returns:\n            float: The dimensionless relative impedance error, epsilon.\n        \"\"\"\n        omega = 2 * np.pi * f\n\n        # --- Homogenized Medium Calculation ---\n        # Case 5 is a special homogeneous case, handle it to avoid division by zero or NaN\n        # if t1+t2 is zero, which is not the case here but good practice.\n        if np.isclose(sigma1, sigma2):\n            sigma_eff = sigma1\n        else:\n            sigma_eff = (sigma1 * t1 + sigma2 * t2) / (t1 + t2)\n        \n        # Check for zero conductivity to prevent division by zero\n        if np.isclose(sigma_eff, 0.0):\n             # For a perfect insulator, impedance is infinite. This problem assumes conductors.\n             # In a real scenario, displacement currents would matter.\n             # Let's return 0 as per Case 5 logic if sigma1=sigma2=0.\n            if np.isclose(sigma1, sigma2):\n                return 0.0\n            else: # Should not happen with given test data\n                return np.nan\n\n        z_eff = np.sqrt(I_ * omega * MU_0 / sigma_eff)\n\n        # --- Exact Periodic Medium Calculation ---\n        \n        # If the medium is homogeneous, the periodic solution is the same as effective medium.\n        if np.isclose(sigma1, sigma2):\n            z_periodic = z_eff\n        else:\n            # Layer 1 parameters\n            gamma1 = np.sqrt(I_ * omega * MU_0 * sigma1)\n            eta1 = np.sqrt(I_ * omega * MU_0 / sigma1)\n            T1 = np.tanh(gamma1 * t1)\n\n            # Layer 2 parameters\n            gamma2 = np.sqrt(I_ * omega * MU_0 * sigma2)\n            eta2 = np.sqrt(I_ * omega * MU_0 / sigma2)\n            T2 = np.tanh(gamma2 * t2)\n\n            # Coefficients of the quadratic equation A*Z^2 + B*Z + C = 0 for Z_periodic\n            A = eta1 * T2 + eta2 * T1\n            B = (eta2**2 - eta1**2) * T1 * T2\n            C = -eta1 * eta2 * (eta1 * T1 + eta2 * T2)\n            \n            # Solve the quadratic equation\n            # Numerically stable choice of roots for quadratic equation is generally preferred,\n            # but standard formula is sufficient here.\n            discriminant = np.sqrt(B**2 - 4 * A * C)\n            \n            # The two possible roots for the impedance\n            root1 = (-B + discriminant) / (2 * A)\n            root2 = (-B - discriminant) / (2 * A)\n            \n            # The physical solution must have a non-negative real part (passive medium)\n            if root1.real = 0:\n                z_periodic = root1\n            elif root2.real = 0:\n                z_periodic = root2\n            else:\n                # Should not happen for a physical system\n                # Return NaN to indicate a problem with the model or parameters\n                return np.nan\n\n        # --- Relative Error Calculation ---\n        if np.isclose(np.abs(z_periodic), 0.0):\n            # If the true impedance is zero, any difference is infinitely large in relative terms.\n            # This happens for a perfect conductor. But given sigma  0, |Z|  0.\n            # However, if z_eff is also zero, error is 0.\n            if np.isclose(np.abs(z_eff), 0.0):\n                return 0.0\n            else:\n                 return np.inf\n\n        error = np.abs(z_periodic - z_eff) / np.abs(z_periodic)\n        \n        return error\n\n    # Test suite from the problem statement\n    test_cases = [\n        (1.0, 0.01, 0.6, 1.4, 100.0),    # Case 1\n        (1.0, 0.01, 6.0, 14.0, 100.0),   # Case 2\n        (1.0, 0.01, 15.0, 35.0, 100.0),  # Case 3\n        (1.0, 0.01, 60.0, 140.0, 100.0), # Case 4\n        (0.5, 0.5, 15.0, 35.0, 100.0)    # Case 5 (Homogeneous control case)\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma1, sigma2, t1, t2, f = case\n        epsilon = calculate_error(sigma1, sigma2, t1, t2, f)\n        results.append(f\"{epsilon:.6f}\")\n    \n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3610032"}, {"introduction": "地球物理勘探获得的是时间序列数据，我们如何从这些数据中解读出地下介质的物理信息？本实践的核心在于揭示一个基本物理原理：导体在时域电磁（TDEM）勘探中的响应可以分解为一系列指数衰减的本征模之和，其中每个模式的衰减率都直接关联着介质的电性与几何参数。您将首先从理论上推导这种本征模表示，然后亲手实现一种先进的信号处理方法（矩阵束法），从含噪声的合成数据中精确地提取这些关键的衰减率，这是地球物理数据解释中的一项核心技能。[@problem_id:3610019]", "problem": "考虑通过稀疏扩散本征模之和来解释在准静态条件下由麦克斯韦方程组产生的时域电磁（TDEM）响应。从基本的麦克斯韦方程组出发，假设一个导电、非磁性的地球，其具有恒定的磁导率 $\\mu$ 和电导率 $\\sigma$，并忽略位移电流。在无源区域中，电场 $\\mathbf{E}$ 和磁通量密度 $\\mathbf{B}$ 满足\n$ \\nabla \\times \\mathbf{E} = - \\dfrac{\\partial \\mathbf{B}}{\\partial t}, \\quad \\nabla \\times \\left( \\dfrac{1}{\\mu} \\mathbf{B} \\right) = \\sigma \\mathbf{E}.$\n在角频率为 $\\omega$ 的频域中，作用于电场的传导性旋度-旋度公式的相关算子为\n$ \\mathcal{L} = \\nabla \\times \\mu^{-1} \\nabla \\times - i \\omega \\sigma.$\n对于时域电磁（TDEM），在时域中进行分析，并考虑一个典型的一维配置：一个沿 $z$ 轴、厚度为 $L$ 的均匀平板，其在 $z = 0$ 和 $z = L$ 处有理想电导体（PEC）板，使得边界上的切向电场为零。假设为横电（TE）极化，其中电场 $\\mathbf{E}$ 沿 $x$ 方向，且空间变化仅发生在 $z$ 和 $t$上。\n\n任务 A。仅使用上述基本方程和边界条件，为单个场分量（选择一个一致的分量和公式）推导其控制性扩散型初边值问题，并证明在固定位置测量的 TDEM 脉冲响应可以表示为指数衰减的扩散本征模的稀疏和。结论是，测量到的时间轨迹 $y(t)$ 可以写成以下形式\n$ y(t) = \\sum_{k=1}^{K} a_k e^{-\\lambda_k t},$\n其中 $K$ 相对于可观测样本数量而言很小，$\\{a_k\\}$ 是实数振幅，$\\{\\lambda_k\\}$ 是由几何结构、材料属性和边界条件决定的实数、正衰减率。所有衰减率均以 $\\mathrm{s}^{-1}$ 为单位表示。\n\n任务 B。实现一个稳定的估计算法，从典型平板合成生成的带噪均匀采样数据 $\\{y(t_n)\\}_{n=0}^{N-1}$ 中恢复 $\\{\\lambda_k\\}$。您的估计算法必须基于与 Prony 方法等效的原理，例如使用奇异值分解（SVD）的矩阵束方法（MPM），并且必须明确利用以下事实：均匀采样意味着 $y_n = \\sum_{k=1}^K A_k z_k^n$，其中对于采样间隔 $\\Delta t$ 和适当移位的振幅 $\\{A_k\\}$，有 $z_k = e^{-\\lambda_k \\Delta t}$。\n\n任务 C。使用典型平板几何结构，生成在所述假设和边界条件下由麦克斯韦扩散本征问题所蕴含的解析衰减率 $\\{\\lambda_k\\}$。然后，对于下面的每个测试用例，使用给定的模态振幅 $\\{a_k\\}$ 从前 $K$ 个指定的扩散本征模合成一个无噪声信号 $y_{\\text{noiseless}}(t_n)$，添加一个指定相对标准差（定义为 $\\max_n |y_{\\text{noiseless}}(t_n)|$ 的一个分数）的零均值高斯噪声，并应用您的估计算法获得 $\\{\\widehat{\\lambda}_k\\}$。对于每个测试用例，计算所有模态中的最大相对误差，\n$ \\varepsilon_{\\max} = \\max_k \\dfrac{|\\widehat{\\lambda}_k - \\lambda_k|}{\\lambda_k},$\n其中，模态通过将真实和估计的 $\\lambda$ 按升序排序进行配对。对于每个测试用例，返回一个布尔值，指示是否满足 $\\varepsilon_{\\max} \\le \\tau$，其中 $\\tau$ 是提供的容差。\n\n物理和数值单位及常数：\n- 平板厚度必须以米为单位使用。\n- 时间变量必须以秒为单位。\n- 磁导率必须取真空值 $\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\mathrm{H/m}$。\n- 电导率必须以 $\\mathrm{S/m}$ 为单位。\n- 所有衰减率 $\\lambda_k$ 必须以 $\\mathrm{s}^{-1}$ 为单位报告和内部计算。\n- 此问题中不使用角度。\n- 任何提及的百分比都应视为纯小数。\n\n测试套件规范：\n对于每个用例，参数为：$(L, \\sigma, \\{n_k\\}_{k=1}^K, \\{a_k\\}_{k=1}^K, N, t_0, \\Delta t, \\text{noise\\_rel\\_std}, \\tau)$，其中 $\\{n_k\\}$ 是与典型平板本征模相关的正整数模态指数，$\\{a_k\\}$ 是对应的模态振幅，$N$ 是均匀样本的数量，$t_0$ 是初始时间，$\\Delta t$ 是采样间隔，$\\text{noise\\_rel\\_std}$ 是加性高斯噪声的相对标准差，$\\tau$ 是通过/失败的容差。\n\n- 用例 1（理想情况，三个分离的模态，低噪声）：\n  - $L = 100\\,\\mathrm{m}$，$\\sigma = 0.1\\,\\mathrm{S/m}$，\n  - $\\{n_k\\} = [1, 2, 3]$，$\\{a_k\\} = [1.0, 0.5, 0.3]$，\n  - $N = 120$，$t_0 = 1.0 \\times 10^{-5}\\,\\mathrm{s}$，$\\Delta t = 2.0 \\times 10^{-5}\\,\\mathrm{s}$，\n  - $\\text{noise\\_rel\\_std} = 1.0 \\times 10^{-4}$，$\\tau = 1.0 \\times 10^{-2}$。\n\n- 用例 2（两个相近的模态，中等噪声）：\n  - $L = 500\\,\\mathrm{m}$，$\\sigma = 0.01\\,\\mathrm{S/m}$，\n  - $\\{n_k\\} = [5, 6]$，$\\{a_k\\} = [1.0, 0.8]$，\n  - $N = 180$，$t_0 = 2.0 \\times 10^{-5}\\,\\mathrm{s}$，$\\Delta t = 5.0 \\times 10^{-5}\\,\\mathrm{s}$，\n  - $\\text{noise\\_rel\\_std} = 2.0 \\times 10^{-4}$，$\\tau = 2.0 \\times 10^{-2}$。\n\n- 用例 3（单模态，极低噪声）：\n  - $L = 50\\,\\mathrm{m}$，$\\sigma = 1.0\\,\\mathrm{S/m}$，\n  - $\\{n_k\\} = [1]$，$\\{a_k\\} = [2.0]$，\n  - $N = 200$，$t_0 = 5.0 \\times 10^{-5}\\,\\mathrm{s}$，$\\Delta t = 3.0 \\times 10^{-4}\\,\\mathrm{s}$，\n  - $\\text{noise\\_rel\\_std} = 1.0 \\times 10^{-5}$，$\\tau = 5.0 \\times 10^{-3}$。\n\n- 用例 4（三模态，较高噪声）：\n  - $L = 100\\,\\mathrm{m}$，$\\sigma = 0.1\\,\\mathrm{S/m}$，\n  - $\\{n_k\\} = [1, 2, 3]$，$\\{a_k\\} = [1.0, 0.5, 0.3]$，\n  - $N = 120$，$t_0 = 1.0 \\times 10^{-5}\\,\\mathrm{s}$，$\\Delta t = 2.0 \\times 10^{-5}\\,\\mathrm{s}$，\n  - $\\text{noise\\_rel\\_std} = 5.0 \\times 10^{-4}$，$\\tau = 5.0 \\times 10^{-2}$。\n\n您的程序必须：\n- 根据指定的 $\\{n_k\\}$, $L$, $\\sigma$ 和 $\\mu_0$ 计算典型平板麦克斯韦扩散本征问题所蕴含的解析衰减率 $\\{\\lambda_k\\}$，并使用给定的 $\\{a_k\\}$ 和均匀样本 $t_n = t_0 + n \\Delta t$（其中 $n = 0, 1, \\dots, N-1$）合成 $y_{\\text{noiseless}}(t_n)$。\n- 添加零均值高斯噪声，其标准差等于 $\\text{noise\\_rel\\_std} \\times \\max_n |y_{\\text{noiseless}}(t_n)|$。\n- 使用矩阵束方法（或等效的 Prony 类方法）从带噪均匀样本中估计 $\\{\\widehat{\\lambda}_k\\}$。\n- 对于每个测试用例，计算 $\\varepsilon_{\\max}$ 并返回一个布尔值，指示是否满足 $\\varepsilon_{\\max} \\le \\tau$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含四个测试用例的四个布尔结果，格式为逗号分隔的列表，并用方括号括起来，例如，“[True,False,True,True]”。", "solution": "该问题被评估为有效，因为它在科学上基于准静态电磁学原理，在数学上是适定的，并且所有参数和条件都得到了明确的规定。这些任务涉及标准的理论推导、一个成熟的数值方法的实现，以及一组用于验证的具体测试用例。\n\n### 任务 A：控制性初边值问题（IBVP）和本征模表示的推导\n\n我们从一个无源、均匀、导电介质中给定的准静态麦克斯韦方程组开始，该介质具有恒定的磁导率 $\\mu$ 和电导率 $\\sigma$：\n$$ \\nabla \\times \\mathbf{E} = - \\frac{\\partial \\mathbf{B}}{\\partial t} \\quad (1) $$\n$$ \\nabla \\times \\mathbf{B} = \\mu \\sigma \\mathbf{E} \\quad (2) $$\n为了推导电场 $\\mathbf{E}$ 的单个控制方程，我们对法拉第定律（1）取旋度，并交换空间和时间导数的顺序：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = - \\nabla \\times \\left( \\frac{\\partial \\mathbf{B}}{\\partial t} \\right) = - \\frac{\\partial}{\\partial t} (\\nabla \\times \\mathbf{B}) $$\n将安培定律（2）代入此表达式，得到 $\\mathbf{E}$ 的矢量扩散方程：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = - \\frac{\\partial}{\\partial t} (\\mu \\sigma \\mathbf{E}) $$\n鉴于 $\\mu$ 和 $\\sigma$ 是常数，我们有：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = - \\mu \\sigma \\frac{\\partial \\mathbf{E}}{\\partial t} $$\n问题指定了一个一维配置，其中横电（TE）场为 $\\mathbf{E} = E_x(z, t) \\hat{\\mathbf{x}}$，它仅在 $z$ 方向和时间 $t$ 上变化。我们针对这个特定的场结构计算旋度算子。第一个旋度是：\n$$ \\nabla \\times \\mathbf{E} = \\nabla \\times (E_x(z, t) \\hat{\\mathbf{x}}) = \\frac{\\partial E_x}{\\partial z} \\hat{\\mathbf{y}} $$\n第二个旋度（旋度的旋度）是：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla \\times \\left( \\frac{\\partial E_x}{\\partial z} \\hat{\\mathbf{y}} \\right) = - \\frac{\\partial}{\\partial z} \\left( \\frac{\\partial E_x}{\\partial z} \\right) \\hat{\\mathbf{x}} = - \\frac{\\partial^2 E_x}{\\partial z^2} \\hat{\\mathbf{x}} $$\n将此结果代入矢量扩散方程，我们得到分量 $E_x(z, t)$ 的标量扩散方程：\n$$ - \\frac{\\partial^2 E_x}{\\partial z^2} = - \\mu \\sigma \\frac{\\partial E_x}{\\partial t} $$\n$$ \\implies \\frac{\\partial E_x}{\\partial t} = \\frac{1}{\\mu \\sigma} \\frac{\\partial^2 E_x}{\\partial z^2} $$\n这是控制性偏微分方程（PDE）。问题在 $z=0$ 和 $z=L$ 处定义了理想电导体（PEC）边界条件，这要求电场的切向分量为零。这给出了边界条件（BCs）：\n$$ E_x(0, t) = 0 \\quad \\text{和} \\quad E_x(L, t) = 0 $$\n这个初边值问题（IBVP）的解可以使用分离变量法找到。我们假设一个形式为 $E_x(z, t) = Z(z)T(t)$ 的解。代入偏微分方程得到：\n$$ \\frac{T'(t)}{T(t)} = \\frac{1}{\\mu \\sigma} \\frac{Z''(z)}{Z(z)} = -\\lambda $$\n其中 $-\\lambda$ 是分离常数。选择一个负常数确保解随时间衰减，这与物理扩散过程一致。这导致两个常微分方程：\n1. 时间部分：$T'(t) + \\lambda T(t) = 0 \\implies T(t) = e^{-\\lambda t}$\n2. 空间部分：$Z''(z) + \\lambda \\mu \\sigma Z(z) = 0$，边界条件为 $Z(0)=0$ 和 $Z(L)=0$。\n\n空间方程是一个 Sturm-Liouville 本征值问题。其通解为 $Z(z) = C_1 \\sin(\\sqrt{\\lambda \\mu \\sigma} z) + C_2 \\cos(\\sqrt{\\lambda \\mu \\sigma} z)$。应用边界条件：\n- $Z(0)=0 \\implies C_2=0$。\n- $Z(L)=0 \\implies C_1 \\sin(\\sqrt{\\lambda \\mu \\sigma} L) = 0$。\n为了得到非平凡解（$C_1 \\neq 0$），我们必须有 $\\sqrt{\\lambda \\mu \\sigma} L = n \\pi$，其中 $n=1, 2, 3, \\ldots$ 是任意正整数。这将分离常数 $\\lambda$ 量子化为一组离散的本征值，即衰减率 $\\{\\lambda_n\\}$：\n$$ \\lambda_n = \\frac{1}{\\mu \\sigma} \\left(\\frac{n \\pi}{L}\\right)^2 $$\n相应的空间本征函数为 $Z_n(z) = \\sin\\left(\\frac{n \\pi z}{L}\\right)$。\n\n通解是所有本征模的线性叠加：\n$$ E_x(z, t) = \\sum_{n=1}^{\\infty} c_n Z_n(z) T_n(t) = \\sum_{n=1}^{\\infty} c_n \\sin\\left(\\frac{n \\pi z}{L}\\right) e^{-\\lambda_n t} $$\n系数 $c_n$ 取决于 $t=0$ 时的初始场分布。在固定深度 $z_0$ 处的时域测量 $y(t)$ 于是为：\n$$ y(t) = E_x(z_0, t) = \\sum_{n=1}^{\\infty} \\left(c_n \\sin\\left(\\frac{n \\pi z_0}{L}\\right)\\right) e^{-\\lambda_n t} $$\n将模态振幅定义为 $a_n = c_n \\sin(n \\pi z_0 / L)$，测量信号就呈现为衰减指数和的形式。在实践中，由于激励和测量的物理特性，只有少数 $K$ 个模态具有显著振幅，从而导致稀疏表示：\n$$ y(t) = \\sum_{k=1}^{K} a_k e^{-\\lambda_k t} $$\n理论推导到此结束。衰减率 $\\lambda_k$ 是实数、正数，并以 $\\mathrm{s}^{-1}$ 为单位。\n\n### 任务 B 和 C：解析衰减率和数值估计\n\n对于任务 C，我们必须首先为指定的整数模态指数 $\\{n_k\\}$ 计算解析衰减率。使用推导出的公式并代入真空磁导率 $\\mu_0=4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$：\n$$ \\lambda_{n_k} = \\frac{n_k^2 \\pi^2}{\\mu_0 \\sigma L^2} $$\n这些是我们的估计值将与之比较的基准真值。\n\n对于任务 B，我们实现一个估计算法，用于从带噪的均匀采样数据中估计 $\\{\\lambda_k\\}$。矩阵束方法（MPM）是一种合适的类 Prony 技术。\n采样信号由 $y_n = y(t_n)$ 给出，其中 $t_n = t_0 + n\\Delta t$。\n$$ y_n = \\sum_{k=1}^{K} a_k e^{-\\lambda_k (t_0 + n\\Delta t)} = \\sum_{k=1}^{K} (a_k e^{-\\lambda_k t_0}) (e^{-\\lambda_k \\Delta t})^n $$\n令 $A_k = a_k e^{-\\lambda_k t_0}$ 和“极点”$z_k = e^{-\\lambda_k \\Delta t}$，离散样本的模型为：\n$$ y_n = \\sum_{k=1}^{K} A_k z_k^n $$\nMPM 算法流程如下：\n1.  **构造 Hankel 矩阵**：从 $N$ 个数据样本 $\\{y_0, y_1, \\ldots, y_{N-1}\\}$ 中，构造两个 $(N-L_p) \\times L_p$ 的 Hankel 矩阵 $Y_0$ 和 $Y_1$，其中 $L_p$ 是矩阵束参数（为获得良好的噪声平均效果，选择为 $N//2$，并满足 $K \\le L_p \\le N-L_p$）。这些矩阵定义为：\n    $$ (Y_0)_{ij} = y_{i+j} \\quad \\text{和} \\quad (Y_1)_{ij} = y_{i+j+1} $$\n    其中 $i=0, \\ldots, N-L_p-1$ 且 $j=0, \\ldots, L_p-1$。\n\n2.  **求解广义本征值问题**：在无噪声情况下，极点 $\\{z_k\\}$ 是矩阵束 $(Y_1, Y_0)$ 的广义本征值，满足 $\\det(Y_1 - z Y_0) = 0$。在有噪声的情况下，这个问题是病态的。一个稳健的解是通过计算矩阵 $Y_0^+ Y_1$ 的本征值来找到的，其中 $Y_0^+$ 是 $Y_0$ 的 Moore-Penrose 伪逆。\n\n3.  **基于 SVD 的正则化**：为了计算噪声矩阵 $Y_0$ 的稳定伪逆，我们使用其奇异值分解（SVD）：$Y_0 = U S V^H$。有效信号模态的数量 $K$ 是已知的。我们将 SVD 截断到秩 $K$，只保留前 $K$ 个奇异值和相应的奇异向量：$U_K$、$S_K$ 和 $V_K$。截断后的伪逆则为 $Y_0^+ = V_K S_K^{-1} U_K^H$。\n\n4.  **估计极点**：通过计算从矩阵束导出的 $K \\times K$ 矩阵的本征值，可以找到估计的极点 $\\{\\hat{z}_k\\}$：\n    $$ \\{\\hat{z}_k\\}_{k=1}^K = \\mathrm{eig}(Y_0^+ Y_1) $$\n    由于噪声的存在，计算出的本征值将是复数。\n\n5.  **恢复衰减率**：衰减率 $\\{\\widehat{\\lambda}_k\\}$ 从极点中恢复。对于一个复数极点 $\\hat{z} = re^{i\\theta}$，其对数为 $\\ln(\\hat{z}) = \\ln(r) + i\\theta$。由于 $\\ln(z_k) = -\\lambda_k \\Delta t$ 且我们的 $\\lambda_k$ 是实数，我们关心的是对数的实部，它与极点的模有关。因此，衰减率的稳健估计量是：\n    $$ \\widehat{\\lambda}_k = -\\frac{\\ln(|\\hat{z}_k|)}{\\Delta t} $$\n此过程产生估计的衰减率。然后将它们排序并与排序后的解析衰减率进行比较，以计算每个测试用例的最大相对误差 $\\varepsilon_{\\max}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import hankel, svd, eigvals\n\ndef solve():\n    \"\"\"\n    Main solver function that processes test cases for TDEM parameter estimation.\n    \"\"\"\n    MU_0 = 4 * np.pi * 1e-7\n\n    def calculate_analytical_lambdas(n_modes, L, sigma):\n        \"\"\"\n        Calculates analytical decay rates for the 1D slab problem.\n        lambda_n = (n^2 * pi^2) / (mu_0 * sigma * L^2)\n        \"\"\"\n        n_modes = np.array(n_modes)\n        lambdas = (n_modes**2 * np.pi**2) / (MU_0 * sigma * L**2)\n        return lambdas\n\n    def synthesize_signal(lambdas, amplitudes, N, t0, dt):\n        \"\"\"\n        Synthesizes a noiseless TDEM signal as a sum of decaying exponentials.\n        \"\"\"\n        times = t0 + np.arange(N) * dt\n        y_noiseless = np.zeros(N)\n        for lambda_k, a_k in zip(lambdas, amplitudes):\n            y_noiseless += a_k * np.exp(-lambda_k * times)\n        return times, y_noiseless\n\n    def add_noise(y_noiseless, rel_std):\n        \"\"\"\n        Adds zero-mean Gaussian noise to a signal.\n        \"\"\"\n        if rel_std == 0.0:\n            return y_noiseless\n        \n        # Guard against zero signal\n        max_abs_val = np.max(np.abs(y_noiseless))\n        if max_abs_val == 0:\n            return y_noiseless\n\n        sigma_noise = rel_std * max_abs_val\n        noise = np.random.normal(0, sigma_noise, len(y_noiseless))\n        return y_noiseless + noise\n\n    def estimate_lambdas_mpm(y_noisy, K, dt):\n        \"\"\"\n        Estimates decay rates from a noisy signal using the Matrix Pencil Method.\n        \"\"\"\n        N = len(y_noisy)\n        # Pencil parameter, chosen to be large for noise averaging\n        pencil_dim = N // 2\n        \n        if K  pencil_dim:\n            raise ValueError(\"Number of modes K is too large for the chosen pencil dimension.\")\n\n        # Construct Hankel matrices Y0 and Y1\n        # Y0[i,j] = y[i+j]\n        # Y1[i,j] = y[i+j+1]\n        Y0 = hankel(y_noisy[0 : N - pencil_dim], y_noisy[N - pencil_dim - 1 : N - 1])\n        Y1 = hankel(y_noisy[1 : N - pencil_dim + 1], y_noisy[N - pencil_dim : N])\n\n        # SVD of Y0 for truncated pseudoinverse\n        U, s, Vh = svd(Y0, full_matrices=False)\n\n        # Truncate based on the known number of modes, K\n        Uk = U[:, :K]\n        sinv_k = np.diag(1.0 / s[:K])\n        Vh_k = Vh[:K, :]\n        Vk = Vh_k.conj().T\n\n        # Compute Y0^+ * Y1\n        # Y0_plus = Vk @ sinv_k @ Uk.conj().T\n        # C = Y0_plus @ Y1\n        # A more stable computation for the eigenvalues of Y0^+ * Y1\n        # is to compute eigenvalues of U_k.conj().T @ Y1 @ V_k @ S_k^-1\n        C_prime = Uk.conj().T @ Y1 @ Vk @ sinv_k\n        \n        # Eigenvalues are the estimated poles z_k\n        z_hat = eigvals(C_prime)\n        \n        # Recover decay rates from the magnitudes of the poles\n        # lambda_k = -ln(|z_k|) / dt\n        # Filter out potential spurious poles resulting in negative logs or warnings\n        valid_z_hat = z_hat[np.abs(z_hat)  0]\n        lambda_hat = -np.log(np.abs(valid_z_hat)) / dt\n        \n        return lambda_hat\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, three separated modes, low noise)\n        (100.0, 0.1, [1, 2, 3], [1.0, 0.5, 0.3], 120, 1.0e-5, 2.0e-5, 1.0e-4, 1.0e-2),\n        # Case 2 (two nearby modes, moderate noise)\n        (500.0, 0.01, [5, 6], [1.0, 0.8], 180, 2.0e-5, 5.0e-5, 2.0e-4, 2.0e-2),\n        # Case 3 (single mode, very low noise)\n        (50.0, 1.0, [1], [2.0], 200, 5.0e-5, 3.0e-4, 1.0e-5, 5.0e-3),\n        # Case 4 (three modes, higher noise)\n        (100.0, 0.1, [1, 2, 3], [1.0, 0.5, 0.3], 120, 1.0e-5, 2.0e-5, 5.0e-4, 5.0e-2),\n    ]\n\n    results = []\n    # Set a seed for reproducibility of random noise\n    np.random.seed(0)\n\n    for case in test_cases:\n        L, sigma, n_modes, amplitudes, N, t0, dt, noise_rel_std, tau = case\n        K = len(n_modes)\n\n        # 1. Compute analytical ground-truth decay rates\n        true_lambdas = calculate_analytical_lambdas(n_modes, L, sigma)\n\n        # 2. Synthesize the noiseless signal\n        _, y_noiseless = synthesize_signal(true_lambdas, amplitudes, N, t0, dt)\n\n        # 3. Add Gaussian noise\n        y_noisy = add_noise(y_noiseless, noise_rel_std)\n\n        # 4. Estimate decay rates using MPM\n        estimated_lambdas = estimate_lambdas_mpm(y_noisy, K, dt)\n\n        # 5. Compare results after sorting\n        true_lambdas_sorted = np.sort(true_lambdas)\n        # Ensure we only compare real parts and sort\n        estimated_lambdas_sorted = np.sort(np.real(estimated_lambdas))\n        \n        # Handle cases where MPM might return fewer modes than K due to filtering\n        if len(estimated_lambdas_sorted) != len(true_lambdas_sorted):\n            # If the number of modes is incorrect, the estimation failed.\n            max_rel_error = np.inf\n        else:\n            relative_errors = np.abs(estimated_lambdas_sorted - true_lambdas_sorted) / true_lambdas_sorted\n            max_rel_error = np.max(relative_errors)\n\n        results.append(max_rel_error = tau)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3610019"}, {"introduction": "地球物理研究的终极目标之一是反演：自动调整地球模型，使其正演响应与观测数据相匹配。实现高效反演的关键在于计算数据失配函数相对于模型参数的梯度。本实践将引导您掌握实现这一目标的核心技术——伴随状态法，该方法能够以极高的计算效率获得梯度，且效率与模型参数的数量无关。您将从零开始构建一个“可微分”的正演求解器，并基于第一性原理实现伴随状态法，通过互易性检验和有限差分验证等手段，您将深刻掌握驱动现代大规模地球物理反演的核心引擎。[@problem_id:3610028]", "problem": "考虑适用于地球物理电磁学的频域麦克斯韦方程组的二维横电 (TE) 简化形式，该简化基于准静态近似，其中位移电流可忽略不计。设平面外电场为 $E_z(x,y)$，并假设磁导率 $\\mu(x,y)$ 和电导率 $\\sigma(x,y)$ 是各向同性的，且不存在磁源。从法拉第定律 $\\nabla \\times \\mathbf{E} = -i \\omega \\mu \\mathbf{H}$ 和安培定律 $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E} + \\mathbf{J}_s$ (忽略位移电流 $\\omega \\epsilon \\mathbf{E}$) 出发，在 TE 条件和常数 $\\mu$ 的情况下，该系统可以简化为标量偏微分方程\n$$\n-\\nabla^2 E_z(x,y) + i \\,\\omega\\, \\mu\\, \\sigma(x,y)\\, E_z(x,y) = J_z(x,y),\n$$\n其中 $J_z$ 是平面外外加电流源密度，$\\omega$ 是角频率（单位：弧度/秒），$\\mu$ 是磁导率（单位：亨利/米），$\\sigma$ 是电导率（单位：西门子/米）。\n\n通过在内部网格上对 $-\\nabla^2$ 进行五点二阶有限差分 (FD) 离散化，并施加齐次狄利克雷边界条件 $E_z=0$ on $\\partial \\Omega$，定义离散算子 $A(\\sigma,\\omega) \\in \\mathbb{C}^{N \\times N}$，然后将反应项 $i \\omega \\mu \\sigma$ 作为对角矩阵加入。令 $u \\in \\mathbb{C}^{N}$ 为如下方程的离散解\n$$\nA(\\sigma,\\omega)\\, u = b,\n$$\n其中 $b \\in \\mathbb{C}^{N}$ 是代表 $J_z$ 的离散源。令 $P \\in \\mathbb{R}^{M \\times N}$ 是一个在 $M$ 个接收点索引处提取场的线性投影，并定义实值数据失配目标函数\n$$\n\\Phi(\\sigma) = \\tfrac{1}{2}\\, \\| P u - d \\|_2^2 = \\tfrac{1}{2} \\sum_{k=1}^{M} |(P u)_k - d_k|^2,\n$$\n其中 $d \\in \\mathbb{C}^M$ 是从“真实”电导率场 $\\sigma_{\\mathrm{true}}$ 计算得到的观测数据。\n\n您的任务是为 TE 方程实现一个可微的麦克斯韦求解器，该求解器针对指定的测试用例，计算解 $u$，评估目标函数 $\\Phi$，使用伴随状态法计算其关于电导率的梯度 $\\nabla_\\sigma \\Phi$，通过交换源和接收点的位置来验证互易性，并探究当 $\\omega \\to 0$ 时的梯度病态问题。\n\n从基本的麦克斯韦方程组及其 TE 简化形式出发，推导复值线性算子的伴随状态系统，并在代码中实现梯度计算，而不使用任何预先推导的简化公式。具体来说，以控制线性系统 $A(\\sigma,\\omega) u = b$ 为基础，使用链式法则进行微分，并通过适当的共轭处理实值目标函数和复数场，以确保正确的伴随性。应使用互易介质的离散算子在转置下的对称性质来检验互易性。\n\n物理单位和数值设置：\n- 角频率 $\\omega$ 的单位必须是弧度/秒。\n- 磁导率 $\\mu$ 的单位必须是亨利/米。\n- 电导率 $\\sigma$ 的单位必须是西门子/米。\n- 空间长度的单位必须是米。\n\n测试套件的离散化和域规范：\n- 边长为 $L_x = L_y = 1\\,\\mathrm{m}$ 的正方形域。\n- 具有 $N_x = N_y = 30$ 个点的内部 FD 网格；齐次狄利克雷边界条件 $E_z=0$。\n- 网格间距 $h_x = L_x/(N_x+1)$ 和 $h_y = L_y/(N_y+1)$。\n- 磁导率 $\\mu = \\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$。\n- 基础试验电导率 $\\sigma_0(x,y) = 0.1\\,\\mathrm{S/m}$ (均匀)。\n- 真实电导率 $\\sigma_{\\mathrm{true}}(x,y)$ 为 $0.1\\,\\mathrm{S/m}$，外加一个位于以 $(0.6\\,\\mathrm{m},\\,0.4\\,\\mathrm{m})$ 为中心、半径为 $0.15\\,\\mathrm{m}$ 的圆盘内的 $0.5\\,\\mathrm{S/m}$ 的异常体。\n- 单个外加电流源 $b$ 是一个位于最接近 $(0.25\\,L_x,\\,0.75\\,L_y)$ 的内部节点上的单位振幅点源。\n- 接收器是三个最接近 $(0.75\\,L_x,\\,0.25\\,L_y)$、$(0.5\\,L_x,\\,0.5\\,L_y)$ 和 $(0.25\\,L_x,\\,0.25\\,L_y)$ 的内部节点。\n\n伴随梯度和检验：\n- 对每个频率，通过求解 $A(\\sigma_{\\mathrm{true}},\\omega) u_{\\mathrm{true}} = b$ 并设置 $d = P u_{\\mathrm{true}}$ 来构建 $d$。\n- 通过求解与线性化目标函数相关联的共轭转置系统，计算伴随状态向量。\n- 计算梯度 $\\nabla_\\sigma \\Phi$ 并报告其欧几里得范数 $\\|\\nabla_\\sigma \\Phi\\|_2$。\n- 通过在第一个接收器位置设置源并测量原始源位置处的场来求解正演问题，并将其与在第一个接收器位置测量的原始正演解进行比较，从而验证互易性。报告一个布尔值，指示相对差异是否低于指定的容差。\n\n方向有限差分梯度检验：\n- 生成一个范数为1的可复现随机方向 $v \\in \\mathbb{R}^{N}$。\n- 对于给定的 $ \\varepsilon = 10^{-4}$ 西门子/米的小扰动幅度，计算中心有限差分方向导数 $(\\Phi(\\sigma_0 + \\varepsilon v) - \\Phi(\\sigma_0 - \\varepsilon v))/(2\\varepsilon)$，并将其与内积 $\\nabla_\\sigma \\Phi(\\sigma_0) \\cdot v$ 进行比较。以浮点数形式报告相对误差。\n\n测试套件：\n- 测试 1 (互易性，常规情况)：$\\omega = 10\\,\\mathrm{rad/s}$，均匀 $\\sigma = 0.1\\,\\mathrm{S/m}$；使用 $10^{-8}$ 的相对容差报告互易性的布尔值。\n- 测试 2 (伴随梯度检验，常规情况)：$\\omega = 10\\,\\mathrm{rad/s}$；以浮点数形式报告伴随方向导数和有限差分方向导数之间的相对误差。\n- 测试 3 (伴随梯度检验，低频)：$\\omega = 10^{-6}\\,\\mathrm{rad/s}$；以浮点数形式报告伴随导数和有限差分导数之间的相对误差。\n- 测试 4 (梯度病态幅值，低频)：$\\omega = 10^{-6}\\,\\mathrm{rad/s}$；以浮点数形式报告欧几里得范数 $\\|\\nabla_\\sigma \\Phi\\|_2$。\n- 测试 5 (零频时的梯度病态)：$\\omega = 0\\,\\mathrm{rad/s}$；以浮点数形式报告欧几里得范数 $\\|\\nabla_\\sigma \\Phi\\|_2$，其值应恰好为零。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含测试套件的五个结果，以逗号分隔的列表形式封装在方括号中，并按上述顺序排列。类型必须是 $[\\text{boolean}, \\text{float}, \\text{float}, \\text{float}, \\text{float}]$。例如：\"[True,1e-8,2.3e-6,0.12,0.0]\"。", "solution": "用户提供了一个有效的、适定的计算地球物理学问题。任务是为准静态近似下的二维横电 (TE) 麦克斯韦方程组实现一个可微求解器，使用伴随状态法计算数据失配目标函数关于电导率的梯度，并执行多项数值验证。\n\n### 1. 控制方程与离散化\n平面外电场 $E_z(x,y)$ 的控制偏微分方程 (PDE) 如下：\n$$\n-\\nabla^2 E_z(x,y) + i \\omega \\mu \\sigma(x,y) E_z(x,y) = J_z(x,y)\n$$\n此处，$\\omega$ 是角频率，$\\mu$ 是磁导率（假设为常数），$\\sigma(x,y)$ 是电导率，$J_z(x,y)$ 是源电流密度。我们在具有 $N_x \\times N_y$ 个内部点的二维均匀网格上离散化该方程，并施加齐次狄利克雷边界条件。未知数的总数为 $N = N_x N_y$。空间域为 $\\Omega = [0, L_x] \\times [0, L_y]$，网格间距为 $h_x = L_x/(N_x+1)$ 和 $h_y = L_y/(N_y+1)$。内部网格节点上的场值由向量 $u \\in \\mathbb{C}^N$ 表示，其中 $u_k$ 对应于第 $k$ 个节点上的 $E_z$。\n\n拉普拉斯算子 $-\\nabla^2$ 使用二阶五点有限差分格式进行近似。这种离散化产生一个实对称正定矩阵 $K \\in \\mathbb{R}^{N \\times N}$。项 $i \\omega \\mu \\sigma(x,y) E_z(x,y)$ 由对角矩阵 $i \\omega \\mu \\Sigma$ 表示，其中 $\\Sigma = \\text{diag}(\\sigma_1, \\sigma_2, \\ldots, \\sigma_N)$ 是一个包含每个网格节点上电导率值的对角矩阵。离散源 $J_z$ 由向量 $b \\in \\mathbb{C}^N$ 表示。\n\n由此产生的离散化系统是一个线性方程组：\n$$\nA(\\sigma, \\omega) u = b\n$$\n其中系统矩阵 $A(\\sigma, \\omega) \\in \\mathbb{C}^{N \\times N}$ 由下式给出：\n$$\nA(\\sigma, \\omega) = K + i \\omega \\mu \\Sigma\n$$\n该矩阵是复数、稀疏且对称的（因为 $K$ 和 $\\Sigma$ 都是对称的）。对于 $\\omega > 0$ 和 $\\sigma > 0$，它是非奇异的，保证了唯一解 $u = A^{-1} b$ 的存在。\n\n### 2. 目标函数与通过伴随状态法计算梯度\n目标是求解实值数据失配目标函数 $\\Phi(\\sigma)$ 相对于电导率向量 $\\sigma \\in \\mathbb{R}^N$ 的梯度：\n$$\n\\Phi(\\sigma) = \\frac{1}{2} \\| P u - d \\|_2^2 = \\frac{1}{2} (P u - d)^H (P u - d)\n$$\n此处，$P \\in \\mathbb{R}^{M \\times N}$ 是一个在 $M$ 个接收点位置选择场值的投影矩阵，$d \\in \\mathbb{C}^M$ 是观测数据向量。解向量 $u$ 是 $\\sigma$ 的隐函数，即 $u=u(\\sigma)$。\n\n我们使用伴随状态法计算梯度 $\\nabla_\\sigma \\Phi$。电导率的一个小扰动 $\\delta \\sigma$ 会导致场的一个扰动 $\\delta u$ 和目标函数的一个扰动 $\\delta \\Phi$。$\\Phi$ 的一阶变化由其 Gâteaux 导数给出：\n$$\n\\delta \\Phi = \\text{Re} \\left[ (P u - d)^H P \\delta u \\right]\n$$\n为了找到 $\\delta u$ 和 $\\delta \\sigma$ 之间的关系，我们对状态方程 $A u = b$ 进行微分：\n$$\n\\delta(A u) = (\\delta A) u + A (\\delta u) = 0\n$$\n这里假设源 $b$ 与 $\\sigma$ 无关。由此得出 $\\delta u = -A^{-1} (\\delta A) u$。将此代入 $\\delta \\Phi$ 的表达式中：\n$$\n\\delta \\Phi = -\\text{Re} \\left[ (P u - d)^H P (-A^{-1} (\\delta A) u) \\right] = -\\text{Re} \\left[ (P u - d)^H P A^{-1} (\\delta A) u \\right]\n$$\n利用性质 $(X Y)^H = Y^H X^H$，我们可以将其改写为：\n$$\n\\delta \\Phi = -\\text{Re} \\left[ \\left( (A^H)^{-1} P^T (P u - d) \\right)^H (\\delta A) u \\right]\n$$\n我们将伴随状态向量 $\\lambda \\in \\mathbb{C}^N$ 定义为伴随方程的解：\n$$\nA^H \\lambda = P^T (P u - d)\n$$\n其中 $A^H = \\bar{A}^T$ 是 $A$ 的厄米共轭（或共轭转置）。根据此定义，目标函数的变化简化为：\n$$\n\\delta \\Phi = -\\text{Re} \\left[ \\lambda^H (\\delta A) u \\right]\n$$\n由扰动 $\\delta \\sigma$ 引起的算子 $A$ 的扰动为 $\\delta A = A(\\sigma+\\delta\\sigma) - A(\\sigma) = i \\omega \\mu \\, \\text{diag}(\\delta \\sigma)$。代入此表达式：\n$$\n\\delta \\Phi = -\\text{Re} \\left[ \\lambda^H (i \\omega \\mu \\, \\text{diag}(\\delta \\sigma)) u \\right]\n$$\n实部内的项是一个标量积，可以展开为：\n$$\n\\lambda^H (i \\omega \\mu \\, \\text{diag}(\\delta \\sigma)) u = \\sum_{j=1}^N \\bar{\\lambda}_j (i \\omega \\mu \\, \\delta \\sigma_j) u_j = i \\omega \\mu \\sum_{j=1}^N \\bar{\\lambda}_j u_j \\delta \\sigma_j\n$$\n由于扰动 $\\delta \\sigma_j$ 是实数，取该表达式的实部可得：\n$$\n\\delta \\Phi = -\\text{Re} \\left[ i \\omega \\mu \\sum_{j=1}^N \\bar{\\lambda}_j u_j \\delta \\sigma_j \\right] = \\sum_{j=1}^N \\left( \\omega \\mu \\, \\text{Im}[\\bar{\\lambda}_j u_j] \\right) \\delta \\sigma_j\n$$\n根据定义，全微分是 $\\delta \\Phi = (\\nabla_\\sigma \\Phi)^T \\delta \\sigma = \\sum_{j=1}^N (\\nabla_\\sigma \\Phi)_j \\delta \\sigma_j$。通过比较这两个表达式，我们得到梯度的分量：\n$$\n(\\nabla_\\sigma \\Phi)_j = \\omega \\mu \\, \\text{Im}(\\bar{u}_j \\lambda_j)\n$$\n因此，计算过程如下：\n1. 对于给定的模型 $\\sigma$，求解正演问题 $A(\\sigma) u = b$ 以获得场 $u$。\n2. 计算数据残差 $r = P u - d$。\n3. 计算伴随源 $q = P^T r$。\n4. 求解伴随问题 $A(\\sigma)^H \\lambda = q$ 以获得伴随场 $\\lambda$。\n5. 使用分量公式 $(\\nabla_\\sigma \\Phi)_j = \\omega \\mu \\, \\text{Im}(\\bar{u}_j \\lambda_j)$ 组装梯度向量。\n\n### 3. 互易性验证\n对于互易介质，系统矩阵 $A$ 是对称的 ($A=A^T$)，这意味着其逆矩阵也是对称的，即 $(A^{-1})=(A^{-1})^T$。假设源是位于节点 $s$ 的单位脉冲，$b=e_s$，接收点位于节点 $r$。测得的场为 $u_r = (A^{-1} e_s)_r = (A^{-1})_{rs}$。如果我们交换源和接收点的位置，源变为 $b'=e_r$，并在节点 $s$ 测量场，得到 $u'_s = (A^{-1} e_r)_s = (A^{-1})_{sr}$。由于 $A^{-1}$ 是对称的，$(A^{-1})_{rs} = (A^{-1})_{sr}$，这意味着 $u_r = u'_s$。此性质通过数值方法进行验证。\n\n### 4. 通过有限差分进行梯度检验\n通过将其方向导数与有限差分近似值进行比较，可以验证伴随状态梯度的正确性。$\\Phi$ 在 $\\sigma_0$ 点沿随机方向 $v$ 的方向导数由内积 $D_v \\Phi = \\nabla_\\sigma \\Phi(\\sigma_0) \\cdot v$ 给出。中心有限差分近似提供了一个基准：\n$$\nD_v \\Phi \\approx \\frac{\\Phi(\\sigma_0 + \\varepsilon v) - \\Phi(\\sigma_0 - \\varepsilon v)}{2\\varepsilon}\n$$\n其中 $\\varepsilon$ 是一个小扰动。基于伴随法和有限差分法的导数之间的相对误差可用于验证实现。\n\n### 5. 低频梯度病态问题\n推导出的梯度表达式 $(\\nabla_\\sigma \\Phi)_j = \\omega \\mu \\, \\text{Im}(\\bar{u}_j \\lambda_j)$ 包含一个角频率 $\\omega$ 的显式因子。这意味着当 $\\omega \\to 0$ 时，梯度幅值趋近于零。在直流极限（$\\omega=0$）下，控制方程变为 $-\\nabla^2 E_z = J_z$，该方程与电导率 $\\sigma$ 无关。因此，解 $u$ 对 $\\sigma$ 的变化不敏感。如果真实数据 $d$ 也是在 $\\omega=0$ 时生成的，那么 $d$ 也与 $\\sigma_{\\mathrm{true}}$ 无关。这将导致 $u(\\sigma_0)$ 与 $u_{\\text{true}}$ 相同，数据残差为零，目标函数值为零，梯度也为零。这种病态行为是地球物理电磁反演中的一个关键挑战，通过计算一个非常小的 $\\omega$ 和 $\\omega=0$ 时的 $\\|\\nabla_\\sigma \\Phi\\|_2$ 来展示。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags, eye, kron\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem and generate results for all test cases.\n    It sets up the geophysical EM problem, computes solutions and gradients\n    using the adjoint-state method, and performs specified numerical checks.\n    \"\"\"\n    # ------------------\n    # 1. Setup and Discretization\n    # ------------------\n    # Physical and domain constants\n    Lx, Ly = 1.0, 1.0\n    Nx, Ny = 30, 30\n    mu0 = 4.0 * np.pi * 1e-7  # H/m\n    \n    # Grid parameters\n    hx, hy = Lx / (Nx + 1), Ly / (Ny + 1)\n    N = Nx * Ny\n    \n    # Create grid coordinates\n    x_coords = np.linspace(hx, Lx - hx, Nx)\n    y_coords = np.linspace(hy, Ly - hy, Ny)\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='ij')\n    grid_coords = np.vstack([xx.ravel(), yy.ravel()]).T\n\n    def get_closest_node_idx(pos):\n        \"\"\"Finds the 1D index of the grid node closest to a given (x,y) position.\"\"\"\n        return np.argmin(np.linalg.norm(grid_coords - np.array(pos), axis=1))\n\n    # Source and Receiver locations\n    source_pos = (0.25 * Lx, 0.75 * Ly)\n    receiver_pos = [(0.75 * Lx, 0.25 * Ly), (0.5 * Lx, 0.5 * Ly), (0.25 * Lx, 0.25 * Ly)]\n    \n    source_idx = get_closest_node_idx(source_pos)\n    receiver_indices = [get_closest_node_idx(p) for p in receiver_pos]\n    \n    # Source vector b\n    b = np.zeros(N, dtype=np.complex128)\n    b[source_idx] = 1.0\n\n    # Projection operator P\n    P = eye(N, format='csr')[receiver_indices]\n\n    # Conductivity models\n    sigma0_val = 0.1  # S/m\n    sigma_true_val = 0.1 # S/m\n    anomaly_val = 0.5 # S/m\n    anomaly_center = np.array([0.6, 0.4]) # m\n    anomaly_radius = 0.15 # m\n\n    sigma0 = np.full(N, sigma0_val)\n    \n    sigma_true = np.full(N, sigma_true_val)\n    dist_from_center = np.linalg.norm(grid_coords - anomaly_center, axis=1)\n    sigma_true[dist_from_center  anomaly_radius] += anomaly_val\n\n    # Construct the discrete Laplacian K = -nabla^2\n    Dxx_1d = diags([-1, 2, -1], [-1, 0, 1], shape=(Nx, Nx), format='csr') / hx**2\n    Dyy_1d = diags([-1, 2, -1], [-1, 0, 1], shape=(Ny, Ny), format='csr') / hy**2\n    K = kron(Dxx_1d, eye(Ny)) + kron(eye(Nx), Dyy_1d)\n\n    def get_system_matrix(sigma, omega, mu):\n        \"\"\"Constructs the complex system matrix A = K + i*omega*mu*Sigma.\"\"\"\n        Sigma = diags(sigma, 0, shape=(N, N), format='csr')\n        return K + 1j * omega * mu * Sigma\n\n    # ------------------\n    # 2. Test Case Execution\n    # ------------------\n    results = []\n    \n    # Test 1: Reciprocity\n    omega_test1 = 10.0  # rad/s\n    sigma_test1 = np.full(N, 0.1)\n    \n    A_recip = get_system_matrix(sigma_test1, omega_test1, mu0)\n    \n    b_orig = np.zeros(N, dtype=np.complex128)\n    b_orig[source_idx] = 1.0\n    u_orig = spsolve(A_recip, b_orig)\n    val_at_rec = u_orig[receiver_indices[0]]\n    \n    b_swap = np.zeros(N, dtype=np.complex128)\n    b_swap[receiver_indices[0]] = 1.0\n    u_swap = spsolve(A_recip, b_swap)\n    val_at_src = u_swap[source_idx]\n    \n    reciprocity_tol = 1e-8\n    reciprocity_error = np.abs(val_at_rec - val_at_src) / np.abs(val_at_rec)\n    results.append(reciprocity_error  reciprocity_tol)\n\n    def run_gradient_calculation(omega, sigma_model, sigma_true_model, src_vec):\n        \"\"\"Calculates forward/adjoint fields and the gradient.\"\"\"\n        # Generate true data d\n        A_true = get_system_matrix(sigma_true_model, omega, mu0)\n        u_true = spsolve(A_true, src_vec, use_umfpack=False) # Use SuperLU for stability\n        d = P @ u_true\n\n        # Forward solve for the model\n        A_model = get_system_matrix(sigma_model, omega, mu0)\n        u_model = spsolve(A_model, src_vec, use_umfpack=False)\n        \n        # Adjoint solve\n        residual = P @ u_model - d\n        adjoint_source = P.T @ residual\n        \n        AH = A_model.conj().T\n        lamb = spsolve(AH, adjoint_source, use_umfpack=False)\n        \n        # Gradient\n        grad = omega * mu0 * np.imag(np.conj(u_model) * lamb)\n        \n        return grad, u_model, d\n\n    def check_gradient_fd(omega, grad_adj, d, sigma_model, src_vec):\n        \"\"\"Performs a finite-difference check on the gradient.\"\"\"\n        np.random.seed(0) # For reproducible random direction\n        v = np.random.randn(N)\n        v /= np.linalg.norm(v)\n        \n        eps = 1e-4  # S/m\n        \n        # Perturb sigma\n        sigma_plus = sigma_model + eps * v\n        sigma_minus = sigma_model - eps * v\n        \n        # Evaluate objective function Phi at perturbed sigmas\n        A_plus = get_system_matrix(sigma_plus, omega, mu0)\n        u_plus = spsolve(A_plus, src_vec, use_umfpack=False)\n        phi_plus = 0.5 * np.linalg.norm(P @ u_plus - d)**2\n        \n        A_minus = get_system_matrix(sigma_minus, omega, mu0)\n        u_minus = spsolve(A_minus, src_vec, use_umfpack=False)\n        phi_minus = 0.5 * np.linalg.norm(P @ u_minus - d)**2\n        \n        # Compare directional derivatives\n        grad_fd_dot_v = (phi_plus - phi_minus) / (2.0 * eps)\n        grad_adj_dot_v = grad_adj.dot(v)\n        \n        if np.abs(grad_fd_dot_v)  1e-15:\n            return 0.0 if np.abs(grad_adj_dot_v)  1e-15 else np.inf\n        \n        rel_error = np.abs(grad_fd_dot_v - grad_adj_dot_v) / np.abs(grad_fd_dot_v)\n        return rel_error\n\n    # Test 2: Adjoint gradient check (happy path)\n    omega_test2 = 10.0  # rad/s\n    grad_2, u_2, d_2 = run_gradient_calculation(omega_test2, sigma0, sigma_true, b)\n    rel_error_2 = check_gradient_fd(omega_test2, grad_2, d_2, sigma0, b)\n    results.append(rel_error_2)\n    \n    # Test 3: Adjoint gradient check (low frequency)\n    omega_test3 = 1e-6  # rad/s\n    grad_3, u_3, d_3 = run_gradient_calculation(omega_test3, sigma0, sigma_true, b)\n    rel_error_3 = check_gradient_fd(omega_test3, grad_3, d_3, sigma0, b)\n    results.append(rel_error_3)\n\n    # Test 4: Gradient pathology magnitude (low frequency)\n    # The gradient was computed in Test 3\n    grad_norm_4 = np.linalg.norm(grad_3)\n    results.append(grad_norm_4)\n    \n    # Test 5: Gradient pathology at zero frequency\n    omega_test5 = 0.0  # rad/s\n    grad_5, _, _ = run_gradient_calculation(omega_test5, sigma0, sigma_true, b)\n    grad_norm_5 = np.linalg.norm(grad_5)\n    results.append(grad_norm_5)\n\n    # ------------------\n    # 3. Final Output\n    # ------------------\n    print(f\"[{results[0]},{results[1]},{results[2]},{results[3]},{results[4]}]\")\n\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3610028"}]}