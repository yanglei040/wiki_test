{"hands_on_practices": [{"introduction": "在实现复杂的数值模型之前，通过解析的视角来理解弹塑性材料的基本行为至关重要。本练习 [@problem_id:3588540] 将指导您使用带线性硬化的 von Mises ($J_2$) 塑性模型，推导材料在循环单轴载荷下的精确应力-应变响应。掌握这一基准问题不仅能让您深入理解屈服、硬化和弹性卸载等概念，也为验证您自己的数值代码提供了必不可少的工具。", "problem": "考虑一个用于验证具有线性各向同性硬化的各向同性 von Mises ($J_{2}$) 塑性模型的径向返回映射算法实现的小应变单轴拉伸/压缩基准问题。该材料是线性弹性-理想塑性-硬化材料，其杨氏模量为 $E$，初始屈服应力为 $\\sigma_{y0}$，硬化模量为 $H$（各向同性硬化）。采用标准的 von Mises 屈服函数、关联流动法则以及等效塑性应变的常规定义。假设行为是等温、率无关的，并忽略几何非线性（小变形）。\n\n设计以下基准问题，并从第一性原理推导解析预测：\n\n- 材料参数：$E = 60 \\,\\mathrm{GPa}$，$\\sigma_{y0} = 200 \\,\\mathrm{MPa}$，$H = 1.2 \\,\\mathrm{GPa}$。在此设定下，可以假设泊松比不影响单轴轴向应力的预测。\n- 加载路径（总轴向应变控制）：\n  1) 从零单调拉伸至 $\\epsilon_{1} = 0.010$，\n  2) 卸载至 $\\epsilon_{2} = 0.004$，\n  3) 反向加载进入压缩状态至 $\\epsilon_{3} = -0.004$。\n\n从下述定义出发：小应变运学、线性弹性、von Mises ($J_{2}$) 屈服函数、关联流动和一致性条件，推导此路径下的单轴应力-应变响应。然后，使用您推导出的表达式，计算路径终点（在 $\\epsilon = \\epsilon_{3}$ 处）的最终轴向柯西应力。以 $\\mathrm{MPa}$ 为单位表示最终答案，并将答案四舍五入至四位有效数字。", "solution": "该问题被评估为有效，因为它描述了连续介质塑性理论中一个标准的、良态的基准问题，该问题基于科学公认的原理，并提供了一套完整的参数和条件。\n\n该解答是通过分析指定加载路径三个阶段的应力-应变响应，从第一性原理推导出来的。\n\n首先，我们建立单轴加载的本构框架。材料受小应变运学支配，其中总应变张量 $\\boldsymbol{\\epsilon}$ 是弹性部分 $\\boldsymbol{\\epsilon}^e$ 和塑性部分 $\\boldsymbol{\\epsilon}^p$ 的和：$\\boldsymbol{\\epsilon} = \\boldsymbol{\\epsilon}^e + \\boldsymbol{\\epsilon}^p$。\n\n对于单轴应力状态，柯西应力张量为 $\\boldsymbol{\\sigma} = \\sigma \\mathbf{e}_1 \\otimes \\mathbf{e}_1$，其中 $\\sigma$ 是轴向应力。\nvon Mises 等效应力 $\\sigma_{eq}$ 定义为 $\\sigma_{eq} = \\sqrt{\\frac{3}{2}\\mathbf{s}:\\mathbf{s}}$，其中 $\\mathbf{s}$ 是偏应力张量。对于单轴情况，该式简化为 $\\sigma_{eq} = |\\sigma|$。\n具有线性各向同性硬化的 von Mises 塑性模型的屈服函数 $f$ 由下式给出：\n$$f(\\sigma, \\bar{\\epsilon}^p) = |\\sigma| - \\sigma_y(\\bar{\\epsilon}^p) = |\\sigma| - (\\sigma_{y0} + H \\bar{\\epsilon}^p) \\le 0$$\n其中 $\\sigma_{y0}$ 是初始屈服应力， $H$ 是硬化模量，$\\bar{\\epsilon}^p$ 是等效塑性应变，一个衡量累积塑性变形的标量。\n\n弹性响应由轴向分量的胡克定律支配：$\\sigma = E \\epsilon^e$，其中 $E$ 是杨氏模量。\n塑性流动由关联流动法则支配，对于单轴加载，该法则简化为 $\\dot{\\bar{\\epsilon}}^p = |\\dot{\\epsilon}^p|$，其中 $\\dot{\\epsilon}^p$ 是轴向塑性应变率。\n\n在塑性加载期间（当 $f=0$ 时），必须保持一致性条件 $\\dot{f}=0$。对于单调拉伸加载（$\\sigma > 0$），这给出 $\\dot{\\sigma} - H \\dot{\\bar{\\epsilon}}^p = 0$。将此与应变分解的率形式和胡克定律相结合，我们推导出塑性区的切线模量 $E_T$：\n$$\\frac{d\\sigma}{d\\epsilon} = E_T = \\frac{EH}{E+H}$$\n\n给定的材料参数为：\n$E = 60 \\,\\mathrm{GPa} = 60000 \\,\\mathrm{MPa}$\n$\\sigma_{y0} = 200 \\,\\mathrm{MPa}$\n$H = 1.2 \\,\\mathrm{GPa} = 1200 \\,\\mathrm{MPa}$\n\n由此，我们可以计算塑性切线模量：\n$$E_T = \\frac{60000 \\times 1200}{60000 + 1200} = \\frac{72000000}{61200} = \\frac{20000}{17} \\,\\mathrm{MPa}$$\n\n分析过程是通过追踪状态变量 $(\\epsilon, \\sigma, \\bar{\\epsilon}^p)$ 在整个加载路径上的变化来进行的。\n\n**路径 1：单调拉伸至 $\\epsilon_1 = 0.010$**\n材料首先弹性加载。当 $\\sigma = \\sigma_{y0}$ 时开始屈服。屈服应变 $\\epsilon_y$ 为：\n$$\\epsilon_y = \\frac{\\sigma_{y0}}{E} = \\frac{200}{60000} = \\frac{1}{300} \\approx 0.00333$$\n由于目标应变 $\\epsilon_1 = 0.010 > \\epsilon_y$，材料将发生塑性变形。对于 $\\epsilon > \\epsilon_y$，应力由下式给出：\n$$\\sigma(\\epsilon) = \\sigma_{y0} + E_T(\\epsilon - \\epsilon_y)$$\n在此路径的终点（点1），应力 $\\sigma_1$ 为：\n$$\\sigma_1 = 200 + \\frac{20000}{17} \\left(0.010 - \\frac{1}{300}\\right) = 200 + \\frac{20000}{17} \\left(\\frac{1}{100} - \\frac{1}{300}\\right) = 200 + \\frac{20000}{17} \\left(\\frac{2}{300}\\right) = 200 + \\frac{400}{51} = \\frac{10600}{51} \\,\\mathrm{MPa}$$\n此点的累积等效塑性应变 $\\bar{\\epsilon}^p_1$ 可从硬化定律求得：\n$$\\sigma_1 = \\sigma_{y0} + H \\bar{\\epsilon}^p_1 \\implies \\bar{\\epsilon}^p_1 = \\frac{\\sigma_1 - \\sigma_{y0}}{H} = \\frac{\\frac{10600}{51} - 200}{1200} = \\frac{\\frac{400}{51}}{1200} = \\frac{1}{153}$$\n当前的屈服强度是 $\\sigma_{y,1} = \\sigma_1 = \\frac{10600}{51} \\,\\mathrm{MPa}$。\n\n**路径 2：卸载至 $\\epsilon_2 = 0.004$**\n卸载是纯弹性的，所以应力-应变关系遵循一条从 $(\\epsilon_1, \\sigma_1)$ 开始、斜率为 $E$ 的直线：\n$$\\sigma(\\epsilon) = \\sigma_1 + E(\\epsilon - \\epsilon_1)$$\n点2处的应力 $\\sigma_2$ 为：\n$$\\sigma_2 = \\sigma_1 + E(\\epsilon_2 - \\epsilon_1) = \\frac{10600}{51} + 60000(0.004 - 0.010) = \\frac{10600}{51} - 360 = \\frac{10600 - 18360}{51} = -\\frac{7760}{51} \\,\\mathrm{MPa}$$\n在弹性卸载期间，塑性应变不改变，所以 $\\bar{\\epsilon}^p_2 = \\bar{\\epsilon}^p_1 = 1/153$。由于各向同性硬化，屈服面已经扩大，屈服强度保持在 $\\sigma_{y,2} = \\sigma_{y,1} = \\frac{10600}{51} \\,\\mathrm{MPa}$。\n我们检查是否发生反向屈服。受压屈服将在 $\\sigma = -\\sigma_{y,2}$ 时开始。我们求出发生这种情况时的应变 $\\epsilon_{yc}$：\n$$-\\sigma_{y,2} = \\sigma_1 + E(\\epsilon_{yc} - \\epsilon_1) \\implies \\epsilon_{yc} = \\epsilon_1 - \\frac{\\sigma_1+\\sigma_{y,2}}{E} = \\epsilon_1 - \\frac{2\\sigma_1}{E}$$\n$$\\epsilon_{yc} = 0.010 - \\frac{2 \\times \\frac{10600}{51}}{60000} = \\frac{1}{100} - \\frac{106}{15300} = \\frac{153 - 106}{15300} = \\frac{47}{15300} \\approx 0.00307$$\n因为 $\\epsilon_2 = 0.004 > \\epsilon_{yc}$，所以从点1到点2的路径是完全弹性的。\n\n**路径 3：反向压缩至 $\\epsilon_3 = -0.004$**\n从点2继续加载。材料行为是弹性的，直到应变达到 $\\epsilon_{yc}$。由于最终应变 $\\epsilon_3 = -0.004  \\epsilon_{yc}$，材料将发生受压屈服。\n反向屈服开始时的应力为 $\\sigma_{yc} = -\\sigma_{y,2} = -\\frac{10600}{51} \\,\\mathrm{MPa}$。\n对于应变 $\\epsilon  \\epsilon_{yc}$，材料以切线模量 $E_T$ 进行塑性变形。在 $\\epsilon_3$ 处的最终应力 $\\sigma_3$ 为：\n$$\\sigma_3 = \\sigma_{yc} + E_T(\\epsilon_3 - \\epsilon_{yc})$$\n代入数值：\n$$\\sigma_3 = -\\frac{10600}{51} + \\frac{20000}{17}\\left(-0.004 - \\frac{47}{15300}\\right)$$\n括号中的项是：\n$$-0.004 - \\frac{47}{15300} = -\\frac{1}{250} - \\frac{47}{15300} = \\frac{-61.2 - 47}{15300} = -\\frac{108.2}{15300}$$\n此路径塑性部分的应力变化量是：\n$$\\Delta\\sigma = \\frac{20000}{17} \\left(-\\frac{108.2}{15300}\\right) = \\frac{20000}{17} \\left(-\\frac{108.2}{900 \\times 17}\\right) = -\\frac{200 \\times 108.2}{289 \\times 9} = -\\frac{21640}{2601} \\,\\mathrm{MPa}$$\n最终应力 $\\sigma_3$ 是反向屈服开始时的应力与此塑性应力增量之和：\n$$\\sigma_3 = -\\frac{10600}{51} - \\frac{21640}{2601} = -\\frac{10600 \\times 51}{2601} - \\frac{21640}{2601} = \\frac{-540600 - 21640}{2601} = -\\frac{562240}{2601} \\,\\mathrm{MPa}$$\n现在，我们计算数值：\n$$\\sigma_3 \\approx -216.163014... \\,\\mathrm{MPa}$$\n四舍五入到四位有效数字，我们得到：\n$$\\sigma_3 \\approx -216.2 \\,\\mathrm{MPa}$$", "answer": "$$\\boxed{-216.2}$$", "id": "3588540"}, {"introduction": "许多地球物理材料（如土壤和岩石）的强度取决于围压。Drucker-Prager 模型提供了一种光滑且计算上简便的方法来捕捉这种压力相关的行为。在本练习 [@problem_id:3588499] 中，您将为一个非关联的 Drucker-Prager 模型实现一个返回映射算法，该模型包含了剪胀性的重要影响。这个实践是从简单的压力无关模型过渡到更真实的岩土材料描述的关键一步。", "problem": "您需要在一个计算地球物理学的背景下，为平面应变条件下的非关联Drucker-Prager塑性模型实现一个返回映射算法。目标是利用线性各向同性弹性和经典塑性力学的原理，推导、实现并评估在施加一个无穷小应变增量后，平均（静水）应力 $p^{n+1}$ 和等效（偏）应力 $q^{n+1}$ 的更新过程。该实现必须包括由非关联流动通过剪胀角引起的体积修正。\n\n从以下基本原理出发：\n- 由三维胡克定律定义的线性各向同性弹性，其中包含体积模量 $K$ 和剪切模量 $G$，$K$ 和 $G$ 是杨氏模量 $E$ 和泊松比 $\\nu$ 的函数。回顾关系式 $G = \\dfrac{E}{2(1+\\nu)}$ 和 $K = \\dfrac{E}{3(1-2\\nu)}$，以及三维本构形式 $\\boldsymbol{\\sigma} = 2 G \\boldsymbol{\\varepsilon} + \\lambda \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I}$，其中拉梅参数 $\\lambda = K - \\dfrac{2}{3}G$。\n- 平均应力 $p = \\dfrac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$、偏应力张量 $\\mathbf{s} = \\boldsymbol{\\sigma} - p\\mathbf{I}$、其偏量部分的第二不变量 $J_{2} = \\dfrac{1}{2}\\mathbf{s}:\\mathbf{s}$ 以及等效应力 $q = \\sqrt{3 J_{2}}$ 的定义。\n- Drucker-Prager屈服函数 $f(\\boldsymbol{\\sigma})$，由摩擦角 $\\phi$（单位：度）和内聚力 $c$（单位：帕斯卡）表征；以及一个非关联塑性势 $g(\\boldsymbol{\\sigma})$，由剪胀角 $\\psi$（单位：度）表征。使用经典岩土力学映射，根据Mohr–Coulomb参数来定义Drucker–Prager参数：$\\beta_{\\phi} = \\dfrac{6 \\sin\\phi}{3 - \\sin\\phi}$，$\\beta_{\\psi} = \\dfrac{6 \\sin\\psi}{3 - \\sin\\psi}$ 和 $k = \\dfrac{6 c \\cos\\phi}{3 - \\sin\\phi}$，以及屈服函数形式 $f = q + \\beta_{\\phi} p - k$。\n- 平面应变约束定义为每个增量的 $\\Delta\\varepsilon_{zz} = 0$。采用工程剪应变约定，其中平面内工程剪应变增量 $\\Delta\\gamma_{xy}$ 通过 $\\Delta\\varepsilon_{xy} = \\dfrac{1}{2}\\Delta\\gamma_{xy}$ 与张量剪应变相关联。\n\n从第一性原理出发，推导一个一致的算法，该算法能够：\n1. 在平面应变条件下，使用三维胡克定律，根据应变增量构建弹性试探应力张量 $\\boldsymbol{\\sigma}^{\\text{tr}}$，并计算相应的试探不变量 $p^{\\text{tr}}$ 和 $q^{\\text{tr}}$。\n2. 评估试探屈服函数 $f^{\\text{tr}} = q^{\\text{tr}} + \\beta_{\\phi} p^{\\text{tr}} - k$，以判断该增量下的响应是弹性的还是塑性的。\n3. 如果是弹性的 ($f^{\\text{tr}} \\leq 0$)，则设置 $p^{n+1} = p^{\\text{tr}}$ 和 $q^{n+1} = q^{\\text{tr}}$。\n4. 如果是塑性的 ($f^{\\text{tr}} > 0$)，则基于塑性势 $g = q + \\beta_{\\psi} p$，使用非关联流动法则强制执行一致性条件 $f(\\boldsymbol{\\sigma}^{n+1}) = 0$，并推导出控制两个不变量修正的标量塑性乘子增量。明确展示由于非零的 $\\beta_{\\psi}$，体积修正是如何进入平均应力 $p^{n+1}$ 的更新过程的，以及偏量修正是如何控制 $q^{n+1}$ 的。\n\n科学真实性要求：\n- 使用压为正的应力符号约定，即压缩时 $p = \\dfrac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$ 为正。\n- 角度 $\\phi$ 和 $\\psi$ 以度为单位提供，在使用三角函数前必须转换为弧度。\n- 所有应力输出必须以帕斯卡（Pascals）表示。应变增量是无量纲的。\n\n您的程序必须实现所述算法，并针对以下测试套件，计算并输出每种情况下的更新不变量 $p^{n+1}$ 和 $q^{n+1}$。假设所有情况下先前的应力状态均为零，因此弹性试探应力是直接通过胡克定律由给定的应变增量形成的。\n\n测试套件（每个情况是一个元组 $(E,\\nu,\\phi,\\psi,c,\\Delta\\varepsilon_{xx},\\Delta\\varepsilon_{yy},\\Delta\\gamma_{xy})$）：\n- 情况A（弹性基准）：$(E = 30\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.25,\\, \\phi = 20^{\\circ},\\, \\psi = 0^{\\circ},\\, c = 20\\times 10^{6}\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 1\\times 10^{-6},\\, \\Delta\\varepsilon_{yy} = 1\\times 10^{-6},\\, \\Delta\\gamma_{xy} = 0)$。\n- 情况B（带剪胀的塑性）：$(E = 30\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.25,\\, \\phi = 30^{\\circ},\\, \\psi = 10^{\\circ},\\, c = 1\\times 10^{6}\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 1\\times 10^{-4},\\, \\Delta\\varepsilon_{yy} = -1\\times 10^{-4},\\, \\Delta\\gamma_{xy} = 2\\times 10^{-4})$。\n- 情况C（无内聚力，零剪胀，纯剪切）：$(E = 70\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.33,\\, \\phi = 35^{\\circ},\\, \\psi = 0^{\\circ},\\, c = 0\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 0,\\, \\Delta\\varepsilon_{yy} = 0,\\, \\Delta\\gamma_{xy} = 5\\times 10^{-4})$。\n- 情况D（近屈服混合加载）：$(E = 30\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.25,\\, \\phi = 25^{\\circ},\\, \\psi = 5^{\\circ},\\, c = 2\\times 10^{6}\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 5\\times 10^{-6},\\, \\Delta\\varepsilon_{yy} = -5\\times 10^{-6},\\, \\Delta\\gamma_{xy} = 1\\times 10^{-5})$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个元素对应一个测试用例，并且必须是一个包含两个元素 $[p^{n+1},q^{n+1}]$（单位：帕斯卡）的列表。例如：$[[p_{A},q_{A}],[p_{B},q_{B}],[p_{C},q_{C}],[p_{D},q_{D}]]$。", "solution": "任务是推导并实现一个在平面应变条件下，用于非关联Drucker-Prager塑性模型的返回映射算法。我们首先验证问题陈述，然后从第一性原理出发推导该算法。\n\n问题陈述中说明压为正。所提供的胡克定律形式 $\\boldsymbol{\\sigma} = 2 G \\boldsymbol{\\varepsilon} + \\lambda \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I}$，结合平均应力 $p = \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$ 的定义，意味着正（拉伸）应变会产生正（拉伸）应力。为了将其与岩土力学中压为正的约定相协调，我们必须假设输入的应变增量 $\\Delta\\varepsilon_{ij}$ 本身也是以压为正来定义的。这种解释确保了正（压缩）应变产生正（压缩）应力，这与屈服函数 $f = q + \\beta_{\\phi} p - k$ 一致，其中更高的压缩压力 $p$ 会增加强度。\n\n推导过程分为三个主要步骤：弹性预测、屈服检查和塑性修正。\n\n**1. 本构关系**\n\n材料行为由线性各向同性弹性和Drucker-Prager塑性控制。\n\n- **线性弹性**: 应力-应变关系由胡克定律给出。用体积模量 $K$ 和剪切模量 $G$ 表示时，体积响应和偏量响应是解耦的：\n$$ p = K \\varepsilon_v $$\n$$ \\mathbf{s} = 2G \\mathbf{e} $$\n其中 $p = \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$ 是平均应力，$\\mathbf{s} = \\boldsymbol{\\sigma} - p\\mathbf{I}$ 是偏应力张量，$\\varepsilon_v = \\mathrm{tr}(\\boldsymbol{\\varepsilon})$ 是体积应变，$\\mathbf{e} = \\boldsymbol{\\varepsilon} - \\frac{1}{3}\\varepsilon_v\\mathbf{I}$ 是偏应变张量。弹性模量通过以下公式与杨氏模量 $E$ 和泊松比 $\\nu$ 相关联：\n$$ G = \\frac{E}{2(1+\\nu)}, \\quad K = \\frac{E}{3(1-2\\nu)} $$\n应力张量也可以使用拉梅第一参数 $\\lambda = K - \\frac{2}{3}G$ 来计算：\n$$ \\boldsymbol{\\sigma} = 2G\\boldsymbol{\\varepsilon} + \\lambda\\varepsilon_v\\mathbf{I} $$\n\n- **Drucker-Prager 模型**: 屈服面和塑性势定义了弹性行为的极限和塑性流动的方向。\n屈服函数 $f$ 为：\n$$ f(\\boldsymbol{\\sigma}) = q + \\beta_{\\phi} p - k = 0 $$\n非关联塑性势 $g$ 为：\n$$ g(\\boldsymbol{\\sigma}) = q + \\beta_{\\psi} p $$\n在这里，$q = \\sqrt{3J_2} = \\sqrt{\\frac{3}{2}\\mathbf{s}:\\mathbf{s}}$ 是等效偏应力。参数 $\\beta_{\\phi}$、$\\beta_{\\psi}$ 和 $k$ 由Mohr-Coulomb摩擦角 $\\phi$（单位：弧度）、剪胀角 $\\psi$（单位：弧度）和内聚力 $c$ 推导得出：\n$$ \\beta_{\\phi} = \\frac{6 \\sin\\phi}{3 - \\sin\\phi}, \\quad \\beta_{\\psi} = \\frac{6 \\sin\\psi}{3 - \\sin\\psi}, \\quad k = \\frac{6 c \\cos\\phi}{3 - \\sin\\phi} $$\n在试探弹性步中，当 $f(\\boldsymbol{\\sigma}) > 0$ 时，发生塑性流动。\n\n**2. 返回映射算法推导**\n\n该算法在给定的应变增量 $\\Delta\\boldsymbol{\\varepsilon}$ 下，从已知状态 $\\boldsymbol{\\sigma}^n$（此处 $\\boldsymbol{\\sigma}^n = \\mathbf{0}$）更新应力状态。\n\n**2.1. 弹性预测步**\n\n首先，我们假设整个应变增量是弹性的，并计算出一个“试探”应力状态 $\\boldsymbol{\\sigma}^{\\text{tr}}$。\n给定施加的平面应变增量 $\\Delta\\varepsilon_{xx}$、$\\Delta\\varepsilon_{yy}$ 和 $\\Delta\\gamma_{xy}$，应变增量张量 $\\Delta\\boldsymbol{\\varepsilon}$ 的分量为：\n$$ \\Delta\\varepsilon_{xx}, \\quad \\Delta\\varepsilon_{yy}, \\quad \\Delta\\varepsilon_{zz} = 0, \\quad \\Delta\\varepsilon_{xy} = \\frac{1}{2}\\Delta\\gamma_{xy}, \\quad \\Delta\\varepsilon_{yz}=0, \\quad \\Delta\\varepsilon_{zx}=0 $$\n体积应变增量为 $\\Delta\\varepsilon_v = \\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon}) = \\Delta\\varepsilon_{xx} + \\Delta\\varepsilon_{yy}$。由于初始应力为零，试探应力直接由胡克定律计算得出：\n$$ \\boldsymbol{\\sigma}^{\\text{tr}} = \\mathbf{C} : \\Delta\\boldsymbol{\\varepsilon} $$\n试探应力张量的分量为：\n$$ \\sigma_{xx}^{\\text{tr}} = 2G\\Delta\\varepsilon_{xx} + \\lambda\\Delta\\varepsilon_v $$\n$$ \\sigma_{yy}^{\\text{tr}} = 2G\\Delta\\varepsilon_{yy} + \\lambda\\Delta\\varepsilon_v $$\n$$ \\sigma_{zz}^{\\text{tr}} = 2G\\Delta\\varepsilon_{zz} + \\lambda\\Delta\\varepsilon_v = \\lambda\\Delta\\varepsilon_v $$\n$$ \\sigma_{xy}^{\\text{tr}} = 2G\\Delta\\varepsilon_{xy} = G\\Delta\\gamma_{xy} $$\n由此，我们计算试探平均应力 $p^{\\text{tr}}$ 和试探等效应力 $q^{\\text{tr}}$：\n$$ p^{\\text{tr}} = \\frac{1}{3}(\\sigma_{xx}^{\\text{tr}} + \\sigma_{yy}^{\\text{tr}} + \\sigma_{zz}^{\\text{tr}}) $$\n$$ \\mathbf{s}^{\\text{tr}} = \\boldsymbol{\\sigma}^{\\text{tr}} - p^{\\text{tr}}\\mathbf{I} $$\n$$ q^{\\text{tr}} = \\sqrt{\\frac{3}{2}\\mathbf{s}^{\\text{tr}}:\\mathbf{s}^{\\text{tr}}} = \\sqrt{\\frac{3}{2}\\left((s_{xx}^{\\text{tr}})^2 + (s_{yy}^{\\text{tr}})^2 + (s_{zz}^{\\text{tr}})^2 + 2(s_{xy}^{\\text{tr}})^2\\right)} $$\n\n**2.2. 屈服检查**\n\n我们在试探状态下评估屈服函数：\n$$ f^{\\text{tr}} = q^{\\text{tr}} + \\beta_{\\phi}p^{\\text{tr}} - k $$\n- 如果 $f^{\\text{tr}} \\leq 0$，则假设正确。该步是弹性的，试探状态即为最终状态：$\\boldsymbol{\\sigma}^{n+1} = \\boldsymbol{\\sigma}^{\\text{tr}}$，因此 $p^{n+1} = p^{\\text{tr}}$ 且 $q^{n+1} = q^{\\text{tr}}$。\n- 如果 $f^{\\text{tr}} > 0$，则试探状态位于屈服面之外。发生塑性变形，需要进行修正。\n\n**2.3. 塑性修正步**\n\n总应变增量被加法分解为弹性和塑性两部分：$\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^e + \\Delta\\boldsymbol{\\varepsilon}^p$。最终应力 $\\boldsymbol{\\sigma}^{n+1}$ 与应变的弹性部分相关：\n$$ \\boldsymbol{\\sigma}^{n+1} = \\mathbf{C}:\\Delta\\boldsymbol{\\varepsilon}^e = \\mathbf{C}:(\\Delta\\boldsymbol{\\varepsilon} - \\Delta\\boldsymbol{\\varepsilon}^p) = \\boldsymbol{\\sigma}^{\\text{tr}} - \\mathbf{C}:\\Delta\\boldsymbol{\\varepsilon}^p $$\n塑性应变增量由非关联流动法则控制，该法则指出它与塑性势 $g$ 的梯度成正比：\n$$ \\Delta\\boldsymbol{\\varepsilon}^p = \\Delta\\gamma \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} $$\n其中 $\\Delta\\gamma$ 是标量塑性乘子。所需的梯度为：\n$$ \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} + \\beta_{\\psi} \\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\mathbf{s} + \\frac{\\beta_{\\psi}}{3}\\mathbf{I} $$\n应力更新方程可以解耦为体积部分和偏量部分：\n$$ p^{n+1} = p^{\\text{tr}} - K \\Delta\\varepsilon_v^p $$\n$$ \\mathbf{s}^{n+1} = \\mathbf{s}^{\\text{tr}} - 2G \\Delta\\mathbf{e}^p $$\n体积塑性应变增量为 $\\Delta\\varepsilon_v^p = \\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon}^p) = \\Delta\\gamma \\mathrm{tr}(\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}) = \\Delta\\gamma \\beta_{\\psi}$。偏塑性应变增量为 $\\Delta\\mathbf{e}^p = \\Delta\\gamma \\frac{3}{2q^{n+1}}\\mathbf{s}^{n+1}$。\n将这些代入更新方程：\n$$ p^{n+1} = p^{\\text{tr}} - K \\Delta\\gamma \\beta_{\\psi} $$\n$$ \\mathbf{s}^{n+1} = \\mathbf{s}^{\\text{tr}} - 2G \\left( \\Delta\\gamma \\frac{3}{2q^{n+1}}\\mathbf{s}^{n+1} \\right) = \\mathbf{s}^{\\text{tr}} - 3G\\Delta\\gamma \\frac{\\mathbf{s}^{n+1}}{q^{n+1}} $$\n从偏量更新中，我们看到 $\\mathbf{s}^{n+1}$ 与 $\\mathbf{s}^{\\text{tr}}$ 共向，这意味着 $\\frac{\\mathbf{s}^{n+1}}{q^{n+1}} = \\frac{\\mathbf{s}^{\\text{tr}}}{q^{\\text{tr}}}$。取偏量更新的模（按 $\\sqrt{3/2}$ 缩放）可得：\n$$ q^{n+1} = q^{\\text{tr}} - 3G\\Delta\\gamma $$\n我们得到了关于一个未知数 $\\Delta\\gamma$ 的两个关于 $p^{n+1}$ 和 $q^{n+1}$ 的方程。最后一步是一致性条件，它要求最终应力状态位于屈服面上：$f(\\boldsymbol{\\sigma}^{n+1}) = 0$。\n$$ q^{n+1} + \\beta_{\\phi}p^{n+1} - k = 0 $$\n代入 $p^{n+1}$ 和 $q^{n+1}$ 的表达式：\n$$ (q^{\\text{tr}} - 3G\\Delta\\gamma) + \\beta_{\\phi}(p^{\\text{tr}} - K\\Delta\\gamma\\beta_{\\psi}) - k = 0 $$\n重新整理以求解 $\\Delta\\gamma$：\n$$ (q^{\\text{tr}} + \\beta_{\\phi}p^{\\text{tr}} - k) - \\Delta\\gamma(3G + K\\beta_{\\phi}\\beta_{\\psi}) = 0 $$\n$$ f^{\\text{tr}} = \\Delta\\gamma(3G + K\\beta_{\\phi}\\beta_{\\psi}) $$\n这给出了塑性乘子的显式表达式：\n$$ \\Delta\\gamma = \\frac{f^{\\text{tr}}}{3G + K\\beta_{\\phi}\\beta_{\\psi}} $$\n已知 $\\Delta\\gamma$后，最终的应力不变量计算如下：\n$$ p^{n+1} = p^{\\text{tr}} - K \\Delta\\gamma \\beta_{\\psi} $$\n$$ q^{n+1} = q^{\\text{tr}} - 3G\\Delta\\gamma $$\n至此完成了返回映射算法的推导。流动 $(\\psi \\neq \\phi)$ 的非关联性质在 $\\Delta\\gamma$ 的分母中引入了 $K\\beta_{\\phi}\\beta_{\\psi}$ 项，并且至关重要的是，通过 $K \\Delta\\gamma \\beta_{\\psi}$ 项将体积应力更新与偏应力屈服耦合起来。如果流动是关联的 $(\\psi = \\phi)$，这个耦合项将是 $K\\beta_{\\phi}^2$。如果剪胀为零 $(\\psi=0)$，则 $\\beta_{\\psi}=0$，平均应力将不被修正 $(p^{n+1} = p^{\\text{tr}})$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to execute the test suite for the Drucker-Prager\n    return-mapping algorithm.\n    \"\"\"\n\n    test_cases = [\n        # Case A (elastic baseline)\n        (30e9, 0.25, 20.0, 0.0, 20e6, 1e-6, 1e-6, 0.0),\n        # Case B (plastic with dilatancy)\n        (30e9, 0.25, 30.0, 10.0, 1e6, 1e-4, -1e-4, 2e-4),\n        # Case C (cohesionless, zero dilatancy, pure shear)\n        (70e9, 0.33, 35.0, 0.0, 0.0, 0.0, 0.0, 5e-4),\n        # Case D (near-yield mixed loading)\n        (30e9, 0.25, 25.0, 5.0, 2e6, 5e-6, -5e-6, 1e-5),\n    ]\n\n    results = []\n    for case in test_cases:\n        p_n1, q_n1 = compute_stress_update(*case)\n        results.append([p_n1, q_n1])\n\n    # Format the final output as specified\n    formatted_results = \",\".join(map(str, results))\n    print(f\"[{formatted_results}]\")\n\ndef compute_stress_update(E, nu, phi_deg, psi_deg, c, deps_xx, deps_yy, dgamma_xy):\n    \"\"\"\n    Implements the return-mapping algorithm for a non-associated\n    Drucker-Prager model under plane strain.\n\n    Args:\n        E (float): Young's modulus (Pa)\n        nu (float): Poisson's ratio\n        phi_deg (float): Friction angle (degrees)\n        psi_deg (float): Dilatancy angle (degrees)\n        c (float): Cohesion (Pa)\n        deps_xx (float): Normal strain increment in x\n        deps_yy (float): Normal strain increment in y\n        dgamma_xy (float): Engineering shear strain increment in xy\n\n    Returns:\n        tuple[float, float]: Updated mean stress p and equivalent stress q.\n    \"\"\"\n    # 1. Convert angles to radians\n    phi = np.radians(phi_deg)\n    psi = np.radians(psi_deg)\n\n    # 2. Calculate elastic moduli\n    G = E / (2.0 * (1.0 + nu))\n    K = E / (3.0 * (1.0 - 2.0 * nu))\n    # Lamé's first parameter\n    lmbda = K - 2.0 * G / 3.0\n\n    # 3. Calculate Drucker-Prager material parameters\n    sin_phi = np.sin(phi)\n    cos_phi = np.cos(phi)\n    \n    # Handle denominator close to zero for small angles (not an issue here)\n    den_phi = 3.0 - sin_phi\n    beta_phi = (6.0 * sin_phi) / den_phi\n    k = (6.0 * c * cos_phi) / den_phi\n\n    sin_psi = np.sin(psi)\n    den_psi = 3.0 - sin_psi\n    beta_psi = (6.0 * sin_psi) / den_psi if psi > 1e-9 else 0.0\n\n    # 4. Form elastic trial state from strain increment\n    # Strain increment tensor components (plane strain condition)\n    deps_zz = 0.0\n    deps_xy = 0.5 * dgamma_xy\n    \n    # Volumetric strain increment\n    deps_vol = deps_xx + deps_yy + deps_zz\n\n    # Trial stress tensor components (initial stress is zero)\n    sigma_xx_tr = 2.0 * G * deps_xx + lmbda * deps_vol\n    sigma_yy_tr = 2.0 * G * deps_yy + lmbda * deps_vol\n    sigma_zz_tr = lmbda * deps_vol\n    sigma_xy_tr = G * dgamma_xy\n    \n    # Trial stress invariants\n    p_tr = (sigma_xx_tr + sigma_yy_tr + sigma_zz_tr) / 3.0\n\n    # Trial deviatoric stress components\n    s_xx_tr = sigma_xx_tr - p_tr\n    s_yy_tr = sigma_yy_tr - p_tr\n    s_zz_tr = sigma_zz_tr - p_tr\n    s_xy_tr = sigma_xy_tr\n\n    # Second invariant of trial deviatoric stress\n    J2_tr = 0.5 * (s_xx_tr**2 + s_yy_tr**2 + s_zz_tr**2 + 2.0 * s_xy_tr**2)\n    # Trial equivalent stress\n    q_tr = np.sqrt(3.0 * J2_tr)\n\n    # 5. Evaluate yield function at trial state\n    f_tr = q_tr + beta_phi * p_tr - k\n\n    # 6. Check for plasticity and apply correction if needed\n    if f_tr = 1e-9:  # Using a small tolerance for floating point comparisons\n        # Elastic response\n        p_n1 = p_tr\n        q_n1 = q_tr\n    else:\n        # Plastic response: apply return-mapping\n        denominator = 3.0 * G + K * beta_phi * beta_psi\n        \n        # Scalar plastic multiplier\n        d_gamma = f_tr / denominator\n        \n        # Update stress invariants\n        p_n1 = p_tr - K * d_gamma * beta_psi\n        q_n1 = q_tr - 3.0 * G * d_gamma\n\n    return p_n1, q_n1\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3588499"}, {"introduction": "与光滑模型相比，Mohr-Coulomb 模型能更准确地描述土壤和岩石的破坏，但其屈服面上的尖锐棱边和角点带来了显著的数值挑战。这个高级实践 [@problem_id:3588544] 要求您开发一个复杂的返回映射算法，以处理 Mohr-Coulomb 屈服面的非光滑几何形状。实现这种“顶点/棱边返回”策略是稳健岩土力学建模的标志，也证明了您已掌握复杂本构律的数值处理方法。", "problem": "您的任务是，在三维、小应变、各向同性弹性的条件下，推导并实现摩尔-库仑 (MC) 弹塑性模型的顶点/边返回映射策略，其中压缩应力为正。该实现必须针对给定的弹性试探状态，判断塑性修正的目标是主应力空间中摩尔-库仑屈服面的一个面、一条边还是顶点，然后计算相应的修正后主应力。您的最终程序必须为指定的测试套件生成数值输出。\n\n请从以下基本原理开始：\n\n- 柯西 (Cauchy) 应力张量的主值表示为 $\\,\\sigma_1\\ge\\sigma_2\\ge\\sigma_3\\,$。\n- 线性各向同性弹性通过胡克 (Hooke) 定律将应力增量和应变增量联系起来，其中体积模量为 $\\,K\\,$，剪切模量为 $\\,G\\,$。四阶弹性张量 $\\,\\mathsf{C}\\,$ 对任意对称二阶张量 $\\,\\mathsf{A}\\,$ 的映射为 $$\\mathsf{C}:\\mathsf{A} \\;=\\; 3K\\,\\frac{\\mathrm{tr}(\\mathsf{A})}{3}\\,\\mathsf{I} \\;+\\; 2G\\,\\left(\\mathsf{A}-\\frac{\\mathrm{tr}(\\mathsf{A})}{3}\\,\\mathsf{I}\\right),$$ 其中 $\\,\\mathsf{I}\\,$ 是单位张量，$\\,\\mathrm{tr}(\\cdot)\\,$ 表示迹。\n- 摩尔-库仑 (Mohr-Coulomb) 屈服条件在与有序主应力相关的平面上表达时是分段线性的。对于由主应力对形成的面，定义三个面函数：\n$$\nf_{12} \\;=\\; (1-\\sin\\varphi)\\,\\sigma_1 \\;-\\; (1+\\sin\\varphi)\\,\\sigma_2 \\;-\\; 2c\\,\\cos\\varphi,\\qquad\nf_{13} \\;=\\; (1-\\sin\\varphi)\\,\\sigma_1 \\;-\\; (1+\\sin\\varphi)\\,\\sigma_3 \\;-\\; 2c\\,\\cos\\varphi,\n$$\n$$\nf_{23} \\;=\\; (1-\\sin\\varphi)\\,\\sigma_2 \\;-\\; (1+\\sin\\varphi)\\,\\sigma_3 \\;-\\; 2c\\,\\cos\\varphi,\n$$\n其中 $\\,\\varphi\\,$ 是摩擦角，$\\,c\\,$ 是黏聚力。当对应的 $\\,f_{ij}0\\,$ 时，一个试探状态违反了某个面。两个被违反的面的交集定义了一条边，而所有三个被违反的面的交集定义了顶点。\n- 采用带有剪胀角 $\\,\\psi\\,$（通常不同于 $\\,\\varphi\\,$）的摩尔-库仑型塑性势。对于每个面，塑性势相对于主应力的梯度提供了流动方向。定义\n$$\na_p \\;=\\; 1-\\sin\\psi,\\qquad b_p \\;=\\; 1+\\sin\\psi,\n$$\n以及主应力坐标系下的塑性势梯度（面流动法向）为\n$$\n\\mathbf{n}^{12} \\;=\\; \\begin{bmatrix} a_p\\\\ -b_p\\\\ 0\\end{bmatrix},\\qquad\n\\mathbf{n}^{13} \\;=\\; \\begin{bmatrix} a_p\\\\ 0\\\\ -b_p\\end{bmatrix},\\qquad\n\\mathbf{n}^{23} \\;=\\; \\begin{bmatrix} 0\\\\ a_p\\\\ -b_p\\end{bmatrix}.\n$$\n在各向同性弹性条件下，由方向为 $\\,\\mathbf{n}\\,$ 的塑性乘子 $\\,\\lambda\\,$ 引起的应力修正是\n$$\n\\Delta\\boldsymbol{\\sigma} \\;=\\; -\\,\\mathsf{C}:\\mathbf{n}\\;\\lambda,\n$$\n在主分量中，这产生一个向量 $\\,\\mathbf{v}\\,$，其分量为\n$$\nv_i \\;=\\; K\\,\\mathrm{tr}(\\mathbf{n}) \\;+\\; 2G\\left(n_i - \\frac{\\mathrm{tr}(\\mathbf{n})}{3}\\right),\\qquad i\\in\\{1,2,3\\}.\n$$\n因此，单面返回产生\n$$\n\\sigma_i \\;=\\; \\sigma_i^{\\mathrm{tr}} \\;-\\; v_i\\,\\lambda,\n$$\n对于 $\\,i\\in\\{1,2,3\\}\\,$，其中 $\\,\\sigma_i^{\\mathrm{tr}}\\,$ 是试探主应力。对于边，沿两个对应的流动法向使用两个塑性乘子；对于顶点，使用三个塑性乘子，每个面一个。在所有情况下，都需施加一致性条件，即活动面在修正后的应力下满足其屈服方程，并强制塑性乘子为非负。\n\n您的实现必须：\n\n1. 对试探主应力进行排序，以使 $\\,\\sigma_1^{\\mathrm{tr}}\\ge\\sigma_2^{\\mathrm{tr}}\\ge\\sigma_3^{\\mathrm{tr}}\\,$。使用这些排序后的值来计算 $\\,f_{12},f_{13},f_{23}\\,$ 并执行返回映射。\n2. 确定目标区域：\n   - 当只有一个 $\\,f_{ij}0\\,$ 时，为面返回。\n   - 当正好有两个 $\\,f_{ij}0\\,$ 时，为边返回。\n   - 当所有三个 $\\,f_{ij}0\\,$ 时，为顶点返回。\n   - 如果没有一个 $\\,f_{ij}0\\,$，则为弹性。\n3. 对于面返回，求解一个关于 $\\,\\lambda\\,$ 的线性一致性方程并更新应力。对于边返回，为两个塑性乘子建立一个 $\\,2\\times 2\\,$ 线性系统。对于顶点返回，建立一个 $\\,3\\times 3\\,$ 线性系统。如果解出的任何塑性乘子为负，则通过移除相应的面来调整活动集，并用简化后的集合重新求解。如果简化后的集合变为空，则状态为弹性。\n4. 以算法使用的相同排序顺序输出修正后的主应力，并输出一个数字代码以指示返回映射的目标区域：\n   - $\\,0\\,$：弹性，\n   - $\\,1\\,$：面 $\\,12\\,$，\n   - $\\,2\\,$：面 $\\,13\\,$，\n   - $\\,3\\,$：面 $\\,23\\,$，\n   - $\\,4\\,$：边 $\\,12\\text{-}13\\,$，\n   - $\\,5\\,$：边 $\\,12\\text{-}23\\,$，\n   - $\\,6\\,$：边 $\\,13\\text{-}23\\,$，\n   - $\\,7\\,$：顶点。\n\n角度单位说明：在所有输入中，$\\,\\varphi\\,$ 和 $\\,\\psi\\,$ 使用度作为单位。物理单位说明：所有内部计算必须使用帕斯卡 ($\\,\\mathrm{Pa}\\,$)。您的程序必须以兆帕 ($\\,\\mathrm{MPa}\\,$) 为单位打印修正后的主应力，并四舍五入到三位小数。\n\n测试套件和要求的最终输出格式：\n\n使用材料参数 $\\,K=30\\times 10^9\\,\\mathrm{Pa}\\,$，$\\,G=10\\times 10^9\\,\\mathrm{Pa}\\,$，$\\,\\varphi=30^\\circ\\,$，$\\,\\psi=5^\\circ\\,$，$\\,c=10\\times 10^6\\,\\mathrm{Pa}\\,$。评估以下五个弹性试探状态（每个状态以帕斯卡为单位的三个主应力列表形式提供）：\n\n- 情况 $\\,1\\,$：$[\\;100\\times 10^6,\\;80\\times 10^6,\\;20\\times 10^6\\;]$\n- 情况 $\\,2\\,$：$[\\;250\\times 10^6,\\;20\\times 10^6,\\;50\\times 10^6\\;]$\n- 情况 $\\,3\\,$：$[\\;-50\\times 10^6,\\;-50\\times 10^6,\\;-50\\times 10^6\\;]$\n- 情况 $\\,4\\,$：$[\\;30\\times 10^6,\\;28\\times 10^6,\\;25\\times 10^6\\;]$\n- 情况 $\\,5\\,$：$[\\;64.641016\\times 10^6,\\;30\\times 10^6,\\;10\\times 10^6\\;]$ 对于指定的 $\\,\\varphi\\,$ 和 $\\,c\\,$，该状态正好位于面 $\\,13\\,$ 上。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个结果本身是一个包含四个数字 $[\\sigma_1^{\\mathrm{corr}},\\sigma_2^{\\mathrm{corr}},\\sigma_3^{\\mathrm{corr}},\\text{code}]$ 的列表，其中应力单位为兆帕。例如，最终打印应如下所示\n$$[\\,[\\sigma_{1,1},\\sigma_{2,1},\\sigma_{3,1},\\text{code}_1],\\,[\\sigma_{1,2},\\sigma_{2,2},\\sigma_{3,2},\\text{code}_2],\\,\\dots\\,]$$\n不含任何附加文本。", "solution": "问题陈述经评估有效。其科学基础是连续介质力学和弹塑性力学原理，问题提法得当，有清晰的算法路径可以得到唯一解，并且形式上是客观的。所有必要的本构律、材料参数和边界条件（以试探应力状态的形式）都已提供。该问题是计算岩土力学中一个标准的、非平凡的练习。因此，我们可以着手推导和实现解决方案。\n\n问题的核心是为多面摩尔-库仑屈服准则实现一个返回映射算法。这包括识别弹性试探应力状态违反了哪些屈服准则，然后计算必要的塑性应变，以将应力状态返回到屈服面的适当区域（一个面、一条边或顶点）。\n\n首先，我们根据给定的参数定义材料和模型常数：摩擦角 $\\varphi$、剪胀角 $\\psi$ 和黏聚力 $c$。角度必须转换为弧度才能用于三角函数。我们定义两组系数，一组用于屈服函数 ($f$)，另一组用于塑性势 ($g$)。\n对于屈服函数：\n$$ a_y = 1 - \\sin\\varphi,\\quad b_y = 1 + \\sin\\varphi,\\quad c_y = 2c\\cos\\varphi $$\n对于塑性势（流动法则）：\n$$ a_p = 1 - \\sin\\psi,\\quad b_p = 1 + \\sin\\psi $$\n对于排序为 $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3$ 的主应力，三个屈服函数为：\n$$\nf_{12}(\\boldsymbol{\\sigma}) = a_y\\sigma_1 - b_y\\sigma_2 - c_y \\\\\nf_{13}(\\boldsymbol{\\sigma}) = a_y\\sigma_1 - b_y\\sigma_3 - c_y \\\\\nf_{23}(\\boldsymbol{\\sigma}) = a_y\\sigma_2 - b_y\\sigma_3 - c_y\n$$\n如果任何 $f_{ij} > 0$，则发生塑性状态。塑性流动法则是非关联的，意味着塑性势函数 $g$ 的函数形式与 $f$ 不同，这是通过使用 $\\psi$ 而不是 $\\varphi$ 实现的。塑性势函数 $g_{12}$、$g_{13}$ 和 $g_{23}$ 相对于主应力的梯度给出了塑性流动方向向量（法向量）：\n$$\n\\mathbf{n}^{12} = \\frac{\\partial g_{12}}{\\partial \\boldsymbol{\\sigma}} = \\begin{bmatrix} a_p \\\\ -b_p \\\\ 0 \\end{bmatrix}, \\quad\n\\mathbf{n}^{13} = \\frac{\\partial g_{13}}{\\partial \\boldsymbol{\\sigma}} = \\begin{bmatrix} a_p \\\\ 0 \\\\ -b_p \\end{bmatrix}, \\quad\n\\mathbf{n}^{23} = \\frac{\\partial g_{23}}{\\partial \\boldsymbol{\\sigma}} = \\begin{bmatrix} 0 \\\\ a_p \\\\ -b_p \\end{bmatrix}\n$$\n应力更新由弹塑性分解给出。总应变增量分解为弹性和塑性两部分，$\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^e + \\Delta\\boldsymbol{\\varepsilon}^p$。应力增量是纯弹性的，$\\Delta\\boldsymbol{\\sigma} = \\mathsf{C}:\\Delta\\boldsymbol{\\varepsilon}^e = \\mathsf{C}:(\\Delta\\boldsymbol{\\varepsilon} - \\Delta\\boldsymbol{\\varepsilon}^p)$。塑性应变增量由流动法则给出，$\\Delta\\boldsymbol{\\varepsilon}^p = \\sum_k \\lambda_k \\mathbf{n}^k$，其中 $\\lambda_k \\ge 0$ 是每个活动屈服面 $k$ 的塑性乘子。\n假设一个弹性试探步，修正后的应力 $\\boldsymbol{\\sigma}$ 与试探应力 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ 的关系如下：\n$$ \\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\mathsf{C}:\\Delta\\boldsymbol{\\varepsilon}^p = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\sum_k \\lambda_k (\\mathsf{C}:\\mathbf{n}^k) $$\n让我们定义向量 $\\mathbf{v}^k = \\mathsf{C}:\\mathbf{n}^k$。在主应力空间中，对于体积模量为 $K$、剪切模量为 $G$ 的各向同性弹性材料，与法向 $\\mathbf{n}^k$ 对应的 $\\mathbf{v}^k$ 的分量为：\n$$ v_i^k = K\\,\\mathrm{tr}(\\mathbf{n}^k) + 2G\\left(n_i^k - \\frac{\\mathrm{tr}(\\mathbf{n}^k)}{3}\\right) $$\n修正后的应力向量则为 $\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\sum_k \\lambda_k \\mathbf{v}^k$。\n塑性乘子 $\\lambda_k$ 由一致性条件确定，该条件规定对于每个活动屈服面 $j$，最终应力状态必须位于其上，即 $f_j(\\boldsymbol{\\sigma}) = 0$。\n$$ f_j(\\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\sum_k \\lambda_k \\mathbf{v}^k) = 0 $$\n由于屈服函数的线性特性，这变成：\n$$ f_j(\\boldsymbol{\\sigma}^{\\mathrm{tr}}) - \\sum_k \\lambda_k f_j(\\mathbf{v}^k) = 0 $$\n这就形成了一个关于未知乘子 $\\boldsymbol{\\lambda}$ 的线性方程组：\n$$ \\mathbf{A}\\boldsymbol{\\lambda} = \\mathbf{b} $$\n其中 $b_j = f_j(\\boldsymbol{\\sigma}^{\\mathrm{tr}})$ 且 $A_{jk} = f_j(\\mathbf{v}^k)$。索引 $j$ 和 $k$ 遍历活动屈服面的集合。\n\n算法流程如下：\n1. 对于给定的试探应力向量 $\\boldsymbol{\\sigma}^{\\mathrm{tr,raw}}$，将其分量按降序排序得到 $\\boldsymbol{\\sigma}^{\\mathrm{tr}} = [\\sigma_1^{\\mathrm{tr}}, \\sigma_2^{\\mathrm{tr}}, \\sigma_3^{\\mathrm{tr}}]$。\n2. 计算三个屈服函数的值，$f_{12}(\\boldsymbol{\\sigma}^{\\mathrm{tr}}), f_{13}(\\boldsymbol{\\sigma}^{\\mathrm{tr}}), f_{23}(\\boldsymbol{\\sigma}^{\\mathrm{tr}})$。\n3. 编译一个初始的屈服面“活动集”，其中 $f_{ij} > 0$。\n4. 如果活动集为空，则状态为弹性，无需修正。$\\boldsymbol{\\sigma}^{\\mathrm{corr}} = \\boldsymbol{\\sigma}^{\\mathrm{tr}}$。\n5. 如果活动集不为空，则使用活动集对应的函数和向量构建线性系统 $\\mathbf{A}\\boldsymbol{\\lambda} = \\mathbf{b}$。\n6. 求解该系统以得到 $\\boldsymbol{\\lambda}$。\n7. 检查计算出的乘子的符号。如果所有 $\\lambda_k \\ge 0$，则活动集是正确的。应力修正是 $\\Delta\\boldsymbol{\\sigma} = \\sum_k \\lambda_k \\mathbf{v}^k$，最终修正后的应力是 $\\boldsymbol{\\sigma}^{\\mathrm{corr}} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\Delta\\boldsymbol{\\sigma}$。过程终止。\n8. 如果任何 $\\lambda_k  0$，则表示相应的屈服面不应被激活。标准流程是从活动集中移除与最负乘子相关联的约束，并使用简化后的系统从步骤 5 开始重复。此迭代过程持续进行，直到找到一组非负乘子。活动集变为空的情况意味着试探应力位于一个映射回弹性域的区域内，使得该状态为弹性。\n\n最后，根据产生有效解的最终活动集确定一个数字代码。修正后的主应力随后被转换为兆帕 ($\\mathrm{MPa}$) 并进行四舍五入。\n- 活动集为空：代码 $0$ (弹性)\n- $\\{12\\}$：代码 $1$ (面 12)\n- $\\{13\\}$：代码 $2$ (面 13)\n- $\\{23\\}$：代码 $3$ (面 23)\n- $\\{12, 13\\}$：代码 $4$ (边 12-13)\n- $\\{12, 23\\}$：代码 $5$ (边 12-23)\n- $\\{13, 23\\}$：代码 $6$ (边 13-23)\n- $\\{12, 13, 23\\}$：代码 $7$ (顶点)\n\n这完成了实现所需的理论框架。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve as solve_linear_system\n\ndef solve():\n    \"\"\"\n    Derives and implements an apex/edge return mapping strategy for the\n    Mohr-Coulomb elasto-plastic model.\n    \"\"\"\n    # Define material parameters and test cases\n    K = 30.0e9  # Bulk modulus in Pa\n    G = 10.0e9  # Shear modulus in Pa\n    phi_deg = 30.0  # Friction angle in degrees\n    psi_deg = 5.0  # Dilation angle in degrees\n    c = 10.0e6  # Cohesion in Pa\n    \n    test_cases = [\n        [100e6, 80e6, 20e6],\n        [250e6, 20e6, 50e6],\n        [-50e6, -50e6, -50e6],\n        [30e6, 28e6, 25e6],\n        [64.641016e6, 30e6, 10e6]\n    ]\n\n    # Pre-compute material constants\n    phi_rad = np.deg2rad(phi_deg)\n    psi_rad = np.deg2rad(psi_deg)\n    sin_phi = np.sin(phi_rad)\n    cos_phi = np.cos(phi_rad)\n    sin_psi = np.sin(psi_rad)\n    \n    a_y = 1.0 - sin_phi\n    b_y = 1.0 + sin_phi\n    c_y = 2.0 * c * cos_phi\n    \n    a_p = 1.0 - sin_psi\n    b_p = 1.0 + sin_psi\n\n    # Flow normals (as rows in a matrix for easier access)\n    # 0: n12, 1: n13, 2: n23\n    n_matrix = np.array([\n        [a_p, -b_p, 0.0],\n        [a_p, 0.0, -b_p],\n        [0.0, a_p, -b_p]\n    ])\n\n    # Stress correction vectors v = C:n\n    # v_vectors[i] corresponds to n_matrix[i]\n    v_vectors = np.zeros((3, 3))\n    for i in range(3):\n        n = n_matrix[i, :]\n        tr_n = np.sum(n)\n        for j in range(3):\n            v_vectors[i, j] = K * tr_n + 2 * G * (n[j] - tr_n / 3.0)\n\n    # Yield function definitions (coefficients for [s1, s2, s3])\n    # 0: f12, 1: f13, 2: f23\n    yield_coeffs = np.array([\n        [a_y, -b_y, 0.0],\n        [a_y, 0.0, -b_y],\n        [0.0, a_y, -b_y]\n    ])\n\n    # System matrix A where A[i, j] = f_i(v_j)\n    A_full = np.zeros((3, 3))\n    for i in range(3):  # Yield function index\n        for j in range(3):  # Flow normal index\n            A_full[i, j] = np.dot(yield_coeffs[i, :], v_vectors[j, :])\n\n    # Map from final active set (as sorted tuple) to output code\n    code_map = {\n        (): 0, (0,): 1, (1,): 2, (2,): 3,\n        (0, 1): 4, (0, 2): 5, (1, 2): 6,\n        (0, 1, 2): 7\n    }\n\n    results = []\n    TOL = 1e-9 # Tolerance for floating point comparisons\n\n    for sigma_tr_raw in test_cases:\n        # 1. Sort trial stresses: sigma_1 >= sigma_2 >= sigma_3\n        sigma_tr = np.sort(np.array(sigma_tr_raw))[::-1]\n        \n        # 2. Evaluate yield functions\n        f_tr = yield_coeffs @ sigma_tr - c_y\n        \n        # 3. Determine initial active set\n        active_set = [i for i, f_val in enumerate(f_tr) if f_val > TOL]\n        \n        if not active_set:\n            final_sigma = sigma_tr\n            code = 0\n        else:\n            # 4. Iterative solver for plastic multipliers\n            current_active_set = list(active_set)\n            while True:\n                n_active = len(current_active_set)\n                if n_active == 0:\n                    # All constraints removed, falls back to elastic\n                    final_sigma = sigma_tr\n                    break\n\n                # Build linear system for current active set\n                A_sub = A_full[np.ix_(current_active_set, current_active_set)]\n                b_sub = f_tr[current_active_set]\n                \n                # Solve for lambdas\n                lambdas = solve_linear_system(A_sub, b_sub)\n                \n                # Check sign of lambdas. If all are non-negative, solution is found.\n                if np.all(lambdas >= -TOL):\n                    delta_sigma = np.zeros(3)\n                    for i, face_idx in enumerate(current_active_set):\n                        delta_sigma += lambdas[i] * v_vectors[face_idx, :]\n                    \n                    final_sigma = sigma_tr - delta_sigma\n                    break\n                else:\n                    # Remove constraint with the most negative multiplier\n                    min_lambda_idx = np.argmin(lambdas)\n                    current_active_set.pop(min_lambda_idx)\n            \n            # Determine code from the final valid active set\n            final_active_key = tuple(sorted(current_active_set))\n            code = code_map.get(final_active_key, 0) # Default to elastic if set becomes empty\n\n        # 5. Format and store result\n        # Convert stresses to MPa and round to 3 decimal places\n        final_sigma_mpa = np.round(final_sigma / 1e6, 3)\n        results.append([*final_sigma_mpa, code])\n\n    # Final print statement in the exact required format\n    formatted_results = []\n    for res in results:\n        s_vals = res[:3]\n        code = res[3]\n        # Create strings for each float value\n        s_strs = [f\"{s:.3f}\" for s in s_vals]\n        # Re-form the string to ensure no spaces and exact format\n        formatted_results.append(f\"[{','.join(s_strs)},{code}]\")\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3588544"}]}