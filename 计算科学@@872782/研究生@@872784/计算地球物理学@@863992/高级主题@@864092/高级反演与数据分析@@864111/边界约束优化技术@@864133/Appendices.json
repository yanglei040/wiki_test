{"hands_on_practices": [{"introduction": "在我们开始开发用于求解有界约束问题的复杂算法之前，首先必须理解这些问题的解在数学上是如何定义的。本练习将引导您推导 Karush-Kuhn-Tucker (KKT) 条件，这是约束优化的基石。通过为一个具体的地球物理反演问题计算优化器和相应的拉格朗日乘子 [@problem_id:3578366]，您将深入理解有效约束是如何通过乘子来“平衡”目标函数的梯度的。", "problem": "在一个线性化地震振幅反演步骤中，模型扰动向量 $m \\in \\mathbb{R}^{n}$ 通过在简单边界约束下最小化一个Tikhonov正则化的数据失配来估计。其原始问题为\n$$\n\\min_{m \\in \\mathbb{R}^{n}} \\; J(m) = \\frac{1}{2}\\|F m - d\\|_{2}^{2} + \\frac{\\alpha}{2}\\|L m\\|_{2}^{2}\n\\quad \\text{subject to} \\quad l \\le m \\le u,\n$$\n其中 $F$ 是一个源于Born近似的线性化正演算子，$d$ 是观测数据，$L$ 是一个表示先验平滑性的稳定化算子，而 $l,u$ 是逐元素的下界和上界，它们编码了模型可行的物理范围。\n\n从拉格朗日函数的定义和约束凸优化的基本必要条件出发，推导出此边界约束问题的Karush–Kuhn–Tucker (KKT) 最优性系统，该系统应以梯度 $\\nabla J(m)$ 以及分别与上界和下界相关的非负拉格朗日乘子 $\\lambda^{+}, \\lambda^{-} \\in \\mathbb{R}^{n}$ 来表示。\n\n然后，将问题具体化到以下与单位权重的最小二乘数据项和零阶Tikhonov正则化项一致的适定的二维实例：\n- $n = 2$,\n- $F = I_{2}$ ($2 \\times 2$ 单位矩阵),\n- $L = I_{2}$,\n- $\\alpha = 1$,\n- $d = \\begin{pmatrix} 2 \\\\ \\frac{1}{10} \\end{pmatrix}$,\n- $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$,\n- $u = \\begin{pmatrix} \\frac{3}{5} \\\\ \\frac{1}{5} \\end{pmatrix}$.\n\n计算满足您推导的KKT系统的唯一最优解 $m^{\\star}$ 和相关的KKT乘子 $\\lambda^{+}, \\lambda^{-}$。报告上界乘子第一个分量的标量值，即 $\\lambda^{+}_{1}$，作为您的最终答案。将最终值表示为最简分数。无需单位。", "solution": "用户希望我解决一个带边界约束的优化问题。\n\n首先，我将验证问题陈述。\n\n### 步骤1：提取已知条件\n- **目标函数**：最小化 $J(m) = \\frac{1}{2}\\|F m - d\\|_{2}^{2} + \\frac{\\alpha}{2}\\|L m\\|_{2}^{2}$，其中变量为 $m \\in \\mathbb{R}^{n}$。\n- **约束条件**：$l \\le m \\le u$，其中不等式为逐元素比较。\n- **问题参数**：\n    - $m \\in \\mathbb{R}^{n}$：模型扰动向量。\n    - $F$：线性化正演算子。\n    - $d$：观测数据向量。\n    - $L$：稳定化算子。\n    - $\\alpha$：标量正则化参数。\n    - $l, u \\in \\mathbb{R}^{n}$：逐元素的下界和上界。\n- **具体实例**：\n    - $n = 2$。\n    - $F = I_{2}$ ($2 \\times 2$ 单位矩阵)。\n    - $L = I_{2}$。\n    - $\\alpha = 1$。\n    - $d = \\begin{pmatrix} 2 \\\\ \\frac{1}{10} \\end{pmatrix}$。\n    - $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n    - $u = \\begin{pmatrix} \\frac{3}{5} \\\\ \\frac{1}{5} \\end{pmatrix}$。\n- **任务**：\n    1. 推导一般边界约束问题的Karush–Kuhn–Tucker (KKT) 最优性系统。\n    2. 求解具体实例的最优解 $m^{\\star}$ 和相关的拉格朗日乘子 $\\lambda^{+}, \\lambda^{-}$。\n    3. 报告上界乘子的第一个分量值 $\\lambda^{+}_{1}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上和数学上都是合理的。它描述了一个带有箱式约束的标准Tikhonov正则化最小二乘问题，这是计算科学与工程领域（特别是在地球物理反演中）的一项常见任务。对于 $\\alpha > 0$ 以及合理的 $F$ 和 $L$ (在具体实例中 $F=L=I_2$ 满足此条件)，目标函数 $J(m)$ 是一个严格凸的二次函数。约束集是一个闭的、非空的凸超矩形。在此类集合上最小化一个严格凸函数是一个适定问题，保证有唯一解。给定具体实例的数据在维度上是一致且完整的。因此，该问题是有效的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 第1部分：KKT系统的推导\n\n优化问题是：\n$$\n\\min_{m \\in \\mathbb{R}^{n}} \\; J(m) = \\frac{1}{2}\\|F m - d\\|_{2}^{2} + \\frac{\\alpha}{2}\\|L m\\|_{2}^{2}\n\\quad \\text{subject to} \\quad l \\le m \\le u.\n$$\n约束可以写成两组不等式：\n$$\nm - u \\le 0 \\quad (\\text{逐元素})\n$$\n$$\nl - m \\le 0 \\quad (\\text{逐元素})\n$$\n我们分别为上界和下界约束引入非负拉格朗日乘子 $\\lambda^{+} \\in \\mathbb{R}^{n}$ 和 $\\lambda^{-} \\in \\mathbb{R}^{n}$。拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(m, \\lambda^{+}, \\lambda^{-}) = J(m) + (\\lambda^{+})^T (m - u) + (\\lambda^{-})^T (l - m)\n$$\nKarush–Kuhn–Tucker (KKT) 最优性条件如下：\n\n1.  **平稳性 (Stationarity)**：拉格朗日函数关于 $m$ 的梯度必须为零。\n    $$\n    \\nabla_{m} \\mathcal{L}(m, \\lambda^{+}, \\lambda^{-}) = \\nabla J(m) + \\lambda^{+} - \\lambda^{-} = 0\n    $$\n2.  **原始可行性 (Primal Feasibility)**：必须满足原始约束。\n    $$\n    l \\le m \\le u\n    $$\n3.  **对偶可行性 (Dual Feasibility)**：拉格朗日乘子必须为非负。\n    $$\n    \\lambda^{+} \\ge 0, \\quad \\lambda^{-} \\ge 0 \\quad (\\text{逐元素})\n    $$\n4.  **互补松弛性 (Complementary Slackness)**：每个乘子与其对应的约束函数之积必须为零。对于每个分量 $i = 1, \\dots, n$：\n    $$\n    \\lambda_i^{+} (m_i - u_i) = 0\n    $$\n    $$\n    \\lambda_i^{-} (l_i - m_i) = 0\n    $$\n目标函数的梯度 $\\nabla J(m)$ 可以通过展开平方范数得到：\n$J(m) = \\frac{1}{2}(Fm-d)^T(Fm-d) + \\frac{\\alpha}{2}(Lm)^T(Lm) = \\frac{1}{2}(m^T F^T F m - 2 d^T F m + d^T d) + \\frac{\\alpha}{2} m^T L^T L m$。\n对 $m$ 求梯度：\n$$\n\\nabla J(m) = F^T(Fm - d) + \\alpha L^T L m\n$$\n将此梯度代入平稳性条件，即可得到完整的KKT系统。这个由方程和不等式组成的系统定义了解 $m^{\\star}$ 必须满足的必要条件。对于像本题这样的凸问题，这些条件也是充分条件。\n\n### 第2部分：具体实例的求解\n\n给定：$n = 2$, $F = L = I_{2}$, $\\alpha = 1$, $d = \\begin{pmatrix} 2 \\\\ \\frac{1}{10} \\end{pmatrix}$, $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$, $u = \\begin{pmatrix} \\frac{3}{5} \\\\ \\frac{1}{5} \\end{pmatrix}$。\n\n目标函数简化为：\n$$\nJ(m) = \\frac{1}{2}\\|m - d\\|_{2}^{2} + \\frac{1}{2}\\|m\\|_{2}^{2}\n$$\n梯度为：\n$$\n\\nabla J(m) = (m - d) + m = 2m - d\n$$\n对每个分量 $i=1,2$，KKT平稳性条件为：\n$$\n2m_i - d_i + \\lambda_i^{+} - \\lambda_i^{-} = 0\n$$\n为了找到解，我们首先通过设置 $\\nabla J(m) = 0$ 来计算无约束极小值点，得到 $2m - d = 0$，即 $m = d/2$。\n$$\nm_{\\text{unconstrained}} = \\frac{1}{2} \\begin{pmatrix} 2 \\\\ \\frac{1}{10} \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ \\frac{1}{20} \\end{pmatrix}\n$$\n接下来，我们检查这个无约束解是否满足边界 $l \\le m \\le u$ 的可行性。\n边界为 $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 和 $u = \\begin{pmatrix} \\frac{3}{5} \\\\ \\frac{1}{5} \\end{pmatrix} = \\begin{pmatrix} 0.6 \\\\ 0.2 \\end{pmatrix}$。\n\n对于第一个分量，$m_1 = 1$。约束为 $0 \\le m_1 \\le 0.6$。由于 $1 > 0.6$，上界被违反。\n对于第二个分量，$m_2 = \\frac{1}{20} = 0.05$。约束为 $0 \\le m_2 \\le 0.2$。此约束得到满足。\n\n因为问题是凸的，解 $m^{\\star}$ 可以通过将无约束解投影到可行域（由 $l$ 和 $u$ 定义的箱型区域）上得到。\n- 对于 $m_1^{\\star}$，由于无约束值 $1$ 高于上界 $u_1 = \\frac{3}{5}$，最优值将取在上界处。因此，$m_1^{\\star} = u_1 = \\frac{3}{5}$。\n- 对于 $m_2^{\\star}$，由于无约束值 $\\frac{1}{20}$ 位于可行区间 $[0, \\frac{1}{5}]$ 内，最优值即为无约束值。因此，$m_2^{\\star} = \\frac{1}{20}$。\n\n所以，最优解为 $m^{\\star} = \\begin{pmatrix} \\frac{3}{5} \\\\ \\frac{1}{20} \\end{pmatrix}$。\n\n现在，我们使用KKT条件计算拉格朗日乘子。\n\n**对于分量1**：\n- $m_1^{\\star} = u_1 = \\frac{3}{5}$。上界是激活的。\n- 根据互补松弛性，由于 $m_1^{\\star} - u_1 = 0$，$\\lambda_1^{+}$可以是非零值。\n- 由于 $l_1  m_1^{\\star}$ ($0  \\frac{3}{5}$)，下界是非激活的。互补松弛性要求 $\\lambda_1^{-} = 0$。\n- $m_1$ 的平稳性条件是 $2m_1^{\\star} - d_1 + \\lambda_1^{+} - \\lambda_1^{-} = 0$。\n- 代入已知值：\n$$\n2\\left(\\frac{3}{5}\\right) - 2 + \\lambda_1^{+} - 0 = 0\n$$\n$$\n\\frac{6}{5} - \\frac{10}{5} + \\lambda_1^{+} = 0\n$$\n$$\n-\\frac{4}{5} + \\lambda_1^{+} = 0\n$$\n$$\n\\lambda_1^{+} = \\frac{4}{5}\n$$\n这满足对偶可行性条件 $\\lambda_1^{+} \\ge 0$。\n\n**对于分量2**：\n- $m_2^{\\star} = \\frac{1}{20}$。解位于可行区间 $[0, \\frac{1}{5}]$ 的内部。\n- 上界和下界都是非激活的：$l_2  m_2^{\\star}  u_2$。\n- 根据互补松弛性，这意味着 $\\lambda_2^{+} = 0$ 且 $\\lambda_2^{-} = 0$。\n- 我们验证 $m_2$ 的平稳性条件：$2m_2^{\\star} - d_2 + \\lambda_2^{+} - \\lambda_2^{-} = 0$。\n$$\n2\\left(\\frac{1}{20}\\right) - \\frac{1}{10} + 0 - 0 = \\frac{1}{10} - \\frac{1}{10} = 0\n$$\n该条件恒成立。\n\n完整的解是：\n$m^{\\star} = \\begin{pmatrix} \\frac{3}{5} \\\\ \\frac{1}{20} \\end{pmatrix}$, $\\lambda^{+} = \\begin{pmatrix} \\frac{4}{5} \\\\ 0 \\end{pmatrix}$, $\\lambda^{-} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n\n问题要求的是上界乘子第一个分量的标量值，即 $\\lambda_1^{+}$。我们的计算表明该值为 $\\frac{4}{5}$。", "answer": "$$\\boxed{\\frac{4}{5}}$$", "id": "3578366"}, {"introduction": "在掌握了最优性条件的理论之后，下一步是学习如何通过迭代计算找到满足这些条件的解。本练习将指导您实现一种基本但功能强大的算法：带 Armijo 线搜索的投影梯度法 [@problem_id:3578294]。通过编写代码来执行单个算法迭代，您将获得处理边界约束的第一手经验，并理解确保收敛性的充分下降条件在实践中是如何工作的。", "problem": "考虑计算地球物理学中的带边界约束的最小二乘失配，其函数定义为 $f(x) = \\tfrac{1}{2}\\lVert A x - b \\rVert_2^2$，其中给定 $A \\in \\mathbb{R}^{m \\times n}$ 和 $b \\in \\mathbb{R}^m$。变量 $x \\in \\mathbb{R}^n$ 被约束在箱式区域 $\\mathcal{C} = \\{x \\in \\mathbb{R}^n : \\ell \\le x \\le u\\}$ 内，其中的不等式是按分量解释的，且 $\\ell, u \\in \\mathbb{R}^n$ 指定了下界和上界。到 $\\mathcal{C}$ 上的欧几里得投影表示为 $P_{\\mathcal{C}}$。\n\n从欧几里得范数和可微映射微积分的基本定义出发，你的任务是：\n- 为投影梯度更新推导一个可行步长，并基于投影方向推导一个 Armijo 型的充分下降条件，确保更新线段上的所有点都具有可行性。\n- 实现一次迭代。给定 $A$、$b$、$\\ell$、$u$、$x$、一个试验步长 $\\tau$、一个 Armijo 参数 $c$（$0  c  1$）和一个回溯因子 $\\beta$（$0  \\beta  1$），计算投影方向 $s = P_{\\mathcal{C}}(x - \\tau \\nabla f(x)) - x$，然后对 $\\alpha \\in \\{1, \\beta, \\beta^2, \\dots\\}$ 执行回溯，以找到使 Armijo 充分下降条件\n$$\nf(x + \\alpha s) \\le f(x) + c \\,\\alpha \\,\\nabla f(x)^{\\top} s\n$$\n成立的 $\\beta$ 的最小幂次。如果 $s = 0$，则设置 $\\alpha = 0$ 并返回未改变的失配值。\n\n你的程序必须为以下测试套件实现上述逻辑。对于每种情况，Armijo 常数是共享的，给定为 $c = 10^{-4}$ 和 $\\beta = 0.5$。\n\n测试用例 1 (一般情况):\n$$\nA^{(1)} = \\begin{bmatrix}\n3  -1  0  2 \\\\\n0  2  -1  1 \\\\\n-2  0  1  -3 \\\\\n1.5  -0.5  0  1 \\\\\n0  1  1  0\n\\end{bmatrix},\\quad\nb^{(1)} = \\begin{bmatrix}\n1 \\\\ -2 \\\\ 0.5 \\\\ 3 \\\\ -1\n\\end{bmatrix},\\quad\n\\ell^{(1)} = \\begin{bmatrix}\n-1 \\\\ -0.5 \\\\ -0.25 \\\\ -2\n\\end{bmatrix},\\quad\nu^{(1)} = \\begin{bmatrix}\n2 \\\\ 1.5 \\\\ 1.75 \\\\ 3\n\\end{bmatrix},\\quad\nx^{(1)} = \\begin{bmatrix}\n0.5 \\\\ 0 \\\\ 1.5 \\\\ -1\n\\end{bmatrix},\\quad\n\\tau^{(1)} = 0.7.\n$$\n\n测试用例 2 (边界交互情况):\n$$\nA^{(2)} = \\begin{bmatrix}\n2  0  -1 \\\\\n0  1  0 \\\\\n1  -2  3\n\\end{bmatrix},\\quad\nb^{(2)} = \\begin{bmatrix}\n1 \\\\ -1 \\\\ 2\n\\end{bmatrix},\\quad\n\\ell^{(2)} = \\begin{bmatrix}\n-1 \\\\ -0.5 \\\\ -0.5\n\\end{bmatrix},\\quad\nu^{(2)} = \\begin{bmatrix}\n1 \\\\ 0.5 \\\\ 1\n\\end{bmatrix},\\quad\nx^{(2)} = \\begin{bmatrix}\n0.9 \\\\ 0.5 \\\\ 1\n\\end{bmatrix},\\quad\n\\tau^{(2)} = 0.6.\n$$\n\n测试用例 3 (投影方向为零的边缘情况):\n$$\nA^{(3)} = I_3,\\quad\nb^{(3)} = \\begin{bmatrix}\n-3 \\\\ -2 \\\\ 0\n\\end{bmatrix},\\quad\n\\ell^{(3)} = \\begin{bmatrix}\n-2 \\\\ -1 \\\\ 1\n\\end{bmatrix},\\quad\nu^{(3)} = \\begin{bmatrix}\n0 \\\\ 2 \\\\ 3\n\\end{bmatrix},\\quad\nx^{(3)} = \\ell^{(3)},\\quad\n\\tau^{(3)} = 0.9.\n$$\n\n对于每个测试用例，输出接受的回溯步长 $\\alpha$ 和得到的失配值 $f(x + \\alpha s)$。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个 $[\\alpha, f_{\\text{new}}]$ 形式的双元素列表。例如，格式应如 $[[\\alpha_1, f_1],[\\alpha_2, f_2],[\\alpha_3, f_3]]$，其中符号由数值代替。不涉及物理单位，也不存在角度；所有数值输出均为无单位实数。", "solution": "该问题要求对一个带边界约束的线性最小二乘问题，推导并实现投影梯度法的一次迭代，其中包含 Armijo 回溯线搜索。该问题定义明确，数学上合理，并为获得唯一解提供了所有必要信息。\n\n设目标函数为 $f(x) = \\frac{1}{2}\\lVert A x - b \\rVert_2^2$，其中 $x \\in \\mathbb{R}^n$ 受边界约束 $\\ell \\le x \\le u$ 的限制。这些约束定义了一个凸闭集 $\\mathcal{C} = \\{x \\in \\mathbb{R}^n : \\ell_i \\le x_i \\le u_i, \\forall i=1,\\dots,n\\}$。\n\n首先，我们推导目标函数的梯度 $\\nabla f(x)$。欧几里得范数的平方可以写成内积形式：\n$$\nf(x) = \\frac{1}{2} (Ax - b)^{\\top}(Ax - b) = \\frac{1}{2} (x^{\\top}A^{\\top}Ax - x^{\\top}A^{\\top}b - b^{\\top}Ax + b^{\\top}b)\n$$\n由于标量项 $x^{\\top}A^{\\top}b$ 与其转置 $b^{\\top}Ax$ 相等，我们可以合并这些项：\n$$\nf(x) = \\frac{1}{2} (x^{\\top}A^{\\top}Ax - 2b^{\\top}Ax + b^{\\top}b)\n$$\n为了求梯度，我们将 $f(x)$ 对向量 $x$ 求导。使用标准矩阵微积分恒等式 $\\nabla_x (x^{\\top}Mx) = (M+M^{\\top})x$ 和 $\\nabla_x (c^{\\top}x) = c$，并注意到 $A^{\\top}A$ 是对称的，我们得到：\n$$\n\\nabla f(x) = \\frac{1}{2} (2A^{\\top}Ax - 2A^{\\top}b) = A^{\\top}(Ax - b)\n$$\n投影梯度法通过先沿负梯度方向迈出一步，然后将所得点投影回可行集 $\\mathcal{C}$ 来生成搜索方向。给定当前可行点 $x$ 和试验步长 $\\tau > 0$，投影方向 $s$ 定义为：\n$$\ns = P_{\\mathcal{C}}(x - \\tau \\nabla f(x)) - x\n$$\n其中 $P_{\\mathcal{C}}$ 是到集合 $\\mathcal{C}$ 上的欧几里得投影。对于箱式约束，该投影是按分量计算的：$(P_{\\mathcal{C}}(y))_i = \\max(\\ell_i, \\min(y_i, u_i))$。\n\n这个方向的一个重要性质是，对于步长 $\\alpha \\in [0, 1]$ 的任何一步 $x_{new} = x + \\alpha s$ 都保持可行性。这是因为 $x_{new}$ 可以写成 $\\mathcal{C}$ 中两点的凸组合：\n$$\nx + \\alpha s = x + \\alpha (P_{\\mathcal{C}}(x - \\tau \\nabla f(x)) - x) = (1-\\alpha)x + \\alpha P_{\\mathcal{C}}(x - \\tau \\nabla f(x))\n$$\n由于 $x \\in \\mathcal{C}$ 且 $P_{\\mathcal{C}}(\\cdot)$ 将任何点映射到 $\\mathcal{C}$，并且 $\\mathcal{C}$ 是一个凸集，因此这两点的凸组合也必定位于 $\\mathcal{C}$ 内。\n\n方向 $s$ 是一个下降方向，意味着如果 $x$ 不是稳定点，则 $\\nabla f(x)^{\\top}s  0$。此约束问题的一个稳定点满足条件 $x = P_{\\mathcal{C}}(x - \\tau \\nabla f(x))$（对于任何 $\\tau > 0$），这意味着 $s = 0$。如果 $s \\neq 0$，则 $s$ 是一个保证的下降方向。\n\n为确保目标函数的充分下降和整个算法的收敛性，我们采用 Armijo 回溯线搜索。我们从序列 $\\{1, \\beta, \\beta^2, \\dots\\}$ 中寻找最大的步长 $\\alpha$（其中 $\\beta \\in (0, 1)$ 是一个回溯因子），使得以下充分下降条件成立：\n$$\nf(x + \\alpha s) \\le f(x) + c \\alpha \\nabla f(x)^{\\top} s\n$$\n这里，$c \\in (0, 1)$ 是一个控制参数。由于对于非稳定点有 $\\nabla f(x)^{\\top}s  0$，因此当 $\\alpha > 0$ 时，右侧的项严格小于 $f(x)$。线搜索从 $\\alpha=1$（朝投影点迈出的完整一步）开始，并不断将 $\\alpha$ 乘以因子 $\\beta$ 直至满足条件。由于 $f$ 是连续可微的，这个过程保证会对于一个正的步长而终止。\n\n单次迭代的完整算法如下：\n1.  给定当前可行点 $x$、问题数据 $A, b, \\ell, u$ 以及参数 $\\tau, c, \\beta$。\n2.  计算梯度：$\\nabla f(x) = A^{\\top}(Ax-b)$。\n3.  计算投影方向：$s = P_{\\mathcal{C}}(x - \\tau \\nabla f(x)) - x$。\n4.  如果 $s=0$（在数值容差范围内），则该点是稳定点。设置 $\\alpha=0$，新的失配值为 $f(x)$。\n5.  如果 $s \\neq 0$，计算 Armijo 条件所需的项：$d = \\nabla f(x)^{\\top}s$。\n6.  初始化步长 $\\alpha = 1$。\n7.  开始回溯循环：\n    a. 计算新的候选点 $x_{new} = x + \\alpha s$。\n    b. 在新点处评估目标函数值 $f(x_{new})$。\n    c. 检查 Armijo 条件：$f(x_{new}) \\le f(x) + c \\alpha d$。\n    d. 如果条件满足，则接受 $\\alpha$ 和 $f(x_{new})$，然后终止循环。\n    e. 如果不满足，则减小步长：$\\alpha \\leftarrow \\beta \\alpha$，并继续循环。\n8.  返回接受的步长 $\\alpha$ 和相应的失配值 $f(x_{new})$。\n对每个给定的测试用例都实现了此过程。", "answer": "[[0.125,6.721533203125],[1.0,5.0],[0.0,3.0]]", "id": "3578294"}, {"introduction": "虽然投影梯度法在概念上很直观，但其收敛性分析却隐藏着一些微妙之处，尤其是在保证步长选择的有效性方面。本练习 [@problem_id:3578313] 深入探讨了标准线搜索条件（如 Armijo 和 Wolfe 条件）在投影操作存在时为何可能失效，并要求您推导出一个修正版本。通过分析投影在搜索路径中引入的“扭结” (kink)，您将对约束优化算法的严谨分析有更深刻的认识。", "problem": "考虑一个应用于计算地球物理学中平滑最小二乘目标函数的带边界约束的梯度投影法。设模型向量为 $m \\in \\mathbb{R}^{n}$，目标函数为 $J(m) = \\frac{1}{2}\\|F(m) - d\\|^{2}$，其中 $F(m)$ 是一个可微正演映射，$d$ 是观测数据。此处假设高斯-牛顿近似将 $J(m)$ 局部简化为一个严格凸二次型 $J(m) = \\frac{1}{2}\\|m - b\\|^{2}$，其梯度为 $\\nabla J(m) = m - b$，其中 $b \\in \\mathbb{R}^{n}$ 是牛顿目标。设可行集为箱形区域 $[l,u] = \\{m \\in \\mathbb{R}^{n} : l_{i} \\le m_{i} \\le u_{i}\\}$，并将向量在 $[l,u]$ 上的投影记为 $P_{[l,u]}(\\cdot)$。\n\n一个步长为 $\\alpha  0$ 的投影梯度步为 $m^{+}(\\alpha) = P_{[l,u]}\\big(m - \\alpha \\nabla J(m)\\big)$。在存在投影的情况下，基于未投影方向的标准Armijo/Wolfe条件可能失效，因为搜索路径在活跃边界处会变为分段仿射且非光滑。为解决此问题，定义投影割线方向\n$$\np(\\alpha) = \\frac{m^{+}(\\alpha) - m}{\\alpha}.\n$$\n从可微函数的方向导数的核心定义（$\\mathrm{D}J(m)[d] = \\langle \\nabla J(m), d \\rangle$）和作为投影步所实现的实际方向 $p(\\alpha)$ 的构造出发，通过用 $p(\\alpha)$ 替换名义方向，推导一个在投影下仍然有效的Armijo型充分下降条件和一个Wolfe型曲率条件。你的推导必须从这些基本定义开始，并仔细论证投影如何改变路径以及相应的斜率配对。不要引用预先推导出的投影线搜索公式。\n\n然后，分析以下模拟地震反演中局部高斯-牛顿子问题的二维实例：\n- 维度 $n = 2$。\n- 目标函数 $J(m) = \\frac{1}{2}\\|m - b\\|^{2}$，其中 $b = \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix}$。\n- 当前模型 $m = \\begin{pmatrix} 0.2 \\\\ 0.8 \\end{pmatrix}$，因此 $\\nabla J(m) = m - b$。\n- 箱形边界 $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 和 $u = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n- 使用Armijo常数 $c_{1} = 0.1$ 和强Wolfe曲率常数 $c_{2} = 0.5$（强Wolfe条件使用新迭代点处斜率的绝对值）。\n\n任务：\n1. 从第一性原理出发，推导形式为\n$$\nJ\\big(m^{+}(\\alpha)\\big) \\le J(m) + c_{1}\\,\\alpha\\,\\langle \\nabla J(m), p(\\alpha) \\rangle,\n$$\n的Armijo型充分下降不等式，以及形式为\n$$\n\\big|\\langle \\nabla J\\big(m^{+}(\\alpha)\\big), p(\\alpha) \\rangle\\big| \\le c_{2}\\,\\big|\\langle \\nabla J(m), p(\\alpha) \\rangle\\big|.\n$$\n的强Wolfe型曲率条件。解释为什么在投影后，这些是标准条件的有效替代，需明确使用投影路径 $m^{+}(\\alpha)$ 和割线方向 $p(\\alpha)$。\n2. 对于给定的数值实例，确定无约束路径 $m - \\alpha \\nabla J(m)$ 的任意分量在投影前首次触碰边界时的精确触碰步长 $\\alpha_{\\mathrm{hit}}$。最终答案以最简分数形式表示；该答案无量纲。\n3. 使用你推导的条件，分析在此实例中是否存在任何 $\\alpha  0$ 同时满足投影Armijo条件和 $c_{2} = 0.5$ 的投影强Wolfe曲率条件。明确地构建论证，指出曲率条件在何处以及为何因投影引起的扭结而失效。此部分无需提供数值；目的是构建和解释论证过程。\n\n最终答案仅提供 $\\alpha_{\\mathrm{hit}}$ 的单一数值。如果可以简化为有理数，请以最简分数而不是小数形式表示。", "solution": "对问题陈述的有效性进行分析。\n\n### 步骤 1：提取给定信息\n- **目标函数：** $J(m) = \\frac{1}{2}\\|F(m) - d\\|^{2}$，其被近似为一个严格凸二次型 $J(m) = \\frac{1}{2}\\|m - b\\|^{2}$。\n- **梯度：** $\\nabla J(m) = m - b$。\n- **模型向量：** $m \\in \\mathbb{R}^{n}$。\n- **可行集：** $[l,u] = \\{m \\in \\mathbb{R}^{n} : l_{i} \\le m_{i} \\le u_{i}\\}$。\n- **投影算子：** $P_{[l,u]}(\\cdot)$。\n- **投影梯度步：** $m^{+}(\\alpha) = P_{[l,u]}\\big(m - \\alpha \\nabla J(m)\\big)$，步长为 $\\alpha > 0$。\n- **投影割线方向：** $p(\\alpha) = \\frac{m^{+}(\\alpha) - m}{\\alpha}$。\n- **方向导数定义：** $\\mathrm{D}J(m)[d] = \\langle \\nabla J(m), d \\rangle$。\n- **数值实例：**\n    - 维度 $n = 2$。\n    - 牛顿目标 $b = \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix}$。\n    - 当前模型 $m = \\begin{pmatrix} 0.2 \\\\ 0.8 \\end{pmatrix}$。\n    - 箱形边界 $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 和 $u = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n- **线搜索常数：**\n    - Armijo常数 $c_{1} = 0.1$。\n    - 强Wolfe曲率常数 $c_{2} = 0.5$。\n- **任务：**\n    1.  推导适用于投影路径的Armijo型和强Wolfe型条件。\n    2.  计算触碰步长 $\\alpha_{\\mathrm{hit}}$。\n    3.  对于给定的数值实例，分析是否存在一个 $\\alpha > 0$ 同时满足两个推导出的条件。\n- **最终答案要求：** 以最简分数形式提供 $\\alpha_{\\mathrm{hit}}$ 的数值。\n\n### 步骤 2：使用提取的给定信息进行验证\n- **科学依据：** 该问题坚实地植根于约束非线性优化理论。梯度投影法是一种标准且广泛使用的算法。使用二次模型是局部分析（例如，在高斯-牛顿法或SQP方法中）的典型做法。修改线搜索条件以适应由投影产生的分段线性路径是数值优化中一个公认的、非平凡的课题。\n- **适定性：** 该问题是适定的。它包含了执行所要求的推导和计算所需的所有必要信息。任务具体，并能得出明确的结论。\n- **客观性：** 问题以精确、客观的数学语言陈述，没有歧义或主观性陈述。\n\n### 步骤 3：结论与行动\n问题是有效的。这是一个数值优化理论中标准的、适定的练习题，可直接应用于计算地球物理学。将按要求进行求解。\n\n---\n\n### 任务 1：投影线搜索条件的推导\n\n标准的线搜索条件是为沿着固定方向 $d$（通常 $d = -\\nabla J(m)$）的无约束搜索而制定的。步长为 $m + \\alpha d$。投影的核心问题在于，实际的步长并非沿着 $-\\nabla J(m)$，而是沿着一条分段线性的路径。新的点是 $m^{+}(\\alpha) = P_{[l,u]}(m - \\alpha \\nabla J(m))$。从 $m$到 $m^{+}(\\alpha)$ 的实际位移方向是割线方向 $p(\\alpha) = \\frac{m^{+}(\\alpha) - m}{\\alpha}$。为了调整线搜索条件，我们必须沿着这条真实路径评估相关量。\n\n**Armijo型充分下降条件：**\nArmijo条件确保步长 $\\alpha$ 能在目标函数上产生“充分”的下降。该条件将实际下降量 $J(m) - J(m^{+}(\\alpha))$ 与在 $m$ 点沿步进方向进行一阶泰勒展开所预测的下降量进行比较。\n\n对于一个可微函数 $J$，在 $m$ 点沿方向 $v$ 的变化率由方向导数给出，即 $\\mathrm{D}J(m)[v] = \\langle \\nabla J(m), v \\rangle$。对于投影步，行进方向是 $p(\\alpha)$。线性模型预测的在方向 $p(\\alpha)$ 上步长为 $\\alpha$ 的总下降量是 $\\alpha \\times \\mathrm{D}J(m)[p(\\alpha)] = \\alpha \\langle \\nabla J(m), p(\\alpha) \\rangle$。\n\n充分下降条件要求新点 $m^{+}(\\alpha)$ 的实际目标函数值不大于初始值加上该预测下降量的一小部分 $c_1$。注意，对于下降方向，$\\langle \\nabla J(m), p(\\alpha) \\rangle$ 预期为负值。\n$$\nJ\\big(m^{+}(\\alpha)\\big) \\le J(m) + c_{1}\\,\\alpha\\,\\langle \\nabla J(m), p(\\alpha) \\rangle\n$$\n这个条件是一个有效的替代，因为它正确地使用了割线方向 $p(\\alpha)$ 作为预测下降的参考，从而使条件与所采取的实际步长的几何形状保持一致。\n\n**强Wolfe型曲率条件：**\nWolfe曲率条件旨在排除过短的步长。它确保新点处的斜率明显比初始斜率平缓。\n\n沿着真实路径方向 $p(\\alpha)$ 的初始斜率是 $\\langle \\nabla J(m), p(\\alpha) \\rangle$。在新点 $m^{+}(\\alpha)$ 处，投影到同一路径方向 $p(\\alpha)$ 上的斜率是 $\\langle \\nabla J(m^{+}(\\alpha)), p(\\alpha) \\rangle$。\n\n标准Wolfe条件要求 $\\langle \\nabla J(m^{+}(\\alpha)), p(\\alpha) \\rangle \\ge c_{2}\\,\\langle \\nabla J(m), p(\\alpha) \\rangle$。强Wolfe条件在实践中更常用，并且能处理斜率可能变号的情况，它使用绝对值：\n$$\n\\big|\\langle \\nabla J\\big(m^{+}(\\alpha)\\big), p(\\alpha) \\rangle\\big| \\le c_{2}\\,\\big|\\langle \\nabla J(m), p(\\alpha) \\rangle\\big|\n$$\n这是一个有效的替代，因为像Armijo条件一样，它一致地使用割线方向 $p(\\alpha)$ 来定义测量和比较斜率所依据的“线”。它正确地考虑了这样一个事实：即使 $p(\\alpha)$ 本身随 $\\alpha$ 变化，从 $m$ 到 $m^{+}(\\alpha)$ 的路径是沿着 $p(\\alpha)$ 的一条直线。\n\n### 任务 2：计算触碰步长 $\\alpha_{\\mathrm{hit}}$\n\n首先，我们计算当前迭代点 $m$ 处的梯度。\n给定 $m = \\begin{pmatrix} 0.2 \\\\ 0.8 \\end{pmatrix}$ 和 $b = \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix}$：\n$$\n\\nabla J(m) = m - b = \\begin{pmatrix} 0.2 - 2 \\\\ 0.8 - (-1) \\end{pmatrix} = \\begin{pmatrix} -1.8 \\\\ 1.8 \\end{pmatrix}\n$$\n从 $m$ 开始的无约束路径由 $z(\\alpha) = m - \\alpha \\nabla J(m)$ 给出：\n$$\nz(\\alpha) = \\begin{pmatrix} 0.2 \\\\ 0.8 \\end{pmatrix} - \\alpha \\begin{pmatrix} -1.8 \\\\ 1.8 \\end{pmatrix} = \\begin{pmatrix} 0.2 + 1.8\\alpha \\\\ 0.8 - 1.8\\alpha \\end{pmatrix}\n$$\n可行区域是由 $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 和 $u = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 定义的箱形区域。触碰步长 $\\alpha_{\\mathrm{hit}}$ 是使得 $z(\\alpha)$ 的任意分量违反边界 $l_i \\le z_i(\\alpha) \\le u_i$ 的最小正 $\\alpha$。\n\n对于第一个分量，$z_1(\\alpha) = 0.2 + 1.8\\alpha$:\n- 下界 ($l_1 = 0$): $0.2 + 1.8\\alpha = 0 \\implies 1.8\\alpha = -0.2 \\implies \\alpha = -1/9$。这不是正数。\n- 上界 ($u_1 = 1$): $0.2 + 1.8\\alpha = 1 \\implies 1.8\\alpha = 0.8 \\implies \\alpha = \\frac{0.8}{1.8} = \\frac{8}{18} = \\frac{4}{9}$。\n\n对于第二个分量，$z_2(\\alpha) = 0.8 - 1.8\\alpha$:\n- 下界 ($l_2 = 0$): $0.8 - 1.8\\alpha = 0 \\implies 1.8\\alpha = 0.8 \\implies \\alpha = \\frac{0.8}{1.8} = \\frac{8}{18} = \\frac{4}{9}$。\n- 上界 ($u_2 = 1$): $0.8 - 1.8\\alpha = 1 \\implies -1.8\\alpha = 0.2 \\implies \\alpha = -1/9$。这不是正数。\n\n导致某个分量触碰边界的最小正 $\\alpha$ 值为 $\\alpha = 4/9$。在此步长下，第一个分量同时触及其上界，第二个分量同时触及其下界。\n$$\n\\alpha_{\\mathrm{hit}} = \\frac{4}{9}\n$$\n\n### 任务 3：线搜索条件分析\n\n我们分析是否存在任何 $\\alpha > 0$ 能同时满足投影Armijo条件和强Wolfe条件。路径行为在 $\\alpha_{\\mathrm{hit}} = 4/9$ 处发生改变，因此我们分别分析 $(0, 4/9]$ 和 $(4/9, \\infty)$ 这两个区间。\n\n**情况 1：$0  \\alpha \\le 4/9$**\n在此区间内，路径 $z(\\alpha)$ 完全位于可行箱形区域内。因此，投影是恒等算子：$m^{+}(\\alpha) = z(\\alpha) = m - \\alpha \\nabla J(m)$。\n割线方向是常数：$p(\\alpha) = \\frac{(m - \\alpha \\nabla J(m)) - m}{\\alpha} = -\\nabla J(m)$。\nWolfe条件的各项变为：\n- 初始斜率项：$\\langle \\nabla J(m), p(\\alpha) \\rangle = \\langle \\nabla J(m), -\\nabla J(m) \\rangle = -\\|\\nabla J(m)\\|^2$。\n- 新斜率项：$\\nabla J(m^{+}(\\alpha)) = m^{+}(\\alpha) - b = (m - \\alpha \\nabla J(m)) - b = (m-b) - \\alpha \\nabla J(m) = (1-\\alpha)\\nabla J(m)$。斜率为 $\\langle (1-\\alpha)\\nabla J(m), -\\nabla J(m) \\rangle = -(1-\\alpha)\\|\\nabla J(m)\\|^2$。\n\n强Wolfe条件 $|\\langle \\nabla J(m^{+}(\\alpha)), p(\\alpha) \\rangle| \\le c_{2}|\\langle \\nabla J(m), p(\\alpha) \\rangle|$ 变为：\n$$\n|-(1-\\alpha)\\|\\nabla J(m)\\|^2| \\le c_2 |-\\|\\nabla J(m)\\|^2|\n$$\n假设 $\\alpha  1$（对于 $\\alpha \\le 4/9$ 成立），这可以简化为：\n$$\n(1-\\alpha)\\|\\nabla J(m)\\|^2 \\le c_2 \\|\\nabla J(m)\\|^2 \\implies 1 - \\alpha \\le c_2 \\implies \\alpha \\ge 1 - c_2\n$$\n当 $c_2 = 0.5$ 时，我们要求 $\\alpha \\ge 0.5$。然而，此区间由 $0  \\alpha \\le 4/9 \\approx 0.444$ 定义。由于 $0.5 > 4/9$，因此第一个区间内没有 $\\alpha$ 满足强Wolfe条件。\n\n**情况 2：$\\alpha > 4/9$**\n对于任何 $\\alpha > 4/9$，无约束点 $z(\\alpha)$ 位于箱形区域之外。其坐标为 $z_1(\\alpha) > 1$ 和 $z_2(\\alpha)  0$。将此点投影到箱形区域 $[0,1] \\times [0,1]$ 上，得到角点：\n$$\nm^{+}(\\alpha) = P_{[l,u]}(z(\\alpha)) = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}\n$$\n对于所有 $\\alpha > 4/9$，这个投影点是恒定的。\n现在，割线方向依赖于 $\\alpha$：\n$$\np(\\alpha) = \\frac{m^{+}(\\alpha) - m}{\\alpha} = \\frac{1}{\\alpha}\\left(\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0.2 \\\\ 0.8 \\end{pmatrix}\\right) = \\frac{1}{\\alpha}\\begin{pmatrix} 0.8 \\\\ -0.8 \\end{pmatrix}\n$$\n我们计算梯度和斜率：\n- 初始梯度：$\\nabla J(m) = \\begin{pmatrix} -1.8 \\\\ 1.8 \\end{pmatrix}$。\n- 新梯度：$\\nabla J(m^{+}(\\alpha)) = m^{+}(\\alpha) - b = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$。\n- 初始斜率项：$\\langle \\nabla J(m), p(\\alpha) \\rangle = \\left\\langle \\begin{pmatrix} -1.8 \\\\ 1.8 \\end{pmatrix}, \\frac{1}{\\alpha}\\begin{pmatrix} 0.8 \\\\ -0.8 \\end{pmatrix} \\right\\rangle = \\frac{1}{\\alpha}((-1.8)(0.8) + (1.8)(-0.8)) = -\\frac{2.88}{\\alpha}$。\n- 新斜率项：$\\langle \\nabla J(m^{+}(\\alpha)), p(\\alpha) \\rangle = \\left\\langle \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}, \\frac{1}{\\alpha}\\begin{pmatrix} 0.8 \\\\ -0.8 \\end{pmatrix} \\right\\rangle = \\frac{1}{\\alpha}((-1)(0.8) + (1)(-0.8)) = -\\frac{1.6}{\\alpha}$。\n\n强Wolfe条件为 $|-1.6/\\alpha| \\le c_2 |-2.88/\\alpha|$。由于 $\\alpha > 0$，这可以简化为：\n$$\n1.6 \\le c_2 (2.88)\n$$\n当 $c_2 = 0.5$ 时，我们有：\n$$\n1.6 \\le 0.5 \\times 2.88 \\implies 1.6 \\le 1.44\n$$\n这个不等式是错误的。因此，没有 $\\alpha > 4/9$ 能满足强Wolfe条件。\n\n**分析结论：**\n区间 $(0, 4/9]$ 和区间 $(4/9, \\infty)$ 都不包含满足 $c_2 = 0.5$ 的强Wolfe条件的 $\\alpha$ 值。在 $\\alpha_{\\mathrm{hit}}$ 处的投影在搜索路径上产生了一个扭结。对于 $\\alpha > \\alpha_{\\mathrm{hit}}$，迭代点固定在一个角点上，在此处梯度的模相对于初始梯度的模没有充分减小，以至于无法满足曲率条件。具体来说，沿行进方向的梯度内积之比（这正是Wolfe条件所检验的）大于 $c_2$。在此实例中，该条件实际上变为 $1 \\le 1.8 c_2$，对于 $c_2=0.5$ 而言不成立。然而，对于所有 $\\alpha > 4/9$，Armijo条件是满足的。\n\n问题只要求将 $\\alpha_{\\mathrm{hit}}$ 作为最终答案。\n$$\n\\alpha_{\\mathrm{hit}} = \\frac{4}{9}\n$$", "answer": "$$\\boxed{\\frac{4}{9}}$$", "id": "3578313"}]}