{"hands_on_practices": [{"introduction": "为何要使用同步震源？一个关键优势在于提高采集效率。但是，将震源混合然后分离，将如何影响数据质量，尤其是在存在噪声的情况下？第一个练习将提供一个定量的答案。通过分析一个带有正交编码的简化线性模型，你将推导出测量噪声的方差在解码过程中的传播方式，从而揭示震源编码中信号平均化的基本原理。[@problem_id:3614649]", "problem": "一次海上地震采集勘探使用带震源编码的同步源技术来加速用于反演的数据采集。在每个固定的时间采样点上，跨实验采集的数据可以被视为一个线性系统。共有 $N$ 个同步源，勘探执行 $K$ 次重复实验，其中震源由已知的编码进行调制。在一个固定时间采样点上的线性模型为\n$$\n\\mathbf{y} = \\mathbf{C}\\,\\mathbf{s} + \\mathbf{n},\n$$\n其中 $\\mathbf{y} \\in \\mathbb{R}^{K}$ 收集了 $K$ 次实验中测得的振幅，$\\mathbf{s} \\in \\mathbb{R}^{N}$ 收集了该时间采样点上未知的真实震源响应，$\\mathbf{C} \\in \\mathbb{R}^{K \\times N}$ 是已知的编码矩阵，而 $\\mathbf{n} \\in \\mathbb{R}^{K}$ 是测量噪声。假设满足以下物理和统计条件：\n- 编码矩阵 $\\mathbf{C}$ 的列向量是正交且等能量的，并且 $K \\ge N$。$\\mathbf{C}$ 的元素为 $\\pm 1$。因此，$\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$。\n- 噪声 $\\mathbf{n}$ 是零均值、白噪声，并且在各次实验之间是独立的，其协方差为 $\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] = \\sigma^{2}\\,\\mathbf{I}_{K}$，其中 $\\sigma^{2}$ 是每次实验每个时间采样点的噪声方差。\n- 解码通过求解线性最小二乘问题来获得估计值\n$$\n\\widehat{\\mathbf{s}} = \\arg\\min_{\\mathbf{z} \\in \\mathbb{R}^{N}} \\|\\mathbf{y} - \\mathbf{C}\\,\\mathbf{z}\\|_{2}^{2},\n$$\n这会得到标准的正规方程解 $\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{y}$。\n- 将振幅视为无量纲量，因此方差也是无量纲的。\n\n仅使用这些假设以及期望和协方差的线性性质，计算解码后在固定时间采样点上任意单个震源分量 $\\widehat{s}_{i}$ 的噪声方差。请用 $\\sigma$ 和 $K$ 表示你的最终答案，形式为一个精确的解析表达式。不需要进行数值舍入。最终答案必须是一个不带单位的单一表达式。", "solution": "用户希望我解决一个来自计算地球物理学的问题，具体是关于地震采集中的震源编码。\n\n### 步骤1：提取已知条件\n- 线性模型是 $\\mathbf{y} = \\mathbf{C}\\,\\mathbf{s} + \\mathbf{n}$。\n- $\\mathbf{y} \\in \\mathbb{R}^{K}$ 是 $K$ 次实验中测量到的振幅向量。\n- $\\mathbf{s} \\in \\mathbb{R}^{N}$ 是未知的真实震源响应向量。\n- $\\mathbf{C} \\in \\mathbb{R}^{K \\times N}$ 是已知的编码矩阵。\n- $\\mathbf{n} \\in \\mathbb{R}^{K}$ 是测量噪声向量。\n- $N$ 是同步源的数量。\n- $K$ 是重复实验的次数。\n- 约束条件 $K \\ge N$ 成立。\n- 编码矩阵 $\\mathbf{C}$ 的列向量正交且等能量，其元素为 $\\pm 1$。此性质可由方程 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$ 概括，其中 $\\mathbf{I}_{N}$ 是 $N \\times N$ 的单位矩阵。\n- 噪声 $\\mathbf{n}$ 是零均值的，即 $\\mathbb{E}[\\mathbf{n}] = \\mathbf{0}$。\n- 噪声协方差为 $\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] = \\sigma^{2}\\,\\mathbf{I}_{K}$，其中 $\\sigma^{2}$ 是每次实验的噪声方差，$\\mathbf{I}_{K}$ 是 $K \\times K$ 的单位矩阵。\n- 估计的震源响应向量 $\\widehat{\\mathbf{s}}$ 通过线性最小二乘解得到：$\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{y}$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题在科学上是合理的。它描述了一种使用编码震源对同步采集的地震数据进行解混的标准方法。线性模型、最小二乘估计以及关于噪声的统计假设是信号处理和反问题中的基本概念。编码矩阵 $\\mathbf{C}$ 的性质与实际中使用的矩阵（如哈达玛矩阵）的性质一致。\n- **适定性**：该问题是适定的。所有必需的变量和条件都已指明。条件 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$ 保证了矩阵 $\\mathbf{C}^{\\top}\\mathbf{C}$ 是可逆的（因为 $K \\neq 0$），从而确保 $\\widehat{\\mathbf{s}}$ 存在唯一解。目标是计算一个特定的、定义明确的统计量。\n- **客观性**：该问题是用精确、客观的数学语言陈述的。\n- **完备性与一致性**：该问题是自洽的，没有矛盾。给定的关系 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$ 与 $\\mathbf{C}$ 具有元素为 $\\pm 1$ 的正交列的描述是一致的。每个列向量 $\\mathbf{c}_{j}$ 的范数平方为 $\\mathbf{c}_{j}^{\\top}\\mathbf{c}_{j} = \\sum_{i=1}^{K} (\\pm 1)^{2} = K$。正交性意味着当 $i \\neq j$ 时 $\\mathbf{c}_{i}^{\\top}\\mathbf{c}_{j} = 0$。这些共同构成了 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$。\n- **结论**：该问题是有效的，可以按所述方式求解。\n\n### 步骤3：推导\n目标是计算单个解码后的震源分量 $\\widehat{s}_{i}$ 的方差，即 $\\mathrm{Var}(\\widehat{s}_{i})$。这是向量 $\\widehat{\\mathbf{s}}$ 的协方差矩阵（记为 $\\mathrm{Cov}(\\widehat{\\mathbf{s}})$）的第 $i$ 个对角线元素。\n\n首先，我们用真实震源 $\\mathbf{s}$ 和噪声 $\\mathbf{n}$ 来表示估计的震源向量 $\\widehat{\\mathbf{s}}$。我们将线性模型 $\\mathbf{y} = \\mathbf{C}\\,\\mathbf{s} + \\mathbf{n}$ 代入 $\\widehat{\\mathbf{s}}$ 的表达式中：\n$$\n\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}(\\mathbf{C}\\,\\mathbf{s} + \\mathbf{n})\n$$\n使用矩阵乘法的分配律：\n$$\n\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{C}\\,\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}\n$$\n项 $(\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{C}$ 化简为单位矩阵 $\\mathbf{I}_{N}$。因此，表达式变为：\n$$\n\\widehat{\\mathbf{s}} = \\mathbf{I}_{N}\\,\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n} = \\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}\n$$\n这个方程表明，估计向量 $\\widehat{\\mathbf{s}}$ 是真实信号向量 $\\mathbf{s}$ 与一个代表解码后噪声的项之和。我们来求 $\\widehat{\\mathbf{s}}$ 的期望值。由于 $\\mathbf{s}$ 和 $\\mathbf{C}$ 是确定性的，且期望算子是线性的：\n$$\n\\mathbb{E}[\\widehat{\\mathbf{s}}] = \\mathbb{E}[\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}] = \\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbb{E}[\\mathbf{n}]\n$$\n我们已知噪声是零均值的，即 $\\mathbb{E}[\\mathbf{n}] = \\mathbf{0}$。因此：\n$$\n\\mathbb{E}[\\widehat{\\mathbf{s}}] = \\mathbf{s}\n$$\n这表明最小二乘估计量是无偏的。\n\n接下来，我们计算 $\\widehat{\\mathbf{s}}$ 的协方差矩阵。协方差矩阵定义为 $\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\mathbb{E}[(\\widehat{\\mathbf{s}} - \\mathbb{E}[\\widehat{\\mathbf{s}}])(\\widehat{\\mathbf{s}} - \\mathbb{E}[\\widehat{\\mathbf{s}}])^{\\top}]$。\n代入 $\\mathbb{E}[\\widehat{\\mathbf{s}}] = \\mathbf{s}$，我们得到：\n$$\n\\widehat{\\mathbf{s}} - \\mathbb{E}[\\widehat{\\mathbf{s}}] = (\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}) - \\mathbf{s} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}\n$$\n所以协方差矩阵为：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\mathbb{E}\\left[ \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n} \\right) \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n} \\right)^{\\top} \\right]\n$$\n我们定义矩阵 $\\mathbf{A} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}$。表达式变为 $\\mathbb{E}[(\\mathbf{A}\\mathbf{n})(\\mathbf{A}\\mathbf{n})^{\\top}] = \\mathbb{E}[\\mathbf{A}\\mathbf{n}\\mathbf{n}^{\\top}\\mathbf{A}^{\\top}]$。由于 $\\mathbf{A}$ 是一个常数矩阵，我们可以将其从期望中提出来：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\mathbf{A}\\,\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}]\\,\\mathbf{A}^{\\top} = \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top} \\right) \\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top} \\right)^{\\top}\n$$\n我们已知 $\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] = \\sigma^{2}\\,\\mathbf{I}_{K}$。将其代入：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top} \\right) (\\sigma^{2}\\,\\mathbf{I}_{K}) \\left( \\mathbf{C}((\\mathbf{C}^{\\top}\\mathbf{C})^{-1})^{\\top} \\right)\n$$\n矩阵 $\\mathbf{C}^{\\top}\\mathbf{C}$ 是对称的，所以它的逆矩阵也是对称的，即 $((\\mathbf{C}^{\\top}\\mathbf{C})^{-1})^{\\top} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}$。表达式化简为：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\sigma^{2} (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{C}(\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\n$$\n由于 $\\mathbf{C}^{\\top}\\mathbf{C}$ 是可逆的，乘积 $(\\mathbf{C}^{\\top}\\mathbf{C})(\\mathbf{C}^{\\top}\\mathbf{C})^{-1}$ 是单位矩阵 $\\mathbf{I}_{N}$。\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\sigma^{2} (\\mathbf{C}^{\\top}\\mathbf{C})^{-1} \\mathbf{I}_{N} = \\sigma^{2} (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\n$$\n现在，我们使用编码矩阵的特定性质 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$。我们对这个表达式求逆：\n$$\n(\\mathbf{C}^{\\top}\\mathbf{C})^{-1} = (K\\,\\mathbf{I}_{N})^{-1} = \\frac{1}{K}\\mathbf{I}_{N}^{-1} = \\frac{1}{K}\\mathbf{I}_{N}\n$$\n将此结果代入我们的协方差矩阵表达式中：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\sigma^{2} \\left( \\frac{1}{K}\\mathbf{I}_{N} \\right) = \\frac{\\sigma^{2}}{K}\\mathbf{I}_{N}\n$$\n单个解码后的震源分量 $\\widehat{s}_{i}$ 的方差是协方差矩阵 $\\mathrm{Cov}(\\widehat{\\mathbf{s}})$ 的第 $i$ 个对角元素。\n$$\n\\mathrm{Var}(\\widehat{s}_{i}) = [\\mathrm{Cov}(\\widehat{\\mathbf{s}})]_{ii} = \\left[ \\frac{\\sigma^{2}}{K}\\mathbf{I}_{N} \\right]_{ii}\n$$\n由于单位矩阵 $\\mathbf{I}_{N}$ 的第 $i$ 个对角元素是 $1$，我们有：\n$$\n\\mathrm{Var}(\\widehat{s}_{i}) = \\frac{\\sigma^{2}}{K}\n$$\n这个结果与索引 $i$ 无关，意味着所有震源分量的解码后噪声方差是相同的。它与实验次数 $K$ 成反比，这是信号平均原理所预期的结果。", "answer": "$$\n\\boxed{\\frac{\\sigma^{2}}{K}}\n$$", "id": "3614649"}, {"introduction": "理论上，诸如沃尔什-哈达玛（Walsh-Hadamard）序列之类的确定性编码提供了完美的正交性，可以实现无瑕疵的震源分离。然而在现实中，地震勘探的物理几何结构会引入传播时延，这些时延会使编码在时间上发生偏移，从而破坏其正交性。这个动手编程练习要求你通过计算解码矩阵的条件数来量化这种退化，为评估在实际采集中震源分离过程的稳定性提供一个切实的度量。[@problem_id:3614647]", "problem": "您的任务是构建一个完整、可运行的程序，该程序用于量化在同步震源地震采集中，不规则空间炮点间距如何与确定性震源编码的正交性相互作用，并计算由此产生的去混叠条件数。您的程序必须基于以下有物理和数值基础的模型和定义。\n\n考虑一条一维海洋采集测线，在位置 $x_r$ 处有一个接收点，同时在 $\\{x_s^{(i)}\\}_{i=1}^S$ 位置有 $S$ 个同步激发的震源。每个震源由一个长度为 $N$ 个采样的确定性二进制序列 $\\{c_i[n]\\}_{n=0}^{N-1}$ 进行编码，这些序列是作为 $N$ 阶 Walsh–Hadamard 矩阵的不同列向量生成的。采样频率为 $f_s$ 赫兹，恒定传播速度为 $v$ 米/秒。在接收点记录到的混叠数据被建模为震源响应经其编码调制的线性叠加。为分离编码正交性与几何构型相互作用的影响，假设每个震源的编码因几何走时而发生时移，使其在去混叠系统矩阵中的有效贡献是其编码的一个时移和窗截断版本。\n\n将震源 $i$ 的整数时移定义为\n$$\nm_i = \\text{round}\\!\\left( \\frac{|x_s^{(i)} - x_r|}{v} f_s \\right),\n$$\n对应于走时 $|x_s^{(i)} - x_r|/v$ 秒所引起的离散采样延迟。令 $\\mathbf{A} \\in \\mathbb{R}^{N \\times S}$ 表示去混叠矩阵，其第 $i$ 列是经过向右平移 $m_i$ 个采样并补零的编码 $\\{c_i[n]\\}$，即\n$$\na_i[n] = \n\\begin{cases}\n0,  0 \\le n  m_i, \\\\\nc_i[n - m_i],  m_i \\le n \\le N-1.\n\\end{cases}\n$$\n去混叠法线矩阵（几何时移下的编码格拉姆矩阵）为 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A} \\in \\mathbb{R}^{S \\times S}$。去混叠条件数定义为\n$$\n\\kappa(\\mathbf{G}) = \\frac{\\lambda_{\\max}(\\mathbf{G})}{\\lambda_{\\min}(\\mathbf{G})},\n$$\n其中 $\\lambda_{\\max}(\\mathbf{G})$ 和 $\\lambda_{\\min}(\\mathbf{G})$ 分别表示 $\\mathbf{G}$ 的最大和最小特征值。较大的 $\\kappa(\\mathbf{G})$ 表示由于诱发时移下编码震源的有效正交性退化，导致去混叠的稳定性较差。\n\n从波场的线性叠加原理和均匀采样下确定性编码正交性的定义出发，推导为以下测试套件构建矩阵 $\\mathbf{A}$、组合矩阵 $\\mathbf{G}$ 并计算 $\\kappa(\\mathbf{G})$ 的计算流程。所有距离必须以米（m）为单位，速度以米/秒（m/s）为单位，采样频率以赫兹（Hz）为单位。输出（条件数）是无量纲的浮点数。\n\n测试套件参数集：\n\n1. 案例1（基准规则间距，即零几何延迟）：\n   - $N = 128$，$f_s = 500$ Hz，$v = 1500$ m/s，$x_r = 0$ m，$S = 8$，\n   - 炮点位置 $x_s^{(i)}$：对于 $i = 1, \\dots, 8$，所有位置均为 $0$ m。\n\n2. 案例2（轻度不规则间距，产生微小但不同的采样延迟）：\n   - $N = 128$，$f_s = 500$ Hz，$v = 1500$ m/s，$x_r = 0$ m，$S = 8$，\n   - 炮点位置 $x_s^{(i)} \\in \\{0, 3, 6, 9, 12, 15, 18, 21\\}$ m。\n\n3. 案例3（强不规则间距，其中一个远震源导致大延迟和窗截断）：\n   - $N = 128$，$f_s = 500$ Hz，$v = 1500$ m/s，$x_r = 0$ m，$S = 8$，\n   - 炮点位置 $x_s^{(i)} \\in \\{0, 3, 6, 9, 354, 12, 15, 18\\}$ m。\n\n4. 案例4（增加同步震源数量，具有更宽的不规则延迟）：\n   - $N = 128$，$f_s = 1000$ Hz，$v = 1500$ m/s，$x_r = 0$ m，$S = 32$，\n   - 炮点位置 $x_s^{(i)}$ 由列表明确给出：\n     $\\{0, 2.0, 1.5, 4.0, 3.5, 7.0, 6.5, 9.0, 10.5, 13.0, 12.5, 16.0, 17.5, 20.0, 22.5, 25.0, 27.5, 30.0, 33.5, 36.0, 38.5, 41.0, 43.5, 46.0, 48.5, 50.0, 52.5, 55.0, 57.5, 60.0, 62.5, 65.0\\}$ m。\n\n实现要求：\n\n- 确定性编码必须取自一个 $N$ 阶 Walsh–Hadamard 矩阵的前 $S$ 列。\n- 时移必须应用为长度为 $N$ 个采样的带补零和截断的右移。\n- $\\mathbf{G}$ 的特征值必须通过数值计算得出，条件数必须按上述定义进行评估。如果由于舍入误差，$\\lambda_{\\min}(\\mathbf{G})$ 在数值上为非正数，则将条件数视为无穷大。\n- 您的程序必须生成单行输出，其中包含四个案例的四个条件数，形式为方括号括起来的逗号分隔列表。每个条件数必须四舍五入到六位小数。例如：“[1.000000,1.234567,3.210000,5.678901]”。", "solution": "该问题要求计算几种同步震源地震采集场景下的去混叠条件数。该数值量化了分离各独立震源信号（一个称为去混叠的过程）的数值稳定性。问题的核心在于确定性震源编码（被选择为正交的）与采集几何构型（引入了破坏这种正交性的时移）之间的相互作用。\n\n解决方案将遵循以下基本原则推导得出：\n1.  使用 Walsh-Hadamard 矩阵生成正交震源编码。\n2.  计算每个震源由几何构型引起的时间延迟。\n3.  通过将这些时间延迟应用于震源编码来构建去混叠矩阵 $\\mathbf{A}$。\n4.  形成法线矩阵 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A}$。\n5.  根据其特征值计算条件数 $\\kappa(\\mathbf{G})$。\n\n**1. 正交震源编码**\n在同步震源采集中，每个震源都由一个独特的编码进行调制，以便后续分离。理想的编码是相互正交的。该问题指定使用 Walsh-Hadamard 矩阵的列。一个 $N$ 阶（其中 $N$ 是2的幂）的 Walsh-Hadamard 矩阵 $\\mathbf{H}_N$ 是一个元素为 $+1$ 和 $-1$ 的方阵。其定义特性是其列（和行）相互正交。具体来说，对于任意两个不同的列 $\\mathbf{c}_i$ 和 $\\mathbf{c}_j$，它们的点积为零：$\\mathbf{c}_i^\\top \\mathbf{c}_j = 0$。任意列的平方范数为 $\\mathbf{c}_i^\\top \\mathbf{c}_i = N$。这种正交性可以通过矩阵方程 $\\mathbf{H}_N^\\top \\mathbf{H}_N = N \\mathbf{I}_N$ 来概括，其中 $\\mathbf{I}_N$ 是 $N$ 阶单位矩阵。\n\n对于这个问题，$S$ 个震源的编码是 $\\mathbf{H}_N$ 的前 $S$ 列，记为 $\\{\\mathbf{c}_i\\}_{i=1}^S$。如果没有时间延迟，去混叠矩阵 $\\mathbf{A}$ 将只是矩阵 $\\mathbf{C} = [\\mathbf{c}_1, \\dots, \\mathbf{c}_S]$。法线矩阵将是 $\\mathbf{G} = \\mathbf{C}^\\top \\mathbf{C}$，这是一个对角线上所有元素均为 $N$ 的 $S \\times S$ 对角矩阵。对于这样的矩阵，$\\lambda_{\\max}(\\mathbf{G}) = \\lambda_{\\min}(\\mathbf{G}) = N$，条件数 $\\kappa(\\mathbf{G}) = 1$。这代表一个完全良态的去混叠问题。\n\n**2. 几何构型引起的时间延迟**\n从位置为 $x_s^{(i)}$ 的震源发出的地震波以速度 $v$ 传播到位置为 $x_r$ 的接收点。传播时间为 $\\Delta t_i = |x_s^{(i)} - x_r|/v$。在采样频率为 $f_s$ 的数字采样系统中，这个连续的时间延迟对应于 $m_i$ 个采样的离散时移。根据问题中的定义，这个整数时移计算如下：\n$$\nm_i = \\text{round}\\!\\left( \\frac{|x_s^{(i)} - x_r|}{v} f_s \\right)\n$$\n\n**3. 去混叠矩阵 $\\mathbf{A}$**\n震源 $i$ 的时间延迟 $m_i$ 意味着其编码序列 $\\mathbf{c}_i$ 在记录的数据道中实际上晚了 $m_i$ 个采样开始。这通过构建一组新的“有效”编码向量 $\\{\\mathbf{a}_i\\}_{i=1}^S$ 来建模，这些向量构成了去混叠矩阵 $\\mathbf{A}$ 的列。向量 $\\mathbf{a}_i$ 是原始编码向量 $\\mathbf{c}_i$ 的一个右移和截断版本。$\\mathbf{A}$ 的第 $i$ 列的第 $n$ 个元素由下式给出：\n$$\na_i[n] = \n\\begin{cases}\n0,  0 \\le n  m_i \\\\\nc_i[n - m_i],  m_i \\le n \\le N-1\n\\end{cases}\n$$\n此操作在编码的开头用 $m_i$ 个零进行填充，并截断编码的末尾，因此得到的向量 $\\mathbf{a}_i$ 的长度仍为 $N$。如果 $m_i \\ge N$，则整个向量 $\\mathbf{a}_i$ 将为零。\n\n**4. 法线矩阵 $\\mathbf{G}$ 及其条件数**\n去混叠法线矩阵定义为 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A}$。元素 $G_{ij}$ 是时移后编码向量的点积：$G_{ij} = \\mathbf{a}_i^\\top \\mathbf{a}_j$。由于时移，即使当 $i \\ne j$ 时 $\\mathbf{c}_i^\\top \\mathbf{c}_j = 0$，点积 $\\mathbf{a}_i^\\top \\mathbf{a}_j$ 通常也非零。这些非零的非对角元素代表了在接收点处测得的震源之间的“串扰”或正交性损失。对角元素 $G_{ii} = \\mathbf{a}_i^\\top \\mathbf{a}_i$ 代表了时移和截断后编码的能量，它小于或等于原始能量 $N$。\n\n$\\mathbf{G}$ 的条件数，定义为 $\\kappa(\\mathbf{G}) = \\lambda_{\\max}(\\mathbf{G}) / \\lambda_{\\min}(\\mathbf{G})$，衡量了去混叠问题的稳定性。$\\kappa(\\mathbf{G}) = 1$ 是理想值。大的条件数表示 $\\mathbf{G}$ 接近奇异，表明数据中的小误差可能导致分离出的震源信号出现大误差。这意味着一个病态且数值不稳定的去混叠问题。如果 $\\mathbf{G}$ 变为奇异矩阵，则 $\\lambda_{\\min}(\\mathbf{G}) = 0$，条件数被认为是无穷大。\n\n**计算算法**\n为计算每个测试案例的条件数，执行以下步骤：\n1.  获取参数：编码长度 $N$、震源数量 $S$、采样频率 $f_s$、速度 $v$、接收点位置 $x_r$ 以及震源位置 $\\{x_s^{(i)}\\}$。\n2.  生成 $N \\times N$ 的 Walsh-Hadamard 矩阵 $\\mathbf{H}_N$。取其前 $S$ 列作为震源编码，形成 $N \\times S$ 矩阵 $\\mathbf{C}$。\n3.  对于每个震源 $i=1, \\dots, S$，使用给定公式计算整数采样时移 $m_i$。\n4.  为 $\\mathbf{A}$ 初始化一个 $N \\times S$ 的零矩阵。\n5.  对于每个震源 $i$，通过将编码 $\\mathbf{c}_i$ 平移 $m_i$ 个采样来构建其对应的列 $\\mathbf{a}_i$，并根据定义应用补零和截断。如果 $m_i  N$，则将 $\\mathbf{c}_i$ 的前 $N-m_i$ 个元素放入 $\\mathbf{a}_i$ 中从索引 $m_i$ 开始的位置。\n6.  计算 $S \\times S$ 的法线矩阵 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A}$。\n7.  计算实对称矩阵 $\\mathbf{G}$ 的特征值。\n8.  找出最大特征值 $\\lambda_{\\max}$ 和最小特征值 $\\lambda_{\\min}$。\n9.  如果 $\\lambda_{\\min} \\le 0$，则条件数视为无穷大。否则，计算为 $\\kappa(\\mathbf{G}) = \\lambda_{\\max} / \\lambda_{\\min}$。\n10. 最终值四舍五入到六位小数。\n\n此程序将应用于指定的四个测试案例中的每一个。\n- 案例1代表理想情况，没有时移（所有 $i$ 的 $m_i = 0$），此时 $\\mathbf{A}=\\mathbf{C}$，保持了完美的正交性，得出 $\\kappa(\\mathbf{G}) = 1$。\n- 案例2引入了微小但不同的时移，导致正交性轻微退化，条件数略大于 $1$。\n- 案例3包含一个具有大时移的震源，导致其编码被严重截断。预计这将严重影响正交性并大幅增加条件数。\n- 案例4增加了震源密度 ($S=32$)，导致更复杂的串扰相互作用，并可能产生更高的条件数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import hadamard\n\ndef solve():\n    \"\"\"\n    Computes the deblending condition number for four simultaneous-source\n    seismic acquisition scenarios.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 128, \"fs\": 500, \"v\": 1500, \"xr\": 0, \"S\": 8,\n            \"xs\": np.array([0, 0, 0, 0, 0, 0, 0, 0], dtype=float)\n        },\n        {\n            \"N\": 128, \"fs\": 500, \"v\": 1500, \"xr\": 0, \"S\": 8,\n            \"xs\": np.array([0, 3, 6, 9, 12, 15, 18, 21], dtype=float)\n        },\n        {\n            \"N\": 128, \"fs\": 500, \"v\": 1500, \"xr\": 0, \"S\": 8,\n            \"xs\": np.array([0, 3, 6, 9, 354, 12, 15, 18], dtype=float)\n        },\n        {\n            \"N\": 128, \"fs\": 1000, \"v\": 1500, \"xr\": 0, \"S\": 32,\n            \"xs\": np.array([\n                0, 2.0, 1.5, 4.0, 3.5, 7.0, 6.5, 9.0, 10.5, 13.0, 12.5, 16.0, \n                17.5, 20.0, 22.5, 25.0, 27.5, 30.0, 33.5, 36.0, 38.5, 41.0, \n                43.5, 46.0, 48.5, 50.0, 52.5, 55.0, 57.5, 60.0, 62.5, 65.0\n            ], dtype=float)\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        fs = case[\"fs\"]\n        v = case[\"v\"]\n        xr = case[\"xr\"]\n        S = case[\"S\"]\n        xs = case[\"xs\"]\n\n        # Step 1: Generate Walsh-Hadamard matrix and extract codes\n        # The codes are the first S columns of the Hadamard matrix.\n        H = hadamard(N)\n        C = H[:, :S]\n\n        # Step 2: Calculate integer time shifts for each source\n        shifts_m = np.round(np.abs(xs - xr) / v * fs).astype(int)\n\n        # Step 3: Construct the deblending matrix A by applying shifts\n        A = np.zeros((N, S), dtype=float)\n        for i in range(S):\n            m_i = shifts_m[i]\n            if m_i  N:\n                # The length of the code segment that fits\n                code_len = N - m_i\n                # Get the code for the current source\n                code_i = C[:, i]\n                # Place the truncated code into the shifted position in A\n                A[m_i:, i] = code_i[:code_len]\n        \n        # Step 4: Compute the normal matrix G = A^T * A\n        G = A.T @ A\n\n        # Step 5: Compute eigenvalues of G\n        # eigvalsh is used for real symmetric matrices, it is efficient and returns sorted eigenvalues.\n        eigenvalues = np.linalg.eigvalsh(G)\n        \n        lambda_min = eigenvalues[0]  # Smallest eigenvalue\n        lambda_max = eigenvalues[-1] # Largest eigenvalue\n\n        # Step 6: Calculate the condition number\n        # As per problem, if lambda_min is non-positive, treat as infinite.\n        if lambda_min = 1e-9: # Use a small tolerance for floating point comparison\n            cond_num = np.inf\n        else:\n            cond_num = lambda_max / lambda_min\n            \n        results.append(cond_num)\n\n    # Format the results as specified: a list of strings rounded to 6 decimal places.\n    # Handle the case of an infinite condition number.\n    formatted_results = []\n    for r in results:\n        if np.isinf(r):\n            formatted_results.append(\"inf\") \n        else:\n            formatted_results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "3614647"}, {"introduction": "除了基本的正交性，保证混合震源能够被唯一分离的严格数学条件是什么？这个高级问题通过使用哈特里-拉奥（Khatri-Rao）积来对该过程进行建模，深入探讨了震源编码的理论核心。通过推导与格拉姆（Gram）矩阵和克鲁斯卡尔（Kruskal）秩相关的性质，你将建立一个强有力的震源可分离性充分条件，从而深刻理解震源子波、编码方案以及成功解码的最低要求之间的相互作用。[@problem_id:3614654]", "problem": "在全波形反演（FWI）的同时震源地震采集中，时域震源编码被用来减少模拟次数，同时保持单个震源贡献的可恢复性（可分离性）。考虑一个有限时长的离散时间震源子波矩阵 $S \\in \\mathbb{R}^{T \\times Q}$，其列收集了 $Q$ 个不同物理震源的 $T$ 个采样点的时间序列，以及一个采集编码矩阵 $C \\in \\mathbb{R}^{M \\times Q}$，其行对应于 $M$ 次混合实验。联合时空编码的震源矩阵按列建模为 Khatri–Rao 积 $S_{\\mathrm{enc}} = S \\odot C \\in \\mathbb{R}^{TM \\times Q}$，其中 $S_{\\mathrm{enc}}$ 的第 $q$ 列是 $S$ 的第 $q$ 列与 $C$ 的第 $q$ 列的 Kronecker 积。假设无噪声线性传播，因此在数据层面上的可分离性（唯一的反混合）等价于 $S_{\\mathrm{enc}}$ 具有满列秩。\n\n仅从 Khatri–Rao 积、Gram 矩阵的定义，以及秩和 Schur (Hadamard) 积的基本性质出发，完成以下任务：\n\n1. 推导 $S_{\\mathrm{enc}}$ 的 Gram 矩阵关于 Gram 矩阵 $S^{\\top} S$ 和 $C^{\\top} C$ 的精确恒等式，并用它来建立一个充分条件，在该条件下 $S_{\\mathrm{enc}}$ 具有满列秩 $Q$。\n\n2. 引入 Kruskal 秩（也称为 k-秩）：对于一个矩阵 $A \\in \\mathbb{R}^{n \\times Q}$，其 Kruskal 秩 $k_{A}$ 是使得 $A$ 的任意 $k$ 列都线性无关的最大整数 $k$。仅使用基本线性代数，证明 Khatri–Rao 积的 Kruskal 秩的一个下界，并由此推導出一个混合震源可分离性的充分条件，该条件表示为一个包含 $k_{S}$、$k_{C}$ 和 $Q$ 的不等式。\n\n3. 假设 $C$ 是随机抽取的，其元素为独立的标准高斯分布，因此其 Kruskal 秩 $k_{C} = \\min(M, Q)$ 的概率为 1。再假设 $S$ 是固定的，其 Kruskal 秩为 $k_{S}$。此外，还需要 $S_{\\mathrm{enc}}$ 具有满列秩的维度可行性条件，即 $TM \\geq Q$。找出最小的整数 $M$（表示为 $Q$、$T$ 和 $k_{S}$ 的显式表达式），它能在 $C$ 的随机抽取下以概率 1 保证 $S_{\\mathrm{enc}}$ 具有满列秩，从而保证混合采集是可分离的。你的最终答案必须是这个最小 $M$ 的单一闭式解析表达式。不包含单位。不要四舍五入。", "solution": "该问题被评估为有效，因为它在计算地球物理学方面有科学依据，在数学上是适定的、客观的且内部一致的。它基于给定的定义提出了一系列严谨且不平凡的推导。\n\n令 $S \\in \\mathbb{R}^{T \\times Q}$ 为震源子波矩阵，$C \\in \\mathbb{R}^{M \\times Q}$ 为采集编码矩阵。这些矩阵的列表示为 $s_q$ 和 $c_q$，其中 $q = 1, \\dots, Q$。联合编码的震源矩阵由 Khatri-Rao 积给出：$S_{\\mathrm{enc}} = S \\odot C \\in \\mathbb{R}^{TM \\times Q}$，其第 $q$ 列是 Kronecker 积 $s_q \\otimes c_q$。震源的可分离性等价于 $S_{\\mathrm{enc}}$ 具有满列秩，即 $\\mathrm{rank}(S_{\\mathrm{enc}}) = Q$。\n\n**1. Gram 矩阵恒等式与可分离性的充分条件**\n\n我们首先推导 $S_{\\mathrm{enc}}$ 的 Gram 矩阵的恒等式，即 $G_{\\mathrm{enc}} = S_{\\mathrm{enc}}^{\\top} S_{\\mathrm{enc}}$。这个 $Q \\times Q$ 矩阵的第 $(i, j)$ 个元素由 $S_{\\mathrm{enc}}$ 的第 $i$ 列和第 $j$ 列的内积给出：\n$$ (G_{\\mathrm{enc}})_{ij} = (s_i \\otimes c_i)^{\\top} (s_j \\otimes c_j) $$\n使用 Kronecker 积的性质 $(A \\otimes B)^{\\top} = A^{\\top} \\otimes B^{\\top}$，我们有：\n$$ (G_{\\mathrm{enc}})_{ij} = (s_i^{\\top} \\otimes c_i^{\\top}) (s_j \\otimes c_j) $$\n接下来，我们使用 Kronecker 积的混合积性质，$(A \\otimes B)(D \\otimes F) = (AD) \\otimes (BF)$：\n$$ (G_{\\mathrm{enc}})_{ij} = (s_i^{\\top} s_j) \\otimes (c_i^{\\top} c_j) $$\n项 $s_i^{\\top} s_j$ 和 $c_i^{\\top} c_j$ 是标量内积。两个标量的 Kronecker 积就是它们的标量积。令 $(S^{\\top}S)_{ij} = s_i^{\\top} s_j$ 和 $(C^{\\top}C)_{ij} = c_i^{\\top} c_j$ 分别为 $S$ 和 $C$ 的 Gram 矩阵的元素。那么，\n$$ (G_{\\mathrm{enc}})_{ij} = (S^{\\top}S)_{ij} (C^{\\top}C)_{ij} $$\n这种逐元素乘积是 Schur (或 Hadamard) 积的定义，用 $*$ 表示。因此，$S_{\\mathrm{enc}}$ 的 Gram 矩阵的恒等式为：\n$$ S_{\\mathrm{enc}}^{\\top} S_{\\mathrm{enc}} = (S^{\\top} S) * (C^{\\top} C) $$\n矩阵 $S_{\\mathrm{enc}}$ 具有满列秩 $Q$ 当且仅当其 Gram 矩阵 $S_{\\mathrm{enc}}^{\\top} S_{\\mathrm{enc}}$ 是可逆的（即非奇异，或满秩 $Q$）。矩阵 $S^{\\top}S$ 和 $C^{\\top}C$ 是 Gram 矩阵，因此是半正定的。Schur 的一个定理指出，两个半正定矩阵的 Schur 积也是半正定的。一个更强的结果，Oppenheim 不等式，为该乘积是正定的（因此是可逆的）提供了一个充分条件。如果 $A$ 和 $B$ 是正定矩阵，它们的 Schur 积 $A * B$ 也是正定的。一个矩阵具有正定的 Gram 矩阵当且仅当它具有满列秩。因此，$S_{\\mathrm{enc}}^{\\top} S_{\\mathrm{enc}}$ 是正定的一个充分条件是 $S^{\\top} S$ 和 $C^{\\top} C$ 都是正定的。这等价于要求 $S$ 和 $C$ 都具有满列秩 $Q$。\n\n**2. Kruskal 秩与一个新的充分条件**\n\n矩阵 $A$ 的 Kruskal 秩 $k_A$ 是使得 $A$ 的任意 $k$ 列都线性无关的最大整数 $k$。我们寻求 $k_{S_{\\mathrm{enc}}}$ 的一个下界。让我们确定 $S_{\\mathrm{enc}}$ 的线性相关列集的最小尺寸 $r$。这个最小尺寸将是 $k_{S_{\\mathrm{enc}}} + 1$。\n\n假设 $S_{\\mathrm{enc}}$ 的 $r$ 列（由集合 $J$ 索引，其中 $|J|=r$）是线性相关的。这意味着存在一个非零向量 $\\alpha \\in \\mathbb{R}^r$ 使得 $\\sum_{j \\in J} \\alpha_j (s_j \\otimes c_j) = 0$。通过将每一项 $s_j \\otimes c_j$重塑为一个秩为 1 的矩阵 $c_j s_j^{\\top}$，我们得到等价的矩阵方程：\n$$ \\sum_{j \\in J} \\alpha_j c_j s_j^{\\top} = \\mathbf{0} $$\n令 $S_J$ 和 $C_J$ 分别为 $S$ 和 $C$ 中由 $J$ 索引的列组成的子矩阵。令 $D = \\mathrm{diag}(\\alpha_j)_{j \\in J}$，这是一个可逆的 $r \\times r$ 矩阵，因为我们只考虑非零系数。该方程可以写成：\n$$ C_J D S_J^{\\top} = \\mathbf{0} $$\n使用 Sylvester 秩不等式，$\\mathrm{rank}(A) + \\mathrm{rank}(B) - n \\le \\mathrm{rank}(AB)$，对于 $A \\in \\mathbb{R}^{m \\times n}, B \\in \\mathbb{R}^{n \\times p}$，我们将其应用于乘积 $(C_J D)$ 和 $S_J^{\\top}$：\n$$ \\mathrm{rank}(C_J D) + \\mathrm{rank}(S_J^{\\top}) - r \\le \\mathrm{rank}(C_J D S_J^{\\top}) = 0 $$\n由于 $D$ 是可逆的，$\\mathrm{rank}(C_J D) = \\mathrm{rank}(C_J)$。同时，$\\mathrm{rank}(S_J^{\\top}) = \\mathrm{rank}(S_J)$。不等式变为：\n$$ \\mathrm{rank}(C_J) + \\mathrm{rank}(S_J) \\le r $$\n现在我们使用 Kruskal 秩的定义。一个 Kruskal 秩为 $k_A$ 的矩阵 $A$ 意味着对于任何有 $r$ 列的子矩阵 $A_J$，$\\mathrm{rank}(A_J) \\ge \\min(r, k_A)$。这是因为如果 $\\mathrm{rank}(A_J)  \\min(r,k_A)$，那么存在一个大小为 $\\mathrm{rank}(A_J)+1 \\le k_A$（如果 $r>k_A$）或 $r \\le k_A$（如果 $r \\le k_A$）的线性相关列子集，这与 $k_A$ 的定义相矛盾。\n将此性质应用于 $S_J$ 和 $C_J$：\n$$ \\min(r, k_S) + \\min(r, k_C) \\le r $$\n我们寻找使这个不等式能够成立的最小整数 $r \\ge 1$。\n- 如果 $r \\le \\min(k_S, k_C)$，不等式变为 $r + r \\le r \\implies r \\le 0$，这对于 $r \\ge 1$ 是不可能的。\n- 如果 $k_C  r \\le k_S$，不等式变为 $r + k_C \\le r \\implies k_C \\le 0$，对于非平凡的 $C$ 是不可能的。\n- 如果 $k_S  r \\le k_C$，不等式变为 $k_S + r \\le r \\implies k_S \\le 0$，对于非平凡的 $S$ 是不可能的。\n- 如果 $r > k_S$ 且 $r > k_C$，不等式变为 $k_S + k_C \\le r$。\n只有当 $r \\ge k_S + k_C$ 时，才可能出现线性相关。可能出现相关的最小整数 $r$ 是 $r = k_S + k_C$。这意味着任何大小不超过 $k_S + k_C - 1$ 的列集都必须是线性无关的。\n因此，我们得到了 Khatri-Rao 积的 Kruskal 秩的下界：\n$$ k_{S_{\\mathrm{enc}}} \\ge k_S + k_C - 1 $$\n为了可分离性，我们要求 $S_{\\mathrm{enc}}$ 具有满列秩 $Q$。这等价于要求其 $Q$ 列线性无关，即 $k_{S_{\\mathrm{enc}}} \\ge Q$。因此，可分离性的一个充分条件是：\n$$ k_S + k_C - 1 \\ge Q $$\n\n**3. 最小混合实验次数 $M$**\n\n我们已知 $C$ 是一个具有独立标准高斯分布元素的随机矩阵。对于这样的矩阵，任意 $k \\le \\min(M, Q)$ 列的集合都以概率 1 线性无关。因此，其 Kruskal 秩为 $k_C = \\min(M, Q)$。我们还已知 $TM \\times Q$ 矩阵 $S_{\\mathrm{enc}}$ 具有满列秩的一个必要条件是行数至少等于列数：$TM \\ge Q$。\n\n我们寻求以概率 1 保证可分离性的最小整数 $M$。这需要同时满足来自 Kruskal 秩分析的充分条件和必要的维度条件。\n\n充分条件是 $k_S + k_C - 1 \\ge Q$。代入 $k_C = \\min(M, Q)$：\n$$ k_S + \\min(M, Q) - 1 \\ge Q $$\n让我们分析 $\\min(M, Q)$ 这一项：\n- 如果 $M \\ge Q$，则 $\\min(M, Q) = Q$。不等式变为 $k_S + Q - 1 \\ge Q$，简化为 $k_S \\ge 1$。对于任何非平凡的震源矩阵 $S$，其 Kruskal 秩至少为 1，因此对于任何 $M \\ge Q$，该条件都满足。\n- 如果 $M  Q$，则 $\\min(M, Q) = M$。不等式变为 $k_S + M - 1 \\ge Q$，我们解出 $M$：\n$$ M \\ge Q - k_S + 1 $$\n结合这些情况，我们需要 $M$ 满足 ($M \\ge Q$) 或 ($M  Q$ 且 $M \\ge Q - k_S + 1$)。这等价于单个条件 $M \\ge Q - k_S + 1$。要理解这一点，请注意如果 $k_S=1$，条件变为 $M \\ge Q$。如果 $k_S > 1$，则 $Q - k_S + 1  Q$，条件 $M \\ge Q-k_S+1$ 是约束性条件。\n\n因此，从震源可分离性的要求来看，我们需要 $M \\ge Q - k_S + 1$。\n\n维度可行性要求是 $TM \\ge Q$，这意味着 $M \\ge \\frac{Q}{T}$。由于 $M$ 必须是整数，这等价于 $M \\ge \\lceil \\frac{Q}{T} \\rceil$。\n\n为了保证可分离性，$M$ 必须同时满足这两个条件。因此，$M$ 的最小整数值必须是两个下界中的最大值：\n$$ M_{\\min} = \\max \\left( Q - k_S + 1, \\left\\lceil \\frac{Q}{T} \\right\\rceil \\right) $$\n该表达式给出了满足秩的必要条件和从 Kruskal 秩不等式导出的可分离性充分条件的最小整数 $M$。", "answer": "$$ \\boxed{\\max\\left(Q - k_S + 1, \\left\\lceil \\frac{Q}{T} \\right\\rceil\\right)} $$", "id": "3614654"}]}