{"hands_on_practices": [{"introduction": "在分析单细胞测序数据时，我们经常观察到基因表达计数的方差远大于其均值，这种现象被称为“过离散”。本练习将指导你使用矩估计法，为这类数据拟合一个能够捕捉该特征的负二项分布模型 [@problem_id:3340523]。通过这个过程，你不仅能掌握一种重要的参数估计技术，还将深入探讨模型参数的可辨识性问题，特别是在数据接近泊松分布的极限情况下。", "problem": "一个克隆细胞群体对特定种类的信使核糖核酸（mRNA）表现出转录爆发，导致通过单细胞RNA测序（RNA-seq）测量的单个细胞间的计数呈过度离散。此类计数的一个标准模型是参数为 $(r,p)$ 的负二项分布，记作 $\\mathrm{NB}(r,p)$，其参数化形式如下：对于 $k \\in \\{0,1,2,\\dots\\}$，\n$$\n\\mathbb{P}(Y=k) \\;=\\; \\binom{k+r-1}{k} (1-p)^{k} p^{r}, \\quad r>0,\\; p\\in(0,1).\n$$\n在此参数化下，前两阶矩为\n$$\n\\mathbb{E}[Y] \\;=\\; \\frac{r(1-p)}{p}, \n\\qquad\n\\mathrm{Var}(Y) \\;=\\; \\frac{r(1-p)}{p^{2}}.\n$$\n从该群体中抽取的一个大的独立同分布样本，得到样本均值 $\\bar{y}$ 和样本方差 $s^{2}$。在一次特定实验中，汇总统计量为 $\\bar{y} = 7.5$ 和 $s^{2} = 22.5$。\n\n使用矩量法，完成以下任务：\n- 通过令样本矩等于模型矩，求解 $(r,p)$ 关于 $\\bar{y}$ 和 $s^{2}$ 的表达式，从而推导出矩量法估计量 $\\hat{r}$ 和 $\\hat{p}$。\n- 将 $\\bar{y} = 7.5$ 和 $s^{2} = 22.5$ 代入你的表达式求值，并报告 $(\\hat{r},\\hat{p})$ 的数值。将答案四舍五入至4位有效数字。\n- 从基本原理出发，分析在 $\\bar{y}$ 固定且 $s^{2} \\to \\bar{y}^{+}$ 的情况下，矩量法下 $(r,p)$ 的可辨识性。明确说明 $\\hat{r}$ 和 $\\hat{p}$ 的极限行为，并从模型可区分性的角度对其进行解释。\n\n将最终数值答案表示为有序对 $(\\hat{r},\\hat{p})$。无需单位。", "solution": "首先，我们推导参数 $(r,p)$ 的矩量法（MoM）估计量 $\\hat{r}$ 和 $\\hat{p}$。矩量法步骤是将概率分布的理论矩与从数据中计算出的相应样本矩相等。\n\n给定负二项分布 $\\mathrm{NB}(r,p)$ 的理论均值和方差为：\n$$ \\mathbb{E}[Y] = \\frac{r(1-p)}{p} $$\n$$ \\mathrm{Var}(Y) = \\frac{r(1-p)}{p^2} $$\n样本矩是样本均值 $\\bar{y}$ 和样本方差 $s^2$。矩量法的方程组为：\n$$ \\bar{y} = \\frac{\\hat{r}(1-\\hat{p})}{\\hat{p}} \\quad (1) $$\n$$ s^2 = \\frac{\\hat{r}(1-\\hat{p})}{\\hat{p}^2} \\quad (2) $$\n此处，$\\hat{r}$ 和 $\\hat{p}$ 表示 $r$ 和 $p$ 的估计量。\n\n解这个方程组的一个直接方法是注意到方差和均值之间的关系。我们可以用方程 $(1)$ 的右侧来表示方程 $(2)$ 的右侧：\n$$ s^2 = \\left( \\frac{\\hat{r}(1-\\hat{p})}{\\hat{p}} \\right) \\frac{1}{\\hat{p}} = \\frac{\\bar{y}}{\\hat{p}} $$\n从这个关系中，我们可以直接解出以样本矩表示的估计量 $\\hat{p}$：\n$$ \\hat{p} = \\frac{\\bar{y}}{s^2} $$\n为了求出估计量 $\\hat{r}$，我们将 $\\hat{p}$ 的这个表达式代回方程 $(1)$：\n$$ \\bar{y} = \\frac{\\hat{r}\\left(1 - \\frac{\\bar{y}}{s^2}\\right)}{\\frac{\\bar{y}}{s^2}} $$\n假设 $\\bar{y} > 0$，我们可以将两边同乘以 $\\frac{1}{\\bar{y}}$ 得到：\n$$ 1 = \\frac{\\hat{r}\\left(1 - \\frac{\\bar{y}}{s^2}\\right)}{\\left(\\frac{\\bar{y}}{s^2}\\right) \\bar{y}} = \\frac{\\hat{r}\\left(\\frac{s^2-\\bar{y}}{s^2}\\right)}{\\frac{\\bar{y}^2}{s^2}} $$\n$$ 1 = \\hat{r} \\frac{s^2 - \\bar{y}}{\\bar{y}^2} $$\n解出 $\\hat{r}$ 得到：\n$$ \\hat{r} = \\frac{\\bar{y}^2}{s^2 - \\bar{y}} $$\n为使参数有效（$r>0$ 且 $p \\in (0,1)$），样本统计量必须满足 $\\bar{y}>0$ 和 $s^2 > \\bar{y}$。条件 $s^2 > \\bar{y}$ 表示过度离散，这是负二项分布模型与泊松分布（其方差等于均值）相比的一个关键特征。\n\n接下来，我们使用给定的实验数据 $\\bar{y} = 7.5$ 和 $s^2 = 22.5$ 来计算这些估计量的值。\n我们计算 $\\hat{p}$：\n$$ \\hat{p} = \\frac{7.5}{22.5} = \\frac{1}{3} $$\n我们计算 $\\hat{r}$：\n$$ \\hat{r} = \\frac{(7.5)^2}{22.5 - 7.5} = \\frac{56.25}{15} = 3.75 $$\n问题要求报告四舍五入到4位有效数字的数值。\n$$ \\hat{p} = 0.\\overline{3} \\approx 0.3333 $$\n$$ \\hat{r} = 3.750 $$\n所以，估计的参数对是 $(\\hat{r}, \\hat{p}) = (3.750, 0.3333)$。\n\n最后，我们分析在 $\\bar{y}$ 固定且 $s^2 \\to \\bar{y}^{+}$ 的情况下，矩量法下 $(r,p)$ 的可辨识性。这对应于观测到的过度离散为最小的情况。我们考察我们推导出的估计量的极限行为：\n$$ \\lim_{s^2 \\to \\bar{y}^{+}} \\hat{p} = \\lim_{s^2 \\to \\bar{y}^{+}} \\frac{\\bar{y}}{s^2} = \\frac{\\bar{y}}{\\bar{y}} = 1 $$\n$$ \\lim_{s^2 \\to \\bar{y}^{+}} \\hat{r} = \\lim_{s^2 \\to \\bar{y}^{+}} \\frac{\\bar{y}^2}{s^2 - \\bar{y}} $$\n对于 $\\hat{r}$ 的极限，分子 $\\bar{y}^2$ 是一个固定的正常数，而分母 $(s^2 - \\bar{y})$ 从正方向趋近于0。因此，$\\hat{r}$ 的极限是正无穷大：\n$$ \\lim_{s^2 \\to \\bar{y}^{+}} \\hat{r} = +\\infty $$\n这种极限行为，$\\hat{r} \\to \\infty$ 和 $\\hat{p} \\to 1$，对应于负二项分布收敛到泊松分布的众所周知的事实。泊松分布的特征是其均值等于方差，即 $\\mathbb{E}[X] = \\mathrm{Var}(X) = \\lambda$。条件 $s^2 \\to \\bar{y}^{+}$ 意味着数据变得等离散，这是泊松过程的一个特征属性。矩量法估计量通过驱使负二项分布参数趋向于它们在泊松极限下的值来反映这一点。\n\n在模型可区分性方面，这一结果突显了一个实践上和理论上的问题。当样本方差 $s^2$ 越来越接近样本均值 $\\bar{y}$ 时，估计的参数 $\\hat{r}$ 变得极大，并且对样本矩的微小变化高度敏感。这种数值不稳定性表明在低过度离散情况下，参数 $r$ 的可辨识性很差。在统计上，将一个具有非常大的 $r$ 和 $p \\approx 1$ 的负二项分布与一个均值为 $\\bar{y}$ 的泊松分布区分开来变得困难。这两个模型变得几乎无法区分，并且负二项模型的矩量法估计变得病态。", "answer": "$$ \\boxed{\\begin{pmatrix} 3.750  0.3333 \\end{pmatrix}} $$", "id": "3340523"}, {"introduction": "当一个生物学模型的后验分布过于复杂，无法解析求解时，我们必须依赖于计算方法，例如马尔可夫链蒙特卡洛（MCMC）。本练习将带你深入MCMC方法的核心，为一个描述基因表达的生灭过程推导Metropolis-Hastings算法的接受率 [@problem_id:3340583]。通过从第一性原理出发构建这个关键组件，你将揭开高级贝叶斯计算方法的神秘面纱，并为解决更复杂的系统生物学推断问题打下坚实基础。", "problem": "细胞克隆群体中的一种信使核糖核酸 (mRNA) 由一个线性生灭过程建模，其零级合成速率为 $k$（分子/单位时间），一级降解速率为 $\\gamma$（/单位时间）。在化学主方程和遍历性的标准假设下，稳态时单个细胞中的分子数 $Y$ 服从泊松随机变量分布，其均值为 $m = k/\\gamma$。您从 $n$ 个独立细胞中收集了计数 $y_{1},\\dots,y_{n}$，假设每个细胞都处于稳态，并且在给定 $(k,\\gamma)$ 的条件下是条件独立的。\n\n您希望对参数向量 $\\theta = (k,\\gamma)$ 进行贝叶斯推断，使用独立的 Gamma 先验：$k \\sim \\mathrm{Gamma}(a_{k},b_{k})$ 和 $\\gamma \\sim \\mathrm{Gamma}(a_{\\gamma},b_{\\gamma})$。这里使用形状-速率参数化，其密度函数为 $p(x) = \\frac{b^{a}}{\\Gamma(a)} x^{a-1} \\exp(-b x)$，其中 $x>0$, $a>0$, $b>0$。\n\n考虑一个 Metropolis–Hastings 类型的马尔可夫链蒙特卡洛 (MCMC) 算法，用于从 $\\theta$ 的后验分布中采样。在每次迭代中，从当前状态 $\\theta=(k,\\gamma)$ 出发，通过在每个坐标上进行独立的对数正态随机游走来提出一个新状态 $\\theta'=(k',\\gamma')$：\n- $\\ln k' = \\ln k + \\varepsilon_{k}$，其中 $\\varepsilon_{k} \\sim \\mathcal{N}(0,\\sigma_{k}^{2})$，\n- $\\ln \\gamma' = \\ln \\gamma + \\varepsilon_{\\gamma}$，其中 $\\varepsilon_{\\gamma} \\sim \\mathcal{N}(0,\\sigma_{\\gamma}^{2})$，\n并且 $\\varepsilon_{k}$ 和 $\\varepsilon_{\\gamma}$ 相互独立，且与过去的状态无关。\n\n从独立观测的泊松似然、Gamma 先验密度以及用目标密度和提议密度表示的 Metropolis–Hastings 接受准则的基本定义出发，且不假设任何“捷径”公式，完成以下任务：\n- 简要说明适用于此设置的 Metropolis–Hastings 算法单次迭代的步骤。\n- 在上述对数正态随机游走提议和模型假设下，推导从 $\\theta \\to \\theta'$ 移动的 Metropolis–Hastings 接受率 $r$ 的精确解析表达式，并用 $n$、数据 $y_{1},\\dots,y_{n}$、当前和提议的参数 $(k,\\gamma)$ 和 $(k',\\gamma')$ 以及超参数 $a_{k},b_{k},a_{\\gamma},b_{\\gamma}$ 完全简化该表达式。\n\n您的最终答案必须是 $r$ 的单个闭式表达式。不需要进行数值评估，也不应进行四舍五入。最终表达式中不要包含任何单位。", "solution": "Metropolis-Hastings (MH) 算法旨在从一个难以直接采样的概率分布中生成样本。在本例中，目标分布是在给定观测数据 $\\mathbf{y} = \\{y_1, \\dots, y_n\\}$ 的情况下，参数 $\\theta = (k, \\gamma)$ 的后验分布。\n\n此问题的 MH 算法单次迭代过程如下：\n1. 给定参数的当前状态 $\\theta = (k, \\gamma)$，通过抽取独立的标准正态变量 $\\varepsilon_{k} \\sim \\mathcal{N}(0, \\sigma_{k}^{2})$ 和 $\\varepsilon_{\\gamma} \\sim \\mathcal{N}(0, \\sigma_{\\gamma}^{2})$，并设置 $k' = k \\exp(\\varepsilon_k)$ 和 $\\gamma' = \\gamma \\exp(\\varepsilon_\\gamma)$，来提出一个新状态 $\\theta' = (k', \\gamma')$。\n2. 计算接受率 $r$。\n3. 以概率 $\\min(1, r)$ 接受提议的状态 $\\theta'$。如果提议被接受，新状态为 $\\theta'$。如果被拒绝，状态保持为 $\\theta$。\n\n接受率 $r$ 定义为：\n$$r = \\frac{p(\\theta' | \\mathbf{y}) q(\\theta | \\theta')}{p(\\theta | \\mathbf{y}) q(\\theta' | \\theta)}$$\n其中 $p(\\theta | \\mathbf{y})$ 是目标后验密度，$q(\\theta' | \\theta)$ 是提议密度。由于后验分布的归一化常数未知，$p(\\theta | \\mathbf{y}) \\propto \\pi(\\theta) = p(\\mathbf{y} | \\theta)p(\\theta)$，我们可以使用未归一化的后验 $\\pi(\\theta)$ 来写出该比率：\n$$r = \\frac{\\pi(\\theta')}{\\pi(\\theta)} \\frac{q(\\theta | \\theta')}{q(\\theta' | \\theta)}$$\n\n首先，我们定义未归一化的后验 $\\pi(\\theta)$。它是似然 $p(\\mathbf{y} | \\theta)$ 和先验 $p(\\theta)$ 的乘积。\n令 $S = \\sum_{i=1}^{n} y_{i}$ 为观测计数的总和。给定每个 $y_i$ 是从 $\\mathrm{Poisson}(k/\\gamma)$ 分布中独立抽取的，数据的似然为：\n$$p(\\mathbf{y} | k, \\gamma) = \\prod_{i=1}^n \\frac{(k/\\gamma)^{y_i}}{y_i!} \\exp\\left(-\\frac{k}{\\gamma}\\right) = \\frac{(k/\\gamma)^S}{\\prod_{i=1}^n y_i!} \\exp\\left(-n\\frac{k}{\\gamma}\\right)$$\n由于独立性，联合先验分布为 $p(\\theta) = p(k, \\gamma) = p(k) p(\\gamma)$：\n$$p(k, \\gamma) = \\left[\\frac{b_k^{a_k}}{\\Gamma(a_k)} k^{a_k-1} \\exp(-b_k k)\\right] \\left[\\frac{b_\\gamma^{a_\\gamma}}{\\Gamma(a_\\gamma)} \\gamma^{a_\\gamma-1} \\exp(-b_\\gamma \\gamma)\\right]$$\n因此，未归一化的后验 $\\pi(\\theta) = p(\\mathbf{y} | \\theta) p(\\theta)$ 正比于：\n$$\\pi(k, \\gamma) \\propto \\left( k^S \\gamma^{-S} \\exp(-n k \\gamma^{-1}) \\right) \\left( k^{a_k-1} \\exp(-b_k k) \\right) \\left( \\gamma^{a_\\gamma-1} \\exp(-b_\\gamma \\gamma) \\right)$$\n合并各项，我们得到：\n$$\\pi(k, \\gamma) \\propto k^{S+a_k-1} \\gamma^{-S+a_\\gamma-1} \\exp\\left( -n k \\gamma^{-1} - b_k k - b_\\gamma \\gamma \\right)$$\n未归一化后验的比率为：\n$$\\frac{\\pi(\\theta')}{\\pi(\\theta)} = \\frac{\\pi(k', \\gamma')}{\\pi(k, \\gamma)} = \\frac{(k')^{S+a_k-1} (\\gamma')^{-S+a_\\gamma-1} \\exp\\left( -n k' (\\gamma')^{-1} - b_k k' - b_\\gamma \\gamma' \\right)}{k^{S+a_k-1} \\gamma^{-S+a_\\gamma-1} \\exp\\left( -n k \\gamma^{-1} - b_k k - b_\\gamma \\gamma \\right)}$$\n$$\\frac{\\pi(\\theta')}{\\pi(\\theta)} = \\left(\\frac{k'}{k}\\right)^{S+a_k-1} \\left(\\frac{\\gamma'}{\\gamma}\\right)^{-S+a_\\gamma-1} \\exp\\left[ \\left( n \\frac{k}{\\gamma} + b_k k + b_\\gamma\\gamma \\right) - \\left( n \\frac{k'}{\\gamma'} + b_k k' + b_\\gamma\\gamma' \\right) \\right]$$\n\n接下来，我们确定提议密度比 $\\frac{q(\\theta | \\theta')}{q(\\theta' | \\theta)}$。提议是在对数空间中的随机游走。由于提议机制是对称的（即从 $x$ 移动到 $y$ 的概率密度与从 $y$ 移动到 $x$ 的相同），但这是在对数尺度上。在原始尺度上，我们需要一个雅可比行列式来进行变量变换。从 $\\theta$ 到 $\\theta'$ 的提议移动的密度为：\n$$q(\\theta'|\\theta) \\propto f_{\\mathcal{N}}(\\ln k' - \\ln k; 0, \\sigma_k^2) f_{\\mathcal{N}}(\\ln \\gamma' - \\ln \\gamma; 0, \\sigma_\\gamma^2) \\frac{1}{k'\\gamma'}$$\n同样，逆向提议密度为 $q(\\theta|\\theta') \\propto f_{\\mathcal{N}}(\\ln k - \\ln k'; 0, \\sigma_k^2) f_{\\mathcal{N}}(\\ln \\gamma - \\ln \\gamma'; 0, \\sigma_\\gamma^2) \\frac{1}{k\\gamma}$。\n由于正态密度是对称的，$f_{\\mathcal{N}}(x; 0, \\sigma^2) = f_{\\mathcal{N}}(-x; 0, \\sigma^2)$，所以在 $q(\\theta'|\\theta)$ 和 $q(\\theta|\\theta')$ 中涉及正态 PDF 的项在比率中被抵消：\n$$\\frac{q(\\theta | \\theta')}{q(\\theta' | \\theta)} = \\frac{1 / (k\\gamma)}{1 / (k'\\gamma')} = \\frac{k'\\gamma'}{k\\gamma}$$\n\n最后，我们将后验比率和提议比率结合起来求得 $r$：\n$$r = \\left[ \\left(\\frac{k'}{k}\\right)^{S+a_k-1} \\left(\\frac{\\gamma'}{\\gamma}\\right)^{-S+a_\\gamma-1} \\exp\\left[ \\left( n\\frac{k}{\\gamma} + b_k k + b_\\gamma\\gamma \\right) - \\left( n\\frac{k'}{\\gamma'} + b_k k' + b_\\gamma\\gamma' \\right) \\right] \\right] \\cdot \\left[ \\frac{k'\\gamma'}{k\\gamma} \\right]$$\n我们将最后一项重写为 $\\left(\\frac{k'}{k}\\right)\\left(\\frac{\\gamma'}{\\gamma}\\right)$，并将其与其他幂次项合并：\n$$r = \\left(\\frac{k'}{k}\\right)^{S+a_k-1+1} \\left(\\frac{\\gamma'}{\\gamma}\\right)^{-S+a_\\gamma-1+1} \\exp\\left[ n\\left(\\frac{k}{\\gamma} - \\frac{k'}{\\gamma'}\\right) + b_k(k - k') + b_\\gamma(\\gamma - \\gamma') \\right]$$\n简化幂次项上的指数，得到接受率 $r$ 的最终表达式：\n$$r = \\left(\\frac{k'}{k}\\right)^{S+a_k} \\left(\\frac{\\gamma'}{\\gamma}\\right)^{-S+a_\\gamma} \\exp\\left[ n\\left(\\frac{k}{\\gamma} - \\frac{k'}{\\gamma'}\\right) + b_k(k - k') + b_\\gamma(\\gamma - \\gamma') \\right]$$\n其中 $S = \\sum_{i=1}^{n} y_{i}$。该表达式包含所有必需的项，并已完全简化。", "answer": "$$\n\\boxed{\n\\left(\\frac{k'}{k}\\right)^{\\left(\\sum_{i=1}^{n} y_i\\right) + a_k} \\left(\\frac{\\gamma'}{\\gamma}\\right)^{-\\left(\\sum_{i=1}^{n} y_i\\right) + a_\\gamma} \\exp\\left[ n\\left(\\frac{k}{\\gamma} - \\frac{k'}{\\gamma'}\\right) + b_k\\left(k - k'\\right) + b_\\gamma\\left(\\gamma - \\gamma'\\right) \\right]\n}\n$$", "id": "3340583"}]}