{"hands_on_practices": [{"introduction": "PCA模型的作用远不止于分析初始数据集；一个关键的应用是将新的数据点投影到已建立的主成分空间中。本练习将引导你完成这一关键过程，这对于将训练好的模型应用于新样本（例如在临床诊断或持续的实验中）至关重要。[@problem_id:3321042]", "problem": "一项转录组学研究测量了$n$个训练样本中$m$个基因的信使RNA (mRNA)丰度，并对预处理后的训练数据执行了主成分分析 (Principal Component Analysis, PCA)。该预处理流程包括对所有训练样本应用一个固定变换（对数变换以稳定方差），然后在训练队列中进行均值中心化。除了均值中心化之外，没有应用方差缩放。PCA模型的训练过程是：计算均值中心化后数据的样本协方差矩阵，并对其进行特征分解，从而获得一个标准正交载荷矩阵$P \\in \\mathbb{R}^{m \\times k}$，该矩阵的列是与前$k$个最大特征值相对应的特征向量。训练样本的得分坐标定义为其均值中心化后的向量在载荷子空间上的正交投影。\n\n对于一个由$x_{\\mathrm{new}} \\in \\mathbb{R}^{m}$表示其原始测量值的新生物学重复样本，必须按照与训练流程一致的方式将其投影到已训练的主成分子空间中。请从向量在标准正交基上的正交投影的核心定义，以及基于预处理训练数据的协方差矩阵的特征分解来构建PCA的方法出发，推导出用训练均值向量$\\hat{\\mu}$和载荷矩阵$P$表示$x_{\\mathrm{new}}$得分坐标的表达式。请解释在计算系统生物学背景下，为什么对$x_{\\mathrm{new}}$应用与训练数据相同的预处理（包括固定变换和使用$\\hat{\\mu}$进行中心化）对于保证科学一致性和可解释性是必要的。\n\n然后，将您的推导应用于以下具有$m=3$个变量和$k=2$个主成分的科学上合理的代谢物组。训练得到的载荷矩阵（其列是标准正交的）和预处理后计算出的训练均值向量如下：\n$$\nP \\;=\\; \\begin{pmatrix}\n\\frac{1}{\\sqrt{2}}  \\frac{1}{\\sqrt{6}} \\\\\n\\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{6}} \\\\\n0  \\frac{2}{\\sqrt{6}}\n\\end{pmatrix},\n\\qquad\n\\hat{\\mu} \\;=\\; \\begin{pmatrix} 5 \\\\ 7 \\\\ 4 \\end{pmatrix}.\n$$\n一个新样本，在应用了与训练时相同的固定变换后，其测量值如下：\n$$\nx_{\\mathrm{new}} \\;=\\; \\begin{pmatrix} 6 \\\\ 8.5 \\\\ 3 \\end{pmatrix}.\n$$\n请根据您推导出的投影表达式计算这个新样本的第一主成分得分。将您的数值答案四舍五入到四位有效数字。最终答案请勿带单位。", "solution": "所述问题是有效的。它展示了在计算系统生物学中应用主成分分析 (PCA) 的一个标准的、定义明确的场景。其前提科学合理，定义清晰，并且为求解提供了所有必要信息。\n\n主要任务是推导一个新样本$x_{\\mathrm{new}}$在投影到由训练数据集构建的PCA空间后的得分坐标表达式。这需要系统地应用线性代数知识和对PCA方法的理解。\n\n设训练数据由一个矩阵表示，其中$n$列中的每一列都是一个包含$m$个测量值（例如，基因丰度）的样本向量。训练数据的预处理流程包括一个逐元素应用的固定变换函数$f$，然后进行均值中心化。设$x'_{i}$是应用了$f$变换后的第$i$个训练样本。训练均值向量$\\hat{\\mu}$由这些变换后的样本计算得出：\n$$ \\hat{\\mu} = \\frac{1}{n} \\sum_{i=1}^{n} x'_{i} $$\n最终预处理后的训练向量$\\tilde{x}_i$是均值中心化后的向量：\n$$ \\tilde{x}_i = x'_{i} - \\hat{\\mu} $$\nPCA的执行方式是找到向量集$\\{\\tilde{x}_i\\}_{i=1}^n$的样本协方差矩阵的特征向量。载荷矩阵$P \\in \\mathbb{R}^{m \\times k}$的构建方法是，将其列向量设为与$k$个最大特征值相对应的$k$个标准正交特征向量。这些列向量$\\{p_1, p_2, \\dots, p_k\\}$构成了主子空间的一组标准正交基，该子空间捕获了训练数据的最大方差。\n\n预处理空间中任何向量的得分坐标都是通过将其投影到这个标准正交基上得到的。对于一个预处理后的训练样本$\\tilde{x}_i$，其得分向量$s_i \\in \\mathbb{R}^k$是通过计算它与每个基向量的点积得到的。第$j$个得分$s_{ij}$是$p_j^T \\tilde{x}_i$。用矩阵形式表示为：\n$$ s_i = P^T \\tilde{x}_i $$\n对于一个原始测量值为$x_{\\mathrm{raw, new}}$的新样本，只有当它经历了与训练数据完全相同的预处理变换时，其在PCA空间中的投影才有意义。这是确保科学一致性和可解释性的一个基本要求。\n$1$. 应用固定变换$f$：$x_{\\mathrm{new}} = f(x_{\\mathrm{raw, new}})$。本问题直接提供了这个变换后的向量。\n$2$. 使用*训练数据的均值向量*$\\hat{\\mu}$对该向量进行中心化。这一步至关重要，因为主成分是相对于训练数据云的中心定义的。为了将新样本与训练样本进行比较，必须将其置于同一坐标系中，这就需要使用$\\hat{\\mu}$作为原点。\n因此，正确预处理后的新向量是：\n$$ \\tilde{x}_{\\mathrm{new}} = x_{\\mathrm{new}} - \\hat{\\mu} $$\n然后，通过相同的投影操作找到这个新样本的得分坐标$s_{\\mathrm{new}}$：\n$$ s_{\\mathrm{new}} = P^T \\tilde{x}_{\\mathrm{new}} $$\n将$\\tilde{x}_{\\mathrm{new}}$的表达式代入，我们得到将一个新的（变换后的）样本$x_{\\mathrm{new}}$投影到已训练的PCA空间中的通用公式：\n$$ s_{\\mathrm{new}} = P^T (x_{\\mathrm{new}} - \\hat{\\mu}) $$\n这个推导过程强调了为什么一致的预处理不仅仅是一个程序性步骤，更是一个概念上的必然要求。由$P$和$\\hat{\\mu}$定义的PCA模型，构成了从原始数据空间到主成分空间的一个固定映射。从得分中得出的科学结论依赖于这个映射对于所有样本（无论是训练样本还是新样本）都保持其完整性。\n\n现在，我们将此推导出的表达式应用于具体的数值问题。给定的数值是：\n$$\nP \\;=\\; \\begin{pmatrix}\n\\frac{1}{\\sqrt{2}}  \\frac{1}{\\sqrt{6}} \\\\\n\\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{6}} \\\\\n0  \\frac{2}{\\sqrt{6}}\n\\end{pmatrix},\n\\qquad\n\\hat{\\mu} \\;=\\; \\begin{pmatrix} 5 \\\\ 7 \\\\ 4 \\end{pmatrix},\n\\qquad\nx_{\\mathrm{new}} \\;=\\; \\begin{pmatrix} 6 \\\\ 8.5 \\\\ 3 \\end{pmatrix}.\n$$\n首先，我们计算中心化向量$\\tilde{x}_{\\mathrm{new}}$：\n$$\n\\tilde{x}_{\\mathrm{new}} = x_{\\mathrm{new}} - \\hat{\\mu} = \\begin{pmatrix} 6 \\\\ 8.5 \\\\ 3 \\end{pmatrix} - \\begin{pmatrix} 5 \\\\ 7 \\\\ 4 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1.5 \\\\ -1 \\end{pmatrix}.\n$$\n问题要求计算第一主成分得分，我们将其表示为$s_{\\mathrm{new}, 1}$。这是$\\tilde{x}_{\\mathrm{new}}$在第一主成分向量$p_1$上的投影，$p_1$是$P$的第一列。\n$$\np_1 = \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ \\frac{1}{\\sqrt{2}} \\\\ 0 \\end{pmatrix}.\n$$\n该得分计算为点积$p_1^T \\tilde{x}_{\\mathrm{new}}$：\n$$\ns_{\\mathrm{new}, 1} = \\begin{pmatrix} \\frac{1}{\\sqrt{2}}  \\frac{1}{\\sqrt{2}}  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1.5 \\\\ -1 \\end{pmatrix} = (1)\\left(\\frac{1}{\\sqrt{2}}\\right) + (1.5)\\left(\\frac{1}{\\sqrt{2}}\\right) + (-1)(0).\n$$\n$$\ns_{\\mathrm{new}, 1} = \\frac{1 + 1.5}{\\sqrt{2}} = \\frac{2.5}{\\sqrt{2}}.\n$$\n对此表达式进行数值计算：\n$$\ns_{\\mathrm{new}, 1} = \\frac{2.5}{\\sqrt{2}} \\approx 1.76776695...\n$$\n按照要求将结果四舍五入到四位有效数字，得到$1.768$。", "answer": "$$\\boxed{1.768}$$", "id": "3321042"}, {"introduction": "决定保留多少个主成分是一个关键步骤，它融合了统计学启发式方法和科学洞察力。本练习提供了一个真实的场景，你必须超越简单的方差解释率指标，利用领域知识来区分有意义的生物信号和技术伪影。这种练习能够提升进行稳健科学解释所必需的批判性思维能力。[@problem_id:3321098]", "problem": "一项转录组学研究测量了 $n$ 个样本中 $p$ 个基因的信使RNA丰度，得到一个数据矩阵 $\\mathbf{X} \\in \\mathbb{R}^{n \\times p}$，其列（基因）已经过对数转换、中心化并缩放到单位方差。对样本协方差矩阵 $\\mathbf{S} = \\frac{1}{n-1}\\mathbf{X}^{\\top}\\mathbf{X}$ 执行了主成分分析 (PCA, Principal Component Analysis)。$\\mathbf{S}$ 的特征值按降序排列为 $\\lambda_{1} \\ge \\lambda_{2} \\ge \\cdots \\ge \\lambda_{p} \\ge 0$，相应的标准正交特征向量给出了载荷，主成分得分是样本在这些特征向量上的投影。对于此数据集，前六个主成分解释的观测方差比例分别为 $0.38$、$0.22$、$0.09$、$0.04$、$0.02$ 和 $0.01$。剩余的方差分布在更高阶的成分中。载荷和得分诊断揭示了以下信息：\n- 主成分 $1$ 的得分与每个样本的唯一分子标识符 (UMI, Unique Molecular Identifier) 计数强相关 ($r \\approx 0.93$)，其载荷在核糖体和线粒体基因集中富集，表明存在技术性或组成性效应。\n- 主成分 $2$ 的得分与干扰素治疗剂量相关 ($r \\approx 0.81$)，其载荷在干扰素刺激基因中富集，表明存在治疗梯度。\n- 主成分 $3$ 的得分与两次测序批次的批次标签一致 ($r \\approx 0.88$)，并与RNA完整性数值 (RIN, RNA Integrity Number) 负相关 ($r \\approx -0.62$)，其载荷包括应激反应和线粒体基因，表明存在批次/质量伪影。\n- 主成分 $4$ 在T细胞标记基因的一个紧凑集合上具有较大的正载荷；只有大约 $5\\%$ 的样本在主成分4上具有较高的正得分，并且这些得分与独立的流式细胞术对一个罕见T细胞亚群的估计值相关 ($r \\approx 0.77$)，表明存在一个具有生物学意义但流行率低的亚群。\n\n仅使用PCA的标准定义（$\\mathbf{S}$ 的特征分解以及将特征值解释为主成分方差），推导一个累积方差解释作为成分数 $k$ 的函数的通用表达式，然后，结合累积方差曲线和上述载荷与得分中编码的领域知识，决定您将在这项研究中解释多少个成分，并说明原因。\n\n选择唯一一个既能从基本原理正确推导出累积方差解释函数，又能为在这种情况下解释 $k$ 的选择提供合理理由的选项。\n\nA. $C(k) = \\dfrac{\\sum_{i=1}^{k} \\sigma_{i}}{\\sum_{j=1}^{\\min(n,p)} \\sigma_{j}}$，其中 $\\sigma_{i}$ 是中心化 $\\mathbf{X}$ 的奇异值；选择 $k=2$ 是因为在主成分2之后有一个明显的拐点，并且额外的成分很小，因此即使它们显示出特定的基因集富集也应被忽略。\n\nB. $C(k) = \\dfrac{\\sum_{i=1}^{k} \\lambda_{i}}{\\sum_{j=1}^{p} \\lambda_{j}}$，其中 $\\lambda_{i}$ 是 $\\mathbf{S}$ 的特征值；选择检查到 $k=4$ 是因为 $C(4) = 0.38+0.22+0.09+0.04 = 0.73$ 超过了探索性解释的合理信息捕获目标，主成分2捕获了治疗梯度，主成分1和主成分3是需要控制而不是进行生物学解释的技术性/混杂效应，而主成分4——尽管方差很低——与一个罕见但经过生物学验证的T细胞亚群一致。\n\nC. $C(k) = \\dfrac{\\sum_{i=1}^{k} \\lambda_{i}}{\\sum_{j=1}^{p} \\lambda_{j}}$，其中 $\\lambda_{i}$ 是 $\\mathbf{S}$ 的特征值；选择 $k$ 为使 $C(k) \\ge 0.80$ 的最小数字，如果需要，这可能需要包含远多于6个成分，因为即使后面的成分载荷充满噪声且没有明确的生物学关联，方差解释也应是唯一标准。\n\nD. $C(k) = \\sum_{g=1}^{p} \\ell_{gk}^{2}$，其中 $\\ell_{gk}$ 是基因 $g$ 在成分 $k$ 上的载荷；选择 $k=3$ 是因为前三个成分上的载荷平方和很大，而主成分4所占方差很小，无论其基因水平的解释如何都应被丢弃。", "solution": "用户提供了一个关于对转录组学数据集执行主成分分析 (PCA, Principal Component Analysis) 的解释的问题。任务是验证问题陈述，推导累积方差解释的表达式，并为要保留解释的成分数 $k$ 提供理由。\n\n### 步骤1：提取已知信息\n\n- 数据矩阵：$\\mathbf{X} \\in \\mathbb{R}^{n \\times p}$，表示 $p$ 个基因和 $n$ 个样本。\n- 数据预处理：列（基因）经过对数转换、中心化和缩放到单位方差。\n- PCA程序：对样本协方差矩阵 $\\mathbf{S} = \\frac{1}{n-1}\\mathbf{X}^{\\top}\\mathbf{X}$ 进行特征分解。\n- $\\mathbf{S}$ 的特征值：$\\lambda_{1} \\ge \\lambda_{2} \\ge \\cdots \\ge \\lambda_{p} \\ge 0$。\n- 载荷：$\\mathbf{S}$ 的标准正交特征向量。\n- 得分：样本在特征向量上的投影。\n- 主成分（PC）1到6的观测方差解释比例：$0.38$、$0.22$、$0.09$、$0.04$、$0.02$ 和 $0.01$。\n- PC1解释：与每个样本的唯一分子标识符 (UMI, Unique Molecular Identifier) 计数强相关 ($r \\approx 0.93$)；载荷在核糖体和线粒体基因中富集；表明存在技术性/组成性效应。\n- PC2解释：与干扰素治疗剂量相关 ($r \\approx 0.81$)；载荷在干扰素刺激基因中富集；表明存在治疗梯度。\n- PC3解释：与批次标签相关 ($r \\approx 0.88$)，并与RNA完整性数值 (RIN, RNA Integrity Number) 负相关 ($r \\approx -0.62$)；载荷包括应激反应和线粒体基因；表明存在批次/质量伪影。\n- PC4解释：在T细胞标记基因上有较大的正载荷；约 $5\\%$ 的样本有较高的正得分，这些得分与一个罕见的T细胞亚群的流式细胞术估计值相关 ($r \\approx 0.77$)；表明存在一个具有生物学意义的亚群。\n\n### 步骤2：使用提取的已知信息进行验证\n\n问题陈述在科学上是合理的、提法是恰当的并且是客观的。\n1.  **科学依据**：该设置描述了转录组学中PCA的标准工作流程。数据矩阵维度、预处理步骤（对数转换、中心化、缩放）、协方差矩阵 $\\mathbf{S}$ 的定义，以及其特征分解与PCA结果之间的关系（特征值作为成分方差，特征向量作为载荷）都是正确且是该方法的基础。对已缩放到单位方差的数据使用协方差矩阵等同于使用相关矩阵，这是一种标准且有效的方法。生物学背景，包括提及UMI、RIN、批次效应、干扰素刺激和细胞亚群识别，都非常现实，是现代基因组学中的常见主题。\n2.  **提法恰当性**：该问题要求进行推导和论证，这两者都可以使用所提供的信息和标准统计理论来解决。可以得出一个唯一的、有意义的结论。\n3.  **客观性**：问题陈述使用了精确的定量语言（例如，相关系数、方差比例），并避免了主观性陈述。对PC的解释用“表明”一词加以限定，这对于探索性数据分析是恰当的。\n\n问题陈述没有任何使其无效的缺陷。它是内部一致的，有科学依据的，并提供了进行解答所需的所有必要信息。\n\n### 步骤3：结论与行动\n\n该问题是**有效的**。我将继续推导解决方案并评估各个选项。\n\n### 解题推导\n\n第一个任务是推导前 $k$ 个主成分的累积方差解释比例 $C(k)$ 的通用表达式。\n\n数据集的总方差是单个变量（基因）方差的总和。问题陈述中说，数据矩阵 $\\mathbf{X}$ 的基因列已经过中心化并缩放到单位方差。设 $\\mathbf{X}$ 的第 $j$ 列为 $\\mathbf{x}_j$。那么，对于 $j=1, \\ldots, p$，有 $\\text{Var}(\\mathbf{x}_j) = 1$。\n因此，数据集的总方差为：\n$$\n\\text{Total Variance} = \\sum_{j=1}^{p} \\text{Var}(\\mathbf{x}_j) = \\sum_{j=1}^{p} 1 = p\n$$\n样本协方差矩阵由 $\\mathbf{S} = \\frac{1}{n-1}\\mathbf{X}^{\\top}\\mathbf{X}$ 给出。该矩阵的对角线元素 $S_{jj}$ 表示基因的样本方差。由于数据已被缩放到单位方差，因此对于所有 $j=1, \\ldots, p$，都有 $S_{jj} = 1$。\n方阵的迹是其对角线元素之和。因此，协方差矩阵的迹等于总方差：\n$$\n\\text{Tr}(\\mathbf{S}) = \\sum_{j=1}^{p} S_{jj} = \\sum_{j=1}^{p} 1 = p\n$$\n线性代数的一个基本性质是，矩阵的迹也等于其特征值之和。设 $\\mathbf{S}$ 的特征值为 $\\lambda_1, \\lambda_2, \\ldots, \\lambda_p$。\n$$\n\\text{Tr}(\\mathbf{S}) = \\sum_{j=1}^{p} \\lambda_j\n$$\n因此，数据集中的总方差由协方差矩阵的特征值之和捕获：$\\sum_{j=1}^{p} \\lambda_j = p$。\n\n在PCA中，第 $i$ 个主成分捕获的方差等于第 $i$ 个特征值 $\\lambda_i$。前 $k$ 个成分解释的累积方差是它们各自方差的总和：$\\sum_{i=1}^{k} \\lambda_i$。\n累积方差*解释比例* $C(k)$ 是该累积方差与总方差的比值。\n$$\nC(k) = \\frac{\\text{前 } k \\text{ 个PC解释的方差}}{\\text{总方差}} = \\frac{\\sum_{i=1}^{k} \\lambda_{i}}{\\sum_{j=1}^{p} \\lambda_{j}}\n$$\n这个表达式是正确的通用公式。\n\n第二个任务是决定要解释多少个成分。这需要同时考虑方差解释和每个成分的生物学/技术意义。\n- **PC1（38%方差）**：被确定为一个与测序深度（UMI计数）相关的主要技术伪影。这是一个至关重要的发现，因为它代表了一个强烈的混杂效应，在任何下游分析中都必须加以考虑。它必须被解释，但应作为混杂因素，而不是感兴趣的生物学信号。\n- **PC2（22%方差）**：捕获了感兴趣的生物学效应（干扰素治疗梯度）。这个成分是研究目标的核心。\n- **PC3（9%方差）**：被确定为另一个与批次和样本质量（RIN）相关的技术伪影。与PC1类似，这是一个需要识别的重要混杂因素。\n- **PC4（4%方差）**：尽管解释的方差很小，但该成分分离出了一个罕见但具有生物学意义的细胞亚群，并由流式细胞术独立验证。在探索性研究中，发现这种微妙、低流行率的生物学信号是一个主要目标。如果基于其低方差而丢弃该成分，将是一个重大的科学错误，因为这将意味着忽略一个关键发现。\n\n一种朴素的方法，例如使用碎石图的拐点（可能出现在PC2之后，此时方差从 $0.22$ 降至 $0.09$）或固定的方差截断值，在这里是不合适的。一个复杂的分析需要解释所有揭示了重要结构的成分，无论它是感兴趣的生物信号、混杂的技术变量，还是一个罕见但经过验证的生物现象。因此，必须至少检查前四个成分，以全面了解数据结构。PC1和PC3揭示了关键的混杂因素，PC2捕获了主要的实验信号，而PC4则揭示了一个重要的次要生物学发现。\n\n### 逐项分析选项\n\n**A. $C(k) = \\dfrac{\\sum_{i=1}^{k} \\sigma_{i}}{\\sum_{j=1}^{\\min(n,p)} \\sigma_{j}}$，其中 $\\sigma_{i}$ 是中心化 $\\mathbf{X}$ 的奇异值；选择 $k=2$ 是因为在主成分2之后有一个明显的拐点，并且额外的成分很小，因此即使它们显示出特定的基因集富集也应被忽略。**\n\n- **公式**：该公式不正确。PC的方差与相应奇异值的*平方*成正比 ($\\lambda_i \\propto \\sigma_i^2$)，而不是奇异值本身。正确的公式应包含 $\\sigma_i^2$。\n- **理由**：理由有缺陷。它主张使用朴素的“拐点”法，并明确建议如果可解释成分的方差很小就忽略它们。这与探索性数据分析的原则相悖，后者的一个主要目标是发现细微但有意义的信号（如PC4中所示）。\n- **结论**：**不正确**。\n\n**B. $C(k) = \\dfrac{\\sum_{i=1}^{k} \\lambda_{i}}{\\sum_{j=1}^{p} \\lambda_{j}}$，其中 $\\lambda_{i}$ 是 $\\mathbf{S}$ 的特征值；选择检查到 $k=4$ 是因为 $C(4) = 0.38+0.22+0.09+0.04 = 0.73$ 超过了探索性解释的合理信息捕获目标，主成分2捕获了治疗梯度，主成分1和主成分3是需要控制而不是进行生物学解释的技术性/混杂效应，而主成分4——尽管方差很低——与一个罕见但经过生物学验证的T细胞亚群一致。**\n\n- **公式**：这个公式 $C(k) = \\frac{\\sum_{i=1}^{k} \\lambda_{i}}{\\sum_{j=1}^{p} \\lambda_{j}}$ 是正确的，如上所述。\n- **理由**：理由非常出色。它正确地计算了累积方差 $C(4) = 0.73$。最重要的是，它通过平衡方差解释与每个成分的科学意义，展示了对PCA解释的深刻理解。它正确地识别了PC1/PC3作为混杂因素、PC2作为主要信号以及PC4作为一个关键但方差较低的生物学发现。这种推理在科学上是合理的，在方法上是严谨的。\n- **结论**：**正确**。\n\n**C. $C(k) = \\dfrac{\\sum_{i=1}^{k} \\lambda_{i}}{\\sum_{j=1}^{p} \\lambda_{j}}$，其中 $\\lambda_{i}$ 是 $\\mathbf{S}$ 的特征值；选择 $k$ 为使 $C(k) \\ge 0.80$ 的最小数字，如果需要，这可能需要包含远多于6个成分，因为即使后面的成分载荷充满噪声且没有明确的生物学关联，方差解释也应是唯一标准。**\n\n- **公式**：公式是正确的。\n- **理由**：理由在科学上很差。它依赖于一个任意的方差截断值 ($0.80$)，并明确指出应忽略成分的解释。这是对PCA的机械且不假思索的应用，可能会错过重要的发现（如PC4）并包含无法解释的噪声。PCA的目的是获得科学洞察，而不是盲目地进行数据压缩。前6个PC的累积方差为 $0.38+0.22+0.09+0.04+0.02+0.01 = 0.76$，因此该规则将强制包含没有可用解释的成分，这不是一个合理的策略。\n- **结论**：**不正确**。\n\n**D. $C(k) = \\sum_{g=1}^{p} \\ell_{gk}^{2}$，其中 $\\ell_{gk}$ 是基因 $g$ 在成分 $k$ 上的载荷；选择 $k=3$ 是因为前三个成分上的载荷平方和很大，而主成分4所占方差很小，无论其基因水平的解释如何都应被丢弃。**\n\n- **公式**：该公式不正确。成分 $k$ 的载荷向量是 $\\mathbf{S}$ 的第 $k$ 个特征向量。根据定义，这些特征向量是标准正交的，意味着它们的欧几里得范数为1。因此，对于任何成分 $k$，都有 $\\sum_{g=1}^{p} \\ell_{gk}^{2} = 1$。此表达式不是累积方差比例。\n- **理由**：该推理基于“前三个成分上的载荷平方和很大”这一不正确的前提。此外，建议“无论其基因水平的解释如何”都丢弃PC4，这是重复了选项A和C中出现的同样根本性错误，即将简单的统计启发式方法置于科学洞察之上。\n- **结论**：**不正确**。", "answer": "$$\\boxed{B}$$", "id": "3321098"}, {"introduction": "对PCA载荷的解释，其价值取决于其可靠性。这个高级练习将介绍自助法（bootstrap method），这是一种强大的统计技术，用于评估PCA结果的置信度和稳定性。通过实施这一程序，你将学会如何量化基因载荷的不确定性，并判断观察到的模式是数据的稳健特征，还是仅仅是抽样噪声的产物。[@problem_id:3321032]", "problem": "给定一个计算系统生物学场景，其中通过主成分分析（PCA）来分析基因表达数据矩阵。设数据由实值矩阵 $X \\in \\mathbb{R}^{n \\times p}$ 表示，其中包含 $n$ 个样本（例如，生物学条件）和 $p$ 个变量（例如，基因）。在进行 PCA 之前，该矩阵按列中心化，因此每个基因在所有样本中的均值为零。主成分分析（PCA）从第一性原理定义如下：计算样本协方差矩阵 $C = \\frac{1}{n-1} X^\\top X$，然后获得其谱分解，或者等效地，对中心化的数据矩阵 $X$ 进行奇异值分解（SVD），即 $X = U \\Sigma V^\\top$，其中 $U$ 和 $V$ 是正交矩阵，$\\Sigma$ 是奇异值的对角矩阵。变量的 PCA 载荷是 $V$ 的列，样本的 PCA 得分由 $T = U \\Sigma$ 给出。由于 PCA 轴的定义仅到符号为止，主成分 $k$ 的载荷 $v_k$ 和 $-v_k$ 定义的是同一根轴；因此任何解释都必须是符号不变的。\n\n您将通过对样本进行重采样，实现一个非参数自举（bootstrap）程序，以估计变量（基因）的第一个主成分载荷的置信区间。自举程序必须遵循以下具有科学依据的步骤：\n\n1. 从按列中心化的数据矩阵 $X$ 开始，通过 SVD $X = U \\Sigma V^\\top$ 计算第一个主成分的参考载荷向量 $v_{\\text{ref}} \\in \\mathbb{R}^{p}$；这是 $V$ 的第一列。\n2. 对于每次自举复制 $b \\in \\{1,2,\\dots,B\\}$：\n   - 从 $X$ 中有放回地重采样 $n$ 行，形成一个自举样本 $X^{(b)}$，然后按列重新中心化 $X^{(b)}$，以使自举样本中的基因均值为零。\n   - 通过对 $X^{(b)}$ 进行 SVD 计算第一个载荷向量 $v^{(b)}$。\n   - 通过将 $v^{(b)}$ 与 $v_{\\text{ref}}$ 对齐来解决符号不确定性，规则如下：如果 $v_{\\text{ref}}^\\top v^{(b)}  0$，则将 $v^{(b)}$ 替换为 $-v^{(b)}$；否则保持 $v^{(b)}$ 不变。\n3. 在 $B$ 次对齐的复制之后，对于每个基因索引 $j \\in \\{1,2,\\dots,p\\}$，计算第一成分载荷 $v_j$ 的经验双侧 $(1-\\alpha)$ 置信区间，即 $\\left[q_{j,\\alpha/2}, q_{j,1-\\alpha/2}\\right]$，其中 $q_{j,\\gamma}$ 是自举分布 $\\{v^{(b)}_j\\}_{b=1}^B$ 在概率 $\\gamma$ 处的样本分位数。\n4. 使用两个指标量化载荷的稳定性：\n   - 置信区间不包含 $0$ 的基因比例，即满足 $q_{j,\\alpha/2}  0$ 或 $q_{j,1-\\alpha/2}  0$ 的索引 $j$ 的比例。\n   - 所有基因的置信区间宽度的中位数，定义为 $\\{q_{j,1-\\alpha/2} - q_{j,\\alpha/2}\\}_{j=1}^p$ 的中位数。\n5. 如果置信区间宽度的中位数超过固定阈值 $w^\\star$，则声明区间为“宽”。使用 $w^\\star = 0.15$。\n\n您必须使用一个具有正交真实载荷方向的秩-2 潜在因子模型，生成反映计算系统生物学中合理基因模块结构的合成数据。具体来说，对于给定的 $n$、$p$、前两个潜在样本因子的得分标准差 $\\tau_1$、$\\tau_2$ 以及噪声标准差 $\\sigma$，构造两个标准正交载荷向量 $v_1, v_2 \\in \\mathbb{R}^p$，使得 $v_1$ 在前 12 个基因上具有相等的非零项，在其他位置为零，而 $v_2$ 在接下来的 12 个基因上具有相等的非零项，在其他位置为零。将 $v_1$ 和 $v_2$ 归一化为单位范数，使它们是标准正交的。然后为 $i \\in \\{1,\\dots,n\\}$ 生成样本如下：\n$$\nX_{i,\\cdot} = s_{1,i} v_1^\\top + s_{2,i} v_2^\\top + \\varepsilon_{i,\\cdot},\n$$\n其中 $s_{1,i} \\sim \\mathcal{N}(0,\\tau_1^2)$，$s_{2,i} \\sim \\mathcal{N}(0,\\tau_2^2)$，且 $\\varepsilon_{i,\\cdot} \\sim \\mathcal{N}(0,\\sigma^2 I_p)$ 在不同 $i$ 之间独立，其中 $I_p$ 是 $p \\times p$ 的单位矩阵。确保在 PCA 之前矩阵是按列中心化的。该构造模拟了一个基因表达数据集，其中两个不相交的基因模块驱动了前两个主成分。\n\n设计并实现程序以完成以下任务：\n\n- 为每个测试用例生成如上所述的 $X$。\n- 计算参考的第一载荷向量。\n- 执行带有符号对齐的自举程序。\n- 计算两个稳定性指标和“宽区间”布尔标志。\n\n将置信水平设置为 $(1-\\alpha) = 0.95$，即 $\\alpha = 0.05$，并为每个测试用例使用 $B$ 次自举复制。为保证可复现性，将随机数生成器的种子固定为 $0$。\n\n需要在解决方案推理中编码的解释指南：宽区间表示载荷不稳定，可能由高噪声（$\\sigma$ 大）、小样本量（$n$ 小）或接近简并的前导特征值（例如 $\\tau_1 \\approx \\tau_2$）引起。这些情况即使在符号对齐后也会导致自举样本间的主成分混合。在这种情况下，单个基因对该成分的贡献无法被可靠地确定。\n\n测试套件：\n使用以下参数元组 $(n, p, \\sigma, B, \\tau_1, \\tau_2)$ 的测试套件：\n\n- 用例 1 (理想情况): $(80, 40, 0.30, 250, 2.00, 1.00)$\n- 用例 2 (高噪声边界): $(40, 40, 0.70, 250, 1.50, 1.00)$\n- 用例 3 (接近简并的因子，边界情况): $(20, 40, 0.50, 250, 1.50, 1.50)$\n\n答案规格：\n对于每个测试用例，生成一个列表 $[f, m, w]$，其中 $f$ 是置信区间不包含 $0$ 的基因比例（表示为四舍五入到 3 位小数的小数），$m$ 是置信区间宽度的中位数（四舍五入到 3 位小数），$w$ 是一个布尔值，指示在阈值 $w^\\star = 0.15$ 下区间是否为“宽”。将所有测试用例的结果汇总到单行输出中，其中包含一个由这些按用例排列的列表组成的列表，并严格按照 Python 列表字面量的形式打印。例如，最终输出格式必须为 $$\n[[f_1, m_1, w_1],[f_2, m_2, w_2],[f_3, m_3, w_3]]\n$$ 形式，不含任何额外文本。不涉及物理单位。不出现角度。百分比必须以小数形式表示，而不是使用百分号。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每一项本身都是一个指定格式的列表。所有浮点值必须四舍五入到 3 位小数。", "solution": "用户提供的问题被评估为有效。它在科学上基于统计学习和计算生物学的原理，问题定义良好，具有清晰的算法规范，并且表述客观。任务是实现一个自举程序来评估主成分分析（PCA）载荷的稳定性，这是对 PCA 结果进行有效生物学解释的关键步骤。\n\n解决方案分为四个主要阶段进行：\n1.  基于潜在因子模型生成合成基因表达数据。\n2.  从完整数据集中计算参考 PCA 载荷向量。\n3.  执行非参数自举程序以生成载荷向量的分布。\n4.  从自举分布中计算置信区间和稳定性指标。\n\n**1. 合成数据生成**\n此分析的基础是一个合成数据集 $X \\in \\mathbb{R}^{n \\times p}$，该数据集模拟具有已知底层结构的基因表达。$n$ 个样本和 $p$ 个基因的数据由一个秩-2 潜在因子模型生成：\n$$\nX_{i,\\cdot} = s_{1,i} v_1^\\top + s_{2,i} v_2^\\top + \\varepsilon_{i,\\cdot}\n$$\n在这里，$X_{i,\\cdot}$ 是样本 $i$ 的表达值行向量。向量 $v_1, v_2 \\in \\mathbb{R}^p$ 代表真实状态的“载荷”向量，模拟了两个共调控基因的模块。它们被构造成标准正交的。具体来说，$v_1$ 仅在前 12 个基因上有非零项，$v_2$ 在接下来的 12 个基因（基因 13 至 24）上有非零项。为确保单位范数 $\\|v_k\\|_2=1$，非零项被设置为 $1/\\sqrt{12}$。\n得分 $s_{1,i}$ 和 $s_{2,i}$ 独立地从正态分布中抽取，$s_{1,i} \\sim \\mathcal{N}(0, \\tau_1^2)$ 和 $s_{2,i} \\sim \\mathcal{N}(0, \\tau_2^2)$，代表了两个潜在生物学过程在 $n$ 个样本中的活动水平。与 $X$ 维度相同的矩阵 $\\varepsilon$ 代表生物学和技术噪声，其每个元素都从 $\\mathcal{N}(0, \\sigma^2)$ 中抽取。$\\tau_1, \\tau_2$ 和 $\\sigma$ 的相对大小决定了信噪比和主成分的可分离性。\n最后，生成的矩阵 $X$ 按列中心化，使得每个基因（列）在所有样本中的均值为 0。这是通过对数据矩阵进行 SVD 或对协方差矩阵进行谱分解来执行 PCA 的先决条件。\n\n**2. 参考 PCA 和载荷向量**\nPCA 在中心化的数据矩阵上执行，我们也将其表示为 $X$。计算 $X$ 的奇异值分解（SVD）：\n$$\nX = U \\Sigma V^\\top\n$$\n其中 $U \\in \\mathbb{R}^{n \\times n}$ 和 $V \\in \\mathbb{R}^{p \\times p}$ 是正交矩阵，$\\Sigma \\in \\mathbb{R}^{n \\times p}$ 是一个奇异值的矩形对角矩阵。$V$ 的列是主载荷向量。$V$ 的第一列，记为 $v_{\\text{ref}}$，是第一主成分（PC1）的载荷向量。该向量的元素 $\\{v_{\\text{ref}, j}\\}_{j=1}^p$ 量化了每个基因对 PC1 的贡献。\n\n**3. 用于置信区间的自举程序**\n为了评估 $v_{\\text{ref}}$ 中估计载荷的稳定性，我们采用非参数自举法。这种重采样技术模拟了收集新数据集的过程，以观察估计的载荷会变化多少。\n该程序执行 $B$ 次复制：\n1.  通过从中心化数据矩阵 $X$ 中有放回地抽样 $n$ 行来创建自举样本 $X^{(b)}$。\n2.  每个自举样本 $X^{(b)}$ 都被重新中心化，以使其列均值为零。这一点至关重要，因为重采样会改变列均值。\n3.  对重新中心化的自举样本 $X^{(b)}$ 执行 SVD，以获得其第一个载荷向量 $v^{(b)}$。\n4.  一个关键步骤是解决特征向量固有的符号模糊性。$v^{(b)}$ 的方向与参考向量 $v_{\\text{ref}}$ 对齐。如果点积 $v_{\\text{ref}}^\\top v^{(b)}$ 为负，则通过乘以 $-1$ 来翻转 $v^{(b)}$。这确保了所有自举载荷向量都构成一个单峰分布，前提是没有发生主成分交换。\n这个过程产生一组 $B$ 个对齐的载荷向量 $\\{v^{(b)}\\}_{b=1}^B$。\n\n**4. 稳定性指标计算**\n从载荷的自举分布中，我们推导出定量的稳定性指标。对于每个基因 $j$，其在大量自举复制中的载荷值分布 $\\{v_j^{(b)}\\}_{b=1}^B$ 被用来构建一个双侧 $(1-\\alpha)$ 置信区间（CI）。当 $\\alpha=0.05$ 时，我们使用百分位数法，将 CI 定义为 $[q_{j,0.025}, q_{j,0.975}]$，其中 $q_{j,\\gamma}$ 是概率 $\\gamma$ 处的样本分位数。\n\n从这些 CI 中计算出两个指标：\n1.  **置信区间不含零的比例：** 这是 $95\\%$ 置信区间不包含 $0$ 的基因比例。这可以识别出对 PC1 有统计上稳定、非零贡献的基因。高比例表明主成分是稳健且可解释的。\n2.  **置信区间宽度的中位数：** 基因 $j$ 的 CI 宽度是 $q_{j,0.975} - q_{j,0.025}$。所有 $p$ 个基因的这些宽度的中位数提供了关于载荷估计总体精度的单一汇总统计量。较小的中位数宽度表示高稳定性。如果此中位数宽度超过阈值 $w^\\star = 0.15$，问题将区间定义为“宽”。\n\n宽区间表示载荷不稳定，是几种情况的症状。高噪声（大 $\\sigma$）或小样本量（小 $n$）会掩盖底层信号。此外，如果前导奇异值的大小接近（例如 $\\tau_1 \\approx \\tau_2$），相应的主成分将变得难以分离。在自举复制中，第一和第二主成分可能会“交换”，这意味着计算出的 $v^{(b)}$ 对应于原始数据的第二主成分。这会导致非常宽、可能是双峰的载荷分布，简单的符号对齐无法纠正，从而正确反映了成分身份的不稳定性。\n\n实现将系统地将这整个流程应用于每个测试用例，并使用固定的随机种子以保证可复现性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the bootstrap stability analysis for PCA loadings.\n    \"\"\"\n    # Initialize a random number generator with a fixed seed for reproducibility.\n    # The problem asks to fix the random generator seed to 0.\n    rng = np.random.default_rng(0)\n\n    # Define the test cases from the problem statement.\n    # Format: (n, p, sigma, B, tau1, tau2)\n    test_cases = [\n        (80, 40, 0.30, 250, 2.00, 1.00),  # Case 1: happy path\n        (40, 40, 0.70, 250, 1.50, 1.00),  # Case 2: high noise boundary\n        (20, 40, 0.50, 250, 1.50, 1.50),  # Case 3: near-degenerate factors\n    ]\n\n    # Global parameters\n    alpha = 0.05\n    w_star = 0.15\n    num_genes_in_module = 12\n\n    results = []\n    for n, p, sigma, B, tau1, tau2 in test_cases:\n        # 1. Generate synthetic data\n        # Construct true orthonormal loading vectors v1 and v2\n        v1 = np.zeros(p)\n        v1[:num_genes_in_module] = 1.0 / np.sqrt(num_genes_in_module)\n        \n        v2 = np.zeros(p)\n        v2[num_genes_in_module:2 * num_genes_in_module] = 1.0 / np.sqrt(num_genes_in_module)\n\n        # Generate scores from Normal distributions\n        s1 = rng.normal(0, tau1, n)\n        s2 = rng.normal(0, tau2, n)\n        S = np.c_[s1, s2]  # Shape (n, 2)\n\n        V_true = np.vstack([v1, v2])  # Shape (2, p)\n\n        # Generate noise\n        E = rng.normal(0, sigma, size=(n, p))\n\n        # Construct the data matrix X as per the latent factor model\n        X = S @ V_true + E\n\n        # Column-center the data matrix, a prerequisite for PCA\n        X_centered = X - X.mean(axis=0)\n\n        # 2. Compute reference loading vector from the full dataset\n        # SVD: X = U * Sigma * V^T. np.linalg.svd returns U, s, Vt\n        _, _, Vt_ref = np.linalg.svd(X_centered, full_matrices=False)\n        v_ref = Vt_ref[0, :]  # First loading vector is the first row of V^T\n\n        # 3. Perform bootstrap procedure\n        bootstrap_loadings = np.zeros((B, p))\n        for b in range(B):\n            # Resample n rows with replacement from the centered data\n            indices = rng.choice(n, size=n, replace=True)\n            X_b = X_centered[indices, :]\n\n            # Re-center the bootstrap sample\n            X_b_centered = X_b - X_b.mean(axis=0)\n\n            # Compute SVD for the bootstrap sample\n            try:\n                _, _, Vt_b = np.linalg.svd(X_b_centered, full_matrices=False)\n                v_b = Vt_b[0, :]\n            except np.linalg.LinAlgError:\n                # In rare cases, a bootstrap sample can be rank-deficient\n                # in a way that SVD fails. We can skip such a replicate.\n                # A robust implementation might replace it, but for B=250, skipping is fine.\n                v_b = np.full(p, np.nan)\n\n\n            # Resolve sign indeterminacy by aligning with the reference vector\n            if np.dot(v_ref, v_b)  0:\n                v_b = -v_b\n\n            bootstrap_loadings[b, :] = v_b\n        \n        # Remove any NaN rows if SVD failed\n        bootstrap_loadings = bootstrap_loadings[~np.isnan(bootstrap_loadings).any(axis=1)]\n\n\n        # 4. Compute stability metrics\n        # Calculate the lower and upper quantiles for the confidence intervals\n        q_low, q_high = np.quantile(bootstrap_loadings, [alpha / 2, 1 - alpha / 2], axis=0)\n\n        # Metric 1: Fraction of genes whose CI excludes 0\n        ci_excludes_zero = (q_low > 0) | (q_high  0)\n        frac_exclude_zero = np.mean(ci_excludes_zero)\n\n        # Metric 2: Median confidence interval width\n        widths = q_high - q_low\n        median_width = np.median(widths)\n\n        # Metric 3: \"Wide intervals\" flag\n        is_wide = median_width > w_star\n\n        # Append formatted results to the list\n        results.append([\n            round(frac_exclude_zero, 3),\n            round(median_width, 3),\n            is_wide\n        ])\n    \n    # Final print statement in the exact required format.\n    # The string representation of a list in Python is its literal form.\n    print(results)\n\n\nsolve()\n```", "id": "3321032"}]}