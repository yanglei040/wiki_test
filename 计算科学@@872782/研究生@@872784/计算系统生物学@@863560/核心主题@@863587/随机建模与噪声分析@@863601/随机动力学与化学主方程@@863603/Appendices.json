{"hands_on_practices": [{"introduction": "化学主方程 (Chemical Master Equation, CME) 本质上是一个无限维的常微分方程组，直接求解在计算上通常是不可行的。有限状态投影 (Finite State Projection, FSP) 是一种直接且强大的 CME 近似求解方法。该方法通过将状态空间截断为有限大小，并追踪“泄漏”出该有限集的概率，不仅提供了近似解，还为近似误差提供了严格的界限。这项实践 [@problem_id:3351584] 将让你亲手实现一种求解 CME 的基本数值方法，并通过将其误差界限与一个可精确求解系统的真实误差进行比较，从而对该方法的准确性和保守性有更深刻、定量的理解。", "problem": "考虑一个充分混合的生化反应系统，其中单一物种 $X$ 经历零阶生成和一阶降解。反应为 $\\emptyset \\rightarrow X$（生成速率为 $\\lambda$，单位：分子/分钟）和 $X \\rightarrow \\emptyset$（降解速率为 $\\mu$，单位：/分钟）。令 $X(t)$ 表示时间 $t$ 时的分子数，令 $p_n(t)$ 表示 $X(t) = n$ 的概率。\n\n基本核心定义：\n- 针对计数状态 $n \\in \\{0,1,2,\\dots\\}$ 上的连续时间马尔可夫跳跃过程，其化学主方程 (CME) 是根据倾向函数构建的。对于给定的反应，倾向函数为 $a_{\\text{birth}}(n) = \\lambda$ 和 $a_{\\text{death}}(n) = \\mu n$。\n- CME 通过平衡流入和流出每个状态的概率通量来描述 $p_n(t)$ 的时间演化。对于 $n \\ge 0$，可以写成\n$$\n\\frac{d}{dt} p_n(t) = \\lambda p_{n-1}(t) + \\mu (n+1) p_{n+1}(t) - \\left(\\lambda + \\mu n\\right) p_n(t),\n$$\n约定 $p_{-1}(t) \\equiv 0$。\n- 有限状态投影 (FSP) 方法构建一个截断的状态空间 $\\mathcal{S}_N = \\{0,1,\\dots,N\\}$，并为其增加一个吸收汇状态，该状态捕获从 $\\mathcal{S}_N$ 中任何状态到 $\\mathcal{S}_N$ 之外状态的所有瞬时概率通量。在增广空间上的修正生成元 $A_{\\text{FSP}}$ 确保任何将离开 $\\mathcal{S}_N$ 的跃迁都被重定向到没有出向跃迁的汇状态。在时间 $t$ 得到的汇概率是该过程在时间 $t$ 处于 $\\mathcal{S}_N$ 之外的真实概率的一个上界。\n\n推导目标：\n- 从 CME 和 FSP 构建原则出发，推导带有吸收汇的截断系统的生成元 $A_{\\text{FSP}}$。\n- 给定初始条件 $p_n(0) = \\delta_{n,n_0}$（对于某个整数 $n_0 \\ge 0$，$\\delta$ 为克罗内克 δ），通过求解线性系统 $\\frac{d}{dt} \\mathbf{p}(t) = A_{\\text{FSP}} \\mathbf{p}(t)$ 来计算时间 $T$ 时的 FSP 近似状态概率，其中 $\\mathbf{p}(t)$ 包括状态 $0,1,\\dots,N$ 和汇状态的概率。\n- 独立地，推导具有确定性初始条件 $X(0) = n_0$ 的迁入-死亡过程 $X(T)$ 的精确分布。使用线性反应的随机动力学第一性原理：初始的 $n_0$ 个分子中的每一个都以概率 $e^{-\\mu T}$ 独立存活，而来自生成的贡献形成一个具有时变速率的泊松过程，其在时间 $T$ 存活的分子数产生一个均值为 $m(T) = \\frac{\\lambda}{\\mu}\\left(1 - e^{-\\mu T}\\right)$（对于 $\\mu  0$）的泊松分布计数。结论是 $X(T)$ 是两个独立随机变量之和：一个参数为 $(n_0, e^{-\\mu T})$ 的二项随机变量和一个均值为 $m(T)$ 的泊松随机变量。\n- 从这个精确刻画出发，通过对二项分布和泊松分布进行卷积，并用正则化不完全伽马函数表示泊松尾部，推导出时间 $T$ 时的真实外部概率，即 $\\mathbb{P}\\left[X(T)  N\\right]$。\n\n编程任务：\n- 实现一个程序，对于每个提供的测试用例 $(\\lambda, \\mu, n_0, T, N)$，执行以下操作：\n  1. 根据 CME 和 FSP 原则，在状态 $\\{0,1,\\dots,N\\}$ 和一个吸收汇上构建 FSP 生成元 $A_{\\text{FSP}}$。非对角线项对应截断空间内的有效跃遷，而从 $N$ 到 $N+1$ 的跃遷被重定向到汇状态。对角线项强制截断模型内概率通量的列向守恒。\n  2. 使用矩阵指数解 $\\mathbf{p}(T) = \\exp\\left(T A_{\\text{FSP}}\\right)\\mathbf{p}(0)$ 计算时间 $T$ 时的概率向量，并提取汇概率 $s(T)$，它是真实外部概率的上界。\n  3. 通过对 $b = 0,1,\\dots,n_0$ 求和，计算初始分子中 $b$ 个存活者的二项概率与泊松分量超过 $N-b$ 的生存函数，从而计算精确的外部概率 $\\mathbb{P}\\left[X(T)  N\\right]$。使用正则化不完全伽马函数来精确评估泊松尾部。\n  4. 对于每个测试用例，输出非负差值 $s(T) - \\mathbb{P}\\left[X(T)  N\\right]$，形式为浮点数。这个差值量化了 FSP 上界在时间 $T$ 的保守程度。\n\n单位：\n- 速率 $\\lambda$ 和 $\\mu$ 的单位是 /分钟，时间 $T$ 的单位是分钟。输出是概率，因此是无单位的实数。\n\n测试套件：\n- 使用以下测试用例，这些用例探索了典型行为、截断保守性和边界条件：\n  1. $(\\lambda, \\mu, n_0, T, N) = (5.0, 0.5, 0, 10.0, 40)$。\n  2. $(\\lambda, \\mu, n_0, T, N) = (20.0, 1.0, 30, 2.0, 35)$。\n  3. $(\\lambda, \\mu, n_0, T, N) = (2.0, 0.1, 50, 5.0, 15)$。\n  4. $(\\lambda, \\mu, n_0, T, N) = (3.0, 0.2, 0, 6.0, 0)$。\n\n答案规格：\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，格式为方括号内逗号分隔的列表。例如，要求的最终格式为 $[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 是第 $i$ 个测试用例的 $s(T) - \\mathbb{P}\\left[X(T)  N\\right]$ 的浮点值。", "solution": "该问题是有效的，因为它在科学上基于随机化学动力学理论，提供了所有必要信息使其成为一个适定问题，并且陈述客观。因此，我们可以进行推导和求解。\n\n该问题要求计算和比较与随机生灭过程的布居数超过某个特定值 $N$ 的概率相关的两个量。第一个量是从有限状态投影 (FSP) 方法导出的汇概率 $s(T)$，它为真实概率提供了一个上界。第二个量是精确概率 $\\mathbb{P}(X(T)  N)$。\n\n### 1. FSP 生成元矩阵 $A_{\\text{FSP}}$ 的推导\n\n有限状态投影 (FSP) 方法通过将无限状态空间截断为有限集 $\\mathcal{S}_N = \\{0, 1, \\dots, N\\}$，来提供化学主方程 (CME) 解的近似。为了确保概率守恒，添加了一个汇状态以收集所有会离开 $\\mathcal{S}_N$ 的概率质量。我们定义一个大小为 $N+2$ 的增广状态向量 $\\mathbf{p}(t)$：\n$$\n\\mathbf{p}(t) = [p_0(t), p_1(t), \\dots, p_N(t), s(t)]^T\n$$\n其中 $p_n(t)$ 是有 $n$ 个分子的概率，$s(t)$ 是处于汇状态的概率。该向量的时间演化由一个线性常微分方程组 $\\frac{d}{dt}\\mathbf{p}(t) = A_{\\text{FSP}}\\mathbf{p}(t)$ 控制，其中 $A_{\\text{FSP}}$ 是 $(N+2) \\times (N+2)$ 的 FSP 生成元矩阵。\n\n$A_{\\text{FSP}}$ 的元素由状态之间的概率通量决定。我们将状态从 $0$ 索引到 $N+1$，其中索引 $N+1$ 对应于汇状态。元素 $A_{ij}$ 表示从状态 $j$ 到状态 $i$ 的通量速率。\n\n反应为 $\\emptyset \\xrightarrow{\\lambda} X$ 和 $X \\xrightarrow{\\mu} \\emptyset$。倾向函数为 $a_{\\text{birth}}(n) = \\lambda$ 和 $a_{\\text{death}}(n) = \\mu n$。\n\n对于状态 $n$ 且 $0  n  N$：\n- 生成反应以速率 $\\lambda$ 将系统从状态 $n$ 跃遷到 $n+1$。这贡献了 $A_{n+1, n} = \\lambda$。\n- 降解反应以速率 $\\mu n$ 将系统从状态 $n$ 跃遷到 $n-1$。这贡献了 $A_{n-1, n} = \\mu n$。\n- 对角线元素 $A_{n,n}$ 是离开状态 $n$ 的所有反应速率之和的负值：$A_{n,n} = -(\\lambda + \\mu n)$。\n\n对于 $\\mathcal{S}_N$ 的边界状态：\n- 对于状态 $n=0$：只能发生生成反应，导致状态 $1$。速率为 $\\lambda$。所以，$A_{1,0} = \\lambda$ 且 $A_{0,0} = -\\lambda$。\n- 对于状态 $n=N$：降解反应导致状态 $N-1$，速率为 $\\mu N$，所以 $A_{N-1, N} = \\mu N$。生成反应会导致状态 $N+1$，它在 $\\mathcal{S}_N$ 之外。此通量以速率 $\\lambda$ 被重定向到汇状态（索引 $N+1$）。因此，$A_{N+1, N} = \\lambda$。对角线元素为 $A_{N,N} = -(\\lambda + \\mu N)$。\n\n对于汇状态（索引 $N+1$）：\n- 它是一个吸收态，意味着没有通量离开它。因此，$A_{\\text{FSP}}$ 的第 $N+1$ 整列为零：对于所有 $i \\in \\{0, \\dots, N+1\\}$，$A_{i, N+1} = 0$。\n\n综合这些元素，生成元矩阵 $A_{\\text{FSP}}$ 具有以下结构：\n$$\nA_{\\text{FSP}} = \n\\begin{pmatrix}\n-\\lambda  \\mu  0  \\dots  0  0  0 \\\\\n\\lambda  -(\\lambda+\\mu)  2\\mu  \\dots  0  0  0 \\\\\n0  \\lambda  -(\\lambda+2\\mu)  \\dots  0  0  0 \\\\\n\\vdots  \\vdots  \\vdots  \\ddots  \\vdots  \\vdots  \\vdots \\\\\n0  0  0  \\dots  \\lambda  -(\\lambda+N\\mu)  0 \\\\\n0  0  0  \\dots  0  \\lambda  0\n\\end{pmatrix}\n$$\n这是一个 $(N+2) \\times (N+2)$ 的矩阵，其中第 $i$ 行和第 $j$ 列（0-索引）的元素由以下公式给出：\n- $A_{j-1, j} = \\mu j$ for $1 \\le j \\le N$\n- $A_{j+1, j} = \\lambda$ for $0 \\le j \\le N-1$\n- $A_{N+1, N} = \\lambda$\n- $A_{j, j} = -(\\lambda + \\mu j)$ for $0 \\le j \\le N$\n- 所有其他元素均为 $0$。\n\n### 2. 计算 FSP 汇概率 $s(T)$\n\n给定初始条件 $X(0) = n_0$，我们定义初始概率向量 $\\mathbf{p}(0)$。\n- 如果 $n_0 \\le N$，系统从状态 $n_0$ 开始。所以 $\\mathbf{p}(0)$ 是一个在索引 $n_0$ 处为 $1$、其他位置为零的向量。\n- 如果 $n_0  N$，系统开始时位于 FSP 追踪的状态之外。初始概率完全在汇状态中。$\\mathbf{p}(0)$ 是一个在索引 $N+1$ 处为 $1$、其他位置为零的向量。\n\n线性常微分方程组的解是 $\\mathbf{p}(T) = \\exp(T \\cdot A_{\\text{FSP}}) \\mathbf{p}(0)$，其中 $\\exp(\\cdot)$ 是矩阵指数。在时间 $T$ 的汇概率，记为 $s(T)$，是此向量的最后一个元素，$s(T) = \\mathbf{p}_{N+1}(T)$。\n\n### 3. 精确外部概率 $\\mathbb{P}(X(T)  N)$ 的推导\n\n具有线性速率的生灭过程是少数几个具有已知解析解的随机反应系统之一。对于 $X(0) = n_0$ 的初始状态，时间 $T$ 时的分子数 $X(T)$ 是两个独立随机变量的和：\n1.  $B$：来自初始布居的存活分子数。$n_0$ 个分子中的每一个都以概率 $p = e^{-\\mu T}$ 存活。因此，$B \\sim \\text{Binomial}(n_0, e^{-\\mu T})$。\n2.  $P$：由生成过程产生并在时间 $T$ 仍然存在的分子数。该计数遵循泊松分布，$P \\sim \\text{Poisson}(m(T))$，其均值为 $m(T) = \\frac{\\lambda}{\\mu}(1 - e^{-\\mu T})$。\n\n因此，$X(T) = B + P$。我们需要计算概率 $\\mathbb{P}(X(T)  N)$。我们可以通过以 $B$ 的值为条件来做到这一点：\n$$\n\\mathbb{P}(X(T)  N) = \\sum_{b=0}^{n_0} \\mathbb{P}(X(T)  N | B=b) \\mathbb{P}(B=b)\n$$\n给定 $B=b$，条件 $X(T)  N$ 变为 $b+P  N$，即 $P  N-b$。因此公式为：\n$$\n\\mathbb{P}(X(T)  N) = \\sum_{b=0}^{n_0} \\mathbb{P}(P  N-b) \\cdot \\mathbb{P}(B=b)\n$$\n和中的项是：\n- 二项概率：$\\mathbb{P}(B=b) = \\binom{n_0}{b} (e^{-\\mu T})^b (1-e^{-\\mu T})^{n_0-b}$。\n- 泊松生存函数（尾概率）：$\\mathbb{P}(P  k)$。这由 $\\sum_{j=k+1}^{\\infty} e^{-m} \\frac{m^j}{j!}$ 给出。这等价于正则化上不完全伽马函数，$Q(k+1, m) = \\frac{\\Gamma(k+1, m)}{\\Gamma(k+1)}$。\n如果 $N-b  0$ (即 $b  N$)，概率 $\\mathbb{P}(P  N-b)$ 为 $1$，因为泊松随机变量 $P$ 是非负的。\n\n综合这些部分，精确概率为：\n$$\n\\mathbb{P}(X(T)  N) = \\sum_{b=0}^{n_0} \\left[ \\binom{n_0}{b} (e^{-\\mu T})^b (1-e^{-\\mu T})^{n_0-b} \\right] \\cdot \\mathbb{P}(P  N-b)\n$$\n其中\n$$\n\\mathbb{P}(P  N-b) = \\begin{cases} 1  \\text{if } b  N \\\\ Q(N-b+1, m(T))  \\text{if } b \\le N \\end{cases}\n$$\n且 $m(T) = \\frac{\\lambda}{\\mu}(1 - e^{-\\mu T})$。\n\n### 4. 实现策略\n\n程序将遍历每个测试用例。对于每组参数 $(\\lambda, \\mu, n_0, T, N)$，它将：\n1.  在 `numpy` 中构建 $(N+2) \\times (N+2)$ 矩阵 $A_{\\text{FSP}}$。\n2.  根据 $n_0  N$ 是否成立来设置初始状态向量 $\\mathbf{p}(0)$。\n3.  使用 `scipy.linalg.expm` 计算 $\\mathbf{p}(T) = \\exp(T \\cdot A_{\\text{FSP}}) \\mathbf{p}(0)$ 并提取汇概率 $s(T)$。\n4.  通过对卷积项求和来计算精确概率 $\\mathbb{P}(X(T)  N)$。二项式系数将使用 `scipy.special.comb` 计算，泊松尾概率将使用 `scipy.special.gammaincc` 计算。\n5.  计算差值 $s(T) - \\mathbb{P}(X(T)  N)$ 并存储结果。\n\n最后，收集到的结果将以指定格式打印。需要特别注意 $n_0  N$ 和 $N=0$ 等边界情况。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\nfrom scipy.special import comb, gammaincc\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases by comparing the FSP sink probability\n    with the exact outside probability for a birth-death process.\n    \"\"\"\n    # Test cases from the problem statement: (lambda, mu, n0, T, N)\n    test_cases = [\n        (5.0, 0.5, 0, 10.0, 40),\n        (20.0, 1.0, 30, 2.0, 35),\n        (2.0, 0.1, 50, 5.0, 15),\n        (3.0, 0.2, 0, 6.0, 0),\n    ]\n\n    results = []\n    for case in test_cases:\n        lam, mu, n0, T, N_float = case\n        n0 = int(n0)\n        N = int(N_float)\n\n        # 1. Compute FSP sink probability s(T)\n        dim = N + 2  # State space {0, 1, ..., N} plus a sink state\n        A_fsp = np.zeros((dim, dim))\n\n        # Populate the FSP generator matrix A_fsp\n        # Diagonal and sub-diagonal entries\n        for n in range(N + 1):\n            # Flux out of state n\n            outgoing_rate = 0.0\n            # Birth reaction (n -> n+1)\n            if n  N:\n                A_fsp[n + 1, n] = lam\n                outgoing_rate += lam\n            else: # n == N, birth goes to sink\n                A_fsp[N + 1, n] = lam # N+1 is the sink index\n                outgoing_rate += lam\n            \n            # Death reaction (n -> n-1)\n            if n > 0:\n                A_fsp[n - 1, n] = mu * n\n                outgoing_rate += mu * n\n\n            A_fsp[n, n] = -outgoing_rate\n            \n        # The sink state (column N+1) is absorbing, so column is all zeros, which is the default.\n\n        # Initial condition vector p(0)\n        p0 = np.zeros(dim)\n        if n0 > N:\n            # Initial state is outside the tracked region, so all probability is in the sink\n            p0[N + 1] = 1.0\n        else:\n            # Initial state is within the tracked region\n            p0[n0] = 1.0\n\n        # Solve the ODE system using matrix exponential\n        pT = expm(T * A_fsp) @ p0\n        sT = pT[N + 1]\n\n        # 2. Compute exact outside probability P(X(T) > N)\n        # Parameters for the exact distribution X(T) = B + P\n        # B ~ Binomial(n0, p_survive), P ~ Poisson(m)\n        if mu > 1e-9: # mu is positive\n            p_survive = np.exp(-mu * T)\n            m = (lam / mu) * (1.0 - p_survive)\n        else: # mu is zero (not in test cases, but for completeness)\n            p_survive = 1.0\n            m = lam * T\n\n        # Convolve Binomial and Poisson distributions\n        prob_outside_exact = 0.0\n        for b in range(n0 + 1):\n            binom_prob = comb(n0, b, exact=False) * (p_survive**b) * ((1 - p_survive)**(n0-b))\n            \n            # If a term is negligible, skip calculation to avoid numerical issues\n            if binom_prob  1e-100:\n                continue\n\n            # We need to compute P(P > N - b)\n            k = N - b\n            if k  0:\n                # If b > N, P > N-b is always true since P >= 0.\n                poisson_tail_prob = 1.0\n            else:\n                # P(P > k) = Q(k+1, m), where Q is regularized upper incomplete gamma\n                # gammaincc(a,x) is defined for a > 0. Here a = k+1, so k >= 0\n                poisson_tail_prob = gammaincc(k + 1, m)\n            \n            prob_outside_exact += binom_prob * poisson_tail_prob\n\n        # 3. Calculate the difference\n        # The FSP sink probability is an upper bound on the true outside probability.\n        # This difference should be non-negative.\n        difference = sT - prob_outside_exact\n        results.append(difference)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```", "id": "3351584"}, {"introduction": "对于许多复杂系统而言，通过 FSP 求解完整的概率分布计算成本过高。在很多情况下，我们更关心的是均值和方差等统计矩的演化。直接从 CME 推导矩方程会遇到一个固有挑战：第 $k$ 阶矩的方程依赖于第 $k+1$ 阶矩，形成一个无法封闭的层级结构。矩封闭近似 (Moment closure approximations) 的核心思想是用低阶矩来近似高阶矩，从而使方程组得以求解。这项练习 [@problem_id:3351626] 将指导你推导矩方程，并实现几种主流的矩封闭方案，你将学会不同的统计假设如何导出不同的近似，并评估它们在不同参数区域下的表现，这是模型分析中的一项关键技能。", "problem": "考虑一个单物种随机反应网络，其中分子物种 $X$ 包含以下质量作用反应：\n- $R_1$: $\\varnothing \\rightarrow X$，倾向性函数为 $a_1(x) = k_b$，化学计量变化为 $v_1 = +1$。\n- $R_2$: $X \\rightarrow \\varnothing$，倾向性函数为 $a_2(x) = k_d x$，化学计量变化为 $v_2 = -1$。\n- $R_3$: $2X \\rightarrow \\varnothing$，倾向性函数为 $a_3(x) = k_a \\, x(x-1)/2$，化学计量变化为 $v_3 = -2$。\n\n您的任务是从化学主方程 (CME) 和标准的期望值正向方程恒等式出发，推导、实现并评估稳态矩封闭。\n\n基本基础：\n- 化学主方程 (CME) 控制了物种 $X$ 的拷贝数 $x \\in \\mathbb{N}_0$ 的概率质量函数 $P(x,t)$ 的时间演化。\n- 对于任何测试函数 $f(x)$，以下恒等式成立：\n$$\n\\frac{d}{dt}\\mathbb{E}[f(X)] = \\mathbb{E}\\left[ \\sum_{r} a_r(X) \\left(f(X + v_r) - f(X)\\right) \\right]\n$$\n其中总和遍及所有反应 $r$，$a_r$ 是倾向性函数，$v_r$ 是化学计量变化。\n\n问题要求：\n1. 推导由上述网络的 CME 蕴含的、关于一阶和二阶原矩 $m_1(t) = \\mathbb{E}[X(t)]$ 与 $m_2(t) = \\mathbb{E}[X(t)^2]$ 的耦合常微分方程 (ODE)。用 $m_1(t)$、$m_2(t)$ 和三阶原矩 $m_3(t) = \\mathbb{E}[X(t)^3]$ 明确表示您最终的 ODE。\n2. 实现三种不同的矩封闭方法，以获得稳态矩 $(m_1^\\star, m_2^\\star)$ 的封闭系统：\n   - 正态封闭：假设三阶中心累积量为零，这蕴含了 $m_3$、$m_1$ 和 $m_2$ 之间的一个关系。\n   - 对数正态封闭：假设 $X$ 近似服从对数正态分布，这蕴含了 $m_3$、$m_1$ 和 $m_2$ 之间的一个关系。\n   - 泊松-方差封闭：假设 $X$ 在稳态时近似服从泊松分布，从而在 $m_2$ 和 $m_1$ 之间施加一个关系，并仅为 $m_1$ 产生一个代数稳态条件。\n3. 计算每种封闭方法的稳态解 $(m_1^\\star, \\sigma^{2\\star})$，其中 $\\sigma^{2\\star} = m_2^\\star - (m_1^\\star)^2$。在必要时，对封闭的稳态方程使用数值求根。通过为具有挑战性的参数区域提供合理的初始猜测和备用方案，确保数值鲁棒性。所有输出必须是有限实数。\n4. 测试套件。对于下面的每个参数集 $(k_b,k_d,k_a)$，计算每种封闭下的稳态均值和方差。使用以下参数集：\n   - 情况 A (边界，单分子): $(k_b,k_d,k_a) = (10.0, 1.0, 0.0)$。\n   - 情况 B (中度非线性): $(k_b,k_d,k_a) = (50.0, 1.0, 0.01)$。\n   - 情况 C (更强的非线性损失): $(k_b,k_d,k_a) = (50.0, 0.1, 0.05)$。\n   - 情况 D (低计数): $(k_b,k_d,k_a) = (1.0, 1.0, 0.5)$。\n5. 输出规范。您的程序必须生成单行输出，其中包含一个逗号分隔的浮点数列表，四舍五入到六位小数。对于每种情况，按\n   - $[m_{1,\\mathrm{normal}}^\\star, \\sigma^{2\\star}_{\\mathrm{normal}}, m_{1,\\mathrm{logn}}^\\star, \\sigma^{2\\star}_{\\mathrm{logn}}, m_{1,\\mathrm{pois}}^\\star, \\sigma^{2\\star}_{\\mathrm{pois}}]$ 的顺序报告结果，\n然后按 A、B、C、D 的顺序连接这些列表。因此，最终输出必须是\n- $[$caseA\\_entries, caseB\\_entries, caseC\\_entries, caseD\\_entries$]$\n形式的单行文本，所有数值条目均为十进制浮点数。\n6. 角度单位和物理单位不适用于此问题。所有数值输出必须是无单位的实数。\n\n设计说明和约束：\n- 您不得依赖任何外部文件或用户输入。所有计算必须是自包含的。\n- 稳态解必须通过求解每种封闭方法所蕴含的封闭稳态方程来获得。当使用泊松-方差封闭时，使用为 $m_1^\\star$ 蕴含的代数稳态条件；当使用其他封闭方法时，求解 $(m_1^\\star, m_2^\\star)$ 的二维稳态问题。\n- 为了在对数正态封闭中当 $m_1$ 接近零时保持数值稳定性，您必须实现一个避免除以零的限制性保障措施。\n- 最终程序必须精确打印一行，其中包含用方括号括起来的逗号分隔列表形式的结果，不得有任何附加文本。所有数字必须四舍五入到六位小数。", "solution": "目标是使用三种不同的矩封闭近似，为单物种随机反应网络推导并求解稳态矩方程。\n\n该随机系统由一个分子数为 $x$ 的物种 $X$ 和三个反应定义：\n- $R_1$: $\\varnothing \\rightarrow X$，倾向性函数为 $a_1(x) = k_b$，化学计量为 $v_1 = +1$。\n- $R_2$: $X \\rightarrow \\varnothing$，倾向性函数为 $a_2(x) = k_d x$，化学计量为 $v_2 = -1$。\n- $R_3$: $2X \\rightarrow \\varnothing$，倾向性函数为 $a_3(x) = k_a x(x-1)/2$，化学计量为 $v_3 = -2$。\n\n函数 $f(X)$ 的期望值的时间演化由以下恒等式给出：\n$$\n\\frac{d}{dt}\\mathbb{E}[f(X)] = \\mathbb{E}\\left[ \\sum_{r=1}^{3} a_r(X) \\left(f(X + v_r) - f(X)\\right) \\right]\n$$\n\n**1. 矩方程的推导**\n\n我们推导一阶和二阶原矩 $m_1(t) = \\mathbb{E}[X(t)]$ 和 $m_2(t) = \\mathbb{E}[X(t)^2]$ 的常微分方程 (ODE)。\n\n**对于一阶原矩，$m_1(t)$：**\n令 $f(x) = x$。我们评估每个反应的变化：\n- $R_1$: $a_1(x)(f(x+v_1) - f(x)) = k_b((x+1)-x) = k_b$。\n- $R_2$: $a_2(x)(f(x+v_2) - f(x)) = k_d x((x-1)-x) = -k_d x$。\n- $R_3$: $a_3(x)(f(x+v_3) - f(x)) = \\frac{k_a x(x-1)}{2}((x-2)-x) = -k_a x(x-1)$。\n\n对这些项的总和取期望，得到 $m_1(t)$ 的 ODE：\n$$\n\\frac{d m_1}{dt} = \\mathbb{E}[k_b - k_d X - k_a X(X-1)] = k_b - k_d \\mathbb{E}[X] - k_a \\mathbb{E}[X^2 - X]\n$$\n用矩表示，即为：\n$$\n\\frac{d m_1}{dt} = k_b - k_d m_1 - k_a (m_2 - m_1)\n$$\n\n**对于二阶原矩，$m_2(t)$：**\n令 $f(x) = x^2$。我们评估每个反应的变化：\n- $R_1$: $a_1(x)(f(x+v_1) - f(x)) = k_b((x+1)^2 - x^2) = k_b(2x+1)$。\n- $R_2$: $a_2(x)(f(x+v_2) - f(x)) = k_d x((x-1)^2 - x^2) = k_d x(-2x+1) = -2k_d x^2 + k_d x$。\n- $R_3$: $a_3(x)(f(x+v_3) - f(x)) = \\frac{k_a x(x-1)}{2}((x-2)^2 - x^2) = \\frac{k_a x(x-1)}{2}(-4x+4) = -2k_a x(x-1)^2 = -2k_a(x^3 - 2x^2 + x)$。\n\n对这些项的总和取期望，得到 $m_2(t)$ 的 ODE：\n$$\n\\frac{d m_2}{dt} = \\mathbb{E}[k_b(2X+1) + (-2k_d X^2 + k_d X) - 2k_a(X^3 - 2X^2 + X)]\n$$\n用矩表示，即为：\n$$\n\\frac{d m_2}{dt} = k_b(2m_1+1) + k_d m_1 - 2k_d m_2 - 2k_a(m_3 - 2m_2 + m_1)\n$$\n其中 $m_3(t) = \\mathbb{E}[X(t)^3]$ 是三阶原矩。\n\n**2. 稳态方程和矩封闭方案**\n\n在稳态时，矩是恒定的，因此 $\\frac{d m_1}{dt} = 0$ 和 $\\frac{d m_2}{dt} = 0$。令 $m_k^\\star$ 表示稳态矩。方程组为：\n$$\n(1) \\quad 0 = k_b - k_d m_1^\\star - k_a (m_2^\\star - m_1^\\star)\n$$\n$$\n(2) \\quad 0 = k_b(2m_1^\\star+1) + k_d m_1^\\star - 2k_d m_2^\\star - 2k_a(m_3^\\star - 2m_2^\\star + m_1^\\star)\n$$\n由于 $m_3^\\star$ 的存在，该系统是不封闭的。我们应用三种不同的封闭方案来用 $m_1^\\star$ 和 $m_2^\\star$ 表示 $m_3^\\star$。\n\n**A. 泊松-方差封闭**\n这种封闭假设稳态分布近似为泊松分布。泊松分布的一个关键特性是其方差等于其均值。\n假设：$\\sigma^{2\\star} = m_1^\\star$。\n由于 $\\sigma^{2\\star} = m_2^\\star - (m_1^\\star)^2$，这蕴含了封闭关系：\n$$\nm_2^\\star = (m_1^\\star)^2 + m_1^\\star\n$$\n将此代入 $m_1^\\star$ 的稳态方程（方程 1）：\n$$\n0 = k_b - k_d m_1^\\star - k_a ( ((m_1^\\star)^2 + m_1^\\star) - m_1^\\star )\n$$\n$$\nk_a (m_1^\\star)^2 + k_d m_1^\\star - k_b = 0\n$$\n这是一个关于 $m_1^\\star$ 的二次方程。取有物理意义的正根，我们得到：\n- 如果 $k_a  0$：$m_1^\\star = \\frac{-k_d + \\sqrt{k_d^2 + 4k_a k_b}}{2k_a}$。\n- 如果 $k_a = 0$：方程变为线性方程 $k_d m_1^\\star - k_b = 0$，因此 $m_1^\\star = k_b/k_d$。\n稳态方差则简单地为 $\\sigma^{2\\star} = m_1^\\star$。\n\n**B. 正态封闭**\n这种封闭假设三阶中心矩为零，这对于正态（高斯）分布是成立的。三阶中心矩 $\\mu_3$ 与原矩的关系为 $\\mu_3 = m_3 - 3m_1m_2 + 2m_1^3$。\n假设：$\\mu_3^\\star = 0$。\n这为三阶原矩提供了封闭关系：\n$$\nm_3^\\star = 3m_1^\\star m_2^\\star - 2(m_1^\\star)^3\n$$\n将此代入方程 (1) 和 (2)，得到一个关于 $(m_1^\\star, m_2^\\star)$ 的两个非线性代数方程的封闭系统：\n$$\n0 = k_b - (k_d-k_a)m_1^\\star - k_a m_2^\\star\n$$\n$$\n0 = k_b(2m_1^\\star+1) + k_d m_1^\\star - 2k_d m_2^\\star - 2k_a( (3m_1^\\star m_2^\\star - 2(m_1^\\star)^3) - 2m_2^\\star + m_1^\\star)\n$$\n该系统必须进行数值求解。\n\n**C. 对数正态封闭**\n这种封闭假设 $X$ 在稳态时的分布可以由对数正态分布近似。如果 $X \\sim \\text{LogNormal}(\\mu, \\sigma^2)$，其原矩为 $m_k = \\exp(k\\mu + k^2\\sigma^2/2)$。由此可以推导出前三阶原矩之间的关系：\n$$\nm_3^\\star = \\frac{(m_2^\\star)^3}{(m_1^\\star)^3}\n$$\n将此代入方程 (1) 和 (2)，得到另一个关于 $(m_1^\\star, m_2^\\star)$ 的封闭系统：\n$$\n0 = k_b - (k_d-k_a)m_1^\\star - k_a m_2^\\star\n$$\n$$\n0 = k_b(2m_1^\\star+1) + k_d m_1^\\star - 2k_d m_2^\\star - 2k_a\\left( \\frac{(m_2^\\star)^3}{(m_1^\\star)^3} - 2m_2^\\star + m_1^\\star \\right)\n$$\n该系统也需要数值求解。为了防止在数值求根过程中当 $m_1^\\star$ 在 0 附近探索时出现除以零的情况，在三次项内部加入一个小的 epsilon，例如 $10^{-12}$：$(m_1^\\star)^3 + \\epsilon$。\n\n**3. 求解方法**\n\n对于每个参数集 $(k_b, k_d, k_a)$：\n1.  **特殊情况 $k_a=0$**：当 $k_a=0$ 时，系统简化为一个简单的生灭过程 $\\varnothing \\leftrightarrows X$。稳态分布是精确的泊松分布。矩方程变为线性，可以解析求解：\n    $m_1^\\star = k_b/k_d$。\n    $m_2^\\star = (m_1^\\star)^2 + m_1^\\star$。\n    因此，$\\sigma^{2\\star} = m_1^\\star$。对于 $k_a=0$ 的情况，所有三种封闭方法都得出这个精确结果。\n2.  **一般情况 $k_a  0$**：\n    - 泊松封闭解 $(m_{1, \\text{pois}}^\\star, \\sigma^{2\\star}_{\\text{pois}})$ 使用二次公式解析计算。\n    - 对于正态和对数正态封闭的非线性系统，使用求根算法 (`scipy.optimize.root`)进行数值求解。\n    - 通过泊松封闭计算出的矩为数值求解器提供了一个鲁棒的初始猜测，即 $m_1^{(0)} = m_{1, \\text{pois}}^\\star$ 和 $m_2^{(0)} = (m_1^{(0)})^2 + m_1^{(0)}$。\n3.  **最终输出**：对于每种封闭，计算并报告稳态均值 $m_1^\\star$ 和方差 $\\sigma^{2\\star} = m_2^\\star - (m_1^\\star)^2$。\n\n实现将遵循这些推导来计算四个测试用例所需的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (kb, kd, ka)\n    test_cases = [\n        (10.0, 1.0, 0.0),    # Case A\n        (50.0, 1.0, 0.01),   # Case B\n        (50.0, 0.1, 0.05),   # Case C\n        (1.0, 1.0, 0.5),     # Case D\n    ]\n\n    results = []\n    for params in test_cases:\n        case_results = compute_for_case(*params)\n        results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef compute_for_case(kb, kd, ka):\n    \"\"\"\n    Computes the steady-state mean and variance for a single parameter set\n    under the three specified closure schemes.\n\n    Args:\n        kb (float): Birth rate constant.\n        kd (float): Linear death rate constant.\n        ka (float): Quadratic death rate constant.\n\n    Returns:\n        list: A list of 6 floats: [m1_norm, var_norm, m1_logn, var_logn, m1_pois, var_pois]\n    \"\"\"\n\n    # Case A (ka=0) has an exact analytical solution (Poisson distribution)\n    if ka == 0.0:\n        if kd > 0:\n            m1_exact = kb / kd\n            var_exact = m1_exact\n        else: # Should not happen with given test cases\n            m1_exact = np.inf\n            var_exact = np.inf\n        return [m1_exact, var_exact, m1_exact, var_exact, m1_exact, var_exact]\n\n    # 1. Poisson-variance closure (analytical solution)\n    # ka*m1^2 + kd*m1 - kb = 0\n    m1_pois = (-kd + np.sqrt(kd**2 + 4 * ka * kb)) / (2 * ka)\n    var_pois = m1_pois\n\n    # Initial guess for numerical solvers based on the Poisson closure result\n    m1_guess = m1_pois\n    m2_guess = m1_guess**2 + m1_guess\n    initial_guess = [m1_guess, m2_guess]\n\n    # --- Closure-specific systems for the root finder ---\n\n    # 2. Normal closure\n    def system_normal(m, kb, kd, ka):\n        m1, m2 = m\n        # Physicality constraints to guide solver\n        if m1 = 0 or m2 = 0:\n            return [1e6, 1e6]\n        \n        m3_norm = 3 * m1 * m2 - 2 * m1**3\n        \n        # Steady-state equations\n        eq1 = kb - kd * m1 - ka * (m2 - m1)\n        eq2 = kb * (2 * m1 + 1) + kd * m1 - 2 * kd * m2 - 2 * ka * (m3_norm - 2 * m2 + m1)\n        return [eq1, eq2]\n\n    # 3. Log-normal closure\n    def system_lognormal(m, kb, kd, ka):\n        m1, m2 = m\n        # Physicality and numerical stability constraints\n        if m1 = 0 or m2 = 0:\n            return [1e6, 1e6]\n        \n        # Safeguard to prevent division by zero, as required by the problem\n        m3_logn = m2**3 / (m1**3 + 1e-12)\n\n        # Steady-state equations\n        eq1 = kb - kd * m1 - ka * (m2 - m1)\n        eq2 = kb * (2 * m1 + 1) + kd * m1 - 2 * kd * m2 - 2 * ka * (m3_logn - 2 * m2 + m1)\n        return [eq1, eq2]\n\n    # --- Solve systems and compute results ---\n\n    # Solve for Normal closure\n    sol_normal = root(system_normal, initial_guess, args=(kb, kd, ka), method='hybr')\n    m1_norm, m2_norm = sol_normal.x\n    # Variance can be negative if the closure yields a non-physical result\n    var_norm = m2_norm - m1_norm**2\n\n    # Solve for Log-normal closure\n    sol_lognormal = root(system_lognormal, initial_guess, args=(kb, kd, ka), method='hybr')\n    m1_logn, m2_logn = sol_lognormal.x\n    var_logn = m2_logn - m1_logn**2\n\n    return [m1_norm, var_norm, m1_logn, var_logn, m1_pois, var_pois]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3351626"}, {"introduction": "作为矩方法的一种替代方案，化学朗之万方程 (Chemical Langevin Equation, CLE) 将离散的随机过程近似为由随机微分方程描述的连续过程。这种方法通常计算效率更高，但其准确性何时能够保证？CLE 的有效性依赖于两个核心假设：一是在一个时间步内发生足够多的反应事件以满足高斯近似，二是反应倾向性函数在该时间步内变化不大。这项实践将这些条件形式化为一个可计算的准则。通过为 CLE 实现一个有效性检验 [@problem_id:3351587]，你将超越盲目应用近似的阶段，学会定量地评估何时连续近似是合理的，这对于建立稳健的随机系统模型（尤其是在低分子数场景下）至关重要。", "problem": "您的任务是形式化并实现一个可计算的有效性准则，该准则用于比较化学朗之万方程（CLE）近似与充分混合反应网络的精确化学主方程（CME）动力学之间的误差。您的推導和实现必须从基本的CME表示、倾向函数的状态变化形式以及作为CLE基础的高斯扩散近似出发，并且必须包含倾向函数的李普希兹常数和期望拷贝数。然后，您将使用此准则，通过计算在您的准则下CLE变得可接受的最小期望分子数，来量化CLE在低拷贝数下的失效阈值。\n\n您必须使用的基本原理包括：\n- 用于充分混合马尔可夫跳跃过程的CME，其状态向量为 $X(t) \\in \\mathbb{N}^S$，化学计量向量为 $\\nu_j \\in \\mathbb{Z}^S$，倾向函数为 $a_j(x)$，其中精确的更新由速率为 $a_j(x)$ 的独立泊松计数驱动。\n- CLE，它通过高斯增量来近似泊松增量，以便在一个时间步长 $\\Delta t$ 内，物种的增量为 $X(t+\\Delta t) - X(t) \\approx \\sum_{j=1}^R \\nu_j \\left( a_j(X(t)) \\Delta t + \\sqrt{a_j(X(t)) \\Delta t}\\,\\xi_j \\right)$，其中 $\\xi_j$ 是独立的标准正态随机变量。\n- 跳跃条件和正态近似的基本原理：当(i)每个通道在 $\\Delta t$ 内的泊松计数足够大以至于高斯近似是合适的，以及(ii)倾向函数在步长内没有明显变化时，CLE被认为是准确的。后者可以使用倾向函数相对于物种计数的李普希兹连续性来形式化。\n\n从这些基础出发，对于一个状态 $x \\in \\mathbb{R}^S_{\\ge 0}$（解释为期望分子数）和一个步长 $\\Delta t  0$，定义以下无量纲的通道诊断参数：\n1. 反应 $j$ 的高斯性参数，\n$$\\gamma_j(x,\\Delta t) \\equiv \\frac{1}{\\sqrt{a_j(x)\\,\\Delta t}},$$\n它根据期望泊松计数 $a_j(x)\\Delta t$ 捕获了泊松-高斯近似误差的贝里-埃森尺度量级。\n2. 反应 $j$ 的李普希兹跳跃参数，\n$$\\tau_j(x,\\Delta t) \\equiv \\Delta t \\cdot \\frac{\\sum_{i=1}^S \\left| \\frac{\\partial a_j}{\\partial x_i}(x) \\right| \\cdot \\left(\\sum_{k=1}^R \\left|\\nu_{ik}\\right|\\,a_k(x)\\right)}{a_j(x)},$$\n它将一步内倾向函数的一阶变化量级（使用 $a_j$ 的梯度和每个物种的总期望活性 $\\sum_k |\\nu_{ik}| a_k$ 进行线性化）与 $a_j$ 本身的尺度进行比较。\n\n给定用户指定的容差 $\\varepsilon \\in (0,1)$，将状态 $x$ 和步长 $\\Delta t$ 下的组合CLE有效性指数定义为\n$$S(x,\\Delta t;\\varepsilon) \\equiv \\max_{1 \\le j \\le R} \\max\\left\\{\\frac{\\gamma_j(x,\\Delta t)}{\\varepsilon}, \\frac{\\tau_j(x,\\Delta t)}{\\varepsilon}\\right\\}.$$\n根据构造，准则 $S(x,\\Delta t;\\varepsilon) \\le 1$ 要求所有通道同时具有足够的高斯性并满足跳跃平滑条件。此准则明确地依赖于倾向函数 $a_j(x)$、它们的李普希兹常数（通过偏导数）、化学计量 $\\nu$、步长 $\\Delta t$ 和期望拷贝数 $x$。\n\n您的编程任务：对于下面的每个测试用例，按如下方式计算使CLE变得可接受的最小期望分子数阈值。\n\n- 对于单物种网络，令 $x \\in \\mathbb{R}_{\\ge 0}$ 表示物种 $X$ 的期望计数。找出满足 $S(x_{\\mathrm{crit}},\\Delta t;\\varepsilon) \\le 1$ 的最小整数 $x_{\\mathrm{crit}} \\ge 1$。如果在 $x_{\\mathrm{crit}} \\le 10^6$ 的范围内不存在这样的 $x_{\\mathrm{crit}}$，则该用例返回 $-1$。\n- 对于双物种可逆异构化，令总期望计数为 $N \\in \\mathbb{R}_{\\ge 0}$，其稳态分配为 $x = \\frac{k_2}{k_1+k_2} N$ 和 $y = \\frac{k_1}{k_1+k_2} N$。找出满足 $S\\big((x,y),\\Delta t;\\varepsilon\\big) \\le 1$ 的最小整数 $N_{\\mathrm{crit}} \\ge 1$。如果在 $N_{\\mathrm{crit}} \\le 10^6$ 的范围内不存在这样的 $N_{\\mathrm{crit}}$，则返回 $-1$。\n\n假设质量作用倾向函数仅限于零级（源）反应和单分子反应：\n- 零级：$a_j(x) = c_j$，其中对所有 $i$ 都有 $\\frac{\\partial a_j}{\\partial x_i} = 0$。\n- 关于物种 $i^\\star$ 的单分子反应：$a_j(x) = c_j x_{i^\\star}$，其中如果 $i = i^\\star$，则 $\\frac{\\partial a_j}{\\partial x_i} = c_j$，否则为 $0$。\n\n将所有速率 $c_j$视为秒的倒数，时间单位为秒，物种计数视为分子数。您的程序必须使用这些形式实现上述的 $S(x,\\Delta t;\\varepsilon)$，并按规定搜索最小整数阈值。\n\n测试套件。对于以下每个用例，计算所要求的阈值：\n- 用例1（生成-消亡，单物种）：反应 $\\varnothing \\xrightarrow{k_b} X$ 和 $X \\xrightarrow{k_d} \\varnothing$，其中 $k_b = 5$ s$^{-1}$，$k_d = 0.1$ s$^{-1}$，步长 $\\Delta t = 5$ s，容差 $\\varepsilon = 0.6$。输出最小整数期望 $X$ 计数（以分子数计）。\n- 用例2（可逆异构化，双物种）：反应 $X \\xrightarrow{k_1} Y$ 和 $Y \\xrightarrow{k_2} X$，其中 $k_1 = 0.05$ s$^{-1}$，$k_2 = 0.10$ s$^{-1}$，步长 $\\Delta t = 2$ s，容差 $\\varepsilon = 0.5$。总期望分子数 $N$ 在稳态时分配为 $x = \\frac{k_2}{k_1+k_2} N$ 和 $y = \\frac{k_1}{k_1+k_2} N$。输出最小整数 $N$（以分子数计）。\n- 用例3（纯消亡，单物种）：反应 $X \\xrightarrow{\\mu} \\varnothing$，其中 $\\mu = 1.0$ s$^{-1}$，步长 $\\Delta t = 0.1$ s，容差 $\\varepsilon = 0.25$。输出最小整数期望 $X$ 计数（以分子数计）。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述三个用例的顺序排列，例如，“[result1,result2,result3]”。每个结果必须是分子数的整数，如果未找到 $10^6$ 以下的阈值，则为 $-1$。\n\n重要说明：\n- 本问题中的所有数学量均使用上述表示法。时间必须以秒为单位处理。分子计数是无量纲的拷贝数。最终输出必须是分子数的整数。\n- 您不得依赖任何未从CME和CLE定义以及所述的质量作用和李普希兹结构推导出的公式。代码必须完全自包含，并按规定产生确切的输出行，不得有任何附加文本。", "solution": "该问题已经过验证，并被确定是合理的。它在科学上基于随机化学动力学的既定原理，特别是离散化学主方程（CME）与其连续化学朗之万方程（CLE）近似之间的关系。该问题提法明确，提供了清晰的目标、所有必要的数学定义（$S, \\gamma_j, \\tau_j$）、三个测试用例的明确参数值以及所需阈值的确定搜索过程。语言客观，设置完整且内部一致。因此，可以推导出解决方案。\n\n任务是根据一个给定的有效性准则 $S(x, \\Delta t; \\varepsilon) \\le 1$，计算一个最小整数分子数阈值（$x_{\\mathrm{crit}}$ 或 $N_{\\mathrm{crit}}$），在该阈值下，化学朗之万方程（CLE）成为化学主方程（CME）的一个可接受的近似。系统状态由期望分子数 $x$ 给出，模拟步长为 $\\Delta t$，$\\varepsilon$ 是用户定义的容差。该准则必须对所有反应通道 $j=1, \\dots, R$ 都满足。条件 $S(x, \\Delta t; \\varepsilon) \\le 1$ 等价于要求对所有 $j$ 都有 $\\gamma_j(x, \\Delta t) \\le \\varepsilon$ 和 $\\tau_j(x, \\Delta t) \\le \\varepsilon$。\n\n该过程包括：\n1.  对于每个测试用例，具体化倾向函数 $a_j(x)$、其导数 $\\frac{\\partial a_j}{\\partial x_i}$ 和化学计量向量 $\\nu_j$ 的通用公式。\n2.  为每个反应通道推导高斯性参数 $\\gamma_j$ 和李普希兹跳跃参数 $\\tau_j$ 的具体形式。\n3.  将这些组合成基于条件 $S \\le 1$ 的一组不等式。\n4.  解这些不等式，以找到同时满足所有不等式的最小整数计数（$x$ 或 $N$）。该整数的搜索范围是从 $1$ 到最大 $10^6$。\n\n让我们逐个分析每个用例。\n\n### 用例1：生成–消亡过程\n系统有一个物种 $X$ 和两个反应：\n1.  生成：$\\varnothing \\xrightarrow{k_b} X$。倾向函数 $a_1(x) = k_b$。化学计量 $\\nu_1 = +1$。\n2.  消亡：$X \\xrightarrow{k_d} \\varnothing$。倾向函数 $a_2(x) = k_d x$。化学计量 $\\nu_2 = -1$。\n\n参数为 $k_b = 5 \\text{ s}^{-1}$，$k_d = 0.1 \\text{ s}^{-1}$，$\\Delta t = 5 \\text{ s}$，以及 $\\varepsilon = 0.6$。状态是物种 $X$ 的期望计数 $x$。\n\n对于反应 $j=1$（生成，零级反应）：\n倾向函数是常数：$a_1(x) = k_b = 5$。\n导数为 $\\frac{\\partial a_1}{\\partial x} = 0$。\n高斯性参数为 $\\gamma_1(x, \\Delta t) = \\frac{1}{\\sqrt{a_1(x)\\Delta t}} = \\frac{1}{\\sqrt{5 \\cdot 5}} = \\frac{1}{5} = 0.2$。\n李普希茲跳跃参数为 $\\tau_1(x, \\Delta t) = 0$，因为 $\\frac{\\partial a_1}{\\partial x} = 0$。\n\n对于反应 $j=2$（消亡，单分子反应）：\n倾向函数是 $a_2(x) = k_d x = 0.1 x$。\n导数为 $\\frac{\\partial a_2}{\\partial x} = k_d = 0.1$。\n高斯性参数为 $\\gamma_2(x, \\Delta t) = \\frac{1}{\\sqrt{a_2(x)\\Delta t}} = \\frac{1}{\\sqrt{0.1x \\cdot 5}} = \\frac{1}{\\sqrt{0.5x}}$。\n影响物种 $X$ 的总期望活性为 $\\sum_{k=1}^2 |\\nu_{1k}| a_k(x) = |\\nu_1|a_1 + |\\nu_2|a_2 = |+1|k_b + |-1|k_d x = 5 + 0.1x$。\n李普希茲跳跃参数为 $\\tau_2(x, \\Delta t) = \\Delta t \\frac{|\\frac{\\partial a_2}{\\partial x}|(5 + 0.1x)}{a_2(x)} = 5 \\frac{0.1(5 + 0.1x)}{0.1x} = \\frac{5(5 + 0.1x)}{x} = \\frac{25}{x} + 0.5$。\n\n现在我们应用条件 $\\gamma_j \\le \\varepsilon$ 和 $\\tau_j \\le \\varepsilon$，其中 $\\varepsilon=0.6$：\n1.  $\\gamma_1 \\le 0.6 \\implies 0.2 \\le 0.6$。这总是成立的。\n2.  $\\tau_1 \\le 0.6 \\implies 0 \\le 0.6$。这总是成立的。\n3.  $\\gamma_2 \\le 0.6 \\implies \\frac{1}{\\sqrt{0.5x}} \\le 0.6 \\implies \\sqrt{0.5x} \\ge \\frac{1}{0.6} \\implies 0.5x \\ge (\\frac{1}{0.6})^2 \\implies x \\ge \\frac{1}{0.5 \\cdot 0.36} = \\frac{1}{0.18} \\approx 5.55...$。\n4.  $\\tau_2 \\le 0.6 \\implies \\frac{25}{x} + 0.5 \\le 0.6 \\implies \\frac{25}{x} \\le 0.1 \\implies x \\ge \\frac{25}{0.1} = 250$。\n\n为了满足所有条件，$x$ 必须大于等于 $5.55...$ 和 $250$。最严格的条件是 $x \\ge 250$。$x$ 的最小整数值为 $x_{\\mathrm{crit}} = 250$。\n\n### 用例2：可逆异构化\n系统有两个物种 $X$ 和 $Y$，以及两个反应：\n1.  $X \\xrightarrow{k_1} Y$。倾向函数 $a_1(x,y) = k_1 x$。化学计量 $\\nu_1 = (-1, +1)^T$。\n2.  $Y \\xrightarrow{k_2} X$。倾向函数 $a_2(x,y) = k_2 y$。化学计量 $\\nu_2 = (+1, -1)^T$。\n\n参数为 $k_1 = 0.05 \\text{ s}^{-1}$，$k_2 = 0.10 \\text{ s}^{-1}$，$\\Delta t = 2 \\text{ s}$，以及 $\\varepsilon = 0.5$。状态 $(x,y)$ 由稳态时的总分子数 $N$ 决定：$x = \\frac{k_2}{k_1+k_2} N = \\frac{0.10}{0.15} N = \\frac{2}{3}N$ 和 $y = \\frac{k_1}{k_1+k_2} N = \\frac{0.05}{0.15} N = \\frac{1}{3}N$。倾向函数变为 $a_1(N) = k_1 x = 0.05 \\cdot \\frac{2}{3}N = \\frac{0.1}{3}N$ 和 $a_2(N) = k_2 y = 0.10 \\cdot \\frac{1}{3}N = \\frac{0.1}{3}N$。注意在稳态时 $a_1=a_2$。\n\n对于反应 $j=1$ ($X \\to Y$)：\n$\\gamma_1(N, \\Delta t) = \\frac{1}{\\sqrt{a_1(N)\\Delta t}} = \\frac{1}{\\sqrt{\\frac{0.1}{3}N \\cdot 2}} = \\frac{1}{\\sqrt{\\frac{0.2}{3}N}}$。\n$a_1$ 的偏导数为 $\\frac{\\partial a_1}{\\partial x} = k_1 = 0.05$ 和 $\\frac{\\partial a_1}{\\partial y} = 0$。\n总活性和为：\n$\\sum_{k} |\\nu_{X,k}|a_k = |-1|a_1 + |+1|a_2 = a_1+a_2 = 2 \\frac{0.1}{3}N = \\frac{0.2}{3}N$。\n$\\sum_{k} |\\nu_{Y,k}|a_k = |+1|a_1 + |-1|a_2 = a_1+a_2 = \\frac{0.2}{3}N$。\n$\\tau_1(N, \\Delta t) = \\frac{\\Delta t}{a_1(N)} \\left( \\left|\\frac{\\partial a_1}{\\partial x}\\right|\\sum_{k}|\\nu_{X,k}|a_k + \\left|\\frac{\\partial a_1}{\\partial y}\\right|\\sum_{k}|\\nu_{Y,k}|a_k \\right) = \\frac{2}{\\frac{0.1}{3}N} \\left( 0.05 \\cdot \\frac{0.2}{3}N + 0 \\right) = \\frac{2 \\cdot 0.05 \\cdot 0.2/3}{0.1/3} = 2 \\cdot 0.05 \\cdot 2 = 0.2$。\n\n对于反应 $j=2$ ($Y \\to X$)：\n由于 $a_1=a_2$，$\\gamma_2(N, \\Delta t) = \\gamma_1(N, \\Delta t) = \\frac{1}{\\sqrt{\\frac{0.2}{3}N}}$。\n$a_2$ 的偏导数为 $\\frac{\\partial a_2}{\\partial x} = 0$ 和 $\\frac{\\partial a_2}{\\partial y} = k_2 = 0.10$。\n$\\tau_2(N, \\Delta t) = \\frac{\\Delta t}{a_2(N)} \\left( \\left|\\frac{\\partial a_2}{\\partial x}\\right|\\sum_{k}|\\nu_{X,k}|a_k + \\left|\\frac{\\partial a_2}{\\partial y}\\right|\\sum_{k}|\\nu_{Y,k}|a_k \\right) = \\frac{2}{\\frac{0.1}{3}N} \\left( 0 + 0.10 \\cdot \\frac{0.2}{3}N \\right) = \\frac{2 \\cdot 0.10 \\cdot 0.2/3}{0.1/3} = 2 \\cdot 0.10 \\cdot 2 = 0.4$。\n\n现在我们应用条件，其中 $\\varepsilon=0.5$：\n1.  $\\gamma_1 = \\gamma_2 \\le 0.5 \\implies \\frac{1}{\\sqrt{\\frac{0.2}{3}N}} \\le 0.5 \\implies \\sqrt{\\frac{0.2}{3}N} \\ge 2 \\implies \\frac{0.2}{3}N \\ge 4 \\implies N \\ge \\frac{12}{0.2} = 60$。\n2.  $\\tau_1 \\le 0.5 \\implies 0.2 \\le 0.5$。这总是成立的。\n3.  $\\tau_2 \\le 0.5 \\implies 0.4 \\le 0.5$。这总是成立的。\n\n最严格的条件是 $N \\ge 60$。最小整数值为 $N_{\\mathrm{crit}} = 60$。\n\n### 用例3：纯消亡过程\n系统有一个物种 $X$ 和一个反应：$X \\xrightarrow{\\mu} \\varnothing$。\n倾向函数 $a_1(x) = \\mu x$。化学计量 $\\nu_1 = -1$。\n参数为 $\\mu = 1.0 \\text{ s}^{-1}$，$\\Delta t = 0.1 \\text{ s}$，以及 $\\varepsilon = 0.25$。\n\n对于反应 $j=1$：\n$a_1(x) = \\mu x = 1.0x = x$。\n$\\gamma_1(x, \\Delta t) = \\frac{1}{\\sqrt{a_1(x)\\Delta t}} = \\frac{1}{\\sqrt{x \\cdot 0.1}}$。\n$\\frac{\\partial a_1}{\\partial x} = \\mu = 1.0$。\n总活性和：$\\sum_k |\\nu_{1k}|a_k = |\\nu_1|a_1 = |-1|x = x$。\n$\\tau_1(x, \\Delta t) = \\Delta t \\frac{|\\frac{\\partial a_1}{\\partial x}| \\cdot x}{a_1(x)} = 0.1 \\frac{|1.0| \\cdot x}{x} = 0.1$。\n\n现在应用条件，其中 $\\varepsilon=0.25$：\n1.  $\\gamma_1 \\le 0.25 \\implies \\frac{1}{\\sqrt{0.1x}} \\le 0.25 \\implies \\sqrt{0.1x} \\ge 4 \\implies 0.1x \\ge 16 \\implies x \\ge 160$。\n2.  $\\tau_1 \\le 0.25 \\implies 0.1 \\le 0.25$。这总是成立的。\n\n最严格的条件是 $x \\ge 160$。最小整数值为 $x_{\\mathrm{crit}} = 160$。\n\n总而言之，最小整数阈值为：\n- 用例1: $x_{\\mathrm{crit}} = 250$\n- 用例2: $N_{\\mathrm{crit}} = 60$\n- 用例3: $x_{\\mathrm{crit}} = 160$\n\n以下程序通过数值搜索来验证这些推导出的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimal expected molecule count threshold for three test cases\n    based on a validity criterion for the Chemical Langevin Equation.\n    \"\"\"\n\n    test_cases = [\n        {'type': 'birth_death', 'params': {'kb': 5.0, 'kd': 0.1, 'dt': 5.0, 'eps': 0.6}},\n        {'type': 'isomerization', 'params': {'k1': 0.05, 'k2': 0.10, 'dt': 2.0, 'eps': 0.5}},\n        {'type': 'pure_death', 'params': {'mu': 1.0, 'dt': 0.1, 'eps': 0.25}}\n    ]\n\n    results = []\n    max_count = 1000000\n\n    # --- Case 1: Birth-Death ---\n    case1 = test_cases[0]['params']\n    kb, kd, dt, eps = case1['kb'], case1['kd'], case1['dt'], case1['eps']\n    result1 = -1\n    for x_int in range(1, max_count + 1):\n        x = float(x_int)\n        \n        # Propensities\n        a1 = kb\n        a2 = kd * x\n        \n        # Check for non-positive propensities\n        if a1 = 0 or a2 = 0: continue\n\n        # Gaussianity parameters\n        gamma1 = 1.0 / np.sqrt(a1 * dt)\n        gamma2 = 1.0 / np.sqrt(a2 * dt)\n        \n        # Lipschitz leap parameters\n        # For reaction 1 (zeroth-order), grad(a1)=0, so tau1=0\n        tau1 = 0.0\n        \n        # For reaction 2 (unimolecular)\n        grad_a2_x = kd\n        # Sum of activities on species X: |nu_1|*a1 + |nu_2|*a2 = 1*a1 + 1*a2\n        sum_act_x = a1 + a2\n        tau2 = dt * (np.abs(grad_a2_x) * sum_act_x) / a2\n        \n        # Combined validity index S\n        S = np.max([gamma1 / eps, tau1 / eps, gamma2 / eps, tau2 / eps])\n        \n        if S = 1.0:\n            result1 = x_int\n            break\n    results.append(result1)\n\n    # --- Case 2: Reversible Isomerization ---\n    case2 = test_cases[1]['params']\n    k1, k2, dt, eps = case2['k1'], case2['k2'], case2['dt'], case2['eps']\n    result2 = -1\n    for N_int in range(1, max_count + 1):\n        N = float(N_int)\n        \n        # State variables at stationarity\n        x_val = (k2 / (k1 + k2)) * N\n        y_val = (k1 / (k1 + k2)) * N\n        \n        # Propensities\n        a1 = k1 * x_val\n        a2 = k2 * y_val\n\n        if a1 = 0 or a2 = 0: continue\n\n        # Gaussianity parameters\n        gamma1 = 1.0 / np.sqrt(a1 * dt)\n        gamma2 = 1.0 / np.sqrt(a2 * dt)\n        \n        # Lipschitz leap parameters\n        grad_a1_x = k1\n        grad_a2_y = k2\n        \n        # Sum of activities on species X and Y\n        # nu_X = [-1, 1], nu_Y = [1, -1]\n        sum_act_X = np.abs(-1)*a1 + np.abs(1)*a2\n        sum_act_Y = np.abs(1)*a1 + np.abs(-1)*a2\n        \n        # For tau1 (depends on grad a1 w.r.t x and y)\n        tau1 = dt * (np.abs(grad_a1_x) * sum_act_X) / a1\n        \n        # For tau2 (depends on grad a2 w.r.t x and y)\n        tau2 = dt * (np.abs(grad_a2_y) * sum_act_Y) / a2\n\n        S = np.max([gamma1 / eps, tau1 / eps, gamma2 / eps, tau2 / eps])\n        \n        if S = 1.0:\n            result2 = N_int\n            break\n    results.append(result2)\n    \n    # --- Case 3: Pure Death ---\n    case3 = test_cases[2]['params']\n    mu, dt, eps = case3['mu'], case3['dt'], case3['eps']\n    result3 = -1\n    for x_int in range(1, max_count + 1):\n        x = float(x_int)\n        \n        # Propensity\n        a1 = mu * x\n        \n        if a1 = 0: continue\n\n        # Gaussianity parameter\n        gamma1 = 1.0 / np.sqrt(a1 * dt)\n        \n        # Lipschitz leap parameter\n        grad_a1_x = mu\n        # Sum of activities: |nu_1|*a1\n        sum_act_x = np.abs(-1) * a1\n        tau1 = dt * (np.abs(grad_a1_x) * sum_act_x) / a1\n        \n        S = np.max([gamma1 / eps, tau1 / eps])\n        \n        if S = 1.0:\n            result3 = x_int\n            break\n    results.append(result3)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3351587"}]}