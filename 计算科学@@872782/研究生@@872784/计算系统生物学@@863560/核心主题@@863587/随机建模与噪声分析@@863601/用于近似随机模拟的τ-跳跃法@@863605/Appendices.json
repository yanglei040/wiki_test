{"hands_on_practices": [{"introduction": "要掌握 tau-leaping 方法，我们首先必须理解其最基本的步骤。tau-leaping 的核心思想是用泊松随机变量来近似一小段时间内反应发生的次数。本练习 [@problem_id:3354348] 将通过一个简单的生灭过程，指导你推导 tau-leaping 更新后的系统状态的期望和方差，从而深入理解该近似方法的统计特性及其如何反映随机动态。", "problem": "在计算系统生物学中，考虑一个单物种生灭反应系统，该系统包含$2$个反应，化学计量向量为$S=\\begin{pmatrix}1\\\\-1\\end{pmatrix}$。状态$X(t)$表示在时间$t$的离散分子数量。反应$1$使分子数增加$1$，其倾向函数为$a_{1}(x)=\\alpha$，其中$\\alpha0$是一个恒定的生产速率。反应$2$使分子数减少$1$，其倾向函数为$a_{2}(x)=\\beta x$，其中$\\beta0$是一个一阶降解速率常数，而$x \\in \\mathbb{Z}_{\\ge 0}$是当前的分子数量。\n\n假设一个长度为$\\tau0$的固定跳跃间隔，并且跳跃条件在$[t,t+\\tau]$区间内成立，因此倾向函数在跳跃期间有效保持在$X(t)=x$时的值不变。使用基于化学主方程（CME）的tau-跳跃近似法，其中在短时间内具有恒定倾向的反应发生次数被近似为独立的泊松随机变量，其参数等于倾向函数乘以该时间间隔的长度。请执行以下操作：\n\n- 推导$X(t+\\tau)$的显式tau-跳跃更新式，用$X(t)$和在$[t,t+\\tau]$区间内的随机反应次数表示，并确定这些随机次数的分布及其参数。\n- 计算条件期望$\\mathbb{E}[X(t+\\tau)\\mid X(t)=x]$和条件方差$\\mathrm{Var}[X(t+\\tau)\\mid X(t)=x]$。\n\n请将你的最终答案表示为闭式解析表达式。无需四舍五入，也无需单位。", "solution": "该问题要求推导单物种生灭过程的tau-跳跃更新方程、条件期望和条件方差。我们将首先根据tau-跳跃近似的原理建立更新规则，然后计算所需的统计矩。\n\n该系统涉及一个化学物种，其数量由状态变量$X(t)$表示。共有$M=2$个反应。\n反应1：生成，化学计量变化为$\\nu_1 = +1$，倾向函数为$a_1(x) = \\alpha$，其中$\\alpha > 0$为常数。\n反应2：消亡，化学计量变化为$\\nu_2 = -1$，倾向函数为$a_2(x) = \\beta x$，其中$\\beta > 0$为速率常数，$x$为当前分子数量。\n\n一般的tau-跳跃更新规则将状态向量在小时间间隔$\\tau$内的变化近似为：\n$$X(t+\\tau) = X(t) + \\sum_{j=1}^{M} \\nu_j K_j$$\n其中，$K_j$是反应$j$在时间间隔$[t, t+\\tau]$内发生的次数，$\\nu_j$是与反应$j$相关的化学计量变化。如问题所述，tau-跳跃的核心假设是，对于足够小的$\\tau$（跳跃条件），每个反应$j$的发生次数$K_j$可以近似为一个独立的泊松随机变量：\n$$K_j \\sim \\text{Poisson}(\\lambda_j = a_j(X(t)) \\cdot \\tau)$$\n\n首先，我们将为给定系统建立显式的tau-跳跃更新式。\n设$X(t)=x$。状态是一个标量计数。化学计量变化为$\\nu_1=1$和$\\nu_2=-1$。状态更新方程为：\n$$X(t+\\tau) = x + \\nu_1 K_1 + \\nu_2 K_2 = x + (1)K_1 + (-1)K_2 = x + K_1 - K_2$$\n这里，$K_1$和$K_2$是独立的随机变量，分别表示在时间间隔$[t, t+\\tau]$内生成和消亡事件的次数。\n\n根据tau-跳跃近似，这些随机计数的分布是泊松分布。这些泊松分布的参数（速率）由在时间间隔开始时评估的倾向函数$X(t)=x$乘以跳跃时长$\\tau$来确定。\n\n对于反应1（生成），倾向为$a_1(x) = \\alpha$。相应泊松分布的参数为$\\lambda_1 = a_1(x)\\tau = \\alpha\\tau$。因此，生成事件的次数是一个随机变量$K_1 \\sim \\text{Poisson}(\\alpha\\tau)$。\n\n对于反应2（消亡），倾向为$a_2(x) = \\beta x$。其泊松分布的参数为$\\lambda_2 = a_2(x)\\tau = \\beta x \\tau$。因此，消亡事件的次数是一个随机变量$K_2 \\sim \\text{Poisson}(\\beta x \\tau)$。\n\n因此，$X(t+\\tau)$的显式tau-跳跃更新由表达式$X(t+\\tau) = x + K_1 - K_2$给出，其中$K_1$和$K_2$是独立的随机变量，其分布为$K_1 \\sim \\text{Poisson}(\\alpha\\tau)$和$K_2 \\sim \\text{Poisson}(\\beta x \\tau)$。\n\n接下来，我们计算在给定时间$t$的状态下，时间$t+\\tau$时的状态的条件期望。\n$$\\mathbb{E}[X(t+\\tau) \\mid X(t)=x]$$\n使用我们推导的更新方程：\n$$\\mathbb{E}[X(t+\\tau) \\mid X(t)=x] = \\mathbb{E}[x + K_1 - K_2]$$\n根据期望算子的线性性质，这变为：\n$$\\mathbb{E}[x + K_1 - K_2] = \\mathbb{E}[x] + \\mathbb{E}[K_1] - \\mathbb{E}[K_2]$$\n由于$x$是一个给定值（条件），它对于期望而言是一个常数，所以$\\mathbb{E}[x]=x$。\n参数为$\\lambda$的泊松随机变量的期望等于$\\lambda$。因此：\n$$\\mathbb{E}[K_1] = \\alpha\\tau$$\n$$\\mathbb{E}[K_2] = \\beta x \\tau$$\n将这些代入条件期望的表达式中，得到：\n$$\\mathbb{E}[X(t+\\tau) \\mid X(t)=x] = x + \\alpha\\tau - \\beta x \\tau = x(1 - \\beta\\tau) + \\alpha\\tau$$\n\n最后，我们计算在给定时间$t$的状态下，时间$t+\\tau$时的状态的条件方差。\n$$\\mathrm{Var}[X(t+\\tau) \\mid X(t)=x]$$\n使用相同的更新方程：\n$$\\mathrm{Var}[X(t+\\tau) \\mid X(t)=x] = \\mathrm{Var}[x + K_1 - K_2]$$\n方差对于常数位移是不变的，所以加上$x$不会改变方差：\n$$\\mathrm{Var}[x + K_1 - K_2] = \\mathrm{Var}[K_1 - K_2]$$\n方差的一个关键性质是，对于任意两个独立的随机变量$Y_1$和$Y_2$，$\\mathrm{Var}[Y_1 - Y_2] = \\mathrm{Var}[Y_1] + \\mathrm{Var}[Y_2]$。由于在tau-跳跃框架中规定$K_1$和$K_2$是独立的：\n$$\\mathrm{Var}[K_1 - K_2] = \\mathrm{Var}[K_1] + \\mathrm{Var}[K_2]$$\n参数为$\\lambda$的泊松随机变量的方差也等于$\\lambda$。因此：\n$$\\mathrm{Var}[K_1] = \\alpha\\tau$$\n$$\\mathrm{Var}[K_2] = \\beta x \\tau$$\n将这些代入条件方差的表达式中，得到：\n$$\\mathrm{Var}[X(t+\\tau) \\mid X(t)=x] = \\alpha\\tau + \\beta x \\tau = (\\alpha + \\beta x)\\tau$$\n\n推导出的条件期望和条件方差的表达式，在tau-跳跃近似下，提供了物种数量在跳跃间隔$\\tau$内变化的均值和方差。这些矩对于分析随机模拟算法的行为至关重要。", "answer": "$$\\boxed{\\begin{pmatrix} x(1 - \\beta\\tau) + \\alpha\\tau \\\\ (\\alpha + \\beta x)\\tau \\end{pmatrix}}$$", "id": "3354348"}, {"introduction": "tau-leaping 的计算效率源于其比精确随机模拟算法（SSA）更大的时间步长，但步长 $\\tau$ 应该取多大呢？此练习 [@problem_id:3354368] 将解决步长选择这一关键的实际问题。我们将应用一个标准准则，即限制反应倾向函数在步长内的相对变化，以确保该方法的核心假设得以满足。", "problem": "考虑一个在化学主方程（CME）下建模的充分混合的生物化学反应系统。该系统包含三种物质，其分子数状态向量为 $x = (x_{1}, x_{2}, x_{3})^{\\top}$，以及三个反应，其化学计量变化向量由化学计量矩阵 $S \\in \\mathbb{R}^{3 \\times 3}$ 的列给出：\n$$\nS \\;=\\; \\begin{pmatrix}\n-1   0   -1 \\\\\n\\phantom{-}1   -1   \\phantom{-}1 \\\\\n\\phantom{-}0   \\phantom{-}1   -1\n\\end{pmatrix}.\n$$\n倾向函数 $a_{j}(x)$，$j \\in \\{1,2,3\\}$，遵循质量作用动力学：\n$$\na_{1}(x) \\;=\\; c_{1}\\, x_{1}, \\qquad\na_{2}(x) \\;=\\; c_{2}\\, x_{2}, \\qquad\na_{3}(x) \\;=\\; c_{3}\\, x_{1}\\, x_{3},\n$$\n速率参数为 $c_{1} = 0.1$, $c_{2} = 0.05$, $c_{3} = 0.002$。考虑当前状态 $x = (50, 30, 20)^{\\top}$。在 $\\tau$-跳跃方法中，我们需要寻找一个跳跃步长 $\\tau$，使得在基于漂移 $S a(x)$ 的一阶近似下，每个倾向函数 $a_{j}(x)$ 在跳跃过程中的相对变化保持在预设的容差 $\\epsilon$ 之内。\n\n使用一个对所有倾向函数同时施加相对变化约束的最大范数准则，确定在给定的 $S$、$a(x)$ 和状态 $x$ 以及容差 $\\epsilon = 0.05$ 的条件下，满足该约束的最大 $\\tau$。将您计算出的 $\\tau$ 的最终数值答案以秒为单位表示，并四舍五入到四位有效数字。\n\n然后，分析计算出的 $\\tau$ 如何依赖于容差参数 $\\epsilon$以及用于界定一阶变化的范数选择。特别是，将逐元素的绝对值界与由 $L_{1}$/$L_{\\infty}$ 配对和 $L_{2}$ 范数导出的界进行比较，并定性解释在此情境下哪些选择更为保守或不那么保守。您的分析应从 CME 和 $\\tau$-跳跃近似的第一性原理进行逻辑推导，不应假设任何未从这些基础中得到证明的特定公式。最终答案必须是按上述要求计算出的 $\\tau$ 的单一数值。", "solution": "该问题要求计算一个满足特定误差控制条件的 $\\tau$-跳跃步长。该条件限制了每个倾向函数 $a_j(x)$ 的相对变化。\n\n**1. 建立约束公式**\n\n$\\tau$-跳跃的核心假设是倾向函数在时间步 $\\tau$ 内近似恒定。为保证此假设，我们限制其变化。倾向函数 $a_j$ 的变化 $da_j$ 可通过一阶泰勒展开近似为：\n$$ da_j \\approx \\nabla a_j(x) \\cdot dx $$\n其中 $dx$ 是状态向量的变化。问题要求使用基于漂移的一阶近似，即用状态变化的期望值（漂移）来近似 $dx$：\n$$ dx \\approx \\mathbb{E}[\\Delta x] = (S a(x)) \\tau = \\mu \\tau $$\n其中 $\\mu = S a(x)$ 是漂移向量。将此代入，得到倾向函数变化的近似：\n$$ da_j \\approx (\\nabla a_j(x))^{\\top} (S a(x)) \\tau $$\n约束条件是每个倾向函数的相对变化不超过容差 $\\epsilon$：\n$$ \\frac{|da_j|}{a_j(x)} \\le \\epsilon \\quad \\implies \\quad \\frac{|(\\nabla a_j(x))^{\\top} (S a(x)) \\tau|}{a_j(x)} \\le \\epsilon $$\n解出 $\\tau$，我们得到对每个倾向函数的约束：\n$$ \\tau \\le \\frac{\\epsilon \\cdot a_j(x)}{|(\\nabla a_j(x))^{\\top} (S a(x))|} $$\n为了同时满足所有 $j$ 的约束，我们必须取所有上界中的最小值。因此，最大允许步长为：\n$$ \\tau = \\min_{j} \\left\\{ \\frac{\\epsilon \\cdot a_j(x)}{|(\\nabla a_j(x))^{\\top} (S a(x))|} \\right\\} $$\n\n**2. 计算各分量**\n\n给定：$x = (50, 30, 20)^{\\top}$，$\\epsilon = 0.05$，以及速率常数 $c_1 = 0.1, c_2 = 0.05, c_3 = 0.002$。\n\n*   **计算倾向函数向量 $a(x)$：**\n    $a_1(x) = 0.1 \\times 50 = 5$\n    $a_2(x) = 0.05 \\times 30 = 1.5$\n    $a_3(x) = 0.002 \\times 50 \\times 20 = 2$\n    所以，$a(x) = (5, 1.5, 2)^{\\top}$。\n\n*   **计算漂移向量 $\\mu = S a(x)$：**\n    $$ \\mu = \\begin{pmatrix} -1  0  -1 \\\\ 1  -1  1 \\\\ 0  1  -1 \\end{pmatrix} \\begin{pmatrix} 5 \\\\ 1.5 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} (-1)(5) + (0)(1.5) + (-1)(2) \\\\ (1)(5) + (-1)(1.5) + (1)(2) \\\\ (0)(5) + (1)(1.5) + (-1)(2) \\end{pmatrix} = \\begin{pmatrix} -7 \\\\ 5.5 \\\\ -0.5 \\end{pmatrix} $$\n\n*   **计算倾向函数的梯度 $\\nabla a_j(x)$：**\n    $\\nabla a_1(x) = (c_1, 0, 0) = (0.1, 0, 0)$\n    $\\nabla a_2(x) = (0, c_2, 0) = (0, 0.05, 0)$\n    $\\nabla a_3(x) = (c_3 x_3, 0, c_3 x_1) = (0.002 \\times 20, 0, 0.002 \\times 50) = (0.04, 0, 0.1)$\n\n*   **计算点积 $(\\nabla a_j(x))^{\\top} \\mu$：**\n    对于 $j=1$: $(0.1, 0, 0) \\cdot (-7, 5.5, -0.5)^{\\top} = -0.7$\n    对于 $j=2$: $(0, 0.05, 0) \\cdot (-7, 5.5, -0.5)^{\\top} = 0.275$\n    对于 $j=3$: $(0.04, 0, 0.1) \\cdot (-7, 5.5, -0.5)^{\\top} = (0.04)(-7) + (0.1)(-0.5) = -0.28 - 0.05 = -0.33$\n\n**3. 计算 $\\tau$ 的上界并取最小值**\n\n*   对于 $j=1$：\n    $\\tau_1 = \\frac{0.05 \\times 5}{|-0.7|} = \\frac{0.25}{0.7} \\approx 0.35714$\n*   对于 $j=2$：\n    $\\tau_2 = \\frac{0.05 \\times 1.5}{|0.275|} = \\frac{0.075}{0.275} \\approx 0.27272$\n*   对于 $j=3$：\n    $\\tau_3 = \\frac{0.05 \\times 2}{|-0.33|} = \\frac{0.1}{0.33} \\approx 0.30303$\n\n最大允许的 $\\tau$ 是这些值的最小值：\n$$ \\tau = \\min(0.35714, 0.27272, 0.30303) \\approx 0.27272 $$\n四舍五入到四位有效数字，结果为 $0.2727$。\n\n**分析部分：**\n计算出的 $\\tau$ 与容差参数 $\\epsilon$ 成正比；容差越大，允许的步长越大。\n用于界定倾向变化 $(\\nabla a_j)^{\\top} (S a(x))$ 的方法决定了步长选择的保守性。\n1.  **漂移近似法（本题所用）**: 使用 $|(\\nabla a_j)^{\\top} (S a(x))|$ 作为分母。该方法允许不同反应对倾向函数变化的影响相互抵消（例如，一个反应使 $a_j$ 增加，另一个使其减少），因此可能不那么保守，导致步长较大。\n2.  **逐元素绝对值界**: 该方法使用 $\\sum_k |(\\nabla a_j)^{\\top} S_k| a_k$ 作为分母，其中 $S_k$ 是化学计量矩阵的第 $k$ 列。它将每个反应对倾向变化的绝对影响相加，由于三角不等式 $| \\sum z_k | \\le \\sum |z_k|$，此界总是大于或等于漂移近似法中的值。这防止了抵消效应，因此更为保守，通常导致更小、更安全的步长。\n3.  **$L_p$ 范数界**: 使用赫尔德不等式，如 $|v^{\\top} u| \\le \\|v\\|_1 \\|u\\|_{\\infty}$ 或柯西-施瓦茨不等式 $|v^{\\top} u| \\le \\|v\\|_2 \\|u\\|_2$ 来界定 $(\\nabla a_j)^{\\top} (S a(x))$。这些是通用的数学界，其紧密性（以及由此产生的步长的保守性）取决于向量的具体结构，可能不如专门推导的界（如方法2）那样紧密。", "answer": "$$\\boxed{0.2727}$$", "id": "3354368"}, {"introduction": "tau-leaping 的一个主要挑战是，泊松近似可能导致非物理的负分子数，尤其是在低丰度物种中。本练习 [@problem_id:3354376] 将演示一种稳健的解决方案：混合方法。我们将学习如何识别构成风险的“关键”反应并对其进行精确处理，同时对剩余的“非关键”反应应用 tau-leaping，从而在保证物理真实性的同时维持计算效率。", "problem": "考虑一个由化学主方程 (CME) 控制的充分混合的生化反应系统。系统状态是两种物种 $X_{1}$ 和 $X_{2}$ 的分子数向量 $\\mathbf{x} = (x_{1}, x_{2})$。该系统包含四个基元反应，其化学计量变化为 $\\nu_{ij}$，倾向函数为 $a_{j}(\\mathbf{x}) = c_{j} h_{j}(\\mathbf{x})$，其中 $c_{j}$ 是随机速率常数，$h_{j}(\\mathbf{x})$ 是不同反应物组合的数量：\n- 反应 $\\mathrm{R}_{1}$: $X_{1} \\to \\varnothing$，其中 $c_{1} = 0.9$ s$^{-1}$ 且 $h_{1}(\\mathbf{x}) = x_{1}$。\n- 反应 $\\mathrm{R}_{2}$: $\\varnothing \\to X_{1}$，其中 $c_{2} = 1.0$ s$^{-1}$ 且 $h_{2}(\\mathbf{x}) = 1$。\n- 反应 $\\mathrm{R}_{3}$: $X_{1} + X_{2} \\to X_{2}$，其中 $c_{3} = 0.001$ s$^{-1}$ 且 $h_{3}(\\mathbf{x}) = x_{1} x_{2}$。\n- 反应 $\\mathrm{R}_{4}$: $X_{2} \\to \\varnothing$，其中 $c_{4} = 0.05$ s$^{-1}$ 且 $h_{4}(\\mathbf{x}) = x_{2}$。\n\n化学计量系数如下：\n- 对于物种 $X_{1}$：$\\nu_{1,1} = -1$，$\\nu_{1,2} = +1$，$\\nu_{1,3} = -1$，$\\nu_{1,4} = 0$。\n- 对于物种 $X_{2}$：$\\nu_{2,1} = 0$，$\\nu_{2,2} = 0$，$\\nu_{2,3} = 0$，$\\nu_{2,4} = -1$。\n\n设当前状态为 $\\mathbf{x} = (3, 80)$。在显式 tau-跳跃近似中，选择一个跳跃时间 $\\tau$，使得反应倾向在 $[t, t + \\tau)$ 区间内保持近似恒定，并且各物种的净变化在均值和方差上都得到良好控制。\n\n从 CME 和倾向的定义出发，推导各物种的漂移 $\\mu_{i}(\\mathbf{x})$ 和扩散 $\\sigma_{i}^{2}(\\mathbf{x})$ 关于化学计量和倾向的表达式。施加标准的 tau-跳跃有界变化条件，以确保在跳跃期间各物种的期望相对变化和标准差缩放的相对变化不超过给定阈值 $\\epsilon$。使用这些条件，为全反应集计算一个候选 $\\tau$，其中阈值参数 $\\epsilon = 1.0$，安全因子 $\\eta = 0.8$。\n\n然后，抽取泊松随机反应计数 $P_{j} \\sim \\mathrm{Poisson}(a_{j}(\\mathbf{x}) \\tau)$ 来阐述步长的接受或拒绝。为进行演示，假设实现的计数值为 $P_{1} = 4$，$P_{2} = 1$，$P_{3} = 1$ 和 $P_{4} = 3$。判断该跳跃是否会产生负的物种数，从而必须被拒绝。\n\n在拒绝后，将反应重新分类为关键子集和非关键子集，规则如下：任何减少当前数量 $x_{i} \\leq n_{c}$ 的物种 $X_{i}$ 的反应均被视为关键反应，其中关键阈值设为 $n_{c} = 10$。仅使用非关键反应重新计算漂移和扩散，并使用相同的有界变化条件、相同的 $\\epsilon$ 和安全因子 $\\eta$ 来获得一个新的非关键 $\\tau_{\\mathrm{nc}}$。此外，通过对一个速率等于总关键倾向 $a^{c}(\\mathbf{x}) = \\sum_{j \\in \\mathcal{C}} a_{j}(\\mathbf{x})$ 的指数时钟进行采样，计算到下一个关键事件发生的时间。在本例中，假设抽取的均匀分布随机变量为 $r = 0.2$，因此 $\\tau_{c} = \\frac{1}{a^{c}(\\mathbf{x})} \\ln\\!\\left(\\frac{1}{r}\\right)$。最终接受的跳跃时间为 $\\tau_{\\mathrm{final}} = \\min\\{\\tau_{\\mathrm{nc}}, \\tau_{c}\\}$。\n\n计算给定状态和实现值下的 $\\tau_{\\mathrm{final}}$。以秒为单位表示最终结果，并将答案四舍五入至四位有效数字。最终答案必须是一个实数。", "solution": "该问题需要在近似随机模拟的框架内进行多步分析，特别是使用显式 tau-跳跃方法及其涉及关键反应的混合扩展。求解过程首先推导漂移和扩散的一般表达式，然后验证跳跃的拒绝，最后使用混合方法计算修正后的跳跃时间。\n\n### 漂移和扩散的推导\n状态向量 $\\mathbf{x}$ 的演化由化学主方程 (CME) 描述。在 tau-跳跃近似中，对于一个足够小的时间步长 $\\tau$，使得倾向函数 $a_j(\\mathbf{x})$ 近似恒定，每个反应 $\\mathrm{R}_j$ 发生的次数 $K_j$ 可以用泊松随机变量近似，即 $K_j \\sim \\mathrm{Poisson}(a_j(\\mathbf{x})\\tau)$。\n\n在时间间隔 $\\tau$ 内，物种 $X_i$ 的分子数变化由 $\\Delta x_i = \\sum_{j=1}^{M} \\nu_{ij} K_j$ 给出，其中 $M$ 是反应的总数。\n\n漂移 $\\mu_i(\\mathbf{x})$ 定义为物种 $X_i$ 的期望变化率。利用泊松变量 $\\mathrm{Poisson}(\\lambda)$ 的期望为 $\\lambda$ 的性质，我们有 $\\mathbb{E}[K_j] = a_j(\\mathbf{x})\\tau$。\n期望变化为：\n$$ \\mathbb{E}[\\Delta x_i] = \\mathbb{E}\\left[\\sum_{j=1}^{M} \\nu_{ij} K_j\\right] = \\sum_{j=1}^{M} \\nu_{ij} \\mathbb{E}[K_j] = \\sum_{j=1}^{M} \\nu_{ij} a_j(\\mathbf{x})\\tau $$\n漂移是单位时间内的期望变化：\n$$ \\mu_i(\\mathbf{x}) = \\frac{\\mathbb{E}[\\Delta x_i]}{\\tau} = \\sum_{j=1}^{M} \\nu_{ij} a_j(\\mathbf{x}) $$\n\n扩散 $\\sigma_i^2(\\mathbf{x})$ 是变化率的方差。利用泊松变量 $\\mathrm{Poisson}(\\lambda)$ 的方差也为 $\\lambda$ 的性质，我们有 $\\mathrm{Var}(K_j) = a_j(\\mathbf{x})\\tau$。假设各反应的发生是相互独立的，则变化的方差为：\n$$ \\mathrm{Var}(\\Delta x_i) = \\mathrm{Var}\\left[\\sum_{j=1}^{M} \\nu_{ij} K_j\\right] = \\sum_{j=1}^{M} \\nu_{ij}^2 \\mathrm{Var}(K_j) = \\sum_{j=1}^{M} \\nu_{ij}^2 a_j(\\mathbf{x})\\tau $$\n扩散是单位时间内的变化方差：\n$$ \\sigma_i^2(\\mathbf{x}) = \\frac{\\mathrm{Var}(\\Delta x_i)}{\\tau} = \\sum_{j=1}^{M} \\nu_{ij}^2 a_j(\\mathbf{x}) $$\n\n### 跳跃拒绝分析\n首先，我们计算当前状态 $\\mathbf{x} = (x_1, x_2) = (3, 80)$ 下的倾向函数：\n$a_1(\\mathbf{x}) = c_1 x_1 = 0.9 \\times 3 = 2.7$ s$^{-1}$\n$a_2(\\mathbf{x}) = c_2 \\times 1 = 1.0 \\times 1 = 1.0$ s$^{-1}$\n$a_3(\\mathbf{x}) = c_3 x_1 x_2 = 0.001 \\times 3 \\times 80 = 0.24$ s$^{-1}$\n$a_4(\\mathbf{x}) = c_4 x_2 = 0.05 \\times 80 = 4.0$ s$^{-1}$\n\n问题提供了一组假设的、已实现的泊松计数值：$P_1 = 4$，$P_2 = 1$，$P_3 = 1$ 和 $P_4 = 3$。我们计算物种数的变化量 $\\Delta x_i = \\sum_j \\nu_{ij} P_j$。\n\n对于物种 $X_1$：\n$$ \\Delta x_1 = \\nu_{1,1} P_1 + \\nu_{1,2} P_2 + \\nu_{1,3} P_3 + \\nu_{1,4} P_4 = (-1)(4) + (+1)(1) + (-1)(1) + (0)(3) = -4 + 1 - 1 = -4 $$\n对于物种 $X_2$：\n$$ \\Delta x_2 = \\nu_{2,1} P_1 + \\nu_{2,2} P_2 + \\nu_{2,3} P_3 + \\nu_{2,4} P_4 = (0)(4) + (0)(1) + (0)(1) + (-1)(3) = -3 $$\n\n新的状态将是 $\\mathbf{x}' = \\mathbf{x} + \\Delta\\mathbf{x} = (3 - 4, 80 - 3) = (-1, 77)$。\n由于物种 $X_1$ 的数量变为负数（$x'_1 = -1$），这在物理上是不可能的，因此这次跳跃必须被拒绝。\n\n### 混合方法：反应划分和 $\\tau$ 计算\n在拒绝后，算法切换到混合方法。反应被划分为关键和非关键两个集合。如果一个反应会减少某个物种 $X_i$ 的数量，而该物种当前数量 $x_i$ 小于或等于阈值 $n_c = 10$，则该反应是关键反应。\n\n在状态 $\\mathbf{x} = (3, 80)$ 时：\n- $x_1 = 3 \\le n_c$，因此减少 $X_1$ 的反应是关键反应。\n- $x_2 = 80 > n_c$。\n\n分析各反应：\n- $\\mathrm{R}_{1}$: $\\nu_{1,1} = -1$。减少 $X_1$。因此，$\\mathrm{R}_{1}$ 是关键反应。\n- $\\mathrm{R}_{2}$: $\\nu_{1,2} = +1$。不减少 $X_1$。非关键反应。\n- $\\mathrm{R}_{3}$: $\\nu_{1,3} = -1$。减少 $X_1$。因此，$\\mathrm{R}_{3}$ 是关键反应。\n- $\\mathrm{R}_{4}$: $\\nu_{2,4} = -1$。减少 $X_2$，但 $x_2 > n_c$。非关键反应。\n\n因此集合为：关键反应集 $\\mathcal{C} = \\{\\mathrm{R}_{1}, \\mathrm{R}_{3}\\}$ 和非关键反应集 $\\mathcal{NC} = \\{\\mathrm{R}_{2}, \\mathrm{R}_{4}\\}$。\n\n关键反应的总倾向是：\n$$ a^c(\\mathbf{x}) = a_1(\\mathbf{x}) + a_3(\\mathbf{x}) = 2.7 + 0.24 = 2.94 \\, \\mathrm{s}^{-1} $$\n下一个关键反应发生的时间 $\\tau_c$ 是从一个速率为 $a^c(\\mathbf{x})$ 的指数分布中采样的。使用给定的均匀分布随机变量 $r = 0.2$：\n$$ \\tau_c = \\frac{1}{a^c(\\mathbf{x})} \\ln\\left(\\frac{1}{r}\\right) = \\frac{1}{2.94} \\ln\\left(\\frac{1}{0.2}\\right) = \\frac{\\ln(5)}{2.94} \\approx 0.547428 \\, \\mathrm{s} $$\n\n接下来，我们使用有界变化条件为非关键反应计算一个跳跃时间 $\\tau_{\\mathrm{nc}}$。我们首先需要仅由非关键反应 $\\mathrm{R}_{2}$ 和 $\\mathrm{R}_{4}$ 产生的漂移和扩散。\n对于 $X_1$：\n$$ \\mu_1^{\\mathrm{nc}}(\\mathbf{x}) = \\nu_{1,2}a_2(\\mathbf{x}) + \\nu_{1,4}a_4(\\mathbf{x}) = (+1)(1.0) + (0)(4.0) = 1.0 $$\n$$ (\\sigma_1^{\\mathrm{nc}})^2(\\mathbf{x}) = \\nu_{1,2}^2 a_2(\\mathbf{x}) + \\nu_{1,4}^2 a_4(\\mathbf{x}) = (+1)^2(1.0) + (0)^2(4.0) = 1.0 $$\n对于 $X_2$：\n$$ \\mu_2^{\\mathrm{nc}}(\\mathbf{x}) = \\nu_{2,2}a_2(\\mathbf{x}) + \\nu_{2,4}a_4(\\mathbf{x}) = (0)(1.0) + (-1)(4.0) = -4.0 $$\n$$ (\\sigma_2^{\\mathrm{nc}})^2(\\mathbf{x}) = \\nu_{2,2}^2 a_2(\\mathbf{x}) + \\nu_{2,4}^2 a_4(\\mathbf{x}) = (0)^2(1.0) + (-1)^2(4.0) = 4.0 $$\n\n每个物种的候选 $\\tau$ 由以下公式确定：\n$$ \\tau_i^{\\mathrm{raw}} = \\min\\left(\\frac{\\epsilon x_i}{|\\mu_i^{\\mathrm{nc}}(\\mathbf{x})|}, \\frac{(\\epsilon x_i)^2}{(\\sigma_i^{\\mathrm{nc}})^2(\\mathbf{x})}\\right) $$\n给定 $\\epsilon = 1.0$。\n对于 $X_1$ ($x_1=3$)：\n$$ \\tau_1^{\\mathrm{raw}} = \\min\\left(\\frac{1.0 \\times 3}{|1.0|}, \\frac{(1.0 \\times 3)^2}{1.0}\\right) = \\min(3, 9) = 3 \\, \\mathrm{s} $$\n对于 $X_2$ ($x_2=80$)：\n$$ \\tau_2^{\\mathrm{raw}} = \\min\\left(\\frac{1.0 \\times 80}{|-4.0|}, \\frac{(1.0 \\times 80)^2}{4.0}\\right) = \\min\\left(\\frac{80}{4}, \\frac{6400}{4}\\right) = \\min(20, 1600) = 20 \\, \\mathrm{s} $$\n总体非关键时间步长是这些值的最小值，并应用安全因子 $\\eta = 0.8$：\n$$ \\tau_{\\mathrm{nc}} = \\eta \\times \\min(\\tau_1^{\\mathrm{raw}}, \\tau_2^{\\mathrm{raw}}) = 0.8 \\times \\min(3, 20) = 0.8 \\times 3 = 2.4 \\, \\mathrm{s} $$\n\n最后，混合步骤所接受的跳跃时间是下一个关键事件发生的时间与非关键系统的跳跃时间两者中的最小值：\n$$ \\tau_{\\mathrm{final}} = \\min\\{\\tau_{\\mathrm{nc}}, \\tau_c\\} = \\min\\{2.4, 0.547428\\} = 0.547428 \\, \\mathrm{s} $$\n四舍五入到四位有效数字，我们得到 $0.5474$。", "answer": "$$\\boxed{0.5474}$$", "id": "3354376"}]}