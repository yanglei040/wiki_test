{"hands_on_practices": [{"introduction": "在判断一个网络模体是否具有统计显著性时，首要任务是理解其在简单随机图模型中的基线统计特性。本练习将引导你推导一种经典的有向模体——前馈环（Feed-Forward Loop, FFL）——在Erdős–Rényi (ER) 有向随机图模型中的精确期望和方差。通过这个练习，你将能熟练运用概率论中的指示随机变量、期望线性性质以及协方差分析等基本工具，为更复杂的显著性分析打下坚实的数学基础。[@problem_id:3332172]", "problem": "考虑一个由 $n$ 个分子种类构成的有向网络，该网络由有向 Erdős–Rényi (ER) 随机有向图模型生成。在该模型中，对于任意有序的不同节点对 $(u,v)$，有向边 $u \\to v$ 以概率 $p \\in (0,1)$ 独立存在，以概率 $1-p$ 不存在。在计算系统生物学中，前馈环 (Feed-Forward Loop, FFL) 是一种 $3$ 节点有向三元组基序，由三个不同的节点 $(i,j,k)$ 组成，它们之间恰好存在三条有向边 $i \\to j$、$j \\to k$ 和 $i \\to k$，且这三个节点之间的所有其他三条可能的有向边均不存在。在全文中，将基序计数解释为在 $3$ 个不同节点上与 FFL 同构的导出子图的数量。FFL 在基序显著性分析中至关重要，而诸如 ER 模型和配置模型 (Configuration Model, CM) 等零模型基准需要其期望丰度和变异性的解析表达式。\n\n从适用于零模型分析的第一性原理出发——即 ER 模型中的边独立性、子图出现的指示随机变量、期望的线性性以及全方差公式——推导以下两项的闭式解析表达式：\n- FFL 的期望数量，表示为 $n$ 和 $p$ 的函数，以及\n- FFL 数量的方差，表示为 $n$ 和 $p$ 的函数，\n\n推导过程中需明确考虑边的方向性和导出子图约束。将共享少于 $2$ 个节点的两个 $3$ 节点集合视为在基序出现方面是独立的，并仔细枚举两个不同 $3$ 节点集合恰好共享 $2$ 个节点时的依赖结构。假设 $n \\geq 3$。将最终结果表示为关于 $n$ 和 $p$ 的闭式表达式。不需要数值近似。以单个行矩阵中的两个表达式形式提供最终答案。无需单位。", "solution": "设 $V$ 是网络中 $n$ 个节点的集合。前馈环 (FFL) 的总数，记为 $N_{FFL}$，是 $V$ 的所有不同 $3$ 节点子集上的指示随机变量之和。设 $S$ 是 $V$ 的一个子集，且 $|S|=3$。设 $I_S$ 是一个指示变量，如果 $S$ 上的导出子图是 FFL，则 $I_S = 1$，否则 $I_S = 0$。那么，总数为 $N_{FFL} = \\sum_{S \\subset V, |S|=3} I_S$。\n\n**FFL 期望数量 $E[N_{FFL}]$ 的推导**\n根据期望的线性性，FFL 的期望数量为：\n$$E[N_{FFL}] = E\\left[\\sum_{S \\subset V, |S|=3} I_S\\right] = \\sum_{S \\subset V, |S|=3} E[I_S]$$\n不同的 $3$ 节点集合的数量为 $\\binom{n}{3}$。根据对称性，对于所有集合 $S$，期望 $E[I_S]$ 都是相同的。对于任意给定的集合 $S = \\{i,j,k\\}$，令 $P_1 = E[I_S] = P(I_S=1)$。\n当节点可以被分配为源（例如 $i$）、中间（例如 $j$）和汇（例如 $k$）的角色，使得边 $i \\to j$、$j \\to k$ 和 $i \\to k$ 存在，而这些节点之间所有其他 $3$ 条可能的有向边（$j \\to i$、$k \\to j$、$k \\to i$）均不存在时，$\\{i,j,k\\}$ 上的导出子图就是一个 FFL。\n由于 Erdős–Rényi 模型中的边独立性，这种特定的 $6$ 条边的构型的概率为 $p^3(1-p)^3$。\n对于一个给定的 $3$ 节点集合，有 $3! = 6$ 种方式来分配源、中间和汇的角色。这 $6$ 种分配对应于集合 $\\{i,j,k\\}$ 上互斥的边构型。每种构型都有相同的概率 $p^3(1-p)^3$。\n因此，一个集合 $S$ 形成 FFL 的总概率为：\n$$P_1 = P(I_S=1) = 3! \\times p^3(1-p)^3 = 6p^3(1-p)^3$$\nFFL 的期望数量是 $3$ 节点集合的数量与概率 $P_1$ 的乘积：\n$$E[N_{FFL}] = \\binom{n}{3} P_1 = \\frac{n(n-1)(n-2)}{6} \\times 6p^3(1-p)^3 = n(n-1)(n-2)p^3(1-p)^3$$\n\n**FFL 数量方差 $Var(N_{FFL})$ 的推导**\n随机变量和的方差由下式给出：\n$$Var(N_{FFL}) = Var\\left(\\sum_S I_S\\right) = \\sum_S Var(I_S) + \\sum_{S \\neq T} Cov(I_S, I_T)$$\n第一项是指示变量的方差之和。由于 $I_S$ 是一个指示变量，$I_S^2 = I_S$，其方差为 $Var(I_S) = E[I_S^2] - (E[I_S])^2 = P_1 - P_1^2 = P_1(1-P_1)$。\n$$\\sum_S Var(I_S) = \\binom{n}{3} P_1(1-P_1) = \\binom{n}{3} \\left[6p^3(1-p)^3\\right] \\left[1 - 6p^3(1-p)^3\\right]$$\n第二项是协方差之和，$Cov(I_S, I_T) = E[I_S I_T] - E[I_S]E[I_T] = P(I_S=1, I_T=1) - P_1^2$。只有当事件 $I_S=1$ 和 $I_T=1$ 相关时，协方差才非零，这发生在它们的底层边集合重叠时。如果节点集 $S$ 和 $T$ 共享边，就会发生这种情况，这要求 $|S \\cap T| \\ge 2$。\n根据问题陈述，我们只需考虑两个不同集合 $S$ 和 $T$ 恰好共享 $2$ 个节点的情况。\n设 $|S \\cap T|=2$。设 $S=\\{a,b,c\\}$ 和 $T=\\{a,b,d\\}$，其中 $a,b,c,d$ 是不同的节点。\n我们需要计算 $P_2 = E[I_S I_T] = P(I_S=1, I_T=1)$。\n为了使 $S$ 和 $T$ 上的导出子图都是 FFL，共享节点 $a$ 和 $b$ 之间必须存在特定的连接模式。一个导出 FFL 要求其任意一对节点之间恰好有一条有向边。因此，$a$ 和 $b$ 之间的边的状态不能是无边或双向边。它必须是（$a \\to b$ 且 $b \\not\\to a$）或（$b \\to a$ 且 $a \\not\\to b$）。\n我们来分析（$a \\to b$ 且 $b \\not\\to a$）的情况。这种情况的概率是 $p(1-p)$。给定节点对 $(a,b)$ 的这种状态， $S$ 形成 FFL 的事件现在仅依赖于涉及节点 $c$ 的边，$T$ 形成 FFL 的事件仅依赖于涉及节点 $d$ 的边。这两个事件是条件独立的。\n给定 $a \\to b$，为了使 $S=\\{a,b,c\\}$ 成为 FFL，有 $3$ 种互斥的可能性，取决于 $(a,b)$ 在 FFL 中扮演的角色：\n1. $(a,b)$ 作为（源节点，中间节点）：需要 FFL 为 $a \\to b \\to c$ 和 $a \\to c$。这要求边 $b \\to c$ 和 $a \\to c$ 存在，且 $c \\to b$ 和 $c \\to a$ 不存在。概率为 $p^2(1-p)^2$。\n2. $(a,b)$ 作为（源节点，汇节点）：需要 FFL 为 $a \\to c \\to b$ 和 $a \\to b$。这要求边 $a \\to c$ 和 $c \\to b$ 存在，且 $c \\to a$ 和 $b \\to c$ 不存在。概率为 $p^2(1-p)^2$。\n3. $(a,b)$ 作为（中间节点，汇节点）：需要 FFL 为 $c \\to a \\to b$ 和 $c \\to b$。这要求边 $c \\to a$ 和 $c \\to b$ 存在，且 $a \\to c$ 和 $b \\to c$ 不存在。概率为 $p^2(1-p)^2$。\n给定 $a \\to b$，$S$ 形成 FFL 的总概率是这些概率之和：$3p^2(1-p)^2$。\n根据对称性，给定 $a \\to b$，$T$ 形成 FFL 的概率也是 $3p^2(1-p)^2$。\n因此，$P(I_S=1, I_T=1 | a \\to b, b \\not\\to a) = (3p^2(1-p)^2) \\times (3p^2(1-p)^2) = 9p^4(1-p)^4$。\n对 $a$ 和 $b$ 之间的边的状态使用全概率公式：\n$$P_2 = P(I_S=1, I_T=1 | a \\to b, b \\not\\to a)P(a \\to b, b \\not\\to a) + P(I_S=1, I_T=1 | b \\to a, a \\not\\to b)P(b \\to a, a \\not\\to b)$$\n根据对称性，这两项是相同的。\n$$P_2 = 2 \\times [9p^4(1-p)^4] \\times [p(1-p)] = 18p^5(1-p)^5$$\n现在，我们计算 $|S \\cap T|=2$ 的有序集合对 $(S,T)$ 的数量。我们可以用 $\\binom{n}{3}$ 种方式选择集合 $S$，从 $S$ 中选择 $2$ 个节点 $\\binom{3}{2}$ 种方式，再从剩下的 $n-3$ 个节点中选择 $1$ 个节点来构成 $T$。这样得到的对数是 $\\binom{n}{3}\\binom{3}{2}(n-3) = \\frac{n(n-1)(n-2)}{6} \\times 3 \\times (n-3) = \\frac{n(n-1)(n-2)(n-3)}{2}$。\n协方差项的总贡献为：\n$$\\sum_{S \\neq T, |S \\cap T|=2} Cov(I_S, I_T) = \\frac{n(n-1)(n-2)(n-3)}{2} (P_2 - P_1^2)$$\n$$= \\frac{n(n-1)(n-2)(n-3)}{2} [18p^5(1-p)^5 - (6p^3(1-p)^3)^2]$$\n$$= \\frac{n(n-1)(n-2)(n-3)}{2} [18p^5(1-p)^5 - 36p^6(1-p)^6]$$\n$$= 9n(n-1)(n-2)(n-3) [p^5(1-p)^5 - 2p^6(1-p)^6]$$\n$$= 9n(n-1)(n-2)(n-3)p^5(1-p)^5(1 - 2p(1-p))$$\n$$= 9n(n-1)(n-2)(n-3)p^5(1-p)^5(1 - 2p + 2p^2)$$\n结合方差的两个部分：\n$$Var(N_{FFL}) = \\binom{n}{3}P_1(1-P_1) + \\frac{n(n-1)(n-2)(n-3)}{2}(P_2 - P_1^2)$$\n$$Var(N_{FFL}) = \\frac{n(n-1)(n-2)}{6} [6p^3(1-p)^3(1-6p^3(1-p)^3)] + 9n(n-1)(n-2)(n-3)p^5(1-p)^5(1 - 2p + 2p^2)$$\n$$Var(N_{FFL}) = n(n-1)(n-2)p^3(1-p)^3(1-6p^3(1-p)^3) + 9n(n-1)(n-2)(n-3)p^5(1-p)^5(1 - 2p + 2p^2)$$\n这就是方差的最终闭式表达式。", "answer": "$$ \\boxed{ \\begin{pmatrix} n(n-1)(n-2)p^{3}(1-p)^{3}  n(n-1)(n-2)p^{3}(1-p)^{3}(1-6p^{3}(1-p)^{3}) + 9n(n-1)(n-2)(n-3)p^{5}(1-p)^{5}(1 - 2p + 2p^{2}) \\end{pmatrix} } $$", "id": "3332172"}, {"introduction": "基于期望计数的概念，本练习将深入探讨模体的“可探测性”如何随网络稀疏度的变化而改变。它将显著性的概念与随机图论中相变的基本理论联系起来，要求你分析在网络规模增长时，不同的模体何时会“涌现”并变得具有统计意义。这项练习旨在磨练你关于网络结构如何形成以及模体在何种条件下才具有统计显著性的直觉。[@problem_id:3332214]", "problem": "考虑一个由 Erdős–Rényi (ER) 随机图 $G(N,p)$ 给出的生物调控网络零模型，其中 $N$ 表示节点数，每条可能的无向边以概率 $p$ 独立存在。网络基序是一种小的图模式，其重复出现的频率比在零模型下预期的要高。在显著性分析中，人们通过基序在零模型下当 $N \\to \\infty$ 时其计数的渐近行为来评估其可检测性：如果一个基序的归一化计数（例如，Z-分数）无界增长，则称该基序是可检测的，这要求其期望计数发散得足够快以超过其随机涨落。\n\n关注四种在计算系统生物学中常用作基准的无向4节点基序：有3条边的4节点路径 $P_4$、有3条边的3-星形图 $K_{1,3}$、有4条边的4-环 $C_4$ 和有6条边的4-团 $K_4$。考虑在网络建模中经常引用的两种稀疏区域：$p = c/N$ 和 $p = c \\log N / N$，其中 $c > 0$ 为常数。将这些基序的可检测性相变（通过期望基序计数的发散以及与涌现阈值的一致性来衡量）与 Erdős–Rényi 图中的经典涌现阈值联系起来，并选择正确描述这种关系的选项。\n\nA. 在 $p = c/N$下，$P_4$ 和 $K_{1,3}$ 的期望计数像 $\\Theta(N)$ 一样发散，而 $C_4$ 的期望计数保持为 $\\Theta(1)$，$K_4$ 的期望计数趋于 $0$。在 $p = c \\log N / N$ 下，$C_4$ 的期望计数呈多对数增长（像 $\\Theta((\\log N)^4)$），而 $K_4$ 的期望计数仍然趋于 $0$。这些相变与固定基序 $H$ 的涌现阈值 $p \\asymp N^{-1/m(H)}$ 一致，其中 $m(C_4) = 1$ 且 $m(K_4) = 3/2$。\n\nB. 在 $p = c/N$ 下，所有4节点基序的期望计数至少随 $N$ 线性发散，因此它们是可检测的；在 $p = c \\log N / N$ 下，$K_4$ 的期望计数按 $\\Theta((\\log N)^6)$ 比例缩放，因此是可检测的。\n\nC. 第一个 $C_4$ 出现的尖锐阈值在 $p \\sim (\\log N)/N$ 处，这与 $G(N,p)$ 的连通性阈值重合，并且在 $p = c/N$ 时，$C_4$ 的期望数量按 $\\Theta((\\log N)^4)$ 比例缩放。\n\nD. 在 $p = c/N$ 下，三角形 $K_3$ 是罕见的，其期望计数趋于 $0$，这意味着 $P_4$ 和 $K_{1,3}$ 也是罕见的；因此，任何4节点基序的可检测性都要求 $p \\gtrsim (\\log N)/N$。", "solution": "### 推导\n\n在 Erdős–Rényi 图 $G(N,p)$ 中，一个具有 $v_H$ 个顶点和 $e_H$ 条边的固定图 $H$ 的期望副本数由下式给出：\n$$\n\\mathbb{E}[X_H] = (\\text{H 的可能位置数}) \\times p^{e_H}\n$$\n更正式地，我们计算在一组 $N$ 个顶点上 $H$ 的标记副本数。从 $N$ 个顶点中选择 $v_H$ 个顶点的方法数是 $\\binom{N}{v_H}$。对于给定的 $v_H$ 个顶点集，形成特定图 $H$ 的方法数是 $\\frac{v_H!}{|\\text{Aut}(H)|}$，其中 $|\\text{Aut}(H)|$ 是 $H$ 的自同构群的大小。因此，\n$$\n\\mathbb{E}[X_H] = \\binom{N}{v_H} \\frac{v_H!}{|\\text{Aut}(H)|} p^{e_H}\n$$\n对于大的 $N$，$\\binom{N}{v_H} \\approx \\frac{N^{v_H}}{v_H!}$。因此，渐近标度为：\n$$\n\\mathbb{E}[X_H] \\asymp N^{v_H} p^{e_H}\n$$\n我们将此应用于给定的四个基序，它们都有 $v_H = 4$。\n\n1.  **4-节点路径 ($P_4$)**：$v_{P_4} = 4$, $e_{P_4} = 3$。\n    $\\mathbb{E}[X_{P_4}] \\asymp N^4 p^3$。\n2.  **3-星形图 ($K_{1,3}$)**：$v_{K_{1,3}} = 4$, $e_{K_{1,3}} = 3$。\n    $\\mathbb{E}[X_{K_{1,3}}] \\asymp N^4 p^3$。\n3.  **4-环 ($C_4$)**：$v_{C_4} = 4$, $e_{C_4} = 4$。\n    $\\mathbb{E}[X_{C_4}] \\asymp N^4 p^4$。\n4.  **4-团 ($K_4$)**：$v_{K_4} = 4$, $e_{K_4} = 6$。\n    $\\mathbb{E}[X_{K_4}] \\asymp N^4 p^6$。\n\n现在，我们分析 $p$ 的两个指定区域。\n\n**区域 1: $p = c/N$**\n-   $\\mathbb{E}[X_{P_4}] \\asymp N^4 (c/N)^3 = c^3 N = \\Theta(N)$。期望计数发散。\n-   $\\mathbb{E}[X_{K_{1,3}}] \\asymp N^4 (c/N)^3 = c^3 N = \\Theta(N)$。期望计数发散。\n-   $\\mathbb{E}[X_{C_4}] \\asymp N^4 (c/N)^4 = c^4 = \\Theta(1)$。期望计数收敛到一个常数。\n-   $\\mathbb{E}[X_{K_4}] \\asymp N^4 (c/N)^6 = c^6/N^2 = \\Theta(N^{-2})$。期望计数趋于 $0$。\n\n**区域 2: $p = c \\log N / N$**\n-   $\\mathbb{E}[X_{P_4}] \\asymp N^4 (c \\log N / N)^3 = c^3 N (\\log N)^3 = \\Theta(N (\\log N)^3)$。发散。\n-   $\\mathbb{E}[X_{K_{1,3}}] \\asymp N^4 (c \\log N / N)^3 = c^3 N (\\log N)^3 = \\Theta(N (\\log N)^3)$。发散。\n-   $\\mathbb{E}[X_{C_4}] \\asymp N^4 (c \\log N / N)^4 = c^4 (\\log N)^4 = \\Theta((\\log N)^4)$。呈多对数发散。\n-   $\\mathbb{E}[X_{K_4}] \\asymp N^4 (c \\log N / N)^6 = c^6 (\\log N)^6 / N^2 = \\Theta(N^{-2}(\\log N)^6)$。趋于 $0$。\n\n**涌现阈值**\n子图 $H$ 的涌现阈值是 $p$ 的一个值，在该值处 $H$ 的期望副本数从接近 $0$ 过渡到不可忽略（即 $\\mathbb{E}[X_H] = \\Theta(1)$）。该阈值由 $p \\asymp N^{-1/m(H)}$ 给出，其中 $m(H) = \\max_{H' \\subseteq H} \\frac{e_{H'}}{v_{H'}}$ 是最大子图密度。\n\n-   对于 $C_4$，子图是路径。$d(C_4) = e_{C_4}/v_{C_4} = 4/4 = 1$。路径子图的密度小于 $1$。所以，$m(C_4) = 1$。涌现阈值是 $p \\asymp N^{-1/1} = N^{-1}$。我们在 $p = c/N$ 时发现 $\\mathbb{E}[X_{C_4}] = \\Theta(1)$，这与该阈值一致。\n-   对于 $K_4$，最稠密的子图是 $K_4$ 本身。$d(K_4) = e_{K_4}/v_{K_4} = 6/4 = 3/2$。所以，$m(K_4) = 3/2$。涌现阈值是 $p \\asymp N^{-1/(3/2)} = N^{-2/3}$。由于 $p=c/N$ 和 $p=c \\log N/N$ 这两个区域都是 $o(N^{-2/3})$，预期在这两种情况下 $\\mathbb{E}[X_{K_4}] \\to 0$，这与我们的计算结果一致。\n\n### 逐项分析选项\n\n**A. 在 $p = c/N$下，$P_4$ 和 $K_{1,3}$ 的期望计数像 $\\Theta(N)$ 一样发散，而 $C_4$ 的期望计数保持为 $\\Theta(1)$，$K_4$ 的期望计数趋于 $0$。在 $p = c \\log N / N$ 下，$C_4$ 的期望计数呈多对数增长（像 $\\Theta((\\log N)^4)$），而 $K_4$ 的期望计数仍然趋于 $0$。这些相变与固定基序 $H$ 的涌现阈值 $p \\asymp N^{-1/m(H)}$ 一致，其中 $m(C_4) = 1$ 且 $m(K_4) = 3/2$。**\n\n-   $p = c/N$ 的分析：这些说法与我们推导出的标度相符：$\\mathbb{E}[X_{P_4}]=\\Theta(N)$，$\\mathbb{E}[X_{K_{1,3}}]=\\Theta(N)$，$\\mathbb{E}[X_{C_4}]=\\Theta(1)$，以及 $\\mathbb{E}[X_{K_4}] \\to 0$。这部分是正确的。\n-   $p = c \\log N / N$ 的分析：这些说法与我们推导出的标度相符：$\\mathbb{E}[X_{C_4}]=\\Theta((\\log N)^4)$ 和 $\\mathbb{E}[X_{K_4}] \\to 0$。这部分是正确的。\n-   与阈值的一致性：列出的值 $m(C_4) = 1$ 和 $m(K_4) = 3/2$ 对于最大子图密度是正确的。相应的阈值 $p \\asymp N^{-1}$（对于 $C_4$）和 $p \\asymp N^{-2/3}$（对于 $K_4$）正确地解释了计算出的行为。这部分是正确的。\n-   **结论：正确。**\n\n**B. 在 $p = c/N$ 下，所有4节点基序的期望计数至少随 $N$ 线性发散，因此它们是可检测的；在 $p = c \\log N / N$ 下，$K_4$ 的期望计数按 $\\Theta((\\log N)^6)$ 比例缩放，因此是可检测的。**\n\n-   第一部分是错误的。对于 $p = c/N$，我们发现 $\\mathbb{E}[X_{C_4}] = \\Theta(1)$ 且 $\\mathbb{E}[X_{K_4}] \\to 0$。两者都不发散。\n-   第二部分是错误的。对于 $p = c \\log N / N$，我们发现 $\\mathbb{E}[X_{K_4}] \\asymp N^{-2}(\\log N)^6$，它趋于 $0$，而不是 $\\Theta((\\log N)^6)$。\n-   **结论：错误。**\n\n**C. 第一个 $C_4$ 出现的尖锐阈值在 $p \\sim (\\log N)/N$ 处，这与 $G(N,p)$ 的连通性阈值重合，并且在 $p = c/N$ 时，$C_4$ 的期望数量按 $\\Theta((\\log N)^4)$ 比例缩放。**\n\n-   第一个 $C_4$ 出现的尖锐阈值在 $p \\asymp N^{-1/m(C_4)} = N^{-1}$。声称它在 $p \\sim (\\log N)/N$ 是错误的。\n-   虽然 $p \\sim (\\log N)/N$ 是连通性阈值，但将其与 $C_4$ 阈值联系起来的前提是错误的。\n-   关于在 $p=c/N$ 时 $\\mathbb{E}[X_{C_4}]$ 按 $\\Theta((\\log N)^4)$ 比例缩放的说法也是错误的。我们发现它按 $\\Theta(1)$ 缩放。$\\Theta((\\log N)^4)$ 的缩放发生在 $p = c \\log N / N$ 时。\n-   **结论：错误。**\n\n**D. 在 $p = c/N$ 下，三角形 $K_3$ 是罕见的，其期望计数趋于 $0$，这意味着 $P_4$ 和 $K_{1,3}$ 也是罕见的；因此，任何4节点基序的可检测性都要求 $p \\gtrsim (\\log N)/N$。**\n\n-   第一个前提：三角形 ($K_3$) 的期望数量是 $\\mathbb{E}[X_{K_3}] \\asymp N^3 p^3$。对于 $p = c/N$，这给出 $\\mathbb{E}[X_{K_3}] \\asymp N^3 (c/N)^3 = c^3 = \\Theta(1)$。声称期望计数趋于 $0$ 是错误的。\n-   第二个前提（“蕴涵”）：路径 ($P_4$) 和星形图 ($K_{1,3}$) 的存在不依赖于三角形的存在。实际上，$P_4$ 和 $K_{1,3}$ 是无三角形的。此外，我们证明了它们的期望计数像 $\\Theta(N)$ 一样发散，所以它们并不“罕见”。\n-   结论：声称可检测性要求 $p \\gtrsim (\\log N)/N$ 是错误的，因为在 $p = c/N$ 时，$P_4$ 和 $K_{1,3}$ 的期望计数是发散的。\n-   **结论：错误。**", "answer": "$$\\boxed{A}$$", "id": "3332214"}, {"introduction": "真实世界的网络远比简单的ER随机图复杂，它们通常具有社团结构和异质性的度分布，这些结构特征本身就可能导致某些模体的出现频率偏高。本练习引入了一种更复杂的零模型——度矫正随机块模型（Degree-Corrected Stochastic Block Model, DCSBM），它能同时控制社团结构和节点的度序列。你将通过编程实现一个工作流，计算在排除了这些复杂结构特征的影响后，模体的“残差”显著性，从而检验模体的富集是否是超越了这些底层结构的一种更高级的组织原则。[@problem_id:3332201]", "problem": "给定一组有向简单图，图中无自环，每个图由一个邻接矩阵 $A \\in \\{0,1\\}^{n \\times n}$ 和一个块分配向量 $b \\in \\{0,1,\\dots,B-1\\}^n$ 表示。对于每个图，考虑其泊松公式下的度矫正随机块模型 (Degree-Corrected Stochastic Block Model, DCSBM)，其中在给定参数的条件下，有向边是独立的泊松随机变量。DCSBM 将节点 $i$ 和 $j$ 之间的期望边率指定为 $\\lambda_{ij} = \\theta_i^{\\text{out}} \\theta_j^{\\text{in}} \\omega_{r s}$，其中 $r = b_i$，$s = b_j$，并包含块特定的归一化，使得最大似然估计是可识别的。通过对观测到的邻接矩阵进行最大似然估计来拟合 DCSBM 参数，并使用拟合的模型构建一个伯努利独立性近似，其边概率为 $p_{ij} = \\mathbb{E}[A_{ij}]$ (当 $i \\neq j$) 和 $p_{ii} = 0$。\n\n在由不同节点组成的有序三元组 $(i,j,k)$ 上定义两种有向 3 节点子图基序：\n- “伪前馈环” (Pseudo-FFL) 基序 $m_{\\text{PFFL}}$，它在 $(i,j,k)$ 上出现当且仅当 $A_{ij} = 1$，$A_{ik} = 1$ 且 $A_{jk} = 1$。\n- 有向 3-环基序 $m_{\\circlearrowleft}$，它在 $(i,j,k)$ 上出现当且仅当 $A_{ij} = 1$，$A_{jk} = 1$ 且 $A_{ki} = 1$。\n\n对每个图，计算：\n1. 观测计数 $C_{\\text{PFFL}}$ 和 $C_{\\circlearrowleft}$，即满足上述基序边条件的有序三元组 $(i,j,k)$ 的总数。如果允许重复索引，则有序三元组的总数为 $n \\cdot (n-1) \\cdot (n-1)$，但由于当索引重复时下面的乘积中包含 $A_{ii}$，且 $A_{ii} = 0$，因此你可以在所有有序三元组 $(i,j,k)$ 上求和，而无需显式强制节点不同，前提是你已明确设置 $A_{ii} = 0$。\n2. 在拟合的 DCSBM 和伯努利独立性近似下的期望计数，通过将每个 $A_{uv}$ 替换为 $p_{uv}$ 并在所有有序三元组上求和得到，即\n   - $\\mathbb{E}[C_{\\text{PFFL}}] = \\sum_{i,j,k} p_{ij} \\, p_{ik} \\, p_{jk}$，\n   - $\\mathbb{E}[C_{\\circlearrowleft}] = \\sum_{i,j,k} p_{ij} \\, p_{jk} \\, p_{ki}$，\n   在这两种情况下，求和遍及所有 $i,j,k \\in \\{0,1,\\dots,n-1\\}$，且 $p_{ii} = 0$。\n3. 一种方差的近似计算，它在稀疏状态下忽略了由重叠三元组引起的依赖关系，通过将每个三元组的基序指示符视为一个独立的伯努利随机变量，其均值等于相应概率的乘积：\n   - $\\operatorname{Var}(C_{\\text{PFFL}}) \\approx \\sum_{i,j,k} q_{ijk}^{\\text{PFFL}} \\, (1 - q_{ijk}^{\\text{PFFL}})$，其中 $q_{ijk}^{\\text{PFFL}} = p_{ij} \\, p_{ik} \\, p_{jk}$，\n   - $\\operatorname{Var}(C_{\\circlearrowleft}) \\approx \\sum_{i,j,k} q_{ijk}^{\\circlearrowleft} \\, (1 - q_{ijk}^{\\circlearrowleft})$，其中 $q_{ijk}^{\\circlearrowleft} = p_{ij} \\, p_{jk} \\, p_{ki}$。\n4. 残差 $z$ 分数 $z_m = \\dfrac{C_m - \\mathbb{E}[C_m]}{\\sqrt{\\operatorname{Var}(C_m)}}$，其中 $m \\in \\{\\text{PFFL}, \\circlearrowleft\\}$。如果 $\\operatorname{Var}(C_m) = 0$，则定义 $z_m = 0$。\n\n你的目标是通过计算考虑了块效应后的残差 $z_m$，来研究基序的富集是否可以完全由社团分类混合性解释，其中使用通过最大似然法拟合的度矫正随机块模型作为零假设模型。\n\n使用以下图和块标签的测试套件。在每个案例中，邻接矩阵 $A^{(t)}$ 被明确给出，其行和列的索引从 $0$ 到 $n-1$，并且所有对角线元素均为 $0$。\n\n测试案例 1 ($n = 6$, $B = 2$):\n- 块标签 $b^{(1)} = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,1\\,]$。\n- 邻接矩阵 $A^{(1)}$:\n  $$\n  \\begin{bmatrix}\n  0  1  1  1  0  0 \\\\\n  0  0  1  0  0  0 \\\\\n  0  0  0  1  0  0 \\\\\n  1  0  0  0  1  1 \\\\\n  0  0  0  0  0  1 \\\\\n  1  0  0  0  0  0\n  \\end{bmatrix}\n  $$\n\n测试案例 2 ($n = 6$, $B = 2$):\n- 块标签 $b^{(2)} = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,1\\,]$。\n- 邻接矩阵 $A^{(2)}$:\n  $$\n  \\begin{bmatrix}\n  0  1  0  1  0  0 \\\\\n  0  0  1  1  0  0 \\\\\n  0  0  0  0  1  0 \\\\\n  0  1  0  0  1  0 \\\\\n  0  0  1  0  0  1 \\\\\n  0  0  0  0  0  0\n  \\end{bmatrix}\n  $$\n\n测试案例 3 ($n = 4$, $B = 2$):\n- 块标签 $b^{(3)} = [\\,0,\\,0,\\,1,\\,1\\,]$。\n- 邻接矩阵 $A^{(3)}$:\n  $$\n  \\begin{bmatrix}\n  0  0  0  0 \\\\\n  0  0  0  0 \\\\\n  0  0  0  0 \\\\\n  0  0  0  0\n  \\end{bmatrix}\n  $$\n\n在所有测试案例中统一使用的实现细节和假设：\n- 通过最大似然法拟合泊松 DCSBM，然后在拟合模型下，对于 $i \\neq j$ 使用 $p_{ij} = \\mathbb{E}[A_{ij}]$，并设置 $p_{ii} = 0$。使用一个数值稳定的裁剪规则 $p_{ij} \\leftarrow \\min\\{p_{ij}, 1 - \\varepsilon\\}$，其中 $\\varepsilon > 0$ 是一个小数，以避免退化概率。如果分母中的任何拟合分量为零（例如，某个块没有出边），则将相应的 $p_{ij}$ 设置为 $0$。\n- 如上所述，计算有序三元组上的观测基序计数 $C_{\\text{PFFL}}$ 和 $C_{\\circlearrowleft}$。\n- 通过在所有有序三元组上对 $q(1-q)$ 求和来近似方差，其中 $q$ 等于该三元组的相关边概率的乘积，并且当方差计算结果为 $0$ 时，将残差 $z$ 分数设置为 $0$。\n\n你的程序应生成单行输出，其中包含六个残差 $z$ 分数，顺序为 $[\\,z_{\\text{PFFL}}^{(1)}, z_{\\circlearrowleft}^{(1)}, z_{\\text{PFFL}}^{(2)}, z_{\\circlearrowleft}^{(2)}, z_{\\text{PFFL}}^{(3)}, z_{\\circlearrowleft}^{(3)}\\,]$，形式为一个用方括号括起来的逗号分隔列表，每个值四舍五入到恰好 $6$ 位小数，且无多余空格。此任务不涉及物理单位，所有量均为纯数。不涉及角度。不使用百分比；所有输出均为十进制数。", "solution": "对每个图的总体流程如下：\n1.  使用给定的邻接矩阵 $A$ 和块分配 $b$，通过最大似然估计 (MLE) 拟合泊松 DCSBM 的参数。这将提供期望的边概率 $p_{ij}$。\n2.  直接从邻接矩阵 $A$ 计算伪前馈环 (PFFL) 和 3-环基序的观测计数 $C_{\\text{PFFL}}$ 和 $C_{\\circlearrowleft}$。\n3.  使用边概率矩阵 $P = [p_{ij}]$，在拟合的 DCSBM 下计算期望计数 $\\mathbb{E}[C_{\\text{PFFL}}]$ 和 $\\mathbb{E}[C_{\\circlearrowleft}]$。\n4.  在独立性假设下近似方差 $\\operatorname{Var}(C_{\\text{PFFL}})$ 和 $\\operatorname{Var}(C_{\\circlearrowleft})$。\n5.  结合这些量来计算最终的残差 z 分数 $z_{\\text{PFFL}}$ 和 $z_{\\circlearrowleft}$。\n\n### 步骤 1：DCSBM 的最大似然估计\n\n度矫正随机块模型 (DCSBM) 的泊松公式假设节点 $i$ 和 $j$ 之间的边数 $A_{ij}$ 是一个均值为 $\\lambda_{ij}$ 的泊松随机变量。期望边数 $\\lambda_{ij}$ 的最大似然估计 (MLE) 由以下公式给出：\n$$ \\hat{\\lambda}_{ij} = \\frac{k_i^{\\text{out}} k_j^{\\text{in}} M_{b_i b_j}}{\\kappa_{b_i}^{\\text{out}} \\kappa_{b_j}^{\\text{in}}} $$\n其中：\n- $k_i^{\\text{out}} = \\sum_j A_{ij}$ 是节点 $i$ 的出度。\n- $k_j^{\\text{in}} = \\sum_i A_{ij}$ 是节点 $j$ 的入度。\n- $M_{rs} = \\sum_{i: b_i=r, j: b_j=s} A_{ij}$ 是从块 $r$ 到块 $s$ 的总边数。\n- $\\kappa_r^{\\text{out}} = \\sum_{i: b_i=r} k_i^{\\text{out}}$ 是块 $r$ 的总出度。\n- $\\kappa_s^{\\text{in}} = \\sum_{j: b_j=s} k_j^{\\text{in}}$ 是块 $s$ 的总入度。\n\n如果任何分母项（$\\kappa_{b_i}^{\\text{out}}$ 或 $\\kappa_{b_j}^{\\text{in}}$）为零，则相应的 $\\hat{\\lambda}_{ij}$ 设置为 $0$。问题指定使用一个伯努利独立性模型，其概率为 $p_{ij} = \\min\\{\\hat{\\lambda}_{ij}, 1 - \\varepsilon\\}$，并强制 $p_{ii} = 0$。\n\n### 步骤 2：观测基序计数\n\n观测计数是通过矩阵运算高效计算的。\n\n**伪前馈环 (PFFL)：**\n$$ C_{\\text{PFFL}} = \\sum_{i,j,k} A_{ij} A_{ik} A_{jk} = \\sum_{j,k} A_{jk} (A^T A)_{jk} $$\n\n**有向 3-环：**\n$$ C_{\\circlearrowleft} = \\sum_{i,j,k} A_{ij} A_{jk} A_{ki} = \\operatorname{Tr}(A^3) $$\n\n### 步骤 3：期望基序计数\n\n拟合模型下的期望计数是通过将二元邻接矩阵 $A$ 替换为概率矩阵 $P = [p_{ij}]$ 来计算的。\n$$ \\mathbb{E}[C_{\\text{PFFL}}] = \\sum_{i,j,k} p_{ij} p_{ik} p_{jk} = \\sum_{j,k} p_{jk} (P^T P)_{jk} $$\n$$ \\mathbb{E}[C_{\\circlearrowleft}] = \\sum_{i,j,k} p_{ij} p_{jk} p_{ki} = \\operatorname{Tr}(P^3) $$\n\n### 步骤 4：近似方差\n\n方差是通过假设不同三元组上基序的出现是独立的伯努利试验来近似的。\n\n**PFFL 方差：**\n$$ \\operatorname{Var}(C_{\\text{PFFL}}) \\approx \\sum_{i,j,k} q_{ijk}^{\\text{PFFL}} (1 - q_{ijk}^{\\text{PFFL}}) = \\mathbb{E}[C_{\\text{PFFL}}] - \\sum_{i,j,k} (p_{ij} p_{ik} p_{jk})^2 $$\n\n**3-环方差：**\n$$ \\operatorname{Var}(C_{\\circlearrowleft}) \\approx \\sum_{i,j,k} q_{ijk}^{\\circlearrowleft} (1 - q_{ijk}^{\\circlearrowleft}) = \\mathbb{E}[C_{\\circlearrowleft}] - \\sum_{i,j,k} (p_{ij} p_{jk} p_{ki})^2 $$\n\n### 步骤 5：残差 Z 分数\n\n每种基序类型 $m$ 的残差 z 分数是：\n$$ z_m = \\frac{C_m - \\mathbb{E}[C_m]}{\\sqrt{\\operatorname{Var}(C_m)}} $$\n如果 $\\operatorname{Var}(C_m) = 0$，则 $z_m = 0$。", "answer": "[1.332356,2.236068,0.730297,-0.447214,0.000000,0.000000]", "id": "3332201"}]}