{"hands_on_practices": [{"introduction": "在我们解释影子价格之前，我们必须首先理解它们的基本性质。本练习将引导你通过量纲分析来确定对偶变量的物理单位，从而揭示其作为代谢物边际价值的经济学解释。理解这些单位是正确应用和交流对偶分析结果的关键第一步。[@problem_id:3303521]", "problem": "考虑一个基因组尺度代谢模型的规范通量平衡分析 (FBA) 表述。设化学计量矩阵为 $S \\in \\mathbb{R}^{m \\times n}$，反应通量向量为 $v \\in \\mathbb{R}^{n}$，并假设稳态质量守恒由 $S v = 0$ 给出。原始优化问题是在约束条件 $S v = 0$ 和按分量的界限 $\\ell \\le v \\le u$ 下，最大化 $c^{T} v$。在此背景下，假设 $S$ 中的化学计量系数是无量纲的（生产和消耗的化学计量计算的是没有内在单位的分子数量），并且界限 $\\ell, u \\in \\mathbb{R}^{n}$ 与 $v$ 具有相同的物理单位。定义三个基本物理单位符号：$U_{M}$ 代表物质的量，$U_{W}$ 代表干生物质重量，$U_{T}$ 代表时间。假设每个通量分量 $v_{j}$ 的单位为 $U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$。优化目标 $c^{T} v$ 被构建为等于一个单位为 $U_{T}^{-1}$ 的比生长速率 $\\mu$，这是通过选择 $c \\in \\mathbb{R}^{n}$ 实现的，使其非零项能将通量单位转换为生长速率单位。具体来说，要求 $[c] \\cdot [v] = U_{T}^{-1}$，因此 $[c]$ 的单位必须是 $U_{W} \\, U_{M}^{-1}$。\n\n考虑原始问题的拉格朗日函数，引入与等式约束 $S v = 0$ 相关联的对偶变量 $y \\in \\mathbb{R}^{m}$，以及分别与上下界不等式相关联的对偶变量 $\\alpha, \\beta \\in \\mathbb{R}^{n}$。Karush–Kuhn–Tucker 条件蕴含了对偶可行性平衡\n$$\nS^{T} y + \\alpha - \\beta = c.\n$$\n从稳态质量守恒和拉格朗日函数中所有项单位一致的要求出发，确定对偶变量 $y$、$\\alpha$ 和 $\\beta$ 的物理单位。\n\n将最终答案表示为一个单行矩阵，依次列出 $y$、$\\alpha$ 和 $\\beta$ 的单位，每个单位都写成基本单位符号 $U_{M}$、$U_{W}$ 和 $U_{T}$ 与适当整数指数的乘积形式。最终表达式中不要包含任何其他文本。", "solution": "我们从通量平衡分析 (FBA) 的基本设定开始，该方法模拟处于稳态的代谢网络。核心稳态原理是每个代谢物池的质量守恒，\n$$\nS v = 0,\n$$\n其中 $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵（其无量纲项计算分子的参与），$v \\in \\mathbb{R}^{n}$ 是反应通量向量。每个通量分量 $v_{j}$ 代表每单位生物质每单位时间内代谢物的净转换率，其物理单位为 $[v] = U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$。\n\n优化目标是 $c^{T} v$，被选择用来代表一个单位为 $U_{T}^{-1}$ 的比生长速率 $\\mu$。因为 $c^{T} v$ 的单位必须是 $U_{T}^{-1}$，且 $[v] = U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$，我们要求 $c$ 的单位满足\n$$\n[c] \\cdot [v] = U_{T}^{-1}.\n$$\n因此，\n$$\n[c] = \\frac{U_{T}^{-1}}{U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}} = U_{W} \\, U_{M}^{-1}.\n$$\n这与以下解释相符：$c$ 通过一个“生物质/物质的量”因子，将一个“物质的量/生物质/时间”的通量转换为一个“每时间”的速率。\n\n为了分析对偶变量的单位，我们考虑原始问题的拉格朗日函数：\n$$\nL(v, y, \\alpha, \\beta) = c^{T} v + y^{T} (S v) + \\alpha^{T} (u - v) + \\beta^{T} (v - l),\n$$\n其中 $y \\in \\mathbb{R}^{m}$ 对应于等式约束 $S v = 0$，$\\alpha, \\beta \\in \\mathbb{R}^{n}$ 分别对应于不等式约束 $v \\le u$ 和 $v \\ge l$。$L$ 中的每一项都必须与目标函数 $c^{T} v$ 具有相同的物理单位，即 $U_{T}^{-1}$。\n\n我们分析每一项的单位：\n1. 对于 $c^{T} v$，我们已经确定 $[c^{T} v] = U_{T}^{-1}$，其中 $[c] = U_{W} \\, U_{M}^{-1}$ 且 $[v] = U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$。\n2. 对于 $y^{T} (S v)$，由于 $S$ 是无量纲的且 $[S v] = [v]$，我们有\n$$\n[y^{T} (S v)] = [y] \\cdot [v] = [y] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}).\n$$\n为了与目标的单位相匹配，\n$$\n[y] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}) = U_{T}^{-1}\n\\quad \\Longrightarrow \\quad\n[y] = \\frac{U_{T}^{-1}}{U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}} = U_{W} \\, U_{M}^{-1}.\n$$\n3. 对于 $\\alpha^{T} (u - v)$，注意 $[u - v] = [v]$ 因为 $u$ 和 $v$ 的单位相同。那么\n$$\n[\\alpha^{T} (u - v)] = [\\alpha] \\cdot [v] = [\\alpha] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}) = U_{T}^{-1}\n\\quad \\Longrightarrow \\quad\n[\\alpha] = U_{W} \\, U_{M}^{-1}.\n$$\n4. 类似地，对于 $\\beta^{T} (v - l)$，由于 $[v - l] = [v]$，\n$$\n[\\beta^{T} (v - l)] = [\\beta] \\cdot [v] = [\\beta] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}) = U_{T}^{-1}\n\\quad \\Longrightarrow \\quad\n[\\beta] = U_{W} \\, U_{M}^{-1}.\n$$\n\n这些基于拉格朗日函数的单位推导可以通过对偶可行性条件进行交叉检验：\n$$\nS^{T} y + \\alpha - \\beta = c.\n$$\n因为 $S$ 是无量纲的，所以等式左侧 $S^{T} y$ 项的单位是 $[y]$，而各自的边界对偶变量的单位是 $[\\alpha]$ 和 $[\\beta]$。令两边相等，我们发现\n$$\n[y] = [\\alpha] = [\\beta] = [c].\n$$\n由于我们已经确定 $[c] = U_{W} \\, U_{M}^{-1}$，这个验证结果是一致的。\n\n因此，与质量平衡和通量界限相关的对偶变量的单位都等于 $U_{W} \\, U_{M}^{-1}$。所要求的有序三元组是\n$$\n\\big([y], [\\alpha], [\\beta]\\big) = \\big(U_{W} \\, U_{M}^{-1}, \\, U_{W} \\, U_{M}^{-1}, \\, U_{W} \\, U_{M}^{-1}\\big).\n$$", "answer": "$$\\boxed{\\begin{pmatrix} U_{W}\\,U_{M}^{-1}  U_{W}\\,U_{M}^{-1}  U_{W}\\,U_{M}^{-1} \\end{pmatrix}}$$", "id": "3303521"}, {"introduction": "在掌握了它们的物理意义之后，我们现在转向计算影子价格并用其进行预测。本练习使用一个简化的代谢模型，引导你通过KKT条件推导出影子价格。然后，你将使用这个值来预测当一个营养物质的吸收上限被放宽时，最优生长率的变化，从而展示对偶变量的直接实际效用。[@problem_id:3303544]", "problem": "考虑一个微生物细胞的简化通量平衡分析（FBA）模型，其内部代谢物为葡萄糖（胞质）和三磷酸腺苷（ATP）。该系统包含四个不可逆反应，其通量向量为 $v = (v_{1}, v_{2}, v_{3}, v_{4})$：\n\n- 葡萄糖摄取：$v_{1}$，其边界为 $0 \\leq v_{1} \\leq u_{\\text{Glc}}$。\n- 糖酵解：$v_{2}$，将胞质葡萄糖转化为 ATP。\n- 非生长相关 ATP 维持：$v_{3}$，其边界为 $v_{3} \\geq m$。\n- 生物质合成：$v_{4}$，即需要最大化的目标。\n\n在代谢稳态下，内部质量平衡由以下化学计量等式保证\n$$\nv_{1} - v_{2} = 0, \\quad 2 v_{2} - v_{3} - v_{4} = 0,\n$$\n其中，第二个等式反映了每单位 $v_{2}$ 产生 2 单位的 ATP，每单位生物质通量 $v_{4}$ 消耗一单位 ATP，以及 ATP 维持消耗 $v_{3}$ 单位的 ATP。所有通量均使用标准的 FBA 单位 $\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$，而生物质通量 $v_{4}$ 通过生物质反应的化学计量关系被解释为以 $\\text{h}^{-1}$ 为单位的生长速率。\n\n原始线性规划问题是最大化生长速率\n$$\n\\max_{v} \\; v_{4}\n$$\n其约束条件为稳态等式和以下边界\n$$\n0 \\leq v_{1} \\leq u_{\\text{Glc}}, \\quad v_{2} \\geq 0, \\quad v_{3} \\geq m, \\quad v_{4} \\geq 0.\n$$\n\n取 $u_{\\text{Glc}} = 10$ 且 $m = 3$。利用线性规划对偶性的第一性原理和影子价格（与不等式约束相关的对偶变量）的定义，通过构建拉格朗日函数并应用 Karush–Kuhn–Tucker（KKT）条件，推导与 $v_{1}$ 上界相关的最优影子价格 $\\alpha_{\\text{Glc}}^{\\star}$。然后，对于葡萄糖摄取上界的一个小增量 $\\delta = 3.75 \\times 10^{-2}$，计算因 $u_{\\text{Glc}}$ 增加 $\\delta$ 而导致的最优生长速率的一阶变化量 $\\Delta z^{\\star}$。将您的最终数值答案四舍五入至四位有效数字，并以 $\\text{h}^{-1}$ 为单位表示生长速率的变化。", "solution": "我们首先求解原始线性规划问题以确定最优通量分布。目标是最大化 $v_4$。\n根据质量平衡约束：\n1. $v_1 - v_2 = 0 \\implies v_1 = v_2$\n2. $2v_2 - v_3 - v_4 = 0 \\implies v_4 = 2v_2 - v_3$\n\n将第二个等式代入目标函数，问题变为最大化 $2v_2 - v_3$。为了实现最大化，我们需要最大化 $v_2$ 并最小化 $v_3$。\n\n通量边界为：\n- $0 \\le v_1 \\le u_{\\text{Glc}} = 10$。由于 $v_1 = v_2$，这意味着 $0 \\le v_2 \\le 10$。因此，$v_2$ 的最大可能值为 $v_2^\\star = 10$。\n- $v_3 \\ge m = 3$。因此，$v_3$ 的最小可能值为 $v_3^\\star = 3$。\n\n将这些值代入，我们得到最优生长速率：\n$z^\\star = v_4^\\star = 2v_2^\\star - v_3^\\star = 2(10) - 3 = 17$。\n最优通量向量为 $v^\\star = (10, 10, 3, 17)$。在此最优点，两个约束是紧的（active）：$v_1 = u_{\\text{Glc}}$ 和 $v_3 = m$。\n\n接下来，我们使用 Karush-Kuhn-Tucker (KKT) 条件来推导影子价格。我们将问题表述为一个标准的最大化问题，并构建其拉格朗日函数。\n**最大化** $v_4$\n**约束于**：\n- $v_1 - v_2 = 0$ (对偶变量 $\\lambda_1$)\n- $2v_2 - v_3 - v_4 = 0$ (对偶变量 $\\lambda_2$)\n- $u_{\\text{Glc}} - v_1 \\ge 0$ (对偶变量 $\\alpha_{\\text{Glc}} \\ge 0$)\n- $v_3 - m \\ge 0$ (对偶变量 $\\alpha_3 \\ge 0$)\n- $v_1, v_2, v_4 \\ge 0$ (对偶变量 $\\mu_1, \\mu_2, \\mu_4 \\ge 0$)\n\n拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L} = v_4 + \\lambda_1(v_1 - v_2) + \\lambda_2(2v_2 - v_3 - v_4) + \\alpha_{\\text{Glc}}(u_{\\text{Glc}} - v_1) + \\alpha_3(v_3 - m) + \\mu_1 v_1 + \\mu_2 v_2 + \\mu_4 v_4\n$$\n\nKKT 平稳性条件要求 $\\mathcal{L}$ 对每个 $v_j$ 的偏导数为零：\n- $\\frac{\\partial\\mathcal{L}}{\\partial v_1} = \\lambda_1 - \\alpha_{\\text{Glc}} + \\mu_1 = 0$\n- $\\frac{\\partial\\mathcal{L}}{\\partial v_2} = -\\lambda_1 + 2\\lambda_2 + \\mu_2 = 0$\n- $\\frac{\\partial\\mathcal{L}}{\\partial v_3} = -\\lambda_2 + \\alpha_3 = 0$\n- $\\frac{\\partial\\mathcal{L}}{\\partial v_4} = 1 - \\lambda_2 + \\mu_4 = 0$\n\nKKT 互补松弛性条件指出，如果一个不等式约束不是紧的，其对应的对偶变量为零。在我们的最优解 $v^\\star = (10, 10, 3, 17)$ 中：\n- $v_1^\\star = 10 > 0 \\implies \\mu_1 = 0$\n- $v_2^\\star = 10 > 0 \\implies \\mu_2 = 0$\n- $v_4^\\star = 17 > 0 \\implies \\mu_4 = 0$\n\n将这些零值代入平稳性方程，我们得到简化的系统：\n1. $\\lambda_1 - \\alpha_{\\text{Glc}} = 0 \\implies \\lambda_1 = \\alpha_{\\text{Glc}}$\n2. $-\\lambda_1 + 2\\lambda_2 = 0 \\implies \\lambda_1 = 2\\lambda_2$\n3. $-\\lambda_2 + \\alpha_3 = 0 \\implies \\lambda_2 = \\alpha_3$\n4. $1 - \\lambda_2 = 0 \\implies \\lambda_2 = 1$\n\n从方程 (4) 开始求解，我们得到 $\\lambda_2 = 1$。\n代入 (2)，我们得到 $\\lambda_1 = 2(1) = 2$。\n代入 (1)，我们得到 $\\alpha_{\\text{Glc}} = \\lambda_1 = 2$。\n代入 (3)，我们得到 $\\alpha_3 = \\lambda_2 = 1$。\n\n与 $v_1$ 上界相关的影子价格是 $\\alpha_{\\text{Glc}}$。因此，我们推导出 $\\alpha_{\\text{Glc}}^{\\star} = 2$。这个值代表了当葡萄糖摄取上界 $u_{\\text{Glc}}$ 每增加一个单位时，最优生长速率 $z^\\star$ 的增加量，即 $\\alpha_{\\text{Glc}}^{\\star} = \\frac{\\partial z^\\star}{\\partial u_{\\text{Glc}}}$。\n\n最后，我们计算当 $u_{\\text{Glc}}$ 增加 $\\delta = 3.75 \\times 10^{-2}$ 时，最优生长速率的一阶变化量 $\\Delta z^{\\star}$：\n$$\n\\Delta z^{\\star} \\approx \\frac{\\partial z^\\star}{\\partial u_{\\text{Glc}}} \\times \\delta = \\alpha_{\\text{Glc}}^{\\star} \\times \\delta\n$$\n$$\n\\Delta z^{\\star} \\approx 2 \\times (3.75 \\times 10^{-2}) = 0.075\n$$\n问题要求将答案四舍五入至四位有效数字。因此，我们将结果表示为 $0.07500$。这个值是以 $\\text{h}^{-1}$ 为单位的生长速率变化。", "answer": "$$\n\\boxed{0.07500}\n$$", "id": "3303544"}, {"introduction": "尽管手动计算对于建立直觉至关重要，但真实世界的模型通常需要计算工具。本练习要求你实现一种数值方法，在包含额外复杂约束（如蛋白质组容量）的FBA模型中估算影子价格。通过解决一系列测试案例，你将在使用编程分析资源分配如何限制细胞目标方面获得实践经验，这是系统生物学的一个核心主题。[@problem_id:3303571]", "problem": "要求您在线性规划 (LP) 框架中形式化并分析一个流平衡分析 (FBA) 模型，并计算蛋白质组资源约束的影子价格。流平衡分析 (FBA) 是一种基于约束的稳态细胞代谢建模方法，它在满足质量平衡的条件下优化一个线性目标。令 $S \\in \\mathbb{R}^{m \\times n}$ 表示化学计量矩阵，$v \\in \\mathbb{R}^n$ 为反应通量向量，$c \\in \\mathbb{R}^n$ 为目标系数，$l \\in \\mathbb{R}^n$ 和 $u \\in \\mathbb{R}^n$ 为通量的下界和上界。稳态约束为 $S v = 0$。考虑一个线性规划问题，其目标是最大化 $c^\\top v$，约束条件为 $S v = 0$、$l \\le v \\le u$ 以及蛋白质组成本约束 $\\sum_{j=1}^n a_j v_j \\le P$，其中 $a_j \\ge 0$ 且 $P \\ge 0$。\n\n您的任务是针对几个测试用例，计算影子价格 $\\lambda_P$，它被定义为蛋白质组资源 $P$ 对最优目标值的边际价值。具体来说，对于一个给定的实例，将 $\\phi(P)$ 定义为在资源水平为 $P$ 时 LP 目标 $c^\\top v$ 的最优值。您必须使用前向有限差分来计算 $\\lambda_P$ 的近似值：\n$$\n\\lambda_P \\approx \\frac{\\phi(P + \\Delta P) - \\phi(P)}{\\Delta P},\n$$\n其中 $\\Delta P$ 是一个小的正增量。这个量应被解释为蛋白质组资源 $P$ 每增加一个单位所带来的最优目标的增加量，这与计算系统生物学中的资源分配模型一致。该 LP 必须由线性规划求解器精确求解；不允许使用解析捷径。\n\n您必须实现一个完整的、可运行的程序，该程序能够：\n- 通过最小化 $-c^\\top v$（因为求解器执行的是最小化），在满足约束条件 $S v = 0$、$\\sum_{j=1}^n a_j v_j \\le P$ 以及边界 $l \\le v \\le u$ 的情况下，以典范形式建立原线性规划。\n- 为一个指定的微小 $\\Delta P$ 计算 $\\phi(P)$ 和 $\\phi(P + \\Delta P)$，并返回前向差分作为 $\\lambda_P$ 的数值。\n- 使用固定步长 $\\Delta P = 10^{-6}$ 的严格有限差分，以确保在所有测试用例中数值行为的一致性。\n\n所有答案均为纯数学浮点数，不需要物理单位。不涉及角度。不涉及百分比。\n\n测试套件：\n使用以下参数集，它们涵盖了典型和边缘情况的行为。在所有情况下，等式约束均为 $S v = 0$，目标为 $c^\\top v$。\n\n- 测试用例 1 (蛋白质组约束具有约束力，单一生物质通路)：\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$。\n  - $c = \\begin{bmatrix} 0  1 \\end{bmatrix}$。\n  - $a = \\begin{bmatrix} 0.1  0.2 \\end{bmatrix}$。\n  - $P = 1$。\n  - 边界：$v_1 \\in [0, 10]$，$v_2 \\in [0, 100]$。\n\n- 测试用例 2 (由于摄取通量上限，蛋白质组约束不具约束力)：\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$。\n  - $c = \\begin{bmatrix} 0  1 \\end{bmatrix}$。\n  - $a = \\begin{bmatrix} 0.1  0.2 \\end{bmatrix}$。\n  - $P = 100$。\n  - 边界：$v_1 \\in [0, 10]$，$v_2 \\in [0, 100]$。\n\n- 测试用例 3 (蛋白质组约束具有约束力，包含两种同工酶，资源分配选择蛋白质组成本较低的通路)：\n  - $S = \\begin{bmatrix} 1  -1  -1 \\end{bmatrix}$。\n  - $c = \\begin{bmatrix} 0  1  1 \\end{bmatrix}$。\n  - $a = \\begin{bmatrix} 0.05  0.3  0.1 \\end{bmatrix}$。\n  - $P = 1$。\n  - 边界：$v_1 \\in [0, 100]$，$v_2 \\in [0, 100]$，$v_3 \\in [0, 100]$。\n\n- 测试用例 4 (蛋白质组和摄取约束重合的退化边界；前向灵敏度为零)：\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$。\n  - $c = \\begin{bmatrix} 0  1 \\end{bmatrix}$。\n  - $a = \\begin{bmatrix} 0.2  0.3 \\end{bmatrix}$。\n  - $P = 2.5$。\n  - 边界：$v_1 \\in [0, 5]$，$v_2 \\in [0, 100]$。\n\n实现要求：\n- 使用线性规划求解器计算每个测试用例的最优目标 $\\phi(P)$ 和 $\\phi(P + \\Delta P)$。\n- 对所有用例均使用 $\\Delta P = 10^{-6}$。\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，顺序为测试用例 1 到 4。例如，输出格式必须严格为：$[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 是为测试用例 $i$ 计算出的 $\\lambda_P$ 的数值近似值。", "solution": "该任务的核心是利用数值方法估算与蛋白质组容量约束相关的影子价格 $\\lambda_P$。在优化理论中，影子价格表示最优目标函数值相对于约束右侧项变化的速率。我们将通过求解线性规划（LP）问题，并使用前向有限差分法来近似这个导数。\n\n**线性规划的公式化**\n问题要求找到最优通量向量 $v$，该向量在一组线性约束下最大化线性目标函数 $c^\\top v$。这是一个典型的线性规划问题。为了使用像 `scipy.optimize.linprog` 这样的标准LP求解器（通常执行最小化），我们将最大化问题 $\\max(c^\\top v)$ 转换为等效的最小化问题 $\\min(-c^\\top v)$。最大化问题的最优值是最小化问题最优值的相反数。\n\nLP的约束可以构造成标准形式：\n1.  **目标函数**：对于求解器，我们最小化 $-c^\\top v$。\n2.  **等式约束**：稳态质量平衡 $S v = 0$。\n3.  **不等式约束**：蛋白质组资源分配 $a^\\top v \\le P$。\n4.  **通量边界**：$l \\le v \\le u$。\n\n**影子价格的计算**\n影子价格 $\\lambda_P$ 正式定义为最优目标函数 $\\phi(P)$ 相对于资源 $P$ 的偏导数：\n$$\n\\lambda_P = \\frac{\\partial \\phi(P)}{\\partial P}\n$$\n问题指定使用前向有限差分来近似这个导数：\n$$\n\\lambda_P \\approx \\frac{\\phi(P + \\Delta P) - \\phi(P)}{\\Delta P}\n$$\n其中 $\\Delta P$ 是一个小的正增量，固定为 $\\Delta P = 10^{-6}$。\n\n因此，我们的计算过程如下：\n1.  对于一个给定的测试用例，我们定义一个函数来求解相应的 LP。此函数以蛋白质组容量 $P_{val}$ 作为输入，返回最优目标值 $\\phi(P_{val})$。\n2.  在该函数内部，我们用 $P_{val}$ 设置不等式约束的右侧，并调用LP求解器。\n3.  我们首先通过调用该函数并传入原始的 $P$ 值来计算 $\\phi(P)$。\n4.  接着，我们再次调用该函数，传入 $P + \\Delta P$ 来计算 $\\phi(P + \\Delta P)$。\n5.  最后，我们使用上述有限差分公式计算影子价格的近似值。\n\n下面的Python代码实现了这一过程，为所提供的四个测试用例中的每一个执行计算，并按要求格式化输出结果。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Computes the shadow price of a proteome resource constraint in several\n    Flux Balance Analysis (FBA) models.\n    \"\"\"\n    \n    # Define the small increment for the finite difference calculation.\n    # Per the problem statement, delta_P is a fixed small positive number.\n    delta_P = 1e-6\n\n    # Test cases defined in the problem statement.\n    # Each tuple contains: (S, c, a, P, bounds)\n    test_cases = [\n        # Test Case 1\n        (\n            np.array([[1, -1]]),\n            np.array([0, 1]),\n            np.array([0.1, 0.2]),\n            1.0,\n            [(0, 10), (0, 100)]\n        ),\n        # Test Case 2\n        (\n            np.array([[1, -1]]),\n            np.array([0, 1]),\n            np.array([0.1, 0.2]),\n            100.0,\n            [(0, 10), (0, 100)]\n        ),\n        # Test Case 3\n        (\n            np.array([[1, -1, -1]]),\n            np.array([0, 1, 1]),\n            np.array([0.05, 0.3, 0.1]),\n            1.0,\n            [(0, 100), (0, 100), (0, 100)]\n        ),\n        # Test Case 4\n        (\n            np.array([[1, -1]]),\n            np.array([0, 1]),\n            np.array([0.2, 0.3]),\n            2.5,\n            [(0, 5), (0, 100)]\n        )\n    ]\n\n    def solve_fba(c_obj, A_eq, b_eq, A_ub, b_ub, bounds):\n        \"\"\"\n        Solves the LP for a given set of parameters.\n        Returns the optimal objective value of the maximization problem.\n        \"\"\"\n        # The solver performs minimization, so we provide -c to maximize c'v.\n        res = linprog(c_obj, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if res.success:\n            # The minimization returns the minimum of -c'v.\n            # The maximum of c'v is -res.fun.\n            return -res.fun\n        else:\n            # Handle cases where the solver might fail, though not expected for these problems.\n            return np.nan\n\n    def compute_shadow_price(S, c, a, P, bounds, dP):\n        \"\"\"\n        Calculates the shadow price for a single FBA model instance.\n        \"\"\"\n        # Objective function for the minimizer\n        c_obj = -c\n        \n        # Equality constraints (S*v = 0)\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n        \n        # Inequality constraint (a'*v = P)\n        A_ub = a.reshape(1, -1)\n        \n        # --- Solve for phi(P) ---\n        b_ub_P = np.array([P])\n        phi_P = solve_fba(c_obj, A_eq, b_eq, A_ub, b_ub_P, bounds)\n\n        # --- Solve for phi(P + dP) ---\n        b_ub_P_plus_dP = np.array([P + dP])\n        phi_P_plus_dP = solve_fba(c_obj, A_eq, b_eq, A_ub, b_ub_P_plus_dP, bounds)\n\n        # --- Compute forward finite difference ---\n        if np.isnan(phi_P) or np.isnan(phi_P_plus_dP):\n            return np.nan\n            \n        shadow_price = (phi_P_plus_dP - phi_P) / dP\n        return shadow_price\n\n    results = []\n    for case in test_cases:\n        S, c, a, P, bounds = case\n        lambda_P = compute_shadow_price(S, c, a, P, bounds, delta_P)\n        results.append(lambda_P)\n    \n    # Format the final output string exactly as required.\n    # The default string representation of floats is sufficient.\n    result_str = f\"[{','.join(map(str, results))}]\"\n    print(result_str)\n\nsolve()\n```", "id": "3303571"}]}