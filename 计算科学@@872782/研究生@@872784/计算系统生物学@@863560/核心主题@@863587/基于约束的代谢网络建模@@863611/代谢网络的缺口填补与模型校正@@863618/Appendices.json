{"hands_on_practices": [{"introduction": "任何可靠的代谢模型，其基石都是化学计量矩阵（$S$矩阵）。这个练习 [@problem_id:3312958] 将让你实践构建该矩阵，并执行最基本的验证步骤：检验质量与原子守恒。在进行更复杂的分析之前，确保模型遵守基本的物理法则是至关重要的一步，这为后续所有基于约束的分析提供了坚实的基础。", "problem": "您正在审校一个草稿阶段的全基因组尺度代谢子网络，并且必须验证其反应遵守原子和质量守恒定律，这是进行网络补洞决策的一个先决条件。请考虑以下带有区室和化学式的代谢物列表，其中 $[e]$ 表示胞外区室，$[c]$ 表示胞质区室。将不同区室中的相同化学物质视为不同的物质种类。\n\n- $\\mathrm{glc}[e]$ (葡萄糖，胞外): 化学式 $\\mathrm{C}_{6}\\mathrm{H}_{12}\\mathrm{O}_{6}$。\n- $\\mathrm{glc}[c]$ (葡萄糖，胞质): 化学式 $\\mathrm{C}_{6}\\mathrm{H}_{12}\\mathrm{O}_{6}$。\n- $\\mathrm{pi}[c]$ (无机磷酸盐，胞质): 化学式 $\\mathrm{H}_{1}\\mathrm{O}_{4}\\mathrm{P}_{1}$。\n- $\\mathrm{h2o}[c]$ (水，胞质): 化学式 $\\mathrm{H}_{2}\\mathrm{O}_{1}$。\n- $\\mathrm{g6p}[c]$ (6-磷酸葡萄糖，胞质): 化学式 $\\mathrm{C}_{6}\\mathrm{H}_{11}\\mathrm{O}_{9}\\mathrm{P}_{1}$。\n- $\\mathrm{h}[c]$ (质子，胞质): 化学式 $\\mathrm{H}_{1}$。\n- $\\mathrm{pyr}[c]$ (丙酮酸，胞质): 化学式 $\\mathrm{C}_{3}\\mathrm{H}_{3}\\mathrm{O}_{3}$。\n- $\\mathrm{lac}[c]$ (乳酸，胞质): 化学式 $\\mathrm{C}_{3}\\mathrm{H}_{5}\\mathrm{O}_{3}$。\n- $\\mathrm{co2}[c]$ (二氧化碳，胞质): 化学式 $\\mathrm{C}_{1}\\mathrm{O}_{2}$。\n\n该草稿网络包含以下反应，以整数化学计量系数列出。生成物在右侧，消耗物在左侧。\n\n- $R_{1}: \\ \\mathrm{glc}[e] \\rightarrow \\mathrm{glc}[c]$。\n- $R_{2}: \\ \\mathrm{glc}[c] + \\mathrm{pi}[c] \\rightarrow \\mathrm{g6p}[c] + \\mathrm{h2o}[c]$。\n- $R_{3}: \\ \\mathrm{g6p}[c] + \\mathrm{h2o}[c] \\rightarrow \\mathrm{glc}[c] + \\mathrm{pi}[c]$。\n- $R_{4}: \\ \\mathrm{pyr}[c] + 2 \\ \\mathrm{h}[c] \\rightarrow \\mathrm{lac}[c]$。\n- $R_{5}: \\ \\mathrm{pyr}[c] \\rightarrow \\mathrm{lac}[c] + \\mathrm{co2}[c]$。\n- $R_{6}: \\ \\mathrm{glc}[e] \\rightarrow \\varnothing$ (葡萄糖交换至边界池)。\n\n任务：\n\n1. 使用反应物系数为负、产物系数为正的符号约定，构建化学计量矩阵 $ S $，其行按 $ [ \\mathrm{glc}[e], \\mathrm{glc}[c], \\mathrm{pi}[c], \\mathrm{h2o}[c], \\mathrm{g6p}[c], \\mathrm{h}[c], \\mathrm{pyr}[c], \\mathrm{lac}[c], \\mathrm{co2}[c] ] $ 的顺序排列，列按 $ [ R_{1}, R_{2}, R_{3}, R_{4}, R_{5}, R_{6} ] $ 的顺序排列。\n\n2. 运用原子守恒定律和化学计量矩阵的定义，通过比较左侧与右侧的 $ \\mathrm{C} $、$ \\mathrm{H} $、$ \\mathrm{O} $ 和 $ \\mathrm{P} $ 的总数，来验证每个内部反应的元素平衡。将 $ R_{6} $ 视为边界交换（不将其包含在内部平衡验证中）。\n\n3. 设原子量用符号 $ w_{\\mathrm{C}} $、$ w_{\\mathrm{H}} $、$ w_{\\mathrm{O}} $ 和 $ w_{\\mathrm{P}} $ 表示，且每个 $ w_{\\alpha} > 0 $。使用这些权重和元素计数，为那些原子平衡的反应证明其质量是平衡的，并检测出任何原子不平衡反应的质量不平衡。\n\n4. 设 $ k $ 为 $ \\{ R_{1}, R_{2}, R_{3}, R_{4}, R_{5} \\} $ 中原子不平衡的反应数量。报告 $ k $ 的值。最终答案必须是单个整数。无需四舍五入，也无需单位。", "solution": "我们从基于约束的建模中使用的定义以及质量和原子守恒定律开始。\n\n- 化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 编码了反应的化学计量学，其中 $m$ 种代谢物为行，$n$ 个反应为列。对于反应 $j$，如果代谢物 $i$ 被消耗，其化学计量系数 $S_{ij}$ 为负；如果被生成，则为正。\n\n- 对于反应中的一个元素 $\\alpha \\in \\{ \\mathrm{C}, \\mathrm{H}, \\mathrm{O}, \\mathrm{P} \\}$，原子平衡要求左侧的 $\\alpha$ 原子总数等于右侧的原子总数。这源于原子守恒定律。\n\n- 如果每个元素都守恒且原子量 $w_{\\alpha}$ 是正常数，则质量是守恒的，因为总质量是守恒的原子数与正常数权重的线性组合。\n\n第 1 步：构建化学计量矩阵 $S$。\n\n我们遵循代谢物顺序 $ [ \\mathrm{glc}[e], \\mathrm{glc}[c], \\mathrm{pi}[c], \\mathrm{h2o}[c], \\mathrm{g6p}[c], \\mathrm{h}[c], \\mathrm{pyr}[c], \\mathrm{lac}[c], \\mathrm{co2}[c] ] $ 和反应顺序 $ [ R_{1}, R_{2}, R_{3}, R_{4}, R_{5}, R_{6} ] $。我们将每个反应转换为列条目：\n\n- $R_{1}: \\ \\mathrm{glc}[e] \\rightarrow \\mathrm{glc}[c]$ 得到 $S_{\\mathrm{glc}[e],R_{1}} = -1$，$S_{\\mathrm{glc}[c],R_{1}} = +1$，其余均为 $0$。\n\n- $R_{2}: \\ \\mathrm{glc}[c] + \\mathrm{pi}[c] \\rightarrow \\mathrm{g6p}[c] + \\mathrm{h2o}[c]$ 得到 $S_{\\mathrm{glc}[c],R_{2}} = -1$，$S_{\\mathrm{pi}[c],R_{2}} = -1$，$S_{\\mathrm{g6p}[c],R_{2}} = +1$，$S_{\\mathrm{h2o}[c],R_{2}} = +1$，其余均为 $0$。\n\n- $R_{3}: \\ \\mathrm{g6p}[c] + \\mathrm{h2o}[c] \\rightarrow \\mathrm{glc}[c] + \\mathrm{pi}[c]$ 得到 $S_{\\mathrm{g6p}[c],R_{3}} = -1$，$S_{\\mathrm{h2o}[c],R_{3}} = -1$，$S_{\\mathrm{glc}[c],R_{3}} = +1$，$S_{\\mathrm{pi}[c],R_{3}} = +1$，其余均为 $0$。\n\n- $R_{4}: \\ \\mathrm{pyr}[c] + 2 \\ \\mathrm{h}[c] \\rightarrow \\mathrm{lac}[c]$ 得到 $S_{\\mathrm{pyr}[c],R_{4}} = -1$，$S_{\\mathrm{h}[c],R_{4}} = -2$，$S_{\\mathrm{lac}[c],R_{4}} = +1$，其余均为 $0$。\n\n- $R_{5}: \\ \\mathrm{pyr}[c] \\rightarrow \\mathrm{lac}[c] + \\mathrm{co2}[c]$ 得到 $S_{\\mathrm{pyr}[c],R_{5}} = -1$，$S_{\\mathrm{lac}[c],R_{5}} = +1$，$S_{\\mathrm{co2}[c],R_{5}} = +1$，其余均为 $0$。\n\n- $R_{6}: \\ \\mathrm{glc}[e] \\rightarrow \\varnothing$ 得到 $S_{\\mathrm{glc}[e],R_{6}} = -1$，其余均为 $0$。\n\n因此，\n$$\nS =\n\\begin{pmatrix}\n-1  0  0  0  0  -1 \\\\\n+1  -1  +1  0  0  0 \\\\\n0  -1  +1  0  0  0 \\\\\n0  +1  -1  0  0  0 \\\\\n0  +1  -1  0  0  0 \\\\\n0  0  0  -2  0  0 \\\\\n0  0  0  -1  -1  0 \\\\\n0  0  0  +1  +1  0 \\\\\n0  0  0  0  +1  0\n\\end{pmatrix}\n$$\n其中行对应于 $ [ \\mathrm{glc}[e], \\mathrm{glc}[c], \\mathrm{pi}[c], \\mathrm{h2o}[c], \\mathrm{g6p}[c], \\mathrm{h}[c], \\mathrm{pyr}[c], \\mathrm{lac}[c], \\mathrm{co2}[c] ] $，列对应于 $ [ R_{1}, R_{2}, R_{3}, R_{4}, R_{5}, R_{6} ] $。\n\n第 2 步：验证内部反应 $R_{1}$ 至 $R_{5}$ 的元素平衡。\n\n我们使用以下化学式：\n\n- $\\mathrm{glc}$: $\\mathrm{C}_{6}\\mathrm{H}_{12}\\mathrm{O}_{6}$。\n- $\\mathrm{pi}$: $\\mathrm{H}_{1}\\mathrm{O}_{4}\\mathrm{P}_{1}$。\n- $\\mathrm{h2o}$: $\\mathrm{H}_{2}\\mathrm{O}_{1}$。\n- $\\mathrm{g6p}$: $\\mathrm{C}_{6}\\mathrm{H}_{11}\\mathrm{O}_{9}\\mathrm{P}_{1}$。\n- $\\mathrm{h}$: $\\mathrm{H}_{1}$。\n- $\\mathrm{pyr}$: $\\mathrm{C}_{3}\\mathrm{H}_{3}\\mathrm{O}_{3}$。\n- $\\mathrm{lac}$: $\\mathrm{C}_{3}\\mathrm{H}_{5}\\mathrm{O}_{3}$。\n- $\\mathrm{co2}$: $\\mathrm{C}_{1}\\mathrm{O}_{2}$。\n\n对于每个反应，我们计算左侧（LHS）和右侧（RHS）的总元素计数：\n\n- $R_{1}: \\ \\mathrm{glc}[e] \\rightarrow \\mathrm{glc}[c]$。LHS 元素：$(\\mathrm{C}, \\mathrm{H}, \\mathrm{O}, \\mathrm{P}) = (6, 12, 6, 0)$。RHS：$(6, 12, 6, 0)$。对所有列出的元素均平衡。\n\n- $R_{2}: \\ \\mathrm{glc}[c] + \\mathrm{pi}[c] \\rightarrow \\mathrm{g6p}[c] + \\mathrm{h2o}[c]$。LHS：$(6, 12, 6, 0) + (0, 1, 4, 1) = (6, 13, 10, 1)$。RHS：$(6, 11, 9, 1) + (0, 2, 1, 0) = (6, 13, 10, 1)$。平衡。\n\n- $R_{3}: \\ \\mathrm{g6p}[c] + \\mathrm{h2o}[c] \\rightarrow \\mathrm{glc}[c] + \\mathrm{pi}[c]$。LHS：$(6, 11, 9, 1) + (0, 2, 1, 0) = (6, 13, 10, 1)$。RHS：$(6, 12, 6, 0) + (0, 1, 4, 1) = (6, 13, 10, 1)$。平衡。\n\n- $R_{4}: \\ \\mathrm{pyr}[c] + 2 \\ \\mathrm{h}[c] \\rightarrow \\mathrm{lac}[c]$。LHS：$(3, 3, 3, 0) + 2 \\times (0, 1, 0, 0) = (3, 5, 3, 0)$。RHS：$(3, 5, 3, 0)$。平衡。\n\n- $R_{5}: \\ \\mathrm{pyr}[c] \\rightarrow \\mathrm{lac}[c] + \\mathrm{co2}[c]$。LHS：$(3, 3, 3, 0)$。RHS：$(3, 5, 3, 0) + (1, 0, 2, 0) = (4, 5, 5, 0)$。不平衡：RHS 减去 LHS 的差值为 $(\\Delta \\mathrm{C}, \\Delta \\mathrm{H}, \\Delta \\mathrm{O}, \\Delta \\mathrm{P}) = (1, 2, 2, 0) \\neq (0, 0, 0, 0)$。\n\n因此，在内部反应 $R_{1}$ 到 $R_{5}$ 中，只有 $R_{5}$ 是原子不平衡的。\n\n第 3 步：使用原子量验证质量平衡。\n\n设 $w_{\\mathrm{C}}, w_{\\mathrm{H}}, w_{\\mathrm{O}}, w_{\\mathrm{P}} > 0$ 分别是碳、氢、氧和磷的原子量。对于一个反应，用 $\\nu_{\\alpha}^{\\mathrm{LHS}}$ 和 $\\nu_{\\alpha}^{\\mathrm{RHS}}$ 表示左右两侧元素 $\\alpha$ 的总数。每侧的质量为\n$$\nM_{\\mathrm{LHS}} = \\sum_{\\alpha \\in \\{\\mathrm{C},\\mathrm{H},\\mathrm{O},\\mathrm{P}\\}} w_{\\alpha} \\, \\nu_{\\alpha}^{\\mathrm{LHS}}, \n\\quad\nM_{\\mathrm{RHS}} = \\sum_{\\alpha \\in \\{\\mathrm{C},\\mathrm{H},\\mathrm{O},\\mathrm{P}\\}} w_{\\alpha} \\, \\nu_{\\alpha}^{\\mathrm{RHS}}.\n$$\n如果一个反应是原子平衡的，那么对于每个 $\\alpha$，我们有 $\\nu_{\\alpha}^{\\mathrm{LHS}} = \\nu_{\\alpha}^{\\mathrm{RHS}}$，因此根据线性关系，$M_{\\mathrm{LHS}} = M_{\\mathrm{RHS}}$。这适用于 $R_{1}, R_{2}, R_{3}, R_{4}$，从而证实了质量平衡。\n\n对于 $R_{5}$，元素计数的净变化为 $(\\Delta \\mathrm{C}, \\Delta \\mathrm{H}, \\Delta \\mathrm{O}, \\Delta \\mathrm{P}) = (1, 2, 2, 0)$。质量差（RHS 减去 LHS）是\n$$\n\\Delta M = w_{\\mathrm{C}} \\cdot 1 + w_{\\mathrm{H}} \\cdot 2 + w_{\\mathrm{O}} \\cdot 2 + w_{\\mathrm{P}} \\cdot 0 = w_{\\mathrm{C}} + 2 w_{\\mathrm{H}} + 2 w_{\\mathrm{O}}.\n$$\n由于 $w_{\\mathrm{C}}, w_{\\mathrm{H}}, w_{\\mathrm{O}} > 0$，因此 $\\Delta M > 0$，所以 $R_{5}$ 不是质量平衡的。这与上面发现的原子不平衡是一致的。\n\n第 4 步：报告 $\\{ R_{1}, R_{2}, R_{3}, R_{4}, R_{5} \\}$ 中原子不平衡的反应数量 $k$。\n\n根据第 2 步，只有一个反应（$R_{5}$）是不平衡的，因此 $k = 1$。", "answer": "$$\\boxed{1}$$", "id": "3312958"}, {"introduction": "在确保单个反应的平衡后，下一步是检查网络层面的不一致性。这个实践 [@problem_id:3312950] 解决了一个在草稿模型中常见且关键的问题：伪能量生成循环，这种循环违反了热力学定律，允许模型在没有底物输入的情况下无限产生能量。你将学习如何使用流平衡分析来检测这些不可行的循环，并提出修复模型的策略，这是模型校正中的一项关键技能。", "problem": "给定三个以化学计量矩阵表示的小型代谢网络草图，它们处于稳态假设下，适用流通平衡分析。目标是通过证明在稳态下存在不依赖于生长的ATP生产，来检测一个伪三磷酸腺苷 (ATP) 生成循环，并提出修正步骤以打破该循环。\n\n基本原理和定义：\n- 在稳态下，细胞内代谢物浓度恒定，这意味着存在质量平衡约束 $S \\, v = 0$，其中 $S$ 是化学计量矩阵，$v$ 是流通向量。\n- 每个反应 $j$ 都有上下界 $l_j \\le v_j \\le u_j$，用于编码不可逆性和容量。\n- 可逆反应的 $l_j  0$ 且 $u_j > 0$。不可逆正向反应的 $l_j = 0$ 且 $u_j > 0$。\n- 交换反应是关闭的，因此不允许净吸收；所提供的网络不包含显式的交换反应。\n- 能量生成循环的检测标准是，在没有任何底物吸收的情况下，存在一个满足 $S v = 0$ 和边界条件的可行稳态流通向量 $v$，并且通过ATP合成反应（记为 $v_{\\mathrm{ATPS}}$）的流通为正值。如果在所有交换反应关闭的稳态下 $\\max v_{\\mathrm{ATPS}} > 0$，这表明存在一个伪ATP生成循环。\n- 流通值的单位是毫摩尔每克干重每小时 $\\left(\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}\\right)$。所有流通均应以此单位的实数报告。\n\n你的程序必须：\n- 对每个测试网络，求解在线性约束 $S v = 0$ 和 $l \\le v \\le u$ 下最大化 $v_{\\mathrm{ATPS}}$ 的线性规划问题。当且仅当最优目标值严格大于一个小的非负容差 $\\epsilon$（其中 $\\epsilon = 10^{-9}$）时，声明检测到伪ATP生成循环。\n- 提出一个最小修正步骤来打破循环，即找到一个基数最小的反应集合进行阻断（将这些反应的 $v_j$ 设为 $0$），使得在相同约束下，最大 $v_{\\mathrm{ATPS}}$ 变为零（在容差 $\\epsilon$ 范围内）。如果存在多个基数最小的集合，选择反应索引（从零开始）字典序最小的那个集合。\n- 对于未检测到循环的网络（即最优目标值最多为 $\\epsilon$），推荐的修正集为空列表。\n\n测试套件：\n- 所有案例的代谢物顺序固定为 $\\left[\\mathrm{ATP}, \\mathrm{ADP}, \\mathrm{Pi}, \\mathrm{H^+}, \\mathrm{H_2O}\\right]$。\n- 反应顺序是特定于案例的，如下所列。所有给定的数值条目必须按字面值处理。\n\n案例 A（存在伪ATP生成循环）：\n- 反应：\n  - 反应 $0$（ATP 合成酶，错误地可逆）：$\\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H^+} \\leftrightarrow \\mathrm{ATP} + \\mathrm{H_2O}$。\n  - 反应 $1$（ATP 维持需求）：$\\mathrm{ATP} + \\mathrm{H_2O} \\rightarrow \\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H^+}$。\n- 化学计量矩阵 $S \\in \\mathbb{R}^{5 \\times 2}$，其中第 $j$ 列等于反应 $j$ 的化学计量系数：\n  - $S_{\\cdot,0} = \\begin{bmatrix} +1 \\\\ -1 \\\\ -1 \\\\ -1 \\\\ +1 \\end{bmatrix}$，\n  - $S_{\\cdot,1} = \\begin{bmatrix} -1 \\\\ +1 \\\\ +1 \\\\ +1 \\\\ -1 \\end{bmatrix}$。\n- 边界：\n  - $l_0 = -1000$， $u_0 = +1000$，\n  - $l_1 = 0$， $u_1 = +1000$。\n- 目标：最大化 $v_0$。\n\n案例 B（通过强制不可逆性来修正，以防止ATP生成）：\n- 与案例 A 相同的 $S$。\n- 边界：\n  - $l_0 = -1000$， $u_0 = 0$，\n  - $l_1 = 0$， $u_1 = +1000$。\n- 目标：最大化 $v_0$。\n\n案例 C（通过校正质子化学计量来修正，以防止质子平衡循环）：\n- 反应：\n  - 反应 $0$（ATP 合成酶，无质子作为底物）：$\\mathrm{ADP} + \\mathrm{Pi} \\leftrightarrow \\mathrm{ATP} + \\mathrm{H_2O}$。\n  - 反应 $1$（ATP 维持需求）：$\\mathrm{ATP} + \\mathrm{H_2O} \\rightarrow \\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H^+}$。\n- 化学计量矩阵 $S \\in \\mathbb{R}^{5 \\times 2}$：\n  - $S_{\\cdot,0} = \\begin{bmatrix} +1 \\\\ -1 \\\\ -1 \\\\ 0 \\\\ +1 \\end{bmatrix}$，\n  - $S_{\\cdot,1} = \\begin{bmatrix} -1 \\\\ +1 \\\\ +1 \\\\ +1 \\\\ -1 \\end{bmatrix}$。\n- 边界：\n  - $l_0 = -1000$， $u_0 = +1000$，\n  - $l_1 = 0$， $u_1 = +1000$。\n- 目标：最大化 $v_0$。\n\n计算和数值要求：\n- 使用线性规划求解器来找到每个案例的最优目标值。\n- 使用 $\\epsilon = 10^{-9}$ 的容差来判断最优目标值的正负，并决定修正后的网络是否消除了循环。\n- 最小修正步骤的搜索应考虑通过设置 $v_j = 0$ 来阻断反应，并应返回足以将最优目标值降低到至多 $\\epsilon$ 的最小反应索引集。如果最初未检测到循环，则返回空集。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于 $\\left[\\text{案例 A}, \\text{案例 B}, \\text{案例 C}\\right]$ 顺序中的每个案例，输出一个包含三个条目的列表：循环检测布尔值、作为浮点数的最优目标值，以及作为整数列表的最小修正集。例如，形如 $\\left[\\left[\\text{True}, 1.0, [0]\\right], \\left[\\text{False}, 0.0, []\\right], \\left[\\text{False}, 0.0, []\\right]\\right]$ 的输出是有效的。", "solution": "该问题要求使用流通平衡分析（FBA）在简化的代谢网络中检测和修正伪能量生成循环。在稳态假设下，FBA 的核心原理是质量平衡约束 $S v = 0$，其中 $S$ 是化学计量矩阵，$v$ 是反应流通向量。每个流通 $v_j$ 还受到上下界 $l_j \\le v_j \\le u_j$ 的约束。\n\n如果可以在没有任何净底物吸收的情况下产生三磷酸腺苷（ATP），则存在一个伪ATP生成循环。这对应于找到一个可行的流通分布 $v$，它满足 $S v = 0$，遵守流通边界 $l \\le v \\le u$，并通过 ATP 合成反应（记为 $v_{\\mathrm{ATPS}}$）实现正流通。我们将此检测形式化为一个线性规划（LP）问题。对于给定案例，ATP 合成反应是反应 0，因此我们最大化 $v_0$：\n$$ \\begin{align*} \\text{maximize} \\quad  v_{0} \\\\ \\text{subject to} \\quad  S v = 0 \\\\  l_j \\le v_j \\le u_j \\quad \\forall j \\end{align*} $$\n如果最优目标值严格大于数值容差 $\\epsilon = 10^{-9}$，则检测到循环。\n\n如果检测到循环，修正过程涉及识别一个最小反应集进行阻断（通过将其流通 $v_j$ 设置为 $0$），使得修改后网络中的最大 $v_{0}$ 减小到 $0$（即 $\\le \\epsilon$）。寻找最小修正集的过程是通过组合测试要阻断的反应集来进行的，从基数 $k=1$ 开始，然后是 $k=2$，依此类推。对于给定的基数，按反应索引的字典序测试集合，以确保解的唯一性。此过程找到的第一个有效修正集即为所需答案。\n\n我们现在使用此框架分析每个案例。\n\n**案例 A：**\n化学计量矩阵为 $S_A = \\begin{bmatrix} 1  -1 \\\\ -1  1 \\\\ -1  1 \\\\ -1  1 \\\\ 1  -1 \\end{bmatrix}$。第二列是第一列的负数，$S_{\\cdot,1} = -S_{\\cdot,0}$。质量平衡约束 $S v = 0$ 展开为 $S_{\\cdot,0} v_0 + S_{\\cdot,1} v_1 = 0$，可简化为 $S_{\\cdot,0} v_0 - S_{\\cdot,0} v_1 = S_{\\cdot,0}(v_0 - v_1) = 0$。由于 $S_{\\cdot,0}$ 是一个非零向量，这意味着标量约束 $v_0 - v_1 = 0$，即 $v_0 = v_1$。\n\n流通边界为：\n- 反应 $0$：$-1000 \\le v_0 \\le 1000$\n- 反应 $1$：$0 \\le v_1 \\le 1000$\n\n将约束 $v_0 = v_1$ 与 $v_1$ 的边界结合，得到约束 $0 \\le v_0 \\le 1000$。$v_0$ 的可行域是其自身边界与此派生约束的交集，即 $[0, 1000]$。目标是最大化 $v_0$。因此最优值为 $\\max v_0 = 1000$。\n由于 $1000 > 10^{-9}$，检测到一个伪ATP生成循环。\n\n对于修正，我们搜索要阻断的最小反应集。\n- **基数 $k=1$**：\n  - 测试阻断反应 $0$：我们设置 $v_0 = 0$。约束 $v_0 = v_1$ 意味着 $v_1 = 0$。新的 LP 在约束 $v_0=0$ 下寻求最大化 $v_0$，得到最优值为 $0$。由于 $0 \\le \\epsilon$，阻断反应 $0$ 是一个有效的修正。索引集为 $\\{0\\}$。\n  - 因为我们找到了一个大小为 $1$ 的有效修正集，并且它是按字典序测试的第一个，所以 $\\{0\\}$ 是最小修正集。\n\n案例 A 的结果：检测到循环为 True，最优值为 $1000.0$，修正集为 $[0]$。\n\n**案例 B：**\n化学计量矩阵与案例 A 相同，因此约束 $v_0 = v_1$ 仍然成立。\n流通边界不同：\n- 反应 $0$：$-1000 \\le v_0 \\le 0$\n- 反应 $1$：$0 \\le v_1 \\le 1000$\n\n将 $v_0 = v_1$ 代入 $v_1$ 的边界，得到 $0 \\le v_0 \\le 1000$。$v_0$ 的可行域是其直接边界（$-1000 \\le v_0 \\le 0$）和派生边界（$0 \\le v_0 \\le 1000$）的交集。同时满足 $v_0 \\le 0$ 和 $v_0 \\ge 0$ 的唯一值是 $v_0=0$。\n目标是最大化 $v_0$。唯一的可行值为 $0$，因此最优值为 $\\max v_0 = 0$。\n由于 $0 \\le 10^{-9}$，未检测到伪循环。修正集为空。\n\n案例 B 的结果：检测到循环为 False，最优值为 $0.0$，修正集为 []。\n\n**案例 C：**\n化学计量矩阵为 $S_C = \\begin{bmatrix} 1  -1 \\\\ -1  1 \\\\ -1  1 \\\\ 0  1 \\\\ 1  -1 \\end{bmatrix}$。线性方程组 $S_C v = 0$ 是：\n$v_0 - v_1 = 0$\n$-v_0 + v_1 = 0$\n$-v_0 + v_1 = 0$\n$0 \\cdot v_0 + 1 \\cdot v_1 = 0 \\implies v_1 = 0$\n$v_0 - v_1 = 0$\n\n从这些方程的一个子集中，我们发现 $v_1 = 0$ 和 $v_0 = v_1$，这强制得到唯一解 $v_0 = 0$ 和 $v_1 = 0$。该解 $(0, 0)$ 是可行的，因为它满足给定的边界（$-1000 \\le 0 \\le 1000$ 和 $0 \\le 0 \\le 1000$）。\n由于唯一的可行流通向量是 $(0, 0)$，最大化 $v_0$ 的目标的最优值为 $0$。\n由于 $0 \\le 10^{-9}$，未检测到伪循环。修正集为空。\n\n案例 C 的结果：检测到循环为 False，最优值为 $0.0$，修正集为 []。", "answer": "[[True, 1000.0, [0]], [False, 0.0, []], [False, 0.0, []]]", "id": "3312950"}, {"introduction": "当模型经过基本正确性校正后，它可能仍然不完整，无法模拟已知的生物学功能，如细胞生长。这个练习 [@problem_id:3312957] 将指导你完成缺口填补（gap-filling）的过程，这是一个核心的建模任务。你将使用流平衡分析和系统性搜索的方法，来识别并添加恢复模型关键功能（即生物质生产）所需的最小反应集合，这模拟了完善代谢重建草稿的核心工作流程。", "problem": "给定一个小型稳态代谢网络，您需要执行流平衡分析 (FBA) 来计算一个最优通量分布，该分布在满足质量平衡约束和通量边界的同时最大化生物质。如有必要，您还必须通过添加一个最小候选反应集来执行缺口填充 (gap-filling)，以使目标生物质产量超过给定阈值。此任务的基础是稳态下的化学计量质量平衡，它要求 $S v = 0$，其中 $S$ 是化学计量矩阵，$v$ 是通量向量，同时还需满足反应通量边界 $l \\le v \\le u$。流平衡分析 (FBA) 是一种线性优化方法，在这些约束条件下最大化生物质通量；而缺口填充是在这些约束条件下通过添加反应来恢复模型功能的过程。\n\n定义与假设：\n- 化学计量矩阵 $S$ 的行对应内部代谢物，列对应反应。每个反应列包含代谢物的化学计量系数，消耗为负，生产为正。\n- 代谢物摄取的交换反应表示为列向量，其中内部代谢物具有负的化学计量系数（例如，$EX\\_A$ 中代谢物 $A$ 的系数为 $-1$，其他为 $0$），通量边界设置为允许摄取为负通量：下界 $ 0$ 且上界 $= 0$。\n- 生物质反应表示为一个消耗生物质前体的列向量。对于下面的玩具网络，生物质反应消耗代谢物 $C$，其化学计量系数为 $-1$。\n- 所有通量必须以毫摩尔/克干重/小时为单位表示，缩写为 $mmol\\,gDW^{-1}\\,h^{-1}$。您的输出应四舍五入到四位小数。\n- 反应索引请使用基于 $0$ 的索引。\n\n您必须实现一个程序，对每个测试用例执行以下操作：\n1. 通过添加最少数量的候选反应（如果需要）来执行缺口填充，以实现超过阈值 $\\tau$ 的生物质产量。\n2. 使用线性规划，在 $S v = 0$ 和边界 $l \\le v \\le u$ 的约束下，通过最大化生物质反应通量来计算最优通量分布 $v^\\*$。\n3. 验证并返回布尔值，指示 $S v^\\* = 0$ 是否在容差范围内满足，以及边界约束是否被满足。\n4. 为每个测试用例返回一个包含四个条目的列表：最优生物质通量（四舍五入到四位小数，单位为 $mmol\\,gDW^{-1}\\,h^{-1}$）、一个表示质量平衡一致性的布尔值、一个表示边界一致性的布尔值，以及添加的候选反应索引列表（使用基于 $0$ 的索引）。\n\n测试套件规范：\n所有代谢物均为 $A$、$B$、$C$（三种内部代谢物）。对于每个案例，基础网络包含一个具有指定化学计量和边界的反应子集。在缺口填充期间可以添加候选反应。生物质反应索引始终是每个测试用例中最后一个基础反应的索引。\n\n- 案例 $1$（已功能正常的网络）：\n  - 基础反应（$S$ 的列）和边界：\n    - $EX\\_A$：化学计量 `[-1, 0, 0]`，边界 `[-3, 0]`。\n    - $R1$：化学计量 `[-1, +1, 0]`，边界 `[0, 1000]`。\n    - $R2$：化学计量 `[0, -1, +1]`，边界 `[0, 1000]`。\n    - $Biomass$：化学计量 `[0, 0, -1]`，边界 `[0, 1000]`。\n  - 候选反应：\n    - $R\\_{alt}$：化学计量 `[-1, 0, +1]`，边界 `[0, 1000]`。\n  - 生物质反应索引：$3$。\n  - 阈值 $\\tau$：$2.0$。\n\n- 案例 $2$（缺少一个必须添加的反应）：\n  - 基础反应：\n    - $EX\\_A$：`[-1, 0, 0]`，边界 `[-2, 0]`。\n    - $R1$：`[-1, +1, 0]`，边界 `[0, 1000]`。\n    - $Biomass$：`[0, 0, -1]`，边界 `[0, 1000]`。\n  - 候选反应：\n    - $R2$：`[0, -1, +1]`，边界 `[0, 1000]`。\n  - 生物质反应索引：$2$。\n  - 阈值 $\\tau$：$1.5$。\n\n- 案例 $3$（需要添加两个反应）：\n  - 基础反应：\n    - $EX\\_A$：`[-1, 0, 0]`，边界 `[-1.5, 0]`。\n    - $Biomass$：`[0, 0, -1]`，边界 `[0, 1000]`。\n  - 候选反应：\n    - $R1$：`[-1, +1, 0]`，边界 `[0, 1000]`。\n    - $R2$：`[0, -1, +1]`，边界 `[0, 1000]`。\n  - 生物质反应索引：$1$。\n  - 阈值 $\\tau$：$1.0$。\n\n- 案例 $4$（边界情况，不允许摄取；无法生长）：\n  - 基础反应：\n    - $EX\\_A$：`[-1, 0, 0]`，边界 `[0, 0]`。\n    - $R1$：`[-1, +1, 0]`，边界 `[0, 1000]`。\n    - $R2$：`[0, -1, +1]`，边界 `[0, 1000]`。\n    - $Biomass$：`[0, 0, -1]`，边界 `[0, 1000]`。\n  - 候选反应：无。\n  - 生物质反应索引：$3$。\n  - 阈值 $\\tau$：$0.1$。\n\n算法要求：\n- 将 FBA 构建为一个线性规划问题，在 $S v = 0$ 和 $l \\le v \\le u$ 的约束下最大化生物质通量。除了线性规划，您不能使用任何捷径，并且必须确保数值稳定性。\n- 对于缺口填充，按基数递增的顺序搜索候选反应的子集，以找到能使最优生物质通量严格大于阈值 $\\tau$ 的最小集合。如果多个相同基数的子集满足阈值，选择能产生最高最优生物质通量的那个。如果没有子集满足阈值，则选择空子集并仅为基础网络计算最优通量分布。\n- 通过计算质量平衡残差的无穷范数 $||S v^\\*||_\\infty$ 并检查其是否低于 $10^{-8}$ 的容差来验证与约束的一致性。同时验证所有边界是否在 $10^{-8}$ 的容差内得到满足。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身也编码为一个列表：$[biomass,mb\\_ok,bounds\\_ok,[added\\_indices]]$。例如：$[[3.0000,True,True,[]],[2.0000,True,True,[0]],...]$。所有通量值必须以 $mmol\\,gDW^{-1}\\,h^{-1}$ 为单位，并四舍五入到四位小数。布尔值必须是精确的逻辑值。添加的索引列表必须使用基于 $0$ 的索引。", "solution": "该问题要求实现计算系统生物学中的两个基本算法：流平衡分析 (FBA) 和模型缺口填充。目标是确定给定网络的最优代谢通量分布，以最大化生物质产量，这可能需要在满足指定产量阈值的前提下，从候选池中选取一个最小反应集来扩增网络。\n\n### 原理 1：质量平衡与稳态\n\nFBA 的核心是质量守恒原理。对于一个在稳态下运行的代谢网络，每种内部代谢物的浓度保持不变。这意味着对于每种代谢物，其总生产速率必须等于总消耗速率。这个约束可以用一个线性方程组来数学化地表示：\n$$\nS v = 0\n$$\n其中 $S$ 是大小为 $m \\times n$（$m$ 种代谢物，$n$ 个反应）的化学计量矩阵，$v$ 是大小为 $n \\times 1$ 的反应通量（速率）向量。矩阵中的每个条目 $S_{ij}$ 代表代谢物 $i$ 在反应 $j$ 中的化学计量系数。按照惯例，负系数（$S_{ij}  0$）表示消耗，正系数（$S_{ij} > 0$）表示生产。向量方程 $S v = 0$ 确保了任何内部代谢物都没有净积累或净消耗。\n\n### 原理 2：作为线性规划的流平衡分析 (FBA)\n\n虽然稳态假设限制了可能的通量分布，但它通常不能定义一个唯一的解。满足 $S v = 0$ 的可行通量向量空间受到热力学和容量限制的进一步约束，这些约束表示为单个通量的下界和上界：\n$$\nl \\le v \\le u\n$$\n其中 $l$ 和 $u$ 分别是下界和上界的向量。例如，一个不可逆反应的下界为 $0$。一个允许从环境中摄取营养物的交换反应将具有一个负的下界（例如，$v_{uptake} \\in [-10, 0]$）。\n\nFBA 使用线性规划 (LP) 从可行集中找到一个特定的、具有生物学意义的通量分布。这是通过优化一个目标函数来实现的，该目标函数通常是“生物质反应”的通量。这个反应是一个建模构造，通过消耗实验测量得出的比例的前体代谢物来模拟细胞生物质的产生。最大化其通量被假定等同于最大化生物体的生长速率。\n\n因此，FBA 问题被构建为以下 LP：\n$$\n\\begin{align*}\n\\text{maximize} \\quad  c^T v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u\n\\end{align*}\n$$\n此处，$c$ 是目标向量，它在对应于生物质反应的位置上为 $1$，在其他位置上为 $0$。\n\n### 原理 3：模型缺口填充\n\n从基因组数据重建的代谢网络通常是不完整的，含有“缺口”（缺失的反应），这会阻止模型模拟已知的生物学功能，例如生产生物质。缺口填充是一个计算过程，旨在从一个通用数据库（或指定的候选池）中识别一个最小的反应集，并将其添加到模型中以恢复所需的功能。\n\n这个问题可以被构建为一个组合优化问题。我们寻求候选反应的最小子集，当添加到基础模型中时，能使生物质通量超过给定的阈值 $\\tau$。问题中指定的算法方法是一种基于简约性（最小性）原则的系统性搜索：\n\n1.  从 $k=0$ 开始，对添加的反应集的基数 $k$ 进行搜索。\n2.  对于给定的 $k$，测试候选池中所有可能的 $k$ 个反应的组合。\n3.  对于每种组合，用所选反应扩增基础模型，并执行 FBA 计算最大生物质通量。\n4.  如果任何组合产生的生物质通量超过 $\\tau$，则 $k$ 是最小基数。搜索停止，在所有大小为 $k$ 的成功组合中，选择产生最高生物质通量的那个。\n5.  如果对于任何 $k$，都没有组合满足条件，则使用原始的、未扩增的基础模型。\n\n### 算法实现\n\n该解决方案通过将这些原理组合成一个连贯的算法来实现。\n\n1.  **FBA 求解器**：创建一个核心函数来求解 FBA 线性规划问题。它接收化学计量矩阵 $S$、边界向量 $l$ 和 $u$ 以及生物质反应的索引作为输入。使用 `scipy.optimize.linprog` 库函数，它构建并求解该 LP 问题。目标函数设置为最小化 $-v_{biomass}$ 以实现最大化。该函数返回最优生物质通量和相应的完整通量向量 $v^*$。\n\n2.  **缺口填充程序**：对每个测试用例执行缺口填充逻辑。\n    - 该算法首先分析基础网络（基数 $k=0$）。它运行 FBA 求解器并存储得到的生物质通量和通量向量。\n    - 它检查此基础案例的生物质通量是否大于阈值 $\\tau$。如果是，则问题已解决，因为最小添加反应集为空集。\n    - 如果未达到阈值，算法将继续搜索最小的非空集。它遍历基数 $k=1, 2, \\dots$ 直到候选反应的总数。对于每个 $k$，使用 `itertools.combinations` 生成该大小的所有唯一候选反应子集。\n    - 对于每个子集，通过用所选候选反应的 $S$ 矩阵和边界向量扩增基础模型，构建一个临时的模型。然后对这个临时模型调用 FBA 求解器。\n    - 如果得到的生物质通量超过 $\\tau$，则存储结果（生物质值、通量向量和添加反应的索引）。\n    - 在测试完给定 $k$ 的所有组合后，如果其中有任何组合满足了阈值，则选择产生最大生物质的那个作为最终解，并终止搜索。这遵循了先最小基数、再最大目标的双重标准。\n    - 如果在对所有 $k$ 进行搜索后仍未找到解决方案，则保留来自基础网络的初始结果作为最终答案。\n\n3.  **验证与输出**：一旦确定了最优配置（基础或缺口填充后）及其对应的通量向量 $v^*$，将按要求执行两项验证检查。\n    - 通过计算残差向量 $Sv^*$ 并检查其无穷范数 $||Sv^*||_\\infty$ 是否小于容差 $10^{-8}$ 来验证质量平衡约束。\n    - 通过检查每个通量 $v_i^*$ 是否在其对应的边界 $[l_i, u_i]$ 内（允许相同的 $10^{-8}$ 数值容差）来验证边界约束。\n    - 收集每个案例的最终结果，包括四舍五入后的最优生物质、两个布尔验证标志以及已排序的添加候选反应索引列表。最终输出被格式化为指定的字符串表示形式。", "answer": "[[3.0000, True, True, []], [2.0000, True, True, [0]], [1.5000, True, True, [0, 1]], [0.0000, True, True, []]]", "id": "3312957"}]}