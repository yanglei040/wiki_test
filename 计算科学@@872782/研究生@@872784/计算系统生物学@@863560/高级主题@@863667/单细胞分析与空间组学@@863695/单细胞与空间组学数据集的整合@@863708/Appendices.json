{"hands_on_practices": [{"introduction": "在评估空间转录组学数据的整合质量时，一个关键步骤是分析推断出的基因表达模式是否具有生物学意义。空间自相关是衡量基因表达值在空间上是聚集、分散还是随机分布的核心指标。本练习将通过计算Moran's $I$和Geary's $C$这两个经典的空间自相关统计量，帮助您掌握量化基因表达空间结构的基本技能，这对于验证整合算法是否能重建出连贯的组织区域至关重要。[@problem_id:3320379]", "problem": "一个研究团队将单细胞RNA测序 (scRNA-seq) 数据与一个层状组织区域的点解析空间转录组学 (ST) 数据相结合，以获得一个标记基因（记为 $g$）在点水平上的基因表达估计值。考虑一个由 $n=6$ 个等距ST点组成的一维链，这些点沿着该层状结构排列，索引为 $i \\in \\{1,2,3,4,5,6\\}$。基因 $g$ 在这些点上的整合表达值为\n$$\nx_1=1,\\quad x_2=1,\\quad x_3=1,\\quad x_4=5,\\quad x_5=5,\\quad x_6=5,\n$$\n这代表了通过反卷积推断出的两个连续细胞状态域之间的一个清晰的局部边界。\n\n假设此链上存在一个二元、对称的邻接空间权重结构 $w_{ij}$，其定义为：如果 $|i-j|=1$，则 $w_{ij}=1$，否则 $w_{ij}=0$，并且 $w_{ii}=0$。使用计算系统生物学中用于点水平表达场的标准空间自相关定义，计算该场 $\\{x_i\\}_{i=1}^{6}$ 的 Geary’s $C$ 和 Moran’s $I$，然后通过报告标量\n$$\nS \\equiv \\frac{C}{1 - I}.\n$$\n来量化 Geary’s $C$ 相对于 Moran’s $I$ 对局部不连续性的相对敏感度。\n以单一精确数值的形式提供 $S$ 的值。不要四舍五入；本题不要求指定有效数字，且不涉及物理单位。", "solution": "该问题经核实具有科学依据、问题明确且客观。计算所求量所需的所有数据和定义均已提供。该场景是空间统计学在计算系统生物学中的一个标准应用。\n\n主要任务是为一个给定的一维表达场计算两个标准空间自相关度量——Moran’s $I$ 和 Geary’s $C$，然后计算一个派生量 $S$。\n\n首先，我们定义计算所需的各个组成部分。点的数量为 $n=6$。基因表达值由向量 $x = (x_1, x_2, x_3, x_4, x_5, x_6)$ 给出，其中\n$$\nx_1=1,\\quad x_2=1,\\quad x_3=1,\\quad x_4=5,\\quad x_5=5,\\quad x_6=5.\n$$\n第一步是计算平均表达值 $\\bar{x}$：\n$$\n\\bar{x} = \\frac{1}{n} \\sum_{i=1}^{n} x_i = \\frac{1}{6} (1+1+1+5+5+5) = \\frac{3 \\times 1 + 3 \\times 5}{6} = \\frac{18}{6} = 3.\n$$\n接下来，我们计算离均差的平方和，这是两种统计量的一个关键组成部分：\n$$\n\\sum_{i=1}^{n} (x_i - \\bar{x})^2 = (1-3)^2 + (1-3)^2 + (1-3)^2 + (5-3)^2 + (5-3)^2 + (5-3)^2\n$$\n$$\n\\sum_{i=1}^{n} (x_i - \\bar{x})^2 = 3 \\times (-2)^2 + 3 \\times (2)^2 = 3 \\times 4 + 3 \\times 4 = 12 + 12 = 24.\n$$\n空间权重矩阵 $w_{ij}$ 定义为一个二元邻接矩阵，其中如果点 $i$ 和 $j$ 相邻（即 $|i-j|=1$），则 $w_{ij}=1$，否则 $w_{ij}=0$。题目还给出了 $w_{ii}=0$。权重的总和 $W$ 是矩阵中所有元素的和：\n$$\nW = \\sum_{i=1}^{n} \\sum_{j=1}^{n} w_{ij}.\n$$\n对于一个包含 $n$ 个点的一维链，有 $n-1$ 对相邻的点。由于矩阵是对称的 ($w_{ij}=w_{ji}$)，非零项的总数为 $2(n-1)$。\n$$\nW = 2(6-1) = 2 \\times 5 = 10.\n$$\n非零权重对应于点对 $(1,2), (2,1), (2,3), (3,2), (3,4), (4,3), (4,5), (5,4), (5,6), (6,5)$。\n\n现在我们可以计算 Moran’s $I$。其公式为：\n$$\nI = \\frac{n}{W} \\frac{\\sum_{i=1}^{n} \\sum_{j=1}^{n} w_{ij} (x_i - \\bar{x})(x_j - \\bar{x})}{\\sum_{i=1}^{n} (x_i - \\bar{x})^2}.\n$$\n我们需要计算分子中涉及权重的项。我们只对 $w_{ij}=1$ 的点对求和：\n\\begin{align*} \\label{eq:1}\\sum_{i=1}^{n} \\sum_{j=1}^{n} w_{ij} (x_i - \\bar{x})(x_j - \\bar{x}) = (x_1-\\bar{x})(x_2-\\bar{x}) + (x_2-\\bar{x})(x_1-\\bar{x}) \\\\ + (x_2-\\bar{x})(x_3-\\bar{x}) + (x_3-\\bar{x})(x_2-\\bar{x}) \\\\ + (x_3-\\bar{x})(x_4-\\bar{x}) + (x_4-\\bar{x})(x_3-\\bar{x}) \\\\ + (x_4-\\bar{x})(x_5-\\bar{x}) + (x_5-\\bar{x})(x_4-\\bar{x}) \\\\ + (x_5-\\bar{x})(x_6-\\bar{x}) + (x_6-\\bar{x})(x_5-\\bar{x}) \\end{align*}\n让我们代入离差值 $x_i-\\bar{x}$：$(-2, -2, -2, 2, 2, 2)$。\n\\begin{align*} \\sum_{i,j} w_{ij} (x_i - \\bar{x})(x_j - \\bar{x}) = 2 \\left[ (-2)(-2) + (-2)(-2) + (-2)(2) + (2)(2) + (2)(2) \\right] \\\\ = 2 [4 + 4 - 4 + 4 + 4] \\\\ = 2 [12] = 24. \\end{align*}\n将此结果代入 Moran’s $I$ 的公式中：\n$$\nI = \\frac{6}{10} \\frac{24}{24} = \\frac{6}{10} = \\frac{3}{5}.\n$$\n接下来，我们计算 Geary’s $C$。其公式为：\n$$\nC = \\frac{n-1}{2W} \\frac{\\sum_{i=1}^{n} \\sum_{j=1}^{n} w_{ij} (x_i - x_j)^2}{\\sum_{i=1}^{n} (x_i - \\bar{x})^2}.\n$$\n我们计算分子中涉及相邻点对差的平方的项：\n\\begin{align*} \\sum_{i=1}^{n} \\sum_{j=1}^{n} w_{ij} (x_i - x_j)^2 = 2 \\left[ (x_1-x_2)^2 + (x_2-x_3)^2 + (x_3-x_4)^2 + (x_4-x_5)^2 + (x_5-x_6)^2 \\right] \\\\ = 2 \\left[ (1-1)^2 + (1-1)^2 + (1-5)^2 + (5-5)^2 + (5-5)^2 \\right] \\\\ = 2 [ 0^2 + 0^2 + (-4)^2 + 0^2 + 0^2 ] \\\\ = 2 [0 + 0 + 16 + 0 + 0] = 32. \\end{align*}\n将此结果代入 Geary’s $C$ 的公式中：\n$$\nC = \\frac{6-1}{2 \\times 10} \\frac{32}{24} = \\frac{5}{20} \\frac{32}{24}.\n$$\n化简分数：\n$$\nC = \\frac{1}{4} \\frac{4 \\times 8}{3 \\times 8} = \\frac{1}{4} \\frac{4}{3} = \\frac{1}{3}.\n$$\n最后，我们计算所求的标量 $S$：\n$$\nS \\equiv \\frac{C}{1 - I}.\n$$\n代入已计算出的 $C$ 和 $I$ 的值：\n$$\nI = \\frac{3}{5} \\implies 1-I = 1 - \\frac{3}{5} = \\frac{2}{5}.\n$$\n$$\nC = \\frac{1}{3}.\n$$\n$$\nS = \\frac{1/3}{2/5} = \\frac{1}{3} \\times \\frac{5}{2} = \\frac{5}{6}.\n$$\n$S$ 的值是一个精确的有理数。", "answer": "$$\n\\boxed{\\frac{5}{6}}\n$$", "id": "3320379"}, {"introduction": "将单细胞数据精确地映射到空间位置是整合分析的核心挑战之一，而最优传输（Optimal Transport, OT）为此提供了一个强大的数学框架。OT通过寻找一个“成本”最低的传输方案，将单细胞图谱中的细胞群体“搬运”到空间转录组的相应位置上，同时保持两边细胞类型和空间区域的比例不变。通过这个具体的计算练习，您将亲手解决一个简化的最优传输问题，从而直观地理解其如何根据成本和分布约束来构建细胞到空间位点的概率性映射。[@problem_id:3320381]", "problem": "您正在通过构建一个平衡最优传输 (OT) 问题来整合单细胞和空间组学数据集。考虑一个简化情景，其中有 $3$ 个单细胞图谱（由 $i \\in \\{1,2,3\\}$ 索引）和 $2$ 个空间点（由 $j \\in \\{1,2\\}$ 索引）。单细胞采样分布（行边缘）为 $a = (a_{1}, a_{2}, a_{3}) = (0.3, 0.4, 0.3)$，空间采样分布（列边缘）为 $b = (b_{1}, b_{2}) = (0.5, 0.5)$，两者都代表总和为 $1$ 的概率质量。基础成本矩阵 $C \\in \\mathbb{R}^{3 \\times 2}$ 编码了细胞和空间点之间的差异性，由下式给出\n$$\nC \\;=\\; \\begin{pmatrix}\n1  4 \\\\\n2  3 \\\\\n5  1\n\\end{pmatrix}.\n$$\n目标是确定 OT 耦合矩阵 $T \\in \\mathbb{R}_{\\ge 0}^{3 \\times 2}$，该矩阵在满足质量守恒约束的条件下，最小化总传输成本，\n$$\n\\text{minimize } \\sum_{i=1}^{3}\\sum_{j=1}^{2} C_{ij} T_{ij} \\quad \\text{subject to} \\quad \\sum_{j=1}^{2} T_{ij} = a_{i} \\ \\text{for all } i, \\quad \\sum_{i=1}^{3} T_{ij} = b_{j} \\ \\text{for all } j, \\quad T_{ij} \\ge 0.\n$$\n在计算出最优 $T$ 之后，使用空间点坐标 $s_{1} = 0$ 微米和 $s_{2} = 10$ 微米，计算每个细胞在一维组织轴上的重心投影。对于每个细胞 $i$，其在该轴上的重心坐标 $x_{i}$ 定义为\n$$\nx_{i} \\;=\\; \\frac{\\sum_{j=1}^{2} T_{ij} \\, s_{j}}{a_{i}}.\n$$\n从平衡 Kantorovich 最优传输问题的基本定义（质量守恒和成本最小化）以及重心投影作为行归一化耦合下的条件期望的定义出发，推导出最优的 $T$，然后计算 $x_{2}$。根据成本和边缘分布，解释所得到的概率映射，说明哪些细胞优先映射到哪些空间点以及原因为何。将 $x_{2}$ 的标量值（以微米为单位）作为您的最终答案。不要四舍五入；请提供精确值。", "solution": "该问题被验证为具有科学依据、适定、客观、完整且一致。它代表了最优传输 (OT) 理论在计算系统生物学问题中的一个标准应用。所有必要的数据和定义都已提供，不存在矛盾或歧义。\n\n目标是找到最优传输耦合矩阵 $T \\in \\mathbb{R}_{\\ge 0}^{3 \\times 2}$，它能求解以下线性规划问题：\n$$\n\\text{minimize } \\langle C, T \\rangle_F = \\sum_{i=1}^{3}\\sum_{j=1}^{2} C_{ij} T_{ij}\n$$\n约束条件如下：\n1.  对于 $i \\in \\{1, 2, 3\\}$，$\\sum_{j=1}^{2} T_{ij} = a_{i}$\n2.  对于 $j \\in \\{1, 2\\}$，$\\sum_{i=1}^{3} T_{ij} = b_{j}$\n3.  对于所有 $i,j$，$T_{ij} \\ge 0$\n\n给定的数据如下：\n- 成本矩阵: $C = \\begin{pmatrix} 1  4 \\\\ 2  3 \\\\ 5  1 \\end{pmatrix}$\n- 行边缘（单细胞分布）: $a = (0.3, 0.4, 0.3)$\n- 列边缘（空间分布）: $b = (0.5, 0.5)$\n- 空间点坐标: $s_1 = 0$, $s_2 = 10$\n\n我们可以通过识别成本最低的路径并贪婪地分配质量，同时遵守边缘约束来解决这个运输问题。成本按升序排列为 $C_{11}=1$, $C_{32}=1$, $C_{21}=2$, $C_{22}=3$, $C_{12}=4$, $C_{31}=5$。\n\n1.  最低成本是 $C_{11} = 1$。沿此路径可传输的最大质量受限于源头的可用质量和目的地的容量：$\\min(a_1, b_1) = \\min(0.3, 0.5) = 0.3$。我们设置 $T_{11} = 0.3$。\n    这满足了第一行的约束（$a_1 = 0.3$），因此不能再从细胞 1 发送更多质量。所以，$T_{12} = 0$。\n    剩余的边缘分布为：\n    - $a' = (0, 0.4, 0.3)$\n    - $b' = (0.5 - 0.3, 0.5) = (0.2, 0.5)$\n\n2.  次低成本是 $C_{32} = 1$。可传输的最大质量受限于剩余的边缘分布：$\\min(a_3, b'_2) = \\min(0.3, 0.5) = 0.3$。我们设置 $T_{32} = 0.3$。\n    这满足了第三行的约束（$a_3 = 0.3$），因此不能再从细胞 3 发送更多质量。所以，$T_{31} = 0$。\n    剩余的边缘分布为：\n    - $a'' = (0, 0.4, 0)$\n    - $b'' = (0.2, 0.5 - 0.3) = (0.2, 0.2)$\n\n3.  所有剩余质量必须来自细胞 2（$a_2 = 0.4$），并填满空间点的剩余容量（$b_1'' = 0.2$ 和 $b_2'' = 0.2$）。为满足列和，我们必须有 $T_{21} = 0.2$ 和 $T_{22} = 0.2$。这些分配也满足细胞 2 的行和：$T_{21} + T_{22} = 0.2 + 0.2 = 0.4 = a_2$。\n\n得到的最优传输方案是：\n$$\nT = \\begin{pmatrix}\n0.3  0 \\\\\n0.2  0.2 \\\\\n0  0.3\n\\end{pmatrix}\n$$\n我们可以验证行和：$(0.3+0, 0.2+0.2, 0+0.3) = (0.3, 0.4, 0.3) = a$。\n我们可以验证列和：$(0.3+0.2+0, 0+0.2+0.3) = (0.5, 0.5) = b$。\n所有条目均为非负。\n\n这个解对应一个概率映射。细胞 $i$ 映射到空间点 $j$ 的条件概率由 $P_{ij} = T_{ij} / a_i$ 给出。\n- 细胞 1：完全映射到空间点 1（$P_{11}=1, P_{12}=0$），因为 $C_{11}=1$ 远小于 $C_{12}=4$。\n- 细胞 3：完全映射到空间点 2（$P_{31}=0, P_{32}=1$），因为 $C_{32}=1$ 远小于 $C_{31}=5$。\n- 细胞 2：其质量 $0.4$ 被分开。在细胞 1 和 3 占据了成本最低的路径后，空间点 1 剩余容量为 $0.2$，空间点 2 剩余容量也为 $0.2$。细胞 2 必须提供这些质量，因此 $T_{21}=0.2$ 且 $T_{22}=0.2$。这意味着细胞 2 以相等的概率映射到两个空间点（$P_{21} = 0.2/0.4 = 0.5$, $P_{22} = 0.2/0.4 = 0.5$）。\n\n现在，我们计算细胞 $i=2$ 的重心投影，记为 $x_2$。公式如下：\n$$\nx_{i} = \\frac{\\sum_{j=1}^{2} T_{ij} s_{j}}{a_{i}}\n$$\n使用细胞 $i=2$ 的值：\n- $a_2 = 0.4$\n- $T_{21} = 0.2$ 且 $T_{22} = 0.2$\n- $s_1 = 0$ 且 $s_2 = 10$\n\n将这些值代入公式：\n$$\nx_2 = \\frac{T_{21} s_1 + T_{22} s_2}{a_2} = \\frac{(0.2)(0) + (0.2)(10)}{0.4}\n$$\n$$\nx_2 = \\frac{0 + 2}{0.4} = \\frac{2}{0.4} = \\frac{20}{4} = 5\n$$\n细胞 2 的重心坐标是 $5$ 微米。这是细胞 2 的期望空间坐标，它恰好位于空间点 1（坐标 0）和空间点 2（坐标 10）的正中间，这反映了它到两个空间点的均衡映射。", "answer": "$$\\boxed{5}$$", "id": "3320381"}, {"introduction": "在将单细胞图谱的细胞类型注释“迁移”到空间转录组数据上后，我们迫切需要一种可靠的方法来评估注释的准确性。调整兰德指数（Adjusted Rand Index, ARI）是评估聚类或分类任务一致性的黄金标准之一，它通过比较预测标签与真实标签的成对一致性，并对随机 chance 进行了校正，从而提供了比原始准确率更稳健的评估。本练习将引导您从基本原理出发，为一个模拟的标签迁移结果计算ARI值，这对于客观比较不同整合算法的反卷积性能至关重要。[@problem_id:3320430]", "problem": "您正在通过标签转移（label transfer）将单细胞RNA测序（scRNA-seq）参考与空间转录组学数据集进行整合，将每个空间点（spatial spot）分配给从单细胞图谱中推断出的细胞类型。为了评估转移的标签与真实细胞类型之间的一致性，您决定使用调整兰德指数（Adjusted Rand Index, ARI），这是一种对同一集合的两个分区之间的两两一致性进行机会校正的度量。\n\n从两个分区之间一致性的基本配对计数定义（即在两个分区中都被共同分配的元素对，相对于在一个分区中共同分配但在另一个分区中不共同分配的元素对）出发，并使用具有固定簇大小边缘分布（广义超几何模型）的随机分配零模型，执行以下操作：\n\n1. 以列联表计数的形式，推导调整兰德指数（ARI）作为一个经机会校正的指数。具体来说，假设有 $n$ 个点被划分为由 $i$ 索引的真实簇，其大小为 $a_i$；以及由 $j$ 索引的预测簇，其大小为 $b_j$。令 $n_{ij}$ 为同时位于真实簇 $i$ 和预测簇 $j$ 中的点的数量。从配对计数的角度和在保持 $\\{a_i\\}$ 与 $\\{b_j\\}$ 不变的零模型下共同分配的概率出发，推导 ARI 作为 $\\{n_{ij}\\}$、$\\{a_i\\}$、$\\{b_j\\}$ 和 $n$ 的函数的闭式表达式。\n\n2. 考虑一个玩具空间数据集，其中有 $n=12$ 个点，按真实标签分为三个细胞类型 $A$、$B$ 和 $C$，每个类型的大小均为 $4$：$A=\\{s_1,s_2,s_3,s_4\\}$，$B=\\{s_5,s_6,s_7,s_8\\}$，$C=\\{s_9,s_{10},s_{11},s_{12}\\}$。从单细胞RNA测序参考进行标签转移后，预测的分配（表示为 $A'$, $B'$, $C'$）如下：\n- $A'=\\{s_1,s_2,s_3,s_5\\}$，\n- $B'=\\{s_4,s_6,s_7,s_9\\}$，\n- $C'=\\{s_8,s_{10},s_{11},s_{12}\\}$。\n\n   使用您推导出的公式，计算此情况下的 ARI。\n\n将您的最终 ARI 表示为最简分数。不要四舍五入。最终答案中不要包含任何单位。", "solution": "该问题要求从基本原理推导调整兰德指数（ARI），并随后将其应用于一个特定的数据集。按要求，解答分为两部分呈现。\n\n### 第1部分：调整兰德指数（ARI）的推导\n\n调整兰德指数是衡量两个数据聚类之间相似性的度量，并为随机性进行了校正。它属于一类具有以下形式的通用统计量：\n$$\n\\text{调整后指数} = \\frac{\\text{指数} - \\text{期望指数}}{\\text{最大指数} - \\text{期望指数}}\n$$\n我们的目标是基于所提供的框架来定义 `Index`（指数）、`Expected Index`（期望指数）和 `Max Index`（最大指数）。\n\n设有一个包含 $n$ 个元素的集合。令 $U = \\{U_1, U_2, \\dots, U_R\\}$ 和 $V = \\{V_1, V_2, \\dots, V_C\\}$ 为这些元素的两个不同分区（聚类）。对于给定的问题，$U$ 代表真实的细胞类型，$V$ 代表预测的分配。列联表，其条目为 $n_{ij} = |U_i \\cap V_j|$，总结了两个分区之间的重叠情况。行和为 $a_i = \\sum_{j=1}^{C} n_{ij} = |U_i|$，列和为 $b_j = \\sum_{i=1}^{R} n_{ij} = |V_j|$。元素总数为 $n = \\sum_{i=1}^{R} a_i = \\sum_{j=1}^{C} b_j = \\sum_{i=1}^{R} \\sum_{j=1}^{C} n_{ij}$。\n\n分区之间的一致性可以通过考虑元素对来评估。不同元素对的总数是 $\\binom{n}{2}$。基准 `Index`（指数）的一个自然选择是在两个分区中都被分在同一簇中的元素对的数量。对于列联表中的任何单元格 $(i, j)$，有 $n_{ij}$ 个元素既在簇 $U_i$ 中，又在簇 $V_j$ 中。该单元格内的元素对数量为 $\\binom{n_{ij}}{2}$。对所有单元格求和，得到在两个分区中都共同聚类的总对数。\n\n因此，我们将 `Index`（指数）定义为：\n$$\n\\text{Index} = \\sum_{i=1}^{R} \\sum_{j=1}^{C} \\binom{n_{ij}}{2}\n$$\n\n接下来，我们在一个零模型下确定 `Expected Index`（期望指数），在该模型中，分区 $U$ 和 $V$ 是随机选择的，但约束条件是簇的大小（即边缘分布 $\\{a_i\\}$ 和 $\\{b_j\\}$）是固定的。这对应于广义超几何分布。在此模型下，对于整数 $k$，$\\binom{n_{ij}}{k}$ 的期望值由下式给出：\n$$\nE\\left[\\binom{n_{ij}}{k}\\right] = \\frac{\\binom{a_i}{k} \\binom{b_j}{k}}{\\binom{n}{k}}\n$$\n对于我们的 `Index`，我们需要 $k=2$ 的情况。根据期望的线性性质，`Expected Index`（期望指数）为：\n$$\n\\text{Expected Index} = E\\left[\\sum_{i,j} \\binom{n_{ij}}{2}\\right] = \\sum_{i,j} E\\left[\\binom{n_{ij}}{2}\\right] = \\sum_{i,j} \\frac{\\binom{a_i}{2} \\binom{b_j}{2}}{\\binom{n}{2}}\n$$\n这可以通过分离求和项来简化：\n$$\n\\text{Expected Index} = \\frac{\\left(\\sum_{i=1}^{R} \\binom{a_i}{2}\\right) \\left(\\sum_{j=1}^{C} \\binom{b_j}{2}\\right)}{\\binom{n}{2}}\n$$\n这里，$\\sum_{i} \\binom{a_i}{2}$ 是在分区 $U$ 中位于同一簇中的元素对总数，而 $\\sum_{j} \\binom{b_j}{2}$ 是在分区 $V$ 中位于同一簇中的元素对总数。\n\n最后，我们定义 `Max Index`（最大指数）。这代表了 `Index` 的最大可能值。完全一致意味着 `Index` 的值达到最大。然而，分区 $U$ 和 $V$ 可能有不同数量的簇或不同的大小分布，因此可能无法实现完美的一一对应。`Max Index` 的常规选择是单独考虑每个分区时，其最大可能值的平均值。分区 $U$ 的最大共聚类对数为 $\\sum_i \\binom{a_i}{2}$，而分区 $V$ 的最大共聚类对数为 $\\sum_j \\binom{b_j}{2}$。因此：\n$$\n\\text{Max Index} = \\frac{1}{2} \\left( \\sum_{i=1}^{R} \\binom{a_i}{2} + \\sum_{j=1}^{C} \\binom{b_j}{2} \\right)\n$$\n\n将这些表达式代入校正指数的一般公式中，我们得到调整兰德指数的推导表达式：\n$$\n\\text{ARI} = \\frac{\\sum_{i,j} \\binom{n_{ij}}{2} - \\frac{\\left(\\sum_i \\binom{a_i}{2}\\right) \\left(\\sum_j \\binom{b_j}{2}\\right)}{\\binom{n}{2}}}{\\frac{1}{2} \\left(\\sum_i \\binom{a_i}{2} + \\sum_j \\binom{b_j}{2}\\right) - \\frac{\\left(\\sum_i \\binom{a_i}{2}\\right) \\left(\\sum_j \\binom{b_j}{2}\\right)}{\\binom{n}{2}}}\n$$\n这就是所要求的 ARI 作为 $\\{n_{ij}\\}$、$\\{a_i\\}$、$\\{b_j\\}$ 和 $n$ 的函数的闭式表达式。\n\n### 第2部分：玩具数据集的计算\n\n给定 $n=12$ 个点和两个分区。\n真实分区 $U$ 有簇 $A$、$B$、$C$。\n$A = \\{s_1,s_2,s_3,s_4\\}$，所以 $a_A=4$。\n$B = \\{s_5,s_6,s_7,s_8\\}$，所以 $a_B=4$。\n$C = \\{s_9,s_{10},s_{11},s_{12}\\}$，所以 $a_C=4$。\n\n预测分区 $V$ 有簇 $A'$、$B'$、$C'$。\n$A' = \\{s_1,s_2,s_3,s_5\\}$，所以 $b_{A'}=4$。\n$B' = \\{s_4,s_6,s_7,s_9\\}$，所以 $b_{B'}=4$。\n$C' = \\{s_8,s_{10},s_{11},s_{12}\\}$，所以 $b_{C'}=4$。\n\n首先，我们通过计算交集的大小 $n_{ij} = |U_i \\cap V_j|$ 来构建列联表：\n$n_{A,A'} = |A \\cap A'| = |\\{s_1,s_2,s_3\\}| = 3$。\n$n_{A,B'} = |A \\cap B'| = |\\{s_4\\}| = 1$。\n$n_{A,C'} = |A \\cap C'| = |\\emptyset| = 0$。\n$n_{B,A'} = |B \\cap A'| = |\\{s_5\\}| = 1$。\n$n_{B,B'} = |B \\cap B'| = |\\{s_6,s_7\\}| = 2$。\n$n_{B,C'} = |B \\cap C'| = |\\{s_8\\}| = 1$。\n$n_{C,A'} = |C \\cap A'| = |\\emptyset| = 0$。\n$n_{C,B'} = |C \\cap B'| = |\\{s_9\\}| = 1$。\n$n_{C,C'} = |C \\cap C'| = |\\{s_{10},s_{11},s_{12}\\}| = 3$。\n\n列联表如下：\n$$\n\\begin{array}{c|ccc|c}\n A'  B'  C'  \\text{和 } (a_i) \\\\\n\\hline\nA  3  1  0  4 \\\\\nB  1  2  1  4 \\\\\nC  0  1  3  4 \\\\\n\\hline\n\\text{和 } (b_j)  4  4  4  12\n\\end{array}\n$$\n现在，我们计算 ARI 公式的各个组成部分。我们使用性质 $\\binom{k}{2} = \\frac{k(k-1)}{2}$。\n\n1.  计算 `Index`（指数）：\n    $$\n    \\sum_{i,j} \\binom{n_{ij}}{2} = \\binom{3}{2} + \\binom{1}{2} + \\binom{0}{2} + \\binom{1}{2} + \\binom{2}{2} + \\binom{1}{2} + \\binom{0}{2} + \\binom{1}{2} + \\binom{3}{2}\n    $$\n    因为 $\\binom{1}{2}=0$ 且 $\\binom{0}{2}=0$，上式简化为：\n    $$\n    \\sum_{i,j} \\binom{n_{ij}}{2} = \\binom{3}{2} + \\binom{2}{2} + \\binom{3}{2} = 3 + 1 + 3 = 7\n    $$\n\n2.  计算每个分区的配对总数：\n    $$\n    \\sum_i \\binom{a_i}{2} = \\binom{4}{2} + \\binom{4}{2} + \\binom{4}{2} = 6 + 6 + 6 = 18\n    $$\n    $$\n    \\sum_j \\binom{b_j}{2} = \\binom{4}{2} + \\binom{4}{2} + \\binom{4}{2} = 6 + 6 + 6 = 18\n    $$\n\n3.  计算总配对数：\n    $$\n    \\binom{n}{2} = \\binom{12}{2} = \\frac{12 \\times 11}{2} = 66\n    $$\n\n4.  计算 `Expected Index`（期望指数）：\n    $$\n    \\text{Expected Index} = \\frac{\\left(\\sum_i \\binom{a_i}{2}\\right) \\left(\\sum_j \\binom{b_j}{2}\\right)}{\\binom{n}{2}} = \\frac{18 \\times 18}{66} = \\frac{324}{66} = \\frac{54}{11}\n    $$\n\n5.  计算 `Max Index`（最大指数）：\n    $$\n    \\text{Max Index} = \\frac{1}{2} \\left(\\sum_i \\binom{a_i}{2} + \\sum_j \\binom{b_j}{2}\\right) = \\frac{1}{2} (18 + 18) = 18\n    $$\n\n6.  最后，计算 ARI：\n    $$\n    \\text{ARI} = \\frac{\\text{Index} - \\text{Expected Index}}{\\text{Max Index} - \\text{Expected Index}} = \\frac{7 - \\frac{54}{11}}{18 - \\frac{54}{11}}\n    $$\n    分子：\n    $$\n    7 - \\frac{54}{11} = \\frac{77 - 54}{11} = \\frac{23}{11}\n    $$\n    分母：\n    $$\n    18 - \\frac{54}{11} = \\frac{198 - 54}{11} = \\frac{144}{11}\n    $$\n    ARI：\n    $$\n    \\text{ARI} = \\frac{\\frac{23}{11}}{\\frac{144}{11}} = \\frac{23}{144}\n    $$\n数字 $23$ 是素数，且不能整除 $144$，因此该分数为最简形式。", "answer": "$$\\boxed{\\frac{23}{144}}$$", "id": "3320430"}]}