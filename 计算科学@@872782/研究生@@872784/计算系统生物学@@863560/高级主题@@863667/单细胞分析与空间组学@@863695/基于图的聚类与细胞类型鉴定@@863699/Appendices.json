{"hands_on_practices": [{"introduction": "在将单细胞数据表示为图的第一步中，我们不仅要连接最近的邻居，还要以一种能够反映局部密度结构的方式为这些连接赋予权重。共享最近邻（Shared Nearest Neighbor, SNN）方法通过计算邻域重叠来实现这一目标，从而增强了真正相似细胞间的连接强度。这个练习 [@problem_id:3318020] 将引导你推导并计算基于Jaccard相似度的SNN权重，这是构建高质量细胞图谱的基础。", "problem": "在用于细胞类型鉴定的单细胞核糖核酸测序（scRNA-seq）分析中，细胞被嵌入到一个潜在空间中，并通过一个$k$-近邻（kNN）图连接起来。一种广泛使用的策略是根据邻域集的重叠来分配边权重，这通常被称为共享近邻（SNN）图。仅使用两个有限集之间Jaccard相似度的集合论定义和一个$k$-近邻图的核心定义，推导SNN边权重$w_{ij}$的显式表达式，该表达式用kNN图中细胞$i$和$j$的邻域$N_{k}(i)$和$N_{k}(j)$表示。然后为一个具体例子计算这个权重。\n\n假设一个数据集包含$8$个标记为$\\{1,2,3,4,5,6,7,8\\}$的细胞和一个$k=5$的kNN图，其中邻域不包括细胞本身。考虑细胞$i=1$和$j=2$，其邻域为\n$$\nN_{k}(1)=\\{2,3,4,5,7\\},\\quad N_{k}(2)=\\{1,3,4,6,7\\}.\n$$\n仅使用Jaccard相似度的集合论定义和以上信息，首先推导$w_{ij}$的闭式表达式，然后为指定的$N_{k}(1)$和$N_{k}(2)$计算其值。将最终数值表示为最简分数。", "solution": "问题陈述被评估为有效。它在计算系统生物学的既定方法中具有科学依据，特别是在使用共享近邻（SNN）图对单细胞数据进行聚类方面。该问题是适定的，为获得唯一解提供了所有必要的定义和数据。其语言客观，设置自洽且一致。\n\n任务是首先推导共享近邻（SNN）边权重$w_{ij}$的通用表达式，然后为一对特定细胞计算其值。问题明确指出，边权重由邻域集的Jaccard相似度定义。\n\n首先，让我们将推导过程形式化。两个有限非空集$A$和$B$之间的Jaccard相似性指数$J(A, B)$定义为其交集的基数与并集的基数之比：\n$$\nJ(A, B) = \\frac{|A \\cap B|}{|A \\cup B|}\n$$\n问题指明，SNN图中两个细胞$i$和$j$之间的边权重$w_{ij}$由它们各自的$k$-近邻集$N_{k}(i)$和$N_{k}(j)$的Jaccard相似度给出。因此，我们将$A = N_{k}(i)$和$B = N_{k}(j)$代入Jaccard指数公式：\n$$\nw_{ij} = J(N_{k}(i), N_{k}(j)) = \\frac{|N_{k}(i) \\cap N_{k}(j)|}{|N_{k}(i) \\cup N_{k}(j)|}\n$$\n这就是用邻域集表示的SNN边权重的显式表达式。使用集合基数的容斥原理，分母可以重新表示为$|A \\cup B| = |A| + |B| - |A \\cap B|$。应用此原理，我们得到表达式的另一种同样有效的形式：\n$$\nw_{ij} = \\frac{|N_{k}(i) \\cap N_{k}(j)|}{|N_{k}(i)| + |N_{k}(j)| - |N_{k}(i) \\cap N_{k}(j)|}\n$$\n这就完成了任务的第一部分。\n\n接下来，我们为给定的具体例子计算这个权重。参数和数据如下：\n- 关注的细胞是$i=1$和$j=2$。\n- 最近邻的数量是$k=5$。\n- 细胞$1$的邻域是$N_{k}(1) = \\{2, 3, 4, 5, 7\\}$。\n- 细胞$2$的邻域是$N_{k}(2) = \\{1, 3, 4, 6, 7\\}$。\n\n我们必须计算这两个集合的交集和并集的基数。\n\n首先，我们求出这两个邻域集的交集：\n$$\nN_{k}(1) \\cap N_{k}(2) = \\{2, 3, 4, 5, 7\\} \\cap \\{1, 3, 4, 6, 7\\}\n$$\n两个集合共有的元素是$3$、$4$和$7$。因此，\n$$\nN_{k}(1) \\cap N_{k}(2) = \\{3, 4, 7\\}\n$$\n交集的基数是该集合中元素的数量：\n$$\n|N_{k}(1) \\cap N_{k}(2)| = 3\n$$\n这个值表示细胞$1$和细胞$2$之间的共享最近邻的数量。\n\n接下来，我们求出这两个邻域集的并集：\n$$\nN_{k}(1) \\cup N_{k}(2) = \\{2, 3, 4, 5, 7\\} \\cup \\{1, 3, 4, 6, 7\\}\n$$\n并集是存在于任一集合中的所有唯一元素的集合：\n$$\nN_{k}(1) \\cup N_{k}(2) = \\{1, 2, 3, 4, 5, 6, 7\\}\n$$\n并集的基数是该集合中元素的数量：\n$$\n|N_{k}(1) \\cup N_{k}(2)| = 7\n$$\n作为验证，我们可以使用容斥原理。单个邻域集的基数是$|N_{k}(1)| = 5$和$|N_{k}(2)| = 5$，与$k=5$一致。\n$$\n|N_{k}(1) \\cup N_{k}(2)| = |N_{k}(1)| + |N_{k}(2)| - |N_{k}(1) \\cap N_{k}(2)| = 5 + 5 - 3 = 7\n$$\n结果是一致的。\n\n最后，我们通过将计算出的基数代入Jaccard相似度公式来计算边权重$w_{12}$：\n$$\nw_{12} = \\frac{|N_{k}(1) \\cap N_{k}(2)|}{|N_{k}(1) \\cup N_{k}(2)|} = \\frac{3}{7}\n$$\n问题要求将最终值表示为最简分数。分数$\\frac{3}{7}$已经是其最简形式，因为$3$和$7$都是质数。", "answer": "$$\\boxed{\\frac{3}{7}}$$", "id": "3318020"}, {"introduction": "构建了细胞相似性网络之后，核心任务是识别其中紧密连接的细胞群落，即潜在的细胞类型。模块度（Modularity）是衡量一个网络划分方案优劣的关键指标，它量化了群落内部连接相对于随机预期的紧密程度。通过这个练习 [@problem_id:3317980]，你将为一个代表着稀有细胞亚群的场景计算模块度增益 $\\Delta Q$，从而掌握判断一个子图是否构成一个有效群落的定量依据。", "problem": "一项单细胞核糖核酸测序 (scRNA-seq) 实验生成了一个细胞-细胞相似性图。该图通过 $k$-近邻 ($k$-NN) 算法构建，然后对称化形成一个无向、无权图。您怀疑存在一个罕见的细胞状态，它形成了一个小而密集的子图，并与一个更大、更异质的社区相连。考虑以下从经过质量控制的数据中得出的、与此情景一致的图级别摘要：\n\n- 该图是无向图，共有 $m = 100$ 条边。\n- 一个候选的罕见子图 $S$ 包含 $l_{S} = 30$ 条内部边。\n- 较大的社区 $L$ 包含 $l_{L} = 60$ 条内部边。\n- 有 $e_{SL} = 10$ 条边连接 $S$ 中的节点和 $L$ 中的节点。\n\n假设在无向图的配置模型零假设下，使用 Newman–Girvan 模块度。计算将图划分为两个社区 $\\{S, L\\}$ 相对于将所有节点视为单个社区时的模块度增益 $\\Delta Q$。根据 $\\Delta Q$ 的符号，简要判断在模块度最大化的情况下，罕见子图 $S$ 是否形成其自身的簇。请将 $\\Delta Q$ 的最终答案表示为一个精确分数，不进行四舍五入，不带单位。", "solution": "问题陈述经过验证，是有效且表述清晰的。它为求解提供了所有必要的信息。任务是计算将图划分为两个社区 $\\{S, L\\}$ 相对于将所有节点视为单个社区时的模块度增益 $\\Delta Q$。\n\n### 步骤 1: 回顾模块度定义\n无向图的 Newman-Girvan 模块度 $Q$ 定义为：\n$$ Q = \\sum_{c} \\left[ \\frac{e_c}{m} - \\left(\\frac{d_c}{2m}\\right)^2 \\right] $$\n其中：\n- $m$ 是图中的总边数。\n- 求和遍及图的所有社区 $c$。\n- $e_c$ 是社区 $c$ 内部的边数。\n- $d_c$ 是社区 $c$ 中所有节点的度之和。\n\n我们需要计算两种情况下的模块度：\n1.  **情况 1 (单社区)**: 整个图被视为一个社区。\n2.  **情况 2 (双社区)**: 图被划分为社区 $S$ 和 $L$。\n    \n模块度增益 $\\Delta Q$ 即为 $Q_{\\text{双社区}} - Q_{\\text{单社区}}$。\n\n### 步骤 2: 计算单社区的模块度 $Q_{\\text{单社区}}$\n在这种情况下，只有一个社区，即整个图。\n- 社区内的边数 $e_c = m = 100$。\n- 社区的度之和 $d_c = 2m = 2 \\times 100 = 200$。\n代入公式：\n$$ Q_{\\text{单社区}} = \\frac{m}{m} - \\left(\\frac{2m}{2m}\\right)^2 = 1 - 1^2 = 0 $$\n这是一个标准结果：未划分的图的模块度为零。\n\n### 步骤 3: 计算双社区的模块度 $Q_{\\text{双社区}}$\n在这种情况下，我们有两个社区，$S$ 和 $L$。\n首先，我们需要计算每个社区的度之和 $d_S$ 和 $d_L$。一个社区的度之和等于其内部边数的两倍加上连接到社区外部的边数。\n- 对于社区 $S$：\n    - 内部边数 $e_S = l_S = 30$。\n    - 外部边数是 $e_{SL} = 10$。\n    - 度之和 $d_S = 2 \\times l_S + e_{SL} = 2 \\times 30 + 10 = 70$。\n- 对于社区 $L$：\n    - 内部边数 $e_L = l_L = 60$。\n    - 外部边数是 $e_{SL} = 10$。\n    - 度之和 $d_L = 2 \\times l_L + e_{SL} = 2 \\times 60 + 10 = 130$。\n\n我们可以通过检查总度数来验证：$d_S + d_L = 70 + 130 = 200$, 这等于 $2m = 200$。计算正确。\n\n现在，我们计算 $Q_{\\text{双社区}}$：\n$$ Q_{\\text{双社区}} = \\left[ \\frac{e_S}{m} - \\left(\\frac{d_S}{2m}\\right)^2 \\right] + \\left[ \\frac{e_L}{m} - \\left(\\frac{d_L}{2m}\\right)^2 \\right] $$\n代入数值：\n- $m = 100$\n- $e_S = 30$, $d_S = 70$\n- $e_L = 60$, $d_L = 130$\n- $2m = 200$\n    \n$$ Q_{\\text{双社区}} = \\left[ \\frac{30}{100} - \\left(\\frac{70}{200}\\right)^2 \\right] + \\left[ \\frac{60}{100} - \\left(\\frac{130}{200}\\right)^2 \\right] $$\n$$ Q_{\\text{双社区}} = \\left[ \\frac{3}{10} - \\left(\\frac{7}{20}\\right)^2 \\right] + \\left[ \\frac{6}{10} - \\left(\\frac{13}{20}\\right)^2 \\right] $$\n$$ Q_{\\text{双社区}} = \\left[ \\frac{3}{10} - \\frac{49}{400} \\right] + \\left[ \\frac{6}{10} - \\frac{169}{400} \\right] $$\n$$ Q_{\\text{双社区}} = \\left[ \\frac{120}{400} - \\frac{49}{400} \\right] + \\left[ \\frac{240}{400} - \\frac{169}{400} \\right] $$\n$$ Q_{\\text{双社区}} = \\frac{71}{400} + \\frac{71}{400} = \\frac{142}{400} = \\frac{71}{200} $$\n\n### 步骤 4: 计算模块度增益 $\\Delta Q$ 并作出判断\n$$ \\Delta Q = Q_{\\text{双社区}} - Q_{\\text{单社区}} = \\frac{71}{200} - 0 = \\frac{71}{200} $$\n由于 $\\Delta Q = \\frac{71}{200} > 0$，将图划分为两个社区 $\\{S, L\\}$ 导致模块度增加。因此，在模块度最大化的框架下，罕见子图 $S$ 确实应该形成其自身的簇，而不是与 $L$ 合并。", "answer": "$$\\boxed{\\frac{71}{200}}$$", "id": "3317980"}, {"introduction": "标准模块度最优化存在一个固有的分辨率极限，可能导致无法识别尺寸较小或较大的真实生物学群落。为了克服这一点，引入了分辨率参数 $\\gamma$ 的广义模块度，它允许我们调整检测群落的粒度。这个高级练习 [@problem_id:3317960] 将挑战你推导出一个临界分辨率值 $\\gamma_c$，在该值下，一个罕见的细胞团簇会从一个更大的群体中分离出来，这对于在不同生物学尺度上探索细胞异质性至关重要。", "problem": "在单细胞核糖核酸测序 (scRNA-seq) 中，一种常见的细胞类型鉴定方法是构建一个细胞-细胞相似性图，然后使用模块度最大化方法进行社区发现，其中包含一个可调的分辨率参数 $\\gamma$。考虑一个模拟 scRNA-seq k-近邻相似性的无向、无权重玩具图：其中一个较大的组分是大小为 $L$ 的完全图（团），一个稀有的组分是大小为 $S$ 的较小完全图。这两个组分通过大团中的一个节点与小团中的一个节点之间的一条组分间边连接。设 $L=12$ 且 $S=4$。令 $A_{ij}$ 为邻接矩阵，$k_{i}$ 为节点 $i$ 的度，$m$ 为总边数，$\\delta(c_{i},c_{j})$ 为克罗内克δ函数，表示节点 $i$ 和 $j$ 是否属于同一个社区。带有分辨率参数 $\\gamma$ 的广义 Newman–Girvan 模块度定义为\n$$\nQ(\\gamma)=\\frac{1}{2m}\\sum_{i}\\sum_{j}\\left(A_{ij}-\\gamma\\frac{k_i k_j}{2m}\\right)\\delta(c_i,c_j).\n$$\n假设没有自环，且矩阵对称 $A_{ij}=A_{ji}$。仅使用上述定义以及关于团中度和边数的第一性原理，计算两种划分下的 $Q(\\gamma)$：(i) 所有 $L+S$ 个节点都在一个社区中，以及 (ii) 稀有的 $S$ 节点团与 $L$ 节点团分离，形成两个社区。推导出临界分辨率值 $\\gamma_{c}$，在该值下，两社区划分的模块度严格大于单社区划分的模块度。请以单个精确有理表达式的形式给出 $\\gamma_{c}$ 的最终答案。请明确指出描述分离稀有团的 $\\gamma$范围的不等式，但在最终答案中仅报告 $\\gamma_{c}$。", "solution": "该问题陈述是在应用于计算系统生物学的图论领域中一个有效且良定的问题。它有科学依据，是客观的，并提供了推导唯一解所需的所有信息。\n\n问题要求的是临界分辨率参数 $\\gamma_c$，在该参数下，特定图的两社区划分比单社区划分更优（即具有更高的模块度分数）。该图由一个大小为 $L=12$ 的完全图（团）和一个大小为 $S=4$ 的较小团组成，它们之间由一条边连接。\n\n首先，我们描述该图的属性。\n令大团为 $C_L'$，小团为 $C_S'$。\n节点数为 $N = L+S = 12+4=16$。\n$L$-团内部的边数为 $\\frac{L(L-1)}{2} = \\frac{12(11)}{2} = 66$。\n$S$-团内部的边数为 $\\frac{S(S-1)}{2} = \\frac{4(3)}{2} = 6$。\n有一条连接两个团的组分间边。\n图中总边数 $m$ 是这些边数的总和，所以 $m = 66 + 6 + 1 = 73$。\n\n接下来，我们确定所有节点 $i$ 的度 $k_i$。\n对于大小为 $L$ 的大团中的节点：\n- $L-1 = 11$ 个节点仅与团内其他节点相连。它们的度为 $k_i = L-1 = 11$。\n- 一个节点与其团中的其他 $L-1$ 个节点相连，并且还与小团中的一个节点相连。它的度为 $k_i = (L-1) + 1 = L = 12$。\n\n对于大小为 $S$ 的小团中的节点：\n- $S-1 = 3$ 个节点仅与团内其他节点相连。它们的度为 $k_i = S-1 = 3$。\n- 一个节点与其团中的其他 $S-1$ 个节点相连，并且还与大团中的节点相连。它的度为 $k_i = (S-1) + 1 = S = 4$。\n\n所有度的总和为 $\\sum_i k_i = (11 \\times 11) + (1 \\times 12) + (3 \\times 3) + (1 \\times 4) = 121 + 12 + 9 + 4 = 146$。这与 $2m = 2 \\times 73 = 146$ 相符，符合预期。\n\n模块度 $Q(\\gamma)$ 由以下公式给出：\n$$Q(\\gamma)=\\frac{1}{2m}\\sum_{i}\\sum_{j}\\left(A_{ij}-\\gamma\\frac{k_i k_j}{2m}\\right)\\delta(c_i,c_j)$$\n这可以改写为对社区 $c$ 的求和：\n$$Q(\\gamma) = \\sum_c \\left[ \\frac{e_c}{m} - \\gamma \\left(\\frac{d_c}{2m}\\right)^2 \\right]$$\n其中 $e_c$ 是社区 $c$ 内部的边数，$d_c = \\sum_{i \\in c} k_i$ 是社区 $c$ 中节点度的总和。\n\n现在我们为两种指定的划分计算模块度。\n\n情况 (i)：所有 $L+S$ 个节点都在一个社区中。\n设此划分为 $P_1$。只有一个社区 $c_1$，即整个图。\n- 该社区内的边数是总边数，所以 $e_1 = m = 73$。\n- 该社区中节点度的总和是所有度的总和，所以 $d_1 = \\sum_i k_i = 2m = 146$。\n\n此划分的模块度 $Q_1(\\gamma)$ 为：\n$$Q_1(\\gamma) = \\frac{e_1}{m} - \\gamma \\left(\\frac{d_1}{2m}\\right)^2 = \\frac{m}{m} - \\gamma \\left(\\frac{2m}{2m}\\right)^2 = 1 - \\gamma$$\n\n情况 (ii)：两个社区，一个为 $L$ 节点团 ($C_L$)，另一个为 $S$ 节点团 ($C_S$)。\n设此划分为 $P_2$。那条唯一的组分间边被此划分切割。\n- 社区 $C_L$ 由大团的 $L=12$ 个节点组成。完全在此社区内的边数 $e_L$ 是大小为 $L$ 的完全图中的边数。\n$e_L = \\frac{L(L-1)}{2} = \\frac{12(11)}{2} = 66$。\n- 社区 $C_S$ 由小团的 $S=4$ 个节点组成。完全在此社区内的边数 $e_S$ 是大小为 $S$ 的完全图中的边数。\n$e_S = \\frac{S(S-1)}{2} = \\frac{4(3)}{2} = 6$。\n\n每个社区的度之和 $d_L$ 和 $d_S$ 使用的是来自完整图的度 $k_i$。\n- 对于 $C_L$：$d_L = \\sum_{i \\in C_L} k_i = (L-1)(L-1) + L = (11)(11) + 12 = 121 + 12 = 133$。\n- 对于 $C_S$：$d_S = \\sum_{i \\in C_S} k_i = (S-1)(S-1) + S = (3)(3) + 4 = 9 + 4 = 13$。\n作为检验，$d_L + d_S = 133 + 13 = 146 = 2m$。\n\n此划分的模块度 $Q_2(\\gamma)$ 是每个社区贡献的总和：\n$$Q_2(\\gamma) = \\left[ \\frac{e_L}{m} - \\gamma \\left(\\frac{d_L}{2m}\\right)^2 \\right] + \\left[ \\frac{e_S}{m} - \\gamma \\left(\\frac{d_S}{2m}\\right)^2 \\right]$$\n$$Q_2(\\gamma) = \\frac{e_L + e_S}{m} - \\gamma \\left[ \\left(\\frac{d_L}{2m}\\right)^2 + \\left(\\frac{d_S}{2m}\\right)^2 \\right]$$\n代入我们计算出的值：\n$e_L + e_S = 66 + 6 = 72$。\n$m=73$。\n$d_L = 133$。\n$d_S = 13$。\n$2m = 146$。\n$$Q_2(\\gamma) = \\frac{72}{73} - \\gamma \\left[ \\frac{133^2 + 13^2}{146^2} \\right]$$\n\n当 $Q_2(\\gamma) > Q_1(\\gamma)$ 时，两社区划分更优。临界分辨率 $\\gamma_c$ 是两个模块度相等时的值，即 $Q_2(\\gamma_c) = Q_1(\\gamma_c)$。\n$$ \\frac{e_L + e_S}{m} - \\gamma_c \\frac{d_L^2 + d_S^2}{(2m)^2} = 1 - \\gamma_c $$\n重新整理以求解 $\\gamma_c$：\n$$ \\gamma_c \\left( 1 - \\frac{d_L^2 + d_S^2}{(2m)^2} \\right) = 1 - \\frac{e_L + e_S}{m} $$\n括号中的左侧项可以使用 $2m = d_L + d_S$ 进行简化：\n$$ 1 - \\frac{d_L^2 + d_S^2}{(d_L+d_S)^2} = \\frac{(d_L+d_S)^2 - (d_L^2 + d_S^2)}{(d_L+d_S)^2} = \\frac{2d_L d_S}{(d_L+d_S)^2} = \\frac{2d_L d_S}{(2m)^2} $$\n等式的右侧是：\n$$ 1 - \\frac{e_L + e_S}{m} = \\frac{m - (e_L + e_S)}{m} $$\n由于 $e_L+e_S$ 代表了除连接边之外的所有边，所以 $m = (e_L+e_S)+1$，因此 $m - (e_L+e_S) = 1$。右侧是 $\\frac{1}{m}$。\n将这些代回关于 $\\gamma_c$ 的方程中：\n$$ \\gamma_c \\left( \\frac{2d_L d_S}{(2m)^2} \\right) = \\frac{1}{m} $$\n$$ \\gamma_c = \\frac{1}{m} \\frac{(2m)^2}{2d_L d_S} = \\frac{4m^2}{2m d_L d_S} = \\frac{2m}{d_L d_S} $$\n这为该图拓扑结构中的临界分辨率提供了一个通用公式。分离稀有团的条件是 $\\gamma > \\gamma_c = \\frac{2m}{d_L d_S}$。\n\n现在，我们代入数值：\n$m=73$, $d_L=133$, $d_S=13$。\n$$ \\gamma_c = \\frac{2 \\times 73}{133 \\times 13} = \\frac{146}{1729} $$\n分子是 $2 \\times 73$。分母不能被 $2$ 或 $73$ 整除（$1729 = 23 \\times 73 + 20$）。因此，该分数为不可约分数。\n\n使两社区划分的模块度严格更大的 $\\gamma$ 的范围是 $\\gamma > \\frac{146}{1729}$。临界值是 $\\gamma_c$。", "answer": "$$\\boxed{\\frac{146}{1729}}$$", "id": "3317960"}]}