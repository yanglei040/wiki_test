## 引言
[单细胞测序](@entry_id:198847)技术的发展使我们能够在前所未有的分辨率下解构[生物系统](@entry_id:272986)的复杂性。特别是[CITE-seq](@entry_id:150689)和[ATAC-seq](@entry_id:169892)等多模态技术的出现，允许我们从同一个细胞或同一组织样本中同时获取[转录组](@entry_id:274025)、[蛋白质组](@entry_id:150306)和[表观基因组](@entry_id:272005)等多个层面的信息。这种多维度的视图为理解细胞状态、身份和功能提供了无与伦比的机会。然而，这些不同模态的数据在生物学来源、技术噪声和统计分布上存在巨大差异。例如，[scRNA-seq](@entry_id:155798)数据稀疏且高度离散，ADT蛋白数据呈多峰[分布](@entry_id:182848)，而[scATAC-seq](@entry_id:166214)数据则更为稀疏且近似二元。如何有效地整合这些[异构数据](@entry_id:265660)，消除技术差异，同时保留并增强生物信号，是当前计算生物学面临的一大核心挑战。

本文旨在系统性地阐述应对这一挑战的计算策略。在“原理与机制”一章中，我们将深入探讨[CITE-seq](@entry_id:150689)和[ATAC-seq](@entry_id:169892)数据的基本特性、质量控制标准，以及驱动整合算法（如MNN、WNN和MOFA+）的核心统计假设与数学原理。接下来，在“应用与跨学科交叉”一章中，我们将展示这些整合方法如何应用于构建统一的[细胞图谱](@entry_id:270083)、推断复杂的基因调控网络，并连接到系统动力学和跨物种比较等更广泛的生物学问题。最后，“动手实践”部分将提供具体的编程练习，引导读者亲手实现关键的整合步骤，将理论知识转化为实践技能。通过这一结构化的学习路径，读者将能够全面掌握多模态单细胞数据整合的理论精髓与应用技巧。

## 原理与机制

本章旨在深入探讨[多模态单细胞整合](@entry_id:752297)的核心科学原理与计算机制。我们将从构成 [CITE-seq](@entry_id:150689) 和 [ATAC-seq](@entry_id:169892) 数据独特属性的基础测量过程出发，系统性地建立一个框架，以理解为何以及如何整合这些异构的数据类型。我们将阐述[数据质量](@entry_id:185007)控制、标准化的必要性，并剖析多种前沿整合算法背后的基本假设与数学原理。

### 多模态测量的基础

为了有效整合多种数据类型，我们必须首先理解每种模态（modality）的生成过程、数据特性及其固有的噪声来源。[单细胞分析](@entry_id:274805)中的一项核心挑战源于这样一个事实：不同的分子测量技术不仅捕捉不同的生物层面，其底层的[随机过程](@entry_id:159502)、捕获效率和技术偏差也截然不同。

#### [CITE-seq](@entry_id:150689)：同时测量转录组和表面蛋白

**[CITE-seq](@entry_id:150689)（通过测序进行细胞[转录组](@entry_id:274025)和[表位](@entry_id:175897)索引）**是一项革命性技术，它能够从同一个单细胞中同时测量信使RNA（mRNA）的表达丰度和细胞表面蛋白（通过[抗体](@entry_id:146805)衍生的标签，**ADT**）的丰度。这两种分子的捕获和量化机制存在根本差异，理解这些差异对于后续分析至关重要。

在一个典型的基于微液滴的 [CITE-seq](@entry_id:150689) 实验中，带有寡[核苷酸](@entry_id:275639) dT（oligo-dT）[引物](@entry_id:192496)的微珠被用来捕获带有聚[腺苷](@entry_id:186491)酸（poly(A)）尾的分子。这天然适用于捕获[真核细胞](@entry_id:170571)的 mRNA。为了同时捕获蛋白质，实验中使用的[抗体](@entry_id:146805)被人为地连接上了一段合成的 DNA 寡[核苷酸](@entry_id:275639)，这段寡[核苷酸](@entry_id:275639)同样包含一个 poly(A) 序列。因此，mRNA 和 ADT 寡[核苷酸](@entry_id:275639)能够被同一个 oligo-dT [引物](@entry_id:192496)捕获。

在测序文库的制备过程中，每个捕获的分子都会被标记上一个**[细胞条形码](@entry_id:171163)（cell barcode）**，用于识别其来源细胞；以及一个**[唯一分子标识符](@entry_id:192673)（Unique Molecular Identifier, UMI）**，用于在后续的 PCR 扩增前对每个独立的原始分子进行唯一标记。扩增后，通过对具有相同[细胞条形码](@entry_id:171163)、UMI 和特征标识符的测序读数进行去重，我们可以得到每个细胞中每种分子的原始捕获数量，即 **UMI 计数**。

两种模态的特征识别方式也不同：
*   对于 **RNA**，其特征（即基因身份）是通过将测序得到的 cDNA 序列与参考[转录组](@entry_id:274025)或基因组进行比对来确定的。
*   对于 **ADT**，其特征（即[抗体特异性](@entry_id:201089)）是通过测序[抗体](@entry_id:146805)上预先设计的**[抗体](@entry_id:146805)条形码**来识别的。

尽管共享相似的条形码结构，RNA 和 ADT 的数据特性和噪声来源却大相径庭。RNA 的 UMI 计数反映了细胞内转录和降解的[随机过程](@entry_id:159502)（常被称为**[转录爆发](@entry_id:156205) (transcriptional bursting)**），以及捕获过程中的[随机抽样](@entry_id:175193)。这导致了 RNA 计数数据通常是高度稀疏的（含有大量的零值）且**过度分散 (overdispersed)**（[方差](@entry_id:200758)大于均值）。此外，来自破损细胞的游离 RNA（即**环境 RNA (ambient RNA)**）也可能被包裹进液滴，造成背景噪声。

相比之下，ADT 的 UMI 计数反映了[抗体](@entry_id:146805)与其细胞表面表位的结合事件。在低占有率（low-occupancy regime）的假设下，这些结合事件近似独立。ADT 数据的主要噪声来源包括：(1) 未结合到细胞上但被包裹进液滴的游离[抗体](@entry_id:146805)寡[核苷酸](@entry_id:275639)（**环境 ADT**）；(2) [抗体](@entry_id:146805)与非目标蛋白的**[非特异性结合](@entry_id:190831)**。这些噪声源的性质与 RNA 环境噪声不同，常常导致 ADT 计数呈现双峰或多峰[分布](@entry_id:182848)（一个具有背景信号的“阴性”细胞群和一个具有真实信号的“阳性”细胞群），因此需要特殊的噪声建模方法，如[混合模型](@entry_id:266571)，来进行校正。[@problem_id:3330176]

#### [ATAC-seq](@entry_id:169892)：探测[染色质可及性](@entry_id:163510)

**[ATAC-seq](@entry_id:169892)（利用转座酶进行高通量测序的[染色质可及性](@entry_id:163510)分析）**通过使用超活性的 **Tn5 转座酶**来切割开放的[染色质](@entry_id:272631)区域，从而在[全基因组](@entry_id:195052)范围内描绘染色质的“可及性”图谱。在单细胞层面（[scATAC-seq](@entry_id:166214)），这为我们提供了每个细胞中活跃的调控元件（如[启动子](@entry_id:156503)、增强子）的信息。

与 UMI 计数的 scRNA-seq 数据相比，[scATAC-seq](@entry_id:166214) 数据（通常是非 UMI 计数的）具有其独特的统计特性。我们可以为 [scATAC-seq](@entry_id:166214) 数据构建一个测量模型。令 $X_{pc}$ 表示细胞 $c$ 中某个[染色质](@entry_id:272631)区域（或称**峰 (peak)**）$p$ 的读数计数。其生成过程可被概念化如下：
1.  **潜在状态**：染色质区域 $p$ 在细胞 $c$ 中的可及性是一个潜在的二元状态，记为 $A_{pc} \in \{0, 1\}$。
2.  **片段生成率**：如果一个区域是可及的（$A_{pc}=1$），Tn5 转座酶能够切入并产生可测序的 DNA 片段。产生独特片段的速率 $\mu_{pc}$ 不仅取决于细胞的[测序深度](@entry_id:178191) $s_c$，还受到多种偏差的影响，这些偏差可以被建模为乘性因子。例如，Tn5 [转座酶](@entry_id:273476)对特定的 DNA 序列有插入偏好（$b_p^{\mathrm{Tn5}}$），同时区域的 GC 含量也影响片段的生成和扩增效率（$b_p^{\mathrm{GC}}$）。因此，独特片段的生成率可表示为 $\mu_{pc} = s_c \lambda_p A_{pc} b_p^{\mathrm{Tn5}} b_p^{\mathrm{GC}}$，其中 $\lambda_p$ 是一个峰特异性的基础速率。
3.  **PCR 扩增**：在标准的 [scATAC-seq](@entry_id:166214) 流程中，独特的片段在没有 UMI 的情况下被 PCR 扩增。这引入了[乘性](@entry_id:187940)的、随机的扩增偏差。这种现象可以通过一个两级模型来描述：首先，独特片段的数量 $U_{pc}$ 服从[泊松分布](@entry_id:147769) $\mathrm{Poisson}(\mu_{pc})$；然后，观测到的读数 $X_{pc}$ 是经过随机扩增后的结果。这种泊松-伽马混合过程最终导致观测计数 $X_{pc}$ 服从**[负二项分布](@entry_id:262151)（Negative Binomial, NB）**，其过度分散性主要反映了技术性的 PCR 扩增噪声，而非像 scRNA-seq 那样的生物学变异。
4.  **数据特性**：与 [scRNA-seq](@entry_id:155798) 相比，[scATAC-seq](@entry_id:166214) 数据通常**更为稀疏**。一个细胞中只有一小部分基因组是开放的，因此在大量的峰中，每个细胞的读数集中在少数区域。此外，[scATAC-seq](@entry_id:166214) 的二元检测概率 $P(X_{pc}>0)$ 会随着[测序深度](@entry_id:178191) $s_c$ 的增加而饱和（趋近于1），而 scRNA-seq 的期望 UMI 计数则与 $s_c$ 近似线性增长，没有内在的[饱和点](@entry_id:754507)。[@problem_id:3330249]

### [数据质量](@entry_id:185007)控制与预处理

在进行任何整合分析之前，必须对原始数据进行严格的质量控制（QC）和[预处理](@entry_id:141204)，以去除低质量的细胞并使不同模态的数据具有可比性。

#### [scATAC-seq](@entry_id:166214) 质量控制

对于 [scATAC-seq](@entry_id:166214) 数据，两个关键的 QC 指标是 **TSS 富集分数（TSS enrichment score）** 和 **峰内读数比例（Fraction of Reads in Peaks, FRiP）**。

**TSS 富集**衡量的是测序读数在**[转录起始位点](@entry_id:263682)（Transcription Start Sites, TSSs）**周围的富集程度。其计算方法是：将所有 TSSs 位点为中心，计算中心小窗口内的[标准化](@entry_id:637219)插入密度，并将其与侧翼背景窗口的密度进行比较，得出其比值。由于活跃的基因[启动子](@entry_id:156503)通常位于高度开放的[染色质](@entry_id:272631)中，高质量的细胞文库应该在 TSSs 位置显示出明显的信号峰。对于一个纯粹由随机插入组成的背景噪声文库，其 TSS 富集分数应接近 $1$。因此，一个远高于 $1$ 的分数（例如，对于哺乳动物细胞，通常要求 $\ge 6-8$）表明了高的[信噪比](@entry_id:185071)。

**FRiP** 指的是一个细胞中，落在预先定义的一组“共有”峰区域内的独特测序片段所占的比例。这些共有峰代表了在细胞群体中普遍存在的、推测有功能的调控元件。如果一个文库主要由随机背景噪声构成，其 FRiP 值将约等于这些峰区域占整个可比对基因组的比例（通常很低，例如约 $0.02$）。一个高质量的细胞，其 Tn5 插入应优先发生于开放的染色质，因此会表现出远高于此背景水平的 FRiP 值（例如，$\ge 0.15-0.25$）。

需要注意的是，这些 QC 指标的可靠性取决于文库的复杂度，即每个细胞的独特片段总数 $n_u$。对于 $n_u$ 很低的细胞，FRiP 值的估计会因[抽样误差](@entry_id:182646)而变得不稳定。因此，设置 QC 阈值时通常需要同时考虑最小的 $n_u$。[@problem_id:3330182]

#### [多模态数据](@entry_id:635386)的[标准化](@entry_id:637219)与缩放

不同模态的原始数据处于截然不同的数值尺度上，这给联合分析带来了巨大挑战。例如，RNA 计数通常很大，而 ATAC 计数则非常稀疏。直接拼接这些未经处理的数据向量进行下游分析（如计算距离或降维），会导致[数值范围](@entry_id:752817)较大的模态完全主导结果，而其他模态的贡献则被淹没。因此，必须对每个模态应用适当的[标准化](@entry_id:637219)方法。

常见的策略包括：
*   **RNA 数据**：应用**文库大小归一化（size-factor normalization）**。将每个细胞中的基因计数除以该细胞的总 UMI 计数（文库大小），然后乘以一个常数（如 $10^4$）。这可以校正[测序深度](@entry_id:178191)差异。
*   **ADT 数据**：由于其成分性（compositional）和多峰[分布](@entry_id:182848)的特性，通常应用**中心化对数比（Centered Log-Ratio, CLR）**变换。对于一个细胞，首先对每个蛋白的计数加一个伪计数（pseudocount）以避免零值问题，然后计算每个蛋白的计数值与该细胞中所有蛋白计[数的几何](@entry_id:192990)平均值之比的自然对数。CLR 变换将数据置于一个均值为零的对数空间，有助于稳定[方差](@entry_id:200758)并突出相对丰度的变化。
*   **ATAC 数据**：[scATAC-seq](@entry_id:166214) 数据极其稀疏，类似于文本文档中的词频数据。因此，可以借鉴信息检索领域的**[词频-逆文档频率](@entry_id:634366)（Term Frequency-Inverse Document Frequency, [TF-IDF](@entry_id:634366)）**变换。词频（TF）是细胞内某个峰的读数计数除以该细胞的总读数，用于校正细胞间的[测序深度](@entry_id:178191)差异。逆文档频率（IDF）是总细胞数与含有该峰读数的细胞数之比的对数。IDF 项会给在少数细胞中特异性出现的峰（可能标记稀有细胞类型）更高的权重，而降低在许多细胞中普遍存在的“管家”峰的权重。[TF-IDF](@entry_id:634366) 值是 TF 和 IDF 的乘积。

一个具体的计算示例可以清晰地展示尺度差异问题。假设经过上述变换后，一个细胞的 RNA [特征值](@entry_id:154894)在 $10^3$ 到 $10^4$ 的[数量级](@entry_id:264888)，而其 ADT（CLR变换后）和 ATAC（[TF-IDF](@entry_id:634366)变换后）的[特征值](@entry_id:154894)则在 $10^0$ 的[数量级](@entry_id:264888)。如果直接拼接这些向量计算细胞间的欧氏距离，其总距离将几乎完全由 RNA 模态的差异决定。为了实现更平衡的整合，需要在拼接前进行额外的缩放，例如对每个模态的特征子向量进行 L2 归一化，或者对拼接后的整个特征矩阵进行 Z-score 标准化。更高级的方法则会学习数据驱动的权重来平衡不同模态的贡献。[@problem_id:3330246]

### 整合的原理：连接分子层面

多模态整合的根本目标是利用在同一细胞中测量的不同分子层面的信息来揭示细胞[状态和](@entry_id:193625)调控逻辑。这要求我们理解不同模态之间的生物学关联以及进行统计推断所需的假设。

#### 生物学因果链与时间尺度

基因调控遵循[分子生物学](@entry_id:140331)的[中心法则](@entry_id:136612)，这是一个涉及多个步骤且具有不同时间尺度的动态过程。将 [scATAC-seq](@entry_id:166214)、[scRNA-seq](@entry_id:155798) 和 [CITE-seq](@entry_id:150689)-ADT 的测量结果联系起来，可以帮助我们重建这一调控链的快照。

考虑一个正向调控因子（[转录因子](@entry_id:137860)）$T$ 和它的靶基因 $g$。我们可以定义以下几个量：
*   $M(t)$：在 $g$ 的调控区域内，$T$ 的**基序可及性 (motif accessibility)**，由 [scATAC-seq](@entry_id:166214) 数据推断。
*   $P_T(t)$：[转录因子](@entry_id:137860) $T$ 的**蛋白丰度**，由 [CITE-seq](@entry_id:150689) ADT 测量。
*   $A(t)$：[转录因子](@entry_id:137860) $T$ 的有效**调控活性 (regulatory activity)**，这取决于其浓度、染色质结合、[翻译后修饰](@entry_id:138431)和亚细胞定位。
*   $R_g(t)$：靶基因 $g$ 的 **mRNA 丰度**，由 scRNA-seq 测量。

这些量之间的因果关系如下：$T$ 的蛋白丰度 $P_T(t)$ 和其基序的可及性 $M(t)$ 共同决定了 $T$ 的调控活性 $A(t)$。更高的蛋白丰度和更开放的[染色质](@entry_id:272631)使得 $T$ 更容易结合到 $g$ 的调控元件上，从而增加 $g$ 的转录速率，并经过一段时间的延迟（由 mRNA 的[半衰期](@entry_id:144843)决定，通常为数十分钟到数小时）后，导致 $R_g(t)$ 的升高。同时，$T$ 蛋白自身的丰度 $P_T(t)$ 也是其编码[基因转录](@entry_id:155521)和翻译的结果，其变化尺度通常比 mRNA 更慢（数小时到数十小时）。

因此，在单个时间点观察到的跨细胞关联性，反映了这些不同时间尺度过程达到的一种准[稳态](@entry_id:182458)。我们预期对于一个激活子 $T$，$M(t)$ 和 $P_T(t)$ 与 $R_g(t)$ 之间存在正相关关系。然而，这种关联并非完美，$M(t)$ 只是结合的必要非充分条件，而 $P_T(t)$ 也只是 $A(t)$ 的一个不完美代理（因其忽略了翻译后修饰）。理解这些延迟和间接关系是正确解释整合数据中[调控网络](@entry_id:754215)的关键。[@problem_id:3330220]

#### 统计可识别性与核心假设

当我们将不同实验（例如，一个 [CITE-seq](@entry_id:150689) 实验和一个 [ATAC-seq](@entry_id:169892) 实验）的数据进行整合时，我们面临一个根本的统计挑战：**可识别性（identifiability）**。

*   **配对情景 (Paired scenario)**：如果蛋白质（$X$）和[染色质可及性](@entry_id:163510)（$Y$）是在**完全相同**的细胞中测量的，我们直接观察到联合分布 $p_{X,Y}(x,y)$ 的样本。在这种情况下，模态间的条件关系，如 $p_{Y|X}(y|x)$，是可非参数地识别的。
*   **非配对情景 (Unpaired scenario)**：如果我们有两个**不相交**的细胞集，一个测量了 $X$，另一个测量了 $Y$，我们只能观察到边缘[分布](@entry_id:182848) $p_X(x)$ 和 $p_Y(y)$。从这些边缘[分布](@entry_id:182848)中，我们无法唯一确定它们背后的联合分布。存在无限多个可能的[联合分布](@entry_id:263960)（或称“耦合”）可以具有相同的边缘[分布](@entry_id:182848)。

为了在非配对情景下进行有意义的整合（即“对齐”细胞状态），我们必须引入额外的结构性假设。这些假设构成了大多数整合算法的理论基石：
1.  **[交换性](@entry_id:140240) (Exchangeability) / 共享的潜在[分布](@entry_id:182848)**：我们假设来自不同实验的细胞都来自于同一个潜在的生物学群体。这意味着存在一个共享的、未被观察到的**潜在[状态空间](@entry_id:177074)**（latent space），而两个实验中的细胞都是从这个空间中[独立同分布](@entry_id:169067)地抽样得到的。
2.  **[稳态](@entry_id:182458)性 (Stationarity)**：我们假设从一个给定的潜在状态 $z$ 到其分子观测（如蛋白质 $X$ 或[染色质可及性](@entry_id:163510) $Y$）的生成过程（即发射模型 $p_{X|Z}$ 和 $p_{Y|Z}$）在不同实验之间是不变的。这个假设保证了潜在状态 $z$ 在不同数据集中具有一致的生物学意义。
3.  **支持集重叠 (Support overlap)**：我们必须假设两个实验采样的细胞状态范围存在重叠。如果没有共同的细胞状态作为“桥梁”，任何对齐都将是无根据的外推。

在实际应用中，一种强大的策略是采用**半监督**方法，即利用一小部分配对数据来“锚定”整合模型。在配对数据上学习到的模态间关系（通过[稳态](@entry_id:182458)性假设）可以被推广和传播到大量的非配对数据中，从而解决非配对整合中的可识别性问题。[@problem_id:3330210]

### 整合的机制：算法与概念

基于上述原理，研究者们开发了多种计算方法来整合[多模态数据](@entry_id:635386)。这些方法可以大致分为几类，每类都基于不同的核心思想。

#### 基于校正的整合方法

这类方法旨在识别并移除由技术差异（而非生物学差异）引起的数据变异，即**[批次效应](@entry_id:265859)（batch effects）**。在多模态整合中，“模态”本身可以被视为一种“批次”。一个成功的整合方法需要在消除[批次效应](@entry_id:265859)的同时，最大限度地**保留生物信号**。这其中存在一个关键的权衡：

*   **欠校正 (Undercorrection)**：未能充分移除批次效应，导致相同类型的细胞因来源批次（或模态）不同而在整合后的空间中被人为地分开。
*   **过校正 (Overcorrection)**：校正力度过大，不仅消除了技术噪声，还错误地将生物学上不同但彼此邻近的细胞群合并在一起，从而丢失了真实的生物[异质性](@entry_id:275678)。

许多整合算法通过一个可调参数来控制校正强度，在欠校正与过校正之间寻求平衡。[@problem_id:3330186]

**互近邻（Mutual Nearest Neighbors, MNN）**
MNN 是一种基于几何思想的校正方法。其核心逻辑是，在某个共享的（或对齐的）特征空间中，如果数据点 $i$（来自数据集1）的最近邻是数据点 $j$（来自数据集2），同时 $j$ 的最近邻也是 $i$，那么 $(i, j)$ 就构成一个 **MNN 对**。这些 MNN 对被认为是代表相同生物学状态的、跨数据集的可靠“锚点”。

MNN 算法假设[批次效应](@entry_id:265859)在局部是线性和平滑的，即在一个小的邻域内，由[批次效应](@entry_id:265859)引起的位移向量是近似恒定的。算法通过计算 MNN 对之间的位移向量，并在一个局部邻域内对这些向量进行加权平均，来估计每个细胞应受到的**校正向量**。然后将这个校正向量应用于细胞的坐标，从而实现数据集的对齐。MNN 的一个显著优点是它对不同数据集中细胞类型比例不均衡的情况具有鲁棒性。然而，它的性能依赖于所选[距离度量](@entry_id:636073)的有效性，并且可能受到细胞密度显著不平衡的影响。[@problem_id:3330192]

**和谐（Harmony）**
Harmony 是一种基于迭代式[软聚类](@entry_id:635541)的整合方法。它不直接计算校正向量，而是通过优化一个目标函数来学习一个整合后的低维嵌入。该[目标函数](@entry_id:267263)包含多个项，旨在同时实现：
*   **紧凑的[软聚类](@entry_id:635541)**：鼓励细胞围绕[聚类](@entry_id:266727)中心紧密[分布](@entry_id:182848)。
*   **批次多样性**：通过一个惩罚项（通常是 KL 散度），促使每个[聚类](@entry_id:266727)内部的细胞批次构成比例趋向于全局的批次构成比例。
*   **批次特异性偏移校正**：模型为每个“批次-[聚类](@entry_id:266727)”对学习一个特定的偏移向量 $\delta_{bc}$，以捕捉和消除批次效应。
*   **邻域结构保持**：可以通过一个图[拉普拉斯正则化](@entry_id:634509)项来保持原始数据中的细胞邻近关系。对于[多模态数据](@entry_id:635386)，可以构建一个融合的邻接图 $A = w_{\mathrm{RNA}} A^{\mathrm{RNA}} + w_{\mathrm{ADT}} A^{\mathrm{ADT}} + w_{\mathrm{ATAC}} A^{\mathrm{ATAC}}$，其中 $A^{(m)}$ 是从模态 $m$ 构建的邻接矩阵，$w_m$ 是模态权重。

通过迭代优化细胞的[软聚类](@entry_id:635541)分配和低维嵌入，Harmony 能够将来自不同批次的同类细胞混合在一起，同时保持不同细胞类型的分离。[@problem_id:3330178]

#### 基于加权邻域的整合方法

**加权最近邻（Weighted Nearest Neighbor, WNN）**
与上述试图对所有模态进行同等校正或融合的方法不同，WNN 方法认识到，对于不同的细胞类型或状态，不同模态的信息含量可能是不同的。例如，对于区分两种具有相似转录组但表面蛋白差异巨大的 T 细胞亚型，ADT 模态比 RNA 模态更具信息量。

WNN 的核心思想是为每个细胞学习一套**模态权重**。它首先在每个模态内部独立地构建细胞邻域图。然后，对于每个细胞 $c$，它评估该细胞的每种模态 $m$ 在预测其他模态所定义的局部邻域结构方面的表现。这种表现通过一个**预测误差** $E_c^{(m)}$ 来量化。误差越小，说明该模态在该细胞的局部邻域中与其他模态的一致性越好，信息量也越可靠。

这些误差随后被转换成归一化的权重 $\alpha_c^{(m)}$。这一转换通常通过 **softmax 函数** 完成：
$$ \alpha_{c}^{(m)} = \frac{\exp(-E_{c}^{(m)})}{\sum_{m'} \exp(-E_{c}^{(m')})} $$
从这个公式可以看出，预测误差 $E_c^{(m)}$ 越低，其对应的权重 $\alpha_c^{(m)}$ 就越高。这些权重是细胞特异性的，并且在所有模态上总和为 1。最后，WNN 使用这些权重来构建一个加权的组合邻域图，其中任意两个细胞之间的距离是它们在每个模态内部距离的加权组合。这个最终的图可用于下游分析，如[降维](@entry_id:142982)和[聚类](@entry_id:266727)。例如，对于一个预测误差为 $E_c^{(\mathrm{RNA})} = 0.36$、$E_c^{(\mathrm{ADT})} = 0.21$ 和 $E_c^{(\mathrm{ATAC})} = 0.57$ 的细胞，其对应的权重将分别为 $\begin{pmatrix} 0.3364 & 0.3909 & 0.2727 \end{pmatrix}$，表明在此细胞的局部环境中，ADT 模态提供了最一致的信息。[@problem_id:3330171]

#### 概率性[潜变量模型](@entry_id:174856)

这类方法，如**[多组学](@entry_id:148370)[因子分析](@entry_id:165399)（Multi-Omics Factor Analysis, MOFA+）**，采用生成模型的框架。它们假设观察到的[多组学](@entry_id:148370)数据是由一组低维的、未被观察到的**潜变量**或**因子**生成的。

MOFA+ 模型是一个线性的高斯[潜变量模型](@entry_id:174856)。它将每个细胞的观测数据（经过适当的[方差](@entry_id:200758)稳定化变换后）建模为：
$$ y^{(m)}_{ij} \sim \mathcal{N}\left( z_i^\top w^{(m)}_j + \left(z_i^{(m)}\right)^\top u^{(m)}_j, \sigma^{2}_{m,j} \right) $$
其中，$y^{(m)}_{ij}$ 是细胞 $i$ 在模态 $m$ 中特征 $j$ 的观测值。$z_i$ 是所有模态**共享的因子**，而 $z_i^{(m)}$ 是**模态特异性的因子**。$w_j^{(m)}$ 和 $u_j^{(m)}$ 是相应的[载荷向量](@entry_id:635284)，它们将低维因子映射到高维的[特征空间](@entry_id:638014)。

通过对模型参数和[潜变量](@entry_id:143771)进行贝叶斯推断（通常使用**[变分推断](@entry_id:634275)**），MOFA+ 可以：
1.  **推断[潜因子](@entry_id:182794)**：这些因子代表了[细胞异质性](@entry_id:262569)的主要驱动因素。
2.  **解耦变异来源**：通过区分共享因子和模态特异性因子，模型能够识别出是哪些生物学过程驱动了跨模态的协同变化，哪些过程则只影响单一模态。
3.  **量化[方差](@entry_id:200758)贡献**：模型允许计算每个因子对每个模态总[方差](@entry_id:200758)的贡献比例（Proportion of Variance Explained, PVE）。这有助于解释每个因子的生物学意义。例如，一个主要解释 [ATAC-seq](@entry_id:169892) 和 RNA-seq [方差](@entry_id:200758)的共享因子可能与[转录调控](@entry_id:268008)相关，而一个只解释 ADT [方差](@entry_id:200758)的因子可能与翻译后过程或细胞间相互作用相关。
4.  **处理缺失值**：作为一种[生成模型](@entry_id:177561)，它可以自然地处理某些细胞中缺失整个模态的情况。

模型中对载荷使用的**[自动相关性确定](@entry_id:746592)（Automatic Relevance Determination, ARD）**先验是一种稀疏性先验，它可以在推断过程中自动地将不相关的载荷“裁剪”为零。这使得模型能够从数据中学习每个因子在哪些模态中是活跃的，从而提高了模型的可解释性。[@problem_id:3330168]