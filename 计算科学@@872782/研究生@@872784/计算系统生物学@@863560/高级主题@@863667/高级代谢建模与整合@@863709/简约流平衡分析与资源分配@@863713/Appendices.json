{"hands_on_practices": [{"introduction": "简约通量平衡分析（pFBA）等方法旨在解决标准FBA中的简并性问题，其核心假设是细胞会以最经济的方式分配其有限的资源。这个练习将这一抽象原则与具体的生物物理现实联系起来，要求您直接计算维持特定代谢通量所需的酶质量。通过比较两种不同酶促反应的资源成本，您将深入理解简约性原则背后的生物学依据，并探索最小化总通量与最小化总酶质量之间的关系。", "problem": "一个单室代谢网络通过两条备选的、不可逆的酶催化反应 $R_{1}$ 和 $R_{2}$ 将内部代谢物 $A$ 转化为生物质 $X$，其化学计量为 $A \\to X$。假设从 $A$ 到 $X$ 的化学计量产率对于 $R_{1}$ 和 $R_{2}$ 是相同的，并且 $A$ 的任何上游供应都是无限制的。细胞需要维持一个固定的生物质生产通量 $v^{\\star} > 0$（单位为 $\\text{mmol} \\ \\text{gDW}^{-1} \\ \\text{h}^{-1}$）。令 $v_{1}$ 和 $v_{2}$ 分别表示通过 $R_{1}$ 和 $R_{2}$ 的通量，并假设 $v_{1}, v_{2} \\ge 0$。生物质生产要求意味着 $v_{1} + v_{2} = v^{\\star}$。\n\n每个反应 $R_{i}$ 由一种专一性酶催化，其催化转换数 $k_{\\text{cat},i}$（单位为 $\\text{h}^{-1}$）和每摩尔酶的酶质量 $\\rho_{i}$（单位为 $\\text{g}_{\\text{enzyme}} \\ \\text{mmol}_{\\text{enzyme}}^{-1}$）。酶量 $e_{i}$（单位为 $\\text{mmol}_{\\text{enzyme}} \\ \\text{gDW}^{-1}$）满足催化能力约束 $v_{i} \\le k_{\\text{cat},i} \\, e_{i}$。用于这两个反应的总酶质量为 $M = \\rho_{1} e_{1} + \\rho_{2} e_{2}$。\n\n考虑两个建模目标：\n\n1. 酶质量最小化（一种资源分配模型）：在稳态通量平衡和催化约束条件下，最小化 $M$。\n2. 未加权简约通量平衡分析（pFBA）：在固定 $v_{1} + v_{2} = v^{\\star}$ 后，最小化催化反应通量的未加权 $L_1$-范数，此处取为 $F = |v_{1}| + |v_{2}|$。\n\n假设这两种酶的参数对为 $(k_{\\text{cat},1}, \\rho_{1}) = (100, 1)$ 和 $(k_{\\text{cat},2}, \\rho_{2}) = (10, 0.1)$，其中所有数值均采用上述单位。在附加限制条件下，即在每种情景中，全部生物质通量仅通过单一反应进行（即，要么 $v_{1} = v^{\\star}, v_{2} = 0$，要么 $v_{1} = 0, v_{2} = v^{\\star}$），计算以下两个量：\n\n- 当通量仅通过 $R_{1}$ 与仅通过 $R_{2}$ 时，最小化酶质量目标值的比率 $R$。\n- 当通量仅通过 $R_{1}$ 与仅通过 $R_{2}$ 时，最小化未加权pFBA通量成本的比率 $P$。\n\n将您的最终答案表示为行矩阵 $\\begin{pmatrix} R  P \\end{pmatrix}$。无需四舍五入。最终答案必须是一个不带单位的单一数值行矩阵。", "solution": "该问题要求计算两个比率 $R$ 和 $P$，用于比较在两种特定的通量路径情景下，与两种不同建模目标——酶质量最小化和未加权简约通量平衡分析（pFBA）——相关的成本。\n\n我们首先分析酶质量最小化目标。总酶质量 $M$ 由下式给出：\n$$M = \\rho_{1} e_{1} + \\rho_{2} e_{2}$$\n其中 $\\rho_{i}$ 是每摩尔酶的质量，$e_{i}$ 是反应 $R_{i}$ 的酶量。通量 $v_{i}$ 受酶的催化能力约束：\n$$v_{i} \\le k_{\\text{cat},i} \\, e_{i}$$\n其中 $k_{\\text{cat},i}$ 是催化转换数。为了在给定非零通量 $v_{i}$ 的情况下最小化酶质量 $M$，细胞必须在最大催化效率下运行。这意味着所需的最小酶量由以下等式确定：\n$$v_{i} = k_{\\text{cat},i} \\, e_{i}$$\n由此，我们可以用通量 $v_{i}$ 来表示所需的酶量 $e_{i}$：\n$$e_{i} = \\frac{v_{i}}{k_{\\text{cat},i}}$$\n将此代回总酶质量 $M$ 的表达式中，我们得到以通量表示的目标函数：\n$$M(v_{1}, v_{2}) = \\rho_{1} \\frac{v_{1}}{k_{\\text{cat},1}} + \\rho_{2} \\frac{v_{2}}{k_{\\text{cat},2}}$$\n$\\frac{\\rho_{i}}{k_{\\text{cat},i}}$ 项表示通过反应 $R_{i}$ 的单位通量的酶质量成本。我们使用给定的参数来计算这些成本：\n$(k_{\\text{cat},1}, \\rho_{1}) = (100, 1)$ 和 $(k_{\\text{cat},2}, \\rho_{2}) = (10, 0.1)$。\n\n对于反应 $R_{1}$，单位通量的酶质量成本为：\n$$\\frac{\\rho_{1}}{k_{\\text{cat},1}} = \\frac{1}{100}$$\n对于反应 $R_{2}$，单位通量的酶质量成本为：\n$$\\frac{\\rho_{2}}{k_{\\text{cat},2}} = \\frac{0.1}{10} = \\frac{1}{100}$$\n值得注意的是，两种反应的单位通量酶质量成本是相同的。\n\n问题要求我们在给定总生物质生产通量为 $v_{1} + v_{2} = v^{\\star}$ 的情况下，评估两种互斥情景下的总酶质量 $M$。\n\n情景1：全部通量通过 $R_{1}$。\n此时，$v_{1} = v^{\\star}$ 且 $v_{2} = 0$。酶质量记为 $M_{1}$，为：\n$$M_{1} = \\frac{\\rho_{1}}{k_{\\text{cat},1}} v^{\\star} + \\frac{\\rho_{2}}{k_{\\text{cat},2}} (0) = \\frac{1}{100} v^{\\star}$$\n\n情景2：全部通量通过 $R_{2}$。\n此时，$v_{1} = 0$ 且 $v_{2} = v^{\\star}$。酶质量记为 $M_{2}$，为：\n$$M_{2} = \\frac{\\rho_{1}}{k_{\\text{cat},1}} (0) + \\frac{\\rho_{2}}{k_{\\text{cat},2}} v^{\\star} = \\frac{1}{100} v^{\\star}$$\n\n比率 $R$ 是这两个最小化酶质量值的比：\n$$R = \\frac{M_{1}}{M_{2}} = \\frac{\\frac{1}{100} v^{\\star}}{\\frac{1}{100} v^{\\star}} = 1$$\n\n接下来，我们分析未加权简约通量平衡分析（pFBA）目标。目标是最小化催化通量的未加权 $L_1$-范数 $F$：\n$$F = |v_{1}| + |v_{2}|$$\n问题陈述通量是不可逆的，意味着 $v_{1} \\ge 0$ 和 $v_{2} \\ge 0$。在此条件下，目标函数简化为：\n$$F = v_{1} + v_{2}$$\n我们还被给予约束条件，即总生物质生产通量固定为 $v^{\\star}$：\n$$v_{1} + v_{2} = v^{\\star}$$\n因此，对于任何满足问题约束的通量分布 $(v_{1}, v_{2})$，pFBA目标函数 $F$ 的值都是一个常数，等于 $v^{\\star}$。\n\n我们来评估两种指定情景下的pFBA成本。\n\n情景1：$v_{1} = v^{\\star}$ 且 $v_{2} = 0$。\npFBA成本记为 $F_{1}$，为：\n$$F_{1} = v_{1} + v_{2} = v^{\\star} + 0 = v^{\\star}$$\n\n情景2：$v_{1} = 0$ 且 $v_{2} = v^{\\star}$。\npFBA成本记为 $F_{2}$，为：\n$$F_{2} = v_{1} + v_{2} = 0 + v^{\\star} = v^{\\star}$$\n\n比率 $P$ 是这两个pFBA成本的比：\n$$P = \\frac{F_{1}}{F_{2}} = \\frac{v^{\\star}}{v^{\\star}} = 1$$\n\n比率 $R$ 和 $P$ 都等于1。资源分配目标（$M$）对这两条途径无差异，因为这两种酶具有相同的质量效率。pFBA目标（$F$）也无差异，因为它只考虑通量大小的总和，而该总和被约束为常数（$v^{\\star}$）。\n\n最终答案需表示为行矩阵 $\\begin{pmatrix} R  P \\end{pmatrix}$。\n当 $R=1$ 和 $P=1$ 时，矩阵为 $\\begin{pmatrix} 1  1 \\end{pmatrix}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1   1\n\\end{pmatrix}\n}\n$$", "id": "3337055"}, {"introduction": "虽然将最小化总通量作为资源效率的代理是一种有用的启发式方法，但它并不完美。这个练习设计了一个巧妙的反例，揭示了朴素的（未加权的）pFBA 在某些情况下会做出与生物直觉相悖的选择，即偏好催化效率较低的代谢途径。在此基础上，您将实现一种更精确的加权pFBA方法，该方法将酶的催化常数 $k_{\\text{cat}}$ 直接整合到优化目标中，从而更真实地模拟细胞的资源分配策略。[@problem_id:3337066]", "problem": "考虑一个最小代谢网络，该网络包含四种内源代谢物和六个不可逆反应。这些代谢物分别是底物 $S$、中间产物 $A$ 和 $B$ 以及生物质前体 $X$。反应如下：\n1. 吸收反应 $R_0$：$S_{\\text{ext}} \\rightarrow S$，通量为 $v_0 \\ge 0$，其上界被选择得足够大以确保其不成为限制因素。\n2. 直接转化反应 $R_1$：$S \\rightarrow X$，通量为 $v_1 \\ge 0$。\n3. 步骤 $R_2$：$S \\rightarrow A$，通量为 $v_2 \\ge 0$。\n4. 步骤 $R_3$：$A \\rightarrow B$，通量为 $v_3 \\ge 0$。\n5. 步骤 $R_4$：$B \\rightarrow X$，通量为 $v_4 \\ge 0$。\n6. 生物质流出反应 $R_X$：$X \\rightarrow \\emptyset$，通量为 $v_X \\ge 0$。\n\n假设处于稳态，并应用根据内源代谢物质量守恒推导出的通量平衡约束。使用化学计量矩阵 $S$ 对平衡进行编码\n$$\n\\begin{aligned}\nS\\text{行:}\\quad +v_0 - v_1 - v_2 = 0,\\\\\nA\\text{行:}\\quad +v_2 - v_3 = 0,\\\\\nB\\text{行:}\\quad +v_3 - v_4 = 0,\\\\\nX\\text{行:}\\quad +v_1 + v_4 - v_X = 0,\n\\end{aligned}\n$$\n将生物质流出固定为 $v_X = 1$（单位：量/秒），并要求所有反应 $i \\in \\{0,1,2,3,4,X\\}$ 的通量 $v_i \\ge 0$。所有反应在正方向上都是不可逆的。应将 $v_0$ 的吸收上界设置为一个严格大于 $1$ 的值，以便在这些约束条件下，吸收不是速率限制步骤。\n\n该网络有两条替代途径来满足 $v_X=1$：一条是通过 $R_1$ 的单反应途径，另一条是通过 $R_2$、$R_3$、$R_4$ 的三反应途径。在简约通量平衡分析 (pFBA) 中，通过最小化总通量大小来获得一个稀疏的通量分布。在无加权形式中，目标是最小化 $\\min \\sum_i |v_i|$。在一种考虑资源分配的变体中，会分配权重 $w_i$ 并最小化 $\\min \\sum_i w_i |v_i|$，其中权重来源于酶催化反应的酶催化常数 $k_{\\text{cat},i}$，其形式为倒数 $w_i = 1/k_{\\text{cat},i}$。吸收反应 $R_0$ 和生物质流出反应 $R_X$ 被视为非酶促步骤，并分配权重 $w_0 = 0$ 和 $w_X = 0$。\n\n你的任务是：\n- 根据给定约束，为上述网络构建并求解无加权的 pFBA。\n- 使用权重 $w_i = 1/k_{\\text{cat},i}$（对于 $i \\in \\{1,2,3,4\\}$）和 $w_0 = w_X = 0$ 构建并求解加权的 pFBA。\n- 展示一个反例，其中无加权的 pFBA 偏好通过 $R_1$ 的低催化常数路径（因为它使用的反应较少），而权重为 $w_i = 1/k_{\\text{cat},i}$ 的加权 pFBA 由于更高的催化效率而偏好通过 $R_2$、$R_3$、$R_4$ 的多步路径。通过比较 $v_1$ 和 $v_4$ 的大小，为每次优化确定偏好的路径，选择通向 $X$ 的通量较大的那条路径。\n\n将每次优化表述为线性规划问题：\n$$\n\\min_{v \\ge 0} \\sum_i w_i v_i \\quad \\text{subject to} \\quad S v = 0,\\quad v_X = 1,\n$$\n其中 $S$ 编码了上面给出的化学计量等式。对于无加权情况，设置所有 $i$ 的 $w_i = 1$。对于加权情况，设置 $w_0 = 0$，$w_X = 0$，以及对于 $i \\in \\{1,2,3,4\\}$ 设置 $w_i = 1/k_{\\text{cat},i}$。\n\n使用以下以 $\\text{s}^{-1}$ 为单位的催化常数 $k_{\\text{cat},i}$ 测试集：\n- 测试 1（反例目标）：$k_{\\text{cat},1} = 1$, $k_{\\text{cat},2} = 100$, $k_{\\text{cat},3} = 100$, $k_{\\text{cat},4} = 100$。这种情况在加权 pFBA 下应表现出路径切换。\n- 测试 2（无切换，直接路径仍然更优）：$k_{\\text{cat},1} = 40$, $k_{\\text{cat},2} = 100$, $k_{\\text{cat},3} = 100$, $k_{\\text{cat},4} = 100$。\n- 测试 3（所有催化效率相等）：$k_{\\text{cat},1} = 100$, $k_{\\text{cat},2} = 100$, $k_{\\text{cat},3} = 100$, $k_{\\text{cat},4} = 100$。\n\n对于所有测试，设置吸收上界为 $v_0 \\le 10$ 并保持 $v_X = 1$ 固定。按如下方式为每次优化确定偏好的路径：如果 $v_1 \\ge v_4$，选择直接路径；否则，选择多步路径。\n\n你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素都是一个布尔值，表示对于相应的测试用例，加权 pFBA 是否与无加权 pFBA 相比改变了偏好路径，并且在改变后偏好于具有更高 $k_{\\text{cat}}$ 的多步路径。输出是无单位的布尔值。例如，需要形如 `[b_1,b_2,b_3]` 的输出，其中每个 $b_j$ 为 True 或 False。", "solution": "该问题要求我们使用简约通量平衡分析 (pFBA) 的两种变体来分析一个小型代谢网络：一个最小化所有反应通量之和的无加权版本，以及一个最小化与酶成本相关的目标函数的加权版本。我们必须对三个测试用例确定，与无加权的 pFBA 相比，加权的 pFBA 是否会偏好一条不同的、催化效率更高的路径。\n\n首先，我们将问题形式化为线性规划 (LP) 问题。变量是六个反应的通量，由向量 $v = [v_0, v_1, v_2, v_3, v_4, v_X]^T$ 表示。所有通量都是不可逆的，因此我们有非负约束 $v_i \\ge 0$ 对于所有 $i$。\n\n稳态质量平衡方程构成一组线性等式约束，$S v = 0$，其中 $S$ 是化学计量矩阵。根据所提供的方程，$S$ 是一个 $4 \\times 6$ 的矩阵：\n$$\nS = \\begin{pmatrix}\n1  -1  -1  0  0  0 \\\\\n0  0  1  -1  0  0 \\\\\n0  0  0  1  -1  0 \\\\\n0  1  0  0  1  -1\n\\end{pmatrix}\n$$\n该系统的右侧是一个零向量，$b_{eq} = [0, 0, 0, 0]^T$。\n\n其他约束以单个通量边界的形式给出：\n1. 生物质流出是固定的：$v_X = 1$。\n2. 底物吸收是非限制性的：$0 \\le v_0 \\le 10$。\n3. 所有其他通量都是非负的：$v_i \\ge 0$ 对于 $i \\in \\{1, 2, 3, 4\\}$。\n\n从化学计量约束中，我们可以推导出通量之间的关键关系。\n$S v = 0$ 的第二行和第三行意味着 $v_2 - v_3 = 0$ 和 $v_3 - v_4 = 0$，这可以简化为 $v_2 = v_3 = v_4$。这意味着通过多步路径（$R_2, R_3, R_4$）的通量是均一的。\n第四行结合约束 $v_X = 1$，得出 $v_1 + v_4 = v_X = 1$。这个方程是核心，因为它显示了生物质前体 $X$ 的产生被分配在直接路径（通量 $v_1$）和多步路径（通量 $v_4$）之间。\n第一行得出 $v_0 = v_1 + v_2$。代入 $v_2 = v_4$ 和 $v_1 + v_4 = 1$，我们发现 $v_0 = v_1 + v_4 = 1$。总底物吸收固定为 $1$，这符合上界 $v_0 \\le 10$。\n\n该系统只有一个自由度，可以由通过直接路径 $R_1$ 的通量比例来表示。我们定义 $\\alpha = v_1$，由于通量的非负性和约束 $v_1+v_4=1$，$\\alpha \\in [0, 1]$。然后，整个通量向量 $v$ 可以用 $\\alpha$ 来表示：\n$v_1 = \\alpha$\n$v_4 = 1 - \\alpha$\n$v_2 = v_3 = v_4 = 1 - \\alpha$\n$v_X = 1$\n$v_0 = 1$\n所以，通量向量为 $v(\\alpha) = [1, \\alpha, 1-\\alpha, 1-\\alpha, 1-\\alpha, 1]^T$。优化问题简化为找到使相应目标函数最小化的 $\\alpha \\in [0, 1]$。\n\n目标是最小化通量的线性组合，$\\min \\sum_i w_i v_i$。\n\n对于无加权 pFBA，所有 $i$ 的权重均为 $w_i = 1$。目标函数 $F_{unw}$ 是所有通量之和：\n$$F_{unw}(\\alpha) = \\sum_{i} v_i(\\alpha) = v_0 + v_1 + v_2 + v_3 + v_4 + v_X$$\n$$F_{unw}(\\alpha) = 1 + \\alpha + (1-\\alpha) + (1-\\alpha) + (1-\\alpha) + 1 = 1 + \\alpha + 3(1-\\alpha) + 1 = 5 - 2\\alpha$$\n为了最小化 $F_{unw}(\\alpha)$，我们必须最大化 $\\alpha$。最大值为 $\\alpha = 1$。这对应于一个通量分布，其中 $v_1 = 1$ 且 $v_4 = 0$。根据决策准则（$v_1 \\ge v_4$），无加权 pFBA 总是选择直接路径。这是符合预期的，因为这条路径涉及的反应更少，因此总通量（$1+1+0+0+0+1 = 3$）低于任何其他通量分配。\n\n对于加权 pFBA，权重为 $w_0 = 0$，$w_X = 0$，对于酶促反应 $i \\in \\{1, 2, 3, 4\\}$，权重为 $w_i = 1/k_{\\text{cat},i}$。目标函数 $F_w$ 是：\n$$F_w(\\alpha) = \\sum_{i} w_i v_i(\\alpha) = w_0 v_0 + w_1 v_1 + w_2 v_2 + w_3 v_3 + w_4 v_4 + w_X v_X$$\n$$F_w(\\alpha) = 0 \\cdot 1 + w_1 \\alpha + w_2 (1-\\alpha) + w_3 (1-\\alpha) + w_4 (1-\\alpha) + 0 \\cdot 1$$\n$$F_w(\\alpha) = w_1 \\alpha + (w_2 + w_3 + w_4)(1-\\alpha)$$\n将这个关于 $\\alpha$ 的线性函数重新排列：\n$$F_w(\\alpha) = (w_1 - (w_2 + w_3 + w_4))\\alpha + (w_2 + w_3 + w_4)$$\n该函数在 $\\alpha \\in [0, 1]$ 上的最小值取决于 $\\alpha$ 的系数的符号。\n- 如果 $w_1 - (w_2 + w_3 + w_4) > 0$，则在 $\\alpha = 0$ 处取得最小值。这意味着 $v_1 = 0, v_4 = 1$，偏好多步路径。\n- 如果 $w_1 - (w_2 + w_3 + w_4)  0$，则在 $\\alpha = 1$ 处取得最小值。这意味着 $v_1 = 1, v_4 = 0$，偏好直接路径。\n- 如果 $w_1 - (w_2 + w_3 + w_4) = 0$，则任何 $\\alpha \\in [0, 1]$ 都是最优解。\n\n从直接路径（无加权情况）到多步路径（加权情况）的切换发生当且仅当 $w_1 > w_2 + w_3 + w_4$。回顾 $w_i = 1/k_{\\text{cat},i}$，此条件等价于：\n$$ \\frac{1}{k_{\\text{cat},1}} > \\frac{1}{k_{\\text{cat},2}} + \\frac{1}{k_{\\text{cat},3}} + \\frac{1}{k_{\\text{cat},4}} $$\n这个不等式意味着直接路径的酶“成本”大于多步路径的酶成本之和，因此从资源分配的角度来看，后者更为高效。\n\n我们现在将此条件应用于给定的测试用例。\n\n测试 1: $k_{\\text{cat}} = (1, 100, 100, 100)$。\n- $w_1 = 1/1 = 1$。\n- $w_2 = 1/100 = 0.01$, $w_3 = 1/100 = 0.01$, $w_4 = 1/100 = 0.01$。\n- 条件：$1 > 0.01 + 0.01 + 0.01$ 是否成立？是，$1 > 0.03$。\n- 发生切换。在加权情况下偏好多步路径。这条路径的酶 ($k_{\\text{cat}}=100$) 比直接路径的酶 ($k_{\\text{cat}}=1$) 更高效。结果为 `True`。\n\n测试 2: $k_{\\text{cat}} = (40, 100, 100, 100)$。\n- $w_1 = 1/40 = 0.025$。\n- $w_2 = w_3 = w_4 = 0.01$。\n- 条件：$0.025 > 0.01 + 0.01 + 0.01$ 是否成立？否，$0.025 \\ngtr 0.03$。\n- 不发生切换。直接路径仍然是首选。结果为 `False`。\n\n测试 3: $k_{\\text{cat}} = (100, 100, 100, 100)$。\n- $w_1 = 1/100 = 0.01$。\n- $w_2 = w_3 = w_4 = 0.01$。\n- 条件：$0.01 > 0.01 + 0.01 + 0.01$ 是否成立？否，$0.01 \\ngtr 0.03$。\n- 不发生切换。直接路径仍然是首选。结果为 `False`。\n\n最终结果是一个布尔值列表：`[True, False, False]`。提供的代码将使用标准 LP 求解器实现此逻辑，以验证分析推导。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the pFBA problem for the given metabolic network and test cases.\n    \"\"\"\n\n    # Define the test suite of catalytic constants\n    test_cases = [\n        # (k_cat1, k_cat2, k_cat3, k_cat4)\n        (1.0, 100.0, 100.0, 100.0),  # Test 1: Should switch\n        (40.0, 100.0, 100.0, 100.0), # Test 2: Should not switch\n        (100.0, 100.0, 100.0, 100.0) # Test 3: Should not switch\n    ]\n\n    # Flux vector v = [v0, v1, v2, v3, v4, vX]^T\n    # Stoichiometric matrix S for Sv = 0\n    # Rows correspond to metabolites S, A, B, X\n    A_eq = np.array([\n        [1, -1, -1,  0,  0,  0],  # S balance: v0 - v1 - v2 = 0\n        [0,  0,  1, -1,  0,  0],  # A balance: v2 - v3 = 0\n        [0,  0,  0,  1, -1,  0],  # B balance: v3 - v4 = 0\n        [0,  1,  0,  0,  1, -1]   # X balance: v1 + v4 - vX = 0\n    ])\n\n    # Right-hand side for the equality constraints\n    b_eq = np.zeros(4)\n\n    # Bounds for the fluxes [v0, v1, v2, v3, v4, vX]\n    # v0 = 10, vX = 1, all others >= 0\n    bounds = [\n        (0, 10.0),  # v0\n        (0, None),  # v1\n        (0, None),  # v2\n        (0, None),  # v3\n        (0, None),  # v4\n        (1.0, 1.0)  # vX\n    ]\n\n    # Objective function for unweighted pFBA: min sum(v_i)\n    c_unweighted = np.ones(6)\n\n    def get_preferred_route(flux_vector):\n        \"\"\"\n        Determines the preferred route based on v1 and v4 fluxes.\n        A small tolerance is used for floating point comparison.\n        \"\"\"\n        v1 = flux_vector[1]\n        v4 = flux_vector[4]\n        # Direct route is chosen if v1 >= v4\n        return 'direct' if v1 >= v4 - 1e-9 else 'multi-step'\n\n    results = []\n    for k_cats in test_cases:\n        k1, k2, k3, k4 = k_cats\n\n        # 1. Unweighted pFBA\n        res_unw = linprog(c=c_unweighted, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        if not res_unw.success:\n            raise RuntimeError(f\"Unweighted LP solver failed for case {k_cats}\")\n        route_unw = get_preferred_route(res_unw.x)\n\n        # 2. Weighted pFBA\n        # Weights w_i = 1/k_cat_i for i=1,2,3,4 and w_0=w_X=0\n        weights = [0.0, 1.0/k1, 1.0/k2, 1.0/k3, 1.0/k4, 0.0]\n        c_weighted = np.array(weights)\n        \n        res_w = linprog(c=c_weighted, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        if not res_w.success:\n            raise RuntimeError(f\"Weighted LP solver failed for case {k_cats}\")\n        route_w = get_preferred_route(res_w.x)\n\n        # 3. Compare routes\n        # Unweighted should always be 'direct' as analyzed.\n        # A switch means unweighted is 'direct' and weighted is 'multi-step'.\n        # The problem statement also implies checking that the multi-step route is 'higher-kcat'.\n        # In Test 1, k_cat for multi-step (100) > k_cat for direct (1), so this holds.\n        # The condition of switching to the multi-step implies it must be more efficient overall.\n        is_switch = (route_unw == 'direct' and route_w == 'multi-step')\n        results.append(is_switch)\n\n    # Format the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3337066"}, {"introduction": "通量平衡分析的一个核心挑战是“替代最优点”问题，即存在多种不同的通量分布都能达到相同的最优目标值（例如最大生长速率）。这种模糊性使得预测细胞将实际使用哪条代谢途径变得困难。这个高级练习将引导您通过计算来识别这种简并性，并展示pFBA如何系统性地从众多可能性中挑选出一个唯一的、稀疏的、并且通常是生物学上更合理的解。[@problem_id:3336975] 这有助于我们理解pFBA在消除冗余通量（如无效循环）和提高模型预测能力方面的强大作用。", "problem": "给定一个基于质量守恒和线性规划的稳态代谢建模框架。其基本基础是化学计量稳态假设和反应边界：稳态要求每个细胞内代谢物的净生成速率为零，这通过线性约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$ 来强制执行，其中 $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，包含 $m$ 种代谢物和 $n$ 个反应，$\\mathbf{v} \\in \\mathbb{R}^{n}$ 是通量向量。反应边界满足 $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$，其中 $\\mathbf{l}$ 是下界，$\\mathbf{u}$ 是上界。通量平衡分析 (FBA) 在这些约束条件下最大化一个线性目标 $z = \\mathbf{c}^{\\top}\\mathbf{v}$。简约通量平衡分析 (pFBA) 通过最小化酶资源使用的一个代理（模型化为 $l_{1}$ 范数 $\\sum_{i=1}^{n} |v_i|$）来解决 FBA 最优通量向量中的简并性问题，其约束条件是达到相同的最优目标值。\n\n您的任务是编写一个完整的程序，为每个测试用例执行以下操作：\n\n1. 求解 FBA 问题，即在约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$ 和 $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$ 下最大化 $z = \\mathbf{c}^{\\top}\\mathbf{v}$。\n2. 通过对激活约束进行零空间分析来识别 FBA 最优解的简并性。按如下方式构建激活约束矩阵 $\\mathbf{A}_{\\text{act}}$：\n   - 包含 $\\mathbf{S}$ 的所有行（这些是等式约束，始终处于激活状态）。\n   - 对于每个反应 $i$，若在最优解处 $v_i = l_i$ 或 $v_i = u_i$ 是激活的（在数值公差范围内），则包含相应的标准基行向量 $\\mathbf{e}_i^{\\top}$。\n   - 包含目标超平面行向量 $\\mathbf{c}^{\\top}$，以限制在最优解集 $z = z^{\\star}$ 上，其中 $z^{\\star}$ 是步骤1中找到的最大值。\n   计算 FBA 最优解的简并维度为 $d_{\\text{FBA}} = n - \\operatorname{rank}(\\mathbf{A}_{\\text{act}})$。\n3. 求解 pFBA 问题，即在约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$、$\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$ 和 $\\mathbf{c}^{\\top}\\mathbf{v} = z^{\\star}$ 下最小化 $\\sum_{i=1}^{n} |v_i|$，使用带有辅助变量的标准线性化方法来处理绝对值。设 pFBA 解为 $\\mathbf{v}^{\\text{pFBA}}$。\n4. 在 pFBA 解处，仅使用原始定义多胞体的约束（排除目标超平面）来构建激活约束矩阵，即包含 $\\mathbf{S}$ 的所有行以及处于边界上的反应的边界等式行向量 $\\mathbf{e}_i^{\\top}$。计算 $d_{\\text{pFBA}} = n - \\operatorname{rank}(\\mathbf{A}_{\\text{act,poly}})$。通过检查 $d_{\\text{pFBA}} = 0$ 是否成立来报告 pFBA 是否选择了原始可行多胞体的一个极点。\n5. 通过比较稀疏性来量化途径的可识别性：计算 FBA 解中非零通量（大于一个公差）的数量，记为 $\\text{nnz}_{\\text{FBA}}$，以及 pFBA 解中的数量，记为 $\\text{nnz}_{\\text{pFBA}}$。\n\n用于判断激活状态和非零性的数值公差必须设置为 $10^{-9}$。\n\n测试套件：\n为以下三个科学上一致的网络提供结果。在每个案例中，所有边界都以任意通量单位表示，并应被视为无量纲数。\n\n- 测试用例 1（从 $G$ 到生物质的两条替代途径）：\n  - 代谢物：$G, B, C$（因此 $m = 3$）。\n  - 反应 ($n = 6$)：$v_1$ 摄取 $: \\varnothing \\to G$，$v_2$ 直接转化 $: G \\to B$，$v_3$ 分支 $: G \\to C$，$v_4$ 转化 $: C \\to B$，$v_5$ 生物质排出 $: B \\to \\varnothing$，$v_6$ 输出 $: C \\to \\varnothing$。\n  - 化学计量矩阵行：\n    - $G$: $(+1, -1, -1, 0, 0, 0)$，\n    - $B$: $(0, +1, 0, +1, -1, 0)$，\n    - $C$: $(0, 0, +1, -1, 0, -1)$。\n  - 边界：$v_1 \\in [0, 10]$, $v_2 \\in [0, 1000]$, $v_3 \\in [0, 1000]$, $v_4 \\in [0, 1000]$, $v_5 \\in [0, 1000]$, $v_6 \\in [0, 1000]$。\n  - 目标：$\\mathbf{c} = (0, 0, 0, 0, 1, 0)$。\n\n- 测试用例 2（唯一途径，无分支）：\n  - 代谢物：$G, B$（因此 $m = 2$）。\n  - 反应 ($n = 3$)：$v_1$ 摄取 $: \\varnothing \\to G$，$v_2$ 转化 $: G \\to B$，$v_3$ 生物质排出 $: B \\to \\varnothing$。\n  - 化学计量矩阵行：\n    - $G$: $(+1, -1, 0)$，\n    - $B$: $(0, +1, -1)$。\n  - 边界：$v_1 \\in [0, 10]$, $v_2 \\in [0, 1000]$, $v_3 \\in [0, 1000]$。\n  - 目标：$\\mathbf{c} = (0, 0, 1)$。\n\n- 测试用例 3（两条替代途径外加一个无效循环 $B \\leftrightarrow D$）：\n  - 代谢物：$G, B, C, D$（因此 $m = 4$）。\n  - 反应 ($n = 8$)：与测试用例 1 相同（$v_1$ 到 $v_6$）外加 $v_7$ 循环正向 $: B \\to D$，$v_8$ 循环反向 $: D \\to B$。\n  - 化学计量矩阵行：\n    - $G$: $(+1, -1, -1, 0, 0, 0, 0, 0)$，\n    - $B$: $(0, +1, 0, +1, -1, 0, -1, +1)$，\n    - $C$: $(0, 0, +1, -1, 0, -1, 0, 0)$，\n    - $D$: $(0, 0, 0, 0, 0, 0, +1, -1)$。\n  - 边界：$v_1 \\in [0, 10]$, $v_2 \\in [0, 1000]$, $v_3 \\in [0, 1000]$, $v_4 \\in [0, 1000]$, $v_5 \\in [0, 1000]$, $v_6 \\in [0, 1000]$, $v_7 \\in [0, 1000]$, $v_8 \\in [0, 1000]$。\n  - 目标：$\\mathbf{c} = (0, 0, 0, 0, 1, 0, 0, 0)$。\n\n答案规格：\n对于每个测试用例，按顺序生成一个包含五个值的列表 $[d_{\\text{FBA}}, d_{\\text{pFBA}}, \\text{nnz}_{\\text{FBA}}, \\text{nnz}_{\\text{pFBA}}, \\text{extreme}_{\\text{pFBA}}]$，其中 $d_{\\text{FBA}}$ 和 $d_{\\text{pFBA}}$ 是整数，$\\text{nnz}_{\\text{FBA}}$ 和 $\\text{nnz}_{\\text{pFBA}}$ 是整数，$\\text{extreme}_{\\text{pFBA}}$ 是一个布尔值，指示 $d_{\\text{pFBA}} = 0$ 是否成立。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素本身是对应测试用例的五个值组成的列表。例如：`[[d_1, d'_1, k_1, k'_1, b_1],[d_2, d'_2, k_2, k'_2, b_2],[d_3, d'_3, k_3, k'_3, b_3]]`。", "solution": "该问题要求对三种不同的代谢网络模型实施和分析通量平衡分析 (FBA) 和简约通量平衡分析 (pFBA)。分析内容包括求解线性规划问题，通过零空间分析确定解空间的简并性，以及比较所得通量分布的稀疏性。\n\n其方法论基础是基于约束的代谢建模。核心假设是细胞内代谢物处于稳态，从而导出质量平衡约束 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$，其中 $\\mathbf{S}$ 是化学计量矩阵，$\\mathbf{v}$ 是反应通量向量。通量还受到热力学和容量限制的约束，表示为箱式约束 $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$。\n\n对每个测试用例的分析按规定的五个步骤进行：\n\n**步骤 1：通量平衡分析 (FBA)**\n第一步是求解标准的 FBA 问题。这是一个线性规划 (LP) 问题，其目标是在稳态和通量边界约束下，最大化一个生物学目标函数 $z = \\mathbf{c}^{\\top}\\mathbf{v}$。\n$$\n\\begin{align*}\n\\text{maximize} \\quad  z = \\mathbf{c}^{\\top}\\mathbf{v} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{align*}\n$$\n此 LP 将使用 `scipy.optimize` 库中的 `linprog` 函数求解。由于 `linprog` 是一个最小化函数，我们将求解其等价问题，即最小化 $z' = -\\mathbf{c}^{\\top}\\mathbf{v}$。FBA 的最优目标值记为 $z^{\\star}$。\n\n**步骤 2：FBA 简并性 ($d_{\\text{FBA}}$)**\nFBA 问题可能产生一个唯一的最优通量向量，也可能产生一个备选最优解的凸集。问题定义了一个计算与此简并性相关的量 $d_{\\text{FBA}}$ 的过程。针对求解器返回的具体 FBA 解向量 $\\mathbf{v}^{\\text{FBA}}$，构建一个激活约束矩阵 $\\mathbf{A}_{\\text{act}}$。该矩阵包括：\n1. 化学计量矩阵 $\\mathbf{S}$ 的所有行。\n2. 目标函数行 $\\mathbf{c}^{\\top}$，代表约束 $\\mathbf{c}^{\\top}\\mathbf{v} = z^{\\star}$。\n3. 对于每个通量 $v_i^{\\text{FBA}}$ 处于上界或下界的反应 $i$，包含相应的标准基向量 $\\mathbf{e}_i^{\\top}$。\n然后简并性计算为 $d_{\\text{FBA}} = n - \\operatorname{rank}(\\mathbf{A}_{\\text{act}})$，其中 $n$ 是反应数量。必须注意，这种特定公式衡量的是 LP 求解器返回的单个顶点上激活约束集的零度 (nullity)。如果求解器返回最优面的一个非简并顶点，则无论是否存在备选最优解，该值都将为 $0$。这个量不同于整个最优解空间的维度，后者是备选最优解简并性更常见的定义。我们将严格遵守问题的定义。使用 $10^{-9}$ 的数值公差来确定约束是否被激活。\n\n**步骤 3：简约通量平衡分析 (pFBA)**\npFBA 是一个 refining FBA 解的两步优化过程。在找到最大目标值 $z^{\\star}$ 后，pFBA 在 FBA 最优空间内寻找使总通量最小化的解，总通量被用作最小化酶成本的代理。其目标是最小化通量向量的 $l_{1}$-范数，即 $\\sum_{i=1}^{n} |v_i|$。在给定的测试用例中，所有通量下界均为 $l_i = 0$，意味着所有通量都是非负的 ($v_i \\ge 0$)。这简化了 pFBA 的目标，因为 $|v_i| = v_i$。因此，pFBA 问题是另一个 LP：\n$$\n\\begin{align*}\n\\text{minimize} \\quad  \\sum_{i=1}^{n} v_i \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{c}^{\\top}\\mathbf{v} = z^{\\star} \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{align*}\n$$\n此公式旨在找到以最低总酶投入实现最大生物产量的通量分布。\n\n**步骤 4：pFBA 解的特征描述 ($d_{\\text{pFBA}}$)**\npFBA 解 $\\mathbf{v}^{\\text{pFBA}}$ 通常是原始可行多胞体的一个唯一顶点。为验证这一点，我们计算第二个简并性度量 $d_{\\text{pFBA}}$。我们仅使用定义可行多胞体的约束（即排除目标超平面 $\\mathbf{c}^{\\top}\\mathbf{v} = z^{\\star}$）来构建一个激活约束矩阵 $\\mathbf{A}_{\\text{act,poly}}$。该矩阵包含 $\\mathbf{S}$ 的所有行以及在 $\\mathbf{v}^{\\text{pFBA}}$ 处激活的边界约束。简并性为 $d_{\\text{pFBA}} = n - \\operatorname{rank}(\\mathbf{A}_{\\text{act,poly}})$。如果 $d_{\\text{pFBA}} = 0$，则 pFBA 解是可行区域的一个唯一顶点，我们报告 pFBA 选择了一个极点。\n\n**步骤 5：稀疏性分析**\npFBA 的一个关键优点是它倾向于产生更稀疏的通量向量，意味着更少的反应承载通量。这增强了途径的可识别性。我们通过计算 FBA 解 ($\\text{nnz}_{\\text{FBA}}$) 和 pFBA 解 ($\\text{nnz}_{\\text{pFBA}}$) 中非零通量（定义为 $|v_i| > 10^{-9}$）的数量来量化这一点。这种比较突显了 pFBA 消除生理上不必要通量的能力，例如无效循环或冗余途径中的通量，而 FBA 可能会任意包含这些通量。虽然标准的 LP 求解器可能偶然返回一个稀疏的 FBA 解（作为最优面的一个顶点），但 pFBA 能保证这一点。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and compute the specified results.\n    \"\"\"\n    tol = 1e-9\n\n    # Test case 1 definition\n    S1 = np.array([\n        [1, -1, -1, 0, 0, 0],\n        [0, 1, 0, 1, -1, 0],\n        [0, 0, 1, -1, 0, -1]\n    ], dtype=float)\n    l1 = np.zeros(6)\n    u1 = np.array([10, 1000, 1000, 1000, 1000, 1000], dtype=float)\n    c1 = np.array([0, 0, 0, 0, 1, 0], dtype=float)\n\n    # Test case 2 definition\n    S2 = np.array([\n        [1, -1, 0],\n        [0, 1, -1]\n    ], dtype=float)\n    l2 = np.zeros(3)\n    u2 = np.array([10, 1000, 1000], dtype=float)\n    c2 = np.array([0, 0, 1], dtype=float)\n\n    # Test case 3 definition\n    S3 = np.array([\n        [1, -1, -1, 0, 0, 0, 0, 0],\n        [0, 1, 0, 1, -1, 0, -1, 1],\n        [0, 0, 1, -1, 0, -1, 0, 0],\n        [0, 0, 0, 0, 0, 0, 1, -1]\n    ], dtype=float)\n    l3 = np.zeros(8)\n    u3 = np.array([10, 1000, 1000, 1000, 1000, 1000, 1000, 1000], dtype=float)\n    c3 = np.array([0, 0, 0, 0, 1, 0, 0, 0], dtype=float)\n\n    test_cases = [\n        (S1, l1, u1, c1),\n        (S2, l2, u2, c2),\n        (S3, l3, u3, c3)\n    ]\n\n    results = []\n    for S, l, u, c in test_cases:\n        results.append(_process_case(S, l, u, c, tol))\n    \n    # Format the final output string\n    # Expected: [[1,0,4,3,True],[0,0,3,3,True],[2,0,5,3,True]]\n    result_str = '[' + ','.join([f\"[{','.join(map(str, r))}]\" for r in results]) + ']'\n    print(result_str)\n\ndef _process_case(S, l, u, c, tol):\n    \"\"\"\n    Performs the full FBA and pFBA analysis for a single test case.\n    \"\"\"\n    m, n = S.shape\n\n    # --- Step 1: Solve FBA ---\n    # Maximize c'v by a minimizing -c'v\n    res_fba = linprog(c=-c, A_eq=S, b_eq=np.zeros(m), bounds=list(zip(l, u)), method='highs')\n    \n    if not res_fba.success:\n        raise RuntimeError(\"FBA optimization failed.\")\n        \n    v_fba = res_fba.x\n    z_star = c @ v_fba\n\n    # --- Step 2: Compute FBA Degeneracy (d_FBA) ---\n    # Construct A_act based on the FBA solution\n    A_act_fba_rows = [S, c.reshape(1, -1)]\n    for i in range(n):\n        if abs(v_fba[i] - l[i])  tol or abs(v_fba[i] - u[i])  tol:\n            row = np.zeros(n)\n            row[i] = 1.0\n            A_act_fba_rows.append(row.reshape(1, -1))\n    \n    A_act_fba = np.vstack(A_act_fba_rows)\n    rank_fba = np.linalg.matrix_rank(A_act_fba, tol=tol)\n    d_fba = n - rank_fba\n\n    # --- Step 3: Solve pFBA ---\n    # Objective is to minimize sum(v_i) since all v_i >= 0\n    c_pfba = np.ones(n)\n    \n    # Constraints for pFBA: S.v=0 and c.v=z_star\n    A_eq_pfba = np.vstack([S, c.reshape(1, -1)])\n    b_eq_pfba = np.append(np.zeros(m), z_star)\n\n    res_pfba = linprog(c=c_pfba, A_eq=A_eq_pfba, b_eq=b_eq_pfba, bounds=list(zip(l, u)), method='highs')\n\n    if not res_pfba.success:\n        raise RuntimeError(\"pFBA optimization failed.\")\n    \n    v_pfba = res_pfba.x\n\n    # --- Step 4: Compute pFBA Degeneracy  Extreme Point Check (d_pFBA) ---\n    # Construct A_act_poly based on the pFBA solution (excluding objective)\n    A_act_poly_rows = [S]\n    for i in range(n):\n        if abs(v_pfba[i] - l[i])  tol or abs(v_pfba[i] - u[i])  tol:\n            row = np.zeros(n)\n            row[i] = 1.0\n            A_act_poly_rows.append(row.reshape(1, -1))\n\n    A_act_poly = np.vstack(A_act_poly_rows)\n    rank_pfba_poly = np.linalg.matrix_rank(A_act_poly, tol=tol)\n    d_pfba = n - rank_pfba_poly\n    extreme_pfba = (d_pfba == 0)\n\n    # --- Step 5: Quantify Sparsity (nnz) ---\n    nnz_fba = np.sum(np.abs(v_fba) > tol)\n    nnz_pfba = np.sum(np.abs(v_pfba) > tol)\n    \n    return [int(d_fba), int(d_pfba), int(nnz_fba), int(nnz_pfba), extreme_pfba]\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3336975"}]}