{"hands_on_practices": [{"introduction": "速率函数$I(f)$的概念是大偏差理论的核心，它量化了观测到的经验测量值$f$偏离真实基础分布$p$的概率呈指数衰减的速率。这项基础练习将引导您从第一性原理出发，推导离散状态下独立同分布样本的速率函数。通过完成此推导[@problem_id:3322434]，您将看到速率函数如何自然地表现为Kullback-Leibler散度，这是衡量两个分布之间信息差异的关键指标。", "problem": "在对一个克隆细菌种群的瞬时检测中，观察到在测量瞬间，每个细胞的启动子都精确处于 $K$ 个不同构象状态中的一个。假设从 $n$ 个独立抽样的细胞中，每个细胞的启动子状态都是从一个未知但固定的稳态分布 $p = (p_{1},\\dots,p_{K})$ 中进行的独立同分布抽样，其中 $p_{k} \\in (0,1)$ 且 $\\sum_{k=1}^{K} p_{k} = 1$。令 $N_{k}$ 表示在状态 $k$ 中观察到的细胞数量，并定义经验直方图 $f = (f_{1},\\dots,f_{K})$ 为 $f_{k} = N_{k}/n$，因此 $f_{k} \\ge 0$ 且 $\\sum_{k=1}^{K} f_{k} = 1$。\n\n仅使用独立分类抽样的第一性原理、多项式计数公式以及基于阶乘的 Stirling 公式的渐近近似，推导大偏差率函数 $I(f)$。该函数控制了经验直方图 $f$ 偏离真实分布 $p$ 的概率随 $n$ 的指数衰减。具体而言，证明存在一个函数 $I(f)$，使得当 $n \\to \\infty$ 时，经验直方图位于 $f$ 的一个小邻域内的概率服从 $\\exp(-n\\,I(f) + o(n))$ 形式的指数标度，并确定在约束条件 $\\sum_{k=1}^{K} f_{k} = 1$、$f_{k} \\ge 0$ 和 $p_{k} \\in (0,1)$ 下 $I(f)$ 的显式闭式表达式。\n\n你的推导必须从多项式模型下观察到计数 $(N_{1},\\dots,N_{K})$ 的概率开始，通过使用 Stirling 近似对其对数进行渐近评估至 $n$ 的主导阶，仔细论证单纯形约束的出现，并识别出在指数尺度上保留的项。请以闭式形式给出 $I(f)$ 的最终表达式。不需要数值计算，也不需要单位。最终答案必须是单一的闭式解析表达式。", "solution": "该问题要求推导独立同分布（i.i.d.）分类样本的经验直方图的大偏差率函数。我将首先验证问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n- 一个由从克隆细菌种群中独立抽样的 $n$ 个细胞组成的系统。\n- 每个细胞的启动子处于 $K$ 个不同构象状态之一。\n- 每个细胞的状态是从一个稳态分布 $p = (p_{1},\\dots,p_{K})$ 中进行的独立同分布抽样。\n- 对于真实分布，对所有 $k \\in \\{1, \\dots, K\\}$ 都有 $p_{k} \\in (0,1)$，并且 $\\sum_{k=1}^{K} p_{k} = 1$。\n- $N_{k}$ 是在状态 $k$ 中观察到的细胞数，因此 $\\sum_{k=1}^{K} N_{k} = n$。\n- 经验直方图为 $f = (f_{1},\\dots,f_{K})$，其中 $f_{k} = N_{k}/n$。\n- 对于经验直方图，对所有 $k$ 都有 $f_{k} \\ge 0$，并且 $\\sum_{k=1}^{K} f_{k} = 1$。\n- 任务是推导大偏差率函数 $I(f)$，它控制着渐近概率 $P(f) \\sim \\exp(-n\\,I(f))$。\n- 推导必须从多项式计数公式开始，并使用阶乘的 Stirling 近似。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据。独立同分布分类试验模型是概率论和统计力学的基石，其在生物学中对启动子状态的应用是计算系统生物学中的一个标准例子。问题要求推导与有限字母表的 Sanov 定理相关的率函数，这是大偏差理论中的一个经典和基本结果。所有术语在数学和物理学中都有明确的定义。该问题是适定的，有明确的目标和足够的信息来达成唯一且有意义的解。语言客观而精确。因此，该问题是有效的。\n\n### 步骤 3：结论与行动\n该问题是有效的。将提供完整的推导过程。\n\n### 率函数 $I(f)$ 的推导\n\n我们从第一性原理开始。系统包含 $n$ 次独立试验，每次试验（观察一个细胞的启动子状态）都会产生 $K$ 个结果中的一个。结果 $k$ 的概率由 $p_k$ 给出。\n\n观察到一个特定结果序列（例如，细胞1处于状态 $k_1$，细胞2处于状态 $k_2$，...，细胞 $n$ 处于状态 $k_n$）的概率，由于独立性，由各个概率的乘积给出：\n$$P(\\text{sequence}) = \\prod_{i=1}^{n} p_{k_i}$$\n如果这个序列产生了一组计数 $(N_1, N_2, \\dots, N_K)$，其中 $N_k$ 是状态 $k$ 在序列中出现的次数，那么这个概率可以写成：\n$$P(\\text{sequence}) = \\prod_{k=1}^{K} p_k^{N_k}$$\n然而，我们关心的是观察到计数集合 $(N_1, \\dots, N_K)$ 的概率，而不是一个特定的序列。许多不同的序列可以导致相同的计数集合。这种不同序列的数量由多项式系数给出：\n$$\\binom{n}{N_1, N_2, \\dots, N_K} = \\frac{n!}{N_1! N_2! \\dots N_K!}$$\n观察到计数 $(N_1, \\dots, N_K)$ 的总概率是实现这些计数的方式数量与任何一个能产生这些计数的特定序列的概率的乘积。这定义了多项分布：\n$$P(N_1, \\dots, N_K) = \\frac{n!}{N_1! N_2! \\dots N_K!} \\prod_{k=1}^{K} p_k^{N_k}$$\n问题要求的是与经验直方图 $f = (f_1, \\dots, f_K)$ 相关联的率函数 $I(f)$，其中 $f_k = N_k/n$。我们分析这个概率在 $n$ 很大时的渐近行为。处理概率的对数更为方便。让我们将特定经验直方图 $f$ 的概率表示为 $P_n(f)$，这等同于 $P(N_1=nf_1, \\dots, N_K=nf_K)$，假设每个 $nf_k$ 都是整数。\n$$\\ln(P_n(f)) = \\ln(n!) - \\sum_{k=1}^{K} \\ln(N_k!) + \\sum_{k=1}^{K} N_k \\ln(p_k)$$\n为了在 $n$ 很大时评估此表达式，我们使用阶乘对数的 Stirling 近似，$\\ln(m!) \\approx m \\ln(m) - m$（对于大的 $m$）。这是主导阶近似。将此应用于 $\\ln(n!)$ 和每个 $\\ln(N_k!)$ 得出：\n$$\\ln(P_n(f)) \\approx (n \\ln(n) - n) - \\sum_{k=1}^{K} (N_k \\ln(N_k) - N_k) + \\sum_{k=1}^{K} N_k \\ln(p_k)$$\n我们可以简化涉及 $n$ 和 $N_k$ 减法的项。由于 $\\sum_{k=1}^{K} N_k = n$，我们有：\n$$-n - \\sum_{k=1}^{K} (-N_k) = -n + \\sum_{k=1}^{K} N_k = -n + n = 0$$\n因此，这些项相互抵消，剩下：\n$$\\ln(P_n(f)) \\approx n \\ln(n) - \\sum_{k=1}^{K} N_k \\ln(N_k) + \\sum_{k=1}^{K} N_k \\ln(p_k)$$\n现在，我们代入 $N_k = n f_k$。表达式完全用 $n$ 和经验频率 $f_k$ 表示：\n$$\\ln(P_n(f)) \\approx n \\ln(n) - \\sum_{k=1}^{K} (n f_k) \\ln(n f_k) + \\sum_{k=1}^{K} (n f_k) \\ln(p_k)$$\n使用对数的性质 $\\ln(ab) = \\ln(a) + \\ln(b)$，我们展开项 $\\ln(n f_k)$：\n$$\\ln(P_n(f)) \\approx n \\ln(n) - \\sum_{k=1}^{K} n f_k (\\ln(n) + \\ln(f_k)) + \\sum_{k=1}^{K} n f_k \\ln(p_k)$$\n让我们分配并重排各项求和：\n$$\\ln(P_n(f)) \\approx n \\ln(n) - \\left(\\sum_{k=1}^{K} n f_k \\ln(n)\\right) - \\left(\\sum_{k=1}^{K} n f_k \\ln(f_k)\\right) + \\left(\\sum_{k=1}^{K} n f_k \\ln(p_k)\\right)$$\n提取公因子 $n$ 和 $n \\ln(n)$：\n$$\\ln(P_n(f)) \\approx n \\ln(n) - n \\ln(n) \\left(\\sum_{k=1}^{K} f_k\\right) - n \\left(\\sum_{k=1}^{K} f_k \\ln(f_k)\\right) + n \\left(\\sum_{k=1}^{K} f_k \\ln(p_k)\\right)$$\n根据经验直方图的定义，频率总和必须为一：$\\sum_{k=1}^{K} f_k = 1$。这就是单纯形约束。应用此约束，前两项抵消：\n$$n \\ln(n) - n \\ln(n) (1) = 0$$\n$\\ln(P_n(f))$ 的表达式简化为：\n$$\\ln(P_n(f)) \\approx - n \\sum_{k=1}^{K} f_k \\ln(f_k) + n \\sum_{k=1}^{K} f_k \\ln(p_k)$$\n合并两个求和项：\n$$\\ln(P_n(f)) \\approx -n \\sum_{k=1}^{K} \\left( f_k \\ln(f_k) - f_k \\ln(p_k) \\right)$$\n使用性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$：\n$$\\ln(P_n(f)) \\approx -n \\sum_{k=1}^{K} f_k \\ln\\left(\\frac{f_k}{p_k}\\right)$$\n问题陈述假定概率具有渐近形式 $P_n(f) \\approx \\exp(-n I(f) + o(n))$。我们的推导表明 $\\ln(P_n(f)) = -n \\sum_{k=1}^{K} f_k \\ln\\left(\\frac{f_k}{p_k}\\right) + \\text{次主导项}$。更仔细地应用 Stirling 公式 $\\ln(m!) = m\\ln m - m + \\frac{1}{2}\\ln(2\\pi m) + O(1/m)$，会发现次主导项的阶数为 $\\mathcal{O}(\\ln n)$。由于 $\\lim_{n\\to\\infty} \\frac{\\ln n}{n} = 0$，这些项对应于指数中的 $o(n)$ 项。\n具体来说，我们有：\n$$\\frac{1}{n} \\ln(P_n(f)) \\approx -\\sum_{k=1}^{K} f_k \\ln\\left(\\frac{f_k}{p_k}\\right)$$\n因此，在 $n \\to \\infty$ 的极限下，我们可以将率函数 $I(f)$ 识别为指数中与 $n$ 线性标度的项：\n$$I(f) = \\lim_{n\\to\\infty} -\\frac{1}{n}\\ln(P_n(f)) = \\sum_{k=1}^{K} f_k \\ln\\left(\\frac{f_k}{p_k}\\right)$$\n这个表达式是经验分布 $f$ 与真实分布 $p$ 之间的 Kullback-Leibler (KL) 散度，或称相对熵，通常表示为 $D_{KL}(f || p)$。它是一个非负函数，$I(f) \\ge 0$，且当且仅当对所有 $k$ 都有 $f_k = p_k$ 时，$I(f)=0$。这与大数定律一致，大数定律指出，随着样本数量的增加，观察到不同于真实分布的经验直方图的概率呈指数级减小。函数 $I(f)$ 量化了这种偏差的“代价”。\n因此，率函数的最终闭式表达式得以确定。", "answer": "$$\\boxed{\\sum_{k=1}^{K} f_{k} \\ln\\left(\\frac{f_{k}}{p_{k}}\\right)}$$", "id": "3322434"}, {"introduction": "虽然速率函数在概念上至关重要，但对于动态过程，通常更实际的做法是处理其勒让德-芬切尔变换（Legendre-Fenchel transform），即标度累积量生成函数（SCGF），记为$\\lambda(\\theta)$。这项练习[@problem_id:3322460]演示了如何为系统生物学中的一个基石模型——基因启动子在活性和非活性状态之间随机切换的模型——计算SCGF。您将应用强大的费曼-卡茨（Feynman-Kac）框架，证明$\\lambda(\\theta)$是一个“倾斜”生成元矩阵的主特征值，这是分析细胞过程中时间累积可观测量的一项基本技术。", "problem": "考虑一个均匀混合细胞中单个基因的两态启动子模型。启动子状态是一个连续时间马尔可夫链 $X_{t}\\in\\{0,1\\}$，其中 $0$ 表示非激活态（OFF），$1$ 表示激活态（ON）。启动子以速率 $k_{\\mathrm{on}}$ 从OFF态切换到ON态，并以速率 $k_{\\mathrm{off}}$ 从ON态切换到OFF态，因此 $X_{t}$ 的无穷小生成元为\n$$\nQ \\;=\\; \\begin{pmatrix}\n-\\,k_{\\mathrm{on}} & k_{\\mathrm{on}} \\\\\nk_{\\mathrm{off}} & -\\,k_{\\mathrm{off}}\n\\end{pmatrix}.\n$$\n当启动子处于ON态时，转录起始以脉冲形式发生：脉冲起始事件构成一个速率为 $\\beta$ 的泊松过程，该过程仅在 $X_{t}=1$ 时激活。每次脉冲产生随机数量 $B\\in\\{1,2,\\dots\\}$ 的信使核糖核酸（mRNA）分子，各次脉冲之间相互独立，其数量服从参数为 $p\\in(0,1]$ 的零截断几何分布，即对于 $n\\in\\{1,2,\\dots\\}$，有 $\\mathbb{P}(B=n) = p\\,(1-p)^{n-1}$。当启动子处于OFF态时，不产生mRNA。令 $N_{t}$ 表示到时间 $t$ 为止产生的mRNA分子总数（计算所有脉冲中的所有分子）。\n\n定义时间累加计数可观测量 $N_{t}$ 的标度累积量生成函数（SCGF）$\\lambda(\\theta)$ 为\n$$\n\\lambda(\\theta) \\;=\\; \\lim_{t\\to\\infty} \\frac{1}{t}\\,\\ln \\mathbb{E}\\!\\left[\\exp\\!\\left(\\theta\\,N_{t}\\right)\\right],\n$$\n其中实数 $\\theta$ 需满足矩生成函数有限的条件。使用连续时间马尔可夫链的 Feynman–Kac 表示，结合复合泊松过程的矩生成函数，构建控制与 $\\exp(\\theta N_{t})$ 相关的矩生成半群的倾斜生成元 $L_{\\theta}$，然后显式计算其主特征值。你的答案必须是关于 $k_{\\mathrm{on}}$、$k_{\\mathrm{off}}$、$\\beta$、$p$ 和 $\\theta$ 的 $\\lambda(\\theta)$ 的单一闭式解析表达式。最终答案中不要陈述任何中间结果。你可以假设 $\\theta$ 满足使几何脉冲矩生成函数存在的条件。\n\n最终答案必须是单一的解析表达式。不需要进行数值计算。", "solution": "问题要求解具有随机切换启动子的基因所产生的mRNA分子总数 $N_t$ 的标度累积量生成函数（SCGF）$\\lambda(\\theta)$。SCGF定义为 $\\lambda(\\theta) = \\lim_{t\\to\\infty} \\frac{1}{t}\\,\\ln \\mathbb{E}[\\exp(\\theta N_t)]$。根据连续时间马尔可夫链的大偏差理论，此SCGF是倾斜生成元矩阵 $L_{\\theta}$ 的主特征值。\n\n系统的状态可以用启动子状态 $X_t \\in \\{0, 1\\}$ 来描述。以启动子状态为条件的期望值的演化由一个倾斜生成元控制。令 $u_i(t, \\theta) = \\mathbb{E}[\\exp(\\theta N_t) | X_0 = i]$（$i \\in \\{0, 1\\}$）。这些期望值构成的向量 $\\mathbf{u}(t, \\theta) = (u_0(t, \\theta), u_1(t, \\theta))^T$ 服从微分方程 $\\frac{d}{dt}\\mathbf{u}(t,\\theta) = L_{\\theta} \\mathbf{u}(t,\\theta)$。对于大的 $t$，解由 $L_{\\theta}$ 的最大特征值（即 $\\lambda(\\theta)$）主导。\n\n倾斜生成元 $L_{\\theta}$ 的构造方法是，将一个对角矩阵 $V(\\theta)$ 加到启动子切换过程的无穷小生成元 $Q$ 上，即 $L_{\\theta} = Q + V(\\theta)$。矩阵 $Q$ 如下所示：\n$$\nQ = \\begin{pmatrix} -k_{\\mathrm{on}} & k_{\\mathrm{on}} \\\\ k_{\\mathrm{off}} & -k_{\\mathrm{off}} \\end{pmatrix}\n$$\n对角矩阵 $V(\\theta) = \\mathrm{diag}(V_{00}(\\theta), V_{11}(\\theta))$ 描述了在每种状态下mRNA的产生过程。元素 $V_{ii}(\\theta)$ 是当启动子处于状态 $i$ 时，产生过程的累积量生成函数。\n\n1.  **状态 $0$ (OFF):** 不产生mRNA。这意味着当 $X_t=0$ 时，分子数 $N_t$ 不增加。产生速率为 $0$，因此对SCGF的相应贡献为零。\n    $$\n    V_{00}(\\theta) = 0\n    $$\n\n2.  **状态 $1$ (ON):** 转录以复合泊松过程的形式发生。脉冲以速率 $\\beta$ 起始，每次脉冲产生随机数量 $B$ 的mRNA分子。$B$ 的分布是零截断几何分布，$\\mathbb{P}(B=n) = p(1-p)^{n-1}$（$n \\in \\{1, 2, \\dots\\}$）。复合泊松过程的累积量生成函数由 $\\beta (\\mathbb{E}[\\exp(\\theta B)] - 1)$ 给出。这就得到了倾斜项 $V_{11}(\\theta)$。\n    首先，我们计算脉冲大小 $B$ 的矩生成函数（MGF），$M_B(\\theta) = \\mathbb{E}[\\exp(\\theta B)]$。\n    $$\n    M_B(\\theta) = \\sum_{n=1}^{\\infty} \\exp(\\theta n) \\mathbb{P}(B=n) = \\sum_{n=1}^{\\infty} \\exp(\\theta n) p(1-p)^{n-1}\n    $$\n    我们可以将其重写为几何级数：\n    $$\n    M_B(\\theta) = p \\exp(\\theta) \\sum_{n=1}^{\\infty} [\\exp(\\theta)(1-p)]^{n-1} = p \\exp(\\theta) \\sum_{k=0}^{\\infty} [\\exp(\\theta)(1-p)]^k\n    $$\n    几何级数收敛的条件是 $|\\exp(\\theta)(1-p)|  1$，这是题目陈述中假设的条件。级数和为 $\\frac{1}{1-\\exp(\\theta)(1-p)}$。\n    $$\n    M_B(\\theta) = \\frac{p \\exp(\\theta)}{1 - (1-p)\\exp(\\theta)}\n    $$\n    现在，我们求 $V_{11}(\\theta)$：\n    $$\n    V_{11}(\\theta) = \\beta (M_B(\\theta) - 1) = \\beta \\left( \\frac{p \\exp(\\theta)}{1 - (1-p)\\exp(\\theta)} - 1 \\right)\n    $$\n    化简括号内的表达式：\n    $$\n    V_{11}(\\theta) = \\beta \\left( \\frac{p \\exp(\\theta) - [1 - (1-p)\\exp(\\theta)]}{1 - (1-p)\\exp(\\theta)} \\right) = \\beta \\left( \\frac{p \\exp(\\theta) - 1 + \\exp(\\theta) - p\\exp(\\theta)}{1 - (1-p)\\exp(\\theta)} \\right)\n    $$\n    $$\n    V_{11}(\\theta) = \\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)}\n    $$\n\n现在我们可以写出完整的倾斜生成元 $L_{\\theta}$：\n$$\nL_{\\theta} = Q + V(\\theta) = \\begin{pmatrix} -k_{\\mathrm{on}}  k_{\\mathrm{on}} \\\\ k_{\\mathrm{off}}  -k_{\\mathrm{off}} + V_{11}(\\theta) \\end{pmatrix}\n$$\nSCGF $\\lambda(\\theta)$ 是 $L_{\\theta}$ 的主（最大）特征值。特征值是特征方程 $\\det(L_{\\theta} - \\lambda I) = 0$ 的根。\n$$\n\\det\\begin{pmatrix} -k_{\\mathrm{on}} - \\lambda  k_{\\mathrm{on}} \\\\ k_{\\mathrm{off}}  -k_{\\mathrm{off}} + V_{11}(\\theta) - \\lambda \\end{pmatrix} = 0\n$$\n$$\n(-k_{\\mathrm{on}} - \\lambda)(-k_{\\mathrm{off}} + V_{11}(\\theta) - \\lambda) - k_{\\mathrm{on}}k_{\\mathrm{off}} = 0\n$$\n展开后得到一个关于 $\\lambda$ 的二次方程：\n$$\n\\lambda^2 - (-k_{\\mathrm{on}} - k_{\\mathrm{off}} + V_{11}(\\theta))\\lambda + (-k_{\\mathrm{on}})(-k_{\\mathrm{off}} + V_{11}(\\theta)) - k_{\\mathrm{on}}k_{\\mathrm{off}} = 0\n$$\n$$\n\\lambda^2 + (k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta))\\lambda + k_{\\mathrm{on}}k_{\\mathrm{off}} - k_{\\mathrm{on}}V_{11}(\\theta) - k_{\\mathrm{on}}k_{\\mathrm{off}} = 0\n$$\n$$\n\\lambda^2 + (k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta))\\lambda - k_{\\mathrm{on}}V_{11}(\\theta) = 0\n$$\n使用二次公式 $\\lambda = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$，其中 $a=1$，$b=k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta)$，$c=-k_{\\mathrm{on}}V_{11}(\\theta)$：\n$$\n\\lambda = \\frac{-(k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta)) \\pm \\sqrt{(k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta))^2 - 4(1)(-k_{\\mathrm{on}}V_{11}(\\theta))}}{2}\n$$\n$$\n\\lambda = \\frac{1}{2} \\left[ V_{11}(\\theta) - k_{\\mathrm{on}} - k_{\\mathrm{off}} \\pm \\sqrt{(k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta))^2 + 4k_{\\mathrm{on}}V_{11}(\\theta)} \\right]\n$$\n主特征值 $\\lambda(\\theta)$ 是两个根中较大的一个，对应于“$+$”号。\n$$\n\\lambda(\\theta) = \\frac{1}{2} \\left[ V_{11}(\\theta) - k_{\\mathrm{on}} - k_{\\mathrm{off}} + \\sqrt{(k_{\\mathrm{on}} + k_{\\mathrm{off}} - V_{11}(\\theta))^2 + 4k_{\\mathrm{on}}V_{11}(\\theta)} \\right]\n$$\n将 $V_{11}(\\theta) = \\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)}$ 的表达式代入，即可得到最终的闭式解。为了使最终表达式简洁，我们定义 $v(\\theta) = V_{11}(\\theta)$。\n最终表达式为：\n$$\n\\lambda(\\theta) = \\frac{1}{2} \\left[ \\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)} - k_{\\mathrm{on}} - k_{\\mathrm{off}} + \\sqrt{\\left(k_{\\mathrm{on}} + k_{\\mathrm{off}} - \\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)}\\right)^2 + 4k_{\\mathrm{on}}\\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)}} \\right]\n$$", "answer": "$$\n\\boxed{\\frac{1}{2} \\left( \\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)} - k_{\\mathrm{on}} - k_{\\mathrm{off}} + \\sqrt{\\left(k_{\\mathrm{on}} + k_{\\mathrm{off}} - \\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)}\\right)^{2} + 4k_{\\mathrm{on}}\\beta \\frac{\\exp(\\theta) - 1}{1 - (1-p)\\exp(\\theta)}} \\right)}\n$$", "id": "3322460"}, {"introduction": "在计算生物学中，连接理论与实践是一项至关重要的技能。这项综合性练习[@problem_id:3322416]要求您用代码实现转录爆发模型的完整大偏差分析流程。您将构建系统的生成元矩阵，计算SCGF及其相关的特征向量，并利用这些来设计一种高效的重要性抽样方案（Doob $h$-变换）以探究罕见的高表达事件，同时根据理论预测验证您的结果。", "problem": "考虑一个用于单个基因中信使核糖核酸 (mRNA) 生成的连续时间转录爆发模型，该基因具有一个双态启动子。启动子状态可以是非激活 ($0$) 或激活 ($1$)，mRNA 拷贝数是一个非负整数。该过程被建模为一个在有限状态空间上的连续时间马尔可夫链 (CTMC)，该状态空间通过在最大值 $N_{\\max}$ 处截断 mRNA 拷贝数来构建，以确保计算可行性，同时保持科学真实性。所有转移速率以 $\\text{min}^{-1}$ 为单位，所有输出也必须以 $\\text{min}^{-1}$ 为单位。\n\n具有生物学基础的转移如下，状态由 $(s,n)$ 表示，其中 $s\\in\\{0,1\\}$ 是启动子状态，$n\\in\\{0,1,\\dots,N_{\\max}\\}$ 是 mRNA 拷贝数：\n- 启动子激活：$(0,n)\\to(1,n)$，速率为 $\\alpha$。\n- 启动子失活：$(1,n)\\to(0,n)$，速率为 $\\beta$。\n- 转录 (生成)：当启动子激活且 $n  N_{\\max}$ 时，发生 $(1,n)\\to(1,n+1)$，速率为 $r$。\n- 降解：当 $n \\ge 1$ 时，对两种启动子状态发生 $(s,n)\\to(s,n-1)$，速率为 $\\gamma n$。\n\n对于给定的参数集 $(\\alpha, \\beta, r, \\gamma, N_{\\max}, k)$，您的任务是计算标度累积量生成函数 (SCGF) $\\lambda(k)$、驱动过程的稳态平均转录率 $\\mu_k$，以及 $\\mu_k$ 与导数 $\\mathrm{d}\\lambda(k)/\\mathrm{d}k$ 之间的相对误差，以验证 Gärtner-Ellis 定理。", "solution": "用户提供的问题是一个有效且适定的科学问题，根植于基因表达的计算系统生物学领域。它要求使用大偏差理论分析转录爆发模型，这是研究随机系统中稀有事件的一个标准且强大的框架。所有必要的参数和模型定义都已提供，任务是逻辑上连续且计算上可行的。该问题具有科学依据、客观且完整。我现在将着手提供一个完整的解决方案。\n\n### 基于原理的解决方案设计\n\n该问题要求对基因表达的连续时间马尔可夫链（CTMC）模型进行多步分析。问题的核心在于应用大偏差理论的概念来计算稀有事件的统计数据。\n\n#### 1. 状态空间和生成元矩阵 ($L_0$)\n\n系统的状态由配对 $(s, n)$ 给出，其中 $s \\in \\{0, 1\\}$ 是启动子状态（非激活/激活），$n \\in \\{0, 1, \\dots, N_{\\max}\\}$ 是 mRNA 拷贝数。为了在数学上表示这个系统，我们首先将这些状态对映射到一个单一的整数索引。一个方便的映射是：\n- 状态 $(0, n) \\to i = n$\n- 状态 $(1, n) \\to i = n + (N_{\\max} + 1)$\n\n因此，状态空间的总维度为 $M = 2(N_{\\max} + 1)$。动力学由生成元矩阵 $L_0$ 控制，这是一个 $M \\times M$ 的矩阵，其中非对角元素 $(L_0)_{ij}$ 是从状态 $i$ 到状态 $j$ 的转移速率，对角元素 $(L_0)_{ii}$ 是从状态 $i$ 出发的所有速率之和的负数，从而确保每行之和为零。\n\n$L_0$ 的非零非对角元素由指定的生物学转移确定：\n- 启动子激活：$(0,n) \\to (1,n)$ 对应于 $(L_0)_{n, n+N_{\\max}+1} = \\alpha$。\n- 启动子失活：$(1,n) \\to (0,n)$ 对应于 $(L_0)_{n+N_{\\max}+1, n} = \\beta$。\n- 转录：当 $n  N_{\\max}$ 时，$(1,n) \\to (1,n+1)$ 对应于 $(L_0)_{n+N_{\\max}+1, n+1+N_{\\max}+1} = r$。\n- 降解：当 $n \\ge 1$ 时，$(s,n) \\to (s,n-1)$ 对应于 $(L_0)_{n+s(N_{\\max}+1), n-1+s(N_{\\max}+1)} = \\gamma n$。\n\n#### 2. 倾斜算子 ($L_k$)\n\n加性泛函（此处为转录计数 $A_T$）的大偏差统计由标度累积量生成函数 (SCGF) $\\lambda(k)$ 控制。SCGF 是一个“倾斜”算子 $L_k$ 的主特征值。根据跳跃过程的费曼-卡茨公式，该算子是通过修改原始生成元来构建的。对于一个从 $i \\to j$ 的转移，其速率为 $W(i \\to j)$，可观测量有相关的跳跃增量 $g(i \\to j)$，则 $L_k$ 对函数 $f$ 的作用为：\n$$ (L_k f)(i) = \\sum_{j \\neq i} W(i \\to j) \\left( e^{k g(i \\to j)} f(j) - f(i) \\right) $$\n这可以转化为一个矩阵 $L_k$，其元素为：\n- $(L_k)_{ij} = W(i \\to j) e^{k g(i \\to j)}$ for $i \\neq j$。\n- $(L_k)_{ii} = -\\sum_{j \\neq i} W(i \\to j) = (L_0)_{ii}$。\n\n在我们的问题中，$g(i \\to j) = 1$ 仅适用于转录事件，其他情况为 $0$。因此，只有对应于转录的非对角元素乘以 $e^k$，而所有其他元素（包括对角线元素）与 $L_0$ 中的元素相同。请注意，$L_k$ 不是一个生成元矩阵，因为其行和不为零。\n\n#### 3. 主本征模和 SCGF\n\nSCGF, $\\lambda(k)$，是 $L_k$ 具有最大实部的特征值。对于一个不可约的 CTMC，佩龙-弗罗贝尼乌斯定理保证了该特征值是实数且单重的，并且其对应的右 ($v_k$) 和左 ($u_k$) 特征向量可以选择为具有严格正的分量。这些可以通过求解特征方程找到：\n$$ L_k v_k = \\lambda(k) v_k \\quad \\text{和} \\quad u_k^T L_k = \\lambda(k) u_k^T $$\n我们将使用数值库来求解这个特征系统。对于后续计算所需的一个具有科学意义的特征向量归一化方法是强制 $u_k^T v_k = 1$。\n\n#### 4. 驱动过程和重要性采样\n\n使用主右特征向量 $v_k$（通常称为 $h$-函数）的 Doob h-变换定义了一个新的“驱动”CTMC，该过程被条件化以产生感兴趣的稀有事件。这个驱动过程的生成元 $\\widehat{L}_k$ 由以下公式给出：\n$$ (\\widehat{L}_k)_{ij} = \\frac{(L_k)_{ij} (v_k)_j}{(v_k)_i} - \\delta_{ij} \\lambda(k) $$\n这种构造确保了 $\\widehat{L}_k$ 是一个有效的生成元矩阵（其行和为零）。这个驱动过程是稀有事件模拟的重要性采样算法的基础。\n\n#### 5. 驱动过程的平稳性质\n\n驱动过程有一个唯一的平稳分布 $\\pi_k$，它是 $\\widehat{L}_k$ 对应于特征值 $0$ 的归一化左特征向量。一个更直接的计算方法是通过 $L_k$ 的特征向量：\n$$ (\\pi_k)_i = \\frac{(u_k)_i (v_k)_i}{\\sum_j (u_k)_j (v_k)_j} $$\n在该驱动过程下的期望转录速率 $\\mu_k$，是所有瞬时转录速率按其平稳概率加权的總和：\n$$ \\mu_k = \\sum_{\\text{transcription } i \\to j} (\\pi_k)_i (\\widehat{L}_k)_{ij} $$\n\n#### 6. 一致性检查：Gärtner-Ellis 定理\n\n大偏差理论中的一个关键结果（与 Gärtner-Ellis 定理相关）指出，SCGF 的导数等于驱动过程中可观测量速率的期望值：\n$$ \\frac{\\mathrm{d}\\lambda}{\\mathrm{d}k} = \\mu_k $$\n这个导数可以使用矩阵微扰理论独立计算，其公式为：\n$$ \\frac{\\mathrm{d}\\lambda}{\\mathrm{d}k} = \\frac{u_k^T (\\mathrm{d}L_k/\\mathrm{d}k) v_k}{u_k^T v_k} $$\n在我们对 $L_k$ 的特定构造中，导数矩阵 $\\mathrm{d}L_k/\\mathrm{d}k$ 仅在对应于转录的非对角位置有非零元素，其中 $(\\mathrm{d}L_k/\\mathrm{d}k)_{ij} = r e^k$。通过代数方法评估 $\\mathrm{d}\\lambda/\\mathrm{d}k$ 和 $\\mu_k$ 的表达式，可以证实它们的相等性。通过数值计算两者，为整个理论框架和实现提供了一个强有力的验证。这两个计算值之间的相对误差应接近机器精度。\n\n以下 Python 代码实现了这一完整的工作流程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (alpha, beta, r, gamma, N_max, k)\n        (0.5, 0.3, 2.0, 0.2, 20, 0.0),\n        (0.5, 0.3, 2.0, 0.2, 20, 0.5),\n        (0.1, 1.0, 5.0, 1.5, 15, 1.0),\n        (0.05, 0.2, 1.0, 3.0, 5, 0.8),\n    ]\n\n    results = []\n    for params in test_cases:\n        lambda_k, mu_k, rel_error = _calculate_for_case(*params)\n        results.extend([lambda_k, mu_k, rel_error])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _calculate_for_case(alpha, beta, r, gamma, N_max, k):\n    \"\"\"\n    Implements the full large deviation analysis for a single set of parameters.\n\n    Args:\n        alpha (float): Promoter activation rate.\n        beta (float): Promoter deactivation rate.\n        r (float): Transcription rate.\n        gamma (float): mRNA degradation rate constant.\n        N_max (int): Maximum mRNA copy number for truncation.\n        k (float): Tilting parameter.\n\n    Returns:\n        tuple: A tuple containing (lambda(k), mu_k, relative_error).\n    \"\"\"\n    dim = 2 * (N_max + 1)\n    \n    # --- Task 1: Construct the original CTMC generator L_0 ---\n    # State mapping: (0, n) -> n, (1, n) -> n + N_max + 1\n    L0 = np.zeros((dim, dim))\n    \n    # Transitions\n    idx_offset = N_max + 1\n    for n in range(N_max + 1):\n        # Promoter activation: (0,n) -> (1,n)\n        L0[n, n + idx_offset] = alpha\n        \n        # Promoter deactivation: (1,n) -> (0,n)\n        L0[n + idx_offset, n] = beta\n\n    for s in [0, 1]:\n        offset = s * idx_offset\n        for n in range(1, N_max + 1):\n            # Degradation: (s,n) -> (s,n-1)\n            L0[n + offset, n - 1 + offset] = gamma * n\n            \n    # Transcription (active promoter only): (1,n) -> (1,n+1)\n    for n in range(N_max):\n        L0[n + idx_offset, n + 1 + idx_offset] = r\n\n    # Set diagonal elements so rows sum to zero\n    np.fill_diagonal(L0, -L0.sum(axis=1))\n\n    # --- Task 2: Construct the tilted operator L_k ---\n    # As per Feynman-Kac, off-diagonals are tilted, diagonals are from L0.\n    Lk = np.copy(L0)\n    exp_k = np.exp(k)\n    \n    for n in range(N_max):\n        # Tilt only transcription events\n        idx_from = n + idx_offset\n        idx_to = n + 1 + idx_offset\n        Lk[idx_from, idx_to] = r * exp_k\n        \n    # --- Task 3: Compute the dominant eigenmode of L_k ---\n    eigenvalues, left_eigenvectors, right_eigenvectors = linalg.eig(Lk, left=True, right=True)\n    \n    dominant_idx = np.argmax(np.real(eigenvalues))\n    lambda_k = np.real(eigenvalues[dominant_idx])\n    \n    v_k = np.real(right_eigenvectors[:, dominant_idx])\n    u_k = np.real(left_eigenvectors[:, dominant_idx])\n\n    # Ensure eigenvectors are positive (Perron-Frobenius guarantee)\n    if np.sum(v_k)  0: v_k = -v_k\n    if np.sum(u_k)  0: u_k = -u_k\n\n    # Normalize eigenvectors such that u_k^T * v_k = 1\n    dot_product = np.dot(u_k, v_k)\n    u_k /= dot_product\n    \n    # --- Task 6 (Part 1): Compute d(lambda)/dk from perturbation theory ---\n    # d(lambda)/dk = u_k^T * (dLk/dk) * v_k (with u_k^T*v_k=1)\n    # dLk/dk is non-zero only for the off-diagonal transcription elements.\n    sum_term = 0.0\n    for n in range(N_max):\n        idx_from = n + idx_offset\n        idx_to = n + 1 + idx_offset\n        sum_term += u_k[idx_from] * v_k[idx_to]\n    d_lambda_dk = r * exp_k * sum_term\n    \n    # --- Tasks 4  5: Compute mu_k from the driven process ---\n    # Stationary distribution of driven process: pi_k ~ u_k * v_k\n    pi_k = u_k * v_k\n    pi_k /= np.sum(pi_k) \n\n    # Expected transcription rate under driven process\n    mu_k = 0.0\n    for n in range(N_max):\n        idx_from = n + idx_offset\n        idx_to = n + 1 + idx_offset\n        \n        # Rate of transcription jump in driven process\n        rate_driven = Lk[idx_from, idx_to] * v_k[idx_to] / v_k[idx_from]\n        \n        # Contribution to expected rate\n        mu_k += pi_k[idx_from] * rate_driven\n    \n    # --- Task 6 (Part 2): Compute relative error ---\n    # Theory predicts d_lambda_dk = mu_k.\n    denominator = max(1e-12, np.abs(d_lambda_dk))\n    rel_error = np.abs(mu_k - d_lambda_dk) / denominator\n      \n    return lambda_k, mu_k, rel_error\n\nsolve()\n```", "id": "3322416"}]}