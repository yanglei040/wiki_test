{"hands_on_practices": [{"introduction": "哈代-温伯格平衡（Hardy-Weinberg Equilibrium, HWE）是群体遗传学的基石，它描述了在一个没有演化力量（如选择、突变、迁移）干扰的理想群体中，等位基因和基因型频率如何代代相传并保持不变。检验与HWE的偏差是许多遗传学分析中的关键步骤，例如在评估测序数据的质量或探究潜在的演化压力时。通过这个练习[@problem_id:3338784]，你将亲手实践从观测数据计算等位基因频率、期望的基因型数量，并使用卡方检验来量化群体是否处于平衡状态。", "problem": "计算系统生物学中的一个高通量变异检测流程正在对一个随机交配的二倍体群体中的常染色体双等位基因单核苷酸多态性进行质量控制。在过滤掉低质量的基因型鉴定结果后，共有 $N = 500$ 个个体具有可靠的基因型，其观察到的基因型计数为：$n_{AA} = 210$，$n_{Aa} = 230$，以及 $n_{aa} = 60$。假设随机交配、群体规模大、无选择、无突变、无迁移，因此哈迪-温伯格平衡 (HWE) 是合适的零假设模型。\n\n仅使用群体遗传学的基本定义，根据这些计数计算等位基因 $A$ 和等位基因 $a$ 的频率，然后计算在HWE零假设模型下的预期基因型计数，最后使用观察到的和预期的基因型计数计算经典的皮尔逊卡方检验统计量以衡量与HWE的偏离，不进行任何连续性校正或小样本调整。\n\n将卡方统计量报告为单个实数值，四舍五入至四位有效数字。不要报告任何其他量。不需要单位。", "solution": "问题陈述已经过评估，被认为是有效的。它在科学上基于群体遗传学原理，特别是哈迪-温伯格平衡 (HWE) 模型和卡方拟合优度检验。该问题是适定的，提供了所有必要的数据且内部一致，可以计算出唯一解。语言客观而精确。\n\n任务是根据二倍体群体中一个双等位基因位点的观察基因型计数，计算用于衡量与HWE偏离的皮尔逊卡方检验统计量。求解过程分三个阶段：首先，根据观察数据计算等位基因频率；其次，在HWE零假设模型下计算预期的基因型计数；第三，根据观察计数和预期计数计算卡方统计量。\n\n提供的数据是总样本 $N=500$ 个个体的观察基因型计数：\n-   基因型为 $AA$ 的个体数：$n_{AA} = 210$\n-   基因型为 $Aa$ 的个体数：$n_{Aa} = 230$\n-   基因型为 $aa$ 的个体数：$n_{aa} = 60$\n\n个体总数通过计数之和确认：$n_{AA} + n_{Aa} + n_{aa} = 210 + 230 + 60 = 500 = N$。\n\n**1. 等位基因频率的计算**\n\n等位基因 $A$ 和 $a$ 的频率（分别用 $p$ 和 $q$ 表示）是根据观察到的基因型计数计算的。由于群体是二倍体，样本中的等位基因总数为 $2N = 2 \\times 500 = 1000$。\n\n$A$ 等位基因的数量来自纯合子 ($AA$) 和杂合子 ($Aa$)。每个 $AA$ 个体携带两个 $A$ 等位基因，每个 $Aa$ 个体携带一个 $A$ 等位基因。\n等位基因 $A$ 的总计数为：\n$$ \\text{Count}(A) = 2 \\times n_{AA} + 1 \\times n_{Aa} = 2 \\times 210 + 230 = 420 + 230 = 650 $$\n等位基因 $A$ 的频率 $p$ 是 $A$ 等位基因计数与等位基因总数的比率：\n$$ p = \\frac{2 n_{AA} + n_{Aa}}{2N} = \\frac{650}{1000} = 0.65 $$\n\n类似地，计算等位基因 $a$ 的频率 $q$。每个 $aa$ 个体携带两个 $a$ 等位基因，每个 $Aa$ 个体携带一个 $a$ 等位基因。\n等位基因 $a$ 的总计数为：\n$$ \\text{Count}(a) = 2 \\times n_{aa} + 1 \\times n_{Aa} = 2 \\times 60 + 230 = 120 + 230 = 350 $$\n等位基因 $a$ 的频率 $q$ 是：\n$$ q = \\frac{2 n_{aa} + n_{Aa}}{2N} = \\frac{350}{1000} = 0.35 $$\n作为检验，等位基因频率之和必须为 $1$：$p + q = 0.65 + 0.35 = 1.00$。\n\n**2. HWE下预期基因型计数的计算**\n\nHWE原理指出，对于在指定假设下的群体，预期的基因型频率由二项式展开 $(p+q)^2 = p^2 + 2pq + q^2$ 的各项给出。\n-   基因型 $AA$ 的预期频率：$f_E(AA) = p^2 = (0.65)^2 = 0.4225$\n-   基因型 $Aa$ 的预期频率：$f_E(Aa) = 2pq = 2 \\times 0.65 \\times 0.35 = 0.4550$\n-   基因型 $aa$ 的预期频率：$f_E(aa) = q^2 = (0.35)^2 = 0.1225$\n\n为求得预期的基因型计数 ($E_i$)，我们将这些预期频率乘以总样本量 $N=500$。\n-   $AA$ 的预期计数：$E_{AA} = N \\times p^2 = 500 \\times 0.4225 = 211.25$\n-   $Aa$ 的预期计数：$E_{Aa} = N \\times 2pq = 500 \\times 0.4550 = 227.5$\n-   $aa$ 的预期计数：$E_{aa} = N \\times q^2 = 500 \\times 0.1225 = 61.25$\n\n预期计数之和必须等于总样本量：$211.25 + 227.5 + 61.25 = 500$。\n\n**3. 皮尔逊卡方统计量的计算**\n\n皮尔逊卡方 ($\\chi^2$) 统计量用于衡量观察计数 ($O_i$) 与预期计数 ($E_i$) 之间的差异。其公式为：\n$$ \\chi^2 = \\sum_{i} \\frac{(O_i - E_i)^2}{E_i} $$\n三个类别分别是基因型 $AA$、$Aa$ 和 $aa$。令 $O_{AA}=n_{AA}$、$O_{Aa}=n_{Aa}$ 和 $O_{aa}=n_{aa}$。\n\n计算过程如下：\n$$ \\chi^2 = \\frac{(O_{AA} - E_{AA})^2}{E_{AA}} + \\frac{(O_{Aa} - E_{Aa})^2}{E_{Aa}} + \\frac{(O_{aa} - E_{aa})^2}{E_{aa}} $$\n代入观察值和预期值：\n$$ \\chi^2 = \\frac{(210 - 211.25)^2}{211.25} + \\frac{(230 - 227.5)^2}{227.5} + \\frac{(60 - 61.25)^2}{61.25} $$\n计算各项：\n$$ \\chi^2 = \\frac{(-1.25)^2}{211.25} + \\frac{(2.5)^2}{227.5} + \\frac{(-1.25)^2}{61.25} $$\n$$ \\chi^2 = \\frac{1.5625}{211.25} + \\frac{6.25}{227.5} + \\frac{1.5625}{61.25} $$\n$$ \\chi^2 \\approx 0.007396213 + 0.027472527 + 0.025510204 $$\n$$ \\chi^2 \\approx 0.060378944 $$\n\n题目要求结果四舍五入至四位有效数字。第一位有效数字是百分位的 $6$。四位有效数字是 $0.06037$。第五位有效数字是 $8$，所以我们将第四位数字向上取整。\n$$ \\chi^2 \\approx 0.06038 $$\n这是卡方统计量的最终值。", "answer": "$$\\boxed{0.06038}$$", "id": "3338784"}, {"introduction": "现实世界中的种群很少是完全随机交配的单一群体；它们通常被划分为具有不同程度基因交流的亚群。理解这种群体结构对于演化生物学和保护遗传学至关重要，$F$-统计量，特别是 $F_{ST}$，是量化亚群间遗传分化和推断基因流等过程的核心工具。这个练习[@problem_id:3338795]将指导你如何计算并解释这些关键指标，让你掌握从等位基因频率数据中揭示群体间遗传差异的方法。", "problem": "在一个处于迁移-漂变平衡的结构化群体中，对一个具有等位基因 $A$ 和 $a$ 的双等位基因座，在 $K=5$ 个亚群中进行了采样。给出每个亚群 $i$ 的等位基因计数（基因拷贝数）为 $(c_{i}^{A}, c_{i}^{a})$，总数为 $C_{i} = c_{i}^{A} + c_{i}^{a}$：\n- 亚群 1: $(83, 117)$，总计 $C_{1} = 200$\n- 亚群 2: $(30, 70)$，总计 $C_{2} = 100$\n- 亚群 3: $(160, 40)$，总计 $C_{3} = 200$\n- 亚群 4: $(55, 45)$，总计 $C_{4} = 100$\n- 亚群 5: $(24, 76)$，总计 $C_{5} = 100$\n\n从群体遗传学的基本定义出发，将每个亚群视为遵循哈迪-温伯格平衡 (HWE)，使用样本量权重 $w_{i} = C_{i} \\big/ \\sum_{j=1}^{K} C_{j}$，并计算：\n1. 所有亚群中等位基因 $A$ 的加权平均等位基因频率 $\\bar{p}$。\n2. 每个亚群 $i$ 的亚群内期望杂合度 $H_{i} = 2 p_{i} (1 - p_{i})$，其中 $p_{i} = c_{i}^{A} / C_{i}$，以及按样本量加权的亚群内平均杂合度 $H_{S} = \\sum_{i=1}^{K} w_{i} H_{i}$。\n3. 总期望杂合度 $H_{T} = 2 \\bar{p} (1 - \\bar{p})$。\n4. 固定指数 $F_{ST}$，定义为 $F_{ST} = \\frac{H_{T} - H_{S}}{H_{T}}$。\n\n然后，在经典 Wright 岛屿模型假设（中性、亚群大小相等、对称迁移和迁移-漂变平衡）下，使用经过充分检验的关系式 $F_{ST} \\approx \\frac{1}{4Nm + 1}$，用每代迁移个体数 $Nm$ 来解释推断出的基因流水平。\n\n将所有报告的量（$\\bar{p}$、$H_{S}$、$H_{T}$、$F_{ST}$ 和 $Nm$）四舍五入到五位有效数字。按顺序 $\\bar{p}$、$H_{S}$、$H_{T}$、$F_{ST}$、$Nm$ 将最终答案表示为一个序列。", "solution": "该问题是有效的，因为它科学上基于标准的群体遗传学理论，问题陈述清晰，数据充分，定义明确，并且是客观陈述的。满足一个有效问题的所有条件。\n\n解题过程是按照问题陈述中的定义，系统地计算所需的量。\n\n首先，我们确定在所有亚群中采样的基因拷贝总数，记为 $C_{\\text{total}}$。\n$$ C_{\\text{total}} = \\sum_{j=1}^{K} C_{j} = C_{1} + C_{2} + C_{3} + C_{4} + C_{5} $$\n$$ C_{\\text{total}} = 200 + 100 + 200 + 100 + 100 = 700 $$\n样本量权重 $w_{i} = C_{i} / C_{\\text{total}}$ 为：\n$$ w_{1} = \\frac{200}{700} = \\frac{2}{7}, \\quad w_{2} = \\frac{100}{700} = \\frac{1}{7}, \\quad w_{3} = \\frac{200}{700} = \\frac{2}{7}, \\quad w_{4} = \\frac{100}{700} = \\frac{1}{7}, \\quad w_{5} = \\frac{100}{700} = \\frac{1}{7} $$\n接下来，我们使用公式 $p_{i} = c_{i}^{A} / C_{i}$ 计算每个亚群 $i$ 中等位基因 $A$ 的频率 $p_{i}$。\n$$ p_{1} = \\frac{83}{200} = 0.415, \\quad p_{2} = \\frac{30}{100} = 0.3, \\quad p_{3} = \\frac{160}{200} = 0.8, \\quad p_{4} = \\frac{55}{100} = 0.55, \\quad p_{5} = \\frac{24}{100} = 0.24 $$\n\n1.  **计算加权平均等位基因频率 $\\bar{p}$**。\n    这可以计算为亚群频率的加权平均值，或者更直接地，通过将 $A$ 等位基因的总数除以所有等位基因的总数来计算。\n    $$ \\bar{p} = \\frac{\\sum_{i=1}^{K} c_{i}^{A}}{\\sum_{i=1}^{K} C_{i}} = \\frac{83 + 30 + 160 + 55 + 24}{700} = \\frac{352}{700} \\approx 0.50285714 $$\n    四舍五入到五位有效数字，$\\bar{p} \\approx 0.50286$。\n\n2.  **计算亚群内杂合度 $H_{i}$ 和平均值 $H_{S}$**。\n    每个亚群的期望杂合度为 $H_{i} = 2 p_{i} (1 - p_{i})$。\n    $$ H_{1} = 2 \\times 0.415 \\times 0.585 = 0.48555 $$\n    $$ H_{2} = 2 \\times 0.3 \\times 0.7 = 0.42 $$\n    $$ H_{3} = 2 \\times 0.8 \\times 0.2 = 0.32 $$\n    $$ H_{4} = 2 \\times 0.55 \\times 0.45 = 0.495 $$\n    $$ H_{5} = 2 \\times 0.24 \\times 0.76 = 0.3648 $$\n    平均亚群内杂合度 $H_{S}$ 是 $H_{i}$ 值的加权平均值。\n    $$ H_{S} = \\sum_{i=1}^{K} w_{i} H_{i} = \\frac{2}{7}(0.48555) + \\frac{1}{7}(0.42) + \\frac{2}{7}(0.32) + \\frac{1}{7}(0.495) + \\frac{1}{7}(0.3648) $$\n    $$ H_{S} = \\frac{2 \\times 0.48555 + 0.42 + 2 \\times 0.32 + 0.495 + 0.3648}{7} = \\frac{0.9711 + 0.42 + 0.64 + 0.495 + 0.3648}{7} $$\n    $$ H_{S} = \\frac{2.8909}{7} \\approx 0.41298571 $$\n    四舍五入到五位有效数字，$H_{S} \\approx 0.41299$。\n\n3.  **计算总期望杂合度 $H_{T}$**。\n    这是将所有亚群的集合视为一个单一的泛交群体时的期望杂合度，$H_{T} = 2 \\bar{p} (1 - \\bar{p})$。使用精确的分数值 $\\bar{p} = 352/700$ 进行计算以获得最高精度：\n    $$ H_{T} = 2 \\times \\frac{352}{700} \\times \\left(1 - \\frac{352}{700}\\right) = 2 \\times \\frac{352}{700} \\times \\frac{348}{700} = \\frac{245088}{490000} \\approx 0.49997551 $$\n    四舍五入到五位有效数字，$H_{T} \\approx 0.49998$。\n\n4.  **计算固定指数 $F_{ST}$**。\n    固定指数衡量了由于亚群结构导致的总群体中杂合子的缺失。它定义为 $F_{ST} = (H_{T} - H_{S}) / H_{T}$。\n    使用 $H_{T}$ 和 $H_{S}$ 的未四舍五入值：\n    $$ F_{ST} = \\frac{0.49997551 - 0.41298571}{0.49997551} = \\frac{0.0869898}{0.49997551} \\approx 0.17400190 $$\n    四舍五入到五位有效数字，$F_{ST} \\approx 0.17400$。\n\n5.  **推断每代迁移个体数 $Nm$**。\n    在平衡状态下的 Wright 岛屿模型中，$F_{ST}$ 通过近似关系式 $F_{ST} \\approx \\frac{1}{4Nm + 1}$ 与 $Nm$ 相关联。我们可以求解 $Nm$：\n    $$ 4Nm + 1 = \\frac{1}{F_{ST}} $$\n    $$ 4Nm = \\frac{1}{F_{ST}} - 1 $$\n    $$ Nm = \\frac{1}{4} \\left( \\frac{1}{F_{ST}} - 1 \\right) $$\n    使用未四舍五入的值 $F_{ST} \\approx 0.17400190$：\n    $$ Nm = \\frac{1}{4} \\left( \\frac{1}{0.17400190} - 1 \\right) = \\frac{1}{4} (5.7470588 - 1) = \\frac{4.7470588}{4} \\approx 1.1867647 $$\n    四舍五入到五位有效数字，$Nm \\approx 1.1868$。\n\n最终结果序列，四舍五入到五位有效数字，是：\n$\\bar{p} \\approx 0.50286$\n$H_{S} \\approx 0.41299$\n$H_{T} \\approx 0.49998$\n$F_{ST} \\approx 0.17400$\n$Nm \\approx 1.1868$", "answer": "$$ \\boxed{\\begin{pmatrix} 0.50286  0.41299  0.49998  0.17400  1.1868 \\end{pmatrix}} $$", "id": "3338795"}, {"introduction": "群体遗传学原理不仅适用于单个基因，还可以扩展到由多个基因控制的复杂数量性状。多变量选择育种方程（Lande方程），即 $\\Delta \\bar{\\boldsymbol{z}} = G \\boldsymbol{\\beta}$，是一个强大的预测模型，它揭示了当选择作用于多个相互关联的性状时，群体的表型将如何演化。这个练习[@problem_id:3338787]将群体遗传学与数量遗传学联系起来，通过模拟多性状对选择的响应，让你深入理解遗传协方差（即性状间的遗传关联）在塑造演化轨迹中的关键作用。", "problem": "你需要在一个有性生殖种群中，根据数量遗传学的标准假设，形式化并实现一个针对数量性状的多变量选择响应模型。从基本定义开始：Price方程、加性遗传值及其协方差的定义，以及围绕当前性状均值对相对适合度进行的一阶泰勒展开近似。利用这些定义推导出一个线性算子，该算子将定向选择梯度映射到一代内平均性状向量的期望变化。陈述你所需要的任何正则性假设（例如弱选择、随机交配、可忽略的上位性以及连锁平衡）。然后，在加性遗传协方差矩阵和定向选择梯度恒定的情况下，设计并实现一个跨多代的相关适应模拟。\n\n将你的推导建立在以下经过充分检验的基础上：\n- Price方程：一个性状向量 $ \\boldsymbol{z} $ 的种群均值在一代内的期望变化由加性遗传值和相对适合度之间的协方差给出，外加一个在加性效应和随机交配条件下可忽略的传递项。\n- 加性遗传协方差矩阵 $ G $ 定义为 $ G = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) $，其中 $ \\boldsymbol{a} $ 表示性状的加性遗传值。\n- 表型选择梯度 $ \\boldsymbol{\\beta} $ 定义为平均适合度的对数相对于性状向量 $ \\boldsymbol{z} $ 的梯度，在当前均值处取值，这在线性近似相对适合度的条件下意味着 $ w(\\boldsymbol{z}) \\approx 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}}) $。\n\n任务：\n1. 在上述假设下，从第一性原理出发，推导平均性状向量 $ \\Delta \\bar{\\boldsymbol{z}} $ 的单代响应的显式矩阵-向量表达式，用 $ G $ 和 $ \\boldsymbol{\\beta} $ 表示。\n2. 在 $ G $ 和 $ \\boldsymbol{\\beta} $ 恒定的条件下，从初始平均性状向量 $ \\bar{\\boldsymbol{z}}_{0} $ 开始，实现一个 $ T $ 代的离散时间模拟。在每一代，使用你推导出的单代响应更新平均性状向量。\n3. 对于下方的每个测试用例，计算 $ T $ 代后的最终平均性状向量 $ \\bar{\\boldsymbol{z}}_{T} $。将 $ \\bar{\\boldsymbol{z}}_{T} $ 的每个条目表示为小数点后精确到六位的小数。\n\n推导和模拟中需采纳的假设：\n- 相对适合度经过缩放，使其在每一代的期望值为 $ 1 $。\n- 选择足够弱，使得相对适合度的线性近似在当前均值附近是准确的。\n- 加性效应占主导地位，伴随随机交配和可忽略的上位性，因此Price方程中的传递项可以被忽略，并且 $ G $ 在模拟的时间范围内是恒定的。\n- 连锁不平衡（LD）可忽略，因此 $ G $ 能够捕捉加性遗传协方差结构。\n\n模拟模型：\n- 令 $ \\bar{\\boldsymbol{z}}_{t+1} = \\bar{\\boldsymbol{z}}_{t} + \\Delta \\bar{\\boldsymbol{z}} $，其中 $ \\Delta \\bar{\\boldsymbol{z}} $ 是在任务1中推导出的单代响应。\n- 在 $ t = 0, 1, \\dots, T-1 $ 期间保持 $ G $ 和 $ \\boldsymbol{\\beta} $ 恒定。\n\n测试套件：\n为以下五个测试用例提供最终的平均性状向量。所有矩阵和向量都已明确给出。\n\n- 案例A（两个性状，正遗传协方差产生相关响应）：\n  - $ G = \\begin{bmatrix} 0.5  0.2 \\\\ 0.2  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.1 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} $, $ T = 10 $。\n\n- 案例B（三个性状，负协方差导致权衡）：\n  - $ G = \\begin{bmatrix} 0.4  -0.1  0.0 \\\\ -0.1  0.2  0.05 \\\\ 0.0  0.05  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.0 \\\\ 0.2 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix} $, $ T = 5 $。\n\n- 案例C（两个性状，秩为 $ 1 $ 的奇异矩阵 $ G $，选择方向与列空间正交）：\n  - $ G = \\begin{bmatrix} 0.3  0.3 \\\\ 0.3  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.1 \\\\ -0.1 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 1.0 \\\\ -1.0 \\end{bmatrix} $, $ T = 20 $。\n\n- 案例D（两个性状，零选择梯度不产生响应）：\n  - $ G = \\begin{bmatrix} 0.2  0.05 \\\\ 0.05  0.1 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.3 \\\\ -0.4 \\end{bmatrix} $, $ T = 7 $。\n\n- 案例E（三个性状，对角矩阵 $ G $ 导致独立响应）：\n  - $ G = \\begin{bmatrix} 0.1  0  0 \\\\ 0  0.2  0 \\\\ 0  0  0.05 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.2 \\\\ 0.1 \\\\ -0.2 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 1.0 \\\\ 2.0 \\\\ -1.0 \\end{bmatrix} $, $ T = 15 $。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个由列表组成的列表，用逗号分隔，并用一对单独的方括号括起来，不含空格。每个内部列表必须是对应一个测试用例的最终平均性状向量 $ \\bar{\\boldsymbol{z}}_{T} $，顺序与上述规定相同，每个条目都四舍五入到小数点后六位。例如，一个有效的输出对于两个案例看起来像 $ [[0.123456,0.000000],[1.000000]] $。\n- 不应打印任何额外文本。", "solution": "### 推导与实现\n\n#### 1. 单代选择响应方程的推导\n\n目标是推导 $ \\Delta \\bar{\\boldsymbol{z}} $ 的表达式，即一代内平均表型性状向量的变化。该推导植根于Price方程，并在所提供的数量遗传学假设下有效。\n\n1. 演化响应，即性状遗传成分的变化，是平均加性遗传值（育种值）向量 $ \\bar{\\boldsymbol{a}} $ 的变化。在没有传递偏差（例如，由减数分裂驱动或配子竞争引起）的假设下，平均表型 $ \\Delta \\bar{\\boldsymbol{z}} $ 的变化等于平均育种值 $ \\Delta \\bar{\\boldsymbol{a}} $ 的变化。Price方程在此背景下简化后，将此变化表示为育种值与相对适合度之间的协方差。问题规定相对适合度 $w$ 经过缩放，使其均值为 $1$，且传递项可忽略。因此，我们从以下公式开始：\n$$\n\\Delta \\bar{\\boldsymbol{z}} = \\Delta \\bar{\\boldsymbol{a}} = \\operatorname{Cov}(\\boldsymbol{a}, w)\n$$\n这里，$ \\boldsymbol{a} $ 是个体性状的育种值向量，$ w $ 是该个体的相对适合度。\n\n2. 问题提供了一个个体表型向量 $ \\boldsymbol{z} $ 与其相对适合度 $ w $ 之间关系的线性近似：\n$$\nw(\\boldsymbol{z}) \\approx 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}})\n$$\n其中 $ \\bar{\\boldsymbol{z}} $ 是当前种群的平均表型，$ \\boldsymbol{\\beta} $ 是定向选择梯度。我们将此近似代入协方差表达式：\n$$\n\\Delta \\bar{\\boldsymbol{z}} \\approx \\operatorname{Cov}(\\boldsymbol{a}, 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}}))\n$$\n\n3. 我们使用协方差算子的性质。与常数的协方差为零，因此 $ \\operatorname{Cov}(\\boldsymbol{a}, 1) = \\boldsymbol{0} $。此外，$ \\boldsymbol{\\beta}^{\\top}\\bar{\\boldsymbol{z}} $ 在给定时间对于种群来说是一个常数标量。因此：\n$$\n\\Delta \\bar{\\boldsymbol{z}} \\approx \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z} - \\boldsymbol{\\beta}^{\\top}\\bar{\\boldsymbol{z}}) = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z})\n$$\n\n4. 为了计算 $ \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z}) $，我们考虑其第 $ i $ 个分量，该分量对应第 $ i $ 个性状：\n$$\n[\\Delta \\bar{\\boldsymbol{z}}]_i \\approx \\operatorname{Cov}\\left(a_i, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z}\\right) = \\operatorname{Cov}\\left(a_i, \\sum_{j=1}^{n} \\beta_j z_j\\right)\n$$\n其中 $n$ 是性状的数量。根据协方差在其第二个参数上的线性性质：\n$$\n[\\Delta \\bar{\\boldsymbol{z}}]_i \\approx \\sum_{j=1}^{n} \\beta_j \\operatorname{Cov}(a_i, z_j)\n$$\n\n5. 项 $ \\operatorname{Cov}(a_i, z_j) $ 是性状 $ i $ 的育种值与性状 $ j $ 的表型值之间的协方差。表型 $ \\boldsymbol{z} $ 可以分解为其加性遗传成分 $ \\boldsymbol{a} $ 和一个残差成分 $ \\boldsymbol{e} $（非加性遗传效应和环境效应），即 $ \\boldsymbol{z} = \\boldsymbol{a} + \\boldsymbol{e} $。数量遗传学的一个核心假设是育种值与这些残差不相关，即 $ \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{e}) = \\boldsymbol{0} $。因此，育种值和表型之间的协方差矩阵为：\n$$\n\\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{z}) = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a} + \\boldsymbol{e}) = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) + \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{e}) = G + \\boldsymbol{0} = G\n$$\n其中，根据定义，$ G = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) $ 是加性遗传协方差矩阵。这意味着 $ \\operatorname{Cov}(a_i, z_j) = G_{ij} $。\n\n6. 将 $ G_{ij} $ 代回到 $ [\\Delta \\bar{\\boldsymbol{z}}]_i $ 的表达式中：\n$$\n[\\Delta \\bar{\\boldsymbol{z}}]_i \\approx \\sum_{j=1}^{n} G_{ij} \\beta_j\n$$\n这个和是矩阵-向量乘积 $ G\\boldsymbol{\\beta} $ 的第 $ i $ 个分量的定义。\n\n7. 由于这对所有分量 $ i=1, \\dots, n $ 都成立，我们得到了著名的多变量育种家方程，也称为Lande方程，它为单代响应提供了所需的显式矩阵-向量表达式：\n$$\n\\Delta \\bar{\\boldsymbol{z}} = G \\boldsymbol{\\beta}\n$$\n\n#### 2. 模拟模型的实现与计算\n\n该模拟追踪平均性状向量 $ \\bar{\\boldsymbol{z}} $ 在 $ T $ 代内的变化。更新规则由下式给出：\n$$\n\\bar{\\boldsymbol{z}}_{t+1} = \\bar{\\boldsymbol{z}}_{t} + \\Delta \\bar{\\boldsymbol{z}}\n$$\n根据问题陈述，加性遗传协方差矩阵 $ G $ 和选择梯度 $ \\boldsymbol{\\beta} $ 在整个模拟过程中都是恒定的。因此，单代响应 $ \\Delta \\bar{\\boldsymbol{z}} = G \\boldsymbol{\\beta} $ 也是一个恒定向量。\n\n令 $ \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = G \\boldsymbol{\\beta} $。该过程是一个等差数列：\n$$\n\\bar{\\boldsymbol{z}}_{1} = \\bar{\\boldsymbol{z}}_{0} + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}}\n$$\n$$\n\\bar{\\boldsymbol{z}}_{2} = \\bar{\\boldsymbol{z}}_{1} + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = (\\bar{\\boldsymbol{z}}_{0} + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}}) + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = \\bar{\\boldsymbol{z}}_{0} + 2 \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}}\n$$\n经过 $ T $ 代后，最终的平均性状向量 $ \\bar{\\boldsymbol{z}}_{T} $ 为：\n$$\n\\bar{\\boldsymbol{z}}_{T} = \\bar{\\boldsymbol{z}}_{0} + T \\cdot \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = \\bar{\\boldsymbol{z}}_{0} + T (G \\boldsymbol{\\beta})\n$$\n这个封闭形式的解计算效率高，并避免了对各代进行显式循环。它将用于计算测试用例的结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and simulates the multivariate response to selection.\n    \n    The core of the simulation is the Lande equation, delta_z = G * beta, which gives\n    the change in the mean trait vector in one generation. Since G and beta are constant,\n    the change is constant per generation. The final trait vector z_T after T generations\n    is z_0 + T * (G @ beta).\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"G\": np.array([[0.5, 0.2], [0.2, 0.3]]),\n            \"beta\": np.array([0.1, 0.0]),\n            \"z0\": np.array([0.0, 0.0]),\n            \"T\": 10\n        },\n        {\n            \"name\": \"Case B\",\n            \"G\": np.array([[0.4, -0.1, 0.0], [-0.1, 0.2, 0.05], [0.0, 0.05, 0.3]]),\n            \"beta\": np.array([0.0, 0.2, 0.0]),\n            \"z0\": np.array([0.0, 0.0, 0.0]),\n            \"T\": 5\n        },\n        {\n            \"name\": \"Case C\",\n            \"G\": np.array([[0.3, 0.3], [0.3, 0.3]]),\n            \"beta\": np.array([0.1, -0.1]),\n            \"z0\": np.array([1.0, -1.0]),\n            \"T\": 20\n        },\n        { \"name\": \"Case D\",\n            \"G\": np.array([[0.2, 0.05], [0.05, 0.1]]),\n            \"beta\": np.array([0.0, 0.0]),\n            \"z0\": np.array([0.3, -0.4]),\n            \"T\": 7\n        },\n        {\n            \"name\": \"Case E\",\n            \"G\": np.array([[0.1, 0, 0], [0, 0.2, 0], [0, 0, 0.05]]),\n            \"beta\": np.array([0.2, 0.1, -0.2]),\n            \"z0\": np.array([1.0, 2.0, -1.0]),\n            \"T\": 15\n        }\n    ]\n\n    all_results_strings = []\n\n    for case in test_cases:\n        G = case[\"G\"]\n        beta = case[\"beta\"]\n        z0 = case[\"z0\"]\n        T = case[\"T\"]\n\n        # Calculate the single-generation change in the mean trait vector\n        # This is the Lande equation: delta__z = G @ beta\n        delta_z = G @ beta\n        \n        # Calculate the final mean trait vector after T generations\n        # For constant G and beta, this is an arithmetic progression: z_T = z_0 + T * delta_z\n        z_T = z0 + T * delta_z\n        \n        # Format the resulting vector according to the problem specification\n        # Each element is rounded to exactly six decimal places.\n        formatted_vector_parts = [f\"{x:.6f}\" for x in z_T]\n        vector_string = f\"[{','.join(formatted_vector_parts)}]\"\n        all_results_strings.append(vector_string)\n\n    # Join the results for all test cases into a single string\n    final_output = f\"[{','.join(all_results_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3338787"}]}