{"hands_on_practices": [{"introduction": "在许多生物物理的代理基模型（ABM）中，核心原则之一是细致平衡，它将微观动力学与宏观热力学联系起来。此练习将引导您探索一个简单的双态代理（例如，受体与其配体的结合）的动力学，并验证其稳态行为如何与玻尔兹曼分布所预测的热力学平衡相对应。通过这个实践 [@problem_id:3288015]，您将深入理解如何通过设定动力学速率$k_{\\text{on}}$和$k_{\\text{off}}$来确保您的模型在物理上是一致的，这是构建可靠的细胞系统模型的基础。", "problem": "您需要实现一个基于智能体的模拟，模拟一群独立的细胞智能体（例如，受体），每个智能体都与一个隐式配体库发生随机的结合和解离。每个智能体是一个双态连续时间 Markov 过程，状态为“未结合”和“已结合”。令 $k_\\text{on}$ 表示从未结合到已结合的跃迁速率，令 $k_\\text{off}$ 表示从已结合到未结合的跃迁速率。使用的基本原理包括双态系统的 Markovian 主方程、用于热力学一致性的细致平衡原理以及微观状态概率的 Boltzmann 分布。无量纲的结合自由能差定义为 $\\Delta g = \\Delta G/(k_B T)$，其中 $k_B$ 是 Boltzmann 常数，$T$ 是绝对温度；在本问题中，所有能量都以 $k_B T$ 为单位表示，因此 $\\Delta g$ 是无量纲的，不需要物理能量单位。时间单位是任意的，速率 $k_\\text{on}$ 和 $k_\\text{off}$ 的单位是与这些任意单位一致的逆时间单位。\n\n从第一性原理出发，推导单个智能体已结合态的长时间分布，将其表示为 $k_\\text{on}$ 和 $k_\\text{off}$ 的函数。然后，利用细致平衡条件 $k_\\text{on}/k_\\text{off} = \\exp(-\\Delta g)$，证明热力学一致性如何约束长时间已结合分数以符合两个状态上的 Boltzmann 分布。另外，考虑一个违反细致平衡的情景，通过独立于 $\\Delta g$ 设置 $k_\\text{on}$ 和 $k_\\text{off}$；确定由此产生的长时间已结合分数，并解释它如何以及为何偏离 Boltzmann 预测。\n\n您的程序必须：\n- 模拟一个异质的智能体种群，该种群被划分为多个组，每个组由其自身的 $\\Delta g$ 和智能体数量来表征。\n- 对于每个组，假设所有智能体在时间 $t=0$ 时都处于未结合状态。使用您推导出的主方程解，计算在指定的大时间 $T$ 时，两种情景下的已结合态概率：\n  1. 热力学一致（强制细致平衡）：选择 $k_\\text{on}$ 和 $k_\\text{off}$ 使得 $k_\\text{on}/k_\\text{off} = \\exp(-\\Delta g)$。\n  2. 热力学不一致（违反细致平衡）：选择独立于 $\\Delta g$ 的 $k_\\text{on}$ 和 $k_\\text{off}$。\n- 对于每个情景和每个组，以计算出的已结合概率进行独立的 Bernoulli 试验，采样在时间 $T$ 的已结合智能体数量，报告经验已结合分数，并将其与 Boltzmann 预测 $\\exp(-\\Delta g)/(1+\\exp(-\\Delta g))$ 进行比较。\n- 将每个测试用例的差异量化为该测试用例中所有组的经验已结合分数与 Boltzmann 预测之间的平均绝对差。\n- 对于每个测试用例，如果强制细致平衡下的差异小于或等于违反细致平衡下的差异（在容差 $\\epsilon$ 范围内），则生成一个布尔结果 true。\n\n为保证可复现性，请使用固定的随机种子。所有能量都是 $k_B T$ 的无量纲倍数，时间单位是任意的，速率是这些单位的逆时间单位。不要使用任何外部输入。请严格按照规定实现计算和采样。\n\n测试套件：\n- 案例 A（异质性，“理想路径”）：$\\Delta g$ 值 $[0, 2, 6]$，组大小 $[5000, 3000, 2000]$，基线速率 $k_0 = 5$（逆时间），总时间 $T = 5$，容差 $\\epsilon = 0.02$，随机种子 $42$。\n- 案例 B（边界条件）：$\\Delta g$ 值 $[0]$，组大小 $[10000]$，基线速率 $k_0 = 3$，总时间 $T = 5$，容差 $\\epsilon = 0.02$，随机种子 $43$。\n- 案例 C（极端异质性）：$\\Delta g$ 值 $[-4, 2]$，组大小 $[8000, 2000]$，基线速率 $k_0 = 1$，总时间 $T = 2$，容差 $\\epsilon = 0.02$，随机种子 $44$。\n\n实现细节：\n- 在热力学一致的情景中，您必须为每个组选择 $k_\\text{on}$ 和 $k_\\text{off}$，使得 $k_\\text{on}/k_\\text{off} = \\exp(-\\Delta g)$；您可以通过 $k_0$ 选择一个共同的时间尺度来设置其中一个速率（例如，$k_\\text{off} = k_0$ 且 $k_\\text{on} = k_0 \\exp(-\\Delta g)$）。\n- 在热力学不一致的情景中，对所有组设置 $k_\\text{on} = k_0$ 和 $k_\\text{off} = k_0$（即独立于 $\\Delta g$）。\n- 使用您推导出的双态主方程的时间相关解，根据初始条件计算时间 $T$ 时的已结合概率。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[True,False,True]”）。该列表必须按顺序包含与案例 A、B 和 C 相对应的恰好三个布尔值。", "solution": "该问题是有效的，因为它在科学上基于统计力学和化学动力学原理，问题阐述清晰，目标明确，信息充分，并使用了客观、正式的语言。它代表了计算系统生物学中的一个标准练习。\n\n我们首先按照规定从第一性原理推导必要的理论结果。\n\n设细胞智能体的两个状态为“未结合”（$U$）和“已结合”（$B$）。该系统是一个连续时间 Markov 过程，由跃迁速率 $k_\\text{on}$（对于 $U \\to B$）和 $k_\\text{off}$（对于 $B \\to U$）控制。令 $P_U(t)$ 和 $P_B(t)$ 分别为在时间 $t$ 找到智能体处于未结合和已结合状态的概率。概率守恒要求对于所有 $t$，都有 $P_U(t) + P_B(t) = 1$。\n\n已结合态概率 $P_B(t)$ 的演化由主方程描述：\n$$\n\\frac{dP_B(t)}{dt} = (\\text{流入 B 的通量速率}) - (\\text{流出 B 的通量速率})\n$$\n$$\n\\frac{dP_B(t)}{dt} = k_\\text{on} P_U(t) - k_\\text{off} P_B(t)\n$$\n将 $P_U(t) = 1 - P_B(t)$ 代入方程，得到一个关于 $P_B(t)$ 的闭式常微分方程：\n$$\n\\frac{dP_B(t)}{dt} = k_\\text{on} (1 - P_B(t)) - k_\\text{off} P_B(t)\n$$\n$$\n\\frac{dP_B(t)}{dt} = k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_B(t)\n$$\n这是一个一阶线性非齐次微分方程。长时间分布，或稳态概率 $P_{B,ss}$，是通过将时间导数设为零（$\\frac{dP_B}{dt} = 0$）得到的：\n$$\n0 = k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_{B,ss}\n$$\n解出 $P_{B,ss}$ 得到长时间已结合分数：\n$$\nP_{B,ss} = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}}\n$$\n为了解带有初始条件（即在 $t=0$ 时所有智能体都未结合，$P_B(0) = 0$）的时间相关方程，我们可以将常微分方程重排为：\n$$\n\\frac{dP_B}{k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_B} = dt\n$$\n将两边分别从 $t'=0$ 积分到 $t'=t$ 以及从 $P_B=0$ 积分到 $P_B=P_B(t)$：\n$$\n\\int_{0}^{P_B(t)} \\frac{dP'_B}{k_\\text{on} - (k_\\text{on} + k_\\text{off}) P'_B} = \\int_{0}^{t} dt'\n$$\n$$\n\\left[ -\\frac{1}{k_\\text{on} + k_\\text{off}} \\ln(k_\\text{on} - (k_\\text{on} + k_\\text{off}) P'_B) \\right]_0^{P_B(t)} = t\n$$\n$$\n\\ln\\left(\\frac{k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_B(t)}{k_\\text{on}}\\right) = -(k_\\text{on} + k_\\text{off})t\n$$\n$$\n1 - \\frac{k_\\text{on} + k_\\text{off}}{k_\\text{on}} P_B(t) = e^{-(k_\\text{on} + k_\\text{off})t}\n$$\n解出 $P_B(t)$ 得到完整的时间相关解：\n$$\nP_B(t) = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}} \\left( 1 - e^{-(k_\\text{on} + k_\\text{off})t} \\right)\n$$\n这就是我们将用来计算有限时间 $T$ 时已结合概率的方程。\n\n接下来，我们在热力学一致性的约束下考察该系统，该约束由细致平衡原理强制执行。在热力学平衡时，正向和反向速率之比与状态间的无量纲自由能差 $\\Delta g = (G_B - G_U)/(k_B T)$ 相关：\n$$\n\\frac{k_\\text{on}}{k_\\text{off}} = e^{-\\Delta g}\n$$\n将此代入稳态概率 $P_{B,ss}$：\n$$\nP_{B,ss} = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}} = \\frac{k_\\text{on}/k_\\text{off}}{k_\\text{on}/k_\\text{off} + 1} = \\frac{e^{-\\Delta g}}{1 + e^{-\\Delta g}}\n$$\n这正是一个双态系统的已结合态的 Boltzmann 概率，其中未结合态的能量为 $0$，已结合态的能量为 $\\Delta g$（以 $k_B T$ 为单位）。配分函数为 $Z = e^{-0/k_B T} + e^{-\\Delta G/k_B T} = 1 + e^{-\\Delta g}$，已结合态的概率为 $e^{-\\Delta g}/Z$。因此，细致平衡确保了动力学稳态与热力学平衡分布相对应。\n\n在违反细致平衡的情景中，$k_\\text{on}$ 和 $k_\\text{off}$ 的设置与 $\\Delta g$ 无关。例如，如果我们设置 $k_\\text{on} = k_0$ 和 $k_\\text{off} = k_0$，稳态已结合分数变为：\n$$\nP_{B,ss} = \\frac{k_0}{k_0 + k_0} = \\frac{1}{2}\n$$\n这个结果分布是一个非平衡稳态（NESS）。它完全由所选的动力学决定，而不由潜在的能量差 $\\Delta g$ 决定。它只会偶然地与 Boltzmann 预测相匹配，特别是在 $\\Delta g=0$ 的情况下，此时 Boltzmann 概率为 $\\frac{e^{-0}}{1+e^{-0}} = \\frac{1}{2}$。对于任何其他 $\\Delta g \\neq 0$，NESS 分布都会偏离热力学平衡预测，因为动力学速率不能正确反映状态的相对稳定性。\n\n模拟的算法如下。对于每个测试用例：\n1. 初始化参数：$\\Delta g_i$ 值列表、相应的组大小 $N_i$、基线速率 $k_0$、总时间 $T$、容差 $\\epsilon$ 和一个随机种子。\n2. 对于两种情景（热力学一致和不一致），计算所有组的平均绝对差异。\n3. 为计算一个情景的差异：\n   a. 初始化一个空列表以存储绝对差。\n   b. 对于每个组 $i$（能量为 $\\Delta g_i$，大小为 $N_i$）：\n      i. 根据情景规则设置速率 $k_\\text{on}$ 和 $k_\\text{off}$。\n      ii. 使用推导出的时间相关解计算理论已结合概率 $P_{B,i}(T)$：$P_{B,i}(T) = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}} (1 - e^{-(k_\\text{on} + k_\\text{off})T})$。\n      iii. 通过从二项分布中抽样生成已结合智能体的数量：$n_{\\text{bound}, i} \\sim \\text{Binomial}(N_i, P_{B,i}(T))$。\n      iv. 计算经验已结合分数 $f_i = n_{\\text{bound}, i} / N_i$。\n      v. 计算参考 Boltzmann 概率 $P_{\\text{Boltzmann}, i} = \\frac{e^{-\\Delta g_i}}{1 + e^{-\\Delta g_i}}$。\n      vi. 计算绝对差 $|f_i - P_{\\text{Boltzmann}, i}|$ 并将其添加到列表中。\n   c. 该情景的差异是收集到的绝对差的平均值。\n4. 比较两个差异。如果一致情景的差异小于或等于不一致情景的差异加上容差 $\\epsilon$，则测试用例的结果为 `True`。\n5. 收集所有测试用例的布尔结果，并按指定格式进行格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by simulating a population of two-state cellular agents\n    under thermodynamically consistent and inconsistent kinetic schemes.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"dg_values\": [0.0, 2.0, 6.0],\n            \"group_sizes\": [5000, 3000, 2000],\n            \"k0\": 5.0,\n            \"T\": 5.0,\n            \"epsilon\": 0.02,\n            \"seed\": 42\n        },\n        {\n            \"name\": \"Case B\",\n            \"dg_values\": [0.0],\n            \"group_sizes\": [10000],\n            \"k0\": 3.0,\n            \"T\": 5.0,\n            \"epsilon\": 0.02,\n            \"seed\": 43\n        },\n        {\n            \"name\": \"Case C\",\n            \"dg_values\": [-4.0, 2.0],\n            \"group_sizes\": [8000, 2000],\n            \"k0\": 1.0,\n            \"T\": 2.0,\n            \"epsilon\": 0.02,\n            \"seed\": 44\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        dg_values = np.array(case[\"dg_values\"])\n        group_sizes = np.array(case[\"group_sizes\"])\n        k0 = case[\"k0\"]\n        T = case[\"T\"]\n        epsilon = case[\"epsilon\"]\n        seed = case[\"seed\"]\n\n        np.random.seed(seed)\n\n        # --- Scenario 1: Thermodynamically Consistent (Detailed Balance) ---\n        diffs_consistent = []\n        for dg, N in zip(dg_values, group_sizes):\n            # Set rates according to detailed balance: k_on/k_off = exp(-dg)\n            # We choose k_off = k0 as a common timescale.\n            k_off = k0\n            k_on = k0 * np.exp(-dg)\n\n            # Calculate time-dependent bound probability P_B(T)\n            # P_B(t) = [k_on / (k_on + k_off)] * (1 - exp(-(k_on + k_off)*t))\n            k_sum = k_on + k_off\n            if k_sum == 0:\n                 # Avoid division by zero if both rates are zero\n                 p_bound_at_T = 0.0\n            else:\n                 p_ss = k_on / k_sum\n                 p_bound_at_T = p_ss * (1.0 - np.exp(-k_sum * T))\n\n            # Sample number of bound agents\n            num_bound = np.random.binomial(n=N, p=p_bound_at_T)\n            empirical_fraction = num_bound / N\n\n            # Calculate Boltzmann prediction\n            boltzmann_prediction = np.exp(-dg) / (1.0 + np.exp(-dg))\n\n            # Calculate absolute difference and store it\n            diffs_consistent.append(np.abs(empirical_fraction - boltzmann_prediction))\n\n        discrepancy_consistent = np.mean(diffs_consistent)\n\n        # --- Scenario 2: Thermodynamically Inconsistent (Detailed Balance Violated) ---\n        diffs_inconsistent = []\n        for dg, N in zip(dg_values, group_sizes):\n            # Set rates independent of dg\n            k_off = k0\n            k_on = k0\n\n            # Calculate time-dependent bound probability P_B(T)\n            k_sum = k_on + k_off\n            p_ss = k_on / k_sum\n            p_bound_at_T = p_ss * (1.0 - np.exp(-k_sum * T))\n\n            # Sample number of bound agents\n            num_bound = np.random.binomial(n=N, p=p_bound_at_T)\n            empirical_fraction = num_bound / N\n            \n            # Calculate Boltzmann prediction (same as before)\n            boltzmann_prediction = np.exp(-dg) / (1.0 + np.exp(-dg))\n\n            # Calculate absolute difference and store it\n            diffs_inconsistent.append(np.abs(empirical_fraction - boltzmann_prediction))\n\n        discrepancy_inconsistent = np.mean(diffs_inconsistent)\n\n        # --- Final Comparison ---\n        # The result is true if discrepancy_consistent is less than or equal to\n        # discrepancy_inconsistent within the tolerance epsilon.\n        is_less_or_equal = (discrepancy_consistent = discrepancy_inconsistent + epsilon)\n        results.append(is_less_or_equal)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3288015"}, {"introduction": "代理基模型的一个关键优势在于其能够连接不同尺度的现象。此练习 [@problem_id:3287941] 探讨了控制代理如何与其环境边界（例如，吸收、反射或周期性边界）相互作用的微观规则与相应连续介质（偏微分方程）模型中使用的宏观边界条件之间的重要联系。您不仅需要形式化地定义这些规则，还需要通过求解一个经典的平均首达时间问题，来加深对随机过程基本量的理解。", "problem": "考虑一个基于智能体的模型（ABM），其中无相互作用的细胞在矩形域 $\\Omega = (0,L_{x}) \\times (0,L_{y})$ 内进行无偏布朗运动，扩散系数为 $D$。在离散时间下，时间步长为 $\\Delta t$，位于位置 $\\mathbf{X}(t) \\in \\Omega$ 的单个细胞提出一个无约束的欧拉-丸山更新 $\\mathbf{X}^{\\ast}(t+\\Delta t) = \\mathbf{X}(t) + \\sqrt{2D\\,\\Delta t}\\,\\boldsymbol{\\xi}$，其中 $\\boldsymbol{\\xi} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{2})$。物理边界 $\\partial \\Omega$ 施加一个边界处理规则，该规则根据边界类型，将 $\\mathbf{X}^{\\ast}(t+\\Delta t)$ 映射到实现的 $\\mathbf{X}(t+\\Delta t)$ 或终止该智能体。在流体动力学极限 $\\Delta t \\to 0$ 且 $D$ 固定的情况下，智能体位置的单细胞概率密度 $p(\\mathbf{x},t)$ 遵循带有菲克通量的扩散方程进行演化。\n\n任务 A（形式化说明）：针对以下三种边界类型，给出在 $\\partial \\Omega$ 上的精确、可在机理上实现的 ABM 边界处理规则，并陈述其对应的概率密度 $p(\\mathbf{x},t)$ 和通量 $\\mathbf{J}(\\mathbf{x},t)$ 的连续介质边界条件：\n- 吸收边界。\n- 反射（镜面）边界。\n- 周期性边界。\n\n您的 ABM 规则必须对离开 $\\Omega$ 的 $\\mathbf{X}^{\\ast}(t+\\Delta t)$ 的任何分量都有良定义，并且您的连续介质表述必须以 $p(\\mathbf{x},t)$、$\\partial \\Omega$ 上的单位外法线向量 $\\mathbf{n}(\\mathbf{x})$ 以及扩散通量 $\\mathbf{J}(\\mathbf{x},t) = -D \\nabla p(\\mathbf{x},t)$ 来给出。\n\n任务 B（平均离开时间计算）：特化到一维空间，域为 $[0,L]$，其中 $L0$ 为固定值。在 $x=0$ 处施加吸收边界，在 $x=L$ 处施加反射边界。一个单细胞从位置 $x \\in (0,L)$ 开始，以扩散系数 $D$ 进行无偏布朗运动。在 $\\Delta t \\to 0$ 的极限下，使用基于无穷小生成元或第一步分析法的有效第一性原理推导，导出并计算在 $x=0$ 处被吸收的平均时间 $T(x)$。请以 $x$、$L$ 和 $D$ 的单个闭式解析表达式形式提供您的最终答案。不需要进行数值计算或四舍五入。最终答案中不要报告中间步骤或边界条件陈述；仅报告 $T(x)$ 的表达式。", "solution": "问题陈述已被验证，并被认为是合理的。它在科学上基于随机过程和扩散理论的原理，是适定的，信息充分且一致，并以客观、精确的语言表述。所有给定的条件在计算系统生物学和数理物理学领域都是标准的。该问题是对微观基于智能体的规则与宏观连续介质描述之间关系的理解，以及对平均首达时间计算的有效检验。\n\n**任务 A：边界处理规则与连续介质条件**\n\n问题涉及一个基于智能体的模型（ABM），其中细胞的位置 $\\mathbf{X}(t)$ 通过 $\\mathbf{X}^{\\ast}(t+\\Delta t) = \\mathbf{X}(t) + \\sqrt{2D\\,\\Delta t}\\,\\boldsymbol{\\xi}$ 进行更新，其中 $\\boldsymbol{\\xi}$ 是一个来自标准二元正态分布的随机向量。域为 $\\Omega = (0, L_{x}) \\times (0, L_{y})$。如果建议的位置 $\\mathbf{X}^{\\ast}$ 落到 $\\Omega$ 之外，则应用一个规则来确定最终位置 $\\mathbf{X}(t+\\Delta t)$。在连续介质极限下，概率密度 $p(\\mathbf{x}, t)$ 遵循扩散方程 $\\frac{\\partial p}{\\partial t} = D \\nabla^2 p$，扩散通量为 $\\mathbf{J}(\\mathbf{x}, t) = -D \\nabla p(\\mathbf{x}, t)$。边界 $\\partial \\Omega$ 上的单位外法线向量记为 $\\mathbf{n}(\\mathbf{x})$。\n\n三种指定边界类型的规则和相应的连续介质条件如下。\n\n**吸收边界**\n\n吸收边界如同一个“汇”，智能体在接触时即被从模拟中移除。\n\n*   **ABM 规则：** 设建议的位置为 $\\mathbf{X}^{\\ast}(t+\\Delta t)$。如果 $\\mathbf{X}^{\\ast}(t+\\Delta t) \\notin \\Omega$，则该智能体被终止并从模拟中移除。其轨迹在穿过边界的时刻结束。\n*   **连续介质条件：** 由于任何到达边界的智能体都会被立即移除，因此在任何时刻，在边界上的任何一点找到智能体的概率都必须为零。这是一个狄利克雷边界条件。\n    $$p(\\mathbf{x}, t) = 0, \\quad \\forall \\mathbf{x} \\in \\partial \\Omega$$\n    该条件意味着存在一个指向域外的非零通量 $\\mathbf{J}(\\mathbf{x},t)$，代表吸收速率。\n\n**反射（镜面）边界**\n\n反射边界如同一个不可穿透的屏障，使智能体“反弹”回来。没有智能体可以穿过此边界。\n\n*   **ABM 规则：** 设建议的位置为 $\\mathbf{X}^{\\ast}(t+\\Delta t) = (X^{\\ast}, Y^{\\ast})$。如果该向量的某个分量位于其相应区间之外（例如，$X^{\\ast}  0$），则该分量被反射回域内。反射规则独立应用于每个离开域的坐标。\n    *   若 $X^{\\ast}  0$，新的 x 坐标为 $X(t+\\Delta t) = -X^{\\ast}$。\n    *   若 $X^{\\ast}  L_x$，新的 x 坐标为 $X(t+\\Delta t) = L_x - (X^{\\ast} - L_x) = 2L_x - X^{\\ast}$。\n    *   若 $Y^{\\ast}  0$，新的 y 坐标为 $Y(t+\\Delta t) = -Y^{\\ast}$。\n    *   若 $Y^{\\ast}  L_y$，新的 y 坐标为 $Y(t+\\Delta t) = L_y - (Y^{\\ast} - L_y) = 2L_y - Y^{\\ast}$。\n    如果两个坐标都离开域，则两个规则都适用。最终位置 $\\mathbf{X}(t+\\Delta t)$ 保证在 $\\Omega$ 内。\n*   **连续介质条件：** 由于没有智能体能穿过边界，垂直于边界的概率密度净通量必须为零。这是一个诺伊曼边界条件。\n    $$\\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) = 0, \\quad \\forall \\mathbf{x} \\in \\partial \\Omega$$\n    使用通量的定义，这等同于陈述概率密度在边界处的法向导数为零：$\\nabla p(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) = 0$。\n\n**周期性边界**\n\n周期性边界模拟一个拓扑上等价于环面的系统。一个智能体从域的一侧离开，会立即从相对的一侧重新进入。\n\n*   **ABM 规则：** 设建议的位置为 $\\mathbf{X}^{\\ast}(t+\\Delta t) = (X^{\\ast}, Y^{\\ast})$。最终的位置坐标使用模运算映射回域内。\n    *   新的 x 坐标为 $X(t+\\Delta t) = X^{\\ast} \\pmod{L_x}$。其实现方式为：若 $X^{\\ast}  0$，则设置 $X(t+\\Delta t) = X^{\\ast} + L_x$；若 $X^{\\ast}  L_x$，则设置 $X(t+\\Delta t) = X^{\\ast} - L_x$。\n    *   新的 y 坐标为 $Y(t+\\Delta t) = Y^{\\ast} \\pmod{L_y}$。其实现方式为：若 $Y^{\\ast}  0$，则设置 $Y(t+\\Delta t) = Y^{\\ast} + L_y$；若 $Y^{\\ast}  L_y$，则设置 $Y(t+\\Delta t) = Y^{\\ast} - L_y$。\n*   **连续介质条件：** 概率密度和通量必须在相对的边界上是连续的。对于矩形域相对面上的任何一对对应点（例如，$\\mathbf{x}_1 = (0, y)$ 和 $\\mathbf{x}_2 = (L_x, y)$），其概率密度和通量必须匹配。\n    *   $p(0, y, t) = p(L_x, y, t)$\n    *   $p(x, 0, t) = p(x, L_y, t)$\n    以及通量：\n    *   $\\mathbf{J}(0, y, t) = \\mathbf{J}(L_x, y, t)$\n    *   $\\mathbf{J}(x, 0, t) = \\mathbf{J}(x, L_y, t)$\n    通量上的条件等价于在相对面上密度的梯度 $\\nabla p$ 相匹配。\n\n**任务 B：平均离开时间计算**\n\n我们的任务是找到一个从 $x \\in (0,L)$ 开始的粒子在边界 $x=0$ 处被吸收的平均时间 $T(x)$。域为 $[0,L]$，在 $x=0$ 处为吸收边界，在 $x=L$ 处为反射边界。粒子以扩散系数 $D$ 进行布朗运动。\n\n设 $T(x)$ 为从 $x$ 开始到 $0$ 的平均首达时间。函数 $T(x)$ 满足后向福克-普朗克方程，对于此问题，该方程为：\n$$\\mathcal{A} T(x) = -1$$\n其中 $\\mathcal{A}$ 是该随机过程的无穷小生成元。对于扩散系数为 $D$ 的一维布朗运动，生成元为 $\\mathcal{A} = D \\frac{d^2}{dx^2}$。\n\n将生成元代入方程，得到 $T(x)$ 的控制常微分方程（ODE）：\n$$D \\frac{d^2 T}{dx^2} = -1$$\n这可以写成：\n$$\\frac{d^2 T}{dx^2} = -\\frac{1}{D}$$\n我们通过对 $x$ 积分两次来解此 ODE：\n$$\\frac{dT}{dx} = -\\frac{x}{D} + C_1$$\n$$T(x) = -\\frac{x^2}{2D} + C_1 x + C_2$$\n其中 $C_1$ 和 $C_2$ 是由边界条件决定的积分常数。\n\n平均离开时间 $T(x)$ 的边界条件是从原始过程中边界的物理性质推导出来的：\n\n1.  **在 $x=0$ 处的吸收边界**：如果粒子从吸收边界开始，它会立即被吸收。因此，吸收时间为零。\n    $$T(0) = 0$$\n2.  **在 $x=L$ 处的反射边界**：在反射边界处，没有粒子的净通量。对于平均离开时间问题，这转化为一个零梯度条件。这可以通过考虑一个在 $L-\\epsilon$ 处的粒子，其可能的未来路径被一个在 $L+\\epsilon$ 处的虚拟粒子所镜像，从而使得 $T(x)$ 在 $x=L$ 附近局部对称来理解。\n    $$\\left. \\frac{dT}{dx} \\right|_{x=L} = 0$$\n\n现在，我们应用这些条件来求 $C_1$ 和 $C_2$。\n\n应用第一个条件，$T(0)=0$：\n$$T(0) = -\\frac{0^2}{2D} + C_1(0) + C_2 = 0 \\implies C_2 = 0$$\n解简化为 $T(x) = -\\frac{x^2}{2D} + C_1 x$。\n\n接下来，我们将第二个条件 $T'(L)=0$ 应用于一阶导数 $T'(x) = -\\frac{x}{D} + C_1$：\n$$\\left. \\frac{dT}{dx} \\right|_{x=L} = -\\frac{L}{D} + C_1 = 0 \\implies C_1 = \\frac{L}{D}$$\n\n将确定的常数 $C_1$ 代回 $T(x)$ 的表达式中：\n$$T(x) = -\\frac{x^2}{2D} + \\frac{L}{D}x$$\n这就是平均吸收时间的闭式解析表达式。为了清晰起见，可以将其因式分解：\n$$T(x) = \\frac{2Lx - x^2}{2D} = \\frac{x(2L - x)}{2D}$$\n这是平均离开时间作为起始位置 $x$ 的函数的最终表达式。", "answer": "$$ \\boxed{\\frac{x(2L - x)}{2D}} $$", "id": "3287941"}, {"introduction": "许多先进的细胞系统模型是混合模型，将离散的细胞代理与由偏微分方程（PDE）描述的连续动态场（如化学引诱物浓度）耦合起来。这种耦合带来了实际的挑战，即如何确保整个系统的数值稳定性。此练习 [@problem_id:3287966] 将指导您推导和应用著名的 Courant-Friedrichs-Lewy (CFL) 条件，以确定一个合适的时间步长 $\\Delta t$，从而保证耦合模拟的稳定性和准确性，这是任何严肃的建模者都必须掌握的关键技能。", "problem": "在一个趋化细胞系统的二维耦合偏微分方程-智能体模型 (PDE–ABM) 中，胞外化学引诱物浓度场 $c(x,y,t)$ 满足常系数平流-扩散方程\n$$\n\\frac{\\partial c}{\\partial t} + u_x \\frac{\\partial c}{\\partial x} + u_y \\frac{\\partial c}{\\partial y} = D \\left(\\frac{\\partial^2 c}{\\partial x^2} + \\frac{\\partial^2 c}{\\partial y^2}\\right),\n$$\n该方程在一个两个方向上间距均为 $h$ 的均匀笛卡尔网格上，使用显式前向欧拉法进行时间推进，其中平流项使用一阶迎风差分，扩散项使用五点模板。智能体在连续空间中移动，其速度上限为 $v_{\\max}$，并经历随机反应（例如，受体结合），这些反应被建模为独立的泊松过程，每个智能体的最大倾向为 $\\lambda_{\\max}$。\n\n仅使用基本的离散化原理和泊松过程的定义，推导显式偏微分方程求解器的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，并将其与 ABM 时间步长约束联系起来，以使单个同步时间步长 $\\Delta t$ 能确保耦合的稳定性和一致性。具体来说，\n\n- 推导一个用 $D$、$u_x$、$u_y$ 和 $h$ 表示的、针对该偏微分方程的充分的显式步长稳定性/单调性条件；\n- 推导 ABM 约束，以防止智能体在单个步长内穿越超过一个偏微分方程网格间距，并将每步反应概率限制在一个小容差 $\\varepsilon$ 内。\n\n然后，给定以下参数值\n$$\nD = 2 \\times 10^{-10}\\ \\mathrm{m^2\\,s^{-1}},\\quad u_x = 1 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}},\\quad u_y = 5 \\times 10^{-6}\\ \\mathrm{m\\,s^{-1}},\n$$\n$$\nh = 5 \\times 10^{-6}\\ \\mathrm{m},\\quad v_{\\max} = 15\\ \\mathrm{\\mu m\\,min^{-1}},\\quad \\lambda_{\\max} = 0.5\\ \\mathrm{s^{-1}},\\quad \\varepsilon = 0.05,\n$$\n计算同时满足所有约束的最大允许同步时间步长 $\\Delta t^{\\ast}$。以秒为单位表示最终答案，并四舍五入到四位有效数字。", "solution": "我们从线性平流-扩散方程及其在均匀网格上的显式前向欧拉空间离散化开始，其中平流项采用一阶迎风格式，扩散项采用五点拉普拉斯算子。设 $x$ 和 $y$ 方向的网格间距均为 $h$，并将离散浓度表示为 $c_{i,j}^n \\approx c(x_i,y_j,t^n)$。\n\n对于常数平流速度 $u_x$ 和 $u_y$ 以及扩散系数 $D$，内部节点的前向欧拉更新形式为\n$$\nc_{i,j}^{n+1} = c_{i,j}^{n} - \\alpha_x \\left(c_{i,j}^{n} - c_{i-\\sigma_x,j}^{n}\\right) - \\alpha_y \\left(c_{i,j}^{n} - c_{i,j-\\sigma_y}^{n}\\right) + \\beta \\left(c_{i+1,j}^{n}+c_{i-1,j}^{n}+c_{i,j+1}^{n}+c_{i,j-1}^{n}-4c_{i,j}^{n}\\right),\n$$\n其中 $\\sigma_x = \\operatorname{sign}(u_x)$ 选择迎风方向，且非负系数为\n$$\n\\alpha_x = \\frac{|u_x|\\,\\Delta t}{h},\\quad \\alpha_y = \\frac{|u_y|\\,\\Delta t}{h},\\quad \\beta = \\frac{D\\,\\Delta t}{h^2}.\n$$\n对于这个线性标量问题的显式更新，其稳定性与单调性（离散极值原理）的一个充分条件是，$c_{i,j}^{n+1}$ 是当前值和邻近值的凸组合，这要求所有权重都为非负且总和为一。整理 $c_{i,j}^{n}$ 的系数得到\n$$\n\\text{coeff}(c_{i,j}^{n}) = 1 - \\alpha_x - \\alpha_y - 4\\beta,\n$$\n且根据构造，邻近点的系数是非负的。因此，一个充分的稳定性/单调性条件是\n$$\n1 - \\alpha_x - \\alpha_y - 4\\beta \\ge 0 \\quad \\Longleftrightarrow \\quad \\alpha_x + \\alpha_y + 4\\beta \\le 1.\n$$\n将 $\\alpha_x$、$\\alpha_y$ 和 $\\beta$ 的定义代入，得到显式平流-扩散格式的 Courant–Friedrichs–Lewy (CFL) 型界限，\n$$\n\\Delta t \\le \\frac{1}{\\dfrac{|u_x|}{h} + \\dfrac{|u_y|}{h} + \\dfrac{4D}{h^2}}.\n$$\n\n我们现在将其与智能体模型 (ABM) 的约束联系起来。两个基本要求确保了耦合的稳定性和一致性：\n\n1. 与网格的运动学耦合：设 $v_{\\max}$ 为智能体的最大速度。为防止智能体在单个步长内穿越超过一个网格间距，我们要求位移 $v_{\\max}\\,\\Delta t$ 不超过 $h$，\n$$\nv_{\\max}\\,\\Delta t \\le h \\quad \\Longrightarrow \\quad \\Delta t \\le \\frac{h}{v_{\\max}}.\n$$\n\n2. 泊松事件分辨率：对于速率为 $\\lambda_{\\max}$ 的泊松过程，在大小为 $\\Delta t$ 的步长内至少发生一次事件的概率是 $P(\\text{event in }\\Delta t) = 1 - \\exp(-\\lambda_{\\max}\\,\\Delta t)$。为将此每步概率限制在一个小容差 $\\varepsilon$ 内（以避免每步发生多个事件并保持准确性），\n$$\n1 - \\exp(-\\lambda_{\\max}\\,\\Delta t) \\le \\varepsilon \\quad \\Longleftrightarrow \\quad \\Delta t \\le \\frac{-\\ln(1-\\varepsilon)}{\\lambda_{\\max}}.\n$$\n\n结合这三个独立的要求，同步耦合时间步长 $\\Delta t$ 必须满足\n$$\n\\Delta t \\le \\min\\!\\left\\{ \\frac{1}{\\dfrac{|u_x|}{h} + \\dfrac{|u_y|}{h} + \\dfrac{4D}{h^2}},\\ \\frac{h}{v_{\\max}},\\ \\frac{-\\ln(1-\\varepsilon)}{\\lambda_{\\max}} \\right\\}.\n$$\n\n我们现在使用给定的参数计算每个界限。首先，我们将所有量表示为一致的单位。我们有\n$$\nD = 2 \\times 10^{-10}\\ \\mathrm{m^2\\,s^{-1}},\\quad u_x = 1 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}},\\quad u_y = 5 \\times 10^{-6}\\ \\mathrm{m\\,s^{-1}},\n$$\n$$\nh = 5 \\times 10^{-6}\\ \\mathrm{m},\\quad v_{\\max} = 15\\ \\mathrm{\\mu m\\,min^{-1}} = \\frac{15 \\times 10^{-6}}{60}\\ \\mathrm{m\\,s^{-1}} = 2.5 \\times 10^{-7}\\ \\mathrm{m\\,s^{-1}},\n$$\n$$\n\\lambda_{\\max} = 0.5\\ \\mathrm{s^{-1}},\\quad \\varepsilon = 0.05.\n$$\n\nPDE CFL 界限：\n$$\n\\frac{|u_x|}{h} = \\frac{1 \\times 10^{-5}}{5 \\times 10^{-6}} = 2\\ \\mathrm{s^{-1}},\\quad \\frac{|u_y|}{h} = \\frac{5 \\times 10^{-6}}{5 \\times 10^{-6}} = 1\\ \\mathrm{s^{-1}},\n$$\n$$\n\\frac{4D}{h^2} = \\frac{4 \\times 2 \\times 10^{-10}}{(5 \\times 10^{-6})^2} = \\frac{8 \\times 10^{-10}}{25 \\times 10^{-12}} = 32\\ \\mathrm{s^{-1}}.\n$$\n因此，\n$$\n\\Delta t_{\\mathrm{PDE}} \\le \\frac{1}{2 + 1 + 32} = \\frac{1}{35}\\ \\mathrm{s} \\approx 0.02857142857\\ \\mathrm{s}.\n$$\n\nABM 运动学界限：\n$$\n\\Delta t_{\\mathrm{move}} \\le \\frac{h}{v_{\\max}} = \\frac{5 \\times 10^{-6}}{2.5 \\times 10^{-7}} = 20\\ \\mathrm{s}.\n$$\n\nABM 泊松界限：\n$$\n\\Delta t_{\\mathrm{react}} \\le \\frac{-\\ln(1-\\varepsilon)}{\\lambda_{\\max}} = \\frac{-\\ln(1 - 0.05)}{0.5} = \\frac{-\\ln(0.95)}{0.5}.\n$$\n计算 $-\\ln(0.95)$：\n$$\n-\\ln(0.95) \\approx 0.05129329439,\n$$\n所以\n$$\n\\Delta t_{\\mathrm{react}} \\approx \\frac{0.05129329439}{0.5} \\approx 0.1025865888\\ \\mathrm{s}.\n$$\n\n取最小值，\n$$\n\\Delta t^{\\ast} = \\min\\!\\left\\{ \\frac{1}{35},\\ 20,\\ 0.1025865888 \\right\\}\\ \\mathrm{s} = \\frac{1}{35}\\ \\mathrm{s} \\approx 0.02857142857\\ \\mathrm{s}.\n$$\n\n四舍五入到四位有效数字并以秒为单位表示，最大允许同步时间步长是\n$$\n0.02857\\ \\mathrm{s}.\n$$", "answer": "$$\\boxed{0.02857}$$", "id": "3287966"}]}