{"hands_on_practices": [{"introduction": "理解辐射方向图的形状与其方向性之间的关系是天线设计的基石。这个练习将引导您为一个理想化的高斯波束，从第一性原理出发，推导其波束宽度与最大方向性之间的解析关系 [@problem_id:3344121]。接着，您将量化旁瓣这种非理想因素如何降低天线的性能，从而对天线设计中的效率与方向性权衡获得关键的洞察。", "problem": "考虑一个高方向性天线，其围绕波束轴线的辐射强度很窄，并且在单位球面的局部小角度图上可以很好地近似为一个可分离的二维高斯主瓣，旁瓣初始被忽略。设在切平面坐标 $(x,y)$（定义为沿穿过波束轴线的两个正交主割面的小角度偏移，并采用小角度近似使得 $d\\Omega \\approx dx\\,dy$）中的归一化功率方向图为\n$$\nF(x,y)=\\exp\\!\\Big(-\\frac{x^{2}}{\\sigma_{x}^{2}}-\\frac{y^{2}}{\\sigma_{y}^{2}}\\Big)，\n$$\n其中 $F(0,0)=1$，而 $\\sigma_{x}$ 和 $\\sigma_{y}$（单位为弧度）是沿两个主割面的 $1/\\exp(1)$ 角度尺度参数。假设波束足够窄，以至于小角度近似在整个主瓣支撑区内都成立。\n\n仅从总辐射功率为 $P_{\\mathrm{rad}}=\\displaystyle\\int_{4\\pi} U(\\theta,\\phi)\\,d\\Omega$、方向性系数为 $D(\\theta,\\phi)=4\\pi\\,U(\\theta,\\phi)/P_{\\mathrm{rad}}$ 以及沿一个割面的半功率波束宽度（HPBW）是功率降至其峰值一半的两点之间的全角宽度这些定义出发，完成以下任务：\n\n1) 推导沿 $x$ 和 $y$ 主割面的半功率波束宽度（表示为 $\\mathrm{HPBW}_{x}$ 和 $\\mathrm{HPBW}_{y}$）的闭式表达式，单位为弧度。\n\n2) 使用相同的定义，推导此高斯波束近似（忽略旁瓣时）的最大方向性系数 $D_{\\max}$，并用 $\\sigma_{x}$ 和 $\\sigma_{y}$ 表示。\n\n3) 现在假设，在实际情况中，该天线还具有旁瓣，这些旁瓣在相对于波束轴线峰值 $-S$ dB 的电平上是平坦的（功率恒定），并占据整个球面的一个比例 $\\alpha$（其中 $0 \\le \\alpha \\le 1$）。假设旁瓣区域与高斯积分中使用的主瓣区域不相交，且主瓣峰值保持不变。量化仅从高斯主瓣估算 $D_{\\max}$ 时，因忽略旁瓣而产生的相对高估误差。具体地，将相对误差定义为 $\\delta=(D_{\\mathrm{est}}-D_{\\mathrm{true}})/D_{\\mathrm{true}}$，其中 $D_{\\mathrm{est}}$ 是忽略旁瓣时获得的方向性系数，而 $D_{\\mathrm{true}}$ 是考虑了旁瓣的方向性系数。推导 $\\delta$ 的闭式表达式，用 $\\sigma_{x}$、$\\sigma_{y}$、$S$ 和 $\\alpha$ 表示。\n\n将 $\\mathrm{HPBW}_{x}$ 和 $\\mathrm{HPBW}_{y}$ 以弧度表示，并将方向性系数视为无量纲量。最终答案必须是按顺序包含 $\\mathrm{HPBW}_{x}$、$\\mathrm{HPBW}_{y}$、$D_{\\max}$（忽略旁瓣时）和 $\\delta$ 的行向量。", "solution": "这是一个多部分问题，要求从给定的功率方向图模型推导天线参数。我们将按顺序解决每个部分。\n\n**第1部分：半功率波束宽度（$\\mathrm{HPBW}_{x}$ 和 $\\mathrm{HPBW}_{y}$）的推导**\n\n归一化功率方向图由 $F(x,y)=\\exp(-x^{2}/\\sigma_{x}^{2}-y^{2}/\\sigma_{y}^{2})$ 给出。该方向图的最大值出现在波束轴线处，即 $(x,y)=(0,0)$，此时 $F(0,0)=1$。半功率波束宽度（$\\mathrm{HPBW}$）定义为功率降至其峰值一半的两点之间的全角宽度。\n\n为求得 $\\mathrm{HPBW}_{x}$，我们考虑沿 $x$ 轴的主割面，这对应于设置 $y=0$。沿此割面的功率方向图为 $F(x,0) = \\exp(-x^2/\\sigma_x^2)$。我们必须找到使 $F(x,0) = 1/2$ 的 $x$ 值。\n$$\n\\exp\\Big(-\\frac{x^2}{\\sigma_x^2}\\Big) = \\frac{1}{2}\n$$\n对两边取自然对数：\n$$\n-\\frac{x^2}{\\sigma_x^2} = \\ln\\Big(\\frac{1}{2}\\Big) = -\\ln(2)\n$$\n解出 $x^2$：\n$$\nx^2 = \\sigma_x^2 \\ln(2)\n$$\n这给出了 $x$ 的两个解：\n$$\nx = \\pm \\sigma_x \\sqrt{\\ln(2)}\n$$\n$\\mathrm{HPBW}_x$ 是全角宽度，即这两个值之间的差：\n$$\n\\mathrm{HPBW}_{x} = \\sigma_x \\sqrt{\\ln(2)} - (-\\sigma_x \\sqrt{\\ln(2)}) = 2\\sigma_x\\sqrt{\\ln(2)}\n$$\n根据对称性，$\\mathrm{HPBW}_{y}$ 的推导过程是相同的。我们设置 $x=0$ 以获得沿 $y$ 轴的方向图，$F(0,y) = \\exp(-y^2/\\sigma_y^2)$。将其设为 $1/2$ 并求解 $y$，得到 $y = \\pm \\sigma_y \\sqrt{\\ln(2)}$。因此，沿 $y$ 轴的半功率波束宽度为：\n$$\n\\mathrm{HPBW}_{y} = 2\\sigma_y\\sqrt{\\ln(2)}\n$$\n\n**第2部分：忽略旁瓣时的最大方向性系数（$D_{\\max}$）推导**\n\n方向性系数定义为 $D(\\theta,\\phi) = 4\\pi U(\\theta,\\phi)/P_{\\mathrm{rad}}$，其中 $U(\\theta,\\phi)$ 是辐射强度，$P_{\\mathrm{rad}}$ 是总辐射功率。最大方向性系数 $D_{\\max}$ 出现在辐射强度峰值 $U_{\\max}$ 处。\n$$\nD_{\\max} = \\frac{4\\pi U_{\\max}}{P_{\\mathrm{rad}}}\n$$\n在小角度近似下，辐射强度可以写为 $U(x,y) = U_{\\max} F(x,y)$。为求得 $P_{\\mathrm{rad}}$，我们将 $U(x,y)$ 在所有立体角上积分。在小角度近似 $d\\Omega \\approx dx\\,dy$ 且忽略旁瓣的情况下，由于高斯函数迅速衰减，积分遍及整个平面：\n$$\nP_{\\mathrm{rad}} = \\int_{4\\pi} U(\\theta,\\phi)\\,d\\Omega \\approx \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} U(x,y)\\,dx\\,dy\n$$\n代入 $U(x,y)$ 的表达式：\n$$\nP_{\\mathrm{rad}} = U_{\\max} \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\exp\\Big(-\\frac{x^2}{\\sigma_x^2}-\\frac{y^2}{\\sigma_y^2}\\Big)\\,dx\\,dy\n$$\n这个二重积分是可分离的：\n$$\nP_{\\mathrm{rad}} = U_{\\max} \\left( \\int_{-\\infty}^{\\infty} \\exp\\Big(-\\frac{x^2}{\\sigma_x^2}\\Big)\\,dx \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\Big(-\\frac{y^2}{\\sigma_y^2}\\Big)\\,dy \\right)\n$$\n我们使用标准高斯积分公式 $\\int_{-\\infty}^{\\infty} \\exp(-az^2)\\,dz = \\sqrt{\\pi/a}$。\n对于 $x$ 的积分，$a = 1/\\sigma_x^2$，因此积分结果为 $\\sqrt{\\pi/(1/\\sigma_x^2)} = \\sigma_x\\sqrt{\\pi}$。\n对于 $y$ 的积分，$a = 1/\\sigma_y^2$，因此积分结果为 $\\sqrt{\\pi/(1/\\sigma_y^2)} = \\sigma_y\\sqrt{\\pi}$。\n因此，总辐射功率为：\n$$\nP_{\\mathrm{rad}} = U_{\\max} (\\sigma_x\\sqrt{\\pi})(\\sigma_y\\sqrt{\\pi}) = U_{\\max} \\pi \\sigma_x \\sigma_y\n$$\n这是仅考虑主瓣时得到的估计功率 $P_{\\mathrm{est}}$。相应的估计最大方向性系数 $D_{\\mathrm{est}}$ 为：\n$$\nD_{\\max} = D_{\\mathrm{est}} = \\frac{4\\pi U_{\\max}}{P_{\\mathrm{est}}} = \\frac{4\\pi U_{\\max}}{U_{\\max} \\pi \\sigma_x \\sigma_y} = \\frac{4}{\\sigma_x \\sigma_y}\n$$\n\n**第3部分：由旁瓣引起的相对误差 $\\delta$ 的推导**\n\n现在我们考虑旁瓣。总辐射功率 $P_{\\mathrm{true}}$ 是主瓣功率 $P_{\\mathrm{ml}}$ 和旁瓣功率 $P_{\\mathrm{sl}}$ 的和。\n主瓣功率是在第2部分中计算的那个，即 $P_{\\mathrm{ml}} = U_{\\max} \\pi \\sigma_x \\sigma_y$。\n旁瓣被描述为具有相对于峰值 $U_{\\max}$ 为 $-S$ dB 的恒定功率强度电平。在线性尺度上，此强度为 $U_{\\mathrm{sl}} = U_{\\max} \\times 10^{-S/10}$。\n旁瓣占据整个球面（$4\\pi$ 球面度）的一部分比例 $\\alpha$，因此它们覆盖的立体角为 $\\Omega_{\\mathrm{sl}} = 4\\pi\\alpha$。\n旁瓣辐射的功率是其恒定强度乘以其立体角：\n$$\nP_{\\mathrm{sl}} = U_{\\mathrm{sl}} \\Omega_{\\mathrm{sl}} = (U_{\\max} 10^{-S/10})(4\\pi\\alpha) = 4\\pi\\alpha U_{\\max} 10^{-S/10}\n$$\n真实的总辐射功率为 $P_{\\mathrm{true}} = P_{\\mathrm{ml}} + P_{\\mathrm{sl}}$：\n$$\nP_{\\mathrm{true}} = U_{\\max} \\pi \\sigma_x \\sigma_y + 4\\pi\\alpha U_{\\max} 10^{-S/10} = \\pi U_{\\max}(\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10})\n$$\n峰值强度 $U_{\\max}$ 保持不变。真实的最大方向性系数 $D_{\\mathrm{true}}$ 为：\n$$\nD_{\\mathrm{true}} = \\frac{4\\pi U_{\\max}}{P_{\\mathrm{true}}} = \\frac{4\\pi U_{\\max}}{\\pi U_{\\max}(\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10})} = \\frac{4}{\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10}}\n$$\n相对高估误差 $\\delta$ 定义为 $\\delta = (D_{\\mathrm{est}}-D_{\\mathrm{true}})/D_{\\mathrm{true}}$。这可以改写为 $\\delta = D_{\\mathrm{est}}/D_{\\mathrm{true}} - 1$。\n$$\n\\frac{D_{\\mathrm{est}}}{D_{\\mathrm{true}}} = \\frac{4/(\\sigma_x \\sigma_y)}{4/(\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10})} = \\frac{\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y} = 1 + \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\n$$\n因此，相对误差为：\n$$\n\\delta = \\left(1 + \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\\right) - 1 = \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\n$$\n\n所需的四个量是 $\\mathrm{HPBW}_{x}$、$\\mathrm{HPBW}_{y}$、$D_{\\max}$（即 $D_{\\mathrm{est}}$）和 $\\delta$。\n$$\n\\mathrm{HPBW}_{x} = 2\\sigma_x\\sqrt{\\ln(2)} \\\\\n\\mathrm{HPBW}_{y} = 2\\sigma_y\\sqrt{\\ln(2)} \\\\\nD_{\\max} = \\frac{4}{\\sigma_x \\sigma_y} \\\\\n\\delta = \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\n$$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2\\sigma_{x}\\sqrt{\\ln(2)} & 2\\sigma_{y}\\sqrt{\\ln(2)} & \\frac{4}{\\sigma_{x}\\sigma_{y}} & \\frac{4\\alpha 10^{-S/10}}{\\sigma_{x}\\sigma_{y}}\n\\end{pmatrix}\n}\n$$", "id": "3344121"}, {"introduction": "从解析模型转向工程实践，天线性能通常是通过综合仿真或测量数据进行计算评估的。这项练习将指导您完成一个完整的工作流程，您将编写程序，根据给定的数值方向图、反射系数和效率估算，计算天线在某个频带内的最大已实现增益 [@problem_id:3344172]。通过这项实践，您将巩固对各种因素如何共同决定天线在整个频带内的有效性能的理解。", "problem": "您的任务是构建一个完整的、可运行的程序，用于计算单端口天线在所有方向和频率上的已实现最大增益，然后量化频率相关的辐射效率如何影响所实现的增益带宽。您的推导和算法必须从电磁学的核心定义开始：辐射强度、总辐射功率、方向性、辐射效率和失配效率。除了这些定义之外，您不得假设任何专门的天线公式。所有角度必须以弧度为单位。所有增益值必须以相对于全向辐射体的分贝数（dBi）报告。带宽度量必须是以小数表示的无量纲分数。\n\n给定一组离散频率、测量的反射系数幅度、从导体（欧姆）损耗导出的辐射效率估计值，以及一个随频率变化的数值指定的辐射强度方向图。基于这些数据，您必须计算每个频率在所有方向上的最大已实现增益，然后根据 $3$ dB下降标准计算两个离散的增益带宽估计值：一个使用给定的频率相关辐射效率，另一个使用一个扁平化的、频率无关的辐射效率，其值等于中心频率处的值。然后，您必须将所有结果汇总到指定列表格式的单行中输出。\n\n使用以下定义和要求来设计您的算法并实现您的程序。\n\n- 使用基本定义。辐射强度 $U(\\theta,\\phi;f)$ 是在频率 $f$ 时，$(\\theta,\\phi)$ 方向上单位立体角的时均功率。总辐射功率 $P_{\\text{rad}}(f)$ 是 $U$ 在整个立体角上的积分。方向性 $D(\\theta,\\phi;f)$ 是辐射强度与全方向平均辐射强度的比值。辐射效率 $\\eta_r(f)$ 汇总了天线内部的耗散损失。失配效率 $\\eta_m(f)$ 解释了由于输入失配而未被接收的功率，并且仅取决于测量的反射系数 $S_{11}(f)$ 的幅度。使用这些定义来构建已实现增益 $G_{\\text{real}}(\\theta,\\phi;f)$ 并确定全方向上的 $G_{\\text{real,max}}(f)$。\n\n- 角度网格和积分。使用张量积网格对单位球面上的所需角积分进行数值近似：\n  - 设 $\\theta \\in [0,\\pi]$，使用 $N_\\theta = 721$ 个等间距点进行采样。\n  - 设 $\\phi \\in [0,2\\pi]$，使用 $N_\\phi = 361$ 个等间距点进行采样。\n  - 使用带有 $\\sin\\theta$ 雅可比因子的标准球面积分，从网格样本 $U(\\theta_i,\\phi_j;f)$ 计算 $P_{\\text{rad}}(f)$。\n  - 角度单位是弧度。\n\n- 测试套件的辐射强度规范。对于每个频率 $f$，使用以下数值指定的辐射强度模型，该模型与 $\\phi$ 无关且仅限于前半球：\n  - $U(\\theta,\\phi;f) = \\max(\\cos\\theta,0)^{n(f)}$ 适用于所有 $(\\theta,\\phi)$，其中指数 $n(f)$ 按下文各频率指定。这是一个可进行数值评估的函数，代表一个预先计算的数值方向图。\n  - 此方向图未经归一化；必须对其进行数值积分，以形成计算方向性所需的总辐射功率。\n\n- 测试套件参数值。请严格使用以下列表作为测试套件：\n  - 频率（单位：赫兹）：$[1.80\\times 10^{9},\\, 2.10\\times 10^{9},\\, 2.40\\times 10^{9},\\, 2.70\\times 10^{9},\\, 3.00\\times 10^{9}]$。\n  - 测量的反射系数幅度 $|S_{11}(f)|$：$[0.70,\\, 0.40,\\, 0.10,\\, 0.35,\\, 0.65]$。\n  - 辐射效率 $\\eta_r(f)$（无单位）：$[0.78,\\, 0.83,\\, 0.88,\\, 0.82,\\, 0.75]$。\n  - 方向图指数 $n(f)$：$[2.0,\\, 2.5,\\, 3.0,\\, 3.5,\\, 4.0]$。\n  - 失配效率必须计算为 $\\eta_m(f) = 1 - |S_{11}(f)|^2$。\n\n- 计算目标。\n  - 对于每个频率 $f$，通过搜索所有采样的 $(\\theta,\\phi)$ 方向来计算线性单位的 $G_{\\text{real,max}}(f)$，然后通过 $10\\log_{10}(\\cdot)$ 转换为 dBi。\n  - 按如下方式计算频率相关辐射效率情况下的 $3$ dB下降增益带宽分数。设 $G_{\\text{max,pk}}^{\\text{dBi}}$ 是所有测试频率中，各频率 $G_{\\text{real,max}}^{\\text{dBi}}(f)$ 的最大值。计算满足 $G_{\\text{real,max}}^{\\text{dBi}}(f) \\geq G_{\\text{max,pk}}^{\\text{dBi}} - 3$ 的频率数量。该分数为这个数量除以总测试频率数，以小数表示（无单位）。\n  - 对于假设的扁平化效率 $\\eta_r^{\\text{flat}}$ 重复带宽计算，该效率等于中心频率（即列表中的第三个条目，对应于 $2.40\\times 10^{9}$ Hz）的辐射效率，并统一应用于所有频率。在第二种情况下，用 $\\eta_r^{\\text{flat}}$ 替换 $\\eta_r(f)$ 重新计算所有 $G_{\\text{real,max}}^{\\text{dBi}}(f)$，然后使用新的跨频率峰值重新计算 $3$ dB下降分数。\n\n- 所需单位和角度单位。所有 $G_{\\text{real,max}}$ 值均以 dBi 报告。带宽分数以无单位的小数报告。所有角度均以弧度为单位。\n\n- 最终输出格式。您的程序必须生成单行输出，其中包含一个恰好由三项组成的列表：\n  - 第一项是一个长度为 $5$ 的列表，包含五个测试频率的 $G_{\\text{real,max}}^{\\text{dBi}}(f)$，顺序与提供的一致。\n  - 第二项是频率相关 $\\eta_r(f)$ 情况下的 $3$ dB下降分数带宽（一个浮点数）。\n  - 第三项是扁平化 $\\eta_r^{\\text{flat}}$ 情况下的 $3$ dB下降分数带宽（一个浮点数）。\n  例如，打印的结构必须类似于 $[[g_1, g_2, g_3, g_4, g_5], b_1, b_2]$，不带任何额外文本，其中每个 $g_k$ 以 dBi 为单位，每个 $b_k$ 是一个小数。\n\n您的程序必须是完全自包含的，不得读取任何输入，也不得访问网络或文件系统。它必须仅计算并打印给定测试套件的指定单行结果。", "solution": "目标是计算天线在多个频率下的最大已实现增益，并分析辐射效率对增益带宽的影响。该解决方案按要求从第一性原理推导得出。\n\n设 $f$ 为频率。主要量为：\n- 频率：$f \\in \\{1.80\\times 10^{9}, 2.10\\times 10^{9}, 2.40\\times 10^{9}, 2.70\\times 10^{9}, 3.00\\times 10^{9}\\}$ Hz。\n- 方向图指数：$n(f) \\in \\{2.0, 2.5, 3.0, 3.5, 4.0\\}$。\n- 反射系数幅度：$|S_{11}(f)| \\in \\{0.70, 0.40, 0.10, 0.35, 0.65\\}$。\n- 辐射效率：$\\eta_r(f) \\in \\{0.78, 0.83, 0.88, 0.82, 0.75\\}$。\n\n**1. 辐射强度和总辐射功率**\n\n辐射强度 $U(\\theta, \\phi; f)$ 由模型 $U(\\theta, \\phi; f) = \\max(\\cos\\theta, 0)^{n(f)}$ 给出。该函数描述了作为方向函数（由球坐标 $\\theta$（极角）和 $\\phi$（方位角）指定）的功率密度。指数 $n(f)$ 控制方向图的方向性，并随频率变化。请注意，该方向图与 $\\phi$ 无关。\n\n总辐射功率 $P_{\\text{rad}}(f)$ 是辐射强度在所有立体角上的积分：\n$$ P_{\\text{rad}}(f) = \\int_{\\Omega} U(\\theta, \\phi; f) \\, d\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} U(\\theta, \\phi; f) \\sin\\theta \\, d\\theta \\, d\\phi $$\n由于 $U$ 的方位对称性，且仅在前半球非零，对 $\\phi$ 的积分产生一个 $2\\pi$ 的因子，对 $\\theta$ 的积分有效范围是 $0$ 到 $\\pi/2$：\n$$ P_{\\text{rad}}(f) = 2\\pi \\int_{0}^{\\pi/2} (\\cos\\theta)^{n(f)} \\sin\\theta \\, d\\theta $$\n该积分使用梯形法则在离散的 $\\theta$ 值网格上进行数值计算。$\\theta$ 的网格定义为从 $0$ 到 $\\pi$，有 $N_\\theta = 721$ 个点。设离散角度为 $\\theta_i$，其中 $i=0, \\dots, N_\\theta-1$。积分近似为：\n$$ P_{\\text{rad}}(f) \\approx 2\\pi \\sum_{i=0}^{N_\\theta-2} \\frac{1}{2} (y_i + y_{i+1}) (\\theta_{i+1} - \\theta_i) $$\n其中 $y_i = \\max(\\cos\\theta_i, 0)^{n(f)} \\sin\\theta_i$。这是使用 `numpy.trapz` 实现的。\n\n**2. 方向性、效率和已实现增益**\n\n方向性 $D(\\theta, \\phi; f)$ 是给定方向上的辐射强度与平均辐射强度 $U_{\\text{avg}}(f) = P_{\\text{rad}}(f) / (4\\pi)$ 的比值：\n$$ D(\\theta, \\phi; f) = \\frac{U(\\theta, \\phi; f)}{U_{\\text{avg}}(f)} = \\frac{4\\pi U(\\theta, \\phi; f)}{P_{\\text{rad}}(f)} $$\n最大方向性 $D_{\\text{max}}(f)$ 出现在最大辐射强度方向上，即 $(\\theta=0, \\phi=0)$。在此方向上，$U_{\\text{max}}(f) = \\max(\\cos 0, 0)^{n(f)} = 1^{n(f)} = 1$。因此：\n$$ D_{\\text{max}}(f) = \\frac{4\\pi U_{\\text{max}}(f)}{P_{\\text{rad}}(f)} = \\frac{4\\pi}{P_{\\text{rad}}(f)} $$\n已实现增益 $G_{\\text{real}}(\\theta, \\phi; f)$ 包含了内部损耗（辐射效率，$\\eta_r(f)$）和输入端口的失配损耗（失配效率，$\\eta_m(f)$）：\n$$ G_{\\text{real}}(\\theta, \\phi; f) = \\eta_m(f) \\eta_r(f) D(\\theta, \\phi; f) $$\n失配效率由反射系数计算得出：\n$$ \\eta_m(f) = 1 - |S_{11}(f)|^2 $$\n最大已实现增益 $G_{\\text{real,max}}(f)$ 对应于最大方向性的方向：\n$$ G_{\\text{real,max}}(f) = \\eta_m(f) \\eta_r(f) D_{\\text{max}}(f) = \\left(1 - |S_{11}(f)|^2\\right) \\eta_r(f) \\frac{4\\pi}{P_{\\text{rad}}(f)} $$\n该值以线性单位计算，然后转换为相对于全向辐射体的分贝数（dBi）：\n$$ G_{\\text{real,max}}^{\\text{dBi}}(f) = 10 \\log_{10} \\left( G_{\\text{real,max}}(f) \\right) $$\n\n**3. 增益带宽计算**\n\n$3$ dB下降增益带宽量化了增益保持在其峰值附近的频率范围。它以分数带宽的形式计算。\n首先，我们找到所有测试频率中的峰值增益：$G_{\\text{max,pk}}^{\\text{dBi}} = \\max_{f} \\{G_{\\text{real,max}}^{\\text{dBi}}(f)\\}$。\n增益阈值为 $G_{\\text{thresh}}^{\\text{dBi}} = G_{\\text{max,pk}}^{\\text{dBi}} - 3$ dB。\n计算增益满足或超过此阈值（$G_{\\text{real,max}}^{\\text{dBi}}(f) \\geq G_{\\text{thresh}}^{\\text{dBi}}$）的频率数量 $N_{\\text{pass}}$。\n分数带宽是比率 $B = N_{\\text{pass}} / N_{\\text{total}}$，其中 $N_{\\text{total}}$ 是总频率点数（本例中为 $5$）。\n\n此计算在两种情况下进行：\n1.  **频率相关效率**：直接使用提供的 $\\eta_r(f)$ 值。\n2.  **扁平化效率**：将所有频率的 $\\eta_r(f)$ 替换为一个常数值 $\\eta_r^{\\text{flat}}$，该值是中心频率（$2.40 \\times 10^9$ Hz）的效率，即 $\\eta_r^{\\text{flat}} = 0.88$。计算一组新的已实现增益，找到一个新的峰值增益，并基于这组新值确定分数带宽。\n\n该算法遍历每个频率，计算两种效率情况下的 $P_{\\text{rad}}(f)$、$D_{\\text{max}}(f)$，最后计算 $G_{\\text{real,max}}^{\\text{dBi}}(f)$。随后，计算两个分数带宽。最终结果被组装成指定的列表格式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes realized maximum gain and gain-bandwidth for a single-port antenna\n    based on fundamental electromagnetic definitions.\n    \"\"\"\n    # Test suite parameter values\n    # Frequencies are not used in calculations but define the correspondence\n    # of other parameters.\n    # frequencies_hz = np.array([1.80e9, 2.10e9, 2.40e9, 2.70e9, 3.00e9]) # Not directly used\n    s11_mags = np.array([0.70, 0.40, 0.10, 0.35, 0.65])\n    eta_r_vals = np.array([0.78, 0.83, 0.88, 0.82, 0.75])\n    n_vals = np.array([2.0, 2.5, 3.0, 3.5, 4.0])\n    num_freqs = len(n_vals)\n\n    # Numerical integration parameters\n    N_theta = 721\n    theta_grid = np.linspace(0, np.pi, N_theta)\n\n    # Mismatch efficiencies\n    eta_m_vals = 1 - s11_mags**2\n\n    # Case 1: Frequency-dependent radiation efficiency\n    g_real_max_dbi_case1 = []\n    \n    # Store D_max to reuse in case 2\n    d_max_vals_linear = []\n\n    for i in range(num_freqs):\n        n = n_vals[i]\n        \n        # Radiation intensity U(theta) for the given n(f)\n        # U is normalized such that its maximum value is 1.\n        # U is independent of phi.\n        u_theta = np.maximum(np.cos(theta_grid), 0)**n\n        \n        # Integrand for total radiated power calculation\n        integrand = u_theta * np.sin(theta_grid)\n        \n        # Numerically integrate over theta using the trapezoidal rule\n        integral_theta = np.trapz(integrand, theta_grid)\n        \n        # Total radiated power P_rad. The integral over phi gives 2*pi.\n        p_rad = 2 * np.pi * integral_theta\n        \n        # Maximum directivity D_max\n        # U_max is 1, as max(cos(theta)) is 1 at theta=0.\n        u_max = 1.0\n        d_max_linear = 4 * np.pi * u_max / p_rad\n        d_max_vals_linear.append(d_max_linear)\n        \n        # Maximum realized gain in linear scale\n        g_real_max_linear = eta_m_vals[i] * eta_r_vals[i] * d_max_linear\n        \n        # Convert to dBi\n        g_real_max_dbi = 10 * np.log10(g_real_max_linear)\n        g_real_max_dbi_case1.append(g_real_max_dbi)\n\n    # Calculate 3 dB-down fractional bandwidth for Case 1\n    g_max_pk_case1 = np.max(g_real_max_dbi_case1)\n    threshold_case1 = g_max_pk_case1 - 3.0\n    count_case1 = np.sum(np.array(g_real_max_dbi_case1) >= threshold_case1)\n    bw_frac_case1 = count_case1 / num_freqs\n\n    # Case 2: Flattened, frequency-independent radiation efficiency\n    # The value is from the center frequency (index 2)\n    eta_r_flat = eta_r_vals[2]\n    g_real_max_dbi_case2 = []\n\n    for i in range(num_freqs):\n        # D_max is the same as in case 1\n        d_max_linear = d_max_vals_linear[i]\n        \n        # Maximum realized gain with flattened efficiency\n        g_real_max_linear = eta_m_vals[i] * eta_r_flat * d_max_linear\n        \n        # Convert to dBi\n        g_real_max_dbi = 10 * np.log10(g_real_max_linear)\n        g_real_max_dbi_case2.append(g_real_max_dbi)\n\n    # Calculate 3 dB-down fractional bandwidth for Case 2\n    g_max_pk_case2 = np.max(g_real_max_dbi_case2)\n    threshold_case2 = g_max_pk_case2 - 3.0\n    count_case2 = np.sum(np.array(g_real_max_dbi_case2) >= threshold_case2)\n    bw_frac_case2 = count_case2 / num_freqs\n    \n    # Assemble the final result list\n    final_result = [g_real_max_dbi_case1, bw_frac_case1, bw_frac_case2]\n\n    # Final print statement in the exact required format.\n    print(final_result)\n\nsolve()\n```", "id": "3344172"}, {"introduction": "数值计算功能强大，但其本质是近似，并存在固有误差。这最后一个练习将深入探讨数值分析中的一个关键问题：在估计方向图峰值时，离散采样所引入的系统偏差 [@problem_id:3344125]。您将首先从解析上证明为什么直接取网格上的最大值会导致对真实峰值强度的低估，然后推导一种二次插值方法来修正这个偏差，从而对数值仿真的精度细节产生更深刻的认识。", "problem": "考虑计算电磁学中辐射方向图量的数值估计。辐射强度是单位球面上的一个光滑函数 $U(\\theta,\\phi)$，总辐射功率为 $P_{\\text{rad}} = \\int_{0}^{2\\pi}\\int_{0}^{\\pi} U(\\theta,\\phi)\\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$。方向性定义为 $D(\\theta,\\phi) = \\frac{4\\pi U(\\theta,\\phi)}{P_{\\text{rad}}}$，最大方向性为 $D_{\\max} = \\max_{\\theta,\\phi} D(\\theta,\\phi)$。\n\n假设辐射强度在一个均匀球面网格上进行采样，角间距为 $\\Delta$（以弧度为单位），且该间距足够小，以至于在真实最大值方向 $(\\theta^{\\star},\\phi^{\\star})$ 附近局部地，函数 $U$ 沿着最大曲率方向的测地线坐标 $s$ 的限制，可以由一个二阶可微的泰勒展开来近似。在 $(\\theta^{\\star},\\phi^{\\star})$ 处定义 $s=0$，并令 $U(s)$ 表示沿着该测地线的 $U(\\theta(s),\\phi(s))$。最大强度的朴素离散网格估计量为 $\\widehat{U}_{\\max,\\text{grid}} = \\max_{k\\in\\mathbb{Z}} U(k\\Delta)$，由此得到朴素的最大方向性估计值 $\\widehat{D}_{\\max,\\text{grid}} = \\frac{4\\pi\\widehat{U}_{\\max,\\text{grid}}}{P_{\\text{rad}}}$。\n\n从定义和泰勒展开出发，完成以下任务：\n\n1. 基于第一性原理，论证为何相对于真实最大值 $U(0)$，$\\widehat{U}_{\\max,\\text{grid}}$ 是偏低的。这里假设由于 $(\\theta^{\\star},\\phi^{\\star})$ 与采样网格的任意对齐， $s=0$ 与其最近网格点之间的偏移量在 $[0,\\Delta/2]$ 上均匀分布。用 $U$ 在 $s=0$ 处的局部二阶导数和 $\\Delta$ 来量化 $\\widehat{U}_{\\max,\\text{grid}}$ 的主阶偏差。\n\n2. 为了减小最大方向性估计中的这种偏差，推导一种子网格插值方法。该方法基于将二次模型 $f(s) = a s^{2} + b s + c$ 拟合到在离散最大值点周围确定的最大曲率测地线方向上采集的三个连续样本 $U_{-1} = U(-\\Delta)$、$U_{0} = U(0)$ 和 $U_{+1} = U(+\\Delta)$。使用拟合的二次函数，为其顶点处的插值峰值强度 $U^{\\star}_{\\text{quad}}$ 导出一个闭式表达式，然后用 $U_{-1}$、$U_{0}$、$U_{+1}$ 和 $P_{\\text{rad}}$ 来表示校正后的最大方向性估计值 $\\widehat{D}_{\\max,\\text{quad}}$。\n\n请为 $\\widehat{D}_{\\max,\\text{quad}}$ 提供一个单一的闭式解析表达式作为最终答案。不需要进行数值计算，也无需四舍五入。由于方向性是无量纲的，因此不需要包含任何单位。角度以弧度为单位。", "solution": "**第一部分：离散网格最大值估计量的偏差**\n\n辐射强度 $U(\\theta, \\phi)$ 的真实最大值出现在某个方向 $(\\theta^{\\star}, \\phi^{\\star})$。我们沿着与最大曲率方向对齐的测地线坐标 $s$ 分析 $U$ 的行为，其中 $s=0$ 对应于真实最大值的位置。沿着这条测地线的函数记为 $U(s)$。\n\n根据最大值的定义，$U(s)$ 在 $s=0$ 处的一阶导数必须为零，即 $U'(0)=0$。此外，为了使最大值稳定，二阶导数必须为负，即 $U''(0) < 0$。$U(s)$ 在 $s=0$ 附近的二阶泰勒级数展开为：\n$$\nU(s) \\approx U(0) + U'(0)s + \\frac{1}{2}U''(0)s^2 = U(0) + \\frac{1}{2}U''(0)s^2\n$$\n对于足够小的 $s$，这个二次近似是有效的，这一假设由问题陈述中角网格间距 $\\Delta$ 很小这一条件来保证。\n\n离散网格估计量 $\\widehat{U}_{\\max,\\text{grid}}$ 是在采样网格上找到的 $U$ 的最大值，即 $\\widehat{U}_{\\max,\\text{grid}} = \\max_{k\\in\\mathbb{Z}} U(k\\Delta)$。对于较小的 $\\Delta$，产生此最大值的网格点将是包围真实最大值 $s=0$ 的两个网格点之一。设真实最大值与其最近网格点之间的偏移量为 $\\delta s$。由于真实最大值的位置 $(\\theta^{\\star},\\phi^{\\star})$ 相对于网格是任意的，问题将此偏移量 $\\delta s$ 建模为一个在区间 $[0, \\frac{\\Delta}{2}]$ 上均匀分布的随机变量。在此最近网格点处的辐射强度值近似为：\n$$\nU(\\delta s) \\approx U(0) + \\frac{1}{2}U''(0)(\\delta s)^2\n$$\n由于 $U''(0) < 0$ 且 $(\\delta s)^2 \\ge 0$，第二项是非正的。因此，$U(\\delta s) \\le U(0)$。由于离散网格最大值 $\\widehat{U}_{\\max,\\text{grid}}$ 近似等于 $U(\\delta s)$，我们可以看到 $\\widehat{U}_{\\max,\\text{grid}}$ 是一个系统性地低于或等于真实最大值 $U(0)$ 的估计量。这证明了为什么该估计量是偏低的。\n\n为了量化这个偏差，我们计算其期望值。估计量 $\\widehat{U}_{\\max,\\text{grid}}$ 对真实值 $U(0)$ 的偏差 $B$ 定义为 $B(\\widehat{U}_{\\max,\\text{grid}}) = E[\\widehat{U}_{\\max,\\text{grid}}] - U(0)$。使用我们的近似：\n$$\nB(\\widehat{U}_{\\max,\\text{grid}}) \\approx E\\left[U(0) + \\frac{1}{2}U''(0)(\\delta s)^2\\right] - U(0) = \\frac{1}{2}U''(0)E[(\\delta s)^2]\n$$\n偏移量 $\\delta s$ 是一个随机变量 $X$，其均匀概率密度函数为 $p(x) = \\frac{1}{\\Delta/2} = \\frac{2}{\\Delta}$，其中 $x \\in [0, \\frac{\\Delta}{2}]$。$X^2$ 的期望值为：\n$$\nE[X^2] = \\int_{0}^{\\frac{\\Delta}{2}} x^2 p(x) \\, \\mathrm{d}x = \\int_{0}^{\\frac{\\Delta}{2}} x^2 \\left(\\frac{2}{\\Delta}\\right) \\, \\mathrm{d}x = \\frac{2}{\\Delta} \\left[ \\frac{x^3}{3} \\right]_{0}^{\\frac{\\Delta}{2}} = \\frac{2}{\\Delta} \\frac{(\\Delta/2)^3}{3} = \\frac{2}{\\Delta} \\frac{\\Delta^3}{24} = \\frac{\\Delta^2}{12}\n$$\n将此结果代入偏差的表达式中，我们发现主阶偏差为：\n$$\nB(\\widehat{U}_{\\max,\\text{grid}}) \\approx \\frac{1}{2}U''(0) \\left(\\frac{\\Delta^2}{12}\\right) = \\frac{U''(0)\\Delta^2}{24}\n$$\n由于 $U''(0) < 0$，偏差为负，这证实了离散网格估计量平均而言是偏低的。\n\n**第二部分：通过二次插值校正最大方向性**\n\n为了校正这种偏差，我们采用一种子网格插值技术。我们首先确定具有最大采样强度的网格点 $\\widehat{U}_{\\max,\\text{grid}}$。然后，我们考虑该点及其沿最大曲率测地线的两个直接相邻点。为了记法方便，我们定义一个以离散最大值点为中心的局部坐标系。设三个采样点为 $(-\\Delta, U_{-1})$、$(0, U_0)$ 和 $(\\Delta, U_{+1})$，其中 $U_0 = \\widehat{U}_{\\max,\\text{grid}}$ 是中心且最大的采样值。\n\n我们将二次模型 $f(s) = as^2 + bs + c$ 拟合到这三个点。这为系数 $a$、$b$ 和 $c$ 产生了一个三元一次方程组：\n\\begin{align*}\nf(-\\Delta) = a\\Delta^2 - b\\Delta + c = U_{-1} \\\\\nf(0) = c = U_0 \\\\\nf(\\Delta) = a\\Delta^2 + b\\Delta + c = U_{+1}\n\\end{align*}\n从第二个方程，我们立即得到 $c = U_0$。将 $c$ 代入其他两个方程，得到：\n\\begin{align*}\na\\Delta^2 - b\\Delta = U_{-1} - U_0 \\\\\na\\Delta^2 + b\\Delta = U_{+1} - U_0\n\\end{align*}\n将这两个方程相加得到 $2a\\Delta^2 = U_{-1} + U_{+1} - 2U_0$，由此解出 $a$：\n$$\na = \\frac{U_{-1} + U_{+1} - 2U_0}{2\\Delta^2}\n$$\n用第二个方程减去第一个方程得到 $2b\\Delta = U_{+1} - U_{-1}$，由此解出 $b$：\n$$\nb = \\frac{U_{+1} - U_{-1}}{2\\Delta}\n$$\n插值的最大强度 $U^{\\star}_{\\text{quad}}$ 是二次函数在其顶点处的值。顶点出现在导数 $f'(s) = 2as + b$ 为零的位置 $s^{\\star}$，因此 $s^{\\star} = -\\frac{b}{2a}$。顶点处的值为：\n$$\nU^{\\star}_{\\text{quad}} = f(s^{\\star}) = a\\left(-\\frac{b}{2a}\\right)^2 + b\\left(-\\frac{b}{2a}\\right) + c = \\frac{b^2}{4a} - \\frac{b^2}{2a} + c = c - \\frac{b^2}{4a}\n$$\n代入 $a$、$b$ 和 $c$ 的表达式：\n$$\nU^{\\star}_{\\text{quad}} = U_0 - \\frac{\\left(\\frac{U_{+1} - U_{-1}}{2\\Delta}\\right)^2}{4\\left(\\frac{U_{-1} + U_{+1} - 2U_0}{2\\Delta^2}\\right)} = U_0 - \\frac{\\frac{(U_{+1} - U_{-1})^2}{4\\Delta^2}}{\\frac{2(U_{-1} + U_{+1} - 2U_0)}{\\Delta^2}}\n$$\n通过消去项来简化表达式：\n$$\nU^{\\star}_{\\text{quad}} = U_0 - \\frac{(U_{+1} - U_{-1})^2}{8(U_{-1} + U_{+1} - 2U_0)}\n$$\n为了使校正项为正，我们可以从分母中提出因子 $-1$：\n$$\nU^{\\star}_{\\text{quad}} = U_0 + \\frac{(U_{+1} - U_{-1})^2}{8(2U_0 - U_{-1} - U_{+1})}\n$$\n校正后的最大方向性 $\\widehat{D}_{\\max,\\text{quad}}$ 定义为 $\\frac{4\\pi U^{\\star}_{\\text{quad}}}{P_{\\text{rad}}}$。代入我们得到的 $U^{\\star}_{\\text{quad}}$ 表达式：\n$$\n\\widehat{D}_{\\max,\\text{quad}} = \\frac{4\\pi}{P_{\\text{rad}}} \\left( U_0 + \\frac{(U_{+1} - U_{-1})^2}{8(2U_0 - U_{-1} - U_{+1})} \\right)\n$$\n该表达式提供了二次校正后最大方向性的最终闭式结果，用三个相关的强度采样值和总辐射功率表示。", "answer": "$$\n\\boxed{\\frac{4\\pi}{P_{\\text{rad}}} \\left( U_0 + \\frac{(U_{+1} - U_{-1})^2}{8(2U_0 - U_{-1} - U_{+1})} \\right)}\n$$", "id": "3344125"}]}