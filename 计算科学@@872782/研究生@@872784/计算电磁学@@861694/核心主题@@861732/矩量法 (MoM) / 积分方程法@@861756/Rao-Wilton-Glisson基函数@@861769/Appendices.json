{"hands_on_practices": [{"introduction": "理解基函数之间如何相互作用是矩量法的基础。本练习将探索两个Rao-Wilton-Glisson (RWG)基函数的内积，即格兰姆（Gram）矩阵的构成。通过推导矩阵元素的闭式表达式，您将深入了解矩量法矩阵的内蕴稀疏性，这是实现大规模计算的关键特性。[@problem_id:3344550]", "problem": "设 $S$ 是 $\\mathbb{R}^3$中的一个分片平面、可定向曲面，通过一个保形三角剖分 $\\{T_p\\}_{p=1}^{N_T}$ 进行离散化，其中每个三角形 $T$ 的顶点为 $\\{\\mathbf{r}_{T,1}, \\mathbf{r}_{T,2}, \\mathbf{r}_{T,3}\\}$，面积为 $A_T$。考虑与内部网格边相关的 Rao–Wilton–Glisson (RWG) 基函数 $\\{\\mathbf{f}_m\\}_{m=1}^{N_b}$。每条长度为 $\\ell_m$ 的内部边 $e_m$ 由恰好两个三角形共享，记为 $T_m^{+}$ 和 $T_m^{-}$，其对应的自由（也称对）顶点分别为 $\\mathbf{r}_m^{+}$ 和 $\\mathbf{r}_m^{-}$。RWG 基函数 $\\mathbf{f}_m(\\mathbf{r})$ 的分片定义如下\n$$\n\\mathbf{f}_m(\\mathbf{r})=\\begin{cases}\n\\dfrac{\\ell_m}{2 A_m^{+}}\\left(\\mathbf{r}-\\mathbf{r}_m^{+}\\right), & \\mathbf{r}\\in T_m^{+} \\\\[1.0ex]\n\\dfrac{\\ell_m}{2 A_m^{-}}\\left(\\mathbf{r}_m^{-}-\\mathbf{r}\\right), & \\mathbf{r}\\in T_m^{-} \\\\[1.0ex]\n\\mathbf{0}, & \\text{otherwise}\n\\end{cases}\n$$\n其中 $A_m^{\\pm}$ 是 $T_m^{\\pm}$ 的面积。RWG Gram 矩阵定义为\n$$\nM_{mn}=\\int_{S}\\mathbf{f}_m(\\mathbf{r})\\cdot \\mathbf{f}_n(\\mathbf{r})\\,\\mathrm{d}S.\n$$\n从上述 RWG 定义和线性函数在三角形上积分的基本性质出发，推导 $M_{mn}$ 的一个闭式解析表达式，该表达式应使用三角形面积 $A_T$、边长 $\\ell_m$ 和 $\\ell_n$、三角形顶点坐标 $\\{\\mathbf{r}_{T,k}\\}_{k=1}^3$ 以及 $\\mathbf{f}_m$ 和 $\\mathbf{f}_n$ 在限制于三角形 $T$ 时的自由顶点 $\\mathbf{r}_{m,T}^{\\mathrm{free}}$ 和 $\\mathbf{r}_{n,T}^{\\mathrm{free}}$ 来表示。您的推导不能留下任何未计算的曲面积分。您可以使用重心坐标来对三角形上的多项式进行积分，并利用质心为 $\\mathbf{r}_{T,c}=\\left(\\mathbf{r}_{T,1}+\\mathbf{r}_{T,2}+\\mathbf{r}_{T,3}\\right)/3$ 以及重心坐标乘积在 $T$ 上的积分与 $A_T$ 成正比的事实。\n\n然后，利用您推导出的表达式，从第一性原理出发解释哪些对 $(m,n)$ 会产生非零的 $M_{mn}$，并论证这如何导致一个由 RWG 支集共享三角形重叠所决定的稀疏模式。\n\n以 $M_{mn}$ 的单一闭式解析表达式形式给出您的最终答案，该表达式只应包含对三角形的求和、顶点和自由顶点坐标的点积、三角形面积以及边长。不需要进行数值计算，最终表达式中也不应包含单位。最终答案必须是单一的解析表达式；不要提供不等式或定义集合的方程。", "solution": "该问题要求推导 Rao-Wilton-Glisson (RWG) 基函数的 Gram 矩阵元素 $M_{mn}$ 的闭式解析表达式，并解释该矩阵的稀疏性。\n\n首先，我们对问题陈述进行验证。\n给定条件如下：\n1.  一个通过保形三角剖分 $\\{T_p\\}_{p=1}^{N_T}$ 离散化的分片平面、可定向曲面 $S$。\n2.  每个三角形 $T$ 的顶点为 $\\{\\mathbf{r}_{T,1}, \\mathbf{r}_{T,2}, \\mathbf{r}_{T,3}\\}$，面积为 $A_T$。\n3.  RWG 基函数 $\\{\\mathbf{f}_m\\}_{m=1}^{N_b}$ 与长度为 $\\ell_m$ 的内部网格边 $e_m$ 相关联。\n4.  每条边 $e_m$ 由两个三角形 $T_m^{+}$ 和 $T_m^{-}$ 共享，对应的自由顶点为 $\\mathbf{r}_m^{+}$ 和 $\\mathbf{r}_m^{-}$。\n5.  RWG 基函数 $\\mathbf{f}_m(\\mathbf{r})$ 的定义为：\n    $$\n    \\mathbf{f}_m(\\mathbf{r})=\\begin{cases}\n    \\dfrac{\\ell_m}{2 A_m^{+}}\\left(\\mathbf{r}-\\mathbf{r}_m^{+}\\right), & \\mathbf{r}\\in T_m^{+} \\\\[1.0ex]\n    \\dfrac{\\ell_m}{2 A_m^{-}}\\left(\\mathbf{r}_m^{-}-\\mathbf{r}\\right), & \\mathbf{r}\\in T_m^{-} \\\\[1.0ex]\n    \\mathbf{0}, & \\text{otherwise}\n    \\end{cases}\n    $$\n    其中 $A_m^{\\pm}$ 是 $T_m^{\\pm}$ 的面积。\n6.  Gram 矩阵元素定义为 $M_{mn}=\\int_{S}\\mathbf{f}_m(\\mathbf{r})\\cdot \\mathbf{f}_n(\\mathbf{r})\\,\\mathrm{d}S$。\n7.  最终表达式应以 $A_T$、$\\ell_m$、$\\ell_n$、顶点坐标 $\\{\\mathbf{r}_{T,k}\\}$ 以及自由顶点 $\\mathbf{r}_{m,T}^{\\mathrm{free}}$、$\\mathbf{r}_{n,T}^{\\mathrm{free}}$ 表示。\n\n该问题具有科学依据，因为它涉及计算电磁学中的标准定义。它提法明确、客观，并提供了足够的信息来推导所要求的表达式。其符号虽然密集，但在该领域是标准的。前提条件在事实上是合理的，不存在矛盾。因此，该问题是有效的。\n\n我们首先将 $M_{mn}$ 的曲面积分分解为网格中单个三角形 $T_p$ 上的积分之和来进行推导：\n$$\nM_{mn} = \\int_{S}\\mathbf{f}_m(\\mathbf{r})\\cdot \\mathbf{f}_n(\\mathbf{r})\\,\\mathrm{d}S = \\sum_{p=1}^{N_T} \\int_{T_p} \\mathbf{f}_m(\\mathbf{r})\\cdot \\mathbf{f}_n(\\mathbf{r})\\,\\mathrm{d}S\n$$\n基函数 $\\mathbf{f}_m(\\mathbf{r})$ 的支集是与边 $e_m$ 相邻的一对三角形 $\\{T_m^{+}, T_m^{-}\\}$。被积函数 $\\mathbf{f}_m(\\mathbf{r})\\cdot \\mathbf{f}_n(\\mathbf{r})$ 仅在 $\\mathbf{f}_m$ 和 $\\mathbf{f}_n$ 支集的交集上非零。仅当特定三角形 $T_p$ 同时位于 $\\mathbf{f}_m$ 和 $\\mathbf{f}_n$ 的支集内时，其上的积分才会对总和有贡献。这意味着边 $e_m$ 和 $e_n$ 必须都是三角形 $T_p$ 的边。\n\n这一观察立即解释了 Gram 矩阵 $M$ 的稀疏模式。一个非对角元素 $M_{mn}$ (其中 $m \\neq n$) 只有在边 $e_m$ 和 $e_n$ 属于同一个三角形时才可能非零。对于给定的边 $e_m$，它是两个三角形 $T_m^+$ 和 $T_m^-$ 的一部分。这两个三角形中的每一个都有另外两条边。因此，基函数 $\\mathbf{f}_m$ 除了与自身之外，最多只能与另外四个基函数（每个相邻三角形对应两个）有非零内积。这导致了一个高度稀疏的矩阵，对于典型的网格拓扑，每行最多有 5 个非零元素。\n\n现在我们来推导在单个三角形 $T$ 上的积分表达式，其中 $e_m$ 和 $e_n$ 都是该三角形的边。让我们为基函数采用统一的表示法。\n在 $\\mathbf{f}_k$ 支集中的一个三角形 $T$ 上，我们可以将其定义写为：\n$$\n\\mathbf{f}_k(\\mathbf{r})|_T = \\sigma_k(T) \\frac{\\ell_k}{2 A_T} (\\mathbf{r} - \\mathbf{r}_{k,T}^{\\mathrm{free}})\n$$\n其中 $A_T$ 是 $T$ 的面积，$\\mathbf{r}_{k,T}^{\\mathrm{free}}$ 是 $T$ 中与边 $e_k$ 相对的顶点，$\\sigma_k(T)$ 是一个符号因子。根据问题的定义：\n- 如果 $T = T_k^{+}$，则 $\\mathbf{r}_{k,T}^{\\mathrm{free}} = \\mathbf{r}_k^{+}$，函数为 $\\frac{\\ell_k}{2 A_k^{+}}(\\mathbf{r} - \\mathbf{r}_k^{+})$。因此，$\\sigma_k(T_k^{+}) = +1$。\n- 如果 $T = T_k^{-}$，则 $\\mathbf{r}_{k,T}^{\\mathrm{free}} = \\mathbf{r}_k^{-}$，函数为 $\\frac{\\ell_k}{2 A_k^{-}}(\\mathbf{r}_k^{-} - \\mathbf{r}) = -\\frac{\\ell_k}{2 A_k^{-}}(\\mathbf{r} - \\mathbf{r}_k^{-})$。因此，$\\sigma_k(T_k^{-}) = -1$。\n符号 $\\sigma_k(T)$ 由全局的、尽管是任意的选择决定，即对于每条边 $e_k$，哪个相邻的三角形被标记为 '+'，哪个被标记为 '−'。\n\n来自一个三角形 $T$（两个函数都在其上受支持）对 $M_{mn}$ 的贡献为：\n$$\nM_{mn}^{(T)} = \\int_T \\left(\\sigma_m(T) \\frac{\\ell_m}{2 A_T} (\\mathbf{r} - \\mathbf{r}_{m,T}^{\\mathrm{free}})\\right) \\cdot \\left(\\sigma_n(T) \\frac{\\ell_n}{2 A_T} (\\mathbf{r} - \\mathbf{r}_{n,T}^{\\mathrm{free}})\\right)\\,\\mathrm{d}S\n$$\n$$\nM_{mn}^{(T)} = \\sigma_m(T)\\sigma_n(T) \\frac{\\ell_m \\ell_n}{4 A_T^2} \\int_T (\\mathbf{r} - \\mathbf{r}_{m,T}^{\\mathrm{free}}) \\cdot (\\mathbf{r} - \\mathbf{r}_{n,T}^{\\mathrm{free}})\\,\\mathrm{d}S\n$$\n为了计算该积分，我们展开点积并利用三角形上积分的性质。为了在推导过程中简化符号，设 $\\mathbf{p}_m = \\mathbf{r}_{m,T}^{\\mathrm{free}}$ 和 $\\mathbf{p}_n = \\mathbf{r}_{n,T}^{\\mathrm{free}}$。积分为：\n$$\n\\int_T (\\mathbf{r} - \\mathbf{p}_m) \\cdot (\\mathbf{r} - \\mathbf{p}_n)\\,\\mathrm{d}S = \\int_T (|\\mathbf{r}|^2 - \\mathbf{r} \\cdot (\\mathbf{p}_m + \\mathbf{p}_n) + \\mathbf{p}_m \\cdot \\mathbf{p}_n)\\,\\mathrm{d}S\n$$\n将其表示为相对于三角形质心 $\\mathbf{r}_{T,c} = (\\mathbf{r}_{T,1}+\\mathbf{r}_{T,2}+\\mathbf{r}_{T,3})/3$ 的形式是有利的。设 $\\mathbf{r}' = \\mathbf{r} - \\mathbf{r}_{T,c}$。一个关键性质是 $\\int_T \\mathbf{r}'\\,\\mathrm{d}S = \\mathbf{0}$。\n设 $\\mathbf{d}_k = \\mathbf{p}_k - \\mathbf{r}_{T,c}$ 为从质心到自由顶点的向量。被积函数变为 $(\\mathbf{r}' + \\mathbf{r}_{T,c} - \\mathbf{p}_m) \\cdot (\\mathbf{r}' + \\mathbf{r}_{T,c} - \\mathbf{p}_n) = (\\mathbf{r}' - \\mathbf{d}_m) \\cdot (\\mathbf{r}' - \\mathbf{d}_n)$。\n积分为：\n$$\n\\int_T (|\\mathbf{r}'|^2 - \\mathbf{r}'\\cdot(\\mathbf{d}_m + \\mathbf{d}_n) + \\mathbf{d}_m \\cdot \\mathbf{d}_n)\\,\\mathrm{d}S = \\int_T |\\mathbf{r}'|^2\\,\\mathrm{d}S - (\\mathbf{d}_m + \\mathbf{d}_n)\\cdot\\int_T \\mathbf{r}'\\,\\mathrm{d}S + (\\mathbf{d}_m \\cdot \\mathbf{d}_n)\\int_T\\,\\mathrm{d}S\n$$\n利用 $\\int_T \\mathbf{r}'\\,\\mathrm{d}S = \\mathbf{0}$ 和 $\\int_T\\,\\mathrm{d}S = A_T$，上式可简化为：\n$$\n\\int_T |\\mathbf{r} - \\mathbf{r}_{T,c}|^2\\,\\mathrm{d}S + A_T (\\mathbf{p}_m - \\mathbf{r}_{T,c})\\cdot(\\mathbf{p}_n - \\mathbf{r}_{T,c})\n$$\n第一项是三角形关于其质心的转动惯量。我们可以使用重心坐标来计算它。一个标准结果（可从重心坐标乘积的积分公式推导）给出了这个以三角形边长的平方 $\\ell_{T,1}, \\ell_{T,2}, \\ell_{T,3}$ 表示的转动惯量：\n$$\n\\int_T |\\mathbf{r} - \\mathbf{r}_{T,c}|^2\\,\\mathrm{d}S = \\frac{A_T}{36}(\\ell_{T,1}^2 + \\ell_{T,2}^2 + \\ell_{T,3}^2)\n$$\n将其代回，完整的积分变为：\n$$\n\\int_T (\\mathbf{r} - \\mathbf{p}_m) \\cdot (\\mathbf{r} - \\mathbf{p}_n)\\,\\mathrm{d}S = A_T \\left[ \\frac{\\ell_{T,1}^2 + \\ell_{T,2}^2 + \\ell_{T,3}^2}{36} + (\\mathbf{r}_{m,T}^{\\mathrm{free}} - \\mathbf{r}_{T,c})\\cdot(\\mathbf{r}_{n,T}^{\\mathrm{free}} - \\mathbf{r}_{T,c}) \\right]\n$$\n现在，将此代入 $M_{mn}^{(T)}$ 的表达式中：\n$$\nM_{mn}^{(T)} = \\sigma_m(T)\\sigma_n(T) \\frac{\\ell_m \\ell_n}{4 A_T^2} \\left( A_T \\left[ \\frac{\\sum_{k=1}^3 \\ell_{T,k}^2}{36} + (\\mathbf{r}_{m,T}^{\\mathrm{free}} - \\mathbf{r}_{T,c})\\cdot(\\mathbf{r}_{n,T}^{\\mathrm{free}} - \\mathbf{r}_{T,c}) \\right] \\right)\n$$\n$$\nM_{mn}^{(T)} = \\sigma_m(T)\\sigma_n(T) \\frac{\\ell_m \\ell_n}{4 A_T} \\left( \\frac{\\sum_{k=1}^3 \\ell_{T,k}^2}{36} + (\\mathbf{r}_{m,T}^{\\mathrm{free}} - \\mathbf{r}_{T,c})\\cdot(\\mathbf{r}_{n,T}^{\\mathrm{free}} - \\mathbf{r}_{T,c}) \\right)\n$$\n总矩阵元素 $M_{mn}$ 是网格中所有三角形贡献的总和。我们引入一个指示函数 $I(e_k, T_p)$，如果边 $e_k$ 是三角形 $T_p$ 的一条边，则其值为 $1$，否则为 $0$。乘积 $I(e_m, T_p)I(e_n, T_p)$ 确保我们只对两个函数都有支集的三角形的贡献求和。\n因此，最终的表达式是：\n$$\nM_{mn} = \\sum_{p=1}^{N_T} I(e_m, T_p) I(e_n, T_p) \\sigma_m(T_p)\\sigma_n(T_p) \\frac{\\ell_m \\ell_n}{4 A_{T_p}} \\left( \\frac{\\sum_{k=1}^3 \\ell_{T_p,k}^2}{36} + (\\mathbf{r}_{m,T_p}^{\\mathrm{free}} - \\mathbf{r}_{T_p,c})\\cdot(\\mathbf{r}_{n,T_p}^{\\mathrm{free}} - \\mathbf{r}_{T_p,c}) \\right)\n$$\n在此表达式中，$\\ell_{T_p,k}$ 是三角形 $T_p$ 三条边的长度，$\\mathbf{r}_{T_p,c}$ 是其质心，$\\mathbf{r}_{k,T_p}^{\\mathrm{free}}$ 是三角形 $T_p$ 中相对于边 $e_k$ 的自由顶点。所有这些量都可以直接从三角形的顶点坐标计算出来。例如，对于一个顶点为 $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3$ 的三角形 $T_p$，边长的平方是 $|\\mathbf{v}_2-\\mathbf{v}_1|^2, |\\mathbf{v}_3-\\mathbf{v}_2|^2, |\\mathbf{v}_1-\\mathbf{v}_3|^2$，质心是 $\\mathbf{r}_{T_p,c} = (\\mathbf{v}_1+\\mathbf{v}_2+\\mathbf{v}_3)/3$。求和实际上最多只涉及两个三角形。对于 $m=n$，这两个三角形是 $T_m^+$ 和 $T_m^-$，符号乘积 $\\sigma_m(T)\\sigma_m(T)$ 变为 $1$。对于 $m \\neq n$，如果 $e_m, e_n$ 只属于一个公共三角形，则和最多包含一项；如果它们构成两个三角形之间的边界（这在保形三角剖分中对于内部边是不可能的），则包含两项。", "answer": "$$ \\boxed{\\sum_{p=1}^{N_T} I(e_m, T_p) I(e_n, T_p) \\sigma_m(T_p)\\sigma_n(T_p) \\frac{\\ell_m \\ell_n}{4 A_{T_p}} \\left( \\frac{\\sum_{k=1}^3 |\\mathbf{r}_{T_p,k+1} - \\mathbf{r}_{T_p,k}|^2}{36} + (\\mathbf{r}_{m,T_p}^{\\mathrm{free}} - \\mathbf{r}_{T_p,c})\\cdot(\\mathbf{r}_{n,T_p}^{\\mathrm{free}} - \\mathbf{r}_{T_p,c}) \\right)} $$", "id": "3344550"}, {"introduction": "将理论付诸代码实践，需要处理好一些人为定义的选择，例如基函数的方向。本练习旨在研究翻转RWG基函数的符号，将如何影响阻抗矩阵和激励向量的组装过程。通过直接计算，您将验证不同方向选择之间简洁的代数关系，从而巩固对矩阵对称性如何保持的理解，并认识到在实践中保持定义一致性的重要性。[@problem_id:3344542]", "problem": "本题要求您从第一性原理出发，对一个具有对称双线性形式的曲面积分方程的矩量法离散化中的Rao–Wilton–Glisson (RWG) 基函数进行推理。目标是通过显式地翻转一部分RWG基函数的符号，并追踪其对矩阵对称性和激励向量行为的影响，来分析边方向一致性如何影响组装后的阻抗矩阵和右端项。\n\n出发点与核心定义：\n- 考虑一个三维欧几里得空间中的三角化、闭合、分片平坦的曲面网格，其包含顶点和三角面元。在每个恰好由两个三角形共享的内部边上，定义一个Rao–Wilton–Glisson (RWG) 基函数。对于一条由两个面积为 $A^{+}$ 和 $A^{-}$ 的三角形 $T^{+}$ 和 $T^{-}$ 共享的边 $e$，其长度为 $l_{e}$，相对顶点（每个三角形中不在该边上的顶点）位于位置 $\\mathbf{r}^{+}$ 和 $\\mathbf{r}^{-}$，RWG基函数定义为\n$$\n\\mathbf{f}_{e}(\\mathbf{r}) =\n\\begin{cases}\n\\dfrac{l_{e}}{2 A^{+}} \\left(\\mathbf{r} - \\mathbf{r}^{+}\\right), & \\mathbf{r} \\in T^{+}, \\\\\n-\\dfrac{l_{e}}{2 A^{-}} \\left(\\mathbf{r} - \\mathbf{r}^{-}\\right), & \\mathbf{r} \\in T^{-}, \\\\\n\\mathbf{0}, & \\text{otherwise}.\n\\end{cases}\n$$\n该定义依赖于一个二元方向选择，即为每条边指定相邻的两个三角形中哪一个是 $T^{+}$，哪一个是 $T^{-}$。翻转一个RWG基函数的方向会使 $\\mathbf{f}_{e} \\mapsto -\\mathbf{f}_{e}$。\n\n- 使用一个对称双线性形式作为阻抗算子，具体为RWG基函数在曲面上的 $L^{2}$ 内积下的格拉姆矩阵。组装后的阻抗矩阵元素为\n$$\nZ_{ij} = \\int_{S} \\mathbf{f}_{i}(\\mathbf{r}) \\cdot \\mathbf{f}_{j}(\\mathbf{r}) \\, \\mathrm{d}S,\n$$\n其中 $S$ 表示该曲面。只要组装过程遵循一致的定义，由于内积的对称性，该选择在精确算术下会产生一个对称矩阵 $Z$。\n\n- 设右端项为一个给定的恒定入射电场 $\\mathbf{E}_{0}$ 在检验空间上的投影，即\n$$\nV_{i} = \\int_{S} \\mathbf{f}_{i}(\\mathbf{r}) \\cdot \\mathbf{E}_{0} \\, \\mathrm{d}S.\n$$\n\n三角形上的几何积分：\n- 对于一个顶点为 $\\mathbf{v}_{1}$、$\\mathbf{v}_{2}$ 和 $\\mathbf{v}_{3}$，面积为 $A$，形心为 $\\mathbf{r}_{c} = \\left(\\mathbf{v}_{1} + \\mathbf{v}_{2} + \\mathbf{v}_{3}\\right)/3$ 的三角形，使用重心坐标，以下经过充分测试的公式成立：\n$$\n\\int_{T} \\mathbf{r} \\, \\mathrm{d}S = A \\, \\mathbf{r}_{c} = A \\, \\frac{\\mathbf{v}_{1} + \\mathbf{v}_{2} + \\mathbf{v}_{3}}{3},\n$$\n$$\n\\int_{T} \\mathbf{r} \\, \\mathbf{r}^{\\mathsf{T}} \\, \\mathrm{d}S \n= A \\left[\\frac{1}{6} \\sum_{i=1}^{3} \\mathbf{v}_{i} \\mathbf{v}_{i}^{\\mathsf{T}} + \\frac{1}{12} \\sum_{i \\neq j} \\mathbf{v}_{i} \\mathbf{v}_{j}^{\\mathsf{T}}\\right].\n$$\n因此，\n$$\n\\int_{T} \\|\\mathbf{r}\\|^{2} \\, \\mathrm{d}S = \\mathrm{tr}\\left(\\int_{T} \\mathbf{r} \\, \\mathbf{r}^{\\mathsf{T}} \\, \\mathrm{d}S\\right),\n$$\n并且对于任意固定的向量 $\\mathbf{a}$ 和 $\\mathbf{b}$，\n$$\n\\int_{T} \\left(\\mathbf{r} - \\mathbf{a}\\right) \\cdot \\left(\\mathbf{r} - \\mathbf{b}\\right) \\, \\mathrm{d}S\n= \\int_{T} \\|\\mathbf{r}\\|^{2} \\, \\mathrm{d}S - \\mathbf{a} \\cdot \\int_{T} \\mathbf{r} \\, \\mathrm{d}S - \\mathbf{b} \\cdot \\int_{T} \\mathbf{r} \\, \\mathrm{d}S + A \\, \\mathbf{a} \\cdot \\mathbf{b}.\n$$\n\n方向翻转分析：\n- 如果一部分RWG基函数被翻转，即对于一组边索引 $\\mathcal{F}$，对所有 $e \\in \\mathcal{F}$ 进行映射 $\\mathbf{f}_{e} \\mapsto -\\mathbf{f}_{e}$，那么存在一个对角矩阵 $D$，其对角元素为 $D_{ee} = -1$（如果 $e \\in \\mathcal{F}$）和 $D_{ee} = +1$（否则），使得\n$$\nZ' = D Z D, \\quad V' = D V.\n$$\n矩阵 $Z'$ 保持对称，因为 $Z$ 是对称的且 $D$ 是对角矩阵：$Z'^{\\mathsf{T}} = D Z^{\\mathsf{T}} D = D Z D = Z'$。\n\n任务：\n- 为一个特定的闭合网格和恒定电场 $\\mathbf{E}_{0}$ 组装矩阵 $Z$ 和向量 $V$，然后应用几种RWG基函数方向的翻转，并验证其对对称性和对角相似性的影响。计算必须在数值容差范围内，使用上述几何积分和RWG定义精确完成。\n\n网格规格：\n- 顶点（单位：米）：\n$\\mathbf{v}_{0} = (1, 1, 1)$, \n$\\mathbf{v}_{1} = (1, -1, -1)$, \n$\\mathbf{v}_{2} = (-1, 1, -1)$, \n$\\mathbf{v}_{3} = (-1, -1, 1)$.\n\n- 按顶点索引定义的三角形：\n$T_{0} = (0, 1, 2)$, \n$T_{1} = (0, 1, 3)$, \n$T_{2} = (0, 2, 3)$, \n$T_{3} = (1, 2, 3)$.\n\n- 边（每条边恰好由两个三角形共享）按以下顺序索引：\n$e_{0} = (0, 1)$, \n$e_{1} = (0, 2)$, \n$e_{2} = (0, 3)$, \n$e_{3} = (1, 2)$, \n$e_{4} = (1, 3)$, \n$e_{5} = (2, 3)$.\n对于每条边 $e_{k}$，在其两个相邻三角形中，选择三角形索引较小的作为 $T^{+}$，另一个作为 $T^{-}$。使用此方向一致地定义 $\\mathbf{f}_{e_{k}}$。\n\n入射场：\n- 使用一个恒定入射电场 $\\mathbf{E}_{0} = (0.25, -0.40, 0.15)$，单位为伏特/米。由于下面的输出是无量纲布尔值，单位一致性是必需的，但最终答案不涉及数值单位转换。\n\n组装要求：\n- 通过RWG定义和三角形积分精确计算 $Z_{ij}$。只有在 $\\mathbf{f}_{i}$ 和 $\\mathbf{f}_{j}$ 的支集交集内的三角形才有贡献。对于右端项，\n$$\nV_{i} = \\sum_{T \\in \\mathrm{supp}(\\mathbf{f}_{i})} \\sigma_{i,T} \\frac{l_{i}}{2 A_{T}} \\left[ \\mathbf{E}_{0} \\cdot \\left(\\int_{T} \\mathbf{r} \\, \\mathrm{d}S \\right) - A_{T} \\, \\mathbf{E}_{0} \\cdot \\mathbf{r}_{i,T}^{\\mathrm{opp}} \\right],\n$$\n其中 $\\sigma_{i,T} \\in \\{+1, -1\\}$ 编码了对于边 $i$ 而言，三角形 $T$ 是 $T^{+}$ 还是 $T^{-}$，$l_{i}$ 是边 $i$ 的长度，$A_{T}$ 是三角形 $T$ 的面积，$\\mathbf{r}_{i,T}^{\\mathrm{opp}}$ 是边 $i$ 在三角形 $T$ 内的相对顶点。\n\n检验套件：\n- 考虑以下四个作用于边索引的翻转集合 $\\mathcal{F}$：\n    - 情况1：$\\mathcal{F} = [\\,]$（无翻转）。\n    - 情况2：$\\mathcal{F} = [\\,0\\,]$（仅翻转 $e_{0}$）。\n    - 情况3：$\\mathcal{F} = [\\,0,1,2,3,4,5\\,]$（翻转所有边）。\n    - 情况4：$\\mathcal{F} = [\\,0,2,4\\,]$（翻转所有偶数索引的边）。\n\n对于每种情况，用两种独立的方式组装翻转后的矩阵 $Z'$ 和向量 $V'$：\n    - 直接重组：将方向翻转应用于RWG定义，并通过积分重新组装 $Z'$ 和 $V'$。\n    - 对角相似性：使用由翻转集合决定的对角矩阵 $D$，计算 $Z' = D Z D$ 和 $V' = D V$。\n\n每种情况的验证目标：\n- 每种情况返回三个布尔值：\n    $b_{1}$：在翻转下组装的 $Z'$ 是否在严格的数值容差内对称，\n    $b_{2}$：直接重组的 $Z'$ 是否在相同容差内等于 $D Z D$，\n    $b_{3}$：直接重组的 $V'$ 是否在相同容差内等于 $D V$。\n\n输出规格：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序连接所有四种情况的布尔值，即 $[b_{1}^{(1)}, b_{2}^{(1)}, b_{3}^{(1)}, b_{1}^{(2)}, b_{2}^{(2)}, b_{3}^{(2)}, b_{1}^{(3)}, b_{2}^{(3)}, b_{3}^{(3)}, b_{1}^{(4)}, b_{2}^{(4)}, b_{3}^{(4)}]$，其中上标索引从 $1$ 到 $4$ 的情况。", "solution": "问题陈述已经过严格审查，并被确定为有效。它在计算电磁学原理，特别是使用Rao-Wilton-Glisson (RWG) 基函数的矩量法方面，具有科学依据。该问题是适定的，具有明确定义的几何形状、基函数以及一系列精确的计算和验证任务。所有需要的数据和公式都已提供，不存在内部矛盾、歧义或对非科学主张的依赖。\n\n任务是通过直接计算来验证翻转RWG基函数方向对阻抗矩阵 $Z$ 和激励向量 $V$ 的理论影响。理论预测，如果一组基函数 $\\{\\mathbf{f}_i\\}$ 通过符号 $s_i \\in \\{+1, -1\\}$ 变换为 $\\{\\mathbf{f}'_i\\}$（其中 $\\mathbf{f}'_i = s_i \\mathbf{f}_i$），则新的矩阵 $Z'$ 和向量 $V'$ 与原始矩阵向量 ($Z$, $V$) 的关系为 $Z' = DZD$ 和 $V' = DV$，其中 $D$ 是一个对角矩阵，其对角元素为 $D_{ii} = s_i$。此验证将针对一个特定的四面体网格进行。\n\n求解过程分为几个步骤：\n1.  **几何与网格预计算**：根据给定的顶点坐标和三角形定义，计算网格的属性（三角形面积、边长、邻接关系）。\n2.  **RWG基函数设置**：对于每条边，根据指定规则确定初始方向（$T^{+}$ vs. $T^{-}$）和相应的相对顶点。\n3.  **积分实现**：实现所提供的在三角形上进行积分的公式。这些是组装矩阵和向量的基础模块。\n4.  **系统组装**：创建一个函数，用于为给定的一组方向符号组装矩阵 $Z$ 和向量 $V$。\n5.  **验证**：对于每个检验用例，直接使用翻转后的方向组装矩阵和向量，并同时通过对角相似变换进行计算。比较结果以验证理论以及所得矩阵的对称性。\n\n**1. 几何与网格预计算**\n该网格由4个顶点、4个三角面和6条内部边组成，形成一个正四面体。\n-   **顶点**：$\\mathbf{v}_{0} = (1, 1, 1)$, $\\mathbf{v}_{1} = (1, -1, -1)$, $\\mathbf{v}_{2} = (-1, 1, -1)$, $\\mathbf{v}_{3} = (-1, -1, 1)$。\n-   **边**：$e_0=(0,1), e_1=(0,2), e_2=(0,3), e_3=(1,2), e_4=(1,3), e_5=(2,3)$。所有边的长度均为 $l_e = \\sqrt{8} = 2\\sqrt{2}$。\n-   **三角形**：$T_0=(0,1,2), T_1=(0,1,3), T_2=(0,2,3), T_3=(1,2,3)$。所有面都是面积为 $A = 2\\sqrt{3}$ 的等边三角形。\n-   **边-三角面邻接关系**：构建一个邻接图。对于每条边 $e_i$，我们找到共享它的两个三角形。例如，边 $e_0 = (\\mathbf{v}_0, \\mathbf{v}_1)$ 被三角形 $T_0 = (\\mathbf{v}_0, \\mathbf{v}_1, \\mathbf{v}_2)$ 和 $T_1 = (\\mathbf{v}_0, \\mathbf{v}_1, \\mathbf{v}_3)$ 共享。\n\n**2. RWG基函数设置**\n对于每条边 $e_i$，基函数 $\\mathbf{f}_i$ 是根据其两个相邻三角形 $T^{+}$ 和 $T^{-}$ 定义的。问题指定 $T^{+}$ 是索引较小的三角形。然后确定函数在每个三角形上的符号以及相对顶点的身份。对于边 $e_i$ 和一个相邻三角形 $T_k$，如果 $T_k=T_i^{+}$，则令 $\\sigma_{i,k} = +1$；如果 $T_k=T_i^{-}$，则令 $\\sigma_{i,k}=-1$。$e_i$ 在 $T_k$ 中的相对顶点记为 $\\mathbf{r}_{i,k}^{\\mathrm{opp}}$。例如，对于 $e_0=(\\mathbf{v}_0, \\mathbf{v}_1)$，相邻的三角形是 $T_0$ 和 $T_1$。因为 $01$，所以 $T_{0}$ 是 $T_0^{+}$，$T_{1}$ 是 $T_0^{-}$。在 $T_0$ 中的相对顶点是 $\\mathbf{v}_2$，所以 $\\mathbf{r}_{0,T_0}^{\\mathrm{opp}} = \\mathbf{v}_2$。在 $T_1$ 中的相对顶点是 $\\mathbf{v}_3$，所以 $\\mathbf{r}_{0,T_1}^{\\mathrm{opp}} = \\mathbf{v}_3$。对所有6条边系统地执行此操作。\n\n**3. 从第一性原理组装矩阵和向量**\n任务的核心是实现对给定方向翻转集合的矩阵 $Z'$ 和向量 $V'$ 的组装。翻转由一个符号向量 $s \\in \\{+1, -1\\}^6$ 表示，如果基函数 $\\mathbf{f}_i$ 被翻转，则 $s_i = -1$。翻转后的基函数的定义为 $\\mathbf{f}'_i(\\mathbf{r}) = s_i \\mathbf{f}_i(\\mathbf{r})$。\n\n翻转后阻抗矩阵的元素 $Z'_{ij}$ 由下式给出：\n$$ Z'_{ij} = \\int_S \\mathbf{f}'_i(\\mathbf{r}) \\cdot \\mathbf{f}'_j(\\mathbf{r}) \\, \\mathrm{d}S = s_i s_j \\int_S \\mathbf{f}_i(\\mathbf{r}) \\cdot \\mathbf{f}_j(\\mathbf{r}) \\, \\mathrm{d}S $$\n该积分仅在 $\\mathbf{f}_i$ 和 $\\mathbf{f}_j$ 支集共享的三角形上非零。设 $\\mathcal{T}_{i,j}$ 为这类三角形的集合。对于任何 $T_k \\in \\mathcal{T}_{i,j}$：\n$$ Z'_{ij} = s_i s_j \\sum_{T_k \\in \\mathcal{T}_{i,j}} \\int_{T_k} \\left( \\sigma_{i,k} \\frac{l_i}{2 A_k} (\\mathbf{r} - \\mathbf{r}_{i,k}^{\\mathrm{opp}}) \\right) \\cdot \\left( \\sigma_{j,k} \\frac{l_j}{2 A_k} (\\mathbf{r} - \\mathbf{r}_{j,k}^{\\mathrm{opp}}) \\right) \\mathrm{d}S $$\n$$ Z'_{ij} = \\sum_{T_k \\in \\mathcal{T}_{i,j}} s_i s_j \\, \\sigma_{i,k} \\sigma_{j,k} \\frac{l_i l_j}{4 A_k^2} \\int_{T_k} (\\mathbf{r} - \\mathbf{r}_{i,k}^{\\mathrm{opp}}) \\cdot (\\mathbf{r} - \\mathbf{r}_{j,k}^{\\mathrm{opp}}) \\, \\mathrm{d}S $$\n积分项使用所提供的公式计算：\n$$ \\int_{T_k} (\\mathbf{r} - \\mathbf{a}) \\cdot (\\mathbf{r} - \\mathbf{b}) \\, \\mathrm{d}S = \\mathrm{tr}\\left(\\int_{T_k} \\mathbf{r}\\mathbf{r}^\\mathsf{T} \\mathrm{d}S\\right) - (\\mathbf{a}+\\mathbf{b}) \\cdot \\int_{T_k} \\mathbf{r} \\, \\mathrm{d}S + A_k (\\mathbf{a} \\cdot \\mathbf{b}) $$\n其中 $\\mathbf{a} = \\mathbf{r}_{i,k}^{\\mathrm{opp}}$ 且 $\\mathbf{b} = \\mathbf{r}_{j,k}^{\\mathrm{opp}}$。张量积分 $\\int \\mathbf{r}\\mathbf{r}^\\mathsf{T} \\mathrm{d}S$ 和向量积分 $\\int \\mathbf{r} \\, \\mathrm{d}S$ 使用其他给定的精确公式进行计算。\n\n翻转后激励向量的元素 $V'_i$ 为：\n$$ V'_{i} = \\int_S \\mathbf{f}'_i(\\mathbf{r}) \\cdot \\mathbf{E}_{0} \\, \\mathrm{d}S = s_i \\int_S \\mathbf{f}_i(\\mathbf{r}) \\cdot \\mathbf{E}_{0} \\, \\mathrm{d}S $$\n积分在 $\\mathbf{f}_i$ 的支集上进行计算，该支集由 $T_i^+$ 和 $T_i^-$ 组成。\n$$ V'_{i} = s_i \\left[ \\int_{T_i^+} \\frac{l_i}{2 A_i^+} (\\mathbf{r} - \\mathbf{r}_i^+) \\cdot \\mathbf{E}_0 \\, \\mathrm{d}S - \\int_{T_i^-} \\frac{l_i}{2 A_i^-} (\\mathbf{r} - \\mathbf{r}_i^-) \\cdot \\mathbf{E}_0 \\, \\mathrm{d}S \\right] $$\n其中 $\\mathbf{r}_i^{\\pm}$ 是边 $i$ 在三角形 $T_i^{\\pm}$ 中的相对顶点。这可以简化为：\n$$ V'_{i} = s_i \\frac{l_i}{2} \\left[ \\mathbf{E}_0 \\cdot (\\mathbf{r}_{c,i}^+ - \\mathbf{r}_i^+) - \\mathbf{E}_0 \\cdot (\\mathbf{r}_{c,i}^- - \\mathbf{r}_i^-) \\right] $$\n其中 $\\mathbf{r}_{c,i}^{\\pm}$ 是三角形 $T_i^{\\pm}$ 的形心。\n\n**4. 验证程序**\n主要程序包括以下步骤：\n1.  使用直接组装函数，在没有翻转的情况下（即所有 $i$ 的 $s_i = +1$），组装基础矩阵 $Z$ 和向量 $V$。\n2.  对于由翻转集合 $\\mathcal{F}$ 指定的四个检验用例中的每一个：\n    a.  构造对角矩阵 $D$，其中如果 $i \\in \\mathcal{F}$，则 $D_{ii} = -1$，否则 $D_{ii} = +1$。\n    b.  使用相似变换计算预期的翻转矩阵和向量：$Z'_{\\text{transform}} = DZD$ 和 $V'_{\\text{transform}} = DV$。\n    c.  通过直接重组计算翻转后的矩阵和向量：$Z'_{\\text{direct}}$ 和 $V'_{\\text{direct}}$ 使用与 $D$ 对应的符号向量 $s$ 通过组装函数计算。\n    d.  使用数值容差（`numpy.allclose`）执行三个必需的布尔比较：\n        i.   $b_1$：检查 $Z'_{\\text{direct}}$ 是否对称：`allclose(Z'_direct, Z'_direct.T)`。\n        ii.  $b_2$：检查重组后的矩阵是否与变换后的矩阵匹配：`allclose(Z'_direct, Z'_transform)`。\n        iii. $b_3$：检查重组后的向量是否与变换后的向量匹配：`allclose(V'_direct, V'_transform)`。\n\n由于基础数学理论是健全的，并且所提供的积分公式是精确的，我们预期所有布尔检查都将通过，从而在浮点精度的限制内，证实 $Z'$ 保持对称，并且直接重组等效于对角相似变换。代码精确地实现了这一过程。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates and solves the Rao-Wilton-Glisson basis function problem.\n    \"\"\"\n\n    # --- Problem Givens ---\n    verts = np.array([\n        [1., 1., 1.],    # v0\n        [1., -1., -1.],   # v1\n        [-1., 1., -1.],  # v2\n        [-1., -1., 1.]   # v3\n    ])\n\n    tris = [\n        (0, 1, 2),  # T0\n        (0, 1, 3),  # T1\n        (0, 2, 3),  # T2\n        (1, 2, 3)   # T3\n    ]\n\n    edges = [\n        (0, 1),  # e0\n        (0, 2),  # e1\n        (0, 3),  # e2\n        (1, 2),  # e3\n        (1, 3),  # e4\n        (2, 3)   # e5\n    ]\n    \n    E0 = np.array([0.25, -0.40, 0.15])\n    NUM_EDGES = len(edges)\n\n    # --- Geometric Pre-computation ---\n    edge_map = {tuple(sorted(edge)): i for i, edge in enumerate(edges)}\n    \n    edge_to_tris = [[] for _ in range(NUM_EDGES)]\n    for i, tri_verts in enumerate(tris):\n        for j in range(3):\n            v1_idx, v2_idx = tri_verts[j], tri_verts[(j + 1) % 3]\n            edge_key = tuple(sorted((v1_idx, v2_idx)))\n            if edge_key in edge_map:\n                edge_idx = edge_map[edge_key]\n                edge_to_tris[edge_idx].append(i)\n\n    tri_props = []\n    for tri_v_indices in tris:\n        v_nodes = [verts[k] for k in tri_v_indices]\n        v0, v1, v2 = v_nodes[0], v_nodes[1], v_nodes[2]\n        area = 0.5 * np.linalg.norm(np.cross(v1 - v0, v2 - v0))\n        centroid = (v0 + v1 + v2) / 3.0\n        \n        sum_viviT = sum(np.outer(vi, vi) for vi in v_nodes)\n        sum_vivjT = (np.outer(v0, v1) + np.outer(v1, v0) +\n                     np.outer(v0, v2) + np.outer(v2, v0) +\n                     np.outer(v1, v2) + np.outer(v2, v1))\n        \n        int_rrT = area * ((1/6.0) * sum_viviT + (1/12.0) * sum_vivjT)\n        \n        tri_props.append({'area': area, 'centroid': centroid, 'int_rrT': int_rrT})\n\n    edge_lengths = [np.linalg.norm(verts[v2] - verts[v1]) for v1, v2 in edges]\n\n    # --- RWG Basis Function Setup ---\n    rwg_info = []\n    for i in range(NUM_EDGES):\n        t1_idx, t2_idx = sorted(edge_to_tris[i])\n        \n        tri1_verts = set(tris[t1_idx])\n        tri2_verts = set(tris[t2_idx])\n        edge_verts = set(edges[i])\n        \n        opp_v1_idx = list(tri1_verts - edge_verts)[0]\n        opp_v2_idx = list(tri2_verts - edge_verts)[0]\n\n        rwg_info.append({\n            'T_plus_idx': t1_idx,\n            'T_minus_idx': t2_idx,\n            'r_opp_plus': verts[opp_v1_idx],\n            'r_opp_minus': verts[opp_v2_idx]\n        })\n\n    memoized_integrals = {}\n    def get_dot_prod_integral(T_idx, r_opp_a, r_opp_b):\n        key = (T_idx, tuple(r_opp_a.flatten()), tuple(r_opp_b.flatten()))\n        if key in memoized_integrals:\n            return memoized_integrals[key]\n\n        props = tri_props[T_idx]\n        A = props['area']\n        int_rrT = props['int_rrT']\n        int_r = A * props['centroid']\n        \n        int_r_sq = np.trace(int_rrT)\n        \n        result = int_r_sq - np.dot(r_opp_a + r_opp_b, int_r) + A * np.dot(r_opp_a, r_opp_b)\n        memoized_integrals[key] = result\n        return result\n\n    # --- Assembly Functions ---\n    def assemble(orientations):\n        Z = np.zeros((NUM_EDGES, NUM_EDGES))\n        V = np.zeros(NUM_EDGES)\n\n        # Assemble Z\n        for i in range(NUM_EDGES):\n            for j in range(NUM_EDGES):\n                supp_i = {rwg_info[i]['T_plus_idx'], rwg_info[i]['T_minus_idx']}\n                supp_j = {rwg_info[j]['T_plus_idx'], rwg_info[j]['T_minus_idx']}\n                common_tris = supp_i.intersection(supp_j)\n\n                if not common_tris:\n                    continue\n\n                Z_ij_base = 0.0\n                for T_k_idx in common_tris:\n                    if T_k_idx == rwg_info[i]['T_plus_idx']:\n                        sigma_i_k = 1.0; r_opp_i_k = rwg_info[i]['r_opp_plus']\n                    else:\n                        sigma_i_k = -1.0; r_opp_i_k = rwg_info[i]['r_opp_minus']\n\n                    if T_k_idx == rwg_info[j]['T_plus_idx']:\n                        sigma_j_k = 1.0; r_opp_j_k = rwg_info[j]['r_opp_plus']\n                    else:\n                        sigma_j_k = -1.0; r_opp_j_k = rwg_info[j]['r_opp_minus']\n                    \n                    A_k = tri_props[T_k_idx]['area']\n                    l_i, l_j = edge_lengths[i], edge_lengths[j]\n                    \n                    integral_val = get_dot_prod_integral(T_k_idx, r_opp_i_k, r_opp_j_k)\n\n                    term = (l_i * l_j) / (4.0 * A_k**2) * integral_val\n                    Z_ij_base += sigma_i_k * sigma_j_k * term\n                \n                Z[i, j] = orientations[i] * orientations[j] * Z_ij_base\n\n        # Assemble V\n        for i in range(NUM_EDGES):\n            info = rwg_info[i]\n            l_i = edge_lengths[i]\n            \n            T_plus_props = tri_props[info['T_plus_idx']]\n            T_minus_props = tri_props[info['T_minus_idx']]\n            \n            term_plus = np.dot(E0, T_plus_props['centroid'] - info['r_opp_plus'])\n            term_minus = np.dot(E0, T_minus_props['centroid'] - info['r_opp_minus'])\n            \n            V_i_base = (l_i / 2.0) * (term_plus - term_minus)\n            V[i] = orientations[i] * V_i_base\n        \n        return Z, V\n\n    # --- Verification ---\n    test_cases = [\n        [],                # Case 1: no flips\n        [0],               # Case 2: flip e0\n        [0, 1, 2, 3, 4, 5], # Case 3: flip all\n        [0, 2, 4]          # Case 4: flip even\n    ]\n    \n    all_results = []\n    \n    base_orientations = np.ones(NUM_EDGES)\n    Z_base, V_base = assemble(base_orientations)\n\n    for flip_set in test_cases:\n        D = np.identity(NUM_EDGES)\n        flipped_orientations = np.ones(NUM_EDGES)\n        for idx in flip_set:\n            D[idx, idx] = -1.0\n            flipped_orientations[idx] = -1.0\n        \n        Z_prime_transform = D @ Z_base @ D\n        V_prime_transform = D @ V_base\n        \n        Z_prime_direct, V_prime_direct = assemble(flipped_orientations)\n        \n        b1 = np.allclose(Z_prime_direct, Z_prime_direct.T)\n        b2 = np.allclose(Z_prime_direct, Z_prime_transform)\n        b3 = np.allclose(V_prime_direct, V_prime_transform)\n        \n        all_results.extend([b1, b2, b3])\n\n    # --- Final Output ---\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3344542"}, {"introduction": "网格离散化的质量直接影响最终线性系统的数值稳定性。本练习将分析RWG基函数及其散度的范数如何随三角形的纵横比 $\\gamma$ 缩放，这正是电场积分方程（EFIE）产生病态问题的根源。通过推导这些缩放定律并提出与纵横比相关的预条件子，您将对几何与线性代数之间的相互作用产生更深刻的认识，这是开发稳健仿真工具的一项关键技能。[@problem_id:3344523]", "problem": "要求您分析在网格各向异性条件下 Rao-Wilton-Glisson (RWG) 基函数的缩放特性，并设计一个能感知长宽比的预条件子。考虑一对全等的平面直角三角形，它们共享一条长度为 $l$ 的公共边，且垂直于该边的测量高度为 $h$。这对三角形构成了与共享边相关联的单个 RWG 基函数 $\\,\\mathbf{f}_e\\,$ 的规范支集。长宽比定义为 $$\\gamma = \\frac{l}{h}。$$ RWG 基函数 $\\,\\mathbf{f}_e\\,$ 是一个定义在两个三角形上的切向、分片线性矢量场，每个三角形有一个自由顶点（即与共享边相对的顶点）。曲面散度算子表示为 $\\,\\nabla_s \\cdot (\\cdot)\\,$。\n\n从矩量法 (MoM) 中电场积分方程 (EFIE) 的基本定义以及在一对相邻三角形上构建规范 RWG 基函数出发，并利用平面三角形上矢量微积分的第一性原理：\n- 推导以 $\\,l\\,$ 和 $\\,h\\,$（并因此以 $\\,\\gamma\\,$）表示的 $\\,L^2\\,$ 范数平方 $$\\|\\mathbf{f}_e\\|_{L^2}^2 = \\int_{T^+ \\cup T^-} \\|\\mathbf{f}_e(\\mathbf{r})\\|^2 \\, \\mathrm{d}S,$$ 及其曲面散度的 $\\,L^2\\,$ 范数平方 $$\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}^2 = \\int_{T^+ \\cup T^-} \\left(\\nabla_s \\cdot \\mathbf{f}_e(\\mathbf{r})\\right)^2 \\, \\mathrm{d}S,$$ 的精确缩放定律，其中 $\\,T^+\\,$ 和 $\\,T^-\\,$ 表示这两个三角形。请将两个范数用 $\\,l\\,$ 和 $\\,h\\,$ 表示，然后用 $\\,h\\,$ 和 $\\,\\gamma\\,$ 表示。请遵循以下约定：长度 $\\,l\\,$ 和 $\\,h\\,$ 的单位为米，$\\,\\|\\mathbf{f}_e\\|_{L^2}\\,$ 必须以米为单位表示，而 $\\,\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}\\,$ 必须表示为无量纲数。\n\n然后，提出并论证一种对角的、能感知长宽比的预处理策略，该策略通过重缩放 RWG 系数来缓解当 $\\,\\gamma\\,$ 变得很大时条件数的恶化。至少提供以下两种对角缩放方法：\n- 一种 $\\,L^2\\,$ 归一化对角缩放 $$s_{\\mathrm{diag}} = \\frac{1}{\\|\\mathbf{f}_e\\|_{L^2}},$$ 单位为 $\\,\\mathrm{m}^{-1}.$\n- 一种几何平均对角缩放 $$s_{\\mathrm{gm}} = \\frac{1}{\\sqrt{\\|\\mathbf{f}_e\\|_{L^2}\\,\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}}},$$ 单位为 $\\,\\mathrm{m}^{-1/2}.$\n\n最后，实现一个程序，针对每个测试用例，计算并返回包含以下四个浮点数的列表：\n$$\\left[\\,\\|\\mathbf{f}_e\\|_{L^2}\\ \\text{（单位 m）},\\ \\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}\\ \\text{（无量纲）},\\ s_{\\mathrm{diag}}\\ \\text{（单位 m}^{-1}\\text{）},\\ s_{\\mathrm{gm}}\\ \\text{（单位 m}^{-1/2}\\text{）}\\right].$$\n\n您的程序应该生成单行输出，其中包含一个由各用例列表组成的列表，以逗号分隔，并用方括号括起来。也就是说，最终输出必须是一个单独的 Python 列表，其元素是如上所述的（针对每个测试用例的）四元数列表，打印在一行上，不含任何额外文本。\n\n使用以下测试套件来验证对各向同性、中度各向异性、高度各向异性、固定长宽比下的尺度变化以及极端各向异性的覆盖情况。所有长度单位均为米，不使用角度，所有要求的输出必须以上述指定单位给出：\n- 用例 1 (各向同性基准): $\\,l = 1.0\\,$, $\\,h = 1.0\\,$\n- 用例 2 (中度拉长): $\\,l = 1.0\\,$, $\\,h = 0.2\\,$\n- 用例 3 (高度拉长): $\\,l = 1.0\\,$, $\\,h = 0.05\\,$\n- 用例 4 (按比例缩小，长宽比与中度情况相同): $\\,l = 0.1\\,$, $\\,h = 0.01\\,$\n- 用例 5 (极端拉长): $\\,l = 2.0\\,$, $\\,h = 0.001\\,$", "solution": "该问题要求推导 Rao-Wilton-Glisson (RWG) 基函数在各向异性条件下的缩放定律，并设计相应的对角预条件子。随后，将针对具体的测试用例进行数值实现。\n\n### 1. 几何与基函数定义\n\n问题将单个 RWG 基函数 $\\mathbf{f}_e$ 的支集定义为一对全等的平面直角三角形 $T^+$ 和 $T^-$，它们共享一条长度为 $l$ 的公共边。每个三角形的高度 $h$ 是从与共享边相对的顶点（“自由顶点”）到包含共享边的直线的正交距离。\n\n我们建立一个坐标系。将共享边置于 $x$ 轴上，以原点为中心，其顶点分别为 $\\mathbf{r}_1 = (-\\frac{l}{2}, 0, 0)$ 和 $\\mathbf{r}_2 = (\\frac{l}{2}, 0, 0)$。题目陈述这些三角形是直角三角形且相对于此边的高度为 $h$，这限制了自由顶点的位置。一个满足所有条件的配置是，直角位于共享边之外的其中一个顶点。对于 $T^+$，设其顶点为 $\\mathbf{r}_1$、$\\mathbf{r}_2$ 和自由顶点 $\\mathbf{v}_f^+$。为满足高度约束，$\\mathbf{v}_f^+$ 的 $y$ 坐标必须为 $h$（或 $-h$）。要使该三角形为直角三角形，直角可以位于 $\\mathbf{r}_1$、$\\mathbf{r}_2$ 或 $\\mathbf{v}_f^+$。我们将直角置于 $\\mathbf{r}_1 = (-\\frac{l}{2}, 0, 0)$。从 $\\mathbf{r}_1$ 到 $\\mathbf{r}_2$ 的向量是 $(l, 0, 0)$。要形成直角，从 $\\mathbf{r}_1$到 $\\mathbf{v}_f^+$ 的向量必须与之正交。若 $\\mathbf{v}_f^+$ 位于 $(-\\frac{l}{2}, h, 0)$，则可实现此要求。\n这种构造满足所有条件：\n- $T^+$ 的顶点为 $\\mathbf{r}_1(-\\frac{l}{2}, 0, 0)$、$\\mathbf{r}_2(\\frac{l}{2}, 0, 0)$ 和 $\\mathbf{v}_f^+(-\\frac{l}{2}, h, 0)$。\n- 边长分别为 $l$、$h$ 和 $\\sqrt{l^2 + h^2}$。这是一个直角三角形。\n- 共享边从 $\\mathbf{r}_1$ 到 $\\mathbf{r}_2$，长度为 $l$。\n- 自由顶点 $\\mathbf{v}_f^+$ 位于共享边的对侧。从 $\\mathbf{v}_f^+$ 到 $x$ 轴（包含共享边）的高度确实是 $h$。\n\n对于 $T^-$，它与 $T^+$ 全等且共享同一条边，其自由顶点对称地位于 $\\mathbf{v}_f^- = (-\\frac{l}{2}, -h, 0)$。这对三角形构成一个筝形。每个三角形的面积为 $A = A^+ = A^- = \\frac{1}{2} l h$。\n\n与共享边 $e$ 相关联的 RWG 基函数 $\\mathbf{f}_e$ 是一个矢量场，定义如下：\n$$\n\\mathbf{f}_e(\\mathbf{r}) = \\begin{cases}\n+ \\frac{l}{2A} (\\mathbf{r} - \\mathbf{v}_f^+)  \\text{对于 } \\mathbf{r} \\in T^+ \\\\\n- \\frac{l}{2A} (\\mathbf{r} - \\mathbf{v}_f^-)  \\text{对于 } \\mathbf{r} \\in T^- \\\\\n\\mathbf{0}  \\text{其他情况}\n\\end{cases}\n$$\n代入 $A = \\frac{1}{2}lh$，前置因子变为 $\\pm \\frac{l}{2(\\frac{1}{2}lh)} = \\pm \\frac{1}{h}$。\n\n### 2. 基函数 $L^2$ 范数的推导\n\n$L^2$ 范数的平方由 $\\|\\mathbf{f}_e\\|_{L^2}^2 = \\int_{T^+ \\cup T^-} \\|\\mathbf{f}_e(\\mathbf{r})\\|^2 \\, dS$ 给出。由于对称性，在 $T^+$ 和 $T^-$ 上的积分是相同的。我们计算在 $T^+$ 上的积分。\n\n我们使用相对于顶点 $\\mathbf{r}_1$、$\\mathbf{r}_2$ 和 $\\mathbf{v}_f^+$ 的重心坐标 $(\\lambda_1, \\lambda_2, \\lambda_3)$ 来表示 $T^+$ 中的一个点 $\\mathbf{r}$：\n$\\mathbf{r} = \\lambda_1 \\mathbf{r}_1 + \\lambda_2 \\mathbf{r}_2 + \\lambda_3 \\mathbf{v}_f^+$，其中 $\\lambda_1 + \\lambda_2 + \\lambda_3 = 1$ 且 $\\lambda_i \\ge 0$。\n$\\mathbf{f}_e$ 定义中的 $(\\mathbf{r} - \\mathbf{v}_f^+)$ 项可以写为：\n$\\mathbf{r} - \\mathbf{v}_f^+ = \\lambda_1 \\mathbf{r}_1 + \\lambda_2 \\mathbf{r}_2 + (\\lambda_3 - 1)\\mathbf{v}_f^+ = \\lambda_1(\\mathbf{r}_1 - \\mathbf{v}_f^+) + \\lambda_2(\\mathbf{r}_2 - \\mathbf{v}_f^+)$。\n从自由顶点出发的向量为：\n$\\mathbf{r}_1 - \\mathbf{v}_f^+ = (0, -h, 0)$\n$\\mathbf{r}_2 - \\mathbf{v}_f^+ = (l, -h, 0)$\n所以，对于 $\\mathbf{r} \\in T^+$：\n$\\mathbf{f}_e(\\mathbf{r}) = \\frac{1}{h} \\left[ \\lambda_1(0, -h, 0) + \\lambda_2(l, -h, 0) \\right] = (l\\lambda_2/h, -(\\lambda_1+\\lambda_2), 0)$。\n其模的平方为：\n$\\|\\mathbf{f}_e(\\mathbf{r})\\|^2 = \\frac{l^2}{h^2}\\lambda_2^2 + (\\lambda_1+\\lambda_2)^2 = \\frac{l^2}{h^2}\\lambda_2^2 + \\lambda_1^2 + 2\\lambda_1\\lambda_2 + \\lambda_2^2$。\n\n为了在 $T^+$ 上对此进行积分，我们使用重心坐标积分的标准公式：$\\int_T \\lambda_1^a \\lambda_2^b \\lambda_3^c dS = 2A \\frac{a!b!c!}{(a+b+c+2)!}$。\n$\\int_{T^+} \\lambda_1^2 dS = 2A \\frac{2!0!0!}{4!} = \\frac{4A}{24} = \\frac{A}{6}$。\n$\\int_{T^+} \\lambda_2^2 dS = \\frac{A}{6}$。\n$\\int_{T^+} \\lambda_1 \\lambda_2 dS = 2A \\frac{1!1!0!}{4!} = \\frac{2A}{24} = \\frac{A}{12}$。\n\n在 $T^+$ 上的积分为：\n$$ \\int_{T^+} \\|\\mathbf{f}_e\\|^2 dS = \\int_{T^+} \\left( \\frac{l^2}{h^2}\\lambda_2^2 + \\lambda_1^2 + 2\\lambda_1\\lambda_2 + \\lambda_2^2 \\right) dS $$\n$$ = \\frac{l^2}{h^2} \\frac{A}{6} + \\frac{A}{6} + 2\\frac{A}{12} + \\frac{A}{6} = A \\left( \\frac{l^2}{6h^2} + \\frac{1}{6} + \\frac{1}{6} + \\frac{1}{6} \\right) = A \\left( \\frac{l^2}{6h^2} + \\frac{3}{6} \\right) = \\frac{A}{6h^2}(l^2+3h^2) $$\n代入 $A = \\frac{1}{2}lh$：\n$$ \\int_{T^+} \\|\\mathbf{f}_e\\|^2 dS = \\frac{\\frac{1}{2}lh}{6h^2}(l^2+3h^2) = \\frac{l(l^2+3h^2)}{12h} $$\n总范数的平方是此值的两倍：\n$$ \\|\\mathbf{f}_e\\|_{L^2}^2 = 2 \\cdot \\frac{l(l^2+3h^2)}{12h} = \\frac{l(l^2+3h^2)}{6h} $$\n用 $h$ 和长宽比 $\\gamma = l/h$ 表示：\n$$ \\|\\mathbf{f}_e\\|_{L^2}^2 = \\frac{\\gamma h((\\gamma h)^2+3h^2)}{6h} = \\frac{\\gamma h^2(\\gamma^2+3)}{6} = \\frac{h^2}{6}(\\gamma^3 + 3\\gamma) $$\n范数 $\\|\\mathbf{f}_e\\|_{L^2}$ 是其平方根，单位按要求为米：\n$$ \\|\\mathbf{f}_e\\|_{L^2} = \\sqrt{\\frac{l(l^2+3h^2)}{6h}} $$\n\n### 3. 曲面散度 $L^2$ 范数的推导\n\n$\\mathbf{f}_e$ 的曲面散度在每个三角形上是常数。使用二维散度定理，或通过直接求导：\n$\\nabla_s \\cdot (\\mathbf{r} - \\mathbf{v}) = \\frac{\\partial(x-v_x)}{\\partial x} + \\frac{\\partial(y-v_y)}{\\partial y} = 2$。\n对于 $\\mathbf{r} \\in T^+$：\n$ \\nabla_s \\cdot \\mathbf{f}_e = \\nabla_s \\cdot \\left(\\frac{l}{2A}(\\mathbf{r} - \\mathbf{v}_f^+)\\right) = \\frac{l}{2A} \\nabla_s \\cdot (\\mathbf{r} - \\mathbf{v}_f^+) = \\frac{l}{2A} \\cdot 2 = \\frac{l}{A} $。\n对于 $\\mathbf{r} \\in T^-$：\n$ \\nabla_s \\cdot \\mathbf{f}_e = \\nabla_s \\cdot \\left(-\\frac{l}{2A}(\\mathbf{r} - \\mathbf{v}_f^-)\\right) = -\\frac{l}{2A} \\cdot 2 = -\\frac{l}{A} $。\n当 $A = \\frac{1}{2}lh$ 时，散度为 $\\pm \\frac{l}{\\frac{1}{2}lh} = \\pm\\frac{2}{h}$。\n\n散度的 $L^2$ 范数平方为：\n$$ \\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}^2 = \\int_{T^+} \\left(\\frac{l}{A}\\right)^2 dS + \\int_{T^-} \\left(-\\frac{l}{A}\\right)^2 dS = \\left(\\frac{l}{A}\\right)^2 (\\text{Area}(T^+) + \\text{Area}(T^-)) $$\n$$ = \\left(\\frac{l}{A}\\right)^2 (2A) = \\frac{2l^2}{A} = \\frac{2l^2}{\\frac{1}{2}lh} = \\frac{4l}{h} $$\n用 $\\gamma = l/h$ 表示：\n$$ \\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}^2 = 4\\gamma $$\n范数 $\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}$ 是其平方根，按要求是无量纲的：\n$$ \\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2} = \\sqrt{\\frac{4l}{h}} = 2\\sqrt{\\gamma} $$\n\n### 4. 长宽比感知预处理\n\n用于 EFIE 的矩量法矩阵的条件数对基函数的范数及其散度的范数很敏感。随着长宽比 $\\gamma$ 增大，$\\|\\mathbf{f}_e\\|_{L^2}^2$ 大致按 $\\gamma^3$ 比例缩放，而 $\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}^2$ 按 $\\gamma$ 比例缩放。这种不平衡导致了条件数差。对角预条件子可以通过重缩放基函数来缓解此问题。我们提出两种缩放方法：\n\n1.  **$L^2$-归一化缩放：**\n    $$ s_{\\mathrm{diag}} = \\frac{1}{\\|\\mathbf{f}_e\\|_{L^2}} = \\left(\\frac{6h}{l(l^2+3h^2)}\\right)^{1/2} $$\n    这种缩放将每个基函数归一化，使其具有单位 $L^2$ 范数。这等效于对格拉姆矩阵 $\\mathbf{G}_{ij} = \\int \\mathbf{f}_i \\cdot \\mathbf{f}_j dS$ 使用雅可比预条件子，该方法对于 EFIE 算子中的恒等部分是有效的。单位为 $\\mathrm{m}^{-1}$。\n\n2.  **几何平均缩放：**\n    $$ s_{\\mathrm{gm}} = \\frac{1}{\\sqrt{\\|\\mathbf{f}_e\\|_{L^2}\\,\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}}} $$\n    平方根内的乘积为 $\\|\\mathbf{f}_e\\|_{L^2}\\,\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2} = \\sqrt{\\frac{l(l^2+3h^2)}{6h}} \\cdot \\sqrt{\\frac{4l}{h}} = \\sqrt{\\frac{2l^2(l^2+3h^2)}{3h^2}}$。\n    $$ s_{\\mathrm{gm}} = \\left(\\frac{2l^2(l^2+3h^2)}{3h^2}\\right)^{-1/4} $$\n    这种缩放试图平衡与函数本身及其散度相关的量级，这两者分别与 EFIE 算子的两个主要分量（类恒等算子和 $\\nabla_s \\nabla_s \\cdot$）有关。与简单的 $L^2$ 归一化相比，这种方法更有效地解决了随 $\\gamma$ 变化的缩放不平衡问题，是向更高级预条件子（如 Calderón 型预条件子）迈出的一步。单位为 $\\mathrm{m}^{-1/2}$。\n\n### 5. 数值计算\n\n我们实现所推导的公式，为每个测试用例计算所需的四个量。\n- $\\|\\mathbf{f}_e\\|_{L^2} = \\sqrt{l(l^2+3h^2)/(6h)}$\n- $\\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2} = \\sqrt{4l/h}$\n- $s_{\\mathrm{diag}} = 1 / \\|\\mathbf{f}_e\\|_{L^2}$\n- $s_{\\mathrm{gm}} = 1 / \\sqrt{\\|\\mathbf{f}_e\\|_{L^2} \\cdot \\|\\nabla_s \\cdot \\mathbf{f}_e\\|_{L^2}}$\n这些量将根据给定的 $l$ 和 $h$ 值进行计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes scaling properties and preconditioner factors for RWG basis functions.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (l, h) in meters.\n    test_cases = [\n        (1.0, 1.0),    # Case 1 (isotropic baseline)\n        (1.0, 0.2),    # Case 2 (moderately elongated)\n        (1.0, 0.05),   # Case 3 (highly elongated)\n        (0.1, 0.01),   # Case 4 (scaled down, high aspect ratio)\n        (2.0, 0.001),  # Case 5 (extremely elongated)\n    ]\n\n    all_results = []\n    for l, h in test_cases:\n        # l: length of the shared edge (meters)\n        # h: height orthogonal to the shared edge (meters)\n\n        # Derived formula for the squared L2 norm of the RWG function\n        # ||f_e||_L2^2 = l*(l^2 + 3*h^2) / (6*h)\n        # Units: m * (m^2) / m = m^2\n        norm_f_sq = (l * (l**2 + 3 * h**2)) / (6 * h)\n        norm_f = np.sqrt(norm_f_sq)  # Units: m\n\n        # Derived formula for the squared L2 norm of the surface divergence\n        # ||div_s(f_e)||_L2^2 = 4*l/h\n        # Units: m/m = dimensionless\n        norm_div_f_sq = 4 * l / h\n        norm_div_f = np.sqrt(norm_div_f_sq) # Units: dimensionless\n\n        # L2-normalizing diagonal scaling\n        # s_diag = 1 / ||f_e||_L2\n        # Units: m^-1\n        s_diag = 1.0 / norm_f\n\n        # Geometric-mean diagonal scaling\n        # s_gm = 1 / sqrt(||f_e||_L2 * ||div_s(f_e)||_L2)\n        # Units: (m * dimensionless)^(-1/2) = m^(-1/2)\n        s_gm = 1.0 / np.sqrt(norm_f * norm_div_f)\n\n        # Store the results for the current case\n        case_results = [norm_f, norm_div_f, s_diag, s_gm]\n        all_results.append(case_results)\n\n    # Format the final output as a string representing a list of lists.\n    # Example: [[c1_v1, c1_v2, ...], [c2_v1, c2_v2, ...]]\n    output_str = \"[\" + \",\".join([str(res) for res in all_results]) + \"]\"\n\n    # Final print statement in the exact required format.\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n\n```", "id": "3344523"}]}