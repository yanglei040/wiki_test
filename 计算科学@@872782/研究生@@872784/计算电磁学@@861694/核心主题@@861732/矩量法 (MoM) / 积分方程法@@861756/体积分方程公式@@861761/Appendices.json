{"hands_on_practices": [{"introduction": "体积分方程（VIE）是求解开放区域电磁散射问题的有力工具，其核心在于正确描述波的传播行为。此练习旨在阐明索末菲辐射条件的重要性，它确保散射波从散射体向外传播。通过对比正确的出射格林函数与违反辐射条件的格林函数，以及模拟有限计算域截断引入的误差，您将亲手量化非物理反射，从而深刻理解为何以及如何正确地在数值模型中施加辐射条件。[@problem_id:3359707]", "problem": "考虑均匀背景中弱非均匀、各向同性电介质的电磁波频域散射，该问题通过体积分方程（VIE）进行描述。从频域中的麦克斯韦方程组出发，可以得到关于电场的Lippmann–Schwinger型体积分方程，其中并矢格林函数强制施加了Sommerfeld辐射条件。在一个能够捕捉基本行为同时在计算上可行的的一维简化模型中，我们研究了场 $u(x)$ 和背景波数 $k$ 的标量亥姆霍兹方程，其中紧支集磁化率分布 $\\chi(x)$ 代表了弱介电常数对比度。在第一次玻恩近似下，标量VIE可以写作\n$$\nu_{\\text{scat}}(x) \\approx k^2 \\int_{-\\infty}^{\\infty} \\chi(x')\\, u_{\\text{inc}}(x')\\, G(x - x')\\, \\mathrm{d}x',\n$$\n其中 $u_{\\text{inc}}(x) = e^{i k x}$ 是入射平面波，$G(\\cdot)$ 是与一维亥姆霍兹算子相关的标量格林函数。为正确施加Sommerfeld辐射条件，需要使用外行基本解\n$$\nG_{\\text{out}}(x) = \\frac{i}{2k}\\, e^{i k |x|},\n$$\n该解满足 $\\frac{\\mathrm{d}^2 G}{\\mathrm{d}x^2} + k^2 G = -\\delta(x)$ 并且从源向外辐射。通过取外行解的实部，可以构造一个非辐射（驻波）的选择，即\n$$\nG_{\\text{stand}}(x) = \\operatorname{Re}\\left(\\frac{i}{2k} e^{i k |x|}\\right) = -\\frac{1}{2k}\\, \\sin(k |x|),\n$$\n该解在分布意义上也满足 $\\frac{\\mathrm{d}^2 G}{\\mathrm{d}x^2} + k^2 G = -\\delta(x)$，但它通过叠加入射和出射分量违反了辐射条件。\n\n在数值实践中，人们常常截断计算域或应用加窗近似来加速VIE算子的计算。这种有限域截断可以通过施加周期为 $L_{\\text{box}}$ 的周期性镜像来模拟，实际上是将自由空间格林函数替换为周期性镜像求和\n$$\nG_{\\text{per}}(x;\\,L_{\\text{box}},P) = \\sum_{p=-P}^{P} G_{\\text{out}}(x + p L_{\\text{box}}),\n$$\n这会引入来自散射体镜像的伪相互作用，并可能在观测区域中表现为人为的入射波（反射）。\n\n您的任务是实现一个程序，该程序：\n1. 将磁化率离散化为一个高斯函数，\n$$\n\\chi(x) = \\chi_0 \\exp\\left(-\\frac{x^2}{2 \\sigma^2}\\right),\n$$\n其数值支撑域为有限区间 $[-L_{\\text{scat}}/2,\\, L_{\\text{scat}}/2]$（单位为米），使用均匀网格间距 $\\Delta x$。\n2. 在右侧观测窗口 $x \\in [x_{\\min}, x_{\\max}]$ 上，使用三种算子选择来计算散射场 $u_{\\text{scat}}(x)$：\n   - 外行自由空间格林函数 $G_{\\text{out}}$（强制施加辐射条件）。\n   - 驻波格林函数 $G_{\\text{stand}}$（违反辐射条件）。\n   - 具有指定 $L_{\\text{box}}$ 和镜像数量 $P$ 的外行周期性镜像求和 $G_{\\text{per}}$（有限域截断）。\n3. 通过将观测窗口上的散射场拟合到一个双模模型，来量化右侧的伪反射，\n$$\nu_{\\text{scat}}(x) \\approx A_{\\text{out}}\\, e^{i k x} + A_{\\text{in}}\\, e^{-i k x},\n$$\n通过复数最小二乘法，并输出反射比\n$$\nr = \\frac{|A_{\\text{in}}|}{|A_{\\text{out}}|},\n$$\n一个无量纲浮点数。该比率分离出了对应于从右侧 $+\\infty$ 处传来的入射波分量。\n\n除非在测试案例中另有规定，否则使用以下固定的物理和数值设置：距离单位为米，波数单位为弧度/米。设背景波数为 $k = 10$ (弧度/米)。使用 $\\chi_0 = 0.05$ (无量纲)，$\\sigma = 0.2$ 米，$L_{\\text{scat}} = 2.0$ 米，$\\Delta x = 0.002$ 米，$x_{\\min} = 5.0$ 米，$x_{\\max} = 6.0$ 米，并以与 $\\Delta x$ 兼容的分辨率对观测窗口进行均匀采样。\n\n设计一个鲁棒且数值稳定的算法，该算法能够：\n- 通过对所选格林函数在 $|x - x'|$上进行向量化计算，乘以 $k^2 \\chi(x') u_{\\text{inc}}(x') \\Delta x$，并对所有源点 $x'$ 求和，来构建离散玻恩算子。\n- 对于周期性镜像情况，使用在 $(x - x') + p L_{\\text{box}}$ 处计算的外行核在镜像 $p = -P,\\ldots,P$ 上的求和，来模拟有限域截断。\n- 执行复数最小二乘拟合以估计 $A_{\\text{out}}$ 和 $A_{\\text{in}}$，并返回 $r$。\n\n测试套件与输出规范：\n计算并报告以下四个测试案例的反射比 $r$，这些案例旨在探究辐射条件的强制执行情况以及有限域截断的影响：\n\n- 案例1（理想情况，强制施加辐射条件）：$G = G_{\\text{out}}$。\n- 案例2（违反辐射条件）：$G = G_{\\text{stand}}$。\n- 案例3（有限域截断，轻微）：$G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 20.0$ 米，$P = 1$。\n- 案例4（有限域截断，严重）：$G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 8.0$ 米，$P = 3$。\n\n您的程序的最终输出必须是单行文本，其中包含四个反射比，形式为方括号内以逗号分隔的列表，例如，\n$$\n[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4],\n$$\n其中每个 $\\text{r}_j$ 均报告为无量纲浮点数。不应打印任何额外文本。全文中角度以弧度度量，距离以米度量；输出的比率为无量纲，无需单位转换或舍入到特定有效数字位数，但必须是有效的浮点值。", "solution": "首先评估用户问题的有效性。\n\n### 步骤1：提取已知条件\n- **控制方程**：在第一次玻恩近似下，散射场 $u_{\\text{scat}}(x)$ 的标量体积分方程（VIE）由 $u_{\\text{scat}}(x) \\approx k^2 \\int_{-\\infty}^{\\infty} \\chi(x')\\, u_{\\text{inc}}(x')\\, G(x - x')\\, \\mathrm{d}x'$ 给出。\n- **入射场**：入射平面波为 $u_{\\text{inc}}(x) = e^{i k x}$。\n- **磁化率**：磁化率分布为高斯函数 $\\chi(x) = \\chi_0 \\exp\\!\\left(-\\frac{x^2}{2 \\sigma^2}\\right)$，其数值支撑域为区间 $[-L_{\\text{scat}}/2,\\, L_{\\text{scat}}/2]$。\n- **格林函数**：\n    1. 外行（自由空间）：$G_{\\text{out}}(x) = \\frac{i}{2k}\\, e^{i k |x|}$。\n    2. 驻波：$G_{\\text{stand}}(x) = -\\frac{1}{2k}\\, \\sin(k |x|)$。\n    3. 周期性（用于模拟域截断）：$G_{\\text{per}}(x;\\,L_{\\text{box}},P) = \\sum_{p=-P}^{P} G_{\\text{out}}(x + p L_{\\text{box}})$。\n- **分析模型**：观测窗口中的散射场被拟合到模型 $u_{\\text{scat}}(x) \\approx A_{\\text{out}}\\, e^{i k x} + A_{\\text{in}}\\, e^{-i k x}$。\n- **待计算量**：反射比 $r = \\frac{|A_{\\text{in}}|}{|A_{\\text{out}}|}$。\n- **物理和数值参数**：\n    - 背景波数：$k = 10$ rad/m。\n    - 磁化率峰值：$\\chi_0 = 0.05$。\n    - 高斯宽度：$\\sigma = 0.2$ m。\n    - 散射体支撑长度：$L_{\\text{scat}} = 2.0$ m。\n    - 网格间距：$\\Delta x = 0.002$ m。\n    - 观测窗口：$[x_{\\min}, x_{\\max}] = [5.0, 6.0]$ m。\n- **测试案例**：\n    1. $G = G_{\\text{out}}$。\n    2. $G = G_{\\text{stand}}$。\n    3. $G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 20.0$ m, $P = 1$。\n    4. $G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 8.0$ m, $P = 3$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上基于波散射理论和计算电磁学的原理。其数学表述，包括Lippmann-Schwinger方程、亥姆霍兹格林函数和玻恩近似，是标准且正确的。该问题是适定的，提供了构建数值解所需的所有必要参数和定义。语言客观而精确。测试案例旨在探究一个基本的物理概念——Sommerfeld辐射条件——和一个常见的数值 artifact，使该问题成为一个有意义的练习，而不仅仅是简单的计算。参数在物理上是合理的，并且导向一个计算上可行的任务。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将开发一个解决方案。\n\n### 基于原理的解决方案设计\n\n该解决方案包括三个主要阶段：离散化体积分方程，针对不同的格林函数计算散射场，以及分析结果场以量化伪反射。\n\n**1. 积分方程的离散化**\n问题的核心是VIE，$u_{\\text{scat}}(x) \\approx \\int_{-\\infty}^{\\infty} G(x - x')\\, J(x')\\, \\mathrm{d}x'$，其中我们将源密度定义为 $J(x') = k^2 \\chi(x') u_{\\text{inc}}(x')$。为了数值求解，我们采用标准的矩量法，并结合点匹配（配置）和脉冲基函数，这可以简化为一个黎曼和。\n\n首先，我们定义两个离散网格：\n- 一个源网格 $x'_j$，用于采样散射体区域 $[-L_{\\text{scat}}/2, L_{\\text{scat}}/2]$。这些点以步长 $\\Delta x = 0.002$ m 均匀分布。\n- 一个观测网格 $x_i$，用于采样观测窗口 $[x_{\\min}, x_{\\max}] = [5.0, 6.0]$ m，也使用间距 $\\Delta x$。\n\n连续积分近似为求和：\n$$\nu_{\\text{scat}}(x_i) \\approx \\sum_j G(x_i - x'_j)\\, J(x'_j)\\, \\Delta x\n$$\n这可以表示为矩阵向量乘积。设 $\\mathbf{u}_{\\text{scat}}$ 是在点 $x_i$ 处的散射场值的列向量，$\\mathbf{J}$ 是在点 $x'_j$ 处的源密度值 $J(x'_j)$ 的列向量。方程变为：\n$$\n\\mathbf{u}_{\\text{scat}} = \\mathbf{G} \\cdot \\mathbf{J} \\cdot \\Delta x\n$$\n其中 $\\mathbf{G}$ 是一个矩阵，其元素为 $G_{ij} = G(x_i - x'_j)$。\n\n**2. 构建算子矩阵 $\\mathbf{G}$**\n该算法为四个测试案例中的每一个计算一个不同的 $\\mathbf{G}$ 矩阵。\n\n- **案例1：外行格林函数 ($G_{\\text{out}}$)**\n    矩阵元素使用正确辐射解的公式填充：\n    $G_{ij} = G_{\\text{out}}(x_i - x'_j) = \\frac{i}{2k} e^{i k |x_i - x'_j|}$。在物理上，这确保了从任何源点 $x'_j$ 散射的能量都向外传播，远离源，从而满足Sommerfeld辐射条件。\n\n- **案例2：驻波格林函数 ($G_{\\text{stand}}$)**\n    矩阵元素使用非辐射核：\n    $G_{ij} = G_{\\text{stand}}(x_i - x'_j) = -\\frac{1}{2k} \\sin(k |x_i - x'_j|)$。\n    这个格林函数是 $G_{\\text{out}}$ 的实部，代表了一个出射波和一个等幅入射波的叠加。使用它违反了辐射条件，预计会产生一个带有显著非物理入射分量的散射场。\n\n- **案例3和4：周期性格林函数 ($G_{\\text{per}}$)**\n    这种表述模拟了将无限域截断为有限周期域的效果。矩阵元素通过对主源及其周期性镜像的贡献求和来计算：\n    $G_{ij} = G_{\\text{per}}(x_i - x'_j; L_{\\text{box}}, P) = \\sum_{p=-P}^{P} G_{\\text{out}}((x_i - x'_j) + p L_{\\text{box}})$。\n    每个 $p \\neq 0$ 的项代表与散射体的周期性副本之间的伪相互作用。这些相互作用表现为从与真实散射体辐射方向不一致的方向到达观测窗口的波，从而产生人为反射。案例3，周期较大（$L_{\\text{box}} = 20.0$ m），应显示出较小的反射。案例4，周期较小（$L_{\\text{box}} = 8.0$ m）且镜像更多，应显示出严重的反射 artifact。\n\n**3. 反射比的最小二乘分析**\n在计算出给定案例的离散散射场向量 $\\mathbf{u}_{\\text{scat}}$ 后，我们需要量化反射。观测窗口（位于散射体右侧的远场区）中的散射场被建模为一个右行（出射）波和一个左行（入射）波的叠加：\n$$\nu_{\\text{scat}}(x_i) \\approx A_{\\text{out}}\\, e^{i k x_i} + A_{\\text{in}}\\, e^{-i k x_i}\n$$\n这是一个关于未知复振幅 $A_{\\text{out}}$ 和 $A_{\\text{in}}$ 的线性模型。我们可以将其写成适用于所有观测点的线性系统 $\\mathbf{M} \\mathbf{a} \\approx \\mathbf{u}_{\\text{scat}}$，其中：\n- $\\mathbf{a} = [A_{\\text{out}}, A_{\\text{in}}]^T$ 是未知系数向量。\n- $\\mathbf{M}$ 是一个 $N_{\\text{obs}} \\times 2$ 的矩阵，其列是在观测点上求值的基函数，即 $M_{i1} = e^{i k x_i}$ 和 $M_{i2} = e^{-i k x_i}$。\n\n系数 $A_{\\text{out}}$ 和 $A_{\\text{in}}$ 通过在复数最小二乘意义上求解该系统来找到，这会最小化残差的范数 $||\\mathbf{M} \\mathbf{a} - \\mathbf{u}_{\\text{scat}}||^2$。为此使用了 `numpy.linalg.lstsq` 函数。\n\n最后，反射比 $r$ 计算为入射波和出射波振幅的幅值之比：\n$$\nr = \\frac{|A_{\\text{in}}|}{|A_{\\text{out}}|}\n$$\n该值提供了对违反辐射条件的定量度量。对于一个完美的出射波，$r = 0$。对于一个纯驻波，$r = 1$。周期性情况将根据伪反射的严重程度产生介于两者之间的值。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spurious reflection ratios for 1D electromagnetic scattering\n    using different Green's function formulations in a Volume Integral Equation.\n    \"\"\"\n\n    def calculate_reflection_ratio(G_type, G_params={}):\n        \"\"\"\n        Calculates the reflection ratio for a single numerical experiment.\n\n        Args:\n            G_type (str): The type of Green's function to use ('out', 'stand', 'per').\n            G_params (dict): Parameters for the Green's function, e.g., L_box and P.\n\n        Returns:\n            float: The computed reflection ratio r = |A_in| / |A_out|.\n        \"\"\"\n        # Define fixed physical and numerical settings\n        k = 10.0          # Wavenumber (rad/m)\n        chi0 = 0.05       # Peak susceptibility (dimensionless)\n        sigma = 0.2       # Gaussian width of susceptibility (m)\n        L_scat = 2.0      # Length of scatterer support (m)\n        dx = 0.002        # Grid spacing (m)\n        x_min_obs = 5.0   # Start of observation window (m)\n        x_max_obs = 6.0   # End of observation window (m)\n\n        # 1. Discretize domains\n        # Source grid (where the scatterer exists)\n        num_pts_scat = int(round(L_scat / dx)) + 1\n        x_prime = np.linspace(-L_scat / 2, L_scat / 2, num_pts_scat)\n\n        # Observation grid (where the scattered field is measured)\n        num_pts_obs = int(round((x_max_obs - x_min_obs) / dx)) + 1\n        x_obs = np.linspace(x_min_obs, x_max_obs, num_pts_obs)\n\n        # 2. Define the source density J(x') = k^2 * chi(x') * u_inc(x')\n        chi_profile = chi0 * np.exp(-x_prime**2 / (2 * sigma**2))\n        u_inc = np.exp(1j * k * x_prime)\n        source = k**2 * chi_profile * u_inc\n\n        # 3. Assemble the discrete Green's function operator matrix G\n        # G_ij = G(x_obs[i] - x_prime[j])\n        z = x_obs[:, None] - x_prime[None, :]\n\n        if G_type == 'out':\n            # Outgoing (radiating) Green's function\n            G_matrix = (1j / (2 * k)) * np.exp(1j * k * np.abs(z))\n        elif G_type == 'stand':\n            # Standing-wave (non-radiating) Green's function\n            G_matrix = (-1 / (2 * k)) * np.sin(k * np.abs(z))\n        elif G_type == 'per':\n            # Periodic sum of outgoing Green's functions\n            L_box = G_params['L_box']\n            P = G_params['P']\n            G_matrix = np.zeros_like(z, dtype=np.complex128)\n            p_range = np.arange(-P, P + 1)\n            for p in p_range:\n                z_shifted = z + p * L_box\n                G_matrix += (1j / (2 * k)) * np.exp(1j * k * np.abs(z_shifted))\n        else:\n            raise ValueError(f\"Unknown Green's function type: {G_type}\")\n\n        # 4. Compute the scattered field via discrete convolution\n        # u_scat = integral G(x-x') J(x') dx' -> sum_j G_ij * J_j * dx\n        u_scat = G_matrix @ source * dx\n\n        # 5. Perform least-squares fit to find A_out and A_in\n        # Model: u_scat(x) = A_out * exp(ikx) + A_in * exp(-ikx)\n        # This is a linear system: M * [A_out, A_in]^T = u_scat\n        M = np.stack([\n            np.exp(1j * k * x_obs),   # Basis function for outgoing wave\n            np.exp(-1j * k * x_obs)  # Basis function for incoming wave\n        ], axis=1)\n\n        # Solve for the coefficients [A_out, A_in]\n        coeffs, _, _, _ = np.linalg.lstsq(M, u_scat, rcond=None)\n        A_out, A_in = coeffs[0], coeffs[1]\n\n        # 6. Calculate the reflection ratio\n        # A_out should be non-zero for a non-trivial scatterer\n        if np.abs(A_out) == 0:\n            return np.inf if np.abs(A_in) > 0 else 0.0\n        \n        r = np.abs(A_in) / np.abs(A_out)\n        return r\n\n    # Define the test suite\n    test_cases = [\n        {'type': 'out', 'params': {}},\n        {'type': 'stand', 'params': {}},\n        {'type': 'per', 'params': {'L_box': 20.0, 'P': 1}},\n        {'type': 'per', 'params': {'L_box': 8.0, 'P': 3}}\n    ]\n\n    # Run all test cases and collect results\n    results = []\n    for case in test_cases:\n        ratio = calculate_reflection_ratio(case['type'], case['params'])\n        results.append(ratio)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3359707"}, {"introduction": "在确保了远场的物理真实性后，我们必须关注散射体内部场函数的离散化表示，因为不恰当的离散化会引入非物理的“伪解”。本练习通过一个简化的傅里叶域模型，揭示了使用简单的节点基函数与使用旋度协调的棱边基函数之间的本质区别。您将通过计算发现，不正确的离散化会导致伪谐振的产生，从而理解为何在电磁学的体积分方程和有限元方法中，坚持使用能够正确反映 $\\nabla \\times$ 算子内在结构的基函数是至关重要的。[@problem_id:3359681]", "problem": "考虑一个均匀各向同性夹杂物（电化率 $\\chi$）嵌入在波数为 $k_0$ 的均匀背景中，其对电场 $\\mathbf{E}(\\mathbf{r})$ 的时谐电磁散射问题。该问题所对应的频域矢量体积分方程（VIE）。从麦克斯韦方程组和极化本构关系出发，该VIE可以用标量亥姆霍兹格林卷积和梯度算子来表示。在边长为 $L$（单位为米）的周期性立方域内进行研究，场由离散傅里叶模式表示，这些模式由整数三元组 $\\mathbf{n} = (n_x,n_y,n_z)$ 索引，其中 $n_x,n_y,n_z \\in \\{-N/2,\\ldots,N/2-1\\}$（$N$ 为偶数）。定义相应的波矢量为 $\\mathbf{g} = \\frac{2\\pi}{L}\\mathbf{n}$，其模的平方为 $g^2 = \\lVert \\mathbf{g} \\rVert^2$。\n\n您的任务是在一个忠实于VIE结构的数学可控环境中，证明节点体离散化（不符合旋度算子）会产生伪谐振，而这种伪谐振在旋度协调的边元离散化中是不存在的。为此，请遵循以下步骤：\n\n- 从基本的麦克斯韦旋度-旋度方程、矢量亥姆霍兹算子和矢量Lippmann–Schwinger表示（这些在计算电磁学中都是标准且经过充分检验的）出发，在傅里叶域中为均匀夹杂物情况推导一个作用于每个傅里叶模式 $\\mathbf{g}$ 的算子符号。证明旋度协调的边元离散化等效于一个算子，该算子相对于 $\\mathbf{g}$ 在横向和纵向子空间上的作用不同。结论是，在这种公式中，纵向分量不是谐振的。\n\n- 构建一个“朴素的”节点离散化代理，该代理将积分核视为标量亥姆霍兹格林卷积乘以单位并矢，从而未能强制执行亥姆霍兹分解或任何 $\\nabla \\times$ 协调约束。在此代理下推导每模式算子符号，并证明它对横向和纵向分量的作用相同，从而在纵向子空间中产生额外的非物理（伪）谐振。\n\n- 对于一个大小为 $N \\times N \\times N$ 的周期性网格（$N$为偶数），如上定义整数三元组 $\\mathbf{n}$ 的集合，并令 $m(\\mathbf{n}) = n_x^2 + n_y^2 + n_z^2$。对于给定的 $k_0$ 和 $L$，引入无量纲参数 $s = \\left(\\frac{k_0 L}{2\\pi}\\right)^2$。使用您推导的算子符号：\n  1. 获得旋度协调边元算子的纵向特征值，记为 $\\lambda_L^{\\mathrm{edge}}$，作为 $\\chi$ 的函数。证明它不依赖于 $m(\\mathbf{n})$，并且对于 $\\chi > -1$ 不会产生谐振。\n  2. 获得朴素节点算子的纵向特征值，记为 $\\lambda_L^{\\mathrm{nodal}}(m)$，作为 $m(\\mathbf{n})$ 和 $\\chi$ 的函数，并确定使 $\\lambda_L^{\\mathrm{nodal}}(m)$ 消失（伪谐振）的 $m(\\mathbf{n})$ 条件。\n  3. 定义伪谐振计数 $\\Delta$ 为傅里叶模式（计算在指定范围内的所有整数三元组 $\\mathbf{n}$）的数量，对于这些模式，$\\lambda_L^{\\mathrm{nodal}}(m)$ 在数值上为零，而 $\\lambda_L^{\\mathrm{edge}}$ 在数值上不为零。使用带有容差 $\\tau$ 的严格数值零点测试；如果一个特征值的绝对值严格小于 $\\tau$，则将其视为零。\n\n- 物理和数值单位：$L$ 的单位为米，$k_0$ 的单位为弧度/米。角度以弧度为单位。电化率 $\\chi$ 是无量纲的。伪谐振计数 $\\Delta$ 是无单位的整数。\n\n- 实现一个程序，为下面的每个测试用例计算 $\\Delta$。使用所描述的精确整数格点。在构建每模式纵向特征值时，用 $m(\\mathbf{n})$ 和 $s$ 表示它们，以避免浮点抵消。对每个测试用例，使用给定的容差 $\\tau$ 进行严格零点测试。如果在节点纵向特征值公式中对某个 $m(\\mathbf{n})$ 出现分母为零的情况，则在进行零点测试时跳过该模式（它既不增加也不减少计数）。\n\n测试集（每个元组为 $(N,L,k_0,\\chi,\\tau)$）：\n\n- 情况 1： $(8,\\,1\\,\\text{m},\\,4\\pi\\,\\text{rad/m},\\,0.5,\\,10^{-12})$。\n- 情况 2： $(8,\\,1\\,\\text{m},\\,4\\pi\\,\\text{rad/m},\\,1.0,\\,10^{-12})$。\n- 情况 3： $(8,\\,1\\,\\text{m},\\,4\\pi\\,\\text{rad/m},\\,0.3,\\,10^{-12})$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3]”），每个结果是相应测试用例的整数 $\\Delta$，顺序与上面相同。每个报告的 $\\Delta$ 的预期单位是“计数”（无单位整数）。输出不得包含任何其他文本。", "solution": "该问题要求对电磁学中频域体积分方程（VIE）的两种不同离散化方法进行比较分析，特别是为了展示在朴素节点离散化中伪非物理谐振的出现。我们将首先在傅里叶域中推导旋度协调的边元离散化和朴素节点离散化的算子符号。随后，我们将推导伪谐振的条件，并实现一个程序来为给定的测试用例计算它们的数量。\n\n### 基本公式\n\n在波数为 $k_0$ 的背景中，嵌入一个电化率为 $\\chi$ 的均匀各向同性介电散射体，其中的时谐电场 $\\mathbf{E}(\\mathbf{r})$ 由Lippmann-Schwinger体积分方程描述。为分析系统的内在模式，忽略入射场，该方程为：\n$$ \\mathbf{E}(\\mathbf{r}) = k_0^2 \\chi \\int_V \\bar{\\mathbf{G}}_0(\\mathbf{r}, \\mathbf{r}') \\cdot \\mathbf{E}(\\mathbf{r}') \\, dV' $$\n其中 $\\bar{\\mathbf{G}}_0(\\mathbf{r}, \\mathbf{r}')$ 是背景介质的并矢格林函数，满足 $(\\nabla \\times \\nabla \\times - k_0^2 \\mathbf{I}) \\bar{\\mathbf{G}}_0 = \\mathbf{I} \\delta(\\mathbf{r}-\\mathbf{r}')$。在边长为 $L$ 的周期域中，我们在傅里叶域中工作，其中场和算子由它们的离散傅里叶级数系数表示。空间位置 $\\mathbf{r}$ 对应于一组由整数三元组 $\\mathbf{n} = (n_x, n_y, n_z)$ 索引的傅里叶模式，其对应的波矢量为 $\\mathbf{g} = \\frac{2\\pi}{L}\\mathbf{n}$。在傅里叶变换下，卷积变为乘积：\n$$ \\hat{\\mathbf{E}}(\\mathbf{g}) = k_0^2 \\chi \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g}) \\cdot \\hat{\\mathbf{E}}(\\mathbf{g}) $$\n这可以写成关于每个模式 $\\mathbf{g}$ 的齐次线性系统：\n$$ \\left[ \\mathbf{I} - k_0^2 \\chi \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g}) \\right] \\hat{\\mathbf{E}}(\\mathbf{g}) = \\mathbf{0} $$\n如果算子 $\\mathbf{A}(\\mathbf{g}) = \\mathbf{I} - k_0^2 \\chi \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g})$ 是奇异的，即它有零特征值，则存在非平凡解（谐振或模式）。\n\n### 旋度协调（边元）离散化算子\n\n旋度协调离散化能够正确表示麦克斯韦方程组的结构，它对应于使用完整的并矢格林函数。从矢量亥姆霍兹方程推导出的并矢格林函数的傅里叶变换是：\n$$ \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g}) = \\left( \\mathbf{I} + \\frac{1}{k_0^2} \\nabla\\nabla \\right) \\hat{G}_0(\\mathbf{g}) \\xrightarrow{\\mathcal{F}} \\left( \\mathbf{I} - \\frac{\\mathbf{g}\\mathbf{g}^T}{k_0^2} \\right) \\frac{1}{g^2 - k_0^2} $$\n其中 $g^2 = \\lVert\\mathbf{g}\\rVert^2$ 且 $\\mathbf{g}\\mathbf{g}^T$ 是外积并矢。注意，对于 $\\mathbf{g}=0$，此形式不确定，但我们考虑 $\\mathbf{g} \\neq \\mathbf{0}$。\n\n该算子对平行于 $\\mathbf{g}$ 的纵向矢量分量和垂直于 $\\mathbf{g}$ 的横向矢量分量的作用不同。令 $\\hat{\\mathbf{E}} = \\hat{\\mathbf{E}}_L + \\hat{\\mathbf{E}}_T$。\n对于横向矢量 $\\hat{\\mathbf{E}}_T$（其中 $\\mathbf{g} \\cdot \\hat{\\mathbf{E}}_T = 0$）：\n$$ \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g}) \\cdot \\hat{\\mathbf{E}}_T = \\frac{1}{g^2 - k_0^2} \\left( \\mathbf{I} - \\frac{\\mathbf{g}\\mathbf{g}^T}{k_0^2} \\right) \\hat{\\mathbf{E}}_T = \\frac{1}{g^2 - k_0^2} (\\hat{\\mathbf{E}}_T - \\mathbf{0}) = \\frac{1}{g^2 - k_0^2} \\hat{\\mathbf{E}}_T $$\n对于纵向矢量 $\\hat{\\mathbf{E}}_L$（其中 $\\hat{\\mathbf{E}}_L = \\alpha \\mathbf{g}$ 对于某个标量 $\\alpha$）：\n$$ \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g}) \\cdot \\hat{\\mathbf{E}}_L = \\frac{1}{g^2 - k_0^2} \\left( \\mathbf{I} - \\frac{\\mathbf{g}\\mathbf{g}^T}{k_0^2} \\right) \\hat{\\mathbf{E}}_L = \\frac{1}{g^2 - k_0^2}} \\left(\\hat{\\mathbf{E}}_L - \\frac{\\mathbf{g}(\\mathbf{g} \\cdot \\hat{\\mathbf{E}}_L)}{k_0^2}\\right) = \\frac{1}{g^2 - k_0^2} \\left(\\hat{\\mathbf{E}}_L - \\frac{g^2}{k_0^2}\\hat{\\mathbf{E}}_L\\right) = \\frac{1 - g^2/k_0^2}{g^2 - k_0^2} \\hat{\\mathbf{E}}_L = -\\frac{1}{k_0^2} \\hat{\\mathbf{E}}_L $$\n因此，这种旋度协调公式的系统算子 $\\mathbf{A}^{\\mathrm{edge}}(\\mathbf{g}) = \\mathbf{I} - k_0^2 \\chi \\hat{\\bar{\\mathbf{G}}}_0(\\mathbf{g})$ 对每个子空间有不同的特征值。所要求的纵向特征值 $\\lambda_L^{\\mathrm{edge}}$ 是：\n$$ \\lambda_L^{\\mathrm{edge}} = 1 - k_0^2 \\chi \\left( -\\frac{1}{k_0^2} \\right) = 1 + \\chi $$\n此特征值仅依赖于材料电化率 $\\chi$，而不依赖于模式指数 $\\mathbf{n}$（或 $m(\\mathbf{n})$）。如果 $\\lambda_L^{\\mathrm{edge}} = 0$，即 $\\chi = -1$，则发生谐振。对于问题中指定的任何 $\\chi > -1$，$\\lambda_L^{\\mathrm{edge}} \\neq 0$。因此，该公式正确地预测了没有非物理（伪）纵向谐振。\n\n### 朴素节点离散化算子\n\n“朴素的”节点离散化未能遵循旋度协调的结构。问题通过将积分核视为标量格林函数 $G_0$ 乘以单位并矢 $\\mathbf{I}$ 来对此进行建模。这个代理格林函数是 $\\bar{\\mathbf{G}}_{\\text{naive}} = G_0 \\mathbf{I}$。在傅里叶域中，这变为：\n$$ \\hat{\\bar{\\mathbf{G}}}_{\\text{naive}}(\\mathbf{g}) = \\hat{G}_0(\\mathbf{g}) \\mathbf{I} = \\frac{1}{g^2 - k_0^2} \\mathbf{I} $$\n该算子是单位并矢 $\\mathbf{I}$ 的标量倍数，意味着它对所有矢量分量的作用相同，无论它们相对于 $\\mathbf{g}$ 的方向如何。朴素公式的系统算子是：\n$$ \\mathbf{A}^{\\mathrm{nodal}}(\\mathbf{g}) = \\mathbf{I} - k_0^2 \\chi \\hat{\\bar{\\mathbf{G}}}_{\\text{naive}}(\\mathbf{g}) = \\left( 1 - \\frac{k_0^2 \\chi}{g^2 - k_0^2} \\right) \\mathbf{I} $$\n该算子有一个简并特征值，适用于横向和纵向分量。因此，纵向特征值为：\n$$ \\lambda_L^{\\mathrm{nodal}}(\\mathbf{g}) = 1 - \\frac{k_0^2 \\chi}{g^2 - k_0^2} $$\n为了用问题的无量纲参数表示它，我们使用 $g^2 = \\left(\\frac{2\\pi}{L}\\right)^2 m(\\mathbf{n})$ 和 $k_0^2 = s \\left(\\frac{2\\pi}{L}\\right)^2$，其中 $m(\\mathbf{n})=n_x^2+n_y^2+n_z^2$ 和 $s = \\left(\\frac{k_0 L}{2\\pi}\\right)^2$。\n$$ \\lambda_L^{\\mathrm{nodal}}(m) = 1 - \\frac{s \\left(\\frac{2\\pi}{L}\\right)^2 \\chi}{m(\\mathbf{n}) \\left(\\frac{2\\pi}{L}\\right)^2 - s \\left(\\frac{2\\pi}{L}\\right)^2} = 1 - \\frac{s\\chi}{m(\\mathbf{n}) - s} = \\frac{m(\\mathbf{n}) - s(1+\\chi)}{m(\\mathbf{n}) - s} $$\n\n### 伪谐振条件与计数\n\n当 $\\lambda_L^{\\mathrm{nodal}}(m) = 0$ 时，会出现伪纵向谐振。根据上面的表达式，这要求分子为零（且分母不为零）：\n$$ m(\\mathbf{n}) - s(1+\\chi) = 0 \\implies m(\\mathbf{n}) = s(1+\\chi) $$\n由于 $m(\\mathbf{n})$ 是三个整数平方的和，它必须是一个整数。因此，只有当 $s(1+\\chi)$ 的值是整数时，才会发生伪谐振。\n\n任务是计算伪谐振计数 $\\Delta$，定义为傅里叶模式 $\\mathbf{n}$ 的数量，对于这些模式，$\\lambda_L^{\\mathrm{nodal}}$ 在数值上为零，而 $\\lambda_L^{\\mathrm{edge}}$ 不为零。对于给定的 $\\chi > 0$ 的测试用例，$\\lambda_L^{\\mathrm{edge}} = 1+\\chi$ 永远不为零。因此，我们只需要计算 $|\\lambda_L^{\\mathrm{nodal}}(m(\\mathbf{n}))| < \\tau$ 的模式数量。鉴于 $m(\\mathbf{n})$ 是整数，这个条件实际上只有在 $m(\\mathbf{n})$ 等于 $s(1+\\chi)$ 所代表的某个整数值时才能满足。\n\n计算步骤如下：\n1. 对于给定的测试用例 $(N, L, k_0, \\chi, \\tau)$，计算 $s = \\left(\\frac{k_0 L}{2\\pi}\\right)^2$。\n2. 计算谐振目标值 $M_{\\text{res}} = s(1+\\chi)$。\n3. 如果 $M_{\\text{res}}$ 不是整数（即 $|M_{\\text{res}} - \\text{round}(M_{\\text{res}})| \\ge \\tau$），则没有整数 $m(\\mathbf{n})$ 能满足谐振条件，因此 $\\Delta = 0$。\n4. 如果 $M_{\\text{res}}$ 在数值上是一个整数，令这个整数为 $M_{\\text{target}} = \\text{round}(M_{\\text{res}})$。然后我们计数所有分量在 $\\{-N/2, \\dots, N/2-1\\}$ 内的整数三元组 $\\mathbf{n}=(n_x, n_y, n_z)$，使得：\n   a. $m(\\mathbf{n}) = n_x^2 + n_y^2 + n_z^2 = M_{\\text{target}}$。\n   b. 满足分母条件 $m(\\mathbf{n}) - s \\neq 0$。如果 $M_{\\text{target}} = s$，即使这些模式谐振，它们也不会被计数；然而，对于 $\\chi>0$，$M_{\\text{target}} = s(1+\\chi) > s$，因此对于谐振模式，这个排除条件不会触发。我们必须在检查期间排除任何 $m(\\mathbf{n})=s$ 的非谐振模式。\n\n这个过程正确地识别并计数了由朴素离散化引入的伪模式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spurious resonance count Delta for each test case.\n    \"\"\"\n    # Test suite (each tuple is (N, L, k_0, chi, tau)):\n    test_cases = [\n        # Case 1: (8, 1 m, 4*pi rad/m, 0.5, 1e-12)\n        (8, 1.0, 4.0 * np.pi, 0.5, 1e-12),\n        # Case 2: (8, 1 m, 4*pi rad/m, 1.0, 1e-12)\n        (8, 1.0, 4.0 * np.pi, 1.0, 1e-12),\n        # Case 3: (8, 1 m, 4*pi rad/m, 0.3, 1e-12)\n        (8, 1.0, 4.0 * np.pi, 0.3, 1e-12),\n    ]\n\n    results = []\n    for N, L, k0, chi, tau in test_cases:\n        # Calculate the dimensionless parameter s\n        s = (k0 * L / (2.0 * np.pi))**2\n\n        # Calculate the target m_res value for spurious resonance from m - s(1+chi) = 0\n        m_res_target = s * (1.0 + chi)\n\n        delta_count = 0\n\n        # Check if m_res_target is numerically an integer.\n        # If not, no integer m(n) can cause a resonance, so the count is 0.\n        # A small tolerance is used for this floating-point comparison.\n        m_target_int = int(round(m_res_target))\n        if abs(m_res_target - m_target_int)  tau:\n            # m_res_target is an integer. We now count the modes n for which m(n) = m_target_int.\n            \n            # The edge-based longitudinal eigenvalue lambda_L^edge = 1 + chi.\n            # For chi > -1, this is never zero. The problem statement's chi values are all positive.\n            # We must check |1 + chi| >= tau, which holds for all test cases.\n            if abs(1.0 + chi)  tau:\n                # This case is not expected but included for completeness.\n                # If lambda_L^edge is also zero, it's not a spurious resonance.\n                results.append(0)\n                continue\n\n            # Define the range for integer indices n_x, n_y, n_z\n            # For even N, range is {-N/2, ..., N/2 - 1}\n            idx_min = -N // 2\n            idx_max = N // 2\n            idx_range = range(idx_min, idx_max)\n            \n            count_for_case = 0\n            for nx in idx_range:\n                for ny in idx_range:\n                    for nz in idx_range:\n                        m_n = nx**2 + ny**2 + nz**2\n\n                        # Per problem statement, skip modes where the denominator (m-s) is zero.\n                        # Using a small tolerance for floating point comparison.\n                        if abs(m_n - s)  1e-9:\n                            continue\n\n                        # Check if m_n matches the integer target for resonance.\n                        if m_n == m_target_int:\n                            # This mode exhibits a spurious resonance.\n                            count_for_case += 1\n            \n            delta_count = count_for_case\n        else:\n            # m_res_target is not an integer, so no integer m(n) can match it.\n            delta_count = 0\n            \n        results.append(delta_count)\n\n    # Format the final output as a single line: a comma-separated list in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3359681"}, {"introduction": "选择了正确的格林函数和基函数后，实现体积分方程方法的最大挑战之一是处理格林函数带来的奇异性，尤其是在计算自相互作用项时。这些积分如果处理不当，会严重影响计算精度。本练习将指导您应用Duffy变换这一强大的数学工具，将奇异积分转化为光滑、易于数值计算的形式。通过亲手实现并验证这一过程，您将掌握精确计算VIE系统矩阵元素的关键数值技术。[@problem_id:3359660]", "problem": "考虑自由空间中的时谐麦克斯韦方程组以及相关的自由空间二元格林函数。自由空间标量格林函数定义为 $g_k(\\mathbf{r}) = \\dfrac{e^{ik\\|\\mathbf{r}\\|}}{4\\pi\\|\\mathbf{r}\\|}$，在静态极限 $k \\to 0$ 时，它简化为 $g_0(\\mathbf{r}) = \\dfrac{1}{4\\pi\\|\\mathbf{r}\\|}$。自由空间二元格林函数由 $\\mathbf{G}_k(\\mathbf{r}) = \\left(\\mathbf{I} + \\dfrac{1}{k^2}\\nabla\\nabla\\right) g_k(\\mathbf{r})$ 给出，其中 $\\mathbf{I}$ 是单位二元矢量，$\\nabla\\nabla$ 表示海森算子。在体积分方程的公式中，当源点 $\\mathbf{r}_0$ 位于四面体单元 $T$ 内部时，会出现形如 $\\displaystyle \\int_T g_0(\\mathbf{r}-\\mathbf{r}_0)\\,\\mathrm{d}V$ 的积分以及在 $T$ 上对 $\\nabla\\nabla g_0$ 的二元运算，这会导致在 $\\mathbf{r}=\\mathbf{r}_0$ 处出现弱奇异性和结构化奇异性。\n\n您的任务是在四面体单元上实现 Duffy 变换，以对自含项（源点位于顶点）的标量核 $g_0(\\mathbf{r})$ 的弱奇异积分进行正则化。具体来说，处理一个由顶点 $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3)$ 定义的四面体 $T$，其奇异点位于顶点 $\\mathbf{v}_0$，边为 $\\mathbf{a}_1=\\mathbf{v}_1-\\mathbf{v}_0$，$\\mathbf{a}_2=\\mathbf{v}_2-\\mathbf{v}_0$，$\\mathbf{a}_3=\\mathbf{v}_3-\\mathbf{v}_0$。使用 Duffy 映射\n$$\n\\mathbf{r}(u,v,w) = \\mathbf{v}_0 + u\\,\\mathbf{a}_1 + u\\,v\\,\\mathbf{a}_2 + u\\,v\\,w\\,\\mathbf{a}_3,\n$$\n其中 $u\\in[0,1]$，$v\\in[0,1]$，$w\\in[0,1]$，以及雅可比行列式\n$$\nJ(u,v,w) = u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|.\n$$\n令 $\\mathbf{s}(v,w) = \\mathbf{a}_1 + v\\,\\mathbf{a}_2 + v\\,w\\,\\mathbf{a}_3$，因此 $\\|\\mathbf{r}-\\mathbf{v}_0\\| = u\\,\\|\\mathbf{s}(v,w)\\|$。\n\n1) 从第一性原理推导在静态极限下标量核在 $T$ 上的正则化积分，\n$$\nI_{\\text{full}} = \\int_T g_0(\\mathbf{r}-\\mathbf{v}_0)\\,\\mathrm{d}V,\n$$\n证明在 Duffy 变换下，该积分变为 $[0,1]^3$ 上的光滑积分，并明确地用 $u$、$v$、$w$、$\\mathbf{s}(v,w)$ 和 $\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|$ 表示被积函数。\n\n2) 考虑通过排除 $\\mathbf{v}_0$ 周围半径为 $\\varepsilon$ 的小球邻域，并仅在由射线 $\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3$ 定义的三面角锥上积分得到的解析自含项。令 $\\hat{\\mathbf{a}}_i = \\mathbf{a}_i / \\|\\mathbf{a}_i\\|$ 为定义顶点处三面角锥的单位方向向量。该角锥的立体角为\n$$\n\\Omega = 2\\,\\arctan\\!\\left(\\frac{\\left|\\det\\left[\\hat{\\mathbf{a}}_1\\ \\hat{\\mathbf{a}}_2\\ \\hat{\\mathbf{a}}_3\\right]\\right|}{1 + \\hat{\\mathbf{a}}_1\\cdot\\hat{\\mathbf{a}}_2 + \\hat{\\mathbf{a}}_2\\cdot\\hat{\\mathbf{a}}_3 + \\hat{\\mathbf{a}}_3\\cdot\\hat{\\mathbf{a}}_1}\\right),\n$$\n角度以弧度为单位。证明在被排除的球形区域与三面角锥相交部分内，标量核的解析自含项为\n$$\nI_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\frac{\\varepsilon^2}{2}\\,\\frac{\\Omega}{4\\pi}.\n$$\n\n3) 使用 Duffy 变换，将三面角锥内满足 $\\|\\mathbf{r}-\\mathbf{v}_0\\| \\le \\varepsilon$ 的区域的贡献表示为数值积分\n$$\nI_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) = \\int_0^1\\!\\!\\int_0^1 \\left[\\int_0^{u_{\\max}(v,w)} \\frac{1}{4\\pi u\\|\\mathbf{s}(v,w)\\|}\\, u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|\\,\\mathrm{d}u \\right] \\mathrm{d}v\\,\\mathrm{d}w,\n$$\n其中 $u_{\\max}(v,w) = \\min\\!\\left(1,\\,\\dfrac{\\varepsilon}{\\|\\mathbf{s}(v,w)\\|}\\right)$。简化关于 $u$ 的内层积分，以获得一个便于数值计算的表达式。类似地，写出\n$$\nI_{\\text{rest}}^{\\text{numeric}}(\\varepsilon) = \\int_0^1\\!\\!\\int_0^1 \\left[\\int_{u_{\\max}(v,w)}^{1} \\frac{1}{4\\pi u\\|\\mathbf{s}(v,w)\\|}\\, u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|\\,\\mathrm{d}u \\right] \\mathrm{d}v\\,\\mathrm{d}w,\n$$\n并对较小的 $\\varepsilon$ 数值验证 $I_{\\text{full}} \\approx I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$ 具有高精度。\n\n您的程序必须使用映射到 $[0,1]$ 的高斯-勒让德法则在 $v$ 和 $w$ 上实现高阶数值积分，并使用推导出的表达式在 Duffy 正则化后解析地执行 $u$ 积分。\n\n测试套件：\n使用以下四面体和排除半径 $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3,\\varepsilon)$：\n- 情况1（类正四面体）：\n  - $\\mathbf{v}_0 = (0,0,0)$,\n  - $\\mathbf{v}_1 = (1,0,0)$,\n  - $\\mathbf{v}_2 = \\left(\\dfrac{1}{2}, \\dfrac{\\sqrt{3}}{2}, 0\\right)$,\n  - $\\mathbf{v}_3 = \\left(\\dfrac{1}{2}, \\dfrac{\\sqrt{3}}{6}, \\sqrt{\\dfrac{2}{3}}\\right)$,\n  - $\\varepsilon = 0.05$。\n- 情况2（扭曲四面体）：\n  - $\\mathbf{v}_0 = (0,0,0)$,\n  - $\\mathbf{v}_1 = (2.0, 0.1, 0.0)$,\n  - $\\mathbf{v}_2 = (0.2, 1.5, -0.1)$,\n  - $\\mathbf{v}_3 = (-0.1, 0.3, 0.9)$,\n  - $\\varepsilon = 0.02$。\n- 情况3（小四面体）：\n  - $\\mathbf{v}_0 = (0,0,0)$,\n  - $\\mathbf{v}_1 = (10^{-3}, 0, 0)$,\n  - $\\mathbf{v}_2 = (0, 10^{-3}, 0)$,\n  - $\\mathbf{v}_3 = (0, 0, 2\\cdot 10^{-3})$,\n  - $\\varepsilon = 10^{-5}$。\n\n最终输出：\n您的程序应生成单行输出，包含六个浮点数，按顺序对应每种情况的绝对误差：\n$[E_{1}^{(1)},E_{2}^{(1)},E_{1}^{(2)},E_{2}^{(2)},E_{1}^{(3)},E_{2}^{(3)}]$，\n其中对于情况 $i$，\n- $E_{1}^{(i)} = \\left|I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) - I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon)\\right|$，\n- $E_{2}^{(i)} = \\left|I_{\\text{full}} - \\left(I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)\\right)\\right|$。\n所有角度必须以弧度处理。不需要物理单位；所有量都是由所选坐标和 $\\varepsilon$ 产生的无量纲值。您的程序应生成单行输出，包含用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,...]”）。", "solution": "在进行求解之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n- **标量格林函数（静态极限）**：$g_0(\\mathbf{r}) = \\dfrac{1}{4\\pi\\|\\mathbf{r}\\|}$。\n- **待评估的积分**：$I_{\\text{full}} = \\displaystyle \\int_T g_0(\\mathbf{r}-\\mathbf{v}_0)\\,\\mathrm{d}V$，其中 $T$ 是一个顶点为 $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3)$ 的四面体，奇异点位于 $\\mathbf{v}_0$。\n- **边向量**：$\\mathbf{a}_1=\\mathbf{v}_1-\\mathbf{v}_0$，$\\mathbf{a}_2=\\mathbf{v}_2-\\mathbf{v}_0$，$\\mathbf{a}_3=\\mathbf{v}_3-\\mathbf{v}_0$。\n- **Duffy 映射**：$\\mathbf{r}(u,v,w) = \\mathbf{v}_0 + u\\,\\mathbf{a}_1 + u\\,v\\,\\mathbf{a}_2 + u\\,v\\,w\\,\\mathbf{a}_3$，对于 $u,v,w \\in[0,1]$。\n- **雅可比行列式**：$J(u,v,w) = u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|$。\n- **辅助向量和距离**：$\\mathbf{s}(v,w) = \\mathbf{a}_1 + v\\,\\mathbf{a}_2 + v\\,w\\,\\mathbf{a}_3$，使得 $\\|\\mathbf{r}-\\mathbf{v}_0\\| = u\\,\\|\\mathbf{s}(v,w)\\|$。\n- **立体角公式**：$\\Omega = 2\\,\\arctan\\!\\left(\\frac{\\left|\\det\\left[\\hat{\\mathbf{a}}_1\\ \\hat{\\mathbf{a}}_2\\ \\hat{\\mathbf{a}}_3\\right]\\right|}{1 + \\hat{\\mathbf{a}}_1\\cdot\\hat{\\mathbf{a}}_2 + \\hat{\\mathbf{a}}_2\\cdot\\hat{\\mathbf{a}}_3 + \\hat{\\mathbf{a}}_3\\cdot\\hat{\\mathbf{a}}_1}\\right)$，其中 $\\hat{\\mathbf{a}}_i = \\mathbf{a}_i / \\|\\mathbf{a}_i\\|$。\n- **解析自含项**：$I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\frac{\\varepsilon^2}{2}\\,\\frac{\\Omega}{4\\pi}$。\n- **数值积分定义**：$I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon)$ 和 $I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$ 在由 $u_{\\max}(v,w) = \\min\\!\\left(1,\\,\\dfrac{\\varepsilon}{\\|\\mathbf{s}(v,w)\\|}\\right)$ 定义的子域上。\n- **测试用例和误差度量**：提供了三组四面体顶点和排除半径 $\\varepsilon$。需要计算两个误差度量 $E_{1}$ 和 $E_{2}$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题陈述进行分析。\n- **科学依据**：该问题基于计算电磁学的既定原理，特别是边界元法和体积分方程。Duffy 变换是正则化单纯形上奇异积分的一种标准的、数学上可靠的技术。格林函数和立体角的公式是正确的。\n- **适定性**：所有必要的信息都已提供。定义、变换和目标清晰、精确，并导向一个唯一的、可计算的解。\n- **客观性**：语言是正式且无偏见的。该问题需要数学推导和数值计算，而非主观解释。\n\n未发现任何缺陷。该问题是完整的、一致的且科学上有效的。\n\n### 步骤3：结论与行动\n该问题被判定为 **有效**。将提供完整解答。\n\n### 求解推导与数值策略\n\n解答分为三部分，对应问题陈述中概述的任务。\n\n**第1部分：使用 Duffy 变换对全积分进行正则化**\n\n目标是正则化弱奇异积分\n$$\nI_{\\text{full}} = \\int_T g_0(\\mathbf{r}-\\mathbf{v}_0)\\,\\mathrm{d}V = \\int_T \\frac{1}{4\\pi\\|\\mathbf{r}-\\mathbf{v}_0\\|}\\,\\mathrm{d}V.\n$$\n奇异性发生在 $\\mathbf{r} = \\mathbf{v}_0$ 处，此时分母为零。我们应用给定的 Duffy 坐标变换，将 $(\\mathbf{r})$ 空间中的四面体 $T$ 映射到 $(u,v,w)$ 空间中的单位立方体 $[0,1]^3$。\n变换为 $\\mathbf{r}(u,v,w) = \\mathbf{v}_0 + u\\,\\mathbf{a}_1 + u\\,v\\,\\mathbf{a}_2 + u\\,v\\,w\\,\\mathbf{a}_3$。\n相对于奇异点的位置向量为 $\\mathbf{r}-\\mathbf{v}_0 = u(\\mathbf{a}_1 + v\\,\\mathbf{a}_2 + v\\,w\\,\\mathbf{a}_3) = u\\,\\mathbf{s}(v,w)$。\n因此，到奇异点的距离为 $\\|\\mathbf{r}-\\mathbf{v}_0\\| = u\\,\\|\\mathbf{s}(v,w)\\|$，对于 $u \\ge 0$。\n微分体积元根据 $\\mathrm{d}V = |J(u,v,w)|\\,\\mathrm{d}u\\,\\mathrm{d}v\\,\\mathrm{d}w$ 进行变换，其中雅可比行列式由 $J(u,v,w) = u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|$ 给出。在积分域上它为非负值。\n\n将这些代入积分表达式：\n$$\nI_{\\text{full}} = \\int_0^1 \\int_0^1 \\int_0^1 \\frac{1}{4\\pi u\\|\\mathbf{s}(v,w)\\|} \\left( u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right| \\right) \\,\\mathrm{d}u\\,\\mathrm{d}v\\,\\mathrm{d}w.\n$$\n分母中的因子 $u$ 与雅可比行列式 $u^2$ 项中的一个因子 $u$ 相消。得到的被积函数为：\n$$\n\\text{Integrand} = \\frac{u\\,v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{4\\pi \\|\\mathbf{s}(v,w)\\|}.\n$$\n现在这个被积函数是正则的。在 $u=0$ 处的潜在奇异性已被消除，因为此时被积函数为零。对于一个非退化的四面体，在积分域上 $\\|\\mathbf{s}(v,w)\\|0$，因此分母是良态的。该积分变为：\n$$\nI_{\\text{full}} = \\int_0^1 \\int_0^1 \\int_0^1 \\frac{u\\,v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{4\\pi \\|\\mathbf{s}(v,w)\\|} \\,\\mathrm{d}u\\,\\mathrm{d}v\\,\\mathrm{d}w.\n$$\n这是一个在单位立方体上的光滑积分，适合进行数值积分。\n\n**第2部分：小球邻域内的解析自含项**\n\n我们被要求证明 $g_0(\\mathbf{r}-\\mathbf{v}_0)$ 在以 $\\mathbf{v}_0$ 为中心、半径为 $\\varepsilon$ 的球体与四面体顶点形成的三面角锥的交集上的积分等于 $I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\frac{\\varepsilon^2}{2}\\,\\frac{\\Omega}{4\\pi}$。\n\n设积分区域为 $V_\\varepsilon$，它是球 $B_\\varepsilon(\\mathbf{v}_0)$ 位于角锥内部的部分。我们使用以 $\\mathbf{v}_0$ 为中心的球坐标 $(\\rho, \\theta, \\phi)$，因此 $\\rho = \\|\\mathbf{r}-\\mathbf{v}_0\\|$。微分体积元为 $\\mathrm{d}V = \\rho^2 \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\rho^2 \\mathrm{d}\\Omega'$，其中 $\\mathrm{d}\\Omega'$ 是立体角微元。\n该积分为：\n$$\nI_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\int_{V_\\varepsilon} \\frac{1}{4\\pi\\rho} \\mathrm{d}V = \\int_{\\text{cone}} \\left( \\int_0^\\varepsilon \\frac{1}{4\\pi\\rho} \\rho^2\\,\\mathrm{d}\\rho \\right) \\mathrm{d}\\Omega'.\n$$\n首先，我们计算径向积分：\n$$\n\\int_0^\\varepsilon \\frac{\\rho}{4\\pi}\\,\\mathrm{d}\\rho = \\frac{1}{4\\pi} \\left[ \\frac{\\rho^2}{2} \\right]_0^\\varepsilon = \\frac{\\varepsilon^2}{8\\pi}.\n$$\n这个结果相对于角积分是一个常数。现在，我们在角锥的立体角 $\\Omega$ 上积分：\n$$\nI_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\int_{\\text{cone}} \\frac{\\varepsilon^2}{8\\pi} \\mathrm{d}\\Omega' = \\frac{\\varepsilon^2}{8\\pi} \\int_{\\text{cone}} \\mathrm{d}\\Omega' = \\frac{\\varepsilon^2}{8\\pi} \\Omega.\n$$\n这可以写成 $\\frac{\\varepsilon^2}{2} \\frac{\\Omega}{4\\pi}$，从而证实了给定的公式。\n\n**第3部分：数值评估与验证**\n\n积分 $I_{\\text{full}}$ 可以分为两部分：一部分在区域 $\\|\\mathbf{r}-\\mathbf{v}_0\\| \\le \\varepsilon$（球内，$I_{\\text{ball}}$）上，另一部分在区域 $\\|\\mathbf{r}-\\mathbf{v}_0\\|  \\varepsilon$（剩余体积，$I_{\\text{rest}}$）上。在 Duffy 坐标下，条件 $\\|\\mathbf{r}-\\mathbf{v}_0\\| \\le \\varepsilon$ 变为 $u\\|\\mathbf{s}(v,w)\\| \\le \\varepsilon$，或 $u \\le \\varepsilon/\\|\\mathbf{s}(v,w)\\|$。由于我们还要求 $u \\le 1$，球区域的积分上限为 $u_{\\max}(v,w) = \\min\\left(1, \\frac{\\varepsilon}{\\|\\mathbf{s}(v,w)\\|}\\right)$。\n\n关于 $u$ 的积分可以解析地进行。令 $C(v,w) = \\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{4\\pi \\|\\mathbf{s}(v,w)\\|}$。被积函数为 $C(v,w) u$。\n\n对于 $I_{\\text{full}}$，我们将 $u$ 从 $0$ 积分到 $1$：\n$$\n\\int_0^1 C(v,w) u\\,\\mathrm{d}u = C(v,w) \\left[\\frac{u^2}{2}\\right]_0^1 = \\frac{C(v,w)}{2}.\n$$\n因此，用于 $I_{\\text{full}}$ 的 $(v,w)$ 积分的被积函数为 $\\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{8\\pi \\|\\mathbf{s}(v,w)\\|}$。\n\n对于 $I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon)$，我们将 $u$ 从 $0$ 积分到 $u_{\\max}$：\n$$\n\\int_0^{u_{\\max}} C(v,w) u\\,\\mathrm{d}u = C(v,w) \\left[\\frac{u^2}{2}\\right]_0^{u_{\\max}} = \\frac{C(v,w)}{2} (u_{\\max})^2.\n$$\n用于 $(v,w)$ 积分的被积函数为 $\\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{8\\pi \\|\\mathbf{s}(v,w)\\|} \\left(u_{\\max}(v,w)\\right)^2$。\n\n对于 $I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$，我们将 $u$ 从 $u_{\\max}$ 积分到 $1$：\n$$\n\\int_{u_{\\max}}^1 C(v,w) u\\,\\mathrm{d}u = C(v,w) \\left[\\frac{u^2}{2}\\right]_{u_{\\max}}^1 = \\frac{C(v,w)}{2} (1 - (u_{\\max})^2).\n$$\n用于 $(v,w)$ 积分的被积函数为 $\\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{8\\pi \\|\\mathbf{s}(v,w)\\|} \\left(1 - \\left(u_{\\max}(v,w)\\right)^2\\right)$。\n\n剩下的在 $(v,w) \\in [0,1]^2$ 上的二维积分是光滑的，可以使用高阶高斯-勒让德求积法则精确计算。根据构造，数值评估将精确满足 $I_{\\text{full}}^{\\text{numeric}} = I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$，直到机器精度。因此，要计算的两个误差度量\n$$\nE_1 = \\left|I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) - I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon)\\right|\n$$\n$$\nE_2 = \\left|I_{\\text{full}}^{\\text{numeric}} - \\left(I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)\\right)\\right|\n$$\n也将相同，直到机器精度，因为\n$E_2 = \\left|(I_{\\text{ball}}^{\\text{numeric}} + I_{\\text{rest}}^{\\text{numeric}}) - (I_{\\text{ball}}^{\\text{analytic}} + I_{\\text{rest}}^{\\text{numeric}})\\right| = \\left|I_{\\text{ball}}^{\\text{numeric}} - I_{\\text{ball}}^{\\text{analytic}}\\right| = E_1$。\n这些误差的大小表明基于立体角的近场贡献解析公式与稳健的数值积分方法得出的结果的匹配程度。一个小的误差验证了解析公式和数值实现的正确性。\n该实现将使用映射到区间 $[0,1]$ 的 32 点高斯-勒让德法则的二维张量积。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import roots_legendre\n\ndef get_gauss_legendre_quadrature(n):\n    \"\"\"\n    Returns points and weights for Gauss-Legendre quadrature on [0, 1].\n    \n    Args:\n        n (int): The number of quadrature points.\n        \n    Returns:\n        tuple: A tuple containing:\n            - np.ndarray: Quadrature points in [0, 1].\n            - np.ndarray: Quadrature weights for the [0, 1] interval.\n    \"\"\"\n    points, weights = roots_legendre(n)\n    # Map from [-1, 1] to [0, 1]\n    mapped_points = (points + 1.0) / 2.0\n    mapped_weights = weights / 2.0\n    return mapped_points, mapped_weights\n\ndef compute_errors(v0, v1, v2, v3, eps, Np=32):\n    \"\"\"\n    Computes the integral errors E1 and E2 for a given tetrahedron.\n    \n    Args:\n        v0, v1, v2, v3 (tuple): Coordinates of the tetrahedron vertices.\n        eps (float): Radius of the exclusion sphere.\n        Np (int): Number of points for Gauss-Legendre quadrature.\n        \n    Returns:\n        tuple: A tuple containing the errors (E1, E2).\n    \"\"\"\n    # Define edge vectors a_i from the singular vertex v0\n    a1 = np.array(v1) - np.array(v0)\n    a2 = np.array(v2) - np.array(v0)\n    a3 = np.array(v3) - np.array(v0)\n    \n    # The matrix A is formed by the edge vectors as columns\n    A_matrix = np.array([a1, a2, a3]).T\n    det_A = np.linalg.det(A_matrix)\n    \n    # === Part 1: Analytic Ball Integral Calculation ===\n    \n    # Normalize edge vectors\n    norm_a1 = np.linalg.norm(a1)\n    norm_a2 = np.linalg.norm(a2)\n    norm_a3 = np.linalg.norm(a3)\n    \n    a1_hat = a1 / norm_a1 if norm_a1 > 0 else a1\n    a2_hat = a2 / norm_a2 if norm_a2 > 0 else a2\n    a3_hat = a3 / norm_a3 if norm_a3 > 0 else a3\n\n    # Determinant of normalized vectors\n    A_hat_matrix = np.array([a1_hat, a2_hat, a3_hat]).T\n    det_A_hat = np.linalg.det(A_hat_matrix)\n    \n    # Dot products for the solid angle formula\n    dot12 = np.dot(a1_hat, a2_hat)\n    dot23 = np.dot(a2_hat, a3_hat)\n    dot31 = np.dot(a3_hat, a1_hat)\n    \n    # Solid angle calculation using the given formula\n    omega_numerator = np.abs(det_A_hat)\n    omega_denominator = 1.0 + dot12 + dot23 + dot31\n    if omega_denominator == 0:\n        # This case should not happen for a valid, convex trihedral angle\n        solid_angle_Omega = np.pi if omega_numerator > 0 else 0\n    else:\n        solid_angle_Omega = 2.0 * np.arctan(omega_numerator / omega_denominator)\n    \n    i_ball_analytic = (eps**2 / 2.0) * (solid_angle_Omega / (4.0 * np.pi))\n\n    # === Part 2: Numerical Integration using Duffy Transform ===\n    \n    points, weights = get_gauss_legendre_quadrature(Np)\n    v_points, w_points = points, points\n    v_weights, w_weights = weights, weights\n    \n    i_full_numeric = 0.0\n    i_ball_numeric = 0.0\n    i_rest_numeric = 0.0\n    \n    for i in range(Np):\n        v = v_points[i]\n        wv = v_weights[i]\n        for j in range(Np):\n            w = w_points[j]\n            ww = w_weights[j]\n            \n            # Calculate s(v, w) and its norm\n            s_vec = a1 + v * a2 + v * w * a3\n            norm_s = np.linalg.norm(s_vec)\n            \n            # Common factor from analytic integration over u\n            common_factor = v * np.abs(det_A) / (8.0 * np.pi * norm_s)\n            \n            # Integrand for I_full (after u-integration)\n            integrand_full = common_factor\n            i_full_numeric += wv * ww * integrand_full\n            \n            # Calculate u_max for splitting the integral\n            u_max = min(1.0, eps / norm_s)\n            \n            # Add contributions to ball and rest integrals\n            i_ball_numeric += wv * ww * (common_factor * u_max**2)\n            i_rest_numeric += wv * ww * (common_factor * (1.0 - u_max**2))\n            \n    # === Part 3: Error Calculation ===\n    \n    e1 = np.abs(i_ball_numeric - i_ball_analytic)\n    e2 = np.abs(i_full_numeric - (i_ball_analytic + i_rest_numeric))\n    \n    return e1, e2\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (regular-like tetrahedron)\n        {\n            \"v0\": (0.0, 0.0, 0.0),\n            \"v1\": (1.0, 0.0, 0.0),\n            \"v2\": (0.5, np.sqrt(3.0)/2.0, 0.0),\n            \"v3\": (0.5, np.sqrt(3.0)/6.0, np.sqrt(2.0/3.0)),\n            \"eps\": 0.05\n        },\n        # Case 2 (skew tetrahedron)\n        {\n            \"v0\": (0.0, 0.0, 0.0),\n            \"v1\": (2.0, 0.1, 0.0),\n            \"v2\": (0.2, 1.5, -0.1),\n            \"v3\": (-0.1, 0.3, 0.9),\n            \"eps\": 0.02\n        },\n        # Case 3 (small tetrahedron)\n        {\n            \"v0\": (0.0, 0.0, 0.0),\n            \"v1\": (1.0e-3, 0.0, 0.0),\n            \"v2\": (0.0, 1.0e-3, 0.0),\n            \"v3\": (0.0, 0.0, 2.0e-3),\n            \"eps\": 1.0e-5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        e1, e2 = compute_errors(\n            case[\"v0\"], case[\"v1\"], case[\"v2\"], case[\"v3\"], case[\"eps\"]\n        )\n        results.extend([e1, e2])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12e}' for r in results)}]\")\n\nsolve()\n```", "id": "3359660"}]}