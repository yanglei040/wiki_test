{"hands_on_practices": [{"introduction": "数值方法的稳定性，尤其是在低频情况下，是计算电磁学中的一个核心挑战。本练习通过一个简化的“玩具模型”，揭示了为何像Rao-Wilton-Glisson (RWG) 基函数与Buffa-Christiansen (BC) 测试函数这样的高级方法能够确保稳定性。通过分析这个模型 [@problem_id:3316178]，您将亲手验证从Maue型正则化中产生的离散代数结构 $C^{\\top} V_k C$ 如何在波数 $k \\to 0$ 时避免灾难性的“低频灾难”，从而理解稳定离散格式的精髓。", "problem": "考虑嵌入三维空间中的一个单连通、开放、平面上的外部时谐麦克斯韦边界积分公式。在构建诺伊曼型条件时会出现超奇异边界积分算子，众所周知，该算子在朴素的伽辽金离散化中是不稳定的。一种标准的、物理上合理的正则化方法是通过在曲面上进行分部积分，并使用以单层势的切向导数表示的形式，这通常被称为Maue型正则化。在离散情境下，当波数 $k \\to 0$ 时，稳定性要求试探空间和检验空间的选择是相容的。一种能保证稳定性的配对是使用Rao–Wilton–Glisson (RWG) 试探函数和Buffa–Christiansen (BC) 检验函数。您的任务是，在最简单的非平凡三角网格上，推导并实现一个使用RWG试探函数和BC检验函数的正则化超奇异算子的最小、自洽、稳定的离散表示，然后分析当 $k \\to 0$ 时离散inf-sup常数的变化。\n\n从以下公认的基本基础出发：\n- 频域中波数为 $k$ 的麦克斯韦方程组，以及相关的亥姆霍兹方程的自由空间格林函数。\n- 基于曲面上的单层算子及其切向微分算子的边界积分表示，通过分部积分可以得到超奇异算子的正则化形式。\n- 三角网格上的离散de Rham序列，其中RWG函数位于原始边上，BC函数位于对偶边上，它们通过关联矩阵连接，该矩阵以无度量的方式表示曲面微分算子。\n\n为了使计算明确且能在一个无需外部几何文件的单一程序中完全复现，请使用以下用于网格和离散算子的最小模型：\n- 几何与网格：在 $z=0$ 平面上的一个单位正方形被分割成2个共享一条内部边的直角三角形。这两个三角形是仅有的面。只有一条内部边，这是唯一的RWG自由度。这两个面通过对偶复形定义了BC检验空间，从而产生与该内部边配对的唯一一个BC自由度。\n- 离散曲面旋度/关联矩阵：用 $C \\in \\mathbb{R}^{2 \\times 1}$ 表示将单个内部原始边映射到两个面的有向面-边关联矩阵。为保持方向一致，取 $C = [1,-1]^{\\top}$。\n- 面上单层算子的离散近似：通过面图上离散亥姆霍兹算子的逆来模拟正则化的单层算子。设 $L \\in \\mathbb{R}^{2 \\times 2}$ 为双面邻接的图拉普拉斯算子，\n$$L = \\begin{bmatrix}1  -1 \\\\ -1  1\\end{bmatrix}$$\n对于 $k0$，定义 $V_k = (L + k^2 I)^{-1}$。对于 $k=0$，将 $V_0$ 定义为 $L$ 的Moore–Penrose伪逆，这与静态极限一致，并能正确处理开放曲面上的常数零空间。这个选择是单层算子基于质量集中Laplace–Beltrami正则化的一个一致、无度量的替代模型，并且在 $k \\to 0$ 时保留了正确的零空间结构。\n- 混合形式的正则化超奇异算子：使用Maue型正则化和RWG–BC配对，离散双线性形式可以建模为 $1 \\times 1$ 矩阵\n$$\nB_k \\equiv C^{\\top} V_k C \\in \\mathbb{R}^{1 \\times 1}.\n$$\n这是使用BC函数进行检验、RWG函数进行试探的连续正则化超奇异算子的图-亥姆霍兹替代模型。\n- 范数和inf-sup常数：为了分离出该配对的稳定性特性，对RWG和BC空间均使用单位质量矩阵，$M_{\\mathrm{RWG}} = 1$ 和 $M_{\\mathrm{BC}} = 1$。离散inf-sup常数即为 $M_{\\mathrm{BC}}^{-1/2} B_k M_{\\mathrm{RWG}}^{-1/2}$ 的最小奇异值，由于该矩阵是 $1 \\times 1$ 的，这简化为 $B_k$ 的绝对值。\n\n任务：\n1) 基于上述基本原理，论证为什么Maue型正则化在离散层面上会导出形如 $B_k = C^{\\top} V_k C$ 的表示（根据给定的定义），以及为什么必须使用伪逆 $V_0$ 来处理静态零空间。不要引入任何其他未引用的建模假设。\n2) 实现一个程序，为给定的网格构建 $C$、$L$ 和 $V_k$，组装 $B_k = C^{\\top} V_k C$，并计算作为 $B_k$ 最小奇异值的离散inf-sup常数。\n3) 对于下方的测试集，计算每个 $k$ 对应的离散inf-sup常数并报告结果。所有输出均为无量纲实数。\n\n测试集：\n- 情况1 (正常路径): $k = 1.0$。\n- 情况2 (中等小值): $k = 0.1$。\n- 情况3 (极小值): $k = 10^{-6}$。\n- 情况4 (静态极限): $k = 0.0$ (对 $V_0$ 使用Moore–Penrose伪逆)。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含按给定顺序排列的四个情况的结果，格式为方括号内逗号分隔的列表，例如 $[r_1,r_2,r_3,r_4]$。", "solution": "该问题被评估为有效，因为它在计算电磁学方面有科学依据，是适定的、客观的且内部一致的。它提出了一个简化但概念上合理的模型，用于研究超奇异边界积分算子的混合有限元离散化的低频稳定性。\n\n任务是论证所提供的正则化超奇异算子的离散模型的合理性，然后计算其在给定一组波数下的稳定性常数。\n\n### 1. 离散模型的理论论证\n\n任务的核心是论证正则化超奇异算子的离散表示 $B_k = C^{\\top} V_k C$ 的合理性，以及在静态极限 $k=0$ 时使用伪逆的必要性。\n\n#### 1.1. Maue型正则化与离散形式 $C^{\\top} V_k C$\n\n超奇异算子（通常表示为 $\\mathcal{K}$）出现在麦克斯韦方程组的边界积分公式中。在电场积分方程 (EFIE) 的背景下，作用于表面电流密度 $\\mathbf{J}$ 的算子由 $\\mathcal{A}(\\mathbf{J}) = i\\omega\\mu_0 \\mathcal{S}_k(\\mathbf{J}) + \\frac{1}{i\\omega\\epsilon_0} \\mathcal{K}(\\mathbf{J})$ 给出，其中 $\\mathcal{S}_k$ 是单层势算子，$\\mathcal{K}$ 是超奇异算子。波数为 $k = \\omega\\sqrt{\\mu_0 \\epsilon_0}$。\n\n对 $\\mathcal{K}$ 进行朴素离散化在数值上是不稳定的。Maue型正则化是克服这种不稳定性的标准程序。它依赖于恒等式 $\\mathcal{K}(\\mathbf{J}) = (\\nabla_S \\nabla_S \\cdot + k^2 \\mathbf{I}) \\mathcal{S}_k(\\mathbf{J})$，其中 $\\nabla_S$ 和 $\\nabla_S \\cdot$ 分别是曲面梯度和曲面散度。当用函数 $\\mathbf{g}$ 进行检验时，超奇异算子的弱形式为 $\\langle \\mathbf{g}, \\mathcal{K}(\\mathbf{f}) \\rangle$，其中 $\\mathbf{f}$ 是试探函数。通过在曲面上进行分部积分（曲面矢量格林恒等式），有问题的 $\\nabla_S \\nabla_S \\cdot$ 项被正则化：\n$$\n\\langle \\mathbf{g}, \\mathcal{K}(\\mathbf{f}) \\rangle = \\langle \\nabla_S \\cdot \\mathbf{g}, \\mathcal{S}_k(\\nabla_S \\cdot \\mathbf{f}) \\rangle + k^2 \\langle \\mathbf{g}, \\mathcal{S}_k(\\mathbf{f}) \\rangle\n$$\n这种形式是稳定的，并且是现代有限元边界元方法的基础。该公式的低频（$k \\to 0$）稳定性关键取决于试探空间 $\\mathbf{f}$ 和检验空间 $\\mathbf{g}$ 的选择。将Rao-Wilton-Glisson (RWG) 函数用于 $\\mathbf{f}$ 并将Buffa-Christiansen (BC) 函数用于 $\\mathbf{g}$ 的配对，已知可以提供一种在 $k \\to 0$ 时保持稳健的稳定离散化方案。\n\n该问题为该公式提供了一个最小的、无度量的离散模型。让我们分析其组成部分：\n-   **试探函数和检验函数**：RWG试探函数的单个自由度对应于单个内部边上基函数的系数。BC检验函数的单个自由度通过对偶网格与该边相关联。\n-   **离散曲面散度 $C$**：与一条边相关联的RWG基函数具有分片常数的曲面散度，在两个相邻面上取相反的值。该问题使用矩阵 $C = [1, -1]^{\\top} \\in \\mathbb{R}^{2 \\times 1}$ 来模拟这种从基于边的系数到基于面的散度系数的映射。该矩阵是一个有向的面-边关联矩阵，并作为曲面散度算子 $\\nabla_S \\cdot$ 的离散、无度量表示。\n-   **离散单层算子 $V_k$**：单层算子 $\\mathcal{S}_k$ 是曲面亥姆霍兹方程 $(-\\Delta_S + k^2) u = \\sigma$ 的求解算子，其中 $\\sigma$ 是曲面源密度， $u$ 是产生的势。其离散对应物 $V_k$ 将面上离散源的系数映射到面上离散势的系数。表达式 $V_k = (L + k^2 I)^{-1}$ 是离散亥姆霍兹算子的一个典范模型，其中 $L$ 是表示 $-\\Delta_S$ 的图拉普拉斯算子，$k^2 I$ 是质量项。给定的拉普拉斯算子 $L = \\begin{bmatrix}1  -1 \\\\ -1  1\\end{bmatrix}$ 是由两个共享一条边的面组成的网格的正确图拉普拉斯算子。\n-   **用于检验的伴随算子**：在Petrov-Galerkin格式中，弱形式中应用于检验函数的算子是应用于试探函数的算子的伴随算子。在这种具有单位质量矩阵的离散、无度量设置中，离散散度 $C$ 的伴随是其转置 $C^{\\top}$。\n\n结合这些元素，正则化双线性形式的主导项 $\\langle \\nabla_S \\cdot \\mathbf{g}, \\mathcal{S}_k(\\nabla_S \\cdot \\mathbf{f}) \\rangle$ 被离散化为 $C^{\\top} V_k C$。第二项 $k^2 \\langle \\mathbf{g}, \\mathcal{S}_k(\\mathbf{f}) \\rangle$ 是 $k$ 的高阶项，其稳定性不那么关键。所选模型 $B_k = C^\\top V_k C$ 关注于导致低频行为的主要结构，是离散外微分中一个公认的范式。\n\n#### 1.2. 静态极限 ($k=0$) 与Moore-Penrose伪逆\n\n当波数 $k$ 设为0时，离散算子 $V_k$ 变为 $V_0 = (L + 0^2 I)^{-1} = L^{-1}$。我们必须分析矩阵 $L = \\begin{bmatrix}1  -1 \\\\ -1  1\\end{bmatrix}$。其列是线性相关的，并且向量 $[1, 1]^\\top$ 在其零空间中，因为 $L[1, 1]^\\top = [0, 0]^\\top$。因此，$L$ 是奇异的，其标准逆不存在。\n\n这种奇异性有其物理和数学基础。矩阵 $L$ 表示静态Laplace-Beltrami算子 $-\\Delta_S$。在一个没有边界（或具有自然边界条件，如此处所示）的曲面上，拉普拉斯算子的零空间由常数函数构成。向量 $[1, 1]^\\top$ 表示网格两个面上的常数函数。\n\n然而，算子 $L$ 并非作用于任意向量。它作用于离散散度算子 $C$ 的输出。对于单个RWG系数 $x \\in \\mathbb{R}^1$，得到的散度向量是 $Cx = [x, -x]^\\top$。该向量元素的和为 $x - x = 0$。这意味着向量 $Cx$ 与 $L$ 的零空间正交（因为 $\\langle [x, -x]^\\top, [1, 1]^\\top \\rangle = x - x = 0$）。\n\n因此，向量 $Cx$ 位于算子 $L$ 的值域中。方程 $L\\mathbf{y} = Cx$ 是相容的，并且对 $\\mathbf{y}$ 有解。解不唯一；如果 $\\mathbf{y}_p$ 是一个特解，则通解为 $\\mathbf{y}_p + \\alpha [1, 1]^\\top$，其中 $\\alpha$ 是任意标量。为了获得一个唯一的、定义明确的算子，我们必须选择一个特定的解。标准的选择是那个本身也与 $L$ 的零空间正交的唯一解。Moore-Penrose伪逆 $L^+$ 正好提供了这个解。\n\n因此，对于静态情况 $k=0$，单层算子的正确定义是 $V_0 = L^+$。这个过程在数学上是合理的，并且在物理上对应于对势强制施加零均值条件，这对于由内部RWG函数的散度产生的平衡电荷分布是合适的。极限 $\\lim_{k\\to 0} V_k = L^+$ 的连续性进一步证实了这一选择。\n\n### 2. Inf-Sup常数的计算\n\n离散inf-sup常数 $\\gamma_k$ 是矩阵 $B_k = C^{\\top} V_k C$ 的最小奇异值。由于 $B_k$ 是一个 $1 \\times 1$ 的矩阵（一个标量），其奇异值就是它的绝对值，即 $\\gamma_k = |B_k|$。\n\n#### 情况1：$k > 0$\n算子矩阵为 $L + k^2 I = \\begin{bmatrix} 1+k^2  -1 \\\\ -1  1+k^2 \\end{bmatrix}$。其行列式为 $\\det(L + k^2 I) = (1+k^2)^2 - 1 = 1 + 2k^2 + k^4 - 1 = k^2(2+k^2)$。其逆为 $V_k = (L + k^2 I)^{-1} = \\frac{1}{k^2(2+k^2)} \\begin{bmatrix} 1+k^2  1 \\\\ 1  1+k^2 \\end{bmatrix}$。\n\n我们现在组装 $B_k = C^{\\top} V_k C$:\n$$\nB_k = \\begin{bmatrix} 1  -1 \\end{bmatrix} \\left( \\frac{1}{k^2(2+k^2)} \\begin{bmatrix} 1+k^2  1 \\\\ 1  1+k^2 \\end{bmatrix} \\right) \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix}\n$$\n首先，$C^{\\top}V_k$:\n$$\nC^{\\top}V_k = \\frac{1}{k^2(2+k^2)} \\begin{bmatrix} (1+k^2)-1  1-(1+k^2) \\end{bmatrix} = \\frac{1}{k^2(2+k^2)} \\begin{bmatrix} k^2  -k^2 \\end{bmatrix} = \\frac{1}{2+k^2} \\begin{bmatrix} 1  -1 \\end{bmatrix}\n$$\n然后，$(C^{\\top}V_k)C$:\n$$\nB_k = \\left( \\frac{1}{2+k^2} \\begin{bmatrix} 1  -1 \\end{bmatrix} \\right) \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix} = \\frac{1}{2+k^2} (1\\cdot 1 + (-1)\\cdot(-1)) = \\frac{2}{2+k^2}\n$$\ninf-sup常数为 $\\gamma_k = |B_k| = \\frac{2}{2+k^2}$，对于所有实数 $k$ 均为正。\n\n#### 情况2：$k = 0$\n我们计算 $L = \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$ 的Moore-Penrose伪逆。$L$ 的谱分解得到的特征值为 $\\lambda_1 = 2$ 和 $\\lambda_2=0$。伪逆是通过对非零特征值求倒数形成的。$L$ 的谱分解为 $L = \\lambda_1 \\mathbf{u}_1 \\mathbf{u}_1^\\top + \\lambda_2 \\mathbf{u}_2 \\mathbf{u}_2^\\top$，其中 $\\mathbf{u}_1 = \\frac{1}{\\sqrt{2}}[1, -1]^\\top$ 且 $\\mathbf{u}_2 = \\frac{1}{\\sqrt{2}}[1, 1]^\\top$。伪逆为 $V_0 = L^+ = \\frac{1}{\\lambda_1} \\mathbf{u}_1 \\mathbf{u}_1^\\top$:\n$$\nV_0 = \\frac{1}{2} \\left( \\frac{1}{\\sqrt{2}} \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix} \\right) \\left( \\frac{1}{\\sqrt{2}} \\begin{bmatrix} 1  -1 \\end{bmatrix} \\right) = \\frac{1}{4} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n现在我们组装 $B_0 = C^{\\top} V_0 C$:\n$$\nB_0 = \\begin{bmatrix} 1  -1 \\end{bmatrix} \\left( \\frac{1}{4} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} \\right) \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix} = \\frac{1}{4} \\begin{bmatrix} 2  -2 \\end{bmatrix} \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix} = \\frac{1}{4} (2 - (-2)) = \\frac{4}{4} = 1\n$$\ninf-sup常数为 $\\gamma_0 = |B_0| = 1$。这个结果与一般公式在 $k \\to 0$ 时的极限一致：$\\lim_{k\\to 0} \\frac{2}{2+k^2} = 1$。稳定性常数有界且不为零，证明了该公式的稳健性。\n\n### 3. 测试集的数值结果\n-   情况1 ($k=1.0$): $\\gamma_{1.0} = \\frac{2}{2+1^2} = \\frac{2}{3} \\approx 0.6667$\n-   情况2 ($k=0.1$): $\\gamma_{0.1} = \\frac{2}{2+0.1^2} = \\frac{2}{2.01} \\approx 0.9950$\n-   情况3 ($k=10^{-6}$): $\\gamma_{10^{-6}} = \\frac{2}{2+(10^{-6})^2} = \\frac{2}{2+10^{-12}} \\approx 1.0$\n-   情况4 ($k=0.0$): $\\gamma_0 = 1.0$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discrete inf-sup constant for a minimal model of a\n    regularized hypersingular operator with RWG-BC basis functions.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        1.0,        # Case 1: happy path\n        0.1,        # Case 2: moderately small k\n        1e-6,       # Case 3: very small k\n        0.0,        # Case 4: static limit\n    ]\n\n    # Define the discrete operators based on the provided minimal model.\n    # C is the discrete surface curl/incidence matrix (2x1).\n    C = np.array([[1.0], [-1.0]])\n    \n    # L is the graph Laplacian for the two-face adjacency (2x2).\n    L = np.array([[1.0, -1.0], [-1.0, 1.0]])\n    \n    # I is the identity matrix (2x2).\n    I = np.eye(2)\n\n    results = []\n    for k in test_cases:\n        # For k > 0, the discrete single-layer operator V_k is the inverse of\n        # the discrete Helmholtz operator (L + k**2 * I).\n        if k > 0.0:\n            V_k = np.linalg.inv(L + k**2 * I)\n        # For k = 0, the operator L is singular. We use the Moore-Penrose\n        # pseudoinverse, which correctly handles the static nullspace.\n        else:\n            V_k = np.linalg.pinv(L)\n        \n        # Assemble the discrete bilinear form B_k = C^T * V_k * C.\n        # The result is a 1x1 matrix.\n        B_k_matrix = C.T @ V_k @ C\n        \n        # The discrete inf-sup constant is the smallest singular value of B_k.\n        # For a 1x1 matrix [b], this is simply its absolute value |b|.\n        inf_sup_constant = np.abs(B_k_matrix[0, 0])\n        \n        results.append(inf_sup_constant)\n\n    # Final print statement in the exact required format.\n    # e.g., [r_1,r_2,r_3,r_4]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3316178"}, {"introduction": "理解了代数稳定性之后，下一个关键步骤是如何在实践中进行计算。正则化虽然将超奇异积分转化为了更容易处理的弱奇异积分，但后者仍然需要专门的数值技术。本练习 [@problem_id:3316164] 将引导您应用Duffy变换这一强大工具，来精确计算自相交单元上的弱奇异积分，并进一步分析特定求积方案的收敛速度，这是边界元方法（BEM）高性能计算实现中的一个基本技能。", "problem": "考虑在具有顶点 $\\mathbf{r}_{1}, \\mathbf{r}_{2}, \\mathbf{r}_{3}$ 的单个平坦三角形表面元 $\\Delta \\subset \\mathbb{R}^{3}$ 上，用于时谐电磁学的正则化超奇异边界积分算子。经过标准的 Maue 型分部积分正则化后，限制在重合单元贡献上的算子核有一个弱奇异分量，其在 $\\mathbf{r} = \\mathbf{r}'$ 附近的局部主项与 $\\ln \\rho$ 成正比（其中 $\\rho = \\|\\mathbf{r} - \\mathbf{r}'\\|$），外加一个光滑余项。设 $\\phi$ 和 $\\psi$ 是 $\\Delta$ 上的光滑检验函数（例如，固定次数的分片多项式基函数），并考虑模型奇异二重积分\n$$\nI_{\\mathrm{sing}} = \\int_{\\Delta} \\int_{\\Delta} \\ln \\|\\mathbf{r} - \\mathbf{r}'\\| \\, \\phi(\\mathbf{r}) \\, \\psi(\\mathbf{r}') \\, \\mathrm{d}S_{\\mathbf{r}} \\, \\mathrm{d}S_{\\mathbf{r}'} .\n$$\n你需要设计一个针对重合单元情况的 Duffy 型坐标变换，将局部近对角积分转换为具有显式单变量对数因子的张量积形式，然后估计应用于变换后积分的张量积 Gauss 型求积的代数收敛性。\n\n任务：\n- 通过 $\\mathbf{r}(\\lambda_{1}, \\lambda_{2}) = \\mathbf{r}_{1} + \\lambda_{1} \\mathbf{a} + \\lambda_{2} \\mathbf{b}$（其中 $\\mathbf{a} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$ 和 $\\mathbf{b} = \\mathbf{r}_{3} - \\mathbf{r}_{1}$）来参数化参考三角形 $\\widehat{\\Delta} = \\{ (\\lambda_{1}, \\lambda_{2}) \\in \\mathbb{R}^{2} : \\lambda_{1} \\ge 0, \\lambda_{2} \\ge 0, \\lambda_{1} + \\lambda_{2} \\le 1 \\}$，并对 $\\mathbf{r}'(\\mu_{1}, \\mu_{2})$ 进行类似参数化。仅使用基本的几何和测度论事实，在一个重心坐标满足 $\\mu_{i} \\le \\lambda_{i}$（对于 $i=1,2,3$，其中 $\\lambda_{3} = 1 - \\lambda_{1} - \\lambda_{2}$ 和 $\\mu_{3} = 1 - \\mu_{1} - \\mu_{2}$）的代表性近对角子域上构造一个 Duffy 型变换。在此子域中，强制关系 $\\boldsymbol{\\mu} = \\zeta \\boldsymbol{\\lambda}$（其中 $\\zeta \\in [0,1]$ 为一个标量坍缩参数），并证明在远离三角形边的区域，距离的行为如同 $\\rho \\asymp (1 - \\zeta)$ 关于 $\\boldsymbol{\\lambda}$ 一致成立，而表面测度乘积变换为 $\\mathrm{d}S_{\\mathbf{r}} \\, \\mathrm{d}S_{\\mathbf{r}'} = C_{\\Delta} \\, \\zeta^{2} \\, \\mathrm{d}\\lambda_{1} \\, \\mathrm{d}\\lambda_{2} \\, \\mathrm{d}\\zeta$，其中 $C_{\\Delta}  0$ 是一个仅取决于三角形几何形状的常数，变换结果在一个光滑、严格为正且在子域内有一致上下界的因子的意义下成立。最后得出结论：经过光滑单位分解进行局部化后，奇异贡献可简化为 $\\widehat{\\Delta} \\times [0,1]$ 上的一个三重积分，其形式为\n$$\n\\int_{0}^{1} \\int_{\\widehat{\\Delta}} \\zeta^{2} \\, \\ln(1 - \\zeta) \\, G(\\lambda_{1}, \\lambda_{2}, \\zeta) \\, \\mathrm{d}\\lambda_{1} \\, \\mathrm{d}\\lambda_{2} \\, \\mathrm{d}\\zeta,\n$$\n其中 $G$ 在该紧致域上是光滑且严格为正的。\n\n现在，假设你使用一个张量积求积来近似这个三重积分，该求积由以下部分组成：\n- 在 $[0,1]$ 上的 $\\zeta$ 变量使用一个 $n$ 点 Gauss–Legendre 法则，以及\n- 在 $\\widehat{\\Delta}$ 上对 $(\\lambda_{1}, \\lambda_{2})$ 变量使用一个 $n$ 阶对称三角形求积，该求积使用 $\\mathcal{O}(n^{2})$ 个点。\n\n令 $P$ 表示此重合单元贡献所需的求积点总数。通过估计由对数端点奇异性的 $\\zeta$ 积分引起的主导求积误差，并仅使用关于 Gauss-Legendre 法则对端点对数被积函数精度的成熟结果以及 $G$ 的光滑性，确定代数衰减指数 $\\alpha$，使得复合张量积求積误差 $E(P)$ 满足\n$$\nE(P) = \\mathcal{O}\\!\\left( P^{-\\alpha} \\right) \\quad \\text{as} \\quad P \\to \\infty .\n$$\n只需提供最终的指数 $\\alpha$（以最简分数形式）。无需单位。", "solution": "我们从 $\\mathbb{R}^{3}$ 中平坦三角形 $\\Delta$ 上的积分算子设定开始。令 $\\mathbf{a} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$ 和 $\\mathbf{b} = \\mathbf{r}_{3} - \\mathbf{r}_{1}$。该三角形的仿射参数化为 $\\mathbf{r}(\\lambda_{1}, \\lambda_{2}) = \\mathbf{r}_{1} + \\lambda_{1} \\mathbf{a} + \\lambda_{2} \\mathbf{b}$，其中 $(\\lambda_{1}, \\lambda_{2}) \\in \\widehat{\\Delta} = \\{ \\lambda_{1} \\ge 0, \\lambda_{2} \\ge 0, \\lambda_{1} + \\lambda_{2} \\le 1 \\}$。面积元为 $\\mathrm{d}S_{\\mathbf{r}} = |\\mathbf{a} \\times \\mathbf{b}| \\, \\mathrm{d}\\lambda_{1} \\, \\mathrm{d}\\lambda_{2}$。类似地，用 $(\\mu_{1}, \\mu_{2}) \\in \\widehat{\\Delta}$ 参数化 $\\mathbf{r}'(\\mu_{1}, \\mu_{2}) = \\mathbf{r}_{1} + \\mu_{1} \\mathbf{a} + \\mu_{2} \\mathbf{b}$，且 $\\mathrm{d}S_{\\mathbf{r}'} = |\\mathbf{a} \\times \\mathbf{b}| \\, \\mathrm{d}\\mu_{1} \\, \\mathrm{d}\\mu_{2}$。\n\n在计算电磁学中，对超奇异算子进行 Maue 型正则化后，沿对角线 $\\{ \\mathbf{r} = \\mathbf{r}' \\}$ 的剩余弱奇异核可以主阶项建模为 $c \\, \\ln \\rho$（其中 $\\rho = \\| \\mathbf{r} - \\mathbf{r}' \\|$ 且 $c \\in \\mathbb{R}$ 为某个常数），外加一个光滑余项。由于 $\\phi$ 和 $\\psi$ 在 $\\Delta$ 上是光滑的，局部奇异结构由几何形状和对数项决定。我们关注 $\\widehat{\\Delta} \\times \\widehat{\\Delta}$ 的一个代表性子域，其中重心坐标满足逐分量排序\n$$\n\\mu_{i} \\le \\lambda_{i} \\quad \\text{for} \\quad i = 1, 2, 3, \\qquad \\text{with} \\quad \\lambda_{3} = 1 - \\lambda_{1} - \\lambda_{2}, \\ \\ \\mu_{3} = 1 - \\mu_{1} - \\mu_{2}.\n$$\n在此子域上，可以通过坍缩参数 $\\zeta \\in [0,1]$ 将内点参数化为 $\\boldsymbol{\\mu} = \\zeta \\boldsymbol{\\lambda}$，即\n$$\n\\mu_{1} = \\zeta \\lambda_{1}, \\qquad \\mu_{2} = \\zeta \\lambda_{2}, \\qquad \\mu_{3} = \\zeta \\lambda_{3},\n$$\n使得在重心坐标下 $\\mathbf{r}'$ 位于 $\\mathbf{r}_{1}$ 和 $\\mathbf{r}$ 之间的线段上。这是针对重合单元的典范 Duffy 型映射：它将四维的近对角集坍缩到一个三维的张量积集 $\\widehat{\\Delta} \\times [0,1]$ 上，并与由逐分量排序的排列定义的 $\\widehat{\\Delta} \\times \\widehat{\\Delta}$ 的其他五个子域上的类似构造配对。\n\n距离缩放。通过上述映射，\n$$\n\\mathbf{r}' - \\mathbf{r} \\, = \\, \\left( \\zeta \\lambda_{1} - \\lambda_{1} \\right) \\mathbf{a} \\, + \\, \\left( \\zeta \\lambda_{2} - \\lambda_{2} \\right) \\mathbf{b} \\, = \\, - (1 - \\zeta) \\left( \\lambda_{1} \\mathbf{a} + \\lambda_{2} \\mathbf{b} \\right),\n$$\n因此\n$$\n\\rho \\, = \\, \\| \\mathbf{r}' - \\mathbf{r} \\| \\, = \\, (1 - \\zeta) \\, \\| \\lambda_{1} \\mathbf{a} + \\lambda_{2} \\mathbf{b} \\|.\n$$\n在一个排除了三角形边附近薄层（这可以通过标准的单位分解和局部边图来处理）的紧邻域中，$\\| \\lambda_{1} \\mathbf{a} + \\lambda_{2} \\mathbf{b} \\|$ 被固定的正常数从上下界定，所以\n$$\n\\rho \\asymp (1 - \\zeta) \\quad \\text{uniformly in} \\quad (\\lambda_{1}, \\lambda_{2}) \\in \\widehat{\\Delta}_{\\mathrm{int}} \\subset \\widehat{\\Delta},\n$$\n因此\n$$\n\\ln \\rho \\, = \\, \\ln(1 - \\zeta) \\, + \\, \\ln \\| \\lambda_{1} \\mathbf{a} + \\lambda_{2} \\mathbf{b} \\| .\n$$\n第二项关于 $(\\lambda_{1}, \\lambda_{2})$ 是光滑的，因此唯一的非光滑依赖关系是新变量 $\\zeta$ 中的因子 $\\ln(1 - \\zeta)$。\n\n测度变换。在此映射下，乘积表面测度通过类似余面积的恒等式（这可由重心坐标中微分的多重线性代数和仿射参数化推得）进行变换\n$$\n\\mathrm{d}S_{\\mathbf{r}} \\, \\mathrm{d}S_{\\mathbf{r}'} \\, = \\, |\\mathbf{a} \\times \\mathbf{b}|^{2} \\, \\mathrm{d}\\lambda_{1} \\, \\mathrm{d}\\lambda_{2} \\, \\mathrm{d}\\mu_{1} \\, \\mathrm{d}\\mu_{2} \\, = \\, C_{\\Delta} \\, \\zeta^{2} \\, \\mathrm{d}\\lambda_{1} \\, \\mathrm{d}\\lambda_{2} \\, \\mathrm{d}\\zeta,\n$$\n其中 $C_{\\Delta}  0$ 是一个仅依赖于 $\\mathbf{a}$ 和 $\\mathbf{b}$ 的常数，$\\zeta^{2}$ 因子源于二维缩放 $\\boldsymbol{\\mu} = \\zeta \\boldsymbol{\\lambda}$（$(\\mu_{1}, \\mu_{2})$ 中的微分 2-形式是 $(\\lambda_{1}, \\lambda_{2})$ 中相应形式的 $\\zeta^{2}$ 倍，除去由余面积因子解释的包含 $\\mathrm{d}\\zeta$ 的项；例如，参见 Duffy 方法在重合单纯形上的标准推导）。因此，经过局部化并将光滑、严格为正的因子吸收到一个光滑的被积函数中后，奇异贡献可简化为三重积分\n$$\n\\int_{0}^{1} \\int_{\\widehat{\\Delta}} \\zeta^{2} \\, \\ln(1 - \\zeta) \\, G(\\lambda_{1}, \\lambda_{2}, \\zeta) \\, \\mathrm{d}\\lambda_{1} \\, \\mathrm{d}\\lambda_{2} \\, \\mathrm{d}\\zeta,\n$$\n其中 $G \\in C^{\\infty}(\\widehat{\\Delta} \\times [0,1])$ 且在紧致域上被正常数从上下界定。\n\n求积设计与 $\\zeta$ 方向的误差。考虑一个由以下组成的张量积求积：\n- 一个在 $\\zeta \\in [0,1]$ 上的 $n$ 点 Gauss–Legendre 法则，以及\n- 一个在 $\\widehat{\\Delta}$ 上的 $n$ 阶对称三角形法则，使用 $\\mathcal{O}(n^{2})$ 个求值点。\n\n因此，求积点的总数为\n$P = C_{0} n \\times C_{1} n^{2} = C n^{3}$,\n其中 $C_{0}, C_{1}, C  0$ 是与 $n$ 无关的常数，因此 $n \\asymp P^{1/3}$。\n\n由于 $G$ 在所有变量中都是光滑的，唯一的非光滑因子是 $\\ln(1 - \\zeta)$ 乘以光滑权重 $\\zeta^{2}$。对于形如\n$$\n\\int_{0}^{1} \\ln(1 - \\zeta) \\, \\widetilde{g}(\\zeta) \\, \\mathrm{d}\\zeta,\n$$\n的积分，其中 $\\widetilde{g} \\in C^{\\infty}[0,1]$，Gauss–Legendre 求积对端点对数奇异性的标准误差估计（这是正交多项式求积数值分析中的一个成熟事实）得出 $\\zeta$ 积分的代数衰减为\n$E_{\\zeta}(n) = \\mathcal{O}\\!\\left( n^{-2} \\right)$\n三角形上光滑的 $(\\lambda_{1}, \\lambda_{2})$ 积分相对于三角形法则的阶数产生超代数（或至少是高阶代数）收敛，因此不主导整体收敛率。因此，张量积求积的整体误差由 $\\zeta$ 方向决定，并满足\n$E(n) = \\mathcal{O}\\!\\left( n^{-2} \\right)$.\n\n将误差用总点数 $P \\asymp n^{3}$ 表示，我们得到\n$E(P) = \\mathcal{O}\\!\\left( \\left( P^{1/3} \\right)^{-2} \\right) = \\mathcal{O}\\!\\left( P^{-2/3} \\right)$.\n因此，所求的代数衰减指数为\n$\\alpha = \\frac{2}{3}$.\n\n这个结论在包含其他五个近对角子域（源于重心坐标逐分量排序的其他排列）的情况下是稳健的，因为每个子域都贡献了相同的 $\\zeta$-端点对数和相同的 $\\zeta^{2}$ 雅可比因子，并且在局部化后，所有常数在紧致域上都保持一致地有界，远离零和无穷大。核的光滑余项和非重合单元对产生光滑积分，其求积误差的衰减速度至少与此处分析的主导近对角贡献一样快。", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "3316164"}, {"introduction": "一个优秀的数值方法不仅要稳定和收敛，还必须忠实地反映其背后的物理定律。本练习 [@problem_id:3316221] 探讨了一个更深层次的问题：数值离散格式是否保持了互易性这一基本物理原理，后者在算子层面表现为反对称性。您将通过一个数值实验，研究网格的各向异性等几何因素如何破坏离散对称性，从而对数值仿真的保真度建立更深刻的认识。", "problem": "考虑光滑表面上的时谐电磁边界积分公式。切向迹超奇异算子经过标准正则化后，可以写成作用于标量亥姆霍兹方程的自由空间格林函数上的旋度复合形式。在静态极限下，可以提取出一个模型超奇异核，该核在源点和观测点交换时具有奇宇称性。具体来说，设 $G(\\mathbf{r}) = \\dfrac{1}{4\\pi \\|\\mathbf{r}\\|}$ 为三维拉普拉斯格林函数，并设 $\\mathbf{n} \\in \\mathbb{R}^3$ 和 $\\mathbf{a} \\in \\mathbb{R}^3$ 为固定的常数向量，且 $\\|\\mathbf{n}\\| = 1$。一个捕获了切向超奇异麦克斯韦算子斜互易特性的标量值超奇异核为\n$$\nK(\\mathbf{x},\\mathbf{y}) \\;=\\; \\frac{\\mathbf{n} \\cdot \\left( (\\mathbf{x}-\\mathbf{y}) \\times \\mathbf{a} \\right)}{\\|\\mathbf{x}-\\mathbf{y}\\|^4},\n$$\n其为奇函数，即 $K(\\mathbf{x},\\mathbf{y}) = -K(\\mathbf{y},\\mathbf{x})$。在考虑了叉积分子后，该核的标度为 $\\|\\mathbf{x}-\\mathbf{y}\\|^{-3}$，即它在三维空间中是超奇异的。对于良好分离的面板，双重面积分是有限的；而对于重合的面板，正则化中使用分布意义下的柯西主值。在连续情况下，双线性形式 $b(\\varphi,\\psi) \\equiv \\iint K(\\mathbf{x},\\mathbf{y}) \\varphi(\\mathbf{x}) \\psi(\\mathbf{y}) \\, \\mathrm{d}S_{\\mathbf{x}} \\mathrm{d}S_{\\mathbf{y}}$ 是反对称的，即 $b(\\varphi,\\psi) = -b(\\psi,\\varphi)$，这代表了一种斜互易性质。\n\n您将为此正则化超奇异核构建一个离散互易性的数值测试，方法是组装两个平面三角形面板之间的单个矩阵项，交换源面板和观测面板，并测量反对称性的违反程度。离散化在每个三角形上使用分片常数测试函数和试探函数，并在每个面板上使用低阶三角形高斯求积法则的张量积。将控制网格各向异性比率，以研究其对离散互易性误差的影响。\n\n三角形定义如下。设 $\\mathbb{R}^3$ 中的参考三角形为\n$$\n\\widehat{T} \\;=\\; \\operatorname{conv}\\left\\{ (0,0,0)^\\top, (1,0,0)^\\top, (0,1,0)^\\top \\right\\},\n$$\n其中 $\\operatorname{conv}\\{\\cdot\\}$ 表示凸包。对于给定的网格各向异性比率 $r \\ge 1$，定义各向异性线性映射\n$$\n\\mathbf{M}(r) \\;=\\; \\begin{pmatrix} r  0  0 \\\\ 0  1/r  0 \\\\ 0  0  1 \\end{pmatrix},\n$$\n该映射保持面积（因为 $\\det \\mathbf{M}(r) = 1$），同时将三角形的纵横比改变一个因子 $r$。设 $\\mathbf{R}$ 为 $xy$ 平面内旋转 $90^\\circ$ 的旋转矩阵，\n$$\n\\mathbf{R} \\;=\\; \\begin{pmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{pmatrix}.\n$$\n对于每个 $r$，定义两个三角形：\n- 观测三角形 $T^{(1)}(r)$，其顶点为 $\\mathbf{v}^{(1)}_0 = \\mathbf{M}(r) (0,0,0)^\\top$, $\\mathbf{v}^{(1)}_1 = \\mathbf{M}(r) (1,0,0)^\\top$, $\\mathbf{v}^{(1)}_2 = \\mathbf{M}(r) (0,1,0)^\\top$。\n- 源三角形 $T^{(2)}(r)$，其顶点首先由 $\\mathbf{M}(r)$ 和 $\\mathbf{R}$ 映射，然后通过偏移向量 $\\mathbf{t} = (0.31,\\,0.19,\\,0.27)^\\top$ 平移：\n$$\n\\mathbf{v}^{(2)}_j \\;=\\; \\mathbf{R}\\,\\mathbf{M}(r)\\,\\widehat{\\mathbf{v}}_j \\;+\\; \\mathbf{t}, \\quad j \\in \\{0,1,2\\},\n$$\n其中 $\\widehat{\\mathbf{v}}_0 = (0,0,0)^\\top$, $\\widehat{\\mathbf{v}}_1 = (1,0,0)^\\top$, $\\widehat{\\mathbf{v}}_2 = (0,1,0)^\\top$。\n\n对于顶点为 $\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v_2}$ 的三角形 $T$ 上的数值积分，使用对称三点高斯求积（2阶精度），其重心坐标节点 $(\\lambda_1,\\lambda_2,\\lambda_3)$ 等于 $(2/3,\\,1/6,\\,1/6)$ 的三个排列，每个在参考三角形上的权重为 $w=1/6$，然后通过雅可比行列式进行缩放以获得 $T$ 上的权重。如果 $\\mathcal{Q}(T) = \\{(\\mathbf{x}_i, w_i)\\}_{i=1}^3$ 是 $T$ 上的求积节点和权重，则两个不相交三角形 $T^{(o)}$ 和 $T^{(s)}$ 的离散矩阵项定义为\n$$\nA\\big(T^{(o)},T^{(s)}\\big) \\;\\equiv\\; \\sum_{i=1}^3 \\sum_{j=1}^3 w^{(o)}_i \\, w^{(s)}_j \\, K\\!\\left(\\mathbf{x}^{(o)}_i, \\mathbf{x}^{(s)}_j\\right).\n$$\n对于重合的面板，通过柯西主值定义正则化的对角项，对于这个奇核，该值恒为零，必须强制设为 $A(T,T)=0$。\n\n定义一对各向异性为 $r$ 的三角形的离散互易性（反对称性）残差为\n$$\n\\varepsilon(r) \\;=\\; \\frac{\\big|A\\big(T^{(1)}(r),T^{(2)}(r)\\big) + A\\big(T^{(2)}(r),T^{(1)}(r)\\big)\\big|}{\\max\\!\\left(10^{-16},\\, \\big|A\\big(T^{(1)}(r),T^{(2)}(r)\\big)\\big| + \\big|A\\big(T^{(2)}(r),T^{(1)}(r)\\big)\\big|\\right)}.\n$$\n在精确算术和精确求积下，由于反对称性，$\\varepsilon(r)=0$。实际上，各向异性单元上的离散求积会引入偏差，可以通过改变 $r$ 来探测这种偏差。\n\n您的任务是编写一个完整的程序，该程序：\n1. 实现核 $K(\\mathbf{x},\\mathbf{y})$，使用固定向量 $\\mathbf{n} = (0,0,1)^\\top$ 和 $\\mathbf{a} = \\dfrac{1}{\\sqrt{1^2 + 0.7^2 + 0.2^2}} (1,\\,0.7,\\,0.2)^\\top$。\n2. 为指定测试套件中的每个各向异性比率 $r$ 构建三角形 $T^{(1)}(r)$ 和 $T^{(2)}(r)$。\n3. 使用上述三点三角形求积法计算 $A\\big(T^{(1)}(r),T^{(2)}(r)\\big)$ 和 $A\\big(T^{(2)}(r),T^{(1)}(r)\\big)$，并计算 $\\varepsilon(r)$。\n4. 按照下面指定的精确格式报告结果。\n\n测试套件：\n- 使用网格各向异性比率 $r \\in \\{1.0,\\,3.0,\\,10.0,\\,30.0,\\,100.0\\}$。\n\n答案规范：\n- 对于测试套件中的每个 $r$，计算如上定义的浮点数 $\\varepsilon(r)$。\n- 您的程序应生成单行输出，其中包含按测试套件顺序排列的结果，格式为方括号内的逗号分隔列表 $[\\varepsilon(1.0),\\varepsilon(3.0),\\varepsilon(10.0),\\varepsilon(30.0),\\varepsilon(100.0)]$。\n- 不需要物理单位；输出是无量纲的。定义中出现的角度，通过 $\\mathbf{R}$ 的构造，单位是弧度。\n\n约束：\n- 仅使用指定的三点三角形求积法则；不要使用自适应加密或更高阶的法则。\n- 将对角项的正则化实现为 $A(T,T)=0$；在此任务中，仅对不相交的三角形进行积分，因此不需要对角项。\n- 通过在 $\\varepsilon(r)$ 的定义中使用分母正则化 $10^{-16}$ 来确保数值稳定性。", "solution": "该问题要求对一个模型超奇异积分算子核的离散互易性质进行数值研究。由\n$$\nK(\\mathbf{x},\\mathbf{y}) \\;=\\; \\frac{\\mathbf{n} \\cdot \\left( (\\mathbf{x}-\\mathbf{y}) \\times \\mathbf{a} \\right)}{\\|\\mathbf{x}-\\mathbf{y}\\|^4},\n$$\n给出的连续核是反对称的（或奇的），意味着 $K(\\mathbf{x},\\mathbf{y}) = -K(\\mathbf{y},\\mathbf{x})$。该性质导致了一个斜互易双线性形式，$b(\\varphi,\\psi) = -b(\\psi,\\varphi)$，这是某些电磁和声学积分公式中的一个基本性质。当使用数值方法进行离散化时，由于近似误差，这种连续对称性可能会被破坏。本练习旨在量化这种反对称性的破坏程度与网格单元各向异性的函数关系。\n\n总体过程包括以下步骤：\n1.  **几何建模**：对于测试套件中的每个各向异性比率 $r$，我们构建两个平面三角形面板，一个观测三角形 $T^{(1)}(r)$ 和一个源三角形 $T^{(2)}(r)$。它们的几何形状是通过一系列线性变换从一个参考三角形 $\\widehat{T}$ 派生出来的。\n2.  **数值求积**：两个三角形之间的相互作用积分通过在每个三角形上使用一个3点对称高斯求积法则的张量积来近似。这涉及将参考求积点映射到物理三角形上，并计算相应的权重。\n3.  **矩阵元组装**：离散相互作用，或称矩阵元，$A(T^{(o)}, T^{(s)})$，通过对所有求积点对上的核函数求值进行适当加权求和来计算。\n4.  **互易性误差计算**：理论上的反对称性意味着 $A(T^{(1)}, T^{(2)}) + A(T^{(2)}, T^{(1)}) = 0$。我们数值计算这个和，并将其归一化以获得离散互易性残差 $\\varepsilon(r)$，该残差衡量对称性被破坏的程度。\n\n**1. 三角形构建**\n对于给定的各向异性比率 $r \\ge 1$，定义了两个三角形。观测三角形 $T^{(1)}(r)$ 是通过将一个保持面积的各向异性缩放映射 $\\mathbf{M}(r)$ 应用于参考三角形 $\\widehat{T} = \\operatorname{conv}\\left\\{ \\widehat{\\mathbf{v}}_0, \\widehat{\\mathbf{v}}_1, \\widehat{\\mathbf{v}}_2 \\right\\}$ 的顶点而生成的，其中 $\\widehat{\\mathbf{v}}_0 = (0,0,0)^\\top$, $\\widehat{\\mathbf{v}}_1 = (1,0,0)^\\top$, $\\widehat{\\mathbf{v}}_2 = (0,1,0)^\\top$。因此，$T^{(1)}(r)$ 的顶点为 $\\mathbf{v}^{(1)}_j = \\mathbf{M}(r)\\widehat{\\mathbf{v}}_j$（$j \\in \\{0, 1, 2\\}$），其中\n$$\n\\mathbf{M}(r) \\;=\\; \\begin{pmatrix} r  0  0 \\\\ 0  1/r  0 \\\\ 0  0  1 \\end{pmatrix}.\n$$\n源三角形 $T^{(2)}(r)$ 的生成方法是，首先应用相同的缩放映射 $\\mathbf{M}(r)$，然后绕 $z$ 轴旋转 $90^\\circ$ 的旋转 $\\mathbf{R}$，最后通过一个常数偏移向量 $\\mathbf{t} = (0.31, 0.19, 0.27)^\\top$ 进行平移。其顶点由 $\\mathbf{v}^{(2)}_j = \\mathbf{R}\\,\\mathbf{M}(r)\\,\\widehat{\\mathbf{v}}_j + \\mathbf{t}$ 给出，其中\n$$\n\\mathbf{R} \\;=\\; \\begin{pmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{pmatrix}.\n$$\n值得注意的是，$T^{(1)}(r)$位于 $z=0$ 平面，而 $T^{(2)}(r)$ 位于 $z=0.27$ 平面，从而确保它们不相交。对于所有的 $r$，两个三角形的面积都是 $1/2$，这是 $\\det(\\mathbf{M}(r)) = 1$ 以及旋转和平移是等距变换的结果。\n\n**2. 求积法则实现**\n在顶点为 $\\mathbf{v}_0, \\mathbf{v}_1, \\mathbf{v}_2$ 的三角形 $T$ 上的积分使用一个3点法则来近似。求积点 $\\mathbf{x}_k$ 由其相对于顶点的重心坐标确定。问题指定了对应于 $(\\lambda_0, \\lambda_1, \\lambda_2) = (2/3, 1/6, 1/6)$ 三种排列的节点。因此，三角形 $T$ 上的三个求积点是：\n$$\n\\begin{aligned}\n\\mathbf{x}_1 = \\frac{2}{3}\\mathbf{v}_0 + \\frac{1}{6}\\mathbf{v}_1 + \\frac{1}{6}\\mathbf{v}_2 \\\\\n\\mathbf{x}_2 = \\frac{1}{6}\\mathbf{v}_0 + \\frac{2}{3}\\mathbf{v}_1 + \\frac{1}{6}\\mathbf{v}_2 \\\\\n\\mathbf{x}_3 = \\frac{1}{6}\\mathbf{v}_0 + \\frac{1}{6}\\mathbf{v}_1 + \\frac{2}{3}\\mathbf{v}_2\n\\end{aligned}\n$$\n物理三角形 $T$ 上的求积权重 $w_k$ 是从参考权重派生出来的。每个参考权重为 $\\hat{w} = 1/6$。这些权重通过从参考三角形 $\\widehat{T}$ 到 $T$ 的仿射映射的雅可比行列式进行缩放，即 $J = \\text{Area}(T) / \\text{Area}(\\widehat{T})$。由于 $\\text{Area}(\\widehat{T}) = 1/2$，雅可比行列式为 $J = 2\\,\\text{Area}(T)$。每个点的物理权重为 $w_k = \\hat{w} J = (1/6) \\cdot 2\\,\\text{Area}(T) = \\text{Area}(T)/3$。由于所有生成的三角形的面积均为 $1/2$，所以每个权重都是常数 $w_k = (1/2)/3 = 1/6$。\n\n**3. 矩阵元计算**\n使用分片常数基函数，观测三角形 $T^{(o)}$ 和源三角形 $T^{(s)}$ 之间的离散相互作用是双重积分 $\\iint K(\\mathbf{x}, \\mathbf{y})\\,dS_{\\mathbf{x}} dS_{\\mathbf{y}}$ 的一个近似。使用所述的求积法则，这可以计算为一个双重求和：\n$$\nA\\big(T^{(o)}, T^{(s)}\\big) \\;\\equiv\\; \\sum_{i=1}^3 \\sum_{j=1}^3 w^{(o)}_i \\, w^{(s)}_j \\, K\\!\\left(\\mathbf{x}^{(o)}_i, \\mathbf{x}^{(s)}_j\\right)\n$$\n其中 $\\{(\\mathbf{x}^{(o)}_i, w^{(o)}_i)\\}$ 和 $\\{(\\mathbf{x}^{(s)}_j, w^{(s)}_j)\\}$ 分别是三角形 $T^{(o)}$ 和 $T^{(s)}$ 的求积点和权重。核函数 $K(\\mathbf{x}, \\mathbf{y})$ 使用指定的固定向量进行求值：$\\mathbf{n} = (0,0,1)^\\top$ 和 $\\mathbf{a} = \\frac{1}{\\sqrt{1.53}}(1, 0.7, 0.2)^\\top$。\n\n**4. 反对称性残差**\n连续核的反对称性 $K(\\mathbf{x},\\mathbf{y}) = -K(\\mathbf{y},\\mathbf{x})$ 意味着在没有数值误差的情况下，我们应该有 $A\\big(T^{(1)}, T^{(2)}\\big) = -A\\big(T^{(2)}, T^{(1)}\\big)$。数值残差 $\\varepsilon(r)$ 衡量了这种离散关系的失效程度：\n$$\n\\varepsilon(r) \\;=\\; \\frac{\\big|A\\big(T^{(1)}(r), T^{(2)}(r)\\big) + A\\big(T^{(2)}(r), T^{(1)}(r)\\big)\\big|}{\\max\\!\\left(10^{-16},\\, \\big|A\\big(T^{(1)}(r), T^{(2)}(r)\\big)\\big| + \\big|A\\big(T^{(2)}(r), T^{(1)}(r)\\big|\\right)}\n$$\n对测试套件 $\\{1.0, 3.0, 10.0, 30.0, 100.0\\}$ 中的每个 $r$ 计算此量。随着 $r$ 的增加，三角形变得更加细长，固定的3点求积法则预计会变得不那么准确，从而导致更大的残差 $\\varepsilon(r)$。程序实现了这一整个计算序列。", "answer": "```python\nimport numpy as np\n\n# Constants defined as per the problem statement\nN_VEC = np.array([0.0, 0.0, 1.0])\nA_VEC_RAW = np.array([1.0, 0.7, 0.2])\nA_VEC = A_VEC_RAW / np.linalg.norm(A_VEC_RAW)\nT_VEC = np.array([0.31, 0.19, 0.27])\nREF_VERTS = np.array([[0.0, 0.0, 0.0], [1.0, 0.0, 0.0], [0.0, 1.0, 0.0]])\nR_MAT = np.array([[0.0, -1.0, 0.0], [1.0, 0.0, 0.0], [0.0, 0.0, 1.0]])\n\n# Barycentric coordinates for the 3-point symmetric Gaussian quadrature rule\nBARY_COORDS = np.array([\n    [2/3, 1/6, 1/6],\n    [1/6, 2/3, 1/6],\n    [1/6, 1/6, 2/3]\n])\n\ndef get_triangle_vertices(r, index):\n    \"\"\"\n    Constructs the vertices of a triangle based on the anisotropy ratio r and an index.\n    index=1 for observation triangle T^(1), index=2 for source triangle T^(2).\n    \"\"\"\n    M_mat = np.array([[r, 0.0, 0.0], [0.0, 1/r, 0.0], [0.0, 0.0, 1.0]])\n    \n    if index == 1:\n        # Transformation for T^(1): M(r) * v_ref\n        # Apply M_mat to each row vector in REF_VERTS.\n        verts = np.dot(REF_VERTS, M_mat.T)\n    elif index == 2:\n        # Transformation for T^(2): R * M(r) * v_ref + t\n        transformed_verts = np.dot(REF_VERTS, M_mat.T)\n        rotated_verts = np.dot(transformed_verts, R_MAT.T)\n        verts = rotated_verts + T_VEC\n    else:\n        raise ValueError(\"Triangle index must be 1 or 2.\")\n    return verts\n\ndef get_quadrature_data(vertices):\n    \"\"\"\n    Computes the 3-point Gaussian quadrature points and weights for a given triangle.\n    \"\"\"\n    # Quadrature points are derived from barycentric coordinates\n    quad_points = np.dot(BARY_COORDS, vertices)\n\n    # Quadrature weights depend on the triangle's area\n    v0, v1, v2 = vertices[0], vertices[1], vertices[2]\n    edge1 = v1 - v0\n    edge2 = v2 - v0\n    area = 0.5 * np.linalg.norm(np.cross(edge1, edge2))\n    \n    # Weight on reference triangle is 1/6. Jacobian of map is 2*Area.\n    # Physical weight is w_ref * Jacobian = (1/6) * (2*Area) = Area/3.\n    quad_weights = np.full(3, area / 3.0)\n    \n    return quad_points, quad_weights\n\ndef kernel_K(x, y):\n    \"\"\"\n    Evaluates the scalar-valued hypersingular kernel K(x, y).\n    \"\"\"\n    r_vec = x - y\n    r_norm = np.linalg.norm(r_vec)\n    \n    # Numerator is n . ((x-y) x a)\n    numerator = np.dot(N_VEC, np.cross(r_vec, A_VEC))\n    \n    # Denominator is ||x-y||^4\n    denominator = r_norm**4\n    \n    return numerator / denominator\n\ndef compute_matrix_entry(obs_verts, src_verts):\n    \"\"\"\n    Calculates the discrete matrix entry A(T_obs, T_src) using numerical quadrature.\n    \"\"\"\n    obs_points, obs_weights = get_quadrature_data(obs_verts)\n    src_points, src_weights = get_quadrature_data(src_verts)\n    \n    matrix_entry = 0.0\n    for i in range(3):\n        for j in range(3):\n            # Sum weighted kernel evaluations over all quadrature point pairs\n            matrix_entry += obs_weights[i] * src_weights[j] * kernel_K(obs_points[i], src_points[j])\n            \n    return matrix_entry\n\ndef solve():\n    \"\"\"\n    Main function to execute the numerical experiment, compute the reciprocity\n    residuals for the specified test cases, and print the results in the\n    required format.\n    \"\"\"\n    test_cases = [1.0, 3.0, 10.0, 30.0, 100.0]\n    results = []\n\n    for r in test_cases:\n        # 1. Construct the two triangles for the given anisotropy ratio r.\n        verts1 = get_triangle_vertices(r, 1) # T^(1)(r)\n        verts2 = get_triangle_vertices(r, 2) # T^(2)(r)\n        \n        # 2. Evaluate the matrix entries using numerical quadrature.\n        A12 = compute_matrix_entry(verts1, verts2)\n        A21 = compute_matrix_entry(verts2, verts1)\n        \n        # 3. Compute the discrete reciprocity (antisymmetry) residual epsilon(r).\n        numerator = abs(A12 + A21)\n        # Denominator is regularized to prevent division by zero, as per problem spec.\n        denominator = max(1e-16, abs(A12) + abs(A21))\n\n        epsilon_r = numerator / denominator\n        results.append(epsilon_r)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3316221"}]}