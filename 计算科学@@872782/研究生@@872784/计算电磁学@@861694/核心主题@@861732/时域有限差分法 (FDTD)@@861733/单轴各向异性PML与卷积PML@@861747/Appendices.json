{"hands_on_practices": [{"introduction": "在时域有限差分 (FDTD) 方法中，数值稳定性由 Courant–Friedrichs–Lewy (CFL) 条件严格控制。当在计算域中引入单轴各向异性完美匹配层 (UPML) 时，其材料参数会改变介质中的有效波速，从而直接影响稳定性极限。本练习旨在通过严格的 von Neumann 稳定性分析，推导在存在 UPML 的情况下 FDTD 格式的 CFL 条件，这对于设置稳定且高效的数值仿真至关重要。通过此实践，您将深入理解 UPML 的 $\\kappa$ 参数如何影响最大允许时间步长 $\\Delta t$，这直接关系到仿真的计算成本。", "problem": "考虑一个三维时域有限差分 (FDTD) 格式，该格式构建在间距为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 的均匀 Yee 网格上，并实现了一个由复坐标伸缩描述的单轴完美匹配层 (UPML)。其底层物理受线性介质中的麦克斯韦方程组控制，即 $\\nabla \\times \\mathbf{E} = -\\partial \\mathbf{B}/\\partial t$、$\\nabla \\times \\mathbf{H} = \\partial \\mathbf{D}/\\partial t$，以及本构关系 $\\mathbf{D} = \\overline{\\overline{\\epsilon}}\\,\\mathbf{E}$、$\\mathbf{B} = \\overline{\\overline{\\mu}}\\,\\mathbf{H}$，其中真空中光速为 $c = 1/\\sqrt{\\epsilon_{0}\\mu_{0}}$。在 UPML 中，材料张量 $\\overline{\\overline{\\epsilon}}$ 和 $\\overline{\\overline{\\mu}}$ 由一个对角复伸缩算子 $\\overline{\\overline{s}} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$ 导出，具体如下：\n$$\n\\overline{\\overline{\\epsilon}} = \\epsilon_{0}\\,\\epsilon_{r}\\,\\mathrm{diag}\\!\\left(\\frac{s_{y}s_{z}}{s_{x}},\\,\\frac{s_{x}s_{z}}{s_{y}},\\,\\frac{s_{x}s_{y}}{s_{z}}\\right), \\quad\n\\overline{\\overline{\\mu}} = \\mu_{0}\\,\\mu_{r}\\,\\mathrm{diag}\\!\\left(\\frac{s_{y}s_{z}}{s_{x}},\\,\\frac{s_{x}s_{z}}{s_{y}},\\,\\frac{s_{x}s_{y}}{s_{z}}\\right).\n$$\n假设一个均匀的 UPML 区域，其对角伸缩因子为常数，并以卷积完美匹配层 (CPML) 的形式建模：\n$$\ns_{i}(\\omega) = \\kappa_{i} + \\frac{\\sigma_{i}}{\\alpha_i + j\\omega\\epsilon_0}, \\quad i \\in \\{x,y,z\\},\n$$\n其中 $\\kappa_{i} \\geq 1$、$\\sigma_{i} \\geq 0$ 和 $\\alpha_{i} \\geq 0$ 是常数。使用 Yee 格式的离散平面波 (von Neumann) 分析以及上述各向异性本构关系，推导时间步长 $\\Delta t$ 的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，该条件保证了在均匀 UPML 中对所有可分辨的离散空间频率的绝对稳定性。明确展示对角伸缩幅度 $|s_{i}(\\omega)|$ 如何通过有效波速进入该条件，并论证损耗项 $\\sigma_{i}$ 和 $\\alpha_{i}$ 如何影响对 $\\Delta t$ 的最终约束。\n\n提供最大稳定时间步长 $\\Delta t_{\\max}$ 的最终闭式表达式，该表达式用 $c$、$\\Delta x$、$\\Delta y$、$\\Delta z$ 和 $\\kappa_{i}$ 表示，并保证在该均匀 UPML 中对所有频率一致有效。时间步长限制以秒为单位表示。无需四舍五入。", "solution": "本问题要求推导在由复坐标伸缩描述的单轴完美匹配层 (UPML) 中，一个三维时域有限差分 (FDTD) 格式的 Courant–Friedrichs–Lewy (CFL) 稳定性条件。分析将采用离散平面波 (von Neumann) 稳定性分析方法。\n\n在频域中，应用由给定的各向异性张量隐式定义的伸缩坐标变换后，得到的连续平面波 $\\mathbf{E} = \\mathbf{E}_{0} \\exp(j\\omega t - j\\mathbf{k} \\cdot \\mathbf{r})$ 的色散关系为：\n$$\n\\frac{k_{x}^{2}}{s_{x}(\\omega)^{2}} + \\frac{k_{y}^{2}}{s_{y}(\\omega)^{2}} + \\frac{k_{z}^{2}}{s_{z}(\\omega)^{2}} = \\omega^{2}\\mu_{0}\\mu_{r}\\epsilon_{0}\\epsilon_{r} = \\frac{\\omega^{2}}{v_{m}^{2}}\n$$\n其中 $k_{x}$、$k_{y}$、$k_{z}$ 是波矢量 $\\mathbf{k}$ 的分量，$\\omega$ 是角频率，而 $v_{m} = 1/\\sqrt{\\mu_{0}\\mu_{r}\\epsilon_{0}\\epsilon_{r}} = c/\\sqrt{\\mu_{r}\\epsilon_{r}}$ 是背景介质中的光速。问题要求最终表达式用 $c$ 表示，这意味着背景介质是真空，所以 $\\epsilon_{r}=1$，$\\mu_{r}=1$，且 $v_{m}=c$。\n\nFDTD 方法对空间和时间都进行离散化。在 von Neumann 分析中，我们考察单个离散平面波模式在 Yee 网格上的行为。通过用有限差分算子替换连续导数算子，可以得到数值色散关系。对于均匀网格上的中心差分格式，这些替换如下：\n$$\n\\frac{\\partial}{\\partial t} \\rightarrow \\frac{Z^{1/2} - Z^{-1/2}}{\\Delta t} \\quad \\text{或} \\quad \\omega \\rightarrow \\tilde{\\omega} = \\frac{2}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\n$$\n$$\n\\frac{\\partial}{\\partial i} \\rightarrow \\frac{e^{-j k_{i} \\Delta i/2} - e^{j k_{i} \\Delta i/2}}{\\Delta i} \\quad \\text{或} \\quad k_{i} \\rightarrow \\tilde{k}_{i} = \\frac{2}{\\Delta i} \\sin\\left(\\frac{k_{i} \\Delta i}{2}\\right) \\quad \\text{对于 } i \\in \\{x, y, z\\}\n$$\n其中 $Z = \\exp(j\\omega\\Delta t)$ 是放大因子，$\\Delta t, \\Delta x, \\Delta y, \\Delta z$ 分别是时间和空间步长。\n\n对于像 CPML 这样的色散介质，数值格式的稳定性由介质的高频响应决定。CFL 条件是对网格上信息传播最大速度的约束。这个速度由介质在无限频率极限下（$\\omega \\rightarrow \\infty$）的性质决定，这对应于瞬时响应。包括有效 PML 公式在内的因果材料模型，其色散特性必须在无限频率下消失。\n\n我们已知复伸缩因子为：\n$$\ns_{i}(\\omega) = \\kappa_{i} + \\frac{\\sigma_{i}}{\\alpha_i + j\\omega\\epsilon_0}, \\quad i \\in \\{x,y,z\\}\n$$\n在高频极限下，我们有：\n$$\n\\lim_{\\omega\\to\\infty} s_{i}(\\omega) = \\lim_{\\omega\\to\\infty} \\left( \\kappa_{i} + \\frac{\\sigma_{i}}{\\alpha_i + j\\omega\\epsilon_0} \\right) = \\kappa_{i}\n$$\n因为分母中包含 $\\omega$ 的项会消失。因此，为了确定 CFL 稳定性条件，UPML 的行为就像一个具有实数伸缩因子 $s_{i} = \\kappa_{i}$ 的简单非色散各向异性介质。\n\n必须考虑损耗参数 $\\sigma_{i}$ 和 $\\alpha_{i}$ 的影响。这些参数控制 PML 的吸收特性。假设PML被正确设计为无源的（对于CPML的标准形式，$\\sigma_i, \\kappa_i, \\alpha_i \\ge 0$ 即可保证），则损耗项会向系统中引入阻尼。阻尼只会使 FDTD 格式更稳定（即减小放大因子 $|Z|$ 的大小）；它不会使对 $\\Delta t$ 的稳定性条件变得更严格。因此，稳定性条件由最坏情况下的无损耗场景决定，这对应于 $s_{i}=\\kappa_{i}$ 的高频极限。\n\n将高频伸缩因子 $s_{i} = \\kappa_{i}$ 和 FDTD 数值算子代入连续色散关系，我们得到系统的数值色散关系：\n$$\n\\frac{1}{c^{2}} \\left( \\frac{2}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right)^{2} = \\frac{1}{\\kappa_{x}^{2}} \\left( \\frac{2}{\\Delta x} \\sin\\left(\\frac{k_{x} \\Delta x}{2}\\right) \\right)^{2} + \\frac{1}{\\kappa_{y}^{2}} \\left( \\frac{2}{\\Delta y} \\sin\\left(\\frac{k_{y} \\Delta y}{2}\\right) \\right)^{2} + \\frac{1}{\\kappa_{z}^{2}} \\left( \\frac{2}{\\Delta z} \\sin\\left(\\frac{k_{z} \\Delta z}{2}\\right) \\right)^{2}\n$$\n解出 $\\sin^{2}(\\omega \\Delta t/2)$:\n$$\n\\sin^{2}\\left(\\frac{\\omega \\Delta t}{2}\\right) = (c \\Delta t)^{2} \\left[ \\frac{\\sin^{2}\\left(\\frac{k_{x} \\Delta x}{2}\\right)}{(\\kappa_{x}\\Delta x)^{2}} + \\frac{\\sin^{2}\\left(\\frac{k_{y} \\Delta y}{2}\\right)}{(\\kappa_{y}\\Delta y)^{2}} + \\frac{\\sin^{2}\\left(\\frac{k_{z} \\Delta z}{2}\\right)}{(\\kappa_{z}\\Delta z)^{2}} \\right]\n$$\n对于一个稳定的格式，任何对应于实数值空间频率（$k_{x}, k_{y}, k_{z}$）的解 $\\omega$ 都必须具有非正虚部，即 $\\Im(\\omega) \\le 0$。这确保了放大因子 $|Z| = |\\exp(j\\omega\\Delta t)| = \\exp(-\\Im(\\omega)\\Delta t) \\le 1$。一个充分条件是要求对于任意实数 $k_{x}, k_{y}, k_{z}$，计算出的 $\\omega$ 都是实数。这要求 $\\sin^{2}(\\omega \\Delta t/2)$ 方程的右侧必须小于或等于 $1$。\n\n为了找到对 $\\Delta t$ 最严格的条件，我们必须使右侧相对于空间波数最大化。当正弦项的参数是 $\\pi/2$ 的奇数倍时，这些项达到最大值，此时 $\\sin^{2}(\\cdot) = 1$。这对应于网格可分辨的最高空间频率（奈奎斯特频率）。\n$$\n\\max_{k_x, k_y, k_z} \\left[ \\dots \\right] = \\frac{1}{(\\kappa_{x}\\Delta x)^{2}} + \\frac{1}{(\\kappa_{y}\\Delta y)^{2}} + \\frac{1}{(\\kappa_{z}\\Delta z)^{2}}\n$$\n将此最大值代入稳定性不等式中：\n$$\n1 \\ge (c \\Delta t)^{2} \\left[ \\frac{1}{(\\kappa_{x}\\Delta x)^{2}} + \\frac{1}{(\\kappa_{y}\\Delta y)^{2}} + \\frac{1}{(\\kappa_{z}\\Delta z)^{2}} \\right]\n$$\n解出 $\\Delta t$ 得到稳定性极限：\n$$\n(\\Delta t)^{2} \\le \\frac{1}{c^{2} \\left[ \\left(\\frac{1}{\\kappa_{x} \\Delta x}\\right)^{2} + \\left(\\frac{1}{\\kappa_{y} \\Delta y}\\right)^{2} + \\left(\\frac{1}{\\kappa_{z} \\Delta z}\\right)^{2} \\right]}\n$$\n因此，最大稳定时间步长 $\\Delta t_{\\max}$ 为：\n$$\n\\Delta t_{\\max} = \\frac{1}{c \\sqrt{\\left(\\frac{1}{\\kappa_{x} \\Delta x}\\right)^{2} + \\left(\\frac{1}{\\kappa_{y} \\Delta y}\\right)^{2} + \\left(\\frac{1}{\\kappa_{z} \\Delta z}\\right)^{2}}}\n$$\n这个表达式给出了在均匀 UPML 中，对于所有频率和所有可分辨的波传播角度都一致有效的 CFL 稳定性条件，前提是参数的选择确保了介质是无源的。假设 $c$ 的单位是米/秒，$\\Delta x, \\Delta y, \\Delta z$ 的单位是米，则 $\\Delta t$ 的最终单位是秒。", "answer": "$$\\boxed{\\frac{1}{c \\sqrt{\\left(\\frac{1}{\\kappa_{x} \\Delta x}\\right)^{2} + \\left(\\frac{1}{\\kappa_{y} \\Delta y}\\right)^{2} + \\left(\\frac{1}{\\kappa_{z} \\Delta z}\\right)^{2}}}}$$", "id": "3358766"}, {"introduction": "在掌握了 PML 的理论基础后，下一个关键步骤是在代码中正确地实现它。然而，我们如何能确信自己的复杂数值代码是无误的呢？本练习将引导您运用“制造解方法” (Method of Manufactured Solutions, MMS)，这是一种强大的软件验证技术，用于系统性地诊断和调试代码。通过精心构造一个已知的人工解，并将其代入离散化的控制方程中，您可以计算出残差，从而清晰地区分由算法实现错误导致的巨大误差和数值离散本身固有的、会随网格加密而减小的截断误差。[@problem_id:3358794] 这项实践将为您提供一项在计算科学研究中不可或缺的严谨验证技能。", "problem": "考虑沿 $x$ 轴在自由空间中的一维横向电磁波传播，其电场为 $E_y(x,t)$，磁场为 $H_z(x,t)$。其基本依据是在一个空间维度上、针对简谐时间依赖关系 $e^{j\\omega t}$ 的麦克斯韦旋度方程，在频域中写作 $dH_z/dx = j\\omega\\epsilon_0 E_y$ 和 $dE_y/dx = j\\omega\\mu_0 H_z$。完美匹配层 (PML) 可以通过复坐标伸展来建模。在单轴各向异性完美匹配层 (UAPML) 中，整个域内的一个均匀复伸展 $s_x$ 通过 $d/dx \\mapsto \\frac{1}{s_x} d/dx$ 来修正空间导数，而 $\\epsilon_0$ 和 $\\mu_0$ 保持不变。在卷积完美匹配层 (CPML) 中，对于单一频率，相同的均匀伸展可以通过将伸展分解为有理式形式 $s_x = \\kappa_x + \\frac{\\sigma_x}{j\\omega\\epsilon_0} + \\frac{\\alpha_x}{j\\omega}$ 来表示，其中 $\\kappa_x$、$\\sigma_x$ 和 $\\alpha_x$ 是实数、非负参数。\n\n您的任务是使用人造解法，通过在整个域内施加均匀复伸展来验证 PML 的实现，并计算离散残差以诊断是离散化误差还是实现误差。请按以下步骤进行：\n\n1. 从基本的一维麦克斯韦旋度方程和替换式 $d/dx \\mapsto \\frac{1}{s_x} d/dx$（对于均匀伸展 $s_x$）出发，推导在伸展介质中关于 $E_y(x)$ 的二阶标量方程，并确定由自由空间色散所隐含的波数。仅使用所述的基本定律和定义。\n\n2. 选择一个与伸展介质一致的、非平凡、空间变化且光滑的人造单色解。令自由空间波数为 $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0}$，人造电场为 $E_y(x) = E_0 \\exp(-j k_0 s_x x)$，其中振幅 $E_0 \\neq 0$ 为实数。令 $H_z(x)$ 为伸展介质中由旋度方程所对应的磁场。由于残差将被归一化，因此无需指定 $E_0$。\n\n3. 在覆盖长度为 $L$、包含 $N$ 个点、间距为 $\\Delta x = L/(N-1)$ 的均匀网格上，使用标准的二阶中心差分近似来离散化关于 $d^2E_y/dx^2$ 的二阶方程（在内部点处）。将每个内部网格点 $x_i$ 上的残差定义为，将人造场的值代入离散化方程后方程左侧的值。将归一化残差定义为残差向量的离散 $\\ell_2$ 范数与在内部点采样的人造场向量的离散 $\\ell_2$ 范数之比。此归一化残差是无量纲的。\n\n4. 对于 UAPML，使用正确的伸展方程计算归一化残差。为了模拟实现错误，计算一个求解器的归一化残差，该求解器错误地只缩放了一个本构参数（等效于，在正确方程需要 $s_x^2$ 的地方使用了 $s_x$ 的一次方）。比较两个残差的量级。\n\n5. 对于 CPML，通过参数 $\\kappa_x$、$\\sigma_x$ 和 $\\alpha_x$ 在单一频率下表示相同的均匀伸展 $s_x$。使用正确组装的 $s_x$ 计算归一化残差。为了模拟 CPML 中的实现错误，使用一个不正确的伸展 $s_x^{\\text{wrong}} = \\kappa_x + \\frac{\\sigma_x}{j\\omega}$（即电导率项缺少因子 $\\epsilon_0$）来计算归一化残差。\n\n所有物理常数和参数必须明确指定，并且人造解必须使用这些值进行评估。使用以下测试套件，以国际单位制 (SI) 表示：\n\n- 自由空间参数：$\\mu_0 = 4\\pi \\times 10^{-7}\\ \\mathrm{H/m}$，$\\epsilon_0 = 8.854187817 \\times 10^{-12}\\ \\mathrm{F/m}$。\n- 光速：$c_0 = 1/\\sqrt{\\mu_0 \\epsilon_0}$，仅在需要时用于验证。\n- 频率：$f = 1.0 \\times 10^9\\ \\mathrm{Hz}$，角频率 $\\omega = 2\\pi f$，单位为 $\\mathrm{rad/s}$。\n- 域长度：$L = 1.0\\ \\mathrm{m}$。\n- 人造伸展目标值：$s_x = 1 - 0.2 j$ (无量纲)。\n- 正确情况下的 CPML 参数：$\\kappa_x = 1.0$，$\\alpha_x = 0.0$，以及选择 $\\sigma_x$ 使得 $\\frac{\\sigma_x}{\\omega \\epsilon_0} = 0.2$，即 $\\sigma_x = 0.2\\,\\omega\\,\\epsilon_0$，单位为 $\\mathrm{S/m}$。\n\n使用以下五个测试案例计算归一化残差：\n\n- 测试 1 (UAPML，正确，细网格)：$N = 201$，$s_x = 1 - 0.2 j$，正确的二阶方程。\n- 测试 2 (UAPML，正确，粗网格)：$N = 21$，$s_x = 1 - 0.2 j$，正确的二阶方程。\n- 测试 3 (UAPML，实现错误)：$N = 201$，$s_x = 1 - 0.2 j$，但在源项中要求 $s_x^2$ 的地方使用了 $s_x$ 的一次方。\n- 测试 4 (CPML，正确组装)：$N = 201$，通过 $s_x = \\kappa_x + \\frac{\\sigma_x}{j\\omega\\epsilon_0} + \\frac{\\alpha_x}{j\\omega}$ 从 $\\kappa_x$、$\\sigma_x$、$\\alpha_x$ 计算 $s_x$，并使用正确的二阶方程。\n- 测试 5 (CPML，参数缩放错误)：$N = 201$，计算 $s_x^{\\text{wrong}} = \\kappa_x + \\frac{\\sigma_x}{j\\omega}$ (缺少 $\\epsilon_0$)，并在二阶方程中用它代替 $s_x$。\n\n程序必须为每个测试案例计算归一化残差，结果为实值浮点数。所有计算必须在 SI 单位制下进行。角度由复指数隐含，因此不需要单独的角度单位。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[r1,r2,r3,r4,r5]”），其中 r1 到 r5 分别是测试 1 到测试 5 的归一化残差。", "solution": "解决方案分四个阶段进行：1) 推导UAPML介质中电场的连续控制方程，2) 构建离散化和残差的公式，3) 分析具体的测试案例，4) 实现数值计算。\n\n**1. 控制方程的推导**\n\n我们从频域中的一维、时谐麦克斯韦旋度方程开始，假设时间依赖性为 $e^{j\\omega t}$：\n$$\n\\frac{dH_z}{dx} = j\\omega\\epsilon_0 E_y\n$$\n$$\n\\frac{dE_y}{dx} = j\\omega\\mu_0 H_z\n$$\n单轴各向异性 PML (UAPML) 通过引入一个在整个域内均匀的复坐标伸展因子 $s_x$ 来建模。这将空间导数算子修改为 $d/dx \\rightarrow \\frac{1}{s_x} d/dx$。将此变换应用于麦克斯韦方程，得到：\n$$\n\\frac{1}{s_x} \\frac{dH_z}{dx} = j\\omega\\epsilon_0 E_y \\quad \\implies \\quad \\frac{dH_z}{dx} = j\\omega\\epsilon_0 s_x E_y \\quad (1)\n$$\n$$\n\\frac{1}{s_x} \\frac{dE_y}{dx} = j\\omega\\mu_0 H_z \\quad \\implies \\quad \\frac{dE_y}{dx} = j\\omega\\mu_0 s_x H_z \\quad (2)\n$$\n为了得到关于 $E_y(x)$ 的二阶方程，我们对方程 (2) 对 $x$ 求导，并代入方程 (1)。由于 $s_x$ 是一个常数，我们按以下步骤进行。首先，从方程 (2) 中分离出 $H_z$：\n$$\nH_z = \\frac{1}{j\\omega\\mu_0 s_x} \\frac{dE_y}{dx}\n$$\n接下来，将这个 $H_z$ 的表达式对 $x$ 求导：\n$$\n\\frac{dH_z}{dx} = \\frac{1}{j\\omega\\mu_0 s_x} \\frac{d^2E_y}{dx^2}\n$$\n将此式代入方程 (1) 得到：\n$$\n\\frac{1}{j\\omega\\mu_0 s_x} \\frac{d^2E_y}{dx^2} = j\\omega\\epsilon_0 s_x E_y\n$$\n整理各项，我们得到关于 $E_y(x)$ 的亥姆霍兹型方程：\n$$\n\\frac{d^2E_y}{dx^2} = (j\\omega s_x)^2 \\mu_0 \\epsilon_0 E_y = -\\omega^2 \\mu_0 \\epsilon_0 s_x^2 E_y\n$$\n定义自由空间波数为 $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0}$，我们有 $k_0^2 = \\omega^2 \\mu_0 \\epsilon_0$。最终的二阶标量方程是：\n$$\n\\frac{d^2E_y}{dx^2} + k_0^2 s_x^2 E_y = 0\n$$\n该方程表明，伸展介质中的有效波数是 $k_s = k_0 s_x$。\n\n给定的人造解是 $E_y(x) = E_0 \\exp(-j k_0 s_x x)$。这是一个以复波数 $k_s$ 传播的平面波，它是所推导的连续方程的精确解。\n\n**2. 离散化与残差定义**\n\n长度为 $L$ 的域被离散化为一个包含 $N$ 个点的均匀网格 $\\{x_i\\}_{i=0}^{N-1}$，间距为 $\\Delta x = L/(N-1)$。在内部网格点 $x_i$ ($1 \\le i \\le N-2$) 处，$E_y$ 的二阶导数使用二阶中心有限差分近似：\n$$\n\\frac{d^2E_y}{dx^2}\\bigg|_{x_i} \\approx \\frac{E_y(x_{i+1}) - 2E_y(x_i) + E_y(x_{i-1})}{\\Delta x^2}\n$$\n将此近似代入控制方程，得到离散化方程。在每个内部点 $x_i$ 上的残差 $R_i$ 定义为将精确人造解 $E_{y,i}^{\\text{manuf}} = E_y(x_i)$ 代入离散化方程后的值。对于正确的控制方程，残差为：\n$$\nR_i = \\frac{E_{y,i+1}^{\\text{manuf}} - 2E_{y,i}^{\\text{manuf}} + E_{y,i-1}^{\\text{manuf}}}{\\Delta x^2} + k_0^2 s_x^2 E_{y,i}^{\\text{manuf}}\n$$\n该残差不为零的唯一原因是有限差分近似的截断误差。对于实现错误，残差表达式将基于错误实现的方程，从而导致一个大得多的值。\n\n归一化残差 $r$ 是残差向量 $\\vec{R} = (R_1, ..., R_{N-2})$ 的离散 $\\ell_2$-范数与在内部点上采样的人造场向量 $\\vec{E}^{\\text{manuf}} = (E_{y,1}^{\\text{manuf}}, ..., E_{y,N-2}^{\\text{manuf}})$ 的离散 $\\ell_2$-范数之比：\n$$\nr = \\frac{\\|\\vec{R}\\|_{\\ell_2}}{\\|\\vec{E}^{\\text{manuf}}\\|_{\\ell_2}} = \\frac{\\sqrt{\\sum_{i=1}^{N-2} |R_i|^2}}{\\sqrt{\\sum_{i=1}^{N-2} |E_{y,i}^{\\text{manuf}}|^2}}\n$$\n\n**3. 测试案例分析**\n\n令 $s_x^{\\text{target}} = 1 - 0.2j$。人造解始终为 $E_y(x) = E_0\\exp(-j k_0 s_x^{\\text{target}} x)$。不失一般性，我们设 $E_0=1$。\n\n- **测试 1 & 2 (UAPML，正确)：** 使用 $N=201$ 和 $N=21$ 的正确离散化方程计算残差。残差仅反映离散化误差。由于中心差分格式是二阶精确的，误差与 $\\Delta x^2$ 成正比。$N=21$ 的网格 ($\\Delta x = 1/20$) 比 $N=201$ 的网格 ($\\Delta x = 1/200$) 粗 10 倍，因此我们预期测试 2 的残差大约是测试 1 的 $10^2=100$ 倍。\n\n- **测试 3 (UAPML，错误)：** 针对实现中的一个错误计算残差，其中控制方程被假设为 $\\frac{d^2E_y}{dx^2} + k_0^2 s_x E_y = 0$。将人造解（其解的是正确的方程）代入这个不正确的离散形式中。由此产生的残差主要由建模误差项 $k_0^2(s_x-s_x^2)E_y$ 主导，该项不会随着 $\\Delta x \\to 0$ 而消失。此残差应比测试 1 中的离散化误差大几个数量级。\n\n- **测试 4 (CPML，正确)：** 伸展因子由其 CPML 参数组装而成：$s_x = \\kappa_x + \\frac{\\sigma_x}{j\\omega\\epsilon_0} + \\frac{\\alpha_x}{j\\omega}$。当 $\\kappa_x=1.0$，$\\alpha_x=0.0$ 且 $\\sigma_x = 0.2\\omega\\epsilon_0$ 时，我们得到 $s_x = 1.0 + \\frac{0.2\\omega\\epsilon_0}{j\\omega\\epsilon_0} = 1.0 - 0.2j = s_x^{\\text{target}}$。由于这与 UAPML 的情况完全相同，并且在相同的网格上使用了相同的正确控制方程，因此结果必须与测试 1 的结果相同。\n\n- **测试 5 (CPML，错误)：** 由于电导率项的分母中缺少 $\\epsilon_0$，组装了一个不正确的伸展因子 $s_x^{\\text{wrong}} = \\kappa_x + \\frac{\\sigma_x}{j\\omega} = 1 - j(0.2\\epsilon_0)$。基于 $s_x^{\\text{target}}$ 的人造解被代入使用 $(s_x^{\\text{wrong}})^2$ 的离散化方程中。$s_x^{\\text{wrong}}$ 和 $s_x^{\\text{target}}$ 之间的不匹配将产生一个大的残差，主要由实现误差项 $k_0^2((s_x^{\\text{wrong}})^2 - (s_x^{\\text{target}})^2)E_y$ 主导。该残差将显著大于离散化误差。\n\n**4. 数值实现**\n\n通过实现所描述的残差计算，对每个测试案例进行计算。物理常数按规定使用 SI 单位。计算并报告五个测试案例的归一化残差的最终值。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes normalized residuals for five test cases related to PML implementations.\n    \"\"\"\n    # Define physical and numerical constants in SI units\n    MU_0 = 4 * np.pi * 1e-7\n    EPS_0 = 8.854187817e-12\n    FREQ = 1.0e9\n    OMEGA = 2 * np.pi * FREQ\n    K0 = OMEGA * np.sqrt(MU_0 * EPS_0)\n    L = 1.0\n\n    # The target stretch factor for the manufactured solution\n    S_X_TARGET = 1.0 - 0.2j\n\n    def compute_normalized_residual(N, s_x_manuf, s_x_pde, pde_s_power):\n        \"\"\"\n        Computes the normalized residual for a given set of parameters.\n        \n        Args:\n            N (int): Number of grid points.\n            s_x_manuf (complex): Stretch factor for the manufactured solution.\n            s_x_pde (complex): Stretch factor in the discretized PDE.\n            pde_s_power (int): Power of s_x_pde in the PDE.\n        \"\"\"\n        # 1. Define the grid\n        delta_x = L / (N - 1)\n        x = np.linspace(0, L, N, dtype=np.float64)\n\n        # 2. Generate manufactured solution on the grid: E_y(x) = exp(-j*k0*s_x_manuf*x)\n        E_manuf = np.exp(-1j * K0 * s_x_manuf * x)\n\n        # 3. Discretize the PDE to calculate the residual at interior points\n        # The PDE is: d^2(E)/dx^2 + k0^2 * (s_x_pde)^pde_s_power * E = 0\n        \n        # Interior points (indices 1 to N-2)\n        interior_indices = slice(1, -1)\n        E_manuf_interior = E_manuf[interior_indices]\n\n        # Central difference approximation of d^2(E)/dx^2\n        D2_E_manuf = (E_manuf[2:] - 2 * E_manuf[interior_indices] + E_manuf[:-2]) / (delta_x**2)\n        \n        # Residual vector\n        residual_vector = D2_E_manuf + (K0**2) * (s_x_pde**pde_s_power) * E_manuf_interior\n        \n        # 4. Compute the normalized l2-norm of the residual\n        norm_residual = np.linalg.norm(residual_vector)\n        norm_field = np.linalg.norm(E_manuf_interior)\n        \n        if norm_field == 0:\n            return 0.0\n        \n        return norm_residual / norm_field\n\n    results = []\n\n    # Test 1: UAPML, correct, fine grid (N=201)\n    r1 = compute_normalized_residual(N=201, s_x_manuf=S_X_TARGET, s_x_pde=S_X_TARGET, pde_s_power=2)\n    results.append(r1)\n\n    # Test 2: UAPML, correct, coarse grid (N=21)\n    r2 = compute_normalized_residual(N=21, s_x_manuf=S_X_TARGET, s_x_pde=S_X_TARGET, pde_s_power=2)\n    results.append(r2)\n\n    # Test 3: UAPML, implementation error (N=201)\n    r3 = compute_normalized_residual(N=201, s_x_manuf=S_X_TARGET, s_x_pde=S_X_TARGET, pde_s_power=1)\n    results.append(r3)\n    \n    # Test 4: CPML, correct assembly (N=201)\n    kappa_x = 1.0\n    alpha_x = 0.0\n    sigma_x = 0.2 * OMEGA * EPS_0\n    s_x_cpml = kappa_x + sigma_x / (1j * OMEGA * EPS_0) + alpha_x / (1j * OMEGA)\n    # This calculation is identical to Test 1, as s_x_cpml equals S_X_TARGET\n    r4 = compute_normalized_residual(N=201, s_x_manuf=s_x_cpml, s_x_pde=s_x_cpml, pde_s_power=2)\n    results.append(r4)\n\n    # Test 5: CPML, parameter scaling error (N=201)\n    # The PDE uses an incorrectly assembled s_x_wrong\n    s_x_wrong_cpml = kappa_x + sigma_x / (1j * OMEGA) # Missing EPS_0\n    r5 = compute_normalized_residual(N=201, s_x_manuf=S_X_TARGET, s_x_pde=s_x_wrong_cpml, pde_s_power=2)\n    results.append(r5)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358794"}, {"introduction": "超越标准 PML 的分析和实现，我们可以迈向更高层次的工程挑战：为特定应用设计性能最优的吸收层。本练习将您置于一个逆向设计问题的场景中，目标是寻找一个最佳的多项式损耗分布 $\\sigma(x)$。[@problem_id:3358769] 此实践将理论与工程设计紧密结合，它展示了如何利用 PML 反射的启发式理论模型，并将其转化为一个线性规划问题，从而在给定的频率范围和入射角范围内，系统地优化 PML 的性能。这个过程不仅能加深您对 PML 工作原理的理解，也揭示了如何运用优化工具来解决计算电磁学中的实际设计难题。", "problem": "考虑一个基于完美匹配层 (PML) 概念的一维吸收层，该吸收层与一个由麦克斯韦方程组描述的半无限均匀介质相邻。基本出发点是频域中的麦克斯韦方程组以及自由空间中的本构关系，即 $\\,\\nabla \\times \\mathbf{E} = -j \\omega \\mu_0 \\mathbf{H}\\,$, $\\,\\nabla \\times \\mathbf{H} = j \\omega \\epsilon_0 \\mathbf{E}\\,$, $\\,\\nabla \\cdot \\epsilon_0 \\mathbf{E} = 0\\,$ 以及 $\\,\\nabla \\cdot \\mu_0 \\mathbf{H} = 0\\,$，其中 $\\mathbf{E}$ 和 $\\mathbf{H}$ 分别是电场和磁场，$\\omega$ 是角频率，$\\epsilon_0$ 和 $\\mu_0$ 分别是自由空间的介电常数和磁导率。对于一个角频率为 $\\omega$、以相对于吸收层法线 $\\theta$ 角入射的平面波，其自由空间波数为 $\\,k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0}\\,$，法向分量为 $\\,k_x = k_0 \\cos(\\theta)\\,$，角度以弧度为单位。\n\n在单轴各向异性完美匹配层 (UPML) 中，沿层法线方向的坐标拉伸在频域中可以用一个拉伸因子 $\\,s_x(x,\\omega)\\,$ 来表示。对于经典的 UPML，一个常用的形式是 $\\,s_x(x,\\omega) = 1 + \\frac{j \\sigma(x)}{\\omega \\epsilon_0}\\,$，其中 $\\,\\sigma(x)\\,$ 是一个非负损耗分布。卷积完美匹配层 (CPML) 修改了有效频率响应以改善低频性能。一个能捕捉 CPML 稳定化特性的紧凑代理模型是 $\\,s_x(x,\\omega,\\alpha) = 1 + \\frac{j \\sigma(x)}{\\epsilon_0 \\left(\\omega + j \\alpha\\right)}\\,$，其中 $\\,\\alpha \\ge 0\\,$ 是一个单位为秒的倒数的实数稳定化参数。在复坐标拉伸变换下，进入该层的平面波会经历由 $\\,s_x\\,$ 的虚部决定的振幅衰减：穿过厚度为 $\\,L\\,$ 的层后，场会获得一个因子 $\\,\\exp\\!\\left(j k_x \\int_0^L s_x(x,\\omega,\\alpha) \\, dx\\right)\\,$，从而产生一个衰减指数\n$$\nA(\\omega,\\theta) = k_0 \\cos(\\theta) \\int_0^L \\operatorname{Im}\\!\\left\\{s_x(x,\\omega,\\alpha)\\right\\} \\, dx.\n$$\n使用 $\\,s_x(x,\\omega,\\alpha) = 1 + \\frac{j \\sigma(x)}{\\epsilon_0 \\left(\\omega + j \\alpha\\right)}\\,$，可以计算出\n$$\n\\operatorname{Im}\\!\\left\\{s_x(x,\\omega,\\alpha)\\right\\} = \\frac{\\sigma(x)\\,\\omega}{\\epsilon_0 \\left(\\omega^2 + \\alpha^2\\right)}.\n$$\n因此，\n$$\nA(\\omega,\\theta) = \\frac{\\omega^2 \\sqrt{\\mu_0 \\epsilon_0}}{\\epsilon_0 \\left(\\omega^2 + \\alpha^2\\right)} \\, \\cos(\\theta) \\, \\int_0^L \\sigma(x)\\, dx.\n$$\n\n在理想的连续 UPML 中，输入阻抗是完美匹配的，在界面处会产生零反射；然而，在实践中，由于空间变化的 $\\,\\sigma(x)\\,$ 和数值离散化，$\\,\\operatorname{Im}\\!\\left\\{s_x\\right\\}\\,$ 的梯度会导致杂散反射。一个由适用于缓变介质的 Wentzel–Kramers–Brillouin (WKB) 推理所启发的一阶启发式边界断言，在频率 $\\,\\omega\\,$ 和角度 $\\,\\theta\\,$ 下，梯度引起的反射系数的代理模型可以由以下公式给出上界\n$$\nB(\\omega,\\theta) \\le \\gamma \\, \\frac{1}{k_x} \\, \\sup_{x \\in [0,L]} \\left| \\frac{d}{dx} \\operatorname{Im}\\!\\left\\{s_x(x,\\omega,\\alpha)\\right\\} \\right| \n= \\gamma \\, \\frac{1}{\\omega \\sqrt{\\mu_0 \\epsilon_0}\\, \\cos(\\theta)} \\, \\sup_{x \\in [0,L]} \\left( \\frac{\\omega}{\\epsilon_0 \\left(\\omega^2 + \\alpha^2\\right)} \\, \\sigma'(x) \\right),\n$$\n可简化为\n$$\nB(\\omega,\\theta) \\le \\gamma \\, \\frac{\\sup_{x \\in [0,L]} \\sigma'(x)}{\\epsilon_0 \\sqrt{\\mu_0 \\epsilon_0}\\, \\cos(\\theta)\\, \\left(\\omega^2 + \\alpha^2\\right)},\n$$\n其中 $\\,\\gamma > 0\\,$ 是一个无量纲校准因子，用于捕捉由离散化引起的反射幅度。将振幅衰减与该梯度反射边界相结合，可得到一个保守的最坏情况反射代理\n$$\nR_{\\text{proxy}}(\\omega,\\theta) = \\exp\\!\\left(-2 A(\\omega,\\theta)\\right) + B(\\omega,\\theta).\n$$\n\n我们提出以下逆向设计问题：选择一个多项式损耗分布\n$$\n\\sigma(x) = \\sum_{n=0}^{N} a_n \\, x^n, \\quad \\text{for } x \\in [0,L],\n$$\n其系数为非负值 $\\,a_n \\ge 0\\,$，并满足预算和入口匹配约束\n$$\n\\int_0^L \\sigma(x)\\, dx = S_{\\text{budget}}, \\quad \\sigma(0) = 0,\n$$\n以最小化在某一频带和入射角范围内的最坏情况反射，\n$$\n\\min_{\\{a_n\\}} \\;\\; \\sup_{\\omega \\in [2\\pi f_1, 2\\pi f_2], \\;\\theta \\in [\\theta_1,\\theta_2]} \\; R_{\\text{proxy}}(\\omega,\\theta).\n$$\n所有角度必须以弧度表示。所有频率必须以赫兹表示。所有距离必须以米表示。介电常数 $\\,\\epsilon_0\\,$ 和磁导率 $\\,\\mu_0\\,$ 是国际单位制 (SI) 中的常数。在固定积分约束 $\\,\\int_0^L \\sigma(x)\\, dx = S_{\\text{budget}}\\,$ 下，衰减分量 $\\,\\exp(-2 A)\\,$ 变得与 $\\,\\sigma(x)\\,$ 的形状无关，仅取决于预算。设计权衡随后简化为最小化梯度上确界 $\\,\\sup_{x \\in [0,L]} \\sigma'(x)\\,$，因为 $\\,B(\\omega,\\theta)\\,$ 随该上确界增大而增大。因此，我们求解以下线性规划问题，该问题通过在 $\\,M\\,$ 个等距点 $\\,x_i\\,$ 上离散化 $\\,x \\in (0,L]\\,$ 得到：\n- 决策变量为 $\\,a_0, a_1, \\dots, a_N\\,$ 和 $\\,t\\,$，其中 $\\,a_n \\ge 0\\,$ 且 $\\,t \\ge 0\\,$。\n- 强制 $\\,a_0 = 0\\,$ 且 $\\,\\sum_{n=0}^{N} \\frac{L^{n+1}}{n+1} a_n = S_{\\text{budget}}\\,$。\n- 对所有 $\\,i=1,\\dots,M\\,$ 强制梯度约束 $\\,\\sum_{n=1}^{N} n\\, a_n\\, x_i^{n-1} \\le t\\,$。\n- 最小化 $\\,t\\,$。\n\n从线性规划中获得最优值 $\\,t^\\star = \\sup_{x \\in [0,L]} \\sigma'(x)\\,$ 后，在指定频带和角度范围内的最坏情况反射代理在最小角频率 $\\,\\omega_1 = 2 \\pi f_1\\,$ 和最大入射角 $\\,\\theta_2\\,$ 处取得，因此\n$$\nR_{\\text{worst}} = \\exp\\!\\left(-2 A(\\omega_1,\\theta_2)\\right) + \\gamma \\, \\frac{t^\\star}{\\epsilon_0 \\sqrt{\\mu_0 \\epsilon_0}\\, \\cos(\\theta_2)\\, \\left(\\omega_1^2 + \\alpha^2\\right)}.\n$$\n\n实现一个完整、可运行的程序，该程序：\n- 针对给定的 $\\,N, L, S_{\\text{budget}}, f_1, f_2, \\theta_1, \\theta_2, \\alpha, \\gamma\\,$ 和 $\\,M\\,$ 个导数离散化点，求解线性规划。\n- 使用上述公式计算 $\\,t^\\star\\,$ 和相应的 $\\,R_{\\text{worst}}\\,$。\n\n使用以下参数集测试套件来验证不同场景：\n- 测试 $\\,1\\,$ (理想情况): $\\,N=3\\,$, $\\,L=0.1\\,\\text{m}\\,$, $\\,S_{\\text{budget}}=5.0\\,$, $\\,f_1=1.0 \\times 10^8\\,\\text{Hz}\\,$, $\\,f_2=1.0 \\times 10^9\\,\\text{Hz}\\,$, $\\,\\theta_1=0.0\\,\\text{rad}\\,$, $\\,\\theta_2=\\pi/4\\,\\text{rad}\\,$, $\\,\\alpha=1.0 \\times 10^8\\,\\text{s}^{-1}\\,$, $\\,\\gamma=1.0 \\times 10^{-8}\\,$, $\\,M=100\\,$.\n- 测试 $\\,2\\,$ (高阶、更宽层、不同稳定化): $\\,N=5\\,$, $\\,L=0.2\\,\\text{m}\\,$, $\\,S_{\\text{budget}}=20.0\\,$, $\\,f_1=5.0 \\times 10^7\\,\\text{Hz}\\,$, $\\,f_2=2.0 \\times 10^9\\,\\text{Hz}\\,$, $\\,\\theta_1=0.0\\,\\text{rad}\\,$, $\\,\\theta_2=\\pi/3\\,\\text{rad}\\,$, $\\,\\alpha=5.0 \\times 10^8\\,\\text{s}^{-1}\\,$, $\\,\\gamma=5.0 \\times 10^{-9}\\,$, $\\,M=120\\,$.\n- 测试 $\\,3\\,$ (边界情况、薄层、低频段): $\\,N=2\\,$, $\\,L=0.05\\,\\text{m}\\,$, $\\,S_{\\text{budget}}=2.0\\,$, $\\,f_1=1.0 \\times 10^7\\,\\text{Hz}\\,$, $\\,f_2=5.0 \\times 10^7\\,\\text{Hz}\\,$, $\\,\\theta_1=0.0\\,\\text{rad}\\,$, $\\,\\theta_2=\\pi/6\\,\\text{rad}\\,$, $\\,\\alpha=1.0 \\times 10^9\\,\\text{s}^{-1}\\,$, $\\,\\gamma=2.0 \\times 10^{-8}\\,$, $\\,M=80\\,$.\n\n使用 $\\,\\epsilon_0 = 8.854187817 \\times 10^{-12}\\,\\text{F/m}\\,$ 和 $\\,\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\text{H/m}\\,$ 数值计算 $\\,R_{\\text{worst}}\\,$。你的程序应生成单行输出，其中包含所有测试的结果，格式为逗号分隔的 $\\,\\big[t^\\star, R_{\\text{worst}}\\big]\\,$ 对列表，每对用方括号括起来，整个列表也用方括号括起来，例如 $\\,\\big[[t_1,R_1],[t_2,R_2],[t_3,R_3]\\big]\\,$。输出中的所有数值都是根据上述公式获得的无单位浮点数。", "solution": "本解决方案通过求解一个简化为线性规划 (LP) 的优化问题，来确定卷积PML (CPML) 的最优多项式损耗分布 $\\sigma(x)$，然后计算得到的最坏情况反射代理 $R_{\\text{worst}}$。\n\n问题的核心是在满足特定约束条件下，最小化损耗分布梯度的上确界 $\\sup_{x \\in [0,L]} \\sigma'(x)$。损耗分布是一个 $N$ 次多项式 $\\sigma(x) = \\sum_{n=0}^{N} a_n x^n$，其系数为非负数 $a_n \\ge 0$。约束条件为 $\\sigma(0) = 0$（这意味着 $a_0 = 0$）以及关于总损耗的预算 $\\int_0^L \\sigma(x)\\, dx = S_{\\text{budget}}$。该积分约束可转换为 $\\sum_{n=1}^{N} a_n \\frac{L^{n+1}}{n+1} = S_{\\text{budget}}$。\n\n我们需要求解以下线性规划问题：\n最小化 $t$，约束条件为：\n1. 对于 $n=1, \\dots, N$，$a_n \\ge 0$，且 $t \\ge 0$。\n2. $\\sum_{n=1}^{N} a_n \\frac{L^{n+1}}{n+1} = S_{\\text{budget}}$。\n3. 对于 $M$ 个离散点 $x_i \\in (0,L]$，$\\sigma'(x_i) \\le t$，其中 $\\sigma'(x) = \\sum_{n=1}^{N} n a_n x^{n-1}$。\n\n该线性规划使用 `scipy.optimize` 库中的 `linprog` 函数求解。LP求解器的决策变量是系数 $a_1, \\dots, a_N$ 和辅助变量 $t$。目标函数就是最小化 $t$。约束被表述为预算的等式约束和梯度边界的 $M$ 个不等式约束集。\n\n线性规划求解后，我们得到最优值 $t^\\star = \\min t = \\sup_{x \\in [0,L]} \\sigma'(x)$。利用 $t^\\star$，我们可以计算最坏情况反射代理 $R_{\\text{worst}}$。问题指明最坏情况发生在最低频率 $\\omega_1 = 2 \\pi f_1$ 和最大入射角 $\\theta_2$ 处。$R_{\\text{worst}}$ 的计算公式由下式给出：\n$$\nR_{\\text{worst}} = \\exp\\!\\left(-2 A(\\omega_1,\\theta_2)\\right) + B_{\\text{worst}}\n$$\n其中衰减指数为\n$$\nA(\\omega_1,\\theta_2) = \\frac{\\omega_1^2 \\sqrt{\\mu_0 \\epsilon_0}}{\\epsilon_0 \\left(\\omega_1^2 + \\alpha^2\\right)} \\, \\cos(\\theta_2) \\, S_{\\text{budget}}\n$$\n反射边界项为\n$$\nB_{\\text{worst}} = \\gamma \\, \\frac{t^\\star}{\\epsilon_0 \\sqrt{\\mu_0 \\epsilon_0}\\, \\cos(\\theta_2)\\, \\left(\\omega_1^2 + \\alpha^2\\right)}.\n$$\n使用的物理常数是自由空间介电常数 $\\epsilon_0 = 8.854187817 \\times 10^{-12}\\,\\text{F/m}$ 和自由空间磁导率 $\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\text{H/m}$。\n\n对提供的三个测试用例中的每一个执行该过程。对每个用例，我们定义参数 $N, L, S_{\\text{budget}}, f_1, f_2, \\theta_1, \\theta_2, \\alpha, \\gamma,$ 和 $M$。然后我们构建并求解相应的线性规划以找到 $t^\\star$，随后计算 $R_{\\text{worst}}$。最终输出汇集了所有测试用例的 $[t^\\star, R_{\\text{worst}}]$ 对。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the PML design problem for a suite of test cases.\n    For each case, it formulates and solves a linear program to find the\n    minimum possible supremum of the loss profile gradient (t_star),\n    and then calculates the worst-case reflection proxy (R_worst).\n    \"\"\"\n\n    # Physical constants in SI units\n    EPSILON_0 = 8.854187817e-12  # F/m\n    MU_0 = 4 * np.pi * 1e-7      # H/m\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Test 1: Happy path\n        {'N': 3, 'L': 0.1, 'S_budget': 5.0, 'f1': 1.0e8, 'f2': 1.0e9, \n         'theta1': 0.0, 'theta2': np.pi/4, 'alpha': 1.0e8, 'gamma': 1.0e-8, 'M': 100},\n        # Test 2: Higher-order, wider layer, different stabilization\n        {'N': 5, 'L': 0.2, 'S_budget': 20.0, 'f1': 5.0e7, 'f2': 2.0e9, \n         'theta1': 0.0, 'theta2': np.pi/3, 'alpha': 5.0e8, 'gamma': 5.0e-9, 'M': 120},\n        # Test 3: Boundary case, thin layer, low band\n        {'N': 2, 'L': 0.05, 'S_budget': 2.0, 'f1': 1.0e7, 'f2': 5.0e7, \n         'theta1': 0.0, 'theta2': np.pi/6, 'alpha': 1.0e9, 'gamma': 2.0e-8, 'M': 80}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        L = case['L']\n        S_budget = case['S_budget']\n        f1 = case['f1']\n        theta2 = case['theta2']\n        alpha = case['alpha']\n        gamma = case['gamma']\n        M = case['M']\n\n        # --- Step 1: Solve the Linear Program ---\n\n        # Decision variables are [a_1, a_2, ..., a_N, t]. Total N+1 variables.\n        # a_0 is fixed to 0.\n\n        # Objective: minimize t\n        # c is a vector of length N+1.\n        c = np.zeros(N + 1)\n        c[-1] = 1.0\n\n        # Equality constraint: sum_{n=1 to N} a_n * L^(n+1)/(n+1) = S_budget\n        A_eq = np.zeros((1, N + 1))\n        for n in range(1, N + 1):\n            A_eq[0, n - 1] = L**(n + 1) / (n + 1)\n        b_eq = np.array([S_budget])\n\n        # Inequality constraints: sum_{n=1 to N} n*a_n*x_i^(n-1) = t\n        # which is sum(n*a_n*x_i^(n-1)) - t = 0\n        A_ub = np.zeros((M, N + 1))\n        x_points = np.linspace(L / M, L, M)  # M evenly spaced points in (0, L]\n        \n        for i, x_i in enumerate(x_points):\n            for n in range(1, N + 1):\n                A_ub[i, n - 1] = n * x_i**(n - 1)\n            A_ub[i, -1] = -1.0\n        b_ub = np.zeros(M)\n\n        # Bounds for variables: a_n >= 0, t >= 0\n        bounds = [(0, None) for _ in range(N + 1)]\n\n        # Solve the LP\n        lp_result = linprog(c=c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        # The optimal t is the last variable in the solution vector x\n        t_star = lp_result.x[-1]\n\n        # --- Step 2: Calculate R_worst ---\n\n        omega1 = 2 * np.pi * f1\n        cos_theta2 = np.cos(theta2)\n        \n        # Common denominator factor\n        denom_factor = (omega1**2 + alpha**2)\n\n        # Attenuation exponent A(omega1, theta2)\n        A_factor = (omega1**2 * np.sqrt(MU_0 * EPSILON_0) / EPSILON_0) * cos_theta2 * S_budget / denom_factor\n        \n        # Attenuation term: exp(-2A)\n        attenuation_term = np.exp(-2 * A_factor)\n\n        # Reflection bound B_worst\n        B_factor = gamma * t_star / (EPSILON_0 * np.sqrt(MU_0 * EPSILON_0) * cos_theta2 * denom_factor)\n        \n        # Total worst-case reflection proxy\n        R_worst = attenuation_term + B_factor\n\n        results.append([t_star, R_worst])\n\n    # Format the output string as specified: [[t1,R1],[t2,R2],[t3,R3]]\n    # Custom string formatting to avoid spaces inside the brackets.\n    output_pairs = [f\"[{t:.7f},{r:.7f}]\" for t, r in results]\n    print(f\"[{','.join(output_pairs)}]\")\n\nsolve()\n```", "id": "3358769"}]}