{"hands_on_practices": [{"introduction": "本练习为互易定理奠定了理论基础，通过从麦克斯韦方程组出发，严格证明对于具有对称本构张量 $\\boldsymbol{\\epsilon}$ 和 $\\boldsymbol{\\mu}$ 的材料，其并矢格林函数 [@problem_id:3354292] 必然满足对称性。这项推导将使你深刻理解，互易性是电磁场基本物理规律的直接体现，而非一种近似，这对于正确运用响应函数进行高等电磁建模至关重要。", "problem": "考虑一个三维、线性、除了在特定点外无源的分层介质，其材料张量仅依赖于坐标$z$，并且在$z$方向上是分段常数，具有平行于$x$-$y$平面的平面分界面。假设时谐约定为$\\exp(j \\omega t)$，并且本构关系为$\\mathbf{D} = \\boldsymbol{\\epsilon}(z) \\mathbf{E}$和$\\mathbf{B} = \\boldsymbol{\\mu}(z) \\mathbf{H}$，其中$\\boldsymbol{\\epsilon}(z) = \\boldsymbol{\\epsilon}^{T}(z)$和$\\boldsymbol{\\mu}(z) = \\boldsymbol{\\mu}^{T}(z)$处处成立（无磁电耦合）。频域麦克斯韦方程组为\n$$\n\\nabla \\times \\mathbf{E} = -j \\omega \\boldsymbol{\\mu} \\mathbf{H}, \\qquad\n\\nabla \\times \\mathbf{H} = \\mathbf{J} + j \\omega \\boldsymbol{\\epsilon} \\mathbf{E},\n$$\n并满足标准界面条件：在每个分界面上，$\\mathbf{E}$和$\\mathbf{H}$的切向分量连续，以及在无穷远处满足出射波辐射条件。\n\n将此介质的电场并矢格林函数$\\mathbf{G}(\\mathbf{r}, \\mathbf{r}')$定义为以下方程的解\n$$\n\\nabla \\times \\boldsymbol{\\mu}^{-1}(\\mathbf{r}) \\nabla \\times \\mathbf{G}(\\mathbf{r}, \\mathbf{r}') - \\omega^{2} \\boldsymbol{\\epsilon}(\\mathbf{r}) \\mathbf{G}(\\mathbf{r}, \\mathbf{r}') = \\mathbf{I} \\, \\delta(\\mathbf{r} - \\mathbf{r}'),\n$$\n该解满足相同的界面和辐射条件，其中$\\mathbf{I}$是单位并矢，$\\delta(\\cdot)$是狄拉克δ分布。根据定义，对于任意给定的电流密度$\\mathbf{J}(\\mathbf{r}')$，电场响应为\n$$\n\\mathbf{E}(\\mathbf{r}) = -j \\omega \\int \\mathbf{G}(\\mathbf{r}, \\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'.\n$$\n\n令$\\mathbf{J}^{(1)}(\\mathbf{r}) = \\hat{\\mathbf{e}}_{j} \\, \\delta(\\mathbf{r} - \\mathbf{r}')$和$\\mathbf{J}^{(2)}(\\mathbf{r}) = \\hat{\\mathbf{e}}_{i} \\, \\delta(\\mathbf{r} - \\mathbf{r}_0)$为两个点电流激励，其中$\\hat{\\mathbf{e}}_{i}$和$\\hat{\\mathbf{e}}_{j}$是笛卡尔单位矢量，$\\mathbf{r}'$和$\\mathbf{r}_0$是任意的源点，$\\mathbf{r}$是场点（可能在不同的层中）。将对应的场解表示为$(\\mathbf{E}^{(1)}, \\mathbf{H}^{(1)})$和$(\\mathbf{E}^{(2)}, \\mathbf{H}^{(2)})$。\n\n从频域麦克斯韦方程组出发，仅使用所述的本构对称性、边界/界面条件和出射辐射条件，计算互易性检验量\n$$\nR_{ij}(\\mathbf{r}_0, \\mathbf{r}') \\equiv G_{ij}(\\mathbf{r}_0, \\mathbf{r}') - G_{ji}(\\mathbf{r}', \\mathbf{r}_0),\n$$\n其中$G_{ij}$是并矢格林函数的$(i,j)$分量。将$R_{ij}(\\mathbf{r}_0, \\mathbf{r}')$的最终结果表示为单个简化的解析表达式。无需四舍五入，最终答案中不应提供单位。", "solution": "该问题要求计算互易性检验量$R_{ij}(\\mathbf{r}_0, \\mathbf{r}') \\equiv G_{ij}(\\mathbf{r}_0, \\mathbf{r}') - G_{ji}(\\mathbf{r}', \\mathbf{r}_0)$。该量用于检验并矢格林函数的互易关系。推导将基于洛伦兹互易定理，并应用于问题中定义的特定情境。\n\n让我们考虑两组时谐源和场，$(\\mathbf{E}^{(1)}, \\mathbf{H}^{(1)})$对应于电流源$\\mathbf{J}^{(1)}$，$(\\mathbf{E}^{(2)}, \\mathbf{H}^{(2)})$对应于$\\mathbf{J}^{(2)}$。它们满足频域麦克斯韦方程组：\n$$\n\\nabla \\times \\mathbf{E}^{(1)} = -j \\omega \\boldsymbol{\\mu} \\mathbf{H}^{(1)} \\quad (1a)\n$$\n$$\n\\nabla \\times \\mathbf{H}^{(1)} = \\mathbf{J}^{(1)} + j \\omega \\boldsymbol{\\epsilon} \\mathbf{E}^{(1)} \\quad (1b)\n$$\n$$\n\\nabla \\times \\mathbf{E}^{(2)} = -j \\omega \\boldsymbol{\\mu} \\mathbf{H}^{(2)} \\quad (2a)\n$$\n$$\n\\nabla \\times \\mathbf{H}^{(2)} = \\mathbf{J}^{(2)} + j \\omega \\boldsymbol{\\epsilon} \\mathbf{E}^{(2)} \\quad (2b)\n$$\n我们使用矢量恒等式$\\nabla \\cdot (\\mathbf{A} \\times \\mathbf{B}) = \\mathbf{B} \\cdot (\\nabla \\times \\mathbf{A}) - \\mathbf{A} \\cdot (\\nabla \\times \\mathbf{B})$来构建表达式$\\nabla \\cdot (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)})$：\n$$\n\\nabla \\cdot (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)}) = \\mathbf{H}^{(2)} \\cdot (\\nabla \\times \\mathbf{E}^{(1)}) - \\mathbf{E}^{(1)} \\cdot (\\nabla \\times \\mathbf{H}^{(2)})\n$$\n代入方程$(1a)$和$(2b)$：\n$$\n\\nabla \\cdot (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)}) = \\mathbf{H}^{(2)} \\cdot (-j \\omega \\boldsymbol{\\mu} \\mathbf{H}^{(1)}) - \\mathbf{E}^{(1)} \\cdot (\\mathbf{J}^{(2)} + j \\omega \\boldsymbol{\\epsilon} \\mathbf{E}^{(2)})\n$$\n$$\n\\nabla \\cdot (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)}) = -j \\omega \\mathbf{H}^{(2)} \\cdot (\\boldsymbol{\\mu} \\mathbf{H}^{(1)}) - \\mathbf{E}^{(1)} \\cdot \\mathbf{J}^{(2)} - j \\omega \\mathbf{E}^{(1)} \\cdot (\\boldsymbol{\\epsilon} \\mathbf{E}^{(2)})\n$$\n类似地，对于$\\nabla \\cdot (\\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)})$，使用方程$(2a)$和$(1b)$：\n$$\n\\nabla \\cdot (\\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}) = \\mathbf{H}^{(1)} \\cdot (\\nabla \\times \\mathbf{E}^{(2)}) - \\mathbf{E}^{(2)} \\cdot (\\nabla \\times \\mathbf{H}^{(1)})\n$$\n$$\n\\nabla \\cdot (\\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}) = \\mathbf{H}^{(1)} \\cdot (-j \\omega \\boldsymbol{\\mu} \\mathbf{H}^{(2)}) - \\mathbf{E}^{(2)} \\cdot (\\mathbf{J}^{(1)} + j \\omega \\boldsymbol{\\epsilon} \\mathbf{E}^{(1)})\n$$\n$$\n\\nabla \\cdot (\\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}) = -j \\omega \\mathbf{H}^{(1)} \\cdot (\\boldsymbol{\\mu} \\mathbf{H}^{(2)}) - \\mathbf{E}^{(2)} \\cdot \\mathbf{J}^{(1)} - j \\omega \\mathbf{E}^{(2)} \\cdot (\\boldsymbol{\\epsilon} \\mathbf{E}^{(1)})\n$$\n将得到的两个表达式相减，得到：\n$$\n\\nabla \\cdot (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)} - \\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}) = \\mathbf{E}^{(2)} \\cdot \\mathbf{J}^{(1)} - \\mathbf{E}^{(1)} \\cdot \\mathbf{J}^{(2)} - j \\omega [\\mathbf{H}^{(2)} \\cdot (\\boldsymbol{\\mu} \\mathbf{H}^{(1)}) - \\mathbf{H}^{(1)} \\cdot (\\boldsymbol{\\mu} \\mathbf{H}^{(2)})] - j \\omega [\\mathbf{E}^{(1)} \\cdot (\\boldsymbol{\\epsilon} \\mathbf{E}^{(2)}) - \\mathbf{E}^{(2)} \\cdot (\\boldsymbol{\\epsilon} \\mathbf{E}^{(1)})]\n$$\n问题陈述了材料张量是对称的，即$\\boldsymbol{\\epsilon} = \\boldsymbol{\\epsilon}^T$和$\\boldsymbol{\\mu} = \\boldsymbol{\\mu}^T$。对于任意两个矢量$\\mathbf{A}, \\mathbf{B}$和一个对称张量$\\mathbf{T}$，我们有$\\mathbf{A} \\cdot (\\mathbf{T} \\mathbf{B}) = \\mathbf{B} \\cdot (\\mathbf{T} \\mathbf{A})$。因此，方括号中的项为零：\n$$\n\\mathbf{H}^{(2)} \\cdot (\\boldsymbol{\\mu} \\mathbf{H}^{(1)}) - \\mathbf{H}^{(1)} \\cdot (\\boldsymbol{\\mu} \\mathbf{H}^{(2)}) = 0\n$$\n$$\n\\mathbf{E}^{(1)} \\cdot (\\boldsymbol{\\epsilon} \\mathbf{E}^{(2)}) - \\mathbf{E}^{(2)} \\cdot (\\boldsymbol{\\epsilon} \\mathbf{E}^{(1)}) = 0\n$$\n这将微分关系简化为如下形式，即洛伦兹互易定理的微分形式：\n$$\n\\nabla \\cdot (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)} - \\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}) = \\mathbf{E}^{(2)} \\cdot \\mathbf{J}^{(1)} - \\mathbf{E}^{(1)} \\cdot \\mathbf{J}^{(2)}\n$$\n我们将此方程在全空间（一个由无穷远处的曲面$S$包围的体积$V$）上积分。应用散度定理：\n$$\n\\oint_{S} (\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)} - \\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}) \\cdot d\\mathbf{S} = \\int_{V} (\\mathbf{E}^{(2)} \\cdot \\mathbf{J}^{(1)} - \\mathbf{E}^{(1)} \\cdot \\mathbf{J}^{(2)}) \\, dV\n$$\n场$(\\mathbf{E}^{(1)}, \\mathbf{H}^{(1)})$和$(\\mathbf{E}^{(2)}, \\mathbf{H}^{(2)})$是局域源的麦克斯韦方程组的解，必须满足无穷远处的出射波（Silver-Müller）辐射条件。该条件确保当曲面$S$退到无穷远处时，左侧的面积分为零。此外，在分层介质内部的平面分界面上，$\\mathbf{E}$和$\\mathbf{H}$的切向分量是连续的。这意味着矢量场$\\mathbf{E}^{(1)} \\times \\mathbf{H}^{(2)} - \\mathbf{E}^{(2)} \\times \\mathbf{H}^{(1)}$的法向分量也跨越这些界面连续，因此内部边界不会产生额外的面积分项。\n由于无穷远处的面积分为零，我们得到互易定理的积分形式，也称为场作用量定理：\n$$\n\\int_{V} \\mathbf{E}^{(2)} \\cdot \\mathbf{J}^{(1)} \\, dV = \\int_{V} \\mathbf{E}^{(1)} \\cdot \\mathbf{J}^{(2)} \\, dV\n$$\n现在，我们将此定理应用于问题中定义的特定点电流源：\n$$\n\\mathbf{J}^{(1)}(\\boldsymbol{\\rho}) = \\hat{\\mathbf{e}}_{j} \\, \\delta(\\boldsymbol{\\rho} - \\mathbf{r}')\n$$\n$$\n\\mathbf{J}^{(2)}(\\boldsymbol{\\rho}) = \\hat{\\mathbf{e}}_{i} \\, \\delta(\\boldsymbol{\\rho} - \\mathbf{r}_0)\n$$\n其中$\\boldsymbol{\\rho}$是积分变量。\n将这些代入场作用量定理：\n$$\n\\int_{V} \\mathbf{E}^{(2)}(\\boldsymbol{\\rho}) \\cdot [ \\hat{\\mathbf{e}}_{j} \\, \\delta(\\boldsymbol{\\rho} - \\mathbf{r}') ] \\, dV_{\\boldsymbol{\\rho}} = \\int_{V} \\mathbf{E}^{(1)}(\\boldsymbol{\\rho}) \\cdot [ \\hat{\\mathbf{e}}_{i} \\, \\delta(\\boldsymbol{\\rho} - \\mathbf{r}_0) ] \\, dV_{\\boldsymbol{\\rho}}\n$$\n利用狄拉克δ分布的筛选性质计算积分：\n$$\n\\mathbf{E}^{(2)}(\\mathbf{r}') \\cdot \\hat{\\mathbf{e}}_{j} = \\mathbf{E}^{(1)}(\\mathbf{r}_0) \\cdot \\hat{\\mathbf{e}}_{i}\n$$\n该方程关联了场分量。令$E^{(2)}_j(\\mathbf{r}')$为场$\\mathbf{E}^{(2)}$在点$\\mathbf{r}'$处的第$j$个笛卡尔分量，而$E^{(1)}_i(\\mathbf{r}_0)$为场$\\mathbf{E}^{(1)}$在点$\\mathbf{r}_0$处的第$i$个分量。关系式为：\n$$\nE^{(1)}_{i}(\\mathbf{r}_0) = E^{(2)}_{j}(\\mathbf{r}')\n$$\n接下来，我们将这些场分量与并矢格林函数$\\mathbf{G}(\\mathbf{r}, \\mathbf{r}')$联系起来。电场由下式给出：\n$$\n\\mathbf{E}(\\mathbf{r}) = -j \\omega \\int \\mathbf{G}(\\mathbf{r}, \\boldsymbol{\\rho}') \\cdot \\mathbf{J}(\\boldsymbol{\\rho}') \\, dV_{\\boldsymbol{\\rho}'}\n$$\n对于第一个源$\\mathbf{J}^{(1)}(\\boldsymbol{\\rho}') = \\hat{\\mathbf{e}}_{j} \\, \\delta(\\boldsymbol{\\rho}' - \\mathbf{r}')$，在点$\\mathbf{r}_0$处的场$\\mathbf{E}^{(1)}$为：\n$$\n\\mathbf{E}^{(1)}(\\mathbf{r}_0) = -j \\omega \\int \\mathbf{G}(\\mathbf{r}_0, \\boldsymbol{\\rho}') \\cdot [\\hat{\\mathbf{e}}_{j} \\, \\delta(\\boldsymbol{\\rho}' - \\mathbf{r}')] \\, dV_{\\boldsymbol{\\rho}'} = -j \\omega \\, \\mathbf{G}(\\mathbf{r}_0, \\mathbf{r}') \\cdot \\hat{\\mathbf{e}}_{j}\n$$\n通过与$\\hat{\\mathbf{e}}_i$进行点积得到第$i$个分量：\n$$\nE^{(1)}_{i}(\\mathbf{r}_0) = \\hat{\\mathbf{e}}_i \\cdot \\mathbf{E}^{(1)}(\\mathbf{r}_0) = -j \\omega \\, \\hat{\\mathbf{e}}_i \\cdot (\\mathbf{G}(\\mathbf{r}_0, \\mathbf{r}') \\cdot \\hat{\\mathbf{e}}_{j}) = -j \\omega \\, G_{ij}(\\mathbf{r}_0, \\mathbf{r}')\n$$\n对于第二个源$\\mathbf{J}^{(2)}(\\boldsymbol{\\rho}') = \\hat{\\mathbf{e}}_{i} \\, \\delta(\\boldsymbol{\\rho}' - \\mathbf{r}_0)$，在点$\\mathbf{r}'$处的场$\\mathbf{E}^{(2)}$为：\n$$\n\\mathbf{E}^{(2)}(\\mathbf{r}') = -j \\omega \\int \\mathbf{G}(\\mathbf{r}', \\boldsymbol{\\rho}') \\cdot [\\hat{\\mathbf{e}}_{i} \\, \\delta(\\boldsymbol{\\rho}' - \\mathbf{r}_0)] \\, dV_{\\boldsymbol{\\rho}'} = -j \\omega \\, \\mathbf{G}(\\mathbf{r}', \\mathbf{r}_0) \\cdot \\hat{\\mathbf{e}}_{i}\n$$\n通过与$\\hat{\\mathbf{e}}_j$进行点积得到第$j$个分量：\n$$\nE^{(2)}_{j}(\\mathbf{r}') = \\hat{\\mathbf{e}}_j \\cdot \\mathbf{E}^{(2)}(\\mathbf{r}') = -j \\omega \\, \\hat{\\mathbf{e}}_j \\cdot (\\mathbf{G}(\\mathbf{r}', \\mathbf{r}_0) \\cdot \\hat{\\mathbf{e}}_{i}) = -j \\omega \\, G_{ji}(\\mathbf{r}', \\mathbf{r}_0)\n$$\n将这些场分量的表达式代入互易关系$E^{(1)}_{i}(\\mathbf{r}_0) = E^{(2)}_{j}(\\mathbf{r}')$：\n$$\n-j \\omega \\, G_{ij}(\\mathbf{r}_0, \\mathbf{r}') = -j \\omega \\, G_{ji}(\\mathbf{r}', \\mathbf{r}_0)\n$$\n因为此式对于非零频率$\\omega \\neq 0$必须成立，我们可以除以$-j \\omega$来获得并矢格林函数的互易性质：\n$$\nG_{ij}(\\mathbf{r}_0, \\mathbf{r}') = G_{ji}(\\mathbf{r}', \\mathbf{r}_0)\n$$\n最后，我们计算所要求的量$R_{ij}(\\mathbf{r}_0, \\mathbf{r}')$：\n$$\nR_{ij}(\\mathbf{r}_0, \\mathbf{r}') = G_{ij}(\\mathbf{r}_0, \\mathbf{r}') - G_{ji}(\\mathbf{r}', \\mathbf{r}_0) = G_{ji}(\\mathbf{r}', \\mathbf{r}_0) - G_{ji}(\\mathbf{r}', \\mathbf{r}_0) = 0\n$$\n由于材料张量的对称性（这使得介质成为互易介质），互易性检验量恒为零。", "answer": "$$\\boxed{0}$$", "id": "3354292"}, {"introduction": "理论原则在数值计算中能否保持，取决于离散化方案的精巧设计。这项高级实践 [@problem_id:3354270] 要求你在一个包含复杂介质（有损、各向异性、色散）的场景中，通过有限体积法数值验证洛伦兹互易定理。你将发现，采用调和平均等特定技术来构造对称的系统矩阵，是确保数值解满足物理互易性的关键，这深刻体现了理论与计算实践的内在联系。", "problem": "考虑在均匀笛卡尔网格上离散化的二维矩形域中，时间依赖关系为 $e^{j\\omega t}$ 的频域计算电磁学。您将为一个带有有损各向异性色散板的电准静态模型验证 Lorentz 互易性。使用麦克斯韦方程组和电准静态极限作为基本基础，并且除了从麦克斯韦方程组导出的一般性陈述外，不假设任何专门的互易性公式。目标是构建一个对称的离散算子来表示 $\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}}(\\omega)\\nabla \\phi\\right) = -\\rho$，其中介电常数张量为复对称，并在多种情况下数值上确认离散 Lorentz 互易性恒等式\n$$\n\\int_{\\Omega} \\rho_1(\\mathbf{r}) \\,\\phi_2(\\mathbf{r})\\,dV \\;=\\; \\int_{\\Omega} \\rho_2(\\mathbf{r}) \\,\\phi_1(\\mathbf{r})\\,dV\n$$\n对于 $\\underline{\\underline{\\epsilon}}(\\omega)$ 是复数且对称的无源色散介质，在数值容差范围内成立。计算必须完全在有限体积离散化的电准静态设置中进行，其中狄利克雷边界条件在计算域的外边界上强制 $\\phi=0$。离散解的存在性和唯一性由这些边界条件以及材料的无源、严格耗散或无损性质保证。\n\n基本基础和建模假设：\n- 从时间依赖关系为 $e^{j\\omega t}$ 的频域麦克斯韦方程组开始：\n  - $\\nabla \\times \\mathbf{E} = -j\\omega \\mu_0 \\mathbf{H}$，\n  - $\\nabla \\times \\mathbf{H} = \\mathbf{J} + j\\omega \\underline{\\underline{\\epsilon}}(\\omega)\\mathbf{E}$，\n  - $\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}}(\\omega)\\mathbf{E}\\right) = \\rho$，\n  - $\\nabla \\cdot \\mathbf{B} = 0$，\n  以及本构关系 $\\mathbf{D} = \\underline{\\underline{\\epsilon}}(\\omega)\\mathbf{E}$，$\\mathbf{B} = \\mu_0 \\mathbf{H}$。在电准静态极限下，模型为 $\\mathbf{E} = -\\nabla \\phi$ 并求解 $\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}}(\\omega)\\nabla \\phi\\right) = -\\rho$。\n- 使用一个 $N_x\\times N_y$ 个节点的矩形域，两个方向上的均匀间距为 $h$，并在域边界上强制执行狄利克雷边界条件 $\\phi=0$。使用谐波平均计算跨面通量来组装一个有限体积算子，以保持对称性。\n- 将板建模为一个水平带，其各向异性对角介电常数张量为 $\\underline{\\underline{\\epsilon}}(\\omega) = \\mathrm{diag}\\left(\\epsilon_x(\\omega), \\epsilon_y(\\omega)\\right)$；在板外，使用真空，介电常数为 $\\epsilon_0$。在板内，使用带附加电导的德拜型色散模型：\n  $$\n  \\epsilon_k(\\omega) = \\epsilon_{\\infty,k} + \\frac{\\epsilon_{s,k} - \\epsilon_{\\infty,k}}{1 + j\\omega \\tau_k} + \\frac{\\sigma_k}{j\\omega}, \\quad k\\in\\{x,y\\}.\n  $$\n  无源性要求耗散功率为非负；对于 $e^{j\\omega t}$ 约定，这由 $\\sigma_k/(j\\omega)$ 项和德拜项（其中 $\\tau_k>0$ 且 $\\epsilon_{s,k}\\ge \\epsilon_{\\infty,k}$）来体现。\n- 使用两个紧支撑的外加电荷偶极子 $\\rho_1$ 和 $\\rho_2$ 来激励系统，每个偶极子实现为一对大小相等、符号相反的点电荷，电荷量为 $q$，沿指定坐标轴相隔一个网格间距，位于指定的网格节点上。每个单元的离散总电荷 $Q\\,[\\mathrm{C}]$ 作为单元积分方程右侧的源项；要验证的离散互易性恒等式是\n  $$\n  I_1 \\equiv \\sum_{\\text{cells}} Q_1 \\,\\phi_2 \\;\\stackrel{?}{=}\\; \\sum_{\\text{cells}} Q_2 \\,\\phi_1 \\equiv I_2.\n  $$\n- 使用带狄利克雷边界条件的边值问题的唯一性定理来证明为每个源唯一求解 $\\phi$ 的合理性。\n\n离散化要求：\n- 在间距为 $h$ 的均匀网格上使用有限体积离散化，使得每个内部单元 $C$ 的离散平衡方程为\n  $$\n  \\epsilon_{x,e}(\\phi_E - \\phi_C) - \\epsilon_{x,w}(\\phi_C - \\phi_W) + \\epsilon_{y,n}(\\phi_N - \\phi_C) - \\epsilon_{y,s}(\\phi_C - \\phi_S) = -Q_C,\n  $$\n  其中 $\\epsilon_{x,e}$ 是东侧面上的有效介电常数（使用来自两个相邻单元的 $\\epsilon_x$ 的谐波平均值），其他面也类似。对于狄利克雷边界邻居，将 $\\phi=0$ 处理，并仅将相应的面系数包含在内部单元的对角线项中。对于对称的 $\\underline{\\underline{\\epsilon}}(\\omega)$，这种构造产生一个复对称系统矩阵。\n- 将偶极子表示为分配给相邻内部单元的离散电荷 $+q$ 和 $-q$，每个偶极子的净电荷为零。\n\n物理和数值单位：\n- 使用国际单位制 (SI)。真空介电常数为 $\\epsilon_0 = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$。网格间距为 $h=10^{-3}\\,\\mathrm{m}$。\n\n测试套件和参数规格：\n- 全局域设置：$N_x=40$，$N_y=40$，$h=10^{-3}\\,\\mathrm{m}$。板占据行 $j_1=14$ 到 $j_2=26$（包含，从底部的行 $0$ 计数到顶部的 $N_y-1$）。所有偶极子的电荷量 $q=10^{-9}\\,\\mathrm{C}$。确保偶极子中心距离边界至少一个单元，以便两个电荷都位于内部单元上。\n- 材料模型：\n  - 各向异性色散板 A：$\\epsilon_{\\infty,x} = 2\\,\\epsilon_0$，$\\epsilon_{s,x} = 8\\,\\epsilon_0$，$\\tau_x = 1\\times 10^{-10}\\,\\mathrm{s}$，$\\sigma_x = 0.5\\,\\mathrm{S/m}$；$\\epsilon_{\\infty,y} = 3\\,\\epsilon_0$，$\\epsilon_{s,y} = 6\\,\\epsilon_0$，$\\tau_y = 5\\times 10^{-11}\\,\\mathrm{s}$，$\\sigma_y = 0.2\\,\\mathrm{S/m}$。\n  - 各向同性无损板 B：$\\epsilon_{\\infty,x} = \\epsilon_{\\infty,y} = 4\\,\\epsilon_0$，$\\epsilon_{s,x} = \\epsilon_{s,y} = 4\\,\\epsilon_0$，$\\sigma_x = \\sigma_y = 0$，$\\tau$ 为任意值（因为 $\\epsilon_s=\\epsilon_{\\infty}$，所以不相关）。\n- 频率：\n  - $\\omega_1 = 2\\pi \\cdot 5\\times 10^{9}\\,\\mathrm{rad/s}$，\n  - $\\omega_2 = 2\\pi \\cdot 5\\times 10^{7}\\,\\mathrm{rad/s}$，\n  - $\\omega_3 = 2\\pi \\cdot 3\\times 10^{10}\\,\\mathrm{rad/s}$。\n- 偶极子位置和方向：\n  - 情况 1（一般各向异性色散，中等频率）：材料 A 在 $\\omega_1$；偶极子 $\\rho_1$ 中心在 $(i,j)=(8,10)$，沿 $x$ 方向；偶极子 $\\rho_2$ 中心在 $(i,j)=(30,29)$，沿 $y$ 方向。\n  - 情况 2（低频，强色散/导电损耗）：材料 A 在 $\\omega_2$；偶极子位置与情况 1 相同。\n  - 情况 3（各向同性，无损校验）：材料 B 在 $\\omega_1$；偶极子 $\\rho_1$ 中心在 $(i,j)=(12,20)$，沿 $x$ 方向；偶极子 $\\rho_2$ 中心在 $(i,j)=(28,20)$，沿 $y$ 方向。\n  - 情况 4（近界面边界情况）：材料 A 在 $\\omega_3$；板界面靠近 $j=14$；偶极子 $\\rho_1$ 中心在 $(i,j)=(20,13)$，沿 $x$ 方向；偶极子 $\\rho_2$ 中心在 $(i,j)=(22,27)$，沿 $y$ 方向。\n- 对于每种情况，计算 $\\rho_1$ 对应的 $\\phi_1$ 和 $\\rho_2$ 对应的 $\\phi_2$，然后评估离散互易性积分 $I_1 = \\sum Q_1 \\phi_2$ 和 $I_2 = \\sum Q_2 \\phi_1$。报告每种情况下的无量纲互易性误差，定义为\n  $$\n  \\mathrm{err} \\;=\\; \\frac{\\left| I_1 - I_2 \\right|}{\\max\\left(\\left|I_1\\right|, \\left|I_2\\right|, \\varepsilon\\right)} \\quad \\text{with} \\quad \\varepsilon=10^{-30}.\n  $$\n\n程序要求：\n- 您的程序必须使用面系数的谐波平均为算子 $\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}}(\\omega)\\nabla \\phi\\right)$ 组装复对称有限体积矩阵，使用稀疏直接法为每种情况求解两个线性系统以获得 $\\phi_1$ 和 $\\phi_2$，并计算上述测试套件的四个互易性误差。\n- 最终输出格式：您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，“[r1,r2,r3,r4]”），其中每个 $r_k$ 是情况 $k$ 的互易性误差，为全机器精度的浮点数。不应打印任何附加文本。", "solution": "该问题要求在二维电准静态 (EQS) 框架内对 Lorentz 互易定理进行数值验证。该系统涉及一个有损、各向异性且色散的介质板。验证将通过模拟两个不同的偶极子源及其相应的势场，然后评估互易性恒等式来进行。整个公式必须基于麦克斯韦方程组，并使用能保持底层物理算子对称性的有限体积法进行离散化。\n\n**1. 互易性的理论基础**\n\nLorentz 互易定理是从麦克斯韦方程组导出的一个基本原理。对于线性介质中频率为 $\\omega$ 的两组时谐源 $(\\mathbf{J}_1, \\rho_1)$ 和 $(\\mathbf{J}_2, \\rho_2)$，该定理的一般形式为：\n$$\n\\int_V \\left( \\mathbf{E}_1 \\cdot \\mathbf{J}_2 - \\mathbf{H}_1 \\cdot \\mathbf{M}_2 \\right) dV = \\int_V \\left( \\mathbf{E}_2 \\cdot \\mathbf{J}_1 - \\mathbf{H}_2 \\cdot \\mathbf{M}_1 \\right) dV\n$$\n前提是材料本构关系 $\\mathbf{D} = \\underline{\\underline{\\epsilon}}\\mathbf{E}$ 和 $\\mathbf{B} = \\underline{\\underline{\\mu}}\\mathbf{H}$ 采用对称张量，即 $\\underline{\\underline{\\epsilon}}^T = \\underline{\\underline{\\epsilon}}$ 和 $\\underline{\\underline{\\mu}}^T = \\underline{\\underline{\\mu}}$。所考虑的问题是非磁性的（$\\mathbf{M}_1 = \\mathbf{M}_2 = 0$），并且在电准静态极限下运行，其中传导电流 $\\mathbf{J}$ 通过介电常数的虚部进行建模，电场是无旋的，$\\mathbf{E} = -\\nabla\\phi$。\n\n电势 $\\phi$ 的控制方程源自高斯定律 $\\nabla \\cdot \\mathbf{D} = \\rho$：\n$$\n\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}}(\\omega)\\mathbf{E}\\right) = \\rho \\quad \\implies \\quad \\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}}(\\omega)\\nabla\\phi\\right) = -\\rho\n$$\n让我们考虑对应于电荷分布 $\\rho_1$ 和 $\\rho_2$ 的两个独立场景，分别产生电势 $\\phi_1$ 和 $\\phi_2$：\n$$\n\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}} \\nabla \\phi_1\\right) = -\\rho_1\n$$\n$$\n\\nabla \\cdot \\left(\\underline{\\underline{\\epsilon}} \\nabla \\phi_2\\right) = -\\rho_2\n$$\n我们将第一个方程乘以 $\\phi_2$ 并在域体积 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} \\phi_2 \\left[ \\nabla \\cdot (\\underline{\\underline{\\epsilon}} \\nabla \\phi_1) \\right] dV = -\\int_{\\Omega} \\rho_1 \\phi_2 dV\n$$\n使用矢量恒等式 $\\nabla \\cdot (f\\mathbf{A}) = f(\\nabla \\cdot \\mathbf{A}) + \\mathbf{A} \\cdot \\nabla f$，其中 $f=\\phi_2$ 且 $\\mathbf{A} = \\underline{\\underline{\\epsilon}}\\nabla\\phi_1$，左侧变为：\n$$\n\\int_{\\Omega} \\left[ \\nabla \\cdot (\\phi_2 \\underline{\\underline{\\epsilon}} \\nabla \\phi_1) - (\\underline{\\underline{\\epsilon}} \\nabla \\phi_1) \\cdot \\nabla \\phi_2 \\right] dV\n$$\n对第一项应用散度定理，得到边界 $\\partial\\Omega$ 上的面积分。由于问题指定了齐次狄利克雷边界条件（在 $\\partial\\Omega$ 上 $\\phi=0$），该面积分为零。我们剩下：\n$$\n-\\int_{\\Omega} (\\underline{\\underline{\\epsilon}} \\nabla \\phi_1) \\cdot \\nabla \\phi_2 dV = -\\int_{\\Omega} \\rho_1 \\phi_2 dV\n$$\n左侧可以写成标量积 $(\\nabla\\phi_2)^T \\underline{\\underline{\\epsilon}} (\\nabla\\phi_1)$。通过交换索引 $1$ 和 $2$，我们得到对称关系：\n$$\n\\int_{\\Omega} (\\underline{\\underline{\\epsilon}} \\nabla \\phi_2) \\cdot \\nabla \\phi_1 dV = \\int_{\\Omega} \\rho_2 \\phi_1 dV\n$$\n其左侧是 $(\\nabla\\phi_1)^T \\underline{\\underline{\\epsilon}} (\\nabla\\phi_2)$。如果涉及源的两个积分相等，则互易定理成立。这要求双线性形式相等：\n$$\n\\int_{\\Omega} (\\nabla\\phi_2)^T \\underline{\\underline{\\epsilon}} (\\nabla\\phi_1) dV = \\int_{\\Omega} (\\nabla\\phi_1)^T \\underline{\\underline{\\epsilon}} (\\nabla\\phi_2) dV\n$$\n由于这是一个标量等式，右侧等于其转置：$[(\\nabla\\phi_1)^T \\underline{\\underline{\\epsilon}} (\\nabla\\phi_2)]^T = (\\nabla\\phi_2)^T \\underline{\\underline{\\epsilon}}^T (\\nabla\\phi_1)$。与左侧比较，如果介电常数张量是对称的，即 $\\underline{\\underline{\\epsilon}} = \\underline{\\underline{\\epsilon}}^T$，则等式得到保证。问题指定了一个对角（因而是对称）的介电常数张量 $\\underline{\\underline{\\epsilon}}(\\omega)$。因此，连续互易性恒等式成立：\n$$\n\\int_{\\Omega} \\rho_1 \\phi_2 dV = \\int_{\\Omega} \\rho_2 \\phi_1 dV\n$$\n\n**2. 有限体积离散化**\n\n我们在大小为 $N_x \\times N_y$、间距为 $h$ 的均匀笛卡尔网格上离散化控制方程。势 $\\phi$ 定义在每个单元的中心。对方程 $\\nabla \\cdot (\\underline{\\underline{\\epsilon}}\\nabla\\phi) = -\\rho$ 在一个单元 $C_{i,j}$ 上积分并应用散度定理，得到：\n$$\n\\oint_{\\partial C_{i,j}} (\\underline{\\underline{\\epsilon}}\\nabla\\phi) \\cdot \\hat{\\mathbf{n}} dS = -\\int_{C_{i,j}} \\rho dV = -Q_{i,j}\n$$\n其中 $Q_{i,j}$ 是单元 $C_{i,j}$ 中的总电荷。面积分通过单元四个面（北、南、东、西）的通量之和来近似。对于单位深度的二维问题，面面积为 $h$。通过东侧面的通量是：\n$$\nF_e = \\left. (\\epsilon_x \\frac{\\partial\\phi}{\\partial x})\\right|_{i+1/2,j} h \\approx \\epsilon_{x,e} \\frac{\\phi_{i+1,j}-\\phi_{i,j}}{h} h = \\epsilon_{x,e}(\\phi_{E}-\\phi_C)\n$$\n其中 $\\phi_C = \\phi_{i,j}$ 且 $\\phi_E = \\phi_{i+1,j}$。面介电常数 $\\epsilon_{x,e}$ 使用谐波平均计算，以在材料界面处保持对称性和物理一致性：\n$$\n\\epsilon_{x,e} = \\frac{2\\epsilon_{x, C}\\epsilon_{x, E}}{\\epsilon_{x, C} + \\epsilon_{x, E}}\n$$\n对所有四个面的通量求和，得到内部单元 $C$ 的离散方程：\n$$\n\\epsilon_{x,e}(\\phi_E - \\phi_C) + \\epsilon_{x,w}(\\phi_W - \\phi_C) + \\epsilon_{y,n}(\\phi_N - \\phi_C) + \\epsilon_{y,s}(\\phi_S - \\phi_C) = -Q_C\n$$\n这可以重新排列成一个五点模板形式：\n$$\n-(\\epsilon_{x,e}+\\epsilon_{x,w}+\\epsilon_{y,n}+\\epsilon_{y,s})\\phi_C + \\epsilon_{x,e}\\phi_E + \\epsilon_{x,w}\\phi_W + \\epsilon_{y,n}\\phi_N + \\epsilon_{y,s}\\phi_S = -Q_C\n$$\n对于所有内部节点 $(i,j)$（其中 $i \\in \\{1,\\dots,N_x-2\\}$ 且 $j \\in \\{1,\\dots,N_y-2\\}$），这组线性方程可以写成矩阵形式 $A\\boldsymbol{\\phi} = \\mathbf{b}$。这里，$\\boldsymbol{\\phi}$ 是内部节点未知电势的向量，$\\mathbf{b}$ 是源向量，其元素为 $b_k = -Q_k$，而 $A$ 是系统矩阵。\n\n这种离散化的关键属性是得到的矩阵 $A$ 是对称的。一对相邻节点，例如 $C=(i,j)$ 和 $E=(i+1,j)$ 之间的耦合项，来自于单元 C 的方程（$\\phi_E$ 的系数是 $\\epsilon_{x,e}$）和单元 E 的方程（对于单元 E，$\\phi_C$ 的系数是 $\\epsilon_{x,w}$）。谐波平均的定义确保了从两侧看，面介电常数是相同的：$\\epsilon_{x,e}(i,j) = \\epsilon_{x,w}(i+1,j)$。因此，矩阵元素 $A_{CE}$ 等于 $A_{EC}$，矩阵 $A$ 是对称的（$A=A^T$）。\n\n**3. 互易性的数值验证**\n\n对于对称的系统矩阵 $A$，离散形式的互易性在数学上是保证的。设两个源向量 $\\mathbf{Q}_1$ 和 $\\mathbf{Q}_2$ 分别产生电势向量 $\\boldsymbol{\\phi}_1$ 和 $\\boldsymbol{\\phi}_2$。\n$$\nA\\boldsymbol{\\phi}_1 = -\\mathbf{Q}_1 \\implies \\boldsymbol{\\phi}_1 = -A^{-1}\\mathbf{Q}_1\n$$\n$$\nA\\boldsymbol{\\phi}_2 = -\\mathbf{Q}_2 \\implies \\boldsymbol{\\phi}_2 = -A^{-1}\\mathbf{Q}_2\n$$\n离散互易性积分是 $I_1 = \\sum_k Q_{1,k}\\phi_{2,k} = \\mathbf{Q}_1^T \\boldsymbol{\\phi}_2$ 和 $I_2 = \\sum_k Q_{2,k}\\phi_{1,k} = \\mathbf{Q}_2^T \\boldsymbol{\\phi}_1$。代入电势的表达式：\n$$\nI_1 = \\mathbf{Q}_1^T (-A^{-1}\\mathbf{Q}_2) = -\\mathbf{Q}_1^T A^{-1}\\mathbf{Q}_2\n$$\n$$\nI_2 = \\mathbf{Q}_2^T (-A^{-1}\\mathbf{Q}_1) = -\\mathbf{Q}_2^T A^{-1}\\mathbf{Q}_1\n$$\n由于 $I_2$ 是一个标量，它等于其转置：$I_2 = -(\\mathbf{Q}_2^T A^{-1}\\mathbf{Q}_1)^T = -\\mathbf{Q}_1^T (A^{-1})^T \\mathbf{Q}_2$。要使互易性（$I_1 = I_2$）成立，我们需要 $A^{-1} = (A^{-1})^T$，这当且仅当 $A = A^T$ 时为真。\n因此，数值实验验证了有限体积实现的正确性，特别是系统矩阵 $A$ 的对称组装。预期的结果是互易性误差接近机器精度，这仅仅是由浮点运算和线性求解器的数值容差引起的。\n\n**4. 实现策略**\n\n每个测试用例的数值流程如下：\n1.  定义网格参数（$N_x, N_y, h$）、材料属性和激励频率 $\\omega$。\n2.  根据给定 $\\omega$ 的材料模型，为所有单元 $(i,j)$ 构建复介电常数网格 $\\epsilon_x(i,j)$ 和 $\\epsilon_y(i,j)$。\n3.  通过遍历所有内部单元并使用面介电常数的谐波平均计算五点模板系数，组装 $(N_x-2)(N_y-2) \\times (N_x-2)(N_y-2)$ 的复对称稀疏矩阵 $A$。\n4.  为两个偶极子定义电荷分布 $Q_1$ 和 $Q_2$，并构建相应的源向量 $\\mathbf{b}_1 = -\\mathbf{Q}_1$ 和 $\\mathbf{b}_2 = -\\mathbf{Q}_2$。\n5.  使用稀疏直接求解器求解两个线性系统 $A\\boldsymbol{\\phi}_1 = \\mathbf{b}_1$ 和 $A\\boldsymbol{\\phi}_2 = \\mathbf{b}_2$，以获得电势向量 $\\boldsymbol{\\phi}_1$ 和 $\\boldsymbol{\\phi}_2$。\n6.  计算互易性积分 $I_1 = \\mathbf{Q}_1^T\\boldsymbol{\\phi}_2$ 和 $I_2 = \\mathbf{Q}_2^T\\boldsymbol{\\phi}_1$。由于源向量是稀疏的（每个偶极子仅在两个位置非零），这些是简单的求和。\n7.  使用提供的公式计算相对误差：$\\mathrm{err} = |I_1 - I_2| / \\max(|I_1|, |I_2|, \\varepsilon)$。\n\n对四个指定的测试用例中的每一个重复此过程，并报告最终的误差列表。", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Verifies Lorentz reciprocity for a 2D electroquasistatic system\n    with an anisotropic, dispersive, and lossy slab.\n    \"\"\"\n    \n    # Physical and numerical constants\n    e0 = 8.8541878128e-12  # Vacuum permittivity in F/m\n    \n    # Global domain settings\n    Nx, Ny = 40, 40\n    h = 1e-3  # Grid spacing in m\n    slab_j1, slab_j2 = 14, 26\n    q_mag = 1e-9  # Charge magnitude for dipoles in C\n    err_eps = 1e-30 # Small number for error denominator\n    \n    # Test case definitions\n    # (material_params, omega, dipole1_info, dipole2_info)\n    \n    # Material A model\n    mat_A = {\n        'eps_inf_x': 2 * e0, 'eps_s_x': 8 * e0, 'tau_x': 1e-10, 'sigma_x': 0.5,\n        'eps_inf_y': 3 * e0, 'eps_s_y': 6 * e0, 'tau_y': 5e-11, 'sigma_y': 0.2\n    }\n    \n    # Material B model (isotropic, lossless)\n    mat_B = {\n        'eps_inf_x': 4 * e0, 'eps_s_x': 4 * e0, 'tau_x': 1e-10, 'sigma_x': 0.0,\n        'eps_inf_y': 4 * e0, 'eps_s_y': 4 * e0, 'tau_y': 1e-10, 'sigma_y': 0.0\n    }\n    \n    # Frequencies\n    w1 = 2 * np.pi * 5e9\n    w2 = 2 * np.pi * 5e7\n    w3 = 2 * np.pi * 3e10\n    \n    test_cases = [\n        (mat_A, w1, {'center': (8, 10), 'orient': 'x'}, {'center': (30, 29), 'orient': 'y'}),\n        (mat_A, w2, {'center': (8, 10), 'orient': 'x'}, {'center': (30, 29), 'orient': 'y'}),\n        (mat_B, w1, {'center': (12, 20), 'orient': 'x'}, {'center': (28, 20), 'orient': 'y'}),\n        (mat_A, w3, {'center': (20, 13), 'orient': 'x'}, {'center': (22, 27), 'orient': 'y'})\n    ]\n\n    results = []\n\n    def get_permittivity(mat_params, w):\n        \"\"\"Calculates complex permittivity for a given material and frequency.\"\"\"\n        eps = {}\n        for k in ['x', 'y']:\n            eps_inf = mat_params[f'eps_inf_{k}']\n            eps_s = mat_params[f'eps_s_{k}']\n            tau = mat_params[f'tau_{k}']\n            sigma = mat_params[f'sigma_{k}']\n            \n            # Debye + conductivity model\n            eps[k] = eps_inf + (eps_s - eps_inf) / (1 + 1j * w * tau) + sigma / (1j * w)\n        return eps['x'], eps['y']\n\n    for case_num, (mat_params, w, d1_info, d2_info) in enumerate(test_cases):\n        \n        # 1. Construct permittivity grid\n        eps_x = np.full((Nx, Ny), e0, dtype=complex)\n        eps_y = np.full((Nx, Ny), e0, dtype=complex)\n        \n        slab_eps_x, slab_eps_y = get_permittivity(mat_params, w)\n        \n        eps_x[:, slab_j1:slab_j2 + 1] = slab_eps_x\n        eps_y[:, slab_j1:slab_j2 + 1] = slab_eps_y\n        \n        # 2. Assemble system matrix A\n        num_unknowns = (Nx - 2) * (Ny - 2)\n        A = lil_matrix((num_unknowns, num_unknowns), dtype=complex)\n        \n        # Map 2D interior grid (i, j) to 1D vector index k\n        def to_k(i, j):\n            return (j - 1) * (Nx - 2) + (i - 1)\n\n        for j in range(1, Ny - 1):      # Iterate over interior rows\n            for i in range(1, Nx - 1):  # Iterate over interior columns\n                \n                k = to_k(i, j)\n                \n                # West face\n                eps_x_w_val = (2 * eps_x[i-1, j] * eps_x[i, j]) / (eps_x[i-1, j] + eps_x[i, j])\n                \n                # East face\n                eps_x_e_val = (2 * eps_x[i, j] * eps_x[i+1, j]) / (eps_x[i, j] + eps_x[i+1, j])\n                \n                # South face\n                eps_y_s_val = (2 * eps_y[i, j-1] * eps_y[i, j]) / (eps_y[i, j-1] + eps_y[i, j])\n                \n                # North face\n                eps_y_n_val = (2 * eps_y[i, j] * eps_y[i, j+1]) / (eps_y[i, j] + eps_y[i, j+1])\n\n                # Diagonal term\n                A[k, k] = -(eps_x_w_val + eps_x_e_val + eps_y_s_val + eps_y_n_val)\n                \n                # Off-diagonal terms\n                if i > 1:\n                    A[k, to_k(i-1, j)] = eps_x_w_val  # West neighbor\n                if i  Nx - 2:\n                    A[k, to_k(i+1, j)] = eps_x_e_val  # East neighbor\n                if j > 1:\n                    A[k, to_k(i, j-1)] = eps_y_s_val  # South neighbor\n                if j  Ny - 2:\n                    A[k, to_k(i, j+1)] = eps_y_n_val  # North neighbor\n\n        A = A.tocsc()\n        \n        # 3. Create source vectors\n        def create_source_vector(dipole_info):\n            Q = np.zeros((Nx, Ny), dtype=complex)\n            i, j = dipole_info['center']\n            \n            if dipole_info['orient'] == 'x':\n                i1, j1 = i, j\n                i2, j2 = i + 1, j\n            else: # 'y'\n                i1, j1 = i, j\n                i2, j2 = i, j + 1\n            \n            Q[i1, j1] = -q_mag\n            Q[i2, j2] = +q_mag\n            \n            # Map Q grid to 1D source vector b = -Q\n            b = np.zeros(num_unknowns, dtype=complex)\n            for j_s in range(1, Ny - 1):\n                for i_s in range(1, Nx - 1):\n                    if Q[i_s, j_s] != 0:\n                        b[to_k(i_s, j_s)] = -Q[i_s, j_s]\n            \n            return Q, b\n            \n        Q1_grid, b1 = create_source_vector(d1_info)\n        Q2_grid, b2 = create_source_vector(d2_info)\n        \n        # 4. Solve linear systems\n        phi1_vec = spsolve(A, b1)\n        phi2_vec = spsolve(A, b2)\n\n        # 5. Calculate reciprocity integrals and error\n        I1 = 0.0\n        I2 = 0.0\n        \n        # Find non-zero charge locations\n        Q1_locs = np.argwhere(Q1_grid != 0)\n        Q2_locs = np.argwhere(Q2_grid != 0)\n        \n        # I1 = sum(Q1 * phi2)\n        for i, j in Q1_locs:\n            k = to_k(i, j)\n            I1 += Q1_grid[i, j] * phi2_vec[k]\n        \n        # I2 = sum(Q2 * phi1)\n        for i, j in Q2_locs:\n            k = to_k(i, j)\n            I2 += Q2_grid[i, j] * phi1_vec[k]\n\n        error = abs(I1 - I2) / max(abs(I1), abs(I2), err_eps)\n        results.append(error)\n        \n    # Final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3354270"}]}