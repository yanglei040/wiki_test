{"hands_on_practices": [{"introduction": "在数值计算中，我们常用有限差分来近似导数，其中中心差分格式因其较高的精度而备受青睐。要真正理解其精度和误差的来源，最好的方法是从泰勒级数展开出发，亲手推导其截断误差。这项练习将引导您完成这一基本推导，为您掌握更复杂的数值分析技术奠定坚实的数学基础。[@problem_id:3593417]", "problem": "在地震波传播的一维数值模拟中，光滑标量波场 $f(x)$ 沿测线的空间梯度通常在间距为 $h$ 的均匀网格上使用对称有限差分格式进行近似。考虑使用中心差分近似\n$$\n\\frac{f_{i+1}-f_{i-1}}{2h}\n$$\n来计算空间导数 $f'(x_i)$，其中 $f_i \\equiv f(x_i)$ 且 $x_{i\\pm 1} = x_i \\pm h$。假设函数 $f$ 在 $x_i$ 附近足够光滑，以允许进行泰勒级数展开。\n\n从 $f$ 在 $x_i$ 点的泰勒级数展开出发，推导当使用上述中心差分来近似 $f'(x_i)$ 时的精度阶和主截断误差项。你的推导必须从泰勒级数的定义开始，并通过格式对称性所蕴含的系统性逐项相消来进行；不得在没有推导的情况下直接引用任何误差项公式。\n\n请提供主阶截断误差项作为最终答案，该答案应为一个以 $h$ 和 $f$ 在 $x_i$ 处求得的导数表示的单一闭式解析表达式。无需数值舍入，也无需单位。精度阶应在你的推导过程中给出理由，但不应包含在最终的方框答案中。", "solution": "该问题要求推导一阶导数 $f'(x_i)$ 的中心差分近似的精度阶和主截断误差项。该近似由公式 $\\frac{f_{i+1}-f_{i-1}}{2h}$ 给出，其中 $f_j \\equiv f(x_j)$ 且 $x_{i \\pm 1} = x_i \\pm h$。推导必须基于函数 $f(x)$ 在点 $x_i$ 的泰勒级数展开。\n\n局部截断误差，我们记为 $\\tau(x_i, h)$，其形式化定义为作用于精确函数的有限差分近似值与其旨在近似的精确导数值之间的差。因此，我们有：\n$$\n\\tau(x_i, h) = \\frac{f(x_i+h) - f(x_i-h)}{2h} - f'(x_i)\n$$\n为分析此表达式，我们使用 $f(x)$ 在点 $x_i$ 的泰勒级数展开。题目中 $f(x)$ “足够光滑” 的前提保证了此展开的有效性。我们展开 $f(x_i+h)$ 和 $f(x_i-h)$，并将 $f(x)$ 在 $x_i$ 处的 $n$ 阶导数记为 $f^{(n)}(x_i)$。为清晰起见，我们还使用记号 $f_i \\equiv f(x_i)$。\n\n$f(x_i+h)$ 的泰勒级数展开为：\n$$\nf_{i+1} = f(x_i+h) = f(x_i) + h f'(x_i) + \\frac{h^2}{2!} f''(x_i) + \\frac{h^3}{3!} f^{(3)}(x_i) + \\frac{h^4}{4!} f^{(4)}(x_i) + \\frac{h^5}{5!} f^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n代入阶乘的数值：\n$$\nf_{i+1} = f_i + h f'(x_i) + \\frac{h^2}{2} f''(x_i) + \\frac{h^3}{6} f^{(3)}(x_i) + \\frac{h^4}{24} f^{(4)}(x_i) + \\frac{h^5}{120} f^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n类似地，$f(x_i-h)$ 的泰勒级数展开为：\n$$\nf_{i-1} = f(x_i-h) = f(x_i) + (-h) f'(x_i) + \\frac{(-h)^2}{2!} f''(x_i) + \\frac{(-h)^3}{3!} f^{(3)}(x_i) + \\frac{(-h)^4}{4!} f^{(4)}(x_i) + \\frac{(-h)^5}{5!} f^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n$$\nf_{i-1} = f_i - h f'(x_i) + \\frac{h^2}{2} f''(x_i) - \\frac{h^3}{6} f^{(3)}(x_i) + \\frac{h^4}{24} f^{(4)}(x_i) - \\frac{h^5}{120} f^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n按照题目要求，我们现在系统地演示各项的相消过程。我们计算差值 $f_{i+1} - f_{i-1}$，它构成了中心差分公式的分子。\n\\begin{align*}\nf_{i+1} - f_{i-1} =  \\left( f_i + h f'(x_i) + \\frac{h^2}{2} f''(x_i) + \\frac{h^3}{6} f^{(3)}(x_i) + \\frac{h^4}{24} f^{(4)}(x_i) + \\dots \\right) \\\\\n - \\left( f_i - h f'(x_i) + \\frac{h^2}{2} f''(x_i) - \\frac{h^3}{6} f^{(3)}(x_i) + \\frac{h^4}{24} f^{(4)}(x_i) - \\dots \\right)\n\\end{align*}\n按 $f(x)$ 的导数阶数对各项进行分组：\n\\begin{align*}\n\\text{零阶：} \\quad  f_i - f_i = 0 \\\\\n\\text{一阶：} \\quad  h f'(x_i) - (-h f'(x_i)) = 2h f'(x_i) \\\\\n\\text{二阶：} \\quad  \\frac{h^2}{2} f''(x_i) - \\frac{h^2}{2} f''(x_i) = 0 \\\\\n\\text{三阶：} \\quad  \\frac{h^3}{6} f^{(3)}(x_i) - \\left(-\\frac{h^3}{6} f^{(3)}(x_i)\\right) = 2 \\frac{h^3}{6} f^{(3)}(x_i) = \\frac{h^3}{3} f^{(3)}(x_i) \\\\\n\\text{四阶：} \\quad  \\frac{h^4}{24} f^{(4)}(x_i) - \\frac{h^4}{24} f^{(4)}(x_i) = 0 \\\\\n\\text{五阶：} \\quad  \\frac{h^5}{120} f^{(5)}(x_i) - \\left(-\\frac{h^5}{120} f^{(5)}(x_i)\\right) = 2 \\frac{h^5}{120} f^{(5)}(x_i) = \\frac{h^5}{60} f^{(5)}(x_i)\n\\end{align*}\n此计算说明了对称格式的一个关键特性：所有对应于偶数阶导数（$f_i$，$f''(x_i)$，$f^{(4)}(x_i)$ 等）的项都相互抵消，而对应于奇数阶导数（$f'(x_i)$，$f^{(3)}(x_i)$，$f^{(5)}(x_i)$ 等）的项则相加。\n\n将非零项相加，差值 $f_{i+1} - f_{i-1}$ 为：\n$$\nf_{i+1} - f_{i-1} = 2h f'(x_i) + \\frac{h^3}{3} f^{(3)}(x_i) + \\frac{h^5}{60} f^{(5)}(x_i) + \\mathcal{O}(h^7)\n$$\n现在，我们除以 $2h$ 来构建完整的中心差分近似式：\n$$\n\\frac{f_{i+1} - f_{i-1}}{2h} = \\frac{1}{2h} \\left( 2h f'(x_i) + \\frac{h^3}{3} f^{(3)}(x_i) + \\frac{h^5}{60} f^{(5)}(x_i) + \\mathcal{O}(h^7) \\right)\n$$\n$$\n\\frac{f_{i+1} - f_{i-1}}{2h} = f'(x_i) + \\frac{h^2}{6} f^{(3)}(x_i) + \\frac{h^4}{120} f^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n通过从两侧减去 $f'(x_i)$，我们分离出截断误差 $\\tau(x_i, h)$：\n$$\n\\tau(x_i, h) = \\frac{f_{i+1} - f_{i-1}}{2h} - f'(x_i) = \\frac{h^2}{6} f^{(3)}(x_i) + \\frac{h^4}{120} f^{(5)}(x_i) + \\mathcal{O}(h^6)\n$$\n数值格式的精度阶由局部截断误差级数展开式中网格间距 $h$ 的最低次幂决定。当 $h \\to 0$ 时，假设 $f^{(3)}(x_i) \\neq 0$，则项 $\\frac{h^2}{6} f^{(3)}(x_i)$ 是误差的主导部分。因此，误差与 $h^2$ 成正比，记为 $\\mathcal{O}(h^2)$。这意味着中心差分近似是二阶精度的。\n\n主阶截断误差项是误差级数中的第一个非零项。根据我们推导的表达式，该项为：\n$$\n\\frac{h^2}{6} f^{(3)}(x_i)\n$$\n至此，所需推导完成。", "answer": "$$\n\\boxed{\\frac{h^2}{6} f^{(3)}(x_i)}\n$$", "id": "3593417"}, {"introduction": "在实际的模拟中，为了抑制数值伪影或提高稳定性，我们常常会引入滤波器或人工耗散项。然而，这些看似有益的操作可能会带来意想不到的后果。本练习将使用修正方程（modified equation）分析法，揭示在标准FDTD格式中加入一个简单的空间滤波器如何改变其底层的偏微分方程，并最终导致其形式精度阶数降低。[@problem_id:3358120]", "problem": "考虑一维无源麦克斯韦方程组，在均匀真空中，以归一化单位书写，使得光速为 $c$，介电常数和磁导率均为1：\n$$\n\\partial_{t} E(x,t) \\,=\\, -\\,\\partial_{x} H(x,t),\\qquad\n\\partial_{t} H(x,t) \\,=\\, -\\,\\partial_{x} E(x,t).\n$$\n使用时域有限差分（FDTD）方法的经典交错网格蛙跳格式，在间距为 $h$ 的均匀网格上离散化这些方程。其中，电场样本 $E^{n}_{i}$ 位于整数网格点 $x_{i}=i\\,h$ 和时间点 $t^{n}=n\\,\\Delta t$ 上，磁场样本 $H^{n+\\frac{1}{2}}_{i+\\frac{1}{2}}$ 位于半网格点 $x_{i+\\frac{1}{2}}=(i+\\frac{1}{2})h$ 和半整数时间点 $t^{n+\\frac{1}{2}}=\\left(n+\\frac{1}{2}\\right)\\Delta t$ 上。假设采用周期性边界条件，并定义库朗-弗里德里希斯-列维数为 $\\lambda = c\\,\\Delta t / h \\in (0,1)$，且在 $h\\to 0$ 时保持固定。\n\n为抑制源于几何离散化的高波数阶梯伪影，通过在每个完整时间步对各自网格上的两个场分量应用一个显式后更新空间滤波器来增强该格式。具体来说，在将 $(E^{n}_{i},H^{n+\\frac{1}{2}}_{i+\\frac{1}{2}})$ 推进到 $(E^{n+1}_{i},H^{n+\\frac{3}{2}}_{i+\\frac{1}{2}})$ 的标准FDTD更新之后，应用以下三点平滑处理：\n$$\n\\widetilde{u}^{n+1}_{j} \\,=\\, (1-\\beta)\\,u^{n+1}_{j} \\,+\\, \\frac{\\beta}{2}\\left(u^{n+1}_{j+1} + u^{n+1}_{j-1}\\right),\n$$\n其中 $u$ 表示整数索引 $j=i$ 上的 $E$ 或半整数索引 $j=i+\\frac{1}{2}$ 上的 $H$，$\\beta\\in(0,1)$ 为恒定的滤波器强度，且与 $h$ 和 $\\Delta t$ 无关。\n\n使用基于光滑解的泰勒展开的修正方程分析方法，推导由滤波步骤扰动的领头阶连续谱方程，并识别其引入的有效人工耗散项。由此，确定在 $\\lambda$ 和 $\\beta$ 固定的情况下，进行网格细化时，滤波后格式的形式精度阶 $p$。将有效人工耗散系数表示为以 $\\beta$、$c$、$h$ 和 $\\lambda$ 为变量的闭式解析表达式，并给出整数 $p$。\n\n你的最终答案必须同时包含这两个量。无需进行数值计算或四舍五入。最终答案必须以单行矩阵的形式给出。", "solution": "本分析旨在推导由指定数值格式近似的修正偏微分方程。该过程通过对离散算子进行泰勒级数展开来完成。\n\n首先，我们考虑一个更通用的、波速为 $c$ 的一维无源麦克斯韦方程组：\n$$ \\partial_t E = -c \\partial_x H $$\n$$ \\partial_t H = -c \\partial_x E $$\n当 $c=1$ 时，这与问题中给出的方程组一致。\n\n标准的蛙跳FDTD格式对该系统是二阶精度（$O(\\Delta t^2, h^2)$）的近似。问题中的格式在每个标准FDTD更新步之后，额外应用了一个显式的空间滤波器。令 $u$ 代表电场 $E$ 或磁场 $H$。一个标准更新步计算出临时场 $u^{n+1, *}$。随后，滤波步骤计算出最终场 $u^{n+1}$：\n$$ u^{n+1}_j = (1-\\beta)u^{n+1, *}_j + \\frac{\\beta}{2}\\left(u^{n+1, *}_{j+1} + u^{n+1, *}_{j-1}\\right) $$\n我们可以将此式重写为：\n$$ u^{n+1}_j = u^{n+1, *}_j + \\frac{\\beta}{2}\\left(u^{n+1, *}_{j+1} - 2u^{n+1, *}_j + u^{n+1, *}_{j-1}\\right) $$\n括号内的项是 $h^2 \\partial_{xx}u$ 的二阶中心差分近似。因此，滤波器的作用是在每一步向解中加入一个与空间二阶导数相关的项。\n\n为了找到修正方程，我们分析这一滤波步骤如何改变时间演化。一个时间步 $\\Delta t$ 内的演化改变了时间导数的有限差分近似：\n$$ \\frac{u^{n+1} - u^n}{\\Delta t} = \\frac{u^{n+1,*} - u^n}{\\Delta t} + \\frac{u^{n+1} - u^{n+1,*}}{\\Delta t} $$\n右侧第一项是标准FDTD格式的贡献，其截断误差为 $O(h^2, \\Delta t^2)$。第二项是滤波器的贡献，可以写作：\n$$ \\frac{u^{n+1} - u^{n+1,*}}{\\Delta t} = \\frac{1}{\\Delta t} \\left[ \\frac{\\beta h^2}{2} \\left( \\frac{u^{n+1, *}_{j+1} - 2u^{n+1, *}_j + u^{n+1, *}_{j-1}}{h^2} \\right) \\right] $$\n在连续极限下，$h, \\Delta t \\to 0$，括号内的有限差分算子趋近于二阶导数 $\\partial_{xx}$，且 $u^{n+1, *}$ 趋近于 $u(x,t)$。因此，滤波器向原始偏微分方程引入了一个附加项：\n$$ (\\text{附加项}) = \\frac{\\beta h^2}{2\\Delta t} \\partial_{xx} u $$\n这是一个人工耗散（或扩散）项。其系数，即有效人工耗散系数，为：\n$$ D = \\frac{\\beta h^2}{2\\Delta t} $$\n根据CFL数 $\\lambda = c \\Delta t / h$ 的定义，我们可以用 $h$ 替换 $\\Delta t$：$\\Delta t = \\lambda h / c$。将此代入 $D$ 的表达式中：\n$$ D = \\frac{\\beta h^2}{2 (\\lambda h / c)} = \\frac{\\beta c h}{2\\lambda} $$\n因此，包含滤波引入的领头误差项的修正方程为：\n$$ \\partial_t u \\approx -c \\partial_x v + D \\partial_{xx} u $$\n其中 $u, v$ 代表 $E, H$ 场。\n\n由于 $\\beta, c, \\lambda$ 均为与 $h$ 无关的常数，所以耗散系数 $D$ 与 $h$ 成正比，即 $D = O(h)$。这个 $O(h)$ 的误差项的阶数低于底层FDTD格式的 $O(h^2)$ 截断误差。因此，当网格细化时，这个由滤波器引入的人工耗散项将主导总截断误差。\n\n综上所述，滤波后格式的形式精度阶 $p$ 由截断误差中 $h$ 的最低次幂决定，即 $p=1$。有效人工耗散系数为 $D = \\frac{\\beta c h}{2\\lambda}$。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{\\beta c h}{2\\lambda}  1 \\end{pmatrix} } $$", "id": "3358120"}, {"introduction": "理论上的局部截断误差与完整模拟中的全局误差之间存在着联系，但并不完全等同。本练习旨在通过一个完整的计算实验来弥合这一差距。您将通过编程实现经典的Yee氏FDTD格式，并进行系统的收敛性研究，从而不仅能以经验方式验证该格式的精度阶数，还能深入探究误差常数如何受到库朗数（Courant number）等关键模拟参数的影响。[@problem_id:3358130]", "problem": "考虑一维无源麦克斯韦方程组的无量纲形式，该方程组定义在一个周期为 $L=1$ 的周期性域上，\n$$\n\\frac{\\partial E}{\\partial t} = -\\frac{\\partial H}{\\partial x}, \\qquad \\frac{\\partial H}{\\partial t} = -\\frac{\\partial E}{\\partial x},\n$$\n其中 $E(x,t)$ 和 $H(x,t)$ 分别表示电场和磁场分量，波速为1。场在 $x$ 方向上是光滑且周期为 $1$ 的。所有三角函数中的角度必须以弧度处理。\n\n使用Yee有限差分时域格式（在空间和时间上交错）。设空间网格为 $x_i = i \\Delta x$，对于 $i=0,1,\\dots,N_x-1$，其中 $\\Delta x = L/N_x$，并设磁场采样点位于半整数索引位置 $x_{i+\\tfrac{1}{2}} = (i+\\tfrac{1}{2})\\Delta x$。时间步长为 $\\Delta t = s \\Delta x$，其中 $s$ 是无量纲的Courant数，格式更新方式如下：\n$$\nH_{i+\\tfrac{1}{2}}^{n+\\tfrac{1}{2}} = H_{i+\\tfrac{1}{2}}^{n-\\tfrac{1}{2}} - \\frac{\\Delta t}{\\Delta x} \\left( E_{i+1}^{n} - E_{i}^{n} \\right),\n$$\n$$\nE_{i}^{n+1} = E_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left( H_{i+\\tfrac{1}{2}}^{n+\\tfrac{1}{2}} - H_{i-\\tfrac{1}{2}}^{n+\\tfrac{1}{2}} \\right),\n$$\n其中周期性边界条件应用于有限差分。\n\n采用光滑精确解\n$$\nE(x,t) = \\sin\\!\\big(2\\pi (x - t)\\big), \\qquad H(x,t) = \\sin\\!\\big(2\\pi (x - t)\\big),\n$$\n该解满足连续方程。根据此精确解对离散场进行一致性初始化，对于 $E$ 在 $t=0$ 时刻，对于 $H$ 在 $t=-\\tfrac{1}{2}\\Delta t$ 时刻，以避免第一步更新受到启动不一致性的污染。将格式演化至最终时间 $T=1$；如果 $T/\\Delta t$ 不是整数，则演化 $N=\\mathrm{round}(T/\\Delta t)$ 步，并在场的实际离散时间点与精确解进行比较，即电场采样点的时刻为 $t_E = N\\Delta t$，磁场采样点的时刻为 $t_H = N\\Delta t - \\tfrac{1}{2}\\Delta t$。\n\n定义离散 $\\ell^2$ 误差\n$$\n\\varepsilon_E = \\left( \\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left[ E_i^N - \\sin\\!\\big(2\\pi (x_i - t_E)\\big) \\right]^2 \\right)^{1/2}, \\qquad\n\\varepsilon_H = \\left( \\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left[ H_{i+\\tfrac{1}{2}}^{N-\\tfrac{1}{2}} - \\sin\\!\\big(2\\pi (x_{i+\\tfrac{1}{2}} - t_H)\\big) \\right]^2 \\right)^{1/2},\n$$\n以及组合误差\n$$\n\\varepsilon_{\\mathrm{tot}} = \\left( \\varepsilon_E^2 + \\varepsilon_H^2 \\right)^{1/2}.\n$$\n\n对于每个固定的Courant数 $s$，考虑空间分辨率序列 $N_x \\in \\{50, 100, 200, 400\\}$，以及相应的 $\\Delta x = 1/N_x$ 和 $\\Delta t = s \\Delta x$，并计算每个分辨率下在 $T=1$ 时的 $\\varepsilon_{\\mathrm{tot}}$。将固定 $s$ 下的渐近误差建模为\n$$\n\\varepsilon_{\\mathrm{tot}}(\\Delta x; s) \\approx C(s)\\, (\\Delta x)^{p(s)},\n$$\n其中 $p(s)$ 是观测到的全局精度阶数，$C(s)$ 是Courant数为 $s$ 时的误差常数。通过在给定分辨率上对 $\\log \\varepsilon_{\\mathrm{tot}}$ 与 $\\log \\Delta x$ 进行线性回归来估计 $p(s)$ 和 $C(s)$。将Courant数为 $s$ 时相对于参考Courant数 $s_{\\mathrm{ref}}$ 的误差放大因子定义为\n$$\n\\Gamma(s) = \\frac{C(s)}{C(s_{\\mathrm{ref}})}.\n$$\n\n你的任务是实现一个完整的程序，对Yee格式进行此项研究，计算一组Courant数下的观测阶数 $p(s)$ 和放大因子 $\\Gamma(s)$，并输出结果。\n\n使用以下Courant数（无量纲）测试集：$s \\in \\{0.2, 0.5, 0.8, 0.95, 0.99\\}$。取参考Courant数为 $s_{\\mathrm{ref}} = 0.2$。对于测试集中的每个 $s$，使用上述四种空间分辨率，进行模拟，计算在适当离散时间点上的 $\\varepsilon_{\\mathrm{tot}}$，通过在 $\\log$-$\\log$ 空间中进行最小二乘线性回归来估计 $p(s)$ 和 $C(s)$，然后计算 $\\Gamma(s)$。\n\n最终输出格式：你的程序应生成单行输出，包含五个Courant数的结果，结果为方括号括起来的逗号分隔列表。列表中的每个元素本身都必须是包含 $p(s)$ 和 $\\Gamma(s)$ 的双元素列表，两者均报告为四舍五入到六位小数的浮点数。例如，\n$$\n\\text{[}[p(s_1),\\Gamma(s_1)], [p(s_2),\\Gamma(s_2)], \\dots \\text{]}.\n$$\n不使用物理单位；所有量都是无量纲的，并且三角函数中出现的角度必须以弧度解释。", "solution": "我们从一维无源麦克斯韦方程组的无量纲形式开始，\n$$\n\\frac{\\partial E}{\\partial t} = -\\frac{\\partial H}{\\partial x}, \\qquad \\frac{\\partial H}{\\partial t} = -\\frac{\\partial E}{\\partial x},\n$$\n这是一个波速为1的对称双曲系统。一个光滑的周期解是\n$$\nE(x,t) = \\sin\\!\\big(2\\pi (x - t)\\big), \\qquad H(x,t) = \\sin\\!\\big(2\\pi (x - t)\\big),\n$$\n这个解满足该系统，因为 $\\frac{\\partial}{\\partial t}\\sin\\!\\big(2\\pi (x - t)\\big) = -2\\pi \\cos\\!\\big(2\\pi (x - t)\\big)$ 和 $\\frac{\\partial}{\\partial x}\\sin\\!\\big(2\\pi (x - t)\\big) = 2\\pi \\cos\\!\\big(2\\pi (x - t)\\big)$，因此 $\\frac{\\partial E}{\\partial t} = -\\frac{\\partial H}{\\partial x}$ 和 $\\frac{\\partial H}{\\partial t} = -\\frac{\\partial E}{\\partial x}$ 均成立。\n\nYee有限差分时域格式在空间和时间上都对 $E$ 和 $H$ 进行交错排列。在一个均匀网格上，空间步长为 $\\Delta x$，时间步长为 $\\Delta t = s \\Delta x$，其更新方式为\n$$\nH_{i+\\tfrac{1}{2}}^{n+\\tfrac{1}{2}} = H_{i+\\tfrac{1}{2}}^{n-\\tfrac{1}{2}} - \\frac{\\Delta t}{\\Delta x}\\left( E_{i+1}^{n} - E_{i}^{n} \\right),\n$$\n$$\nE_{i}^{n+1} = E_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left( H_{i+\\tfrac{1}{2}}^{n+\\tfrac{1}{2}} - H_{i-\\tfrac{1}{2}}^{n+\\tfrac{1}{2}} \\right),\n$$\n其中，通过环绕索引来强制施加周期性边界条件，以使域边界处的差分是一致的。\n\n为了测量截断误差和观测到的全局精度阶数，我们使用人造解法，采用上面给出的光滑周期精确场，并在 $t=0$ 时刻对 $E$、在 $t=-\\tfrac{1}{2}\\Delta t$ 时刻对 $H$ 进行一致性初始化。这消除了与渐近截断误差无关的启动瞬态。我们将场演化 $N=\\mathrm{round}(T/\\Delta t)$ 步，以达到电场时间 $t_E = N \\Delta t$ 和磁场时间 $t_H = N \\Delta t - \\tfrac{1}{2}\\Delta t$，然后计算离散 $\\ell^2$ 误差\n$$\n\\varepsilon_E = \\left( \\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left[ E_i^N - \\sin\\!\\big(2\\pi (x_i - t_E)\\big) \\right]^2 \\right)^{1/2},\n$$\n$$\n\\varepsilon_H = \\left( \\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left[ H_{i+\\tfrac{1}{2}}^{N-\\tfrac{1}{2}} - \\sin\\!\\big(2\\pi (x_{i+\\tfrac{1}{2}} - t_H)\\big) \\right]^2 \\right)^{1/2}.\n$$\n我们将这些误差汇总成一个组合误差范数\n$$\n\\varepsilon_{\\mathrm{tot}} = \\left( \\varepsilon_E^2 + \\varepsilon_H^2 \\right)^{1/2},\n$$\n这便于对两个场分量拟合单一的收敛率。\n\n对于一个固定的Courant数 $s$，对于光滑解，Yee格式在空间和时间上都是形式二阶精确的。在最终时间 $T$ 时的 $\\ell^2$ 范数下的全局误差预计会渐近地表现为\n$$\n\\varepsilon_{\\mathrm{tot}}(\\Delta x; s) \\approx C(s)\\, (\\Delta x)^{p(s)},\n$$\n其中 $p(s)$ 是观测到的全局阶数，$C(s)$ 是一个依赖于 $s$ 的误差常数。为了估计 $(p(s), C(s))$，我们对 $\\log \\varepsilon_{\\mathrm{tot}}$ 与 $\\log \\Delta x$ 进行线性回归，即\n$$\n\\log \\varepsilon_{\\mathrm{tot}} \\approx \\log C(s) + p(s)\\, \\log \\Delta x,\n$$\n因此斜率得到 $p(s)$，截距得到 $\\log C(s)$，从而 $C(s) = \\exp(\\text{intercept})$。相对于参考Courant数 $s_{\\mathrm{ref}}$ 的误差放大因子是\n$$\n\\Gamma(s) = \\frac{C(s)}{C(s_{\\mathrm{ref}})}.\n$$\n\n一个补充的、基于原理的视角是使用离散格式的傅里叶分析。结合交错更新，可以得到一维的离散色散关系，\n$$\n\\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) = s^2 \\sin^2\\!\\left(\\frac{k \\Delta x}{2}\\right),\n$$\n其中 $\\omega$ 是离散角频率，$k$ 是波数。对于小的 $\\Delta x$ 和固定的Courant数 $s$，展开两边得到\n$$\n\\omega \\approx k + \\frac{(s^2 - 1)}{24} k^3 \\Delta x^2 + \\mathcal{O}(\\Delta x^4),\n$$\n这揭示了二阶色散误差，其主导系数依赖于 $s$。在一维情况下，当 $s \\to 1$ 时，主导色散误差系数趋于零，而对于较小的 $s$，它是负的且绝对值更大。这个分析解释了为什么即使形式阶数 $p(s)$ 保持在 $2$ 附近，误差常数 $C(s)$ 也会随 $s$ 变化。在实践中，有限分辨率下的前渐近效应可能会轻微改变观测到的 $p(s)$，特别是在Courant数接近稳定性极限或时间步数增加时，但在多个分辨率上进行最小二乘回归可以减轻这些影响。\n\n程序的算法步骤：\n1. 对于测试集 $\\{0.2, 0.5, 0.8, 0.95, 0.99\\}$ 中的每个Courant数 $s$，为每个分辨率 $N_x \\in \\{50, 100, 200, 400\\}$ 设置 $\\Delta t = s \\Delta x$。\n2. 初始化 $E_i^0 = \\sin\\!\\big(2\\pi x_i\\big)$ 和 $H_{i+\\tfrac{1}{2}}^{-\\tfrac{1}{2}} = \\sin\\!\\big(2\\pi (x_{i+\\tfrac{1}{2}} + \\tfrac{1}{2}\\Delta t)\\big)$。\n3. 使用带周期性环绕的Yee更新进行演化，共 $N=\\mathrm{round}(1/\\Delta t)$ 步。\n4. 在 $t_E = N\\Delta t$ 和 $t_H = N\\Delta t - \\tfrac{1}{2}\\Delta t$ 时刻计算 $\\varepsilon_E$、$\\varepsilon_H$ 和 $\\varepsilon_{\\mathrm{tot}}$。\n5. 对 $\\log \\varepsilon_{\\mathrm{tot}}$ 与 $\\log \\Delta x$ 进行拟合以估计 $p(s)$ 和 $C(s)$，然后计算相对于 $s_{\\mathrm{ref}}=0.2$ 的 $\\Gamma(s)$。\n6. 将结果汇总成一个由 $[p(s), \\Gamma(s)]$ 对组成的单一列表，四舍五入到六位小数，并将其作为单个逗号分隔的行打印在方括号内。\n\n这个过程将基本的麦克斯韦方程和Yee离散化与截断误差行为和观测全局阶数的基于原理的估计相结合，并通过误差放大因子量化了Courant数如何影响误差常数。", "answer": "```python\nimport numpy as np\n\ndef yee_1d_error(Nx: int, s: float, T: float = 1.0) - float:\n    \"\"\"\n    Compute the combined L2 error for 1D Yee FDTD at final time T for a smooth periodic solution.\n    Domain length L=1, periodic boundary conditions, nondimensional units, angles in radians.\n    \"\"\"\n    L = 1.0\n    dx = L / Nx\n    dt = s * dx\n    # Number of steps to reach approximately T; use integer number of steps and exact discrete times for error comparison.\n    Nsteps = int(np.round(T / dt))\n    tE = Nsteps * dt\n    tH = tE - 0.5 * dt\n\n    # Grid points\n    x = np.arange(Nx) * dx\n    xh = (np.arange(Nx) + 0.5) * dx  # half-index positions for H\n\n    # Initialize E at t=0 and H at t=-dt/2 using the exact solution E=H=sin(2*pi*(x - t))\n    E = np.sin(2.0 * np.pi * (x - 0.0))\n    H_minus_half = np.sin(2.0 * np.pi * (xh - (-0.5 * dt)))  # H at t = -dt/2\n\n    # Time stepping\n    cfl = dt / dx\n    for _ in range(Nsteps):\n        # Update H at n+1/2 from H at n-1/2 and E at n\n        E_forward_diff = np.roll(E, -1) - E  # periodic forward difference E_{i+1} - E_i\n        H_plus_half = H_minus_half - cfl * E_forward_diff\n\n        # Update E at n+1 from E at n and H at n+1/2\n        H_diff = H_plus_half - np.roll(H_plus_half, 1)  # periodic difference H_{i+1/2} - H_{i-1/2}\n        E_next = E - cfl * H_diff\n\n        # Advance fields\n        E = E_next\n        H_minus_half = H_plus_half\n\n    # Exact fields at discrete times\n    E_exact = np.sin(2.0 * np.pi * (x - tE))\n    H_exact = np.sin(2.0 * np.pi * (xh - tH))\n\n    # L2 errors (discrete)\n    errE = np.sqrt(np.mean((E - E_exact) ** 2))\n    errH = np.sqrt(np.mean((H_minus_half - H_exact) ** 2))\n    err_tot = np.sqrt(errE ** 2 + errH ** 2)\n    return err_tot\n\n\ndef estimate_order_and_constant(dx_vals, err_vals):\n    \"\"\"\n    Estimate p (slope) and C (exp(intercept)) from linear regression of log(err) vs log(dx).\n    \"\"\"\n    x = np.log(np.array(dx_vals))\n    y = np.log(np.array(err_vals))\n    # Fit y = a + p * x\n    p, a = np.polyfit(x, y, 1)\n    C = np.exp(a)\n    return p, C\n\n\ndef solve():\n    # Test suite Courant numbers\n    s_values = [0.2, 0.5, 0.8, 0.95, 0.99]\n    # Spatial resolutions\n    Nx_values = [50, 100, 200, 400]\n    dx_values = [1.0 / Nx for Nx in Nx_values]\n\n    # Compute errors for each s over all resolutions\n    p_list = []\n    C_list = []\n    for s in s_values:\n        errs = []\n        for Nx in Nx_values:\n            err = yee_1d_error(Nx, s, T=1.0)\n            errs.append(err)\n        p, C = estimate_order_and_constant(dx_values, errs)\n        p_list.append(p)\n        C_list.append(C)\n\n    # Reference Courant number s_ref = 0.2 is the first entry\n    C_ref = C_list[0]\n\n    # Prepare results: [p(s), Gamma(s)] rounded to six decimals\n    results = []\n    for p, C in zip(p_list, C_list):\n        gamma = C / C_ref\n        results.append([round(p, 6), round(gamma, 6)])\n\n    # Print in the exact required format\n    # A single line: list of [p, Gamma] pairs\n    print(\"[\" + \",\".join(f\"[{pair[0]},{pair[1]}]\" for pair in results) + \"]\")\n\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3358130"}]}