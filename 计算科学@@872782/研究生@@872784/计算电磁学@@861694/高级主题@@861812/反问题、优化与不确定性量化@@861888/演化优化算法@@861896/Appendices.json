{"hands_on_practices": [{"introduction": "在计算电磁学中，诸如时域有限差分 ($FDTD$) 之类的模拟通常计算成本极高。由于进化算法 (EA) 需要进行大量设计评估，避免对相同设计进行重复计算对于提高效率至关重要。本练习 [@problem_id:3306062] 将指导您从第一性原理出发，推导并量化一个缓存机制所带来的预期时间节省，这对于处理计算密集型优化任务是一项基本技能。", "problem": "在计算电磁学中，使用遗传算法 (GA) 对超表面散射体进行优化，其中每个候选设计（基因型）都通过时域有限差分 (FDTD) 求解器进行评估。对于固定的仿真设置，电磁响应是确定性的，因此对由基因型及其仿真设置组成的相同配对重复进行评估，会产生相同的适应度。为避免重复的 FDTD 求解，提出了一种缓存机制：将由基因型和仿真设置组成的元组的加密哈希值作为键。设哈希键定义为 $H(g,s)$，其中 $g$ 是基因型，$s$ 是仿真设置的向量（例如，频率、网格分辨率、边界条件）。假设哈希碰撞概率可忽略不计，查找时间为 $\\mathcal{O}(1)$，并且在所考虑的整个代中，仿真设置 $s$ 保持不变。缓存初始包含来自上一代的 $N$ 个唯一 个体，每个个体都存储在其键下。\n\n在一代中，GA 产生 $N$ 个后代，其中比例为 $f_{c}$ 的后代由交叉生成，剩余比例 $1 - f_{c}$ 的后代由变异生成。由于表示冗余（例如，对称性和中性编码），交叉操作经常会在相同的设置下再现已经在前几代中出现过的基因型。用以下概率对此进行建模：在交叉后代中，后代具有与缓存中已存在的相同设置下的某个基因型相等的概率为 $p_{c}$；在变异后代中，相应的概率为 $p_{m}$。\n\n对每个唯一键的 FDTD 评估会产生评估时间 $t_{e}$，而缓存机制会增加开销：计算哈希的成本为 $t_{h}$，缓存查找的成本为 $t_{\\ell}$，检索缓存适应度的成本为 $t_{r}$。对于唯一键，将新结果存入缓存的成本为 $t_{s}$。不使用缓存的基线是每代执行 $N$ 次 FDTD 评估。\n\n仅使用上述建模假设，从第一性原理推导与未缓存的基线相比，缓存机制每代所节省的预期净时间。然后，使用以下参数值对此预期净节省时间进行数值计算：\n- 每代后代数量 $N = 250$。\n- 交叉比例 $f_{c} = 0.85$。\n- 交叉后代中的重复概率 $p_{c} = 0.42$。\n- 变异后代中的重复概率 $p_{m} = 0.07$。\n- FDTD 评估时间 $t_{e} = 18.5$ s。\n- 哈希计算时间 $t_{h} = 8.0 \\times 10^{-4}$ s。\n- 查找时间 $t_{\\ell} = 5.0 \\times 10^{-4}$ s。\n- 检索时间 $t_{r} = 3.0 \\times 10^{-4}$ s。\n- 存储时间 $t_{s} = 6.0 \\times 10^{-4}$ s。\n\n将最终的每代预期净节省时间以秒表示，并将您的答案四舍五入到 $4$ 位有效数字。", "solution": "用户希望通过在遗传算法中实现缓存机制来找到每代节省的预期净时间。解决方案将从第一性原理推导，然后进行数值计算。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n-   每代后代数量：$N = 250$\n-   交叉比例：$f_{c} = 0.85$\n-   剩余比例（变异）：$1 - f_{c}$\n-   交叉后代中的重复概率：$p_{c} = 0.42$\n-   变异后代中的重复概率：$p_{m} = 0.07$\n-   FDTD 评估时间：$t_{e} = 18.5$ s\n-   哈希计算时间：$t_{h} = 8.0 \\times 10^{-4}$ s\n-   缓存查找时间：$t_{\\ell} = 5.0 \\times 10^{-4}$ s\n-   缓存适应度检索时间：$t_{r} = 3.0 \\times 10^{-4}$ s\n-   新结果存储时间：$t_{s} = 6.0 \\times 10^{-4}$ s\n-   基线：每代进行 $N$ 次 FDTD 评估，每次时间为 $t_{e}$。\n-   假设：哈希碰撞概率可忽略不计，查找时间为 $\\mathcal{O}(1)$，仿真设置 $s$ 恒定。\n\n**1.2. 使用提取的已知条件进行验证**\n-   **科学依据**：该问题设置在计算工程（计算电磁学）和计算机科学（演化算法、性能分析）的背景下。使用缓存来避免冗余计算是一种标准且有效的技术。该模型是概率性能分析，这是一种成熟的数学方法。所有方面都具有科学合理性。\n-   **良态性**：问题提供了所有必要的参数和明确的目标：推导公式并计算数值。该设置允许一个唯一、稳定且有意义的解。\n-   **客观性**：语言精确、量化，没有主观性。术语在模型上下文中被明确定义。\n-   **完整性和一致性**：问题是自洽的。推导所需的所有变量都已定义，并且单位一致（秒）。没有矛盾之处。\n-   **真实性**：所提供的时间值是现实的。FDTD 仿真计算成本高昂（秒到分钟或小时），而哈希和内存操作非常快（微秒到毫秒）。概率也在合理范围内。\n\n**1.3. 结论与行动**\n该问题是有效的。它具有科学依据、定义明确、客观、完整且一致。我将继续提供完整的解决方案。\n\n### 步骤 2：解的推导\n\n目标是找到每代节省的预期净时间 $\\Delta T$。这是不使用缓存的总时间 $T_{uncached}$ 与使用缓存的预期总时间 $E[T_{cached}]$ 之间的差值。\n$$\n\\Delta T = T_{uncached} - E[T_{cached}]\n$$\n不使用缓存的基线过程执行 $N$ 次评估，所以总时间为：\n$$\nT_{uncached} = N t_{e}\n$$\n为了找到使用缓存的预期时间，我们可以确定单个后代的预期时间成本，然后乘以 $N$，因为所有后代的过程都是相同的。设 $E[\\Delta T_{indiv}]$ 为单个后代节省的预期时间。那么总的预期节省时间为 $\\Delta T = N \\cdot E[\\Delta T_{indiv}]$。\n\n一个后代的预期节省时间是各种可能情况下的节省时间与其概率的加权和。对于一个后代，有两种情况：其基因型已在缓存中（“命中”），或者不在（“未命中”）。\n\n首先，让我们确定缓存命中的总概率 $P_{hit}$。后代要么通过交叉（概率为 $f_c$）生成，要么通过变异（概率为 $1-f_c$）生成。\n根据全概率定律，命中概率为：\n$$\nP_{hit} = P(\\text{命中}|\\text{交叉})P(\\text{交叉}) + P(\\text{命中}|\\text{变异})P(\\text{变异})\n$$\n使用问题中的定义，$P(\\text{命中}|\\text{交叉}) = p_{c}$ 且 $P(\\text{命中}|\\text{变异}) = p_{m}$。\n因此，任何给定后代的总体缓存命中概率为：\n$$\nP_{hit} = p_{c} f_{c} + p_{m} (1 - f_{c})\n$$\n缓存未命中的概率为 $P_{miss} = 1 - P_{hit}$。\n\n现在，我们分析每种情况下节省的时间：\n1.  **缓存命中**：以概率 $P_{hit}$ 发生。\n    -   不使用缓存，时间成本为 $t_{e}$。\n    -   使用缓存，过程是：计算哈希（$t_{h}$），查找键（$t_{\\ell}$），并检索存储的结果（$t_{r}$）。总成本为 $t_{h} + t_{\\ell} + t_{r}$。\n    -   在这种情况下节省的时间是 $\\Delta T_{hit} = t_{e} - (t_{h} + t_{\\ell} + t_{r})$。\n\n2.  **缓存未命中**：以概率 $P_{miss} = 1 - P_{hit}$ 发生。\n    -   不使用缓存，时间成本为 $t_{e}$。\n    -   使用缓存，过程是：计算哈希（$t_{h}$），查找键（$t_{\\ell}$），执行 FDTD 评估（$t_{e}$），并存储新结果（$t_{s}$）。总成本为 $t_{h} + t_{\\ell} + t_{e} + t_{s}$。\n    -   在这种情况下节省的时间是 $\\Delta T_{miss} = t_{e} - (t_{h} + t_{\\ell} + t_{e} + t_{s}) = -(t_{h} + t_{\\ell} + t_{s})$。这代表了由于缓存开销而产生的净成本（负节省）。\n\n每个后代的预期节省时间 $E[\\Delta T_{indiv}]$ 是这两种情况下节省时间的加权平均值：\n$$\nE[\\Delta T_{indiv}] = P_{hit} \\cdot \\Delta T_{hit} + (1 - P_{hit}) \\cdot \\Delta T_{miss}\n$$\n$$\nE[\\Delta T_{indiv}] = P_{hit}(t_{e} - t_{h} - t_{\\ell} - t_{r}) + (1 - P_{hit})(-t_{h} - t_{\\ell} - t_{s})\n$$\n展开表达式：\n$$\nE[\\Delta T_{indiv}] = P_{hit} t_{e} - P_{hit}(t_{h} + t_{\\ell} + t_{r}) - (t_{h} + t_{\\ell} + t_{s}) + P_{hit}(t_{h} + t_{\\ell} + t_{s})\n$$\n$$\nE[\\Delta T_{indiv}] = P_{hit} t_{e} - P_{hit} t_{h} - P_{hit} t_{\\ell} - P_{hit} t_{r} - t_{h} - t_{\\ell} - t_{s} + P_{hit} t_{h} + P_{hit} t_{\\ell} + P_{hit} t_{s}\n$$\n消去并重新整理项：\n$$\nE[\\Delta T_{indiv}] = P_{hit}(t_{e} + t_{s} - t_{r}) - (t_{h} + t_{\\ell} + t_{s})\n$$\n每代总的预期净节省时间是这个值的 $N$ 倍：\n$$\n\\Delta T = N \\left[ P_{hit}(t_{e} + t_{s} - t_{r}) - (t_{h} + t_{\\ell} + t_{s}) \\right]\n$$\n代入 $P_{hit}$ 的表达式：\n$$\n\\Delta T = N \\left[ (p_{c} f_{c} + p_{m} (1 - f_{c}))(t_{e} + t_{s} - t_{r}) - (t_{h} + t_{\\ell} + t_{s}) \\right]\n$$\n\n### 步骤 3：数值计算\n\n现在我们将给定的数值代入推导出的公式中。\n-   $N = 250$\n-   $f_{c} = 0.85$\n-   $p_{c} = 0.42$\n-   $p_{m} = 0.07$\n-   $t_{e} = 18.5$ s\n-   $t_{h} = 8.0 \\times 10^{-4}$ s $= 0.0008$ s\n-   $t_{\\ell} = 5.0 \\times 10^{-4}$ s $= 0.0005$ s\n-   $t_{r} = 3.0 \\times 10^{-4}$ s $= 0.0003$ s\n-   $t_{s} = 6.0 \\times 10^{-4}$ s $= 0.0006$ s\n\n首先，计算总体命中概率 $P_{hit}$：\n$$\nP_{hit} = (0.85)(0.42) + (1 - 0.85)(0.07) = 0.357 + (0.15)(0.07) = 0.357 + 0.0105 = 0.3675\n$$\n接下来，计算 $\\Delta T$ 公式括号内的两个主要项。\n与节省相关的项：\n$$\nt_{e} + t_{s} - t_{r} = 18.5 + 0.0006 - 0.0003 = 18.5003 \\text{ s}\n$$\n与开销相关的项：\n$$\nt_{h} + t_{\\ell} + t_{s} = 0.0008 + 0.0005 + 0.0006 = 0.0019 \\text{ s}\n$$\n现在，将这些代入 $\\Delta T$ 的表达式中：\n$$\n\\Delta T = 250 \\left[ (0.3675)(18.5003) - 0.0019 \\right]\n$$\n$$\n\\Delta T = 250 \\left[ 6.79886025 - 0.0019 \\right]\n$$\n$$\n\\Delta T = 250 \\left[ 6.79696025 \\right]\n$$\n$$\n\\Delta T = 1699.2400625 \\text{ s}\n$$\n问题要求答案四舍五入到 $4$ 位有效数字。这个数字是 $1699.2400625$。前四位有效数字是 $1$、$6$、$9$ 和 $9$。第五位数字是 $2$，小于 $5$，所以我们向下取整（截断）。\n$$\n\\Delta T \\approx 1699 \\text{ s}\n$$", "answer": "$$\n\\boxed{1699}\n$$", "id": "3306062"}, {"introduction": "除了计算效率，确保进化算法产生的解在物理上有效也同样重要。这意味着设计必须遵守像互易性这样的基本物理定律。本练习 [@problem_id:3306120] 深入探讨了如何将这一物理约束直接整合到优化算法中，您将为散射矩阵 ($\\mathbf{S}$ 矩阵) 定义一个可行性规则，并实现一个“修复”算子来强制执行其对称性 ($\\mathbf{S} = \\mathbf{S}^{\\top}$)，从而确保设计的物理真实性。", "problem": "考虑一个由麦克斯韦方程组所描述的线性、时不变、各向同性、无源的电磁介质。对于一个由角频率为$\\omega$（单位为弧度/秒）的时谐源激励的多端口结构，定义入射波振幅矢量$\\mathbf{a}(\\omega)$和散射（出射）波振幅矢量$\\mathbf{b}(\\omega)$。散射矩阵$\\mathbf{S}(\\omega; x)$是一个线性算子，通过$\\mathbf{b}(\\omega) = \\mathbf{S}(\\omega; x)\\,\\mathbf{a}(\\omega)$关联这些量，其中$x$表示结构的设计参数（例如，几何特征或材料属性分布）。\n\n从洛伦兹互易定理推导出的一个基本结果，应用于具有对称介电常数和磁导率张量的线性时不变各向同性介质的麦克斯韦方程组，表明对于互易系统，其散射矩阵必须是对称的，即对所有$\\omega$都满足$\\mathbf{S}(\\omega; x) = \\mathbf{S}^{\\top}(\\omega; x)$。\n\n你的任务是为演化优化算法制定一个用于强制实现互易性的可行性规则。该可行性规则必须在一组有限的采样角频率上评估候选设计$x$，并且仅当模拟出的散射矩阵在指定的数值容差范围内满足互易性约束时，才声明该设计是可行的。此外，你必须实现一个修复算子，该算子对给定的（可能不可行的）$\\mathbf{S}(\\omega; x)$进行最小化修改，以生成一个对称矩阵，从而在不过度改变底层设计的情况下恢复其可行性。\n\n你的解决方案必须满足以下要求：\n\n- 从麦克斯韦方程组和洛伦兹互易定理出发，逻辑上论证为什么互易性要求$\\mathbf{S}(\\omega; x) = \\mathbf{S}^{\\top}(\\omega; x)$。\n- 使用弗罗贝尼乌斯范数定义一个互易性违背度量，并基于第一性原理构建一个可行性规则和一个修复算子。可行性规则必须使用一个容差参数$\\tau$。\n- 修复算子必须是对称投影$\\mathbf{R}(\\mathbf{S}) = \\tfrac{1}{2}\\left(\\mathbf{S} + \\mathbf{S}^{\\top}\\right)$，并且你必须从数学优化的角度论证，在所有对称矩阵中，它对$\\mathbf{S}$的弗罗贝尼乌斯范数扰动最小。\n- 实现一个程序，对于下方的每个测试用例，计算以下四个量：\n  1. 修复前的最大互易性违背度，定义为$v_{\\text{before}} = \\max_{\\omega \\in \\Omega} \\left\\|\\mathbf{S}(\\omega; x) - \\mathbf{S}^{\\top}(\\omega; x)\\right\\|_{F}$。\n  2. 修复后的最大互易性违背度，定义为$v_{\\text{after}} = \\max_{\\omega \\in \\Omega} \\left\\|\\mathbf{R}(\\mathbf{S}(\\omega; x)) - \\mathbf{R}(\\mathbf{S}(\\omega; x))^{\\top}\\right\\|_{F}$。\n  3. 修复后的可行性，定义为布尔值$b_{\\text{feasible}} = \\left[v_{\\text{after}} \\le \\tau\\right]$。\n  4. 修复引入的最大扰动，定义为$d_{\\text{max}} = \\max_{\\omega \\in \\Omega} \\left\\|\\mathbf{R}(\\mathbf{S}(\\omega; x)) - \\mathbf{S}(\\omega; x)\\right\\|_{F}$。\n- 使用数值容差$\\tau = 10^{-8}$。\n- 角频率以弧度/秒表示；输出为无量纲的实数和布尔值。不得使用百分比单位。\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个测试用例的结果表示为$[v_{\\text{before}}, v_{\\text{after}}, b_{\\text{feasible}}, d_{\\text{max}}]$形式的列表。\n\n测试套件：\n对于每个测试用例，$\\Omega$包含两个角频率，$\\mathbf{S}(\\omega; x)$是一个如下指定的$3\\times 3$复数矩阵。\n\n- 测试用例A（在采样频率上已满足互易性）：\n  频率：$\\Omega = \\{2\\pi \\cdot 10^{9},\\, 2\\pi \\cdot 2 \\cdot 10^{9}\\}$。\n  矩阵：\n  $$\n  \\mathbf{S}(2\\pi \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.10  0.02  0.03\\\\\n  0.02  0.20  0.01\\\\\n  0.03  0.01  0.15\n  \\end{bmatrix}\n  $$\n  $$\n  \\mathbf{S}(2\\pi \\cdot 2 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.08 + 0.02\\,\\mathrm{i}  0.01 - 0.005\\,\\mathrm{i}  0.00 + 0.01\\,\\mathrm{i}\\\\\n  0.01 - 0.005\\,\\mathrm{i}  0.12 + 0.00\\,\\mathrm{i}  0.02 + 0.003\\,\\mathrm{i}\\\\\n  0.00 + 0.01\\,\\mathrm{i}  0.02 + 0.003\\,\\mathrm{i}  0.09 - 0.01\\,\\mathrm{i}\n  \\end{bmatrix}\n  $$\n\n- 测试用例B（由于小噪声导致轻微不对称）：\n  频率：$\\Omega = \\{2\\pi \\cdot 1.2 \\cdot 10^{9},\\, 2\\pi \\cdot 1.8 \\cdot 10^{9}\\}$。\n  矩阵：\n  $$\n  \\mathbf{S}(2\\pi \\cdot 1.2 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.20  0.05 + 0.001  0.00 - 0.002\\\\\n  0.05 - 0.001  0.15  0.01 + 0.0005\\\\\n  0.00 + 0.002  0.01 - 0.0005  0.10\n  \\end{bmatrix}\n  $$\n  $$\n  \\mathbf{S}(2\\pi \\cdot 1.8 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.18 + 0.01\\,\\mathrm{i}  0.02 + 0.00\\,\\mathrm{i} + 0.001 + 0.0005\\,\\mathrm{i}  0.03 - 0.01\\,\\mathrm{i} - 0.001 - 0.0003\\,\\mathrm{i}\\\\\n  0.02 + 0.00\\,\\mathrm{i} - 0.001 - 0.0005\\,\\mathrm{i}  0.16 - 0.005\\,\\mathrm{i}  0.04 + 0.002\\,\\mathrm{i} + 0.0004 - 0.0002\\,\\mathrm{i}\\\\\n  0.03 - 0.01\\,\\mathrm{i} + 0.001 + 0.0003\\,\\mathrm{i}  0.04 + 0.002\\,\\mathrm{i} - 0.0004 + 0.0002\\,\\mathrm{i}  0.11 + 0.00\\,\\mathrm{i}\n  \\end{bmatrix}\n  $$\n\n- 测试用例C（强不对称）：\n  频率：$\\Omega = \\{2\\pi \\cdot 0.8 \\cdot 10^{9},\\, 2\\pi \\cdot 1.6 \\cdot 10^{9}\\}$。\n  矩阵：\n  $$\n  \\mathbf{S}(2\\pi \\cdot 0.8 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.30 + 0.00\\,\\mathrm{i}  0.10 + 0.05\\,\\mathrm{i}  -0.20 + 0.10\\,\\mathrm{i}\\\\\n  0.05 - 0.10\\,\\mathrm{i}  -0.10 + 0.00\\,\\mathrm{i}  0.25 + 0.00\\,\\mathrm{i}\\\\\n  0.15 - 0.05\\,\\mathrm{i}  0.40 + 0.20\\,\\mathrm{i}  0.05 + 0.30\\,\\mathrm{i}\n  \\end{bmatrix}\n  $$\n  $$\n  \\mathbf{S}(2\\pi \\cdot 1.6 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.25 - 0.05\\,\\mathrm{i}  -0.35 + 0.10\\,\\mathrm{i}  0.20 + 0.00\\,\\mathrm{i}\\\\\n  0.20 - 0.15\\,\\mathrm{i}  0.30 + 0.05\\,\\mathrm{i}  -0.10 + 0.25\\,\\mathrm{i}\\\\\n  0.05 + 0.20\\,\\mathrm{i}  0.12 - 0.30\\,\\mathrm{i}  -0.20 + 0.10\\,\\mathrm{i}\n  \\end{bmatrix}\n  $$\n\n- 测试用例D（边界情况：零散射）：\n  频率：$\\Omega = \\{2\\pi \\cdot 10^{9},\\, 2\\pi \\cdot 1.5 \\cdot 10^{9}\\}$。\n  矩阵：\n  $$\n  \\mathbf{S}(2\\pi \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0  0  0\\\\\n  0  0  0\\\\\n  0  0  0\n  \\end{bmatrix}\n  \\quad,\\quad\n  \\mathbf{S}(2\\pi \\cdot 1.5 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0  0  0\\\\\n  0  0  0\\\\\n  0  0  0\n  \\end{bmatrix}\n  $$\n\n- 测试用例E（频率相关且具有中等不对称性）：\n  频率：$\\Omega = \\{2\\pi \\cdot 1.1 \\cdot 10^{9},\\, 2\\pi \\cdot 1.7 \\cdot 10^{9}\\}$。\n  矩阵：\n  $$\n  \\mathbf{S}(2\\pi \\cdot 1.1 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.12  0.03 + 0.005  0.025 - 0.004\\\\\n  0.03 - 0.005  0.18  0.02 + 0.003\\\\\n  0.025 + 0.004  0.02 - 0.003  0.14\n  \\end{bmatrix}\n  $$\n  $$\n  \\mathbf{S}(2\\pi \\cdot 1.7 \\cdot 10^{9}; x) =\n  \\begin{bmatrix}\n  0.10 + 0.02\\,\\mathrm{i}  0.04 - 0.01\\,\\mathrm{i} - 0.01 + 0.005\\,\\mathrm{i}  0.00 + 0.03\\,\\mathrm{i} + 0.006 - 0.004\\,\\mathrm{i}\\\\\n  0.04 - 0.01\\,\\mathrm{i} + 0.01 - 0.005\\,\\mathrm{i}  0.20 + 0.00\\,\\mathrm{i}  0.01 + 0.02\\,\\mathrm{i} - 0.005 + 0.002\\,\\mathrm{i}\\\\\n  0.00 + 0.03\\,\\mathrm{i} - 0.006 + 0.004\\,\\mathrm{i}  0.01 + 0.02\\,\\mathrm{i} + 0.005 - 0.002\\,\\mathrm{i}  0.13 - 0.01\\,\\mathrm{i}\n  \\end{bmatrix}\n  $$\n\n实现细节与输出规范：\n- 使用$\\tau = 10^{-8}$。\n- 精确按照上述定义为每个测试用例计算$v_{\\text{before}}$、$v_{\\text{after}}$、$b_{\\text{feasible}}$和$d_{\\text{max}}$。\n- 你的程序应生成单行输出，包含一个逗号分隔的五个测试用例结果的列表，每个结果表示为$[v_{\\text{before}}, v_{\\text{after}}, b_{\\text{feasible}}, d_{\\text{max}}]$形式的列表，用方括号括起来，例如：\n  $$\n  [\\,[v_{\\text{before}}^{(A)}, v_{\\text{after}}^{(A)}, b_{\\text{feasible}}^{(A)}, d_{\\text{max}}^{(A)}],\\,\\ldots,\\, [v_{\\text{before}}^{(E)}, v_{\\text{after}}^{(E)}, b_{\\text{feasible}}^{(E)}, d_{\\text{max}}^{(E)}]\\,]\n  $$\n程序无需用户输入；所有数据必须嵌入在程序中。", "solution": "该问题要求为应用于计算电磁学的演化优化算法，制定并实现一个互易性约束。这涉及推导该约束的理论基础，定义其违背度的量化度量，并构建一个修复算子，该算子能强制执行该约束，同时对原始系统产生最小的扰动。\n\n### 1. 基于洛伦兹互易性的S矩阵对称性理论论证\n\n对于一个互易多端口网络，其散射矩阵的对称性，即$\\mathbf{S} = \\mathbf{S}^{\\top}$，是洛伦兹互易定理的直接推论。推导始于角频率为$\\omega$的时谐电磁场的麦克斯韦方程组，其相量表示为$(\\vec{E}, \\vec{H})$。\n\n在一个由线性、时不变、各向同性介质占据的无源体积$V$中，麦克斯韦旋度方程为：\n$$ \\nabla \\times \\vec{E} = -j\\omega\\mu\\vec{H} $$\n$$ \\nabla \\times \\vec{H} = j\\omega\\epsilon\\vec{E} $$\n材料属性由介电常数$\\epsilon$和磁导率$\\mu$描述。对于各向同性介质，它们是标量。更一般地，对于互易介质，它们是对称张量，即$\\epsilon = \\epsilon^{\\top}$和$\\mu = \\mu^{\\top}$。\n\n考虑两组独立的源在相同频率$\\omega$下产生两组不同的场，$(\\vec{E}_1, \\vec{H}_1)$和$(\\vec{E}_2, \\vec{H}_2)$。根据矢量恒等式，我们有：\n$$ \\nabla \\cdot (\\vec{E}_1 \\times \\vec{H}_2) = \\vec{H}_2 \\cdot (\\nabla \\times \\vec{E}_1) - \\vec{E}_1 \\cdot (\\nabla \\times \\vec{H}_2) = -j\\omega\\mu (\\vec{H}_1 \\cdot \\vec{H}_2) - j\\omega\\epsilon (\\vec{E}_1 \\cdot \\vec{E}_2) $$\n$$ \\nabla \\cdot (\\vec{E}_2 \\times \\vec{H}_1) = \\vec{H}_1 \\cdot (\\nabla \\times \\vec{E}_2) - \\vec{E}_2 \\cdot (\\nabla \\times \\vec{H}_1) = -j\\omega\\mu (\\vec{H}_2 \\cdot \\vec{H}_1) - j\\omega\\epsilon (\\vec{E}_2 \\cdot \\vec{E}_1) $$\n将这两个方程相减得到$\\nabla \\cdot (\\vec{E}_1 \\times \\vec{H}_2 - \\vec{E}_2 \\times \\vec{H}_1) = 0$。在体积$V$上应用散度定理，得到洛伦兹互易定理的积分形式：\n$$ \\oint_{\\partial V} (\\vec{E}_1 \\times \\vec{H}_2 - \\vec{E}_2 \\times \\vec{H}_1) \\cdot d\\vec{A} = 0 $$\n其中$\\partial V$是$V$的边界面。\n\n对于一个多端口器件，该表面$\\partial V$由端口孔径以及封闭的金属或辐射边界组成。假设是理想导体或场在无穷远处消失，该积分仅在端口上非零。每个端口$k$处的场可以分解为导波模式的叠加。对于单模端口，场是振幅为$a_k$的入射波和振幅为$b_k$的散射波的组合。端口$k$处的总切向场与这些振幅以及端口的归一化模式场$(\\vec{e}_k, \\vec{h}_k)$有关。面积分简化为对所有$N$个端口的求和：\n$$ \\sum_{k=1}^{N} \\int_{A_k} (\\vec{E}_{1,t} \\times \\vec{H}_{2,t} - \\vec{E}_{2,t} \\times \\vec{H}_{1,t}) \\cdot d\\vec{A}_k = 0 $$\n通过对模式场进行适当的归一化，这个代数和变成了两种状态下入射和散射波振幅之间的关系：\n$$ \\sum_{k=1}^{N} (a_{1k} b_{2k} - a_{2k} b_{1k}) = 0 $$\n用矢量形式表示，即$\\mathbf{a}_1^{\\top} \\mathbf{b}_2 - \\mathbf{a}_2^{\\top} \\mathbf{b}_1 = 0$。使用散射矩阵的定义$\\mathbf{b} = \\mathbf{S}\\mathbf{a}$，我们可以代入$\\mathbf{b}_1 = \\mathbf{S}\\mathbf{a}_1$和$\\mathbf{b}_2 = \\mathbf{S}\\mathbf{a}_2$：\n$$ \\mathbf{a}_1^{\\top} (\\mathbf{S}\\mathbf{a}_2) - \\mathbf{a}_2^{\\top} (\\mathbf{S}\\mathbf{a}_1) = 0 $$\n由于$(\\mathbf{X}\\mathbf{Y})^\\top = \\mathbf{Y}^\\top\\mathbf{X}^\\top$且标量是其自身的转置，我们可以写出$\\mathbf{a}_2^{\\top}\\mathbf{S}\\mathbf{a}_1 = (\\mathbf{a}_1^\\top \\mathbf{S}^\\top \\mathbf{a}_2)$。方程变为：\n$$ \\mathbf{a}_1^{\\top} \\mathbf{S} \\mathbf{a}_2 - \\mathbf{a}_1^{\\top} \\mathbf{S}^{\\top} \\mathbf{a}_2 = \\mathbf{a}_1^{\\top} (\\mathbf{S} - \\mathbf{S}^{\\top}) \\mathbf{a}_2 = 0 $$\n这个关系必须对任意选择的激励矢量$\\mathbf{a}_1$和$\\mathbf{a}_2$都成立。这只有在中间的矩阵是零矩阵时才可能，即$\\mathbf{S} - \\mathbf{S}^{\\top} = \\mathbf{0}$，这意味着$\\mathbf{S} = \\mathbf{S}^{\\top}$。这证明了互易性要求散射矩阵是对称的。\n\n### 2. 可行性规则与互易性违背度量\n\n在计算电磁学中，模拟中的数值误差可能导致散射矩阵$\\mathbf{S}$不是完全对称的，即使所建模的物理系统是互易的。对于一个优化算法，我们需要一个规则来判断一个候选设计在互易性约束方面是否“可行”。\n\n量化违背度的一个自然方法是测量矩阵的斜对称分量$\\mathbf{S} - \\mathbf{S}^{\\top}$的“大小”。我们为此使用弗罗贝尼乌斯范数。一个复数矩阵$\\mathbf{A} \\in \\mathbb{C}^{m \\times n}$的弗罗贝尼乌斯范数定义为：\n$$ \\|\\mathbf{A}\\|_F = \\sqrt{\\sum_{i=1}^{m}\\sum_{j=1}^{n} |A_{ij}|^2} $$\n对于给定的散射矩阵$\\mathbf{S}(\\omega; x)$，其互易性违背度量定义为：\n$$ v(\\mathbf{S}) = \\|\\mathbf{S}(\\omega; x) - \\mathbf{S}^{\\top}(\\omega; x)\\|_F $$\n对于在一组频率$\\Omega$上评估的优化问题，可行性规则是使用一个数值容差$\\tau  0$构建的。如果一个设计$x$在所有采样频率上的最大违背度都在此容差范围内，则声明该设计是可行的：\n$$ \\text{设计 } x \\text{ 是可行的，如果 } \\max_{\\omega \\in \\Omega} v(\\mathbf{S}(\\omega; x)) \\le \\tau $$\n\n### 3. 修复算子及其最优性\n\n当一个候选设计被发现是不可行的（即其$\\mathbf{S}$矩阵不够对称）时，可以使用一个修复算子将其投影回可行集。建议的算子是对称投影：\n$$ \\mathbf{R}(\\mathbf{S}) = \\frac{1}{2}(\\mathbf{S} + \\mathbf{S}^{\\top}) $$\n该算子生成一个对称矩阵，因为$(\\mathbf{R}(\\mathbf{S}))^{\\top} = \\frac{1}{2}(\\mathbf{S}^{\\top} + (\\mathbf{S}^{\\top})^{\\top}) = \\frac{1}{2}(\\mathbf{S}^{\\top} + \\mathbf{S}) = \\mathbf{R}(\\mathbf{S})$。\n\n我们必须论证这个算子对$\\mathbf{S}$的扰动是最小的，这在数学上意味着$\\mathbf{R}(\\mathbf{S})$是以下优化问题的解：\n$$ \\min_{\\mathbf{X}} \\|\\mathbf{S} - \\mathbf{X}\\|_F \\quad \\text{约束条件为} \\quad \\mathbf{X} = \\mathbf{X}^{\\top} $$\n我们寻求在弗罗贝尼乌斯范数意义下最接近$\\mathbf{S}$的对称矩阵$\\mathbf{X}$。让我们最小化范数的平方，$f(\\mathbf{X}) = \\|\\mathbf{S} - \\mathbf{X}\\|_F^2$：\n$$ f(\\mathbf{X}) = \\sum_{i,j} |S_{ij} - X_{ij}|^2 $$\n我们可以通过对$\\mathbf{X}$的独立元素求导并将其设为零来最小化这个函数。由于$\\mathbf{X}$是对称的（$X_{ij} = X_{ji}$），独立变量是所有$i$的$X_{ii}$，以及$i  j$的$X_{ij}$。\n\n目标函数可以写成：\n$$ f(\\mathbf{X}) = \\sum_{i} |S_{ii} - X_{ii}|^2 + \\sum_{i  j} (|S_{ij} - X_{ij}|^2 + |S_{ji} - X_{ji}|^2) $$\n因为$X_{ij} = X_{ji}$，这简化为：\n$$ f(\\mathbf{X}) = \\sum_{i} |S_{ii} - X_{ii}|^2 + \\sum_{i  j} (|S_{ij} - X_{ij}|^2 + |S_{ji} - X_{ij}|^2) $$\n分别最小化每一项：\n对于对角线元素（$i=j$）：当$X_{ii} = S_{ii}$时，项$|S_{ii} - X_{ii}|^2$最小化。\n对于非对角线元素（$i \\neq j$）：考虑$i  j$时，$(i, j)$和$(j, i)$的一对项。令$g(X_{ij}) = |S_{ij} - X_{ij}|^2 + |S_{ji} - X_{ij}|^2$。设$X_{ij} = u + iv$，$S_{ij} = a+ib$，$S_{ji} = c+id$。\n$$ g(u, v) = (a-u)^2 + (b-v)^2 + (c-u)^2 + (d-v)^2 $$\n求偏导数并设为零：\n$$ \\frac{\\partial g}{\\partial u} = -2(a-u) - 2(c-u) = 0 \\implies 4u = 2(a+c) \\implies u = \\frac{a+c}{2} $$\n$$ \\frac{\\partial g}{\\partial v} = -2(b-v) - 2(d-v) = 0 \\implies 4v = 2(b+d) \\implies v = \\frac{b+d}{2} $$\n因此，最优的$X_{ij}$是$u+iv = \\frac{a+c}{2} + i\\frac{b+d}{2} = \\frac{1}{2}((a+ib) + (c+id)) = \\frac{1}{2}(S_{ij} + S_{ji})$。\n结合对角线和非对角线元素的结果，最优对称矩阵$\\mathbf{X}$的元素为$X_{ij} = \\frac{1}{2}(S_{ij} + S_{ji})$。这正是矩阵$\\mathbf{R}(\\mathbf{S}) = \\frac{1}{2}(\\mathbf{S} + \\mathbf{S}^{\\top})$。\n因此，$\\mathbf{R}(\\mathbf{S})$是在弗罗贝尼乌斯范数下最接近$\\mathbf{S}$的唯一对称矩阵，这证明了它作为最小扰动修复算子的合理性。", "answer": "[[0.0,0.0,True,0.0],[0.004652956050012229,0.0,True,0.0023264780250061144],[0.6557438524302,0.0,True,0.3278719262151],[0.0,0.0,True,0.0],[0.02701851217229584,0.0,True,0.01350925608614792]]", "id": "3306120"}]}