{"hands_on_practices": [{"introduction": "超表面的核心能力之一是精确调控电磁波的传播，例如实现光束偏转。本练习将引导你建立超表面的基本物理参数（即表面磁化率张量 $\\boldsymbol{\\chi}$）与宏观器件性能（即透射角 $\\theta_{t}$）之间的直接联系。更进一步，本练习要求你分析器件性能对制造误差的敏感度，这在实际工程设计中至关重要。通过这个实践 [@problem_id:3311086]，你将深刻理解广义薄层渡越条件（GSTCs）如何作为连接微观结构参数与宏观功能的桥梁。", "problem": "考虑一个单各向异性、空间变化的惠更斯超表面，其位于自由空间中的 $z=0$ 平面，设计旨在偏转一束垂直入射的横电磁平面波。该超表面由切向电极化率张量 $\\boldsymbol{\\chi}_{ee}(x)$ 和磁化率张量 $\\boldsymbol{\\chi}_{mm}(x)$ 表征，且无磁电耦合。入射波沿 $+\\hat{z}$ 方向传播，其电场沿 $\\hat{x}$ 方向极化，磁场沿 $\\hat{y}$ 方向极化。假设时谐场遵循 $\\exp(j \\omega t)$ 约定，自由空间波数为 $k_{0} = \\omega \\sqrt{\\mu_{0} \\varepsilon_{0}}$，自由空间阻抗为 $\\eta_{0} = \\sqrt{\\mu_{0}/\\varepsilon_{0}}$。\n\n从麦克斯韦方程组和广义片层过渡条件（GSTCs）出发，推导空间均匀片层的透射系数。然后，在标准的慢变近似（局部均匀超表面）下使用该局部均匀片层结果，并援引带有相位不连续性的切向波矢守恒，得到联系局部透射相位梯度与透射角 $\\theta_{t}$ 的广义折射关系。假设通过与入射场对齐的切向响应的局部平衡实现无反射设计，即 $\\chi_{ee}^{xx}(x) = -\\chi_{mm}^{yy}(x) \\equiv \\chi(x)$，且所有其他张量元均为零。\n\n通过透射角相对于与极化对齐和未对齐的极化率/磁化率张量元在平衡设计点上求得的雅可比矩阵，定义波束偏转对制造误差的灵敏度。计算雅可比矩阵的元素\n- $\\partial \\theta_{t}/\\partial \\chi_{ee}^{xx}$，\n- $\\partial \\theta_{t}/\\partial \\chi_{mm}^{yy}$，\n- $\\partial \\theta_{t}/\\partial \\chi_{ee}^{yy}$，\n- $\\partial \\theta_{t}/\\partial \\chi_{mm}^{xx}$，\n以 $k_{0}$、局部极化率/磁化率 $\\chi(x)$ 及其空间导数 $\\partial \\chi/\\partial x$ 的解析表达式形式表示。将 $\\chi$ 视为具有长度物理标度的标量函数，并假设梯度足够小（$\\cos\\theta_t \\approx 1$）以排除多级衍射。仅使用符号变量将最终的雅可比矩阵表示为单个行向量。角度 $\\theta_{t}$ 必须以弧度表示。不需要进行数值舍入。", "solution": "该问题要求推导惠更斯超表面波束偏转角对制造误差（即磁化率张量值的偏差）的灵敏度。我们将遵循一个严谨的推导过程。\n\n1.  **GSTCs与反射/透射系数**\n    对于位于 $z=0$ 的超表面，在 $\\hat{x}$ 极化平面波垂直入射下，GSTCs 给出以下关于反射系数 $R$ 和透射系数 $T$ 的方程组：\n    $$\n    T - R - 1 = -j\\frac{k_0 \\chi_{mm}^{yy}}{2} (T-R+1)\n    $$\n    $$\n    -(T + R - 1) = j\\frac{k_0 \\chi_{ee}^{xx}}{2} (T+R+1)\n    $$\n    求解该系统可得反射系数 $R$。无反射条件（$R=0$）要求 $\\chi_{ee}^{xx} = -\\chi_{mm}^{yy}$。这个问题基于这个物理上正确的无反射（惠更斯）条件。\n\n2.  **透射相位与广义斯涅尔定律**\n    在无反射条件 $\\chi_{ee}^{xx}(x) = -\\chi_{mm}^{yy}(x) \\equiv \\chi(x)$ 下，透射系数 $T$ 简化为一个纯相位项：\n    $$\n    T(x) = \\frac{1 - j\\frac{k_0\\chi(x)}{2}}{1 + j\\frac{k_0\\chi(x)}{2}} = \\exp\\left[-2j \\arctan\\left(\\frac{k_0\\chi(x)}{2}\\right)\\right]\n    $$\n    因此，透射相位为 $\\phi_t(x) = -2 \\arctan\\left(\\frac{k_0 \\chi(x)}{2}\\right)$。\n    根据广义斯涅尔定律（切向波矢守恒），透射角 $\\theta_t$ 与相位梯度相关：\n    $$\n    \\sin(\\theta_t) = \\frac{1}{k_0} \\frac{d\\phi_t}{dx} = \\frac{1}{k_0} \\frac{d}{dx}\\left[-2 \\arctan\\left(\\frac{k_0\\chi}{2}\\right)\\right] = \\frac{-4 \\frac{d\\chi}{dx}}{4 + k_0^2\\chi^2}\n    $$\n\n3.  **灵敏度分析（雅可比矩阵）**\n    我们使用链式法则计算透射角对各磁化率分量的偏导数，并在平衡设计点 $\\chi_{ee}^{xx}=-\\chi_{mm}^{yy}=\\chi(x)$（其他分量为零）处求值。\n    $$\n    \\frac{\\partial \\theta_t}{\\partial \\chi_{ab}} = \\frac{\\partial \\theta_t}{\\partial (\\sin\\theta_t)} \\frac{\\partial (\\sin\\theta_t)}{\\partial \\chi_{ab}} = \\frac{1}{\\cos\\theta_t} \\frac{1}{k_0} \\frac{d}{dx}\\left(\\frac{\\partial \\phi_t}{\\partial \\chi_{ab}}\\right)\n    $$\n    问题假设梯度很小，因此 $\\sin\\theta_t \\approx 0$，$\\cos\\theta_t \\approx 1$。\n    $$\n    \\frac{\\partial \\theta_t}{\\partial \\chi_{ab}} \\approx \\frac{1}{k_0} \\frac{d}{dx}\\left(\\frac{\\partial \\phi_t}{\\partial \\chi_{ab}}\\right)\n    $$\n    对于未对齐的分量 $\\chi_{ee}^{yy}$ 和 $\\chi_{mm}^{xx}$，由于入射场没有相应的电场或磁场分量与之耦合，它们在一阶上对 $\\phi_t$ 没有影响。因此，$\\frac{\\partial \\theta_t}{\\partial \\chi_{ee}^{yy}} = 0$ 和 $\\frac{\\partial \\theta_t}{\\partial \\chi_{mm}^{xx}} = 0$。\n\n    对于对齐的分量，我们需要计算 $\\partial \\phi_t / \\partial \\chi_{ee}^{xx}$ 和 $\\partial \\phi_t / \\partial \\chi_{mm}^{yy}$。这需要考虑偏离平衡点时的通用透射系数 $T$。通过对通用表达式进行微扰分析，可以证明在平衡点：\n    $$\n    \\frac{\\partial \\phi_t}{\\partial \\chi_{ee}^{xx}}\\bigg|_{\\text{bal}} = \\frac{2k_0}{4+k_0^2\\chi^2}\n    $$\n    $$\n    \\frac{\\partial \\phi_t}{\\partial \\chi_{mm}^{yy}}\\bigg|_{\\text{bal}} = -\\frac{2k_0}{4+k_0^2\\chi^2}\n    $$\n    注意，这两个灵敏度大小相等，符号相反。现在我们将它们代入雅可比矩阵的表达式中：\n    对于 $\\chi_{ee}^{xx}$：\n    $$\n    \\frac{\\partial \\theta_t}{\\partial \\chi_{ee}^{xx}} \\approx \\frac{1}{k_0} \\frac{d}{dx}\\left(\\frac{2k_0}{4+k_0^2\\chi^2}\\right) = 2 \\frac{d}{dx}\\left( (4+k_0^2\\chi^2)^{-1} \\right) = 2(-1)(4+k_0^2\\chi^2)^{-2}(2k_0^2\\chi \\frac{d\\chi}{dx}) = \\frac{-4k_0^2\\chi\\frac{d\\chi}{dx}}{(4+k_0^2\\chi^2)^2}\n    $$\n    对于 $\\chi_{mm}^{yy}$，由于初始偏导数带一个负号，最终结果符号相反：\n    $$\n    \\frac{\\partial \\theta_t}{\\partial \\chi_{mm}^{yy}} \\approx \\frac{4k_0^2\\chi\\frac{d\\chi}{dx}}{(4+k_0^2\\chi^2)^2}\n    $$\n    将这些元素组合成行向量，得到雅可比矩阵。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{-4k_0^2\\chi(x)\\frac{d\\chi}{dx}}{(4+k_0^2\\chi(x)^2)^2}  \\frac{4k_0^2\\chi(x)\\frac{d\\chi}{dx}}{(4+k_0^2\\chi(x)^2)^2}  0  0 \\end{pmatrix}}\n$$", "id": "3311086"}, {"introduction": "在我们学会如何利用表面磁化率张量设计超表面之后，一个自然而然的问题是：这些张量分量本身是如何被测量和确定的？这个逆问题正是本练习的核心 [@problem_id:3311113]。它将指导你设计一套测量方案，用以完整地表征一个未知的超表面。通过推导，你将揭示入射场与可提取信息之间的深刻联系，并得出一个关键结论——平均切向磁场等于入射切向磁场，从而大大简化表征过程。", "problem": "考虑一个位于自由空间 $z=0$ 处的零厚度平面超表面，其由广义薄层传输条件 (GSTCs) 建模。假设场为时谐场，相量约定为 $\\exp(j \\omega t)$，且超表面是各向异性的，也可能是非互易的，但其唯一非零的薄层磁化率是切向磁电交叉磁化率张量 $\\bar{\\bar{\\chi}}_{em}$（即 $\\bar{\\bar{\\chi}}_{ee}=\\bar{\\bar{\\chi}}_{mm}=\\bar{\\bar{\\chi}}_{me}=\\bar{\\bar{0}}$）。张量 $\\bar{\\bar{\\chi}}_{em}$ 是一个作用于切向场分量的 $2 \\times 2$ 复值矩阵。\n\n你可以用任意入射角和偏振的时谐平面波从 $z0$ 处照射该薄层，并且可以测量紧邻薄层上方 ($z=0^{+}$) 和下方 ($z=0^{-}$) 的复切向电磁场。定义切向场的跳变矢量和平均矢量\n$$\n\\Delta \\mathbf{H}_{t} \\triangleq \\mathbf{H}_{t}(0^{+}) - \\mathbf{H}_{t}(0^{-}), \\qquad \\mathbf{H}_{\\text{avg},t} \\triangleq \\frac{\\mathbf{H}_{t}(0^{+}) + \\mathbf{H}_{t}(0^{-})}{2},\n$$\n切向电场也作类似定义。令 $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$ 为单位法向量。\n\n从 Maxwell 方程组和标准电磁边界关系出发，将 GSTCs 特化到这种仅有磁电效应的薄层，并推导 $\\Delta \\mathbf{H}_{t}$、$\\mathbf{H}_{\\text{avg},t}$ 和 $\\bar{\\bar{\\chi}}_{em}$ 之间的线性关系。使用此关系来构建从平面波照射中反演出 $\\bar{\\bar{\\chi}}_{em}$ 所有四个复数元素的逆问题。将每个不同的偏振态视为一次“激励”，每个不同的入射方向（角度和侧面）视为一次“照射”。你可以假设所有测量量（包括复相位）都是无误差的已知量。\n\n确定唯一地反演出各向异性、可能非互易薄层的完整 $\\bar{\\bar{\\chi}}_{em}$ 所需的最少照射次数和最少偏振激励次数，并严格推导所选激励保证唯一解的可辨识性条件。将你的最终数值答案表示为一个行矩阵 $\\begin{pmatrix}N_{\\text{illum}}  N_{\\text{pol}}\\end{pmatrix}$，其中 $N_{\\text{illum}}$ 是最少照射次数，$N_{\\text{pol}}$ 是最少偏振激励次数。最终数值答案无需四舍五入，也无需单位。", "solution": "问题要求确定唯一地确定一个零厚度平面超表面的切向磁电磁化率张量 $\\bar{\\bar{\\chi}}_{em}$ 的四个复数元素所需的最少平面波照射次数和偏振激励次数。\n\n首先，我们通过特化广义薄层传输条件 (GSTCs) 来建立相关的边界条件。GSTCs 将跨越表面的切向场的不连续性与薄层上感应出的有效表面极化密度 ($\\mathbf{P}_s$) 和磁化密度 ($\\mathbf{M}_s$) 联系起来。这些密度又与平均切向场相关。从 Maxwell 方程组的积分形式推导出的边界条件是：\n$$\n\\hat{\\mathbf{n}} \\times (\\mathbf{E}(0^+) - \\mathbf{E}(0^-)) = -\\mathbf{J}_m\n$$\n$$\n\\hat{\\mathbf{n}} \\times (\\mathbf{H}(0^+) - \\mathbf{H}(0^-)) = \\mathbf{J}_e\n$$\n其中 $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$ 是 $z=0$ 处薄层的单位法向量，$\\mathbf{J}_e$ 和 $\\mathbf{J}_m$ 分别是有效表面电流密度和磁流密度。场跳变定义为 $\\Delta \\mathbf{F} \\triangleq \\mathbf{F}(0^+) - \\mathbf{F}(0^-)$。对于时谐场 $\\exp(j \\omega t)$，表面电流通过 $\\mathbf{J}_e = j\\omega \\mathbf{P}_s$ 和 $\\mathbf{J}_m = j\\omega \\mathbf{M}_s$ 与表面极化和磁化密度相关。\n\n表面密度通过磁化率张量与平均切向场 $\\mathbf{E}_{\\text{avg},t} \\triangleq (\\mathbf{E}_t(0^+) + \\mathbf{E}_t(0^-))/2$ 和 $\\mathbf{H}_{\\text{avg},t} \\triangleq (\\mathbf{H}_t(0^+) + \\mathbf{H}_t(0^-))/2$ 构成本构关系：\n$$\n\\mathbf{P}_s = \\epsilon_0 \\left( \\bar{\\bar{\\chi}}_{ee} \\cdot \\mathbf{E}_{\\text{avg},t} + \\bar{\\bar{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t} \\right)\n$$\n$$\n\\mathbf{M}_s = \\mu_0 \\left( \\bar{\\bar{\\chi}}_{me} \\cdot \\mathbf{E}_{\\text{avg},t} + \\bar{\\bar{\\chi}}_{mm} \\cdot \\mathbf{H}_{\\text{avg},t} \\right)\n$$\n问题陈述只有切向磁电磁化率 $\\bar{\\bar{\\chi}}_{em}$ 是非零的，即 $\\bar{\\bar{\\chi}}_{ee} = \\bar{\\bar{\\chi}}_{mm} = \\bar{\\bar{\\chi}}_{me} = \\bar{\\bar{0}}$。将这些代入本构关系得到：\n$$\n\\mathbf{P}_s = \\epsilon_0 \\bar{\\bar{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t} \\implies \\mathbf{J}_e = j\\omega\\epsilon_0 \\bar{\\bar{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t}\n$$\n$$\n\\mathbf{M}_s = \\bar{\\bar{0}} \\implies \\mathbf{J}_m = \\bar{\\bar{0}}\n$$\n将这些特化的电流代入边界条件得出：\n1. 对于电场：$\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{E}_t = -\\mathbf{J}_m = \\mathbf{0}$。由于 $\\Delta \\mathbf{E}_t$ 是一个切向矢量，这意味着 $\\Delta \\mathbf{E}_t = \\mathbf{0}$。切向电场在薄层两侧是连续的。\n2. 对于磁场：$\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{H}_t = \\mathbf{J}_e$。代入 $\\mathbf{J}_e$ 的表达式，我们得到：\n$$\n\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{H}_t = j\\omega\\epsilon_0 \\bar{\\bar{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t}\n$$\n这个矢量方程表示了可测量 $\\Delta \\mathbf{H}_t$ 和 $\\mathbf{H}_{\\text{avg},t}$ 与未知张量 $\\bar{\\bar{\\chi}}_{em}$ 之间的所需线性关系。\n\n为了构建逆问题，我们将此关系表示为矩阵形式。令切向矢量在 $(\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}})$ 基中表示为 $2 \\times 1$ 的列向量。\n$\\Delta \\mathbf{H}_t = \\Delta H_x \\hat{\\mathbf{x}} + \\Delta H_y \\hat{\\mathbf{y}}$。\n与 $\\hat{\\mathbf{z}}$ 的叉积是 $\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{H}_t = \\Delta H_y \\hat{\\mathbf{x}} - \\Delta H_x \\hat{\\mathbf{y}}$。\n令未知的 $2 \\times 2$ 复数张量为 $\\bar{\\bar{\\chi}}_{em} = \\begin{pmatrix} \\chi_{xx}  \\chi_{xy} \\\\ \\chi_{yx}  \\chi_{yy} \\end{pmatrix}$。\n矢量方程变为：\n$$\n\\begin{pmatrix} \\Delta H_y \\\\ -\\Delta H_x \\end{pmatrix} = j\\omega\\epsilon_0 \\begin{pmatrix} \\chi_{xx}  \\chi_{xy} \\\\ \\chi_{yx}  \\chi_{yy} \\end{pmatrix} \\begin{pmatrix} H_{\\text{avg},x} \\\\ H_{\\text{avg},y} \\end{pmatrix}\n$$\n该系统为 $\\bar{\\bar{\\chi}}_{em}$ 的四个复数未知数提供了两个复线性方程。\n$$\n\\Delta H_y = j\\omega\\epsilon_0 (\\chi_{xx} H_{\\text{avg},x} + \\chi_{xy} H_{\\text{avg},y})\n$$\n$$\n-\\Delta H_x = j\\omega\\epsilon_0 (\\chi_{yx} H_{\\text{avg},x} + \\chi_{yy} H_{\\text{avg},y})\n$$\n该系统解耦为两个独立的问题：一个针对 $\\bar{\\bar{\\chi}}_{em}$ 的第一行 $(\\chi_{xx}, \\chi_{xy})$，另一个针对第二行 $(\\chi_{yx}, \\chi_{yy})$。我们来分析第一个问题：\n$$\n\\frac{\\Delta H_y}{j\\omega\\epsilon_0} = \\chi_{xx} H_{\\text{avg},x} + \\chi_{xy} H_{\\text{avg},y}\n$$\n这是一个含有两个未知数的线性方程。为了求解 $\\chi_{xx}$ 和 $\\chi_{xy}$，我们需要第二个线性无关的方程。这需要进行第二次测量，用上标 $(2)$ 表示，该测量从不同的激励获得。\n$$\nH_{\\text{avg},x}^{(1)} \\chi_{xx} + H_{\\text{avg},y}^{(1)} \\chi_{xy} = \\frac{\\Delta H_y^{(1)}}{j\\omega\\epsilon_0}\n$$\n$$\nH_{\\text{avg},x}^{(2)} \\chi_{xx} + H_{\\text{avg},y}^{(2)} \\chi_{xy} = \\frac{\\Delta H_y^{(2)}}{j\\omega\\epsilon_0}\n$$\n该系统可以写成矩阵形式：\n$$\n\\begin{pmatrix} H_{\\text{avg},x}^{(1)}  H_{\\text{avg},y}^{(1)} \\\\ H_{\\text{avg},x}^{(2)}  H_{\\text{avg},y}^{(2)} \\end{pmatrix} \\begin{pmatrix} \\chi_{xx} \\\\ \\chi_{xy} \\end{pmatrix} = \\frac{1}{j\\omega\\epsilon_0} \\begin{pmatrix} \\Delta H_y^{(1)} \\\\ \\Delta H_y^{(2)} \\end{pmatrix}\n$$\n$(\\chi_{xx}, \\chi_{xy})$ 的唯一解存在的充要条件是系数矩阵可逆。这要求其行列式不为零：$H_{\\text{avg},x}^{(1)} H_{\\text{avg},y}^{(2)} - H_{\\text{avg},y}^{(1)} H_{\\text{avg},x}^{(2)} \\neq 0$。这就是两个切向矢量 $\\mathbf{H}_{\\text{avg},t}^{(1)}$ 和 $\\mathbf{H}_{\\text{avg},t}^{(2)}$ 线性无关的条件。在相同条件下，同样的两次测量将允许从第二个解耦的系统中唯一确定 $(\\chi_{yx}, \\chi_{yy})$。\n因此，反演完整张量 $\\bar{\\bar{\\chi}}_{em}$ 的可辨识性条件是，我们必须执行至少两次测量，以产生两个线性无关的平均切向磁场矢量。\n\n现在我们将 $\\mathbf{H}_{\\text{avg},t}$ 与入射平面波联系起来。对于从 $z0$ 入射的平面波，在 $z=0^-$ 的总切向场是入射 (i) 和反射 (r) 分量的和，$\\mathbf{H}_t(0^-) = \\mathbf{H}_{i,t} + \\mathbf{H}_{r,t}$。在 $z=0^+$，场是透射 (t) 分量，$\\mathbf{H}_t(0^+) = \\mathbf{H}_{t,t}$。波导纳张量 $\\bar{\\bar{Y}}$ 关联了切向磁场和电场，$\\mathbf{H}_t = \\bar{\\bar{Y}} \\cdot \\mathbf{E}_t$。对于沿 $+z$ 方向传播的波，$\\mathbf{H}_t = \\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_t$，对于沿 $-z$ 方向传播的波，$\\mathbf{H}_t = -\\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_t$。\n因此，我们有 $\\mathbf{H}_{i,t} = \\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{i,t}$，$\\mathbf{H}_{r,t} = -\\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{r,t}$，以及 $\\mathbf{H}_{t,t} = \\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{t,t}$。\n平均切向磁场为：\n$$\n\\mathbf{H}_{\\text{avg},t} = \\frac{1}{2}\\left(\\mathbf{H}_t(0^+) + \\mathbf{H}_t(0^-)\\right) = \\frac{1}{2}\\left(\\mathbf{H}_{t,t} + \\mathbf{H}_{i,t} + \\mathbf{H}_{r,t}\\right)\n$$\n使用导纳：\n$$\n\\mathbf{H}_{\\text{avg},t} = \\frac{1}{2}\\left(\\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{t,t} + \\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{i,t} - \\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{r,t}\\right) = \\frac{1}{2} \\bar{\\bar{Y}}_i \\cdot (\\mathbf{E}_{t,t} + \\mathbf{E}_{i,t} - \\mathbf{E}_{r,t})\n$$\n切向电场的连续性，$\\Delta \\mathbf{E}_t = \\mathbf{0}$，意味着 $\\mathbf{E}_t(0^+) = \\mathbf{E}_t(0^-)$，这表明 $\\mathbf{E}_{t,t} = \\mathbf{E}_{i,t} + \\mathbf{E}_{r,t}$。将 $\\mathbf{E}_{r,t} = \\mathbf{E}_{t,t} - \\mathbf{E}_{i,t}$ 代入 $\\mathbf{H}_{\\text{avg},t}$ 的表达式中：\n$$\n\\mathbf{H}_{\\text{avg},t} = \\frac{1}{2} \\bar{\\bar{Y}}_i \\cdot (\\mathbf{E}_{t,t} + \\mathbf{E}_{i,t} - (\\mathbf{E}_{t,t} - \\mathbf{E}_{i,t})) = \\frac{1}{2} \\bar{\\bar{Y}}_i \\cdot (2\\mathbf{E}_{i,t}) = \\bar{\\bar{Y}}_i \\cdot \\mathbf{E}_{i,t} = \\mathbf{H}_{i,t}\n$$\n这个关键结果表明，平均切向磁场等于入射切向磁场。因此，可辨识性条件简化为：要反演 $\\bar{\\bar{\\chi}}_{em}$，我们必须用两种激励照射该薄层，以产生两个线性无关的入射切向磁场矢量 $\\mathbf{H}_{i,t}^{(1)}$ 和 $\\mathbf{H}_{i,t}^{(2)}$。\n\n单次照射由一个固定的入射波矢量 $\\mathbf{k}_i$ 定义。对于任何此类照射（无论是正入射还是斜入射），我们都可以选择两个正交的偏振态。例如，对于 $xz$ 平面内的斜入射，可以使用 TE 偏振波（s-pol, $\\mathbf{E}_i \\propto \\hat{\\mathbf{y}}$）和 TM 偏振波（p-pol, $\\mathbf{H}_i \\propto \\hat{\\mathbf{y}}$）。\n- 对于 TE 情况，$\\mathbf{H}_{i,t}$ 将有沿 $\\hat{\\mathbf{x}}$ 的分量。\n- 对于 TM 情况，$\\mathbf{H}_{i,t}$ 将沿 $\\hat{\\mathbf{y}}$ 方向。\n这两个矢量 $\\mathbf{H}_{i,t}^{(TE)}$ 和 $\\mathbf{H}_{i,t}^{(TM)}$ 是正交的，因此是线性无关的。对于使用两种正交线性偏振（例如，x-偏振和y-偏振）的正入射，结论同样成立。因此，所需的两次测量可以通过使用单一照射方向、两种不同偏振激励来实现。\n\n因此，最少照射次数为 $N_{\\text{illum}} = 1$。\n该照射所需的最少偏振激励次数为 $N_{\\text{pol}} = 2$。\n这构成了一个总共两次测量的最小集合。\n\n最终的可辨识性条件是，所选的激励集合必须产生一组能够张成二维切向平面的入射切向磁场矢量 $\\{\\mathbf{H}_{i,t}^{(k)}\\}$。对于两次激励的最小情况，这意味着矢量 $\\mathbf{H}_{i,t}^{(1)}$ 和 $\\mathbf{H}_{i,t}^{(2)}$ 必须是线性无关的。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  2\n\\end{pmatrix}\n}\n$$", "id": "3311113"}, {"introduction": "从解析模型到通用计算工具的跨越是计算电磁学领域的关键一步。虽然解析解对于简单结构非常强大，但模拟任意形状的超表面则必须依赖于矩量法（MoM）等数值方法。本练习 [@problem_id:3311059] 将带你深入计算电磁学的核心，展示如何将GSTCs嵌入到边界积分方程的框架中。此外，它还探讨了矩阵条件数这一关键的数值问题，并演示了如何利用Calderón预条件子等技巧来改善系统特性，从而让你对数值求解器的稳定性和效率有更深入的认识。", "problem": "要求您推导、离散化并分析一个二维横电散射问题的边界积分公式，该问题涉及一个由广义薄层过渡条件 (GSTCs) 描述的零厚度超表面。您的任务是 (i) 从麦克斯韦方程组和 GSTCs 出发，获得一个带有附加奇异曲面算子的标量亥姆霍兹边界积分方程，(ii) 使用一个已知的恒等式引入基于Calderón的正则化，(iii) 在一个圆形轮廓上实现矩量法 (MoM) 的谱方法，其中算子在傅里叶基中对角化，以及 (iv) 计算并报告量化正则化效果的条件数。\n\n假设和基本依据：\n- 背景介质是均匀、各向同性、非色散的自由空间，其介电常数为 $\\epsilon_0$，磁导率为 $\\mu_0$，光速为 $c_0 = \\frac{1}{\\sqrt{\\mu_0 \\epsilon_0}}$。精确使用 $c_0 = 299792458\\,\\text{m/s}$。\n- 时间相关性为 $e^{j \\omega t}$，其中 $\\omega = 2 \\pi f$，自由空间波数为 $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0} = \\frac{2 \\pi f}{c_0}$。\n- 考虑二维横电 (TE) 极化，其非零电场分量为 $E_z(\\mathbf{r})$，我们将其表示为 $u(\\mathbf{r})$，在远离薄层的地方满足标量亥姆霍兹方程 $\\nabla^2 u + k_0^2 u = 0$。\n- 超表面位于一个光滑、封闭、零厚度的轮廓 $\\Gamma$ (半径为 $a$ 的圆) 上，其特征是纯电表面电纳率 $\\chi_{\\mathrm{ee}}$ (无量纲)，没有磁化率。在这种情况下，广义薄层过渡条件 (GSTCs) 简化为切向电场在薄层两侧的连续性，以及切向磁场的跳变与平均切向电场成正比。对于二维TE波，这在 $\\Gamma$ 上产生了标量条件：$u^+ = u^-$ 和 $\\partial_n u^+ - \\partial_n u^- = - k_0^2 \\chi_{\\mathrm{ee}} u$，其中 $\\partial_n$ 表示法向导数，而 $+$/$-$ 表示从 $\\Gamma$ 两侧的极限。\n- 使用自由空间二维格林函数 $G(\\mathbf{r},\\mathbf{r}') = \\frac{j}{4} H_0^{(1)}(k_0 |\\mathbf{r}-\\mathbf{r}'|)$，其中 $H_0^{(1)}$ 是第一类零阶汉克尔函数，用于标量亥姆霍兹方程。\n\n推导目标 (不要在问题陈述中使用任何捷径公式；在您的解答中进行推导)：\n1.  用单层势 $S[\\varphi](\\mathbf{r}) = \\int_{\\Gamma} G(\\mathbf{r},\\mathbf{r}') \\varphi(\\mathbf{r}') \\, \\mathrm{d}s'$ 来表示散射场 $u_{\\mathrm{sc}}$，其中 $\\varphi$ 是一个未知密度。使用与单层势相关的跳变关系和GSTC，推导出一个形式为\n    $$\n    \\left(I + \\alpha S\\right) \\varphi = g,\n    $$\n    的边界积分方程，其中 $I$ 是 $\\Gamma$ 上的单位算子，$S$ 是单层边界算子，$\\alpha$ 是一个取决于 $k_0$ 和 $\\chi_{\\mathrm{ee}}$ 的参数，而 $g$ 取决于限制在 $\\Gamma$ 上的入射场。该方程必须明确显示在单位算子上增加了一个奇异曲面算子。\n2.  通过应用已知在光滑闭合曲线上满足Calderón恒等式的超奇异-单层复合算子，引入基于Calderón的正则化：\n    $$\n    N S = -\\tfrac{1}{4} I + K'^2,\n    $$\n    其中 $N$ 是超奇异边界算子 (将狄利克雷数据映射到诺伊曼数据)，$K'$ 是伴随双层边界算子。使用此恒等式定义一个左乘的正则化算子\n    $$\n    \\mathcal{C} \\left(I + \\alpha S\\right),\n    $$\n    其中 $\\mathcal{C} = -\\tfrac{1}{4} I + K'^2$。您必须论证为什么在矩量法离散化中，这种乘法能改善条件数。\n3.  对于一个由极角 $\\theta \\in [0, 2\\pi)$ 参数化的半径为 $a$ 的圆，使用Graf加法定理证明，在傅里叶基 $\\{ e^{j n \\theta} \\}_{n \\in \\mathbb{Z}}$ 中，算子 $S$ 和 $K'$ 是对角化的，并推导它们的傅里叶特征值的表达式：\n    -   对于 $S$，证明 $S[e^{j n \\theta}] = s_n e^{j n \\theta}$，其中 $s_n$ 取决于 $k_0 a$。\n    -   对于 $K'$，证明 $K'[e^{j n \\theta}] = k'_n e^{j n \\theta}$，其中 $k'_n$ 取决于 $k_0 a$ 以及贝塞尔函数和汉克尔函数的导数。然后证明 $\\mathcal{C}$ 也是对角化的，其特征值为 $c_n = -\\tfrac{1}{4} + (k'_n)^2$。\n4.  使用傅里叶谱矩量法 (对于某个非负整数 $M$，截断至模式 $n = -M, \\ldots, M$)，计算条件数\n    $$\n    \\kappa\\left(I + \\alpha S\\right) = \\frac{\\max_n |1 + \\alpha s_n|}{\\min_n |1 + \\alpha s_n|}, \\quad \\kappa\\left(\\mathcal{C}(I + \\alpha S)\\right) = \\frac{\\max_n |c_n (1 + \\alpha s_n)|}{\\min_n |c_n (1 + \\alpha s_n)|}.\n    $$\n    条件数应作为截断傅里叶基中的谱条件数来计算。\n\n实现要求：\n-   常量和单位：使用 $c_0 = 299792458\\,\\text{m/s}$，频率 $f$ 单位为 $\\text{Hz}$，半径 $a$ 单位为 $\\text{m}$，电纳率 $\\chi_{\\mathrm{ee}}$ 无量纲。角度以弧度为单位。输出 (条件数) 是无量纲的实数。\n-   圆形傅里叶基中算子的数值规范：\n    -   令 $x = k_0 a$。对于每个整数模式 $n$，特征值必须实现为\n        $$\n        s_n = j \\frac{\\pi a}{2} H_n^{(1)}(x) J_n(x),\n        $$\n        $$\n        k'_n = j \\frac{\\pi a k_0}{4} \\left[ H_n^{(1)\\,'}(x) J_n(x) + H_n^{(1)}(x) J_n'(x) \\right],\n        $$\n        $$\n        c_n = -\\frac{1}{4} + \\left(k'_n\\right)^2,\n        $$\n        其中 $J_n$ 和 $J_n'$ 是第一类贝塞尔函数及其导数，$H_n^{(1)}$ 和 $H_n^{(1)\\,'}$ 是第一类汉克尔函数及其导数。\n    -   使用 $\\alpha = k_0^2 \\chi_{\\mathrm{ee}}$。\n    -   截断至模式 $n = -M, \\ldots, M$，并根据需要使用对称性来精确计算条件数。\n-   测试套件：您的程序必须为以下参数集计算条件数，每个参数集指定为四元组 $(f, a, \\chi_{\\mathrm{ee}}, M)$：\n    -   测试 1 (正常情况)：$(1.0 \\times 10^9, 0.5, 0.01, 20)$。\n    -   测试 2 (无超表面的边界情况)：$(1.0 \\times 10^9, 0.5, 0.0, 20)$。\n    -   测试 3 (更强薄层和更多模式的边缘情况)：$(6.0 \\times 10^9, 0.5, 0.05, 40)$。\n-   要求输出：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例包含 2 个浮点数，顺序为\n    $$\n    [\\kappa(I + \\alpha S)\\_{\\text{test }1}, \\kappa(\\mathcal{C}(I + \\alpha S))\\_{\\text{test }1}, \\kappa(I + \\alpha S)\\_{\\text{test }2}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }2}, \\kappa(I + \\alpha S)\\_{\\text{test }3}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }3}].\n    $$\n    所有输出都应以纯十进制浮点数形式提供，无单位，除了单行上的方括号列表外，没有其他文本。", "solution": "我们从自由空间中的时谐麦克斯韦方程组开始，时间依赖性为 $e^{j \\omega t}$，并考虑二维横电 (TE) 极化，其电场 $E_z(\\mathbf{r})$ 与平面外坐标无关。记 $u(\\mathbf{r}) = E_z(\\mathbf{r})$，在远离源和薄层的区域，场遵循标量亥姆霍兹方程 $\\nabla^2 u + k_0^2 u = 0$，其中 $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0} = \\frac{2 \\pi f}{c_0}$ 且 $c_0 = 299792458\\,\\text{m/s}$。\n\n位于光滑闭合轮廓 $\\Gamma$ 上的零厚度超表面，由广义薄层过渡条件 (GSTCs) 描述，引入了场在薄层两侧的跳变和平均值之间的关系。对于一个纯电表面，其电纳率为 $\\chi_{\\mathrm{ee}}$ 且无磁化率，GSTCs (对于切向场) 简化为切向电场的连续性，以及切向磁场的跳变与平均切向电场成正比。在二维TE极化中，利用 $u$ 与磁场分量之间的关系，这些GSTCs 在 $\\Gamma$ 上意味着边界条件\n$$\nu^+ = u^-,\n\\quad\n\\partial_n u^+ - \\partial_n u^- = - k_0^2 \\chi_{\\mathrm{ee}} \\, u,\n$$\n其中 $\\partial_n$ 表示沿 $\\Gamma$ 的向外法向的导数，而 $+$ 和 $-$ 表示从薄层两侧的极限。因子 $- k_0^2$ 的出现是因为在TE中 $\\Delta H_t = j \\omega \\epsilon_0 \\chi_{\\mathrm{ee}} \\, u_{\\mathrm{avg}}$ 和 $H_t = \\frac{1}{j \\omega \\mu_0} \\partial_n u$，以及 $k_0^2 = \\omega^2 \\mu_0 \\epsilon_0$。连续性 $u^+ = u^-$ 得到在 $\\Gamma$ 上 $u_{\\mathrm{avg}} = u$。\n\n我们用单层势来表示散射场\n$$\nu_{\\mathrm{sc}}(\\mathbf{r}) = S[\\varphi](\\mathbf{r}) = \\int_{\\Gamma} G(\\mathbf{r},\\mathbf{r}') \\, \\varphi(\\mathbf{r}') \\, \\mathrm{d}s',\n\\quad\nG(\\mathbf{r},\\mathbf{r}') = \\frac{j}{4} H_0^{(1)}\\!\\left(k_0 |\\mathbf{r}-\\mathbf{r}'|\\right).\n$$\n单层势在 $\\Gamma$ 上是连续的，而其法向导数则表现出一个由密度给出的跳变。设 $u = u_{\\mathrm{inc}} + u_{\\mathrm{sc}}$ 为总场，其中入射场 $u_{\\mathrm{inc}}$ 在背景介质中满足亥姆霍兹方程。法向导数跳变的GSTC变为\n$$\n\\left(\\partial_n u_{\\mathrm{sc}}^+ - \\partial_n u_{\\mathrm{sc}}^-\\right) = - k_0^2 \\chi_{\\mathrm{ee}} \\, \\left(u_{\\mathrm{inc}} + u_{\\mathrm{sc}}\\right) \\quad \\text{on } \\Gamma.\n$$\n使用单层势的跳变关系，\n$$\n\\partial_n S[\\varphi]^+ - \\partial_n S[\\varphi]^- = \\varphi \\quad \\text{on } \\Gamma,\n$$\n以及 $S[\\varphi]$ 在 $\\Gamma$ 上的连续性，我们得到\n$$\n\\varphi + k_0^2 \\chi_{\\mathrm{ee}} \\, S[\\varphi] = - k_0^2 \\chi_{\\mathrm{ee}} \\, u_{\\mathrm{inc}}|_{\\Gamma}.\n$$\n定义 $\\alpha = k_0^2 \\chi_{\\mathrm{ee}}$。那么在 $\\Gamma$ 上的边界积分方程为\n$$\n\\left(I + \\alpha S\\right) \\varphi = g,\n\\quad\ng = - \\alpha \\, u_{\\mathrm{inc}}|_{\\Gamma}.\n$$\n算子 $S$ 是一个弱奇异积分算子 (在二维中为对数奇异)，即一个加到单位算子上的奇异曲面算子。对于光滑闭合的 $\\Gamma$，该方程是第二类方程 (单位算子加紧算子)。\n\n为了在矩量法 (MoM) 离散化中改善数值条件，我们应用基于Calderón的正则化。对于二维光滑闭合曲线，Calderón恒等式为\n$$\nN S = -\\tfrac{1}{4} I + K'^2,\n$$\n其中 $N$ 是超奇异算子，$K'$ 是伴随双层算子。将方程左乘 $\\mathcal{C} = -\\tfrac{1}{4} I + K'^2$ 得到正则化系统\n$$\n\\mathcal{C} \\left(I + \\alpha S\\right) \\varphi = \\mathcal{C} \\, g.\n$$\n由于 $\\mathcal{C}$ 等于 $N S$，这种复合将紧算子 $S$ 的贡献替换为 $N S$，后者是零阶的 (零阶伪微分算子)，并将左侧变为其主部对于光滑 $\\Gamma$ 是强制且有界可逆的形式，从而改善了特征值的聚集和条件数行为。\n\n我们现在将问题具体化到 $\\Gamma$ 是一个由 $\\theta \\in [0, 2 \\pi)$ 参数化的半径为 $a$ 的圆，并使用傅里叶基 $\\{ e^{j n \\theta} \\}_{n \\in \\mathbb{Z}}$。根据Graf加法定理，\n$$\nH_0^{(1)}\\!\\left(k_0 |\\mathbf{r}-\\mathbf{r}'|\\right) = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k_0 r_) J_m(k_0 r_) e^{j m (\\theta - \\theta')},\n$$\n其中 $r_ = \\max(r, r')$, $r_ = \\min(r, r')$, $J_m$ 是第一类 $m$ 阶贝塞尔函数，$H_m^{(1)}$ 是第一类 $m$ 阶汉克尔函数。对于在同一个圆上的点，$r = r' = a$，单层边界算子 $S$ 在傅里叶基中对角化。作用于单个傅里叶模式 $e^{j n \\theta'}$ 并在 $\\theta'$ 上积分，可以发现\n$$\nS\\left[e^{j n \\theta}\\right] = s_n e^{j n \\theta},\n\\quad\ns_n = j \\frac{\\pi a}{2} H_n^{(1)}(x) J_n(x),\n\\quad x = k_0 a.\n$$\n类似地，伴随双层算子 $K'$ 在此基中也是对角化的，其特征值通过取单层势的内外极限法向导数的平均值得到。得到的特征值为\n$$\nK'\\left[e^{j n \\theta}\\right] = k'_n e^{j n \\theta},\n\\quad\nk'_n = j \\frac{\\pi a k_0}{4} \\left[ H_n^{(1)\\,'}(x) J_n(x) + H_n^{(1)}(x) J_n'(x) \\right],\n$$\n其中 $J_n'$ 和 $H_n^{(1)\\,'}$ 表示关于参数 $x = k_0 a$ 的导数。因此，\n$$\n\\mathcal{C}\\left[e^{j n \\theta}\\right] = c_n e^{j n \\theta},\n\\quad\nc_n = -\\frac{1}{4} + \\left(k'_n\\right)^2.\n$$\n在截断至模式 $n = -M, \\ldots, M$ 的傅里叶谱矩量法中，$I + \\alpha S$ 和 $\\mathcal{C}$ 都由对角矩阵表示，其对角元素分别为 $1 + \\alpha s_n$ 和 $c_n$。因此，谱条件数为\n$$\n\\kappa\\left(I + \\alpha S\\right) = \\frac{\\max_{-M \\le n \\le M} |1 + \\alpha s_n|}{\\min_{-M \\le n \\le M} |1 + \\alpha s_n|},\n\\quad\n\\kappa\\left(\\mathcal{C} (I + \\alpha S)\\right) = \\frac{\\max_{-M \\le n \\le M} |c_n (1 + \\alpha s_n)|}{\\min_{-M \\le n \\le M} |c_n (1 + \\alpha s_n)|}.\n$$\n算法步骤：\n1. 对于每个测试用例 $(f, a, \\chi_{\\mathrm{ee}}, M)$，计算 $k_0 = \\frac{2 \\pi f}{c_0}$ 和 $x = k_0 a$，并设置 $\\alpha = k_0^2 \\chi_{\\mathrm{ee}}$。\n2. 对于 $n = -M, \\ldots, M$，使用数值稳定的特殊函数计算 $J_n(x)$, $J_n'(x)$, $H_n^{(1)}(x)$, 和 $H_n^{(1)\\,'}(x)$。然后如上计算 $s_n$, $k'_n$, 和 $c_n$。\n3. 形成特征值数组 $A_n = 1 + \\alpha s_n$ (对于 $I + \\alpha S$) 和 $R_n = c_n A_n$ (对于 $\\mathcal{C}(I + \\alpha S)$)。\n4. 计算条件数\n$$\n\\kappa\\left(I + \\alpha S\\right) = \\frac{\\max_n |A_n|}{\\min_n |A_n|}, \\quad \\kappa\\left(\\mathcal{C} (I + \\alpha S)\\right) = \\frac{\\max_n |R_n|}{\\min_n |R_n|}.\n$$\n绝对值确保条件数为非负实数。\n5. 报告指定测试套件的六个浮点数：\n   - 测试 1: $(f, a, \\chi_{\\mathrm{ee}}, M) = (1.0 \\times 10^9, 0.5, 0.01, 20)$,\n   - 测试 2: $(f, a, \\chi_{\\mathrm{ee}}, M) = (1.0 \\times 10^9, 0.5, 0.0, 20)$,\n   - 测试 3: $(f, a, \\chi_{\\mathrm{ee}}, M) = (6.0 \\times 10^9, 0.5, 0.05, 40)$。\n输出是无量纲的，并且必须以单行上的单个方括号列表的形式打印，顺序为\n$$\n[\\kappa(I + \\alpha S)_{\\text{test }1}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }1}, \\kappa(I + \\alpha S)_{\\text{test }2}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }2}, \\kappa(I + \\alpha S)_{\\text{test }3}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }3}].\n$$\n关于条件数的讨论：\n- 当 $\\chi_{\\mathrm{ee}} = 0$ 时，未正则化的算子恰好是单位算子，$\\kappa(I + \\alpha S) = 1$。正则化算子简化为 $\\mathcal{C}$，其条件数反映了 $N S$ 的谱；它通常大于 1，这突出表明Calderón正则化旨在平衡第一类公式或由紧部分主导的单位加紧系统，而不是为了改进纯单位算子。\n- 对于非零的 $\\chi_{\\mathrm{ee}}$，如果对于某个 $n$， $|\\alpha s_n|$ 接近 1 且相位与 1 相反，则算子 $I + \\alpha S$ 可能变得病态。乘以 $\\mathcal{C}$ 将紧的单层贡献替换为 $N S$，导致特征值聚集得到改善，并且随着 $M$ 的增加，条件数通常会减小，这反映了矩量法中离散化的鲁棒性。在圆上的傅里叶对角化使这些效应变得透明且数值上稳定可评估。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, jvp, hankel1, h1vp\n\ndef eigenvalues_single_layer_and_Kprime(k0, a, M):\n    \"\"\"\n    Compute the Fourier eigenvalues s_n of the single-layer operator S\n    and k'_n of the adjoint double-layer operator K' on a circle of radius a,\n    for modes n = -M, ..., M, at wavenumber k0.\n\n    s_n = j * (pi * a / 2) * H_n^{(1)}(x) * J_n(x)\n    k'_n = j * (pi * a * k0 / 4) * [ H_n^{(1)'}(x) * J_n(x) + H_n^{(1)}(x) * J_n'(x) ]\n    where x = k0 * a.\n    \"\"\"\n    x = k0 * a\n    ns = np.arange(-M, M+1, dtype=int)\n    # Compute Bessel and Hankel functions for each n\n    J = np.array([jv(n, x) for n in ns], dtype=complex)\n    Jp = np.array([jvp(n, x, 1) for n in ns], dtype=complex)\n    H = np.array([hankel1(n, x) for n in ns], dtype=complex)\n    Hp = np.array([h1vp(n, x, 1) for n in ns], dtype=complex)\n\n    s = 1j * (np.pi * a / 2.0) * H * J\n    kprime = 1j * (np.pi * a * k0 / 4.0) * (Hp * J + H * Jp)\n    return ns, s, kprime\n\ndef condition_numbers_for_case(f_hz, a_m, chi_ee, M):\n    c0 = 299792458.0  # m/s\n    omega = 2.0 * np.pi * f_hz\n    k0 = omega / c0\n    alpha = (k0 ** 2) * chi_ee\n\n    ns, s, kprime = eigenvalues_single_layer_and_Kprime(k0, a_m, M)\n    # Calderón operator eigenvalues: C = -1/4 I + K'^2\n    C = -0.25 + (kprime ** 2)\n\n    A = 1.0 + alpha * s\n    # Avoid division by zero: ensure no zero eigenvalues in the truncated set\n    absA = np.abs(A)\n    absCA = np.abs(C * A)\n\n    # Remove any near-zero modes robustly by adding a tiny epsilon if needed\n    eps = 1e-30\n    min_absA = np.max([np.min(absA), eps])\n    min_absCA = np.max([np.min(absCA), eps])\n\n    kappa_A = np.max(absA) / min_absA\n    kappa_CA = np.max(absCA) / min_absCA\n    # Return as real floats\n    return float(np.real_if_close(kappa_A)), float(np.real_if_close(kappa_CA))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each is (frequency in Hz, radius in m, chi_ee (dimensionless), M modes)\n    test_cases = [\n        (1.0e9, 0.5, 0.01, 20),  # Test 1: happy path\n        (1.0e9, 0.5, 0.0, 20),   # Test 2: boundary (no metasurface)\n        (6.0e9, 0.5, 0.05, 40),  # Test 3: edge (stronger sheet, more modes)\n    ]\n\n    results = []\n    for case in test_cases:\n        f_hz, a_m, chi_ee, M = case\n        kappa_unreg, kappa_reg = condition_numbers_for_case(f_hz, a_m, chi_ee, M)\n        results.append(kappa_unreg)\n        results.append(kappa_reg)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3311059"}]}