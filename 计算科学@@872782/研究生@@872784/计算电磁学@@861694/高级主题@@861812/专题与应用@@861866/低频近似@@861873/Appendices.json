{"hands_on_practices": [{"introduction": "本练习将抽象的静电准静态（EQS）概念应用于一个具体场景：电路理论。我们将推导一个填充有损耗电介质的同轴结构的导纳，以此阐明如何同时考虑传导电流和位移电流。该实践引入了使用复介电常数这一强大技术，它能够巧妙地结合材料属性并在频域中表示损耗。[@problem_id:3326252]", "problem": "一个长度为 $L$ 的完美导电、无限薄壁的同轴结构，由一个半径为 $a$ 的内圆柱电极和一个内半径为 $b$ 的同轴外圆柱电极组成，其中 $0  a  b$。内外电极之间的空间填充了一种均匀的、有损耗的电介质材料，其特征是电导率 $\\sigma$ 和介电常数 $\\epsilon$。假设该结构在电气上足够小，可以应用静电准静态近似。推导出内电极和外电极之间的导纳 $Y$。", "solution": "在尝试求解之前，首先对问题进行验证，以确保其科学合理、提法得当且客观。\n\n### 步骤 1：提取已知条件\n-   **结构：** 完美导电、无限薄壁的同轴结构。\n-   **长度：** $L$。\n-   **半径：** 内电极半径 $a$，外电极内半径 $b$，且 $0  a  b$。\n-   **介质：** 均匀，电导率 $\\sigma$，介电常数 $\\epsilon$。\n-   **近似：** 静电准静态（EQS）。\n-   **目标：** 推导导纳 $Y$。\n\n### 步骤 2：建立坐标系并利用对称性\n由于是同轴结构，最适合使用柱坐标系 $(r, \\phi, z)$，其 $z$ 轴与圆柱体的轴线重合。由于结构的对称性，我们可以合理地假设电场 $\\mathbf{E}$ 仅具有径向分量，且仅依赖于径向距离 $r$：\n$$ \\mathbf{E} = E_r(r) \\hat{\\mathbf{r}} $$\n这一假设与 EQS 近似一致，该近似下电场是无旋的（$\\nabla \\times \\mathbf{E} = 0$）。\n\n### 步骤 3：应用高斯定律求电场\n在 EQS 中，电场由高斯定律 $\\nabla \\cdot \\mathbf{D} = \\rho_{\\text{free}}$ 决定。在两个电极之间的无源区域（$\\rho_{\\text{free}}=0$），高斯定律简化为 $\\nabla \\cdot (\\epsilon \\mathbf{E}) = 0$。对于均匀介质，这变为 $\\nabla \\cdot \\mathbf{E} = 0$。将其应用于我们的径向场，在柱坐标系中，$\\nabla \\cdot \\mathbf{E} = \\frac{1}{r} \\frac{\\partial}{\\partial r} (r E_r) = 0$。这意味着 $r E_r$ 是一个常数，我们称之为 $C_1$。因此，电场为：\n$$ E_r(r) = \\frac{C_1}{r} $$\n为了确定常数 $C_1$，我们将电场与内外电极之间的电势差 $V$ 联系起来。假设内电极电势为 $V$，外电极接地（电势为 $0$）。电势差是电场从 $a$ 到 $b$ 的线积分：\n$$ V = - \\int_{b}^{a} E_r(r) \\, dr = \\int_{a}^{b} \\frac{C_1}{r} \\, dr = C_1 [\\ln(r)]_{a}^{b} = C_1 \\ln\\left(\\frac{b}{a}\\right) $$\n求解 $C_1$ 得到 $C_1 = \\frac{V}{\\ln(b/a)}$。将此代入电场表达式：\n$$ E_r(r) = \\frac{V}{r \\ln(b/a)} $$\n\n### 步骤 4：计算总电流并推导导纳\n总电流 $I$ 是传导电流 $I_c$ 和位移电流 $I_d$ 之和。总电流密度 $\\mathbf{J}_{\\text{total}}$ 由下式给出：\n$$ \\mathbf{J}_{\\text{total}} = \\mathbf{J}_c + \\mathbf{J}_d = \\sigma \\mathbf{E} + \\frac{\\partial \\mathbf{D}}{\\partial t} $$\n对于时谐场（以 $e^{j\\omega t}$ 变化），时间导数变为乘以 $j\\omega$，因此：\n$$ \\mathbf{J}_{\\text{total}} = \\sigma \\mathbf{E} + j\\omega\\epsilon\\mathbf{E} = (\\sigma + j\\omega\\epsilon) \\mathbf{E} $$\n这个表达式可以通过引入复介电常数 $\\hat{\\epsilon} = \\epsilon - j\\sigma/\\omega$ 或复电导率 $\\hat{\\sigma} = \\sigma + j\\omega\\epsilon$ 来简化。\n\n总电流 $I$ 是总电流密度在任何一个闭合柱面上的积分。选择一个半径为 $r$ ($a  r  b$)、长度为 $L$ 的柱面，电流从内电极流向外电极：\n$$ I = \\int_A \\mathbf{J}_{\\text{total}} \\cdot d\\mathbf{A} = J_{\\text{total}}(r) \\cdot (2\\pi r L) $$\n其中 $J_{\\text{total}}(r) = (\\sigma + j\\omega\\epsilon) E_r(r)$。\n$$ I = (\\sigma + j\\omega\\epsilon) \\frac{V}{r \\ln(b/a)} \\cdot (2\\pi r L) $$\n$r$ 项被消去，表明电流在任何半径处都是恒定的，正如电荷守恒所要求的那样。\n$$ I = \\frac{2\\pi L (\\sigma + j\\omega\\epsilon)}{\\ln(b/a)} V $$\n导纳 $Y$ 定义为电流与电压之比，$Y = I/V$。因此，\n$$ Y = \\frac{2\\pi L (\\sigma + j\\omega\\epsilon)}{\\ln\\left(\\frac{b}{a}\\right)} $$\n这个结果可以分解为并联的电导 $G = \\frac{2\\pi L \\sigma}{\\ln(b/a)}$ 和电纳 $B = \\omega C$，其中电容 $C = \\frac{2\\pi L \\epsilon}{\\ln(b/a)}$。\n\n### 步骤 5：最终答案\n导纳 $Y$ 的表达式为\n$$ Y = \\frac{2\\pi L (\\sigma + j\\omega\\epsilon)}{\\ln\\left(\\frac{b}{a}\\right)} $$\n这与电路理论中并联的电阻器和电容器的导纳 $Y = G + j\\omega C$ 的形式完全一致。", "answer": "$$\\boxed{\\frac{2\\pi L (\\sigma + j\\omega\\epsilon)}{\\ln\\left(\\frac{b}{a}\\right)}}$$", "id": "3326252"}, {"introduction": "尽管解析解非常强大，但真实世界的几何结构常包含尖角，场在这些位置会变得奇异，这对数值方法构成了重大挑战。本练习深入探讨静电准静态（EQS）的计算方面，探索如何表征导体楔角附近的场奇异性。你将通过一个数值实验来量化网格细化如何影响电容等物理量的计算精度，从而为设计稳健高效的仿真提供关键的见解。[@problem_id:3326283]", "problem": "考虑麦克斯韦方程组在均匀各向同性电介质中的准静电极限，其介电常数为 $\\epsilon$，位移场由 $\\mathbf{D} = \\epsilon \\mathbf{E}$ 给出，电场满足 $\\mathbf{E} = -\\nabla V$。在没有自由电荷的区域，电势 $V$ 的控制方程是拉普拉斯方程\n$$\n\\nabla \\cdot \\left( \\epsilon \\nabla V \\right) = 0, \\quad \\text{亦即} \\quad \\nabla^2 V = 0.\n$$\n在锋利的导电电极尖端附近，电场表现出由局部楔形几何决定的角点奇点。将局部场区域建模为极坐标中的二维楔形域，其中 $r \\ge 0$ 且 $0 \\le \\theta \\le \\alpha$，$\\alpha$ 是以弧度测量的场区域的楔角。假设导体表面与 $\\theta = 0$ 和 $\\theta = \\alpha$ 处的楔形边界重合，并保持在恒定电势。令 $u(r,\\theta)$ 表示相对于该恒定值的电势（因此 $u$ 在 $\\theta=0$ 和 $\\theta=\\alpha$ 上满足齐次边界条件）。使用可分离变量法 $u(r,\\theta) = r^{\\lambda} \\Phi(\\theta)$，角向因子 $\\Phi(\\theta)$ 满足楔形特征值问题\n$$\n\\frac{d^2 \\Phi}{d \\theta^2} + \\lambda^2 \\Phi = 0,\n$$\n其边界条件由导体表面的物理特性决定。两种典型情况是：\n- 两个楔形边界均为齐次狄利克雷条件 (DD)：$u(r,0) = 0$ 和 $u(r,\\alpha) = 0$，导致 $\\Phi(0) = \\Phi(\\alpha) = 0$。\n- 一个边界为齐次狄利克雷条件，另一个为齐次诺伊曼条件 (DN)：$u(r,0) = 0$ 和 $\\partial u/\\partial \\theta \\big|_{\\theta=\\alpha} = 0$，导致 $\\Phi(0) = 0$ 和 $d\\Phi/d\\theta \\big|_{\\theta=\\alpha} = 0$。\n\n对于这些情况，决定主导奇点的最小正特征值 $\\lambda$ 为\n$$\n\\lambda_{\\mathrm{DD}} = \\frac{\\pi}{\\alpha}, \\qquad \\lambda_{\\mathrm{DN}} = \\frac{\\pi}{2\\alpha}.\n$$\n尖端附近的电场大小行为如下\n$$\n\\|\\mathbf{E}\\| \\sim r^{\\lambda - 1} \\quad \\text{当 } r \\to 0^+.\n$$\n对于单位长度电容，相关量是导体表面上累积的法向通量（单位长度电荷），其在尖端附近的主导项与线积分的尺度关系如下\n$$\nQ_{\\text{sing}} \\propto \\int_{0}^{R} r^{\\lambda - 1} \\, dr = \\frac{R^{\\lambda}}{\\lambda},\n$$\n其中 $R$ 是一个有限的径向截止长度，定义了所考虑的电极边缘范围。在计算离散化中，由角点奇点引起的电容的主要误差取决于在 $r=0$ 附近对这个奇异积分的近似程度。\n\n您的任务是量化准均匀径向离散化收敛奇异区域电容贡献所需的网格细化程度。使用复合中点法则在一个区间 $[0,R]$ 的均匀径向划分上对一个导体面上的数值通量积分进行建模，网格尺寸为 $h = R/N$（其中 $N \\ge 1$ 为整数），中点为 $r_j = (j+1/2) h$（其中 $j=0,1,\\ldots,N-1$）。考虑归一化情况，即 $R = 1$ 米，奇异被积函数为 $f(r) = r^{\\lambda - 1}$。精确积分为\n$$\nI_{\\text{exact}} = \\int_{0}^{1} r^{\\lambda - 1} \\, dr = \\frac{1}{\\lambda}.\n$$\n设 $I_N$ 为复合中点近似值，\n$$\nI_N = \\sum_{j=0}^{N-1} f\\!\\left( \\left(j+\\frac{1}{2}\\right)\\frac{1}{N} \\right) \\cdot \\frac{1}{N}.\n$$\n根据经验，对于 $\\lambda  0$，绝对误差 $|I_{\\text{exact}} - I_N|$ 在 $h$ 很小时与 $K h^{\\lambda}$ 成比例，其中 $K$ 是一个取决于 $\\lambda$ 和求积格式的常数。因此，相对误差的尺度关系为\n$$\n\\frac{|I_{\\text{exact}} - I_N|}{I_{\\text{exact}}} \\approx \\frac{K}{I_{\\text{exact}}} \\cdot h^{\\lambda}.\n$$\n给定一个目标相对容差 $\\tau$，具有 $N$ 个分段的准均匀网格必须满足\n$$\n\\frac{K}{I_{\\text{exact}}} \\cdot \\left(\\frac{1}{N}\\right)^{\\lambda} \\le \\tau \\quad \\Rightarrow \\quad N \\ge \\left( \\frac{K}{\\tau I_{\\text{exact}}} \\right)^{1/\\lambda}.\n$$\n在实践中，$K$ 不是先验已知的，但可以通过在足够精细的校准分辨率 $N_{\\mathrm{cal}}$ 下计算误差来数值校准。\n\n实现一个程序，该程序：\n1.  对于每个测试用例和边界条件类型，从楔形特征值问题计算 $\\lambda$。\n2.  使用固定的校准分辨率 $N_{\\mathrm{cal}}$，通过复合中点法则校准常数 $K$。\n3.  计算并返回所需的最小整数 $N$（均匀径向分段的数量），以使通过 $I_N$ 近似 $I_{\\text{exact}}$ 的相对误差最多为规定的容差 $\\tau$。\n\n角度单位使用弧度。距离以米为单位，单位长度电容的物理单位是法拉每米 (F/m)；但是，您只需输出数值积分精度所需的整数 $N$ 值，因此不需要输出电容值。\n\n测试套件：\n- 案例1（顺利路径，强奇点）：$\\alpha = 3\\pi/2$，边界类型 DD，$\\tau = 10^{-3}$。\n- 案例2（变边界条件，更强的奇点但容差更宽松）：$\\alpha = 3\\pi/2$，边界类型 DN，$\\tau = 5 \\times 10^{-2}$。\n- 案例3（边界情况，$\\lambda = 1$）：$\\alpha = \\pi$，边界类型 DD，$\\tau = 10^{-4}$。\n- 案例4（中等奇点）：$\\alpha = 5\\pi/4$，边界类型 DD，$\\tau = 2 \\times 10^{-3}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含每个测试用例所需的均匀径向分段数 $N$，严格按照上面列出的顺序，以逗号分隔的列表形式包含在方括号中。例如，输出必须具有以下形式\n$$\n[\\text{N}_{1},\\text{N}_{2},\\text{N}_{3},\\text{N}_{4}],\n$$\n其中每个 $\\text{N}_k$ 都是一个整数。", "solution": "该问题要求确定所需的最小均匀径向分段数 $N$，以在数值积分一个因准静电场中导电楔角附近产生的奇异函数时，达到指定的相对容差 $\\tau$。对每个测试用例，求解过程包括三个主要步骤：计算奇点指数 $\\lambda$，校准误差常数 $K$，最后计算 $N$。\n\n其物理背景是在一个二维楔形域（定义为 $r \\ge 0$ 和 $0 \\le \\theta \\le \\alpha$）中的拉普拉斯方程 $\\nabla^2 V = 0$。假设电势 $V$ 在 $\\theta = 0$ 和 $\\theta = \\alpha$ 的导体表面上是恒定的。形式为 $u(r,\\theta) = r^{\\lambda} \\Phi(\\theta)$ 的可分离变量解表明，尖端附近（$r \\to 0$）的电势行为由具有最小正特征值 $\\lambda$ 的项主导。问题指定了两种关于电势 $u$（相对于导体电势）的边界条件类型：\n1.  狄利克雷-狄利克雷 (DD)：$u(r,0) = 0$ 和 $u(r,\\alpha) = 0$。这导致最小正特征值为 $\\lambda_{\\mathrm{DD}} = \\pi/\\alpha$。\n2.  狄利克雷-诺伊曼 (DN)：$u(r,0) = 0$ 和 $\\frac{\\partial u}{\\partial \\theta}(r,\\alpha) = 0$。这导致最小正特征值为 $\\lambda_{\\mathrm{DN}} = \\pi/(2\\alpha)$。\n\n电场大小 $\\|\\mathbf{E}\\| = \\|\\nabla u\\|$ 在 $r$很小时与 $r^{\\lambda-1}$ 成比例。在径向范围为 $R$ 的电极段上的单位长度总电荷涉及对电场法向分量的积分。来自尖端附近奇点的主导贡献与场强的积分成正比。对于归一化的径向范围 $R=1$，积分的奇异部分由下式给出：\n$$\nI = \\int_{0}^{1} r^{\\lambda - 1} \\, dr\n$$\n对于 $\\lambda  0$，此积分收敛，其精确值为：\n$$\nI_{\\text{exact}} = \\left[ \\frac{r^{\\lambda}}{\\lambda} \\right]_{0}^{1} = \\frac{1}{\\lambda}\n$$\n问题要求使用复合中点法则，以 $N$ 个尺寸为 $h=1/N$ 的均匀分段来近似此积分。近似值 $I_N$ 为：\n$$\nI_N = \\sum_{j=0}^{N-1} h \\cdot f(r_j) = \\frac{1}{N} \\sum_{j=0}^{N-1} \\left( \\frac{j+1/2}{N} \\right)^{\\lambda-1}\n$$\n此近似的绝对误差 $E_N = |I_{\\text{exact}} - I_N|$ 被指出与 $E_N \\approx K h^{\\lambda} = K N^{-\\lambda}$ 成比例，其中 $K$ 是一个依赖于 $\\lambda$ 的常数。为了找到目标相对误差 $\\tau$ 所需的分段数 $N$，我们必须首先确定 $K$。这通过使用足够大的分段数 $N_{\\mathrm{cal}}$ 进行数值校准来完成。我们选择 $N_{\\mathrm{cal}} = 10^5$，这个值足够大以确保误差已进入其渐近状态。根据比例关系，$K$ 可以估计为：\n$$\nK \\approx |I_{\\text{exact}} - I_{N_{\\mathrm{cal}}}| \\cdot N_{\\mathrm{cal}}^{\\lambda}\n$$\n校准 $K$ 后，我们可以求解满足容差要求的最小 $N$：\n$$\n\\frac{|I_{\\text{exact}} - I_N|}{I_{\\text{exact}}} \\approx \\frac{K N^{-\\lambda}}{I_{\\text{exact}}} \\le \\tau\n$$\n整理以求解 $N$：\n$$\nN^{\\lambda} \\ge \\frac{K}{\\tau I_{\\text{exact}}} \\implies N \\ge \\left( \\frac{K}{\\tau I_{\\text{exact}}} \\right)^{1/\\lambda}\n$$\n由于 $N$ 必须是整数，我们取右侧表达式的向上取整。每个测试用例的总体过程如下：\n\n1.  给定楔角 $\\alpha$ 和边界条件类型（DD 或 DN），计算特征值 $\\lambda$。\n2.  如果 $\\lambda = 1$，则出现特殊情况。被积函数为 $f(r) = r^0 = 1$。复合中点法则对常数函数是精确的，意味着对于任何 $N \\ge 1$，$I_N = 1$。精确积分为 $I_{\\text{exact}} = 1/\\lambda = 1$。误差为零，因此 $K=0$。$N$ 的不等式对于任何 $N \\ge 1$ 都轻易满足。最小整数值为 $N=1$。\n3.  如果 $\\lambda \\ne 1$，则继续计算 $I_{\\text{exact}} = 1/\\lambda$。\n4.  使用 $N_{\\mathrm{cal}} = 10^5$ 的复合中点法则计算数值近似值 $I_{N_{\\mathrm{cal}}}$。\n5.  校准常数 $K = |I_{\\text{exact}} - I_{N_{\\mathrm{cal}}}| \\cdot N_{\\mathrm{cal}}^{\\lambda}$。\n6.  计算所需的最小整数 $N = \\lceil (K / (\\tau I_{\\text{exact}}))^{1/\\lambda} \\rceil$。\n\n我们将此过程应用于每个测试用例。\n\n**案例 1**: $\\alpha = 3\\pi/2$，类型 DD，$\\tau = 10^{-3}$。\n- $\\lambda = \\lambda_{\\mathrm{DD}} = \\pi / (3\\pi/2) = 2/3$。\n- $I_{\\text{exact}} = 1/\\lambda = 3/2 = 1.5$。\n- 使用数值校准计算 $K$，然后计算 $N$。\n\n**案例 2**: $\\alpha = 3\\pi/2$，类型 DN，$\\tau = 5 \\times 10^{-2}$。\n- $\\lambda = \\lambda_{\\mathrm{DN}} = \\pi / (2 \\cdot 3\\pi/2) = 1/3$。\n- $I_{\\text{exact}} = 1/\\lambda = 3$。\n- 使用数值校准计算 $K$，然后计算 $N$。\n\n**案例 3**: $\\alpha = \\pi$，类型 DD，$\\tau = 10^{-4}$。\n- $\\lambda = \\lambda_{\\mathrm{DD}} = \\pi / \\pi = 1$。\n- 这是数值积分精确的特殊情况。误差始终为零。所需的最小分段数为 $N=1$。\n\n**案例 4**: $\\alpha = 5\\pi/4$，类型 DD，$\\tau = 2 \\times 10^{-3}$。\n- $\\lambda = \\lambda_{\\mathrm{DD}} = \\pi / (5\\pi/4) = 4/5$。\n- $I_{\\text{exact}} = 1/\\lambda = 5/4 = 1.25$。\n- 使用数值校准计算 $K$，然后计算 $N$。\n\n实现将以数值方式执行这些步骤。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimum number of mesh segments required to achieve a\n    target numerical integration accuracy for a singular function arising\n    in electroquasistatics.\n    \"\"\"\n    # Calibration resolution for determining the error constant K.\n    # A sufficiently large value ensures the error is in its asymptotic regime.\n    N_cal = 100000\n\n    test_cases = [\n        # (alpha, boundary_type, tolerance)\n        (3 * np.pi / 2, \"DD\", 1e-3),\n        (3 * np.pi / 2, \"DN\", 5e-2),\n        (np.pi, \"DD\", 1e-4),\n        (5 * np.pi / 4, \"DD\", 2e-3),\n    ]\n\n    results = []\n    for alpha, bc_type, tau in test_cases:\n        # Step 1: Compute the singularity exponent lambda\n        if bc_type == \"DD\":\n            lambda_val = np.pi / alpha\n        elif bc_type == \"DN\":\n            lambda_val = np.pi / (2 * alpha)\n        else:\n            raise ValueError(\"Unknown boundary condition type\")\n\n        # Step 2: Handle the special case lambda = 1 (exact integration)\n        if np.isclose(lambda_val, 1.0):\n            # For lambda=1, the integrand is r^0=1. The composite midpoint rule\n            # is exact for constant functions, so the error is zero for any N.\n            # The problem asks for the minimal integer N = 1, which is 1.\n            N_required = 1\n            results.append(N_required)\n            continue\n\n        # Step 3: Compute exact integral for lambda != 1\n        I_exact = 1.0 / lambda_val\n\n        # Step 4: Calibrate the error constant K\n        # Composite midpoint rule implementation\n        # I_N = (1/N) * sum_{j=0}^{N-1} ((j+0.5)/N)^(lambda-1)\n        r_midpoints = (np.arange(N_cal) + 0.5) / N_cal\n        integrand_values = np.power(r_midpoints, lambda_val - 1)\n        I_cal = np.sum(integrand_values) / N_cal\n        \n        # Absolute error at calibration resolution\n        abs_error_cal = np.abs(I_exact - I_cal)\n        \n        # From error scaling E_N ~ K * N^(-lambda), we get K ~ E_N * N^(lambda)\n        K = abs_error_cal * np.power(N_cal, lambda_val)\n\n        # Step 5: Compute the required N\n        # N = (K / (tau * I_exact))**(1/lambda)\n        val = K / (tau * I_exact)\n        N_float = np.power(val, 1.0 / lambda_val)\n        \n        # N must be an integer, so we take the ceiling.\n        N_required = int(np.ceil(N_float))\n        \n        # Ensure N is at least 1, as per problem context.\n        if N_required  1:\n            N_required = 1\n\n        results.append(N_required)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3326283"}, {"introduction": "最后的这项练习处理磁准静态（MQS）中的一个经典问题：在良导体内部，当集肤效应显著时，如何对场进行建模。我们将首先推导解析的阻抗边界条件（IBC），这是一个强大的工具，它用一个简单的边界关系取代了对解析微小集肤深度的需求。然后，你将设计一个混合算法，该算法能够在一个完整的有限元模拟和高效的IBC模型之间智能切换，展示了计算电磁学中一种先进的多尺度建模技术。[@problem_id:3326242]", "problem": "考虑一个占据半空间 $x \\ge 0$ 的线性、各向同性、均匀良导体中的时谐磁准静态问题，其中所有场均以 $\\exp(i \\omega t)$ 的形式变化，且仅依赖于坐标 $x$。其基本控制方程为频域麦克斯韦方程组和欧姆定律：$\\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H}$，$\\nabla \\times \\mathbf{H} = \\mathbf{J}$，以及 $\\mathbf{J} = \\sigma \\mathbf{E}$，其中 $\\mu$ 是磁导率，$\\sigma$ 是电导率。在电导率很高的磁准静态体系中，$x=0$ 附近存在一个薄的集肤层，其厚度由感应和传导之间的平衡决定。导体内部的切向电场 $\\mathbf{E}_t(x)$ 满足一个扩散型常微分方程，而表面电流 $\\mathbf{J}_s$ 则是传导电流密度在集肤层上的积分。\n\n任务1（推导）：从上述基础出发，并将其特殊化为一个平面半空间导体，其中切向场 $\\mathbf{E}_t(x)$ 和 $\\mathbf{H}_t(x)$ 与表面相切且仅依赖于 $x$。使用内部集肤层解和外部解之间的匹配渐近展开，推导连接表面切向电场与表面电流的经典阻抗边界条件。您的推导必须根据 $i \\omega \\mu$ 和 $\\sigma$ 之间的平衡明确指出集肤深度 $\\delta$，并展示内部解如何在 $x = O(\\delta)$ 的尺度上衰减。最后，给出用 $\\sigma$、$\\mu$ 和 $\\omega$ 表示的表面阻抗 $Z_s$ 的显式形式，以及 $\\mathbf{E}_t(0)$ 和 $\\mathbf{J}_s$ 之间的关系。\n\n任务2（算法）：设计一个混合有限元法-阻抗边界条件求解器。对于一个被截断为有限计算厚度 $L$ 的一维半无限导体，该求解器能够自适应地决定：\n- 在 $[0,L]$ 上使用线性有限元求解切向电场的体扩散方程，采用狄利克雷边界条件 $\\mathbf{E}_t(0) = E_0$ 和 $\\mathbf{E}_t(L) = 0$；或者\n- 用阻抗边界条件替换体网格，并直接根据推导出的公式计算表面阻抗。\n\n该决定基于集肤深度远小于网格尺寸 $h$ 的标准。将此标准形式化如下：选择一个常数 $\\alpha0$，当 $\\delta \\le \\alpha h$ 时使用阻抗边界条件，当 $\\delta  \\alpha h$ 时使用体有限元法。在您的实现中，使用 $\\alpha = 0.5$。\n\n任务3（计算输出）：对于均匀的切向边界激励振幅 $E_0$（单位：伏特/米），将表面电流 $\\mathbf{J}_s$（单位：安培/米）定义为体电流密度 $\\mathbf{J}(x) = \\sigma \\mathbf{E}_t(x)$ 在 $x \\in [0,\\infty)$ 上的积分，并将有效表面阻抗定义为 $Z_{\\mathrm{eff}} = E_0 / J_s$（单位：欧姆-米）。当在截断域 $[0,L]$ 上使用体有限元法时，通过 $\\sigma \\int_0^L \\mathbf{E}_t(x) \\, dx$ 来近似 $\\mathbf{J}_s$，并取 $L = m_\\delta \\, \\delta$（其中 $m_\\delta$ 是一个指定的正整数），确保 $L$ 足够大以使得 $\\mathbf{E}_t(L) \\approx 0$。\n\n您的程序必须：\n- 根据 $\\sigma$、$\\mu$ 和 $\\omega$ 计算集肤深度 $\\delta$；\n- 使用上述标准在有限元法和阻抗边界条件之间进行自适应选择；\n- 如果使用有限元法，则在 $[0,L]$ 上针对方程 $- \\frac{d^2 E_t}{dx^2} + k^2 E_t = 0$（其中 $k^2 = i \\omega \\mu \\sigma$）组装并求解一维线性有限元系统，边界条件为 $E_t(0)=E_0$ 和 $E_t(L)=0$；并通过对分段线性有限元解逐个单元进行精确积分来近似 $\\int_0^L E_t(x)\\, dx$；\n- 根据所选方法计算 $Z_{\\mathrm{eff}}$；\n- 计算任务1中推导的解析表面阻抗 $Z_s$；\n- 对每个测试用例，按顺序返回两个值：一个整数方法标志（如果使用阻抗边界条件则为 $1$，如果使用有限元法则为 $0$）和一个浮点数，即相对误差 $\\left| Z_{\\mathrm{eff}} - Z_s \\right| / \\left| Z_s \\right|$。\n\n使用以下测试套件，所有量均采用国际单位制（SI）：\n- 测试用例1（强集肤效应，预期使用阻抗边界条件）：$\\sigma = 5.8 \\times 10^{7} \\,\\mathrm{S/m}$，$\\mu = \\mu_0 = 4 \\pi \\times 10^{-7} \\,\\mathrm{H/m}$，$f = 1.0 \\times 10^{4} \\,\\mathrm{Hz}$，$\\omega = 2 \\pi f \\,\\mathrm{rad/s}$，$h = 5.0 \\times 10^{-3} \\,\\mathrm{m}$，$m_\\delta = 10$，$E_0 = 1.0 \\,\\mathrm{V/m}$。\n- 测试用例2（中等集肤效应，预期使用有限元法）：$\\sigma = 5.8 \\times 10^{7} \\,\\mathrm{S/m}$，$\\mu = \\mu_0$，$f = 1.0 \\times 10^{3} \\,\\mathrm{Hz}$，$\\omega = 2 \\pi f \\,\\mathrm{rad/s}$，$h = 5.0 \\times 10^{-4} \\,\\mathrm{m}$，$m_\\delta = 10$，$E_0 = 1.0 \\,\\mathrm{V/m}$。\n- 测试用例3（标准边界，当 $\\delta \\le \\alpha h$ 时使用阻抗边界条件）：$\\sigma = 5.8 \\times 10^{7} \\,\\mathrm{S/m}$，$\\mu = \\mu_0$，$f = 1.0 \\times 10^{4} \\,\\mathrm{Hz}$，$\\omega = 2 \\pi f \\,\\mathrm{rad/s}$，$h = 1.32 \\times 10^{-3} \\,\\mathrm{m}$，$m_\\delta = 10$，$E_0 = 1.0 \\,\\mathrm{V/m}$。\n- 测试用例4（弱集肤效应，预期使用有限元法）：$\\sigma = 1.0 \\times 10^{4} \\,\\mathrm{S/m}$，$\\mu = \\mu_0$，$f = 1.0 \\times 10^{4} \\,\\mathrm{Hz}$，$\\omega = 2 \\pi f \\,\\mathrm{rad/s}$，$h = 1.0 \\times 10^{-1} \\,\\mathrm{m}$，$m_\\delta = 10$，$E_0 = 1.0 \\,\\mathrm{V/m}$。\n\n角度单位：$\\omega$ 使用弧度。\n\n物理单位：$\\mu$ 使用 $\\mathrm{H/m}$，$\\sigma$ 使用 $\\mathrm{S/m}$，$\\omega$ 使用 $\\mathrm{rad/s}$，$h$ 使用 $\\mathrm{m}$，$E_0$ 使用 $\\mathrm{V/m}$。有效表面阻抗必须以 $\\mathrm{\\Omega \\cdot m}$ 计算，相对误差是无量纲的。\n\n最终输出格式：您的程序应生成一行输出，其中包含测试用例的结果，格式为一个包含在方括号内的逗号分隔列表，顺序为 $[\\text{flag}_1,\\text{error}_1,\\text{flag}_2,\\text{error}_2,\\text{flag}_3,\\text{error}_3,\\text{flag}_4,\\text{error}_4]$，其中每个 $\\text{flag}_i$ 是 $0$ 或 $1$，每个 $\\text{error}_i$ 是一个浮点数。", "solution": "用户提供的问题已经过验证，被认为是合理且可解的。关于表面阻抗物理单位的微小不一致是一个文本错误，不影响数学公式的建立或计算任务的执行。\n\n### **第1部分：解析表面阻抗的推导**\n\n该问题考虑在一个占据半空间 $x \\ge 0$ 的良导体中的时谐磁准静态情景。切向电场 $\\mathbf{E}_t$ 假定形式为 $\\mathbf{E}_t = E_t(x) \\hat{z}$，并以 $\\exp(i\\omega t)$ 的形式变化。从频域麦克斯韦方程组 $\\nabla \\times \\mathbf{E} = -i\\omega\\mu\\mathbf{H}$ 和 $\\nabla \\times \\mathbf{H} = \\sigma\\mathbf{E}$（其中位移电流被忽略）出发，我们推导 $E_t(x)$ 的控制方程。\n\n对法拉第定律取旋度得到 $\\nabla \\times (\\nabla \\times \\mathbf{E}) = -i\\omega\\mu(\\nabla \\times \\mathbf{H})$。使用矢量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ 并代入安培定律，我们得到 $\\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E} = -i\\omega\\mu\\sigma\\mathbf{E}$。在良导体中，电荷密度可忽略不计，因此 $\\nabla \\cdot \\mathbf{E} = 0$。方程简化为 $\\nabla^2 \\mathbf{E} - i\\omega\\mu\\sigma\\mathbf{E} = 0$。\n\n对于一个仅在 $x$ 方向上变化的场 $E_t(x)$，这变成一个常微分方程：\n$$ \\frac{d^2 E_t}{dx^2} - k^2 E_t = 0 $$\n其中 $k^2 = i\\omega\\mu\\sigma$。\n\n为了找到解，我们确定复波数 $k$：\n$$ k = \\sqrt{i\\omega\\mu\\sigma} = \\sqrt{\\omega\\mu\\sigma} \\cdot \\sqrt{i} = \\sqrt{\\omega\\mu\\sigma} \\cdot e^{i\\pi/4} = \\sqrt{\\omega\\mu\\sigma} \\left(\\frac{1}{\\sqrt{2}} + i\\frac{1}{\\sqrt{2}}\\right) = \\frac{1+i}{\\delta} $$\n这里我们定义了集肤深度 $\\delta$ 为：\n$$ \\delta = \\sqrt{\\frac{2}{\\omega\\mu\\sigma}} $$\n该常微分方程的通解是 $E_t(x) = C_1 e^{kx} + C_2 e^{-kx}$。由于当 $x \\to \\infty$ 时场必须保持物理上有界，并且 $k$ 的实部为正（$1/\\delta  0$），因此必须有 $C_1 = 0$。所以解是一个指数衰减波：\n$$ E_t(x) = C_2 e^{-kx} = E_t(0) e^{-kx} = E_t(0) e^{-x/\\delta} e^{-ix/\\delta} $$\n这个表达式代表了集肤层内的“内部”解，它在 $\\delta$ 量级的空间尺度上衰减。\n\n表面电流 $J_s$（单位 A/m）是体电流密度 $J_t(x) = \\sigma E_t(x)$ 在导体深度方向上的积分：\n$$ J_s = \\int_0^\\infty J_t(x) \\,dx = \\sigma \\int_0^\\infty E_t(x) \\,dx = \\sigma \\int_0^\\infty E_t(0) e^{-kx} \\,dx $$\n$$ J_s = \\sigma E_t(0) \\left[ \\frac{e^{-kx}}{-k} \\right]_0^\\infty = \\sigma E_t(0) \\left( 0 - \\frac{1}{-k} \\right) = \\frac{\\sigma}{k} E_t(0) $$\n解析表面阻抗 $Z_s$ 是表面切向电场与总表面电流之比：\n$$ Z_s = \\frac{E_t(0)}{J_s} = \\frac{k}{\\sigma} $$\n代入 $k$ 和 $\\delta$ 的表达式：\n$$ Z_s = \\frac{1+i}{\\sigma\\delta} = \\frac{1+i}{\\sigma} \\sqrt{\\frac{\\omega\\mu\\sigma}{2}} = (1+i)\\sqrt{\\frac{\\omega\\mu}{2\\sigma}} $$\n这是良导体表面阻抗的经典公式。阻抗边界条件是关系式 $E_t(0) = Z_s J_s$。\n\n### **第2部分：混合有限元/阻抗边界条件算法**\n\n任务是实现一个自适应求解器，该求解器根据计算网格对集肤深度的解析能力，在完整数值模拟和解析阻抗模型之间进行选择。\n\n**自适应标准：**\n给定网格尺寸 $h$ 和常数 $\\alpha = 0.5$，求解器按以下方式选择方法：\n- 如果 $\\delta \\le \\alpha h$：认为集肤深度未被网格充分解析。物理导体体积被阻抗边界条件所取代。这对应于 `method_flag = 1`。\n- 如果 $\\delta  \\alpha h$：集肤深度相对于网格尺寸足够大，可以被解析。使用体有限元法（FEM）求解扩散方程。这对应于 `method_flag = 0`。\n\n**IBC方法实现（$\\delta \\le \\alpha h$）：**\n在这种情况下，有效表面阻抗 $Z_{\\mathrm{eff}}$ 取为解析表面阻抗 $Z_s$：\n$$ Z_{\\mathrm{eff}} = Z_s = (1+i)\\sqrt{\\frac{\\omega\\mu}{2\\sigma}} $$\n根据定义，相对误差为零：$|Z_{\\mathrm{eff}} - Z_s|/|Z_s| = 0$。\n\n**FEM方法实现（$\\delta  \\alpha h$）：**\n扩散方程 $-\\frac{d^2 E_t}{dx^2} + k^2 E_t = 0$ 在一个截断的一维域 $[0, L]$ 上求解。该域在长度 $L = m_\\delta \\delta$ 处被截断，其中 $m_\\delta=10$ 被选得足够大以强制执行衰减条件 $E_t(L) \\approx 0$。边界条件为 $E_t(0) = E_0$ 和 $E_t(L)=0$。\n\n通过乘以一个测试函数 $v(x)$ 并在 $[0, L]$ 上积分，可以得到边值问题的弱形式。通过分部积分，我们在一个合适的函数空间中寻找解 $E_t$，使得对于所有在边界处为零的测试函数 $v$：\n$$ \\int_0^L \\left( \\frac{dE_t}{dx} \\frac{dv}{dx} + k^2 E_t v \\right) dx = 0 $$\n区域 $[0,L]$ 被离散化为 $N = \\lceil L/h \\rceil$ 个尺寸均匀为 $h' = L/N$ 的线性有限元。未知场 $E_t(x)$ 被近似为一个分段线性函数 $E_h(x) = \\sum_{j=0}^{N} E_j \\phi_j(x)$，其中 $E_j$ 是节点值，$\\phi_j(x)$ 是标准线性“帽”状基函数。\n\n将此代入弱形式，得到一个关于节点值向量 $\\mathbf{E} = [E_0, E_1, \\dots, E_N]^T$ 的线性方程组 $\\mathbf{A} \\mathbf{E} = \\mathbf{b}$。全局矩阵 $\\mathbf{A}$ 的元素由 $A_{ij} = \\int_0^L (\\phi_i' \\phi_j' + k^2 \\phi_i \\phi_j) dx$ 给出。对于尺寸为 $h'$ 的均匀网格，连接两个节点的单元的局部单元矩阵是：\n$$ \\mathbf{K}^e = \\frac{1}{h'} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + k^2 \\frac{h'}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} $$\n组装后，全局矩阵 $\\mathbf{A}$ 是三对角的。施加狄利克雷边界条件 $E_0=E_0$ 和 $E_N=0$。这将问题简化为求解 $N-1$ 个内部节点值 $[E_1, \\dots, E_{N-1}]^T$。这会产生一个 $(N-1) \\times (N-1)$ 的三对角系统。主对角线元素为 $d_0 = \\frac{2}{h'} + k^2 \\frac{2h'}{3}$，非对角线元素为 $d_1 = -\\frac{1}{h'} + k^2 \\frac{h'}{6}$。右端向量只有一个非零项，源于 $x=0$ 处的条件：$b_1 = -d_1 E_0$。求解这个复值三对角系统以获得内部节点值。\n\n一旦知道了完整的节点值向量 $\\mathbf{E} = [E_0, E_1, \\dots, E_{N-1}, 0]^T$，表面电流 $J_s$ 就通过对分段线性有限元解进行积分来近似：\n$$ J_s \\approx \\sigma \\int_0^L E_h(x) dx = \\sigma \\sum_{j=0}^{N-1} \\frac{E_j + E_{j+1}}{2} h' $$\n然后计算有效表面阻抗为 $Z_{\\mathrm{eff}} = E_0 / J_s$。最后，计算相对于解析值 $Z_s$ 的相对误差：\n$$ \\text{误差} = \\frac{|Z_{\\mathrm{eff}} - Z_s|}{|Z_s|} $$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the hybrid FEM/IBC problem for magnetoquasistatics.\n    \"\"\"\n    # Define physical constants and problem parameters\n    MU_0 = 4 * np.pi * 1e-7  # Permeability of free space in H/m\n    ALPHA = 0.5               # Adaptive criterion constant\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (sigma, mu, f, h, m_delta, E0)\n        (5.8e7, MU_0, 1.0e4, 5.0e-3, 10, 1.0),\n        (5.8e7, MU_0, 1.0e3, 5.0e-4, 10, 1.0),\n        (5.8e7, MU_0, 1.0e4, 1.32e-3, 10, 1.0),\n        (1.0e4, MU_0, 1.0e4, 1.0e-1, 10, 1.0),\n    ]\n\n    results = []\n    for sigma, mu, f, h, m_delta, E0 in test_cases:\n        # Calculate primary physical quantities\n        omega = 2 * np.pi * f\n        \n        # Calculate skin depth\n        delta = np.sqrt(2 / (omega * mu * sigma))\n        \n        # Calculate analytical surface impedance Z_s\n        k_sq = 1j * omega * mu * sigma\n        k = np.sqrt(k_sq)\n        z_s = k / sigma\n        \n        # Apply the adaptive criterion\n        if delta = ALPHA * h:\n            # Use Impedance Boundary Condition (IBC)\n            method_flag = 1\n            z_eff = z_s\n            relative_error = 0.0\n        else:\n            # Use Finite Element Method (FEM)\n            method_flag = 0\n            \n            # --- FEM Setup ---\n            L = m_delta * delta\n            # Ensure at least one element\n            num_elements = int(np.ceil(L / h))\n            if num_elements == 0:\n                num_elements = 1\n            \n            h_prime = L / num_elements\n            num_nodes = num_elements + 1\n            num_unknowns = num_nodes - 2\n            \n            if num_unknowns = 0:\n              # Handle cases with very few elements where no internal nodes exist.\n              # This can happen if L is very small compared to h, but is unlikely\n              # with the problem parameters. We approximate the integral based on\n              # the two boundary nodes.\n              integral = (E0 + 0) / 2 * L\n            else:\n              # --- Assemble and solve the linear system for internal nodes ---\n              # Tridiagonal system A_int * E_int = b_int\n              # Main diagonal\n              d0 = (2 / h_prime) + k_sq * (2 * h_prime / 3)\n              # Off-diagonals\n              d1 = (-1 / h_prime) + k_sq * (h_prime / 6)\n              \n              # Create the banded matrix for scipy.linalg.solve_banded\n              # Shape (3, num_unknowns): [upper_diag, main_diag, lower_diag]\n              ab = np.zeros((3, num_unknowns), dtype=complex)\n              ab[0, 1:] = d1  # Upper diagonal\n              ab[1, :] = d0   # Main diagonal\n              ab[2, :-1] = d1 # Lower diagonal\n\n              # Create the right-hand side vector\n              b_int = np.zeros(num_unknowns, dtype=complex)\n              # From boundary condition E(0)=E0\n              b_int[0] = -d1 * E0\n              \n              # Solve for internal node values E_1, ..., E_{N-1}\n              e_internal = solve_banded((1, 1), ab, b_int)\n              \n              # --- Post-processing ---\n              # Reconstruct the full solution vector\n              e_solution = np.concatenate(([E0], e_internal, [0]))\n              \n              # Calculate integral of the piecewise linear solution\n              # This is the sum of trapezoidal areas for each element.\n              integral = np.sum((e_solution[:-1] + e_solution[1:]) / 2) * h_prime\n\n            # Calculate effective surface impedance\n            j_s_fem = sigma * integral\n            \n            # Handle case where j_s_fem might be zero for some reason\n            if abs(j_s_fem)  1e-15:\n                z_eff = np.inf\n            else:\n                z_eff = E0 / j_s_fem\n\n            # Calculate relative error\n            if abs(z_s) > 1e-15:\n                relative_error = np.abs(z_eff - z_s) / np.abs(z_s)\n            else:\n                # This case (z_s = 0) shouldn't happen with the given parameters\n                relative_error = np.inf if abs(z_eff) > 1e-15 else 0.0\n\n        results.extend([method_flag, relative_error])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3326242"}]}