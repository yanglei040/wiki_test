{"hands_on_practices": [{"introduction": "对任何周期性系统的分析都始于理解其倒格子。这项基础练习将指导您分析推导一个通用二维晶格的倒格子基矢和布里渊区面积，为您建立分析周期结构中波动现象所必需的数学语言，例如光子晶体和超材料。掌握这一步骤对于正确配置更高级的计算方法至关重要 ([@problem_id:3289412])。", "problem": "一个具有空间周期性介电常数 $\\,\\epsilon(\\mathbf{r})\\,$ 的二维光子晶体定义在一个斜角 Bravais 晶格上，其原胞实空间矢量为 $\\,\\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}}\\,$ 和 $\\,\\mathbf{a}_{2} = a\\big(\\cos\\theta\\,\\hat{\\mathbf{x}} + \\sin\\theta\\,\\hat{\\mathbf{y}}\\big)\\,$，其中 $\\,a  0\\,$ 为晶格常数，$\\,\\theta \\in (0,\\pi)\\,$ 是以弧度为单位的晶格角。在频域中，无源宏观 Maxwell 方程组导出矢量波动方程 $\\,\\nabla \\times \\mu^{-1}(\\mathbf{r})\\,\\nabla \\times \\mathbf{E}(\\mathbf{r}) = \\omega^{2}\\,\\epsilon(\\mathbf{r})\\,\\mathbf{E}(\\mathbf{r})\\,$，并且周期性意味着电磁场模式满足 Bloch 定理：对于任意 Bloch 波矢 $\\,\\mathbf{k}\\,$，有 $\\,\\mathbf{E}_{\\mathbf{k}}(\\mathbf{r}+\\mathbf{a}_{i}) = \\mathbf{E}_{\\mathbf{k}}(\\mathbf{r})\\,\\exp\\!\\big(i\\,\\mathbf{k}\\cdot\\mathbf{a}_{i}\\big)\\,$（对 $\\,i=1,2\\,$ 成立）。为了构建一种基于平面波展开的谱域计算方法，引入了倒易晶格矢量 $\\,\\mathbf{G}\\,$，使得傅里叶谐波 $\\,\\exp\\!\\big(i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}\\big)\\,$ 遵循晶格的周期性。\n\n从这些基础出发，并利用平面波谐波在原胞平移下的 Bloch 相位兼容性条件，推导给定斜角晶格的原胞倒易晶格矢量 $\\,\\mathbf{b}_{1}\\,$ 和 $\\,\\mathbf{b}_{2}\\,$，然后通过计算叉积 $\\,|\\mathbf{b}_{1}\\times\\mathbf{b}_{2}|\\,$ 的大小来求出第一布里渊区（定义为倒易晶格的 Wigner–Seitz 原胞）的面积。请将您的最终答案表示为以 $\\,a\\,$ 和 $\\,\\theta\\,$ 表示的单个闭式解析表达式。角度 $\\,\\theta\\,$ 以弧度为单位。面积以 $\\,\\mathrm{m}^{-2}\\,$ 为单位表示。无需进行数值代入；请提供一个精确表达式作为最终答案。", "solution": "该问题是有效的，因为它科学地基于固体物理学和计算电磁学的原理，问题提出得很好，并以客观、精确的语言表达。所有必要的信息都已提供。\n\n目标是为一个给定的二维斜角晶格推导其原胞倒易晶格矢量 $\\mathbf{b}_{1}$ 和 $\\mathbf{b}_{2}$，然后计算其第一布里渊区的面积。\n\n原胞实空间晶格矢量给定如下：\n$$ \\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}} $$\n$$ \\mathbf{a}_{2} = a\\big(\\cos\\theta\\,\\hat{\\mathbf{x}} + \\sin\\theta\\,\\hat{\\mathbf{y}}\\big) $$\n其中 $a  0$ 是晶格常数，$\\theta \\in (0, \\pi)$ 是晶格角。在笛卡尔坐标系中，这些矢量表示为：\n$$ \\mathbf{a}_{1} = \\begin{pmatrix} a \\\\ 0 \\end{pmatrix} $$\n$$ \\mathbf{a}_{2} = \\begin{pmatrix} a\\cos\\theta \\\\ a\\sin\\theta \\end{pmatrix} $$\n条件 $\\theta \\in (0, \\pi)$ 确保了 $\\sin\\theta  0$，从而保证矢量 $\\mathbf{a}_{1}$ 和 $\\mathbf{a}_{2}$ 不共线，因此构成一个有效的二维晶格基矢。\n\n原胞倒易晶格矢量 $\\mathbf{b}_{1}$ 和 $\\mathbf{b}_{2}$ 由对偶条件定义：\n$$ \\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\delta_{ij} $$\n其中 $i,j \\in \\{1, 2\\}$ 且 $\\delta_{ij}$ 是克罗内克δ符号。此条件确保了在傅里叶展开中使用的平面波基函数与晶格的周期性兼容，如问题陈述中所述。\n\n我们可以在同一笛卡尔基中表示未知的倒易矢量：\n$$ \\mathbf{b}_{1} = \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} $$\n$$ \\mathbf{b}_{2} = \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} $$\n\n现在我们通过应用从对偶条件导出的四个方程来求解 $\\mathbf{b}_{1}$ 和 $\\mathbf{b}_{2}$ 的分量：\n\n1.  $\\mathbf{a}_{1} \\cdot \\mathbf{b}_{1} = 2\\pi$：\n    $\\begin{pmatrix} a  0 \\end{pmatrix} \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} = a b_{1x} = 2\\pi \\implies b_{1x} = \\frac{2\\pi}{a}$\n\n2.  $\\mathbf{a}_{1} \\cdot \\mathbf{b}_{2} = 0$：\n    $\\begin{pmatrix} a  0 \\end{pmatrix} \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} = a b_{2x} = 0 \\implies b_{2x} = 0$\n\n3.  $\\mathbf{a}_{2} \\cdot \\mathbf{b}_{1} = 0$：\n    $\\begin{pmatrix} a\\cos\\theta  a\\sin\\theta \\end{pmatrix} \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} = (a\\cos\\theta)b_{1x} + (a\\sin\\theta)b_{1y} = 0$\n    代入 $b_{1x} = \\frac{2\\pi}{a}$：\n    $(a\\cos\\theta)\\left(\\frac{2\\pi}{a}\\right) + (a\\sin\\theta)b_{1y} = 0$\n    $2\\pi\\cos\\theta + a\\sin\\theta b_{1y} = 0$\n    $b_{1y} = -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} = -\\frac{2\\pi}{a}\\cot\\theta$\n\n4.  $\\mathbf{a}_{2} \\cdot \\mathbf{b}_{2} = 2\\pi$：\n    $\\begin{pmatrix} a\\cos\\theta  a\\sin\\theta \\end{pmatrix} \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} = (a\\cos\\theta)b_{2x} + (a\\sin\\theta)b_{2y} = 2\\pi$\n    代入 $b_{2x} = 0$：\n    $(a\\cos\\theta)(0) + (a\\sin\\theta)b_{2y} = 2\\pi$\n    $a\\sin\\theta b_{2y} = 2\\pi \\implies b_{2y} = \\frac{2\\pi}{a\\sin\\theta}$\n\n找到这些分量后，我们可以写出原胞倒易晶格矢量：\n$$ \\mathbf{b}_{1} = \\frac{2\\pi}{a}\\hat{\\mathbf{x}} - \\frac{2\\pi\\cot\\theta}{a}\\hat{\\mathbf{y}} $$\n$$ \\mathbf{b}_{2} = \\frac{2\\pi}{a\\sin\\theta}\\hat{\\mathbf{y}} $$\n\n第一布里渊区是倒易晶格的 Wigner–Seitz 原胞。倒易晶格的任何原胞（包括第一布里渊区）的面积由原胞倒易矢量的叉积的大小给出。为了计算叉积，我们将二维矢量嵌入三维空间，方法是添加一个零z分量：\n$$ \\mathbf{b}_{1} = \\left( \\frac{2\\pi}{a}, -\\frac{2\\pi\\cot\\theta}{a}, 0 \\right) = \\left( \\frac{2\\pi}{a}, -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta}, 0 \\right) $$\n$$ \\mathbf{b}_{2} = \\left( 0, \\frac{2\\pi}{a\\sin\\theta}, 0 \\right) $$\n\n叉积 $\\mathbf{b}_{1} \\times \\mathbf{b}_{2}$ 使用行列式公式计算：\n$$ \\mathbf{b}_{1} \\times \\mathbf{b}_{2} = \\det \\begin{pmatrix} \\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\ \\frac{2\\pi}{a}  -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta}  0 \\\\ 0  \\frac{2\\pi}{a\\sin\\theta}  0 \\end{pmatrix} $$\n展开行列式，我们发现 $\\hat{\\mathbf{x}}$ 和 $\\hat{\\mathbf{y}}$ 分量为零。$\\hat{\\mathbf{z}}$ 分量是：\n$$ \\mathbf{b}_{1} \\times \\mathbf{b}_{2} = \\hat{\\mathbf{z}} \\left[ \\left( \\frac{2\\pi}{a} \\right) \\left( \\frac{2\\pi}{a\\sin\\theta} \\right) - \\left( -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} \\right)(0) \\right] = \\hat{\\mathbf{z}} \\frac{4\\pi^2}{a^2\\sin\\theta} $$\n第一布里渊区的面积 $A_{BZ}$ 是该矢量的大小：\n$$ A_{BZ} = |\\mathbf{b}_{1} \\times \\mathbf{b}_{2}| = \\left| \\hat{\\mathbf{z}} \\frac{4\\pi^2}{a^2\\sin\\theta} \\right| = \\frac{4\\pi^2}{a^2|\\sin\\theta|} $$\n如前所述，角度 $\\theta$ 位于区间 $(0, \\pi)$ 内，这意味着 $\\sin\\theta  0$。因此， $|\\sin\\theta| = \\sin\\theta$。\n\n第一布里渊区面积的最终表达式为：\n$$ A_{BZ} = \\frac{4\\pi^2}{a^2\\sin\\theta} $$\n鉴于晶格常数 $a$ 具有长度单位（例如，米），面积的单位是长度的平方的倒数（$\\mathrm{m}^{-2}$），这对于倒易空间是合适的。", "answer": "$$\\boxed{\\frac{4\\pi^2}{a^2\\sin\\theta}}$$", "id": "3289412"}, {"introduction": "在建立了倒格子的概念之后，我们现在可以着手计算周期结构最重要的特性：其能带结构。这项动手实践将引导您推导并实现平面波展开（PWE）法，这是一种强大的频域工具，用于求解结构中允许存在的电磁模式。完成这项练习后，您将拥有一个可工作的代码，用于可视化周期性如何导致光子带隙的形成 ([@problem_id:3289485])。", "problem": "考虑一个二维方晶格光子晶体，其由周期性排列的圆形介质柱构成，介质柱半径为 $R$，相对介电常数为 $\\varepsilon_r$，并嵌入在相对介电常数为 $\\varepsilon_b$ 的均匀背景中。晶格常数为 $a$，且结构在面外 $z$ 方向上保持不变。分析将针对横电 (TE) 偏振进行，其中磁场仅有面外分量 $H_z$。任务是推导、实现并评估平面波展开 (PWE, Plane-Wave Expansion) 法，以计算给定布洛赫波矢下作为 $H_z$ 本征频率的能带结构。\n\n您必须从线性、无损耗、非磁性、周期性介质中具有空间变化介电常数 $\\varepsilon(\\mathbf{r})$ 的无源麦克斯韦方程组出发，并利用周期结构中场的布洛赫定理，推导晶格中 TE 模式下 $H_z(\\mathbf{r})$ 的标量波动方程，然后在截断的平面波基底下获得相应的矩阵本征值问题。推导过程必须从第一性原理开始，不得假定任何预先推导的能带结构公式。您必须明确使用 $\\varepsilon(\\mathbf{r})$ 的周期性、原胞上平面波的完备性，以及连接算子和场展开系数的傅里叶卷积结构。关键在于，对于半径为 $R$（介电常数为 $\\varepsilon_r$）的圆盘置于面积为 $A = a^2$ 的方形原胞中心，背景介电常数为 $\\varepsilon_b$ 的几何结构，您需要将算子用逆介电常数 $1/\\varepsilon(\\mathbf{r})$ 的傅里叶系数来表示。请勿引入任何特设或简化的表达式；所有步骤必须从所述的基本原理推导得出。\n\n您的程序必须使用方形晶格和由倒格矢 $\\mathbf{G} = m \\mathbf{b}_1 + n \\mathbf{b}_2$（其中 $\\mathbf{b}_1 = \\frac{2\\pi}{a} \\hat{\\mathbf{x}}$ 且 $\\mathbf{b}_2 = \\frac{2\\pi}{a} \\hat{\\mathbf{y}}$，整数索引 $m,n \\in \\{-N, \\ldots, N\\}$）构成的截断平面波基底，来实现所推导的 TE 模式 PWE 本征问题。请使用每个测试用例中提供的截断参数 $N$。对于每个测试用例，针对第一布里渊区内指定的布洛赫波矢 $\\mathbf{k}$，构建表示平面波基底下 TE 算子的厄米矩阵，求解本征值问题以获得对应于 $\\omega^2/c^2$ 的本征值，然后计算无量纲归一化频率 $\\Omega = \\frac{\\omega a}{2\\pi c}$。对于每个测试用例，返回 3 个最小的非负归一化频率，按升序排列，并四舍五入至 6 位小数。最终输出中的所有量必须是无量纲数，因此不应附加物理单位。\n\n请使用以下测试套件，每个测试用例指定为 $\\{a, R, \\varepsilon_r, \\varepsilon_b, N, \\mathbf{k}\\}$，其中 $\\mathbf{k} = (k_x, k_y)$，且每个分量都以 $\\pi/a$ 的倍数给出，以确保覆盖布里渊区的高对称点和内部点：\n\n- 测试用例 1 (正常路径内部点): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(0.35 \\cdot \\frac{\\pi}{a}, 0.0\\right)$。\n- 测试用例 2 (高对称点 $X$): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(1.0 \\cdot \\frac{\\pi}{a}, 0.0\\right)$。\n- 测试用例 3 (高对称点 $M$): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(1.0 \\cdot \\frac{\\pi}{a}, 1.0 \\cdot \\frac{\\pi}{a}\\right)$。\n- 测试用例 4 (边界情况：非常低的介电常数对比度): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 1.05$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(0.3 \\cdot \\frac{\\pi}{a}, 0.3 \\cdot \\frac{\\pi}{a}\\right)$。\n- 测试用例 5 (边界情况：零半径柱，折射率为 $n = \\sqrt{\\varepsilon_b}$ 的均匀介质): $a = 1.0$, $R = 0.0$, $\\varepsilon_r = 12.0$ (此情况下未使用), $\\varepsilon_b = 2.25$, $N = 1$, $\\mathbf{k} = \\left(0.6 \\cdot \\frac{\\pi}{a}, 0.0\\right)$。\n\n您的程序应生成单行输出，其中包含一个方括号括起的逗号分隔列表形式的结果，每个测试用例的结果本身是一个包含三个浮点数的列表，并四舍五入至 6 位小数（例如，$[\\,[0.123456,0.234567,0.345678],\\ldots\\,]$）。结果必须通过为指定参数构建并求解从第一性原理推导的 TE 模式 PWE 本征问题来计算。程序无需任何外部输入，必须完全自包含。", "solution": "该问题具有科学依据，提法明确，客观，并包含唯一解所需的所有必要信息。这是一个计算光子学中的典型问题。因此，该问题是有效的，并将提供解答。\n\n横电 (TE) 模式的平面波展开 (PWE) 法的推导始于线性、非磁性介质中的无源、时谐麦克斯韦方程组：\n$$ \\nabla \\times \\mathbf{E} = i\\omega\\mu_0 \\mathbf{H} \\quad (1) $$\n$$ \\nabla \\times \\mathbf{H} = -i\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r}) \\mathbf{E} \\quad (2) $$\n此处，$\\mathbf{E}$ 和 $\\mathbf{H}$ 是电场和磁场的复相量，$\\omega$ 是角频率，$\\varepsilon_0$ 和 $\\mu_0$ 是真空介电常数和磁导率，$\\varepsilon(\\mathbf{r})$ 是介质的位置相关相对介电常数。\n\n为获得仅用磁场 $\\mathbf{H}$ 表示的波动方程，我们对式 (2) 求解 $\\mathbf{E}$：\n$$ \\mathbf{E} = \\frac{i}{\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r})} \\nabla \\times \\mathbf{H} $$\n将此 $\\mathbf{E}$ 的表达式代入式 (1) 可得：\n$$ \\nabla \\times \\left( \\frac{i}{\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r})} \\nabla \\times \\mathbf{H} \\right) = i\\omega\\mu_0 \\mathbf{H} $$\n定义逆相对介电常数 $\\eta(\\mathbf{r}) = 1/\\varepsilon(\\mathbf{r})$，并使用真空光速 $c = 1/\\sqrt{\\varepsilon_0\\mu_0}$，我们将方程简化为关于 $\\mathbf{H}$ 的主波动方程：\n$$ \\nabla \\times \\left( \\eta(\\mathbf{r}) \\nabla \\times \\mathbf{H} \\right) = \\frac{\\omega^2}{c^2} \\mathbf{H} \\quad (3) $$\n\n对于在 $z$ 方向不变的二维结构以及 TE 偏振模式，磁场被限制在面外方向，$\\mathbf{H}(\\mathbf{r}) = H_z(x, y)\\hat{\\mathbf{z}}$，而电场则位于 $xy$ 平面内。算子 $\\nabla$ 现被视作面内梯度，$\\nabla = \\hat{\\mathbf{x}}\\frac{\\partial}{\\partial x} + \\hat{\\mathbf{y}}\\frac{\\partial}{\\partial y}$。$\\mathbf{H}$ 的旋度为：\n$$ \\nabla \\times \\mathbf{H} = \\nabla \\times (H_z \\hat{\\mathbf{z}}) = (\\nabla H_z) \\times \\hat{\\mathbf{z}} = \\frac{\\partial H_z}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial H_z}{\\partial x}\\hat{\\mathbf{y}} $$\n项 $\\eta(\\mathbf{r}) \\nabla \\times \\mathbf{H}$ 是一个面内矢量场。对其取旋度会得到一个纯粹沿 $\\hat{\\mathbf{z}}$ 方向的矢量：\n$$ \\nabla \\times (\\eta \\nabla \\times \\mathbf{H}) = \\hat{\\mathbf{z}} \\left( \\frac{\\partial}{\\partial x} \\left(-\\eta \\frac{\\partial H_z}{\\partial x} \\right) - \\frac{\\partial}{\\partial y} \\left(\\eta \\frac{\\partial H_z}{\\partial y} \\right) \\right) = - \\hat{\\mathbf{z}} \\left( \\nabla \\cdot (\\eta(\\mathbf{r}) \\nabla H_z) \\right) $$\n将此代回式 (3) 并消去两侧的单位矢量 $\\hat{\\mathbf{z}}$，我们得到 $H_z(x,y)$ 的标量波动方程：\n$$ - \\nabla \\cdot \\left( \\eta(\\mathbf{r}) \\nabla H_z(\\mathbf{r}) \\right) = \\frac{\\omega^2}{c^2} H_z(\\mathbf{r}) \\quad (4) $$\n\n光子晶体是周期性的，因此其逆介电常数 $\\eta(\\mathbf{r})$ 可以展开为关于倒格矢 $\\mathbf{G}$ 的傅里叶级数：\n$$ \\eta(\\mathbf{r}) = \\sum_{\\mathbf{G}} \\eta_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}} $$\n其中傅里叶系数由 $\\eta_{\\mathbf{G}} = \\frac{1}{A} \\int_{\\text{cell}} \\eta(\\mathbf{r}) e^{-i\\mathbf{G}\\cdot\\mathbf{r}} d\\mathbf{r}$ 给出，$A$ 是原胞的面积。\n\n根据 Bloch 定理，对于给定的布洛赫波矢 $\\mathbf{k}$，解 $H_z$ 可以写成平面波展开的形式：\n$$ H_z(\\mathbf{r}) = \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} $$\n其中 $h_{\\mathbf{G}'}$ 是展开系数。\n\n现在我们将这两个展开式代入标量波动方程 (4)。单个平面波分量的梯度为 $\\nabla e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} = i(\\mathbf{k}+\\mathbf{G}')e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}}$。\n式 (4) 的左边变为：\n$$ \\text{LHS} = - \\nabla \\cdot \\left( \\left(\\sum_{\\mathbf{G}''} \\eta_{\\mathbf{G}''} e^{i\\mathbf{G}''\\cdot\\mathbf{r}}\\right) \\nabla \\left( \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} \\right) \\right) $$\n$$ = - \\nabla \\cdot \\left( \\sum_{\\mathbf{G}'' , \\mathbf{G}'} \\eta_{\\mathbf{G}''} i(\\mathbf{k}+\\mathbf{G}') h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')\\cdot\\mathbf{r}} \\right) $$\n应用散度算子会产生另一个因子 $i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')$：\n$$ = \\sum_{\\mathbf{G}'' , \\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'') \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}''} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')\\cdot\\mathbf{r}} $$\n为了将这个双重求和转换为矩阵-向量方程，我们通过在原胞上积分并利用正交性，将其投影到单个基函数 $e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}$ 上。这等同于令原胞周期部分中 $e^{i\\mathbf{G}\\cdot\\mathbf{r}}$ 的系数相等。令总波矢为 $\\mathbf{K} = \\mathbf{k}+\\mathbf{G}$，这意味着我们设 $\\mathbf{G} = \\mathbf{G}'+\\mathbf{G}''$。代入 $\\mathbf{G}'' = \\mathbf{G}-\\mathbf{G}'$：\n$$ \\text{LHS coefficient for } e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}} = \\sum_{\\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} h_{\\mathbf{G}'} $$\n式 (4) 的右边是 $\\frac{\\omega^2}{c^2} \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}}$。其对应 $e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}$ 的系数就是 $\\frac{\\omega^2}{c^2} h_{\\mathbf{G}}$。\n令系数相等，得到每个倒格矢 $\\mathbf{G}$ 的本征值方程：\n$$ \\sum_{\\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} h_{\\mathbf{G}'} = \\frac{\\omega^2}{c^2} h_{\\mathbf{G}} $$\n这是一个标准的矩阵本征值问题，$M\\mathbf{h} = \\lambda \\mathbf{h}$，其中向量 $\\mathbf{h}$ 包含系数 $h_{\\mathbf{G}}$，本征值为 $\\lambda = \\omega^2/c^2$，矩阵元素为：\n$$ M_{\\mathbf{G},\\mathbf{G}'} = |\\mathbf{k}+\\mathbf{G}| |\\mathbf{k}+\\mathbf{G}'| \\cos(\\theta_{\\mathbf{G},\\mathbf{G}'}) \\eta_{\\mathbf{G}-\\mathbf{G}'} = (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} $$\n\n对于指定的几何结构（在常数为 $a$ 的方晶格上，半径为 $R$、介电常数为 $\\varepsilon_r$ 的圆形柱体，背景介电常数为 $\\varepsilon_b$），$\\eta(\\mathbf{r})$ 在柱内为 $1/\\varepsilon_r$，在柱外为 $1/\\varepsilon_b$。原胞面积为 $A = a^2$。傅里叶系数 $\\eta_{\\mathbf{G}}$ 计算如下。\n对于 $\\mathbf{G} = \\mathbf{0}$：\n$$ \\eta_{\\mathbf{0}} = \\frac{1}{A} \\left( \\frac{1}{\\varepsilon_r} (\\pi R^2) + \\frac{1}{\\varepsilon_b} (a^2 - \\pi R^2) \\right) = f \\frac{1}{\\varepsilon_r} + (1-f) \\frac{1}{\\varepsilon_b} $$\n其中 $f = \\pi R^2/a^2$ 是填充因子。\n对于 $\\mathbf{G} \\ne \\mathbf{0}$，且 $G = |\\mathbf{G}|$：\n$$ \\eta_{\\mathbf{G}} = \\frac{1}{A} \\left( \\frac{1}{\\varepsilon_r} - \\frac{1}{\\varepsilon_b} \\right) \\int_{|\\mathbf{r}| \\le R} e^{-i\\mathbf{G}\\cdot\\mathbf{r}} d\\mathbf{r} = \\left( \\frac{1}{\\varepsilon_r} - \\frac{1}{\\varepsilon_b} \\right) f \\frac{2J_1(GR)}{GR} $$\n其中 $J_1$ 是一阶第一类贝塞尔函数。\n\n计算步骤如下：\n1. 为选定的截断 $m, n \\in \\{-N, \\dots, N\\}$ 定义倒格矢 $\\mathbf{G} = m \\mathbf{b}_1 + n \\mathbf{b}_2$。\n2. 计算傅里叶系数矩阵 $\\eta_{\\mathbf{G}-\\mathbf{G}'}$。\n3. 构建厄米矩阵 $M_{\\mathbf{G},\\mathbf{G}'}$。\n4. 求解本征值问题以找到本征值 $\\lambda_i = (\\omega_i/c)^2$。\n5. 计算归一化频率 $\\Omega_i = \\frac{\\omega_i a}{2\\pi c} = \\frac{a\\sqrt{\\lambda_i}}{2\\pi}$。\n\n对于指定的测试用例，该过程在以下代码中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j1\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to solve the PWE problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # a, R_factor, eps_r, eps_b, N, kx_factor, ky_factor\n        (1.0, 0.2, 12.0, 1.0, 1, 0.35, 0.0), # case 1\n        (1.0, 0.2, 12.0, 1.0, 1, 1.0, 0.0),  # case 2\n        (1.0, 0.2, 12.0, 1.0, 1, 1.0, 1.0),  # case 3\n        (1.0, 0.2, 1.05, 1.0, 1, 0.3, 0.3),  # case 4\n        (1.0, 0.0, 12.0, 2.25, 1, 0.6, 0.0), # case 5\n    ]\n\n    all_results = []\n    for case in test_cases:\n        a, R_factor, eps_r, eps_b, N, kx_factor, ky_factor = case\n        R = R_factor * a\n        # k vector components are given as multiples of pi/a\n        kx = kx_factor * np.pi / a\n        ky = ky_factor * np.pi / a\n        \n        frequencies = calculate_bands(a, R, eps_r, eps_b, N, kx, ky)\n        rounded_frequencies = [round(f, 6) for f in frequencies]\n        all_results.append(rounded_frequencies)\n\n    # Final print statement in the exact required format.\n    # The str() on a list gives a representation with spaces, e.g., '[0.1, 0.2]'.\n    # This is fine as the problem example also shows this.\n    # Using repr() could be an alternative for more compact string. But str() is more standard.\n    # To be extremely precise with formatting and remove spaces:\n    formatted_results = []\n    for res_list in all_results:\n        res_str = '[' + ','.join([f\"{x:.6f}\" for x in res_list]) + ']'\n        formatted_results.append(res_str)\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef calculate_bands(a, R, eps_r, eps_b, N, kx, ky):\n    \"\"\"\n    Calculates the band structure for a 2D photonic crystal using PWE.\n\n    Args:\n        a (float): Lattice constant.\n        R (float): Radius of the dielectric rods.\n        eps_r (float): Relative permittivity of the rods.\n        eps_b (float): Relative permittivity of the background.\n        N (int): Truncation parameter for the plane-wave basis.\n        kx (float): x-component of the Bloch wave vector.\n        ky (float): y-component of the Bloch wave vector.\n\n    Returns:\n        list: The 3 smallest non-negative normalized frequencies.\n    \"\"\"\n    # 1. Generate reciprocal lattice vectors for the basis\n    basis_indices = []\n    for m in range(-N, N + 1):\n        for n in range(-N, N + 1):\n            basis_indices.append((m, n))\n    \n    num_plane_waves = len(basis_indices)\n\n    # 2. Compute Fourier coefficients of the inverse permittivity eta(r) = 1/eps(r)\n    # The matrix M requires eta(G-G'), so we need G-G' where G, G' are basis vectors.\n    # The maximum indices for m and n in G-G' are +/- 2N.\n    max_idx = 2 * N\n    eta_coeffs = np.zeros((2 * max_idx + 1, 2 * max_idx + 1), dtype=float)\n\n    f = np.pi * (R/a)**2\n    inv_eps_r = 1.0 / eps_r\n    inv_eps_b = 1.0 / eps_b\n    delta_inv_eps = inv_eps_r - inv_eps_b\n\n    for m_diff in range(-max_idx, max_idx + 1):\n        for n_diff in range(-max_idx, max_idx + 1):\n            if m_diff == 0 and n_diff == 0:\n                eta = f * inv_eps_r + (1 - f) * inv_eps_b\n            else:\n                G_mag = (2 * np.pi / a) * np.sqrt(m_diff**2 + n_diff**2)\n                arg = G_mag * R\n                # The limit of 2*j1(x)/x as x-0 is 1. j1(0)=0 so handle explicitly.\n                if np.isclose(arg, 0.0):\n                    bessel_term = 1.0\n                else:\n                    bessel_term = 2 * j1(arg) / arg\n                \n                eta = delta_inv_eps * f * bessel_term\n            \n            eta_coeffs[m_diff + max_idx, n_diff + max_idx] = eta\n\n    # 3. Assemble the Hermitian matrix M\n    M = np.zeros((num_plane_waves, num_plane_waves), dtype=np.float64)\n    k_vec = np.array([kx, ky])\n    \n    # Pre-compute G and K=k+G vectors\n    b1 = np.array([2 * np.pi / a, 0.0])\n    b2 = np.array([0.0, 2 * np.pi / a])\n    G_vectors = [m * b1 + n * b2 for m, n in basis_indices]\n    K_vectors = [k_vec + G for G in G_vectors]\n\n    for i, (m_i, n_i) in enumerate(basis_indices):\n        for j, (m_j, n_j) in enumerate(basis_indices):\n            m_diff = m_i - m_j\n            n_diff = n_i - n_j\n            \n            eta_val = eta_coeffs[m_diff + max_idx, n_diff + max_idx]\n            \n            K_i = K_vectors[i]\n            K_j = K_vectors[j]\n            \n            dot_product = np.dot(K_i, K_j)\n            M[i, j] = dot_product * eta_val\n\n    # 4. Solve the eigenvalue problem\n    # eigh is for Hermitian matrices and returns sorted eigenvalues\n    eigenvalues = eigh(M, eigvals_only=True)\n\n    # 5. Calculate normalized frequencies\n    # Omega = (omega * a) / (2 * pi * c)\n    # Eigenvalues are lambda = (omega/c)^2\n    # So Omega = (a / (2*pi)) * sqrt(lambda)\n    \n    # Filter for non-negative eigenvalues and calculate frequencies\n    omegas = []\n    for eig in eigenvalues:\n        if eig = -1e-9: # Use a small tolerance for numerical noise\n            freq = (a / (2.0 * np.pi)) * np.sqrt(max(0, eig))\n            omegas.append(freq)\n\n    # Return the 3 smallest frequencies, which will be the first 3 due to sorting by eigh\n    return omegas[:3]\n\n\nsolve()\n\n```", "id": "3289485"}, {"introduction": "尽管像PWE这样的频域方法非常适合寻找本征模式，但时域仿真为我们提供了观察波传播的补充视角。本实践深入探讨了时域有限差分（FDTD）法，并聚焦于其数值精度的关键方面：色散误差。通过推导和量化周期性边界条件下波的数值色散，您将对FDTD仿真的局限性获得关键的洞察，并学会如何评估其可靠性 ([@problem_id:3289443])。", "problem": "你需要推导、实现并验证在真空中斜入射平面波条件下，采用布洛赫-弗洛凯 (Bloch–Floquet) 周期性边界条件的二维时域有限差分 (FDTD) 方法的数值色散关系。从真空中的宏观麦克斯韦旋度方程、本构关系、标准的时空交错 Yee 网格离散以及布洛赫-弗洛凯 (Bloch–Floquet) 定理出发。利用这些来获得离散角频率 $\\,\\omega_{\\mathrm{num}}\\,$、波矢分量 $\\,k_x\\,$ 和 $\\,k_y\\,$、网格间距 $\\,\\Delta x\\,$ 和 $\\,\\Delta y\\,$ 以及时间步长 $\\,\\Delta t\\,$ 之间的关系。布洛赫-弗洛凯 (Bloch–Floquet) 周期性边界条件意味着形式为 $\\,\\mathrm{e}^{\\mathrm{j}(k_x x + k_y y - \\omega t)}\\,$ 的平面波解在任意晶格矢量平移下保持一致（仅相差一个相位因子）。对于给定的斜入射角 $\\,\\theta\\,$（以弧度为单位），其连续空间分量满足 $\\,k_x = k_0 \\cos\\theta\\,$ 和 $\\,k_y = k_0 \\sin\\theta\\,$，其中 $\\,k_0 = \\omega/c\\,$，$\\,c\\,$ 是真空中的光速。避免使用任何未说明或黑箱公式；推导过程必须从这些基本原理出发。\n\n将二维 Yee 格式的 Courant 数 $\\,S\\,$ 定义为 $\\,S = c\\,\\Delta t\\,\\sqrt{\\Delta x^{-2} + \\Delta y^{-2}}\\,,$ 其显式稳定性要求为 $\\,0  S \\leq 1\\,$. 对于每个测试用例，你将获得频率 $\\,f\\,$（单位赫兹）、入射角 $\\,\\theta\\,$（单位弧度）、沿 $\\,x\\,$ 方向每个自由空间波长内的网格点数 $\\,N_x\\,$（因此 $\\,\\Delta x = \\lambda_0 / N_x\\,$，其中 $\\,\\lambda_0 = c/f\\,$）、网格各向异性比 $\\,r = \\Delta x / \\Delta y\\,$（因此 $\\,\\Delta y = \\Delta x / r\\,$）以及 Courant 数 $\\,S\\,$。根据这些参数，计算 $\\,\\Delta x\\,$、$\\,\\Delta y\\,$ 和 $\\,\\Delta t\\,$，然后确定在给定的 $\\,k_x\\,$ 和 $\\,k_y\\,$ 下，由具有布洛赫-弗洛凯 (Bloch–Floquet) 周期性的真空 FDTD 离散色散关系所蕴含的数值角频率 $\\,\\omega_{\\mathrm{num}}\\,$。将 $\\,\\omega_{\\mathrm{num}}\\,$ 与连续空间角频率 $\\,\\omega = 2\\pi f\\,$ 进行比较，并报告无量纲的有符号相对相速误差 $\\,\\varepsilon = \\omega_{\\mathrm{num}}/\\omega - 1\\,$。所有角度均以弧度处理，所有长度以米为单位，所有时间以秒为单位，所有频率以赫兹为单位。最终答案必须是无量纲数。\n\n你的程序必须实现上述逻辑，并为以下参数值的测试套件生成误差：\n\n- 情况 $\\,1\\,$ (理想情况，方形网格): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.35\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 1.0\\,$, $\\,S = 0.8\\,$.\n- 情况 $\\,2\\,$ (各向异性网格，波和 S 值相同): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.35\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 2.0\\,$, $\\,S = 0.8\\,$.\n- 情况 $\\,3\\,$ (接近 Courant 极限，方形网格): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.35\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 1.0\\,$, $\\,S = 0.99\\,$.\n- 情况 $\\,4\\,$ (掠射式入射且强各向异性): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 1.4\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 0.5\\,$, $\\,S = 0.6\\,$.\n- 情况 $\\,5\\,$ (沿轴传播，方形网格): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.0\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 1.0\\,$, $\\,S = 0.8\\,$.\n- 情况 $\\,6\\,$ (粗网格分辨率和低 Courant 数，斜入射): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = \\pi/4\\,\\mathrm{rad}\\,$, $\\,N_x = 8\\,$, $\\,r = 1.5\\,$, $\\,S = 0.2\\,$.\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个数字必须是对应情况下的有符号相对误差 $\\,\\varepsilon\\,$，并精确到 $\\,8\\,$ 位小数，例如 $\\,[-0.00123456,0.00000078,\\dots]\\,$。", "solution": "该问题要求推导和实现采用布洛赫-弗洛凯 (Bloch–Floquet) 周期性的二维时域有限差分 (FDTD) 方法的数值色散关系。该分析使我们能够量化 FDTD 算法中固有的、作为网格参数和波传播方向函数的相误差。推导始于真空中的麦克斯韦方程，然后通过在交错 Yee 网格上应用有限差分近似来进行。\n\n我们考虑横磁 (TM_z) 波偏振，其中电场仅有 $z$ 分量 ($E_z$)，磁场位于 $x-y$ 平面 ($\\vec{H} = H_x \\hat{x} + H_y \\hat{y}$)。对横电 (TE_z) 情况的分析会得到相同的色散关系，因此该选择不失一般性。在无源真空 ($\\vec{J}=0$, $\\rho=0$) 中，麦克斯韦旋度方程为：\n$$ \\nabla \\times \\vec{E} = -\\mu_0 \\frac{\\partial \\vec{H}}{\\partial t} $$\n$$ \\nabla \\times \\vec{H} = \\epsilon_0 \\frac{\\partial \\vec{E}}{\\partial t} $$\n对于 TM_z 模式，这些矢量方程分解为三个标量方程：\n$$ \\frac{\\partial E_z}{\\partial y} = -\\mu_0 \\frac{\\partial H_x}{\\partial t} \\quad (1) $$\n$$ \\frac{\\partial E_z}{\\partial x} = \\mu_0 \\frac{\\partial H_y}{\\partial t} \\quad (2) $$\n$$ \\frac{\\partial H_y}{\\partial x} - \\frac{\\partial H_x}{\\partial y} = \\epsilon_0 \\frac{\\partial E_z}{\\partial t} \\quad (3) $$\n\n在 FDTD 方法中，空间和时间被离散化为 $x = i\\Delta x$、$y = j\\Delta y$ 和 $t = n\\Delta t$，其中 $i, j, n$ 为整数。在离散点上的场分量 $F$ 表示为 $F(i, j, n)$。场分量排列在交错的 Yee 单元上：$E_z$ 在整数网格点 $(i, j, n)$ 处计算，$H_x$ 在 $(i, j+1/2, n+1/2)$ 处计算，$H_y$ 在 $(i+1/2, j, n+1/2)$ 处计算。对式 (1-3) 应用中心有限差分，得到 FDTD 更新方程：\n\n$$ \\epsilon_0 \\frac{E_z(i,j,n+1) - E_z(i,j,n)}{\\Delta t} = \\frac{H_y(i+1/2,j,n+1/2) - H_y(i-1/2,j,n+1/2)}{\\Delta x} - \\frac{H_x(i,j+1/2,n+1/2) - H_x(i,j-1/2,n+1/2)}{\\Delta y} $$\n$$ \\mu_0 \\frac{H_x(i,j+1/2,n+1/2) - H_x(i,j+1/2,n-1/2)}{\\Delta t} = -\\frac{E_z(i,j+1,n) - E_z(i,j,n)}{\\Delta y} $$\n$$ \\mu_0 \\frac{H_y(i+1/2,j,n+1/2) - H_y(i+1/2,j,n-1/2)}{\\Delta t} = \\frac{E_z(i+1,j,n) - E_z(i,j,n)}{\\Delta x} $$\n\n为了推导数值色散关系，我们将一个离散平面波解（离散系统的本征模）代入这些方程。这与周期性系统（即网格本身）的布洛赫-弗洛凯 (Bloch–Floquet) 定理是一致的。一个通用的场分量 $F$ 假定具有以下形式：\n$$ F(i\\Delta x, j\\Delta y, n\\Delta t) = F_0 e^{j(k_x i\\Delta x + k_y j\\Delta y - \\omega_{\\mathrm{num}} n\\Delta t)} $$\n其中 $F_0$ 是复振幅，$k_x$ 和 $k_y$ 是波矢分量，而 $\\omega_{\\mathrm{num}}$ 是我们希望确定的数值角频率。\n\n应用此假设，形如 $F(i+1/2) - F(i-1/2)$ 的有限差分变为：\n$$ F_0 e^{j(k_x(i+1/2)\\Delta x)} - F_0 e^{j(k_x(i-1/2)\\Delta x)} = F_0 e^{j k_x i \\Delta x} (e^{j k_x \\Delta x/2} - e^{-j k_x \\Delta x/2}) = 2j \\sin\\left(\\frac{k_x \\Delta x}{2}\\right) F_0 e^{j k_x i \\Delta x} $$\n将此原理应用于所有空间和时间差分，FDTD 方程转换为关于复振幅 $E_{z0}$、$H_{x0}$、$H_{y0}$ 的代数方程组：\n\n$$ \\epsilon_0 \\frac{-2j\\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})}{\\Delta t} E_{z0} = \\frac{2j\\sin(\\frac{k_x\\Delta x}{2})}{\\Delta x} H_{y0} - \\frac{2j\\sin(\\frac{k_y\\Delta y}{2})}{\\Delta y} H_{x0} $$\n$$ \\mu_0 \\frac{-2j\\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})}{\\Delta t} H_{x0} = -\\frac{2j\\sin(\\frac{k_y\\Delta y}{2})}{\\Delta y} E_{z0} $$\n$$ \\mu_0 \\frac{-2j\\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})}{\\Delta t} H_{y0} = \\frac{2j\\sin(\\frac{k_x\\Delta x}{2})}{\\Delta x} E_{z0} $$\n\n消去公因子 $2j$ 并化简后，我们可以从第二个和第三个方程中用 $E_{z0}$ 表示 $H_{x0}$ 和 $H_{y0}$：\n$$ H_{x0} = \\frac{\\Delta t \\sin(\\frac{k_y\\Delta y}{2})}{\\mu_0 \\Delta y \\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})} E_{z0} $$\n$$ H_{y0} = -\\frac{\\Delta t \\sin(\\frac{k_x\\Delta x}{2})}{\\mu_0 \\Delta x \\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})} E_{z0} $$\n\n将这些表达式代回第一个方程并消去非零振幅 $E_{z0}$，得到：\n$$ -\\frac{\\epsilon_0}{\\Delta t}\\sin\\left(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2}\\right) = -\\frac{\\Delta t}{\\mu_0 \\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})} \\left[ \\left(\\frac{\\sin(\\frac{k_x\\Delta x}{2})}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(\\frac{k_y\\Delta y}{2})}{\\Delta y}\\right)^2 \\right] $$\n\n整理并使用真空波速关系 $c = 1/\\sqrt{\\epsilon_0\\mu_0}$，我们得到二维 FDTD 方法的数值色散关系：\n$$ \\left[\\frac{1}{c\\Delta t}\\sin\\left(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2}\\right)\\right]^2 = \\left[\\frac{\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)}{\\Delta x}\\right]^2 + \\left[\\frac{\\sin\\left(\\frac{k_y\\Delta y}{2}\\right)}{\\Delta y}\\right]^2 $$\n\n为了计算数值角频率 $\\omega_{\\mathrm{num}}$，我们求解此方程得到：\n$$ \\omega_{\\mathrm{num}} = \\frac{2}{\\Delta t} \\arcsin\\left( c\\Delta t \\sqrt{\\left[\\frac{\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)}{\\Delta x}\\right]^2 + \\left[\\frac{\\sin\\left(\\frac{k_y\\Delta y}{2}\\right)}{\\Delta y}\\right]^2} \\right) $$\n\n$\\arcsin$ 函数的自变量与 Courant 数 $S$ 相关。Courant 稳定性条件 $S \\leq 1$ 确保了该自变量不超过 $1$，从而保证 $\\omega_{\\mathrm{num}}$ 有实数解。\n\n每个测试用例的计算步骤如下：\n1.  给定 $f, \\theta, N_x, r, S$，首先计算连续空间参数：$\\omega = 2\\pi f$、$\\lambda_0 = c/f$、 $k_0 = \\omega/c$、 $k_x = k_0\\cos\\theta$ 和 $k_y = k_0\\sin\\theta$。\n2.  接下来，确定网格参数：$\\Delta x = \\lambda_0/N_x$、 $\\Delta y = \\Delta x / r$。\n3.  时间步长 $\\Delta t$ 通过重新整理 Courant 数的定义 $S = c\\Delta t\\sqrt{\\Delta x^{-2} + \\Delta y^{-2}}$ 来计算：\n    $$ \\Delta t = \\frac{S}{c\\sqrt{\\Delta x^{-2} + \\Delta y^{-2}}} $$\n4.  将这些值代入推导出的 $\\omega_{\\mathrm{num}}$ 方程中。\n5.  最后，计算有符号相对相速误差 $\\varepsilon = \\omega_{\\mathrm{num}}/\\omega - 1$。该值量化了数值色散，负值表示对于给定的波矢，数值波速低于物理光速。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Derives and validates the numerical dispersion relation of the 2D FDTD method\n    with Bloch-Floquet PBCs for oblique plane-wave incidence in vacuum.\n    \"\"\"\n    # Use the speed of light from scipy.constants for precision\n    c = constants.c\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (f, theta, N_x, r, S)\n    test_cases = [\n        (10e9, 0.35, 20, 1.0, 0.8),         # Case 1\n        (10e9, 0.35, 20, 2.0, 0.8),         # Case 2\n        (10e9, 0.35, 20, 1.0, 0.99),        # Case 3\n        (10e9, 1.4, 20, 0.5, 0.6),          # Case 4\n        (10e9, 0.0, 20, 1.0, 0.8),          # Case 5\n        (10e9, np.pi/4, 8, 1.5, 0.2),       # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        f, theta_rad, Nx, r, S = case\n\n        # Step 1: Calculate continuous-space parameters\n        omega = 2 * np.pi * f\n        lambda0 = c / f\n        k0 = omega / c\n        kx = k0 * np.cos(theta_rad)\n        ky = k0 * np.sin(theta_rad)\n\n        # Step 2: Calculate grid parameters\n        dx = lambda0 / Nx\n        dy = dx / r\n        \n        # Step 3: Calculate time step from the Courant number definition\n        dt = S / (c * np.sqrt(dx**-2 + dy**-2))\n\n        # Step 4: Calculate the numerical angular frequency (omega_num)\n        # using the derived dispersion relation.\n        term_x_sq = (np.sin(kx * dx / 2.0) / dx)**2\n        term_y_sq = (np.sin(ky * dy / 2.0) / dy)**2\n\n        arg_arcsin = c * dt * np.sqrt(term_x_sq + term_y_sq)\n        \n        # The stability condition S = 1 should ensure arg_arcsin = 1.\n        # Floating point inaccuracies might cause it to be slightly  1.\n        # We clamp it to 1.0 to prevent a domain error in np.arcsin.\n        if arg_arcsin  1.0:\n            arg_arcsin = 1.0\n\n        omega_num = (2.0 / dt) * np.arcsin(arg_arcsin)\n\n        # Step 5: Calculate the signed relative phase-velocity error\n        relative_error = (omega_num / omega) - 1.0\n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    # Each result is formatted to 8 decimal places.\n    formatted_results = [f\"{res:.8f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3289443"}]}