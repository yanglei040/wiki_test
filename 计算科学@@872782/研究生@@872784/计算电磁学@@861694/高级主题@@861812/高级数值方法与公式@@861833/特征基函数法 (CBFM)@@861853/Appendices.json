{"hands_on_practices": [{"introduction": "特征基函数方法（CBFM）的核心优势在于其能够显著降低大规模电磁问题的计算成本。本练习旨在将这一优势具体化。通过一个实际的算例，我们将亲手计算未知量数量的缩减率以及由此带来的存储需求下降，从而直观地理解CBFM在解决大型问题时所体现出的巨大潜力。[@problem_id:3292505]", "problem": "一个理想电导体散射体采用矩量法 (MoM) 和 Rao–Wilton–Glisson (RWG) 基函数进行建模，生成一个稠密阻抗矩阵 $\\mathbf{Z}\\in\\mathbb{C}^{N\\times N}$，其中未知数数量为 $N=6.4\\times 10^{4}$。在稠密存储假设下，存储 $\\mathbf{Z}$ 所需的内存与其元素数量成正比。该散射体被划分为 $P=16$ 个连续的子域，并应用特征基函数法 (CBFM)，在每个子域 $p\\in\\{1,\\dots,16\\}$ 上构造 $M_p$ 个特征基函数，其数量为\n$$\nM_1=160,\\;M_2=180,\\;M_3=190,\\;M_4=200,\\;M_5=210,\\;M_6=220,\\;M_7=190,\\;M_8=230,\\\\\nM_9=210,\\;M_{10}=170,\\;M_{11}=200,\\;M_{12}=180,\\;M_{13}=220,\\;M_{14}=210,\\;M_{15}=190,\\;M_{16}=240.\n$$\n令 $M=\\sum_{p=1}^{16} M_p$ 表示特征基函数的总数，这样降阶后的 CBFM 耦合矩阵为 $\\mathbf{Z}_c\\in\\mathbb{C}^{M\\times M}$ 并且也是稠密的。仅使用以下基本原理：(i) 大小为 $n\\times n$ 的稠密矩阵的存储量与 $n^2$ 成比例；(ii) CBFM 用总数为 $M$ 的降阶宏基函数集替换了原始的 RWG 基。请计算缩减比 $r$（定义为特征基函数总数除以原始未知数数量），并估计在稠密存储假设下，通过存储 $\\mathbf{Z}_c$ 而不是 $\\mathbf{Z}$ 所获得的内存节省分数。将这两个量表示为小数，并将您的答案四舍五入到四位有效数字。将您的最终结果以行矩阵 $\\begin{pmatrix} r & \\text{memory\\_savings} \\end{pmatrix}$ 的形式给出，不带单位。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上是合理的，问题提法是适定的，并包含推导唯一解所需的所有必要信息。其背景和参数与计算电磁学中关于矩量法 (MoM) 和特征基函数法 (CBFM) 应用的标准实践一致。\n\n第一步是计算特征基函数 (CBF) 的总数，用 $M$ 表示。这是在 $P=16$ 个子域上构建的 CBF 的总和。\n$$\nM = \\sum_{p=1}^{16} M_p\n$$\n代入给定的 $M_p$ 值：\n$$\nM = 160 + 180 + 190 + 200 + 210 + 220 + 190 + 230 + 210 + 170 + 200 + 180 + 220 + 210 + 190 + 240\n$$\n将这些值相加得到：\n$$\nM = 3200\n$$\n问题将缩减比 $r$ 定义为特征基函数的总数除以原始未知数的数量。原始未知数的数量给定为 $N = 6.4 \\times 10^{4} = 64000$。\n$$\nr = \\frac{M}{N}\n$$\n代入 $M$ 和 $N$ 的值：\n$$\nr = \\frac{3200}{64000} = \\frac{32}{640} = \\frac{1}{20} = 0.05\n$$\n问题要求将此值表示为小数，并四舍五入到四位有效数字。\n$$\nr \\approx 0.05000\n$$\n接下来，我们估计内存节省分数。问题指出，对于一个大小为 $n \\times n$ 的稠密矩阵，其存储所需内存与 $n^2$ 成比例。设存储一个稠密的 $k \\times k$ 复数矩阵所需的内存为 $C \\cdot k^2$，其中 $C$ 是一个与每个复数元素的存储成本相关的比例常数。\n\n存储原始稠密阻抗矩阵 $\\mathbf{Z} \\in \\mathbb{C}^{N \\times N}$ 所需的内存为：\n$$\n\\text{Mem}_{\\mathbf{Z}} = C \\cdot N^2\n$$\n存储降阶后的稠密 CBFM 耦合矩阵 $\\mathbf{Z}_c \\in \\mathbb{C}^{M \\times M}$ 所需的内存为：\n$$\n\\text{Mem}_{\\mathbf{Z}_c} = C \\cdot M^2\n$$\n内存节省分数，我们用 $S$ 表示，是相对于原始内存需求的内存减少量。\n$$\nS = \\frac{\\text{Mem}_{\\mathbf{Z}} - \\text{Mem}_{\\mathbf{Z}_c}}{\\text{Mem}_{\\mathbf{Z}}} = \\frac{C N^2 - C M^2}{C N^2} = 1 - \\frac{M^2}{N^2}\n$$\n这个表达式可以重写为缩减比 $r = \\frac{M}{N}$ 的形式：\n$$\nS = 1 - \\left(\\frac{M}{N}\\right)^2 = 1 - r^2\n$$\n代入计算出的 $r=0.05$ 的值：\n$$\nS = 1 - (0.05)^2 = 1 - 0.0025 = 0.9975\n$$\n这个值已经用四位有效数字表示。\n\n最终答案要求将缩减比 $r$ 和内存节省分数 $S$ 以行矩阵的形式呈现。所需的值是 $r \\approx 0.05000$ 和 $S = 0.9975$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.05000 & 0.9975 \\end{pmatrix}}\n$$", "id": "3292505"}, {"introduction": "理解了CBFM的“为何”之后，我们来探索其“如何”实现。降阶并非魔法，而是基于一个严谨的数学过程——伽辽金投影（Galerkin projection）。本练习将引导我们从第一性原理出发，推导并应用核心的变换关系 $Z_r = T^H Z T$，将一个高维矩陣算子投影到由特征基函数张成的低维子空间中，从而构建出紧凑的降阶系统。[@problem_id:3292539]", "problem": "一个理想电导体表面被划分为两个相邻的子域，每个子域用三个 Rao–Wilton–Glisson (RWG) 基函数进行网格剖分。未知的表面电流密度用这六个 RWG 函数展开，并在电场积分方程 (EFIE) 的矩量法 (MoM) 离散化中进行测试。通过将 EFIE 算子投影到两个复合特征基函数（每个子域一个）上，使用特征基函数法 (CBFM) 形成一个降阶模型，从而得到一个降阶的伽辽金系统。\n\n从频域中的麦克斯韦方程组和理想电导体边界条件出发，使用带有自由空间并矢格林函数的标准 EFIE，描述在 RWG 基下的 MoM 伽辽金方法，然后解释 CBFM 投影如何在这两个复合特征基函数张成的空间上构造一个降阶算子。根据这些原理，推导两个复合特征基函数之间的降阶伽辽金算子的表达式，该表达式为测试的 RWG 展开式与作用在 RWG 展开式上的 EFIE 算子的内积，并组装降阶的 $2 \\times 2$ 系统。\n\n对于角频率为 $\\omega$ 的对称结构，其完整的 MoM 阻抗算子近似为分块矩阵\n$$\nZ \\in \\mathbb{C}^{6 \\times 6}\n=\n\\begin{pmatrix}\nZ_{11} & Z_{12} \\\\\nZ_{21} & Z_{22}\n\\end{pmatrix},\n$$\n其中\n$$\nZ_{11} = (5 + \\mathrm{i}\\,2)\\, I_{3}, \\quad\nZ_{22} = (4 + \\mathrm{i}\\,1)\\, I_{3}, \\quad\nZ_{12} = Z_{21}^{\\top} = (0.6 + \\mathrm{i}\\,0.3)\\, \\mathbf{1}_{3 \\times 3},\n$$\n此处 $I_{3}$ 是 $3 \\times 3$ 的单位矩阵，$\\mathbf{1}_{3 \\times 3}$ 是 $3 \\times 3$ 的全一矩阵。考虑由矩阵的列表示的两个复合特征基函数在 RWG 展开中的形式\n$$\nT \\in \\mathbb{R}^{6 \\times 2} =\n\\begin{pmatrix}\n\\frac{1}{\\sqrt{3}} & 0 \\\\\n\\frac{1}{\\sqrt{3}} & 0 \\\\\n\\frac{1}{\\sqrt{3}} & 0 \\\\\n0 & \\frac{1}{\\sqrt{3}} \\\\\n0 & \\frac{1}{\\sqrt{3}} \\\\\n0 & \\frac{1}{\\sqrt{3}}\n\\end{pmatrix},\n$$\n因此，第一个复合基函数是子域1上的均匀组合，第二个是子域2上的均匀组合，每个都由 $\\sqrt{3}$ 进行归一化。\n\n使用从第一性原理推导出的 CBFM 投影和降阶组装方法，构建降阶的 $2 \\times 2$ 伽辽金算子，并计算其行列式的实部。最终值以 $\\mathrm{\\Omega}^{2}$ 为单位表示，并将答案四舍五入到四位有效数字。", "solution": "该问题要求从基本原理出发，推导特征基函数法 (CBFM) 中的降阶伽辽金算子，然后针对给定的全阻抗矩阵和一组复合基函数进行具体计算。\n\n分析从频域中的麦克斯韦方程组开始，假设时间谐波依赖关系为 $\\exp(\\mathrm{i}\\omega t)$ 形式：\n$$\n\\nabla \\times \\mathbf{E}(\\mathbf{r}) = -\\mathrm{i}\\omega\\mu\\mathbf{H}(\\mathbf{r})\n$$\n$$\n\\nabla \\times \\mathbf{H}(\\mathbf{r}) = \\mathbf{J}(\\mathbf{r}) + \\mathrm{i}\\omega\\epsilon\\mathbf{E}(\\mathbf{r})\n$$\n其中 $\\mathbf{E}$ 是电场，$\\mathbf{H}$ 是磁场，$\\mathbf{J}$ 是电流密度，$\\omega$ 是角频率，$\\mu$ 和 $\\epsilon$ 分别是介质的磁导率和介电常数。\n\n对于一个被入射电场 $\\mathbf{E}^i$ 照射的理想电导体 (PEC) 表面 $S$，会产生感应表面电流 $\\mathbf{J}_s$。该电流产生一个散射场 $\\mathbf{E}^s$。PEC 表面上的边界条件是总的切向电场必须为零：\n$$\n[\\mathbf{E}^i(\\mathbf{r}) + \\mathbf{E}^s(\\mathbf{r})]_{\\text{tan}} = 0 \\quad \\text{for } \\mathbf{r} \\in S\n$$\n散射场 $\\mathbf{E}^s$ 可以通过磁矢量势 $\\mathbf{A}$ 和标量电势 $\\Phi$ 用感应电流 $\\mathbf{J}_s$ 表示：\n$$\n\\mathbf{E}^s(\\mathbf{r}) = -\\mathrm{i}\\omega\\mathbf{A}(\\mathbf{r}) - \\nabla\\Phi(\\mathbf{r})\n$$\n这些势通过自由空间并矢格林函数 $G(\\mathbf{r}, \\mathbf{r}') = \\frac{\\exp(-\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}$ 与表面源（$\\mathbf{J}_s$ 和表面电荷密度 $\\rho_s$）相关联，其中 $k = \\omega\\sqrt{\\mu\\epsilon}$ 是波数。\n$$\n\\mathbf{A}(\\mathbf{r}) = \\mu \\int_S G(\\mathbf{r}, \\mathbf{r}') \\mathbf{J}_s(\\mathbf{r}') dS'\n$$\n$$\n\\Phi(\\mathbf{r}) = \\frac{1}{\\epsilon} \\int_S G(\\mathbf{r}, \\mathbf{r}') \\rho_s(\\mathbf{r}') dS'\n$$\n使用连续性方程 $\\nabla_s \\cdot \\mathbf{J}_s = -\\mathrm{i}\\omega\\rho_s$，我们可以通过施加 PEC 边界条件来写出电场积分方程 (EFIE)：\n$$\n[\\mathrm{i}\\omega\\mu \\int_S G(\\mathbf{r}, \\mathbf{r}') \\mathbf{J}_s(\\mathbf{r}') dS' + \\frac{\\mathrm{i}}{\\omega\\epsilon} \\nabla \\int_S G(\\mathbf{r}, \\mathbf{r}') (\\nabla'_s \\cdot \\mathbf{J}_s(\\mathbf{r}')) dS']_{\\text{tan}} = [\\mathbf{E}^i(\\mathbf{r})]_{\\text{tan}}\n$$\n我们定义线性算子 $\\mathcal{L}$，使得 EFIE 可以紧凑地写为 $\\mathcal{L}(\\mathbf{J}_s) = \\mathbf{E}^i_{\\text{tan}}$。\n\n在矩量法 (MoM) 中，未知电流 $\\mathbf{J}_s$ 在一组 $N$ 个基函数 $\\{\\mathbf{f}_n(\\mathbf{r})\\}_{n=1}^N$ 中展开，在本问题中即 Rao–Wilton–Glisson (RWG) 函数。\n$$\n\\mathbf{J}_s(\\mathbf{r}) \\approx \\sum_{n=1}^{N} I_n \\mathbf{f}_n(\\mathbf{r})\n$$\n其中 $I_n$ 是未知的复系数。将此展开式代入 EFIE 并应用伽辽金法，我们用每个基函数 $\\mathbf{f}_m$ 来测试该方程。这涉及到取内积，定义为 $\\langle \\mathbf{a}, \\mathbf{b} \\rangle = \\int_S \\mathbf{a}^*(\\mathbf{r}) \\cdot \\mathbf{b}(\\mathbf{r}) dS$。结果是一个线性方程组：\n$$\n\\sum_{n=1}^{N} I_n \\langle \\mathbf{f}_m, \\mathcal{L}(\\mathbf{f}_n) \\rangle = \\langle \\mathbf{f}_m, \\mathbf{E}^i_{\\text{tan}} \\rangle \\quad \\text{for } m=1, \\dots, N\n$$\n该系统以矩阵形式写作 $Z I = V$，其中 $Z$ 是 $N \\times N$ 的阻抗矩阵，其元素为 $Z_{mn} = \\langle \\mathbf{f}_m, \\mathcal{L}(\\mathbf{f}_n) \\rangle$，$I$ 是系数 $I_n$ 的列向量，$V$ 是激励向量，其元素为 $V_m = \\langle \\mathbf{f}_m, \\mathbf{E}^i_{\\text{tan}} \\rangle$。注意，对于使用实基函数的伽辽金测试，内积中 $\\mathbf{f}_m$ 上的复共轭对于空间部分是无关紧要的，但内积是半双线性的。MoM 矩阵元的标准定义是 $Z_{mn}=\\int_S \\mathbf{f}_m \\cdot \\mathcal{L}(\\mathbf{f}_n) dS$。\n\n特征基函数法 (CBFM) 是一种模型降阶技术。电流 $\\mathbf{J}_s$ 由少数复合基函数（称为特征基函数 (CBF)）$\\{\\mathbf{\\Psi}_k\\}_{k=1}^P$ 近似表示，其中 $P \\ll N$。每个 CBF 是原始 RWG 基函数的线性组合：\n$$\n\\mathbf{\\Psi}_k(\\mathbf{r}) = \\sum_{n=1}^{N} T_{nk} \\mathbf{f}_n(\\mathbf{r})\n$$\n系数 $T_{nk}$ 构成一个 $N \\times P$ 的变换矩阵 $T$。现在电流可近似为：\n$$\n\\mathbf{J}_s(\\mathbf{r}) \\approx \\sum_{k=1}^{P} \\alpha_k \\mathbf{\\Psi}_k(\\mathbf{r}) = \\sum_{k=1}^{P} \\alpha_k \\sum_{n=1}^{N} T_{nk} \\mathbf{f}_n(\\mathbf{r})\n$$\n这意味着 RWG 系数向量 $I$ 可近似为 $I \\approx T\\alpha$，其中 $\\alpha$ 是未知系数 $\\alpha_k$ 组成的 $P \\times 1$ 向量。\n\n为了求 $\\alpha$，我们将 $I = T\\alpha$ 代入完整系统 $ZI=V$ 中，得到 $ZT\\alpha = V$。然后我们对这个降基表示使用伽辽金法，用 CBF 本身进行测试。测试函数 $\\mathbf{\\Psi}_j$ 在 RWG 基中表示为 $\\sum_m T_{mj} \\mathbf{f}_m$。降阶系统为：\n$$\n\\langle \\mathbf{\\Psi}_j, \\mathcal{L}(\\sum_{k=1}^P \\alpha_k \\mathbf{\\Psi}_k) \\rangle = \\langle \\mathbf{\\Psi}_j, \\mathbf{E}^i_{\\text{tan}} \\rangle \\quad \\text{for } j=1, \\dots, P\n$$\n降阶系统为 $Z_r \\alpha = V_r$。降阶阻抗矩阵 $Z_r$ 的元素为：\n$$\n(Z_r)_{jk} = \\langle \\mathbf{\\Psi}_j, \\mathcal{L}(\\mathbf{\\Psi}_k) \\rangle = \\langle \\sum_{m=1}^N T_{mj} \\mathbf{f}_m, \\mathcal{L}(\\sum_{n=1}^N T_{nk} \\mathbf{f}_n) \\rangle\n$$\n利用内积的半双线性和 $\\mathcal{L}$ 的线性：\n$$\n(Z_r)_{jk} = \\sum_{m=1}^N \\sum_{n=1}^N T_{mj}^* T_{nk} \\langle \\mathbf{f}_m, \\mathcal{L}(\\mathbf{f}_n) \\rangle = \\sum_{m=1}^N \\sum_{n=1}^N T_{mj}^* Z_{mn} T_{nk}\n$$\n在矩阵表示法中，此式为 $Z_r = T^H Z T$，其中 $T^H$ 是 $T$ 的共轭转置。由于问题指定 $T \\in \\mathbb{R}^{6 \\times 2}$，其共轭转置就是其转置，即 $T^H = T^\\top$。所以，$Z_r = T^\\top Z T$。\n\n现在，我们对具体问题进行计算。给定 $N=6, P=2$。\n全阻抗矩阵是 $Z \\in \\mathbb{C}^{6 \\times 6}$，其分块为：\n$Z_{11} = (5 + \\mathrm{i}\\,2)\\, I_{3}$，$Z_{22} = (4 + \\mathrm{i}\\,1)\\, I_{3}$，以及 $Z_{12} = Z_{21}^{\\top} = (0.6 + \\mathrm{i}\\,0.3)\\, \\mathbf{1}_{3 \\times 3}$。由于 $\\mathbf{1}_{3 \\times 3}$ 是一个对称矩阵，$Z_{21}^{\\top} = Z_{12}$ 意味着 $Z_{21} = Z_{12}$。\n变换矩阵是 $T \\in \\mathbb{R}^{6 \\times 2}$：\n$$\nT =\n\\begin{pmatrix}\n\\frac{1}{\\sqrt{3}} & 0 \\\\\n\\frac{1}{\\sqrt{3}} & 0 \\\\\n\\frac{1}{\\sqrt{3}} & 0 \\\\\n0 & \\frac{1}{\\sqrt{3}} \\\\\n0 & \\frac{1}{\\sqrt{3}} \\\\\n0 & \\frac{1}{\\sqrt{3}}\n\\end{pmatrix}\n$$\n我们可以将 $T$ 划分为 $T = \\begin{pmatrix} T_1 \\\\ T_2 \\end{pmatrix}$，其中 $T_1 = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 1 & 0 \\\\ 1 & 0 \\\\ 1 & 0 \\end{pmatrix}$ 和 $T_2 = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 0 & 1 \\\\ 0 & 1 \\\\ 0 & 1 \\end{pmatrix}$。\n降阶阻抗矩阵 $Z_r$ 计算如下：\n$$\nZ_r = T^\\top Z T = \\begin{pmatrix} T_1^\\top & T_2^\\top \\end{pmatrix} \\begin{pmatrix} Z_{11} & Z_{12} \\\\ Z_{21} & Z_{22} \\end{pmatrix} \\begin{pmatrix} T_1 \\\\ T_2 \\end{pmatrix} = T_1^\\top Z_{11} T_1 + T_1^\\top Z_{12} T_2 + T_2^\\top Z_{21} T_1 + T_2^\\top Z_{22} T_2\n$$\n设 $T$ 的列为 $\\mathbf{t}_1, \\mathbf{t}_2$。那么 $(Z_r)_{jk} = \\mathbf{t}_j^\\top Z \\mathbf{t}_k$。\n$\\mathbf{t}_1 = \\frac{1}{\\sqrt{3}}[1,1,1,0,0,0]^\\top$ 且 $\\mathbf{t}_2 = \\frac{1}{\\sqrt{3}}[0,0,0,1,1,1]^\\top$。设 $\\mathbf{u} = [1,1,1]^\\top$。\n\n$(Z_r)_{11} = \\mathbf{t}_1^\\top Z \\mathbf{t}_1 = \\frac{1}{3} \\begin{pmatrix} \\mathbf{u}^\\top & \\mathbf{0}^\\top \\end{pmatrix} \\begin{pmatrix} Z_{11} & Z_{12} \\\\ Z_{21} & Z_{22} \\end{pmatrix} \\begin{pmatrix} \\mathbf{u} \\\\ \\mathbf{0} \\end{pmatrix} = \\frac{1}{3} \\mathbf{u}^\\top Z_{11} \\mathbf{u}$。\n$Z_{11} = (5 + \\mathrm{i}\\,2)I_3$，所以 $\\mathbf{u}^\\top Z_{11} \\mathbf{u} = (5 + \\mathrm{i}\\,2) \\mathbf{u}^\\top I_3 \\mathbf{u} = (5 + \\mathrm{i}\\,2) \\|\\mathbf{u}\\|^2 = 3(5 + \\mathrm{i}\\,2)$。\n$(Z_r)_{11} = \\frac{1}{3} \\times 3(5 + \\mathrm{i}\\,2) = 5 + \\mathrm{i}\\,2$。\n\n$(Z_r)_{22} = \\mathbf{t}_2^\\top Z \\mathbf{t}_2 = \\frac{1}{3} \\begin{pmatrix} \\mathbf{0}^\\top & \\mathbf{u}^\\top \\end{pmatrix} Z \\begin{pmatrix} \\mathbf{0} \\\\ \\mathbf{u} \\end{pmatrix} = \\frac{1}{3} \\mathbf{u}^\\top Z_{22} \\mathbf{u}$。\n$Z_{22} = (4 + \\mathrm{i}\\,1)I_3$，所以 $\\mathbf{u}^\\top Z_{22} \\mathbf{u} = (4 + \\mathrm{i}\\,1) \\|\\mathbf{u}\\|^2 = 3(4 + \\mathrm{i}\\,1)$。\n$(Z_r)_{22} = \\frac{1}{3} \\times 3(4 + \\mathrm{i}\\,1) = 4 + \\mathrm{i}\\,1$。\n\n$(Z_r)_{12} = \\mathbf{t}_1^\\top Z \\mathbf{t}_2 = \\frac{1}{3} \\begin{pmatrix} \\mathbf{u}^\\top & \\mathbf{0}^\\top \\end{pmatrix} Z \\begin{pmatrix} \\mathbf{0} \\\\ \\mathbf{u} \\end{pmatrix} = \\frac{1}{3} \\mathbf{u}^\\top Z_{12} \\mathbf{u}$。\n$Z_{12} = (0.6 + \\mathrm{i}\\,0.3)\\mathbf{1}_{3\\times3}$，所以 $\\mathbf{u}^\\top Z_{12} \\mathbf{u} = (0.6 + \\mathrm{i}\\,0.3) \\mathbf{u}^\\top \\mathbf{1}_{3\\times3} \\mathbf{u}$。\n$\\mathbf{1}_{3\\times3} \\mathbf{u} = [3,3,3]^\\top$，所以 $\\mathbf{u}^\\top (\\mathbf{1}_{3\\times3} \\mathbf{u}) = [1,1,1][3,3,3]^\\top = 9$。\n$\\mathbf{u}^\\top Z_{12} \\mathbf{u} = 9(0.6 + \\mathrm{i}\\,0.3) = 5.4 + \\mathrm{i}\\,2.7$。\n$(Z_r)_{12} = \\frac{1}{3} (5.4 + \\mathrm{i}\\,2.7) = 1.8 + \\mathrm{i}\\,0.9$。\n\n$(Z_r)_{21} = \\mathbf{t}_2^\\top Z \\mathbf{t}_1 = \\frac{1}{3} \\mathbf{u}^\\top Z_{21} \\mathbf{u}$。由于 $Z_{21} = Z_{12}$，所以 $(Z_r)_{21} = (Z_r)_{12}$。\n降阶的 $2 \\times 2$ 伽辽金算子为：\n$$\nZ_r = \\begin{pmatrix}\n5 + \\mathrm{i}\\,2 & 1.8 + \\mathrm{i}\\,0.9 \\\\\n1.8 + \\mathrm{i}\\,0.9 & 4 + \\mathrm{i}\\,1\n\\end{pmatrix}\n$$\n$Z_r$ 的行列式为：\n$$\n\\det(Z_r) = (5 + \\mathrm{i}\\,2)(4 + \\mathrm{i}\\,1) - (1.8 + \\mathrm{i}\\,0.9)^2\n$$\n第一项是：\n$$\n(5 + \\mathrm{i}\\,2)(4 + \\mathrm{i}\\,1) = (5 \\times 4 - 2 \\times 1) + \\mathrm{i}(5 \\times 1 + 2 \\times 4) = (20 - 2) + \\mathrm{i}(5 + 8) = 18 + \\mathrm{i}\\,13\n$$\n第二项是：\n$$\n(1.8 + \\mathrm{i}\\,0.9)^2 = 1.8^2 + 2(\\mathrm{i})(1.8)(0.9) + (\\mathrm{i}\\,0.9)^2 = 3.24 + \\mathrm{i}\\,3.24 - 0.81 = 2.43 + \\mathrm{i}\\,3.24\n$$\n因此，行列式为：\n$$\n\\det(Z_r) = (18 + \\mathrm{i}\\,13) - (2.43 + \\mathrm{i}\\,3.24) = (18 - 2.43) + \\mathrm{i}(13 - 3.24) = 15.57 + \\mathrm{i}\\,9.76\n$$\n问题要求行列式的实部，即：\n$$\n\\mathrm{Re}(\\det(Z_r)) = 15.57\n$$\n单位是阻抗的平方，即 $\\mathrm{\\Omega}^2$。数值 $15.57$ 已经精确到四位有效数字。", "answer": "$$\\boxed{15.57}$$", "id": "3292539"}, {"introduction": "在实践中，一组固定的特征基函数（CBF）可能不足以达到所需的求解精度。为了解决这个问题，高级的CBFM算法引入了自适应策略。本练习将介绍一种基于残差的后验误差估计方法，它允许我们对CBFM解的质量进行量化评估，并据此决定是否需要“加密”或扩充基函数集，以系统性地提升计算结果的准确性。[@problem_id:3292540]", "problem": "考虑一个通过矩量法 (MoM) 离散化的频域散射问题，其电场积分方程 (EFIE) 导出一个形式为 $\\mathbf{Z}\\mathbf{x}=\\mathbf{b}$ 的非厄米线性系统，其中 $\\mathbf{Z}\\in\\mathbb{C}^{N\\times N}$ 是阻抗矩阵，$\\mathbf{x}\\in\\mathbb{C}^{N}$ 是表面电流展开系数向量，$\\mathbf{b}\\in\\mathbb{C}^{N}$ 是激励向量。在特征基函数法 (CBFM) 中，使用粗糙子空间近似：$\\mathbf{x}\\approx \\mathbf{W}\\mathbf{x}_c$，其中 $\\mathbf{W}\\in\\mathbb{C}^{N\\times n_c}$（$n_c \\leq N$）汇集了特征基函数，$\\mathbf{x}_c\\in\\mathbb{C}^{n_c}$ 是相应的粗糙系数。代数残差为 $\\mathbf{r}=\\mathbf{b}-\\mathbf{Z}\\mathbf{W}\\mathbf{x}_c$。\n\n从离散系统出发，并基于无源电磁系统的 $\\mathbf{Z}$ 的厄米部分 $\\mathbf{S}=\\tfrac{1}{2}(\\mathbf{Z}+\\mathbf{Z}^H)$ 是半正定这一概念，推导能够驱动特征基函数集自适应加密的、基于残差的后验误差估计器。使用以下两种估计器：\n\n- 基于欧几里得范数的残差估计器 $\\eta_2=\\|\\mathbf{r}\\|_2$。\n- 由厄米部分和吉洪诺夫正则化参数 $\\tau>0$ 导出的能量对偶残差估计器：\n$$\n\\eta_E=\\sqrt{\\mathbf{r}^H\\mathbf{M}^{-1}\\mathbf{r}},\\quad \\mathbf{M}=\\tfrac{1}{2}(\\mathbf{Z}+\\mathbf{Z}^H)+\\tau \\mathbf{I},\n$$\n其中 $\\mathbf{I}$ 是单位矩阵。正则化参数 $\\tau$ 保证了即使 $\\tfrac{1}{2}(\\mathbf{Z}+\\mathbf{Z}^H)$ 仅为半正定时，$\\mathbf{M}$ 也是厄米正定的。\n\n您的任务是编写一个完整的程序，对每个给定的测试用例，计算 $\\mathbf{r}$、$\\eta_2$ 和 $\\eta_E$，然后根据决策规则 $\\eta_E > t$（其中 $t$ 是给定的阈值）来决定是否加密特征基函数集。每个测试用例的最终结果必须是一个三元列表 $[\\eta_2,\\eta_E,\\text{decision}]$，其中 $\\eta_2$ 和 $\\eta_E$ 四舍五入到 $6$ 位小数，$\\text{decision}$ 是一个布尔值。您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3]$）。\n\n请为以下测试套件实现您的解决方案。所有矩阵和向量都已明确给出。对于复数，虚数单位是 $\\mathrm{j}$。\n\n测试用例 1（一般复数，正常情况）：\n- $N=4$, $n_c=2$。\n- $\\displaystyle \\mathbf{Z}_1=\\begin{bmatrix}\n2+1\\mathrm{j} & 0.5-0.2\\mathrm{j} & 0 & 0\\\\\n0.5+0.2\\mathrm{j} & 1.5+0.8\\mathrm{j} & 0.3 & 0\\\\\n0 & 0.3 & 1.2+0.5\\mathrm{j} & 0.1-0.1\\mathrm{j}\\\\\n0 & 0 & 0.1+0.1\\mathrm{j} & 1+0.3\\mathrm{j}\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{W}_1=\\begin{bmatrix}\n1 & 0\\\\\n0 & 1\\\\\n0.2 & -0.1\\\\\n0 & 0.3\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{x}_{c,1}=\\begin{bmatrix}1-0.5\\mathrm{j}\\\\0.8+0.2\\mathrm{j}\\end{bmatrix}$,\n$\\displaystyle \\mathbf{b}_1=\\begin{bmatrix}1+0\\mathrm{j}\\\\0.5+0.2\\mathrm{j}\\\\0.1-0.1\\mathrm{j}\\\\-0.3+0.4\\mathrm{j}\\end{bmatrix}$\n- $\\tau_1=10^{-3}$, $t_1=0.5$\n\n测试用例 2（粗糙空间等于全空间，零近似）：\n- $N=3$, $n_c=3$。\n- $\\displaystyle \\mathbf{Z}_2=\\begin{bmatrix}\n1 & 0.2 & 0\\\\\n0.2 & 0.9 & 0.1\\\\\n0 & 0.1 & 1.1\n\\end{bmatrix} + \\mathrm{j}\\begin{bmatrix}\n0.3 & -0.1 & 0.05\\\\\n0.1 & 0.2 & -0.06\\\\\n-0.05 & 0.06 & 0.1\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{W}_2=\\mathbf{I}_3$\n- $\\displaystyle \\mathbf{x}_{c,2}=\\begin{bmatrix}0\\\\0\\\\0\\end{bmatrix}$,\n$\\displaystyle \\mathbf{b}_2=\\begin{bmatrix}0.5-0.2\\mathrm{j}\\\\-0.3+0.1\\mathrm{j}\\\\0.2+0.05\\mathrm{j}\\end{bmatrix}$\n- $\\tau_2=10^{-4}$, $t_2=0.25$\n\n测试用例 3（近奇异厄米部分，正则化激活）：\n- $N=3$, $n_c=2$。\n- $\\displaystyle \\mathbf{Z}_3=\\mathrm{j}\\begin{bmatrix}\n2 & -0.5 & 0\\\\\n0.5 & 1.5 & -0.3\\\\\n0 & 0.3 & 1\n\\end{bmatrix} + \\begin{bmatrix}\n10^{-3} & 0 & 0\\\\\n0 & 1.5\\cdot 10^{-3} & 0\\\\\n0 & 0 & 10^{-3}\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{W}_3=\\begin{bmatrix}\n1 & 0\\\\\n0.2 & 1\\\\\n0 & -0.1\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{x}_{c,3}=\\begin{bmatrix}0.7-0.3\\mathrm{j}\\\\-0.2+0.5\\mathrm{j}\\end{bmatrix}$,\n$\\displaystyle \\mathbf{b}_3=\\begin{bmatrix}0.1+0.2\\mathrm{j}\\\\-0.05+0.1\\mathrm{j}\\\\0.02-0.03\\mathrm{j}\\end{bmatrix}$\n- $\\tau_3=10^{-2}$, $t_3=0.1$\n\n测试用例 4（实对称正定）：\n- $N=4$, $n_c=3$。\n- $\\displaystyle \\mathbf{Z}_4=\\begin{bmatrix}\n2 & -0.3 & 0 & 0\\\\\n-0.3 & 1.7 & 0.2 & 0\\\\\n0 & 0.2 & 1.3 & -0.1\\\\\n0 & 0 & -0.1 & 0.9\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{W}_4=\\begin{bmatrix}\n1 & 0 & 0\\\\\n0 & 1 & 0\\\\\n0.4 & 0 & 1\\\\\n0 & -0.2 & 0.3\n\\end{bmatrix}$\n- $\\displaystyle \\mathbf{x}_{c,4}=\\begin{bmatrix}0.3\\\\-0.1\\\\0.2\\end{bmatrix}$,\n$\\displaystyle \\mathbf{b}_4=\\begin{bmatrix}0.2\\\\-0.05\\\\0.1\\\\-0.02\\end{bmatrix}$\n- $\\tau_4=10^{-8}$, $t_4=0.05$\n\n要求：\n- 对于每个测试用例 $k\\in\\{1,2,3,4\\}$，计算 $\\mathbf{r}_k$、$\\eta_{2,k}$、$\\eta_{E,k}$ 以及布尔决策 $\\eta_{E,k}>t_k$。\n- 最终程序必须输出单行，其中包含四个用例各自结果的列表，每个结果的格式为 $[\\eta_{2,k},\\eta_{E,k},\\text{decision}_k]$，其中 $\\eta_{2,k}$ 和 $\\eta_{E,k}$ 四舍五入到 $6$ 位小数。\n- 不需要物理单位。不涉及角度。所有输出必须是指定的数值浮点数或布尔值。", "solution": "该问题要求为计算电磁学中由矩量法 (MoM) 产生的线性系统的一个近似解计算两个后验误差估计器。该系统为 $\\mathbf{Z}\\mathbf{x}=\\mathbf{b}$，其粗糙近似为 $\\mathbf{x} \\approx \\mathbf{W}\\mathbf{x}_c$。然后使用这些估计器来决定是否加密基 $\\mathbf{W}$。每个测试用例的计算过程详述如下。\n\n基本量是阻抗矩阵 $\\mathbf{Z} \\in \\mathbb{C}^{N\\times N}$、激励向量 $\\mathbf{b} \\in \\mathbb{C}^{N}$、特征基函数 (CBF) 矩阵 $\\mathbf{W} \\in \\mathbb{C}^{N\\times n_c}$ 以及粗糙系数向量 $\\mathbf{x}_c \\in \\mathbb{C}^{n_c}$。\n\n对于每个测试用例 $k \\in \\{1, 2, 3, 4\\}$，该过程涉及四个主要步骤：\n1.  计算残差向量 $\\mathbf{r}_k$。\n2.  计算基于欧几里得范数的估计器 $\\eta_{2,k}$。\n3.  计算基于能量对偶范数的估计器 $\\eta_{E,k}$。\n4.  应用决策规则 $\\eta_{E,k} > t_k$。\n\n**步骤 1：残差计算**\n通过基矩阵将粗糙系数映射回完整的 $N$ 维空间，可以得到近似解 $\\mathbf{x}_{approx} = \\mathbf{W}\\mathbf{x}_c$。代数残差 $\\mathbf{r}$ 衡量了该近似解满足原始线性系统的程度。它定义为激励向量与阻抗矩阵作用于近似解向量的结果之间的差值：\n$$\n\\mathbf{r} = \\mathbf{b} - \\mathbf{Z}\\mathbf{x}_{approx} = \\mathbf{b} - \\mathbf{Z}\\mathbf{W}\\mathbf{x}_c\n$$\n这是一个标准的向量-矩阵乘法和减法过程。\n\n**步骤 2：基于欧几里得范数的估计器 ($\\eta_2$)**\n第一个估计器 $\\eta_2$ 就是残差向量 $\\mathbf{r}$ 的欧几里得 ($L_2$) 范数。它直接度量了方程中误差的大小。\n$$\n\\eta_2 = \\|\\mathbf{r}\\|_2 = \\sqrt{\\mathbf{r}^H \\mathbf{r}} = \\sqrt{\\sum_{i=1}^{N} |r_i|^2}\n$$\n其中 $\\mathbf{r}^H$ 是 $\\mathbf{r}$ 的共轭转置，$r_i$ 是 $\\mathbf{r}$ 的分量。\n\n**步骤 3：基于能量对偶范数的估计器 ($\\eta_E$)**\n第二个估计器 $\\eta_E$ 具有物理动机。对于无源电磁系统，时间平均的耗散或辐射功率是非负的。这在数学上等价于阻抗矩阵的厄米部分 $\\mathbf{S} = \\frac{1}{2}(\\mathbf{Z} + \\mathbf{Z}^H)$ 是半正定的。估计器 $\\eta_E$ 是在由该阻抗矩阵部分导出的范数中定义的。由于 $\\mathbf{S}$ 与功率之间的联系，这通常被称为“能量范数”。\n\n该估计器定义为：\n$$\n\\eta_E = \\sqrt{\\mathbf{r}^H \\mathbf{M}^{-1} \\mathbf{r}}\n$$\n其中矩阵 $\\mathbf{M}$ 是 $\\mathbf{Z}$ 的厄米部分的一个正则化版本：\n$$\n\\mathbf{M} = \\mathbf{S} + \\tau \\mathbf{I} = \\frac{1}{2}(\\mathbf{Z} + \\mathbf{Z}^H) + \\tau \\mathbf{I}\n$$\n这里，$\\mathbf{I}$ 是 $N \\times N$ 单位矩阵，$\\tau > 0$ 是一个吉洪诺夫正则化参数。由于 $\\mathbf{S}$ 是厄米矩阵，$\\tau\\mathbf{I}$ 也是厄米矩阵，它们的和 $\\mathbf{M}$ 也是厄米矩阵。添加项 $\\tau\\mathbf{I}$（其中 $\\tau > 0$）确保了 $\\mathbf{M}$ 是严格正定的，因而是可逆的，即使 $\\mathbf{S}$ 只是半正定的，或者由于数值/建模伪影而具有小的负特征值。\n\n在数值上，直接计算逆矩阵 $\\mathbf{M}^{-1}$ 可能不稳定且效率低下。更好的方法是先求解线性系统 $\\mathbf{M}\\mathbf{y} = \\mathbf{r}$ 以得到向量 $\\mathbf{y}$，这等价于 $\\mathbf{y} = \\mathbf{M}^{-1}\\mathbf{r}$。然后，$\\eta_E$ 可以通过向量内积计算：\n$$\n\\eta_E = \\sqrt{\\mathbf{r}^H \\mathbf{y}}\n$$\n由于 $\\mathbf{M}$ 是厄米正定的，二次型 $\\mathbf{r}^H \\mathbf{M}^{-1} \\mathbf{r}$ 保证是一个非负实数，因此其平方根是良定义且为实数。\n\n**步骤 4：决策规则**\n最后一步是应用决策规则来加密特征基函数集。将计算出的能量对偶估计器 $\\eta_E$ 与预定义的容差阈值 $t$进行比较。\n$$\n\\text{加密决策} = (\\eta_E > t)\n$$\n如果估计器超过阈值，决策为 `True`，表示应使用新函数加密基 $\\mathbf{W}$ 以提高近似精度。否则，决策为 `False`。\n\n将这四个步骤系统地应用于每个给定的测试用例，以获得所需的结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Computes a posteriori error estimators for a series of test cases\n    from the Characteristic Basis Function Method (CBFM) and decides\n    whether to enrich the basis set.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            # Test case 1 (general complex, happy path)\n            \"N\": 4, \"nc\": 2,\n            \"Z\": np.array([\n                [2. + 1.j, 0.5 - 0.2j, 0., 0.],\n                [0.5 + 0.2j, 1.5 + 0.8j, 0.3, 0.],\n                [0., 0.3, 1.2 + 0.5j, 0.1 - 0.1j],\n                [0., 0., 0.1 + 0.1j, 1. + 0.3j]\n            ]),\n            \"W\": np.array([\n                [1., 0.],\n                [0., 1.],\n                [0.2, -0.1],\n                [0., 0.3]\n            ]),\n            \"xc\": np.array([1. - 0.5j, 0.8 + 0.2j]),\n            \"b\": np.array([1. + 0.j, 0.5 + 0.2j, 0.1 - 0.1j, -0.3 + 0.4j]),\n            \"tau\": 1e-3, \"t\": 0.5\n        },\n        {\n            # Test case 2 (coarse equals full, zero approximation)\n            \"N\": 3, \"nc\": 3,\n            \"Z\": np.array([\n                [1., 0.2, 0.],\n                [0.2, 0.9, 0.1],\n                [0., 0.1, 1.1]\n            ]) + 1j * np.array([\n                [0.3, -0.1, 0.05],\n                [0.1, 0.2, -0.06],\n                [-0.05, 0.06, 0.1]\n            ]),\n            \"W\": np.eye(3),\n            \"xc\": np.array([0., 0., 0.]),\n            \"b\": np.array([0.5 - 0.2j, -0.3 + 0.1j, 0.2 + 0.05j]),\n            \"tau\": 1e-4, \"t\": 0.25\n        },\n        {\n            # Test case 3 (nearly singular Hermitian part, regularization active)\n            \"N\": 3, \"nc\": 2,\n            \"Z\": 1j * np.array([\n                [2., -0.5, 0.],\n                [0.5, 1.5, -0.3],\n                [0., 0.3, 1.]\n            ]) + np.array([\n                [1e-3, 0., 0.],\n                [0., 1.5e-3, 0.],\n                [0., 0., 1e-3]\n            ]),\n            \"W\": np.array([\n                [1., 0.],\n                [0.2, 1.],\n                [0., -0.1]\n            ]),\n            \"xc\": np.array([0.7 - 0.3j, -0.2 + 0.5j]),\n            \"b\": np.array([0.1 + 0.2j, -0.05 + 0.1j, 0.02 - 0.03j]),\n            \"tau\": 1e-2, \"t\": 0.1\n        },\n        {\n            # Test case 4 (real symmetric, positive definite)\n            \"N\": 4, \"nc\": 3,\n            \"Z\": np.array([\n                [2., -0.3, 0., 0.],\n                [-0.3, 1.7, 0.2, 0.],\n                [0., 0.2, 1.3, -0.1],\n                [0., 0., -0.1, 0.9]\n            ]),\n            \"W\": np.array([\n                [1., 0., 0.],\n                [0., 1., 0.],\n                [0.4, 0., 1.],\n                [0., -0.2, 0.3]\n            ]),\n            \"xc\": np.array([0.3, -0.1, 0.2]),\n            \"b\": np.array([0.2, -0.05, 0.1, -0.02]),\n            \"tau\": 1e-8, \"t\": 0.05\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract data for the current case\n        Z, W, xc, b = case[\"Z\"], case[\"W\"], case[\"xc\"], case[\"b\"]\n        tau, t, N = case[\"tau\"], case[\"t\"], case[\"N\"]\n\n        # Step 1: Compute the residual vector r\n        r = b - Z @ W @ xc\n        \n        # Step 2: Compute the Euclidean norm-based estimator eta_2\n        eta_2 = np.linalg.norm(r)\n        \n        # Step 3: Compute the energy-dual residual estimator eta_E\n        # 3a: Hermitian part of Z\n        S = 0.5 * (Z + Z.conj().T)\n        # 3b: Regularized matrix M\n        M = S + tau * np.eye(N)\n        # 3c: Solve M*y = r for y\n        # Check if M is real symmetric for optimized solver\n        is_symmetric = np.allclose(M, M.T) and np.isrealobj(M)\n        if is_symmetric:\n            y = linalg.solve(M, r, assume_a='sym')\n        else:\n            y = linalg.solve(M, r, assume_a='her')\n\n        # 3d: Compute eta_E = sqrt(r^H * y)\n        q_form = np.vdot(r, y)\n        eta_E = np.sqrt(np.real(q_form)) # Take real part to discard tiny numerical imaginary noise\n        \n        # Step 4: Make the decision\n        decision = eta_E > t\n        \n        # Store results rounded to 6 decimals\n        current_result = [round(eta_2, 6), round(eta_E, 6), decision]\n        results.append(current_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3292540"}]}