{"hands_on_practices": [{"introduction": "将连续的物理定律转化为离散的代数系统是计算电磁学的核心任务。对于时域积分方程（TDIE）方法，正确地表示电流和电荷之间的关系，即电荷守恒定律，是确保数值解稳定性和准确性的基石。本练习将指导你使用标准的Rao-Wilton-Glisson (RWG)基函数和脉冲基函数，从基本的连续性方程出发，推导出连接电流和电荷自由度的离散形式。[@problem_id:3355627]", "problem": "考虑一个由具有 $N_{t}$ 个三角形 $\\{T_{m}\\}_{m=1}^{N_{t}}$ 和 $N_{e}$ 条内部边 $\\{e_{n}\\}_{n=1}^{N_{e}}$ 的协调三角网格离散化的完美导电 (PEC) 闭合曲面。设 Rao–Wilton–Glisson (RWG) 基函数 $\\mathbf{f}_{n}(\\mathbf{r})$ 与长度为 $l_{n}$ 的内部边 $e_{n}$ 相关联，该边由两个相邻的三角形 $T_{n}^{+}$ 和 $T_{n}^{-}$ 共享，其面积分别为 $A_{n}^{+}$ 和 $A_{n}^{-}$。RWG 基函数在 $T_{n}^{+}$ 和 $T_{n}^{-}$ 上分段定义为\n$$\n\\mathbf{f}_{n}(\\mathbf{r}) = \\begin{cases}\n\\dfrac{l_{n}}{2 A_{n}^{+}} \\, \\mathbf{r}_{n}^{+}(\\mathbf{r}),  \\mathbf{r} \\in T_{n}^{+}, \\\\\n-\\dfrac{l_{n}}{2 A_{n}^{-}} \\, \\mathbf{r}_{n}^{-}(\\mathbf{r}),  \\mathbf{r} \\in T_{n}^{-}, \\\\\n\\mathbf{0},  \\text{otherwise},\n\\end{cases}\n$$\n其中 $\\mathbf{r}_{n}^{+}(\\mathbf{r})$ 是从 $T_{n}^{+}$ 的自由顶点到 $\\mathbf{r}$ 的平面内向量，而 $\\mathbf{r}_{n}^{-}(\\mathbf{r})$ 是从 $T_{n}^{-}$ 的自由顶点到 $\\mathbf{r}$ 的平面内向量。表面电流密度展开为\n$$\n\\mathbf{J}_{s}(\\mathbf{r},t) = \\sum_{n=1}^{N_{e}} i_{n}(t)\\, \\mathbf{f}_{n}(\\mathbf{r}),\n$$\n其中 $i_{n}(t)$ 是边电流系数（自由度）。在同一网格上，考虑一个支撑在每个三角形 $T_{m}$ 上的脉冲基 $\\{P_{m}(\\mathbf{r})\\}_{m=1}^{N_{t}}$，使得\n$$\nP_{m}(\\mathbf{r}) = \\begin{cases}\n\\dfrac{1}{A_{m}},  \\mathbf{r} \\in T_{m}, \\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\n其中 $A_{m}$ 是三角形 $T_{m}$ 的面积，因此 $\\int_{T_{m}} P_{m}(\\mathbf{r}) \\, \\mathrm{d}S = 1$。设表面电荷密度展开为\n$$\n\\rho_{s}(\\mathbf{r},t) = \\sum_{m=1}^{N_{t}} Q_{m}(t)\\, P_{m}(\\mathbf{r}),\n$$\n其中 $Q_{m}(t)$ 是三角形 $T_{m}$ 上的总电荷。\n\n从 Maxwell 方程组推导出的表面电荷连续性方程出发，\n$$\n\\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) + \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} = 0 \\quad \\text{on the surface},\n$$\n并利用上述展开式，推导连接电流自由度 $\\{i_{n}(t)\\}_{n=1}^{N_{e}}$ 和电荷自由度 $\\{Q_{m}(t)\\}_{m=1}^{N_{t}}$ 的离散连续性方程。在您的推导中：\n\n- 仅使用所提供的基本定义以及平面三角形上线性矢量场的表面散度为常数这一事实。\n- 清晰定义符号 $s_{mn} \\in \\{-1,0,+1\\}$，该符号捕捉边 $e_{n}$ 相对于三角形 $T_{m}$ 的方向，当 $T_{m} = T_{n}^{+}$ 时 $s_{mn} = +1$，当 $T_{m} = T_{n}^{-}$ 时 $s_{mn} = -1$，否则 $s_{mn} = 0$。\n- 展示如何使用关联长度矩阵 $\\mathbf{D}_{\\ell} \\in \\mathbb{R}^{N_{t} \\times N_{e}}$（其元素为 $\\left[\\mathbf{D}_{\\ell}\\right]_{mn} = s_{mn} \\, l_{n}$），将局部的、基于三角形的方程组装成一个紧凑的矩阵关系。\n\n提供与所选归一化一致的 $\\rho_{s}(\\mathbf{r},t)$ 的相关脉冲基展开式，并最终写出电荷系数向量的时间导数 $\\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t)$ 关于 $\\mathbf{D}_{\\ell}$ 和电流系数向量 $\\mathbf{i}(t)$ 的紧凑表达式。\n\n您的最终答案应该是 $\\dfrac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t)$ 关于 $\\mathbf{D}_{\\ell}$ 和 $\\mathbf{i}(t)$ 的单一闭式解析表达式，不需要单位。最终答案中不要提供中间方程。不需要四舍五入。", "solution": "该问题是有效的，因为它在科学上基于 Maxwell 理论和计算电磁学，定义清晰、问题明确，并且陈述客观。我们着手推导离散连续性方程。\n\n推导从表面电荷连续性方程开始，这是 Maxwell 方程组的直接推论：\n$$\n\\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) + \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} = 0\n$$\n为了从这个连续偏微分方程得到一个离散方程组，我们采用一个测试过程。一个自然的选择，与电荷的脉冲基展开一致，是在每个三角形 $T_m$（$m = 1, \\dots, N_t$）上对该方程进行积分。这等效于应用一个在 $T_m$ 上为 1、在其他地方为 0 的测试函数。\n$$\n\\int_{T_m} \\left( \\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) + \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} \\right) \\mathrm{d}S = 0\n$$\n我们可以将其分为两项：\n$$\n\\int_{T_m} \\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) \\, \\mathrm{d}S + \\int_{T_m} \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} \\, \\mathrm{d}S = 0\n$$\n\n我们来分析第一项，即散度项。我们代入给定的表面电流密度展开式 $\\mathbf{J}_{s}(\\mathbf{r},t) = \\sum_{n=1}^{N_{e}} i_{n}(t)\\, \\mathbf{f}_{n}(\\mathbf{r})$。\n$$\n\\int_{T_m} \\nabla_{s}\\cdot \\left( \\sum_{n=1}^{N_{e}} i_{n}(t)\\, \\mathbf{f}_{n}(\\mathbf{r}) \\right) \\mathrm{d}S = \\sum_{n=1}^{N_{e}} i_{n}(t) \\int_{T_m} \\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) \\, \\mathrm{d}S\n$$\n需要计算积分 $\\int_{T_m} \\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) \\, \\mathrm{d}S$。基函数 $\\mathbf{f}_{n}(\\mathbf{r})$ 是分段定义的。在三角形 $T_{n}^{+}$ 上，$\\mathbf{f}_{n}(\\mathbf{r}) = \\frac{l_{n}}{2 A_{n}^{+}} \\, \\mathbf{r}_{n}^{+}(\\mathbf{r})$。由于 $\\mathbf{r}_{n}^{+}(\\mathbf{r})$ 在三角形表面坐标系中是一个线性矢量场，其表面散度为常数，即 $\\nabla_s \\cdot \\mathbf{r}_{n}^{+}(\\mathbf{r}) = 2$。因此，基函数的表面散度在 $T_{n}^{+}$ 上也为常数：\n$$\n\\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) = \\frac{l_{n}}{2 A_{n}^{+}} \\nabla_{s}\\cdot\\mathbf{r}_{n}^{+}(\\mathbf{r}) = \\frac{l_{n}}{2 A_{n}^{+}} (2) = \\frac{l_{n}}{A_{n}^{+}}, \\quad \\mathbf{r} \\in T_{n}^{+}\n$$\n类似地，在三角形 $T_{n}^{-}$ 上，$\\mathbf{f}_{n}(\\mathbf{r}) = -\\frac{l_{n}}{2 A_{n}^{-}} \\, \\mathbf{r}_{n}^{-}(\\mathbf{r})$，其表面散度为：\n$$\n\\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) = -\\frac{l_{n}}{2 A_{n}^{-}} \\nabla_{s}\\cdot\\mathbf{r}_{n}^{-}(\\mathbf{r}) = -\\frac{l_{n}}{2 A_{n}^{-}} (2) = -\\frac{l_{n}}{A_{n}^{-}}, \\quad \\mathbf{r} \\in T_{n}^{-}\n$$\n散度在其他地方为零。现在我们可以计算在 $T_m$ 上的积分：\n\\begin{itemize}\n    \\item 如果 $T_m = T_n^{+}$，积分为 $\\int_{T_m} \\frac{l_{n}}{A_{n}^{+}} \\, \\mathrm{d}S$。由于 $T_m = T_n^{+}$，它们的面积相等，$A_m = A_n^{+}$。积分变为 $\\frac{l_{n}}{A_m} \\int_{T_m} \\mathrm{d}S = \\frac{l_{n}}{A_m} A_m = l_n$。在这种情况下，符号指示符 $s_{mn}$ 定义为 $+1$。\n    \\item 如果 $T_m = T_n^{-}$，积分为 $\\int_{T_m} -\\frac{l_{n}}{A_{n}^{-}} \\, \\mathrm{d}S$。由于 $A_m = A_n^{-}$，结果为 $-l_n$。在这种情况下，$s_{mn} = -1$。\n    \\item 如果 $T_m$ 不与边 $e_n$ 相邻（即 $T_m \\neq T_n^{+}$ 且 $T_m \\neq T_n^{-}$），则在 $T_m$ 上 $\\mathbf{f}_n(\\mathbf{r}) = \\mathbf{0}$，其散度为零，积分为 $0$。在这种情况下，$s_{mn} = 0$。\n\\end{itemize}\n在所有情况下，我们都得到 $\\int_{T_m} \\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) \\, \\mathrm{d}S = s_{mn} l_n$。\n因此，散度项简化为：\n$$\n\\sum_{n=1}^{N_{e}} i_{n}(t) (s_{mn} l_n)\n$$\n\n接下来，我们分析第二项，即电荷导数项。我们首先确认电荷展开的一致性。问题给出了展开式 $\\rho_{s}(\\mathbf{r},t) = \\sum_{k=1}^{N_{t}} Q_{k}(t)\\, P_{k}(\\mathbf{r})$，并说明 $Q_m(t)$ 是三角形 $T_m$ 上的总电荷。我们来验证这一点。$T_m$ 上的总电荷为 $\\int_{T_m} \\rho_s(\\mathbf{r}, t) \\, \\mathrm{d}S$。代入展开式：\n$$\n\\int_{T_m} \\sum_{k=1}^{N_{t}} Q_{k}(t) P_{k}(\\mathbf{r}) \\, \\mathrm{d}S = \\sum_{k=1}^{N_{t}} Q_{k}(t) \\int_{T_m} P_{k}(\\mathbf{r}) \\, \\mathrm{d}S\n$$\n由于 $P_k(\\mathbf{r})$ 仅在 $T_k$ 上非零，所以积分仅在 $k=m$ 时非零。因此，求和简化为一项：$Q_{m}(t) \\int_{T_m} P_{m}(\\mathbf{r}) \\, \\mathrm{d}S$。问题指定了归一化条件 $\\int_{T_{m}} P_{m}(\\mathbf{r}) \\, \\mathrm{d}S = 1$。因此，积分 $\\int_{T_m} \\rho_s(\\mathbf{r}, t) \\, \\mathrm{d}S$ 确实等于 $Q_m(t)$，这证实了一致性。\n\n现在我们计算主方程的第二项：\n$$\n\\int_{T_m} \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} \\, \\mathrm{d}S = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{T_m} \\rho_{s}(\\mathbf{r},t) \\, \\mathrm{d}S = \\frac{\\mathrm{d}Q_{m}(t)}{\\mathrm{d}t}\n$$\n\n结合这两项，三角形 $T_m$ 的离散连续性方程为：\n$$\n\\sum_{n=1}^{N_{e}} s_{mn} l_n i_{n}(t) + \\frac{\\mathrm{d}Q_{m}(t)}{\\mathrm{d}t} = 0\n$$\n这个方程对每个三角形 $m=1, \\dots, N_t$ 都成立。这个包含 $N_t$ 个方程的方程组可以用紧凑的矩阵形式表示。设 $\\mathbf{i}(t)$ 是电流系数 $\\{i_n(t)\\}$ 的 $N_e \\times 1$ 列向量，$\\mathbf{Q}(t)$ 是电荷系数 $\\{Q_m(t)\\}$ 的 $N_t \\times 1$ 列向量。我们使用关联长度矩阵 $\\mathbf{D}_{\\ell} \\in \\mathbb{R}^{N_{t} \\times N_{e}}$，其元素为 $[\\mathbf{D}_{\\ell}]_{mn} = s_{mn} l_{n}$。求和项 $\\sum_{n=1}^{N_{e}} s_{mn} l_n i_{n}(t)$ 是矩阵向量乘积 $\\mathbf{D}_{\\ell}\\mathbf{i}(t)$ 的第 $m$ 个元素。\n因此，整个方程组可以写为：\n$$\n\\mathbf{D}_{\\ell} \\mathbf{i}(t) + \\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t) = \\mathbf{0}\n$$\n其中 $\\mathbf{0}$ 是一个 $N_t \\times 1$ 的零向量。\n解出电荷向量的时间导数，我们得到最终表达式：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t) = - \\mathbf{D}_{\\ell} \\mathbf{i}(t)\n$$\n这就是电荷连续性方程的离散形式，它将三角形上电荷的变化率与流出它们的净电流联系起来，净电流通过边电流系数表示。", "answer": "$$\\boxed{-\\mathbf{D}_{\\ell} \\mathbf{i}(t)}$$", "id": "3355627"}, {"introduction": "建立了离散框架后，分析其数值属性至关重要，特别是那些影响精度的因素。时间基函数的选择会引入数值色散，这是一种关键的误差源，它会导致波在数值模拟中以与物理现实不符的速度传播。本练习旨在通过分析和计算，揭示不同阶数的时间基函数（分段常数与分段线性）如何引入不同的相位误差，从而影响求解的精度。[@problem_id:3355661]", "problem": "考虑一个角频率为 $\\omega$ 的单色平面波，垂直入射到一个无限大的理想电导体（PEC）平板上。理想电导体（PEC）表面上切向电场为零的物理边界条件，通过时域积分方程（TDIE）表示为：在所有时间 $t$，表面上的总切向电场等于零，即 $E_{\\text{tan}}(t) = E_{\\text{inc}}(t) + E_{\\text{scat}}(t) = 0$。在连续时间频域的极限情况下，这强制要求精确的反射系数为 $-1$，即反射场相对于表面上的入射场有 $\\pi$ 的相移。\n\n在计算电磁学中，时域步进（marching-on-in-time）的TDIE公式通常使用时间基函数 $b_j(t)$ 来表示表面电流密度，并在每个时间间隔内以弱形式（测试形式）施加边界条件。当使用时间基函数 $b(t)$ 并在其支撑域上对场进行测试时，单色信号 $e^{-i \\omega t}$ 的贡献会受到 $b(t)$ 的归一化傅里叶变换的加权，这会在有效施加边界条件时引入数值色散和相位误差。本问题要求您推导由两种时间基函数的选择所引入的相位误差，并计算和比较指定测试案例中产生的相位误差。\n\n沿表面法线方向在一维空间中进行分析，假设时间步长 $\\Delta t > 0$ 均匀，并考虑以下时间基函数：\n\n- 分段常数（零阶）基函数 $b_0(t)$，定义在单个区间上，\n$$\nb_0(t) = \n\\begin{cases}\n1,  0 \\le t  \\Delta t,\\\\\n0,  \\text{其他情况},\n\\end{cases}\n$$\n其归一化傅里叶变换为\n$$\nB_0(\\omega) = \\frac{1}{\\Delta t}\\int_{0}^{\\Delta t} e^{-i \\omega t}\\, dt.\n$$\n\n- 分段线性（一阶，帽状）基函数 $b_1(t)$，定义在两个连续区间上，\n$$\nb_1(t) = \n\\begin{cases}\nt/\\Delta t,  0 \\le t  \\Delta t,\\\\\n2 - t/\\Delta t,  \\Delta t \\le t  2\\Delta t,\\\\\n0,  \\text{其他情况},\n\\end{cases}\n$$\n其归一化傅里叶变换为\n$$\nB_1(\\omega) = \\frac{1}{\\Delta t}\\int_{0}^{2\\Delta t} b_1(t)\\, e^{-i \\omega t}\\, dt.\n$$\n\n任务：\n\n1. 从 Maxwell 方程组和 PEC 边界条件 $E_{\\text{tan}}(t) = 0$ 出发，解释为什么当使用时间基函数 $b(t)$ 以测试形式施加边界条件时，数值施加过程会引入一个额外的复数因子，该因子等于所选 $b(t)$ 的归一化傅里叶变换 $B(\\omega)$。论证对于单色激励 $e^{-i \\omega t}$ 和精确的空间表示，由时间测试 $b(t)$ 引入的数值相位误差由下式给出\n$$\n\\delta \\phi(\\omega) = \\arg\\left(B(\\omega)\\right),\n$$\n以弧度表示。\n\n2. 推导 $B_0(\\omega)$ 和 $B_1(\\omega)$ 的闭合形式表达式，并将其简化以证明\n$$\nB_0(\\omega) = e^{-i \\omega \\Delta t/2}\\, \\mathrm{sinc}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right),\n\\qquad\nB_1(\\omega) = e^{-i \\omega \\Delta t}\\, \\mathrm{sinc}^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right),\n$$\n其中 $\\mathrm{sinc}(x) = \\frac{\\sin x}{x}$。\n\n3. 使用任务2中的表达式和任务1中的定义，分别计算分段常数基函数和分段线性基函数的数值相位误差 $\\delta \\phi_0(\\omega)$ 和 $\\delta \\phi_1(\\omega)$。所有相位误差均以弧度表示。\n\n4. 实现一个程序，为以下每个测试案例计算 $\\delta \\phi_0(\\omega)$ 和 $\\delta \\phi_1(\\omega)$，案例由频率 $f$ 和时间步长 $\\Delta t$ 指定，其中 $\\omega = 2\\pi f$。所有频率必须以赫兹（Hertz）为单位提供，所有时间步长必须以秒（seconds）为单位提供；相位误差以弧度（radians）表示。每个测试案例的最终结果应四舍五入到 $12$ 位小数。测试案例如下：\n\n- 测试案例 A（一般情况）：$f = 1\\,\\mathrm{GHz}$，$\\Delta t = 50\\,\\mathrm{ps}$。\n- 测试案例 B（奈奎斯特边界）：$f = 5\\,\\mathrm{GHz}$，$\\Delta t = 100\\,\\mathrm{ps}$。\n- 测试案例 C（低频，小步长）：$f = 100\\,\\mathrm{MHz}$，$\\Delta t = 10\\,\\mathrm{ps}$。\n- 测试案例 D（接近半$\\pi$的中等情况）：$f = 3\\,\\mathrm{GHz}$，$\\Delta t = 75\\,\\mathrm{ps}$。\n- 测试案例 E（接近奈奎斯特的高频）：$f = 4.5\\,\\mathrm{GHz}$，$\\Delta t = 100\\,\\mathrm{ps}$。\n\n5. 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试案例的结果必须是包含两个浮点数的列表（以弧度为单位），顺序为 $[\\delta \\phi_0, \\delta \\phi_1]$，并四舍五入到 $12$ 位小数。例如，总输出必须类似于\n$$\n[\\,[\\delta \\phi_0^{(A)}, \\delta \\phi_1^{(A)}], [\\delta \\phi_0^{(B)}, \\delta \\phi_1^{(B)}], \\ldots\\,]\n$$\n且不含任何额外文本。\n\n输入中使用的所有物理单位必须被遵守，输出必须以弧度为单位。角度必须以弧度表示，而不是度。输出中不得出现百分比。确保算法在计算 $\\mathrm{sinc}(\\cdot)$ 时能安全地处理 $\\omega \\Delta t \\to 0$ 的极限情况。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于计算电磁学，问题提法恰当，提供了所有必要信息，并且其表述是客观的。各项任务结构逻辑清晰，导向一个唯一的、可验证的解。\n\n求解过程按顺序处理每个指定的任务。\n\n### 任务1：相位误差公式的论证\n\n用于理想电导体（PEC）散射体的时域积分方程（TDIE）方法的核心，是在导体表面 $S$ 上对所有时间 $t$ 施加边界条件，即总切向电场为零：\n$$E_{\\text{tan}}(\\mathbf{r}, t) = E_{\\text{inc,tan}}(\\mathbf{r}, t) + E_{\\text{scat,tan}}(\\mathbf{r}, t) = 0, \\quad \\mathbf{r} \\in S, \\forall t$$\n散射场 $E_{\\text{scat}}$ 是由入射场感应出的表面电流密度 $J_s$ 产生的。这种关系由一个线性积分-微分算子 $\\mathcal{L}$ 表示，使得 $E_{\\text{scat,tan}}(\\mathbf{r}, t) = \\mathcal{L}\\{J_s(\\mathbf{r}, t)\\}$。因此，求解 $J_s$ 的方程为：\n$$\\mathcal{L}\\{J_s(\\mathbf{r}, t)\\} = -E_{\\text{inc,tan}}(\\mathbf{r}, t), \\quad \\mathbf{r} \\in S$$\n在数值矩量法（MoM）框架中，未知的连续函数 $J_s$ 由一系列基函数近似。方程不是在每个时空点上都强制成立，而是在“弱”或“测试”意义上强制成立。这涉及将方程投影到一组测试函数上。对于伽辽金方案（Galerkin scheme），测试函数与基函数相同。\n\n问题陈述中指出，使用时间基函数 $b(t)$ 进行测试。当我们在 $b(t)$（或其时移版本）的支撑域上测试边界条件时，我们施加：\n$$\\int_{-\\infty}^{\\infty} b(t-t_n) \\left[ E_{\\text{inc,tan}}(t) + E_{\\text{scat,tan}}(t) \\right] dt = 0$$\n对于离散时间步 $t_n$。让我们考虑一个单色入射场 $E_{\\text{inc,tan}}(t) = E_0 e^{-i\\omega t}$。被测试的入射场项为：\n$$\\int_{-\\infty}^{\\infty} b(t-t_n) E_0 e^{-i\\omega t} dt$$\n通过替换 $\\tau = t-t_n$，这变成：\n$$E_0 \\int_{-\\infty}^{\\infty} b(\\tau) e^{-i\\omega (\\tau+t_n)} d\\tau = E_0 e^{-i\\omega t_n} \\int_{-\\infty}^{\\infty} b(\\tau) e^{-i\\omega \\tau} d\\tau$$\n该积分是基函数 $b(t)$ 的标准傅里叶变换。根据问题对归一化傅里叶变换的定义，$B(\\omega) = \\frac{1}{\\Delta t} \\int b(t) e^{-i \\omega t} dt$，该积分等于 $\\Delta t \\cdot B(\\omega)$。因此，在步骤 $n$ 处的被测试入射场为 $(E_0 e^{-i\\omega t_n}) \\cdot (\\Delta t \\cdot B(\\omega))$。\n\n在时间 $t_n$ 处的物理入射场就是 $E_0 e^{-i\\omega t_n}$。时间测试过程的效果是将物理场乘以一个复数因子 $\\Delta t \\cdot B(\\omega)$。常数实因子 $\\Delta t$ 通常被吸收到系统矩阵的定义中。剩下的复数因子 $B(\\omega)$ 修改了数值系统所施加的入射场和散射场之间的相位和振幅关系。\n\n对于垂直入射到无限大PEC平板上的平面波，精确的物理反射过程由反射系数 $R_{\\text{exact}} = -1 = e^{i\\pi}$ 描述。这意味着 $\\pi$ 弧度的相移和振幅不变。然而，数值方案施加的条件被复数因子 $B(\\omega)$ 有效地修正了。数值反射系数可以看作是 $R_{\\text{num}}(\\omega) = R_{\\text{exact}} \\cdot B(\\omega) = -B(\\omega)$。\n\n数值反射系数的相位是 $\\arg(R_{\\text{num}}(\\omega)) = \\arg(-1) + \\arg(B(\\omega)) = \\pi + \\arg(B(\\omega))$。相位误差 $\\delta\\phi$ 是数值方法引入的附加相位，即数值相位与精确相位之差：\n$$\\delta\\phi(\\omega) = \\arg(R_{\\text{num}}(\\omega)) - \\arg(R_{\\text{exact}}) = (\\pi + \\arg(B(\\omega))) - \\pi = \\arg(B(\\omega))$$\n这证实了问题陈述中给出的相位误差表达式。\n\n### 任务2：$B_0(\\omega)$ 和 $B_1(\\omega)$ 的推导\n\n我们现在推导分段常数和分段线性基函数的归一化傅里叶变换的闭合形式表达式。\n\n对于分段常数（零阶）基函数 $b_0(t)$：\n$$B_0(\\omega) = \\frac{1}{\\Delta t}\\int_{0}^{\\Delta t} (1) \\cdot e^{-i \\omega t}\\, dt = \\frac{1}{\\Delta t} \\left[ \\frac{e^{-i\\omega t}}{-i\\omega} \\right]_0^{\\Delta t}$$\n$$B_0(\\omega) = \\frac{1}{-i\\omega\\Delta t} (e^{-i\\omega\\Delta t} - 1) = \\frac{1}{i\\omega\\Delta t} (1 - e^{-i\\omega\\Delta t})$$\n为了用sinc函数表示，我们从分子中分解出一个相位项：\n$$1 - e^{-i\\omega\\Delta t} = e^{-i\\omega\\Delta t/2}(e^{i\\omega\\Delta t/2} - e^{-i\\omega\\Delta t/2}) = e^{-i\\omega\\Delta t/2}(2i\\sin(\\omega\\Delta t/2))$$\n将此代回 $B_0(\\omega)$ 的表达式中：\n$$B_0(\\omega) = \\frac{1}{i\\omega\\Delta t} \\left[ e^{-i\\omega\\Delta t/2}(2i\\sin(\\omega\\Delta t/2)) \\right] = e^{-i\\omega\\Delta t/2} \\frac{2\\sin(\\omega\\Delta t/2)}{\\omega\\Delta t}$$\n使用定义 $\\mathrm{sinc}(x) = (\\sin x)/x$：\n$$B_0(\\omega) = e^{-i\\omega\\Delta t/2} \\frac{\\sin(\\omega\\Delta t/2)}{\\omega\\Delta t/2} = e^{-i \\omega \\Delta t/2}\\, \\mathrm{sinc}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)$$\n\n对于分段线性（一阶）基函数 $b_1(t)$，直接积分是可能的，但很繁琐。一个更优雅的方法是利用卷积定理。三角帽状函数 $b_1(t)$ 可以构造为矩形窗函数 $b_0(t)$ 按比例缩放后的自卷积。设 $b_{0,\\Delta t}(t)$ 为未缩放的窗函数，在 $[0, \\Delta t)$ 上等于 $1$，其他地方为 $0$。其与自身的卷积为：\n$$(b_{0,\\Delta t} * b_{0,\\Delta t})(t) = \\int_{-\\infty}^{\\infty} b_{0,\\Delta t}(\\tau) b_{0,\\Delta t}(t-\\tau) d\\tau = \\begin{cases} t,  0 \\le t  \\Delta t \\\\ 2\\Delta t-t,  \\Delta t \\le t  2\\Delta t \\\\ 0,  \\text{其他情况} \\end{cases}$$\n这是一个在 $t=\\Delta t$ 处高度为 $\\Delta t$ 的三角函数。基函数 $b_1(t)$ 是这个三角函数按 $1/\\Delta t$ 缩放以获得单位峰值：\n$$b_1(t) = \\frac{1}{\\Delta t} (b_{0,\\Delta t} * b_{0,\\Delta t})(t)$$\n设 $\\mathcal{F}$ 表示傅里叶变换算子 $\\int(\\cdot)e^{-i\\omega t}dt$。根据卷积定理，$\\mathcal{F}\\{f*g\\} = \\mathcal{F}\\{f\\}\\mathcal{F}\\{g\\}$。\n$$\\mathcal{F}\\{b_1(t)\\} = \\frac{1}{\\Delta t} \\mathcal{F}\\{b_{0,\\Delta t}\\}^2$$\n我们知道 $\\mathcal{F}\\{b_{0,\\Delta t}\\} = \\Delta t \\cdot B_0(\\omega)$。代入此式：\n$$\\mathcal{F}\\{b_1(t)\\} = \\frac{1}{\\Delta t} (\\Delta t \\cdot B_0(\\omega))^2 = \\Delta t \\cdot B_0(\\omega)^2$$\n归一化变换 $B_1(\\omega)$ 定义为 $B_1(\\omega) = \\frac{1}{\\Delta t} \\mathcal{F}\\{b_1(t)\\}$。因此：\n$$B_1(\\omega) = \\frac{1}{\\Delta t} (\\Delta t \\cdot B_0(\\omega)^2) = B_0(\\omega)^2$$\n代入已推导的 $B_0(\\omega)$ 表达式：\n$$B_1(\\omega) = \\left( e^{-i \\omega \\Delta t/2}\\, \\mathrm{sinc}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right)^2 = e^{-i \\omega \\Delta t}\\, \\mathrm{sinc}^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)$$\n两个推导都与问题陈述中提供的表达式相符。\n\n### 任务3：数值相位误差 $\\delta\\phi_0(\\omega)$ 和 $\\delta\\phi_1(\\omega)$\n\n相位误差 $\\delta\\phi$ 是复函数 $B(\\omega)$ 的辐角。\n对于分段常数基函数：\n$$\\delta\\phi_0(\\omega) = \\arg(B_0(\\omega)) = \\arg\\left( e^{-i\\omega\\Delta t/2} \\mathrm{sinc}\\!\\left(\\frac{\\omega\\Delta t}{2}\\right) \\right)$$\nsinc函数 $\\mathrm{sinc}(x)$ 是实值函数。为了保证时域步进格式的数值稳定性，时间步长 $\\Delta t$ 必须选择得足够小，以解析感兴趣的最高频率 $\\omega_{\\max}$。Courant-Friedrichs-Lewy (CFL) 条件通常要求 $\\Delta t$ 足够小，以至于 $\\omega_{\\max} \\Delta t  \\pi$。在此条件下，sinc函数的参数 $x = \\omega\\Delta t/2$ 位于区间 $(-\\pi/2, \\pi/2)$ 内，其中 $\\mathrm{sinc}(x)$ 严格为正。对于给定的测试案例，$\\omega\\Delta t$ 的最大值为 $\\pi$（在奈奎斯特极限下），所以 $\\omega\\Delta t/2 \\le \\pi/2$，且 $\\mathrm{sinc}(\\omega\\Delta t/2) \\ge \\mathrm{sinc}(\\pi/2) = 2/\\pi > 0$。\n由于sinc项是正实数，其辐角为 $0$。$B_0(\\omega)$ 的相位完全由复指数项决定：\n$$\\delta\\phi_0(\\omega) = \\arg(e^{-i\\omega\\Delta t/2}) = -\\frac{\\omega\\Delta t}{2}$$\n\n对于分段线性基函数：\n$$\\delta\\phi_1(\\omega) = \\arg(B_1(\\omega)) = \\arg\\left( e^{-i\\omega\\Delta t} \\mathrm{sinc}^2\\!\\left(\\frac{\\omega\\Delta t}{2}\\right) \\right)$$\n项 $\\mathrm{sinc}^2(\\omega\\Delta t/2)$ 是一个实数的平方，所以它总是非负的。对于感兴趣的频率，它严格为正。因此，其辐角为 $0$。$B_1(\\omega)$ 的相位完全由复指数决定：\n$$\\delta\\phi_1(\\omega) = \\arg(e^{-i\\omega\\Delta t}) = -\\omega\\Delta t$$\n一阶基函数的相位误差恰好是零阶基函数的两倍。这对应于 $b_0(t)$ 的有效数值时间延迟为 $\\Delta t/2$，$b_1(t)$ 的有效数值时间延迟为 $\\Delta t$，这与相应基函数的时间质心相匹配。\n\n### 任务4和5：实现与输出\n\n利用任务3的结果和关系式 $\\omega = 2\\pi f$，要计算的相位误差为：\n$$\\delta\\phi_0(f, \\Delta t) = -\\frac{(2\\pi f)\\Delta t}{2} = -\\pi f \\Delta t$$\n$$\\delta\\phi_1(f, \\Delta t) = -(2\\pi f)\\Delta t = -2\\pi f \\Delta t$$\n这些简单的表达式在计算上是稳健的，并且避免了直接评估sinc函数，从而满足了安全处理 $\\omega\\Delta t \\to 0$ 极限的要求。将实现一个Python程序来为指定的测试案例计算这些值，输入 $f$ 以赫兹为单位，$\\Delta t$ 以秒为单位，输出相位误差以弧度为单位，并四舍五入到12位小数。输出将格式化为表示列表的列表的单行字符串。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the numerical phase errors for piecewise-constant and piecewise-linear\n    temporal basis functions in a time-domain integral equation formulation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains (frequency in Hz, time step in seconds).\n    test_cases = [\n        # Test case A: f = 1 GHz, Δt = 50 ps\n        (1.0e9, 50.0e-12),\n        # Test case B: f = 5 GHz, Δt = 100 ps (Nyquist boundary)\n        (5.0e9, 100.0e-12),\n        # Test case C: f = 100 MHz, Δt = 10 ps\n        (100.0e6, 10.0e-12),\n        # Test case D: f = 3 GHz, Δt = 75 ps\n        (3.0e9, 75.0e-12),\n        # Test case E: f = 4.5 GHz, Δt = 100 ps\n        (4.5e9, 100.0e-12),\n    ]\n\n    results = []\n    for f, dt in test_cases:\n        # The angular frequency is omega = 2 * pi * f.\n        # The phase error for the piecewise-constant (0-order) basis is:\n        # delta_phi_0 = - (omega * dt) / 2 = -pi * f * dt\n        delta_phi_0 = -np.pi * f * dt\n\n        # The phase error for the piecewise-linear (1st-order) basis is:\n        # delta_phi_1 = -omega * dt = -2 * pi * f * dt\n        delta_phi_1 = -2 * np.pi * f * dt\n\n        # Round results to 12 decimal places as required.\n        rounded_phi_0 = round(delta_phi_0, 12)\n        rounded_phi_1 = round(delta_phi_1, 12)\n\n        results.append([rounded_phi_0, rounded_phi_1])\n\n    # Format the output string precisely as required: [[r1_0,r1_1],[r2_0,r2_1],...]\n    # We build the string manually to avoid spaces that `str(list)` might introduce.\n    inner_strs = [f\"[{r[0]},{r[1]}]\" for r in results]\n    final_output_str = f\"[{','.join(inner_strs)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "3355661"}, {"introduction": "理论推导与实际验证是相辅相成的。TDIE求解器中一个常见的难题是晚期时间不稳定性，其根源往往在于离散电荷守恒的微小违背随着时间步进不断累积。本编码练习将理论付诸实践，要求你实现一个验证程序，检查给定的电流和电荷数值结果是否严格遵守离散电荷守恒定律，从而将抽象的稳定性理论与具体的代码调试和验证技能联系起来。[@problem_id:3355680]", "problem": "从麦克斯韦方程组和局部电荷守恒定律出发，考虑一个在三角化表面上用于表面电流密度和表面电荷密度离散化的时域积分方程（TDIE）。使用定义在 $[t_j,t_{j+1}]$ 上的 Rao–Wilton–Glisson (RWG) 散度整合空间基函数 $\\mathbf{f}_i(\\mathbf{r})$ 和分段常数时间基函数 $b_j(t)$ 来构造时空基函数 $\\mathbf{f}_i(\\mathbf{r}) b_j(t)$，用于展开表面电流密度 $\\mathbf{J}(\\mathbf{r},t)$。表面电荷密度 $\\rho(\\mathbf{r},t)$ 在三角形上使用分段常数空间测试函数和与时间区间 $[t_j,t_{j+1}]$ 对齐的阶梯式时间表示进行离散化。\n\n基本原理：从局部电荷连续性定律 $\\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) + \\partial_t \\rho(\\mathbf{r},t) = 0$ 开始，通过在每个空间单元和时间区间上使用散度定理和时间积分来获得离散平衡。不要假定任何快捷公式；相反，通过将守恒定律投影到与 $b_j(t)$ 一致的三角形分段常数空间测试和时间窗测试上来推导电荷连续性的离散强制执行。\n\n假设一个三角化表面网格，其中每个 RWG 基函数的支撑域恰好覆盖两个相邻的三角形 $T^{+}$ 和 $T^{-}$，并具有这样的性质：$\\nabla \\cdot \\mathbf{f}_i(\\mathbf{r})$ 在 $T^{+}$ 和 $T^{-}$ 上是分段常数，其值分别为 $+1/A^{+}$ 和 $-1/A^{-}$，其中 $A^{+}$ 和 $A^{-}$ 是三角形的面积。为了在离散层面验证电荷連續性，利用以下事实：$\\nabla \\cdot \\mathbf{f}_i(\\mathbf{r})$ 在 $T^{+}$ 上的空间积分为 $+1$，在 $T^{-}$ 上的空间积分为 $-1$，在其他地方为零。这定义了三角形和 RWG 边之间的邻接-方向矩阵。令时间基函数 $b_j(t)$ 为在 $[t_j,t_{j+1}]$ 上的单位矩形脉冲，在其他地方为零。\n\n您的程序必须为一组给定的测试用例实现以下验证：\n\n- 构建离散的邻接-方向矩阵 $S$，其元素 $S_{n,i} = \\int_{T_n} \\nabla \\cdot \\mathbf{f}_i(\\mathbf{r}) \\, dS$。如果三角形 $n$ 是边 $i$ 的正侧，则其值为 $+1$；如果是负侧，则为 $-1$；否则为 $0$。\n\n- 对于每个持续时间为 $\\Delta t$ 的时间区间 $[t_j,t_{j+1}]$，给定与 $\\mathbf{f}_i(\\mathbf{r}) b_j(t)$ 相关的电流展开系数 $I_{i,j}$ 和在区间 $j$ 结束时给定的三角形积分电荷 $Q_{n,j} = \\int_{T_n} \\rho(\\mathbf{r}, t_{j+1}) \\, dS$，通过在空间和时间上对控制定律进行积分，并将 $Q_{n,j}$ 的变化与 $[t_j,t_{j+1}]$ 上 $\\mathbf{J}(\\mathbf{r},t)$ 的散度贡献进行比较，从而形成每个三角形和区间上的电荷连续性离散残差。使用提供的数据计算每个区间和三角形的残差大小（以库仑 $(\\mathrm{C})$ 为单位），然后报告每个测试用例在所有三角形和区间上的最大绝对残差。\n\n物理单位：电流 $I_{i,j}$ 的单位是安培 $(\\mathrm{A})$，时间 $t_j$ 的单位是秒 $(\\mathrm{s})$，三角形积分电荷 $Q_{n,j}$ 的单位是库仑 $(\\mathrm{C})$。最终残差大小以库仑 $(\\mathrm{C})$ 表示。\n\n角度单位不适用。\n\n百分比不适用。\n\n测试套件与答案规范：\n\n使用以下参数集进行实现和测试。在每种情况下，网格由矩阵 $S$ 编码，时间步长为 $\\Delta t$，电流系数为 $\\{I_{i,j}\\}$，区间末端的三角形积分电荷为 $\\{Q_{n,j}\\}$，初始电荷为 $t_0$ 时刻的 $Q_{n,-1}$。计算所有三角形和区间上的最大绝对残差，每个测试用例报告一个浮点数（单位为 $\\mathrm{C}$）。\n\n- 测试用例 1 (正常路径):\n    - 三角形数量：2；RWG 边数量：1。\n    - 邻接-方向矩阵：$S = \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix}$。\n    - 时间步长：$\\Delta t = 1.0$。\n    - 每个区间的电流系数：$I_{\\cdot,0} = \\begin{bmatrix} 1.5 \\end{bmatrix}$, $I_{\\cdot,1} = \\begin{bmatrix} -0.5 \\end{bmatrix}$。\n    - 初始电荷：$Q_{\\cdot,-1} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 区间末端的电荷：\n      $Q_{\\cdot,0} = \\begin{bmatrix} -1.5 \\\\ 1.5 \\end{bmatrix}$,\n      $Q_{\\cdot,1} = \\begin{bmatrix} -1.0 \\\\ 1.0 \\end{bmatrix}$。\n\n- 测试用例 2 (有意不匹配以探测残差灵敏度):\n    - 三角形数量：2；RWG 边数量：1。\n    - 邻接-方向矩阵：$S = \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix}$。\n    - 时间步长：$\\Delta t = 1.0$。\n    - 每个区间的电流系数：$I_{\\cdot,0} = \\begin{bmatrix} 1.5 \\end{bmatrix}$, $I_{\\cdot,1} = \\begin{bmatrix} -0.5 \\end{bmatrix}$。\n    - 初始电荷：$Q_{\\cdot,-1} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 区间末端的电荷 (扰动后):\n      $Q_{\\cdot,0} = \\begin{bmatrix} -1.5 \\\\ 1.5 \\end{bmatrix}$,\n      $Q_{\\cdot,1} = \\begin{bmatrix} -1.1 \\\\ 0.9 \\end{bmatrix}$。\n\n- 测试用例 3 (跨三角形的多边耦合):\n    - 三角形数量：3；RWG 边数量：2。\n    - 邻接-方向矩阵：$S = \\begin{bmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{bmatrix}$，表示边 $0$ 连接三角形 $0$ 和三角形 $1$，在三角形 $0$ 上为正方向；边 $1$ 连接三角形 $1$ 和三角形 $2$，在三角形 $1$ 上为正方向。\n    - 时间步长：$\\Delta t = 0.5$。\n    - 每个区间的电流系数：\n      $I_{\\cdot,0} = \\begin{bmatrix} 2.0 \\\\ 1.0 \\end{bmatrix}$,\n      $I_{\\cdot,1} = \\begin{bmatrix} 0.0 \\\\ -1.0 \\end{bmatrix}$,\n      $I_{\\cdot,2} = \\begin{bmatrix} -2.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 初始电荷：$Q_{\\cdot,-1} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 区间末端的电荷：\n      $Q_{\\cdot,0} = \\begin{bmatrix} -1.0 \\\\ 0.5 \\\\ 0.5 \\end{bmatrix}$,\n      $Q_{\\cdot,1} = \\begin{bmatrix} -1.0 \\\\ 1.0 \\\\ 0.0 \\end{bmatrix}$,\n      $Q_{\\cdot,2} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$\\texttt{[result1,result2,result3]}$），其中每个条目是相应测试用例在所有三角形和区间上的最大绝对残差，以库仑 $(\\mathrm{C})$ 为单位表示。", "solution": "该问题要求在三角化表面上验证离散电荷守恒。出发点是局部电荷连续性方程，这是麦克斯韦方程组的一个基本推论：\n$$ \\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) + \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} = 0 $$\n其中 $\\mathbf{J}(\\mathbf{r},t)$ 是表面电流密度，$\\rho(\\mathbf{r},t)$ 是表面电荷密度。\n\n为了推导该定律的离散形式，我们采用指定的测试程序。我们将连续性方程在一个任意的三角面片 $T_n$ 和一个持续时间为 $\\Delta t = t_{j+1} - t_j$ 的单一时间区间 $[t_j, t_{j+1}]$ 上进行积分。这相当于应用一个在空间上是分段常数（在 $T_n$ 上等于 $1$，其他地方为 $0$）且在时间上也是分段常数（在 $[t_j, t_{j+1}]$ 上等于 $1$，其他地方为 $0$）的测试函数。\n\n被测试的方程是：\n$$ \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\left( \\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) + \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\right) dS \\, dt = 0 $$\n\n我们可以将其分为两项：\n$$ \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) \\, dS \\, dt + \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\, dS \\, dt = 0 $$\n\n我们来分析涉及电流 $\\mathbf{J}$ 的第一项。问题指出，$\\mathbf{J}(\\mathbf{r},t)$ 使用 Rao-Wilton-Glisson (RWG) 空间基函数 $\\mathbf{f}_i(\\mathbf{r})$ 和分段常数时间基函数 $b_j(t)$ 进行展开。时间基函数 $b_j(t)$ 是在 $[t_j, t_{j+1}]$ 上的单位矩形脉冲。\n展开式为：\n$$ \\mathbf{J}(\\mathbf{r},t) = \\sum_{i,k} I_{i,k} \\mathbf{f}_i(\\mathbf{r}) b_k(t) $$\n在特定的时间区间 $[t_j, t_{j+1}]$ 内，我们有 $b_k(t) = \\delta_{kj}$ (克罗内克 δ)，因此电流在时间上是恒定的：\n$$ \\mathbf{J}(\\mathbf{r},t) = \\sum_{i} I_{i,j} \\mathbf{f}_i(\\mathbf{r}) \\quad \\text{for } t \\in [t_j, t_{j+1}] $$\n将此代入第一项：\n$$ \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\nabla \\cdot \\left( \\sum_{i} I_{i,j} \\mathbf{f}_i(\\mathbf{r}) \\right) dS \\, dt $$\n由于被积函数在该区间内随时间是恒定的，时间积分产生一个因子 $\\Delta t$。我们也可以利用散度和积分算子的线性性质：\n$$ \\Delta t \\sum_{i} I_{i,j} \\int_{T_n} \\nabla \\cdot \\mathbf{f}_i(\\mathbf{r}) \\, dS $$\n问题定义了邻接-方向矩阵 $S$，其元素为 $S_{n,i} = \\int_{T_n} \\nabla \\cdot \\mathbf{f}_i(\\mathbf{r}) \\, dS$。这些元素的值为 $+1$、$-1$ 或 $0$。因此，第一项简化为：\n$$ \\Delta t \\sum_{i} S_{n,i} I_{i,j} $$\n该项表示在时间区间 $[t_j, t_{j+1}]$ 内，根据电流系数 $I_{i,j}$ 计算出的流出三角形 $T_n$ 的总电荷量。\n\n现在，我们来分析涉及电荷密度 $\\rho$ 的第二项。我们可以交换积分顺序：\n$$ \\int_{T_n} \\left( \\int_{t_j}^{t_{j+1}} \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\, dt \\right) dS $$\n根据微积分基本定理，内部积分计算为区间内的电荷密度变化：\n$$ \\int_{t_j}^{t_{j+1}} \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\, dt = \\rho(\\mathbf{r}, t_{j+1}) - \\rho(\\mathbf{r}, t_j) $$\n将其代回，第二项变为：\n$$ \\int_{T_n} \\left( \\rho(\\mathbf{r}, t_{j+1}) - \\rho(\\mathbf{r}, t_j) \\right) dS = \\int_{T_n} \\rho(\\mathbf{r}, t_{j+1}) \\, dS - \\int_{T_n} \\rho(\\mathbf{r}, t_j) \\, dS $$\n问题将区间 $k$ 结束时的三角形积分电荷定义为 $Q_{n,k} = \\int_{T_n} \\rho(\\mathbf{r}, t_{k+1}) \\, dS$。注意，区间 $k$ 的结束时间是 $t_{k+1}$。因此，当前区间 $j$ 结束时（$t_{j+1}$ 时刻）的电荷是 $Q_{n,j}$，而区间 $j$ 开始时（$t_j$ 时刻，即区间 $j-1$ 结束时）的电荷是 $Q_{n,j-1}$。\n因此，第二项是存储在三角形 $T_n$ 上的总电荷的变化：\n$$ Q_{n,j} - Q_{n,j-1} $$\n\n结合这两个简化项，我们得到每个三角形 $n$ 和时间区间 $j$ 的离散电荷守恒定律：\n$$ (Q_{n,j} - Q_{n,j-1}) + \\Delta t \\sum_{i} S_{n,i} I_{i,j} = 0 $$\n这个方程表明，一个三角形上存储电荷的增加量必须等于流入其中的净电荷量。\n\n残差 $R_{n,j}$ 是给定数值数据违反此离散定律的量：\n$$ R_{n,j} = (Q_{n,j} - Q_{n,j-1}) + \\Delta t \\sum_{i} S_{n,i} I_{i,j} $$\n任务是为提供了数据的每个三角形 $n$ 和每个时间区间 $j$ 计算此残差，然后在所有这些残差中找到最大的绝对值。\n\n对于给定的时间区间 $j$，使用矩阵向量表示法，令 $\\mathbf{Q}_j$ 为 $t_{j+1}$ 时刻所有三角形上的电荷列向量，$\\mathbf{I}_j$ 为所有边上的电流系数列向量，$S$ 为邻接-方向矩阵。区间 $j$ 的残差向量 $\\mathbf{R}_j$ 为：\n$$ \\mathbf{R}_j = (\\mathbf{Q}_j - \\mathbf{Q}_{j-1}) + \\Delta t \\cdot S \\mathbf{I}_j $$\n因此，每个测试用例的最终结果是 $\\max_{j} (\\max|\\mathbf{R}_j|)$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating the maximum absolute charge continuity residual\n    for a series of test cases based on a discretized time-domain integral equation formulation.\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1: Happy path\n        {\n            \"S\": np.array([[1], [-1]]),\n            \"dt\": 1.0,\n            \"currents\": [np.array([1.5]), np.array([-0.5])],\n            \"charges\": [np.array([0.0, 0.0]), np.array([-1.5, 1.5]), np.array([-1.0, 1.0])]\n        },\n        # Test Case 2: Intentional mismatch\n        {\n            \"S\": np.array([[1], [-1]]),\n            \"dt\": 1.0,\n            \"currents\": [np.array([1.5]), np.array([-0.5])],\n            \"charges\": [np.array([0.0, 0.0]), np.array([-1.5, 1.5]), np.array([-1.1, 0.9])]\n        },\n        # Test Case 3: Multi-edge coupling\n        {\n            \"S\": np.array([[1, 0], [-1, 1], [0, -1]]),\n            \"dt\": 0.5,\n            \"currents\": [np.array([2.0, 1.0]), np.array([0.0, -1.0]), np.array([-2.0, 0.0])],\n            \"charges\": [\n                np.array([0.0, 0.0, 0.0]),\n                np.array([-1.0, 0.5, 0.5]),\n                np.array([-1.0, 1.0, 0.0]),\n                np.array([0.0, 0.0, 0.0])\n            ]\n        }\n    ]\n\n    def calculate_max_residual(case):\n        \"\"\"\n        Calculates the maximum absolute residual for a single test case.\n\n        The residual R_nj for triangle n and interval j is given by:\n        R_nj = (Q_nj - Q_n,j-1) + dt * sum_i(S_ni * I_ij)\n        where Q_nj is the integrated charge on triangle n at the end of interval j,\n        I_ij is the current coefficient for edge i during interval j, and S is the\n        adjacency-orientation matrix.\n        \"\"\"\n        S = case[\"S\"]\n        dt = case[\"dt\"]\n        currents_per_interval = case[\"currents\"]\n        charges_at_time_points = case[\"charges\"]\n        \n        num_intervals = len(currents_per_interval)\n        max_abs_residual = 0.0\n\n        for j in range(num_intervals):\n            # Q_j-1: charge at the start of interval j (time t_j)\n            Q_j_minus_1 = charges_at_time_points[j]\n            # Q_j: charge at the end of interval j (time t_j+1)\n            Q_j = charges_at_time_points[j+1]\n            # I_j: current coefficients during interval j\n            I_j = currents_per_interval[j]\n            \n            # Change in stored charge on each triangle over the interval\n            delta_Q_stored = Q_j - Q_j_minus_1\n            \n            # Total charge flow from currents on each triangle over the interval\n            # S @ I_j calculates the net current flux for each triangle\n            delta_Q_flow = dt * (S @ I_j)\n            \n            # Residual vector for the current interval\n            residual_vector = delta_Q_stored + delta_Q_flow\n            \n            # Update the maximum absolute residual found so far\n            current_max = np.max(np.abs(residual_vector))\n            if current_max > max_abs_residual:\n                max_abs_residual = current_max\n                \n        return max_abs_residual\n\n    results = []\n    for case in test_cases:\n        result = calculate_max_residual(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.17f}'.rstrip('0').rstrip('.') for r in results)}]\")\n\nsolve()\n```", "id": "3355680"}]}