{"hands_on_practices": [{"introduction": "在使用任何显式时间步进算法时，首要任务是确保数值稳定性，以防止模拟结果无限发散。本练习将引导您推导有限积分技术（FIT）中著名的Courant–Friedrichs–Lewy（CFL）条件，这是显式时域电磁仿真的基石。通过执行冯·诺依曼稳定性分析，您将揭示最大允许时间步长与网格间距及材料属性（如介电常数 $\\varepsilon$ 和磁导率 $\\mu$）之间的内在联系，这是设置稳定可靠的数值模拟所必需掌握的核心技能。[@problem_id:3307640]", "problem": "给定一个无源、均匀、各向同性的介质，其介电常数为 $\\varepsilon$，磁导率为 $\\mu$。该介质在空间上通过有限积分技术 (FIT) 在间距为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 的均匀笛卡尔主/对偶网格上进行离散。时间推进采用显式蛙跳格式，并假设采用周期性边界条件，以便进行离散傅里叶 (von Neumann) 分析。\n\n从麦克斯韦方程组的积分形式和将边积分电场未知量与面积分通量通过关联矩阵耦合的核心FIT拓扑定律出发，完成以下任务：\n\n- 针对无源、无损介质，根据离散旋度的关联算子和由均匀笛卡尔网格导出的对角材料矩阵，推导半离散FIT系统。\n- 为电场和磁场的边未知量构建显式蛙跳时间步进格式，并利用空间和时间上可分离的平面波拟设进行 von Neumann 分析。利用此分析推导时间步长 $\\Delta t$ 的稳定性要求（Courant–Friedrichs–Lewy (CFL) 条件），该条件保证对于所有可分辨的波矢，离散时间模式都是纯振荡的。\n- 明确展示该界限如何依赖于 $\\varepsilon$、$\\mu$、$\\Delta x$、$\\Delta y$ 和 $\\Delta z$，并提取最大稳定时间步长 $\\Delta t_{\\max}$ 的闭式表达式。\n\n答案规格：以单一的闭式解析表达式提供 $\\Delta t_{\\max}$。答案以秒为单位表示。不要四舍五入。", "solution": "该问题要求推导在均匀笛卡尔网格上，应用显式蛙跳时间步进格式的有限积分技术 (FIT) 求解麦克斯韦方程组时，其最大稳定时间步长 $\\Delta t_{\\max}$。推导过程首先建立半离散系统，然后应用 von Neumann 稳定性分析。\n\n### 步骤 1：半离散FIT方程\n我们从无源、无损、均匀、各向同性介质的麦克斯韦方程组的积分形式开始：\n$$\n\\oint_{\\partial A} \\mathbf{E} \\cdot d\\mathbf{l} = -\\frac{d}{dt}\\iint_{A} \\mathbf{B} \\cdot d\\mathbf{S} \\quad (\\text{法拉第定律})\n$$\n$$\n\\oint_{\\partial \\tilde{A}} \\mathbf{H} \\cdot d\\tilde{\\mathbf{l}} = \\frac{d}{dt}\\iint_{\\tilde{A}} \\mathbf{D} \\cdot d\\tilde{\\mathbf{S}} \\quad (\\text{安培定律})\n$$\n在有限积分技术中，这些方程被投影到主网格及其交错的对偶网格上。场量由这些网格单元上的积分值表示。令 $\\mathbf{e}$ 为电场的主网格边路径积分（电压）的矢量，$\\tilde{\\mathbf{h}}$ 为磁场的对偶网格边路径积分（磁动势）的矢量。离散旋度算子由拓扑关联矩阵 $\\mathbf{C}$（主网格）和 $\\tilde{\\mathbf{C}}$（对偶网格）表示，其中 $\\tilde{\\mathbf{C}} = -\\mathbf{C}^T$。法拉第定律和安培定律的半离散形式为：\n$$\n\\mathbf{C} \\mathbf{e} = -\\frac{d\\tilde{\\mathbf{b}}}{dt}\n$$\n$$\n\\tilde{\\mathbf{C}} \\tilde{\\mathbf{h}} = \\frac{d\\mathbf{d}}{dt}\n$$\n此处，$\\tilde{\\mathbf{b}}$ 是通过对偶面的磁通量矢量，$\\mathbf{d}$ 是通过主网格面的电通量矢量。本构关系 $\\mathbf{D} = \\varepsilon\\mathbf{E}$ 和 $\\mathbf{B} = \\mu\\mathbf{H}$ 使用对角材料矩阵 $\\mathbf{M}_{\\varepsilon}$ 和 $\\mathbf{M}_{\\mu}$ 进行离散化：\n$$\n\\mathbf{d} = \\mathbf{M}_{\\varepsilon} \\mathbf{e}\n$$\n$$\n\\tilde{\\mathbf{b}} = \\mathbf{M}_{\\mu} \\tilde{\\mathbf{h}}\n$$\n将这些代入离散麦克斯韦方程组，并使用 $\\tilde{\\mathbf{C}} = -\\mathbf{C}^T$，得到用 $\\mathbf{e}$ 和 $\\tilde{\\mathbf{h}}$ 表示的半离散系统：\n$$\n\\frac{d}{dt}(\\mathbf{M}_{\\mu} \\tilde{\\mathbf{h}}) = -\\mathbf{C} \\mathbf{e}\n$$\n$$\n\\frac{d}{dt}(\\mathbf{M}_{\\varepsilon} \\mathbf{e}) = \\mathbf{C}^T \\tilde{\\mathbf{h}}\n$$\n对于均匀介质，$\\varepsilon$ 和 $\\mu$ 是常数。材料矩阵是对角矩阵，其元素由网格几何形状决定。对于均匀笛卡尔 (Yee) 网格，材料矩阵中的这些几何因子和离散旋度算子以某种方式组合，使得方程与标准的FDTD方程相同。具体来说，系统简化为：\n$$\n\\mu \\frac{d\\mathbfH}{dt} = -\\nabla_d \\times \\mathbf{E}\n$$\n$$\n\\varepsilon \\frac{d\\mathbf{E}}{dt} = \\nabla_d \\times \\mathbf{H}\n$$\n其中 $\\mathbf{E}$ 和 $\\mathbf{H}$ 现在是场分量本身在其各自Yee网格位置上的矢量，而 $\\nabla_d \\times$ 是相应的离散旋度算子。\n\n### 步骤 2：蛙跳时间离散化\n蛙跳格式以步长 $\\Delta t$ 对时间进行离散化，在整数时间步 $n$ 处计算 $\\mathbf{E}$，在半整数时间步 $n+1/2$ 处计算 $\\mathbf{H}$。时间导数由中心差分近似：\n$$\n\\mu \\frac{\\mathbf{H}^{n+1/2} - \\mathbf{H}^{n-1/2}}{\\Delta t} = -\\nabla_d \\times \\mathbf{E}^n\n$$\n$$\n\\varepsilon \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t} = \\nabla_d \\times \\mathbf{H}^{n+1/2}\n$$\n我们可以消去 $\\mathbf{H}$，得到一个只关于 $\\mathbf{E}$ 的二阶更新方程：\n$$\n\\mathbf{E}^{n+1} = \\mathbf{E}^n + \\frac{\\Delta t}{\\varepsilon} \\nabla_d \\times \\mathbf{H}^{n+1/2}\n$$\n代入 $\\mathbf{H}^{n+1/2} = \\mathbf{H}^{n-1/2} - \\frac{\\Delta t}{\\mu} \\nabla_d \\times \\mathbf{E}^n$ 的更新式：\n$$\n\\mathbf{E}^{n+1} = \\mathbf{E}^n + \\frac{\\Delta t}{\\varepsilon} \\nabla_d \\times \\left( \\mathbf{H}^{n-1/2} - \\frac{\\Delta t}{\\mu} \\nabla_d \\times \\mathbf{E}^n \\right)\n$$\n从上一个时间步的电场更新中，我们可知 $\\frac{\\Delta t}{\\varepsilon} \\nabla_d \\times \\mathbf{H}^{n-1/2} = \\mathbf{E}^n - \\mathbf{E}^{n-1}$，因此得到：\n$$\n\\mathbf{E}^{n+1} = \\mathbf{E}^n + (\\mathbf{E}^n - \\mathbf{E}^{n-1}) - \\frac{\\Delta t^2}{\\varepsilon\\mu} (\\nabla_d \\times \\nabla_d \\times \\mathbf{E}^n)\n$$\n整理后得到离散电场的最终波动方程：\n$$\n\\frac{\\mathbf{E}^{n+1} - 2\\mathbf{E}^n + \\mathbf{E}^{n-1}}{\\Delta t^2} = \\frac{1}{\\varepsilon\\mu} \\nabla_d \\times \\nabla_d \\times \\mathbf{E}^n\n$$\n\n### 步骤 3：Von Neumann 稳定性分析\n我们通过在网格上假设一个平面波解（拟设）来测试稳定性。由于周期性边界条件，我们可以分析单一空间傅里叶模式：\n$$\n\\mathbf{E}^n(\\mathbf{r}) = \\mathbf{E}_0 e^{i(\\mathbf{k} \\cdot \\mathbf{r})} (Z)^n\n$$\n其中 $\\mathbf{k} = (k_x, k_y, k_z)$ 是波矢，$\\mathbf{r}$ 是位置矢量，$Z = e^{-i\\omega \\Delta t}$ 是每个时间步的放大因子。对于一个稳定、非耗散的格式，我们要求 $|Z| = 1$。\n\n离散旋度算子作用于平面波的结果可以通过将空间导数替换为其有限差分对应项来找到。对于 Yee 网格，像 $\\frac{\\partial}{\\partial x}$ 这样的中心差分在傅里叶域中变为乘以 $i\\hat{k}_x$，其中：\n$$\n\\hat{k}_u = \\frac{2}{\\Delta u} \\sin\\left(\\frac{k_u \\Delta u}{2}\\right) \\quad \\text{ for } u \\in \\{x,y,z\\}\n$$\n算子 $\\nabla_d \\times$ 变为乘以 $i\\mathbf{K} \\times$，其中 $\\mathbf{K} = (\\hat{k}_x, \\hat{k}_y, \\hat{k}_z)$。算子 $\\nabla_d \\times \\nabla_d \\times$ 变为乘以 $(i\\mathbf{K} \\times)(i\\mathbf{K} \\times \\cdot) = -\\mathbf{K} \\times (\\mathbf{K} \\times \\cdot)$。\n将拟设代入离散波动方程，得到：\n$$\n\\frac{Z - 2 + Z^{-1}}{\\Delta t^2} \\mathbf{E}_0 = \\frac{1}{\\varepsilon\\mu} \\left( -\\mathbf{K} \\times (\\mathbf{K} \\times \\mathbf{E}_0) \\right)\n$$\n使用矢量恒等式 $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$：\n$$\n\\frac{Z^{-1}(Z-1)^2}{\\Delta t^2} \\mathbf{E}_0 = \\frac{1}{\\varepsilon\\mu} \\left( -\\mathbf{K}(\\mathbf{K} \\cdot \\mathbf{E}_0) + \\mathbf{E}_0 (\\mathbf{K} \\cdot \\mathbf{K}) \\right)\n$$\n对于横电磁波，$\\mathbf{K} \\cdot \\mathbf{E}_0 = 0$。方程简化为：\n$$\n\\frac{Z^{-1}(Z-1)^2}{\\Delta t^2} = \\frac{|\\mathbf{K}|^2}{\\varepsilon\\mu}\n$$\n其中 $|\\mathbf{K}|^2 = \\hat{k}_x^2 + \\hat{k}_y^2 + \\hat{k}_z^2$。令 $c = 1/\\sqrt{\\varepsilon\\mu}$ 为介质中的光速。\n$$\n(Z-1)^2 = - (c \\Delta t |\\mathbf{K}|)^2 Z\n$$\n$$\nZ^2 - 2Z + 1 = - (c \\Delta t |\\mathbf{K}|)^2 Z\n$$\n$$\nZ^2 + \\left( (c \\Delta t |\\mathbf{K}|)^2 - 2 \\right) Z + 1 = 0\n$$\n这是一个关于 $Z$ 的二次方程。其解在单位圆上的充要条件是判别式非正：\n$$\n\\left( (c \\Delta t |\\mathbf{K}|)^2 - 2 \\right)^2 - 4 \\le 0\n$$\n$$\n-2 \\le (c \\Delta t |\\mathbf{K}|)^2 - 2 \\le 2\n$$\n$$\n0 \\le (c \\Delta t |\\mathbf{K}|)^2 \\le 4\n$$\n由于 $(c \\Delta t |\\mathbf{K}|)^2$ 总是非负的，稳定性条件为：\n$$\nc \\Delta t |\\mathbf{K}| \\le 2 \\implies \\Delta t \\le \\frac{2}{c |\\mathbf{K}|}\n$$\n此条件必须对所有可能的波矢 $\\mathbf{k}$ 成立。因此，稳定性由 $|\\mathbf{K}|$ 的最大值决定。\n$$\n\\Delta t_{\\max} = \\frac{2}{c |\\mathbf{K}|_{\\max}}\n$$\n\n### 步骤 4：推导最大稳定时间步长\n为了求得 $|\\mathbf{K}|_{\\max}$，我们必须找到 $|\\mathbf{K}|^2 = \\hat{k}_x^2 + \\hat{k}_y^2 + \\hat{k}_z^2$ 的最大值：\n$$\n|\\mathbf{K}|^2 = \\left(\\frac{2}{\\Delta x}\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)\\right)^2 + \\left(\\frac{2}{\\Delta y}\\sin\\left(\\frac{k_y\\Delta y}{2}\\right)\\right)^2 + \\left(\\frac{2}{\\Delta z}\\sin\\left(\\frac{k_z\\Delta z}{2}\\right)\\right)^2\n$$\n正弦函数达到其最大值 $1$。这发生在网格可以分辨的最高空间频率（奈奎斯特频率）处，即 $k_u \\Delta u = \\pi$。因此，每一项的最大值在 $\\sin^2(\\frac{k_u\\Delta u}{2}) = 1$ 时达到。\n$$\n|\\mathbf{K}|_{\\max}^2 = \\left(\\frac{2}{\\Delta x}\\right)^2 + \\left(\\frac{2}{\\Delta y}\\right)^2 + \\left(\\frac{2}{\\Delta z}\\right)^2 = 4\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}\\right)\n$$\n取平方根：\n$$\n|\\mathbf{K}|_{\\max} = 2\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}\n$$\n将此代入 $\\Delta t_{\\max}$ 的表达式中：\n$$\n\\Delta t_{\\max} = \\frac{2}{c \\left(2\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}\\right)} = \\frac{1}{c\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}}\n$$\n最后，代入 $c=1/\\sqrt{\\varepsilon\\mu}$，我们得到三维 FIT/FDTD 方法的 Courant–Friedrichs–Lewy (CFL) 条件：\n$$\n\\Delta t_{\\max} = \\frac{\\sqrt{\\varepsilon\\mu}}{\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}} = \\sqrt{\\varepsilon\\mu} \\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}\\right)^{-1/2}\n$$\n该表达式给出了显式蛙跳格式保持数值稳定性的最大时间步长 $\\Delta t$。", "answer": "$$\\boxed{\\sqrt{\\varepsilon\\mu} \\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}\\right)^{-1/2}}$$", "id": "3307640"}, {"introduction": "在保证了数值稳定性之后，我们自然会关注模拟的准确性。本练习深入探讨了数值色散现象，即离散化网格本身会如何改变波的传播特性，这是理解FIT方法精度的关键。通过分析沿立方体晶格对角线传播的平面波，您将学习如何量化由离散化引入的相位速度和群速度误差。这项实践将使您深刻理解数值各向异性（即波速依赖于传播方向的现象），并掌握评估和预测模拟精度的重要工具。[@problem_id:3307682]", "problem": "考虑在三维、均匀、正交真空中晶格上对麦克斯韦方程组进行有限积分法（FIT）半离散化，各笛卡尔方向上的晶格间距为 $\\,\\Delta\\,$，时间步长为 $\\,\\Delta t\\,$。设真空介电常数为 $\\,\\varepsilon_{0}\\,$，真空磁导率为 $\\,\\mu_{0}\\,$，光速为 $\\,c = 1/\\sqrt{\\varepsilon_{0}\\mu_{0}}\\,$。电场自由度与主边相关联，磁场自由度与对偶边相关联，时间步进采用蛙跳格式。假定波矢量与立方晶格的体对角线对齐。具体来说，设物理波数值为 $\\,k\\,$，其笛卡尔分量满足 $\\,k_{x} = k_{y} = k_{z} = k/\\sqrt{3}\\,$。假设空间和时间上均为平面波解。\n\n从法拉第定律和安培-麦克斯韦定律的积分形式以及 FIT 拓扑离散化出发，推导这些沿晶格体对角线传播的平面波的数值色散关系。利用此色散关系，定义 Courant–Friedrichs–Lewy (CFL) 稳定性数 $\\,S = c\\,\\Delta t / \\Delta\\,$ 和无量纲波数 $\\,\\xi = k\\,\\Delta\\,$，并计算相对相速度误差\n$$\\delta_{p} = \\frac{v_{p}}{c} - 1$$\n和相对群速度误差\n$$\\delta_{g} = \\frac{v_{g}}{c} - 1$$\n的闭式解析表达式，其中 $\\,v_{p} = \\omega/k\\,$ 和 $\\,v_{g} = \\mathrm{d}\\omega/\\mathrm{d}k\\,$ 是从推导出的色散关系中提取的数值相速度和群速度，$\\,\\omega\\,$ 是数值角频率。将所有三角函数参数视为弧度，并用 $\\,S\\,$ 和 $\\,\\xi\\,$ 符号化地表示 $\\,\\delta_{p}\\,$ 和 $\\,\\delta_{g}\\,$。请将您的最终结果以包含 $\\,\\delta_{p}\\,$ 和 $\\,\\delta_{g}\\,$ 的单行矩阵形式提供。无需进行数值四舍五入。", "solution": "该问题是有效的，因为它在科学上基于计算电磁学的原理，是适定的，并且陈述客观。我们开始求解。\n\n在均匀正交晶格上的有限积分法（FIT）等效于在 Yee 晶格上的时域有限差分（FDTD）方法。对于一个时间依赖性为 $\\exp(-i\\omega t)$、空间依赖性为 $\\exp(i\\vec{k} \\cdot \\vec{r})$ 的平面波，蛙跳时间步进格式和空间中心差分导致麦克斯韦方程组中的偏导数有如下算子代换：\n$$ \\frac{\\partial}{\\partial t} \\rightarrow \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n$$ \\nabla \\rightarrow i\\vec{K} $$\n其中 $\\vec{K}$ 是数值波矢量，其分量为\n$$ K_j = \\frac{2}{\\Delta} \\sin\\left(\\frac{k_j \\Delta}{2}\\right) \\quad \\text{for } j \\in \\{x, y, z\\} $$\n这里，$\\omega$ 是数值角频率，$\\vec{k} = (k_x, k_y, k_z)$ 是物理波矢量，$\\Delta t$ 是时间步长，$\\Delta$ 是均匀晶格间距。\n\n在无源真空（$\\vec{D}=\\varepsilon_0\\vec{E}$, $\\vec{B}=\\mu_0\\vec{H}$）中，麦克斯韦的旋度方程为：\n$$ \\nabla \\times \\vec{E} = -\\frac{\\partial \\vec{B}}{\\partial t} \\quad \\implies \\quad \\nabla \\times \\vec{E} = -\\mu_0 \\frac{\\partial \\vec{H}}{\\partial t} $$\n$$ \\nabla \\times \\vec{H} = \\frac{\\partial \\vec{D}}{\\partial t} \\quad \\implies \\quad \\nabla \\times \\vec{H} = \\varepsilon_0 \\frac{\\partial \\vec{E}}{\\partial t} $$\n对平面波解（$\\vec{E}(\\vec{r},t) = \\vec{E}_0 e^{i(\\vec{k}\\cdot\\vec{r}-\\omega t)}$, $\\vec{H}(\\vec{r},t) = \\vec{H}_0 e^{i(\\vec{k}\\cdot\\vec{r}-\\omega t)}$）应用 FDTD/FIT 算子代换，得到代数系统：\n$$ i\\vec{K} \\times \\vec{E}_0 = -\\mu_0 \\left( \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right) \\vec{H}_0 $$\n$$ i\\vec{K} \\times \\vec{H}_0 = \\varepsilon_0 \\left( \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right) \\vec{E}_0 $$\n化简，我们得到：\n$$ \\vec{K} \\times \\vec{E}_0 = \\frac{2\\mu_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{H}_0 $$\n$$ \\vec{K} \\times \\vec{H}_0 = -\\frac{2\\varepsilon_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{E}_0 $$\n将第二个方程代入第一个方程的旋度中：\n$$ \\vec{K} \\times (\\vec{K} \\times \\vec{E}_0) = \\frac{2\\mu_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) (\\vec{K} \\times \\vec{H}_0) $$\n$$ \\vec{K}(\\vec{K} \\cdot \\vec{E}_0) - (\\vec{K} \\cdot \\vec{K})\\vec{E}_0 = \\frac{2\\mu_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\left(-\\frac{2\\varepsilon_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{E}_0\\right) $$\n对于横电磁波，数值散度为零（$\\vec{K} \\cdot \\vec{E}_0 = 0$），导致：\n$$ -|\\vec{K}|^2 \\vec{E}_0 = -\\frac{4\\mu_0\\varepsilon_0}{(\\Delta t)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{E}_0 $$\n使用真空光速的关系式 $c = 1/\\sqrt{\\varepsilon_0\\mu_0}$，我们得到数值色散关系：\n$$ |\\vec{K}|^2 = \\frac{1}{c^2} \\left(\\frac{2}{\\Delta t}\\right)^2 \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n代入 $\\vec{K}$ 分量的表达式：\n$$ \\left(\\frac{2}{\\Delta}\\right)^2 \\left( \\sin^2\\left(\\frac{k_x\\Delta}{2}\\right) + \\sin^2\\left(\\frac{k_y\\Delta}{2}\\right) + \\sin^2\\left(\\frac{k_z\\Delta}{2}\\right) \\right) = \\frac{4}{(c\\Delta t)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n问题指明传播方向沿立方晶格的体对角线，因此 $k_x = k_y = k_z = k/\\sqrt{3}$。该关系变为：\n$$ \\frac{1}{\\Delta^2} \\left( 3 \\sin^2\\left(\\frac{(k/\\sqrt{3})\\Delta}{2}\\right) \\right) = \\frac{1}{(c\\Delta t)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n给定 Courant–Friedrichs–Lewy (CFL) 稳定性数 $S = c\\Delta t/\\Delta$ 和无量纲波数 $\\xi = k\\Delta$。代入这些定义：\n$$ \\frac{3}{\\Delta^2} \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right) = \\frac{1}{(S\\Delta)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n$$ 3 S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right) = \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n为前向传播波取正根，得到数值色散关系的最终形式：\n$$ \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right) $$\n由此，我们可以将数值角频率 $\\omega$ 表示为波数 $k$（或 $\\xi$）的函数：\n$$ \\omega(k) = \\frac{2}{\\Delta t} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)\\right) $$\n\n接下来，我们计算相对相速度误差 $\\delta_p = v_p/c - 1$。数值相速度为 $v_p = \\omega/k$。\n$$ \\frac{v_p}{c} = \\frac{\\omega}{kc} = \\frac{1}{kc} \\left[ \\frac{2}{\\Delta t} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)\\right) \\right] $$\n使用关系式 $S = c\\Delta t/\\Delta$ 和 $\\xi = k\\Delta$，我们可以写出 $kc = (k\\Delta) (c\\Delta t/\\Delta) / \\Delta t = \\xi S / \\Delta t$。\n$$ \\frac{v_p}{c} = \\frac{\\Delta t}{\\xi S} \\left[ \\frac{2}{\\Delta t} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) \\right] = \\frac{2}{\\xi S} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) $$\n因此，相对相速度误差为：\n$$ \\delta_p = \\frac{2}{\\xi S} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) - 1 $$\n\n现在，我们计算相对群速度误差 $\\delta_g = v_g/c - 1$。数值群速度为 $v_g = \\mathrm{d}\\omega/\\mathrm{d}k$。我们可以通过对色散关系关于 $k$ 进行隐式微分来求得：\n$$ \\frac{d}{dk}\\left[\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right] = \\frac{d}{dk}\\left[\\sqrt{3} S \\sin\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)\\right] $$\n$$ \\cos\\left(\\frac{\\omega \\Delta t}{2}\\right) \\cdot \\frac{\\Delta t}{2} \\cdot \\frac{d\\omega}{dk} = \\sqrt{3} S \\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right) \\cdot \\frac{\\Delta}{2\\sqrt{3}} $$\n$$ \\cos\\left(\\frac{\\omega \\Delta t}{2}\\right) \\frac{\\Delta t}{2} v_g = S \\frac{\\Delta}{2} \\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right) $$\n求解 $v_g$：\n$$ v_g = \\frac{S\\Delta}{\\Delta t} \\frac{\\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)} $$\n由于 $c = S\\Delta/\\Delta t$，我们有 $v_g/c$：\n$$ \\frac{v_g}{c} = \\frac{\\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)} = \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right)}} $$\n使用色散关系 $\\sin(\\frac{\\omega \\Delta t}{2}) = \\sqrt{3} S \\sin(\\frac{\\xi}{2\\sqrt{3}})$：\n$$ \\frac{v_g}{c} = \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - 3S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}} $$\n因此，相对群速度误差为：\n$$ \\delta_g = \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - 3S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}} - 1 $$\n$\\delta_p$ 和 $\\delta_g$ 的最终结果按要求用 $S$ 和 $\\xi$ 符号化地表示。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2}{\\xi S} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) - 1  \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - 3S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}} - 1 \\end{pmatrix}}$$", "id": "3307682"}, {"introduction": "本练习是前面理论分析的综合与升华，旨在连接理论与实际应用。您将通过编写一个数值实验程序，将色散分析从纸面上的推导转化为一个强大的计算工具。这个程序将用于评估二维FIT网格的数值色散特性，并量化其各向异性误差。更进一步，您将基于这些分析设计一个优化指标，以确定能使最坏情况下的相位速度误差最小化的网格长宽比，这充分展示了理论分析如何直接指导工程实践，以实现更高精度的仿真设计。[@problem_id:3307696]", "problem": "构建一个程序，用于评估在均匀二维网格上采用电磁交错的有限积分技术 (FIT) 的数值平面波色散和角各向异性，并利用此分析将数值相速度面与解析自由空间关系进行比较，以及提出一种网格纵横比优化度量。推导和实现必须从麦克斯韦方程组及其在均匀网格上的 FIT 离散化开始，并且必须依赖平面波拟设来获得离散色散关系。比较必须对照解析自由空间关系进行，该关系由波数-频率关系 $|\\mathbf{k}| = \\omega \\sqrt{\\mu \\epsilon}$ 给出，等效于 $\\omega = c |\\mathbf{k}|$，其中 $c = 1/\\sqrt{\\mu \\epsilon}$。您必须在二维、均匀、各向同性的情况下工作，所有场和参数均以国际单位制 (SI) 表示：长度单位为米，时间单位为秒，磁导率单位为亨利每米，介电常数单位为法拉每米。角度必须以弧度为单位。\n\n您的程序必须实现以下内容，并且方式应完全自洽，不接受外部输入：\n\n1. 从麦克斯韦方程组的积分形式开始，在均匀笛卡尔网格上使用有限积分技术 (FIT) 进行离散化，其中电场电压配置在边上，磁通量配置在面上（电磁交错）。考虑二维情况，通过将形式为 $e^{\\mathrm{j}(k_x i \\Delta x + k_y j \\Delta y - \\omega n \\Delta t)}$ 的平面波拟设代入均匀网格 FIT 方程，可以提取出数值色散关系。时间步长必须满足二维网格的 Courant–Friedrichs–Lewy (CFL) 稳定性界限，并指定一个 Courant 分数 $s \\in (0, 1)$。二维的最大稳定时间步长为\n$$\n\\Delta t_{\\max} = \\frac{1}{c} \\frac{1}{\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}}} \\, ,\n$$\n您必须使用 $\\Delta t = s \\, \\Delta t_{\\max}$，其中 $c = 1/\\sqrt{\\mu \\epsilon}$。\n\n2. 对于给定的角波数大小 $K = |\\mathbf{k}|$ 和方向 $\\theta \\in [0, 2\\pi)$，定义分量 $k_x = K \\cos \\theta$ 和 $k_y = K \\sin \\theta$。使用 FIT 平面波色散关系，计算数值角频率 $\\omega_{\\text{num}}(\\theta)$，从而计算出数值相速度 $v_{\\text{p,num}}(\\theta) = \\omega_{\\text{num}}(\\theta)/K$。将 $v_{\\text{p,num}}(\\theta)$ 与解析自由空间相速度 $c$ 进行比较，并在 $\\theta \\in [0, 2\\pi)$ 上构建以下两个度量：\n- 最坏情况相对相速度误差\n$$\nM_{\\infty} = \\max_{\\theta} \\left| \\frac{v_{\\text{p,num}}(\\theta)}{c} - 1 \\right| \\, .\n$$\n- 各向异性跨度\n$$\nA = \\max_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right) - \\min_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right) \\, .\n$$\n这些都是无量纲的。使用 $N_{\\theta} = 720$ 个均匀间隔的角度，即 $\\theta_m = 2\\pi m / N_{\\theta}$，其中 $m = 0, 1, \\ldots, N_{\\theta}-1$。角度必须以弧度为单位。\n\n3. 选择波数大小为\n$$\nK = q \\, \\min\\left( \\frac{\\pi}{\\Delta x}, \\frac{\\pi}{\\Delta y} \\right) \\, ,\n$$\n其中预设的无量纲分数 $q \\in (0, 1)$ 用于设置在每个方向上使用的网格空间奈奎斯特波数的分数。这确保了对于所有角度，$k_x \\Delta x$ 和 $k_y \\Delta y$ 始终在 $(-\\pi, \\pi)$ 范围内。\n\n4. 定义一个旨在最小化最坏情况相速度误差的纵横比优化度量：\n$$\nJ(\\Delta x / \\Delta y) = M_{\\infty} \\, .\n$$\n给定一个固定的 $\\Delta y$ 和一个候选纵横比集合 $\\mathcal{R} = \\{0.5, 1.0, 2.0, 4.0\\}$，选择优化器\n$$\n\\left(\\frac{\\Delta x}{\\Delta y}\\right)^{\\star} = \\arg\\min_{r \\in \\mathcal{R}} J(r) \\, .\n$$\n若出现平局，必须选择最小的 $r$ 来打破。\n\n5. 物理常数：使用 $\\mu = \\mu_0 = 4\\pi \\times 10^{-7} \\, \\mathrm{H/m}$ 和 $\\epsilon = \\epsilon_0 = 8.854187817 \\times 10^{-12} \\, \\mathrm{F/m}$。\n\n测试套件和必需输出：\n- 对于下面的每个测试用例，计算并返回一个包含三个条目 $[M_{\\infty}, A, r^{\\star}]$ 的列表，其中 $r^{\\star}$ 是从 $\\{0.5, 1.0, 2.0, 4.0\\}$ 中选择的优化纵横比 $\\Delta x/\\Delta y$，该选择使用第 4 项中的度量，并采用与该测试用例相同的 $s$ 和 $q$ 值，以及 $\\Delta y = 10^{-3} \\, \\mathrm{m}$。\n- 将所有浮点输出四舍五入到 6 位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身也是一个使用相同方括号和逗号格式的列表。\n\n测试用例（所有长度单位为米，时间单位为秒，角度单位为弧度）：\n- 用例 1：$\\Delta x = 10^{-3}$，$\\Delta y = 10^{-3}$，$s = 0.99$，$q = 0.4$。\n- 用例 2：$\\Delta x = 2 \\times 10^{-3}$，$\\Delta y = 10^{-3}$，$s = 0.99$，$q = 0.4$。\n- 用例 3：$\\Delta x = 4 \\times 10^{-3}$，$\\Delta y = 10^{-3}$，$s = 0.50$，$q = 0.4$。\n- 用例 4：$\\Delta x = 10^{-3}$，$\\Delta y = 10^{-3}$，$s = 0.99$，$q = 0.05$。\n- 用例 5：$\\Delta x = 10^{-3}$，$\\Delta y = 10^{-3}$，$s = 0.99$，$q = 0.8$。\n\n最终输出格式：\n- 一个包含五个条目的列表的单行输出，每个条目是对应测试用例的列表 $[M_{\\infty}, A, r^{\\star}]$，所有浮点数均四舍五入到 6 位小数。例如，一个语法上有效的行看起来会是 $[[0.001234,0.002468,1.0],[\\dots],\\dots]$（这只是一个例子；您的程序必须计算实际值）。", "solution": "问题陈述在科学上是合理的、自洽的且定义明确的。它基于电磁学的基本原理和有限积分技术 (FIT) 的标准数值分析，FIT 是计算电磁学的基石。所有参数、常数和评估度量都经过了精确的数学定义。任务是推导二维 FIT 的数值色散关系，并随后用它来评估网格性能和优化网格纵横比。问题是有效的，将提供一个解决方案。\n\n分析始于二维、无源、均匀、各向同性介质中的麦克斯韦方程组。为简单起见且不失一般性，我们考虑横磁 ($TM_z$) 极化，其场分量为 $\\mathbf{E} = (E_x, E_y, 0)$ 和 $\\mathbf{H} = (0, 0, H_z)$。控制方程为：\n$$\n\\epsilon \\frac{\\partial E_x}{\\partial t} = \\frac{\\partial H_z}{\\partial y}\n$$\n$$\n\\epsilon \\frac{\\partial E_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x}\n$$\n$$\n\\mu \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_x}{\\partial y} - \\frac{\\partial E_y}{\\partial x}\n$$\n其中 $\\epsilon$ 是介质的介电常数，$\\mu$ 是介质的磁导率。\n\n在网格间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀笛卡尔网格上的有限积分技术等效于使用 Yee 晶格的时域有限差分 (FDTD) 方法。该方案对空间和时间导数均采用中心差分，从而形成蛙跳法时间步进算法。离散化方程为：\n$$\n\\epsilon \\frac{E_x\\big|_{i, j+1/2}^{n+1} - E_x\\big|_{i, j+1/2}^{n}}{\\Delta t} = \\frac{H_z\\big|_{i, j+1}^{n+1/2} - H_z\\big|_{i, j}^{n+1/2}}{\\Delta y}\n$$\n$$\n\\epsilon \\frac{E_y\\big|_{i+1/2, j}^{n+1} - E_y\\big|_{i+1/2, j}^{n}}{\\Delta t} = -\\frac{H_z\\big|_{i+1, j}^{n+1/2} - H_z\\big|_{i, j}^{n+1/2}}{\\Delta x}\n$$\n$$\n\\mu \\frac{H_z\\big|_{i, j}^{n+1/2} - H_z\\big|_{i, j}^{n-1/2}}{\\Delta t} = \\frac{E_x\\big|_{i, j+1/2}^{n} - E_x\\big|_{i, j-1/2}^{n}}{\\Delta y} - \\frac{E_y\\big|_{i+1/2, j}^{n} - E_y\\big|_{i-1/2, j}^{n}}{\\Delta x}\n$$\n此处，$(i, j)$ 表示网格索引，$n$ 是时间索引，半整数索引表示场分量的空间和时间交错。\n\n为了找到数值色散关系，我们为每个场分量代入一个平面波拟设，其形式为以波矢量 $\\mathbf{k} = (k_x, k_y)$ 和角频率 $\\omega_{\\text{num}}$ 传播的离散平面波。考虑到交错，该拟设为：\n$$\nE_x\\big|_{i, j+1/2}^{n} = E_{x0} e^{\\mathrm{j}(k_x i \\Delta x + k_y (j+1/2) \\Delta y - \\omega_{\\text{num}} n \\Delta t)}\n$$\n$$\nE_y\\big|_{i+1/2, j}^{n} = E_{y0} e^{\\mathrm{j}(k_x (i+1/2) \\Delta x + k_y j \\Delta y - \\omega_{\\text{num}} n \\Delta t)}\n$$\n$$\nH_z\\big|_{i, j}^{n+1/2} = H_{z0} e^{\\mathrm{j}(k_x i \\Delta x + k_y j \\Delta y - \\omega_{\\text{num}} (n+1/2) \\Delta t)}\n$$\n将这些代入离散化的麦克斯韦方程组，差分算子将转换为三角函数。例如，$H_z$ 的时间导数项变为：\n$$\n\\frac{H_z\\big|_{i,j}^{n+1/2} - H_z\\big|_{i,j}^{n-1/2}}{\\Delta t} \\rightarrow H_{z0} e^{\\mathrm{j}(\\dots)} \\frac{e^{\\mathrm{j}\\omega_{\\text{num}}\\Delta t/2} - e^{-\\mathrm{j}\\omega_{\\text{num}}\\Delta t/2}}{\\Delta t} = H_{z0} e^{\\mathrm{j}(\\dots)} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t}\n$$\n对所有项应用此过程并简化后，我们得到一个关于振幅 $E_{x0}$、$E_{y0}$ 和 $H_{z0}$ 的线性代数方程组：\n$$\n\\epsilon E_{x0} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} = H_{z0} \\frac{2\\mathrm{j} \\sin(k_y\\Delta y/2)}{\\Delta y}\n$$\n$$\n\\epsilon E_{y0} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} = -H_{z0} \\frac{2\\mathrm{j} \\sin(k_x\\Delta x/2)}{\\Delta x}\n$$\n$$\n\\mu H_{z0} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} = E_{x0} \\frac{2\\mathrm{j} \\sin(k_y\\Delta y/2)}{\\Delta y} - E_{y0} \\frac{2\\mathrm{j} \\sin(k_x\\Delta x/2)}{\\Delta x}\n$$\n为使非平凡解存在，该系统的行列式必须为零。将前两个方程中 $E_{x0}$ 和 $E_{y0}$ 的表达式代入第三个方程，即可得到数值色散关系：\n$$\n\\mu\\epsilon \\left( \\frac{\\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} \\right)^2 = \\left( \\frac{\\sin(k_x\\Delta x/2)}{\\Delta x} \\right)^2 + \\left( \\frac{\\sin(k_y\\Delta y/2)}{\\Delta y} \\right)^2\n$$\n使用自由空间光速 $c = 1/\\sqrt{\\mu\\epsilon}$，我们可以解出数值角频率 $\\omega_{\\text{num}}$：\n$$\n\\omega_{\\text{num}}(\\theta) = \\frac{2}{\\Delta t} \\arcsin\\left( c \\Delta t \\sqrt{ \\left(\\frac{\\sin(k_x\\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y\\Delta y/2)}{\\Delta y}\\right)^2 } \\right)\n$$\n其中对于给定的波数大小 $K = |\\mathbf{k}|$ 和传播角度 $\\theta$，$k_x = K \\cos\\theta$ 和 $k_y = K \\sin\\theta$。为保证稳定性，反正弦函数的参数必须小于或等于 $1$，这直接导出了所提供的 Courant–Friedrichs–Lewy (CFL) 条件：$\\Delta t \\le \\Delta t_{\\max} = \\frac{1}{c} (\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2})^{-1/2}$。问题指定使用时间步长 $\\Delta t = s \\Delta t_{\\max}$，其中 Courant 分数 $s \\in (0,1)$，这保证了稳定性。\n\n数值相速度是 $v_{\\text{p,num}}(\\theta) = \\omega_{\\text{num}}(\\theta)/K$。在理想的连续介质中，相速度是恒定的，等于 $c$，与方向无关。数值网格引入了色散（对 $K$ 的依赖性）和各向异性（对 $\\theta$ 的依赖性）。我们使用两个度量来量化这些效应：\n最坏情况相对相速度误差，它衡量与物理光速的最大偏差：\n$$\nM_{\\infty} = \\max_{\\theta} \\left| \\frac{v_{\\text{p,num}}(\\theta)}{c} - 1 \\right|\n$$\n各向异性跨度，它衡量归一化相速度在所有方向上的总变化量：\n$$\nA = \\max_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right) - \\min_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right)\n$$\n波数大小 $K$ 是相对于网格的空间奈奎斯特极限设置的，$K = q \\, \\min( \\pi/\\Delta x, \\pi/\\Delta y )$，其中 $q \\in (0,1)$ 是一个无量纲分数。这确保了波被网格充分解析。\n\n最后，具有给定纵横比 $r = \\Delta x / \\Delta y$ 的网格的质量通过优化度量 $J(r) = M_{\\infty}$ 进行评估。从候选集合 $\\mathcal{R}$ 中选出的最佳纵横比 $r^{\\star}$ 是使这个最坏情况误差最小化的那一个：\n$$\nr^{\\star} = \\left(\\frac{\\Delta x}{\\Delta y}\\right)^{\\star} = \\arg\\min_{r \\in \\mathcal{R}} J(r)\n$$\n下面的实现将为指定的测试用例计算这些量。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_dispersion_metrics(dx, dy, s, q, c0, N_theta):\n    \"\"\"\n    Calculates the numerical dispersion metrics M_infinity and A for given FIT parameters.\n\n    Args:\n        dx (float): Grid spacing in x-direction (m).\n        dy (float): Grid spacing in y-direction (m).\n        s (float): Courant fraction.\n        q (float): Wavenumber fraction of Nyquist limit.\n        c0 (float): Speed of light in vacuum (m/s).\n        N_theta (int): Number of angles for evaluation.\n\n    Returns:\n        tuple[float, float]: A tuple containing M_infinity and A.\n    \"\"\"\n    # 1. Calculate numerical time step based on the CFL condition\n    dt_max = (1 / c0) / np.sqrt(1 / dx**2 + 1 / dy**2)\n    dt = s * dt_max\n\n    # 2. Define wave propagation characteristics\n    # Wavenumber magnitude relative to the grid's Nyquist frequency\n    K = q * min(np.pi / dx, np.pi / dy)\n    \n    # Discretize propagation angles\n    theta = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    kx = K * np.cos(theta)\n    ky = K * np.sin(theta)\n\n    # 3. Calculate the numerical dispersion relation\n    # The term inside the arcsin in the dispersion relation\n    arg_asin = c0 * dt * np.sqrt(\n        (np.sin(kx * dx / 2) / dx)**2 + (np.sin(ky * dy / 2) / dy)**2\n    )\n    \n    # Clip to handle potential floating-point inaccuracies near the stability limit\n    arg_asin = np.clip(arg_asin, -1.0, 1.0)\n    \n    # Numerical angular frequency\n    omega_num = (2 / dt) * np.arcsin(arg_asin)\n    \n    # Numerical phase velocity. K is non-zero, so division is safe.\n    vp_num = omega_num / K\n\n    # 4. Calculate performance metrics\n    vp_ratio = vp_num / c0\n    \n    # Worst-case relative phase-velocity error\n    M_inf = np.max(np.abs(vp_ratio - 1))\n    \n    # Anisotropy span\n    A = np.max(vp_ratio) - np.min(vp_ratio)\n\n    return M_inf, A\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    # Physical constants\n    mu0 = 4 * np.pi * 1e-7  # H/m\n    eps0 = 8.854187817e-12 # F/m\n    c0 = 1 / np.sqrt(mu0 * eps0)\n\n    # Problem parameters\n    N_theta = 720\n    test_cases = [\n        # (dx, dy, s, q)\n        (1e-3, 1e-3, 0.99, 0.4),\n        (2e-3, 1e-3, 0.99, 0.4),\n        (4e-3, 1e-3, 0.50, 0.4),\n        (1e-3, 1e-3, 0.99, 0.05),\n        (1e-3, 1e-3, 0.99, 0.8),\n    ]\n    aspect_ratios_to_test = [0.5, 1.0, 2.0, 4.0]\n    dy_opt = 1e-3\n\n    results = []\n    for case in test_cases:\n        dx_case, dy_case, s, q = case\n        \n        # Part 1: Calculate M_inf and A for the specific test case parameters\n        M_inf, A = calculate_dispersion_metrics(dx_case, dy_case, s, q, c0, N_theta)\n\n        # Part 2: Find the optimal aspect ratio r*\n        min_J = float('inf')\n        best_r = -1.0\n        \n        for r in aspect_ratios_to_test:\n            dx_opt = r * dy_opt\n            # The optimization metric J is defined as M_inf\n            J_r, _ = calculate_dispersion_metrics(dx_opt, dy_opt, s, q, c0, N_theta)\n            \n            # Update best_r if a smaller error is found.\n            # Tie is broken by choosing smaller r due to ordered iteration.\n            if J_r  min_J:\n                min_J = J_r\n                best_r = r\n        \n        results.append([M_inf, A, best_r])\n\n    # Format the final output string as required\n    formatted_results = []\n    for m_inf_val, a_val, r_star_val in results:\n        # Round floating outputs to 6 decimals as specified.\n        # r* is from a discrete set, not a calculation needing rounding in the same way,\n        # but is treated as a float in the final output.\n        m_inf_str = f\"{round(m_inf_val, 6):.6f}\"\n        a_str = f\"{round(a_val, 6):.6f}\"\n        r_star_str = f\"{r_star_val}\"\n        formatted_results.append(f\"[{m_inf_str},{a_str},{r_star_str}]\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3307696"}]}