{"hands_on_practices": [{"introduction": "时域有限差分 (FDTD) 方法是计算电磁学的基石。当使用区域分解方法将其并行化时，我们必须考虑一个基本问题：并行计算是否会改变数值方案的稳定性？本练习将指导您通过冯·诺依曼稳定性分析，推导出三维 FDTD 方案的 Courant-Friedrichs-Lewy (CFL) 条件，并阐明并行同步对于维持计算保真度的关键作用 [@problem_id:3302072]。", "problem": "考虑在真空中由麦克斯韦方程组所描述的电磁波传播，使用由 Kane Yee 引入的交错网格时域有限差分 (FDTD) 方法（即 Yee 格式）在三维空间中进行离散化。计算域被划分为 $P$ 个笛卡尔子域，以便在消息传递接口 (MPI) 框架下进行并行计算，子域交界面之间通过交换单层鬼元层来通信。假设全局域的外边界为理想电导体 (PEC) 边界，且域内无源。空间网格是均匀的，在 $x$、$y$ 和 $z$ 方向上的间距分别为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$。真空材料参数满足 $c = 1/\\sqrt{\\mu_{0}\\varepsilon_{0}}$，其中 $c$ 是光速，$\\mu_{0}$ 是真空磁导率，$\\varepsilon_{0}$ 是真空介电常数。\n\n从麦克斯韦旋度方程及其显式时间蛙跳 Yee 离散格式出发，使用平面波拟设进行 von Neumann 稳定性分析，为该划分域上的三维格式推导时间步长 $\\Delta t$ 的 Courant–Friedrichs–Lewy (CFL) 稳定性约束。清晰解释区域分解和鬼元层交换如何影响稳定性条件，以及为确保子域交界面上的离散旋度计算使用时间层级一致的场值，各个 MPI 进程之间需要满足哪些同步要求。\n\n然后，对于一个特定的均匀网格和真空环境，根据您推导出的 CFL 约束，计算其所允许的最大稳定时间步长。使用以下参数：\n- $\\Delta x = 5.0 \\times 10^{-4}\\ \\text{m}$,\n- $\\Delta y = 1.0 \\times 10^{-3}\\ \\text{m}$,\n- $\\Delta z = 2.0 \\times 10^{-3}\\ \\text{m}$,\n- $c = 2.99792458 \\times 10^{8}\\ \\text{m/s}$。\n\n将您的数值答案四舍五入至四位有效数字。以皮秒为单位表示最终的时间步长。", "solution": "该问题要求推导三维时域有限差分 (FDTD) 方法的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，解释其与并行区域分解的相互作用，并数值计算最大稳定时间步长 $\\Delta t$。\n\n分析始于无源真空中的麦克斯韦旋度方程：\n$$ \\nabla \\times \\mathbf{E} = -\\mu_0 \\frac{\\partial \\mathbf{H}}{\\partial t} $$\n$$ \\nabla \\times \\mathbf{H} = \\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t} $$\n其中 $\\mathbf{E}$ 是电场，$\\mathbf{H}$ 是磁场，$\\mu_0$ 是真空磁导率，$\\varepsilon_0$ 是真空介电常数。\n\n这些矢量方程在交错的笛卡尔网格上使用 Yee 格式进行离散化。电场分量在整数时间步 ($n \\Delta t$) 计算，磁场分量在半整数时间步 ($(n+1/2)\\Delta t$) 计算。空间分量也是交错的。例如，电场的 $x$ 分量的更新方程是通过在时间和空间上都应用中心差分近似得到的：\n$$ \\frac{E_x\\Big|^{n+1}_{i, j+1/2, k+1/2} - E_x\\Big|^n_{i, j+1/2, k+1/2}}{\\Delta t} = \\frac{1}{\\varepsilon_0} \\left( \\frac{H_z\\Big|^{n+1/2}_{i, j+1, k+1/2} - H_z\\Big|^{n+1/2}_{i, j, k+1/2}}{\\Delta y} - \\frac{H_y\\Big|^{n+1/2}_{i, j+1/2, k+1} - H_y\\Big|^{n+1/2}_{i, j+1/2, k}}{\\Delta z} \\right) $$\n整套六个标量更新方程可类似推导得出。\n\n为了进行 von Neumann 稳定性分析，我们为每个场分量引入平面波拟设。对于一个通用场分量 $F$，其形式为：\n$$ F^{n}_{i,j,k} = F_0 \\, \\xi^n \\, \\exp[-j(k_x i \\Delta x + k_y j \\Delta y + k_z k \\Delta z)] $$\n其中 $F_0$ 是复振幅，$\\xi$ 是每个时间步的放大因子，$j = \\sqrt{-1}$，$(k_x, k_y, k_z)$ 是波矢。对于一个稳定的格式，放大因子的模必须对所有可能的波矢都满足 $|\\xi| \\le 1$。\n\n将此拟设代入六个 FDTD 更新方程，可将有限差分方程组转化为关于场振幅的代数方程组。对于 $E_x$ 的更新方程，该过程得到：\n$$ (\\xi - 1) E_{x0} = \\frac{\\Delta t}{\\varepsilon_0} \\xi^{1/2} \\left[ \\frac{H_{z0}}{\\Delta y} (e^{-jk_y \\Delta y/2} - e^{jk_y \\Delta y/2}) - \\frac{H_{y0}}{\\Delta z} (e^{-jk_z \\Delta z/2} - e^{jk_z \\Delta z/2}) \\right] $$\n使用欧拉恒等式 $\\sin(\\theta) = (e^{j\\theta} - e^{-j\\theta})/(2j)$，上式可以简化。将此方法应用于所有六个方程，并利用蛙跳特性 $\\xi^{1/2} - \\xi^{-1/2} = 2j \\sin(\\omega \\Delta t / 2)$（其中 $\\xi = e^{j\\omega \\Delta t}$），我们得到：\n$$ \\frac{2j}{\\Delta t} \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) \\mathbf{E}_0 = \\frac{j}{\\varepsilon_0} (\\mathbf{k}_{num} \\times \\mathbf{H}_0) $$\n$$ \\frac{2j}{\\Delta t} \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) \\mathbf{H}_0 = -\\frac{j}{\\mu_0} (\\mathbf{k}_{num} \\times \\mathbf{E}_0) $$\n其中 $\\mathbf{E}_0$ 和 $\\mathbf{H}_0$ 是矢量振幅，$\\mathbf{k}_{num}$ 是有效数值波矢，其分量定义为：\n$$ k_{num,x} = \\frac{2}{\\Delta x} \\sin\\left(\\frac{k_x \\Delta x}{2}\\right) $$\n$$ k_{num,y} = \\frac{2}{\\Delta y} \\sin\\left(\\frac{k_y \\Delta y}{2}\\right) $$\n$$ k_{num,z} = \\frac{2}{\\Delta z} \\sin\\left(\\frac{k_z \\Delta z}{2}\\right) $$\n合并这两个代数矢量方程以消去 $\\mathbf{H}_0$，并假设为横波（$\\mathbf{k}_{num} \\cdot \\mathbf{E}_0 = 0$），我们便得到三维 Yee 格式的数值色散关系：\n$$ \\left[\\frac{2}{c \\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right]^2 = \\left[\\frac{2}{\\Delta x} \\sin\\left(\\frac{k_x \\Delta x}{2}\\right)\\right]^2 + \\left[\\frac{2}{\\Delta y} \\sin\\left(\\frac{k_y \\Delta y}{2}\\right)\\right]^2 + \\left[\\frac{2}{\\Delta z} \\sin\\left(\\frac{k_z \\Delta z}{2}\\right)\\right]^2 $$\n其中 $c = 1/\\sqrt{\\mu_0 \\varepsilon_0}$。这可以简化为：\n$$ \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = (c \\Delta t)^2 \\left[ \\frac{\\sin^2(k_x \\Delta x/2)}{\\Delta x^2} + \\frac{\\sin^2(k_y \\Delta y/2)}{\\Delta y^2} + \\frac{\\sin^2(k_z \\Delta z/2)}{\\Delta z^2} \\right] $$\n为保证稳定性，$\\omega$ 必须为实数，这就要求 $|\\sin(\\omega \\Delta t/2)| \\le 1$。此条件必须对所有可能的波数 $k_x, k_y, k_z$ 都成立。当网格支持的最高频率（奈奎斯特）模式出现时，即 $k_x\\Delta x = \\pi$、$k_y\\Delta y = \\pi$ 和 $k_z\\Delta z = \\pi$ 时，方程右侧达到最大值。在这种最坏的情况下，$\\sin^2(...) = 1$。因此，稳定性条件变为：\n$$ (c \\Delta t)^2 \\left( \\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2} \\right) \\le 1 $$\n整理后得到对时间步长 $\\Delta t$ 的 CFL 稳定性约束：\n$$ \\Delta t \\le \\frac{1}{c\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}} $$\n\n使用区域分解进行并行计算不会改变这个基本的稳定性条件。von Neumann 分析是局部的，它仅依赖于更新方程的数值模板。在相邻子域（MPI 进程）之间交换鬼元数据的目的，正是为了确保子域边界上的场更新与子域内部的场更新使用完全相同的数值模板进行计算。实际上，鬼元交换机制在子域交界面上完美地重建了单体（串行）模拟的数据环境。因此，并行模拟的稳定性极限与在相同全局网格上进行的串行模拟的稳定性极限是相同的。\n\n然而，区域分解带来了严格的同步要求。FDTD 算法以蛙跳方式进行：电场（E场）使用磁场（H场）进行更新，然后 H 场使用新计算出的 E 场进行更新。\n1. 要将 H 场从时间步 $n+1/2$ 更新到 $n+3/2$，必须获得时间步 $n+1$ 处所有必要的 E 场值。对于靠近子域边界的 H 场节点，这需要来自相邻子域的 E 场值。因此，所有 MPI 进程必须在进行 H 场更新之前，首先交换它们在时间 $n+1$ 的 E 场边界值。\n2. 类似地，要将 E 场从时间步 $n+1$ 更新到 $n+2$，必须获得时间步 $n+3/2$ 处所有必要的 H 场值。这同样需要在各进程间交换新计算出的 H 场边界值。\n这个锁步过程，每个时间步包含两次通信/同步事件，是强制性的。它确保了在整个分布式域中，子域交界面上的旋度计算使用的是时间层级一致的场值，从而保持了数值格式的完整性和稳定性。\n\n现在，我们为给定参数计算最大稳定时间步长：\n- $\\Delta x = 5.0 \\times 10^{-4}\\ \\text{m}$\n- $\\Delta y = 1.0 \\times 10^{-3}\\ \\text{m}$\n- $\\Delta z = 2.0 \\times 10^{-3}\\ \\text{m}$\n- $c = 2.99792458 \\times 10^{8}\\ \\text{m/s}$\n\n首先，我们计算平方根内的各项：\n$$ \\frac{1}{\\Delta x^2} = \\frac{1}{(5.0 \\times 10^{-4})^2} = \\frac{1}{25 \\times 10^{-8}} = 4.0 \\times 10^6\\ \\text{m}^{-2} $$\n$$ \\frac{1}{\\Delta y^2} = \\frac{1}{(1.0 \\times 10^{-3})^2} = \\frac{1}{1.0 \\times 10^{-6}} = 1.0 \\times 10^6\\ \\text{m}^{-2} $$\n$$ \\frac{1}{\\Delta z^2} = \\frac{1}{(2.0 \\times 10^{-3})^2} = \\frac{1}{4.0 \\times 10^{-6}} = 0.25 \\times 10^6\\ \\text{m}^{-2} $$\n总和是：\n$$ S = \\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2} = (4.0 + 1.0 + 0.25) \\times 10^6 = 5.25 \\times 10^6\\ \\text{m}^{-2} $$\n平方根是：\n$$ \\sqrt{S} = \\sqrt{5.25 \\times 10^6} = \\sqrt{5.25} \\times 10^3 \\approx 2.2912878 \\times 10^3\\ \\text{m}^{-1} $$\n最大稳定时间步长是：\n$$ \\Delta t_{max} = \\frac{1}{c\\sqrt{S}} = \\frac{1}{(2.99792458 \\times 10^8) \\times (2.2912878 \\times 10^3)} $$\n$$ \\Delta t_{max} \\approx \\frac{1}{6.869090 \\times 10^{11}}\\ \\text{s} \\approx 1.45580 \\times 10^{-12}\\ \\text{s} $$\n转换为皮秒（$1\\ \\text{ps} = 10^{-12}\\ \\text{s}$）：\n$$ \\Delta t_{max} \\approx 1.45580\\ \\text{ps} $$\n四舍五入到四位有效数字，得到 $1.456\\ \\text{ps}$。", "answer": "$$\\boxed{1.456}$$", "id": "3302072"}, {"introduction": "一个正确的并行算法不一定是一个高效的算法。为了实现可扩展性，理解和优化通信开销至关重要。本练习将引导您为并行 FDTD 仿真中的光环交换（halo exchange）建立一个经典的 $\\alpha$-$\\beta$ 通信成本模型，并探索一种称为时间分块（temporal blocking）的优化策略，以找到延迟、带宽和计算之间的最佳平衡点 [@problem_id:3302053]。", "problem": "一个尺寸为 $N_x \\times N_y \\times N_z$ 的三维时域有限差分 (FDTD) 电磁仿真，被分解到一个尺寸为 $P_x \\times P_y \\times P_z$ 的消息传递接口 (MPI) 进程网格上，因此每个 MPI 秩拥有一个尺寸为 $n_x \\times n_y \\times n_z$ 的子域，其中 $n_x = N_x/P_x$，$n_y = N_y/P_y$，$n_z = N_z/P_z$。每个时间步都需要在所有三个方向上进行最近邻的一单元模板的晕环交换，以推进交错的 Yee 更新。假设一个标准的 $\\alpha$–$\\beta$ 通信成本模型，其中一个大小为 $m$ 字节的点对点消息成本为 $T_{\\mathrm{msg}} = \\alpha + \\beta m$，延迟为 $\\alpha$，逆带宽为 $\\beta$。\n\n为减少通信频率，考虑一个 $s$ 步分块策略：在本地执行 $s$ 个时间步，同时每 $s$ 步仅交换一次厚度为 $s$ 个单元的晕环。假设每个单元、每个时间步的计算时间为 $\\gamma$ 秒，并且每个晕环单元在每个面上需要通信 $n_v$ 个双精度值（每个 8 字节）。你可以假设每 $s$ 步块的六个面交换作为六个独立的消息执行，每个面一个，并且所有面每 $s$ 步交换一次。\n\n1. 从 $\\alpha$–$\\beta$ 模型和本地子域面的几何尺寸出发，推导每个 MPI 秩每 $s$ 步的总晕环交换时间 $T_{\\mathrm{comm}}(s)$ 的公式，用 $\\alpha$、$\\beta$、$s$、$n_x$、$n_y$、$n_z$ 和 $b = n_v \\times 8$（每个晕环单元的字节数）表示。\n2. 仅使用 Yee 模板的数据依赖半径，推导在一个 $s$ 步块中可以与通信重叠的计算量，并写出可重叠计算时间 $T_{\\mathrm{int}}(s)$ 和一个秩上每 $s$ 步的总计算时间 $T_{\\mathrm{comp}}(s)$，用 $\\gamma$、$s$、$n_x$、$n_y$ 和 $n_z$ 表示。\n3. 结合以上结果，得到在最佳重叠下一个 MPI 秩的每时间步迭代时间为\n$$\nT_{\\mathrm{step}}(s) \\;=\\; \\frac{T_{\\mathrm{comp}}(s) + \\max\\!\\big(0,\\, T_{\\mathrm{comm}}(s) - T_{\\mathrm{int}}(s)\\big)}{s}.\n$$\n4. 对于特定的仿真和机器参数\n$N_x = 512$，$N_y = 256$，$N_z = 256$，$P_x = 8$，$P_y = 4$，$P_z = 4$（因此 $n_x = n_y = n_z$），\n$n_v = 6$（三个电场分量和三个磁场分量），\n$\\alpha = 1.0 \\times 10^{-6}$ 秒，$\\beta = 1.0 \\times 10^{-10}$ 秒/字节，以及 $\\gamma = 5.0 \\times 10^{-10}$ 秒/单元/时间步，\n确定使 $T_{\\mathrm{step}}(s)$ 最小化的整数 $s \\in \\{1,2,3,\\dots\\}$，然后计算一个秩上对应的最小每步迭代时间。\n\n将您的最终数值答案四舍五入到四位有效数字，并以毫秒表示。", "solution": "该问题要求为并行时域有限差分 (FDTD) 仿真推导性能模型，并优化时间分块参数 $s$。解决方案的步骤是：验证问题陈述，推导计算和通信的组件模型，将它们组合起来，然后针对给定参数优化所得的成本函数。\n\n### 问题验证\n\n**第一步：提取已知条件**\n-   全局仿真尺寸：$N_x \\times N_y \\times N_z$ 网格单元。\n-   MPI 进程网格尺寸：$P_x \\times P_y \\times P_z$ 个进程。\n-   本地子域尺寸：$n_x \\times n_y \\times n_z$，其中 $n_x = N_x/P_x$，$n_y = N_y/P_y$，$n_z = N_z/P_z$。\n-   模板要求：Yee 模板的最近邻晕环交换。\n-   通信成本模型：对于大小为 $m$ 字节的消息，$T_{\\mathrm{msg}} = \\alpha + \\beta m$。\n-   延迟：$\\alpha$。\n-   逆带宽：$\\beta$。\n-   时间分块策略：$s$ 步分块，每 $s$ 步交换一次厚度为 $s$ 个单元的晕环。\n-   计算成本：$\\gamma$ 秒/单元/时间步。\n-   晕环单元数据大小：$n_v$ 个双精度值（每个 8 字节）。令 $b = 8n_v$ 字节/晕环单元。\n-   通信协议：每 $s$ 步块进行六次独立的面交换。\n-   给定的目标函数：$T_{\\mathrm{step}}(s) = \\frac{T_{\\mathrm{comp}}(s) + \\max(0, T_{\\mathrm{comm}}(s) - T_{\\mathrm{int}}(s))}{s}$。\n-   具体参数：\n    -   $N_x = 512$，$N_y = 256$，$N_z = 256$。\n    -   $P_x = 8$，$P_y = 4$，$P_z = 4$。\n    -   $n_v = 6$。\n    -   $\\alpha = 1.0 \\times 10^{-6}$ 秒。\n    -   $\\beta = 1.0 \\times 10^{-10}$ 秒/字节。\n    -   $\\gamma = 5.0 \\times 10^{-10}$ 秒/单元/时间步。\n-   任务：找到最小化 $T_{\\mathrm{step}}(s)$ 的整数 $s \\in \\{1, 2, 3, \\ldots\\}$ 并计算这个最小时间。\n\n**第二步：使用提取的已知条件进行验证**\n问题陈述在科学上是合理的、适定的和客观的。\n-   **科学依据**：FDTD 方法、Yee 的交错网格、用于并行化的域分解、$\\alpha$-$\\beta$ 通信模型以及用于通信优化的时间分块都是计算电磁学和高性能计算中的标准和基本概念。所提供的计算与通信重叠模型是一种公认的表示方法。\n-   **适定性**：问题被完全指定，包含所有必要的参数和一个明确的待最小化目标函数。如下所示，对于指定的 $s$ 域，存在唯一的最小值。\n-   **客观性**：问题以精确的数学和计算术语陈述，没有歧义或主观语言。所有参数都以具体数值给出。\n\n**第三步：结论与行动**\n该问题被认定为**有效**。将提供完整解答。\n\n### 解答推导\n\n**1. 总晕环交换时间, $T_{\\mathrm{comm}}(s)$**\n\n每个 MPI 秩上的本地子域是一个尺寸为 $n_x \\times n_y \\times n_z$ 的长方体。对于一个 $s$ 步分块策略，必须在每 $s$ 个时间步的块中，与六个最近邻中的每一个交换一次厚度为 $s$ 个单元的晕环。问题陈述这通过六个独立的消息发生。\n\n子域各个面的面积为 $n_y n_z$（对于 $\\pm x$ 方向的面）、$n_x n_z$（对于 $\\pm y$ 方向的面）和 $n_x n_y$（对于 $\\pm z$ 方向的面）。每个面厚度为 $s$ 的晕环体积是 $s \\times (\\text{面面积})$。每个单元需要通信的数据量是 $b = 8n_v$ 字节。\n\n每个面的消息大小（以字节为单位）是：\n-   $m_{yz} = s \\cdot n_y n_z \\cdot b$（对于垂直于 $x$ 轴的两个面）\n-   $m_{xz} = s \\cdot n_x n_z \\cdot b$（对于垂直于 $y$ 轴的两个面）\n-   $m_{xy} = s \\cdot n_x n_y \\cdot b$（对于垂直于 $z$ 轴的两个面）\n\n使用 $\\alpha$-$\\beta$ 模型，一个大小为 $m$ 的消息的成本是 $\\alpha + \\beta m$。由于每种尺寸的面都有两个，因此每 $s$ 步的总通信时间是六个消息成本的总和：\n$$T_{\\mathrm{comm}}(s) = 2(\\alpha + \\beta m_{yz}) + 2(\\alpha + \\beta m_{xz}) + 2(\\alpha + \\beta m_{xy})$$\n$$T_{\\mathrm{comm}}(s) = 6\\alpha + 2\\beta(m_{yz} + m_{xz} + m_{xy})$$\n代入消息大小的表达式：\n$$T_{\\mathrm{comm}}(s) = 6\\alpha + 2\\beta s b (n_y n_z + n_x n_z + n_x n_y)$$\n\n**2. 计算时间, $T_{\\mathrm{comp}}(s)$ 和 $T_{\\mathrm{int}}(s)$**\n\n在体积为 $n_x n_y n_z$ 个单元的子域上，进行 $s$ 个时间步的总计算时间 $T_{\\mathrm{comp}}(s)$，其中每个单元每步的计算成本为 $\\gamma$，是：\n$$T_{\\mathrm{comp}}(s) = \\gamma \\cdot s \\cdot (n_x n_y n_z)$$\n\n可重叠计算时间 $T_{\\mathrm{int}}(s)$ 对应于在 $s$ 步块内不依赖于晕环数据的单元上的计算。Yee 模板的数据依赖半径为一个单元。经过 $k$ 个时间步后，距离边界最多 $k$ 个单元的计算依赖于初始的晕环数据。因此，经过 $s$ 个时间步后，边界处厚度为 $s$ 的壳层内的任何单元的计算都将依赖于晕环数据。\n\n域的“内部”部分，其计算在所有 $s$ 步中都独立于晕环数据，是一个尺寸更小的棱柱体，尺寸为 $(n_x - 2s) \\times (n_y - 2s) \\times (n_z - 2s)$。这个体积上的计算可以与通信重叠。仅当 $n_x, n_y, n_z > 2s$ 时，该体积非零。\n可重叠计算时间是在所有 $s$ 步中花费在这个内部核心上的时间：\n$$T_{\\mathrm{int}}(s) = \\gamma \\cdot s \\cdot \\max(0, n_x - 2s) \\cdot \\max(0, n_y - 2s) \\cdot \\max(0, n_z - 2s)$$\n\n**3. 每时间步迭代时间, $T_{\\mathrm{step}}(s)$**\n\n将推导出的 $T_{\\mathrm{comp}}(s)$、$T_{\\mathrm{comm}}(s)$ 和 $T_{\\mathrm{int}}(s)$ 表达式代入给定的公式，得到每步时间：\n$$T_{\\mathrm{step}}(s) = \\frac{\\gamma s n_x n_y n_z + \\max\\!\\Big(0,\\, 6\\alpha + 2\\beta s b (n_y n_z + n_x n_z + n_x n_y) - \\gamma s \\prod_{i \\in \\{x,y,z\\}} \\max(0, n_i - 2s)\\Big)}{s}$$\n这可以重写为：\n$$T_{\\mathrm{step}}(s) = \\gamma n_x n_y n_z + \\frac{1}{s} \\max\\!\\Big(0,\\, 6\\alpha + 2\\beta s b (n_y n_z + n_x n_z + n_x n_y) - \\gamma s \\prod_{i \\in \\{x,y,z\\}} \\max(0, n_i - 2s)\\Big)$$\n\n**4. 数值优化**\n\n首先，我们计算特定于该问题的常数：\n-   $n_x = N_x/P_x = 512/8 = 64$\n-   $n_y = N_y/P_y = 256/4 = 64$\n-   $n_z = N_z/P_z = 256/4 = 64$。令 $n = 64$。\n-   $b = n_v \\times 8 = 6 \\times 8 = 48$ 字节。\n\n对于立方体子域（$n_x = n_y = n_z = n$），公式简化为：\n-   $T_{\\mathrm{comm}}(s) = 6\\alpha + 6\\beta s b n^2$\n-   $T_{\\mathrm{comp}}(s) = \\gamma s n^3$\n-   $T_{\\mathrm{int}}(s) = \\gamma s (\\max(0, n-2s))^3$\n\n每步时间变为：\n$$T_{\\mathrm{step}}(s) = \\gamma n^3 + \\frac{1}{s}\\max\\Big(0,\\, 6\\alpha + 6\\beta s b n^2 - \\gamma s (\\max(0, n-2s))^3 \\Big)$$\n\n我们必须找到最小化此函数的整数 $s \\ge 1$。我们根据 $s$ 相对于 $n/2 = 32$ 的值分析两种情况。\n\n**情况 1: $1 \\le s  32$**\n在这种情况下，$n-2s > 0$。表达式简化为：\n$$T_{\\mathrm{step}}(s) = \\gamma n^3 + \\frac{1}{s}\\max\\Big(0, 6\\alpha + 6\\beta s b n^2 - \\gamma s (n - 2s)^3\\Big)$$\n令 $O_1(s) = \\frac{1}{s} \\left( 6\\alpha + 6\\beta s b n^2 - \\gamma s (n - 2s)^3 \\right) = \\frac{6\\alpha}{s} + 6\\beta b n^2 - \\gamma(n - 2s)^3$。这是开销项，假设其为正。我们希望找到 $T_{\\mathrm{step}}(s)$ 的最小值，这等价于最小化 $O_1(s)$。\n导数是 $O_1'(s) = -\\frac{6\\alpha}{s^2} + 6\\gamma(n-2s)^2$。\n令 $O_1'(s) = 0$ 得到 $\\sqrt{\\gamma}s(n-2s) = \\sqrt{\\alpha}$。\n$2\\sqrt{\\gamma}s^2 - n\\sqrt{\\gamma}s + \\sqrt{\\alpha} = 0$。\n代入数值：\n$\\alpha = 10^{-6}$ 秒, $\\gamma = 5 \\times 10^{-10}$ 秒/单元/步, $n=64$。\n$\\sqrt{\\alpha}=10^{-3}$, $\\sqrt{\\gamma}=\\sqrt{5}\\times 10^{-5}$。\n连续最小值的方程是 $2(\\sqrt{5}\\times 10^{-5})s^2 - 64(\\sqrt{5}\\times 10^{-5})s + 10^{-3} = 0$。\n$s \\approx \\frac{1.431\\text{e-}3 \\pm \\sqrt{(1.431\\text{e-}3)^2 - 4(4.472\\text{e-}5)(1\\text{e-}3)}}{2(4.472\\text{e-}5)} \\approx \\frac{1.431\\text{e-}3 \\pm 1.367\\text{e-}3}{8.944\\text{e-}5}$。\n根是 $s_1 \\approx 0.715$ 和 $s_2 \\approx 31.28$。导数 $O_1'(s)$ 在 $s  s_1$ 和 $s > s_2$ 时为正，在它们之间为负。\n然而，对于离散整数值 $s \\ge 1$，我们注意到 $s=1$ 位于第一个最小值 $s_1 \\approx 0.715$ 的右侧。我们重新审视导数：$O_1'(s) = - \\frac{6 \\times 10^{-6}}{s^2} + 6(5 \\times 10^{-10})(64-2s)^2$。在 $s=1$ 时，$O_1'(1) = -6 \\times 10^{-6} + 30 \\times 10^{-10} \\times 62^2 = -6 \\times 10^{-6} + 1.1532 \\times 10^{-5} = 5.532 \\times 10^{-6} > 0$。\n由于在 $s=1$ 时导数为正，且连续最小值在 $s_1  1$，因此函数 $O_1(s)$ 在此区间内（直到 $s \\approx 31$）对所有整数 $s \\ge 1$ 都是递增的。因此，此范围内的最小值出现在 $s=1$ 处。\n\n我们来计算 $T_{\\mathrm{step}}(1)$：\n$T_{\\mathrm{comp}}(1) = (5 \\times 10^{-10})(1)(64^3) = 1.31072 \\times 10^{-4}$ 秒。\n$T_{\\mathrm{comm}}(1) = 6(10^{-6}) + 6(10^{-10})(48)(1)(64^2) = 6 \\times 10^{-6} + 1.179648 \\times 10^{-4} = 1.239648 \\times 10^{-4}$ 秒。\n$T_{\\mathrm{int}}(1) = (5 \\times 10^{-10})(1)(64-2)^3 = (5 \\times 10^{-10})(62^3) = 1.19164 \\times 10^{-4}$ 秒。\n$\\max$ 内的项是 $T_{\\mathrm{comm}}(1) - T_{\\mathrm{int}}(1) = 4.8008 \\times 10^{-6} > 0$。\n$T_{\\mathrm{step}}(1) = \\frac{T_{\\mathrm{comp}}(1) + (T_{\\mathrm{comm}}(1) - T_{\\mathrm{int}}(1))}{1} = 1.31072 \\times 10^{-4} + 4.8008 \\times 10^{-6} = 1.358728 \\times 10^{-4}$ 秒。\n\n**情况 2: $s \\ge 32$**\n在这种情况下，$n-2s \\le 0$，所以 $T_{\\mathrm{int}}(s) = 0$。$T_{\\mathrm{comm}}(s)$ 总是正的。\n$$T_{\\mathrm{step}}(s) = \\frac{T_{\\mathrm{comp}}(s) + T_{\\mathrm{comm}}(s)}{s} = \\frac{\\gamma s n^3 + 6\\alpha + 6\\beta s b n^2}{s}$$\n$$T_{\\mathrm{step}}(s) = \\gamma n^3 + 6\\beta b n^2 + \\frac{6\\alpha}{s}$$\n这个函数对于递增的 $s$ 是严格递减的。当 $s \\to \\infty$ 时，其下确界为：\n$$T_{\\mathrm{step}}(\\infty) = \\gamma n^3 + 6\\beta b n^2 = 1.31072 \\times 10^{-4} + 1.179648 \\times 10^{-4} = 2.490368 \\times 10^{-4} \\text{ 秒}。$$\n在此情况下的任何有限 $s$ 都会产生一个大于此下确界的时间。例如，在 $s=32$ 时：\n$$T_{\\mathrm{step}}(32) = 2.490368 \\times 10^{-4} + \\frac{6 \\times 10^{-6}}{32} = 2.490368 \\times 10^{-4} + 1.875 \\times 10^{-7} = 2.492243 \\times 10^{-4} \\text{ 秒}。$$\n\n**结论**\n将情况 1 的最优值与情况 2 的值进行比较：\n-   $T_{\\mathrm{step}}(1) = 1.358728 \\times 10^{-4}$ 秒。\n-   情况 2 的下确界是 $2.490368 \\times 10^{-4}$ 秒。\n\n由于 $T_{\\mathrm{step}}(1)$ 显著小于 $s \\ge 32$ 情况的下确界，因此对于整数 $s \\ge 1$ 的全局最小值出现在 $s=1$ 处。\n\n最小的每步迭代时间是 $T_{\\mathrm{step}}(1) = 1.358728 \\times 10^{-4}$ 秒。\n转换为毫秒：$1.358728 \\times 10^{-4} \\text{ 秒} \\times 1000 \\text{ 毫秒/秒} = 0.1358728$ 毫秒。\n四舍五入到四位有效数字得到 $0.1359$ 毫秒。", "answer": "$$\\boxed{0.1359}$$", "id": "3302053"}, {"introduction": "与显式时域方法不同，频域求解器通常需要迭代求解大型线性方程组，而区域分解方法（如 Schwarz 方法）的收敛速度是其效率的关键。本练习利用一个简单而深刻的物理类比——平面波在两种不同阻抗介质界面上的反射——来量化 Schwarz 方法的收敛率。通过将人工边界上的“传输条件”与反射系数联系起来，您将深入理解如何通过最小化伪反射来优化这些迭代方法 [@problem_id:3302015]。", "problem": "考虑一个均匀、无损耗的电磁介质的无重叠双子区域分解，该介质的特征是介电常数 $\\epsilon$ 和磁导率 $\\mu$。一个角频率为 $\\omega$ 的时谐平面波沿 $+x$ 方向传播，并垂直入射到位于 $x=0$ 处的平面子区域界面上。设介质的固有波阻抗为 $Z_0 = \\sqrt{\\mu / \\epsilon}$。Schwarz 区域分解法在界面上使用一种阻抗型传输条件，该条件通过一个实的正边界阻抗 $Z_{\\mathrm{bc}}$ 来强制切向电场和磁场之间成正比关系。\n\n假设入射平面波的切向电场振幅为 $E_{\\mathrm{i}}$，相应的反射波振幅为 $E_{\\mathrm{r}}$。界面上的总切向电场和磁场是入射场和反射场的叠加。仅使用宏观麦克斯韦方程组和在 $x=0$ 处的阻抗传输条件，推导垂直入射的反射系数作为 $Z_0$ 和 $Z_{\\mathrm{bc}}$ 的函数，然后用它计算在界面处平面波携带的反射与入射的时间平均能量通量之比。将此比率解释为一次 Schwarz 迭代后留在源子区域上的残余误差能量分数，并据此预测 Schwarz 迭代的渐近能量收敛率。\n\n取 $Z_0 = 377\\,\\mathrm{\\Omega}$ 和 $Z_{\\mathrm{bc}} = 200\\,\\mathrm{\\Omega}$。报告两个量：\n1. 一次 Schwarz 迭代后的残余误差能量分数（无量纲）。\n2. 每次迭代的预测渐近能量收敛率（无量纲）。\n\n将您的答案四舍五入到四位有效数字。将两个答案都表示为无量纲数。", "solution": "首先验证问题，以确保其科学性、适定性和客观性。\n\n### 第1步：提取已知条件\n- **系统：** 均匀、无损耗电磁介质的无重叠双子区域分解。\n- **介质属性：** 介电常数 $\\epsilon$，磁导率 $\\mu$。\n- **固有阻抗：** $Z_0 = \\sqrt{\\mu / \\epsilon}$。\n- **波：** 时谐平面波，角频率 $\\omega$。\n- **传播：** 沿 $+x$ 方向，垂直入射到位于 $x=0$ 的平面子区域界面。\n- **边界条件：** 在 $x=0$ 处，一个具有实的正边界阻抗 $Z_{\\mathrm{bc}}$ 的阻抗型传输条件关联了切向电场和磁场。\n- **场振幅：** 入射切向电场振幅为 $E_{\\mathrm{i}}$；反射波振幅为 $E_{\\mathrm{r}}$。\n- **总场：** 界面上的总切向场是入射场和反射场的叠加。\n- **给定值：** $Z_0 = 377\\,\\mathrm{\\Omega}$，$Z_{\\mathrm{bc}} = 200\\,\\mathrm{\\Omega}$。\n- **任务：**\n    1. 推导反射系数 $\\Gamma = E_{\\mathrm{r}} / E_{\\mathrm{i}}$ 作为 $Z_0$ 和 $Z_{\\mathrm{bc}}$ 的函数。\n    2. 计算反射与入射的时间平均能量通量之比。\n    3. 将此比率解释为一次 Schwarz 迭代后的残余误差能量分数。\n    4. 根据此比率预测 Schwarz 迭代的渐近能量收敛率。\n    5. 报告两个数值量：残余误差能量分数和渐近能量收敛率，并四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，因为它基于麦克斯韦方程组、平面波理论和 Schwarz 区域分解法，这些都是计算电磁学中的标准课题。该问题是适定的，提供了足够的信息来推导唯一解。语言是客观的，参数在物理上是现实的。在一维模型问题中，反射系数与迭代方法收敛率之间的联系是区域分解方法的一种标准分析技术。因此，该问题被认为是有效的。\n\n### 第3步：推导与求解\n让我们对沿 $+x$ 方向传播的时谐平面波进行建模。不失一般性，我们假设电场沿 $y$ 轴极化，$\\vec{E} = E_y(x) \\hat{y}$，因此磁场沿 $z$ 轴极化，$\\vec{H} = H_z(x) \\hat{z}$。使用复相量表示法 $f(x,t) = \\Re\\{\\tilde{F}(x) \\exp(j\\omega t)\\}$，场可以由其空间部分描述。\n\n入射波沿 $+x$ 方向传播。电场和磁场之间的关系由固有阻抗 $Z_0 = \\sqrt{\\mu/\\epsilon}$ 给出。\n$$ \\tilde{E}_y^{\\mathrm{i}}(x) = E_{\\mathrm{i}} \\exp(-jkx) $$\n$$ \\tilde{H}_z^{\\mathrm{i}}(x) = \\frac{1}{Z_0} E_{\\mathrm{i}} \\exp(-jkx) $$\n其中 $k = \\omega\\sqrt{\\mu\\epsilon}$ 是波数，$E_{\\mathrm{i}}$ 是 $x=0$ 处入射电场的复振幅。\n\n反射波沿 $-x$ 方向传播。其场为：\n$$ \\tilde{E}_y^{\\mathrm{r}}(x) = E_{\\mathrm{r}} \\exp(+jkx) $$\n$$ \\tilde{H}_z^{\\mathrm{r}}(x) = -\\frac{1}{Z_0} E_{\\mathrm{r}} \\exp(+jkx) $$\n其中 $E_{\\mathrm{r}}$ 是 $x=0$ 处反射电场的复振幅。$\\tilde{H}_z^{\\mathrm{r}}$ 中的负号确保了坡印廷矢量 $\\vec{S}_{\\mathrm{r}} \\sim \\vec{E}_{\\mathrm{r}} \\times \\vec{H}_{\\mathrm{r}}$ 指向 $-x$ 方向。\n\n在界面 $x=0$ 处，总的切向场是入射和反射分量的叠加：\n$$ \\tilde{E}_y^{\\mathrm{tot}}(0) = \\tilde{E}_y^{\\mathrm{i}}(0) + \\tilde{E}_y^{\\mathrm{r}}(0) = E_{\\mathrm{i}} + E_{\\mathrm{r}} $$\n$$ \\tilde{H}_z^{\\mathrm{tot}}(0) = \\tilde{H}_z^{\\mathrm{i}}(0) + \\tilde{H}_z^{\\mathrm{r}}(0) = \\frac{E_{\\mathrm{i}}}{Z_0} - \\frac{E_{\\mathrm{r}}}{Z_0} $$\n\n问题指定了在边界 $x=0$ 处的阻抗型传输条件。对于区域 $x0$，外法线是 $\\hat{n} = \\hat{x}$。阻抗条件的一般形式为 $\\vec{E}_{\\mathrm{tan}} = -Z_{\\mathrm{bc}}(\\hat{n} \\times \\vec{H}_{\\mathrm{tan}})$。\n$$ \\tilde{E}_y^{\\mathrm{tot}}(0)\\hat{y} = -Z_{\\mathrm{bc}}(\\hat{x} \\times (\\tilde{H}_z^{\\mathrm{tot}}(0)\\hat{z})) = -Z_{\\mathrm{bc}}\\tilde{H}_z^{\\mathrm{tot}}(0)(-\\hat{y}) = Z_{\\mathrm{bc}}\\tilde{H}_z^{\\mathrm{tot}}(0)\\hat{y} $$\n这简化为在 $x=0$ 处切向场分量之间的标量关系：\n$$ \\tilde{E}_y^{\\mathrm{tot}}(0) = Z_{\\mathrm{bc}} \\tilde{H}_z^{\\mathrm{tot}}(0) $$\n代入总场的表达式：\n$$ E_{\\mathrm{i}} + E_{\\mathrm{r}} = Z_{\\mathrm{bc}} \\left(\\frac{E_{\\mathrm{i}}}{Z_0} - \\frac{E_{\\mathrm{r}}}{Z_0}\\right) $$\n为了求得反射系数 $\\Gamma = E_{\\mathrm{r}}/E_{\\mathrm{i}}$，我们重排方程以求解此比率：\n$$ E_{\\mathrm{i}}Z_0 + E_{\\mathrm{r}}Z_0 = Z_{\\mathrm{bc}}E_{\\mathrm{i}} - Z_{\\mathrm{bc}}E_{\\mathrm{r}} $$\n$$ E_{\\mathrm{r}}(Z_0 + Z_{\\mathrm{bc}}) = E_{\\mathrm{i}}(Z_{\\mathrm{bc}} - Z_0) $$\n$$ \\Gamma = \\frac{E_{\\mathrm{r}}}{E_{\\mathrm{i}}} = \\frac{Z_{\\mathrm{bc}} - Z_0}{Z_{\\mathrm{bc}} + Z_0} $$\n\n接下来，我们计算反射与入射的时间平均能量通量（坡印廷矢量大小）之比。时间平均坡印廷矢量为 $\\langle\\vec{S}\\rangle = \\frac{1}{2}\\Re\\{\\tilde{\\vec{E}} \\times \\tilde{\\vec{H}}^*\\}$。\n对于入射波，能量通量在 $+x$ 方向：\n$$ \\langle S_{\\mathrm{i}} \\rangle = \\frac{1}{2}\\Re\\{\\tilde{E}_y^{\\mathrm{i}} (\\tilde{H}_z^{\\mathrm{i}})^*\\} = \\frac{1}{2}\\Re\\left\\{E_{\\mathrm{i}} \\left(\\frac{E_{\\mathrm{i}}}{Z_0}\\right)^*\\right\\} = \\frac{1}{2Z_0^*}|E_{\\mathrm{i}}|^2 $$\n对于反射波，能量通量在 $-x$ 方向：\n$$ \\langle S_{\\mathrm{r}} \\rangle = \\frac{1}{2}\\Re\\{\\tilde{E}_y^{\\mathrm{r}} (\\tilde{H}_z^{\\mathrm{r}})^*\\} = \\frac{1}{2}\\Re\\left\\{E_{\\mathrm{r}} \\left(-\\frac{E_{\\mathrm{r}}}{Z_0}\\right)^*\\right\\} = \\frac{1}{2Z_0^*}|E_{\\mathrm{r}}|^2 $$\n由于介质是无损耗的，$Z_0$ 是实数（$Z_0^*=Z_0$）。能量通量的大小之比为：\n$$ \\frac{\\langle S_{\\mathrm{r}} \\rangle}{\\langle S_{\\mathrm{i}} \\rangle} = \\frac{\\frac{1}{2Z_0}|E_{\\mathrm{r}}|^2}{\\frac{1}{2Z_0}|E_{\\mathrm{i}}|^2} = \\left|\\frac{E_{\\mathrm{r}}}{E_{\\mathrm{i}}}\\right|^2 = |\\Gamma|^2 $$\n\n问题要求将此比率解释为一次 Schwarz 迭代后的残余误差能量分数。在 Schwarz 方法的背景下，入射波可以被看作是从相邻子区域传播到人工边界的“误差”。阻抗条件模拟了该误差的吸收。反射波代表了未被吸收并被反射回来的那部分误差，即残余误差。因此，反射能量与入射能量之比 $|\\Gamma|^2$ 确实是一次迭代后剩余误差能量的分数。\n1. 残余误差能量分数为 $|\\Gamma|^2$。\n\n迭代方法的渐近能量收敛率是在多次迭代的极限情况下，每次迭代误差能量减少的因子。对于这个一维模型问题，每一步的收敛行为都是相同的，因此渐近率等于单步减少因子。\n因此，预测的渐近能量收敛率也是 $|\\Gamma|^2$。\n2. 预测的渐近能量收敛率是 $|\\Gamma|^2$。\n\n现在，我们代入给定的数值 $Z_0 = 377\\,\\mathrm{\\Omega}$ 和 $Z_{\\mathrm{bc}} = 200\\,\\mathrm{\\Omega}$：\n$$ \\Gamma = \\frac{200 - 377}{200 + 377} = \\frac{-177}{577} $$\n两个所求的量都等于 $|\\Gamma|^2$：\n$$ |\\Gamma|^2 = \\left(\\frac{-177}{577}\\right)^2 = \\left(\\frac{177}{577}\\right)^2 \\approx 0.094099913... $$\n四舍五入到四位有效数字，我们得到 $0.09410$。末尾的零是有效数字。\n\n残余误差能量分数和预测的渐近能量收敛率都等于这个值。\n- 残余误差能量分数：$0.09410$\n- 预测的渐近能量收敛率：$0.09410$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.09410   0.09410\n\\end{pmatrix}\n}\n$$", "id": "3302015"}]}