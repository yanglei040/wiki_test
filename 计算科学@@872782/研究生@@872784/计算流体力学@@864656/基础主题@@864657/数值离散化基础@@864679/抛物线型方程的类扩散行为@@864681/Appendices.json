{"hands_on_practices": [{"introduction": "我们的实践始于求解抛物线型方程的数值方法的基础。我们将分析最直观的显式时间推进、中心空间差分（FTCS）格式，并应用冯·诺依曼稳定性分析这一强大工具。通过这个练习 ([@problem_id:3308165])，你将亲手推导出控制数值稳定性的关键条件，深刻理解时间步长、空间网格和扩散系数之间存在的内在制约关系，这对于任何数值模拟都是至关重要的第一步。", "problem": "在计算流体动力学中，抛物型方程的类扩散行为出现在粘性输运的建模中。考虑一个长度为 $L$ 的周期性域上的一维空间标量扩散方程，由 $u_{t} = \\alpha u_{xx}$ 给出，其中扩散系数 $\\alpha  0$ 为常数。使用间距为 $\\Delta x$ 的均匀网格对空间进行离散，使用恒定时间步长 $\\Delta t$ 对时间进行离散，并考虑显式前向欧拉、中心差分格式\n$$\nu^{n+1}_{j} = u^{n}_{j} + \\lambda \\left(u^{n}_{j+1} - 2 u^{n}_{j} + u^{n}_{j-1}\\right),\n$$\n其中 $\\lambda = \\alpha \\Delta t / \\Delta x^{2}$，并施加周期性边界条件。\n\n使用基于傅里叶的 von Neumann 稳定性分析，该分析以周期性边界条件下离散傅里叶模态的线性叠加为基础，确定 $\\lambda$ 的最大值，使得在该格式下，每个可分辨的傅里叶模态的幅度都是非放大的。您的推导必须从控制方程和给定的离散化格式开始，并从第一性原理出发，不得引用任何预先记忆的稳定性结论。\n\n将您的最终答案报告为等于最大允许 $\\lambda$ 值的单个实数。不包括单位。无需四舍五入。", "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观。它提出了偏微分方程数值分析领域中一个标准的、可解的问题。我们开始求解。\n\n问题要求解一维扩散方程 $u_t = \\alpha u_{xx}$ 的显式前向欧拉、中心差分格式的稳定性极限。离散化格式由下式给出：\n$$\nu^{n+1}_{j} = u^{n}_{j} + \\lambda \\left(u^{n}_{j+1} - 2 u^{n}_{j} + u^{n}_{j-1}\\right)\n$$\n其中 $\\lambda = \\alpha \\Delta t / \\Delta x^{2}$，$u^n_j$ 是在时间 $t_n = n \\Delta t$ 和空间位置 $x_j = j \\Delta x$ 处的数值解。\n\n我们进行 von Neumann 稳定性分析。该分析假设一个周期性域，并将数值解表示为离散傅里叶模态的叠加。由于有限差分方程的线性特性，我们可以分析单个傅里叶模态的行为，其形式为：\n$$\nu^n_j = \\hat{u}^n(k) \\exp(i k x_j) = \\hat{u}^n(k) \\exp(i k j \\Delta x)\n$$\n其中 $k$ 是波数，$i = \\sqrt{-1}$，$\\hat{u}^n(k)$ 是在时间步 $n$ 时该模态的复振幅。\n\n该格式使此模态随时间传播。下一时间步的振幅 $\\hat{u}^{n+1}(k)$ 通过一个放大因子 $G(k)$ 与当前振幅 $\\hat{u}^n(k)$ 相关，即：\n$$\n\\hat{u}^{n+1}(k) = G(k) \\hat{u}^{n}(k)\n$$\n这意味着 $u^{n+1}_j = G(k) u^n_j$。为使格式稳定，对于任何可分辨的波数，此放大因子的模都不能超过1，即 $|G(k)| \\leq 1$。\n\n为了求得 $G(k)$，我们将傅里叶模态表示代入离散方程中：\n$$\n\\hat{u}^{n+1}(k) \\exp(i k j \\Delta x) = \\hat{u}^{n}(k) \\exp(i k j \\Delta x) + \\lambda \\left( \\hat{u}^{n}(k) \\exp(i k (j+1) \\Delta x) - 2 \\hat{u}^{n}(k) \\exp(i k j \\Delta x) + \\hat{u}^{n}(k) \\exp(i k (j-1) \\Delta x) \\right)\n$$\n使用关系式 $\\hat{u}^{n+1}(k) = G(k) \\hat{u}^{n}(k)$，我们得到：\n$$\nG(k) \\hat{u}^{n}(k) \\exp(i k j \\Delta x) = \\hat{u}^{n}(k) \\exp(i k j \\Delta x) \\left[ 1 + \\lambda \\left( \\exp(i k \\Delta x) - 2 + \\exp(-i k \\Delta x) \\right) \\right]\n$$\n除去公因子 $\\hat{u}^{n}(k) \\exp(i k j \\Delta x)$（假设存在非平凡解），得到放大因子的表达式：\n$$\nG(k) = 1 + \\lambda \\left( \\exp(i k \\Delta x) + \\exp(-i k \\Delta x) - 2 \\right)\n$$\n令无量纲波数或相角为 $\\theta = k \\Delta x$。使用欧拉恒等式 $\\exp(i\\theta) + \\exp(-i\\theta) = 2 \\cos(\\theta)$，我们将 $G(k)$ 简化为：\n$$\nG(\\theta) = 1 + \\lambda (2 \\cos(\\theta) - 2) = 1 - 2\\lambda (1 - \\cos(\\theta))\n$$\n我们可以使用半角三角恒等式 $1 - \\cos(\\theta) = 2 \\sin^2(\\theta/2)$ 进一步简化此表达式：\n$$\nG(\\theta) = 1 - 4\\lambda \\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n稳定性条件是对于所有可能的 $\\theta = k \\Delta x$ 值，都有 $|G(\\theta)| \\le 1$。由于 $G(\\theta)$ 是一个实值函数，这等价于两个不等式：\n$$\n-1 \\le G(\\theta) \\quad \\text{和} \\quad G(\\theta) \\le 1\n$$\n\n我们来分析第一个不等式，$G(\\theta) \\le 1$：\n$$\n1 - 4\\lambda \\sin^2\\left(\\frac{\\theta}{2}\\right) \\le 1\n$$\n$$\n-4\\lambda \\sin^2\\left(\\frac{\\theta}{2}\\right) \\le 0\n$$\n由于题目说明 $\\alpha  0$，且 $\\Delta t$ 和 $\\Delta x$ 是正增量，因此 $\\lambda = \\alpha \\Delta t / \\Delta x^2$ 必须是非负的。项 $\\sin^2(\\theta/2)$ 也总为非负。因此，它们的乘积是非负的，乘以 $-4$ 后使左侧非正。因此，对于任何物理上有意义的 $\\lambda \\ge 0$，此不等式总是成立的。\n\n现在，我们来分析第二个不等式，$-1 \\le G(\\theta)$：\n$$\n-1 \\le 1 - 4\\lambda \\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n$$\n4\\lambda \\sin^2\\left(\\frac{\\theta}{2}\\right) \\le 2\n$$\n$$\n\\lambda \\le \\frac{2}{4 \\sin^2(\\theta/2)} = \\frac{1}{2 \\sin^2(\\theta/2)}\n$$\n这个条件必须对所有可分辨的模态都成立，这对应于相角 $\\theta = k \\Delta x$ 的所有可能值。格式的稳定性由最严格的情况决定，即对 $\\lambda$ 施加最强约束的模态。这种情况发生在分母 $2 \\sin^2(\\theta/2)$ 取其最大值时。\n\n函数 $\\sin^2(x)$ 的最大值为 $1$。这种情况发生在其参数 $x$ 是 $\\pi/2$ 的奇数倍时。对于相角 $\\theta = k \\Delta x$，项 $\\sin^2(\\theta/2)$ 的最大值达到 $1$。这对应于网格上可以表示的最高频率（或最短波长）模态，此时 $\\theta = \\pi$（即波长为 $2 \\Delta x$，奈奎斯特频率）。\n\n将 $\\sin^2(\\theta/2) = 1$ 的最大值代入不等式，我们得到稳定性条件：\n$$\n\\lambda \\le \\frac{1}{2(1)}\n$$\n$$\n\\lambda \\le \\frac{1}{2}\n$$\n因此，为使格式对所有傅里叶模态都稳定，$\\lambda$ 必须小于或等于 $1/2$。使得每个可分辨的傅里叶模态都非放大的 $\\lambda$ 的最大值恰好是这个上界。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3308165"}, {"introduction": "在了解了显式格式的局限性后，我们自然会问：如何克服这些严格的稳定性限制？本练习 ([@problem_id:3308135]) 将引导你探索更通用的 $\\theta$ 方法，它统一了显式和隐式格式。通过推导其稳定性函数并分析A-稳定性，你将掌握处理扩散问题中常见的“刚性”(stiffness)现象的关键技术，理解隐式方法为何在计算流体力学中如此重要。", "problem": "考虑由抛物型偏微分方程 $u_{t}=\\nu u_{xx}$ 控制的一维被动标量粘性扩散，其中 $u(x,t)$ 是标量场，$\\nu0$ 是运动粘度。假设在一个周期性空间域上，使用间距为 $\\Delta x$ 的均匀网格和时间步长 $\\Delta t$ 进行离散化。空间二阶导数由标准中心有限差分算子近似，并使用 $\\theta$ 方法进行时间推进：\n$$\n\\frac{u_{j}^{n+1}-u_{j}^{n}}{\\Delta t}=\\nu\\left[\\theta\\,\\delta_{xx}u_{j}^{n+1}+\\left(1-\\theta\\right)\\delta_{xx}u_{j}^{n}\\right],\n$$\n其中 $u_{j}^{n}$ 近似 $u(x_{j},t^{n})$ 在 $x_{j}=j\\,\\Delta x$ 和 $t^{n}=n\\,\\Delta t$ 处的值，且 $\\delta_{xx}u_{j}^{n}=\\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{\\Delta x^{2}}$。\n\n从质量守恒和 Fick 扩散定律出发，论证抛物型模型 $u_{t}=\\nu u_{xx}$ 作为基本模型的合理性。然后，对于上述全离散格式：\n\n1. 使用波数为 $\\kappa\\in\\mathbb{R}$ 的傅里叶模态 ansatz $u_{j}^{n}=\\hat{u}^{n}\\exp(i\\,\\kappa\\,j\\,\\Delta x)$，推导单步放大因子 $G(\\kappa)$，使得 $\\hat{u}^{n+1}=G(\\kappa)\\,\\hat{u}^{n}$。用 $\\theta$、无量纲步长比 $r=\\nu\\,\\Delta t/\\Delta x^{2}$ 和 $\\kappa$ 以封闭形式表示您的结果。\n\n2. 将 $\\theta$ 方法视为求解 $\\operatorname{Re}\\lambda\\le 0$ 的线性测试方程 $y'=\\lambda y$ 的时间积分器，定义稳定性函数 $R(z)$，其中 $z=\\lambda \\Delta t$。确定 $\\theta$ 满足绝对稳定性（A-稳定性）的充要条件，A-稳定性定义为对于所有满足 $\\operatorname{Re}z\\le 0$ 的 $z$，都有 $|R(z)|\\le 1$。报告保证 A-稳定性的最小容许值 $\\theta$。\n\n你的最终答案应包含在一行中的两个条目：首先是 $G(\\kappa)$ 的闭式表达式，其次是确保 A-稳定性的最小容许值 $\\theta$。无需四舍五入。", "solution": "我们首先按照要求，从基本原理出发，论证控制方程——抛物型偏微分方程（PDE）的合理性。一维域中标量 $u(x,t)$（例如质量浓度或单位体积的热能）的守恒可以表述为：在任意控制体积 $[x_1, x_2]$ 内，$u$ 的总量的时间变化率等于穿过该体积边界的 $u$ 的净通量。设 $J(x,t)$ 为标量 $u$ 的通量，则积分形式的守恒定律为：\n$$\n\\frac{d}{dt} \\int_{x_1}^{x_2} u(x,t) \\, dx = J(x_1, t) - J(x_2, t)\n$$\n利用微积分基本定理，右侧可以写成一个积分：\n$$\nJ(x_1, t) - J(x_2, t) = - \\int_{x_1}^{x_2} \\frac{\\partial J(x,t)}{\\partial x} \\, dx\n$$\n假设控制体积 $[x_1, x_2]$ 不随时间变化，我们可以对左侧应用 Leibniz 积分法则：\n$$\n\\frac{d}{dt} \\int_{x_1}^{x_2} u(x,t) \\, dx = \\int_{x_1}^{x_2} \\frac{\\partial u(x,t)}{\\partial t} \\, dx\n$$\n将它们结合起来得到：\n$$\n\\int_{x_1}^{x_2} \\frac{\\partial u}{\\partial t} \\, dx = - \\int_{x_1}^{x_2} \\frac{\\partial J}{\\partial x} \\, dx \\implies \\int_{x_1}^{x_2} \\left( \\frac{\\partial u}{\\partial t} + \\frac{\\partial J}{\\partial x} \\right) dx = 0\n$$\n由于这个等式必须对任意区间 $[x_1, x_2]$ 都成立，被积函数必须恒等于零，从而得到微分形式的守恒定律：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial J}{\\partial x} = 0\n$$\n问题描述的是粘性扩散，其唯象模型是 Fick 第一定律（或热传导中的 Fourier 定律）。该定律指出，通量与浓度梯度的负值成正比。在一维情况下：\n$$\nJ(x,t) = -\\nu \\frac{\\partial u}{\\partial x}\n$$\n这里，$\\nu  0$ 是扩散系数，在问题陈述中被称为运动粘度。将此本构关系代入守恒定律，得到：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( -\\nu \\frac{\\partial u}{\\partial x} \\right) = 0\n$$\n假设扩散系数 $\\nu$ 是一个不依赖于空间和时间的常数，我们可以将其从空间导数中提取出来：\n$$\n\\frac{\\partial u}{\\partial t} - \\nu \\frac{\\partial^2 u}{\\partial x^2} = 0\n$$\n这就是一维扩散方程 $u_t = \\nu u_{xx}$，其合理性已得到论证。这是一个抛物型偏微分方程，因为它的特征线是实数且重合的。\n\n接下来，我们解决问题中关于数值格式的两个部分。\n\n1. 放大因子 $G(\\kappa)$ 的推导。\n给定的使用 $\\theta$ 方法的全离散格式是：\n$$\n\\frac{u_{j}^{n+1}-u_{j}^{n}}{\\Delta t}=\\nu\\left[\\theta\\,\\delta_{xx}u_{j}^{n+1}+\\left(1-\\theta\\right)\\delta_{xx}u_{j}^{n}\\right]\n$$\n其中 $\\delta_{xx}u_{j} = \\frac{u_{j+1}-2u_{j}+u_{j-1}}{\\Delta x^{2}}$。\n我们通过将傅里葉模態 ansatz $u_{j}^{n}=\\hat{u}^{n}\\exp(i\\,\\kappa\\,j\\,\\Delta x)$ 代入该格式来进行 von Neumann 稳定性分析。首先，我们分析离散空间算子 $\\delta_{xx}$ 对此模态的作用：\n\\begin{align*}\n\\delta_{xx}u_{j}^{n} = \\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{\\Delta x^{2}} \\\\\n= \\frac{\\hat{u}^{n}\\exp(i\\kappa(j+1)\\Delta x) - 2\\hat{u}^{n}\\exp(i\\kappa j\\Delta x) + \\hat{u}^{n}\\exp(i\\kappa(j-1)\\Delta x)}{\\Delta x^{2}} \\\\\n= \\frac{\\hat{u}^{n}\\exp(i\\kappa j\\Delta x)}{\\Delta x^{2}} \\left( \\exp(i\\kappa\\Delta x) - 2 + \\exp(-i\\kappa\\Delta x) \\right)\n\\end{align*}\n使用 Euler 恒等式 $\\exp(i\\phi) + \\exp(-i\\phi) = 2\\cos(\\phi)$，上式简化为：\n$$\n\\delta_{xx}u_{j}^{n} = \\frac{\\hat{u}^{n}\\exp(i\\kappa j\\Delta x)}{\\Delta x^{2}} \\left( 2\\cos(\\kappa\\Delta x) - 2 \\right)\n$$\n使用三角恒等式 $1-\\cos(\\phi) = 2\\sin^2(\\phi/2)$，我们得到：\n$$\n\\delta_{xx}u_{j}^{n} = -\\frac{4}{\\Delta x^2}\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right) \\hat{u}^{n}\\exp(i\\kappa j\\Delta x) = -\\frac{4}{\\Delta x^2}\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right) u_j^n\n$$\n现在，我们将 ansatz $u_j^n$ 和 $u_j^{n+1}$ 代入完整的格式中。$\\exp(i\\kappa j\\Delta x)$ 是一个公因子，可以消去。假设关系式 $\\hat{u}^{n+1} = G(\\kappa)\\hat{u}^{n}$ 成立。\n$$\n\\frac{\\hat{u}^{n+1}-\\hat{u}^{n}}{\\Delta t} = \\nu\\left[\\theta\\,\\left(-\\frac{4}{\\Delta x^2}\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right)\\right)\\hat{u}^{n+1}+\\left(1-\\theta\\right)\\left(-\\frac{4}{\\Delta x^2}\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right)\\right)\\hat{u}^{n}\\right]\n$$\n令 $r = \\frac{\\nu\\Delta t}{\\Delta x^2}$ 为无量纲步长比。两边乘以 $\\Delta t$ 可得：\n$$\n\\hat{u}^{n+1}-\\hat{u}^{n} = -4r\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right) \\left[ \\theta\\hat{u}^{n+1} + (1-\\theta)\\hat{u}^{n} \\right]\n$$\n我们将包含 $\\hat{u}^{n+1}$ 的项收集到左边，包含 $\\hat{u}^{n}$ 的项收集到右边：\n$$\n\\hat{u}^{n+1} \\left( 1 + 4r\\theta\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right) \\right) = \\hat{u}^{n} \\left( 1 - 4r(1-\\theta)\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right) \\right)\n$$\n因此，单步放大因子 $G(\\kappa) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}}$ 为：\n$$\nG(\\kappa) = \\frac{1 - 4r(1-\\theta)\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right)}{1 + 4r\\theta\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right)}\n$$\n这就是所要求的闭式表达式。\n\n2. A-稳定性分析。\n对于线性测试方程 $y' = \\lambda y$，$\\theta$ 方法为：\n$$\n\\frac{y^{n+1}-y^n}{\\Delta t} = \\lambda\\left[ \\theta y^{n+1} + (1-\\theta)y^n \\right]\n$$\n令 $z = \\lambda\\Delta t$。方程变为：\n$$\ny^{n+1}-y^n = z\\left[ \\theta y^{n+1} + (1-\\theta)y^n \\right]\n$$\n求解比值 $y^{n+1}/y^n$，我们找到稳定性函数 $R(z)$：\n$$\ny^{n+1}(1 - \\theta z) = y^n(1 + (1-\\theta)z) \\implies R(z) = \\frac{y^{n+1}}{y^n} = \\frac{1 + (1-\\theta)z}{1 - \\theta z}\n$$\nA-稳定性要求对于所有满足 $\\operatorname{Re}(z) \\le 0$ 的复数 $z$，都有 $|R(z)| \\le 1$。这个条件可以写成 $|1 + (1-\\theta)z|^2 \\le |1 - \\theta z|^2$。\n令 $z = x+iy$，其中 $x = \\operatorname{Re}(z) \\le 0$ 且 $y = \\operatorname{Im}(z) \\in \\mathbb{R}$。\n$$\n|1 + (1-\\theta)(x+iy)|^2 \\le |1 - \\theta(x+iy)|^2\n$$\n$$\n|(1 + (1-\\theta)x) + i(1-\\theta)y|^2 \\le |(1 - \\theta x) - i\\theta y|^2\n$$\n展开模的平方：\n$$\n(1 + (1-\\theta)x)^2 + (1-\\theta)^2 y^2 \\le (1 - \\theta x)^2 + \\theta^2 y^2\n$$\n$$\n1 + 2(1-\\theta)x + (1-\\theta)^2 x^2 + (1-\\theta)^2 y^2 \\le 1 - 2\\theta x + \\theta^2 x^2 + \\theta^2 y^2\n$$\n展开并按变量的幂次分组可得：\n$$\n1 + 2(1-\\theta)x + (1-\\theta)^2(x^2+y^2) \\le 1 - 2\\theta x + \\theta^2(x^2+y^2)\n$$\n从两边消去 $1$ 并重新整理得到：\n$$\n2(1-\\theta)x + 2\\theta x \\le (\\theta^2 - (1-\\theta)^2)(x^2+y^2)\n$$\n$$\n2x \\le (\\theta^2 - (1-2\\theta+\\theta^2))(x^2+y^2)\n$$\n$$\n2x \\le (2\\theta-1)(x^2+y^2)\n$$\n这个不等式必须对所有 $x \\le 0$ 和所有 $y \\in \\mathbb{R}$ 成立。项 $x^2+y^2 = |z|^2$ 总是非负的。\n我们考察系数 $(2\\theta-1)$。\n- 如果 $\\theta  1/2$，则 $2\\theta-1  0$。不等式变为 $2x \\le (\\text{负数})(x^2+y^2)$。右侧是非正的。我们测试 $x=0, y\\ne0$。不等式变为 $0 \\le (2\\theta-1)y^2$，这意味着 $0 \\le (\\text{负数})(\\text{正数})$，这是一个矛盾。一个更直接的推理思路是将不等式重写为 $2x - (2\\theta-1)(x^2+y^2) \\le 0$。令 $x=-\\epsilon  0$。则 $-2\\epsilon + (1-2\\theta)(\\epsilon^2+y^2) \\le 0$。由于 $1-2\\theta0$，我们可以选择足够大的 $y$ 使得 $(1-2\\theta)y^2  2\\epsilon$，从而违反了该不等式。因此，$\\theta  1/2$ 的格式不是 A-稳定的。\n- 如果 $\\theta = 1/2$ (Crank-Nicolson 方法)，不等式变为 $2x \\le 0$。由于我们是在 $x = \\operatorname{Re}(z) \\le 0$ 的区域内评估该条件，这个不等式总是成立的。因此，该方法是 A-稳定的。\n- 如果 $\\theta > 1/2$，则 $2\\theta-1 > 0$。不等式为 $2x \\le (2\\theta-1)(x^2+y^2)$。左侧 $2x$ 是非正的。右侧是一个正数 $(2\\theta-1)$ 与一个非负数 $(x^2+y^2)$ 的乘积，因此是非负的。一个非正数总是小于或等于一个非负数，所以该不等式总是成立的。\n\n$\\theta$ 方法是 A-稳定的充要条件是 $\\theta \\ge 1/2$。问题要求的是保证 A-稳定性的最小容许值 $\\theta$，即这个区间的下界。\n最小容许值为 $\\theta = 1/2$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1 - 4r(1-\\theta)\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right)}{1 + 4r\\theta\\sin^2\\left(\\frac{\\kappa\\Delta x}{2}\\right)}  \\frac{1}{2} \\end{pmatrix}}\n$$", "id": "3308135"}, {"introduction": "稳定性和精度是数值格式的核心，但物理真实性同样不可或缺。高阶格式在追求更高精度的同时，有时会引入非物理的振荡，例如负的浓度或温度。这个动手编程练习 ([@problem_id:3308133]) 将让你直面这一挑战：首先通过一个具体例子观察高阶格式如何违反“正定性”，然后亲手实现一种通用的修正技术——通量限制器，来构建一个既保持高阶精度又满足物理约束的稳健算法。", "problem": "考虑一维热方程，这是一个表现出类扩散行为的抛物型偏微分方程的典型例子，\n$$\nu_t = D\\,u_{xx},\n$$\n该方程建立在周期性域 $[0,1)$ 上，扩散系数 $D0$。在需要的地方假设光滑性，并考虑使用 $N$ 个网格点、网格间距 $\\Delta x = 1/N$ 和时间步长 $\\Delta t$ 的均匀离散化。定义无量纲参数 $r = D\\,\\Delta t/\\Delta x^2$。\n\n您将比较周期性网格上扩散算子的两种时间显式、守恒的空间离散化方法：\n\n- 一种低阶三点拉普拉斯算子（空间二阶精度），其显式欧拉更新为\n$$\nu_i^{n+1} = u_i^{n} + r\\left(u_{i-1}^{n} - 2\\,u_i^{n} + u_{i+1}^{n}\\right),\n$$\n以及\n\n- 一种高阶五点拉普拉斯算子（空间四阶精度），其显式欧拉更新为\n$$\nu_i^{n+1} = u_i^{n} + \\frac{r}{12}\\left(-u_{i-2}^{n} + 16\\,u_{i-1}^{n} - 30\\,u_i^{n} + 16\\,u_{i+1}^{n} - u_{i+2}^{n}\\right).\n$$\n\n两种格式都使用周期性索引。众所周知，当 $r \\le 1/2$ 时，低阶格式是单调的，因为它将每个 $u_i^{n+1}$ 更新为相邻值 $u_{i-1}^{n}$、$u_i^{n}$ 和 $u_{i+1}^{n}$ 的凸组合，这保证了对非负初始数据的保正性。相比之下，对于任何 $r0$，高阶显式更新中乘以 $u_{i\\pm 2}^{n}$ 的系数为负，这可能导致某些非负初始条件在单个时间步后失去正性。\n\n您的任务如下。\n\n- 构造、模拟并检测一个反例。使用高阶格式将一个非负初始条件 $u^n \\ge 0$ 向前演化一个时间步，并证明对于某个容许的 $r \\le 1/2$，$u^{n+1}$ 中包含负值。使用周期性边界条件。您必须至少在一个测试案例中用数值方法证明这一点。\n\n- 通过使用凸混合低阶更新的通量限制方法，提出并实现一个保正性修复方案。定义从同一 $u^n$ 计算出的低阶更新 $u^{\\mathrm{LO}}$ 和高阶更新 $u^{\\mathrm{HO}}$。令反扩散修正为 $\\delta = u^{\\mathrm{HO}} - u^{\\mathrm{LO}}$。令 $u_{\\max}^{0} = \\max_i u_i^n$ 表示当前时间层级上初始状态的最大值。定义一个全局限制器 $\\alpha \\in [0,1]$，使得受限更新\n$$\nu^{\\mathrm{LIM}} = u^{\\mathrm{LO}} + \\alpha\\,\\delta\n$$\n对所有 $i$ 满足边界 $0 \\le u^{\\mathrm{LIM}}_i \\le u_{\\max}^{0}$。通过施加以下逐点约束并取最小值来计算 $\\alpha$：\n$$\n\\alpha_i^{\\min} =\n\\begin{cases}\n\\min\\!\\left(1, \\dfrac{u^{\\mathrm{LO}}_i - 0}{-\\,\\delta_i}\\right),  \\text{若 } \\delta_i  0,\\\\[1.5ex]\n\\min\\!\\left(1, \\dfrac{u_{\\max}^{0} - u^{\\mathrm{LO}}_i}{\\delta_i}\\right),  \\text{若 } \\delta_i  0,\\\\[1.5ex]\n1,  \\text{若 } \\delta_i = 0,\n\\end{cases}\n$$\n然后设置 $\\alpha = \\min_i \\alpha_i^{\\min}$。如果上述任何分数的分子为非正数，则将相应的 $\\alpha_i^{\\min}$ 解释为 $0$。这是一种本着通量修正输运 (Flux-Corrected Transport, FCT) 精神的全局凸限制策略。\n\n- 实现以下测试套件。对于每个案例，使用单个前向欧拉时间步。所有量均为无量纲。\n  1. 案例 A（尖锐界面，细网格）：$N=200$，$D=1$，$r=0.49$，初始数据为方波函数，当 $x \\in [0.45,0.55)$ 时 $u(x)=1$，否则 $u(x)=0$。\n  2. 案例 B（窄高斯函数，细网格）：$N=200$，$D=1$，$r=0.49$，初始数据为 $u(x)=\\exp\\!\\left(-\\left(\\dfrac{x-0.5}{0.02}\\right)^2\\right)$。\n  3. 案例 C（尖锐界面，小步长）：$N=200$，$D=1$，$r=0.05$，初始数据与案例 A 中的方波函数相同。\n  4. 案例 D（尖锐界面，粗网格，较弱扩散）：$N=50$，$D=0.5$，$r=0.49$，初始数据为方波函数，当 $x \\in [0.4,0.6)$ 时 $u(x)=1$，否则 $u(x)=0$。\n\n- 每个案例需要验证的量：\n  - 计算 $u^{\\mathrm{HO}}$ 并检查是否 $\\min_i u^{\\mathrm{HO}}_i  0$。\n  - 计算 $u^{\\mathrm{LIM}}$ 并检查是否同时满足 $\\min_i u^{\\mathrm{LIM}}_i \\ge 0$ 和 $\\max_i u^{\\mathrm{LIM}}_i \\le u_{\\max}^{0}$。\n\n- 要求的最终输出格式：\n  - 对每个测试案例，计算一个布尔值，当且仅当高阶更新违反了保正性，而受限更新同时满足下界和上界时，该值为真，即：\n    $$\n    \\left(\\min_i u^{\\mathrm{HO}}_i  0\\right)\\ \\text{且}\\ \\left(\\min_i u^{\\mathrm{LIM}}_i \\ge 0\\right)\\ \\text{且}\\ \\left(\\max_i u^{\\mathrm{LIM}}_i \\le u_{\\max}^{0}\\right).\n    $$\n  - 您的程序应生成单行输出，其中包含 A、B、C、D 四个测试案例的结果，结果为用方括号括起来的逗号分隔列表（例如，$[ \\text{true}, \\text{false}, \\text{true}, \\text{true} ]$）。处理数值比较时，使用 $10^{-12}$ 的容差，即 $a \\ge 0$ 表示 $a \\ge -10^{-12}$，$a \\le b$ 表示 $a \\le b + 10^{-12}$。", "solution": "所提出的问题是数值分析领域一个适定的练习，具体涉及抛物型偏微分方程的有限差分格式的性质。任务是研究一维热方程高阶格式的正性损失问题，并基于通量限制策略实现一种修正方法。问题的所有组成部分在科学上都是合理的，并且有明确的规定。\n\n控制偏微分方程是在周期性域 $[0,1)$ 上的一维热方程：\n$$\nu_t = D\\,u_{xx}\n$$\n其中 $u(x,t)$ 是演化的量（例如温度），$t$ 是时间，$x$ 是空间坐标，$D0$ 是扩散系数。下标表示偏微分。\n\n我们使用 $N$ 个网格点 $x_i = i\\Delta x$（$i=0, 1, \\dots, N-1$）来离散化该域，网格间距为均匀的 $\\Delta x = 1/N$。在网格点 $x_i$ 和时间步 $n$ 的解记为 $u_i^n$。我们使用时间步长为 $\\Delta t$ 的前向欧拉方法进行时间积分。无量纲参数 $r = D\\,\\Delta t/\\Delta x^2$，即扩散问题的 Courant-Friedrichs-Lewy (CFL) 数，决定了稳定性。\n\n考虑了两种显式格式来处理空间导数 $u_{xx}$。\n\n1.  **低阶 (LO) 格式**：此格式使用标准的三点中心差分模板，其空间精度为二阶。单个时间步的更新规则为：\n    $$\n    u_i^{\\mathrm{LO}} = u_i^{n} + r\\left(u_{i-1}^{n} - 2\\,u_i^{n} + u_{i+1}^{n}\\right)\n    $$\n    索引按周期性处理。这可以重写为：\n    $$\n    u_i^{\\mathrm{LO}} = r\\,u_{i-1}^{n} + (1 - 2r)\\,u_i^{n} + r\\,u_{i+1}^{n}\n    $$\n    为了使该格式保正，作用于 $u^n$ 的所有系数必须为非负。这要求 $r \\ge 0$ 和 $1 - 2r \\ge 0$，从而得出稳定性与保正性条件 $0 \\le r \\le 1/2$。如果此条件成立，$u_i^{\\mathrm{LO}}$ 就是非负值（假设 $u^n \\ge 0$）的凸组合，这保证了 $u_i^{\\mathrm{LO}} \\ge 0$。它也保证了最大值不增加，即 $\\max_i u_i^{\\mathrm{LO}} \\le \\max_j u_j^n$。\n\n2.  **高阶 (HO) 格式**：此格式使用五点模板，其空间精度为四阶。更新规则为：\n    $$\n    u_i^{\\mathrm{HO}} = u_i^{n} + \\frac{r}{12}\\left(-u_{i-2}^{n} + 16\\,u_{i-1}^{n} - 30\\,u_i^{n} + 16\\,u_{i+1}^{n} - u_{i+2}^{n}\\right)\n    $$\n    重写此式以检查系数可得：\n    $$\n    u_i^{\\mathrm{HO}} = \\left(-\\frac{r}{12}\\right)u_{i-2}^{n} + \\left(\\frac{16r}{12}\\right)u_{i-1}^{n} + \\left(1 - \\frac{30r}{12}\\right)u_i^{n} + \\left(\\frac{16r}{12}\\right)u_{i+1}^{n} + \\left(-\\frac{r}{12}\\right)u_{i+2}^{n}\n    $$\n    对于任何 $r  0$，$u_{i-2}^{n}$ 和 $u_{i+2}^{n}$ 的系数都是负的。这意味着更新不是一个凸组合，即使满足标准的线性稳定性条件，该格式也不能保证保正性。对于具有尖锐梯度的初始数据，例如测试案例中指定的方波函数，这些负系数可以作用于非零值，从而产生新的具有负值的局部极小值（下冲）。这就构成了要求我们寻找的反例。\n\n**保正性限制器**\n\n为了在保持正性的同时利用高阶格式的更高精度，我们采用一种类似于通量修正输运 (FCT) 的凸混合策略。受限解 $u^{\\mathrm{LIM}}$ 是由保证为正的低阶解和更精确的高阶解混合构造而成的。\n\n首先，我们将反扩散修正 $\\delta$ 定义为高阶更新与低阶更新之间的差值：\n$$\n\\delta \\equiv u^{\\mathrm{HO}} - u^{\\mathrm{LO}}\n$$\n代入更新的表达式，我们得到：\n\\begin{align*}\n\\delta_i  = \\left(u_i^n + \\frac{r}{12}(\\dots)\\right) - \\left(u_i^n + r(\\dots)\\right) \\\\\n = \\frac{r}{12}\\left(-u_{i-2}^n + 16u_{i-1}^n - 30u_i^n + 16u_{i+1}^n - u_{i+2}^n\\right) - r\\left(u_{i-1}^n - 2u_i^n + u_{i+1}^n\\right) \\\\\n = \\frac{r}{12}\\left(-u_{i-2}^n + (16-12)u_{i-1}^n + (-30+24)u_i^n + (16-12)u_{i+1}^n - u_{i+2}^n\\right) \\\\\n = \\frac{r}{12}\\left(-u_{i-2}^n + 4u_{i-1}^n - 6u_i^n + 4u_{i+1}^n - u_{i+2}^n\\right)\n\\end{align*}\n该修正项与 $-\\Delta x^4 u_{xxxx}$ 的四阶有限差分近似成正比，代表了两种格式之间主阶截断误差的差异。\n\n受限更新则定义为：\n$$\nu^{\\mathrm{LIM}} = u^{\\mathrm{LO}} + \\alpha\\,\\delta\n$$\n其中 $\\alpha \\in [0, 1]$ 是一个限制系数。目标是找到尽可能大的 $\\alpha$，使得得到的 $u^{\\mathrm{LIM}}$ 对所有 $i$ 都满足边界 $0 \\le u_i^{\\mathrm{LIM}} \\le u_{\\max}^{0}$，其中 $u_{\\max}^{0} = \\max_j u_j^n$。\n\n我们对每个节点 $i$ 施加这些边界，以找到一个局部限制因子 $\\alpha_i^{\\min}$，然后在全局范围内取最严格的值，即 $\\alpha = \\min_i \\alpha_i^{\\min}$。\n\n*   **施加下界 ($u_i^{\\mathrm{LIM}} \\ge 0$)：**\n    $u_i^{\\mathrm{LO}} + \\alpha_i \\delta_i \\ge 0$。\n    如果 $\\delta_i  0$，加上此项有使结果变为负数的风险。我们必须限制其影响：$\\alpha_i (-\\delta_i) \\le u_i^{\\mathrm{LO}}$，这给出 $\\alpha_i \\le u_i^{\\mathrm{LO}} / (-\\delta_i)$。\n    如果 $\\delta_i  0$，由于 $u_i^{\\mathrm{LO}} \\ge 0$（因为 $r \\le 1/2$），该约束对于 $\\alpha_i \\ge 0$ 是自然满足的。\n    如果 $\\delta_i = 0$，则没有修正，也没有风险。\n\n*   **施加上界 ($u_i^{\\mathrm{LIM}} \\le u_{\\max}^0$)：**\n    $u_i^{\\mathrm{LO}} + \\alpha_i \\delta_i \\le u_{\\max}^0$。\n    如果 $\\delta_i  0$，加上此项有产生上冲的风险。我们必须限制它：$\\alpha_i \\delta_i \\le u_{\\max}^0 - u_i^{\\mathrm{LO}}$，这给出 $\\alpha_i \\le (u_{\\max}^0 - u_i^{\\mathrm{LO}}) / \\delta_i$。\n    如果 $\\delta_i  0$，由于 $u_i^{\\mathrm{LO}} \\le u_{\\max}^0$（根据低阶格式的性质），该约束对于 $\\alpha_i \\ge 0$ 是自然满足的。\n    如果 $\\delta_i = 0$，则没有修正，也没有风险。\n\n结合这些情况和约束 $\\alpha \\in [0,1]$，便可得到指定的逐点限制器 $\\alpha_i^{\\min}$ 的公式。如果分数的分子为非正数，则 $\\alpha_i^{\\min} = 0$ 的特殊规则正确地处理了低阶解已经达到或超出边界的情况，从而正确地防止任何会加剧违反边界的修正。\n\n**实现计划**\n\n对于每个测试案例，算法按以下步骤进行：\n1.  定义网格参数 $N$、$D$、$r$。\n2.  构建空间网格 $x$ 和初始条件向量 $u^n$。\n3.  计算 $u_{\\max}^{0} = \\max_i u_i^n$。\n4.  使用向量化操作计算低阶更新 $u^{\\mathrm{LO}}$ 和高阶更新 $u^{\\mathrm{HO}}$。周期性平移（$u_{i\\pm 1}$, $u_{i\\pm 2}$）可通过 `numpy.roll` 高效实现。\n5.  计算反扩散修正 $\\delta = u^{\\mathrm{HO}} - u^{\\mathrm{LO}}$。\n6.  首先根据提供的条件逻辑计算 $\\alpha_i^{\\min}$ 数组，然后找到其全局最小值，从而计算出限制器值 $\\alpha$。\n7.  计算最终的受限解 $u^{\\mathrm{LIM}} = u^{\\mathrm{LO}} + \\alpha \\delta$。\n8.  使用 $10^{-12}$ 的数值容差验证三个条件：\n    a. 高阶格式是否违反保正性？($\\min_i u_i^{\\mathrm{HO}}  -10^{-12}$)\n    b. 受限格式是否为正？($\\min_i u_i^{\\mathrm{LIM}} \\ge -10^{-12}$)\n    c. 受限格式是否遵守最大值原理？($\\max_i u_i^{\\mathrm{LIM}} \\le u_{\\max}^{0} + 10^{-12}$)\n9.  该测试案例的最终结果是这三个布尔结果的逻辑与。\n此过程将应用于所有四个指定的测试案例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing a high-order and a limited high-order\n    scheme for the 1D heat equation, checking for positivity violations\n    and the effectiveness of the limiter.\n    \"\"\"\n    \n    # Define test cases as a list of dictionaries\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"N\": 200, \"D\": 1.0, \"r\": 0.49,\n            \"ic_type\": \"tophat\", \"ic_params\": {\"a\": 0.45, \"b\": 0.55}\n        },\n        {\n            \"name\": \"Case B\",\n            \"N\": 200, \"D\": 1.0, \"r\": 0.49,\n            \"ic_type\": \"gaussian\", \"ic_params\": {\"mu\": 0.5, \"sigma\": 0.02}\n        },\n        {\n            \"name\": \"Case C\",\n            \"N\": 200, \"D\": 1.0, \"r\": 0.05,\n            \"ic_type\": \"tophat\", \"ic_params\": {\"a\": 0.45, \"b\": 0.55}\n        },\n        {\n            \"name\": \"Case D\",\n            \"N\": 50, \"D\": 0.5, \"r\": 0.49,\n            \"ic_type\": \"tophat\", \"ic_params\": {\"a\": 0.4, \"b\": 0.6}\n        }\n    ]\n\n    results = []\n    TOL = 1e-12\n\n    for case in test_cases:\n        N = case[\"N\"]\n        D = case[\"D\"]\n        r = case[\"r\"]\n        \n        # Set up grid and initial conditions\n        x = np.linspace(0, 1, N, endpoint=False)\n        u0 = np.zeros(N)\n        if case[\"ic_type\"] == \"tophat\":\n            a, b = case[\"ic_params\"][\"a\"], case[\"ic_params\"][\"b\"]\n            u0[(x >= a)  (x  b)] = 1.0\n        elif case[\"ic_type\"] == \"gaussian\":\n            mu, sigma = case[\"ic_params\"][\"mu\"], case[\"ic_params\"][\"sigma\"]\n            u0 = np.exp(-((x - mu) / sigma)**2)\n\n        u_max_0 = np.max(u0)\n\n        # 1. Low-order (LO) update\n        # u_LO = u0 + r * (u_{i-1} - 2*u_i + u_{i+1})\n        u_lo = u0 + r * (np.roll(u0, 1) - 2 * u0 + np.roll(u0, -1))\n\n        # 2. High-order (HO) update\n        # u_HO = u0 + (r/12) * (-u_{i-2} + 16u_{i-1} - 30u_i + 16u_{i+1} - u_{i+2})\n        u_ho = u0 + (r / 12.0) * (\n            -np.roll(u0, 2) + 16 * np.roll(u0, 1) - 30 * u0 + 16 * np.roll(u0, -1) - np.roll(u0, -2)\n        )\n\n        # 3. Antidiffusive correction\n        delta = u_ho - u_lo\n        \n        # 4. Compute limiter alpha\n        alpha_i_min = np.ones_like(u0)\n\n        # Case delta  0 (undershoot correction)\n        idx_neg_delta = np.where(delta  -TOL)[0]\n        if idx_neg_delta.size > 0:\n            numerators = u_lo[idx_neg_delta]\n            denominators = -delta[idx_neg_delta]\n            \n            # Initialize ratios to 0, which is the value if numerator is nonpositive\n            ratios = np.zeros_like(numerators)\n            \n            # Only calculate for positive numerators\n            calc_mask = numerators > 0\n            ratios[calc_mask] = numerators[calc_mask] / denominators[calc_mask]\n\n            alpha_i_min[idx_neg_delta] = np.minimum(1.0, ratios)\n            \n        # Case delta > 0 (overshoot correction)\n        idx_pos_delta = np.where(delta > TOL)[0]\n        if idx_pos_delta.size > 0:\n            numerators = u_max_0 - u_lo[idx_pos_delta]\n            denominators = delta[idx_pos_delta]\n\n            ratios = np.zeros_like(numerators)\n\n            calc_mask = numerators > 0\n            ratios[calc_mask] = numerators[calc_mask] / denominators[calc_mask]\n\n            alpha_i_min[idx_pos_delta] = np.minimum(1.0, ratios)\n\n        alpha = np.min(alpha_i_min)\n\n        # 5. Compute limited update\n        u_lim = u_lo + alpha * delta\n\n        # 6. Perform the required checks\n        ho_violates_positivity = np.min(u_ho)  -TOL\n        lim_preserves_positivity = np.min(u_lim) >= -TOL\n        lim_preserves_maximum = np.max(u_lim) = u_max_0 + TOL\n\n        final_bool = ho_violates_positivity and lim_preserves_positivity and lim_preserves_maximum\n        results.append(str(final_bool).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3308133"}]}