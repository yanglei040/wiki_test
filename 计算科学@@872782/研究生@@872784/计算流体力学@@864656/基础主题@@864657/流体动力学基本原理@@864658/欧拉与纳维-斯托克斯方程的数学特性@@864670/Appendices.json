{"hands_on_practices": [{"introduction": "要掌握欧拉方程的双曲特性，第一步是分析其局部波传播结构。这项练习的核心是推导通量雅可比矩阵的特征值和特征向量，它们分别代表了系统中的特征波速和波动模式[@problem_id:3343704]。这项基本分析是构建如黎曼求解器等高阶数值格式的理论基石。", "problem": "考虑理想气体的一维可压缩欧拉方程的守恒形式，其比热比为 $\\gamma$：\n$$\n\\frac{\\partial \\boldsymbol{Q}}{\\partial t} + \\frac{\\partial \\boldsymbol{f}(\\boldsymbol{Q})}{\\partial x} = \\boldsymbol{0},\n\\quad\n\\boldsymbol{Q} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\rho E \\end{pmatrix},\n\\quad\n\\boldsymbol{f}(\\boldsymbol{Q}) = \\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu(\\rho E + p)\n\\end{pmatrix},\n$$\n其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是比总能，$p$ 是压力，满足理想气体状态方程 $p = (\\gamma - 1)\\rho e$，其中 $e$ 是比内能。定义声速 $c$ 为 $c^{2} = \\gamma p / \\rho$，比总焓 $H$ 为 $H = (\\rho E + p)/\\rho$。\n\n在光滑状态下，通量雅可比矩阵 $\\boldsymbol{A}(\\boldsymbol{Q}) = \\partial \\boldsymbol{f}/\\partial \\boldsymbol{Q}$ 表征了小振幅扰动的局部传播。从守恒律和状态方程出发，用原始变量 $(\\rho, u, p)$ 和 $\\gamma$ 推导 $\\boldsymbol{A}(\\boldsymbol{Q})$ 的特征速度以及左、右特征向量。施加归一化条件，使得左特征向量矩阵 $\\boldsymbol{L}$ 满足 $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$，其中 $\\boldsymbol{R}$ 是右特征向量矩阵，$\\boldsymbol{I}$ 是单位矩阵。特别地，构造与特征值 $u$ 相关联的接触（熵）波，其对应的特征向量使得压力和速度保持不变。\n\n讨论系统在声速状态下的数学特性，阐明其特征结构是亏损的还是可对角化的，并分析其对近似黎曼求解器的影响，包括在跨声速稀疏波附近需要进行熵修正。\n\n最后，对于围绕基态 $(\\rho, u, p)$ 的一个一般小扰动 $\\delta \\boldsymbol{Q} = \\begin{pmatrix} \\delta \\rho \\\\ \\delta(\\rho u) \\\\ \\delta(\\rho E) \\end{pmatrix}$，计算接触波的标量振幅 $\\alpha_{2}$，其定义为 $\\alpha_{2} = \\boldsymbol{\\ell}_{2} \\cdot \\delta \\boldsymbol{Q}$，其中 $\\boldsymbol{\\ell}_{2}$ 是在归一化条件 $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$ 下与特征值 $u$ 相关联的左特征向量。用 $u$、$c$、$\\gamma$、$\\delta \\rho$、$\\delta(\\rho u)$ 和 $\\delta(\\rho E)$ 的符号形式表示 $\\alpha_{2}$ 的最终答案。不需要进行数值计算。", "solution": "本题要求对一维欧拉方程进行特征分析，包括推导特征值和特征向量，讨论声速点特性，并计算小扰动中接触波的振幅。\n\n### 1. 特征分解\n\n一维欧拉方程的守恒形式为 $\\frac{\\partial \\boldsymbol{Q}}{\\partial t} + \\frac{\\partial \\boldsymbol{f}(\\boldsymbol{Q})}{\\partial x} = \\boldsymbol{0}$。其拟线性形式为 $\\frac{\\partial \\boldsymbol{Q}}{\\partial t} + \\boldsymbol{A}(\\boldsymbol{Q})\\frac{\\partial \\boldsymbol{Q}}{\\partial x} = \\boldsymbol{0}$，其中 $\\boldsymbol{A}(\\boldsymbol{Q}) = \\frac{\\partial \\boldsymbol{f}}{\\partial \\boldsymbol{Q}}$ 是通量雅可比矩阵。$\\boldsymbol{A}$ 的特征结构决定了小扰动的传播特性。\n\n$\\boldsymbol{A}$ 的特征值为系统的特征波速：\n$$\n\\lambda_1 = u - c, \\quad \\lambda_2 = u, \\quad \\lambda_3 = u + c\n$$\n它们分别对应逆行声波、熵/接触波和顺行声波。\n\n相应的右特征向量 $\\boldsymbol{r}_k$（满足 $\\boldsymbol{A}\\boldsymbol{r}_k = \\lambda_k \\boldsymbol{r}_k$）代表了波的模式。一个标准的选择是：\n$$\n\\boldsymbol{r}_1 = \\begin{pmatrix} 1 \\\\ u-c \\\\ H-uc \\end{pmatrix}, \\quad\n\\boldsymbol{r}_2 = \\begin{pmatrix} 1 \\\\ u \\\\ u^2/2 \\end{pmatrix}, \\quad\n\\boldsymbol{r}_3 = \\begin{pmatrix} 1 \\\\ u+c \\\\ H+uc \\end{pmatrix}\n$$\n其中 $H = E + p/\\rho$ 是比总焓。特征向量 $\\boldsymbol{r}_2$ 描述了接触波，它只改变密度（和熵），而压力和速度保持不变。\n\n### 2. 声速点特性与数值影响\n\n在声速点，例如 $u = c$（且 $c>0$），特征值变为 $\\lambda_1 = 0$, $\\lambda_2 = c$, $\\lambda_3 = 2c$。由于特征值互不相同，雅可比矩阵 $\\boldsymbol{A}$ 仍然是可对角化的，并且存在一个完备的特征向量集。因此，系统在声速点仍然是严格双曲的，其数学特性没有亏损。\n\n然而，数值上，当两个特征值（如 $\\lambda_1$ 和 $\\lambda_2$）在跨音速稀疏波中变得非常接近时，某些近似黎曼求解器（如 Roe 格式）可能会产生非物理的数值振荡或熵违反解。这需要在这些求解器中引入所谓的“熵修正”来保证解的物理正确性。\n\n### 3. 接触波振幅计算\n\n任何小扰动 $\\delta \\boldsymbol{Q}$ 都可以唯一地分解为特征波的线性叠加：\n$$\n\\delta \\boldsymbol{Q} = \\alpha_1 \\boldsymbol{r}_1 + \\alpha_2 \\boldsymbol{r}_2 + \\alpha_3 \\boldsymbol{r}_3\n$$\n为了计算接触波的标量振幅 $\\alpha_2$，我们需要找到与 $\\lambda_2 = u$ 相关的归一化左特征向量 $\\boldsymbol{\\ell}_2$。左特征向量是矩阵 $\\boldsymbol{L}$ 的行，满足 $\\boldsymbol{L}\\boldsymbol{A} = \\boldsymbol{\\Lambda}\\boldsymbol{L}$ 和归一化条件 $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$，其中 $\\boldsymbol{R}$ 的列是右特征向量 $\\boldsymbol{r}_k$。这意味着 $\\alpha_k = \\boldsymbol{\\ell}_k \\cdot \\delta\\boldsymbol{Q}$。\n\n对于上述选择的右特征向量 $\\boldsymbol{r}_k$，对应的左特征向量 $\\boldsymbol{\\ell}_2$ 是：\n$$\n\\boldsymbol{\\ell}_2 = \\left( 1 - \\frac{(\\gamma-1)u^2}{2c^2}, \\quad \\frac{(\\gamma-1)u}{c^2}, \\quad -\\frac{\\gamma-1}{c^2} \\right)\n$$\n现在，我们可以计算振幅 $\\alpha_2$：\n$$\n\\alpha_2 = \\boldsymbol{\\ell}_2 \\cdot \\delta\\boldsymbol{Q} = \\boldsymbol{\\ell}_2 \\cdot \\begin{pmatrix} \\delta \\rho \\\\ \\delta(\\rho u) \\\\ \\delta(\\rho E) \\end{pmatrix}\n$$\n$$\n\\alpha_2 = \\left(1 - \\frac{(\\gamma-1)u^2}{2c^2}\\right)\\delta\\rho + \\frac{(\\gamma-1)u}{c^2}\\delta(\\rho u) - \\frac{\\gamma-1}{c^2}\\delta(\\rho E)\n$$\n这就是与小扰动 $\\delta\\boldsymbol{Q}$ 中接触波分量相关的标量振幅。", "answer": "$$\\boxed{\\left(1 - \\frac{(\\gamma-1)u^2}{2c^2}\\right)\\delta\\rho + \\frac{(\\gamma-1)u}{c^2}\\delta(\\rho u) - \\frac{\\gamma-1}{c^2}\\delta(\\rho E)}$$", "id": "3343704"}, {"introduction": "特征线的概念并非纯粹的抽象理论，它在计算流体力学中具有关键的实际应用。本练习将特征线理论应用于任何CFD模拟都必须面对的核心问题：边界条件的设定[@problem_id:3343739]。通过分析计算域边界处的信息传播方向（即特征值的符号），我们可以精确地确定为保证问题适定性所必须施加的物理条件的数量。", "problem": "考虑一个定义在具有光滑边界段的区域上的二维定常可压缩欧拉方程，该边界段的单位外法向量为 $\\boldsymbol{n} = (n_{x}, n_{y})$。令守恒状态量为 $U = (\\rho, \\rho u, \\rho v, \\rho E)^{\\top}$，其中 $\\rho$ 是质量密度，$(u, v)$ 是速度 $\\boldsymbol{u}$ 的笛卡尔分量，$E$ 是总比能。假设气体为热力学和量热学完美的理想气体，其比热比 $\\gamma > 1$，因此压力满足 $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho (u^{2} + v^{2})\\right)$，声速为 $a = \\sqrt{\\gamma p / \\rho}$。以守恒形式表示，定常方程为 $\\partial_{x}\\boldsymbol{F}(U) + \\partial_{y}\\boldsymbol{G}(U) = \\boldsymbol{0}$，其中 $\\boldsymbol{F}$ 和 $\\boldsymbol{G}$ 分别是 $x$ 和 $y$ 方向的无粘通量。\n\n使用特征线法 (MOC)，分析沿边界法向投影的准线性形式的特征结构。令速度的法向分量为 $u_{n} = \\boldsymbol{u}\\cdot\\boldsymbol{n}$。假设边界为亚声速入流边界，即 $u_{n}  0$ 且 $|u_{n}|  a$。从基本定义和欧拉方程出发，确定与法向通量雅可比矩阵相关的每个特征速度的符号，并根据输入与输出特征场来阐述边界数据要求。基于此分类，计算在此类亚声速入流边界上必须指定多少个独立的标量边界条件，才能使二维定常欧拉系统局部适定。请将最终计数以单个整数形式给出。最终答案无需四舍五入，也不包含任何单位。", "solution": "我们首先回顾，对于理想气体，二维定常可压缩欧拉方程可以写成守恒形式\n$$\n\\partial_{x}\\boldsymbol{F}(U) + \\partial_{y}\\boldsymbol{G}(U) = \\boldsymbol{0},\n$$\n其中 $U = (\\rho, \\rho u, \\rho v, \\rho E)^{\\top}$，$p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho (u^{2} + v^{2})\\right)$，$a = \\sqrt{\\gamma p / \\rho}$。为了在边界上使用特征线法 (MOC)，我们将准线性形式沿单位外法向 $\\boldsymbol{n} = (n_{x}, n_{y})$ 进行投影。定义法向通量\n$$\n\\boldsymbol{F}_{n}(U) = n_{x}\\boldsymbol{F}(U) + n_{y}\\boldsymbol{G}(U),\n$$\n以及相应的法向雅可比矩阵\n$$\nA_{n}(U) = \\frac{\\partial \\boldsymbol{F}_{n}}{\\partial U}(U).\n$$\n系统在法向上的特征速度是 $A_{n}(U)$ 的特征值。物理上，在无粘可压缩流中，特征场包括熵和切向涡量的对流输运以及声波。在与法向对齐的局部一维意义上，$A_{n}$ 的特征结构反映了速度为 $u_{n} = \\boldsymbol{u}\\cdot\\boldsymbol{n}$、声速为 $a$ 的一维欧拉方程的特征结构。\n\n标准的推导（通过对 $A_{n}$ 进行显式线性化，或通过投影已知的欧拉通量雅可比矩阵的特征结构）表明，在二维情况下，$A_{n}$ 的四个特征值为\n$$\n\\lambda_{1} = u_{n} - a, \\quad \\lambda_{2} = u_{n}, \\quad \\lambda_{3} = u_{n}, \\quad \\lambda_{4} = u_{n} + a.\n$$\n重特征值 $u_{n}$ 对应于沿流动对流输运的熵和切向涡量（或剪切），而 $u_{n} \\pm a$ 对应于两个声学特征族。\n\n特征线法根据 $\\lambda_{i}$ 相对于外法线的符号，将特征分为相对于计算域的输入特征或输出特征。对于外法线，$\\lambda_{i}  0$ 的特征是进入区域的（输入），而 $\\lambda_{i} > 0$ 的特征是离开区域的（输出）。必须指定的独立标量边界条件的数量等于输入特征场的数量，因为输出特征上的数据由内部解确定，不得过定。\n\n给定边界为亚声速入流边界，即\n$$\nu_{n}  0 \\quad \\text{且} \\quad |u_{n}|  a.\n$$\n我们现在在这些条件下确定特征值的符号：\n\n- 对于 $\\lambda_{2} = u_{n}$，因为 $u_{n}  0$，所以有 $\\lambda_{2}  0$。\n- 对于 $\\lambda_{3} = u_{n}$，同理可得 $\\lambda_{3}  0$。\n- 对于 $\\lambda_{1} = u_{n} - a$，亚声速条件 $|u_{n}|  a$ 且 $u_{n}  0$ 意味着 $u_{n} - a  0 - a  0$，因此 $\\lambda_{1}  0$。\n- 对于 $\\lambda_{4} = u_{n} + a$，亚声速条件 $|u_{n}|  a$ 得出 $u_{n} + a > -|u_{n}| + a > 0$，因此 $\\lambda_{4} > 0$。\n\n因此，在一个具有外法线的亚声速入流边界上，恰好有三个输入特征场（即 $\\lambda_{1}  0$、$\\lambda_{2}  0$ 和 $\\lambda_{3}  0$ 的特征场）和一个输出特征场（即 $\\lambda_{4} > 0$ 的特征场）。根据 MOC 的边界数据要求，必须在边界上指定的独立标量边界条件的数量等于输入特征的数量，即 $3$。\n\n就物理量而言，这三条边界数据可以被选择来固定与输入场相关的热力学和运动学量的组合（例如，指定熵或驻点条件以及流动方向）。输出的声学特征由内部相容性确定，不应被指定。只要所选的原始变量能够张成输入特征子空间，该计数就与具体选择的原始变量无关。\n\n因此，对于二维定常欧拉方程，在亚声速入流边界上所需的边界条件数量为 $3$。", "answer": "$$\\boxed{3}$$", "id": "3343739"}, {"introduction": "本练习将从理论推导转向计算实践，旨在揭示时间可逆的欧拉方程与耗散的纳维-斯托克斯方程之间的根本数学差异。通过设计一个时间反演数值实验，我们将直观地展示由黏性项（抛物项）引入的不可逆“时间之箭”[@problem_id:3343741]。这个实践将通过量化能量耗散和反演误差，具体地阐释黏性是如何破坏系统的时间对称性的。", "problem": "要求您设计并实现一个程序，对由欧拉方程（零粘度）和纳维-斯托克斯方程（正粘度）控制的二维不可压缩流进行时间反演实验。目标是使用基于原理的诊断方法，评估这些方程在时间反演下的数学特性：欧拉方程的数值可逆性和纳维-斯托克斯方程的不可逆性。\n\n此任务的基本原理如下。\n\n- 在周期性方形区域中，不可压缩纳维-斯托克斯方程为\n$$\n\\partial_t \\boldsymbol{u} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,\n$$\n其中欧拉方程是其特例 $\\nu = 0$。此处 $\\boldsymbol{u}(x,y,t)$ 是速度，$p(x,y,t)$ 是压力（相差一个常数），$\\nu \\ge 0$ 是运动粘度。\n\n- 在二维空间中，引入标量涡量 $\\omega = \\partial_x u_y - \\partial_y u_x$ 和流函数 $\\psi$（定义为 $\\boldsymbol{u} = (\\partial_y \\psi, -\\partial_x \\psi)$），这样不可压缩性就自动满足。涡量的演化遵循\n$$\n\\partial_t \\omega + \\boldsymbol{u}\\cdot\\nabla \\omega = \\nu \\nabla^2 \\omega,\n$$\n流函数满足椭圆关系\n$$\n\\nabla^2 \\psi = -\\omega.\n$$\n\n- 在时间反演 $t \\mapsto -t$ 下，当与变换 $\\boldsymbol{u}\\mapsto -\\boldsymbol{u}$（等价于 $\\omega \\mapsto -\\omega$）结合时，欧拉方程是不变的，但对于 $\\nu0$ 的纳维-斯托克斯方程，由于存在不可逆的粘性项 $\\nu \\nabla^2 \\boldsymbol{u}$，其不具有不变性。\n\n- 动能为\n$$\nE(t) = \\frac{1}{2} \\int_{\\Omega} \\lVert \\boldsymbol{u}(x,y,t)\\rVert^2 \\, \\mathrm{d}x \\,\\mathrm{d}y,\n$$\n在二维情况下，对于光滑解有精确的平衡关系\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} E(t) = - \\nu \\int_{\\Omega} \\omega(x,y,t)^2 \\, \\mathrm{d}x \\,\\mathrm{d}y,\n$$\n因此，当 $\\nu = 0$ 时 $E$ 守恒，当 $\\nu > 0$ 时 $E$ 单调递减。特别地，在时间区间 $[0,T]$ 上的累积耗散为\n$$\nD(0,T) = \\nu \\int_{0}^{T} \\int_{\\Omega} \\omega(x,y,t)^2 \\, \\mathrm{d}x \\,\\mathrm{d}y \\,\\mathrm{d}t.\n$$\n\n您的程序必须在周期性方形区域 $\\Omega = [0,2\\pi)^2$ 上实现空间伪谱离散化，使用 $N \\times N$ 的等距网格，并对非线性项采用 $2/3$ 去混叠规则。采用一种对无粘部分（$\\nu=0$）严格时间对称的时间积分格式，以使欧拉动力学在映射 $t \\mapsto -t, \\omega \\mapsto -\\omega$ 下数值可逆，并在 $\\nu > 0$ 时通过积分因子精确处理粘性项，以避免扩散分量中的人为不稳定性。所有三角函数必须使用弧度作为角度单位。所有量均为无量纲。\n\n每个测试用例的时间反演实验协议：\n\n1. 将 $t=0$ 时的初始涡量设置为\n$$\n\\omega_0(x,y) = A \\left[\\sin(3x + 2y) + \\cos(2x - y)\\right],\n$$\n其中 $A$ 是给定的振幅。通过求解 $\\nabla^2 \\psi_0 = -\\omega_0$ 得到流函数 $\\psi_0$，从而恢复相应的无散速度 $\\boldsymbol{u}_0$。\n\n2. 对于给定的粘度 $\\nu \\ge 0$，使用固定的时间步长 $\\Delta t$ 和 $M$ 个步数（即 $T = M \\Delta t$）从 $t=0$ 向前积分到 $t=T$。记录前向积分的动能 $E(0)$ 和 $E(T)$，并计算累积耗散诊断量\n$$\nD(0,T) \\approx \\nu \\sum_{n=0}^{M-1} \\left( \\int_{\\Omega} \\omega(x,y,t_n)^2 \\, \\mathrm{d}x \\,\\mathrm{d}y \\right) \\Delta t,\n$$\n其中 $t_n = n \\Delta t$。使用具有均匀时间步长的标准黎曼和。\n\n3. 执行时间反演实验：从前向积分中构建两个连续的终端状态，并对这两个状态一致地应用映射 $\\omega \\mapsto -\\omega$。然后使用相同的 $\\nu$ 和 $\\Delta t$ 向前推进相同的步数 $M$。最后，将得到的涡量场与 $-\\omega_0$ 进行比较，并报告相对反演误差\n$$\n\\varepsilon_{\\mathrm{rev}} = \\frac{\\lVert \\omega_{\\mathrm{rev}}(T) + \\omega_0 \\rVert_{L^2(\\Omega)}}{\\lVert \\omega_0 \\rVert_{L^2(\\Omega)}},\n$$\n遵循约定，如果 $\\lVert \\omega_0 \\rVert_{L^2(\\Omega)} = 0$，则 $\\varepsilon_{\\mathrm{rev}} := 0$。此处 $\\lVert \\cdot \\rVert_{L^2(\\Omega)}$ 表示在周期性方形区域上的标准 $L^2$ 范数。\n\n4. 同时报告能量比\n$$\nR_E = \\frac{E(T)}{E(0)}.\n$$\n\n您的程序必须为每个测试用例计算一个浮点数三元组 $(\\varepsilon_{\\mathrm{rev}}, R_E, D(0,T))$。\n\n测试套件：\n\n使用以下四个参数集来检验实验的不同方面和边界情况。在所有情况下，空间网格为 $N = 32$，区域为 $\\Omega = [0,2\\pi)^2$，时间步长为 $\\Delta t = 0.0025$，时间步数为 $M = 400$，因此 $T = 1.0$。\n\n- 情况1（欧拉方程，可逆基准）：$(\\nu, A) = (0.0, 1.0)$。\n- 情况2（纳维-斯托克斯方程，轻度耗散）：$(\\nu, A) = (0.001, 1.0)$。\n- 情况3（纳维-斯托克斯方程，较强耗散）：$(\\nu, A) = (0.01, 1.0)$。\n- 情况4（平凡边界情况）：$(\\nu, A) = (0.01, 0.0)$。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含四个情况的结果，按顺序串联成一个包含十二个浮点数的扁平列表：\n$$\n[\\varepsilon_{\\mathrm{rev}}^{(1)}, R_E^{(1)}, D^{(1)}, \\varepsilon_{\\mathrm{rev}}^{(2)}, R_E^{(2)}, D^{(2)}, \\varepsilon_{\\mathrm{rev}}^{(3)}, R_E^{(3)}, D^{(3)}, \\varepsilon_{\\mathrm{rev}}^{(4)}, R_E^{(4)}, D^{(4)}].\n$$\n该行必须严格按照方括号内逗号分隔列表的格式打印，不得包含任何额外文本。所有三角函数角度必须以弧度为单位。所有量均为无量纲。答案为浮点数。", "solution": "用户旨在实现一个数值实验，以研究二维不可压缩欧拉方程和纳维-斯托克斯方程的时间反演特性。该问题定义明确，科学上合理，并提供了足够的细节来构建一个唯一的数值解。我将按照规定进行实现。\n\n### 基于原理的设计\n\n问题的核心在于在二维周期性区域 $\\Omega = [0,2\\pi)^2$ 上数值求解涡量输运方程：\n$$\n\\partial_t \\omega + \\boldsymbol{u}\\cdot\\nabla \\omega = \\nu \\nabla^2 \\omega\n$$\n速度 $\\boldsymbol{u}$ 通过满足泊松方程 $\\nabla^2 \\psi = -\\omega$ 的流函数 $\\psi$ 从涡量 $\\omega$ 中恢复。我们将使用伪谱方法进行空间离散化，并采用专门的时间步进格式。\n\n**1. 空间离散化：伪谱方法**\n\n采用伪谱方法，该方法在 $N \\times N$ 网格上表示涡量等场，并使用快速傅里叶变换（FFT）切换到傅里叶空间进行计算。\n\n- **从涡量到速度**：在傅里叶空间中，导数变成代数乘法。流函数的傅里叶系数 $\\hat{\\psi}$ 与涡量的傅里叶系数 $\\hat{\\omega}$ 的关系为：\n$$\n-(k_x^2 + k_y^2)\\hat{\\psi}(\\boldsymbol{k}) = -\\hat{\\omega}(\\boldsymbol{k}) \\implies \\hat{\\psi}(\\boldsymbol{k}) = \\frac{\\hat{\\omega}(\\boldsymbol{k})}{k_x^2 + k_y^2}\n$$\n其中 $\\boldsymbol{k}=(k_x, k_y)$ 是波矢量。通过设置 $\\hat{\\psi}(0,0)=0$ 来处理 $\\boldsymbol{k}=0$ 的情况。速度系数则为 $\\hat{u}_x = i k_y \\hat{\\psi}$ 和 $\\hat{u}_y = -i k_x \\hat{\\psi}$。\n\n- **非线性平流项**：平流项 $\\boldsymbol{u}\\cdot\\nabla\\omega$ 通过伪谱方法计算。我们通过逆 FFT 在物理空间中计算 $\\boldsymbol{u}$ 和 $\\omega$，将它们相乘，然后通过 FFT 变换回傅里叶空间以计算空间导数。为了防止这种二次非线性产生的混叠误差，在计算非线性乘积后，通过将高频模式（$|k_x|, |k_y| > \\lfloor N/3 \\rfloor$）置零来应用 $2/3$ 去混叠规则。\n\n- **粘性扩散项**：扩散项 $\\nu \\nabla^2 \\omega$ 在傅里叶空间中变为 $-\\nu (k_x^2 + k_y^2) \\hat{\\omega}$，这是一个简单的乘法。\n\n**2. 时间积分**\n\n问题要求对无粘部分采用时间对称格式，并对粘性项进行精确处理。一种满足这些条件且适用于两步反演实验的格式是指数时间差分蛙跳类方法。傅里叶空间中的半离散方程为：\n$$\n\\frac{d\\hat{\\omega}}{dt} = F(\\hat{\\omega}) + L\\hat{\\omega}\n$$\n其中 $L\\hat{\\omega} = -\\nu(k_x^2+k_y^2)\\hat{\\omega}$ 是线性扩散算子，$F(\\hat{\\omega})$ 是非线性平流算子。\n\n一种对 $F$ 时间对称并用积分因子处理 $L$ 的二阶格式是：\n$$\n\\hat{\\omega}^{n+1} = e^{2L\\Delta t} \\hat{\\omega}^{n-1} + 2\\Delta t e^{L\\Delta t} F(\\hat{\\omega}^n)\n$$\n对于 $\\nu=0$，这简化为标准的二阶蛙跳格式 $\\hat{\\omega}^{n+1} = \\hat{\\omega}^{n-1} + 2\\Delta t F(\\hat{\\omega}^n)$，该格式是时间可逆的。对于 $\\nu>0$，指数因子破坏了时间反演对称性，正确地模拟了物理上的不可逆性。\n\n- **启动**：这是一个两步法，需要 $\\hat{\\omega}^0$ 和 $\\hat{\\omega}^1$ 来启动。$\\hat{\\omega}^0$ 由初始条件给出。$\\hat{\\omega}^1$ 使用二阶龙格-库塔法（Heun 法）计算第一个时间步。这保持了总体的二阶精度。\n\n**3. 时间反演协议**\n\n1.  **前向积分**：系统从 $t=0$ 演化到 $t=T=M\\Delta t$。存储最后两个时间步的状态 $\\omega^{M-1}$ 和 $\\omega^{M}$。计算初始和最终动能 $E(0), E(T)$ 以及总耗散 $D(0,T)$。\n    - 动能：$E = \\frac{1}{2}\\int |\\boldsymbol{u}|^2 dV$。使用 Parseval 定理，这可以在傅里叶空间中高效计算：$E(t) = \\frac{1}{2} \\frac{(2\\pi)^2}{N^4} \\sum_{K \\neq 0} \\frac{|\\hat{\\omega}(\\boldsymbol{k},t)|^2}{k_x^2+k_y^2}$。\n    - 耗散：$D(0,T) \\approx \\nu \\Delta t \\sum_{n=0}^{M-1} \\lVert \\omega(t_n) \\rVert^2_{L^2}$，其中范数的平方也通过 Parseval 定理计算：$\\lVert \\omega \\rVert^2_{L^2} \\approx \\frac{(2\\pi)^2}{N^4} \\sum_{\\boldsymbol{k}} |\\hat{\\omega}(\\boldsymbol{k})|^2$。\n\n2.  **反向积分**：使用相同的数值积分器再向前推进 $M$ 步，但初始条件源自前向运行的最终状态。对于一个两步法，初始状态是一对场。我们将时间反演变换 $\\omega \\mapsto -\\omega$ 应用于两个连续的终端状态：\n    - $\\omega_{\\text{rev}}(0) = -\\omega(T)$\n    - $\\omega_{\\text{rev}}(\\Delta t) = -\\omega(T-\\Delta t)$（这需要对我们的格式稍作调整，我们使用 $\\omega^{M}$ 和 $\\omega^{M-1}$）\n    因此，反向蛙跳积分的初始对为 $(\\hat{\\omega}_{\\text{rev}}^0, \\hat{\\omega}_{\\text{rev}}^1) = (-\\hat{\\omega}^M, -\\hat{\\omega}^{M-1})$。\n\n3.  **诊断**：反向积分后，将最终状态 $\\omega_{\\text{rev}}(T)$ 与初始状态的负值 $-\\omega_0$ 进行比较，以计算反演误差 $\\varepsilon_{\\mathrm{rev}}$。同时报告能量比 $R_E=E(T)/E(0)$。\n\n这种数值设置可以直接探究方程的数学特性。对于欧拉方程的情况（$\\nu=0$），该格式是时间可逆的，因此 $\\varepsilon_{\\mathrm{rev}}$ 应接近于零（受限于浮点误差和启动格式的不对称性）。对于纳维-斯托克斯方程的情况（$\\nu>0$），该格式是不可逆的，预计 $\\varepsilon_{\\mathrm{rev}}$ 会很显著，这展示了由粘度引入的“时间之箭”。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ... No, use numpy.fft\n# from scipy.fft import fft2, ifft2 is an allowed equivalent\n\ndef solve():\n    \"\"\"\n    Main function to run the time-reversal experiment for all test cases.\n    \"\"\"\n\n    def solve_case(N, dt, M, nu, A):\n        \"\"\"\n        Solves a single time-reversal experiment case.\n        \"\"\"\n        # =====================================================================\n        # 1. Grid and Wavenumber Setup\n        # =====================================================================\n        L = 2 * np.pi\n        dx = L / N\n        x = np.arange(N) * dx\n        X, Y = np.meshgrid(x, x, indexing='ij')\n\n        kx_1d = np.fft.fftfreq(N, d=dx/L)\n        Kx, Ky = np.meshgrid(kx_1d, kx_1d, indexing='ij')\n        K2 = Kx**2 + Ky**2\n\n        K2_inv = np.zeros_like(K2)\n        K2_inv[K2  0] = 1.0 / K2[K2  0]\n\n        kmax = N // 3\n        dealias_mask = (np.abs(Kx) = kmax)  (np.abs(Ky) = kmax)\n\n        # =====================================================================\n        # 2. Helper Functions\n        # =====================================================================\n        def get_advection_hat(omega_hat):\n            psi_hat = -omega_hat * K2_inv\n            ux_hat = 1j * Ky * psi_hat\n            uy_hat = -1j * Kx * psi_hat\n\n            ux = np.real(np.fft.ifft2(ux_hat))\n            uy = np.real(np.fft.ifft2(uy_hat))\n            omega = np.real(np.fft.ifft2(omega_hat))\n\n            ux_omega_hat = np.fft.fft2(ux * omega)\n            uy_omega_hat = np.fft.fft2(uy * omega)\n            \n            ux_omega_hat[~dealias_mask] = 0\n            uy_omega_hat[~dealias_mask] = 0\n\n            return -(1j * Kx * ux_omega_hat + 1j * Ky * uy_omega_hat)\n\n        def get_L2_norm_sq(omega_hat):\n            return (L**2 / N**4) * np.sum(np.abs(omega_hat)**2)\n\n        def get_energy(omega_hat):\n            energy_density_hat = K2_inv * np.abs(omega_hat)**2\n            return 0.5 * (L**2 / N**4) * np.sum(energy_density_hat)\n        \n        # =====================================================================\n        # 3. Initial Condition  Trivial Case\n        # =====================================================================\n        if A == 0.0:\n            return 0.0, 1.0, 0.0\n\n        omega0 = A * (np.sin(3 * X + 2 * Y) + np.cos(2 * X - Y))\n        omega0_hat = np.fft.fft2(omega0)\n\n        # =====================================================================\n        # 4. Forward Integration\n        # =====================================================================\n        w_hat_p = np.copy(omega0_hat)  # omega_hat at t_{n-1}\n        dissipation_sum = get_L2_norm_sq(w_hat_p)\n        E0 = get_energy(w_hat_p)\n\n        # Startup Step (RK2 - Heun's method) to get omega_hat at t_1\n        k1 = get_advection_hat(w_hat_p) - nu * K2 * w_hat_p\n        w_hat_star = w_hat_p + dt * k1\n        k2 = get_advection_hat(w_hat_star) - nu * K2 * w_hat_star\n        w_hat_c = w_hat_p + 0.5 * dt * (k1 + k2)  # omega_hat at t_n\n\n        # Main Time-Stepping Loop\n        exp_visc_1 = np.exp(-nu * K2 * dt)\n        exp_visc_2 = np.exp(-2 * nu * K2 * dt)\n        \n        omega_hat_M_minus_1 = None\n\n        for n in range(1, M):\n            if n  M:\n                 dissipation_sum += get_L2_norm_sq(w_hat_c)\n            \n            # Exponential Leapfrog step\n            F_hat_c = get_advection_hat(w_hat_c)\n            w_hat_n = exp_visc_2 * w_hat_p + 2 * dt * exp_visc_1 * F_hat_c\n            \n            w_hat_p = w_hat_c\n            w_hat_c = w_hat_n\n\n            if n == M - 2:\n                omega_hat_M_minus_1 = np.copy(w_hat_c)\n\n        omega_hat_M = np.copy(w_hat_c)\n\n        ET = get_energy(omega_hat_M)\n        RE = ET / E0 if E0  0 else 1.0\n        DT = nu * dt * dissipation_sum\n\n        # =====================================================================\n        # 5. Time-Reversal Experiment\n        # =====================================================================\n        w_hat_rev_p = -omega_hat_M          # omega_rev^0 = -omega^M\n        w_hat_rev_c = -omega_hat_M_minus_1  # omega_rev^1 = -omega^{M-1}\n\n        for n in range(1, M):\n            F_hat_rev_c = get_advection_hat(w_hat_rev_c)\n            w_hat_rev_n = exp_visc_2 * w_hat_rev_p + 2 * dt * exp_visc_1 * F_hat_rev_c\n            \n            w_hat_rev_p = w_hat_rev_c\n            w_hat_rev_c = w_hat_rev_n\n\n        omega_hat_rev_final = w_hat_rev_c\n        \n        norm_w0_sq = get_L2_norm_sq(omega0_hat)\n        norm_err_sq = get_L2_norm_sq(omega_hat_rev_final + omega0_hat)\n        eps_rev = np.sqrt(norm_err_sq / norm_w0_sq)\n\n        return eps_rev, RE, DT\n\n    # --- Main execution script ---\n    test_cases = [\n        (0.0, 1.0),    # Case 1: Euler\n        (0.001, 1.0),  # Case 2: Navier-Stokes (mild)\n        (0.01, 1.0),   # Case 3: Navier-Stokes (strong)\n        (0.01, 0.0),   # Case 4: Trivial\n    ]\n    \n    N = 32\n    dt = 0.0025\n    M = 400\n    \n    results = []\n    for nu, A in test_cases:\n        eps_rev, RE, DT = solve_case(N, dt, M, nu, A)\n        results.extend([eps_rev, RE, DT])\n        \n    print(f\"[{','.join(f'{x:.7g}' for x in results)}]\")\n\nsolve()\n```", "id": "3343741"}]}