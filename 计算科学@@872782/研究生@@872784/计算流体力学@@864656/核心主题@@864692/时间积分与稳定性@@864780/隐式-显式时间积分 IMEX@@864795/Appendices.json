{"hands_on_practices": [{"introduction": "冯·诺依曼稳定性分析是理解线性、周期性问题数值格式稳定性的基石。本练习将通过一个典型的对流-扩散方程，指导你为一种常用的隐式-显式龙格-库塔（$IMEX-RK$）方法推导其放大因子。通过亲自计算并确定其稳定性边界，你将掌握评估 $IMEX$ 格式性能的一项基本技能。", "problem": "考虑一维空间中的线性平流-扩散方程，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n该方程定义在一个周期性区域上，使用间距为 $\\Delta x$ 的均匀网格。设平流速度 $a$ 和运动粘度 $\\nu$ 为非负常数。对一个两阶段的隐式-显式（IMEX）龙格-库塔（RK）方法进行冯·诺依曼（傅里叶）稳定性分析，其中平流项被显式处理，扩散项被隐式处理。\n\n假设使用以下半离散空间算子：\n- 对于 $a \\ge 0$ 的平流项，使用一阶迎风差分 $D^{-} u_{j} = (u_{j} - u_{j-1})/\\Delta x$，其对应波数 $\\theta \\in [0,\\pi]$ 的离散傅里叶符号为 $-a (1 - \\exp(-\\mathrm{i}\\theta))/\\Delta x$，\n- 对于扩散项，使用二阶中心拉普拉斯算子 $L u_{j} = (u_{j+1} - 2 u_{j} + u_{j-1})/\\Delta x^{2}$，其离散傅里叶符号为 $-4 \\nu \\sin^{2}(\\theta/2)/\\Delta x^{2}$。\n\n定义库朗数和扩散数，\n$$\nC = \\frac{a \\Delta t}{\\Delta x}, \\qquad D = \\frac{\\nu \\Delta t}{\\Delta x^{2}},\n$$\n并考虑 Ascher–Ruuth–Spiteri 的带参数的两阶段二阶 IMEX RK 格式\n$$\n\\gamma = 1 - \\frac{1}{\\sqrt{2}},\n$$\n其显式和隐式布卓表（Butcher tableaux）为\n$$\n\\text{显式（平流）：}\\quad \n\\begin{array}{c|cc}\n0 & 0 & 0 \\\\\n1 & 1 & 0 \\\\\n\\hline\n  & \\tfrac{1}{2} & \\tfrac{1}{2}\n\\end{array}\n\\qquad\n\\text{隐式（扩散）：}\\quad \n\\begin{array}{c|cc}\n\\gamma & \\gamma & 0 \\\\\n1-\\gamma & 1 - 2\\gamma & \\gamma \\\\\n\\hline\n  & \\tfrac{1}{2} & \\tfrac{1}{2}\n\\end{array}.\n$$\n\n令 $G(\\theta)$ 表示此 IMEX RK 方法应用于波数为 $\\theta$ 的傅里叶模式的半离散系统时的单步放大因子。从第一性原理出发推导 $G(\\theta)$，并确定最大库朗数 $C_{\\max}$，使得该格式对于所有离散波数在冯·诺依曼意义下都是稳定的，即，\n$$\n|G(\\theta)| \\le 1 \\quad \\text{对于所有} \\quad \\theta \\in [0,\\pi],\n$$\n且该稳定性对任何非负扩散数 $D \\ge 0$ 一致成立。将最终答案表示为一个无量纲数。无需四舍五入。", "solution": "用户希望对应用于线性平流-扩散方程的给定隐式-显式（IMEX）龙格-库塔格式进行冯·诺依曼稳定性分析。\n\n### 第一步：问题验证\n\n**提取已知条件：**\n-   **偏微分方程：** $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}}$，在周期性区域上。\n-   **常数：** 平流速度 $a \\ge 0$，运动粘度 $\\nu \\ge 0$。\n-   **空间离散化：** 均匀网格，间距 $\\Delta x$。\n-   **平流算子（显式）：** 对于 $a \\ge 0$ 的一阶迎风差分，$-a D^{-} u_{j} = -a (u_{j} - u_{j-1})/\\Delta x$。\n-   **平流傅里叶符号：** 算子 $-a D^{-}$ 的符号给定为 $-a (1 - \\exp(-\\mathrm{i}\\theta))/\\Delta x$，其中波数 $\\theta \\in [0,\\pi]$。\n-   **扩散算子（隐式）：** 二阶中心拉普拉斯算子，$\\nu L u_{j} = \\nu (u_{j+1} - 2 u_{j} + u_{j-1})/\\Delta x^{2}$。\n-   **扩散傅里叶符号：** 算子 $\\nu L$ 的符号给定为 $-4 \\nu \\sin^{2}(\\theta/2)/\\Delta x^{2}$。\n-   **无量纲数：** 库朗数 $C = \\frac{a \\Delta t}{\\Delta x}$，扩散数 $D = \\frac{\\nu \\Delta t}{\\Delta x^{2}}$。\n-   **IMEX格式：** 一个由显式和隐式布卓表及参数 $\\gamma = 1 - \\frac{1}{\\sqrt{2}}$ 定义的两阶段二阶格式。\n    $$\n    \\text{显式（平流）：}\\quad A_E = \\begin{pmatrix} 0 & 0 \\\\ 1 & 0 \\end{pmatrix}, \\quad b_E^T = (\\tfrac{1}{2}, \\tfrac{1}{2})\n    $$\n    $$\n    \\text{隐式（扩散）：}\\quad A_I = \\begin{pmatrix} \\gamma & 0 \\\\ 1 - 2\\gamma & \\gamma \\end{pmatrix}, \\quad b_I^T = (\\tfrac{1}{2}, \\tfrac{1}{2})\n    $$\n-   **稳定性条件：** 单步放大因子 $G(\\theta)$ 必须满足 $|G(\\theta)| \\le 1$ 对所有 $\\theta \\in [0,\\pi]$ 和任何非负扩散数 $D \\ge 0$ 成立。\n-   **目标：** 推导 $G(\\theta)$ 并找到满足稳定性条件的最大库朗数 $C_{\\max}$。\n\n**使用提取的已知条件进行验证：**\n-   **科学上合理：** 该问题是偏微分方程数值分析中的一个标准练习，特别是在计算流体动力学领域。平流-扩散方程、冯·诺依曼分析和 IMEX-RK 方法都是基础且成熟的概念。问题设置在科学上是合理的。\n-   **适定性：** 问题提供了所有必要信息：方程、离散化方法、它们的傅里叶符号、时间步进格式以及稳定性判据。目标是找到一个单一、特定的数值（$C_{\\max}$）。该问题是适定的。\n-   **目标：** 该问题使用精确的数学语言和定义进行表述，没有歧义或主观论断。\n\n**结论：** 该问题有效。\n\n### 第二步：放大因子的推导\n\n对每个网格点 $u_j$，偏微分方程的半离散形式为：\n$$\n\\frac{du_j}{dt} = \\underbrace{-a D^{-} u_j}_{\\text{显式}} + \\underbrace{\\nu L u_j}_{\\text{隐式}}\n$$\n我们通过考虑单个傅里叶模式 $u_j(t) = \\hat{u}(t) \\exp(\\mathrm{i} j \\theta)$ 来进行冯·诺依曼分析，其中 $\\theta = k_m \\Delta x$ 是无量纲波数。将此代入半离散方程，得到关于模式振幅 $\\hat{u}(t)$ 的常微分方程：\n$$\n\\frac{d\\hat{u}}{dt} = (\\hat{F} + \\hat{N}) \\hat{u}\n$$\n其中 $\\hat{F}$ 和 $\\hat{N}$ 分别是显式和隐式空间算子的傅里叶符号（特征值）。使用给定的符号：\n$$\n\\hat{F} = -a \\frac{1 - \\exp(-\\mathrm{i}\\theta)}{\\Delta x}\n$$\n$$\n\\hat{N} = \\nu \\frac{-4 \\sin^{2}(\\theta/2)}{\\Delta x^{2}} = \\nu \\frac{2(\\cos(\\theta)-1)}{\\Delta x^2}\n$$\n我们定义无量纲参数 $z_E = \\Delta t \\hat{F}$ 和 $z_I = \\Delta t \\hat{N}$。\n$$\nz_E = -\\frac{a \\Delta t}{\\Delta x} (1 - \\exp(-\\mathrm{i}\\theta)) = -C(1 - \\cos\\theta + \\mathrm{i}\\sin\\theta)\n$$\n$$\nz_I = \\frac{\\nu \\Delta t}{\\Delta x^2} (2(\\cos\\theta - 1)) = -2D(1 - \\cos\\theta)\n$$\n注意，对于 $D \\ge 0$，$z_I$ 总是实数且非正。\n\n放大因子 $G(\\theta) = G(z_E, z_I)$ 是 IMEX-RK 格式应用于标量线性常微分方程 $\\hat{u}' = (\\hat{F}+\\hat{N})\\hat{u}$ 时的稳定性函数。对于隐式部分的对角隐式龙格-库塔（DIRK）结构，将该方法应用于 $y' = Fy+Ny$（其中 $F=\\hat{F}, N=\\hat{N}$）的阶段 $K_i$ 为：\n$$\nK_i = y_n + \\Delta t \\sum_{j=1}^{i-1} a_{ij} F K_j + \\Delta t \\sum_{j=1}^{i} \\tilde{a}_{ij} N K_j\n$$\n对于我们的线性问题，令 $U^{(i)}$ 为阶段解。\n阶段1：\n$$\nU^{(1)} = u_n + \\Delta t \\tilde{a}_{11} N U^{(1)} \\implies (1 - \\tilde{a}_{11} z_I)U^{(1)} = u_n\n$$\n由于 $\\tilde{a}_{11} = \\gamma$，我们有 $U^{(1)} = (1 - \\gamma z_I)^{-1} u_n$。\n阶段2：\n$$\nU^{(2)} = u_n + \\Delta t a_{21} F U^{(1)} + \\Delta t (\\tilde{a}_{21} N U^{(1)} + \\tilde{a}_{22} N U^{(2)})\n$$\n$$\n(1 - \\tilde{a}_{22} z_I)U^{(2)} = u_n + (a_{21}z_E + \\tilde{a}_{21}z_I) U^{(1)}\n$$\n使用 $a_{21}=1$，$\\tilde{a}_{21}=1-2\\gamma$，$\\tilde{a}_{22}=\\gamma$：\n$$\n(1 - \\gamma z_I)U^{(2)} = u_n + (z_E + (1-2\\gamma)z_I) (1-\\gamma z_I)^{-1}u_n\n$$\n$$\nU^{(2)} = \\left[ (1-\\gamma z_I)^{-1} + (z_E + (1-2\\gamma)z_I)(1-\\gamma z_I)^{-2} \\right] u_n\n$$\n最终解由以下公式给出：\n$$\nu_{n+1} = u_n + \\Delta t \\sum_{i=1}^2 b_i F U^{(i)} + \\Delta t \\sum_{i=1}^2 \\tilde{b}_i N U^{(i)}\n$$\n由于 $b_i = \\tilde{b}_i = 1/2$，我们有：\n$$\nu_{n+1} = u_n + \\frac{1}{2}(z_E+z_I)(U^{(1)} + U^{(2)})\n$$\n放大因子 $G(z_E, z_I) = u_{n+1}/u_n$ 为：\n$$\nG(z_E, z_I) = 1 + \\frac{1}{2}(z_E+z_I) \\left[ \\frac{U^{(1)}}{u_n} + \\frac{U^{(2)}}{u_n} \\right]\n$$\n$$\nG = 1 + \\frac{1}{2}(z_E+z_I) \\left[ 2(1-\\gamma z_I)^{-1} + (z_E + (1-2\\gamma)z_I)(1-\\gamma z_I)^{-2} \\right]\n$$\n$$\nG = 1 + \\frac{z_E+z_I}{2(1-\\gamma z_I)^2} [2(1-\\gamma z_I) + z_E + (1-2\\gamma)z_I]\n$$\n$$\nG = \\frac{2(1-\\gamma z_I)^2 + (z_E+z_I)(2+z_E+(1-4\\gamma)z_I)}{2(1-\\gamma z_I)^2}\n$$\n展开分子：\n$N_G = 2(1-2\\gamma z_I + \\gamma^2 z_I^2) + (2z_E+z_E^2+2z_I+(2-4\\gamma)z_Ez_I+(1-4\\gamma)z_I^2)$\n$N_G = (2+2z_E+z_E^2) + (2-4\\gamma)z_I + (2-4\\gamma)z_Ez_I + (2\\gamma^2-4\\gamma+1)z_I^2$\n参数 $\\gamma=1-1/\\sqrt{2}$ 是 $2\\gamma^2-4\\gamma+1=0$ 的一个根。因此，$z_I^2$ 项消失。\n$$\nN_G = (2+2z_E+z_E^2) + (2-4\\gamma)z_I(1+z_E)\n$$\n放大因子简化为：\n$$\nG(z_E, z_I) = \\frac{1+z_E+\\frac{1}{2}z_E^2 + (1-2\\gamma)z_I(1+z_E)}{(1-\\gamma z_I)^2}\n$$\n\n### 第三步：稳定性分析\n\n稳定性条件是对于所有的 $\\theta \\in [0, \\pi]$ 和所有的 $D \\ge 0$，都有 $|G(z_E, z_I)| \\le 1$。\n通过考虑没有扩散的情况，即 $D=0$，从而 $z_I=0$，可以获得稳定性的一个必要条件。\n$$\n|G(z_E, 0)| = |1 + z_E + \\frac{1}{2}z_E^2| \\le 1\n$$\n这是该格式显式部分（Heun法）的稳定性条件。随着 $\\theta$ 的变化，复数 $z_E$ 在复平面上描绘出一条曲线。我们必须找到最大的 $C$，使得整条曲线都位于 Heun法的稳定域内。\n该曲线由 $z_E = -C(1-e^{-\\mathrm{i}\\theta}) = -C + C e^{-\\mathrm{i}(\\theta-\\pi)}$ 给出。这可以写成 $z_E+C = C e^{-\\mathrm{i}(\\theta-\\pi)}$，描述了一个以 $-C$ 为中心、半径为 $C$ 的圆。当 $\\theta$ 从 $0$ 扫到 $\\pi$ 时，$z_E$ 从 $z_E(0)=0$ 到 $z_E(\\pi)=-2C$ 描绘出下半圆。\n\nHeun法的稳定域 $S = \\{z \\in \\mathbb{C} : |1+z+\\frac{1}{2}z^2| \\le 1\\}$ 与负实轴的交集为 $z \\in [-2, 0]$。这是通过设 $z=-x$（其中 $x>0$）并求解 $|1-x+\\frac{1}{2}x^2|\\le 1$ 得到的，该不等式简化为 $x(x-2)\\le 0$，解得 $0 \\le x \\le 2$。\n我们曲线的端点 $z_E(\\pi)=-2C$ 必须位于这个区间内。由于 $C \\ge 0$，我们需要 $-2C \\ge -2$，这意味着 $C \\le 1$。因此，一个必要条件是 $C_{\\max} \\le 1$。\n\n我们来检查 $C=1$ 对于 $D=0$ 的情况是否充分。当 $C=1$ 时，曲线为 $|z_E+1|=1$，且 $\\mathrm{Im}(z_E) \\le 0$。我们检查这条曲线是否在 $S$ 中。令 $z_E = -1+e^{-\\mathrm{i}\\phi}$，其中 $\\phi \\in [0, \\pi]$。\n$$\n|1+z_E+\\frac{1}{2}z_E^2| = |1+(-1+e^{-\\mathrm{i}\\phi})+\\frac{1}{2}(-1+e^{-\\mathrm{i}\\phi})^2| = |e^{-\\mathrm{i}\\phi}+\\frac{1}{2}(1-2e^{-\\mathrm{i}\\phi}+e^{-2\\mathrm{i}\\phi})| = |\\frac{1}{2}(1+e^{-2\\mathrm{i}\\phi})|\n$$\n$$\n|\\frac{1}{2}(1+e^{-2\\mathrm{i}\\phi})|^2 = \\frac{1}{4}(1+e^{-2\\mathrm{i}\\phi})(1+e^{2\\mathrm{i}\\phi}) = \\frac{1}{4}(2+2\\cos(2\\phi)) = \\frac{1+\\cos(2\\phi)}{2} = \\cos^2(\\phi)\n$$\n由于对所有 $\\phi$ 都有 $|\\cos^2(\\phi)| \\le 1$，所以稳定性条件对该曲线上的所有点都成立。因此，对于纯显式情况，$C_{\\max}=1$。\n\n现在，我们必须验证当 $C=1$ 时，格式对于任何 $D > 0$ 仍然是稳定的。我们需要证明，对于 $C=1$ 时的曲线上所有的 $z_E$，以及任何 $z_I = -X$（其中 $X = 2D(1-\\cos\\theta) \\ge 0$），$|G(z_E, z_I)| \\le 1$ 都成立。该条件是：\n$$\n|R_E(z_E) + (1-2\\gamma)z_I(1+z_E)|^2 \\le |(1-\\gamma z_I)^2|^2\n$$\n其中 $R_E(z_E) = 1+z_E+\\frac{1}{2}z_E^2$。代入 $z_I = -X$：\n$$\n|R_E(z_E) - (1-2\\gamma)X(1+z_E)|^2 \\le (1+\\gamma X)^4\n$$\n我们将其展开并整理成一个关于 $X$ 的多项式不等式：\n$$\nP(X) = (1+\\gamma X)^4 - |R_E(z_E) - (1-2\\gamma)X(1+z_E)|^2 \\ge 0\n$$\n将各项作为 $X$ 的多项式展开，我们需要对所有 $X \\ge 0$ 都有 $P(X) \\ge 0$。\n$P(X)= (\\gamma^4 X^4 + 4\\gamma^3 X^3) + (6\\gamma^2 - |(1-2\\gamma)(1+z_E)|^2)X^2 + (4\\gamma + 2\\text{Re}(R_E \\overline{A}))X + (1-|R_E|^2)$, 其中 $A=(1-2\\gamma)(1+z_E)$。\n对于 $C=1$，我们发现 $|R_E|^2 = \\cos^2\\theta$。所以常数项是 $1-\\cos^2\\theta = \\sin^2\\theta \\ge 0$。\n$X$ 的系数是 $4\\gamma + 2\\text{Re}(R_E \\bar{A})$。\n$A=(1-2\\gamma)(1+z_E) = (1-2\\gamma)e^{-\\mathrm{i}\\theta}$。$\\bar{A}=(1-2\\gamma)e^{\\mathrm{i}\\theta}$。\n$R_E = \\frac{1}{2}(1+e^{-2\\mathrm{i}\\theta})$。\n$R_E \\bar{A} = \\frac{1}{2}(1+e^{-2\\mathrm{i}\\theta})(1-2\\gamma)e^{\\mathrm{i}\\theta} = \\frac{1-2\\gamma}{2}(e^{\\mathrm{i}\\theta}+e^{-\\mathrm{i}\\theta}) = (1-2\\gamma)\\cos\\theta$。\n该项是实数，所以其实部就是其本身。系数为 $4\\gamma+2(1-2\\gamma)\\cos\\theta=2(2\\gamma+(1-2\\gamma)\\cos\\theta)$。\n由于 $\\gamma \\approx 0.293$，$1-2\\gamma \\approx 0.414$，两者均为正。该表达式的最小值在 $\\cos\\theta=-1$ 时取到，为 $2(2\\gamma-(1-2\\gamma))=2(4\\gamma-1) = 2(4(1-1/\\sqrt{2})-1)=2(3-2\\sqrt{2})>0$。所以这个系数是非负的。\n$X^2$ 的系数是 $6\\gamma^2 - |A|^2 = 6\\gamma^2-(1-2\\gamma)^2$。\n$\\gamma=1-1/\\sqrt{2} \\implies (1-\\gamma)^2=1/2 \\implies 1-2\\gamma+\\gamma^2=1/2 \\implies \\gamma^2=2\\gamma-1/2$。\n$1-2\\gamma = \\sqrt{2}-1$。\n该系数为 $6(2\\gamma-1/2) - (1-2\\gamma)^2 = 12\\gamma-3 - (\\sqrt{2}-1)^2 = 12(1-1/\\sqrt{2})-3 - (3-2\\sqrt{2}) = 12-6\\sqrt{2}-3-3+2\\sqrt{2} = 6-4\\sqrt{2}>0$。\n最后，$X^3$ 和 $X^4$ 的系数分别是 $4\\gamma^3$ 和 $\\gamma^4$，它们都是正的。\n当 $C=1$ 时，对于任何 $\\theta \\in [0,\\pi]$，多项式 $P(X)$ 的所有系数都是非负的。由于我们考虑 $X \\ge 0$，这保证了 $P(X) \\ge 0$。\n因此，选择 $C=1$ 对于所有 $D \\ge 0$ 都是稳定的。由于我们已经确定 $C_{\\max} \\le 1$，我们得出结论 $C_{\\max}=1$。", "answer": "$$\n\\boxed{1}\n$$", "id": "3334251"}, {"introduction": "虽然冯·诺依曼分析功能强大，但其应用局限于线性和周期性问题。为了分析更复杂的流动，例如可变密度流，我们需要更通用的工具——能量方法。本练习 [@problem_id:3334253] 将引导你跳出傅里叶模态的框架，在一个更抽象的算子理论下，通过构建离散动能的演化方程，来推导保证数值解能量不增的时间步长条件。掌握这种方法是进行高级计算流体动力学研究所需的一项核心分析能力。", "problem": "考虑在有界域 $\\Omega$ 上的可变密度不可压缩流，其边界条件足够光滑，以至于一个庞加莱型不等式对速度场成立。设给定一个有限维空间离散化，它将动能 $\\int_{\\Omega} \\frac{1}{2} \\rho |u|^{2} \\, dx$ 近似为加权二次型 $E(u) = \\frac{1}{2} u^{\\top} M u$，其中 $M$ 是一个包含离散密度场的对称正定质量矩阵。假设速度向量 $u(t)$ 的半离散动量方程可以写为\n$$\nM \\dot{u} = K u + \\nu L u,\n$$\n其中 $\\nu > 0$ 是运动粘度，$K$ 是离散对流算子，$L$ 是离散粘性算子。假设以下结构性质成立：\n- $K^{\\top} M = - M K$，这在加权动能范数下保证了对流的能量守恒；以及\n- $L^{\\top} M = M L$，其中 $M^{-1/2} L M^{-1/2}$ 是对称负定的，因此存在 $\\alpha > 0$ 使得在对称矩阵的意义下满足 $M^{-1/2} L M^{-1/2} \\le - \\alpha I$，这对应于由边界条件引起的矫顽粘性耗散。\n\n考虑一个一步一阶隐式-显式（IMEX）时间积分格式，即对粘性项使用后向欧拉法，对对流项使用前向欧拉法，对于时间步长 $\\Delta t > 0$ 给出：\n$$\nM u^{n+1} = M u^{n} + \\Delta t \\, K u^{n} + \\nu \\Delta t \\, L u^{n+1}.\n$$\n定义相似变换后的算子 $S = M^{-1/2} K M^{-1/2}$ 和 $D = M^{-1/2} L M^{-1/2}$，并令 $\\sigma = \\|S\\|_{2}$ 为反对称矩阵 $S$ 的谱范数（注意 $S^{\\top} = - S$）。假设 $\\sigma > \\alpha \\nu$，因此显式对流效应不会被粘性耗散平凡地主导。\n\n从离散能量 $E(u) = \\frac{1}{2} u^{\\top} M u$ 出发，推导 IMEX 格式的单步能量放大因子的一个界，并由此获得保证对于所有离散速度状态 $u^{n}$ 都有 $E(u^{n+1}) \\le E(u^{n})$ 的关于 $\\Delta t$ 的尖锐充分条件。在上述假设和由 $\\sigma$ 给出的范数界下，将确保离散动能不增加的最大时间步长 $\\Delta t_{\\mathrm{crit}}$ 表示为一个仅依赖于 $\\alpha$、$\\nu$ 和 $\\sigma$ 的单一闭式解析表达式。\n\n你的最终答案必须是 $\\Delta t_{\\mathrm{crit}}$ 的解析表达式。不需要进行数值计算，最终表达式中也不应包含任何单位。", "solution": "问题的分析按以下步骤进行：问题陈述的验证，将离散系统重构为标准形式，推导能量界，最后确定稳定性的临界时间步长。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件：**\n- 控制半离散方程：$M \\dot{u} = K u + \\nu L u$。\n- 状态向量：$u(t)$，离散速度向量。\n- 质量矩阵：$M$，对称正定。\n- 离散动能：$E(u) = \\frac{1}{2} u^{\\top} M u$。\n- 离散对流算子：$K$。\n- 离散粘性算子：$L$。\n- 运动粘度：$\\nu > 0$。\n- 时间步长：$\\Delta t > 0$。\n- 算子的性质：\n    - 对流：$K^{\\top} M = - M K$。这意味着对流部分的能量是守恒的。\n    - 粘性：$L^{\\top} M = M L$，且 $M^{-1/2} L M^{-1/2}$ 是对称负定的。存在 $\\alpha > 0$ 使得 $M^{-1/2} L M^{-1/2} \\le - \\alpha I$。这意味着粘性耗散。\n- IMEX 格式（对流项用前向欧拉，粘性项用后向欧拉）：\n  $$M u^{n+1} = M u^{n} + \\Delta t \\, K u^{n} + \\nu \\Delta t \\, L u^{n+1}$$\n- 相似变换后的算子：\n    - $S = M^{-1/2} K M^{-1/2}$。\n    - $D = M^{-1/2} L M^{-1/2}$。\n- 变换后算子的性质：\n    - $S$ 是反对称的（$S^{\\top} = -S$）。\n    - $D$ 是对称负定的（$D^{\\top} = D$ 且 $D \\le -\\alpha I$）。\n- $S$ 的谱范数：$\\sigma = \\|S\\|_{2}$。\n- 假设：$\\sigma > \\alpha \\nu$。\n\n**1.2. 对照标准进行验证：**\n- **科学依据：**该问题是对一个应用于对流-扩散型方程的一阶 IMEX 格式的标准稳定性分析，这是计算流体力学数值分析中的一个基本课题。算子性质反映了能量稳定离散化的标准假设。该问题在科学上和数学上都是合理的。\n- **适定的：**该问题提供了明确的目标和足够的信息来推导所要求的稳定性条件。预期可以根据给定参数得到临界时间步长的唯一解。\n- **客观性：**该问题使用精确的数学语言陈述，没有任何主观或模糊的术语。\n- **完整性：**所有必要的定义、方程和约束都已提供。整个设定是自洽且内部一致的。\n\n**1.3. 结论：**\n问题陈述是有效的。\n\n### 步骤 2：稳定性条件的推导\n\n目标是找到关于 $\\Delta t$ 的条件，以保证离散动能不增加，即 $E(u^{n+1}) \\le E(u^{n})$。\n\n首先，我们用一个在能量范数下表示状态的变量来重构问题。令 $v = M^{1/2} u$。那么离散动能为 $E(u) = \\frac{1}{2} u^{\\top} M u = \\frac{1}{2} (M^{1/2} u)^{\\top} (M^{1/2} u) = \\frac{1}{2} v^{\\top} v = \\frac{1}{2} \\|v\\|_{2}^{2}$。条件 $E(u^{n+1}) \\le E(u^{n})$ 等价于 $\\|v^{n+1}\\|_{2}^{2} \\le \\|v^{n}\\|_{2}^{2}$。\n\n我们通过左乘 $M^{-1/2}$ 来变换 IMEX 格式：\n$$M^{1/2} u^{n+1} = M^{1/2} u^{n} + \\Delta t M^{-1/2} K u^{n} + \\nu \\Delta t M^{-1/2} L u^{n+1}$$\n代入 $u = M^{-1/2} v$：\n$$v^{n+1} = v^{n} + \\Delta t (M^{-1/2} K M^{-1/2}) v^{n} + \\nu \\Delta t (M^{-1/2} L M^{-1/2}) v^{n+1}$$\n使用定义 $S = M^{-1/2} K M^{-1/2}$ 和 $D = M^{-1/2} L M^{-1/2}$，格式变为：\n$$v^{n+1} = v^{n} + \\Delta t S v^{n} + \\nu \\Delta t D v^{n+1}$$\n整理以分离 $v^{n+1}$：\n$$(I - \\nu \\Delta t D) v^{n+1} = (I + \\Delta t S) v^{n}$$\n为了分析能量的演化，我们对该方程两边取平方 $2$-范数：\n$$\\|(I - \\nu \\Delta t D) v^{n+1}\\|_{2}^{2} = \\|(I + \\Delta t S) v^{n}\\|_{2}^{2}$$\n\n我们分别分析左手边（LHS）和右手边（RHS）。\n\n**RHS 分析：**\nRHS 为 $\\|(I + \\Delta t S) v^{n}\\|_{2}^{2} = ((I + \\Delta t S) v^{n})^{\\top} (I + \\Delta t S) v^{n} = (v^{n})^{\\top} (I + \\Delta t S)^{\\top} (I + \\Delta t S) v^{n}$。\n鉴于 $S$ 是反对称的（$S^{\\top} = -S$），我们有 $(I + \\Delta t S)^{\\top} = I - \\Delta t S$。\n所以，$(I - \\Delta t S)(I + \\Delta t S) = I + \\Delta t S - \\Delta t S - (\\Delta t)^{2} S^2 = I - (\\Delta t)^{2} S^2$。\nRHS 变为 $(v^{n})^{\\top} (I - (\\Delta t)^{2} S^2) v^{n} = \\|v^{n}\\|_{2}^{2} - (\\Delta t)^{2} (v^{n})^{\\top} S^2 v^{n}$。\n由于 $S$ 是反对称的（$S^{\\top} = -S$），矩阵 $-S^2$ 是对称半正定的（因为对任意向量 $v$，有 $v^{\\top}(-S^2)v = v^{\\top}S^{\\top}Sv = (Sv)^{\\top}(Sv) = \\|Sv\\|_2^2 \\ge 0$）。其最大特征值为 $\\|S\\|_{2}^{2} = \\sigma^2$。\n因此，RHS 可以被上界限定：\n$RHS = \\|v^{n}\\|_{2}^{2} + (\\Delta t)^2 (v^{n})^{\\top}(-S^2)v^{n} \\le \\|v^{n}\\|_{2}^{2} + (\\Delta t)^{2} \\sigma^2 \\|v^{n}\\|_{2}^{2} = (1 + (\\sigma \\Delta t)^2) \\|v^{n}\\|_{2}^{2}$。\n\n**LHS 分析：**\nLHS 为 $\\|(I - \\nu \\Delta t D) v^{n+1}\\|_{2}^{2} = (v^{n+1})^{\\top} (I - \\nu \\Delta t D)^{\\top} (I - \\nu \\Delta t D) v^{n+1}$。\n鉴于 $D$ 是对称的（$D^{\\top} = D$），这可以简化为 $(v^{n+1})^{\\top} (I - \\nu \\Delta t D)^2 v^{n+1}$。\n$(I - \\nu \\Delta t D)^2 = I - 2 \\nu \\Delta t D + (\\nu \\Delta t)^2 D^2$。\nLHS = $\\|v^{n+1}\\|_{2}^{2} - 2 \\nu \\Delta t (v^{n+1})^{\\top} D v^{n+1} + (\\nu \\Delta t)^2 (v^{n+1})^{\\top} D^2 v^{n+1}$。\n我们使用给定的性质 $D \\le -\\alpha I$。这意味着对于任何向量 $v$，有 $v^{\\top} D v \\le -\\alpha \\|v\\|_{2}^{2}$。\n因此，$-2 \\nu \\Delta t (v^{n+1})^{\\top} D v^{n+1} \\ge -2 \\nu \\Delta t (-\\alpha \\|v^{n+1}\\|_{2}^{2}) = 2\\alpha\\nu\\Delta t \\|v^{n+1}\\|_{2}^{2}$。\n对于 $D^2$ 项，由于 $D$ 是对称的且 $D \\le -\\alpha I$，其特征值 $\\lambda_i$ 满足 $\\lambda_i \\le -\\alpha < 0$。$D^2$ 的特征值为 $\\lambda_i^2$，满足 $\\lambda_i^2 \\ge (-\\alpha)^2 = \\alpha^2$。因此，$D^2 \\ge \\alpha^2 I$。\n因此，$(\\nu \\Delta t)^2 (v^{n+1})^{\\top} D^2 v^{n+1} \\ge (\\nu \\Delta t)^2 \\alpha^2 \\|v^{n+1}\\|_{2}^{2} = (\\alpha\\nu\\Delta t)^2 \\|v^{n+1}\\|_{2}^{2}$。\n结合这些结果，我们得到 LHS 的一个下界：\n$$LHS \\ge \\|v^{n+1}\\|_{2}^{2} + 2\\alpha\\nu\\Delta t \\|v^{n+1}\\|_{2}^{2} + (\\alpha\\nu\\Delta t)^2 \\|v^{n+1}\\|_{2}^{2} = (1 + 2\\alpha\\nu\\Delta t + (\\alpha\\nu\\Delta t)^2) \\|v^{n+1}\\|_{2}^{2} = (1 + \\alpha\\nu\\Delta t)^2 \\|v^{n+1}\\|_{2}^{2}$$\n\n**推导稳定性条件：**\n结合等式 $LHS=RHS$ 中 LHS 和 RHS 的界：\n$$(1 + \\alpha\\nu\\Delta t)^2 \\|v^{n+1}\\|_{2}^{2} \\le (1 + (\\sigma \\Delta t)^2) \\|v^{n}\\|_{2}^{2}$$\n这给出了能量放大因子 $G^2 = \\|v^{n+1}\\|_{2}^{2} / \\|v^{n}\\|_{2}^{2}$ 的一个界：\n$$G^2 \\le \\frac{1 + (\\sigma \\Delta t)^2}{(1 + \\alpha\\nu\\Delta t)^2}$$\n为了使能量不增加，我们需要 $\\|v^{n+1}\\|_{2}^{2} \\le \\|v^{n}\\|_{2}^{2}$，这意味着放大因子最大为 $1$。\n$$\\frac{1 + (\\sigma \\Delta t)^2}{(1 + \\alpha\\nu\\Delta t)^2} \\le 1$$\n由于 $(1 + \\alpha\\nu\\Delta t)^2$ 是正数，我们可以用它乘以不等式两边：\n$$1 + (\\sigma \\Delta t)^2 \\le (1 + \\alpha\\nu\\Delta t)^2$$\n$$1 + \\sigma^2 (\\Delta t)^2 \\le 1 + 2\\alpha\\nu\\Delta t + (\\alpha\\nu)^2 (\\Delta t)^2$$\n两边减去 $1$，然后除以 $\\Delta t$（因为 $\\Delta t > 0$）：\n$$\\sigma^2 \\Delta t \\le 2\\alpha\\nu + (\\alpha\\nu)^2 \\Delta t$$\n整理以求解 $\\Delta t$：\n$$\\Delta t (\\sigma^2 - (\\alpha\\nu)^2) \\le 2\\alpha\\nu$$\n$$\\Delta t (\\sigma - \\alpha\\nu)(\\sigma + \\alpha\\nu) \\le 2\\alpha\\nu$$\n问题假设 $\\sigma > \\alpha\\nu > 0$。这意味着 $(\\sigma - \\alpha\\nu)$ 和 $(\\sigma + \\alpha\\nu)$ 都是正数，所以它们的乘积是正数。我们可以用它来除不等式两边而不改变不等号的方向：\n$$\\Delta t \\le \\frac{2\\alpha\\nu}{\\sigma^2 - (\\alpha\\nu)^2}$$\n这是基于所提供信息得到的稳定性的尖锐充分条件。临界时间步长 $\\Delta t_{\\mathrm{crit}}$ 是满足此条件的 $\\Delta t$ 的最大值。\n\n$$\\Delta t_{\\mathrm{crit}} = \\frac{2\\alpha\\nu}{\\sigma^2 - (\\alpha\\nu)^2}$$\n此表达式仅依赖于 $\\alpha$、$\\nu$ 和 $\\sigma$，符合要求。", "answer": "$$\\boxed{\\frac{2\\alpha\\nu}{\\sigma^{2} - (\\alpha\\nu)^{2}}}$$", "id": "3334253"}, {"introduction": "在确保了数值方法的稳定性之后，计算效率和精度控制是实际应用中的下一个关键挑战。真实世界问题的特征时间尺度是动态变化的，因此自适应时间步长策略至关重要。本练习 [@problem_id:3334246] 是一个编码实践，它将指导你如何利用嵌入式误差估计器来构建一个自适应$IMEX$积分器，从而有效地平衡计算成本与求解精度。通过这个实践，你将把稳定性、精度和效率等概念融合到一个高性能的求解器中。", "problem": "给定一个线性、常系数的半离散模型问题，该模型代表了一维周期性对流-扩散方程的方法-线离散化。在长度为 $2\\pi$ 的周期性域上，通过 $N$ 个均匀间隔的网格点进行离散，间距为 $h = 2\\pi/N$。半离散未知量是向量 $y(t) \\in \\mathbb{R}^N$，其根据以下加性系统演化：\n$$\n\\frac{dy}{dt} = E\\,y + I\\,y,\n$$\n其中 $E$ 是离散对流算子，$I$ 是离散扩散算子，两者都是可以对易的循环矩阵。使用中心差分，一阶导数的离散傅里叶符号为 $\\widehat{D}_1(\\theta) = \\mathrm{i}\\,\\sin(\\theta)/h$，二阶导数的离散傅里叶符号为 $\\widehat{D}_2(\\theta) = 2(\\cos(\\theta) - 1)/h^2$。设对流速度 $a > 0$，运动粘度 $\\nu > 0$，则傅里叶符号为：\n$$\n\\widehat{E}(\\theta) = -a\\,\\widehat{D}_1(\\theta) = -a\\,\\mathrm{i}\\,\\frac{\\sin(\\theta)}{h},\\qquad \\widehat{I}(\\theta) = \\nu\\,\\widehat{D}_2(\\theta) = \\nu\\,\\frac{2(\\cos(\\theta)-1)}{h^2}.\n$$\n设初始条件为 $y_j(0) = \\sin(k_0 x_j)$，其中 $x_j = j h$，整数模式 $k_0 \\ge 1$。由于 $E$ 和 $I$ 可对易，并可通过离散傅里叶变换对角化，因此在时间 $t$ 的精确半离散解可逐模式给出：\n$$\n\\widehat{y}(t,\\theta) = \\exp\\!\\big(t(\\widehat{E}(\\theta)+\\widehat{I}(\\theta))\\big)\\,\\widehat{y}(0,\\theta).\n$$\n你的任务是实现一个带有自适应时间步进的隐式-显式 (IMEX) 欧拉积分器，该积分器由显式和隐式部分的嵌入式误差估计器控制，并根据精确的半离散演化对其进行验证。具体而言：\n\n1) 从加性系统 $dy/dt = E\\,y + I\\,y$ 开始，设计 IMEX 欧拉方法的一个步骤，其中显式部分用前向欧拉法处理，隐式部分用后向欧拉法处理。陈述在时间步长 $\\Delta t > 0$ 下，傅里叶空间中的单步更新表达式：\n$$\n\\widehat{y}_{n+1}(\\theta) = \\frac{1 + \\Delta t\\,\\widehat{E}(\\theta)}{1 - \\Delta t\\,\\widehat{I}(\\theta)}\\,\\widehat{y}_n(\\theta).\n$$\n\n2) 使用步长加倍法，分别为每个贡献部分推导嵌入式误差估计器：\n- 对于仅显式流 $dy/dt = E\\,y$，定义全步更新 $\\Phi_E^{\\Delta t}$ 和两次半步更新 $\\Phi_E^{\\Delta t/2}\\circ \\Phi_E^{\\Delta t/2}$，并证明它们应用于 $y_n$ 的差值提供了一个局部误差估计向量\n$$\ne_E = \\Big(\\big(I + \\tfrac{\\Delta t}{2} E\\big)^2 - \\big(I + \\Delta t\\,E\\big)\\Big)\\,y_n + \\mathcal{O}(\\Delta t^3)\n$$\n及其相关的标量估计 $\\eta_E = \\|e_E\\|_{\\mathrm{RMS}}$，其中 $\\|\\cdot\\|_{\\mathrm{RMS}}$ 表示所有网格点上的均方根范数。\n\n- 对于仅隐式流 $dy/dt = I\\,y$，定义全步后向欧拉更新 $\\Psi_I^{\\Delta t}$ 和两次半步更新 $\\Psi_I^{\\Delta t/2}\\circ \\Psi_I^{\\Delta t/2}$，并证明它们应用于 $y_n$ 的差值提供了一个局部误差估计向量\n$$\ne_I = \\Big(\\big(I - \\tfrac{\\Delta t}{2} I\\big)^{-2} - \\big(I - \\Delta t\\,I\\big)^{-1}\\Big)\\,y_n + \\mathcal{O}(\\Delta t^3)\n$$\n及其相关的标量估计 $\\eta_I = \\|e_I\\|_{\\mathrm{RMS}}$。\n\n3) 根据线性和对易性论证，在 $\\Delta t$ 的主阶上，组合的 IMEX 欧拉步骤的局部误差是加性的，并且可以通过组合的标量估计来控制：\n$$\n\\eta = \\eta_E + \\eta_I.\n$$\n\n4) 设计一个自适应时间步长控制器，通过根据以下公式更新时间步长，以达到用户指定的每步容差 $\\tau > 0$：\n$$\n\\Delta t_{\\mathrm{new}} = \\Delta t \\,\\min\\!\\big(f_{\\max},\\,\\max(f_{\\min},\\,s\\,(\\tau/\\eta)^{1/2})\\big),\n$$\n其中安全因子 $s \\in (0,1)$，界限为 $f_{\\min} \\in (0,1)$ 和 $f_{\\max} > 1$，并根据 $\\eta \\le \\tau$ 来决定步长的拒绝/接受。\n\n5) 为提高效率，完全在傅里叶空间中实现该算法，并使用自适应 IMEX 欧拉方案计算在时间 $T$ 的最终数值解。为了验证，通过以下公式计算在时间 $T$ 的精确半离散解：\n$$\n\\widehat{y}_{\\mathrm{exact}}(T,\\theta) = \\exp\\!\\big(T(\\widehat{E}(\\theta)+\\widehat{I}(\\theta))\\big)\\,\\widehat{y}_0(\\theta),\n$$\n然后通过离散傅里叶逆变换获得 $y_{\\mathrm{exact}}(T)$。将每个测试的最终误差报告为差分向量 $y_{\\mathrm{num}}(T) - y_{\\mathrm{exact}}(T)$ 的均方根范数。\n\n程序必须在所有测试中使用以下固定的初始条件和常数：模式 $k_0 = 3$，域长度 $2\\pi$，网格大小 $N$ 由每个测试指定，初始时间步长 $\\Delta t_0 = \\min\\{10^{-2},\\,0.4\\,h/a\\}$，安全因子 $s = 0.9$，$f_{\\min} = 0.2$，$f_{\\max} = 5$。均方根范数定义为：\n$$\n\\|v\\|_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1} v_j^2}.\n$$\n\n在一个完整的 Python 程序中实现你的解决方案，该程序以算法方式执行推导并运行以下测试套件。对于每个测试，参数以元组 $(N,a,\\nu,T,\\tau)$ 的形式给出：\n\n- 测试 A (理想情况，中等刚性): $(128,\\,1.0,\\,10^{-2},\\,0.2,\\,10^{-5})$。\n- 测试 B (更强的扩散): $(128,\\,1.0,\\,2\\times 10^{-1},\\,0.2,\\,10^{-5})$。\n- 测试 C (更宽松的容差): $(128,\\,1.0,\\,10^{-2},\\,0.2,\\,10^{-3})$。\n- 测试 D (更严格的容差): $(128,\\,1.0,\\,10^{-2},\\,0.2,\\,10^{-7})$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，\"[rA,rB,rC,rD]\"），其中每个 $r$ 是相应测试的最终均方根误差，表示为无单位的浮点数。", "solution": "我们从一个由下式控制的半离散模型开始：\n$$\n\\frac{dy}{dt} = E\\,y + I\\,y,\n$$\n其中 $E$ 是代表离散对流算子的循环矩阵，$I$ 是代表离散扩散算子的循环矩阵。在间距为 $h = 2\\pi/N$ 的周期性网格上，$E$ 和 $I$ 都可通过离散傅里叶变换对角化。将傅里叶模式角表示为 $\\theta = 2\\pi m/N$，其中整数 $m \\in \\{0,1,\\dots,N-1\\}$，离散一阶和二阶导数的傅里叶符号为：\n$$\n\\widehat{D}_1(\\theta) = \\mathrm{i}\\,\\frac{\\sin(\\theta)}{h}, \\qquad \\widehat{D}_2(\\theta) = \\frac{2(\\cos(\\theta)-1)}{h^2}.\n$$\n因此，当对流速度 $a>0$ 和运动粘度 $\\nu>0$ 时，我们有：\n$$\n\\widehat{E}(\\theta) = -a\\,\\widehat{D}_1(\\theta) = -a\\,\\mathrm{i}\\,\\frac{\\sin(\\theta)}{h}, \\qquad \\widehat{I}(\\theta) = \\nu\\,\\widehat{D}_2(\\theta) = \\nu\\,\\frac{2(\\cos(\\theta)-1)}{h^2}.\n$$\n由于 $E$ 和 $I$ 可对易（它们可通过离散傅里叶变换同时对角化），精确的半离散解可逐模式地获得：\n$$\n\\widehat{y}(t,\\theta) = \\exp\\!\\big(t(\\widehat{E}(\\theta) + \\widehat{I}(\\theta))\\big)\\,\\widehat{y}(0,\\theta).\n$$\n\n现在我们设计一个隐式-显式 (IMEX) 欧拉积分器。在一个大小为 $\\Delta t$ 的时间步长内，IMEX 欧拉更新定义为将前向欧拉法应用于显式部分，将后向欧拉法应用于隐式部分，代数上可得：\n$$\ny_{n+1} = y_n + \\Delta t\\,E\\,y_n + \\Delta t\\,I\\,y_{n+1}.\n$$\n整理后得到：\n$$\n\\big(I - \\Delta t\\,I\\big)\\,y_{n+1} = \\big(I + \\Delta t\\,E\\big)\\,y_n.\n$$\n在傅里叶空间中，这对于每个模式都变成一个标量乘法：\n$$\n\\widehat{y}_{n+1}(\\theta) = \\frac{1 + \\Delta t\\,\\widehat{E}(\\theta)}{1 - \\Delta t\\,\\widehat{I}(\\theta)}\\,\\widehat{y}_n(\\theta).\n$$\n这对于刚性扩散贡献是无条件稳定的，因为对于扩散，$\\widehat{I}(\\theta) \\le 0$，因此分母 $1 - \\Delta t\\,\\widehat{I}(\\theta) \\ge 1$。\n\n为了为两个部分设计嵌入式误差估计器，我们分别考虑每个子问题的步长加倍法。对于仅显式子问题 $dy/dt = E\\,y$，前向欧拉全步更新为\n$$\n\\Phi_E^{\\Delta t}(y_n) = \\big(I + \\Delta t\\,E\\big)\\,y_n,\n$$\n两次半步更新为\n$$\n\\Phi_E^{\\Delta t/2}\\!\\circ \\Phi_E^{\\Delta t/2}(y_n) = \\big(I + \\tfrac{\\Delta t}{2} E\\big)^2 y_n.\n$$\n它们应用于 $y_n$ 的差值为：\n$$\ne_E = \\Big(\\big(I + \\tfrac{\\Delta t}{2} E\\big)^2 - \\big(I + \\Delta t\\,E\\big)\\Big)\\,y_n.\n$$\n泰勒展开证实了 $e_E = \\mathcal{O}(\\Delta t^2)$ 是一个向量。我们将显式局部误差估计总结为标量均方根范数：\n$$\n\\eta_E = \\|e_E\\|_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1} \\big(e_E\\big)_j^2}.\n$$\n\n对于仅隐式子问题 $dy/dt = I\\,y$，后向欧拉全步更新是以下方程的解：\n$$\n\\big(I - \\Delta t\\,I\\big) y_{n+1} = y_n \\quad \\Rightarrow \\quad \\Psi_I^{\\Delta t}(y_n) = \\big(I - \\Delta t\\,I\\big)^{-1} y_n.\n$$\n两次半步产生：\n$$\n\\Psi_I^{\\Delta t/2}\\!\\circ \\Psi_I^{\\Delta t/2}(y_n) = \\big(I - \\tfrac{\\Delta t}{2} I\\big)^{-2} y_n.\n$$\n因此，仅隐式局部误差估计向量为\n$$\ne_I = \\Big(\\big(I - \\tfrac{\\Delta t}{2} I\\big)^{-2} - \\big(I - \\Delta t\\,I\\big)^{-1}\\Big)\\,y_n,\n$$\n标量估计为\n$$\n\\eta_I = \\|e_I\\|_{\\mathrm{RMS}}.\n$$\n\n由于 $E$ 和 $I$ 是线性的且可对易，组合的 IMEX 欧拉方法的主阶局部误差在来自显式和隐式部分的贡献上是加性的。具体来说，设 $\\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t}$ 表示 IMEX 欧拉单步映射，设 $\\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2}\\circ \\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2}$ 表示其两次半步的复合。由于 $E$ 和 $I$ 可对易且流是线性的，差值\n$$\n\\big(\\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2}\\circ \\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2} - \\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t}\\big)\\,y_n\n$$\n在主阶上展开为仅显式和仅隐式子问题相应差值的和。因此，在主阶上，总局部误差允许使用加性估计：\n$$\n\\eta = \\eta_E + \\eta_I.\n$$\n\n对于自适应控制，我们设定每步容差 $\\tau > 0$，并在 $\\eta \\le \\tau$ 时接受一个步长。遵循一阶方法的标准变步长控制，其中步长加倍误差估计的行为类似 $\\mathcal{O}(\\Delta t^2)$，我们通过以下公式更新时间步长：\n$$\n\\Delta t_{\\mathrm{new}} = \\Delta t \\,\\min\\!\\big(f_{\\max},\\,\\max(f_{\\min},\\,s\\,(\\tau/\\eta)^{1/2})\\big),\n$$\n其中安全因子 $s \\in (0,1)$，界限为 $f_{\\min} \\in (0,1)$ 和 $f_{\\max} > 1$，以限制步长变化。指数 $1/2$ 的出现是因为主导局部误差与 $\\Delta t^2$ 成比例。\n\n算法上，该方法在时间 $t_n$ 状态为 $y_n$ 的每个时间步长按以下步骤进行：\n- 计算傅里叶变换 $\\widehat{y}_n$。\n- 在傅里叶空间中构建 IMEX 全步放大因子，\n$$\n\\widehat{G}_{\\mathrm{IMEX}}(\\theta;\\Delta t) = \\frac{1 + \\Delta t\\,\\widehat{E}(\\theta)}{1 - \\Delta t\\,\\widehat{I}(\\theta)},\n$$\n以及相应的仅显式因子 $\\widehat{G}_E(\\theta;\\Delta t) = 1 + \\Delta t\\,\\widehat{E}(\\theta)$、$\\widehat{G}_E(\\theta;\\Delta t/2)^2$ 和仅隐式因子 $\\widehat{G}_I(\\theta;\\Delta t) = \\big(1 - \\Delta t\\,\\widehat{I}(\\theta)\\big)^{-1}$、$\\widehat{G}_I(\\theta;\\Delta t/2)^2$。\n- 计算候选的下一状态 $\\widehat{y}_{n+1}^{\\mathrm{cand}} = \\widehat{G}_{\\mathrm{IMEX}}(\\theta;\\Delta t)\\,\\widehat{y}_n$。\n- 通过逆变换计算物理空间中的误差向量：\n$$\ne_E = \\mathcal{F}^{-1}\\!\\Big( \\big(\\widehat{G}_E(\\theta;\\tfrac{\\Delta t}{2})^2 - \\widehat{G}_E(\\theta;\\Delta t)\\big)\\,\\widehat{y}_n \\Big), \\quad\ne_I = \\mathcal{F}^{-1}\\!\\Big( \\big(\\widehat{G}_I(\\theta;\\tfrac{\\Delta t}{2})^2 - \\widehat{G}_I(\\theta;\\Delta t)\\big)\\,\\widehat{y}_n \\Big),\n$$\n然后计算 $\\eta_E = \\|e_E\\|_{\\mathrm{RMS}}$，$\\eta_I = \\|e_I\\|_{\\mathrm{RMS}}$，以及 $\\eta = \\eta_E + \\eta_I$。\n- 如果 $\\eta \\le \\tau$，则通过设置 $\\widehat{y}_{n+1} = \\widehat{y}_{n+1}^{\\mathrm{cand}}$ 并推进 $t_{n+1} = t_n + \\Delta t$ 来接受该步；否则，拒绝该步并保持 $y_n$ 不变。\n- 使用带指数 $1/2$、安全因子和界限的控制器更新 $\\Delta t$，并进行裁剪以不超过最终时间。\n\n在最终时间 $T$，计算精确的半离散解\n$$\n\\widehat{y}_{\\mathrm{exact}}(T,\\theta) = \\exp\\!\\big(T(\\widehat{E}(\\theta)+\\widehat{I}(\\theta))\\big)\\,\\widehat{y}_0(\\theta),\n$$\n并变换回物理空间。报告的误差是均方根范数 $\\|y_{\\mathrm{num}}(T) - y_{\\mathrm{exact}}(T)\\|_{\\mathrm{RMS}}$。\n\n此过程应用于测试套件，其参数元组 $(N,a,\\nu,T,\\tau)$ 在问题中指定。最终输出是包含一个 Python 列表的单行，该列表按相同顺序列出了测试的浮点误差。由于算子在傅里叶空间中是对角的且可对易，嵌入式误差估计器 $\\eta = \\eta_E + \\eta_I$ 的分解在主阶上是一致的，自适应控制器驱动局部误差趋向目标容差 $\\tau$，对于小的 $\\tau$，步长缩放行为类似 $\\Delta t \\sim \\sqrt{\\tau}$。", "answer": "```python\nimport numpy as np\n\ndef imex_adaptive_error(N, a, nu, T, tau, k0=3, safety=0.9, fmin=0.2, fmax=5.0):\n    # Grid and wave numbers\n    Lx = 2.0 * np.pi\n    h = Lx / N\n    x = np.arange(N) * h\n\n    # Initial condition y0 = sin(k0 x)\n    y0 = np.sin(k0 * x)\n    yhat0 = np.fft.fft(y0)\n\n    # Fourier mode angles theta\n    m = np.arange(N)\n    theta = 2.0 * np.pi * m / N\n\n    # Fourier symbols for E and I\n    Ehat = -a * 1j * np.sin(theta) / h\n    Ihat = nu * 2.0 * (np.cos(theta) - 1.0) / (h * h)\n\n    # Exact solution factor at time T\n    exact_factor = np.exp(T * (Ehat + Ihat))\n    yhat_exact = exact_factor * yhat0\n    y_exact = np.real(np.fft.ifft(yhat_exact))\n\n    # Adaptive IMEX Euler\n    # Initial timestep: limited by explicit advection stability suggestion and cap\n    if a > 0:\n        dt = min(1e-2, 0.4 * h / a)\n    else:\n        dt = 1e-2\n    t = 0.0\n    yhat = yhat0.copy()\n\n    # Cap on number of steps to avoid infinite loops\n    max_steps = 200000\n    steps = 0\n\n    # Precompute for implicit estimators: denominators will be positive since Ihat <= 0\n    while t < T and steps < max_steps:\n        if dt <= 0.0:\n            break\n        # Clip dt to not overshoot\n        if t + dt > T:\n            dt = T - t\n\n        # Amplification factors\n        # IMEX full-step factor\n        denom = (1.0 - dt * Ihat)\n        # Numerical safeguard: ensure no division by zero (Ihat <= 0 ensures denom >= 1)\n        G_imex = (1.0 + dt * Ehat) / denom\n\n        # Explicit-only factors for error estimator\n        G_E_full = (1.0 + dt * Ehat)\n        G_E_half = (1.0 + 0.5 * dt * Ehat)\n        G_E_twohalf = G_E_half * G_E_half\n\n        # Implicit-only factors for error estimator\n        G_I_full = 1.0 / (1.0 - dt * Ihat)\n        G_I_half = 1.0 / (1.0 - 0.5 * dt * Ihat)\n        G_I_twohalf = G_I_half * G_I_half\n\n        # Candidate next state\n        yhat_cand = G_imex * yhat\n\n        # Error estimator vectors in physical space\n        eE_hat = (G_E_twohalf - G_E_full) * yhat\n        eI_hat = (G_I_twohalf - G_I_full) * yhat\n\n        eE = np.real(np.fft.ifft(eE_hat))\n        eI = np.real(np.fft.ifft(eI_hat))\n\n        # Scalar RMS norms\n        eta_E = np.sqrt(np.mean(eE * eE))\n        eta_I = np.sqrt(np.mean(eI * eI))\n        eta = eta_E + eta_I\n\n        # Step acceptance\n        if eta <= tau or dt <= 1e-16:\n            # Accept\n            yhat = yhat_cand\n            t += dt\n            steps += 1\n\n        # Update timestep using controller with exponent 1/2 (since LTE ~ dt^2)\n        # Avoid division by zero\n        ratio = tau / (eta + 1e-300)\n        factor = safety * (ratio ** 0.5)\n        factor = max(fmin, min(fmax, factor))\n        dt = max(1e-16, dt * factor)\n\n    # Compute final numerical solution\n    y_num = np.real(np.fft.ifft(yhat))\n    # RMS error\n    err = float(np.sqrt(np.mean((y_num - y_exact) ** 2)))\n    return err\n\ndef solve():\n    # Define the test cases: (N, a, nu, T, tau)\n    test_cases = [\n        (128, 1.0, 1e-2, 0.2, 1e-5),   # Test A: happy path\n        (128, 1.0, 2e-1, 0.2, 1e-5),   # Test B: stiffer diffusion\n        (128, 1.0, 1e-2, 0.2, 1e-3),   # Test C: looser tolerance\n        (128, 1.0, 1e-2, 0.2, 1e-7),   # Test D: tighter tolerance\n    ]\n\n    results = []\n    for case in test_cases:\n        N, a, nu, T, tau = case\n        err = imex_adaptive_error(N, a, nu, T, tau)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3334246"}]}