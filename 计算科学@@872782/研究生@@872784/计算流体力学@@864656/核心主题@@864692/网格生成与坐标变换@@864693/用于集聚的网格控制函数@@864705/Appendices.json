{"hands_on_practices": [{"introduction": "本节的第一个实践是基础性的。我们将从第一性原理出发，实现核心的一维等分布算法。通过将连续的等分布原理转化为离散的数值方法，您将深入理解监控函数（monitor function）如何直接控制网格点的聚类[@problem_id:3325995]。这项练习将锻炼您在数值积分和反向插值方面的技能，这些是更高级网格生成技术的基础构件。", "problem": "考虑在闭区间上的一维网格生成问题，其目标是根据等分布原则，在感兴趣的区域放置节点以实现受控的聚类。其基本原理如下。对于有界区间 $[a,b]$ 和一个严格为正的监控函数 $m(x)$，等分布原则规定了一个从计算坐标 $s \\in [0,1]$ 到物理坐标 $x \\in [a,b]$ 的网格映射 $x(s)$，使得由 $m(x)$ 导出的测度在网格单元间均匀分布。在连续形式中，此要求可以表述为单元的密度由 $m(x)$ 控制，并且总监控测度的相等部分被分配给每个单元。在离散形式中，此原则指出每个单元的离散监控加权测度在所有单元上应该相等。\n\n您必须实现一个离散等分布算法，该算法在 $[a,b]$ 上为给定的严格为正的监控函数 $m(x)$ 构建节点位置 $\\{x_i\\}_{i=0}^N$，以使每个单元的监控加权测度的离散近似在所有单元上大致相等。该算法必须基于第一性原理：通过从 $m(x)$ 构建的非负增函数来近似 $[a,b]$ 上的累积监控测度，然后通过在均匀分布的水平上反演这个累积函数来获得节点位置 $\\{x_i\\}_{i=0}^N$。推理必须从等分布的核心定义开始，避免走捷径。\n\n离散等分布必须按如下方式实现：\n- 在 $[a,b]$ 上构建一个精细的参考网格 $\\{x^{\\mathrm{ref}}_j\\}_{j=0}^{J}$，其中 $x^{\\mathrm{ref}}_0=a$ 和 $x^{\\mathrm{ref}}_{J}=b$，并使用在参考网格上对 $m(x)$ 进行的一致性数值积分来近似累积监控测度 $C(x)$。该近似必须产生一个非递减数组 $\\{C_j\\}_{j=0}^{J}$，其中 $C_0=0$ 且 $C_J \\approx \\int_a^b m(\\xi)\\,d\\xi$。\n- 计算目标层级 $\\{T_i\\}_{i=0}^{N}$，其中 $T_i = \\frac{i}{N} C_J$。\n- 通过反演离散累积映射来获得节点位置 $\\{x_i\\}_{i=0}^N$，即通过使用从 $\\{(C_j, x^{\\mathrm{ref}}_j)\\}$ 进行的稳定单调插值来找到 $x_i$，使得 $C(x_i) \\approx T_i$。\n\n构建 $\\{x_i\\}$ 后，用两个定量指标评估等分布和聚类的质量：\n- 网格尺寸比 $R = \\frac{\\max_i \\Delta x_i}{\\min_i \\Delta x_i}$，其中 $\\Delta x_i = x_{i+1}-x_i$，对于 $i=0,\\dots,N-1$。\n- 离散等分布残差，定义为 $E_\\infty = \\max_{i} \\left| \\frac{w_i - W_{\\mathrm{eq}}}{W_{\\mathrm{eq}}} \\right|$，其中 $w_i$ 是单元 $[x_i,x_{i+1}]$ 上监控加权测度的梯形近似，即 $w_i \\approx \\frac{1}{2}\\left(m(x_i)+m(x_{i+1})\\right)\\Delta x_i$，而 $W_{\\mathrm{eq}} = \\frac{1}{N} \\int_a^b m(\\xi)\\,d\\xi$。\n\n使用以下监控函数和参数的测试套件来构建 $4$ 个网格并报告上述指标：\n- 测试用例 $1$ (单位区间上的高斯聚类): $[a,b]=[0,1]$, $N=40$, $m(x) = 1 + A \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right)$，其中 $A=9$, $x_0=0.5$, $\\sigma=0.08$。\n- 测试用例 $2$ (分段常数凸起): $[a,b]=[0,1]$, $N=40$, $m(x) = 1 + A$ 如果 $x \\in [x_1,x_2]$ 且 $m(x)=1$ 否则，其中 $A=4$, $x_1=0.45$, $x_2=0.55$。\n- 测试用例 $3$ (左边界附近的边界层型聚类): $[a,b]=[0,1]$, $N=60$, $m(x) = 1 + \\frac{A}{(x+\\varepsilon)^p}$，其中 $A=0.2$, $\\varepsilon=10^{-3}$, $p=0.5$。\n- 测试用例 $4$ (保证正性的振荡监控函数): $[a,b]=[0,1]$, $N=50$, $m(x) = \\varepsilon + \\sin^2(2\\pi x)$，其中 $\\varepsilon=0.1$。\n\n本问题中所有量均为无量纲，因此不需要物理单位。\n\n您的程序必须为每个测试用例计算上面定义的配对 $[R, E_\\infty]$。最终程序输出必须是单行文本，包含 $4$ 个测试用例的结果，并聚合成一个单一的逗号分隔列表的列表，不含空格，格式为 $[[R_1,E_{\\infty,1}],[R_2,E_{\\infty,2}],[R_3,E_{\\infty,3}],[R_4,E_{\\infty,4}]]$, 其中 $R_k$ 和 $E_{\\infty,k}$ 是测试用例 $k$ 的值。\n\n覆盖性设计：\n- 高斯用例测试平滑聚类。\n- 分段常数凸起用例测试不连续性处理。\n- 边界层用例测试在域端点附近带有可积奇点的强聚类。\n- 振荡监控函数用例测试在基函数可能接近零的区域中的正性保持。\n\n您的解决方案应源自等分布原则和上述核心定义，必须是自包含的，并且必须以确切要求的格式产生输出。", "solution": "生成一维网格以根据指定密度聚集节点的问题是自适应数值方法的一个基石。等分布原则为此任务提供了严格的数学基础。本文提出的解决方案遵循指定的离散算法，该算法是此原则的直接数值实现。\n\n等分布原则指出，对于物理域 $[a,b]$ 上的一个给定的严格为正的监控函数 $m(x)$，最优的节点分布 $\\{x_i\\}_{i=0}^N$ 是监控函数在每个网格单元 $[x_i, x_{i+1}]$ 上的积分为常数的那种分布。在数学上，这表示为：\n$$ \\int_{x_i}^{x_{i+1}} m(\\xi) \\,d\\xi = \\text{常数} \\quad \\text{对于 } i = 0, 1, \\dots, N-1 $$\n该常数值必须是总“监控总量”除以单元数量 $N$。总质量是监控函数在整个域上的积分，即 $\\int_a^b m(\\xi) \\,d\\xi$。因此，对于每个单元，我们有：\n$$ \\int_{x_i}^{x_{i+1}} m(\\xi) \\,d\\xi = \\frac{1}{N} \\int_a^b m(\\xi) \\,d\\xi $$\n为了找到特定节点 $x_i$ 的位置，我们可以对截至该节点的所有单元的贡献求和：\n$$ \\sum_{k=0}^{i-1} \\int_{x_k}^{x_{k+1}} m(\\xi) \\,d\\xi = \\sum_{k=0}^{i-1} \\frac{1}{N} \\int_a^b m(\\xi) \\,d\\xi $$\n$$ \\int_a^{x_i} m(\\xi) \\,d\\xi = \\frac{i}{N} \\int_a^b m(\\xi) \\,d\\xi $$\n这个方程是该方法的核心。我们定义累积监控函数 $C(x)$ 为 $m(\\xi)$ 从域的起点到点 $x$ 的积分：\n$$ C(x) = \\int_a^x m(\\xi) \\,d\\xi $$\n有了这个定义，节点 $x_i$ 的等分布条件变为：\n$$ C(x_i) = \\frac{i}{N} C(b) $$\n由于 $m(x)$ 严格为正，$C(x)$ 是一个严格递增函数，因此拥有唯一的反函数 $C^{-1}$。每个节点 $x_i$ 的位置随后可以通过反演累积函数来找到：\n$$ x_i = C^{-1}\\left(\\frac{i}{N} C(b)\\right) $$\n这个方程表明，物理空间 $[a,b]$ 中的节点 $\\{x_i\\}$ 是“监控加权”或计算空间 $[0, C(b)]$ 中一组均匀间隔点的像。\n\n指定的算法是该反演过程的离散实现。它包括以下步骤：\n\n1.  **累积监控函数的近似**：连续函数 $C(x)$ 通常无法解析得到。我们对其进行数值近似。首先，在区间 $[a,b]$ 上创建一个精细、均匀的参考网格 $\\{x^{\\mathrm{ref}}_j\\}_{j=0}^{J}$，其中 $x^{\\mathrm{ref}}_j = a + j(b-a)/J$。在这些点上评估监控函数 $m(x)$ 以获得 $\\{m_j = m(x^{\\mathrm{ref}}_j)\\}$。然后使用数值积分法则来近似累积积分 $C(x)$。我们使用梯形法则，它产生一个离散累积函数数组 $\\{C_j\\}_{j=0}^{J}$，其中 $C_j \\approx C(x^{\\mathrm{ref}}_j)$。其计算方式为 $C_0=0$ 且对于 $j > 0$：\n    $$ C_j = \\sum_{k=1}^{j} \\frac{1}{2} (m_{k-1} + m_k) (x^{\\mathrm{ref}}_k - x^{\\mathrm{ref}}_{k-1}) $$\n    最终值 $C_J$ 作为总积分 $\\int_a^b m(\\xi)\\,d\\xi$ 的数值近似。由于 $m(x) > 0$，这个离散函数 $\\{C_j\\}$ 保证是非递减的。\n\n2.  **目标层级的计算**：遵循原则 $C(x_i) = \\frac{i}{N} C(b)$，我们在近似累积函数的范围 $[0, C_J]$ 内定义一组 $N+1$ 个均匀间隔的目标层级 $\\{T_i\\}_{i=0}^N$：\n    $$ T_i = \\frac{i}{N} C_J \\quad \\text{对于 } i = 0, 1, \\dots, N $$\n\n3.  **通过插值进行反演**：最后一步是找到与这些目标层级相对应的物理节点位置 $\\{x_i\\}$。这是对我们构建的离散映射的反演，该映射由点对 $\\{(C_j, x^{\\mathrm{ref}}_j)\\}$ 定义。我们寻求 $x_i$ 使得 $C(x_i) \\approx T_i$。这通过稳定的单调插值实现。线性插值是一个合适的选择。对于每个目标层级 $T_i$，我们在数组 $\\{C_j\\}$ 中找到它的位置，并对 $\\{x^{\\mathrm{ref}}_j\\}$ 中的相应值进行线性插值，以找到 $x_i$ 的估计值。此过程有效地近似了反函数 $C^{-1}$。\n\n生成网格 $\\{x_i\\}_{i=0}^N$ 后，使用两个指标评估其质量：\n\n-   **网格尺寸比 ($R$)**：此指标量化网格拉伸或聚类的程度。它定义为最大单元尺寸与最小单元尺寸之比：\n    $$ R = \\frac{\\max_{i} \\Delta x_i}{\\min_{i} \\Delta x_i}, \\quad \\text{其中 } \\Delta x_i = x_{i+1} - x_i $$\n    $R=1$ 的值对应于均匀网格，而大的 $R$ 值表示强聚类。\n\n-   **离散等分布残差 ($E_\\infty$)**：此指标衡量生成的网格满足离散版本等分布原则的程度。它是任何单元中监控加权测度与理想均匀测度的最大相对偏差：\n    $$ E_\\infty = \\max_{i} \\left| \\frac{w_i - W_{\\mathrm{eq}}}{W_{\\mathrm{eq}}} \\right| $$\n    这里，$w_i$ 是 $m(x)$ 在单元 $[x_i, x_{i+1}]$ 上积分的梯形近似：\n    $$ w_i = \\frac{1}{2} (m(x_i) + m(x_{i+1})) \\Delta x_i $$\n    而 $W_{\\mathrm{eq}}$ 是每个单元的理想常数测度，使用数值计算的总监控积分 $C_J$ 定义：\n    $$ W_{\\mathrm{eq}} = \\frac{C_J}{N} $$\n    一个小的 $E_\\infty$ 值表示该算法成功地生成了一个非常接近完美等分布的网格。\n\n提供的 Python 代码实现了该算法，并为四个指定的测试用例计算了这些指标，每个用例都旨在测试算法针对不同类型监控函数（平滑、不连续、奇异和振荡）的鲁棒性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Generates 1D meshes based on the equidistribution principle for a suite of test cases\n    and evaluates them using specified quality metrics.\n    \"\"\"\n\n    def generate_and_evaluate(a, b, N, m_func, J_ref=20000):\n        \"\"\"\n        Core function to generate a mesh and compute metrics for a single test case.\n\n        Args:\n            a (float): Start of the interval.\n            b (float): End of the interval.\n            N (int): Number of mesh cells.\n            m_func (callable): The monitor function m(x).\n            J_ref (int): Number of intervals in the fine reference grid.\n\n        Returns:\n            tuple: A tuple containing the mesh size ratio (R) and the\n                   equidistribution residual (E_inf).\n        \"\"\"\n        # Step 1: Approximate the cumulative monitor function\n        # Create a fine reference grid\n        x_ref = np.linspace(a, b, J_ref + 1)\n        # Evaluate the monitor function on the reference grid\n        m_ref = m_func(x_ref)\n\n        # Compute the discrete cumulative integral using the trapezoidal rule\n        dx_ref = (b - a) / J_ref\n        integrals = 0.5 * (m_ref[:-1] + m_ref[1:]) * dx_ref\n        C_ref = np.concatenate(([0.0], np.cumsum(integrals)))\n        C_total = C_ref[-1]\n\n        # Step 2: Compute target equidistribution levels\n        T_i = np.linspace(0.0, C_total, N + 1)\n\n        # Step 3: Invert the mapping via linear interpolation to find node positions\n        x_nodes = np.interp(T_i, C_ref, x_ref)\n\n        # Ensure boundary nodes are exact\n        x_nodes[0] = a\n        x_nodes[-1] = b\n\n        # --- Metric Calculation ---\n\n        # Calculate cell sizes\n        delta_x = x_nodes[1:] - x_nodes[:-1]\n\n        # Metric 1: Mesh size ratio R\n        min_delta_x = np.min(delta_x)\n        if min_delta_x == 0:\n            # This should not occur with a strictly positive monitor function\n            R = np.inf\n        else:\n            R = np.max(delta_x) / min_delta_x\n\n        # Metric 2: Discrete equidistribution residual E_inf\n        m_at_nodes = m_func(x_nodes)\n        # Calculate the monitor-weighted measure for each cell\n        w_i = 0.5 * (m_at_nodes[:-1] + m_at_nodes[1:]) * delta_x\n        # Calculate the ideal, constant measure per cell\n        W_eq = C_total / N\n        \n        # Calculate the maximum relative deviation\n        if W_eq == 0:\n            E_inf = np.inf\n        else:\n            E_inf = np.max(np.abs(w_i / W_eq - 1.0))\n\n        return R, E_inf\n\n    # Define the test suite of monitor functions and parameters\n    test_cases = [\n        {\n            \"a\": 0.0, \"b\": 1.0, \"N\": 40,\n            \"m_func\": lambda x: 1.0 + 9.0 * np.exp(-((x - 0.5)**2) / (2 * 0.08**2))\n        },\n        {\n            \"a\": 0.0, \"b\": 1.0, \"N\": 40,\n            \"m_func\": lambda x: 1.0 + 4.0 * np.logical_and(x >= 0.45, x <= 0.55)\n        },\n        {\n            \"a\": 0.0, \"b\": 1.0, \"N\": 60,\n            \"m_func\": lambda x: 1.0 + 0.2 / ((x + 1e-3)**0.5)\n        },\n        {\n            \"a\": 0.0, \"b\": 1.0, \"N\": 50,\n            \"m_func\": lambda x: 0.1 + np.sin(2 * np.pi * x)**2\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        R, E_inf = generate_and_evaluate(case[\"a\"], case[\"b\"], case[\"N\"], case[\"m_func\"])\n        results.append(f\"[{R},{E_inf}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3325995"}, {"introduction": "在监控函数概念的基础上，本练习挑战您思考其物理和数值意义。我们将探讨如何根据数值误差指标，特别是高阶多项式重构的残差，来构建监控函数[@problem_id:3325925]。这项实践将提升您将离散误差理论与实用网格自适应策略联系起来的能力，并帮助您在复杂流动中批判性地评估稳健的各向同性聚类与高效但可能脆弱的各向异性自适应之间的权衡。", "problem": "考虑一个二维可压缩流绕过平板，一个斜激波冲击在逆压梯度区附近，产生激波-边界层分离。在一个初始准均匀网格上，使用了一个多项式阶数为$p$的高阶间断伽辽金(DG)求解器。您希望在一个基于度量的移动网格或重新划分网格的框架内，使用一个网格控制（监控）函数，在离散误差较大的区域加密网格点。驱动自适应的两个候选方法是：(i) 一个标量指示场 $u$（例如，流向速度）的Hessian矩阵，记作 $H(u)$，当适当正则化后，通过将单元与 $H(u)$ 的特征结构对齐来产生各向异性度量；以及 (ii) 在局部片区上计算的最小二乘多项式重构残差 $r(\\mathbf{x})$，其通过将一个 $p$ 阶多项式拟合到数值解，并以类似 $L^2$ 的方式测量片区上的拟合误差得到。假设在光滑区域，$r(\\mathbf{x})$ 是 $p$ 阶局部插值误差密度的一致估计量，并且激波是欠解析的。\n\n从基本原理出发，即一个光滑函数由 $p$ 阶多项式插值的误差，其尺度与一个常数乘以 $h^{p+1}$ 再乘以一个合适的 $(p+1)$ 阶导数量级成正比（其中 $h$ 是局部特征网格尺寸），以及寻求每个单元误差近似均匀的等分布原则，推导出当选择标量网格控制函数为 $M(\\mathbf{x}) = r(\\mathbf{x})$ 时，目标单元尺寸 $h(\\mathbf{x})$ 的正确尺度关系。然后，在欠解析的激波-边界层分离区域，比较使用从 $H(u)$ 派生的度量所做的各向异性决策与使用 $M(\\mathbf{x}) = r(\\mathbf{x})$ 作为标量控制函数所隐含的决策。哪个选项既正确描述了基于误差的度量定义，又正确描述了各向异性的比较？\n\nA. 当 $M(\\mathbf{x}) = r(\\mathbf{x})$ 时，对 $p$ 阶插值误差进行等分布处理，得到 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1/(p+1)}$。一个实用的标量度量是 $\\mathbf{M}(\\mathbf{x}) = \\dfrac{1}{h(\\mathbf{x})^2}\\,\\mathbf{I}$，它强制进行各向同性加密。在欠解析的激波-边界层分离中，从 $H(u)$ 构建的度量倾向于产生与壁面相切的强各向异性（并且由于 $H(u)$ 的振荡，在激波附近可能方向错误），而由残差驱动的标量度量则在激波脚和分离泡周围进行各向同性加密，能稳健地定位间断，但不包含方向拉伸的信息。\n\nB. 当 $M(\\mathbf{x}) = r(\\mathbf{x})$ 时，正确的尺度关系是 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{+1/(p+1)}$。基于 $H(u)$ 的度量不受欠解析的影响，并且总是使单元垂直于激波排列；基于残差的控制通过 $\\nabla r(\\mathbf{x})$ 引入各向异性，因此在方向上与 $H(u)$ 等效。\n\nC. 适当的选择是 $M(\\mathbf{x}) = r(\\mathbf{x})^{(p+1)}$，这导致 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1}$。在欠解析的分离中，$H(u)$ 总是使单元垂直于激波定向，而 $r(\\mathbf{x})$ 则将加密主要错误地引导到边界层区域，未能检测到激波脚。\n\nD. 因为 $r(\\mathbf{x})$ 直接近似 $\\|H(u)\\|$，设置 $M(\\mathbf{x}) = r(\\mathbf{x})$ 等效于一个基于Hessian矩阵的度量，因此即使激波和分离是欠解析的，两种策略也会做出相同的各向异性决策。", "solution": "首先将验证问题陈述的科学性和逻辑合理性。\n\n### 步骤 1：提取已知条件\n- **物理系统**：二维($2$D)可压缩流绕过平板。\n- **物理现象**：一个斜激波冲击在逆压梯度区附近，导致激波-边界层分离（SBLI）。\n- **数值方法**：一个使用 $p$ 阶多项式的高阶间断伽辽金(DG)求解器。\n- **初始网格**：准均匀。\n- **自适应目标**：使用基于度量的移动网格或重新划分网格框架，在离散误差大的区域加密网格点。\n- **自适应驱动候选**：\n    1.  一个标量指示场 $u$ （例如流向速度）的Hessian矩阵，记为 $H(u)$。这用于创建各向异性度量。\n    2.  一个在局部片区上计算的最小二乘多项式重构残差 $r(\\mathbf{x})$。\n- **假设与原则**：\n    1.  在光滑区域，残差 $r(\\mathbf{x})$ 是 $p$ 阶局部插值误差密度的一致估计量。\n    2.  在比较的背景下，激波是欠解析的。\n    3.  一个光滑函数由一个 $p$ 阶多项式在特征尺寸为 $h$ 的单元上近似的插值误差 $E_{interp}$，其尺度关系为：$E_{interp} \\propto h^{p+1} |\\nabla^{p+1} u|$，其中 $|\\nabla^{p+1} u|$ 代表 $(p+1)$ 阶导数的量级。\n    4.  自适应策略基于等分布原则，其目标是每个单元的误差均匀。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准评估问题陈述。\n\n-   **科学依据**：该问题牢固地植根于计算流体动力学（CFD）和数值分析。激波-边界层相互作用是一个经典问题。间断伽辽金法、基于度量的网格自适应、基于Hessian矩阵的自适应以及基于残差的误差指示子都是先进CFD中标准且成熟的概念。其前提在事实上和科学上都是合理的。\n-   **适定性**：该问题是适定的。它要求两个具体的输出：一个从给定的第一性原理推导出的尺度律，以及在特定、明确定义的条件下对两种已建立的自适应技术的定性比较。所提供的信息足以得出一个唯一且有意义的结论。\n-   **客观性**：该问题以精确、客观和技术性的语言陈述，没有主观或有偏见的论断。诸如“多项式阶数 $p$”、“Hessian矩阵”和“最小二乘残差”等术语都有明确定义或在该领域是标准术语。\n\n问题陈述没有违反任何无效性标准。它在科学上是合理的、适定的、客观的、完整的，并且与指定的主题相关。\n\n### 步骤 3：结论与行动\n问题陈述是**有效的**。现在开始解答过程。\n\n### 推导与分析\n\n问题要求一个两部分的解答：首先，推导目标单元尺寸 $h(\\mathbf{x})$ 与残差误差指示子 $r(\\mathbf{x})$ 的尺度关系；其次，比较在复杂流动区域中，基于Hessian矩阵的度量和基于残差的度量所产生的网格自适应的性质。\n\n**第 1 部分：单元尺寸的尺度关系**\n\n解答过程遵循两个给定的原则：\n1.  在一个尺寸为 $h$ 的单元上，一个 $p$ 阶多项式近似的局部插值误差 $E_{local}$ 由以下尺度律给出：\n    $$E_{local} \\propto h^{p+1} |\\nabla^{p+1} u|$$\n    其中 $|\\nabla^{p+1} u|$ 是解的 $(p+1)$ 阶导数的量度，假定在光滑区域误差取决于此。\n2.  等分布原则要求在自适应网格的所有单元上局部误差为常数：\n    $$E_{local} \\approx C$$\n    其中 $C$ 是一个常数。\n\n问题指明使用一个标量网格控制函数（或监控函数）$M(\\mathbf{x})$ 来驱动自适应。在此背景下，监控函数是对解的“困难程度”的估计，即误差公式中独立于网格尺寸 $h$ 的项。因此，我们将监控函数设置为与该项成正比：$M(\\mathbfx) \\propto |\\nabla^{p+1} u|$。\n\n问题陈述我们应使用残差 $r(\\mathbf{x})$ 作为此监控函数。“$r(\\mathbf{x})$ 是 $p$ 阶局部插值误差密度的一致估计量”这一陈述意味着 $r(\\mathbf{x})$ 可作为我们计算 $|\\nabla^{p+1} u|$ 的代理。因此，我们设定 $M(\\mathbf{x}) = r(\\mathbf{x})$。\n\n将此代入误差公式，我们得到：\n$$E_{local} \\propto r(\\mathbf{x}) h^{p+1}$$\n\n应用等分布原则：\n$$r(\\mathbf{x}) h(\\mathbf{x})^{p+1} \\approx C$$\n\n求解目标局部单元尺寸 $h(\\mathbf{x})$：\n$$h(\\mathbf{x})^{p+1} \\propto r(\\mathbf{x})^{-1}$$\n$$h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1/(p+1)}$$\n\n此推导建立了目标单元尺寸与基于残差的监控函数之间的正确尺度关系。\n\n接下来，基于度量的网格生成器使用一个度量张量场 $\\mathbf{M}(\\mathbf{x})$ 来定义网格单元的大小、形状和方向。目标是生成一个在由度量定义的几何中所有单元尺寸都为单位一的网格。对于一个目标单元尺寸为 $h(\\mathbf{x})$ 的*各向同性*网格，度量张量定义为：\n$$\\mathbf{M}(\\mathbf{x}) = \\frac{1}{h(\\mathbf{x})^2} \\mathbf{I}$$\n其中 $\\mathbf{I}$ 是单位矩阵。这个度量确保单元在 $h(\\mathbf{x})$ 小的地方加密，但它不指定任何优先的拉伸或方向，因此是各向同性的。\n\n**第 2 部分：各向异性决策的比较**\n\n我们现在比较两种自适应策略在欠解析的SBLI区域中的表现。\n\n-   **基于Hessian矩阵的度量 ($H(u)$)**: 度量由解变量的Hessian矩阵 $H(u)$ 构建。$H(u)$ 的特征向量指示了 $u$ 的最小和最大曲率方向，而特征值指示了该曲率的大小。由此产生的各向异性网格自适应策略旨在将长而薄的单元与最小曲率方向（对应于小量级特征值的特征向量）对齐，并使单元在最大曲率方向（对应于大量级特征值的特征向量）上变短。\n    -   在边界层中，速度梯度在壁面法向很大，在切向很小。$H(u)$ 将正确地定向单元，使其平行于壁面拉伸。\n    -   在激波阵面附近，解的剖面近似于阶跃函数。曲率沿着激波阵面最小，穿过激波阵面最大。$H(u)$ 正确地定向单元，使其在穿过激波时变薄，并沿着激波伸长。\n    -   **问题**：问题指明激波是*欠解析*的。对于高阶DG方法，欠解析的激波会在数值解 $u$ 中导致吉布斯现象（振荡）。计算一个振荡函数的二阶导数（$H(u)$）会产生高度嘈杂且不可靠的结果。特征向量可能指向物理上无意义的方向，导致单元排列错误或形状不佳。这是基于Hessian矩阵的方法在存在欠解析间断时的一个已知且关键的失败点。该方法不稳健。对于SBLI，像流向速度这样的单一变量的Hessian矩阵可能能正确捕捉边界层的各向异性，但在激波处会严重失败，或者被多个相互作用的特征所混淆。\n\n-   **基于残差的标量度量 ($M(\\mathbf{x}) = r(\\mathbf{x})$)**: 残差 $r(\\mathbf{x})$ 是一个误差指示子，它衡量数值解在局部拟合 $p$ 阶多项式的好坏程度。在解不光滑或不像“多项式”的区域，这个值会很大，这些区域稳健地包括了激波、接触间断以及高梯度相互作用区域，如分离泡和再附点。\n    -   由于 $r(\\mathbf{x})$ 是一个标量，将其以 $\\mathbf{M}(\\mathbf{x}) \\propto \\frac{1}{h(\\mathbf{x})^2}\\mathbf{I}$ 的形式用作监控函数，会得到一个*各向同性*的度量。\n    -   **行为**：该度量通过在需要加密的区域（激波脚、分离泡上方的剪切层、边界层）赋予较小的 $h(\\mathbf{x})$ 值，从而正确识别这些区域。这导致了小的、各向同性的（非拉伸的）单元的聚集。\n    -   **优点**：它很稳健。它不依赖于可能振荡的解的导数，并能可靠地“找到”高误差的位置。\n    -   **缺点**：它不提供方向信息。它无法生成高效解析像边界层和激波阵面这样的各向异性特征所需要的被高度拉伸的单元。\n\n### 逐项分析\n\n-   **选项 A**：“当 $M(\\mathbf{x}) = r(\\mathbf{x})$ 时，对 $p$ 阶插值误差进行等分布处理，得到 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1/(p+1)}$。一个实用的标量度量是 $\\mathbf{M}(\\mathbf{x}) = \\dfrac{1}{h(\\mathbf{x})^2}\\,\\mathbf{I}$，它强制进行各向同性加密。在欠解析的激波-边界层分离中，从 $H(u)$ 构建的度量倾向于产生与壁面相切的强各向异性（并且由于 $H(u)$ 的振荡，在激波附近可能方向错误），而由残差驱动的标量度量则在激波脚和分离泡周围进行各向同性加密，能稳健地定位间断，但不包含方向拉伸的信息。”\n    -   尺度律 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1/(p+1)}$ 是根据给定原则正确推导出来的。\n    -   各向同性度量的定义是正确的。\n    -   对基于Hessian矩阵的度量行为的定性描述是准确的，正确指出了其与边界层对齐的趋势及其在欠解析激波附近的不可靠性（方向错误）。\n    -   对基于标量残差的度量行为的描述也是准确的：它进行各向同性加密，稳健地定位间断（激波脚、分离），并且不包含方向拉伸信息。\n    -   **结论：正确。**\n\n-   **选项 B**：“当 $M(\\mathbfx) = r(\\mathbfx)$ 时，正确的尺度关系是 $h(\\mathbfx) \\propto r(\\mathbfx)^{+1/(p+1)}$。基于 $H(u)$ 的度量不受欠解析的影响，并且总是使单元垂直于激波排列；基于残差的控制通过 $\\nabla r(\\mathbfx)$ 引入各向异性，因此在方向上与 $H(u)$ 等效。”\n    -   尺度律的指数符号错误。更大的残差（误差）必须导致更小的单元尺寸。\n    -   声称Hessian度量“不受欠解析的影响”是错误的；它们对此高度敏感。\n    -   声称它们使单元“垂直于激波”排列是错误的；它们使单元与激波阵面相切。\n    -   声称标量控制函数 $M(\\mathbf{x}) = r(\\mathbf{x})$ 引入各向异性与前提相矛盾。\n    -   **结论：不正确。**\n\n-   **选项 C**：“适当的选择是 $M(\\mathbf{x}) = r(\\mathbf{x})^{(p+1)}$，这导致 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1}$。在欠解析的分离中，$H(u)$ 总是使单元垂直于激波定向，而 $r(\\mathbf{x})$ 则将加密主要错误地引导到边界层区域，未能检测到激波脚。”\n    -   尺度律 $h(\\mathbf{x}) \\propto r(\\mathbf{x})^{-1}$ 将意味着误差尺度为 $h$，这对应于 $p=0$，与“高阶”DG方法的前提相矛盾。\n    -   声称 $H(u)$ 使单元“垂直于激波”定向是错误的。\n    -   声称基于残差的指示子会未能检测到激波脚是错误的；这正是其主要优点之一。\n    -   **结论：不正确。**\n\n-   **选项 D**：“因为 $r(\\mathbf{x})$ 直接近似 $\\|H(u)\\|$，设置 $M(\\mathbf{x}) = r(\\mathbf{x})$ 等效于一个基于Hessian矩阵的度量，因此即使激波和分离是欠解析的，两种策略也会做出相同的各向异性决策。”\n    -   $r(\\mathbf{x})$（与 $|\\nabla^{p+1}u|$ 相关）直接近似 $\\|H(u)\\|$（与 $|\\nabla^2 u|$ 相关）的前提通常是错误的，也许除了 $p=1$ 的特定情况，但即使在那时，它们在概念上和计算上也是不同的。\n    -   这两种策略是等效的并做出“相同的各向异性决策”的结论是根本错误的。基于标量 $r(\\mathbf{x})$ 的度量是各向同性的，而基于张量 $H(u)$ 的度量是各向异性的。它们在这方面根本不同。\n    -   **结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "3325925"}, {"introduction": "最后的这项实践将带您进入多维、各向异性网格自适应的领域，这是高效解析尖锐界面或边界层等特征的关键工具。您将构建一个二维度量张量，该张量根据界面的局部曲率来对齐网格单元，强制实现期望的纵横比，以最小化跨特征的数值扩散[@problem_id:3325976]。这项动手计算将使您对精心设计的各向异性网格如何在固定的单元数量下显著提高模拟精度有一个定量的理解。", "problem": "考虑一个计算流体动力学（CFD）中的二维界面平流问题。一个清晰的材料界面被置于一个均匀流场中，该流场的速度大小为 $U$，方向角为 $\\phi$（单位为弧度）。界面上某点的曲率为 $\\kappa$（单位为 $\\text{m}^{-1}$），切线方向角为 $\\theta$（单位为弧度）。局部网格由一个对称正定度量张量 $M$ 控制，该张量旨在施加一个与主曲率方向（即界面的切向和法向）对齐的单元纵横比 $AR$。度量定义为 $M = \\mathbf{R}^\\top \\,\\text{diag}(m_\\parallel,m_\\perp)\\,\\mathbf{R}$，其中 $\\mathbf{R}$ 是将全局基底映射到切向-法向基底的正交旋转矩阵，$m_\\parallel$ 控制切向尺寸，$m_\\perp$ 控制法向尺寸。比例约束为 $m_\\perp / m_\\parallel = \\chi |\\kappa|$，其中 $\\chi$ 是用户指定的聚类敏感度，单位为 $\\text{m}$。\n\n假设网格控制约定为 $m_\\parallel = 1/h_0^2$，其中 $h_0$ 是目标各向同性间距（单位为 $\\text{m}$）。$M$ 所隐含的方向间距为 $h_\\parallel = h_0$ 和 $h_\\perp = h_0 / \\sqrt{m_\\perp / m_\\parallel} = h_0 / \\sqrt{\\chi |\\kappa|}$。通过定义 $AR = h_\\parallel / h_\\perp = \\sqrt{\\chi |\\kappa|}$ 并应用 $AR \\leftarrow \\min(AR_{\\max},\\max(AR,1))$ 来强制一个有界的纵横比，以满足对于给定的 $AR_{\\max}$（无量纲），$AR \\ge 1$ 和 $AR \\le AR_{\\max}$。\n\n被动标量的线性平流输运采用一阶迎风有限体积法进行离散化，时间步长 $\\Delta t$ 为均匀值，其选择使得库朗数 $\\nu = U \\Delta t / h_0$ 在整个网格上保持恒定。一维空间中一阶迎风格式的修正方程分析得出一个人工扩散项，其有效扩散系数为 $D_{\\text{num}} = \\tfrac{1}{2} |a| \\Delta x (1 - \\nu)$，其中 $a$ 是平流速度，$\\Delta x$ 是网格间距。在二维情况下，沿方向 $\\mathbf{\\hat{d}}$ 的扩散为 $D_{\\text{num}}(\\mathbf{\\hat{d}}) = \\tfrac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{d}}| h_{\\mathbf{\\hat{d}}} (1 - \\nu)$，其中 $\\mathbf{u}$ 是速度矢量，$h_{\\mathbf{\\hat{d}}}$ 是沿 $\\mathbf{\\hat{d}}$ 方向的间距。关注于界面的法向 $\\mathbf{\\hat{n}}$，各向同性网格使用 $h_\\perp^{\\text{iso}} = h_0$，而各向异性网格使用 $h_\\perp^{\\text{aniso}} = h_0 / AR$。数值扩散削减因子定义为比率 $R = D_{\\text{num}}^{\\text{iso}}(\\mathbf{\\hat{n}}) / D_{\\text{num}}^{\\text{aniso}}(\\mathbf{\\hat{n}})$。如果 $|\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| = 0$ 或 $\\nu = 1$，则定义 $R = 0$，因为没有数值扩散可以削减。\n\n任务：\n- 从一阶迎风平流的修正方程和度量张量 $M$ 的定义（给定约束 $m_\\perp / m_\\parallel = \\chi |\\kappa|$）出发，推导 $R$ 关于 $AR$、$\\nu$ 和 $\\mathbf{u}$ 的法向分量的表达式。\n- 实现一个程序，该程序：\n  1. 从 $\\theta$ 构建旋转矩阵 $\\mathbf{R}$，其列由切向单位矢量 $\\mathbf{\\hat{t}} = [\\cos\\theta, \\sin\\theta]^\\top$ 和法向单位矢量 $\\mathbf{\\hat{n}} = [-\\sin\\theta, \\cos\\theta]^\\top$ 给出。\n  2. 在应用纵横比边界后，从 $\\mathbf{R}$、$m_\\parallel = 1/h_0^2$ 和 $m_\\perp = m_\\parallel \\, AR^2$ 构建 $M$。\n  3. 使用法向分量 $u_n = \\mathbf{u}\\cdot\\mathbf{\\hat{n}}$、库朗数 $\\nu$ 和方向间距计算 $R$。\n- 使用以下参数集测试套件，每个集合按 $(U, h_0, \\nu, \\kappa, \\chi, \\theta, \\phi, AR_{\\max})$ 顺序排列，并以指定单位表示：$U$ 单位为 $\\text{m/s}$，$h_0$ 单位为 $\\text{m}$，$\\nu$ 无量纲，$\\kappa$ 单位为 $\\text{m}^{-1}$，$\\chi$ 单位为 $\\text{m}$，$\\theta$ 和 $\\phi$ 单位为弧度，$AR_{\\max}$ 无量纲。\n  1. $(U = 1.0, h_0 = 0.01, \\nu = 0.5, \\kappa = 5.0, \\chi = 0.5, \\theta = 0.5235987756, \\phi = 1.0471975512, AR_{\\max} = 6.0)$\n  2. $(U = 1.0, h_0 = 0.01, \\nu = 0.5, \\kappa = 5.0, \\chi = 0.5, \\theta = 0.5235987756, \\phi = 0.5235987756, AR_{\\max} = 6.0)$\n  3. $(U = 2.0, h_0 = 0.02, \\nu = 0.7, \\kappa = 100.0, \\chi = 0.5, \\theta = 1.2, \\phi = 0.7, AR_{\\max} = 5.0)$\n  4. $(U = 1.5, h_0 = 0.015, \\nu = 0.6, \\kappa = 0.0, \\chi = 0.5, \\theta = 0.7853981634, \\phi = 0.0, AR_{\\max} = 10.0)$\n  5. $(U = 1.0, h_0 = 0.01, \\nu = 1.0, \\kappa = 10.0, \\chi = 0.3, \\theta = 0.2, \\phi = 1.0, AR_{\\max} = 8.0)$\n\n您的程序应生成单行输出，其中包含五个测试用例的数值扩散削减因子 $R$，格式为逗号分隔的浮点数列表，小数点后保留六位，并用方括号括起来（例如 $[r_1,r_2,r_3,r_4,r_5]$）。角度必须解释为弧度，所有物理量必须按其指定单位处理。输出 $R$ 是无量纲的。", "solution": "该问题要求在计算流体动力学中的一个界面平流问题中，推导并计算数值扩散削减因子 $R$。求解过程分两个阶段：首先，对 $R$ 的表达式进行解析推导；其次，实现一个计算程序，以评估给定测试参数集的 $R$ 值。\n\n**问题验证**\n\n所提供的问题陈述已经过严格验证，并被确定为有效。\n\n1.  **提取已知条件**：所有数据、变量和约束，包括速度大小 $U$、方向 $\\phi$、界面曲率 $\\kappa$、切线角 $\\theta$、网格参数 $h_0$、$\\chi$、$AR_{\\max}$、库朗数 $\\nu$，以及度量张量 $M$、纵横比 $AR$ 和数值扩散 $D_{\\text{num}}$ 的定义，均已按陈述提取。\n2.  **验证评估**：\n    -   **科学依据**：该问题在流体动力学的数值分析原理方面有坚实的基础，特别涉及网格生成（基于度量的各向异性网格划分）和离散误差分析（一阶迎风格式的修正方程）。所有概念均为该领域的标准内容。\n    -   **适定性**：该问题是适定的。它提供了足够的信息和一个清晰、明确的目标，可以为每个参数集计算出唯一的 $R$ 值。\n    -   **客观性**：语言正式、精确且客观。\n    -   **一致性**：定义在内部是一致的。例如，关系式 $m_{\\perp} = m_{\\parallel} AR^2$ 与方向间距 $h_{\\parallel} = h_0$ 和 $h_{\\perp} = h_0/AR$ 的定义是一致的，因为度量分量与网格间距的平方成反比。在局部扩散公式中使用全局库朗数 $\\nu$ 是问题明确指定的建模选择，不构成缺陷。\n\n该问题被视为有效，完整的解答如下。\n\n**削减因子 $R$ 的推导**\n\n数值扩散削减因子 $R$ 定义为各向同性参考网格在界面法向上的数值扩散系数与度量对齐的各向异性网格的相应系数之比。\n$$\nR = \\frac{D_{\\text{num}}^{\\text{iso}}(\\mathbf{\\hat{n}})}{D_{\\text{num}}^{\\text{aniso}}(\\mathbf{\\hat{n}})}\n$$\n问题指定了沿任意方向 $\\mathbf{\\hat{d}}$ 的数值扩散系数公式为：\n$$\nD_{\\text{num}}(\\mathbf{\\hat{d}}) = \\frac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{d}}| h_{\\mathbf{\\hat{d}}} (1 - \\nu)\n$$\n其中 $\\mathbf{u}$ 是流体速度矢量，$h_{\\mathbf{\\hat{d}}}$ 是在 $\\mathbf{\\hat{d}}$ 方向上的局部网格间距，$\\nu$ 是参考库朗数。\n\n对于各向同性情况，网格间距是均匀的，$h_{\\mathbf{\\hat{d}}} = h_0$ 对所有方向均成立。因此，垂直于界面的间距为 $h_\\perp^{\\text{iso}} = h_0$。相应的数值扩散系数是：\n$$\nD_{\\text{num}}^{\\text{iso}}(\\mathbf{\\hat{n}}) = \\frac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| h_0 (1 - \\nu)\n$$\n对于各向异性情况，网格在法线方向上被细化。间距由 $h_\\perp^{\\text{aniso}} = h_0 / AR$ 给出，其中 $AR$ 是有界纵横比。这种情况下的数值扩散系数是：\n$$\nD_{\\text{num}}^{\\text{aniso}}(\\mathbf{\\hat{n}}) = \\frac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| \\left(\\frac{h_0}{AR}\\right) (1 - \\nu)\n$$\n将这些表达式代入 $R$ 的定义中，得到：\n$$\nR = \\frac{\\frac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| h_0 (1 - \\nu)}{\\frac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| \\frac{h_0}{AR} (1 - \\nu)}\n$$\n项 $\\frac{1}{2} |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| (1 - \\nu)$ 代表了数值扩散效应的大小。如果此项非零，可以从分子和分母中消去，从而显著简化表达式：\n$$\nR = \\frac{h_0}{h_0 / AR} = AR\n$$\n问题通过声明“如果 $|\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| = 0$ 或 $\\nu = 1$，则定义 $R = 0$”来明确处理这个公因子为零的情况。这在物理上是合理的，因为这些条件意味着一阶迎风格式的数值扩散为零，因此没有扩散可以削减。\n\n因此，$R$ 的完整表达式为：\n$$\nR =\n\\begin{cases}\nAR  \\text{if } |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| \\neq 0 \\text{ and } \\nu \\neq 1 \\\\\n0  \\text{if } |\\mathbf{u}\\cdot \\mathbf{\\hat{n}}| = 0 \\text{ or } \\nu = 1\n\\end{cases}\n$$\n其中 $AR$ 是有界纵横比。\n\n**计算算法**\n\n计算每个测试用例 $(U, h_0, \\nu, \\kappa, \\chi, \\theta, \\phi, AR_{\\max})$ 的 $R$ 值的算法如下：\n\n1.  根据界面曲率 $\\kappa$ 和聚类敏感度 $\\chi$ 计算原始纵横比 $AR_{\\text{raw}}$：\n    $$AR_{\\text{raw}} = \\sqrt{\\chi |\\kappa|}$$\n2.  应用指定的边界 $AR \\ge 1$ 和 $AR \\le AR_{\\max}$ 来找到有效纵横比 $AR$：\n    $$AR = \\min(AR_{\\max}, \\max(AR_{\\text{raw}}, 1.0))$$\n3.  评估特殊情况 $R=0$ 的条件。\n    a. 检查库朗数是否 $\\nu = 1.0$。\n    b. 计算速度的法向分量 $u_n = \\mathbf{u}\\cdot \\mathbf{\\hat{n}}$。速度矢量为 $\\mathbf{u} = [U \\cos\\phi, U \\sin\\phi]^\\top$，界面法向矢量为 $\\mathbf{\\hat{n}} = [-\\sin\\theta, \\cos\\theta]^\\top$。它们的点积是：\n    $$u_n = U(-\\cos\\phi \\sin\\theta + \\sin\\phi \\cos\\theta) = U \\sin(\\phi - \\theta)$$\n    检查 $|u_n|$ 是否在数值上为零。\n4.  如果 $\\nu = 1.0$ 或 $|u_n| \\approx 0$，则削减因子 $R = 0.0$。\n5.  否则，削减因子等于有界纵横比：$R = AR$。\n\n该过程针对所提供的五个测试用例中的每一个都进行了实现。虽然问题描述了完整度量张量 $M$ 的构建，但推导出的 $R$ 表达式表明，最终计算仅需要得到的纵横比 $AR$ 和相对于界面法向的流运动学。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the CFD numerical diffusion reduction factor problem for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (U, h0, nu, kappa, chi, theta, phi, AR_max)\n    test_cases = [\n        (1.0, 0.01, 0.5, 5.0, 0.5, 0.5235987756, 1.0471975512, 6.0),\n        (1.0, 0.01, 0.5, 5.0, 0.5, 0.5235987756, 0.5235987756, 6.0),\n        (2.0, 0.02, 0.7, 100.0, 0.5, 1.2, 0.7, 5.0),\n        (1.5, 0.015, 0.6, 0.0, 0.5, 0.7853981634, 0.0, 10.0),\n        (1.0, 0.01, 1.0, 10.0, 0.3, 0.2, 1.0, 8.0)\n    ]\n\n    results = []\n    # A small tolerance for floating point comparisons to zero.\n    TOLERANCE = 1e-9\n\n    for case in test_cases:\n        U, h0, nu, kappa, chi, theta, phi, AR_max = case\n\n        # Step 1: Calculate the raw aspect ratio.\n        # AR_raw = sqrt(chi * |kappa|)\n        ar_raw = np.sqrt(chi * np.abs(kappa))\n\n        # Step 2: Apply the bounds to obtain the effective aspect ratio AR.\n        # AR = min(AR_max, max(AR_raw, 1.0))\n        ar_bounded = np.min([AR_max, np.max([ar_raw, 1.0])])\n\n        # Step 3: Evaluate the conditions for setting R=0.\n        \n        # Condition a: Check if Courant number nu is 1.\n        is_nu_one = np.isclose(nu, 1.0, atol=TOLERANCE)\n\n        # Condition b: Check if the normal component of velocity is zero.\n        # u_n = U * sin(phi - theta)\n        u_n = U * np.sin(phi - theta)\n        is_un_zero = np.isclose(u_n, 0.0, atol=TOLERANCE)\n\n        # Step 4  5: Calculate the reduction factor R.\n        # If nu=1 or |u_n|=0, then R=0. Otherwise, R=AR.\n        if is_nu_one or is_un_zero:\n            R = 0.0\n        else:\n            R = ar_bounded\n        \n        results.append(R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3325976"}]}