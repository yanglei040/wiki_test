{"hands_on_practices": [{"introduction": "在计算空间中求解控制方程的第一步，是精确地在离散层面表示弯曲的控制体几何。本练习将从基本原理出发，计算单个四边形单元的离散面矢量。我们的目标是验证一个关键的“度量恒等式”（metric identity），即封闭控制体的面矢量之和为零，并理解为何这是确保数值格式能够精确保持均匀流场（即自由流守恒）的根本原因。", "problem": "考虑一个二维曲线控制体，它由一个从计算方形区域 $[0,1] \\times [0,1]$ 到物理空间中一个凸四边形的双线性映射得到。该映射 $\\mathbf{x}(\\xi,\\eta) = \\left(x(\\xi,\\eta), y(\\xi,\\eta)\\right)$ 由四个角点的双线性插值定义\n$$\n\\mathbf{x}_{1} = (0,0),\\quad \\mathbf{x}_{2} = (2, \\tfrac{1}{2}),\\quad \\mathbf{x}_{3} = \\left(\\tfrac{11}{5}, \\tfrac{9}{5}\\right),\\quad \\mathbf{x}_{4} = \\left(-\\tfrac{2}{5}, \\tfrac{7}{5}\\right),\n$$\n它们分别对应于 $(\\xi,\\eta) = (0,0)$、$(\\xi,\\eta) = (1,0)$、$(\\xi,\\eta) = (1,1)$ 和 $(\\xi,\\eta) = (0,1)$。所有量均为无量纲。\n\n仅从守恒的积分形式和基本几何关系出发，完成以下任务：\n\n1) 写出 $i \\in \\{1,2,3,4\\}$ 的双线性形函数 $N_{i}(\\xi,\\eta)$ 以及相应的映射 $\\mathbf{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,\\mathbf{x}_{i}$。\n\n2) 使用二维面面积矢量 $\\mathbf{S}_{f}$ 的定义，即沿每个面的外法向单位矢量与微分弧长的乘积的积分，从基本原理推导 $\\mathbf{S}_{f}$ 关于每个直面端点的表达式。明确计算南、东、北、西四个面的面面积矢量，分别记为 $\\mathbf{S}_{s}$、$\\mathbf{S}_{e}$、$\\mathbf{S}_{n}$ 和 $\\mathbf{S}_{w}$，其中控制体边界从 $\\mathbf{x}_{1}$ 开始，沿逆时针方向经过 $\\mathbf{x}_{2}$、$\\mathbf{x}_{3}$、$\\mathbf{x}_{4}$，再回到 $\\mathbf{x}_{1}$。\n\n3) 对于一个恒定矢量场 $\\mathbf{a} = (3,-1)^{\\top}$，构建有限体积离散散度\n$$\n\\left(\\nabla \\cdot \\mathbf{a}\\right)_{\\text{disc}} \\equiv \\frac{1}{A} \\sum_{f \\in \\{s,e,n,w\\}} \\mathbf{a} \\cdot \\mathbf{S}_{f},\n$$\n其中 $A$ 是映射后四边形的物理面积。将此离散散度计算为一个实数。\n\n4) 根据您的计算，判断此双线性单元是否满足度量恒等式，并从几何相容性和自由流保持性的角度简要说明您的结论。\n\n将最终的离散散度表示为一个实数。不需要四舍五入，最终答案中不应包含单位。", "solution": "按照题目要求，解答分为四个部分。\n\n1) 双线性形函数与映射\n\n对于由 $(\\xi, \\eta) \\in [0,1] \\times [0,1]$ 定义的单位正方形计算域，双线性形函数 $N_i(\\xi, \\eta)$ 的定义为在角点 $i$ 处 $N_i$ 等于 $1$，在所有其他角点处等于 $0$。它们由以下公式给出：\n- $N_1(\\xi, \\eta) = (1-\\xi)(1-\\eta)$，对应角点 $1$ 位于 $(\\xi, \\eta) = (0,0)$。\n- $N_2(\\xi, \\eta) = \\xi(1-\\eta)$，对应角点 $2$ 位于 $(\\xi, \\eta) = (1,0)$。\n- $N_3(\\xi, \\eta) = \\xi\\eta$，对应角点 $3$ 位于 $(\\xi, \\eta) = (1,1)$。\n- $N_4(\\xi, \\eta) = (1-\\xi)\\eta$，对应角点 $4$ 位于 $(\\xi, \\eta) = (0,1)$。\n\n从计算空间 $(\\xi, \\eta)$ 到物理空间 $\\mathbf{x} = (x,y)$ 的映射是四个角点 $\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4$ 的双线性插值：\n$$\n\\mathbf{x}(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) \\mathbf{x}_i\n$$\n代入形函数，得到：\n$$\n\\mathbf{x}(\\xi, \\eta) = (1-\\xi)(1-\\eta)\\mathbf{x}_1 + \\xi(1-\\eta)\\mathbf{x}_2 + \\xi\\eta\\mathbf{x}_3 + (1-\\xi)\\eta\\mathbf{x}_4\n$$\n其中给定的角点坐标为 $\\mathbf{x}_{1} = (0,0)$、$\\mathbf{x}_{2} = (2, \\frac{1}{2})$、$\\mathbf{x}_{3} = (\\frac{11}{5}, \\frac{9}{5})$ 和 $\\mathbf{x}_{4} = (-\\frac{2}{5}, \\frac{7}{5})$。\n\n2) 面面积矢量\n\n二维面 $f$ 的面面积矢量 $\\mathbf{S}_f$ 定义为外法向单位矢量 $\\mathbf{n}$ 沿该面弧长 $s$ 的积分：\n$$\n\\mathbf{S}_f = \\int_{f} \\mathbf{n} \\, ds\n$$\n题目指定了一个四边形，其面是直线段。考虑一个从点 $\\mathbf{x}_A = (x_A, y_A)$ 到点 $\\mathbf{x}_B = (x_B, y_B)$ 的单硗直面。沿该面的位移矢量为 $\\Delta\\mathbf{x} = \\mathbf{x}_B - \\mathbf{x}_A = (\\Delta x, \\Delta y)$，其中 $\\Delta x = x_B - x_A$ 且 $\\Delta y = y_B - y_A$。面的长度为 $L = |\\Delta\\mathbf{x}| = \\sqrt{(\\Delta x)^2 + (\\Delta y)^2}$。\n\n沿面从 $A$ 到 $B$ 的单位切向矢量为 $\\mathbf{t} = \\frac{\\Delta\\mathbf{x}}{L} = (\\frac{\\Delta x}{L}, \\frac{\\Delta y}{L})$。对于控制体边界的逆时针遍历，外法向矢量 $\\mathbf{n}$ 可通过将切向矢量 $\\mathbf{t}$ 旋转 $-90$ 度得到。此旋转将矢量 $(v_x, v_y)$ 变换为 $(v_y, -v_x)$。因此，外法向单位矢量为：\n$$\n\\mathbf{n} = \\left(\\frac{\\Delta y}{L}, -\\frac{\\Delta x}{L}\\right)\n$$\n由于面是直线，法向矢量 $\\mathbf{n}$ 沿其是恒定的。积分简化为：\n$$\n\\mathbf{S}_f = \\mathbf{n} \\int_{f} ds = \\mathbf{n} L = \\left(\\frac{\\Delta y}{L}, -\\frac{\\Delta x}{L}\\right) L = (\\Delta y, -\\Delta x)\n$$\n因此，对于一个从 $\\mathbf{x}_A$ 到 $\\mathbf{x}_B$ 的面，$\\mathbf{S}_f = (y_B - y_A, x_A - x_B)$。\n\n我们现在按逆时针顺序计算四边形四个面的面积矢量：\n- **南面 (s)**：从 $\\mathbf{x}_1 = (0,0)$ 到 $\\mathbf{x}_2 = (2, \\frac{1}{2})$。\n$\\Delta x = 2 - 0 = 2$, $\\Delta y = \\frac{1}{2} - 0 = \\frac{1}{2}$。\n$\\mathbf{S}_s = (\\Delta y, -\\Delta x) = (\\frac{1}{2}, -2)$。\n\n- **东面 (e)**：从 $\\mathbf{x}_2 = (2, \\frac{1}{2})$ 到 $\\mathbf{x}_3 = (\\frac{11}{5}, \\frac{9}{5})$。\n$\\Delta x = \\frac{11}{5} - 2 = \\frac{11-10}{5} = \\frac{1}{5}$, $\\Delta y = \\frac{9}{5} - \\frac{1}{2} = \\frac{18-5}{10} = \\frac{13}{10}$。\n$\\mathbf{S}_e = (\\Delta y, -\\Delta x) = (\\frac{13}{10}, -\\frac{1}{5})$。\n\n- **北面 (n)**：从 $\\mathbf{x}_3 = (\\frac{11}{5}, \\frac{9}{5})$ 到 $\\mathbf{x}_4 = (-\\frac{2}{5}, \\frac{7}{5})$。\n$\\Delta x = -\\frac{2}{5} - \\frac{11}{5} = -\\frac{13}{5}$, $\\Delta y = \\frac{7}{5} - \\frac{9}{5} = -\\frac{2}{5}$。\n$\\mathbf{S}_n = (\\Delta y, -\\Delta x) = (-\\frac{2}{5}, -(-\\frac{13}{5})) = (-\\frac{2}{5}, \\frac{13}{5})$。\n\n- **西面 (w)**：从 $\\mathbf{x}_4 = (-\\frac{2}{5}, \\frac{7}{5})$ 到 $\\mathbf{x}_1 = (0,0)$。\n$\\Delta x = 0 - (-\\frac{2}{5}) = \\frac{2}{5}$, $\\Delta y = 0 - \\frac{7}{5} = -\\frac{7}{5}$。\n$\\mathbf{S}_w = (\\Delta y, -\\Delta x) = (-\\frac{7}{5}, -\\frac{2}{5})$。\n\n3) 离散散度计算\n\n对于恒定矢量场 $\\mathbf{a}$，其离散散度由以下公式给出：\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} \\sum_{f \\in \\{s,e,n,w\\}} \\mathbf{a} \\cdot \\mathbf{S}_{f}\n$$\n其中 $A$ 是四边形的面积。给定的恒定矢量场为 $\\mathbf{a} = (3, -1)^{\\top}$。我们计算点积之和：\n- $\\mathbf{a} \\cdot \\mathbf{S}_s = (3, -1) \\cdot (\\frac{1}{2}, -2) = 3(\\frac{1}{2}) + (-1)(-2) = \\frac{3}{2} + 2 = \\frac{7}{2}$。\n- $\\mathbf{a} \\cdot \\mathbf{S}_e = (3, -1) \\cdot (\\frac{13}{10}, -\\frac{1}{5}) = 3(\\frac{13}{10}) + (-1)(-\\frac{1}{5}) = \\frac{39}{10} + \\frac{1}{5} = \\frac{39}{10} + \\frac{2}{10} = \\frac{41}{10}$。\n- $\\mathbf{a} \\cdot \\mathbf{S}_n = (3, -1) \\cdot (-\\frac{2}{5}, \\frac{13}{5}) = 3(-\\frac{2}{5}) + (-1)(\\frac{13}{5}) = -\\frac{6}{5} - \\frac{13}{5} = -\\frac{19}{5}$。\n- $\\mathbf{a} \\cdot \\mathbf{S}_w = (3, -1) \\cdot (-\\frac{7}{5}, -\\frac{2}{5}) = 3(-\\frac{7}{5}) + (-1)(-\\frac{2}{5}) = -\\frac{21}{5} + \\frac{2}{5} = -\\frac{19}{5}$。\n\n总和为：\n$$\n\\sum_{f} \\mathbf{a} \\cdot \\mathbf{S}_{f} = \\frac{7}{2} + \\frac{41}{10} - \\frac{19}{5} - \\frac{19}{5} = \\frac{35}{10} + \\frac{41}{10} - \\frac{38}{10} - \\frac{38}{10} = \\frac{76 - 76}{10} = 0\n$$\n由于总和为 $0$，离散散度为：\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} (0) = 0\n$$\n面积 $A$ 的值对于确定最终结果不是必需的。离散散度恰好为 $0$。\n\n4) 度量恒等式与论证\n\n对于一个闭合控制体，度量恒等式要求所有面面积矢量的和为零矢量：\n$$\n\\sum_{f} \\mathbf{S}_{f} = \\mathbf{0}\n$$\n让我们用第 2 部分计算出的矢量来验证这个条件。\nx分量之和：\n$$\n\\sum_{f} S_{f,x} = \\frac{1}{2} + \\frac{13}{10} - \\frac{2}{5} - \\frac{7}{5} = \\frac{5}{10} + \\frac{13}{10} - \\frac{4}{10} - \\frac{14}{10} = \\frac{5 + 13 - 4 - 14}{10} = \\frac{18 - 18}{10} = 0\n$$\ny分量之和：\n$$\n\\sum_{f} S_{f,y} = -2 - \\frac{1}{5} + \\frac{13}{5} - \\frac{2}{5} = -\\frac{10}{5} - \\frac{1}{5} + \\frac{13}{5} - \\frac{2}{5} = \\frac{-10 - 1 + 13 - 2}{5} = \\frac{-13 + 13}{5} = 0\n$$\n由于和的两个分量都为零，我们有 $\\sum_{f} \\mathbf{S}_{f} = (0,0) = \\mathbf{0}$。此双线性单元满足度量恒等式。\n\n论证：度量恒等式的满足是由于各个面形成一个闭合回路的直接结果。它是几何恒等式 $\\oint_{\\partial V} \\mathbf{n} \\, dS = \\mathbf{0}$ 的离散模拟。此性质确保了几何相容性，并且对于实现**自由流保持性**至关重要。对于任何恒定矢量场 $\\mathbf{a}$，其连续散度为 $\\nabla \\cdot \\mathbf{a} = 0$。如果一个数值格式的离散散度算子对任何恒定场也产生零，则该格式保持自由流。对于给定的有限体积离散化，我们可以写出：\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} \\sum_{f} \\mathbf{a} \\cdot \\mathbf{S}_{f} = \\frac{1}{A} \\left( \\mathbf{a} \\cdot \\sum_{f} \\mathbf{S}_{f} \\right)\n$$\n由于度量恒等式 $\\sum_{f} \\mathbf{S}_{f} = \\mathbf{0}$ 成立，因此对于*任何*恒定矢量 $\\mathbf{a}$，都有 $(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} (\\mathbf{a} \\cdot \\mathbf{0}) = 0$。第 3 部分中针对特定矢量 $\\mathbf{a} = (3,-1)^{\\top}$ 计算出的结果 $0$ 证实了这一普遍原理。此性质之所以成立，是因为控制体由连接顶点的直线段定义，形成一个闭合多边形。\n\n最终答案要求的是离散散度的数值。如第 3 部分所计算，该值为 $0$。", "answer": "$$\n\\boxed{0}\n$$", "id": "3324582"}, {"introduction": "在掌握了网格变换的基本概念后，本练习将探讨其一个至关重要的实际影响：对数值稳定性的影响。我们将一个平流方程转换到计算空间，分析网格拉伸如何导致非均匀的“计算速度”。您的任务是推导在此变换下的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，并计算允许的最大时间步长 $ \\Delta t $，从而揭示物理空间中最密的网格区域是如何对稳定性施加最严格限制的。", "problem": "在计算流体动力学 (CFD) 中，考虑一个被动标量场的三维平流，其在物理空间中由守恒定律 $ \\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0 $ 控制，其中 $ q(\\boldsymbol{x}, t) $ 是标量， $ \\boldsymbol{U} = (u, v, w) $ 是一个给定的速度场。物理域 $ [0, L_x] \\times [0, L_y] \\times [0, L_z] $ 是从计算域 $ [0, 1]^3 $ 通过一对一可微映射 $ x(\\xi) = L_x \\frac{\\exp(\\alpha_x \\xi) - 1}{\\exp(\\alpha_x) - 1} $、$ y(\\eta) = L_y \\frac{\\exp(\\alpha_y \\eta) - 1}{\\exp(\\alpha_y) - 1} $ 和 $ z(\\zeta) = L_z \\zeta $ 映射而来的，其中 $ \\xi, \\eta, \\zeta \\in [0, 1] $。计算网格是结构化的均匀网格，间距为 $ \\Delta \\xi = \\frac{1}{N_{\\xi}} $、$ \\Delta \\eta = \\frac{1}{N_{\\eta}} $ 和 $ \\Delta \\zeta = \\frac{1}{N_{\\zeta}} $。流动状态是恒定的，速度为 $ \\boldsymbol{U} = (U_0, V_0, W_0) $。数值方法是显式向前欧拉时间积分器，结合计算空间中映射平流方程的一阶迎风离散化。从控制守恒定律和映射出发，基于计算空间中的 Courant–Friedrichs–Lewy (CFL) 条件，推导时间步长 $ \\Delta t $ 的稳定性界限，然后计算下列参数下的最大稳定 $ \\Delta t $：\n$ L_x = 2\\,\\mathrm{m} $，$ L_y = 1\\,\\mathrm{m} $，$ L_z = 0.5\\,\\mathrm{m} $，$ \\alpha_x = 3 $，$ \\alpha_y = 2 $，$ U_0 = 30\\,\\mathrm{m/s} $，$ V_0 = 10\\,\\mathrm{m/s} $，$ W_0 = 5\\,\\mathrm{m/s} $，$ N_{\\xi} = 80 $，$ N_{\\eta} = 60 $，以及 $ N_{\\zeta} = 40 $。将最终的 $ \\Delta t_{\\max} $ 以秒为单位表示，并将答案四舍五入到四位有效数字。此外，在您的推导中，解释由 $ f'(\\xi) $、$ g'(\\eta) $ 和 $ h'(\\zeta) $ 量化的网格拉伸如何影响计算空间中的稳定性界限。", "solution": "物理空间 $(x, y, z)$ 中被动标量 $q$ 平流的控制方程由守恒定律给出：\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0\n$$\n鉴于速度场 $\\boldsymbol{U} = (U_0, V_0, W_0)$ 是恒定的，方程简化为非守恒形式：\n$$\n\\frac{\\partial q}{\\partial t} + U_0 \\frac{\\partial q}{\\partial x} + V_0 \\frac{\\partial q}{\\partial y} + W_0 \\frac{\\partial q}{\\partial z} = 0\n$$\n该问题要求将此方程从物理空间 $(x, y, z)$ 转换到计算空间 $(\\xi, \\eta, \\zeta)$。网格是静止的，因此时间不进行变换，即 $t = \\tau$。坐标变换由以下公式给出：\n$x(\\xi) = L_x \\frac{\\exp(\\alpha_x \\xi) - 1}{\\exp(\\alpha_x) - 1}$\n$y(\\eta) = L_y \\frac{\\exp(\\alpha_y \\eta) - 1}{\\exp(\\alpha_y) - 1}$\n$z(\\zeta) = L_z \\zeta$\n\n这是一个一维拉伸，其中 $x$ 仅依赖于 $\\xi$，$y$ 仅依赖于 $\\eta$，$z$ 仅依赖于 $\\zeta$。我们应用链式法则求偏导数：\n$\\frac{\\partial q}{\\partial x} = \\frac{d\\xi}{dx} \\frac{\\partial q}{\\partial \\xi} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} \\frac{\\partial q}{\\partial \\xi}$\n$\\frac{\\partial q}{\\partial y} = \\frac{d\\eta}{dy} \\frac{\\partial q}{\\partial \\eta} = \\left(\\frac{dy}{d\\eta}\\right)^{-1} \\frac{\\partial q}{\\partial \\eta}$\n$\\frac{\\partial q}{\\partial z} = \\frac{d\\zeta}{dz} \\frac{\\partial q}{\\partial \\zeta} = \\left(\\frac{dz}{d\\zeta}\\right)^{-1} \\frac{\\partial q}{\\partial \\zeta}$\n\n我们计算变换度量（映射函数的导数）：\n$\\frac{dx}{d\\xi} = x'(\\xi) = L_x \\frac{\\alpha_x \\exp(\\alpha_x \\xi)}{\\exp(\\alpha_x) - 1}$\n$\\frac{dy}{d\\eta} = y'(\\eta) = L_y \\frac{\\alpha_y \\exp(\\alpha_y \\eta)}{\\exp(\\alpha_y) - 1}$\n$\\frac{dz}{d\\zeta} = z'(\\zeta) = L_z$\n\n将这些代入平流方程，得到计算空间中的控制方程：\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{U_0}{x'(\\xi)} \\frac{\\partial q}{\\partial \\xi} + \\frac{V_0}{y'(\\eta)} \\frac{\\partial q}{\\partial \\eta} + \\frac{W_0}{z'(\\zeta)} \\frac{\\partial q}{\\partial \\zeta} = 0\n$$\n这是一个在计算空间中具有空间变化的平流速度的平流方程：\n$U_{comp}(\\xi) = \\frac{U_0}{x'(\\xi)}$，$V_{comp}(\\eta) = \\frac{V_0}{y'(\\eta)}$，和 $W_{comp} = \\frac{W_0}{z'(\\zeta)} = \\frac{W_0}{L_z}$。\n\n数值格式是时间上显式向前欧拉和空间上一阶迎风。令 $q_{i,j,k}^n$ 表示在计算坐标 $(i\\Delta\\xi, j\\Delta\\eta, k\\Delta\\zeta)$ 和时间 $n\\Delta t$ 处 $q$ 的数值近似。给定 $U_0, V_0, W_0  0$ 并且注意到对于给定参数，度量项 $x'(\\xi)$、$y'(\\eta)$ 和 $z'(\\zeta)$ 也为正，因此计算速度 $U_{comp}$、$V_{comp}$、$W_{comp}$ 均为正。对于正速度，一阶迎风格式使用向后差分。离散化的方程为：\n$$\n\\frac{q_{i,j,k}^{n+1} - q_{i,j,k}^n}{\\Delta t} + U_{comp,i} \\left( \\frac{q_{i,j,k}^n - q_{i-1,j,k}^n}{\\Delta \\xi} \\right) + V_{comp,j} \\left( \\frac{q_{i,j,k}^n - q_{i,j-1,k}^n}{\\Delta \\eta} \\right) + W_{comp,k} \\left( \\frac{q_{i,j,k}^n - q_{i,j,k-1}^n}{\\Delta \\zeta} \\right) = 0\n$$\n其中 $U_{comp,i} = U_{comp}(i\\Delta\\xi)$，$V_{comp,j} = V_{comp}(j\\Delta\\eta)$，并且 $W_{comp,k}$ 是常数。\n\n为保证此显式格式的稳定性，必须满足 Courant-Friedrichs-Lewy (CFL) 条件。重排关于 $q_{i,j,k}^{n+1}$ 的方程：\n$$ q_{i,j,k}^{n+1} = \\left(1 - \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} - \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} - \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta}\\right) q_{i,j,k}^n + \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} q_{i-1,j,k}^n + \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} q_{i,j-1,k}^n + \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta} q_{i,j,k-1}^n $$\n一个充分的稳定性条件（基于正定性）是右侧所有 $q^n$ 项的系数都非负。这导致以下条件：\n$$\n1 - \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} - \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} - \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta} \\ge 0\n$$\n$$\n\\frac{|U_{comp,i}|\\Delta t}{\\Delta \\xi} + \\frac{|V_{comp,j}|\\Delta t}{\\Delta \\eta} + \\frac{|W_{comp,k}|\\Delta t}{\\Delta \\zeta} \\le 1\n$$\n这里使用绝对值以保证通用性。此条件必须对所有网格点 $(i, j, k)$ 成立。对时间步长 $\\Delta t$ 最严格的限制发生在 Courant 数之和最大的地方。\n$$\n\\Delta t \\le \\frac{1}{\\max_{\\xi,\\eta,\\zeta} \\left( \\frac{|U_{comp}(\\xi)|}{\\Delta \\xi} + \\frac{|V_{comp}(\\eta)|}{\\Delta \\eta} + \\frac{|W_{comp}|}{\\Delta \\zeta} \\right)}\n$$\n因此，最大稳定时间步长 $\\Delta t_{\\max}$ 为：\n$$\n\\Delta t_{\\max} = \\frac{1}{\\frac{\\max|U_{comp}|}{\\Delta \\xi} + \\frac{\\max|V_{comp}|}{\\Delta \\eta} + \\frac{|W_{comp}|}{\\Delta \\zeta}}\n$$\n问题要求解释网格拉伸的影响。拉伸因子是 $x'(\\xi)$、$y'(\\eta)$ 和 $z'(\\zeta)$，它们代表物理网格间距与计算网格间距之比（例如，$\\Delta x \\approx x'(\\xi) \\Delta \\xi$）。计算平流速度与这些拉伸因子成反比，例如 $U_{comp} = U_0/x'(\\xi)$。稳定性极限由最大的计算速度决定。这发生在拉伸因子最小的地方，对应于物理网格最密的区域。\n\n我们必须找到计算速度的最大值。\n由于 $\\alpha_x = 3  0$ 和 $\\alpha_y = 2  0$，函数 $\\exp(\\alpha_x \\xi)$ 和 $\\exp(\\alpha_y \\eta)$ 是单调递增的。因此，$x'(\\xi)$ 和 $y'(\\eta)$ 也是单调递增的。它们的最小值分别出现在 $\\xi=0$ 和 $\\eta=0$ 处。这是物理网格最密的地方。\n$\\min x'(\\xi) = x'(0) = L_x \\frac{\\alpha_x \\exp(0)}{\\exp(\\alpha_x) - 1} = \\frac{L_x \\alpha_x}{\\exp(\\alpha_x) - 1}$\n$\\min y'(\\eta) = y'(0) = L_y \\frac{\\alpha_y \\exp(0)}{\\exp(\\alpha_y) - 1} = \\frac{L_y \\alpha_y}{\\exp(\\alpha_y) - 1}$\n度量 $z' = L_z$ 是恒定的。\n\n最大计算速度为：\n$\\max|U_{comp}| = \\frac{|U_0|}{\\min x'(\\xi)} = \\frac{U_0(\\exp(\\alpha_x)-1)}{L_x \\alpha_x}$\n$\\max|V_{comp}| = \\frac{|V_0|}{\\min y'(\\eta)} = \\frac{V_0(\\exp(\\alpha_y)-1)}{L_y \\alpha_y}$\n$|W_{comp}| = \\frac{|W_0|}{L_z}$\n\n现在我们代入给定的数值：\n$L_x = 2\\,\\mathrm{m}$，$L_y = 1\\,\\mathrm{m}$，$L_z = 0.5\\,\\mathrm{m}$\n$\\alpha_x = 3$，$\\alpha_y = 2$\n$U_0 = 30\\,\\mathrm{m/s}$，$V_0 = 10\\,\\mathrm{m/s}$，$W_0 = 5\\,\\mathrm{m/s}$\n$N_{\\xi} = 80 \\implies \\Delta \\xi = \\frac{1}{80}$\n$N_{\\eta} = 60 \\implies \\Delta \\eta = \\frac{1}{60}$\n$N_{\\zeta} = 40 \\implies \\Delta \\zeta = \\frac{1}{40}$\n\n$\\Delta t_{\\max}$ 表达式的分母由三项组成：\n第1项：$\\frac{\\max|U_{comp}|}{\\Delta \\xi} = \\frac{U_0 (\\exp(\\alpha_x)-1)}{L_x \\alpha_x \\Delta \\xi} = \\frac{30 \\cdot (\\exp(3)-1)}{2 \\cdot 3 \\cdot (1/80)} = \\frac{30 \\cdot 80 \\cdot (\\exp(3)-1)}{6} = 400(\\exp(3)-1)$\n第2项：$\\frac{\\max|V_{comp}|}{\\Delta \\eta} = \\frac{V_0 (\\exp(\\alpha_y)-1)}{L_y \\alpha_y \\Delta \\eta} = \\frac{10 \\cdot (\\exp(2)-1)}{1 \\cdot 2 \\cdot (1/60)} = \\frac{10 \\cdot 60 \\cdot (\\exp(2)-1)}{2} = 300(\\exp(2)-1)$\n第3项：$\\frac{|W_{comp}|}{\\Delta \\zeta} = \\frac{W_0}{L_z \\Delta \\zeta} = \\frac{5}{0.5 \\cdot (1/40)} = \\frac{5 \\cdot 40}{0.5} = 400$\n\n现在，我们计算这些项的数值：\n第1项：$400(\\exp(3)-1) \\approx 400(20.085537 - 1) = 400(19.085537) \\approx 7634.2148$\n第2项：$300(\\exp(2)-1) \\approx 300(7.389056 - 1) = 300(6.389056) \\approx 1916.7168$\n第3项：$400$\n\n分母中各项的总和是：\n$S = 7634.2148 + 1916.7168 + 400 = 9950.9316$\n\n最后，我们计算最大稳定时间步长：\n$\\Delta t_{\\max} = \\frac{1}{S} = \\frac{1}{9950.9316} \\approx 0.0001004931\\,\\mathrm{s}$\n\n将结果四舍五入到四位有效数字，得到：\n$\\Delta t_{\\max} \\approx 0.0001005\\,\\mathrm{s}$", "answer": "$$\n\\boxed{0.0001005}\n$$", "id": "3324584"}, {"introduction": "最后一个练习将探讨在曲线网格上实现求解器时一个微妙但至关重要的问题：离散度量张量的计算方式。我们将实现并比较两种计算面度量矢量的策略。这个练习将通过计算证明，其中一种策略由于其构造方式能够内在满足离散的几何守恒律（Geometric Conservation Law），从而完美地保持自由流，而另一种则会引入误差。这项实践凸显了为保证高保真数值模拟的准确性，选择一致的离散化方案是何等重要。", "problem": "您需要编写一个完整的、可运行的程序，比较在计算空间中计算控制方程网格度量的两种离散策略，并量化它们对标量守恒律自由流守恒的影响。目标是在一组从计算正方形到物理平面的平滑变形周期性映射上实现这两种策略，并评估当使用计算空间中一致的有限体积散度进行离散化时，恒定自由流的残差。您的实现必须严格遵循下文所述的定义和离散化方法，并且您的最终程序必须生成单行输出，其中包含按指定格式排列的所有测试用例的结果。\n\n考虑一个从计算坐标 $\\left(\\xi,\\eta\\right)\\in [0,1]\\times[0,1]$ 到物理坐标 $\\left(x,y\\right)$ 的平滑可逆映射，由矢量函数 $\\mathbf{r}\\left(\\xi,\\eta\\right)=\\left(x\\left(\\xi,\\eta\\right),y\\left(\\xi,\\eta\\right)\\right)$ 给出。记雅可比行列式为 $J=\\det\\left(\\partial\\mathbf{r}/\\partial\\left(\\xi,\\eta\\right)\\right)$，逆变度量矢量为 $\\mathbf{a}^{\\xi}$ 和 $\\mathbf{a}^{\\eta}$，因此在计算空间中，具有物理速度 $\\mathbf{u}=\\left(u,v\\right)$ 的标量场 $q$ 的守恒定律呈现为守恒形式\n$$\n\\frac{\\partial\\left(J q\\right)}{\\partial t}+\\frac{\\partial}{\\partial \\xi}\\left(J\\left(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u}\\right)q\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J\\left(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u}\\right)q\\right)=0.\n$$\n对于具有恒定 $q$ 和恒定 $\\mathbf{u}$ 的恒定自由流，连续残差简化为\n$$\n\\mathcal{R}=\\frac{\\partial}{\\partial \\xi}\\left(J\\left(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u}\\right)\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J\\left(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u}\\right)\\right)=\\mathbf{u}\\cdot\\left(\\frac{\\partial\\left(J\\mathbf{a}^{\\xi}\\right)}{\\partial \\xi}+\\frac{\\partial\\left(J\\mathbf{a}^{\\eta}\\right)}{\\partial \\eta}\\right),\n$$\n如果度量恒等式\n$$\n\\frac{\\partial\\left(J\\mathbf{a}^{\\xi}\\right)}{\\partial \\xi}+\\frac{\\partial\\left(J\\mathbf{a}^{\\eta}\\right)}{\\partial \\eta}=\\mathbf{0}\n$$\n成立，则该残差恒为零。在离散形式中，若未用与通量散度中相同的离散算子来满足度量恒等式，将导致违反自由流守恒的伪源项。您必须实现并比较两种离散度量策略：\n\n- 策略 $\\mathrm{D}$ (微分映射，平均到面)：使用二阶中心差分和周期性边界计算单元中心的 $x$ 和 $y$ 的离散偏导数；使用二维叉积公式的模拟形式在单元中心构建 $J\\mathbf{a}^{\\xi}$ 和 $J\\mathbf{a}^{\\eta}$ 的节点近似；然后通过相邻单元中心值的算术平均获得面度量矢量，并按适当的计算网格间距进行缩放。\n\n- 策略 $\\mathrm{C}$ (面上协变边的叉积)：直接将面度量矢量构建为离散积分几何对象，这些对象来自单元角点上节点坐标的半索引平均值，利用这些半索引位置的差分来形成守恒的面度量矢量，这些矢量在离散散度中会相互对消。\n\n需使用的离散设置和算子：\n\n- 使用均匀的周期性计算网格，在 $\\xi$ 方向有 $N_{\\xi}$ 个单元，在 $\\eta$ 方向有 $N_{\\eta}$ 个单元，间距分别为 $\\Delta \\xi=1/N_{\\xi}$ 和 $\\Delta \\eta=1/N_{\\eta}$。\n\n- 在整数索引 $i\\in\\{0,\\dots,N_{\\xi}-1\\}$ 和 $j\\in\\{0,\\dots,N_{\\eta}-1\\}$ 处定义节点坐标 $\\left(\\xi_{i},\\eta_{j}\\right)$，由 $\\xi_{i}=i\\Delta \\xi$ 和 $\\eta_{j}=j\\Delta \\eta$ 给出，索引采用对 $N_{\\xi}$ 和 $N_{\\eta}$ 的模运算实现周期性。\n\n- 在 $\\left(\\xi_{i+1/2},\\eta_{j+1/2}\\right)=\\left(\\left(i+\\tfrac{1}{2}\\right)\\Delta \\xi,\\left(j+\\tfrac{1}{2}\\right)\\Delta \\eta\\right)$ 处定义单元中心，其中 $i\\in\\{0,\\dots,N_{\\xi}-1\\}$ 且 $j\\in\\{0,\\dots,N_{\\eta}-1\\}$。\n\n- 使用以下由振幅 $\\alpha$、$\\beta$ 和整数频率 $m,n,p,q$ 参数化的平滑周期性映射族：\n$$\nx\\left(\\xi,\\eta\\right)=\\xi+\\alpha \\sin\\left(2\\pi m \\xi\\right)\\sin\\left(2\\pi n \\eta\\right),\\quad\ny\\left(\\xi,\\eta\\right)=\\eta+\\beta \\sin\\left(2\\pi p \\xi\\right)\\sin\\left(2\\pi q \\eta\\right).\n$$\n\n- 策略 $\\mathrm{D}$ 详情：\n  - 通过在 $\\left(\\xi_{i+1/2},\\eta_{j+1/2}\\right)$ 处求映射值，计算单元中心的 $x$ 和 $y$ $(x_{c},y_{c})$。\n  - 在单元中心计算带周期性卷绕的中心有限差分：\n    $$\n    x_{\\xi}\\approx \\frac{x_{c}\\left(i+1,j\\right)-x_{c}\\left(i-1,j\\right)}{2\\Delta \\xi},\\quad\n    x_{\\eta}\\approx \\frac{x_{c}\\left(i,j+1\\right)-x_{c}\\left(i,j-1\\right)}{2\\Delta \\eta},\n    $$\n    对 $y_{\\xi}$ 和 $y_{\\eta}$ 进行类似计算。\n  - 在单元中心构建矢量 $J\\mathbf{a}^{\\xi}=\\left(y_{\\eta},-x_{\\eta}\\right)$ 和 $J\\mathbf{a}^{\\eta}=\\left(-y_{\\xi},x_{\\xi}\\right)$。\n  - 通过相邻单元中心值的算术平均，并乘以面的计算长度，生成面度量矢量：\n    $$\n    \\mathbf{S}_{\\xi}^{\\mathrm{D}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\Delta \\eta\\,\\frac{\\left(J\\mathbf{a}^{\\xi}\\right)\\left(i,j\\right)+\\left(J\\mathbf{a}^{\\xi}\\right)\\left(i+1,j\\right)}{2},\n    $$\n    $$\n    \\mathbf{S}_{\\eta}^{\\mathrm{D}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\Delta \\xi\\,\\frac{\\left(J\\mathbf{a}^{\\eta}\\right)\\left(i,j\\right)+\\left(J\\mathbf{a}^{\\eta}\\right)\\left(i,j+1\\right)}{2},\n    $$\n    其中 $\\mathbf{S}_{\\xi}$ 位于单元 $\\left(i,j\\right)$ 的 $\\xi$-面上，位置为 $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$，而 $\\mathbf{S}_{\\eta}$ 位于 $\\eta$-面上，位置为 $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$。\n\n- 策略 $\\mathrm{C}$ 详情：\n  - 通过在网格节点 $\\left(\\xi_{i},\\eta_{j}\\right)$ 处求映射值，计算节点坐标 $(x_{n},y_{n})$。\n  - 通过平均周围四个节点值，计算位于 $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$ 位置的半索引平均值：\n    $$\n    x_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\frac{x_{n}\\left(i,j\\right)+x_{n}\\left(i+1,j\\right)+x_{n}\\left(i,j+1\\right)+x_{n}\\left(i+1,j+1\\right)}{4},\n    $$\n    对 $y_{h}$ 进行类似计算，索引带周期性卷绕。\n  - 通过这些半索引位置的旋转差分，形成守恒的面度量矢量：\n    $$\n    \\mathbf{S}_{\\xi}^{\\mathrm{C}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\left(y_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-y_{h}\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right),\\,-\\left(x_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-x_{h}\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)\\right)\\right),\n    $$\n    $$\n    \\mathbf{S}_{\\eta}^{\\mathrm{C}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\left(-\\left(y_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-y_{h}\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\\right),\\,\\left(x_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-x_{h}\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\\right)\\right).\n    $$\n    这种构造是守恒的，并为面度量矢量产生一个离散的对消恒等式。\n\n离散散度和自由流残差：\n\n- 对于任一策略 $\\mathrm{S}\\in\\{\\mathrm{D},\\mathrm{C}\\}$，为恒定的 $q$ 和恒定的 $\\mathbf{u}=\\left(u,v\\right)$ 定义面通量\n$$\nF_{\\xi}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=q\\,\\mathbf{u}\\cdot \\mathbf{S}_{\\xi}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right),\\quad\nF_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=q\\,\\mathbf{u}\\cdot \\mathbf{S}_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right).\n$$\n\n- 单元 $\\left(i,j\\right)$ 的以单元为中心的离散残差是\n$$\n\\mathcal{R}^{\\mathrm{S}}\\left(i,j\\right)=F_{\\xi}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-F_{\\xi}^{\\mathrm{S}}\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)+F_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-F_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right),\n$$\n带周期性卷绕。为实现完美的自由流守恒，此残差必须为零。\n\n- 报告归一化均方根残差\n$$\nE^{\\mathrm{S}}=\\frac{\\sqrt{\\frac{1}{N_{\\xi}N_{\\eta}}\\sum_{i=0}^{N_{\\xi}-1}\\sum_{j=0}^{N_{\\eta}-1}\\left(\\mathcal{R}^{\\mathrm{S}}\\left(i,j\\right)\\right)^{2}}}{|q|\\,\\sqrt{u^{2}+v^{2}}}.\n$$\n\n测试套件：\n\n您的程序必须实现上述内容，并为以下四个测试用例评估 $E^{\\mathrm{D}}$ 和 $E^{\\mathrm{C}}$，每个用例由 $\\left(N_{\\xi},N_{\\eta},\\alpha,\\beta,m,n,p,q,u,v,q_{0}\\right)$ 定义：\n\n- 用例 1：$\\left(N_{\\xi},N_{\\eta}\\right)=\\left(48,48\\right)$, $\\alpha=0.15$, $\\beta=-0.17$, $m=1$, $n=1$, $p=1$, $q=2$, $u=0.9$, $v=-0.6$, $q_{0}=2.0$。\n\n- 用例 2：$\\left(N_{\\xi},N_{\\eta}\\right)=\\left(16,16\\right)$, $\\alpha=0.3$, $\\beta=0.2$, $m=2$, $n=1$, $p=1$, $q=2$, $u=1.0$, $v=0.0$, $q_{0}=1.0$。\n\n- 用例 3：$\\left(N_{\\xi},N_{\\eta}\\right)=\\left(32,32\\right)$, $\\alpha=0.0$, $\\beta=0.0$, $m=1$, $n=1$, $p=1$, $q=1$, $u=1.0$, $v=1.0$, $q_{0}=1.0$。\n\n- 用例 4：$\\left(N_{\\xi},N_{\\eta}\\right)=\\left(24,24\\right)$, $\\alpha=0.12$, $\\beta=0.25$, $m=2$, $n=3$, $p=3$, $q=2$, $u=0.7$, $v=1.3$, $q_{0}=0.5$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，包含一个结果列表，形式为以逗号分隔的、包含在方括号中的每个用例的配对。每个配对是对应案例的二元列表 $\\left[E^{\\mathrm{D}},E^{\\mathrm{C}}\\right]$。最终格式必须是\n$$\n\\left[\\left[E^{\\mathrm{D}}_{1},E^{\\mathrm{C}}_{1}\\right],\\left[E^{\\mathrm{D}}_{2},E^{\\mathrm{C}}_{2}\\right],\\left[E^{\\mathrm{D}}_{3},E^{\\mathrm{C}}_{3}\\right],\\left[E^{\\mathrm{D}}_{4},E^{\\mathrm{C}}_{4}\\right]\\right],\n$$\n数值以标准浮点表示法打印。", "solution": "本问题涉及计算流体动力学（CFD）领域中，在变换网格上对自由流守恒的数值验证。这是一个验证不同网格度量计算方案属性的标准练习。解决方案通过Python和`numpy`库实现，以进行高效的数组计算。总体结构包含一个主函数，遍历四个测试用例。对于每个用例，一个专门的函数执行策略D和策略C的计算，并返回相应的误差。\n\n**策略C实现大纲：**\n此策略是几何守恒的，能够精确满足离散度量恒等式。因此，残差以及误差 $E^{\\mathrm{C}}$ 预计在机器精度范围内为零。\n1.  在节点位置 $(\\xi_i, \\eta_j)$ 定义计算网格。\n2.  使用提供的映射函数在这些节点上计算物理坐标 $(x_n, y_n)$。\n3.  通过平均周围四个节点坐标，计算以单元为中心的物理坐标 $(x_h, y_h)$，使用`numpy.roll`处理周期性边界。\n4.  通过对 $(x_h, y_h)$ 数组进行差分，构造守恒的面度量矢量 $\\mathbf{S}_{\\xi}^{\\mathrm{C}}$ 和 $\\mathbf{S}_{\\eta}^{\\mathrm{C}}$，同样使用`numpy.roll`进行周期性平移。\n5.  通过将度量矢量与恒定速度矢量 $\\mathbf{u}$ 进行点积并乘以 $q$ 来计算面通量 $F_{\\xi}^{\\mathrm{C}}$ 和 $F_{\\eta}^{\\mathrm{C}}$。\n6.  应用指定的散度公式计算离散残差 $\\mathcal{R}^{\\mathrm{C}}$，使用`numpy.roll`执行相邻单元面之间的减法。\n\n**策略D实现大纲：**\n此策略涉及微分，这可能引入违反度量恒等式的离散化误差。误差 $E^{\\mathrm{D}}$ 预计为非零。\n1.  在单元中心位置 $(\\xi_{i+1/2}, \\eta_{j+1/2})$ 定义计算网格。\n2.  在这些单元中心计算物理坐标 $(x_c, y_c)$。\n3.  使用指定的二阶中心差分公式计算单元中心的离散偏导数（$x_{\\xi}$, $x_{\\eta}$, $y_{\\xi}$, $y_{\\eta}$），用`numpy.roll`实现。\n4.  形成以单元为中心的度量量 $J\\mathbf{a}^{\\xi}$ 和 $J\\mathbf{a}^{\\eta}$。\n5.  将这些以单元为中心的量进行平均，以获得面度量矢量 $\\mathbf{S}_{\\xi}^{\\mathrm{D}}$ 和 $\\mathbf{S}_{\\eta}^{\\mathrm{D}}$。\n6.  使用与策略C相同的过程计算面通量和离散残差 $\\mathcal{R}^{\\mathrm{D}}$。\n\n**误差计算：**\n对于两种策略，最终的归一化RMS误差 $E^{\\mathrm{S}}$ 将根据提供的公式从残差场 $\\mathcal{R}^{\\mathrm{S}}$ 计算得出。所有测试用例的结果将被收集并格式化为所需的输出字符串。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the CFD problem for all test cases.\n    \"\"\"\n    # Test cases defined as tuples:\n    # (N_xi, N_eta, alpha, beta, m, n, p, q_freq, u, v, q_scalar)\n    test_cases = [\n        (48, 48, 0.15, -0.17, 1, 1, 1, 2, 0.9, -0.6, 2.0),\n        (16, 16, 0.3, 0.2, 2, 1, 1, 2, 1.0, 0.0, 1.0),\n        (32, 32, 0.0, 0.0, 1, 1, 1, 1, 1.0, 1.0, 1.0),\n        (24, 24, 0.12, 0.25, 2, 3, 3, 2, 0.7, 1.3, 0.5),\n    ]\n\n    results = []\n    for params in test_cases:\n        errors = calculate_errors_for_case(params)\n        results.append(errors)\n\n    # Format the final output string exactly as required.\n    case_results_str = [f\"[{ed},{ec}]\" for ed, ec in results]\n    final_output = f\"[{','.join(case_results_str)}]\"\n    print(final_output)\n\ndef map_coordinates(xi_grid, eta_grid, alpha, beta, m, n, p, q_freq):\n    \"\"\"\n    Computes physical coordinates (x, y) from computational (xi, eta).\n    \"\"\"\n    x = xi_grid + alpha * np.sin(2 * np.pi * m * xi_grid) * np.sin(2 * np.pi * n * eta_grid)\n    y = eta_grid + beta * np.sin(2 * np.pi * p * xi_grid) * np.sin(2 * np.pi * q_freq * eta_grid)\n    return x, y\n\ndef calculate_errors_for_case(params):\n    \"\"\"\n    Calculates the normalized RMS residual errors for Strategy D and Strategy C\n    for a single test case.\n    \"\"\"\n    N_xi, N_eta, alpha, beta, m, n, p, q_freq, u, v, q_scalar = params\n    \n    dxi = 1.0 / N_xi\n    deta = 1.0 / N_eta\n    \n    # --- Grid Setup ---\n    xi_node_1d = np.arange(N_xi) * dxi\n    eta_node_1d = np.arange(N_eta) * deta\n    xi_node, eta_node = np.meshgrid(xi_node_1d, eta_node_1d, indexing='ij')\n\n    xi_center_1d = (np.arange(N_xi) + 0.5) * dxi\n    eta_center_1d = (np.arange(N_eta) + 0.5) * deta\n    xi_center, eta_center = np.meshgrid(xi_center_1d, eta_center_1d, indexing='ij')\n\n    # --- Strategy D: Differentiate then Average ---\n    \n    # 1. Physical coords at cell centers\n    xc, yc = map_coordinates(xi_center, eta_center, alpha, beta, m, n, p, q_freq)\n    \n    # 2. Centered differences of coords at cell centers\n    x_xi = (np.roll(xc, -1, axis=0) - np.roll(xc, 1, axis=0)) / (2 * dxi)\n    x_eta = (np.roll(xc, -1, axis=1) - np.roll(xc, 1, axis=1)) / (2 * deta)\n    y_xi = (np.roll(yc, -1, axis=0) - np.roll(yc, 1, axis=0)) / (2 * dxi)\n    y_eta = (np.roll(yc, -1, axis=1) - np.roll(yc, 1, axis=1)) / (2 * deta)\n    \n    # 3. Cell-centered metric vectors J*a^xi and J*a^eta\n    Ja_xi_D = np.stack((y_eta, -x_eta), axis=-1)\n    Ja_eta_D = np.stack((-y_xi, x_xi), axis=-1)\n    \n    # 4. Face metric vectors by averaging cell-centered values\n    S_xi_D = deta / 2.0 * (Ja_xi_D + np.roll(Ja_xi_D, -1, axis=0))\n    S_eta_D = dxi / 2.0 * (Ja_eta_D + np.roll(Ja_eta_D, -1, axis=1))\n    \n    # 5. Face fluxes\n    F_xi_D = q_scalar * (S_xi_D[..., 0] * u + S_xi_D[..., 1] * v)\n    F_eta_D = q_scalar * (S_eta_D[..., 0] * u + S_eta_D[..., 1] * v)\n\n    # 6. Discrete residual\n    R_D = (F_xi_D - np.roll(F_xi_D, 1, axis=0)) + (F_eta_D - np.roll(F_eta_D, 1, axis=1))\n\n    # --- Strategy C: Conservative Cross Products ---\n\n    # 1. Physical coords at nodes\n    xn, yn = map_coordinates(xi_node, eta_node, alpha, beta, m, n, p, q_freq)\n    \n    # 2. Half-indexed averages (cell-centered positions)\n    xh = 0.25 * (xn + np.roll(xn, -1, axis=0) + np.roll(xn, -1, axis=1) + np.roll(np.roll(xn, -1, axis=0), -1, axis=1))\n    yh = 0.25 * (yn + np.roll(yn, -1, axis=0) + np.roll(yn, -1, axis=1) + np.roll(np.roll(yn, -1, axis=0), -1, axis=1))\n    \n    # 3. Conservative face metric vectors\n    S_xi_C_y = yh - np.roll(yh, 1, axis=1)\n    S_xi_C_x = -(xh - np.roll(xh, 1, axis=1))\n    S_xi_C = np.stack((S_xi_C_y, S_xi_C_x), axis=-1)\n\n    S_eta_C_x = -(yh - np.roll(yh, 1, axis=0))\n    S_eta_C_y = xh - np.roll(xh, 1, axis=0)\n    S_eta_C = np.stack((S_eta_C_x, S_eta_C_y), axis=-1)\n    \n    # 4. Face fluxes\n    F_xi_C = q_scalar * (S_xi_C[..., 0] * u + S_xi_C[..., 1] * v)\n    F_eta_C = q_scalar * (S_eta_C[..., 0] * u + S_eta_C[..., 1] * v)\n\n    # 5. Discrete residual\n    R_C = (F_xi_C - np.roll(F_xi_C, 1, axis=0)) + (F_eta_C - np.roll(F_eta_C, 1, axis=1))\n    \n    # --- Final Error Calculation ---\n    norm_factor = abs(q_scalar) * np.sqrt(u**2 + v**2)\n    \n    if norm_factor == 0:\n        E_D = np.sqrt(np.mean(R_D**2))\n        E_C = np.sqrt(np.mean(R_C**2))\n    else:\n        E_D = np.sqrt(np.mean(R_D**2)) / norm_factor\n        E_C = np.sqrt(np.mean(R_C**2)) / norm_factor\n        \n    return [E_D, E_C]\n\nsolve()\n```", "id": "3324596"}]}