{"hands_on_practices": [{"introduction": "计算流体动力学中的结构化网格，其核心在于将复杂的物理域映射到一个简单的计算域（如单位立方体）上。本练习将带您从微分几何的第一性原理出发，通过坐标变换推导协变与逆变基向量、面向量以及单元体积等基本几何量。通过这个实践 ([@problem_id:3326712])，您将深刻理解雅可比行列式在连接物理空间与计算空间中的核心作用，并掌握从数学定义出发分析网格特性的基本技能。", "problem": "在计算流体动力学(CFD)中，一个曲线六面体控制体由一个从单位计算立方体 $\\{(\\xi,\\eta,\\zeta)\\,|\\,0 \\le \\xi \\le 1,\\,0 \\le \\eta \\le 1,\\,0 \\le \\zeta \\le 1\\}$ 到物理空间的光滑、一一映射 $\\boldsymbol{x}(\\xi,\\eta,\\zeta)$ 定义。从可微映射 $\\boldsymbol{x}(\\xi,\\eta,\\zeta)$ 的基本定义以及线元、面元和体元的微分几何恒等式出发，推导协变基向量 $\\boldsymbol{g}_{\\xi}$、$\\boldsymbol{g}_{\\eta}$、$\\boldsymbol{g}_{\\zeta}$ 和逆变基向量 $\\boldsymbol{g}^{\\xi}$、$\\boldsymbol{g}^{\\eta}$、$\\boldsymbol{g}^{\\zeta}$，并用雅可比行列式 $J$ 和度量系数表示定向面向量（对于 $\\xi$、$\\eta$ 和 $\\zeta$ 为常数的面）和单元体积。你的推导必须从微分映射和对偶基的定义出发，而不是从已给定的公式出发。\n\n然后，对于具体映射\n$$\n\\begin{aligned}\nx(\\xi,\\eta,\\zeta) = \\big(L_{x} + \\alpha\\,\\eta\\big)\\,\\xi,\\\\\ny(\\xi,\\eta,\\zeta) = \\big(L_{y} + \\beta\\,\\xi\\big)\\,\\eta + \\gamma\\,\\xi\\,\\zeta,\\\\\nz(\\xi,\\eta,\\zeta) = L_{z}\\,\\zeta + \\delta\\,\\eta\\,\\zeta,\n\\end{aligned}\n$$\n其中常数 $L_{x} = 2$、$L_{y} = 1.5$、$L_{z} = 1.2$、$\\alpha = 0.4$、$\\beta = 0.2$、$\\gamma = 0.3$ 和 $\\delta = 0.1$ (所有长度单位为米)，计算该控制体的总物理体积，\n$$\nV \\;=\\; \\int_{0}^{1}\\int_{0}^{1}\\int_{0}^{1} J(\\xi,\\eta,\\zeta)\\,d\\xi\\,d\\eta\\,d\\zeta,\n$$\n其中 $J(\\xi,\\eta,\\zeta)$ 是映射的雅可比行列式。将你计算出的最终数值 $V$ 四舍五入至四位有效数字。以 $\\mathrm{m}^{3}$ 为单位表示最终体积。", "solution": "曲线网格的基础是可微映射 $\\boldsymbol{x}(\\xi,\\eta,\\zeta)$ 以及相关的坐标变换微分几何。物理空间中的微分位移为\n$$\nd\\boldsymbol{x} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\xi}\\,d\\xi \\;+\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\eta}\\,d\\eta \\;+\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\zeta}\\,d\\zeta.\n$$\n根据定义，协变基向量为\n$$\n\\boldsymbol{g}_{\\xi} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\xi},\\qquad\n\\boldsymbol{g}_{\\eta} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\eta},\\qquad\n\\boldsymbol{g}_{\\zeta} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\zeta}.\n$$\n协变度量张量的系数为 $g_{ij} = \\boldsymbol{g}_{i}\\cdot\\boldsymbol{g}_{j}$，其中 $i,j \\in \\{\\xi,\\eta,\\zeta\\}$，雅可比行列式是标量三重积\n$$\nJ \\;=\\; \\boldsymbol{g}_{\\xi}\\cdot\\left(\\boldsymbol{g}_{\\eta}\\times\\boldsymbol{g}_{\\zeta}\\right).\n$$\n逆变基向量被定义为满足 $\\boldsymbol{g}^{i}\\cdot\\boldsymbol{g}_{j} = \\delta^{i}_{j}$ 的对偶基，其中 $\\delta^{i}_{j}$ 是克罗内克δ符号。根据标量三重积和对偶基的性质，可以得到\n$$\n\\boldsymbol{g}^{\\xi} \\;=\\; \\frac{\\boldsymbol{g}_{\\eta}\\times\\boldsymbol{g}_{\\zeta}}{J},\\qquad\n\\boldsymbol{g}^{\\eta} \\;=\\; \\frac{\\boldsymbol{g}_{\\zeta}\\times\\boldsymbol{g}_{\\xi}}{J},\\qquad\n\\boldsymbol{g}^{\\zeta} \\;=\\; \\frac{\\boldsymbol{g}_{\\xi}\\times\\boldsymbol{g}_{\\eta}}{J}.\n$$\n一个面元的定向面向量由张成该曲面的切向协变基向量的叉积给出。因此，对于计算坐标为常数的面，其定向面向量为\n$$\nd\\boldsymbol{S}_{\\xi} \\;=\\; \\boldsymbol{g}_{\\eta}\\times\\boldsymbol{g}_{\\zeta}\\;d\\eta\\,d\\zeta \\;=\\; J\\,\\boldsymbol{g}^{\\xi}\\;d\\eta\\,d\\zeta,\n$$\n$$\nd\\boldsymbol{S}_{\\eta} \\;=\\; \\boldsymbol{g}_{\\zeta}\\times\\boldsymbol{g}_{\\xi}\\;d\\zeta\\,d\\xi \\;=\\; J\\,\\boldsymbol{g}^{\\eta}\\;d\\zeta\\,d\\xi,\n$$\n$$\nd\\boldsymbol{S}_{\\zeta} \\;=\\; \\boldsymbol{g}_{\\xi}\\times\\boldsymbol{g}_{\\eta}\\;d\\xi\\,d\\eta \\;=\\; J\\,\\boldsymbol{g}^{\\zeta}\\;d\\xi\\,d\\eta.\n$$\n微分体元可由标量三重积得到：\n$$\ndV \\;=\\; \\left(\\boldsymbol{g}_{\\xi}\\cdot\\left(\\boldsymbol{g}_{\\eta}\\times\\boldsymbol{g}_{\\zeta}\\right)\\right)\\,d\\xi\\,d\\eta\\,d\\zeta \\;=\\; J\\,d\\xi\\,d\\eta\\,d\\zeta,\n$$\n总单元体积为 $V = \\int_{0}^{1}\\int_{0}^{1}\\int_{0}^{1} J(\\xi,\\eta,\\zeta)\\,d\\xi\\,d\\eta\\,d\\zeta$。\n\n我们现在将这些定义应用于给定的映射。写作\n$$\nx(\\xi,\\eta,\\zeta) \\;=\\; \\big(L_{x} + \\alpha\\,\\eta\\big)\\,\\xi, \\quad\ny(\\xi,\\eta,\\zeta) \\;=\\; \\big(L_{y} + \\beta\\,\\xi\\big)\\,\\eta \\;+\\; \\gamma\\,\\xi\\,\\zeta, \\quad\nz(\\xi,\\eta,\\zeta) \\;=\\; L_{z}\\,\\zeta \\;+\\; \\delta\\,\\eta\\,\\zeta.\n$$\n协变基向量为\n$$\n\\boldsymbol{g}_{\\xi} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\xi}\n\\;=\\; \\left(\\frac{\\partial x}{\\partial \\xi},\\,\\frac{\\partial y}{\\partial \\xi},\\,\\frac{\\partial z}{\\partial \\xi}\\right)\n\\;=\\; \\left(L_{x} + \\alpha\\,\\eta,\\,\\beta\\,\\eta + \\gamma\\,\\zeta,\\,0\\right),\n$$\n$$\n\\boldsymbol{g}_{\\eta} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\eta}\n\\;=\\; \\left(\\alpha\\,\\xi,\\,L_{y} + \\beta\\,\\xi,\\,\\delta\\,\\zeta\\right),\n$$\n$$\n\\boldsymbol{g}_{\\zeta} \\;=\\; \\frac{\\partial \\boldsymbol{x}}{\\partial \\zeta}\n\\;=\\; \\left(0,\\,\\gamma\\,\\xi,\\,L_{z} + \\delta\\,\\eta\\right).\n$$\n雅可比行列式是标量三重积\n$$\nJ(\\xi,\\eta,\\zeta)\n\\;=\\; \\boldsymbol{g}_{\\xi}\\cdot\\left(\\boldsymbol{g}_{\\eta}\\times\\boldsymbol{g}_{\\zeta}\\right)\n\\;=\\; \\det\\begin{pmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial x}{\\partial \\zeta} \\\\[4pt]\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\zeta} \\\\[4pt]\n\\frac{\\partial z}{\\partial \\xi}  \\frac{\\partial z}{\\partial \\eta}  \\frac{\\partial z}{\\partial \\zeta}\n\\end{pmatrix}.\n$$\n使用先前得到的偏导数显式计算该行列式，得到\n$$\nJ(\\xi,\\eta,\\zeta)\n\\;=\\; \\big(L_{x} + \\alpha\\,\\eta\\big)\\Big(\\big(L_{y} + \\beta\\,\\xi\\big)\\big(L_{z} + \\delta\\,\\eta\\big) - \\gamma\\,\\xi\\,\\delta\\,\\zeta\\Big)\n\\;-\\; \\alpha\\,\\xi\\Big(\\big(\\beta\\,\\eta + \\gamma\\,\\zeta\\big)\\big(L_{z} + \\delta\\,\\eta\\big)\\Big).\n$$\n代入给定常数 $L_{x} = 2$、$L_{y} = 1.5$、$L_{z} = 1.2$、$\\alpha = 0.4$、$\\beta = 0.2$、$\\gamma = 0.3$、$\\delta = 0.1$，我们得到\n$$\nJ(\\xi,\\eta,\\zeta)\n\\;=\\; \\big(2 + 0.4\\,\\eta\\big)\\Big(\\big(1.5 + 0.2\\,\\xi\\big)\\big(1.2 + 0.1\\,\\eta\\big) - 0.03\\,\\xi\\,\\zeta\\Big)\n\\;-\\; 0.4\\,\\xi\\Big(\\big(0.2\\,\\eta + 0.3\\,\\zeta\\big)\\big(1.2 + 0.1\\,\\eta\\big)\\Big).\n$$\n展开并化简得到多项式\n$$\nJ(\\xi,\\eta,\\zeta)\n\\;=\\; 3.6 \\;+\\; 1.02\\,\\eta \\;+\\; 0.06\\,\\eta^{2} \\;+\\; 0.48\\,\\xi \\;+\\; 0.040\\,\\xi\\,\\eta \\;-\\; 0.204\\,\\xi\\,\\zeta \\;-\\; 0.024\\,\\xi\\,\\eta\\,\\zeta.\n$$\n总体积为\n$$\nV \\;=\\; \\int_{0}^{1}\\int_{0}^{1}\\int_{0}^{1} J(\\xi,\\eta,\\zeta)\\,d\\zeta\\,d\\eta\\,d\\xi.\n$$\n首先对 $\\zeta$ 积分：\n$$\n\\int_{0}^{1} J(\\xi,\\eta,\\zeta)\\,d\\zeta\n\\;=\\; 3.6 \\;+\\; 1.02\\,\\eta \\;+\\; 0.06\\,\\eta^{2} \\;+\\; 0.48\\,\\xi \\;+\\; 0.040\\,\\xi\\,\\eta \\;-\\; 0.102\\,\\xi \\;-\\; 0.012\\,\\xi\\,\\eta,\n$$\n化简为\n$$\n3.6 \\;+\\; 1.02\\,\\eta \\;+\\; 0.06\\,\\eta^{2} \\;+\\; 0.378\\,\\xi \\;+\\; 0.028\\,\\xi\\,\\eta.\n$$\n接着在 $[0,1]$ 上对 $\\eta$ 积分：\n$$\n\\int_{0}^{1}\\Big(3.6 \\;+\\; 1.02\\,\\eta \\;+\\; 0.06\\,\\eta^{2} \\;+\\; 0.378\\,\\xi \\;+\\; 0.028\\,\\xi\\,\\eta\\Big)\\,d\\eta\n\\;=\\; 3.6 \\;+\\; 0.51 \\;+\\; 0.02 \\;+\\; 0.378\\,\\xi \\;+\\; 0.014\\,\\xi,\n$$\n化简为\n$$\n4.13 \\;+\\; 0.392\\,\\xi.\n$$\n最后，在 $[0,1]$ 上对 $\\xi$ 积分：\n$$\nV \\;=\\; \\int_{0}^{1} \\big(4.13 + 0.392\\,\\xi\\big)\\,d\\xi \\;=\\; 4.13 \\;+\\; \\frac{0.392}{2} \\;=\\; 4.13 \\;+\\; 0.196 \\;=\\; 4.326.\n$$\n因此，该控制体的物理体积为 $4.326 \\,\\mathrm{m}^{3}$。四舍五入到四位有效数字，结果仍为 $4.326$。", "answer": "$$\\boxed{4.326}$$", "id": "3326712"}, {"introduction": "在掌握了单个单元的数学描述后，我们将转向处理由成千上万个单元组成的非结构化网格的实际挑战。本练习要求您设计一个算法，处理以压缩稀疏行（CSR）格式表示的网格连接数据，以计算面法向量并评估网格质量。这项实践 ([@problem_id:3326657]) 将锻炼您从原始数据出发，实现正交性、纵横比和偏斜度等关键质量指标计算的能力，并验证网格的几何一致性，这些都是确保有限体积法数值稳定性和准确性的前提。", "problem": "给定一个二维网格的平面单元连接关系（以压缩稀疏行格式表示）以及各点的笛卡尔坐标（单位为米）。每个单元都是一个简单多边形，其顶点按逆时针或顺时针顺序列出。在二维中，一个面（face）是多边形的一条边。请从欧几里得几何和散度定理的第一性原理出发，设计并实现一个算法，为每个单元的每条边构建向外的单位法向量，确保共享边的单元之间法向量的一致性，并通过闭环测试验证方向一致性。此外，还需计算与这些法向量相关的网格质量度量：每个单元的正交质量和纵横比，以及按单元聚合的每条边的偏斜度。\n\n该算法必须基于以下基本原理和定义推导：\n\n- 网格位于笛卡尔平面 $\\mathbb{R}^2$ 中，所有坐标均以米为单位。\n- 一个具有顶点 $\\{\\mathbf{x}_0, \\mathbf{x}_1, \\dots, \\mathbf{x}_{m-1}\\}$ 的单元 $c$ 将其边定义为连续顶点之间的线段（首尾相连），即 $(\\mathbf{x}_i, \\mathbf{x}_{i+1 \\bmod m})$。\n- 多边形的有向面积 $A_c$ 由鞋带公式给出，该公式决定了其方向：$$A_c = \\frac{1}{2}\\sum_{i=0}^{m-1} \\left(x_i y_{i+1 \\bmod m} - x_{i+1 \\bmod m} y_i\\right).$$ 严格为正的 $A_c$ 表示逆时针排序，严格为负的 $A_c$ 表示顺时针排序。\n- 对于欧几里得长度为 $L_i = \\|\\mathbf{e}_i\\|$ 的边向量 $\\mathbf{e}_i = \\mathbf{x}_{i+1 \\bmod m} - \\mathbf{x}_i$，其向外单位法向量 $\\mathbf{n}_i$ 是通过将 $\\mathbf{e}_i$ 旋转 $\\pm 90^\\circ$ 然后进行归一化得到的。对于逆时针排序的单元，向外法向量是 $-90^\\circ$ 旋转；对于顺时针排序的单元，向外法向量是 $+90^\\circ$ 旋转。\n- 二维散度定理（格林-高斯定理）对于边界为 $\\partial \\Omega$ 的闭合多边形 $\\Omega$ 意味着 $$\\oint_{\\partial \\Omega} \\mathbf{n}\\, ds = \\mathbf{0},$$ 其中 $\\mathbf{n}$ 是向外单位法向量， $ds$ 是微分弧长。在多边形的离散情况下，这变为 $$\\sum_{i=0}^{m-1} \\mathbf{n}_i\\, L_i = \\mathbf{0}.$$\n- 单元中心定义为其顶点坐标的算术平均值，$$\\mathbf{x}_c = \\frac{1}{m}\\sum_{i=0}^{m-1}\\mathbf{x}_i.$$\n- 边 $i$ 的面心是其中点 $$\\mathbf{x}_{f,i} = \\frac{1}{2}\\left(\\mathbf{x}_i + \\mathbf{x}_{i+1 \\bmod m}\\right).$$\n- 单元 $c$ 的边 $i$ 的正交质量为 $$q_i = \\frac{\\left|\\left(\\mathbf{x}_{f,i} - \\mathbf{x}_c\\right)\\cdot \\mathbf{n}_i\\right|}{\\left\\|\\mathbf{x}_{f,i} - \\mathbf{x}_c\\right\\|},$$ 其值在 $[0,1]$ 范围内，用于量化从单元中心到面心的向量与面法向量之间的对齐程度。每个单元的正交质量是其所有边中最小的 $q_i$，即 $$q_c = \\min_i q_i.$$\n- 单元 $c$ 的边 $i$ 的偏斜度定义为从单元中心到面心的向量的切向分量的模，并用局部边的长度进行归一化，$$s_i = \\frac{\\left\\|\\left(\\mathbf{x}_{f,i} - \\mathbf{x}_c\\right) - \\left(\\left(\\mathbf{x}_{f,i} - \\mathbf{x}_c\\right)\\cdot \\mathbf{n}_i\\right)\\mathbf{n}_i\\right\\|}{L_i}.$$ 每个单元的偏斜度是其所有边中最大的 $s_i$，$$s_c = \\max_i s_i.$$\n- 每个单元的纵横比为 $$\\text{AR}_c = \\frac{\\max_i L_i}{\\min_i L_i}.$$\n\n您必须使用以下数据表示法：\n\n- 点数组 $P$ 是一个形状为 $(N,2)$ 的笛卡尔坐标数组，单位为米。\n- 单元连接的压缩稀疏行表示由两个整数数组组成：长度为 $n\\_cells + 1$ 的 $cell\\_ptr$ 和长度等于所有单元顶点引用总数的 $cell\\_indices$。对于单元 $k \\in \\{0,1,\\dots,n\\_cells-1\\}$，其在 $P$ 中的顶点索引由切片 $cell\\_indices[cell\\_ptr[k]:cell\\_ptr[k+1]]$ 给出。\n\n您的算法必须为每个测试用例执行以下任务：\n\n- 对于每个单元，利用 $A_c$ 的符号选择正确的旋转方向，为所有边计算向外单位法向量 $\\mathbf{n}_i$。\n- 对于每个单元，通过检查 $$\\frac{\\left\\|\\sum_i \\mathbf{n}_i L_i\\right\\|}{\\sum_i L_i}  \\varepsilon,$$ (其中 $\\varepsilon = 10^{-12}$) 来执行闭环测试，每个单元产生一个布尔值。所有单元都必须通过测试，该测试用例的闭环一致性才能报告为真。\n- 对于每个由恰好两个单元共享的无向内部面，验证两个向外单位法向量是否相反，即 $$\\left|\\mathbf{n}^{(a)}\\cdot \\mathbf{n}^{(b)} + 1\\right|  \\delta,$$ (其中 $\\delta = 10^{-12}$)，每个共享面产生一个布尔值。所有共享面都必须通过测试，该测试用例的方向一致性才能报告为真。\n- 计算每个单元的正交质量 $q_c$、纵横比 $\\text{AR}_c$ 和偏斜度 $s_c$，并按测试用例进行如下聚合：所有单元中的最小正交质量、所有单元中的最大纵横比以及所有单元中的最大偏斜度。\n\n您的程序必须生成单行输出，其中包含每个测试用例的一个条目，每个条目是一个包含五个值的列表，顺序为：闭环一致性布尔值、方向一致性布尔值、所有单元中的最小正交质量（浮点数）、所有单元中的最大纵横比（浮点数）和所有单元中的最大偏斜度（浮点数）。输出必须是包含在方括号中的逗号分隔列表。例如，输出格式必须类似于 $[\\,[b_1, b_2, r_1, r_2, r_3],\\,[\\dots],\\,[\\dots]\\,]$，其中包含布尔值和浮点数。\n\n使用以下由点坐标（单位：米）和 CSR 数组定义的网格测试套件：\n\n- 测试用例 1（两个相邻的单位正方形）：\n  - 点 $P^{(1)} = \\{(0,0),(1,0),(2,0),(0,1),(1,1),(2,1)\\}$（单位：米）。\n  - $cell\\_ptr^{(1)} = [0,4,8]$。\n  - $cell\\_indices^{(1)} = [0,1,4,3,1,2,5,4]$。\n\n- 测试用例 2（一个细长矩形与一个三角形相邻，矩形顶点按顺时针顺序列出）：\n  - 点 $P^{(2)} = \\{(0,0),(2,0),(2,0.2),(0,0.2),(3,0.1)\\}$（单位：米）。\n  - $cell\\_ptr^{(2)} = [0,4,7]$。\n  - $cell\\_indices^{(2)} = [0,3,2,1,1,4,2]$。\n\n- 测试用E例 3（一个凹五边形）：\n  - 点 $P^{(3)} = \\{(0,0),(1,0),(0.6,0.3),(1,1),(0,1)\\}$（单位：米）。\n  - $cell\\_ptr^{(3)} = [0,5]$。\n  - $cell\\_indices^{(3)} = [0,1,2,3,4]$。\n\n所有数组都是 0 索引的。角度不被报告，因此输出中不需要角度单位。内部计算的所有几何量必须与输入单位（米）一致，但报告的正交性、纵横比、偏斜度和相对闭环误差是无量纲的。您的程序必须产生上文指定的精确单行输出格式，并且不得读取外部输入。", "solution": "该问题要求设计并实现一个算法，用于计算由点坐标和单元连接性定义的二维网格的各种几何属性和质量度量。该算法必须从欧几里得几何和向量微积分的第一性原理推导得出，特别是二维散度定理。解决方案首先验证问题陈述，该陈述在科学上是合理的、适定的和完整的。\n\n算法的核心是遍历网格中的每个单元，并对每个单元遍历其所有的面（边）。对于每个单元，我们首先确定其方向（顺时针或逆时针），以便为其每个面正确计算出向外的单位法向量。然后，这些法向量将用于两个一致性检查和网格质量度量的计算。\n\n**1. 单元处理和面信息提取**\n\n网格以压缩稀疏行（CSR）格式提供，这是一种表示稀疏连接性的高效方式。对于每个单元 $c$，其顶点索引使用 `cell_ptr` 数组中提供的偏移量从 `cell_indices` 数组中提取。然后从点数组 $P$ 中检索这些顶点 $\\{\\mathbf{x}_0, \\mathbf{x}_1, \\dots, \\mathbf{x}_{m-1}\\}$ 的笛卡尔坐标。\n\n**2. 方向和向外法向量计算**\n\n单元顶点的方向对于区分向内和向外方向至关重要。我们使用鞋带公式计算单元多边形的有向面积 $A_c$：\n$$A_c = \\frac{1}{2}\\sum_{i=0}^{m-1} (x_i y_{i+1 \\bmod m} - x_{i+1 \\bmod m} y_i)$$\n严格为正的面积 ($A_c > 0$) 表示顶点为逆时针 (CCW) 排序，而严格为负的面积 ($A_c  0$) 表示顺时针 (CW) 排序。\n\n对于由顶点 $\\mathbf{x}_i$ 和 $\\mathbf{x}_{i+1 \\bmod m}$ 定义的单元的每个面 $i$，我们定义边向量 $\\mathbf{e}_i = \\mathbf{x}_{i+1 \\bmod m} - \\mathbf{x}_i = (e_{ix}, e_{iy})$。向外单位法向量 $\\mathbf{n}_i$ 是通过将 $\\mathbf{e}_i$ 旋转 $\\pm 90^\\circ$ 并进行归一化得到的。旋转方向取决于单元的方向，具体如下：\n- 对于逆时针单元，向外法向量对应于边向量的 $-90^\\circ$ 旋转：旋转后的向量是 $(e_{iy}, -e_{ix})$。\n- 对于顺时针单元，向外法向量对应于 $+90^\\circ$ 旋转：旋转后的向量是 $(-e_{iy}, e_{ix})$。\n\n然后将所得向量归一化为单位长度：$\\mathbf{n}_i = \\frac{\\mathbf{e}_i^{\\perp}}{\\|\\mathbf{e}_i\\|}$，其中 $\\mathbf{e}_i^{\\perp}$ 是适当旋转后的向量，而 $L_i = \\|\\mathbf{e}_i\\|$ 是面的长度。\n\n**3. 一致性验证**\n\n执行两种类型的一致性检查：\n\n- **闭环测试（每个单元）**：应用于恒定向量场的二维散度定理意味着，对于任何闭合多边形，由面长度缩放的向外法向量之和必须为零向量。在离散情况下，即为 $\\sum_{i=0}^{m-1} \\mathbf{n}_i L_i = \\mathbf{0}$。我们通过检查每个单元的相对误差是否低于一个小的容差 $\\varepsilon = 10^{-12}$ 来验证这一点：\n$$ \\frac{\\left\\|\\sum_{i=0}^{m-1} \\mathbf{n}_i L_i\\right\\|}{\\sum_{i=0}^{m-1} L_i}  \\varepsilon $$\n只有当所有单元都通过此测试时，整个网格的布尔标志才设置为真。\n\n- **方向一致性测试（针对共享面）**：为了使网格对于有限体积法等计算有效，一个面在一个单元中的向外法向量必须与它在相邻单元中的向外法向量大小相等、方向相反。为了检查这一点，我们首先识别所有唯一的内部面。一个面可以通过其顶点索引的排序元组来唯一识别。我们构建一个从每个唯一面到包含它的单元及其相应计算出的向外法向量的映射。对于每个恰好由两个单元（例如单元 $(a)$ 和单元 $(b)$）共享的面，我们验证它们的法向量 $\\mathbf{n}^{(a)}$ 和 $\\mathbf{n}^{(b)}$ 是反平行的。通过确保它们的点积接近 $-1$ 来检查这一点：\n$$ \\left|\\mathbf{n}^{(a)} \\cdot \\mathbf{n}^{(b)} + 1\\right|  \\delta $$\n容差为 $\\delta = 10^{-12}$。如果所有共享面都通过此测试，则全局布尔标志为真。如果没有共享面，则此条件自然成立。\n\n**4. 网格质量度量计算**\n\n对于每个单元 $c$，根据单元中心、面心和面法向量之间的几何关系计算一组质量度量。\n\n- **单元中心和面心**：单元中心 $\\mathbf{x}_c$ 是其顶点坐标的算术平均值。面 $i$ 的中心 $\\mathbf{x}_{f,i}$ 是其顶点的中点。\n\n- **纵横比 ($AR_c$)**：此度量衡量单元的伸长程度，定义为单元内最大面长度与最小面长度之比：\n$$ \\text{AR}_c = \\frac{\\max_i L_i}{\\min_i L_i} $$\n\n- **正交质量 ($q_c$)**：此度量量化了连接单元中心和面中心的向量与面法向量的对齐程度。对于每个面 $i$，质量 $q_i$ 是向量 $\\mathbf{v}_i = \\mathbf{x}_{f,i} - \\mathbf{x}_c$ 与法向量 $\\mathbf{n}_i$ 之间夹角的余弦绝对值：\n$$ q_i = \\frac{\\left|\\mathbf{v}_i \\cdot \\mathbf{n}_i\\right|}{\\left\\|\\mathbf{v}_i\\right\\|} $$\n单元的正交质量 $q_c$ 是其所有面中这些值的最小值，即 $q_c = \\min_i q_i$。理想值为 $1$。\n\n- **偏斜度 ($s_c$)**：此度量量化了与正交性的偏离程度。对于每个面 $i$，偏斜度 $s_i$ 是向量 $\\mathbf{v}_i$ 的切向分量的模，并用面长度 $L_i$ 进行归一化。切向分量是减去法向分量后剩余的部分：$\\mathbf{v}_{i, \\text{tan}} = \\mathbf{v}_i - (\\mathbf{v}_i \\cdot \\mathbf{n}_i) \\mathbf{n}_i$。\n$$ s_i = \\frac{\\|\\mathbf{v}_{i, \\text{tan}}\\|}{L_i} $$\n单元的偏斜度 $s_c$ 是其所有面中这些值的最大值，即 $s_c = \\max_i s_i$。理想值为 $0$。\n\n**5. 聚合与输出**\n\n最后，在处理完网格中的所有单元后，将结果聚合为整个测试用例的最终结果：总体的闭环一致性布尔值、总体的方向一致性布尔值、所有单元中的最小正交质量、所有单元中的最大纵横比以及所有单元中的最大偏斜度。这五个值组成一个列表，最终输出是所有测试用例的这些列表的列表，格式如前所述。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main driver function to process all test cases and print the final results.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"P\": np.array([[0.0, 0.0], [1.0, 0.0], [2.0, 0.0], [0.0, 1.0], [1.0, 1.0], [2.0, 1.0]]),\n            \"cell_ptr\": np.array([0, 4, 8]),\n            \"cell_indices\": np.array([0, 1, 4, 3, 1, 2, 5, 4]),\n        },\n        {\n            \"P\": np.array([[0.0, 0.0], [2.0, 0.0], [2.0, 0.2], [0.0, 0.2], [3.0, 0.1]]),\n            \"cell_ptr\": np.array([0, 4, 7]),\n            \"cell_indices\": np.array([0, 3, 2, 1, 1, 4, 2]),\n        },\n        {\n            \"P\": np.array([[0.0, 0.0], [1.0, 0.0], [0.6, 0.3], [1.0, 1.0], [0.0, 1.0]]),\n            \"cell_ptr\": np.array([0, 5]),\n            \"cell_indices\": np.array([0, 1, 2, 3, 4]),\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = process_mesh(case[\"P\"], case[\"cell_ptr\"], case[\"cell_indices\"])\n        all_results.append(result)\n\n    # Format the final output string\n    # Using str(list) will produce the required output format, including 'True'/'False' for booleans.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\ndef process_mesh(P, cell_ptr, cell_indices):\n    \"\"\"\n    Processes a single mesh to compute consistency and quality metrics.\n    \"\"\"\n    n_cells = len(cell_ptr) - 1\n    \n    all_cell_closed_loop_ok = []\n    all_cell_orthogonality = []\n    all_cell_aspect_ratio = []\n    all_cell_skewness = []\n    \n    face_map = {}  # Maps face_key -> list of {cell_id, normal}\n\n    eps = 1e-12\n    delta = 1e-12\n\n    for i_cell in range(n_cells):\n        vert_indices = cell_indices[cell_ptr[i_cell]:cell_ptr[i_cell + 1]]\n        verts = P[vert_indices]\n        m = len(verts)\n\n        # 1. Compute signed area to determine orientation\n        x = verts[:, 0]\n        y = verts[:, 1]\n        area = 0.5 * np.sum(x * np.roll(y, -1) - np.roll(x, -1) * y)\n        \n        # Determine rotation for outward normal based on orientation\n        # +1 for CCW (-90 deg rot), -1 for CW (+90 deg rot)\n        orientation_sign = np.sign(area)\n        \n        cell_centroid = np.mean(verts, axis=0)\n        \n        sum_normal_len = np.zeros(2)\n        sum_len = 0.0\n        face_lengths = []\n        face_orthogonalities = []\n        face_skewnesses = []\n\n        for i_face in range(m):\n            p1_idx, p2_idx = vert_indices[i_face], vert_indices[(i_face + 1) % m]\n            p1, p2 = verts[i_face], verts[(i_face + 1) % m]\n            \n            edge_vec = p2 - p1\n            edge_len = np.linalg.norm(edge_vec)\n            face_lengths.append(edge_len)\n\n            if edge_len  eps:\n                # Degenerate face, assign default bad/neutral values\n                face_orthogonalities.append(0.0)\n                face_skewnesses.append(np.inf)\n                continue\n\n            # 2. Compute outward unit normal\n            if orientation_sign > 0:  # CCW\n                normal_vec = np.array([edge_vec[1], -edge_vec[0]])\n            else:  # CW\n                normal_vec = np.array([-edge_vec[1], edge_vec[0]])\n            \n            unit_normal = normal_vec / edge_len\n            \n            # For closed-loop test\n            sum_normal_len += unit_normal * edge_len\n            sum_len += edge_len\n            \n            # Store face info for consistency check\n            face_key = tuple(sorted((p1_idx, p2_idx)))\n            if face_key not in face_map:\n                face_map[face_key] = []\n            face_map[face_key].append({\"cell_id\": i_cell, \"normal\": unit_normal})\n            \n            # 3. Compute quality metrics for the face\n            face_centroid = 0.5 * (p1 + p2)\n            centroid_to_face_vec = face_centroid - cell_centroid\n            ctf_vec_norm = np.linalg.norm(centroid_to_face_vec)\n            \n            if ctf_vec_norm  eps:\n                # Cell centroid coincides with face centroid, perfect orthogonality\n                face_orthogonalities.append(1.0)\n                face_skewnesses.append(0.0)\n                continue\n\n            # Orthogonality\n            ortho = abs(np.dot(centroid_to_face_vec, unit_normal)) / ctf_vec_norm\n            face_orthogonalities.append(ortho)\n\n            # Skewness\n            tangential_vec = centroid_to_face_vec - (np.dot(centroid_to_face_vec, unit_normal) * unit_normal)\n            skew = np.linalg.norm(tangential_vec) / edge_len\n            face_skewnesses.append(skew)\n\n        # 4. Per-cell aggregation\n        if sum_len  eps:\n            all_cell_closed_loop_ok.append(True) # Degenerate cell is trivially closed\n        else:\n            closed_loop_error = np.linalg.norm(sum_normal_len) / sum_len\n            all_cell_closed_loop_ok.append(closed_loop_error  eps)\n\n        min_face_len = np.min(face_lengths) if face_lengths else 0.0\n        max_face_len = np.max(face_lengths) if face_lengths else 0.0\n        \n        aspect_ratio = max_face_len / min_face_len if min_face_len > eps else np.inf\n        all_cell_aspect_ratio.append(aspect_ratio)\n        \n        all_cell_orthogonality.append(np.min(face_orthogonalities) if face_orthogonalities else 0.0)\n        all_cell_skewness.append(np.max(face_skewnesses) if face_skewnesses else np.inf)\n\n    # 5. Final aggregation for the whole mesh\n    \n    # Closed-loop consistency\n    mesh_closed_loop_ok = all(all_cell_closed_loop_ok)\n    \n    # Orientation consistency\n    mesh_orientation_ok = True\n    num_shared_faces = 0\n    for face_key, owners in face_map.items():\n        if len(owners) == 2:\n            num_shared_faces += 1\n            n1 = owners[0][\"normal\"]\n            n2 = owners[1][\"normal\"]\n            if abs(np.dot(n1, n2) + 1.0) >= delta:\n                mesh_orientation_ok = False\n                break\n    if num_shared_faces == 0:\n        mesh_orientation_ok = True # Vacuously true\n\n    min_ortho = np.min(all_cell_orthogonality) if all_cell_orthogonality else 1.0\n    max_ar = np.max(all_cell_aspect_ratio) if all_cell_aspect_ratio else 1.0\n    max_skew = np.max(all_cell_skewness) if all_cell_skewness else 0.0\n    \n    return [mesh_closed_loop_ok, mesh_orientation_ok, min_ortho, max_ar, max_skew]\n\nsolve()\n```", "id": "3326657"}, {"introduction": "衡量网格质量的最终目的在于控制数值误差。本练习将通过一个具体的案例，深入剖析网格几何缺陷如何直接转化为数值解的误差。您将分析一个非平面的六面体单元面，并从第一性原理推导面翘曲度（warpage）与通量计算误差之间的定量关系。通过这项分析 ([@problem_id:3326674])，您将清晰地看到为何高质量的网格（例如具有平整的面）对于获得可靠的CFD仿真结果至关重要。", "problem": "在计算流体动力学 (CFD) 的有限体积法 (FVM) 中，一个六面体控制体有一个非平面的四边形面，其四个顶点在局部笛卡尔坐标系中由以下坐标给出：\n- $\\mathbf{r}_{-1,-1} = \\left(-\\frac{L}{2}, -\\frac{L}{2}, h\\right)$,\n- $\\mathbf{r}_{1,-1} = \\left(\\frac{L}{2}, -\\frac{L}{2}, -h\\right)$,\n- $\\mathbf{r}_{-1,1} = \\left(-\\frac{L}{2}, \\frac{L}{2}, -h\\right)$,\n- $\\mathbf{r}_{1,1} = \\left(\\frac{L}{2}, \\frac{L}{2}, h\\right)$,\n\n其中 $L  0$ 且 $h \\in \\mathbb{R}$。该面是一个双线性鞍状面，其方形投影面的边长为 $L$，翘曲振幅为 $h$。将面翘曲度量 $\\omega$ 定义为面节点到最佳拟合平面的最大绝对法向距离；对于给定的对称鞍状面，$\\omega = |h|$。该面的纵横比为 $1$。\n\n设平流速度场在面上呈线性分布，由下式给出：\n$$\n\\mathbf{u}(\\mathbf{x}) = \\mathbf{u}_{c} + \\mathbf{J}\\,(\\mathbf{x} - \\mathbf{x}_{c}),\n$$\n其中 $\\mathbf{J} \\in \\mathbb{R}^{3 \\times 3}$ 是面上的一个恒定速度梯度，$\\mathbf{x}_{c}$ 是该面的双线性参数中心（即四个顶点的平均值）。精确的法向通量是面积分：\n$$\n\\Phi = \\iint_{\\mathcal{S}} \\mathbf{u}(\\mathbf{x}) \\cdot \\mathbf{n}(\\mathbf{x})\\,\\mathrm{d}S,\n$$\n其中 $\\mathcal{S}$ 是真实的非平面，$\\mathbf{n}(\\mathbf{x})\\,\\mathrm{d}S$ 是局部面积矢量。\n\n采用平面近似的有限体积法 (FVM) 将非平面替换为单个平面多边形，其面积矢量等于真实面的面积平均矢量，并通过下式计算通量：\n$$\n\\Phi_{\\mathrm{planar}} = \\mathbf{u}(\\mathbf{x}_{c}) \\cdot \\left(\\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A}\\right).\n$$\n\n仅从面积通量积分和面几何形状的双线性插值的定义出发，分析面翘曲如何传播到控制体面的非平面性，并推导通量误差大小的最小一致上界的闭式表达式：\n$$\n\\Delta \\Phi = \\Phi - \\Phi_{\\mathrm{planar}},\n$$\n该表达式应使用面尺寸 $L$、翘曲度量 $\\omega$ 和速度梯度 $\\mathbf{J}$ 的分量来表示。您的推导过程除了所述的平面近似外，不应使用任何特殊的求积法则，并且必须从面积分和双线性参数化的第一性原理出发。\n\n将该界报告为单个解析表达式 $B(L,\\omega,\\mathbf{J})$，使得对于指定的几何形状，有 $|\\Delta \\Phi| \\leq B(L,\\omega,\\mathbf{J})$。您的最终答案只能用 $L$、$\\omega$ 和 $\\mathbf{J}$ 的笛卡尔分量表示，并且不应包含任何单位。最终答案必须是单个闭式表达式，而不是不等式或方程式。", "solution": "在尝试任何解答之前，需要对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- **面顶点**:\n  - $\\mathbf{r}_{-1,-1} = \\left(-\\frac{L}{2}, -\\frac{L}{2}, h\\right)$\n  - $\\mathbf{r}_{1,-1} = \\left(\\frac{L}{2}, -\\frac{L}{2}, -h\\right)$\n  - $\\mathbf{r}_{-1,1} = \\left(-\\frac{L}{2}, \\frac{L}{2}, -h\\right)$\n  - $\\mathbf{r}_{1,1} = \\left(\\frac{L}{2}, \\frac{L}{2}, h\\right)$\n- **参数**: $L  0$, $h \\in \\mathbb{R}$。\n- **面几何形状**: 双线性鞍状面，方形投影面边长为 $L$，翘曲振幅为 $h$。\n- **翘曲度量**: $\\omega = |h|$。\n- **速度场**: $\\mathbf{u}(\\mathbf{x}) = \\mathbf{u}_{c} + \\mathbf{J}\\,(\\mathbf{x} - \\mathbf{x}_{c})$，其中 $\\mathbf{J}$ 是一个恒定的 $3 \\times 3$ 矩阵，$\\mathbf{x}_{c}$ 是该面的双线性参数中心。\n- **精确通量**: $\\Phi = \\iint_{\\mathcal{S}} \\mathbf{u}(\\mathbf{x}) \\cdot \\mathbf{n}(\\mathbf{x})\\,\\mathrm{d}S = \\iint_{\\mathcal{S}} \\mathbf{u}(\\mathbf{x}) \\cdot \\mathrm{d}\\mathbf{A}$。\n- **平面近似通量**: $\\Phi_{\\mathrm{planar}} = \\mathbf{u}(\\mathbf{x}_{c}) \\cdot \\left(\\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A}\\right)$。\n- **通量误差**: $\\Delta \\Phi = \\Phi - \\Phi_{\\mathrm{planar}}$。\n- **目标**: 推导通量误差大小的最小一致上界的闭式表达式 $B(L,\\omega,\\mathbf{J})$，使得 $|\\Delta \\Phi| \\leq B(L,\\omega,\\mathbf{J})$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据、是适定的、客观且自洽的。它描述了CFD方法数值分析中的一个标准问题，具体而言，是在计算通量时由几何近似（非平面性）引入的误差。几何实体（双线性曲面）、物理量（通量）和误差的定义都是标准的并且在数学上是精确的。诸如线性速度场之类的假设是常见的，并且适用于此类分析。没有违反任何科学原理，数据是一致的，目标是明确定义的。\n\n### 第3步：结论与行动\n该问题是 **有效的**。将按要求从第一性原理推导解答。\n\n### 推导过程\n推导过程首先对非平面进行参数化，然后将通量误差表示为面积分，最后计算该积分以求其大小。\n\n**1. 曲面参数化**\n非平面是一个由其四个角顶点定义的双线性曲面。我们可以使用带有局部坐标 $\\xi, \\eta \\in [-1, 1]$ 的参数化表示来描述曲面上的任意点 $\\mathbf{r}$。标准的双线性插值公式为：\n$$\n\\mathbf{r}(\\xi, \\eta) = \\frac{1}{4} \\left[ (1-\\xi)(1-\\eta)\\mathbf{r}_{-1,-1} + (1+\\xi)(1-\\eta)\\mathbf{r}_{1,-1} + (1-\\xi)(1+\\eta)\\mathbf{r}_{-1,1} + (1+\\xi)(1+\\eta)\\mathbf{r}_{1,1} \\right]\n$$\n设 $\\mathbf{r}$ 的笛卡尔分量为 $(x, y, z)$。代入给定的顶点坐标：\n对于 $x$ 分量：\n$$\nx(\\xi, \\eta) = \\frac{1}{4} \\left[ (1-\\xi)(1-\\eta)(-\\frac{L}{2}) + (1+\\xi)(1-\\eta)(\\frac{L}{2}) + (1-\\xi)(1+\\eta)(-\\frac{L}{2}) + (1+\\xi)(1+\\eta)(\\frac{L}{2}) \\right]\n$$\n提出因子 $\\frac{L}{4}$，我们得到：\n$$\nx(\\xi, \\eta) = \\frac{L}{4} \\left[ -(1-\\xi)(1-\\eta) + (1+\\xi)(1-\\eta) - (1-\\xi)(1+\\eta) + (1+\\xi)(1+\\eta) \\right] = \\frac{L}{4} \\left[ (1-\\eta)(-(1-\\xi) + (1+\\xi)) + (1+\\eta)(-(1-\\xi) + (1+\\xi)) \\right]\n$$\n$$\nx(\\xi, \\eta) = \\frac{L}{4} \\left[ (1-\\eta)(2\\xi) + (1+\\eta)(2\\xi) \\right] = \\frac{L\\xi}{2} (1-\\eta+1+\\eta) = \\frac{L}{2}\\xi\n$$\n类似地，对于 $y$ 分量：\n$$\ny(\\xi, \\eta) = \\frac{1}{4} \\left[ (1-\\xi)(1-\\eta)(-\\frac{L}{2}) + (1+\\xi)(1-\\eta)(-\\frac{L}{2}) + (1-\\xi)(1+\\eta)(\\frac{L}{2}) + (1+\\xi)(1+\\eta)(\\frac{L}{2}) \\right] = \\frac{L}{2}\\eta\n$$\n对于 $z$ 分量：\n$$\nz(\\xi, \\eta) = \\frac{1}{4} \\left[ (1-\\xi)(1-\\eta)(h) + (1+\\xi)(1-\\eta)(-h) + (1-\\xi)(1+\\eta)(-h) + (1+\\xi)(1+\\eta)(h) \\right]\n$$\n$$\nz(\\xi, \\eta) = \\frac{h}{4} \\left[ (1-\\xi)(1-\\eta) - (1+\\xi)(1-\\eta) - (1-\\xi)(1+\\eta) + (1+\\xi)(1+\\eta) \\right]\n$$\n$$\nz(\\xi, \\eta) = \\frac{h}{4} \\left[ (1-\\eta)((1-\\xi)-(1+\\xi)) + (1+\\eta)(-(1-\\xi)+(1+\\xi)) \\right] = \\frac{h}{4} [ (1-\\eta)(-2\\xi) + (1+\\eta)(2\\xi) ]\n$$\n$$\nz(\\xi, \\eta) = \\frac{h\\xi}{2} (-(1-\\eta) + (1+\\eta)) = \\frac{h\\xi}{2} (-1+\\eta+1+\\eta) = h\\xi\\eta\n$$\n因此，曲面的参数化表示为 $\\mathbf{r}(\\xi, \\eta) = \\left( \\frac{L}{2}\\xi, \\frac{L}{2}\\eta, h\\xi\\eta \\right)$。\n\n**2. 通量误差表达式**\n面的参数中心 $\\mathbf{x}_c$ 对应于 $\\xi=0, \\eta=0$，这给出 $\\mathbf{x}_{c} = \\mathbf{r}(0,0) = (0, 0, 0)$。\n速度场为 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{u}_{c} + \\mathbf{J}(\\mathbf{x} - \\mathbf{x}_{c}) = \\mathbf{u}_{c} + \\mathbf{J}\\mathbf{x}$，因为 $\\mathbf{x}_c = \\mathbf{0}$。\n近似通量为 $\\Phi_{\\mathrm{planar}} = \\mathbf{u}(\\mathbf{x}_{c}) \\cdot \\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A} = \\mathbf{u}_{c} \\cdot \\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A}$。\n通量误差为 $\\Delta \\Phi = \\Phi - \\Phi_{\\mathrm{planar}}$：\n$$\n\\Delta \\Phi = \\iint_{\\mathcal{S}} \\left( \\mathbf{u}_{c} + \\mathbf{J}\\mathbf{x} \\right) \\cdot \\mathrm{d}\\mathbf{A} - \\mathbf{u}_{c} \\cdot \\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A}\n$$\n根据积分的线性性质：\n$$\n\\Delta \\Phi = \\mathbf{u}_{c} \\cdot \\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A} + \\iint_{\\mathcal{S}} (\\mathbf{J}\\mathbf{x}) \\cdot \\mathrm{d}\\mathbf{A} - \\mathbf{u}_{c} \\cdot \\iint_{\\mathcal{S}} \\mathrm{d}\\mathbf{A}\n$$\n$$\n\\Delta \\Phi = \\iint_{\\mathcal{S}} (\\mathbf{J}\\mathbf{x}) \\cdot \\mathrm{d}\\mathbf{A}\n$$\n该积分必须在参数域上进行计算。微分面积矢量 $\\mathrm{d}\\mathbf{A}$ 由切向量的叉积给出：\n$\\mathrm{d}\\mathbf{A} = \\left( \\frac{\\partial \\mathbf{r}}{\\partial \\xi} \\times \\frac{\\partial \\mathbf{r}}{\\partial \\eta} \\right) \\mathrm{d}\\xi \\mathrm{d}\\eta$。\n切向量为：\n$$\n\\frac{\\partial \\mathbf{r}}{\\partial \\xi} = \\left( \\frac{L}{2}, 0, h\\eta \\right) \\quad \\text{和} \\quad \\frac{\\partial \\mathbf{r}}{\\partial \\eta} = \\left( 0, \\frac{L}{2}, h\\xi \\right)\n$$\n它们的叉积是：\n$$\n\\frac{\\partial \\mathbf{r}}{\\partial \\xi} \\times \\frac{\\partial \\mathbf{r}}{\\partial \\eta} = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ \\frac{L}{2}  0  h\\eta \\\\ 0  \\frac{L}{2}  h\\xi \\end{vmatrix} = \\mathbf{i}(0 - \\frac{Lh\\eta}{2}) - \\mathbf{j}(\\frac{Lh\\xi}{2} - 0) + \\mathbf{k}(\\frac{L^2}{4} - 0) = \\left( -\\frac{Lh\\eta}{2}, -\\frac{Lh\\xi}{2}, \\frac{L^2}{4} \\right)\n$$\n所以，$\\mathrm{d}\\mathbf{A} = \\left( -\\frac{Lh\\eta}{2}, -\\frac{Lh\\xi}{2}, \\frac{L^2}{4} \\right) \\mathrm{d}\\xi \\mathrm{d}\\eta$。\n在曲面上计算的矢量 $\\mathbf{J}\\mathbf{x}$ 是 $\\mathbf{J}\\mathbf{r}(\\xi, \\eta)$，其分量为：\n$$\n(\\mathbf{J}\\mathbf{x})_i = \\sum_{j=1}^{3} J_{ij} x_j = J_{i1}(\\frac{L}{2}\\xi) + J_{i2}(\\frac{L}{2}\\eta) + J_{i3}(h\\xi\\eta)\n$$\n被积函数是点积 $(\\mathbf{J}\\mathbf{x}) \\cdot \\mathrm{d}\\mathbf{A}$：\n$$\n\\left( J_{11}\\frac{L}{2}\\xi + J_{12}\\frac{L}{2}\\eta + J_{13}h\\xi\\eta \\right)\\left(-\\frac{Lh\\eta}{2}\\right) + \\left( J_{21}\\frac{L}{2}\\xi + J_{22}\\frac{L}{2}\\eta + J_{23}h\\xi\\eta \\right)\\left(-\\frac{Lh\\xi}{2}\\right) + \\left( J_{31}\\frac{L}{2}\\xi + J_{32}\\frac{L}{2}\\eta + J_{33}h\\xi\\eta \\right)\\left(\\frac{L^2}{4}\\right)\n$$\n我们在 $\\xi, \\eta \\in [-1, 1]$ 上对该表达式进行积分。由于积分域的对称性，任何包含 $\\xi$ 或 $\\eta$ 奇数次幂的项的积分为零。例如，如果 $m$ 是奇数，则 $\\int_{-1}^{1}\\xi^m d\\xi = 0$。\n让我们展开被积函数，并找出积分后不会消失的项（即 $\\xi$ 和 $\\eta$ 的幂次均为偶数的项）。\n$$\n\\text{Integrand} = -\\frac{L^2h}{4}J_{11}\\xi\\eta - \\frac{L^2h}{4}J_{12}\\eta^2 - \\frac{Lh^2}{2}J_{13}\\xi\\eta^2 - \\frac{L^2h}{4}J_{21}\\xi^2 - \\frac{L^2h}{4}J_{22}\\xi\\eta - \\frac{Lh^2}{2}J_{23}\\xi^2\\eta + \\frac{L^3}{8}J_{31}\\xi + \\frac{L^3}{8}J_{32}\\eta + \\frac{L^2h}{4}J_{33}\\xi\\eta\n$$\n积分后保留下来的项是与 $\\xi^0\\eta^2 = \\eta^2$ 和 $\\xi^2\\eta^0 = \\xi^2$ 成比例的项：\n$$\n-\\frac{L^2h}{4}J_{xy}\\eta^2 - \\frac{L^2h}{4}J_{yx}\\xi^2\n$$\n问题使用 $x,y,z$ 作为 $\\mathbf{J}$ 分量的索引，因此 $J_{12} = J_{xy}$ 且 $J_{21}=J_{yx}$。\n通量误差为：\n$$\n\\Delta \\Phi = \\int_{-1}^{1} \\int_{-1}^{1} \\left( -\\frac{L^2h}{4}J_{xy}\\eta^2 - \\frac{L^2h}{4}J_{yx}\\xi^2 \\right) \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n$$\n\\Delta \\Phi = -\\frac{L^2h}{4}J_{xy} \\left(\\int_{-1}^{1} \\mathrm{d}\\xi\\right) \\left(\\int_{-1}^{1} \\eta^2 \\mathrm{d}\\eta\\right) - \\frac{L^2h}{4}J_{yx} \\left(\\int_{-1}^{1} \\xi^2 \\mathrm{d}\\xi\\right) \\left(\\int_{-1}^{1} \\mathrm{d}\\eta\\right)\n$$\n我们计算基本积分：\n$$\n\\int_{-1}^{1} \\mathrm{d}\\xi = 2\n$$\n$$\n\\int_{-1}^{1} \\xi^2 \\mathrm{d}\\xi = \\left[ \\frac{\\xi^3}{3} \\right]_{-1}^{1} = \\frac{1}{3} - (-\\frac{1}{3}) = \\frac{2}{3}\n$$\n代入这些结果：\n$$\n\\Delta \\Phi = -\\frac{L^2h}{4}J_{xy} (2) \\left(\\frac{2}{3}\\right) - \\frac{L^2h}{4}J_{yx} \\left(\\frac{2}{3}\\right) (2)\n$$\n$$\n\\Delta \\Phi = -\\frac{L^2h}{3}J_{xy} - \\frac{L^2h}{3}J_{yx} = -\\frac{L^2h}{3} (J_{xy} + J_{yx})\n$$\n\n**3. 上界表达式**\n问题要求通量误差大小 $|\\Delta \\Phi|$ 的最小一致上界。\n$$\n|\\Delta \\Phi| = \\left| -\\frac{L^2h}{3} (J_{xy} + J_{yx}) \\right| = \\frac{L^2 |h|}{3} |J_{xy} + J_{yx}|\n$$\n使用给定的翘曲度量 $\\omega = |h|$，我们得到：\n$$\n|\\Delta \\Phi| = \\frac{L^2 \\omega}{3} |J_{xy} + J_{yx}|\n$$\n对于给定的几何形状和速度场，此表达式给出了通量误差的精确大小。最小一致上界 $B(L, \\omega, \\mathbf{J})$ 就是这个大小本身，因为它提供了可能的最紧的界。\n$$\nB(L, \\omega, \\mathbf{J}) = \\frac{L^2 \\omega}{3} |J_{xy} + J_{yx}|\n$$\n\n这个最终表达式表明，对于线性速度场，由非平面性引起的通量误差与面尺寸的平方 $L^2$、翘曲度量 $\\omega$ 以及速度梯度张量在面投影平面内的剪切分量之和 $J_{xy} + J_{yx}$ 成正比。", "answer": "$$ \\boxed{\\frac{L^2 \\omega}{3} |J_{xy} + J_{yx}|} $$", "id": "3326674"}]}