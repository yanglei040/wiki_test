{"hands_on_practices": [{"introduction": "Rhie-Chow动量插值法的核心目标是在同位网格上抑制压力-速度解耦。本练习通过一个含有振荡压力场的人工解，旨在分离并分析Rhie-Chow修正项的阻尼效应。通过解析推导阻尼与波数的标度关系并进行数值验证[@problem_id:3358660]，您将深刻且定量地理解该插值格式如何抑制非物理的“棋盘格”压力模式。", "problem": "本题要求您分析、推导并数值验证 Rhie–Chow 动量插值（Rhie–Chow (RC)）在一维、均匀、同位网格有限体积离散化下，对稳态不可压缩流中的虚假压力-速度解耦模式的阻尼作用。从牛顿、常密度流体的稳态一维动量平衡方程出发，其连续形式为 $0 = -\\partial p/\\partial x + f(x) + \\nu \\, \\partial^2 u/\\partial x^2$，其中 $p$ 是压力，$u$ 是与 $x$ 轴同向的速度分量，$f(x)$ 是单位体积的体积力，$\\nu$ 是运动粘度。通过指定一个振荡压力 $p(x)=p_0+\\epsilon \\cos(k x)$ 并选择 $f(x)$ 使得在连续方程中 $-\\partial p/\\partial x + f(x) = 0$ 精确成立，构造一个允许均匀目标速度 $u^\\star$ 的制造解。考虑一个无量纲长度为 $L=2\\pi$ 的均匀周期性域，该域被 $N$ 个间距均匀 ($\\Delta x = L/N$) 的同位控制体离散化，并采用周期性边界条件。\n\n在同位网格上，定义以下离散量：单元中心由整数 $j\\in \\{0,1,\\dots,N-1\\}$ 索引，面位于 $x_{j+1/2} = x_j + \\Delta x/2$，索引采用周期性规则。设离散压力场为 $p_j = p_0 + \\epsilon \\cos(k x_j)$，其中 $k$ 为整数空间频率，使得 $kL$ 是 $2\\pi$ 的倍数。考虑仅由离散压力梯度引起的面法向速度贡献，忽略所有其他项（即，假设齐次解的贡献为常数且可被精确插值）。为简化起见，使用无量纲 Rhie–Chow 缩放因子 $D=1$，这对应于单位逆动量系数。然后：\n- 将位于面 $f=j+1/2$ 处的朴素（非 RC）面速度贡献定义为 $u^{\\mathrm{naive}}_f = - D \\, (p_{j+1}-p_j)/\\Delta x$。\n- 将 Rhie–Chow 面速度贡献定义为 $u^{\\mathrm{RC}}_f = - D \\, \\tfrac{1}{2}\\left(g_j + g_{j+1}\\right)$，它使用相邻单元中心梯度的平均值，其中 $g_j = (p_{j+1} - p_{j-1})/(2\\Delta x)$ 是单元 $j$ 处的中心差分梯度。\n\n此处，RC 对虚假模式的阻尼作用被量化为 RC 在可归因于压力梯度的面速度分量中引入的变化，即修正项 $u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f$。对于给定的 $\\epsilon$ 和波数 $k$，定义阻尼振幅为 $A_{\\mathrm{corr}}(k,\\epsilon) = \\max_f \\left|u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f\\right|$，以及归一化阻尼比 $R(k,\\epsilon) = A_{\\mathrm{corr}}(k,\\epsilon)/\\epsilon$。令 $\\theta = k \\Delta x$ 表示基于单元的无量纲波数。\n\n您的任务是：\n- 从第一性原理推导为什么 $u^{\\mathrm{naive}}_f$ 和 $u^{\\mathrm{RC}}_f$ 是同位网格上压力梯度对面速度贡献的恰当离散对应项，以及 RC 修正项如何抑制虚假的棋盘格模式。仅使用稳态动量平衡、均匀网格上的中心有限体积差分和线性插值概念。\n- 解析地展示 RC 修正项如何随无量纲波数 $\\theta$ 缩放，并确定在小 $\\theta$ 情况下，$R(k,\\epsilon)$ 相对于 $k \\Delta x$ 和 $\\epsilon$ 的渐近缩放关系。\n\n然后实现一个程序，对于 $L=2\\pi$ 和 $N=128$ 的单域配置，在制造压力场 $p_j = p_0 + \\epsilon \\cos(k x_j)$ 下，为以下整数模式集合 $m \\in \\{1,4,16,64\\}$（其中 $k=m$）和两个振幅 $\\epsilon \\in \\{10^{-6}, 10^{-3}\\}$ 数值计算 RC 修正项。使用周期性索引。对每对 $(m,\\epsilon)$:\n- 计算朴素面速度 $u^{\\mathrm{naive}}_f$ 和 RC 面速度 $u^{\\mathrm{RC}}_f$。\n- 计算归一化阻尼比 $R(m,\\epsilon)=A_{\\mathrm{corr}}(m,\\epsilon)/\\epsilon$，方法是取所有面上最大绝对修正值除以 $\\epsilon$。\n\n通过对 $\\log R$ 与 $\\log(k \\Delta x)$ 进行最小二乘拟合，估算在小 $k\\Delta x$ 时使得 $R \\propto (k\\Delta x)^n$ 成立的缩放指数 $n$。拟合时仅使用模式 $m \\in \\{1,4,16\\}$（不包括 $m=64$）。对每个 $\\epsilon$ 值都执行一次，共执行两次。\n\n此外，通过计算四个模式中与完美线性的最大相对偏差，来量化 RC 修正项相对于 $\\epsilon$ 的线性度：\n$$\n\\delta_{\\mathrm{lin}} = \\max_{m \\in \\{1,4,16,64\\}} \\left| \\frac{A_{\\mathrm{corr}}(m,10^{-3})}{A_{\\mathrm{corr}}(m,10^{-6})} \\cdot \\frac{10^{-6}}{10^{-3}} - 1 \\right|.\n$$\n\n测试套件和要求的输出：\n- 使用 $N=128$，$L=2\\pi$，$D=1$，$m \\in \\{1,4,16,64\\}$，以及 $\\epsilon \\in \\{10^{-6},10^{-3}\\}$。\n- 您的程序必须输出单行，内容是一个用方括号括起来的逗号分隔列表，按顺序包含以下项目：\n    $[ n(10^{-6}), \\, n(10^{-3}), \\, R(1,10^{-6}), \\, R(4,10^{-6}), \\, R(16,10^{-6}), \\, R(64,10^{-6}), \\, R(1,10^{-3}), \\, R(4,10^{-3}), \\, R(16,10^{-3}), \\, R(64,10^{-3}), \\, \\delta_{\\mathrm{lin}} ]$。\n- 所有量都是无量纲的，角度隐含地以弧度为单位。最终输出应为浮点数。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,\\dots]$）。", "solution": "此问题经评估是有效的。这是一个关于 Rhie–Chow 动量插值格式数值分析的适定且有科学依据的练习，该格式是计算流体动力学（CFD）中的一种标准技术。问题陈述是自洽的，提供了完整的理论推导和数值验证所需的所有必要参数和定义。\n\n### Rhie–Chow 阻尼的理论分析\n\n#### 1. 同位网格上的压力-速度解耦\n稳态一维动量方程为 $0 = -\\partial p/\\partial x + f(x) + \\nu \\, \\partial^2 u/\\partial x^2$。在同位网格的有限体积法中，所有变量（压力 $p$、速度 $u$）都存储在单元中心 $x_j$（$j \\in \\{0, 1, \\dots, N-1\\}$）。离散动量方程将单元中心速度 $u_j$ 与压力梯度的数值近似以及其他项联系起来。单元 $j$ 处压力梯度的标准中心差分近似为 $(\\nabla p)_j = (p_{j+1} - p_{j-1})/(2\\Delta x)$。\n\n不可压缩流体的连续性方程 $\\partial u/\\partial x = 0$ 通过在控制体（单元 $j$）上积分进行离散化，得到 $u_{j+1/2} - u_{j-1/2} = 0$，其中 $u_{j\\pm 1/2}$ 是单元面上的速度。同位网格布置的核心问题是，单元中心的压力梯度 $(\\nabla p)_j$ 对压力场中的奇偶（棋盘格）振荡不敏感。例如，形式为 $p_j = C(-1)^j$ 的压力场会得到 $(\\nabla p)_j = (C(-1)^{j+1} - C(-1)^{j-1})/(2\\Delta x) = (C(-1)^{j+1} - C(-1)^{j+1})/(2\\Delta x) = 0$ 对所有 $j$ 成立。这样的压力场在离散动量方程中不会产生任何力，但它却是非均匀的。这使得虚假的、非物理的压力模式能够存在于解中，而不会被动量方程检测或修正，这种现象被称为压力-速度解耦。网格上可解析的最高频率模式，其无量纲波数为 $k\\Delta x = \\pi$，对应于这种棋盘格模式。\n\n#### 2. 朴素面速度与 Rhie–Chow 面速度\n为了保证连续性，需要面速度 $u_f$。这些速度必须从单元中心量插值得到。问题定义了两种计算压力梯度对面 $f=j+1/2$ 处面速度贡献的方法：\n\n- **朴素插值**：此方法使用最局域的可用离散压力梯度，该梯度定义在面本身上：\n$$ u^{\\mathrm{naive}}_f = - D \\frac{p_{j+1}-p_j}{\\Delta x} $$\n虽然简单，但当此方法在完整的压力修正算法的背景下使用时，并不能抑制虚假的压力模式。\n\n- **Rhie–Chow (RC) 插值**：Rhie–Chow 方法以一种明确引入阻尼机制的方式构造面速度。面速度中压力梯度的贡献是通过首先计算单元中心的压力梯度 $g_j = (p_{j+1}-p_{j-1})/(2\\Delta x)$ 和 $g_{j+1}$，然后将它们插值到面来计算的：\n$$ u^{\\mathrm{RC}}_f = - D \\frac{g_j + g_{j+1}}{2} $$\n这个过程有效地将一个点的压力与一个更宽的模板耦合起来，从而防止了解耦。\n\nRC 格式的基本阻尼机制体现在这两种公式之间的差异中。RC 修正项定义为差值 $\\Delta u_f = u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f$。在给定的逆动量系数 $D=1$ 下：\n$$ \\Delta u_{j+1/2} = \\left( -\\frac{1}{2} \\left[ \\frac{p_{j+1}-p_{j-1}}{2\\Delta x} + \\frac{p_{j+2}-p_j}{2\\Delta x} \\right] \\right) - \\left( -\\frac{p_{j+1}-p_j}{\\Delta x} \\right) $$\n在公分母 $4\\Delta x$ 上合并各项：\n$$ \\Delta u_{j+1/2} = \\frac{1}{4\\Delta x} \\left[ -(p_{j+1}-p_{j-1}) - (p_{j+2}-p_j) + 4(p_{j+1}-p_j) \\right] $$\n$$ \\Delta u_{j+1/2} = \\frac{1}{4\\Delta x} \\left[ -p_{j+2} + 3p_{j+1} - 3p_j + p_{j-1} \\right] $$\n这可以改写为：\n$$ \\Delta u_{j+1/2} = -\\frac{\\Delta x^2}{4} \\left[ \\frac{p_{j+2} - 3p_{j+1} + 3p_j - p_{j-1}}{\\Delta x^3} \\right] $$\n括号中的项是压力三阶导数 $\\partial^3 p/\\partial x^3$ 的有限差分近似。因此，RC 修正项等效于在面速度上增加一个与 $\\Delta x^2 (\\partial^3 p / \\partial x^3)$ 成比例的项。在完整的压力修正方程（如 SIMPLE）的背景下，该项有效地引入了一个四阶压力导数项，它在压力场上起到人工扩散的作用，从而阻尼高频振荡。\n\n#### 3. 正弦模式的解析缩放关系\n我们分析给定压力场 $p(x) = p_0 + \\epsilon \\cos(kx)$ 的修正项，其离散点上的形式为 $p_j = p_0 + \\epsilon\\cos(kx_j)$。使用三角恒等式可以简化分析。令 $\\theta = k\\Delta x$ 为基于单元的无量纲波数。\n\n朴素速度为：\n$$ u^{\\mathrm{naive}}_{j+1/2} = -\\frac{\\epsilon}{\\Delta x}[\\cos(k(x_j+\\Delta x)) - \\cos(kx_j)] = \\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin(k\\Delta x/2) $$\nRC 速度为：\n$$ u^{\\mathrm{RC}}_{j+1/2} = -\\frac{1}{2}(g_j + g_{j+1}) $$\n其中 $g_j = -\\frac{\\epsilon}{\\Delta x}\\sin(kx_j)\\sin(k\\Delta x)$。$g_j+g_{j+1}$ 的和变为：\n$$ g_j+g_{j+1} = -\\frac{\\epsilon}{\\Delta x}\\sin(k\\Delta x)[\\sin(kx_j) + \\sin(k(x_j+\\Delta x))] = -\\frac{2\\epsilon}{\\Delta x}\\sin(k\\Delta x)\\sin(k(x_j+\\Delta x/2))\\cos(k\\Delta x/2) $$\n所以，\n$$ u^{\\mathrm{RC}}_{j+1/2} = \\frac{\\epsilon}{\\Delta x}\\sin(k\\Delta x)\\sin(k(x_j+\\Delta x/2))\\cos(k\\Delta x/2) $$\n使用 $\\sin(k\\Delta x) = 2\\sin(k\\Delta x/2)\\cos(k\\Delta x/2)$，上式可简化为：\n$$ u^{\\mathrm{RC}}_{j+1/2} = \\frac{2\\epsilon}{\\Delta x}\\sin(k\\Delta x/2)\\cos^2(k\\Delta x/2)\\sin(k(x_j+\\Delta x/2)) $$\n修正项为 $\\Delta u_{j+1/2} = u^{\\mathrm{RC}}_{j+1/2} - u^{\\mathrm{naive}}_{j+1/2}$:\n$$ \\Delta u_{j+1/2} = \\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin(k\\Delta x/2)[\\cos^2(k\\Delta x/2) - 1] $$\n使用 $\\cos^2\\alpha - 1 = -\\sin^2\\alpha$:\n$$ \\Delta u_{j+1/2} = -\\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin^3(k\\Delta x/2) $$\n阻尼振幅是该修正项在所有面上的最大绝对值：\n$$ A_{\\mathrm{corr}}(k, \\epsilon) = \\max_f |\\Delta u_f| = \\frac{2\\epsilon}{\\Delta x}|\\sin^3(k\\Delta x/2)| $$\n因此，归一化阻尼比 $R(k,\\epsilon) = A_{\\mathrm{corr}}(k,\\epsilon)/\\epsilon$ 为：\n$$ R(k, \\epsilon) = \\frac{2}{\\Delta x}|\\sin^3(k\\Delta x/2)| $$\n\n#### 4. 渐近缩放与线性度\n$R(k, \\epsilon)$ 的表达式与压力振幅 $\\epsilon$ 无关。这表明 RC 修正机制在这种理想化形式下，相对于 $\\epsilon$ 是完全线性的。因此，线性度的数值测试 $\\delta_{\\mathrm{lin}}$ 预期为零（或在机器精度范围内）。\n\n对于小无量纲波数 $\\theta = k\\Delta x \\ll 1$ 下的渐近缩放，我们对小 $z$ 使用泰勒展开 $\\sin(z) \\approx z$。\n$$ R(k, \\epsilon) \\approx \\frac{2}{\\Delta x} \\left| \\left(\\frac{k\\Delta x}{2}\\right)^3 \\right| = \\frac{2}{\\Delta x} \\frac{k^3\\Delta x^3}{8} = \\frac{k^3\\Delta x^2}{4} $$\n为了找到在固定网格（$\\Delta x$ 为常数）下使得 $R \\propto (k\\Delta x)^n$ 成立的缩放指数 $n$，我们将 $R$ 作为 $k$ 的函数进行分析：\n$$ R(k) \\propto k^3 $$\n或者，将 $R$ 表示为 $\\theta=k\\Delta x$ 的函数：\n$$ R(\\theta) \\approx \\frac{(k\\Delta x)^3}{4\\Delta x} = \\frac{1}{4\\Delta x} \\theta^3 $$\n由于 $\\Delta x$ 是常数，$R(\\theta) \\propto \\theta^3 = (k\\Delta x)^3$。因此，缩放指数为 $n=3$。对最小波数的数值拟合应得到一个接近 3 的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Analyzes, derives, and numerically verifies the Rhie–Chow momentum interpolation\n    damping for a 1D steady incompressible flow problem.\n    \"\"\"\n    \n    # Define problem parameters\n    N = 128\n    L = 2 * np.pi\n    dx = L / N\n    modes = [1, 4, 16, 64]\n    epsilons = [1e-6, 1e-3]\n    \n    # Generate grid coordinates for cell centers\n    x_j = np.arange(N) * dx\n    \n    # Dictionaries to store results\n    all_R = {}\n    all_A_corr = {}\n\n    # Iterate over epsilon values and modes\n    for eps in epsilons:\n        all_R[eps] = {}\n        all_A_corr[eps] = {}\n        for m in modes:\n            k = m\n            \n            # --- Numerical Computation of RC Correction ---\n            \n            # Pressure field at cell centers using periodic indexing\n            p_j = eps * np.cos(k * x_j)\n            \n            # Use np.roll for efficient periodic boundary handling\n            p_j_plus_1 = np.roll(p_j, -1)\n            p_j_minus_1 = np.roll(p_j, 1)\n\n            # 1. Naive face velocity contribution from pressure gradient\n            # This is computed for each face j+1/2 between cells j and j+1\n            u_naive = -(p_j_plus_1 - p_j) / dx\n            \n            # 2. Rhie-Chow face velocity contribution\n            # First, compute cell-centered gradients\n            g_j = (p_j_plus_1 - p_j_minus_1) / (2 * dx)\n            g_j_plus_1 = np.roll(g_j, -1)\n            \n            # Then, interpolate gradients to the face\n            u_rc = -0.5 * (g_j + g_j_plus_1)\n            \n            # 3. Compute the correction term, its amplitude, and normalized ratio\n            correction = u_rc - u_naive\n            A_corr = np.max(np.abs(correction))\n            R = A_corr / eps\n            \n            # Store results\n            all_R[eps][m] = R\n            all_A_corr[eps][m] = A_corr\n\n    # --- Post-processing and Analysis ---\n    \n    # 1. Estimate the scaling exponent n\n    fit_modes = [1, 4, 16]\n    log_kdx = np.log([m * dx for m in fit_modes])\n    \n    # Fit for epsilon = 1e-6\n    log_R_eps1 = np.log([all_R[1e-6][m] for m in fit_modes])\n    res1 = linregress(log_kdx, log_R_eps1)\n    n1 = res1.slope\n    \n    # Fit for epsilon = 1e-3\n    log_R_eps2 = np.log([all_R[1e-3][m] for m in fit_modes])\n    res2 = linregress(log_kdx, log_R_eps2)\n    n2 = res2.slope\n\n    # 2. Quantify linearity deviation delta_lin\n    devs = []\n    for m in modes:\n        # The ratio should be 1 for perfect linearity.\n        ratio = (all_A_corr[1e-3][m] / all_A_corr[1e-6][m]) * (1e-6 / 1e-3)\n        dev = np.abs(ratio - 1)\n        devs.append(dev)\n    delta_lin = np.max(devs)\n    \n    # 3. Assemble the final list of results in the required order\n    results = [\n        n1, \n        n2,\n        all_R[1e-6][1], \n        all_R[1e-6][4], \n        all_R[1e-6][16], \n        all_R[1e-6][64],\n        all_R[1e-3][1], \n        all_R[1e-3][4], \n        all_R[1e-3][16], \n        all_R[1e-3][64],\n        delta_lin\n    ]\n\n    # Print the final output in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358660"}, {"introduction": "一个高质量的不可压缩流数值格式不仅要能抑制振荡，还应具备“压力鲁棒性”，即计算出的速度场不应受到无旋体力项的影响。本练习在一个二维问题中对比了两种离散格式：“自洽”的格式可以保持压力鲁棒性，而“朴素”的格式则会引入伪速度。通过这个实践[@problem_id:3358724]，您将理解压力鲁棒性这一精妙但至关重要的概念，以及Rhie-Chow类格式的实现细节如何决定其是否具备这一关键特性。", "problem": "要求您设计、分析并实现一个二维稳态不可压缩斯托克斯方程的周期性同位网格有限体积离散化方法，该方法在面法向质量通量层面引入 Rhie–Chow 动量插值概念。其目标是通过验证离散速度误差如何随粘度变化以及是否与强迫项幅值无关，来评估在梯度主导强迫项下的压力鲁棒性。推导必须从均匀周期性网格上的基本守恒定律和标准离散算子定义出发；您的推导不应假定任何预先推导的 Rhie–Chow 公式。\n\n连续问题是在一个单位周期性方形域上，具有零均值压力的稳态不可压缩斯托克斯系统，由下式给出：\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0,\n$$\n其中粘度 $\\mu0$，强迫项为 $\\mathbf{f} = \\nabla \\phi$，$\\phi$ 是一个光滑标量势。根据任何纯梯度强迫项都可以被吸收到压力项中的基本事实，对于周期性边界条件，无论 $\\phi$ 的幅值如何，精确速度解均为 $\\mathbf{u} \\equiv \\mathbf{0}$。离散层面上的压力鲁棒性要求离散螺线管投影算子能够消去离散梯度，从而使计算出的速度不会虚假地依赖于 $\\|\\phi\\|$。\n\n考虑一个尺寸为 $1 \\times 1$ 的周期性域上的均匀同位网格，其上有 $N_x \\times N_y$ 个单元中心的标量未知数。令 $\\Delta x = 1/N_x$ 且 $\\Delta y = 1/N_y$。定义以下标准离散算子：\n- 一个从单元中心到面中心的离散梯度算子 $G$，在 $x$ 和 $y$ 方向上分别作用，使得在以索引 $(i+\\tfrac{1}{2}, j)$ 为中心的 $x$ 面上，$(G_x p)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}$，采用周期性环绕，类似地，对于 $y$ 面，通过 $(G_y p)_{i, j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}$。\n\n- 一个从面中心到单元中心的离散散度算子 $D$，使得在 $(i,j)$ 处的单元中心散度为 $(D \\mathbf{u})_{i,j} = \\frac{u_{x,i+\\frac{1}{2},j} - u_{x,i-\\frac{1}{2},j}}{\\Delta x} + \\frac{u_{y,i, j+\\frac{1}{2}} - u_{y,i, j-\\frac{1}{2}}}{\\Delta y}$。\n\n- 一个作用于单元中心 $\\phi$ 上的中心差分梯度算子 $\\mathcal{G}$，通过以下方式作用：$(\\mathcal{G}_x \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}, \\qquad (\\mathcal{G}_y \\phi)_{i,j} = \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}$。\n\n- 一个从单元中心到面中心的平均算子 $\\mathcal{A}$，通过对相邻单元进行算术平均，将单元中心的矢量场映射到面上。\n\n受 Rhie–Chow 动量插值的启发，定义将进入连续性方程的面法向预测通量，其为一个投影到面上的体力项贡献与一个压力梯度迁移率项之和。对于均匀网格上的纯扩散线性化，取面上恒定的动量迁移率为 $1/\\mu$。那么面法向速度建模为：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\mathbf{f}_{\\mathrm{pred},f} - \\frac{1}{\\mu}\\,G p,\n$$\n其中 $\\mathbf{f}_{\\mathrm{pred},f}$ 是梯度强迫项的面中心近似。离散连续性方程 $D \\mathbf{u}_f = 0$ 得到压力方程：\n$$\nD G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}.\n$$\n需要实现并对比 $\\mathbf{f}_{\\mathrm{pred},f}$ 的两种选择：\n\n- 一致的、保持梯度的选择：$\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$，即，使用与压力 $p$ 相同的面梯度算子在面上计算 $\\mathbf{f}$。\n\n- 朴素的、不保持梯度的选择：通过中心差分 $\\mathcal{G}\\phi$ 在单元中心计算 $\\mathbf{f}$，然后通过 $\\mathcal{A}$ 平均到面上，得到 $\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$。\n\n对于每种选择，求解 $D G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}$ 以获得满足周期性零均值约束（即，将 $p$ 的空间均值设为零）的单元中心压力 $p$，然后计算得到的面速度：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\left(\\mathbf{f}_{\\mathrm{pred},f} - G p\\right).\n$$\n将速度误差定义为面上离散均方根：\n$$\ne = \\left( \\frac{1}{N_x N_y} \\sum_{i,j} \\left(u_{x,i+\\frac{1}{2},j}^2 + u_{y,i, j+\\frac{1}{2}}^2 \\right) \\right)^{1/2}.\n$$\n\n使用一个人工构造的标量势：\n$$\n\\phi(x,y) = A \\sin(2\\pi k_x x)\\cos(2\\pi k_y y),\n$$\n其中幅值 $A0$，波数 $k_x, k_y \\in \\mathbb{Z}$ 为整数。注意，对于所有的 $A$ 和 $\\mu$，精确连续速度解均为 $\\mathbf{u} \\equiv \\mathbf{0}$。\n\n您的任务：\n- 从基本定律（动量平衡和质量守恒）和上述离散算子定义出发，为 $\\mathbf{f}_{\\mathrm{pred},f}$ 的两种选择推导压力方程和最终的面速度公式，不假定任何已知的 Rhie–Chow 公式。\n- 使用离散傅里叶变换为离散泊松算子 $D G$ 实现一个周期性快速求解器，并强制施加零空间均值压力。\n- 对于一致选择和朴素选择，在一个小型测试套件上计算误差 $e$，并按下文规定汇总结果。\n\n测试套件规格：\n- 使用 $N_x = 64, N_y = 64$，周期性域尺寸为 $1\\times 1$。\n- 使用波数 $(k_x,k_y) = (3,2)$。\n- 粘度：$\\mu \\in \\{0.1, 0.05\\}$。\n- 幅值：$A \\in \\{1.0, 10.0\\}$。\n\n计算并报告以下五个量：\n1. 一致选择在 $A=10.0$ 和 $\\mu=0.1$ 时的误差 $e$。\n2. 一致选择在 $A=1000.0$ 和 $\\mu=0.1$ 时的误差 $e$。\n3. 朴素选择在 $A=1.0$ 和 $\\mu=0.1$ 时的缩放误差 $e/A$。\n4. 朴素选择在 $A=10.0$ 和 $\\mu=0.1$ 时的缩放误差 $e/A$。\n5. 朴素选择在固定幅值 $A=10.0$ 时的粘度缩放比 $r$，定义为\n$$\nr = \\frac{(e/A)\\ \\text{at}\\ \\mu=0.1}{(e/A)\\ \\text{at}\\ \\mu=0.05}.\n$$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含按上述顺序列出的结果，形式为逗号分隔的列表并用方括号括起来，例如 `[result1,result2,result3,result4,result5]`。\n- 所有值必须是标准浮点数。对于此无量纲化公式，无需报告物理单位，也不出现角度。请确保您的实现是自包含的，并且不使用任何外部输入。", "solution": "该问题要求设计和分析一种用于稳态不可压缩斯托克斯方程的周期性同位网格有限体积法，重点关注受 Rhie–Chow 动量插值概念启发的两种不同实现的压力鲁棒性。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n- **连续方程**: 稳态不可压缩斯托克斯方程，在单位周期性方形域上：\n  $$-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0$$\n- **强迫项**: 一个纯梯度场，$\\mathbf{f} = \\nabla \\phi$。\n- **势场**: $\\phi(x,y) = A \\sin(2\\pi k_x x)\\cos(2\\pi k_y y)$。\n- **精确解**: $\\mathbf{u} \\equiv \\mathbf{0}$，且 $p$ 满足零均值压力条件。\n- **网格**: $1 \\times 1$ 域上的 $N_x \\times N_y$ 单元均匀同位网格。单元尺寸为 $\\Delta x = 1/N_x, \\Delta y = 1/N_y$。\n- **离散算子**:\n  - 从单元中心到面中心的梯度 $G$: $(G_x p)_{i+\\frac{1}{2},j} = (p_{i+1,j} - p_{i,j})/\\Delta x$。\n  - 从面中心到单元中心的散度 $D$: $(D \\mathbf{u})_{i,j} = (u_{x,i+\\frac{1}{2},j} - u_{x,i-\\frac{1}{2},j})/\\Delta x + (u_{y,i, j+\\frac{1}{2}} - u_{y,i, j-\\frac{1}{2}})/\\Delta y$。\n  - 单元中心的梯度 $\\mathcal{G}$: $(\\mathcal{G}_x \\phi)_{i,j} = (\\phi_{i+1,j} - \\phi_{i-1,j})/(2\\Delta x)$。\n  - 从单元中心到面中心的平均算子 $\\mathcal{A}$。\n- **面速度模型**: $\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\mathbf{f}_{\\mathrm{pred},f} - \\frac{1}{\\mu}\\,G p$。\n- **面强迫项 $\\mathbf{f}_{\\mathrm{pred},f}$ 的选择**:\n  1. **一致**: $\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$。\n  2. **朴素**: $\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$。\n- **离散压力方程**: 由 $D \\mathbf{u}_f = 0$ 推导，得到 $D G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}$。\n- **速度误差度量**: $e = \\left( \\frac{1}{N_x N_y} \\sum_{i,j} \\left(u_{x,i+\\frac{1}{2},j}^2 + u_{y,i, j+\\frac{1}{2}}^2 \\right) \\right)^{1/2}$。\n- **求解器规格**: 针对周期性泊松问题 $DG p = S$ 使用快速傅里叶变换(FFT)。\n- **测试参数**: $N_x=64, N_y=64$, $(k_x, k_y)=(3,2)$, $\\mu \\in \\{0.1, 0.05\\}$, $A \\in \\{1.0, 10.0\\}$。\n- **要求输出**: 五个与误差 $e$ 相关的特定数值结果。\n\n**步骤2：使用提取的已知条件进行验证**\n\n该问题具有科学依据、适定且客观。它概述了计算流体动力学中一个标准的数值实验，用以研究压力鲁棒性这一特性。方程、算子定义和数值方法都是标准的且定义明确。使用具有纯梯度强迫项的人工构造解是用于此目的的典型测试。离散压力方程是周期域上的泊松方程；由于周期性网格上离散散度算子 $D$ 的结构，其相容性条件（右端项均值为零）得到满足，而规定压力均值为零确保了唯一解。该问题是自包含的，为其求解提供了所有必要信息。不存在科学、逻辑或事实上的缺陷。\n\n**步骤3：结论与行动**\n\n问题有效。将提供完整解答。\n\n### 推导与算法设计\n\n该方法的核心在于在离散层面耦合动量和质量守恒定律。问题提供了一个简化的、线性的面法向速度 $\\mathbf{u}_f$ 模型，该模型受到动量方程逆算的启发：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right)\n$$\n此处，$\\mathbf{u}_f$ 表示垂直于单元面的速度矢量，$\\mathbf{f}_{\\mathrm{pred},f}$ 是体力项 $\\mathbf{f}$ 的面中心近似，$G p$ 是面上的离散压力梯度，标量 $1/\\mu$ 是从粘性项 $\\mu \\Delta \\mathbf{u}$ 推导出的恒定迁移率因子。\n\n稳态不可压缩流体的离散质量守恒方程为 $\\nabla \\cdot \\mathbf{u} = 0$，在单元中心离散为 $D \\mathbf{u}_f = 0$。将 $\\mathbf{u}_f$ 的模型代入此连续性方程，得到：\n$$\nD \\left( \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right) \\right) = 0\n$$\n由于粘度 $\\mu$ 是一个非零常数，它可以被提取出来并消去。根据散度算子 $D$ 的线性性质，我们得到：\n$$\nD(\\mathbf{f}_{\\mathrm{pred},f}) - D(G p) = 0\n$$\n这可以重排为离散压力泊松方程 (PPE)：\n$$\nD G p = D (\\mathbf{f}_{\\mathrm{pred},f})\n$$\n算子 $L = DG$ 构成一个离散拉普拉斯算子。一旦通过在零均值约束下求解该方程获得压力场 $p$，就可以将 $p$ 代回到其定义表达式中来恢复最终的面速度：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right)\n$$\n我们现在分析用于近似强迫项 $\\mathbf{f}_{\\mathrm{pred},f} = (G\\phi)_{\\mathrm{pred}, f}$ 的两种指定选择。\n\n**情况1：一致强迫项，$\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$**\n这种选择对压力 $p$ 和势 $\\phi$ 使用相同的离散梯度算子 $G$。PPE 变为：\n$$\nD G p = D (G \\phi) \\implies DG(p-\\phi) = 0\n$$\n在周期域上，齐次离散泊松方程 $Lq = 0$ 的解是任意常数场 $q=C$。因此，$p - \\phi = C$，这意味着 $p = \\phi + C$。为了满足零均值压力约束 $\\langle p \\rangle = 0$，我们需要 $\\langle \\phi + C \\rangle = \\langle \\phi \\rangle + C = 0$，这确定了常数 $C = -\\langle \\phi \\rangle$。因此，唯一的压力解是 $p = \\phi - \\langle \\phi \\rangle$。\n将此压力代回速度公式，得到：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( G \\phi - G(\\phi - \\langle \\phi \\rangle) \\right) = \\frac{1}{\\mu} \\left( G \\phi - G \\phi + G(\\langle \\phi \\rangle) \\right)\n$$\n由于 $\\langle \\phi \\rangle$ 是一个常数，且梯度算子 $G$ 会消去常数场，因此 $G(\\langle \\phi \\rangle) = \\mathbf{0}$。这导致：\n$$\n\\mathbf{u}_f = \\mathbf{0}\n$$\n结果速度恒等于零（在机器精度范围内），与幅值 $A$ 或粘度 $\\mu$ 无关。这表明该方案是压力鲁棒的；离散螺线管投影算子完美地消去了离散梯度强迫项，正确地再现了解析解 $\\mathbf{u} \\equiv \\mathbf{0}$。速度误差 $e$ 预计将接近于零。\n\n**情况2：朴素强迫项，$\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$**\n这种选择首先计算单元中心的梯度 $\\mathcal{G}\\phi$，然后使用 $\\mathcal{A}$ 将其平均到面上。离散算子 $\\mathcal{A}$ 和 $\\mathcal{G}$ 的定义使得通常情况下 $\\mathcal{A}(\\mathcal{G}\\phi) \\neq G\\phi$。这种差异，一种形式的“对易子误差”，破坏了在情况1中观察到的结构一致性。现在的 PPE 是：\n$$\nD G p = D \\left( \\mathcal{A}(\\mathcal{G}\\phi) \\right)\n$$\n解 $p$ 将不再是 $\\phi$ 的简单平移。计算出的速度为：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathcal{A}(\\mathcal{G}\\phi) - G p \\right) = \\frac{1}{\\mu} \\left( \\mathcal{A}(\\mathcal{G}\\phi) - G \\left( (DG)^{-1} D(\\mathcal{A}(\\mathcal{G}\\phi)) \\right) \\right)\n$$\n项 $P_G = G(DG)^{-1}D$ 是一个到离散梯度空间（无旋场）的投影算子。速度与 $(\\mathbf{I} - P_G)(\\mathcal{A}(\\mathcal{G}\\phi))$ 成正比，这是将 $\\mathcal{A}(\\mathcal{G}\\phi)$ 投影到离散无散场空间的结果。因为在算子 $G$ 的意义下，$\\mathcal{A}(\\mathcal{G}\\phi)$ 不是一个离散梯度，所以这个投影是非零的，从而产生虚假速度。\n这个虚假速度的大小与势 $\\phi$ 的幅值 $A$ 成线性关系，与粘度 $\\mu$ 成反比。因此，误差 $e$ 的行为预计为 $e \\propto A/\\mu$。这意味着缩放误差 $e/A$ 应与 $A$ 无关，并且在两种不同粘度 $\\mu_1$ 和 $\\mu_2$ 下的缩放误差之比应为 $(e/A)_1 / (e/A)_2 \\approx \\mu_2/\\mu_1$。\n\n**实现：基于FFT的泊松求解器**\n周期性 PPE $DGp=S$ 可以使用快速傅里叶变换 (FFT) 高效求解。对该方程应用二维离散傅里叶变换 ($\\mathcal{F}$) 可得：\n$$\n\\mathcal{F}(DGp) = \\mathcal{F}(S) \\implies \\widehat{DG}(\\mathbf{m}) \\hat{p}(\\mathbf{m}) = \\hat{S}(\\mathbf{m})\n$$\n其中 $\\hat{p}$ 和 $\\hat{S}$ 是变换后的场，$\\widehat{DG}(\\mathbf{m})$ 是离散拉普拉斯算子的符号（或传递函数），$\\mathbf{m}=(m_x, m_y)$ 是离散频率指数。对于间距为 $\\Delta x, \\Delta y$ 的网格，指定算子的符号为：\n$$\n\\widehat{DG}(m_x, m_y) = -\\frac{4}{\\Delta x^2} \\sin^2\\left(\\frac{\\pi m_x}{N_x}\\right) - \\frac{4}{\\Delta y^2} \\sin^2\\left(\\frac{\\pi m_y}{N_y}\\right)\n$$\n压力的傅里叶系数通过逐点相除得到：\n$$\n\\hat{p}(\\mathbf{m}) = \\frac{\\hat{S}(\\mathbf{m})}{\\widehat{DG}(\\mathbf{m})} \\quad \\text{for } \\mathbf{m} \\neq \\mathbf{0}\n$$\n符号 $\\widehat{DG}(\\mathbf{0}) = 0$ 对应于算子的零空间。通过设置零频分量 $\\hat{p}(\\mathbf{0}) = 0$ 来强制执行零均值压力约束 $\\langle p \\rangle=0$。然后通过应用逆傅里叶变换来恢复压力场 $p$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and compute the required results.\n    \"\"\"\n\n    def compute_error(A, mu, choice, kx, ky, Nx, Ny):\n        \"\"\"\n        Computes the velocity error for a given set of parameters.\n        \"\"\"\n        dx = 1.0 / Nx\n        dy = 1.0 / Ny\n\n        x_cc = np.arange(Nx) * dx\n        y_cc = np.arange(Ny) * dy\n        XX_cc, YY_cc = np.meshgrid(x_cc, y_cc, indexing='ij')\n\n        phi_cc = A * np.sin(2 * np.pi * kx * XX_cc) * np.cos(2 * np.pi * ky * YY_cc)\n\n        # --- Define discrete operators using np.roll for periodic boundaries ---\n        \n        def G(p_cc): # cell-center to face-center gradient\n            gxp_f = (np.roll(p_cc, -1, axis=0) - p_cc) / dx\n            gyp_f = (np.roll(p_cc, -1, axis=1) - p_cc) / dy\n            return gxp_f, gyp_f\n\n        def D(u_f): # face-center to cell-center divergence\n            ux_f, uy_f = u_f\n            div_x = (ux_f - np.roll(ux_f, 1, axis=0)) / dx\n            div_y = (uy_f - np.roll(uy_f, 1, axis=1)) / dy\n            return div_x + div_y\n\n        def G_central(p_cc): # cell-center central-difference gradient\n            gx_cc = (np.roll(p_cc, -1, axis=0) - np.roll(p_cc, 1, axis=0)) / (2 * dx)\n            gy_cc = (np.roll(p_cc, -1, axis=1) - np.roll(p_cc, 1, axis=1)) / (2 * dy)\n            return gx_cc, gy_cc\n\n        def A_op(f_cc): # cell-center to face-center averaging\n            fx_cc, fy_cc = f_cc\n            fx_f = (fx_cc + np.roll(fx_cc, -1, axis=0)) / 2.0\n            fy_f = (fy_cc + np.roll(fy_cc, -1, axis=1)) / 2.0\n            return fx_f, fy_f\n\n        # --- Compute forcing term and solve for pressure ---\n        if choice == 'consistent':\n            f_pred_f = G(phi_cc)\n        elif choice == 'naive':\n            f_cc = G_central(phi_cc)\n            f_pred_f = A_op(f_cc)\n        else:\n            raise ValueError(\"Invalid choice for forcing term.\")\n\n        # --- FFT-based Poisson solver for D G p = D(f_pred_f) ---\n        rhs = D(f_pred_f)\n        rhs_hat = np.fft.fft2(rhs)\n\n        freq_x = np.fft.fftfreq(Nx)\n        freq_y = np.fft.fftfreq(Ny)\n        \n        lap_symbol_x = -4.0 / (dx**2) * np.sin(np.pi * freq_x)**2\n        lap_symbol_y = -4.0 / (dy**2) * np.sin(np.pi * freq_y)**2\n        \n        L_hat = np.add.outer(lap_symbol_x, lap_symbol_y)\n\n        with np.errstate(divide='ignore', invalid='ignore'):\n            p_hat = rhs_hat / L_hat\n        \n        p_hat[0, 0] = 0.0  # Enforce zero-mean pressure\n\n        p_cc = np.fft.ifft2(p_hat).real\n\n        # --- Compute final face velocities and error ---\n        gp_f = G(p_cc)\n        ux_f = (1.0 / mu) * (f_pred_f[0] - gp_f[0])\n        uy_f = (1.0 / mu) * (f_pred_f[1] - gp_f[1])\n        \n        error_sq_sum = np.sum(ux_f**2) + np.sum(uy_f**2)\n        e = np.sqrt(error_sq_sum / (Nx * Ny))\n        \n        return e\n\n    # Test parameters\n    Nx, Ny = 64, 64\n    kx, ky = 3, 2\n\n    e_c_A10_mu01 = compute_error(A=10.0, mu=0.1, choice='consistent', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e_c_A1000_mu01 = compute_error(A=1000.0, mu=0.1, choice='consistent', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n\n    e_n_A1_mu01 = compute_error(A=1.0, mu=0.1, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e_n_A10_mu01 = compute_error(A=10.0, mu=0.1, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e_n_A10_mu005 = compute_error(A=10.0, mu=0.05, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    \n    res1 = e_c_A10_mu01\n    res2 = e_c_A1000_mu01\n    res3 = e_n_A1_mu01 / 1.0\n    res4 = e_n_A10_mu01 / 10.0\n    res5 = (e_n_A10_mu01 / 10.0) / (e_n_A10_mu005 / 10.0)\n    \n    final_results = [res1, res2, res3, res4, res5]\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3358724"}, {"introduction": "标准的Rhie-Chow插值法采用固定形式，但这在所有流动状态（如对流主导与扩散主导）或网格质量（如扭曲网格）下可能并非最优。这项高级实践要求您设计一个*自适应*的Rhie-Chow权重函数，使其能响应局部流动条件，特别是佩克莱数（Peclet number）和网格扭曲度。通过提出参数化函数并实施校准实验来优化其系数[@problem_id:3358711]，您将从分析现有格式转向设计新格式，这是高级CFD研究与开发中的一项关键技能。", "problem": "在计算流体动力学（CFD）中，考虑用于稳态不可压缩流的一维同位网格有限体积离散化。面法向速度必须通过单元中心值插值得到，并且插值方式需避免压力-速度解耦问题，该问题通常采用Rhie–Chow动量插值（RCMI）方法解决。您需要根据局部佩克莱数和网格歪斜度，提出一个自适应Rhie–Chow权重 $\\alpha(\\mathrm{Pe},\\mathrm{Sk})$，并设计和实现一个校准实验来优化 $\\alpha$，以在不过度抑制物理梯度的前提下，最小化散度误差。您的程序必须是一个完整的、可运行的实现，能够为所提供的测试套件生成指定的输出。\n\n请使用以下有科学依据的基础和定义：\n- 稳态不可压缩质量守恒：$\\nabla \\cdot (\\rho \\mathbf{u}) = 0$，其中密度 $\\rho$ 为常数。\n- 在一维情况下，单位面积的面质量通量为 $\\rho u_f$，其中 $u_f$ 是面速度。\n- 将面上的局部佩克莱数定义为 $\\mathrm{Pe}_f = \\dfrac{\\rho \\lvert u_f \\rvert \\Delta x}{\\mu}$，其中运动粘度为 $\\nu = \\mu/\\rho$，动力粘度为 $\\mu$，单元间距为 $\\Delta x$，密度为 $\\rho$。\n- 将面上的无量纲网格歪斜度度量定义为 $\\mathrm{Sk}_f = \\dfrac{\\lvert x_f - \\tfrac{1}{2}(x_P + x_N)\\rvert}{\\Delta x}$，其中 $x_f$ 是实际的面位置，$x_P$ 和 $x_N$ 是相邻单元中心的坐标。\n- 考虑通用的Rhie–Chow面速度结构\n$$\nu_f(\\alpha) = \\bar{u}_f - \\alpha(\\mathrm{Pe}_f,\\mathrm{Sk}_f)\\,K\\,\\frac{p_N - p_P}{\\Delta x},\n$$\n其中 $\\bar{u}_f$ 是从单元中心速度到面的一致性插值（使用线性平均 $\\bar{u}_f = \\tfrac{1}{2}(u_P + u_N)$），$K$ 是一个与动量方程单位一致的缩放因子。在本问题中，您应使用 $K = \\Delta t / \\rho$，其中 $\\Delta t = 0.01$ 单位为 $\\mathrm{s}$，$\\rho$ 单位为 $\\mathrm{kg/m^3}$，压力 $p$ 单位为 $\\mathrm{Pa}$，$\\Delta x$ 单位为 $\\mathrm{m}$。这一选择确保了 $K \\, \\dfrac{p_N - p_P}{\\Delta x}$ 的单位为 $\\mathrm{m/s}$。\n\n校准实验描述与约束：\n- 为 $\\alpha(\\mathrm{Pe},\\mathrm{Sk})$ 提出一个包含两个可调系数 $c_0$ 和 $c_1$ 的参数形式，其值域映射到区间 $[0,1]$，并且对于 $\\mathrm{Sk}$ 是单调非减的，对于 $\\mathrm{Pe}$ 是单调非增的。只要满足上述单调性和值域约束，您可以引入固定的形状参数。\n- 构建一个一维域 $[0,L]$，其中 $L = 1$（单位为 $\\mathrm{m}$），均匀标称间距为 $\\Delta x = L/N$，单元中心定义在 $x_i = (i+\\tfrac{1}{2})\\Delta x$ 处，其中 $i = 0,1,\\dots,N-1$。内部面的位置为 $x_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}(x_i + x_{i+1}) + \\delta_{i+\\tfrac{1}{2}}$，其中 $\\delta_{i+\\tfrac{1}{2}}$ 是一个歪斜偏移量，边界位于 $x=0$ 和 $x=L$。\n- 使用一个制造的光滑精确速度和压力：\n$$\nu_{\\text{exact}}(x) = U_0 \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\quad\\text{in}\\ \\mathrm{m/s},\\qquad\np(x) = p_0 + p_1 \\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\quad\\text{in}\\ \\mathrm{Pa},\n$$\n其中 $p_0 = 0$，$p_1 = 10$（单位为 $\\mathrm{Pa}$）。对于边界面速度，强制 $u_f = u_{\\text{exact}}(0)$ 和 $u_f = u_{\\text{exact}}(L)$。\n- 对于内部面，使用 $\\bar{u}_f = \\tfrac{1}{2}(u_P + u_N)$，并将压力差定义为相邻单元中心之间的 $p_N - p_P$。\n\n在系数网格 $\\{c_0, c_1\\}$（其中 $c_0 \\in \\{0.0, 0.1, 0.2, \\dots, 1.0\\}$ 且 $c_1 \\in \\{0.0, 0.1, 0.2, \\dots, 1.0\\}$）上定义并最小化以下目标函数：\n- 单元 $i$ 处的连续性残差：\n$$\nr_i = \\frac{\\rho\\left(u_{i+\\tfrac{1}{2}} - u_{i-\\tfrac{1}{2}}\\right)}{\\Delta x}.\n$$\n- 将散度误差定义为\n$$\nE_{\\mathrm{div}} = \\frac{\\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1} r_i^2}}{\\rho\\,U_{\\mathrm{ref}}/\\Delta x},\\quad\\text{其中}\\quad U_{\\mathrm{ref}} = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1} u_{\\text{exact}}(x_i)^2}.\n$$\n- 将面上的过阻尼误差定义为\n$$\nE_{\\mathrm{damp}} = \\frac{\\sqrt{\\frac{1}{N_f}\\sum_{f} \\left(u_f(\\alpha) - u_{\\text{exact}}(x_f)\\right)^2}}{\\sqrt{\\frac{1}{N_f}\\sum_{f} u_{\\text{exact}}(x_f)^2}},\n$$\n其中求和遍历所有面，$N_f$ 是面的数量。\n- 最小化\n$$\nJ(c_0,c_1) = E_{\\mathrm{div}} + \\lambda E_{\\mathrm{damp}},\n$$\n其中 $\\lambda = 1$。\n\n测试套件和物理/数值参数：\n- 使用密度 $\\rho = 1$（单位为 $\\mathrm{kg/m^3}$），动力粘度 $\\mu$（单位为 $\\mathrm{kg/(m\\,s)}$），以及面面积 $A = 1$（单位为 $\\mathrm{m^2}$）。\n- 歪斜偏移量规定为 $\\delta_{i+\\tfrac{1}{2}} = s\\,\\Delta x \\sin\\!\\left(\\dfrac{2\\pi(i+1)}{N}\\right)$，其中 $s$ 是给定的歪斜度幅值，相应的歪斜度度量为 $\\mathrm{Sk}_{i+\\tfrac{1}{2}} = \\dfrac{\\lvert \\delta_{i+\\tfrac{1}{2}} \\rvert}{\\Delta x}$。\n- 用于加权的局部佩克莱数应使用线性插值的面速度大小进行评估：$\\mathrm{Pe}_{i+\\tfrac{1}{2}} = \\dfrac{\\rho\\,\\lvert \\bar{u}_{i+\\tfrac{1}{2}}\\rvert\\,\\Delta x}{\\mu}$。\n\n提供四个测试用例，涵盖不同工况：\n1. 理想情况：$N = 64$，$U_0 = 1.0$（单位 $\\mathrm{m/s}$），$\\mu = 0.01$（单位 $\\mathrm{kg/(m\\,s)}$），$s = 0.0$。\n2. 高佩克莱数：$N = 64$，$U_0 = 5.0$（单位 $\\mathrm{m/s}$），$\\mu = 0.005$（单位 $\\mathrm{kg/(m\\,s)}$），$s = 0.0$。\n3. 高歪斜度：$N = 64$，$U_0 = 1.0$（单位 $\\mathrm{m/s}$），$\\mu = 0.01$（单位 $\\mathrm{kg/(m\\,s)}$），$s = 0.3$。\n4. 低佩克莱数高歪斜度：$N = 64$，$U_0 = 0.1$（单位 $\\mathrm{m/s}$），$\\mu = 0.05$（单位 $\\mathrm{kg/(m\\,s)}$），$s = 0.3$。\n\n您的输出应为单行文本，包含四个测试用例的结果列表，每个结果是一个包含浮点数值的列表 $[c_0^\\star,c_1^\\star,E_{\\mathrm{div}}^\\star,E_{\\mathrm{damp}}^\\star]$。最终程序输出必须是以下格式的单行文本\n$$\n[[c_{0,1},c_{1,1},E_{\\mathrm{div},1},E_{\\mathrm{damp},1}],[c_{0,2},c_{1,2},E_{\\mathrm{div},2},E_{\\mathrm{damp},2}],[c_{0,3},c_{1,3},E_{\\mathrm{div},3},E_{\\mathrm{damp},3}],[c_{0,4},c_{1,4},E_{\\mathrm{div},4},E_{\\mathrm{damp},4}]].\n$$\n所有报告的数字都是无单位的无量纲浮点数。三角函数中出现的角度，单位均为弧度。\n\n您的任务：\n- 为 $\\alpha(\\mathrm{Pe},\\mathrm{Sk})$ 提出一个包含两个可调系数、满足约束条件的、具有科学一致性的参数形式。\n- 实现上述校准实验。\n- 对每个测试用例，以指定的最终输出格式返回优化后的系数及相关的误差度量。", "solution": "我们从稳态不可压缩质量守恒方程 $\\nabla \\cdot (\\rho \\mathbf{u}) = 0$ 开始，在一维空间且密度 $\\rho$ 为常数的情况下，该方程简化为 $\\dfrac{\\partial}{\\partial x}(\\rho u) = 0$。在同位网格有限体积法中，单元面上的质量通量为 $\\rho u_f$，当两个面上的通量相等时，单元上的离散连续性残差必须为零。然而，直接通过单元中心速度插值得到 $u_f$ 会导致压力-速度解耦。Rhie–Chow动量插值（RCMI）为面速度的插值引入了一个与压力梯度一致的修正项。一个通用的一维面法向速度形式为\n$$\nu_f(\\alpha) = \\bar{u}_f - \\alpha(\\mathrm{Pe}_f,\\mathrm{Sk}_f)\\,K\\,\\frac{p_N - p_P}{\\Delta x},\n$$\n其中 $\\bar{u}_f$ 是将 $u$ 插值到面上的速度（取线性平均值 $\\bar{u}_f = \\tfrac{1}{2}(u_P + u_N)$），$p_N - p_P$ 是相邻单元中心之间的压力差，$\\Delta x$ 是单元间距，$K$ 是一个确保量纲一致性的缩放因子。我们设定 $K = \\Delta t/\\rho$，其中 $\\Delta t$ 的单位是秒，$\\rho$ 的单位是 $\\mathrm{kg/m^3}$，这使得当乘以单位为 $\\mathrm{Pa/m}$ 的压力梯度 $\\dfrac{p_N - p_P}{\\Delta x}$ 时，结果的单位为 $\\mathrm{m/s}$。这种缩放方式与动量方程的伪时间积分是一致的，其中压力梯度驱动的速度变化与 $\\Delta t/\\rho$ 成正比。\n\n我们使用线性插值的速度大小来定义面上的局部佩克莱数：\n$$\n\\mathrm{Pe}_f = \\frac{\\rho \\lvert \\bar{u}_f \\rvert \\Delta x}{\\mu},\n$$\n以及面上的网格歪斜度度量为\n$$\n\\mathrm{Sk}_f = \\frac{\\lvert x_f - \\tfrac{1}{2}(x_P + x_N)\\rvert}{\\Delta x}.\n$$\n佩克莱数用于量化对流相对于扩散的主导程度，是计算流体力学（CFD）中一个标准的无量纲数。歪斜度度量用于量化几何上的不对齐，这种不对齐通常会加剧插值误差。\n\n我们必须设计具有以下性质的 $\\alpha(\\mathrm{Pe},\\mathrm{Sk})$：\n- 对于所有相关的 $\\mathrm{Pe}\\ge 0$ 和 $\\mathrm{Sk}\\ge 0$，其值域映射到区间 $[0,1]$。\n- 对于 $\\mathrm{Sk}$ 是单调非减的，以在更歪斜的网格上增加稳定性。\n- 对于 $\\mathrm{Pe}$ 是单调非增的，以避免在对流主导区域过度抑制物理梯度。\n- 包含两个待校准的可调系数 $c_0$ 和 $c_1$。\n\n一个满足这些性质且具有科学一致性的参数形式是\n$$\n\\alpha(\\mathrm{Pe},\\mathrm{Sk};c_0,c_1) = \\mathrm{clip}\\!\\left(c_0 + c_1\\,\\frac{\\mathrm{Sk}}{\\mathrm{Sk} + s_0}\\,\\frac{1}{(1+\\mathrm{Pe})^\\gamma},\\,0,\\,1\\right),\n$$\n其中 $s_0  0$ 和 $\\gamma  0$ 是固定的形状参数。因子 $\\dfrac{\\mathrm{Sk}}{\\mathrm{Sk}+s_0}$ 对于 $\\mathrm{Sk}$ 是单调非减的，界于 $0$ 和 $1$ 之间，并在小的 $\\mathrm{Sk}$ 值下提供一个由 $s_0$ 控制的软启动稳定化。因子 $(1+\\mathrm{Pe})^{-\\gamma}$ 对于 $\\mathrm{Pe}$ 是单调非增的，其中 $\\gamma$ 控制衰减速率。$\\mathrm{clip}$ 操作强制其值域为 $[0,1]$。系数 $c_0$ 设定了一个基准稳定水平（即使在正交网格上），而 $c_1$ 则缩放与 $\\mathrm{Sk}$ 和 $\\mathrm{Pe}$ 相关的自适应增强项。对于校准实验，我们选择 $s_0 = 0.05$ 和 $\\gamma = 0.5$；这些参数可以提供平滑的响应而不会产生过度的刚度。\n\n为了校准 $(c_0,c_1)$，我们定义了两个相互竞争的误差度量：\n1. 散度误差，用于量化质量守恒的违背程度：\n$$\nr_i = \\frac{\\rho\\left(u_{i+\\tfrac{1}{2}} - u_{i-\\tfrac{1}{2}}\\right)}{\\Delta x},\\qquad\nU_{\\mathrm{ref}} = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1} u_{\\text{exact}}(x_i)^2},\\qquad\nE_{\\mathrm{div}} = \\frac{\\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1} r_i^2}}{\\rho\\,U_{\\mathrm{ref}}/\\Delta x}.\n$$\n这种归一化使得 $E_{\\mathrm{div}}$ 成为无量纲且与尺度无关的量：分母 $\\rho U_{\\mathrm{ref}}/\\Delta x$ 是一个特征通量散度尺度。\n\n2. 过阻尼误差，用于量化插值得到的面速度与制造的物理速度之间的偏差，反映了梯度的抑制情况：\n$$\nE_{\\mathrm{damp}} = \\frac{\\sqrt{\\frac{1}{N_f}\\sum_{f} \\left(u_f(\\alpha) - u_{\\text{exact}}(x_f)\\right)^2}}{\\sqrt{\\frac{1}{N_f}\\sum_{f} u_{\\text{exact}}(x_f)^2}},\n$$\n其中求和遍历所有面，包括边界（在边界上 $u_f$ 被强制等于 $u_{\\text{exact}}$）。这种归一化同样是无量纲且与尺度无关的。\n\n我们将这些误差合并成一个单一的目标函数\n$$\nJ(c_0,c_1) = E_{\\mathrm{div}} + \\lambda E_{\\mathrm{damp}},\n$$\n其中 $\\lambda = 1$ 以平衡两种效应。在网格 $c_0 \\in \\{0.0,0.1,\\dots,1.0\\}$ 和 $c_1 \\in \\{0.0,0.1,\\dots,1.0\\}$ 上最小化 $J$ 可以得到校准后的系数，这些系数在质量守恒和梯度保真度之间做出了权衡。\n\n数值实验设置：\n- 计算域：$[0,L]$，其中 $L = 1$（单位为 $\\mathrm{m}$）。\n- 离散化：$N$ 个单元，标称间距 $\\Delta x = L/N$；单元中心位于 $x_i = (i+\\tfrac{1}{2})\\Delta x$。\n- 制造场：\n$$\nu_{\\text{exact}}(x) = U_0 \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\ \\mathrm{m/s},\\qquad\np(x) = p_0 + p_1 \\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\ \\mathrm{Pa},\n$$\n其中 $p_0 = 0$ 且 $p_1 = 10$。\n- 面位置：内部面位于 $x_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}(x_i + x_{i+1}) + \\delta_{i+\\tfrac{1}{2}}$，其中 $\\delta_{i+\\tfrac{1}{2}} = s\\,\\Delta x \\sin\\!\\left(\\dfrac{2\\pi(i+1)}{N}\\right)$；边界面位于 $x = 0$ 和 $x = L$；网格歪斜度为 $\\mathrm{Sk}_{i+\\tfrac{1}{2}} = \\dfrac{\\lvert \\delta_{i+\\tfrac{1}{2}} \\rvert}{\\Delta x}$。\n- 用于加权的局部佩克莱数：$\\mathrm{Pe}_{i+\\tfrac{1}{2}} = \\dfrac{\\rho\\,\\lvert \\bar{u}_{i+\\tfrac{1}{2}}\\rvert\\,\\Delta x}{\\mu}$，其中 $\\bar{u}_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}(u_i + u_{i+1})$。\n- 边界面速度：$u_{-\\tfrac{1}{2}} = u_{\\text{exact}}(0)$ 和 $u_{N-\\tfrac{1}{2}} = u_{\\text{exact}}(L)$。\n\n算法：\n- 对于每个测试用例和网格上的每个 $(c_0,c_1)$：\n  - 构建单元中心 $x_i$ 和面 $x_{i+\\tfrac{1}{2}}$。\n  - 计算 $u_{\\text{exact}}(x_i)$ 和 $p(x_i)$。\n  - 使用 Rhie–Chow 结构（其中 $K = \\Delta t/\\rho$，$\\Delta t = 0.01$）构建内部面速度 $u_{i+\\tfrac{1}{2}}(\\alpha)$。\n  - 根据 $u_{\\text{exact}}$ 设置边界面速度。\n  - 使用离散残差 $r_i$ 和 $U_{\\mathrm{ref}}$ 计算 $E_{\\mathrm{div}}$。\n  - 使用内部面和边界面计算 $E_{\\mathrm{damp}}$。\n  - 累积 $J(c_0,c_1)$ 并保留使 $J$ 最小化的 $(c_0,c_1)$ 以及相关的 $E_{\\mathrm{div}}$ 和 $E_{\\mathrm{damp}}$。\n\n理由陈述：\n- 所提出的 $\\alpha(\\mathrm{Pe},\\mathrm{Sk})$ 形式遵循了要求的单调性和边界，随网格歪斜度的增加而增强稳定性，同时在对流主导的区域减少稳定性，以防止不必要的梯度抑制。\n- 目标函数结合了质量守恒（通过散度误差）和物理保真度（通过与制造的面速度的偏差），提供了一个有原则的校准目标。\n- 制造解是光滑的，并提供了非零的压力梯度和速度梯度，确保校准过程能够观察到散度控制和阻尼行为。\n- 所选的 $K = \\Delta t/\\rho$ 通过将 Rhie–Chow 压力梯度修正项解释为对速度的伪时间脉冲，提供了一个具有物理意义的缩放；这避免了单位不一致性，并产生大小合理的修正量。\n\n该实现遵循了上述推导，并为每个测试用例，以指定的单行格式返回最优的 $(c_0,c_1)$ 及相应的误差 $E_{\\mathrm{div}}$ 和 $E_{\\mathrm{damp}}$。所有输出都是无单位的无量纲浮点数，三角函数的参数单位为弧度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef alpha_weight(Pe, Sk, c0, c1, s0=0.05, gamma=0.5):\n    \"\"\"\n    Adaptive Rhie–Chow weight alpha(Pe, Sk; c0, c1), clipped to [0,1],\n    monotone nondecreasing in Sk and nonincreasing in Pe.\n    \"\"\"\n    # Avoid division by zero in Sk/(Sk + s0)\n    sk_factor = Sk / (Sk + s0)\n    pe_factor = 1.0 / ((1.0 + Pe) ** gamma)\n    val = c0 + c1 * sk_factor * pe_factor\n    # Clip to [0,1]\n    return np.clip(val, 0.0, 1.0)\n\ndef make_grid(N, L, skew_amp):\n    \"\"\"\n    Construct cell centers and face positions for a 1D grid with skew.\n    Centers: x_i = (i + 0.5) * dx\n    Internal faces: midpoint plus skew offset delta = s * dx * sin(2*pi*(i+1)/N)\n    Boundary faces at 0 and L.\n    Returns:\n        x_centers: shape (N,)\n        x_faces: shape (N+1,)\n        skewness: shape (N-1,) for internal faces\n    \"\"\"\n    dx = L / N\n    x_centers = (np.arange(N) + 0.5) * dx\n    x_faces = np.zeros(N + 1)\n    x_faces[0] = 0.0\n    x_faces[-1] = L\n    # Internal faces\n    for i in range(N - 1):\n        midpoint = 0.5 * (x_centers[i] + x_centers[i + 1])\n        delta = skew_amp * dx * np.sin(2.0 * np.pi * (i + 1) / N)\n        x_faces[i + 1] = midpoint + delta\n    # Skewness measure for internal faces\n    skewness = np.abs(x_faces[1:-1] - 0.5 * (x_centers[:-1] + x_centers[1:])) / dx\n    return x_centers, x_faces, skewness\n\ndef manufactured_velocity(x, U0, L):\n    return U0 * np.sin(2.0 * np.pi * x / L)\n\ndef manufactured_pressure(x, p0, p1, L):\n    return p0 + p1 * np.cos(2.0 * np.pi * x / L)\n\ndef compute_face_velocities(N, L, U0, mu, rho, s, dt, c0, c1):\n    \"\"\"\n    Compute face velocities using Rhie–Chow form with adaptive alpha.\n    Returns:\n        u_faces: shape (N+1,)\n        x_faces: shape (N+1,)\n        x_centers: shape (N,)\n    \"\"\"\n    x_centers, x_faces, skewness = make_grid(N, L, s)\n    dx = L / N\n\n    u_c = manufactured_velocity(x_centers, U0, L)\n    p_c = manufactured_pressure(x_centers, 0.0, 10.0, L)\n\n    # Boundary faces: enforce exact velocity\n    u_faces = np.zeros(N + 1)\n    u_faces[0] = manufactured_velocity(x_faces[0], U0, L)\n    u_faces[-1] = manufactured_velocity(x_faces[-1], U0, L)\n\n    # Internal faces: i from 0 to N-2 correspond to face index f=i+1\n    for i in range(N - 1):\n        f = i + 1\n        ubar = 0.5 * (u_c[i] + u_c[i + 1])\n        # Local Pe using ubar magnitude\n        Pe = rho * abs(ubar) * dx / mu\n        Sk = skewness[i]\n        alpha = alpha_weight(Pe, Sk, c0, c1)\n        # Pressure gradient via neighbor difference\n        dpdx = (p_c[i + 1] - p_c[i]) / dx\n        K = dt / rho\n        u_faces[f] = ubar - alpha * K * dpdx\n\n    return u_faces, x_faces, x_centers\n\ndef compute_errors(u_faces, x_faces, x_centers, U0, L, rho, dx):\n    \"\"\"\n    Compute E_div and E_damp for given face and center velocities.\n    \"\"\"\n    N = x_centers.size\n    # Continuity residuals at cells\n    # Boundary faces indexed as 0 and N, internal as 1..N-1\n    # r_i = rho (u_{i+1/2} - u_{i-1/2}) / dx\n    r = rho * (u_faces[1:] - u_faces[:-1]) / dx\n    # Reference U_ref from exact center velocities\n    u_exact_c = manufactured_velocity(x_centers, U0, L)\n    U_ref = np.sqrt(np.mean(u_exact_c ** 2)) + 1e-16  # avoid zero divide\n    E_div = np.sqrt(np.mean(r ** 2)) / (rho * U_ref / dx)\n\n    # Over-damping error comparing face velocities to exact at face locations\n    u_exact_f = manufactured_velocity(x_faces, U0, L)\n    num = np.sqrt(np.mean((u_faces - u_exact_f) ** 2))\n    den = np.sqrt(np.mean(u_exact_f ** 2)) + 1e-16\n    E_damp = num / den\n\n    return E_div, E_damp\n\ndef calibrate_case(N, U0, mu, s, L=1.0, rho=1.0, dt=0.01):\n    \"\"\"\n    Grid search over c0 and c1 in {0.0, 0.1, ..., 1.0} to minimize J = E_div + E_damp.\n    Returns optimal c0, c1, E_div, E_damp.\n    \"\"\"\n    dx = L / N\n    best = None\n    for c0 in np.round(np.linspace(0.0, 1.0, 11), 1):\n        for c1 in np.round(np.linspace(0.0, 1.0, 11), 1):\n            u_faces, x_faces, x_centers = compute_face_velocities(N, L, U0, mu, rho, s, dt, c0, c1)\n            E_div, E_damp = compute_errors(u_faces, x_faces, x_centers, U0, L, rho, dx)\n            J = E_div + E_damp\n            if best is None or J  best[0]:\n                best = (J, float(c0), float(c1), E_div, E_damp)\n    # Return optimal coefficients and errors\n    _, c0_opt, c1_opt, E_div_opt, E_damp_opt = best\n    return c0_opt, c1_opt, E_div_opt, E_damp_opt\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (N, U0 [m/s], mu [kg/(m s)], s [skew amplitude])\n    test_cases = [\n        (64, 1.0, 0.01, 0.0),   # Happy path\n        (64, 5.0, 0.005, 0.0),  # High Peclet\n        (64, 1.0, 0.01, 0.3),   # High skewness\n        (64, 0.1, 0.05, 0.3),   # Low Peclet, high skewness\n    ]\n\n    results = []\n    for case in test_cases:\n        N, U0, mu, s = case\n        c0_opt, c1_opt, E_div_opt, E_damp_opt = calibrate_case(N, U0, mu, s)\n        # Round results for compact output\n        res = [round(c0_opt, 3), round(c1_opt, 3), round(E_div_opt, 6), round(E_damp_opt, 6)]\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists\n    def fmt_list(lst):\n        return \"[\" + \",\".join(map(str, lst)) + \"]\"\n    print(\"[\" + \",\".join(fmt_list(r) for r in results) + \"]\")\n\nsolve()\n```", "id": "3358711"}]}