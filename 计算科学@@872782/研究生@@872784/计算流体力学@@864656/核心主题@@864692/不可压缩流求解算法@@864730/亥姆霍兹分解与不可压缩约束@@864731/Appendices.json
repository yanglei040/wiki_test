{"hands_on_practices": [{"introduction": "第一个练习提供了一个基础的解析训练。通过使用傅里叶空间投影技术，将亥姆霍兹分解应用于一个已知的矢量场，您将直接体验将一个场分离为其无散（螺线管）和无旋（梯度）部分的数学机制。在处理更复杂的计算实现之前，这种纸笔练习对于建立直观理解至关重要。[@problem_id:3328644]", "problem": "考虑定义在双周期域 $[0,2\\pi] \\times [0,2\\pi]$ 上的二维速度场 $u(x,y) = \\left( \\cos x \\sin y,\\ -\\sin x \\cos y \\right)$，其具有周期性边界条件 (BCs)。在计算流体动力学中，亥姆霍兹分解将一个足够光滑的向量场表示为一个无旋（梯度）分量和一个螺线（无散）分量之和。在周期域上，该分解可以在傅里叶空间中通过将每个傅里叶模态投影到特定子空间来进行表征：对于螺线部分，投影到与波矢正交的子空间；对于无旋部分，投影到与波矢平行的子空间，同时为保证唯一性需满足适当的零均值条件。\n\n从不可压缩性约束和周期场的傅里叶级数表示出发，推导与无散子空间相关的模态投影算子。然后，使用此傅里叶空间投影计算 $u(x,y)$ 的亥姆霍兹分解：显式计算 $u(x,y)$ 的傅里叶系数，对每个模态应用推导出的投影以分离螺线和无旋分量，并重构得到的物理空间场。最后，通过 $u_{\\mathrm{sol}} = \\nabla^{\\perp} \\psi = \\left( \\partial_{y}\\psi,\\ -\\partial_{x}\\psi \\right)$ 用流函数 $\\psi(x,y)$ 表示螺线分量，通过 $u_{\\mathrm{irr}} = \\nabla \\phi$ 用标量势 $\\phi(x,y)$ 表示无旋分量，并对 $\\psi$ 和 $\\phi$ 施加零均值条件以确保唯一性。\n\n将最终答案以标量势的有序对 $(\\psi(x,y),\\ \\phi(x,y))$ 的形式给出。最终表达式无需四舍五入，也不涉及物理单位。", "solution": "该问题要求使用傅里叶空间投影方法，将给定在双周期域上的二维向量场 $u(x,y)$ 分解为其螺线（无散）和无旋（无旋度）分量。最终目标是求出相关的流函数 $\\psi(x,y)$ 和标量势 $\\phi(x,y)$。\n\n首先，我们推导用于无散子空间的通用模态投影算子。周期域 $[0, 2\\pi] \\times [0, 2\\pi]$ 上的向量场 $v(x,y)$ 可以用其复傅里叶级数表示：\n$$ v(x,y) = \\sum_{k \\in \\mathbb{Z}^2} \\hat{v}(k) \\exp(i k \\cdot x) $$\n其中 $x = (x,y)$ 是位置向量，$k = (k_x, k_y)$ 是具有整数分量的波矢，$\\hat{v}(k)$ 是模态 $k$ 的傅里叶系数向量。物理空间中的散度算子 $\\nabla \\cdot$ 对应于傅里叶空间中的乘法 $i k \\cdot$。如果 $\\nabla \\cdot v = 0$，则向量场 $v$ 是螺线场。在傅里叶空间中，此条件变为：\n$$ \\widehat{\\nabla \\cdot v}(k) = i k \\cdot \\hat{v}(k) = 0 $$\n该方程表明，对于每个波矢 $k \\neq (0,0)$，螺线场的傅里叶系数向量 $\\hat{v}(k)$ 必须与 $k$ 正交。\n\n亥姆霍兹分解定理指出，任何足够光滑的向量场 $u$ 都可以写成一个无旋部分 $u_{\\mathrm{irr}}$ 和一个螺线部分 $u_{\\mathrm{sol}}$ 的和：$u = u_{\\mathrm{irr}} + u_{\\mathrm{sol}}$。在傅里叶空间中，这表示为 $\\hat{u}(k) = \\hat{u}_{\\mathrm{irr}}(k) + \\hat{u}_{\\mathrm{sol}}(k)$。无旋分量是标量势的梯度，$u_{\\mathrm{irr}} = \\nabla \\phi$，在傅里叶空间中为 $\\hat{u}_{\\mathrm{irr}}(k) = i k \\hat{\\phi}(k)$。这意味着 $\\hat{u}_{\\mathrm{irr}}(k)$ 平行于波矢 $k$。\n\n给定一个任意傅里叶模态 $\\hat{u}(k)$，我们可以将其投影到与 $k$ 平行的子空间上，以求得其无旋分量。投影到 $k$ 方向的投影算子由 $\\frac{k \\otimes k}{|k|^2}$ 给出，其中 $\\otimes$ 表示外积。\n$$ \\hat{u}_{\\mathrm{irr}}(k) = \\left( \\frac{k \\otimes k}{|k|^2} \\right) \\hat{u}(k) = \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k $$\n螺线分量是剩余的部分，它与 $k$ 正交：\n$$ \\hat{u}_{\\mathrm{sol}}(k) = \\hat{u}(k) - \\hat{u}_{\\mathrm{irr}}(k) = \\hat{u}(k) - \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k $$\n因此，与无散（螺线）子空间相关的模态投影算子是 $P_S(k) = I - \\frac{k \\otimes k}{|k|^2}$，其中 $I$ 是单位矩阵。该算子将向量 $\\hat{u}(k)$ 投影到与 $k$ 垂直的空间上。此推导对 $k \\ne (0,0)$ 有效。对于代表平均流的 $k=(0,0)$，其散度平凡地为零。\n\n接下来，我们计算给定速度场 $u(x,y) = (\\cos x \\sin y, -\\sin x \\cos y)$ 的傅里叶系数。我们使用三角函数的欧拉公式：\n$\\cos\\theta = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta))$ 和 $\\sin\\theta = \\frac{1}{2i}(\\exp(i\\theta) - \\exp(-i\\theta))$。\n速度场的第一个分量是：\n$$ u_x(x,y) = \\cos x \\sin y = \\frac{1}{2}(\\exp(ix) + \\exp(-ix)) \\frac{1}{2i}(\\exp(iy) - \\exp(-iy)) $$\n$$ u_x(x,y) = \\frac{1}{4i} \\left( \\exp(i(x+y)) - \\exp(i(x-y)) + \\exp(i(-x+y)) - \\exp(i(-x-y)) \\right) $$\n第二个分量是：\n$$ u_y(x,y) = -\\sin x \\cos y = -\\frac{1}{2i}(\\exp(ix) - \\exp(-ix)) \\frac{1}{2}(\\exp(iy) + \\exp(-iy)) $$\n$$ u_y(x,y) = \\frac{-1}{4i} \\left( \\exp(i(x+y)) + \\exp(i(x-y)) - \\exp(i(-x+y)) - \\exp(i(-x-y)) \\right) $$\n从这些表达式中，我们辨识出波矢 $k = (k_x, k_y)$ 的非零傅里叶系数 $\\hat{u}(k) = (\\hat{u}_x(k), \\hat{u}_y(k))$：\n对于 $k=(1,1)$: $\\hat{u}(1,1) = (\\frac{1}{4i}, \\frac{-1}{4i}) = -\\frac{i}{4}(1, -1)$。\n对于 $k=(1,-1)$: $\\hat{u}(1,-1) = (\\frac{-1}{4i}, \\frac{-1}{4i}) = \\frac{i}{4}(1, 1)$。\n对于 $k=(-1,1)$: $\\hat{u}(-1,1) = (\\frac{1}{4i}, \\frac{1}{4i}) = -\\frac{i}{4}(1, 1)$。\n对于 $k=(-1,-1)$: $\\hat{u}(-1,-1) = (\\frac{-1}{4i}, \\frac{1}{4i}) = \\frac{i}{4}(1, -1)$。\n所有其他系数 $\\hat{u}(k)$ 均为零。平均流 $\\hat{u}(0,0)$ 为零。\n\n现在我们应用投影。对于每个非零模态，我们计算点积 $k \\cdot \\hat{u}(k)$：\n对于 $k=(1,1)$: $k \\cdot \\hat{u}(1,1) = (1,1) \\cdot (-\\frac{i}{4}(1, -1)) = -\\frac{i}{4}(1-1) = 0$。\n对于 $k=(1,-1)$: $k \\cdot \\hat{u}(1,-1) = (1,-1) \\cdot (\\frac{i}{4}(1, 1)) = \\frac{i}{4}(1-1) = 0$。\n对于 $k=(-1,1)$: $k \\cdot \\hat{u}(-1,1) = (-1,1) \\cdot (-\\frac{i}{4}(1, 1)) = -\\frac{i}{4}(-1+1) = 0$。\n对于 $k=(-1,-1)$: $k \\cdot \\hat{u}(-1,-1) = (-1,-1) \\cdot (\\frac{i}{4}(1, -1)) = \\frac{i}{4}(-1+1) = 0$。\n由于对所有波矢 $k$ 都有 $k \\cdot \\hat{u}(k) = 0$，因此 $\\hat{u}(k)$ 在 $k$ 上的投影对所有模态都为零。\n$$ \\hat{u}_{\\mathrm{irr}}(k) = \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k = 0 \\quad \\text{for all } k $$\n这意味着该场的无旋分量为零，$u_{\\mathrm{irr}}(x,y) = 0$。因此，整个场都是螺线场：$u_{\\mathrm{sol}}(x,y) = u(x,y)$。这可以通过直接计算散度来验证：\n$$ \\nabla \\cdot u = \\partial_x(\\cos x \\sin y) + \\partial_y(-\\sin x \\cos y) = -\\sin x \\sin y + \\sin x \\sin y = 0 $$\n由于 $u_{\\mathrm{irr}} = \\nabla \\phi = 0$，标量势 $\\phi(x,y)$ 必须是一个常数。问题要求为保证唯一性对势函数施加零均值条件。如果 $\\phi(x,y) = C$，其在域上的平均值为 $C$。因此，我们必须有 $C=0$，这给出 $\\phi(x,y) = 0$。\n\n接下来，我们求螺线分量 $u_{\\mathrm{sol}} = u$ 的流函数 $\\psi(x,y)$。流函数由 $u_{\\mathrm{sol}} = \\nabla^{\\perp} \\psi = (\\partial_y \\psi, -\\partial_x \\psi)$ 定义。这提供了一个偏微分方程组：\n1) $\\partial_y \\psi = u_{x} = \\cos x \\sin y$\n2) $-\\partial_x \\psi = u_{y} = -\\sin x \\cos y \\implies \\partial_x \\psi = \\sin x \\cos y$\n\n将第一个方程对 $y$ 积分：\n$$ \\psi(x,y) = \\int \\cos x \\sin y \\, dy = \\cos x \\int \\sin y \\, dy = -\\cos x \\cos y + f(x) $$\n其中 $f(x)$ 是一个相对于 $y$ 的积分“常数”。\n现在，将这个 $\\psi$ 的表达式对 $x$ 求导，并与第二个方程进行比较：\n$$ \\partial_x \\psi = \\partial_x(-\\cos x \\cos y + f(x)) = \\sin x \\cos y + f'(x) $$\n将此结果与 $\\partial_x \\psi = \\sin x \\cos y$ 比较，我们发现 $f'(x) = 0$。这意味着 $f(x)$ 是一个常数，我们记作 $C_0$。\n所以，流函数的通解是 $\\psi(x,y) = -\\cos x \\cos y + C_0$。\n\n为确保唯一解，问题对 $\\psi(x,y)$ 施加了零均值条件。我们计算 $\\psi$ 在域 $[0, 2\\pi] \\times [0, 2\\pi]$ 上的平均值：\n$$ \\langle \\psi \\rangle = \\frac{1}{(2\\pi)^2} \\int_0^{2\\pi} \\int_0^{2\\pi} (-\\cos x \\cos y + C_0) \\, dx \\, dy $$\n$$ \\langle \\psi \\rangle = -\\left(\\frac{1}{2\\pi}\\int_0^{2\\pi} \\cos x \\, dx\\right) \\left(\\frac{1}{2\\pi}\\int_0^{2\\pi} \\cos y \\, dy\\right) + \\frac{1}{(2\\pi)^2}\\int_0^{2\\pi} \\int_0^{2\\pi} C_0 \\, dx \\, dy $$\n由于 $\\int_0^{2\\pi} \\cos\\theta \\, d\\theta = [\\sin\\theta]_0^{2\\pi} = 0$，第一项为零。第二项的计算结果为 $C_0$。\n因此，$\\langle \\psi \\rangle = C_0$。零均值条件要求 $C_0 = 0$。\n唯一的流函数是 $\\psi(x,y) = -\\cos x \\cos y$。\n\n最终答案是标量势的有序对 $(\\psi(x,y), \\phi(x,y))$。", "answer": "$$\n\\boxed{\n(-\\cos x \\cos y, 0)\n}\n$$", "id": "3328644"}, {"introduction": "从理论转向一个常见的实践障碍，本问题探讨了在投影法中出现的压力泊松方程的相容性条件。您将探索一个场景，其中域内的非零散度与不正确的边界条件相结合，导致了一个不适定的问题。这个练习突出了全局质量守恒与投影步骤的数学可解性之间的关键联系，这是开发稳健的计算流体动力学（CFD）求解器的核心概念。[@problem_id:3328660]", "problem": "考虑计算流体动力学（CFD）中一种基于亥姆霍兹分解的不可压缩流标准投影法，其中预测速度场通过一个标量势投影到无散空间上。设域为单位正方形 $\\Omega = \\left[0,1\\right] \\times \\left[0,1\\right]$，其边界 $\\partial \\Omega$ 上的单位外法向量为 $\\mathbf{n}$。假设所有变量均为无量纲。\n\n一个预测速度 $\\mathbf{u}^{\\ast} : \\Omega \\to \\mathbb{R}^{2}$ 是通过一个显式平流-扩散步骤计算得出的，该步骤未在固壁上施加无穿透条件。取特定的预测速度\n$$\n\\mathbf{u}^{\\ast}(x,y) = \\begin{pmatrix} x \\\\ 0 \\end{pmatrix}.\n$$\n投影步骤旨在寻找一个标量 $\\phi$，使得校正后的速度 $\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla \\phi$ 是无散的。标量 $\\phi$ 通过求解一个泊松方程得到，其诺伊曼边界条件由 $\\mathbf{u}^{\\ast}$ 的法向分量和物理边界条件确定。然而，假设一个实现者错误地在 $\\partial \\Omega$ 上施加了齐次诺伊曼边界条件 $\\frac{\\partial \\phi}{\\partial n} = 0$。\n\n仅从散度定理、不可压缩性约束以及投影法的亥姆霍兹分解结构出发，完成以下任务：\n\n1. 计算 $\\mathbf{u}^{\\ast}$ 通过 $\\partial \\Omega$ 的净通量，并计算 $\\nabla \\cdot \\mathbf{u}^{\\ast}$ 在 $\\Omega$ 上的体积积分。解释这两个量之间的关系。\n2. 利用投影中出现的泊松方程的诺伊曼问题可解性条件，精确地说明对于此 $\\mathbf{u}^{\\ast}$，错误的齐次诺伊曼边界条件如何违反相容性。\n3. 为了仅通过边界调整在预测速度层级上恢复全局质量守恒，假设你决定仅修改右边界 $x = 1$，通过对其上 $\\mathbf{u}^{\\ast}$ 的法向分量施加一个均匀常数偏移量 $\\alpha$，同时保持其他三边不变。也就是说，对于所有 $y \\in \\left[0,1\\right]$，将 $q_{R}(y) = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n}\\big|_{x=1,y}$ 替换为 $q_{R}^{\\mathrm{corr}}(y) = q_{R}(y) - \\alpha$。确定使通过 $\\partial \\Omega$ 的净通量等于零的常数 $\\alpha$ 的唯一值。\n4. 指出为从根本上避免不相容性，算法中必须校正哪个物理边界条件。\n\n仅报告 $\\alpha$ 的值作为你的最终数值答案（不需要单位，也无需四舍五入）。", "solution": "所提供的问题是计算流体动力学中的一个有效练习，具体涉及不可压缩流投影法中出现的压力泊松方程的相容性条件。该问题具有科学依据，是适定的、客观的。我们将逐步进行求解。\n\n设域为单位正方形 $\\Omega = [0,1] \\times [0,1]$，预测速度场为 $\\mathbf{u}^{\\ast}(x,y) = \\begin{pmatrix} x \\\\ 0 \\end{pmatrix}$。\n\n**1. $\\mathbf{u}^{\\ast}$ 的净通量和散度积分**\n\n首先，我们计算 $\\mathbf{u}^{\\ast}$ 通过边界 $\\partial \\Omega$ 的净通量。该边界由四段组成：\n- 左边界（$x=0$, $y \\in [0,1]$）：外法向量 $\\mathbf{n} = (-1, 0)$。速度为 $\\mathbf{u}^{\\ast}(0,y) = (0,0)$。\n- 右边界（$x=1$, $y \\in [0,1]$）：外法向量 $\\mathbf{n} = (1, 0)$。速度为 $\\mathbf{u}^{\\ast}(1,y) = (1,0)$。\n- 下边界（$y=0$, $x \\in [0,1]$）：外法向量 $\\mathbf{n} = (0, -1)$。速度为 $\\mathbf{u}^{\\ast}(x,0) = (x,0)$。\n- 上边界（$y=1$, $x \\in [0,1]$）：外法向量 $\\mathbf{n} = (0, 1)$。速度为 $\\mathbf{u}^{\\ast}(x,1) = (x,0)$。\n\n净通量是这四段上积分的总和：\n$$\n\\oint_{\\partial\\Omega} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS = \\int_{\\text{left}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS + \\int_{\\text{right}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS + \\int_{\\text{bottom}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS + \\int_{\\text{top}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS\n$$\n计算每一项：\n- 左边界：$\\int_0^1 \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix} dy = \\int_0^1 0 \\, dy = 0$。\n- 右边界：$\\int_0^1 \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} dy = \\int_0^1 1 \\, dy = 1$。\n- 下边界：$\\int_0^1 \\begin{pmatrix} x \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} dx = \\int_0^1 0 \\, dx = 0$。\n- 上边界：$\\int_0^1 \\begin{pmatrix} x \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} dx = \\int_0^1 0 \\, dx = 0$。\n\n总净通量为 $0 + 1 + 0 + 0 = 1$。\n\n接下来，我们计算 $\\mathbf{u}^{\\ast}$ 的散度在 $\\Omega$ 上的体积积分。$\\mathbf{u}^{\\ast} = \\begin{pmatrix} u^{\\ast} \\\\ v^{\\ast} \\end{pmatrix} = \\begin{pmatrix} x \\\\ 0 \\end{pmatrix}$ 的散度为：\n$$\n\\nabla \\cdot \\mathbf{u}^{\\ast} = \\frac{\\partial u^{\\ast}}{\\partial x} + \\frac{\\partial v^{\\ast}}{\\partial y} = \\frac{\\partial(x)}{\\partial x} + \\frac{\\partial(0)}{\\partial y} = 1 + 0 = 1\n$$\n散度在域 $\\Omega$ 上的积分为：\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{u}^{\\ast}) \\, dA = \\int_0^1 \\int_0^1 1 \\, dx \\, dy = 1\n$$\n这两个量之间的关系由散度定理（也称高斯定理）给出，该定理指出，对于定义在具有分段光滑边界 $\\partial\\Omega$ 的域 $\\Omega$ 上的向量场 $\\mathbf{F}$：\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\, dA = \\oint_{\\partial\\Omega} \\mathbf{F} \\cdot \\mathbf{n} \\, dS\n$$\n在我们的例子中，$\\mathbf{F} = \\mathbf{u}^{\\ast}$，我们发现 $\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{u}^{\\ast}) \\, dA = 1$ 且 $\\oint_{\\partial\\Omega} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS = 1$，这验证了该定理。\n\n**2. 违反诺伊曼问题可解性条件**\n\n投影步骤使用标量势 $\\phi$ 来校正预测速度 $\\mathbf{u}^{\\ast}$：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - c \\nabla \\phi\n$$\n其中 $c = \\frac{\\Delta t}{\\rho}$ 是一个常数。校正后的速度 $\\mathbf{u}^{n+1}$ 必须是无散的，即 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$。对校正方程取散度可得：\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^{\\ast} - c \\nabla \\cdot (\\nabla \\phi) = \\nabla \\cdot \\mathbf{u}^{\\ast} - c \\nabla^2 \\phi\n$$\n令 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 可得出关于 $\\phi$ 的泊松方程：\n$$\n\\nabla^2 \\phi = \\frac{1}{c} \\nabla \\cdot \\mathbf{u}^{\\ast}\n$$\n不可压缩流体在固壁上的物理边界条件是无穿透，即 $\\mathbf{u}^{n+1} \\cdot \\mathbf{n} = 0$。将校正方程投影到法向量 $\\mathbf{n}$ 上可得：\n$$\n\\mathbf{u}^{n+1} \\cdot \\mathbf{n} = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} - c (\\nabla \\phi \\cdot \\mathbf{n}) = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} - c \\frac{\\partial \\phi}{\\partial n}\n$$\n应用无穿透条件可得出 $\\phi$ 的正确诺伊曼边界条件：\n$$\n\\frac{\\partial \\phi}{\\partial n} = \\frac{1}{c} (\\mathbf{u}^{\\ast} \\cdot \\mathbf{n})\n$$\n对于 $\\Omega$ 中的诺伊曼问题 $\\nabla^2 \\phi = f$ 及其边界条件 $\\frac{\\partial \\phi}{\\partial n} = g$（在 $\\partial\\Omega$ 上），其可解性条件（弗雷德霍姆择一定理的一个推论）要求源项的域积分等于法向导数的边界积分。这是将散度定理应用于 $\\nabla\\phi$ 推导出来的：\n$$\n\\iint_{\\Omega} \\nabla^2 \\phi \\, dA = \\iint_{\\Omega} \\nabla \\cdot (\\nabla \\phi) \\, dA = \\oint_{\\partial \\Omega} \\nabla \\phi \\cdot \\mathbf{n} \\, dS = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\, dS\n$$\n代入我们的特定源项 $f = \\frac{1}{c} \\nabla \\cdot \\mathbf{u}^{\\ast}$ 和错误的边界条件 $g=\\frac{\\partial \\phi}{\\partial n} = 0$，相容性条件变为：\n$$\n\\iint_{\\Omega} \\frac{1}{c} (\\nabla \\cdot \\mathbf{u}^{\\ast}) \\, dA = \\oint_{\\partial \\Omega} 0 \\, dS\n$$\n计算两边：\n- 左边：$\\frac{1}{c} \\iint_{\\Omega} 1 \\, dA = \\frac{1}{c} \\cdot (\\text{Area of } \\Omega) = \\frac{1}{c} \\cdot 1 = \\frac{1}{c}$。\n- 右边：$\\oint_{\\partial \\Omega} 0 \\, dS = 0$。\n因此条件简化为 $\\frac{1}{c} = 0$，这是一个矛盾，因为 $c = \\frac{\\Delta t}{\\rho}$ 是有限的非零值。这表明，对于带有错误的齐次诺伊曼边界条件的 $\\phi$ 问题是病态的，并且没有解。\n\n**3. 边界校正量 $\\alpha$ 的确定**\n\n预测速度层级上的全局质量守恒意味着预测速度通过域边界的净通量必须为零。原始净通量为 $1$。我们希望修改边界上 $\\mathbf{u}^{\\ast}$ 的法向分量，使总通量为零。修改方法是仅在右边界 $x=1$ 上对 $\\mathbf{u}^{\\ast}$ 的法向分量施加一个均匀常数偏移量 $-\\alpha$。\n\n右边界上的原始通量为：\n$$\n\\text{Flux}_{\\text{right}} = \\int_0^1 (\\mathbf{u}^{\\ast} \\cdot \\mathbf{n}) \\bigg|_{x=1} \\, dy = \\int_0^1 1 \\, dy = 1\n$$\n右边界上的速度法向分量为 $q_{R}(y) = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n}|_{x=1,y} = 1$。校正后的法向分量为 $q_{R}^{\\mathrm{corr}}(y) = q_{R}(y) - \\alpha = 1 - \\alpha$。\n右边界上的新通量为：\n$$\n\\text{Flux}_{\\text{right}}^{\\mathrm{corr}} = \\int_0^1 (1-\\alpha) \\, dy = (1-\\alpha) [y]_0^1 = 1-\\alpha\n$$\n其他三个边界（左、下、上）的通量均为零且保持不变。新的总净通量为：\n$$\n\\text{Flux}_{\\text{net}}^{\\mathrm{corr}} = \\text{Flux}_{\\text{left}} + \\text{Flux}_{\\text{right}}^{\\mathrm{corr}} + \\text{Flux}_{\\text{bottom}} + \\text{Flux}_{\\text{top}} = 0 + (1-\\alpha) + 0 + 0 = 1-\\alpha\n$$\n为恢复全局质量守恒，我们将净通量设为零：\n$$\n\\text{Flux}_{\\text{net}}^{\\mathrm{corr}} = 0 \\implies 1-\\alpha = 0 \\implies \\alpha=1\n$$\n因此，常数偏移量的唯一值为 $\\alpha=1$。\n\n**4. 需要校正的物理边界条件**\n\n不相容性的产生是因为预测速度 $\\mathbf{u}^{\\ast}$ 不满足流动的物理边界条件。具体来说，对于不可渗透的固壁，垂直于边界的速度分量必须为零（无穿透条件），即 $\\mathbf{u} \\cdot \\mathbf{n} = 0$。\n\n我们来检查给定预测场 $\\mathbf{u}^{\\ast} = (x,0)$ 在单位正方形边界上的情况：\n- 在右壁（$x=1$），外法向量为 $\\mathbf{n}=(1,0)$。预测速度的法向分量为 $\\mathbf{u}^{\\ast} \\cdot \\mathbf{n} = (1,0) \\cdot (1,0) = 1$。这不为零，违反了无穿透条件。\n- 在其他壁面（左、上、下），$\\mathbf{u}^{\\ast}$ 的法向分量为零，因此在那里条件是满足的。\n\n算法中的根本缺陷在于计算 $\\mathbf{u}^{\\ast}$ 的中间步骤（预测步骤，例如，通过显式平流-扩散更新）没有施加无穿透边界条件。必须正确处理的物理边界条件是**固壁上速度场的无穿透条件（$\\mathbf{u} \\cdot \\mathbf{n} = 0$）**。这个条件应该在执行投影步骤之前施加到预测场 $\\mathbf{u}^{\\ast}$ 上。\n\n最终要求的答案仅为 $\\alpha$ 的值。", "answer": "$$\n\\boxed{1}\n$$", "id": "3328660"}, {"introduction": "最后的实践是一个完整的计算练习，您将使用快速傅里叶变换（FFT）实现一种谱投影方法来执行亥姆霍兹分解。您将构建一个具有已知分量的合成速度场，然后分析一个关键的数值误差来源：混叠（aliasing）。通过比较充分解析和欠解析的情况，您将量化在粗网格上对高频波进行采样如何污染投影，导致无旋能量“泄漏”到计算出的无散场中。[@problem_id:3328699]", "problem": "考虑一个边长为 $L_x = 2\\pi$ 和 $L_y = 2\\pi$ 的二维周期性计算域。您将使用谱方法，在不可压缩约束下，为一个合成速度场实现、验证并分析 Helmholtz 分解。该分解旨在将一个矢量场 $\\mathbf{u}(\\mathbf{x})$ 在周期性区域上表示为一个螺线（无散度）部分和一个无旋（无旋度）部分之和。您必须构建一个具有已知螺线和无旋分量的合成场，使用基于快速傅里叶变换 (FFT) 的泊松求解器将其数值投影到无散度子空间上，并量化由欠解析采样引起的混叠污染。\n\n推导和实现必须从基本原理和经过充分检验的事实出发：\n- 不可压缩约束为 $\\nabla \\cdot \\mathbf{u} = 0$。\n- 在周期域上（对于足够光滑的场），Helmholtz 分解保证了矢量场可以唯一地分解为一个无旋（梯度）分量和一个螺线（无散度）分量，其分解在不影响梯度或散度的相加常数范围内是唯一的。\n- 周期域上的傅里叶基函数可以使常系数线性微分算子对角化。在均匀离散并以谱方法处理的域上，求导对应于在傅里叶空间中乘以相应的波数。\n\n您将按以下步骤进行。\n1) 在一个均匀的 $N \\times N$ 网格上构建一个合成速度场 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{u}_{\\mathrm{sol}}(\\mathbf{x}) + \\mathbf{u}_{\\mathrm{irr}}(\\mathbf{x})$，其中 $x \\in [0, 2\\pi)$，$y \\in [0, 2\\pi)$。使用以下势函数\n- 一个流函数 $\\psi(\\mathbf{x})$，通过 $\\mathbf{u}_{\\mathrm{sol}} = \\nabla \\times (\\psi \\,\\hat{\\mathbf{e}}_z) = \\left(\\partial_y \\psi, -\\partial_x \\psi\\right)$ 生成螺线部分，\n- 一个标量势 $\\phi(\\mathbf{x})$，通过 $\\mathbf{u}_{\\mathrm{irr}} = \\nabla \\phi = \\left(\\partial_x \\phi, \\partial_y \\phi\\right)$ 生成无旋部分，\n其中势函数由单平面波模式定义：\n$$\n\\psi(\\mathbf{x}) = \\sin\\!\\left(k_{s,x} x + k_{s,y} y\\right), \\qquad\n\\phi(\\mathbf{x}) = \\sin\\!\\left(k_{i,x} x + k_{i,y} y\\right).\n$$\n振幅是无量纲的，并设为1。\n\n2) 根据不可压缩约束和 Helmholtz 分解的定义，推导出一个谱投影，通过求解与无旋分量相关的标量势的泊松方程，将任意矢量场 $\\mathbf{u}$ 映射到其在周期网格上的无散度分量。使用快速傅里叶变换 (FFT) 在物理空间和谱空间之间转换，并利用拉普拉斯算子和梯度/散度算子在谱空间中的对角结构来实现此投影。\n\n3) 对于下面指定的每个测试用例，计算三个诊断量：\n- 投影场的相对散度，\n$$\nr_{\\mathrm{div}} = \\frac{\\|\\nabla \\cdot \\mathbf{u}_{\\mathrm{proj}}\\|_{2}}{\\|\\mathbf{u}_{\\mathrm{proj}}\\|_{2}},\n$$\n- 螺线部分的相对恢复误差，\n$$\nr_{\\mathrm{rec}} = \\frac{\\|\\mathbf{u}_{\\mathrm{proj}} - \\mathbf{u}_{\\mathrm{sol,ref}}\\|_{2}}{\\|\\mathbf{u}_{\\mathrm{sol,ref}}\\|_{2}},\n$$\n- 无旋部分泄漏到无散度子空间的相对量，\n$$\nr_{\\mathrm{leak}} = \\frac{\\|\\mathcal{P}\\,\\mathbf{u}_{\\mathrm{irr,ref}}\\|_{2}}{\\|\\mathbf{u}_{\\mathrm{irr,ref}}\\|_{2}},\n$$\n其中 $\\|\\cdot\\|_{2}$ 是在 $N \\times N$ 网格上的离散均方根范数（即平方值均值的平方根），$\\mathbf{u}_{\\mathrm{proj}}$ 是从总场 $\\mathbf{u}$ 获得的数值投影无散度场，$\\mathcal{P}$ 表示无散度投影算子，而参考场 $\\mathbf{u}_{\\mathrm{sol,ref}}$ 和 $\\mathbf{u}_{\\mathrm{irr,ref}}$ 是在相同网格上直接由上述势函数构建的场，并应用了与投影前对总场相同的预处理（在本问题中，没有应用滤波；因此参考场就是相应的采样场）。\n\n4) 通过比较指定波数被采样网格良好解析的情况与指定波数超过奈奎斯特极限的情况，来分析混叠引起的污染。在欠解析的情况下，在网格点上对高波数平面波进行采样会产生一个具有不同波矢的混叠波。因为采样场的矢量振幅是由真实（未混叠）波矢决定的，所以它不一定与离散算子使用的混叠波矢垂直或平行。因此，离散 Helmholtz 投影将无法完美恢复原始的螺线分量，也无法完全拒绝无旋分量；您的诊断量将量化此效应。\n\n需遵循的数值和实现细节：\n- 使用均匀网格，$x_j = 2\\pi\\, j / N$，$y_\\ell = 2\\pi\\, \\ell / N$，其中 $j,\\ell \\in \\{0,1,\\dots,N-1\\}$。\n- 使用与 $L_x = L_y = 2\\pi$ 选择一致的谱微分，以便物理波数是由 FFT 频率规定生成的整数数组，且傅里叶空间中的导数对应于乘以 $\\mathrm{i} k$。\n- 单独处理零波矢，以避免在对拉普拉斯算子求逆时出现除以零的情况。零模式的精确约定不影响此处定义的场的诊断结果，因为它们的空间平均值为零。\n- 所有量都是无量纲的；不需要物理单位。\n\n测试套件：\n您的程序必须运行以下四个测试用例，并将结果汇总为单个输出。\n- Case 1: $N = 64$, $\\mathbf{k}_s = (2,3)$, $\\mathbf{k}_i = (1,4)$。\n- Case 2: $N = 64$, $\\mathbf{k}_s = (31,30)$, $\\mathbf{k}_i = (29,1)$。\n- Case 3: $N = 32$, $\\mathbf{k}_s = (25,7)$, $\\mathbf{k}_i = (22,5)$。\n- Case 4: $N = 64$, $\\mathbf{k}_s = (25,7)$, $\\mathbf{k}_i = (22,5)$。\n\n对于每个用例，计算并报告列表 $[r_{\\mathrm{div}}, r_{\\mathrm{rec}}, r_{\\mathrm{leak}}]$，每个值四舍五入到六位小数。\n\n最终输出格式：\n您的程序应生成单行输出，包含四个用例结果的嵌套、逗号分隔列表，不含空格，每个浮点值四舍五入到六位小数。例如，输出必须具有以下形式：\n$[[a_{11},a_{12},a_{13}],[a_{21},a_{22},a_{23}],[a_{31},a_{32},a_{33}],[a_{41},a_{42},a_{43}]]$\n其中每个 $a_{ij}$ 是一个四舍五入到六位小数的浮点数。\n\n您提交的内容必须是一个完整的、可运行的程序，该程序无需任何外部输入即可执行所有计算，并仅以上述确切格式打印最终行。", "solution": "该问题要求在二维周期域上使用谱方法实现和验证 Helmholtz 分解。目标是将给定的矢量场分离为其螺线（无散度）和无旋（无旋度）分量，并分析数值误差，特别是混叠引起的误差。\n\n### 理论基础：Helmholtz 分解与泊松方程\n\nHelmholtz 分解定理指出，周期域上任何足够光滑的矢量场 $\\mathbf{u}$ 都可以（在相加常数范围内）唯一地表示为一个无旋场 $\\mathbf{u}_{\\mathrm{irr}}$ 和一个螺线场 $\\mathbf{u}_{\\mathrm{sol}}$ 的和：\n$$\n\\mathbf{u} = \\mathbf{u}_{\\mathrm{irr}} + \\mathbf{u}_{\\mathrm{sol}}\n$$\n根据定义，无旋分量是无旋度的，$\\nabla \\times \\mathbf{u}_{\\mathrm{irr}} = \\mathbf{0}$，这意味着它可以写成一个标量势的梯度，即 $\\mathbf{u}_{\\mathrm{irr}} = \\nabla \\phi$。螺线分量是无散度的，$\\nabla \\cdot \\mathbf{u}_{\\mathrm{sol}} = 0$。在二维情况下，这使得它可以表示为一个流函数的旋度，即 $\\mathbf{u}_{\\mathrm{sol}} = \\nabla \\times (\\psi \\hat{\\mathbf{e}}_z)$。\n\n为了找到 $\\mathbf{u}$ 在螺线子空间上的投影，我们必须找到并减去其无旋部分。我们可以通过对分解式取散度来推导标量势 $\\phi$ 的方程：\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi + \\mathbf{u}_{\\mathrm{sol}})\n$$\n利用散度算子的线性和螺线场的定义属性 $\\nabla \\cdot \\mathbf{u}_{\\mathrm{sol}} = 0$，我们得到：\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi\n$$\n这是一个关于标量势 $\\phi$ 的泊松方程，其源项是原始场 $\\mathbf{u}$ 的散度。一旦我们解出这个方程得到 $\\phi$，就可以构造无旋分量 $\\mathbf{u}_{\\mathrm{irr}} = \\nabla \\phi$。然后通过相减得到所需的螺线分量，我们称之为投影场 $\\mathbf{u}_{\\mathrm{proj}}$：\n$$\n\\mathbf{u}_{\\mathrm{proj}} = \\mathcal{P}(\\mathbf{u}) = \\mathbf{u} - \\mathbf{u}_{\\mathrm{irr}} = \\mathbf{u} - \\nabla \\phi\n$$\n这里，$\\mathcal{P}$ 代表到无散度场空间的投影算子。\n\n### 谱方法实现\n\n问题设定在大小为 $L_x = 2\\pi$ 乘 $L_y = 2\\pi$ 的周期域上，这对于基于快速傅里叶变换 (FFT) 的谱方法来说是理想的。在傅里葉空間中，微分算子變為代數算子。对于函数 $f(\\mathbf{x})$，其傅里叶变换为 $\\hat{f}(\\mathbf{k}) = \\mathcal{F}\\{f(\\mathbf{x})\\}$，其中 $\\mathbf{k} = (k_x, k_y)$ 是整数波矢。关键属性如下：\n- 梯度：$\\mathcal{F}\\{\\nabla f\\} = i\\mathbf{k} \\hat{f}(\\mathbf{k})$\n- 散度：$\\mathcal{F}\\{\\nabla \\cdot \\mathbf{u}\\} = i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})$\n- 拉普拉斯算子：$\\mathcal{F}\\{\\nabla^2 f\\} = -|\\mathbf{k}|^2 \\hat{f}(\\mathbf{k})$，其中 $|\\mathbf{k}|^2 = k_x^2 + k_y^2$。\n\n将泊松方程 $\\nabla^2 \\phi = \\nabla \\cdot \\mathbf{u}$ 变换到傅里叶空间，得到：\n$$\n-|\\mathbf{k}|^2 \\hat{\\phi}(\\mathbf{k}) = i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})\n$$\n我们可以解出标量势的傅里叶系数 $\\hat{\\phi}(\\mathbf{k})$：\n$$\n\\hat{\\phi}(\\mathbf{k}) = -\\frac{i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})}{|\\mathbf{k}|^2}\n$$\n对于零波数模式 $\\mathbf{k} = (0, 0)$，其中 $|\\mathbf{k}|^2 = 0$，此表达式无定义。该模式对应于势的空间平均值 $\\phi_0$。由于常数的梯度为零，$\\phi_0$ 是任意的，不影响速度场。我们按照惯例设定 $\\hat{\\phi}(\\mathbf{0}) = 0$。\n\n对一个场 $\\mathbf{u}=(u_x, u_y)$ 进行投影的完整数值算法如下：\n1.  计算速度分量的二维 FFT：$\\hat{u}_x(\\mathbf{k}) = \\mathcal{F}\\{u_x(\\mathbf{x})\\}$ 和 $\\hat{u}_y(\\mathbf{k}) = \\mathcal{F}\\{u_y(\\mathbf{x})\\}$。\n2.  在傅里叶空间中计算散度的 FFT：$\\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k}) = i k_x \\hat{u}_x(\\mathbf{k}) + i k_y \\hat{u}_y(\\mathbf{k})$。\n3.  在傅里叶空间中求解势：对于 $\\mathbf{k} \\neq \\mathbf{0}$，$\\hat{\\phi}(\\mathbf{k}) = \\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k}) / (-|\\mathbf{k}|^2)$，并且 $\\hat{\\phi}(\\mathbf{0}) = 0$。\n4.  计算无旋速度分量的 FFT：$\\hat{\\mathbf{u}}_{\\mathrm{irr}}(\\mathbf{k}) = (i k_x \\hat{\\phi}(\\mathbf{k}), i k_y \\hat{\\phi}(\\mathbf{k}))$。\n5.  在傅里叶空间中减去无旋分量以获得投影场：$\\hat{\\mathbf{u}}_{\\mathrm{proj}}(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - \\hat{\\mathbf{u}}_{\\mathrm{irr}}(\\mathbf{k})$。\n6.  计算二维逆 FFT 以获得物理空间中的投影场：$\\mathbf{u}_{\\mathrm{proj}}(\\mathbf{x}) = \\mathcal{F}^{-1}\\{\\hat{\\mathbf{u}}_{\\mathrm{proj}}(\\mathbf{k})\\}$。\n\n### 合成场与混叠分析\n\n我们从已知的螺线部分 $\\mathbf{u}_{\\mathrm{sol,ref}}$ 和无旋部分 $\\mathbf{u}_{\\mathrm{irr,ref}}$ 构建一个合成速度场。\n给定 $\\psi(\\mathbf{x}) = \\sin(\\mathbf{k}_s \\cdot \\mathbf{x})$ 和 $\\phi(\\mathbf{x}) = \\sin(\\mathbf{k}_i \\cdot \\mathbf{x})$，解析场为：\n$$\n\\mathbf{u}_{\\mathrm{sol,ref}} = \\nabla \\times (\\psi \\hat{\\mathbf{e}}_z) = (k_{s,y}, -k_{s,x}) \\cos(\\mathbf{k}_s \\cdot \\mathbf{x})\n$$\n$$\n\\mathbf{u}_{\\mathrm{irr,ref}} = \\nabla \\phi = (k_{i,x}, k_{i,y}) \\cos(\\mathbf{k}_i \\cdot \\mathbf{x})\n$$\n问题的关键在于分析混叠现象。大小为 $N$ 的离散网格只能表示 jusqu'au 奈奎斯特极限 $|k|  N/2$ 的波数。当一个波数满足 $|k_x| \\ge N/2$ 或 $|k_y| \\ge N/2$ 的函数在网格上采样时，它会发生混叠：它变得与可表示范围内的一个较低波数 $k'$ 的波无法区分，其中 $k' \\equiv k \\pmod{N}$。\n\n这种混叠会污染 Helmholtz 分解。例如，解析的螺线场 $\\mathbf{u}_{\\mathrm{sol,ref}}$ 的矢量振幅 $(k_{s,y}, -k_{s,x})$ 与其波矢 $\\mathbf{k}_s$ 正交。当 $\\mathbf{k}_s$ 混叠为 $\\mathbf{k}'_s$ 时，离散梯度和散度算子的作用就像波矢是 $\\mathbf{k}'_s$ 一样。然而，采样到的振幅 $(k_{s,y}, -k_{s,x})$ 通常与*混叠*波矢 $\\mathbf{k}'_s$ 不正交。因此，采样得到的“螺线”场的离散散度非零，即 $\\nabla_h \\cdot \\mathbf{u}_{\\mathrm{sol,ref}} \\neq 0$。类似地，采样得到的“无旋”场的离散旋度也变为非零。基于这些离散算子的投影算子将无法完美地分离这些分量。这会导致非零的恢复误差 $r_{\\mathrm{rec}}$ 和泄漏误差 $r_{\\mathrm{leak}}$。\n\n测试用例旨在说明这一点。用例 1、2 和 4 使用的波数都被网格良好解析（$|\\mathbf{k}_{s,i}|  N/2$），其误差预期接近机器精度。用例 3 使用的波数超过了其网格（$N=32$）的奈奎斯特极限，导致显著的混叠，从而产生更大、可量化的误差。诊断量 $r_{\\mathrm{div}}$ 衡量最终投影场的散度，预期在所有情况下都接近于零，因为投影算子本身的构造就是为了产生一个相对于离散散度算子是无散度的场。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, (ksx, ksy), (kix, kiy))\n        (64, (2, 3), (1, 4)),\n        (64, (31, 30), (29, 1)),\n        (32, (25, 7), (22, 5)),\n        (64, (25, 7), (22, 5)),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, ks, ki = case\n        result_case = run_single_case(N, ks, ki)\n        results.append(result_case)\n\n    # Format the final output string exactly as specified.\n    outer_list = []\n    for result_case in results:\n        inner_list_str = '[' + ','.join([f'{x:.6f}' for x in result_case]) + ']'\n        outer_list.append(inner_list_str)\n    final_output = '[' + ','.join(outer_list) + ']'\n    \n    print(final_output)\n\ndef run_single_case(N, ks, ki):\n    \"\"\"\n    Performs the Helmholtz decomposition and computes diagnostics for a single test case.\n\n    Args:\n        N (int): Grid size (N x N).\n        ks (tuple): Wavenumber vector (kx, ky) for the solenoidal part.\n        ki (tuple): Wavenumber vector (kx, ky) for the irrotational part.\n\n    Returns:\n        list: A list containing [r_div, r_rec, r_leak] rounded to 6 decimal places.\n    \"\"\"\n    # 1. Setup Grid and Wavenumbers\n    x = (2 * np.pi / N) * np.arange(N)\n    y = (2 * np.pi / N) * np.arange(N)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    kx = np.fft.fftfreq(N) * N\n    ky = np.fft.fftfreq(N) * N\n    Kx, Ky = np.meshgrid(kx, ky, indexing='ij')\n    K2 = Kx**2 + Ky**2\n    \n    # Pre-calculate inverse Laplacian, handling the k=0 case\n    K2_inv = np.zeros_like(K2, dtype=float)\n    K2_inv[K2 > 0] = 1.0 / K2[K2 > 0]\n\n    # 2. Construct Reference Fields\n    # Solenoidal part: u = curl(psi * ez) = (d(psi)/dy, -d(psi)/dx)\n    # psi = sin(ksx*x + ksy*y)\n    arg_s = ks[0] * X + ks[1] * Y\n    cos_s = np.cos(arg_s)\n    u_sol_ref_x = ks[1] * cos_s\n    u_sol_ref_y = -ks[0] * cos_s\n    \n    # Irrotational part: u = grad(phi) = (d(phi)/dx, d(phi)/dy)\n    # phi = sin(kix*x + kiy*y)\n    arg_i = ki[0] * X + ki[1] * Y\n    cos_i = np.cos(arg_i)\n    u_irr_ref_x = ki[0] * cos_i\n    u_irr_ref_y = ki[1] * cos_i\n    \n    # Total synthetic field\n    u_total_x = u_sol_ref_x + u_irr_ref_x\n    u_total_y = u_sol_ref_y + u_irr_ref_y\n\n    # Helper functions for projection, divergence, and norms\n    def project(ux, uy):\n        ux_hat = np.fft.fft2(ux)\n        uy_hat = np.fft.fft2(uy)\n        \n        # phi_hat = -(i*Kx*ux_hat + i*Ky*uy_hat) / K2\n        phi_hat = -1j * (Kx * ux_hat + Ky * uy_hat) * K2_inv\n        \n        # u_irr_hat = (i*Kx*phi_hat, i*Ky*phi_hat)\n        u_irr_hat_x = 1j * Kx * phi_hat\n        u_irr_hat_y = 1j * Ky * phi_hat\n        \n        # u_proj_hat = u_hat - u_irr_hat\n        u_proj_hat_x = ux_hat - u_irr_hat_x\n        u_proj_hat_y = uy_hat - u_irr_hat_y\n        \n        u_proj_x = np.fft.ifft2(u_proj_hat_x).real\n        u_proj_y = np.fft.ifft2(u_proj_hat_y).real\n        \n        return u_proj_x, u_proj_y\n\n    def spectral_divergence(ux, uy):\n        ux_hat = np.fft.fft2(ux)\n        uy_hat = np.fft.fft2(uy)\n        div_hat = 1j * Kx * ux_hat + 1j * Ky * uy_hat\n        return np.fft.ifft2(div_hat).real\n\n    def rms_norm_scalar(field):\n        return np.sqrt(np.mean(field**2))\n    \n    def rms_norm_vector(field_x, field_y):\n        return np.sqrt(np.mean(field_x**2 + field_y**2))\n\n    # 3. Compute Projected Field and Diagnostics\n    \n    # A. Compute r_div\n    u_proj_x, u_proj_y = project(u_total_x, u_total_y)\n    div_u_proj = spectral_divergence(u_proj_x, u_proj_y)\n    norm_div_proj = rms_norm_scalar(div_u_proj)\n    norm_u_proj = rms_norm_vector(u_proj_x, u_proj_y)\n    r_div = norm_div_proj / norm_u_proj if norm_u_proj > 1e-15 else 0.0\n\n    # B. Compute r_rec\n    norm_sol_ref = rms_norm_vector(u_sol_ref_x, u_sol_ref_y)\n    norm_diff = rms_norm_vector(u_proj_x - u_sol_ref_x, u_proj_y - u_sol_ref_y)\n    r_rec = norm_diff / norm_sol_ref if norm_sol_ref > 1e-15 else 0.0\n    \n    # C. Compute r_leak\n    # Project the irrotational part to see how much \"leaks\" through\n    u_irr_proj_x, u_irr_proj_y = project(u_irr_ref_x, u_irr_ref_y)\n    norm_leak = rms_norm_vector(u_irr_proj_x, u_irr_proj_y)\n    norm_irr_ref = rms_norm_vector(u_irr_ref_x, u_irr_ref_y)\n    r_leak = norm_leak / norm_irr_ref if norm_irr_ref > 1e-15 else 0.0\n    \n    return [r_div, r_rec, r_leak]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3328699"}]}