{"hands_on_practices": [{"introduction": "在着手求解完整的黎曼问题之前，首先必须理解其基本构成模块。本练习旨在通过分析初始状态，来确定特征速度（即特征值），并预测将形成的波的类型（激波或稀疏波）。这种定性和半定量的分析是求解完整问题的基础 [@problem_id:3330277]。", "problem": "考虑理想气体的一维欧拉方程，其比热比 $\\gamma=1.4$。在 $x=0$ 处给定一个黎曼问题，其左状态为 $(\\rho_L,u_L,p_L)=(1.0,0.0,1.0)$，右状态为 $(\\rho_R,u_R,p_R)=(0.125,0.0,0.1)$，其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力。欧拉方程组允许存在三个特征场，其波速由通量雅可比矩阵在垂直于界面方向上的特征值确定。精确的自相似解由三个分隔常数状态的基本波组成，其中包括一个接触间断，其速度等于星区的速度 $u_\\star$。该速度是 Harten-Lax-van Leer-Contact (HLLC) 接触间断解析近似黎曼求解器使用的中波信号速度。\n\n从欧拉方程和理想气体状态方程出发，完成以下任务：\n\n(i) 根据当地流体速度 $u$ 和当地声速 $a$ 推导特征速度（特征值），并使用 $a=\\sqrt{\\gamma p/\\rho}$ 计算界面两侧的特征值。\n\n(ii) 仅使用激波（Rankine–Hugoniot 条件）和稀疏波（等熵自相似解和黎曼不变量）的第一性原理关系，判断精确解中的左行和右行非线性波是激波还是稀疏波。\n\n(iii) 使用 (ii) 中的适当关系，求解精确的黎曼问题，以确定星区压力 $p_\\star$ 和接触波（中波）速度 $u_\\star$。你最终报告的量应为接触波速度 $u_\\star$。\n\n以无量纲单位表示最终的接触波速度，并将答案四舍五入至五位有效数字。最终答案中不要提供其他任何量。", "solution": "问题陈述是黎曼问题的标准形式，具体来说是索德激波管问题（Sod shock tube problem），这是计算流体动力学中的一个典型测试案例。所有给定条件在物理上和数学上都是一致的，该问题是适定的。验证成功。\n\n(i) 特征速度（特征值）\n可压缩流体的一维欧拉方程可以写成向量形式 $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0$，其中状态向量 $\\mathbf{U}$ 和通量向量 $\\mathbf{F}$ 由下式给出\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad \\mathbf{F} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (E+p)u \\end{pmatrix}\n$$\n此处，$\\rho$ 是密度，$u$ 是速度，$p$ 是压力，$E$ 是单位体积的总能量，对于理想气体，$E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2$。系统的特征速度是通量雅可比矩阵 $\\mathbf{A} = \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{U}}$ 的特征值。\n\n从原始变量形式的方程 $\\frac{\\partial \\mathbf{W}}{\\partial t} + \\mathbf{A_p}(\\mathbf{W})\\frac{\\partial \\mathbf{W}}{\\partial x} = 0$ 中求特征值更为方便，其中 $\\mathbf{W} = (\\rho, u, p)^T$。此形式下的雅可比矩阵为\n$$\n\\mathbf{A_p} = \\begin{pmatrix} u  \\rho  0 \\\\ 0  u  1/\\rho \\\\ 0  \\gamma p  u \\end{pmatrix}\n$$\n特征值 $\\lambda$ 通过求解 $\\det(\\mathbf{A_p} - \\lambda \\mathbf{I}) = 0$ 得到：\n$$\n\\det \\begin{pmatrix} u-\\lambda  \\rho  0 \\\\ 0  u-\\lambda  1/\\rho \\\\ 0  \\gamma p  u-\\lambda \\end{pmatrix} = (u-\\lambda)\\left( (u-\\lambda)^2 - \\frac{\\gamma p}{\\rho} \\right) = 0\n$$\n将当地声速定义为 $a = \\sqrt{\\gamma p / \\rho}$，方程变为 $(u-\\lambda)((u-\\lambda)^2-a^2)=0$。三个特征值，或称特征波速，是：\n$$\n\\lambda_1 = u - a, \\quad \\lambda_2 = u, \\quad \\lambda_3 = u + a\n$$\n现在，我们为给定的左 (L) 和右 (R) 状态计算这些速度。\n给定：$\\gamma=1.4$。\n左状态：$(\\rho_L, u_L, p_L) = (1.0, 0.0, 1.0)$。\n左侧声速为 $a_L = \\sqrt{\\gamma p_L / \\rho_L} = \\sqrt{1.4 \\times 1.0 / 1.0} = \\sqrt{1.4}$。\n左状态的特征值为：\n$\\lambda_{1,L} = u_L - a_L = 0.0 - \\sqrt{1.4} = -\\sqrt{1.4}$\n$\\lambda_{2,L} = u_L = 0.0$\n$\\lambda_{3,L} = u_L + a_L = 0.0 + \\sqrt{1.4} = \\sqrt{1.4}$\n\n右状态：$(\\rho_R, u_R, p_R) = (0.125, 0.0, 0.1)$。\n右侧声速为 $a_R = \\sqrt{\\gamma p_R / \\rho_R} = \\sqrt{1.4 \\times 0.1 / 0.125} = \\sqrt{1.12}$。\n右状态的特征值为：\n$\\lambda_{1,R} = u_R - a_R = 0.0 - \\sqrt{1.12} = -\\sqrt{1.12}$\n$\\lambda_{2,R} = u_R = 0.0$\n$\\lambda_{3,R} = u_R + a_R = 0.0 + \\sqrt{1.12} = \\sqrt{1.12}$\n\n(ii) 波类型的确定\n黎曼问题的自相似解由三个分隔常数状态的波组成。这些波从原点 $x/t=0$ 处发出。中心波是一个接触间断，在其两侧压力和速度相等，即 $p_{\\star L} = p_{\\star R} = p_\\star$ 且 $u_{\\star L} = u_{\\star R} = u_\\star$。左行波和右行波可以是激波或稀疏波。\n\n波的类型由其两侧的压力变化决定。如果 $p_\\star  p_k$，则该波为激波（压缩波）。如果 $p_\\star  p_k$，则该波为稀疏波（膨胀波），其中 $k$ 可以是 L 或 R。\n在本问题中，$p_L = 1.0$，$p_R = 0.1$。左侧的高压气体会向右侧的低压区域膨胀。这一物理推理意味着星区中的气体速度 $u_\\star  0$。\n对于最初处于左状态的流体，要从 $u_L=0$ 加速到 $u_\\star  0$，它必须经历一个膨胀过程。这要求压力下降，因此 $p_\\star  p_L$。所以，左行波是一个稀疏波。\n对于最初处于右状态的流体，要被加速到 $u_\\star  0$ 并被压缩，其压力必须增加，因此 $p_\\star  p_R$。所以，右行波是一个激波。\n\n(iii) $p_\\star$ 和 $u_\\star$ 的精确解\n我们必须找到 $p_\\star$ 和 $u_\\star$ 的值，使其满足连接 L 状态与星区的左行稀疏波的物理关系，以及连接 R 状态与星区的右行激波的物理关系。\n\n对于左行稀疏波，$p_\\star$ 和 $u_\\star$ 之间的关系由黎曼不变量 $u + \\frac{2a}{\\gamma-1}$ 沿着特征线 $\\lambda_3 = u+a$ 的恒定性以及等熵关系 $p/\\rho^\\gamma = \\text{常数}$ 推导得出：\n$$\nu_\\star = u_L + \\frac{2a_L}{\\gamma-1} \\left[ 1 - \\left(\\frac{p_\\star}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right]\n$$\n对于右行激波，该关系由 Rankine-Hugoniot 跳跃条件推导得出：\n$$\nu_\\star = u_R + \\frac{p_\\star - p_R}{\\sqrt{\\rho_R \\left( \\frac{\\gamma-1}{2}p_R + \\frac{\\gamma+1}{2}p_\\star \\right)}}\n$$\n我们将两个关于 $u_\\star$ 的表达式设为相等，以获得一个关于 $p_\\star$ 的非线性方程。代入给定值：\n$u_L=0$，$p_L=1.0$，$a_L=\\sqrt{1.4}$\n$u_R=0$，$p_R=0.1$，$\\rho_R=0.125$\n$\\gamma=1.4$，$\\gamma-1=0.4$，$\\gamma+1=2.4$，$\\frac{\\gamma-1}{2\\gamma} = \\frac{1}{7}$。\n\n关于 $p_\\star$ 的方程变为：\n$$\n\\frac{2\\sqrt{1.4}}{0.4} \\left[ 1 - p_\\star^{1/7} \\right] = \\frac{p_\\star - 0.1}{\\sqrt{0.125 \\left( \\frac{0.4}{2}(0.1) + \\frac{2.4}{2}p_\\star \\right)}}\n$$\n$$\n5\\sqrt{1.4} (1 - p_\\star^{1/7}) = \\frac{p_\\star - 0.1}{\\sqrt{0.125 (0.02 + 1.2 p_\\star)}}\n$$\n这是一个关于 $p_\\star$ 的超越方程，必须通过数值方法求解。使用迭代求根方法（例如，牛顿法或二分法），我们求得星区压力解为：\n$$\np_\\star \\approx 0.303130\n$$\n该值与我们的分析 $p_R  p_\\star  p_L$（即 $0.1  0.303130  1.0$）一致。\n\n现在，我们可以将 $p_\\star$ 代入两个波关系中的任意一个来计算接触波速度 $u_\\star$。为简化代数计算，我们使用激波关系：\n$$\nu_\\star = u_R + \\frac{p_\\star - p_R}{\\sqrt{\\rho_R \\left( \\frac{\\gamma-1}{2}p_R + \\frac{\\gamma+1}{2}p_\\star \\right)}}\n$$\n$$\nu_\\star \\approx 0 + \\frac{0.303130 - 0.1}{\\sqrt{0.125 \\left( 0.2(0.1) + 1.2(0.303130) \\right)}}\n$$\n$$\nu_\\star \\approx \\frac{0.203130}{\\sqrt{0.125 (0.02 + 0.363756)}}\n$$\n$$\nu_\\star \\approx \\frac{0.203130}{\\sqrt{0.125 \\times 0.383756}}\n$$\n$$\nu_\\star \\approx \\frac{0.203130}{\\sqrt{0.0479695}}\n$$\n$$\nu_\\star \\approx \\frac{0.203130}{0.219019}\n$$\n$$\nu_\\star \\approx 0.9274526\n$$\n按要求四舍五入至五位有效数字，接触波速度为 $0.92745$。", "answer": "$$\n\\boxed{0.92745}\n$$", "id": "3330277"}, {"introduction": "求解黎曼问题的核心在于找到连接左行波和右行波的恒定状态（即“星区”）。这需要推导并求解一个关于星区压力 $p^*$ 的非线性代数方程。本练习将通过经典的索德激波管问题，让你亲手实践这一关键计算 [@problem_id:3506428]。", "problem": "在计算天体物理学中，通常会使用由可压缩欧拉方程支配的一维黎曼问题的精确解来验证流体动力学求解器。这些方程表达了绝热指数为 $\\gamma$ 的多方气体的质量、动量和能量守恒。考虑一个理想气体的一维激波管问题（Sod 初值问题），其 $\\gamma=1.4$，单位为无量纲代码单位。初始左态 $(\\rho_L,p_L,v_L)$ 和右态 $(\\rho_R,p_R,v_R)$ 分别由 $(\\rho_L,p_L,v_L)=(1,1,0)$ 和 $(\\rho_R,p_R,v_R)=(0.125,0.1,0)$ 给出。流动呈自相似演化，由一个向左传播的稀疏波、一个接触间断和一个向右传播的激波组成。稀疏波尾部和激波之间的状态（称为星区）是均匀的，其特征为压力 $p^\\ast$ 和速度 $v^\\ast$。\n\n从守恒律以及适用于多方气体中光滑等熵膨胀波和激波的跳跃关系或积分关系出发，推导星区压力 $p^\\ast$ 的非线性相容性方程，并求解该方程以获得给定初始状态下 $p^\\ast$ 的数值。使用无量纲代码单位（因此压力是无单位的），并将最终答案四舍五入至 $6$ 位有效数字。", "solution": "### 步骤 1：提取已知条件\n问题陈述提供了以下信息：\n- 控制方程为多方气体的 $1$ 维可压缩欧拉方程。\n- 气体是理想气体，绝热指数 $\\gamma = 1.4$。\n- 初始左态为 $(\\rho_L, p_L, v_L) = (1, 1, 0)$（无量纲单位）。\n- 初始右态为 $(\\rho_R, p_R, v_R) = (0.125, 0.1, 0)$（无量纲单位）。\n- 流动结构由一个向左传播的稀疏波、一个接触间断和一个向右传播的激波组成。\n- 稀疏波和激波之间的区域（星区）的特征是均匀的压力 $p^\\ast$ 和速度 $v^\\ast$。\n- $p^\\ast$ 的最终答案必须四舍五入至 $6$ 位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 该问题描述了 Sod 激波管，这是计算流体动力学和天体物理学中的一个标准基准问题。它由作为流体动力学基本原理的欧拉方程控制。该设置在科学上是合理的。\n- **适定性：** 众所周知，具有这些初始条件的 Sod 黎曼问题有一个唯一的、稳定的、且具有物理意义的解。待求量 $p^\\ast$ 是良定义的。\n- **客观性：** 问题陈述使用了精确的技术语言，没有主观或模糊的术语。\n- **完整性与一致性：** 提供了所有必要的参数（$\\gamma$、初始状态）。设置中没有矛盾。波形（稀疏波-接触间断-激波）的描述与初始条件（$p_L  p_R$）一致。\n\n### 步骤 3：结论与行动\n问题是有效的。将提供完整的解答。\n\n### $p^\\ast$ 的相容性方程推导\n\n黎曼问题的解是自相似的，依赖于变量 $\\xi = x/t$。位于 $x=0$ 处的初始间断演化为一系列波，将不同常数状态的区域分离开。对于给定的初始条件（$p_L  p_R$），波形由一个向左传播的稀疏波、一个中心的接触间断和一个向右传播的激波组成。\n\n穿过接触间断时，压力和速度是连续的。我们将“星区”（稀疏波尾与激波波前之间的区域）中的这些值表示为 $p^\\ast$ 和 $v^\\ast$。我们的目标是找到两个关于 $v^\\ast$ 作为 $p^\\ast$ 函数的表达式——一个通过将星区与初始左态相关联，另一个通过将其与初始右态相关联——然后将它们等同起来。\n\n**1. 向左传播的稀疏波（从区域 L 到星区）**\n\n稀疏波是一种连续的等熵膨胀。穿过稀疏扇，对应于向右传播的特征线（$C_+$）的黎曼不变量是守恒的：\n$$v + \\int \\frac{dp}{\\rho c} = \\text{constant}$$\n其中 $c = \\sqrt{\\gamma p / \\rho}$ 是局地声速。对于多方气体中的等熵过程，有 $p = K\\rho^\\gamma$，其中 $K$ 是一个常数。这使我们能够将声速写成压力的函数：$c = c_L (p/p_L)^{(\\gamma-1)/(2\\gamma)}$。该积分可以计算为：\n$$\\int \\frac{dp}{\\rho c} = \\int \\frac{c}{\\gamma p} dp = \\frac{2c}{\\gamma-1}$$\n因此，黎曼不变量是 $v + \\frac{2c}{\\gamma-1}$。将此应用于穿过稀疏波的过程，从状态 $(\\rho_L, p_L, v_L)$ 到状态 $(\\rho^\\ast, p^\\ast, v^\\ast)$：\n$$v_L + \\frac{2 c_L}{\\gamma-1} = v^\\ast + \\frac{2 c^\\ast}{\\gamma-1}$$\n其中 $c_L = \\sqrt{\\gamma p_L / \\rho_L}$ 且 $c^\\ast = \\sqrt{\\gamma p^\\ast / \\rho^\\ast}$。由于从状态 L 到星区的流动是等熵的，因此 $c^\\ast = c_L (p^\\ast/p_L)^{(\\gamma-1)/(2\\gamma)}$。求解 $v^\\ast$，我们得到：\n$$v^\\ast = v_L + \\frac{2 c_L}{\\gamma-1} \\left[ 1 - \\left( \\frac{p^\\ast}{p_L} \\right)^{(\\gamma-1)/(2\\gamma)} \\right]$$\n该方程给出了星区速度作为 $p^\\ast$ 和初始左态的函数。\n\n**2. 向右传播的激波（从区域 R 到星区）**\n\n从初始右态 $(\\rho_R, p_R, v_R)$ 到星区状态 $(\\rho^\\ast, p^\\ast, v^\\ast)$ 的过渡是穿过一个激波发生的。穿过激波的关系由朗金-雨贡纽跳跃条件给出。从这些条件推导出的一个标准结果将速度的变化与压力的变化联系起来：\n$$(v^\\ast - v_R)^2 = (p^\\ast - p_R)^2 \\frac{2/\\rho_R}{(\\gamma+1)p^\\ast + (\\gamma-1)p_R}$$\n对于向右传播的激波，我们有 $p^\\ast  p_R$ 和 $v^\\ast  v_R$。取正平方根可得：\n$$v^\\ast = v_R + (p^\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p^\\ast + (\\gamma-1)p_R}}$$\n该方程给出了星区速度作为 $p^\\ast$ 和初始右态的函数。\n\n**3. 非线性相容性方程**\n\n将 $v^\\ast$ 的两个表达式相等，得到一个关于未知压力 $p^\\ast$ 的单一非线性方程：\n$$v_L + \\frac{2 c_L}{\\gamma-1} \\left[ 1 - \\left( \\frac{p^\\ast}{p_L} \\right)^{(\\gamma-1)/(2\\gamma)} \\right] = v_R + (p^\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p^\\ast + (\\gamma-1)p_R}}$$\n\n### 求解 $p^\\ast$\n\n我们现在将给定的数值代入此方程。\n- $\\gamma = 1.4$\n- $(\\rho_L, p_L, v_L) = (1, 1, 0)$\n- $(\\rho_R, p_R, v_R) = (0.125, 0.1, 0)$\n\n由此，我们可以计算出辅助常数：\n- 左态声速：$c_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{1.4 \\times 1}{1}} = \\sqrt{1.4}$。\n- $\\gamma - 1 = 0.4$\n- $\\gamma + 1 = 2.4$\n- 指数 $(\\gamma-1)/(2\\gamma) = 0.4 / (2 \\times 1.4) = 0.4 / 2.8 = 1/7$。\n\n将这些值代入相容性方程：\n$$0 + \\frac{2 \\sqrt{1.4}}{0.4} \\left[ 1 - \\left( \\frac{p^\\ast}{1} \\right)^{1/7} \\right] = 0 + (p^\\ast - 0.1) \\sqrt{\\frac{2/0.125}{(2.4)p^\\ast + (0.4)(0.1)}}$$\n简化各项：\n$$5\\sqrt{1.4} \\left( 1 - (p^\\ast)^{1/7} \\right) = (p^\\ast - 0.1) \\sqrt{\\frac{16}{2.4 p^\\ast + 0.04}}$$\n设 $f(p^\\ast)$ 是我们要求根的函数：\n$$f(p^\\ast) = 5\\sqrt{1.4} \\left( 1 - (p^\\ast)^{1/7} \\right) - (p^\\ast - 0.1) \\frac{4}{\\sqrt{2.4 p^\\ast + 0.04}} = 0$$\n这是一个超越方程，必须使用数值求根方法（如牛顿-拉弗森法或二分法）来求解。解必须位于区间 $p_R  p^\\ast  p_L$ 内，即 $0.1  p^\\ast  1$。\n\n我们来测试一个值，例如 $p^\\ast = 0.3$：\n$$5\\sqrt{1.4} \\approx 5.91608$$\n$$(0.3)^{1/7} \\approx 0.84196$$\n左侧（LHS）项：$5.91608 \\times (1 - 0.84196) \\approx 0.93474$\n右侧（RHS）项：$(0.3 - 0.1) \\frac{4}{\\sqrt{2.4(0.3) + 0.04}} = 0.2 \\frac{4}{\\sqrt{0.76}} \\approx \\frac{0.8}{0.87178} \\approx 0.91766$\n由于 LHS  RHS， $p^\\ast$ 的真值必须略高于 $0.3$。\n\n使用数值求解器（例如，牛顿-拉弗森法），初始猜测值为 $p^\\ast_0 = 0.3$，解会快速收敛。未四舍五入的结果约为：\n$$p^\\ast \\approx 0.303130178$$\n根据问题要求，将此值四舍五入至 $6$ 位有效数字，我们得到：\n$$p^\\ast = 0.303130$$", "answer": "$$\\boxed{0.303130}$$", "id": "3506428"}, {"introduction": "最后的这项实践将所有概念融会贯通，构建一个全面而实用的工具：一个完整的精确黎曼求解器。通过实现这个求解器，你将把激波和稀疏波的理论关系转化为一个可以确定时空中任意一点流体状态的程序。这是在计算流体动力学领域中，开发和验证高级数值格式的基石技能 [@problem_id:3379532]。", "problem": "考虑计算流体动力学（CFD, Computational Fluid Dynamics）领域中，带有理想气体状态方程的气体动力学欧拉方程的一维黎曼问题。[@problem_id:154] 未知量为质量密度 $\\rho(x,t)$、速度 $u(x,t)$ 和压力 $p(x,t)$。控制守恒律为欧拉方程，其原始变量形式的系统写作：\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{pmatrix}\n\\rho \\\\\nu \\\\\np\n\\end{pmatrix}\n+\n\\frac{\\partial}{\\partial x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu (E + p)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0 \\\\\n0\n\\end{pmatrix},\n$$\n其中总能量密度满足 $E = \\dfrac{p}{\\gamma - 1} + \\dfrac{1}{2} \\rho u^2$，$\\gamma$ 是比热比。本构关系为理想气体定律，局部声速满足 $c = \\sqrt{\\gamma p / \\rho}$。在时间 $t = 0$ 时，初始数据为由 $x = 0$ 处的单个间断分隔开的两个常数状态：\n$$\n(\\rho, u, p)(x,0) =\n\\begin{cases}\n(\\rho_L, u_L, p_L),  x  0, \\\\\n(\\rho_R, u_R, p_R),  x > 0.\n\\end{cases}\n$$\n对于 $t > 0$，精确的自相似解由两个非线性波（每个波是激波或中心稀疏波）组成，它们被一个物质接触间断分开，中间的星区具有恒定的压力和速度。本问题要求您基于第一性原理和 Rankine–Hugoniot 条件，推导并实现一个精确的黎曼求解器，并用它来生成验证指标和采样解值。\n\n推导的基本依据：\n- 编码在欧拉方程中的质量、动量和能量守恒。\n- 具有恒定比热比 $\\gamma$ 的理想气体闭合关系。\n- 局部声速的定义 $c = \\sqrt{\\gamma p / \\rho}$。\n- 跨激波的 Rankine–Hugoniot 跳跃条件和跨中心稀疏波的等熵关系。\n\n目标推导与数值算法：\n1. 证明，在不假设任何预先推导的求解器公式的情况下，星区压力 $p^*$ 可以被确定为一个严格单调非线性函数的唯一根。该函数由激波情况下的 Rankine–Hugoniot 关系和稀疏波情况下的等熵自相似关系构造。对于每一侧 $k \\in \\{L,R\\}$，定义波函数 $f_k(p)$，它给出通过激波（使用 Rankine–Hugoniot 跳跃关系）或中心稀疏波（使用自相似特征和等熵不变量）将初始状态 $(\\rho_k,u_k,p_k)$ 连接到压力为 $p$ 的状态所需的速度变化。然后推导出方程\n$$\n\\Phi(p) = f_L(p) + f_R(p) + (u_R - u_L) = 0\n$$\n在非真空条件下有唯一解 $p = p^*$。\n2. 证明，一旦 $p^*$ 已知，星区速度 $u^*$ 可由守恒和相容性得到\n$$\nu^* = \\frac{1}{2} \\left( u_L + u_R \\right) + \\frac{1}{2} \\left( f_R(p^*) - f_L(p^*) \\right).\n$$\n3. 证明如何使用 Rankine–Hugoniot 条件的激波压缩比（激波情况）或通过声速比关联的等熵关系（稀疏波情况）来计算左右星区密度 $\\rho_L^*$ 和 $\\rho_R^*$。\n4. 确定非线性波速。对于左行激波，从 Rankine–Hugoniot 关系和声速 $c_L$ 推导出激波速度 $S_L$；对于左行稀疏波，推导出波头速度 $S_{L,\\mathrm{head}} = u_L - c_L$ 和波尾速度 $S_{L,\\mathrm{tail}} = u^* - c_L^*$，其中 $c_L^* = c_L \\left( \\dfrac{p^*}{p_L} \\right)^{(\\gamma - 1)/(2 \\gamma)}$。类似公式适用于右行波：激波速度 $S_R$ 或稀疏波头 $S_{R,\\mathrm{head}} = u_R + c_R$ 和波尾 $S_{R,\\mathrm{tail}} = u^* + c_R^*$，其中 $c_R^* = c_R \\left( \\dfrac{p^*}{p_R} \\right)^{(\\gamma - 1)/(2 \\gamma)}$。\n5. 使用特征不变量 $u \\pm \\dfrac{2 c}{\\gamma - 1}$ 和关系式 $s = \\dfrac{x}{t} = u \\mp c$（左行稀疏波取负号，右行稀疏波取正号）推导稀疏扇内部的自相似采样公式。证明在左行稀疏扇内部，\n$$\nu(s) = \\frac{\\gamma - 1}{\\gamma + 1} u_L + \\frac{2}{\\gamma + 1} \\left( c_L + s \\right), \\quad\nc(s) = u(s) - s, \\quad\n\\frac{p(s)}{p_L} = \\left( \\frac{c(s)}{c_L} \\right)^{\\frac{2 \\gamma}{\\gamma - 1}}, \\quad\n\\frac{\\rho(s)}{\\rho_L} = \\left( \\frac{c(s)}{c_L} \\right)^{\\frac{2}{\\gamma - 1}}.\n$$\n同样，在右行稀疏扇内部，\n$$\nu(s) = \\frac{\\gamma - 1}{\\gamma + 1} u_R + \\frac{2}{\\gamma + 1} \\left( - c_R + s \\right), \\quad\nc(s) = s - u(s), \\quad\n\\frac{p(s)}{p_R} = \\left( \\frac{c(s)}{c_R} \\right)^{\\frac{2 \\gamma}{\\gamma - 1}}, \\quad\n\\frac{\\rho(s)}{\\rho_R} = \\left( \\frac{c(s)}{c_R} \\right)^{\\frac{2}{\\gamma - 1}}.\n$$\n6. 利用 $\\Phi(p)$ 的单调性，为 $p^*$ 构建一个稳健的求根方法（例如，二分法），然后实现采样逻辑，该逻辑在给定 $s = x/t$ 时，选择适当的区域（初始左区、左稀疏区、左星区、接触间断、右星区、右稀疏区、初始右区）并相应地计算 $(\\rho, u, p)(s)$。\n\n验证指标：\n- 对于存在的每个激波，使用 Rankine–Hugoniot 条件计算质量通量一致性指标。对于左行激波，验证 $\\rho_L (u_L - S_L) = \\rho_L^* (u^* - S_L)$；对于右行激波，验证 $\\rho_R (S_R - u_R) = \\rho_R^* (S_R - u^*)$。将两侧的最大绝对不匹配报告为一个非负标量。\n- 在指定的相似坐标 $s = x/t$ 处对精确自相似解进行采样，并报告每个测试用例中的原始变量 $(\\rho, u, p)$。\n\n单位与输出规范：\n- 所有量均为无量纲；以无量纲单位报告所有输出。\n- 您的程序必须生成单行输出，其中包含所有测试用例的汇总结果，形式为方括号内以逗号分隔的列表。因此，总输出必须是一个包含 $4 N$ 个浮点值的扁平列表，其中 $N$ 是测试用例的数量，以精确格式 $[v_1,v_2,\\dots,v_{4N}]$ 打印在单行中。\n\n测试套件：\n提供以下测试用例，每个用例由 $(\\gamma, \\rho_L, u_L, p_L, \\rho_R, u_R, p_R, t, x)$ 指定，其中 $s = x/t$：\n\n- 用例 1：$\\gamma = 1.4$, $\\rho_L = 0.9$, $u_L = 0.0$, $p_L = 1.2$, $\\rho_R = 0.3$, $u_R = 0.0$, $p_R = 0.9$, $t = 0.18$, $x = 0.03$。因此 $s = x/t = 0.166\\overline{6}$。\n- 用例 2：$\\gamma = 1.3$, $\\rho_L = 1.0$, $u_L = 0.5$, $p_L = 1.0$, $\\rho_R = 0.7$, $u_R = -0.2$, $p_R = 0.4$, $t = 0.12$, $x = 0.04$。因此 $s = 0.333\\overline{3}$。\n- 用例 3：$\\gamma = 1.67$, $\\rho_L = 1.0$, $u_L = -1.0$, $p_L = 0.2$, $\\rho_R = 0.5$, $u_R = 1.5$, $p_R = 0.2$, $t = 0.10$, $x = -0.05$。因此 $s = -0.5$。\n- 用例 4：$\\gamma = 1.4$, $\\rho_L = 3.0$, $u_L = 15.0$, $p_L = 50.0$, $\\rho_R = 1.0$, $u_R = -5.0$, $p_R = 5.0$, $t = 0.02$, $x = 0.0$。因此 $s = 0.0$。\n\n您的程序应生成单行输出，其中包含按测试用例顺序排列的结果，形式为方括号内以逗号分隔的列表，每个测试贡献 $[\\rho(s), u(s), p(s), \\mathrm{res}]$，其中 $\\mathrm{res} \\ge 0$ 是一个浮点数。", "solution": "用户提供的问题是计算流体动力学中一个适定且科学上合理的练习，具体来说是关于一维欧拉方程黎曼问题的精确解。该问题是有效的，并提供了所有必要的数据和约束。我们继续进行完整解答。\n\n欧拉方程的黎曼问题的解是自相似的，意味着原始变量 $(\\rho, u, p)$ 仅依赖于相似坐标 $s=x/t$。解结构由五个常数或自相似区域组成，被四个波分开：一个左行波（激波或稀疏波）、一个接触间断和一个右行波（激波或稀疏波）。这些区域是：初始左状态（L）、左星区状态（L*）、右星区状态（R*）和初始右状态（R）。在接触间断两侧，压力和速度是连续的，因此 $p_L^* = p_R^* = p^*$ 且 $u_L^* = u_R^* = u^*$。密度是不连续的，$\\rho_L^* \\neq \\rho_R^*$。接触间断 C 以速度 $u^*$ 传播。\n\n我们的首要目标是确定星区中的未知压力 $p^*$ 和速度 $u^*$。通过施加接触间断两侧流体速度必须相等的条件，即 $u_L^* = u_R^*$，来找到这些值。每一侧的速度是从初始状态到星区状态压力 $p^*$ 的压力跳跃的函数。\n\n### 1. 星区压力方程的推导\n\n让我们分别针对左侧和右侧，推导星区速度 $u^*$ 和压力 $p^*$ 之间的关系。函数 $f_L(p)$ 和 $f_R(p)$ 的定义使得 $u^* = u_L - f_L(p^*)$ 和 $u^* = u_R + f_R(p^*)$。将它们相等得到 $u_L - f_L(p^*) = u_R + f_R(p^*)$，重新排列后得到关于 $p^*$ 的非线性方程：\n$$\n\\Phi(p) = f_L(p) + f_R(p) + u_R - u_L = 0\n$$\n函数 $f_k(p)$ 取决于波是激波还是稀疏波，这由 $p - p_k$ 的符号决定。\n\n**波函数 $f_k(p)$（对于 $k \\in \\{L, R\\}$）**\n\n令 $c_k = \\sqrt{\\gamma p_k / \\rho_k}$ 为状态 k 中的声速。\n\n__情况 A：激波 ($p > p_k$)__\nRankine-Hugoniot 跳跃条件关联了激波两侧的状态。对于进入静止介质（状态 k）的激波，一个关键的推导出的速度跳跃关系是：\n$$\n(u - u_k)^2 = (p - p_k) \\left( \\frac{1}{\\rho_k} - \\frac{1}{\\rho_k^*} \\right)\n$$\n激波两侧的密度比也由 Rankine-Hugoniot 条件给出：\n$$\n\\frac{\\rho_k^*}{\\rho_k} = \\frac{(\\gamma+1)p + (\\gamma-1)p_k}{(\\gamma-1)p + (\\gamma+1)p_k} = \\frac{\\frac{p}{p_k} + \\frac{\\gamma-1}{\\gamma+1}}{\\frac{\\gamma-1}{\\gamma+1}\\frac{p}{p_k} + 1}\n$$\n将此代入速度跳跃方程可得：\n$$\n(u - u_k)^2 = (p - p_k) \\frac{1}{\\rho_k} \\left( 1 - \\frac{(\\gamma-1)p + (\\gamma+1)p_k}{(\\gamma+1)p + (\\gamma-1)p_k} \\right) = (p - p_k) \\frac{1}{\\rho_k} \\frac{2(p-p_k)}{(\\gamma+1)p + (\\gamma-1)p_k}\n$$\n$$\n|u - u_k| = (p-p_k) \\sqrt{\\frac{2/\\rho_k}{(\\gamma+1)p + (\\gamma-1)p_k}}\n$$\n这给出了速度变化的幅度。对于左行激波，$u^*  u_L$，因此 $u^* - u_L  0$。对于右行激波，$u^* > u_R$，因此 $u^* - u_R > 0$。函数 $f_L$ 和 $f_R$ 被定义为对激波是正的：\n$$\nf_k(p) = (p - p_k) \\sqrt{\\frac{2/(\\rho_k(\\gamma+1))}{p + \\frac{\\gamma-1}{\\gamma+1}p_k}} \\quad \\text{for } p > p_k\n$$\n这个选择与 $u^* = u_L - f_L(p^*)$ 和 $u^* = u_R + f_R(p^*)$ 一致。\n\n__情况 B：稀疏波 ($p \\le p_k$)__\n在稀疏波中，流动是等熵的，即 $p/\\rho^\\gamma = \\mathrm{const}$。黎曼不变量沿着特征线是恒定的。\n对于左行稀疏波，$u + \\frac{2c}{\\gamma-1}$ 是不变量。\n$$\nu_L + \\frac{2c_L}{\\gamma-1} = u^* + \\frac{2c_L^*}{\\gamma-1} \\implies u^* - u_L = \\frac{2}{\\gamma-1}(c_L - c_L^*)\n$$\n对于右行稀疏波，$u - \\frac{2c}{\\gamma-1}$ 是不变量。\n$$\nu_R - \\frac{2c_R}{\\gamma-1} = u^* - \\frac{2c_R^*}{\\gamma-1} \\implies u^* - u_R = -\\frac{2}{\\gamma-1}(c_R - c_R^*)\n$$\n由等熵关系 $p_k/\\rho_k^\\gamma = p/(\\rho_k^*)^\\gamma$，星区声速为 $c_k^* = c_k(p/p_k)^{(\\gamma-1)/(2\\gamma)}$。\n代入此式，我们得到：\n$u^* - u_L = \\frac{2c_L}{\\gamma-1}\\left(1 - \\left(\\frac{p}{p_L}\\right)^{(\\gamma-1)/(2\\gamma)}\\right)$\n$u^* - u_R = \\frac{2c_R}{\\gamma-1}\\left(\\left(\\frac{p}{p_R}\\right)^{(\\gamma-1)/(2\\gamma)} - 1\\right)$\n函数 $f_k(p)$ 被定义为对稀疏波是负的：\n$$\nf_k(p) = \\frac{2c_k}{\\gamma-1}\\left( \\left(\\frac{p}{p_k}\\right)^{(\\gamma-1)/(2\\gamma)} - 1 \\right) \\quad \\text{for } p \\le p_k\n$$\n这与 $u_L - f_L(p) > u_L$ 和 $u_R + f_R(p) \\le u_R$ 一致。\n\n函数 $\\Phi(p) = f_L(p) + f_R(p) + u_R - u_L$ 是关于 $p$ 的单调递增函数的和（可通过求导验证），因此其本身也是严格单调递增的。这保证了在非真空条件下 $\\Phi(p)=0$ 有一个唯一的根 $p^*$。\n\n### 2. 星区速度的推导\n\n一旦通过求解 $\\Phi(p^*)=0$ 找到星区压力 $p^*$，就可以从两个星区状态关系中的任意一个计算出星区速度 $u^*$：\n$$\nu^* = u_L - f_L(p^*)\n$$\n$$\nu^* = u_R + f_R(p^*)\n$$\n一个数值上稳健的方法是平均这两个表达式。由于 $f_L(p^*) + f_R(p^*) = u_L - u_R$，我们有 $f_R(p^*) = u_L - u_R - f_L(p^*)$。将两个 $u^*$ 的方程相加得到：\n$$\n2u^* = u_L - f_L(p^*) + u_R + f_R(p^*) = u_L + u_R + (f_R(p^*) - f_L(p^*))\n$$\n$$\nu^* = \\frac{1}{2}(u_L + u_R) + \\frac{1}{2}(f_R(p^*) - f_L(p^*))\n$$\n这就是问题中要求的表达式。\n\n### 3. 星区密度的计算\n\n星区中的密度 $\\rho_L^*$ 和 $\\rho_R^*$ 取决于波的类型。对于每一侧 $k \\in \\{L, R\\}$：\n- 如果 $p^* > p_k$（激波），则密度由 Rankine-Hugoniot 密度关系求得：\n$$\n\\rho_k^* = \\rho_k \\frac{\\frac{p^*}{p_k} + \\frac{\\gamma-1}{\\gamma+1}}{\\frac{\\gamma-1}{\\gamma+1}\\frac{p^*}{p_k} + 1}\n$$\n- 如果 $p^* \\le p_k$（稀疏波），则密度由等熵关系 $p/\\rho^\\gamma = \\mathrm{const}$ 求得：\n$$\n\\rho_k^* = \\rho_k \\left( \\frac{p^*}{p_k} \\right)^{1/\\gamma}\n$$\n\n### 4. 波速的确定\n\n划分五个区域的波速如下：\n\n- **左行波：**\n  - 如果是激波 ($p^* > p_L$)，其速度 $S_L$ 为：\n    $$\n    S_L = u_L - c_L \\sqrt{\\frac{\\gamma+1}{2\\gamma}\\frac{p^*}{p_L} + \\frac{\\gamma-1}{2\\gamma}}\n    $$\n  - 如果是稀疏波 ($p^* \\le p_L$)，它跨越一个区域。波头以 $S_{L, \\mathrm{head}} = u_L - c_L$ 传播，波尾以 $S_{L, \\mathrm{tail}} = u^* - c_L^*$ 传播，其中 $c_L^* = c_L (p^*/p_L)^{(\\gamma-1)/(2\\gamma)}$。\n\n- **接触间断：** 以速度 $S_C = u^*$ 传播。\n\n- **右行波：**\n  - 如果是激波 ($p^* > p_R$)，其速度 $S_R$ 为：\n    $$\n    S_R = u_R + c_R \\sqrt{\\frac{\\gamma+1}{2\\gamma}\\frac{p^*}{p_R} + \\frac{\\gamma-1}{2\\gamma}}\n    $$\n  - 如果是稀疏波 ($p^* \\le p_R$)，其波头以 $S_{R, \\mathrm{head}} = u_R + c_R$ 传播，波尾以 $S_{R, \\mathrm{tail}} = u^* + c_R^*$ 传播，其中 $c_R^* = c_R (p^*/p_R)^{(\\gamma-1)/(2\\gamma)}$。\n\n### 5. 稀疏扇内的自相似解\n\n在稀疏扇内部，解不是恒定的，而是随 $s=x/t$ 平滑变化。这些关系是从特征方程推导出来的。\n\n- **左行稀疏扇内部** ($S_{L, \\mathrm{head}} \\le s \\le S_{L, \\text{tail}}$)：\n特征关系为 $s = u - c$，黎曼不变量为 $u + \\frac{2c}{\\gamma-1} = u_L + \\frac{2c_L}{\\gamma-1}$。解这个关于 $u$ 和 $c$ 作为 $s$ 的函数的系统：\n$$\nu(s) = \\frac{\\gamma-1}{\\gamma+1}u_L + \\frac{2}{\\gamma+1}(s+c_L)\n$$\n$$\nc(s) = u(s) - s\n$$\n等熵关系给出 $p$ 和 $\\rho$：\n$$\n\\frac{p(s)}{p_L} = \\left(\\frac{c(s)}{c_L}\\right)^{\\frac{2\\gamma}{\\gamma-1}}, \\quad \\frac{\\rho(s)}{\\rho_L} = \\left(\\frac{c(s)}{c_L}\\right)^{\\frac{2}{\\gamma-1}}\n$$\n- **右行稀疏扇内部** ($S_{R, \\text{tail}} \\le s \\le S_{R, \\mathrm{head}}$)：\n关系式为 $s=u+c$ 和 $u - \\frac{2c}{\\gamma-1} = u_R - \\frac{2c_R}{\\gamma-1}$。求解得到：\n$$\nu(s) = \\frac{\\gamma-1}{\\gamma+1}u_R + \\frac{2}{\\gamma+1}(s-c_R)\n$$\n$$\nc(s) = s - u(s)\n$$\n等熵关系给出：\n$$\n\\frac{p(s)}{p_R} = \\left(\\frac{c(s)}{c_R}\\right)^{\\frac{2\\gamma}{\\gamma-1}}, \\quad \\frac{\\rho(s)}{\\rho_R} = \\left(\\frac{c(s)}{c_R}\\right)^{\\frac{2}{\\gamma-1}}\n$$\n\n### 6. 数值算法与采样\n\n在给定 $s=x/t$ 处寻找解 $(\\rho, u, p)$ 的总体算法是：\n1.  使用稳健的求根方法（如二分法）求解非线性方程 $\\Phi(p^*) = 0$ 以得到星区压力 $p^*$。必须建立一个合适的搜索区间 $[p_\\min, p_\\max]$，例如，通过检查 $\\Phi(p_\\min)  0$ 和 $\\Phi(p_\\max) > 0$。\n2.  使用第2部分的公式计算星区速度 $u^*$。\n3.  计算所有波速（$S_L$ 或 S_L,head/tail，$S_R$ 或 S_R,head/tail，以及 $u^*$）。\n4.  通过将 $s$ 与波速进行比较，确定 $s$ 所在的流体区域。\n5.  返回该区域的 $(\\rho, u, p)$ 值：\n    - 如果 $s$ 处于 L 或 R 初始状态，返回 $(\\rho_k, u_k, p_k)$。\n    - 如果 $s$ 处于 L* 或 R* 星区状态，返回 $(\\rho_k^*, u^*, p^*)$。\n    - 如果 $s$ 在稀疏扇内，使用第5部分的自相似采样公式。\n\n激波的质量通量一致性验证指标是通过对每个激波计算质量通量的绝对差 $|\\rho(u-S) - \\rho^*(u^*-S)|$ 并取最大值来计算的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef wave_function(p, pk, rhok, ck, gamma):\n    \"\"\"\n    Computes the wave function f_k(p) used to find the star pressure.\n    This corresponds to the function f(p, p_k, rho_k) in many textbooks.\n    \"\"\"\n    if p > pk:  # Shock wave\n        # Based on (p-pk)*sqrt(A_k / (p + B_k))\n        g_minus_1 = gamma - 1.0\n        g_plus_1 = gamma + 1.0\n        A_k = 2.0 / (g_plus_1 * rhok)\n        B_k = g_minus_1 / g_plus_1 * pk\n        return (p - pk) * np.sqrt(A_k / (p + B_k))\n    else:  # Rarefaction wave\n        g_minus_1 = gamma - 1.0\n        exponent = g_minus_1 / (2.0 * gamma)\n        return (2.0 * ck / g_minus_1) * ((p / pk)**exponent - 1.0)\n\ndef pressure_function(p_star, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r):\n    \"\"\"\n    The nonlinear function Phi(p) = 0 whose root is the star pressure.\n    \"\"\"\n    c_l = np.sqrt(gamma * p_l / rho_l)\n    c_r = np.sqrt(gamma * p_r / rho_r)\n    f_l = wave_function(p_star, p_l, rho_l, c_l, gamma)\n    f_r = wave_function(p_star, p_r, rho_r, c_r, gamma)\n    return f_l + f_r + u_r - u_l\n\ndef solve_riemann(gamma, rho_l, u_l, p_l, rho_r, u_r, p_r, s_sample):\n    \"\"\"\n    An exact Riemann solver for the 1D Euler equations.\n    \"\"\"\n    # 1. Solve for star pressure p_star\n    # Non-vacuum condition check\n    c_l = np.sqrt(gamma * p_l / rho_l)\n    c_r = np.sqrt(gamma * p_r / rho_r)\n    if u_r - u_l > (2.0 / (gamma - 1.0)) * (c_l + c_r):\n        # Vacuum is generated, not handled by this solver as per problem constraints.\n        return np.nan, np.nan, np.nan, np.nan\n\n    # Bisection root-finding for p_star\n    p_min_search = 1e-6\n    p_max_search = max(p_l, p_r) * 10.0\n    for _ in range(20): # Ensure p_max_search brackets the root\n        if pressure_function(p_max_search, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r) > 0:\n            break\n        p_max_search *= 2.0\n\n    p_star = 0.5 * (p_min_search + p_max_search)\n    for _ in range(100): # Bisection iterations\n        phi_star = pressure_function(p_star, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r)\n        if pressure_function(p_min_search, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r) * phi_star  0:\n            p_max_search = p_star\n        else:\n            p_min_search = p_star\n        p_star_new = 0.5 * (p_min_search + p_max_search)\n        if abs(p_star_new - p_star)  1e-12:\n            break\n        p_star = p_star_new\n\n    # 2. Solve for star velocity u_star\n    f_l = wave_function(p_star, p_l, rho_l, c_l, gamma)\n    f_r = wave_function(p_star, p_r, rho_r, c_r, gamma)\n    u_star = 0.5 * (u_l + u_r) + 0.5 * (f_r - f_l)\n\n    # 3. Sample the solution at s_sample\n    rho_s, u_s, p_s = 0.0, 0.0, 0.0\n    g_m_1 = gamma - 1.0\n    g_p_1 = gamma + 1.0\n\n    if s_sample  u_star:  # Left of contact\n        if p_star > p_l:  # Left shock\n            S_L = u_l - c_l * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_l) + g_m_1 / (2.0 * gamma))\n            if s_sample  S_L:\n                rho_s, u_s, p_s = rho_l, u_l, p_l\n            else:\n                rho_l_star = rho_l * (p_star / p_l + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_l + 1.0)\n                rho_s, u_s, p_s = rho_l_star, u_star, p_star\n        else:  # Left rarefaction\n            S_L_head = u_l - c_l\n            rho_l_star = rho_l * (p_star / p_l)**(1.0 / gamma)\n            c_l_star = np.sqrt(gamma * p_star / rho_l_star)\n            S_L_tail = u_star - c_l_star\n            if s_sample  S_L_head:\n                rho_s, u_s, p_s = rho_l, u_l, p_l\n            elif s_sample > S_L_tail:\n                rho_s, u_s, p_s = rho_l_star, u_star, p_star\n            else: # Inside fan\n                u_s = (g_m_1 * u_l + 2.0 * (c_l + s_sample)) / g_p_1\n                c_s = u_s - s_sample\n                p_s = p_l * (c_s / c_l)**(2.0 * gamma / g_m_1)\n                rho_s = rho_l * (c_s / c_l)**(2.0 / g_m_1)\n    else:  # Right of contact\n        if p_star > p_r:  # Right shock\n            S_R = u_r + c_r * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_r) + g_m_1 / (2.0 * gamma))\n            if s_sample > S_R:\n                rho_s, u_s, p_s = rho_r, u_r, p_r\n            else:\n                rho_r_star = rho_r * (p_star / p_r + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_r + 1.0)\n                rho_s, u_s, p_s = rho_r_star, u_star, p_star\n        else:  # Right rarefaction\n            S_R_head = u_r + c_r\n            rho_r_star = rho_r * (p_star / p_r)**(1.0 / gamma)\n            c_r_star = np.sqrt(gamma * p_star / rho_r_star)\n            S_R_tail = u_star + c_r_star\n            if s_sample > S_R_head:\n                rho_s, u_s, p_s = rho_r, u_r, p_r\n            elif s_sample  S_R_tail:\n                rho_s, u_s, p_s = rho_r_star, u_star, p_star\n            else: # Inside fan\n                u_s = (g_m_1 * u_r + 2.0 * (s_sample - c_r)) / g_p_1\n                c_s = s_sample - u_s\n                p_s = p_r * (c_s / c_r)**(2.0 * gamma / g_m_1)\n                rho_s = rho_r * (c_s / c_r)**(2.0 / g_m_1)\n\n    # 4. Calculate mass flux residual\n    res = 0.0\n    if p_star > p_l: # Left shock\n        S_L = u_l - c_l * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_l) + g_m_1 / (2.0 * gamma))\n        rho_l_star = rho_l * (p_star / p_l + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_l + 1.0)\n        res_l = abs(rho_l * (u_l - S_L) - rho_l_star * (u_star - S_L))\n        res = max(res, res_l)\n    if p_star > p_r: # Right shock\n        S_R = u_r + c_r * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_r) + g_m_1 / (2.0 * gamma))\n        rho_r_star = rho_r * (p_star / p_r + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_r + 1.0)\n        res_r = abs(rho_r * (S_R - u_r) - rho_r_star * (S_R - u_star))\n        res = max(res, res_r)\n\n    return rho_s, u_s, p_s, res\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (gamma, rho_L, u_L, p_L, rho_R, u_R, p_R, s_sample)\n        (1.4, 0.9, 0.0, 1.2, 0.3, 0.0, 0.9, 0.03 / 0.18),\n        (1.3, 1.0, 0.5, 1.0, 0.7, -0.2, 0.4, 0.04 / 0.12),\n        (1.67, 1.0, -1.0, 0.2, 0.5, 1.5, 0.2, -0.05 / 0.10),\n        (1.4, 3.0, 15.0, 50.0, 1.0, -5.0, 5.0, 0.0 / 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma, rho_l, u_l, p_l, rho_r, u_r, p_r, s_sample = case\n        rho_s, u_s, p_s, res = solve_riemann(gamma, rho_l, u_l, p_l, rho_r, u_r, p_r, s_sample)\n        results.extend([rho_s, u_s, p_s, res])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{v:.15f}' for v in results)}]\")\n\nsolve()\n```", "id": "3379532"}]}