{"hands_on_practices": [{"introduction": "一个数值格式的关键考验在于它精确模拟不同类型物理波的能力。接触间断是欧拉方程解的一个基本特征，其速度和压力恒定，仅有密度发生跳跃。本练习 [@problem_id:3292971] 将引导您推导AUSM类格式能够完美保持这种波的充分条件，这能让您深入理解该格式的分裂通量结构及其背后的设计原理。", "problem": "考虑量热完全理想气体的一维欧拉方程，其比热比为 $\\gamma$。方程以守恒形式写出，状态向量为 $U = [\\rho, \\rho u, \\rho E]^{\\mathsf{T}}$，通量为 $F(U) = [\\rho u, \\rho u^{2} + p, u(\\rho E + p)]^{\\mathsf{T}}$。状态方程和声速分别为 $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho u^{2}\\right)$ 和 $a = \\sqrt{\\gamma p / \\rho}$。接触间断由左右两个状态定义，其速度和压力相等，但密度不同，即 $u_{L} = u_{R}$，$p_{L} = p_{R}$，且 $\\rho_{L} \\neq \\rho_{R}$。在黎曼问题的精确解中，接触间断以速度 $u$ 平流，其中 $u$ 和 $p$ 保持不变，密度跳跃也得以保持。\n\n一种属于 AUSM$+$ 族的平流上游分裂方法 (Advection Upstream Splitting Method, AUSM) 通量将单元交界面上的数值通量分裂为对流项和压力项。在不指定特定变体的情况下，假设质量通量可以写为参考声速 $a_{f}$、界面对流马赫数 $\\widehat{M}$ 以及迎风密度 $\\rho^{\\mathrm{up}}$ 的乘积，而动量通量中的压力项由一种压力分裂方法构建，当 $p_{L} = p_{R}$ 时，该方法可简化为物理压力。假设对原始变量 $(\\rho,u,p)$ 使用二阶分段线性重构，并带有一个在真实解为常数时能够保持等价性的限制器。\n\n你的任务：\n\n1) 从欧拉方程和上述精确接触间断性质出发，推导关于数值重构和 AUSM$+$-型通量参数的充分条件，使得对于界面左右数据满足 $u_{L} = u_{R}$ 和 $p_{L} = p_{R}$（但 $\\rho_{L} \\neq \\rho_{R}$）时，计算出的界面通量与精确接触通量一致。将这些条件表述为对重构的界面原始变量、质量通量中使用的对流马赫数和参考声速，以及动量通量中使用的压力分裂方法的要求。你的条件必须足以保证对于任意的 $\\rho_{L} \\neq \\rho_{R}$ 以及与欧拉模型相符的任何亚音速或超音速 $u$，都能精确捕捉接触间断。\n\n2) 在你推导出的充分条件下，评估以下仅密度不同的左右状态的数值质量通量：\n- 比热比 $\\gamma = 1.4$，\n- 左右压力 $p_{L} = p_{R} = 1.0 \\times 10^{5}$ $\\mathrm{Pa}$，\n- 左右速度 $u_{L} = u_{R} = 100$ $\\mathrm{m/s}$，\n- 左右密度 $\\rho_{L} = 1.0$ 和 $\\rho_{R} = 2.0$ $\\mathrm{kg/m^{3}}$。\n\n以 $\\mathrm{kg}/(\\mathrm{m}^{2}\\,\\mathrm{s})$ 为单位表示最终的质量通量，并将你的答案四舍五入到四位有效数字。只报告质量通量的数值。", "solution": "该问题要求完成两部分：首先，推导平流上游分裂方法 (AUSM) 类型格式精确解析接触间断的充分条件；其次，在这些条件下，为一个特定的接触间断计算数值质量通量。\n\n### 第一部分：精确接触间断解析的充分条件\n\n接触间断的特征是左 ($L$) 右 ($R$) 状态具有相等的速度 $u_{L} = u_{R} = u_{c}$ 和相等的压力 $p_{L} = p_{R} = p_{c}$，但密度不相等 $\\rho_{L} \\neq \\rho_{R}$。在一维欧拉方程的精确解中，此间断以速度 $u_{c}$ 平流，同时保持密度跳跃。速度和压力在任何地方都保持为常数 $u_{c}$ 和 $p_{c}$。\n\n精确物理通量向量 $F(U)$ 由 $F(U) = [\\rho u, \\rho u^{2} + p, u(\\rho E + p)]^{\\mathsf{T}}$ 给出。对于以速度 $u_c$ 移动的接触间断，间断本身的状态变量为 $(u_c, p_c)$，密度取自迎风方向。如果 $u_{c}  0$，左侧状态 $(\\rho_{L}, u_{c}, p_{c})$ 位于界面上。如果 $u_{c}  0$，右侧状态 $(\\rho_{R}, u_{c}, p_{c})$ 位于界面上。如果 $u_{c} = 0$，质量通量和能量通量为零，动量通量为 $[0, p_c, 0]^\\mathsf{T}$。令 $\\rho^{\\mathrm{upwind}}$ 表示迎风侧的密度。穿过接触间断的精确通量 $F_{exact}$ 为：\n$F_{exact} = F(\\rho^{\\mathrm{upwind}}, u_{c}, p_{c}) = \\begin{pmatrix} \\rho^{\\mathrm{upwind}} u_{c} \\\\ \\rho^{\\mathrm{upwind}} u_{c}^{2} + p_{c} \\\\ u_{c}(\\rho^{\\mathrm{upwind}} E^{\\mathrm{upwind}} + p_{c}) \\end{pmatrix}$\n其中 $E^{\\mathrm{upwind}} = \\frac{p_{c}}{(\\gamma - 1)\\rho^{\\mathrm{upwind}}} + \\frac{1}{2}u_{c}^{2}$。第三个分量也可以用总焓 $H = E + p/\\rho$ 写成 $(\\rho^{\\mathrm{upwind}}u_{c})H^{\\mathrm{upwind}}$。\n\nAUSM 型格式的数值通量 $F_{num}$ 被分裂为对流部分和压力部分。根据问题描述，在具有重构的左 ($L$) 右 ($R$) 状态的界面上，数值通量的分量为：\n1.  质量通量： $F_{num, 1} = \\dot{m} = (a_{f}\\widehat{M})\\rho^{\\mathrm{up}}$\n2.  动量通量： $F_{num, 2} = \\dot{m}u^{\\mathrm{up}} + p_{num}$\n3.  能量通量： $F_{num, 3} = \\dot{m}H^{\\mathrm{up}}$\n\n此处，$a_{f}$ 是参考声速，$\\widehat{M}$ 是对流马赫数，上标 `up` 表示从迎风侧取值，其方向由对流速度 $u_f = a_f \\widehat{M}$ 的符号决定。为实现接触间断的精确解析，数值通量 $F_{num}$ 必须等于精确通量 $F_{exact}$。我们逐个分量分析此等式成立的条件。\n\n**条件1：重构**\n问题指出，对原始变量 $(\\rho, u, p)$ 应用了二阶分段线性重构，且限制器在常数数据下保持等价性。对于接触间断，速度场和压力场是恒定的 ($u=u_{c}, p=p_{c}$)。因此，重构过程必须在单元界面处为 $u$ 和 $p$ 产生恒定值。设这些界面值用下标 $L$ 和 $R$ 表示：\n$$ u_{L} = u_{R} = u_{c} $$\n$$ p_{L} = p_{R} = p_{c} $$\n密度 $\\rho$ 是不连续的，所以重构值 $\\rho_{L}$ 和 $\\rho_{R}$ 通常会不同。这个关于重构的条件是分析的前提。\n\n**条件2：压力通量**\n问题指出，当 $p_{L} = p_{R}$ 时，压力项 $p_{num}$ 简化为物理压力。由于对于接触间断我们有 $p_{L} = p_{R} = p_{c}$，一个充分条件是：\n$$ p_{num}(p_{L}, p_{R}) = p_{c} \\quad \\text{当} \\quad p_{L} = p_{R} = p_{c} \\text{时} $$\n\n**条件3：对流速度与迎风**\n我们将数值质量通量与精确质量通量相等。假设 $u_c \\neq 0$。\n$$ F_{num, 1} = (a_{f}\\widehat{M})\\rho^{\\mathrm{up}} $$\n$$ F_{exact, 1} = u_{c}\\rho^{\\mathrm{upwind}} $$\n要使这两者对于任意密度跳跃（$\\rho_L \\neq \\rho_R$）都相等，必须同时满足两点：\n(a) 数值格式必须选择与精确解相同的迎风密度，即 $\\rho^{\\mathrm{up}} = \\rho^{\\mathrm{upwind}}$。这意味着迎风方向必须由 $u_{c}$ 的符号决定。由于数值迎风是基于对流速度 $u_{f} = a_{f}\\widehat{M}$ 的符号，这意味着 $\\mathrm{sgn}(u_f) = \\mathrm{sgn}(u_c)$。\n(b) 对流速度的大小必须与物理平流速度匹配：$|u_f| = |u_c|$。\n结合 (a) 和 (b)，对流速度必须精确等于物理速度：\n$$ a_{f}\\widehat{M} = u_{c} $$\n这是对 $a_f$ 和 $\\widehat{M}$ 公式的一个条件。当为满足 $u_{L}=u_{R}=u_{c}$ 和 $p_{L}=p_{R}=p_{c}$ 的状态进行求值时，得到的对流速度必须是 $u_c$。\n\n**动量与能量通量验证**\n有了这些条件，我们来检查其他通量分量。\n对于动量通量：\n$F_{num, 2} = \\dot{m}u^{\\mathrm{up}} + p_{num}$。根据质量通量条件，$\\dot{m} = u_{c}\\rho^{\\mathrm{upwind}}$。迎风速度 $u^{\\mathrm{up}}$ 是根据 $u_f=u_c$ 的符号选择的。由于 $u_L=u_R=u_c$，所以 $u^{\\mathrm{up}}$ 总是 $u_c$。根据压力通量条件，$p_{num} = p_c$。\n$$ F_{num, 2} = (u_{c}\\rho^{\\mathrm{upwind}})u_{c} + p_{c} = \\rho^{\\mathrm{upwind}}u_{c}^{2} + p_{c} $$\n这与精确动量通量 $F_{exact, 2}$ 完全匹配。\n\n对于能量通量：\n$F_{num, 3} = \\dot{m}H^{\\mathrm{up}}$。迎风总焓 $H^{\\mathrm{up}}$ 是从状态 $(\\rho^{\\mathrm{upwind}}, u_{c}, p_{c})$ 中选择的。我们将其表示为 $H^{\\mathrm{upwind}}$。\n$$ F_{num, 3} = (u_{c}\\rho^{\\mathrm{upwind}})H^{\\mathrm{upwind}} = u_{c}\\rho^{\\mathrm{upwind}}\\left(E^{\\mathrm{upwind}} + \\frac{p_{c}}{\\rho^{\\mathrm{upwind}}}\\right) = u_{c}(\\rho^{\\mathrm{upwind}}E^{\\mathrm{upwind}} + p_{c}) $$\n这与精确能量通量 $F_{exact, 3}$ 完全匹配。\n\n**充分条件总结：**\n为使 AUSM$+$ 型格式能精确解析接触间断，以下条件是充分的：\n1.  **重构：** 当底层数据为常数时，在单元界面处对原始变量 $(\\rho, u, p)$ 的重构必须为速度和压力产生唯一值，即 $u_{L}=u_{R}=u_{c}$ 和 $p_{L}=p_{R}=p_{c}$。\n2.  **压力分裂：** 当 $p_{L}=p_{R}=p_{c}$ 时，动量通量中的数值压力项 $p_{num}$ 的计算值必须为共同的物理压力 $p_{c}$。\n3.  **对流速度：** 当为满足 $u_{L}=u_{R}=u_c$ 和 $p_{L}=p_{R}=p_c$ 的界面状态进行求值时，界面对流速度 $u_f = a_{f}\\widehat{M}$ 的公式必须简化为物理速度 $u_c$。\n4.  **迎风一致性：** 迎风量 $(\\rho^{\\mathrm{up}}, u^{\\mathrm{up}}, H^{\\mathrm{up}})$ 必须根据对流速度 $u_f$ 的符号从左或右状态中选择。\n\n### 第二部分：数值质量通量计算\n\n我们被要求在上述推导的充分条件下，为一个特定状态计算数值质量通量。给定状态是：\n- 比热比：$\\gamma = 1.4$\n- 左右压力：$p_{L}=p_{R}=1.0 \\times 10^{5} \\, \\mathrm{Pa}$\n- 左右速度：$u_{L}=u_{R}=100 \\, \\mathrm{m/s}$\n- 左右密度：$\\rho_{L}=1.0 \\, \\mathrm{kg/m^{3}}$，$\\rho_{R}=2.0 \\, \\mathrm{kg/m^{3}}$\n\n此状态代表一个接触间断，其共同速度为 $u_{c} = 100 \\, \\mathrm{m/s}$，共同压力为 $p_{c} = 1.0 \\times 10^{5} \\, \\mathrm{Pa}$。\n\n数值质量通量由公式 $\\dot{m} = (a_{f}\\widehat{M})\\rho^{\\mathrm{up}}$ 给出。\n第一部分推导的充分条件确保了数值通量计算能够重现精确的物理通量。具体来说，条件3要求对流速度 $u_f = a_{f}\\widehat{M}$ 等于物理速度 $u_c$。\n$$ u_{f} = a_{f}\\widehat{M} = u_{c} = 100 \\, \\mathrm{m/s} $$\n条件4规定迎风密度 $\\rho^{\\mathrm{up}}$ 根据 $u_f$ 的符号选择。由于 $u_f = 100 > 0$，流向从左到右，迎风状态是左侧状态。\n$$ \\rho^{\\mathrm{up}} = \\rho_{L} = 1.0 \\, \\mathrm{kg/m^{3}} $$\n将这些值代入数值质量通量公式：\n$$ \\dot{m} = u_{f} \\rho^{\\mathrm{up}} = (100 \\, \\mathrm{m/s}) \\times (1.0 \\, \\mathrm{kg/m^{3}}) = 100 \\, \\mathrm{kg}/(\\mathrm{m}^{2}\\,\\mathrm{s}) $$\n或者，我们可以直接说明条件强制 $\\dot{m}_{num} = \\dot{m}_{exact}$。对于以 $u_c > 0$ 移动的接触间断，其精确质量通量为 $\\rho_{L}u_{c}$。\n$$ \\dot{m}_{exact} = \\rho_{L} u_{c} = (1.0 \\, \\mathrm{kg/m^{3}}) \\times (100 \\, \\mathrm{m/s}) = 100 \\, \\mathrm{kg}/(\\mathrm{m}^{2}\\,\\mathrm{s}) $$\n问题要求答案四舍五入到四位有效数字。\n$$ \\dot{m} = 100.0 \\, \\mathrm{kg}/(\\mathrm{m}^{2}\\,\\mathrm{s}) = 1.000 \\times 10^{2} \\, \\mathrm{kg}/(\\mathrm{m}^{2}\\,\\mathrm{s}) $$", "answer": "$$\n\\boxed{1.000 \\times 10^{2}}\n$$", "id": "3292971"}, {"introduction": "AUSM格式虽然高效，但在声速点（即马赫数 $M \\approx 1$）附近可能产生非物理振荡，这种情况在喷管流动等实际应用中很常见。这个动手编程练习 [@problem_id:3292964] 将指导您实现一个关键的“熵修正”。通过平滑地混合亚音速和超音速公式，您可以确保格式的鲁棒性和物理真实性，这是实用CFD代码开发中的一项核心技能。", "problem": "考虑理想气体在一维准定常、准一维流经喷管喉道时的可压缩欧拉方程。质量、动量和能量的守恒定律，以及理想气体状态方程，构成了基本基础。平流上游分裂法（AUSM）系列的通量分裂格式利用依赖于马赫数的分裂函数，将界面通量分解为左右两种状态的贡献。在声速点附近，即局部马赫数 $M$ 满足 $M \\approx 1$ 的区域，离散数值格式可能会表现出非物理行为，除非施加熵修正。在本问题中，您将通过在一个由参数 $\\delta$ 控制的宽度带上混合亚声速和超声速形式，为AUSM类型的马赫数分裂函数构建一个平滑的熵修正，然后评估其对预测的壅塞质量流量的影响。\n\n从面积为 $A^\\ast$ 的界面喉道平面的质量守恒出发，将质量流量表示为界面质量通量与面积的乘积。使用AUSM风格的马赫数分裂来计算来自左右状态的界面质量通量，并引入一个熵修正，该修正使用一个连续可微的斜坡函数，在过渡带 $|M| \\in [1-\\delta,\\,1+\\delta]$ 上平滑地混合亚声速和超声速分裂函数。界面声速应构建为左右声速的平均值。喉道处的左右流动状态必须使用理想气体等熵关系，从给定的气源（滞止）条件中一致地推导出来。\n\n要求：\n- 使用可压缩欧拉方程和理想气体假设作为基本基础。\n- 根据给定的左右马赫数 $M_L$ 和 $M_R$，通过等熵关系，从共同的滞止压力 $P_0$ 和滞止温度 $T_0$ 计算喉道处的左右原始变量状态。\n- 使用马赫数分裂函数 $M^\\pm(M)$，在单个界面喉道处构建一个AUSM风格的质量通量：\n  - 在亚声速区域使用亚声速多项式分裂函数，在超声速区域使用标准的上游超声速分裂。\n  - 使用由 $\\delta$ 控制的、$C^1$ 的斜坡函数，在声速带上平滑地混合这两个区域，以实现熵修正。\n- 计算喉道处的壅塞质量流量 $\\dot{m}$ 为 $\\dot{m} = A^\\ast \\,\\Phi$，其中 $\\Phi$ 是由带有熵修正的AUSM风格格式产生的界面质量通量。\n\n使用的基本关系式：\n- 理想气体状态方程：$p = \\rho R T$。\n- 声速：$a = \\sqrt{\\gamma R T}$。\n- 滞止条件与静止条件之间的等熵关系：\n  $$T = \\frac{T_0}{1 + \\frac{\\gamma - 1}{2} M^2}, \\quad p = P_0 \\left(\\frac{T}{T_0}\\right)^{\\frac{\\gamma}{\\gamma - 1}}, \\quad \\rho = \\frac{p}{R T}, \\quad u = M a.$$\n- 理想气体在等熵假设下的理论壅塞质量流量：\n  $$\\dot{m}_\\mathrm{th} = A^\\ast \\, P_0 \\sqrt{\\frac{\\gamma}{R T_0}} \\left(\\frac{2}{\\gamma + 1}\\right)^{\\frac{\\gamma + 1}{2(\\gamma - 1)}}.$$\n\n任务：\n- 实现使用带有熵修正的马赫数分裂函数的AUSM风格界面质量通量，其中熵修正是通过一个连续可微的斜坡函数，在由 $\\delta$ 决定的声速带内平滑混合亚声速多项式和超声速上游形式来实现的。\n- 使用由左右声速的算术平均值构建的界面声速。\n- 对给定的测试套件，计算喉道处的预测壅塞质量流量 $\\dot{m}$。\n\n单位和数值输出：\n- 所有质量流量均以 $\\mathrm{kg/s}$ 为单位表示，并四舍五入到 $6$ 位小数。\n- 不涉及角度，因此不需要角度单位。\n\n测试套件：\n所有测试使用以下共同参数：\n- 比热比：$\\gamma = 1.4$。\n- 气体常数：$R = 287\\,\\mathrm{J/(kg\\cdot K)}$。\n- 滞止压力：$P_0 = 100000\\,\\mathrm{Pa}$。\n- 滞止温度：$T_0 = 300\\,\\mathrm{K}$。\n- 喉道面积：$A^\\ast = 0.01\\,\\mathrm{m^2}$。\n\n计算以下四种情况的质量流量 $\\dot{m}$：\n- 情况 1：$\\delta = 0$, $M_L = 0.98$, $M_R = 1.02$。\n- 情况 2：$\\delta = 0.05$, $M_L = 0.98$, $M_R = 1.02$。\n- 情况 3：$\\delta = 0.20$, $M_L = 0.98$, $M_R = 1.02$。\n- 情况 4：$\\delta = 0.05$, $M_L = 1.00$, $M_R = 1.00$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个计算结果，以逗号分隔的列表形式包含在方括号中，顺序与上述情况一致，例如 $[\\dot{m}_1,\\dot{m}_2,\\dot{m}_3,\\dot{m}_4]$，每个 $\\dot{m}_i$ 以 $\\mathrm{kg/s}$ 为单位表示，并四舍五入到 $6$ 位小数。", "solution": "该问题要求使用平流上游分裂法（AUSM）风格的通量公式来计算喷管喉道处的质量流量。问题的关键部分是为马赫数分裂函数实现一个平滑的熵修正，众所周知，这些函数在声速条件（$M=1$）附近会导致非物理振荡或不正确的激波捕捉。将遵循可压缩气体动力学和数值通量分裂的原理，逐步构建解决方案。\n\n首先，我们必须确定喉道处计算界面左（L）侧和右（R）侧气体的热力学状态。这些状态由它们各自的马赫数 $M_L$ 和 $M_R$ 定义，并从共同的滞止（气源）条件 $P_0$ 和 $T_0$ 推导出来，并假设为等熵过程。对于比热比为 $\\gamma$ 的理想气体，滞止性质和静态性质之间的关系如下：\n\n静态温度 $T$ 由下式给出：\n$$T(M) = \\frac{T_0}{1 + \\frac{\\gamma - 1}{2} M^2}$$\n\n静态压力 $p$ 由下式给出：\n$$p(M) = P_0 \\left(\\frac{T(M)}{T_0}\\right)^{\\frac{\\gamma}{\\gamma - 1}} = P_0 \\left(1 + \\frac{\\gamma - 1}{2} M^2\\right)^{-\\frac{\\gamma}{\\gamma - 1}}$$\n\n静态密度 $\\rho$ 使用理想气体定律 $p = \\rho R T$ 求得：\n$$\\rho(M) = \\frac{p(M)}{R T(M)}$$\n\n当地声速 $a$ 由下式给出：\n$$a(M) = \\sqrt{\\gamma R T(M)}$$\n\n使用这些方程，我们可以利用 $M_L$ 计算左侧状态的性质 $(\\rho_L, a_L)$，利用 $M_R$ 计算右侧状态的性质 $(\\rho_R, a_R)$。\n\n第二步是构建界面质量通量 $\\Phi$。AUSM 格式将对流通量分裂为由左侧和右侧状态贡献的分量。界面（下标用 $1/2$ 表示）处的质量通量构建为：\n$$\\Phi = c_{1/2} \\left( \\rho_L M_L^+ + \\rho_R M_R^- \\right)$$\n其中 $c_{1/2}$ 是界面声速，$M^\\pm$ 是分裂的马赫数函数。问题规定界面声速是左右值的算术平均值：\n$$c_{1/2} = \\frac{a_L + a_R}{2}$$\n\n第三步也是核心步骤是定义包含熵修正的分裂马赫数函数 $M^+(M)$ 和 $M^-(M)$。这些函数之和必须等于原始马赫数，即 $M^+(M) + M^-(M) = M$。我们定义两套分裂函数：一套用于亚声速区（$|M|  1$），另一套用于超声速区（$|M| \\ge 1$）。\n\n对于超声速区，我们使用标准的上游分裂：\n$$M^+_{sup}(M) = \\frac{M + |M|}{2} = \\max(0, M)$$\n$$M^-_{sup}(M) = \\frac{M - |M|}{2} = \\min(0, M)$$\n\n对于亚声速区，我们使用 AUSM 系列格式中常见的多项式分裂：\n$$M^+_{sub}(M) = \\frac{1}{4}(M+1)^2$$\n$$M^-_{sub}(M) = -\\frac{1}{4}(M-1)^2$$\n\n熵修正是通过在一个声速带 $|M| \\in [1-\\delta, 1+\\delta]$（其中 $\\delta$ 是一个小参数）上平滑地混合这两种形式来实现的。在公式之间进行急剧切换（对应于 $\\delta=0$）可能会导致数值问题。我们引入一个混合函数 $\\alpha(|M|)$，该函数是连续可微的（$C^1$），并在混合区间内从 $0$ 过渡到 $1$。\n设混合区域中的归一化坐标为 $x = \\frac{|M| - (1-\\delta)}{2\\delta}$。这将区间 $|M| \\in [1-\\delta, 1+\\delta]$ 映射到 $x \\in [0, 1]$。我们选择一个标准的 $C^1$ 平滑阶梯函数：\n$$\\alpha(x) = x^2(3-2x) \\quad \\text{for } x \\in [0,1]$$\n该函数满足 $\\alpha(0)=0$, $\\alpha(1)=1$ 和 $\\alpha'(0)=\\alpha'(1)=0$。\n\n最终的混合分裂马赫函数为：\n- 若 $|M| \\le 1-\\delta$：$\\quad M^\\pm(M) = M^\\pm_{sub}(M)$\n- 若 $|M| \\ge 1+\\delta$：$\\quad M^\\pm(M) = M^\\pm_{sup}(M)$\n- 若 $1-\\delta  |M|  1+\\delta$：\n  $$M^+(M) = (1-\\alpha) M^+_{sub}(M) + \\alpha M^+_{sup}(M)$$\n  $$M^-(M) = (1-\\alpha) M^-_{sub}(M) + \\alpha M^-_{sup}(M)$$\n对于 $\\delta=0$ 的情况，混合区域消失，格式在 $|M|=1$ 处退化为急剧切换。\n\n最后，计算出界面质量通量 $\\Phi$ 后，通过面积为 $A^\\ast$ 的喉道的总质量流量 $\\dot{m}$ 为：\n$$\\dot{m} = A^\\ast \\Phi = A^\\ast c_{1/2} \\left( \\rho_L M_L^+ + \\rho_R M_R^- \\right)$$\n其中 $M_L^+$ 使用 $M_L$ 进行评估，$M_R^-$ 使用 $M_R$ 进行评估。\n\n将此程序应用于指定的四个测试案例，使用给定的物理常数和参数。最终结果四舍五入到 $6$ 位小数。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the mass flow rate at a nozzle throat using an AUSM-style flux\n    formulation with a smooth entropy fix for the Mach-number splitting.\n    \"\"\"\n\n    # Common physical and geometric parameters\n    gamma = 1.4\n    R = 287.0  # J/(kg.K)\n    P0 = 100000.0  # Pa\n    T0 = 300.0  # K\n    A_star = 0.01  # m^2\n\n    # Test suite\n    test_cases = [\n        # (delta, M_L, M_R)\n        (0.0, 0.98, 1.02),\n        (0.05, 0.98, 1.02),\n        (0.20, 0.98, 1.02),\n        (0.05, 1.00, 1.00),\n    ]\n\n    def calculate_state(M, P0, T0, gamma, R):\n        \"\"\"\n        Calculates static properties (rho, a) from stagnation conditions and Mach number.\n        \"\"\"\n        temp_ratio = 1.0 / (1.0 + 0.5 * (gamma - 1.0) * M**2)\n        T = T0 * temp_ratio\n        p = P0 * (temp_ratio)**(gamma / (gamma - 1.0))\n        rho = p / (R * T)\n        a = np.sqrt(gamma * R * T)\n        return rho, a\n\n    def get_mach_split(M, delta):\n        \"\"\"\n        Calculates the split Mach numbers M+ and M- with a smooth entropy fix.\n        \"\"\"\n        M_abs = abs(M)\n\n        # Standard subsonic polynomial splitting\n        M_plus_sub = 0.25 * (M + 1.0)**2\n        M_minus_sub = -0.25 * (M - 1.0)**2\n\n        # Standard supersonic upwind splitting\n        M_plus_sup = 0.5 * (M + M_abs)\n        M_minus_sup = 0.5 * (M - M_abs)\n\n        if delta == 0.0:\n            if M_abs  1.0:\n                return M_plus_sub, M_minus_sub\n            else:\n                return M_plus_sup, M_minus_sup\n        else: # delta > 0\n            if M_abs = 1.0 - delta:\n                return M_plus_sub, M_minus_sub\n            elif M_abs >= 1.0 + delta:\n                return M_plus_sup, M_minus_sup\n            else: # Blending region\n                # C^1 smoothstep blending function alpha\n                x = (M_abs - (1.0 - delta)) / (2.0 * delta)\n                alpha = x**2 * (3.0 - 2.0 * x)\n                \n                M_plus_blend = (1.0 - alpha) * M_plus_sub + alpha * M_plus_sup\n                M_minus_blend = (1.0 - alpha) * M_minus_sub + alpha * M_minus_sup\n                return M_plus_blend, M_minus_blend\n\n    results = []\n    for case in test_cases:\n        delta, M_L, M_R = case\n\n        # 1. Calculate left and right states\n        rho_L, a_L = calculate_state(M_L, P0, T0, gamma, R)\n        rho_R, a_R = calculate_state(M_R, P0, T0, gamma, R)\n\n        # 2. Calculate interfacial speed of sound\n        c_interface = 0.5 * (a_L + a_R)\n\n        # 3. Calculate split Mach numbers\n        M_L_plus, _ = get_mach_split(M_L, delta)\n        _, M_R_minus = get_mach_split(M_R, delta)\n\n        # 4. Calculate interfacial mass flux Phi\n        phi_mass_flux = c_interface * (rho_L * M_L_plus + rho_R * M_R_minus)\n\n        # 5. Calculate total mass flow rate\n        m_dot = A_star * phi_mass_flux\n        \n        results.append(m_dot)\n\n    # Format results to 6 decimal places for final output\n    formatted_results = [f\"{round(res, 6):.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3292964"}, {"introduction": "精确捕捉强激波是许多数值格式面临的一大挑战。这项高级练习 [@problem_id:3292965] 设计了一个计算实验，用于评估一个格式的“激波保持”能力。通过使用基于Rankine-Hugoniot条件的诊断工具，将一个AUSM变体与鲁棒的HLLC求解器进行对比，您将学会如何在极端条件下批判性地评估一个数值格式的性能。", "problem": "给定一维可压缩、量热完全气体的欧拉方程，以及两个恒定状态之间的有限体积界面通量要求，设计一个计算实验，以评估一个数值通量是否在 Rankine–Hugoniot (RH) 跳跃条件的意义上保持了物理上正确的激波速度。设守恒状态为 $U = [\\rho,\\rho u,E]^T$，物理通量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^T$，并采用理想气体封闭关系 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$。考虑一个在激波附着坐标系中静止的激波，因此正确的 RH 激波速度为 $s_{\\text{exact}} = 0$，且上游（状态 $L$）和下游（状态 $R$）由经典的法向激波 RH 关系式相关联。从基本守恒定律和跨越静止间断的质量、动量和能量的 RH 跳跃条件出发，推导当左右状态为精确的激波前后状态时，界面通量 $F^\\text{num}$ 为能精确保持激波速度所需满足的离散一致性准则。然后，针对两种广泛使用的近似黎曼求解器，即 Advection Upstream Splitting Method (AUSM) 族（在动量通量中使用形式为 $p^\\pm$ 的压力分裂）和 Harten–Lax–van Leer–Contact (HLLC) 求解器，构建一个可计算的诊断量，该诊断量用于测量对离散 RH 质量条件的违反程度，从而量化激波速度缺陷。\n\n您的程序必须从第一性原理出发实现以下元素，不使用任何外部数据，也不硬编码最终答案：\n\n- 一个程序，用于根据给定的上游状态 $(\\rho_L,p_L,u_L)$ 和比热比 $\\gamma$ 来构造静止法向激波的精确下游状态。其中，上游马赫数 $M_L = u_L/a_L$，$a_L = \\sqrt{\\gamma p_L/\\rho_L}$。使用经典的法向激波 RH 关系式从 $(\\rho_L,p_L,u_L,\\gamma)$ 获得 $(\\rho_R,p_R,u_R)$。\n- 一个程序，用于计算欧拉方程的 HLLC 数值通量。该程序使用三波模型，其中左右波速 $S_L$ 和 $S_R$ 选为 Davis/Einfeldt 型的界值 $S_L = \\min(u_L - a_L, u_R - a_R)$ 和 $S_R = \\max(u_L + a_L, u_R + a_R)$，中间波速 $S_M$ 通过在接触波上强制动量守恒来获得。确保星区的物理量在近似求解器中满足每道波的 RH 关系。\n- 一个程序，用于计算 AUSM 族的通量。在该通量中，对流质量通量使用马赫数的标准亚音速多项式分裂，动量通量中的压力使用基于局部马赫数混合左右压力的 $p^\\pm$ 分裂。使用单界面参考声速 $a_f = \\max(a_L,a_R)$ 来形成无量纲马赫数 $M_L = u_L/a_f$ 和 $M_R = u_R/a_f$。对于质量通量分裂，当 $|M| \\le 1$ 时使用经典的 AUSM$^+$ 二阶多项式函数 $M^\\pm(M)$，当 $|M| \\ge 1$ 时使用精确迎风。对于压力分裂，当 $|M| \\le 1$ 时使用线性亚音速混合来定义 $p^+$ 和 $p^-$，当 $|M| \\ge 1$ 时使用精确迎风。界面压力应为 $p_f = p_L^+ + p_R^-$，界面质量通量和能量通量应使用与分裂马赫数符号一致的迎风格式。清晰地分离动量通量中的对流和压力贡献。\n- 一个基于 RH 质量跳跃的激波速度保持诊断：给定一个数值质量通量 $m^\\text{num} = (F^\\text{num})_1$，将隐含的激波速度定义为 $s_L = u_L - m^\\text{num}/\\rho_L$ 和 $s_R = u_R - m^\\text{num}/\\rho_R$。一个求解器在给定的状态对上精确满足 RH 条件，当且仅当 $s_L = s_R$。定义激波速度失配 $\\Delta s = s_L - s_R$，并报告无量纲缺陷 $C_s = \\lvert \\Delta s \\rvert / a_L$。由于所选坐标系中的精确激波是静止的，还可以定义一个偏差 $B_s = \\lvert \\tfrac{1}{2}(s_L+s_R) - s_{\\text{exact}}\\rvert / a_L$ 作为可选的验证；但是，为了评分，您的程序必须至少输出缺陷 $C_s$。\n\n使用无量纲单位，设 $R=1$，并将所有速度和导出的无量纲量报告为无量纲数。不使用角度。实现以下上游状态的测试套件，每个状态通过指定的上游马赫数在激波附着坐标系中定义一个静止法向激波：\n\n- 案例 A（强激波）：$\\gamma = 1.4$, $\\rho_L = 1$, $p_L = 1$, $M_L = 300$。\n- 案例 B（中等强度激波）：$\\gamma = 1.4$, $\\rho_L = 1$, $p_L = 1$, $M_L = 2$。\n- 案例 C（极弱激波）：$\\gamma = 1.4$, $\\rho_L = 1$, $p_L = 1$, $M_L = 1.01$。\n\n对于每个案例，使用给定的 $(\\rho_L,p_L,u_L)$（其中 $u_L = M_L a_L$），通过法向激波 RH 关系式构造 $(\\rho_R,p_R,u_R)$，并计算上述 HLLC 和 AUSM 族通量的 $C_s$。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为列表的列表，每个案例一个，其中每个内部列表按顺序包含两个浮点值 $[C_s^\\text{HLLC}, C_s^\\text{AUSM}]$。例如，输出必须具有形式 $[[x_A,y_A],[x_B,y_B],[x_C,y_C]]$，其中每个 $x$ 和 $y$ 都是十进制数。", "solution": "该问题要求进行一项计算实验，以评估两种数值通量函数（HLLC 和 AUSM 族的一个特定变体）在处理一维欧拉方程时对激波的保持特性。评估基于为静止激波推导出的 Rankine-Hugoniot (RH) 跳跃条件的诊断方法。\n\n### 理论基础\n\n一维、量热完全气体的欧拉方程的守恒形式如下：\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\n其中，$U$ 是守恒变量矢量，$F(U)$ 是通量矢量：\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad F(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix}\n$$\n这里，$\\rho$ 是密度，$u$ 是速度，$E$ 是单位体积的总能量，$p$ 是压力。该系统通过理想气体状态方程封闭：\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right)\n$$\n其中 $\\gamma$ 是比热比。\n\n一个以速度 $s$ 移动并分隔左右状态（分别为 $L$ 和 $R$）的间断（如激波）必须满足 Rankine-Hugoniot (RH) 跳跃条件：\n$$\ns(U_R - U_L) = F(U_R) - F(U_L)\n$$\n\n### 静止激波的离散一致性准则\n\n我们考虑一个静止激波，其激波速度 $s=0$。RH 条件简化为：\n$$\nF(U_R) - F(U_L) = 0 \\implies F(U_L) = F(U_R)\n$$\n这意味着物理通量在静止激波两侧是恒定的。\n\n在有限体积法中，单元 $i$ 的半离散方程为：\n$$\n\\frac{d U_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2}^\\text{num} - F_{i-1/2}^\\text{num} \\right)\n$$\n其中 $F_{i+1/2}^\\text{num} = F^\\text{num}(U_i, U_{i+1})$ 是单元 $i$ 和 $i+1$ 之间界面的数值通量。\n\n为了让一个数值解能精确表示位于界面 $i+1/2$ 处的静止激波，单元中的状态必须随时间保持恒定。这意味着对所有 $i$ 都有 $\\frac{dU_i}{dt} = 0$。如果我们将单元 $i$ 设置为激波前状态 $U_L$，将单元 $i+1$ 设置为激波后状态 $U_R$，那么在激波界面处达到稳态的条件是：\n$$\nF^\\text{num}(U_L, U_R) = F^\\text{num}(U_L, U_L) = F(U_L)\n$$\n和\n$$\nF^\\text{num}(U_L, U_R) = F^\\text{num}(U_R, U_R) = F(U_R)\n$$\n这里我们使用了数值通量的一致性属性，$F^\\text{num}(U, U) = F(U)$。\n这两个条件都导向同一个准则：为了让一个数值通量 $F^\\text{num}$ 能够精确地保持连接状态 $U_L$ 和 $U_R$ 的静止激波，它必须满足：\n$$\nF^\\text{num}(U_L, U_R) = F(U_L) = F(U_R)\n$$\n这个性质通常被称为“精确激波满足”。许多近似黎曼求解器不满足这个条件，导致了诸如不正确的激波速度等数值误差。\n\n### 激波速度缺陷诊断\n\n质量守恒的 RH 条件是：\n$$\ns(\\rho_R - \\rho_L) = \\rho_R u_R - \\rho_L u_L\n$$\n这可以重新排列，表明在随激波移动的参考系中，质量通量 $m^* = \\rho(u-s)$ 是恒定的：\n$$\n\\rho_L(u_L - s) = \\rho_R(u_R - s)\n$$\n由此，激波速度 $s$ 可以用两种方式表示：\n$$\ns = u_L - \\frac{m^*}{\\rho_L} \\quad \\text{和} \\quad s = u_R - \\frac{m^*}{\\rho_R}\n$$\n对于一个数值格式，在界面上计算出的数值质量通量 $m^\\text{num} = (F^\\text{num})_1$ 是 $m^*$ 的离散模拟。因此，我们可以根据左右状态定义两个隐含的激波速度：\n$$\ns_L = u_L - \\frac{m^\\text{num}}{\\rho_L}\n$$\n$$\ns_R = u_R - \\frac{m^\\text{num}}{\\rho_R}\n$$\n如果数值格式能够完美满足质量跳跃条件，我们应该有 $s_L = s_R$。差值 $\\Delta s = s_L - s_R$ 代表了在满足离散 RH 质量条件方面的失配或误差。这个失配可以表示为：\n$$\n\\Delta s = (u_L - u_R) - m^\\text{num} \\left(\\frac{1}{\\rho_L} - \\frac{1}{\\rho_R}\\right)\n$$\n非零的 $\\Delta s$ 表明数值激波将以不正确的速度传播。我们通过用上游声速 $a_L$ 对此失配进行归一化，定义一个无量纲的激波速度缺陷 $C_s$：\n$$\nC_s = \\frac{|\\Delta s|}{a_L}\n$$\n这个诊断量化了数值通量在保持正确激波速度方面的失败程度。\n\n### 正激波关系\n\n为了构建测试案例，我们需要给定激波前状态 $(\\rho_L, p_L, u_L)$ 和 $\\gamma$，计算静止正激波的激波后状态 $(\\rho_R, p_R, u_R)$。上游马赫数是 $M_L = u_L/a_L$，其中 $a_L = \\sqrt{\\gamma p_L / \\rho_L}$。经典的正激波 RH 关系式是：\n$$\n\\frac{p_R}{p_L} = 1 + \\frac{2\\gamma}{\\gamma+1}(M_L^2 - 1)\n$$\n$$\n\\frac{\\rho_R}{\\rho_L} = \\frac{(\\gamma+1)M_L^2}{(\\gamma-1)M_L^2 + 2}\n$$\n$$\n\\frac{u_R}{u_L} = \\frac{(\\gamma-1)M_L^2 + 2}{(\\gamma+1)M_L^2}\n$$\n\n### 数值通量公式\n\n#### 1. HLLC 通量\n\nHarten-Lax-van Leer-Contact (HLLC) 通量是一个三波近似黎曼求解器。波速估计如下：\n$$\nS_L = \\min(u_L - a_L, u_R - a_R)\n$$\n$$\nS_R = \\max(u_L + a_L, u_R + a_R)\n$$\n接触波速 $S_M$ 通过在波之间的“星区”强制动量守恒来确定：\n$$\nS_M = \\frac{p_R - p_L + \\rho_L u_L(S_L - u_L) - \\rho_R u_R(S_R - u_R)}{\\rho_L(S_L - u_L) - \\rho_R(S_R - u_R)}\n$$\n然后，HLLC 通量 $F^\\text{HLLC}$ 根据这些波速相对于界面（速度为0）的符号来选择：\n- 如果 $S_L \\ge 0$, $F^\\text{HLLC} = F_L$。\n- 如果 $S_R \\le 0$, $F^\\text{HLLC} = F_R$。\n- 如果 $S_L  0  S_R$：\n    - 如果 $S_M \\ge 0$, $F^\\text{HLLC} = F^*_L = F_L + S_L(U^*_L - U_L)$。\n    - 如果 $S_M  0$, $F^\\text{HLLC} = F^*_R = F_R + S_R(U^*_R - U_R)$。\n星区状态 $U_K^*$ 由 $U_K^* = \\frac{S_K U_K - F_K}{S_K - S_M}$ 给出，其中 $K \\in \\{L,R\\}$。所需的 $U^*_K$ 的质量分量是 $\\rho^*_K = \\rho_K \\frac{S_K - u_K}{S_K - S_M}$。\n\n#### 2. AUSM 族通量\n\n指定的 Advection Upstream Splitting Method (AUSM) 族通量将物理通量分为对流部分和压力部分。参考声速为 $a_f = \\max(a_L, a_R)$，它定义了界面马赫数 $M_L=u_L/a_f$ 和 $M_R=u_R/a_f$。\n\n界面质量通量 $m^\\text{num}$ 计算如下：\n$$\nm^\\text{num} = a_f (\\rho_L M^+(M_L) + \\rho_R M^-(M_R))\n$$\n其中 $M^\\pm(M)$ 是马赫数的 AUSM$^+$ 多项式分裂函数：\n- 对于 $|M| \\ge 1$：$M^+(M) = \\frac{1}{2}(M+|M|)$，$M^-(M) = \\frac{1}{2}(M-|M|)$。\n- 对于 $|M|  1$：$M^+(M) = \\frac{1}{4}(M+1)^2$，$M^-(M) = -\\frac{1}{4}(M-1)^2$。\n\n界面处的压力 $p_f$ 是通过混合左右压力形成的：\n$$\np_f = p_L p^+(M_L) + p_R p^-(M_R)\n$$\n其中 $p^\\pm(M)$ 是基于线性亚音速混合的压力分裂函数：\n- 对于 $|M| \\ge 1$：$p^+(M) = \\frac{1}{2}(1+\\text{sign}(M))$，$p^-(M) = \\frac{1}{2}(1-\\text{sign}(M))$。\n- 对于 $|M|  1$：$p^+(M) = \\frac{1}{2}(1+M)$，$p^-(M) = \\frac{1}{2}(1-M)$。\n\n完整的数值通量是 $F^\\text{num} = F_c + F_p$。压力通量是 $F_p=[0, p_f, 0]^T$。对流通量 $F_c$ 根据 $m^\\text{num}$ 的符号进行迎风处理：\n$$\nF_c = m^\\text{num} \\times \\begin{cases} [1, u_L, H_L]^T   \\text{if } m^\\text{num} \\ge 0 \\\\ [1, u_R, H_R]^T   \\text{if } m^\\text{num}  0 \\end{cases}\n$$\n其中 $H=(E+p)/\\rho$ 是比总焓。总通量的第一个分量就是 $m^\\text{num}$，这正是我们进行诊断所需要的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main driver function to perform the computational experiment.\n    It sets up test cases, computes the shock-speed defect for HLLC and AUSM fluxes,\n    and prints the results in the specified format.\n    \"\"\"\n\n    test_cases = [\n        # Case A (extreme shock)\n        {'M_L': 300.0, 'gamma': 1.4, 'rho_L': 1.0, 'p_L': 1.0},\n        # Case B (moderate shock)\n        {'M_L': 2.0, 'gamma': 1.4, 'rho_L': 1.0, 'p_L': 1.0},\n        # Case C (very weak shock)\n        {'M_L': 1.01, 'gamma': 1.4, 'rho_L': 1.0, 'p_L': 1.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        M_L = case['M_L']\n        gamma = case['gamma']\n        rho_L = case['rho_L']\n        p_L = case['p_L']\n\n        # 1. Compute upstream state and derived quantities\n        a_L = np.sqrt(gamma * p_L / rho_L)\n        u_L = M_L * a_L\n\n        # 2. Compute exact post-shock state using RH relations\n        rho_R, p_R, u_R = get_post_shock_state(rho_L, p_L, u_L, M_L, gamma)\n        \n        # 3. Compute HLLC flux and diagnostic\n        m_num_hllc = hllc_mass_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n        s_L_hllc = u_L - m_num_hllc / rho_L\n        s_R_hllc = u_R - m_num_hllc / rho_R\n        delta_s_hllc = s_L_hllc - s_R_hllc\n        C_s_hllc = np.abs(delta_s_hllc) / a_L\n\n        # 4. Compute AUSM-family flux and diagnostic\n        m_num_ausm = ausm_mass_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n        s_L_ausm = u_L - m_num_ausm / rho_L\n        s_R_ausm = u_R - m_num_ausm / rho_R\n        delta_s_ausm = s_L_ausm - s_R_ausm\n        C_s_ausm = np.abs(delta_s_ausm) / a_L\n\n        results.append([C_s_hllc, C_s_ausm])\n\n    # Format the final output string as required\n    inner_strs = [f\"[{r[0]},{r[1]}]\" for r in results]\n    final_str = f\"[{','.join(inner_strs)}]\"\n    print(final_str)\n\ndef get_post_shock_state(rho_L, p_L, u_L, M_L, gamma):\n    \"\"\"\n    Computes the downstream (post-shock) state for a stationary normal shock\n    using the Rankine-Hugoniot relations.\n    \n    Args:\n        rho_L (float): Upstream density.\n        p_L (float): Upstream pressure.\n        u_L (float): Upstream velocity.\n        M_L (float): Upstream Mach number.\n        gamma (float): Ratio of specific heats.\n        \n    Returns:\n        tuple: (rho_R, p_R, u_R) - downstream density, pressure, and velocity.\n    \"\"\"\n    M_L2 = M_L**2\n    \n    p_ratio = 1.0 + (2.0 * gamma / (gamma + 1.0)) * (M_L2 - 1.0)\n    rho_ratio = ((gamma + 1.0) * M_L2) / ((gamma - 1.0) * M_L2 + 2.0)\n    u_ratio = ((gamma - 1.0) * M_L2 + 2.0) / ((gamma + 1.0) * M_L2)\n    \n    p_R = p_L * p_ratio\n    rho_R = rho_L * rho_ratio\n    u_R = u_L * u_ratio\n    \n    return rho_R, p_R, u_R\n\ndef hllc_mass_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n    \"\"\"\n    Computes the numerical mass flux for the HLLC scheme.\n    \"\"\"\n    # 1. Compute primitive variables and conserved vectors\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    E_L = p_L / (gamma - 1.0) + 0.5 * rho_L * u_L**2\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    U_L = np.array([rho_L, rho_L * u_L, E_L])\n    \n    a_R = np.sqrt(gamma * p_R / rho_R)\n    E_R = p_R / (gamma - 1.0) + 0.5 * rho_R * u_R**2\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n    U_R = np.array([rho_R, rho_R * u_R, E_R])\n\n    # 2. Estimate wave speeds (Davis/Einfeldt)\n    S_L = min(u_L - a_L, u_R - a_R)\n    S_R = max(u_L + a_L, u_R + a_R)\n\n    # 3. Determine flux based on region\n    if S_L >= 0:\n        return F_L[0]\n    if S_R = 0:\n        return F_R[0]\n\n    # Transonic case: S_L  0  S_R\n    # Compute contact wave speed S_M\n    num_SM = p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R)\n    den_SM = rho_L * (S_L - u_L) - rho_R * (S_R - u_R)\n    S_M = num_SM / den_SM\n\n    # Determine flux based on S_M position\n    if S_M >= 0: # F_L* region\n        # rho_star_L = rho_L * (S_L - u_L) / (S_L - S_M)\n        # U_star_L_mass = rho_star_L\n        U_star_L_mass = U_L[0] * (S_L - u_L) / (S_L - S_M)\n        m_flux = F_L[0] + S_L * (U_star_L_mass - U_L[0])\n    else: # F_R* region\n        # rho_star_R = rho_R * (S_R - u_R) / (S_R - S_M)\n        # U_star_R_mass = rho_star_R\n        U_star_R_mass = U_R[0] * (S_R - u_R) / (S_R - S_M)\n        m_flux = F_R[0] + S_R * (U_star_R_mass - U_R[0])\n        \n    return m_flux\n\ndef ausm_mass_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n    \"\"\"\n    Computes the numerical mass flux for the specified AUSM-family scheme.\n    \"\"\"\n    # 1. Define splitting functions\n    def M_plus(M):\n        if np.abs(M) >= 1.0:\n            return 0.5 * (M + np.abs(M))\n        else:\n            return 0.25 * (M + 1.0)**2\n\n    def M_minus(M):\n        if np.abs(M) >= 1.0:\n            return 0.5 * (M - np.abs(M))\n        else:\n            return -0.25 * (M - 1.0)**2\n\n    # 2. Compute reference sound speed and face Mach numbers\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n    a_f = max(a_L, a_R)\n    \n    M_L = u_L / a_f\n    M_R = u_R / a_f\n\n    # 3. Compute interface mass flux\n    m_num = a_f * (rho_L * M_plus(M_L) + rho_R * M_minus(M_R))\n    \n    return m_num\n\n# Run the full problem solution\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3292965"}]}