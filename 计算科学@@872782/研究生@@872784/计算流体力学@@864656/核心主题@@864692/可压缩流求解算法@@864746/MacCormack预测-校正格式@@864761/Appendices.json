{"hands_on_practices": [{"introduction": "在计算流体力学中，一个数值格式的稳定性和精度是其是否可用的基本前提。冯·诺依曼稳定性分析是一种强大的工具，它使我们能够量化一个格式在离散化过程中如何影响不同波长的分量。通过本练习，您将推导麦考马克格式的放大因子，从而深入理解其固有的数值耗散与色散特性。[@problem_id:3342546]", "problem": "考虑一维线性平流方程 $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$，该方程建立在间距为 $\\Delta x$ 的均匀周期性网格和时间步长为 $\\Delta t$ 的基础上，其中 $a>0$ 是一个恒定的平流速度。通过节点 $x_j = j \\Delta x$ 对 $x$ 进行离散，通过时间层 $t^n = n \\Delta t$ 对 $t$ 进行离散。MacCormack 预测-校正格式由以下两个步骤定义：\n预测步：$u_j^{*} = u_j^n - \\nu \\left(u_{j+1}^n - u_j^n\\right)$，\n校正步：$u_j^{n+1} = \\frac{1}{2} \\left(u_j^n + u_j^{*} - \\nu \\left(u_j^{*} - u_{j-1}^{*}\\right)\\right)$，\n其中 Courant–Friedrichs–Lewy (CFL) 数为 $\\nu = \\frac{a \\Delta t}{\\Delta x}$。\n\n从平流方程和这些离散更新公式出发，通过假设一个傅里叶模 $u_j^n = \\hat{u}^n \\exp(i j \\theta)$ 来进行 von Neumann 稳定性分析，并推导 MacCormack 格式的放大因子 $G(\\theta;\\nu)$。然后，在 $\\theta = \\frac{\\pi}{2}$ 处计算放大因子，以确定其每个时间步的模 $|G|$ 和相位 $\\phi = \\arg(G)$。假设 $0 < \\nu < 1$，这样相位的主值可以被明确定义而没有分支模糊性。评估该模是被耗散还是被放大，并以弧度为单位量化每个时间步的相移。\n\n请以有序对 $\\left(|G|,\\phi\\right)$ 的形式给出你的最终答案，该有序对用 $a$、$\\Delta x$ 和 $\\Delta t$ 表示，并且相位以弧度为单位。不需要进行数值四舍五入；请提供一个封闭形式的解析表达式。", "solution": "问题陈述经过严格验证并被确定为有效。它在科学上基于计算流体力学的原理，问题设定良好，目标明确，数据充分，语言客观。任务是为应用于线性平流方程的 MacCormack 格式进行标准的 von Neumann 稳定性分析。\n\n分析始于考虑在离散时间层 $n$ 和空间节点 $j$ 的数值解 $u_j^n$ 的单个傅里叶模：\n$$u_j^n = \\hat{u}^n \\exp(i j \\theta)$$\n其中 $\\hat{u}^n$ 是在时间层 $n$ 的模的振幅，$i = \\sqrt{-1}$ 是虚数单位，$\\theta = k \\Delta x$ 是无量纲波数，其中 $k$ 是物理波数，$\\Delta x$ 是空间网格间距。放大因子 $G$ 由关系式 $\\hat{u}^{n+1} = G \\cdot \\hat{u}^n$ 定义。我们的目标是找到 $G(\\theta; \\nu)$ 的表达式。\n\n我们将傅里叶模代入 MacCormack 格式的两个步骤中。\n\n首先，对于预测步：\n$$u_j^{*} = u_j^n - \\nu \\left(u_{j+1}^n - u_j^n\\right)$$\n代入傅里叶模得到：\n$$\\hat{u}^* \\exp(i j \\theta) = \\hat{u}^n \\exp(i j \\theta) - \\nu \\left(\\hat{u}^n \\exp(i (j+1) \\theta) - \\hat{u}^n \\exp(i j \\theta)\\right)$$\n两边同除以 $\\exp(i j \\theta)$：\n$$\\hat{u}^* = \\hat{u}^n - \\nu \\left(\\hat{u}^n \\exp(i \\theta) - \\hat{u}^n\\right)$$\n$$\\hat{u}^* = \\hat{u}^n \\left(1 - \\nu (\\exp(i \\theta) - 1)\\right)$$\n这给出了预测振幅 $\\hat{u}^*$ 和初始振幅 $\\hat{u}^n$ 之间的关系。\n\n接下来，对于校正步：\n$$u_j^{n+1} = \\frac{1}{2} \\left(u_j^n + u_j^{*} - \\nu \\left(u_j^{*} - u_{j-1}^{*}\\right)\\right)$$\n我们为 $u_j^{n+1}$、$u_j^n$ 以及预测值 $u_j^*$ 和 $u_{j-1}^*$ 代入相应的傅里叶模：\n$$\\hat{u}^{n+1} \\exp(i j \\theta) = \\frac{1}{2} \\left(\\hat{u}^n \\exp(i j \\theta) + \\hat{u}^* \\exp(i j \\theta) - \\nu \\left(\\hat{u}^* \\exp(i j \\theta) - \\hat{u}^* \\exp(i (j-1) \\theta)\\right)\\right)$$\n两边同除以 $\\exp(i j \\theta)$：\n$$\\hat{u}^{n+1} = \\frac{1}{2} \\left(\\hat{u}^n + \\hat{u}^* - \\nu \\left(\\hat{u}^* - \\hat{u}^* \\exp(-i \\theta)\\right)\\right)$$\n$$\\hat{u}^{n+1} = \\frac{1}{2} \\left(\\hat{u}^n + \\hat{u}^* \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\n为了找到放大因子 $G = \\hat{u}^{n+1}/\\hat{u}^n$，我们将方程两边同除以 $\\hat{u}^n$：\n$$G = \\frac{1}{2} \\left(1 + \\frac{\\hat{u}^*}{\\hat{u}^n} \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\n代入从预测步得到的 $\\hat{u}^*/\\hat{u}^n$ 的表达式：\n$$G = \\frac{1}{2} \\left(1 + \\left(1 - \\nu (\\exp(i \\theta) - 1)\\right) \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\n展开乘积项：\n$$(1 - \\nu (\\exp(i \\theta) - 1)) (1 - \\nu (1 - \\exp(-i \\theta))) = 1 - \\nu(1-\\exp(-i\\theta)) - \\nu(\\exp(i\\theta)-1) + \\nu^2(\\exp(i\\theta)-1)(1-\\exp(-i\\theta))$$\n$$= 1 - \\nu + \\nu\\exp(-i\\theta) - \\nu\\exp(i\\theta) + \\nu + \\nu^2(\\exp(i\\theta) - 1 - 1 + \\exp(-i\\theta))$$\n$$= 1 - \\nu(\\exp(i\\theta) - \\exp(-i\\theta)) + \\nu^2(\\exp(i\\theta) + \\exp(-i\\theta) - 2)$$\n使用欧拉恒等式，$\\exp(i\\theta) - \\exp(-i\\theta) = 2i\\sin(\\theta)$ 和 $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$：\n$$= 1 - 2i\\nu\\sin(\\theta) + \\nu^2(2\\cos(\\theta) - 2) = 1 - 2i\\nu\\sin(\\theta) - 2\\nu^2(1-\\cos(\\theta))$$\n将此结果代回 $G$ 的表达式中：\n$$G = \\frac{1}{2} \\left(1 + 1 - 2i\\nu\\sin(\\theta) - 2\\nu^2(1-\\cos(\\theta))\\right)$$\n$$G(\\theta; \\nu) = 1 - \\nu^2(1-\\cos(\\theta)) - i\\nu\\sin(\\theta)$$\n使用半角恒等式 $1-\\cos(\\theta) = 2\\sin^2(\\theta/2)$，这也可以写成：\n$$G(\\theta; \\nu) = 1 - 2\\nu^2\\sin^2\\left(\\frac{\\theta}{2}\\right) - i\\nu\\sin(\\theta)$$\n这就是 MacCormack 格式的一般放大因子。\n\n现在，我们在特定波数 $\\theta = \\frac{\\pi}{2}$ 处计算 $G$：\n$$\\sin\\left(\\frac{\\pi}{2}\\right) = 1$$\n$$\\sin\\left(\\frac{\\theta}{2}\\right) = \\sin\\left(\\frac{\\pi}{4}\\right) = \\frac{\\sqrt{2}}{2} \\implies \\sin^2\\left(\\frac{\\theta}{2}\\right) = \\frac{1}{2}$$\n将这些值代入 $G$ 的表达式中：\n$$G\\left(\\frac{\\pi}{2}; \\nu\\right) = 1 - 2\\nu^2\\left(\\frac{1}{2}\\right) - i\\nu(1) = 1 - \\nu^2 - i\\nu$$\n这是一个复数，表示指定模的放大因子。\n\n接下来，我们计算它的模 $|G|$：\n$$|G| = \\left|1 - \\nu^2 - i\\nu\\right| = \\sqrt{\\left(1 - \\nu^2\\right)^2 + (-\\nu)^2}$$\n$$|G| = \\sqrt{1 - 2\\nu^2 + \\nu^4 + \\nu^2}$$\n$$|G| = \\sqrt{1 - \\nu^2 + \\nu^4}$$\n对于给定的条件 $0  \\nu  1$，我们有 $\\nu^2 > \\nu^4$，所以 $\\nu^2 - \\nu^4 > 0$。因此，$1 - (\\nu^2 - \\nu^4)  1$，这意味着 $|G|  1$。这表明该模式被耗散，正如稳定格式所预期的那样。\n\n最后，我们计算相位 $\\phi = \\arg(G)$。实部是 $\\text{Re}(G) = 1 - \\nu^2$，虚部是 $\\text{Im}(G) = -\\nu$。由于 $0  \\nu  1$，实部为正，虚部为负，所以该复数位于第四象限。\n$$\\phi = \\arctan\\left(\\frac{\\text{Im}(G)}{\\text{Re}(G)}\\right) = \\arctan\\left(\\frac{-\\nu}{1 - \\nu^2}\\right)$$\n$$\\phi = -\\arctan\\left(\\frac{\\nu}{1 - \\nu^2}\\right)$$\n这个相位 $\\phi$ 是每个时间步的数值相移，以弧度为单位。\n\n问题要求最终答案用 $a$、$\\Delta x$ 和 $\\Delta t$ 表示。我们将 CFL 数 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 代入 $|G|$ 和 $\\phi$ 的表达式中。\n$$|G| = \\sqrt{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2 + \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^4}$$\n$$\\phi = -\\arctan\\left(\\frac{\\frac{a \\Delta t}{\\Delta x}}{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2}\\right) = -\\arctan\\left(\\frac{\\frac{a \\Delta t}{\\Delta x}}{\\frac{(\\Delta x)^2 - (a \\Delta t)^2}{(\\Delta x)^2}}\\right) = -\\arctan\\left(\\frac{a \\Delta t \\Delta x}{(\\Delta x)^2 - (a \\Delta t)^2}\\right)$$\n\n最终结果是有序对 $(|G|, \\phi)$。", "answer": "$$\\boxed{\\left( \\sqrt{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2 + \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^4}, \\, -\\arctan\\left(\\frac{a \\Delta t \\Delta x}{(\\Delta x)^2 - (a \\Delta t)^2}\\right) \\right)}$$", "id": "3342546"}, {"introduction": "从简单的常系数平流方程过渡到更现实的物理模型时，我们经常会遇到系数随空间变化的情况。直接将麦考马克格式应用于非守恒形式的变系数方程会导致精度损失，这是一个常见的陷阱。本练习旨在揭示这一问题背后的原因，并指导您构建一个基于通量守恒形式的麦考马克格式，以在变系数情况下恢复其二阶精度。[@problem_id:3342575]", "problem": "考虑一个具有空间变化输运系数的标量场的线性平流问题，该问题由守恒律 $u_{t} + (a(x) u)_{x} = 0$ 描述，其中 $a(x)$ 是一个光滑、不依赖于时间的函数，而 $u(x,t)$ 足够光滑。设空间域在具有节点 $x_{i} = x_{0} + i \\,\\Delta x$ 的均匀网格上离散化，时间以 $t_{n} = t_{0} + n \\,\\Delta t$ 离散化。定义库朗数 $\\lambda = \\Delta t / \\Delta x$。假设采用周期性边界条件，并关注一个通用内部节点 $x_{i}$。\n\n从上述偏微分方程以及前向和后向离散差分的定义出发。分析一个“朴素的”MacCormack预估-校正格式在节点 $x_{i}$ 处的局部截断误差。该格式通过在预估和校正步骤中都使用 $a_{i} = a(x_{i})$ 乘以 $u$ 的单边离散差分来离散化非守恒形式 $u_{t} + a(x) u_{x} = 0$。通过在 $x_{i}$ 和 $t_{n}$ 处进行泰勒展开，并利用守恒律 $u_{t} = - (a u)_{x}$，推导由于忽略系数梯度而产生的局部截断误差中的领阶非零项。解释该项如何导致二阶精度的损失。\n\n然后，构建一个以守恒形式表述的、考虑系数的MacCormack预估-校正格式，在预估和校正步中均使用单元中心的离散通量 $f_{i}^{n} = a_{i} \\, u_{i}^{n}$。消去中间预估状态，以 $u_{i-1}^{n}$、$u_{i}^{n}$、$u_{i+1}^{n}$ 和 $a_{i-1}$、$a_{i}$、$a_{i+1}$ 以及 $\\lambda$ 显式地写出 $u_{i}^{n+1}$ 的单步组合更新式。该表达式必须是代数封闭的，不包含任何预估量，并且在 $a(x)$ 和 $u(x,t)$ 光滑的条件下必须与二阶精度相符。你的最终答案应该是这个考虑系数的守恒型MacCormack格式所产生的 $u_{i}^{n+1}$ 的单一封闭形式解析表达式。无需进行数值计算。", "solution": "我们从守恒律 $u_{t} + (a u)_{x} = 0$ 开始，其中 $a(x)$ 是光滑、不依赖于时间的，而 $u(x,t)$ 是光滑的。基本出发点是守恒形式及其乘积法则展开式 $(a u)_{x} = a u_{x} + a_{x} u$，以及在网格点处关于空间和时间的泰勒展开。\n\n对朴素非守恒MacCormack格式及其二阶精度损失的分析：\n\n考虑通过用 $a_{i} = a(x_{i})$ 乘以 $u$ 的单边差分来离散化 $u_{t} + a(x) u_{x} = 0$ 的朴素MacCormack预估-校正格式。其在节点 $i$ 处的预估步和校正步为\n$$\nu_{i}^{*} = u_{i}^{n} - \\lambda \\, a_{i} \\left(u_{i+1}^{n} - u_{i}^{n}\\right),\n$$\n$$\nu_{i}^{n+1} = \\frac{1}{2} \\left[ u_{i}^{n} + u_{i}^{*} - \\lambda \\, a_{i} \\left( u_{i}^{*} - u_{i-1}^{*} \\right) \\right].\n$$\n为评估其与守恒律的相容性，我们将精确解 $u(x,t)$ 代入 $(x_{i},t_{n})$ 处，并展开至 $\\Delta x$ 和 $\\Delta t$ 的领阶。为简洁起见，将 $\\Delta x$ 记为 $\\Delta$。对空间值进行泰勒展开：\n$$\nu_{i+1}^{n} = u + u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} + \\mathcal{O}(\\Delta^{4}),\n$$\n$$\nu_{i-1}^{n} = u - u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} - \\frac{1}{6} u_{xxx} \\Delta^{3} + \\mathcal{O}(\\Delta^{4}),\n$$\n以及 $a_{i-1} = a - a_{x} \\Delta + \\frac{1}{2} a_{xx} \\Delta^{2} + \\mathcal{O}(\\Delta^{3})$，其中所有导数均在 $(x_{i},t_{n})$ 处取值。预估步得到\n$$\nu_{i}^{*} = u - \\lambda \\, a \\left( u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right) + \\mathcal{O}(\\Delta^{4}).\n$$\n在 $i-1$ 处的类似展开给出\n\\begin{align*}\nu_{i-1}^{*} = \\left[ u - u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} - \\frac{1}{6} u_{xxx} \\Delta^{3} \\right] \\\\\n\\quad - \\lambda \\left[ a u_{x} \\Delta + \\left( -\\frac{1}{2} a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{6} a u_{xxx} + \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\n相减得到\n\\begin{align*}\nu_{i}^{*} - u_{i-1}^{*} = u_{x} \\Delta - \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\\\\n\\quad + \\lambda \\left[ \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\n现在构造校正步：\n\\begin{align*}\nu_{i}^{n+1} = \\frac{1}{2} \\left\\{ \\left[ u + u_{i}^{*} \\right] - \\lambda a \\left[ u_{i}^{*} - u_{i-1}^{*} \\right] \\right\\} \\\\\n= \\frac{1}{2} \\left\\{ 2 u - \\lambda a \\left( u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right) - \\lambda a \\left[ u_{x} \\Delta - \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right] \\right. \\\\\n\\qquad \\left. - \\lambda^{2} a \\left[ \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] \\right\\} + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\n简化领阶项：\n$$\nu_{i}^{n+1} = u - \\lambda a \\, u_{x} \\Delta - \\frac{1}{6} \\lambda a \\, u_{xxx} \\Delta^{3} - \\frac{1}{2} \\lambda^{2} a \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\mathcal{O}(\\Delta^{3}, \\lambda^{2} \\Delta^{3}).\n$$\n由于 $\\lambda \\Delta = \\Delta t$，该格式生成的领阶时间增量为 $- a u_{x} \\Delta t$。然而，由守恒律得到的真实时间导数为 $u_{t} = - (a u)_{x} = - a u_{x} - a_{x} u$。因此，在 $\\Delta t$ 阶的局部截断误差中包含一个未平衡项 $+ a_{x} u \\, \\Delta t$。这是一个一阶项，表明当 $a_{x} \\neq 0$ 时，用朴素MacCormack格式离散化非守恒形式 $u_{t} + a(x) u_{x} = 0$ 会失去与守恒律的相容性，因此在存在系数梯度的情况下无法达到二阶精度。\n\n构建考虑系数的守恒型MacCormack格式及其组合更新式：\n\n为恢复二阶精度及与守恒律的相容性，我们使用单元中心通量 $f_{i}^{n} = a_{i} \\, u_{i}^{n}$ 在守恒形式下进行离散化。该预估-校正格式为\n$$\nu_{i}^{*} = u_{i}^{n} - \\lambda \\left( f_{i+1}^{n} - f_{i}^{n} \\right) = u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right),\n$$\n$$\nu_{i}^{n+1} = \\frac{1}{2} \\left[ u_{i}^{n} + u_{i}^{*} - \\lambda \\left( f_{i}^{*} - f_{i-1}^{*} \\right) \\right],\n$$\n其中 $f_{i}^{*} = a_{i} \\, u_{i}^{*}$（因为 $a$ 不依赖于时间）。消去预估变量，我们得到\n\\begin{align*}\nf_{i}^{*} = a_{i} u_{i}^{*} = a_{i} u_{i}^{n} - \\lambda a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right), \\\\\nf_{i-1}^{*} = a_{i-1} u_{i-1}^{*} = a_{i-1} u_{i-1}^{n} - \\lambda a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right).\n\\end{align*}\n将其代入校正步并与预估步结合，写出单步更新式。首先计算 $u_{i}^{n} + u_{i}^{*}$：\n$$\nu_{i}^{n} + u_{i}^{*} = 2 u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right).\n$$\n接着计算 $f_{i}^{*} - f_{i-1}^{*}$：\n\\begin{align*}\nf_{i}^{*} - f_{i-1}^{*} = \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) - \\lambda \\left[ a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) \\right].\n\\end{align*}\n因此，\n\\begin{align*}\nu_{i}^{n+1} = \\frac{1}{2} \\left\\{ 2 u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - \\lambda \\left[ \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) - \\lambda \\left( a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) \\right) \\right] \\right\\} \\\\\n= u_{i}^{n} - \\frac{\\lambda}{2} \\left( a_{i+1} u_{i+1}^{n} - a_{i-1} u_{i-1}^{n} \\right) + \\frac{\\lambda^{2}}{2} \\left[ a_{i} a_{i+1} u_{i+1}^{n} - \\left( a_{i}^{2} + a_{i-1} a_{i} \\right) u_{i}^{n} + a_{i-1}^{2} u_{i-1}^{n} \\right].\n\\end{align*}\n这个显式更新式仅使用 $i-1$、$i$ 和 $i+1$ 处的值以及局部系数 $a_{i-1}$、$a_{i}$、$a_{i+1}$，并且与守恒形式相容。进行与上文类似的泰勒分析，但这次是针对通量 $f = a u$ 进行，结果表明一阶时间增量为 $- \\Delta t (a u)_{x}$（正确），并且在光滑性条件下，领阶局部截断误差为 $\\mathcal{O}(\\Delta t^{2}, \\Delta x^{2})$ 阶，从而恢复了二阶精度。\n\n所要求的考虑系数的守恒型MacCormack组合更新式的最终表达式即为上面给出的 $u_{i}^{n+1}$ 的封闭形式解析更新式。", "answer": "$$\\boxed{u_{i}^{n+1} = u_{i}^{n} - \\frac{\\lambda}{2}\\left(a_{i+1} u_{i+1}^{n} - a_{i-1} u_{i-1}^{n}\\right) + \\frac{\\lambda^{2}}{2}\\left[a_{i} a_{i+1} u_{i+1}^{n} - \\left(a_{i}^{2} + a_{i-1} a_{i}\\right) u_{i}^{n} + a_{i-1}^{2} u_{i-1}^{n}\\right]}$$", "id": "3342575"}, {"introduction": "双曲守恒律的数值解法面临的终极挑战之一是正确地捕捉激波等间断。理论上的“守恒形式”在实践中究竟意味着什么？本编码练习将通过求解经典的伯格斯方程（Burgers' equation），直观地展示守恒与非守恒格式在计算结果上的巨大差异，从而深刻揭示为何只有守恒格式才能保证计算出物理上正确的激波速度。[@problem_id:3342598]", "problem": "考虑守恒形式的一维无粘性 Burgers 方程，由 $u_t + \\left(\\frac{u^2}{2}\\right)_x = 0$ 给出，其中 $u = u(x,t)$ 表示在具有空间坐标 $x$ 的周期性域上的标量速度场。该守恒律在弱解意义下理解，因此可能出现间断解，并遵循由守恒原理推导出的积分平衡。通量函数为 $f(u) = \\frac{u^2}{2}$。对于 $u_L  u_R$ 的黎曼型初值数据，该方程允许激波的存在，由 Rankine–Hugoniot 跳跃条件确定的激波速度为 $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$。\n\nMacCormack 预估-校正格式用于推进双曲型偏微分方程的求解。在守恒律形式下，MacCormack 方法通过使用通量的前向空间差分进行预估，并使用预估通量的后向差分进行校正来推进求解。一种非守恒变体则使用非守恒微分形式 $u_t + u\\,u_x = 0$ 来推进变量，将向前和向后差分应用于 $u$ 而非通量 $f(u)$。对于间断解，只有守恒格式能确保从积分守恒律推导出的正确激波运动，而非守恒格式不保证能以正确的速度传播激波。\n\n你的任务是构造一个反例，证明对于无粘性 Burgers 方程，与守恒 MacCormack 更新和 Rankine–Hugoniot 解析速度相比，非守恒 MacCormack 更新会产生不正确的激波位置。请按以下步骤进行：\n\n1. 使用长度为 $L = 2$ 的周期性域，等同于区间 $[-1,1)$。设 $N$ 为均匀分布的网格点数，因此 $\\Delta x = L/N$。在单元中心 $x_i = -L/2 + i\\,\\Delta x$（$i = 0,1,\\dots,N-1$）处表示数值。\n\n2. 在时间 $t=0$ 初始化黎曼数据，在 $x = x_0$ 处有一个单个间断，定义为\n   $$\n   u(x,0) = \n   \\begin{cases}\n   u_L,  x  x_0, \\\\\n   u_R,  x \\ge x_0,\n   \\end{cases}\n   $$\n   在区间 $[-1,1)$ 外进行周期性延拓。\n\n3. 实现两种显式 MacCormack 预估-校正格式，使用恒定的时间步长 $\\Delta t$，该步长满足基于最大特征速度的 Courant–Friedrichs–Lewy 条件。使用无量纲 Courant 数 $\\text{CFL}$ 并设置 $\\Delta t = \\text{CFL}\\,\\Delta x / \\max(|u_L|,|u_R|)$。\n   - 守恒 MacCormack：使用通量函数 $f(u) = \\frac{u^2}{2}$ 的向前和向后差分应用预估和校正步骤，确保离散化与守恒律一致。\n   - 非守恒 MacCormack：在非守恒形式 $u_t + u\\,u_x = 0$ 中，使用原始变量 $u$ 的向前和向后差分应用预估和校正步骤。\n\n4. 将每种格式推进 $n$ 步，其中 $n = \\lceil T/\\Delta t \\rceil$，得到最终时间 $t_{\\text{end}} = n\\,\\Delta t$。\n\n5. 对于每种格式，在 $t_{\\text{end}}$ 时刻估算数值激波位置，方法是找出解穿过相邻网格点之间中点值 $m = \\frac{u_L + u_R}{2}$ 的位置 $x$，使用单元中心之间的线性插值。如果由于周期性或数值振荡存在多个穿越点，选择其位置与解析激波位置的周期性距离最小的那个穿越点。如果没有检测到穿越点，则通过离散梯度的最大幅值位置来近似激波位置，然后使用局部插值进行细化。\n\n6. 使用 Rankine–Hugoniot 速度 $s = \\frac{u_L + u_R}{2}$ 计算解析激波位置，即 $x_{\\text{exact}}(t_{\\text{end}}) = x_0 + s\\,t_{\\text{end}}$，并将位置对域长度 $L$ 取模以保持在 $[-1,1)$ 区间内。\n\n7. 对于每个测试用例，分别报告在 $t_{\\text{end}}$ 时刻，守恒和非守恒 MacCormack 格式的数值激波位置与解析激波位置之间的绝对周期性距离。\n\n使用以下测试套件，其中包括清晰的激波传播、中等强度激波和静止激波：\n- 用例 1：$u_L = 2.0$，$u_R = 0.0$，$x_0 = 0.0$，$N = 1000$，$T = 0.3$，$\\text{CFL} = 0.4$。\n- 用例 2：$u_L = 1.5$，$u_R = 0.5$，$x_0 = -0.2$，$N = 1000$，$T = 0.5$，$\\text{CFL} = 0.4$。\n- 用例 3：$u_L = 1.0$，$u_R = -1.0$，$x_0 = 0.3$，$N = 1000$，$T = 0.4$，$\\text{CFL} = 0.4$。\n\n所有量均为无量纲；无需物理单位。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按每个用例的守恒误差、非守恒误差的顺序排列，即 $[e_{\\text{cons},1},e_{\\text{noncons},1},e_{\\text{cons},2},e_{\\text{noncons},2},e_{\\text{cons},3},e_{\\text{noncons},3}]$，其中每个 $e$ 是一个浮点数，表示对应格式和用例在最终时刻计算出的激波位置与解析激波位置之间的绝对周期性距离。", "solution": "该问题要求构造一个数值反例，以证明非守恒有限差分格式与守恒格式不同，它无法计算无粘性 Burgers 方程的正确激波速度。这将通过实现和比较 MacCormack 方法的两种变体来完成。\n\n一维无粘性 Burgers 方程的守恒律形式为\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\frac{u^2}{2} \\right) = 0\n$$\n其中 $u(x,t)$ 是速度，通量函数为 $f(u) = \\frac{u^2}{2}$。对于导数存在的光滑解，可以应用链式法则得到非守恒形式：\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = 0\n$$\n然而，像 Burgers 方程这样的双曲守恒律，即使从光滑的初始数据出发，也会发展出间断（激波）。对于间断解，微分形式不是良定义的，必须参考守恒律的积分形式。间断的动力学由 Rankine–Hugoniot 跳跃条件决定，该条件是这种积分形式的直接推论。对于一个以速度 $s$ 运动、分隔两个常数状态 $u_L$（左）和 $u_R$（右）的激波，该条件为：\n$$\ns = \\frac{f(u_L) - f(u_R)}{u_L - u_R}\n$$\n对于 Burgers 方程，这给出了解析激波速度：\n$$\ns = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{u_L + u_R}{2}\n$$\n数值格式必须以“守恒形式”构建，以确保其解收敛到满足此跳跃条件的弱解。非守恒格式不遵守积分平衡，通常会收敛到一个具有不正确激波速度的解。\n\n我们将使用 $N$ 个均匀分布的单元中心 $x_i = -L/2 + i \\Delta x$（$i = 0, \\dots, N-1$）来离散化长度为 $L=2$ 的空间域 $x \\in [-1, 1)$，其中 $\\Delta x = L/N$。时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定，$\\Delta t = \\text{CFL} \\Delta x / \\max(|u_L|, |u_R|)$，以确保数值稳定性。\n\n初始条件是在 $x=x_0$ 处有阶跃间断的黎曼问题：\n$$\nu(x,0) = \n\\begin{cases}\nu_L,  x  x_0, \\\\\nu_R,  x \\ge x_0,\n\\end{cases}\n$$\n我们将解推进到最终时间 $t_{\\text{end}} = n \\Delta t$，其中 $n = \\lceil T/\\Delta t \\rceil$。\n\n两种 MacCormack 格式实现如下。设 $u_i^n$ 为网格点 $i$ 和时间 $t^n = n \\Delta t$ 处的数值解。\n\n**1. 守恒 MacCormack 格式**\n该格式离散化守恒律 $u_t + f(u)_x=0$。\n*   预估步（对通量使用向前差分）：\n    $$\n    u_i^* = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( f(u_{i+1}^n) - f(u_i^n) \\right)\n    $$\n*   校正步（对预估通量使用向后差分）：\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + u_i^* - \\frac{\\Delta t}{\\Delta x} \\left( f(u_i^*) - f(u_{i-1}^*) \\right) \\right)\n    $$\n此处，索引进行周期性处理，例如 $u_{N} = u_0$ 和 $u_{-1} = u_{N-1}$。此格式是守恒形式，在网格细化的极限情况下，预计能计算出正确的激波速度。\n\n**2. 非守恒 MacCormack 格式**\n该格式离散化非守恒形式 $u_t + u u_x=0$。\n*   预估步（对 $u$ 使用向前差分）：\n    $$\n    u_i^* = u_i^n - u_i^n \\frac{\\Delta t}{\\Delta x} (u_{i+1}^n - u_i^n)\n    $$\n*   校正步（对预估的 $u$ 使用向后差分）：\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + u_i^* - u_i^* \\frac{\\Delta t}{\\Delta x} (u_i^* - u_{i-1}^*) \\right)\n    $$\n这种形式没有在单元界面上离散化通量差，因此不强制执行局部守恒性质。结果是，它不能保证捕捉到正确的激波动力学。\n\n在用两种格式将解演化到 $t_{\\text{end}}$ 后，我们确定数值激波位置。这是通过找到数值解剖面穿过中点值 $m = (u_L + u_R)/2$ 的位置来完成的。我们使用跨越穿越点的两个网格点之间的线性插值。如果由于数值振荡出现多个穿越点，我们使用域上的周期性距离，选择离解析激波位置 $x_{\\text{analytical}}(t_{\\text{end}}) = x_0 + s \\cdot t_{\\text{end}}$ 最近的那个。两点 $p_1$ 和 $p_2$ 在长度为 $L$ 的域上的绝对周期性距离由 $\\min(|p_1 - p_2|, L - |p_1 - p_2|)$ 给出。\n\n然后，每种格式的误差计算为在最终时间 $t_{\\text{end}}$ 其计算出的数值激波位置 $x_{\\text{numerical}}$ 与解析激波位置 $x_{\\text{analytical}}$ 之间的绝对周期性距离。三个测试用例的结果将表明，非守恒格式的误差远大于守恒格式的误差，从而证实前者计算出的激波速度不正确。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the 1D inviscid Burgers' equation using conservative and nonconservative\n    MacCormack schemes to demonstrate the importance of conservation form\n    for shock capturing.\n    \"\"\"\n    test_cases = [\n        # (u_L, u_R, x_0, N, T, CFL)\n        (2.0, 0.0, 0.0, 1000, 0.3, 0.4),\n        (1.5, 0.5, -0.2, 1000, 0.5, 0.4),\n        (1.0, -1.0, 0.3, 1000, 0.4, 0.4),\n    ]\n\n    results = []\n\n    for u_L, u_R, x_0, N, T, CFL in test_cases:\n        L = 2.0\n        dx = L / N\n        x = -L/2 + np.arange(N) * dx\n        \n        # CFL condition and time steps\n        max_speed = max(abs(u_L), abs(u_R))\n        if max_speed == 0:\n            # Avoid division by zero if max speed is zero, choose a reasonable dt\n            max_speed = 1.0\n        dt = CFL * dx / max_speed\n        num_steps = math.ceil(T / dt)\n        t_end = num_steps * dt\n\n        # Initial condition\n        u0 = np.full(N, u_R, dtype=np.float64)\n        u0[x  x_0] = u_L\n        \n        u_cons = u0.copy()\n        u_noncons = u0.copy()\n\n        # --- Time evolution ---\n        for _ in range(num_steps):\n            # Conservative MacCormack\n            f = 0.5 * u_cons**2\n            # Predictor\n            u_star_c = u_cons - (dt / dx) * (np.roll(f, -1) - f)\n            # Corrector\n            f_star = 0.5 * u_star_c**2\n            u_cons = 0.5 * (u_cons + u_star_c - (dt / dx) * (f_star - np.roll(f_star, 1)))\n\n            # Nonconservative MacCormack\n            # Predictor\n            u_star_nc = u_noncons - u_noncons * (dt / dx) * (np.roll(u_noncons, -1) - u_noncons)\n            # Corrector\n            u_noncons = 0.5 * (u_noncons + u_star_nc - u_star_nc * (dt / dx) * (u_star_nc - np.roll(u_star_nc, 1)))\n        \n        # --- Analysis ---\n        # Analytical shock location\n        s = (u_L + u_R) / 2.0\n        x_analytical = x_0 + s * t_end\n        # Map to periodic domain [-L/2, L/2)\n        x_analytical = -L/2 + (x_analytical - (-L/2)) % L\n\n        midpoint_val = (u_L + u_R) / 2.0\n        \n        def find_shock_location(u_final, x_grid, L_domain, analytical_pos, dx_grid):\n            \"\"\"\n            Finds the numerical shock location by looking for a crossing of the\n            midpoint value, refined by linear interpolation.\n            \"\"\"\n            crossings = []\n            # Find all crossings of midpoint_val\n            for i in range(N):\n                u_i = u_final[i]\n                u_i_plus_1 = u_final[(i + 1) % N]\n                if (u_i - midpoint_val) * (u_i_plus_1 - midpoint_val) = 0 and u_i != u_i_plus_1:\n                    x_i = x_grid[i]\n                    x_cross = x_i + dx_grid * (midpoint_val - u_i) / (u_i_plus_1 - u_i)\n                    crossings.append(x_cross)\n\n            if crossings:\n                # Find crossing closest to analytical solution\n                min_dist = float('inf')\n                best_pos = crossings[0]\n                for pos in crossings:\n                    dist = abs(pos - analytical_pos)\n                    periodic_dist = min(dist, L_domain - dist)\n                    if periodic_dist  min_dist:\n                        min_dist = periodic_dist\n                        best_pos = pos\n                return best_pos\n            else:\n                # Fallback: max gradient\n                grad = np.abs(np.roll(u_final, -1) - u_final)\n                max_grad_idx = np.argmax(grad)\n                \n                u_a = u_final[max_grad_idx]\n                u_b = u_final[(max_grad_idx + 1) % N]\n                x_a = x_grid[max_grad_idx]\n                \n                if abs(u_b - u_a)  1e-9: # Avoid division by zero\n                    return x_a + dx_grid / 2.0\n                else:\n                    x_pos = x_a + dx_grid * (midpoint_val - u_a) / (u_b - u_a)\n                    return x_pos\n\n        def periodic_map(pos, length):\n            \"\"\"Maps a position to the periodic interval [-length/2, length/2).\"\"\"\n            return -length/2 + (pos - (-length/2)) % length\n\n        x_num_cons = find_shock_location(u_cons, x, L, x_analytical, dx)\n        x_num_noncons = find_shock_location(u_noncons, x, L, x_analytical, dx)\n        \n        x_num_cons = periodic_map(x_num_cons, L)\n        x_num_noncons = periodic_map(x_num_noncons, L)\n        \n        def periodic_distance(p1, p2, length):\n            \"\"\"Calculates the absolute periodic distance between two points.\"\"\"\n            dist = abs(p1 - p2)\n            return min(dist, length - dist)\n\n        error_cons = periodic_distance(x_num_cons, x_analytical, L)\n        error_noncons = periodic_distance(x_num_noncons, x_analytical, L)\n\n        results.extend([error_cons, error_noncons])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3342598"}]}