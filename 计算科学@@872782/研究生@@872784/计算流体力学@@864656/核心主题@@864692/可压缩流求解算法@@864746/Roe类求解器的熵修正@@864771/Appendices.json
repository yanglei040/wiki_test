{"hands_on_practices": [{"introduction": "Roe类型的求解器在模拟气体动力学时功能强大，但它们在特定情况下（即跨音速稀疏波）可能会失效，产生违反热力学第二定律的非物理“膨胀激波”。在应用修正方法之前，我们必须首先学会如何诊断这个问题。这个练习 [@problem_id:3314404] 提供了一个具体的黎曼问题，让你通过分析跨接口的特征波速符号变化，来判断系统是否容易出现这种数值病态。", "problem": "考虑理想气体的一维可压缩欧拉方程，该方程组构成一个具有三个特征场的严格双曲系统。对于比热比为 $\\gamma$ 的理想气体，当地声速定义为 $a=\\sqrt{\\gamma p/\\rho}$，通量雅可比矩阵的特征值为 $u-a$、$u$ 和 $u+a$，分别对应于第 $1$-波、第 $2$-波和第 $3$-波。在计算流体动力学（CFD）中，Roe格式求解器使用Roe平均态在界面上线性化黎曼问题，这可能导致界面特征值在出现跨音速稀疏波（膨胀波）时违反熵条件。一种常见的熵修正方法通过检查跨界面的特征速度的符号变化来检测这种情况。\n\n给定一个理想气体（$\\gamma=1.4$）的黎曼问题，其左态为 $(\\rho_L,u_L,p_L)=(1,0.1,1)$，右态为 $(\\rho_R,u_R,p_R)=(0.125,0.9,0.1)$。从欧拉特征结构和Roe平均的定义出发，判断第 $1$-波或第 $3$-波是否是跨音速的（即其对应的特征速度在界面两侧变号），并推断对于这些数据，Roe通量是否容易产生非熵膨胀激波。\n\n最终答案请使用以下约定：\n- 将第 $1$-波和第 $3$-波的跨音速状态编码为指示符 $I_1$ 和 $I_3$。如果第 $k$-波是跨音速的，则 $I_k=1$，否则 $I_k=0$。\n- 将Roe通量对膨胀激波的敏感性编码为 $E$。如果Roe通量对于此界面容易产生非熵膨胀激波，则 $E=1$，否则 $E=0$。\n- 将最终答案表示为单行矩阵 $\\begin{pmatrix}I_1  I_3  E\\end{pmatrix}$。\n\n无需四舍五入，指示符是无量纲的。", "solution": "用户要求我解决一个计算流体动力学（CFD）问题。该问题要求在使用Roe格式求解器时，判断一个特定的黎曼问题是否需要熵修正。这涉及到检查跨音速稀疏波。\n\n### 步骤1：提取已知条件\n- 方程组：理想气体的一维可压缩欧拉方程。\n- 左态：$(\\rho_L, u_L, p_L) = (1, 0.1, 1)$。\n- 右态：$(\\rho_R, u_R, p_R) = (0.125, 0.9, 0.1)$。\n- 比热比：$\\gamma = 1.4$。\n- 声速定义：$a = \\sqrt{\\gamma p / \\rho}$。\n- 通量雅可比矩阵的特征值（特征速度）：$\\lambda_1 = u - a$，$\\lambda_2 = u$，$\\lambda_3 = u + a$。\n- 跨音速波的定义：如果一个波对应的特征速度在界面两侧变号，则该波是跨音速的。\n- 输出指示符：\n    - $I_1$：如果第 $1$-波是跨音速的，则为 $1$，否则为 $0$。\n    - $I_3$：如果第 $3$-波是跨音速的，则为 $1$，否则为 $0$。\n    - $E$：如果Roe通量容易产生非熵膨胀激波，则为 $1$，否则为 $0$。\n- 最终答案格式：单行矩阵 $\\begin{pmatrix} I_1  I_3  E \\end{pmatrix}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是计算流体动力学领域关于双曲守恒律数值格式性质的标准分析。问题提法清晰，为获得唯一解提供了所有必要的数据和定义。数据在物理上是一致的，术语精确客观。不存在矛盾、歧义或违反科学原理的情况。该问题是有效的。\n\n### 步骤3：求解\n问题要求我们判断给定的黎曼问题中，第 $1$-波或第 $3$-波是否是跨音速的。根据问题陈述，如果一个波的特征速度在左右两态的界面两侧变号，则该波是跨音速的。对非熵膨胀激波的敏感性与这种跨音速波的存在直接相关。\n\n与第 $1$-波和第 $3$-波相关的特征速度分别由特征值 $\\lambda_1 = u - a$ 和 $\\lambda_3 = u + a$ 给出。声速 $a$ 定义为 $a = \\sqrt{\\gamma p / \\rho}$。我们必须计算左态 $(\\mathbf{U}_L)$ 和右态 $(\\mathbf{U}_R)$ 的这些特征值。\n\n首先，我们计算左态的声速 $a_L$：\n$$a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}}$$\n代入给定值 $\\gamma = 1.4$、$p_L = 1$ 和 $\\rho_L = 1$：\n$$a_L = \\sqrt{\\frac{1.4 \\times 1}{1}} = \\sqrt{1.4}$$\n现在，我们计算左态的特征速度：\n$$ \\lambda_{1,L} = u_L - a_L = 0.1 - \\sqrt{1.4} $$\n为了确定 $\\lambda_{1,L}$ 的符号，我们比较 $0.1$ 和 $\\sqrt{1.4}$。因为 $0.1^2 = 0.01$ 且 $(\\sqrt{1.4})^2 = 1.4$，所以有 $0.01  1.4$，这意味着 $0.1  \\sqrt{1.4}$。因此，$\\lambda_{1,L}$ 是负数。\n$$ \\lambda_{3,L} = u_L + a_L = 0.1 + \\sqrt{1.4} $$\n由于两项都是正数，$\\lambda_{3,L}$ 是正数。\n\n接下来，我们计算右态的声速 $a_R$：\n$$a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}}$$\n代入给定值 $\\gamma = 1.4$、$p_R = 0.1$ 和 $\\rho_R = 0.125$：\n$$a_R = \\sqrt{\\frac{1.4 \\times 0.1}{0.125}} = \\sqrt{\\frac{0.14}{0.125}} = \\sqrt{1.12}$$\n现在，我们计算右态的特征速度：\n$$ \\lambda_{1,R} = u_R - a_R = 0.9 - \\sqrt{1.12} $$\n为了确定 $\\lambda_{1,R}$ 的符号，我们比较 $0.9$ 和 $\\sqrt{1.12}$。因为 $0.9^2 = 0.81$ 且 $(\\sqrt{1.12})^2 = 1.12$，所以有 $0.81  1.12$，这意味着 $0.9  \\sqrt{1.12}$。因此，$\\lambda_{1,R}$ 是负数。\n$$ \\lambda_{3,R} = u_R + a_R = 0.9 + \\sqrt{1.12} $$\n由于两项都是正数，$\\lambda_{3,R}$ 是正数。\n\n现在我们可以确定每个波的跨音速状态。如果一个波的特征速度在界面两侧变号，即在数学上意味着 $\\lambda_k(\\mathbf{U}_L) \\cdot \\lambda_k(\\mathbf{U}_R)  0$，则该波是跨音速的。\n\n对于第 $1$-波：\n我们发现 $\\lambda_{1,L}  0$ 且 $\\lambda_{1,R}  0$。由于两者均为负，因此没有符号变化。乘积 $\\lambda_{1,L} \\lambda_{1,R}$ 是正数。\n因此，第 $1$-波不是跨音速的，指示符 $I_1$ 为 $0$。\n$$I_1 = 0$$\n\n对于第 $3$-波：\n我们发现 $\\lambda_{3,L} > 0$ 且 $\\lambda_{3,R} > 0$。由于两者均为正，因此没有符号变化。乘积 $\\lambda_{3,L} \\lambda_{3,R}$ 是正数。\n因此，第 $3$-波不是跨音速的，指示符 $I_3$ 为 $0$。\n$$I_3 = 0$$\n\n最后，我们确定对膨胀激波的敏感性 $E$。问题陈述中提到，在存在跨音速稀疏波（通过特征速度的符号变化来检测）的情况下，Roe通量容易产生非熵膨胀激波。由于我们发现第 $1$-波和第 $3$-波都不是跨音速的（$I_1 = 0$ 且 $I_3 = 0$），导致这种数值伪影的条件对于给定的黎曼问题不成立。因此，Roe通量*因此原因*不容易产生膨胀激波。\n因此，指示符 $E$ 为 $0$。\n$$E = 0$$\n\n最终答案要求为行矩阵 $\\begin{pmatrix} I_1  I_3  E \\end{pmatrix}$。代入我们求得的值：\n$$ \\begin{pmatrix} 0  0  0 \\end{pmatrix} $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0\n\\end{pmatrix}\n}\n$$", "id": "3314404"}, {"introduction": "理解复杂物理系统数值修正的有效策略，是从一个简化的模型方程入手。本练习 [@problem_id:3314395] 采用无粘伯格斯方程（Burgers' equation）作为研究对象，它捕捉了欧拉方程中非线性波传播和激波形成的核心特征。你将从第一性原理出发，为经典的Harten–Hyman熵修正推导出一个阈值下界，从而深刻理解其如何通过在声速点附近引入适量的数值耗散来防止熵违背，并将这一思想推广到更复杂的欧拉方程组。", "problem": "考虑由无粘性 Burgers 方程 $u_t + f(u)_x = 0$ 给出的标量守恒律，其通量为凸函数 $f(u) = \\tfrac{1}{2} u^2$。对于界面左右状态分别为 $u_L$ 和 $u_R$ 的两点数值通量，一种 Roe 型近似 Riemann 求解器使用线性化波速 $a = \\tfrac{f(u_R) - f(u_L)}{u_R - u_L}$（当 $u_L \\ne u_R$ 时）。对于 Burgers 方程，该波速简化为 $a = \\tfrac{1}{2} (u_L + u_R)$。Roe 通量的形式为\n$$\nF_{\\mathrm{Roe}}(u_L,u_R) \\;=\\; \\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) \\;-\\; \\tfrac{1}{2}\\,|a|\\,(u_R-u_L).\n$$\n众所周知，在 $u_L  0  u_R$ 的跨音速稀疏波情形下，Roe 通量可能会产生违反熵条件的非物理定常间断（即跨音速异常）。一种标准的修正是应用熵修正，以增加声速点附近的耗散。考虑 Harten–Hyman 熵修正，它用一个修改后的量值 $|a|_{\\delta}$ 替代 $|a|$，该量值由一个阈值参数 $\\delta > 0$ 定义：\n$$\n|a|_{\\delta} = \\begin{cases}\n|a|,  \\text{若 } |a| \\ge \\delta \\\\\n\\tfrac{1}{2}\\left(\\dfrac{a^2}{\\delta} + \\delta\\right),  \\text{若 } |a|  \\delta\n\\end{cases}\n$$\nBurgers 方程的 Godunov 通量是精确的 Riemann 通量。对于凸通量和 $u_L \\le u_R$ 的稀疏波，其形式如下：\n- 若 $u_L \\ge 0$，则 $F_{\\mathrm{God}} = f(u_L)$。\n- 若 $u_R \\le 0$，则 $F_{\\mathrm{God}} = f(u_R)$。\n- 若 $u_L  0  u_R$，则 $F_{\\mathrm{God}} = f(0) = 0$。\n\n您的任务是：\n1. 从上述定义出发，且不引用任何未说明的公式，推导熵修正阈值 $\\delta$ 的一个下界，使得在跨音速情况 $u_L  0  u_R$ 下，Harten–Hyman 修正 Roe 通量 $F_{\\mathrm{Roe,HH}} = \\tfrac{1}{2}(f(u_L)+f(u_R)) - \\tfrac{1}{2}|a|_{\\delta}(u_R-u_L)$ 对 Burgers 方程满足 $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$。将此下界解释为界面处的最小熵增需求，并用 $u_L$ 和 $u_R$ 明确表示。您的推导必须从守恒律、通量 $f$ 的凸性、Roe 线性化以及 Harten–Hyman 熵修正的定义开始。使用二次数学熵 $U(u) = \\tfrac{1}{2}u^2$ 进行解释，并明确您为防止违反熵条件的定常膨胀激波而施加的任何不等式。\n2. 通过考虑沿单一特征场（其特征值 $\\lambda$ 跨越零点）的行为，将您得到的标量界映射到关于局部状态线性化的一维可压缩 Euler 方程组。解释如何通过将 $u$ 替换为特征速度并相应地解释跳跃，从而将标量结果应用于 Euler 方程 Roe 型求解器中的每个特征波。无需计算 Euler 方程的具体数值，但映射逻辑必须清晰且与线性化一致。\n3. 对 Burgers 方程，通过为每个给定的测试算例计算您推导出的公式所蕴含的最小阈值 $\\delta_{\\min}$，来数值验证该标量界。然后数值验证在该阈值下，相应的 Harten–Hyman 修正 Roe 通量满足 $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$，允许在边界上取等号。您的程序必须只计算并报告 $\\delta_{\\min}$ 的值。\n\n测试套件：\n- 算例 A（对称跨音速）：$(u_L,u_R) = (-1.0,\\,1.0)$。\n- 算例 B（非对称跨音速）：$(u_L,u_R) = (-0.2,\\,1.3)$。\n- 算例 C（左侧近声速，右侧强波）：$(u_L,u_R) = (-10^{-6},\\,2.0)$。\n- 算例 D（非跨音速稀疏波，均为正值）：$(u_L,u_R) = (1.0,\\,2.0)$。\n- 算例 E（非对称跨音速，左侧更强）：$(u_L,u_R) = (-2.0,\\,0.5)$。\n\n所有量均为无量纲；无需物理单位。不涉及角度。每个测试算例产生一个实数 $\\delta_{\\min}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含算例 A–E 的 $\\delta_{\\min}$ 值，按顺序排列，以逗号分隔，并用方括号括起来，每个值四舍五入到十位小数（例如，$[0.1234567890,0.0000000000,\\dots]$）。", "solution": "该问题要求为无粘性 Burgers 方程的 Roe 型数值格式推导熵修正阈值，将其概念性地推广到 Euler 方程组，并对推导出的界进行数值验证。对问题陈述的验证确认了其科学上的合理性、问题的良定性，并包含了继续研究所需的所有必要信息。\n\n### 第 1 部分：熵修正阈值的推导\n\n我们给定的是无粘性 Burgers 方程，一个形式为 $u_t + f(u)_x = 0$ 的标量守恒律，其通量函数为凸函数 $f(u) = \\tfrac{1}{2}u^2$。分析的重点是在左状态 $u_L$ 和右状态 $u_R$ 之间的界面上使用 Roe 型近似 Riemann 求解器。\n\n对于 Burgers 方程，Roe 线性化波速为 $a = \\tfrac{1}{2}(u_L + u_R)$。标准的 Roe 通量为 $F_{\\mathrm{Roe}}(u_L, u_R) = \\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) - \\tfrac{1}{2}|a|(u_R-u_L)$。\n\n在 $u_L  0  u_R$ 的跨音速稀疏波情况下，可能会出现非物理的、违反熵条件的定常间断。在这种情况下，精确的物理解是一个中心稀疏扇，其 Godunov 通量（精确 Riemann 通量）为 $F_{\\mathrm{God}} = f(0) = 0$。\n\n为防止违反熵条件，数值通量必须满足熵条件。对于定常波，这意味着通量不应选择一个允许信息从间断两侧传播开来的状态，而这正是膨胀激波发生的情况。保证正确弱解的条件是数值通量必须小于或等于声速点处的通量，对于 Burgers 方程即为 $f(0)$。因此，数值通量必须满足 $F \\le f(0)=0$。\n\n我们的任务是找到 Harten-Hyman 熵修正的阈值 $\\delta > 0$ 的一个下界，使得修正后的 Roe 通量 $F_{\\mathrm{Roe,HH}}$ 满足此条件。修正后的通量为：\n$$F_{\\mathrm{Roe,HH}} = \\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) - \\tfrac{1}{2}|a|_{\\delta}(u_R-u_L)$$\n其中 $|a|_{\\delta}$ 由下式给出：\n$$|a|_{\\delta} = \\begin{cases}\n|a|,  \\text{若 } |a| \\ge \\delta \\\\\n\\tfrac{1}{2}\\left(\\dfrac{a^2}{\\delta} + \\delta\\right),  \\text{若 } |a|  \\delta\n\\end{cases}$$\n需要施加的熵条件是 $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$。对于跨音速情况 $u_L  0  u_R$，这变为 $F_{\\mathrm{Roe,HH}} \\le 0$：\n$$\\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) - \\tfrac{1}{2}|a|_{\\delta}(u_R-u_L) \\le 0$$\n由于稀疏波情况下 $u_R - u_L > 0$，我们可以重排不等式以求解 $|a|_{\\delta}$：\n$$|a|_{\\delta}(u_R-u_L) \\ge f(u_L)+f(u_R)$$\n$$|a|_{\\delta} \\ge \\frac{f(u_L)+f(u_R)}{u_R-u_L}$$\n代入 $f(u) = \\tfrac{1}{2}u^2$：\n$$|a|_{\\delta} \\ge \\frac{\\tfrac{1}{2}u_L^2 + \\tfrac{1}{2}u_R^2}{u_R-u_L} = \\frac{u_L^2 + u_R^2}{2(u_R-u_L)}$$\n我们记右侧为 $K = \\frac{u_L^2 + u_R^2}{2(u_R-u_L)}$。熵修正是为 $|a|$ 很小（即 $|a|  \\delta$）时设计的。假设此条件成立，我们代入 $|a|_{\\delta}$ 定义的第二种情况：\n$$\\tfrac{1}{2}\\left(\\dfrac{a^2}{\\delta} + \\delta\\right) \\ge K$$\n由于 $\\delta > 0$，我们可以两边乘以 $2\\delta$ 而不改变不等号方向：\n$$a^2 + \\delta^2 \\ge 2K\\delta$$\n$$\\delta^2 - 2K\\delta + a^2 \\ge 0$$\n这是一个关于 $\\delta$ 的二次不等式。对应方程 $\\delta^2 - 2K\\delta + a^2 = 0$ 的根为 $\\delta = K \\pm \\sqrt{K^2 - a^2}$。不等式在根之外的区间成立。我们计算平方根下的项：\n$$K^2 - a^2 = \\left(\\frac{u_L^2 + u_R^2}{2(u_R-u_L)}\\right)^2 - \\left(\\frac{u_L+u_R}{2}\\right)^2 = \\frac{(u_L^2+u_R^2)^2 - (u_L+u_R)^2(u_R-u_L)^2}{4(u_R-u_L)^2}$$\n分子可简化为 $(u_L^2+u_R^2)^2 - (u_R^2-u_L^2)^2 = 4u_L^2 u_R^2$。因此，\n$$K^2 - a^2 = \\frac{4u_L^2 u_R^2}{4(u_R-u_L)^2} = \\left(\\frac{u_L u_R}{u_R-u_L}\\right)^2$$\n由于我们处于跨音速情况 $u_L  0  u_R$，有 $u_L u_R  0$，所以 $\\sqrt{K^2 - a^2} = \\frac{-u_L u_R}{u_R-u_L}$。两个根为：\n$$\\delta_1 = K - \\frac{-u_L u_R}{u_R-u_L} = \\frac{u_L^2+u_R^2+2u_Lu_R}{2(u_R-u_L)} = \\frac{(u_L+u_R)^2}{2(u_R-u_L)}$$\n$$\\delta_2 = K + \\frac{-u_L u_R}{u_R-u_L} = \\frac{u_L^2+u_R^2-2u_Lu_R}{2(u_R-u_L)} = \\frac{(u_R-u_L)^2}{2(u_R-u_L)} = \\frac{u_R-u_L}{2}$$\n不等式 $\\delta^2 - 2K\\delta + a^2 \\ge 0$ 在 $\\delta \\ge \\delta_2$ 或 $\\delta \\le \\delta_1$ 时成立。我们必须检查哪个解与我们的假设 $|a|  \\delta$ 一致。\n\n我们来检查 $\\delta \\ge \\delta_2$ 的一致性。我们需要确保选择 $\\delta = \\delta_2$ 与 $|a|  \\delta$ 兼容。\n条件是 $|a|  \\delta_2$，即 $|\\tfrac{1}{2}(u_L+u_R)|  \\tfrac{1}{2}(u_R-u_L)$，或 $|u_L+u_R|  u_R-u_L$。两边平方得到 $(u_L+u_R)^2  (u_R-u_L)^2$，简化为 $4u_Lu_R  0$，即 $u_Lu_R  0$。根据跨音速情况的定义，这是成立的。因此，选择 $\\delta \\ge \\delta_2$ 是一致的。\n\n条件 $\\delta \\le \\delta_1$ 不是 $\\delta$ 下界的有效选择。我们寻求保证熵条件的最小 $\\delta$，这对应于满足 $\\delta \\ge \\delta_2$ 的最小值。\n\n因此，最小阈值为 $\\delta_{\\min} = \\delta_2 = \\frac{u_R-u_L}{2}$。\n\n这个下界代表了最小熵增需求。修正 Roe 通量中的耗散项是 $\\tfrac{1}{2}|a|_{\\delta}(u_R-u_L)$。施加条件 $F_{\\mathrm{Roe,HH}} \\le 0$ 要求此耗散项足够大，以压制反耗散项 $\\tfrac{1}{2}(f(u_L)+f(u_R))$。通过设置 $\\delta \\ge \\delta_{\\min}$，我们确保在声速点引入足够的数值耗散（即熵增），以防止形成非物理的定常膨胀激波，并选择物理上正确的稀疏波。对于正确的弱解，数学熵 $U(u)=\\tfrac{1}{2}u^2$ 必须满足一个熵不等式；我们施加的 $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$ 是一个在离散层面上针对此特定异常满足该不等式的充分条件。\n\n### 第 2 部分：映射到一维可压缩 Euler 方程组\n\n一维可压缩 Euler 方程组构成一个守恒律方程组 $\\mathbf{U}_t + \\mathbf{F}(\\mathbf{U})_x = 0$。该系统的 Roe 求解器通过将守恒变量的跳跃 $\\Delta\\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$ 投影到 Roe 平均雅可比矩阵 $\\tilde{A}$ 的特征向量上，从而将问题对角化。通量由下式给出：\n$$F_{\\mathrm{Roe}} = \\tfrac{1}{2}(\\mathbf{F}_L + \\mathbf{F}_R) - \\tfrac{1}{2} \\sum_{k=1}^3 |\\tilde{\\lambda}_k| \\alpha_k \\tilde{\\mathbf{r}}_k$$\n这里，$\\tilde{\\lambda}_k$ 是 $\\tilde{A}$ 的特征值（波速），$\\tilde{\\mathbf{r}}_k$ 是右特征向量，$\\alpha_k$ 是波强度。此公式将系统视为三个标量平流问题的叠加，每个特征场一个。\n\n对于任何特征场 $k$，如果其对应的特征值跨越界面时穿过零点，而波本身是一个稀疏波，就可能发生违反熵条件的膨胀激波。对于给定的场 $k$，设其特征速度为 $\\lambda_k$。跨音速稀疏波的条件是 $\\lambda_{k,L}  0  \\lambda_{k,R}$，其中 $\\lambda_{k,L}$ 和 $\\lambda_{k,R}$ 分别是雅可比矩阵在左右状态下求出的特征值。\n\n第 1 部分的标量分析可以独立应用于每个特征场。映射如下：\n- 标量速度 $u$ 类似于特征速度 $\\lambda_k$。\n- Roe 平均速度 $a$ 类似于 Roe 平均特征值 $\\tilde{\\lambda}_k$。\n- 状态 $u_L$ 和 $u_R$ 映射到左右状态的特征速度 $\\lambda_{k,L}$ 和 $\\lambda_{k,R}$。\n\n标量界 $\\delta_{\\min} = \\frac{u_R-u_L}{2}$ 是基于跨界面的波传播速度跳跃。将此逻辑应用于 Euler 方程组的第 $k$ 个特征场，跳跃为 $\\lambda_{k,R}-\\lambda_{k,L}$。因此，第 $k$ 个场的最小熵修正阈值 $\\delta_{k,\\min}$ 为：\n$$\\delta_{k,\\min} = C(\\lambda_{k,R} - \\lambda_{k,L})$$\n其中 $C$ 是一个常数，我们的标量推导表明 $C = \\tfrac{1}{2}$。在实践中，不同的研究者可能会使用略有不同的公式，但原理是阈值应与跨界面的特征速度差成比例。然后，Harten-Hyman 修正使用各自基于 $\\lambda_{k,L}$ 和 $\\lambda_{k,R}$ 构建的阈值 $\\delta_k$ 单独应用于每个 $|\\tilde{\\lambda}_k|$。\n\n### 第 3 部分：数值验证\n\n为修正 Burgers 方程中的跨音速异常而推导出的最小阈值公式为 $\\delta_{\\min} = \\tfrac{1}{2}(u_R-u_L)$。此公式是在流动为跨音速稀疏波（即 $u_L  0  u_R$）的条件下推导的。\n\n对于给定的测试算例，如果条件满足，我们就应用此公式。\n- **跨音速算例（A, B, C, E）：** 对于这些算例，$u_L  0  u_R$。推导的公式直接适用。\n- **非跨音速算例（D）：** 对于算例 D，$(u_L, u_R) = (1.0, 2.0)$，我们有 $0 \\le u_L  u_R$。这是一个稀疏波，但它是完全超音速的。对于这种情况，标准的 Roe 通量已知是精确且满足熵条件的（$F_{\\mathrm{Roe}} = F_{\\mathrm{God}} = f(u_L)$）。由于没有熵违反需要修正，因此无需修改通量。所以，*最小*所需阈值 $\\delta_{\\min}$ 为 0。任何选择 $\\delta \\in [0, |a|]$ 都会得到未经修改的正确 Roe 通量。该集合的最小值为 0。\n\n对每个 $(u_L, u_R)$ 对的计算过程如下：\n1. 如果 $u_L  0$ 且 $u_R > 0$，计算 $\\delta_{\\min} = \\frac{u_R - u_L}{2}$。\n2. 否则，设置 $\\delta_{\\min} = 0$。\n\n将此逻辑应用于测试套件：\n- **算例 A：** $(u_L, u_R) = (-1.0, 1.0)$。跨音速。$\\delta_{\\min} = \\frac{1.0 - (-1.0)}{2} = 1.0$。\n- **算例 B：** $(u_L, u_R) = (-0.2, 1.3)$。跨音速。$\\delta_{\\min} = \\frac{1.3 - (-0.2)}{2} = 0.75$。\n- **算例 C：** $(u_L, u_R) = (-10^{-6}, 2.0)$。跨音速。$\\delta_{\\min} = \\frac{2.0 - (-10^{-6})}{2} = 1.0000005$。\n- **算例 D：** $(u_L, u_R) = (1.0, 2.0)$。非跨音速。$\\delta_{\\min} = 0.0$。\n- **算例 E：** $(u_L, u_R) = (-2.0, 0.5)$。跨音速。$\\delta_{\\min} = \\frac{0.5 - (-2.0)}{2} = 1.25$。\n\n以下代码计算这些值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimum Harten-Hyman entropy-fix threshold delta_min\n    for several test cases of the Burgers' equation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (u_L, u_R).\n    test_cases = [\n        (-1.0, 1.0),          # Case A\n        (-0.2, 1.3),          # Case B\n        (-1e-6, 2.0),         # Case C\n        (1.0, 2.0),           # Case D\n        (-2.0, 0.5),          # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        u_L, u_R = case\n\n        # The derived lower bound for the threshold delta is applicable only\n        # in the transonic rarefaction case (u_L  0  u_R), where the\n        # standard Roe solver may fail. The formula derived is\n        # delta_min = (u_R - u_L) / 2.\n        if u_L  0 and u_R > 0:\n            delta_min = (u_R - u_L) / 2.0\n        else:\n            # For other rarefaction cases (like u_L, u_R > 0 or u_L, u_R  0)\n            # or shock cases (u_L > u_R), the standard Roe solver does not\n            # exhibit this particular entropy failure. Therefore, no correction\n            # is needed, and the minimum required threshold is 0.\n            delta_min = 0.0\n            \n        results.append(delta_min)\n\n    # Format the results as a comma-separated list of strings,\n    # with each value rounded to 10 decimal places, enclosed in brackets.\n    formatted_results = [f\"{res:.10f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3314395"}, {"introduction": "在诊断了问题并从简化模型中掌握了修正原理之后，最后一步是将其综合应用到一个完整的求解器中。这个练习 [@problem_id:3314345] 是一个综合性的编程任务，要求你为可压缩欧拉方程实现一个带熵修正的Roe近似黎曼求解器。通过这个实践，你将把前面学到的关于Roe平均、特征结构分解以及Harten–Hyman熵修正的判定逻辑融会贯通，构建出一个能够准确模拟各种流动现象的数值工具。", "problem": "您需要从第一性原理出发，为带有理想气体闭合的气体动力学可压缩欧拉方程，设计并实现一维 Roe 近似黎曼求解器，该求解器需包含逐个特征值的 Harten–Hyman 熵修正。从一维欧拉方程的守恒形式开始，推导以单元为中心的有限体积格式所需的单元交界面数值通量。然后，为 Roe 线性化定义并计算在 Roe 平均状态下的特征结构，并使用左、右物理特征值检测跨音速稀疏波，对每个特征值应用 Harten–Hyman 熵修正。您的实现必须显式构造右特征向量矩阵 $R$，数值计算其逆矩阵 $R^{-1}$，并利用每个界面上修正后的谱半径 $\\phi_{\\delta}(\\lambda)$ 来构建耗散通量。最终程序必须为一个给定的左/右状态测试套件计算所要求的标量输出。\n\n使用的基本原理和定义：\n- 一维欧拉方程的守恒形式为\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\n其中守恒状态为 $\\boldsymbol{U} = [\\rho,\\ \\rho u,\\ E]^{\\top}$，通量为\n$$\n\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}.\n$$\n- 理想气体闭合，比热比为 $\\gamma$：\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2} \\rho u^2\\right), \\quad a = \\sqrt{\\gamma \\frac{p}{\\rho}},\n$$\n其中 $a$ 为声速，总焓 $H$ 为\n$$\nH = \\frac{E + p}{\\rho}.\n$$\n- 对于左、右原始状态 $(\\rho_L,u_L,p_L)$ 和 $(\\rho_R,u_R,p_R)$ 的 Roe 平均定义如下。令 $\\tilde{\\rho} = \\sqrt{\\rho_L}\\sqrt{\\rho_R}$ 且 $w_L = \\sqrt{\\rho_L}$，$w_R = \\sqrt{\\rho_R}$。则\n$$\n\\tilde{u} = \\frac{w_L u_L + w_R u_R}{w_L + w_R}, \\quad H_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}, \\quad \\tilde{H} = \\frac{w_L H_L + w_R H_R}{w_L + w_R},\n$$\nRoe 平均声速为\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}.\n$$\n- 在 Roe 状态 $(\\tilde{u}, \\tilde{a}, \\tilde{H})$ 下的 Roe 特征结构：\n  - 特征值 (特征速度)\n  $$\n  \\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{a}, \\quad \\tilde{\\lambda}_2 = \\tilde{u}, \\quad \\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{a}.\n  $$\n  - 右特征向量矩阵 $R$，其列对应于这些波：\n  $$\n  R = \\begin{bmatrix}\n  1  1  1 \\\\\n  \\tilde{u} - \\tilde{a}  \\tilde{u}  \\tilde{u} + \\tilde{a} \\\\\n  \\tilde{H} - \\tilde{u}\\tilde{a}  \\tfrac{1}{2}\\tilde{u}^2  \\tilde{H} + \\tilde{u}\\tilde{a}\n  \\end{bmatrix},\n  $$\n  $R^{-1}$ 是 $R$ 的逆矩阵。\n- 逐个特征值的 Harten–Hyman 熵修正通过将 $|\\tilde{\\lambda}_k|$ 替换为函数 $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$ 来修正谱半径：\n  $$\n  \\phi_{\\delta}(\\lambda) = \n  \\begin{cases}\n  \\tfrac{1}{2}\\left(\\dfrac{\\lambda^2}{\\delta} + \\delta\\right),  \\text{若 } |\\lambda|  \\delta \\\\\n  |\\lambda|,  \\text{若 } |\\lambda| \\ge \\delta\n  \\end{cases}\n  $$\n  其中跨音速检测和每个波的阈值 $\\delta_k$ 由左、右物理特征值得出\n  $$\n  \\lambda_{k,L} = u_L + s_k a_L, \\quad \\lambda_{k,R} = u_R + s_k a_R, \\quad s_1 = -1,\\ s_2 = 0,\\ s_3 = +1,\n  $$\n  通过\n  $$\n  \\delta_k = \n  \\begin{cases}\n  \\lambda_{k,R} - \\lambda_{k,L},  \\text{若 } \\lambda_{k,L}  0 \\text{ 且 } \\lambda_{k,R} > 0 \\\\\n  0,  \\text{其他情况}\n  \\end{cases}\n  $$\n- 带有熵修正的界面上的 Roe 数值通量为\n  $$\n  \\widehat{\\boldsymbol{F}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2} \\left[\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right] - \\tfrac{1}{2} \\, R \\, \\left|\\Lambda\\right|_{\\phi} \\, R^{-1} \\, \\left(\\boldsymbol{U}_R - \\boldsymbol{U}_L\\right),\n  $$\n  其中 $\\left|\\Lambda\\right|_{\\phi} = \\mathrm{diag}\\left(\\phi_{\\delta_1}(\\tilde{\\lambda}_1), \\phi_{\\delta_2}(\\tilde{\\lambda}_2), \\phi_{\\delta_3}(\\tilde{\\lambda}_3)\\right)$。\n\n任务：\n- 实现一个程序，对下面指定的每个测试用例，计算：\n  1. 三个经过熵修正的谱半径 $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$，对于 $k = 1,2,3$，按 $(\\tilde{\\lambda}_1,\\tilde{\\lambda}_2,\\tilde{\\lambda}_3)$ 的顺序排列。\n  2. Roe 数值通量 $\\widehat{\\boldsymbol{F}}$ 的第二个分量（动量分量）。\n- 所有变量都是无量纲的，因此不需要物理单位。所有角度均不相关。不涉及百分比。\n- 对于数值报告，将每个浮点结果四舍五入到 $8$ 位小数。\n\n测试套件：\n对于每个用例，输入为 $(\\rho_L,u_L,p_L)$ 和 $(\\rho_R,u_R,p_R)$，且 $\\gamma = 1.4$。\n- 用例 A (光滑接触间断，无跨音速穿越)：$(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$，$(\\rho_R,u_R,p_R) = (2.0, 0.0, 1.0)$。\n- 用例 B (左行声波中的跨音速稀疏波)：$(\\rho_L,u_L,p_L) = (1.0, -0.2, 0.4)$，$(\\rho_R,u_R,p_R) = (0.5, 1.8, 0.4)$。\n- 用例 C (强激波状跳跃，无跨音速穿越)：$(\\rho_L,u_L,p_L) = (1.0, 3.0, 1.0)$，$(\\rho_R,u_R,p_R) = (3.0, 0.0, 4.0)$。\n- 用例 D (接触波的近零点穿越)：$(\\rho_L,u_L,p_L) = (1.0, -10^{-6}, 1.0)$，$(\\rho_R,u_R,p_R) = (1.0, 10^{-6}, 1.0)$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表的每个元素本身是对应于一个测试用例的四个浮点数的列表：\n  - 三个值 $\\left[\\phi_{\\delta_1}(\\tilde{\\lambda}_1), \\phi_{\\delta_2}(\\tilde{\\lambda}_2), \\phi_{\\delta_3}(\\tilde{\\lambda}_3)\\right]$，后跟动量通量分量 $\\left[\\widehat{\\boldsymbol{F}}\\right]_2$。\n- 精确地说，打印的行必须如下所示\n$$\n\\left[\\left[\\phi_1^{(A)},\\phi_2^{(A)},\\phi_3^{(A)},\\widehat{F}_2^{(A)}\\right],\\left[\\phi_1^{(B)},\\phi_2^{(B)},\\phi_3^{(B)},\\widehat{F}_2^{(B)}\\right],\\left[\\phi_1^{(C)},\\phi_2^{(C)},\\phi_3^{(C)},\\widehat{F}_2^{(C)}\\right],\\left[\\phi_1^{(D)},\\phi_2^{(D)},\\phi_3^{(D)},\\widehat{F}_2^{(D)}\\right]\\right],\n$$\n每个浮点数都四舍五入到 $8$ 位小数。", "solution": "该问题是有效的。它在计算流体动力学领域内提出了一个清晰、独立且科学上合理的问题，具体涉及为一维欧拉方程实现带有 Harten-Hyman 熵修正的 Roe 近似黎曼求解器。所有必要的物理定律、方程和数值定义都已提供，并且测试用例是此类数值格式的标准基准。\n\n以下解决方案详细说明了所需数值通量的推导和实现。该方法按要求从第一性原理出发。\n\n对于一维欧拉方程，一个以单元为中心的有限体积方法，\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\n需要在每个单元交界面上计算一个数值通量 $\\widehat{\\boldsymbol{F}}$。Roe 求解器通过近似求解左状态 $\\boldsymbol{U}_L$ 和右状态 $\\boldsymbol{U}_R$ 之间界面上的黎曼问题来实现。\n\n守恒变量的状态向量是 $\\boldsymbol{U} = [\\rho,\\ \\rho u,\\ E]^{\\top}$，通量向量是 $\\boldsymbol{F}(\\boldsymbol{U}) = [\\rho u, \\rho u^2 + p, u(E + p)]^{\\top}$。该系统由理想气体状态方程 $p = (\\gamma - 1)(E - \\frac{1}{2} \\rho u^2)$ 闭合，其中 $\\gamma$ 是比热比。根据这些原始变量，我们还定义了声速 $a = \\sqrt{\\gamma p / \\rho}$ 和总焓 $H = (E + p) / \\rho$。给定原始变量 $(\\rho, u, p)$，单位体积的总能量 $E$ 计算为 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2$。\n\nRoe 求解器的核心思想是通过引入一个常数矩阵，即 Roe 矩阵 $\\tilde{A}$，来线性化系统，该矩阵满足属性 $\\boldsymbol{F}(\\boldsymbol{U}_R) - \\boldsymbol{F}(\\boldsymbol{U}_L) = \\tilde{A}(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$。这个矩阵是在一个特殊构造的“Roe 平均”状态下评估的通量雅可比矩阵 $A = \\partial \\boldsymbol{F}/\\partial \\boldsymbol{U}$。Roe 平均值由左状态 $(\\rho_L, u_L, p_L)$ 和右状态 $(\\rho_R, u_R, p_R)$ 计算得出：\n令 $w_L = \\sqrt{\\rho_L}$ 和 $w_R = \\sqrt{\\rho_R}$。\n$$\n\\tilde{u} = \\frac{w_L u_L + w_R u_R}{w_L + w_R}\n$$\n$$\n\\tilde{H} = \\frac{w_L H_L + w_R H_R}{w_L + w_R}, \\quad \\text{其中 } H_L = \\frac{E_L+p_L}{\\rho_L} \\text{ 且 } H_R = \\frac{E_R+p_R}{\\rho_R}\n$$\n然后导出 Roe 平均声速：\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}\n$$\nRoe 矩阵 $\\tilde{A}$ 拥有一套完整的实特征值（特征速度）和相应的右特征向量，它们在 Roe 平均状态下进行评估：\n$$\n\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{a}, \\quad \\tilde{\\lambda}_2 = \\tilde{u}, \\quad \\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{a}\n$$\n右特征向量矩阵 $R$ 的列是对应于 $(\\tilde{\\lambda}_1, \\tilde{\\lambda}_2, \\tilde{\\lambda}_3)$ 的特征向量，其形式为：\n$$\nR = \\begin{bmatrix}\n1  1  1 \\\\\n\\tilde{u} - \\tilde{a}  \\tilde{u}  \\tilde{u} + \\tilde{a} \\\\\n\\tilde{H} - \\tilde{u}\\tilde{a}  \\tfrac{1}{2}\\tilde{u}^2  \\tilde{H} + \\tilde{u}\\tilde{a}\n\\end{bmatrix}\n$$\nRoe 通量是一个中心通量加上一个基于迎风特征信息的耗散项。耗散项与 $|\\tilde{A}|(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$ 成正比，其中 $|\\tilde{A}| = R |\\Lambda| R^{-1}$ 且 $|\\Lambda| = \\mathrm{diag}(|\\tilde{\\lambda}_1|, |\\tilde{\\lambda}_2|, |\\tilde{\\lambda}_3|)$。这得到了标准的 Roe 通量：\n$$\n\\widehat{\\boldsymbol{F}}(\\boldsymbol{U}_L, \\boldsymbol{U}_R) = \\frac{1}{2} \\left[\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right] - \\frac{1}{2} R |\\Lambda| R^{-1} (\\boldsymbol{U}_R - \\boldsymbol{U}_L)\n$$\n标准的 Roe 求解器不能正确处理跨音速稀疏波，这是一种光滑的波现象，求解器可能会错误地将其捕捉为非物理的“稀疏激波”。Harten-Hyman 熵修正通过修改耗散项来解决这个问题。该修正识别波何时穿过界面跨越声速点。这是通过检查左、右状态下的物理特征值的符号来完成的：\n$$\n\\lambda_{k,L} = u_L + s_k a_L, \\quad \\lambda_{k,R} = u_R + s_k a_R, \\quad \\text{对于 } s_1 = -1, s_2 = 0, s_3 = 1\n$$\n如果 $\\lambda_{k,L}  0$ 且 $\\lambda_{k,R} > 0$，则检测到第 $k$ 个波的跨音速穿越。在这种情况下，定义一个正阈值 $\\delta_k$：\n$$\n\\delta_k = \\lambda_{k,R} - \\lambda_{k,L}\n$$\n否则，$\\delta_k = 0$。如果检测到跨音速穿越，Roe 特征值的绝对值 $|\\tilde{\\lambda}_k|$ 将被一个更平滑的函数 $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$ 替代，以在声速区域内增加数值粘性：\n$$\n\\phi_{\\delta_k}(\\tilde{\\lambda}_k) = \n\\begin{cases}\n  \\tfrac{1}{2}\\left(\\dfrac{\\tilde{\\lambda}_k^2}{\\delta_k} + \\delta_k\\right),  \\text{若 } |\\tilde{\\lambda}_k|  \\delta_k \\\\\n  |\\tilde{\\lambda}_k|,  \\text{若 } |\\tilde{\\lambda}_k| \\ge \\delta_k\n\\end{cases}\n$$\n如果 $\\delta_k = 0$，则 $\\phi_0(\\tilde{\\lambda}_k) = |\\tilde{\\lambda}_k|$，对于该波，恢复为标准的 Roe 耗散。\n\n最终带有逐个特征值 Harten-Hyman 熵修正的 Roe 数值通量为：\n$$\n\\widehat{\\boldsymbol{F}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2} \\left[\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right] - \\tfrac{1}{2} \\, R \\, \\left|\\Lambda\\right|_{\\phi} \\, R^{-1} \\, \\left(\\boldsymbol{U}_R - \\boldsymbol{U}_L\\right)\n$$\n其中 $\\left|\\Lambda\\right|_{\\phi} = \\mathrm{diag}\\left(\\phi_{\\delta_1}(\\tilde{\\lambda}_1), \\phi_{\\delta_2}(\\tilde{\\lambda}_2), \\phi_{\\delta_3}(\\tilde{\\lambda}_3)\\right)$。\n\n实现过程是为每个测试用例计算：\n1.  根据给定的原始变量 $(\\rho, u, p)$ 计算左、右状态向量 $\\boldsymbol{U}_L, \\boldsymbol{U}_R$ 和通量向量 $\\boldsymbol{F}_L, \\boldsymbol{F}_R$。\n2.  Roe 平均量 $\\tilde{u}$、$\\tilde{H}$ 和 $\\tilde{a}$。\n3.  Roe 特征值 $\\tilde{\\lambda}_1, \\tilde{\\lambda}_2, \\tilde{\\lambda}_3$。\n4.  物理特征值 $\\lambda_{k,L}, \\lambda_{k,R}$ 和阈值 $\\delta_k$，其中 $k \\in \\{1,2,3\\}$。\n5.  经过熵修正的谱半径 $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$，这是要求输出的第一部分。\n6.  右特征向量矩阵 $R$ 及其数值逆矩阵 $R^{-1}$。\n7.  带有修正谱半径的对角矩阵 $|\\Lambda|_{\\phi}$。\n8.  完整的数值通量向量 $\\widehat{\\boldsymbol{F}}$ 及其第二个分量（动量分量），这是要求输出的最后一部分。\n所有浮点结果在最终报告时四舍五入到 $8$ 位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified test cases for the Roe solver with Harten-Hyman entropy fix.\n    \"\"\"\n    gamma = 1.4\n\n    test_cases = [\n        # Case A: Smooth contact\n        {'L': (1.0, 0.0, 1.0), 'R': (2.0, 0.0, 1.0)},\n        # Case B: Transonic rarefaction\n        {'L': (1.0, -0.2, 0.4), 'R': (0.5, 1.8, 0.4)},\n        # Case C: Strong shock-like jump\n        {'L': (1.0, 3.0, 1.0), 'R': (3.0, 0.0, 4.0)},\n        # Case D: Near-zero crossing contact\n        {'L': (1.0, -1e-6, 1.0), 'R': (1.0, 1e-6, 1.0)},\n    ]\n\n    results = []\n    for case_data in test_cases:\n        rho_L, u_L, p_L = case_data['L']\n        rho_R, u_R, p_R = case_data['R']\n        \n        result_tuple = compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n        \n        # Format the result list with 8 decimal places for each float\n        formatted_result = [f\"{x:.8f}\" for x in result_tuple]\n        results.append(f\"[{','.join(formatted_result)}]\")\n\n    # Print the final result in the exact required format\n    print(f\"[{','.join(results)}]\")\n\ndef compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n    \"\"\"\n    Computes the Roe flux with Harten-Hyman entropy fix for given left and right states.\n\n    Returns:\n        A tuple containing (phi_1, phi_2, phi_3, F_momentum).\n    \"\"\"\n    # Step 1: Compute derived quantities for left and right states\n    # Total energy E = p/(gamma-1) + 0.5 * rho * u^2\n    E_L = p_L / (gamma - 1) + 0.5 * rho_L * u_L**2\n    E_R = p_R / (gamma - 1) + 0.5 * rho_R * u_R**2\n\n    # Conserved state vector U = [rho, rho*u, E]\n    U_L = np.array([rho_L, rho_L * u_L, E_L])\n    U_R = np.array([rho_R, rho_R * u_R, E_R])\n\n    # Flux vector F = [rho*u, rho*u^2 + p, u*(E+p)]\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n    \n    # Speed of sound a = sqrt(gamma*p/rho)\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n\n    # Total enthalpy H = (E+p)/rho\n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n\n    # Step 2: Compute Roe averages\n    sqrt_rho_L = np.sqrt(rho_L)\n    sqrt_rho_R = np.sqrt(rho_R)\n    \n    u_tilde = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    H_tilde = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    a_tilde = np.sqrt((gamma - 1) * (H_tilde - 0.5 * u_tilde**2))\n\n    # Step 3: Compute Roe eigenvalues\n    lambda_tilde_vals = np.array([u_tilde - a_tilde, u_tilde, u_tilde + a_tilde])\n\n    # Step 4: Harten-Hyman entropy fix\n    s_vals = np.array([-1, 0, 1])\n    delta_vals = np.zeros(3)\n    phi_vals = np.zeros(3)\n\n    for k in range(3):\n        lambda_kL = u_L + s_vals[k] * a_L\n        lambda_kR = u_R + s_vals[k] * a_R\n        \n        delta_k = 0.0\n        if lambda_kL  0  lambda_kR:\n            delta_k = lambda_kR - lambda_kL\n        delta_vals[k] = delta_k\n        \n        lambda_tilde_k = lambda_tilde_vals[k]\n        if abs(lambda_tilde_k)  delta_k:\n            phi_vals[k] = 0.5 * (lambda_tilde_k**2 / delta_k + delta_k)\n        else:\n            phi_vals[k] = abs(lambda_tilde_k)\n\n    # Step 5: Construct matrices and compute the numerical flux\n    # Right eigenvector matrix R\n    R = np.array([\n        [1, 1, 1],\n        [u_tilde - a_tilde, u_tilde, u_tilde + a_tilde],\n        [H_tilde - u_tilde * a_tilde, 0.5 * u_tilde**2, H_tilde + u_tilde * a_tilde]\n    ])\n    \n    # Numerical inverse of R\n    R_inv = np.linalg.inv(R)\n\n    # Diagonal matrix of modified spectral radii\n    Lambda_phi = np.diag(phi_vals)\n\n    # Jump in conserved variables\n    dU = U_R - U_L\n\n    # Dissipation term\n    dissipation = 0.5 * (R @ Lambda_phi @ R_inv @ dU)\n    \n    # Final Roe flux with entropy fix\n    F_hat = 0.5 * (F_L + F_R) - dissipation\n\n    # Extract required outputs\n    phi_1, phi_2, phi_3 = phi_vals\n    F_momentum = F_hat[1]\n    \n    return phi_1, phi_2, phi_3, F_momentum\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3314345"}]}