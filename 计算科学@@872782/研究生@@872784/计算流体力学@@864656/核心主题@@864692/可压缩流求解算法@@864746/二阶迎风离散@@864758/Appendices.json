{"hands_on_practices": [{"introduction": "理论上的推导是一回事，但通过亲手编程来验证其数值表现是计算流体力学中的一项核心技能。本练习将指导您使用“人造解方法”（Method of Manufactured Solutions）来对线性平流方程的二阶迎风格式进行网格加密研究。通过该实践，您将学会如何系统地评估一个数值格式的收敛阶，并亲眼见证二阶精度在数值误差随网格细化而减小过程中的具体体现。[@problem_id:3360956]", "problem": "考虑一维线性平流方程 $u_t + a u_x = 0$，定义在周期性域 $[0,L)$ 上，其中平流速度 $a \\in \\mathbb{R}\\setminus\\{0\\}$ 为常数。您将使用人工解方法设计一个光滑的周期精确解，然后对一个全离散格式进行网格加密研究。该格式在空间上使用二阶迎风离散，并使用一个高阶显式时间积分器，其时间步长足够小，以使时间误差相对于空间离散误差可以忽略不计。\n\n从基本守恒律和常系数平流模型出发，利用周期性边界条件和光滑周期函数的定义，构造一个在所有 $t \\ge 0$ 上满足 $u_t + a u_x = 0$ 的人工解：\n- 选择人工初始条件 $u(x,0) = \\sin\\!\\big(2\\pi x/L\\big) + \\tfrac{1}{4}\\cos\\!\\big(6\\pi x/L\\big)$，其中所有三角函数参数均以弧度为单位。那么在周期性条件下，对于任何 $t \\ge 0$，精确解为 $u_{\\text{exact}}(x,t) = \\sin\\!\\big(2\\pi (x - a t)/L\\big) + \\tfrac{1}{4}\\cos\\!\\big(6\\pi (x - a t)/L\\big)$。\n\n在均匀网格 $x_i = i \\Delta x$（$i=0,\\dots,N-1$）上离散化空间，其中 $\\Delta x = L/N$，并采用周期性环绕索引。使用二阶迎风有限差分算子离散化空间导数 $u_x$：\n- 对于 $a > 0$，\n$$\n\\left(D_x u\\right)_i \\;=\\; \\frac{3 u_i - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x}.\n$$\n- 对于 $a  0$，\n$$\n\\left(D_x u\\right)_i \\;=\\; \\frac{-3 u_i + 4 u_{i+1} - u_{i+2}}{2\\,\\Delta x}.\n$$\n对所有 $i$，使用周期性边界条件来定义 $u_{i\\pm 1}$ 和 $u_{i\\pm 2}$。\n\n使用三阶强稳定性保持（SSP）Runge–Kutta方法（也称为Shu–Osher形式）进行时间推进，对于半离散系统 $u_t = -a\\,D_x u$，该方法表示为\n$$\n\\begin{aligned}\nu^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n),\\\\\nu^{(2)} = \\tfrac{3}{4}u^n + \\tfrac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right),\\\\\nu^{n+1} = \\tfrac{1}{3}u^n + \\tfrac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right),\n\\end{aligned}\n$$\n其中 $\\mathcal{L}(u) = -a\\,D_x u$。选择时间步长 $\\Delta t = \\text{CFL}\\,\\Delta x/|a|$，其中Courant–Friedrichs–Lewy (CFL) 数 $\\text{CFL} = 0.3$，以使得当 $\\Delta x \\to 0$ 时，阶为 $\\mathcal{O}(\\Delta t^3)$ 的时间误差相对于阶为 $\\mathcal{O}(\\Delta x^2)$ 的空间误差可以忽略不计。\n\n对于给定的最终时间 $T>0$，计算数值解 $u^N_i \\approx u(x_i,T)$，并测量离散 $L^2$ 误差\n$$\nE(N) \\;=\\; \\left(\\sum_{i=0}^{N-1}\\left(u^N_i - u_{\\text{exact}}(x_i,T)\\right)^2\\Delta x\\right)^{1/2}.\n$$\n使用加密比 $r=2$ 和连续网格 $N, 2N, 4N, 8N$，通过连续网格间的 Richardson 外推估计观测到的空间阶数 $p$，\n$$\np(N \\to 2N) \\;=\\; \\frac{\\ln\\!\\left(\\dfrac{E(N)}{E(2N)}\\right)}{\\ln(2)}.\n$$\n为最小化粗网格预渐近效应可能带来的任何污染，将最密网格对的估计值 $p(4N \\to 8N)$ 作为每个测试案例的观测阶数进行报告。\n\n将上述内容实现为一个完整的、可运行的程序，该程序：\n- 使用上述人工解。\n- 采用指定的二阶迎风空间离散和三阶SSP Runge–Kutta时间积分器。\n- 使用带周期性边界条件的均匀网格。\n- 使用 $\\Delta t = 0.3\\,\\Delta x/|a|$。\n- 计算 $N \\in \\{64,128,256,512\\}$ 的 $E(N)$，并输出基于 $E(256)$ 和 $E(512)$ 的 Richardson 估计值。\n\n测试套件：\n为以下三组参数提供结果，这三组参数共同测试一个代表性案例、一个负平流案例和一个单周期输运：\n- 案例A（代表性）：$a = 1.3$, $L = 1.0$, $T = 0.3$。\n- 案例B（负平流）：$a = -0.7$, $L = 1.0$, $T = 0.25$。\n- 案例C（单周期）：$a = 1.0$, $L = 1.0$, $T = 1.0$。\n\n角度单位：所有三角函数均使用弧度。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含与案例A、B和C相对应的三个观测阶数，形式为方括号内以逗号分隔的十进制数列表，例如 $[p_A,p_B,p_C]$。这些值应为十进制浮点数。不应打印任何附加文本。", "solution": "在尝试提供解决方案之前，需对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **控制方程**：一维线性平流方程，$u_t + a u_x = 0$。\n- **域**：周期性，$[0, L)$。\n- **平流速度**：常数，$a \\in \\mathbb{R}\\setminus\\{0\\}$。\n- **方法论**：人工解方法。\n- **初始条件**：$u(x,0) = \\sin(2\\pi x/L) + \\tfrac{1}{4}\\cos(6\\pi x/L)$。所有三角函数参数均以弧度为单位。\n- **精确解**：$u_{\\text{exact}}(x,t) = \\sin(2\\pi (x - a t)/L) + \\tfrac{1}{4}\\cos(6\\pi (x - a t)/L)$。\n- **空间网格**：均匀网格 $x_i = i \\Delta x$（$i=0,\\dots,N-1$），其中 $\\Delta x = L/N$。\n- **空间离散化**：二阶迎风有限差分算子。\n  - 对于 $a > 0$：$\\left(D_x u\\right)_i = \\frac{3 u_i - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x}$。\n  - 对于 $a  0$：$\\left(D_x u\\right)_i = \\frac{-3 u_i + 4 u_{i+1} - u_{i+2}}{2\\,\\Delta x}$。\n- **边界条件**：用于模板操作的周期性边界条件。\n- **时间积分**：用于 $u_t = \\mathcal{L}(u) = -a\\,D_x u$ 的三阶强稳定性保持（SSP）Runge–Kutta方法（又名Shu–Osher形式）：\n  $$\n  \\begin{aligned}\n  u^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n),\\\\\n  u^{(2)} = \\tfrac{3}{4}u^n + \\tfrac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right),\\\\\n  u^{n+1} = \\tfrac{1}{3}u^n + \\tfrac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right).\n  \\end{aligned}\n  $$\n- **时间步长**：$\\Delta t = \\text{CFL}\\,\\Delta x/|a|$，其中 $\\text{CFL} = 0.3$。\n- **误差度量**：离散 $L^2$ 误差，$E(N) = \\left(\\sum_{i=0}^{N-1}\\left(u^N_i - u_{\\text{exact}}(x_i,T)\\right)^2\\Delta x\\right)^{1/2}$。\n- **收敛性分析**：\n  - 网格加密研究，其中 $N \\in \\{64, 128, 256, 512\\}$。\n  - 观测阶数估计：$p(N \\to 2N) = \\frac{\\ln(E(N)/E(2N))}{\\ln(2)}$。\n  - 报告阶数：来自最密网格对的估计值，$p(256 \\to 512)$。\n- **测试案例**：\n  - 案例 A：$a = 1.3$, $L = 1.0$, $T = 0.3$。\n  - 案例 B：$a = -0.7$, $L = 1.0$, $T = 0.25$。\n  - 案例 C：$a = 1.0$, $L = 1.0$, $T = 1.0$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上和数学上都是合理的。\n1.  **科学基础**：该问题涉及线性平流方程的数值解，这是输运现象中的一个基本模型。所有指定的组成部分——人工解方法、迎风有限差分格式和SSP Runge-Kutta方法——都是计算物理和数值分析中标准的、有据可查的技术。所提供的公式是这些方法的正确表示。\n2.  **适定性**：该问题是适定的。具有光滑、周期性初始条件的线性平流方程有唯一、稳定的解析解。数值格式也定义明确，并指定了稳定的时间步长（CFL数为$0.3$，完全在该组合格式的稳定性限制范围内）。任务是计算一个特定的、唯一定义的数值量（观测到的精度阶数）。\n3.  **完整性和一致性**：该问题是自洽的。它提供了所有必要的参数（$a, L, T$）、函数（$u_{\\text{exact}}$）、离散格式、误差度量和分析程序。没有矛盾之处。\n4.  **客观性**：问题以精确、客观和定量的方式陈述，没有任何模糊性或主观因素。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供一个解决方案。\n\n### 解决方案\n\n该问题要求实现一维线性平流方程 $u_t + a u_x = 0$ 在周期性域上的数值模拟。目标是使用人工解方法验证二阶迎风格式的空间精度阶数。\n\n**1. 人工解**\n提供的人工解为 $u_{\\text{exact}}(x,t) = \\sin(k_1(x-at)) + \\tfrac{1}{4}\\cos(k_2(x-at))$，其中 $k_1 = 2\\pi/L$ 和 $k_2 = 6\\pi/L$。该函数是两个行波的叠加，这是线性平流方程解的特征形式。我们可以验证它满足偏微分方程（PDE）：\n$$ \\frac{\\partial u_{\\text{exact}}}{\\partial t} = -a k_1 \\cos(k_1(x-at)) + \\frac{1}{4} a k_2 \\sin(k_2(x-at)) $$\n$$ \\frac{\\partial u_{\\text{exact}}}{\\partial x} = k_1 \\cos(k_1(x-at)) - \\frac{1}{4} k_2 \\sin(k_2(x-at)) $$\n将这些代入PDE得到 $u_t + a u_x = (-a k_1 \\cos(\\cdot) + a k_1 \\cos(\\cdot)) + (\\tfrac{1}{4} a k_2 \\sin(\\cdot) - \\tfrac{1}{4} a k_2 \\sin(\\cdot)) = 0$。波数 $k_1$ 和 $k_2$ 是 $2\\pi/L$ 的整数倍，确保解在域 $[0, L)$ 上是周期性的。\n\n**2. 半离散化**\n将域 $[0, L)$ 离散化为包含 $N$ 个点的均匀网格，$x_i = i \\Delta x$（对于 $i = 0, \\dots, N-1$），其中 $\\Delta x = L/N$。在给定时间，这些网格点上的解由一个向量 $u(t) = [u_0(t), u_1(t), \\dots, u_{N-1}(t)]^T$ 表示。\n空间导数 $u_x$ 由有限差分算子 $D_x$ 近似。问题指定了一个二阶迎风格式，其模板取决于平流速度 $a$ 的符号，以确保信息从波传播的方向提取。\n\n对于 $a > 0$（信息从左向右传播），算子为：\n$$ (D_x u)_i = \\frac{3 u_i - 4 u_{i-1} + u_{i-2}}{2 \\Delta x} $$\n对于 $a  0$（信息从右向左传播），算子为：\n$$ (D_x u)_i = \\frac{-3 u_i + 4 u_{i+1} - u_{i+2}}{2 \\Delta x} $$\n通过对索引使用模运算来施加周期性边界条件。例如，$u_{-1}$ 被理解为 $u_{N-1}$，$u_{N}$ 被理解为 $u_0$。\n\n这导致了一个常微分方程组（ODEs），称为半离散形式：\n$$ \\frac{d u}{d t} = -a (D_x u) \\equiv \\mathcal{L}(u) $$\n\n**3. 时间离散化**\n该常微分方程组使用指定的三阶强稳定性保持Runge-Kutta（SSP3）方法从 $t=0$ 积分到 $t=T$。给定在时间 $t^n$ 的解向量 $u^n$，在时间 $t^{n+1} = t^n + \\Delta t$ 的解 $u^{n+1}$ 通过三个阶段计算得出：\n$$\n\\begin{aligned}\nu^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n) \\\\\nu^{(2)} = \\frac{3}{4}u^n + \\frac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right) \\\\\nu^{n+1} = \\frac{1}{3}u^n + \\frac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right)\n\\end{aligned}\n$$\n时间步长选择为 $\\Delta t = 0.3 \\Delta x / |a|$。由于空间格式为 $\\mathcal{O}(\\Delta x^2)$，时间格式为 $\\mathcal{O}(\\Delta t^3)$，且 $\\Delta t \\propto \\Delta x$，因此当 $\\Delta x \\to 0$ 时，时间误差项 $\\mathcal{O}(\\Delta x^3)$ 将比空间误差项 $\\mathcal{O}(\\Delta x^2)$ 衰减得更快。因此，对于足够小的 $\\Delta x$，总误差将由空间离散误差主导，从而可以清晰地测量其收敛率。\n\n**4. 收敛性分析**\n模拟在一系列网格分辨率 $N \\in \\{64, 128, 256, 512\\}$ 上运行。对于每个 $N$，计算在最终时间 $T$ 的数值解，记为 $u^N_i$。计算相对于精确解的离散 $L^2$ 误差：\n$$ E(N) = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} (u^N_i - u_{\\text{exact}}(x_i, T))^2} $$\n假设误差遵循形式 $E(N) \\approx C (\\Delta x)^p = C (L/N)^p$，其中 $C$ 是某个常数，$p$ 是精度阶数，我们可以通过比较来自两个不同分辨率 $N_1$ 和 $N_2=r N_1$（其中 $r$ 是加密比）的误差来求得 $p$。\n$$ \\frac{E(N_1)}{E(N_2)} \\approx \\frac{C (L/N_1)^p}{C (L/(rN_1))^p} = r^p $$\n对两边取对数得到 $\\ln(E(N_1)/E(N_2)) \\approx p \\ln(r)$。问题指定 $r=2$，从而得到观测收敛阶数的公式：\n$$ p = \\frac{\\ln(E(N)/E(2N))}{\\ln(2)} $$\n为了获得渐近阶数的更准确估计，我们使用最密网格 $N=256$ 和 $2N=512$ 的结果。\n\n总体算法如下：\n1. 对于每个测试案例 $(a, L, T)$，创建一个字典或列表来存储误差。\n2. 对于每个网格尺寸 $N \\in \\{64, 128, 256, 512\\}$：\n    a. 定义计算网格 $x$ 和空间步长 $\\Delta x$。\n    b. 根据 $u_{\\text{exact}}(x, 0)$ 设置初始条件 $u$。\n    c. 根据CFL条件设置时间步长 $\\Delta t$。\n    d. 使用SSP3积分器将解从 $t=0$ 演化到 $t=T$，确保最后一步正好到达 $T$。\n    e. 通过将最终数值解与 $u_{\\text{exact}}(x, T)$ 进行比较，计算 $L^2$ 误差 $E(N)$。存储此误差。\n3. 使用 $N=256$ 和 $N=512$ 存储的误差计算观测阶数 $p$。\n4. 收集所有三个测试案例的阶数 $p$ 并格式化输出。\n此过程将在提供的Python脚本中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a second-order upwind scheme\n    and third-order SSP Runge-Kutta time integration. It performs a grid\n    refinement study to measure the observed order of spatial accuracy.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (representative)\n        {'a': 1.3, 'L': 1.0, 'T': 0.3, 'label': 'A'},\n        # Case B (negative advection)\n        {'a': -0.7, 'L': 1.0, 'T': 0.25, 'label': 'B'},\n        # Case C (one period)\n        {'a': 1.0, 'L': 1.0, 'T': 1.0, 'label': 'C'},\n    ]\n\n    # Grid sizes for the refinement study\n    N_values = [64, 128, 256, 512]\n    \n    # Courant–Friedrichs–Lewy (CFL) number\n    CFL = 0.3\n\n    results = []\n\n    def exact_solution(x, t, L, a):\n        \"\"\"Computes the manufactured exact solution.\"\"\"\n        k1 = 2.0 * np.pi / L\n        k2 = 6.0 * np.pi / L\n        return np.sin(k1 * (x - a * t)) + 0.25 * np.cos(k2 * (x - a * t))\n\n    def spatial_derivative(u, dx, a):\n        \"\"\"\n        Computes the second-order upwind spatial derivative on a periodic grid.\n        np.roll(u, k) shifts elements, effectively accessing u[i-k].\n        \"\"\"\n        if a > 0:\n            # Stencil uses points i, i-1, i-2. \n            # np.roll(u, 1) -> u_{i-1}, np.roll(u, 2) -> u_{i-2}\n            du_dx = (3.0 * u - 4.0 * np.roll(u, 1) + 1.0 * np.roll(u, 2)) / (2.0 * dx)\n        else: # a  0\n            # Stencil uses points i, i+1, i+2.\n            # np.roll(u, -1) -> u_{i+1}, np.roll(u, -2) -> u_{i+2}\n            du_dx = (-3.0 * u + 4.0 * np.roll(u, -1) - 1.0 * np.roll(u, -2)) / (2.0 * dx)\n        return du_dx\n\n    def l2_error(u_num, u_exact, dx):\n        \"\"\"Computes the discrete L2-error.\"\"\"\n        return np.sqrt(dx * np.sum((u_num - u_exact)**2))\n\n    for case in test_cases:\n        a = case['a']\n        L = case['L']\n        T = case['T']\n        \n        errors = {}\n\n        for N in N_values:\n            # 1. Setup grid and initial condition\n            dx = L / N\n            x = np.linspace(0.0, L, num=N, endpoint=False)\n            u = exact_solution(x, 0.0, L, a)\n\n            # 2. Setup time integration\n            dt = CFL * dx / np.abs(a)\n            t = 0.0\n\n            # 3. Main time-stepping loop\n            while t  T:\n                # Ensure the final time step hits T exactly\n                dt_effective = min(dt, T - t)\n                \n                # Define the spatial operator for the RK stages\n                def L_op(v):\n                    return -a * spatial_derivative(v, dx, a)\n\n                # SSP(3,3) Runge-Kutta stages\n                u1 = u + dt_effective * L_op(u)\n                u2 = 0.75 * u + 0.25 * (u1 + dt_effective * L_op(u1))\n                u = (1.0/3.0) * u + (2.0/3.0) * (u2 + dt_effective * L_op(u2))\n                \n                t += dt_effective\n\n            # 4. Compute and store the final error\n            u_ex_final = exact_solution(x, T, L, a)\n            errors[N] = l2_error(u, u_ex_final, dx)\n\n        # 5. Calculate the observed order of accuracy using the finest grid pair\n        E_256 = errors[256]\n        E_512 = errors[512]\n        \n        # p = log(E(N)/E(2N)) / log(2)\n        p = np.log(E_256 / E_512) / np.log(2.0)\n        results.append(p)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3360956"}, {"introduction": "在为对流问题选择显式时间积分格式时，稳定性的考量至关重要，它直接决定了数值模拟所允许的最大时间步长。本练习通过冯·诺依曼稳定性分析，带您深入探究二阶迎风格式与中心差分格式在不同龙格-库塔（Runge-Kutta）方法下的稳定性边界（CFL数）。通过这个练习，您不仅能计算出具体的稳定性极限，还能从半离散算子的谱特性上理解为何迎风格式通常比中心差分格式更适合求解对流主导的问题。[@problem_id:3360952]", "problem": "考虑常平流速度 $a>0$ 的一维线性平流方程，\n$$\nu_{t} + a\\,u_{x} = 0,\n$$\n该方程定义在周期性区域上，并在间距为 $\\Delta x$ 的均匀网格上进行离散。令 Courant–Friedrichs–Lewy (CFL) 数为 $C \\equiv a\\,\\Delta t/\\Delta x$，其中 $\\Delta t$ 是时间步长。平流导数采用两种空间离散格式：\n\n- 在网格点 $i$ 处，（对于 $a>0$ 的）二阶迎风离散导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{3 u_{i} - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x},\n$$\n- 二阶中心离散导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n\n时间积分采用显式两步 Runge–Kutta (RK2) 和显式三步 Runge–Kutta (RK3) 方法。使用半离散系统的 von Neumann (Fourier) 稳定性分析以及应用于线性测试方程的显式 Runge–Kutta 方法的线性稳定性函数，确定以下四种组合的最大稳定 CFL 数 $C_{\\max}$：\n1. RK2 与二阶迎风格式，\n2. RK3 与二阶迎风格式，\n3. RK2 与二阶中心格式，\n4. RK3 与二阶中心格式。\n\n你的推导必须从半离散算子的傅里叶符号和 Runge–Kutta 稳定性多项式开始。然后，对于每种组合，确定最大的 $C$ 值，使得相应的稳定性条件对所有傅里叶波数都成立。最后，按照上面列出的顺序，将四个 $C_{\\max}$ 值以单行矩阵的形式报告。将你的答案四舍五入到四位有效数字。将最终答案表示为无量纲数。", "solution": "我们从线性平流方程 $u_{t} + a\\,u_{x} = 0$ 开始。在均匀周期性网格上，该方程产生一个半离散的常微分方程组 (ODE)。为了进行 von Neumann (Fourier) 分析，我们考虑形如 $u_{i}(t) = \\hat{u}(t)\\,\\exp\\!\\left(\\mathrm{i}\\,i\\,\\theta\\right)$ 的傅里叶模态，其中 $\\theta \\in [-\\pi,\\pi]$ 是无量纲波数。空间离散格式在傅里叶模态上是对角作用的，并由其符号来表征。\n\n1) 空间符号。\n\n- 对于（$a>0$ 的）二阶迎风导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{3 u_{i} - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x}.\n$$\n将其应用于 $u_{i} = \\hat{u}\\,\\exp(\\mathrm{i} i \\theta)$，我们得到符号\n$$\nD_{\\mathrm{up}}(\\theta) \\equiv \\frac{3 - 4\\,\\exp(-\\mathrm{i}\\theta) + \\exp(-2\\mathrm{i}\\theta)}{2\\,\\Delta x}.\n$$\n半离散 ODE 为 $u_{t} = -a\\,D_{\\mathrm{up}}(\\theta)\\,u$，因此特征值为\n$$\n\\sigma_{\\mathrm{up}}(\\theta) = -a\\,D_{\\mathrm{up}}(\\theta) = -\\frac{a}{\\Delta x}\\,\\frac{3 - 4\\,\\exp(-\\mathrm{i}\\theta) + \\exp(-2\\mathrm{i}\\theta)}{2}.\n$$\n定义 CFL 数 $C \\equiv a\\,\\Delta t/\\Delta x$，无量纲时间放大参数为\n$$\nz_{\\mathrm{up}}(\\theta) \\equiv \\Delta t\\,\\sigma_{\\mathrm{up}}(\\theta) = -C\\,S_{\\mathrm{up}}(\\theta), \\quad S_{\\mathrm{up}}(\\theta) \\equiv \\frac{3 - 4\\,\\exp(-\\mathrm{i}\\theta) + \\exp(-2\\mathrm{i}\\theta)}{2}.\n$$\n\n- 对于二阶中心导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n将其应用于 $u_{i} = \\hat{u}\\,\\exp(\\mathrm{i} i \\theta)$，符号为\n$$\nD_{\\mathrm{c}}(\\theta) \\equiv \\frac{\\exp(\\mathrm{i}\\theta) - \\exp(-\\mathrm{i}\\theta)}{2\\,\\Delta x} = \\frac{\\mathrm{i}\\,\\sin\\theta}{\\Delta x}.\n$$\n因此，\n$$\n\\sigma_{\\mathrm{c}}(\\theta) = -a\\,D_{\\mathrm{c}}(\\theta) = -\\frac{a}{\\Delta x}\\,\\mathrm{i}\\,\\sin\\theta, \\quad\nz_{\\mathrm{c}}(\\theta) \\equiv \\Delta t\\,\\sigma_{\\mathrm{c}}(\\theta) = -\\mathrm{i}\\,C\\,\\sin\\theta.\n$$\n\n2) Runge–Kutta 稳定性多项式。\n\n对于线性 ODE $y'=\\lambda y$，应用一个显式 $s$ 步 Runge–Kutta 方法得到 $y^{n+1} = R(z)\\,y^{n}$，其中 $z\\equiv \\lambda\\,\\Delta t$，$R(z)$ 是一个多项式形式的稳定性函数。对于显式两步 Runge–Kutta 方法（RK2，包括标准的强稳定性保持两步格式），稳定性多项式为\n$$\nR_{2}(z) = 1 + z + \\frac{z^{2}}{2}.\n$$\n对于显式三步 Runge–Kutta 方法（RK3，包括标准的强稳定性保持三步格式），线性问题的稳定性多项式为\n$$\nR_{3}(z) = 1 + z + \\frac{z^{2}}{2} + \\frac{z^{3}}{6}.\n$$\n稳定性要求对于半离散算子谱中的所有相关 $z$，都有 $|R(z)| \\leq 1$。\n\n3) 稳定性分析与 $C_{\\max}$。\n\n- 迎风格式 + RK2 和 RK3：\n我们首先分析 $S_{\\mathrm{up}}(\\theta)$。它的实部是\n$$\n\\Re\\{S_{\\mathrm{up}}(\\theta)\\} = \\frac{1}{2}\\bigl(3 - 4\\cos\\theta + \\cos 2\\theta\\bigr).\n$$\n在 $\\theta \\in [0,\\pi]$ 上求导：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}\\theta}\\Re\\{S_{\\mathrm{up}}(\\theta)\\} = \\frac{1}{2}\\bigl(4\\sin\\theta - 2\\sin 2\\theta\\bigr) = 2\\sin\\theta\\,(1 - \\cos\\theta) \\ge 0,\n$$\n仅在 $\\theta=0$ 时等号成立。因此 $\\Re\\{S_{\\mathrm{up}}(\\theta)\\}$ 是递增的，并在 $\\theta=\\pi$ 处达到最大值：\n$$\nS_{\\mathrm{up}}(\\pi) = \\frac{3 - 4(-1) + 1}{2} = 4, \\quad z_{\\mathrm{up}}(\\pi) = -4\\,C.\n$$\n因此，迎风半离散谱包含纯实负点 $z=-4C$，这是负实轴方向上的极值点。对于 $R_{2}$ 和 $R_{3}$，绝对稳定区域与负实轴相交于某点 $z=-\\alpha$，其中 $|R(-\\alpha)|=1$；最大的允许 $C$ 值通过要求 $-4C$ 保持在相交区间内来确定。因此\n$$\nC_{\\max,\\mathrm{up}} = \\frac{\\alpha}{4},\n$$\n其中 $\\alpha$ 是 Runge–Kutta 稳定区域在负实轴上的（正）范围。\n\n对于 RK2，沿负实轴设 $z=-x$, $x\\ge 0$：\n$$\nR_{2}(-x) = 1 - x + \\frac{x^{2}}{2}.\n$$\n边界 $|R_{2}(-x)|=1$ 出现在 $R_{2}(-x)=1$ 处，这给出 $-x + \\frac{x^{2}}{2}=0 \\Rightarrow x=0$ 或 $x=2$。因此 $\\alpha_{2}=2$ 并且\n$$\nC_{\\max,\\mathrm{up}}^{\\mathrm{(RK2)}} = \\frac{\\alpha_{2}}{4} = \\frac{2}{4} = \\frac{1}{2}.\n$$\n\n对于 RK3，沿负实轴设 $z=-x$，\n$$\nR_{3}(-x) = 1 - x + \\frac{x^{2}}{2} - \\frac{x^{3}}{6}.\n$$\n边界 $|R_{3}(-x)|=1$ 在 $R_{3}(-x)=-1$ 处达到（因为 $R_{3}(-x)$ 从 1 开始减小，在幅值再次增大前穿过 -1 一次），这给出\n$$\n1 - x + \\frac{x^{2}}{2} - \\frac{x^{3}}{6} = -1 \\;\\;\\Longleftrightarrow\\;\\; x^{3} - 3x^{2} + 6x - 12 = 0.\n$$\n设 $\\alpha_{3}$ 是此三次方程的唯一正根；则\n$$\nC_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}} = \\frac{\\alpha_{3}}{4}.\n$$\n通过数值方法（例如 Newton 法，注意到 $f'(x)=3(x-1)^{2}+3>0$ 所以根是唯一的）求解 $x^{3} - 3x^{2} + 6x - 12 = 0$，得到 $\\alpha_{3} \\approx 2.51277$，因此\n$$\nC_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}} \\approx \\frac{2.51277}{4} \\approx 0.62819.\n$$\n\n- 中心格式 + RK2 和 RK3：\n对于中心格式，\n$$\nz_{\\mathrm{c}}(\\theta) = -\\mathrm{i}\\,C\\,\\sin\\theta,\n$$\n所以整个半离散谱都位于虚轴上，满足 $|z| \\le C$，极值点在 $z = \\pm \\mathrm{i}\\,C$。\n\n对于 RK2，将 $z=\\mathrm{i}y$ 代入 $R_{2}$：\n$$\nR_{2}(\\mathrm{i}y) = 1 + \\mathrm{i}y - \\frac{y^{2}}{2}, \\quad |R_{2}(\\mathrm{i}y)|^{2} = \\bigl(1 - \\tfrac{y^{2}}{2}\\bigr)^{2} + y^{2} = 1 + \\frac{y^{4}}{4} \\ge 1,\n$$\n仅在 $y=0$ 时等号成立。因此，除了原点外，没有非零的虚数 $z$ 位于 RK2 稳定区域内，这意味着\n$$\nC_{\\max,\\mathrm{c}}^{\\mathrm{(RK2)}} = 0.\n$$\n\n对于 RK3，将 $z=\\mathrm{i}y$ 代入 $R_{3}$：\n$$\nR_{3}(\\mathrm{i}y) = 1 + \\mathrm{i}y - \\frac{y^{2}}{2} - \\mathrm{i}\\frac{y^{3}}{6},\n$$\n所以\n$$\n|R_{3}(\\mathrm{i}y)|^{2} = \\bigl(1 - \\tfrac{y^{2}}{2}\\bigr)^{2} + \\bigl(y - \\tfrac{y^{3}}{6}\\bigr)^{2} = 1 - \\frac{y^{4}}{12} + \\frac{y^{6}}{36}.\n$$\n边界 $|R_{3}(\\mathrm{i}y)|=1$ 满足\n$$\n-\\frac{y^{4}}{12} + \\frac{y^{6}}{36} = 0 \\;\\;\\Longleftrightarrow\\;\\; y^{4}\\Bigl(\\frac{y^{2}}{36} - \\frac{1}{12}\\Bigr) = 0 \\;\\;\\Longleftrightarrow\\;\\; y^{2} = 3.\n$$\n因此与虚轴的交点在 $|y|=\\sqrt{3}$ 处。由于中心离散的极值特征值满足 $|z|=C$，稳定性要求 $C \\le \\sqrt{3}$，即\n$$\nC_{\\max,\\mathrm{c}}^{\\mathrm{(RK3)}} = \\sqrt{3}.\n$$\n\n4) 通过特征值进行解释。\n\n二阶迎风格式的符号 $S_{\\mathrm{up}}(\\theta)$ 严格位于复平面的右半部分（因此 $z=-C S_{\\mathrm{up}}(\\theta)$ 位于左半平面），并在 $\\theta=\\pi$ 处达到一个纯实负极值，该极值通过 Runge–Kutta 稳定区域在负实轴上的范围来决定稳定性极限。相比之下，二阶中心格式的符号对所有 $\\theta$ 都是纯虚数，因此稳定性取决于 Runge–Kutta 稳定区域包含了多长的虚轴：对于 RK2 是没有（除了原点），对于 RK3 是一个有限线段 $|y|\\le \\sqrt{3}$。这些谱的几何形状解释了为什么中心格式与 RK2 组合不允许非零的 $C$，而与 RK3 组合却允许一个相对较大的 $C_{\\max}$，以及为什么迎风格式的 $C_{\\max}$ 与负实轴截距除以极值谱因子 4 成比例。\n\n5) 数值与四舍五入。\n\n四舍五入到四位有效数字：\n- $C_{\\max,\\mathrm{up}}^{\\mathrm{(RK2)}} = 1/2 = 0.5000$,\n- $C_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}} \\approx 0.6282$,\n- $C_{\\max,\\mathrm{c}}^{\\mathrm{(RK2)}} = 0.0000$,\n- $C_{\\max,\\mathrm{c}}^{\\mathrm{(RK3)}} = \\sqrt{3} \\approx 1.732$.\n\n所要求的行矩阵，按指定顺序为\n$$\n\\bigl[C_{\\max,\\mathrm{up}}^{\\mathrm{(RK2)}},\\; C_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}},\\; C_{\\max,\\mathrm{c}}^{\\mathrm{(RK2)}},\\; C_{\\max,\\mathrm{c}}^{\\mathrm{(RK3)}}\\bigr].\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0.5000  0.6282  0.0000  1.732\\end{pmatrix}}$$", "id": "3360952"}, {"introduction": "在求解稳态CFD问题时，我们常常希望兼顾高阶格式的精度与低阶格式的鲁棒性。缺陷校正法（Defect-Correction）正是一种实现此目标的优雅迭代策略。本练习将引导您设计并分析一个结合了一阶迎风格式的稳定性和二阶迎风格式精度的缺陷校正迭代。您将通过理论分析推导出最优的松弛因子以加速收敛，并通过编程实践来验证该方法相比于朴素迭代在收敛速度上的显著优势。[@problem_id:3361016]", "problem": "考虑计算流体动力学 (CFD) 中的稳态一维线性平流方程，其速度为常数正值 $a$，定义在长度为 $L$ 的周期性域上，由 $a \\,\\partial \\phi / \\partial x = s(x)$ 给出，其中 $s(x)$ 是一个已知的源项。在一个间距为 $h = L/N$、节点为 $x_i = i h$（其中 $i \\in \\{0,1,\\dots,N-1\\}$）的均匀网格上，令 $L_1$ 表示 $a \\,\\partial \\phi / \\partial x$ 的一阶迎风（后向）离散格式，令 $L_2$ 表示二阶迎风（后向）离散格式。对于 $a>0$ 的情况，在一个均匀网格上，算子 $L_1$ 和 $L_2$ 在节点 $i$ 上的作用为 $L_1 \\phi_i = \\dfrac{a}{h}(\\phi_i - \\phi_{i-1})$ 和 $L_2 \\phi_i = \\dfrac{a}{2h}\\big(3 \\phi_i - 4 \\phi_{i-1} + \\phi_{i-2}\\big)$，其中模板索引采用周期性规则。您将设计并分析一种缺陷修正（也称为延迟修正）策略，该策略将 $L_1$ 与一个由 $L_2$ 构成的修正项相结合，并研究其对于稳态求解的线性稳定性和收敛加速效果。\n\n您的任务是：\n\n$1.$ 从以上定义出发，推导一个缺陷修正定点迭代格式，该格式的目标是二阶迎风稳态解 $L_2 \\phi = b$，其中 $b$ 是 $s(x)$ 的离散化。在第 $k$ 次迭代中，通过求解以下线性系统来定义一个临时更新量 $\\phi^{k+1,\\sharp}$：\n$$\nL_1 \\,\\phi^{k+1,\\sharp} \\;=\\; b \\;-\\;\\big(L_2 \\phi^k - L_1 \\phi^k\\big).\n$$\n然后应用欠松弛（松弛因子为 $\\alpha \\in (0,2)$）得到：\n$$\n\\phi^{k+1} \\;=\\; (1-\\alpha)\\,\\phi^k \\;+\\; \\alpha\\,\\phi^{k+1,\\sharp}.\n$$\n证明误差 $e^k = \\phi^k - \\phi^\\star$（其中 $\\phi^\\star$ 满足 $L_2 \\phi^\\star = b$）遵循以下齐次线性迭代关系：\n$$\ne^{k+1} \\;=\\; \\Big(I \\;-\\; \\alpha\\, L_1^{-1} L_2\\Big)\\, e^k,\n$$\n假设 $L_1$ 在与常数正交的子空间上是非奇异的。\n\n$2.$ 在均匀周期性网格上进行 von Neumann（傅里叶）线性稳定性分析。对于傅里叶模式 $\\phi_i = \\exp(\\mathrm{i}\\,i\\,\\theta)$，其中 $\\theta \\in [0,2\\pi)$（单位为弧度），分别计算 $L_1$ 和 $L_2$ 的符号（symbol）$\\lambda_1(\\theta)$ 和 $\\lambda_2(\\theta)$，并推导误差放大因子：\n$$\ng(\\theta,\\alpha) \\;=\\; 1 \\;-\\; \\alpha\\, \\frac{\\lambda_2(\\theta)}{\\lambda_1(\\theta)}.\n$$\n确定谱半径 $\\rho(\\alpha) = \\max_{\\theta \\in [0,2\\pi)} |g(\\theta,\\alpha)|$ 的闭式解。\n\n$3.$ 使用您得到的 $\\rho(\\alpha)$ 的闭式表达式，确定能使 $\\rho(\\alpha)$ 最小化的最优松弛因子 $\\alpha_{\\mathrm{opt}} \\in (0,2)$ 以及相应的最小谱半径 $\\rho_{\\mathrm{opt}} = \\rho(\\alpha_{\\mathrm{opt}})$。\n\n$4.$ 为一个制造的稳态问题实现缺陷修正方法，该问题具有周期性源项 $s(x) = \\sin(2\\pi x/L)$、速度 $a=1$ 和域长度 $L=1$。使用包含 $N=128$ 个节点的均匀网格。为了消除周期性平流问题中与常数相关的零空间，通过将每个线性系统的第一行替换为单位行并将 $b$ 的第一个元素置零来施加约束 $\\phi_0=0$。求解二阶迎风离散系统 $L_2 \\phi^\\star = b$（使用相同约束）以获得参考解 $\\phi^\\star$，并从 $\\phi^0 \\equiv 0$ 开始进行缺陷修正迭代。对于每个选定的 $\\alpha$，计算使误差的欧几里得范数满足以下条件所需的迭代次数：\n$$\n\\frac{\\|\\phi^k - \\phi^\\star\\|_2}{\\|\\phi^0 - \\phi^\\star\\|_2} \\;\\le\\; 10^{-8}.\n$$\n\n$5.$ 测试套件和要求输出：\n- 测试 A (happy path): 计算 $\\alpha = 0.8$ 时的 $\\rho(\\alpha)$，并以浮点数形式报告，保留 $6$ 位小数。\n- 测试 B (boundary case): 计算 $\\alpha = 1.0$ 时的 $\\rho(\\alpha)$，并以浮点数形式报告，保留 $6$ 位小数。\n- 测试 C (optimal design): 计算 $\\alpha_{\\mathrm{opt}}$ 和 $\\rho_{\\mathrm{opt}}$，并以列表 $[\\alpha_{\\mathrm{opt}}, \\rho_{\\mathrm{opt}}]$ 的形式报告该对数值，每个条目保留 $6$ 位小数。\n- 测试 D (algorithmic convergence): 对于 $N=128$, $L=1$, $a=1$, $s(x)=\\sin(2\\pi x/L)$ 并施加约束 $\\phi_0=0$ 的情况，从 $\\phi^0=0$ 开始运行缺陷修正格式，并以列表 $[n_{1.0}, n_{\\alpha_{\\mathrm{opt}}}]$ 的形式报告迭代次数，其中 $n_{1.0}$ 是 $\\alpha=1.0$ 时的次数，$n_{\\alpha_{\\mathrm{opt}}}$ 是 $\\alpha=\\alpha_{\\mathrm{opt}}$ 时的次数。\n\n您的程序应生成单行输出，包含以逗号分隔并用方括号括起来的结果（例如，\"[resultA,resultB,[alpha_opt,rho_opt],[n1,n2]]\"）。所有角度必须以弧度处理。最终答案中不需要物理单位。所有报告的浮点数必须四舍五入到 $6$ 位小数。输出类型必须严格按照上述规定为浮点数、浮点数列表或整数列表，不得打印任何其他文本。", "solution": "用户提供的问题是偏微分方程数值分析领域一个有效、包含多个部分的的练习。每个部分都将得到系统性的解答。\n\n### 第 1 部分：误差迭代的推导\n\n缺陷修正格式由两个方程定义。首先，通过求解以下方程计算一个临时更新量 $\\phi^{k+1,\\sharp}$：\n$$\nL_1 \\,\\phi^{k+1,\\sharp} \\;=\\; b \\;-\\;\\big(L_2 \\phi^k - L_1 \\phi^k\\big)\n$$\n其次，通过欠松弛得到新的迭代值 $\\phi^{k+1}$：\n$$\n\\phi^{k+1} \\;=\\; (1-\\alpha)\\,\\phi^k \\;+\\; \\alpha\\,\\phi^{k+1,\\sharp}\n$$\n其中 $\\alpha \\in (0,2)$ 是松弛因子。我们假设算子 $L_1$ 在相关函数空间上是可逆的，这使我们能够写出 $\\phi^{k+1,\\sharp} = L_1^{-1} \\left( b - (L_2 - L_1)\\phi^k \\right)$。将其代入第二个方程，得到：\n$$\n\\phi^{k+1} = (1-\\alpha)\\phi^k + \\alpha L_1^{-1} \\left( b - L_2\\phi^k + L_1\\phi^k \\right)\n$$\n展开各项，我们得到：\n$$\n\\phi^{k+1} = \\phi^k - \\alpha\\phi^k + \\alpha L_1^{-1}b - \\alpha L_1^{-1}L_2\\phi^k + \\alpha L_1^{-1}L_1\\phi^k\n$$\n由于 $L_1^{-1}L_1 = I$（单位算子），上式可简化为：\n$$\n\\phi^{k+1} = \\phi^k + \\alpha L_1^{-1}b - \\alpha L_1^{-1}L_2\\phi^k\n$$\n$$\n\\phi^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)\\phi^k + \\alpha L_1^{-1}b\n$$\n这就是解向量 $\\phi^k$ 的更新规则。为了找到误差 $e^k = \\phi^k - \\phi^\\star$ 的更新规则，我们在等式两边同时减去精确解 $\\phi^\\star$。精确解满足 $L_2\\phi^\\star = b$。\n$$\n\\phi^{k+1} - \\phi^\\star = \\left(I - \\alpha L_1^{-1}L_2\\right)\\phi^k + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n代入 $\\phi^{k+1} - \\phi^\\star = e^{k+1}$ 和 $\\phi^k = e^k + \\phi^\\star$：\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)(e^k + \\phi^\\star) + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k + \\left(I - \\alpha L_1^{-1}L_2\\right)\\phi^\\star + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k + \\phi^\\star - \\alpha L_1^{-1}L_2\\phi^\\star + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k - \\alpha L_1^{-1}(L_2\\phi^\\star) + \\alpha L_1^{-1}b\n$$\n利用性质 $L_2\\phi^\\star = b$，最后两项相互抵消：\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k - \\alpha L_1^{-1}b + \\alpha L_1^{-1}b\n$$\n这就得到了我们所期望的误差齐次线性迭代关系：\n$$\ne^{k+1} \\;=\\; \\Big(I \\;-\\; \\alpha\\, L_1^{-1} L_2\\Big)\\, e^k\n$$\n矩阵 $G = I - \\alpha L_1^{-1}L_2$ 是迭代矩阵，其谱半径决定了该方法的收敛性。假设 $L_1$ 在与常数正交的子空间上是非奇异的，这一点至关重要，因为周期性平流算子的零空间包含常数函数，必须处理好这一点才能使逆 $L_1^{-1}$ 有良好定义。\n\n### 第 2 部分：Von Neumann 稳定性分析\n\n我们通过考虑单个傅里叶模式 $\\phi_j = \\exp(\\mathrm{i}\\,j\\,\\theta)$ 来分析均匀周期性网格上的迭代，其中 $j$ 是网格索引，$\\theta \\in [0, 2\\pi)$ 是无量纲波数。像 $L_1$ 或 $L_2$ 这样的线性、平移不变算子作用于此模式的结果，是将其乘以一个复数，即该算子的符号（symbol）。\n\n一阶迎风算子 $L_1\\phi_j = \\frac{a}{h}(\\phi_j - \\phi_{j-1})$ 的符号是：\n$$\n\\lambda_1(\\theta) = \\frac{a}{h} (1 - e^{-\\mathrm{i}\\theta})\n$$\n二阶迎风算子 $L_2\\phi_j = \\frac{a}{2h}(3\\phi_j - 4\\phi_{j-1} + \\phi_{j-2})$ 的符号是：\n$$\n\\lambda_2(\\theta) = \\frac{a}{2h} (3 - 4e^{-\\mathrm{i}\\theta} + e^{-2\\mathrm{i}\\theta})\n$$\n$\\lambda_2(\\theta)$ 中的二次项可以因式分解：$e^{-2\\mathrm{i}\\theta} - 4e^{-\\mathrm{i}\\theta} + 3 = (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)$。所以：\n$$\n\\lambda_2(\\theta) = \\frac{a}{2h} (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)\n$$\n误差放大因子 $g(\\theta, \\alpha)$ 是迭代矩阵 $G$ 的符号。对于一个傅里叶模式，其表达式为：\n$$\ng(\\theta, \\alpha) = 1 - \\alpha \\frac{\\lambda_2(\\theta)}{\\lambda_1(\\theta)}\n$$\n我们计算符号的比值：\n$$\n\\frac{\\lambda_2(\\theta)}{\\lambda_1(\\theta)} = \\frac{\\frac{a}{2h} (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)}{\\frac{a}{h} (1 - e^{-\\mathrm{i}\\theta})} = \\frac{\\frac{a}{2h} (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)}{-\\frac{a}{h} (e^{-\\mathrm{i}\\theta}-1)} = -\\frac{1}{2}(e^{-\\mathrm{i}\\theta}-3) = \\frac{1}{2}(3 - e^{-\\mathrm{i}\\theta})\n$$\n该比值在 $\\theta \\ne 0$（即 $\\lambda_1(\\theta) \\ne 0$）时有效。将其代回 $g(\\theta, \\alpha)$ 的表达式中：\n$$\ng(\\theta, \\alpha) = 1 - \\frac{\\alpha}{2}(3 - e^{-\\mathrm{i}\\theta}) = \\left(1 - \\frac{3\\alpha}{2}\\right) + \\frac{\\alpha}{2}e^{-\\mathrm{i}\\theta}\n$$\n该表达式描述了复平面上的一个圆，其圆心为 $C = 1 - \\frac{3\\alpha}{2}$，半径为 $R = \\frac{\\alpha}{2}$（因为 $\\alpha>0$）。谱半径 $\\rho(\\alpha)$ 是 $|g(\\theta, \\alpha)|$ 在所有 $\\theta \\in [0, 2\\pi)$ 上的最大模。这发生在圆上的点离原点最远时，其值为圆心到原点的距离与半径之和：\n$$\n\\rho(\\alpha) = \\max_{\\theta \\in [0, 2\\pi)} |g(\\theta, \\alpha)| = |C| + R = \\left|1 - \\frac{3\\alpha}{2}\\right| + \\frac{\\alpha}{2}\n$$\n\n### 第 3 部分：最优松弛因子\n\n我们旨在找到一个 $\\alpha_{\\mathrm{opt}} \\in (0,2)$ 来最小化 $\\rho(\\alpha) = \\left|1 - \\frac{3\\alpha}{2}\\right| + \\frac{\\alpha}{2}$。该函数的行为在绝对值内部参数为零处发生变化，即 $1 - \\frac{3\\alpha}{2} = 0$，这给出 $\\alpha = 2/3$。我们在两个区间内分析 $\\rho(\\alpha)$。\n\n情况 1：$0  \\alpha \\le 2/3$。在此区间内，$1 - \\frac{3\\alpha}{2} \\ge 0$。\n$$\n\\rho(\\alpha) = \\left(1 - \\frac{3\\alpha}{2}\\right) + \\frac{\\alpha}{2} = 1 - \\frac{2\\alpha}{2} = 1 - \\alpha\n$$\n这是 $\\alpha$ 的一个线性递减函数。它在此区间内的最小值在 $\\alpha = 2/3$ 处取得，值为 $\\rho(2/3) = 1 - 2/3 = 1/3$。\n\n情况 2：$2/3  \\alpha  2$。在此区间内，$1 - \\frac{3\\alpha}{2}  0$。\n$$\n\\rho(\\alpha) = -\\left(1 - \\frac{3\\alpha}{2}\\right) + \\frac{\\alpha}{2} = -1 + \\frac{3\\alpha}{2} + \\frac{\\alpha}{2} = -1 + \\frac{4\\alpha}{2} = 2\\alpha - 1\n$$\n这是 $\\alpha$ 的一个线性递增函数。它在此区间内的最小值在 $\\alpha \\to (2/3)^+$ 时趋近，其值为 $\\lim_{\\alpha\\to(2/3)^+} (2\\alpha-1) = 4/3 - 1 = 1/3$。\n\n$\\rho(\\alpha)$ 在 $\\alpha \\in (0,2)$ 上的全局最小值位于两个线性段相交的点。因此，最优松弛因子和相应的最小谱半径为：\n$$\n\\alpha_{\\mathrm{opt}} = \\frac{2}{3}\n$$\n$$\n\\rho_{\\mathrm{opt}} = \\rho(\\alpha_{\\mathrm{opt}}) = \\frac{1}{3}\n$$\n\n### 第 4 部分：数值结果与分析\n\n基于推导出的公式，我们可以计算所需的理论值。缺陷修正算法的实现将提供迭代次数。\n\n对于测试 A，当 $\\alpha = 0.8$ 时，我们处于第二种情况（$0.8 > 2/3$）。谱半径为：\n$$\n\\rho(0.8) = 2(0.8) - 1 = 1.6 - 1 = 0.6\n$$\n\n对于测试 B，当 $\\alpha = 1.0$ 时，我们也处于第二种情况（$1.0 > 2/3$）。谱半径为：\n$$\n\\rho(1.0) = 2(1.0) - 1 = 1.0\n$$\n谱半径为 $1$ 表明对于某些误差模式（在这种情况下是高频模式），迭代将不会收敛。\n\n对于测试 C，最优值已在第 3 部分中找到：\n$$\n\\alpha_{\\mathrm{opt}} = 2/3 \\approx 0.666667, \\quad \\rho_{\\mathrm{opt}} = 1/3 \\approx 0.333333\n$$\n\n对于测试 D，根据问题规范进行数值模拟。为算子 $L_1$ 和 $L_2$ 构建矩阵，参数为 $N=128$, $L=1$ 和 $a=1$，并包含周期性边界条件。为确保线性系统非奇异，通过修改矩阵和右端向量来施加约束 $\\phi_0=0$。通过求解带约束的二阶系统来计算参考解 $\\phi^\\star$。然后，从 $\\phi^0=0$ 开始，分别对 $\\alpha=1.0$ 和 $\\alpha=\\alpha_{\\mathrm{opt}}=2/3$ 运行缺陷修正迭代，直到相对误差范数小于 $10^{-8}$。记录迭代次数。尽管 $\\rho(1.0)=1.0$ 预测了最坏情况误差的不收敛性，但该特定问题的误差是光滑的（由源项 $s(x)$ 的低波数模式主导），对于这种误差，放大因子 $|g(\\theta, 1.0)|$ 很小，从而导致快速收敛。相反地，$\\alpha_{\\mathrm{opt}}$ 是为最坏情况（高频）误差而优化的，对于光滑误差而言是次优的，因此对于这个特定问题会导致更多的迭代次数。最终答案中的数值实现计算了这些次数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multi-part CFD problem.\n    1. Computes theoretical spectral radii rho(alpha) for given alpha.\n    2. Computes the optimal relaxation alpha_opt and rho_opt.\n    3. Implements the defect-correction scheme to find iteration counts for convergence.\n    \"\"\"\n\n    # --- Part 3 Analytical Results ---\n    alpha_opt_val = 2.0 / 3.0\n    rho_opt_val = 1.0 / 3.0\n\n    # --- Test A: rho(0.8) ---\n    alpha_A = 0.8\n    # Since alpha_A > 2/3, use rho(alpha) = 2*alpha - 1\n    rho_A = round(2 * alpha_A - 1, 6)\n\n    # --- Test B: rho(1.0) ---\n    alpha_B = 1.0\n    # Since alpha_B > 2/3, use rho(alpha) = 2*alpha - 1\n    rho_B = round(2 * alpha_B - 1, 6)\n    \n    # --- Test C: [alpha_opt, rho_opt] ---\n    alpha_opt_rounded = round(alpha_opt_val, 6)\n    rho_opt_rounded = round(rho_opt_val, 6)\n    result_C = [alpha_opt_rounded, rho_opt_rounded]\n\n    # --- Test D: Iteration Counts ---\n    # Setup problem parameters\n    N = 128\n    L = 1.0\n    a = 1.0\n    h = L / N\n\n    # Construct operator matrices\n    M1 = np.zeros((N, N))\n    M2 = np.zeros((N, N))\n    for i in range(N):\n        # L1 operator\n        M1[i, i] = a / h\n        M1[i, (i - 1 + N) % N] = -a / h\n        # L2 operator\n        M2[i, i] = 3 * a / (2 * h)\n        M2[i, (i - 1 + N) % N] = -4 * a / (2 * h)\n        M2[i, (i - 2 + N) % N] = a / (2 * h)\n\n    # Define source term vector\n    x = np.arange(N) * h\n    b = np.sin(2 * np.pi * x / L)\n\n    def apply_constraint(M, f):\n        \"\"\"Modifies a matrix and a vector to enforce the phi_0=0 constraint.\"\"\"\n        M_mod = M.copy()\n        f_mod = f.copy()\n        M_mod[0, :] = 0.0\n        M_mod[0, 0] = 1.0\n        f_mod[0] = 0.0\n        return M_mod, f_mod\n\n    # Solve for the reference solution phi_star\n    M2_mod, b_mod = apply_constraint(M2, b)\n    phi_star = np.linalg.solve(M2_mod, b_mod)\n\n    def count_iterations(alpha, M1, M2, b, phi_star):\n        \"\"\"Runs the defect-correction iteration and counts steps to convergence.\"\"\"\n        phi_k = np.zeros(N)\n        initial_error_norm = np.linalg.norm(phi_k - phi_star)\n        \n        if initial_error_norm  1e-15:\n            return 0\n        \n        M1_mod, _ = apply_constraint(M1, b) # Constrained L1 matrix for solver\n        M_diff = M2 - M1\n\n        # Max iterations to prevent infinite loop\n        max_iter = 500\n        for k in range(1, max_iter + 1):\n            # Calculate defect correction RHS\n            d_k = b - M_diff @ phi_k\n            \n            # Apply constraint to RHS\n            d_k[0] = 0.0\n            \n            # Solve for provisional update\n            phi_k_sharp = np.linalg.solve(M1_mod, d_k)\n            \n            # Apply relaxation\n            phi_k_next = (1 - alpha) * phi_k + alpha * phi_k_sharp\n            phi_k = phi_k_next\n\n            # Check for convergence\n            current_error_norm = np.linalg.norm(phi_k - phi_star)\n            if (current_error_norm / initial_error_norm) = 1e-8:\n                return k\n        return -1 # Indicate failure to converge\n\n    n_1_0 = count_iterations(1.0, M1, M2, b, phi_star)\n    n_alpha_opt = count_iterations(alpha_opt_val, M1, M2, b, phi_star)\n    result_D = [n_1_0, n_alpha_opt]\n\n    # --- Format and Print Final Output ---\n    # Construct the final list of results\n    final_results = [rho_A, rho_B, result_C, result_D]\n\n    # Custom string formatting to match the required output style\n    # [float,float,[float,float],[int,int]]\n    result_strings = [\n        f\"{final_results[0]:.6f}\",\n        f\"{final_results[1]:.6f}\",\n        f\"[{final_results[2][0]},{final_results[2][1]}]\",\n        f\"[{final_results[3][0]},{final_results[3][1]}]\"\n    ]\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```", "id": "3361016"}]}