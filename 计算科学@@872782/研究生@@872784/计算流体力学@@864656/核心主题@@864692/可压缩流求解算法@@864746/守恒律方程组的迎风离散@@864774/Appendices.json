{"hands_on_practices": [{"introduction": "对于守恒律方程组，迎风格式的精髓在于其能够根据信息的物理传播方向进行离散。这一过程的基础是对控制方程组进行特征分解。本练习将通过一个简单的线性双曲系统，引导您实践计算系统的特征值和特征向量，这是构建任何基于特征的数值格式（如Roe格式或精确黎曼求解器）的出发点。掌握这个核心代数技能，是理解和开发高级数值方法的第一步 [@problem_id:3386349]。", "problem": "考虑一维空间中的线性双曲守恒律系统，由 $U_{t}+A\\,U_{x}=0$ 给出，其中 $U(x,t)\\in\\mathbb{R}^{2}$ 且 $A\\in\\mathbb{R}^{2\\times 2}$ 是一个常数矩阵。在系统的迎风离散化中，使用特征分解来解耦各个场，并沿着波的传播方向定向数值耗散。特征变换定义为 $U=R\\,W$，其中 $R$ 汇集了 $A$ 的右特征向量，$W$ 是特征变量，其对角化形式为 $A=R\\,\\Lambda\\,R^{-1}$，并且 $\\Lambda=\\operatorname{diag}(\\lambda_{1},\\lambda_{2})$ 包含特征值。从特征值的基本定义（即特征多项式 $\\det(A-\\lambda I)=0$ 的根）和右特征向量的定义（即 $(A-\\lambda I)\\,r=0$ 的非平凡解）出发，为特定矩阵\n$$\nA=\\begin{pmatrix}\n2  1\\\\\n0  1\n\\end{pmatrix}.\n$$\n计算这些对象。对特征值进行排序，使得 $\\lambda_{1}\\lambda_{2}$。为消除缩放模糊性并使结果唯一，施加以下归一化约定：选择与 $\\lambda_{1}$ 关联的右特征向量 $r_{1}$，使其第一个分量为 $1$；选择与 $\\lambda_{2}$ 关联的右特征向量 $r_{2}$，使其第二个分量为 $1$。组合特征矩阵 $R=[r_{1}\\;r_{2}]$ 及其逆矩阵 $R^{-1}$，并与对角化 $A=R\\,\\Lambda\\,R^{-1}$ 保持一致。\n\n将你的最终答案以单个解析表达式的形式提供，格式化为一个行矩阵，按顺序包含：两个特征值 $\\lambda_{1}$ 和 $\\lambda_{2}$，两个右特征向量 $r_{1}$ 和 $r_{2}$ (每个都是 $2\\times 1$ 的列向量)，矩阵 $R$ 和矩阵 $R^{-1}$。无需四舍五入，也不涉及物理单位。", "solution": "该问题要求计算给定矩阵 $A$ 的特征值、特征向量以及特征矩阵 $R$ 和 $R^{-1}$。系统由方程 $U_{t}+A\\,U_{x}=0$ 控制，其中矩阵 $A$ 指定为\n$$\nA=\\begin{pmatrix}\n2  1\\\\\n0  1\n\\end{pmatrix}.\n$$\n特征值 $\\lambda$ 是特征方程 $\\det(A-\\lambda I)=0$ 的根，其中 $I$ 是 $2 \\times 2$ 的单位矩阵。\n\n首先，我们构造矩阵 $A-\\lambda I$：\n$$\nA-\\lambda I = \\begin{pmatrix}\n2  1\\\\\n0  1\n\\end{pmatrix} - \\lambda \\begin{pmatrix}\n1  0\\\\\n0  1\n\\end{pmatrix} = \\begin{pmatrix}\n2-\\lambda  1\\\\\n0  1-\\lambda\n\\end{pmatrix}.\n$$\n该矩阵的行列式为\n$$\n\\det(A-\\lambda I) = (2-\\lambda)(1-\\lambda) - (1)(0) = (2-\\lambda)(1-\\lambda).\n$$\n将行列式设为零，$(2-\\lambda)(1-\\lambda) = 0$，得出特征值 $\\lambda = 2$ 和 $\\lambda = 1$。问题指定了排序约定 $\\lambda_{1}  \\lambda_{2}$。因此，我们有\n$$\n\\lambda_{1} = 2, \\quad \\lambda_{2} = 1.\n$$\n对应的特征值对角矩阵为\n$$\n\\Lambda = \\begin{pmatrix}\n\\lambda_{1}  0\\\\\n0  \\lambda_{2}\n\\end{pmatrix} = \\begin{pmatrix}\n2  0\\\\\n0  1\n\\end{pmatrix}.\n$$\n接下来，我们通过对每个特征值求解方程 $(A-\\lambda I)r=0$ 来确定右特征向量 $r_1$ 和 $r_2$。\n\n对于第一个特征值 $\\lambda_{1} = 2$，方程为 $(A-2I)r_{1}=0$：\n$$\n\\begin{pmatrix}\n2-2  1\\\\\n0  1-2\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{1}\\\\\ny_{1}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0  1\\\\\n0  -1\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{1}\\\\\ny_{1}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0\\\\\n0\n\\end{pmatrix}.\n$$\n这个矩阵方程导出一个独立的方程 $y_{1}=0$。分量 $x_{1}$ 是一个自由变量。因此，任何对应于 $\\lambda_{1}=2$ 的特征向量形式为 $k \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，其中 $k$ 是任意非零标量。问题施加了归一化条件，即 $r_{1}$ 的第一个分量必须为 $1$。这使得 $x_{1}=1$（且 $k=1$），从而得出唯一的特征向量\n$$\nr_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.\n$$\n对于第二个特征值 $\\lambda_{2} = 1$，方程为 $(A-1I)r_{2}=0$：\n$$\n\\begin{pmatrix}\n2-1  1\\\\\n0  1-1\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{2}\\\\\ny_{2}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1  1\\\\\n0  0\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{2}\\\\\ny_{2}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0\\\\\n0\n\\end{pmatrix}.\n$$\n这个矩阵方程导出的方程为 $x_{2}+y_{2}=0$，可以写成 $x_{2}=-y_{2}$。因此，$\\lambda_{2}=1$ 的任何特征向量的形式为 $k \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$，其中 $k$ 是任意非零标量。问题施加了归一化条件，即 $r_{2}$ 的第二个分量必须为 $1$。这使得 $y_{2}=1$（且 $k=1$），这意味着 $x_{2}=-1$。唯一的特征向量是\n$$\nr_{2} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}.\n$$\n矩阵 $R$ 是通过将特征向量 $r_{1}$ 和 $r_{2}$ 作为其列构成的，$R = [r_{1}\\;r_{2}]$：\n$$\nR = \\begin{pmatrix}\n1  -1\\\\\n0  1\n\\end{pmatrix}.\n$$\n为了求逆矩阵 $R^{-1}$，我们可以使用 $2 \\times 2$ 矩阵的逆矩阵公式：如果 $M = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$，则 $M^{-1} = \\frac{1}{ad-bc} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$。对于矩阵 $R$，我们有 $a=1, b=-1, c=0, d=1$。其行列式为 $\\det(R) = (1)(1) - (-1)(0) = 1$。那么逆矩阵是\n$$\nR^{-1} = \\frac{1}{1} \\begin{pmatrix}\n1  -(-1) \\\\\n-0  1\n\\end{pmatrix} = \\begin{pmatrix}\n1  1 \\\\\n0  1\n\\end{pmatrix}.\n$$\n计算出的对象的完整集合包括特征值 $\\lambda_{1}=2$ 和 $\\lambda_{2}=1$，特征向量 $r_{1}=\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 和 $r_{2}=\\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$，以及矩阵 $R=\\begin{pmatrix} 1  -1 \\\\ 0  1 \\end{pmatrix}$ 和 $R^{-1}=\\begin{pmatrix} 1  1 \\\\ 0  1 \\end{pmatrix}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2   1  \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}  \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}  \\begin{pmatrix} 1  -1 \\\\ 0  1 \\end{pmatrix}  \\begin{pmatrix} 1  1 \\\\ 0  1 \\end{pmatrix}\n\\end{pmatrix}\n}\n$$", "id": "3386349"}, {"introduction": "在开发显式时间积分的计算流体动力学（CFD）求解器时，确保数值稳定性是首要任务。著名的Courant-Friedrichs-Lewy（CFL）条件为此提供了理论指导，它将时间步长 $\\Delta t$ 与特征波在网格中的传播速度联系起来。本实践任务要求您将这一理论应用于二维欧拉方程，根据每个计算单元面上的最大特征波速来计算一个稳定的时间步长。完成此练习将使您掌握在几乎所有显式双曲求解器中都至关重要的稳定性控制核心技术 [@problem_id:3386359]。", "problem": "给定单个计算单元及其边界面上的局部二维可压缩欧拉方程数据，并计划在守恒律系统的迎风有限体积离散化中使用 Harten–Lax–van Leer–Contact (HLLC) 通量。您的任务是计算一个稳定的单元时间步长 $\\,\\Delta t\\,$，该步长需满足基于跨越单元边界面投影的最大特征速度的 Courant–Friedrichs–Lewy (CFL) 条件。计算必须完全从第一性原理出发：利用二维欧拉系统沿每个边界面外向单位法线的本征结构来界定穿过该边界面的最快信息传播速度，然后汇总这些界限，从而为该单元获得一个可证明稳定的显式时间步长。\n\n仅使用以下物理和数值数据，所有数据均以国际单位制（SI 单位）表示：\n- 比热容比 $\\,\\gamma\\,$（无量纲）。\n- Courant–Friedrichs–Lewy 数（CFL 数），记为 $\\,\\mathrm{CFL}\\,$（无量纲）。\n- 单元度量 $\\,V\\,$，对于二维计算，这是以平方米（$\\mathrm{m}^2$）为单位的单元面积。\n- 对于单元的每个边界面 $\\,f\\,$：\n  - 边界面度量 $\\,A_f\\,$，对于二维计算，这是以米（$\\mathrm{m}$）为单位的边界面长度。\n  - 外向单位法向量 $\\,\\mathbf{n}_f = (n_x,n_y)\\,$。\n  - 位于边界面单元一侧的左状态 $\\,(\\rho_L, u_L, v_L, p_L)\\,$，其中密度单位为千克/立方米（$\\mathrm{kg}/\\mathrm{m}^3$），速度分量单位为米/秒（$\\mathrm{m}/\\mathrm{s}$），压力单位为帕斯卡（$\\mathrm{Pa}$）。\n  - 位于边界面相邻单元一侧的右状态 $\\,(\\rho_R, u_R, v_R, p_R)\\,$，单位相同。\n\n科学和数值要求：\n- 您的推理应基于二维可压缩欧拉方程的守恒形式以及该系统的双曲特性。使用沿 $\\,\\mathbf{n}_f\\,$ 投影的通量雅可比矩阵的特征值来确定垂直于每个边界面的特征速度。\n- 使用一个与 HLLC 构造一致的、对最快左行和右行信号的稳健且物理上合理的界限，来确定每个边界面上穿过该边界面的特征速度的最大量值。\n- 综合所有边界面的贡献，以秒（$\\mathrm{s}$）为单位，为单元获得一个稳定的显式时间步长。将每个得到的 $\\,\\Delta t\\,$ 值表示为四舍五入到十位小数的浮点数。\n\n您的程序必须产生单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如，`[result1,result2,result3,result4]`。列表中的条目必须是每个测试用例的稳定时间步长 $\\,\\Delta t\\,$（单位：秒），并精确到小数点后十位。\n\n测试套件：\n为以下四个案例中的每一个提供计算出的 $\\,\\Delta t\\,$。在所有案例中，法向量均为外向单位向量。\n\n1) 混合亚音速/超音速方向的正常情况：\n- $\\,\\gamma = 1.4\\,$，$\\,\\mathrm{CFL} = 0.5\\,$，$\\,V = 1.0\\,\\mathrm{m}^2\\,$。\n- 边界面：\n  - 东面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,100.0,0.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (0.8,150.0,0.0,80000.0)\\,$。\n  - 西面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (-1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,100.0,0.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.0,50.0,0.0,120000.0)\\,$。\n  - 北面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,100.0,0.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.2,100.0,20.0,110000.0)\\,$。\n  - 南面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,-1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,100.0,0.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (0.9,100.0,-10.0,90000.0)\\,$。\n\n2) 纯声学平衡状态：\n- $\\,\\gamma = 1.4\\,$，$\\,\\mathrm{CFL} = 0.9\\,$，$\\,V = 1.0\\,\\mathrm{m}^2\\,$。\n- 边界面：\n  - 东面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,0.0,0.0,200000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.0,0.0,0.0,200000.0)\\,$。\n  - 西面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (-1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,0.0,0.0,200000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.0,0.0,0.0,200000.0)\\,$。\n  - 北面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,0.0,0.0,200000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.0,0.0,0.0,200000.0)\\,$。\n  - 南面：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,-1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.0,0.0,0.0,200000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.0,0.0,0.0,200000.0)\\,$。\n\n3) 带有近乎退化边界面的斜向流动：\n- $\\,\\gamma = 1.4\\,$，$\\,\\mathrm{CFL} = 0.4\\,$，$\\,V = 0.75\\,\\mathrm{m}^2\\,$。\n- 边界面：\n  - 边界面 1：$\\,A_f = 1.0\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.866025403784,0.5)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (0.5,300.0,100.0,50000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (0.6,320.0,80.0,60000.0)\\,$。\n  - 边界面 2：$\\,A_f = 0.8\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (-1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (0.5,300.0,100.0,50000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (0.4,280.0,120.0,40000.0)\\,$。\n  - 边界面 3：$\\,A_f = 0.000001\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,-1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (0.5,300.0,100.0,50000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (0.55,290.0,90.0,55000.0)\\,$。\n\n4) 高速单原子气体：\n- $\\,\\gamma = 1.67\\,$，$\\,\\mathrm{CFL} = 0.6\\,$，$\\,V = 0.1\\,\\mathrm{m}^2\\,$。\n- 边界面：\n  - 东面：$\\,A_f = 0.4\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.2,800.0,50.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.0,850.0,40.0,90000.0)\\,$。\n  - 西面：$\\,A_f = 0.4\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (-1.0,0.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.2,800.0,50.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.3,780.0,60.0,110000.0)\\,$。\n  - 北面：$\\,A_f = 0.2\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.2,800.0,50.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.1,790.0,70.0,95000.0)\\,$。\n  - 南面：$\\,A_f = 0.2\\,\\mathrm{m}\\,$，$\\,\\mathbf{n}_f = (0.0,-1.0)\\,$，\n    左侧 $\\,(\\rho_L,u_L,v_L,p_L) = (1.2,800.0,50.0,100000.0)\\,$，\n    右侧 $\\,(\\rho_R,u_R,v_R,p_R) = (1.15,810.0,30.0,105000.0)\\,$。\n\n您的程序必须为这四个案例中的每一个计算以秒为单位的 $\\,\\Delta t\\,$，并以 `[dt_case1,dt_case2,dt_case3,dt_case4]` 的格式打印单行结果，其中每个 $\\,\\Delta t\\,$ 都四舍五入到十位小数。任何输入中均不使用角度；所有矢量都以笛卡尔分量明确给出。输出中不涉及百分比，只有代表秒的小数浮点数。", "solution": "该问题要求为二维可压缩欧拉方程的显式有限体积离散化计算一个稳定的时间步长 $\\Delta t$。稳定性约束基于 Courant–Friedrichs–Lewy (CFL) 条件，该条件确保数值依赖域包含物理依赖域。对于给定的计算单元，这意味着时间步长必须足够小，以确保信息在单步内传播的距离不超过相邻单元。\n\n控制方程为守恒形式的二维欧拉方程：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} + \\frac{\\partial \\mathbf{G}(\\mathbf{U})}{\\partial y} = 0\n$$\n其中 $\\mathbf{U}$ 是守恒变量矢量，$\\mathbf{F}$ 和 $\\mathbf{G}$ 是通量矢量：\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\rho v \\\\ E \\end{pmatrix}, \\quad\n\\mathbf{F} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ \\rho u v \\\\ u(E+p) \\end{pmatrix}, \\quad\n\\mathbf{G} = \\begin{pmatrix} \\rho v \\\\ \\rho uv \\\\ \\rho v^2 + p \\\\ v(E+p) \\end{pmatrix}\n$$\n单位体积总能量 $E$ 与压力 $p$、密度 $\\rho$ 和速度 $\\mathbf{u}=(u,v)$ 通过理想气体状态方程相关联：$E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho(u^2+v^2)$，其中 $\\gamma$ 是比热容比。\n\n对于有限体积法，我们考虑在面积为 $V$ 的单元上的积分形式。单元平均状态 $\\mathbf{U}_i$ 的半离散更新公式为：\n$$\n\\frac{d\\mathbf{U}_i}{dt} = -\\frac{1}{V} \\sum_{f \\in \\partial i} \\mathcal{F}_f A_f\n$$\n其中求和遍历单元的所有边界面，$A_f$ 是边界面 $f$ 的长度，$\\mathcal{F}_f$ 是垂直于该边界面的数值通量。对于显式时间推进格式（如前向欧拉法），稳定性由系统雅可比矩阵的特征值决定。单元 $i$ 稳定性的一个充分条件由下式给出：\n$$\n\\Delta t_i \\le \\mathrm{CFL} \\cdot \\frac{V_i}{\\sum_{f \\in \\partial i} S_{\\mathrm{max},f} A_f}\n$$\n这里，$\\mathrm{CFL}$ 是库朗数，$S_{\\mathrm{max},f}$ 是垂直于边界面 $f$ 的特征速度大小的一个上界。\n\n该问题要求基于欧拉方程的本征结构和 HLLC (Harten–Lax–van Leer–Contact) 黎曼求解器的原理来确定 $S_{\\mathrm{max},f}$。穿过一个边界面的通量由沿该边界面外向单位法向量 $\\mathbf{n}_f = (n_x, n_y)$ 定向的局部一维黎曼问题确定。沿方向 $\\mathbf{n}_f$ 投影的欧拉方程的特征速度（特征值）为 $u_n$、$u_n$、$u_n+a$ 和 $u_n-a$，其中 $u_n = \\mathbf{u} \\cdot \\mathbf{n}_f = u n_x + v n_y$ 是法向速度，$a = \\sqrt{\\gamma p / \\rho}$ 是声速。\n\nHLLC 求解器考虑边界面处的两个间断状态：一个左状态 $(\\rho_L, u_L, v_L, p_L)$ 和一个右状态 $(\\rho_R, u_R, v_R, p_R)$。为确保黎曼问题产生的所有波都被捕捉到，需要对最快的左行波速（$S_L$）和右行波速（$S_R$）进行稳健的估计。一个常用且可靠的选择（通常归功于 Davis）是：\n$$\nS_L = \\min(u_{n,L} - a_L, u_{n,R} - a_R)\n$$\n$$\nS_R = \\max(u_{n,L} + a_L, u_{n,R} + a_R)\n$$\n其中 $u_{n,K} = u_K n_x + v_K n_y$ 且 $a_K = \\sqrt{\\gamma p_K / \\rho_K}$，对于 $K \\in \\{L, R\\}$。穿过该边界面的最大信号传播速度就是这些波前速度绝对值的最大值，$S_{\\text{max}} = \\max(|S_L|, |S_R|)$。这可以被证明等价于：\n$$\nS_{\\mathrm{max},f} = \\max(|u_{n,L}|+a_L, |u_{n,R}|+a_R)\n$$\n该表达式为界面处通量雅可比矩阵的谱半径提供了一个保守界，使其成为确保数值稳定性的绝佳选择。\n\n因此，计算给定单元时间步长的算法如下：\n1. 初始化分母项 $\\Sigma = 0$。\n2. 对于单元的每个边界面 $f$：\n    a. 确定左右状态的流体属性 $(\\rho_K, u_K, v_K, p_K)$ 以及外向法向量 $\\mathbf{n}_f = (n_x, n_y)$。\n    b. 计算每个状态的法向速度：$u_{n,K} = u_K n_x + v_K n_y$。\n    c. 计算每个状态的声速：$a_K = \\sqrt{\\gamma p_K / \\rho_K}$。\n    d. 找到边界面的最大信号速度：$S_{\\mathrm{max},f} = \\max(|u_{n,L}|+a_L, |u_{n,R}|+a_R)$。\n    e. 将该边界面的贡献加到分母上：$\\Sigma = \\Sigma + A_f \\cdot S_{\\mathrm{max},f}$。\n3. 处理完所有边界面后，使用单元的全局数据（$\\mathrm{CFL}$ 数和面积 $V$）计算稳定的时间步长：\n$$\n\\Delta t = \\frac{\\mathrm{CFL} \\cdot V}{\\Sigma}\n$$\n将此程序应用于问题陈述中提供的每个测试用例。最终的数值按要求四舍五入到十位小数。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the stable time step for multiple CFD test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy-path mixed subsonic/supersonic directions\n        {\n            \"gamma\": 1.4, \"CFL\": 0.5, \"V\": 1.0,\n            \"faces\": [\n                {\"A_f\": 1.0, \"n_f\": (1.0, 0.0), \"left\": (1.0, 100.0, 0.0, 100000.0), \"right\": (0.8, 150.0, 0.0, 80000.0)},\n                {\"A_f\": 1.0, \"n_f\": (-1.0, 0.0), \"left\": (1.0, 100.0, 0.0, 100000.0), \"right\": (1.0, 50.0, 0.0, 120000.0)},\n                {\"A_f\": 1.0, \"n_f\": (0.0, 1.0), \"left\": (1.0, 100.0, 0.0, 100000.0), \"right\": (1.2, 100.0, 20.0, 110000.0)},\n                {\"A_f\": 1.0, \"n_f\": (0.0, -1.0), \"left\": (1.0, 100.0, 0.0, 100000.0), \"right\": (0.9, 100.0, -10.0, 90000.0)},\n            ]\n        },\n        # Case 2: Purely acoustic balanced state\n        {\n            \"gamma\": 1.4, \"CFL\": 0.9, \"V\": 1.0,\n            \"faces\": [\n                {\"A_f\": 1.0, \"n_f\": (1.0, 0.0), \"left\": (1.0, 0.0, 0.0, 200000.0), \"right\": (1.0, 0.0, 0.0, 200000.0)},\n                {\"A_f\": 1.0, \"n_f\": (-1.0, 0.0), \"left\": (1.0, 0.0, 0.0, 200000.0), \"right\": (1.0, 0.0, 0.0, 200000.0)},\n                {\"A_f\": 1.0, \"n_f\": (0.0, 1.0), \"left\": (1.0, 0.0, 0.0, 200000.0), \"right\": (1.0, 0.0, 0.0, 200000.0)},\n                {\"A_f\": 1.0, \"n_f\": (0.0, -1.0), \"left\": (1.0, 0.0, 0.0, 200000.0), \"right\": (1.0, 0.0, 0.0, 200000.0)},\n            ]\n        },\n        # Case 3: Oblique flow with a nearly degenerate face\n        {\n            \"gamma\": 1.4, \"CFL\": 0.4, \"V\": 0.75,\n            \"faces\": [\n                {\"A_f\": 1.0, \"n_f\": (0.866025403784, 0.5), \"left\": (0.5, 300.0, 100.0, 50000.0), \"right\": (0.6, 320.0, 80.0, 60000.0)},\n                {\"A_f\": 0.8, \"n_f\": (-1.0, 0.0), \"left\": (0.5, 300.0, 100.0, 50000.0), \"right\": (0.4, 280.0, 120.0, 40000.0)},\n                {\"A_f\": 0.000001, \"n_f\": (0.0, -1.0), \"left\": (0.5, 300.0, 100.0, 50000.0), \"right\": (0.55, 290.0, 90.0, 55000.0)},\n            ]\n        },\n        # Case 4: High-speed monatomic gas\n        {\n            \"gamma\": 1.67, \"CFL\": 0.6, \"V\": 0.1,\n            \"faces\": [\n                {\"A_f\": 0.4, \"n_f\": (1.0, 0.0), \"left\": (1.2, 800.0, 50.0, 100000.0), \"right\": (1.0, 850.0, 40.0, 90000.0)},\n                {\"A_f\": 0.4, \"n_f\": (-1.0, 0.0), \"left\": (1.2, 800.0, 50.0, 100000.0), \"right\": (1.3, 780.0, 60.0, 110000.0)},\n                {\"A_f\": 0.2, \"n_f\": (0.0, 1.0), \"left\": (1.2, 800.0, 50.0, 100000.0), \"right\": (1.1, 790.0, 70.0, 95000.0)},\n                {\"A_f\": 0.2, \"n_f\": (0.0, -1.0), \"left\": (1.2, 800.0, 50.0, 100000.0), \"right\": (1.15, 810.0, 30.0, 105000.0)},\n            ]\n        },\n    ]\n\n    results = []\n    for case_data in test_cases:\n        dt = calculate_dt(case_data)\n        results.append(f\"{dt:.10f}\")\n    \n    print(f\"[{','.join(results)}]\")\n\ndef calculate_dt(case_data):\n    \"\"\"\n    Computes the CFL-limited time step for a single computational cell.\n    \n    The time step is calculated based on the formula:\n    dt = CFL * V / sum(A_f * S_max_f)\n    where S_max_f = max(|u_n_L| + a_L, |u_n_R| + a_R)\n    \"\"\"\n    gamma = case_data['gamma']\n    CFL = case_data['CFL']\n    V = case_data['V']\n    faces = case_data['faces']\n\n    sum_AS_max = 0.0\n\n    for face in faces:\n        A_f = face['A_f']\n        n_f = np.array(face['n_f'])\n        \n        # Unpack left and right states\n        rho_L, u_L, v_L, p_L = face['left']\n        rho_R, u_R, v_R, p_R = face['right']\n\n        # Normal velocity for left state\n        vel_L = np.array([u_L, v_L])\n        u_n_L = np.dot(vel_L, n_f)\n        \n        # Speed of sound for left state\n        a_L = np.sqrt(gamma * p_L / rho_L)\n\n        # Normal velocity for right state\n        vel_R = np.array([u_R, v_R])\n        u_n_R = np.dot(vel_R, n_f)\n\n        # Speed of sound for right state\n        a_R = np.sqrt(gamma * p_R / rho_R)\n\n        # Maximum signal speed at the face\n        S_max_f = max(abs(u_n_L) + a_L, abs(u_n_R) + a_R)\n\n        # Accumulate the sum of (Area * Max_Speed) over all faces\n        sum_AS_max += A_f * S_max_f\n\n    # Calculate the final time step\n    if sum_AS_max > 0:\n        dt = CFL * V / sum_AS_max\n    else:\n        # This case (e.g., vacuum) would imply an infinite time step is stable.\n        dt = float('inf') \n        \n    return dt\n\nsolve()\n```", "id": "3386359"}, {"introduction": "许多真实世界的物理问题，例如在变化地形上流动的水体，都由包含源项的平衡律方程描述。对于这类问题，一个关键的挑战是数值格式必须能够精确地维持其物理平衡态，如“静湖”状态。本高级练习将引导您探索“适定平衡（well-balanced）”格式的概念，通过为带地形的浅水方程实现一种能够精确保持静止状态的数值格式，来验证其“C-性质”。这对于准确模拟受重力、地形等外部效应影响的流动至关重要 [@problem_id:3386316]。", "problem": "考虑带地形的一维浅水方程，写成守恒律系统的形式，\n$$\n\\partial_t \\mathbf{U}(x,t) + \\partial_x \\mathbf{F}(\\mathbf{U}(x,t)) = \\mathbf{S}(\\mathbf{U}(x,t),\\partial_x b(x)),\n$$\n其中守恒变量向量为 $\\mathbf{U} = \\begin{bmatrix} h \\\\ q \\end{bmatrix}$，其中 $h$ 是水深（单位：$\\mathrm{m}$），$q=h u$ 是流量（单位：$\\mathrm{m}^2/\\mathrm{s}$），通量为 $\\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} q \\\\ \\dfrac{q^2}{h} + \\dfrac{1}{2} g h^2 \\end{bmatrix}$，其中 $g$ 是重力加速度（单位：$\\mathrm{m}/\\mathrm{s}^2$），源项为 $\\mathbf{S}(\\mathbf{U},\\partial_x b) = \\begin{bmatrix} 0 \\\\ - g h \\,\\partial_x b \\end{bmatrix}$，其中 $b(x)$ 是河床高程（单位：$\\mathrm{m}$）。静湖平衡对应于速度为零 $u=0$（因此 $q=0$）和自由表面高程 $\\eta = h + b$ 为常数。\n\n从守恒律形式和静湖平衡出发，推导一个一阶良态（well-balanced）迎风有限体积离散化格式，该格式满足精确的C性质（即，在离散层面精确地保持静湖状态）。使用静水重构（Hydrostatic Reconstruction, HR）来重构交界面状态，使得在平衡状态下，离散的压力梯度项与离散化的河床坡度源项相平衡。然后实现离散残差的计算，对于均匀网格，为每个单元计算向量残差\n$$\n\\mathbf{R}_i = \\frac{\\mathbf{F}_{i+\\frac{1}{2}} - \\mathbf{F}_{i-\\frac{1}{2}}}{\\Delta x} + \\mathbf{S}_i,\n$$\n其中 $\\Delta x$ 是单元宽度（单位：$\\mathrm{m}$），$\\mathbf{F}_{i\\pm\\frac{1}{2}}$ 是交界面上的数值通量，$\\mathbf{S}_i$ 是为实现良态而设计的离散源项。\n\n你的程序必须构建一个在长度为 $L$（单位：$\\mathrm{m}$）的域上包含 $N$ 个单元的周期性均匀网格，为下述每个测试用例定义河床高程 $b(x)$，设置具有恒定 $\\eta$（单位：$\\mathrm{m}$）和 $q=0$ 的静湖初始条件，在交界面上使用非守恒乘积的路径守恒迎风处理方法进行静水重构（HR），并计算离散残差 $\\mathbf{R}_i$。对于每个测试用例，报告所有单元上动量残差分量的最大绝对值，\n$$\n\\max_i \\left|R^{(q)}_i\\right|,\n$$\n单位为 $\\mathrm{m}^2/\\mathrm{s}^2$。使用周期性边界条件。\n\n你可以使用的基本定律和核心定义包括：上面给出的浅水守恒律形式；静湖的定义 $\\eta = h + b$ 为常数且 $q=0$；以及静水重构（HR）概念，即在每个交界面处使用最大河床高程来重构交界面水深，以避免伪负水深。不要假设良态源项有任何简化公式；相反，应从离散格式必须精确保持静湖平衡的要求中推导它。\n\n测试套件：\n- 情况 1：$N=201$，$L=1000\\,\\mathrm{m}$，$g=9.81\\,\\mathrm{m}/\\mathrm{s}^2$，平缓线性斜坡 $b(x) = \\alpha x$，其中 $\\alpha = 10^{-3}$（无量纲，单位为 $\\mathrm{m}/\\mathrm{m}$），恒定自由表面高程 $\\eta = 5.0\\,\\mathrm{m}$。\n- 情况 2：$N=127$，$L=500\\,\\mathrm{m}$，$g=9.81\\,\\mathrm{m}/\\mathrm{s}^2$，平缓正弦地形 $b(x) = A \\sin\\left( \\dfrac{2\\pi x}{L} \\right)$，其中 $A = 0.5\\,\\mathrm{m}$，恒定自由表面高程 $\\eta = 2.0\\,\\mathrm{m}$。\n- 情况 3：$N=129$，$L=1000\\,\\mathrm{m}$，$g=9.81\\,\\mathrm{m}/\\mathrm{s}^2$，近干涸正弦地形 $b(x) = A \\sin\\left( \\dfrac{2\\pi x}{L} \\right)$，其中 $A = 0.999\\,\\mathrm{m}$，恒定自由表面高程 $\\eta = 1.0\\,\\mathrm{m}$。\n- 情况 4：$N=100$，$L=200\\,\\mathrm{m}$，$g=9.81\\,\\mathrm{m}/\\mathrm{s}^2$，平坦河床 $b(x) = 0\\,\\mathrm{m}$，恒定自由表面高程 $\\eta = 3.0\\,\\mathrm{m}$。\n\n不涉及角度单位。物理单位必须如上所述。你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$，其中每个 $\\text{result}_k$ 是情况 $k$ 的最大绝对动量残差，单位为 $\\mathrm{m}^2/\\mathrm{s}^2$，以浮点数形式表示。", "solution": "目标是为带地形的一维浅水方程推导并实现一个一阶良态（well-balanced）有限体积格式，并计算静湖状态下的离散残差。如果一个格式能精确地保持离散的静湖平衡，即此状态下的数值残差为零（达到机器精度），则该格式是良态的，或称其满足C性质。\n\n### 有限体积离散化\n\n我们将域 $[0, L]$ 离散化为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元。单元中心位于 $x_i = (i+0.5)\\Delta x$（对于 $i=0, \\dots, N-1$）。单元交界面位于 $x_{i\\pm1/2}$。在每个单元 $i$ 中，我们存储守恒变量的单元平均值 $\\mathbf{U}_i = \\begin{bmatrix} h_i \\\\ q_i \\end{bmatrix}$，以及单元中心的河床高程 $b_i = b(x_i)$。\n\n守恒律 $\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F} = \\mathbf{S}$ 的半离散有限体积格式为\n$$\n\\frac{d\\mathbf{U}_i}{dt} = -\\frac{\\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2}}{\\Delta x} + \\mathbf{S}_i\n$$\n问题定义的残差为 $\\mathbf{R}_i = \\frac{\\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2}}{\\Delta x} + \\mathbf{S}_i$。良态条件要求对于静湖状态，$\\mathbf{R}_i = \\mathbf{0}$。\n\n### 静水重构 (Hydrostatic Reconstruction, HR)\n\n实现良态格式的关键在于对压力梯度（$\\partial_x \\mathbf{F}$ 的一部分）和河床坡度源项进行一致的离散化。静水重构（HR）方法实现了这一点。在每个单元交界面 $x_{i+1/2}$，我们为*平坦河床*上的一个黎曼问题重构两个状态，$\\mathbf{U}_{i+1/2}^L$（来自单元 $i$）和 $\\mathbf{U}_{i+1/2}^R$（来自单元 $i+1$）。\n\n1.  将交界面河床高程定义为相邻单元中心值的最大值：\n    $$\n    b_{i+1/2} = \\max(b_i, b_{i+1})\n    $$\n2.  重构交界面左右两侧的水深，确保其为正值：\n    $$\n    h_{i+1/2}^L = \\max(0, h_i + b_i - b_{i+1/2})\n    $$\n    $$\n    h_{i+1/2}^R = \\max(0, h_{i+1} + b_{i+1} - b_{i+1/2})\n    $$\n3.  通过将这些深度与分段常数的单元中心流量（一阶重构）相结合，形成重构状态：\n    $$\n    \\mathbf{U}_{i+1/2}^L = \\begin{bmatrix} h_{i+1/2}^L \\\\ q_i \\end{bmatrix}, \\quad \\mathbf{U}_{i+1/2}^R = \\begin{bmatrix} h_{i+1/2}^R \\\\ q_{i+1} \\end{bmatrix}\n    $$\n这些重构状态现在存在于一个高程为 $b_{i+1/2}$ 的概念上的平坦河床上。\n\n### 数值通量和良态源项\n\n残差公式中的数值通量 $\\mathbf{F}_{i+1/2}$ 使用适用于*齐次*浅水方程的数值通量函数计算，并应用于重构状态。在静湖状态下，$q_i=0$ 对所有 $i$ 成立，并且 $h_i+b_i = \\eta = \\text{常数}$。因此，重构深度变为：\n$$\nh_{i+1/2}^L = \\max(0, \\eta - b_{i+1/2})\n$$\n$$\nh_{i+1/2}^R = \\max(0, \\eta - b_{i+1/2})\n$$\n这意味着 $h_{i+1/2}^L = h_{i+1/2}^R$。我们称这个共同深度为 $h_{i+1/2}^*$。重构状态是相同的：$\\mathbf{U}_{i+1/2}^L = \\mathbf{U}_{i+1/2}^R = \\begin{bmatrix} h_{i+1/2}^* \\\\ 0 \\end{bmatrix}$。对于相同的状态，任何一致的数值通量（如Rusanov或Godunov）都简化为解析通量：\n$$\n\\mathbf{F}_{i+1/2, \\text{rest}} = \\mathbf{F}\\left( \\begin{bmatrix} h_{i+1/2}^* \\\\ 0 \\end{bmatrix} \\right) = \\begin{bmatrix} 0 \\\\ \\frac{1}{2}g(h_{i+1/2}^*)^2 \\end{bmatrix}\n$$\n问题的核心是推导离散源项 $\\mathbf{S}_i$，以使格式是良态的。良态条件要求，当为静止状态求值时，离散残差为零：\n$$\n\\mathbf{R}_{i, \\text{rest}} = \\frac{\\mathbf{F}_{i+1/2, \\text{rest}} - \\mathbf{F}_{i-1/2, \\text{rest}}}{\\Delta x} + \\mathbf{S}_{i, \\text{rest}} = \\mathbf{0}\n$$\n这个方程*定义了*保证C性质的离散源项 $\\mathbf{S}_{i, \\text{rest}}$。\n$$\n\\mathbf{S}_{i, \\text{rest}} = - \\frac{\\mathbf{F}_{i+1/2, \\text{rest}} - \\mathbf{F}_{i-1/2, \\text{rest}}}{\\Delta x}\n$$\n质量分量显然为零。动量分量为：\n$$\nS_i^{(q)} = - \\frac{1}{\\Delta x} \\left[ \\frac{1}{2}g(h_{i+1/2}^*)^2 - \\frac{1}{2}g(h_{i-1/2}^*)^2 \\right]\n$$\n\n### 残差计算\n\n问题要求计算静湖状态下的残差 $\\mathbf{R}_i = \\frac{\\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2}}{\\Delta x} + \\mathbf{S}_i$。\n算法如下：\n1.  对于给定的测试用例，设置网格和静湖初始条件：$b_i = b(x_i)$，$h_i = \\eta - b_i$，$q_i=0$。\n2.  对每个单元 $i$，使用HR程序计算数值通量 $\\mathbf{F}_{i+1/2}$ 和 $\\mathbf{F}_{i-1/2}$。由于状态是全局平衡，这些通量将是上述推导的 $\\mathbf{F}_{\\text{rest}}$。\n3.  对每个单元 $i$，使用其从C性质导出的定义计算离散源项 $\\mathbf{S}_i$。\n4.  计算残差 $\\mathbf{R}_i = \\left(\\frac{\\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2}}{\\Delta x}\\right) + \\left(-\\frac{\\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2}}{\\Delta x}\\right)$。\n\n通过构造，对于静湖状态，该格式的离散残差的每个分量都将精确地（在浮点精度范围内）为零。因此，动量残差的最大绝对值 $\\max_i |R^{(q)}_i|$ 预计为零或一个非常接近零的数值。实现该计算将验证格式的良态性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum absolute momentum residual for the shallow water equations\n    at lake-at-rest using a first-order well-balanced hydrostatic reconstruction scheme.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"N\": 201, \"L\": 1000.0, \"g\": 9.81, \"eta\": 5.0,\n            \"b_func\": lambda x, L: 1e-3 * x, \"case_id\": 1\n        },\n        {\n            \"N\": 127, \"L\": 500.0, \"g\": 9.81, \"eta\": 2.0,\n            \"b_func\": lambda x, L: 0.5 * np.sin(2.0 * np.pi * x / L), \"case_id\": 2\n        },\n        {\n            \"N\": 129, \"L\": 1000.0, \"g\": 9.81, \"eta\": 1.0,\n            \"b_func\": lambda x, L: 0.999 * np.sin(2.0 * np.pi * x / L), \"case_id\": 3\n        },\n        {\n            \"N\": 100, \"L\": 200.0, \"g\": 9.81, \"eta\": 3.0,\n            \"b_func\": lambda x, L: np.zeros_like(x), \"case_id\": 4,\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        L = case[\"L\"]\n        g = case[\"g\"]\n        eta = case[\"eta\"]\n        b_func = case[\"b_func\"]\n\n        # 1. Setup grid and initial conditions\n        # Uniform grid with N cells of width dx.\n        # Cell centers x are used to define bed elevation.\n        dx = L / N\n        x = np.linspace(0.0, L, num=N, endpoint=False) + dx / 2.0\n\n        # Define bed elevation and lake-at-rest initial state\n        b = b_func(x, L) # Bed elevation at cell centers\n        h = eta - b      # Water depth at cell centers\n        q = np.zeros(N)  # Discharge is zero at rest\n\n        # Check for positivity of depth\n        if np.any(h = 0):\n            # This should not happen for the given test cases.\n            raise ValueError(f\"Case {case['case_id']}: Non-positive water depth encountered.\")\n\n        # Array to store all momentum residuals\n        R_q = np.zeros(N)\n\n        for i in range(N):\n            # Periodic boundary conditions: indices for neighbors\n            im1 = (i - 1 + N) % N\n            ip1 = (i + 1) % N\n            \n            # --- Flux F_{i+1/2} ---\n            # Reconstruct states at interface i+1/2 between cells i and i+1\n            b_i, h_i = b[i], h[i]\n            b_ip1, h_ip1 = b[ip1], h[ip1]\n\n            b_ip12 = np.maximum(b_i, b_ip1)\n            \n            # Since eta = h_i + b_i is constant, we have h_i + b_i = h_ip1 + b_ip1\n            # Therefore, h_L and h_R at the interface are identical.\n            h_star_ip12 = np.maximum(0.0, h_i + b_i - b_ip12)\n            \n            # At lake-at-rest, q=0 and U_L = U_R. Any consistent flux simplifies to the\n            # analytical flux F(U). The momentum component is 0.5*g*h^2.\n            F_q_ip12 = 0.5 * g * h_star_ip12**2\n            \n            # --- Flux F_{i-1/2} ---\n            # Reconstruct states at interface i-1/2 between cells i-1 and i\n            b_im1, h_im1 = b[im1], h[im1]\n            \n            b_im12 = np.maximum(b_im1, b_i)\n            \n            # Similarly, h_star is the reconstructed depth\n            h_star_im12 = np.maximum(0.0, h_i + b_i - b_im12)\n            \n            F_q_im12 = 0.5 * g * h_star_im12**2\n            \n            # --- Discrete source term S_i ---\n            # The problem requires deriving S_i to satisfy the C-property (well-balancing).\n            # The C-property means the residual is zero at rest.\n            # R_i = (F_{i+1/2} - F_{i-1/2})/dx + S_i = 0\n            # This equation defines the discrete source term S_i at the rest state.\n            # We explicitly compute it to demonstrate the balance.\n            # The momentum component of the source term is:\n            S_q_i = -(F_q_ip12 - F_q_im12) / dx\n            \n            # --- Discrete residual R_i ---\n            # Compute the momentum component of the residual.\n            # By construction, this should be zero (to machine precision).\n            flux_divergence_q = (F_q_ip12 - F_q_im12) / dx\n            R_q[i] = flux_divergence_q + S_q_i\n\n        # The final result for the case is the maximum absolute momentum residual\n        # over all cells.\n        max_abs_residual = np.max(np.abs(R_q))\n        results.append(max_abs_residual)\n\n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3386316"}]}