{"hands_on_practices": [{"introduction": "在看到了标准显式格式的失败之后，我们现在探索一种替代方案：蛙跳（leapfrog）时间步进格式。该方法在时间上也是中心化的，正如我们将要推导的，它对于对流问题是条件稳定的，提供了一种潜在的解决方案。然而，这个练习揭示了多步格式所固有的一个新挑战——非物理“计算模态”（computational mode）的出现——这表明数值方法的选择通常需要在稳定性和其他性能之间进行权衡 [@problem_id:3365230]。", "problem": "考虑一维线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中平流速度 $a$ 为常数，方程在一个周期性域上，并在均匀空间网格 $x_{j} = j\\,\\Delta x$ 和时间层 $t^{n} = n\\,\\Delta t$ 上进行离散，其中 $j$ 和 $n$ 是整数，且 $\\Delta x, \\Delta t  0$。使用 $[t^{n-1}, t^{n+1}]$ 上的中心差分来近似 $t^{n}$ 处的 时间导数，并使用关于 $x$ 的中心差分来近似 $t^{n}$ 处的空间导数，并定义库朗数 $r = a\\,\\Delta t/\\Delta x$。使用冯·诺依曼傅里叶模态 $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\theta\\,j)$（其中无量纲波数角 $\\theta$ 以弧度为单位），推导与蛙跳时间步进格式结合中心空间差分格式相关的放大因子 $G(\\theta,r)$。然后，要求在 $|G(\\theta,r)| \\leq 1$ （对于所有 $\\theta \\in [-\\pi,\\pi]$）的意义下达到一致稳定性，并确定满足此界限的 $r$ 的最大容许量值（最大库朗数）。最后，检验为 $G(\\theta,r)$ 求得的根，并根据它们的代数关系推断是否存在计算模态（寄生模态），并解释其出现的机制。请提供 $G(\\theta,r)$ 的闭式表达式以及等于最大容许库朗数的单个实数作为最终输出。无需四舍五入，也无需报告物理单位；角度必须以弧度解释。", "solution": "该问题陈述是偏微分方程数值分析领域中一个有效且适定的问题。它要求对应用于一维线性平流方程的蛙跳时间步进格式与二阶中心差分空间导数相结合的格式进行稳定性分析。所有必要的信息都已提供，且该问题具有科学依据。\n\n一维线性平流方程由下式给出：\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\n其中 $u(x, t)$ 是输运量，$a$ 是恒定的平流速度。\n\n问题指定了在均匀网格上进行离散化，空间步长为 $\\Delta x$，时间步长为 $\\Delta t$，其中 $u_j^n$ 近似于 $u(x_j, t^n)$。时间导数 $\\frac{\\partial u}{\\partial t}$ 在时间层 $n$ 处通过中心差分（蛙跳格式）近似：\n$$\n\\left(\\frac{\\partial u}{\\partial t}\\right)_j^n \\approx \\frac{u_j^{n+1} - u_j^{n-1}}{2\\Delta t}\n$$\n空间导数 $\\frac{\\partial u}{\\partial x}$ 在网格点 $j$ 处通过中心差分近似：\n$$\n\\left(\\frac{\\partial u}{\\partial x}\\right)_j^n \\approx \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x}\n$$\n将这些近似值代入平流方程，得到有限差分方程：\n$$\n\\frac{u_j^{n+1} - u_j^{n-1}}{2\\Delta t} + a \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} = 0\n$$\n为了进行冯·诺依曼稳定性分析，我们将单个傅里叶模态 $u_j^n = \\hat{u}^n \\exp(i\\theta j)$ 代入有限差分方程。这里，$\\theta = k\\Delta x$ 是无量纲波数，其中 $k$ 是波数。\n$$\n\\frac{\\hat{u}^{n+1}\\exp(i\\theta j) - \\hat{u}^{n-1}\\exp(i\\theta j)}{2\\Delta t} + a \\frac{\\hat{u}^{n}\\exp(i\\theta (j+1)) - \\hat{u}^{n}\\exp(i\\theta (j-1))}{2\\Delta x} = 0\n$$\n我们可以将整个方程除以公因子 $\\exp(i\\theta j)$：\n$$\n\\frac{\\hat{u}^{n+1} - \\hat{u}^{n-1}}{2\\Delta t} + a \\hat{u}^{n} \\frac{\\exp(i\\theta) - \\exp(-i\\theta)}{2\\Delta x} = 0\n$$\n使用欧拉恒等式 $\\sin(\\theta) = \\frac{\\exp(i\\theta) - \\exp(-i\\theta)}{2i}$，方程变为：\n$$\n\\frac{\\hat{u}^{n+1} - \\hat{u}^{n-1}}{2\\Delta t} + a \\hat{u}^{n} \\frac{2i\\sin(\\theta)}{2\\Delta x} = 0\n$$\n乘以 $2\\Delta t$ 并重新整理，得到振幅 $\\hat{u}^n$ 的递推关系：\n$$\n\\hat{u}^{n+1} - \\hat{u}^{n-1} = -2i \\left(\\frac{a\\Delta t}{\\Delta x}\\right) \\sin(\\theta) \\hat{u}^n\n$$\n引入库朗数 $r = a\\Delta t / \\Delta x$，我们得到：\n$$\n\\hat{u}^{n+1} + \\left(2ir\\sin(\\theta)\\right)\\hat{u}^n - \\hat{u}^{n-1} = 0\n$$\n放大因子 $G$ 定义为 $\\hat{u}^{n+1} = G \\hat{u}^n$。由于这是一个两步法，递推关系关联了三个时间层。因此，我们假设解的形式为 $\\hat{u}^n = (\\hat{u}^0)G^n$。将此代入递推关系得到：\n$$\n(\\hat{u}^0)G^{n+1} + \\left(2ir\\sin(\\theta)\\right)(\\hat{u}^0)G^n - (\\hat{u}^0)G^{n-1} = 0\n$$\n除以 $(\\hat{u}^0)G^{n-1}$（假设 $G \\neq 0$ 且 $\\hat{u}^0 \\neq 0$），我们得到放大因子 $G$ 的特征方程：\n$$\nG^2 + (2ir\\sin(\\theta))G - 1 = 0\n$$\n这是一个关于 $G$ 的二次方程。我们使用二次方程求根公式求解其根：\n$$\nG(\\theta,r) = \\frac{-2ir\\sin(\\theta) \\pm \\sqrt{(2ir\\sin(\\theta))^2 - 4(1)(-1)}}{2}\n$$\n$$\nG(\\theta,r) = \\frac{-2ir\\sin(\\theta) \\pm \\sqrt{-4r^2\\sin^2(\\theta) + 4}}{2}\n$$\n$$\nG(\\theta,r) = -ir\\sin(\\theta) \\pm \\sqrt{1 - r^2\\sin^2(\\theta)}\n$$\n这给出了与该格式相关的两个放大因子的表达式。\n\n为使格式稳定，放大因子的模必须对所有实数 $\\theta$ 满足 $|G(\\theta,r)| \\leq 1$。我们分析平方根下的项 $1 - r^2\\sin^2(\\theta)$。\n\n情况 1：$1 - r^2\\sin^2(\\theta) \\geq 0$。\n在这种情况下，平方根为实数。设 $A = r\\sin(\\theta)$ 和 $B = \\sqrt{1 - r^2\\sin^2(\\theta)}$。则 $G = -iA \\pm B$。$G$ 的模为：\n$$\n|G| = \\sqrt{(\\pm B)^2 + (-A)^2} = \\sqrt{B^2 + A^2} = \\sqrt{(1 - r^2\\sin^2(\\theta)) + (r^2\\sin^2(\\theta))} = \\sqrt{1} = 1\n$$\n所以，如果 $1 - r^2\\sin^2(\\theta) \\geq 0$，该格式是中性稳定的，满足稳定性要求 $|G| \\leq 1$。为了使该条件对所有 $\\theta \\in [-\\pi, \\pi]$ 成立，我们必须检查最坏情况，即 $|\\sin(\\theta)|$ 取最大值时。$\\sin^2(\\theta)$ 的最大值为 $1$。因此，我们必须有：\n$$\n1 - r^2(1) \\geq 0 \\implies r^2 \\leq 1 \\implies |r| \\leq 1\n$$\n这是该格式的 Courant-Friedrichs-Lewy (CFL) 条件。库朗数 $r$ 的最大容许量值为 $1$。\n\n情况 2：$1 - r^2\\sin^2(\\theta)  0$。\n如果 $|r|  1$，对于一定范围的 $\\theta$ 值，就会发生这种情况。在这种情况下，平方根下的项为负。我们可以写成 $\\sqrt{1 - r^2\\sin^2(\\theta)} = i\\sqrt{r^2\\sin^2(\\theta) - 1}$。放大因子为：\n$$\nG = -ir\\sin(\\theta) \\pm i\\sqrt{r^2\\sin^2(\\theta) - 1} = i\\left(-r\\sin(\\theta) \\pm \\sqrt{r^2\\sin^2(\\theta) - 1}\\right)\n$$\n$G$ 的模为 $|-r\\sin(\\theta) \\pm \\sqrt{r^2\\sin^2(\\theta) - 1}|$。让我们考虑括号中带正号的根（此选择导致放大）。其模为 $|-r\\sin(\\theta) + \\sqrt{r^2\\sin^2(\\theta) - 1}|$。如果我们假设 $r0$，我们可以选择 $\\theta$ 使得 $\\sin(\\theta)0$，以使模大于1。例如，如果 $r1$，我们取 $\\theta = -\\pi/2$，所以 $\\sin(\\theta)=-1$。则 $G=i(r \\pm \\sqrt{r^2 - 1})$。模为 $|r \\pm \\sqrt{r^2 - 1}|$。对于正号，模为 $r + \\sqrt{r^2-1}$。因为 $r  1$，我们有 $r^2 - 1  0$，所以 $r + \\sqrt{r^2 - 1}  r  1$。因此，其中一个根的模大于 $1$，导致指数增长和不稳定性。\n\n因此，该格式对所有波数都稳定的要求是 $|r| \\leq 1$。$r$ 的最大容许量值为 $1$。\n\n最后，我们分析这些根以理解计算模态。特征方程 $G^2 + (2ir\\sin(\\theta))G - 1 = 0$ 产生两个不同的 $G$ 的根，我们称之为 $G_1$ 和 $G_2$。原始偏微分方程在时间上是一阶的，因此其演化应仅依赖于一个“模态”。该数值格式是一个三层（两步）方法，在时间索引 $n$ 上是二阶的，这内在地引入了第二个非物理的解。这个伪解就是计算模态（或寄生模态）。这两个根之间的代数关系可以通过对特征多项式使用韦达定理找到：根的乘积 $G_1 G_2$ 是常数项，即 $-1$。\n$$\nG_1 G_2 = -1\n$$\n在稳定区域（$|r| \\leq 1$），我们证明了两个根的模均为 $|G_1| = |G_2| = 1$。一个根 $G_1$ 近似于物理波的传播。对于小的 $r\\theta$，$G_1 \\approx 1 - ir\\theta - \\frac{1}{2}(r\\theta)^2 \\approx \\exp(-ir\\theta)$，这对应于真实解的放大因子。另一个根是 $G_2 = -1/G_1 \\approx -\\exp(ir\\theta)$。对于小波数（$\\theta \\to 0$），$G_1 \\to 1$ 且 $G_2 \\to -1$。这意味着计算模态表现为时间上的高频振荡，在每个时间步都翻转符号（$(-1)^n$），这会污染数值解。这个第二根的存在是用二阶中心差分近似一阶时间导数的直接结果。\n\n最终答案要求给出 $G(\\theta,r)$ 的表达式和最大容许库朗数。", "answer": "$$\n\\boxed{\n\\pmatrix{\n-ir\\,\\sin(\\theta) \\pm \\sqrt{1 - r^2\\sin^2(\\theta)}\n 1\n}\n}\n$$", "id": "3365230"}, {"introduction": "为了将理论与实践联系起来，最后的这个练习要求编写一个简短的程序来求解稳态对流-扩散方程。在这里，当对流相对于扩散占主导地位时（即网格佩克莱特数 $Pe$ 较高时），中心差分的不稳定性表现为非物理振荡。通过亲手实现该格式并观察不同参数下的结果，您将对为何在对流主导的流动中通常避免使用中心差分，以及为何需要像迎风格式这样的替代方案有一个切实的理解 [@problem_id:3365178]。", "problem": "考虑一维、稳态、线性的对流扩散边界值问题，研究对象为定义在区间 $[0,1]$ 上的被动标量场 $\\phi(x)$，其材料属性和速度均为常数。连续控制方程是写成守恒形式的扩散通量和对流通量平衡式，\n$$\n-\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}\\right) + \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\rho u \\, \\phi\\right) = 0,\n$$\n其中 $\\Gamma0$ 是扩散系数，$\\rho0$ 是密度，$u$ 是一个可以为正或为负的恒定速度。施加 Dirichlet 边界条件 $\\phi(0)=\\phi_L$ 和 $\\phi(1)=\\phi_R$。所有量都应视为无量纲量。您必须完全在无量纲单位下进行计算。\n\n您的任务是使用以单元为中心的有限体积法，在一个包含 $N$ 个等大控制体积的均匀网格上（单元交界面位于 $x_i = i \\Delta x$，其中 $\\Delta x = 1/N$ 且 $i=0,1,\\ldots,N$），并使用中心差分格式处理对流通量，来构建一个数值算例。该算例需说明一个众所周知的稳定性问题：当网格 Peclet 数的绝对值大于2时，即 $|Pe|  2$，中心差分格式会产生非单调的内部振荡，即使所得到的线性系统仍然可解。\n\n从每个控制体积的守恒出发，使用以下方法离散化方程：\n- 对交界面上的扩散通量使用二阶中心差分。\n- 对交界面上的对流质量通量使用二阶中心差分。\n\n推导出关于内部单元中心值 $\\phi_1,\\ldots,\\phi_{N-1}$ 的三对角线性系统，该系统应以扩散导纳 $D=\\Gamma/\\Delta x$、质量通量 $F=\\rho u$ 和网格 Peclet 数 $Pe = F \\Delta x/\\Gamma$ 来表示。不要引入任何人工耗散或迎风格式；两种通量都使用纯中心差分。组装线性系统，并将 Dirichlet 边界条件合并到右侧项中。\n\n如下定义非单调内部振荡的定量检测器。给定计算出的包含边界的离散解 $\\{\\phi_i\\}_{i=0}^N$，如果以下至少一个条件成立，则判断存在内部振荡：\n- 存在索引 $j \\in \\{1,\\ldots,N-1\\}$，使得 $\\phi_j$ 严格位于以 $\\phi_L$ 和 $\\phi_R$ 为端点的闭区间之外。\n- 存在索引 $j \\in \\{1,\\ldots,N-2\\}$，使得乘积 $(\\phi_{j+1}-\\phi_j)(\\phi_j-\\phi_{j-1})  0$，即一阶差分符号改变，表明存在离散的内部极值点。\n\n实现一个程序，该程序能够：\n- 对每个指定的测试用例，构建并求解上述均匀网格上的中心差分有限体积格式的线性系统。\n- 对每个用例，报告一个布尔值，指示是否根据上述标准检测到非单调的内部振荡。\n\n使用以下五个测试用例，每个用例由元组 $(N, Pe, \\phi_L, \\phi_R)$ 指定：\n- 用例 1：$(N, Pe, \\phi_L, \\phi_R) = (10, 0.5, 1, 0)$。\n- 用例 2：$(N, Pe, \\phi_L, \\phi_R) = (10, 4.0, 1, 0)$。\n- 用例 3：$(N, Pe, \\phi_L, \\phi_R) = (40, 4.0, 1, 0)$。\n- 用例 4：$(N, Pe, \\phi_L, \\phi_R) = (10, 2.0, 1, 0)$。\n- 用例 5：$(N, Pe, \\phi_L, \\phi_R) = (10, -4.0, 0, 1)$。\n\n注意：\n- 固定 $\\Gamma=1$ 和 $\\rho=1$ 以使所有量无量纲化。则 $D = 1/\\Delta x$ 且 $F = Pe/\\Delta x$。均匀网格间距为 $\\Delta x = 1/N$。\n- 您必须一致地使用 $Pe$ 的符号来确定质量通量 $F$ 的符号。\n- 最终的线性系统必须严格按照中心差分有限体积公式组装；不要对系数进行正则化、限制或修改。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，顺序与上述五个用例一致。例如，输出形式应为 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_k$ 是一个布尔值，表示是否为用例 $k$ 检测到内部振荡。本问题不涉及角度或物理单位；所有量均为无量纲。唯一要求的输出是这一行指定格式的内容。", "solution": "用户希望分析一维稳态对流扩散问题中心差分有限体积格式的稳定性。\n\n### 问题验证\n\n**第一步：提取已知条件**\n\n*   **控制方程：** $-\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}\\right) + \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\rho u \\, \\phi\\right) = 0$ 在定义域 $x \\in [0,1]$ 上。\n*   **参数：** 扩散系数 $\\Gamma  0$，密度 $\\rho  0$，速度 $u$ 均为常数。所有量均为无量纲。\n*   **边界条件 (BCs)：** Dirichlet 条件，$\\phi(0)=\\phi_L$ 和 $\\phi(1)=\\phi_R$。\n*   **数值离散化：**\n    *   在包含 $N$ 个控制体积的均匀网格上使用有限体积法。\n    *   网格节点位于 $x_i = i \\Delta x$，$i=0, \\ldots, N$，其中 $\\Delta x = 1/N$。内部未知量为 $\\phi_1, \\ldots, \\phi_{N-1}$。这意味着这是一个以顶点为中心的格式，其中 $\\phi_i$ 是节点 $x_i$ 处的值。\n    *   对控制体积交界面上的扩散通量和对流通量均指定了二阶中心差分。\n*   **定义：**\n    *   扩散导纳：$D = \\Gamma / \\Delta x$。\n    *   质量通量：$F = \\rho u$。\n    *   网格 Peclet 数：$Pe = F \\Delta x / \\Gamma$。\n*   **常数：** 在实现中指定固定值 $\\Gamma=1$ 和 $\\rho=1$。\n*   **振荡检测：** 如果满足以下两个条件中的至少一个，则存在内部振荡：\n    1.  某个内部解值 $\\phi_j$（对于 $j \\in \\{1, \\ldots, N-1\\}$）严格位于范围 $[\\min(\\phi_L, \\phi_R), \\max(\\phi_L, \\phi_R)]$ 之外。\n    2.  存在一个离散的内部极值点，定义为对于某个索引 $j \\in \\{1, \\ldots, N-2\\}$，有 $(\\phi_{j+1}-\\phi_j)(\\phi_j-\\phi_{j-1})  0$。\n*   **测试用例：**\n    1.  $(N, Pe, \\phi_L, \\phi_R) = (10, 0.5, 1, 0)$\n    2.  $(N, Pe, \\phi_L, \\phi_R) = (10, 4.0, 1, 0)$\n    3.  $(N, Pe, \\phi_L, \\phi_R) = (40, 4.0, 1, 0)$\n    4.  $(N, Pe, \\phi_L, \\phi_R) = (10, 2.0, 1, 0)$\n    5.  $(N, Pe, \\phi_L, \\phi_R) = (10, -4.0, 0, 1)$\n\n**第二步：使用提取的已知条件进行验证**\n\n*   **科学依据：** 该问题基于经典的一维对流扩散方程和标准的有限体积法，这是计算流体动力学中的一个基本课题。研究数值稳定性与网格 Peclet 数的关系是一个经典且至关重要的主题。该问题在科学上是合理的。\n*   **适定性：** 连续问题是一个适定的线性边界值问题。离散化后得到一个三对角线性系统。对于指定的格式和参数，该系统是非奇异的，保证了唯一解的存在。该问题是适定的。\n*   **客观性：** 该问题用精确的数学定义、量化标准和具体的数值参数来表述。它没有主观性和模糊性。\n*   **完整性：** 提供了所有必要的信息，包括控制方程、边界条件、离散格式、参数定义和测试用例。该问题是自洽的。\n*   **一致性：** 没有矛盾之处。$D$、$F$ 和 $Pe$ 的定义是相互一致的。尽管使用了“以单元为中心”的术语，但所期望的线性系统结构（针对 $\\phi_1, \\ldots, \\phi_{N-1}$）与以顶点为中心的网格解释是一致的，这是一个常见的术语上的微小混淆点，但在设置中并未造成形式上的矛盾。\n\n**第三步：结论与行动**\n\n问题是有效的。将制定一个合理的解决方案。\n\n### 基于原理的解决方案\n\n任务是推导并求解一维稳态对流扩散方程的离散形式，并检查解是否存在非物理振荡。\n\n**1. 通过有限体积法进行离散化**\n守恒形式的控制方程为 $\\frac{\\mathrm{d}}{\\mathrm{d}x} J(x) = 0$，其中 $J(x)$ 是总通量，由 $J = -\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x} + F\\phi$ 给出，$F = \\rho u$。这意味着总通量在整个域中是恒定的。\n\n我们使用以顶点为中心的有限体积法。域 $[0,1]$ 被 $N+1$ 个位于 $x_i = i\\Delta x$（$i=0, 1, \\ldots, N$）的节点划分为 $N$ 个段，其中 $\\Delta x = 1/N$。未知量是内部节点 $i=1, \\ldots, N-1$ 处的值 $\\phi_i$。边界值已知：$\\phi_0 = \\phi_L$ 和 $\\phi_N = \\phi_R$。\n\n我们将控制方程在一个围绕内部节点 $x_i$ 的控制体积 (CV) 上积分。该 CV 从位于 $x_i - \\Delta x/2$ 的西面 $w$ 延伸到位于 $x_i + \\Delta x/2$ 的东面 $e$。\n$$ \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\frac{\\mathrm{d}J}{\\mathrm{d}x} \\mathrm{d}x = 0 $$\n$$ J_e - J_w = 0 $$\n其中 $J_e$ 和 $J_w$ 分别是 CV 东面和西面的总通量。\n\n**2. 使用中心差分近似通量**\n交界面上的通量使用二阶中心差分来近似扩散和对流。\n\n在东面 $e$（节点 $i$ 和 $i+1$ 的中点）：\n扩散通量近似为：\n$$ \\left(-\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}\\right)_e \\approx -\\Gamma \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} = -D(\\phi_{i+1} - \\phi_i) $$\n其中 $D=\\Gamma/\\Delta x$。\n对流通量需要交界面上的 $\\phi$ 值，通过线性插值得到：\n$$ (F\\phi)_e \\approx F \\phi_e = F \\frac{\\phi_i + \\phi_{i+1}}{2} $$\n东面 $e$ 处的总通量为：\n$$ J_e \\approx F \\frac{\\phi_i + \\phi_{i+1}}{2} - D(\\phi_{i+1} - \\phi_i) = \\left(\\frac{F}{2} + D\\right)\\phi_i - \\left(D - \\frac{F}{2}\\right)\\phi_{i+1} $$\n\n类似地，在西面 $w$（节点 $i-1$ 和 $i$ 的中点）：\n$$ J_w \\approx F \\frac{\\phi_{i-1} + \\phi_i}{2} - D(\\phi_i - \\phi_{i-1}) = \\left(\\frac{F}{2} - D\\right)\\phi_i + \\left(\\frac{F}{2} + D\\right)\\phi_{i-1} $$\n\n**3. 代数方程的推导**\n将通量近似值代入平衡方程 $J_e - J_w = 0$：\n$$ \\left[\\left(\\frac{F}{2} + D\\right)\\phi_i - \\left(D - \\frac{F}{2}\\right)\\phi_{i+1}\\right] - \\left[\\left(\\frac{F}{2} - D\\right)\\phi_i + \\left(\\frac{F}{2} + D\\right)\\phi_{i-1}\\right] = 0 $$\n整理关于 $\\phi_{i-1}$、$\\phi_i$ 和 $\\phi_{i+1}$ 的项：\n$$ -\\left(D + \\frac{F}{2}\\right)\\phi_{i-1} + \\left(2D\\right)\\phi_i - \\left(D - \\frac{F}{2}\\right)\\phi_{i+1} = 0 $$\n为了用网格 Peclet 数 $Pe = F\\Delta x/\\Gamma = F/D$ 来表示，我们将整个方程除以 $D$：\n$$ -\\left(1 + \\frac{Pe}{2}\\right)\\phi_{i-1} + 2\\phi_i - \\left(1 - \\frac{Pe}{2}\\right)\\phi_{i+1} = 0 $$\n这个代数方程将节点 $i$ 处的值与其直接相邻节点的值联系起来。\n\n**4. 线性系统的组装**\n该方程对所有内部节点 $i=1, \\ldots, N-1$ 均成立。我们为未知量向量 $\\vec{\\phi} = [\\phi_1, \\ldots, \\phi_{N-1}]^T$ 组装一个形如 $A\\vec{\\phi} = \\vec{b}$ 的三对角线性系统。\n\n矩阵 $A$ 是一个 $(N-1) \\times (N-1)$ 的三对角矩阵，其系数如下：\n-   主对角线 ($d_i$)：$2$\n-   次对角线 ($a_i$)：$-\\left(1 + \\frac{Pe}{2}\\right)$\n-   超对角线 ($c_i$)：$-\\left(1 - \\frac{Pe}{2}\\right) = \\frac{Pe}{2} - 1$\n\n边界条件 $\\phi_0 = \\phi_L$ 和 $\\phi_N = \\phi_R$ 被并入右侧向量 $\\vec{b}$ 中。\n对于第一个方程 ($i=1$)：\n$$ 2\\phi_1 - \\left(1 - \\frac{Pe}{2}\\right)\\phi_2 = \\left(1 + \\frac{Pe}{2}\\right)\\phi_0 = \\left(1 + \\frac{Pe}{2}\\right)\\phi_L $$\n因此，$b_1 = (1 + Pe/2)\\phi_L$。\n\n对于最后一个方程 ($i=N-1$)：\n$$ -\\left(1 + \\frac{Pe}{2}\\right)\\phi_{N-2} + 2\\phi_{N-1} = \\left(1 - \\frac{Pe}{2}\\right)\\phi_N = \\left(1 - \\frac{Pe}{2}\\right)\\phi_R $$\n因此，$b_{N-1} = (1 - Pe/2)\\phi_R$。\n\n对于所有其他方程 ($i=2, \\ldots, N-2$)，右侧项为零，$b_i = 0$。\n\n**5. 稳定性与振荡**\n中心差分格式只有在矩阵 $A$ 是对角占优时才是稳定的并产生单调解。这要求 $|d_i| \\geq |a_i| + |c_i|$，即：\n$$ |2| \\geq \\left|-\\left(1 + \\frac{Pe}{2}\\right)\\right| + \\left|-\\left(1 - \\frac{Pe}{2}\\right)\\right| $$\n$$ 2 \\geq \\left|1 + \\frac{Pe}{2}\\right| + \\left|1 - \\frac{Pe}{2}\\right| $$\n这个不等式仅在 $|Pe/2| \\leq 1$ 或 $|Pe| \\leq 2$ 时成立。当 $|Pe|  2$ 时，对角占优性丧失，模板中相邻节点的系数可能变为负值，导致非物理的振荡解。题目要求展示这种行为。\n\n**6. 计算流程**\n程序将对每个测试用例执行以下步骤：\n1.  给定 $N$、$Pe$、$\\phi_L$ 和 $\\phi_R$。\n2.  如上所述，构建 $(N-1) \\times (N-1)$ 的三对角矩阵 $A$ 和右侧向量 $\\vec{b}$。\n3.  求解线性系统 $A\\vec{\\phi} = \\vec{b}$，以找到内部解值 $\\phi_1, \\ldots, \\phi_{N-1}$。\n4.  通过前置 $\\phi_L$ 和后置 $\\phi_R$ 来创建完整的解向量 $\\{\\phi_i\\}_{i=0}^N$。\n5.  应用两个指定的标准来检测振荡：\n    *   检查是否有任何内部 $\\phi_j$ 严格位于 $[\\min(\\phi_L, \\phi_R), \\max(\\phi_L, \\phi_R)]$ 之外。\n    *   检查是否有 $(\\phi_{j+1}-\\phi_j)(\\phi_j-\\phi_{j-1})  0$ 对于任何 $j \\in \\{1, \\ldots, N-2\\}$ 成立。\n6.  如果检测到振荡，则报告 `True`，否则报告 `False`。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases for the 1D convection-diffusion\n    problem and print the final formatted result.\n    \"\"\"\n\n    def solve_case(N, Pe, phi_L, phi_R):\n        \"\"\"\n        Constructs and solves the linear system for the central-differencing FVM\n        and detects non-monotone interior oscillations for a single case.\n\n        Args:\n            N (int): Number of control volumes.\n            Pe (float): Grid Peclet number.\n            phi_L (float): Left boundary condition value.\n            phi_R (float): Right boundary condition value.\n\n        Returns:\n            bool: True if an oscillation is detected, False otherwise.\n        \"\"\"\n        num_interior_nodes = N - 1\n\n        # Trivial case with no interior nodes to solve for.\n        if num_interior_nodes = 0:\n            return False\n\n        # 1. Construct the (N-1)x(N-1) tridiagonal matrix A\n        # The discretized equation for node i is: a*phi_{i-1} + d*phi_i + c*phi_{i+1} = 0\n        # where a = -(1 + Pe/2), d = 2, c = -(1 - Pe/2)\n        a = -1.0 - Pe / 2.0  # Lower diagonal coefficient\n        d = 2.0               # Main diagonal coefficient\n        c = -1.0 + Pe / 2.0  # Upper diagonal coefficient\n\n        A = np.diag(np.full(num_interior_nodes, d))\n        if num_interior_nodes > 1:\n            A += np.diag(np.full(num_interior_nodes - 1, c), k=1)\n            A += np.diag(np.full(num_interior_nodes - 1, a), k=-1)\n\n        # 2. Construct the RHS vector b incorporating boundary conditions\n        b = np.zeros(num_interior_nodes)\n        # Equation for i=1: d*phi_1 + c*phi_2 = -a*phi_0, with phi_0 = phi_L\n        b[0] = -a * phi_L\n        # Equation for i=N-1: a*phi_{N-2} + d*phi_{N-1} = -c*phi_N, with phi_N = phi_R\n        b[-1] = -c * phi_R\n\n        # 3. Solve the system A * phi_interior = b\n        phi_interior = np.linalg.solve(A, b)\n\n        # 4. Construct the full solution vector phi (size N+1, indices 0 to N)\n        phi = np.concatenate(([phi_L], phi_interior, [phi_R]))\n\n        # 5. Detect non-monotone interior oscillations\n        has_oscillation = False\n\n        # Criterion 1: Interior values lie strictly outside the boundary value range.\n        min_b = min(phi_L, phi_R)\n        max_b = max(phi_L, phi_R)\n        \n        if np.any(phi_interior  min_b) or np.any(phi_interior > max_b):\n            has_oscillation = True\n        \n        if not has_oscillation:\n            # Criterion 2: An interior extremum exists (sign change in first differences).\n            # Check for (phi_{j+1}-phi_j)(phi_j-phi_{j-1})  0 for j in {1, ..., N-2}\n            # The loop for j from 1 to N-2 (inclusive) is range(1, N-1) in Python.\n            for j in range(1, N - 1):\n                product = (phi[j + 1] - phi[j]) * (phi[j] - phi[j - 1])\n                if product  0:\n                    has_oscillation = True\n                    break\n                    \n        return has_oscillation\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, Pe, phi_L, phi_R)\n        (10, 0.5, 1, 0),\n        (10, 4.0, 1, 0),\n        (40, 4.0, 1, 0),\n        (10, 2.0, 1, 0),\n        (10, -4.0, 0, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3365178"}]}