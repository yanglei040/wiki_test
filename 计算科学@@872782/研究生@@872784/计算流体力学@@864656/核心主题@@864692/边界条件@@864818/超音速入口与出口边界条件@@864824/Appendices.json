{"hands_on_practices": [{"introduction": "在计算流体动力学中，边界条件的正确实现是获得物理上精确解的关键。本练习将指导你完成最基本的步骤：使用“虚拟单元”方法为一维超声速流动设置入口和出口边界。你将亲手计算在给定流动状态下，通过超声速入口和出口边界的数值通量。[@problem_id:3368205] 这个基础实践旨在巩固你对信息在超声速流中如何传播的理解，并让你熟练掌握在有限体积法中实现边界条件的核心机制。", "problem": "考虑一个一维无粘可压缩理想气体流动，该流动由质量、动量和能量守恒的欧拉方程控制。设状态向量为 $U = [\\rho, \\rho u, E]^T$，其中 $\\rho$ 是密度（单位为 $\\mathrm{kg/m^3}$），$u$ 是速度（单位为 $\\mathrm{m/s}$），$E$ 是单位体积总能量（单位为 $\\mathrm{J/m^3}$）。压力 $p$ 通过理想气体关系式 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ 与 $E$ 和 $u$ 相关，其中 $\\gamma$ 是比热比（无量纲）。通量向量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]^T$。一维守恒形式的欧拉方程为 $\\partial_t U + \\partial_x F(U) = 0$。\n\n您需要使用虚拟单元构造来实现有限体积法 (FVM)，以处理超音速入口和出口边界条件。位于左状态 $U_L$ 和右状态 $U_R$ 之间的界面上的数值通量必须是局部Lax-Friedrichs（也称为Rusanov）通量：\n$$\nF_{LF}(U_L, U_R) = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right),\n$$\n其中 $\\alpha = \\max\\left(|u_L| + a_L, |u_R| + a_R\\right)$ 且 $a = \\sqrt{\\gamma p / \\rho}$ 是声速。马赫数是 $M = |u|/a$。在本问题中，将 $M \\ge 1$ 视为超音速。对于具有指定原始状态 $(\\rho_{in}, u_{in}, p_{in})$ 的超音速入口（左边界），将左虚拟单元的原始状态构造为等于 $(\\rho_{in}, u_{in}, p_{in})$。对于超音速出口（右边界），通过复制最后一个内部单元的原始状态来构造右虚拟单元的原始状态。在使用原始状态进行通量计算之前，使用 $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$ 将其转换为守恒变量。\n\n对于每个提供的测试用例，您必须计算穿过左边界界面（左虚拟单元和第一个内部单元之间）和右边界界面（最后一个内部单元和右虚拟单元之间）的数值质量通量。质量通量是 $F_{LF}$ 的第一个分量，并且必须以 $\\mathrm{kg/(m^2\\cdot s)}$ 为单位报告。\n\n使用以下测试套件，每个套件由 $(\\gamma; \\rho_{in}, u_{in}, p_{in}; \\rho_{int}, u_{int}, p_{int})$ 在国际单位制 (SI) 中指定：\n\n- 测试用例1（一般超音速入口和出口）：\n  - $\\gamma = 1.4$\n  - 入口原始状态：$\\rho_{in} = 1.0$ $\\mathrm{kg/m^3}$，$u_{in} = 600.0$ $\\mathrm{m/s}$，$p_{in} = 120000.0$ $\\mathrm{Pa}$\n  - 内部原始状态（均匀）：$\\rho_{int} = 1.0$ $\\mathrm{kg/m^3}$，$u_{int} = 580.0$ $\\mathrm{m/s}$，$p_{int} = 110000.0$ $\\mathrm{Pa}$\n- 测试用例2（声速入口被视为超音速，内部为超音速）：\n  - $\\gamma = 1.4$\n  - 入口原始状态：$\\rho_{in} = 1.0$ $\\mathrm{kg/m^3}$，$u_{in} = \\sqrt{1.4 \\cdot 100000.0}$ $\\mathrm{m/s}$，$p_{in} = 100000.0$ $\\mathrm{Pa}$\n  - 内部原始状态（均匀）：$\\rho_{int} = 1.0$ $\\mathrm{kg/m^3}$，$u_{int} = 400.0$ $\\mathrm{m/s}$，$p_{int} = 80000.0$ $\\mathrm{Pa}$\n- 测试用例3（高马赫数超音速入口和出口）：\n  - $\\gamma = 1.4$\n  - 入口原始状态：$\\rho_{in} = 0.9$ $\\mathrm{kg/m^3}$，$u_{in} = 1500.0$ $\\mathrm{m/s}$，$p_{in} = 50000.0$ $\\mathrm{Pa}$\n  - 内部原始状态（均匀）：$\\rho_{int} = 0.95$ $\\mathrm{kg/m^3}$，$u_{int} = 1400.0$ $\\mathrm{m/s}$，$p_{int} = 60000.0$ $\\mathrm{Pa}$\n\n对于每个测试用例，执行以下步骤：\n1. 根据上面给出的超音速规则，从入口原始状态构造左虚拟单元的原始状态，并从最后一个内部原始状态构造右虚拟单元的原始状态。\n2. 将所有涉及的原始状态转换为守恒变量。\n3. 使用左虚拟单元作为 $U_L$ 和第一个内部单元作为 $U_R$，计算左边界界面处的 $F_{LF}$；记录质量通量值 $f_{m,L}$。\n4. 使用最后一个内部单元作为 $U_L$ 和右虚拟单元作为 $U_R$，计算右边界界面处的 $F_{LF}$；记录质量通量值 $f_{m,R}$。\n\n您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，顺序为 $\\left[f_{m,L}^{(1)}, f_{m,R}^{(1)}, f_{m,L}^{(2)}, f_{m,R}^{(2)}, f_{m,L}^{(3)}, f_{m,R}^{(3)}\\right]$，其中上标表示测试用例索引。每个条目必须是一个以 $\\mathrm{kg/(m^2\\cdot s)}$ 为单位的实数（浮点数），并采用程序的默认格式。不应打印任何其他文本。", "solution": "问题陈述是计算流体动力学领域一个完全自洽、适定的计算问题。它在科学上基于一维无粘可压缩流的欧拉方程，并指定了一种标准的数值方法（带有Rusanov通量的有限体积法）和边界条件处理方法（用于超音速流动的虚拟单元）。所有必要的参数和定义都已提供，所要求的计算也已明确定义。没有发现科学、逻辑或事实上的缺陷。\n\n目标是针对三个不同的测试用例，计算计算域左边界（超音速入口）和右边界（超音速出口）的数值质量通量。质量通量是向量值局部Lax-Friedrichs (Rusanov) 数值通量 $F_{LF}$ 的第一个分量。\n\n位于左状态 $U_L$ 和右状态 $U_R$ 之间的界面上的Rusanov通量由下式给出：\n$$\nF_{LF}(U_L, U_R) = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)\n$$\n其中 $F(U)$ 是物理通量向量，$U$ 是守恒变量向量，$\\alpha$ 是局部耗散系数。状态向量为 $U = [\\rho, \\rho u, E]^T$，物理通量向量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]^T$。我们关心的是 $F_{LF}$ 的第一个分量，它代表质量通量 $f_m$。令 $U_1 = \\rho$ 且 $F_1(U) = \\rho u$。质量通量为：\n$$\nf_{m,LF} = \\frac{1}{2}\\left(F_1(U_L) + F_1(U_R)\\right) - \\frac{1}{2}\\alpha\\left(U_{R,1} - U_{L,1}\\right)\n$$\n代入第一个分量的定义，上式变为：\n$$\nf_{m,LF} = \\frac{1}{2}\\left(\\rho_L u_L + \\rho_R u_R\\right) - \\frac{1}{2}\\alpha\\left(\\rho_R - \\rho_L\\right)\n$$\n耗散系数 $\\alpha$ 定义为界面处的最大特征速度：\n$$\n\\alpha = \\max\\left(|u_L| + a_L, |u_R| + a_R\\right)\n$$\n其中 $a = \\sqrt{\\gamma p / \\rho}$ 是声速。左（$L$）和右（$R$）状态的原始变量 $(\\rho, u, p)$ 由虚拟单元边界条件确定。\n\n**边界条件：**\n1.  **超音速入口（左边界）：** 界面位于左虚拟单元和第一个内部单元之间。\n    -   状态 $L$ （虚拟单元）：原始变量设置为指定的入口条件，即 $(\\rho_L, u_L, p_L) = (\\rho_{in}, u_{in}, p_{in})$。\n    -   状态 $R$ （第一个内部单元）：原始变量取自指定的内部状态，即 $(\\rho_R, u_R, p_R) = (\\rho_{int}, u_{int}, p_{int})$。\n\n2.  **超音速出口（右边界）：** 界面位于最后一个内部单元和右虚拟单元之间。\n    -   状态 $L$ （最后一个内部单元）：原始变量来自内部状态，即 $(\\rho_L, u_L, p_L) = (\\rho_{int}, u_{int}, p_{int})$。\n    -   状态 $R$ （虚拟单元）：原始变量从最后一个内部单元复制而来，因此 $(\\rho_R, u_R, p_R) = (\\rho_{int}, u_{int}, p_{int})$。\n    对于这种情况，由于 $(\\rho_L, u_L, p_L) = (\\rho_R, u_R, p_R)$，Rusanov质量通量大大简化。由于 $\\rho_R - \\rho_L = 0$，耗散项消失。通量项变为 $\\frac{1}{2}(\\rho_L u_L + \\rho_L u_L) = \\rho_L u_L$。因此，对于超音速出口，数值质量通量就是简单地在内部状态下计算的物理质量通量：$f_m = \\rho_{int} u_{int}$。\n\n我们现在将此方法应用于每个测试用例。\n\n**测试用例1**\n-   给定：$\\gamma = 1.4$。\n-   入口原始变量：$\\rho_{in} = 1.0$ $\\mathrm{kg/m^3}$，$u_{in} = 600.0$ $\\mathrm{m/s}$，$p_{in} = 120000.0$ $\\mathrm{Pa}$。\n-   内部原始变量：$\\rho_{int} = 1.0$ $\\mathrm{kg/m^3}$，$u_{int} = 580.0$ $\\mathrm{m/s}$，$p_{int} = 110000.0$ $\\mathrm{Pa}$。\n\n**左边界质量通量, $f_{m,L}^{(1)}$：**\n-   状态 $L$：$(\\rho_L, u_L, p_L) = (1.0, 600.0, 120000.0)$。\n-   状态 $R$：$(\\rho_R, u_R, p_R) = (1.0, 580.0, 110000.0)$。\n-   声速：\n    -   $a_L = \\sqrt{1.4 \\cdot 120000.0 / 1.0} = \\sqrt{168000} \\approx 409.878$ $\\mathrm{m/s}$。\n    -   $a_R = \\sqrt{1.4 \\cdot 110000.0 / 1.0} = \\sqrt{154000} \\approx 392.428$ $\\mathrm{m/s}$。\n-   耗散系数：\n    -   $|u_L| + a_L = 600.0 + 409.878 = 1009.878$ $\\mathrm{m/s}$。\n    -   $|u_R| + a_R = 580.0 + 392.428 = 972.428$ $\\mathrm{m/s}$。\n    -   $\\alpha = \\max(1009.878, 972.428) = 1009.878$ $\\mathrm{m/s}$。\n-   Rusanov质量通量：\n    -   $f_{m,L}^{(1)} = \\frac{1}{2}(1.0 \\cdot 600.0 + 1.0 \\cdot 580.0) - \\frac{1}{2}(1009.878)(1.0 - 1.0) = \\frac{1}{2}(1180.0) - 0 = 590.0$ $\\mathrm{kg/(m^2\\cdot s)}$。\n\n**右边界质量通量, $f_{m,R}^{(1)}$：**\n-   使用超音速出口的简化公式：\n    -   $f_{m,R}^{(1)} = \\rho_{int} u_{int} = 1.0 \\cdot 580.0 = 580.0$ $\\mathrm{kg/(m^2\\cdot s)}$。\n\n**测试用例2**\n-   给定：$\\gamma = 1.4$。\n-   入口原始变量：$\\rho_{in} = 1.0$ $\\mathrm{kg/m^3}$，$u_{in} = \\sqrt{1.4 \\cdot 100000.0} \\approx 374.166$ $\\mathrm{m/s}$，$p_{in} = 100000.0$ $\\mathrm{Pa}$。\n-   内部原始变量：$\\rho_{int} = 1.0$ $\\mathrm{kg/m^3}$，$u_{int} = 400.0$ $\\mathrm{m/s}$，$p_{int} = 80000.0$ $\\mathrm{Pa}$。\n\n**左边界质量通量, $f_{m,L}^{(2)}$：**\n-   状态 $L$：$(\\rho_L, u_L, p_L) = (1.0, \\sqrt{140000}, 100000.0)$。\n-   状态 $R$：$(\\rho_R, u_R, p_R) = (1.0, 400.0, 80000.0)$。\n-   声速：\n    -   $a_L = \\sqrt{1.4 \\cdot 100000.0 / 1.0} = \\sqrt{140000} \\approx 374.166$ $\\mathrm{m/s}$。注意 $u_L = a_L$，因此入口流动是声速流（$M=1$）。\n    -   $a_R = \\sqrt{1.4 \\cdot 80000.0 / 1.0} = \\sqrt{112000} \\approx 334.664$ $\\mathrm{m/s}$。\n-   耗散系数：\n    -   $|u_L| + a_L = \\sqrt{140000} + \\sqrt{140000} = 2\\sqrt{140000} \\approx 748.331$ $\\mathrm{m/s}$。\n    -   $|u_R| + a_R = 400.0 + 334.664 = 734.664$ $\\mathrm{m/s}$。\n    -   $\\alpha = 2\\sqrt{140000} \\approx 748.331$ $\\mathrm{m/s}$。\n-   Rusanov质量通量：\n    -   $f_{m,L}^{(2)} = \\frac{1}{2}(1.0 \\cdot \\sqrt{140000} + 1.0 \\cdot 400.0) - \\frac{1}{2}(\\alpha)(1.0 - 1.0) = \\frac{1}{2}(\\sqrt{140000} + 400.0) \\approx 387.083$ $\\mathrm{kg/(m^2\\cdot s)}$。\n\n**右边界质量通量, $f_{m,R}^{(2)}$：**\n-   $f_{m,R}^{(2)} = \\rho_{int} u_{int} = 1.0 \\cdot 400.0 = 400.0$ $\\mathrm{kg/(m^2\\cdot s)}$。\n\n**测试用例3**\n-   给定：$\\gamma = 1.4$。\n-   入口原始变量：$\\rho_{in} = 0.9$ $\\mathrm{kg/m^3}$，$u_{in} = 1500.0$ $\\mathrm{m/s}$，$p_{in} = 50000.0$ $\\mathrm{Pa}$。\n-   内部原始变量：$\\rho_{int} = 0.95$ $\\mathrm{kg/m^3}$，$u_{int} = 1400.0$ $\\mathrm{m/s}$，$p_{int} = 60000.0$ $\\mathrm{Pa}$。\n\n**左边界质量通量, $f_{m,L}^{(3)}$：**\n-   状态 $L$：$(\\rho_L, u_L, p_L) = (0.9, 1500.0, 50000.0)$。\n-   状态 $R$：$(\\rho_R, u_R, p_R) = (0.95, 1400.0, 60000.0)$。\n-   声速：\n    -   $a_L = \\sqrt{1.4 \\cdot 50000.0 / 0.9} \\approx 278.887$ $\\mathrm{m/s}$。\n    -   $a_R = \\sqrt{1.4 \\cdot 60000.0 / 0.95} \\approx 297.357$ $\\mathrm{m/s}$。\n-   耗散系数：\n    -   $|u_L| + a_L = 1500.0 + 278.887 = 1778.887$ $\\mathrm{m/s}$。\n    -   $|u_R| + a_R = 1400.0 + 297.357 = 1697.357$ $\\mathrm{m/s}$。\n    -   $\\alpha = 1778.887$ $\\mathrm{m/s}$。\n-   Rusanov质量通量：\n    -   $f_{m,L}^{(3)} = \\frac{1}{2}(0.9 \\cdot 1500.0 + 0.95 \\cdot 1400.0) - \\frac{1}{2}(1778.887)(0.95 - 0.9)$。\n    -   $f_{m,L}^{(3)} = \\frac{1}{2}(1350.0 + 1330.0) - \\frac{1}{2}(1778.887)(0.05) = 1340.0 - 44.472 = 1295.528$ $\\mathrm{kg/(m^2\\cdot s)}$。\n\n**右边界质量通量, $f_{m,R}^{(3)}$：**\n-   $f_{m,R}^{(3)} = \\rho_{int} u_{int} = 0.95 \\cdot 1400.0 = 1330.0$ $\\mathrm{kg/(m^2\\cdot s)}$。\n\n结果总结：\n-   用例1：$(f_{m,L}^{(1)}, f_{m,R}^{(1)}) = (590.0, 580.0)$\n-   用例2：$(f_{m,L}^{(2)}, f_{m,R}^{(2)}) = (387.083, 400.0)$\n-   用例3：$(f_{m,L}^{(3)}, f_{m,R}^{(3)}) = (1295.528, 1330.0)$\n\n最终的实现将通过编程方式计算这些值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes numerical mass fluxes for supersonic inlet/outlet boundary conditions\n    using the Local Lax-Friedrichs (Rusanov) scheme.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is (gamma, (rho_in, u_in, p_in), (rho_int, u_int, p_int))\n    test_cases = [\n        (1.4, (1.0, 600.0, 120000.0), (1.0, 580.0, 110000.0)),\n        (1.4, (1.0, np.sqrt(1.4 * 100000.0), 100000.0), (1.0, 400.0, 80000.0)),\n        (1.4, (0.9, 1500.0, 50000.0), (0.95, 1400.0, 60000.0)),\n    ]\n\n    results = []\n    \n    def calculate_rusanov_mass_flux(prim_L, prim_R, gamma):\n        \"\"\"\n        Calculates the mass flux component of the Rusanov numerical flux.\n        prim_L and prim_R are tuples of (rho, u, p).\n        \"\"\"\n        rho_L, u_L, p_L = prim_L\n        rho_R, u_R, p_R = prim_R\n\n        # Speed of sound\n        a_L = np.sqrt(gamma * p_L / rho_L)\n        a_R = np.sqrt(gamma * p_R / rho_R)\n\n        # Dissipation coefficient alpha\n        alpha = max(abs(u_L) + a_L, abs(u_R) + a_R)\n        \n        # Physical mass fluxes\n        mass_flux_L = rho_L * u_L\n        mass_flux_R = rho_R * u_R\n        \n        # Rusanov mass flux\n        f_m = 0.5 * (mass_flux_L + mass_flux_R) - 0.5 * alpha * (rho_R - rho_L)\n        \n        return f_m\n\n    for case in test_cases:\n        gamma, inlet_prims, interior_prims = case\n        \n        # --- Left Boundary Mass Flux (Supersonic Inlet) ---\n        # The left state is the ghost cell, which holds the inlet conditions.\n        # The right state is the first interior cell.\n        prim_L = inlet_prims\n        prim_R = interior_prims\n        \n        f_m_L = calculate_rusanov_mass_flux(prim_L, prim_R, gamma)\n        results.append(f_m_L)\n        \n        # --- Right Boundary Mass Flux (Supersonic Outlet) ---\n        # The right ghost cell state is a copy of the last interior cell state.\n        # The numerical flux simplifies to the physical flux at the interior state.\n        rho_int, u_int, p_int = interior_prims\n        f_m_R = rho_int * u_int\n        results.append(f_m_R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3368205"}, {"introduction": "理想的、均匀的超声速出口在实际工程问题中很少见。更常见的情况是，出口附近的流动可能是非均匀的，甚至可能出现局部的亚声速区域或流动反转。本练习将带你超越理想情况，构建一个能够稳健处理这些复杂情况的混合式出口边界条件。[@problem_id:3368282] 你将应用特征线理论和黎曼不变量，根据局部马赫数 $M_n$ 来确定需要施加的物理条件数量，并实现一个平滑过渡的“混合”边界条件，以确保模拟的稳定性和物理真实性。这个练习旨在培养你为复杂的、接近实际的模拟开发高级边界条件的能力。", "problem": "考虑在具有指向外单位法向量的计算域出口处，对可压缩欧拉方程进行一维特征线分析。设域内紧邻出口的原始变量状态为 $(\\rho, u_n, p)$，其中 $\\rho$ 是密度，$u_n$ 是垂直于出口的速度分量（指向域外为正），$p$ 是静压。假设气体为量热完全气体，比热比为 $\\gamma$，且局部闭合关系为沿特征线的理想气体等熵关系。令声速为 $a = \\sqrt{\\gamma p / \\rho}$，并定义法向马赫数 $M_n = u_n/a$。该一维系统在法向上的特征波速为 $\\lambda_1 = u_n - a$，$\\lambda_2 = u_n$ 和 $\\lambda_3 = u_n + a$。入射特征线的数量等于符号为负的 $\\lambda_i$ 的个数。对于名义上的超声速出口，局部可能出现 $M_n$ 略小于 $1$ 的小区域。这些区域会改变所需边界条件的集合。\n\n仅从这些基本原理出发，推导所需标量边界条件的数量作为 $\\lambda_i$ 符号的函数，并构建一个稳健的混合亚声速/超声速出口处理方法，该方法根据 $M_n$ 进行切换，具体如下：\n- 对于 $M_n \\ge M_{\\text{up}}$（严格超声速）的出口流，不对双曲部分施加任何条件，并从内部外插所有原始变量。\n- 对于 $M_n \\le M_{\\text{low}}$（亚声速）的出口流，通过将静压指定为给定的参考值 $p_{\\text{ref}}$ 并保持来自内部的熵，施加恰好一个标量条件。使用特征线相容性计算边界速度。\n- 对于 $M_{\\text{low}}  M_n  M_{\\text{up}}$，使用切换函数 $s(M_n)$ 在这两个极限之间进行平滑混合。\n- 此外，处理出口处的局部回流（通过出口的入流）。对于亚声速入流，有两条特征线进入；通过强制使入射特征线和熵与储气库状态匹配，同时从内部获取出射特征线，从而从指定的储气库状态提供两个条件。对于超声速入流，有三条特征线进入；将边界状态设置为等于储气库状态。\n\n使用以下经过充分检验的公式和定义：\n- 等熵常数 $K = p/\\rho^\\gamma$。\n- 等熵流的黎曼不变量，$w^+ = u_n + \\dfrac{2a}{\\gamma-1}$ 沿 $\\dfrac{dx}{dt} = u_n + a$ 传播，以及 $w^- = u_n - \\dfrac{2a}{\\gamma-1}$ 沿 $\\dfrac{dx}{dt} = u_n - a$ 传播。\n- 对于亚声速出口流，从内部获取 $K$ 和 $w^+$，设置 $p = p_{\\text{ref}}$，并相容地恢复 $a$ 和 $u_n$。\n- 对于亚声速入流，从储气库获取 $K$ 和 $w^-$，从内部获取 $w^+$，然后相容地恢复 $a$、$u_n$、$\\rho$ 和 $p$。\n- 对于超声速入流，将 $(\\rho, u_n, p)$ 设置为等于储气库状态。\n\n您的程序必须实现这种混合处理方法，在近声速区带内使用一个线性切换函数，在阈值 $M_{\\text{low}} = 1 - \\delta$ 和 $M_{\\text{up}} = 1 + \\delta$ 之间进行平滑切换，其中 $\\delta$ 是给定的。具体来说，为出口流定义\n$$\ns(M_n) = \n\\begin{cases}\n1,  M_n \\le M_{\\text{low}},\\\\\n\\dfrac{M_{\\text{up}} - M_n}{M_{\\text{up}} - M_{\\text{low}}},  M_{\\text{low}}  M_n  M_{\\text{up}},\\\\\n0,  M_n \\ge M_{\\text{up}}.\n\\end{cases}\n$$\n然后通过以下方式计算出口流的边界状态\n$$\n\\begin{aligned}\n(\\rho, u_n, p)_{\\text{sup}} = (\\rho, u_n, p)_{\\text{int}},\\\\\n(\\rho, u_n, p)_{\\text{sub}}  \\quad p_{\\text{sub}} = p_{\\text{ref}}, \\quad K_{\\text{int}} = \\dfrac{p_{\\text{int}}}{\\rho_{\\text{int}}^\\gamma}, \\quad \\rho_{\\text{sub}} = \\left(\\dfrac{p_{\\text{sub}}}{K_{\\text{int}}}\\right)^{1/\\gamma}, \\\\\n\\qquad a_{\\text{sub}} = \\sqrt{\\dfrac{\\gamma p_{\\text{sub}}}{\\rho_{\\text{sub}}}}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1}, \\quad u_{n,\\text{sub}} = w^+_{\\text{int}} - \\dfrac{2 a_{\\text{sub}}}{\\gamma - 1},\\\\\n(\\rho, u_n, p)_{\\text{bc}} = (1-s)(\\rho, u_n, p)_{\\text{sup}} + s(\\rho, u_n, p)_{\\text{sub}}.\n\\end{aligned}\n$$\n对于通过出口的入流，使用储气库状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$：\n- 如果 $|M_n|  1$ 且 $u_n  0$ (亚声速入流)，计算\n$$\nK_\\infty = \\dfrac{p_\\infty}{\\rho_\\infty^\\gamma}, \\quad a_\\infty = \\sqrt{\\dfrac{\\gamma p_\\infty}{\\rho_\\infty}}, \\quad w^-_\\infty = u_{n,\\infty} - \\dfrac{2a_\\infty}{\\gamma - 1}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1},\n$$\n然后\n$$\na_{\\text{bc}} = \\dfrac{\\gamma - 1}{4}\\left(w^+_{\\text{int}} - w^-_\\infty\\right), \\quad u_{n,\\text{bc}} = \\dfrac{w^+_{\\text{int}} + w^-_\\infty}{2}, \\quad \n\\rho_{\\text{bc}} = \\left(\\dfrac{a_{\\text{bc}}^2}{\\gamma K_\\infty}\\right)^{\\!\\!1/(\\gamma - 1)}, \\quad p_{\\text{bc}} = K_\\infty \\rho_{\\text{bc}}^\\gamma.\n$$\n- 如果 $|M_n| \\ge 1$ 且 $u_n  0$ (超声速入流)，设置 $(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$。\n\n测试套件。使用以下国际单位制 (SI) 中的常数和状态：\n- $\\gamma = 1.4$，$\\delta = 0.05$，\n- 出口参考压力 $p_{\\text{ref}} = 101325\\,\\text{Pa}$，\n- 入流储气库状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty) = (1.2\\,\\text{kg/m}^3, -200\\,\\text{m/s}, 300000\\,\\text{Pa})$。\n\n定义六个具有内部状态 $(\\rho_{\\text{int}}, u_{n,\\text{int}}, p_{\\text{int}})$ 的测试用例：\n- 用例 A (严格超声速出口流): $(0.5\\,\\text{kg/m}^3, 600\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n- 用例 B (轻微亚声速出口流区域): $(0.5\\,\\text{kg/m}^3, 0.98\\,a_{\\text{int}}, 100000\\,\\text{Pa})$ 其中 $a_{\\text{int}} = \\sqrt{\\gamma p_{\\text{int}}/\\rho_{\\text{int}}}$。\n- 用例 C (近声速出口流, $M_n = 1.01$): $(0.5\\,\\text{kg/m}^3, 1.01\\,a_{\\text{int}}, 100000\\,\\text{Pa})$。\n- 用例 D (近声速出口流, $M_n = 0.99$): $(0.5\\,\\text{kg/m}^3, 0.99\\,a_{\\text{int}}, 100000\\,\\text{Pa})$。\n- 用例 E (通过出口的亚声速入流): $(0.5\\,\\text{kg/m}^3, -100\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n- 用例 F (通过出口的超声速入流): $(0.5\\,\\text{kg/m}^3, -600\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n\n任务。对每个测试用例，计算：\n- 入射特征线的整数数量 $n_{\\text{in}}$，即为负的 $\\lambda_i$ 的个数。\n- 法向马赫数 $M_n$。\n- 由上述混合处理方法产生的边界状态 $(\\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}})$。\n\n将 $\\rho_{\\text{bc}}$ 以 $\\text{kg/m}^3$ 表示，$u_{n,\\text{bc}}$ 以 $\\text{m/s}$ 表示，$p_{\\text{bc}}$ 以 $\\text{Pa}$ 表示。将所有浮点数输出四舍五入到六位小数。\n\n最终输出格式。您的程序应生成单行输出，其中包含按 A, B, C, D, E, F 顺序串联的六个测试用例的结果，每个用例贡献一个五元组 $[n_{\\text{in}}, M_n, \\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}}]$。将它们聚合到一行的单个列表中，形式为用方括号括起来的逗号分隔列表，例如 $[n_{\\text{in},A}, M_{n,A}, \\rho_{\\text{bc},A}, u_{n,\\text{bc},A}, p_{\\text{bc},A}, \\dots, n_{\\text{in},F}, M_{n,F}, \\rho_{\\text{bc},F}, u_{n,\\text{bc},F}, p_{\\text{bc},F}]$。", "solution": "该问题要求在一个计算流体动力学背景下，为一维出口实施一种混合亚声速/超声速边界条件处理方法。该分析基于可压缩欧拉方程的特征线理论。\n\n### 基于原理的设计：特征线分析\n\n双曲型偏微分方程（如欧拉方程）的基础是特征线法。对于一维欧拉方程，有三个特征波在流体中传播信息。在计算边界上，这种传播的方向决定了是需要来自域外的信息（边界条件），还是状态由域内流动决定。\n\n这些波相对于静止边界的传播速度由系统雅可比矩阵的特征值给出。对于具有指向外法向量的边界，且流体属性 $(\\rho, u_n, p)$ 分别代表密度、法向速度和压力，这些特征值为：\n- $\\lambda_1 = u_n - a$\n- $\\lambda_2 = u_n$\n- $\\lambda_3 = u_n + a$\n\n这里，$u_n$ 是垂直于出口的速度分量（出口流为正），$a = \\sqrt{\\gamma p / \\rho}$ 是当地声速。负特征值（$\\lambda_i  0$）表示特征波传播到计算域内，因此需要提供一个边界条件。正特征值（$\\lambda_i > 0$）表示波从域内传播出去，携带来自内部的信息。因此，所需边界条件的数量 $n_{\\text{in}}$ 就是负特征值的数量。\n\n出口处的流态通过法向马赫数 $M_n = u_n/a$ 进行分类。我们为每种流态分析特征值的符号：\n\n1.  **超声速出口流 ($u_n  0, M_n  1$)**: 由于 $u_n  a$，所有三个特征值都为正：$\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，$\\lambda_3 = u_n + a  0$。所有信息都从域内传播出去。因此，$n_{\\text{in}} = 0$，不施加任何边界条件。边界上的状态完全由内部流动决定，通常通过外插得到。\n\n2.  **亚声速出口流 ($u_n  0, 0  M_n  1$)**: 由于 $0  u_n  a$，我们有 $\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$ 和 $\\lambda_3 = u_n + a  0$。一条特征线进入域内。因此，$n_{\\text{in}} = 1$，必须提供一个标量边界条件。对于亚声速出口，通常指定静压 $p_{\\text{bc}} = p_{\\text{ref}}$。\n\n3.  **亚声速入流 ($u_n  0, |M_n|  1$)**: 由于 $-a  u_n  0$，我们有 $\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$ 和 $\\lambda_3 = u_n + a  0$。两条特征线进入域内。因此，$n_{\\text{in}} = 2$，需要两个标量条件。这些条件通常从远场或储气库状态提供。\n\n4.  **超声速入流 ($u_n  0, |M_n|  1$)**: 由于 $u_n  -a$，所有三个特征值都为负：$\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$ 和 $\\lambda_3 = u_n + a  0$。所有信息都从外部传播到域内。因此，$n_{\\text{in}} = 3$，整个流动状态 ($\\rho, u_n, p$) 必须由储气库指定。\n\n### 基于特征线的算法实现\n\n问题提供了使用称为黎曼不变量 ($w^+, w^-$) 的特征变量和熵（通过等熵常数 $K = p/\\rho^\\gamma$）来实现这些条件的具体公式。\n\n**出口流 ($u_n \\ge 0$):**\n一个稳健的处理方法必须平滑地处理亚声速和超声速出口流之间的过渡。问题定义了一种在跨声速区域 $M_{\\text{low}}  M_n  M_{\\text{up}}$（其中 $M_{\\text{low}} = 1 - \\delta$ 和 $M_{\\text{up}} = 1 + \\delta$）使用切换函数 $s(M_n)$ 的混合方法。\n边界状态 $(\\rho, u_n, p)_{\\text{bc}}$ 是一个加权平均值：\n$$(\\rho, u_n, p)_{\\text{bc}} = (1-s(M_n))(\\rho, u_n, p)_{\\text{sup}} + s(M_n)(\\rho, u_n, p)_{\\text{sub}}$$\n-   超声速状态 $(\\rho, u_n, p)_{\\text{sup}}$ 就是外插的内部状态 $(\\rho, u_n, p)_{\\text{int}}$，与 $n_{\\text{in}}=0$ 一致。\n-   亚声速状态 $(\\rho, u_n, p)_{\\text{sub}}$ 是通过施加一个条件（$p_{\\text{sub}} = p_{\\text{ref}}$）并使用来自内部的两条出射特征线的信息来计算的。这是通过保持来自内部状态的黎曼不变量 $w^+ = u_n + \\frac{2a}{\\gamma-1}$ 和等熵常数 $K = p/\\rho^\\gamma$ 来实现的。已知 $p_{\\text{sub}}$ 和 $K_{\\text{int}}$ 后，可以求得 $\\rho_{\\text{sub}}$ 和 $a_{\\text{sub}}$。然后，从守恒的 $w^+_{\\text{int}}$ 求得 $u_{n,\\text{sub}}$。\n\n**入流 ($u_n  0$):**\n-   **亚声速入流 ($|M_n|  1$, $n_{\\text{in}}=2$)**: 需要两个条件。通过从储气库状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$ 获取两条入射特征线的属性，并从内部获取一条出射特征线的属性来构建边界条件。这意味着入射的黎曼不变量 $w^- = u_n - \\frac{2a}{\\gamma-1}$ 和熵（通过 $K$）被设置为其储气库值 ($w^-_\\infty, K_\\infty$)。出射的黎曼不变量 $w^+$ 从内部获取 ($w^+_{\\text{int}}$)。这提供了一个方程组来求解边界状态 $(\\rho, u_n, p)_{\\text{bc}}$。\n-   **超声速入流 ($|M_n| \\ge 1$, $n_{\\text{in}}=3$)**: 所有信息都来自外部。边界状态简单地设置为储气库状态：$(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$。\n\n以下程序为指定的测试用例实现了这一逻辑。它首先计算内部马赫数 $M_n$ 和入射特征线的数量 $n_{\\text{in}}$。然后，它根据 $u_n$ 的符号和 $M_n$ 的值应用适当的逻辑来确定最终的边界状态。", "answer": "```python\nimport numpy as np\n\n# Global constants from the problem statement\nGAMMA = 1.4\nDELTA = 0.05\nP_REF = 101325.0\nRHO_INF = 1.2\nU_N_INF = -200.0\nP_INF = 300000.0\n\ndef solve():\n    \"\"\"\n    Solves the mixed supersonic/subsonic outlet boundary condition problem\n    for a series of test cases.\n    \"\"\"\n    \n    m_low = 1.0 - DELTA\n    m_up = 1.0 + DELTA\n\n    # Pre-calculate reservoir properties\n    a_inf = np.sqrt(GAMMA * P_INF / RHO_INF)\n    k_inf = P_INF / (RHO_INF**GAMMA)\n    w_minus_inf = U_N_INF - 2.0 * a_inf / (GAMMA - 1.0)\n    \n    # Define test cases. For cases with u_n defined relative to a_int,\n    # we first calculate a_int and then u_n.\n    p_base_int = 100000.0\n    rho_base_int = 0.5\n    a_base_int = np.sqrt(GAMMA * p_base_int / rho_base_int)\n\n    test_cases = [\n        # Case A (strict supersonic outflow)\n        (rho_base_int, 600.0, p_base_int),\n        # Case B (slightly subsonic outflow pocket)\n        (rho_base_int, 0.98 * a_base_int, p_base_int),\n        # Case C (near-sonic outflow, M_n = 1.01)\n        (rho_base_int, 1.01 * a_base_int, p_base_int),\n        # Case D (near-sonic outflow, M_n = 0.99)\n        (rho_base_int, 0.99 * a_base_int, p_base_int),\n        # Case E (subsonic inflow through the outlet)\n        (rho_base_int, -100.0, p_base_int),\n        # Case F (supersonic inflow through the outlet)\n        (rho_base_int, -600.0, p_base_int),\n    ]\n\n    final_results = []\n\n    for rho_int, u_n_int, p_int in test_cases:\n        a_int = np.sqrt(GAMMA * p_int / rho_int)\n        m_n_int = u_n_int / a_int if a_int != 0 else 0.0\n\n        # Task 1: Calculate the number of incoming characteristics\n        lambda1 = u_n_int - a_int\n        lambda2 = u_n_int\n        lambda3 = u_n_int + a_int\n        n_in = sum(1 for lam in [lambda1, lambda2, lambda3] if lam  0)\n\n        rho_bc, u_n_bc, p_bc = 0.0, 0.0, 0.0\n\n        # Task 3: Compute boundary state based on flow regime\n        if u_n_int >= 0:  # Outflow\n            # Supersonic limit state (extrapolation)\n            rho_sup, u_n_sup, p_sup = rho_int, u_n_int, p_int\n\n            # Subsonic limit state (pressure-based)\n            p_sub = P_REF\n            k_int = p_int / (rho_int**GAMMA)\n            rho_sub = (p_sub / k_int)**(1.0 / GAMMA)\n            a_sub = np.sqrt(GAMMA * p_sub / rho_sub)\n            w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n            u_n_sub = w_plus_int - 2.0 * a_sub / (GAMMA - 1.0)\n            \n            # Blending function s(M_n)\n            s = 0.0\n            if m_n_int = m_low:\n                s = 1.0\n            elif m_low  m_n_int  m_up:\n                s = (m_up - m_n_int) / (m_up - m_low)\n            \n            # Blended boundary state\n            rho_bc = (1.0 - s) * rho_sup + s * rho_sub\n            u_n_bc = (1.0 - s) * u_n_sup + s * u_n_sub\n            p_bc = (1.0 - s) * p_sup + s * p_sub\n            \n        else:  # Inflow (reversed flow)\n            if abs(m_n_int)  1.0: # Subsonic inflow\n                w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n                \n                a_bc = (GAMMA - 1.0) / 4.0 * (w_plus_int - w_minus_inf)\n                u_n_bc = 0.5 * (w_plus_int + w_minus_inf)\n                rho_bc = (a_bc**2 / (GAMMA * k_inf))**(1.0 / (GAMMA - 1.0))\n                p_bc = k_inf * rho_bc**GAMMA\n            else: # Supersonic inflow\n                rho_bc, u_n_bc, p_bc = RHO_INF, U_N_INF, P_INF\n\n        # Store results for this case, rounded to 6 decimal places\n        final_results.extend([\n            n_in,\n            round(m_n_int, 6),\n            round(rho_bc, 6),\n            round(u_n_bc, 6),\n            round(p_bc, 6)\n        ])\n\n    # Format the final output string as a comma-separated list in brackets\n    output_str = \"[\" + \",\".join(map(str, final_results)) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "3368282"}, {"introduction": "在掌握了边界条件的基础和高级实现技术后，现在是时候将这些知识应用于一个关键的航空航天工程问题了。在本练习中，你将构建一个完整的一维欧拉方程求解器，模拟超燃冲压发动机（SCRAMJET）隔离段中的复杂流动。[@problem_id:3368199] 通过在出口施加一个随时间变化的背压，你将研究激波如何向上游传播，并利用你学到的边界条件知识来预测发动机是否会发生“不启动”（unstart）这一灾难性故障。这项综合性实践将数值方法与物理预测和工程设计直接联系起来，展示了稳健的边界条件对于分析复杂瞬态现象的至关重要性。", "problem": "考虑一个代表超燃冲压发动机（SCRAMJET）进气道-隔离段的等截面隔离段管道，该管道被建模为受无粘欧拉方程和理想气体状态方程控制的一维可压缩流。任务是通过仿真和基于原理的推理，确定当出口背压随时间斜坡式增长时，哪些给定的超声速入口和出口边界条件组合能够抑制不启动现象。最终答案必须是一个完整的、可运行的程序。\n\n对于量热完全气体，其控制守恒律为一维欧拉方程，以质量、动量和总能量的守恒形式表示。理想气体状态方程以及原始变量、声速和马赫数的定义均适用。超声速入口和出口边界条件应根据特征线相容性来施加：在超声速入口处，所有特征信息都进入计算域；而在亚声速出口条件下，有一条特征线进入计算域，并且可以给定静压。计算方法必须是一种一致的、遵循守恒性、特征线方向和因果律的第一性原理离散化方法。\n\n您必须从以下基本原理和经过充分检验的事实出发，进行推导和算法设计：\n- 量热完全气体的一维可压缩欧拉方程，其守恒状态向量和通量由密度、速度、压力和总能量定义，以及包含比热比和气体常数的理想气体定律。\n- 双曲型系统中的特征线概念，包括在超声速入口处，所有特征线指向域内，所有原始变量均可给定；在亚声速出口处，一条特征线进入域内，可以一致地给定压力。\n- 等截面管道中量热完全气体的正激波关系式，用于推断在不改变上游状态的情况下，给定上游超声速马赫数所能达到的最大下游静压。\n- 因果性约束，即信息在亚声速区形成之前，不能通过特征线在超声速区向上游传播。\n\n程序必须实现一个一维有限体积戈杜诺夫类求解器，该求解器具有鲁棒的近似黎曼通量（例如，Harten–Lax–van Leer–Einfeldt (HLLE) 通量）、基于 Courant–Friedrichs–Lewy (CFL) 条件的时间步长以及物理上一致的边界条件。超声速入口边界条件必须给定由总温总压条件和入口马赫数推导出的静态参数。当出口为亚声速时，出口边界条件必须给定一个随时间变化的静压斜坡，否则应避免施加非物理约束。计算域是一个长度为 $L$ 的等截面管道，离散为 $N$ 个大小为 $\\Delta x$ 的均匀控制体，积分进行到指定的最终时间 $t_{\\text{final}}$。\n\n不启动检测必须基于物理上有意义的判据。定义不启动发生：如果紧邻入口的单元内的马赫数变得严格亚声速（即小于1），并在压力斜坡开始期间或之后，于此状态下持续至少5个连续时间步。如果仿真时间范围内未发生不启动，则宣布不启动被抑制。为保证数值鲁棒性，您必须为密度和压力设置下限值以保持正性，并使用一个适中的 CFL 数。\n\n所有物理量必须使用并以国际单位制（SI单位）报告。压力必须以帕斯卡（Pa）为单位，温度以开尔文（K）为单位，长度以米（m）为单位，时间以秒（s）为单位。不使用角度单位。所有分数量应根据需要按小数或有理数处理，但最终输出为布尔值。\n\n您的程序必须评估以下测试套件，该套件涵盖了不同的边界条件组合和斜坡设定：\n\n- 测试用例 1 (正常路径)：$\\gamma = 1.4$, $R = 287\\,\\mathrm{J/(kg\\cdot K)}$, $L = 1.0\\,\\mathrm{m}$, $N = 120$, $t_{\\text{final}} = 0.004\\,\\mathrm{s}$, $\\text{CFL} = 0.5$, 入口总温 $T_0 = 1200\\,\\mathrm{K}$, 入口总压 $p_0 = 200000\\,\\mathrm{Pa}$, 入口马赫数 $M_{\\text{in}} = 2.0$。根据 $(T_0, p_0, M_{\\text{in}})$ 使用量热完全气体的等熵关系式计算初始静态参数 $(p_1, T_1, u_1, \\rho_1)$。设置出口基础静压 $p_{\\text{out,base}} = p_1$。定义出口峰值静压 $p_{\\text{out,peak}} = 0.93\\,p_2$，其中 $p_2$ 是在上游马赫数为 $M_{\\text{in}}$ 的条件下，正激波位于等截面管道出口处时，紧随其后的下游静压。出口压力斜坡为 $p_{\\text{out}}(t) = p_{\\text{out,base}} + \\left(p_{\\text{out,peak}} - p_{\\text{out,base}}\\right)\\,\\min\\!\\left(1, \\frac{t}{t_{\\text{ramp}}}\\right)$，其中 $t_{\\text{ramp}} = 0.001\\,\\mathrm{s}$。\n\n- 测试用例 2 (激进斜坡)：气体和几何参数与测试用例1相同，但 $t_{\\text{final}} = 0.006\\,\\mathrm{s}$ 且 $M_{\\text{in}} = 2.0$。设置 $p_{\\text{out,base}} = p_1$ 和 $p_{\\text{out,peak}} = 1.20\\,p_2$。使用 $t_{\\text{ramp}} = 0.002\\,\\mathrm{s}$。\n\n- 测试用例 3 (边界敏感性，较低入口马赫数)：气体和几何参数相同，但 $t_{\\text{final}} = 0.004\\,\\mathrm{s}$ 且 $M_{\\text{in}} = 1.5$。根据 $(T_0, p_0, M_{\\text{in}})$ 计算 $p_1$，并设置 $p_{\\text{out,base}} = p_1$ 和 $p_{\\text{out,peak}} = 1.05\\,p_2$（其中 $p_2$ 根据 $M_{\\text{in}} = 1.5$ 时的正激波关系式计算）。使用 $t_{\\text{ramp}} = 0.001\\,\\mathrm{s}$。\n\n- 测试用例 4 (超声速出口状态，小斜坡)：气体和几何参数相同，但 $t_{\\text{final}} = 0.004\\,\\mathrm{s}$ 且 $M_{\\text{in}} = 2.5$。根据 $(T_0, p_0, M_{\\text{in}})$ 计算 $p_1$，并设置 $p_{\\text{out,base}} = p_1$ 和 $p_{\\text{out,peak}} = 0.50\\,p_2$（其中 $p_2$ 根据 $M_{\\text{in}} = 2.5$ 时的正激波关系式计算）。使用 $t_{\\text{ramp}} = 0.001\\,\\mathrm{s}$。\n\n对于每个测试用例，您的程序必须：\n- 使用与给定入口总压总温条件和 $M_{\\text{in}}$ 相对应的均匀静态参数来初始化管道。\n- 使用带 HLLE 通量和满足 CFL 条件的时间步长的一阶守恒有限体积法，将解在时间上推进到 $t_{\\text{final}}$。\n- 通过在每个时间步为左侧虚拟单元指定由 $(T_0, p_0, M_{\\text{in}})$ 推导出的静态原始变量，来施加超声速入口边界条件。通过为右侧虚拟单元指定静压，并从最后一个内部单元外插速度和密度以保持一致性，以及根据指定的压力和外插的速度、密度计算虚拟单元的总能量，来施加出口压力斜坡。\n- 在斜坡进行过程中，若任意时刻 $t \\ge 0$，紧邻入口的第一个内部单元的马赫数低于1并持续至少5个连续时间步，则检测为不启动。否则，宣布不启动被抑制。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，`[result1,result2,result3,result4]`），其中每个结果是一个布尔值，表示相应测试用例的不启动是否被抑制（True）或未被抑制（False），顺序与上面列出的一致。所有内部计算必须一致使用国际单位制（SI单位），并遵循量热完全气体的理想气体定律。", "solution": "确定 SCRAMJET 隔离段管道中不启动抑制的问题是计算气体动力学中的一个适定问题。它的科学基础是一维欧拉方程和双曲型偏微分方程理论。所提供的参数和条件是完整、一致且物理上现实的，允许进行直接数值模拟。我们将基于第一性原理的有限体积法来构建解决方案。\n\n### 1. 控制方程和状态变量\n\n流体流动由针对无粘、可压缩、量热完全气体的一维欧拉方程建模。其守恒形式为：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0\n$$\n此处，$t$ 是时间，$x$ 是空间坐标，$\\mathbf{U}$ 是守恒量向量，$\\mathbf{F}(\\mathbf{U})$ 是通量向量。它们定义如下：\n$$\n\\mathbf{U} = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad\n\\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (E+p)u \\end{bmatrix}\n$$\n此处，$\\rho$ 是流体密度，$u$ 是速度，$p$ 是静压，$E$ 是单位体积总能量。\n\n该方程组通过理想气体定律和总能量的定义来封闭：\n$$\np = \\rho R T\n$$\n$$\nE = \\rho e + \\frac{1}{2}\\rho u^2 = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\n$$\n其中 $T$ 是温度，$R$ 是比气体常数，$\\gamma$ 是比热比，$e = c_v T$ 是比内能。这些关系允许在守恒变量向量 $\\mathbf{U} = [U_1, U_2, U_3]^T$ 和原始变量向量 $\\mathbf{W} = [\\rho, u, p]^T$ 之间进行转换。\n\n从守恒变量到原始变量的转换：\n$$\n\\rho = U_1, \\quad u = \\frac{U_2}{U_1}, \\quad p = (\\gamma-1)\\left(U_3 - \\frac{1}{2}\\frac{U_2^2}{U_1}\\right)\n$$\n声速 $a$ 和马赫数 $M$ 由下式给出：\n$$\na = \\sqrt{\\frac{\\gamma p}{\\rho}}, \\quad M = \\frac{u}{a}\n$$\n\n### 2. 数值方法：有限体积格式\n\n我们采用一阶有限体积法。长度为 $L$ 的管道被划分为 $N$ 个均匀单元，每个单元的宽度为 $\\Delta x = L/N$。单元 $i$ 中单元平均状态 $\\mathbf{U}_i$ 的半离散欧拉方程为：\n$$\n\\frac{d\\mathbf{U}_i}{dt} = -\\frac{1}{\\Delta x}(\\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2})\n$$\n其中 $\\mathbf{F}_{i\\pm 1/2}$ 代表单元交界面上的数值通量。我们使用一阶向前欧拉法进行时间积分：\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x}(\\mathbf{F}_{i+1/2}^n - \\mathbf{F}_{i-1/2}^n)\n$$\n时间步长 $\\Delta t$ 根据 Courant-Friedrichs-Lewy (CFL) 稳定性条件动态计算：\n$$\n\\Delta t = \\text{CFL} \\cdot \\min_{i} \\left( \\frac{\\Delta x}{|u_i| + a_i} \\right)\n$$\n其中最小值取自域内所有单元，$\\text{CFL}$ 是一个小于1的数（给定为0.5）。\n\n### 3. HLLE 近似黎曼求解器\n\n位于单元 $i$（左状态 $\\mathbf{U}_L = \\mathbf{U}_i$）和单元 $i+1$（右状态 $\\mathbf{U}_R = \\mathbf{U}_{i+1}$）之间交界面上的数值通量 $\\mathbf{F}_{i+1/2}$ 使用 Harten-Lax-van Leer-Einfeldt (HLLE) 格式计算。该格式是鲁棒的，并能保证密度和压力的正性。HLLE 通量为：\n$$\n\\mathbf{F}_{HLLE}(\\mathbf{U}_L, \\mathbf{U}_R) = \\frac{S_R \\mathbf{F}(\\mathbf{U}_L) - S_L \\mathbf{F}(\\mathbf{U}_R) + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\n波速估计值 $S_L$ 和 $S_R$ 至关重要。我们使用基于交界面相邻左右状态的 Davis 估计法：\n$$\nS_L = \\min(u_L - a_L, u_R - a_R)\n$$\n$$\nS_R = \\max(u_L + a_L, u_R + a_R)\n$$\n\n### 4. 初始条件和边界条件\n\n仿真需要指定流动的初始状态以及入口和出口的边界条件。\n\n**初始条件**：管道以对应于入口条件的均匀超声速流进行初始化。给定总温 $T_0$、总压 $p_0$ 和入口马赫数 $M_{\\text{in}}$，静态参数（用下标1表示）通过等熵流关系式求得：\n$$\nT_1 = \\frac{T_0}{1 + \\frac{\\gamma-1}{2} M_{\\text{in}}^2}\n$$\n$$\np_1 = \\frac{p_0}{\\left(1 + \\frac{\\gamma-1}{2} M_{\\text{in}}^2\\right)^{\\gamma/(\\gamma-1)}}\n$$\n由此，我们计算 $\\rho_1 = p_1 / (R T_1)$ 和 $u_1 = M_{\\text{in}} \\sqrt{\\gamma R T_1}$。然后从 $(\\rho_1, u_1, p_1)$ 计算初始守恒状态向量 $\\mathbf{U}_{init}$，并应用于所有 $N$ 个单元。\n\n**边界条件**：我们使用计算域两端的虚拟单元（入口处为单元-1，出口处为单元N）来施加边界条件。\n\n- **入口（超声速）**：由于入口流动是超声速的（$M_{\\text{in}}  1$），所有三个特征线都进入计算域。因此，所有流动属性都可以也必须被指定。入口虚拟单元中的状态向量在所有时间内都是固定的：\n$$\n\\mathbf{U}_{-1}^n = \\mathbf{U}_{init} \\quad \\forall n\n$$\n\n- **出口**：出口处的边界条件模拟了对下游背压的响应。按照指示，在出口虚拟单元处给定一个压力。这代表了隔离段排入一个具有指定压力的静压室（燃烧室）的物理情况。虚拟单元状态 $\\mathbf{U}_N^n$ 的构建如下：\n    1. 给定静压：$p_N^n = p_{\\text{out}}(t^n)$。压力斜坡由下式给出：\n       $$\n       p_{\\text{out}}(t) = p_{\\text{out,base}} + (p_{\\text{out,peak}} - p_{\\text{out,base}}) \\min\\left(1, \\frac{t}{t_{\\text{ramp}}}\\right)\n       $$\n    2. 从最后一个内部单元（$i=N-1$）外插密度和速度：\n       $$\n       \\rho_N^n = \\rho_{N-1}^n, \\quad u_N^n = u_{N-1}^n\n       $$\n    3. 从其原始变量计算虚拟单元的总能量：\n       $$\n       E_N^n = \\frac{p_N^n}{\\gamma-1} + \\frac{1}{2}\\rho_N^n (u_N^n)^2\n       $$\n此过程通过在出口交界面 $x_{N-1/2}$ 处求解黎曼问题，将背压信息正确地引入计算域。\n\n### 5. 不启动判据和逻辑\n\n不启动是一种关键的失效模式，即激波系被从进气道中排出。这是由过高的背压导致激波完全向上游传播而引发的。在等截面管道中，超声速流在不受上游影响的情况下所能承受的最大背压是正激波后的静压 $p_2$。该值由 Rankine-Hugoniot 关系式给出：\n$$\n\\frac{p_2}{p_1} = 1 + \\frac{2\\gamma}{\\gamma+1} (M_{\\text{in}}^2 - 1)\n$$\n测试用例是相对于此压力 $p_2$ 定义的。\n\n在数值上，如果不启动检测到第一个内部单元（$i=0$）中的流动变为亚声速（$M_0  1$）并持续5个连续时间步，则判断为不启动。一个计数器跟踪这些连续的亚声速步。如果计数器达到5，则设置一个不启动标志，该测试用例的仿真终止。如果仿真在 $t_{\\text{final}}$ 前完成而未满足此条件，则认为不启动被抑制。\n\n预期结果如下：\n- **情况1 ($p_{\\text{out,peak}}  p_2$)**: 不启动应被抑制。\n- **情况2 ($p_{\\text{out,peak}}  p_2$)**: 预计会发生不启动。\n- **情况3 ($p_{\\text{out,peak}}  p_2$)**: 入口马赫数较低（$M_{\\text{in}}=1.5$），系统对压力扰动的抵抗能力较弱。预计会发生不启动。\n- **情况4 ($p_{\\text{out,peak}}  p_2$)**: 尽管入口马赫数很高（$M_{\\text{in}}=2.5$），但施加的背压远低于理论极限 $p_2$。在出口处产生的激波应稳定在管道内部。不启动应被抑制。\n\n最终的程序实现了这整套逻辑，遍历每个测试用例并报告结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the SCRAMJET unstart problem for the given test cases.\n    \"\"\"\n\n    class EulerSolver1D:\n        \"\"\"\n        A 1D Euler solver for simulating flow in a SCRAMJET isolator.\n        \"\"\"\n        def __init__(self, gamma, R, L, N, CFL, T0, p0, M_in, \n                     t_final, p_out_base_factor, p_out_peak_factor, t_ramp):\n            # Physical and numerical parameters\n            self.gamma = gamma\n            self.R = R\n            self.L = L\n            self.N = N\n            self.CFL = CFL\n            self.t_final = t_final\n            self.t_ramp = t_ramp\n\n            # Grid setup\n            self.dx = self.L / self.N\n            self.x = np.linspace(-self.dx / 2, self.L + self.dx / 2, self.N + 2)\n\n            # Initial and boundary condition parameters\n            self.T0 = T0\n            self.p0 = p0\n            self.M_in = M_in\n\n            # Derived initial conditions\n            self.T1 = self.T0 / (1 + (self.gamma - 1) / 2 * self.M_in**2)\n            self.p1 = self.p0 / (1 + (self.gamma - 1) / 2 * self.M_in**2)**(self.gamma / (self.gamma - 1))\n            self.rho1 = self.p1 / (self.R * self.T1)\n            self.a1 = np.sqrt(self.gamma * self.R * self.T1)\n            self.u1 = self.M_in * self.a1\n            self.U_init = self._prim_to_cons(np.array([self.rho1, self.u1, self.p1]))\n            \n            # Outlet pressure ramp parameters\n            p2_ratio = 1 + (2 * self.gamma / (self.gamma + 1)) * (self.M_in**2 - 1)\n            self.p2 = self.p1 * p2_ratio\n            self.p_out_base = p_out_base_factor * self.p1 if p_out_base_factor is not None else self.p1\n            self.p_out_peak = p_out_peak_factor * self.p2\n\n            # State vector U = [rho, rho*u, E]\n            # N computational cells + 2 ghost cells\n            self.U = np.zeros((self.N + 2, 3))\n            self.U[1:-1, :] = self.U_init\n            \n            # Positivity floors\n            self.rho_floor = 1e-6\n            self.p_floor = 1e-6\n\n        def _prim_to_cons(self, W):\n            rho, u, p = W\n            rho_u = rho * u\n            E = p / (self.gamma - 1) + 0.5 * rho * u**2\n            return np.array([rho, rho_u, E])\n\n        def _cons_to_prim(self, U):\n            rho, rho_u, E = U.T\n            # Apply floors to conservative variables before conversion\n            rho = np.maximum(self.rho_floor, rho)\n            # Ensure E is consistent with floored pressure\n            u = rho_u / rho\n            p_check = (self.gamma - 1) * (E - 0.5 * rho * u**2)\n            E = np.where(p_check  self.p_floor, self.p_floor / (self.gamma - 1) + 0.5 * rho * u**2, E)\n            \n            # Proceed with conversion\n            u = rho_u / rho\n            p = (self.gamma - 1) * (E - 0.5 * rho * u**2)\n            \n            # Apply floors to primitive variables\n            rho = np.maximum(self.rho_floor, rho)\n            p = np.maximum(self.p_floor, p)\n\n            return np.vstack([rho, u, p]).T\n\n        def _compute_flux(self, U):\n            W = self._cons_to_prim(U)\n            rho, u, p = W.T\n            rho_u = rho * u\n            E = U[:, 2]\n            F = np.zeros_like(U)\n            F[:, 0] = rho_u\n            F[:, 1] = rho_u * u + p\n            F[:, 2] = (E + p) * u\n            return F\n\n        def _apply_bcs(self, t):\n            # Inlet (left ghost cell, index 0)\n            self.U[0, :] = self.U_init\n\n            # Outlet (right ghost cell, index N+1)\n            p_out = self.p_out_base + (self.p_out_peak - self.p_out_base) * min(1.0, t / self.t_ramp)\n            \n            W_last_interior = self._cons_to_prim(self.U[self.N:self.N+1, :])[0]\n            rho_ghost, u_ghost = W_last_interior[0], W_last_interior[1]\n            p_ghost = p_out\n            \n            self.U[-1, :] = self._prim_to_cons(np.array([rho_ghost, u_ghost, p_ghost]))\n        \n        def run(self):\n            t = 0.0\n            unstart_counter = 0\n            \n            while t  self.t_final:\n                # Apply boundary conditions\n                self._apply_bcs(t)\n\n                # Convert all conservative states to primitive\n                W = self._cons_to_prim(self.U)\n                rho, u, p = W.T\n                a = np.sqrt(self.gamma * p / rho)\n                \n                # Calculate time step from CFL condition\n                max_speed = np.max(np.abs(u) + a)\n                dt = self.CFL * self.dx / max_speed\n                if t + dt > self.t_final:\n                    dt = self.t_final - t\n                \n                # HLLE Flux Calculation\n                F = self._compute_flux(self.U)\n                \n                # Wave speeds for all interfaces\n                u_L, u_R = u[:-1], u[1:]\n                a_L, a_R = a[:-1], a[1:]\n                \n                S_L = np.minimum(u_L - a_L, u_R - a_R)\n                S_R = np.maximum(u_L + a_L, u_R + a_R)\n                \n                # HLLE flux formula\n                # Need to avoid division by zero if S_R == S_L\n                # Although unlikely for HLLE with Davis estimate\n                denom = S_R - S_L\n                denom[denom == 0] = 1e-9\n\n                F_L, F_R = F[:-1], F[1:]\n                U_L, U_R = self.U[:-1], self.U[1:]\n                \n                F_h = (S_R[:, np.newaxis] * F_L - S_L[:, np.newaxis] * F_R +\n                       S_L[:, np.newaxis] * S_R[:, np.newaxis] * (U_R - U_L)) / denom[:, np.newaxis]\n\n                # Update step (first-order Euler)\n                self.U[1:-1, :] -= (dt / self.dx) * (F_h[1:, :] - F_h[:-1, :])\n\n                # Unstart detection in first interior cell (index 1)\n                W_first_cell = self._cons_to_prim(self.U[1:2, :])[0]\n                rho_fc, u_fc, p_fc = W_first_cell\n                a_fc = np.sqrt(self.gamma * p_fc / rho_fc)\n                M_fc = u_fc / a_fc\n\n                if M_fc  1.0:\n                    unstart_counter += 1\n                else:\n                    unstart_counter = 0\n\n                if unstart_counter >= 5:\n                    return False  # Unstart occurred\n\n                t += dt\n                if t >= self.t_final:\n                    break\n\n            return True  # Unstart suppressed\n\n    test_cases = [\n        # Case 1: Happy path\n        {'gamma': 1.4, 'R': 287.0, 'L': 1.0, 'N': 120, 'CFL': 0.5,\n         'T0': 1200.0, 'p0': 200000.0, 'M_in': 2.0, 't_final': 0.004,\n         'p_out_base_factor': 1.0, 'p_out_peak_factor': 0.93, 't_ramp': 0.001},\n        # Case 2: Aggressive ramp\n        {'gamma': 1.4, 'R': 287.0, 'L': 1.0, 'N': 120, 'CFL': 0.5,\n         'T0': 1200.0, 'p0': 200000.0, 'M_in': 2.0, 't_final': 0.006,\n         'p_out_base_factor': 1.0, 'p_out_peak_factor': 1.20, 't_ramp': 0.002},\n        # Case 3: Lower inlet Mach\n        {'gamma': 1.4, 'R': 287.0, 'L': 1.0, 'N': 120, 'CFL': 0.5,\n         'T0': 1200.0, 'p0': 200000.0, 'M_in': 1.5, 't_final': 0.004,\n         'p_out_base_factor': 1.0, 'p_out_peak_factor': 1.05, 't_ramp': 0.001},\n        # Case 4: High inlet Mach, small relative ramp\n        {'gamma': 1.4, 'R': 287.0, 'L': 1.0, 'N': 120, 'CFL': 0.5,\n         'T0': 1200.0, 'p0': 200000.0, 'M_in': 2.5, 't_final': 0.004,\n         'p_out_base_factor': 1.0, 'p_out_peak_factor': 0.50, 't_ramp': 0.001},\n    ]\n\n    results = []\n    for case in test_cases:\n        solver = EulerSolver1D(**case)\n        unstart_suppressed = solver.run()\n        results.append(unstart_suppressed)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3368199"}]}