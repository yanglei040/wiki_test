{"hands_on_practices": [{"introduction": "在计算流体动力学中，我们通常通过监测残差的范数来判断迭代求解器的收敛性。然而，残差的原始幅值本身可能具有误导性，因为它取决于问题的尺度和离散化。本练习 [@problem_id:3305239] 旨在通过一个动手编程任务，让您亲身体验不同残差归一化策略（例如，通过初始残差、右端项或雅可比矩阵对角线进行缩放）如何影响表观收敛性，从而帮助您建立对选择稳健收敛准则重要性的直观理解。", "problem": "您的任务是研究不同的残差归一化选择如何影响对迭代线性求解器感知收敛性的判断。该求解器源于可压缩Navier–Stokes方程的Newton线性化。请在一个能够捕捉对流与扩散输运以及可压缩性稳定化比例关系的一维无量纲设定中进行研究。其基础是以下广泛使用的过程：通过Newton法求解非线性残差$F(U) = 0$，在非线性迭代指数为$m$时，产生一个线性系统$J(U^{(m)}) \\,\\Delta U^{(m)} = -F(U^{(m)})$，其中$J$是$F$的雅可比矩阵。对于一个固定的非线性迭代$U^{(m)}$，内层线性迭代求解器求解$J x = b$（其中$b = -F(U^{(m)})$），并维持一个当前迭代解$x^{(k)}$，同时定义线性残差为$r^{(k)} = b - J x^{(k)}$。内层求解器的收敛通常通过检查一个归一化残差是否低于某个容差来判定。\n\n以此为基础，构建一个合成的线性化一维算子，并研究三种残差归一化策略：使用初始残差范数、右端项范数以及雅可比矩阵的对角线进行缩放。使用来自带可压缩性稳定化的一维对流扩散问题的基本比例关系，将$J \\in \\mathbb{R}^{n \\times n}$定义为一个三对角矩阵：\n- 对角线元素为 $J_{ii} = \\alpha + \\dfrac{2 \\nu}{h^2}$。\n- 次对角线元素为 $J_{i,i-1} = -\\dfrac{\\nu}{h^2} - \\dfrac{U}{2 h}$，对于 $i \\geq 2$。\n- 超对角线元素为 $J_{i,i+1} = -\\dfrac{\\nu}{h^2} + \\dfrac{U}{2 h}$，对于 $i \\leq n-1$。\n其中，$h = \\dfrac{1}{n}$ 是单位区间上的网格间距，$U$ 是一个恒定的平流速度，$\\nu = \\dfrac{1}{Re}$ 是无量纲形式的运动粘度，$Re$ 是Reynolds数。参数 $\\alpha > 0$ 代表可压缩性或伪时间稳定化，并可取足够大的值以确保在整个测试套件中矩阵都是对角占优的。\n\n将右端项定义为 $b_i = \\sin(\\pi x_i)$，其中 $x_i = i h$，对于 $i = 1, \\dots, n$。使用初始猜测 $x^{(0)}_i = x_i$，对于 $i = 1, \\dots, n$，因此 $r^{(0)} = b - J x^{(0)} \\neq b$。\n\n使用加权Jacobi (WJ) 迭代来推进线性求解过程：\n$$\nx^{(k+1)} = x^{(k)} + \\omega D^{-1} \\left(b - J x^{(k)}\\right),\n$$\n其中 $D = \\mathrm{diag}(J)$ 且 $\\omega \\in (0, 2)$ 是一个松弛参数。选择固定的内层迭代次数 $K$ 和固定的松弛参数 $\\omega$，并假设 $D$ 的所有元素均为严格正数。\n\n对于每个测试用例，在进行 $K$ 次迭代后，计算残差 $r^{(K)}$ 并评估以下三种归一化残差的定义：\n1. 通过初始残差范数进行缩放：$R_{r_0} = \\dfrac{\\lVert r^{(K)} \\rVert_2}{\\lVert r^{(0)} \\rVert_2}$。\n2. 通过右端项范数进行缩放：$R_{b} = \\dfrac{\\lVert r^{(K)} \\rVert_2}{\\lVert b \\rVert_2}$。\n3. 通过雅可比矩阵对角线进行缩放（行向平衡）：$R_{D} = \\dfrac{\\lVert D^{-1} r^{(K)} \\rVert_2}{\\lVert D^{-1} r^{(0)} \\rVert_2}$。\n\n此外，对于每种归一化方法，通过与固定容差 $\\tau$ 进行比较来定义一个布尔收敛标志：对于归一化 $R_{\\star}$，如果 $R_{\\star} \\le \\tau$，则设置 $C_{\\star} = \\mathrm{True}$，否则设置 $C_{\\star} = \\mathrm{False}$。\n\n您的程序必须使用以下固定参数来实现上述过程：\n- 使用 $U = 1$。\n- 使用 $\\alpha = 500$。\n- 使用 $\\omega = 1$。\n- 使用 $K = 30$。\n- 使用 $\\tau = 10^{-6}$。\n所有量均为无量纲，且不使用角度。\n\n构建并运行以下测试套件，该套件旨在探究网格细化和Reynolds数变化的影响：\n- 案例 1：$n = 50$, $Re = 50$。\n- 案例 2：$n = 200$, $Re = 50$。\n- 案例 3：$n = 50$, $Re = 1000$。\n- 案例 4：$n = 200$, $Re = 1000$。\n- 案例 5：$n = 50$, $Re = 5$。\n\n对于每个案例，您的程序必须按 $[R_{r_0}, R_b, R_D, C_{r_0}, C_b, C_D]$ 的顺序返回一个列表，其中包含三个浮点数和三个布尔值。将所有案例的结果汇总到一个列表中，最终输出为单行，包含由五个案例结果组成的、用逗号分隔的列表，并用方括号括起来。例如，打印的行必须看起来像 $[\\,[\\dots],\\,[\\dots],\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$，每个内部列表都遵循指定的顺序。不得打印任何额外文本。", "solution": "该问题要求对用于评估迭代线性求解器收敛性的三种不同残差归一化策略进行批判性审视。其背景是一个合成的一维问题，该问题代表了计算流体动力学（CFD）中常见的问题类型，特别是源于可压缩Navier-Stokes方程的Newton线性化。分析将通过实现指定的数值方案并将其应用于一套测试用例来执行。\n\n首先，我们对问题设定进行形式化。核心任务是迭代求解以下线性方程组：\n$$\nJ x = b\n$$\n此处，$J \\in \\mathbb{R}^{n \\times n}$ 是一个稀疏三对角矩阵，代表带有稳定项的离散化一维对流扩散算子。其元素基于单位区间上的均匀网格定义，网格间距为 $h = \\dfrac{1}{n}$。参数包括恒定的平流速度 $U$、运动粘度 $\\nu = \\dfrac{1}{Re}$（其中 $Re$ 是Reynolds数）以及稳定化参数 $\\alpha$。矩阵元素如下：\n- 对角线：$J_{ii} = \\alpha + \\dfrac{2 \\nu}{h^2}$\n- 次对角线：$J_{i,i-1} = -\\dfrac{\\nu}{h^2} - \\dfrac{U}{2 h}$，对于 $i = 2, \\dots, n$\n- 超对角线：$J_{i,i+1} = -\\dfrac{\\nu}{h^2} + \\dfrac{U}{2 h}$，对于 $i = 1, \\dots, n-1$\n\n右端项（RHS）向量 $b \\in \\mathbb{R}^n$ 是通过在网格点 $x_i = i h$（对于 $i = 1, \\dots, n$）上评估一个平滑函数来定义的：\n$$\nb_i = \\sin(\\pi x_i)\n$$\n迭代求解过程始于一个初始猜测 $x^{(0)} \\in \\mathbb{R}^n$，该猜测被指定为网格坐标向量：\n$$\nx^{(0)}_i = x_i\n$$\n\n所选的迭代求解器是加权Jacobi (WJ) 方法。解通过以下公式从迭代 $k$ 推进到 $k+1$：\n$$\nx^{(k+1)} = x^{(k)} + \\omega D^{-1} \\left(b - J x^{(k)}\\right)\n$$\n其中 $D = \\mathrm{diag}(J)$ 是 $J$ 的对角部分，$\\omega$ 是一个松弛参数，括号中的项是在第 $k$ 次迭代时的线性残差，定义为 $r^{(k)} = b - J x^{(k)}$。对于本问题，参数是固定的：$\\omega = 1$（这将该方法简化为标准Jacobi迭代），并且迭代次数固定为 $K = 30$。问题假设 $D$ 具有严格为正的元素，此条件在此处得到满足，因为 $J_{ii} = \\alpha + \\frac{2\\nu}{h^2}$ 且 $\\alpha > 0$ 和 $\\nu > 0$。\n\n在执行 $K=30$ 次迭代后，我们获得最终状态 $x^{(K)}$ 和最终残差 $r^{(K)} = b - J x^{(K)}$。核心任务是评估三种不同的归一化残差：\n1.  **通过初始残差范数进行缩放**：此度量 $R_{r_0}$ 衡量残差量级相对于其初始值的减小程度。初始残差为 $r^{(0)} = b - J x^{(0)}$。\n    $$\n    R_{r_0} = \\dfrac{\\lVert r^{(K)} \\rVert_2}{\\lVert r^{(0)} \\rVert_2}\n    $$\n2.  **通过右端项范数进行缩放**：此度量 $R_{b}$ 衡量最终残差量级相对于强迫项 $b$ 的大小。\n    $$\n    R_{b} = \\dfrac{\\lVert r^{(K)} \\rVert_2}{\\lVert b \\rVert_2}\n    $$\n3.  **通过雅可比矩阵对角线进行缩放（行向平衡）**：此度量 $R_{D}$ 衡量预处理后残差范数的减小程度，其中预处理器是雅可比矩阵的对角线。这通常提供一个尺度不变的收敛度量。\n    $$\n    R_{D} = \\dfrac{\\lVert D^{-1} r^{(K)} \\rVert_2}{\\lVert D^{-1} r^{(0)} \\rVert_2}\n    $$\n\n对于每种归一化残差 $R_{\\star}$，通过将其与固定容差 $\\tau = 10^{-6}$ 进行比较来确定一个布尔收敛标志 $C_{\\star}$。如果 $R_{\\star} \\le \\tau$，则该标志设置为 $\\mathrm{True}$，否则设置为 $\\mathrm{False}$。\n\n每个测试用例 $(n, Re)$ 的计算流程如下：\n1.  设置固定参数：$U = 1$, $\\alpha = 500$, $\\omega = 1$, $K = 30$, $\\tau = 10^{-6}$。\n2.  计算派生参数：$h = 1/n$ 和 $\\nu = 1/Re$。\n3.  构建 $n \\times n$ 的三对角矩阵 $J$。\n4.  构建网格向量 $x_{grid}$，其元素为 $x_i = i h$。\n5.  构建右端项向量 $b$，其元素为 $b_i = \\sin(\\pi x_i)$。\n6.  设置初始解向量 $x^{(0)} = x_{grid}$。\n7.  计算初始残差 $r^{(0)} = b - Jx^{(0)}$。\n8.  从 $J$ 中提取对角矩阵 $D$。\n9.  计算并存储分母的范数：$\\lVert r^{(0)} \\rVert_2$, $\\lVert b \\rVert_2$ 和 $\\lVert D^{-1} r^{(0)} \\rVert_2$。\n10. 对 $k$ 从 $0$ 到 $K-1=29$ 执行Jacobi迭代循环：\n    $x^{(k+1)} = x^{(k)} + \\omega D^{-1} (b - J x^{(k)})$。\n11. 完成后，计算最终残差 $r^{(K)} = b - J x^{(K)}$。\n12. 计算分子的范数：$\\lVert r^{(K)} \\rVert_2$ 和 $\\lVert D^{-1} r^{(K)} \\rVert_2$。\n13. 计算三个比率 $R_{r_0}$、$R_{b}$ 和 $R_{D}$。\n14. 确定三个布尔标志 $C_{r_0}$、$C_{b}$ 和 $C_{D}$。\n15. 将结果整理成 $[R_{r_0}, R_b, R_D, C_{r_0}, C_b, C_D]$ 形式的列表。\n\n此流程被系统地应用于所有指定的测试用例，并且最终结果被汇总到一个单一列表中。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_case(n, Re, U, alpha, omega, K, tau):\n    \"\"\"\n    Solves the 1D convection-diffusion problem for one test case.\n\n    Args:\n        n (int): Number of grid points.\n        Re (float): Reynolds number.\n        U (float): Advection speed.\n        alpha (float): Stabilization parameter.\n        omega (float): Weighted Jacobi relaxation parameter.\n        K (int): Number of iterations.\n        tau (float): Convergence tolerance.\n\n    Returns:\n        list: A list containing [R_r0, R_b, R_D, C_r0, C_b, C_D].\n    \"\"\"\n    # 1. Calculate derived parameters\n    h = 1.0 / n\n    nu = 1.0 / Re\n\n    # 2. Construct the tridiagonal Jacobian matrix J\n    J = np.zeros((n, n))\n    \n    # Diagonal term\n    diag_val = alpha + (2 * nu / h**2)\n    # Sub-diagonal term\n    sub_diag_val = -nu / h**2 - U / (2 * h)\n    # Super-diagonal term\n    sup_diag_val = -nu / h**2 + U / (2 * h)\n\n    # Fill the matrix J using np.diag\n    J += np.diag(np.full(n, diag_val))\n    J += np.diag(np.full(n - 1, sub_diag_val), k=-1)\n    J += np.diag(np.full(n - 1, sup_diag_val), k=1)\n    \n    # 3. Construct grid, RHS vector b, and initial guess x_k\n    # Grid points x_i = i*h for i=1,...,n, corresponding to array indices 0,...,n-1\n    x_grid = h * (np.arange(n) + 1)\n    \n    b = np.sin(np.pi * x_grid)\n    x_k = x_grid.copy() # Initial guess x^(0)\n\n    # 4. Extract diagonal D and compute its inverse\n    D = np.diag(J)\n    D_inv = 1.0 / D\n\n    # 5. Calculate initial residual r^(0) and required norms\n    r0 = b - J @ x_k\n    norm_r0 = np.linalg.norm(r0, 2)\n    norm_b = np.linalg.norm(b, 2)\n    \n    # Preconditioned initial residual and its norm\n    # D_inv is a 1D array, so we use element-wise multiplication\n    D_inv_r0 = D_inv * r0\n    norm_D_inv_r0 = np.linalg.norm(D_inv_r0, 2)\n    \n    # Edge case: If initial residual is zero, convergence is perfect.\n    if np.isclose(norm_r0, 0.0):\n        return [0.0, 0.0, 0.0, True, True, True]\n\n    # 6. Perform K iterations of the Weighted Jacobi method\n    for _ in range(K):\n        r_k = b - J @ x_k\n        x_k += omega * D_inv * r_k\n        \n    # 7. Compute final residual r^(K) and its norms\n    r_K = b - J @ x_k\n    norm_rK = np.linalg.norm(r_K, 2)\n    \n    D_inv_r_K = D_inv * r_K\n    norm_D_inv_r_K = np.linalg.norm(D_inv_r_K, 2)\n\n    # 8. Calculate the three normalized residual metrics\n    R_r0 = norm_rK / norm_r0\n    R_b = norm_rK / norm_b if norm_b  0 else np.inf\n    # Handle division by zero for R_D, although norm_D_inv_r0 is unlikely to be zero\n    # if norm_r0 wasn't.\n    R_D = norm_D_inv_r_K / norm_D_inv_r0 if norm_D_inv_r0  0 else np.inf\n\n    # 9. Determine the convergence flags\n    C_r0 = R_r0 = tau\n    C_b = R_b = tau\n    C_D = R_D = tau\n\n    return [R_r0, R_b, R_D, C_r0, C_b, C_D]\n\ndef solve():\n    # Define the fixed parameters from the problem statement.\n    U = 1.0\n    alpha = 500.0\n    omega = 1.0\n    K = 30\n    tau = 1.0e-6\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (50, 50.0),    # Case 1\n        (200, 50.0),   # Case 2\n        (50, 1000.0),  # Case 3\n        (200, 1000.0), # Case 4\n        (50, 5.0),     # Case 5\n    ]\n\n    all_results = []\n    for n, Re in test_cases:\n        result = run_case(n, Re, U, alpha, omega, K, tau)\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists matches the required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```", "id": "3305239"}, {"introduction": "将迭代求解器的残差驱动到任意小的数值（如机器精度）往往是一种浪费计算资源的行为。更明智的做法是将代数误差与离散误差相平衡，因为总误差最终受限于由网格分辨率决定的离散误差。本练习 [@problem_id:3305198] 将引导您通过一个理论推导，为一个典型的对流扩散问题确定一个最优的残差容差，该容差能确保代数误差与主导的离散误差项处于同一量级。", "problem": "考虑计算流体动力学 (CFD) 中的稳态一维对流-扩散问题，标量场 $u(x)$ 在区间 $[0,1]$ 上由以下边值问题控制\n$$\n-\\nu\\,u''(x) + \\beta\\,u'(x) = f(x), \\qquad u(0)=0,\\quad u(1)=0,\n$$\n其中物理参数 $\\nu>0$ (扩散系数) 和 $\\beta>0$ (对流速度) 为常数。取一个由 $f(x)=1$ 定义的人为右端项，以使连续解光滑且适定。在间距为 $h$ 的均匀网格上，使用一阶迎风格式近似对流项 $\\beta\\,u'(x)$，使用二阶中心差分格式近似扩散项 $-\\nu\\,u''(x)$，来离散化空间导数。离散系统可以抽象地写为线性系统 $A\\,u_h=b$，其中 $A$ 是网格上的有限差分算子，$b$ 是组装后的源项。\n\n定义代数求解器误差为 $e_{\\mathrm{alg}}=u_h^{\\star}-u_h^{(k)}$，其中 $u_h^{\\star}$ 是离散系统的精确解，$u_h^{(k)}$ 是迭代线性求解器的当前迭代解。再定义代数残差为 $r^{(k)}=b-A\\,u_h^{(k)}$。令 $\\|\\cdot\\|$ 表示任意的算子范数。使用线性系统的基本不等式，\n$$\n\\|e_{\\mathrm{alg}}\\| \\le \\|A^{-1}\\|\\,\\|r^{(k)}\\|,\n$$\n并利用所用有限差分格式的主阶相容性来描述离散化误差的下限。具体来说，使用 $\\beta\\,u'(x)$ 的一阶迎风格式的主阶局部截断误差（其与 $\\frac{\\beta h}{2}\\,u''(x)$ 成正比）来界定离散解 $u_h^{\\star}$ 的全局离散化误差。\n\n从这些原理出发，且不使用任何快捷公式，推导出一个封闭形式的解析表达式，用于表示最小绝对残差容差 $\\tau^{\\star}$（使用与残差相同的范数）。当求解器容差收紧到低于 $\\tau^{\\star}$ 时，主导的总误差的主阶部分将无法进一步减小至渐近离散化误差下限之下。你的表达式必须只用物理参数 $\\beta$、$\\nu$ 和网格间距 $h$ 来表示，并且应通过平衡主阶代数求解器误差与所选格式的截断误差分析所隐含的主阶离散化误差来获得。将最终答案表示为单个解析表达式。不需要单位。", "solution": "用户要求我找到应用于离散化对流-扩散问题的迭代求解器的最优绝对残差容差 $\\tau^{\\star}$。最优性的标准是代数误差应与离散化误差相平衡。\n\n首先，我确认问题陈述。控制方程是在区间 $x \\in [0, 1]$ 上的稳态一维对流-扩散边值问题：\n$$\n-\\nu\\,u''(x) + \\beta\\,u'(x) = f(x), \\qquad u(0)=0,\\quad u(1)=0\n$$\n其中物理参数 $\\nu>0$ (扩散系数) 和 $\\beta>0$ (对流速度) 是常数，源项为 $f(x)=1$。尽管这些参数被赋予了物理名称，但使用 $f(x)=1$ 意味着该问题是在一个无量纲框架下提出的，其中 $\\nu$、$\\beta$、$u$ 和 $x$ 都是无量纲量。我将在此解释下进行推导。\n\n在第 $k$ 次迭代时的数值解 $u_h^{(k)}$ 的总误差，是网格节点 $x_i$ 上的精确连续解 $u(x_i)$ 与数值解向量 $u_h^{(k)}$ 之间的差值。这个误差可以分解为两个部分：\n1. 离散化误差 $e_{\\mathrm{disc}} = u - u_h^{\\star}$，它是精确连续解（在节点上取值）与离散系统 $A u_h = b$ 的精确解之间的差值。\n2. 代数误差 $e_{\\mathrm{alg}} = u_h^{\\star} - u_h^{(k)}$，它是精确离散解与求解器当前迭代解之间的差值。\n\n总误差是这两者之和：$u - u_h^{(k)} = e_{\\mathrm{disc}} + e_{\\mathrm{alg}}$。根据任意向量范数 $\\|\\cdot\\|$ 的三角不等式，总误差的大小有界：\n$$\n\\|u - u_h^{(k)}\\| \\le \\|e_{\\mathrm{disc}}\\| + \\|e_{\\mathrm{alg}}\\|\n$$\n\n代数误差与残差 $r^{(k)} = b - A u_h^{(k)}$ 相关。由于 $b = A u_h^{\\star}$，我们有 $r^{(k)} = A u_h^{\\star} - A u_h^{(k)} = A(u_h^{\\star} - u_h^{(k)}) = A e_{\\mathrm{alg}}$。这意味着 $e_{\\mathrm{alg}} = A^{-1} r^{(k)}$。取范数，我们得到问题陈述中给出的不等式：\n$$\n\\|e_{\\mathrm{alg}}\\| \\le \\|A^{-1}\\| \\|r^{(k)}\\|\n$$\n离散化误差与局部截断误差 $\\tau_{\\mathrm{LTE}}$ 相关。截断误差定义为将精确连续解 $u$ 代入有限差分算子 $A_h$ 时得到的残差。让我们将 $u(x_i)$ 的值向量表示为 $u$。那么 $A u = b + \\tau_{\\mathrm{LTE}}$。由于 $A u_h^{\\star} = b$，我们有 $A(u - u_h^{\\star}) = \\tau_{\\mathrm{LTE}}$，即 $A e_{\\mathrm{disc}} = \\tau_{\\mathrm{LTE}}$。这意味着 $e_{\\mathrm{disc}} = A^{-1} \\tau_{\\mathrm{LTE}}$，取范数得到其界：\n$$\n\\|e_{\\mathrm{disc}}\\| \\le \\|A^{-1}\\| \\|\\tau_{\\mathrm{LTE}}\\|\n$$\n问题指定了对流项使用一阶迎风格式，扩散项使用二阶中心差分格式。整体精度受限于低阶格式，因此该方法是一阶的。局部截断误差的主阶项源于迎风近似，其表达式为：\n$$\n\\tau_{\\mathrm{LTE}}(x) \\approx \\frac{\\beta h}{2} u''(x)\n$$\n其中 $h$ 是网格间距。\n\n迭代求解器的一个合理停止准则是，当代数误差与离散化误差处于同一量级时终止。进一步收紧求解器容差会消耗计算资源，但对总误差的减小微不足道，因为总误差此时已由离散化误差下限主导。这个平衡条件可以表示为 $\\|e_{\\mathrm{alg}}\\| \\sim \\|e_{\\mathrm{disc}}\\|$。使用上面推导出的界：\n$$\n\\|A^{-1}\\| \\|r^{(k)}\\| \\sim \\|A^{-1}\\| \\|\\tau_{\\mathrm{LTE}}\\|\n$$\n项 $\\|A^{-1}\\|$ 可以消去，从而得出一个简洁的标准：最终残差的范数应与局部截断误差的范数量级相同。设 $\\tau^{\\star}$ 为所期望的残差容差。那么：\n$$\n\\tau^{\\star} \\sim \\|\\tau_{\\mathrm{LTE}}\\| \\approx \\left\\| \\frac{\\beta h}{2} u''(x) \\right\\|\n$$\n为了得到 $\\tau^{\\star}$ 的具体值，我们需要一个单一的标量来度量范数。无穷范数是一个自然的选择，因为它代表了在整个域上的最大误差。\n$$\n\\tau^{\\star} = \\frac{\\beta h}{2} \\|u''(x)\\|_{\\infty} = \\frac{\\beta h}{2} \\sup_{x \\in [0,1]} |u''(x)|\n$$\n为了计算这个值，我们必须求出精确解 $u(x)$ 的二阶导数。边值问题是 $-\\nu u'' + \\beta u' = 1$，边界条件为 $u(0)=u(1)=0$。这是一个线性二阶常系数常微分方程。\n齐次解为 $u_h(x) = C_1 + C_2 \\exp((\\beta/\\nu)x)$。\n一个特解为 $u_p(x) = x/\\beta$。\n通解为 $u(x) = C_1 + C_2 \\exp((\\beta/\\nu)x) + x/\\beta$。\n应用边界条件：\n$u(0)=0 \\implies C_1 + C_2 = 0 \\implies C_1 = -C_2$。\n$u(1)=0 \\implies C_1 + C_2 \\exp(\\beta/\\nu) + 1/\\beta = 0$。\n将 $C_1=-C_2$ 代入第二个方程，得到 $-C_2 + C_2 \\exp(\\beta/\\nu) + 1/\\beta = 0$，由此得出 $C_2( \\exp(\\beta/\\nu) - 1 ) = -1/\\beta$。\n因此，$C_2 = -\\frac{1}{\\beta(\\exp(\\beta/\\nu)-1)}$。\n完整解是：\n$$\nu(x) = \\frac{1}{\\beta(\\exp(\\beta/\\nu)-1)} - \\frac{\\exp((\\beta/\\nu)x)}{\\beta(\\exp(\\beta/\\nu)-1)} + \\frac{x}{\\beta}\n$$\n现在，我们计算一阶和二阶导数：\n$$\nu'(x) = -\\frac{(\\beta/\\nu)\\exp((\\beta/\\nu)x)}{\\beta(\\exp(\\beta/\\nu)-1)} + \\frac{1}{\\beta} = -\\frac{\\exp((\\beta/\\nu)x)}{\\nu(\\exp(\\beta/\\nu)-1)} + \\frac{1}{\\beta}\n$$\n$$\nu''(x) = -\\frac{(\\beta/\\nu)\\exp((\\beta/\\nu)x)}{\\nu(\\exp(\\beta/\\nu)-1)} = -\\frac{\\beta}{\\nu^2} \\frac{\\exp((\\beta/\\nu)x)}{\\exp(\\beta/\\nu)-1}\n$$\n为了在 $[0,1]$ 上找到 $|u''(x)|$ 的上确界，我们考察其大小。由于 $\\beta>0$ 且 $\\nu>0$，项 $\\frac{\\beta}{\\nu^2} \\frac{1}{\\exp(\\beta/\\nu)-1}$ 是一个正常数。函数 $\\exp((\\beta/\\nu)x)$ 在 $x \\in [0,1]$ 上是正的且单调递增。因此，$u''(x)$ 的最大模值出现在 $x=1$ 处：\n$$\n\\|u''(x)\\|_{\\infty} = |u''(1)| = \\left| -\\frac{\\beta}{\\nu^2} \\frac{\\exp(\\beta/\\nu)}{\\exp(\\beta/\\nu)-1} \\right| = \\frac{\\beta}{\\nu^2} \\frac{\\exp(\\beta/\\nu)}{\\exp(\\beta/\\nu)-1}\n$$\n最后，我们将此表达式代回 $\\tau^{\\star}$ 的公式中：\n$$\n\\tau^{\\star} = \\frac{\\beta h}{2} \\|u''(x)\\|_{\\infty} = \\frac{\\beta h}{2} \\left( \\frac{\\beta}{\\nu^2} \\frac{\\exp(\\beta/\\nu)}{\\exp(\\beta/\\nu)-1} \\right)\n$$\n化简后得到最优残差容差的最终封闭形式表达式：\n$$\n\\tau^{\\star} = \\frac{\\beta^2 h}{2\\nu^2} \\frac{\\exp(\\beta/\\nu)}{\\exp(\\beta/\\nu)-1}\n$$", "answer": "$$\n\\boxed{\\frac{\\beta^{2} h}{2\\nu^{2}} \\frac{\\exp(\\frac{\\beta}{\\nu})}{\\exp(\\frac{\\beta}{\\nu}) - 1}}\n$$", "id": "3305198"}, {"introduction": "在许多工程应用中，我们更关心某个特定的输出量（如升力或阻力系数），而不是整个流场解的全局精度。传统的基于范数的收敛准则无法直接反映这些“目标量”的误差。本练习 [@problem_id:3305215] 介绍了一种更高级的、基于伴随方法的目标导向误差估计技术，它能将残差范数与您关心的工程量的误差直接联系起来，从而让您能够设定一个有明确物理意义的收敛目标。", "problem": "在计算流体动力学（CFD）中，一个稳态、不可压缩的流动被离散化并求解。离散的稳态方程具有线性代数形式 $A u = b$，其中 $A \\in \\mathbb{R}^{n \\times n}$ 是关于一个固定状态的离散稳态纳维–斯托克斯算子的雅可比矩阵，$u \\in \\mathbb{R}^{n}$ 是无量纲化变量的离散状态向量，$b \\in \\mathbb{R}^{n}$ 是对应的右侧项。一个迭代线性求解器产生迭代解 $u_k$，其残差为 $r_k = b - A u_k$。目标量是无量纲阻力系数泛函 $J(u) \\in \\mathbb{R}$。离散伴随变量 $\\psi \\in \\mathbb{R}^{n}$ 被定义为满足离散伴随方程 $A^{\\top} \\psi = \\nabla J(u)$，其中 $\\nabla J(u)$ 是 $J$ 关于 $u$ 的离散梯度。假设在工作点的线性化系统中，以下各项是已知且固定的：\n- 算子范数界 $\\|A^{-1}\\|_{2} \\leq 4.0 \\times 10^{3}$，\n- 梯度范数 $\\|\\nabla J(u)\\|_{2} = 2.5$，\n- 所有范数均为欧几里得范数 $\\|\\cdot\\|_{2}$，\n- 所有变量都已无量纲化，且 $J(u)$ 是一个阻力系数。\n该应用要求在终止时，阻力系数预测的绝对误差满足 $|J(u_k) - J(u_{\\star})| \\leq \\Delta_{J}$，其中 $\\Delta_{J} = 1.0 \\times 10^{-4}$，$u_{\\star}$ 表示 $A u = b$ 的精确稳态解。从残差、误差和离散伴随的定义出发，并且除了可微性之外不假设 $J$ 的任何特定形式，推导出一个关于残差范数 $\\|r_k\\|_{2}$ 的充分条件，该条件能保证 $|J(u_k) - J(u_{\\star})| \\leq \\Delta_{J}$，并用 $\\|A^{-1}\\|_{2}$ 和 $\\|\\nabla J(u)\\|_{2}$ 来表示。然后，根据所提供的数据计算 $\\|r_k\\|_{2}$ 的数值容差。将最终的容差表示为一个无量纲数，并将答案四舍五入到三位有效数字。", "solution": "该问题被验证为自洽、有科学依据且适定的。目标是推导出一个关于残差范数 $\\|r_k\\|_{2}$ 的充分条件，以保证目标量 $J(u)$ 达到期望的精度。这是一个在偏微分方程数值解的目标导向后验误差估计中的标准问题。\n\n设 $u_{\\star}$ 是离散线性系统 $A u = b$ 的精确解，因此有 $A u_{\\star} = b$。设 $u_k$ 是迭代求解器在第 $k$ 次迭代时的近似解。状态误差向量定义为 $e_k = u_k - u_{\\star}$。残差向量定义为 $r_k = b - A u_k$。\n\n我们可以将误差向量 $e_k$ 与残差向量 $r_k$ 联系起来。\n从精确解的方程 $A u_{\\star} = b$ 中减去近似解的方程 $A u_k = b - r_k$，我们得到：\n$$A u_{\\star} - A u_k = b - (b - r_k)$$\n$$A (u_{\\star} - u_k) = r_k$$\n$$-A e_k = r_k$$\n假设矩阵 $A$ 是可逆的，我们可以用残差来表示误差向量：\n$$e_k = -A^{-1} r_k$$\n\n目标量是泛函 $J(u)$。我们关心的是该泛函的绝对误差 $|J(u_k) - J(u_{\\star})|$。\n由于问题是在一个工作点周围的线性化系统的背景下提出的，我们可以使用一阶泰勒级数展开来近似泛函 $J$ 的变化。因此，泛函中的误差可以近似为泛函的梯度与状态向量中误差的点积：\n$$J(u_k) - J(u_{\\star}) \\approx \\nabla J(u)^{\\top} (u_k - u_{\\star})$$\n其中 $\\nabla J(u)$ 是在线性化点 $u$ 处计算的泛函梯度。这是对偶加权残差误差估计的标准公式。令 $\\delta J = J(u_k) - J(u_{\\star})$。\n$$\\delta J \\approx \\nabla J(u)^{\\top} e_k$$\n\n代入 $e_k$ 的表达式：\n$$\\delta J \\approx \\nabla J(u)^{\\top} (-A^{-1} r_k) = - \\nabla J(u)^{\\top} A^{-1} r_k$$\n\n为了简化这个表达式，我们引入离散伴随变量 $\\psi$，它由离散伴随方程定义：\n$$A^{\\top} \\psi = \\nabla J(u)$$\n求解 $\\psi$，我们得到 $\\psi = (A^{\\top})^{-1} \\nabla J(u)$。\n我们可以利用转置的性质来重写误差 $\\delta J$ 的表达式。回想一下，对于任何相容的矩阵 $X$ 和 $Y$，有 $(XY)^{\\top} = Y^{\\top}X^{\\top}$。令 $X = \\nabla J(u)^{\\top}$ 和 $Y=A^{-1}$。这不完全正确。\n我们来重写 $\\nabla J(u)^{\\top} A^{-1}$ 这一项。让我们对伴随方程进行转置：\n$$(A^{\\top} \\psi)^{\\top} = (\\nabla J(u))^{\\top}$$\n$$\\psi^{\\top} A = (\\nabla J(u))^{\\top}$$\n右乘 $A^{-1}$：\n$$\\psi^{\\top} A A^{-1} = (\\nabla J(u))^{\\top} A^{-1}$$\n$$\\psi^{\\top} = (\\nabla J(u))^{\\top} A^{-1}$$\n\n现在，我们将其代入 $\\delta J$ 的表达式中：\n$$\\delta J \\approx - \\psi^{\\top} r_k$$\n这表明目标泛函的误差约等于伴随解向量与残差向量内积的负值。\n\n为了找到收敛的充分条件，我们取绝对值并对欧几里得内积和范数 (${\\|\\cdot\\|}_2$) 应用柯西-施瓦茨不等式：\n$$|\\delta J| = |J(u_k) - J(u_{\\star})| \\approx |-\\psi^{\\top} r_k| = |\\psi^{\\top} r_k| \\leq \\|\\psi\\|_{2} \\|r_k\\|_{2}$$\n\n为了使这个界限有用，我们需要对 $\\|\\psi\\|_{2}$ 进行界定。根据伴随的定义，$\\psi = (A^{\\top})^{-1} \\nabla J(u)$。取范数：\n$$\\|\\psi\\|_{2} = \\|(A^{\\top})^{-1} \\nabla J(u)\\|_{2}$$\n使用诱导矩阵范数的性质 $\\|Mx\\|_{2} \\leq \\|M\\|_{2} \\|x\\|_{2}$：\n$$\\|\\psi\\|_{2} \\leq \\|(A^{\\top})^{-1}\\|_{2} \\|\\nabla J(u)\\|_{2}$$\n对于欧几里得 $2$-范数，矩阵的范数与其转置的范数相等。此外，转置的逆的范数等于逆的转置的范数：$\\|(A^{\\top})^{-1}\\|_{2} = \\|(A^{-1})^{\\top}\\|_{2}$。因此：\n$$\\|(A^{\\top})^{-1}\\|_{2} = \\|A^{-1}\\|_{2}$$\n所以，伴随向量范数的界限是：\n$$\\|\\psi\\|_{2} \\leq \\|A^{-1}\\|_{2} \\|\\nabla J(u)\\|_{2}$$\n\n结合这些不等式，我们得到泛函误差的一个界限：\n$$|J(u_k) - J(u_{\\star})| \\lesssim \\|\\psi\\|_{2} \\|r_k\\|_{2} \\leq \\|A^{-1}\\|_{2} \\|\\nabla J(u)\\|_{2} \\|r_k\\|_{2}$$\n\n问题要求绝对误差不大于 $\\Delta_{J} = 1.0 \\times 10^{-4}$。为了保证这一点，我们强制要求我们的上界小于或等于 $\\Delta_{J}$：\n$$\\|A^{-1}\\|_{2} \\|\\nabla J(u)\\|_{2} \\|r_k\\|_{2} \\leq \\Delta_{J}$$\n\n这就得出了关于残差范数 $\\|r_k\\|_{2}$ 的充分条件：\n$$\\|r_k\\|_{2} \\leq \\frac{\\Delta_{J}}{\\|A^{-1}\\|_{2} \\|\\nabla J(u)\\|_{2}}$$\n\n现在，我们代入给定的数值来计算所需的容差。我们已知：\n- $\\Delta_{J} = 1.0 \\times 10^{-4}$\n- $\\|A^{-1}\\|_{2} \\leq 4.0 \\times 10^{3}$\n- $\\|\\nabla J(u)\\|_{2} = 2.5$\n\n为确保不等式成立，我们必须使用分母可能的最大值，这意味着使用 $\\|A^{-1}\\|_{2}$ 的上界。\n$$\\|r_k\\|_{2} \\leq \\frac{1.0 \\times 10^{-4}}{(4.0 \\times 10^{3}) \\times 2.5}$$\n首先，计算分母中的乘积：\n$$ (4.0 \\times 10^{3}) \\times 2.5 = (4.0 \\times 2.5) \\times 10^{3} = 10.0 \\times 10^{3} = 1.0 \\times 10^{4} $$\n现在，进行除法运算：\n$$\\|r_k\\|_{2} \\leq \\frac{1.0 \\times 10^{-4}}{1.0 \\times 10^{4}} = 1.0 \\times 10^{-8}$$\n\n问题要求将数值容差四舍五入到三位有效数字。\n计算出的容差是 $1.0 \\times 10^{-8}$。用三位有效数字表示，即为 $1.00 \\times 10^{-8}$。\n这就是对残差的欧几里得范数所要求的数值容差。", "answer": "$$\n\\boxed{1.00 \\times 10^{-8}}\n$$", "id": "3305215"}]}