{"hands_on_practices": [{"introduction": "本练习旨在解决离散化扩散输运中的一个基本问题：当材料属性（如热导率或质量扩散系数）在网格单元交界面上发生突变时，应如何处理。对扩散系数进行简单的算术平均看似直观，但实际上违反了通量连续性的物理原理。本练习 [@problem_id:3316585] 将引导您从第一性原理出发，通过推导来揭示为何加权调和平均才是物理上一致的选择，并量化这种简化方法所引入的误差。", "problem": "考虑一个无源项、无对流的一维稳态扩散问题，其中被动标量 $\\phi$ 在复合介质中扩散。扩散系数 $\\Gamma$ 在一个与有限体积网格面重合的界面上存在不连续性。两个相邻的控制体积共享一个位于位置 $x_f$ 的公共面。西侧单元的中心位于位置 $x_W$，东侧单元的中心位于位置 $x_E$。单元中心到面的距离分别为 $\\delta_W = x_f - x_W$ 和 $\\delta_E = x_E - x_f$，且 $\\delta_W \\neq \\delta_E$ 以表示一个渐变网格。横截面积 $A$ 为常数，扩散系数在 $x < x_f$ 时为 $\\Gamma_W$，在 $x > x_f$ 时为 $\\Gamma_E$。请推导当使用界面扩散系数的算术平均值 $\\Gamma_f^{\\text{arith}} = (\\Gamma_W + \\Gamma_E)/2$ 时，所计算出的数值通量 $F_{\\text{arith}} = A\\,\\Gamma_f^{\\text{arith}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}$ 与精确通量 $F_{\\text{exact}}$ 之间的相对误差 $\\mathcal{E} = (F_{\\text{arith}} - F_{\\text{exact}}) / F_{\\text{exact}}$ 的表达式。", "solution": "该问题要求推导在复合介质中，穿过一个界面的数值近似扩散通量与精确扩散通量之间的相对误差。出发点是无源项、无对流的一维稳态扩散方程，该方程由菲克定律导出。\n\n对于一维系统，菲克定律指出，单位面积的扩散通量 $q$ 由下式给出：\n$$q = -\\Gamma \\frac{d\\phi}{dx}$$\n其中 $\\phi$ 是标量浓度，$\\Gamma$ 是扩散系数。穿过面积为 $A$ 的表面的总通量为 $F = A q$。\n\n在无源项的稳态条件下，守恒原理要求通量在整个区域内必须是恒定的。即 $\\frac{dF}{dx} = 0$，这意味着 $F$ 是一个常数。我们将这个恒定的精确通量记为 $F_{\\text{exact}}$。\n\n该区域由两个具有不同扩散系数的区域组成：当 $x < x_f$ 时为 $\\Gamma_W$，当 $x > x_f$ 时为 $\\Gamma_E$。我们可以分别在每个区域上对菲克定律进行积分。\n\n首先，考虑西侧区域，从位于 $x_W$ 的单元中心到位于 $x_f$ 的面。扩散系数为 $\\Gamma_W$。\n$$F_{\\text{exact}} = -A \\Gamma_W \\frac{d\\phi}{dx} \\quad \\text{for} \\quad x \\in [x_W, x_f]$$\n分离变量并从 $x_W$ 积分到 $x_f$，其中标量值分别为 $\\phi_W$ 和 $\\phi_f$：\n$$\\int_{x_W}^{x_f} F_{\\text{exact}} dx = -A \\Gamma_W \\int_{\\phi_W}^{\\phi_f} d\\phi$$\n$$F_{\\text{exact}} (x_f - x_W) = -A \\Gamma_W (\\phi_f - \\phi_W)$$\n使用定义 $\\delta_W = x_f - x_W$，我们得到：\n$$F_{\\text{exact}} \\delta_W = A \\Gamma_W (\\phi_W - \\phi_f)$$\n这可以被重新整理以表示标量值的降幅：\n$$\\phi_W - \\phi_f = \\frac{F_{\\text{exact}} \\delta_W}{A \\Gamma_W}$$\n\n接下来，考虑东侧区域，从位于 $x_f$ 的面到位于 $x_E$ 的单元中心。扩散系数为 $\\Gamma_E$。\n$$F_{\\text{exact}} = -A \\Gamma_E \\frac{d\\phi}{dx} \\quad \\text{for} \\quad x \\in [x_f, x_E]$$\n从 $x_f$ 积分到 $x_E$，其中标量值分别为 $\\phi_f$ 和 $\\phi_E$：\n$$\\int_{x_f}^{x_E} F_{\\text{exact}} dx = -A \\Gamma_E \\int_{\\phi_f}^{\\phi_E} d\\phi$$\n$$F_{\\text{exact}} (x_E - x_f) = -A \\Gamma_E (\\phi_E - \\phi_f)$$\n使用定义 $\\delta_E = x_E - x_f$，我们有：\n$$F_{\\text{exact}} \\delta_E = A \\Gamma_E (\\phi_f - \\phi_E)$$\n这给出了第二个标量降幅：\n$$\\phi_f - \\phi_E = \\frac{F_{\\text{exact}} \\delta_E}{A \\Gamma_E}$$\n\n为了消去未知的界面标量值 $\\phi_f$，我们将两个标量降幅的表达式相加：\n$$(\\phi_W - \\phi_f) + (\\phi_f - \\phi_E) = \\frac{F_{\\text{exact}} \\delta_W}{A \\Gamma_W} + \\frac{F_{\\text{exact}} \\delta_E}{A \\Gamma_E}$$\n$$\\phi_W - \\phi_E = \\frac{F_{\\text{exact}}}{A} \\left( \\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E} \\right)$$\n现在我们可以用已知的单元中心值 $\\phi_W$ 和 $\\phi_E$ 来求解精确通量 $F_{\\text{exact}}$：\n$$F_{\\text{exact}} = A \\frac{\\phi_W - \\phi_E}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}$$\n为了与 $F_{\\text{arith}}$ 定义中使用的符号约定（与 $\\phi_E - \\phi_W$ 成正比）保持一致，我们可以写成：\n$$F_{\\text{exact}} = -A \\frac{\\phi_E - \\phi_W}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}$$\n这可以通过为界面定义一个有效的扩散系数 $\\Gamma_f^{\\text{exact}}$ 来重写，其形式为 $F_{\\text{exact}} = -A \\, \\Gamma_f^{\\text{exact}} \\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}$。\n比较这两个形式，我们可以确定 $\\Gamma_f^{\\text{exact}}$：\n$$-A \\, \\Gamma_f^{\\text{exact}} \\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E} = -A \\frac{\\phi_E - \\phi_W}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}} \\quad \\implies \\quad \\Gamma_f^{\\text{exact}} = \\frac{\\delta_W + \\delta_E}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}$$\n这是扩散系数的加权调和平均值。项 $\\frac{\\delta_W}{A\\Gamma_W}$ 和 $\\frac{\\delta_E}{A\\Gamma_E}$ 分别代表西段和东段的扩散阻力，这表明对于精确解，这些串联的阻力是相加的。\n\n问题将使用扩散系数的算术平均值计算的通量定义为：\n$$F_{\\text{arith}} = A\\,\\Gamma_f^{\\text{arith}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}$$\n其中 $\\Gamma_f^{\\text{arith}} = \\frac{1}{2}(\\Gamma_W + \\Gamma_E)$。\n\n我们被要求求解相对误差 $\\mathcal{E}$：\n$$\\mathcal{E} = \\frac{F_{\\text{arith}} - F_{\\text{exact}}}{F_{\\text{exact}}} = \\frac{F_{\\text{arith}}}{F_{\\text{exact}}} - 1$$\n通量之比可以简化为有效扩散系数之比：\n$$\\frac{F_{\\text{arith}}}{F_{\\text{exact}}} = \\frac{A\\,\\Gamma_f^{\\text{arith}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}}{-A\\,\\Gamma_f^{\\text{exact}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}} = \\frac{\\Gamma_f^{\\text{arith}}}{\\Gamma_f^{\\text{exact}}}$$\n代入 $\\Gamma_f^{\\text{arith}}$ 和 $\\Gamma_f^{\\text{exact}}$ 的表达式：\n$$\\frac{F_{\\text{arith}}}{F_{\\text{exact}}} = \\frac{\\frac{1}{2}(\\Gamma_W + \\Gamma_E)}{\\frac{\\delta_W + \\delta_E}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}} = \\frac{\\Gamma_W + \\Gamma_E}{2} \\cdot \\frac{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}{\\delta_W + \\delta_E}$$\n让我们简化这个表达式：\n$$\\frac{F_{\\text{arith}}}{F_{\\text{exact}}} = \\frac{\\Gamma_W + \\Gamma_E}{2(\\delta_W + \\delta_E)} \\cdot \\frac{\\delta_W \\Gamma_E + \\delta_E \\Gamma_W}{\\Gamma_W \\Gamma_E} = \\frac{(\\Gamma_W + \\Gamma_E)(\\delta_W \\Gamma_E + \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}$$\n现在，我们计算相对误差 $\\mathcal{E}$：\n$$\\mathcal{E} = \\frac{(\\Gamma_W + \\Gamma_E)(\\delta_W \\Gamma_E + \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)} - 1$$\n$$\\mathcal{E} = \\frac{(\\Gamma_W + \\Gamma_E)(\\delta_W \\Gamma_E + \\delta_E \\Gamma_W) - 2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}$$\n展开分子：\nNumerator $= (\\Gamma_W \\delta_W \\Gamma_E + \\Gamma_W \\delta_E \\Gamma_W + \\Gamma_E \\delta_W \\Gamma_E + \\Gamma_E \\delta_E \\Gamma_W) - (2\\delta_W \\Gamma_W \\Gamma_E + 2\\delta_E \\Gamma_W \\Gamma_E)$\nNumerator $= \\delta_W \\Gamma_W \\Gamma_E + \\delta_E \\Gamma_W^2 + \\delta_W \\Gamma_E^2 + \\delta_E \\Gamma_W \\Gamma_E - 2\\delta_W \\Gamma_W \\Gamma_E - 2\\delta_E \\Gamma_W \\Gamma_E$\n合并同类项：\nNumerator $= \\delta_E \\Gamma_W^2 + \\delta_W \\Gamma_E^2 - \\delta_W \\Gamma_W \\Gamma_E - \\delta_E \\Gamma_W \\Gamma_E$\n按 $\\delta_W$ 和 $\\delta_E$ 进行因式分解：\nNumerator $= \\delta_W(\\Gamma_E^2 - \\Gamma_W \\Gamma_E) + \\delta_E(\\Gamma_W^2 - \\Gamma_W \\Gamma_E)$\nNumerator $= \\delta_W \\Gamma_E(\\Gamma_E - \\Gamma_W) - \\delta_E \\Gamma_W(\\Gamma_E - \\Gamma_W)$\n提取公因式 $(\\Gamma_E - \\Gamma_W)$：\nNumerator $= (\\Gamma_E - \\Gamma_W)(\\delta_W \\Gamma_E - \\delta_E \\Gamma_W)$\n\n因此，相对误差的最终表达式为：\n$$\\mathcal{E} = \\frac{(\\Gamma_E - \\Gamma_W)(\\delta_W \\Gamma_E - \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}$$\n该表达式是无量纲的，符合要求。分子的单位是 $[\\Gamma]^2[\\delta]$，分母的单位也是 $[\\Gamma]^2[\\delta]$。\n\n这个结果可以通过扩散阻力的概念来解释。精确的总阻力是 $R_{\\text{exact}} = (\\delta_W/(A\\Gamma_W)) + (\\delta_E/(A\\Gamma_E))$。算术平均近似所隐含的阻力是 $R_{\\text{arith}} = (\\delta_W+\\delta_E)/(A\\Gamma_f^{\\text{arith}})$。通量的相对误差由 $\\mathcal{E} = R_{\\text{exact}}/R_{\\text{arith}} - 1$ 给出。推导出的表达式表明，在两种条件下此误差为零：\n1. $\\Gamma_E = \\Gamma_W$：介质是均匀的，因此没有不连续性。\n2. $\\delta_W \\Gamma_E = \\delta_E \\Gamma_W$，或 $\\delta_W/\\delta_E = \\Gamma_W/\\Gamma_E$：界面两侧的网格间距以一个与扩散系数相关的特定比例进行渐变。在这种特殊情况下，算术平均值碰巧得出了物理上所要求的正确的调和平均值。\n对于均匀网格（$\\delta_W = \\delta_E = \\delta$），误差简化为 $\\mathcal{E} = \\frac{(\\Gamma_E - \\Gamma_W)^2}{4\\Gamma_W\\Gamma_E}$。由于该值总是非负的，因此当网格均匀且 $\\Gamma_W \\neq \\Gamma_E$ 时，与精确解相比，算术平均格式总是高估通量的大小。", "answer": "$$\\boxed{\\frac{(\\Gamma_E - \\Gamma_W)(\\delta_W \\Gamma_E - \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}}$$", "id": "3316585"}, {"introduction": "真实世界的模拟常常涉及复杂的几何形状，这使得非正交网格的使用成为必然，同时还可能遇到具有各向异性属性的材料（例如纤维增强复合材料）。在这些情况下，简单的通量近似方法会失效，需要采用更复杂的离散化方案来处理“交叉扩散”效应。本动手编程练习 [@problem_id:3316543] 将采用制造解方法（Method of Manufactured Solutions, MMS）——这是现代代码验证的基石技术——来实施并评估一个旨在同时处理非正交性和各向异性的通量近似方案的准确性。", "problem": "您需要通过人造解方法，验证二维各向异性扩散算子在非正交单元面上扩散通量的数值计算。目标是确定一个面通量计算格式的观察精度阶，并在一系列具有可控非正交性的网格上量化误差范数。其基本原理是 Fick 扩散定律和散度定理。首先，对于一个标量场 $\\phi(x,y)$，在各向异性、对称、正定的电导率张量 $\\mathbf{K}$ 作用下，其扩散通量密度由 $\\mathbf{q} = -\\mathbf{K}\\nabla \\phi$ 给出。通过一个面积矢量为 $\\mathbf{S} = \\mathbf{n}\\,A$ 的面的定向通量为 $F = \\mathbf{q}\\cdot \\mathbf{S}$，其中 $\\mathbf{n}$ 是向外的单位法向量，$A$ 是面的面积，因此 $F = -\\mathbf{n}^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi\\;A$。任务是，通过基于第一性原理的原则性分解，设计并实现一种在非正交网格上保持精确的面梯度近似方法，然后将得到的离散面通量与精确的人造解通量进行比较。\n\n将物理域定义为单位正方形 $\\Omega = [0,1]\\times[0,1]$。通过从计算坐标 $(\\xi,\\eta)$ 到物理坐标 $(x,y)$ 的剪切映射，构建一系列结构化的平行四边形网格，映射关系如下：\n$$\nx = \\xi + s\\,\\eta,\\qquad y = \\eta,\n$$\n其中 $s$ 是一个非正交性（剪切）参数。一个具有 $N_x = N_y = N$ 的结构化网格，其节点位于计算坐标 $\\xi_i = i/N$ 和 $\\eta_j = j/N$ 处，其中 $i \\in \\{0,1,\\dots,N\\}$ 且 $j \\in \\{0,1,\\dots,N\\}$。每个单元是由连续节点构成的四边形，其中心是其四个顶点的平均值。面是这些四边形的边，而内面是两个相邻单元共享的面。\n\n使用一个各向异性、常数、对称、正定的电导率张量：\n$$\n\\mathbf{K} = \\begin{bmatrix} 2.0 & 0.5 \\\\ 0.5 & 1.5 \\end{bmatrix}\n$$\n构造一个光滑标量场：\n$$\n\\phi(x,y) = \\sin(\\pi x)\\,\\cos(\\pi y) + x^2 - y,\n$$\n其精确梯度为：\n$$\n\\nabla\\phi(x,y) = \\begin{bmatrix} \\pi \\cos(\\pi x)\\,\\cos(\\pi y) + 2x \\\\ -\\pi \\sin(\\pi x)\\,\\sin(\\pi y) - 1 \\end{bmatrix}\n$$\n\n对于由一对相邻单元 $P$ 和 $N$ 共享的每个内面，其单元中心位置分别为 $\\mathbf{c}_P$ 和 $\\mathbf{c}_N$，边的端点为 $\\mathbf{e}_0$ 和 $\\mathbf{e}_1$，定义面中心 $\\mathbf{f} = (\\mathbf{e}_0 + \\mathbf{e}_1)/2$，边切线 $\\mathbf{t} = \\mathbf{e}_1 - \\mathbf{e}_0$，单元 $P$ 的向外面积矢量为边法线 $\\mathbf{S}_f = \\mathbf{n}_f\\,A_f = [t_y,\\,-t_x]$（其大小等于边长 $A_f = \\|\\mathbf{t}\\|$），方向从 $P$ 向外，以及中心到中心的矢量 $\\mathbf{d} = \\mathbf{c}_N - \\mathbf{c}_P$ 及其单位矢量 $\\widehat{\\mathbf{d}} = \\mathbf{d}/\\|\\mathbf{d}\\|$。从定义 $F = -\\mathbf{n}^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi\\;A$ 出发，通过将 $\\nabla\\phi$ 分解为沿 $\\widehat{\\mathbf{d}}$ 及其正交补的分量，并仅使用单元中心处可用的量，推导出一个在非正交网格上一致的面梯度近似 $\\nabla\\phi\\big|_f$，然后构建相应的近似面通量 $F_{\\text{approx}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi\\big|_f$。使用人造解 $\\phi$ 及其在单元中心的精确梯度，以分离出由面梯度近似（而非单元梯度重构）引起的误差。\n\n通过在所有内面上比较 $F_{\\text{approx}}$ 与精确面通量 $F_{\\text{exact}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi(\\mathbf{f})$ 来量化误差。计算相对 $L_2$ 误差：\n$$\nE_{L_2} = \\sqrt{\\frac{\\sum_{f} \\left(F_{\\text{approx}} - F_{\\text{exact}}\\right)^2}{\\sum_{f} \\left(F_{\\text{exact}}\\right)^2}},\n$$\n并按下式确定连续加密 $N \\to 2N$ 之间的观察精度阶：\n$$\np = \\frac{\\log\\left(E_{L_2}(N) / E_{L_2}(2N)\\right)}{\\log(2)}.\n$$\n\n实现一个程序，该程序：\n- 为指定的 $N$ 和 $s$ 构建剪切映射网格。\n- 根据人造解精确计算所有单元中心的 $\\phi$ 和 $\\nabla\\phi$。\n- 构建内面、定向面积矢量，并根据第一性原理推导出的原则性非正交修正计算 $F_{\\text{approx}}$，以及根据面中心的人造解梯度计算 $F_{\\text{exact}}$。\n- 汇总所有内面的误差以计算每种情况下的 $E_{L_2}$，并计算加密过程中的观察阶 $p$。\n\n您的测试套件必须使用：\n- $s \\in \\{0.0,\\,0.3\\}$。\n- $N \\in \\{8,\\,16,\\,32\\}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按以下浮点数顺序排列结果：\n- 对于 $s=0.0$：$E_{L_2}(8),\\,E_{L_2}(16),\\,E_{L_2}(32),\\,p(8\\to 16),\\,p(16\\to 32)$，\n- 对于 $s=0.3$：$E_{L_2}(8),\\,E_{L_2}(16),\\,E_{L_2}(32),\\,p(8\\to 16),\\,p(16\\to 32)$。\n\n所有量均为無量綱；将所有数字表示为浮点值。最终打印的行必须在一个方括号列表中包含这十个值，不得有任何附加文本。", "solution": "### 步骤1：提取已知信息\n问题提供了以下信息：\n- **物理定律**：Fick 扩散定律，扩散通量密度为 $\\mathbf{q} = -\\mathbf{K}\\nabla \\phi$。\n- **通过面的通量**：$F = \\mathbf{q}\\cdot \\mathbf{S} = -\\mathbf{S}^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi$，其中 $\\mathbf{S} = \\mathbf{n}\\,A$。\n- **区域**：单位正方形 $\\Omega = [0,1]\\times[0,1]$。\n- **网格生成**：通过从 $(\\xi, \\eta)$ 中的均匀计算网格进行剪切映射 $x = \\xi + s\\,\\eta$, $y = \\eta$ 来生成结构化的平行四边形网格，其中 $s$ 是剪切参数。网格在每个方向上有 $N_x = N_y = N$ 个单元。\n- **节点位置**：节点位于计算坐标 $\\xi_i = i/N$ 和 $\\eta_j = j/N$ 处，其中 $i,j \\in \\{0, \\dots, N\\}$。\n- **电导率张量**：各向异性、常数、对称、正定的张量 $\\mathbf{K} = \\begin{bmatrix} 2.0 & 0.5 \\\\ 0.5 & 1.5 \\end{bmatrix}$。\n- **人造解（标量场）**：$\\phi(x,y) = \\sin(\\pi x)\\,\\cos(\\pi y) + x^2 - y$。\n- **人造解（梯度）**：$\\nabla\\phi(x,y) = \\begin{bmatrix} \\pi \\cos(\\pi x)\\,\\cos(\\pi y) + 2x \\\\ -\\pi \\sin(\\pi x)\\,\\sin(\\pi y) - 1 \\end{bmatrix}$。\n- **几何定义**：对于单元 $P$ 和 $N$ 之间的一个面：\n    - 面中心：$\\mathbf{f} = (\\mathbf{e}_0 + \\mathbf{e}_1)/2$，其中 $\\mathbf{e}_0, \\mathbf{e}_1$ 是端点。\n    - 切线矢量：$\\mathbf{t} = \\mathbf{e}_1 - \\mathbf{e}_0$。\n    - 面积矢量：$\\mathbf{S}_f = [t_y, -t_x]$（从单元 $P$ 向外）。\n    - 中心到中心矢量：$\\mathbf{d} = \\mathbf{c}_N - \\mathbf{c}_P$。\n- **通量计算**：\n    - 近似通量：$F_{\\text{approx}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi\\big|_f$，其中 $\\nabla\\phi\\big|_f$ 是一个近似值。\n    - 精确通量：$F_{\\text{exact}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi(\\mathbf{f})$，使用面中心的精确梯度。\n- **误差度量**：\n    - 相对 $L_2$ 误差：$E_{L_2} = \\sqrt{\\frac{\\sum_{f} \\left(F_{\\text{approx}} - F_{\\text{exact}}\\right)^2}{\\sum_{f} \\left(F_{\\text{exact}}\\right)^2}}$。\n    - 观察精度阶：$p = \\frac{\\log\\left(E_{L_2}(N) / E_{L_2}(2N)\\right)}{\\log(2)}$。\n- **测试用例**：\n    - 剪切参数：$s \\in \\{0.0, 0.3\\}$。\n    - 网格尺寸：$N \\in \\{8, 16, 32\\}$。\n- **任务**：为非正交网格推导一个面梯度近似方法，实现它，并计算指定的误差和精度阶。将使用人造解提供的单元中心的 $\\phi$ 和 $\\nabla\\phi$ 的精确值，从而将误差隔离到面插值/重构格式上。\n\n### 步骤2：使用提取的已知信息进行验证\n1.  **科学依据**：该问题基于扩散方程，这是物理学和工程学中的一个基本输运方程。人造解方法是计算科学中一种标准的、成熟的验证技术。所选的人造解是光滑的，电导率张量是对称正定的，这对于扩散问题是物理上必需的。该问题是合理的。\n2.  **适定性**：任务是数值评估一个明确定义的过程。输入已指定，输出已定义，所需的推导遵循有限体积法中的标准方法。预期会得到一个唯一的、稳定的、有意义的结果（误差范数和精度阶）。该问题是适定的。\n3.  **客观性**：该问题使用精确的数学和计算语言。所有量都得到了明确的定义。没有主观或基于意见的陈述。\n4.  **完整性与一致性**：所有必要的参数（$\\mathbf{K}$, $\\phi(x,y)$, $s$, $N$）、定义（几何、误差）和程序都已提供。信息是自洽且一致的。\n\n### 步骤3：结论与行动\n该问题有效。这是一个定义明确的计算流体力学数值方法练习。将提供一个解决方案。\n\n### 解法推导与实现\n目标是验证一个用于计算单元面 $f$ 上扩散通量 $F = -\\mathbf{S}_f^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi$ 的数值格式。在非正交网格上的主要挑战是，利用相邻单元中心 $P$ 和 $N$ 的值，为面中心的梯度 $\\nabla\\phi\\big|_f$ 找到一个精确的近似。问题规定，单元中心的 $\\phi$ 和 $\\nabla\\phi$ 的精确值是已知的。\n\n**面梯度近似的推导**\n我们的任务是推导一个一致的面梯度近似 $\\nabla\\phi\\big|_f$，方法是分解梯度矢量。一个原则性的方法是将 $\\nabla\\phi\\big|_f$ 分解为平行于连接两个单元中心的矢量 $\\mathbf{d} = \\mathbf{c}_N - \\mathbf{c}_P$ 的分量和垂直于该矢量的分量。设 $\\widehat{\\mathbf{d}} = \\mathbf{d} / \\|\\mathbf{d}\\|$ 为此方向的单位矢量。\n\n任何矢量都可以唯一地分解为其在给定方向上的投影及其正交分量。因此，我们可以写出：\n$$\n\\nabla\\phi\\big|_f = (\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} + \\left( \\nabla\\phi\\big|_f - (\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} \\right)\n$$\n我们现在对这两个正交分量分别进行近似。\n\n1.  **平行于 $\\mathbf{d}$ 的分量**：在面上，$\\phi$ 在方向 $\\widehat{\\mathbf{d}}$ 上的方向导数 $\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}}$，可以使用单元中心 $\\mathbf{c}_P$ 和 $\\mathbf{c}_N$ 处的标量值，通过二阶精度的中心有限差分进行近似：\n    $$\n    \\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}} \\approx \\frac{\\phi_N - \\phi_P}{\\|\\mathbf{d}\\|}\n    $$\n    其中 $\\phi_P = \\phi(\\mathbf{c}_P)$ 且 $\\phi_N = \\phi(\\mathbf{c}_N)$。这个近似直接来自于 $\\phi$ 在线段 $\\overline{\\mathbf{c}_P \\mathbf{c}_N}$ 上某点的泰勒级数展开。\n\n2.  **垂直于 $\\mathbf{d}$ 的分量**：对于垂直于 $\\widehat{\\mathbf{d}}$ 的梯度分量，一个合理的近似是使用可用的单元中心梯度 $\\nabla\\phi_P$ 和 $\\nabla\\phi_N$。我们首先构成一个平均梯度 $\\overline{\\nabla\\phi} = \\frac{1}{2}(\\nabla\\phi_P + \\nabla\\phi_N)$，这是对 $\\overline{\\mathbf{c}_P \\mathbf{c}_N}$ 中点处 $\\nabla\\phi$ 的一个二阶近似。这个平均梯度的垂直于 $\\widehat{\\mathbf{d}}$ 的分量，可以通过减去其在 $\\widehat{\\mathbf{d}}$ 上的投影得到：\n    $$\n    \\left( \\nabla\\phi\\big|_f - (\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} \\right) \\approx \\overline{\\nabla\\phi} - (\\overline{\\nabla\\phi} \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}}\n    $$\n\n结合这两个近似，我们得到面梯度的完整表达式：\n$$\n\\nabla\\phi\\big|_f \\approx \\left(\\frac{\\phi_N - \\phi_P}{\\|\\mathbf{d}\\|}\\right)\\,\\widehat{\\mathbf{d}} + \\left( \\overline{\\nabla\\phi} - (\\overline{\\nabla\\phi} \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} \\right)\n$$\n这可以重排成一个更常见的“修正”形式：\n$$\n\\nabla\\phi\\big|_f \\approx \\overline{\\nabla\\phi} + \\left( \\frac{\\phi_N - \\phi_P}{\\|\\mathbf{d}\\|} - \\overline{\\nabla\\phi} \\cdot \\widehat{\\mathbf{d}} \\right)\\,\\widehat{\\mathbf{d}}\n$$\n该表达式将面梯度表示为单元中心梯度的简单平均值加上一个修正项。当沿 $\\mathbf{d}$ 方向的插值梯度分量（即 $\\overline{\\nabla\\phi}\\cdot\\widehat{\\mathbf{d}}$）与中心差分近似 $(\\phi_N-\\phi_P)/\\|\\mathbf{d}\\|$ 不匹配时，修正项非零。这种差异在非正交网格上尤为突出，因为在这些网格上，单元中心连线 $\\mathbf{d}$ 与面法线不平行。此格式旨在在此类网格上保持二阶精度。\n\n**数值实现**\n程序将执行以下步骤：\n1.  **设置**：定义常数矩阵 $\\mathbf{K}$ 并实现人造解 $\\phi(x,y)$ 及其梯度 $\\nabla\\phi(x,y)$ 的函数。\n2.  **网格生成**：对于给定的网格尺寸 $N$ 和剪切参数 $s$，使用映射 $x_{i,j} = i/N + s \\cdot (j/N)$ 和 $y_j = j/N$ 计算所有节点的坐标 $(x_{i,j}, y_{j})$。随后，通过平均其四个顶点坐标计算每个单元 $(i,j)$ 的中心 $\\mathbf{c}_{i,j}$。\n3.  **单元中心求值**：在每个单元中心 $\\mathbf{c}_{i,j}$ 处计算精确的标量场 $\\phi$ 和梯度 $\\nabla\\phi$。存储这些值以供后续使用。\n4.  **面循环与通量计算**：遍历网格的所有内面。内面可分为两类：“垂直”面（分隔单元 $(i,j)$ 和 $(i+1,j)$）和“水平”面（分隔 $(i,j)$ 和 $(i,j+1)$）。对于每个内面：\n    a.  识别相邻单元 $P$ 和 $N$，并检索它们预先计算的中心位置和场值（$\\mathbf{c}_P, \\mathbf{c}_N, \\phi_P, \\phi_N, \\nabla\\phi_P, \\nabla\\phi_N$）。\n    b.  确定面端点 $\\mathbf{e}_0, \\mathbf{e}_1$ 并计算面中心 $\\mathbf{f}$、切线 $\\mathbf{t}$ 和面积矢量 $\\mathbf{S}_f$。必须为 $\\mathbf{S}_f$ 保持一致的方向（例如，从 $P$ 指向 $N$）。\n    c.  通过在面中心 $\\mathbf{f}$ 处计算 $\\nabla\\phi$ 并计算 $F_{\\text{exact}} = -\\mathbf{S}_f^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi(\\mathbf{f})$ 来计算精确通量 $F_{\\text{exact}}$。\n    d.  通过首先使用推导出的非正交修正格式计算近似面梯度 $\\nabla\\phi\\big|_f$，然后计算 $F_{\\text{approx}} = -\\mathbf{S}_f^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi\\big|_f$ 来计算近似通量 $F_{\\text{approx}}$。\n    e.  累加平方误差 $(F_{\\text{approx}} - F_{\\text{exact}})^2$ 和精确通量的平方 $(F_{\\text{exact}})^2$。\n5.  **误差分析**：遍历所有内面后，使用累加的总和计算相对 $L_2$ 误差 $E_{L_2}$。对每个指定的 $N$ 值（$8, 16, 32$）重复此过程。\n6.  **精度阶**：利用连续网格加密的误差 $E_{L_2}(N)$ 和 $E_{L_2}(2N)$，计算观察精度阶 $p$。\n7.  **输出**：收集 $s=0.0$ 和 $s=0.3$ 的最终结果，并按指定格式打印。该格式预计将表现出二阶精度（$p \\approx 2$）。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the numerical experiment as per the problem statement.\n    \"\"\"\n\n    # Global constants defined in the problem\n    K_TENSOR = np.array([[2.0, 0.5], [0.5, 1.5]])\n    PI = np.pi\n\n    def phi_func(x, y):\n        \"\"\"Manufactured scalar field phi(x,y).\"\"\"\n        return np.sin(PI * x) * np.cos(PI * y) + x**2 - y\n\n    def grad_phi_func(x, y):\n        \"\"\"Exact gradient of the manufactured scalar field.\"\"\"\n        grad_x = PI * np.cos(PI * x) * np.cos(PI * y) + 2 * x\n        grad_y = -PI * np.sin(PI * x) * np.sin(PI * y) - 1\n        return np.array([grad_x, grad_y])\n\n    def compute_errors_for_case(N, s):\n        \"\"\"\n        Computes the L2 error for a given grid size N and shear parameter s.\n        \"\"\"\n        # 1. Grid Generation\n        nodes = np.zeros((N + 1, N + 1, 2))\n        xi_coords = np.linspace(0, 1, N + 1)\n        eta_coords = np.linspace(0, 1, N + 1)\n        for j in range(N + 1):\n            for i in range(N + 1):\n                nodes[i, j, 0] = xi_coords[i] + s * eta_coords[j]\n                nodes[i, j, 1] = eta_coords[j]\n\n        cell_centers = np.zeros((N, N, 2))\n        for j in range(N):\n            for i in range(N):\n                cell_centers[i, j] = 0.25 * (\n                    nodes[i, j] + nodes[i + 1, j] +\n                    nodes[i + 1, j + 1] + nodes[i, j + 1]\n                )\n\n        # 2. Evaluate exact values at cell centers\n        phi_at_centers = np.zeros((N, N))\n        grad_phi_at_centers = np.zeros((N, N, 2))\n        for j in range(N):\n            for i in range(N):\n                x_c, y_c = cell_centers[i, j]\n                phi_at_centers[i, j] = phi_func(x_c, y_c)\n                grad_phi_at_centers[i, j] = grad_phi_func(x_c, y_c)\n\n        # 3. Loop over interior faces and calculate fluxes\n        sum_sq_err = 0.0\n        sum_sq_exact = 0.0\n\n        all_faces_info = []\n\n        # Vertical interior faces (between (i,j) and (i+1,j))\n        for j in range(N):\n            for i in range(N - 1):\n                P_idx, N_cell_idx = (i, j), (i + 1, j)\n                e0, e1 = nodes[i + 1, j], nodes[i + 1, j + 1]\n                all_faces_info.append((P_idx, N_cell_idx, e0, e1))\n\n        # Horizontal interior faces (between (i,j) and (i,j+1))\n        for j in range(N - 1):\n            for i in range(N):\n                P_idx, N_cell_idx = (i, j), (i, j + 1)\n                e0, e1 = nodes[i + 1, j + 1], nodes[i, j + 1] # Order for upward normal\n                all_faces_info.append((P_idx, N_cell_idx, e0, e1))\n\n        for P_idx, N_cell_idx, e0, e1 in all_faces_info:\n            c_P = cell_centers[P_idx]\n            c_N = cell_centers[N_cell_idx]\n\n            phi_P = phi_at_centers[P_idx]\n            phi_N = phi_at_centers[N_cell_idx]\n            grad_phi_P = grad_phi_at_centers[P_idx]\n            grad_phi_N = grad_phi_at_centers[N_cell_idx]\n\n            f_center = 0.5 * (e0 + e1)\n            t = e1 - e0\n            Sf = np.array([t[1], -t[0]])\n            \n            d = c_N - c_P\n            # Ensure Sf points from P to N_cell\n            if np.dot(Sf, d)  0:\n                Sf = -Sf\n\n            # Exact flux calculation\n            grad_phi_f_exact = grad_phi_func(f_center[0], f_center[1])\n            F_exact = -Sf.T @ K_TENSOR @ grad_phi_f_exact\n\n            # Approximate flux calculation with non-orthogonal correction\n            d_norm = np.linalg.norm(d)\n            if d_norm == 0: continue\n            d_hat = d / d_norm\n            \n            grad_phi_avg = 0.5 * (grad_phi_P + grad_phi_N)\n\n            # This is the \"over-relaxed\" or \"minimum correction\" scheme\n            grad_phi_f_approx = grad_phi_avg + (\n                (phi_N - phi_P) / d_norm - np.dot(grad_phi_avg, d_hat)\n            ) * d_hat\n            \n            F_approx = -Sf.T @ K_TENSOR @ grad_phi_f_approx\n            \n            sum_sq_err += (F_approx - F_exact)**2\n            sum_sq_exact += F_exact**2\n\n        # 4. Final L2 error calculation\n        if sum_sq_exact == 0: return 0.0\n        \n        e_l2 = np.sqrt(sum_sq_err / sum_sq_exact)\n        return e_l2\n\n    def calculate_order(e1, e2, n_ratio=2.0):\n        \"\"\"Calculates the observed order of accuracy.\"\"\"\n        if e1 == 0 or e2 == 0: return np.inf\n        return np.log(e1 / e2) / np.log(n_ratio)\n    \n    test_cases = [\n        {'s': 0.0, 'N_values': [8, 16, 32]},\n        {'s': 0.3, 'N_values': [8, 16, 32]},\n    ]\n    \n    final_results = []\n    \n    for case in test_cases:\n        errors = [compute_errors_for_case(N, case['s']) for N in case['N_values']]\n        final_results.extend(errors)\n        final_results.append(calculate_order(errors[0], errors[1]))\n        final_results.append(calculate_order(errors[1], errors[2]))\n\n    print(f\"[{','.join(f'{val:.8f}' for val in final_results)}]\")\n\nsolve()\n```", "id": "3316543"}, {"introduction": "一个数值上精确的方案是不够的，它还必须是鲁棒的，并能导出一个可解的代数系统。对于扩散问题，我们非常希望离散化后的矩阵算子是应对称正定的（Symmetric Positive Definite, SPD），因为这保证了唯一解的存在，并允许使用高效的迭代求解器。这个高级练习 [@problem_id:3316604] 在一个精心构建的病态网格上进行了一次思想实验，其中一种常见的非正交修正方案会失效，从而破坏算子的SPD性质并影响数值稳定性。您将分析此失效的原因，并评估能够恢复算子基本数学特性的潜在修复方法。", "problem": "考虑一个标量场 $\\phi$ 在计算流体动力学 (CFD) 中使用的非结构化网格的局部区域上进行稳态扩散，其扩散系数 $k$ 为常数。根据积分形式的控制守恒定律和菲克定律 (Fick's law)，对于一个边界为 $\\partial \\Omega_P$ 的控制体 $\\Omega_P$，有\n$$\n\\int_{\\partial \\Omega_P} \\left(-k \\nabla \\phi \\cdot \\boldsymbol{n}\\right) \\, \\mathrm{d}A = \\int_{\\Omega_P} s \\, \\mathrm{d}V,\n$$\n其中 $s$ 是源项，$\\boldsymbol{n}$ 是单位外法向量。在有限体积法 (FVM) 离散化中，每个面上的面法向扩散通量被计算并求和。\n\n要求你研究朴素的面法向两点评估法与非正交修正相结合在何种情况下会破坏组装后的扩散算子的对称正定 (SPD) 性质，以及如何修复此问题。\n\n网格片段和数据：\n- 两个内部单元 $P$ 和 $N$ 体积相等，$V_P = V_N = 1$，共享一个面积为 $A_f = 1$ 的内部面 $f$，其单位法向量 $\\boldsymbol{n}_f$ 从 $P$ 指向 $N$。\n- 形心到形心的向量为 $\\boldsymbol{d} = \\boldsymbol{x}_N - \\boldsymbol{x}_P$，其模长 $|\\boldsymbol{d}| = 1$，方向满足 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f = \\cos(154^\\circ) \\approx -0.9$（高度非正交且为钝角）。\n- 每个单元恰好有一个额外的边界面，面积为 $A_b = 1$，沿其外法线方向距离为 $\\ell_b = 10$，具有狄利克雷边界值 $\\phi_b = 0$。假设采用标准的守恒边界处理。\n- 均匀扩散系数 $k = 1$。\n- 对于内部面，采用菲克定律通常的两点法向投影作为隐式部分，并将任何切向非正交（交叉扩散）贡献显式处理（因此它不会出现在隐式矩阵中）。\n\n仅从积分守恒定律和菲克定律出发（不得假设任何现成的离散化公式），分析为这个双单元子系统中的未知数 $(\\phi_P,\\phi_N)$ 组装的隐式 $2 \\times 2$ 算子。确定朴素的非正交处理是否会导致此网格上隐式扩散算子的 SPD 性质丧失。然后判断哪种（或哪些）补救措施可以在保持局部守恒的同时，可证明地恢复 SPD 性质。\n\n选择所有正确的选项。\n\nA. 在给定网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 且 $\\ell_b = 10$，朴素的两点隐式法向通量产生的内表面贡献系数为 $A_\\perp \\approx -0.9$。组装隐式矩阵得到\n$$\n\\begin{bmatrix}\n-0.9 + 0.1   +0.9 \\\\\n+0.9   -0.9 + 0.1\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n-0.8   0.9 \\\\\n0.9   -0.8\n\\end{bmatrix},\n$$\n其特征值为 $0.1$ 和 $-1.7$，因此该算子不是 SPD。一种局部守恒的修复方法是将隐式法向系数限制为 $\\lvert A_\\perp \\rvert \\approx 0.9$（等效于在隐式算子中用 $\\lvert \\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\rvert$ 替换 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f$），并将符号修正放入显式源项中；得到的隐式矩阵为\n$$\n\\begin{bmatrix}\n0.9 + 0.1   -0.9 \\\\\n-0.9   0.9 + 0.1\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n1.0   -0.9 \\\\\n-0.9  1.0\n\\end{bmatrix}\n$$\n其特征值为 $1.9$ 和 $0.1$，是 SPD 矩阵。\n\nB. 在给定网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 且 $\\ell_b = 10$，显式非正交修正总能确保隐式算子的对角占优性，因此朴素的两点格式必然保持 SPD；无需修复。\n\nC. 在一个轻微非正交的网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f = 0.2$ 且 $\\ell_b = 1$，朴素的两点格式会失去 SPD 性质，但将整个交叉扩散项完全隐式化并将其完全分配给所属单元 $P$ 可以恢复 SPD 性质，同时保持局部守恒和对称性。\n\nD. 在给定网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 且 $\\ell_b = 10$，另一种守恒且保持 SPD 的修复方法是使用旋转扩散分裂：保持法向部分为隐式，并使用 $\\lvert \\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\rvert$，以使 $P$–$N$ 耦合为非正且对称；并通过一个对称的最小二乘面梯度将切向（交叉扩散）部分隐式处理，该梯度在紧凑模板上产生一个半正定双线性形式。在这个双单元子系统上，切向项不贡献额外的隐式耦合，因此隐式矩阵简化为选项 A 中的 SPD 矩阵；在更大的模板上，它通过构造保持对称半正定并保持局部守恒。", "solution": "## 问题验证\n\n### 步骤 1：提取已知条件\n问题为在非结构化网格上使用有限体积法 (FVM) 进行稳态扩散分析提供了以下信息：\n- **控制定律：** 控制体 $\\Omega_P$ 中标量 $\\phi$ 的积分形式守恒定律：$$ \\int_{\\partial \\Omega_P} \\left(-k \\nabla \\phi \\cdot \\boldsymbol{n}\\right) \\, \\mathrm{d}A = \\int_{\\Omega_P} s \\, \\mathrm{d}V $$\n- **本构定律：** 菲克定律将通量与 $\\phi$ 的梯度联系起来。\n- **网格与几何：**\n    - 两个相邻的内部单元，$P$ 和 $N$。\n    - 单元体积：$V_P = V_N = 1$。\n    - 共享一个面积为 $A_f = 1$ 的内部面 $f$。\n    - 面 $f$ 的单位法向量 $\\boldsymbol{n}_f$ 从单元 $P$ 指向单元 $N$。\n    - 形心到形心的向量：$\\boldsymbol{d} = \\boldsymbol{x}_N - \\boldsymbol{x}_P$。\n    - 形心向量的模：$|\\boldsymbol{d}| = 1$。\n    - 非正交性度量：$\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f = \\cos(154^\\circ) \\approx -0.9$。\n    - 每个单元有一个面积为 $A_b = 1$ 的边界面。\n    - 从单元形心到其边界面的距离为 $\\ell_b = 10$。\n- **物理属性与边界条件：**\n    - 扩散系数：$k=1$ (常数)。\n    - 边界条件：狄利克雷类型，边界面上的值为 $\\phi_b = 0$。\n    - 边界处理是“标准守恒”的。\n- **离散格式：**\n    - 对于内部面 $f$，通量的隐式部分基于“菲克定律的两点法向投影”。\n    - 非正交（交叉扩散）贡献被显式处理。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题基于标准的扩散方程及其通过有限体积法的离散化，这是计算流体动力学的基石。非正交网格、显式修正项以及扩散算子的对称正定 (SPD) 性质等概念都是该领域的标准和成熟概念。该设定在科学上是合理的。\n2.  **适定性：** 对于给定的狄利克雷边界条件，稳态扩散的物理问题是适定的。问题关注特定数值离散化的性质，这是一个有效且有意义的分析。\n3.  **客观性：** 语言精确且定量。诸如“朴素的面法向两点评估法”和“非正交修正”等术语在 FVM 的背景下是标准的。提供的数据是客观的。\n4.  **完整性与一致性：** 问题提供了构建未知数 $\\phi_P$ 和 $\\phi_N$ 的 $2 \\times 2$ 矩阵系统所需的所有数据。几何描述虽然简化，但是自洽的。项 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 表示网格中面法线与连接单元的向量之间存在钝角，这是已知的导致数值困难的原因，使得问题的前提是现实的。\n5.  **未检测到其他缺陷。** 该问题是应用于 CFD 的数值分析中一个定义明确的练习。\n\n### 步骤 3：结论与行动\n问题陈述是**有效**的。继续进行求解。\n\n## 隐式算子的推导\n\nFVM 通过对控制体各个面上的通量求和来近似积分守恒定律。对于稳态且无源项（$s=0$）的情况，流出控制体的净通量之和为零。\n\n### 离散方程\n\n控制体 $\\Omega_P$ 的方程为：\n$$ F_{Pf} + F_{Pb} = S_{P, \\text{explicit}} $$\n其中 $F_{Pf}$ 是从 $P$ 到 $N$ 通过面 $f$ 的通量，$F_{Pb}$ 是流出 $P$ 的边界面的通量。$S_{P, \\text{explicit}}$ 包含所有显式处理的项。我们关心的是隐式算子，因此我们基于包含未知数 $\\phi_P$ 和 $\\phi_N$ 的项来组装矩阵。\n\n**1. 内部面通量 ($F_{Pf}$):**\n问题指定了隐式部分采用“朴素的两点法向投影”。这对应于使用单元中心值来近似面上的梯度，然后将其投影到面法线上。\n通量为 $F_f = -k A_f (\\nabla \\phi)_f \\cdot \\boldsymbol{n}_f$。\n梯度近似为 $(\\nabla \\phi)_f \\approx \\frac{\\phi_N - \\phi_P}{|\\boldsymbol{d}|} \\hat{\\boldsymbol{d}}$。\n因此，通过 $f$ 流出 $P$ 的通量的隐式部分是：\n$$ F_{Pf}^{\\text{implicit}} = -k \\frac{A_f}{|\\boldsymbol{d}|} (\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f) (\\phi_N - \\phi_P) $$\n代入给定值（$k=1, A_f=1, |\\boldsymbol{d}|=1, \\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$）：\n$$ F_{Pf}^{\\text{implicit}} = -(1) \\frac{1}{1} (-0.9) (\\phi_N - \\phi_P) = 0.9 (\\phi_N - \\phi_P) $$\n\n**2. 边界面通量 ($F_{Pb}$):**\n边界处理是单元中心 $P$ 和边界之间的标准“两点”通量，其中 $\\phi_b = 0$。\n$$ F_{Pb} = -k A_b \\frac{\\phi_b - \\phi_P}{\\ell_b} = -(1)(1) \\frac{0 - \\phi_P}{10} = 0.1 \\phi_P $$\n该通量本质上是隐式的。\n\n**3. 组装单元 P 的方程：**\n单元 $P$ 的守恒方程的隐式部分为 $F_{Pf}^{\\text{implicit}} + F_{Pb} = 0$。\n$$ 0.9 (\\phi_N - \\phi_P) + 0.1 \\phi_P = 0 \\implies -0.8 \\phi_P + 0.9 \\phi_N = 0 $$\n系统矩阵算子的第一行是 $[-0.8, 0.9]$。\n\n**4. 组装单元 N 的方程：**\n根据对称性，单元 $N$ 的边界通量为 $F_{Nb} = 0.1 \\phi_N$。\n通过面 $f$ 流出 $N$ 的通量是 $F_{Nf}$。$N$ 在面 $f$ 处的外法线是 $-\\boldsymbol{n}_f$。\n因此，$F_{Nf} = -F_{Pf}$。隐式部分是：\n$$ F_{Nf}^{\\text{implicit}} = -F_{Pf}^{\\text{implicit}} = -0.9 (\\phi_N - \\phi_P) = 0.9 (\\phi_P - \\phi_N) $$\n单元 $N$ 的隐式方程是 $F_{Nf}^{\\text{implicit}} + F_{Nb} = 0$。\n$$ 0.9 (\\phi_P - \\phi_N) + 0.1 \\phi_N = 0 \\implies 0.9 \\phi_P - 0.8 \\phi_N = 0 $$\n系统矩阵的第二行是 $[0.9, -0.8]$。\n\n**5. 隐式矩阵：**\n组装的隐式矩阵 $M$ 是：\n$$ M = \\begin{bmatrix} -0.8   0.9 \\\\ 0.9   -0.8 \\end{bmatrix} $$\n在标准的 FVM 实践中，扩散矩阵 $A$ 的形式为 $A\\phi=S$，其中对角元素为正。这将是 $A = -M$：\n$$ A = \\begin{bmatrix} 0.8   -0.9 \\\\ -0.9  0.8 \\end{bmatrix} $$\n一个矩阵是 SPD 的，如果它是对称的并且所有特征值都为正。$A$ 是对称的。其特征方程为 $(0.8-\\lambda)^2 - (-0.9)^2 = 0$，得到 $0.8-\\lambda = \\pm 0.9$。特征值为 $\\lambda_1 = 0.8-0.9 = -0.1$ 和 $\\lambda_2 = 0.8+0.9 = 1.7$。由于一个特征值为负，矩阵 $A$ 不是正定的，因此不是 SPD。\n\n## 逐项分析\n\n**A. 在给定网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 且 $\\ell_b = 10$，朴素的两点隐式法向通量产生的内表面贡献系数为 $A_\\perp \\approx -0.9$。组装隐式矩阵得到...**\n\n此选项首先给出了我们推导出的矩阵 $M$。它正确地指出其特征值为 $0.1$ 和 $-1.7$。一个矩阵是 SPD 的，如果它是对称且正定的。标准算子 $A = -M$ 的特征值为 $-0.1$ 和 $1.7$，因此它不是正定的。所以，“该算子不是 SPD”的说法是正确的。\n\n提出的修复方法是在隐式通量计算中用 $|\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f| = 0.9$ 替换 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f$。\n通过 $f$ 流出 $P$ 的新的隐式通量是：\n$$ F_{Pf, \\text{new}}^{\\text{implicit}} = -k \\frac{A_f}{|\\boldsymbol{d}|} |\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f| (\\phi_N - \\phi_P) = -(1)\\frac{1}{1}(0.9)(\\phi_N - \\phi_P) = 0.9(\\phi_P - \\phi_N) $$\n$P$ 的方程现在是 $0.9(\\phi_P - \\phi_N) + 0.1 \\phi_P = S'_P$，简化为 $1.0 \\phi_P - 0.9 \\phi_N = S'_P$。\n$N$ 的方程是 $-F_{Pf, \\text{new}}^{\\text{implicit}} + F_{Nb} = S'_N$，得到 $-0.9(\\phi_P - \\phi_N) + 0.1\\phi_N = S'_N$，简化为 $-0.9 \\phi_P + 1.0 \\phi_N = S'_N$。\n得到的隐式矩阵（以标准的正对角线形式）是：\n$$ A_{\\text{new}} = \\begin{bmatrix} 1.0   -0.9 \\\\ -0.9  1.0 \\end{bmatrix} $$\n这个矩阵是对称的。特征方程是 $(1.0 - \\lambda)^2 - (-0.9)^2 = 0$，得到 $1.0 - \\lambda = \\pm 0.9$。特征值是 $\\lambda_1 = 1.0 + 0.9 = 1.9$ 和 $\\lambda_2 = 1.0 - 0.9 = 0.1$。两个特征值都是正的，所以矩阵是 SPD。这与选项的分析相符。这种修复是一种延迟修正，其中原始通量与修正后的隐式部分之间的差异被显式处理，从而在收敛时保持局部守恒。\n结论：**正确**。\n\n**B. 在给定网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 且 $\\ell_b = 10$，显式非正交修正总能确保隐式算子的对角占优性，因此朴素的两点格式必然保持 SPD；无需修复。**\n\n“显式非正交修正”指的是我们已经分析过的格式。得到的矩阵是 $A = \\begin{bmatrix} 0.8   -0.9 \\\\ -0.9  0.8 \\end{bmatrix}$。一个矩阵是对角占优的，如果对于每一行，对角元素的绝对值严格大于非对角元素绝对值之和。对于第一行，我们检查是否 $|0.8|  |-0.9|$，这是错误的（$0.8 \\ngtr 0.9$）。该矩阵不是对角占优的。如上所示，它也不是 SPD。该格式“必然保持 SPD”的说法是错误的。\n结论：**不正确**。\n\n**C. 在一个轻微非正交的网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f = 0.2$ 且 $\\ell_b = 1$，朴素的两点格式会失去 SPD 性质，但将整个交叉扩散项完全隐式化并将其完全分配给所属单元 $P$ 可以恢复 SPD 性质，同时保持局部守恒和对称性。**\n\n让我们用这些新参数来分析朴素格式：$\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f = 0.2$ 和 $\\ell_b = 1$。从 $P$ 到 $N$ 的内部面通量现在是：\n$F_{Pf}^{\\text{implicit}} = -k \\frac{A_f}{|\\boldsymbol{d}|} (\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f) (\\phi_N - \\phi_P) = -(1)\\frac{1}{1}(0.2)(\\phi_N - \\phi_P) = 0.2(\\phi_P - \\phi_N)$。\n边界通量是 $F_{Pb} = -k A_b \\frac{\\phi_b - \\phi_P}{\\ell_b} = -(1)(1)\\frac{0 - \\phi_P}{1} = 1.0 \\phi_P$。\n$P$ 的方程（以 $A\\phi=S$ 形式）变为 $(0.2+1.0)\\phi_P - 0.2\\phi_N = S'_P$，即 $1.2\\phi_P - 0.2\\phi_N = S'_P$。\n根据对称性，$N$ 的方程是 $-0.2\\phi_P + 1.2\\phi_N = S'_N$。\n矩阵是 $ A' = \\begin{bmatrix} 1.2   -0.2 \\\\ -0.2  1.2 \\end{bmatrix} $。\n这个矩阵是对称的。它的特征值由 $(1.2 - \\lambda)^2 - (-0.2)^2 = 0$ 给出，所以 $1.2 - \\lambda = \\pm 0.2$。特征值是 $\\lambda_1 = 1.4$ 和 $\\lambda_2 = 1.0$。两者都是正的，因此矩阵是 SPD。\n该选项的前提，“朴素的两点格式会失去 SPD 性质”，对于这些参数是错误的。\n结论：**不正确**。\n\n**D. 在给定网格上，其中 $\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f \\approx -0.9$ 且 $\\ell_b = 10$，另一种守恒且保持 SPD 的修复方法是使用旋转扩散分裂...**\n\n此选项描述了一种更复杂的修复方法。\n1.  **隐式法向部分：** 它建议“保持法向部分为隐式，并使用 $|\\hat{\\boldsymbol{d}} \\cdot \\boldsymbol{n}_f|$”。这与选项 A 中提出的修复方法相同。如 A 的分析所示，这会得到 SPD 矩阵 $A_{\\text{new}} = \\begin{bmatrix} 1.0   -0.9 \\\\ -0.9  1.0 \\end{bmatrix}$。\n\n2.  **隐式切向部分：** 它建议使用“对称的最小二乘面梯度”来隐式处理切向（交叉扩散）部分。这是一种已知的维持 SPD 性质的先进技术。\n3.  **在双单元系统上的分析：** 选项正确地指出，“在这个双单元子系统上，切向项不贡献额外的隐式耦合”。面 $f$ 处的最小二乘梯度重构需要来自 $f$ 周围单元模板的值。在这个最小系统中，唯一的邻居是 $P$ 和 $N$。因此，任何梯度重构都被限制在向量 $\\boldsymbol{d} = \\boldsymbol{x}_N - \\boldsymbol{x}_P$ 的方向上。根据定义，交叉扩散项与通量法向量中正交于 $\\boldsymbol{d}$ 的分量相关联。由于梯度无法在 $\\boldsymbol{d}$ 以外的任何方向上解析，近似梯度与定义交叉扩散的向量分量的点积为零。因此，在这种特定的双单元情况下，隐式切向项对矩阵没有贡献。\n4.  **结论：** 在这个特定网格上，该方法的隐式矩阵简化为仅用法向部分修复得到的矩阵，即选项 A 中的 SPD 矩阵。该方法作为一种守恒且保持 SPD 的通用描述（在更大的模板上）也是正确的。\n结论：**正确**。", "answer": "$$\\boxed{AD}$$", "id": "3316604"}]}