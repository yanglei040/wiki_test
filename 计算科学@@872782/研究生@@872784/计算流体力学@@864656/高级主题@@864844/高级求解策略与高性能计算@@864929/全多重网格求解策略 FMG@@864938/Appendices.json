{"hands_on_practices": [{"introduction": "全网格（FMG）策略的一个核心优势是其计算最优性，即求解器的工作量与最细网格上的未知数数量成线性关系。这个练习通过对一个典型的三维问题中的V-循环进行详细的计算成本分析，揭示了这种效率的来源 [@problem_id:3322361]。通过将平滑、限制、插值和粗网格求解等不同操作的成本相加，您可以亲手验证总工作量主要由最细网格上的计算主导，从而深刻理解多重网格方法为何如此高效。", "problem": "考虑一个用于三维椭圆问题的全多重网格（FMG）求解策略，该问题在嵌套网格上进行离散化，网格层级为 $\\ell = 0, 1, 2, 3, 4$，其中 $\\ell = 0$ 是最细层，$\\ell = 4$ 是最粗层。在相邻层级之间，网格在每个空间维度上都以因子 $2$ 进行粗化，因此未知数的数量按 $n_{\\ell} = n_{0} \\times 8^{-\\ell}$ 的比例缩放。假设一个层级-$\\ell$的稀疏矩阵向量乘积（SpMV）的计算工作量与未知数数量成线性关系；因此，一个层级-$\\ell$的SpMV成本，以最细层SpMV为单位表示，为 $r_{\\ell} = 8^{-\\ell}$。\n\n考虑一个从层级 $\\ell = 0$ 开始的单个V-循环，下降到层级 $\\ell = 4$，在最粗层上求解，然后返回到层级 $\\ell = 0$。在每个层级 $\\ell = 0, 1, 2, 3$上，V-循环执行 $\\nu_{1} = 2$ 次前平滑扫描和 $\\nu_{2} = 1$ 次后平滑扫描。在最粗层级 $\\ell = 4$ 上，算法执行一次粗网格求解，不进行平滑。在层级 $\\ell$ 上，每个操作的成本（以层级-$\\ell$的SpMV为单位度量）如下：\n- 一次平滑扫描的成本为 $c_{s} = 1$，\n- 一次从层级 $\\ell$ 到层级 $\\ell+1$ 的限制操作成本为 $c_{r} = \\frac{1}{4}$，\n- 一次从层级 $\\ell+1$ 到层级 $\\ell$ 的延长操作成本为 $c_{p} = \\frac{1}{2}$，\n- 在层级 $\\ell = 4$ 上的粗网格求解成本为 $c_{0} = 16$。\n\n计算此V-循环的总工作量 $W$，以最细层SpMV为单位表示（即，通过单个最细层SpMV的成本进行归一化）。然后，在平滑、限制、延长和粗网格求解这四个类别中，确定哪个单一组成部分对 $W$ 的贡献最大。使用如下定义的索引 $\\kappa$ 来报告主导部分：平滑为 $\\kappa = 1$，限制为 $\\kappa = 2$，延长为 $\\kappa = 3$，粗网格求解为 $\\kappa = 4$。\n\n精确表示总工作量 $W$（不进行四舍五入），并使用 LaTeX 的 $\\texttt{pmatrix}$ 环境将最终答案以一个双元素行向量 $\\left(W, \\kappa\\right)$ 的形式提供，单位为最细层SpMV。", "solution": "用户要求我解决以下问题：\n“考虑一个用于三维椭圆问题的全多重网格（FMG）求解策略，该问题在嵌套网格上进行离散化，网格层级为 $\\ell = 0, 1, 2, 3, 4$，其中 $\\ell = 0$ 是最细层，$\\ell = 4$ 是最粗层。在相邻层级之间，网格在每个空间维度上都以因子 $2$ 进行粗化，因此未知数的数量按 $n_{\\ell} = n_{0} \\times 8^{-\\ell}$ 的比例缩放。假设一个层级-$\\ell$的稀疏矩阵向量乘积（SpMV）的计算工作量与未知数数量成线性关系；因此，一个层级-$\\ell$的SpMV成本，以最细层SpMV为单位表示，为 $r_{\\ell} = 8^{-\\ell}$。\n\n考虑一个从层级 $\\ell = 0$ 开始的单个V-循环，下降到层级 $\\ell = 4$，在最粗层上求解，然后返回到层级 $\\ell = 0$。在每个层级 $\\ell = 0, 1, 2, 3$上，V-循环执行 $\\nu_{1} = 2$ 次前平滑扫描和 $\\nu_{2} = 1$ 次后平滑扫描。在最粗层级 $\\ell = 4$ 上，算法执行一次粗网格求解，不进行平滑。在层级 $\\ell$ 上，每个操作的成本（以层级-$\\ell$的SpMV为单位度量）如下：\n- 一次平滑扫描的成本为 $c_{s} = 1$，\n- 一次从层级 $\\ell$ 到层级 $\\ell+1$ 的限制操作成本为 $c_{r} = \\frac{1}{4}$，\n- 一次从层级 $\\ell+1$ 到层级 $\\ell$ 的延长操作成本为 $c_{p} = \\frac{1}{2}$，\n- 在层级 $\\ell = 4$ 上的粗网格求解成本为 $c_{0} = 16$。\n\n计算此V-循环的总工作量 $W$，以最细层SpMV为单位表示（即，通过单个最细层SpMV的成本进行归一化）。然后，在平滑、限制、延长和粗网格求解这四个类别中，确定哪个单一组成部分对 $W$ 的贡献最大。使用如下定义的索引 $\\kappa$ 来报告主导部分：平滑为 $\\kappa = 1$，限制为 $\\kappa = 2$，延长为 $\\kappa = 3$，粗网格求解为 $\\kappa = 4$。\n\n精确表示总工作量 $W$（不进行四舍五入），并使用 LaTeX 的 $\\texttt{pmatrix}$ 环境将最终答案以一个双元素行向量 $\\left(W, \\kappa\\right)$ 的形式提供，单位为最细层SpMV。”\n\n### 第一步：提取已知条件\n- 网格层级：$\\ell = 0, 1, 2, 3, 4$，其中 $\\ell=0$ 为最细层，$\\ell=4$ 为最粗层。\n- 未知数的缩放比例：$n_{\\ell} = n_{0} \\times 8^{-\\ell}$。\n- 层级-$\\ell$ SpMV的相对成本：$r_{\\ell} = 8^{-\\ell}$（以最细层，即$\\ell=0$的SpMV为单位）。\n- V-循环结构：从层级 $\\ell=0$ 开始，下降到 $\\ell=4$，再返回到 $\\ell=0$。\n- 在层级 $\\ell=0, 1, 2, 3$ 上的前平滑扫描次数：$\\nu_{1} = 2$。\n- 在层级 $\\ell=0, 1, 2, 3$ 上的后平滑扫描次数：$\\nu_{2} = 1$。\n- 最粗层 $\\ell=4$ 不进行平滑。\n- 以层级-$\\ell$ SpMV为单位的各操作成本：\n  - 平滑扫描：$c_{s} = 1$。\n  - 限制 ($\\ell \\to \\ell+1$): $c_{r} = \\frac{1}{4}$。\n  - 延长 ($\\ell+1 \\to \\ell$): $c_{p} = \\frac{1}{2}$。\n- 在层级 $\\ell=4$ 上的粗网格求解成本：$c_{0} = 16$（以层级-4的SpMV为单位）。\n- 输出定义：总工作量 $W$ 和主导部分索引 $\\kappa$，其中平滑为 $\\kappa=1$，限制为 $\\kappa=2$，延长为 $\\kappa=3$，粗网格求解为 $\\kappa=4$。\n\n### 第二步：使用提取的已知条件进行验证\n问题陈述描述了多重网格V-循环的标准计算成本分析，这是数值分析和计算科学中的一个核心主题。\n- **科学依据**：该问题基于多重网格算法的既定原则。对于结构化网格上的几何多重网格，其缩放假设是标准的。\n- **适定性**：该问题提供了一套完整的参数和一个明确的目标，从而可以得出一个唯一的、可计算的解。\n- **目标**：问题以精确、定量的术语陈述，没有歧义或主观性。\n- **不完整或矛盾的设置**：该问题是自洽的。所有必要的数据（层级数、扫描次数和相对成本）均已提供且不矛盾。短语“全多重网格（FMG）求解策略”提供了背景信息，但任务被狭义且明确地定义为分析单个V-循环，使其成为一个适定的子问题。\n- **其他缺陷**：该问题没有检查清单中的任何其他缺陷。这是一个形式化的、定量的问题，需要进行实质性计算。\n\n### 第三步：结论与行动\n该问题是有效的。可以构建一个严谨的解。\n\n### 解法\n目标是计算单个V-循环的总计算工作量 $W$，以最细层（$\\ell=0$）的稀疏矩阵向量乘积（SpMV）为单位表示，并确定主导的工作量组成部分。总工作量 $W$ 是平滑（$W_s$）、限制（$W_r$）、延长（$W_p$）和粗网格求解（$W_c$）的工作量贡献之和。\n\n在网格层级 $\\ell$ 上执行的任何操作的成本都必须通过最细层SpMV的成本进行归一化。这是通过将操作的成本（以层级-$\\ell$的SpMV为单位给出）乘以因子 $r_{\\ell} = 8^{-\\ell}$ 来实现的。\n\n1.  **平滑的工作量 ($W_s$)**\n    平滑在层级 $\\ell = 0, 1, 2, 3$ 上执行。在这些层级中的每一个上，都有 $\\nu_{1} = 2$ 次前平滑扫描和 $\\nu_{2} = 1$ 次后平滑扫描。在层级 $\\ell$ 上单次平滑扫描的成本是 $c_s = 1$ 个层级-$\\ell$ SpMV。\n    总平滑工作量是相关层级上成本的总和：\n    $$W_s = \\sum_{\\ell=0}^{3} (\\nu_{1} + \\nu_{2}) c_s r_{\\ell} = \\sum_{\\ell=0}^{3} (2+1)(1) (8^{-\\ell}) = 3 \\sum_{\\ell=0}^{3} 8^{-\\ell}$$\n\n2.  **限制的工作量 ($W_r$)**\n    从层级 $\\ell$ 到 $\\ell+1$ 的限制操作发生在 $\\ell = 0, 1, 2, 3$。成本 $c_r = \\frac{1}{4}$ 是以层级-$\\ell$ SpMV为单位度量的。\n    总限制工作量为：\n    $$W_r = \\sum_{\\ell=0}^{3} c_r r_{\\ell} = \\sum_{\\ell=0}^{3} \\frac{1}{4} (8^{-\\ell}) = \\frac{1}{4} \\sum_{\\ell=0}^{3} 8^{-\\ell}$$\n\n3.  **延长的工作量 ($W_p$)**\n    从层级 $\\ell+1$ 到 $\\ell$ 的延长操作发生在 $\\ell = 0, 1, 2, 3$。成本 $c_p = \\frac{1}{2}$ 是以层级-$\\ell$ SpMV为单位度量的，因为该操作作用于更细的网格。\n    总延长工作量为：\n    $$W_p = \\sum_{\\ell=0}^{3} c_p r_{\\ell} = \\sum_{\\ell=0}^{3} \\frac{1}{2} (8^{-\\ell}) = \\frac{1}{2} \\sum_{\\ell=0}^{3} 8^{-\\ell}$$\n\n4.  **粗网格求解的工作量 ($W_c$)**\n    粗网格求解在最粗层级 $\\ell = 4$ 上执行一次。其成本为 $c_0 = 16$ 个层级-4 SpMV。\n    其工作量贡献为：\n    $$W_c = c_0 r_{4} = 16 \\times 8^{-4} = \\frac{16}{8^4} = \\frac{16}{4096} = \\frac{1}{256}$$\n\n为了计算总工作量，我们首先计算几何级数和，它出现在 $W_s$、$W_r$ 和 $W_p$ 的表达式中：\n$$S = \\sum_{\\ell=0}^{3} 8^{-\\ell} = 8^{-0} + 8^{-1} + 8^{-2} + 8^{-3} = 1 + \\frac{1}{8} + \\frac{1}{64} + \\frac{1}{512}$$\n$$S = \\frac{512}{512} + \\frac{64}{512} + \\frac{8}{512} + \\frac{1}{512} = \\frac{512+64+8+1}{512} = \\frac{585}{512}$$\n\n现在我们可以计算每个组成部分的工作量：\n$W_s = 3 \\times S = 3 \\times \\frac{585}{512} = \\frac{1755}{512}$\n$W_r = \\frac{1}{4} \\times S = \\frac{1}{4} \\times \\frac{585}{512} = \\frac{585}{2048}$\n$W_p = \\frac{1}{2} \\times S = \\frac{1}{2} \\times \\frac{585}{512} = \\frac{585}{1024}$\n$W_c = \\frac{1}{256}$\n\n总工作量 $W$ 是这些组成部分的总和：\n$$W = W_s + W_r + W_p + W_c = \\frac{1755}{512} + \\frac{585}{2048} + \\frac{585}{1024} + \\frac{1}{256}$$\n为了对这些分数求和，我们找到一个公分母，即 $2048$：\n$$W = \\frac{1755 \\times 4}{2048} + \\frac{585}{2048} + \\frac{585 \\times 2}{2048} + \\frac{1 \\times 8}{2048}$$\n$$W = \\frac{7020}{2048} + \\frac{585}{2048} + \\frac{1170}{2048} + \\frac{8}{2048} = \\frac{7020 + 585 + 1170 + 8}{2048} = \\frac{8783}{2048}$$\n\n最后，为了确定主导部分，我们使用公分母 $2048$ 来比较 $W_s$、$W_r$、$W_p$ 和 $W_c$ 的值：\n- 平滑 ($\\kappa=1$): $W_s = \\frac{7020}{2048}$\n- 限制 ($\\kappa=2$): $W_r = \\frac{585}{2048}$\n- 延长 ($\\kappa=3$): $W_p = \\frac{1170}{2048}$\n- 粗网格求解 ($\\kappa=4$): $W_c = \\frac{8}{2048}$\n\n比较分子，$7020  1170  585  8$。最大的贡献来自平滑。因此，主导部分的索引是 $\\kappa=1$。\n\n最终答案由总工作量 $W$ 和主导部分索引 $\\kappa$ 组成。\n$W = \\frac{8783}{2048}$\n$\\kappa = 1$", "answer": "$$\n\\boxed{\n\\begin{pmatrix} \\frac{8783}{2048}  1 \\end{pmatrix}\n}\n$$", "id": "3322361"}, {"introduction": "在理解了多重网格的计算效率之后，我们自然会问：其快速收敛的理论基础是什么？本练习通过局部傅里叶分析（Local Fourier Analysis, LFA）这一强有力的理论工具，来剖析V-循环的核心部件——两层网格法 [@problem_id:3322390]。通过推导两层网格的误差传播符号，您将能够量化平滑器如何有效地衰减高频误差，以及粗网格校正如何处理平滑器无法解决的低频误差，从而从根本上理解多重网格算法的收敛机制。", "problem": "考虑一维泊松方程，在间距为 $h$ 的均匀网格上使用二阶中心差分进行离散，因此作用在网格函数 $\\{u_i\\}$ 上的离散算子为 $A_h u_i = \\frac{1}{h^2}\\left(-u_{i-1} + 2u_i - u_{i+1}\\right)$。假设采用周期性边界条件，并应用局部傅里叶分析 (LFA) 来分析双网格法，该方法是全多重网格 (FMG) 求解策略的核心构建模块。\n\n使用一步预光顺和一步后光顺，光顺方法为加权雅可比法，阻尼参数 $\\omega = 0.7$。从细网格到粗网格使用全加权限制，从粗网格到细网格使用线性插值（分段线性延拓）。通过伽辽金条件定义粗网格算子。令高频傅里叶模式的集合为那些无法在粗网格上表示的模式，即集合 $\\theta \\in [\\pi/2, \\pi]$。\n\n从离散算子符号、光顺算子符号和转移算子符号的定义出发，推导双网格误差传播符号，并计算预测的双网格收敛因子，其定义为该符号的模在 $\\theta \\in [\\pi/2,\\pi]$ 上的上确界。同时，计算最坏情况下的光顺因子（包括预光顺和后光顺）与最坏情况下的粗网格校正因子在相同高频模式集合上的乘积。\n\n将预测的双网格收敛因子和因子乘积值均报告为四位有效数字的十进制数。将最终结果表示为无量纲量，并在最终答案中以行矩阵的形式一并呈现。", "solution": "## 问题验证\n\n### 步骤 1：提取已知条件\n- **方程**：一维泊松方程。\n- **离散化**：在间距为 $h$ 的均匀网格上采用二阶中心差分。\n- **离散算子**：$A_h u_i = \\frac{1}{h^2}\\left(-u_{i-1} + 2u_i - u_{i+1}\\right)$。\n- **边界条件**：周期性。\n- **分析方法**：局部傅里叶分析 (LFA)。\n- **多重网格格式**：双网格法。\n  - **光顺**：一步预光顺 ($\\nu_1=1$) 和一步后光顺 ($\\nu_2=1$)。\n  - **光顺器类型**：加权雅可比法，阻尼参数 $\\omega = 0.7$。\n  - **网格间转移**：全加权限制 ($I_h^{2h}$) 和线性插值延拓 ($I_{2h}^h$)。\n  - **粗网格算子 ($A_{2h}$)**：由伽辽金条件定义，$A_{2h} = I_h^{2h} A_h I_{2h}^h$。\n- **频率定义**：高频傅里叶模式的集合由波数 $\\theta \\in [\\pi/2, \\pi]$ 定义。\n- **要求解的量**：\n  1. 预测的双网格收敛因子，定义为双网格误差传播符号的模在高频模式上的上确界。\n  2. 最坏情况下的光顺因子（对于 $\\nu_1+\\nu_2=2$ 步）与最坏情况下的粗网格校正因子在高频模式上的乘积。\n- **输出格式**：将两个值均报告为四位有效数字的十进制数，并以行矩阵形式呈现。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据指定标准对问题进行验证：\n- **科学依据**：该问题是偏微分方程数值分析中的一个标准练习，特别是在已建立的多重网格方法理论框架内。所有指定的组成部分（泊松方程、有限差分、雅可比光顺器、标准转移算子、伽辽金粗化）和分析技术（LFA）都是计算科学中的基本概念。该问题在科学上是合理的。\n- **适定性**：该问题提供了唯一确定所要求量所需的所有参数和定义。LFA 的过程是明确定义的，解析推导会得出一个唯一的数值结果。该问题是适定的。\n- **客观性**：该问题使用精确、无歧义的数学语言和定义进行陈述。不存在主观或基于意见的元素。\n\n该问题没有表现出说明中列出的任何缺陷（例如，科学上不合理、不完整、含糊不清）。所有术语在多重网格方法领域都是标准术语。\n\n### 步骤 3：结论与行动\n问题陈述是 **有效的**。将提供完整解答。\n\n## 解答\n\n将使用标准的 $2 \\times 2$ 矩阵形式主义，通过局部傅里叶分析 (LFA) 进行分析。我们分析波数 $\\theta \\in [0, \\pi/2]$ 的低频模式 $\\phi_L(\\theta, j) = e^{i\\theta j}$ 和高频模式 $\\phi_H(\\theta, j) = e^{i(\\theta+\\pi)j}$ 之间的耦合。问题中将高频定义为 $\\theta \\in [\\pi/2, \\pi]$ 是所有高频模式集合的另一种等效表示。\n\n令 $S = \\sin(\\theta/2)$ 且 $C = \\cos(\\theta/2)$。注意 $S^2+C^2=1$。\n\n**1. 算子符号**\n\n- **细网格算子符号, $\\hat{A}_h(\\theta)$**：将离散算子 $A_h$ 应用于傅里叶模式 $e^{i\\phi j}$ 会得到 $\\hat{A}_h(\\phi) e^{i\\phi j}$，其中 $\\hat{A}_h(\\phi) = \\frac{2}{h^2}(1-\\cos\\phi) = \\frac{4}{h^2}\\sin^2(\\phi/2)$。\n对于 $\\theta \\in [0, \\pi/2]$，LFA 矩阵符号是对角的：\n$$ \\hat{A}_h(\\theta) = \\begin{pmatrix} \\hat{A}_h(\\theta)  0 \\\\ 0  \\hat{A}_h(\\theta+\\pi) \\end{pmatrix} = \\frac{4}{h^2} \\begin{pmatrix} S^2  0 \\\\ 0  C^2 \\end{pmatrix} $$\n\n- **光顺算子符号, $\\hat{S}_h(\\theta)$**：加权雅可比的误差传播算子是 $S_h = I - \\omega D^{-1} A_h$。$A_h$ 的对角部分是 $D = \\frac{2}{h^2}I$。LFA 符号为 $\\hat{S}_h(\\phi) = 1 - \\omega \\frac{h^2}{2} \\hat{A}_h(\\phi) = 1 - 2\\omega \\sin^2(\\phi/2)$。当 $\\omega = 0.7$ 时，我们有 $\\hat{S}_h(\\phi) = 1 - 1.4\\sin^2(\\phi/2)$。矩阵符号为：\n$$ \\hat{S}_h(\\theta) = \\begin{pmatrix} 1-1.4S^2  0 \\\\ 0  1-1.4C^2 \\end{pmatrix} $$\n\n- **限制和延拓符号**：对于一维全加权限制和线性插值延拓，LFA 符号互为转置：\n$$ \\hat{I}_h^{2h}(\\theta) = \\begin{pmatrix} C^2  S^2 \\end{pmatrix}, \\quad \\hat{I}_{2h}^h(\\theta) = \\begin{pmatrix} C^2 \\\\ S^2 \\end{pmatrix} $$\n这显示了一个低频粗网格模式如何由细网格的低频和高频模式共同构成（限制），或如何产生这两种模式（延拓）。\n\n- **粗网格算子符号, $\\hat{A}_{2h}(2\\theta)$**：使用伽辽金条件 $A_{2h} = I_h^{2h} A_h I_{2h}^h$，其符号（一个标量，因为它作用于粗网格）为：\n$$ \\hat{A}_{2h}(2\\theta) = \\hat{I}_h^{2h}(\\theta)\\hat{A}_h(\\theta)\\hat{I}_{2h}^h(\\theta) = \\begin{pmatrix} C^2  S^2 \\end{pmatrix} \\frac{4}{h^2} \\begin{pmatrix} S^2  0 \\\\ 0  C^2 \\end{pmatrix} \\begin{pmatrix} C^2 \\\\ S^2 \\end{pmatrix} $$\n$$ \\hat{A}_{2h}(2\\theta) = \\frac{4}{h^2} (C^2 S^2 C^2 + S^2 C^2 S^2) = \\frac{4}{h^2} S^2 C^2 (C^2+S^2) = \\frac{4}{h^2} S^2 C^2 = \\frac{1}{h^2} \\sin^2(\\theta) $$\n\n**2. 双网格误差传播符号**\n\n双网格误差传播算子是 $M_{2G} = S_h^{\\nu_2}(I - I_{2h}^h A_{2h}^{-1} I_h^{2h} A_h)S_h^{\\nu_1}$。当 $\\nu_1=\\nu_2=1$ 时，符号矩阵为 $\\hat{M}_{2G}(\\theta) = \\hat{S}_h(\\theta) \\hat{CGC}(\\theta) \\hat{S}_h(\\theta)$，其中 $\\hat{CGC}(\\theta) = I - \\hat{I}_{2h}^h(\\theta) \\hat{A}_{2h}(2\\theta)^{-1} \\hat{I}_h^{2h}(\\theta) \\hat{A}_h(\\theta)$。\n\n首先，我们计算粗网格校正符号矩阵 $\\hat{K}_{2G}(\\theta) = \\hat{I}_{2h}^h \\hat{A}_{2h}^{-1} \\hat{I}_h^{2h} \\hat{A}_h$：\n$$ \\hat{K}_{2G}(\\theta) = \\begin{pmatrix} C^2 \\\\ S^2 \\end{pmatrix} \\left(\\frac{h^2}{4S^2C^2}\\right) \\begin{pmatrix} C^2  S^2 \\end{pmatrix} \\frac{4}{h^2} \\begin{pmatrix} S^2  0 \\\\ 0  C^2 \\end{pmatrix} $$\n$$ \\hat{K}_{2G}(\\theta) = \\frac{1}{S^2C^2} \\begin{pmatrix} C^4  C^2S^2 \\\\ S^2C^2  S^4 \\end{pmatrix} \\begin{pmatrix} S^2  0 \\\\ 0  C^2 \\end{pmatrix} = \\frac{1}{S^2C^2} \\begin{pmatrix} C^4S^2  C^4S^2 \\\\ S^4C^2  S^4C^2 \\end{pmatrix} = \\begin{pmatrix} C^2  C^2 \\\\ S^2  S^2 \\end{pmatrix} $$\n所以，$\\hat{CGC}(\\theta) = I - \\hat{K}_{2G}(\\theta) = \\begin{pmatrix} 1-C^2  -C^2 \\\\ -S^2  1-S^2 \\end{pmatrix} = \\begin{pmatrix} S^2  -C^2 \\\\ -S^2  C^2 \\end{pmatrix}$。\n\n现在，我们组装完整的双网格符号 $\\hat{M}_{2G}(\\theta) = \\hat{S}_h(\\theta) \\hat{CGC}(\\theta) \\hat{S}_h(\\theta)$:\n$$ \\hat{M}_{2G}(\\theta) = \\begin{pmatrix} 1-1.4S^2  0 \\\\ 0  1-1.4C^2 \\end{pmatrix} \\begin{pmatrix} S^2  -C^2 \\\\ -S^2  C^2 \\end{pmatrix} \\begin{pmatrix} 1-1.4S^2  0 \\\\ 0  1-1.4C^2 \\end{pmatrix} $$\n$$ \\hat{M}_{2G}(\\theta) = \\begin{pmatrix} (1-1.4S^2)S^2  -(1-1.4S^2)C^2 \\\\ -(1-1.4C^2)S^2  (1-1.4C^2)C^2 \\end{pmatrix} \\begin{pmatrix} 1-1.4S^2  0 \\\\ 0  1-1.4C^2 \\end{pmatrix} $$\n$$ \\hat{M}_{2G}(\\theta) = \\begin{pmatrix} (1-1.4S^2)^2 S^2  -(1-1.4S^2)(1-1.4C^2)C^2 \\\\ -(1-1.4C^2)(1-1.4S^2)S^2  (1-1.4C^2)^2 C^2 \\end{pmatrix} $$\n很容易看出该矩阵的行列式为 $0$。因此，一个特征值为 $0$，另一个等于矩阵的迹。谱半径是迹的绝对值：\n$$ \\rho(\\hat{M}_{2G}(\\theta)) = |\\text{Tr}(\\hat{M}_{2G}(\\theta))| = |(1-1.4S^2)^2 S^2 + (1-1.4C^2)^2 C^2| $$\n令 $x = S^2 = \\sin^2(\\theta/2)$。对于 $\\theta \\in [0, \\pi/2]$，$x \\in [0, 1/2]$。谱半径作为 $x$ 的函数是：\n$$ g(x) = |(1-1.4x)^2 x + (1-1.4(1-x))^2 (1-x)| $$\n展开绝对值内的表达式得到：\n$$ (1-2.8x+1.96x^2)x + (1.4x-0.4)^2(1-x) = (x-2.8x^2+1.96x^3) + (1.96x^2-1.12x+0.16)(1-x) $$\n$$ = x-2.8x^2+1.96x^3 + 1.96x^2-1.12x+0.16 -1.96x^3+1.12x^2-0.16x = 0.28x^2 - 0.28x + 0.16 $$\n这是一个开口向上的抛物线，顶点在 $x = -(-0.28)/(2 \\cdot 0.28) = 0.5$。在区间 $x \\in [0, 0.5]$ 上，该函数是递减的。\n最大值出现在 $x=0$ 处，此时 $g(0)=0.16$。\n最小值出现在 $x=0.5$ 处，此时 $g(0.5) = 0.28(0.25) - 0.28(0.5) + 0.16 = 0.07 - 0.14 + 0.16 = 0.09$。\n该函数在区间上为正。因此，双网格收敛因子是 $g(x)$ 的上确界：\n$$ \\mu_{2G} = \\sup_{x \\in [0, 0.5]} g(x) = g(0) = 0.16 $$\n\n**3. 最坏情况因子的乘积**\n\n这涉及一个分解分析，分别考虑光顺和粗网格校正的效果。“最坏情况”指的是在高频集合上的上确界。\n\n- **最坏情况光顺因子**：高频的光顺符号为 $\\hat{S}_h(\\theta+\\pi) = 1-1.4C^2$。光顺器应用两次（预光顺和后光顺）。该因子是此符号模的平方在高频范围内的上确界。这对应于在 $\\theta \\in [0, \\pi/2]$ 上取上确界。令 $z=C^2=\\cos^2(\\theta/2)$，所以 $z \\in [1/2, 1]$。\n$$ \\mu_{sm} = \\sup_{z \\in [1/2, 1]} |(1-1.4z)^2| $$\n函数 $(1-1.4z)^2$ 在 $z=1/1.4 = 5/7 \\approx 0.714$ 处有最小值 $0$，该点位于区间内。我们检查边界：在 $z=1/2$ 处，值为 $(1-0.7)^2=0.09$；在 $z=1$ 处，值为 $(1-1.4)^2=0.16$。上确界是 $0.16$。\n\n- **最坏情况粗网格校正因子**：该因子量化了高频误差分量被 CGC 算子 $I-K_{2G}$ 减小的程度。这由 $\\hat{CGC}(\\theta)$ 矩阵的 $(H,H)$ 项给出，即 $\\hat{CGC}_{HH}(\\theta) = C^2$。我们在相同的频率范围内取上确界。令 $z=C^2 \\in [1/2, 1]$。\n$$ \\mu_{cgc} = \\sup_{z \\in [1/2, 1]} |z| = 1 $$\n这表明对于最高频率（$\\theta \\to 0$，对应于 $\\phi \\to \\pi$），粗网格校正不提供任何阻尼。\n\n- **因子乘积**：最坏情况因子的乘积是：\n$$ \\mu_{sm} \\times \\mu_{cgc} = 0.16 \\times 1 = 0.16 $$\n\n最后，我们将两个结果均四舍五入到四位有效数字。\n\n第一个结果（预测的双网格收敛因子）：$0.1600$。\n第二个结果（因子乘积）：$0.1600$。", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.1600  0.1600 \\end{pmatrix} } $$", "id": "3322390"}, {"introduction": "现实世界中的计算流体力学问题大多是高度非线性的，这为标准的多重网格方法带来了挑战。全近似方案（Full Approximation Scheme, FAS）是为解决这类问题而设计的关键技术。这个练习将引导您探索FAS的核心思想，即通过计算一个名为 $\\tau$ 校正项的量，来处理非线性问题 [@problem_id:3322340]。通过为一个非线性扩散问题显式计算 $\\tau$ 项，您将明白粗网格如何“感知”并校正细网格上的截断误差，从而确保多重网格在非线性系统中依然能保持其卓越的收敛性能。", "problem": "考虑在区间 $\\Omega=[0,1]$ 上具有齐次狄利克雷边界条件的一维非线性扩散边值问题，\n$$\n- \\partial_{x}\\!\\left(\\kappa(u)\\,\\partial_{x} u\\right) \\;=\\; f(x), \n\\qquad u(0)=0,\\quad u(1)=0,\n$$\n其中 $\\kappa(u)=1+u^{2}$ 且 $f(x)=1$。该方程在两个嵌套的均匀网格上，采用单元中心的有限差分/有限体积观点以守恒形式进行离散：一个细网格，间距 $h=1/4$；一个粗网格，间距 $H=1/2$。细网格节点位于 $x_{i}=i h$（$i=0,1,2,3,4$），粗网格节点位于 $X_{J}=J H$（$J=0,1,2$）。\n\n在任一网格上，定义内部节点处的离散扩散算子 $L_{\\Delta}(\\cdot)$（其中 $\\Delta\\in\\{h,H\\}$）为\n$$\n\\left[L_{\\Delta}(u)\\right]_{i} \\;=\\; -\\frac{1}{\\Delta^{2}}\\Big( K_{i+\\tfrac{1}{2}}\\,(u_{i+1}-u_{i}) \\;-\\; K_{i-\\tfrac{1}{2}}\\,(u_{i}-u_{i-1}) \\Big),\n$$\n其中，面系数由相邻节点状态计算的算术平均值给出，$K_{i+\\tfrac{1}{2}}=\\tfrac{1}{2}\\big(\\kappa(u_{i+1})+\\kappa(u_{i})\\big)$。在细网格上，给定的当前近似解为\n$u_{h}(0)=0,\\quad u_{h}(0.25)=0.2,\\quad u_{h}(0.5)=0.3,\\quad u_{h}(0.75)=0.1,\\quad u_{h}(1)=0.$\n\n通过重合节点处的逐点注入来定义从细网格状态到粗网格的限制，即 $\\hat{u}_{H}(0)=0$，$\\hat{u}_{H}(0.5)=u_{h}(0.5)$，$\\hat{u}_{H}(1)=0$。并通过一维中的完全加权来定义从细网格到粗网格的离散算子值（或残差）的限制，即对于与细网格节点 $x_{2}=0.5$ 相关联的唯一内部粗网格节点 $X_{1}=0.5$，\n$$\n\\left[I_{h}^{H} w_{h}\\right]_{1} \\;=\\; \\tfrac{1}{4}\\,w_{1} \\;+\\; \\tfrac{1}{2}\\,w_{2} \\;+\\; \\tfrac{1}{4}\\,w_{3}.\n$$\n\n令粗网格右端项由细网格右端项的限制来定义，$f_{H}=I_{h}^{H} f_{h}$，其中在每个细网格内部节点上 $f_{h,i}=1$。\n\n从守恒性和非线性多重网格的全近似格式（FAS）出发，推导在唯一内部粗网格节点 $X_{1}$ 处的粗网格 $\\tau$ 修正项的显式公式，并根据以上数据计算其值。然后，写出包含和不包含 $\\tau$ 修正项的粗网格方程，并基于这些构造解释为什么包含 $\\tau_{H}$ 会改善此非线性问题的双网格收敛性。\n\n将计算出的在 $X_{1}$ 处的粗网格 $\\tau$ 修正项的值，以一个无量纲数的形式报告，并四舍五入到六位有效数字。", "solution": "该问题提法恰当，有科学依据，并包含了求解所需的所有信息。\n\n问题的核心在于非线性多重网格方法的完全近似格式（FAS）。细网格离散方程为 $L_h(u_h) = f_h$。给定细网格上的当前解的近似值（根据问题的记法，我们同样将其表示为 $u_h$），目标是在更粗的网格上计算一个修正量。FAS 粗网格方程旨在求解粗网格变量 $u_H$，该变量是完整解的近似，而不仅仅是一个修正量。其形式如下：\n$$\nL_H(u_H) = L_H(\\hat{u}_H) + I_h^H \\left( f_h - L_h(u_h) \\right)\n$$\n其中 $u_h$ 是当前的细网格近似解，$\\hat{u}_H = I_h^H u_h$ 是其到粗网格的限制，$L_h$ 和 $L_H$ 分别是细网格和粗网格上的离散算子，而 $I_h^H$ 是限制算子。\n\n问题要求将粗网格方程写成 $L_H(u_H) = f_H + \\tau_H$ 的形式，其中 $f_H = I_h^H f_h$。通过与标准的 FAS 公式进行比较，我们可以确定粗网格 $\\tau$ 修正项：\n$$\nf_H + \\tau_H = L_H(\\hat{u}_H) + I_h^H f_h - I_h^H L_h(u_h)\n$$\n由于 $f_H = I_h^H f_h$，我们可以从等式两边消去此项，得到 $\\tau$ 修正项的表达式：\n$$\n\\tau_H = L_H(\\hat{u}_H) - I_h^H L_h(u_h)\n$$\n此项也称为相对截断误差，它衡量了施加于限制解的粗网格算子与施加于细网格解的限制细网格算子之间的差异。我们现在为唯一的内部粗网格节点 $X_1 = 0.5$ 计算此值。\n\n计算过程分为三个主要步骤：\n1.  在所需的内部细网格节点上计算细网格算子项 $L_h(u_h)$。\n2.  在内部粗网格节点上计算粗网格算子项 $L_H(\\hat{u}_H)$。\n3.  使用上面定义的限制和减法将这些结果结合起来。\n\n给定的细网格近似解是在节点 $x_i = i h$（$i=0, \\dots, 4$，$h=1/4$）处的值的向量：\n$u_h = [u_0, u_1, u_2, u_3, u_4]^T = [0, 0.2, 0.3, 0.1, 0]^T$。\n\n**步骤 1：计算 $L_h(u_h)$ 和 $I_h^H L_h(u_h)$**\n\n非线性系数为 $\\kappa(u) = 1+u^2$。我们在细网格节点上计算该值：\n$\\kappa(u_0) = 1+0^2 = 1.00$\n$\\kappa(u_1) = 1+0.2^2 = 1.04$\n$\\kappa(u_2) = 1+0.3^2 = 1.09$\n$\\kappa(u_3) = 1+0.1^2 = 1.01$\n$\\kappa(u_4) = 1+0^2 = 1.00$\n\n面系数 $K_{i+1/2} = \\frac{1}{2}(\\kappa(u_{i+1}) + \\kappa(u_i))$ 为：\n$K_{1/2} = \\frac{1}{2}(1.04+1.00) = 1.02$\n$K_{3/2} = \\frac{1}{2}(1.09+1.04) = 1.065$\n$K_{5/2} = \\frac{1}{2}(1.01+1.09) = 1.05$\n$K_{7/2} = \\frac{1}{2}(1.00+1.01) = 1.005$\n\n在内部节点 $x_i$ 处，细网格算子 $L_h$ 为（$h=1/4$，$h^2=1/16$）：\n$[L_h(u_h)]_i = -16 \\left( K_{i+1/2}(u_{i+1}-u_i) - K_{i-1/2}(u_i-u_{i-1}) \\right)$。\n我们需要在内部细网格节点 $x_1=0.25$、$x_2=0.5$ 和 $x_3=0.75$ 处计算该值：\n- 在 $x_1=0.25$ 处 ($i=1$)：\n$[L_h(u_h)]_1 = -16 \\left( K_{3/2}(u_2-u_1) - K_{1/2}(u_1-u_0) \\right) = -16 \\left( 1.065(0.3-0.2) - 1.02(0.2-0) \\right)$\n$= -16(0.1065 - 0.204) = -16(-0.0975) = 1.56$\n- 在 $x_2=0.5$ 处 ($i=2$)：\n$[L_h(u_h)]_2 = -16 \\left( K_{5/2}(u_3-u_2) - K_{3/2}(u_2-u_1) \\right) = -16 \\left( 1.05(0.1-0.3) - 1.065(0.3-0.2) \\right)$\n$= -16(-0.21 - 0.1065) = -16(-0.3165) = 5.064$\n- 在 $x_3=0.75$ 处 ($i=3$)：\n$[L_h(u_h)]_3 = -16 \\left( K_{7/2}(u_4-u_3) - K_{5/2}(u_3-u_2) \\right) = -16 \\left( 1.005(0-0.1) - 1.05(0.1-0.3) \\right)$\n$= -16(-0.1005 - (-0.21)) = -16(0.1095) = -1.752$\n\n令 $w_h = L_h(u_h)$。我们使用完全加权将 $w_h$ 限制到粗网格节点 $X_1=0.5$ 上：\n$[I_h^H w_h]_1 = \\frac{1}{4}w_1 + \\frac{1}{2}w_2 + \\frac{1}{4}w_3 = \\frac{1}{4}(1.56) + \\frac{1}{2}(5.064) + \\frac{1}{4}(-1.752) = 0.39 + 2.532 - 0.438 = 2.484$。\n因此，$[I_h^H L_h(u_h)]_1 = 2.484$。\n\n**步骤 2：计算 $L_H(\\hat{u}_H)$**\n\n通过注入得到限制后的细网格解 $\\hat{u}_H$：\n$\\hat{u}_{H,0} = u_h(0) = 0$\n$\\hat{u}_{H,1} = u_h(0.5) = 0.3$\n$\\hat{u}_{H,2} = u_h(1) = 0$\n所以，$\\hat{u}_H = [0, 0.3, 0]^T$。\n\n我们使用这些值在粗网格节点上计算 $\\kappa$：\n$\\kappa(\\hat{u}_{H,0}) = 1+0^2 = 1.00$\n$\\kappa(\\hat{u}_{H,1}) = 1+0.3^2 = 1.09$\n$\\kappa(\\hat{u}_{H,2}) = 1+0^2 = 1.00$\n\n粗网格面系数为：\n$K_ {1/2} = \\frac{1}{2}(\\kappa(\\hat{u}_{H,1}) + \\kappa(\\hat{u}_{H,0})) = \\frac{1}{2}(1.09+1.00) = 1.045$\n$K_ {3/2} = \\frac{1}{2}(\\kappa(\\hat{u}_{H,2}) + \\kappa(\\hat{u}_{H,1})) = \\frac{1}{2}(1.00+1.09) = 1.045$\n\n在内部节点 $X_1=0.5$ 处，粗网格算子 $L_H$ 为（$H=1/2$，$H^2=1/4$）：\n$[L_H(\\hat{u}_H)]_1 = -4 \\left( K_{3/2}(\\hat{u}_{H,2}-\\hat{u}_{H,1}) - K_{1/2}(\\hat{u}_{H,1}-\\hat{u}_{H,0}) \\right)$\n$= -4 \\left( 1.045(0-0.3) - 1.045(0.3-0) \\right)$\n$= -4(-0.3135 - 0.3135) = -4(-0.627) = 2.508$。\n\n**步骤 3：计算 $\\tau_H$**\n\n现在我们计算在 $X_1$ 处的 $\\tau$ 修正项：\n$[\\tau_H]_1 = [L_H(\\hat{u}_H)]_1 - [I_h^H L_h(u_h)]_1 = 2.508 - 2.484 = 0.024$。\n四舍五入到六位有效数字，该值为 $0.0240000$。\n\n**粗网格方程**\n\n为了写出完整的方程，我们需要针对未知解 $u_H = [0, U_1, 0]^T$ 的粗网格算子 $L_H(u_H)$ 以及限制后的右端项 $f_H$。\n在 $X_1$ 处的算子 $L_H(u_H)$ 为：\n$K_{1/2} = \\frac{1}{2}(\\kappa(U_1)+\\kappa(0)) = \\frac{1}{2}(1+U_1^2+1) = 1 + \\frac{1}{2}U_1^2$。\n$K_{3/2} = \\frac{1}{2}(\\kappa(0)+\\kappa(U_1)) = 1 + \\frac{1}{2}U_1^2$。\n$[L_H(u_H)]_1 = -4 \\left( K_{3/2}(0-U_1) - K_{1/2}(U_1-0) \\right) = -4 \\left( -(1+\\frac{1}{2}U_1^2)U_1 - (1+\\frac{1}{2}U_1^2)U_1 \\right) = 8U_1 + 4U_1^3$。\n\n粗网格右端项为 $f_H = I_h^H f_h$。当 $i=1,2,3$ 时，$f_{h,i}=1$：\n$[f_H]_1 = \\frac{1}{4}f_{h,1} + \\frac{1}{2}f_{h,2} + \\frac{1}{4}f_{h,3} = \\frac{1}{4}(1) + \\frac{1}{2}(1) + \\frac{1}{4}(1) = 1$。\n\n在 $X_1$ 处**不含** $\\tau$ 修正项的粗网格方程是一个朴素的粗网格近似：\n$L_H(u_H)_1 = f_{H,1} \\implies 8U_1 + 4U_1^3 = 1$。\n\n**包含** $\\tau$ 修正项的粗网格方程是 FAS 方程：\n$L_H(u_H)_1 = f_{H,1} + \\tau_{H,1} \\implies 8U_1 + 4U_1^3 = 1 + 0.024 = 1.024$。\n\n**关于收敛性改善的解释**\n\n在双网格循环中，粗网格问题的目的是计算一个修正量，以有效减少细网格解的低频误差分量。对于非线性问题 $L_h(u_h) = f_h$，精确误差 $v_h = u_h^{exact} - u_h^{approx}$ 满足 $L_h(u_h^{approx} + v_h) - L_h(u_h^{approx}) = f_h - L_h(u_h^{approx}) = r_h$，其中 $r_h$ 是细网格残差。\n\nFAS 方法在粗网格上正确地近似了这种关系。FAS 方程为 $L_H(u_H) - L_H(\\hat{u}_H) = I_h^H r_h$。这种形式确保了一个关键的一致性属性。如果细网格解收敛，即 $r_h \\to 0$，则 FAS 方程变为 $L_H(u_H) - L_H(\\hat{u}_H) = 0$。该方程有一个明显的解 $u_H = \\hat{u}_H$。这意味着粗网格修正量 $v_H = u_H - \\hat{u}_H$ 将为零。因此，一个收敛的细网格解是粗网格修正步的一个不动点。\n\n$\\tau_H$ 项是强制实现这种一致性的机制。通过将粗网格右端项定义为 $f_H^{FAS} = f_H + \\tau_H = I_h^H f_h + (L_H(\\hat{u}_H) - I_h^H L_h(u_h))$，我们迫使粗网格问题求解 $L_H(u_H) \\approx I_h^H L_h(u_h)$。它修正了粗网格算子 $L_H$ 与限制后的细网格算子 $I_h^H L_h$ 不同的这一事实。\n\n相比之下，朴素的粗网格近似 $L_H(u_H) = f_H = I_h^H f_h$ 缺乏这种一致性。如果细网格解已经收敛（$L_h(u_h) = f_h$），则朴素的粗网格方程将是 $L_H(u_H) = I_h^H L_h(u_h)$。此方程的解 $u_H$ 通常不等于 $\\hat{u}_H = I_h^H u_h$，因为一般情况下 $L_H(I_h^H u_h) \\ne I_h^H L_h(u_h)$。这个差异正是 $\\tau$ 项。在我们的例子中，$[\\tau_H]_1=0.024 \\ne 0$。这意味着即使对于一个收敛的细网格解，朴素的粗网格也会计算出一个虚假的、非零的修正量，然后该修正量将被延拓回细网格，从而破坏解并阻止收敛。包含 $\\tau_H$ 消除了这种不一致性，确保粗网格正确地模拟了细网格的误差动态，这是多重网格效率的基础。", "answer": "$$\n\\boxed{0.024000}\n$$", "id": "3322340"}]}