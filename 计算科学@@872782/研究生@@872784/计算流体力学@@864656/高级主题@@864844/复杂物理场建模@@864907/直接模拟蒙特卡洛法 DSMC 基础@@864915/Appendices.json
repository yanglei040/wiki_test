{"hands_on_practices": [{"introduction": "直接模拟蒙特卡洛（DSMC）方法通过可计算的“模拟粒子”来模拟真实的气体分子，从而架起了微观现实与计算模型之间的桥梁。本练习旨在通过计算统计权重（$W$），即每个模拟粒子代表的真实分子数量，来帮助你掌握量化这种关系的基础实践。理解并完成这一步，对于正确设定任何DSMC模拟的尺度都至关重要。[@problem_id:3309131]", "problem": "一个边长为 $L=1\\,\\mathrm{mm}$ 的立方体区域充满了均匀数密度为 $n=10^{20}\\,\\mathrm{m^{-3}}$ 的稀薄气体。该气体使用直接模拟蒙特卡洛（DSMC, Direct Simulation Monte Carlo）方法进行模拟，采用均匀权重方案，包含 $N_{\\mathrm{sim}}=10^{6}$ 个模拟粒子，其中每个模拟粒子代表相同数量的物理分子。仅从数密度（单位体积内的物理数量）的定义以及DSMC表示前提（物理总数等于模拟粒子权重之和）出发，推导模拟粒子权重 $W$ 关于 $n$、$L$ 和 $N_{\\mathrm{sim}}$ 的表达式，并计算其数值。然后，对于一个覆盖该区域的 $100^{3}$ 个等尺寸单元的均匀笛卡尔网格，在所述的均匀性假设下，估计每个单元中模拟粒子的预期平均数量，并计算其数值。将您的最终答案表示为一个行矩阵，其中首先包含 $W$ 的值，然后是每个单元中模拟粒子的平均数量。提供精确值，不要四舍五入，且最终答案中不包含单位。", "solution": "用户希望解决一个与直接模拟蒙特卡洛（DSMC）方法相关的问题。我将验证问题陈述，如果有效，将提供一个合理的解决方案。\n\n### 步骤1：提取给定信息\n-   区域几何形状：立方体\n-   区域边长：$L=1\\,\\mathrm{mm}$\n-   气体数密度：$n=10^{20}\\,\\mathrm{m^{-3}}$（均匀）\n-   模拟粒子数：$N_{\\mathrm{sim}}=10^{6}$\n-   权重方案：均匀，粒子权重为 $W$\n-   DSMC前提：物理分子总数 = 模拟粒子权重之和\n-   计算网格：$100^{3}$ 个单元的均匀笛卡尔网格\n-   目标1：推导 $W$ 的表达式并计算其数值。\n-   目标2：估计每个单元中模拟粒子的预期平均数并计算其数值。\n-   最终答案格式：一个包含 $W$ 和每个单元中模拟粒子平均数的数值的行矩阵。\n\n### 步骤2：使用提取的给定信息进行验证\n根据验证标准评估问题。\n-   **科学依据**：该问题基于直接模拟蒙特卡洛方法的基本原理，这是一种用于稀薄气体流的计算流体动力学标准技术。数密度、模拟粒子和粒子权重的概念是DSMC的核心。所提供的数值对于微尺度稀薄气体模拟是物理上合理的。\n-   **适定性**：问题陈述清晰，提供了推导所求量所需的所有必要信息。目标明确，可以确定唯一的解。\n-   **客观性**：语言精确且定量，没有主观或含糊的术语。\n-   **不完整性/矛盾**：问题是自洽的。提供的数据是充分的且没有矛盾。$L$ 的单位（毫米）与 $n$ 的单位（反立方米）之间的单位不匹配是一个标准的转换任务，而不是一个缺陷。\n-   **不切实际/不可行**：条件在科学上是合理的。在标准温度下，$10^{20}\\,\\mathrm{m^{-3}}$ 的数密度对应约 $0.4\\,\\mathrm{Pa}$ 的压力，这是一个高真空条件，DSMC方法在此适用。\n\n### 步骤3：结论与行动\n问题有效。将提供完整的解决方案。\n\n### 解题推导\n问题要求推导和计算两个量：模拟粒子权重 $W$，以及每个单元中模拟粒子的预期平均数。\n\n**第1部分：模拟粒子权重 $W$**\n\n解题从数密度 $n$ 的定义开始。在给定体积 $V$ 内，物理气体分子的总数 $N_{\\mathrm{phys}}$ 定义为：\n$$N_{\\mathrm{phys}} = n V$$\n模拟区域是一个边长为 $L$ 的立方体。其体积 $V$ 为：\n$$V = L^3$$\n因此，区域内物理分子的总数为：\n$$N_{\\mathrm{phys}} = n L^3$$\n在计算数值之前，我们必须确保单位一致。边长给定为 $L=1\\,\\mathrm{mm}$，必须将其转换为米，以匹配数密度 $n$ 的单位。\n$$L = 1\\,\\mathrm{mm} = 10^{-3}\\,\\mathrm{m}$$\n现在，我们可以用国际单位制计算体积：\n$$V = (10^{-3}\\,\\mathrm{m})^3 = 10^{-9}\\,\\mathrm{m}^3$$\n使用给定的数密度 $n=10^{20}\\,\\mathrm{m^{-3}}$，物理分子的总数为：\n$$N_{\\mathrm{phys}} = (10^{20}\\,\\mathrm{m^{-3}}) \\times (10^{-9}\\,\\mathrm{m}^3) = 10^{11}$$\n问题指出，物理分子的总数也由所有模拟粒子的权重之和表示。由于权重方案是均匀的，所以 $N_{\\mathrm{sim}}$ 个模拟粒子中的每一个都具有相同的权重 $W$。因此，物理分子的总数也可以表示为：\n$$N_{\\mathrm{phys}} = W \\times N_{\\mathrm{sim}}$$\n通过令 $N_{\\mathrm{phys}}$ 的两个表达式相等，我们可以推导出权重 $W$ 的表达式：\n$$W N_{\\mathrm{sim}} = n L^3$$\n解出 $W$ 得到所需的符号表达式：\n$$W = \\frac{n L^3}{N_{\\mathrm{sim}}}$$\n现在，我们代入给定的数值来计算 $W$。我们有 $n=10^{20}\\,\\mathrm{m^{-3}}$，$L=10^{-3}\\,\\mathrm{m}$ 和 $N_{\\mathrm{sim}}=10^{6}$。\n$$W = \\frac{10^{20} \\times (10^{-3})^3}{10^{6}} = \\frac{10^{20} \\times 10^{-9}}{10^{6}} = \\frac{10^{11}}{10^{6}} = 10^{5}$$\n权重 $W=10^{5}$ 是一个无量纲的量，表示单个模拟粒子所代表的真实气体分子的数量。\n\n**第2部分：每个单元的平均模拟粒子数**\n\n问题要求每个单元中模拟粒子的预期平均数。设此量为 $\\langle N_{p/c} \\rangle$。\n模拟区域被划分为一个包含 $N_{\\mathrm{cells}}$ 个单元的均匀笛卡尔网格。单元总数由下式给出：\n$$N_{\\mathrm{cells}} = 100^{3} = (10^2)^3 = 10^6$$\n问题陈述该气体具有均匀的数密度，并使用均匀的权重方案进行模拟。这意味着模拟粒子的分布在整个区域内平均是空间均匀的。\n因此，每个单元中模拟粒子的预期平均数就是模拟粒子的总数 $N_{\\mathrm{sim}}$ 除以单元的总数 $N_{\\mathrm{cells}}$。\n$$\\langle N_{p/c} \\rangle = \\frac{N_{\\mathrm{sim}}}{N_{\\mathrm{cells}}}$$\n我们已知 $N_{\\mathrm{sim}} = 10^{6}$ 并且我们已经计算出 $N_{\\mathrm{cells}} = 10^{6}$。代入这些值：\n$$\\langle N_{p/c} \\rangle = \\frac{10^{6}}{10^{6}} = 1$$\n每个单元中模拟粒子的预期平均数为 $1$。\n\n最终答案要求一个行矩阵，其中包含 $W$ 的数值，后跟 $\\langle N_{p/c} \\rangle$ 的数值。\n第一个值是 $W = 10^5$。\n第二个值是 $\\langle N_{p/c} \\rangle = 1$。", "answer": "$$\\boxed{\\begin{pmatrix} 10^{5}  1 \\end{pmatrix}}$$", "id": "3309131"}, {"introduction": "一次有效的DSMC模拟，其关键在于对气体动理学的基本尺度进行充分解析。这意味着计算网格的尺寸（$\\Delta x$）必须小于分子的平均自由程（$\\lambda$），并且时间步长（$\\Delta t$）必须小于平均碰撞时间。本练习将指导你完成必要的动理学理论计算，以确定这些关键的模拟参数，从而确保你的模拟能够准确捕捉粒子碰撞的物理过程，而非数值误差。[@problem_id:3309134]", "problem": "使用直接模拟蒙特卡罗 (DSMC) 方法，在均匀的温度和压强条件下，对单原子氩气进行模拟。假设氩气可以被建模为具有恒定碰撞直径的硬球分子。气体状态由 $T=300\\,\\mathrm{K}$ 和 $p=100\\,\\mathrm{Pa}$ 指定。使用以下常数：玻尔兹曼常数 $k_B=1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$，阿伏伽德罗常数 $N_A=6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$，氩的摩尔质量 $M_{\\mathrm{Ar}}=39.948\\,\\mathrm{g\\,mol^{-1}}$，以及硬球直径 $d=3.66\\times 10^{-10}\\,\\mathrm{m}$。将氩气视为理想气体，并使用硬球模型的经典气体动理论。从理想气体关系式和气体动理论的定义出发，推导数密度、碰撞截面、平均自由程和平均分子速率。对于 DSMC 的分辨率约束，采用以下具有物理动机的要求：计算单元尺寸 $\\Delta x$ 必须是局部平均自由程的一小部分，时间步长 $\\Delta t$ 必须是平均碰撞时间和平均分子速率下单元穿越时间两者中较小值的一小部分。具体来说，使用安全因子 $f=0.2$，使得 $\\Delta x=f\\,\\lambda$ 且 $\\Delta t = f \\min\\{\\tau_c, \\Delta x/\\bar{c}\\}$，其中 $\\lambda$ 是平均自由程，$\\bar{c}$ 是平均分子速率，$\\tau_c$ 是平均碰撞时间。\n\n按以下顺序计算：满足上述 DSMC 约束（安全因子 $f=0.2$）的平均自由程 $\\lambda$、平均分子速率 $\\bar{c}$、合适的单元尺寸 $\\Delta x$ 以及合适的时间步长 $\\Delta t$。将 $\\lambda$ 和 $\\Delta x$ 以微米表示，将 $\\bar{c}$ 以米每秒表示，将 $\\Delta t$ 以纳秒表示。将报告的四个值均四舍五入至三位有效数字。以行向量的形式报告您的最终答案，顺序为 $(\\lambda,\\ \\bar{c},\\ \\Delta x,\\ \\Delta t)$。", "solution": "本题要求计算用于氩气直接模拟蒙特卡罗 (DSMC) 模拟的四个关键参数：平均自由程 $\\lambda$、平均分子速率 $\\bar{c}$、计算单元尺寸 $\\Delta x$ 和时间步长 $\\Delta t$。该问题陈述清晰，科学上合理，提供了所有必需的物理常数和状态变量。我们将逐步进行推导和计算。\n\n氩气的热力学状态由其温度 $T=300\\,\\mathrm{K}$ 和压强 $p=100\\,\\mathrm{Pa}$ 给出。氩气被建模为由硬球分子组成的理想气体。\n\n首先，我们确定必要的中间物理量。气体的数密度 $n$ 可由理想气体定律推导得出：\n$$p = n k_B T \\implies n = \\frac{p}{k_B T}$$\n其中 $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$ 是玻尔兹曼常数。\n\n单个氩原子的质量 $m$ 由其摩尔质量 $M_{\\mathrm{Ar}} = 39.948\\,\\mathrm{g\\,mol^{-1}}$ 和阿伏伽德罗常数 $N_A = 6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$ 计算得出。我们必须将摩尔质量转换为国际单位制单位 ($kg\\,mol^{-1}$):\n$$m = \\frac{M_{\\mathrm{Ar}}}{N_A} = \\frac{0.039948\\,\\mathrm{kg\\,mol^{-1}}}{N_A}$$\n\n有了这些基本量，我们接下来按指定顺序计算所需参数。\n\n**1. 平均自由程 ($\\lambda$)**\n根据气体动理论，硬球分子气体的平均自由程为：\n$$\\lambda = \\frac{1}{\\sqrt{2} n \\sigma}$$\n其中 $\\sigma$ 是总碰撞截面。对于直径为 $d = 3.66\\times 10^{-10}\\,\\mathrm{m}$ 的硬球，其截面为 $\\sigma = \\pi d^2$。代入数密度 $n$ 的表达式，我们得到：\n$$\\lambda = \\frac{1}{\\sqrt{2} \\left(\\frac{p}{k_B T}\\right) (\\pi d^2)} = \\frac{k_B T}{\\sqrt{2} \\pi d^2 p}$$\n代入给定的数值：\n$$\\lambda = \\frac{(1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) (300\\,\\mathrm{K})}{\\sqrt{2} \\pi (3.66 \\times 10^{-10}\\,\\mathrm{m})^2 (100\\,\\mathrm{Pa})} \\approx 6.95973 \\times 10^{-5}\\,\\mathrm{m}$$\n题目要求结果以微米 ($1\\,\\mathrm{\\mu m} = 10^{-6}\\,\\mathrm{m}$) 表示。\n$$\\lambda \\approx (6.95973 \\times 10^{-5}) \\times 10^6\\,\\mathrm{\\mu m} = 69.5973\\,\\mathrm{\\mu m}$$\n四舍五入至三位有效数字，我们得到 $\\lambda \\approx 69.6\\,\\mathrm{\\mu m}$。\n\n**2. 平均分子速率 ($\\bar{c}$)**\n处于热平衡状态的气体原子的平均分子速率可由麦克斯韦-玻尔兹曼分布推导得出：\n$$\\bar{c} = \\sqrt{\\frac{8 k_B T}{\\pi m}}$$\n首先，我们计算单个氩原子的质量 $m$：\n$$m = \\frac{0.039948\\,\\mathrm{kg\\,mol^{-1}}}{6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}} \\approx 6.633522 \\times 10^{-26}\\,\\mathrm{kg}$$\n现在，我们将这些值代入 $\\bar{c}$ 的表达式中：\n$$\\bar{c} = \\sqrt{\\frac{8 (1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) (300\\,\\mathrm{K})}{\\pi (6.633522 \\times 10^{-26}\\,\\mathrm{kg})}} \\approx 398.750\\,\\mathrm{m\\,s^{-1}}$$\n四舍五入至三位有效数字，我们得到 $\\bar{c} \\approx 399\\,\\mathrm{m\\,s^{-1}}$。\n\n**3. 单元尺寸 ($\\Delta x$)**\nDSMC 单元尺寸 $\\Delta x$ 被约束为平均自由程的一部分，由安全因子 $f=0.2$ 定义：\n$$\\Delta x = f \\lambda$$\n在这一中间步骤中使用未四舍五入的 $\\lambda$ 值以获得更高精度：\n$$\\Delta x = 0.2 \\times (6.95973 \\times 10^{-5}\\,\\mathrm{m}) \\approx 1.39195 \\times 10^{-5}\\,\\mathrm{m}$$\n转换为微米：\n$$\\Delta x \\approx (1.39195 \\times 10^{-5}) \\times 10^6\\,\\mathrm{\\mu m} = 13.9195\\,\\mathrm{\\mu m}$$\n四舍五入至三位有效数字，我们得到 $\\Delta x \\approx 13.9\\,\\mathrm{\\mu m}$。\n\n**4. 时间步长 ($\\Delta t$)**\nDSMC 时间步长 $\\Delta t$ 受平均碰撞时间 $\\tau_c$ 和单元穿越时间 $\\tau_{cross} = \\Delta x / \\bar{c}$ 的双重约束。题目将此约束表述为：\n$$\\Delta t = f \\min\\{\\tau_c, \\Delta x/\\bar{c}\\}$$\n我们必须首先计算并比较 $\\tau_c$ 和 $\\tau_{cross}$。平均碰撞时间定义为：\n$$\\tau_c = \\frac{\\lambda}{\\bar{c}} \\approx \\frac{6.95973 \\times 10^{-5}\\,\\mathrm{m}}{398.750\\,\\mathrm{m\\,s^{-1}}} \\approx 1.74585 \\times 10^{-7}\\,\\mathrm{s}$$\n单元穿越时间由下式给出：\n$$\\tau_{cross} = \\frac{\\Delta x}{\\bar{c}} = \\frac{f \\lambda}{\\bar{c}} = f \\tau_c$$\n由于 $f=0.2  1$，显然 $\\tau_{cross}  \\tau_c$。因此，两者中的较小值为 $\\tau_{cross}$：\n$$\\min\\{\\tau_c, \\Delta x/\\bar{c}\\} = \\Delta x/\\bar{c} \\approx \\frac{1.39195 \\times 10^{-5}\\,\\mathrm{m}}{398.750\\,\\mathrm{m\\,s^{-1}}} \\approx 3.49170 \\times 10^{-8}\\,\\mathrm{s}$$\n现在我们可以计算时间步长 $\\Delta t$：\n$$\\Delta t = f \\times (\\Delta x/\\bar{c}) = 0.2 \\times (3.49170 \\times 10^{-8}\\,\\mathrm{s}) \\approx 6.98341 \\times 10^{-9}\\,\\mathrm{s}$$\n题目要求结果以纳秒 ($1\\,\\mathrm{ns} = 10^{-9}\\,\\mathrm{s}$) 表示。\n$$\\Delta t \\approx 6.98341\\,\\mathrm{ns}$$\n四舍五入至三位有效数字，我们得到 $\\Delta t \\approx 6.98\\,\\mathrm{ns}$。\n\n总结一下，计算出的值四舍五入到三位有效数字为：\n- 平均自由程 $\\lambda = 69.6\\,\\mathrm{\\mu m}$\n- 平均分子速率 $\\bar{c} = 399\\,\\mathrm{m\\,s^{-1}}$\n- 单元尺寸 $\\Delta x = 13.9\\,\\mathrm{\\mu m}$\n- 时间步长 $\\Delta t = 6.98\\,\\mathrm{ns}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n69.6  399  13.9  6.98\n\\end{pmatrix}\n}\n$$", "id": "3309134"}, {"introduction": "随机碰撞过程是驱动DSMC模拟、使系统向热力学平衡态演化的核心引擎。本动手编程练习将带你深入该方法的核心，要求你实现广泛应用的“无时间计数器”（No-Time-Counter, NTC）碰撞算法。通过验证你的实现能够严格遵守质量、动量和能量守恒定律，你将巩固对支撑整个模拟技术的最基本物理原则的理解。[@problem_id:3309089]", "problem": "实现直接模拟蒙特卡罗 (DSMC) 方法在单个空间均匀单元中的单步碰撞过程，该过程针对等质量粒子的单原子气体和硬球碰撞。整个过程使用无量纲变量，因此不需要物理单位。您的实现必须遵循以下抽象规范，并对碰撞矩性质进行数值验证。\n\n假设在一个体积为 $V$ 的均匀单元中有 $N$ 个质量相等的粒子，其质量为 $m$。用 $\\{\\mathbf{v}_i\\}_{i=1}^{N}$ 表示三维空间中的粒子速度。考虑在时间步长 $\\Delta t$ 内的单个 DSMC 碰撞子步，其中只处理粒子间的碰撞（无平流）。使用各向同性硬球碰撞模型，其总截面为常数 $\\sigma_T$。\n\n碰撞步骤的算法规范：\n- 对于粒子对 $(i,j)$，定义质心速度为 $\\mathbf{V}_{\\mathrm{cm}} = \\frac{1}{2}(\\mathbf{v}_i + \\mathbf{v}_j)$，相对速度为 $\\mathbf{g} = \\mathbf{v}_i - \\mathbf{v}_j$，其大小为 $g = \\|\\mathbf{g}\\|$。\n- 计算主要相对速率 $g_{\\max}$，即单元中所有无序粒子对的 $g$ 的最大值。如果 $g_{\\max} = 0$，则不发生碰撞。\n- 定义碰撞试验的期望次数为\n$$\n\\overline{M} = \\frac{N(N-1)}{2}\\,\\frac{\\sigma_T\\,g_{\\max}\\,\\Delta t}{V}.\n$$\n从均匀分布 $\\mathrm{Uniform}(0,1)$ 中抽取一个随机数 $U$，并设置 $M = \\lfloor \\overline{M} + U \\rfloor$。\n- 重复 $M$ 次：从所有 $i \\neq j$ 的有序对中均匀随机选择一对不同的索引 $(i,j)$，计算所选粒子对的 $g$，并以概率 $\\min\\left(1, \\frac{g}{g_{\\max}}\\right)$ 接受该试验作为真实碰撞。对于被接受的碰撞，通过将相对速度方向替换为在单位球面上均匀采样的一个新的独立方向 $\\widehat{\\mathbf{n}}$ 来执行各向同性的碰撞后散射，同时保持其大小不变，并根据以下公式更新速度：\n$$\n\\mathbf{v}_i' = \\mathbf{V}_{\\mathrm{cm}} + \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}},\\qquad\n\\mathbf{v}_j' = \\mathbf{V}_{\\mathrm{cm}} - \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}}.\n$$\n如果试验被拒绝，则保持 $\\mathbf{v}_i, \\mathbf{v}_j$ 不变。\n\n定义单元内的碰撞不变量：\n- 总质量 $M_{\\text{tot}} = m \\sum_{i=1}^{N} 1$，\n- 总动量 $\\mathbf{P} = m \\sum_{i=1}^{N} \\mathbf{v}_i$，\n- 总动能 $E = \\frac{m}{2} \\sum_{i=1}^{N} \\|\\mathbf{v}_i\\|^2$。\n\n您的任务：\n- 为单个均匀单元实现上述 DSMC 碰撞步骤。\n- 从一个三维正态分布（其各独立分量的均值为零，方差为一）中初始化粒子速度，然后为所有速度添加一个预设的恒定漂移向量 $\\mathbf{u}$。所有粒子使用相同的质量，并设置 $m = 1$。\n- 对于下面指定的每个测试用例，计算一步碰撞后不变量的绝对变化量，\n$$\n\\Delta M_{\\text{tot}} = \\left|M_{\\text{tot}}^{\\text{after}} - M_{\\text{tot}}^{\\text{before}}\\right|,\\quad\n\\|\\Delta \\mathbf{P}\\| = \\left\\| \\mathbf{P}^{\\text{after}} - \\mathbf{P}^{\\text{before}} \\right\\|,\\quad\n\\Delta E = \\left|E^{\\text{after}} - E^{\\text{before}}\\right|,\n$$\n并为每个用例输出等于\n$$\nR = \\max\\left\\{\\Delta M_{\\text{tot}}, \\|\\Delta \\mathbf{P}\\|, \\Delta E\\right\\}\n$$\n的单个标量结果。这个 $R$ 值应非常接近于零，从而数值上证明任何碰撞不变量的期望变化为零。\n\n所有计算必须以无量纲单位进行。不需要角度输入。必须通过为每个测试用例使用指定的随机种子 $s$ 来确保随机采样的可复现性。\n\n测试套件：\n- 情况 A (标准情况)：$N = 160$， $V = 1.0$， $m = 1$， $\\Delta t = 0.02$， $\\sigma_T = 0.1$， 漂移 $\\mathbf{u} = (0,0,0)$， 种子 $s = 1$。\n- 情况 B (非零漂移)：$N = 160$， $V = 1.0$， $m = 1$， $\\Delta t = 0.02$， $\\sigma_T = 0.1$， 漂移 $\\mathbf{u} = (0.5,-0.3,0.2)$， 种子 $s = 2$。\n- 情况 C (无碰撞边界)：$N = 160$， $V = 1.0$， $m = 1$， $\\Delta t = 0.02$， $\\sigma_T = 0$， 漂移 $\\mathbf{u} = (0.1,0.1,0.1)$， 种子 $s = 3$。\n- 情况 D (小样本边缘情况)：$N = 2$， $V = 1.0$，$m = 1$， $\\Delta t = 1.0$， $\\sigma_T = 0.5$， 漂移 $\\mathbf{u} = (0,0,0)$， 种子 $s = 4$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含情况 A–D 的四个结果 $R$，格式为用方括号括起来的逗号分隔列表（例如，$[r_A,r_B,r_C,r_D]$）。每个 $r_\\cdot$ 都必须是浮点数。", "solution": "用户要求实现针对空间均匀系统的单步直接模拟蒙特卡罗 (DSMC) 碰撞过程。其目标是在碰撞过程中数值验证质量、动量和能量的守恒性。该算法遵循无时间计数器 (NTC) 主要频率方案。\n\n整个过程的逻辑实现如下：\n\n1.  **系统初始化**：对于每个测试用例，我们首先根据指定的种子初始化一个伪随机数生成器以确保结果的可复现性。然后，我们生成 $N$ 个粒子的初始速度。每个速度向量都从一个均值为零、方差为一的三维正态分布中抽取，然后加上指定的恒定漂移速度 $\\mathbf{u}$。所有粒子的质量 $m$ 均设为 1。\n\n2.  **计算碰撞前不变量**：在执行碰撞步骤之前，我们计算并存储系统的初始总质量、总动量和总动能。\n    *   总质量 $M_{\\text{tot}}^{\\text{before}} = mN$。这是一个常数，其变化量始终为零。\n    *   总动量 $\\mathbf{P}^{\\text{before}} = m \\sum_{i=1}^{N} \\mathbf{v}_i$。\n    *   总动能 $E^{\\text{before}} = \\frac{m}{2} \\sum_{i=1}^{N} \\|\\mathbf{v}_i\\|^2$。\n\n3.  **执行碰撞步骤**：这是算法的核心。\n    *   **计算主要相对速率 $g_{\\max}$**：我们首先计算出单元中所有粒子对之间相对速度大小的最大值 $g_{\\max}$。如果 $g_{\\max}=0$（即所有粒子速度相同），则不进行碰撞。\n    *   **确定碰撞试验次数 $M$**：根据 NTC 方案，我们计算预期的碰撞试验次数 $\\overline{M} = \\frac{N(N-1)}{2}\\,\\frac{\\sigma_T\\,g_{\\max}\\,\\Delta t}{V}$。实际的试验次数 $M$ 通过对 $\\overline{M}$ 进行泊松抽样得到，这里使用一种等效的简单方法 $M = \\lfloor \\overline{M} + U \\rfloor$，其中 $U \\sim \\mathrm{Uniform}(0,1)$。\n    *   **碰撞循环**：我们执行 $M$ 次碰撞试验。在每次试验中：\n        1.  随机选择一对不同的粒子 $(i, j)$。\n        2.  计算它们当前的相对速度大小 $g = \\|\\mathbf{v}_i - \\mathbf{v}_j\\|$。\n        3.  进行**接受-拒绝**判断：生成一个随机数 $U' \\sim \\mathrm{Uniform}(0,1)$。如果 $U'  g/g_{\\max}$，则接受该次试验为一次真实的碰撞。\n        4.  如果碰撞被接受，则更新粒子的速度。计算质心速度 $\\mathbf{V}_{\\mathrm{cm}}$，然后生成一个新的随机单位方向向量 $\\widehat{\\mathbf{n}}$。碰撞后的速度根据能量和动量守恒定律更新为 $\\mathbf{v}_i' = \\mathbf{V}_{\\mathrm{cm}} + \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}}$ 和 $\\mathbf{v}_j' = \\mathbf{V}_{\\mathrm{cm}} - \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}}$。如果试验被拒绝，则粒子速度保持不变。\n\n4.  **计算碰撞后不变量**：在所有 $M$ 次碰撞试验完成后，我们使用更新后的粒子速度 $\\{\\mathbf{v}'_i\\}$ 重新计算总动量 $\\mathbf{P}^{\\text{after}}$ 和总动能 $E^{\\text{after}}$。\n\n5.  **计算偏差**：最后，我们计算碰撞前后不变量的绝对变化量：$\\|\\Delta \\mathbf{P}\\| = \\|\\mathbf{P}^{\\text{after}} - \\mathbf{P}^{\\text{before}}\\|$ 和 $\\Delta E = |E^{\\text{after}} - E^{\\text{before}}|$。由于质量守恒是平凡的，$\\Delta M_{\\text{tot}} = 0$。\n\n6.  **输出结果**：最终报告的值 $R$ 是这三个变化量中的最大值，$R = \\max\\{0, \\|\\Delta \\mathbf{P}\\|, \\Delta E\\}$。由于每次碰撞都精确地遵守守恒定律，理论上 $R$ 应该为零。在实际的浮点数计算中，它应该是一个非常接近于零的数值，其大小取决于机器精度。该程序对指定的四种情况执行此过程并报告 $R$ 值。", "answer": "```python\nimport numpy as np\n\ndef run_dsmc_step(N, V, m, dt, sigma_T, u_drift, seed):\n    \"\"\"\n    Performs a single DSMC collision step for a uniform cell.\n    \n    Args:\n        N (int): Number of particles.\n        V (float): Volume of the cell.\n        m (float): Mass of each particle.\n        dt (float): Time step.\n        sigma_T (float): Total collision cross-section.\n        u_drift (np.ndarray): Drift velocity vector (shape (3,)).\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        float: The maximum deviation R among collision invariants.\n    \"\"\"\n    # Use a dedicated generator for reproducibility for each test case.\n    rng = np.random.default_rng(seed)\n\n    # 1. Initialize particle velocities from N(0,I) + drift.\n    velocities = rng.normal(loc=0.0, scale=1.0, size=(N, 3)) + u_drift\n    \n    # 2. Compute \"before\" collision invariants.\n    # Total mass is constant, so its change is always zero.\n    delta_M_tot = 0.0\n    P_before = m * np.sum(velocities, axis=0)\n    E_before = (m / 2.0) * np.sum(velocities**2)\n    \n    # 3. Perform the collision step.\n    # 3a. Compute the majorant relative speed g_max.\n    g_max = 0.0\n    if N = 2:\n        # A vectorized approach to find the max relative speed.\n        # This creates an (N, N, 3) array of v_i - v_j.\n        diffs = velocities[:, np.newaxis, :] - velocities[np.newaxis, :, :]\n        # This gives an (N, N) matrix of squared relative speeds.\n        g_sq_matrix = np.sum(diffs**2, axis=-1)\n        # The maximum of this matrix is g_max^2.\n        g_max_sq = np.max(g_sq_matrix)\n        if g_max_sq > 0:\n            g_max = np.sqrt(g_max_sq)\n            \n    # If g_max is 0, all particles have the same velocity, so M_bar is 0, M is 0.\n    # The collision loop will not run.\n    if g_max > 0.0:\n        # 3b. Calculate the number of collision trials, M.\n        M_bar = (N * (N - 1) / 2.0) * (sigma_T * g_max * dt) / V\n        U = rng.uniform(0.0, 1.0)\n        M = int(M_bar + U)\n        \n        # 3c. Main collision loop.\n        for _ in range(M):\n            # Select a random ordered pair of distinct indices (i, j).\n            i = rng.integers(0, N)\n            j = rng.integers(0, N - 1)\n            if j = i:\n                j += 1\n            \n            # Compute relative velocity for the selected pair.\n            g_vec = velocities[i] - velocities[j]\n            g = np.linalg.norm(g_vec)\n\n            # 3d. Acceptance-rejection step.\n            if rng.uniform(0.0, 1.0)  g / g_max:\n                # Collision accepted.\n                # Compute center-of-mass velocity.\n                V_cm = 0.5 * (velocities[i] + velocities[j])\n                \n                # Sample a new relative velocity direction uniformly on the unit sphere.\n                z = rng.normal(loc=0.0, scale=1.0, size=3)\n                norm_z = np.linalg.norm(z)\n                if norm_z == 0.0: # Highly unlikely but good practice.\n                    n_hat = np.array([1.0, 0.0, 0.0])\n                else:\n                    n_hat = z / norm_z\n                    \n                # Update particle velocities.\n                velocities[i] = V_cm + 0.5 * g * n_hat\n                velocities[j] = V_cm - 0.5 * g * n_hat\n    \n    # 4. Compute \"after\" collision invariants.\n    P_after = m * np.sum(velocities, axis=0)\n    E_after = (m / 2.0) * np.sum(velocities**2)\n    \n    # 5. Calculate deviations and the final result R.\n    delta_P_norm = np.linalg.norm(P_after - P_before)\n    delta_E = abs(E_after - E_before)\n    \n    R = max(delta_M_tot, delta_P_norm, delta_E)\n    \n    return R\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (N, V, m, dt, sigma_T, u_drift, seed)\n        (160, 1.0, 1.0, 0.02, 0.1, np.array([0.0, 0.0, 0.0]), 1),\n        # Case B:\n        (160, 1.0, 1.0, 0.02, 0.1, np.array([0.5, -0.3, 0.2]), 2),\n        # Case C:\n        (160, 1.0, 1.0, 0.02, 0.0, np.array([0.1, 0.1, 0.1]), 3),\n        # Case D:\n        (2, 1.0, 1.0, 1.0, 0.5, np.array([0.0, 0.0, 0.0]), 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_dsmc_step(*case)\n        results.append(result)\n\n    # Print the results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3309089"}]}