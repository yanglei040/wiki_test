{"hands_on_practices": [{"introduction": "将连续的偏微分方程转化为离散的代数方程是计算流体动力学（CFD）的核心。这个转换过程引入了截断误差，并对数值稳定性提出了要求。本实践探讨了在各向异性网格（即不同方向上步长不等）上离散拉普拉斯算子所带来的基本问题[@problem_id:3340070]。通过推导截断误差和显式时间积分格式的稳定性约束，你将深入理解网格分辨率、精度和计算成本（通过时间步长限制）之间的根本权衡。", "problem": "考虑一个边长为 $L$ 的方形顶盖驱动腔内的二维不可压缩Navier–Stokes方程，其中顶盖以均匀速度 $U$ 沿 $x$ 方向移动，所有壁面均为无滑移边界条件。采用标准的投影法来强制满足不可压缩性：一个显式粘性更新步骤产生一个临时速度场，然后求解一个压力Poisson问题将该场投影到无散度空间上。空间离散化在均匀但各向异性的笛卡尔网格上使用二阶中心有限差分，网格间距为 $\\Delta x \\neq \\Delta y$，其中 $\\Delta x = L/N_{x}$ 和 $\\Delta y = L/N_{y}$，对于给定的正整数 $N_{x}$ 和 $N_{y}$。在内部节点 $(i,j)$ 处，标量场 $\\phi$ 的离散拉普拉斯算子定义为\n$$\n(\\nabla_{h}^{2}\\phi)_{i,j} \\equiv \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^{2}} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^{2}}.\n$$\n从偏微分方程模型和上述离散算子出发，完成以下任务：\n\n(1) 推导离散拉普拉斯算子 $(\\nabla_{h}^{2}\\phi)_{i,j}$ 的主阶截断误差，用 $\\phi$ 的连续导数表示，并明确展示其对 $\\Delta x$ 和 $\\Delta y$ 的依赖关系。\n\n(2) 考虑应用于速度各分量的粘性项的显式前向Euler更新，\n$$\n\\boldsymbol{u}^{*} = \\boldsymbol{u}^{n} + \\nu\\,\\Delta t\\,\\nabla_{h}^{2}\\boldsymbol{u}^{n},\n$$\n其中 $\\nu$ 是运动粘度，$\\Delta t$ 是时间步长。使用对离散拉普拉斯算子在腔壁上施加齐次Dirichlet边界条件的模态（特征值）分析，推导出一个依赖于 $\\Delta x$ 和 $\\Delta y$ 的 $\\Delta t$ 稳定性界限。解释各向异性（$\\Delta x \\neq \\Delta y$）如何影响这个界限。\n\n(3) 使用离散内积论证，证明亥姆霍兹-霍奇（Helmholtz–Hodge）投影步骤在适当的离散$\\ell^{2}$范数下是非扩张的，因此在使用相容的中心差分格式计算散度和梯度时，不会对第(2)部分推导出的显式粘性稳定性界限施加额外的限制。\n\n最后，对于一个参数为 $L = 0.1$ $\\mathrm{m}$，$N_{x} = 128$，$N_{y} = 64$，以及 $\\nu = 1.0 \\times 10^{-6}$ $\\mathrm{m}^{2}/\\mathrm{s}$ 的腔体，计算你在第(2)部分中为显式粘性更新推导出的最大稳定时间步长 $\\Delta t$。以秒为单位表示你的最终时间步长，并将答案四舍五入到四位有效数字。", "solution": "本问题探讨了不可压缩Navier-Stokes方程有限差分格式的数值分析，重点关注截断误差、稳定性以及投影法的性质。我们将按顺序处理问题的每个部分。\n\n(1) 离散拉普拉斯算子的截断误差\n\n离散拉普拉斯算子 $(\\nabla_{h}^{2}\\phi)_{i,j}$ 的截断误差 $\\tau_{i,j}$ 定义为，离散算子作用于连续场 $\\phi(x,y)$ 的结果与精确的连续拉普拉斯算子作用于同一场在网格点 $(x_i, y_j)$ 处的值之差。\n$$\n\\tau_{i,j} = (\\nabla_{h}^{2}\\phi)_{i,j} - (\\nabla^{2}\\phi)(x_i, y_j)\n$$\n连续拉普拉斯算子为 $\\nabla^{2}\\phi = \\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\partial^{2}\\phi}{\\partial y^{2}}$。给定的离散拉普拉斯算子为\n$$\n(\\nabla_{h}^{2}\\phi)_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^{2}} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^{2}}\n$$\n为求截断误差，我们假设 $\\phi$ 足够光滑，围绕点 $(x_i, y_j)$ 对 $\\phi_{i\\pm1, j}$ 和 $\\phi_{i, j\\pm1}$ 项进行泰勒级数展开。对于 $x$ 方向的导数，我们有：\n$$\n\\phi_{i+1,j} = \\phi(x_i+\\Delta x, y_j) = \\phi_{i,j} + \\Delta x\\frac{\\partial\\phi}{\\partial x} + \\frac{\\Delta x^{2}}{2!}\\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\Delta x^{3}}{3!}\\frac{\\partial^{3}\\phi}{\\partial x^{3}} + \\frac{\\Delta x^{4}}{4!}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{5})\n$$\n$$\n\\phi_{i-1,j} = \\phi(x_i-\\Delta x, y_j) = \\phi_{i,j} - \\Delta x\\frac{\\partial\\phi}{\\partial x} + \\frac{\\Delta x^{2}}{2!}\\frac{\\partial^{2}\\phi}{\\partial x^{2}} - \\frac{\\Delta x^{3}}{3!}\\frac{\\partial^{3}\\phi}{\\partial x^{3}} + \\frac{\\Delta x^{4}}{4!}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{5})\n$$\n将这两个展开式相加，可以消去奇数阶导数项：\n$$\n\\phi_{i+1,j} + \\phi_{i-1,j} = 2\\phi_{i,j} + \\Delta x^{2}\\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{2\\Delta x^{4}}{24}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{6})\n$$\n重新整理此表达式以匹配离散导数的形式，得到：\n$$\n\\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^{2}} = \\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{4})\n$$\n对 $y$ 方向进行相同的分析，可得：\n$$\n\\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^{2}} = \\frac{\\partial^{2}\\phi}{\\partial y^{2}} + \\frac{\\Delta y^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial y^{2}} + O(\\Delta y^{4})\n$$\n将这些表达式代回离散拉普拉斯算子的定义中，我们得到：\n$$\n(\\nabla_{h}^{2}\\phi)_{i,j} = \\left(\\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\partial^{2}\\phi}{\\partial y^{2}}\\right) + \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + \\frac{\\Delta y^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial y^{2}} + O(\\Delta x^{4}, \\Delta y^{4})\n$$\n括号中的项是连续拉普拉斯算子 $\\nabla^{2}\\phi$。因此，主阶截断误差为：\n$$\n\\tau_{i,j} = \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + \\frac{\\Delta y^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial y^{2}}\n$$\n该离散格式在空间上是二阶精确的，其误差明确地依赖于网格间距 $\\Delta x$ 和 $\\Delta y$。\n\n(2) 显式粘性更新的稳定性界限\n\n对于粘性项的显式前向Euler格式 $\\boldsymbol{u}^{*} = \\boldsymbol{u}^{n} + \\nu\\,\\Delta t\\,\\nabla_{h}^{2}\\boldsymbol{u}^{n}$，其稳定性通过检查离散误差模态的放大情况来分析。该分析对每个速度分量都是相同的，因此我们考虑一个标量场 $u$。模态分析需要找到在齐次Dirichlet边界条件下离散拉普拉斯算子 $\\nabla_{h}^{2}$ 的特征值。\n\n离散域上算子的一个特征模态可以写成 $u_{i,j} = \\sin(k_x x_i) \\sin(k_y y_j)$，其中 $x_i = i\\Delta x$ 且 $y_j = j\\Delta y$。波数为 $k_x = m\\pi/L$ 和 $k_y = p\\pi/L$，其中整数 $m \\in [1, N_x-1]$ 和 $p \\in [1, N_y-1]$。将离散拉普拉斯算子应用于此模态，得到：\n$$\n(\\nabla_{h}^{2}u)_{i,j} = \\left( \\frac{\\sin(k_x(i+1)\\Delta x) - 2\\sin(k_x i\\Delta x) + \\sin(k_x(i-1)\\Delta x)}{\\Delta x^2} \\right)\\sin(k_y j\\Delta y) + \\sin(k_x i\\Delta x)\\left( \\frac{\\sin(k_y(j+1)\\Delta y) - 2\\sin(k_y j\\Delta y) + \\sin(k_y(j-1)\\Delta y)}{\\Delta y^2} \\right)\n$$\n使用三角恒等式 $\\sin(A+B)+\\sin(A-B) = 2\\sin(A)\\cos(B)$，$x$ 项的分子可简化为 $2\\sin(k_x i\\Delta x)\\cos(k_x\\Delta x) - 2\\sin(k_x i\\Delta x) = 2\\sin(k_x i\\Delta x)(\\cos(k_x\\Delta x)-1)$。再利用半角恒等式 $\\cos(\\theta)-1 = -2\\sin^2(\\theta/2)$，上式变为 $-4\\sin(k_x i\\Delta x)\\sin^2(k_x\\Delta x/2)$。$y$ 项也有类似的结果。\n因此，应用该算子的结果为：\n$$\n(\\nabla_{h}^{2}u)_{i,j} = \\left[ -\\frac{4}{\\Delta x^2}\\sin^2\\left(\\frac{k_x\\Delta x}{2}\\right) - \\frac{4}{\\Delta y^2}\\sin^2\\left(\\frac{k_y\\Delta y}{2}\\right) \\right] u_{i,j}\n$$\n方括号中的表达式是对应于模态 $(m,p)$ 的特征值 $\\lambda_{m,p}$。将一个特征模态代入时间步进格式，得到 $u^{n+1} = (1 + \\nu\\Delta t \\lambda_{m,p})u^n$。放大因子为 $G = 1 + \\nu\\Delta t \\lambda_{m,p}$。为保证稳定性，我们需要 $|G| \\leq 1$，即 $-1 \\leq 1 + \\nu\\Delta t \\lambda_{m,p} \\leq 1$。\n对于任何非平凡模态，特征值 $\\lambda_{m,p}$ 都是严格为负的，所以条件 $G \\leq 1$ 总是满足的。剩下的条件是 $-1 \\leq 1 + \\nu\\Delta t \\lambda_{m,p}$，这意味着 $\\nu\\Delta t \\lambda_{m,p} \\geq -2$，或者 $\\Delta t \\leq \\frac{-2}{\\nu\\lambda_{m,p}}$。\n\n为确保对所有可能的模态都稳定，我们必须对具有最大绝对值（即最负的）的特征值满足此条件，我们将其表示为 $\\lambda_{min}$。这种情况发生在网格所能支持的最高频率模态下，此时 $\\sin^2$ 项被最大化。其宗量为 $\\frac{k_x\\Delta x}{2} = \\frac{m\\pi}{L}\\frac{L/N_x}{2} = \\frac{m\\pi}{2N_x}$ 和 $\\frac{k_y\\Delta y}{2} = \\frac{p\\pi}{2N_y}$。$\\sin^2$ 的最大值为1，当其宗量接近 $\\pi/2$ 时达到。这对应于最高的波数，$m=N_x-1$ 和 $p=N_y-1$，此时 $k_x \\approx \\pi/\\Delta x$ 且 $k_y \\approx \\pi/\\Delta y$。对于这些“最坏情况”的模态，$\\sin^2(k_x\\Delta x/2) \\approx 1$ 且 $\\sin^2(k_y\\Delta y/2) \\approx 1$。\n因此，最负的特征值近似为：\n$$\n\\lambda_{min} \\approx -\\frac{4}{\\Delta x^2} - \\frac{4}{\\Delta y^2}\n$$\n稳定性条件变为：\n$$\n\\Delta t \\leq \\frac{-2}{\\nu(-\\frac{4}{\\Delta x^2} - \\frac{4}{\\Delta y^2})} = \\frac{1}{2\\nu(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2})}\n$$\n各向异性（$\\Delta x \\neq \\Delta y$）直接进入这个界限。稳定性极限由网格间距平方的倒数之和决定。如果一个网格间距远小于另一个（例如 $\\Delta x \\ll \\Delta y$），则具有较小间距的项（$1/\\Delta x^2$）将主导总和，使得时间步长的限制更为严格。稳定性实际上由网格中最小的网格单元尺寸决定。\n\n(3) 投影步骤的非扩张性质\n\n投影步骤将临时速度场 $\\boldsymbol{u}^*$ 分解为一个无散部分 $\\boldsymbol{u}^{n+1}$ 和一个标量势 $\\phi$（与压力相关）的梯度，使得 $\\boldsymbol{u}^* = \\boldsymbol{u}^{n+1} + \\nabla_h \\phi$。根据构造，$\\nabla_h \\cdot \\boldsymbol{u}^{n+1} = 0$。问题是要证明这个投影在离散$\\ell^2$范数下是非扩张的，即 $\\|\\boldsymbol{u}^{n+1}\\|_2 \\leq \\|\\boldsymbol{u}^*\\|_2$。\n\n平方$\\ell^2$范数通过内积定义，$\\|\\boldsymbol{v}\\|_2^2 = \\langle \\boldsymbol{v}, \\boldsymbol{v} \\rangle = \\sum_{i,j} \\boldsymbol{v}_{i,j} \\cdot \\boldsymbol{v}_{i,j} \\Delta x \\Delta y$。我们计算 $\\boldsymbol{u}^*$ 的平方范数：\n$$\n\\|\\boldsymbol{u}^*\\|^2 = \\langle \\boldsymbol{u}^{n+1} + \\nabla_h \\phi, \\boldsymbol{u}^{n+1} + \\nabla_h \\phi \\rangle = \\|\\boldsymbol{u}^{n+1}\\|^2 + 2\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle + \\|\\nabla_h \\phi\\|^2\n$$\n关键步骤是分析交叉项 $\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle$。利用分部求和性质（这是分部积分的离散模拟），并假设梯度（$\\nabla_h$）和散度（$\\nabla_h \\cdot$）的有限差分算子是相容的，该内积可以被重写。对于满足负共轭关系 $\\langle \\boldsymbol{v}, \\nabla_h \\psi \\rangle = -\\langle \\nabla_h \\cdot \\boldsymbol{v}, \\psi \\rangle$ 的离散算子（在适当条件下边界项为零），我们有：\n$$\n\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle = -\\langle\\nabla_h \\cdot \\boldsymbol{u}^{n+1}, \\phi\\rangle\n$$\n根据投影的定义，得到的速度场 $\\boldsymbol{u}^{n+1}$ 是离散无散的，所以 $\\nabla_h \\cdot \\boldsymbol{u}^{n+1} = 0$。因此，内积为零：\n$$\n\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle = 0\n$$\n这表明离散无散场空间和离散梯度场空间在此内积下是正交的。该分解是正交分解。\n将此结果代回 $\\|\\boldsymbol{u}^*\\|^2$ 的表达式中，得到：\n$$\n\\|\\boldsymbol{u}^*\\|^2 = \\|\\boldsymbol{u}^{n+1}\\|^2 + \\|\\nabla_h \\phi\\|^2\n$$\n这是勾股定理的离散形式。由于平方范数 $\\|\\nabla_h \\phi\\|^2$ 是非负的，直接可得：\n$$\n\\|\\boldsymbol{u}^{n+1}\\|^2 \\leq \\|\\boldsymbol{u}^*\\|^2\n$$\n对两边取平方根，我们得到 $\\|\\boldsymbol{u}^{n+1}\\|_2 \\leq \\|\\boldsymbol{u}^*\\|_2$。这证实了投影步骤是非扩张的。它不会放大速度场的范数。因此，整个格式的稳定性仅由显式粘性（以及对流，如果存在）更新决定，投影步骤不施加任何额外的、更严格的稳定性约束。\n\n最终计算\n\n我们被要求为给定参数计算最大稳定时间步长 $\\Delta t_{max}$。公式是：\n$$\n\\Delta t_{max} = \\frac{1}{2\\nu\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)}\n$$\n给定值为 $L = 0.1\\,\\mathrm{m}$，$N_x = 128$，$N_y = 64$，以及 $\\nu = 1.0 \\times 10^{-6}\\,\\mathrm{m^2/s}$。\n首先，我们计算网格间距：\n$$\n\\Delta x = \\frac{L}{N_x} = \\frac{0.1\\,\\mathrm{m}}{128}\n$$\n$$\n\\Delta y = \\frac{L}{N_y} = \\frac{0.1\\,\\mathrm{m}}{64}\n$$\n接下来，我们计算间距平方的倒数：\n$$\n\\frac{1}{\\Delta x^2} = \\left(\\frac{128}{0.1}\\right)^2 = 1280^2 = 1,638,400\\,\\mathrm{m}^{-2}\n$$\n$$\n\\frac{1}{\\Delta y^2} = \\left(\\frac{64}{0.1}\\right)^2 = 640^2 = 409,600\\,\\mathrm{m}^{-2}\n$$\n它们的和是：\n$$\n\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} = 1,638,400 + 409,600 = 2,048,000\\,\\mathrm{m}^{-2}\n$$\n现在，我们将此结果代入稳定性公式：\n$$\n\\Delta t_{max} = \\frac{1}{2(1.0 \\times 10^{-6}\\,\\mathrm{m^2/s})(2,048,000\\,\\mathrm{m}^{-2})} = \\frac{1}{2 \\times 10^{-6} \\times 2.048 \\times 10^{6}\\,\\mathrm{s}^{-1}} = \\frac{1}{4.096\\,\\mathrm{s}^{-1}}\n$$\n进行最后的除法运算：\n$$\n\\Delta t_{max} = 0.244140625\\,\\mathrm{s}\n$$\n按照要求四舍五入到四位有效数字，我们得到：\n$$\n\\Delta t_{max} \\approx 0.2441\\,\\mathrm{s}\n$$", "answer": "$$\\boxed{0.2441}$$", "id": "3340070"}, {"introduction": "在正确离散控制方程的内部求解域之后，边界条件的处理成为保证模拟精度的关键，且常常是误差的主要来源。在流函数-涡量方法中，无滑移壁面上的涡量值是未知的，必须通过离散的流场信息进行计算。本实践将指导你推导一个二阶精度的壁面涡量公式[@problem_id:3340086]，这是一个显著提高壁面剪切力计算精度的经典技术。", "problem": "考虑二维不可压缩顶盖驱动方腔流，该区域在两个方向上都使用间距为 $h$ 的均匀笛卡尔网格进行离散。使用不可压缩Navier-Stokes方程的流函数-涡量公式，其中流函数 $\\psi(x,y)$ 满足运动学关系 $u = \\partial \\psi / \\partial y$ 和 $v = - \\partial \\psi / \\partial x$，标量涡量 $\\omega(x,y)$ 定义为 $\\omega = \\partial v / \\partial x - \\partial u / \\partial y$。流函数-涡量运动学约束为 $\\nabla^{2} \\psi = - \\omega$，在整个区域内均成立。在所有固壁上，无穿透条件意味着流函数沿壁面为常数；在顶盖 $y = H$ 上取 $\\psi = \\psi_{w}$。顶盖以恒定的切向速度 $U$ 沿 $x$ 方向移动，因此 $u(x,H) = U$ 且 $v(x,H) = 0$。\n\n令 $j$ 为 $y$ 方向网格线的索引，其中 $j=N$ 表示位于 $y=H$ 处的顶壁，$j=N-1$ 表示位于 $y=H-h$ 处的第一条内部网格线，$j=N-2$ 表示位于 $y=H-2h$ 处的第二条内部网格线。类似地，令 $i$ 为 $x$ 方向网格线的索引。记 $\\psi_{i,N} = \\psi(x_{i},H)$，$\\psi_{i,N-1} = \\psi(x_{i},H-h)$ 及 $\\psi_{i,N-2} = \\psi(x_{i},H-2h)$。\n\n从上述基本定义出发，利用关于 $y=H$ 点在壁面法向上的泰勒展开，构建一个关于顶壁涡量 $\\omega_{i,N} = \\omega(x_{i},H)$ 的二阶精度离散边界条件，该条件用 $\\psi_{i,N}$、$\\psi_{i,N-1}$、$\\psi_{i,N-2}$、网格间距 $h$ 和顶盖速度 $U$ 来表示。你的构建过程必须：\n\n- 仅使用定义 $u = \\partial \\psi / \\partial y$、$v = - \\partial \\psi / \\partial x$、$\\omega = \\partial v / \\partial x - \\partial u / \\partial y$ 和 $\\nabla^{2} \\psi = - \\omega$，以及光滑性（所需导数的存在性）。\n- 通过显式地消去壁面法向展开的泰勒级数余项中直到 $h$ 阶的所有项，来强制实现 $h$ 的二阶一致性。\n- 解释在顶壁无穿透条件下为什么 $\\psi_{xx}(x,H) = 0$，以及这如何简化了壁面上 $\\omega$ 和 $\\psi$ 之间的关系。\n\n然后，从第一性原理出发，通过阐述以下几点来分析你的边界条件对计算所得的近壁面涡量的稳定性及影响：\n\n- 一致性：证明对于任何近壁面流向速度 $u(y)$ 是 $y$ 的线性函数，以及对于均匀顶盖运动 $u(x,H) = U$, $v(x,H) = 0$ 的流动，你的边界条件能够恢复精确的壁面涡量。\n- 稳定性：对于粘性流，使用基于能量或拟涡能的推理，论证为何一个作为 $\\omega(x_{i},H) = - \\partial^{2} \\psi / \\partial y^{2}(x_{i},H)$ 的二阶精度近似的边界条件，在一个半离散的扩散主导区域内不会在壁面注入伪拟涡能，因此相对于一阶壁面涡量近似而言是非失稳的。\n- 近壁面影响：解释提高壁面涡量条件的精度阶数如何改变主阶截断误差以及顶盖附近计算出的涡量梯度的定性行为，特别是在减轻移动壁面附近的过冲或下冲现象以及提高剪切应力 $\\tau_{w} = \\mu \\, \\partial u / \\partial y$ 的精度方面。\n\n将你的最终答案表示为关于 $\\psi_{i,N}$、$\\psi_{i,N-1}$、$\\psi_{i,N-2}$、$h$ 和 $U$ 的单一、闭式解析表达式。不需要进行数值评估，最终表达式中不应包含任何单位。", "solution": "本问题要求为方腔移动顶盖上的涡量 $\\omega$ 推导一个二阶精度的有限差分边界条件。推导将基于不可压缩Navier-Stokes方程的流函数-涡量公式。\n\n控制方程和定义如下：\n- 运动学关系：$u = \\frac{\\partial \\psi}{\\partial y}$ 和 $v = -\\frac{\\partial \\psi}{\\partial x}$。\n- 涡量定义：$\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。\n- 流函数-涡量方程：$\\nabla^{2} \\psi = \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} = -\\omega$。\n\n这个最终的方程，即流函数 $\\psi$ 的泊松方程，在整个区域内（包括其边界）都成立。在顶壁（由 $j=N$ 索引）上的任意点 $(x_i, H)$，我们有：\n$$\n\\omega(x_i, H) = -\\left( \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} \\right)\\bigg|_{y=H}\n$$\n我们将网格点 $i$ 处的壁面量记为 $\\omega_{i,N} = \\omega(x_i, H)$ 和 $\\psi_{i,N} = \\psi(x_i, H)$。\n\n首先，我们分析项 $\\frac{\\partial^2 \\psi}{\\partial x^2}(x_i, H)$。问题陈述了顶盖上的边界条件为 $u(x,H) = U$ 和 $v(x,H) = 0$。在直线 $y=H$ 上的无穿透条件 $v=0$ 意味着：\n$$\nv(x,H) = -\\frac{\\partial \\psi}{\\partial x}(x,H) = 0\n$$\n该方程沿顶盖对所有 $x$ 均成立。这意味着 $\\psi(x,H)$ 相对于 $x$ 是一个常数。问题陈述通过在顶盖上指定 $\\psi = \\psi_w$ 来证实这一点。由于 $\\psi(x,H)$ 不随 $x$ 变化，其关于 $x$ 的一阶和二阶偏导数均为零：\n$$\n\\frac{\\partial \\psi}{\\partial x}(x,H) = 0 \\quad \\text{and} \\quad \\frac{\\partial^2 \\psi}{\\partial x^2}(x,H) = 0\n$$\n这将顶壁上涡量与流函数之间的关系简化为：\n$$\n\\omega(x_i, H) = - \\frac{\\partial^2 \\psi}{\\partial y^2}(x_i, H) \\quad \\implies \\quad \\omega_{i,N} = -\\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N}\n$$\n我们现在的目标是利用壁面点（$j=N$）和其附近的内部网格点（$j=N-1$, $j=N-2$）上的 $\\psi$ 值和已知的速度边界条件，来找到 $\\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N}$ 的一个二阶精度有限差分近似。\n\n我们对固定的 $x_i$，在点 $y=H$ 附近，为 $y = H-h$ 和 $y = H-2h$ 处的 $\\psi$ 写出泰勒级数展开：\n$$\n\\psi_{i,N-1} = \\psi(x_i, H-h) = \\psi_{i,N} - h \\left(\\frac{\\partial \\psi}{\\partial y}\\right)_{i,N} + \\frac{h^2}{2} \\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N} - \\frac{h^3}{6} \\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\n$$\n\\psi_{i,N-2} = \\psi(x_i, H-2h) = \\psi_{i,N} - 2h \\left(\\frac{\\partial \\psi}{\\partial y}\\right)_{i,N} + \\frac{(2h)^2}{2} \\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N} - \\frac{(2h)^3}{6} \\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\n切向速度的边界条件 $u(x,H)=U$ 给了我们 $\\psi$ 的一阶导数：\n$$\nu(x_i, H) = \\left(\\frac{\\partial \\psi}{\\partial y}\\right)_{i,N} = U\n$$\n将此式以及 $\\omega_{i,N} = -(\\psi_{yy})_{i,N}$ 代入展开式，得到：\n$$\n(1) \\quad \\psi_{i,N-1} = \\psi_{i,N} - hU - \\frac{h^2}{2}\\omega_{i,N} - \\frac{h^3}{6}\\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\n$$\n(2) \\quad \\psi_{i,N-2} = \\psi_{i,N} - 2hU - 2h^2\\omega_{i,N} - \\frac{4h^3}{3}\\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\n我们寻求一个关于 $\\omega_{i,N}$ 的二阶精度表达式，这意味着其截断误差必须是 $O(h^2)$。为达到此目的，我们必须消去未知的三阶导数项 $(\\psi_{yyy})_{i,N}$。我们可以通过对方程 $(1)$ 和 $(2)$ 进行线性组合来实现。为了消去 $h^3$ 项，我们将方程 $(1)$ 乘以 $8$ 然后减去方程 $(2)$：\n$$\n8\\psi_{i,N-1} - \\psi_{i,N-2} = 8\\left(\\psi_{i,N} - hU - \\frac{h^2}{2}\\omega_{i,N}\\right) - \\left(\\psi_{i,N} - 2hU - 2h^2\\omega_{i,N}\\right) + O(h^4)\n$$\n$O(h^3)$ 项是 $8(-\\frac{h^3}{6}) - (-\\frac{8h^3}{6}) = 0$，因此如预期般被消去。现在，我们简化余下的表达式：\n$$\n8\\psi_{i,N-1} - \\psi_{i,N-2} = (8\\psi_{i,N} - \\psi_{i,N}) - (8hU - 2hU) - (4h^2\\omega_{i,N} - 2h^2\\omega_{i,N}) + O(h^4)\n$$\n$$\n8\\psi_{i,N-1} - \\psi_{i,N-2} = 7\\psi_{i,N} - 6hU - 2h^2\\omega_{i,N} + O(h^4)\n$$\n最后，我们求解 $\\omega_{i,N}$：\n$$\n2h^2\\omega_{i,N} = 7\\psi_{i,N} - 8\\psi_{i,N-1} + \\psi_{i,N-2} - 6hU + O(h^4)\n$$\n$$\n\\omega_{i,N} = \\frac{7\\psi_{i,N} - 8\\psi_{i,N-1} + \\psi_{i,N-2}}{2h^2} - \\frac{3U}{h} + O(h^2)\n$$\n这就得到了所需的壁面涡量 $\\omega_{i,N}$ 的二阶精度表达式。\n\n接下来，我们讨论所需的分析要点。\n\n- **一致性**：为了证明一致性，我们在一个流场中测试该公式，其中流向速度在壁面法向坐标上是线性的，$u(y) = A(y-H) + U$。这满足 $u(H)=U$。该速度剖面的涡量为 $\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y} = 0 - A = -A$。我们必须验证我们关于 $\\omega_{i,N}$ 的公式能得出这个精确值。\n首先，我们通过对 $u = \\partial\\psi/\\partial y$ 积分来找到对应的流函数：\n$\\psi(y) = \\int (A(y-H) + U) dy = \\frac{A}{2}(y-H)^2 + Uy + C$。\n我们在网格点上计算 $\\psi$ 的值：\n$\\psi_{i,N} = \\psi(H) = UH+C$。\n$\\psi_{i,N-1} = \\psi(H-h) = \\frac{A}{2}(-h)^2 + U(H-h) + C = \\psi_{i,N} + \\frac{A}{2}h^2 - Uh$。\n$\\psi_{i,N-2} = \\psi(H-2h) = \\frac{A}{2}(-2h)^2 + U(H-2h) + C = \\psi_{i,N} + 2Ah^2 - 2Uh$。\n将这些值代入我们推导的 $\\omega_{i,N}$ 公式中：\n$$\n\\omega_{i,N} = \\frac{7\\psi_{i,N} - 8(\\psi_{i,N} + \\frac{A}{2}h^2 - Uh) + (\\psi_{i,N} + 2Ah^2 - 2Uh)}{2h^2} - \\frac{3U}{h}\n$$\n包含 $\\psi_{i,N}$ 的项相消：$(7-8+1)\\psi_{i,N} = 0$。分子中余下的项是：\n$(-8)(\\frac{A}{2}h^2) + 2Ah^2 + (-8)(-Uh) - 2Uh = -4Ah^2 + 2Ah^2 + 8Uh - 2Uh = -2Ah^2 + 6Uh$。\n所以，\n$$\n\\omega_{i,N} = \\frac{-2Ah^2 + 6Uh}{2h^2} - \\frac{3U}{h} = -A + \\frac{3U}{h} - \\frac{3U}{h} = -A\n$$\n这与精确涡量 $\\omega = -A$ 相匹配。因此，对于具有局部线性速度剖面的流场，该边界条件是一致且精确的。\n\n- **稳定性**：对于涡量输运方程 $\\frac{D\\omega}{Dt} = \\nu \\nabla^2\\omega$，数值格式的稳定性与总拟涡能 $E = \\frac{1}{2}\\int \\omega^2 dA$ 的行为有关。$E$ 的时间演化由 $\\frac{dE}{dt} = \\nu \\oint_{\\partial \\Omega} \\omega \\frac{\\partial \\omega}{\\partial n} dS - \\nu \\int_\\Omega |\\nabla\\omega|^2 dA$ 给出。第一项代表边界上的拟涡能产生，而第二项代表内部的粘性耗散。如果边界条件引入了伪、非物理的拟涡能源，就可能出现数值不稳定性。在无滑移壁面上，涡量的物理生成与速度梯度直接相关，这由壁面上的运动学条件 $\\omega = -\\psi_{yy}$ 总结。$\\omega$ 的数值边界条件是对此物理联系的近似。一个一阶精度的条件具有 $O(h)$ 的截断误差，它充当了此阶数的人为拟涡能源/汇。如果这个人为项是一个源，它会向模拟中注入非物理能量，导致不稳定性。一个二阶精度的近似将此误差减小到 $O(h^2)$。通过更忠实地表示涡量生成的物理机制，它极大地减小了边界上伪拟涡能源的量级。这使得该格式与一阶格式相比更不易发生失稳，因为它更紧密地遵循了物理能量（拟涡能）平衡。\n\n- **近壁面影响**：壁面涡量条件的精度阶数对数值解的质量有深远的影响。\n    - **截断误差**：通过将精度阶数从一阶 $O(h)$ 提高到二阶 $O(h^2)$，计算出的壁面涡量误差随网格加密呈二次方减小，而不是线性减小。这使得用更少的网格点就能获得显著更准确的结果。\n    - **定性行为**：移动顶盖附近的流动特征是一个薄剪切层，具有非常高的涡量梯度。一个低阶边界条件会在计算出的近壁面涡量剖面中引入数值振荡（过冲/下冲），无法平滑地捕捉这些梯度。二阶条件为 $\\omega_{i,N}$ 提供了一个更准确的值，它为在内部求解的涡量输运方程提供了一个更好的狄利克雷（Dirichlet）条件。这导致了近壁面处更平滑、更符合物理实际的涡量场，减轻了低阶格式中常见的数值伪影。\n    - **剪切应力精度**：顶壁上的剪切应力为 $\\tau_w = \\mu (\\partial u / \\partial y)|_{y=H}$。在壁面上，我们有 $\\omega = \\partial v/\\partial x - \\partial u/\\partial y$。由于沿整个壁面 $v=0$，因此 $\\partial v/\\partial x = 0$，这给出 $\\omega|_{y=H} = -(\\partial u / \\partial y)|_{y=H}$。因此，壁面剪切应力与壁面涡量成正比：$\\tau_w = -\\mu \\omega_w$。计算出的剪切应力（一个具有重要工程意义的量）的精度因此完全由壁面涡量的精度决定。一个二阶精度的涡量边界条件产生二阶精度的剪切应力，相比于简单格式所提供的一阶精度，这是一个实质性的改进。", "answer": "$$ \\boxed{ \\frac{7\\psi_{i,N} - 8\\psi_{i,N-1} + \\psi_{i,N-2}}{2h^2} - \\frac{3U}{h} } $$", "id": "3340086"}, {"introduction": "实际工程问题往往涉及复杂的几何形状，难以用简单的正交笛卡尔网格进行有效剖分。这个编程实践直接应对了在非正交网格上进行模拟的挑战[@problem_id:3340097]。你将通过亲手实现发现，网格的倾斜会在离散算子中引入交叉导数项，而忽略这些项将破坏压力-速度耦合的内在一致性，导致无法精确满足不可压缩约束。", "problem": "考虑二维不可压缩顶盖驱动方腔流的无量纲形式，其中方腔边长 $L=1$ 且顶盖速度 $U=1$，因此所有物理量均为无量纲。其基础是具有恒定运动黏度的不可压缩 Navier–Stokes 方程、不可压缩性约束以及计算流体动力学（CFD）中使用的投影法，特别是速度场的 Helmholtz–Hodge 分解。\n\n从不可压缩性约束 $\\nabla \\cdot \\mathbf{u} = 0$ 和标准的投影法思想出发，其中一个暂估速度 $\\mathbf{u}^\\ast$ 通过压力场 $p$ 的梯度进行修正，以强制满足不可压缩性：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^\\ast - \\Delta t \\, \\nabla p,\n$$\n因此，压力 $p$ 通过求解泊松方程得到\n$$\n\\nabla^2 p = \\frac{1}{\\Delta t} \\, \\nabla \\cdot \\mathbf{u}^\\ast.\n$$\n为研究网格倾斜下的压力-速度耦合误差，考虑一个倾斜的非正交结构化网格，该网格通过从计算坐标 $(\\xi,\\eta) \\in [0,1]\\times[0,1]$ 到物理坐标 $(x,y)$ 的线性映射获得：\n$$\nx = \\xi + \\alpha \\, \\eta, \\quad y = \\eta,\n$$\n其中，倾斜参数 $\\alpha$ 与坐标线之间的网格倾斜角 $\\theta$（单位：度）通过以下关系相关联：\n$$\n\\alpha = \\cot \\theta.\n$$\n在此映射下，用计算坐标下的导数表示的物理微分算子为\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial}{\\partial \\xi}, \\quad \\frac{\\partial}{\\partial y} = -\\alpha \\frac{\\partial}{\\partial \\xi} + \\frac{\\partial}{\\partial \\eta},\n$$\n因此梯度和散度变为\n$$\n\\nabla p = \\begin{bmatrix} p_\\xi \\\\ -\\alpha \\, p_\\xi + p_\\eta \\end{bmatrix}, \\quad \\nabla \\cdot \\mathbf{u} = u_\\xi - \\alpha \\, v_\\xi + v_\\eta,\n$$\n拉普拉斯算子则包含交叉导数项，\n$$\n\\nabla^2 p = (1+\\alpha^2) \\, p_{\\xi\\xi} - 2 \\alpha \\, p_{\\xi\\eta} + p_{\\eta\\eta}.\n$$\n这些表达式表明，在傾斜網格（$\\alpha \\neq 0$）上忽略交叉导数项会破坏投影法中精确压力-速度耦合所需的散度算子和梯度算子之间的一致性。\n\n在计算坐标中，在一个 $N \\times N$ 的均匀网格上实现有限差分格式离散化，网格间距为 $h = \\frac{1}{N+1}$（仅考虑内部点，压力在物理边界上采用齐次狄利克雷边界条件 $p=0$，速度值在边界处补零）。使用二阶中心差分来近似 $p_\\xi$、$p_\\eta$、$p_{\\xi\\xi}$、$p_{\\eta\\eta}$ 和 $p_{\\xi\\eta}$：\n- $p_{\\xi\\xi} \\approx \\frac{p_{i+1,j} - 2 p_{i,j} + p_{i-1,j}}{h^2}$,\n- $p_{\\eta\\eta} \\approx \\frac{p_{i,j+1} - 2 p_{i,j} + p_{i,j-1}}{h^2}$,\n- $p_{\\xi\\eta} \\approx \\frac{p_{i+1,j+1} - p_{i+1,j-1} - p_{i-1,j+1} + p_{i-1,j-1}}{4 h^2}$,\n速度导数也类似处理。\n\n对于暂估速度，使用一个在计算坐标上定义的人工无量纲场：\n$$\nu^\\ast(\\xi,\\eta) = \\sin(\\pi \\xi)\\, \\sin(\\pi \\eta), \\quad v^\\ast(\\xi,\\eta) = \\sin(2\\pi \\xi)\\, \\sin(\\pi \\eta),\n$$\n通过上述散度关系，该速度场在物理坐标中产生非零散度。用两种方式求解压力泊松方程：\n1. 正交网格假设，忽略交叉导数项，即：\n$$\n\\nabla^2 p \\approx p_{\\xi\\xi} + p_{\\eta\\eta}.\n$$\n2. 正确的倾斜网格拉普拉斯算子，包含交叉导数项，即：\n$$\n\\nabla^2 p \\approx (1+\\alpha^2) \\, p_{\\xi\\xi} - 2 \\alpha \\, p_{\\xi\\eta} + p_{\\eta\\eta}.\n$$\n在两种情况下，都将方程右端项设为 $\\frac{1}{\\Delta t}\\, \\nabla \\cdot \\mathbf{u}^\\ast$，并使用正确的倾斜散度 $u_\\xi - \\alpha v_\\xi + v_\\eta$ 计算。\n\n得到 $p$ 后，计算修正后的速度\n$$\nu = u^\\ast - \\Delta t \\, p_\\xi, \\quad v = v^\\ast - \\Delta t \\, (-\\alpha p_\\xi + p_\\eta),\n$$\n然后测量物理坐标下的残余散度，\n$$\n\\varepsilon = \\left\\| u_\\xi - \\alpha v_\\xi + v_\\eta \\right\\|_{L^2},\n$$\n在网格上近似为\n$$\n\\varepsilon \\approx \\sqrt{ h^2 \\sum_{i,j} \\left( u_\\xi - \\alpha v_\\xi + v_\\eta \\right)_{i,j}^2 }.\n$$\n\n角度单位说明：$\\theta$ 必须以度为单位提供。所有量均为无量纲；将残余散度 $\\varepsilon$ 报告为无量纲浮点数。\n\n你的程序必须为两个泊松算子构建稀疏矩阵，在两种情况下求解 $p$，修正速度，并计算残余散度范数。使用固定时间步长 $\\Delta t = 10^{-2}$。\n\n测试组：\n- 案例 A（理想情况，正交网格）：$N=20$, $\\theta=90$。\n- 案例 B（轻度倾斜）：$N=20$, $\\theta=80$。\n- 案例 C（中度傾斜）：$N=20$, $\\theta=60$。\n- 案例 D（强倾斜）：$N=20$, $\\theta=45$。\n- 案例 E（严重倾斜且分辨率降低，边界敏感性）：$N=12$, $\\theta=30$。\n\n对于每个测试案例，计算两个浮点数：使用正交网格泊松算子得到的残余散度范数 $\\varepsilon_{\\text{naive}}$ 和使用倾斜网格泊松算子得到的残余散度范数 $\\varepsilon_{\\text{correct}}$。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试案例产生一个包含两个元素的列表 $[\\varepsilon_{\\text{naive}}, \\varepsilon_{\\text{correct}}]$。例如，输出格式必须为\n$[ [e_{A,\\text{naive}},e_{A,\\text{correct}}], [e_{B,\\text{naive}},e_{B,\\text{correct}}], \\dots ]$。", "solution": "本问题旨在设计一个计算流体动力学（CFD）领域的数值实验，以展示在非正交网格上，为保证几何守恒律和数值解的精度，采用一致离散化的重要性。\n\n该实验的核心是在投影法的框架内，比较两种不同离散化方法对压力泊松方程求解的影响，并量化其对最终速度场不可压缩性约束的满足程度。一种是忽略网格倾斜的“朴素”离散，另一种是包含所有几何项的“正确”离散。\n\n求解方法如下：\n\n1.  **网格与坐标系**：通过从计算域 $(\\xi,\\eta) \\in [0,1]\\times[0,1]$ 中的均匀笛卡尔网格进行线性变换，定义了二维物理域 $(x,y)$ 中的一个结构化网格。该变换由 $x = \\xi + \\alpha \\eta$ 和 $y = \\eta$ 给出，其中 $\\alpha = \\cot(\\theta)$ 是从网格角 $\\theta$ 导出的倾斜参数。计算网格由 $N \\times N$ 个内部点组成，间距为 $h = 1/(N+1)$。包含边界在内的总网格大小为 $(N+2)\\times(N+2)$。\n\n2.  **控制方程与离散化**：不可压缩流投影法的核心是求解压力泊松方程 $\\nabla^2 p = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^\\ast$。所有微分算子（$\\nabla \\cdot$、$\\nabla$、$\\nabla^2$）都被转换到计算坐标系 $(\\xi, \\eta)$ 中。问题要求使用二阶中心差分来离散化所有空间导数。\n\n3.  **人工构造的暂估速度**：在计算网格上解析地定义一个暂估速度场 $\\mathbf{u}^\\ast = (u^\\ast, v^\\ast)$：$u^\\ast(\\xi,\\eta) = \\sin(\\pi \\xi) \\sin(\\pi \\eta)$ 和 $v^\\ast(\\xi,\\eta) = \\sin(2\\pi \\xi) \\sin(\\pi \\eta)$。在倾斜网格上，该场在物理坐标中不是无散度的。\n\n4.  **右端项（RHS）构建**：计算泊松方程的右端项 $S = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^\\ast$。在倾斜坐标系中，散度算子为 $\\nabla \\cdot \\mathbf{u}^\\ast = \\frac{\\partial u^\\ast}{\\partial \\xi} - \\alpha \\frac{\\partial v^\\ast}{\\partial \\xi} + \\frac{\\partial v^\\ast}{\\partial \\eta}$。使用中心差分在内部网格点上计算导数 $\\frac{\\partial u^\\ast}{\\partial \\xi}$、$\\frac{\\partial v^\\ast}{\\partial \\xi}$ 和 $\\frac{\\partial v^\\ast}{\\partial \\eta}$。将得到的 $N \\times N$ 右端项值矩阵展平为一个大小为 $N^2 \\times 1$ 的向量 $\\mathbf{b}$。\n\n5.  **压力泊松矩阵组装**：压力泊松方程是一个线性系统 $\\mathbf{A} \\mathbf{p} = \\mathbf{b}$，其中 $\\mathbf{p}$ 是 $N^2$ 个内部点上未知压力值的向量。构建两个不同的系统矩阵 $\\mathbf{A}_{\\text{naive}}$ 和 $\\mathbf{A}_{\\text{correct}}$ 作为稀疏矩阵。\n    *   **朴素算子**：$\\mathbf{A}_{\\text{naive}}$ 对应于 $\\nabla^2 p \\approx \\frac{\\partial^2 p}{\\partial \\xi^2} + \\frac{\\partial^2 p}{\\partial \\eta^2}$ 的离散化。这会产生一个标准的拉普拉斯算子 5 点模板。\n    *   **正确算子**：$\\mathbf{A}_{\\text{correct}}$ 对应于完整的倾斜拉普拉斯算子 $\\nabla^2 p = (1+\\alpha^2)\\frac{\\partial^2 p}{\\partial \\xi^2} - 2\\alpha \\frac{\\partial^2 p}{\\partial \\xi \\partial \\eta} + \\frac{\\partial^2 p}{\\partial \\eta^2}$。离散化该算子会产生一个能正确处理网格倾斜的 9 点模板。\n\n6.  **求解压力**：求解两个线性系统 $\\mathbf{A}_{\\text{naive}} \\mathbf{p}_{\\text{naive}} = \\mathbf{b}$ 和 $\\mathbf{A}_{\\text{correct}} \\mathbf{p}_{\\text{correct}} = \\mathbf{b}$，分别获得朴素情况和正确情况下的压力场。将得到的解向量重塑为 $N \\times N$ 数组，并补零以表示 $(N+2)\\times(N+2)$ 网格上的齐次狄利克雷边界条件（$p=0$）。\n\n7.  **速度修正**：使用压力梯度修正速度场：$\\mathbf{u} = \\mathbf{u}^\\ast - \\Delta t \\nabla p$。在计算坐标系中，分量形式的修正是 $u = u^\\ast - \\Delta t \\frac{\\partial p}{\\partial \\xi}$ 和 $v = v^\\ast - \\Delta t (-\\alpha \\frac{\\partial p}{\\partial \\xi} + \\frac{\\partial p}{\\partial \\eta})$。对 $p_{\\text{naive}}$ 和 $p_{\\text{correct}}$ 都执行此步骤，以获得两个新的速度场 $\\mathbf{u}_{\\text{naive}}$ 和 $\\mathbf{u}_{\\text{correct}}$。压力导数使用中心差分计算。\n\n8.  **残余散度计算**：最后一步是通过计算修正后速度场散度的 $L^2$ 范数来衡量不可compressibility误差。残余散度由 $\\varepsilon = \\| \\nabla \\cdot \\mathbf{u} \\|_{L_2} \\approx \\sqrt{ h^2 \\sum_{i,j} (\\frac{\\partial u}{\\partial \\xi} - \\alpha \\frac{\\partial v}{\\partial \\xi} + \\frac{\\partial v}{\\partial \\eta})_{i,j}^2 }$ 给出。对 $\\mathbf{u}_{\\text{naive}}$ 和 $\\mathbf{u}_{\\text{correct}}$ 都计算此范数。\n\n当梯度、散度和拉普拉斯算子的离散算子被一致地定义时（如“正确”公式所示），修正后速度场的离散散度预计将达到机器精度级别的零。“朴素”公式在倾斜网格上破坏了这种一致性，导致显著的非零残余散度，其值随网格倾斜度（$\\alpha$）的增加而增加。对于正交网格（$\\theta=90^\\circ$, $\\alpha=0$），两种公式是相同的，应该产生相同的微小残差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef calculate_residual(p, u_star, v_star, N, h, dt, alpha):\n    \"\"\"\n    Computes the residual divergence norm for a given pressure solution.\n\n    Args:\n        p (np.ndarray): The (N+2)x(N+2) pressure field with zero boundaries.\n        u_star (np.ndarray): The (N+2)x(N+2) tentative u-velocity field.\n        v_star (np.ndarray): The (N+2)x(N+2) tentative v-velocity field.\n        N (int): Number of interior grid points in one dimension.\n        h (float): Grid spacing in computational coordinates.\n        dt (float): Time step.\n        alpha (float): Grid skewness parameter.\n\n    Returns:\n        float: The L2-norm of the residual divergence.\n    \"\"\"\n    # Pressure gradients on the N x N interior grid.\n    # 'xy' indexing is used: i for columns (xi), j for rows (eta).\n    p_xi = (p[1:-1, 2:] - p[1:-1, :-2]) / (2 * h)\n    p_eta = (p[2:, 1:-1] - p[:-2, 1:-1]) / (2 * h)\n\n    # Correct the velocity on the N x N interior grid.\n    u_corr = u_star[1:-1, 1:-1] - dt * p_xi\n    v_corr = v_star[1:-1, 1:-1] - dt * (-alpha * p_xi + p_eta)\n\n    # Pad corrected velocity with zeros to create (N+2)x(N+2) fields for derivative calculation.\n    u_final = np.zeros((N + 2, N + 2))\n    v_final = np.zeros((N + 2, N + 2))\n    u_final[1:-1, 1:-1] = u_corr\n    v_final[1:-1, 1:-1] = v_corr\n    \n    # Calculate derivatives of the final corrected velocity on the N x N interior grid.\n    u_final_xi = (u_final[1:-1, 2:] - u_final[1:-1, :-2]) / (2 * h)\n    v_final_xi = (v_final[1:-1, 2:] - v_final[1:-1, :-2]) / (2 * h)\n    v_final_eta = (v_final[2:, 1:-1] - v_final[:-2, 1:-1]) / (2 * h)\n\n    # Residual divergence on the N x N interior grid.\n    res_div = u_final_xi - alpha * v_final_xi + v_final_eta\n    \n    # L2 Norm of the residual divergence.\n    epsilon = np.sqrt(h**2 * np.sum(res_div**2))\n    return epsilon\n\ndef solve_case(N, theta):\n    \"\"\"\n    Solves the problem for a single test case specified by N and theta.\n    \n    Args:\n        N (int): Number of interior grid points in one dimension.\n        theta (float): Grid skew angle in degrees.\n        \n    Returns:\n        list: A two-element list containing [epsilon_naive, epsilon_correct].\n    \"\"\"\n    # 1. Parameters\n    dt = 1e-2\n    h = 1.0 / (N + 1)\n    if theta == 90.0:\n        alpha = 0.0\n    else:\n        alpha = 1.0 / np.tan(np.deg2rad(theta))\n\n    # 2. Grid and Tentative Velocity Field\n    coords = np.linspace(0, 1, N + 2)\n    xi, eta = np.meshgrid(coords, coords, indexing='xy')\n\n    u_star = np.sin(np.pi * xi) * np.sin(np.pi * eta)\n    v_star = np.sin(2 * np.pi * xi) * np.sin(np.pi * eta)\n\n    # 3. Right-Hand Side (RHS) of the Poisson Equation\n    u_star_xi = (u_star[1:-1, 2:] - u_star[1:-1, :-2]) / (2 * h)\n    v_star_xi = (v_star[1:-1, 2:] - v_star[1:-1, :-2]) / (2 * h)\n    v_star_eta = (v_star[2:, 1:-1] - v_star[:-2, 1:-1]) / (2 * h)\n\n    div_u_star = u_star_xi - alpha * v_star_xi + v_star_eta\n    rhs = (1 / dt) * div_u_star\n    b = rhs.flatten()  # Row-major flattening: (j,i) -> k = j*N+i\n\n    # 4. Assemble Sparse Matrices for Poisson Solvers\n    num_unknowns = N * N\n    A_naive = lil_matrix((num_unknowns, num_unknowns))\n    A_correct = lil_matrix((num_unknowns, num_unknowns))\n    \n    h2 = h**2\n    \n    for j in range(N):  # row index 0 to N-1\n        for i in range(N):  # col index 0 to N-1\n            k = j * N + i  # 1D index, row-major\n            \n            # Case 1: Naive (Orthogonal) Laplacian (5-point stencil)\n            A_naive[k, k] = -4.0 / h2\n            if i > 0:   A_naive[k, k - 1] = 1.0 / h2\n            if i  N - 1: A_naive[k, k + 1] = 1.0 / h2\n            if j > 0:   A_naive[k, k - N] = 1.0 / h2\n            if j  N - 1: A_naive[k, k + N] = 1.0 / h2\n\n            # Case 2: Correct Skewed Laplacian (9-point stencil)\n            A_correct[k, k] = (1 + alpha**2) * (-2.0 / h2) + (-2.0 / h2)\n            if i > 0:   A_correct[k, k - 1] = (1 + alpha**2) / h2\n            if i  N - 1: A_correct[k, k + 1] = (1 + alpha**2) / h2\n            if j > 0:   A_correct[k, k - N] = 1.0 / h2\n            if j  N - 1: A_correct[k, k + N] = 1.0 / h2\n            \n            coeff_xieta = -2.0 * alpha / (4.0 * h2)\n            if j  N - 1 and i  N - 1: A_correct[k, k + N + 1] += coeff_xieta\n            if j > 0 and i  N - 1:     A_correct[k, k - N + 1] -= coeff_xieta\n            if j  N - 1 and i > 0:     A_correct[k, k + N - 1] -= coeff_xieta\n            if j > 0 and i > 0:         A_correct[k, k - N - 1] += coeff_xieta\n    \n    # 5. Solve the Linear Systems for Pressure\n    A_naive_csr = A_naive.tocsr()\n    A_correct_csr = A_correct.tocsr()\n\n    p_naive_vec = spsolve(A_naive_csr, b)\n    p_correct_vec = spsolve(A_correct_csr, b)\n    \n    p_naive_int = p_naive_vec.reshape((N, N))\n    p_correct_int = p_correct_vec.reshape((N, N))\n\n    p_naive = np.zeros((N + 2, N + 2))\n    p_correct = np.zeros((N + 2, N + 2))\n    p_naive[1:-1, 1:-1] = p_naive_int\n    p_correct[1:-1, 1:-1] = p_correct_int\n\n    # 6. Calculate Final Residual Divergence Norms\n    eps_naive = calculate_residual(p_naive, u_star, v_star, N, h, dt, alpha)\n    eps_correct = calculate_residual(p_correct, u_star, v_star, N, h, dt, alpha)\n    \n    return [eps_naive, eps_correct]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (20, 90.0),\n        (20, 80.0),\n        (20, 60.0),\n        (20, 45.0),\n        (12, 30.0),\n    ]\n\n    results = []\n    for N, theta in test_cases:\n        result = solve_case(N, theta)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3340097"}]}