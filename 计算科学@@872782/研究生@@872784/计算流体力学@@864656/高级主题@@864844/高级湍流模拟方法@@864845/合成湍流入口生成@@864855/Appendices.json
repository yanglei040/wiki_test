{"hands_on_practices": [{"introduction": "生成合成湍流最直接的方法是创建与目标流场统计特性相匹配的脉动，例如来自雷诺平均纳维-斯托克斯（RANS）模拟的雷诺应力张量。本练习将指导您使用乔列斯基分解（Cholesky decomposition）这一强大的技术来完成这一基本过程，该技术用于生成相关的随机变量[@problem_id:3369516]。您将实现此方法，并评估生成的入流条件在多大程度上有助于后续的大涡模拟（LES）快速适应正确的近壁湍流结构。", "problem": "给定一个由雷诺平均纳维-斯托克斯 (RANS) 解得到的雷诺应力张量的壁面法向剖面，记为 $R_{ij}(y)$，其中 $y$ 是壁面法向坐标。目标是使用基于 Cholesky 分解的协方差映射，合成与 $R_{ij}(y)$ 一致的湍流入口脉动，然后应用一个简化的弛豫模型来评估大涡模拟 (LES) 的入口是否能在无需很长流向发展长度的情况下，快速恢复正确的近壁面各向异性。该问题必须以无量纲形式处理。\n\n定义与基本原理：\n- 雷诺平均纳维-斯托克斯 (RANS) 是一个统计框架，其中脉动速度 $u'_i$ 的均值为零，协方差为 $R_{ij}(y) = \\langle u'_i u'_j \\rangle$，对于物理上可实现的湍流状态，该协方差是半正定的。\n- 大涡模拟 (LES) 是一种数值方法，它解析大尺度的湍流运动，同时对亚格子尺度进行建模。\n- 一个对称正定矩阵 $R(y)$ 的 Cholesky 分解是指一个下三角矩阵 $L(y)$，满足 $R(y) = L(y) L(y)^{\\top}$。如果 $\\boldsymbol{\\xi}$ 是一个协方差等于单位矩阵的标准正态随机向量，那么根据期望的线性性质和高斯随机变量的特性，$\\mathbf{u}'(y) = L(y)\\boldsymbol{\\xi}$ 的协方差为 $R(y)$。\n- 湍动能为 $k(y) = \\tfrac{1}{2} \\operatorname{tr}(R(y))$。\n- 各向异性张量为 $b_{ij}(y) = \\dfrac{R_{ij}(y)}{2 k(y)} - \\dfrac{1}{3} \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克符号 (Kronecker delta)，并且根据构造 $b_{ij}$ 是无迹的。\n\n您必须设计一个程序，纯粹以数学术语执行以下步骤：\n1. 对每个测试用例，定义一个无量纲的域高 $H$、一个均匀的平流速度 $U$、一个近壁区域 $\\{ y/H \\leq \\alpha \\}$（其中 $\\alpha$ 在下面指定）、一个弛豫时间尺度 $T(y)$，以及用于合成采样的实现大小 $M$。\n2. 使用提供的类 RANS 剖面，在一组离散的 $y$ 位置上构造 $R_{ij}(y)$。确保协方差矩阵在数值上是可分解的。如果给定的 $R(y)$ 不是严格正定的，则应用一个最小的对角正则化 $R(y) \\leftarrow R(y) + \\varepsilon I$，其中 $\\varepsilon > 0$ 选择得尽可能小以允许 Cholesky 分解，而 $I$ 是单位矩阵。\n3. 通过抽取 $M$ 个独立的 $\\boldsymbol{\\xi} \\sim \\mathcal{N}(\\mathbf{0}, I)$ 实现，并映射 $\\mathbf{u}'(y) = L(y)\\boldsymbol{\\xi}$，在每个 $y$ 处生成合成入口样本。从合成实现中估计样本协方差 $S(y)$，并从 $S(y)$ 计算合成的各向异性 $b^{\\text{init}}(y)$。\n4. 假设在近壁区域内的每个 $y$ 处，各向异性误差遵循一个局部的线性弛豫模型：\n   $$ \\frac{d}{dt}\\left( b_{ij}(y,t) - b^{\\text{target}}_{ij}(y) \\right) = -\\frac{1}{T(y)} \\left( b_{ij}(y,t) - b^{\\text{target}}_{ij}(y) \\right), $$\n   其初始条件为 $b_{ij}(y,0) = b^{\\text{init}}_{ij}(y)$，目标各向异性 $b^{\\text{target}}_{ij}(y)$ 从 $R_{ij}(y)$ 计算得出。根据泰勒冻结湍流假设 (Taylor’s frozen turbulence hypothesis)，流向发展长度为 $x = U t$。\n5. 将位置 $y$ 处的近壁各向异性误差范数定义为差值的弗罗贝尼乌斯范数 (Frobenius norm) $e(y,t) = \\left\\| b(y,t) - b^{\\text{target}}(y) \\right\\|_{F}$，并将近壁阈值设为 $\\epsilon_{b}$。对于上述弛豫模型，解为 $b(y,t) - b^{\\text{target}}(y) = \\left( b^{\\text{init}}(y) - b^{\\text{target}}(y) \\right) \\exp\\left( -\\dfrac{t}{T(y)} \\right)$，所以\n   $$ e(y,t) = e(y,0) \\exp\\left( -\\frac{t}{T(y)} \\right), \\quad e(y,0) = \\left\\| b^{\\text{init}}(y) - b^{\\text{target}}(y) \\right\\|_{F}. $$\n   令 $t_{\\text{rec}}$ 为满足近壁区域中所有 $y$ 都有 $e(y,t_{\\text{rec}}) \\leq \\epsilon_{b}$ 的最小时间。则\n   $$ t_{\\text{rec}} = \\max_{y \\in \\text{near-wall}} \\left\\{ T(y) \\max\\left( 0, \\ln\\left( \\frac{e(y,0)}{\\epsilon_{b}} \\right) \\right) \\right\\}. $$\n   相应的无量纲流向发展长度为 $\\dfrac{x_{\\text{rec}}}{H} = \\dfrac{U \\, t_{\\text{rec}}}{H}$。\n6. 如果 $\\dfrac{x_{\\text{rec}}}{H} \\leq L_{\\text{thr}}$，则认为一个测试“快速恢复”了正确的近壁各向异性，其中 $L_{\\text{thr}}$ 是一个指定的无量纲阈值。\n\n您的程序必须实现上述规范，并生成单行输出，其中包含一个用方括号括起来的逗号分隔的布尔值列表，精确地以 $[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3}]$ 的格式指示每个测试用例是否满足“快速恢复”的标准。\n\n使用以下测试套件。在所有情况下，将 $y$ 在 $[0,H]$ 上离散为 $N = 41$ 个均匀分布的点，并通过 $y/H \\leq \\alpha$ 定义近壁区域，其中 $\\alpha = 0.1$。所有量均为无量纲，且不出现角度。任何地方均不使用百分比。\n\n测试用例 1（近壁面各向异性，中等恢复速度）：\n- $H = 1.0$, $U = 1.0$, $M = 200$, $\\epsilon_{b} = 0.03$, $L_{\\text{thr}} = 0.5$。\n- 湍动能：$k(y) = k_{\\min} + 0.25\\left(1 - e^{-7 y}\\right)$，其中 $k_{\\min} = 10^{-4}$。\n- 定义 $R(y)$ 的对角分数：$f_{x}(y) = \\tfrac{1}{3} + 0.18 e^{-y/0.05}$，$f_{y}(y) = \\tfrac{1}{3} - 0.04 e^{-y/0.05}$，$f_{z}(y) = 1 - f_{x}(y) - f_{y}(y)$。\n- 雷诺应力张量：$R(y) = \\operatorname{diag}\\left( 2 k(y) f_{x}(y), 2 k(y) f_{y}(y), 2 k(y) f_{z}(y) \\right)$。\n- 弛豫时间尺度：$T(y) = 0.05 + 0.15 \\sqrt{y}$。\n\n测试用例 2（各向同性目标，快速恢复）：\n- $H = 1.0$, $U = 1.0$, $M = 200$, $\\epsilon_{b} = 0.03$, $L_{\\text{thr}} = 0.5$。\n- 湍动能：$k(y) = k_{\\min} + 0.25\\left(1 - e^{-3 y}\\right)$，其中 $k_{\\min} = 10^{-4}$。\n- 各向同性分数：$f_{x}(y) = f_{y}(y) = f_{z}(y) = \\tfrac{1}{3}$。\n- 雷诺应力张量：$R(y) = \\operatorname{diag}\\left( 2 k(y) f_{x}(y), 2 k(y) f_{y}(y), 2 k(y) f_{z}(y) \\right)$。\n- 弛豫时间尺度：$T(y) = 0.02 + 0.05 y$。\n\n测试用例 3（近壁面能量近奇异，恢复缓慢）：\n- $H = 1.0$, $U = 2.0$, $M = 200$, $\\epsilon_{b} = 0.03$, $L_{\\text{thr}} = 0.5$。\n- 湍动能：$k(y) = 10^{-6} + 0.02 y$。\n- 近壁面强各向异性：$f_{x}(y) = \\tfrac{1}{3} + 0.32 e^{-y/0.02}$，$f_{y}(y) = \\tfrac{1}{3} - 0.23 e^{-y/0.02}$，$f_{z}(y) = 1 - f_{x}(y) - f_{y}(y)$。\n- 雷诺应力张量：$R(y) = \\operatorname{diag}\\left( 2 k(y) f_{x}(y), 2 k(y) f_{y}(y), 2 k(y) f_{z}(y) \\right)$。\n- 弛豫时间尺度：$T(y) = 2.0 + y$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，$[ \\text{result}_{1}, \\text{result}_{2}, \\text{result}_{3} ]$），其中每个 $\\text{result}_{i}$ 是 $\\text{True}$ 或 $\\text{False}$，取决于相应测试用例是否满足 $\\dfrac{x_{\\text{rec}}}{H} \\leq L_{\\text{thr}}$。", "solution": "该问题被认为是有效的，因为它科学地基于计算流体力学和湍流模拟的原理，其定义和参数完整清晰，问题陈述适定，且其表述是客观的。所规定的方法是评估用于大涡模拟 (LES) 的合成湍流入口条件质量的标准（尽管是简化的）数值程序。\n\n求解过程通过实现指定的多步算法来进行。对于每个测试用例，我们将：\n1. 定义物理和数值参数，并对空间域进行离散化。\n2. 在每个离散的壁面法向位置 $y$ 处，构造目标雷诺应力张量 $R_{ij}(y)$。\n3. 生成一个有限的合成速度脉动系综，并计算样本协方差矩阵 $S(y)$。\n4. 计算目标各向异性张量 $b^{\\text{target}}(y)$ 和合成场的初始各向异性张量 $b^{\\text{init}}(y)$。\n5. 确定各向异性张量的初始误差 $e(y,0)$，并使用提供的弛豫模型计算恢复时间 $t_{\\text{rec}}$ 和相应的流向发展长度 $x_{\\text{rec}}$。\n6. 将恢复长度与阈值进行比较，以确定恢复是否足够迅速。\n\n高度为 $H$ 的壁面法向域被离散为 $N=41$ 个均匀分布的点，$y_j = j \\cdot H / (N-1)$，其中 $j=0, 1, \\dots, N-1$。\n\n对于每个测试用例和每个点 $y_j$，构造一个目标雷诺应力张量 $R(y_j)$。问题指定 $R(y_j)$ 为一个对角矩阵，\n$$\nR(y_j) = \\operatorname{diag}\\left( 2 k(y_j) f_{x}(y_j), 2 k(y_j) f_{y}(y_j), 2 k(y_j) f_{z}(y_j) \\right)\n$$\n其中 $k(y)$ 是湍动能，$f_x(y), f_y(y), f_z(y)$ 是总和为 $1$ 的分数分量。这种构造确保了与湍动能定义 $k(y) = \\frac{1}{2}\\operatorname{tr}(R(y))$ 的一致性。分量 $R_{ii}(y)$ 是方差，必须为非负。所提供的 $k(y)$ 和 $f_i(y)$ 函数确保了这一点，使得 $R(y)$ 是一个正定矩阵。\n\n为了生成合成的湍流脉动，我们使用基于 Cholesky 分解的协方差映射方法。对于每个目标协方差矩阵 $R(y_j)$，我们找到其 Cholesky 分解，即一个下三角矩阵 $L(y_j)$，满足 $R(y_j) = L(y_j) L(y_j)^{\\top}$。由于 $R(y_j)$ 是对角的，因此 $L(y_j)$ 也是对角的，其元素是 $R(y_j)$ 对角元素的平方根。然后，我们生成一个 3 维随机向量 $\\boldsymbol{\\xi}_k \\sim \\mathcal{N}(\\mathbf{0}, I)$ 的 $M$ 个样本，其中 $I$ 是 $3 \\times 3$ 的单位矩阵。合成的速度脉动由下式给出：\n$$\n\\mathbf{u}'_k(y_j) = L(y_j) \\boldsymbol{\\xi}_k, \\quad k=1, \\dots, M.\n$$\n根据构造，这些样本协方差的期望值为 $E[\\mathbf{u}' (\\mathbf{u}')^\\top] = L E[\\boldsymbol{\\xi} \\boldsymbol{\\xi}^\\top] L^\\top = L I L^\\top = R(y_j)$。\n\n由于样本量 $M$ 有限，从 $M$ 个实现中计算出的样本协方差矩阵 $S(y_j)$ 将与目标 $R(y_j)$ 不同。样本协方差估计为\n$$\nS(y_j) = \\frac{1}{M} \\sum_{k=1}^{M} \\mathbf{u}'_k(y_j) \\left(\\mathbf{u}'_k(y_j)\\right)^{\\top}.\n$$\n$S(y_j)$ 和 $R(y_j)$ 之间的这种统计差异是入口条件中初始误差的来源。\n\n各向异性状态由各向异性张量 $b_{ij} = \\frac{R_{ij}}{2k} - \\frac{1}{3}\\delta_{ij}$ 来量化。我们从 $R(y_j)$ 计算目标各向异性 $b^{\\text{target}}(y_j)$，并从 $S(y_j)$ 计算合成场的初始各向异性 $b^{\\text{init}}(y_j)$。每个位置 $y_j$ 的初始误差是它们差值的弗罗贝尼乌斯范数：\n$$\ne(y_j, 0) = \\left\\| b^{\\text{init}}(y_j) - b^{\\text{target}}(y_j) \\right\\|_{F}.\n$$\n由于采样效应，此误差不为零。为了使该误差有明确定义，样本湍动能 $k_{\\text{sample}}(y_j) = \\frac{1}{2}\\operatorname{tr}(S(y_j))$ 必须不为零，这在实践中是有保证的。\n\n该问题为该误差在下游的演化设定了一个线性弛豫模型。在点 $y_j$ 处，误差衰减到容差 $\\epsilon_b$ 所需的时间为 $T(y_j) \\ln(e(y_j,0)/\\epsilon_b)$，前提是 $e(y_j,0) > \\epsilon_b$。总恢复时间 $t_{\\text{rec}}$ 是在近壁区域（由 $y_j/H \\le \\alpha$ 定义）内所有点 $y_j$ 所需的最大时间。这表示为：\n$$\nt_{\\text{rec}} = \\max_{y_j/H \\le \\alpha} \\left\\{ T(y_j) \\max\\left( 0, \\ln\\left( \\frac{e(y_j,0)}{\\epsilon_{b}} \\right) \\right) \\right\\}.\n$$\n使用 $\\max(0, \\cdot)$ 可以正确地将那些初始误差已经低于阈值的点的恢复时间设置为0。\n\n最后，应用泰勒冻结湍流假设 (Taylor's frozen turbulence hypothesis)，恢复所需的流向发展长度为 $x_{\\text{rec}} = U t_{\\text{rec}}$。无量纲长度为 $\\frac{x_{\\text{rec}}}{H}$。如果此长度不大于指定的阈值 $L_{\\text{thr}}$，则该测试用例被归类为“快速恢复”：\n$$\n\\frac{U t_{\\text{rec}}}{H} \\le L_{\\text{thr}}.\n$$\n将此程序应用于三个测试用例中的每一个，以得出布尔结果。为了可复现性，为随机数生成器使用了一个固定的种子。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n    \n    # Define test cases as a list of dictionaries.\n    test_cases = [\n        {\n            \"name\": \"Test case 1\",\n            \"H\": 1.0, \"U\": 1.0, \"M\": 200, \"epsilon_b\": 0.03, \"L_thr\": 0.5,\n            \"k_func\": lambda y: 1e-4 + 0.25 * (1 - np.exp(-7 * y)),\n            \"fx_func\": lambda y: 1/3 + 0.18 * np.exp(-y / 0.05),\n            \"fy_func\": lambda y: 1/3 - 0.04 * np.exp(-y / 0.05),\n            \"T_func\": lambda y: 0.05 + 0.15 * np.sqrt(y)\n        },\n        {\n            \"name\": \"Test case 2\",\n            \"H\": 1.0, \"U\": 1.0, \"M\": 200, \"epsilon_b\": 0.03, \"L_thr\": 0.5,\n            \"k_func\": lambda y: 1e-4 + 0.25 * (1 - np.exp(-3 * y)),\n            \"fx_func\": lambda y: 1/3,\n            \"fy_func\": lambda y: 1/3,\n            \"T_func\": lambda y: 0.02 + 0.05 * y\n        },\n        {\n            \"name\": \"Test case 3\",\n            \"H\": 1.0, \"U\": 2.0, \"M\": 200, \"epsilon_b\": 0.03, \"L_thr\": 0.5,\n            \"k_func\": lambda y: 1e-6 + 0.02 * y,\n            \"fx_func\": lambda y: 1/3 + 0.32 * np.exp(-y / 0.02),\n            \"fy_func\": lambda y: 1/3 - 0.23 * np.exp(-y / 0.02),\n            \"T_func\": lambda y: 2.0 + y\n        }\n    ]\n\n    # Common parameters\n    N = 41\n    alpha = 0.1\n    # Regularization epsilon, as suggested by the problem, though not strictly needed for these cases.\n    reg_eps = 1e-12 \n    # Initialize random number generator for reproducibility\n    rng = np.random.default_rng(seed=42)\n\n    results = []\n\n    for case in test_cases:\n        H = case[\"H\"]\n        U = case[\"U\"]\n        M = case[\"M\"]\n        epsilon_b = case[\"epsilon_b\"]\n        L_thr = case[\"L_thr\"]\n        k_func = case[\"k_func\"]\n        fx_func = case[\"fx_func\"]\n        fy_func = case[\"fy_func\"]\n        T_func = case[\"T_func\"]\n        \n        # 1. Discretize domain\n        y = np.linspace(0, H, N)\n        \n        # Identify near-wall indices\n        near_wall_indices = np.where(y / H = alpha)[0]\n        \n        initial_errors = np.zeros(N)\n        \n        for j, y_j in enumerate(y):\n            # 2. Construct target Reynolds stress tensor R(y)\n            k_j = k_func(y_j)\n            fx_j = fx_func(y_j)\n            fy_j = fy_func(y_j)\n            fz_j = 1 - fx_j - fy_j\n\n            R_target_diag = 2 * k_j * np.array([fx_j, fy_j, fz_j])\n            R_target = np.diag(R_target_diag)\n            \n            # Apply regularization\n            R_target += reg_eps * np.identity(3)\n            \n            # 3. Generate synthetic fluctuations\n            L = np.linalg.cholesky(R_target)\n            xi_samples = rng.standard_normal(size=(M, 3))\n            u_prime_samples = (L @ xi_samples.T).T\n            \n            # Estimate sample covariance S(y)\n            S = (u_prime_samples.T @ u_prime_samples) / M\n            \n            # 4. Compute anisotropy tensors and initial error\n            k_target = 0.5 * np.trace(R_target)\n            b_target = R_target / (2 * k_target) - (1/3) * np.identity(3)\n            \n            k_sample = 0.5 * np.trace(S)\n            if k_sample  1e-12: # Avoid division by zero\n                b_init = np.zeros((3, 3))\n            else:\n                b_init = S / (2 * k_sample) - (1/3) * np.identity(3)\n            \n            # Calculate initial error norm\n            e0 = np.linalg.norm(b_init - b_target, 'fro')\n            initial_errors[j] = e0\n            \n        # 5. Compute recovery time and length\n        e0_nw = initial_errors[near_wall_indices]\n        y_nw = y[near_wall_indices]\n        T_nw = T_func(y_nw)\n        \n        # Calculate recovery time for each point in the near-wall region\n        # Use np.divide to handle e0_nw/epsilon_b without log(0) warnings\n        ratio = np.divide(e0_nw, epsilon_b, out=np.zeros_like(e0_nw, dtype=float), where=epsilon_b!=0)\n        # Suppress invalid value warning for log(0) which becomes -inf\n        with np.errstate(divide='ignore'):\n            log_term = np.log(ratio)\n        \n        # max(0, log_term) handles e0 = epsilon_b case\n        recovery_times_at_points = T_nw * np.maximum(0, log_term)\n        \n        t_rec = np.max(recovery_times_at_points)\n        x_rec_over_H = (U * t_rec) / H\n        \n        # 6. Check recovery criterion\n        is_quick_recovery = x_rec_over_H = L_thr\n        results.append(is_quick_recovery)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3369516"}, {"introduction": "除了匹配单点统计量，对湍流更深入的理解需要考虑其频谱特性——即能量如何在不同尺度和方向上分布。本实践挑战您从第一性原理出发，为各向异性剪切流构建一个频谱张量模型，确保其尊重像不可压缩性这样的基本物理定律[@problem_id:3369476]。通过在波数域中工作，您将深入了解湍流的数学结构以及剪切如何引入各向异性。", "problem": "您的任务是为三维剪切流设计并分析一个合成湍流入口生成器，该生成器使用与不可压缩性和半正定性相符的交叉谱张量公式。目标是，从第一性原理出发，为速度场构建一个谱张量模型，该模型在存在剪切的情况下，能在流向和横向分量之间产生非零交叉谱，同时满足无散度约束。然后，您必须在离散化的波数网格上评估量化指标，以测试模型的物理和数值一致性。\n\n定义与基本原理：\n- 设瞬时速度场表示为 $u_i(\\mathbf{x},t)$，其中 $i \\in \\{1,2,3\\}$ 对应于 $(x,y,z)$ 方向上的笛卡尔分量 $(u,v,w)$。假设流动为均匀、定常、不可压缩的湍流。\n- 交叉谱张量（也称为谱密度张量）定义为速度场两点相关张量的傅里叶变换。将其表示为 $\\Phi_{ij}(\\mathbf{k})$，其中 $\\mathbf{k} = (k_x,k_y,k_z)$ 是三维波数矢量。对于不可压缩流，无散度约束意味着\n$$\nk_i \\, \\Phi_{ij}(\\mathbf{k}) = 0 \\quad \\text{for all } \\mathbf{k} \\neq \\mathbf{0}.\n$$\n- 对于每个 $\\mathbf{k}$，谱张量必须是对称的（$\\Phi_{ij} = \\Phi_{ji}$）和半正定的，以确保对于任意矢量 $a_i$，二次型 $a_i \\Phi_{ij} a_j \\ge 0$。\n- 在各向同性湍流中，谱张量具有经典的无散形式 $\\Phi_{ij}(\\mathbf{k}) \\propto \\left(\\delta_{ij} - \\frac{k_i k_j}{\\|\\mathbf{k}\\|^2}\\right) E(\\|\\mathbf{k}\\|)$，其中 $E$ 是标量能谱，$\\delta_{ij}$ 是克罗内克δ函数。在剪切流中，通过在垂直于 $\\mathbf{k}$ 的平面内以一种依赖于剪切方向的方式重新分配能量来引入各向异性，同时保持不可压缩性。\n\n需实现的建模方法：\n- 设单位矢量 $\\hat{\\mathbf{k}} = \\mathbf{k}/\\|\\mathbf{k}\\|$。定义一个单位矢量 $\\mathbf{s}$，表示平均剪切的方向。构造 $\\mathbf{s}$ 在垂直于 $\\hat{\\mathbf{k}}$ 的平面上的投影：\n$$\n\\mathbf{s}_\\perp = \\mathbf{s} - (\\mathbf{s} \\cdot \\hat{\\mathbf{k}})\\hat{\\mathbf{k}}, \\quad \\text{with } \\|\\mathbf{s}_\\perp\\| \\in [0,1].\n$$\n- 为垂直于 $\\hat{\\mathbf{k}}$ 的平面构建一个标准正交基 $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$，方法是当 $\\|\\mathbf{s}_\\perp\\|  0$ 时取 $\\mathbf{e}_1 = \\mathbf{s}_\\perp / \\|\\mathbf{s}_\\perp\\|$，当 $\\|\\mathbf{s}_\\perp\\| \\approx 0$ 时采用一种鲁棒的回退正交构造方法。令 $\\mathbf{e}_2 = \\hat{\\mathbf{k}} \\times \\mathbf{e}_1$，并归一化为单位长度。\n- 定义一个各向异性指数 $\\xi(\\mathbf{k})$，它依赖于一个无量纲剪切率参数 $\\sigma \\ge 0$ 和 $\\|\\mathbf{s}_\\perp\\|$，通过以下公式计算：\n$$\n\\xi(\\mathbf{k}) = \\mathrm{clip}\\left(\\alpha\\, \\sigma \\, \\|\\mathbf{s}_\\perp\\|, \\, -\\xi_{\\max}, \\, \\xi_{\\max}\\right),\n$$\n其中 $\\alpha  0$ 是一个固定的各向异性敏感度常数，$\\xi_{\\max} \\in (0,1)$ 是一个饱和极限，$\\mathrm{clip}(x,a,b)$ 将 $x$ 截断在区间 $[a,b]$ 内。\n- 使用以下权重在垂直于 $\\hat{\\mathbf{k}}$ 的平面内分配能量：\n$$\na(\\mathbf{k}) = \\frac{1 + \\xi(\\mathbf{k})}{2}, \\quad b(\\mathbf{k}) = \\frac{1 - \\xi(\\mathbf{k})}{2}, \\quad \\text{so that } a(\\mathbf{k}) + b(\\mathbf{k}) = 1 \\text{ and } a,b \\ge 0.\n$$\n- 设 $E(k)$ 是一个依赖于 $k = \\|\\mathbf{k}\\|$ 的无量纲标量能谱，其构造应确保在小 $k$ 处有限并在大 $k$ 处衰减。谱张量则通过以下模型构建：\n$$\n\\Phi_{ij}(\\mathbf{k}) = E(k)\\left[ a(\\mathbf{k}) \\, e_{1,i} e_{1,j} + b(\\mathbf{k}) \\, e_{2,i} e_{2,j} \\right],\n$$\n根据构造，此模型是对称的、半正定的，并且满足 $k_i \\Phi_{ij}(\\mathbf{k}) = 0$，因为 $\\mathbf{e}_1$ 和 $\\mathbf{e}_2$ 都与 $\\hat{\\mathbf{k}}$ 正交。\n\n待计算的量：\n- 流向分量是 $u$ (下标 $i=1$)，横向分量是 $v$ (下标 $i=2$)。对于每个 $\\mathbf{k}$，提取自谱 $\\Phi_{11}(\\mathbf{k})$ 和 $\\Phi_{22}(\\mathbf{k})$，以及交叉谱 $\\Phi_{12}(\\mathbf{k})$。将给定 $\\mathbf{k}$ 的相干性大小定义为\n$$\nC_{uv}(\\mathbf{k}) = \\frac{|\\Phi_{12}(\\mathbf{k})|}{\\sqrt{\\Phi_{11}(\\mathbf{k}) \\, \\Phi_{22}(\\mathbf{k})}},\n$$\n对于半正定矩阵，该值在数学上被限制在 $0 \\le C_{uv}(\\mathbf{k}) \\le 1$ 之间。\n- 将波数网格 $\\mathcal{K}$ 上的归一化平均交叉谱定义为\n$$\n\\overline{C}_{12} = \\frac{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\Phi_{12}(\\mathbf{k})}{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\left(\\Phi_{11}(\\mathbf{k}) + \\Phi_{22}(\\mathbf{k})\\right)}.\n$$\n- 定义整个网格上的最小特征值\n$$\n\\lambda_{\\min} = \\min_{\\mathbf{k}\\in \\mathcal{K}} \\min \\, \\mathrm{eig}\\left(\\Phi(\\mathbf{k})\\right),\n$$\n其中 $\\Phi(\\mathbf{k})$ 是元素为 $\\Phi_{ij}(\\mathbf{k})$ 的 $3 \\times 3$ 矩阵。\n- 定义整个网格上的最大归一化散度残差，以评估不可压缩性约束的数值执行情况：\n$$\nD_{\\max} = \\max_{\\mathbf{k}\\in \\mathcal{K}} \\max_{j\\in\\{1,2,3\\}} \\frac{\\left| \\sum_{i=1}^3 k_i \\Phi_{ij}(\\mathbf{k}) \\right|}{E(k) \\, \\|\\mathbf{k}\\|}.\n$$\n\n能谱设定：\n- 使用一个无量纲标量谱\n$$\nE(k) = \\frac{k^4}{k_0^4 + k^4} \\, k^{-5/3} \\, \\exp\\!\\left(-\\left(\\frac{k}{k_c}\\right)^4\\right),\n$$\n其中 $k_0$ 和 $k_c$ 是固定的正常数，确保在小 $k$ 处能量有限并在大 $k$ 处快速衰减。\n\n数值网格：\n- 构造一个均匀的三维波数网格 $\\mathcal{K}$，其中 $k_x, k_y, k_z \\in \\{-k_{\\max}, \\ldots, +k_{\\max}\\}$，每个轴上使用奇数个点，并排除 $\\mathbf{k}=\\mathbf{0}$。\n\n角度单位：\n-任何用于定义剪切方向的角度都必须以弧度为单位。\n\n所有量均为无量纲，因此不需要物理单位。\n\n测试套件：\n- 在您的程序中使用以下固定参数。\n  1. 网格：$k_{\\max} = 4$，每个轴上从 $-k_{\\max}$ 到 $+k_{\\max}$ 均匀分布 $N_k = 9$ 个点，不包括 $\\mathbf{k} = \\mathbf{0}$；$k_0 = 0.5$；$k_c = 6.0$。\n  2. 各向异性敏感度和饱和度：$\\alpha = 2.0$，$\\xi_{\\max} = 0.999999$。\n- 在以下三种剪切配置下评估这四个指标：\n  1. 情况A（各向同性基准）：$\\sigma = 0$，$\\mathbf{s} = (1,0,0)$。\n     - 计算网格上的 $\\overline{C}_{12}$。\n  2. 情况B（$x$–$y$ 平面内 $45^\\circ$ 角的强剪切）：$\\sigma = 200$ 且 $\\mathbf{s} = (\\cos\\varphi, \\sin\\varphi, 0)$，其中 $\\varphi = \\pi/4$ 弧度。\n     - 计算 $\\max_{\\mathbf{k}\\in \\mathcal{K}} C_{uv}(\\mathbf{k})$。\n  3. 情况C（中等剪切，一般方向）：$\\sigma = 0.5$ 且 $\\mathbf{s} = (1, 0.5, 0)$，并归一化为单位长度。\n     - 计算网格上的 $\\lambda_{\\min}$。\n     - 计算网格上的 $D_{\\max}$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含四个结果，分别为情况A、B和C的结果，形式为用逗号分隔并包含在方括号中的列表，顺序为 $[\\overline{C}_{12}, \\max C_{uv}, \\lambda_{\\min}, D_{\\max}]$，即 $[\\text{情况A结果}, \\text{情况B结果}, \\text{情况C的 } \\lambda_{\\min}, \\text{情况C的 } D_{\\max}]$。这些值必须以浮点数形式打印。\n\n您的实现必须是一个完整、可运行的程序。它不能读取任何输入，也不能访问任何外部文件或网络。它必须只使用 Python 标准库以及以下库：NumPy 和 SciPy。所有角度必须使用弧度。所有量均为无量纲。", "solution": "问题陈述经评估有效。其科学基础扎根于计算流体力学和湍流理论的原理，特别是关于合成湍流生成。该问题是适定的，提供了所有必要的定义、参数和约束，以构建一个唯一、可计算的解。语言客观，任务在计算上是可行的。\n\n求解过程如下：首先，我们构造离散的波数网格。然后，对于该网格上的每个波数矢量 $\\mathbf{k}$，我们计算谱张量 $\\mathbf{\\Phi}(\\mathbf{k})$。这包括几个步骤：计算标量能谱 $E(k)$，构造一个编码了剪切诱导的各向异性的局部标准正交基 $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$，确定各向异性权重，最后组装张量。一旦网格中每个 $\\mathbf{k}$ 的张量都已知，我们通过遍历网格并应用所提供的公式来计算四个指定的量化指标。\n\n### 1. 离散化与网格生成\n分析是在一个离散的三维笛卡尔波数网格上进行的，表示为 $\\mathcal{K}$。\n- 该网格由沿 $k_x$、$k_y$ 和 $k_z$ 轴的 $N_k = 9$ 个点定义，这些点在 $-k_{\\max}=-4$ 到 $+k_{\\max}=4$ 之间均匀分布。得到的网格点为 $k_i \\in \\{-4, -3, -2, -1, 0, 1, 2, 3, 4\\}$。\n- 网格 $\\mathcal{K}$ 由这些点构成的所有可能的矢量 $\\mathbf{k} = (k_x, k_y, k_z)$ 组成，但不包括点 $\\mathbf{k}=(0,0,0)$。这导致了 $N_k^3 - 1 = 9^3 - 1 = 728$ 个波数矢量。\n\n### 2. 单个 $\\mathbf{k}$ 的谱张量构造\n对于每个非零波数矢量 $\\mathbf{k} \\in \\mathcal{K}$，谱张量 $\\Phi_{ij}(\\mathbf{k})$ 按照指定的模型进行构造。\n\n#### 2.1. 标量能谱\n该模型假设，在给定波数大小 $k = \\|\\mathbf{k}\\|$ 处的总湍动能根据一个标量能谱 $E(k)$ 进行分布。指定的无量纲形式为：\n$$\nE(k) = \\frac{k^4}{k_0^4 + k^4} \\, k^{-5/3} \\, \\exp\\!\\left(-\\left(\\frac{k}{k_c}\\right)^4\\right)\n$$\n其中固定参数为 $k_0 = 0.5$ 和 $k_c = 6.0$。$\\frac{k^4}{k_0^4 + k^4}$ 项确保当 $k \\to 0$ 时能量趋于零（积分尺度的有限性），$k^{-5/3}$ 项代表遵循 Kolmogorov 理论的惯性子区，指数项则提供了高波数处的快速粘性截断。\n\n#### 2.2. 各向异性基的构造\n通过相对于平均剪切方向 $\\mathbf{s}$ 来确定能量在垂直于 $\\mathbf{k}$ 的平面内的分布方向，从而引入各向异性。这需要该平面的一个标准正交基 $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$。\n1.  单位波数矢量为 $\\hat{\\mathbf{k}} = \\mathbf{k} / \\|\\mathbf{k}\\|$。\n2.  计算剪切矢量 $\\mathbf{s}$ 在垂直于 $\\hat{\\mathbf{k}}$ 的平面上的投影：$\\mathbf{s}_\\perp = \\mathbf{s} - (\\mathbf{s} \\cdot \\hat{\\mathbf{k}})\\hat{\\mathbf{k}}$。其大小 $\\|\\mathbf{s}_\\perp\\|$ 量化了剪切方向“偏离”波矢量方向的程度。\n3.  第一个基矢量 $\\mathbf{e}_1$ 与此投影剪切方向对齐：$\\mathbf{e}_1 = \\mathbf{s}_\\perp / \\|\\mathbf{s}_\\perp\\|$。这定义了各向异性的主方向。\n4.  对于 $\\|\\mathbf{s}_\\perp\\|$ 接近零（即 $\\mathbf{s}$ 近似平行于 $\\hat{\\mathbf{k}}$）的情况，需要一种鲁棒的回退方法。在这种情况下，剪切不会在平面内引起优选方向，任何标准正交基都足够。一种数值稳定的方法是根据 $\\hat{\\mathbf{k}}$ 和一个固定的参考矢量来构造基。我们选择一个不与 $\\hat{\\mathbf{k}}$ 平行的参考矢量 $\\mathbf{v}_{\\text{ref}}$（例如，通过选择与 $\\hat{\\mathbf{k}}$ 最不对齐的笛卡尔轴）。然后我们构造 $\\mathbf{e}_2 = (\\hat{\\mathbf{k}} \\times \\mathbf{v}_{\\text{ref}}) / \\|\\hat{\\mathbf{k}} \\times \\mathbf{v}_{\\text{ref}}\\|$，随后构造 $\\mathbf{e}_1 = \\mathbf{e}_2 \\times \\hat{\\mathbf{k}}$。这确保了一个有效的基。\n5.  然后定义第二个基矢量，以与 $\\mathbf{e}_1$ 和 $\\hat{\\mathbf{k}}$ 构成一个右手系：$\\mathbf{e}_2 = \\hat{\\mathbf{k}} \\times \\mathbf{e}_1$。由于 $\\mathbf{e}_1$ 和 $\\hat{\\mathbf{k}}$ 是正交的单位矢量，$\\mathbf{e}_2$ 自动成为与两者都正交的单位矢量。\n\n#### 2.3. 各向异性公式\n能量重新分配的程度由各向异性指数 $\\xi(\\mathbf{k})$ 控制：\n$$\n\\xi(\\mathbf{k}) = \\mathrm{clip}\\left(\\alpha\\, \\sigma \\, \\|\\mathbf{s}_\\perp\\|, \\, -\\xi_{\\max}, \\, \\xi_{\\max}\\right)\n$$\n这里，$\\sigma$ 是剪切率，$\\alpha=2.0$ 是敏感度，$\\xi_{\\max}=0.999999$ 是一个饱和极限，防止能量完全坍缩到单一方向。\n能量使用以下权重在基矢量 $\\mathbf{e}_1$ 和 $\\mathbf{e}_2$ 之间分配：\n$$\na(\\mathbf{k}) = \\frac{1 + \\xi(\\mathbf{k})}{2}, \\quad b(\\mathbf{k}) = \\frac{1 - \\xi(\\mathbf{k})}{2}\n$$\n根据构造，$a(\\mathbf{k}) + b(\\mathbf{k}) = 1$ 且 $a,b \\in [0,1]$。\n\n#### 2.4. 最终谱张量\n谱张量被组装为基矢量并矢积的加权和：\n$$\n\\Phi_{ij}(\\mathbf{k}) = E(k)\\left[ a(\\mathbf{k}) \\, e_{1,i} e_{1,j} + b(\\mathbf{k}) \\, e_{2,i} e_{2,j} \\right]\n$$\n这种形式保证了 $\\Phi_{ij}$ 是对称的（$\\Phi_{ij}=\\Phi_{ji}$）和半正定的。不可压缩性条件 $k_i \\Phi_{ij}(\\mathbf{k}) = 0$ 在解析上得到满足，因为 $\\mathbf{e}_1$ 和 $\\mathbf{e}_2$ 都与 $\\mathbf{k}$ 正交。\n\n### 3. 指标评估\n通过在网格 $\\mathcal{K}$ 上计算四个指标来评估模型的物理和数值属性。\n\n1.  **归一化平均交叉谱 ($\\overline{C}_{12}$)**：该指标衡量流向（$u$, $i=1$）和横向（$v$, $i=2$）速度分量之间的平均相关性。\n    $$\n    \\overline{C}_{12} = \\frac{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\Phi_{12}(\\mathbf{k})}{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\left(\\Phi_{11}(\\mathbf{k}) + \\Phi_{22}(\\mathbf{k})\\right)}\n    $$\n    对于情况A（各向同性，$\\sigma=0$），$\\xi=0$ 且 $a=b=1/2$。张量简化为各向同性形式 $\\Phi_{ij} \\propto (\\delta_{ij} - \\hat{k}_i \\hat{k}_j)$。项 $\\Phi_{12}(\\mathbf{k}) \\propto -k_x k_y$ 关于 $k_x$ 或 $k_y$ 轴的反射是反对称的。由于网格 $\\mathcal{K}$ 的对称性，分子中的和在解析上为零。\n\n2.  **最大相干性 ($\\max C_{uv}$)**：在单个波数 $\\mathbf{k}$ 处的相干性衡量线性相关的强度。\n    $$\n    C_{uv}(\\mathbf{k}) = \\frac{|\\Phi_{12}(\\mathbf{k})|}{\\sqrt{\\Phi_{11}(\\mathbf{k}) \\, \\Phi_{22}(\\mathbf{k})}}\n    $$\n    该值在整个网格 $\\mathcal{K}$ 上取最大值。当各向异性很强时（$\\xi \\to \\pm 1$），能量集中在一个基矢量上，导致相干性值接近1。\n\n3.  **最小特征值 ($\\lambda_{\\min}$)**：半正定性要求 $\\Phi(\\mathbf{k})$ 的所有特征值均为非负。根据构造，矩阵 $a \\, \\mathbf{e}_1 \\otimes \\mathbf{e}_1 + b \\, \\mathbf{e}_2 \\otimes \\mathbf{e}_2$ 的特征值为 $a$、$b$ 和 $0$（特征矢量分别为 $\\mathbf{e}_1$、$\\mathbf{e}_2$ 和 $\\hat{\\mathbf{k}}$）。因此，$\\Phi(\\mathbf{k})$ 的特征值为 $E(k)a(\\mathbf{k})$、$E(k)b(\\mathbf{k})$ 和 $0$。对于给定的 $\\mathbf{k}$，最小特征值为 $E(k)\\min(a,b) = E(k)\\frac{1-|\\xi(\\mathbf{k})|}{2}$。全局最小值则为：\n    $$\n    \\lambda_{\\min} = \\min_{\\mathbf{k}\\in \\mathcal{K}} \\left( E(\\|\\mathbf{k}\\|) \\frac{1-|\\xi(\\mathbf{k})|}{2} \\right)\n    $$\n\n4.  **最大归一化散度残差 ($D_{\\max}$)**：该指标评估不可压缩性约束的数值执行情况。\n    $$\n    D_{\\max} = \\max_{\\mathbf{k}\\in \\mathcal{K}} \\max_{j\\in\\{1,2,3\\}} \\frac{\\left| \\sum_{i=1}^3 k_i \\Phi_{ij}(\\mathbf{k}) \\right|}{E(k) \\, \\|\\mathbf{k}\\|}\n    $$\n    在解析上，分子 $\\sum_i k_i \\Phi_{ij}$ 为零。任何非零结果都是由于浮点表示和构造正交基矢量时的算术误差造成的。该值预计在机器精度的数量级。\n\n### 4. 测试用例执行\n上述方法在一个 Python 脚本中实现。主函数遍历所有 $\\mathbf{k} \\in \\mathcal{K}$，计算 $\\Phi(\\mathbf{k})$，并更新四个指标的运行值。将情况A、B和C的相应参数提供给此函数，收集并打印所需的最终指标。\n- **情况A**：$\\sigma=0$, $\\mathbf{s}=(1,0,0)$。计算 $\\overline{C}_{12}$。\n- **情况B**：$\\sigma=200$, $\\mathbf{s}=(\\cos(\\pi/4), \\sin(\\pi/4), 0)$。计算 $\\max_{\\mathbf{k}} C_{uv}(\\mathbf{k})$。\n- **情况C**：$\\sigma=0.5$, $\\mathbf{s}=\\text{normalized}(1,0.5,0)$。计算 $\\lambda_{\\min}$ 和 $D_{\\max}$。\n最终输出是这四个计算值的数组。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Although scipy is listed as available, it is not required for this problem\n# as all necessary functionality is provided by numpy.\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the computation for all test cases and print the final result.\n    \"\"\"\n\n    # --- Fixed Parameters ---\n    # Grid parameters\n    k_max = 4.0\n    N_k = 9\n    # Energy spectrum parameters\n    k0 = 0.5\n    kc = 6.0\n    # Anisotropy parameters\n    alpha = 2.0\n    xi_max = 0.999999\n\n    # --- Test Case Definitions ---\n    # Case A: Isotropic baseline\n    sigma_A = 0.0\n    s_A = np.array([1.0, 0.0, 0.0])\n\n    # Case B: Strong shear\n    sigma_B = 200.0\n    phi_B = np.pi / 4.0\n    s_B = np.array([np.cos(phi_B), np.sin(phi_B), 0.0])\n\n    # Case C: Moderate shear\n    sigma_C = 0.5\n    s_unnorm_C = np.array([1.0, 0.5, 0.0])\n    s_C = s_unnorm_C / np.linalg.norm(s_unnorm_C)\n    \n    # --- Generate Wavenumber Grid ---\n    k_vals = np.linspace(-k_max, k_max, N_k)\n    kx, ky, kz = np.meshgrid(k_vals, k_vals, k_vals, indexing='ij')\n    k_grid = np.stack([kx, ky, kz], axis=-1)\n    k_vectors = k_grid.reshape(-1, 3)\n    k_vectors = k_vectors[np.any(k_vectors != 0, axis=1)] # Exclude k = (0,0,0)\n\n    # --- Compute Metrics for each Case ---\n    C12_bar_A, _, _, _ = compute_metrics(k_vectors, sigma_A, s_A, k0, kc, alpha, xi_max)\n    _, max_Cuv_B, _, _ = compute_metrics(k_vectors, sigma_B, s_B, k0, kc, alpha, xi_max)\n    _, _, lambda_min_C, D_max_C = compute_metrics(k_vectors, sigma_C, s_C, k0, kc, alpha, xi_max)\n    \n    results = [C12_bar_A, max_Cuv_B, lambda_min_C, D_max_C]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_metrics(k_vectors, sigma, s, k0, kc, alpha, xi_max):\n    \"\"\"\n    Computes all four metrics for a given shear configuration across the wavenumber grid.\n    \"\"\"\n    \n    # Initialize metric accumulators\n    sum_phi12 = 0.0\n    sum_phi11_phi22 = 0.0\n    max_C_uv = 0.0\n    min_lambda = float('inf')\n    max_D = 0.0\n    \n    for k in k_vectors:\n        k_norm = np.linalg.norm(k)\n        if k_norm == 0: continue\n        k_hat = k / k_norm\n\n        # 1. Scalar Energy Spectrum\n        k_over_k0_4 = (k_norm / k0)**4\n        k_over_kc_4 = (k_norm / kc)**4\n        E_k = (k_over_k0_4 / (1.0 + k_over_k0_4)) * k_norm**(-5.0/3.0) * np.exp(-k_over_kc_4)\n        \n        # 2. Anisotropic Basis Construction {e1, e2}\n        s_dot_k_hat = np.dot(s, k_hat)\n        s_perp = s - s_dot_k_hat * k_hat\n        s_perp_norm = np.linalg.norm(s_perp)\n\n        # A small tolerance for floating point comparisons\n        tol = 1e-9\n\n        if s_perp_norm > tol:\n            e1 = s_perp / s_perp_norm\n        else: # Robust fallback when s is nearly parallel to k_hat\n            # Find axis least aligned with k_hat\n            min_axis = np.argmin(np.abs(k_hat))\n            v_ref = np.zeros(3)\n            v_ref[min_axis] = 1.0\n            # Construct e2 first, then e1, ensuring e2 = k_hat x e1\n            e2_unnorm = np.cross(k_hat, v_ref)\n            e2 = e2_unnorm / np.linalg.norm(e2_unnorm)\n            e1 = np.cross(e2, k_hat)\n\n        e2 = np.cross(k_hat, e1)\n\n        # 3. Anisotropy Formulation\n        xi = alpha * sigma * s_perp_norm\n        xi = np.clip(xi, -xi_max, xi_max)\n        \n        a_k = (1.0 + xi) / 2.0\n        b_k = (1.0 - xi) / 2.0\n        \n        # 4. Spectral Tensor Assembly\n        e1_outer = np.outer(e1, e1)\n        e2_outer = np.outer(e2, e2)\n        Phi = E_k * (a_k * e1_outer + b_k * e2_outer)\n        \n        Phi11, Phi22, Phi12 = Phi[0, 0], Phi[1, 1], Phi[0, 1]\n\n        # 5. Update Metrics\n        # Metric: Normalized Mean Cross-Spectrum\n        sum_phi12 += Phi12\n        sum_phi11_phi22 += Phi11 + Phi22\n        \n        # Metric: Max Coherence\n        denom_C_uv = np.sqrt(Phi11 * Phi22)\n        if denom_C_uv > tol:\n            C_uv_k = np.abs(Phi12) / denom_C_uv\n            max_C_uv = max(max_C_uv, C_uv_k)\n            \n        # Metric: Min Eigenvalue\n        lambda_k = E_k * min(a_k, b_k)\n        min_lambda = min(min_lambda, lambda_k)\n        \n        # Metric: Max Divergence Defect\n        divergence_vector = np.dot(k, Phi) # This is sum_i k_i Phi_ij for j=0,1,2\n        norm_factor = E_k * k_norm\n        if norm_factor > tol:\n            D_k_vec = np.abs(divergence_vector) / norm_factor\n            max_D = max(max_D, np.max(D_k_vec))\n\n    # Finalize mean cross-spectrum calculation\n    C12_bar = sum_phi12 / sum_phi11_phi22 if abs(sum_phi11_phi22) > tol else 0.0\n    \n    return C12_bar, max_C_uv, min_lambda, max_D\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3369476"}, {"introduction": "不同的合成湍流方法具有独特的内在假设，这些假设会显著影响模拟的准确性，尤其是在复杂流动中。本练习将两种流行的方法——合成涡方法（Synthetic Eddy Method, SEM）和数字滤波器方法（Digital Filter Method, DFM）——在一个充满挑战的场景中进行检验，该场景涉及一个接近分离的边界层[@problem_id:3369522]。通过建模和比较每种方法维持关键湍流输运项的能力，您将为针对特定的CFD问题选择正确的入流生成策略培养出批判性的视角。", "problem": "考虑一个三维湍流边界层，其承受的逆压梯度由 Clauser 压力梯度参数 $\\beta$ 表征。目标是在一个受控且通用的数学框架下，评估由合成涡方法 (SEM) 或数字滤波器方法 (DFM) 生成的合成入流湍流，在流动沿短流向距离向分离起始点演化时，哪一种能更好地保持由雷诺剪切应力 $-u'v'$ 代表的近壁湍流输运。此评估必须基于第一性原理和经过充分检验的事实构建，转化为一个算法，该算法对每个测试案例输出一个可量化的布尔值，并实现为一个完整的可运行程序。\n\n您必须从以下基础出发：\n- 雷诺分解和雷诺平均纳维-斯托克斯 (RANS) 概念：$u_i = \\overline{u}_i + u'_i$，$\\overline{u'_i} = 0$，以及雷诺应力张量 $R_{ij} = \\overline{u'_i u'_j}$，其中近壁动量输运主要由 $-R_{12} = -\\overline{u' v'}$ 主导。\n- 雷诺应力输运方程及其在具有平均剪切的边界层中的产生项，以及公认的建模实践，将未封闭项简化为易于处理的、基于时间尺度的松弛。具体来说，使用以下思想：$R_{12}$ 在短入流发展长度上的流向演化可以用一个关于流向坐标 $x$ 的一维常微分方程来近似，该方程包含一个由局部平均剪切 $\\partial \\overline{U}/\\partial y$ 驱动的产生项，以及一个向由局部涡周转时间设定的平衡状态的有效松弛。\n\n按如下方式构建一个入流生成和短流向距离演化模型，确保其科学合理性和内部一致性，同时避免任何对外部数据的依赖：\n\n$1.$ 几何与运动学：\n- 设壁面法向坐标为 $y \\in [0,\\delta]$，其中 $\\delta$ 为边界层厚度（单位：米）。\n- 设流向坐标为 $x \\in [0,L_{\\text{onset}}]$（单位：米），表示向分离起始点发展的短距离。\n- 通过一个在入流处调节各向异性的横流因子引入展向可变性，以模拟三维边界层，而无需显式解析展向平均动力学。\n\n$2.$ 平均量与压力梯度：\n- 使用平均流向速度大小 $U_{\\infty}$（单位：米/秒）和壁面法向剪切代理 $S(y)$（单位：反秒），该代理随 $y$ 和 $\\beta$ 的增加而单调递减，其关系为 $S(y) = S_0 \\exp(-\\beta)\\exp(-y/\\delta)$，其中 $S_0 = U_{\\infty}/\\delta$。\n- 定义一个用于湍流平流的对流速度 $U_c(y)$，作为 $y$ 的严格递增函数，形式为 $U_c(y) = U_{\\infty}\\left(\\dfrac{y}{\\delta}\\right)^{1/3}$（单位：米/秒），确保 $U_c(0)=0$ 且 $U_c(\\delta) = U_{\\infty}$。\n\n$3.$ 入流湍流统计量：\n- 设湍动能剖面为 $k(y) = k_0\\left(\\dfrac{y}{\\delta}\\right)\\exp\\left(-\\dfrac{y}{\\delta}\\right)$（单位：平方米/平方秒）。\n- 使用各向异性分数 $c_u$、$c_v$ 和 $c_w$ 将 $k$ 分解为法向应力分量，其中 $c_u + c_v + c_w = 1$，且 $c_u = 0.5$，$c_v = 0.2$，$c_w = 0.3$，得到 $R_{11}(y) = c_u k(y)$，$R_{22}(y) = c_v k(y)$，$R_{33}(y) = c_w k(y)$。\n- 设定入流的互相关系数剖面 $\\rho_{12}(y)$，通过一个横流因子捕捉三维放大效应，其形式为 $\\rho_{12}(y) = -C_{\\rho}\\left[1 + \\gamma \\dfrac{S_{\\text{cf}}}{S_0}\\right]\\left(\\dfrac{y}{\\delta}\\right)\\exp\\left(-\\dfrac{y}{\\delta}\\right)$，其中 $C_{\\rho}$ 和 $\\gamma$ 为正常数， $S_{\\text{cf}}$ 为展向剪切代理（单位：反秒）。则入流雷诺剪切应力为 $R_{12}^{0}(y) = \\rho_{12}(y)\\sqrt{R_{11}(y)R_{22}(y)}$。\n\n$4.$ 合成入流方法：\n- 合成涡方法 (SEM)：通过壁面阻塞函数 $f_{\\text{SEM}}(y) = 1 - \\exp\\left(-\\dfrac{y}{L_s}\\right)$ 对近壁壁面法向衰减进行建模，其中 $L_s$ 是 SEM 涡尺寸（单位：米）。控制松弛的有效涡长度为 $L_{e,\\text{SEM}}(y) = L_s$。\n- 数字滤波器方法 (DFM)：使用基于滤波器的函数 $f_{\\text{DFM}}(y) = 1 - \\exp\\left(-\\dfrac{y}{\\tfrac{1}{2}L_f}\\right)$ 对衰减进行建模，其中 $L_f$ 是 DFM 相关长度（单位：米）。有效涡长度为 $L_{e,\\text{DFM}}(y) = L_f$。\n- 对于每种方法 $\\mathcal{M} \\in \\{\\text{SEM},\\text{DFM}\\}$，定义一个进入产生项的有效壁面法向法向应力为 $R_{22,\\mathcal{M}}^{\\text{eff}}(y) = f_{\\mathcal{M}}(y)R_{22}(y)$。\n\n$5.$ 短流向距离演化模型：\n- 从包含平均剪切产生项和单一时间尺度松弛假设的雷诺应力输运方程出发，推导出一个描述 $R_{12}(y;x)$ 在 $x \\in [0,L_{\\text{onset}}]$ 上流向演化的简化常微分方程，形式为\n  $\\dfrac{\\mathrm{d}R_{12}(y;x)}{\\mathrm{d}x} = \\mathcal{P}_{12}(y) - \\dfrac{R_{12}(y;x)}{\\ell_{\\mathcal{M}}(y)}$，\n  其中产生项 $\\mathcal{P}_{12}(y)$ 依赖于局部剪切和有效壁面法向应力，而松弛长度 $\\ell_{\\mathcal{M}}(y)$ 与方法 $\\mathcal{M}$ 的局部涡周转距离成比例，该距离由 $L_{e,\\mathcal{M}}(y)$ 和 $U_c(y)$ 构建。使用物理上一致的符号约定，确保正的 $-R_{12}$ 对应于从壁面向外的动量通量。\n- 演化从 $x=0$ 开始，初始条件为 $R_{12}(y;0) = R_{12}^{0}(y)$。\n\n$6.$ 近分离度量与决策规则：\n- 定义近壁区域为 $y \\in [0,0.2\\delta]$。\n- 对于每种方法，计算 $-R_{12}(y;L_{\\text{onset}})$ 在近壁区域的平均值，记为 $\\overline{-R_{12}}^{\\mathcal{M}}$（单位：平方米/平方秒）。类似地计算入流近壁平均值 $\\overline{-R_{12}^{0}}$。\n- 将方法 $\\mathcal{M}$ 的保持率定义为 $\\Pi_{\\mathcal{M}} = \\dfrac{\\overline{-R_{12}}^{\\mathcal{M}}}{\\overline{-R_{12}^{0}}}$（无量纲）。$\\Pi_{\\mathcal{M}}$ 越接近 $1$ 的方法，表明其在 $[0,L_{\\text{onset}}]$ 上对入流湍流输运的保持效果越好。\n- 每个测试案例的决策是一个布尔值：如果 SEM 的绝对偏差 $|\\Pi_{\\text{SEM}} - 1|$ 小于 DFM，则返回 $\\text{True}$，否则返回 $\\text{False}$。\n\n$7.$ 数值与单位要求：\n- 所有计算均在国际单位制 (SI) 下进行：米、秒、米/秒。\n- 使用均匀的 $y$ 网格，其分辨率足以精确计算平均值。\n- 如果出现任何角度度量，必须使用弧度，但本问题未明确要求使用角度。\n\n$8.$ 测试套件：\n为以下参数集实现程序，这些参数集共同测试了一个典型案例、一个更强的逆压梯度条件，以及一个在近分离起始点具有增强横流影响的三维边界层。所有量均采用 SI 单位。\n\n- 案例 A（一般情况）：\n  - $\\delta = 0.05$,\n  - $U_{\\infty} = 20$,\n  - $\\beta = 0$,\n  - $k_0 = 0.4$,\n  - $C_{\\rho} = 0.3$,\n  - $\\gamma = 0.3$,\n  - $S_{\\text{cf}} = 0$,\n  - $L_s = 0.002$,\n  - $L_f = 0.02$,\n  - $L_{\\text{onset}} = 0.0001$。\n\n- 案例 B（逆压梯度，近分离趋势）：\n  - $\\delta = 0.05$,\n  - $U_{\\infty} = 15$,\n  - $\\beta = 3$,\n  - $k_0 = 0.5$,\n  - $C_{\\rho} = 0.35$,\n  - $\\gamma = 0.25$,\n  - $S_{\\text{cf}} = 0$,\n  - $L_s = 0.003$,\n  - $L_f = 0.0015$,\n  - $L_{\\text{onset}} = 0.0001$。\n\n- 案例 C（具有更强横流和高逆压梯度的三维边界层）：\n  - $\\delta = 0.05$,\n  - $U_{\\infty} = 12$,\n  - $\\beta = 5$,\n  - $k_0 = 0.6$,\n  - $C_{\\rho} = 0.32$,\n  - $\\gamma = 0.4$,\n  - $S_{\\text{cf}} = 40$,\n  - $L_s = 0.001$,\n  - $L_f = 0.003$,\n  - $L_{\\text{onset}} = 0.0001$。\n\n$9.$ 最终输出规范：\n您的程序应生成单行输出，其中包含三个测试案例（按 A、B、C 的顺序）的结果，格式为方括号内以逗号分隔的列表。每个条目必须是如上定义的布尔值，例如 $\\texttt{[True,False,True]}$。\n\n不允许用户输入。代码必须完全自包含，并能在任何提供数值数组和基本科学计算工具的标准环境中运行。", "solution": "该问题要求对合成涡方法 (SEM) 和数字滤波器方法 (DFM) 这两种生成合成湍流入流的方法进行比较评估。评估标准是在承受逆压梯度的三维湍流边界层中，在短流向发展长度 $L_{\\text{onset}}$ 内，对近壁雷诺剪切应力 $-R_{12} = -\\overline{u'v'}$ 的保持能力。解决方案是通过为雷诺剪切应力 $R_{12}$ 构建一个简化的一维输运模型，并针对每种方法进行求解来制定的。\n\n**1. 流向演化模型的构建**\n\n问题指定，对于固定的壁面法向位置 $y$ 和变化的流向坐标 $x$，雷诺剪切应力 $R_{12}(y;x)$ 的流向演化受一个一阶常微分方程 (ODE) 控制。该 ODE 是通过从完整的雷诺应力输运方程中仅保留平均剪切产生项和单一时间尺度松弛项，然后使用对流速度 $U_c(y)$ 将时间演化转换为空间演化而推导出来的。\n\n$R_{12}$ 基于时间的输运方程近似为：\n$$\n\\frac{\\mathrm{D} R_{12}}{\\mathrm{D} t} \\approx \\mathcal{P}_{12}^{\\text{time}} - \\frac{R_{12}}{\\tau}\n$$\n其中 $\\mathcal{P}_{12}^{\\text{time}}$ 是产生率，$\\tau$ 是松弛时间尺度。对于二维平均流 $(\\overline{U}(y), 0, 0)$，主导的产生项是 $\\mathcal{P}_{12}^{\\text{time}} = - \\overline{v'^2} \\frac{\\partial \\overline{U}}{\\partial y} = -R_{22} S(y)$，其中 $S(y)$ 是平均剪切。对于定常流，物质导数 $\\frac{\\mathrm{D}}{\\mathrm{D}t}$ 近似为 $U_c(y)\\frac{\\mathrm{d}}{\\mathrm{d}x}$，其中 $U_c(y)$ 是局部湍流对流速度。这得到：\n$$\nU_c(y) \\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x} = -R_{22,\\mathcal{M}}^{\\text{eff}}(y) S(y) - \\frac{R_{12}}{\\tau_{\\mathcal{M}}(y)}\n$$\n这里，$R_{22,\\mathcal{M}}^{\\text{eff}}(y)$ 是方法 $\\mathcal{M} \\in \\{\\text{SEM}, \\text{DFM}\\}$ 的有效壁面法向应力。整理成问题陈述中指定的形式 $\\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x} = \\mathcal{P}_{12} - \\frac{R_{12}}{\\ell_{\\mathcal{M}}}$，我们确定产生项和松弛项：\n$$\n\\mathcal{P}_{12}(y) = -\\frac{R_{22,\\mathcal{M}}^{\\text{eff}}(y)S(y)}{U_c(y)}\n$$\n$$\n\\ell_{\\mathcal{M}}(y) = U_c(y)\\tau_{\\mathcal{M}}(y)\n$$\n问题指出，松弛长度 $\\ell_{\\mathcal{M}}(y)$ 是由有效涡长度 $L_{e,\\mathcal{M}}(y)$ 和对流速度 $U_c(y)$ 构建的。由这些量可以构成的最简单的物理一致的时间尺度 $\\tau_{\\mathcal{M}}$ 是 $\\tau_{\\mathcal{M}}(y) = L_{e,\\mathcal{M}}(y)/U_c(y)$。这意味着一个涡在其平流一个涡长度所需的时间内被“刷新”或解相关。将此代入 $\\ell_{\\mathcal{M}}(y)$ 的方程中：\n$$\n\\ell_{\\mathcal{M}}(y) = U_c(y) \\left( \\frac{L_{e,\\mathcal{M}}(y)}{U_c(y)} \\right) = L_{e,\\mathcal{M}}(y)\n$$\n因此，松弛长度就是依赖于方法的有效涡长度，对于每种方法，它被指定为一个常数：$\\ell_{\\text{SEM}}(y) = L_s$ 和 $\\ell_{\\text{DFM}}(y) = L_f$。\n\n最终的 ODE 是：\n$$\n\\frac{\\mathrm{d}R_{12}(y;x)}{\\mathrm{d}x} = -\\frac{R_{22,\\mathcal{M}}^{\\text{eff}}(y)S(y)}{U_c(y)} - \\frac{R_{12}(y;x)}{L_{e,\\mathcal{M}}}\n$$\n这是一个一阶线性非齐次 ODE，形式为 $y' + p(x)y = q(x)$，其中 $p(x)$ 和 $q(x)$ 相对于 $x$ 是常数。\n\n**2. ODE 的解析解**\n\n对于固定的 $y$，令 $R_{12}^{\\text{eq},\\mathcal{M}}(y)$ 为剪切应力的平衡值，即 $x \\to \\infty$ 时达到的值。通过设置 $\\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x}=0$ 可得：\n$$\nR_{12}^{\\text{eq},\\mathcal{M}}(y) = - \\frac{R_{22,\\mathcal{M}}^{\\text{eff}}(y)S(y)L_{e,\\mathcal{M}}}{U_c(y)}\n$$\n该 ODE 可以写成：\n$$\n\\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x} = -\\frac{1}{L_{e,\\mathcal{M}}} \\left( R_{12} - R_{12}^{\\text{eq},\\mathcal{M}}(y) \\right)\n$$\n给定初始条件 $R_{12}(y;0) = R_{12}^0(y)$，解为：\n$$\nR_{12}^{\\mathcal{M}}(y;x) = R_{12}^{\\text{eq},\\mathcal{M}}(y) + \\left( R_{12}^0(y) - R_{12}^{\\text{eq},\\mathcal{M}}(y) \\right) \\exp\\left(-\\frac{x}{L_{e,\\mathcal{M}}}\\right)\n$$\n这个方程描述了雷诺剪切应力剖面从其在入流平面 ($x=0$) 的初始状态向局部平衡状态的流向演化。\n\n**3. 模型分量剖面**\n\n该模型由以下关于壁面法向坐标 $y \\in [0, \\delta]$ 的函数完全指定：\n- 剪切代理：$S(y) = S_0 \\exp(-\\beta)\\exp(-y/\\delta)$，其中 $S_0 = U_{\\infty}/\\delta$。\n- 对流速度：$U_c(y) = U_{\\infty}\\left(\\frac{y}{\\delta}\\right)^{1/3}$。\n- 湍动能：$k(y) = k_0\\left(\\frac{y}{\\delta}\\right)\\exp\\left(-\\frac{y}{\\delta}\\right)$。\n- 法向雷诺应力：$R_{11}(y) = c_u k(y) = 0.5 k(y)$ 和 $R_{22}(y) = c_v k(y) = 0.2 k(y)$。\n- 入流互相关系数：$\\rho_{12}(y) = -C_{\\rho}\\left[1 + \\gamma \\frac{S_{\\text{cf}}}{S_0}\\right]\\left(\\frac{y}{\\delta}\\right)\\exp\\left(-\\frac{y}{\\delta}\\right)$。\n- 入流雷诺剪切应力：$R_{12}^0(y) = \\rho_{12}(y)\\sqrt{R_{11}(y)R_{22}(y)}$。\n- 依赖于方法的壁面阻塞/衰减函数：\n  - SEM: $f_{\\text{SEM}}(y) = 1 - \\exp\\left(-\\frac{y}{L_s}\\right)$。\n  - DFM: $f_{\\text{DFM}}(y) = 1 - \\exp\\left(-\\frac{2y}{L_f}\\right)$。\n- 依赖于方法的有效法向应力：$R_{22,\\mathcal{M}}^{\\text{eff}}(y) = f_{\\mathcal{M}}(y)R_{22}(y)$。\n- 依赖于方法的有效涡长度：$L_{e,\\text{SEM}} = L_s$ 和 $L_{e,\\text{DFM}} = L_f$。\n\n在 $y=0$ 处，$k(y)$、$R_{ij}(y)$ 和 $U_c(y)$ 等量均为零。平衡应力 $R_{12}^{\\text{eq},\\mathcal{M}}(y)$ 包含一个分子分母都趋于零的比率。仔细分析表明，近壁处 $R_{22,\\mathcal{M}}^{\\text{eff}}(y) \\propto y^2$ 而 $U_c(y) \\propto y^{1/3}$，因此 $R_{12}^{\\text{eq},\\mathcal{M}}(y) \\propto y^{5/3}$ 并且在 $y=0$ 处明确定义为 $0$。\n\n**4. 评估度量和计算算法**\n\n评估基于近壁雷诺剪切应力 $-R_{12}$ 的保持情况。\n1.  为 $y \\in [0, \\delta]$ 建立一个包含 $N_y$ 个点的均匀网格。\n2.  将近壁区域定义为 $y \\in [0, 0.2\\delta]$。\n3.  通过数值积分（梯形法则）计算给定流向位置 $x$ 处的平均近壁剪切应力：\n    $$\n    \\overline{-R_{12}}(x) = \\frac{1}{0.2\\delta} \\int_{0}^{0.2\\delta} -R_{12}(y;x) \\, \\mathrm{d}y\n    $$\n4.  计算初始平均应力 $\\overline{-R_{12}^{0}} = \\overline{-R_{12}}(0)$。\n5.  对于每种方法 $\\mathcal{M}$，使用 $R_{12}^{\\mathcal{M}}(y; L_{\\text{onset}})$ 的解析解计算发展长度末端的平均应力 $\\overline{-R_{12}^{\\mathcal{M}}} = \\overline{-R_{12}^{\\mathcal{M}}}(L_{\\text{onset}})$。\n6.  计算每种方法的保持率：\n    $$\n    \\Pi_{\\mathcal{M}} = \\frac{\\overline{-R_{12}^{\\mathcal{M}}}}{\\overline{-R_{12}^{0}}}\n    $$\n7.  如果一种方法的保持率 $\\Pi_{\\mathcal{M}}$ 更接近 1，则认为该方法更好。决策规则是，如果 SEM 性能更好，则返回 `True`，否则返回 `False`：\n    $$\n    \\text{Result} = \\left( |\\Pi_{\\text{SEM}} - 1|  |\\Pi_{\\text{DFM}} - 1| \\right)\n    $$\n此过程应用于所提供的三个测试案例中的每一个。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the synthetic turbulence inflow comparison problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A (general case)\n        {\n            \"delta\": 0.05, \"U_inf\": 20.0, \"beta\": 0.0, \"k0\": 0.4,\n            \"C_rho\": 0.3, \"gamma\": 0.3, \"S_cf\": 0.0,\n            \"Ls\": 0.002, \"Lf\": 0.02, \"L_onset\": 0.0001\n        },\n        # Case B (adverse pressure gradient)\n        {\n            \"delta\": 0.05, \"U_inf\": 15.0, \"beta\": 3.0, \"k0\": 0.5,\n            \"C_rho\": 0.35, \"gamma\": 0.25, \"S_cf\": 0.0,\n            \"Ls\": 0.003, \"Lf\": 0.0015, \"L_onset\": 0.0001\n        },\n        # Case C (3D boundary layer with high APG)\n        {\n            \"delta\": 0.05, \"U_inf\": 12.0, \"beta\": 5.0, \"k0\": 0.6,\n            \"C_rho\": 0.32, \"gamma\": 0.4, \"S_cf\": 40.0,\n            \"Ls\": 0.001, \"Lf\": 0.003, \"L_onset\": 0.0001\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_case(params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(params):\n    \"\"\"\n    Computes the result for a single test case.\n    \"\"\"\n    # Unpack parameters\n    delta = params[\"delta\"]\n    U_inf = params[\"U_inf\"]\n    beta = params[\"beta\"]\n    k0 = params[\"k0\"]\n    C_rho = params[\"C_rho\"]\n    gamma = params[\"gamma\"]\n    S_cf = params[\"S_cf\"]\n    Ls = params[\"Ls\"]\n    Lf = params[\"Lf\"]\n    L_onset = params[\"L_onset\"]\n\n    # Constants\n    c_u = 0.5\n    c_v = 0.2\n    \n    # Numerical grid\n    Ny = 2001  # Sufficient resolution for y-grid\n    y = np.linspace(0, delta, Ny)\n    y_norm = y / delta\n\n    # --- 1. Compute y-dependent profiles ---\n\n    S0 = U_inf / delta\n    S = S0 * np.exp(-beta) * np.exp(-y_norm)\n\n    # Convective velocity U_c(y)\n    U_c = U_inf * (y_norm)**(1/3)\n\n    # Turbulent kinetic energy k(y)\n    k = k0 * y_norm * np.exp(-y_norm)\n\n    # Reynolds stress components at inflow\n    R11 = c_u * k\n    R22 = c_v * k\n    \n    # Inflow cross-correlation coefficient rho_12(y)\n    rho12 = -C_rho * (1 + gamma * S_cf / S0) * y_norm * np.exp(-y_norm)\n\n    # Inflow Reynolds shear stress R12_0(y)\n    R12_0 = rho12 * np.sqrt(R11 * R22)\n    \n    # Handle the behavior at y=0 where U_c is zero\n    # The term R12_eq involves division by U_c.\n    # At y=0, R22_eff is 0, so the expression is 0/0.\n    # We evaluate the limit, which is 0, by setting the value at y=0 explicitly.\n    with np.errstate(divide='ignore', invalid='ignore'):\n        # For SEM\n        f_sem = 1.0 - np.exp(-y / Ls)\n        R22_eff_sem = f_sem * R22\n        Le_sem = Ls\n        R12_eq_sem = - (R22_eff_sem * S * Le_sem) / U_c\n\n        # For DFM\n        f_dfm = 1.0 - np.exp(-2.0 * y / Lf)\n        R22_eff_dfm = f_dfm * R22\n        Le_dfm = Lf\n        R12_eq_dfm = - (R22_eff_dfm * S * Le_dfm) / U_c\n\n    R12_eq_sem[0] = 0.0\n    R12_eq_dfm[0] = 0.0\n    \n    # --- 2. Compute evolved stress profiles at L_onset ---\n\n    # For SEM\n    R12_sem_L = R12_eq_sem + (R12_0 - R12_eq_sem) * np.exp(-L_onset / Le_sem)\n\n    # For DFM\n    R12_dfm_L = R12_eq_dfm + (R12_0 - R12_eq_dfm) * np.exp(-L_onset / Le_dfm)\n    \n    # --- 3. Compute near-wall averages and preservation ratios ---\n    \n    # Define near-wall region for integration: y in [0, 0.2*delta]\n    integration_limit_y = 0.2 * delta\n    integration_idx = np.where(y = integration_limit_y)[0]\n    y_integrate = y[integration_idx]\n    \n    # Quantities to integrate (note the sign for -R12)\n    neg_R12_0_integrate = -R12_0[integration_idx]\n    neg_R12_sem_integrate = -R12_sem_L[integration_idx]\n    neg_R12_dfm_integrate = -R12_dfm_L[integration_idx]\n    \n    # Compute integrals using trapezoidal rule\n    integral_neg_R12_0 = np.trapz(neg_R12_0_integrate, y_integrate)\n    integral_neg_R12_sem = np.trapz(neg_R12_sem_integrate, y_integrate)\n    integral_neg_R12_dfm = np.trapz(neg_R12_dfm_integrate, y_integrate)\n    \n    # Compute averages\n    avg_neg_R12_0 = integral_neg_R12_0 / integration_limit_y\n    avg_neg_R12_sem = integral_neg_R12_sem / integration_limit_y\n    avg_neg_R12_dfm = integral_neg_R12_dfm / integration_limit_y\n    \n    # Compute preservation ratios\n    pi_sem = avg_neg_R12_sem / avg_neg_R12_0\n    pi_dfm = avg_neg_R12_dfm / avg_neg_R12_0\n    \n    # --- 4. Decision ---\n    \n    # Return True if SEM has smaller deviation from 1.0, False otherwise.\n    return abs(pi_sem - 1.0)  abs(pi_dfm - 1.0)\n\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3369522"}]}