{"hands_on_practices": [{"introduction": "要真正掌握一个模型，我们必须能够亲手应用它。第一个练习提供了一个理想化的简单剪切流场，这让我们能专注于 Smagorinsky 模型本身的计算力学，而无需被其他复杂性所干扰。通过这个基础计算 [@problem_id:1770682]，你将熟悉应变率张量 $\\bar{S}_{ij}$ 的求解，并理解它是如何最终决定亚格子黏性 $\\nu_{sgs}$ 的。", "problem": "在计算流体动力学领域，大涡模拟（LES）是一种湍流模型技术，它将直接解析的大尺度湍流涡与被模化的小尺度涡分离开来。这些小的、未解析的尺度对已解析流场的影响是通过一个亚格子尺度（SGS）应力张量来引入的。对该张量建模的一种常用方法是Boussinesq假设，该假设通过SGS涡粘度 $\\nu_{sgs}$ 将SGS应力与已解析的应变率张量联系起来。\n\n关于这种涡粘度的基础模型之一是Smagorinsky模型，其表达式为：\n$$\n\\nu_{sgs} = (C_s \\Delta)^2 \\sqrt{2 \\bar{S}_{ij} \\bar{S}_{ij}}\n$$\n其中，$C_s$是无量纲的Smagorinsky常数，$\\Delta$是滤波宽度（计算网格的特征长度尺度），$\\bar{S}_{ij}$是已解析的应变率张量。对于速度分量为 $\\bar{u}_i$（在方向 $x_i = (x, y, z)$上）的不可压缩流，应变率张量定义为 $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_i}{\\partial x_j} + \\frac{\\partial \\bar{u}_j}{\\partial x_i}\\right)$。项 $\\bar{S}_{ij} \\bar{S}_{ij}$ 意味着对重复指标求和（爱因斯坦求和约定）。\n\n考虑一个笛卡尔坐标系中的简单、稳态、二维剪切流，其速度场由 $\\vec{v} = (u,v,w)$ 给出，分量为 $u = S y$，$v=0$ 和 $w=0$。量 $S$ 是一个恒定的正剪切率。为了本次分析，假设LES中固有的滤波操作不会改变这个线性速度剖面，从而已解析的速度场与给定场相同（即 $\\bar{u}_i = u_i$）。\n\n根据这些信息，推导在这个简单剪切流中亚格子尺度粘度 $\\nu_{sgs}$ 的表达式。你的最终答案应以剪切率 $S$、Smagorinsky常数 $C_s$ 和滤波宽度 $\\Delta$ 表示。", "solution": "我们使用Smagorinsky亚格子尺度粘度模型\n$$\n\\nu_{sgs} = (C_{s}\\Delta)^{2}\\sqrt{2\\,\\bar{S}_{ij}\\bar{S}_{ij}},\n$$\n其中，对于不可压缩流，已解析的应变率张量定义为\n$$\n\\bar{S}_{ij}=\\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}}+\\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right).\n$$\n给定的速度场为 $u_{1}=u=S\\,y$, $u_{2}=v=0$, $u_{3}=w=0$，其中 $x_{1}=x$, $x_{2}=y$, $x_{3}=z$，并且滤波操作不改变该场，因此 $\\bar{u}_{i}=u_{i}$。非零的速度梯度为\n$$\n\\frac{\\partial u_{1}}{\\partial x_{2}}=S,\\quad \\frac{\\partial u_{1}}{\\partial x_{1}}=\\frac{\\partial u_{1}}{\\partial x_{3}}=\\frac{\\partial u_{2}}{\\partial x_{j}}=\\frac{\\partial u_{3}}{\\partial x_{j}}=0.\n$$\n使用 $\\bar{S}_{ij}$ 的定义，唯一的非零分量是\n$$\n\\bar{S}_{12}=\\bar{S}_{21}=\\frac{1}{2}\\left(\\frac{\\partial u_{1}}{\\partial x_{2}}+\\frac{\\partial u_{2}}{\\partial x_{1}}\\right)=\\frac{S}{2},\n$$\n而所有对角和其它非对角分量均为零。则缩并为\n$$\n\\bar{S}_{ij}\\bar{S}_{ij}=\\bar{S}_{12}^{2}+\\bar{S}_{21}^{2}=2\\left(\\frac{S}{2}\\right)^{2}=\\frac{S^{2}}{2}.\n$$\n因此，\n$$\n\\sqrt{2\\,\\bar{S}_{ij}\\bar{S}_{ij}}=\\sqrt{2\\cdot\\frac{S^{2}}{2}}=|S|.\n$$\n因为给定的剪切率 $S$ 被指定为正值，所以 $|S|=S$。代入Smagorinsky模型得到\n$$\n\\nu_{sgs}=(C_{s}\\Delta)^{2}S.\n$$", "answer": "$$\\boxed{(C_{s}\\Delta)^{2}S}$$", "id": "1770682"}, {"introduction": "在学会如何计算亚格子黏性之后，关键的下一步是理解该模型何时*不*适用。本练习 [@problem_id:3373067] 探讨了一个经典的失败案例——层流剪切流，标准 Smagorinsky 模型在此情况下会错误地预测出湍流耗散。通过分析这一缺陷，你将深入理解动态 Smagorinsky 程序的提出动机和核心思想，这是现代大涡模拟中的一个基石。", "problem": "考虑一个不可压缩、层流简单剪切流的大涡模拟 (LES)，其滤波后的速度场由 $\\bar{\\mathbf{u}}(x,y,z) = (G y,\\, 0,\\, 0)$ 给出，其中 $G$ 是一个恒定的剪切率。该 LES 应用了一个宽度为 $\\Delta$ 的空间滤波器，并通过涡粘性封闭来模拟偏亚格子尺度 (SGS) 应力。\n\n从下述定义和定律出发，完成以下任务：\n1. 对于不可压缩流，使用滤波应变率张量 $\\bar{S}_{ij}$ 的运动学定义，计算标量大小 $|\\bar{S}|$，仅用 $G$ 表示，其中大小的定义为 $|\\bar{S}| = \\left(2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij}\\right)^{1/2}$。\n2. 使用涡粘性封闭 $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$ 和 Smagorinsky 假设 $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$（模型系数 $C_{S}$ 为常数），从第一性原理出发，论证为何即使在网格细化时（即当 $\\Delta \\to 0$），尽管流动是完全的层流且被完全解析，这种常数 $C_{S}$ 封闭仍然预测了非零的 SGS 耗散。然后，从动态 Smagorinsky 过程核心的 Germano 恒等式出发，解释为什么对于此流动，动态计算的 $C_{S}^{2}$ 会消失。\n\n仅使用以下基本要素作为你的出发点：\n- 不可压缩滤波连续性方程 $\\partial \\bar{u}_{i}/\\partial x_{i} = 0$。\n- 滤波应变率定义 $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)$。\n- 偏 SGS 封闭 $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$，其中 $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$。\n- LES 和测试滤波的 Germano 恒等式：$L_{ij} = \\widetilde{\\overline{u_{i}\\,u_{j}}} - \\tilde{\\bar{u}}_{i}\\,\\tilde{\\bar{u}}_{j}$，其中波浪号表示测试滤波，上划线表示网格滤波，$L_{ij}$ 是 Leonard 应力。\n\n将 $|\\bar{S}|$ 的值报告为仅含 $G$ 的单个代数表达式。不需要进行数值计算。如果在你的推理中引入任何物理单位，请使用标准的国际单位制 (SI) 明确说明，但最终报告的表达式必须如仅用 $G$ 书写时一样是无量纲的。", "solution": "该问题要求对给定的不可压缩、层流简单剪切流，分两部分对 Smagorinsky 亚格子尺度 (SGS) 模型进行分析。首先，我们计算滤波应变率张量的大小。其次，我们分析常系数和动态 Smagorinsky 模型在此流动中的行为。\n\n**第一部分：滤波应变率大小 $|\\bar{S}|$ 的计算**\n\n问题给出了在笛卡尔坐标系 $(x_1, x_2, x_3) = (x, y, z)$ 中的滤波速度场 $\\bar{\\mathbf{u}}$ 及其分量：\n$$\n\\bar{u}_1 = G y = G x_2 \\\\\n\\bar{u}_2 = 0 \\\\\n\\bar{u}_3 = 0\n$$\n其中 $G$ 是恒定的剪切率。\n\n滤波应变率张量 $\\bar{S}_{ij}$ 定义为：\n$$\n\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)\n$$\n我们计算该张量的分量。速度分量中唯一非零的偏导数是 $\\frac{\\partial \\bar{u}_1}{\\partial x_2} = G$。所有其他导数，例如 $\\frac{\\partial \\bar{u}_1}{\\partial x_1}$、$\\frac{\\partial \\bar{u}_1}{\\partial x_3}$、$\\frac{\\partial \\bar{u}_2}{\\partial x_j}$ 和 $\\frac{\\partial \\bar{u}_3}{\\partial x_j}$，均为零。\n\n$\\bar{S}_{ij}$ 的对角分量为：\n$$\n\\bar{S}_{11} = \\frac{\\partial \\bar{u}_1}{\\partial x_1} = 0 \\\\\n\\bar{S}_{22} = \\frac{\\partial \\bar{u}_2}{\\partial x_2} = 0 \\\\\n\\bar{S}_{33} = \\frac{\\partial \\bar{u}_3}{\\partial x_3} = 0\n$$\n非对角分量为：\n$$\n\\bar{S}_{12} = \\bar{S}_{21} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_2} + \\frac{\\partial \\bar{u}_2}{\\partial x_1}\\right) = \\frac{1}{2}(G + 0) = \\frac{G}{2} \\\\\n\\bar{S}_{13} = \\bar{S}_{31} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_1}\\right) = \\frac{1}{2}(0 + 0) = 0 \\\\\n\\bar{S}_{23} = \\bar{S}_{32} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_2}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_2}\\right) = \\frac{1}{2}(0 + 0) = 0\n$$\n因此，滤波应变率张量的矩阵形式为：\n$$\n\\bar{S}_{ij} =\n\\begin{pmatrix}\n0  \\frac{G}{2}  0 \\\\\n\\frac{G}{2}  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\n滤波应变率张量的大小定义为 $|\\bar{S}| = (2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij})^{1/2}$，这里隐含了对重复指标的求和。\n首先，我们计算乘积 $\\bar{S}_{ij}\\,\\bar{S}_{ij}$：\n$$\n\\bar{S}_{ij}\\,\\bar{S}_{ij} = \\sum_{i=1}^3 \\sum_{j=1}^3 (\\bar{S}_{ij})^2 = (\\bar{S}_{12})^2 + (\\bar{S}_{21})^2 = \\left(\\frac{G}{2}\\right)^2 + \\left(\\frac{G}{2}\\right)^2 = \\frac{G^2}{4} + \\frac{G^2}{4} = \\frac{G^2}{2}\n$$\n现在，我们将此结果代入 $|\\bar{S}|$ 的定义中：\n$$\n|\\bar{S}| = \\left(2 \\cdot \\frac{G^2}{2}\\right)^{1/2} = \\left(G^2\\right)^{1/2} = |G|\n$$\n由于问题要求表达式仅用 $G$ 表示，且剪切率是一个可正可负的标量，最准确的形式是 $|G|$。\n\n**第二部分：Smagorinsky 封闭的分析**\n\n**常系数 Smagorinsky 模型的失效：**\n标准的 Smagorinsky 模型提出了一个由下式给出的涡粘性 $\\nu_t$：\n$$\n\\nu_t = (C_S \\Delta)^2 |\\bar{S}|\n$$\n其中 $C_S$ 是一个常数，$\\Delta$ 是滤波器宽度。偏 SGS 应力则被模型化为：\n$$\n\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij} = -2 \\nu_t \\bar{S}_{ij}\n$$\nSGS 动能耗散率为 $\\epsilon_{\\mathrm{SGS}} = -(\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij})\\bar{S}_{ij} = 2 \\nu_t \\bar{S}_{ij}\\bar{S}_{ij}$。\n对于给定的流动，我们得到 $|\\bar{S}| = |G|$。将此代入 $\\nu_t$ 的模型中：\n$$\n\\nu_t = (C_S \\Delta)^2 |G|\n$$\n由于在此公式中 $C_S$ 是一个非零常数，$\\Delta  0$，并且我们假设一个非平凡的剪切流 ($G \\neq 0$)，该模型预测了一个非零的涡粘性 $\\nu_t \\neq 0$。这又导致了非零的偏 SGS 应力和非零的 SGS 耗散率：\n$$\n\\epsilon_{\\mathrm{SGS}} = 2 \\left((C_S \\Delta)^2 |G|\\right) \\left(\\frac{G^2}{2}\\right) = (C_S \\Delta)^2 |G| G^2 = C_S^2 \\Delta^2 |G|^3\n$$\n其根本缺陷在于，原始流动被指定为*层流*。在层流中，没有湍流脉动，因此 SGS 应力张量必须为零。常系数 Smagorinsky 模型仅依赖于*已解析*应变率的大小 $|\\bar{S}|$。由于简单剪切流具有非零的平均应变率，该模型错误地预测了亚格子尺度湍流的存在，并从已解析的流场中虚假地移除了能量。该模型无法区分具有平均剪切的湍流和简单的层流剪切流。即使在网格细化时（$\\Delta \\to 0$），对于任何有限的 $\\Delta$，该模型都会预测虚假的耗散，尽管这种耗散在极限情况下确实正确地趋于零。\n\n**动态 Smagorinsky 程序的成功：**\n动态程序通过基于两个不同滤波尺度上的流动信息计算 $C_S$ 来弥补这一缺陷：网格滤波器（宽度为 $\\Delta$，用 $\\bar{\\cdot}$ 表示）和测试滤波器（宽度为 $\\hat{\\Delta}  \\Delta$，用 $\\tilde{\\cdot}$ 表示）。该程序源于 Germano 恒等式，它关联了这两个尺度上的应力：\n$$\nL_{ij} = T_{ij} - \\widetilde{\\tau_{ij}}\n$$\n其中 $L_{ij} = \\widetilde{\\bar{u}_i \\bar{u}_j} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ 是 Leonard 应力（可从已解析场 $\\bar{u}_i$ 计算），$T_{ij} = \\widetilde{\\overline{u_i u_j}} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ 是亚测试尺度应力，而 $\\tau_{ij} = \\overline{u_i u_j} - \\bar{u}_i \\bar{u}_j$ 是亚格子尺度应力。\n\n通过使用 Smagorinsky 封闭对 $\\tau_{ij}$ 和 $T_{ij}$ 的偏量部分进行建模，并假设 $C_S$ 在两个滤波层级之间是常数，可以得到关系式 $L_{ij}^{\\text{dev}} = C_S^2 M_{ij}$，其中 $L_{ij}^{\\text{dev}}$ 是 Leonard 应力张量的偏量部分，而 $M_{ij}$ 也是一个可以从滤波速度场计算出的张量：\n$$\nM_{ij} = 2\\Delta^2 \\widetilde{|\\bar{S}|\\bar{S}_{ij}} - 2\\hat{\\Delta}^2 |\\tilde{\\bar{S}}|\\tilde{\\bar{S}}_{ij}\n$$\n然后通过最小化此关系中的误差来求得 $C_S^2$，通常采用最小二乘法：$C_S^2 = \\frac{L_{ij}^{\\text{dev}} M_{ij}}{M_{kl} M_{kl}}$。\n\n我们来分析给定流动 $\\bar{u}_1 = Gx_2$ 的 $L_{ij}$ 和 $M_{ij}$。我们假设标准滤波器不会改变坐标的线性函数，因此 $\\tilde{\\bar{u}}_1 = \\widetilde{Gx_2} = Gx_2 = \\bar{u}_1$。然而，滤波确实会影响非线性项。\n乘积 $\\bar{u}_i \\bar{u}_j$ 中唯一的非零项是 $\\bar{u}_1\\bar{u}_1 = (Gx_2)^2$。对这个二次项应用测试滤波器，得到 $\\widetilde{(Gx_2)^2} = (Gx_2)^2 + C$，其中 $C$ 是一个取决于滤波器形状和宽度 $\\hat{\\Delta}$ 的常数（例如，对于一维盒式滤波器，$C = G^2\\hat{\\Delta}^2/12$）。\nLeonard 应力的分量为：\n$$\nL_{11} = \\widetilde{\\bar{u}_1 \\bar{u}_1} - \\tilde{\\bar{u}}_1 \\tilde{\\bar{u}}_1 = ((Gx_2)^2 + C) - (Gx_2)^2 = C\n$$\n所有其他分量 $L_{ij}$ 均为零，因为它们涉及像 $\\bar{u}_1\\bar{u}_2=0$ 这样的乘积。因此，$L_{ij}$ 是一个对角张量。因此，其偏量部分 $L_{ij}^{\\text{dev}} = L_{ij} - \\frac{1}{3}L_{kk}\\delta_{ij}$ 也是一个对角张量。\n\n现在，我们来分析 $M_{ij}$。由于 $\\tilde{\\bar{u}}_i = \\bar{u}_i$，应变率张量也相同：$\\tilde{\\bar{S}}_{ij} = \\bar{S}_{ij}$，其大小也相同：$|\\tilde{\\bar{S}}| = |\\bar{S}| = |G|$。项 $|\\bar{S}|\\bar{S}_{ij}$ 是一个常数张量场。对一个常数场进行滤波会得到其自身，所以 $\\widetilde{|\\bar{S}|\\bar{S}_{ij}} = |\\bar{S}|\\bar{S}_{ij}$。\n将这些代入 $M_{ij}$ 的表达式中：\n$$\nM_{ij} = (2\\Delta^2 - 2\\hat{\\Delta}^2)|\\bar{S}|\\bar{S}_{ij}\n$$\n这表明 $M_{ij}$ 与 $\\bar{S}_{ij}$ 成正比。正如我们在第一部分中发现的，$\\bar{S}_{ij}$ 是一个纯粹的非对角张量。\n\n最后，我们从分子 $L_{ij}^{\\text{dev}} M_{ij}$ 计算 $C_S^2$。这是一个对角张量 ($L_{ij}^{\\text{dev}}$) 和一个纯粹非对角张量 ($M_{ij}$) 的缩并积（内积）。这样的乘积恒为零：\n$$\nL_{ij}^{\\text{dev}} M_{ij} = \\sum_{i,j} L_{ij}^{\\text{dev}} M_{ij} = 0\n$$\n分母 $M_{kl}M_{kl}$ 与 $\\bar{S}_{kl}\\bar{S}_{kl} = G^2/2$ 成正比，该值非零。\n因此，动态计算出的系数为：\n$$\nC_S^2 = \\frac{0}{\\text{非零}} = 0\n$$\n动态程序正确地确定了对于此层流，模型系数必须为零，这又意味着 $\\nu_t = 0$，从而消除了虚假的 SGS 耗散。该模型正确地“自行关闭”。", "answer": "$$\n\\boxed{|G|}\n$$", "id": "3373067"}, {"introduction": "滤波尺度 $\\Delta$ 是 Smagorinsky 模型中的一个关键参数，但在实际模拟中其定义可能存在模糊性。这个实践性的编程练习 [@problem_id:3380543] 将深入探讨这种模糊性，通过对比两种常见的解释：计算网格的*隐式*滤波与人为施加的*显式*滤波。这将有助于你巩固理论概念如何转化为实际 CFD 代码的理解。", "problem": "你需要编写一个完整、可运行的程序，对于一个给定的二维解析速度场，比较由隐式滤波的二阶中心差分格式预测的亚格子尺度（SGS）应力，与经过显式高帽（箱式）滤波器后预测的亚格子尺度应力。两种情况都使用 Smagorinsky 亚格子尺度模型进行封闭。你的程序必须为每个测试用例计算一个标量，该标量用于量化两种 SGS 应力预测之间的差异，然后按照下文指定的格式，将所提供测试套件的所有标量在单行中输出。\n\n使用的基本依据和定义：\n- 从空间滤波的不可压缩 Navier-Stokes 方程和亚格子尺度应力张量的定义出发，其中偏应力部分由 Smagorinsky 涡粘性假设建模。通过引入与特征滤波宽度的平方和解析应变率张量的模成正比的涡粘性，来封闭偏 SGS 应力。\n- 解析速度场是不可压缩且光滑的，所有计算都在一个均匀的周期性网格上进行。\n\n数学设置：\n- 考虑一个边长为 $L = 2\\pi$ 的方形周期性域和一个包含 $N \\times N$ 个点的均匀网格，网格间距为 $\\Delta x = \\Delta y = L/N$。三角函数中的所有角度均以弧度为单位。\n- 定义一个标量流函数 $\\psi(x,y)$ 和一个不可压缩速度场 $\\boldsymbol{u} = (u,v) = \\left(\\frac{\\partial \\psi}{\\partial y}, -\\frac{\\partial \\psi}{\\partial x}\\right)$。使用解析流函数\n$$\n\\psi(x,y) = \\sin(k_x x)\\sin(k_y y),\n$$\n其中 $k_x$ 和 $k_y$ 是指定波数的整数。\n- 使用具有周期性边界条件的二阶中心差分公式计算空间导数。对于任意网格函数 $f$，其在 $x$ 方向的离散导数为\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_{i,j} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta x},\n$$\n其中索引在模 $N$ 的意义下理解；$y$ 方向同理。\n\n解析应变率张量：\n- 根据解析速度场，计算解析应变率张量 $S_{ij}$，\n$$\nS_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right),\n$$\n及其模\n$$\n\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}},\n$$\n其中重复指标表示对空间维度 $i,j \\in \\{x,y\\}$ 求和。\n\nSmagorinsky 亚格子尺度封闭：\n- 偏 SGS 应力被建模为\n$$\n\\tau^{\\mathrm{dev}}_{ij} = - 2 \\left(C_s \\Delta\\right)^2 \\lvert S \\rvert \\, S_{ij},\n$$\n其中 $C_s$ 是 Smagorinsky 常数，$\\Delta$ 是特征滤波宽度。为确保离散计算中张量是无迹的，应用 $d=2$ 的偏应力投影\n$$\n\\widetilde{\\tau}_{ij} = \\tau_{ij} - \\frac{1}{d} \\tau_{kk} \\, \\delta_{ij}, \\quad d=2,\n$$\n其中 $\\delta_{ij}$ 是克罗内克 δ 符号。\n\n两种待比较的滤波路径：\n- 隐式滤波：在网格上使用未经滤波的解析场和二阶中心差分导数来构建 $S_{ij}$，并将特征宽度设置为基于网格的尺度 $\\Delta_{\\mathrm{imp}} = \\sqrt{\\Delta x \\Delta y}$。\n- 显式滤波：首先对速度场的每个分量应用一个半径为整数 $r \\ge 0$ 的可分离、周期性二维高帽（箱式）滤波器，即一个 $(2r+1)\\times(2r+1)$ 的均匀平均。然后，根据经过显式滤波的速度计算导数、$S_{ij}$ 和 SGS 应力。在此路径中，将特征宽度设置为与显式滤波器宽度在二维中一致缩放的尺度\n$$\n\\Delta_{\\mathrm{exp}} = (2r+1) \\, \\sqrt{\\Delta x \\Delta y}。\n$$\n\n差异度量：\n- 设 $\\tau^{\\mathrm{imp}}_{ij}$ 和 $\\tau^{\\mathrm{exp}}_{ij}$ 分别表示沿隐式和显式路径计算的偏 SGS 张量。使用在网格上归一化的离散 Frobenius 范数来量化它们的差异，\n$$\nE = \\sqrt{\\frac{\\sum\\limits_{\\text{grid}} \\left[ \\left(\\Delta \\tau_{xx}\\right)^2 + \\left(\\Delta \\tau_{yy}\\right)^2 + 2 \\left(\\Delta \\tau_{xy}\\right)^2 \\right]}{\\sum\\limits_{\\text{grid}} \\left[ \\left(\\tau^{\\mathrm{imp}}_{xx}\\right)^2 + \\left(\\tau^{\\mathrm{imp}}_{yy}\\right)^2 + 2 \\left(\\tau^{\\mathrm{imp}}_{xy}\\right)^2 \\right]}},\n$$\n其中 $\\Delta \\tau_{ij} = \\tau^{\\mathrm{imp}}_{ij} - \\tau^{\\mathrm{exp}}_{ij}$。如果分母恰好为零，则定义 $E = 0$。\n\n所需的数值构造细节：\n- 通过将 $x \\in [0,L)$ 和 $y \\in [0,L)$ 离散化为 $x_i = i \\Delta x$，$y_j = j \\Delta y$（对于 $i,j \\in \\{0,1,\\dots,N-1\\}$）来构建解析场。\n- 将周期性中心差分和显式高帽滤波器实现为每个方向上的可分离周期性 $(2r+1)$ 点移动平均。\n- 对两种路径使用相同的二阶导数公式。\n\n测试套件：\n对于每个元组 $(N, C_s, r, k_x, k_y)$，计算并记录上面定义的标量 $E$。\n- 测试 1: $(N, C_s, r, k_x, k_y) = (64, 0.17, 0, 4, 3)$。\n- 测试 2: $(N, C_s, r, k_x, k_y) = (64, 0.17, 1, 4, 3)$。\n- 测试 3: $(N, C_s, r, k_x, k_y) = (64, 0.17, 2, 8, 8)$。\n- 测试 4: $(N, C_s, r, k_x, k_y) = (16, 0.10, 1, 2, 1)$。\n- 测试 5: $(N, C_s, r, k_x, k_y) = (32, 0.23, 3, 1, 5)$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含测试 1 到 5 的五个浮点数值 $E$，按顺序以逗号分隔的列表形式呈现，并用方括号括起来，不含空格。例如，一个有效的输出应类似于 $[e_1,e_2,e_3,e_4,e_5]$。不允许有其他任何输出。", "solution": "该问题是有效的，因为它在科学上基于计算流体动力学（CFD）的原理，特别是大涡模拟（LES），并且在数学上是适定且自洽的。所有必需的方程、参数和数值方法都得到了明确的定义。\n\n求解过程首先构建计算环境和给定的解析速度场。随后，它实现两种不同的滤波路径——隐式和显式——来计算亚格子尺度（SGS）应力张量。最后，它使用指定的误差度量来量化所得应力场之间的差异。\n\n**1. 网格和速度场的生成**\n模拟在一个边长为 $L=2\\pi$ 的二维方形周期性域上进行。该域被离散化为一个 $N \\times N$ 点的均匀网格。每个方向上的网格间距为 $\\Delta x = \\Delta y = L/N$。网格坐标由 $x_i = i \\Delta x$ 和 $y_j = j \\Delta y$ 给出，其中 $i, j \\in \\{0, 1, \\dots, N-1\\}$。\n\n不可压缩速度场 $\\boldsymbol{u} = (u,v)$ 由一个标量流函数 $\\psi(x,y)$ 导出。这种构造方式 $\\boldsymbol{u} = (\\partial_y \\psi, -\\partial_x \\psi)$ 解析地保证了速度场的散度为零，即 $\\nabla \\cdot \\boldsymbol{u} = 0$。指定的流函数为 $\\psi(x,y) = \\sin(k_x x)\\sin(k_y y)$，它产生以下速度分量：\n$$\nu(x,y) = \\frac{\\partial \\psi}{\\partial y} = k_y \\sin(k_x x)\\cos(k_y y)\n$$\n$$\nv(x,y) = -\\frac{\\partial \\psi}{\\partial x} = -k_x \\cos(k_x x)\\sin(k_y y)\n$$\n这些解析表达式在网格点 $(x_i, y_j)$ 上求值，以生成离散的解析速度场，作为所有后续计算的出发点。\n\n**2. 数值算子**\n需要两个核心的数值算子：一个导数近似和一个空间滤波器。\n\n- **周期性中心差分**：空间导数使用二阶精确的中心差分格式计算。对于一个通用网格函数 $f_{i,j}$，其偏导数近似为：\n$$\n\\frac{\\partial f}{\\partial x} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta x} \\quad \\text{和} \\quad \\frac{\\partial f}{\\partial y} \\approx \\frac{f_{i,j+1} - f_{i,j-1}}{2 \\Delta y}\n$$\n周期性通过实现模 $N$ 的索引移位来处理，这可以通过数组滚动操作高效地实现。\n\n- **周期性高帽（箱式）滤波器**：对于显式滤波路径，应用一个可分离的二维高帽滤波器。该滤波器将每个网格点的值替换为其在 $(2r+1) \\times (2r+1)$ 邻域内值的未加权平均值，其中 $r$ 是滤波器半径。此周期性滤波器使用 `scipy.ndimage.uniform_filter` 实现，并带有 `mode='wrap'` 选项，以正确处理周期性边界。\n\n**3. Smagorinsky SGS 应力计算**\n物理建模的核心在于使用 Smagorinsky 封闭计算偏 SGS 应力张量 $\\tau^{\\mathrm{dev}}_{ij}$。这个过程被封装在一个单独的函数中，该函数接收一个速度场和模型参数作为输入。\n\n- **步骤 1：应变率张量**：从一个给定的解析速度场 $(u_i)$，使用中心差分算子计算解析应变率张量 $S_{ij}$ 的分量：\n$$\nS_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right) \\quad \\Rightarrow \\quad S_{xx} = \\frac{\\partial u}{\\partial x}, \\quad S_{yy} = \\frac{\\partial v}{\\partial y}, \\quad S_{xy} = \\frac{1}{2}\\left(\\frac{\\partial u}{\\partial y} + \\frac{\\partial v}{\\partial x}\\right)\n$$\n- **步骤 2：应变率张量的模**：应变率张量的模 $\\lvert S \\rvert$ 按如下方式计算：\n$$\n\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}} = \\sqrt{2(S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2)}\n$$\n- **步骤 3：SGS 应力张量**：偏 SGS 应力被建模为与应变率成正比，$\\tau^{\\mathrm{dev}}_{ij} = -2 \\nu_{SGS} S_{ij}$，其中 $\\nu_{SGS}$ 是涡粘性。Smagorinsky 模型将涡粘性定义为：\n$$\n\\nu_{SGS} = (C_s \\Delta)^2 \\lvert S \\rvert\n$$\n这里，$C_s$ 是 Smagorinsky 常数，$\\Delta$ 是特征滤波宽度。这给出了初步的 SGS 应力张量分量，例如，$\\tau_{xx} = -2 \\nu_{SGS} S_{xx}$。\n- **步骤 4：偏应力投影**：尽管对于不可压缩流，解析应变率张量是无迹的（$S_{kk}=0$），但数值离散误差可能会引入一个非零的迹。为了严格强制无迹属性（$\\tau_{kk}=0$），对计算出的应力张量应用偏应力投影：\n$$\n\\widetilde{\\tau}_{ij} = \\tau_{ij} - \\frac{1}{d} \\tau_{kk} \\delta_{ij} \\quad (\\text{其中 } d=2)\n$$\n这确保了最终计算出的 SGS 应力张量是正确的偏应力张量。\n\n**4. 两种路径的实现**\n该问题要求比较由对滤波宽度 $\\Delta$ 的两种不同解释所产生的 SGS 应力张量。\n\n- **隐式路径**：此方法假设滤波操作由网格本身隐式执行。特征滤波宽度被设置为网格尺度，$\\Delta_{\\mathrm{imp}} = \\sqrt{\\Delta x \\Delta y}$。SGS 应力计算直接应用于原始的、未经滤波的速度场。\n\n- **显式路径**：此方法在建模前涉及一个显式的滤波步骤。速度场分量 $(u,v)$ 首先使用 $(2r+1)\\times(2r+1)$ 箱式滤波器进行平滑处理。然后将特征滤波宽度设置为与此显式滤波器尺寸一致的尺度，$\\Delta_{\\mathrm{exp}} = (2r+1) \\sqrt{\\Delta x \\Delta y}$。然后，使用 $\\Delta_{\\mathrm{exp}}$ 对这个预先滤波的速度场执行 SGS 应力计算。\n\n**5. 差异度量**\n两个 SGS 应力张量 $\\tau^{\\mathrm{imp}}_{ij}$ 和 $\\tau^{\\mathrm{exp}}_{ij}$ 之间的差异由它们差值的归一化 Frobenius 范数量化，并在所有网格点上求和：\n$$\nE = \\sqrt{\\frac{\\sum_{\\text{grid}} \\lVert \\tau^{\\mathrm{imp}} - \\tau^{\\mathrm{exp}} \\rVert_F^2}{\\sum_{\\text{grid}} \\lVert \\tau^{\\mathrm{imp}} \\rVert_F^2}} = \\sqrt{\\frac{\\sum\\limits_{\\text{grid}} \\left[ (\\Delta \\tau_{xx})^2 + (\\Delta \\tau_{yy})^2 + 2 (\\Delta \\tau_{xy})^2 \\right]}{\\sum\\limits_{\\text{grid}} \\left[ (\\tau^{\\mathrm{imp}}_{xx})^2 + (\\tau^{\\mathrm{imp}}_{yy})^2 + 2 (\\tau^{\\mathrm{imp}}_{xy})^2 \\right]}}\n$$\n其中 $\\Delta \\tau_{ij} = \\tau^{\\mathrm{imp}}_{ij} - \\tau^{\\mathrm{exp}}_{ij}$。如果分母为零（即，隐式应力场恒等于零），则误差 $E$ 定义为 $0$。\n\n对问题陈述中指定的每个测试用例执行上述流程，并将得到的标量值 $E$ 收集并格式化为最终输出。对于滤波器半径 $r=0$ 的特殊情况，显式滤波器是一个单位操作，且滤波宽度相等（$\\Delta_{\\mathrm{exp}} = \\Delta_{\\mathrm{imp}}$），这导致预期误差为 $E=0$，可作为一个有价值的内部一致性检验。", "answer": "```python\nimport numpy as np\nfrom scipy.ndimage import uniform_filter\n\ndef solve():\n    \"\"\"\n    Main function to compute and compare SGS stress predictions for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # (N, Cs, r, kx, ky)\n        (64, 0.17, 0, 4, 3),\n        (64, 0.17, 1, 4, 3),\n        (64, 0.17, 2, 8, 8),\n        (16, 0.10, 1, 2, 1),\n        (32, 0.23, 3, 1, 5),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, Cs, r, kx, ky = case\n        \n        # 1. Grid and Field Setup\n        L = 2.0 * np.pi\n        dx = dy = L / N\n        x = np.linspace(0, L - dx, N)\n        y = np.linspace(0, L - dy, N)\n        X, Y = np.meshgrid(x, y)\n        \n        # Analytical velocity field from streamfunction\n        u_initial = ky * np.sin(kx * X) * np.cos(ky * Y)\n        v_initial = -kx * np.cos(kx * X) * np.sin(ky * Y)\n\n        # 2. Implicit Pathway\n        Delta_imp = np.sqrt(dx * dy)\n        tau_imp_xx, tau_imp_yy, tau_imp_xy = calculate_sgs_stress(\n            u_initial, v_initial, dx, dy, Cs, Delta_imp\n        )\n        \n        # 3. Explicit Pathway\n        u_filtered = box_filter(u_initial, r)\n        v_filtered = box_filter(v_initial, r)\n        \n        Delta_exp = (2 * r + 1) * np.sqrt(dx * dy)\n        tau_exp_xx, tau_exp_yy, tau_exp_xy = calculate_sgs_stress(\n            u_filtered, v_filtered, dx, dy, Cs, Delta_exp\n        )\n\n        # 4. Difference Metric Calculation\n        d_tau_xx = tau_imp_xx - tau_exp_xx\n        d_tau_yy = tau_imp_yy - tau_exp_yy\n        d_tau_xy = tau_imp_xy - tau_exp_xy\n        \n        numerator = np.sum(d_tau_xx**2 + d_tau_yy**2 + 2 * d_tau_xy**2)\n        denominator = np.sum(tau_imp_xx**2 + tau_imp_yy**2 + 2 * tau_imp_xy**2)\n        \n        if denominator == 0.0:\n            E = 0.0\n        else:\n            E = np.sqrt(numerator / denominator)\n            \n        results.append(E)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef periodic_central_difference(f, delta):\n    \"\"\"\n    Computes partial derivatives using 2nd-order periodic central differences.\n    \"\"\"\n    df_dx = (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * delta)\n    df_dy = (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * delta)\n    return df_dx, df_dy\n\ndef box_filter(f, r):\n    \"\"\"\n    Applies a separable, periodic 2D top-hat (box) filter of radius r.\n    \"\"\"\n    if r == 0:\n        return f.copy()\n    width = 2 * r + 1\n    return uniform_filter(f, size=width, mode='wrap')\n\ndef calculate_sgs_stress(u, v, dx, dy, Cs, Delta_filter):\n    \"\"\"\n    Computes the deviatoric Smagorinsky SGS stress tensor for a given velocity field.\n    \"\"\"\n    du_dx, du_dy = periodic_central_difference(u, dx)\n    dv_dx, dv_dy = periodic_central_difference(v, dy)\n\n    S_xx = du_dx\n    S_yy = dv_dy\n    S_xy = 0.5 * (du_dy + dv_dx)\n\n    S_mag = np.sqrt(2 * (S_xx**2 + S_yy**2 + 2 * S_xy**2))\n\n    nu_sgs = (Cs * Delta_filter)**2 * S_mag\n\n    tau_xx_raw = -2 * nu_sgs * S_xx\n    tau_yy_raw = -2 * nu_sgs * S_yy\n    tau_xy_raw = -2 * nu_sgs * S_xy\n\n    trace_tau = tau_xx_raw + tau_yy_raw\n    tau_xx = tau_xx_raw - 0.5 * trace_tau\n    tau_yy = tau_yy_raw - 0.5 * trace_tau\n    tau_xy = tau_xy_raw\n    \n    return tau_xx, tau_yy, tau_xy\n\nsolve()\n```", "id": "3380543"}]}