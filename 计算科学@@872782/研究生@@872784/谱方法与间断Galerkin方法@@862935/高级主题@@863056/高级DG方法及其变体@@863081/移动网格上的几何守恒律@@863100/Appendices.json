{"hands_on_practices": [{"introduction": "几何守恒律 (GCL) 的离散实现远不止是应用一个公式，而是要求数值格式的多个组成部分——包括度量计算、几何通量和时间推进——必须协同工作。为了在移动网格上精确地保持自由流状态，这些部分之间的代数结构必须兼容，以确保由网格运动引起的数值源项能够精确抵消。这项练习将挑战您从第一性原理出发，将这些分散的概念整合成一个完整的算法清单，从而深入理解构建一个满足离散GCL的健壮DGSEM求解器的关键要求 [@problem_id:3389196]。", "problem": "一个现有的在静止曲线六面体网格上的间断 Galerkin 谱元法 (DGSEM) 代码，采用张量积 Legendre–Gauss–Lobatto 配置，分部求和 (SBP) 导数算子，以及分裂形式的两点数值通量，用于求解固定物理域上以散度形式写出的守恒律。该代码将通过任意拉格朗日-欧拉 (ALE) 映射扩展到移动网格。考虑一个在移动物理域中的守恒律，通过一个光滑、可逆的映射 $\\mathbf{x}(\\boldsymbol{\\xi},t)$ 映射到一个固定的参考域。该映射的雅可比行列式为 $J(\\boldsymbol{\\xi},t)$，对于每个参考坐标 $\\xi_i$，其逆变基向量由 $J \\mathbf{a}^i(\\boldsymbol{\\xi},t)$ 编码，网格速度为 $\\mathbf{w}(\\boldsymbol{\\xi},t) = \\partial_t \\mathbf{x}(\\boldsymbol{\\xi},t)$。静止网格代码能以机器精度保持恒定的自由流状态。对移动网格的扩展必须满足离散几何守恒律，以保持自由流的特性。\n\n从第一性原理出发，从物理坐标和参考坐标之间的变量变换、链式法则和守恒形式开始，论证在 DGSEM 离散化下，当网格运动时，要使一个恒定状态在时间上保持恒定，半离散层面需要具备哪些充分必要的代数结构。特别是，要论证度量项的计算、网格运动引起的几何通量的处理以及几何和解的时间更新同步之间所需的耦合关系。\n\n假设数据光滑且算术精确，以下哪个算法清单足以确保扩展后的 DGSEM 在移动网格上以机器精度满足离散几何守恒律？\n\nA. \n- 步骤 1：将 $\\mathbf{x}(\\boldsymbol{\\xi},t)$ 表示在与解相同的节点多项式空间中。在每个 Runge–Kutta 阶段，通过使用与体离散化中相同的 SBP 导数矩阵的离散旋度形式，在所有体和面节点上计算 $J \\mathbf{a}^i$，从而满足离散度量恒等式。通过从阶段几何构建面法线和表面雅可比行列式，并在相邻单元之间共享它们，来强制执行单值面度量。\n- 步骤 2：通过将物理项和带有网格速度 $\\mathbf{w}$ 的几何项相结合，形成每个坐标方向上的 ALE 逆变通量，并使用与静止格式相同的分裂形式通量差分和相同的两点对称数值通量对两者进行离散化。特别地，在相同的节点上评估几何通量因子 $G^i = J \\mathbf{a}^i \\cdot \\mathbf{w}$，并对面通量使用单值。\n- 步骤 3：通过与解的时间积分器一致地推进几何，具体方法是使用与解相同的 Runge–Kutta 阶段积分离散几何守恒律 $\\partial_t J + \\sum_i D_i G^i = 0$，或者等效地，在每个阶段从阶段几何评估 $J$、$J \\mathbf{a}^i$ 和 $G^i$。从相同的阶段几何计算面面积度量和法线。\n- 步骤 4：对几何和解使用相同的求积和插值算子，以便静止代码中调用的 SBP 恒等式对于移动网格项保持不变。如果使用过积分，则将其一致地应用于物理和几何贡献。\n- 步骤 5：通过初始化一个恒定状态和一个随时间变化的光滑映射，并确认机器精度的不变性，来数值验证自由流保持性。\n\nB.\n- 步骤 1：在每个时间步的 $t^n$ 时刻，通过直接节点微分和叉积计算一次 $J$ 和 $J \\mathbf{a}^i$，在所有 Runge–Kutta 阶段中保持它们固定，只允许网格速度 $\\mathbf{w}$ 随阶段变化。\n- 步骤 2：对物理通量使用 $2N-1$ 次求积，对几何通量使用 $N$ 次求积，并在每个单元侧独立计算面几何项。对几何项应用迎风数值通量以增强稳定性。\n- 步骤 3：不求解或强制执行 $J$ 的离散方程；依赖于变换后通量中的几何项来解释网格运动，并且仅在每个时间步更新一次面度量。\n- 步骤 4：仅验证静止自由流保持性；不强制执行移动网格的自由流保持性。\n\nC.\n- 步骤 1：在 $t^n$ 时刻使用离散旋度形式计算 $J \\mathbf{a}^i$ 以在初始时满足离散度量恒等式，但在整个时间步内保持这些度量冻结；在每个 Runge–Kutta 阶段根据阶段几何重新计算 $\\mathbf{w}$。\n- 步骤 2：使用相同的两点数值通量组合物理和几何通量，但将几何量置于 Gauss 节点上，解置于 Legendre–Gauss–Lobatto 节点上，在每次评估时通过插值在它们之间转换。\n- 步骤 3：通过设置 $J^{n+1} = J^n$ 在步长内保持 $J$ 固定，假设网格映射在平均意义上近似保体积，并且仅在步长结束时更新面面积。\n\nD.\n- 步骤 1：在每个 Runge–Kutta 阶段，使用相同的导数矩阵通过在节点上进行直接微分和叉积来计算 $J \\mathbf{a}^i$，并通过平均左右重构来强制执行单值面法线。\n- 步骤 2：为物理项和涉及 $u$ 与网格速度因子 $G^i$ 的几何贡献分别形成中心两点数值通量，并对两者使用相同的节点。\n- 步骤 3：仅在时间步结束时从映射重新计算 $J$，并且不在 Runge–Kutta 阶段内积分 $J$ 的离散几何守恒律。\n- 步骤 4：仅对物理通量进行过积分以消除混叠，同时保持几何通量在节点求积以降低成本。\n\n选择正确的选项，并根据 ALE 映射下的守恒结构以及 DGSEM 中离散几何守恒律的要求来证明你的选择。", "solution": "任务是确定一组充分的算法条件，以确保间断 Galerkin 谱元法 (DGSEM) 在移动网格上满足离散几何守恒律 (GCL)，从而保持恒定的自由流状态。\n\n### 第一性原理推导\n\n让我们从物理域 $(\\mathbf{x}, t)$ 中的一个一般守恒律开始：\n$$\n\\frac{\\partial u}{\\partial t} + \\nabla_{\\mathbf{x}} \\cdot \\mathbf{f}(u) = 0\n$$\n其中 $u$ 是守恒变量的向量，$\\mathbf{f}(u)$ 是物理通量张量。\n\n我们引入一个从固定参考域 $\\boldsymbol{\\xi}$ 到移动物理域 $\\mathbf{x}$ 的任意拉格朗日-欧拉 (ALE) 映射：\n$$\n\\mathbf{x} = \\mathbf{x}(\\boldsymbol{\\xi}, t)\n$$\n网格速度定义为具有固定参考坐标的点的速度：\n$$\n\\mathbf{w}(\\boldsymbol{\\xi}, t) = \\left. \\frac{\\partial \\mathbf{x}}{\\partial t} \\right|_{\\boldsymbol{\\xi}}\n$$\n为了将守恒律变换到参考域，我们需要映射的雅可比行列式 $J = \\det(\\nabla_{\\boldsymbol{\\xi}} \\mathbf{x})$，以及未缩放的逆变基向量 $\\mathbf{a}^i$，它们是 $(\\nabla_{\\boldsymbol{\\xi}}\\mathbf{x})^{-T}$ 的列向量。本问题使用缩放后的逆变向量 $\\mathbf{A}^i = J\\mathbf{a}^i$。\n\n散度项的变换由 Piola 恒等式给出：\n$$\nJ \\nabla_{\\mathbf{x}} \\cdot \\mathbf{v} = \\nabla_{\\boldsymbol{\\xi}} \\cdot (J (\\nabla_{\\boldsymbol{\\xi}}\\mathbf{x})^{-T} \\mathbf{v}) = \\sum_i \\frac{\\partial}{\\partial \\xi_i} (\\mathbf{A}^i \\cdot \\mathbf{v})\n$$\n将此应用于通量 $\\mathbf{f}(u)$，我们得到变换后的逆变物理通量 $\\tilde{f}_i = \\mathbf{A}^i \\cdot \\mathbf{f}(u)$。\n\n在固定物理坐标和固定参考坐标处的时间导数之间的关系由函数 $\\phi(\\mathbf{x}(\\boldsymbol{\\xi},t), t)$ 的链式法则给出：\n$$\n\\left. \\frac{\\partial \\phi}{\\partial t} \\right|_{\\boldsymbol{\\xi}} = \\left. \\frac{\\partial \\phi}{\\partial t} \\right|_{\\mathbf{x}} + (\\nabla_{\\mathbf{x}}\\phi) \\cdot \\left. \\frac{\\partial \\mathbf{x}}{\\partial t} \\right|_{\\boldsymbol{\\xi}} \\implies \\left. \\frac{\\partial \\phi}{\\partial t} \\right|_{\\mathbf{x}} = \\left. \\frac{\\partial \\phi}{\\partial t} \\right|_{\\boldsymbol{\\xi}} - \\mathbf{w} \\cdot \\nabla_{\\mathbf{x}}\\phi\n$$\n将 $\\partial_t u$ 代入原始偏微分方程并乘以 $J$ 会得到一个非守恒形式。为了在参考域中获得守恒形式，我们从积分形式开始并应用雷诺输运定理，或者等效地，使用连续 GCL。GCL 将参考单元体积的变化与其边界的运动联系起来：\n$$\n\\frac{\\partial J}{\\partial t} - \\nabla_{\\boldsymbol{\\xi}} \\cdot (J \\mathbf{w} \\cdot (\\nabla_{\\boldsymbol{\\xi}}\\mathbf{x})^{-T}) = 0 \\quad \\text{或} \\quad \\frac{\\partial J}{\\partial t} - \\sum_i \\frac{\\partial}{\\partial \\xi_i} (\\mathbf{A}^i \\cdot \\mathbf{w}) = 0\n$$\n让我们将几何通量因子定义为 $G^i = \\mathbf{A}^i \\cdot \\mathbf{w}$。那么 GCL 就是 $\\partial_t J - \\nabla_{\\boldsymbol{\\xi}} \\cdot \\mathbf{G} = 0$，其中 $\\mathbf{G}$ 是分量为 $G^i$ 的向量。\n\n使用 GCL，原始守恒律可以变换为参考域上的以下守恒形式：\n$$\n\\frac{\\partial (Ju)}{\\partial t} + \\sum_i \\frac{\\partial}{\\partial \\xi_i} (\\tilde{f}_i(u) - u G^i) = 0\n$$\n这就是 ALE 守恒律。在方向 $i$ 上的总逆变通量是 $H^i = \\tilde{f}_i(u) - u G^i$。\n\n### 自由流保持\n\nGCL 的主要目标是确保均匀流（自由流）保持均匀。设 $u(\\mathbf{x}, t) = u_c = \\text{const}$。在这种情况下，物理通量 $\\mathbf{f}(u_c)$ 也是一个常数向量。\n将 $u = u_c$ 代入 ALE 方程：\n$$\n\\frac{\\partial (J u_c)}{\\partial t} + \\sum_i \\frac{\\partial}{\\partial \\xi_i} (\\mathbf{A}^i \\cdot \\mathbf{f}(u_c) - u_c G^i) = 0\n$$\n$$\nu_c \\frac{\\partial J}{\\partial t} + \\sum_i \\frac{\\partial}{\\partial \\xi_i} (\\mathbf{A}^i \\cdot \\mathbf{f}(u_c)) - u_c \\sum_i \\frac{\\partial G^i}{\\partial \\xi_i} = 0\n$$\n由于 $\\mathbf{f}(u_c)$ 是一个常数向量，第二项是 $\\mathbf{f}(u_c) \\cdot \\left(\\sum_i \\frac{\\partial \\mathbf{A}^i}{\\partial \\xi_i}\\right)$。微分几何的一个基本恒等式表明，由于 $\\mathbf{A}^i$ 是从映射 $\\mathbf{x}(\\boldsymbol{\\xi})$ 的导数推导出来的，这个和为零：$\\sum_i \\frac{\\partial \\mathbf{A}^i}{\\partial \\xi_i} = 0$。这通常被称为“度量恒等式”。\n自由流的方程简化为：\n$$\nu_c \\frac{\\partial J}{\\partial t} - u_c \\sum_i \\frac{\\partial G^i}{\\partial \\xi_i} = 0 \\quad \\implies \\quad u_c \\left(\\frac{\\partial J}{\\partial t} - \\nabla_{\\boldsymbol{\\xi}} \\cdot \\mathbf{G} \\right) = 0\n$$\n这表明，如果 GCL ($\\partial_t J - \\nabla_{\\boldsymbol{\\xi}} \\cdot \\mathbf{G} = 0$) 和度量恒等式 ($\\nabla_{\\boldsymbol{\\xi}} \\cdot \\tilde{\\mathbf{f}}_c = 0$) 成立，则恒定状态保持恒定。\n\n### DGSEM 的离散要求\n\n为了使 DGSEM 在移动网格上保持自由流，这两个条件的离散模拟必须以机器精度得到满足。设离散空间算子为 $\\text{Div}_h$。\n半离散方程为 $\\frac{d(J_h u_h)}{dt} + \\text{Div}_h(\\mathbf{H}_h) = 0$。对于 $u_h = u_c$：\n$$\nu_c \\frac{d J_h}{dt} + \\text{Div}_h(\\tilde{\\mathbf{f}}_{h,c} - u_c \\mathbf{G}_h) = u_c \\frac{d J_h}{dt} + \\text{Div}_h(\\tilde{\\mathbf{f}}_{h,c}) - u_c \\text{Div}_h(\\mathbf{G}_h)\n$$\n为了使上式为零，我们需要：\n1.  **离散度量恒等式**：$\\text{Div}_h(\\tilde{\\mathbf{f}}_{h,c}) = 0$。对于带有 SBP 算子的 DGSEM，如果度量项 $\\mathbf{A}^i_h$ 是使用一种公式（例如，“离散旋度形式”）计算的，该公式使用与散度算子本身*相同*的 SBP 导数矩阵，则可以实现此目标。这与对称数值通量和单值面度量相结合，确保了恒定向量场的离散散度为零。\n2.  **离散几何守恒律 (DGCL)**：$\\frac{d J_h}{dt} - \\text{Div}_h(\\mathbf{G}_h) = 0$。这要求几何的时间积分与解的时间积分之间存在紧密耦合。项 $J_h$、$\\mathbf{A}^i_h$ 和 $\\mathbf{w}_h$（它们构成 $\\mathbf{G}_h$）必须在时间积分方案（例如 Runge-Kutta）的每个阶段进行更新。这可以通过使用相同的方案显式积分 $J_h$ 的 DGCL 方程来实现，或者更稳健地，通过在每个阶段时间直接从网格坐标 $\\mathbf{x}_h$ 重新计算所有几何量（$J_h$、$\\mathbf{A}^i_h$、$\\mathbf{G}_h$）。这要求将几何 $\\mathbf{x}_h$ 表示在与解 $u_h$ 相同的多项式空间中。\n\n此外，总通量 $\\mathbf{H}_h = \\tilde{\\mathbf{f}}_h - u_h \\mathbf{G}_h$ 的所有部分必须由空间离散化同等对待。这意味着使用相同的求积法则、相同的多项式基，并对组合的 ALE 通量应用相同的数值通量方案。\n\n### 选项评估\n\n**A. 此选项正确列出了满足 DGCL 的有效方案所需的所有必要组件：**\n- **步骤 1**: 它要求将几何表示在与解相同的多项式空间中。它正确地指出，通过使用与 SBP 导数矩阵相同的离散旋度形式，可以满足离散度量恒等式。它还正确地要求了单值面度量。\n- **步骤 2**: 它正确地要求将物理和几何通量分量组合起来，并使用*相同*的分裂形式通量差分和数值通量进行离散化，确保了一致的处理，从而保留了代数抵消特性。\n- **步骤 3**: 它正确地描述了在时间上满足 DGCL 的两种有效且等价的方法：要么使用与解相同的 RK 方案显式积分 GCL 以求解 $J$，要么在每个阶段根据阶段几何重新计算所有几何项。这确保了所需的紧密耦合。\n- **步骤 4**: 它强调了对所有项使用一致的算子（求积、插值）的必要性，这是 SBP 属性和 DGCL 的基础。\n- **步骤 5**: 这是一个正确的验证过程。\n这个清单是对一个先进的保持自由流的 ALE-DGSEM 的精确和充分的描述。**正确**。\n\n**B. 此选项存在根本性缺陷：**\n- **步骤 1**: 在整个时间步内冻结度量项（$J$, $J\\mathbf{a}^i$），仅在阶段内改变网格速度 $\\mathbf{w}$，是一种“松耦合”方法。它违反了 DGCL，因为雅可比行列式 $J$ 的时间导数将与几何通量 $\\mathbf{G}$ 的散度不一致。\n- **步骤 2**: 对物理和几何通量使用不同的求积法则是前后矛盾的，并且破坏了 SBP 属性。对几何项使用不同的数值通量（迎风格式）也破坏了保持自由流所需的抵消特性，因为数值通量必须应用于总的 ALE 通量 $H^i$。\n- **步骤 3 & 4**: 明确指出不强制执行 GCL 且移动网格自由流保持不是目标，这证实了该方法是错误的。\n**不正确**。\n\n**C. 此选项也存在根本性缺陷：**\n- **步骤 1**: 如在 B 中所证，在一个时间步内冻结度量是不正确的。\n- **步骤 2**: 对几何和解使用不同的节点集（Gauss vs. LGL）并在它们之间进行插值，完全破坏了 DGSEM 的配置结构和 SBP 算子的代数属性。所有量必须表示在相同的节点网格上。\n- **步骤 3**: 假设 $J$ 是常数是一个严重且通常是错误的简化，这根据定义就违反了 GCL。\n**不正确**。\n\n**D. 此选项包含关键错误：**\n- **步骤 1**: 虽然在每个阶段计算度量是正确的，但其余部分存在缺陷。\n- **步骤 2**: 为物理项和几何项分别形成数值通量是不正确的。数值通量必须应用于总的 ALE 通量 $H^i = \\tilde{f}_i - u G^i$ 以确保正确的非线性相互作用和保持属性。\n- **步骤 3**: 仅在时间步结束时重新计算 $J$ 是一种松耦合形式，违反了 DGCL。在每个 RK 阶段的半离散方程中使用的 $J$ 值必须与该阶段的几何形状一致。\n- **步骤 4**: 对物理和几何部分使用不同的积分法是一种不一致的离散化方法，将无法保持自由流。\n**不正确**。\n\n基于从第一性原理的严格推导，选项 A 提供了一个完整且正确的程序清单，足以确保离散几何守恒律以机器精度得到满足。", "answer": "$$\\boxed{A}$$", "id": "3389196"}, {"introduction": "在高阶谱元或DG方法中，一个核心的设计决策是为解和几何（即网格坐标）选择合适的函数空间。直觉上，几何表示的精度应该与解的精度相匹配，但几何守恒律（GCL）对此提出了更严格的要求。这项练习将引导您通过多项式次数分析，揭示解的多项式次数 $p$ 与几何映射的多项式次数 $p_m$ 之间为满足离散GCL所必须遵循的精确关系 [@problem_id:3389214]。理解这一约束对于在 $hp$ 自适应模拟中正确处理移动和变形单元至关重要，以避免因几何近似不足而引入虚假的数值误差。", "problem": "考虑一个从参考单元 $\\xi \\in [-1,1]$ 到物理单元的一维任意拉格朗日-欧拉（ALE）映射 $x(\\xi,t)$，其中 $x(\\xi,t)$ 在每个单元上由一个关于 $\\xi$ 的 $p_{m}$ 次多项式表示，该次数 $p_{m}$ 在不同单元上可以变化。解采用间断伽辽金（DG）谱元法进行离散化，使用勒让德-高斯-洛巴托（LGL）节点上的 $p$ 次拉格朗日插值多项式，并使用相同节点上的配置求积。关于 $\\xi$ 的微分由与 $p$ 次LGL基相关的节点微分矩阵 $D_{p}$ 执行，该矩阵能为任何次数至多为 $p$ 的多项式再生精确导数。体积分使用LGL求积，该求积对次数最高为 $2p-1$ 的多项式是精确的。几何项通过使用相同的算子 $D_{p}$ 微分插值函数 $x(\\xi,t)$ 来计算，因此雅可比 $J(\\xi,t)$ 和网格速度 $w(\\xi,t)$ 近似为 $J \\approx D_{p} x$ 和 $w \\approx \\partial x/\\partial t$，它们关于 $\\xi$ 的导数则近似为 $D_{p} J$ 和 $D_{p} w$。\n\n一维连续几何守恒律（GCL）要求在网格运动下保持均匀自由流，这通过在连续层面上强制执行恒等式 $\\partial J/\\partial t = \\partial w/\\partial \\xi$ 来实现。在上述离散DG配置格式中，如果对于任何空间上为常数的场，当在离散弱形式中使用离散几何恒等式 $D_{p} w = \\partial J/\\partial t$ 并用LGL求积进行积分时，DG残差完全为零，则称离散GCL在该单元上成立。\n\n假设 $x(\\xi,t)$ 是一个关于 $\\xi$ 的 $p_{m}$ 次多项式，因此 $J(\\xi,t) = \\partial x/\\partial \\xi$ 的次数为 $p_{m}-1$，$w(\\xi,t) = \\partial x/\\partial t$ 关于 $\\xi$ 的次数为 $p_{m}$。在所述的DG配置和度量计算程序下，确定使得离散GCL在每个单元上都精确成立的最大映射多项式次数 $p_{m}$（表示为 $p$ 的函数），无论网格上 $p_{m}$ 是否非均匀。以单一闭式符号表达式 $p_{m}^{\\max}(p)$ 的形式给出最终答案，不带单位，也无附加限定词。", "solution": "问题要求在一个间断伽辽金（DG）谱元框架中，确定使得离散几何守恒律（GCL）精确满足的一维多项式坐标映射 $x(\\xi,t)$ 的最大次数 $p_m$。\n\n我们首先将离散GCL成立的条件形式化。在参考单元 $\\xi \\in [-1, 1]$ 上的任意拉格朗日-欧拉（ALE）框架中，一个普遍的守恒律可以表示为：\n$$\n\\frac{\\partial (Ju)}{\\partial t} + \\frac{\\partial (F(u) - wu)}{\\partial \\xi} = 0\n$$\n其中 $u$ 是守恒变量，$F(u)$ 是参考系中的物理通量，$J(\\xi,t) = \\partial x/\\partial \\xi$ 是映射 $x(\\xi,t)$ 的雅可比，$w(\\xi,t) = \\partial x/\\partial t$ 是网格速度。\n\nGCL是关于保持常数状态（或均匀流）的陈述。设解在空间上为常数，$u(\\xi,t) = U_0$，其中 $U_0$ 可能依赖于时间。物理通量 $F(U_0)$ 在空间上也为常数。守恒律简化为：\n$$\n\\frac{\\partial (J U_0)}{\\partial t} - \\frac{\\partial (w U_0)}{\\partial \\xi} = 0\n$$\n展开导数，我们得到：\n$$\nJ \\frac{\\partial U_0}{\\partial t} + U_0 \\frac{\\partial J}{\\partial t} - w \\frac{\\partial U_0}{\\partial \\xi} - U_0 \\frac{\\partial w}{\\partial \\xi} = 0\n$$\n由于 $U_0$ 在空间上是常数，因此 $\\partial U_0 / \\partial \\xi = 0$。如果我们考虑一个 $U_0$ 在时间上也为常数的定常自由流，方程简化为：\n$$\nU_0 \\left( \\frac{\\partial J}{\\partial t} - \\frac{\\partial w}{\\partial \\xi} \\right) = 0\n$$\n这表明连续GCL，即 $\\partial J/\\partial t = \\partial w/\\partial \\xi$，是保持常数状态所需的条件。\n\n在指定的DG格式中，解由属于空间 $P_p(\\xi)$ 的一个 $p$ 次多项式 $u_h(\\xi,t)$ 表示。守恒律的弱形式是通过乘以一个测试函数 $\\phi_h \\in P_p(\\xi)$ 并在单元上积分来创建的。对于常数状态 $u_h = U_0$，要使GCL成立，DG残差的体积分部分必须为零，该部分正比于：\n$$\nR_{vol} = \\int_{-1}^{1} \\phi_h(\\xi) \\left( \\frac{\\partial J_h}{\\partial t} - \\frac{\\partial w_h}{\\partial \\xi} \\right) d\\xi = 0\n$$\n其中 $J_h$ 和 $w_h$ 分别是多项式空间 $P_p(\\xi)$ 内雅可比和网格速度的离散近似。\n\n这个积分可以使用分部积分重写：\n$$\n\\int_{-1}^{1} \\left( \\phi_h(\\xi) \\frac{\\partial J_h}{\\partial t} + \\frac{\\partial \\phi_h(\\xi)}{\\partial \\xi} w_h(\\xi) \\right) d\\xi - \\left[ \\phi_h(\\xi) w_h(\\xi) \\right]_{-1}^{1} = 0\n$$\n在完整的DG格式中，边界项由数值通量处理。GCL是关于体积分的条件。因此，我们要求积分项为零。\n问题指出，该积分使用具有 $p+1$ 个节点 $\\{\\xi_k\\}_{k=0}^p$ 的勒让德-高斯-洛巴托（LGL）求积进行计算。使用LGL配置的DG方法的一个关键特性是，弱形式残差为零的要求等价于方程的强形式在配置节点处得到满足。这是因为质量矩阵是对角的（“集中的”），并且我们可以选择测试函数 $\\phi_h$ 为满足 $l_j(\\xi_k) = \\delta_{jk}$ 的拉格朗日基多项式 $l_j(\\xi)$。因此，GCL成立的充分必要条件是强形式的被积函数在每个节点处都为零：\n$$\n\\left( \\frac{\\partial J_h}{\\partial t} \\right)(\\xi_k) - \\left( \\frac{\\partial w_h}{\\partial \\xi} \\right)(\\xi_k) = 0 \\quad \\text{for } k = 0, 1, \\dots, p\n$$\n\n现在，我们必须根据问题描述来定义离散量 $J_h$ 和 $w_h$。真实映射 $x(\\xi,t)$ 是一个 $p_m$ 次多项式。真实雅可比 $J = \\partial x/\\partial\\xi$ 是一个 $p_m-1$ 次多项式，真实网格速度 $w = \\partial x/\\partial t$ 是一个 $p_m$ 次多项式。\n\n离散场 $J_h$ 和 $w_h$ 是在 $p+1$ 个LGL节点上插值真实场的、次数至多为 $p$ 的唯一多项式。我们用 $I_p[\\cdot]$ 表示该插值算子。因此，$J_h = I_p[J]$ 且 $w_h = I_p[w]$。\n\n我们来评估节点GCL条件中的两项：\n1. 时间导数项：离散表示 $J_h$ 由其节点值定义，这些节点值是真实雅可比 $J$ 的节点值。因此，$(\\partial J_h/\\partial t)(\\xi_k) = d/dt (J_h(\\xi_k,t)) = d/dt(J(\\xi_k,t)) = (\\partial J/\\partial t)(\\xi_k,t)$。根据 $J$ 和 $w$ 的定义以及光滑映射 $x(\\xi,t)$ 的混合偏导数相等性质，我们有 $\\partial J/\\partial t = \\partial/\\partial t(\\partial x/\\partial\\xi) = \\partial/\\partial\\xi(\\partial x/\\partial t) = \\partial w/\\partial\\xi$。所以，第一项是真实网格速度的精确导数，即 $(\\partial w/\\partial\\xi)(\\xi_k,t)$。\n\n2. 空间导数项：此项是离散网格速度 $w_h = I_p[w]$ 的导数在节点处的值。根据问题陈述，微分由节点微分矩阵 $D_p$ 执行。当此矩阵应用于一个函数的节点值向量时，如果该函数是次数至多为 $p$ 的多项式，它将给出该函数导数的精确节点值。在这里，函数是 $w_h$，它是一个次数至多为 $p$ 的多项式。它在节点处的导数 $(\\partial w_h/\\partial\\xi)$ 通过将 $D_p$ 应用于 $w_h$ 的节点值来精确计算。$w_h$ 的节点值就是真实速度 $w$ 的节点值。设 $\\mathbf{w}_{nodes}$ 为向量 $[w(\\xi_0,t), \\dots, w(\\xi_p,t)]^T$。那么 $(\\partial w_h/\\partial\\xi)(\\xi_k) = (D_p \\mathbf{w}_{nodes})_k$。\n\n将这些代入节点GCL条件，我们得到：\n$$\n\\left( \\frac{\\partial w}{\\partial \\xi} \\right)(\\xi_k) = (D_p \\mathbf{w}_{nodes})_k \\quad \\text{for } k = 0, 1, \\dots, p\n$$\n此方程表明，真实网格速度 $w$ 的导数的精确节点值必须等于由谱微分矩阵 $D_p$ 计算出的导数的节点值。\n\n问题指明，矩阵 $D_p$ “能为任何次数至多为 $p$ 的多项式再生精确导数”。因此，上述等式对于任意多项式 $w$ 成立的充分必要条件是 $w$ 的次数不大于 $p$。\n\n根据问题，$x(\\xi,t)$ 是一个关于 $\\xi$ 的 $p_m$ 次多项式。因此，网格速度 $w(\\xi,t) = \\partial x/\\partial t$ 也是一个关于 $\\xi$ 的 $p_m$ 次多项式。\n为使GCL精确满足，我们必须有：\n$$\n\\text{degree}(w) \\le p\n$$\n这意味着：\n$$\np_m \\le p\n$$\n因此，使得离散GCL精确成立的最大映射多项式次数 $p_m$ 是 $p$。此结果与其他单元上的 $p_m$ 值无关，因为GCL是一个单元内性质。关于LGL求积对次数最高为 $2p-1$ 的多项式是精确的这一信息，确保了用于将弱形式局部化到节点的分部求和性质对于 $p$ 次离散多项式是有效的。\n\n因此，最大次数为 $p_m^{\\max}(p) = p$。", "answer": "$$\n\\boxed{p}\n$$", "id": "3389214"}, {"introduction": "理论上，我们可以构建精确满足几何守恒律（GCL）的数值格式，但在复杂的实际应用中，网格运动的非线性和离散化误差可能导致GCL无法被完美满足。因此，量化GCL违背的程度并加以控制变得至关重要。这项练习将指导您从GCL的弱形式出发，推导出一个离散的、逐单元的GCL残差诊断工具，它能够精确衡量GCL的局部违背程度 [@problem_id:3389201]。通过为一个具体案例计算该残差，并思考如何将其用于自适应地调整网格运动，您将掌握一个在实践中确保移动网格模拟准确性和鲁棒性的关键技术。", "problem": "考虑一个从一维参考单元到物理线段的随时间变化的映射，该映射由 $x(\\xi,t)$ 定义，其中 $\\xi \\in [-1,1]$。令 $J(\\xi,t)$ 表示该映射的雅可比，即 $J(\\xi,t)=\\partial_{\\xi}x(\\xi,t)$。假设网格运动由逆变网格速度通量 $w(\\xi,t)$ 表征，该通量与在网格移动下保持均匀解的特性相一致。连续几何守恒律 (GCL) 强制度量演化与网格运动的相容性，从而使守恒数值方法能够保持自由流解。\n\n仅从一维变量替换恒等式和标准微积分（Leibniz 法则和链式法则）出发，推导一个离散的、单元的残差诊断量，用于量化多项式谱元上 GCL 的违背程度。推导过程必须从移动控制体上的守恒律弱形式出发，并利用与 Legendre-Gauss-Lobatto (LGL) 求积及其配置导数矩阵相关的分部求和 (SBP) 性质。该诊断量必须能表示为单元内逐点残差向量的范数。\n\n然后，对于一个具有 LGL 节点 $\\xi_0=-1$、$\\xi_1=0$、$\\xi_2=1$，LGL 求积权重 $w_0=\\frac{1}{3}$、$w_1=\\frac{4}{3}$、$w_2=\\frac{1}{3}$，以及 LGL 一阶导数配置矩阵\n$$\nD=\\begin{pmatrix}\n- \\frac{3}{2}  & 2  & - \\frac{1}{2}\\\\\n- \\frac{1}{2}  & 0  & \\frac{1}{2}\\\\\n\\frac{1}{2}  & -2  & \\frac{3}{2}\n\\end{pmatrix}\n$$\n的单个谱元 $K$，考虑多项式映射\n$$\nx(\\xi,t)=a(t)+b(t)\\,\\xi+c(t)\\,\\xi^{2}\n$$\n其中 $a'(t)=0$、$b(t)=1+t$ 和 $c(t)=t$，在 $t=1$ 时刻进行计算。通过 $w(\\xi,t)=-\\partial_t x(\\xi,t)$ 定义与网格运动一致的网格速度通量，并在节点配置中近似所有量（即，将 $J_h$ 和 $w_h$ 设为其在 LGL 节点处的精确节点值）。使用您推导的诊断量，计算该单元的单元残差 $r_K$。将 $r_K$ 表示为一个实数。无需四舍五入。\n\n最后，在方法设计的层面上，解释如何使用这种单元残差诊断量来调整网格运动求解器中的参数，从而在谱方法或间断 Galerkin (DG) 方法中，使离散 GCL 在规定的容差内得到满足。", "solution": "该问题要求分三部分作答：首先，推导谱元的离散几何守恒律 (GCL) 残差诊断量；其次，针对一个具体案例计算该残差；第三，解释其在自适应网格运动求解器中的应用。对问题陈述的验证证实了其科学上的合理性和适定性。所提供的 Legendre-Gauss-Lobatto (LGL) 格式的数值数据与分部求和 (SBP) 性质一致，后者是所要求推导的基石。\n\n### 第 1 部分：GCL 残差诊断量的推导\n\n几何守恒律 (GCL) 为移动网格上的数值格式保持常数解（自由流）建立了一个必要条件。它将控制体度量的变化率与其边界的速度联系起来。\n\n我们从移动单元 $K(t) = [x(\\xi=-1,t), x(\\xi=1,t)]$ 上，物理坐标 $x$ 到参考坐标 $\\xi \\in [-1, 1]$ 的变量替换基本恒等式开始：\n$$ \\frac{d}{dt} \\int_{K(t)} dx = \\frac{d}{dt} \\int_{-1}^{1} J(\\xi, t) d\\xi $$\n其中 $J(\\xi,t) = \\partial_{\\xi} x(\\xi, t)$ 是映射 $x(\\xi, t)$ 的雅可比。\n\n左边代表单元长度的变化率。令 $\\dot{x}(\\xi, t) = \\partial_t x(\\xi, t)$ 为网格速度。根据 Leibniz 积分法则，\n$$ \\frac{d}{dt} \\int_{x(-1,t)}^{x(1,t)} dx = \\dot{x}(1, t) - \\dot{x}(-1, t) $$\n右边，通过将导数移入积分号内，得到：\n$$ \\frac{d}{dt} \\int_{-1}^{1} J(\\xi, t) d\\xi = \\int_{-1}^{1} \\partial_t J(\\xi, t) d\\xi $$\n令两式相等，得到 GCL 的积分形式：\n$$ \\int_{-1}^{1} \\partial_t J(\\xi, t) d\\xi = \\dot{x}(1, t) - \\dot{x}(-1, t) $$\n使用微积分基本定理，右侧可以写成一个积分：$[\\dot{x}]_{\\xi=-1}^{\\xi=1} = \\int_{-1}^{1} \\partial_{\\xi} \\dot{x}(\\xi, t) d\\xi$。由此可得：\n$$ \\int_{-1}^{1} \\left( \\partial_t J - \\partial_{\\xi} \\dot{x} \\right) d\\xi = 0 $$\n由于这对任意单元映射都成立，被积函数必须为零，从而得到 GCL 的强形式：\n$$ \\partial_t J - \\partial_{\\xi} \\dot{x} = 0 $$\n问题定义了逆变网格速度通量 $w(\\xi, t) = -\\partial_t x(\\xi, t) = -\\dot{x}(\\xi, t)$。将其代入 GCL 的强形式，得到我们将要离散的控制方程：\n$$ \\partial_t J + \\partial_{\\xi} w = 0 $$\n在使用 LGL 节点 $\\{\\xi_i\\}_{i=0}^{N}$ 的基于配置点的谱元法中，我们用连续函数在节点上的值组成的向量来表示它们。令 $\\mathbf{J}(t)$ 和 $\\mathbf{w}(t)$ 分别是 $J(\\xi, t)$ 和 $w(\\xi, t)$ 的节点值向量。时间导数逐点作用于节点值，得到向量 $\\frac{d\\mathbf{J}}{dt}$。空间导数 $\\partial_{\\xi} w$ 通过应用 LGL 一阶导数配置矩阵 $D$ 在节点上进行近似。因此，节点上 GCL 的离散形式为：\n$$ \\frac{d\\mathbf{J}}{dt} + D\\mathbf{w} \\approx \\mathbf{0} $$\n该等式不被满足的程度构成了离散 GCL 违背。我们定义节点 GCL 残差向量 $\\mathbf{r}$ 为：\n$$ \\mathbf{r} = \\frac{d\\mathbf{J}}{dt} + D\\mathbf{w} $$\n通过计算该残差向量的范数，可以得到整个单元 $K$ 的单个标量诊断量 $r_K$。一个自然的选择是由 LGL 求积权重 $w_i$ 加权的离散 $L_2$ 范数，它模拟了连续的 $L_2$ 积分范数。令 $M$ 为对角质量矩阵，其元素为 $M_{ii} = w_i$。加权范数为：\n$$ r_K = \\| \\mathbf{r} \\|_{M} = \\sqrt{\\mathbf{r}^T M \\mathbf{r}} = \\sqrt{\\sum_{i=0}^{N} r_i^2 w_i} $$\n这个标量值 $r_K$ 量化了单元的 GCL 违背程度。算子对 $(D, M)$ 的分部求和 (SBP) 性质，即 $M D + (M D)^T = B$（其中 $B = \\text{diag}(-1, 0, \\dots, 0, 1)$），确保了如果节点残差 $\\mathbf{r}$ 为零，则离散全局守恒性得以保持。\n\n### 第 2 部分：残差的计算\n\n我们给定一个具有 $N+1=3$ 个 LGL 节点（位于 $\\xi_0 = -1$, $\\xi_1 = 0$, $\\xi_2 = 1$）的单个单元。映射为 $x(\\xi,t)=a(t)+b(t)\\xi+c(t)\\xi^{2}$，其系数由 $a'(t)=0$，$b(t)=1+t$ 和 $c(t)=t$ 定义。我们在 $t=1$ 时刻计算所有量。\n\n1.  **计算雅可比 $J$ 及其时间导数**:\n    $J(\\xi, t) = \\partial_{\\xi} x(\\xi, t) = b(t) + 2c(t)\\xi$。\n    在 $t=1$ 时，$b(1)=2$，$c(1)=1$，所以 $J(\\xi, 1) = 2 + 2\\xi$。\n    $J$ 在 LGL 节点上的值为向量 $\\mathbf{J}$:\n    $\\mathbf{J} = [J(-1,1), J(0,1), J(1,1)]^T = [2+2(-1), 2+2(0), 2+2(1)]^T = [0, 2, 4]^T$。\n\n    $J$ 的时间导数为 $\\partial_t J(\\xi, t) = b'(t) + 2c'(t)\\xi = 1 + 2\\xi$。\n    $\\partial_t J$ 在 $t=1$ 时 LGL 节点上的值为向量 $\\frac{d\\mathbf{J}}{dt}$:\n    $\\frac{d\\mathbf{J}}{dt} = [1+2(-1), 1+2(0), 1+2(1)]^T = [-1, 1, 3]^T$。\n\n2.  **计算网格速度通量 $w$**:\n    $w(\\xi, t) = -\\partial_t x(\\xi, t) = -a'(t) - b'(t)\\xi - c'(t)\\xi^2 = -\\xi - \\xi^2$。\n    $w$ 在 $t=1$ 时 LGL 节点上的值为向量 $\\mathbf{w}$:\n    $\\mathbf{w} = [w(-1), w(0), w(1)]^T = [-(-1)-(-1)^2, -(0)-(0)^2, -(1)-(1)^2]^T = [0, 0, -2]^T$。\n\n3.  **计算残差向量 $\\mathbf{r}$**:\n    首先，计算离散空间导数项 $D\\mathbf{w}$:\n    $$\n    D\\mathbf{w} = \\begin{pmatrix}\n    - \\frac{3}{2} & 2 & - \\frac{1}{2}\\\\\n    - \\frac{1}{2} & 0 & \\frac{1}{2}\\\\\n    \\frac{1}{2} & -2 & \\frac{3}{2}\n    \\end{pmatrix}\n    \\begin{pmatrix} 0 \\\\ 0 \\\\ -2 \\end{pmatrix}\n    = \\begin{pmatrix} (-1/2)(-2) \\\\ (1/2)(-2) \\\\ (3/2)(-2) \\end{pmatrix}\n    = \\begin{pmatrix} 1 \\\\ -1 \\\\ -3 \\end{pmatrix}\n    $$\n    现在，计算节点残差向量 $\\mathbf{r} = \\frac{d\\mathbf{J}}{dt} + D\\mathbf{w}$:\n    $$\n    \\mathbf{r} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ -1 \\\\ -3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n    $$\n\n4.  **计算单元残差 $r_K$**:\n    由于节点残差向量 $\\mathbf{r}$ 是零向量，其任何范数都将为零。\n    $$ r_K = \\sqrt{0^2 \\cdot \\frac{1}{3} + 0^2 \\cdot \\frac{4}{3} + 0^2 \\cdot \\frac{1}{3}} = 0 $$\n    因此，该单元的 GCL 单元残差为 0。这是预料之中的，因为映射是二次多项式 ($p_m=2$)，而谱元格式的阶数也是 $p=2$（3个节点）。在这种情况下，离散算子能够精确表示连续 GCL 方程中的所有项，因此残差为零。\n\n### 第 3 部分：诊断量的应用\n\n单元残差诊断量 $r_K$ 是一个强大的工具，可用于在模拟过程中主动控制和改善网格质量，以确保 GCL 在指定的容差内得到满足。其应用方法如下：\n\n在一个典型的 ALE 模拟中，网格运动通常由一个独立的求解器确定，例如，通过求解一个伪弹性方程来使网格适应边界运动。单元残差 $r_K$ 可以作为该求解器的后验误差指示器。\n\n1.  **监控与阈值化**: 在每个时间步或若干时间步之后，可以计算整个计算域中每个单元 $K$ 的残差 $r_K$。然后将这些残差与预设的容差 $\\epsilon_{\\text{GCL}}$ 进行比较。\n\n2.  **自适应网格调整**: 如果一个或多个单元的残差 $r_K > \\epsilon_{\\text{GCL}}$，这表明这些单元的网格运动质量较差，可能导致数值解的精度受损。这可以触发一个自适应响应：\n    *   **调整网格求解器参数**: 对于基于伪弹性方程的网格求解器，可以局部增加违规单元区域的“刚度”或正则化参数。这会使网格在这些区域更不易变形，从而减少网格畸变，降低 GCL 残差。\n    *   **局部平滑或重构**: 可以对违规单元及其邻近单元的节点位置应用一个局部平滑算子（例如，拉普拉斯平滑），以改善单元质量并降低 $r_K$。\n    *   **触发局部重映射 (r-adaptivity)**: 在更极端的情况下，可以冻结物理求解，在违规区域触发一个网格优化步骤，重新定位节点以最小化包括 $r_K$ 在内的网格质量度量函数，然后再将解从旧网格插值到新网格上。\n\n通过将 $r_K$ 整合到这样一个闭环控制系统中，可以将 GCL 从一个被动的验证标准转变为一个主动的、动态的工具，用于在整个模拟过程中维持网格质量和数值精度。", "answer": "$$\\boxed{0}$$", "id": "3389201"}]}