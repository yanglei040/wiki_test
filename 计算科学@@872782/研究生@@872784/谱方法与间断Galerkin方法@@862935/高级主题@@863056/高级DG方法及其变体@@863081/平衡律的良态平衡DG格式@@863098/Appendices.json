{"hands_on_practices": [{"introduction": "平衡格式的精髓在于其能够精确地再现物理平衡状态，即通量梯度与源项相互抵消。本练习 [@problem_id:3428768] 通过一个具体的计算任务来揭示这一概念。我们将确定为确保在一个简单的“静湖”场景中，通量和源项的离散近似能够完全抵消，所需要的数值求积最低精度，从而揭示精确积分在构建这些格式中的基石作用。", "problem": "考虑在一维区域上的一维浅水平衡律，该区域被划分为具有直界面的单元，\n$$\n\\partial_{t}\\begin{pmatrix} h \\\\ hu \\end{pmatrix}\n+ \\partial_{x}\\begin{pmatrix} hu \\\\ \\displaystyle \\frac{(hu)^{2}}{h} + \\frac{g}{2}h^{2} \\end{pmatrix}\n= \\begin{pmatrix} 0 \\\\ -g\\,h\\,\\partial_{x}b(x) \\end{pmatrix},\n$$\n其中 $h(x,t)$ 是水深，$u(x,t)$ 是速度，$g$ 是（常数）重力加速度，$b(x)$ 是底部地形。静湖稳态由 $u(x,t)=0$ 和 $h(x,t)+b(x)=H$ 给出，其中 $H$ 为常数。\n\n在每个单元上使用多项式次数为 $p=1$ 的间断伽辽金（DG）方法，其检验函数 $\\varphi(x)$ 是次数最多为 $1$ 的多项式。假设底部地形 $b(x)$ 在每个单元上是分段线性的，因此 $\\partial_{x}b$ 在每个单元内部是常数，并可能在界面上发生跳跃。DG 公式对每个单元内的通量项应用标准的分部积分（得到一个涉及 $f(q)$ 和检验函数梯度的体积分，以及一个在界面上的边界通量项），并在体积内离散化源项。为了实现静湖状态的精确保平衡，对于由地形引起的非守恒耦合，在界面处遵循一种路径守恒解释：强制实现精确抵消的界面贡献可以写成一个一维路径积分的形式，该积分在一个抽象路径变量 $s\\in[0,1]$ 上进行，路径是在状态空间中连接左右迹的直线段，形式如下\n$$\n\\int_{0}^{1} B\\big(q(s)\\big)\\,\\partial_{s}b(s)\\,ds,\n$$\n其中 $B(q)=g\\,h$ 且 $b(s)$ 沿路径是线性的。在静湖配置下，沿路径有 $h(s)=H-b(s)$。\n\n你需要确定为精确积分以下各项所需的最小高斯-勒让德求积阶数：\n- DG 格式为保持静湖平衡所需的单元内部（体积）积分，以及\n- 为确保界面处精确保平衡所需的界面路径积分。\n\n使用以下基本依据：\n- 静湖状态满足 $u=0$ 和 $h+b=H$，因此如果 $b$ 是分段线性的，则 $h$ 也是分段线性的。\n- 在每个 $p=1$ 的单元内，任何检验函数 $\\varphi$ 的梯度都是常数。\n- 当 $u=0$ 时，动量通量简化为静水压力项 $\\frac{g}{2}h^{2}$。\n- 具有 $N$ 个点的高斯-勒让德求积法在其应用区间上能精确积分次数最高为 $2N-1$ 的任意多项式。\n\n假设每个单元映射是仿射的，因此多项式次数在映射下保持不变，并且界面路径 $b(s)$ 是线性的。将你的最终答案表示为一个数对，分别给出每个单元的体积分和每个界面的界面路径积分所需的高斯-勒让德点的最小数量。以整数行矩阵的形式提供该数对。无需四舍五入，不涉及单位。", "solution": "该问题要求确定在浅水方程的间断伽辽金（DG）方法中，为实现两种类型积分的精确计算所需的最小高斯-勒让德求积点数，特别是为了保持静湖稳态。逼近空间的多项式次数为 $p=1$。\n\n静湖稳态定义为流体速度为零 $u(x,t)=0$，以及总水面高度恒定 $h(x,t)+b(x)=H$，其中 $h$ 是水深，$b$ 是底部地形，$H$ 是一个常数。\n\n一个具有 $N$ 个点的高斯-勒让德求积法则能够精确积分次数最高为 $2N-1$ 的多项式。为了找到最小的 $N$，我们必须找到被积函数的最大多项式次数 $d$，并求解不等式 $2N-1 \\ge d$ 以获得最小的整数 $N$。\n\n### 第一部分：单元内部（体积）积分\n\n为了保持稳态，数值格式必须在每个单元内精确平衡离散化的通量梯度和源项。在静湖状态（$u=0$）下，动量方程得以简化。必须在一个单元体积 $K$ 上积分的项源于动量方程的弱形式：\n$$\n\\int_K \\partial_x \\left( \\frac{g}{2}h^2 \\right) \\varphi \\, dx = \\int_K -g h (\\partial_x b) \\varphi \\, dx\n$$\n经过分部积分后，需要数值求积的相关体积分是：\n1.  通量积分：$\\int_K \\frac{g}{2}h(x)^2 (\\partial_x \\varphi(x)) \\, dx$\n2.  源项积分：$\\int_K g h(x) (\\partial_x b(x)) \\varphi(x) \\, dx$\n\n我们必须确定在给定单元 $K$ 上被积函数的多项式次数。\n-   DG 方法使用次数最高为 $p=1$ 的多项式基函数和检验函数。因此，检验函数 $\\varphi(x)$ 是一个次数最高为 $1$ 的多项式。其导数 $\\partial_x \\varphi(x)$ 则是一个次数最高为 $0$ 的多项式（一个常数）。\n-   水深 $h(x)$ 的数值解也由一个次数最高为 $p=1$ 的多项式表示。\n-   底部地形 $b(x)$ 被设定为分段线性的。这意味着在任何单个单元 $K$ 上，$b(x)$ 是一个次数最高为 $1$ 的多项式，其导数 $\\partial_x b(x)$ 是一个次数最高为 $0$ 的多项式（一个常数）。\n\n现在，我们来分析每个被积函数的次数：\n1.  **通量被积函数**：该项为 $\\frac{g}{2}h(x)^2 (\\partial_x \\varphi(x))$。\n    -   $h(x)^2$ 的次数是 $2 \\times (h \\text{ 的次数}) = 2 \\times 1 = 2$。\n    -   $\\partial_x \\varphi(x)$ 的次数是 $0$。\n    -   乘积的次数是 $2+0=2$。因此，第一个被积函数是一个次数最高为 $2$ 的多项式。\n\n2.  **源项被积函数**：该项为 $g h(x) (\\partial_x b(x)) \\varphi(x)$。\n    -   $h(x)$ 的次数最高为 $1$。\n    -   $\\partial_x b(x)$ 的次数最高为 $0$。\n    -   $\\varphi(x)$ 的次数最高为 $1$。\n    -   乘积的次数是 $1+0+1=2$。因此，第二个被积函数是一个次数最高为 $2$ 的多项式。\n\n两个被积函数都是次数最高为 $d=2$ 的多项式。为了精确积分它们，我们需要一个具有 $N$ 个点的高斯-勒让德法则，使得：\n$$\n2N-1 \\ge 2 \\implies 2N \\ge 3 \\implies N \\ge 1.5\n$$\n由于 $N$ 必须是整数，所需的最小点数是 $N_{vol} = 2$。\n\n### 第二部分：界面路径积分\n\n问题指明了一个以路径积分形式表示的界面贡献，这对于为非守恒系统实现保平衡格式至关重要：\n$$\nI = \\int_{0}^{1} B\\big(q(s)\\big)\\,\\partial_{s}b(s)\\,ds\n$$\n其中 $s \\in [0,1]$ 是路径参数。我们需要找到被积函数关于 $s$ 的多项式次数。\n\n-   函数 $B(q)$ 由 $B(q) = g\\,h$ 给出。\n-   状态空间中的路径 $q(s)$ 是连接左状态 $q_L$ 和右状态 $q_R$ 的一个直线段。这意味着 $q(s)$ 的每个分量都是 $s$ 的线性函数。特别地，对于水深 $h$，我们有 $h(s) = (1-s)h_L + s h_R$，这是一个关于 $s$ 的次数最高为 $1$ 的多项式。\n-   问题陈述，底部地形的路径 $b(s)$ 是关于 $s$ 的线性函数。这意味着对于某些值 $b_L$ 和 $b_R$，有 $b(s) = (1-s)b_L + s b_R$。\n-   因此，导数 $\\partial_s b(s) = b_R - b_L$ 是一个常数，即一个关于 $s$ 的次数为 $0$ 的多项式。\n-   被积函数是 $B(q(s)) \\partial_s b(s) = g h(s) \\partial_s b(s)$。\n    -   $g$ 是一个常数。\n    -   $h(s)$ 是一个次数最高为 $1$ 的多项式。\n    -   $\\partial_s b(s)$ 是一个次数为 $0$ 的多项式。\n    -   乘积是一个次数最高为 $1+0=1$ 的多项式。\n\n问题还为静湖状态提供了一个一致性条件：沿路径 $h(s) = H - b(s)$。这确认了路径之间的关系，并且不改变次数的计算。如果 $h(s)$ 是线性的，那么 $b(s)=H-h(s)$ 也必须是线性的，这与问题陈述一致。\n\n因此，被积函数是关于积分变量 $s$ 的一个次数最高为 $d=1$ 的多项式。为了精确积分它，我们需要一个具有 $N$ 个点的高斯-勒让德法则，使得：\n$$\n2N-1 \\ge 1 \\implies 2N \\ge 2 \\implies N \\ge 1\n$$\n所需的最小点数是 $N_{int} = 1$。\n\n体积分所需的高斯-勒让德最小点数为 $2$，界面路径积分所需的最小点数为 $1$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 2  1 \\end{pmatrix}\n}\n$$", "id": "3428768"}, {"introduction": "除了简单地使用高阶求积法则，单元内节点的具体位置可以赋予数值格式深刻的结构特性。本练习 [@problem_id:3428846] 探讨了节点选择与一个被称为分部求和（Summation-by-Parts, SBP）性质的强大概念之间的联系。通过推导最优节点位置，您将发现为何某些节点集（如高斯-洛巴托点）不仅便于插值，而且是创建离散平衡且稳定格式的基础。", "problem": "考虑在单个单元上的一维浅水方程（含底部地形），该单元被仿射映射到参考区间 $[-1,1]$：\n$$\n\\partial_{t}\\begin{pmatrix} h \\\\ hu \\end{pmatrix} + \\partial_{x}\\begin{pmatrix} hu \\\\ hu^{2} + \\tfrac{1}{2} g h^{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ - g h \\,\\partial_{x} b \\end{pmatrix},\n$$\n其中 $h$ 是水深，$u$ 是速度，$g$ 是重力加速度，$b$ 是底部地形。静湖状态由 $u \\equiv 0$ 和 $h + b \\equiv H$ 给出，其中 $H$ 为常数。\n\n在每个参考单元 $[-1,1]$ 上，考虑一个节点不连续伽辽金 (DG) 离散化，其多项式试验和测试空间的次数至多为 $p$，配置在 $p+1$ 个不同的求积节点 $\\{x_{i}\\}_{i=0}^{p}$ 上。这些节点具有正权重 $\\{w_{i}\\}_{i=0}^{p}$，并同时用于插值和体求积（对角质量）。离散导数通过对这些节点上的拉格朗日插值多项式求导来实现，源项则通过将 $\\partial_{x} b$ 替换为 $b$ 的 $p$ 次插值多项式在相同节点上的导数值来进行离散化。假设界面处的数值通量是相容和对称的，因此对于静湖状态，界面贡献仅简化为压力项。\n\n施加以下良态平衡要求：对于次数至多为 $p$ 的任何多项式底部地形 $b$ 和任何常数 $H$，动量方程的半离散残差对于静湖状态 $u \\equiv 0$，$h = H - b$ 恒为零。从 $[-1,1]$ 上的弱形式出发，利用对多项式被积函数的精确性考虑以及由求积（公式）导出的离散分部积分结构，推导体积求积的必要精确度阶条件和节点的边界包含条件。然后，以经典正交多项式的形式，确定 $[-1,1]$ 上相应最优通量求积节点的闭式解析表征。\n\n你的最终答案必须仅为这些节点在 $[-1,1]$ 上的解析表征（而非数值）。如果使用命名多项式，请定义其归一化。无需四舍五入，也不涉及任何单位。将 $[-1,1]$ 上的所有节点集合表示为单个闭式解析表达式。", "solution": "我们从参考单元 $[-1,1]$ 上的一维浅水方程开始（从物理单元进行的仿射映射产生一个常数雅可比行列式，该常数可以被吸收到方程中，不影响核心论证）：\n$$\n\\partial_{t}\\begin{pmatrix} h \\\\ hu \\end{pmatrix} + \\partial_{\\xi}\\begin{pmatrix} hu \\\\ hu^{2} + \\tfrac{1}{2} g h^{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ - g h \\,\\partial_{\\xi} b \\end{pmatrix}\n$$\n静湖状态定义为 $u \\equiv 0$ 且水面高程为常数，$h+b \\equiv H$，其中 $H$ 为一常数。对于此状态，速度 $u$ 为零，其时间导数也为零。动量方程变为静水压力梯度与底部地形梯度产生的源项之间的平衡：\n$$\n\\partial_{\\xi}\\left(\\frac{1}{2} g h^{2}\\right) = -g h \\,\\partial_{\\xi} b\n$$\n根据条件 $h+b=H$，我们有 $\\partial_{\\xi} h = -\\partial_{\\xi} b$。将此代入右侧可得 $g h \\,\\partial_{\\xi} h = g \\, \\partial_{\\xi}(\\frac{1}{2}h^2)$。因此，该方程在解析上是满足的。\n\n问题要求半离散 DG 格式能保持此稳态，这一性质被称为良态平衡。对于测试函数 $v(\\xi) \\in \\mathcal{P}^p$（次数至多为 $p$ 的多项式空间），动量方程的半离散弱形式是通过将方程乘以 $v$ 并在参考单元 $[-1,1]$ 上积分得到的：\n$$\n\\int_{-1}^{1} \\partial_t (hu) v \\,d\\xi + \\int_{-1}^{1} \\partial_{\\xi} F_2 \\,v \\,d\\xi = \\int_{-1}^{1} S_2 \\,v \\,d\\xi\n$$\n其中 $F_2 = hu^2 + \\frac{1}{2}gh^2$ 是动量通量，$S_2 = -gh\\partial_{\\xi}b$ 是源项。对通量项应用分部积分，并在边界处代入数值通量 $\\hat{F}_2$ 可得：\n$$\n\\int_{-1}^{1} \\partial_t (hu) v \\,d\\xi - \\int_{-1}^{1} F_2 \\partial_{\\xi} v \\,d\\xi + [\\hat{F}_2 v]_{-1}^{1} = \\int_{-1}^{1} S_2 v \\,d\\xi\n$$\n对于静湖状态，$\\partial_t(hu)=0$ 且 $F_2 = \\frac{1}{2}gh^2$。数值通量 $\\hat{F}_2$ 是相容的，并简化为压力项。对于一个连续的静湖状态，$h$ 在单元边界上是连续的，因此相容性（$\\hat{F}_2(q,q) = F_2(q)$）意味着在边界处 $\\hat{F}_2 = \\frac{1}{2}gh^2$。方程变为：\n$$\n-\\int_{-1}^{1} \\frac{1}{2}gh^2 \\partial_{\\xi} v \\,d\\xi + \\left[\\frac{1}{2}gh^2 v\\right]_{-1}^{1} = \\int_{-1}^{1} (-gh\\partial_{\\xi}b) v \\,d\\xi\n$$\n对左侧使用分部积分，我们得到 $\\int_{-1}^{1} \\partial_{\\xi}(\\frac{1}{2}gh^2) v \\,d\\xi$。如前所示，该方程在解析上是满足的。\n\nDG 离散化采用具有 $p+1$ 个节点 $\\{\\xi_i\\}_{i=0}^p$ 和相应正权重集 $\\{w_i\\}_{i=0}^p$ 的求积法则来近似积分。良态平衡要求是该方程的离散形式必须精确成立：\n$$\n-\\sum_{i=0}^{p} w_i \\frac{g}{2}h^2(\\xi_i) (\\partial_{\\xi}v)(\\xi_i) + \\left[\\frac{g}{2}h^2v\\right]_{-1}^{1} = -\\sum_{i=0}^{p} w_i g h(\\xi_i) (\\partial_{\\xi}b)(\\xi_i) v(\\xi_i)\n$$\n对于任何多项式底部地形 $b \\in \\mathcal{P}^p$（这意味着 $h=H-b \\in \\mathcal{P}^p$）以及所有测试函数 $v \\in \\mathcal{P}^p$，此式必须成立。源项是通过在节点上计算 $b$ 的插值多项式（即 $b$ 本身）的精确导数来离散化的。\n\n我们可以使用 $\\partial_{\\xi}b = -\\partial_{\\xi}h$ 重写右侧：\n$$\n\\text{RHS} = \\sum_{i=0}^{p} w_i g h(\\xi_i) (\\partial_{\\xi}h)(\\xi_i) v(\\xi_i) = \\sum_{i=0}^{p} w_i \\frac{g}{2} (\\partial_{\\xi}h^2)(\\xi_i) v(\\xi_i)\n$$\n让我们用 $Q(f) = \\sum_{i=0}^{p} w_i f(\\xi_i)$ 表示求积算子。设 $P(h) = \\frac{g}{2}h^2$。良态平衡的条件变为：\n$$\n-Q(P(h) \\partial_{\\xi}v) + [P(h)v]_{-1}^{1} = Q((\\partial_{\\xi}P(h)) v)\n$$\n这个方程必须对任何 $h \\in \\mathcal{P}^p$ 和 $v \\in \\mathcal{P}^p$ 成立。该表达式是分部积分公式的离散模拟，通常称为分部求和 (Summation-by-Parts, SBP) 性质。该条件等价于要求求积法则满足：\n$$\nQ([\\partial_{\\xi} \\phi]) = \\phi(1) - \\phi(-1)\n$$\n对所有形如 $\\phi = P(h)v$ 的多项式 $\\phi$ 成立，其中 $h, v \\in \\mathcal{P}^p$。由于 $h \\in \\mathcal{P}^p$，则 $P(h) \\in \\mathcal{P}^{2p}$。又因 $v \\in \\mathcal{P}^p$，故乘积 $\\phi \\in \\mathcal{P}^{3p}$。导数 $\\partial_{\\xi}\\phi$ 是一个次数至多为 $3p-1$ 的多项式。\n\n一个具有 $p+1$ 个节点的求积法则，其最高精确度阶为 $2(p+1)-1 = 2p+1$（高斯求积）。对于 $p \\ge 2$，要求对 $3p-1$ 次多项式精确是无法满足的。然而，多项式集合 $\\{P(h)v | h,v \\in \\mathcal{P}^p\\}$ 并非 $\\mathcal{P}^{3p}$ 的全部。对代数结构进行更精细的分析可以揭示出精确的条件。\n\n该问题等价于要求由 $(\\mathbf{D}f)_i = (\\partial_{\\xi} \\mathbb{I}_p[f])(\\xi_i)$ 定义的离散微分算子 $\\mathbf{D}$ 在应用于多项式的平方时满足一个离散乘法法则。具体来说，节点处平衡律的强形式要求 $\\partial_{\\xi}\\mathbb{I}_p[\\frac{1}{2}gh^2](\\xi_i) = -gh(\\xi_i)\\partial_\\xi b(\\xi_i)$，对于任何 $h \\in \\mathcal{P}^p$，这可简化为在所有节点 $\\xi_i$ 处都满足条件 $\\partial_{\\xi}\\mathbb{I}_p[h^2](\\xi_i) = (\\partial_{\\xi}h^2)(\\xi_i)$。众所周知，此性质成立的充要条件是求积节点（也即插值节点）满足两个条件：\n1.  **边界包含条件**：节点集必须包含区间的端点，即 $\\xi_0 = -1$ 和 $\\xi_p = 1$。\n2.  **精确度阶条件**：该 $(p+1)$ 点求积法则必须具有至少 $2p-1$ 的精确度阶。\n\n在 $[-1,1]$ 上，一个包含端点且具有 $p+1$ 个节点并达到最大精确度阶（恰好是 $2p-1$）的求积法则是 Gauss-Lobatto 求积。因此，体积求积节点必须是 Gauss-Lobatto 节点。\n\n问题接着要求“相应的最优通量求积节点”。鉴于问题是一维的，数值通量仅在单元边界 $\\xi = -1$ 和 $\\xi=1$ 处计算。不存在需要近似一个积分意义上的“通量求积”。这部分问题最合理的解释是要求对刚刚推导出其性质的体积求积节点进行解析表征，因为它们是良态平衡分析的核心结果。\n\n在区间 $[-1,1]$ 上的 $(p+1)$ 点 Gauss-Lobatto 节点是多项式 $(1-\\xi^2)P_p'(\\xi)$ 的根，其中 $P_p(\\xi)$ 是 $p$ 次勒让德多项式。勒让德多项式 $P_p(\\xi)$ 在 $[-1,1]$ 上关于权函数 $w(\\xi)=1$ 构成一个正交基，并且通常被归一化以使 $P_p(1)=1$。该多项式的根是 $\\xi = -1$, $\\xi=1$，以及勒让德多项式 $P_p(\\xi)$ 导数的 $p-1$ 个根。\n\n因此，这组节点得到了完全的表征。", "answer": "$$\n\\boxed{\\{\\xi \\in [-1,1] \\mid (1-\\xi^2)P_p'(\\xi) = 0\\}}\n$$", "id": "3428846"}, {"introduction": "构建一个稳健的数值求解器不仅需要理解单个组件，更要求将它们巧妙地集成为一个协调的整体。最后的这个练习 [@problem_id:3428781] 将我们的注意力从一维分析提升到二维平衡间断伽辽金格式的综合设计。您将体验一个真实世界实现中所涉及的关键决策过程，从选择合适的变量、处理复杂的界面到实施精密的限制器，最终形成一个完整的算法蓝图。", "problem": "考虑以守恒形式表示的二维浅水方程（带地形）\n$$\n\\partial_t \\boldsymbol{U} + \\nabla \\cdot \\boldsymbol{F}(\\boldsymbol{U}) = \\boldsymbol{S}(\\boldsymbol{U},\\nabla b),\n$$\n其中 $\\boldsymbol{U} = \\begin{bmatrix} h \\\\ h u \\\\ h v \\end{bmatrix}$，$\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} h u  h v \\\\ h u^2 + \\tfrac{1}{2} g h^2  h u v \\\\ h u v  h v^2 + \\tfrac{1}{2} g h^2 \\end{bmatrix}$，$\\boldsymbol{S}(\\boldsymbol{U},\\nabla b) = \\begin{bmatrix} 0 \\\\ - g h \\, \\partial_x b \\\\ - g h \\, \\partial_y b \\end{bmatrix}$，$h$ 是水深，$\\boldsymbol{u} = (u,v)$ 是速度，$g$ 是重力加速度，$b$ 是地形。一种良好平衡格式是指能够精确保持“静湖”稳态的格式，该稳态定义为 $u = 0$、$v = 0$ 以及 $\\eta \\equiv h + b = \\eta_0$（其中 $\\eta_0$ 为常数）。\n\n我们将在一个形状规则的网格上实施间断 Galerkin (DG) 方法。您必须确定一个算法工作流，该工作流需能在精确求积条件下，为光滑的 $b$ 在半离散层面上保证良好平衡性质；为平衡变量、求积和限制器指定具体的数据结构；并提供关于单元数量 $N_e$ 和多项式次数 $p$ 的每个时间步的正确首阶复杂度分析。\n\n选择一个提供正确且内部一致的工作流的选项，包括：\n- 主要变量的选择以及平衡变量的表示和存储方式，\n- 体项和面项的构造（包括任何重构或通量修正），以实现对“静湖”状态的精确平衡，\n- 限制器策略及其与平衡状态的相互作用，\n- 高效实现所需的未知数、几何和求积的数据结构，\n- 以及在使用和因子分解的节点 DG 方法的张量积四边形网格上，作为 $N_e$ 和 $p$ 的函数的每个时间步的正确首阶计算复杂度（和主要内存占用）。\n\n选项：\n\nA) 在张量积四边形网格上，使用自由面高程 $\\eta = h + b$ 和动量 $(h u, h v)$ 作为每个单元的主要多项式场，并在 Gauss–Legendre–Lobatto (GLL) 节点上采用节点基。对每个单元索引 $e \\in \\{1,\\dots,N_e\\}$，将变量存储在数组 $\\widehat{\\boldsymbol{U}}[e, v, i, j]$ 中，其中 $v \\in \\{1,2,3\\}$ 且 $(i,j) \\in \\{0,\\dots,p\\}^2$，用于保存 $(\\eta, h u, h v)$ 的节点系数；将地形作为节点场 $b[e,i,j]$ 存储在相同的节点上；存储几何雅可比和度量项 $\\mathcal{J}[e,i,j]$、$(x_\\xi, x_\\eta, y_\\xi, y_\\eta)[e,i,j]$。使用与 GLL 节点配置的体积求积，以及在面上的 GLL 节点处使用表面求积。在每个 Runge–Kutta 阶段：使用与节点求积一致的分裂形式 DG 算子计算通量散度；使用相同的求积和度量项离散化源项，以确保当 $u=v=0$ 且 $\\eta$ 为常数时，离散的通量散度在所有节点上都能精确抵消离散的源项贡献；在界面处，在近似 Riemann 求解器中应用静水压重构，通过 $h^\\pm = \\max(0, \\eta^\\pm - \\max(b^\\pm_L, b^\\pm_R))$ 来重构左右水深，以确保即使在 $b$ 不连续的情况下也能精确保持“静湖”状态。对于限制器，将状态分解为平衡部分和扰动部分：计算每个单元的平衡态 $\\eta_{eq} = \\overline{\\eta}$ 和零动量，形成扰动 $\\eta' = \\eta - \\eta_{eq}$、$(h u)' = h u$、$(h v)' = h v$，仅对扰动部分应用总变差有界 (TVB) 限制器和保正限制器，然后通过加回平衡部分进行重构；这能保持稳态。使用和因子分解进行张量积计算，使得每步的成本对于体项按 $\\mathcal{O}(N_e\\, p^3)$ 缩放，对于面项按 $\\mathcal{O}(N_e\\, p^2)$ 缩放，解决方案和几何存储的内存占用为 $\\mathcal{O}(N_e\\, p^2)$。\n\nB) 在四边形单元上，使用水深 $h$ 和速度 $(u,v)$ 作为模态正交基中的主要未知数。仅将地形 $b$ 存储为单元平均值 $b[e]$。使用 $p+1$ 阶的单一 Gauss–Legendre 法则计算体积积分，使用中点通量计算面积分，并通过用相邻单元平均值的中心有限差分重构替换 $\\nabla b$ 来离散化源项。不修改界面处的 Riemann 求解器。在每个时间阶段后，直接对 $\\eta = h + b$ 的节点重构应用总变差递减 (TVD) 限制器。每步的成本为 $\\mathcal{O}(N_e\\, p^2)$，内存为 $\\mathcal{O}(N_e\\, p)$。\n\nC) 在具有分层基的三角形单元上，使用自由面高程 $\\eta$ 和动量 $(h u, h v)$ 作为模态场。仅将地形 $b$ 存储在面上的插值点处，以减少内存。使用对次数 $p$ 精确的体积求积将源项 $-g h \\nabla b$ 投影到次数 $p$ 上，并使用标准的 Rusanov 求解器计算通量，不进行静水压重构。通过剪裁负的节点值并相应地调整 $\\eta$ 来对 $h$ 应用保正限制器，但不分解为平衡和扰动。假设使用和因子分解，声称每步成本为 $\\mathcal{O}(N_e\\, p^3)$，内存为 $\\mathcal{O}(N_e\\, p^2)$。\n\nD) 使用水深 $h$ 和动量作为主要场，但为自由面高程 $\\eta$ 维护一个单独的节点场以支持平衡态检测。在 GLL 节点上存储地形。使用配置的 GLL 求积计算通量和源项，并在面上使用标准的 Harten–Lax–van Leer (HLL) 通量，不作修改。在计算源项之前，对 $(h u, h v)$ 应用 TVB 限制器，对 $\\eta$ 应用保正限制器，以确保非负性。使用和因子分解时，每步复杂度为 $\\mathcal{O}(N_e\\, p^3)$，内存为 $\\mathcal{O}(N_e\\, p^2)$。\n\n哪个选项满足所有指定的要求？", "solution": "### 正确工作流的推导\n\n用于浅水方程的良好平衡 DG 格式必须精确保持“静湖”稳态，在该状态下，速度为零且自由面高程 $\\eta = h+b$ 为常数。该状态的特点是，由通量散度产生的压力梯度项与由地形梯度引起的源项之间存在精确的平衡。\n\n动量方程可以重写以明确显示这种平衡。对于 $x$ 方向动量，通量散度和源项结合为：\n$$\n\\partial_x \\left( \\frac{1}{2} g h^2 \\right) - S_x = g h \\, \\partial_x h - (-g h \\, \\partial_x b) = g h (\\partial_x h + \\partial_x b) = g h \\, \\partial_x \\eta\n$$\n如果一个数值格式对该项的离散近似在 $\\eta$ 为常数时为零，则该格式是良好平衡的。这要求对所有分量进行仔细、一致的离散化。\n\n一个鲁棒的良好平衡 DG 格式包含以下关键要素：\n\n1.  **变量选择：** 使用自由面高程 $\\eta$ 和动量分量 $(hu, hv)$ 作为主要演化多项式变量是非常有利的。在这种表述中，“静湖”条件简化为每个单元内的 $\\eta$ 是一个常数多项式，动量是零多项式。这自然导致项 $g h \\, \\partial_x \\eta$ 在单元内为零，因为常数的导数为零。\n\n2.  **源项和通量项的离散化：** 为了在单元内局部保持平衡，通量散度和源项的离散化必须兼容。对于节点 DG 格式，一种常见且有效的方法是用与解相同次数 $p$ 的多项式来表示地形 $b$，通常通过将其值存储在解节点（例如 Gauss-Legendre-Lobatto 节点）上。然后，水深 $h = \\eta - b$ 也是一个次数为 $p$ 的多项式。这样，就可以计算像 $g h \\, \\partial_x \\eta$ 这样的项。如果 $\\eta$ 表示为常数，则 $\\partial_x \\eta$ 在所有求积点上恒为零，从而确保平衡。\n\n3.  **界面通量处理：** 标准的近似 Riemann 求解器（例如 Rusanov, HLL, HLLC）在界面处会失效。对于“静湖”状态，$\\eta_L = \\eta_R = \\eta_0$，但如果 $b_L \\neq b_R$，则 $h_L \\neq h_R$。标准求解器会看到压力项 $\\frac{1}{2} g h^2$ 存在跳跃，并产生虚假的动量通量，从而破坏稳态。这通过**静水压重构**来修正。在调用 Riemann 求解器之前，左右状态 $(\\boldsymbol{U}_L, \\boldsymbol{U}_R)$ 会被修改。一种常见的重构方法是定义新的水深 $h_L^* = \\eta_L - b^*$ 和 $h_R^* = \\eta_R - b^*$，其中 $b^*$ 是在界面处为地形精心选择的单一值（例如，$b^*=\\max(b_L, b_R)$）。在“静湖”状态下，这导致 $h_L^* = h_R^*$。在水深相等且动量为零的情况下，用于齐次浅水方程的 Riemann 求解器会正确地在界面上产生零动量通量。\n\n4.  **限制器策略：** 为了在不破坏稳态的情况下处理激波，必须以良好平衡的方式应用限制器。对守恒变量 $(h, hu, hv)$ 或原始变量应用标准的 TVD/TVB 限制器会破坏精细的 $h+b=\\text{const}$ 平衡。正确的步骤是将解 $\\boldsymbol{U}$ 分解为平衡部分 $\\boldsymbol{U}_{eq}$ 和扰动部分 $\\boldsymbol{U}'$。平衡态通常在单元级别上定义为 $\\eta_{eq} = \\overline{\\eta}$（$\\eta$ 的单元平均值）和零动量。然后扰动为 $\\eta' = \\eta - \\eta_{eq}$ 和 $(hu)' = hu, (hv)' = hv$。斜率限制器*仅*应用于扰动 $\\boldsymbol{U}'$。最终的受限解通过加回平衡部分来重构。这确保了限制器不会在平衡态本身上被激活。\n\n5.  **复杂度和数据结构：** 对于在每个方向上具有 $(p+1)$ 个节点的张量积四边形网格上的二维节点 DG 格式，高效的实现依赖于**和因子分解**。\n    - **内存：** 解变量（$\\eta, hu, hv$）、地形（$b$）和几何因子（雅可比、度量项）必须存储在 $N_e \\times (p+1)^2$ 个节点中的每一个上。因此，主要内存占用为 $\\mathcal{O}(N_e p^2)$。\n    - **计算成本：**\n        - **体项：** 评估像散度这样的算子涉及沿每个张量方向应用一维微分矩阵。使用和因子分解，每个单元的成本为 $\\mathcal{O}(p^3)$，导致总体积成本为 $\\mathcal{O}(N_e p^3)$。\n        - **面项：** 这些涉及在每个单元的 4 个面上进行计算。每个面有 $(p+1)$ 个求积点。“提升”操作（将面积分传递给体积）涉及在每个面上进行大小为 $(p+1) \\times (p+1)$ 的矩阵向量乘法。这导致每个单元的成本为 $\\mathcal{O}(p^2)$，总面积分成本为 $\\mathcal{O}(N_e p^2)$。\n    - 当 $p>1$ 时，每个时间步的总成本由体项主导，按 $\\mathcal{O}(N_e p^3)$ 缩放。\n\n### 逐项选项分析\n\n**选项 A)**\n此选项提出的工作流与上述推导的原则完全一致。\n- **变量和数据结构：** 正确地选择 $(\\eta, hu, hv)$ 作为 GLL 节点上的节点场，地形 $b$ 也作为节点场存储。这是最优的。\n- **离散化：** 正确地指出了为实现平衡需要对源项和通量项进行一致的离散化。\n- **界面通量：** 正确地指定了使用静水压重构，并提供了一个有效的公式 $h^\\pm = \\max(0, \\eta^\\pm - \\max(b^\\pm_L, b^\\pm_R))$，这是一种标准且有效的方法。\n- **限制器：** 正确地描述了最先进的良好平衡限制器程序：分解为平衡态和扰动，仅对扰动进行限制，然后进行重构。\n- **复杂度：** 对于使用和因子分解的四边形节点 DG 格式，正确地指出了体项成本为 $\\mathcal{O}(N_e p^3)$，面项成本为 $\\mathcal{O}(N_e p^2)$，内存为 $\\mathcal{O}(N_e p^2)$。\n- **结论：** **正确**。\n\n**选项 B)**\n此选项包含多个基本错误。\n- **变量和数据结构：** 使用 $(h, u, v)$ 不是最优的。仅将地形 $b$ 存储为单元平均值（$p=0$ 表示）与高阶 ($p>0$) 方法不兼容，并且不可能保持具有倾斜底部的稳态。\n- **离散化：** 使用有限差分风格的重构来计算 $\\nabla b$ 与 DG 框架不一致，并且不会产生良好平衡的格式。\n- **界面通量：** 明确指出“不修改 Riemann 求解器”，这对于良好平衡格式是一个致命的缺陷。\n- **限制器：** 提议的限制器策略非标准，且未使用所需的平衡-扰动分解。\n- **复杂度：** 对于一个多项式次数为 $p$ 的二维方法，$\\mathcal{O}(N_e p)$ 的内存复杂度是不正确的；它应该是 $\\mathcal{O}(N_e p^2)$。\n- **结论：** **不正确**。\n\n**选项 C)**\n此选项也有几个主要缺陷。\n- **数据结构：** 仅在单元面上存储地形不足以平衡体项，体项需要单元内部 $b$ 的表示。\n- **界面通量：** 提议使用标准的 Rusanov 求解器，但“不进行静水压重构”，如前所述，这会破坏良好平衡性质。\n- **限制器：** 未能使用平衡-扰动分解，这对于良好平衡的限制器是必需的。\n- **复杂度：** 错误地将术语“和因子分解”应用于三角形单元，该技术并非为此设计，这表明存在概念错误。尽管存在针对三角形的快速方法，但这个理由在技术上是错误的。\n- **结论：** **不正确**。\n\n**选项 D)**\n此选项在其核心算法选择上存在严重错误。\n- **变量和数据结构：** 提议的变量集是多余且笨拙的。更重要的是，使用 $h$ 作为主要变量使良好平衡变得复杂。\n- **界面通量：** 与选项 B 和 C 一样，陷入了同样的陷阱，即使用标准的、未经修改的 HLL 通量，这不是良好平衡的。\n- **限制器：** 提议的限制策略没有包含平衡-扰动分解，因此不是良好平衡的。为了保正而限制 $\\eta$ 在概念上也是错误的；保正性适用于 $h$。\n- **结论：** **不正确**。", "answer": "$$\\boxed{A}$$", "id": "3428781"}]}