## 引言
在模拟众多物理现象时，双曲平衡律方程扮演着核心角色。这些方程不仅描述了量的守恒，还通过[源项](@entry_id:269111)刻画了外部力、几何效应或物理过程间的相互作用。一个关键挑战在于，许多物理系统倾向于演化至一种非平凡的定常态，在该状态下，通量的变化与[源项](@entry_id:269111)精确平衡。然而，标准的数值方法在离散这些方程时，其固有的[离散化误差](@entry_id:748522)往往会破坏这种精妙的平衡，即使从一个精确的定常态出发，也会产生虚假的[数值振荡](@entry_id:163720)，导致解随时间漂移。

这种数值上的不稳定性掩盖了对平衡态周围微小扰动的精确捕捉，而这对于[天气预报](@entry_id:270166)、天体[物理模拟](@entry_id:144318)和工程设计等应用至关重要。为了解决这一根本性问题，**守恒律平衡（well-balanced）**格式的概念应运而生。这类格式被精心设计，以在离散层面上精确保持一个或多个物理相关的定常态解。

本文旨在系统性地阐述用于平衡律的守恒律平衡间断伽辽金（DG）格式。我们将分为三个章节，引领读者深入理解这一先进的数值技术：
- 在 **“原理与机制”** 一章中，我们将首先严格定义守恒律平衡性质，并深入剖析实现该性质的多种核心数值机制，包括精确的源项求积、静水重构以及变量选择的智慧。
- 接着，在 **“应用与[交叉](@entry_id:147634)学科联系”** 一章中，我们将展示这些理论如何在地球物理流体、[空气动力学](@entry_id:193011)、天体物理学等广阔领域中得到应用，并探讨其与其他结构保持特性（如[熵稳定性](@entry_id:749023)和[能量守恒](@entry_id:140514)）的深刻联系。
- 最后，**“动手实践”** 部分提供了一系列精心设计的计算问题，旨在帮助读者将理论知识转化为解决实际问题的能力。

## 原理与机制

在[数值模拟](@entry_id:137087)领域，尤其是在求解包含[源项](@entry_id:269111)的双曲平衡律时，一个核心挑战是精确地捕捉和维持物理上的定常态解。许多标准数值格式在处理这类问题时，即使[初始条件](@entry_id:152863)精确地处于定常态，由于[离散化误差](@entry_id:748522)的存在，也会产生虚假的[振荡](@entry_id:267781)或伪流，导致解随时间演化而偏离平衡。为了克服这一缺陷，**守恒律平衡（well-balanced）**格式的概念应运而生。本章将深入探讨守恒律平衡格式背后的核心原理，并阐述实现这一性质的关键数值机制。

### 守恒律平衡性质的定义

为了理解守恒律平衡的概念，我们首先需要区分不同类型的定常态。考虑一个一维标量平衡律：
$$
\partial_t u(x,t) + \partial_x f(u(x,t)) = s(x,u(x,t))
$$
其中 $f(u)$ 是通量函数，$s(x,u)$ 是源项。一个**定常态（steady state）**解 $u^\star(x)$ 是指其不随时间变化，即 $\partial_t u^\star = 0$。这要求该解在任意时刻都满足通量梯度与[源项](@entry_id:269111)之间的精确平衡：
$$
\partial_x f(u^\star(x)) = s(x,u^\star(x))
$$

我们可以将定常态分为两类 [@problem_id:3428755]：

1.  **平凡定常态（Trivial Steady States）**：这类定常态中，解 $u^\star$ 在空间上是常数。这通常发生在源项为零（$s=0$）且几何效应不存在的情况下。此时，平衡方程简化为 $\partial_x f(u^\star) = 0$。如果 $f'(u^\star) \neq 0$，则必然有 $\partial_x u^\star = 0$。例如，对于无源的线性平流方程 $u_t + a u_x = 0$ 或无源的[伯格斯方程](@entry_id:177995) $u_t + (\frac{1}{2}u^2)_x = 0$，任何常数解 $u^\star = C$ 都是一个平凡定常态。

2.  **非平凡定常态（Nontrivial Steady States）**：这类定常态中，解 $u^\star(x)$ 在空间上不是常数。其空间变化是由非零的[源项](@entry_id:269111)或几何效应引起的，此时通量的空间梯度精确地抵消了这些效应。这类定常态在物理上极为重要。
    *   一个经典的例子是**浅水方程中的“静止湖泊”（lake at rest）**。该系统描述了水深 $h$ 和速度 $u$ 在变动的地形 $b(x)$ 上的演化。[动量守恒](@entry_id:149964)方程为 $\partial_t(hu) + \partial_x(hu^2 + \frac{1}{2}gh^2) = -g h \partial_x b$。在静止状态（$u=0$）下，为维持平衡，压力梯度必须与地形引起的重力分量[相平衡](@entry_id:136822)。这要求水面高程 $\eta^\star = h^\star + b$ 是一个常数。对该条件求导可得 $(\partial_x h^\star) + (\partial_x b) = 0$。将此关系代入[动量方程](@entry_id:197225)的定常形式，我们得到一个点态平衡条件 [@problem_id:3428823]：
        $$
        \partial_x \left( \frac{1}{2}g(h^\star)^2 \right) = g h^\star \partial_x h^\star = -g h^\star \partial_x b
        $$
        这精确地表明了水压[梯度力](@entry_id:166847)与地形坡度力的平衡。如果地形 $b(x)$ 不是平的，那么水深 $h^\star(x)$ 必须随空间变化以保持水面平坦，从而构成一个非平凡定常态。
    *   另一个例子是**有重[力场](@entry_id:147325)存在的等温[欧拉方程](@entry_id:177914)**。在静水（$u=0$）平衡下，压力梯度与重力[相平衡](@entry_id:136822)，即 $p_x = -\rho \phi_x$，其中 $\phi$ 是引力势。如果[引力场](@entry_id:169425)不均匀（$\phi_x \neq 0$），密度 $\rho(x)$ 必然会随空间变化，形成非平凡的静[水平衡](@entry_id:140465)。

基于以上讨论，我们可以给出守恒律平衡格式的正式定义。一个[数值格式](@entry_id:752822)被称为**守恒律平衡（well-balanced）**的，如果它能够在离散层面上精确地保持（即不产生数值误差）一个或多个物理相关的非平凡定常态。对于间断伽辽金（DG）方法，这一性质有更精确的数学描述。

在[DG方法](@entry_id:748369)中，解在每个单元 $K_i$ 内被表示为最高 $p$ 次的多项式。[半离散格式](@entry_id:165671)可以写为：
$$
\int_{K_i} \partial_t u_h \, v \, dx = \mathcal{R}_{K_i}(v; u_h)
$$
其中 $v$ 是任意一个 $p$ 次多项式测试函数，$\mathcal{R}_{K_i}$ 是包含[体积分](@entry_id:171119)、界面通量和源项离散的**半离散残差（semi-discrete residual）**。一个[DG格式](@entry_id:178043)是守恒律平衡的，当且仅当将一个精确的连续定常态解 $u^\star(x)$ 在DG空间中的表示（例如，$L^2$ 投影）$u_h^\star$ 代入[半离散格式](@entry_id:165671)时，所有单元上对于所有测试函数的残差均为零 [@problem_id:3428762]：
$$
\mathcal{R}_{K_i}(v; u_h^\star) = 0, \quad \forall v \in \mathbb{P}^p(K_i), \quad \forall i
$$
这个条件确保了 $\partial_t u_h^\star = 0$，即离散的定常态解在数值演化中保持静止。这一性质也被称为**离散C-性质（discrete C-property）** [@problem_id:3428836]。要验证此性质，必须证明在代入 $u_h^\star$ 后，离散的通量散度项（[体积分](@entry_id:171119)和界面通量贡献之和）与离散的[源项](@entry_id:269111)精确抵消。

### 实现守恒律平衡的数值机制

实现守恒律平衡性质的核心在于确保离散的通量梯度和源项之间能够精确抵消。这并非易事，需要精心设计[数值格式](@entry_id:752822)的各个组成部分。以下是一些关键机制。

#### 精确的[源项](@entry_id:269111)积分与平衡离散

在[DG方法](@entry_id:748369)的[弱形式](@entry_id:142897)中，源项以[体积分](@entry_id:171119) $\int_{K_j} s(x, u_h) v_h \, dx$ 的形式出现。这个积分通常使用**[数值求积](@entry_id:136578)（numerical quadrature）**来近似。一个直观的想法是，如果通量和[源项](@entry_id:269111)的积分都足够精确，它们的平衡关系或许就能在离散层面得以保持。

考虑一个[源项](@entry_id:269111) $s(x)$ 是 $x$ 的 $r$ 次多项式，而测试函数 $v_h$ 是最高 $p$ 次的多项式。那么被积函数 $s(x)v_h(x)$ 的最高次数为 $p+r$。一个具有 $N_q$ 个求积点的高斯-勒让德（Gauss-Legendre）[求积法则](@entry_id:753909)能够精确积分最高 $2N_q-1$ 次的多项式。为了精确计算[源项](@entry_id:269111)积分，我们必须满足 $2N_q-1 \ge p+r$。因此，所需的最小求积点数为 [@problem_id:3428824]：
$$
N_q = \left\lceil \frac{p + r + 1}{2} \right\rceil
$$

然而，仅仅精确地计算源项积分是不够的。守恒律平衡的关键在于**抵消**。即使源项和通量项都使用高精度求积，如果求积点或求积法则不匹配，离散后的两者之差也可能不为零。

为了说明这一点，考虑一个简单的反例 [@problem_id:3428767]。对于方程 $u_t + u_x = u_x$，任何[光滑函数](@entry_id:267124) $u(x)$ 都是其定常态。我们取定常态解 $u(x) = x^4$ 和测试函数 $\varphi(x) = x$。在[DG弱形式](@entry_id:748377)中，我们需要计算通量[体积分](@entry_id:171119) $\int_{-1}^1 f(u) \varphi_x \, dx = \int_{-1}^1 x^4 \, dx$ 和源项[体积分](@entry_id:171119) $\int_{-1}^1 s(u,x) \varphi \, dx = \int_{-1}^1 (4x^3) x \, dx = \int_{-1}^1 4x^4 \, dx$。在连续层面，这两个积分显然不相等，它们是通过与界面通量项组合才达到平衡的。但假设我们试图通过求积法则来平衡它们。如果我们对[通量积分](@entry_id:138365)使用3点[高斯求积](@entry_id:146011)（精确到5次多项式），而对源项积分使用2点[高斯求积](@entry_id:146011)（精确到3次多项式），由于被积函数 $x^4$ 和 $4x^4$ 都是4次多项式，[源项](@entry_id:269111)积分将被**积分不足（under-integrated）**。计算结果表明，这会导致一个非零的残差（在该例子中为 $\frac{32}{45}$），从而破坏了守恒律平衡性质。

一个更根本的方法是构造一个**守恒律平衡的[源项](@entry_id:269111)离散（well-balanced source term discretization）**。其思想是，不将源项 $s(u^\star, x)$ 视为一个独立函数，而是利用其与通量梯度的关系 $s(u^\star, x) = \partial_x f(u^\star(x))$。利用链式法则，我们得到 $s(u^\star, x) = f'(u^\star(x)) u_x^\star(x)$。我们可以定义一个特殊的离散源项，它在求积点上精确地等于通量梯度的离散。通过这种方式，只要选择一个对两个被积函数（通量项和[源项](@entry_id:269111)）都能精确积分的求积法则，就能保证它们的离散积分值相等，从而实现平衡 [@problem_id:3428749]。例如，如果 $u^\star(x)$ 是 $d$ 次多项式，$f(u)$ 是 $m$ 次多项式，那么通量项和源项的被积函数都是 $p+md-1$ 次多项式，所需的高斯求积点数为 $N_{\min} = \lceil \frac{p+md}{2} \rceil$。

#### 静水重构 (Hydrostatic Reconstruction)

对于浅水方程这类问题，地形 $b(x)$ 可能存在间断，或者在使用低阶方法（如 $p=0$，即[有限体积法](@entry_id:749372)）时，多项式[表示能力](@entry_id:636759)有限。在这些情况下，仅仅依赖于高精度的[体积分](@entry_id:171119)求积可能不足以维持平衡。**静水重构**是一种强大的、基于界面的技术，专门用于解决这个问题 [@problem_id:3428798]。

其核心思想是在计算界面通量之前，对界面左右两侧的状态（$h_L, u_L, b_L$ 和 $h_R, u_R, b_R$）进行修正。重构的目标是生成一组新的界面状态 $(h_L^*, (hu)_L^*)$ 和 $(h_R^*, (hu)_R^*)$，这组新状态满足局部的静[水平衡](@entry_id:140465)，即它们共享一个共同的、平坦的水面。

一个鲁棒的静水重构流程如下：
1.  **定义界面地形**：取界面两侧地形的较高者作为障碍物顶部，即 $b_I = \max(b_L, b_R)$。
2.  **定义界面水面**：为防止非物理地产生水体，取两侧水面的较低者，即 $H_I = \min(H_L, H_R)$，其中 $H_L=h_L+b_L$ 和 $H_R=h_R+b_R$。
3.  **计算重构水深**：基于公共的界面地形和水面，计算出唯一的水深。为保证水深非负，取 $h^* = \max(0, H_I - b_I)$。这个水深被同时用于左右两侧的重构状态，即 $h_L^*=h_R^*=h^*$。
4.  **计算重构动量**：将原始的速度应用于重构后的水深，即 $(hu)_L^* = h_L^* u_L$ 和 $(hu)_R^* = h_R^* u_R$。

当初始场为静止湖泊（$u=0, H_L=H_R=H_0$）时，重构动量 $(hu)^*$ 自动为零，且重构状态 $(h^*, 0)$ 在界面两侧完全相同。任何自洽的[数值通量](@entry_id:752791)（如Lax-Friedrichs或[Roe通量](@entry_id:754409)）在处理两个相同的输入状态时，其值等于物理通量。这将导致界面上的通量差为零，从而精确地平衡了地形[源项](@entry_id:269111)在[弱形式](@entry_id:142897)中的贡献，最终实现了守恒律平衡。

#### 重构变量的选择

对于高阶[DG方法](@entry_id:748369)（$p \ge 1$），在哪个变量空间中进行多项式重构，对守恒律平衡性质有着深远的影响，尤其是在源项非常强的情况下 [@problem_id:3428757]。

以带重[力场](@entry_id:147325)的等温[欧拉方程](@entry_id:177914)为例，其静[水平衡](@entry_id:140465)条件可以用两种等价的方式表达：
- 在**[守恒变量](@entry_id:747720)（conservative variables）** $(\rho, \rho u)$ 空间中，平衡关系是 $\partial_x p(\rho) = -\rho \partial_x \Phi(x)$。
- 在**平衡变量（equilibrium variables）** $(\rho u, \Pi)$ 空间中，其中 $\Pi = h(\rho) + \Phi(x)$，$h(\rho)$ 是比焓，平衡关系简化为 $\Pi = \text{常数}$。

假设我们直接对[守恒变量](@entry_id:747720) $\rho$ 进行多项式近似。由于精确的静[水平衡](@entry_id:140465)解 $\rho(x)$ 通常不是多项式，其多项式投影 $\rho_h(x)$ 无法在每个点上都满足平衡关系。这导致在离散的[动量方程](@entry_id:197225)中，压力梯度项和[源项](@entry_id:269111)无法精确抵消，从而产生误差。

相反，如果我们选择对平衡变量 $\Pi$ 进行多项式近似。静[水平衡](@entry_id:140465)态 $\Pi = \text{常数}$ 可以被任何次数的多项式**精确表示**（一个0次多项式即可）。因此，其导数 $\partial_x \Pi_h$ 在整个单元内恒为零。在计算[动量方程](@entry_id:197225)残差时，需要计算的平衡项 $\rho_h \partial_x \Pi_h$ 在所有求积点上都精确为零。这样，无论 $\rho_h$ 的值如何，压力梯度和源项的离散贡献都完美抵消，从而实现了精确的守恒律平衡。这种方法通过将物理平衡的简单性直接编码到[离散变量](@entry_id:263628)中，极大地增强了格式在强[源项](@entry_id:269111)背景下的鲁棒性。

### 实践中的陷阱：[算子分裂](@entry_id:634210)

在时间推进中，一种常见的做法是使用**[算子分裂](@entry_id:634210)（operator splitting）**方法，将复杂的方程分解为几个更简单的子问题。例如，将平衡律 $u_t = F(u) + S(u)$ 分裂为齐次[对流](@entry_id:141806)部分 $u_t = F(u)$ 和[源项](@entry_id:269111)部分 $u_t = S(u)$，然后交替求解。常见的分裂格式有Godunov分裂和[Strang分裂](@entry_id:755497)。

然而，这种做法通常会破坏守恒律平衡性质 [@problem_id:3428772]。其根本原因在于[对流](@entry_id:141806)算子 $F$ 和源项算子 $S$ 通常是**不可交换的（non-commutative）**，即它们的[李括号](@entry_id:636461) $[S, F] = DS \cdot F - DF \cdot S \neq 0$。根据Baker-Campbell-Hausdorff (BCH) 公式，分裂格式的演化算子与原方程的真实演化算子之间存在一个误差项，该误差项与李括号 $[S, F]$ 成正比。

当我们将分裂格式应用于一个精确的定常态解 $U^\star$ 时，尽管 $F(U^\star) + S(U^\star) = 0$，但由于 $[S, F](U^\star) \neq 0$，分裂格式会引入一个与 $\Delta t^2$ 成正比的“漂移项”，导致数值解偏离定常态。

幸运的是，对于**对称分裂格式**，如[Strang分裂](@entry_id:755497)（形式为S-F-S），其BCH展开中的二阶误差项的系数为 $(\alpha - 1/2)$，其中 $\alpha=1/2$。这意味着当且仅当使用对称分裂时，由算子不[可交换性](@entry_id:263314)引起的主导误差项才会消失。因此，虽然不分裂的、隐式处理源项的格式是实现守恒律平衡最理想的方式，但在必须使用[显式时间步进](@entry_id:168157)和[算子分裂](@entry_id:634210)的场合，采用Strang等对称分裂格式是维持守恒律平衡性质（至少到方法阶次）的必要条件。