{"hands_on_practices": [{"introduction": "在高阶DG方法中应用限制器的第一步是准确地识别出包含激波或未解析梯度的“问题单元”。Persson-Peraire传感器是一种基于解的模态系数能量分布的有效工具。这项练习将指导您理解并实现这一关键的间断检测器，它通过量化最高阶模态所含能量的比例来判断解的光滑度[@problem_id:3400893]。", "problem": "给你一个参考三角形上的高阶间断 Galerkin (DG) 离散化，该离散化使用一个 Dubiner 模态基。此基相对于参考单元上的标准 $L^{2}$ 内积是标准正交的。一个 Dubiner 基是按总次数组织的：对于多项式次数 $p$，模态系数的集合为 $\\{ \\hat{u}_{i,j} \\}_{i,j \\ge 0,\\, i+j \\le p}$。假设系数存储在一个一维数组中，首先按总次数 $n = i + j$ 从 $n=0$ 到 $n=p$ 升序排列，在每个总次数 $n$ 内部，再按 $i = 0,1,\\dots,n$ 升序排列，其中 $j = n-i$。模态总数为 $N_{p} = \\frac{(p+1)(p+2)}{2}$。\n\n适用于一维 Legendre 多项式的 Persson–Peraire 矩衰减传感器通过比较最高总次数模态所携带的能量与总能量，可以推广到三角形上。设总模态能量为\n\n$$\nE_{\\mathrm{tot}} = \\sum_{i+j \\le p} \\hat{u}_{i,j}^{2},\n$$\n\n以及最高阶能量为\n\n$$\nE_{p} = \\sum_{i+j = p} \\hat{u}_{i,j}^{2}.\n$$\n\n定义传感器\n\n$$\nS = \\log_{10}\\!\\left( \\frac{E_{p}}{E_{\\mathrm{tot}} + \\varepsilon} \\right),\n$$\n\n其中 $\\varepsilon$ 是一个小的正则化项，以避免除以零。如果 $S > \\tau$，则一个单元被标记为问题单元，其中 $\\tau$ 是选定的阈值。假设 $\\varepsilon = 10^{-16}$ 且 $\\tau = -3$。\n\n仅从这些核心定义和 Dubiner 基的标准正交性出发，完成以下任务：\n\n1. 推导传感器 $S$ 关于存储的模态系数 $\\hat{u}_{i,j}$ 的表达式，并解释为什么标准正交性意味着在参考三角形上计算 $E_{\\mathrm{tot}}$ 和 $E_{p}$ 时不需要几何度量因子。\n\n2. 提出一个算法，仅使用存储的系数和已知的存储顺序来高效计算 $S$，而无需在物理空间中重构解。你的算法必须是 $ \\mathcal{O}(N_{p}) $ 的，并且必须避免显式的几何变换。说明如何在仅依赖于 $p$ 的预计算后，以常数时间计算对应于最高总次数 $p$ 的索引范围。\n\n3. 解释为什么该传感器对单元内的斜激波敏感，即使激波与坐标轴不对齐，并将其与最高总次数矩的分布情况联系起来。\n\n4. 实现一个程序，为以下每个测试案例计算问题单元标志。在每个案例中，根据指定的规则构造一维系数数组 $[\\hat{u}_{0,0}, \\hat{u}_{1,0}, \\hat{u}_{0,1}, \\hat{u}_{2,0}, \\hat{u}_{1,1}, \\hat{u}_{0,2}, \\dots]$。对每个案例，计算 $S$ 并输出结果，如果单元是问题单元则输出 $1$，否则输出 $0$，使用 $\\tau = -3$ 和 $\\varepsilon = 10^{-16}$。\n\n   - 案例 A (光滑): $p = 4$。对于每个 $(i,j)$ 满足 $i+j \\le p$，设置 $\\hat{u}_{i,j} = \\alpha \\, \\rho^{\\, i + j}$，其中 $\\alpha = 7 \\times 10^{-1}$ 和 $\\rho = 2 \\times 10^{-1}$。\n\n   - 案例 B (类激波的代数衰减): $p = 5$。对于每个 $(i,j)$，设置 $\\hat{u}_{i,j} = \\dfrac{1}{1 + i + j}$。\n\n   - 案例 C (零场): $p = 3$。对于每个 $(i,j)$，设置 $\\hat{u}_{i,j} = 0$。\n\n   - 案例 D (斜激波各向异性替代): $p = 5$。对于每个 $(i,j)$，设置 $\\hat{u}_{i,j} = \\dfrac{1}{1 + i + 3 j}$。\n\n你的程序应生成一行输出，包含一个用方括号括起来的逗号分隔列表（例如，$[r_{A}, r_{B}, r_{C}, r_{D}]$），其中 $r_{\\bullet} \\in \\{0,1\\}$ 是相应测试案例的问题单元标志。\n\n此问题中的所有量都是无量纲的，不需要物理单位。角度（如果有）不使用。每个测试案例的预期输出类型为整数。该测试套件旨在覆盖一个光滑案例、一个强类激波案例、一个退化的零能量案例，以及一个加载高次数交叉耦合矩的各向异性斜激波替代案例。", "solution": "经评估，该问题有效。它在科学上植根于偏微分方程数值方法领域，特别是关于高阶间断 Galerkin (DG) 方法。该问题是适定的，提供了所有必要的定义、常数和数据，以得出一个唯一的、可验证的解。语言客观而精确，尽管对系数排序的描述存在轻微歧义，但通过一个具体示例得以澄清。\n\n### 1. 传感器表达式的推导及标准正交性的作用\n\n在参考三角形单元 $\\hat{K}$ 内的解 $u(\\mathbf{x})$ 表示为一个在标准正交 Dubiner 模态基 $\\{\\phi_{i,j}(\\mathbf{x})\\}_{i+j \\le p}$ 中的有限展开：\n$$\nu(\\mathbf{x}) = \\sum_{i,j \\ge 0, i+j \\le p} \\hat{u}_{i,j} \\phi_{i,j}(\\mathbf{x})\n$$\n其中 $\\hat{u}_{i,j}$ 是模态系数，$p$ 是最大多项式次数。指定该基相对于参考单元上的标准 $L^2$ 内积 $\\langle f, g \\rangle_{\\hat{K}} = \\int_{\\hat{K}} f(\\mathbf{x})g(\\mathbf{x}) d\\mathbf{x}$ 是标准正交的。此标准正交条件表示为：\n$$\n\\langle \\phi_{i,j}, \\phi_{k,l} \\rangle_{\\hat{K}} = \\delta_{ik}\\delta_{jl}\n$$\n其中 $\\delta$ 是克罗内克 δ 符号。\n\n参考单元上解的总能量是其 $L^2$-范数的平方，即 $\\|u\\|_{L^2(\\hat{K})}^2$。我们可以使用模态展开来表示它：\n$$\n\\|u\\|_{L^2(\\hat{K})}^2 = \\langle u, u \\rangle_{\\hat{K}} = \\left\\langle \\sum_{i+j \\le p} \\hat{u}_{i,j} \\phi_{i,j}, \\sum_{k+l \\le p} \\hat{u}_{k,l} \\phi_{k,l} \\right\\rangle_{\\hat{K}}\n$$\n根据内积的双线性，这变为：\n$$\n\\|u\\|_{L^2(\\hat{K})}^2 = \\sum_{i+j \\le p} \\sum_{k+l \\le p} \\hat{u}_{i,j} \\hat{u}_{k,l} \\langle \\phi_{i,j}, \\phi_{k,l} \\rangle_{\\hat{K}}\n$$\n代入标准正交条件 $\\langle \\phi_{i,j}, \\phi_{k,l} \\rangle_{\\hat{K}} = \\delta_{ik}\\delta_{jl}$：\n$$\n\\|u\\|_{L^2(\\hat{K})}^2 = \\sum_{i+j \\le p} \\sum_{k+l \\le p} \\hat{u}_{i,j} \\hat{u}_{k,l} \\delta_{ik}\\delta_{jl} = \\sum_{i+j \\le p} \\hat{u}_{i,j}^2\n$$\n这是帕塞瓦尔定理的一种表述。问题将总模态能量定义为 $E_{\\mathrm{tot}} = \\sum_{i+j \\le p} \\hat{u}_{i,j}^{2}$。因此，$E_{\\mathrm{tot}}$ 精确地是解的 $L^2$-范数的平方，其计算是系数平方的简单求和。不需要几何度量因子（例如，来自映射的雅可比行列式），因为基在参考单元 $\\hat{K}$ 上是标准正交的，并且所有计算都在这个参考空间中执行。\n\n由最高总次数模态携带的能量 $E_p$ 是总次数恰好为 $p$ 的系数平方和：\n$$\nE_p = \\sum_{i+j = p} \\hat{u}_{i,j}^{2}\n$$\n这个量分离出了所选多项式空间中最高频率基函数的能量贡献。\n\n然后，Persson–Peraire 传感器 $S$ 使用这些能量度量来定义：\n$$\nS = \\log_{10}\\!\\left( \\frac{E_{p}}{E_{\\mathrm{tot}} + \\varepsilon} \\right) = \\log_{10}\\!\\left( \\frac{\\sum_{i+j = p} \\hat{u}_{i,j}^{2}}{\\sum_{k+l \\le p} \\hat{u}_{k,l}^{2} + \\varepsilon} \\right)\n$$\n其中 $\\varepsilon$ 是一个小的正则化参数，用于防止解恒为零时除以零。此公式仅依赖于模态系数。\n\n### 2. 传感器计算的高效算法\n\n目标是设计一个 $\\mathcal{O}(N_p)$ 的算法，从一维模态系数数组中计算 $S$，其中 $N_p = \\frac{(p+1)(p+2)}{2}$ 是模态总数。问题指定系数首先按总次数 $n=i+j$ 升序排列（从 $n=0$ 到 $n=p$），并提供了一个存储模式示例 `[\\hat{u}_{0,0}, \\hat{u}_{1,0}, \\hat{u}_{0,1}, \\hat{u}_{2,0}, \\hat{u}_{1,1}, \\hat{u}_{0,2}, \\dots]`。这个例子清楚地表明，对于给定的总次数 $n$，模态是按索引 $i$ 降序排列的（从 $n$ 到 $0$）。虽然“升序 $i$”的描述与示例相矛盾，但示例本身提供了一个明确的排序方式，算法将使用该方式。\n\n要计算 $S$，我们需要计算两个和：$E_{\\mathrm{tot}}$，即所有系数的平方和；以及 $E_p$，即对应于总次数为 $p$ 的系数的平方和。\n\n总次数小于 $p$（即，直到 $p-1$ 次）的模态总数为 $N_{p-1} = \\frac{((p-1)+1)((p-1)+2)}{2} = \\frac{p(p+1)}{2}$。在一个从零开始索引的数组中，这些模态占据索引 $0, 1, \\dots, N_{p-1}-1$。因此，总次数为 $p$ 的模态从索引 $N_{p-1}$ 开始。次数为 $p$ 的模态数量是 $p+1$。\n\n给定 $p$，最高次数模态的起始索引可以在常数时间内计算：\n$$\n\\text{start\\_index}_p = N_{p-1} = \\frac{p(p+1)}{2}\n$$\n\n算法流程如下：\n1.  给定多项式次数 $p$ 和长度为 $N_p$ 的一维系数数组 `u_coeffs`。\n2.  计算最高次数模态的起始索引：`idx_start_p = p * (p + 1) // 2`。这是一个常数时间的预计算。\n3.  通过对最高次数模态的系数求平方和来计算 $E_p$。这对应于对数组从 `idx_start_p` 到末尾进行切片：\n    `E_p = sum(c*c for c in u_coeffs[idx_start_p:])`。\n4.  通过对数组中所有系数求平方和来计算 $E_{\\mathrm{tot}}$：\n    `E_tot = sum(c*c for c in u_coeffs)`。一个小优化是计算次数 $0$ 到 $p-1$ 的和，然后加上 $E_p$。\n5.  使用给定公式计算传感器值：\n    `S = log10(E_p / (E_tot + epsilon))`。\n6.  将 $S$与阈值 $\\tau$ 比较，以确定单元是否为问题单元。\n\n该算法涉及对系数数组进行常数次迭代。主要成本是计算 $E_{\\mathrm{tot}}$ 的求和，这与系数数量 $N_p$呈线性关系。因此，复杂度为 $\\mathcal{O}(N_p)$。不需要几何变换或在物理空间中重构解。\n\n### 3. 对斜激波的敏感性\n\nPersson–Peraire 传感器由于多项式近似的谱特性，能有效检测像激波这样尖锐、未充分解析的特征。\n- **谱衰减**：对于一个光滑（例如 $C^\\infty$）函数，其在多项式基中的展开系数衰减速度快于模态数的任何代数幂（即谱衰减）。在这种情况下，模态能量集中在低次数模态中，最高次数模态中的能量 $E_p$ 与总能量 $E_{\\mathrm{tot}}$ 相比极小。这导致比值 $E_p/E_{\\mathrm{tot}}$ 非常小，而 $S$ 的值则是一个大的负数，通常远低于阈值 $\\tau$。\n- **间断性**：当函数存在间断时，如激波，其谱系数衰减得慢得多，通常是代数性的（例如 $|\\hat{u}_k| \\sim 1/k$）。这种缓慢的衰减意味着需要大量能量分布在高次数模态上才能粗略地表示尖锐特征（吉布斯现象的一种表现）。因此，$E_p$ 将占 $E_{\\mathrm{tot}}$ 的一个不可忽略的部分。比值 $E_p/E_{\\mathrm{tot}}$ 将相对较大（例如，$10^{-3}$ 到 $10^{-1}$），导致 $S$ 的值大于阈值 $\\tau$。\n- **斜向**：斜激波是未与参考单元的自然坐标轴对齐的激波。Dubiner 基函数由一维多项式的乘积构成，具有与这些轴相关的固有方向特性。与坐标方向对齐的特征可能会强烈激发特定的模态子集（例如，那些 $j=0$ 或 $i=0$ 的模态）。然而，斜向特征不能被这样的子集有效表示，而是会投影到所有可用基函数的广泛组合上，包括 $i$ 和 $j$ 都不为零的交叉项。传感器的 $E_p = \\sum_{i+j=p} \\hat{u}_{i,j}^2$ 定义对*所有*最高次数的模态能量进行求和。因此，它在模态空间中是各向同性的；它对能量*如何*分布在次数为 $p$ 的 $p+1$ 个模态中不敏感，只对该次数上存在的总能量敏感。通过捕获总高频能量含量，该传感器能稳健地检测未充分解析的特征，而无论其相对于单元坐标系的方向如何。\n\n### 4. 实现\n\n以下程序实现了所述算法，用于对给定的测试案例进行分类。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the troubled-cell flag for several test cases of DG modal coefficients\n    using the Persson–Peraire moment-decay sensor.\n    \"\"\"\n    epsilon = 1e-16\n    tau = -3.0\n\n    test_cases = [\n        {\n            \"name\": \"Case A (smooth)\",\n            \"p\": 4,\n            \"rule\": lambda i, j: 7e-1 * (2e-1)**(i + j)\n        },\n        {\n            \"name\": \"Case B (shock-like algebraic decay)\",\n            \"p\": 5,\n            \"rule\": lambda i, j: 1.0 / (1.0 + i + j)\n        },\n        {\n            \"name\": \"Case C (zero field)\",\n            \"p\": 3,\n            \"rule\": lambda i, j: 0.0\n        },\n        {\n            \"name\": \"Case D (oblique-shock anisotropy surrogate)\",\n            \"p\": 5,\n            \"rule\": lambda i, j: 1.0 / (1.0 + i + 3.0 * j)\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        p = case[\"p\"]\n        rule = case[\"rule\"]\n\n        # 1. Generate coefficients based on the specified ordering.\n        # The ordering is by total degree n = i + j, and for each n, by descending i.\n        # This follows the problem's explicit example: [u_00, u_10, u_01, u_20, ...].\n        coeffs_list = []\n        for n in range(p + 1):\n            for i in range(n, -1, -1):\n                j = n - i\n                coeffs_list.append(rule(i, j))\n        \n        u_hat = np.array(coeffs_list, dtype=np.float64)\n\n        # 2. Compute the start index for the highest-degree (p) modes.\n        # Number of modes up to degree p-1 is N_{p-1} = p*(p+1)/2.\n        start_index_p = p * (p + 1) // 2\n\n        # 3. Calculate E_p and E_tot.\n        if u_hat.size > 0:\n            u_hat_sq = u_hat**2\n            # Energy in highest-degree modes\n            E_p = np.sum(u_hat_sq[start_index_p:])\n            # Total energy\n            E_tot = np.sum(u_hat_sq)\n        else: # Handles p  0, though not in test cases\n            E_p = 0.0\n            E_tot = 0.0\n\n        # 4. Compute the sensor S.\n        # Use np.log10 for base-10 logarithm.\n        # The ratio is E_p / (E_tot + epsilon).\n        # np.log10(0) returns -inf, which is correctly handled.\n        ratio = E_p / (E_tot + epsilon)\n        # It's possible for E_p and E_tot to be extremely small, making the ratio\n        # effectively zero due to floating point precision before log10 is taken.\n        if ratio  1e-300: # np.log10(small_number) -> -inf\n            S = -np.inf\n        else:\n            S = np.log10(ratio)\n\n        # 5. Determine if the cell is troubled.\n        is_troubled = 1 if S > tau else 0\n        results.append(is_troubled)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3400893"}, {"introduction": "一旦识别出问题单元，下一步就是局部地修正解以强制施加物理约束，例如保持正定性或满足局部极值原理。本练习将让您亲手操作一个分层矩限制器的具体计算过程，这是一种从最高阶到最低阶依次调整多项式模态系数的常用策略。通过这个计算，您将具体理解限制器如何在抑制数值振荡的同时，尽可能地保留高阶方法的精度[@problem_id:3400905]。", "problem": "考虑一个一维空间和一个间断 Galerkin (DG) 离散化的单元，该单元被映射到参考区间 $\\xi \\in [-1,1]$。设局部 DG 近似在标准 Legendre 多项式基 $\\{P_{0}(\\xi),P_{1}(\\xi),P_{2}(\\xi),P_{3}(\\xi)\\}$ 中展开：\n$$\nu_{i}(\\xi) \\;=\\; a_{0} P_{0}(\\xi) \\;+\\; a_{1} P_{1}(\\xi) \\;+\\; a_{2} P_{2}(\\xi) \\;+\\; a_{3} P_{3}(\\xi),\n$$\n其模态向量为 $(a_{0},a_{1},a_{2},a_{3})$。假设 $P_{0}(\\xi)=1$, $P_{1}(\\xi)=\\xi$, $P_{2}(\\xi)=\\frac{3\\xi^{2}-1}{2}$ 和 $P_{3}(\\xi)=\\frac{5\\xi^{3}-3\\xi}{2}$，因此对于所有 $k$，$P_{k}(1)=1$ 且 $P_{k}(-1)=(-1)^{k}$。单元平均值等于 $a_{0}$，因为对于 $k\\ge 1$ 有 $\\int_{-1}^{1} P_{k}(\\xi)\\,\\mathrm{d}\\xi=0$，且 $\\int_{-1}^{1} P_{0}(\\xi)\\,\\mathrm{d}\\xi=2$。\n\n给定三阶模态向量\n$$\n(a_{0},a_{1},a_{2},a_{3}) \\;=\\; (0.9,\\,0.2,\\,0.1,\\,0.15),\n$$\n以及相邻单元的平均值 (均值)\n$$\n\\bar{u}_{i-1} \\;=\\; 0.6, \\qquad \\bar{u}_{i+1} \\;=\\; 1.1.\n$$\n通过以下方式定义右侧界面 (在 $\\xi=+1$ 处) 的容许界限\n$$\nL^{+} \\;=\\; \\min\\{\\bar{u}_{i},\\bar{u}_{i+1}\\} \\;=\\; \\min\\{a_{0},\\bar{u}_{i+1}\\}, \\qquad U^{+} \\;=\\; \\max\\{\\bar{u}_{i},\\bar{u}_{i+1}\\} \\;=\\; \\max\\{a_{0},\\bar{u}_{i+1}\\},\n$$\n以及左侧界面 (在 $\\xi=-1$ 处) 的容许界限\n$$\nL^{-} \\;=\\; \\min\\{\\bar{u}_{i-1},\\bar{u}_{i}\\} \\;=\\; \\min\\{\\bar{u}_{i-1},a_{0}\\}, \\qquad U^{-} \\;=\\; \\max\\{\\bar{u}_{i-1},\\bar{u}_{i}\\} \\;=\\; \\max\\{\\bar{u}_{i-1},a_{0}\\}.\n$$\n\n应用一种 Krivodonova 方法思想的分层矩限制器，按如下方式在界面 $\\xi=\\pm 1$ 处强制施加界面界限。对于 $k=3,2,1$，更新 $a_{k}$，同时保持所有其他系数为其当前值不变。令 $S_{+}^{\\neq k}$ 表示除 $a_{k}$ 外所有模态对 $u_{i}(+1)$ 的贡献，令 $S_{-}^{\\neq k}$ 表示除 $a_{k}$ 外所有模态对 $u_{i}(-1)$ 的贡献，即：\n$$\nS_{+}^{\\neq k} \\;=\\; \\sum_{m\\neq k} a_{m} P_{m}(1), \\qquad S_{-}^{\\neq k} \\;=\\; \\sum_{m\\neq k} a_{m} P_{m}(-1).\n$$\n根据右侧界面计算 $a_{k}$ 的容许区间，\n$$\nI_{k}^{+} \\;=\\; \\left[\\,L^{+} - S_{+}^{\\neq k},\\; U^{+} - S_{+}^{\\neq k}\\,\\right],\n$$\n并根据左侧界面，使用 $P_{k}(-1)=(-1)^{k}$，计算容许区间，\n$$\nI_{k}^{-} \\;=\\; \\left\\{ a_{k}\\in\\mathbb{R} \\;:\\; L^{-} \\le S_{-}^{\\neq k} + a_{k} P_{k}(-1) \\le U^{-} \\right\\}.\n$$\n等价地，\n$$\nI_{k}^{-} \\;=\\; \\begin{cases}\n\\left[\\,L^{-} - S_{-}^{\\neq k},\\; U^{-} - S_{-}^{\\neq k}\\,\\right],  \\text{若 } P_{k}(-1)=+1, \\\\\n\\left[\\,S_{-}^{\\neq k} - U^{-},\\; S_{-}^{\\neq k} - L^{-}\\,\\right],  \\text{若 } P_{k}(-1)=-1.\n\\end{cases}\n$$\n设置限制后的系数\n$$\na_{k}^{\\text{lim}} \\;=\\; \\operatorname{clamp}\\!\\left( a_{k},\\; I_{k}^{+} \\cap I_{k}^{-} \\right),\n$$\n其中 $\\operatorname{clamp}(x,[\\ell,u])=\\min\\{\\max\\{x,\\ell\\},u\\}$ 并且在此设置中假定交集 $I_{k}^{+}\\cap I_{k}^{-}$ 非空。从 $k=3$ 降到 $k=1$ 分层进行，每一步都就地更新 $a_{k}$。不要更改 $a_{0}$。\n\n计算由该分层限制器产生的限制后的模态向量 $(a_{0}^{\\text{lim}},a_{1}^{\\text{lim}},a_{2}^{\\text{lim}},a_{3}^{\\text{lim}})$。以限制后系数的向量形式提供你的最终答案。如果任何算术运算导致多个候选值，请选择指定交集中的唯一值。无需四舍五入。", "solution": "首先对问题进行验证。问题陈述清晰、自洽，并对间断 Galerkin 方法中使用的分层矩限制器程序提供了科学依据充分的描述。所有必需的数据、定义和约束均已提供。该程序在算法上是确定性的且适定的。不存在矛盾、歧义或违反科学原理之处。因此，该问题被视为有效，并将提供解答。\n\n目标是通过对初始模态向量 $(a_{0}, a_{1}, a_{2}, a_{3}) = (0.9, 0.2, 0.1, 0.15)$ 应用分层矩限制器来计算限制后的模态向量 $(a_{0}^{\\text{lim}}, a_{1}^{\\text{lim}}, a_{2}^{\\text{lim}}, a_{3}^{\\text{lim}})$。限制器从最高阶模态 $k=3$ 开始，按顺序降至 $k=1$，并就地更新系数。代表单元平均值的零阶模态 $a_{0}$ 保持不变。\n\n首先，我们确定单元界面 $\\xi=+1$ 和 $\\xi=-1$ 处解的容许界限。给定的数据如下：\n-   单元平均值：$\\bar{u}_{i} = a_{0} = 0.9$。\n-   左相邻单元平均值：$\\bar{u}_{i-1} = 0.6$。\n-   右相邻单元平均值：$\\bar{u}_{i+1} = 1.1$。\n\n右侧界面 ($\\xi=+1$) 的界限为：\n$$\nL^{+} = \\min\\{a_{0}, \\bar{u}_{i+1}\\} = \\min\\{0.9, 1.1\\} = 0.9\n$$\n$$\nU^{+} = \\max\\{a_{0}, \\bar{u}_{i+1}\\} = \\max\\{0.9, 1.1\\} = 1.1\n$$\n因此，$\\xi=+1$ 处的解必须位于区间 $[0.9, 1.1]$ 内。\n\n左侧界面 ($\\xi=-1$) 的界限为：\n$$\nL^{-} = \\min\\{\\bar{u}_{i-1}, a_{0}\\} = \\min\\{0.6, 0.9\\} = 0.6\n$$\n$$\nU^{-} = \\max\\{\\bar{u}_{i-1}, a_{0}\\} = \\max\\{0.6, 0.9\\} = 0.9\n$$\n因此，$\\xi=-1$ 处的解必须位于区间 $[0.6, 0.9]$ 内。\n\nLegendre 多项式在界面处的值为 $P_{k}(1) = 1$ 和 $P_{k}(-1) = (-1)^{k}$。分层限制过程从初始模态向量 $(a_{0}, a_{1}, a_{2}, a_{3}) = (0.9, 0.2, 0.1, 0.15)$ 开始。\n\n**步骤 1：限制 $a_{3}$ (对于 $k=3$)**\n\n当前模态向量为 $(0.9, 0.2, 0.1, 0.15)$。我们限制 $a_{3} = 0.15$。\n界面处来自其他模态的贡献总和为：\n$$\nS_{+}^{\\neq 3} = \\sum_{m=0}^{2} a_{m} P_{m}(1) = a_{0} + a_{1} + a_{2} = 0.9 + 0.2 + 0.1 = 1.2\n$$\n$$\nS_{-}^{\\neq 3} = \\sum_{m=0}^{2} a_{m} P_{m}(-1) = a_{0} P_{0}(-1) + a_{1} P_{1}(-1) + a_{2} P_{2}(-1) = a_{0} - a_{1} + a_{2} = 0.9 - 0.2 + 0.1 = 0.8\n$$\n界面处解的值为 $u_{i}(1) = S_{+}^{\\neq 3} + a_{3} P_{3}(1) = 1.2 + a_{3}$ 和 $u_{i}(-1) = S_{-}^{\\neq 3} + a_{3} P_{3}(-1) = 0.8 - a_{3}$。\n\n根据右侧界面约束 $L^{+} \\le u_{i}(1) \\le U^{+}$， $a_{3}$ 的容许区间为：\n$$\n0.9 \\le 1.2 + a_{3} \\le 1.1 \\implies -0.3 \\le a_{3} \\le -0.1\n$$\n因此，$I_{3}^{+} = [-0.3, -0.1]$。\n\n根据左侧界面约束 $L^{-} \\le u_{i}(-1) \\le U^{-}$， $a_{3}$ 的容许区间为：\n$$\n0.6 \\le 0.8 - a_{3} \\le 0.9 \\implies -0.2 \\le -a_{3} \\le 0.1 \\implies -0.1 \\le a_{3} \\le 0.2\n$$\n因此，$I_{3}^{-} = [-0.1, 0.2]$。\n\n这些区间的交集为 $I_{3} = I_{3}^{+} \\cap I_{3}^{-} = [-0.3, -0.1] \\cap [-0.1, 0.2] = \\{-0.1\\}$。\n限制后的系数 $a_{3}^{\\text{lim}}$ 是通过将原始值 $a_{3}=0.15$ 钳位到该区间得到的：\n$$\na_{3}^{\\text{lim}} = \\operatorname{clamp}(0.15, [-0.1, -0.1]) = -0.1\n$$\n模态向量更新为 $(0.9, 0.2, 0.1, -0.1)$。\n\n**步骤 2：限制 $a_{2}$ (对于 $k=2$)**\n\n当前模态向量为 $(0.9, 0.2, 0.1, -0.1)$。我们限制 $a_{2} = 0.1$。其他系数，包括新限制的 $a_{3}^{\\text{lim}}$，保持不变。\n来自其他模态的贡献总和为：\n$$\nS_{+}^{\\neq 2} = a_{0} + a_{1} + a_{3} = 0.9 + 0.2 + (-0.1) = 1.0\n$$\n$$\nS_{-}^{\\neq 2} = a_{0} - a_{1} - a_{3} = 0.9 - 0.2 - (-0.1) = 0.8\n$$\n界面处解的值为 $u_{i}(1) = S_{+}^{\\neq 2} + a_{2}$ 和 $u_{i}(-1) = S_{-}^{\\neq 2} + a_{2}$，因为 $P_{2}(-1) = 1$。\n\n根据右侧界面的 $a_{2}$ 区间为：\n$$\n0.9 \\le 1.0 + a_{2} \\le 1.1 \\implies -0.1 \\le a_{2} \\le 0.1\n$$\n因此，$I_{2}^{+} = [-0.1, 0.1]$。\n\n根据左侧界面的 $a_{2}$ 区间为：\n$$\n0.6 \\le 0.8 + a_{2} \\le 0.9 \\implies -0.2 \\le a_{2} \\le 0.1\n$$\n因此，$I_{2}^{-} = [-0.2, 0.1]$。\n\n交集为 $I_{2} = I_{2}^{+} \\cap I_{2}^{-} = [-0.1, 0.1] \\cap [-0.2, 0.1] = [-0.1, 0.1]$。\n限制后的系数 $a_{2}^{\\text{lim}}$ 为：\n$$\na_{2}^{\\text{lim}} = \\operatorname{clamp}(0.1, [-0.1, 0.1]) = 0.1\n$$\n原始值 $a_{2}=0.1$ 已经在容许区间内，因此保持不变。模态向量仍为 $(0.9, 0.2, 0.1, -0.1)$。\n\n**步骤 3：限制 $a_{1}$ (对于 $k=1$)**\n\n当前模态向量为 $(0.9, 0.2, 0.1, -0.1)$。我们限制 $a_{1} = 0.2$。\n来自其他模态的贡献总和为：\n$$\nS_{+}^{\\neq 1} = a_{0} + a_{2} + a_{3} = 0.9 + 0.1 + (-0.1) = 0.9\n$$\n$$\nS_{-}^{\\neq 1} = a_{0} + a_{2} - a_{3} = 0.9 + 0.1 - (-0.1) = 1.1\n$$\n界面处解的值为 $u_{i}(1) = S_{+}^{\\neq 1} + a_{1}$ 和 $u_{i}(-1) = S_{-}^{\\neq 1} - a_{1}$，因为 $P_{1}(-1) = -1$。\n\n根据右侧界面的 $a_{1}$ 区间为：\n$$\n0.9 \\le 0.9 + a_{1} \\le 1.1 \\implies 0 \\le a_{1} \\le 0.2\n$$\n因此，$I_{1}^{+} = [0, 0.2]$。\n\n根据左侧界面的 $a_{1}$ 区间为：\n$$\n0.6 \\le 1.1 - a_{1} \\le 0.9 \\implies -0.5 \\le -a_{1} \\le -0.2 \\implies 0.2 \\le a_{1} \\le 0.5\n$$\n因此，$I_{1}^{-} = [0.2, 0.5]$。\n\n交集为 $I_{1} = I_{1}^{+} \\cap I_{1}^{-} = [0, 0.2] \\cap [0.2, 0.5] = \\{0.2\\}$。\n限制后的系数 $a_{1}^{\\text{lim}}$ 为：\n$$\na_{1}^{\\text{lim}} = \\operatorname{clamp}(0.2, [0.2, 0.2]) = 0.2\n$$\n原始值 $a_{1}=0.2$ 已经位于容许区间的边界上，因此保持不变。模态向量仍为 $(0.9, 0.2, 0.1, -0.1)$。\n\n根据定义，系数 $a_{0}$ 不变。因此，$a_{0}^{\\text{lim}}=0.9$。\n最终的限制后模态向量为 $(a_{0}^{\\text{lim}}, a_{1}^{\\text{lim}}, a_{2}^{\\text{lim}}, a_{3}^{\\text{lim}})$。\n汇总结果：\n$a_{0}^{\\text{lim}} = 0.9$\n$a_{1}^{\\text{lim}} = 0.2$\n$a_{2}^{\\text{lim}} = 0.1$\n$a_{3}^{\\text{lim}} = -0.1$\n\n最终的限制后向量为 $(0.9, 0.2, 0.1, -0.1)$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.9  0.2  0.1  -0.1 \\end{pmatrix}}\n$$", "id": "3400905"}, {"introduction": "虽然限制器对于捕捉激波的稳定性至关重要，但其应用并非没有代价。本练习探讨了一个关键的后果：对全局精度的潜在影响。通过一个理论分析，您将研究即使只有少数几个单元被限制（在这些单元上，近似解的阶数被降低），也可能主导全局误差，从而降低整个数值格式的收敛阶[@problem_id:3400884]。", "problem": "考虑在周期性区域 $[0,1]$ 上的一个一维标量守恒律，其具有光滑解 $u(x)$。该区域被一个由 $N$ 个尺寸为 $h = 1/N$ 的单元组成的均匀网格离散化。在每个单元上，使用多项式次数为 $p \\geq 2$ 的间断伽辽金（DG）方法，并在映射的参考区间 $[-1,1]$ 上采用标准的分层勒让德基。设单元 $I_j$ 上的 $p$ 次模态系数记为 $a_{p,j}$，其定义为局部DG多项式在标准正交勒让德基中展开的系数。考虑一个基于矩的限制器，当传感器 $S_j$ 超过一个阈值时，它会在单元 $I_j$ 上激活。传感器是最高阶模态系数的绝对值，即 $S_j = |a_{p,j}|$。当限制器激活时，它会将所有1次到 $p$ 次的矩置零（仅保留单元平均值）。假设在未被限制的单元上，DG格式对于光滑解是稳定且相容的，并且数值通量的选择使得全局截断误差与局部多项式逼近误差的行为一致。\n\n设光滑函数为 $u(x) = \\exp(-\\lambda (x - x_0)^2)$，其中 $\\lambda  0$ 且 $x_0 \\in (0,1)$ 为固定值。假设 $p$ 为偶数，因此 $x_0$ 是 $p$ 阶导数 $u^{(p)}(x)$ 的一个非退化的严格局部极大值点；特别地，$u^{(p)}(x_0) \\neq 0$ 且 $u^{(p+2)}(x_0)  0$。令 $x_j$ 表示单元 $I_j$ 的中心。通过对 $u$ 在 $x_j$ 周围进行泰勒展开，映射到参考单元，并利用勒让德正交性，可以得到单元 $I_j$ 上的最高阶模态系数具有展开式 $a_{p,j} = C_p h^{p+1} u^{(p)}(x_j) + \\mathcal{O}(h^{p+3})$，其中 $C_p$ 是一个非零常数，仅依赖于 $p$ 和勒让德归一化。定义阈值缩放关系\n$$\n\\tau(h) = |C_p| h^{p+1} \\Big( |u^{(p)}(x_0)| - \\tfrac{1}{2} |u^{(p+2)}(x_0)| c^2 h^2 \\Big),\n$$\n其中 $c  0$ 是一个固定的常数。因为 $x_0$ 是 $u^{(p)}$ 的一个严格局部极大值点，泰勒展开式 $u^{(p)}(x_j) = u^{(p)}(x_0) + \\tfrac{1}{2} u^{(p+2)}(x_0) (x_j - x_0)^2 + \\mathcal{O}((x_j - x_0)^4)$ 意味着 $|a_{p,j}|  \\tau(h)$ 当且仅当 $|x_j - x_0|  c h + \\mathcal{O}(h^2)$。在这种设计下，限制器会错误地在那些中心位于收缩区间 $[x_0 - c h, x_0 + c h]$ 内的单元上激活，当 $h \\to 0$ 时，该区间包含一个依赖于网格的、数量为 $\\mathcal{O}(1)$ 的单元。\n\n假设被限制的单元用其单元平均值替换局部多项式，而其他单元则保留 $p$ 次DG多项式。对于当 $h \\to 0$ 时的全局 $L^2$ 误差 $\\|u - u_h\\|_{L^2(0,1)}$，从第一性原理出发，推导 $\\mathcal{O}(1)$ 个被限制单元和 $\\mathcal{O}(N)$ 个未被限制单元的共存如何改变关于 $h$ 的渐近衰减率，并确定唯一的有理指数 $q$，使得 $\\|u - u_h\\|_{L^2(0,1)} = \\mathcal{O}(h^{q})$。\n\n你的最终答案必须是精确的有理数 $q$，它指明了由该限制器设计所导致的观测到的全局 $L^2$ 收敛阶。不需要四舍五入，也不应包含任何单位。", "solution": "### 问题验证\n\n**步骤1：提取已知条件**\n\n- **区域与离散化**：考虑在周期性区域 $[0,1]$ 上的一个一维标量守恒律。该区域被一个由 $N$ 个尺寸为 $h = 1/N$ 的单元 $I_j$ 组成的均匀网格离散化。\n- **数值方法**：在每个单元上使用多项式次数为 $p \\geq 2$ 的间断伽辽金（DG）方法。基函数是参考区间 $[-1,1]$ 上的标准分层勒让德多项式。\n- **模态系数**：$a_{k,j}$ 是单元 $I_j$ 上DG多项式的 $k$ 次模态系数。\n- **限制器机制**：\n    - **传感器**：$S_j = |a_{p,j}|$，即最高阶模态系数的绝对值。\n    - **激活条件**：如果 $S_j  \\tau(h)$，则限制器在单元 $I_j$ 上激活。\n    - **作用**：激活时，限制器将所有1次到 $p$ 次的矩置零，仅保留单元平均值（0次矩）。\n- **假定的解行为**：精确解是一个光滑函数 $u(x) = \\exp(-\\lambda (x - x_0)^2)$，其中 $\\lambda  0$ 且 $x_0 \\in (0,1)$。多项式次数 $p$ 假定为偶数。\n- **误差行为与阈值**：\n    - 最高阶模态系数有如下展开式：$a_{p,j} = C_p h^{p+1} u^{(p)}(x_j) + \\mathcal{O}(h^{p+3})$，其中 $C_p$ 是一个非零常数，$x_j$ 是单元 $I_j$ 的中心。\n    - 限制器的阈值由以下缩放关系给出：$\\tau(h) = |C_p| h^{p+1} \\Big( |u^{(p)}(x_0)| - \\tfrac{1}{2} |u^{(p+2)}(x_0)| c^2 h^2 \\Big)$，其中 $c  0$ 是一个固定的常数。\n- **被限制单元的局部化**：题目陈述，由于 $u(x)$ 和 $\\tau(h)$ 的选择，限制器激活的充要条件是 $|x_j - x_0|  c h + \\mathcal{O}(h^2)$。这意味着限制器在一组单元上激活，这些单元的中心位于一个大小为 $\\mathcal{O}(h)$ 的区间内，也就是说当 $h \\to 0$ 时，有 $\\mathcal{O}(1)$ 个单元被限制。\n- **一般性假设**：在未被限制的单元上，DG格式对于光滑解是稳定且相容的。全局截断误差的行为与局部多项式逼近误差一致。\n- **目标**：推导全局 $L^2$ 误差的渐近衰减率，$\\|u - u_h\\|_{L^2(0,1)} = \\mathcal{O}(h^q)$，并确定指数 $q$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n- **科学基础**：该问题位于偏微分方程数值分析这一成熟领域内，特别关注高阶间断伽辽金方法。所使用的所有概念——例如模态系数、勒让德多项式、矩限制器、单元平均值、$L^2$误差和收敛阶——都是该领域的标准概念。关于模态系数 $a_{p,j}$ 的假定展开式是DG方法分析光滑解时的经典结果。该问题设置正确地指出了一个简单限制器设计的潜在失效模式：在光滑极值点上的伪激活。一个局部的、低阶的误差如何污染全局的、高阶的解，是数值分析中的一个基本且有意义的课题。该问题具有坚实的科学原理基础。\n- **适定性**：该问题是适定的。它提供了足够的信息来确定全局误差行为。它指明了在被限制的（$p=0$ 投影）和未被限制的（$p$ 次投影）单元上逼近的性质，以及每类单元的数量。目标是找到一个唯一的、确定的有理数 $q$。\n- **客观性**：该问题使用精确的数学语言表述，没有任何主观或含糊的术语。\n\n**步骤3：结论与行动**\n\n问题陈述在科学上是合理的、适定的和客观的。它提出了一个数值分析中清晰且可解的问题。因此，该问题是**有效的**。我将继续推导解答。\n\n### 解答\n\n目标是确定全局 $L^2$ 误差的收敛阶 $q$，该误差定义为 $\\|u - u_h\\|_{L^2(0,1)}$。全局 $L^2$ 误差的平方可以表示为网格所有单元 $I_j$ 上局部 $L^2$ 误差平方的和：\n$$ \\|u - u_h\\|_{L^2(0,1)}^2 = \\sum_{j=1}^N \\|u - u_h\\|_{L^2(I_j)}^2 $$\n题目说明，区域被划分为两组单元：一组是数量为 $\\mathcal{O}(1)$ 的被限制单元，我们记为 $\\mathcal{L}$；另一组是数量为 $\\mathcal{O}(N)$ 的未被限制单元，记为 $\\mathcal{U}$。我们可以相应地将和式分解：\n$$ \\|u - u_h\\|_{L^2(0,1)}^2 = \\sum_{j \\in \\mathcal{U}} \\|u - u_h\\|_{L^2(I_j)}^2 + \\sum_{j \\in \\mathcal{L}} \\|u - u_h\\|_{L^2(I_j)}^2 $$\n我们将分别分析来自每组单元的贡献。\n\n**1. 来自未被限制单元（$\\mathcal{U}$）的贡献**\n\n对于单元 $j \\in \\mathcal{U}$，限制器不激活。数值解 $u_h$ 是标准的 $p$ 次DG多项式。题目陈述该格式是稳定且相容的，并且误差行为与多项式逼近误差一致。对于一个光滑函数 $u(x)$，在尺寸为 $h$ 的区间上，$p$ 次多项式的标准逼近理论给出的局部 $L^2$ 误差为：\n$$ \\|u - u_h\\|_{L^2(I_j)} = \\mathcal{O}(h^{p+1}) \\quad \\text{for } j \\in \\mathcal{U} $$\n未被限制单元的数量为 $|\\mathcal{U}| = N - |\\mathcal{L}|$。由于被限制单元的数量 $|\\mathcal{L}|$ 是 $\\mathcal{O}(1)$ 且 $N=1/h$，未被限制单元的数量为 $|\\mathcal{U}| = N - \\mathcal{O}(1) = \\mathcal{O}(N) = \\mathcal{O}(h^{-1})$。\n这些未被限制单元对全局误差平方的总贡献是：\n$$ \\sum_{j \\in \\mathcal{U}} \\|u - u_h\\|_{L^2(I_j)}^2 = \\sum_{j \\in \\mathcal{U}} \\left(\\mathcal{O}(h^{p+1})\\right)^2 = |\\mathcal{U}| \\cdot \\mathcal{O}(h^{2p+2}) $$\n$$ = \\mathcal{O}(h^{-1}) \\cdot \\mathcal{O}(h^{2p+2}) = \\mathcal{O}(h^{2p+1}) $$\n\n**2. 来自被限制单元（$\\mathcal{L}$）的贡献**\n\n对于单元 $j \\in \\mathcal{L}$，限制器激活并将局部多项式替换为其单元平均值。这意味着对于 $x \\in I_j$（其中 $j \\in \\mathcal{L}$），数值解 $u_h(x)$ 是一个常数，$u_h(x) = \\bar{u}_j$，其中 $\\bar{u}_j$ 是解 $u(x)$ 的单元平均值：\n$$ \\bar{u}_j = \\frac{1}{h} \\int_{I_j} u(x) dx $$\n这对应于到分片常数函数（0次多项式）空间上的 $L^2$ 投影。我们现在必须确定局部误差 $\\|u - \\bar{u}_j\\|_{L^2(I_j)}$。令 $x_j$ 为单元 $I_j$ 的中心。根据在区间 $I_j$ 上对零均值函数的 Poincaré-Friedrichs 不等式，存在一个与 $h$ 无关的常数 $C$，使得：\n$$ \\|v\\|_{L^2(I_j)}^2 \\le C h^2 \\|v'\\|_{L^2(I_j)}^2 \\quad \\text{for any } v \\text{ with } \\int_{I_j} v(x) dx = 0 $$\n令 $v(x) = u(x) - \\bar{u}_j$。根据构造，该函数在 $I_j$ 上的均值为零。其导数为 $v'(x) = u'(x)$。应用该不等式：\n$$ \\|u - \\bar{u}_j\\|_{L^2(I_j)}^2 \\le C h^2 \\|u'\\|_{L^2(I_j)}^2 = C h^2 \\int_{I_j} [u'(x)]^2 dx $$\n由于精确解 $u(x)$ 是光滑的，其导数 $u'(x)$ 在 $[0,1]$ 上是连续且有界的。对于长度为 $h$ 的小单元 $I_j$，该积分可以估计为：\n$$ \\int_{I_j} [u'(x)]^2 dx = [u'(x_j)]^2 h + \\mathcal{O}(h^2) = \\mathcal{O}(h) $$\n将此代回局部误差的不等式中：\n$$ \\|u - \\bar{u}_j\\|_{L^2(I_j)}^2 \\le C h^2 \\cdot \\mathcal{O}(h) = \\mathcal{O}(h^3) $$\n因此，在一个被限制单元上的局部 $L^2$ 误差为 $\\|u - \\bar{u}_j\\|_{L^2(I_j)} = \\mathcal{O}(h^{3/2})$。\n题目陈述被限制单元的数量为 $|\\mathcal{L}| = \\mathcal{O}(1)$。这些被限制单元对全局误差平方的总贡献是：\n$$ \\sum_{j \\in \\mathcal{L}} \\|u - u_h\\|_{L^2(I_j)}^2 = |\\mathcal{L}| \\cdot \\mathcal{O}(h^3) = \\mathcal{O}(1) \\cdot \\mathcal{O}(h^3) = \\mathcal{O}(h^3) $$\n\n**3. 总全局误差与收敛阶**\n\n结合两组单元的贡献，我们得到总的全局 $L^2$ 误差平方：\n$$ \\|u - u_h\\|_{L^2(0,1)}^2 = \\mathcal{O}(h^{2p+1}) + \\mathcal{O}(h^3) $$\n题目指明多项式次数为 $p \\geq 2$。这意味着指数 $2p+1$ 至少为 $2(2)+1 = 5$。\n当 $h \\to 0$ 时， $h$ 的最低次幂项将主导误差。比较指数 $2p+1$ 和 $3$：由于 $2p+1 \\ge 5$，我们有 $3  2p+1$。因此，来自被限制单元的 $\\mathcal{O}(h^3)$ 项是误差的主导来源。\n$$ \\|u - u_h\\|_{L^2(0,1)}^2 = \\mathcal{O}(h^3) $$\n为了求得全局 $L^2$ 误差的收敛阶 $q$，我们对上述表达式取平方根：\n$$ \\|u - u_h\\|_{L^2(0,1)} = \\sqrt{\\mathcal{O}(h^3)} = \\mathcal{O}(h^{3/2}) $$\n这表明全局 $L^2$ 误差以 $q = 3/2$ 的阶收敛。在那 $\\mathcal{O}(1)$ 个解被错误地降为分片常数逼近的单元中，误差污染了整个解，将全局收敛率从最优的 $\\mathcal{O}(h^{p+1})$ 降低到了 $\\mathcal{O}(h^{3/2})$。\n\n因此，指数 $q$ 是有理数 $3/2$。", "answer": "$$\\boxed{\\frac{3}{2}}$$", "id": "3400884"}]}