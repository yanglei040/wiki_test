{"hands_on_practices": [{"introduction": "在隐式大涡模拟（ILES）中，我们不添加显式的亚格子模型，而是依赖数值格式自身的耗散来充当亚格子应力的作用。本练习 ([@problem_id:3394693]) 让您亲身体验这一核心思想，通过一个简化的谱衰减模型，您将量化分析多项式阶数 $p$ 和数值通量参数 $\\alpha$ 如何影响解析尺度的能谱和总能量耗散。这个实践旨在帮助您建立对如何通过调整数值参数来“调谐”ILES行为的直观理解。", "problem": "考虑在一个边长为 $L$ 的周期性立方体域中的速度场 $u(x,t)$ 的不可压缩Navier-Stokes方程，\n$$\n\\frac{\\partial u}{\\partial t} + (u\\cdot\\nabla)u = -\\nabla p + \\nu \\nabla^2 u,\\quad \\nabla\\cdot u = 0,\n$$\n以及均匀各向同性湍流的动能谱 $E(k,t)$，其定义使得单位质量的总动能为\n$$\n\\mathcal{E}(t) = \\int_{0}^{\\infty} E(k,t)\\,dk.\n$$\n在大涡模拟（Large Eddy Simulation, LES）中，亚网格效应通过一个模化的耗散项体现。在使用间断Galerkin（Discontinuous Galerkin, DG）方法的隐式大涡模拟（Implicit Large Eddy Simulation, ILES）中，由单元间通量引入的数值稳定化机制充当了一种尺度选择性耗散，而无需显式的亚网格尺度模型。对于每个单元内 $p$ 次多项式表示和一个由无量纲强度参数 $\\alpha$（例如，与Lax–Friedrichs或Rusanov通量相关的参数）表征的单调数值通量，已知ILES机制会将耗散集中在高波数区域，而相对不影响大尺度结构。\n\n从无外力作用下衰减均匀各向同性湍流的能量平衡出发，谱能量满足\n$$\n\\frac{\\partial E(k,t)}{\\partial t} = -2\\,\\nu_{\\mathrm{eff}}(k)\\,k^2\\,E(k,t),\n$$\n其中 $\\nu_{\\mathrm{eff}}(k)$ 是一个有效粘度，它综合了物理粘度和数值耗散。在ILES中，主要贡献来自DG通量和单元间跳跃产生的数值部分，这是尺度依赖的。您的任务是通过量化衰减均匀各向同性湍流中已解析谱和耗散的变化，来分析ILES行为对多项式阶数 $p$ 和通量强度参数 $\\alpha$ 的敏感性。请使用以下建模和数值协议：\n\n- 使用边长为 $L = 2\\pi$ 的无量纲域，并将所有物理量视为无量纲。\n- 在整数波数 $k \\in \\{1,2,\\dots,K_{\\max}\\}$ 上表示谱，其中 $K_{\\max} = 64$。\n- 选择von Kármán形式的初始谱\n$$\nE(k,0) = C\\,k^4 \\exp\\!\\left(-2\\left(\\frac{k}{k_p}\\right)^2\\right),\n$$\n其中 $k_p = K_{\\max}/4$，并且 $C$ 的选择使得 $\\sum_{k=1}^{K_{\\max}} E(k,0) = 1$。\n- 考虑一个固定的网格，包含 $N_e = 32$ 个大小相等的单元，因此单元尺寸为 $h = L/N_e$。\n- 将由DG稳定化引起的ILES有效粘度建模为一个尺度选择性函数，该函数随波数和通量强度的增加而增加，随多项式阶数的增加而减少。具体来说，采用\n$$\n\\nu_{\\mathrm{eff}}(k;p,\\alpha) = \\alpha\\,\\frac{h}{L}\\,\\frac{1}{p+1}\\left(\\frac{k}{K_{\\max}}\\right)^{2p+1}.\n$$\n- 使用线性衰减模型的精确解，将谱演化到最终时间 $T = 1$：\n$$\nE(k,T) = E(k,0)\\,\\exp\\!\\left(-2\\,\\nu_{\\mathrm{eff}}(k;p,\\alpha)\\,k^2\\,T\\right).\n$$\n\n为每组参数 $(p,\\alpha)$ 计算的指标：\n1. 通过在波数区间 $k \\in [\\lfloor 0.2K_{\\max}\\rfloor, \\lfloor 0.5K_{\\max}\\rfloor]$ 上对 $\\log E(k,T)$ 与 $\\log k$ 进行最小二乘线性拟合，估算得到的解析谱斜率 $m$。将 $m$ 报告为一个实数（无单位）。\n2. 总耗散能量分数 $d$，定义为\n$$\nd = 1 - \\sum_{k=1}^{K_{\\max}} E(k,T),\n$$\n报告为一个十进制形式的实数。\n\n测试套件：\n- 案例1：$(p,\\alpha) = (0, 0.3)$。\n- 案例2：$(p,\\alpha) = (1, 0.3)$。\n- 案例3：$(p,\\alpha) = (3, 0.3)$。\n- 案例4：$(p,\\alpha) = (5, 0.3)$。\n- 案例5：$(p,\\alpha) = (3, 0.9)$。\n\n您的程序必须：\n- 实现上述谱模型，并为每个测试案例计算指标 $m$ 和 $d$。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按以下顺序包含各项指标：\n$$\n[m_1, d_1, m_2, d_2, m_3, d_3, m_4, d_4, m_5, d_5],\n$$\n其中 $(m_i, d_i)$ 对应案例 $i$，$i=1,\\dots,5$。\n\n不涉及角度。所有量均为无量纲。输出数字必须格式化为实数（浮点数）。最终时间为 $T=1$，必须严格按照规定使用。", "solution": "我们从周期性域中的速度场 $u(x,t)$ 和压力场 $p(x,t)$ 的不可压缩Navier-Stokes方程开始，\n$$\n\\frac{\\partial u}{\\partial t} + (u\\cdot\\nabla)u = -\\nabla p + \\nu \\nabla^2 u,\\quad \\nabla\\cdot u=0.\n$$\n对于均匀各向同性湍流，单位质量的动能可以用谱能量密度 $E(k,t)$ 来表示，其中\n$$\n\\mathcal{E}(t) = \\int_{0}^{\\infty} E(k,t)\\,dk,\n$$\n谱通常是在波数大小为 $k$ 的球壳上进行聚合的。在大涡模拟（LES）中，未解析的尺度贡献了有效耗散；在使用间断Galerkin（DG）方法的隐式大涡模拟（ILES）中，这种效应源于数值稳定化（例如，单调通量和界面惩罚），产生了一种额外的、具有尺度选择性的耗散机制。\n\n基于原理的ILES效应建模：我们寻求一个与DG稳定化的能量行为一致的降阶谱模型。在DG格式中，界面处的数值通量引入了与单元间跳跃成正比的耗散。对于一个 $p$ 次多项式，波数为 $k$ 的傅里葉模的主截断误差和界面跳跃幅值与 $(kh)^{p+1}$ 成比例，其中 $h$ 是单元尺寸。来自单调通量（如Rusanov/Lax–Friedrichs通量）的耗散项与强度参数 $\\alpha$ 乘以跳跃幅值的平方成比例，产生一个随 $k$ 快速增长的能量汇。将此映射到谱涡粘性概念上，我们构建一个依赖于波数的有效粘度 $\\nu_{\\mathrm{eff}}(k)$，它捕捉了数值格式在尺度 $k$ 上消耗能量的净速率。\n\n与这些原则一致的尺度选择性形式为\n$$\n\\nu_{\\mathrm{eff}}(k;p,\\alpha) = \\alpha\\,\\frac{h}{L}\\,\\frac{1}{p+1}\\left(\\frac{k}{K_{\\max}}\\right)^{2p+1},\n$$\n其中 $L$ 是域大小，$h$ 是单元尺寸，$K_{\\max}$ 是最大解析波数，$\\alpha$ 是一个无量纲通量强度参数（控制通量对单元间跳跃的阻尼强度），$p$ 是多项式阶数。因子 $\\left(\\frac{k}{K_{\\max}}\\right)^{2p+1}$ 反映了高阶DG方法将耗散集中在最高波数处：对于固定的 $k/K_{\\max}1$，增加 $p$ 会减小中等波数处的 $\\nu_{\\mathrm{eff}}$，但在非常接近 $K_{\\max}$ 的地方保持强耗散。前置因子 $\\frac{1}{p+1}$ 模拟了一个公认的趋势，即较高的多项式阶数会减少在解析尺度上的总数值耗散。因子 $\\frac{h}{L}$ 确保了在周期域内网格加密时具有一致的无量纲缩放特性。\n\n能量衰减模型：对于无外力作用的衰减均匀各向同性湍流，在一个未显式计算非线性传递的简化模型中，由粘性引起的每个波数上的能量衰减的一阶近似为\n$$\n\\frac{\\partial E(k,t)}{\\partial t} = -2\\,\\nu_{\\mathrm{eff}}(k)\\,k^2\\,E(k,t).\n$$\n这个关于时间的线性常微分方程有精确解\n$$\nE(k,T) = E(k,0)\\,\\exp\\!\\left(-2\\,\\nu_{\\mathrm{eff}}(k)\\,k^2\\,T\\right),\n$$\n对于任意最终时间 $T$。尽管这忽略了波数间的能量传递，但它分离出了数值耗散机制对 $p$ 和 $\\alpha$ 的敏感性，而这正是ILES敏感性分析的目标。\n\n初始谱：我们选择一个von Kármán谱\n$$\nE(k,0) = C\\,k^4 \\exp\\!\\left(-2\\left(\\frac{k}{k_p}\\right)^2\\right),\n$$\n其中 $k_p$ 是峰值波数，$C$ 将离散和归一化为1：\n$$\n\\sum_{k=1}^{K_{\\max}} E(k,0) = 1.\n$$\n该谱被广泛用于表示一个物理上合理的跨尺度能量分布，其特征是在低 $k$ 处上升，在 $k_p$ 处达到峰值，并在高 $k$ 处快速衰减。\n\n指标：为了量化解析谱和耗散的变化：\n1. 解析谱斜率 $m$ 是通过对数-对数坐标下，在中间范围 $k \\in [\\lfloor 0.2K_{\\max}\\rfloor, \\lfloor 0.5K_{\\max}\\rfloor]$ 内，使用最小二乘法拟合 $\\log E(k,T)$ 与 $\\log k$ 的关系计算得出的。这个区间避开了有限尺寸效应占主导的极低 $k$ 值，以及截断和极端阻尼占主導的极高 $k$ 值。斜率 $m$ 反映了解析谱的陡峭程度。\n2. 总耗散能量分数 $d$ 为\n$$\nd = 1 - \\sum_{k=1}^{K_{\\max}} E(k,T),\n$$\n考虑到归一化条件 $\\sum_{k=1}^{K_{\\max}} E(k,0) = 1$，该值衡量了到时间 $T$ 为止，因数值耗散而被移除的初始能量的比例。\n\n算法设计：\n- 设置 $L=2\\pi$，$K_{\\max}=64$，$k_p=K_{\\max}/4$，$N_e=32$，以及 $h=L/N_e$。\n- 构建离散数组 $k=1,2,\\dots,K_{\\max}$。\n- 形成未归一化的 $E(k,0)$，然后通过除以其离散和来计算 $C$，使得总能量为1。\n- 对于每个测试案例 $(p,\\alpha)$，计算 $\\nu_{\\mathrm{eff}}(k;p,\\alpha)$，然后使用 $T=1$ 的精确衰减公式计算 $E(k,T)$。\n- 通过在指定的 $k$ 区间上对 $\\log E$ 与 $\\log k$ 进行最小二乘线性回归来计算 $m$。\n- 通过离散求和计算 $d$。\n- 按指定顺序汇总输出：\n$$\n[m_1, d_1, m_2, d_2, m_3, d_3, m_4, d_4, m_5, d_5].\n$$\n\n解释：增加 $\\alpha$ 应会增加所有尺度上的 $\\nu_{\\mathrm{eff}}$，使谱变得更陡峭并增加 $d$。增加 $p$ 通常会减少中等波数处的耗散（由于 $(p+1)^{-1}$ 前置因子和更强的尺度选择性），可能使解析谱变得更平坦（在所选范围内 $m$ 不那么陡峭）并减少 $d$，同时仍将阻尼集中在 $K_{\\max}$ 附近。所选的测试套件涵盖了边界行为（$p=0$）、多项式阶数的影响（$p=1,3,5$）以及在 $p=3$ 时的高通量边缘情况（$\\alpha=0.9$）。\n\n所有量均为无量纲，不涉及角度。最终时间为 $T=1$ 并直接使用。程序打印单行输出，包含按指定顺序排列的五个案例的指标。", "answer": "```python\nimport numpy as np\n\ndef initial_spectrum(Kmax, kp):\n    k = np.arange(1, Kmax + 1, dtype=float)\n    E0 = (k**4) * np.exp(-2.0 * (k / kp) ** 2)\n    E0 /= E0.sum()  # Normalize total energy to 1\n    return k, E0\n\ndef nu_eff(k, Kmax, p, alpha, h, L):\n    # Effective viscosity model for ILES-DG:\n    # nu_eff(k; p, alpha) = alpha * (h/L) * 1/(p+1) * (k/Kmax)^(2p+1)\n    scale_selective = (k / Kmax) ** (2 * p + 1)\n    nu = alpha * (h / L) * (scale_selective) / (p + 1)\n    return nu\n\ndef evolve_spectrum(E0, k, nu, T):\n    # Exact solution of dE/dt = -2 * nu(k) * k^2 * E\n    decay = np.exp(-2.0 * nu * (k ** 2) * T)\n    return E0 * decay\n\ndef resolved_slope(E, k, Kmax):\n    # Fit log E vs log k over [floor(0.2*Kmax), floor(0.5*Kmax)]\n    k_min = int(np.floor(0.2 * Kmax))\n    k_max = int(np.floor(0.5 * Kmax))\n    # indices in 1-based k; Python uses 0-based\n    k_slice = np.arange(k_min, k_max + 1)\n    Ek = E[k_slice - 1]\n    kk = k_slice.astype(float)\n    # Guard against numerical underflow: ensure positivity\n    Ek = np.maximum(Ek, np.finfo(float).tiny)\n    x = np.log(kk)\n    y = np.log(Ek)\n    # Least squares fit y = m x + b\n    A = np.vstack([x, np.ones_like(x)]).T\n    m, b = np.linalg.lstsq(A, y, rcond=None)[0]\n    return m\n\ndef total_dissipation_fraction(E):\n    # Initial energy sum is 1 by construction\n    return 1.0 - E.sum()\n\ndef run_case(p, alpha, params):\n    L = params['L']\n    Kmax = params['Kmax']\n    kp = params['kp']\n    Ne = params['Ne']\n    T = params['T']\n    h = L / Ne\n\n    k, E0 = initial_spectrum(Kmax, kp)\n    nu = nu_eff(k, Kmax, p, alpha, h, L)\n    ET = evolve_spectrum(E0, k, nu, T)\n    m = resolved_slope(ET, k, Kmax)\n    d = total_dissipation_fraction(ET)\n    return m, d\n\ndef solve():\n    params = {\n        'L': 2.0 * np.pi,\n        'Kmax': 64,\n        'kp': 64 / 4,\n        'Ne': 32,\n        'T': 1.0,\n    }\n    # Test suite: (p, alpha)\n    test_cases = [\n        (0, 0.3),  # Case 1: boundary polynomial order\n        (1, 0.3),  # Case 2: low order\n        (3, 0.3),  # Case 3: moderate order\n        (5, 0.3),  # Case 4: high order\n        (3, 0.9),  # Case 5: high flux parameter\n    ]\n\n    results = []\n    for p, alpha in test_cases:\n        m, d = run_case(p, alpha, params)\n        results.append(f\"{m:.6f}\")\n        results.append(f\"{d:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3394693"}, {"introduction": "虽然数值耗散在ILES中是必要的，但某些数值误差却可能导致非物理性的能量“生成”，即能量回传（backscatter），这会严重破坏仿真的稳定性。本练习 ([@problem_id:3394720]) 聚焦于DG方法中能量回传的一个关键来源：非线性项的求积不精确。您将设计一个诊断工具，通过观察不恰当的求积格式如何导致解析能量增长，从而揭示这种违反基本守恒定律的现象。", "problem": "考虑一个一维周期性域，坐标 $x \\in [0, 2\\pi]$，以弧度为单位。令可解场由一个在包含 $N$ 个单元的均匀网格上、每个单元内为 $p$ 阶的不连续伽辽金 (DG) 多项式来近似。为了在大涡模拟 (LES) 中用不连续伽辽金方法替代非线性对流机制，使用无粘性伯格斯方程\n$$\nu_t + \\left( \\frac{u^2}{2} \\right)_x = 0,\n$$\n该方程设定了周期性边界条件和光滑初始条件\n$$\nu(x,0) = \\sin(x) + 0.25\\sin(3x) + 0.1\\sin(5x).\n$$\n假设每个单元上的 DG 近似通过勒让德多项式基在参考区间 $r \\in [-1, 1]$ 上表示为\n$$\nu_h(x) \\big|_K = \\sum_{n=0}^{p} \\hat{u}_n^{(K)} L_n\\!\\left( r(x) \\right),\n$$\n其中 $L_n(r)$ 是 $n$ 阶勒让德多项式， $K$ 为单元索引，$r(x)$ 是从物理单元到参考区间的仿射映射。单元长度为 $h = \\frac{2\\pi}{N}$，且雅可比行列式满足 $\\mathrm{d}x = \\frac{h}{2}\\,\\mathrm{d}r$ 和 $\\frac{\\mathrm{d}}{\\mathrm{d}x} = \\frac{2}{h}\\frac{\\mathrm{d}}{\\mathrm{d}r}$。\n\n从光滑周期解的守恒律能量恒等式出发：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{0}^{2\\pi} \\frac{u^2}{2}\\,\\mathrm{d}x = \\int_{0}^{2\\pi} \\frac{u^2}{2}\\,u_x\\,\\mathrm{d}x = \\frac{1}{6}\\int_{0}^{2\\pi} (u^3)_x\\,\\mathrm{d}x = 0.\n$$\n在 DG 离散化中，取测试函数 $v = u_h$，其弱形式下的半离散单元能量变化率可以写为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{K} \\frac{u_h^2}{2}\\,\\mathrm{d}x = \\int_{K} \\frac{u_h^2}{2}\\, (u_h)_x\\,\\mathrm{d}x \\;-\\; \\Big[ f^*(u_h)\\,u_h \\Big]_{\\partial K},\n$$\n其中 $f(u)=\\frac{u^2}{2}$，$f^*(u_h)$ 是一致性数值通量。如果近似解在单元界面上是全局连续的（例如，通过在共享节点处对光滑初始条件进行逐点插值得到），并且域是周期性的，那么对所有单元求和时，边界项会伸缩相消，只留下体积积分项控制全局可解能量变化率，\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{0}^{2\\pi} \\frac{u_h^2}{2}\\,\\mathrm{d}x = \\sum_{K} \\int_{K} \\frac{u_h^2}{2}\\, (u_h)_x\\,\\mathrm{d}x.\n$$\n当体积积分被精确计算时，光滑周期解产生的可解能量变化为零。然而，在实际的 DG-LES 中，体积积分是使用求积法计算的。非线性体积项的欠积分会引入求积混叠和非物理的能量转移（反向散射），表现为一个时间步长内可解能量出现正增量 $\\Delta E > 0$。\n\n对于一个 DG 多项式阶数 $p$，被积函数 $\\frac{u_h^2}{2} (u_h)_x$ 在参考坐标下是一个 $3p-1$ 阶的多项式。一个 $q_{\\mathrm{vol}}$ 点的勒让德-高斯求积法可以精确积分最高 $2q_{\\mathrm{vol}}-1$ 阶的多项式。因此，要精确计算体积积分，需要满足 $2q_{\\mathrm{vol}}-1 \\geq 3p-1$，即 $q_{\\mathrm{vol}} \\geq \\frac{3p}{2}$，而选择 $q_{\\mathrm{vol}}  \\frac{3p}{2}$ 会导致欠积分和可能的反向散射。\n\n您的任务是：\n1. 从第一性原理推导上述 DG 近似的离散可解能量变化率，并说明求积阶数如何决定体积积分是精确积分还是欠积分。\n2. 设计一个诊断工具，该工具基于可解能量增量来标记非物理能量转移\n$$\n\\Delta E = \\Delta t \\sum_{K} \\int_{K} \\frac{u_h^2}{2}\\,(u_h)_x\\,\\mathrm{d}x,\n$$\n此增量使用指定的 $q_{\\mathrm{vol}}$ 点勒让德-高斯求积计算。使用一个小的无量纲时间步长 $\\Delta t$，并将检测规则定义为：当且仅当 $\\Delta E > 0$ 时，“检测到反向散射”。以无量纲单位表示可解能量及其增量。\n\n实现一个程序，该程序：\n- 通过对给定初始条件在每个单元上的勒让德基进行 $L^2$ 投影来构造多项式 DG 近似。投影过程使用足够高阶的求积法。\n- 使用足够高阶的求积法计算初始可解能量\n$$\nE_0 = \\int_{0}^{2\\pi} \\frac{u_h^2}{2}\\,\\mathrm{d}x\n$$\n以表示多项式近似的“真实”可解能量。\n- 使用一个 $q_{\\mathrm{vol}}$ 点的勒让德-高斯求积法计算离散可解能量生成率\n$$\nR(q_{\\mathrm{vol}}) = \\sum_{K} \\int_{K} \\frac{u_h^2}{2}\\,(u_h)_x\\,\\mathrm{d}x\n$$\n- 形成 $\\Delta E = \\Delta t \\, R(q_{\\mathrm{vol}})$，如果 $\\Delta E > 0$ 则诊断标志 $d = 1$，否则 $d = 0$。\n\n使用以下参数集测试套件 $(p, N, q_{\\mathrm{vol}}, \\Delta t)$：\n- 情况 A（正常情况下的欠积分）：$(3, 8, 4, 10^{-3})$。\n- 情况 B（过积分）：$(3, 8, 8, 10^{-3})$。\n- 情况 C（较高阶下的中度欠积分）：$(4, 8, 5, 10^{-3})$。\n- 情况 D（低阶下的近乎精确积分）：$(1, 4, 2, 10^{-3})$。\n- 情况 E（严重欠积分）：$(5, 16, 3, 10^{-3})$。\n\n您的程序应生成单行输出，其中包含这五个情况的结果，以逗号分隔。对于每种情况，输出有序对 $[\\Delta E, d]$ 作为列表，其中 $\\Delta E$ 是一个浮点数，$d$ 是整数 $0$ 或 $1$。最终输出格式必须是以下形式的单行：\n`[[`$\\Delta E_A$`,`$d_A$`],[`$\\Delta E_B$`,`$d_B$`],[`$\\Delta E_C$`,`$d_C$`],[`$\\Delta E_D$`,`$d_D$`],[`$\\Delta E_E$`,`$d_E$`]]`\n不含任何额外文本或空格。", "solution": "该问题要求验证一个用于不连续伽辽金 (DG) 近似无粘性伯格斯方程中非物理能量生成（反向散射）的诊断工具。该诊断工具基于求积阶数对半离散能量守恒特性的影响。\n\n### 第 1 部分：离散可解能量变化率的推导\n\n该问题设定在一个周期性域 $x \\in [0, 2\\pi]$ 上，使用无粘性伯格斯方程，这是一个非线性对流的标准模型：\n$$\nu_t + \\left( \\frac{u^2}{2} \\right)_x = 0\n$$\n对于光滑的周期解，总动能 $E = \\int_{0}^{2\\pi} \\frac{u^2}{2} dx$ 是守恒的。这可以通过将偏微分方程 (PDE) 乘以 $u$ 并在整个域上积分来证明：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = \\int_{0}^{2\\pi} u u_t dx = -\\int_{0}^{2\\pi} u \\left( \\frac{u^2}{2} \\right)_x dx = -\\int_{0}^{2\\pi} \\left( \\frac{u^3}{3} \\right)_x dx = -\\frac{1}{3} \\left[ u^3 \\right]_{0}^{2\\pi} = 0\n$$\n另一种分组方式可以得到问题中使用的形式：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = \\int_{0}^{2\\pi} u u_t dx = \\int_{0}^{2\\pi} \\frac{(u^2)_t}{2} dx = \\int_{0}^{2\\pi} \\frac{u^2}{2} u_x dx = \\int_{0}^{2\\pi} \\left(\\frac{u^3}{6}\\right)_x dx = \\frac{1}{6} [u^3]_0^{2\\pi} = 0.\n$$\n\n在 DG 方法中，解 $u$ 由一个分段多项式函数 $u_h$ 来近似。为了推导半离散能量变化率，我们从弱形式出发。我们将 PDE 乘以一个测试函数 $v_h$（它与 $u_h$ 位于同一多项式空间），并在单个单元 $K$ 上进行分部积分：\n$$\n\\int_K v_h (u_h)_t dx + \\int_K v_h \\left( \\frac{u_h^2}{2} \\right)_x dx = 0\n$$\n$$\n\\int_K v_h (u_h)_t dx = - \\left[ v_h f^*(u_h) \\right]_{\\partial K} + \\int_K (v_h)_x f(u_h) dx\n$$\n其中 $f(u_h) = \\frac{u_h^2}{2}$，$f^*(u_h)$ 是一个连接相邻单元的数值通量函数。为了分析能量演化，我们选择测试函数为解本身，即 $v_h = u_h$：\n$$\n\\int_K u_h (u_h)_t dx = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K \\frac{u_h^2}{2} dx = \\int_K (u_h)_x \\frac{u_h^2}{2} dx - \\left[ u_h f^*(u_h) \\right]_{\\partial K}\n$$\n这就是单个单元的半离散能量变化率，与问题中给出的形式相符。问题接着假设了一种特殊情况，即当对所有单元求和时，边界通量项会伸缩相消，从而将体积积分项分离出来作为全局能量变化的唯一贡献项：\n$$\n\\frac{\\mathrm{d}E_h}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{0}^{2\\pi} \\frac{u_h^2}{2} dx = \\sum_K \\int_K \\frac{u_h^2}{2} (u_h)_x dx\n$$\n这个量被定义为离散可解能量生成率，$R = \\sum_K \\int_K \\frac{u_h^2}{2} (u_h)_x dx$。\n\n现在，求积的影响变得至关重要。在每个单元上，$u_h$ 是一个 $p$ 阶多项式。空间导数 $(u_h)_x$ 是一个 $p-1$ 阶多项式。因此，被积函数 $\\frac{u_h^2}{2} (u_h)_x$ 是一个 $2p + (p-1) = 3p-1$ 阶的多项式。一个 $q_{\\mathrm{vol}}$ 点的勒让德-高斯求积法则可以精确积分最高 $2q_{\\mathrm{vol}}-1$ 阶的多项式。要精确计算体积积分，我们需要满足：\n$$\n2q_{\\mathrm{vol}} - 1 \\geq 3p - 1 \\implies q_{\\mathrm{vol}} \\geq \\frac{3p}{2}\n$$\n如果此条件不满足，即 $q_{\\mathrm{vol}}  \\frac{3p}{2}$，积分就是欠积分的。可能会出现混叠误差，即被积函数中高波数模式的能量（其积分结果应为零或一个很小的值）被错误地加到低波数模式上，通常表现为净正能量生成，即 $\\Delta E > 0$。\n\n### 第 2 部分：诊断工具的设计与实现\n\n该诊断工具旨在量化这种效应。实现过程如下：\n\n1.  **离散化设置**：将域 $[0, 2\\pi]$ 划分为 $N$ 个长度为 $h = \\frac{2\\pi}{N}$ 的单元 $K_k$。对于每个测试用例 $(p, N, q_{\\mathrm{vol}}, \\Delta t)$，多项式阶数为 $p$。\n\n2.  **$L^2$ 投影**：通过将给定的初始条件 $u(x,0) = \\sin(x) + 0.25\\sin(3x) + 0.1\\sin(5x)$ 在每个单元 $K_k$ 上投影到勒让德多项式基上，来构造初始 DG 近似 $u_h(x,0)$。单元 $k$ 的勒让德系数 $\\{\\hat{u}_n^{(k)}\\}_{n=0}^p$ 计算如下：\n    $$\n    \\hat{u}_n^{(k)} = \\frac{\\langle u(x,0), L_n(r(x)) \\rangle}{\\langle L_n(r(x)), L_n(r(x)) \\rangle} = \\frac{\\int_{K_k} u(x,0) L_n(r(x)) dx}{\\int_{K_k} L_n(r(x))^2 dx}\n    $$\n    变换到参考区间 $r \\in [-1, 1]$ 并利用正交性 $\\int_{-1}^1 L_n(r)^2 dr = \\frac{2}{2n+1}$，公式变为：\n    $$\n    \\hat{u}_n^{(k)} = \\frac{2n+1}{2} \\int_{-1}^1 u(x(r), 0) L_n(r) dr\n    $$\n    该积分使用高阶高斯-勒让德求积法（点数 $q_{proj} > p$）进行数值计算，以确保投影的准确性。\n\n3.  **能量变化率计算**：离散可解能量生成率 $R(q_{\\mathrm{vol}})$ 是通过对所有单元上的体积积分求和来计算的，其中每个积分都使用一个 $q_{\\mathrm{vol}}$ 点的高斯-勒让德求积法来近似。对于每个单元 $k$，积分为：\n    $$\n    \\int_{K_k} \\frac{u_h^2}{2} (u_h)_x dx = \\int_{-1}^1 \\frac{u_h^{(k)}(r)^2}{2} \\left( \\frac{2}{h} \\frac{d u_h^{(k)}}{dr} \\right) \\frac{h}{2} dr = \\int_{-1}^1 \\frac{u_h^{(k)}(r)^2}{2} \\frac{d u_h^{(k)}}{dr} dr\n    $$\n    其中 $u_h^{(k)}(r) = \\sum_{n=0}^p \\hat{u}_n^{(k)} L_n(r)$。求积近似为：\n    $$\n    R_k(q_{\\mathrm{vol}}) \\approx \\sum_{j=1}^{q_{\\mathrm{vol}}} w_j \\left( \\frac{u_h^{(k)}(r_j)^2}{2} \\frac{d u_h^{(k)}}{dr}(r_j) \\right)\n    $$\n    其中 $(r_j, w_j)$ 是 $q_{\\mathrm{vol}}$ 个求积点和权重。总变化率为 $R(q_{\\mathrm{vol}}) = \\sum_{k=0}^{N-1} R_k(q_{\\mathrm{vol}})$。\n\n4.  **诊断评估**：可解能量增量计算为 $\\Delta E = \\Delta t \\cdot R(q_{\\mathrm{vol}})$。如果 $\\Delta E > 0$，诊断标志 $d$ 设为 1，否则设为 0。该标志表示检测到了反向散射。\n\n以下 Python 程序为给定的测试用例实现了此过程。对于欠积分的情况（A、C、E），我们预计会发现 $\\Delta E > 0$ 和 $d=1$。对于精确积分或过积分的情况（B、D），$\\Delta E$ 应该很小，其符号将取决于 $L^2$ 投影不连续性所带来的离散化误差，但预计不会表现出由混叠引起的反向散射所具有的系统性正号。", "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import Legendre, leggauss\n\ndef solve():\n    \"\"\"\n    Computes the resolved energy increment and backscatter flag for a DG\n    discretization of the Burgers' equation for several test cases.\n    \"\"\"\n    test_cases = [\n        # (p, N, q_vol, dt)\n        (3, 8, 4, 1.0e-3),\n        (3, 8, 8, 1.0e-3),\n        (4, 8, 5, 1.0e-3),\n        (1, 4, 2, 1.0e-3),\n        (5, 16, 3, 1.0e-3),\n    ]\n\n    results = []\n\n    def u0_func(x):\n        \"\"\"The smooth initial condition u(x,0).\"\"\"\n        return np.sin(x) + 0.25 * np.sin(3 * x) + 0.1 * np.sin(5 * x)\n\n    for p, N, q_vol, dt in test_cases:\n        h = 2.0 * np.pi / N\n        q_proj = 2 * p + 4\n        r_proj, w_proj = leggauss(q_proj)\n        \n        L_basis_proj = np.array([Legendre.basis(n)(r_proj) for n in range(p + 1)])\n        u_coeffs_all_elements = np.zeros((N, p + 1))\n\n        # 1. Construct DG approximation via L^2 projection on each element\n        for k in range(N):\n            x_k_start = k * h\n            x_proj_pts = x_k_start + (h / 2.0) * (r_proj + 1.0)\n            u0_vals = u0_func(x_proj_pts)\n            \n            for n in range(p + 1):\n                numerator_phys = (h / 2.0) * np.sum(w_proj * u0_vals * L_basis_proj[n])\n                denominator_phys = h / (2.0 * n + 1.0)\n                u_coeffs_all_elements[k, n] = numerator_phys / denominator_phys\n\n        # 2. Calculate the discrete energy generation rate R\n        r_vol, w_vol = leggauss(q_vol)\n        L_basis_vol = np.array([Legendre.basis(n)(r_vol) for n in range(p + 1)])\n        L_deriv_basis_vol = np.array([Legendre.basis(n).deriv()(r_vol) for n in range(p + 1)])\n\n        R_total = 0.0\n        for k in range(N):\n            coeffs = u_coeffs_all_elements[k, :]\n            u_h_vals = coeffs @ L_basis_vol\n            du_h_dr_vals = coeffs @ L_deriv_basis_vol\n            \n            integrand = 0.5 * (u_h_vals**2) * du_h_dr_vals\n            R_k = np.sum(w_vol * integrand)\n            R_total += R_k\n            \n        # 3. Calculate energy increment and backscatter flag\n        delta_E = dt * R_total\n        d = 1 if delta_E > 0 else 0\n        \n        results.append(f\"[{delta_E:.6e},{d}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3394720"}, {"introduction": "为了使“数值耗散”这一抽象概念更加具体化，一种有效的方法是将其与一个广为人知的显式LES模型进行比较。本练习 ([@problem_id:3394724]) 将指导您完成这一标定过程，通过将DG-ILES格式在泰勒-格林涡（Taylor-Green vortex）问题中的能量衰减率与经典Smagorinsky模型的衰减率进行匹配。通过这种方式，您将推导出一个等效的Smagorinsky常数 $C_s$，从而能够具体地量化您所使用的ILES格式的耗散强度。", "problem": "要求您设计一个程序，用于校准采用间断伽辽金 (DG) 空间离散的隐式大涡模拟 (ILES)。校准方法是将三维泰勒-格林涡的可解动能衰减率与采用 Smagorinsky 模型的显式涡粘性大涡模拟 (LES) 的衰减率进行匹配。目标是针对给定的 DG 分辨率和通量耗散强度，推断出一个有效的 Smagorinsky 常数，记为 $C_s$。\n\n您必须基于以下基础定义和建模假设进行工作，这些定义和假设在湍流建模和数值方法中均为主流且被广泛使用：\n\n- 在 $t=0$ 时，边长为 $L$ 的周期性立方体中，泰勒-格林涡的不可压缩速度场为：\n  $$\n  \\boldsymbol{u}(\\boldsymbol{x}) = \\Big(u,v,w\\Big) = \\Big(U_0 \\sin(k x)\\cos(k y)\\cos(k z),\\,-U_0 \\cos(k x)\\sin(k y)\\cos(k z),\\,0\\Big),\n  $$\n  其中 $k = \\frac{2\\pi}{L}$ 是基准波数，$U_0$ 是一个速度标尺，所有三角函数参数均以弧度为单位。\n\n- 应变率张量为 $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j}+\\frac{\\partial u_j}{\\partial x_i}\\right)$，其二次不变量为 $S_{ij}S_{ij}$。定义弗罗贝尼乌斯范数大小为 $\\lvert S \\rvert = \\sqrt{2 S_{ij}S_{ij}}$。\n\n- 采用 Smagorinsky 涡粘性模型的大涡模拟 (LES) 使用\n  $$\n  \\nu_t = \\left(C_s\\,\\Delta\\right)^2\\,\\lvert S\\rvert,\n  $$\n  其中 $\\Delta$ 是滤波宽度。单位质量的可解动能衰减率为\n  $$\n  \\varepsilon_{\\text{Smag}} = 2\\,\\nu_t\\,S_{ij}S_{ij}.\n  $$\n  在整个计算域上进行平均后，空间平均率满足\n  $$\n  \\langle \\varepsilon_{\\text{Smag}} \\rangle = \\left(C_s\\,\\Delta\\right)^2 \\left\\langle \\lvert S\\rvert^3 \\right\\rangle.\n  $$\n\n- 对于间断伽辽金 (DG) ILES，考虑一个标准的迎风型数值通量。对单元间迎风耗散的一种广泛使用的有效涡粘性解释是\n  $$\n  \\nu_{\\text{ILES}} = C_{\\text{dg}}\\,a\\,\\frac{h}{p+1},\n  $$\n  其中 $C_{\\text{dg}}$ 是一个由通量和基函数选择决定的无量纲耗散强度，$a$ 是特征速度，$h$ 是单元尺寸，$p$ 是局部多项式阶数。为了在 $t=0$ 时对泰勒-格林涡进行校准，取 $a$ 为初始场的均方根 (r.m.s.) 速度大小：\n  $$\n  a = \\sqrt{\\langle \\boldsymbol{u}\\cdot \\boldsymbol{u} \\rangle} = \\frac{U_0}{2}.\n  $$\n  ILES 的单位质量能量衰减率被建模为\n  $$\n  \\langle \\varepsilon_{\\text{ILES}}\\rangle = 2\\,\\nu_{\\text{ILES}}\\,\\langle S_{ij}S_{ij}\\rangle.\n  $$\n\n- 对于间断伽辽金 (DG)，常用的滤波宽度为\n  $$\n  \\Delta = \\frac{h}{p+1} \\quad \\text{with} \\quad h = \\frac{L}{N_e},\n  $$\n  其中 $N_e$ 是均匀笛卡尔网格中每个坐标方向上的单元数量。\n\n校准任务：\n\n- 通过令 ILES 和 Smagorinsky 的平均能量衰减率相等来推断有效的 Smagorinsky 常数 $C_s$：\n  $$\n  \\langle \\varepsilon_{\\text{ILES}}\\rangle = \\langle \\varepsilon_{\\text{Smag}} \\rangle.\n  $$\n\n计算要求：\n\n- 使用均匀笛卡尔求积法，在周期性盒子 $[0,L)^3$ 上，每个方向使用 $Q$ 个点，数值计算初始泰勒-格林涡的体积平均值 $\\langle S_{ij}S_{ij}\\rangle$ 和 $\\left\\langle \\lvert S\\rvert^3 \\right\\rangle$。所有角度必须以弧度为单位，所有场必须使用波数 $k = \\frac{2\\pi}{L}$ 进行计算。您的求积方法必须在每个坐标维度上使用均匀权重和周期性采样点。\n\n- 为保证数值稳定性和可复现性，您必须：\n  1) 使用上述 $\\nu_{\\text{ILES}}$ 的定义。\n  2) 使用 $a = \\frac{U_0}{2}$。\n  3) 使用 $\\Delta = \\frac{h}{p+1}$ 和 $h = \\frac{L}{N_e}$。\n  4) 根据指定的离散求积计算域平均值 $\\langle S_{ij}S_{ij}\\rangle$ 和 $\\left\\langle \\lvert S\\rvert^3 \\right\\rangle$。\n\n- 单位约定：\n  - 使用国际单位制 (SI)：$U_0$ 的单位为米/秒 (m/s)，$L$ 的单位为米 (m)，$h$ 的单位为米 (m)。\n  - 推断出的 $C_s$ 是无量纲的，并且必须以无量纲浮点数的形式报告。\n\n- 最终表达式：\n  - 您的程序必须通过对初始场强制执行 $\\langle \\varepsilon_{\\text{ILES}}\\rangle = \\langle \\varepsilon_{\\text{Smag}} \\rangle$ 来计算推断出的 $C_s$，并为每个测试用例报告一个标量 $C_s$。\n\n测试套件和输入：\n\n- 为以下四个测试用例实现您的解决方案，每个用例指定为一个元组 $(U_0, L, p, N_e, C_{\\text{dg}}, Q)$：\n  1) $(1.0,\\, 2\\pi,\\, 3,\\, 16,\\, 0.005,\\, 32)$\n  2) $(1.0,\\, 2\\pi,\\, 3,\\, 8,\\, 0.005,\\, 32)$\n  3) $(1.0,\\, 2\\pi,\\, 7,\\, 16,\\, 0.002,\\, 32)$\n  4) $(1.0,\\, 2\\pi,\\, 0,\\, 16,\\, 0.006,\\, 32)$\n\n程序输出规范：\n\n- 您的程序应生成单行输出，其中包含四个推断出的 $C_s$ 值（按此顺序），格式为方括号内以逗号分隔的列表。每个值都必须是浮点数。示例格式：“[0.173211,0.241009,0.198765,0.152345]”。\n\n- 所有计算必须是自包含的，不需用户输入，且不得使用任何外部文件或网络访问。\n\n科学真实性和覆盖范围：\n\n- 测试套件包含：\n  - 一个“理想路径”下的中等阶数 DG 与中等分辨率。\n  - 一个较粗网格分辨率的敏感性案例。\n  - 一个具有较弱通量耗散的高阶多项式案例。\n  - 一个最低阶案例 ($p=0$)，用于测试对阶数和界面耗散的敏感性。\n\n- 您的程序必须根据上述指定的第一性原理解决校准问题，除了已声明的定义外，不得使用任何关于 $C_s$ 的硬编码中间或最终公式，并且必须通过在周期域上的数值求积来评估应变率不变量。\n\n最后说明：\n\n- 所有三角函数运算必须以弧度为单位，最终推断出的 $C_s$ 值为无量纲浮点数。最终的打印输出必须与所描述的精确输出格式完全匹配，且为单行。", "solution": "问题陈述经评估有效。它在科学上基于计算流体动力学的原理，特别是基于大涡模拟 (LES) 的湍流建模和间断伽辽金 (DG) 方法的空间离散。该问题是适定的、客观的，并包含推导出唯一且有意义解所需的所有信息。所概述的方法是在隐式大涡模拟 (ILES) 框架中校准数值耗散的标准实践。\n\n目标是通过将 ILES-DG 方案的数值引起的能量耗散率与显式 Smagorinsky LES 模型的能量耗散率相等，来确定其有效的 Smagorinsky 常数 $C_s$。此校准是针对三维泰勒-格林涡在时间 $t=0$ 时进行的。\n\nILES-DG 方法的单位质量空间平均能量衰减率 $\\langle \\varepsilon_{\\text{ILES}}\\rangle$ 被建模为：\n$$\n\\langle \\varepsilon_{\\text{ILES}}\\rangle = 2\\,\\nu_{\\text{ILES}}\\,\\langle S_{ij}S_{ij}\\rangle\n$$\n其中 $\\nu_{\\text{ILES}}$ 是 DG 方案的常数有效涡粘性，而 $\\langle S_{ij}S_{ij}\\rangle$ 是应变率张量 $S_{ij}$ 的体积平均二次不变量。有效粘性由下式给出：\n$$\n\\nu_{\\text{ILES}} = C_{\\text{dg}}\\,a\\,\\frac{h}{p+1}\n$$\n这里，$C_{\\text{dg}}$ 是耗散强度，$a = U_0/2$ 是特征速度，$h=L/N_e$ 是单元尺寸，$p$ 是多项式阶数。\n\nSmagorinsky LES 模型的空间平均能量衰减率 $\\langle \\varepsilon_{\\text{Smag}} \\rangle$ 由下式给出：\n$$\n\\langle \\varepsilon_{\\text{Smag}} \\rangle = \\left(C_s\\,\\Delta\\right)^2 \\left\\langle \\lvert S\\rvert^3 \\right\\rangle\n$$\n其中 $C_s$ 是 Smagorinsky 常数，$\\Delta = \\frac{h}{p+1}$ 是滤波宽度，$\\lvert S \\rvert = \\sqrt{2 S_{ij}S_{ij}}$ 是应变率张量的弗罗贝尼乌斯范数。\n\n校准过程需要令这两个耗散率相等：\n$$\n\\langle \\varepsilon_{\\text{ILES}}\\rangle = \\langle \\varepsilon_{\\text{Smag}} \\rangle\n$$\n$$\n2\\,\\nu_{\\text{ILES}}\\,\\langle S_{ij}S_{ij}\\rangle = \\left(C_s\\,\\Delta\\right)^2 \\left\\langle \\lvert S\\rvert^3 \\right\\rangle\n$$\n求解未知常数 $C_s$ 可得：\n$$\nC_s^2 = \\frac{2\\,\\nu_{\\text{ILES}}\\,\\langle S_{ij}S_{ij}\\rangle}{\\Delta^2 \\left\\langle \\lvert S\\rvert^3 \\right\\rangle}\n$$\n$$\nC_s = \\frac{1}{\\Delta}\\sqrt{\\frac{2\\,\\nu_{\\text{ILES}}\\,\\langle S_{ij}S_{ij}\\rangle}{\\left\\langle \\lvert S\\rvert^3 \\right\\rangle}}\n$$\n为计算此表达式，我们必须首先为指定的泰勒-格林涡初始速度场计算体积平均值 $\\langle S_{ij}S_{ij} \\rangle$ 和 $\\langle \\lvert S\\rvert^3 \\rangle$：\n$$\n\\boldsymbol{u}(\\boldsymbol{x}) = \\Big(u,v,w\\Big) = \\Big(U_0 \\sin(k x)\\cos(k y)\\cos(k z),\\,-U_0 \\cos(k x)\\sin(k y)\\cos(k z),\\,0\\Big)\n$$\n其中 $k = 2\\pi/L$。应变率张量 $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j}+\\frac{\\partial u_j}{\\partial x_i}\\right)$ 的分量通过微分求得：\n$$\n\\frac{\\partial u}{\\partial x} = k U_0 \\cos(k x)\\cos(k y)\\cos(k z) \\quad , \\quad\n\\frac{\\partial u}{\\partial y} = -k U_0 \\sin(k x)\\sin(k y)\\cos(k z) \\quad , \\quad\n\\frac{\\partial u}{\\partial z} = -k U_0 \\sin(k x)\\cos(k y)\\sin(k z)\n$$\n$$\n\\frac{\\partial v}{\\partial x} = k U_0 \\sin(k x)\\sin(k y)\\cos(k z) \\quad , \\quad\n\\frac{\\partial v}{\\partial y} = -k U_0 \\cos(k x)\\cos(k y)\\cos(k z) \\quad , \\quad\n\\frac{\\partial v}{\\partial z} = k U_0 \\cos(k x)\\sin(k y)\\sin(k z)\n$$\n$w$ 的所有导数均为零。这导致对称张量 $S_{ij}$ 的非零分量为：\n$$\nS_{11} = \\frac{\\partial u}{\\partial x} = k U_0 \\cos(k x)\\cos(k y)\\cos(k z)\n$$\n$$\nS_{22} = \\frac{\\partial v}{\\partial y} = -k U_0 \\cos(k x)\\cos(k y)\\cos(k z) = -S_{11}\n$$\n$$\nS_{13} = S_{31} = \\frac{1}{2}\\frac{\\partial u}{\\partial z} = -\\frac{1}{2} k U_0 \\sin(k x)\\cos(k y)\\sin(k z)\n$$\n$$\nS_{23} = S_{32} = \\frac{1}{2}\\frac{\\partial v}{\\partial z} = \\frac{1}{2} k U_0 \\cos(k x)\\sin(k y)\\sin(k z)\n$$\n其余分量 $S_{33}$ 和 $S_{12}=S_{21}$ 均为零。\n\n现在可以构建量 $S_{ij}S_{ij}$：\n$$\nS_{ij}S_{ij} = S_{11}^2 + S_{22}^2 + S_{33}^2 + 2(S_{12}^2 + S_{13}^2 + S_{23}^2) = 2S_{11}^2 + 2S_{13}^2 + 2S_{23}^2\n$$\n体积平均值 $\\langle S_{ij}S_{ij} \\rangle$ 和 $\\langle \\lvert S\\rvert^3 \\rangle = \\langle (2 S_{ij}S_{ij})^{3/2} \\rangle$ 是通过在覆盖周期域 $[0, L)^3$ 的 $Q^3$ 个点的均匀笛卡尔网格上使用数值求积来计算的。对于一个通用函数 $f(\\boldsymbol{x})$，其体积平均值通过其在离散求积点 $\\boldsymbol{x}_m$ 上的值的均值来近似：\n$$\n\\langle f \\rangle \\approx \\frac{1}{Q^3}\\sum_{m=1}^{Q^3} f(\\boldsymbol{x}_m)\n$$\n对于每个测试用例，最终算法流程如下：\n1.  定义参数 $U_0$, $L$, $p$, $N_e$, $C_{\\text{dg}}$ 和 $Q$。\n2.  在域 $[0, L)^3$ 中构建 $Q^3$ 个求积格点。\n3.  在每个格点上，评估应变率张量 $S_{ij}$ 的分量。\n4.  计算 $S_{ij}S_{ij}$ 和 $\\lvert S \\rvert = \\sqrt{2 S_{ij}S_{ij}}$ 的局部值。\n5.  通过对所有格点的值取算术平均，计算体积平均值 $\\langle S_{ij}S_{ij} \\rangle$ 和 $\\langle \\lvert S \\rvert^3 \\rangle$。\n6.  计算 DG 方案的参数：$h = L/N_e$, $\\Delta = h/(p+1)$, 和 $\\nu_{\\text{ILES}} = C_{\\text{dg}}(U_0/2)\\Delta$。\n7.  最后，使用推导出的公式计算有效的 Smagorinsky 常数 $C_s$：$C_s = \\sqrt{2\\,\\nu_{\\text{ILES}}\\,\\langle S_{ij}S_{ij}\\rangle / (\\Delta^2 \\langle \\lvert S\\rvert^3 \\rangle)}$。\n此过程在提供的 Python 代码中实现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calibrates an Implicit Large Eddy Simulation (ILES) with a Discontinuous\n    Galerkin (DG) method to infer an effective Smagorinsky constant, C_s.\n\n    The calibration equates the energy dissipation rate of the DG scheme's\n    numerical viscosity with that of an explicit Smagorinsky model for the\n    initial field of the Taylor-Green vortex.\n    \"\"\"\n    test_cases = [\n        # (U0, L, p, Ne, Cdg, Q)\n        (1.0, 2.0 * np.pi, 3, 16, 0.005, 32),\n        (1.0, 2.0 * np.pi, 3, 8, 0.005, 32),\n        (1.0, 2.0 * np.pi, 7, 16, 0.002, 32),\n        (1.0, 2.0 * np.pi, 0, 16, 0.006, 32),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        U0, L, p, Ne, C_dg, Q = case\n\n        # 1. Set up the computational grid for numerical quadrature\n        k = 2.0 * np.pi / L\n        grid_points = np.linspace(0, L, Q, endpoint=False)\n        x, y, z = np.meshgrid(grid_points, grid_points, grid_points, indexing='ij')\n\n        kx = k * x\n        ky = k * y\n        kz = k * z\n\n        # 2. Compute components of the rate-of-strain tensor S_ij\n        cos_kx = np.cos(kx)\n        sin_kx = np.sin(kx)\n        cos_ky = np.cos(ky)\n        sin_ky = np.sin(ky)\n        cos_kz = np.cos(kz)\n        sin_kz = np.sin(kz)\n\n        # Non-zero components of S_ij\n        S11 = k * U0 * cos_kx * cos_ky * cos_kz\n        S22 = -S11\n        S13 = -0.5 * k * U0 * sin_kx * cos_ky * sin_kz\n        S23 = 0.5 * k * U0 * cos_kx * sin_ky * sin_kz\n\n        # 3. Compute the second invariant and the Frobenius norm of S\n        # S_ij S_ij is the sum of squares of all unique components\n        # with off-diagonals multiplied by 2.\n        S_ij_S_ij = S11**2 + S22**2 + 2 * (S13**2 + S23**2)\n        \n        # |S| = sqrt(2 * S_ij * S_ij)\n        S_norm = np.sqrt(2.0 * S_ij_S_ij)\n\n        # 4. Numerically compute the required volume averages\n        avg_S_ij_S_ij = np.mean(S_ij_S_ij)\n        avg_S_norm_cubed = np.mean(S_norm**3)\n\n        # 5. Calculate DG quantities\n        h = L / Ne\n        Delta = h / (p + 1.0)\n        a = U0 / 2.0\n        # Corrected formula from problem statement: nu_ILES uses h, not Delta\n        nu_ILES = C_dg * a * h / (p + 1.0)\n\n        # 6. Equate dissipation rates and solve for C_s\n        if avg_S_norm_cubed  1e-15:\n            C_s = 0.0\n        else:\n            numerator = 2.0 * nu_ILES * avg_S_ij_S_ij\n            denominator = (Delta**2) * avg_S_norm_cubed\n            # Avoid sqrt of negative number due to float precision\n            C_s_squared = max(0.0, numerator / denominator)\n            C_s = np.sqrt(C_s_squared)\n        \n        results.append(C_s)\n    \n    print(f\"[{','.join([f'{val:.6f}' for val in results])}]\")\n\nsolve()\n```", "id": "3394724"}]}