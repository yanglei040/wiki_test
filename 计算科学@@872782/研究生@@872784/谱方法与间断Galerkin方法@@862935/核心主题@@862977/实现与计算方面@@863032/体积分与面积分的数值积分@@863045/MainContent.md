## 引言
在[求解偏微分方程](@entry_id:138485)的[高阶数值方法](@entry_id:142601)领域，谱方法和间断Galerkin (DG) 方法因其卓越的精度和灵活性而备受瞩目。然而，这些方法的强大能力深植于一个看似基础却至关重要的环节：对体积和表面积分的精确计算。无论是组装[质量矩阵](@entry_id:177093)和刚度矩阵，还是处理复杂的[非线性](@entry_id:637147)通量与弯曲的单元边界，我们都面临着如何高效、准确地计算被积函数结构复杂的积分这一核心问题。积分的精度不仅直接影响解的准确性，更深刻地决定了[数值格式](@entry_id:752822)的稳定性、守恒性乃至物理真实性。

本文旨在系统性地剖析谱/[DG方法](@entry_id:748369)中的数值求积技术。
- 在“**原理与机制**”一章中，我们将深入探讨[高斯求积法](@entry_id:146011)则的核心思想、[精确度](@entry_id:143382)等级以及它如何处理从简单仿射单元到复杂弯曲单元的映射。
- 接着，在“**应用与跨学科联系**”一章中，我们将展示这些原理如何在[计算流体力学](@entry_id:747620)、电磁学等领域中确保数值稳定性和物理守恒律，并应对[自适应网格](@entry_id:164379)和[非局部算子](@entry_id:752664)等前沿挑战。
- 最后，“**动手实践**”部分将提供具体的计算练习，帮助您将理论知识转化为实践技能。

让我们首先从[数值求积](@entry_id:136578)背后的基本原理与机制开始。

## 原理与机制

在谱方法和间断 Galerkin (DG) 方法的数学框架中，数值积分，或称[数值求积](@entry_id:136578)，扮演着至关重要的角色。几乎所有通过[变分原理](@entry_id:198028)导出的离散方程，其系数（例如质量矩阵和刚度矩阵的元素）都是通过积分定义的。由于[谱元法](@entry_id:755171)和 DG 方法采用了高阶多项式[基函数](@entry_id:170178)，并且可能涉及[非线性](@entry_id:637147)通量或弯曲的单元边界，因此被积函数往往结构复杂。精确或高精度地计算这些积分对于保证方法的稳定性、准确性和收敛性至关重要。本章旨在系统地阐述在[谱方法](@entry_id:141737)和 DG 方法背景下，体积和表面积分的数值求积所涉及的核心原理与机制。

### [数值求积](@entry_id:136578)的基本概念

在计算科学中，我们经常遇到无法解析求解的定积分。数值求积为此提供了一套系统的近似方法。其核心思想是用被积函数在有限个“求积点”上的值的加权和来逼近积分值。对于一维参考区间 $I=[-1,1]$ 上的积分，一个数值求积法则通常具有以下形式：
$$
\int_{-1}^{1} f(\xi)\,\mathrm{d}\xi \approx Q_m[f] = \sum_{i=1}^{m} w_i f(\xi_i)
$$
其中，$\{\xi_i\}_{i=1}^m$ 是位于区间 $[-1,1]$ 内的 **求积节点 (quadrature nodes)**，$\{w_i\}_{i=1}^m$ 是与之对应的 **[求积权重](@entry_id:753910) (quadrature weights)**。

#### 精确度等级与渐近收敛阶

衡量一个求积法则优劣的关键指标之一是其 **精确度等级 (degree of exactness)**。一个[求积法则](@entry_id:753909)的精确度等级被定义为能够被该法则精确积分的最高次多项式的次数。也就是说，如果一个[求积法则](@entry_id:753909)对所有次数不超过 $d$ 的多项式 $p \in \mathbb{P}_d$ 都能给出精确积分结果，即 $Q_m[p] = \int_{-1}^{1} p(\xi)\,\mathrm{d}\xi$，但至少存在一个 $d+1$ 次多项式使其不再精确，那么该法则的精确度等级就是 $d$。

然而，在许多实际应用中，被积函数并非多项式，例如，当处理[非线性偏微分方程](@entry_id:169481)时，即使解本身用[多项式逼近](@entry_id:137391)，其通量函数（如 $f(u) = u^2$ 或 $f(u) = \exp(u)$）与多项式[基函数](@entry_id:170178)的乘积通常不再是多项式。对于这类光滑的非多项式函数，我们更关心的是当求积点数量 $m$ 增加时，求积误差 $| \int f - Q_m[f] |$ 的收敛行为。这由[求积法则](@entry_id:753909)的 **渐近收敛阶 (asymptotic order of accuracy)** 来描述。

精确度等级和渐近收敛阶是两个相关但截然不同的概念。[精确度](@entry_id:143382)等级是一个整数，它描述了法则在有限维多项式空间 $\mathbb{P}_d$ 上的表现。而渐近收敛阶则描述了误差随 $m \to \infty$ 的衰减速率，这个速率很大程度上取决于被积函数 $f$ 的光滑性。例如，如果函数 $f$ 仅具有有限的正则性（如 $k$ 阶连续可微），求积误差通常以代数速率衰减，如 $O(m^{-k})$。然而，如果函数 $f$ 在包含 $[-1,1]$ 的复平面区域内是解析的，那么对于某些精心设计的[求积法则](@entry_id:753909)（如[高斯求积](@entry_id:146011)），误差会以指数速率衰减，即 $O(e^{-cm})$，其中 $c>0$ 是一个常数。这种超快的[收敛速度](@entry_id:636873)被称为 **谱精度 (spectral accuracy)**。值得注意的是，一个[求积法则](@entry_id:753909)有限的精确度等级 $d$ 本身并不能预测或解释这种[指数收敛](@entry_id:142080)现象。[指数收敛](@entry_id:142080)是由求积误差与函数在复平面上的解析性质之间的深刻联系决定的 [@problem_id:3406280]。

高斯求积的谱精度特性是其在谱方法中备受青睐的根本原因。在[谱方法](@entry_id:141737)和 DG 方法中，我们的目标是实现对解的谱精度逼近。如果用于计算积分的求积法则本身仅具有代数收敛性，那么它将成为整个计算过程的瓶颈，从而破坏方法的整体谱精度。高斯求积的[指数收敛](@entry_id:142080)确保了只要使用足够多的求积点，求积误差就可以衰减得比[多项式逼近](@entry_id:137391)误差快得多，从而不会妨碍整体的高阶收敛性 [@problem_id:3406289]。一个典型的高斯求积误差界的形式如下：
$$
|I(f)-Q_N(f)| \le \dfrac{2^{2N+1} (N!)^4}{(2N+1)[(2N)!]^3}\,\max_{x\in[-1,1]} |f^{(2N)}(x)|
$$
其中 $N$ 是求积点数。尽管公式复杂，但其关键在于，随着 $N$ 的增大，前面的系数项会以比任何 $N$ 的负幂次都快的速度趋向于零，这正是谱收敛的标志。

### 高斯求积法则

[高斯求积](@entry_id:146011)是一类通过优化选择求积节点和权重，从而在给定节点数 $m$ 的情况下达到最大可能精确度等级的[求积法则](@entry_id:753909)。对于一个具有 $2m$ 个自由参数（$m$ 个节点和 $m$ 个权重）的[求积法则](@entry_id:753909)，可以期望满足 $2m$ 个约束条件，这对应于精确积分直到 $2m-1$ 次的多项式。高斯求积理论证明了这是可以实现的。

#### Gauss-Legendre 求积

**Gauss-Legendre (GL) 求积** 是最著名的高斯型[求积法则](@entry_id:753909)。对于 $n$ 个求积点，其性质如下：
- **节点**：$n$ 个求积节点 $\{\xi_i\}_{i=1}^n$ 是 $n$ 阶[勒让德多项式](@entry_id:141510) $P_n(\xi)$ 的 $n$ 个根。这些根全部位于开区间 $(-1,1)$ 内，因此 GL 求积点不包含区间的端点 $\pm 1$。
- **精确度等级**：$n$ 点 GL 求积法则的精确度等级为 $2n-1$，这是 $n$ 点求积法则所能达到的最高[精确度](@entry_id:143382)。

#### [Gauss-Lobatto-Legendre](@entry_id:749736) 求积

在许多应用中，特别是在[谱元法](@entry_id:755171)中，要求求积节点包含区间的端点。**[Gauss-Lobatto-Legendre](@entry_id:749736) (GLL)** [求积法则](@entry_id:753909)满足这一要求。对于 $n$ 个求积点，其性质如下：
- **节点**：$n$ 个求积节点中，两个节点被固定在区间的端点 $\pm 1$。其余的 $n-2$ 个内部节点是 $(n-1)$ 阶勒让德多项式的导数 $P_{n-1}'(\xi)$ 的根。
- **[精确度](@entry_id:143382)等级**：由于预先固定了两个节点，自由度减少了两个，因此 $n$ 点 GLL 求积法则的精确度等级为 $2n-3$ [@problem_id:3406302]。

虽然 GLL 法则的[精确度](@entry_id:143382)等级低于同等点数的 GL 法则，但其节点包含端点的特性在构建高维单元的[基函数](@entry_id:170178)和求积法则时具有显著优势。

### 多维空间中的求积

DG 和[谱元法](@entry_id:755171)通常在二维或三维空间中求解问题。[多维积分](@entry_id:184252)通常通过将物理单元映射到[参考单元](@entry_id:168425)（如正方形或立方体）上来计算。在[参考单元](@entry_id:168425) $[-1,1]^d$ 上的[求积法则](@entry_id:753909)通常通过一维求积法则的 **张量积 (tensor-product)** 构造来生成。

给定一个一维[求积法则](@entry_id:753909) $(\{\xi_i\}_{i=1}^N, \{w_i\}_{i=1}^N)$，其[精确度](@entry_id:143382)等级为 $m$。一个 $d$ 维[张量积法则](@entry_id:177156)的构造如下 [@problem_id:3406285]：
- **节点**：$d$ 维求积节点集是一维节点集的笛卡尔积。每个 $d$ 维节点 $\boldsymbol{\xi}_{\mathbf{i}}$ 的坐标为 $(\xi_{i_1}, \xi_{i_2}, \dots, \xi_{i_d})$，其中 $\mathbf{i}=(i_1, \dots, i_d)$ 是一个多重索引。
- **权重**：与节点 $\boldsymbol{\xi}_{\mathbf{i}}$ 相关联的权重是相应一维权重的乘积：$W_{\mathbf{i}} = w_{i_1} w_{i_2} \cdots w_{i_d}$。

通过这种构造，[多维积分](@entry_id:184252)可以被分解为一系列嵌套的一维积分，每个都由一维求积法则近似。这种[张量积法则](@entry_id:177156)能够精确积分所有属于 **张量积多项式空间 $Q_m$** 的多项式。该空间由所有形如 $\prod_{k=1}^d \xi_k^{\alpha_k}$ 的单项式张成，其中每个指数 $\alpha_k$ 都满足 $0 \le \alpha_k \le m$。我们也可以在不同坐标方向上使用具有不同精确度等级 $m_k$ 的一维法则，从而构造出对各向异性多项式空间 $Q_{m_1,\dots,m_d}$ 精确的求积法则 [@problem_id:3406285]。

在 DG 方法中，除了体积积分，我们还需要计算单元边界上的[面积分](@entry_id:275394)。张量积构造与 GLL 求积的结合在这里显示出其优越性。因为 GLL 节点包含端点 $\pm 1$，所以 $d$ 维张量积 GLL 体求积节点天然地包含了位于[参考单元](@entry_id:168425)所有面上的点。例如，在 $[-1,1]^2$ 上，面 $\xi=1$ 上的求积点集 $\{(1, \eta_j)\}_{j=1}^N$ 正是体求积点集 $\{(\xi_i, \eta_j)\}_{i,j=1}^N$ 的一个[子集](@entry_id:261956)。这意味着在计算[面积分](@entry_id:275394)时，无需进行额外的函数求值或插值，可以直接复用体求积时已经计算出的函数值，这极大地提高了计算效率 [@problem_id:3406302]。

### 映射单元上的求积

在实际计算中，积分是在物理单元 $K$ 上进行的，而求积法则定义在[参考单元](@entry_id:168425) $\hat{K}$ 上。两者通过一个可逆映射 $\mathbf{x} = F(\boldsymbol{\xi})$ 联系起来。根据[多重积分](@entry_id:146170)的变量代换定理，我们有：
$$
\int_{K} p(\mathbf{x}) \, \mathrm{d}\mathbf{x} = \int_{\hat{K}} p(F(\boldsymbol{\xi})) |J(\boldsymbol{\xi})| \, \mathrm{d}\boldsymbol{\xi}
$$
其中 $J(\boldsymbol{\xi}) = \det\left(\frac{\partial \mathbf{x}}{\partial \boldsymbol{\xi}}\right)$ 是映射的[雅可比行列式](@entry_id:137120)。为了确保[数值积分](@entry_id:136578)的精确性，我们需要确定[参考单元](@entry_id:168425)上的被积函数 $p(F(\boldsymbol{\xi})) |J(\boldsymbol{\xi})|$ 的多项式次数，并选用具有足够高[精确度](@entry_id:143382)等级的求积法则。

#### 仿射单元

最简单的情况是 **[仿射映射](@entry_id:746332) (affine mapping)**，即 $\mathbf{x}(\boldsymbol{\xi}) = A \boldsymbol{\xi} + \mathbf{b}$，其中 $A$ 是一个常数矩阵，$\mathbf{b}$ 是一个常数向量。例如，任何三角形或平行四边形都可以通过[仿射映射](@entry_id:746332)从参考单元得到。
在这种情况下，[雅可比矩阵](@entry_id:264467) $\frac{\partial \mathbf{x}}{\partial \boldsymbol{\xi}} = A$ 是一个常数矩阵，因此其[行列式](@entry_id:142978) $J$ 也是一个与 $\boldsymbol{\xi}$ 无关的常数 [@problem_id:3406242]。
如果物理空间中的被积函数 $p(\mathbf{x})$ 是一个 $r$ 次多项式，那么经过[仿射映射](@entry_id:746332)后，复合函数 $q(\boldsymbol{\xi}) = p(A\boldsymbol{\xi} + \mathbf{b})$ 仍然是一个关于 $\boldsymbol{\xi}$ 的 $r$ 次多项式。因此，[参考单元](@entry_id:168425)上的整个被积函数 $q(\boldsymbol{\xi})|J|$ 也是一个 $r$ 次多项式。这意味着，为了精确积分物理单元上的一个 $r$ 次多项式，我们只需要一个在[参考单元](@entry_id:168425)上对 $r$ 次多项式精确的求积法则即可。[仿射映射](@entry_id:746332)保持了多项式的次数不变，因此[求积法则](@entry_id:753909)的精确度等级属性也得以保持 [@problem_id:3406280]。

#### 等参 (弯曲) 单元

当物理单元具有弯曲边界时，需要使用[非线性](@entry_id:637147)的 **[等参映射](@entry_id:173239) (isoparametric mapping)**。在这种情况下，映射 $\mathbf{x}(\boldsymbol{\xi})$ 本身就是一个 $p_m$ 次多项式。这使得情况变得复杂得多。
- **复合函数的次数**：如果物理函数 $f(\mathbf{x})$ 是 $p$ 次多项式，那么复合函数 $f(\mathbf{x}(\boldsymbol{\xi}))$ 的次数最高可达 $p \cdot p_m$。
- **雅可比行列式的次数**：映射的[雅可比矩阵](@entry_id:264467)的元素是 $p_m$ 次多项式的导数，因此是 $p_m-1$ 次多项式。一个 $d \times d$ [矩阵的行列式](@entry_id:148198)是其元素的乘积之和，每个乘积项包含 $d$ 个元素。因此，[雅可比行列式](@entry_id:137120) $J(\boldsymbol{\xi})$ 的次数最高可达 $d(p_m-1)$。

综合起来，参考单元上的整个被积函数的最高次数为 $p \cdot p_m + d(p_m-1)$ [@problem_id:3406252] [@problem_id:3406313]。这个公式揭示了一个重要事实：对于弯曲单元，所需的[求积法则](@entry_id:753909)[精确度](@entry_id:143382)等级不仅取决于被积函数 $f$ 的次数，还强烈地取决于单元几何的弯曲程度（由 $p_m$ 体现）和空间维度 $d$。与仿射单元（$p_m=1$）相比，弯曲单元对求积法则的精确度要求要高得多。此外，如果映射或其逆不是多项式（例如，由高次多项式构造的几何的[雅可比行列式](@entry_id:137120)通常是有理函数），那么任何多项式[求积法则](@entry_id:753909)都无法精确积分，这会导致所谓的 **几何混淆 (geometric aliasing)** [@problem_id:3406243]。

### 混淆及其后果

在处理[非线性](@entry_id:637147)问题时，即使解 $u_h$ 和[检验函数](@entry_id:166589) $v_h$ 都是 $p$ 次多项式，它们的乘积以及更复杂的[非线性](@entry_id:637147)项（如 $u_h^m v_h$）的次数会更高。如果[求积法则](@entry_id:753909)的精确度等级不足以精确积分这些高次多项式，就会产生所谓的 **混淆误差 (aliasing error)** 或简称为 **混淆 (aliasing)**。

混淆的本质是，离散的求积过程无法区分[高频模式](@entry_id:750297)和低频模式，导致高频分量被错误地表示为低频分量，从而污染计算结果。在 DG 方法的框架下，这可以理解为用数值求积计算 $L^2$ 投影时的不一致性。例如，要计算[非线性](@entry_id:637147)项 $u_h^m$ 到 $\mathbb{P}^p$ 空间的 $L^2$ 投影，我们需要计算形如 $\int_{\Omega} u_h^m v_h \, \mathrm{d}x$ 的积分，其中 $v_h \in \mathbb{P}^p$。被积函数的次数最高可达 $mp+p$。为了精确计算这个投影，求积法则的[精确度](@entry_id:143382)等级必须至少为 $mp+p$ [@problem_id:3406295]。对于表[面积分](@entry_id:275394) $\int_{\partial\Omega} u_h^m \varphi_h \, \mathrm{d}s$，也存在同样的要求 [@problem_id:3406295]。

如果求积精度不足，即 **欠积分 (under-integration)**，会带来一系列严重的后果：
1.  **失去稳定性**：混淆误差可以被看作一种数值噪声源，它会破坏离散算子精巧的[代数结构](@entry_id:137052)，导致能量的虚假产生，最终可能引发计算的不稳定甚至崩溃。
2.  **破坏守恒性和对称性**：许多 DG 格式的设计依赖于离散层面能够模拟连续层面的一些基本性质，例如通过分部积分（或[格林公式](@entry_id:173118)）得到的性质。例如，一个旨在保持离散 **斜对称性 (skew-symmetry)** 的分裂格式，其有效性依赖于离散的散度定理能够精确成立。这要求体积和表面求积法则能够精确积分形如 $\nabla \cdot (v_h \mathbf{f}(u_h))$ 和 $v_h (\mathbf{f}(u_h) \cdot \mathbf{n})$ 的项。如果通量 $\mathbf{f}(u)$ 是 $u$ 的 $\rho$ 次多项式，那么为了保持离散散度定理，体积求积的精确度等级需满足 $q_v \ge \rho N + N - 1$，而表面求积需满足 $q_f \ge \rho N + N$（其中 $N$ 是逼近多项式次数）。欠积分会破坏这个等式，从而破坏格式的斜对称性和守恒性 [@problem_id:3406245]。

#### 缓解混淆的策略

为了应对混淆带来的挑战，研究人员发展了多种策略。以基于 GLL 节点的 nodal DGSEM 方法为例：
- **过积分 (Over-integration)**：最直接的方法是使用比标准 GLL 法则更高阶的[求积法则](@entry_id:753909)（例如，使用更多点的 GL 法则），使其精确度等级足以精确积分[非线性](@entry_id:637147)项。这种方法可以消除混淆误差并保持守恒性和[自由流](@entry_id:159506)保持特性。然而，它有一个微妙的缺点：标准 nodal DGSEM 的稳定性证明严重依赖于由同一 GLL 节点集导出的[微分矩阵](@entry_id:149870)和质量矩阵所满足的 **[分部求和](@entry_id:185335) (Summation-By-Parts, SBP)** 性质。过积分改变了积分算子（即质量矩阵），从而破坏了这种精巧的 SBP 结构，使得标准的稳定性证明不再适用 [@problem_id:3406243]。
- **基于投影的去混淆 (Projection-based de-aliasing)**：这是一种更为先进和结构保持的策略。其思想是在计算[非线性](@entry_id:637147)通量 $f(u_h)$ 后，不直接将其用于[弱形式](@entry_id:142897)的计算，而是先将其 $L^2$ 投影回低阶[多项式空间](@entry_id:144410) $\mathbb{P}^N$ 中，得到 $\Pi_N f(u_h)$。然后，在整个计算中使用这个投影后的通量。由于 $\Pi_N f(u_h)$ 是一个 $N$ 次多项式，所有后续的乘积（如与[基函数](@entry_id:170178)导数的[内积](@entry_id:158127)）都可以在标准 GLL 求积下被精确或高精度地计算。这种方法与[熵守恒通量](@entry_id:749013)和分裂格式相结合，可以构建出保持 SBP 性质并具有可证明的[非线性](@entry_id:637147) **[熵稳定性](@entry_id:749023) (entropy stability)** 的格式，是当前构造健壮高阶 DG 方法的前沿技术 [@problem_id:3406243]。

总之，[数值求积](@entry_id:136578)是谱方法和 DG 方法中一个理论与实践紧密结合的关键环节。理解不同[求积法则](@entry_id:753909)的性质，并根据单元几何、被积函数特性和所需保持的离散性质来选择合适的求积精度，是设计准确、稳定和高效的高阶数值格式的基础。