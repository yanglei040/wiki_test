{"hands_on_practices": [{"introduction": "本节我们通过一个具体的计算练习来阐明基函数重组中的一个核心思想：“提升”(lifting)技术。我们将看到，为了处理非齐次边界条件，我们可以将解分解为一个满足非齐次边界条件的“提升函数”和一个满足相应齐次条件的修正项之和。这个练习将引导你亲手构建提升函数，并验证一个重要的结论：提升函数的具体选择只影响方程组的右端项，而不会改变描述齐次问题核心性质的刚度矩阵及其条件数[@problem_id:3365735]。", "problem": "考虑区间 $[-1,1]$ 上具有非齐次狄利克雷边界条件的一维泊松边值问题，\n$$-u''(x)=f(x)\\quad\\text{for }x\\in[-1,1],\\qquad u(-1)=\\alpha,\\quad u(1)=\\beta,$$\n其中 $f$ 是一个给定的足够光滑的函数，$\\alpha,\\beta\\in\\mathbb{R}$ 是给定的边界数据。在谱Galerkin方法中，通过使用提升函数 $w(x)$ 进行基重组来施加边界条件，使得 $u(x)=v(x)+w(x)$，且 $v(x)$ 满足齐次狄利克雷条件。Galerkin方法由双线性形式\n$$a(u,v)=\\int_{-1}^{1}u'(x)\\,v'(x)\\,\\mathrm{d}x,$$\n和线性泛函\n$$\\ell(v)=\\int_{-1}^{1}f(x)\\,v(x)\\,\\mathrm{d}x$$\n定义。\n取试探空间为最高次数为3的实多项式空间，并通过将 $w(x)$ 显式地构造为一个满足 $w(-1)=\\alpha$ 和 $w(1)=\\beta$ 的低次多项式来施加边界条件。然后，执行基重组将问题简化到齐次子空间上。具体来说：\n\n- 构造一个线性提升函数 $w_{L}(x)$ 和一个二次提升函数 $w_{Q}(x)$，使得 $w_{L}(-1)=\\alpha$，$w_{L}(1)=\\beta$，以及 $w_{Q}(-1)=\\alpha$，$w_{Q}(1)=\\beta$。\n- 使用由两个基函数 $\\phi_{1}(x)=x^{2}-1$ 和 $\\phi_{2}(x)=x^{3}-x$ 张成的齐次子空间，这两个基函数都满足对 $j\\in\\{1,2\\}$ 有 $\\phi_{j}(-1)=\\phi_{j}(1)=0$。\n- 推导元素为 $K_{ij}=a(\\phi_{i},\\phi_{j})$（$i,j\\in\\{1,2\\}$）的 $2\\times 2$ Galerkin刚度矩阵 $K$，并确定其欧几里得条件数 $\\kappa_{2}(K)$。\n\n分析 $w(x)$ 的选择是否影响齐次子空间上简化后的Galerkin系统的条件数，并以闭式解形式计算 $\\kappa_{2}(K)$ 的精确值。将最终答案表示为单个精确数或单个闭式解析表达式。无需四舍五入。", "solution": "该问题要求分析用于求解带非齐次狄利克雷边界条件的一维泊松方程的谱伽辽金方法。核心任务是确定提升函数的选择是否影响简化系统刚度矩阵的条件数，并计算该矩阵在特定多项式基下的条件数。\n\n首先，我们分析伽辽金系统的结构。问题由下式给出\n$$-u''(x)=f(x)\\quad\\text{for }x\\in[-1,1],\\qquad u(-1)=\\alpha,\\quad u(1)=\\beta.$$\n我们将解 $u(x)$ 分解为 $u(x) = v(x) + w(x)$，其中 $w(x)$ 是一个满足非齐次边界条件 $w(-1)=\\alpha$ 和 $w(1)=\\beta$ 的提升函数，而 $v(x)$ 属于一个函数满足齐次边界条件（即 $v(-1)=v(1)=0$）的函数空间。\n\n弱形式是找到 $u(x)$，使得对于所有在边界上为零的合适测试函数 $\\phi$，都有 $a(u, \\phi) = \\ell(\\phi)$。代入 $u=v+w$ 得：\n$$a(v+w, \\phi) = \\ell(\\phi)$$\n根据双线性形式 $a(\\cdot, \\cdot)$ 的线性性质，我们有：\n$$a(v, \\phi) + a(w, \\phi) = \\ell(\\phi)$$\n这可以重新整理以求解未知函数 $v(x)$:\n$$a(v, \\phi) = \\ell(\\phi) - a(w, \\phi)$$\n我们在一个由满足齐次边界条件的基函数 $\\{\\phi_j\\}_{j=1}^N$ 张成的有限维子空间中寻找 $v(x)$ 的近似解。令 $v(x) = \\sum_{j=1}^{N} c_j \\phi_j(x)$。使用伽辽金方法，我们对每个基函数 $\\phi_i(x)$（其中 $i=1, \\dots, N$）进行测试：\n$$\\sum_{j=1}^{N} c_j a(\\phi_j, \\phi_i) = \\ell(\\phi_i) - a(w, \\phi_i)$$\n这构成了一个线性方程组 $K C = F$，其中：\n- 刚度矩阵 $K$ 的元素为 $K_{ij} = a(\\phi_i, \\phi_j)$。\n- 未知数向量 $C$ 的元素为 $C_j = c_j$。\n- 右端向量 $F$ 的元素为 $F_i = \\ell(\\phi_i) - a(w, \\phi_i) = \\int_{-1}^{1}f(x)\\phi_i(x)\\,\\mathrm{d}x - \\int_{-1}^{1}w'(x)\\phi_i'(x)\\,\\mathrm{d}x$。\n\n简化后的伽辽金系统的条件数由刚度矩阵 $K$ 的条件数决定。从其定义 $K_{ij} = a(\\phi_i, \\phi_j)$ 可以看出，$K$ 的元素仅取决于双线性形式 $a(\\cdot, \\cdot)$ 和齐次子空间的基函数 $\\{\\phi_j\\}$。提升函数 $w(x)$ 的选择只影响右端向量 $F$。因此，刚度矩阵 $K$ 及其条件数与 $w(x)$ 的具体选择无关，无论是线性的 $w_L(x)$、二次的 $w_Q(x)$，还是任何其他有效的提升函数。\n\n按照问题的要求，我们可以构造这类提升函数的例子。\n一个线性提升函数 $w_L(x) = ax+b$ 必须满足：\n$$w_L(-1) = -a+b = \\alpha$$\n$$w_L(1) = a+b = \\beta$$\n解此方程组得到 $a = \\frac{\\beta-\\alpha}{2}$ 和 $b = \\frac{\\alpha+\\beta}{2}$。所以，$w_L(x) = \\frac{\\beta-\\alpha}{2}x + \\frac{\\alpha+\\beta}{2}$。\n一个二次提升函数 $w_Q(x)$ 可以通过在 $w_L(x)$ 上加上一个在边界 $x=\\pm 1$ 处为零的二次项来构造。一个简单的选择是加上 $x^2-1$ 的一个倍数：\n$$w_Q(x) = w_L(x) + C(x^2-1) = \\left(\\frac{\\beta-\\alpha}{2}\\right)x + \\frac{\\alpha+\\beta}{2} + C(x^2-1)$$\n对于任何非零常数 $C \\in \\mathbb{R}$，这确保了该多项式是真正的二次多项式。这满足 $w_Q(-1)=\\alpha$ 和 $w_Q(1)=\\beta$。\n\n现在，我们计算由基函数 $\\phi_{1}(x)=x^{2}-1$ 和 $\\phi_{2}(x)=x^{3}-x$ 张成的齐次子空间的刚度矩阵 $K$。\n双线性形式为 $a(g,h)=\\int_{-1}^{1}g'(x)h'(x)\\,\\mathrm{d}x$。\n基函数的导数是：\n$$\\phi_{1}'(x) = 2x$$\n$$\\phi_{2}'(x) = 3x^{2}-1$$\n$2\\times 2$ 刚度矩阵 $K$ 的元素为 $K_{ij} = a(\\phi_i, \\phi_j)$。\n\n$K_{11} = a(\\phi_1, \\phi_1) = \\int_{-1}^{1} \\phi_1'(x) \\phi_1'(x) \\,\\mathrm{d}x = \\int_{-1}^{1} (2x)^2 \\,\\mathrm{d}x = \\int_{-1}^{1} 4x^2 \\,\\mathrm{d}x$\n$$K_{11} = 4 \\left[ \\frac{x^3}{3} \\right]_{-1}^{1} = \\frac{4}{3} (1^3 - (-1)^3) = \\frac{4}{3} (1 - (-1)) = \\frac{8}{3}$$\n\n$K_{12} = a(\\phi_1, \\phi_2) = \\int_{-1}^{1} \\phi_1'(x) \\phi_2'(x) \\,\\mathrm{d}x = \\int_{-1}^{1} (2x)(3x^2-1) \\,\\mathrm{d}x = \\int_{-1}^{1} (6x^3 - 2x) \\,\\mathrm{d}x$\n被积函数是奇函数，且积分是在对称区间 $[-1, 1]$ 上进行的，所以积分为零。\n$$K_{12} = 0$$\n因为双线性形式是对称的，所以 $K_{21} = K_{12} = 0$。\n\n$K_{22} = a(\\phi_2, \\phi_2) = \\int_{-1}^{1} \\phi_2'(x) \\phi_2'(x) \\,\\mathrm{d}x = \\int_{-1}^{1} (3x^2-1)^2 \\,\\mathrm{d}x = \\int_{-1}^{1} (9x^4 - 6x^2 + 1) \\,\\mathrm{d}x$\n被积函数是偶函数。\n$$K_{22} = \\left[ \\frac{9x^5}{5} - \\frac{6x^3}{3} + x \\right]_{-1}^{1} = \\left[ \\frac{9}{5}x^5 - 2x^3 + x \\right]_{-1}^{1}$$\n$$K_{22} = \\left( \\frac{9}{5}(1)^5 - 2(1)^3 + 1 \\right) - \\left( \\frac{9}{5}(-1)^5 - 2(-1)^3 + (-1) \\right)$$\n$$K_{22} = \\left( \\frac{9}{5} - 2 + 1 \\right) - \\left( -\\frac{9}{5} + 2 - 1 \\right) = \\left( \\frac{4}{5} \\right) - \\left( -\\frac{4}{5} \\right) = \\frac{8}{5}$$\n因此，刚度矩阵为：\n$$K = \\begin{pmatrix} \\frac{8}{3}  0 \\\\ 0  \\frac{8}{5} \\end{pmatrix}$$\n问题要求计算欧几里得条件数 $\\kappa_2(K)$。对于一个对称正定矩阵，$\\kappa_2(K) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}}$，其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是 $K$ 的最大和最小特征值。\n由于 $K$ 是一个对角矩阵，其特征值就是其对角元素：$\\lambda_1 = \\frac{8}{3}$ 和 $\\lambda_2 = \\frac{8}{5}$。\n比较这两个特征值：$\\frac{8}{3} = \\frac{40}{15}$ 且 $\\frac{8}{5} = \\frac{24}{15}$。\n所以，$\\lambda_{\\max} = \\frac{8}{3}$ 且 $\\lambda_{\\min} = \\frac{8}{5}$。\n条件数为：\n$$\\kappa_2(K) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{8/3}{8/5} = \\frac{8}{3} \\cdot \\frac{5}{8} = \\frac{5}{3}$$\n最终结果与提升函数 $w_L(x)$ 和 $w_Q(x)$ 无关，正如我们最初的分析所预测的那样。", "answer": "$$\\boxed{\\frac{5}{3}}$$", "id": "3365735"}, {"introduction": "理解了将问题转化为齐次子空间求解的原理后，下一个关键步骤是如何在实践中高效、稳健地计算出这个齐次子空间的基。这个练习将带你深入探讨这一过程的算法核心，即如何利用矩阵的QR分解来求约束矩阵的零空间，从而获得重组后的基。这个问题强调了从理论（线性代数基本定理）到高效数值实现（特别是处理大型稀疏系统时避免生成稠密矩阵）的过渡，这是开发可靠科学计算软件的关键一步[@problem_id:3365764]。", "problem": "考虑一种谱方法或间断伽辽金离散化，其中齐次本质边界条件通过一个作用于全局系数向量 $u \\in \\mathbb{R}^{n}$ 的线性约束矩阵 $B \\in \\mathbb{R}^{m \\times n}$ 来强制实施，使得 $B u = 0$。为通过基重组消去约束，需要寻找零空间 $\\ker(B)$ 的一个标准正交基 $N \\in \\mathbb{R}^{n \\times (n-r)}$，其中 $r = \\operatorname{rank}(B)$，并为一个对称正定刚度矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 构建降维算子 $\\tilde{A} = N^T A N$。从第一性原理出发，利用 $(\\ker(B))^\\perp = \\operatorname{range}(B^T)$（线性代数基本定理）以及正交矩阵 $Q$ 保持内积和范数不变的事实。假设 $B$ 是稀疏且可能秩亏的，并且 $A$ 以显式矩阵或无矩阵线性算子的形式可用。\n\n哪个选项概述了一种通过对 $B^T$ 进行列主元QR分解来计算 $N$ 的正确且高效的算法，该算法包括为 $\\ker(B)$ 提取标准正交基以及在不显式组装稠密矩阵的情况下构建 $\\tilde{A} = N^T A N$ 的步骤？\n\nA. 对 $B^T \\in \\mathbb{R}^{n \\times m}$ 进行列主元QR分解，得到一个置换矩阵 $\\Pi \\in \\mathbb{R}^{m \\times m}$、一个正交矩阵 $Q \\in \\mathbb{R}^{n \\times n}$ 和一个上三角矩阵 $R \\in \\mathbb{R}^{r \\times r}$，使得 $B^T \\Pi = Q \\begin{bmatrix} R \\\\ 0 \\end{bmatrix}$，其中 $r$ 根据 $R$ 对角线上的数值容差选定。设 $Q = [\\,Q_1\\;Q_2\\,]$，其中 $Q_1 \\in \\mathbb{R}^{n \\times r}$ 且 $Q_2 \\in \\mathbb{R}^{n \\times (n-r)}$，并定义 $N := Q_2$，它是 $\\ker(B)$ 的一个标准正交基。为避免显式构造 $N$，使用 $Q$ 的Householder反射子表示：对任意 $x \\in \\mathbb{R}^{n-r}$，计算 $N x$ 为 $Q \\begin{bmatrix} 0 \\\\ x \\end{bmatrix}$；对任意 $w \\in \\mathbb{R}^{n}$，计算 $N^T w$ 为 $Q^T w$ 的末尾 $n-r$ 个分量。通过计算 $Q^T A Q$ 的末尾子块来构建 $\\tilde{A}$，即 $\\tilde{A} = (Q^T A Q)_{(r+1:n,\\;r+1:n)}$，这通过对 $A$ 的列（如果仅有对 $A$ 的算子访问权限，则为向量）进行 $Q$ 和 $Q^T$ 的无矩阵应用来实现，从而避免稠密组装。\n\nB. 对 $B \\in \\mathbb{R}^{m \\times n}$ 进行列主元QR分解，得到 $B \\Pi = Q R$，其中 $Q \\in \\mathbb{R}^{m \\times m}$ 是正交的，$R \\in \\mathbb{R}^{m \\times n}$ 是上梯形的，通过容差选择 $r$，并设 $N := Q_{:,\\,r+1:m}$。然后，显式地构建 $\\tilde{A} = N^T A N$。\n\nC. 进行列主元QR分解 $B^T \\Pi = Q \\begin{bmatrix} R \\\\ 0 \\end{bmatrix}$，通过 $\\Pi$ 识别主元列集合，并使用 $Q$ 的前导列定义 $N$ 为 $N := Q_{:,\\,1:r}$。将 $\\tilde{A}$ 构建为前导子块 $(Q^T A Q)_{(1:r,\\;1:r)}$。\n\nD. 计算奇异值分解 (SVD) $B = U \\Sigma V^T$，根据奇异值的容差选择数值秩 $r$，设 $N := V_{:,\\,r+1:n}$，并显式地构建 $\\tilde{A} = N^T A N$。这避免了QR分解但达到了相同的结果。\n\n根据所述原理，选择唯一一个选项，其算法在通过对 $B^T$ 进行列主元QR分解来提取 $\\ker(B)$ 的标准正交基方面是正确的，并且在不显式组装稠密矩阵的情况下构建 $\\tilde{A}$ 方面是高效的，以此回答这个多项选择题。", "solution": "目标是找到一个高效且正确的算法，该算法使用 $B^T$ 的QR分解来构建 $\\ker(B)$ 的基 $N$ 以及降维后的矩阵 $\\tilde{A} = N^T A N$。\n\n1.  **寻找零空间（$\\ker(B)$）的基：** 线性代数基本定理指出，矩阵 $B$ 的零空间是其转置矩阵 $B^T$ 的值域（或列空间）的正交补空间。即 $\\ker(B) = (\\operatorname{range}(B^T))^\\perp$。因此，我们的策略是首先找到 $\\operatorname{range}(B^T)$ 的一个基，然后确定其正交补空间。QR分解是实现这一目标的标准工具。\n\n2.  **使用 $B^T$ 的QR分解：** 我们对 $B^T$ 进行列主元QR分解：$B^T \\Pi = Q R$。其中，$Q$ 是一个 $n \\times n$ 的正交矩阵，$R$ 是一个 $n \\times m$ 的上梯形矩阵。$B^T$ 的秩 $r$ 由 $R$ 对角线上不可忽略的元素个数确定。我们可以将 $Q$ 分块为 $Q = [Q_1, Q_2]$，其中 $Q_1$ 有 $r$ 列，$Q_2$ 有 $n-r$ 列。\n    该分解表明，$B^T\\Pi$ 的列（即 $B^T$ 列的一个排列）可以写成 $Q$ 的前 $r$ 列的线性组合。因此，$Q_1$ 的列构成了 $\\operatorname{range}(B^T)$ 的一个标准正交基。\n    由于 $Q$ 是正交矩阵，其列构成了整个空间 $\\mathbb{R}^n$ 的一个标准正交基。由 $Q_2$ 的列所张成的空间是 $Q_1$ 列所张成空间的正交补空间。\n    因此，$Q_2$ 的列构成了 $(\\operatorname{range}(B^T))^\\perp$ 的一个标准正交基，这恰好就是 $\\ker(B)$。所以，我们必须将重组矩阵设为 $N = Q_2$。\n\n3.  **高效构建 $\\tilde{A}$：** 降维后的矩阵为 $\\tilde{A} = N^T A N = Q_2^T A Q_2$。对于大规模问题，显式构造稠密的矩阵 $Q$（或 $N=Q_2$）在计算上和内存上都非常昂贵。QR分解算法通常将 $Q$ 表示为一系列Householder反射的乘积，这使得我们可以在不显式构造 $Q$ 的情况下高效地计算矩阵-向量乘积（$Qx$ 和 $Q^T y$）。\n    矩阵 $\\tilde{A}$ 是更大的矩阵 $Q^T A Q$ 的右下角 $(n-r) \\times (n-r)$ 子块。我们可以逐列计算 $\\tilde{A}$。$\\tilde{A}$ 的第 $j$ 列是 $Q_2^T A (Q_2 e_j)$，其中 $e_j$ 是标准基向量。这可以通过依次应用算子 $Q_2$、$A$ 和 $Q_2^T$ 来实现，而使用 $Q$ 的Householder表示可以高效完成这些操作。\n\n4.  **评估选项：**\n    *   **A:** 此选项完全遵循了上述推导的整个过程。它分解 $B^T$，正确地将 $N$ 识别为 $Q_2$，并描述了计算 $\\tilde{A}$ 作为 $Q^T A Q$ 右下子块的高效、无矩阵方法。这是正确且高效的算法。\n    *   **B:** 此选项错误地分解 $B$ 而非 $B^T$。对 $B$ 进行QR分解得到的是 $\\operatorname{range}(B)$ 和 $\\ker(B^T)$ 的基，而我们需要的 $\\ker(B)$ 与此无关。\n    *   **C:** 此选项正确地分解了 $B^T$，但错误地选择了基 $N = Q_1$。$Q_1$ 是 $\\operatorname{range}(B^T)$ 的基，而非 $\\ker(B)$ 的基。\n    *   **D:** 此选项使用SVD。虽然SVD是找到零空间的有效方法（$V$ 的最后 $n-r$ 列构成了 $\\ker(B)$ 的基），但问题明确要求一种基于 $B^T$ 的QR分解的算法。", "answer": "$$\\boxed{A}$$", "id": "3365764"}, {"introduction": "作为本章的综合性实践，这个编码练习将引导你完成一个完整的基函数重组工作流。我们将从一个更复杂的混合边界条件（同时包含Dirichlet和Neumann类型）入手，应用提升函数和零空间计算，并最终解决一个在实际应用中至关重要的问题：数值稳定性。通过对重组后的基进行M-正交化，你将亲眼见证并量化这一步骤如何确保最终离散系统的质量矩阵保持良好的条件数，从而保证数值解的可靠性[@problem_id:3365793]。", "problem": "考虑区间 $[-1,1]$ 上的经典勒让德多项式 $\\{P_n(x)\\}_{n=0}^N$，其标准归一化为 $P_n(1)=1$。设勒让德基下的 $L^2([-1,1])$ 质量矩阵 $M \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 定义为\n$$\nM_{ij} \\equiv \\int_{-1}^{1} P_i(x) P_j(x) \\, dx.\n$$\n你需要通过对勒让德基进行线性重组，构造一个强制施加混合边界条件 $u(-1)=0$ 和 $u'(1)=\\alpha$ 的基。由于条件 $u'(1)=\\alpha$ 是非齐次的，我们使用标准的提升思想：将 $u(x)$ 写为 $u(x) = \\ell(x) + w(x)$，其中提升函数 $\\ell(x)$ 满足边界数据，而修正函数 $w(x)$ 满足齐次条件。具体来说，施加以下条件：\n- $\\ell(-1)=0$ 且 $\\ell'(1)=\\alpha$，\n- $w(-1)=0$ 且 $w'(1)=0$。\n\n起始基础和熟知事实：\n- 正交性：对于所有整数 $m,n \\ge 0$，有 $\\displaystyle \\int_{-1}^{1} P_m(x) P_n(x)\\, dx = \\frac{2}{2n+1}\\,\\delta_{mn}$。\n- 端点值：对于所有整数 $n \\ge 0$，有 $P_n(-1) = (-1)^n$。\n- 端点导数：对于所有整数 $n \\ge 0$，有 $P_n'(1) = \\frac{n(n+1)}{2}$。\n\n待执行的任务：\n1. 将任意次数至多为 $N$ 的多项式 $v(x)$ 表示为 $v(x) = \\sum_{n=0}^{N} c_n P_n(x)$，其系数向量为 $c \\in \\mathbb{R}^{N+1}$。通过以下方式编码作用于 $c$ 的边界算子 $A \\in \\mathbb{R}^{2 \\times (N+1)}$：\n   $$\n   A\\,c \\equiv \\begin{bmatrix}\n   \\sum_{n=0}^{N} c_n P_n(-1) \\\\\n   \\sum_{n=0}^{N} c_n P_n'(1)\n   \\end{bmatrix}\n   = \\begin{bmatrix}\n   u(-1) \\\\\n   u'(1)\n   \\end{bmatrix}.\n   $$\n   使用上述事实以闭式形式显式构造 $A$。\n\n2. 计算一个满足 $\\ell(-1)=0$ 和 $\\ell'(1)=\\alpha$ 的最小次数提升函数 $\\ell(x)$。证明 $\\ell(x) = \\alpha(1+x)$ 是一个有效的选择，并将其在勒让德基中表示。通过直接计算验证 $A\\,c_{\\text{lift}} = [0,\\alpha]^T$ 精确成立，其中 $c_{\\text{lift}}$ 是 $\\ell(x)$ 的勒让德系数。\n\n3. 为齐次子空间\n   $$\n   \\mathcal{V}_H \\equiv \\left\\{ v(x) = \\sum_{n=0}^{N} c_n P_n(x) \\;:\\; A\\,c = \\begin{bmatrix}0\\\\0\\end{bmatrix} \\right\\}\n   $$\n   构造一个重组基。计算一个系数矩阵 $Z \\in \\mathbb{R}^{(N+1)\\times K}$，其列构成 $\\ker(A)$ 的一个基，其中对于 $N \\ge 2$，$K = N-1$。相应的齐次基函数为 $\\{\\psi_k(x)\\}_{k=1}^{K}$，其中 $\\psi_k(x) = \\sum_{n=0}^{N} Z_{n,k} P_n(x)$。\n\n4. 关于 $L^2$ 内积，齐次基中的质量矩阵为 $M_Z = Z^T M Z \\in \\mathbb{R}^{K \\times K}$。计算其 2-范数条件数 $\\kappa(M_Z)$。\n\n5. 关于 $L^2$ 质量矩阵进行正交规范化。令 $W = \\operatorname{diag}\\!\\big(\\sqrt{2/(2n+1)}\\big)_{n=0}^{N}$，因此 $M = W^2$。定义 $Y = W Z$，进行一次瘦 $\\mathbb{R}$ 值 $QR$ 分解 $Y = Q R$，其中 $Q \\in \\mathbb{R}^{(N+1)\\times K}$ 具有正交规范列，并设 $M$-正交规范系数矩阵为 $Z_{\\text{ortho}} = W^{-1} Q$。正交规范化的重组基为 $\\{\\phi_k(x)\\}_{k=1}^K$，其中 $\\phi_k(x) = \\sum_{n=0}^{N} (Z_{\\text{ortho}})_{n,k} P_n(x)$。验证 $Z_{\\text{ortho}}^T M Z_{\\text{ortho}} = I_K$ 并且每个 $\\phi_k$ 都满足齐次边界条件。\n\n6. 比较以下条件数：\n   - 原始勒让德基（大小为 $(N+1)$）的 $\\kappa(M)$，即 $M \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 的条件数，\n   - 正交规范化之前的 $\\kappa(M_Z)$，\n   - 正交规范化之后的 $\\kappa(Z_{\\text{ortho}}^T M Z_{\\text{ortho}})$。\n\n7. 通过计算\n   $$\n   \\varepsilon_{\\text{bc}} \\equiv \\max\\left\\{ \\max_{k} |\\phi_k(-1)| ,\\; \\max_{k} |\\phi_k'(1)| \\right\\},\n   $$\n   来量化边界条件实施误差，以及通过计算\n   $$\n   \\varepsilon_{\\text{lift}} \\equiv \\left\\|A\\,c_{\\text{lift}} - \\begin{bmatrix}0\\\\ \\alpha\\end{bmatrix}\\right\\|_{\\infty}\n   $$\n   来量化提升残差。\n\n你的程序必须实现上述步骤，并为以下参数对 $(N,\\alpha)$ 的测试套件生成数值输出：\n- 测试用例 1：$(N,\\alpha)=(3,1.5)$，\n- 测试用例 2：$(N,\\alpha)=(6,0.0)$，\n- 测试用例 3：$(N,\\alpha)=(10,-2.0)$，\n- 测试用例 4：$(N,\\alpha)=(2,0.7)$。\n\n对于每个测试用例，按顺序输出一个包含 5 个浮点值的列表\n$[\\kappa(M),\\;\\kappa(M_Z),\\;\\kappa(Z_{\\text{ortho}}^T M Z_{\\text{ortho}}),\\;\\varepsilon_{\\text{bc}},\\;\\varepsilon_{\\text{lift}}]$。\n将所有测试用例的列表按上述顺序列出，汇总成一个单一列表。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的列表的列表形式的结果（例如，$[[r_{1,1},\\dots,r_{1,5}],[r_{2,1},\\dots,r_{2,5}],\\dots]$）。\n- 除了有效的 Python 列表格式所需的空格外，不应打印任何额外的文本或空格。", "solution": "该解答旨在通过Python实现问题中概述的步骤。以下是对其背后逻辑的剖析和对结果的解读。\n\n1.  **边界算子与提升：** 第一步是将边界条件 $u(-1)=0$ 和 $u'(1)=\\alpha$ 转化为矩阵方程 $Ac=b$。利用勒让德多项式及其导数在端点的已知值，我们可以构造出矩阵 $A$。所提出的线性提升函数 $\\ell(x) = \\alpha(1+x)$ 满足非齐次边界条件，其对应的系数向量为 $c_{\\text{lift}}$。通过计算乘积 $Ac_{\\text{lift}}$，可以验证结果确实为 $[0, \\alpha]^T$，从而证实了提升方法的正确性。数值计算出的提升残差 $\\varepsilon_{\\text{lift}}$ 将接近机器精度，这从数值上确认了其解析上的精确性。\n\n2.  **齐次基的构造：** 基函数重组的核心在于为那些满足*齐次*边界条件（$w(-1)=0, w'(1)=0$）的函数寻找一个基。这等价于寻找算子矩阵 $A$ 的零空间（核）的一个基。我们使用标准的数值线性代数函数（如 `scipy.linalg.null_space`）来计算 $\\ker(A)$ 的一个标准正交基。所得矩阵 $Z$ 的列向量即为我们初始齐次基函数集合 $\\{\\psi_k\\}$ 的系数向量。\n\n3.  **质量矩阵与条件数：** 质量矩阵表示基函数的 $L^2$ 内积。\n    *   对于原始的勒让德基，由于其正交性，质量矩阵 $M$ 是对角矩阵。其条件数 $\\kappa(M)$ 可以解析地求出为 $2N+1$。这表明随着多项式次数 $N$ 的增加，该基在元素缩放方面的条件会变差。\n    *   对于我们重组后的齐次基 $\\{\\psi_k\\}$，其质量矩阵为 $M_Z = Z^T M Z$。由于 $Z$ 的列在构造时未考虑 $M$-内积，因此 $M_Z$ 通常是一个稠密的非对角矩阵。其条件数 $\\kappa(M_Z)$ 通常大于1，且可能很大，这表明这个新基虽然满足边界条件，但可能不利于数值稳定性。\n\n4.  **M-正交化：** 为了解决条件数问题，我们对基 $\\{\\psi_k\\}$ 关于 $L^2$ 内积（等价于对系数向量使用 $M$-内积）进行正交化。这是一个格拉姆-施密特（Gram-Schmidt）过程。最终得到的基 $\\{\\phi_k\\}$ 对应的系数矩阵为 $Z_{\\text{ortho}}$。\n    *   根据构造，新的质量矩阵 $Z_{\\text{ortho}}^T M Z_{\\text{ortho}}$ 是单位矩阵 $I_K$。\n    *   因此，其条件数为 $\\kappa(I_K) = 1$。数值结果应显示一个非常接近1的值。这证明了正交化过程是成功的，并产生了一个用于降维问题的完美条件基。\n\n5.  **误差分析：** 最后，我们验证我们新的、条件良好的基函数 $\\{\\phi_k\\}$ 仍然满足齐次边界条件。误差 $\\varepsilon_{\\text{bc}}$ 度量了在边界上与零的最大偏差。该值应非常小，在机器精度量级，这证实了数值线性代数运算（求零空间、QR分解）的准确性。\n\n通过比较 $\\kappa(M)$、$\\kappa(M_Z)$ 和 $\\kappa(Z_{\\text{ortho}}^T M Z_{\\text{ortho}})$，这个练习揭示了一个关键概念：仅仅找到一个满足约束的基是不够的；为了数值稳定性，该基还必须在问题的内积下是良态的（例如，正交的）。M-正交化步骤实现了这一点，将一个可能病态的问题转化为了一个完美条件的问题。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (3, 1.5),\n        (6, 0.0),\n        (10, -2.0),\n        (2, 0.7),\n    ]\n\n    all_results = []\n    for N, alpha in test_cases:\n        result = _compute_basis_properties(N, alpha)\n        all_results.append(result)\n\n    # Format the final output as a single list of lists string.\n    # e.g., [[r1, r2, ...], [s1, s2, ...]]\n    # Using a simple string build to avoid extra spaces from standard list repr.\n    output_str = \"[\" + \",\".join([\"[\" + \",\".join(map(str, res)) + \"]\" for res in all_results]) + \"]\"\n    print(output_str)\n\ndef _compute_basis_properties(N, alpha):\n    \"\"\"\n    Performs the calculations for a single test case (N, alpha).\n\n    Args:\n        N (int): The maximum polynomial degree.\n        alpha (float): The value for the inhomogeneous derivative boundary condition.\n\n    Returns:\n        list: A list of 5 floating-point values:\n              [cond(M), cond(M_Z), cond(Z_ortho^T M Z_ortho), eps_bc, eps_lift].\n    \"\"\"\n    if N  2:\n        raise ValueError(\"N must be >= 2 for the kernel dimension to be N-1.\")\n\n    N_plus_1 = N + 1\n    K = N - 1\n\n    # Task 1: Construct the boundary operator matrix A\n    n_vals = np.arange(N_plus_1, dtype=float)\n    row1 = (-1.0)**n_vals  # P_n(-1)\n    row2 = n_vals * (n_vals + 1) / 2.0  # P_n'(1)\n    A = np.vstack([row1, row2])\n\n    # Task 2: Define the lifting coefficient vector c_lift\n    c_lift = np.zeros(N_plus_1)\n    if N_plus_1 > 1:\n        c_lift[0] = alpha\n        c_lift[1] = alpha\n\n    # Task 3: Compute the kernel of A to get the homogeneous basis coefficient matrix Z\n    # scipy.linalg.null_space returns an orthonormal basis for the null space.\n    Z = linalg.null_space(A)\n\n    # Define the L2 mass matrix M for the Legendre basis\n    diag_M = 2.0 / (2.0 * n_vals + 1.0)\n    M = np.diag(diag_M)\n\n    # Task 4: Compute the mass matrix M_Z in the new basis and its condition number\n    # For N=2, K=1, M_Z is a scalar, so its condition number is 1.\n    if K > 0:\n        M_Z = Z.T @ M @ Z\n        cond_M_Z = np.linalg.cond(M_Z)\n    else: # Should not happen based on N>=2\n        cond_M_Z = 1.0\n\n    # Task 5: Orthonormalize the basis with respect to the M inner product\n    W = np.diag(np.sqrt(diag_M))\n    W_inv = np.diag(1.0 / np.sqrt(diag_M))\n    \n    Z_ortho = np.zeros_like(Z)\n    if K > 0:\n        Y = W @ Z\n        # Thin QR decomposition\n        Q, R = np.linalg.qr(Y, mode='reduced')\n        Z_ortho = W_inv @ Q\n\n    # Task 6: Compare condition numbers\n    # Analytical condition number for the diagonal matrix M\n    cond_M = (2.0 / 1.0) / (2.0 / (2.0 * N + 1.0))\n\n    # Condition number of the mass matrix in the M-orthonormal basis (should be ~1)\n    if K > 0:\n        M_ortho = Z_ortho.T @ M @ Z_ortho\n        cond_M_ortho = np.linalg.cond(M_ortho)\n    else:\n        cond_M_ortho = 1.0\n\n    # Task 7: Quantify errors\n    # Boundary condition enforcement error for the orthonormal basis\n    if K > 0:\n        bc_error_matrix = A @ Z_ortho\n        eps_bc = np.max(np.abs(bc_error_matrix))\n    else:\n        eps_bc = 0.0\n\n    # Lifting residual error\n    lift_residual = A @ c_lift - np.array([0.0, alpha])\n    eps_lift = np.max(np.abs(lift_residual))\n\n    return [cond_M, cond_M_Z, cond_M_ortho, eps_bc, eps_lift]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3365793"}]}