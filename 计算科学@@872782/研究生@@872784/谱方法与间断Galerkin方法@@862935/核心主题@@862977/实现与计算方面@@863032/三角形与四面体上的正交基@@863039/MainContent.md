## 引言
在[高阶数值方法](@entry_id:142601)（如谱方法和间断Galerkin方法）的领域中，选择合适的函数基是决定计算精度、效率和数值稳定性的基石。特别是在处理复杂的几何域时，我们常常需要将计算域分解为三角形或四面体等基本单元，即所谓的单纯形。然而，与简单的矩形或立方体单元不同，在单纯形上构造一组既能高效逼近解又在计算上易于操作的[正交多项式](@entry_id:146918)基，是一个充满挑战且至关重要的课题。这正是本文旨在解决的核心知识缺口：如何在这些非张量积结构的几何上系统地构建和应用正交基。

通过本文的学习，读者将全面掌握在单纯形上构建[正交基](@entry_id:264024)的理论与实践。我们首先将在“原理与机制”一章中，深入探讨正交性的数学定义、其对于简化数值计算（特别是[对角化](@entry_id:147016)质量矩阵）的巨大优势，并对比分析两种主要的构造方法：经典的[Gram-Schmidt过程](@entry_id:141060)和更优雅的基于坐标变换的解析方法。接着，在“应用与[交叉](@entry_id:147634)学科联系”一章中，我们将展示这些理论工具如何在[流体力学](@entry_id:136788)、电磁学等领域的[偏微分方程离散化](@entry_id:175821)中发挥作用，探讨它们在处理边界耦合、矢量场问题以及[多尺度分析](@entry_id:270982)中的强大能力。最后，“实践练习”部分将提供一系列精心设计的编程与推导问题，帮助读者将理论知识转化为解决实际计算问题的具体技能，从而真正巩固对这一关键技术的理解。

## 原理与机制

本章旨在深入探讨在单纯形（如三角形和四面体）上构造[正交多项式](@entry_id:146918)基的原理与机制。在[谱方法](@entry_id:141737)和间断Galerkin（DG）方法等[高阶数值方法](@entry_id:142601)中，选择合适的[基函数](@entry_id:170178)是实现计算效率和[数值稳定性](@entry_id:146550)的关键。与在矩形区域上可以通过简单的[张量积](@entry_id:140694)来构造[正交基](@entry_id:264024)不同，单纯形单元的几何特性为正交基的构造带来了独特的挑战和精妙的解决方案。

### 单纯形上的多项式空间与正交性需求

在[高阶数值方法](@entry_id:142601)中，解通常在每个计算单元 $K$ 上用一个局部多项式来逼近。对于二维的[三角形单元](@entry_id:167871)或三维的[四面体单元](@entry_id:168311)，我们通常使用总次数（total-degree）[多项式空间](@entry_id:144410)，记为 $P^N(K)$。该空间包含了所有在 $d$ 维空间中总次数不超过 $N$ 的多项式。例如，在二维三角形 $T$ 上，该空间定义为：
$$
P^{N}(T) \equiv \left\{ p : T \to \mathbb{R} \ \big| \ p(x,y) = \sum_{i,j \ge 0, \ i+j \le N} a_{ij} \, x^{i} y^{j} \ \text{for some coefficients } a_{ij} \in \mathbb{R} \right\}
$$
这个空间的一个自然基是单项式基 $\{x^i y^j\}_{i+j \le N}$。此空间的维度，即独立[基函数](@entry_id:170178)的数量，可以通过组合学中的“[隔板法](@entry_id:152143)”（stars-and-bars method）来确定。计算满足 $i,j \ge 0$ 且 $i+j \le N$ 的整数对 $(i,j)$ 的数量，等价于计算非负整数方程 $i+j+k = N$ 的解的数量，其中 $k$ 是一个[松弛变量](@entry_id:268374)。这相当于将 $N$ 个相同的物品放入 $3$ 个不同的箱子中，其解的数量为 $\binom{N+2}{2} = \frac{(N+1)(N+2)}{2}$。因此，$\dim P^N(T) = \frac{(N+1)(N+2)}{2}$。类似地，对于三维四面体，其维度为 $\dim P^N(K) = \binom{N+3}{3}$。这与矩形区域上常用的张量积空间 $Q^N(S)$ 形成对比，后者的[基函数](@entry_id:170178)指数满足 $0 \le i, j \le N$，维度为 $(N+1)^2$。

为了分析和利用这些[基函数](@entry_id:170178)，我们需要定义一个[内积](@entry_id:158127)。在一个区域 $\Omega$ 上的标准 $L^2$ [内积](@entry_id:158127)定义为：
$$
\langle f, g \rangle_{\Omega} = \int_{\Omega} f(\mathbf{x}) g(\mathbf{x}) \, d\mathbf{x}
$$
一个函数系 $\{\phi_k\}$ 在此[内积](@entry_id:158127)下被称为**正交的**（orthogonal），如果对于任意两个不同的[基函数](@entry_id:170178) $\phi_i$ 和 $\phi_j$（即 $i \ne j$），它们的[内积](@entry_id:158127)为零：$\langle \phi_i, \phi_j \rangle = 0$。此外，如果一个非零函数 $\phi_i$ 的[内积](@entry_id:158127) $\langle \phi_i, \phi_i \rangle = \|\phi_i\|^2 > 0$。如果所有基[函数的范数](@entry_id:275551)都为1，即 $\langle \phi_i, \phi_j \rangle = \delta_{ij}$（其中 $\delta_{ij}$ 是克罗内克符号），则该函数系被称为**标准正交的**（orthonormal）。

那么，在[三角形单元](@entry_id:167871)上，最自然的单项式基 $\{x^i y^j\}_{i+j \le N}$ 是否是正交的呢？答案是否定的。我们可以通过一个简单的计算来验证这一点。考虑在参考单位直角三角形 $\widehat{T} = \{(x,y) : x \ge 0, y \ge 0, x+y \le 1\}$ 上的两个最简单的单项式：$1$（对应 $i=j=0$）和 $x$（对应 $i=1, j=0$）。它们的[内积](@entry_id:158127)为：
$$
\langle 1, x \rangle_{\widehat{T}} = \int_0^1 \int_0^{1-x} x \, dy \, dx = \int_0^1 x(1-x) \, dx = \left[ \frac{x^2}{2} - \frac{x^3}{3} \right]_0^1 = \frac{1}{6}
$$
由于[内积](@entry_id:158127)不为零，所以单项式基不是[正交基](@entry_id:264024)。实际上，几乎所有不同单项式的[内积](@entry_id:158127)都不是零，例如 $\langle x, y \rangle_{\widehat{T}} = \frac{1}{24}$。这种[非正交性](@entry_id:192553)意味着由单项式基构成的[Gram矩阵](@entry_id:148915)（其元素为 $G_{ij,kl} = \langle x^i y^j, x^k y^l \rangle$）是一个密集矩阵，并且随着多项式次数 $N$ 的增加，该矩阵会变得严重病态。这给数值计算带来了巨大的挑战，因此，我们迫切需要寻找并构造在单纯形上正交的多项式基。

### 正交基在[间断Galerkin方法](@entry_id:748369)中的作用

使用正交基带来的最直接和最重要的好处体现在[单元质量矩阵](@entry_id:748930)（element mass matrix）的结构上。在DG方法中，对于一个单元 $K$，其[质量矩阵](@entry_id:177093) $M^{(K)}$ 的定义为：
$$
M^{(K)}_{ij} = \int_K \phi_i(\mathbf{x}) \phi_j(\mathbf{x}) \, d\mathbf{x}
$$
其中 $\{\phi_i\}$ 是所选的[局部基](@entry_id:151573)函数。当求解时间相关的[偏微分方程](@entry_id:141332)时，通常需要在每个时间步求解一个形如 $M^{(K)} \frac{d\mathbf{u}}{dt} = \dots$ 的[线性系统](@entry_id:147850)，其中 $\mathbf{u}$ 是解的系数向量。这意味着我们需要计算[质量矩阵](@entry_id:177093)的逆 $M^{(K)^{-1}}$。

如果[基函数](@entry_id:170178) $\{\phi_i\}$ 是标准正交的，即 $\int_K \phi_i \phi_j \, d\mathbf{x} = \delta_{ij}$，那么[质量矩阵](@entry_id:177093) $M^{(K)}$ 就变成了单位矩阵 $I$。如果[基函数](@entry_id:170178)是正交但非标准的，即 $\int_K \phi_i \phi_j \, d\mathbf{x} = c_i \delta_{ij}$，那么 $M^{(K)}$ 也是一个[对角矩阵](@entry_id:637782)。在这两种情况下，求逆操作都变得非常简单：对于对角矩阵，其逆矩阵就是将对角[线元](@entry_id:196833)素取倒数。这将复杂的矩阵求逆简化为逐分量的标量除法，极大地提高了计算效率。

这种使用正交基（[模态基](@entry_id:752055)）的方法，其主要优势在于简化了与体积积分相关的计算，特别是[质量矩阵](@entry_id:177093)求逆。然而，这也带来了一些权衡。例如，在计算单元边界上的数值通量时，我们需要在边界积分点上得到解的值。对于[模态基](@entry_id:752055)，这需要通过一个通常是密集的“范德蒙德式”矩阵进行一次矩阵-向量乘法，将[模态系数](@entry_id:752057)转换为积分点上的物理值。相比之下，另一种称为[节点基](@entry_id:752522)（nodal basis）的方法（如使用与积分点配置相同的[拉格朗日多项式](@entry_id:142463)），其系数本身就是解在节点上的值。这使得通量计算变得直接，但代价是其质量矩阵通常不是对角的（尽管可以通过“[质量集中](@entry_id:175432)”技术将其[对角化](@entry_id:147016)）。

### 从[参考单元](@entry_id:168425)到物理单元的映射

在有限元方法中，所有的计算通常都在一个标准的“[参考单元](@entry_id:168425)”（如单位三角形 $\widehat{T}$ 或单位四面体 $\widehat{K}$）上进行，然后通过一个[几何映射](@entry_id:749852) $F_K: \widehat{K} \to K$ 将结果转换到物理空间中的任意单元 $K$。这个映射的性质深刻地影响着正交性的传递。

#### [仿射映射](@entry_id:746332)

最简单的情况是当物理单元 $K$ 可以通过[仿射映射](@entry_id:746332)从参考单元 $\widehat{K}$ 得到时。[仿射映射](@entry_id:746332)具有形式 $\mathbf{x} = F_K(\widehat{\mathbf{x}}) = A\widehat{\mathbf{x}} + \mathbf{b}$，其中 $A$ 是一个常数矩阵。其关键特性是它的雅可比行列式 $J_K = \det(A)$ 是一个常数。

根据[多重积分](@entry_id:146170)的变量代换定理，物理单元上的[内积](@entry_id:158127)可以转换到参考单元上：
$$
\langle f, g \rangle_K = \int_K f(\mathbf{x})g(\mathbf{x}) \, d\mathbf{x} = \int_{\widehat{K}} f(F_K(\widehat{\mathbf{x}}))g(F_K(\widehat{\mathbf{x}})) |J_K| \, d\widehat{\mathbf{x}} = |J_K| \int_{\widehat{K}} (f \circ F_K)(\widehat{\mathbf{x}})(g \circ F_K)(\widehat{\mathbf{x}}) \, d\widehat{\mathbf{x}}
$$
假设我们有一个在[参考单元](@entry_id:168425) $\widehat{K}$ 上标准正交的基 $\{\widehat{\phi}_i\}$，即 $\langle \widehat{\phi}_i, \widehat{\phi}_j \rangle_{\widehat{K}} = \delta_{ij}$。我们在物理单元 $K$ 上定义相应的基为 $\phi_i = \widehat{\phi}_i \circ F_K^{-1}$。那么，这些物理[基函数](@entry_id:170178)在 $K$ 上的[内积](@entry_id:158127)为：
$$
\langle \phi_i, \phi_j \rangle_K = |J_K| \langle \widehat{\phi}_i, \widehat{\phi}_j \rangle_{\widehat{K}} = |J_K| \delta_{ij}
$$
这个结果表明，在[仿射映射](@entry_id:746332)下，正交性被完美地保持了。物理[基函数](@entry_id:170178) $\{\phi_i\}$ 仍然是正交的。然而，它们的范数被缩放了：$\|\phi_i\|_{L^2(K)}^2 = |J_K|$。为了在物理单元上也获得一个*标准*正交基，我们需要对[基函数](@entry_id:170178)进行重新缩放。新的[标准正交基](@entry_id:147779)为 $\{\alpha \phi_i\}$，其中缩放因子 $\alpha$ 必须满足 $(\alpha^2) |J_K| = 1$，因此 $\alpha = |J_K|^{-1/2}$。

#### 曲线映射

当物理单元是弯曲的（例如，为了精确拟合一个[曲面](@entry_id:267450)边界），我们需要使用非仿射的曲线映射。在这种情况下，[雅可比行列式](@entry_id:137120) $J_K(\widehat{\mathbf{x}})$ 不再是常数，而是依赖于参考单元内的位置 $\widehat{\mathbf{x}}$。物理单元上的[内积](@entry_id:158127)相应地变为[参考单元](@entry_id:168425)上的一个**[加权内积](@entry_id:163877)**：
$$
\langle f, g \rangle_K = \int_{\widehat{K}} (f \circ F_K)(\widehat{\mathbf{x}})(g \circ F_K)(\widehat{\mathbf{x}}) |J_K(\widehat{\mathbf{x}})| \, d\widehat{\mathbf{x}}
$$
这个非恒定的权函数 $|J_K(\widehat{\mathbf{x}})|$ 带来了根本性的改变。一个在[参考单元](@entry_id:168425)上对于无权[内积](@entry_id:158127)（即权函数为1）正交的基 $\{\widehat{\phi}_i\}$，在引入了非恒定权函数 $|J_K(\widehat{\mathbf{x}})|$ 后，通常不再保持正交性。
$$
\int_{\widehat{K}} \widehat{\phi}_i(\widehat{\mathbf{x}}) \widehat{\phi}_j(\widehat{\mathbf{x}}) |J_K(\widehat{\mathbf{x}})| \, d\widehat{\mathbf{x}} \ne C \delta_{ij} \quad (\text{for } i \ne j)
$$
这意味着，即使我们从[参考单元](@entry_id:168425)上的一个完美正交基出发，经过曲线映射后，在物理单元上得到的质量矩阵 $M^{(K)}$ 通常也是一个密集的、非对角的矩阵。这丧失了正交基带来的主要计算优势。

### 正交基的构造方法

既然我们已经理解了正交基的重要性以及它在不同[几何映射](@entry_id:749852)下的行为，下一个关键问题是：我们如何实际地构造这些基？

#### [Gram-Schmidt正交化](@entry_id:143035)

[Gram-Schmidt过程](@entry_id:141060)是一种通用的代数方法，可以将任何一组[线性无关](@entry_id:148207)的向量（或函数）转化为一组[正交向量](@entry_id:142226)（或函数），且张成相同的空间。我们可以将此过程应用于非正交的单项式基 $\{x^i y^j\}_{i+j \le N}$ 来构造一个 $L^2(\widehat{T})$-[正交基](@entry_id:264024)。

该过程是迭代进行的：取第一个单项式，将其归一化。然后取第二个单项式，减去其在已正交化[基函数](@entry_id:170178)上的投影，然后将结果归一化。依此类推，直到处理完所有单项式。

- **对于仿射单元**：我们在[参考单元](@entry_id:168425) $\widehat{T}$ 上使用标准的（无权）$L^2$ [内积](@entry_id:158127)执行[Gram-Schmidt过程](@entry_id:141060)。
- **对于曲线单元**：为了获得在物理单元 $K$ 上正交的基，我们必须在[参考单元](@entry_id:168425) $\widehat{T}$ 上执行一个**加权[Gram-Schmidt过程](@entry_id:141060)**，使用的[内积](@entry_id:158127)是 $\langle f, g \rangle_J = \int_{\widehat{T}} f g |J_K| \, d\widehat{\mathbf{x}}$。

在实践中，[Gram-Schmidt过程](@entry_id:141060)中的所有积分都需要通过[数值积分](@entry_id:136578)（quadrature）来计算。为了确保最终得到的[基函数](@entry_id:170178)精确正交（在机器精度内），数值积分规则必须足够精确。如果初始[基函数](@entry_id:170178)是次数最高为 $p$ 的多项式，并且雅可比行列式 $|J_K|$ 是次数为 $r$ 的多项式（这在等参元方法中很常见），那么在Gram-Schmidt的每一步中，被积函数（两个[基函数](@entry_id:170178)与雅可比的乘积）的次数最高可达 $p+p+r=2p+r$。因此，所用的积分规则必须能精确积分所有次数不超过 $2p+r$ 的多项式。

从矩阵的角度看，加权[Gram-Schmidt过程](@entry_id:141060)等价于对加权[Gram矩阵](@entry_id:148915) $M_{ij} = \langle \phi_i, \phi_j \rangle_J$ 进行[Cholesky分解](@entry_id:147066) $M=LL^T$。新的正交基可以通过原基的线性变换 $\mathbf{\psi} = (L^{-1})^T \mathbf{\phi}$ 得到。

#### 基于[坐标变换](@entry_id:172727)的解析构造

虽然[Gram-Schmidt过程](@entry_id:141060)在理论上是可行的，但它在数值上存在不稳定性。一个更优雅、更稳定的方法是解析地构造正交多项式。其核心思想是通过一个巧妙的[坐标变换](@entry_id:172727)，将复杂的单纯形区域映射到一个简单的张量积区域（如正方形或立方体），从而利用一维正交多项式的理论。

一个著名的例子是[Duffy变换](@entry_id:748709)。例如，对于二维参考三角形 $\widehat{T}$，我们可以使用映射 $D: [0,1]^2 \to \widehat{T}$，定义为 $D(u,v) = (x,y)$，其中 $x=u(1-v), y=v$。这个映射将单位正方形 $[0,1]^2$ 变换为单位三角形 $\widehat{T}$。该变换的[雅可比行列式](@entry_id:137120)为 $|J| = 1-v$。于是，在三角形上的积分就变成了在正方形上的加权积分：
$$
\int_{\widehat{T}} f(x,y) \, dx dy = \int_0^1 \int_0^1 f(u(1-v), v) (1-v) \, du dv
$$
这个积分形式允许我们通过[张量积](@entry_id:140694)的方式构造[正交基](@entry_id:264024)。具体来说，我们可以寻找在 $u$ 方向上关于权函数 $w(u)=1$ 正交的多项式（即勒让德多项式），以及在 $v$ 方向上关于权函数 $w(v)=1-v$ 正交的多项式（即一类[雅可比多项式](@entry_id:197425)）。将这两族一维正交多项式相乘，再进行适当组合，就可以得到在三角形 $\widehat{T}$ 上关于无权 $L^2$ [内积](@entry_id:158127)正交的二维多项式基。这类基的典型代表是**Dubiner基**或更一般的**Koornwinder多项式**。

类似的思想可以推广到三维。对于单位四面体 $\widehat{K}$，一个[Duffy变换](@entry_id:748709) $D:[0,1]^3 \to \widehat{K}$ 可以定义为 $D(u,v,w)=(u(1-v)(1-w), v(1-w), w)$。其雅可比行列式为 $|J| = (1-v)(1-w)^2$。这同样将四面体上的积分问题转化为了立方体上的加权积分问题，为构造三维正交基铺平了道路。

值得注意的是，无论通过Gram-Schmidt还是解析方法构造，只要[基函数](@entry_id:170178)是根据总次数分层正交的（即任何次数为 $n$ 的[基函数](@entry_id:170178)都与所有次数低于 $n$ 的多项式正交），那么对于固定的次数 $n$，由不同方法构造的次数为 $n$ 的[基函数](@entry_id:170178)[子集](@entry_id:261956)之间仅相差一个正交变换。

#### 构造方法的比较：计算复杂性与[数值稳定性](@entry_id:146550)

在选择构造方法时，计算成本和数值稳定性是两个决定性因素。

1.  **数值稳定性**：直接对单项式基进行[Gram-Schmidt正交化](@entry_id:143035)是出了名的**数值不稳定**。随着多项式次数 $p$ 的增加，高次的单项式函数在单纯形上会变得越来越[线性相关](@entry_id:185830)，导致[Gram矩阵](@entry_id:148915)的[条件数](@entry_id:145150)呈指数级增长（如 $c^p$）。这使得在高精度下计算[正交基](@entry_id:264024)变得非常困难。相比之下，基于[Duffy变换](@entry_id:748709)和一维[雅可比多项式](@entry_id:197425)[三项递推关系](@entry_id:176845)的解析构造方法，其[数值稳定性](@entry_id:146550)要好得多，因为[三项递推关系](@entry_id:176845)本身是数值稳定的。

2.  **[计算复杂性](@entry_id:204275)**：假设多项式次数为 $p$，在三维四面体上，[基函数](@entry_id:170178)的数量 $M = \mathcal{O}(p^3)$，所需的积分点数量 $Q = \mathcal{O}(p^3)$。
    - **Gram-Schmidt方法**的计算量主要来自 $\mathcal{O}(M^2)$ 次[内积](@entry_id:158127)计算，每次[内积](@entry_id:158127)计算需要 $\mathcal{O}(Q)$ 次运算。总复杂度为 $\mathcal{O}(M^2 Q) = \mathcal{O}((p^3)^2 p^3) = \mathcal{O}(p^9)$。这是一个非常高的计算成本。
    - **解析构造方法**的计算量主要在于在 $Q$ 个积分点上求值所有 $M$ 个[基函数](@entry_id:170178)。利用递推关系的高效算法，可以在每个积分点上以 $\mathcal{O}(M)$ 的代价计算出所有[基函数](@entry_id:170178)的值。因此，总复杂度为 $\mathcal{O}(Q \cdot M) = \mathcal{O}(p^3 \cdot p^3) = \mathcal{O}(p^6)$。

综上所述，解析构造方法不仅在[数值稳定性](@entry_id:146550)上远胜于对单项式进行[Gram-Schmidt正交化](@entry_id:143035)，而且在[计算效率](@entry_id:270255)上也具有压倒性优势。因此，在现代[高阶谱](@entry_id:191458)元和DG方法的实现中，采用基于[坐标变换](@entry_id:172727)的解析方法来构造和使用[正交基](@entry_id:264024)是标准实践。