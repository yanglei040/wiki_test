{"hands_on_practices": [{"introduction": "仿射变换是连接参考单元和物理单元最基本的方式，它将直边参考单元精确地映射到物理空间中的直边单元。本练习将通过一个三维四面体的例子，带你具体实践如何构建这种映射，推导其变换矩阵和逆矩阵[@problem_id:3362693]。掌握这些是任何有限元程序实现中的基本功。", "problem": "在谱元法和间断 Galerkin 方法中，参考单元和物理单元之间的映射是使用等参变换构造的。对于线性单纯形（二维中的三角形或三维中的四面体），等参映射是仿射的，其雅可比行列式决定了可逆性和定向。考虑标准参考四面体 $\\hat{K}$，其顶点位于 $\\mathbb{R}^{3}$ 中的原点和标准基点，即 $\\hat{v}_{1}=(0,0,0)$、$\\hat{v}_{2}=(1,0,0)$、$\\hat{v}_{3}=(0,1,0)$ 和 $\\hat{v}_{4}=(0,0,1)$。设 $K$ 是 $\\mathbb{R}^{3}$ 中的一个物理四面体，其顶点为 $v_{1}=(2,-1,0)$、$v_{2}=(3,2,1)$、$v_{3}=(1,3,-2)$ 和 $v_{4}=(0,0,4)$。\n\n从用 $\\hat{K}$ 上的线性 Lagrange 形函数表示的四面体上的线性等参映射的基本定义出发，推导出仿射形式 $F(\\hat{\\boldsymbol{x}})=A\\,\\hat{\\boldsymbol{x}}+b$，确定 $A$ 和 $b$ 如何依赖于顶点坐标，并为给定的 $K$ 显式地构造 $A$ 和 $b$。然后计算逆映射 $F^{-1}$ 以及 $F$ 保持正定向可逆的条件，并用像四面体 $K$ 描述 $F^{-1}$ 的有效域。\n\n你最终报告的结果必须是 $F^{-1}(x,y,z)$ 的三个分量函数以及标量 $\\det(A)$，组合成一个单行矩阵。无需四舍五入。不要包含任何单位。按规定将最终答案表示为 LaTeX 格式的单行矩阵。", "solution": "该问题要求推导标准参考四面体 $\\hat{K}$ 和物理四面体 $K$ 之间的仿射映射，计算其逆映射，并求出雅可比行列式的值。\n\n标准参考四面体 $\\hat{K}$ 由顶点 $\\hat{v}_{1}=(0,0,0)$、$\\hat{v}_{2}=(1,0,0)$、$\\hat{v}_{3}=(0,1,0)$ 和 $\\hat{v}_{4}=(0,0,1)$ 定义。物理四面体 $K$ 的顶点为 $v_{1}=(2,-1,0)$、$v_{2}=(3,2,1)$、$v_{3}=(1,3,-2)$ 和 $v_{4}=(0,0,4)$。我们将参考单元中的点表示为 $\\hat{\\boldsymbol{x}} = (\\hat{x}, \\hat{y}, \\hat{z})^T$，物理单元中的点表示为 $\\boldsymbol{x} = (x, y, z)^T$。\n\n线性等参映射 $F: \\hat{K} \\to K$ 是使用与 $\\hat{K}$ 的顶点 $\\hat{v}_i$ 相关联的线性 Lagrange 形函数 $\\hat{L}_i(\\hat{\\boldsymbol{x}})$ 构造的。这些形函数由属性 $\\hat{L}_i(\\hat{v}_j) = \\delta_{ij}$ 定义，其中 $\\delta_{ij}$ 是克罗内克 δ。对于给定的标准四面体，这些函数是重心坐标，具体如下：\n$$ \\hat{L}_{1}(\\hat{\\boldsymbol{x}}) = 1 - \\hat{x} - \\hat{y} - \\hat{z} $$\n$$ \\hat{L}_{2}(\\hat{\\boldsymbol{x}}) = \\hat{x} $$\n$$ \\hat{L}_{3}(\\hat{\\boldsymbol{x}}) = \\hat{y} $$\n$$ \\hat{L}_{4}(\\hat{\\boldsymbol{x}}) = \\hat{z} $$\n\n映射 $F$ 是通过使用这些形函数对物理顶点坐标进行插值来定义的：\n$$ \\boldsymbol{x} = F(\\hat{\\boldsymbol{x}}) = \\sum_{i=1}^{4} v_i \\hat{L}_i(\\hat{\\boldsymbol{x}}) $$\n代入 $\\hat{L}_i(\\hat{\\boldsymbol{x}})$ 的表达式：\n$$ \\boldsymbol{x} = v_1(1 - \\hat{x} - \\hat{y} - \\hat{z}) + v_2\\hat{x} + v_3\\hat{y} + v_4\\hat{z} $$\n为了将其表示为仿射形式 $F(\\hat{\\boldsymbol{x}}) = A\\hat{\\boldsymbol{x}} + b$，我们通过将包含 $\\hat{x}$、$\\hat{y}$ 和 $\\hat{z}$ 的项组合在一起来重新排列方程：\n$$ \\boldsymbol{x} = v_1 + (v_2 - v_1)\\hat{x} + (v_3 - v_1)\\hat{y} + (v_4 - v_1)\\hat{z} $$\n该方程可以写成矩阵形式：\n$$ \\boldsymbol{x} = \\begin{pmatrix} v_{2x}-v_{1x} & v_{3x}-v_{1x} & v_{4x}-v_{1x} \\\\ v_{2y}-v_{1y} & v_{3y}-v_{1y} & v_{4y}-v_{1y} \\\\ v_{2z}-v_{1z} & v_{3z}-v_{1z} & v_{4z}-v_{1z} \\end{pmatrix} \\begin{pmatrix} \\hat{x} \\\\ \\hat{y} \\\\ \\hat{z} \\end{pmatrix} + \\begin{pmatrix} v_{1x} \\\\ v_{1y} \\\\ v_{1z} \\end{pmatrix} $$\n将其与 $\\boldsymbol{x} = A\\hat{\\boldsymbol{x}} + b$ 进行比较，我们确定了矩阵 $A$（变换的雅可比矩阵）和向量 $b$：\n$$ A = \\begin{pmatrix} v_2-v_1 & v_3-v_1 & v_4-v_1 \\end{pmatrix} \\quad , \\quad b = v_1 $$\n$A$ 的列是构成从顶点 $v_1$ 出发的物理四面体棱的向量。\n\n现在，我们使用给定的顶点坐标来构造 $A$ 和 $b$：\n$v_1 = (2, -1, 0)^T$，$v_2 = (3, 2, 1)^T$，$v_3 = (1, 3, -2)^T$，$v_4 = (0, 0, 4)^T$。\n向量 $b$ 是：\n$$ b = v_1 = \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\end{pmatrix} $$\n$A$ 的列是：\n$v_2 - v_1 = (3-2, 2-(-1), 1-0)^T = (1, 3, 1)^T$\n$v_3 - v_1 = (1-2, 3-(-1), -2-0)^T = (-1, 4, -2)^T$\n$v_4 - v_1 = (0-2, 0-(-1), 4-0)^T = (-2, 1, 4)^T$\n所以，矩阵 $A$ 是：\n$$ A = \\begin{pmatrix} 1 & -1 & -2 \\\\ 3 & 4 & 1 \\\\ 1 & -2 & 4 \\end{pmatrix} $$\n\n映射 $F$ 可逆当且仅当 $A$ 是一个可逆矩阵，这在 $\\det(A) \\neq 0$ 时成立。如果 $\\det(A) > 0$，则映射保持定向。让我们计算 $A$ 的行列式：\n$$ \\det(A) = 1(4 \\cdot 4 - 1 \\cdot (-2)) - (-1)(3 \\cdot 4 - 1 \\cdot 1) + (-2)(3 \\cdot (-2) - 4 \\cdot 1) $$\n$$ \\det(A) = 1(16 + 2) + 1(12 - 1) - 2(-6 - 4) = 18 + 11 - 2(-10) = 18 + 11 + 20 = 49 $$\n由于 $\\det(A)=49 > 0$，该映射是可逆且保向的。物理顶点构成一个非退化的四面体。\n\n逆映射 $F^{-1}: K \\to \\hat{K}$ 可通过求解 $\\boldsymbol{x} = A\\hat{\\boldsymbol{x}} + b$ 来得到 $\\hat{\\boldsymbol{x}}$：\n$$ A\\hat{\\boldsymbol{x}} = \\boldsymbol{x} - b \\implies \\hat{\\boldsymbol{x}} = A^{-1}(\\boldsymbol{x} - b) $$\n$F^{-1}$ 的有效域是物理四面体 $K$。\n为了求 $A^{-1}$，我们使用伴随矩阵公式 $A^{-1} = \\frac{1}{\\det(A)}\\text{adj}(A)$。伴随矩阵 $\\text{adj}(A)$ 是代数余子式矩阵 $C$ 的转置。\n$A$ 的代数余子式 $C_{ij}$ 为：\n$C_{11} = +(16 - (-2)) = 18$\n$C_{12} = -(12 - 1) = -11$\n$C_{13} = +(-6 - 4) = -10$\n$C_{21} = -(-4 - 4) = 8$\n$C_{22} = +(4 - (-2)) = 6$\n$C_{23} = -(-2 - (-1)) = 1$\n$C_{31} = +(-1 - (-8)) = 7$\n$C_{32} = -(1 - (-6)) = -7$\n$C_{33} = +(4 - (-3)) = 7$\n代数余子式矩阵是 $C = \\begin{pmatrix} 18 & -11 & -10 \\\\ 8 & 6 & 1 \\\\ 7 & -7 & 7 \\end{pmatrix}$。\n伴随矩阵是 $\\text{adj}(A) = C^T = \\begin{pmatrix} 18 & 8 & 7 \\\\ -11 & 6 & -7 \\\\ -10 & 1 & 7 \\end{pmatrix}$。\n因此，逆矩阵是：\n$$ A^{-1} = \\frac{1}{49} \\begin{pmatrix} 18 & 8 & 7 \\\\ -11 & 6 & -7 \\\\ -10 & 1 & 7 \\end{pmatrix} $$\n现在我们可以写出逆映射 $F^{-1}(\\boldsymbol{x}) = \\hat{\\boldsymbol{x}}$ 的显式形式：\n$$ \\begin{pmatrix} \\hat{x} \\\\ \\hat{y} \\\\ \\hat{z} \\end{pmatrix} = \\frac{1}{49} \\begin{pmatrix} 18 & 8 & 7 \\\\ -11 & 6 & -7 \\\\ -10 & 1 & 7 \\end{pmatrix} \\begin{pmatrix} x - 2 \\\\ y - (-1) \\\\ z - 0 \\end{pmatrix} = \\frac{1}{49} \\begin{pmatrix} 18 & 8 & 7 \\\\ -11 & 6 & -7 \\\\ -10 & 1 & 7 \\end{pmatrix} \\begin{pmatrix} x - 2 \\\\ y + 1 \\\\ z \\end{pmatrix} $$\n$F^{-1}(x,y,z)$ 的三个分量函数通过矩阵-向量乘法获得：\n$$ \\hat{x}(x,y,z) = \\frac{1}{49} [18(x-2) + 8(y+1) + 7z] = \\frac{1}{49} (18x - 36 + 8y + 8 + 7z) = \\frac{1}{49} (18x + 8y + 7z - 28) $$\n$$ \\hat{y}(x,y,z) = \\frac{1}{49} [-11(x-2) + 6(y+1) - 7z] = \\frac{1}{49} (-11x + 22 + 6y + 6 - 7z) = \\frac{1}{49} (-11x + 6y - 7z + 28) $$\n$$ \\hat{z}(x,y,z) = \\frac{1}{49} [-10(x-2) + 1(y+1) + 7z] = \\frac{1}{49} (-10x + 20 + y + 1 + 7z) = \\frac{1}{49} (-10x + y + 7z + 21) $$\n问题要求报告这三个函数和 $\\det(A)$ 的值。\n$\\det(A) = 49$。\n$F^{-1}$ 的分量函数是如上推导的 $\\hat{x}(x,y,z)$、$\\hat{y}(x,y,z)$ 和 $\\hat{z}(x,y,z)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{49} (18x + 8y + 7z - 28) & \\frac{1}{49} (-11x + 6y - 7z + 28) & \\frac{1}{49} (-10x + y + 7z + 21) & 49\n\\end{pmatrix}\n}\n$$", "id": "3362693"}, {"introduction": "现实世界中的几何形状常常包含曲线边界，这超出了仿射变换的处理能力。本练习从仿射映射更进一步，探讨二次等参变换，演示如何精确地表示一个带曲线边界的四边形单元[@problem_id:3362702]。通过构建映射并计算其雅可比行列式，你将亲身体验处理复杂几何形状所需的工具，并理解映射是如何引起单元局部变形的。", "problem": "考虑参考正方形 $\\hat{\\Omega} = [-1,1] \\times [-1,1]$，其参考坐标为 $(\\xi,\\eta)$。为谱元法和间断 Galerkin 法中使用的弯曲四边形构造一个二次等参映射 $\\boldsymbol{F} : \\hat{\\Omega} \\to \\Omega \\subset \\mathbb{R}^2$，具体如下。\n\n物理单元 $\\Omega$ 具有：\n- 底边：从 $(-1,-1)$ 到 $(1,-1)$ 的直线段。\n- 左边和右边：分别为从 $(-1,-1)$ 到 $(-1,1)$ 和从 $(1,-1)$ 到 $(1,1)$ 的直线段。\n- 顶边：连接 $(-1,1)$ 到 $(1,1)$ 的圆 $x^2 + y^2 = 2$ 的圆弧。\n\n使用张量积二次 Lagrange 插值，在 $3 \\times 3$ 网格 $(\\xi,\\eta) \\in \\{-1,0,1\\} \\times \\{-1,0,1\\}$ 上设置节点，从而施加一个二次等参几何。其中八个边界节点映射到相应的物理点：\n- 角点：$(-1,-1) \\mapsto (-1,-1)$，$(1,-1) \\mapsto (1,-1)$，$(1,1) \\mapsto (1,1)$，$(-1,1) \\mapsto (-1,1)$，\n- 边中点：$(0,-1) \\mapsto (0,-1)$，$(1,0) \\mapsto (1,0)$，$(-1,0) \\mapsto (-1,0)$，以及 $(0,1) \\mapsto (0,\\sqrt{2})$（顶边圆弧上的中点）。\n设置内部节点 $(0,0) \\mapsto (0,0)$。\n\n1. 使用等参映射的定义，以及在每个坐标方向上基于 $\\{-1,0,1\\}$ 的张量积二次 Lagrange 基多项式，推导出 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 的显式公式。\n2. 从第一性原理出发，计算 Jacobian 矩阵 $\\boldsymbol{J}(\\xi,\\eta) = \\partial(x,y)/\\partial(\\xi,\\eta)$ 及其行列式 $\\det \\boldsymbol{J}(\\xi,\\eta)$。\n3. 在多项式次数为 $N=2$ 的二维 Legendre–Gauss–Lobatto (LGL) 点上，即在张量积集合 $(\\xi,\\eta) \\in \\{-1,0,1\\} \\times \\{-1,0,1\\}$ 上，计算 $\\det \\boldsymbol{J}$ 的值。\n4. 将这九个 $\\det \\boldsymbol{J}$ 值的算术平均值报告为单个精确的封闭形式表达式。不要对答案进行四舍五入。", "solution": "该问题是有效的，因为它在科学上基于数值方法的理论，信息充分、问题明确，并且陈述客观。\n\n求解过程分四个阶段：\n1.  推导等参坐标变换 $\\boldsymbol{F}(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$。\n2.  计算 Jacobian 矩阵 $\\boldsymbol{J}(\\xi,\\eta)$ 及其行列式 $\\det\\boldsymbol{J}(\\xi,\\eta)$。\n3.  在九个指定的 Legendre-Gauss-Lobatto (LGL) 点上计算 $\\det\\boldsymbol{J}$ 的值。\n4.  计算这些行列式值的算术平均值。\n\n### 1. 等参映射\n该映射使用张量积二次 Lagrange 基多项式构造。在区间 $[-1,1]$ 上，节点位于 $\\{-1, 0, 1\\}$ 的一维 Lagrange 基多项式为：\n$$L_{-1}(\\zeta) = \\frac{(\\zeta-0)(\\zeta-1)}{(-1-0)(-1-1)} = \\frac{1}{2}\\zeta(\\zeta-1)$$\n$$L_0(\\zeta) = \\frac{(\\zeta-(-1))(\\zeta-1)}{(0-(-1))(0-1)} = -(\\zeta+1)(\\zeta-1) = 1-\\zeta^2$$\n$$L_1(\\zeta) = \\frac{(\\zeta-(-1))(\\zeta-0)}{(1-(-1))(1-0)} = \\frac{1}{2}\\zeta(\\zeta+1)$$\n一个有用的性质是它们的和为1：$\\sum_{i=-1,0,1} L_i(\\zeta) = 1$。\n\n从参考坐标 $(\\xi,\\eta)$ 到物理坐标 $(x,y)$ 的等参映射由下式给出：\n$$x(\\xi,\\eta) = \\sum_{i \\in \\{-1,0,1\\}} \\sum_{j \\in \\{-1,0,1\\}} x_{ij} L_i(\\xi)L_j(\\eta)$$\n$$y(\\xi,\\eta) = \\sum_{i \\in \\{-1,0,1\\}} \\sum_{j \\in \\{-1,0,1\\}} y_{ij} L_i(\\xi)L_j(\\eta)$$\n其中 $(x_{ij}, y_{ij})$ 是对应于参考节点 $(\\xi_i, \\eta_j)$ 的节点的物理坐标。\n\n**$x(\\xi,\\eta)$ 的推导：**\n节点的物理 $x$ 坐标由 $x_{ij} = \\xi_i \\in \\{-1, 0, 1\\}$ 给出。\n$$x(\\xi,\\eta) = \\sum_{j} \\left( x_{-1,j}L_{-1}(\\xi)L_j(\\eta) + x_{0,j}L_0(\\xi)L_j(\\eta) + x_{1,j}L_1(\\xi)L_j(\\eta) \\right)$$\n$$x(\\xi,\\eta) = \\sum_{j} \\left( (-1)L_{-1}(\\xi)L_j(\\eta) + (0)L_0(\\xi)L_j(\\eta) + (1)L_1(\\xi)L_j(\\eta) \\right)$$\n$$x(\\xi,\\eta) = \\left( L_1(\\xi)-L_{-1}(\\xi) \\right) \\sum_j L_j(\\eta)$$\n使用 $\\sum_j L_j(\\eta) = 1$：\n$$x(\\xi,\\eta) = L_1(\\xi)-L_{-1}(\\xi) = \\frac{1}{2}\\xi(\\xi+1) - \\frac{1}{2}\\xi(\\xi-1) = \\frac{1}{2}(\\xi^2+\\xi - \\xi^2+\\xi) = \\xi$$\n\n**$y(\\xi,\\eta)$ 的推导：**\n物理 $y$ 坐标 $(y_{ij})$ 已给出。直接求和是可行的，但一个更具洞察力的方法是将变换视为一个基准仿射映射加上一个非线性修正。仿射映射 $y=\\eta$ 正确地映射了 9 个节点中的 8 个，唯一的偏差在 $(\\xi, \\eta) = (0,1)$ 处，其物理坐标为 $y_{0,1}=\\sqrt{2}$ 而非 $y=1$。该节点所需的修正量为 $\\sqrt{2}-1$。此修正在所有其他节点上必须为零。这可以由对应于节点 $(0,1)$ 的基函数 $L_0(\\xi)L_1(\\eta)$ 完美描述。\n因此，$y$ 的映射可以表示为：\n$$y(\\xi,\\eta) = \\eta + (y_{0,1}-1) \\cdot L_0(\\xi)L_1(\\eta)$$\n代入给定值和基函数：\n$$y(\\xi,\\eta) = \\eta + (\\sqrt{2}-1) (1-\\xi^2) \\left(\\frac{1}{2}\\eta(\\eta+1)\\right)$$\n所以，映射的显式公式为：\n$$x(\\xi,\\eta) = \\xi$$\n$$y(\\xi,\\eta) = \\eta + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(\\eta^2+\\eta)$$\n\n### 2. Jacobian 矩阵和行列式\n变换的 Jacobian 矩阵为 $\\boldsymbol{J} = \\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)} = \\begin{pmatrix} \\partial x/\\partial \\xi & \\partial x/\\partial \\eta \\\\ \\partial y/\\partial \\xi & \\partial y/\\partial \\eta \\end{pmatrix}$。\n\n首先，我们计算偏导数：\n$$\\frac{\\partial x}{\\partial \\xi} = 1$$\n$$\\frac{\\partial x}{\\partial \\eta} = 0$$\n$$\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} \\left[ \\eta + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(\\eta^2+\\eta) \\right] = \\frac{\\sqrt{2}-1}{2}(-2\\xi)(\\eta^2+\\eta) = -(\\sqrt{2}-1)\\xi(\\eta^2+\\eta)$$\n$$\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} \\left[ \\eta + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(\\eta^2+\\eta) \\right] = 1 + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(2\\eta+1)$$\n\nJacobian 矩阵为：\n$$\\boldsymbol{J}(\\xi,\\eta) = \\begin{pmatrix} 1 & 0 \\\\ -(\\sqrt{2}-1)\\xi(\\eta^2+\\eta) & 1 + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(2\\eta+1) \\end{pmatrix}$$\n\nJacobian 的行列式为：\n$$\\det\\boldsymbol{J}(\\xi,\\eta) = (1) \\left( 1 + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(2\\eta+1) \\right) - (0) \\left( -(\\sqrt{2}-1)\\xi(\\eta^2+\\eta) \\right)$$\n$$\\det\\boldsymbol{J}(\\xi,\\eta) = 1 + \\frac{\\sqrt{2}-1}{2}(1-\\xi^2)(2\\eta+1)$$\n\n### 3. 在 LGL 点上计算行列式\n我们在 9 个点 $(\\xi,\\eta) \\in \\{-1,0,1\\} \\times \\{-1,0,1\\}$ 上计算 $\\det\\boldsymbol{J}$。\n\n情况 1：$\\xi = -1$ 或 $\\xi = 1$。\n对于这些值，项 $(1-\\xi^2) = 1 - (\\pm 1)^2 = 0$。\n因此，$\\det\\boldsymbol{J} = 1 + 0 = 1$。这适用于 6 个点：\n$\\det\\boldsymbol{J}(-1,-1) = 1$\n$\\det\\boldsymbol{J}(-1,0) = 1$\n$\\det\\boldsymbol{J}(-1,1) = 1$\n$\\det\\boldsymbol{J}(1,-1) = 1$\n$\\det\\boldsymbol{J}(1,0) = 1$\n$\\det\\boldsymbol{J}(1,1) = 1$\n\n情况 2：$\\xi = 0$。\n对于这个值，$(1-\\xi^2) = 1 - 0^2 = 1$。行列式简化为 $\\det\\boldsymbol{J}(0,\\eta) = 1 + \\frac{\\sqrt{2}-1}{2}(2\\eta+1)$。\n我们对 $\\eta \\in \\{-1,0,1\\}$ 计算该值：\n- 对于 $(\\xi,\\eta) = (0,-1)$：\n  $$\\det\\boldsymbol{J}(0,-1) = 1 + \\frac{\\sqrt{2}-1}{2}(2(-1)+1) = 1 - \\frac{\\sqrt{2}-1}{2} = \\frac{2 - (\\sqrt{2}-1)}{2} = \\frac{3-\\sqrt{2}}{2}$$\n- 对于 $(\\xi,\\eta) = (0,0)$：\n  $$\\det\\boldsymbol{J}(0,0) = 1 + \\frac{\\sqrt{2}-1}{2}(2(0)+1) = 1 + \\frac{\\sqrt{2}-1}{2} = \\frac{2 + \\sqrt{2}-1}{2} = \\frac{1+\\sqrt{2}}{2}$$\n- 对于 $(\\xi,\\eta) = (0,1)$：\n  $$\\det\\boldsymbol{J}(0,1) = 1 + \\frac{\\sqrt{2}-1}{2}(2(1)+1) = 1 + \\frac{3(\\sqrt{2}-1)}{2} = \\frac{2 + 3\\sqrt{2}-3}{2} = \\frac{3\\sqrt{2}-1}{2}$$\n\n行列式的九个值为：$1, 1, 1, \\frac{3-\\sqrt{2}}{2}, \\frac{1+\\sqrt{2}}{2}, \\frac{3\\sqrt{2}-1}{2}, 1, 1, 1$。\n\n### 4. 算术平均值\n算术平均值是九个值的和除以 9。\n$$\\text{和} = (1+1+1) + \\left(\\frac{3-\\sqrt{2}}{2} + \\frac{1+\\sqrt{2}}{2} + \\frac{3\\sqrt{2}-1}{2}\\right) + (1+1+1)$$\n$$\\text{和} = 6 + \\frac{(3-\\sqrt{2}) + (1+\\sqrt{2}) + (3\\sqrt{2}-1)}{2}$$\n$$\\text{和} = 6 + \\frac{3 - \\sqrt{2} + 1 + \\sqrt{2} + 3\\sqrt{2} - 1}{2}$$\n$$\\text{和} = 6 + \\frac{(3+1-1) + (-\\sqrt{2}+\\sqrt{2}+3\\sqrt{2})}{2} = 6 + \\frac{3 + 3\\sqrt{2}}{2}$$\n$$\\text{和} = \\frac{12}{2} + \\frac{3 + 3\\sqrt{2}}{2} = \\frac{15 + 3\\sqrt{2}}{2}$$\n\n算术平均值为 $\\frac{1}{9} \\times \\text{和}$：\n$$\\text{平均值} = \\frac{1}{9} \\left(\\frac{15 + 3\\sqrt{2}}{2}\\right) = \\frac{15 + 3\\sqrt{2}}{18}$$\n从分子中提出因子 3：\n$$\\text{平均值} = \\frac{3(5 + \\sqrt{2})}{18} = \\frac{5 + \\sqrt{2}}{6}$$", "answer": "$$\\boxed{\\frac{5 + \\sqrt{2}}{6}}$$", "id": "3362702"}, {"introduction": "建立正确的映射只是第一步，我们还必须能够在新生成的弯曲单元上进行精确积分。本练习旨在解决一个关键的实现细节：如何确定所需的数值求积阶数以避免混叠误差[@problem_id:3362664]。通过分析被积函数（既包括基函数，也包括几何映射的雅可比行列式）的最高多项式次数，你将学会如何确保高阶方法中质量矩阵计算的准确性。", "problem": "考虑在单个物理六面体单元上的 Spectral Element Method (SEM) 或 Discontinuous Galerkin (DG) 离散化，该单元是通过等参变换从参考立方体 $[-1,1]^{3}$ 得到的。解由在 Legendre–Gauss–Lobatto (LGL) 节点上的次数为 $p$ 的张量积 Lagrange 多项式表示，几何映射是相同类型节点上次数为 $p_{g}$ 的等参张量积 Lagrange 多项式。单元质量矩阵由两个基函数在物理单元上的乘积的积分定义。假设一个标准事实，$N$ 点一维 LGL 求積可以精确积分任何次数最高为 $2N-3$ 的多项式。为了消除质量矩阵中的求积混叠，需要对被积函数进行精确积分。\n\n给定 $p=4$ 和 $p_{g}=4$，确定所需的最小一维 LGL 求积阶数 $N$（即每个坐标方向上所需的最少点数），以使张量积 LGL 求积能够在六面体上精确积分质量矩阵。请以单个整数形式给出答案，不带单位。", "solution": "用户想要解决一个问题。\n\n问题要求计算在一个物理变形的六面体单元上精确积分单元质量矩阵所需的最小一维 Legendre–Gauss–Lobatto (LGL) 求积阶数，记为 $N$。\n\n### 步骤 1：提取已知条件\n- **方法**：Spectral Element Method (SEM) 或 Discontinuous Galerkin (DG)。\n- **单元形状**：从参考立方体 $\\hat{K} = [-1,1]^{3}$ 映射得到的单个物理六面体单元。\n- **解基函数**：次数为 $p$ 的张量积 Lagrange 多项式。\n- **几何映射**：次数为 $p_g$ 的等参张量积 Lagrange 多项式。\n- **节点**：解和几何均使用 Legendre–Gauss–Lobatto (LGL) 节点。\n- **质量矩阵定义**：单元质量矩阵 $M_{ij}^e$ 由 $M_{ij}^e = \\int_K \\phi_i(\\mathbf{x}) \\phi_j(\\mathbf{x}) \\, d\\mathbf{x}$ 给出，其中 $\\phi_i$ 和 $\\phi_j$ 是基函数，$K$ 是物理单元。\n- **求积法则属性**：$N$ 点一维 LGL 求积可以精确积分任何次数最高为 $2N-3$ 的多项式。\n- **约束条件**：质量矩阵必须被精确积分，这意味着求积法则对于被積函数必须是精确的。\n- **给定值**：$p=4$ 和 $p_g=4$。\n- **目标**：确定 $N$ 的最小整数值。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学或事实上的不健全性**：该问题基于高阶数值方法（特别是谱/hp元方法）的成熟理论。等参映射、张量积基、LGL求积和质量矩阵等概念都是标准的。所述的LGL求积精确性属性是正确的。该问题在科学上是健全的。\n2.  **不可形式化或不相关**：该问题与仿射和等参变换及其在谱方法和间断 Galerkin 方法中对数值积分的影响直接相关。它可以被形式化并用数学方法解决。\n3.  **不完整或矛盾的设置**：问题提供了所有必要信息：解和几何的多项式次数、问题的维度（3D六面体）以及求积法则的属性。没有矛盾之处。\n4.  **不切实际或不可行**：该前提是在实施高阶方法以避免混叠误差时的标准考虑因素。多项式次数 $p=4$ 和 $p_g=4$ 是实践中使用的典型值。\n5.  **不适定或结构不良**：问题是适定的。它要求一个满足明确数学条件的最小整数值，这会导出一个唯一解。\n6.  **伪深刻、琐碎或同义反复**：该问题是有限元方法背景下数值求积和多项式逼近原理的一个非平凡应用。它需要仔细分析变换后积分中涉及的多项式次数。\n7.  **超出科学可验证范围**：该问题是一个完全可验证的数学推导。\n\n### 步骤 3：结论与行动\n问题是**有效的**。将继续进行求解过程。\n\n### 求解推导\n\n物理六面体单元 $K$ 上的单元质量矩阵 $M_{ij}^e$ 定义为两个基函数 $\\phi_i$ 和 $\\phi_j$ 乘积的积分：\n$$ M_{ij}^e = \\int_K \\phi_i(\\mathbf{x}) \\phi_j(\\mathbf{x}) \\, d\\mathbf{x} $$\n其中 $\\mathbf{x} \\in K$ 是物理坐标。\n\n为了计算这个积分，我们进行变量替换，变换到参考立方体 $\\hat{K} = [-1,1]^3$，其局部坐标为 $\\boldsymbol{\\xi} = (\\xi, \\eta, \\zeta)$。映射由 $\\mathbf{x} = \\mathbf{F}(\\boldsymbol{\\xi})$ 给出。微分体积元变换为 $d\\mathbf{x} = J(\\boldsymbol{\\xi}) \\, d\\boldsymbol{\\xi}$，其中 $J(\\boldsymbol{\\xi})$ 是变换 $\\mathbf{F}$ 的雅可比矩阵的行列式。积分变为：\n$$ M_{ij}^e = \\int_{\\hat{K}} \\hat{\\phi}_i(\\boldsymbol{\\xi}) \\hat{\\phi}_j(\\boldsymbol{\\xi}) J(\\boldsymbol{\\xi}) \\, d\\boldsymbol{\\xi} $$\n这里，$\\hat{\\phi}_k(\\boldsymbol{\\xi}) = \\phi_k(\\mathbf{F}(\\boldsymbol{\\xi}))$ 是参考单元上的基函数。\n\n这个三维积分是使用一维求积法则的张量积来计算的。为了使积分为精确的，所选的求积法则必须能够沿着每个坐标方向精确地积分被积函数 $I(\\boldsymbol{\\xi}) = \\hat{\\phi}_i(\\boldsymbol{\\xi}) \\hat{\\phi}_j(\\boldsymbol{\\xi}) J(\\boldsymbol{\\xi})$。因此，我们必须确定 $I(\\boldsymbol{\\xi})$ 在每个变量 $\\xi$, $\\eta$ 和 $\\zeta$ 中的最大多项式次数。由于基函数和映射的张量积性质，对每个方向的分析都是相同的。让我们关注 $\\xi$ 方向。\n\n1.  **基函数乘积的次数**：解是使用次数为 $p$ 的张量积 Lagrange 多项式来近似的。这意味着每个基函数 $\\hat{\\phi}_k(\\boldsymbol{\\xi})$ 在每个变量中的次数最多为 $p$。因此，两个这样的基函数的乘积 $\\hat{\\phi}_i(\\boldsymbol{\\xi}) \\hat{\\phi}_j(\\boldsymbol{\\xi})$ 在 $\\xi$ 方向上的多项式次数最多为 $p+p=2p$。\n\n2.  **雅可比行列式的次数**：几何映射 $\\mathbf{x} = \\mathbf{F}(\\boldsymbol{\\xi})$ 是一个次数为 $p_g$ 的张量积多项式。映射的每个分量，例如 $x(\\xi, \\eta, \\zeta)$，在每个变量中的次数最高为 $p_g$。雅可比矩阵是：\n    $$ \\mathbf{J}(\\boldsymbol{\\xi}) = \\frac{\\partial \\mathbf{x}}{\\partial \\boldsymbol{\\xi}} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial x}{\\partial \\zeta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\zeta} \\\\ \\frac{\\partial z}{\\partial \\xi} & \\frac{\\partial z}{\\partial \\eta} & \\frac{\\partial z}{\\partial \\zeta} \\end{pmatrix} $$\n    让我们分析矩阵元素在变量 $\\xi$ 中的多项式次数。项 $\\frac{\\partial x}{\\partial \\xi}$ 在 $\\xi$ 中的次数为 $p_g-1$。项 $\\frac{\\partial x}{\\partial \\eta}$ 和 $\\frac{\\partial x}{\\partial \\zeta}$ 在 $\\xi$ 中的次数为 $p_g$。\n    行列式 $J(\\boldsymbol{\\xi}) = \\det(\\mathbf{J})$ 是矩阵中三个元素乘积的和。在 $\\xi$ 中具有最高可能次数的项将是三个项的乘积，其中一个是关于 $\\xi$ 的导数，另外两个不是。例如，行列式展开中的一项是 $\\frac{\\partial x}{\\partial \\xi} \\frac{\\partial y}{\\partial \\eta} \\frac{\\partial z}{\\partial \\zeta}$。这一项在 $\\xi$ 中的次数是：\n    $$ \\deg_{\\xi}\\left(\\frac{\\partial x}{\\partial \\xi}\\right) + \\deg_{\\xi}\\left(\\frac{\\partial y}{\\partial \\eta}\\right) + \\deg_{\\xi}\\left(\\frac{\\partial z}{\\partial \\zeta}\\right) = (p_g - 1) + p_g + p_g = 3p_g - 1 $$\n    行列式展开中的任何其他项在 $\\xi$ 中都具有相同的最大次数。因此，雅可比行列式 $J(\\boldsymbol{\\xi})$ 在每个坐标方向上是一个次数最多为 $3p_g - 1$ 的多项式。\n\n3.  **被积函数的次数**：被积函数 $I(\\boldsymbol{\\xi})$ 在 $\\xi$ 方向上的总次数是其各因子次数的总和：\n    $$ P_{max} = \\deg_{\\xi}(I) \\leq \\deg_{\\xi}(\\hat{\\phi}_i\\hat{\\phi}_j) + \\deg_{\\xi}(J) = 2p + (3p_g - 1) $$\n    对于一般的曲边单元，会达到这个最大次数，并且不会出现高阶项的系统性抵消。\n\n4.  **所需的求积阶数**：问题陈述一个 $N$ 点一维 LGL 求积法则能够精确积分次数最高为 $2N-3$ 的多项式。为了确保质量矩阵的精确积分，该法则必须足以处理次数为 $P_{max}$ 的多项式。因此，我们必须满足以下条件：\n    $$ 2N - 3 \\ge P_{max} $$\n    $$ 2N - 3 \\ge 2p + 3p_g - 1 $$\n    求解 $N$：\n    $$ 2N \\ge 2p + 3p_g + 2 $$\n    $$ N \\ge p + \\frac{3}{2}p_g + 1 $$\n\n5.  **最终计算**：给定 $p=4$ 和 $p_g=4$。将这些值代入不等式中：\n    $$ N \\ge 4 + \\frac{3}{2}(4) + 1 $$\n    $$ N \\ge 4 + 6 + 1 $$\n    $$ N \\ge 11 $$\n    由于 $N$ 必须是整数，每个维度所需的最少求积点数为 $11$。", "answer": "$$\n\\boxed{11}\n$$", "id": "3362664"}]}