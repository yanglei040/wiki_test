{"hands_on_practices": [{"introduction": "在谱方法中，理解模态基和节点基之间的转换是至关重要的。本练习将引导你通过一个具体的例子，推导连接这两种表示的范德蒙德矩阵 $V$。你将亲手验证这一变换如何将一个基下的算子（如此处的质量矩阵）与另一个基下的对应算子关联起来 ([@problem_id:3400113])。这项实践旨在通过计算，巩固连接这两种观点的理论桥梁。", "problem": "在参考单元 $\\Omega=[-1,1]$ 上，考虑多项式空间 $\\mathbb{P}_3$，其勒让德模态基为 $\\{P_0(x),P_1(x),P_2(x),P_3(x)\\}$，其中 $P_n(x)$ 表示第 $n$ 阶勒让德多项式，由经典正交关系 $\\int_{-1}^{1} P_m(x) P_n(x)\\,dx = \\frac{2}{2n+1}\\,\\delta_{mn}$ 归一化。设节点集为 $N=3$ 时的 Gauss–Lobatto–Legendre (GLL) 节点，即 $(1-x^2)P_3'(x)$ 的根以及端点，它们是 $x_1=-1$，$x_2=-\\frac{1}{\\sqrt{5}}$，$x_3=\\frac{1}{\\sqrt{5}}$，$x_4=1$。定义范德蒙德矩阵 $V\\in\\mathbb{R}^{4\\times 4}$，其元素为 $V_{ij}=P_{j-1}(x_i)$，其中 $1\\leq i,j\\leq 4$。模态质量矩阵为 $M_{\\text{modal}}\\in\\mathbb{R}^{4\\times 4}$，其元素为 $(M_{\\text{modal}})_{mn}=\\int_{-1}^{1} P_{m-1}(x)P_{n-1}(x)\\,dx$；节点质量矩阵为 $M_{\\text{nodal}}\\in\\mathbb{R}^{4\\times 4}$，其元素为 $(M_{\\text{nodal}})_{ij}=\\int_{-1}^{1} \\ell_i(x)\\ell_j(x)\\,dx$，其中 $\\{\\ell_i(x)\\}_{i=1}^{4}$ 是与 GLL 节点相关的拉格朗日节点基。\n\n任务：\n- 以精确形式显式计算矩阵 $V$ 和 $V^{-1}$。\n- 仅使用模态基和节点基的基本定义以及 $L^2(\\Omega)$ 内积，验证当所有积分都被精确计算时（即，不通过数值求积法则近似）的恒等式 $V^{-T} M_{\\text{modal}} V^{-1}=M_{\\text{nodal}}$。\n- 作为最终报告量，计算弗罗贝尼乌斯范数 $\\|V^{-T} M_{\\text{modal}} V^{-1}-M_{\\text{nodal}}\\|_{F}$。\n\n使用精确算术表示最终值。无需四舍五入。最终答案必须是单个实数。", "solution": "该问题被认为是有效的，因为它具有科学依据、是适定的且客观的。它是谱方法和间断 Galerkin 方法领域的一个标准问题。\n\n该问题要求验证一个关联了多项式空间中函数的模态表示和节点表示的基本恒等式，并计算一个由此产生的范数。我们将首先定义所有量，计算所需矩阵，从理论上验证该恒等式，最后计算指定的范数。\n\n多项式空间是在参考单元 $\\Omega=[-1,1]$ 上的 $\\mathbb{P}_3$。\n模态基由前四个勒让德多项式组成，它们是：\n$$ P_0(x) = 1 $$\n$$ P_1(x) = x $$\n$$ P_2(x) = \\frac{1}{2}(3x^2 - 1) $$\n$$ P_3(x) = \\frac{1}{2}(5x^3 - 3x) $$\n这些多项式关于 $L^2$ 内积是正交的，满足给定的归一化条件：\n$$ \\int_{-1}^{1} P_m(x) P_n(x) dx = \\frac{2}{2n+1}\\delta_{mn} $$\n\n节点基由 $N=3$ 时的 $N+1=4$ 个 Gauss–Lobatto–Legendre (GLL) 节点集定义。这些节点是 $(1-x^2)P_3'(x) = 0$ 的根。$P_3'(x) = \\frac{1}{2}(15x^2 - 3)$ 的根是 $x^2 = 3/15 = 1/5$，因此 $x = \\pm 1/\\sqrt{5}$。包含端点 $x = \\pm 1$，GLL 节点为：\n$$ x_1 = -1, \\quad x_2 = -\\frac{1}{\\sqrt{5}}, \\quad x_3 = \\frac{1}{\\sqrt{5}}, \\quad x_4 = 1 $$\n节点基函数是拉格朗日多项式 $\\{\\ell_i(x)\\}_{i=1}^4$，满足 $\\ell_i(x_j) = \\delta_{ij}$。\n\n任务1：计算矩阵 $V$ 和 $V^{-1}$。\n\n范德蒙德矩阵 $V$ 定义为 $V_{ij} = P_{j-1}(x_i)$。我们在 GLL 节点处计算勒让德多项式的值：\n在 $x_1 = -1$ 处：$P_0(-1)=1$, $P_1(-1)=-1$, $P_2(-1)=1$, $P_3(-1)=-1$。\n在 $x_2 = -1/\\sqrt{5}$ 处：$P_0=1$, $P_1=-1/\\sqrt{5}$, $P_2=\\frac{1}{2}(3(1/5)-1)=-1/5$, $P_3=\\frac{1}{2}(5(-1/5\\sqrt{5}) - 3(-1/\\sqrt{5})) = 1/\\sqrt{5}$。\n在 $x_3 = 1/\\sqrt{5}$ 处：$P_0=1$, $P_1=1/\\sqrt{5}$, $P_2=-1/5$, $P_3=\\frac{1}{2}(5(1/5\\sqrt{5}) - 3(1/\\sqrt{5})) = -1/\\sqrt{5}$。\n在 $x_4 = 1$ 处：$P_0(1)=1$, $P_1(1)=1$, $P_2(1)=1$, $P_3(1)=1$。\n\n将这些值组合起来得到矩阵 $V$：\n$$ V = \\begin{pmatrix}\n1  -1  1  -1 \\\\\n1  -1/\\sqrt{5}  -1/5  1/\\sqrt{5} \\\\\n1  1/\\sqrt{5}  -1/5  -1/\\sqrt{5} \\\\\n1  1  1  1\n\\end{pmatrix} $$\n\n逆矩阵 $V^{-1}$ 将节点值转换为模态系数。$V^{-1}$ 的第 $k$ 列包含第 $k$ 个拉格朗日多项式 $\\ell_k(x)$ 的模态系数。例如，对于与 $x_1=-1$ 关联的 $\\ell_1(x)$，我们有 $\\ell_1(x) = \\frac{(x-x_2)(x-x_3)(x-x_4)}{(x_1-x_2)(x_1-x_3)(x_1-x_4)}$。这可以展开，然后用勒让德基表示。对所有四个拉格朗日多项式执行此操作，得到 $V^{-1}$ 的各列：\n$$ \\ell_1(x) = \\frac{1}{12}P_0(x) - \\frac{1}{4}P_1(x) + \\frac{5}{12}P_2(x) - \\frac{1}{4}P_3(x) $$\n$$ \\ell_2(x) = \\frac{5}{12}P_0(x) - \\frac{\\sqrt{5}}{4}P_1(x) - \\frac{5}{12}P_2(x) + \\frac{\\sqrt{5}}{4}P_3(x) $$\n$$ \\ell_3(x) = \\frac{5}{12}P_0(x) + \\frac{\\sqrt{5}}{4}P_1(x) - \\frac{5}{12}P_2(x) - \\frac{\\sqrt{5}}{4}P_3(x) $$\n$$ \\ell_4(x) = \\frac{1}{12}P_0(x) + \\frac{1}{4}P_1(x) + \\frac{5}{12}P_2(x) + \\frac{1}{4}P_3(x) $$\n因此，逆范德蒙德矩阵是：\n$$ V^{-1} = \\begin{pmatrix}\n\\frac{1}{12}  \\frac{5}{12}  \\frac{5}{12}  \\frac{1}{12} \\\\\n-\\frac{1}{4}  -\\frac{\\sqrt{5}}{4}  \\frac{\\sqrt{5}}{4}  \\frac{1}{4} \\\\\n\\frac{5}{12}  -\\frac{5}{12}  -\\frac{5}{12}  \\frac{5}{12} \\\\\n-\\frac{1}{4}  \\frac{\\sqrt{5}}{4}  -\\frac{\\sqrt{5}}{4}  \\frac{1}{4}\n\\end{pmatrix} $$\n\n任务2：验证恒等式 $V^{-T} M_{\\text{modal}} V^{-1}=M_{\\text{nodal}}$。\n\n首先，我们定义质量矩阵。模态质量矩阵 $M_{\\text{modal}}$ 的元素为 $(M_{\\text{modal}})_{mn}=\\int_{-1}^{1} P_{m-1}(x)P_{n-1}(x)\\,dx$。由于正交性，它是一个对角矩阵：\n$$ (M_{\\text{modal}})_{mn} = \\frac{2}{2(m-1)+1}\\delta_{mn} $$\n所以，\n$$ M_{\\text{modal}} = \\begin{pmatrix}\n2  0  0  0 \\\\\n0  \\frac{2}{3}  0  0 \\\\\n0  0  \\frac{2}{5}  0 \\\\\n0  0  0  \\frac{2}{7}\n\\end{pmatrix} $$\n节点质量矩阵 $M_{\\text{nodal}}$ 的元素为 $(M_{\\text{nodal}})_{ij}=\\int_{-1}^{1} \\ell_i(x)\\ell_j(x)\\,dx$。\n\n该恒等式的验证依赖于 $L^2$ 内积的基变换。设 $u(x), v(x) \\in \\mathbb{P}_3$。\n内积为 $(u,v) = \\int_{-1}^1 u(x)v(x)dx$。\n\n在模态基中，$u(x) = \\sum_{m=1}^4 \\hat{u}_m P_{m-1}(x)$ 且 $v(x) = \\sum_{n=1}^4 \\hat{v}_n P_{n-1}(x)$，其中 $\\hat{\\mathbf{u}} = (\\hat{u}_1, \\dots, \\hat{u}_4)^T$ 和 $\\hat{\\mathbf{v}} = (\\hat{v}_1, \\dots, \\hat{v}_4)^T$ 是模态系数向量。内积为：\n$$ (u,v) = \\int_{-1}^1 \\left(\\sum_m \\hat{u}_m P_{m-1}\\right) \\left(\\sum_n \\hat{v}_n P_{n-1}\\right) dx = \\sum_{m,n} \\hat{u}_m \\hat{v}_n \\int_{-1}^1 P_{m-1}P_{n-1} dx $$\n用矩阵形式表示，即为 $(u,v) = \\hat{\\mathbf{u}}^T M_{\\text{modal}} \\hat{\\mathbf{v}}$。\n\n在节点基中，$u(x) = \\sum_{i=1}^4 u_i \\ell_i(x)$ 且 $v(x) = \\sum_{j=1}^4 v_j \\ell_j(x)$，其中 $u_i = u(x_i)$ 和 $v_j=v(x_j)$ 是节点值，其向量为 $\\mathbf{u}=(u_1, \\dots, u_4)^T$ 和 $\\mathbf{v}=(v_1, \\dots, v_4)^T$。内积为：\n$$ (u,v) = \\int_{-1}^1 \\left(\\sum_i u_i \\ell_i\\right) \\left(\\sum_j v_j \\ell_j\\right) dx = \\sum_{i,j} u_i v_j \\int_{-1}^1 \\ell_i \\ell_j dx $$\n用矩阵形式表示，即为 $(u,v) = \\mathbf{u}^T M_{\\text{nodal}} \\mathbf{v}$。\n\n模态系数和节点值之间的转换通过在节点处对模态展开式求值得到：$u_i = u(x_i) = \\sum_{m=1}^4 \\hat{u}_m P_{m-1}(x_i) = \\sum_{m=1}^4 V_{im} \\hat{u}_m$。\n用矩阵形式表示，$\\mathbf{u} = V \\hat{\\mathbf{u}}$。这意味着逆转换为 $\\hat{\\mathbf{u}} = V^{-1} \\mathbf{u}$。\n\n将模态系数的转换代入内积的模态表示中，得到：\n$$ (u,v) = (V^{-1}\\mathbf{u})^T M_{\\text{modal}} (V^{-1}\\mathbf{v}) = \\mathbf{u}^T (V^{-1})^T M_{\\text{modal}} V^{-1} \\mathbf{v} = \\mathbf{u}^T (V^{-T} M_{\\text{modal}} V^{-1}) \\mathbf{v} $$\n通过令内积的两种以节点值表示的表达式相等，我们得到：\n$$ \\mathbf{u}^T M_{\\text{nodal}} \\mathbf{v} = \\mathbf{u}^T (V^{-T} M_{\\text{modal}} V^{-1}) \\mathbf{v} $$\n由于该等式必须对所有对应于 $\\mathbb{P}_3$ 中多项式的向量 $\\mathbf{u}, \\mathbf{v}$ 成立，因此矩阵本身必须相等：\n$$ M_{\\text{nodal}} = V^{-T} M_{\\text{modal}} V^{-1} $$\n这就完成了对该恒等式的验证。根据定义，只要所有积分都被精确计算，该恒等式就成立。\n\n任务3：计算弗罗贝尼乌斯范数 $\\|V^{-T} M_{\\text{modal}} V^{-1}-M_{\\text{nodal}}\\|_{F}$。\n\n根据上面的验证，我们已经确定矩阵等式 $V^{-T} M_{\\text{modal}} V^{-1} = M_{\\text{nodal}}$ 是精确成立的。因此，差分矩阵是零矩阵：\n$$ V^{-T} M_{\\text{modal}} V^{-1} - M_{\\text{nodal}} = \\mathbf{0} $$\n其中 $\\mathbf{0}$ 是 $4 \\times 4$ 的零矩阵。\n\n矩阵 $A$ 的弗罗贝尼乌斯范数定义为 $\\|A\\|_F = \\sqrt{\\sum_{i,j} |A_{ij}|^2}$。对于零矩阵，所有元素 $A_{ij}$ 均为 $0$。\n因此，弗罗贝尼乌斯范数为：\n$$ \\|\\mathbf{0}\\|_F = \\sqrt{\\sum_{i=1}^4 \\sum_{j=1}^4 |0|^2} = \\sqrt{0} = 0 $$", "answer": "$$\\boxed{0}$$", "id": "3400113"}, {"introduction": "在上一个练习建立的理论基础上，我们现在转向一个核心的实际问题：数值稳定性。连接模态和节点基的变换矩阵，尽管在理论上是精确的，但其条件数可能非常大，尤其是在高阶多项式下，这会放大计算中的舍入误差。本编程练习 [@problem_id:3400097] 让你能够定量地探索不同节点分布对变换条件数的影响，并实践一种标准的稳定性增强技术——基函数缩放。这对于构建稳健的数值代码至关重要。", "problem": "考虑区间 $[-1,1]$上的一维参考单元以及 $p$ 次多项式逼近。令 $\\{P_k(x)\\}_{k=0}^{p}$ 表示 $[-1,1]$ 上的勒让德多项式，它们构成了多项式空间的模态基，并在 $k \\neq m$ 时满足正交关系 $\\int_{-1}^{1} P_k(x) P_m(x)\\, dx = 0$，其平方范数为 $\\int_{-1}^{1} P_k(x)^2\\, dx = \\frac{2}{2k+1}$。对于 $[-1,1]$ 中的一组 $p+1$ 个不同节点 $\\{x_i\\}_{i=0}^{p}$，通过拉格朗日多项式 $\\{\\ell_i(x)\\}_{i=0}^{p}$ 定义节点基，使得 $\\ell_i(x_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克δ函数。任何次数至多为 $p$ 的多项式 $u_p(x)$ 都可以等价地表示为模态基形式 $u_p(x) = \\sum_{k=0}^{p} \\hat{u}_k P_k(x)$ 或节点基形式 $u_p(x) = \\sum_{i=0}^{p} u_i \\ell_i(x)$，其中 $u_i = u_p(x_i)$ 是节点值，$\\hat{u}_k$ 是模态系数。\n\n定义范德蒙德矩阵 $V \\in \\mathbb{R}^{(p+1)\\times(p+1)}$，其元素为 $V_{ik} = P_k(x_i)$，其中 $i=0,\\dots,p$，$k=0,\\dots,p$。那么，节点系数和模态系数通过线性系统 $u = V \\hat{u}$ 相关联，其中 $u = (u_0,\\dots,u_p)^\\top$ 且 $\\hat{u} = (\\hat{u}_0,\\dots,\\hat{u}_p)^\\top$。定义基变换 $T$ 为 $\\hat{u} = T u$。根据关系式 $u = V \\hat{u}$，可以得出 $T = V^{-1}$，前提是节点是不同的且 $V$ 的列是线性无关的，这对任意 $p+1$ 个不同节点的选择都成立。\n\n目标是：\n1. 对指定的节点集 $\\{x_i\\}$ 和多项式次数 $p$ 构建矩阵 $V$，实现变换 $T = V^{-1}$，并分析当 $p$ 增大时，谱范数（矩阵2-范数）下的条件数 $\\kappa(T)$。回想一下，$\\kappa(T) = \\|T\\|_2 \\|T^{-1}\\|_2$。\n2. 提出并实现一种能够稳定 $T$ 的缩放方法。考虑由 $D_{kk} = \\sqrt{\\frac{2k+1}{2}}$ 定义的列缩放 $D \\in \\mathbb{R}^{(p+1)\\times(p+1)}$，它将勒让德多项式映射到一个 $L^2$-标准正交模态基 $\\phi_k(x) = \\sqrt{\\frac{2k+1}{2}} P_k(x)$。当求积权重 $\\{w_i\\}$ 与节点对应时，也考虑由 $S_{ii} = \\sqrt{w_i}$ 定义的行缩放 $S \\in \\mathbb{R}^{(p+1)\\times(p+1)}$。分析缩放后算子 $SVD$ 的条件数，并与 $V$ 的条件数进行比较。注意 $\\kappa(T) = \\kappa(V)$，并且缩放后变换 $T_{\\text{scaled}} = D^{-1} T S^{-1}$ 的条件数等于 $\\kappa(S V D)$。\n\n您的推导应基于上述核心定义和勒让德多项式的正交性质。除上述定义和已验证的事实外，不要假定任何启发式的“捷径”公式。\n\n您的程序必须实现以下节点集和相应的求积权重：\n- 等距节点：$x_i = -1 + \\frac{2i}{p}$，其中 $i=0,\\dots,p$。在这种情况下，不使用求积权重进行行缩放。\n- 高斯-勒让德节点和权重：使用 $[-1,1]$ 上的 $p+1$ 点高斯-勒让德求积法。\n- 高斯-洛巴托节点：$x_0=-1, x_p=1$，内部节点由雅可比多项式 $P^{(1,1)}_{p-1}(x)$ 的 $p-1$ 个根给出。使用高斯-洛巴托求积权重 $w_i = \\dfrac{2}{p(p+1)}\\dfrac{1}{\\left(P_p(x_i)\\right)^2}$，其中包括端点权重 $w_0=w_p=\\dfrac{2}{p(p+1)}$，因为 $P_p(1)=1$ 且 $P_p(-1)=(-1)^p$，所以 $P_p(\\pm 1)^2=1$。\n\n实现 $V$，使用矩阵2-范数（谱范数）计算 $\\kappa(V)$ 和 $\\kappa(S V D)$。为保证数值稳定性，不要通过显式计算 $V$ 的逆来求条件数；而是使用奇异值分解的特性 $\\kappa_2(V) = \\sigma_{\\max}(V)/\\sigma_{\\min}(V)$。\n\n测试套件：\n- 情况1：$p=3$，等距节点。\n- 情况2：$p=15$，等距节点。\n- 情况3：$p=15$，高斯-勒让德节点和权重。\n- 情况4：$p=1$，高斯-洛巴托节点和权重。\n- 情况5：$p=25$，高斯-洛巴托节点和权重。\n\n对于每种情况，计算并返回一个包含两个浮点数 $[\\kappa(V), \\kappa(SVD)]$ 的列表。您的程序应生成单行输出，其中包含按上述情况顺序排列的结果，结果为逗号分隔的列表，并用方括号括起来。例如，输出格式必须为：\n$[\\,[\\kappa(V)_1,\\kappa(SVD)_1],\\,[\\kappa(V)_2,\\kappa(SVD)_2],\\dots]$。", "solution": "该问题要求分析在一维参考单元 $[-1,1]$ 上，多项式的节点表示与模态表示之间变换的条件数。这种分析在谱方法和间断伽辽金方法中至关重要，因为条件恶劣的变换会放大数值误差。\n\n一个次数至多为 $p$ 的多项式 $u_p(x)$ 可以在两种常用基中表示。首先是模态基，它使用一组正交多项式。在这里，我们使用勒让德多项式 $\\{P_k(x)\\}_{k=0}^p$。其表示为：\n$$u_p(x) = \\sum_{k=0}^{p} \\hat{u}_k P_k(x)$$\n其中 $\\hat{u}_k$ 是模态系数。勒让德多项式在 $[-1,1]$ 上关于 $L^2$ 内积是正交的，满足 $\\int_{-1}^{1} P_k(x) P_m(x)\\, dx = \\frac{2}{2k+1}\\delta_{km}$，其中 $\\delta_{km}$ 是克罗内克δ函数。\n\n其次是节点基，它由一组 $p+1$ 个不同的节点 $\\{x_i\\}_{i=0}^p$ 定义。基函数是拉格朗日多项式 $\\{\\ell_i(x)\\}_{i=0}^p$，它们具有属性 $\\ell_i(x_j) = \\delta_{ij}$。其表示为：\n$$u_p(x) = \\sum_{i=0}^{p} u_i \\ell_i(x)$$\n其中 $u_i = u_p(x_i)$ 是多项式在节点处的值。\n\n节点值 $u = (u_0, \\dots, u_p)^\\top$ 与模态系数 $\\hat{u} = (\\hat{u}_0, \\dots, \\hat{u}_p)^\\top$ 之间的关系是通过在每个节点 $x_i$ 处评估模态展开式来建立的：\n$$u_i = u_p(x_i) = \\sum_{k=0}^{p} \\hat{u}_k P_k(x_i)$$\n这组线性方程可以写成矩阵形式 $u = V \\hat{u}$，其中 $V$ 是广义范德蒙德矩阵，其元素为 $V_{ik} = P_k(x_i)$。从节点值到模态系数的变换由 $\\hat{u} = V^{-1} u$ 给出。此变换的数值稳定性取决于矩阵 $V$ 的条件数，记为 $\\kappa(V)$。回想一下，$\\kappa(A) = \\|A\\|_2 \\|A^{-1}\\|_2$，对于矩阵2-范数，这等价于最大奇异值与最小奇异值的比值，即 $\\kappa_2(A) = \\sigma_{\\max}(A) / \\sigma_{\\min}(A)$。\n\n该问题研究节点选择和基缩放如何影响此条件数。我们分析两种类型的缩放：\n1.  **列缩放**：这对应于模态基的更改。我们使用对角矩阵 $D$，其元素为 $D_{kk} = \\sqrt{\\frac{2k+1}{2}}$。这将勒让德基 $\\{P_k(x)\\}$ 转换为一个 $L^2$-标准正交基 $\\{\\phi_k(x) = D_{kk}P_k(x)\\}$，因为 $\\int_{-1}^1 \\phi_k(x)\\phi_m(x)dx = \\delta_{km}$。这个新基的范德蒙德矩阵是 $V D$。\n2.  **行缩放**：这对应于对线性方程进行加权。我们使用对角矩阵 $S$，其元素为 $S_{ii} = \\sqrt{w_i}$，其中 $\\{w_i\\}$ 是与节点 $\\{x_i\\}$ 相关联的求积权重。\n\n这些缩放的综合效果产生了矩阵 $SVD$。我们将比较原始范德蒙德矩阵的条件数 $\\kappa(V)$ 与完全缩放后矩阵的条件数 $\\kappa(SVD)$。对于某些节点和权重的选择（特别是高斯求积法则），离散内积 $\\sum_{i=0}^p w_i f(x_i) g(x_i)$ 近似于连续内积 $\\int_{-1}^1 f(x)g(x)dx$。如果此求积对次数最高为 $2p$ 的多项式是精确的，则矩阵 $SVD$ 变为正交矩阵，即 $(SVD)^T(SVD) = I$。正交矩阵的条件数为 $1$，表示完美的条件。\n\n对于由多项式次数 $p$ 和节点集定义的每个测试用例，实现将按以下步骤进行：\n\n**1. 节点和权重生成：**\n- **等距节点：** 节点由公式 $x_i = -1 + \\frac{2i}{p}$ 给出，其中 $i=0, \\dots, p$。这种选择很简单，但众所周知，随着 $p$ 的增加，它会导致条件恶劣。未指定求积权重，因此不应用行缩放，这等效于设置 $S=I$（单位矩阵）。\n- **高斯-勒让德节点：** $p+1$ 个节点和相应的权重是高斯-勒让德求积法则的点，该法则对于次数最高为 $2(p+1)-1 = 2p+1$ 的多项式是精确的。我们将使用 `scipy.special.roots_legendre` 来获取它们。鉴于这种精确性，我们预期 $\\kappa(SVD)$ 会非常接近 $1$。\n- **高斯-洛巴托节点：** 这些节点包括端点 $x_0=-1$ 和 $x_p=1$。$p-1$ 个内部节点是勒让德多项式 $P_p'(x)$ 的导数的根，也即雅可比多项式 $P_{p-1}^{(1,1)}(x)$ 的根。权重使用公式 $w_i = \\frac{2}{p(p+1)}\\frac{1}{(P_p(x_i))^2}$ 计算。相应的求积法则对次数最高为 $2p-1$ 的多项式是精确的。由于两个 $p$ 次多项式的乘积是 $2p$ 次的，该法则对于所有基函数的乘积并非精确，因此 $\\kappa(SVD)$ 会大于 $1$，但仍应显著小于 $\\kappa(V)$。\n\n**2. 矩阵构造：**\n- 大小为 $(p+1) \\times (p+1)$ 的范德蒙德矩阵 $V$ 通过设置 $V_{ik} = P_k(x_i)$ 来构造。勒让德多项式 $P_k(x)$ 使用 `scipy.special.eval_legendre` 进行求值。\n- 对角缩放矩阵 $S$ 和 $D$ 使用权重和归一化常数形成。缩放后的矩阵计算为 $SVD$。这可以在 NumPy 中使用广播操作高效地执行，而无需显式创建大型对角矩阵。\n\n**3. 条件数计算：**\n- 条件数 $\\kappa_2(V)$ 和 $\\kappa_2(SVD)$ 使用 `numpy.linalg.cond` 计算，该函数内部按规定使用了奇异值分解。\n\n通过对每个测试用例执行此过程，我们可以观察到节点选择和基缩放对模态-节点变换的数值稳定性的巨大影响。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef solve():\n    \"\"\"\n    Computes the condition numbers for Vandermonde-like matrices based on Legendre polynomials\n    for various node sets and polynomial degrees as specified in the problem statement.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'p': 3, 'type': 'equispaced'},\n        {'p': 15, 'type': 'equispaced'},\n        {'p': 15, 'type': 'gauss-legendre'},\n        {'p': 1, 'type': 'gauss-lobatto'},\n        {'p': 25, 'type': 'gauss-lobatto'},\n    ]\n\n    results = []\n    for case in test_cases:\n        p = case['p']\n        node_type = case['type']\n        \n        # 1. Generate nodes and weights for the given p and node type.\n        if node_type == 'equispaced':\n            nodes = np.linspace(-1, 1, p + 1)\n            # Per problem, no quadrature weights are used for row scaling.\n            # This is equivalent to S=I, which is achieved with weights of 1.\n            weights = np.ones(p + 1)\n        elif node_type == 'gauss-legendre':\n            # Scipy's roots_legendre returns p+1 nodes and weights for a p-th degree polynomial space.\n            nodes, weights = special.roots_legendre(p + 1)\n        elif node_type == 'gauss-lobatto':\n            if p == 0:\n                 nodes = np.array([0.0])\n                 weights = np.array([2.0])\n            elif p==1:\n                 # Endpoints only for p=1\n                 nodes = np.array([-1.0, 1.0])\n                 # Weights from formula w_i = 2/(p(p+1)) for endpoints\n                 weights = np.array([1.0, 1.0])\n            else:\n                # Interior nodes are roots of P'_p(x), which are roots of Jacobi polynomial P_{p-1}^{(1,1)}(x)\n                interior_nodes, _ = special.roots_jacobi(p - 1, 1, 1)\n                nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n                \n                # Weights from formula: w_i = 2 / (p*(p+1) * P_p(x_i)^2)\n                poly_vals_at_nodes = special.eval_legendre(p, nodes)\n                weights = 2 / (p * (p + 1) * poly_vals_at_nodes**2)\n        \n        # 2. Construct the Vandermonde matrix V, where V_ik = P_k(x_i).\n        V = np.zeros((p + 1, p + 1))\n        poly_degrees = np.arange(p + 1)\n        for k_idx, k in enumerate(poly_degrees):\n            V[:, k_idx] = special.eval_legendre(k, nodes)\n            \n        # 3. Compute the condition number of V using the 2-norm.\n        cond_V = np.linalg.cond(V, 2)\n        \n        # 4. Construct the scaled matrix SVD and compute its condition number.\n        # S is diagonal with S_ii = sqrt(w_i)\n        # D is diagonal with D_kk = sqrt((2k+1)/2)\n        \n        # The matrix SVD can be constructed efficiently using broadcasting.\n        S_diag_sqrt = np.sqrt(weights)\n        D_diag_sqrt = np.sqrt((2 * poly_degrees + 1) / 2)\n        \n        # SVD_matrix[i,k] = S_ii * V_ik * D_kk\n        SVD_matrix = S_diag_sqrt[:, np.newaxis] * V * D_diag_sqrt[np.newaxis, :]\n        \n        cond_SVD = np.linalg.cond(SVD_matrix, 2)\n        \n        results.append([cond_V, cond_SVD])\n\n    # 5. Format and print the final output as a single-line string.\n    # The required format is [[k(V)_1,k(SVD)_1],[k(V)_2,k(SVD)_2],...].\n    list_of_strs = []\n    for res_pair in results:\n        list_of_strs.append(f\"[{res_pair[0]},{res_pair[1]}]\")\n    final_str = f\"[{','.join(list_of_strs)}]\"\n    print(final_str)\n\nsolve()\n```", "id": "3400097"}, {"introduction": "在理解了两种基函数之间的关系及变换的稳定性之后，是时候看看它们在实际应用中的威力了。节点基，特别是与配置点（如高斯-洛巴托点）结合使用时，其最强大的应用之一是构建谱微分矩阵。这个练习 [@problem_id:3400065] 将带你从第一性原理出发，一步步构建这样一个矩阵，并通过在一个测试函数上验证其精确性，直观地展示谱方法的核心优势——谱精度。", "problem": "考虑在区间 $[-1,1]$ 上，使用多项式阶数 $N=3$ 的 Gauss–Lobatto–Legendre (GLL) 节点的一维谱配置法。设 $\\{x_{j}\\}_{j=0}^{N}$ 为 $N+1$ 个 GLL 节点，其中 $x_{0}=-1$，$x_{N}=1$，内部节点由 $N$ 阶 Legendre 多项式的导数的根给出。定义 Lagrange 节点基 $\\{\\ell_{j}(x)\\}_{j=0}^{N}$，满足 $\\ell_{j}(x_{i})=\\delta_{ij}$，并定义节点微分矩阵 $D\\in\\mathbb{R}^{(N+1)\\times(N+1)}$，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$。\n\n从 $\\ell_{j}(x)$ 的定义和 GLL 节点的性质出发，显式计算在 $[-1,1]$ 上当 $N=3$ 时的矩阵 $D$。然后，对于多项式 $u(x)=x^{3}$，构建节点向量 $u=[u(x_{0}),u(x_{1}),u(x_{2}),u(x_{3})]^{\\mathsf{T}}$ 和离散导数 $v=Du$。使用精确导数 $u'(x)=3x^{2}$，定义最大节点误差\n$$\nE_{\\max}=\\max_{0\\le i\\le 3}\\left|v_{i}-u'(x_{i})\\right|.\n$$\n\n给出 $E_{\\max}$ 作为最终答案。不需要四舍五入，也不涉及单位。中间步骤必须从给定节点上的 Lagrange 插值的第一性原理出发进行证明，不得调用任何预设 $D$ 最终形式的结果。", "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **区域：** 一维区间 $[-1, 1]$。\n- **方法：** 在 Gauss–Lobatto–Legendre (GLL) 节点上的谱配置法。\n- **多项式阶数：** $N=3$。\n- **节点：** $\\{x_{j}\\}_{j=0}^{3}$ 是 GLL 节点。$x_{0}=-1$，$x_{3}=1$。内部节点是 $N=3$ 阶 Legendre 多项式 $P_{3}'(x)$ 的导数的根。\n- **基：** Lagrange 节点基 $\\{\\ell_{j}(x)\\}_{j=0}^{3}$，由属性 $\\ell_{j}(x_{i})=\\delta_{ij}$ 定义，其中 $\\delta_{ij}$ 是 Kronecker δ。\n- **微分矩阵：** $D\\in\\mathbb{R}^{4\\times 4}$，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$。\n- **函数：** $u(x)=x^{3}$。\n- **节点向量：** $u=[u(x_{0}),u(x_{1}),u(x_{2}),u(x_{3})]^{\\mathsf{T}}$。\n- **离散导数：** $v=Du$。\n- **精确导数：** $u'(x)=3x^{2}$。\n- **误差度量：** $E_{\\max}=\\max_{0\\le i\\le 3}\\left|v_{i}-u'(x_{i})\\right|$。\n- **约束：** 解必须从 $\\ell_j(x)$ 和 GLL 节点的定义等第一性原理推导得出，不得使用任何预先计算好的微分矩阵 $D$ 的公式。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题是数值偏微分方程谱方法领域的一个标准练习。所有概念（Legendre 多项式、GLL 节点、Lagrange 插值、谱微分）在数值分析中都是基础且成熟的。\n- **适定性：** 问题定义清晰，包含了所有必要信息。计算 GLL 节点、微分矩阵、离散导数和最终误差的步骤明确，能够导出一个唯一解。\n- **客观性：** 问题陈述精确、量化，并且没有任何主观或基于观点的语言。\n- **结论：** 问题是自洽的、一致的，并且在科学上是合理的。它没有违反任何指定的无效性标准。\n\n**步骤 3：判定与操作**\n该问题是 **有效的**。将提供一个完整的、有理有据的解答。\n\n### 解答\n\n解答过程分为以下几个步骤：\n1.  计算 Gauss–Lobatto–Legendre (GLL) 节点 $\\{x_j\\}_{j=0}^3$。\n2.  根据 Lagrange 基的定义构造微分矩阵 $D$。\n3.  在节点处计算函数 $u(x)=x^3$ 的值，以构成向量 $u$。\n4.  计算离散导数 $v=Du$。\n5.  在节点处计算精确导数 $u'(x)=3x^2$ 的值。\n6.  计算最大节点误差 $E_{\\max}$。\n\n**步骤 1：计算 $N=3$ 时的 GLL 节点**\n在 $[-1, 1]$ 上，阶数为 $N$ 的多项式的 GLL 节点包含端点 $x_0=-1$ 和 $x_N=1$，以及 $P_N'(x)$ 的 $N-1$ 个根，其中 $P_N(x)$ 是 $N$ 阶 Legendre 多项式。对于 $N=3$，我们需要 $P_3'(x)$ 的根。\n\nLegendre 多项式由递推关系 $(n+1)P_{n+1}(x) = (2n+1)xP_n(x) - nP_{n-1}(x)$ 定义，其中 $P_0(x)=1$ 和 $P_1(x)=x$。\n$P_2(x) = \\frac{1}{2}(3x^2-1)$\n$P_3(x) = \\frac{1}{2}(5x^3-3x)$\n\n其导数为 $P_3'(x) = \\frac{1}{2}(15x^2-3)$。\n内部节点是 $P_3'(x)=0$ 的根：\n$$\n15x^2 - 3 = 0 \\implies x^2 = \\frac{3}{15} = \\frac{1}{5} \\implies x = \\pm \\frac{1}{\\sqrt{5}}\n$$\n这 $N+1=4$ 个 GLL 节点按从小到大的顺序排列为：\n$$\nx_0 = -1, \\quad x_1 = -\\frac{1}{\\sqrt{5}}, \\quad x_2 = \\frac{1}{\\sqrt{5}}, \\quad x_3 = 1\n$$\n\n**步骤 2：计算微分矩阵 $D$**\n微分矩阵的元素由 $D_{ij} = \\ell_j'(x_i)$ 给出。Lagrange 基多项式 $\\ell_j(x)$ 定义为：\n$$\n\\ell_j(x) = \\prod_{k=0, k\\neq j}^{3} \\frac{x-x_k}{x_j-x_k}\n$$\n导数 $\\ell_j'(x)$ 可以使用乘法法则求得。在节点 $x_i$ 处求值：\n对于 $i \\neq j$：\n$$\n\\ell_j'(x_i) = \\frac{1}{\\prod_{k \\neq j}(x_j-x_k)} \\left. \\frac{d}{dx} \\prod_{k \\neq j}(x-x_k) \\right|_{x=x_i} = \\frac{\\prod_{k \\neq i,j}(x_i-x_k)}{\\prod_{k \\neq j}(x_j-x_k)}\n$$\n对于 $i = j$：\n$$\n\\ell_i'(x_i) = \\sum_{k=0, k\\neq i}^{3} \\frac{1}{x_i-x_k}\n$$\n我们现在计算 $D$ 的元素。\n对角线元素 $D_{ii}$：\n$D_{00} = \\frac{1}{x_0-x_1} + \\frac{1}{x_0-x_2} + \\frac{1}{x_0-x_3} = \\frac{1}{-1 - (-1/\\sqrt{5})} + \\frac{1}{-1 - 1/\\sqrt{5}} + \\frac{1}{-1 - 1} = \\frac{1}{-1+1/\\sqrt{5}} + \\frac{1}{-1-1/\\sqrt{5}} - \\frac{1}{2} = \\frac{\\sqrt{5}}{1-\\sqrt{5}} - \\frac{\\sqrt{5}}{1+\\sqrt{5}} - \\frac{1}{2} = \\sqrt{5}\\frac{(1+\\sqrt{5})-(1-\\sqrt{5})}{1-5} - \\frac{1}{2} = \\frac{\\sqrt{5}(2\\sqrt{5})}{-4} - \\frac{1}{2} = -\\frac{10}{4} - \\frac{1}{2} = -3$。\n$D_{11} = \\frac{1}{x_1-x_0} + \\frac{1}{x_1-x_2} + \\frac{1}{x_1-x_3} = \\frac{1}{-1/\\sqrt{5}-(-1)} + \\frac{1}{-1/\\sqrt{5}-1/\\sqrt{5}} + \\frac{1}{-1/\\sqrt{5}-1} = \\frac{\\sqrt{5}}{\\sqrt{5}-1} - \\frac{\\sqrt{5}}{2} - \\frac{\\sqrt{5}}{\\sqrt{5}+1} = \\sqrt{5}\\left(\\frac{1}{\\sqrt{5}-1} - \\frac{1}{\\sqrt{5}+1}\\right) - \\frac{\\sqrt{5}}{2} = \\sqrt{5}\\frac{(\\sqrt{5}+1)-(\\sqrt{5}-1)}{5-1} - \\frac{\\sqrt{5}}{2} = \\sqrt{5}\\frac{2}{4} - \\frac{\\sqrt{5}}{2} = 0$。\n根据节点的对称性（$x_2 = -x_1, x_0 = -x_3$），我们可以推断出 $D_{22}=0$。\n$D_{33} = \\frac{1}{x_3-x_0} + \\frac{1}{x_3-x_1} + \\frac{1}{x_3-x_2} = \\frac{1}{1-(-1)} + \\frac{1}{1-(-1/\\sqrt{5})} + \\frac{1}{1-1/\\sqrt{5}} = \\frac{1}{2} + \\frac{\\sqrt{5}}{\\sqrt{5}+1} + \\frac{\\sqrt{5}}{\\sqrt{5}-1} = \\frac{1}{2} + \\sqrt{5}\\frac{(\\sqrt{5}-1)+(\\sqrt{5}+1)}{5-1} = \\frac{1}{2} + \\frac{\\sqrt{5}(2\\sqrt{5})}{4} = \\frac{1}{2} + \\frac{10}{4} = 3$。\n$D$ 的对角线元素为 $(-3, 0, 0, 3)$。\n\n非对角线元素 $D_{ij}$ ($i \\neq j$)：\n我们计算几个代表性的元素。\n$D_{10} = \\ell_0'(x_1) = \\frac{(x_1-x_2)(x_1-x_3)}{(x_0-x_1)(x_0-x_2)(x_0-x_3)} = \\frac{(-2/\\sqrt{5})(-1-1/\\sqrt{5})}{(-1+1/\\sqrt{5})(-1-1/\\sqrt{5})(-2)} = \\frac{2(1+1/\\sqrt{5})/\\sqrt{5}}{-(1-1/5)(-2)} = \\frac{2(\\sqrt{5}+1)/5}{8/5} = \\frac{2(\\sqrt{5}+1)}{8} = \\frac{\\sqrt{5}+1}{4}$。\n系统地计算所有元素可得到矩阵：\n$$\nD = \\begin{pmatrix}\n-3  & \\frac{5(1+\\sqrt{5})}{4}  & \\frac{5(1-\\sqrt{5})}{4}  & \\frac{1}{2} \\\\\n-\\frac{\\sqrt{5}+1}{4}  & 0  & \\frac{\\sqrt{5}}{2}  & -\\frac{\\sqrt{5}-1}{4} \\\\\n\\frac{\\sqrt{5}-1}{4}  & -\\frac{\\sqrt{5}}{2}  & 0  & \\frac{\\sqrt{5}+1}{4} \\\\\n-\\frac{1}{2}  & \\frac{5(\\sqrt{5}-1)}{4}  & -\\frac{5(\\sqrt{5}+1)}{4}  & 3\n\\end{pmatrix}\n$$\n\n**步骤 3：构建节点向量 $u$**\n函数为 $u(x)=x^3$。通过在 GLL 节点处计算 $u(x)$ 的值来构建节点向量 $u$：\n$u_0 = u(x_0) = u(-1) = (-1)^3 = -1$。\n$u_1 = u(x_1) = u(-1/\\sqrt{5}) = (-1/\\sqrt{5})^3 = -1/(5\\sqrt{5})$。\n$u_2 = u(x_2) = u(1/\\sqrt{5}) = (1/\\sqrt{5})^3 = 1/(5\\sqrt{5})$。\n$u_3 = u(x_3) = u(1) = 1^3 = 1$。\n所以，$u=[-1, -1/(5\\sqrt{5}), 1/(5\\sqrt{5}), 1]^{\\mathsf{T}}$。\n\n**步骤 4：计算离散导数 $v=Du$**\n我们进行矩阵-向量乘法 $v=Du$。\n$v_0 = (-3)(-1) + \\frac{5(1+\\sqrt{5})}{4}\\left(-\\frac{1}{5\\sqrt{5}}\\right) + \\frac{5(1-\\sqrt{5})}{4}\\left(\\frac{1}{5\\sqrt{5}}\\right) + \\frac{1}{2}(1) = 3 - \\frac{1+\\sqrt{5}}{4\\sqrt{5}} + \\frac{1-\\sqrt{5}}{4\\sqrt{5}} + \\frac{1}{2} = 3 + \\frac{(1-\\sqrt{5})-(1+\\sqrt{5})}{4\\sqrt{5}} + \\frac{1}{2} = 3 + \\frac{-2\\sqrt{5}}{4\\sqrt{5}} + \\frac{1}{2} = 3 - \\frac{1}{2} + \\frac{1}{2} = 3$。\n\n$v_1 = \\left(-\\frac{\\sqrt{5}+1}{4}\\right)(-1) + (0)\\left(-\\frac{1}{5\\sqrt{5}}\\right) + \\left(\\frac{\\sqrt{5}}{2}\\right)\\left(\\frac{1}{5\\sqrt{5}}\\right) + \\left(-\\frac{\\sqrt{5}-1}{4}\\right)(1) = \\frac{1+\\sqrt{5}}{4} + \\frac{1}{10} - \\frac{\\sqrt{5}-1}{4} = \\frac{(1+\\sqrt{5})-(\\sqrt{5}-1)}{4} + \\frac{1}{10} = \\frac{2}{4} + \\frac{1}{10} = \\frac{1}{2} + \\frac{1}{10} = \\frac{6}{10} = \\frac{3}{5}$。\n\n$v_2 = \\left(\\frac{\\sqrt{5}-1}{4}\\right)(-1) + \\left(-\\frac{\\sqrt{5}}{2}\\right)\\left(-\\frac{1}{5\\sqrt{5}}\\right) + (0)\\left(\\frac{1}{5\\sqrt{5}}\\right) + \\left(\\frac{\\sqrt{5}+1}{4}\\right)(1) = -\\frac{\\sqrt{5}-1}{4} + \\frac{1}{10} + \\frac{\\sqrt{5}+1}{4} = \\frac{(\\sqrt{5}+1)-(\\sqrt{5}-1)}{4} + \\frac{1}{10} = \\frac{2}{4} + \\frac{1}{10} = \\frac{3}{5}$。\n\n$v_3 = \\left(-\\frac{1}{2}\\right)(-1) + \\frac{5(\\sqrt{5}-1)}{4}\\left(-\\frac{1}{5\\sqrt{5}}\\right) + \\left(-\\frac{5(\\sqrt{5}+1)}{4}\\right)\\left(\\frac{1}{5\\sqrt{5}}\\right) + (3)(1) = \\frac{1}{2} - \\frac{\\sqrt{5}-1}{4\\sqrt{5}} - \\frac{\\sqrt{5}+1}{4\\sqrt{5}} + 3 = \\frac{7}{2} - \\frac{(\\sqrt{5}-1)+(\\sqrt{5}+1)}{4\\sqrt{5}} = \\frac{7}{2} - \\frac{2\\sqrt{5}}{4\\sqrt{5}} = \\frac{7}{2} - \\frac{1}{2} = 3$。\n\n离散导数向量为 $v = [3, 3/5, 3/5, 3]^{\\mathsf{T}}$。\n\n**步骤 5：计算节点上的精确导数**\n$u(x)=x^3$ 的精确导数是 $u'(x)=3x^2$。我们在节点处计算其值：\n$u'(x_0) = u'(-1) = 3(-1)^2 = 3$。\n$u'(x_1) = u'(-1/\\sqrt{5}) = 3(-1/\\sqrt{5})^2 = 3(1/5) = 3/5$。\n$u'(x_2) = u'(1/\\sqrt{5}) = 3(1/\\sqrt{5})^2 = 3(1/5) = 3/5$。\n$u'(x_3) = u'(1) = 3(1)^2 = 3$。\n精确导数值的向量是 $[3, 3/5, 3/5, 3]^{\\mathsf{T}}$。\n\n**步骤 6：计算最大节点误差 $E_{\\max}$**\n每个节点上的误差由 $v_i - u'(x_i)$ 给出：\n$v_0 - u'(x_0) = 3 - 3 = 0$。\n$v_1 - u'(x_1) = 3/5 - 3/5 = 0$。\n$v_2 - u'(x_2) = 3/5 - 3/5 = 0$。\n$v_3 - u'(x_3) = 3 - 3 = 0$。\n所有节点上的误差均为零。因此，最大节点误差为：\n$$\nE_{\\max} = \\max\\{|0|, |0|, |0|, |0|\\} = 0\n$$\n\n这个结果是预料之中的。谱配置法涉及用一个最高 $N$ 阶的多项式来插值函数 $u(x)$，该多项式穿过 $N+1$ 个节点上的函数值。此处，$N=3$。被微分的函数 $u(x)=x^3$ 是一个 3 阶多项式。因此，插值多项式就是 $u(x)$ 本身。谱微分过程计算的是插值多项式在节点处的精确导数。由于插值多项式是精确的，其导数也是精确的，计算出的节点导数值与精确导数值完全匹配。因此，误差恒为零。", "answer": "$$\n\\boxed{0}\n$$", "id": "3400065"}]}