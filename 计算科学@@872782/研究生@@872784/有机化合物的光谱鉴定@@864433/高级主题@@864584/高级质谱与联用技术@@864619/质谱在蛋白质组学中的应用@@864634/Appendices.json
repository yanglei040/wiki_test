{"hands_on_practices": [{"introduction": "在鉴定或定量肽段之前，我们必须首先理解其在质谱图中的基本特征。本练习介绍“averagine”模型，这是一种仅从肽段的质量来估算其元素组成的强大近似方法。通过解决这个问题 [@problem_id:3712591]，您将学会预测肽段的特征性同位素分布，这是解读MS1层面数据以及确定母离子电荷态和质量的关键技能。", "problem": "考虑使用 averagine 模型对肽进行质谱 (MS) 分析。averagine 模型通过为每个特征质量单位分配平均原子数来近似肽的元素组成。对于肽，设 averagine 质量单位为 $M_{\\mathrm{avg}}=111.1254\\ \\mathrm{Da}$，每个单位的平均组成为 $C=4.9384$，$H=7.7583$，$N=1.3577$，$O=1.4773$ 和 $S=0.0417$。假设一个肽的中性单同位素质量为 $M_0=2000\\ \\mathrm{Da}$。使用以下经过充分检验的常数：$^{13}\\mathrm{C}$ 的自然丰度为 $p_{^{13}\\mathrm{C}}=0.01070$ (以小数形式表示)，$^{13}\\mathrm{C}$ 和 $^{12}\\mathrm{C}$ 之间的质量差为 $\\Delta m_{^{13}\\mathrm{C}}=1.003355\\ \\mathrm{Da}$，质子质量为 $m_p=1.007276\\ \\mathrm{Da}$。考虑 $z=2$ 的电荷态。\n\n从第一性原理出发，论证使用 averagine 近似来估计总碳原子数（作为 $M_0$ 的函数）的合理性，推导在 $n_C$ 大且 $p_{^{13}\\mathrm{C}}$ 小的情况下，二项分布到泊松分布极限下 $^{13}\\mathrm{C}$ 原子数的期望分布，并用此来预测电荷 $z=2$ 时以 $^{13}\\mathrm{C}$ 为主的同位素包络的强度加权质心。忽略来自非碳重同位素的贡献。将最终的质心以汤姆森 (Th) 为单位的质荷比表示，并将您的答案四舍五入到 $5$ 位有效数字。", "solution": "该问题要求计算在特定电荷态下观察到的、给定质量肽的同位素包络的强度加权质心。计算将分三个主要步骤进行：首先，使用所提供的 averagine 模型估计肽中的总碳原子数；其次，根据其自然丰度确定 $^{13}\\mathrm{C}$ 同位素的期望数量；第三，利用此期望值计算质荷比 ($m/z$) 分布的质心。\n\n**步骤 1：碳原子数 ($n_C$) 的估计**\n\naveragine 模型提供了一种仅根据肽的质量来估计其典型元素组成的方法。它假定存在一个假设的平均氨基酸残基，称为“averagine”，其质量和元素式均已定义，这些数据源自大型蛋白质序列数据库。该模型的合理性在于，对于足够大的肽，其特定的氨基酸序列对整体元素组成的影响要小于其总质量的影响。其组成趋向于一个统计平均值。\n\n一个 averagine 单位的质量为 $M_{\\mathrm{avg}} = 111.1254\\ \\mathrm{Da}$。对于一个中性单同位素质量为 $M_0 = 2000\\ \\mathrm{Da}$ 的肽，其 averagine 单位的近似数量 $N_{\\mathrm{units}}$ 为：\n$$N_{\\mathrm{units}} = \\frac{M_0}{M_{\\mathrm{avg}}}$$\naveragine 的组成指定了每个单位中各元素的平均原子数。对于碳，该值为 $C_{\\mathrm{avg/unit}} = 4.9384$。因此，肽中碳原子的总数 $n_C$ 可以估计为：\n$$n_C = N_{\\mathrm{units}} \\times C_{\\mathrm{avg/unit}} = \\frac{M_0}{M_{\\mathrm{avg}}} \\times C_{\\mathrm{avg/unit}}$$\n代入给定值：\n$$n_C = \\frac{2000}{111.1254} \\times 4.9384 \\approx 88.87803$$\n\n**步骤 2：$^{13}\\mathrm{C}$ 原子的期望数量**\n\n问题要求考虑 $^{13}\\mathrm{C}$ 原子数量的分布。肽中的 $n_C$ 个碳原子中的每一个都有很小的概率是重同位素 $^{13}\\mathrm{C}$。这种情况可以用二项分布来描述。设 $k$ 为 $^{13}\\mathrm{C}$ 原子的数量。在一个含有 $n_C$ 个总碳原子的分子中，恰好有 $k$ 个 $^{13}\\mathrm{C}$ 原子的概率由二项概率质量函数 $P(k) = \\binom{n_C}{k} (p_{^{13}\\mathrm{C}})^k (1-p_{^{13}\\mathrm{C}})^{n_C-k}$ 给出，其中 $p_{^{13}\\mathrm{C}} = 0.01070$ 是 $^{13}\\mathrm{C}$ 的自然丰度。\n\n问题指定使用二项分布到泊松分布的极限。当试验次数 ($n_C$) 很大且成功概率 ($p_{^{13}\\mathrm{C}}$) 很小时，这个近似是合理的，此时它们的乘积 $\\lambda = n_C p_{^{13}\\mathrm{C}}$ 是一个有限常数。此处，$n_C \\approx 89$ 较大，而 $p_{^{13}\\mathrm{C}} \\approx 0.01$ 较小。在此极限下，二项分布收敛于参数为 $\\lambda$ 的泊松分布：\n$$P(k) \\approx \\frac{\\lambda^k e^{-\\lambda}}{k!}$$\n强度加权质心的计算需要 $k$ 的期望值（均值），记为 $E[k]$。对于底层的二项分布，期望值为 $E[k] = n_C p_{^{13}\\mathrm{C}}$。对于近似的泊松分布，期望值为 $E[k] = \\lambda$。由于 $\\lambda = n_C p_{^{13}\\mathrm{C}}$，因此两种模型下的期望值是相同的。\n$$E[k] = \\lambda = n_C p_{^{13}\\mathrm{C}} = \\left(\\frac{2000}{111.1254} \\times 4.9384\\right) \\times 0.01070 \\approx 0.950995$$\n\n**步骤 3：质心质荷比的推导与计算**\n\n同位素包络由质谱图中的一系列峰组成。我们忽略除 $^{13}\\mathrm{C}$ 之外所有重同位素的贡献。第一个峰（单同位素峰）对应于只含有轻同位素（例如 $^{12}\\mathrm{C}$）的分子，其质量为 $M_0$。随后的峰对应于含有 $k=1, 2, 3, \\ldots$ 个 $^{13}\\mathrm{C}$ 原子的分子。\n\n含有 $k$ 个 $^{13}\\mathrm{C}$ 原子的同位素体质量 $M_k$，比单同位素质量 $M_0$ 大 $k$ 倍的 $^{13}\\mathrm{C}$ 和 $^{12}\\mathrm{C}$ 原子质量差 $\\Delta m_{^{13}\\mathrm{C}} = 1.003355\\ \\mathrm{Da}$：\n$$M_k = M_0 + k \\cdot \\Delta m_{^{13}\\mathrm{C}}$$\n在质谱仪中，检测到的量是质荷比 $m/z$。对于一个质量为 $M_k$ 的肽，它通过结合 $z$ 个质子（质量为 $m_p = 1.007276\\ \\mathrm{Da}$）而获得 $+z$ 的电荷，其观测到的 $m/z$ 为：\n$$(m/z)_k = \\frac{M_k + z \\cdot m_p}{z} = \\frac{(M_0 + k \\cdot \\Delta m_{^{13}\\mathrm{C}}) + z \\cdot m_p}{z}$$\n同位素包络的强度加权质心 $(m/z)_{\\text{centroid}}$ 是这些 $(m/z)_k$ 值的平均值，并由它们各自的相对强度 $I_k \\propto P(k)$ 进行加权：\n$$(m/z)_{\\text{centroid}} = \\frac{\\sum_{k=0}^{\\infty} I_k \\cdot (m/z)_k}{\\sum_{k=0}^{\\infty} I_k} = \\frac{\\sum_{k=0}^{\\infty} P(k) \\cdot (m/z)_k}{\\sum_{k=0}^{\\infty} P(k)}$$\n由于 $\\sum_{k=0}^{\\infty} P(k) = 1$，质心就是 $(m/z)_k$ 的期望值：\n$$(m/z)_{\\text{centroid}} = E[(m/z)_k] = E\\left[\\frac{M_0 + k \\cdot \\Delta m_{^{13}\\mathrm{C}} + z \\cdot m_p}{z}\\right]$$\n利用期望算子的线性性质 $E[aX+b] = aE[X]+b$，其中 $k$ 是随机变量，所有其他项都是常数：\n$$(m/z)_{\\text{centroid}} = \\frac{M_0 + E[k] \\cdot \\Delta m_{^{13}\\mathrm{C}} + z \\cdot m_p}{z}$$\n代入步骤 2 中 $E[k]$ 的表达式：\n$$(m/z)_{\\text{centroid}} = \\frac{M_0 + (n_C p_{^{13}\\mathrm{C}}) \\cdot \\Delta m_{^{13}\\mathrm{C}} + z \\cdot m_p}{z}$$\n现在，我们代入所有的数值：\n$M_0 = 2000\\ \\mathrm{Da}$\n$z = 2$\n$m_p = 1.007276\\ \\mathrm{Da}$\n$\\Delta m_{^{13}\\mathrm{C}} = 1.003355\\ \\mathrm{Da}$\n$E[k] = \\lambda \\approx 0.950995$\n\n$$(m/z)_{\\text{centroid}} = \\frac{2000 + (0.950995) \\cdot (1.003355) + 2 \\cdot (1.007276)}{2}$$\n$$(m/z)_{\\text{centroid}} = \\frac{2000 + 0.954153 + 2.014552}{2}$$\n$$(m/z)_{\\text{centroid}} = \\frac{2002.968705}{2} = 1001.4843525$$\n问题要求答案四舍五入到 $5$ 位有效数字。\n$$(m/z)_{\\text{centroid}} \\approx 1001.5\\ \\mathrm{Th}$$\n单位汤姆森 (Th) 等价于 Da/e，即质荷比的单位。", "answer": "$$\\boxed{1001.5}$$", "id": "3712591"}, {"introduction": "从碎裂谱图中鉴定肽段是蛋白质组学的基石，但我们对一个给定的肽段-谱图匹配（PSM）究竟能有多大的信心呢？本练习 [@problem_id:3712617] 将超越简单的评分指标，深入探讨现代PSM验证的核心：概率评分。您将构建一个贝叶斯框架，该框架整合了匹配的多个独立特征——如质量精度和碎片离子强度——来计算后验概率，从而为鉴定置信度提供统计上稳健的度量。", "problem": "您的任务是在有机化合物质谱鉴定的更广阔背景下，为蛋白质组学中使用的串联质谱 (MS/MS) 中的肽谱匹配 (PSM) 设计并实现一个概率评分模型。该模型必须包含候选PSM的三个独立观测特征：绝对质量测量误差、累积匹配碎片离子强度分数和匹配峰计数。您的程序必须仅从基础概率论和每个特征的经验驱动分布族出发，为一组预定义的候选PSM计算正确鉴定的后验概率。\n\n使用以下符合上下文的基础和假设：\n\n- 基础贝叶斯定理：对于一个二元潜在假设 $H \\in \\{\\text{correct}, \\text{incorrect}\\}$ 和观测特征 $\\mathbf{x}$，后验概率 $P(H \\mid \\mathbf{x})$ 由先验概率 $P(H)$ 和似然 $p(\\mathbf{x} \\mid H)$ 给出。\n- 以H为条件的特征间独立性假设：$p(\\mathbf{x} \\mid H) = \\prod_{j} p(x_j \\mid H)$，其中 $x_j$ 是特征值。\n- 特征定义和物理上一致的测量域：\n  1. 绝对质量测量误差 $\\varepsilon$，单位为百万分率 (ppm)，定义为非负标量。以 $\\mathrm{ppm}$ 为单位表示 $\\varepsilon$ 值。\n  2. 累积匹配碎片离子强度分数 $f \\in (0,1)$，定义为由匹配的碎片离子集所解释的总离子流的分数，无量纲。\n  3. 匹配峰计数 $k \\in \\{0,1,2,\\dots\\}$，定义为匹配的碎片离子峰的非负整数数量。\n\n使用经验驱动的参数族对假设 $\\text{correct}$ 和 $\\text{incorrect}$ 下的每个特征的似然进行建模：\n\n- 对于质量精度，在每个假设下使用半正态分布对绝对误差 $\\varepsilon$ 进行建模。在 $\\text{correct}$ 假设下，使用尺度参数 $\\sigma_c = 5\\,\\mathrm{ppm}$；在 $\\text{incorrect}$ 假设下，使用 $\\sigma_i = 50\\,\\mathrm{ppm}$。半正态分布通过尺度为 $\\sigma$ 的密度函数为 $x \\ge 0$ 定义。\n- 对于强度分数 $f$，在每个假设下使用Beta分布。在 $\\text{correct}$ 假设下，使用 $\\alpha_c = 5$ 和 $\\beta_c = 2$；在 $\\text{incorrect}$ 假设下，使用 $\\alpha_i = 1.5$ 和 $\\beta_i = 5$。Beta分布在 $(0,1)$ 上定义，形状参数为 $(\\alpha, \\beta)$。\n- 对于匹配峰计数 $k$，使用泊松分布。在 $\\text{correct}$ 假设下，使用率参数 $\\lambda_c = 12$；在 $\\text{incorrect}$ 假设下，使用率参数 $\\lambda_i = 3$。\n\n假设正确鉴定的全局先验概率为 $P(\\text{correct}) = 0.3$，因此 $P(\\text{incorrect}) = 0.7$。\n\n您的任务是使用上述假设，为每个候选PSM计算后验概率 $P(\\text{correct} \\mid \\varepsilon, f, k)$。您必须实现一个数值稳定的计算方法，该方法在独立性假设下结合三个特征的似然，并应用贝叶斯定理来获得后验概率。\n\n将所有质量误差以 $\\mathrm{ppm}$ 表示，强度以开区间 $(0,1)$ 内的无量纲分数表示，峰计数以非负整数表示。此问题不涉及角度。输出必须是以无单位区间 $(0,1)$ 内的十进制浮点数表示的数值概率。\n\n测试套件和参数值：\n- 通用模型参数：\n  - $P(\\text{correct}) = 0.3$。\n  - 半正态尺度参数：$\\sigma_c = 5\\,\\mathrm{ppm}$，$\\sigma_i = 50\\,\\mathrm{ppm}$。\n  - Beta形状参数：$(\\alpha_c, \\beta_c) = (5, 2)$ 和 $(\\alpha_i, \\beta_i) = (1.5, 5)$。\n  - 泊松率参数：$\\lambda_c = 12$ 和 $\\lambda_i = 3$。\n- 待评估的候选PSM，每个以 $(\\varepsilon\\,\\mathrm{ppm}, f, k)$ 形式给出：\n  1. $(4, 0.65, 14)$\n  2. $(80, 0.12, 2)$\n  3. $(0, 0.90, 0)$\n  4. $(10, 0.40, 8)$\n  5. $(100, 0.60, 20)$\n  6. $(1, 0.05, 3)$\n\n您的程序应生成单行输出，其中包含六个候选PSM的结果，形式为方括号括起来的逗号分隔的后验概率列表，每个浮点数四舍五入到六位小数（例如，$[p_1,p_2,p_3,p_4,p_5,p_6]$）。不应打印任何其他文本。", "solution": "问题陈述已经过严格审查，并被确定为有效。它具有科学依据、提法明确且客观。所有必要信息均已提供，且所作假设与蛋白质组学中质谱数据的统计分析的既有实践相符。因此，我们可以着手进行形式化求解。\n\n核心任务是计算给定由三个观测特征组成的向量 $\\mathbf{x} = (\\varepsilon, f, k)$ 时，一个正确的肽谱匹配 (PSM) 的后验概率，记为 $P(H_c \\mid \\mathbf{x})$。假设 $H_c$ 代表正确鉴定，而备择假设 $H_i$ 代表不正确鉴定。这些特征分别是绝对前体质量误差 $\\varepsilon$、匹配碎片离子强度分数 $f$ 和匹配峰计数 $k$。\n\n分析框架由贝叶斯定理提供。对于二元假设空间 $\\{H_c, H_i\\}$，正确匹配的后验概率为：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{p(\\mathbf{x} \\mid H_c) P(H_c)}{p(\\mathbf{x})} $$\n分母 $p(\\mathbf{x})$ 是边缘似然或“证据”，通过全概率定律获得：\n$$ p(\\mathbf{x}) = p(\\mathbf{x} \\mid H_c) P(H_c) + p(\\mathbf{x} \\mid H_i) P(H_i) $$\n将此代入主方程，得到后验概率的完整表达式：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{p(\\mathbf{x} \\mid H_c) P(H_c)}{p(\\mathbf{x} \\mid H_c) P(H_c) + p(\\mathbf{x} \\mid H_i) P(H_i)} $$\n问题指定了先验概率为 $P(H_c) = 0.3$，因此 $P(H_i) = 1 - P(H_c) = 0.7$。\n\n一个核心假设是特征在给定假设下的条件独立性。这使得联合似然 $p(\\mathbf{x} \\mid H)$ 可以分解为各个似然的乘积：\n$$ p(\\mathbf{x} \\mid H) = p(\\varepsilon \\mid H) \\cdot p(f \\mid H) \\cdot p(k \\mid H) $$\n\n每个特征的似然函数由指定的参数分布建模：\n\n1.  **绝对质量误差 ($\\varepsilon \\ge 0$)**：似然由半正态分布建模，其概率密度函数 (PDF) 为 $p(x; \\sigma) = \\frac{\\sqrt{2}}{\\sigma\\sqrt{\\pi}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$，适用于 $x \\ge 0$。\n    - 对于 $H_c$ (正确)：$p(\\varepsilon \\mid H_c)$ 使用尺度参数 $\\sigma_c = 5 \\, \\mathrm{ppm}$。\n    - 对于 $H_i$ (不正确)：$p(\\varepsilon \\mid H_i)$ 使用尺度参数 $\\sigma_i = 50 \\, \\mathrm{ppm}$。\n\n2.  **强度分数 ($f \\in (0,1)$)**：似然由Beta分布建模，其PDF为 $p(x; \\alpha, \\beta) = \\frac{x^{\\alpha-1}(1-x)^{\\beta-1}}{B(\\alpha, \\beta)}$，其中 $B(\\alpha, \\beta)$ 是Beta函数。\n    - 对于 $H_c$：$p(f \\mid H_c)$ 使用形状参数 $(\\alpha_c, \\beta_c) = (5, 2)$。\n    - 对于 $H_i$：$p(f \\mid H_i)$ 使用形状参数 $(\\alpha_i, \\beta_i) = (1.5, 5)$。\n\n3.  **匹配峰计数 ($k \\in \\{0, 1, 2, \\dots\\}$)**：似然由泊松分布建模，其概率质量函数 (PMF) 为 $p(k; \\lambda) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$。\n    - 对于 $H_c$：$p(k \\mid H_c)$ 使用率参数 $\\lambda_c = 12$。\n    - 对于 $H_i$：$p(k \\mid H_i)$ 使用率参数 $\\lambda_i = 3$。\n\n为确保数值稳定性，计算应在对数空间中进行，以减轻因乘以多个小概率值而可能导致的下溢或上溢。假设 $H$ 的联合对数似然是各个对数似然的总和：\n$$ \\log p(\\mathbf{x} \\mid H) = \\log p(\\varepsilon \\mid H) + \\log p(f \\mid H) + \\log p(k \\mid H) $$\n令 $L_c = p(\\mathbf{x} \\mid H_c)$ 且 $L_i = p(\\mathbf{x} \\mid H_i)$。我们计算它们的对数 $\\log L_c$ 和 $\\log L_i$。\n\n后验概率的计算可以使用这些对数似然重新表述。令 $\\pi_c = P(H_c)$ 且 $\\pi_i = P(H_i)$。每个假设的未归一化对数后验概率为：\n$$ \\log P'_c = \\log L_c + \\log \\pi_c $$\n$$ \\log P'_i = \\log L_i + \\log \\pi_i $$\n后验概率 $P(H_c \\mid \\mathbf{x})$ 可以写为：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{\\exp(\\log P'_c)}{\\exp(\\log P'_c) + \\exp(\\log P'_i)} $$\n为了防止对可能非常大或非常小的数进行指数运算时出现数值不稳定性，此表达式被转换。我们定义对数后验几率比 $\\Lambda$：\n$$ \\Lambda = \\log\\left(\\frac{P'_c}{P'_i}\\right) = \\log P'_c - \\log P'_i $$\n那么，后验概率等价于 $\\Lambda$ 的logistic函数 (sigmoid)：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{1}{1 + \\exp(-\\Lambda)} $$\n这个公式在数值上是鲁棒的，并将用于实现。\n\n对于每个候选PSM $(\\varepsilon, f, k)$ 的算法如下：\n1.  计算正确假设 ($H_c$) 的对数似然：使用参数 $(\\sigma_c, \\alpha_c, \\beta_c, \\lambda_c)$ 计算 $\\log p(\\varepsilon \\mid H_c)$、$\\log p(f \\mid H_c)$ 和 $\\log p(k \\mid H_c)$。将它们相加得到 $\\log L_c$。\n2.  计算不正确假设 ($H_i$) 的对数似然：使用参数 $(\\sigma_i, \\alpha_i, \\beta_i, \\lambda_i)$ 计算 $\\log p(\\varepsilon \\mid H_i)$、$\\log p(f \\mid H_i)$ 和 $\\log p(k \\mid H_i)$。将它们相加得到 $\\log L_i$。\n3.  计算未归一化的对数后验概率：$\\log P'_c = \\log L_c + \\log(0.3)$ 和 $\\log P'_i = \\log L_i + \\log(0.7)$。\n4.  计算对数后验几率：$\\Lambda = \\log P'_c - \\log P'_i$。\n5.  计算最终后验概率：$P(H_c \\mid \\mathbf{x}) = (1 + \\exp(-\\Lambda))^{-1}$。\n\n此步骤将应用于六个指定的测试用例中的每一个。", "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Computes the posterior probability of a correct Peptide-Spectrum Match (PSM)\n    for a given set of observed features using a Bayesian scoring model.\n    \"\"\"\n\n    # --- Model Parameters ---\n\n    # Prior probabilities\n    prior_correct = 0.3\n    prior_incorrect = 1.0 - prior_correct\n\n    # Log-priors for numerical stability\n    log_prior_correct = np.log(prior_correct)\n    log_prior_incorrect = np.log(prior_incorrect)\n    \n    # 1. Mass Error (ε): Half-Normal distribution parameters (scale σ)\n    sigma_c = 5.0  # ppm, for correct matches\n    sigma_i = 50.0 # ppm, for incorrect matches\n\n    # 2. Intensity Fraction (f): Beta distribution parameters (α, β)\n    alpha_c, beta_c = 5.0, 2.0  # for correct matches\n    alpha_i, beta_i = 1.5, 5.0  # for incorrect matches\n\n    # 3. Matched Peak Count (k): Poisson distribution parameters (rate λ)\n    lambda_c = 12.0 # for correct matches\n    lambda_i = 3.0  # for incorrect matches\n    \n    # --- Test Suite ---\n    # Each PSM is defined by a tuple: (ε_ppm, f_fraction, k_count)\n    test_cases = [\n        (4.0, 0.65, 14),\n        (80.0, 0.12, 2),\n        (0.0, 0.90, 0),\n        (10.0, 0.40, 8),\n        (100.0, 0.60, 20),\n        (1.0, 0.05, 3),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        epsilon, f_fraction, k_count = case\n        \n        # --- Likelihood Calculation (in log-space) ---\n        \n        # Log-likelihood under the 'correct' hypothesis (H_c)\n        log_L_eps_c = stats.halfnorm.logpdf(epsilon, scale=sigma_c)\n        log_L_f_c = stats.beta.logpdf(f_fraction, a=alpha_c, b=beta_c)\n        log_L_k_c = stats.poisson.logpmf(k_count, mu=lambda_c)\n        total_log_likelihood_c = log_L_eps_c + log_L_f_c + log_L_k_c\n        \n        # Log-likelihood under the 'incorrect' hypothesis (H_i)\n        log_L_eps_i = stats.halfnorm.logpdf(epsilon, scale=sigma_i)\n        log_L_f_i = stats.beta.logpdf(f_fraction, a=alpha_i, b=beta_i)\n        log_L_k_i = stats.poisson.logpmf(k_count, mu=lambda_i)\n        total_log_likelihood_i = log_L_eps_i + log_L_f_i + log_L_k_i\n        \n        # --- Posterior Probability Calculation ---\n        \n        # Unnormalized log-posteriors\n        log_posterior_c = total_log_likelihood_c + log_prior_correct\n        log_posterior_i = total_log_likelihood_i + log_prior_incorrect\n        \n        # Log-posterior odds ratio\n        log_posterior_odds = log_posterior_c - log_posterior_i\n        \n        # Convert log-odds to probability using the logistic function\n        # p = 1 / (1 + exp(-log_odds))\n        posterior_prob_correct = 1.0 / (1.0 + np.exp(-log_posterior_odds))\n        \n        results.append(posterior_prob_correct)\n\n    # --- Format and Print Output ---\n    # The output must be a single line: a comma-separated list of probabilities\n    # in square brackets, with each value rounded to six decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3712617"}, {"introduction": "精确的定量是许多蛋白质组学实验的主要目标，但它常常受到仪器层面人为因素的干扰。本练习探讨“比率压缩”这一普遍存在于等量异位标签（如TMT）实验中的问题，它源于干扰肽段的共分离和共碎裂。通过从第一性原理推导观测到的定量比率模型 [@problem_id:3712571]，您将更深入地理解碰撞能量等实验参数如何影响定量准确性。", "problem": "在液相色谱-串联质谱 (LC-MS/MS) 平台上，使用高能碰撞解离 (HCD) 进行了一项采用串联质谱标签 (TMT) 的蛋白质组学实验。一个目标肽段和一个干扰肽段被共分离和共碎裂，产生同重报告离子，其测量强度与肽段的丰度、其电离/传输因子以及在给定碰撞能量下的报告离子形成（碎裂）效率成正比。假设以下基本依据：\n1. 由肽段贡献的报告离子强度与其丰度和依赖于碰撞能量的报告离子形成效率呈线性关系。\n2. 一个通道的观测报告离子强度是该通道中所有共分离肽段贡献的总和。\n3. 碎裂效率随碰撞能量的增加而增加，并遵循饱和指数形式。\n\n设两个通道之间目标肽段的真实丰度比（通道$2$相对于通道$1$）为 $r = \\frac{a_{T,2}}{a_{T,1}}$，干扰肽段的相应比率为 $s = \\frac{a_{I,2}}{a_{I,1}}$。设 $q = \\frac{\\eta_{I} a_{I,1}}{\\eta_{T} a_{T,1}}$ 为参数，表示通道$1$分离窗口中的相对干扰丰度，其中 $\\eta_{T}$ 和 $\\eta_{I}$ 分别是目标肽段和干扰肽段的恒定电离/传输因子。设目标肽段和干扰肽段的报告离子形成效率分别为 $\\phi_{T}(E) = 1 - \\exp(-\\beta_{T} E)$ 和 $\\phi_{I}(E) = 1 - \\exp(-\\beta_{I} E)$，其中 $E$ 是碰撞能量，$\\beta_{T}$、$\\beta_{I} > 0$ 是肽段特异性常数。\n\n仅从上述基本依据出发，推导观测报告比率 $R_{\\mathrm{obs}}(E)$（通道$2$与通道$1$之比）作为 $E$, $r$, $s$, $q$, $\\beta_{T}$ 和 $\\beta_{I}$ 的函数的符号化封闭形式表达式。然后，使用 $r = 5$，$s = 1$，$q = 0.4$，$\\beta_{T} = 0.08$ $\\mathrm{eV}^{-1}$，$\\beta_{I} = 0.12$ $\\mathrm{eV}^{-1}$，并在 $E_{0} = 30$ $\\mathrm{eV}$ 处进行计算，求出一阶灵敏度 $\\frac{d R_{\\mathrm{obs}}}{dE}\\big|_{E = E_{0}}$。用每电子伏特表示您的最终数值答案，并将答案四舍五入到四位有效数字。", "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n**步骤1：提取已知条件**\n-   **背景：** 采用串联质谱标签 (TMT) 的蛋白质组学实验，目标肽段 (T) 和干扰肽段 (I) 被共分离/共碎裂。\n-   **模型假设 (基本依据)：**\n    1.  报告离子强度与肽段丰度和依赖于碰撞能量的报告离子形成效率呈线性关系。\n    2.  观测到的报告离子强度是所有共分离肽段贡献的总和。\n    3.  碎裂效率的形式为 $\\phi(E) = 1 - \\exp(-\\beta E)$。\n-   **定义：**\n    -   目标肽段丰度比：$r = \\frac{a_{T,2}}{a_{T,1}}$\n    -   干扰肽段丰度比：$s = \\frac{a_{I,2}}{a_{I,1}}$\n    -   相对干扰参数：$q = \\frac{\\eta_{I} a_{I,1}}{\\eta_{T} a_{T,1}}$\n    -   电离/传输因子：$\\eta_{T}$，$\\eta_{I}$\n    -   目标肽段碎裂效率：$\\phi_{T}(E) = 1 - \\exp(-\\beta_{T} E)$\n    -   干扰肽段碎裂效率：$\\phi_{I}(E) = 1 - \\exp(-\\beta_{I} E)$\n-   **常数：**\n    -   $\\beta_{T} > 0$, $\\beta_{I} > 0$\n-   **任务：**\n    1.  推导观测报告比率 $R_{\\mathrm{obs}}(E)$ 的符号化封闭形式表达式。\n    2.  在 $E_0 = 30$ eV 处计算一阶灵敏度 $\\frac{d R_{\\mathrm{obs}}}{dE}$。\n-   **数值：**\n    -   $r = 5$\n    -   $s = 1$\n    -   $q = 0.4$\n    -   $\\beta_{T} = 0.08$ $\\mathrm{eV}^{-1}$\n    -   $\\beta_{I} = 0.12$ $\\mathrm{eV}^{-1}$\n    -   $E_{0} = 30$ $\\mathrm{eV}$\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题基于定量蛋白质组学中一个公认的问题（共分离导致的比例失真），并使用了简化但科学上合理的离子强度和碎裂模型。碎裂效率的饱和指数模型是此类过程的常规选择。\n-   **适定性：** 该问题是自洽的。它提供了推导所需表达式和计算数值所需的所有必要定义、函数形式和参数。所要求的解由给定条件唯一确定。\n-   **客观性：** 该问题以精确的技术语言陈述，没有主观或含糊的术语。\n\n该问题没有表现出说明中列出的任何缺陷（例如，科学上不健全、不完整、不切实际）。\n\n**步骤3：结论与行动**\n该问题被判定为**有效**。将提供解答。\n\n### 观测比率 $R_{\\mathrm{obs}}(E)$ 的推导\n\n设 $I_{j}(E)$ 为在碰撞能量 $E$ 下通道 $j \\in \\{1, 2\\}$ 中的总观测报告离子强度。根据问题陈述的基本依据，此强度是目标 (T) 和干扰 (I) 肽段贡献的总和。每个肽段的贡献与其丰度 $a$、其电离/传输因子 $\\eta$ 及其碎裂效率 $\\phi(E)$ 成正比。我们可以将强度写为：\n$$I_{1}(E) = C \\left( \\eta_{T} a_{T,1} \\phi_{T}(E) + \\eta_{I} a_{I,1} \\phi_{I}(E) \\right)$$\n$$I_{2}(E) = C \\left( \\eta_{T} a_{T,2} \\phi_{T}(E) + \\eta_{I} a_{I,2} \\phi_{I}(E) \\right)$$\n其中 $C$ 是一个与仪器响应相关的比例常数，它将在比率中被约掉。\n\n观测报告比率 $R_{\\mathrm{obs}}(E)$ 是通道 $2$ 与通道 $1$ 的强度之比：\n$$R_{\\mathrm{obs}}(E) = \\frac{I_{2}(E)}{I_{1}(E)} = \\frac{\\eta_{T} a_{T,2} \\phi_{T}(E) + \\eta_{I} a_{I,2} \\phi_{I}(E)}{\\eta_{T} a_{T,1} \\phi_{T}(E) + \\eta_{I} a_{I,1} \\phi_{I}(E)}$$\n我们使用给定的定义来重新参数化该表达式：\n$a_{T,2} = r \\cdot a_{T,1}$\n$a_{I,2} = s \\cdot a_{I,1}$\n$\\eta_{I} a_{I,1} = q \\cdot \\eta_{T} a_{T,1}$\n\n根据后两个定义，我们可以用基本量来表示 $\\eta_{I} a_{I,2}$：\n$\\eta_{I} a_{I,2} = \\eta_{I} (s \\cdot a_{I,1}) = s (\\eta_{I} a_{I,1}) = s (q \\cdot \\eta_{T} a_{T,1}) = sq \\cdot \\eta_{T} a_{T,1}$\n\n将这些代入 $R_{\\mathrm{obs}}(E)$ 的表达式中：\n$$R_{\\mathrm{obs}}(E) = \\frac{\\eta_{T} (r a_{T,1}) \\phi_{T}(E) + (sq \\cdot \\eta_{T} a_{T,1}) \\phi_{I}(E)}{\\eta_{T} a_{T,1} \\phi_{T}(E) + (q \\cdot \\eta_{T} a_{T,1}) \\phi_{I}(E)}$$\n分子和分母的公因子 $\\eta_{T} a_{T,1}$ 被约掉了：\n$$R_{\\mathrm{obs}}(E) = \\frac{r \\phi_{T}(E) + sq \\phi_{I}(E)}{\\phi_{T}(E) + q \\phi_{I}(E)}$$\n代入给定的效率函数形式 $\\phi_{T}(E) = 1 - \\exp(-\\beta_{T} E)$ 和 $\\phi_{I}(E) = 1 - \\exp(-\\beta_{I} E)$，得到最终的符号表达式：\n$$R_{\\mathrm{obs}}(E) = \\frac{r [1 - \\exp(-\\beta_{T} E)] + sq [1 - \\exp(-\\beta_{I} E)]}{[1 - \\exp(-\\beta_{T} E)] + q [1 - \\exp(-\\beta_{I} E)]}$$\n\n### 一阶灵敏度 $\\frac{d R_{\\mathrm{obs}}}{dE}$ 的推导\n\n为了求出灵敏度，我们对 $R_{\\mathrm{obs}}(E)$ 关于 $E$ 求导。设 $N(E) = r \\phi_{T}(E) + sq \\phi_{I}(E)$ 和 $D(E) = \\phi_{T}(E) + q \\phi_{I}(E)$。使用商法则，$\\frac{d}{dE}(\\frac{N}{D}) = \\frac{N'D - ND'}{D^2}$。\n\n首先，我们求效率的导数：\n$$\\phi'_{T}(E) = \\frac{d}{dE} [1 - \\exp(-\\beta_{T} E)] = \\beta_{T} \\exp(-\\beta_{T} E)$$\n$$\\phi'_{I}(E) = \\frac{d}{dE} [1 - \\exp(-\\beta_{I} E)] = \\beta_{I} \\exp(-\\beta_{I} E)$$\n分子和分母的导数是：\n$N'(E) = r \\phi'_{T}(E) + sq \\phi'_{I}(E)$\n$D'(E) = \\phi'_{T}(E) + q \\phi'_{I}(E)$\n\n$R_{\\mathrm{obs}}(E)$ 导数的分子是 $N'D - ND'$：\n$$N'D - ND' = [r \\phi'_{T} + sq \\phi'_{I}][\\phi_{T} + q \\phi_{I}] - [r \\phi_{T} + sq \\phi_{I}][\\phi'_{T} + q \\phi'_{I}]$$\n展开并合并同类项：\n$$= (r\\phi'_{T}\\phi_{T} + rq\\phi'_{T}\\phi_{I} + sq\\phi'_{I}\\phi_{T} + sq^2\\phi'_{I}\\phi_{I}) - (r\\phi_{T}\\phi'_{T} + rq\\phi_{T}\\phi'_{I} + sq\\phi_{I}\\phi'_{T} + sq^2\\phi_{I}\\phi'_{I})$$\n每个括号中的第一项和最后一项相互抵消（例如，$r\\phi'_{T}\\phi_{T} - r\\phi_{T}\\phi'_{T} = 0$）。我们剩下：\n$$= (rq\\phi'_{T}\\phi_{I} + sq\\phi'_{I}\\phi_{T}) - (rq\\phi_{T}\\phi'_{I} + sq\\phi_{I}\\phi'_{T})$$\n$$= rq(\\phi'_{T}\\phi_{I} - \\phi_{T}\\phi'_{I}) + sq(\\phi'_{I}\\phi_{T} - \\phi_{I}\\phi'_{T})$$\n$$= rq(\\phi'_{T}\\phi_{I} - \\phi_{T}\\phi'_{I}) - sq(\\phi'_{T}\\phi_{I} - \\phi_{T}\\phi'_{I})$$\n$$= q(r-s)[\\phi'_{T}(E)\\phi_{I}(E) - \\phi_{T}(E)\\phi'_{I}(E)]$$\n导数的完整表达式为：\n$$\\frac{d R_{\\mathrm{obs}}}{dE} = \\frac{q(r-s)[\\phi'_{T}(E)\\phi_{I}(E) - \\phi_{T}(E)\\phi'_{I}(E)]}{[\\phi_{T}(E) + q \\phi_{I}(E)]^2}$$\n\n### 数值计算\n\n我们使用给定的参数 $r = 5$，$s = 1$，$q = 0.4$，$\\beta_{T} = 0.08$ $\\mathrm{eV}^{-1}$，$\\beta_{I} = 0.12$ $\\mathrm{eV}^{-1}$，在 $E = E_{0} = 30$ eV 处计算导数的值。\n\n首先，在 $E_0=30$ 处计算指数项：\n$$\\beta_{T} E_{0} = 0.08 \\times 30 = 2.4$$\n$$\\beta_{I} E_{0} = 0.12 \\times 30 = 3.6$$\n$$\\exp(-\\beta_{T} E_{0}) = \\exp(-2.4)$$\n$$\\exp(-\\beta_{I} E_{0}) = \\exp(-3.6)$$\n\n接下来，在 $E_0 = 30$ 处计算 $\\phi_T$、$\\phi_I$、$\\phi'_T$ 和 $\\phi'_I$：\n$$\\phi_{T}(E_{0}) = 1 - \\exp(-2.4) \\approx 1 - 0.090718 = 0.909282$$\n$$\\phi_{I}(E_{0}) = 1 - \\exp(-3.6) \\approx 1 - 0.027324 = 0.972676$$\n$$\\phi'_{T}(E_{0}) = \\beta_{T} \\exp(-\\beta_{T} E_{0}) = 0.08 \\exp(-2.4) \\approx 0.08 \\times 0.090718 = 0.0072574$$\n$$\\phi'_{I}(E_{0}) = \\beta_{I} \\exp(-\\beta_{I} E_{0}) = 0.12 \\exp(-3.6) \\approx 0.12 \\times 0.027324 = 0.0032789$$\n\n现在，计算导数表达式的分子：\n$$N_{\\mathrm{deriv}} = q(r-s)[\\phi'_{T}(E_{0})\\phi_{I}(E_{0}) - \\phi_{T}(E_{0})\\phi'_{I}(E_{0})]$$\n$$N_{\\mathrm{deriv}} \\approx 0.4(5-1)[(0.0072574)(0.972676) - (0.909282)(0.0032789)]$$\n$$N_{\\mathrm{deriv}} \\approx 1.6[0.0070600 - 0.0029814] = 1.6[0.0040786] \\approx 0.00652576$$\n\n接下来，计算分母：\n$$D_{\\mathrm{deriv}} = [\\phi_{T}(E_{0}) + q \\phi_{I}(E_{0})]^2$$\n$$D_{\\mathrm{deriv}} \\approx [0.909282 + 0.4(0.972676)]^2$$\n$$D_{\\mathrm{deriv}} \\approx [0.909282 + 0.389070]^2 = [1.298352]^2 \\approx 1.685718$$\n\n最后，计算灵敏度：\n$$\\frac{d R_{\\mathrm{obs}}}{dE}\\bigg|_{E = E_{0}} = \\frac{N_{\\mathrm{deriv}}}{D_{\\mathrm{deriv}}} \\approx \\frac{0.00652576}{1.685718} \\approx 0.0038710$$\n\n将结果四舍五入到四位有效数字，得到 $0.003871$。在中间计算中使用更高的精度：\n$N_{\\mathrm{deriv}} = 1.6 \\times [0.08\\exp(-2.4)(1-\\exp(-3.6)) - 0.12\\exp(-3.6)(1-\\exp(-2.4))]$\n$= 1.6 \\times [0.08\\exp(-2.4) - 0.08\\exp(-6.0) - 0.12\\exp(-3.6) + 0.12\\exp(-6.0)]$\n$= 1.6 \\times [0.08\\exp(-2.4) - 0.12\\exp(-3.6) + 0.04\\exp(-6.0)]$\n$\\approx 1.6 \\times [0.007257436 - 0.003278847 + 0.000099150] = 1.6 \\times 0.004077739 \\approx 0.00652438$\n$D_{\\mathrm{deriv}} = [ (1-\\exp(-2.4)) + 0.4(1-\\exp(-3.6)) ]^2 \\approx [1.29835256]^2 \\approx 1.6857193$\n灵敏度 $\\approx \\frac{0.00652438}{1.6857193} \\approx 0.0038703$。\n四舍五入到四位有效数字，得到 $0.003870$。\n单位是 $\\mathrm{eV}^{-1}$，因为导数是关于以 $\\mathrm{eV}$ 为单位的能量求的。", "answer": "$$\\boxed{0.003870}$$", "id": "3712571"}]}