{"hands_on_practices": [{"introduction": "要掌握臭氧诱导解离（OzID）技术，第一步是精确预测关键诊断碎片的质荷比。本练习将引导你从基本原理出发，推导醛和克里奇（Criegee）中间体这两种核心产物的精确质量计算公式。通过这个实践，你将牢固掌握OzID分析的化学计量学基础，为后续更复杂的谱图解析奠定坚实的基础[@problem_id:3717469]。", "problem": "一个衍生自不饱和有机分子的阳离子经历臭氧诱导解离 (OzID)，其过程形式上表示为 $R_{1}\\text{-}CH=CH\\text{-}R_{2}^{+} \\xrightarrow{O_{3}} R_{1}\\text{-}CHO + R_{2}\\text{-}CHOO^{+}$。将 $R_{1}$ 和 $R_{2}$ 视为取代基部分，其中不包括两个 $\\text{sp}^{2}$ 双键碳原子及其氢原子；也就是说，在 $R_{1}$ 和 $R_{2}$ 中计数的原子不包括直接参与 $C=C$ 功能基团的 $CH$ 单元。假设元素组成仅限于碳、氢、氧，以及如果作为加合阳离子存在的钠。\n\n从质谱学中单一同位素精确质量是构成原子的单一同位素原子质量的总和，以及 $C=C$ 键的臭氧分解会切断该键产生一个醛 ($R_{1}\\text{-}CHO$) 和一个 Criegee 型离子 ($R_{2}\\text{-}CHOO^{+}$) 的定义出发，用 $R_{1}$ 和 $R_{2}$ 的原子数推导这两种产物碎片的元素组成，然后用符号表示它们的精确单一同位素质量。令 $n_{\\text{C}}(R_{i})$、$n_{\\text{H}}(R_{i})$ 和 $n_{\\text{O}}(R_{i})$ 分别表示 $R_{i}$ 中碳、氢和氧原子的数量，其中 $i \\in \\{1,2\\}$。令 $\\sigma \\in \\{0,1\\}$ 为一个指示符，表示 Criegee 碎片上的钠加合情况（如果一个钠原子加合到 $R_{2}\\text{-}CHOO^{+}$ 上，则 $\\sigma=1$，否则 $\\sigma=0$）。使用以下单一同位素质量：$m(\\text{C})=12.000000$，$m(\\text{H})=1.007825$，$m(\\text{O})=15.994915$ 和 $m(\\text{Na})=22.989770$。\n\n请以统一原子质量单位 (u) 表示两种碎片的质量，并以一对封闭形式的解析表达式给出最终结果。不需要进行数值取整。", "solution": "该问题要求推导由不饱和有机阳离子的臭氧诱导解离 (OzID) 产生的两种产物碎片的单一同位素精确质量的解析表达式。该过程由反应 $R_{1}\\text{-}CH=CH\\text{-}R_{2}^{+} \\xrightarrow{O_{3}} R_{1}\\text{-}CHO + R_{2}\\text{-}CHOO^{+}$ 定义。化学物种的质量计算为其构成原子的单一同位素质量之和。电子的质量被认为可以忽略不计，因此离子的质量与其相应的中性自由基的质量相等。\n\n首先，我们确定醛碎片 $R_{1}\\text{-}CHO$ 的元素组成。\n问题陈述 $R_{1}$ 是一个取代基部分，其元素组成由碳原子数 $n_{\\text{C}}(R_{1})$、氢原子数 $n_{\\text{H}}(R_{1})$ 和氧原子数 $n_{\\text{O}}(R_{1})$ 定义。从前体形成醛碎片 $R_{1}\\text{-}CHO$ 的过程涉及 $R_{1}$ 部分和原始乙烯基之一 $CH$，它与来自臭氧分子的一个氧原子结合。因此，此碎片中每种元素的总原子数是 $R_{1}$ 中的原子数与 $-CHO$ 基团中的原子数之和。\n$-CHO$ 基团贡献一个碳原子、一个氢原子和一个氧原子。\n因此，碎片 $R_{1}\\text{-}CHO$ 的元素组成为：\n碳原子数：$n_{\\text{C, frag1}} = n_{\\text{C}}(R_{1}) + 1$\n氢原子数：$n_{\\text{H, frag1}} = n_{\\text{H}}(R_{1}) + 1$\n氧原子数：$n_{\\text{O, frag1}} = n_{\\text{O}}(R_{1}) + 1$\n\n醛碎片的单一同位素质量，记为 $m(R_{1}\\text{-}CHO)$，是其构成原子的质量总和。使用提供的符号质量 $m(\\text{C})$、$m(\\text{H})$ 和 $m(\\text{O})$：\n$m(R_{1}\\text{-}CHO) = (n_{\\text{C}}(R_{1}) + 1) m(\\text{C}) + (n_{\\text{H}}(R_{1}) + 1) m(\\text{H}) + (n_{\\text{O}}(R_{1}) + 1) m(\\text{O})$\n代入给定的单一同位素质量数值：\n$m(\\text{C}) = 12.000000$ u\n$m(\\text{H}) = 1.007825$ u\n$m(\\text{O}) = 15.994915$ u\n第一个碎片的质量表达式为：\n$m(R_{1}\\text{-}CHO) = (n_{\\text{C}}(R_{1}) + 1) \\cdot 12.000000 + (n_{\\text{H}}(R_{1}) + 1) \\cdot 1.007825 + (n_{\\text{O}}(R_{1}) + 1) \\cdot 15.994915$\n\n接下来，我们确定 Criegee 型离子碎片 $R_{2}\\text{-}CHOO^{+}$ 的元素组成。\n该碎片由 $R_{2}$ 部分、另一个乙烯基 $CH$ 以及来自臭氧分子的剩余两个氧原子组成。其元素组成由 $R_{2}$ 部分的原子数 $n_{\\text{C}}(R_{2})$、$n_{\\text{H}}(R_{2})$ 和 $n_{\\text{O}}(R_{2})$ 加上来自 $-CHOO$ 基团的原子来定义。\n$-CHOO$ 基团贡献一个碳原子、一个氢原子和两个氧原子。\n此外，问题陈述该碎片可能与一个钠原子加合，由变量 $\\sigma \\in \\{0,1\\}$ 指示，其中 $\\sigma=1$ 表示存在一个钠原子，$\\sigma=0$ 表示不存在。\n因此，碎片 $R_{2}\\text-CHOO^{+}$（可能被钠化）的元素组成为：\n碳原子数：$n_{\\text{C, frag2}} = n_{\\text{C}}(R_{2}) + 1$\n氢原子数：$n_{\\text{H, frag2}} = n_{\\text{H}}(R_{2}) + 1$\n氧原子数：$n_{\\text{O, frag2}} = n_{\\text{O}}(R_{2}) + 2$\n钠原子数：$n_{\\text{Na, frag2}} = \\sigma$\n\n这个 Criegee 型离子的单一同位素质量，记为 $m(R_{2}\\text{-}CHOO^{+})$，是其构成原子的质量总和，如果存在钠，则包括钠。使用符号质量 $m(\\text{C})$、$m(\\text{H})$、$m(\\text{O})$ 和 $m(\\text{Na})$：\n$m(R_{2}\\text{-}CHOO^{+}) = (n_{\\text{C}}(R_{2}) + 1) m(\\text{C}) + (n_{\\text{H}}(R_{2}) + 1) m(\\text{H}) + (n_{\\text{O}}(R_{2}) + 2) m(\\text{O}) + \\sigma \\cdot m(\\text{Na})$\n代入给定的单一同位素质量数值，包括 $m(\\text{Na}) = 22.989770$ u：\n第二个碎片的质量表达式为：\n$m(R_{2}\\text{-}CHOO^{+}) = (n_{\\text{C}}(R_{2}) + 1) \\cdot 12.000000 + (n_{\\text{H}}(R_{2}) + 1) \\cdot 1.007825 + (n_{\\text{O}}(R_{2}) + 2) \\cdot 15.994915 + \\sigma \\cdot 22.989770$\n\n这两个推导出的表达式代表了两种产物碎片的精确单一同位素质量的封闭形式解析公式。", "answer": "$$\\boxed{\\begin{aligned} m(R_{1}\\text{-}CHO) = (n_{\\text{C}}(R_{1}) + 1) \\cdot 12.000000 + (n_{\\text{H}}(R_{1}) + 1) \\cdot 1.007825 + (n_{\\text{O}}(R_{1}) + 1) \\cdot 15.994915 \\\\ m(R_{2}\\text{-}CHOO^{+}) = (n_{\\text{C}}(R_{2}) + 1) \\cdot 12.000000 + (n_{\\text{H}}(R_{2}) + 1) \\cdot 1.007825 + (n_{\\text{O}}(R_{2}) + 2) \\cdot 15.994915 + \\sigma \\cdot 22.989770 \\end{aligned}}$$", "id": "3717469"}, {"introduction": "在理解了如何计算碎片质量后，一个更深入的问题是：分子断裂时，电荷会保留在哪一个碎片上？本练习将理论与实验联系起来，介绍质谱分析中的“动力学方法”，它将可观测的离子强度与质子亲和能等基本热力学性质关联起来。你将推导出一个定量关系式，并利用真实的实验数据来计算一个“有效温度”，从而深刻理解控制电荷分配的物理化学原理[@problem_id:3717443]。", "problem": "一个在质谱（MS）中经历臭氧诱导解离（OzID）的单质子化类脂阳离子在碳-碳双键处断裂，产生两个互补的离子碎片，记为碎片 $A$ 和碎片 $B$。它们唯一的区别在于哪一侧保留了电荷。假设电荷保留的结果由臭氧分解和断裂后两个电荷局域化最小值之间的准平衡所决定，每个碎片上保留电荷的相对概率由它们的气相质子亲和能和构型简并度决定。使用以下符合情境的基础：\n\n- 正则系综的玻尔兹曼分布：在温度 $T$ 下，占据摩尔能量为 $E$ 的一个状态的概率与 $\\exp(-E/(R T))$ 成正比，其中 $R$ 是理想气体常数。\n- 气相质子亲和能 $\\mathrm{PA}$ 是在 $298\\,\\mathrm{K}$ 下质子化反应摩尔焓变的负值，即，更高的 $\\mathrm{PA}$ 表示质子化态的能量更低。\n- 在 OzID 中，碎片强度反映了在测量条件下每个碎片上保留电荷的概率，其比例关系由能够稳定电荷的等效微观态数量（简并因子）来解释。\n\n设碎片 $A$ 和碎片 $B$ 的列表质子亲和能分别为 $\\mathrm{PA}_A = 945 \\ \\mathrm{kJ/mol}$ 和 $\\mathrm{PA}_B = 920 \\ \\mathrm{kJ/mol}$。假设简并因子为 $g_A = 1$ 和 $g_B = 1$。一个实验性的 OzID 谱图显示，报告双键断裂处电荷保留情况的两个互补离子的强度比为 $I_A:I_B = 7.1:1.0$。设在电荷分配过程中，被激发离子群的有效内能温度为 $T_{\\mathrm{eff}}$，并在正则近似下处理。\n\n从所述基础出发，不使用任何快捷公式，推导一个能从 $\\mathrm{PA}_A$、$\\mathrm{PA}_B$、$g_A$、$g_B$、$R$ 和 $T_{\\mathrm{eff}}$ 预测比率 $I_A/I_B$ 的定量准则，然后使用测得的 $I_A/I_B$ 求解 $T_{\\mathrm{eff}}$。使用 $R = 8.314462618 \\ \\mathrm{J\\,mol^{-1}\\,K^{-1}}$。将最终的 $T_{\\mathrm{eff}}$ 以开尔文为单位表示，并四舍五入到四位有效数字。", "solution": "题目陈述已经过验证，被认为是科学上合理、问题明确且内部一致的。它提供了推导所要求的定量准则并随后求解有效温度 $T_{\\mathrm{eff}}$ 所需的所有必要信息。\n\n该问题描述了一个体系，其中一个前体离子裂解成两个产物通道。产物的相对丰度（通过强度比 $I_A/I_B$ 测量）由最终状态的准平衡分布决定。其基础是玻尔兹曼分布，该分布将状态的概率与其能量联系起来。\n\n设两个竞争的产物态分别是带电碎片 $A$ 的形成（记为状态 $S_A$）和带电碎片 $B$ 的形成（记为状态 $S_B$）。这两个状态的摩尔能量分别为 $E_A$ 和 $E_B$。问题指明，该体系可以被视为一个处于有效温度 $T_{\\mathrm{eff}}$ 的正则系综。体系处于摩尔能量为 $E_i$、简并度为 $g_i$ 的状态 $S_i$ 的概率 $P_i$ 由玻尔兹曼分布给出：\n$$\nP_i \\propto g_i \\exp\\left(-\\frac{E_i}{RT_{\\mathrm{eff}}}\\right)\n$$\n此处，$R$ 是理想气体常数。一个碎片离子的测量强度 $I_i$ 与其形成的概率成正比。因此，碎片 $A$ 和 $B$ 的强度比等于它们形成概率的比：\n$$\n\\frac{I_A}{I_B} = \\frac{P_A}{P_B} = \\frac{g_A \\exp\\left(-\\frac{E_A}{RT_{\\mathrm{eff}}}\\right)}{g_B \\exp\\left(-\\frac{E_B}{RT_{\\mathrm{eff}}}\\right)}\n$$\n该表达式可简化为：\n$$\n\\frac{I_A}{I_B} = \\frac{g_A}{g_B} \\exp\\left(-\\frac{E_A - E_B}{RT_{\\mathrm{eff}}}\\right) = \\frac{g_A}{g_B} \\exp\\left(-\\frac{\\Delta E}{RT_{\\mathrm{eff}}}\\right)\n$$\n其中 $\\Delta E = E_A - E_B$ 是两个最终状态之间的摩尔能量差。\n\n下一步是将这个能量差 $\\Delta E$ 与给定的质子亲和能 $\\mathrm{PA}_A$ 和 $\\mathrm{PA}_B$ 联系起来。质子亲和能（$\\mathrm{PA}$）被定义为在 $298\\,\\mathrm{K}$ 下气相质子化反应摩尔焓变的负值。更高的 $\\mathrm{PA}$ 意味着质子化的物种更稳定（能量更低）。\n设中性碎片记为 $F_A$ 和 $F_B$。两个产物态 $S_A$ 和 $S_B$ 分别对应于碎片对 $\\{F_A H^+, F_B\\}$ 和 $\\{F_A, F_B H^+\\}$。假设一个状态的能量 $E$ 可以用其焓 $H$ 来近似，则这两个状态的能量为：\n$E_A = H(F_A H^+) + H(F_B)$\n$E_B = H(F_A) + H(F_B H^+)$\n\n能量差为 $\\Delta E = E_A - E_B = \\left(H(F_A H^+) + H(F_B)\\right) - \\left(H(F_A) + H(F_B H^+)\\right)$。\n根据定义，质子亲和能为 $\\mathrm{PA}(F) = -\\Delta H_{\\mathrm{protonation}} = H(F) + H(H^+) - H(F H^+)$。重新整理这个式子，我们得到 $H(F H^+) = H(F) + H(H^+) - \\mathrm{PA}(F)$。将此代入 $E_A$ 和 $E_B$ 的表达式中：\n$E_A = (H(F_A) + H(H^+) - \\mathrm{PA}_A) + H(F_B)$\n$E_B = H(F_A) + (H(F_B) + H(H^+) - \\mathrm{PA}_B)$\n因此，能量差 $\\Delta E$ 为：\n$$\n\\Delta E = E_A - E_B = (H(F_A) + H(F_B) + H(H^+) - \\mathrm{PA}_A) - (H(F_A) + H(F_B) + H(H^+) - \\mathrm{PA}_B)\n$$\n$$\n\\Delta E = \\mathrm{PA}_B - \\mathrm{PA}_A = -(\\mathrm{PA}_A - \\mathrm{PA}_B)\n$$\n这证实了产物通道的能量差与碎片的质子亲和能差之间的关系。\n\n将 $\\Delta E$ 的这个结果代入强度比方程，得到所求的定量准则：\n$$\n\\frac{I_A}{I_B} = \\frac{g_A}{g_B} \\exp\\left(-\\frac{-(\\mathrm{PA}_A - \\mathrm{PA}_B)}{RT_{\\mathrm{eff}}}\\right) = \\frac{g_A}{g_B} \\exp\\left(\\frac{\\mathrm{PA}_A - \\mathrm{PA}_B}{RT_{\\mathrm{eff}}}\\right)\n$$\n这个方程是质谱学中用于测定热化学数据的“动力学方法”方程的一种形式。\n\n为了求解有效温度 $T_{\\mathrm{eff}}$，我们重新整理这个方程。首先，对两边取自然对数：\n$$\n\\ln\\left(\\frac{I_A}{I_B}\\right) = \\ln\\left(\\frac{g_A}{g_B}\\right) + \\frac{\\mathrm{PA}_A - \\mathrm{PA}_B}{RT_{\\mathrm{eff}}}\n$$\n分离出含有 $T_{\\mathrm{eff}}$ 的项：\n$$\n\\frac{\\mathrm{PA}_A - \\mathrm{PA}_B}{RT_{\\mathrm{eff}}} = \\ln\\left(\\frac{I_A}{I_B}\\right) - \\ln\\left(\\frac{g_A}{g_B}\\right) = \\ln\\left(\\frac{I_A/I_B}{g_A/g_B}\\right) = \\ln\\left(\\frac{I_A g_B}{I_B g_A}\\right)\n$$\n最后，求解 $T_{\\mathrm{eff}}$：\n$$\nT_{\\mathrm{eff}} = \\frac{\\mathrm{PA}_A - \\mathrm{PA}_B}{R \\ln\\left(\\frac{I_A g_B}{I_B g_A}\\right)}\n$$\n现在，我们将给定的数值代入这个表达式。\n给定值为：\n$\\mathrm{PA}_A = 945 \\ \\mathrm{kJ/mol}$\n$\\mathrm{PA}_B = 920 \\ \\mathrm{kJ/mol}$\n$I_A/I_B = 7.1$\n$g_A = 1$\n$g_B = 1$\n$R = 8.314462618 \\ \\mathrm{J\\,mol^{-1}\\,K^{-1}}$\n\n质子亲和能的差值单位必须与 $R$ 一致，因此我们从 $\\mathrm{kJ/mol}$ 转换为 $\\mathrm{J/mol}$：\n$\\mathrm{PA}_A - \\mathrm{PA}_B = (945 - 920) \\ \\mathrm{kJ/mol} = 25 \\ \\mathrm{kJ/mol} = 25000 \\ \\mathrm{J/mol}$。\n简并度之比为 $g_A/g_B = 1/1 = 1$。强度比为 $I_A/I_B = 7.1$。\n\n将这些值代入 $T_{\\mathrm{eff}}$ 的方程中：\n$$\nT_{\\mathrm{eff}} = \\frac{25000 \\ \\mathrm{J\\,mol^{-1}}}{ (8.314462618 \\ \\mathrm{J\\,mol^{-1}\\,K^{-1}}) \\times \\ln\\left(\\frac{7.1 \\times 1}{1 \\times 1}\\right)}\n$$\n$$\nT_{\\mathrm{eff}} = \\frac{25000}{8.314462618 \\times \\ln(7.1)} \\ \\mathrm{K}\n$$\n计算数值：\n$\\ln(7.1) \\approx 1.9600949$\n$$\nT_{\\mathrm{eff}} \\approx \\frac{25000}{8.314462618 \\times 1.9600949} \\ \\mathrm{K}\n$$\n$$\nT_{\\mathrm{eff}} \\approx \\frac{25000}{16.29745} \\ \\mathrm{K} \\approx 1533.9836 \\ \\mathrm{K}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nT_{\\mathrm{eff}} \\approx 1534 \\ \\mathrm{K}\n$$\n这个值代表了在电荷分配的瞬间，离子群的有效内能温度，假设体系遵循所假定的正则系综统计。", "answer": "$$\n\\boxed{1534}\n$$", "id": "3717443"}, {"introduction": "最后的这项实践将理论知识转化为强大的分析工具，从手动计算迈向自动化数据解析。你将设计一个计算流程，该流程能系统地为给定脂质的所有可能双键位置生成OzID碎片，并根据实验观测到的质谱峰对其进行评分，最终确定最可能的双键位置。这个练习模拟了现代质谱学家的真实工作流程，展示了如何将化学原理编写为实用的数据驱动算法，以解决复杂的结构鉴定问题[@problem_id:3717389]。", "problem": "您的任务是设计并实现一个计算程序，该程序基于单质子化单不饱和烃链的臭氧诱导解离，为每个候选双键位置枚举所有可能的诊断产物离子对，并根据一组观测到的质荷比值，按合理性对这些位置进行排序。该程序应使用一个明确定义的评分函数，为每个测试用例选择最合理的双键位置。\n\n使用的基本依据是以下一组被广泛接受且经过充分检验的定义和事实：\n- 在高分辨率质谱分析中，质荷比的计算方法是单同位素中性质量加上电荷载体质量，再除以电荷数。对于单质子化离子，这实际上就是中性质量加上一个质子的质量。\n- 烯烃的臭氧诱导解离会裂解双键，产生互补的碎片，这些碎片对于双键定位具有诊断意义。对于在两个碳原子之间有一个双键的单不饱和烃链，裂解的每一侧都可以产生一个醛碎片和一个羰基氧化物碎片（称为Criegee中间体）。在一侧具有相同碳计数的这两个离子形成一个诊断对，其质量相差一个氧原子。\n- 包含$s$个碳原子的线性饱和烃链段的化学计量是$C_s H_{2s+2}$，而相应的饱和醛是$C_s H_{2s} O$。对于源自$s$个碳原子的烷基链段的羰基氧化物（Criegee），其中性化学计量是$C_s H_{2s} O_2$。对于单质子化离子，将质子的质量加到中性质量上。\n- 使用以下单同位素质量（单位为道尔顿）：碳 $m_C = 12.000000$，氢 $m_H = 1.007825$，氧 $m_O = 15.994915$，质子 $m_{H^+} = 1.007276$。\n- 来自裂解一侧的预期诊断对的质量差为一个氧原子，即大约为 $m_O$。\n\n模型和计算要求：\n1. 考虑一个具有$N$个碳原子的线性单不饱和烃链。候选双键位置被索引为整数 $p \\in \\{1,2,\\dots,N-1\\}$，表示在第$p$个和第$(p+1)$个碳原子之间发生裂解。对于每个$p$，定义两个侧链长度 $s_1 = p$ 和 $s_2 = N-p$。\n2. 对于一个侧链长度$s$，计算来自该侧的单质子化醛和Criegee产物离子的预期质荷比值（单位为道尔顿/基本电荷）。醛离子对应于中性分子式 $C_s H_{2s} O$，Criegee离子对应于 $C_s H_{2s} O_2$。作为单质子化离子，它们的$m/z$值分别是各自的中性质量加上$m_{H^+}$。\n3. 对于给定的$p$，预期的诊断离子集是来自$s_1$和$s_2$的两对离子的并集。如果$s_1 = s_2$，则仅使用唯一的质量值以避免重复计数。\n4. 评分和排序：给定观测到的峰 $\\{y_i\\}$ 和一个非负质量容差 $\\tau$（单位为道尔頓），对于每个预期的$m/z$值$x$，定义最小绝对偏差 $\\delta = \\min_i |y_i - x|$。此预期离子对分数的贡献为 $w = \\max(0, 1 - \\delta/\\tau)$（如果 $\\delta \\le \\tau$），否则 $w = 0$。$p$的分数是该$p$的所有预期离子的$w$的平均值（即，贡献总和除以预期离子的数量）。按分数降序对所有$p$进行排序，若分数相同则选择最小的$p$。如果最高分等于$0$，则返回$-1$，表示在容差范围内观测数据不支持任何合理的位置。\n5. 单位：所有$m/z$值和容差的单位均为道尔顿。不涉及角度。不使用百分比。\n6. 实现：您的程序必须实现此模型和评分方法，为每个测试用例选择最合理的双键位置，结果为一个整数（如果无法确定则为$-1$）。\n\n测试套件：\n使用以下测试用例，每个用例由 $(N, \\tau, \\text{观测峰})$ 指定，其中观测峰是以道尔顿为单位的$m/z$值列表：\n- 案例1（具有对称对的中心双键）：\n  - $N = 18$\n  - $\\tau = 0.01$\n  - 观测峰：$\\left[143.146541,\\;159.133956,\\;100.000000,\\;200.500000\\right]$\n- 案例2（非对称情况，其中一对峰强烈存在）：\n  - $N = 20$\n  - $\\tau = 0.01$\n  - 观测峰：$\\left[213.227291,\\;229.214206,\\;150.000000\\right]$\n- 案例3（靠近末端位置的边界情况）：\n  - $N = 16$\n  - $\\tau = 0.02$\n  - 观测峰：$\\left[31.022841,\\;47.020756,\\;80.000000,\\;200.000000\\right]$\n- 案例4（没有观测峰的边缘情况）：\n  - $N = 22$\n  - $\\tau = 0.01$\n  - 观测峰：$\\left[\\;\\right]$ (空列表)\n\n最终输出规范：\n您的程序应生成单行输出，其中包含所有四个测试用例选出的最合理位置，按上述测试用例的顺序，以逗号分隔的列表形式包含在方括号中。例如，如果选定的位置是 $p_1, p_2, p_3, p_4$，程序必须精确打印 $\\left[\\text{p}_1,\\text{p}_2,\\text{p}_3,\\text{p}_4\\right]$。", "solution": "该问题要求开发一种计算方法，以确定单不饱和线性烃链中双键的位置。这是通过模拟臭氧诱导解离（OzID）产生的碎片的质谱分析，并根据一组观测到的质荷比（$m/z$）值对潜在的双键位置进行评分来实现的。该解决方案必须基于所提供的化学原理，并遵循特定的计算模型。\n\n逻辑步骤如下：\n1.  **系统性生成假说**：对于具有$N$个碳原子的线性烃链，双键可以存在于碳$p$和碳$p+1$之间，其中位置$p$的范围可以从$1$到$N-1$。每个$p$的整数值代表一个关于双键位置的独立假说。\n\n2.  **预测可观测特征**：根据臭氧诱导解离的原理，位于位置$p$的双键将分子裂解为两个碎片。包含碳$1$到$p$的碎片长度为$s_1 = p$，互补碎片的长度为$s_2 = N-p$。对于每个长度为$s$的碎片，预期会形成两种诊断产物离子：一个单质子化的醛和一个单质子化的Criegee中间体（羰基氧化物）。\n    中性醛碎片的单同位素质量，化学计量为 $C_s H_{2s} O$，计算如下：\n    $$M_{ald}(s) = s \\cdot m_C + 2s \\cdot m_H + 1 \\cdot m_O$$\n    中性Criegee碎片的单同位素质量，化学计量为 $C_s H_{2s} O_2$，为：\n    $$M_{cri}(s) = s \\cdot m_C + 2s \\cdot m_H + 2 \\cdot m_O$$\n    其中 $m_C = 12.000000$ Da，$m_H = 1.007825$ Da 和 $m_O = 15.994915$ Da 分别是碳、氢和氧的单同位素质量。\n    由于问题指定为单质子化离子（$z=1$），它们的质荷比是通过将质子质量 $m_{H^+} = 1.007276$ Da 加到中性质量上来计算的：\n    $$ m/z_{ald}(s) = M_{ald}(s) + m_{H^+} $$\n    $$ m/z_{cri}(s) = M_{cri}(s) + m_{H^+} $$\n    对于给定的双键位置$p$，预期的诊断$m/z$值集合$E_p$是来自两个碎片的离子对的并集：\n    $$ E_p = \\{m/z_{ald}(s_1), m/z_{cri}(s_1)\\} \\cup \\{m/z_{ald}(s_2), m/z_{cri}(s_2)\\} $$\n    如果裂解是对称的（$s_1 = s_2$），此集合包含两个唯一的$m/z$值；否则，它包含四个。\n\n3.  **假说的定量评估**：通过将其预期的$m/z$值集合$E_p$与实验观测到的$m/z$值列表$\\{y_i\\}$进行比较，来评估每个假说$p$。定义一个评分函数来量化“拟合优度”。对于每个预期的$m/z$值$x \\in E_p$，我们找到其与观测峰的最小绝对偏差：\n    $$ \\delta(x) = \\min_{i} |y_i - x| $$\n    根据此偏差相对于给定质量容差$\\tau$来分配一个权重$w(x)$。该权重使用线性评分函数计算：\n    $$ w(x) = \\begin{cases} 1 - \\frac{\\delta(x)}{\\tau}  \\text{if } \\delta(x) \\le \\tau \\\\ 0  \\text{if } \\delta(x)  \\tau \\end{cases} $$\n    该函数为完美匹配（$\\delta=0$）分配权重1，随着偏差接近容差$\\tau$，权重线性减小到0。任何在容差窗口内没有观测对应物的预期峰的权重为0。\n    假说$p$的总分$S(p)$是其集合$E_p$中所有预期离子的权重的算术平均值：\n    $$ S(p) = \\frac{1}{|E_p|} \\sum_{x \\in E_p} w(x) $$\n\n4.  **选择最合理的假说**：在为所有可能的位置 $p \\in \\{1, \\dots, N-1\\}$ 计算得分$S(p)$后，按得分降序对这些位置进行排序。得分的任何平局都通过选择具有较小$p$值的位置来解决。排名最高的位置被选为双键最合理的位置。\n    一个特殊条件是强制性的：如果在所有位置中获得的最高分是$0$，这意味着在给定的容差内，实验数据不支持任何假說。在这种情况下，返回一个值$-1$来表示不存在合理的解决方案。\n\n5.  **算法实现**：该逻辑通过Python程序实现。一个函数 `calculate_fragment_mz(s)` 计算大小为$s$的碎片的两个预期$m/z$值。第二个函数 `solve_case` 遍历所有可能的位置$p$，计算预期离子集$E_p$，并使用定义的评分规则与观测峰进行比较来计算得分$S(p)$。这个主函数跟踪迄今为止找到的最佳分数和相应的位置，同时遵守平局决胜规则。最后，它检查最佳分数是否为零，以便在必要时返回$-1$。程序处理提供的每个测试用例，并将最终结果格式化为单个逗号分隔的列表。Numpy被用于高效的数值计算，特别是在寻找最小偏差$\\delta$时。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results according to the problem specification.\n    \"\"\"\n    \n    # Define the monoisotopic masses and proton mass as global constants.\n    M_C = 12.000000  # Daltons\n    M_H = 1.007825  # Daltons\n    M_O = 15.994915  # Daltons\n    M_H_PLUS = 1.007276  # Daltons\n\n    def calculate_fragment_mz(s: int):\n        \"\"\"\n        Calculates the m/z values for the singly protonated aldehyde and \n        Criegee intermediate for a fragment of size s.\n\n        Args:\n            s (int): The number of carbon atoms in the fragment.\n\n        Returns:\n            tuple[float, float]: A tuple containing the m/z of the aldehyde and Criegee ions.\n        \"\"\"\n        # Calculate neutral mass for C_s H_{2s} O (aldehyde)\n        neutral_mass_aldehyde = s * M_C + 2 * s * M_H + M_O\n        # Calculate neutral mass for C_s H_{2s} O_2 (Criegee)\n        neutral_mass_criegee = s * M_C + 2 * s * M_H + 2 * M_O\n        \n        # Add proton mass for singly protonated ions\n        mz_aldehyde = neutral_mass_aldehyde + M_H_PLUS\n        mz_criegee = neutral_mass_criegee + M_H_PLUS\n        \n        return mz_aldehyde, mz_criegee\n\n    def solve_case(N: int, tau: float, observed_peaks: list[float]):\n        \"\"\"\n        Solves for the most plausible double bond position for a single test case.\n\n        Args:\n            N (int): Total number of carbon atoms in the chain.\n            tau (float): Non-negative mass tolerance in Daltons.\n            observed_peaks (list[float]): A list of observed m/z values.\n\n        Returns:\n            int: The most plausible double bond position p, or -1 if no plausible position is found.\n        \"\"\"\n        best_p = -1\n        best_score = -1.0 # Initialize with a value lower than any possible score\n\n        # Convert observed_peaks to a numpy array for efficient computation.\n        # If the list is empty, handle it to avoid errors.\n        if observed_peaks:\n            observed_peaks_np = np.array(observed_peaks)\n        else:\n            observed_peaks_np = np.array([])\n            \n        # Iterate through all possible double bond positions p\n        for p in range(1, N):\n            s1 = p\n            s2 = N - p\n            \n            # Generate the set of expected m/z values to handle symmetric cases automatically.\n            mz_ald1, mz_cri1 = calculate_fragment_mz(s1)\n            mz_ald2, mz_cri2 = calculate_fragment_mz(s2)\n            expected_mzs = sorted(list(set([mz_ald1, mz_cri1, mz_ald2, mz_cri2])))\n            \n            total_weight = 0.0\n            \n            # If no peaks are observed, score is 0.\n            if observed_peaks_np.size > 0:\n                for x in expected_mzs:\n                    # Calculate the minimal absolute deviation delta\n                    delta = np.min(np.abs(observed_peaks_np - x))\n                    \n                    # Calculate weight if deviation is within tolerance\n                    if delta = tau:\n                        weight = 1.0 - delta / tau\n                        total_weight += weight\n            \n            # The score for position p is the average of the weights.\n            current_score = total_weight / len(expected_mzs)\n\n            # Update best score and position.\n            # The tie-breaking rule (smallest p) is handled by iterating p\n            # in ascending order and only updating on strictly greater scores.\n            if current_score > best_score:\n                best_score = current_score\n                best_p = p\n\n        # If the highest score is 0, return -1.\n        # Use np.isclose for robust floating point comparison.\n        if np.isclose(best_score, 0.0):\n            return -1\n        else:\n            return best_p\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (18, 0.01, [143.146541, 159.133956, 100.000000, 200.500000]),\n        (20, 0.01, [213.227291, 229.214206, 150.000000]),\n        (16, 0.02, [31.022841, 47.020756, 80.000000, 200.000000]),\n        (22, 0.01, [])\n    ]\n\n    results = []\n    for N, tau, observed_peaks in test_cases:\n        result = solve_case(N, tau, observed_peaks)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3717389"}]}