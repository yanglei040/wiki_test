{"hands_on_practices": [{"introduction": "高分辨率质谱分析的基石是精确质量的概念，它与仅代表整数质量数的标称质量截然不同。精确的质荷比（$m/z$）测量能够区分具有相同标称质量但不同元素组成的离子。这项练习 [@problem_id:3703528] 将引导你从基本原理出发，精确计算几种常见烷烃碎片的 $m/z$ 值，这是解读高分辨率质谱数据的必备基础技能。", "problem": "在电子电离（EI）质谱（MS）中，离子的质荷比$m/z$定义为其精确质量与其电荷态的比值。对于源自烷烃和环烷烃的烃类碎片离子，观测到的阳离子通常是通过$\\sigma$键断裂和重排形成的碳正离子，以及通过开环或侧链断裂形成的烯丙基阳离子。使用以下基本事实来推导和评估精确质量：\n- 碳-12的精确（单一同位素）原子质量为$12.000000000$原子质量单位。\n- 氢-1的精确（单一同位素）原子质量为$1.00782503223$原子质量单位。\n- 电子的质量为$0.000548579909$原子质量单位。\n- 原子质量是针对中性原子的；电荷为$+1$的离子比其相应的中性原子团少一个电子。\n\n从上述定义出发，首先通过明确考虑电子的移除，推导出单电荷阳离子$\\mathrm{C}_n\\mathrm{H}_m^{+}$的精确质量表达式。然后，应用您的表达式计算碎片离子$\\mathrm{C}_3\\mathrm{H}_7^{+}$、$\\mathrm{C}_3\\mathrm{H}_5^{+}$、$\\mathrm{C}_4\\mathrm{H}_9^{+}$和$\\mathrm{C}_4\\mathrm{H}_7^{+}$的精确$m/z$值（无量纲）。将每个报告的$m/z$值四舍五入到四位有效数字。将您的最终数值结果按所列顺序以单行矩阵的形式提供，并且在最终的方框答案中不要包含单位。", "solution": "该问题陈述经评估有效。它具有科学依据，提法得当，客观，并包含获得唯一解所需的所有必要信息。它要求严格应用质谱学中质量和质荷比的基本定义。\n\n主要任务是首先推导单电荷烃离子$\\mathrm{C}_n\\mathrm{H}_m^{+}$的精确质荷比$m/z$的通用表达式，然后应用此表达式计算四个指定碎片离子的具体$m/z$值。\n\n提供的基本常数如下：\n- 中性碳-12原子的精确单一同位素质量：$M(^{12}\\mathrm{C}) = 12.000000000$ u。\n- 中性氢-1原子的精确单一同位素质量：$M(^{1}\\mathrm{H}) = 1.00782503223$ u。\n- 电子的质量：$m_e = 0.000548579909$ u。\n\n离子的质量与其相应的中性物质的质量有关。所提供的原子质量是针对中性原子的，这些原子包含其全部电子。化学式为$\\mathrm{C}_n\\mathrm{H}_m$的中性分子实体由$n$个碳原子和$m$个氢原子组成。其精确单一同位素质量，记为$M(\\mathrm{C}_n\\mathrm{H}_m)_{\\text{neutral}}$，是其组成中性原子精确质量的总和：\n$$M(\\mathrm{C}_n\\mathrm{H}_m)_{\\text{neutral}} = n \\cdot M(^{12}\\mathrm{C}) + m \\cdot M(^{1}\\mathrm{H})$$\n问题指明阳离子$\\mathrm{C}_n\\mathrm{H}_m^{+}$的电荷为$+1$，这意味着它比中性物质少一个电子。因此，阳离子$M(\\mathrm{C}_n\\mathrm{H}_m^{+})$的质量是中性原子团的质量减去一个电子的质量$m_e$：\n$$M(\\mathrm{C}_n\\mathrm{H}_m^{+}) = M(\\mathrm{C}_n\\mathrm{H}_m)_{\\text{neutral}} - m_e$$\n通过代入，我们得到离子精确质量的通用表达式：\n$$M(\\mathrm{C}_n\\mathrm{H}_m^{+}) = n \\cdot M(^{12}\\mathrm{C}) + m \\cdot M(^{1}\\mathrm{H}) - m_e$$\n质荷比$m/z$定义为离子的质量与其电荷态数$z$的比值。对于本问题中的单电荷阳离子，$z=1$。因此，$m/z$值在数值上等于以原子质量单位表示的离子质量。\n$$m/z = \\frac{M(\\mathrm{C}_n\\mathrm{H}_m^{+})}{z} = \\frac{n \\cdot M(^{12}\\mathrm{C}) + m \\cdot M(^{1}\\mathrm{H}) - m_e}{1}$$\n$$m/z = n \\cdot M(^{12}\\mathrm{C}) + m \\cdot M(^{1}\\mathrm{H}) - m_e$$\n这是推导出的通用表达式。我们现在应用此公式计算指定离子的$m/z$值，并将每个结果四舍五入到四位有效数字。\n\n1.  对于$\\mathrm{C}_3\\mathrm{H}_7^{+}$阳离子（$n=3, m=7$）：\n    $$m/z = 3 \\cdot (12.000000000) + 7 \\cdot (1.00782503223) - 0.000548579909$$\n    $$m/z = 36.000000000 + 7.05477522561 - 0.000548579909$$\n    $$m/z = 43.054226645701$$\n    四舍五入到四位有效数字，我们得到$43.05$。\n\n2.  对于$\\mathrm{C}_3\\mathrm{H}_5^{+}$阳离子（$n=3, m=5$）：\n    $$m/z = 3 \\cdot (12.000000000) + 5 \\cdot (1.00782503223) - 0.000548579909$$\n    $$m/z = 36.000000000 + 5.03912516115 - 0.000548579909$$\n    $$m/z = 41.038576581241$$\n    四舍五入到四位有效数字，我们得到$41.04$。\n\n3.  对于$\\mathrm{C}_4\\mathrm{H}_9^{+}$阳离子（$n=4, m=9$）：\n    $$m/z = 4 \\cdot (12.000000000) + 9 \\cdot (1.00782503223) - 0.000548579909$$\n    $$m/z = 48.000000000 + 9.07042529007 - 0.000548579909$$\n    $$m/z = 57.069876710161$$\n    四舍五入到四位有效数字，我们得到$57.07$。\n\n4.  对于$\\mathrm{C}_4\\mathrm{H}_7^{+}$阳离子（$n=4, m=7$）：\n    $$m/z = 4 \\cdot (12.000000000) + 7 \\cdot (1.00782503223) - 0.000548579909$$\n    $$m/z = 48.000000000 + 7.05477522561 - 0.000548579909$$\n    $$m/z = 55.054226645701$$\n    四舍五入到四位有效数字，我们得到$55.05$。\n\n最终的数值结果，按指定顺序（$\\mathrm{C}_3\\mathrm{H}_7^{+}$、$\\mathrm{C}_3\\mathrm{H}_5^{+}$、$\\mathrm{C}_4\\mathrm{H}_9^{+}$、$\\mathrm{C}_4\\mathrm{H}_7^{+}$）为$43.05$、$41.04$、$57.07$和$55.05$。", "answer": "$$\\boxed{\\begin{pmatrix} 43.05  41.04  57.07  55.05 \\end{pmatrix}}$$", "id": "3703528"}, {"introduction": "在掌握了质量计算之后，下一步是理解谱图的表观特征。一个常见的挑战是，在电子电离质谱（EI-MS）中，并非所有分子都能产生可观测到的分子离子峰，特别是高度支化的烷烃。这项练习 [@problem_id:3703589] 深入探讨了分子结构（特别是支化程度）与其分子离子稳定性之间的内在联系，并运用碳正离子稳定性和反应动力学原理来解释这一关键的谱图现象。", "problem": "一次电子电离质谱实验在名义上相同的条件下比较了两种具有相同分子式的同分异构烷烃：一种直链烷烃和一种高度支化的同分异构体。在入射电子能量为 $70\\,\\mathrm{eV}$ 且常规电子电离 (EI) 离子源压力处于高真空区间的条件下，高度支化的同分异构体所产生的自由基阳离子分子离子 $M^{\\bullet+}$ 的强度小到几乎可以忽略，而直链烷烃则显示出一个可检测到但较弱的 $M^{\\bullet+}$ 峰。请基于以下第一性原理进行推理：(i) 电子电离的定义，即从中性分子中移除一个电子形成自由基阳离子；(ii) 决定相对键解离能和碳正离子稳定性的定性价层结构考量；以及 (iii) 微正则单分子解离动力学，如 Rice–Ramsperger–Kassel–Marcus (RRKM) 理论所描述的。请判断哪些陈述正确地解释了这一观测结果，以及哪些实际的离子源改造最有可能增加观测到的高度支化烷烃的 $M^{\\bullet+}$ 强度。\n\n你的推理所依据的假设和物理基础必须仅限于以下经过充分检验的事实：\n- 在电子电离 (EI) 中，中性分析物吸收足够的能量以逐出一个电子，形成具有宽内能分布的 $M^{\\bullet+}$，其内能分布由电子能量、分析物电离能以及过剩能量的分配决定。\n- 相对碳正离子稳定性遵循叔  仲  伯的经验顺序，产生稳定化碳正离子的 C-C 键断裂阈值也呈现相应的趋势。\n- 在孤立条件下的单分子解离中，内能为 $E$ 的活化离子的衰变速率 $k(E)$ 随着解离阈能 $E_0$ 的降低以及可及的过渡态态数的增加而急剧增加；$M^{\\bullet+}$ 的存活产率反映了离子引出和单分子衰变之间的竞争。\n- 如果在离子形成和引出的时间尺度上存在足够的碰撞频率，碰撞冷却会在解离前降低内能。\n\n选择所有与这些原理一致的陈述：\n\nA. 高度支化的烷烃通常比其直链同分异构体具有更高的电离能；因此，在 $70\\,\\mathrm{eV}$ 时，它们在电离时吸收更多的内能，这直接解释了 $M^{\\bullet+}$ 的消失。\n\nB. 对于高度支化的烷烃，许多低阈能的 C-C 键断裂会产生叔碳正离子碎片；降低的解离阈能 $E_0$ 在给定内能下增加了 $M^{\\bullet+}$ 的微正则碎裂速率 $k(E)$，从而相对于直链同分异构体降低了分子离子的存活产率。\n\nC. 将电子能量从 $70\\,\\mathrm{eV}$ 降低到大约 $10$–$15\\,\\mathrm{eV}$ 和/或将离子源压力增加到碰撞区域（例如，在为高压 EI 设计的仪器中，增加到 $\\sim 1$–$100\\,\\mathrm{Pa}$ 范围），通过降低初始内能并实现解离前的碰撞冷却来增强 $M^{\\bullet+}$ 的强度。\n\nD. 在相似的离子源条件下，从 EI 切换到使用甲烷的正离子化学电离，通过质子转移形成 $[M+H]^+$ 来增强烷烃的 $M^{\\bullet+}$ 强度，从而直接报告自由基阳离子分子离子。\n\nE. 采用能够产生更“冷”的分子离子的低内能电离方法，例如场电离或使用超声分子束的“冷 EI”，通过抑制快速的单分子碎裂来增加观测到的高度支化烷烃的 $M^{\\bullet+}$ 强度。\n\n选择所有适用的选项。请仅根据所述的基本原理提供你的推理；在没有上述基本原理支持的情况下，不要引用未说明的专有仪器技巧或经验“法则”。", "solution": "问题陈述是有效的。它提出了电子电离质谱中一个公认的现象——即高度支化烷烃的分子离子相对于其直链同分异构体的不稳定性——并要求基于一组给定的物理化学和质谱学的基本原理进行解释。该问题在科学上是合理的，内容自洽，且提问恰当。\n\n问题的核心在于理解分子离子 ($M^{\\bullet+}$) 的存活与其单分子碎裂之间的竞争。存活产率取决于碎裂速率 $k(E)$，而该速率又是离子内能 $E$ 和最低能量解离通道的能量阈值 $E_0$ 的强函数。\n\n在电子能量为 $70\\,\\mathrm{eV}$ 的电子电离 (EI) 中，中性分子 $M$ 被电离形成自由基阳离子 $M^{\\bullet+}$。电离过程会将一系列内能沉积到新生的 $M^{\\bullet+}$ 群体中。根据所提供的原理，碎裂速率 $k(E)$ 随着解离阈能 $E_0$ 的降低而急剧增加。分子离子峰是为那些在离子源驻留时间尺度（通常为微秒级）内存活下来的离子所观测到的。\n\n直链烷烃只拥有伯碳原子和仲碳原子。其 C-C 键断裂会导致形成较不稳定的伯碳正离子或仲碳正离子。因此，这些碎裂途径具有相对较高的解离阈能 ($E_0$)。所形成的大部分 $M^{\\bullet+}$ 离子其内能将低于这些高阈能，或者处于一个 $k(E)$ 足够慢以使离子能够存活并被检测到的能量范围内。\n\n高度支化的烷烃含有叔碳原子或季碳原子。正如所提供原理中所述，碳正离子的稳定性遵循叔  仲  伯的顺序。支链烷烃分子离子的碎裂可以通过 C-C 键断裂来进行，形成一个高度稳定的叔碳正离子。这条途径在能量上非常有利，导致其解离阈能 $E_0$ 显著低于直链同分异构体可用的碎裂通道。由于 $k(E)$ 随着 $E_0$ 的降低而急剧增加，即使是内能不高的分子离子也会极快地碎裂。结果，来自高度支化烷烃的 $M^{\\bullet+}$ 离子中，极少数能存活足够长的时间被检测到，导致分子离子峰小到可以忽略或完全消失。\n\n在此框架下，可以对每个陈述进行评估。\n\n**对陈述 A 的分析：**\n“高度支化的烷烃通常比其直链同分异构体具有更高的电离能；因此，在 $70\\,\\mathrm{eV}$ 时，它们在电离时吸收更多的内能，这直接解释了 $M^{\\bullet+}$ 的消失。”\n该陈述的前提在事实上是错误的。增加的烷基取代会稳定正电荷，无论是在碳正离子中还是在自由基阳离子中。因此，高度支化的烷烃通常比其直链同分异构体具有*更低*而非更高的电离能。例如，正己烷的电离能是 $10.18\\,\\mathrm{eV}$，而其支化程度更高的同分异构体 2,2-二甲基丁烷的电离能是 $10.06\\,\\mathrm{eV}$。此外，即使该前提为真，更高的电离能也意味着可分配到离子内能中的过剩能量 ($70\\,\\mathrm{eV} - \\text{IE}$) 更少，这反而会导致*更少*而非更多的碎裂。\n**结论：** 错误。\n\n**对陈述 B 的分析：**\n“对于高度支化的烷烃，许多低阈能的 C-C 键断裂会产生叔碳正离子碎片；降低的解离阈能 $E_0$ 在给定内能下增加了 $M^{\\bullet+}$ 的微正则碎裂速率 $k(E)$，从而相对于直链同分异构体降低了分子离子的存活产率。”\n该陈述准确地描述了这一现象背后的核心物理有机化学原因。支链的存在使得碎裂途径可以产生稳定的叔碳正离子。这与原理 (ii) 一致。稳定产物的形成降低了碎裂活化能，即解离阈能 $E_0$。根据原理 (iii)，对于任何高于阈值的给定内能 $E$，更低的 $E_0$ 会导致快得多的碎裂速率 $k(E)$。这种快速碎裂与离子源的离子引出过程相竞争并胜出，从而急剧降低了 $M^{\\bullet+}$ 的存活产率，进而降低了其观测强度。这是对该现象直接且正确的解释。\n**结论：** 正确。\n\n**对陈述 C 的分析：**\n“将电子能量从 $70\\,\\mathrm{eV}$ 降低到大约 $10$–$15\\,\\mathrm{eV}$ 和/或将离子源压力增加到碰撞区域（例如，在为高压 EI 设计的仪器中，增加到 $\\sim 1$–$100\\,\\mathrm{Pa}$ 范围），通过降低初始内能并实现解离前的碰撞冷却来增强 $M^{\\bullet+}$ 的强度。”\n该陈述提出了两种增加分子离子强度的有效策略。\n1.  根据原理 (i)，将电子能量降低到略高于烷烃电离能（通常约为 $10\\,\\mathrm{eV}$）的值，会显著减少电离时沉积到离子中的过剩能量。内能减少后，更大比例的 $M^{\\bullet+}$ 群体将在快速碎裂阈值以下形成，从而提高存活率。\n2.  增加离子源压力会引入新形成的活化 $M^{\\bullet+}$ 离子与中性背景气体分子之间的频繁碰撞。正如原理 (iv) 所述，这会导致碰撞冷却，从而从离子中移除内能。通过将内能降低到碎裂阈能 $E_0$ 以下，碰撞冷却有效地“淬灭”了碎裂过程，使分子离子得以存活。这两种方法都是通过减少可用于碎裂的内能来起作用的。\n**结论：** 正确。\n\n**对陈述 D 的分析：**\n“在相似的离子源条件下，从 EI 切换到使用甲烷的正离子化学电离，通过质子转移形成 $[M+H]^+$ 来增强烷烃的 $M^{\\bullet+}$ 强度，从而直接报告自由基阳离子分子离子。”\n这个陈述包含多个错误。在使用甲烷的化学电离 (CI) 中，主要的试剂离子是 $\\mathrm{CH}_5^+$ 和 $\\mathrm{C}_2\\mathrm{H}_5^+$。烷烃是极弱的碱，质子亲和能很低；因此，向烷烃 $M$ 进行质子转移以形成 $[M+H]^+$ 不是一个有利的过程。烷烃的主要 CI 反应是氢负离子夺取，形成 $[M-H]^+$ 离子。此外，该陈述错误地声称形成 $[M+H]^+$（一个质量为 $M+1$ 的偶电子离子）是“直接报告自由基阳离子分子离子”（$M^{\\bullet+}$，一个质量为 $M$ 的奇电子离子）。这两者是根本不同的化学物种。\n**结论：** 错误。\n\n**对陈述 E 的分析：**\n“采用能够产生更“冷”的分子离子的低内能电离方法，例如场电离或使用超声分子束的“冷 EI”，通过抑制快速的单分子碎裂来增加观测到的高度支化烷烃的 $M^{\\bullet+}$ 强度。”\n该陈述正确地指出了已有的“软”电离技术。场电离 (FI) 和“冷 EI”（其中分子在电离前通过超声膨胀进行冷却）是专门设计用来产生内能极低的分子离子的，正如原理 (i) 所指出的。通过产生一群“冷的”$M^{\\bullet+}$ 离子，这些方法确保了绝大多数离子形成时的内能远低于支链烷烃的低碎裂阈能 ($E_0$)。结果，碎裂被抑制，分子离子的存活产率显著增加，这与原理 (iii) 的动力学论点相符。\n**结论：** 正确。", "answer": "$$\\boxed{BCE}$$", "id": "3703589"}, {"introduction": "质谱中的碎片离子强度模式蕴含着丰富的结构信息，真正的挑战在于如何从中提取这些信息。这项高级实践将理论与应用融为一体，将引导你构建一个简化的计算模型。通过该模型 [@problem_id:3703587]，你将能够分析烷烃的特征碎片模式，并反推出其原始碳链的长度，这展示了如何将理论原理转化为强大的结构解析工具。", "problem": "给定一个饱和直链烷烃的电子电离（EI）质谱指纹图谱，其分子式为 $C_nH_{2n+2}$。该质谱是在有利于键均裂和电荷保留在碳正离子碎片上的高能条件下采集的。根据经验，在无支链烷烃的EI谱图中，对应于 $m/z$ 值为 $43$、$57$、$71$ 和 $85$ 的烷基阳离子系列非常显著，分别与离子 $C_3H_7^+$、$C_4H_9^+$、$C_5H_{11}^+$ 和 $C_6H_{13}^+$ 相关。目标是从碎裂组合学和稳定性的第一性原理出发，构建一个定量的、可检验的模型，以便从这些 $m/z$ 值下观测到的强度推断出最可能的链长 $n$。\n\n从以下基本前提开始：\n- 在EI质谱中，中性分子 $M$ 通过电子轰击被电离成 $M^{+\\cdot}$，并发生单分子碎裂。对于直链烷烃，在单个碳-碳键处发生的碎裂会生成一个烷基碳正离子 $C_kH_{2k+1}^+$ 和一个互补的自由基 $C_{n-k}H_{2(n-k)+1}^\\cdot$。\n- 在给定 $m/z$ 处的相对强度与在可及的微正则系综能量下形成相应碎片的独特方式数量成正比，也与碳正离子的热力学稳定性（例如，通过超共轭效应）成正比。在线性 $C_n$ 骨架和单键断裂的约束下，长度为 $n$ 的链中长度为 $k$ 的不同连续碳链段的数量为 $N_k(n) = \\max(n - k + 1, 0)$。\n- 由于超共轭效应，$C_kH_{2k+1}^+$ 的稳定化倾向随 $k$ 的增加而增加；通过一个仅依赖于 $k$ 的固定稳定性权重 $w_k$ 来近似此效应，其中 $w_3$、$w_4$、$w_5$ 和 $w_6$ 的值在下面指定。\n\n构建一个参数模型，其中对应于 $k \\in \\{3,4,5,6\\}$ 的离子的预测、未标度化强度与 $N_k(n)\\, w_k$ 成正比。由于谱图的绝对标度可能会变化，假设存在一个未知的非负标量 $s$ 来缩放整个预测向量。假设在这四个通道观测到的强度上存在加性的、独立的、同分布的高斯噪声，且其方差在各通道间恒定。\n\n你的任务是实现一个程序，对于每个给定的测试用例，计算候选范围内的一个整数 $n$，该 $n$ 值能够使观测强度与从 $N_k(n)\\, w_k$ 导出的最优缩放预测向量之间的高斯似然最大化（等价于使残差平方和最小化）。如果多个 $n$ 值得到完全相同的最小残差，则报告其中最小的 $n$。\n\n使用以下固定的模型参数：\n- 稳定性权重：$w_3 = 1.00$, $w_4 = 1.25$, $w_5 = 1.55$, $w_6 = 1.75$。\n- 候选链长范围：$n \\in \\{3,4,\\dots,20\\}$。\n\n对于 $m/z$ 和 $k$ 之间的映射，使用 $m/z\\,43 \\leftrightarrow k=3$，$m/z\\,57 \\leftrightarrow k=4$，$m/z\\,71 \\leftrightarrow k=5$，以及 $m/z\\,85 \\leftrightarrow k=6$。\n\n将给定 $n$ 的模型预测、未标度化强度向量定义为\n$$\n\\mathbf{y}(n) = \\big(N_3(n) w_3,\\; N_4(n) w_4,\\; N_5(n) w_5,\\; N_6(n) w_6\\big),\n$$\n其中 $N_k(n) = \\max(n-k+1, 0)$。\n给定一个观测强度向量\n$$\n\\mathbf{x} = \\big(x_{43}, x_{57}, x_{71}, x_{85}\\big),\n$$\n假设对于每个候选的 $n$，选择最优尺度 $s \\ge 0$ 以最小化平方误差 $\\|\\mathbf{x} - s\\,\\mathbf{y}(n)\\|_2^2$，并选择使该误差最小化的 $n$。\n\n你的程序必须处理以下四个测试用例，其中每个观测强度应被视为任意单位（无量纲）：\n- 测试用例 1: $\\mathbf{x} = [802,\\, 871,\\, 935,\\, 870]$。\n- 测试用例 2: $\\mathbf{x} = [305,\\, 248,\\, 152,\\, 0]$。\n- 测试用例 3: $\\mathbf{x} = [279,\\, 263,\\, 218,\\, 123]$。\n- 测试用例 4: $\\mathbf{x} = [242,\\, 147,\\, 0,\\, 0]$。\n\n你的程序应该生成一行输出，其中包含四个测试用例的预测链长，形式为一个用逗号分隔并由方括号括起来的列表（例如，$[n_1,n_2,n_3,n_4]$）。每个 $n_i$ 必须是整数。\n\n覆盖性设计：\n- 第一个测试用例代表一个较长的链，在 $m/z\\,85$ 处有显著贡献。\n- 第二个测试用例代表一个边界情况，其中链太短无法生成 $m/z\\,85$ 的碎片（$k=6$），因此在 $85$ 处的观测强度为零。\n- 第三个测试用例考察中等长度的链，在所有四个通道都有不可忽略的贡献。\n- 第四个测试用例代表一个短链，在 $m/z\\,71$ 和 $m/z\\,85$ 处的强度为零，用以测试对零值通道的正确处理。\n\n你的程序必须是自包含的，并且不需要用户输入。最终输出格式必须是且仅是一行：一个用方括号括起来的、逗号分隔的四个推断整数列表。", "solution": "此问题是有效的。它提出了一个具有科学依据、适定且客观的任务，即从给定的质谱指纹图谱中推断出烷烃的链长。该模型是对电子电离质谱中碎裂过程的简化但物理上合理的表示。所有参数和约束都已明确定义。\n\n目标是确定一个饱和直链烷烃（$C_nH_{2n+2}$）的最可能整数链长 $n$，该链长对应于给定的质谱指纹图谱。该指纹图谱包含四个特定碎片离子的观测强度。此问题被构建为一个模型拟合任务，我们需要从指定的候选集 $n \\in \\{3, 4, \\dots, 20\\}$ 中寻找能最好地解释数据的参数 $n$。\n\n该模型基于两个原理：形成碎片的组合学和所得碳正离子的热力学稳定性。观测强度向量给定为 $\\mathbf{x} = \\big(x_{43}, x_{57}, x_{71}, x_{85}\\big)$，其中每个分量对应于特定质荷比（$m/z$）下的强度。这些 $m/z$ 值分别对应于 $k \\in \\{3, 4, 5, 6\\}$ 的烷基阳离子 $C_kH_{2k+1}^+$。\n\n对于给定的链长 $n$，模型会预测一个未标度化的强度向量 $\\mathbf{y}(n)$。该向量的分量由组合项 $N_k(n)$ 和稳定性权重 $w_k$ 的乘积给出：\n$$\ny_k(n) = N_k(n) \\, w_k\n$$\n其中 $k \\in \\{3, 4, 5, 6\\}$。\n项 $N_k(n) = \\max(n - k + 1, 0)$ 表示从一个包含 $n$ 个碳的线性链中裂解出一段包含 $k$ 个碳的连续碎片的途径数量。稳定性权重 $w_k$ 作为固定参数给出：$w_3 = 1.00$, $w_4 = 1.25$, $w_5 = 1.55$, $w_6 = 1.75$。\n\n因此，对于给定的 $n$，模型预测的向量为：\n$$\n\\mathbf{y}(n) = \\big(N_3(n) w_3,\\; N_4(n) w_4,\\; N_5(n) w_5,\\; N_6(n) w_6\\big)\n$$\n\n观测强度 $\\mathbf{x}$ 与模型预测 $\\mathbf{y}(n)$ 之间的关系由一个带有加性高斯噪声的缩放关系描述：$\\mathbf{x} \\approx s\\,\\mathbf{y}(n)$。这里，$s$ 是一个未知的非负缩放因子，用于解释绝对信号强度的变化。\n\n任务是找到使观测到 $\\mathbf{x}$ 的高斯似然最大化的整数 $n$。这等价于最小化观测数据与最优缩放模型预测之间的残差平方和（SSR）。需要最小化的目标函数是残差向量的欧几里得范数的平方：\n$$\nE(n, s) = \\|\\mathbf{x} - s\\,\\mathbf{y}(n)\\|_2^2\n$$\n优化分两个阶段进行。首先，对于每个候选的 $n$，我们找到使 $E(n, s)$ 最小化的最优缩放因子 $s^*(n)$。其次，我们找到能使这个最小化误差达到最小可能值的 $n$。\n\n为了找到固定 $n$ 下的最优缩放因子 $s^*(n)$，我们对 $E(n, s)$ 关于 $s$ 进行最小化。其标量形式为 $E(n,s) = \\sum_{k \\in \\{3,4,5,6\\}} (x_k - s \\, y_k(n))^2$。我们对 $s$ 求导并令其为零：\n$$\n\\frac{\\partial E}{\\partial s} = \\sum_k 2(x_k - s \\, y_k(n))(-y_k(n)) = -2 \\left( \\sum_k x_k y_k(n) - s \\sum_k y_k(n)^2 \\right) = 0\n$$\n解出 $s$ 即可得到最优缩放因子：\n$$\ns^*(n) = \\frac{\\sum_k x_k y_k(n)}{\\sum_k y_k(n)^2}\n$$\n在向量表示法中，这是 $\\mathbf{x}$ 和 $\\mathbf{y}(n)$ 的点积与 $\\mathbf{y}(n)$ 的范数平方之比：\n$$\ns^*(n) = \\frac{\\mathbf{x} \\cdot \\mathbf{y}(n)}{\\|\\mathbf{y}(n)\\|_2^2}\n$$\n问题规定 $s \\geq 0$。由于观测强度 $x_k$ 是非负的，模型向量分量 $y_k(n)$ 也是非负的（因为 $N_k(n) \\ge 0$ 且 $w_k  0$），它们的点积 $\\mathbf{x} \\cdot \\mathbf{y}(n)$ 将是非负的。分母 $\\|\\mathbf{y}(n)\\|_2^2$ 也是非负的，并且对于候选范围 $\\{3, \\dots, 20\\}$ 中的任何 $n$ 都严格为正。因此，$s^*(n) \\ge 0$ 的条件自然满足。\n\n确定 $s^*(n)$ 后，我们将其代回误差函数，以找到该特定 $n$ 的最小残差：\n$$\nR(n) = \\min_{s \\ge 0} E(n, s) = \\|\\mathbf{x} - s^*(n)\\,\\mathbf{y}(n)\\|_2^2\n$$\n\n最后一步是找到链长 $\\hat{n}$，它能在候选范围内的所有可能的 $n$ 值中使该残差最小化：\n$$\n\\hat{n} = \\underset{n \\in \\{3, 4, \\dots, 20\\}}{\\arg\\min} \\, R(n)\n$$\n如果多个 $n$ 值产生相同的最小残差，问题规定应选择其中最小的 $n$。\n\n解决每个测试用例的算法如下：\n1.  初始化 `min_residual` 为无穷大，`best_n` 为一个占位符值。\n2.  对于从 $3$ 到 $20$ 的每个整数 $n$：\n    a. 使用 $N_k(n)$ 的公式和给定的权重 $w_k$ 构建模型向量 $\\mathbf{y}(n)$。\n    b. 计算最优缩放因子 $s^*(n) = (\\mathbf{x} \\cdot \\mathbf{y}(n)) / \\|\\mathbf{y}(n)\\|_2^2$。\n    c. 计算平方残差 $R(n) = \\|\\mathbf{x} - s^*(n)\\,\\mathbf{y}(n)\\|_2^2$。\n    d. 如果 $R(n)$ 小于当前的 `min_residual`，则将 `min_residual` 更新为 $R(n)$，并将 `best_n` 设置为 $n$。\n3.  循环结束后，`best_n` 的值就是给定测试用例的解。\n对所有四个提供的测试用例重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the most probable alkane chain length n for given mass spectral data.\n    \"\"\"\n\n    # Define the fixed model parameters from the problem statement.\n    # Stability weights for k = 3, 4, 5, 6\n    w_weights = np.array([1.00, 1.25, 1.55, 1.75])\n    # Corresponding k values for the fragments\n    k_values = np.array([3, 4, 5, 6])\n    # Candidate chain length range for n\n    n_range = range(3, 21)\n\n    # Define the test cases from the problem statement.\n    # Each list represents the observed intensities x = [x_43, x_57, x_71, x_85]\n    test_cases = [\n        np.array([802., 871., 935., 870.]),\n        np.array([305., 248., 152., 0.]),\n        np.array([279., 263., 218., 123.]),\n        np.array([242., 147., 0., 0.])\n    ]\n\n    results = []\n    \n    # Process each test case\n    for x_obs in test_cases:\n        best_n = -1\n        min_residual_sq = float('inf')\n\n        # Iterate through all possible chain lengths n in the candidate range\n        for n in n_range:\n            # Step 1: Construct the model-predicted, unscaled intensity vector y(n)\n            # N_k(n) = max(n - k + 1, 0) is the number of ways to form a k-fragment.\n            N_counts = np.maximum(n - k_values + 1, 0)\n            y_model = N_counts * w_weights\n            \n            # Step 2: Calculate the optimal scaling factor s to minimize ||x - s*y||^2\n            # s_opt = (x . y) / (y . y)\n            \n            y_dot_y = np.dot(y_model, y_model)\n            \n            # This check handles the theoretical case where y_model is a zero vector.\n            # For n = 3, y_model will never be all zeros, so y_dot_y  0.\n            if y_dot_y == 0:\n                # If y_model is zero, the best s*y is also zero.\n                # The residual is then just the magnitude of x_obs.\n                residual_sq = np.dot(x_obs, x_obs)\n            else:\n                x_dot_y = np.dot(x_obs, y_model)\n                s_opt = x_dot_y / y_dot_y\n                \n                # Step 3: Calculate the minimized squared residual for this n\n                # R(n) = ||x_obs - s_opt * y_model||^2\n                residual_vector = x_obs - s_opt * y_model\n                residual_sq = np.dot(residual_vector, residual_vector)\n\n            # Step 4: Update the best n if a smaller residual is found.\n            # The strict inequality handles the tie-breaking rule: the first n\n            # that achieves the minimum residual is kept, which is the smallest n.\n            if residual_sq  min_residual_sq:\n                min_residual_sq = residual_sq\n                best_n = n\n\n        results.append(best_n)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3703587"}]}