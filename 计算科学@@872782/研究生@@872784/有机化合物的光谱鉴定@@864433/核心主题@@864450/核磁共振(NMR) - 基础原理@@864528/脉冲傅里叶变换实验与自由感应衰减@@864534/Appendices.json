{"hands_on_practices": [{"introduction": "本练习旨在探索时域与频域之间的基本联系。通过推导有效横向弛豫时间 $T_2^*$ 与谱线半峰全宽（FWHM）之间的关系，您将定量地理解磁场均匀性（通过匀场过程改善）如何直接转化为更尖锐、分辨率更高的核磁共振谱峰。这项练习 [@problem_id:3720181] 展示了为何缓慢衰减的自由感应衰减（FID）对于高分辨率波谱至关重要。", "problem": "在用于有机化合物波谱鉴定的脉冲傅里叶变换核磁共振（NMR）波谱学中，磁场不均匀性和微观失相会导致有效横向弛豫时间，记为 $T_2^\\ast$（有效横向弛豫时间）。考虑一个单个孤立的共振，其自由感应衰减（FID）可以很好地由一个指数衰减的正弦波近似：\n$$s(t) = s_0 \\exp\\!\\left(-\\frac{t}{T_2^\\ast}\\right) \\cos\\!\\left(2\\pi \\nu_0 t\\right) u(t),$$\n其中 $u(t)$ 是强制 $t \\ge 0$ 的单位阶跃函数，$s_0$ 是一个实常数，$\\nu_0$ 是共振频率。单边傅里叶变换定义为\n$$S(\\nu) = \\int_{0}^{\\infty} s(t) \\exp\\!\\left(-i 2\\pi \\nu t\\right)\\, dt.$$\n仅使用上述定义和标准傅里叶分析，推导吸收模式谱线形状，并确定其半峰全宽（FWHM），$\\Delta \\nu_{1/2}$，用 $T_2^\\ast$ 表示。然后，对于匀场前 $T_2^\\ast = 50\\,\\mathrm{ms}$ 和匀场后 $T_2^\\ast = 200\\,\\mathrm{ms}$ 的样品，计算相应的以 $\\mathrm{Hz}$ 为单位的半峰全宽线宽。\n\n最后，通过采用以下操作性分辨率判据来评估分辨紧密间隔谱峰的增益：当两条等强度、等宽度的洛伦兹谱线的中心间距等于单条谱线的半峰全宽时，它们被视为“恰好分辨”。定义分辨率增益因子\n$$G \\equiv \\frac{\\Delta \\nu_{\\min,\\mathrm{before}}}{\\Delta \\nu_{\\min,\\mathrm{after}}},$$\n其中 $\\Delta \\nu_{\\min}$ 是上述判据下的最小可分辨间距。将 $G$ 报告为单个无量纲数。无需四舍五入。以 $\\mathrm{Hz}$ 表示任何中间线宽。", "solution": "第一步是计算自由感应衰减（FID）信号 $s(t)$ 的傅里叶变换，以获得频域谱 $S(\\nu)$。FID 信号由下式给出：\n$$s(t) = s_0 \\exp\\!\\left(-\\frac{t}{T_2^\\ast}\\right) \\cos\\!\\left(2\\pi \\nu_0 t\\right) u(t)$$\n其中 $s_0$ 是一个实常数，$T_2^\\ast$ 是有效横向弛豫时间，$\\nu_0$ 是共振频率，$u(t)$ 是单位阶跃函数。单边傅里叶变换定义为：\n$$S(\\nu) = \\int_{0}^{\\infty} s(t) \\exp\\!\\left(-i 2\\pi \\nu t\\right)\\, dt$$\n为了方便积分，我们使用欧拉公式 $\\cos(x) = \\frac{1}{2}(\\exp(ix) + \\exp(-ix))$ 来表示余弦项：\n$$s(t) = s_0 \\exp\\!\\left(-\\frac{t}{T_2^\\ast}\\right) \\frac{1}{2} \\left[ \\exp(i 2\\pi \\nu_0 t) + \\exp(-i 2\\pi \\nu_0 t) \\right]$$\n将此式代入傅里叶变换积分，并且由于 $u(t)$ 将积分限制在 $t \\ge 0$ 的范围内，我们有：\n$$S(\\nu) = \\frac{s_0}{2} \\int_{0}^{\\infty} \\left[ \\exp\\!\\left(-\\frac{t}{T_2^\\ast} + i 2\\pi \\nu_0 t\\right) + \\exp\\!\\left(-\\frac{t}{T_2^\\ast} - i 2\\pi \\nu_0 t\\right) \\right] \\exp(-i 2\\pi \\nu t)\\, dt$$\n我们可以通过合并指数项将其分为两个积分：\n$$S(\\nu) = \\frac{s_0}{2} \\left[ \\int_{0}^{\\infty} \\exp\\!\\left(-t\\left(\\frac{1}{T_2^\\ast} - i 2\\pi (\\nu_0 - \\nu)\\right)\\right) dt + \\int_{0}^{\\infty} \\exp\\!\\left(-t\\left(\\frac{1}{T_2^\\ast} + i 2\\pi (\\nu_0 + \\nu)\\right)\\right) dt \\right]$$\n每个积分的形式为 $\\int_{0}^{\\infty} \\exp(-at) dt = \\frac{1}{a}$，条件是 $\\mathrm{Re}(a) > 0$。在我们的例子中，$\\mathrm{Re}(a) = 1/T_2^\\ast > 0$。计算积分得到：\n$$S(\\nu) = \\frac{s_0}{2} \\left[ \\frac{1}{\\frac{1}{T_2^\\ast} - i 2\\pi (\\nu_0 - \\nu)} + \\frac{1}{\\frac{1}{T_2^\\ast} + i 2\\pi (\\nu_0 + \\nu)} \\right]$$\n问题要求的是吸收模式谱线形状，即复数谱 $S(\\nu)$ 的实部。对于典型的核磁共振实验，检测频率 $\\nu$ 接近共振频率 $\\nu_0$，且两者均为正大数。第二项以 $\\nu = -\\nu_0$ 为中心，远离感兴趣的区域，其对 $\\nu_0$ 附近谱线形状的贡献可以忽略不计。因此，我们可以通过只考虑第一项来近似共振点附近的谱图：\n$$S(\\nu) \\approx \\frac{s_0}{2} \\frac{1}{\\frac{1}{T_2^\\ast} + i 2\\pi (\\nu - \\nu_0)}$$\n为了求实部，我们将分子和分母同乘以分母的复共轭：\n$$S(\\nu) \\approx \\frac{s_0}{2} \\frac{\\frac{1}{T_2^\\ast} - i 2\\pi (\\nu - \\nu_0)}{\\left(\\frac{1}{T_2^\\ast}\\right)^2 + \\left(2\\pi (\\nu - \\nu_0)\\right)^2}$$\n吸收模式谱 $A(\\nu)$ 是 $S(\\nu)$ 的实部：\n$$A(\\nu) = \\mathrm{Re}[S(\\nu)] = \\frac{s_0}{2} \\frac{\\frac{1}{T_2^\\ast}}{\\left(\\frac{1}{T_2^\\ast}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2}$$\n这是一个以 $\\nu_0$ 为中心的洛伦兹线型方程。\n\n接下来，我们确定半峰全宽（FWHM），记为 $\\Delta \\nu_{1/2}$。谱线的最大振幅 $A_{\\max}$ 出现在共振频率 $\\nu = \\nu_0$ 处：\n$$A_{\\max} = A(\\nu_0) = \\frac{s_0}{2} \\frac{\\frac{1}{T_2^\\ast}}{\\left(\\frac{1}{T_2^\\ast}\\right)^2} = \\frac{s_0 T_2^\\ast}{2}$$\n我们寻找使振幅为其最大值一半的频率 $\\nu$，即 $A(\\nu) = \\frac{1}{2}A_{\\max}$。\n$$\\frac{s_0}{2} \\frac{\\frac{1}{T_2^\\ast}}{\\left(\\frac{1}{T_2^\\ast}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2} = \\frac{1}{2} \\left( \\frac{s_0 T_2^\\ast}{2} \\right) = \\frac{s_0 T_2^\\ast}{4}$$\n消去项并重新整理，我们得到：\n$$\\frac{2}{T_2^\\ast} \\frac{1}{\\left(\\frac{1}{T_2^\\ast}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2} = T_2^\\ast$$\n$$2 = (T_2^\\ast)^2 \\left[ \\left(\\frac{1}{T_2^\\ast}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2 \\right]$$\n$$2 = 1 + 4\\pi^2 (T_2^\\ast)^2 (\\nu - \\nu_0)^2$$\n$$1 = 4\\pi^2 (T_2^\\ast)^2 (\\nu - \\nu_0)^2$$\n两边取平方根得到：\n$$\\pm 1 = 2\\pi T_2^\\ast (\\nu - \\nu_0)$$\n对应于半峰高点的两个频率 $\\nu_{1/2,\\pm}$ 是：\n$$\\nu_{1/2,\\pm} = \\nu_0 \\pm \\frac{1}{2\\pi T_2^\\ast}$$\n半峰全宽是这两个频率之差：\n$$\\Delta \\nu_{1/2} = \\nu_{1/2,+} - \\nu_{1/2,-} = \\left(\\nu_0 + \\frac{1}{2\\pi T_2^\\ast}\\right) - \\left(\\nu_0 - \\frac{1}{2\\pi T_2^\\ast}\\right) = \\frac{1}{\\pi T_2^\\ast}$$\n这就是半峰全宽与 $T_2^\\ast$ 之间的解析关系。\n\n现在我们计算匀场前后的半峰全宽数值。\n匀场前：$T_{2,\\mathrm{before}}^\\ast = 50\\,\\mathrm{ms} = 5 \\times 10^{-2}\\,\\mathrm{s}$。\n$$\\Delta \\nu_{1/2, \\mathrm{before}} = \\frac{1}{\\pi (5 \\times 10^{-2}\\,\\mathrm{s})} = \\frac{20}{\\pi}\\,\\mathrm{Hz}$$\n匀场后：$T_{2,\\mathrm{after}}^\\ast = 200\\,\\mathrm{ms} = 2 \\times 10^{-1}\\,\\mathrm{s}$。\n$$\\Delta \\nu_{1/2, \\mathrm{after}} = \\frac{1}{\\pi (2 \\times 10^{-1}\\,\\mathrm{s})} = \\frac{5}{\\pi}\\,\\mathrm{Hz}$$\n\n最后，我们评估分辨率增益。两条谱线“恰好分辨”的判据是它们的间距等于半峰全宽。因此，最小可分辨间距 $\\Delta \\nu_{\\min}$ 等于半峰全宽 $\\Delta \\nu_{1/2}$。\n$$\\Delta \\nu_{\\min, \\mathrm{before}} = \\Delta \\nu_{1/2, \\mathrm{before}} = \\frac{20}{\\pi}\\,\\mathrm{Hz}$$\n$$\\Delta \\nu_{\\min, \\mathrm{after}} = \\Delta \\nu_{1/2, \\mathrm{after}} = \\frac{5}{\\pi}\\,\\mathrm{Hz}$$\n分辨率增益因子 $G$ 定义为这些最小间距的比率：\n$$G = \\frac{\\Delta \\nu_{\\min, \\mathrm{before}}}{\\Delta \\nu_{\\min, \\mathrm{after}}} = \\frac{20/\\pi}{5/\\pi} = \\frac{20}{5} = 4$$\n分辨率增益因子是 $4$，这是一个无量纲数。这表明，通过对磁体进行匀场使 $T_2^\\ast$ 增加 4 倍，分辨紧密间隔谱峰的能力也相应提高了 4 倍。", "answer": "$$\\boxed{4}$$", "id": "3720181"}, {"introduction": "理解了自由感应衰减（FID）信号的性质后，下一步是正确地将其数字化。本练习 [@problem_id:3720211] 聚焦于脉冲傅里叶变换核磁共振实验中数字采集的核心参数。您将根据驻留时间（dwell time）和采集点数计算谱宽和数字分辨率，从而学习这些参数选择如何在可观测频率范围与分辨精细结构（如小的标量耦合）的能力之间进行权衡。", "problem": "在用于有机化合物光谱鉴定的脉冲傅里叶变换（FT）核磁共振（NMR）实验中，自由感应衰减（FID）信号在时间上以恒定的驻留时间 $\\Delta t$ 和总点数 $N$ 进行均匀采样。预计存在一个小的同核标量耦合 $J$，您需要评估采样配置是否提供足够的频域粒度来分辨它。\n\n从脉冲FT实验中均匀时域采样的第一性原理以及总采集时间与频域点间距之间的傅里叶变换关系出发，推导谱宽和数字分辨率的表达式。然后，对于具体配置 $\\Delta t = 120\\,\\mu\\mathrm{s}$ 和 $N = 16384$，计算：\n1. 以 $\\mathrm{Hz}$ 为单位的谱宽。\n2. 以 $\\mathrm{Hz}$ 为单位的数字分辨率。\n\n最后，为了评估分辨小耦合的权衡，定义无量纲品质因数 $R$ 为耦合 $J$ 与数字分辨率 $\\delta f$ 之比，即 $R = J / \\delta f$，其中 $J = 2.0\\,\\mathrm{Hz}$。计算 $R$ 并将最终答案四舍五入至三位有效数字。在推导过程中，请以 $\\mathrm{Hz}$ 为单位表示谱宽和数字分辨率，但最终只需报告 $R$ 的值作为答案。", "solution": "本问题要求从脉冲FT实验中均匀时域采样的第一性原理出发，推导谱宽和数字分辨率，然后计算一个品质因数。\n\n**1. 谱宽 ($\\text{SW}$)**\n\n在数字信号处理中，时域信号以恒定速率 $f_s$ 进行采样。连续采样点之间的时间间隔是驻留时间 $\\Delta t$。因此，采样率是驻留时间的倒数：\n$$f_s = \\frac{1}{\\Delta t}$$\n根据奈奎斯特-香农采样定理，为避免混叠（频率的错误识别），采样率必须至少是信号中存在的最高频率分量的两倍。在现代NMR波谱学中，采用正交检测技术。该技术对进动磁化强度的两个正交分量进行采样，从而可以区分相对于发射器参考频率的正频率和负频率。对于具有正交检测的系统，可以无混叠地观测到的谱宽（$\\text{SW}$）等于采样率。\n因此，谱宽由下式给出：\n$$\\text{SW} = f_s = \\frac{1}{\\Delta t}$$\n\n**2. 数字分辨率 ($\\delta f$)**\n\nFID的采样总时长称为采集时间 $T_{acq}$。该时长是采样点数 $N$ 与它们之间的时间间隔 $\\Delta t$ 的乘积：\n$$T_{acq} = N \\cdot \\Delta t$$\n从时域到频域的转换是通过离散傅里叶变换（DFT）完成的，通常以快速傅里叶变换（FFT）算法实现。傅里叶变换的一个基本特性是，频域的分辨率与时域的总观测时间成反比。可以分辨的最小频率差，即数字分辨率（$\\delta f$），是所得频谱中相邻点之间的间距。该间距由总采集时间的倒数给出。\n因此，数字分辨率为：\n$$\\delta f = \\frac{1}{T_{acq}} = \\frac{1}{N \\Delta t}$$\n\n**3. 数值计算**\n\n给定具体的仪器参数：\n- 驻留时间：$\\Delta t = 120\\,\\mu\\mathrm{s} = 120 \\times 10^{-6}\\,\\mathrm{s}$\n- 点数：$N = 16384$\n\n首先，我们计算以 $\\mathrm{Hz}$ 为单位的谱宽：\n$$\\text{SW} = \\frac{1}{\\Delta t} = \\frac{1}{120 \\times 10^{-6}\\,\\mathrm{s}} = \\frac{10^6}{120}\\,\\mathrm{Hz} = 8333.\\overline{3}\\,\\mathrm{Hz}$$\n\n接下来，我们计算以 $\\mathrm{Hz}$ 为单位的数字分辨率。我们可以先计算采集时间：\n$$T_{acq} = N \\Delta t = 16384 \\times (120 \\times 10^{-6}\\,\\mathrm{s}) = 1.96608\\,\\mathrm{s}$$\n那么，数字分辨率是：\n$$\\delta f = \\frac{1}{T_{acq}} = \\frac{1}{1.96608\\,\\mathrm{s}} \\approx 0.508626\\,\\mathrm{Hz}$$\n\n**4. 品质因数 ($R$)**\n\n问题定义了一个无量纲品质因数 $R$，用以评估采样配置是否足以分辨标量耦合 $J$。其定义为：\n$$R = \\frac{J}{\\delta f}$$\n这个比率量化了有多少个数字点跨越了耦合的频率间隔。$R > 1$ 的值是必要的，而通常为了准确确定裂分，期望 $R \\geq 3$。\n\n给定 $J = 2.0\\,\\mathrm{Hz}$。使用推导出的 $\\delta f$ 表达式，我们可以将 $R$ 写为：\n$$R = \\frac{J}{1/(N \\Delta t)} = J \\cdot N \\cdot \\Delta t = J \\cdot T_{acq}$$\n代入数值：\n$$R = (2.0\\,\\mathrm{Hz}) \\cdot (1.96608\\,\\mathrm{s}) = 3.93216$$\n问题要求将最终答案四舍五入到三位有效数字。\n$$R \\approx 3.93$$\n这个值表明，$2.0\\,\\mathrm{Hz}$ 的耦合在频域谱中跨越了将近4个点，说明数字分辨率足以分辨该特征。", "answer": "$$\\boxed{3.93}$$", "id": "3720211"}, {"introduction": "这项最终的、综合性的练习将挑战您综合运用所学的关于自由感应衰减（FID）及其傅里叶分析的全部知识。通过计算构建一个因标量耦合而裂分为三重峰的质子信号的FID，您将直接模拟多个不同频率在时域中如何干涉，从而产生在核磁共振谱中观察到的多重峰。这种从理论参数到模拟谱图的“正向”计算 [@problem_id:3720138]，能让您深刻洞察复杂谱图的物理起源。", "problem": "要求您形式化、实现并验证核磁共振 (NMR) 中一级三线芳香质子谱图的自由感应衰减 (FID) 信号的解析构建，并预测相应的傅里叶变换 (FT) 波谱。其物理情景为：一个被观测的芳香质子与两个等价的自旋-$\\tfrac{1}{2}$相邻质子耦合，在弱耦合极限下产生一个三重峰。您的推导和实现必须基于以下基本原理：\n\n- 旋转坐标系中横向磁化强度的线性布洛赫方程描述，其中角频率偏移为 $\\omega$ 的单个等时自旋随时间演化，当 $t \\ge 0$ 时，其关系式为 $M_{xy}(t) = M_{xy}(0)\\,\\mathrm{e}^{-t/T_2^\\ast}\\,\\mathrm{e}^{\\mathrm{i}\\,\\omega t}$。\n- 检测的线性性质，即测量到的信号是所有容许跃迁贡献的线性叠加。\n- 在弱耦合一级近似下，对于一个质子与 $n$ 个等价相邻质子耦合（标量耦合常数为 $J$，单位为 $\\mathrm{Hz}$），存在 $n+1$ 个容许跃迁，其频率对称分布在化学位移偏移量周围，强度呈二项式分布。\n\n基于此，您必须推导出三重峰谱图的解析实数 FID 可以写成一个有限和，其各项为指数衰减的余弦函数，频率由化学位移和标量耦合常数确定。您必须指明所有使用的物理量、单位和约定。相应的傅里叶变换 (FT) 振幅谱必须在这些频率上呈现三条吸收线。\n\n程序要求：\n\n- 对于每个测试用例，构建解析时域 FID $s(t)$，其形式为一个实数信号\n  $$\n  s(t) \\;=\\; \\mathrm{e}^{-t/T_2^\\ast}\\,\\sum_{k=1}^{3} A_k \\cos\\!\\big(2\\pi\\,\\nu_k\\,t + \\phi\\big),\n  $$\n  其中 $A_k$ 是非负实数振幅，$\\nu_k$ 是旋转坐标系中相对于发射机的跃迁频率（单位为 $\\mathrm{Hz}$），$T_2^\\ast$ 是表观横向弛豫时间（单位为 $\\mathrm{s}$），$\\phi$ 是一个恒定的初始相位（单位为 $\\mathrm{radians}$）。您必须假设 $\\phi = 0$，且 $A_k$ 由三重峰的二项式权重给出，$A \\propto [1,2,1]$，任何整体比例因子都已并入全局振幅中。\n- 使用以下来自一级 NMR 的成熟结论：对于一个质子与两个等价相邻质子 ($n=2$) 耦合的情况，存在 3 个跃迁频率，它们以化学位移偏移频率为中心，彼此间隔为标量耦合常数 $J$。当波谱仪在频率 $\\nu_0$（单位 $\\mathrm{Hz}$）下观测质子时，化学位移 $\\delta$（单位 $\\mathrm{ppm}$）对应的频率偏移为 $\\nu_{\\text{cs}} = \\delta \\times \\nu_0 \\times 10^{-6}$（单位 $\\mathrm{Hz}$）。因此，这三个跃迁频率（单位 $\\mathrm{Hz}$）分别为 $\\nu_{\\text{cs}} - J$、$\\nu_{\\text{cs}}$ 和 $\\nu_{\\text{cs}} + J$。\n- 对于每个测试用例，您必须使用 $N$ 个点数值化地生成离散 FID，采样驻留时间为 $\\Delta t$（单位 $\\mathrm{s}$），即在时间点 $t_n = n\\,\\Delta t$（其中 $n = 0,1,\\dots,N-1$）进行采样。使用标准算法计算离散傅里叶变换，并生成以相应频率轴（单位 $\\mathrm{Hz}$）为基准的振幅谱 $\\lvert S(\\nu)\\rvert$。\n- 您的程序必须输出每个测试用例预测的三重峰峰位（单位 $\\mathrm{Hz}$，相对于发射机），并将所有测试用例的结果连接成一个单一的扁平列表，其中每个测试用例内的峰位按频率从低到高排序。程序可以使用上面推导出的解析位置，而无需对离散谱图进行寻峰，但仍必须在内部构建 FID 并执行离散傅里叶变换以验证一致性。所有角度必须以弧度为单位。所有频率必须以 $\\mathrm{Hz}$ 为单位表示。\n- 最终的数值答案以 $\\mathrm{Hz}$ 为单位，表示为浮点数，并四舍五入到三位小数。\n\n测试套件：\n\n对于所有情况，使用振幅权重 $[1,2,1]$，初始相位 $\\phi = 0$，以及每个案例中指定的采样参数 $N$ 和 $\\Delta t$。波谱仪频率 $\\nu_0$ 是质子的拉莫尔频率，单位为 $\\mathrm{Hz}$，其值由给定的 $\\mathrm{MHz}$ 数值乘以 $10^6$ 得出。\n\n- 案例 1 (正常路径):\n  - 化学位移 $\\delta = 7.250\\,\\mathrm{ppm}$,\n  - 标量耦合 $J = 7.200\\,\\mathrm{Hz}$,\n  - 波谱仪频率 $\\nu_0 = 400\\,\\mathrm{MHz}$,\n  - 表观横向弛豫 $T_2^\\ast = 0.500\\,\\mathrm{s}$,\n  - 点数 $N = 65536$,\n  - 驻留时间 $\\Delta t = 0.000050\\,\\mathrm{s}$.\n- 案例 2 (边界：合并线):\n  - 化学位移 $\\delta = 7.000\\,\\mathrm{ppm}$,\n  - 标量耦合 $J = 0.000\\,\\mathrm{Hz}$,\n  - 波谱仪频率 $\\nu_0 = 500\\,\\mathrm{MHz}$,\n  - 表观横向弛豫 $T_2^\\ast = 1.000\\,\\mathrm{s}$,\n  - 点数 $N = 65536$,\n  - 驻留时间 $\\Delta t = 0.000050\\,\\mathrm{s}$.\n- 案例 3 (边缘：高场下的小裂分):\n  - 化学位移 $\\delta = 6.800\\,\\mathrm{ppm}$,\n  - 标量耦合 $J = 1.000\\,\\mathrm{Hz}$,\n  - 波谱仪频率 $\\nu_0 = 600\\,\\mathrm{MHz}$,\n  - 表观横向弛豫 $T_2^\\ast = 0.300\\,\\mathrm{s}$,\n  - 点数 $N = 65536$,\n  - 驻留时间 $\\Delta t = 0.000050\\,\\mathrm{s}$.\n\n要求的最终输出格式：\n\n- 您的程序应生成单行输出，其中包含所有测试用例的预测峰位（单位 $\\mathrm{Hz}$），这些峰位在每个案例内按频率从低到高排序，四舍五入到三位小数，并以逗号分隔列表的形式包含在方括号中。例如，格式为 $[\\text{案例}_1\\_\\nu_1,\\text{案例}_1\\_\\nu_2,\\text{案例}_1\\_\\nu_3,\\text{案例}_2\\_\\nu_1,\\dots]$。", "solution": "主要任务是形式化构建一级芳香质子三重峰的自由感应衰减 (FID) 信号，并预测其谱峰位置。\n\n**1. FID 信号的理论推导**\n\n脉冲傅里叶变换 (FT) NMR 的基础是原子核自旋对射频脉冲的时域响应，这可以用布洛赫方程来描述。在以发射机频率进动的旋转参考坐标系中，对于具有角频率偏移 $\\omega$ 的单组等价自旋（一个等时自旋群），其横向磁化强度 $M_{xy}(t) = M_x(t) + \\mathrm{i} M_y(t)$ 根据所提供的方程演化：\n$$\nM_{xy}(t) = M_{xy}(0)\\,\\mathrm{e}^{-t/T_2^\\ast}\\,\\mathrm{e}^{\\mathrm{i}\\,\\omega t} \\quad \\text{for } t \\ge 0\n$$\n此处，$M_{xy}(0)$ 是激发脉冲刚结束时的复数横向磁化强度，$T_2^\\ast$ 是表观横向弛豫时间常数，它包含了固有的自旋-自旋弛豫 ($T_2$) 和磁场不均匀性效应。项 $\\mathrm{e}^{\\mathrm{i}\\,\\omega t}$ 描述了磁化矢量因其频率偏移而在旋转坐标系中的进动，而 $\\mathrm{e}^{-t/T_2^\\ast}$ 描述了该信号的衰减。\n\n问题指定了一个自旋系统，由一个质子与两个等价的相邻自旋-$\\tfrac{1}{2}$质子耦合组成。在弱耦合（一级）极限下，这种由耦合常数 $J$（单位 $\\mathrm{Hz}$）表征的标量耦合会将所观测质子的共振裂分为一个多重峰。根据 $n+1$ 规则，对于 $n=2$ 个等价相邻质子，信号为一个三重峰。这意味着存在三个不同的容许跃迁，从而产生三组具有不同共振频率的等时自旋群。\n\n线性叠加原理指出，检测到的总信号是这些非相互作用的各组信号之和。设旋转坐标系中的三个跃迁频率为 $\\nu_1$、$\\nu_2$ 和 $\\nu_3$（单位 $\\mathrm{Hz}$）。相应的角频率为 $\\omega_k = 2\\pi\\nu_k$。总的复数 FID 信号 $S_{complex}(t)$ 为：\n$$\nS_{complex}(t) = \\sum_{k=1}^{3} M_{xy,k}(0)\\,\\mathrm{e}^{-t/T_2^\\ast}\\,\\mathrm{e}^{\\mathrm{i}\\,2\\pi\\nu_k t}\n$$\n对于一个多重峰内的所有谱线，假设它们具有共同的 $T_2^\\ast$ 是一个很好的近似。\n\n问题提供了一级三重峰的具体频率和强度：\n- **频率**：三条谱线以化学位移偏移频率 $\\nu_{\\text{cs}}$ 为中心，并由耦合常数 $J$ 分隔。这些频率是：\n  $$\n  \\nu_1 = \\nu_{\\text{cs}} - J, \\quad \\nu_2 = \\nu_{\\text{cs}}, \\quad \\nu_3 = \\nu_{\\text{cs}} + J\n  $$\n  化学位移偏移 $\\nu_{\\text{cs}}$ 与化学位移 $\\delta$（单位 ppm）和波谱仪的拉莫尔频率 $\\nu_0$（单位 Hz）相关，关系式为 $\\nu_{\\text{cs}} = \\delta \\times \\nu_0 \\times 10^{-6}$。\n- **强度**：相对强度（即谱峰面积）遵循 $n=2$ 的帕斯卡三角形模式，即二项式系数 $\\binom{2}{0}, \\binom{2}{1}, \\binom{2}{2}$，得出的比例为 $1:2:1$。每个分量的初始磁化强度 $M_{xy,k}(0)$ 与这些强度成正比。\n\n我们可以写出 $M_{xy,k}(0) = C \\cdot A_k \\cdot \\mathrm{e}^{\\mathrm{i}\\phi}$，其中 $A_k = [1, 2, 1]$ 是相对振幅，$C$ 是一个实数值的全局振幅因子，$\\phi$ 是信号的初始相位。问题指定 $\\phi = 0$。因此，$M_{xy,k}(0)$ 可以被视为实数且与 $A_k$ 成正比。我们可以不失一般性地将比例常数设为 1，因为它只对整体信号进行缩放。那么复数 FID 为：\n$$\nS_{complex}(t) = \\mathrm{e}^{-t/T_2^\\ast} \\left( 1 \\cdot \\mathrm{e}^{\\mathrm{i}\\,2\\pi(\\nu_{\\text{cs}}-J)t} + 2 \\cdot \\mathrm{e}^{\\mathrm{i}\\,2\\pi\\nu_{\\text{cs}}t} + 1 \\cdot \\mathrm{e}^{\\mathrm{i}\\,2\\pi(\\nu_{\\text{cs}}+J)t} \\right)\n$$\n在标准的 NMR 实验中，硬件检测信号的单个相位，这对应于取复数信号的实部（或虚部，取决于相位校正）。实数值的 FID $s(t)$ 为：\n$$\ns(t) = \\mathrm{Re}[S_{complex}(t)] = \\mathrm{e}^{-t/T_2^\\ast} \\cdot \\mathrm{Re}\\left[ \\sum_{k=1}^{3} A_k \\mathrm{e}^{\\mathrm{i}\\,2\\pi\\nu_k t} \\right]\n$$\n使用欧拉恒等式 $\\mathrm{Re}[\\mathrm{e}^{\\mathrm{i}\\theta}] = \\cos(\\theta)$，我们得到问题陈述中给出的解析形式：\n$$\ns(t) = \\mathrm{e}^{-t/T_2^\\ast} \\sum_{k=1}^{3} A_k \\cos(2\\pi\\nu_k t)\n$$\n其中 $A_1=1, A_2=2, A_3=1$，频率 $\\nu_k$ 分别是 $\\nu_{\\text{cs}}-J, \\nu_{\\text{cs}}, \\nu_{\\text{cs}}+J$。这证实了所需信号构建的理论基础。\n\n**2. 频域谱与算法策略**\n\n频域谱 $S(\\nu)$ 是通过对时域信号 $s(t)$ 应用傅里叶变换 (FT) 获得的。指数衰减余弦 $A_k \\mathrm{e}^{-t/T_2^\\ast} \\cos(2\\pi\\nu_k t)$ 的傅里叶变换产生一对以频率 $\\pm\\nu_k$ 为中心的洛伦兹函数。对于这三项的和，振幅谱 $|\\!S(\\nu)\\!|$ 将在正频率 $\\nu_1, \\nu_2, \\nu_3$ 处展现出三个不同的峰，其峰高近似与振幅 $A_k$ 成正比。问题要求的是这些解析的峰位。\n\n每个测试用例的计算流程如下：\n1.  **计算解析峰位**：\n    - 从给定的 $\\mathrm{MHz}$ 值计算波谱仪频率 $\\nu_0$。\n    - 使用公式 $\\nu_{\\text{cs}} = \\delta \\times \\nu_0 \\times 10^{-6}$ 计算化学位移偏移频率 $\\nu_{\\text{cs}}$。\n    - 计算三个跃迁频率 $\\nu_k$ 分别为 $\\nu_{\\text{cs}}-J$、$\\nu_{\\text{cs}}$ 和 $\\nu_{\\text{cs}}+J$。这些是所需的输出值。\n2.  **通过数值模拟进行内部验证**：\n    - 生成离散时间轴 $t_n = n \\Delta t$，其中 $n = 0, \\dots, N-1$。\n    - 使用推导出的公式、计算出的频率 $\\nu_k$、给定的振幅 $A_k = [1,2,1]$ 和弛豫时间 $T_2^\\ast$ 生成解析 FID 信号 $s(t_n)$。\n    - 使用标准的 FFT 算法计算数值 FID $s(t_n)$ 的离散傅里叶变换 (DFT)。此步骤用于验证所推导的模型和参数能正确生成在解析预测频率处有峰的谱图。\n3.  **格式化输出**：收集所有测试用例的解析计算峰位，在每个案例内排序，四舍五入到三位小数，并按规定格式化为单个字符串。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.fft import fft\n\ndef solve():\n    \"\"\"\n    Calculates the analytical peak positions for a first-order NMR triplet,\n    and internally verifies the result by simulating the FID and its FFT.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {\n            \"delta\": 7.250,      # ppm\n            \"J\": 7.200,          # Hz\n            \"nu0_MHz\": 400.0,    # MHz\n            \"T2_star\": 0.500,    # s\n            \"N\": 65536,\n            \"dt\": 0.000050,      # s\n        },\n        # Case 2: boundary: coalesced lines\n        {\n            \"delta\": 7.000,\n            \"J\": 0.000,\n            \"nu0_MHz\": 500.0,\n            \"T2_star\": 1.000,\n            \"N\": 65536,\n            \"dt\": 0.000050,\n        },\n        # Case 3: edge: small splitting on higher field\n        {\n            \"delta\": 6.800,\n            \"J\": 1.000,\n            \"nu0_MHz\": 600.0,\n            \"T2_star\": 0.300,\n            \"N\": 65536,\n            \"dt\": 0.000050,\n        },\n    ]\n\n    all_peak_positions = []\n    \n    # Amplitudes for a triplet are based on binomial coefficients (1:2:1)\n    amplitudes = np.array([1.0, 2.0, 1.0])\n\n    for case in test_cases:\n        # Unpack parameters for the current case\n        delta = case[\"delta\"]\n        J = case[\"J\"]\n        nu0_MHz = case[\"nu0_MHz\"]\n        T2_star = case[\"T2_star\"]\n        N = case[\"N\"]\n        dt = case[\"dt\"]\n\n        # 1. Calculate analytical peak positions\n        # Convert spectrometer frequency from MHz to Hz\n        nu0 = nu0_MHz * 1e6\n        # Calculate chemical shift offset frequency in Hz\n        nu_cs = delta * nu0 * 1e-6\n\n        # Calculate the three transition frequencies for the triplet\n        nu1 = nu_cs - J\n        nu2 = nu_cs\n        nu3 = nu_cs + J\n        \n        # Store the analytically calculated frequencies\n        frequencies = np.array([nu1, nu2, nu3])\n        \n        # Add the sorted list of frequencies to the final results\n        all_peak_positions.extend(sorted(frequencies))\n\n        # 2. Internal verification: Construct FID and compute FFT\n        # This part is required by the problem for consistency check, but its\n        # results are not part of the final printed output.\n        \n        # Create the time axis for the discrete signal\n        t = np.arange(N) * dt\n        \n        # Construct the FID signal using broadcasting for efficiency\n        # s(t) = exp(-t/T2*) * sum_k(A_k * cos(2*pi*nu_k*t))\n        # shape of frequencies: (3,); shape of t: (N,)\n        # shape of frequencies[:, np.newaxis]: (3,1); shape of t: (N,) -> broadcasting to (3,N)\n        cos_waves = np.cos(2 * np.pi * frequencies[:, np.newaxis] * t)\n        \n        # Perform weighted sum of the cosine waves\n        # np.dot with shapes (3,) and (3,N) results in shape (N,)\n        weighted_sum_cos = np.dot(amplitudes, cos_waves)\n        \n        # Apply the exponential decay\n        fid = np.exp(-t / T2_star) * weighted_sum_cos\n        \n        # Compute the Discrete Fourier Transform. This is for verification as per instructions.\n        # The result 'spectrum' is not used further, but its computation is mandatory.\n        spectrum = fft(fid)\n\n    # Final print statement in the exact required format.\n    # Format each peak position to three decimal places.\n    formatted_results = [f\"{peak:.3f}\" for peak in all_peak_positions]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3720138"}]}