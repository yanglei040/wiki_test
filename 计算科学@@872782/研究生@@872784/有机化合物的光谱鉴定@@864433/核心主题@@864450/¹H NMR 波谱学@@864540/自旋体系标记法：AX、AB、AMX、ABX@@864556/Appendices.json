{"hands_on_practices": [{"introduction": "核磁共振波谱中的 AB 型自旋体系是理解二级谱图的起点。本练习将引导你从基本的双自旋哈密頓量出发，通过量子力学计算推导出能级和跃迁频率，从而揭示谱线位置与化学位移差 ($|\\Delta|$) 和耦合常数 ($J$) 之间的精确数学关系。完成此练习将帮助你深入理解 AB 型四重峰的量子力学起源，并掌握从谱图数据反推物理参数的核心分析方法 [@problem_id:3725187]。", "problem": "一个有机分子中的一对非对映异构质子在高场下表现为 AB 型核磁共振 (NMR) 自旋体系。这些自旋通过各向同性标量耦合相互作用，并相对于载波具有不同的拉莫尔频率，从而产生一个 AB 四重峰。以频率单位表示的规范双自旋-1/2各向同性哈密顿量由下式给出：\n$$\n\\frac{H}{h} \\;=\\; \\nu_{A} I_{Az} \\;+\\; \\nu_{B} I_{Bz} \\;+\\; J \\left( I_{Ax} I_{Bx} \\;+\\; I_{Ay} I_{By} \\;+\\; I_{Az} I_{Bz} \\right),\n$$\n其中 $h$ 是普朗克常数，$\\nu_{A}$ 和 $\\nu_{B}$ 是自旋 $A$ 和 $B$ 以 $\\mathrm{Hz}$ 为单位的拉莫尔频率，$J$ 是以 $\\mathrm{Hz}$ 为单位的标量耦合，$I_{A\\alpha}$ 和 $I_{B\\alpha}$ (其中 $\\alpha \\in \\{x,y,z\\}$) 是自旋算符。定义频率差为 $\\Delta \\equiv \\nu_{A} - \\nu_{B}$，平均频率为 $\\bar{\\nu} \\equiv (\\nu_{A} + \\nu_{B})/2$。\n\n在 AB 谱中，四个跃迁对称地出现在 $\\bar{\\nu}$ 两侧。设 $p$ 表示从 $\\bar{\\nu}$ 到两侧外侧谱线的偏移（单位为 $\\mathrm{Hz}$）的两倍，设 $q$ 表示从 $\\bar{\\nu}$ 到两侧内侧谱线的偏移（单位为 $\\mathrm{Hz}$）的两倍。因此，外侧谱线位于 $\\bar{\\nu} \\pm p/2$，内侧谱线位于 $\\bar{\\nu} \\pm q/2$，其中 $p > q > 0$ 是从谱图中直接测得的。\n\n从上述哈密顿量和基本自旋算符代数出发，推导出四个能量本征值，确定四个允许的单量子跃迁，并证明 $p$ 和 $q$ 满足两个不变量，从而可以确定标量耦合 $J$ 和频率差的绝对值 $|\\Delta|$。请仔细解释为什么只能从谱线位置得到 $|\\Delta|$，而无法得到 $\\Delta$ 的符号。\n\n对于在 $500\\,\\mathrm{MHz}$ 谱仪频率下记录的特定 AB 谱，测量值为 $p = 80.0\\,\\mathrm{Hz}$ 和 $q = 20.0\\,\\mathrm{Hz}$。使用您推导出的不变量，计算 $J$ 和 $|\\Delta|$。将最终数值答案以 $\\mathrm{Hz}$ 为单位表示，并四舍五入到四位有效数字。", "solution": "该问题要求推导双自旋-1/2 AB 体系的能量本征值和跃迁频率，并由此根据谱线位置确定标量耦合 $J$ 和化学位移差 $|\\Delta|$。\n\n**步骤 1：哈密顿量的本征值**\n\n该双自旋体系的哈密顿量以频率单位 ($\\mathrm{Hz}$) 表示为：\n$$\n\\mathcal{H} = \\frac{H}{h} = \\nu_{A} I_{Az} + \\nu_{B} I_{Bz} + J (I_{Ax}I_{Bx} + I_{Ay}I_{By} + I_{Az}I_{Bz})\n$$\n使用定义 $\\Delta = \\nu_{A} - \\nu_{B}$ 和 $\\bar{\\nu} = (\\nu_{A} + \\nu_{B})/2$，我们可以将 $\\nu_{A}$ 和 $\\nu_{B}$ 改写为 $\\nu_{A} = \\bar{\\nu} + \\Delta/2$ 和 $\\nu_{B} = \\bar{\\nu} - \\Delta/2$。自旋-自旋耦合项可以用升降算符表示为 $\\vec{I}_A \\cdot \\vec{I}_B = I_{Az}I_{Bz} + \\frac{1}{2}(I_{A+}I_{B-} + I_{A-}I_{B+})$。\n哈密顿量变为：\n$$\n\\mathcal{H} = \\bar{\\nu}(I_{Az} + I_{Bz}) + \\frac{\\Delta}{2}(I_{Az} - I_{Bz}) + J I_{Az}I_{Bz} + \\frac{J}{2}(I_{A+}I_{B-} + I_{A-}I_{B+})\n$$\n我们在非耦合乘积基 $\\{|\\alpha_A\\alpha_B\\rangle, |\\alpha_A\\beta_B\\rangle, |\\beta_A\\alpha_B\\rangle, |\\beta_A\\beta_B\\rangle\\}$ 中计算哈密顿量。我们将这些态表示为 $|1\\rangle, |2\\rangle, |3\\rangle, |4\\rangle$。总自旋投影量子数 $M_I = m_{IA} + m_{IB}$ 是一个好量子数，因此哈密顿矩阵是块对角的。态 $|1\\rangle$ ($M_I=1$) 和 $|4\\rangle$ ($M_I=-1$) 已经是本征态。\n态 $|1\\rangle = |\\alpha\\alpha\\rangle$ 的能量为：\n$$\nE_1/h = \\langle\\alpha\\alpha|\\mathcal{H}|\\alpha\\alpha\\rangle = \\bar{\\nu}\\left(\\frac{1}{2}+\\frac{1}{2}\\right) + \\frac{\\Delta}{2}\\left(\\frac{1}{2}-\\frac{1}{2}\\right) + J\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) = \\bar{\\nu} + \\frac{J}{4}\n$$\n态 $|4\\rangle = |\\beta\\beta\\rangle$ 的能量为：\n$$\nE_4/h = \\langle\\beta\\beta|\\mathcal{H}|\\beta\\beta\\rangle = \\bar{\\nu}\\left(-\\frac{1}{2}-\\frac{1}{2}\\right) + \\frac{\\Delta}{2}\\left(-\\frac{1}{2}-\\left(-\\frac{1}{2}\\right)\\right) + J\\left(-\\frac{1}{2}\\right)\\left(-\\frac{1}{2}\\right) = -\\bar{\\nu} + \\frac{J}{4}\n$$\n态 $|2\\rangle = |\\alpha\\beta\\rangle$ 和 $|3\\rangle = |\\beta\\alpha\\rangle$ 的 $M_I$ 均为 0，并被哈密顿量混合。这个块的 $2 \\times 2$ 子矩阵为：\n$$\n\\mathbf{H}_{M_I=0} = \\begin{pmatrix} \\langle\\alpha\\beta|\\mathcal{H}|\\alpha\\beta\\rangle & \\langle\\alpha\\beta|\\mathcal{H}|\\beta\\alpha\\rangle \\\\ \\langle\\beta\\alpha|\\mathcal{H}|\\alpha\\beta\\rangle & \\langle\\beta\\alpha|\\mathcal{H}|\\beta\\alpha\\rangle \\end{pmatrix}\n$$\n对角元为：\n$$\nH_{22} = \\bar{\\nu}\\left(\\frac{1}{2}-\\frac{1}{2}\\right) + \\frac{\\Delta}{2}\\left(\\frac{1}{2}-\\left(-\\frac{1}{2}\\right)\\right) + J\\left(\\frac{1}{2}\\right)\\left(-\\frac{1}{2}\\right) = \\frac{\\Delta}{2} - \\frac{J}{4}\n$$\n$$\nH_{33} = \\bar{\\nu}\\left(-\\frac{1}{2}+\\frac{1}{2}\\right) + \\frac{\\Delta}{2}\\left(-\\frac{1}{2}-\\frac{1}{2}\\right) + J\\left(-\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) = -\\frac{\\Delta}{2} - \\frac{J}{4}\n$$\n非对角元为：\n$$\nH_{23} = \\left\\langle\\alpha\\beta\\left|\\frac{J}{2}(I_{A+}I_{B-} + I_{A-}I_{B+})\\right|\\beta\\alpha\\right\\rangle = \\frac{J}{2}\n$$\n由于哈密顿量是厄米的，所以 $H_{32} = H_{23} = J/2$。该子矩阵为：\n$$\n\\mathbf{H}_{M_I=0} = \\begin{pmatrix} \\frac{\\Delta}{2} - \\frac{J}{4} & \\frac{J}{2} \\\\ \\frac{J}{2} & -\\frac{\\Delta}{2} - \\frac{J}{4} \\end{pmatrix}\n$$\n本征值 $\\lambda$ 可通过解特征方程 $\\det(\\mathbf{H}_{M_I=0} - \\lambda\\mathbf{I}) = 0$ 得到：\n$$\n\\left(\\frac{\\Delta}{2} - \\frac{J}{4} - \\lambda\\right)\\left(-\\frac{\\Delta}{2} - \\frac{J}{4} - \\lambda\\right) - \\frac{J^2}{4} = 0\n$$\n这给出 $(\\lambda+\\frac{J}{4})^2 - (\\frac{\\Delta}{2})^2 - (\\frac{J}{2})^2 = 0$，解得 $\\lambda = -\\frac{J}{4} \\pm \\frac{1}{2}\\sqrt{\\Delta^2 + J^2}$。\n我们将得到的能量本征值称为 $E_2/h$ 和 $E_3/h$。\n因此，以频率单位表示的四个能量本征值，从高到低排列为：\n$$\nE_1/h = \\nu_1 = \\bar{\\nu} + \\frac{J}{4}\n$$\n$$\nE_2/h = \\nu_2 = \\frac{1}{2}\\sqrt{\\Delta^2 + J^2} - \\frac{J}{4}\n$$\n$$\nE_3/h = \\nu_3 = -\\frac{1}{2}\\sqrt{\\Delta^2 + J^2} - \\frac{J}{4}\n$$\n$$\nE_4/h = \\nu_4 = -\\bar{\\nu} + \\frac{J}{4}\n$$\n\n**步骤 2：允许的跃迁和频率**\n\n只有当总自旋投影量子数变化为 1 时，即 $\\Delta M_I = \\pm 1$ 时，单量子 NMR 跃迁才是允许的。本征态为 $|1\\rangle$ ($M_I=1$)、$|4\\rangle$ ($M_I=-1$) 以及在 $M_I=0$ 子空间中的两个混合态，我们同样称之为 $|2\\rangle$ 和 $|3\\rangle$。因此，四个允许的跃迁是 $3 \\to 1$、$2 \\to 1$、$4 \\to 3$ 和 $4 \\to 2$。\n这些跃迁的频率（吸收过程）由能级差给出：\n$$\nf_{3 \\to 1} = \\nu_1 - \\nu_3 = \\left(\\bar{\\nu} + \\frac{J}{4}\\right) - \\left(-\\frac{1}{2}\\sqrt{\\Delta^2 + J^2} - \\frac{J}{4}\\right) = \\bar{\\nu} + \\frac{J}{2} + \\frac{1}{2}\\sqrt{\\Delta^2+J^2}\n$$\n$$\nf_{2 \\to 1} = \\nu_1 - \\nu_2 = \\left(\\bar{\\nu} + \\frac{J}{4}\\right) - \\left(\\frac{1}{2}\\sqrt{\\Delta^2 + J^2} - \\frac{J}{4}\\right) = \\bar{\\nu} + \\frac{J}{2} - \\frac{1}{2}\\sqrt{\\Delta^2+J^2}\n$$\n$$\nf_{4 \\to 2} = \\nu_2 - \\nu_4 = \\left(\\frac{1}{2}\\sqrt{\\Delta^2 + J^2} - \\frac{J}{4}\\right) - \\left(-\\bar{\\nu} + \\frac{J}{4}\\right) = \\bar{\\nu} - \\frac{J}{2} + \\frac{1}{2}\\sqrt{\\Delta^2+J^2}\n$$\n$$\nf_{4 \\to 3} = \\nu_3 - \\nu_4 = \\left(-\\frac{1}{2}\\sqrt{\\Delta^2 + J^2} - \\frac{J}{4}\\right) - \\left(-\\bar{\\nu} + \\frac{J}{4}\\right) = \\bar{\\nu} - \\frac{J}{2} - \\frac{1}{2}\\sqrt{\\Delta^2+J^2}\n$$\n\n**步骤 3：$J$ 和 $|\\Delta|$ 的不变量推导**\n\n这四个跃迁频率关于 $\\bar{\\nu}$ 对称。它们相对于 $\\bar{\\nu}$ 的偏移量为：\n$$\nf - \\bar{\\nu} = \\pm \\frac{J}{2} \\pm \\frac{1}{2}\\sqrt{\\Delta^2+J^2}\n$$\n假设 $J>0$。条件 $\\sqrt{\\Delta^2+J^2} > J$ 成立。令 $C = \\frac{1}{2}\\sqrt{\\Delta^2+J^2}$。四个偏移量为 $\\pm(C + J/2)$ 和 $\\pm(C - J/2)$。\n问题定义 $p$ 和 $q$ 使得外侧谱线位于 $\\bar{\\nu} \\pm p/2$，内侧谱线位于 $\\bar{\\nu} \\pm q/2$。到外侧谱线的偏移量大小为 $p/2$，到内侧谱线的偏移量大小为 $q/2$。由于 $p>q$，我们有：\n$$\n\\frac{p}{2} = C + \\frac{|J|}{2} = \\frac{1}{2}\\sqrt{\\Delta^2+J^2} + \\frac{|J|}{2} \\implies p = \\sqrt{\\Delta^2+J^2} + |J|\n$$\n$$\n\\frac{q}{2} = C - \\frac{|J|}{2} = \\frac{1}{2}\\sqrt{\\Delta^2+J^2} - \\frac{|J|}{2} \\implies q = \\sqrt{\\Delta^2+J^2} - |J|\n$$\n注意，我们使用 $|J|$ 来确保结果的普适性，尽管问题设置 $p>q$ 强制要求 $|J|>0$。我们可以解这个方程组来求 $|J|$ 和 $|\\Delta|$。\n第一个方程减去第二个方程得到：\n$$\np - q = (\\sqrt{\\Delta^2+J^2} + |J|) - (\\sqrt{\\Delta^2+J^2} - |J|) = 2|J|\n$$\n因此，标量耦合的大小为：\n$$\n|J| = \\frac{p-q}{2}\n$$\n两个方程相加得到：\n$$\np + q = (\\sqrt{\\Delta^2+J^2} + |J|) + (\\sqrt{\\Delta^2+J^2} - |J|) = 2\\sqrt{\\Delta^2+J^2}\n$$\n两边平方并求解 $\\Delta^2$：\n$$\n\\left(\\frac{p+q}{2}\\right)^2 = \\Delta^2 + J^2 \\implies \\Delta^2 = \\left(\\frac{p+q}{2}\\right)^2 - J^2\n$$\n代入 $|J|$ 的表达式，我们有 $J^2 = \\left(\\frac{p-q}{2}\\right)^2$：\n$$\n\\Delta^2 = \\left(\\frac{p+q}{2}\\right)^2 - \\left(\\frac{p-q}{2}\\right)^2 = \\frac{p^2+2pq+q^2 - (p^2-2pq+q^2)}{4} = \\frac{4pq}{4} = pq\n$$\n因此，化学位移差的绝对值为：\n$$\n|\\Delta| = \\sqrt{pq}\n$$\n这两个关系式，$|J|=(p-q)/2$ 和 $|\\Delta|=\\sqrt{pq}$，就是所要求的不变量。\n\n**只确定 $|\\Delta|$ 的原因解释**\n能量本征值以及由此产生的跃迁频率，仅通过 $\\Delta^2$ 项依赖于 $\\Delta$。$p$ 和 $q$ 的表达式为 $p = \\sqrt{\\Delta^2+J^2} + |J|$ 和 $q = \\sqrt{\\Delta^2+J^2} - |J|$。改变 $\\Delta$ 的符号（即交换 $\\nu_A$ 和 $\\nu_B$）不会改变 $\\Delta^2$ 的值。因此，对于 $\\Delta$ 和 $-\\Delta$，谱图中的谱线位置是相同的。结果是，人们只能从谱线位置确定其绝对值 $|\\Delta|$。确定 $\\Delta$ 的符号需要额外的信息，例如跃迁的相对强度，它取决于 $M_I=0$ 态的混合程度，并且相对于 $\\Delta/J$ 的符号是不对称的。\n\n**步骤 4：数值计算**\n\n给定测量的谱图参数 $p = 80.0\\,\\mathrm{Hz}$ 和 $q = 20.0\\,\\mathrm{Hz}$。\n使用推导出的不变量，我们计算 $J$ 和 $|\\Delta|$。由于无法从谱线位置确定 $J$ 的符号，我们报告其大小 $|J|$。\n$$\n|J| = \\frac{p-q}{2} = \\frac{80.0\\,\\mathrm{Hz} - 20.0\\,\\mathrm{Hz}}{2} = \\frac{60.0\\,\\mathrm{Hz}}{2} = 30.0\\,\\mathrm{Hz}\n$$\n$$\n|\\Delta| = \\sqrt{pq} = \\sqrt{(80.0\\,\\mathrm{Hz})(20.0\\,\\mathrm{Hz})} = \\sqrt{1600\\,\\mathrm{Hz}^2} = 40.0\\,\\mathrm{Hz}\n$$\n问题要求最终答案四舍五入到四位有效数字。\n输入值有三位有效数字。用这些值计算得到 $|J|=30.0\\,\\mathrm{Hz}$ 和 $|\\Delta|=40.0\\,\\mathrm{Hz}$。为了满足输出要求，我们将这些值表示为四位有效数字。\n$J = 30.00\\,\\mathrm{Hz}$ (报告其大小)\n$|\\Delta| = 40.00\\,\\mathrm{Hz}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n30.00 & 40.00\n\\end{pmatrix}\n}\n$$", "id": "3725187"}, {"introduction": "在掌握了二级谱的基本理论后，我们将转向更常见但分析上更直观的一级谱。AMX 体系代表了三个弱耦合的自旋核，其谱图可以通过简单的一级分裂规则进行解析。本练习提供了一个典型的 AMX 体系的谱线数据，要求你从第一性原理出发，推导并应用裂分规则来提取所有的耦合常数，并通过交叉验证来确认结果的自洽性 [@problem_id:3725227]。这项实践旨在培养你快速、准确地从复杂多重峰中解读结构信息的核心技能。", "problem": "在有机化合物的质子核磁共振（NMR）波谱法中，自旋系统表示法 $\\mathrm{AMX}$ 指代三个磁不等价的自旋-$\\tfrac{1}{2}$原子核，每对原子核之间通过一个标量耦合常数耦合。\n\n在弱耦合极限下，化学位移差（以频率单位计）满足 $|\\nu_{i}-\\nu_{j}| \\gg |J_{ij}|$（对于所有原子核对 $(i,j) \\in \\{(A,M),(A,X),(M,X)\\}$），自旋 $A$、自旋 $M$ 和自旋 $X$ 的每个观测到的单量子跃迁由于成对的标量耦合而裂分为双重峰的二重峰。\n\n一个呈现 $\\mathrm{AMX}$ 模式的样品以足够高的数字分辨率被记录下来，使得各个谱线的频率（单位为赫兹，$\\mathrm{Hz}$，相对于固定的谱仪载波频率）可以直接从谱图中读出。以下几组四个频率分别对应于自旋 $A$、$M$ 和 $X$ 的已分辨多重峰；在每组内，频率按升序排列：\n\n- $A$ 多重峰：$338.6$, $342.2$, $347.8$, $351.4$.\n- $M$ 多重峰：$269.8$, $271.0$, $279.0$, $280.2$.\n- $X$ 多重峰：$187.6$, $188.8$, $191.2$, $192.4$.\n\n从弱耦合自旋哈密顿量的第一性原理和单量子跃迁的选择定则出发，且不使用任何快捷公式，推导双重峰的二重峰的位置如何编码与该自旋相关的两个耦合常数。仅使用 $A$ 多重峰的四个频率，确定标量耦合常数 $J_{AM}$ 和 $J_{AX}$（单位为 $\\mathrm{Hz}$）。然后通过交叉核对 $M$ 和 $X$ 多重峰来验证您提取结果的正确性，以确保 $\\mathrm{AMX}$ 系统的内部一致性。\n\n将 $J_{AM}$ 和 $J_{AX}$ 的最终数值以赫兹表示。将您的最终结果四舍五入至三位有效数字。", "solution": "首先对问题进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n- **系统**：三个磁不等价的自旋-$\\frac{1}{2}$原子核，记为 $\\mathrm{AMX}$ 系统。\n- **条件**：系统处于弱耦合极限，其中化学位移差满足 $|\\nu_{i}-\\nu_{j}| \\gg |J_{ij}|$（对于所有原子核对 $(i,j) \\in \\{(A,M),(A,X),(M,X)\\}$）。\n- **观测**：每个自旋的多重峰都是双重峰的二重峰。\n- **数据**：每个多重峰的四个观测谱线频率（单位为 $\\mathrm{Hz}$），按升序排列：\n  - $A$ 多重峰：$338.6$, $342.2$, $347.8$, $351.4$.\n  - $M$ 多重峰：$269.8$, $271.0$, $279.0$, $280.2$.\n  - $X$ 多重峰：$187.6$, $188.8$, $191.2$, $192.4$.\n- **任务**：\n  1. 从第一性原理出发，推导耦合常数如何被编码在双重峰的二重峰的谱线位置中。\n  2. 仅使用 $A$ 多重峰的频率，确定标量耦合常数 $J_{AM}$ 和 $J_{AX}$。\n  3. 通过与 $M$ 和 $X$ 多重峰进行交叉核对来验证提取结果。\n- **输出格式**：$J_{AM}$ 和 $J_{AX}$ 的最终数值，单位为 $\\mathrm{Hz}$，四舍五入至三位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于核磁共振（NMR）波谱学的基本原理，特别是弱耦合自旋系统的一阶分析。$\\mathrm{AMX}$ 自旋系统、标量（$J$）耦合的概念以及由此产生的多重峰模式是化学和物理学中核心且成熟的概念。\n2.  **适定性**：该问题提供了足够的数值数据和明确的任务来确定所要求的参数。解的存在性、唯一性和稳定性可以通过标准的分析程序来确定，而问题本身就要求推导这个程序。\n3.  **客观性**：该问题使用精确、标准的科学术语进行陈述。数据是客观的数值测量。\n4.  **完整性与一致性**：该问题提供了进行计算所需的所有必要数据（谱线频率）。明确指示要交叉核对所有三个多重峰的结果以确保一致性，这表明数据集对于此任务是内部一致且完整的。弱耦合条件 $|\\nu_i-\\nu_j| \\gg |J_{ij}|$ 是作为一个前提给出的，其有效性可以在计算后进行验证。\n5.  **未检测到其他缺陷**：该问题不是隐喻性的、琐碎的或无法验证的。它是定量化学分析中的一个标准的、可解的问题。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它科学上合理、适定、客观，并包含足够的信息以获得唯一解。开始求解。\n\n### 第一性原理推导\n对于一个弱耦合的三自旋-$\\frac{1}{2}$系统 $(\\mathrm{A, M, X})$，忽略弛豫并以频率单位（$\\mathrm{Hz}$）表示，其哈密顿量由塞曼项和标量耦合项之和给出。在一阶（弱耦合）近似下，对于耦合部分，只保留在自旋态的乘积基中对角化的项。\n$$ \\hat{H} = \\nu_A \\hat{I}_{zA} + \\nu_M \\hat{I}_{zM} + \\nu_X \\hat{I}_{zX} + J_{AM} \\hat{I}_{zA} \\hat{I}_{zM} + J_{AX} \\hat{I}_{zA} \\hat{I}_{zX} + J_{MX} \\hat{I}_{zM} \\hat{I}_{zX} $$\n此处，$\\nu_i$ 是自旋 $i$ 的拉莫尔频率，$\\hat{I}_{zi}$ 是自旋 $i$ 的自旋角动量 $z$ 分量的算符，而 $J_{ij}$ 是自旋 $i$ 和 $j$ 之间的标量耦合常数。\n\n基态是简单的乘积态 $|m_A m_M m_X\\rangle$，其中 $m_i \\in \\{+\\frac{1}{2}, -\\frac{1}{2}\\}$ 是磁量子数。为方便起见，我们用 $\\alpha$ 表示 $m_i=+\\frac{1}{2}$，用 $\\beta$ 表示 $m_i=-\\frac{1}{2}$。由于这些基态是所有 $\\hat{I}_{zi}$ 算符的本征态，它们也是一阶哈密顿量 $\\hat{H}$ 的本征态。一个态 $|m_A m_M m_X\\rangle$ 的能量本征值 $E$ 为：\n$$ E(m_A, m_M, m_X) = \\nu_A m_A + \\nu_M m_M + \\nu_X m_X + J_{AM} m_A m_M + J_{AX} m_A m_X + J_{MX} m_M m_X $$\n\n自旋 $A$ 的单量子跃迁遵循选择定则 $\\Delta m_A = \\pm 1$、$\\Delta m_M = 0$ 和 $\\Delta m_X = 0$。我们考虑从 $m_A = -\\frac{1}{2}$ ($\\beta$) 的态跃迁到 $m_A = +\\frac{1}{2}$ ($\\alpha$) 的态，而 $M$ 和 $X$ 的自旋态保持不变。这种跃迁的频率是终态和初态之间的能量差。\n$$ \\nu_{trans} = E(+\\tfrac{1}{2}, m_M, m_X) - E(-\\tfrac{1}{2}, m_M, m_X) $$\n代入能量表达式：\n$$ \\nu_{trans} = \\left(\\frac{1}{2}\\nu_A + \\nu_M m_M + \\nu_X m_X + \\frac{1}{2}J_{AM} m_M + \\frac{1}{2}J_{AX} m_X + J_{MX} m_M m_X\\right) - \\left(-\\frac{1}{2}\\nu_A + \\nu_M m_M + \\nu_X m_X - \\frac{1}{2}J_{AM} m_M - \\frac{1}{2}J_{AX} m_X + J_{MX} m_M m_X\\right) $$\n$$ \\nu_{trans} = \\nu_A + J_{AM} m_M + J_{AX} m_X $$\n$M$ 和 $X$ 的自旋态 $(m_M, m_X)$ 有四种可能的组合，导致自旋 $A$ 有四个不同的跃迁频率：\n1. $m_M=+\\frac{1}{2}$, $m_X=+\\frac{1}{2}$ (自旋 $\\alpha\\alpha$): $\\nu_1 = \\nu_A + \\frac{1}{2}J_{AM} + \\frac{1}{2}J_{AX}$\n2. $m_M=+\\frac{1}{2}$, $m_X=-\\frac{1}{2}$ (自旋 $\\alpha\\beta$): $\\nu_2 = \\nu_A + \\frac{1}{2}J_{AM} - \\frac{1}{2}J_{AX}$\n3. $m_M=-\\frac{1}{2}$, $m_X=+\\frac{1}{2}$ (自旋 $\\beta\\alpha$): $\\nu_3 = \\nu_A - \\frac{1}{2}J_{AM} + \\frac{1}{2}J_{AX}$\n4. $m_M=-\\frac{1}{2}$, $m_X=-\\frac{1}{2}$ (自旋 $\\beta\\beta$): $\\nu_4 = \\nu_A - \\frac{1}{2}J_{AM} - \\frac{1}{2}J_{AX}$\n\n这四条谱线构成一个以 $\\nu_A$ 为中心的双重峰的二重峰。为了提取耦合常数，我们分析这些谱线之间的间距。我们计算各对频率之间的绝对差：\n- $|\\nu_1 - \\nu_2| = |(\\nu_A + \\frac{1}{2}J_{AM} + \\frac{1}{2}J_{AX}) - (\\nu_A + \\frac{1}{2}J_{AM} - \\frac{1}{2}J_{AX})| = |J_{AX}|$\n- $|\\nu_3 - \\nu_4| = |(\\nu_A - \\frac{1}{2}J_{AM} + \\frac{1}{2}J_{AX}) - (\\nu_A - \\frac{1}{2}J_{AM} - \\frac{1}{2}J_{AX})| = |J_{AX}|$\n- $|\\nu_1 - \\nu_3| = |(\\nu_A + \\frac{1}{2}J_{AM} + \\frac{1}{2}J_{AX}) - (\\nu_A - \\frac{1}{2}J_{AM} + \\frac{1}{2}J_{AX})| = |J_{AM}|$\n- $|\\nu_2 - \\nu_4| = |(\\nu_A + \\frac{1}{2}J_{AM} - \\frac{1}{2}J_{AX}) - (\\nu_A - \\frac{1}{2}J_{AM} - \\frac{1}{2}J_{AX})| = |J_{AM}|$\n\n这表明该多重峰由两对谱线组成，每对谱线之间的距离为 $|J_{AX}|$，而这两对谱线的中心之间的距离为 $|J_{AM}|$。等效地，它也由两对谱线组成，每对谱线之间的距离为 $|J_{AM}|$，而中心之间的距离为 $|J_{AX}|$。设观测到的频率按升序排列为 $f_1, f_2, f_3, f_4$。观测到的两个裂分对应于两个耦合常数。我们可以这样计算它们：\n裂分 1：$f_2 - f_1$（并与 $f_4 - f_3$ 一致）。\n裂分 2：$f_3 - f_2$ 是两个双重峰中心的距离，也等于 $f_4 - f_1 - (f_2-f_1) - (f_4-f_3)$。一个更直接的方法是，较大的裂分等于两个外侧谱线的距离减去较小的裂分，即 $(f_4-f_1) - (f_2-f_1) = f_4 - f_2$。\n实际上，两个裂分就是两个独立的谱线间距，例如 $f_2-f_1$ 和 $f_3-f_1-(f_2-f_1)=f_3-f_2$。不，这不是裂分。\n两个裂分就是 $f_2-f_1$（等于 $f_4-f_3$）和 $f_3-f_2+f_2-f_1=f_3-f_1$（等于 $f_4-f_2$）。\n简单来说，两个耦合常数的大小等于两个较小裂分之和，以及两个较小裂分之差的绝对值。不，这是不对的。\n两个裂分就是两个双重峰内部的裂分，和两个双重峰中心之间的距离。\n第一个裂分是 $f_2-f_1=f_4-f_3$。第二个裂分是 $f_3-f_2$ (两个内线之差)吗？不是。第二个裂分是 $(f_3+f_4)/2 - (f_1+f_2)/2$。\n\n让我们使用实际数据来确定。\n$A$多重峰: 338.6, 342.2, 347.8, 351.4.\n间距: 3.6, 5.6, 3.6.\n这表明其中一个裂分是 3.6 Hz。另一个裂分是两个双重峰中心之间的距离。双重峰1中心: (338.6+342.2)/2 = 340.4。双重峰2中心: (347.8+351.4)/2 = 349.6。它们之间的距离是 349.6 - 340.4 = 9.2 Hz。\n因此，两个耦合常数的大小是 3.6 Hz 和 9.2 Hz。\n\n### 计算与验证\n**1. $A$ 多重峰的分析**\n给定的频率为 $f_{A1}=338.6 \\ \\mathrm{Hz}$，$f_{A2}=342.2 \\ \\mathrm{Hz}$，$f_{A3}=347.8 \\ \\mathrm{Hz}$ 和 $f_{A4}=351.4 \\ \\mathrm{Hz}$。\n- 裂分 1：\n  $f_{A2} - f_{A1} = 342.2 - 338.6 = 3.6 \\ \\mathrm{Hz}$。\n  检验：$f_{A4} - f_{A3} = 351.4 - 347.8 = 3.6 \\ \\mathrm{Hz}$。这是其中一个耦合常数。\n- 裂分 2：\n  是两个双重峰中心之间的距离。中心1 = $(f_{A1}+f_{A2})/2 = 340.4$ Hz。中心2 = $(f_{A3}+f_{A4})/2 = 349.6$ Hz。\n  距离 = $349.6 - 340.4 = 9.2 \\ \\mathrm{Hz}$。这是另一个耦合常数。\n\n仅从 $A$ 多重峰，我们确定涉及自旋 $A$ 的耦合常数集合为 $\\{ |J_{AM}|, |J_{AX}| \\} = \\{ 3.6 \\ \\mathrm{Hz}, 9.2 \\ \\mathrm{Hz} \\}$。为了确定哪个值对应 $J_{AM}$，哪个对应 $J_{AX}$，我们必须分析其他多重峰。$A$ 的化学位移是多重峰的中心：$\\nu_A = \\frac{1}{4}(338.6 + 342.2 + 347.8 + 351.4) = 345.0 \\ \\mathrm{Hz}$。\n\n**2. 验证与交叉核对**\n我们现在分析 $M$ 和 $X$ 多重峰，以验证系统并指认耦合常数。\n\n**$M$ 多重峰的分析**：$M$ 多重峰中的裂分来自于与 $A$ 和 $X$ 的耦合，因此它们将揭示 $|J_{AM}|$ 和 $|J_{MX}|$。\n频率：$f_{M1}=269.8$, $f_{M2}=271.0$, $f_{M3}=279.0$, $f_{M4}=280.2 \\ \\mathrm{Hz}$。\n间距: 1.2, 8.0, 1.2。\n- 裂分 1：1.2 Hz。\n- 裂分 2：中心1 = 270.4 Hz, 中心2 = 279.6 Hz。距离 = 9.2 Hz。\n在自旋 $M$ 处看到的耦合为 $\\{ |J_{AM}|, |J_{MX}| \\} = \\{ 1.2 \\ \\mathrm{Hz}, 9.2 \\ \\mathrm{Hz} \\}$。\n\n**$X$ 多重峰的分析**：$X$ 多重峰中的裂分来自于与 $A$ 和 $M$ 的耦合，揭示了 $|J_{AX}|$ 和 $|J_{MX}|$。\n频率：$f_{X1}=187.6$, $f_{X2}=188.8$, $f_{X3}=191.2$, $f_{X4}=192.4 \\ \\mathrm{Hz}$。\n间距: 1.2, 2.4, 1.2。\n- 裂分 1：1.2 Hz。\n- 裂分 2：中心1 = 188.2 Hz, 中心2 = 191.8 Hz。距离 = 3.6 Hz。\n在自旋 $X$ 处看到的耦合为 $\\{ |J_{AX}|, |J_{MX}| \\} = \\{ 1.2 \\ \\mathrm{Hz}, 3.6 \\ \\mathrm{Hz} \\}$。\n\n**3. 耦合常数的指认**\n我们有三组耦合大小：\n- 来自 A：$\\{ |J_{AM}|, |J_{AX}| \\} = \\{ 3.6, 9.2 \\}$\n- 来自 M：$\\{ |J_{AM}|, |J_{MX}| \\} = \\{ 1.2, 9.2 \\}$\n- 来自 X：$\\{ |J_{AX}|, |J_{MX}| \\} = \\{ 1.2, 3.6 \\}$\n\n通过比较这些集合，我们可以唯一地指认每个耦合常数。\n- $A$ 和 $M$ 多重峰共有的耦合是 $|J_{AM}|$。第一组和第二组之间的共同值是 $9.2 \\ \\mathrm{Hz}$。因此， $|J_{AM}| = 9.2 \\ \\mathrm{Hz}$。\n- 从 $A$ 多重峰集合，这意味着 $|J_{AX}| = 3.6 \\ \\mathrm{Hz}$。\n- 从 $M$ 多重峰集合，这意味着 $|J_{MX}| = 1.2 \\ \\mathrm{Hz}$。\n- 我们必须检查这些指认与 $X$ 多重峰的一致性。$X$ 处的耦合应为 $|J_{AX}|$ 和 $|J_{MX}|$。我们的指认给出了 $\\{ 3.6, 1.2 \\}$，这与从 $X$ 多重峰数据导出的集合完全匹配。数据完全一致。\n\n标量耦合常数的大小为：\n$|J_{AM}| = 9.2 \\ \\mathrm{Hz}$\n$|J_{AX}| = 3.6 \\ \\mathrm{Hz}$\n$|J_{MX}| = 1.2 \\ \\mathrm{Hz}$\n\n问题要求 $J_{AM}$ 和 $J_{AX}$ 的值。按照惯例，不带绝对值符号的符号 $J$ 可以有正负号，但一阶谱只产生大小。我们报告正的大小值。数值必须四舍五入到三位有效数字。\n$J_{AM} = 9.20 \\ \\mathrm{Hz}$\n$J_{AX} = 3.60 \\ \\mathrm{Hz}$\n\n最后，我们事后验证弱耦合近似。\n$\\nu_M = (269.8+271.0+279.0+280.2)/4 = 275.0 \\ \\mathrm{Hz}$ 和 $\\nu_X = (187.6+188.8+191.2+192.4)/4 = 190.0 \\ \\mathrm{Hz}$。\n$|\\nu_A-\\nu_M| = |345.0-275.0|=70.0 \\ \\mathrm{Hz} \\gg |J_{AM}|=9.2 \\ \\mathrm{Hz}$。\n$|\\nu_A-\\nu_X| = |345.0-190.0|=155.0 \\ \\mathrm{Hz} \\gg |J_{AX}|=3.6 \\ \\mathrm{Hz}$。\n$|\\nu_M-\\nu_X| = |275.0-190.0|=85.0 \\ \\mathrm{Hz} \\gg |J_{MX}|=1.2 \\ \\mathrm{Hz}$。\n对于所有核对，弱耦合条件都很好地满足了。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n9.20 & 3.60\n\\end{pmatrix}\n}\n$$", "id": "3725227"}, {"introduction": "理论推导和手动解析是基础，但现代波谱分析更依赖于精确的计算机模拟和拟合。本练习将带你进入定量波谱分析的前沿，要求你编写程序来完整地模拟一个 AB 型自旋体系的谱图，包括谱线位置和强度。你将利用非线性最小二乘法，将理论模型与含噪声的“实验”数据进行拟合，以提取化学位移差 ($\\Delta$) 和耦合常数 ($J$) [@problem_id:3725176]。此练习的重点不仅在于参数的确定，更在于通过计算参数间的相关系数来评估拟合结果的统计可靠性，这是研究生级别科研工作中不可或缺的一步。", "problem": "您的任务是使用一个基于物理、源自自旋哈密顿量的精确模型来拟合双自旋核磁共振 (NMR) AB 谱，然后量化化学位移差和标量耦合常数之间的参数相关性。AB 自旋体系由两个耦合的自旋-$\\tfrac{1}{2}$ 核组成，它们具有化学位移差和各向同性标量耦合，产生一个特征性的非一级多重峰，包含四条谱线（在没有简并的情况下）。您必须构建一个完整的、可运行的程序，该程序从第一性原理出发执行以下步骤，并生成所需的最终输出格式。\n\n从以角频率单位（弧度/秒）表示的两个自旋-$\\tfrac{1}{2}$ 核 $A$ 和 $B$ 的高场双自旋哈密顿量开始：\n$$\n\\hat{H} \\;=\\; 2\\pi \\left( \\nu_A \\hat{I}_{z}^{(A)} + \\nu_B \\hat{I}_{z}^{(B)} \\right) \\;+\\; 2\\pi J \\left( \\hat{I}_{x}^{(A)}\\hat{I}_{x}^{(B)} + \\hat{I}_{y}^{(A)}\\hat{I}_{y}^{(B)} + \\hat{I}_{z}^{(A)}\\hat{I}_{z}^{(B)} \\right),\n$$\n其中 $\\nu_A$ 和 $\\nu_B$ 是以 $\\mathrm{Hz}$ 为单位的拉莫尔频率，$J$ 是以 $\\mathrm{Hz}$ 为单位的标量耦合，$\\hat{I}_{\\alpha}^{(k)}$（其中 $\\alpha\\in\\{x,y,z\\}$）是自旋 $k\\in\\{A,B\\}$ 的自旋角动量算符，由 Pauli 矩阵构建为 $\\hat{I}_{\\alpha}=\\tfrac{1}{2}\\hat{\\sigma}_{\\alpha}$。为保证算符代数的一致性，使用 $\\hbar=1$。将化学位移差定义为 $\\Delta=\\nu_A-\\nu_B$，频率中心定义为 $\\bar{\\nu}=(\\nu_A+\\nu_B)/2$。为本问题之目的，固定 $\\bar{\\nu}=0$，因此 $\\nu_A=\\Delta/2$ 且 $\\nu_B=-\\Delta/2$。\n\n通过对角化 $\\hat{H}$ 得到以 $\\mathrm{rad/s}$ 为单位的本征值 $\\{E_i\\}$，然后取所有允许的单量子跃迁的频率，即可获得以 $\\mathrm{Hz}$ 为单位的精确跃迁频率。\n$$\nf_{ij} \\;=\\; \\frac{|E_j - E_i|}{2\\pi},\n$$\n其中允许的跃迁是指那些与检测算符 $\\hat{I}_{x}^{(\\mathrm{tot})}=\\hat{I}_{x}^{(A)}+\\hat{I}_{x}^{(B)}$ 的跃迁矩不为零的跃迁。跃迁 $(i\\to j)$ 的谱线强度与矩阵元模的平方成正比：\n$$\nI_{ij} \\;\\propto\\; \\left|\\langle i \\mid \\hat{I}_{x}^{(\\mathrm{tot})} \\mid j \\rangle\\right|^2,\n$$\n最终强度被归一化，使其总和为 $1$。假设处于高温、弱激发机制下，因此向上和向下的单量子跃迁对吸收的贡献是等效的，并选择由乘积态张成的标准 $4\\times 4$ 自旋希尔伯特空间。您必须通过直接对角化和矩阵元计算来计算所有此类允许的跃迁。\n\n您将通过最小化一个同时考虑谱线位置和强度的组合非线性最小二乘目标函数，来拟合化学位移差 $\\Delta$（单位 $\\mathrm{Hz}$）和标量耦合 $J$（单位 $\\mathrm{Hz}$）这两个参数。给定观测到的谱线位置 $\\{f_k^{\\mathrm{obs}}\\}$（单位 $\\mathrm{Hz}$）和观测到的归一化强度 $\\{I_k^{\\mathrm{obs}}\\}$（其值为非负且总和为 $1$），以及模型预测值 $\\{f_k(\\Delta,J)\\}$ 和 $\\{I_k(\\Delta,J)\\}$，首先将观测谱线和模型谱线都按频率升序排序，并按索引配对。将残差向量定义为：\n$$\nr \\;=\\; \\left[\\frac{f_1^{\\mathrm{obs}}-f_1(\\Delta,J)}{\\sigma_f},\\ldots,\\frac{f_4^{\\mathrm{obs}}-f_4(\\Delta,J)}{\\sigma_f},\\frac{I_1^{\\mathrm{obs}}-I_1(\\Delta,J)}{\\sigma_I},\\ldots,\\frac{I_4^{\\mathrm{obs}}-I_4(\\Delta,J)}{\\sigma_I}\\right]^{\\mathsf{T}},\n$$\n其中 $\\sigma_f$ 和 $\\sigma_I$ 分别是给定的正权重，单位为 $\\mathrm{Hz}$ 和无量纲。使用边界约束 $\\Delta\\ge 0$ 和 $J\\ge 0$。通过使用标准的非线性最小二乘优化器最小化 $\\|r\\|_2^2$ 获得最佳拟合参数后，根据最优点处的雅可比矩阵估计参数的局部协方差矩阵，公式如下：\n$$\n\\mathrm{Cov} \\;=\\; s^2 \\left(J^{\\mathsf{T}}J\\right)^{-1}, \\quad s^2 \\;=\\; \\frac{\\|r^\\ast\\|_2^2}{N-p},\n$$\n其中 $J$ 是在解处计算的残差关于参数的雅可比矩阵，$N$ 是残差分量的数量，$p$ 是参数的数量，$r^\\ast$ 是解处的残差向量。报告 $\\Delta$ 和 $J$ 之间的皮尔逊相关系数为：\n$$\n\\rho_{\\Delta,J} \\;=\\; \\frac{\\mathrm{Cov}_{\\Delta,J}}{\\sqrt{\\mathrm{Cov}_{\\Delta,\\Delta}\\,\\mathrm{Cov}_{J,J}}}.\n$$\n\n您的程序必须实现：\n- 通过对角化上述定义的哈密顿量，精确计算 AB 模型的跃迁频率和强度。\n- 使用上述残差定义，对观测到的谱线位置和强度进行 $\\Delta$ 和 $J$ 的非线性最小二乘拟合。\n- 估计参数协方差矩阵和相关系数 $\\rho_{\\Delta,J}$。\n\n物理单位：\n- 所有频率，包括 $\\Delta$、$J$ 和谱线位置，都必须以 $\\mathrm{Hz}$ 表示。\n- 最终报告的 $\\Delta$ 和 $J$ 必须四舍五入到三位小数，单位为 $\\mathrm{Hz}$。\n- 最终报告的相关系数 $\\rho_{\\Delta,J}$ 必须四舍五入到三位小数（无量纲）。\n\n测试套件和数据生成：\n对于每个测试用例，通过上述的精确对角化方法，从真实参数生成一个合成的观测 AB 棒状谱（四条谱线），然后向谱线位置和强度添加独立的高斯噪声，最后在归一化前将强度重新归一化使其总和为 $1$ 并将负值裁剪为零。使用以下真实参数和噪声规格的测试套件：\n- 案例 1：$\\Delta_{\\mathrm{true}}=80.0\\,\\mathrm{Hz}$，$J_{\\mathrm{true}}=12.0\\,\\mathrm{Hz}$，$\\sigma_f=0.4\\,\\mathrm{Hz}$，$\\sigma_I=0.02$，随机种子 $12345$。\n- 案例 2：$\\Delta_{\\mathrm{true}}=500.0\\,\\mathrm{Hz}$，$J_{\\mathrm{true}}=10.0\\,\\mathrm{Hz}$，$\\sigma_f=0.5\\,\\mathrm{Hz}$，$\\sigma_I=0.02$，随机种子 $24680$。\n- 案例 3：$\\Delta_{\\mathrm{true}}=12.0\\,\\mathrm{Hz}$，$J_{\\mathrm{true}}=10.0\\,\\mathrm{Hz}$，$\\sigma_f=0.4\\,\\mathrm{Hz}$，$\\sigma_I=0.02$，随机种子 $13579$。\n\n实现要求：\n- 使用 $\\bar{\\nu}=0$ 的 $4\\times 4$ 哈密顿量的对角化，即 $\\nu_A=\\Delta/2$ 和 $\\nu_B=-\\Delta/2$。\n- 使用检测算符 $\\hat{I}_{x}^{(\\mathrm{tot})}$ 计算允许的单量子跃迁及其强度，如上所述。\n- 在构建残差时，将观测和预测的谱线列表都按频率升序排序，并按索引配对。\n- 使用带有边界约束 $\\Delta\\ge 0$ 和 $J\\ge 0$ 的非线性最小二乘法。\n- 拟合后，使用上述公式计算协方差矩阵和皮尔逊相关系数 $\\rho_{\\Delta,J}$，其中残差分量数 $N=8$，参数数 $p=2$。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含一个列表的列表，每个内部列表对应一个测试用例，并按上面列出的测试用例顺序排列。\n- 每个内部列表必须为 $[\\Delta_{\\mathrm{fit}},J_{\\mathrm{fit}},\\rho_{\\Delta,J}]$ 的形式，其中 $\\Delta_{\\mathrm{fit}}$ 和 $J_{\\mathrm{fit}}$ 是拟合值，单位为 $\\mathrm{Hz}$，四舍五入到三位小数，$\\rho_{\\Delta,J}$ 四舍五入到三位小数。\n- 输出必须严格打印为单个 Python 风格的列表字面量，不带任何额外文本，例如：$[[80.000,12.000,0.123],[\\ldots],[\\ldots]]$。\n\n您的程序必须是完全自包含的，不得要求任何用户输入，并且必须遵守执行环境规范。程序应按规定从第一性原理实现物理和优化过程；计算的任何部分都不得使用任何预先制表的 AB 公式或近似的一级 (AX) 公式。", "solution": "该问题要求开发一个完整的计算流程，用于拟合一个源自量子力学第一性原理的 AB 双自旋 NMR 谱，并随后分析拟合参数之间的统计相关性。该问题被认为是有效的，因为它在科学上是合理的、定义明确的，并为模型、数据和所需输出提供了完整、无歧义的规范。\n\n该流程按以下主要步骤实现：\n1.  **自旋哈密顿量的构建**：量子力学模型始于两个耦合的自旋-$\\tfrac{1}{2}$ 核（指定为 $A$ 和 $B$）的自旋哈密顿量。在高磁场中并使用角频率单位，哈密顿量由下式给出：\n    $$\n    \\hat{H} \\;=\\; 2\\pi \\left( \\nu_A \\hat{I}_{z}^{(A)} + \\nu_B \\hat{I}_{z}^{(B)} \\right) \\;+\\; 2\\pi J \\left( \\hat{I}_{x}^{(A)}\\hat{I}_{x}^{(B)} + \\hat{I}_{y}^{(A)}\\hat{I}_{y}^{(B)} + \\hat{I}_{z}^{(A)}\\hat{I}_{z}^{(B)} \\right)\n    $$\n    核 $k \\in \\{A, B\\}$ 的自旋角动量算符 $\\hat{I}_{\\alpha}^{(k)}$ 定义为 $\\hat{I}_{\\alpha}^{(k)} = \\frac{1}{2}\\hat{\\sigma}_{\\alpha}^{(k)}$，其中 $\\hat{\\sigma}_{\\alpha}$ 是 Pauli 矩阵。双自旋体系的希尔伯特空间是四维的，由乘积基态 $|\\alpha\\alpha\\rangle, |\\alpha\\beta\\rangle, |\\beta\\alpha\\rangle, |\\beta\\beta\\rangle$ 张成。单个自旋的算符使用克罗内克积构建，例如 $\\hat{I}_{z}^{(A)} = \\hat{I}_{z} \\otimes \\mathbb{1}$ 和 $\\hat{I}_{z}^{(B)} = \\mathbb{1} \\otimes \\hat{I}_{z}$，其中 $\\mathbb{1}$ 是 $2 \\times 2$ 单位矩阵。通过将频率中心 $\\bar{\\nu} = (\\nu_A + \\nu_B)/2$ 设置为 $0$，拉莫尔频率变为 $\\nu_A = \\Delta/2$ 和 $\\nu_B = -\\Delta/2$，其中 $\\Delta$ 是化学位移差。哈密顿量（其本征值以 $\\mathrm{rad/s}$ 表示）简化为：\n    $$\n    \\hat{H} \\;=\\; \\pi \\Delta \\left( \\hat{I}_{z}^{(A)} - \\hat{I}_{z}^{(B)} \\right) \\;+\\; 2\\pi J \\left( \\vec{I}^{(A)} \\cdot \\vec{I}^{(B)} \\right)\n    $$\n    其中所有参数 $\\Delta$ 和 $J$ 的单位都是 $\\mathrm{Hz}$。\n\n2.  **光谱计算**：理论 NMR 谱是通过确定系统的能级和跃迁概率来计算的。\n    -   **能级和本征态**：能级 $E_i$ 是哈密顿矩阵 $\\hat{H}$ 的本征值，通过数值对角化获得。相应的本征向量 $|i\\rangle$ 代表系统的定态。我们为此使用 `numpy.linalg.eigh`，它适用于厄米矩阵。\n    -   **跃迁频率和强度**：NMR 检测由振荡射频场诱导的单量子跃迁。对于沿 $x$ 轴的检测，相关算符是总横向自旋算符 $\\hat{I}_{x}^{(\\mathrm{tot})} = \\hat{I}_{x}^{(A)} + \\hat{I}_{x}^{(B)}$。如果跃迁矩 $\\langle i | \\hat{I}_{x}^{(\\mathrm{tot})} | j \\rangle$ 非零，则态 $|i\\rangle$ 和 $|j\\rangle$ 之间的跃迁是允许的。这种跃迁的频率由 $f_{ij} = |E_j - E_i| / (2\\pi)$ 给出，单位为 $\\mathrm{Hz}$。强度与跃迁矩大小的平方成正比：$I_{ij} \\propto |\\langle i | \\hat{I}_{x}^{(\\mathrm{tot})} | j \\rangle|^2$。对于最终的光谱，计算出的强度被归一化，使其总和为 $1$。\n\n3.  **非线性最小二乘拟合**：模型参数 $\\Delta$ 和 $J$ 是通过将理论谱与观测数据进行拟合来确定的。\n    -   **目标函数**：通过最小化加权残差平方和 $\\chi^2 = \\|r\\|_2^2$ 来执行拟合。残差向量 $r$ 由观测和计算的谱线位置与强度之间的差异构成：\n        $$\n        r \\;=\\; \\left[\\frac{f_1^{\\mathrm{obs}}-f_1(\\Delta,J)}{\\sigma_f},\\ldots,\\frac{f_4^{\\mathrm{obs}}-f_4(\\Delta,J)}{\\sigma_f},\\frac{I_1^{\\mathrm{obs}}-I_1(\\Delta,J)}{\\sigma_I},\\ldots,\\frac{I_4^{\\mathrm{obs}}-I_4(\\Delta,J)}{\\sigma_I}\\right]^{\\mathsf{T}}\n        $$\n        残差总数为 $N=8$。为确保正确对应，在计算残差之前，将观测和计算的谱线列表都按频率升序排序。\n    -   **优化**：使用 `scipy.optimize.least_squares` 和信赖域反射 (`trf`) 算法进行最小化，并满足物理约束 $\\Delta \\ge 0$ 和 $J \\ge 0$。\n\n4.  **参数相关性分析**：找到最优参数 $(\\Delta^*, J^*)$ 后，估计它们的统计不确定度和相关性。\n    -   **协方差矩阵**：在解周围局部线性模型的假设下，参数协方差矩阵估计为：\n        $$\n        \\mathrm{Cov} \\;=\\; s^2 \\left(\\mathcal{J}^{\\mathsf{T}}\\mathcal{J}\\right)^{-1}\n        $$\n        其中，$\\mathcal{J}$ 是残差向量 $r$ 关于参数 $(\\Delta, J)$ 在解处计算的雅可比矩阵。约化卡方 $s^2$ 是残差方差的估计，计算为 $s^2 = \\|r^*\\|_2^2 / (N-p)$，其中 $r^*$ 是最优点处的残差向量，$N=8$ 是数据点数（4个频率 + 4个强度），$p=2$ 是参数数量。\n    -   **相关系数**：$\\Delta$ 和 $J$ 之间的皮尔逊相关系数 $\\rho_{\\Delta,J}$ 从协方差矩阵中提取：\n        $$\n        \\rho_{\\Delta,J} \\;=\\; \\frac{\\mathrm{Cov}_{\\Delta,J}}{\\sqrt{\\mathrm{Cov}_{\\Delta,\\Delta}\\,\\mathrm{Cov}_{J,J}}}\n        $$\n    该系数用于量化 $\\Delta$ 和 $J$ 估计值之间的线性依赖关系。\n\n5.  **合成数据生成**：对于每个测试用例，通过首先为给定的真实参数 $(\\Delta_{\\mathrm{true}}, J_{\\mathrm{true}})$ 计算精确光谱来生成合成的“观测”数据。将具有指定标准差 $\\sigma_f$ 和 $\\sigma_I$ 的独立高斯噪声分别添加到谱线位置和强度中。然后对带噪强度进行处理，将任何负值裁剪为零，并重新将集合归一化使其总和为 $1$。使用固定的随机种子可确保合成数据及后续拟合结果的可复现性。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Main function to run the AB spectrum fitting and correlation analysis for all test cases.\n    \"\"\"\n\n    # -- Step 1: Pre-compute spin operators and constant Hamiltonian parts --\n    # Define spin-1/2 operators from Pauli matrices (hbar=1)\n    sigma_x = np.array([[0, 1], [1, 0]], dtype=complex)\n    sigma_y = np.array([[0, -1j], [1j, 0]], dtype=complex)\n    sigma_z = np.array([[1, 0], [0, -1]], dtype=complex)\n    i_x = 0.5 * sigma_x\n    i_y = 0.5 * sigma_y\n    i_z = 0.5 * sigma_z\n    i_2 = np.identity(2, dtype=complex)\n\n    # Construct two-spin operators using the Kronecker product\n    # The basis is implicitly |alpha,alpha>, |alpha,beta>, |beta,alpha>, |beta,beta>\n    ix_a = np.kron(i_x, i_2)\n    iy_a = np.kron(i_y, i_2)\n    iz_a = np.kron(i_z, i_2)\n    ix_b = np.kron(i_2, i_x)\n    iy_b = np.kron(i_2, i_y)\n    iz_b = np.kron(i_2, i_z)\n\n    # Operator for the Zeeman part of the Hamiltonian: Iz(A) - Iz(B)\n    zeeman_op = iz_a - iz_b\n    # Operator for the scalar coupling part: I(A) . I(B)\n    coupling_op = np.dot(ix_a, ix_b) + np.dot(iy_a, iy_b) + np.dot(iz_a, iz_b)\n    # Total transverse spin operator for calculating transition intensities\n    ix_total = ix_a + ix_b\n\n    def simulate_ab_spectrum(params):\n        \"\"\"\n        Calculates the 4-line AB spectrum (frequencies and intensities) for given parameters.\n        params: a tuple (delta, J) in Hz.\n        Returns: (frequencies, intensities) sorted by frequency.\n        \"\"\"\n        delta, j = params\n        \n        # Construct the Hamiltonian matrix in rad/s\n        H = (np.pi * delta * zeeman_op) + (2 * np.pi * j * coupling_op)\n        \n        # Diagonalize the Hermitian Hamiltonian\n        energies, eigenvectors = np.linalg.eigh(H)\n        \n        # Calculate transition moments in the eigenbasis\n        transition_matrix = eigenvectors.conj().T @ ix_total @ eigenvectors\n        \n        transitions = []\n        for i in range(4):\n            for k in range(i + 1, 4):\n                intensity = np.abs(transition_matrix[i, k])**2\n                # Filter for allowed transitions, using a small threshold for intensity\n                if intensity > 1e-9:\n                    frequency = (energies[k] - energies[i]) / (2 * np.pi)\n                    transitions.append((frequency, intensity))\n        \n        # Normalize intensities to sum to 1\n        if not transitions:\n            return np.array([]), np.array([])\n            \n        total_intensity = sum(t[1] for t in transitions)\n        if total_intensity < 1e-9:\n            freqs = np.array([t[0] for t in transitions])\n            intens = np.array([0.0] * len(transitions))\n        else:\n            final_transitions = [(f, I / total_intensity) for f, I in transitions]\n            # Sort by frequency before returning\n            final_transitions.sort(key=lambda x: x[0])\n            freqs = np.array([t[0] for t in final_transitions])\n            intens = np.array([t[1] for t in final_transitions])\n            \n        return freqs, intens\n\n    def generate_noisy_data(true_params, sigma_f, sigma_i, seed):\n        \"\"\"\n        Generates synthetic observed data with Gaussian noise.\n        \"\"\"\n        rng = np.random.default_rng(seed)\n        \n        f_true, i_true = simulate_ab_spectrum(true_params)\n        \n        # Add noise\n        f_obs = f_true + rng.normal(0, sigma_f, size=f_true.shape)\n        i_obs_noisy = i_true + rng.normal(0, sigma_i, size=i_true.shape)\n        \n        # Process intensities: clip negatives and re-normalize\n        i_obs_clipped = np.clip(i_obs_noisy, 0, None)\n        i_obs_sum = np.sum(i_obs_clipped)\n        i_obs = i_obs_clipped / i_obs_sum if i_obs_sum > 0 else i_obs_clipped\n        \n        return f_obs, i_obs\n\n    def residuals(params, f_obs, i_obs, sigma_f, sigma_i):\n        \"\"\"\n        Calculates the residual vector for the least-squares fit.\n        \"\"\"\n        f_calc, i_calc = simulate_ab_spectrum(params)\n\n        # The observed data needs to be sorted by frequency for correct pairing\n        sort_indices = np.argsort(f_obs)\n        f_obs_sorted = f_obs[sort_indices]\n        i_obs_sorted = i_obs[sort_indices]\n        \n        # If the number of lines is not 4, this may cause an error.\n        # This implementation assumes the parameters stay in a region producing 4 lines.\n        if len(f_calc) != len(f_obs_sorted):\n            # Return a large residual to guide optimizer away\n            return np.full(len(f_obs_sorted)+len(i_obs_sorted), 1e6)\n\n        # Residuals for frequencies and intensities\n        res_f = (f_obs_sorted - f_calc) / sigma_f\n        res_i = (i_obs_sorted - i_calc) / sigma_i\n        \n        return np.concatenate([res_f, res_i])\n\n    # -- Step 2: Define test cases --\n    test_cases = [\n        # (Delta_true, J_true, sigma_f, sigma_I, random_seed)\n        (80.0, 12.0, 0.4, 0.02, 12345),\n        (500.0, 10.0, 0.5, 0.02, 24680),\n        (12.0, 10.0, 0.4, 0.02, 13579),\n    ]\n\n    results = []\n\n    # -- Step 3: Loop through test cases, fit, and calculate correlation --\n    for case in test_cases:\n        delta_true, j_true, sigma_f, sigma_i, seed = case\n        \n        # Generate synthetic observed data with noise\n        f_obs, i_obs = generate_noisy_data((delta_true, j_true), sigma_f, sigma_i, seed)\n\n        # Initial guess for the optimizer (using true values for robustness)\n        x0 = (delta_true, j_true)\n        \n        # Perform nonlinear least-squares fitting\n        opt_result = least_squares(\n            residuals,\n            x0,\n            args=(f_obs, i_obs, sigma_f, sigma_i),\n            bounds=([0, 0], [np.inf, np.inf]),\n            method='trf'\n        )\n        \n        delta_fit, j_fit = opt_result.x\n        \n        # Calculate parameter correlation\n        r_star = opt_result.fun  # Residuals at the solution\n        jac = opt_result.jac     # Jacobian at the solution\n        N = 8  # Number of residual components (4 frequencies + 4 intensities)\n        p = 2  # Number of parameters (Delta, J)\n        \n        # Estimate of the residual variance\n        s2 = np.sum(r_star**2) / (N - p)\n        \n        # Parameter covariance matrix\n        try:\n            cov = s2 * np.linalg.inv(jac.T @ jac)\n            \n            # Pearson correlation coefficient rho(Delta, J)\n            rho_dj = cov[0, 1] / np.sqrt(cov[0, 0] * cov[1, 1])\n        except np.linalg.LinAlgError:\n            # Handle cases where the Jacobian is singular (e.g., non-identifiable parameters)\n            rho_dj = np.nan\n        \n        results.append([round(delta_fit, 3), round(j_fit, 3), round(rho_dj, 3)])\n\n    # -- Step 4: Format and print the final output --\n    # Print the final result in the specified Python list format\n    print(results)\n```", "id": "3725176"}]}