{"hands_on_practices": [{"introduction": "化学位移 $\\delta$ 标尺的核心优势在于其独立于波谱仪磁场强度，这使得在不同仪器上获得的核磁共振数据具有可比性。本实践旨在通过一个假设场景，让你亲手验证这一基本原理。你将利用来自两台不同场强波谱仪的数据，通过计算证明，在正确校正了参考物（如外部参照毛细管引入的磁化率位移）之后，分析物的化学位移 $\\delta$ 值是一个与场强无关的恒定值[@problem_id:3726735]。这个练习不仅能加深你对拉莫尔关系和 $\\delta$ 标尺定义的理解，还能培养处理实际实验中可能遇到的参照物校正问题的能力。", "problem": "在质子核磁共振（NMR）谱学中，δ标度上的化学位移是相对于参考标准物（例如四甲基硅烷，TMS）来定义的。考虑一个待测物，其质子共振在两台分别工作于 $500.00\\,\\text{MHz}$ 和 $700.00\\,\\text{MHz}$（针对 $^{1}\\text{H}$）的高场谱仪上进行测量。在每台仪器上，参考物是置于外部毛细管中的TMS，相对于处于相同磁环境中的理想内部TMS参考物，它会受到体磁化率位移的影响。该磁化率位移与静态磁场 $B_{0}$ 成线性关系。\n\n在 $500.00\\,\\text{MHz}$ 的仪器上，待测物的共振信号出现在外部TMS信号低场 $11{,}737.990\\,\\text{Hz}$ 处，并且已知在该磁场下，外部TMS相对于理想内部TMS处于高场 $9.600\\,\\text{Hz}$ 处。在 $700.00\\,\\text{MHz}$ 的仪器上，待测物的共振信号出现在外部TMS信号低场 $16{,}433.186\\,\\text{Hz}$ 处，并且已知在该磁场下，外部TMS相对于理想内部TMS处于高场 $13.440\\,\\text{Hz}$ 处。\n\n从拉莫尔关系式 $\\,\\omega=\\gamma B_{0}(1-\\sigma)\\,$（其中 $\\gamma$ 是旋磁比，$\\sigma$ 是核磁屏蔽常数）和化学位移δ标度的常规定义出发，推导一个表达式，证明当参考物位移与 $B_{0}$ 成正比时，δ标度（以ppm为单位）与 $B_{0}$ 无关。然后，使用所提供的测量数据，并校正到常规的内部TMS参考标准，计算待测物的化学位移 $\\delta$（以ppm为单位）。\n\n将您的最终数值结果四舍五入至六位有效数字，并以 $\\text{ppm}$ 为单位表示。为 $\\delta$ 提供一个单一的数值。", "solution": "该问题被评估为具有科学依据、提法恰当且客观。它基于核磁共振（NMR）谱学的既定原理，并为获得唯一解提供了完整且一致的数据集。\n\n按照要求，解答分为两个部分：推导化学位移δ标度的场独立性，以及根据所提供的数据计算待测物的化学位移。\n\n**第一部分：场独立性的推导**\n\n化学位移 $\\delta$（以百万分率，$\\text{ppm}$为单位）通常是相对于理想的内部参考标准物（如四甲基硅烷，TMS）定义的。其公式为：\n$$ \\delta = \\frac{\\nu_{sample} - \\nu_{ref,i}}{\\nu_{0}} \\times 10^6 $$\n其中 $\\nu_{sample}$ 是待测物原子核的共振频率，$\\nu_{ref,i}$ 是理想内部参考物原子核的共振频率，$\\nu_{0}$ 是谱仪的工作频率。\n\n原子核的共振频率 $\\nu$ 由拉莫尔关系式 $\\omega = 2\\pi\\nu = \\gamma B_{eff}$ 给出，其中 $\\gamma$ 是旋磁比， $B_{eff}$ 是原子核感受到的有效磁场。该有效磁场是外加静态磁场 $B_0$ 减去局部电子环境产生的屏蔽效应：$B_{eff} = B_0(1-\\sigma)$，其中 $\\sigma$ 是屏蔽常数。用频率表示的拉莫尔关系式为：\n$$ \\nu = \\frac{\\gamma B_{0}(1-\\sigma)}{2\\pi} $$\n谱仪的工作频率 $\\nu_0$ 与静态磁场 $B_0$ 成正比。我们可以写作 $\\nu_0 = K B_0$，其中 $K$ 是一个与被观测原子核相关的常数（对于 ${}^{1}\\text{H}$， $K \\approx \\frac{\\gamma_{{}^{1}\\text{H}}}{2\\pi}$）。\n\n使用拉莫尔关系式，$\\delta$ 表达式中分子的频率差为：\n$$ \\nu_{sample} - \\nu_{ref,i} = \\frac{\\gamma B_{0}(1-\\sigma_{sample})}{2\\pi} - \\frac{\\gamma B_{0}(1-\\sigma_{ref,i})}{2\\pi} = \\frac{\\gamma B_{0}}{2\\pi}(\\sigma_{ref,i} - \\sigma_{sample}) $$\n这个以赫兹（$\\text{Hz}$）为单位的频率差与 $B_0$ 成正比。\n\n将此代入 $\\delta$ 的定义式中：\n$$ \\delta = \\frac{\\frac{\\gamma B_{0}}{2\\pi}(\\sigma_{ref,i} - \\sigma_{sample})}{K B_0} \\times 10^6 $$\n由于 $K \\approx \\frac{\\gamma}{2\\pi}$，涉及 $B_0$ 和 $\\gamma$ 的项被消去，剩下：\n$$ \\delta \\approx (\\sigma_{ref,i} - \\sigma_{sample}) \\times 10^6 $$\n这表明化学位移 $\\delta$ 仅是屏蔽常数的函数，因此与外加磁场 $B_0$ 无关。\n\n现在，我们将此推广到使用外部参考物且存在磁化率引起的位移的情况。\n设 $\\nu_{ref,e}$ 为外部参考物的观测频率。\n题目指出，待测物的共振信号在外部TMS信号的低场处，频率偏移为 $\\Delta\\nu_{obs}$。“低场”意味着频率更高，因此：\n$$ \\Delta\\nu_{obs} = \\nu_{sample} - \\nu_{ref,e} > 0 $$\n题目还指出，外部TMS相对于理想内部TMS处于高场。“高场”意味着频率更低，即 $\\nu_{ref,e}  \\nu_{ref,i}$。由该位移引起的频率差为：\n$$ \\Delta\\nu_{corr} = \\nu_{ref,i} - \\nu_{ref,e} > 0 $$\n化学位移计算所需的真实频率差是 $\\nu_{sample} - \\nu_{ref,i}$。我们可以用观测值来表示它：\n$$ \\nu_{sample} - \\nu_{ref,i} = (\\nu_{sample} - \\nu_{ref,e}) - (\\nu_{ref,i} - \\nu_{ref,e}) = \\Delta\\nu_{obs} - \\Delta\\nu_{corr} $$\n题目指出磁化率位移与 $B_0$ 成线性关系。这意味着频率位移 $\\Delta\\nu_{corr}$ 与 $B_0$ 成正比，因此也与谱仪频率 $\\nu_0$ 成正比。我们可以将其写为 $\\Delta\\nu_{corr} = c \\cdot \\nu_0$，其中 $c$ 是某个无量纲比例常数。\n\n真实的化学位移 $\\delta$（一个与场无关的量）将真实的频率差与谱仪频率联系起来：\n$$ \\nu_{sample} - \\nu_{ref,i} = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n将我们的表达式代入此方程：\n$$ \\Delta\\nu_{obs} - \\Delta\\nu_{corr} = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n用 $c \\cdot \\nu_0$ 替换 $\\Delta\\nu_{corr}$：\n$$ \\Delta\\nu_{obs} - c \\cdot \\nu_0 = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n$$ \\Delta\\nu_{obs} = (\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0 $$\n这证明了观测到的频率偏移 $\\Delta\\nu_{obs}$ 也与谱仪频率 $\\nu_0$ 成正比。\n\n为了从实验测量值计算出真实的化学位移 $\\delta$，我们使用以下公式：\n$$ \\delta_{calc} = \\frac{\\Delta\\nu_{obs} - \\Delta\\nu_{corr}}{\\nu_{0}} \\times 10^6 $$\n代入关系式 $\\Delta\\nu_{obs} = (\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0$ 和 $\\Delta\\nu_{corr} = c \\cdot \\nu_0$：\n$$ \\delta_{calc} = \\frac{(\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0 - c \\cdot \\nu_0}{\\nu_{0}} \\times 10^6 = \\frac{\\delta \\cdot 10^{-6} \\cdot \\nu_0}{\\nu_{0}} \\times 10^6 = \\delta $$\n这就完成了推导，表明通过磁化率位移（与 $B_0$ 成正比）来校正观测到的频率位移，可以得出真实的、与场无关的化学位移 $\\delta$。\n\n**第二部分：待测物化学位移的计算**\n\n我们得到了来自两台不同谱仪的两组数据。我们将分别为每组数据计算化学位移，以验证其一致性。\n\n对于第一台谱仪：\n- 谱仪频率：$\\nu_{0,1} = 500.00 \\, \\text{MHz} = 500.00 \\times 10^6 \\, \\text{Hz}$\n- 观测到的待测物偏移：$\\Delta\\nu_{obs,1} = 11737.990 \\, \\text{Hz}$\n- 外部TMS位移校正值：$\\Delta\\nu_{corr,1} = 9.600 \\, \\text{Hz}$\n\n真实的频率位移 $\\Delta\\nu_{true,1}$ 为：\n$$ \\Delta\\nu_{true,1} = \\Delta\\nu_{obs,1} - \\Delta\\nu_{corr,1} = 11737.990 \\, \\text{Hz} - 9.600 \\, \\text{Hz} = 11728.390 \\, \\text{Hz} $$\n化学位移 $\\delta_1$ 为：\n$$ \\delta_1 = \\frac{\\Delta\\nu_{true,1}}{\\nu_{0,1}} \\times 10^6 = \\frac{11728.390 \\, \\text{Hz}}{500.00 \\times 10^6 \\, \\text{Hz}} \\times 10^6 = \\frac{11728.390}{500.00} = 23.45678 \\, \\text{ppm} $$\n\n对于第二台谱仪：\n- 谱仪频率：$\\nu_{0,2} = 700.00 \\, \\text{MHz} = 700.00 \\times 10^6 \\, \\text{Hz}$\n- 观测到的待测物偏移：$\\Delta\\nu_{obs,2} = 16433.186 \\, \\text{Hz}$\n- 外部TMS位移校正值：$\\Delta\\nu_{corr,2} = 13.440 \\, \\text{Hz}$\n\n真实的频率位移 $\\Delta\\nu_{true,2}$ 为：\n$$ \\Delta\\nu_{true,2} = \\Delta\\nu_{obs,2} - \\Delta\\nu_{corr,2} = 16433.186 \\, \\text{Hz} - 13.440 \\, \\text{Hz} = 16419.746 \\, \\text{Hz} $$\n化学位移 $\\delta_2$ 为：\n$$ \\delta_2 = \\frac{\\Delta\\nu_{true,2}}{\\nu_{0,2}} \\times 10^6 = \\frac{16419.746 \\, \\text{Hz}}{700.00 \\times 10^6 \\, \\text{Hz}} \\times 10^6 = \\frac{16419.746}{700.00} = 23.45678 \\, \\text{ppm} $$\n\n两次计算均得出相同的结果 $\\delta = 23.45678 \\, \\text{ppm}$，这证实了正确参比的化学位移具有场独立性。题目要求将最终答案四舍五入至六位有效数字。第六位有效数字是 $7$，其后一位是 $8$，因此我们向上舍入。\n\n最终值：$\\delta = 23.4568 \\, \\text{ppm}$。", "answer": "$$\n\\boxed{23.4568}\n$$", "id": "3726735"}, {"introduction": "尽管四甲基硅烷 (TMS) 是公认的 $^{1}\\text{H}$ 和 $^{13}\\text{C}$ NMR 的零点参照物，但在特定实验条件下（例如在水溶液中），使用其他参考标准（如 DSS）可能更为方便。因此，掌握如何在不同参考标准之间准确转换化学位移值是一项至关重要的技能。本练习将引导你仅从化学位移的定义和实验测得的频率差出发，推导出在不同参照物之间转换化学位移的精确方法[@problem_id:3726727]。通过这个过程，你将深刻体会到化学位移的相对性，并理解其数值是如何与所选的零点参照物紧密关联的。", "problem": "一种有机化合物在恒定磁通密度 $B_{0}$ 下通过质子核磁共振（proton NMR）波谱法进行分析，使得质子的裸拉莫尔频率（即在没有电子屏蔽的情况下的频率）为 $\\nu_{0} = 600.000000~\\text{MHz}$。带有电子屏蔽 $\\sigma$ 的原子核的共振频率遵循拉莫尔关系式 $\\nu = \\nu_{0}(1 - \\sigma)$，而在选定的参考标度上的化学位移由以下无量纲量定义：\n$$\n\\delta^{R}(S) \\equiv \\frac{\\nu(S) - \\nu(R)}{\\nu_{0}} \\times 10^{6},\n$$\n其中 $R$ 表示选定的参比物，而 $S$ 表示样品共振。\n\n考虑了两种不同的参比标准物：四甲基硅烷（TMS）和 4,4-二甲基-4-硅杂戊烷-1-磺酸（DSS）。在所述磁场的 $^{1}\\text{H}$ 通道上，在相同条件下测量了以下频率偏移：\n- 样品共振 $S$ 相对于 DSS 的频率偏移：$\\Delta \\nu_{S,\\text{DSS}} = +1823.45~\\text{Hz}$，意味着 $\\nu(S) - \\nu(\\text{DSS}) = +1823.45~\\text{Hz}$。\n- TMS 相对于 DSS 的频率偏移：$\\Delta \\nu_{\\text{TMS},\\text{DSS}} = +9.75~\\text{Hz}$，意味着 $\\nu(\\text{TMS}) - \\nu(\\text{DSS}) = +9.75~\\text{Hz}$。\n\n仅从拉莫尔关系式和上述化学位移的定义出发，确定当参比物从 DSS 切换到 TMS 时样品共振 $S$ 的化学位移，即计算 $\\delta^{\\text{TMS}}(S)$。\n\n将最终的化学位移以百万分率（ppm）表示为一个不带单位符号的纯数，并将您的答案四舍五入到六位有效数字。", "solution": "问题陈述经过验证，被认为是有效的。它在科学上基于核磁共振（NMR）波谱学的原理，问题提法得当，具有唯一且稳定的解，并以客观、正式的语言表达。所有提供的数据和定义都是自洽且现实的。\n\n目标是计算使用四甲基硅烷（TMS）作为参比标准物的样品共振 $S$ 的化学位移，记为 $\\delta^{\\text{TMS}}(S)$。问题要求此计算基于所提供的拉莫尔关系式和化学位移的定义。\n\n样品 $S$ 在参考标度 $R$ 上的化学位移定义为：\n$$\n\\delta^{R}(S) \\equiv \\frac{\\nu(S) - \\nu(R)}{\\nu_{0}} \\times 10^{6}\n$$\n对于我们的具体情况，其中参比物 $R$ 是 TMS，这个定义变为：\n$$\n\\delta^{\\text{TMS}}(S) = \\frac{\\nu(S) - \\nu(\\text{TMS})}{\\nu_{0}} \\times 10^{6}\n$$\n此处，$\\nu(S)$ 是样品的共振频率，$\\nu(\\text{TMS})$ 是 TMS 的共振频率，而 $\\nu_{0}$ 是质子的裸拉莫尔频率。\n\n问题提供了以下已知条件：\n1. 裸拉莫尔频率，$\\nu_{0} = 600.000000~\\text{MHz} = 600.000000 \\times 10^{6}~\\text{Hz}$。\n2. 样品共振 $S$ 相对于 4,4-二甲基-4-硅杂戊烷-1-磺酸 (DSS) 参比物的频率偏移：$\\nu(S) - \\nu(\\text{DSS}) = 1823.45~\\text{Hz}$。\n3. TMS 相对于 DSS 参比物的频率偏移：$\\nu(\\text{TMS}) - \\nu(\\text{DSS}) = 9.75~\\text{Hz}$。\n\n为了计算 $\\delta^{\\text{TMS}}(S)$，我们首先需要确定其定义中分子的值，即频率差 $\\nu(S) - \\nu(\\text{TMS})$。这个量代表了样品共振相对于 TMS 参比物的频率。我们可以通过代数组合两个给定的频率偏移来计算这个值，这两个偏移都是相对于共同的参比物 DSS 测量的。\n\n我们可以写出：\n$$\n\\nu(S) - \\nu(\\text{TMS}) = (\\nu(S) - \\nu(\\text{DSS})) - (\\nu(\\text{TMS}) - \\nu(\\text{DSS}))\n$$\n将给定的数值代入此表达式：\n$$\n\\nu(S) - \\nu(\\text{TMS}) = 1823.45~\\text{Hz} - 9.75~\\text{Hz}\n$$\n$$\n\\nu(S) - \\nu(\\text{TMS}) = 1813.70~\\text{Hz}\n$$\n\n现在我们将这个频率差和 $\\nu_{0}$ 的值代入 $\\delta^{\\text{TMS}}(S)$ 的公式中：\n$$\n\\delta^{\\text{TMS}}(S) = \\frac{1813.70~\\text{Hz}}{600.000000 \\times 10^{6}~\\text{Hz}} \\times 10^{6}\n$$\n定义中比例因子里的 $10^{6}$ 和将 $\\nu_{0}$ 从 MHz 转换为 Hz 得到的因子 $10^{6}$ 相互抵消。表达式简化为一个无量纲的比率：\n$$\n\\delta^{\\text{TMS}}(S) = \\frac{1813.70}{600.000000}\n$$\n执行除法运算得出化学位移的数值：\n$$\n\\delta^{\\text{TMS}}(S) \\approx 3.0228333...\n$$\n问题要求最终答案四舍五入到六位有效数字。结果的前六位有效数字是 $3$、$0$、$2$、$2$、$8$ 和 $3$。第七位数字是 $3$，小于 $5$，因此我们舍去。\n\n因此，样品共振 $S$ 相对于 TMS 的化学位移是：\n$$\n\\delta^{\\text{TMS}}(S) = 3.02283\n$$\n这个计算直接从 $\\delta$ 的定义和实验频率差推导得出，与由拉莫尔关系式 $\\nu = \\nu_0(1-\\sigma)$ 所描述的基本物理原理完全一致。", "answer": "$$\\boxed{3.02283}$$", "id": "3726727"}, {"introduction": "谱图上呈现的化学位移值并非凭空出现，而是对原始时域信号（自由感应衰减，FID）进行一系列复杂数字信号处理后的结果。这个编码实践为你提供了一个独特的机会，让你亲手构建一个简化的NMR信号处理流程，从而揭示从原始数据到最终化学位移值的完整路径[@problem_id:3726733]。你将模拟一个FID信号，并对其应用窗函数、零阶相位校正和傅里叶变换等操作，最终通过峰值拾取算法确定表观化学位移。这个过程将直观地展示信号处理选择（如相位误差或不当的加窗）如何能够引入表观峰位移，从而影响化学位移测定的准确性。", "problem": "您需要实现一个完整、可运行的程序，该程序模拟核磁共振 (NMR) 光谱学中的数字信号处理如何影响表观峰位，并因此影响在相对于标准物进行参照时计算出的 $\\delta$ 标度化学位移。该研究必须基于第一性原理，具体包括：$\\delta$ 标度化学位移的定义、时域自由感应衰减 (FID) 的傅里叶分析、离散时间采样约束以及参考标准在构建频率原点中的作用。\n\n$\\delta$ 标度化学位移是一个无量纲量，定义为样品共振频率与参考标准共振频率之差，并由所观测原子核的工作频率进行归一化。对于在相同磁场下测量的同一原子核的样品共振频率 $\\,\\nu_{\\text{sample}}\\,$ 和参考共振频率 $\\,\\nu_{\\text{ref}}\\,$，化学位移 $\\delta$（单位为百万分率）定义为\n$$\n\\delta \\equiv \\frac{\\nu_{\\text{sample}} - \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\n其中 $\\,\\nu_0\\,$ 是所观测原子核的谱仪频率（例如，$\\,^{1}\\mathrm{H}\\,$ 在 $\\,\\nu_0 = 400\\ \\mathrm{MHz}\\,$）。参考化合物通常是四甲基硅烷 (TMS)，对于 $\\,^{1}\\mathrm{H}\\,$ 和 $\\,^{13}\\mathrm{C}\\,$，其化学位移被定义为 $\\delta = 0$。\n\n您将模拟一个时域中的单共振 $\\,^{1}\\mathrm{H}\\,$ NMR FID，使用不同的窗函数和相位条件对其进行处理，计算离散傅里叶变换，检测表观峰频率，并使用上述定义将其转换为化学位移。您的模拟和分析必须遵循以下基本依据：\n\n- 时域检测产生一个 FID，其模型为一个阻尼复指数函数，其横向弛豫由衰减时间 $\\,T_2\\,$ 表征。信号通常可以写为 $\\,s(t) = e^{-t/T_2}\\,e^{i(2\\pi f_0 t + \\phi_0)}\\,$，其中 $\\,f_0\\,$ 是相对于所选参考原点的基带共振频率，$\\,\\phi_0\\,$ 是零阶相位误差。\n- 使用驻留时间 $\\,\\Delta t\\,$ 和 $\\,N\\,$ 个点进行离散时间采样，得到采集时间 $\\,T = N \\Delta t\\,$ 和标称频率箱间隔 $\\,\\Delta \\nu = 1/T\\,$。补零会增加频率箱的数量，但不会提高真实分辨率。\n- 时域切趾通过将 $\\,s(t)\\,$ 乘以一个窗函数 $\\,w(t)\\,$（例如指数窗或高斯窗）来实现，这通过在频域中的卷积来改变线宽和线型。\n- 定标设置了原点，使得 $\\,\\nu_{\\text{ref}}\\,$ 定义了 $\\,\\delta = 0\\,$。一个大小为 $\\,\\Delta \\nu_{\\text{ref}}\\,$ 的定标错误意味着所使用的参考频率为 $\\,\\nu_{\\text{ref,used}} = \\nu_{\\text{ref,true}} + \\Delta \\nu_{\\text{ref}}\\,$，这会影响计算出的化学位移。\n\n您的程序必须为每个测试用例实现以下步骤：\n1. 假设数字原点由 $\\,\\nu_{\\text{ref,true}}\\,$ 设定，根据提供的真实化学位移 $\\,\\delta_{\\text{true}}\\,$ 和 $\\,\\nu_0\\,$，通过公式 $\\,f_0 = \\nu_0 \\,\\delta_{\\text{true}} / 10^6\\,$ 计算以赫兹为单位的真实基带共振频率 $\\,f_0\\,$。\n2. 对于 $\\,k = 0,1,\\dots,N-1\\,$，使用指定的 $\\,T_2\\,$, $\\,f_0\\,$ 和 $\\,\\phi_0\\,$ 在时间点 $\\,t_k = k\\,\\Delta t\\,$ 上构建 FID $\\,s(t)\\,$。\n3. 应用指定的窗函数 $\\,w(t)\\,$（选项：无、通过 $\\,w(t) = e^{-t/\\tau}\\,$ 定义的带参数 $\\,\\tau\\,$ 的指数窗，或通过 $\\,w(t) = e^{-(t/\\sigma)^2}\\,$ 定义的带参数 $\\,\\sigma\\,$ 的高斯窗）。\n4. 通过用零填充至 $\\,N_{\\mathrm{zf}} = \\mathrm{zf\\_factor} \\times N\\,$ 个点来进行补零。\n5. 计算离散傅里叶变换及其以赫兹为单位的频率轴，然后根据测试用例选择谱振幅为实部或模。\n6. 检测最大峰值箱，并对最大值及其相邻点使用简单的抛物线插值来精修峰频率，以估计子箱峰位。如果最大值位于边缘，则跳过插值以优雅地处理边界箱。\n7. 使用公式 $\\,\\delta_{\\text{meas}} = [(f_{\\text{peak}} - \\Delta \\nu_{\\text{ref}})/\\nu_0] \\times 10^6\\,$ 将测量到的峰频率 $\\,f_{\\text{peak}}\\,$ 转换为以百万分率为单位的表观化学位移，其中 $\\,\\Delta \\nu_{\\text{ref}}\\,$ 是以赫兹为单位的给定定标错误（对于正确定标的情况，使用 $\\,\\Delta \\nu_{\\text{ref}} = 0\\,$）。\n8. 为每个测试用例返回计算出的 $\\,\\delta_{\\text{meas}}\\,$，作为一个浮点数。\n\n物理单位：\n- 频率 $\\,\\nu_0\\,$, $\\,f_0\\,$ 和 $\\,\\Delta \\nu_{\\text{ref}}\\,$ 必须以赫兹 ($\\,\\mathrm{Hz}\\,$) 为单位处理。\n- 时间参数 $\\,\\Delta t\\,$, $\\,T_2\\,$, $\\,\\tau\\,$ 和 $\\,\\sigma\\,$ 必须以秒 ($\\,\\mathrm{s}\\,$) 为单位处理。\n- 所有化学位移 $\\,\\delta\\,$ 必须以百万分率 (ppm) 表示，并为十进制浮点数。\n\n角度单位：\n- 相位（如 $\\,\\phi_0\\,$）必须以弧度为单位。\n\n测试套件：\n在您的程序中以下列测试用例作为列表提供。每个用例都是一个参数元组 $\\,(\\nu_0,\\ \\delta_{\\text{true}},\\ N,\\ \\Delta t,\\ T_2,\\ \\phi_0,\\ \\text{window\\_type},\\ \\text{window\\_param},\\ \\mathrm{zf\\_factor},\\ \\text{amplitude\\_mode},\\ \\Delta \\nu_{\\text{ref}})\\,$. 请精确使用这些值：\n- 案例 A (理想情况)：$\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, 无窗函数，参数 $\\,0.0\\,$, $\\,\\mathrm{zf\\_factor} = 1\\,$, 振幅模式实部, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- 案例 B (指数切趾)：$\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, 指数窗，参数 $\\,\\tau = 0.2\\,$, $\\,\\mathrm{zf\\_factor} = 1\\,$, 振幅模式实部, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- 案例 C (相位引起的线型混合)：$\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = \\pi/3\\,$, 无窗函数，参数 $\\,0.0\\,$, $\\,\\mathrm{zf\\_factor} = 1\\,$, 振幅模式实部, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- 案例 D (补零)：$\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, 无窗函数，参数 $\\,0.0\\,$, $\\,\\mathrm{zf\\_factor} = 4\\,$, 振幅模式实部, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- 案例 E (10 赫兹的定标错误)：$\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, 无窗函数，参数 $\\,0.0\\,$, $\\,\\mathrm{zf\\_factor} = 1\\,$, 振幅模式实部, $\\,\\Delta \\nu_{\\text{ref}} = +10.0\\,$.\n- 案例 F (边界邻近)：$\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 9.900\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, 无窗函数，参数 $\\,0.0\\,$, $\\,\\mathrm{zf\\_factor} = 1\\,$, 振幅模式实部, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n\n答案规范：\n- 对于每个测试用例，计算并返回以百万分率为单位的测量化学位移 $\\,\\delta_{\\text{meas}}\\,$，作为一个十进制浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\,[$result1,result2,result3$]$）。\n\n您的实现必须是完全自包含的，不需要任何输入，并且必须严格遵守最终答案标签中定义的执行环境。", "solution": "目标是量化核磁共振 (NMR) 光谱学中的数字信号处理操作如何影响表观峰频率，并因此影响 $\\delta$ 标度上的化学位移，同时该过程基于相关定义和傅里叶分析。\n\n我们从化学位移的基本定义开始。对于单个 $\\,^{1}\\mathrm{H}\\,$ 共振，化学位移 $\\delta$（单位为百万分率）定义为\n$$\n\\delta = \\frac{\\nu_{\\text{sample}} - \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\n其中 $\\,\\nu_{\\text{sample}}\\,$ 是样品的共振频率，$\\,\\nu_{\\text{ref}}\\,$ 是在相同磁场下的参考标准（例如，四甲基硅烷 (TMS)）的共振频率，$\\,\\nu_0\\,$ 是该原子核的谱仪频率。该定义是 $\\delta$ 标度的基础，并确保了跨仪器间的无量纲归一化。\n\n在 NMR 实验中，在时域中记录自由感应衰减 (FID)。对于具有横向弛豫时间 $\\,T_2\\,$、零阶相位 $\\,\\phi_0\\,$ 以及相对于参考原点的基带共振频率 $\\,f_0\\,$ 的单个共振，我们将其 FID 建模为\n$$\ns(t) = e^{-t/T_2} \\, e^{i(2\\pi f_0 t + \\phi_0)},\n$$\n该模型源于进动的磁化强度呈指数衰减并在正交检测中产生复信号。使用驻留时间 $\\,\\Delta t\\,$ 在 $\\,N\\,$ 个点上进行离散时间采样，得到采样时间点 $\\,t_k = k \\Delta t\\,$（其中 $\\,k = 0,1,\\dots,N-1\\,$）。采集时间为 $\\,T = N \\Delta t\\,$，标称频率箱间隔为 $\\,\\Delta \\nu = 1/T\\,$。补零将离散傅里叶变换中的点数增加到 $\\,N_{\\mathrm{zf}} = \\mathrm{zf\\_factor} \\times N\\,$，从而在频率上提供更密集的箱格划分，而不改变真实的物理分辨率。\n\n诸如切趾之类的信号处理操作通过将 FID 乘以一个窗函数 $\\,w(t)\\,$ 来建模。我们考虑：\n- 指数切趾：$\\,w(t) = e^{-t/\\tau}\\,$，它通过卷积加宽了频域线型，从而增加了有效线宽。\n- 高斯切趾：$\\,w(t) = e^{-(t/\\sigma)^2}\\,$，它产生近似高斯展宽。\n\n时域中的乘法对应于频域中的卷积。对于孤立的对称共振线，与对称窗函数的变换进行卷积会保留真实的中心频率。然而，由于分箱、线型畸变，尤其是在存在相位误差（它会混合吸收和色散分量）的情况下使用实部时，离散化的峰值最大值可能不会与真实中心完全重合。具体来说，$\\,s(t)\\,$ 的傅里叶变换产生一个复数谱 $\\,S(\\nu)\\,$。非零的 $\\,\\phi_0\\,$ 会旋转频谱，因此实部成为吸收型洛伦兹分量和色散分量的线性组合。因为色散分量关于真实共振是反对称的，将其混入实部会引入不对称性，并可能使实部的最大值位置偏离真实中心，即使真实共振频率未变。这一现象说明了信号处理如何影响寻峰，从而影响化学位移的归属。\n\n为了从模拟数据计算表观化学位移：\n1. 根据 $\\delta$ 的定义，假设数字原点等于 $\\,\\nu_{\\text{ref,true}}\\,$，计算 $\\,f_0 = \\nu_0\\,\\delta_{\\text{true}}/10^6\\,$。\n2. 生成离散 FID 为 $\\,s_k = e^{-t_k/T_2}\\,e^{i(2\\pi f_0 t_k + \\phi_0)}\\,$。\n3. 应用所选窗函数：无、带参数 $\\,\\tau\\,$ 的指数窗，或带参数 $\\,\\sigma\\,$ 的高斯窗。\n4. 通过补零填充至 $\\,N_{\\mathrm{zf}}\\,$。\n5. 计算离散傅里叶变换并形成以赫兹为单位的频率轴。为了直观检查，将其移位以使零频率居中。\n6. 根据振幅模式，选择 $\\,\\Re\\{S(\\nu)\\}\\,$ 或 $\\,|S(\\nu)|\\,$ 来执行寻峰。在 $\\,\\phi_0 \\neq 0\\,$ 条件下选择实部说明了相位引起的表观位移。\n7. 找到最大值箱索引 $\\,i_{\\max}\\,$。如果 $\\,i_{\\max}\\,$ 不在边界处，则通过对三点邻域进行二次插值来精修峰频率。对于均匀的箱间隔 $\\,\\Delta f\\,$ 和在箱 $\\,i_{\\max}-1, i_{\\max}, i_{\\max}+1\\,$ 处的振幅 $\\,y_{-1}, y_0, y_{+1}\\,$，使拟合抛物线最大化的子箱偏移 $\\,\\delta i\\,$ 满足\n$$\n\\delta i = \\frac{1}{2}\\,\\frac{y_{-1} - y_{+1}}{y_{-1} - 2y_0 + y_{+1}},\n$$\n在分母非零的情况下，插值后的峰频率为 $\\,f_{\\text{peak}} = f_{i_{\\max}} + \\delta i \\,\\Delta f\\,$。\n8. 通过以下公式将 $\\,f_{\\text{peak}}\\,$ 转换为以百万分率为单位的表观化学位移\n$$\n\\delta_{\\text{meas}} = \\frac{f_{\\text{peak}} - \\Delta \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\n其中 $\\,\\Delta \\nu_{\\text{ref}}\\,$ 编码了定标错误（正的 $\\,\\Delta \\nu_{\\text{ref}}\\,$ 意味着使用的参考频率高于真实参考频率，因此计算出的 $\\,\\delta\\,$ 会减小）。\n\n此过程将寻峰结果直接与化学位移的物理定义联系起来，并说明了窗函数、相位、补零、分箱和定标如何影响 $\\,\\delta\\,$。测试套件涵盖：\n- 一个无窗函数且相位为零的条件良好的情况（案例 A）。\n- 指数切趾，它加宽了谱线但不应改变真实中心（案例 B）。\n- 带有实部寻峰的非零相位，它混合了色散贡献并可能移动表观最大值（案例 C）。\n- 补零以通过更密集的采样来减轻分箱的粗糙度（案例 D）。\n- 定标错误偏移以展示 $\\,\\delta\\,$ 中的系统性偏差（案例 E）。\n- 靠近谱窗边界的共振，以探测分箱和边缘行为（案例 F）。\n\n每个案例的输出是百万分率单位的 $\\,\\delta_{\\text{meas}}\\,$，以方括号括起的单个逗号分隔列表形式打印，满足规定的单位要求，并提供可量化的浮点结果，这与在现实信号处理条件下对化学位移 $\\delta$ 标度和参考标准进行的研究生高级课题研究相一致。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef simulate_fid(n_points, dt, f0_hz, T2_s, phase0_rad, window_type, window_param, zf_factor):\n    \"\"\"\n    Simulate a single-resonance complex FID:\n    s(t) = exp(-t/T2) * exp(i*(2*pi*f0*t + phase0)).\n    Apply optional windowing and zero-filling.\n    \"\"\"\n    t = np.arange(n_points, dtype=np.float64) * dt\n    fid = np.exp(-t / T2_s) * np.exp(1j * (2.0 * np.pi * f0_hz * t + phase0_rad))\n\n    # Apply window\n    if window_type == 'none':\n        pass  # no change\n    elif window_type == 'exponential':\n        tau = float(window_param)\n        if tau > 0.0:\n            fid = fid * np.exp(-t / tau)\n    elif window_type == 'gaussian':\n        sigma = float(window_param)\n        if sigma > 0.0:\n            fid = fid * np.exp(-(t / sigma) ** 2)\n    else:\n        # Unknown window; do nothing\n        pass\n\n    # Zero-filling\n    zf_factor = int(zf_factor)\n    if zf_factor > 1:\n        pad_len = n_points * (zf_factor - 1)\n        fid = np.pad(fid, (0, pad_len), mode='constant', constant_values=0.0)\n\n    return fid\n\ndef spectrum_and_frequency(fid, dt):\n    \"\"\"\n    Compute FFT spectrum (shifted) and corresponding frequency axis in Hz.\n    \"\"\"\n    n = fid.shape[0]\n    spec = np.fft.fftshift(np.fft.fft(fid))\n    freqs = np.fft.fftshift(np.fft.fftfreq(n, d=dt))\n    return spec, freqs\n\ndef peak_pick(freqs, spectrum, mode='real'):\n    \"\"\"\n    Peak picking with optional parabolic interpolation.\n    mode: 'real' uses real part, 'magnitude' uses absolute value.\n    Returns interpolated peak frequency in Hz.\n    \"\"\"\n    if mode == 'real':\n        amp = np.real(spectrum)\n    else:\n        amp = np.abs(spectrum)\n\n    # Find maximum bin\n    i_max = int(np.argmax(amp))\n    f_peak = freqs[i_max]\n\n    # Parabolic interpolation using neighbors if available\n    if 0  i_max  (len(amp) - 1):\n        y_m1 = amp[i_max - 1]\n        y_0 = amp[i_max]\n        y_p1 = amp[i_max + 1]\n        denom = (y_m1 - 2.0 * y_0 + y_p1)\n        if denom != 0.0:\n            delta_i = 0.5 * (y_m1 - y_p1) / denom\n            # frequency step is uniform\n            df = freqs[1] - freqs[0]\n            f_peak = f_peak + delta_i * df\n\n    return f_peak\n\ndef compute_delta_meas(nu0_hz, delta_true_ppm, n_points, dt, T2_s, phase0_rad,\n                       window_type, window_param, zf_factor, amplitude_mode, ref_offset_hz):\n    \"\"\"\n    Compute apparent chemical shift delta_meas (ppm) given simulation and processing parameters.\n    \"\"\"\n    # True baseband resonance frequency relative to true reference origin\n    f0_hz = nu0_hz * (delta_true_ppm / 1.0e6)\n\n    # Simulate FID with windowing and zero-filling\n    fid = simulate_fid(n_points, dt, f0_hz, T2_s, phase0_rad, window_type, window_param, zf_factor)\n\n    # Compute spectrum and frequency axis\n    spec, freqs = spectrum_and_frequency(fid, dt)\n\n    # Peak picking\n    f_peak_hz = peak_pick(freqs, spec, mode=amplitude_mode)\n\n    # Apply misreference offset: used reference = true reference + ref_offset_hz\n    # delta_meas = ((f_peak - ref_offset_hz) / nu0) * 1e6\n    delta_meas_ppm = ((f_peak_hz - ref_offset_hz) / nu0_hz) * 1.0e6\n\n    return delta_meas_ppm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (nu0_hz, delta_true_ppm, N, dt, T2, phi0, window_type, window_param, zf_factor, amplitude_mode, ref_offset_hz)\n    test_cases = [\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 0.0),       # Case A\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'exponential', 0.2, 1, 'real', 0.0),# Case B\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, np.pi/3, 'none', 0.0, 1, 'real', 0.0),   # Case C\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 4, 'real', 0.0),       # Case D\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 10.0),      # Case E\n        (400e6, 9.900, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 0.0),       # Case F\n    ]\n\n    results = []\n    for case in test_cases:\n        (nu0_hz, delta_true_ppm, N, dt, T2, phi0, window_type, window_param,\n         zf_factor, amplitude_mode, ref_offset_hz) = case\n\n        delta_meas = compute_delta_meas(\n            nu0_hz=nu0_hz,\n            delta_true_ppm=delta_true_ppm,\n            n_points=N,\n            dt=dt,\n            T2_s=T2,\n            phase0_rad=phi0,\n            window_type=window_type,\n            window_param=window_param,\n            zf_factor=zf_factor,\n            amplitude_mode=amplitude_mode,\n            ref_offset_hz=ref_offset_hz\n        )\n        # Format to a reasonable precision to reflect ppm reporting\n        results.append(f\"{delta_meas:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3726733"}]}