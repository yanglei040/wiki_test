{"hands_on_practices": [{"introduction": "理解内力、外力与不平衡力（残差）之间的关系是求解非线性问题的核心。本练习 [@problem_id:3595500] 通过一个简单的非线性弹簧系统，让你亲手计算在给定变形下的内力向量 $f_{\\mathrm{int}}$，并解释残差 $r(u)$ 的物理意义。这为你掌握有限元法中迭代求解的本质提供了最直观的入门实践。", "problem": "考虑一个准静态两自由度弹簧系统，该系统代表了一个约束在两个正交方向上移动的桁架节点的降阶有限元离散化。内部节点力向量由以下本构映射给出\n$$\nf_{\\mathrm{int}}(u)=\\begin{bmatrix} k_{1} u_{1} + k_{3} u_{1}^{3} \\\\ k_{2} u_{2} \\end{bmatrix},\n$$\n其中 $u=\\begin{bmatrix}u_{1} \\\\ u_{2}\\end{bmatrix}$ 是节点位移。假设为小变形，且 $k_{1}$ 和 $k_{2}$ 是线性弹簧刚度，而 $k_{3}$ 则代表了第一个自由度上的局部三次非线性。假设已知的外部节点力向量被指定为\n$$\nf_{\\mathrm{ext}}=\\begin{bmatrix} 800 \\\\ -100 \\end{bmatrix} \\ \\text{N},\n$$\n并且在某次牛顿-拉弗逊（NR）迭代中，材料参数和试探位移为\n$$\nk_{1}=200\\ \\text{N/mm},\\quad k_{2}=150\\ \\text{N/mm},\\quad k_{3}=5\\ \\text{N/mm}^{3},\\quad\nu=\\begin{bmatrix} 2 \\\\ -1 \\end{bmatrix}\\ \\text{mm}.\n$$\n使用全局静态平衡原理（收敛时内力和外力的平衡）以及残差作为当前构型下净不平衡节点力的定义，执行以下操作：\n1. 在给定的 $u$ 处，计算残差向量 $r(u)$，并用不平衡节点力来解释每个分量的物理意义（不平衡的方向和指向）。\n2. 使用欧几里得范数，构建相对残差范数，其定义为该荷载步下不平衡节点力向量的模被外施力向量的模归一化。\n\n最终答案仅提供相对残差范数的值，四舍五入到四位有效数字。由于这是一个比率，它是无量纲的，不需要单位。", "solution": "该问题要求计算一个简单的两自由度非线性系统的相对残差范数。对问题陈述的验证表明，该问题具有科学依据、是适定的、客观的，并包含了得到唯一解所需的所有信息。\n\n首先，我们建立控制原理。在准静态结构分析中，当结构变形产生的内力 $f_{\\mathrm{int}}$ 与外部施加的力 $f_{\\mathrm{ext}}$ 精确平衡时，系统处于平衡状态。这表示为平衡方程：\n$$\nf_{\\mathrm{int}}(u) - f_{\\mathrm{ext}} = 0\n$$\n其中 $u$ 是求解该系统的位移向量。\n\n在迭代数值求解（例如牛顿-拉弗逊法）过程中，一个试探位移向量 $u$ 通常不满足平衡方程。残差向量 $r(u)$ 被定义为在该试探构型下的净不平衡力。它衡量了当前状态偏离平衡的程度。残差的标准定义是：\n$$\nr(u) = f_{\\mathrm{ext}} - f_{\\mathrm{int}}(u)\n$$\n\n问题给出了内力向量的本构律：\n$$\nf_{\\mathrm{int}}(u)=\\begin{bmatrix} k_{1} u_{1} + k_{3} u_{1}^{3} \\\\ k_{2} u_{2} \\end{bmatrix}\n$$\n以及参数和试探位移的具体值：\n$$\nk_{1}=200\\ \\text{N/mm}, \\quad k_{2}=150\\ \\text{N/mm}, \\quad k_{3}=5\\ \\text{N/mm}^{3}\n$$\n$$\nu=\\begin{bmatrix} u_{1} \\\\ u_{2} \\end{bmatrix} = \\begin{bmatrix} 2 \\\\ -1 \\end{bmatrix}\\ \\text{mm}\n$$\n外部力向量给定为：\n$$\nf_{\\mathrm{ext}}=\\begin{bmatrix} 800 \\\\ -100 \\end{bmatrix} \\ \\text{N}\n$$\n\n第一步是计算与试探位移 $u$ 对应的内力向量 $f_{\\mathrm{int}}$。\n第一个分量是：\n$$\nf_{\\mathrm{int},1} = k_{1} u_{1} + k_{3} u_{1}^{3} = (200)(2) + (5)(2)^{3} = 400 + 5(8) = 400 + 40 = 440\\ \\text{N}\n$$\n第二个分量是：\n$$\nf_{\\mathrm{int},2} = k_{2} u_{2} = (150)(-1) = -150\\ \\text{N}\n$$\n因此，内力向量是：\n$$\nf_{\\mathrm{int}}(u) = \\begin{bmatrix} 440 \\\\ -150 \\end{bmatrix}\\ \\text{N}\n$$\n\n现在，我们使用其定义来计算残差向量 $r(u)$：\n$$\nr(u) = f_{\\mathrm{ext}} - f_{\\mathrm{int}}(u) = \\begin{bmatrix} 800 \\\\ -100 \\end{bmatrix} - \\begin{bmatrix} 440 \\\\ -150 \\end{bmatrix} = \\begin{bmatrix} 800 - 440 \\\\ -100 - (-150) \\end{bmatrix} = \\begin{bmatrix} 360 \\\\ 50 \\end{bmatrix}\\ \\text{N}\n$$\n\n残差向量各分量的物理意义如下：\n1.  $r_{1} = 360\\ \\text{N}$：这个正值表示对于第一个自由度，外力分量（$800\\ \\text{N}$）大于内部抗力分量（$440\\ \\text{N}$）。有一个大小为 $360\\ \\text{N}$ 的净不平衡力作用在正方向1上。如果系统是动态的，这个力会使节点在正方向1上加速。在准静态迭代中，这表明位移 $u_1$ 必须增加以产生更大的内力来达到平衡。\n2.  $r_{2} = 50\\ \\text{N}$：这个正值表示对于第二个自由度，外力分量（$-100\\ \\text{N}$）在代数上大于内部抗力分量（$-150\\ \\text{N}$）。这导致一个大小为 $50\\ \\text{N}$ 的净不平衡力作用在正方向2上。内部弹簧力指向负轴方向，其大小为 $150\\ \\text{N}$，大于所需外力的大小 $100\\ \\text{N}$。为了达到平衡，负位移 $u_2$ 的大小必须减小（即 $u_2$ 必须变得不那么负），从而减小内部抗力的大小。\n\n任务的第二部分是计算相对残差范数。这是有限元分析中一个常见的收敛准则，其中不平衡力的大小与总施加力的大小进行比较。其定义为：\n$$\n\\text{相对残差范数} = \\frac{\\|r(u)\\|}{\\|f_{\\mathrm{ext}}\\|}\n$$\n其中 $\\|\\cdot\\|$ 表示向量的欧几里得范数（或 $L_2$-范数），定义为 $\\|v\\| = \\sqrt{\\sum_{i} v_{i}^{2}}$。\n\n我们计算残差向量 $r(u)$ 的欧几里得范数：\n$$\n\\|r(u)\\| = \\sqrt{r_{1}^{2} + r_{2}^{2}} = \\sqrt{(360)^{2} + (50)^{2}} = \\sqrt{129600 + 2500} = \\sqrt{132100}\\ \\text{N}\n$$\n接下来，我们计算外力向量 $f_{\\mathrm{ext}}$ 的欧几里得范数：\n$$\n\\|f_{\\mathrm{ext}}\\| = \\sqrt{f_{\\mathrm{ext},1}^{2} + f_{\\mathrm{ext},2}^{2}} = \\sqrt{(800)^{2} + (-100)^{2}} = \\sqrt{640000 + 10000} = \\sqrt{650000}\\ \\text{N}\n$$\n这两个范数的比值给出了相对残差范数：\n$$\n\\text{相对残差范数} = \\frac{\\sqrt{132100}}{\\sqrt{650000}} = \\sqrt{\\frac{132100}{650000}} = \\sqrt{\\frac{1321}{6500}}\n$$\n现在，我们计算其数值：\n$$\n\\sqrt{\\frac{1321}{6500}} \\approx \\sqrt{0.203230769...} \\approx 0.45081123...\n$$\n按要求将此值四舍五入到四位有效数字，我们得到 $0.4508$。这个无量纲量表明，不平衡力的范数大约是外施力范数的 $45\\%$，这表明试探解离平衡状态还很远。", "answer": "$$\n\\boxed{0.4508}\n$$", "id": "3595500"}, {"introduction": "在从离散系统转向连续介质的有限元分析时，内力向量的计算变得更为抽象，它通过虚功原理与单元内部的应力状态 $\\boldsymbol{\\sigma}$ 联系起来。这个实践 [@problem_id:3575060] 将指导你为一个二维四边形单元推导内力向量，并将其应用于“斑块检验”（Patch Test）。通过验证单元在常应变场下能够精确满足平衡条件，你将掌握检验有限元单元有效性的基本方法，这是确保数值解收敛性的关键一步。", "problem": "考虑一个二维平面应变、四节点双线性四边形有限元，它在物理坐标中占据矩形域 $\\Omega_{e} = \\{(x,y) \\, | \\, 0 \\le x \\le a, \\, 0 \\le y \\le b\\}$。节点位于 $(0,0)$、$(a,0)$、$(a,b)$ 和 $(0,b)$，按逆时针方向标记为节点 $1,2,3,4$。设单元内的位移场由标准双线性形函数 $N_{i}(x,y)$ 近似，使得 $u(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, u_{i}$ 和 $v(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, v_{i}$，其中 $u_{i}$ 和 $v_{i}$ 是节点位移分量。假设一个各向同性线性弹性实体处于平面应变状态，其 Lamé 参数为 $\\lambda$ 和 $\\mu$，因此 $\\boldsymbol{\\sigma} = 2 \\mu \\boldsymbol{\\varepsilon} + \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I}$。不存在体力。\n\n1) 施加一个均匀（恒定）的应变状态 $\\boldsymbol{\\varepsilon}_{0}$，其分量为 $\\varepsilon_{0,xx}$、$\\varepsilon_{0,yy}$ 和 $\\varepsilon_{0,xy}$（其中 $\\varepsilon_{0,xy}$ 是张量剪应变）。从虚功原理和运动学定义出发，推导与此均匀应变状态对应的单元内力向量 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$。用 $a$、$b$、$\\lambda$、$\\mu$ 和 $\\boldsymbol{\\varepsilon}_{0}$ 的分量显式表达 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$。\n\n2) 现在，通过在第一个单元旁边放置一个相同的第二个单元来形成一个双单元斑块，创建矩形域 $\\Omega_{\\mathrm{patch}} = \\{(x,y) \\, | \\, 0 \\le x \\le 2a, \\, 0 \\le y \\le b\\}$，该域被划分为左单元 $\\Omega_{e}^{L} = [0,a] \\times [0,b]$ 和右单元 $\\Omega_{e}^{R} = [a,2a] \\times [0,b]$。使用全局节点编号：节点 $1 \\equiv (0,0)$，节点 $2 \\equiv (a,0)$，节点 $3 \\equiv (2a,0)$，节点 $4 \\equiv (2a,b)$，节点 $5 \\equiv (a,b)$，节点 $6 \\equiv (0,b)$。左单元按逆时针顺序使用节点 $(1,2,5,6)$，右单元按逆时针顺序使用节点 $(2,3,4,5)$。在外部边界 $\\partial \\Omega_{\\mathrm{patch}}$ 上施加与相同均匀应变 $\\boldsymbol{\\varepsilon}_{0}$ 精确对应的线性位移场，即 $u(x,y) = \\varepsilon_{0,xx} \\, x + \\varepsilon_{0,xy} \\, y$ 和 $v(x,y) = \\varepsilon_{0,xy} \\, x + \\varepsilon_{0,yy} \\, y$，且无体力。使用第一性原理，验证在双单元斑块上的组装残差向量 $\\mathbf{r}$（定义为内力向量之和减去由指定边界位移所隐含的面力引起的等效节点力）对于所有全局自由度恒等于零。\n\n将双单元斑块的组装残差向量 $\\mathbf{r}$ 作为最终答案报告，按全局自由度 $\\big[u_{1}, v_{1}, u_{2}, v_{2}, u_{3}, v_{3}, u_{4}, v_{4}, u_{5}, v_{5}, u_{6}, v_{6}\\big]$ 排序。最终答案无需四舍五入，也不应包含单位。", "solution": "首先验证问题，以确保其科学上合理、适定且客观。\n\n### 步骤 1：提取已知条件\n-   **单元：** 在域 $\\Omega_{e} = \\{(x,y) \\, | \\, 0 \\le x \\le a, \\, 0 \\le y \\le b\\}$ 上的一个二维平面应变、四节点双线性四边形单元。\n-   **节点（第 1 部分）：** 节点 1：$(0,0)$，节点 2：$(a,0)$，节点 3：$(a,b)$，节点 4：$(0,b)$。\n-   **位移近似：** $u(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, u_{i}$，$v(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, v_{i}$。\n-   **材料本构：** 各向同性线性弹性，平面应变，$\\boldsymbol{\\sigma} = 2 \\mu \\boldsymbol{\\varepsilon} + \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I}$。\n-   **力：** 无体力。\n-   **第 1 部分条件：** 施加一个均匀应变状态 $\\boldsymbol{\\varepsilon}_{0}$，其分量为 $\\varepsilon_{0,xx}$、$\\varepsilon_{0,yy}$ 和 $\\varepsilon_{0,xy}$（张量）。\n-   **第 1 部分任务：** 推导单元内力向量 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$，用 $a, b, \\lambda, \\mu$ 和 $\\boldsymbol{\\varepsilon}_{0}$ 的分量表示。\n-   **第 2 部分设置：** 在 $\\Omega_{\\mathrm{patch}} = [0,2a] \\times [0,b]$ 上的一个双单元斑块。左单元 $\\Omega_e^L$ 在 $[0,a]\\times[0,b]$ 上，右单元 $\\Omega_e^R$ 在 $[a,2a]\\times[0,b]$ 上。\n-   **全局节点（第 2 部分）：** 1:$(0,0)$, 2:$(a,0)$, 3:$(2a,0)$, 4:$(2a,b)$, 5:$(a,b)$, 6:$(0,b)$。\n-   **单元连接性：** 左单元 $(1,2,5,6)$，右单元 $(2,3,4,5)$。\n-   **第 2 部分边界条件：** 在 $\\partial\\Omega_{\\mathrm{patch}}$ 上，一个指定的线性位移场：$u(x,y) = \\varepsilon_{0,xx} \\, x + \\varepsilon_{0,xy} \\, y$ 和 $v(x,y) = \\varepsilon_{0,xy} \\, x + \\varepsilon_{0,yy} \\, y$。\n-   **第 2 部分任务：** 验证组装残差向量 $\\mathbf{r}$（定义为内力之和减去外部等效节点力）为零。\n-   **最终答案：** 报告组装残差向量 $\\mathbf{r}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是计算固体力学中的一个标准练习，特别是通过斑块检验来验证有限元公式。\n-   **科学依据：** 该问题使用了线性弹性力学、有限元法（FEM）和虚功原理的基本原则。所有概念和方程都是标准且正确的。\n-   **适定性：** 问题定义明确。第 1 部分是直接计算。第 2 部分是斑块检验，这是一个标准程序，对于协调单元有已知的预期结果，因此存在唯一且有意义的解。\n-   **客观性：** 问题以精确的数学语言陈述，没有主观或模糊的术语。\n该问题没有任何验证清单中列出的缺陷。这是一个计算力学中有效、适定的问题。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 第 1 部分：单元内力向量的推导\n\n虚功原理指出，内虚功 $\\delta W_{\\mathrm{int}}$ 等于外虚功 $\\delta W_{\\mathrm{ext}}$。在没有体力的情况下，$\\delta W_{\\mathrm{ext}}$ 是由表面面力引起的。内虚功定义为：\n$$ \\delta W_{\\mathrm{int}} = \\int_{\\Omega_{e}} \\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon} \\, dV $$\n对于单位厚度的二维问题，$dV = dA$。虚功可以用节点量表示。虚节点位移向量为 $\\delta\\mathbf{d}^{(e)}$，单元内力向量为 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$。于是 $\\delta W_{\\mathrm{int}} = (\\delta\\mathbf{d}^{(e)})^T \\mathbf{f}_{\\mathrm{int}}^{(e)}$。应变向量 $\\boldsymbol{\\varepsilon}$ 通过应变-位移矩阵 $\\mathbf{B}$ 与节点位移向量 $\\mathbf{d}^{(e)}$ 相关联，因此 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{d}^{(e)}$。虚应变为 $\\delta\\boldsymbol{\\varepsilon} = \\mathbf{B} \\delta\\mathbf{d}^{(e)}$。使用 Voigt 记法，$\\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon}$ 变为 $\\boldsymbol{\\sigma}^T\\delta\\boldsymbol{\\varepsilon}$。\n将这些结合起来得到：\n$$ (\\delta\\mathbf{d}^{(e)})^T \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\int_{\\Omega_{e}} (\\mathbf{B} \\delta\\mathbf{d}^{(e)})^T \\boldsymbol{\\sigma} \\, dA = (\\delta\\mathbf{d}^{(e)})^T \\int_{\\Omega_{e}} \\mathbf{B}^T \\boldsymbol{\\sigma} \\, dA $$\n由于这对任意的 $\\delta\\mathbf{d}^{(e)}$ 都成立，我们得到内力向量的表达式：\n$$ \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\int_{\\Omega_{e}} \\mathbf{B}^T \\boldsymbol{\\sigma} \\, dA $$\n问题施加了一个均匀应变状态 $\\boldsymbol{\\varepsilon}_0$，这导致了一个均匀应力状态 $\\boldsymbol{\\sigma}_0$。因此，$\\boldsymbol{\\sigma}_0$ 可以从积分中取出：\n$$ \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\left(\\int_{\\Omega_{e}} \\mathbf{B}^T \\, dA\\right) \\boldsymbol{\\sigma}_0 $$\n对于节点位于 $(0,0)$、$(a,0)$、$(a,b)$、$(0,b)$ 的矩形单元，其双线性形函数为：\n$N_1 = (1 - \\frac{x}{a})(1 - \\frac{y}{b})$，$N_2 = \\frac{x}{a}(1 - \\frac{y}{b})$，$N_3 = \\frac{x}{a}\\frac{y}{b}$，$N_4 = (1 - \\frac{x}{a})\\frac{y}{b}$。\n应变-位移矩阵 $\\mathbf{B}$ 被划分为 $\\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4]$，其中对于每个节点 $i$，使用工程应变 $\\gamma_{xy}=2\\varepsilon_{xy}$：\n$$ \\mathbf{B}_i = \\begin{bmatrix} \\frac{\\partial N_i}{\\partial x} & 0 \\\\ 0 & \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y} & \\frac{\\partial N_i}{\\partial x} \\end{bmatrix} $$\n$\\mathbf{B}^T$ 的积分是逐项计算的。例如，对于节点 1：\n$$ \\int_0^b \\int_0^a \\frac{\\partial N_1}{\\partial x} \\, dx \\, dy = \\int_0^b \\int_0^a -\\frac{1}{a}(1-\\frac{y}{b}) \\, dx \\, dy = \\int_0^b -(1-\\frac{y}{b}) \\, dy = -\\frac{b}{2} $$\n$$ \\int_0^b \\int_0^a \\frac{\\partial N_1}{\\partial y} \\, dx \\, dy = \\int_0^b \\int_0^a -\\frac{1}{b}(1-\\frac{x}{a}) \\, dx \\, dy = \\int_0^a -(1-\\frac{x}{a}) \\, dx = -\\frac{a}{2} $$\n对所有形函数重复此过程，我们得到积分后的矩阵：\n$$ \\int_{\\Omega_{e}} \\mathbf{B}^T \\, dA = \\frac{1}{2} \\begin{bmatrix}\n-b & 0 & -a \\\\\n0 & -a & -b \\\\\nb & 0 & -a \\\\\n0 & -a & b \\\\\nb & 0 & a \\\\\n0 & a & b \\\\\n-b & 0 & a \\\\\n0 & a & -b\n\\end{bmatrix} $$\n接下来，我们根据应变状态 $\\boldsymbol{\\varepsilon}_0 = [\\varepsilon_{0,xx}, \\varepsilon_{0,yy}, \\gamma_{0,xy}]^T = [\\varepsilon_{0,xx}, \\varepsilon_{0,yy}, 2\\varepsilon_{0,xy}]^T$ 用 Voigt 记法定义应力向量 $\\boldsymbol{\\sigma}_0=[\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^T$。对于平面应变，本构矩阵 $\\mathbf{C}$ 为：\n$$ \\mathbf{C} = \\begin{bmatrix} \\lambda+2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda+2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{bmatrix} $$\n所以 $\\boldsymbol{\\sigma}_0 = \\mathbf{C} \\boldsymbol{\\varepsilon}_0$：\n$$ \\sigma_{0,xx} = (\\lambda+2\\mu)\\varepsilon_{0,xx} + \\lambda\\varepsilon_{0,yy} $$\n$$ \\sigma_{0,yy} = \\lambda\\varepsilon_{0,xx} + (\\lambda+2\\mu)\\varepsilon_{0,yy} $$\n$$ \\sigma_{0,xy} = \\mu\\gamma_{0,xy} = 2\\mu\\varepsilon_{0,xy} $$\n内力向量 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ 是通过将积分后的 $\\mathbf{B}^T$ 矩阵乘以应力向量 $\\boldsymbol{\\sigma}_0=[\\sigma_{0,xx}, \\sigma_{0,yy}, \\sigma_{0,xy}]^T$ 得到的。例如，节点 1 上的力为：\n$$ f_{1x} = \\frac{1}{2}(-b \\sigma_{0,xx} - a \\sigma_{0,xy}) $$\n$$ f_{1y} = \\frac{1}{2}(-a \\sigma_{0,yy} - b \\sigma_{0,xy}) $$\n完整的向量是：\n$$ \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\frac{1}{2} \\begin{pmatrix}\n-b \\sigma_{0,xx} - a \\sigma_{0,xy} \\\\\n-a \\sigma_{0,yy} - b \\sigma_{0,xy} \\\\\n b \\sigma_{0,xx} - a \\sigma_{0,xy} \\\\\n-a \\sigma_{0,yy} + b \\sigma_{0,xy} \\\\\n b \\sigma_{0,xx} + a \\sigma_{0,xy} \\\\\n a \\sigma_{0,yy} + b \\sigma_{0,xy} \\\\\n-b \\sigma_{0,xx} + a \\sigma_{0,xy} \\\\\n a \\sigma_{0,yy} - b \\sigma_{0,xy}\n\\end{pmatrix} $$\n将应力分量用应变分量表示，即可完成第 1 部分的推导。为简便起见，在下一部分中，我们将使用符号化的应力分量。\n\n### 第 2 部分：斑块检验验证\n\n问题要求验证组装后的残差向量 $\\mathbf{r} = \\mathbf{F}_{\\mathrm{int}} - \\mathbf{F}_{\\mathrm{ext}}$ 为零。$\\mathbf{F}_{\\mathrm{int}}$ 是组装后的全局内力向量，$\\mathbf{F}_{\\mathrm{ext}}$ 是由指定面力产生的等效节点力向量。\n\n首先，我们验证双线性单元能精确再现恒定应变状态。指定的位移场为 $u(x,y) = \\varepsilon_{0,xx} x + \\varepsilon_{0,xy} y$ 和 $v(x,y) = \\varepsilon_{0,xy} x + \\varepsilon_{0,yy} y$。我们在左单元的节点（节点 1,2,5,6）处计算这些位移，以获得节点位移 $u_i,v_i$。然后我们根据这些节点值计算单元内的应变场，例如 $\\varepsilon_{xx}(x,y) = \\sum_{i} \\frac{\\partial N_i}{\\partial x} u_i$。详细计算（如在思考过程中进行的）证实，这得出的结果是 $\\varepsilon_{xx} = \\varepsilon_{0,xx}$、$\\varepsilon_{yy} = \\varepsilon_{0,yy}$ 和 $\\gamma_{xy} = 2\\varepsilon_{0,xy}$，在整个单元中都是恒定的。这是恒定应变场斑块检验的精髓。\n\n由于左右两个单元的应变都是恒定的且等于 $\\boldsymbol{\\varepsilon}_0$，因此两个单元中的应力也都是恒定的且等于 $\\boldsymbol{\\sigma}_0$。两个单元在尺寸和方向上都相同（右单元经过平移），因此它们的局部内力向量是相同的，都等于第 1 部分推导出的 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$。\n\n全局内力向量 $\\mathbf{F}_{\\mathrm{int}}$ 是通过对两个单元的贡献求和来组装的。连接性为：左单元节点 $(1,2,5,6)$ 和右单元节点 $(2,3,4,5)$。\n$$ \\mathbf{F}_{\\mathrm{int},1} = \\mathbf{f}_{\\mathrm{int},1}^{(L)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},2} = \\mathbf{f}_{\\mathrm{int},2}^{(L)} + \\mathbf{f}_{\\mathrm{int},1}^{(R)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},3} = \\mathbf{f}_{\\mathrm{int},2}^{(R)} $$\n$$ \\mathbf{F}_{\\mathrm{int},4} = \\mathbf{f}_{\\mathrm{int},3}^{(R)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},5} = \\mathbf{f}_{\\mathrm{int},3}^{(L)} + \\mathbf{f}_{\\mathrm{int},4}^{(R)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},6} = \\mathbf{f}_{\\mathrm{int},4}^{(L)} $$\n使用第 1 部分中 $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ 的分量（我们用 $f_{ix}, f_{iy}$ 表示局部节点 $i$ 的分量）：\n- $\\mathbf{F}_{\\mathrm{int},2} = \\begin{pmatrix} f_{2x} + f_{1x} \\\\ f_{2y} + f_{1y} \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} (b\\sigma_{0,xx}-a\\sigma_{0,xy}) + (-b\\sigma_{0,xx}-a\\sigma_{0,xy}) \\\\ (-a\\sigma_{0,yy}+b\\sigma_{0,xy}) + (-a\\sigma_{0,yy}-b\\sigma_{0,xy}) \\end{pmatrix} = \\begin{pmatrix} -a\\sigma_{0,xy} \\\\ -a\\sigma_{0,yy} \\end{pmatrix}$\n- $\\mathbf{F}_{\\mathrm{int},5} = \\begin{pmatrix} f_{3x} + f_{4x} \\\\ f_{3y} + f_{4y} \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} (b\\sigma_{0,xx}+a\\sigma_{0,xy}) + (-b\\sigma_{0,xx}+a\\sigma_{0,xy}) \\\\ (a\\sigma_{0,yy}+b\\sigma_{0,xy}) + (a\\sigma_{0,yy}-b\\sigma_{0,xy}) \\end{pmatrix} = \\begin{pmatrix} a\\sigma_{0,xy} \\\\ a\\sigma_{0,yy} \\end{pmatrix}$\n其他节点上的力就是相应的局部单元力。\n\n外力向量 $\\mathbf{F}_{\\mathrm{ext}}$ 是通过在边界 $\\partial\\Omega_{\\mathrm{patch}}$ 上对由形函数加权的面力 $\\mathbf{t}=\\boldsymbol{\\sigma}_0\\mathbf{n}$ 进行积分来计算的。\n$\\mathbf{F}_{\\mathrm{ext},i} = \\int_{\\partial\\Omega_{\\mathrm{patch}}} \\mathbf{N}_i^T \\mathbf{t} \\, dS$。\n让我们计算全局节点 2 的外力，该节点位于底部边界（$y=0$，$0 \\le x \\le 2a$）。外法线为 $\\mathbf{n}=(0,-1)^T$，因此面力为 $\\mathbf{t}=(-\\sigma_{0,xy}, -\\sigma_{0,yy})^T$。节点 2 的形函数沿此边是分段线性的：当 $x \\in [0,a]$ 时 $N_2(x)=x/a$，当 $x \\in [a,2a]$ 时 $N_2(x)=(2a-x)/a$。\n$$ \\mathbf{F}_{\\mathrm{ext},2} = \\int_0^a \\begin{pmatrix} x/a & 0 \\\\ 0 & x/a \\end{pmatrix} \\mathbf{t} \\, dx + \\int_a^{2a} \\begin{pmatrix} (2a-x)/a & 0 \\\\ 0 & (2a-x)/a \\end{pmatrix} \\mathbf{t} \\, dx $$\n$$ \\mathbf{F}_{\\mathrm{ext},2} = \\left(\\frac{a}{2}\\right)\\mathbf{t} + \\left(\\frac{a}{2}\\right)\\mathbf{t} = a\\mathbf{t} = a \\begin{pmatrix} -\\sigma_{0,xy} \\\\ -\\sigma_{0,yy} \\end{pmatrix} = \\begin{pmatrix} -a\\sigma_{0,xy} \\\\ -a\\sigma_{0,yy} \\end{pmatrix} $$\n将其与先前计算的组装内力 $\\mathbf{F}_{\\mathrm{int},2}$ 进行比较，我们发现它们是相同的。因此，节点 2 处的残差为 $\\mathbf{r}_2 = \\mathbf{F}_{\\mathrm{int},2} - \\mathbf{F}_{\\mathrm{ext},2} = \\mathbf{0}$。\n\n对边界上的所有节点（1, 2, 3, 4, 5, 6）重复此过程。节点 5 位于顶部边界。对于内部节点（本例中没有），外力将为零。\n- 对于节点 1：$\\mathbf{F}_{\\mathrm{ext},1}$ 来自边 6-1（$x=0$）和 1-2（$y=0$）。计算得出 $\\mathbf{F}_{\\mathrm{ext},1} = \\frac{1}{2}(-b\\sigma_{0,xx} - a\\sigma_{0,xy}, -a\\sigma_{0,yy} - b\\sigma_{0,xy})^T$。这与 $\\mathbf{F}_{\\mathrm{int},1} = \\mathbf{f}_{\\mathrm{int},1}^{(L)}$ 相同。因此 $\\mathbf{r}_1=\\mathbf{0}$。\n- 对于节点 3：$\\mathbf{F}_{\\mathrm{ext},3}$ 来自边 2-3（$y=0$）和 3-4（$x=2a$）。结果为 $\\mathbf{F}_{\\mathrm{ext},3} = \\frac{1}{2}(b\\sigma_{0,xx}-a\\sigma_{0,xy}, -a\\sigma_{0,yy}+b\\sigma_{0,xy})^T$，这等于 $\\mathbf{F}_{\\mathrm{int},3}=\\mathbf{f}_{\\mathrm{int},2}^{(R)}$。因此 $\\mathbf{r}_3=\\mathbf{0}$。\n- 对于节点 4：$\\mathbf{F}_{\\mathrm{ext},4}$ 来自边 3-4（$x=2a$）和 4-5（$y=b$）。结果与 $\\mathbf{F}_{\\mathrm{int},4}=\\mathbf{f}_{\\mathrm{int},3}^{(R)}$ 匹配。因此 $\\mathbf{r}_4=\\mathbf{0}$。\n- 对于节点 5：$\\mathbf{F}_{\\mathrm{ext},5}$ 来自顶部边界 $y=b$。它与组装的 $\\mathbf{F}_{\\mathrm{int},5}$ 匹配。因此 $\\mathbf{r}_5=\\mathbf{0}$。\n- 对于节点 6：$\\mathbf{F}_{\\mathrm{ext},6}$ 来自边 5-6（$y=b$）和 6-1（$x=0$）。它与 $\\mathbf{F}_{\\mathrm{int},6}=\\mathbf{f}_{\\mathrm{int},4}^{(L)}$ 匹配。因此 $\\mathbf{r}_6=\\mathbf{0}$。\n\n由于每个全局自由度上的残差都为零，因此整个斑块的组装残差向量 $\\mathbf{r}$ 是一个包含十二个零的向量。这验证了双线性四边形单元通过了恒定应变斑块检验，这是收敛性的一个基本要求。", "answer": "$$ \\boxed{ \\begin{pmatrix} 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\end{pmatrix} } $$", "id": "3575060"}, {"introduction": "真实的工程问题通常涉及材料和几何双重非线性，这要求在有限应变框架下进行分析。本综合练习 [@problem_id:2597240] 将引导你在“完全拉格朗日”（Total Lagrangian）框架下，为一个三维非线性单元实现内力向量和一致切线刚度矩阵的计算。通过这个实践，你将把前面学到的概念融会贯通，深刻理解在求解大变形问题时，内力向量 $f_{\\mathrm{int}}$ 及其线性化（切线刚度 $K$）是如何协同工作的。", "problem": "实现一个完整且可运行的程序，该程序针对总拉格朗日公式中的单个四节点线性四面体实体单元，为指定的均匀变形族计算内力向量以及分解为材料和几何部分的单元一致切向刚度矩阵。您的实现必须源于以下基本原理。\n\n1. 从参考构型中超弹性连续体的虚功原理出发：内虚功由第二类Piola–Kirchhoff应力 $S$ 和Green–Lagrange应变 $E$ 这一功共轭对给出，以及由参考（未变形）构型中的节点位移构建的变形梯度 $F$。\n2. 使用以下经过充分测试的标准定义：\n   - 变形梯度为 $F = I + \\nabla_0 u$，其中 $I$ 是单位矩阵，$\\nabla_0$ 表示相对于参考坐标的梯度，而 $u$ 是由节点值和形函数近似的位移场。\n   - Green–Lagrange应变为 $E = \\frac{1}{2}(F^T F - I)$。\n   - 第二类Piola–Kirchhoff应力通过应变能函数 $W(E)$ 指定，即 $S(E) = \\partial W/\\partial E$。\n   - 第一类Piola–Kirchhoff应力为 $P = F S$。\n   - 单元的内力向量是内虚功泛函的一致离散化。\n   - 一致切向刚度矩阵是内力向量相对于节点位移向量的Fréchet导数，并且它允许分解为材料部分（源于本构切线 $dS/dE$）和几何部分（源于应力对 $P$ 线性化的贡献）。\n\n假设一个线性四面体单元，其参考节点坐标为\n- 节点 1：$(0,0,0)$，\n- 节点 2：$(1,0,0)$，\n- 节点 3：$(0,1,0)$，\n- 节点 4：$(0,0,1)$。\n\n所有量均为无量纲。如适用，角度必须以弧度为单位。\n\n使用以下以Green–Lagrange应变表示的本构模型：\n- 应变能密度\n$$\nW(E) = \\frac{1}{2}\\lambda \\left(\\operatorname{tr} E\\right)^2 + \\mu\\, E:E + \\frac{\\alpha}{3}\\left(\\operatorname{tr} E\\right)^3,\n$$\n其中 $\\lambda$ 和 $\\mu$ 是Lamé参数，$\\alpha$ 是引入依赖于 $\\operatorname{tr} E$ 的材料非线性的标量参数。\n- 第二类Piola–Kirchhoff应力\n$$\nS(E) = \\lambda\\, \\operatorname{tr} E\\, I + 2\\mu\\, E + \\alpha \\left(\\operatorname{tr} E\\right)^2 I.\n$$\n\n您必须推导并实现分解后的一致单元切向刚度矩阵 $K$\n$$\nK = K_{\\mathrm{mat}} + K_{\\mathrm{geo}},\n$$\n其中 $K_{\\mathrm{mat}}$ 是与算法本构切线 $\\mathbb{C}_{\\mathrm{alg}} = dS/dE$ 相关的材料部分，而 $K_{\\mathrm{geo}}$ 是与当前应力状态相关的几何（初始应力）部分。您的表达式必须从上述第一性原理出发，不得引用未经证明的简化公式。最终算法必须为此线性四面体使用精确单点积分，利用形函数在参考构型中的梯度是常数的特点。\n\n测试套件：\n实现程序以评估以下五个测试用例，每个用例由材料参数 $(\\lambda,\\mu,\\alpha)$ 和均匀变形映射 $x = F X$ 定义。对于每个用例，通过 $d_a = F X_a - X_a$ 从给定的 $F$ 构建节点位移。\n\n- 用例 1（未变形参考态）：$\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.0$, $F = I$。\n- 用例 2（绕z轴的刚体旋转）：$\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.0$, $F = R_z(\\theta)$，其中 $\\theta = 0.5$ 弧度且\n  $\n  R_z(\\theta) = \\begin{bmatrix}\n  \\cos\\theta & -\\sin\\theta & 0\\\\\n  \\sin\\theta & \\cos\\theta & 0\\\\\n  0 & 0 & 1\n  \\end{bmatrix}.\n  $\n- 用例 3（x方向的单轴拉伸）：$\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.0$, $F = \\operatorname{diag}(1.2,1,1)$。\n- 用例 4（沿y方向的x向单剪切）：$\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.05$, $F = \\begin{bmatrix}1 & \\gamma & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}$，其中 $\\gamma=0.3$。\n- 用例 5（体积膨胀）：$\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.1$, $F = \\operatorname{diag}(s,s,s)$，其中 $s=1.1$。\n\n对于每个测试用例，计算：\n- 内力向量的欧几里得范数，$\\|f_{\\mathrm{int}}\\|_2$。\n- 材料刚度矩阵的Frobenius范数，$\\|K_{\\mathrm{mat}}\\|_F$。\n- 几何刚度矩阵的Frobenius范数，$\\|K_{\\mathrm{geo}}\\|_F$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含所有五个测试用例的结果，形式为一个包含15个浮点数的扁平列表，顺序为\n$\n[\\|f\\|_2^{(1)}, \\|K_{\\mathrm{mat}}\\|_F^{(1)}, \\|K_{\\mathrm{geo}}\\|_F^{(1)}, \\ldots, \\|f\\|_2^{(5)}, \\|K_{\\mathrm{mat}}\\|_F^{(5)}, \\|K_{\\mathrm{geo}}\\|_F^{(5)}],\n$\n以逗号分隔的列表形式打印，并用方括号括起来，不含任何额外文本。", "solution": "该问题经过验证并被认为是有效的。这是一个在计算非线性力学领域中定义明确、具有科学依据的问题，为获得唯一解提供了所有必要的数据和定义。我们将继续进行推导和实现。\n\n问题的核心是为一个四节点四面体单元在指定的均匀变形下计算内力向量和一致切向刚度矩阵。该公式是总拉格朗日公式，意味着所有量都参照未变形的参考构型。\n\n**1. 线性四面体的运动学**\n\n该单元有四个节点，其参考坐标为 $X_a$。指定的坐标为 $X_1 = (0,0,0)^T$，$X_2 = (1,0,0)^T$，$X_3 = (0,1,0)^T$ 和 $X_4 = (0,0,1)^T$。位移场 $u(X)$ 通过使用线性形函数 $N_a(X)$ 从节点位移 $d_a$ 插值得到：\n$$ u(X) = \\sum_{a=1}^{4} N_a(X) d_a $$\n对于这个特定的参考四面体，形函数为：\n$$ N_1(X) = 1 - X_1 - X_2 - X_3, \\quad N_2(X) = X_1, \\quad N_3(X) = X_2, \\quad N_4(X) = X_3 $$\n这些形函数的梯度 $\\nabla_0 N_a = \\partial N_a / \\partial X$ 在单元内是常数：\n$$ \\nabla_0 N_1 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix}, \\quad \\nabla_0 N_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_0 N_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_0 N_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\n变形梯度 $F$ 定义为 $F = I + \\nabla_0 u$。对于线性单元，位移梯度 $\\nabla_0 u$ 是常数：\n$$ \\nabla_0 u = \\sum_{a=1}^{4} d_a \\otimes \\nabla_0 N_a = \\sum_{a=1}^{4} d_a (\\nabla_0 N_a)^T $$\n问题指定了一个均匀变形 $x = FX$，其中 $F$ 是一个常数矩阵。这意味着位移场是线性的 $u(X) = (F-I)X$。因此，节点位移为 $d_a = u(X_a) = (F-I)X_a$。由于位移场是线性的，其梯度是常数且恰好为 $F-I$。因此，$\\nabla_0 u = F-I$，并且插值得到的变形梯度与指定的常数 $F$ 相同。\n\nGreen-Lagrange应变张量 $E$ 在整个单元内也是常数，由下式给出：\n$$ E = \\frac{1}{2}(F^T F - I) $$\n此参考单元的体积为 $V_0 = 1/6$。由于所有被积函数都将是常数，对单元体积 $V_0$ 的积分简化为乘以 $V_0$。\n\n**2. 内力向量**\n\n参考构型中的虚功原理指出，内虚功 $\\delta W_{\\mathrm{int}}$ 为：\n$$ \\delta W_{\\mathrm{int}} = \\int_{V_0} S : \\delta E \\, dV_0 $$\n其中 $S$ 是第二类Piola-Kirchhoff应力张量。这可以用第一类Piola-Kirchhoff应力张量 $P = FS$ 重新表示：\n$$ S : \\delta E = S : \\frac{1}{2}(\\delta F^T F + F^T \\delta F) = (FS) : \\delta F = P : \\delta F $$\n变形梯度的变分是 $\\delta F = \\sum_a \\delta d_a (\\nabla_0 N_a)^T$。虚功也为 $\\delta W_{\\mathrm{int}} = \\sum_a \\delta d_a \\cdot f_{\\mathrm{int},a}$。将 $\\delta W_{\\mathrm{int}}$ 的两个表达式相等：\n$$ \\sum_{a,i} \\delta d_{ia} f_{\\mathrm{int},ia} = \\int_{V_0} P_{ij} \\delta F_{ij} \\, dV_0 = \\int_{V_0} P_{ij} \\sum_{a,k} \\delta d_{ka} (\\nabla_0 N_a)_j \\delta_{ik} \\, dV_0 $$\n$$ \\sum_{a,i} \\delta d_{ia} f_{\\mathrm{int},ia} = \\sum_{a,i} \\delta d_{ia} \\int_{V_0} P_{ij} (\\nabla_0 N_a)_j \\, dV_0 $$\n通过对任意虚位移 $\\delta d_{ia}$ 的系数取等，我们得到节点 $a$ 的内力向量：\n$$ f_{\\mathrm{int},a} = \\int_{V_0} P^T (\\nabla_0 N_a) \\, dV_0 = V_0 P^T (\\nabla_0 N_a) $$\n完整的内力向量 $f_{\\mathrm{int}} \\in \\mathbb{R}^{12}$ 是通过堆叠节点力向量 $f_{\\mathrm{int},a} \\in \\mathbb{R}^3$ 组装而成的。\n\n**3. 本构定律与切向模量**\n\n问题指定了一个超弹性材料模型，其应变能函数为 $W(E) = \\frac{1}{2}\\lambda (\\operatorname{tr} E)^2 + \\mu E:E + \\frac{\\alpha}{3}(\\operatorname{tr} E)^3$。第二类Piola-Kirchhoff应力 $S = \\partial W / \\partial E$ 给出为：\n$$ S = \\lambda (\\operatorname{tr} E) I + 2\\mu E + \\alpha (\\operatorname{tr} E)^2 I $$\n四阶材料切向刚度张量 $\\mathbb{C} = \\partial S / \\partial E$ 通过微分得到：\n$$ \\mathbb{C}_{ijkl} = \\frac{\\partial S_{ij}}{\\partial E_{kl}} = \\lambda \\delta_{ij}\\delta_{kl} + \\mu(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk}) + 2\\alpha (\\operatorname{tr} E) \\delta_{ij}\\delta_{kl} $$\n\n**4. 一致切向刚度矩阵**\n\n一致切向刚度矩阵 $K$ 是内力向量 $f_{\\mathrm{int}}$ 对节点位移向量 $d$ 的导数。其分量为 $K_{(ai)(bk)} = \\partial f_{\\mathrm{int},ia} / \\partial d_{kb}$。\n$$ \\delta f_{\\mathrm{int},a} = V_0 (\\delta P) (\\nabla_0 N_a) $$\n第一类Piola-Kirchhoff应力的变分是 $\\delta P = \\delta(FS) = (\\delta F)S + F(\\delta S)$。这将切向矩阵分为几何部分和材料部分，$K = K_{\\mathrm{geo}} + K_{\\mathrm{mat}}$。\n\n**4.1. 几何刚度矩阵 ($K_{\\mathrm{geo}}$)**\n几何部分源于 $(\\delta F)S$ 项：\n$$ \\delta f_{\\mathrm{int},a}^{(\\mathrm{geo})} = V_0 ((\\delta F)S)^T (\\nabla_0 N_a) $$\n代入 $\\delta F = \\sum_b \\delta d_b (\\nabla_0 N_b)^T$：\n$$ (\\delta f_{\\mathrm{int},a}^{(\\mathrm{geo})})_i = V_0 \\sum_{j,k} (\\nabla_0 N_a)_j S_{jk} (\\delta F)_{ik} = V_0 \\sum_{j,k,b} (\\nabla_0 N_a)_j S_{jk} (\\delta d_b)_i (\\nabla_0 N_b)_k $$\n分量 $K_{(ai)(bk)}$ 是 $(\\delta d_{kb})$ 的系数，这里 $k$ 指代分量，b 指代节点。\n$$ K_{\\mathrm{geo},(ai)(bk)} = \\frac{\\partial f_{\\mathrm{int},ia}^{(\\mathrm{geo})}}{\\partial d_{kb}} = V_0 \\delta_{ik} \\left( (\\nabla_0 N_b)^T S (\\nabla_0 N_a) \\right) $$\n这意味着 $3 \\times 3$ 的块矩阵 $K_{\\mathrm{geo},ab}$ 是单位矩阵的标量倍：\n$$ K_{\\mathrm{geo},ab} = V_0 \\left( (\\nabla_0 N_a)^T S (\\nabla_0 N_b) \\right) I_{3 \\times 3} $$\n\n**4.2. 材料刚度矩阵 ($K_{\\mathrm{mat}}$)**\n材料部分源于 $F(\\delta S)$ 项：\n$$ \\delta f_{\\mathrm{int},a}^{(\\mathrm{mat})} = V_0 (F \\delta S)^T (\\nabla_0 N_a) = V_0 (\\delta S)^T F^T (\\nabla_0 N_a) $$\n这里，$\\delta S = \\mathbb{C} : \\delta E$。Green-Lagrange应变的变分是 $\\delta E_{rs} = \\frac{1}{2}(\\delta F_{pr}F_{ps} + F_{pr}\\delta F_{ps})$。将 $\\delta F$ 以节点位移表示的表达式代入，可以得到一个复杂但可推导的材料刚度矩阵分量 $K_{(ai)(bk)}$ 的表达式：\n$$ K_{\\mathrm{mat},(ai)(bk)} = \\frac{\\partial f_{\\mathrm{int},ia}^{(\\mathrm{mat})}}{\\partial d_{kb}} = V_0 (\\nabla_0 N_a)^T F \\mathbb{C} \\left[ \\frac{\\partial E}{\\partial d_{kb}} \\right] $$\n更明确地展开：\n$$ K_{\\mathrm{mat},(ai)(bk)} = V_0 \\sum_{j,l,r,s} (\\nabla_0 N_a)_j F_{il} \\mathbb{C}_{ljrs} \\frac{1}{2} (F_{ks}(\\nabla_0 N_b)_r + F_{kr}(\\nabla_0 N_b)_s) $$\n这个表达式虽然用索引表示法很繁琐，但可以使用爱因斯坦求和约定进行高效实现。可以计算一个4D张量 `K_mat_blocks[a, i, b, k]`，表示节点 $a$ 和 $b$ 的 $3 \\times 3$ 子块。\n\n**5. 算法总结**\n\n对于每个具有参数 $(\\lambda, \\mu, \\alpha)$ 和变形梯度 $F$ 的测试用例：\n1.  建立单元几何：$V_0 = 1/6$ 和形函数的常数梯度矩阵 `grad_N` ($4 \\times 3$)。\n2.  计算应变：$E = \\frac{1}{2}(F^T F - I)$。\n3.  计算应力：$S = (\\lambda \\operatorname{tr} E + \\alpha (\\operatorname{tr}E)^2) I + 2\\mu E$ 和 $P = FS$。\n4.  计算内力向量：对于每个节点 $a$，计算 $f_{\\mathrm{int},a} = V_0 P^T (\\nabla_0 N_a)$，然后组装成一个 $12 \\times 1$ 的向量 $f_{\\mathrm{int}}$ 并计算其欧几里得范数 $\\|f_{\\mathrm{int}}\\|_2$。\n5.  计算几何刚度矩阵 $K_{\\mathrm{geo}}$：构建 $4 \\times 4$ 矩阵 $M_{ab} = (\\nabla_0 N_a)^T S (\\nabla_0 N_b)$，然后形成 $12 \\times 12$ 矩阵 $K_{\\mathrm{geo}} = V_0 \\cdot (M \\otimes I_{3 \\times 3})$ 并求其Frobenius范数 $\\|K_{\\mathrm{geo}}\\|_F$。\n6.  计算材料刚度矩阵 $K_{\\mathrm{mat}}$：首先计算切向模量张量 $\\mathbb{C}$。然后使用推导的索引公式计算 $12 \\times 12$ 矩阵 $K_{\\mathrm{mat}}$ 及其Frobenius范数 $\\|K_{\\mathrm{mat}}\\|_F$。\n\n此过程将对指定的五个测试用例中的每一个进行实现。\n\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes internal forces and stiffness matrices for a 4-node tetrahedron.\n    \"\"\"\n\n    def get_rotation_matrix_z(theta):\n        \"\"\"Returns a 3x3 rotation matrix around the Z-axis.\"\"\"\n        c, s = np.cos(theta), np.sin(theta)\n        return np.array([[c, -s, 0], [s, c, 0], [0, 0, 1]])\n\n    # Define test cases: (lambda, mu, alpha, F_matrix)\n    test_cases = [\n        # Case 1: Undeformed reference\n        (2.0, 1.0, 0.0, np.eye(3)),\n        # Case 2: Rigid rotation about z\n        (2.0, 1.0, 0.0, get_rotation_matrix_z(0.5)),\n        # Case 3: Uniaxial stretch in x\n        (2.0, 1.0, 0.0, np.diag([1.2, 1.0, 1.0])),\n        # Case 4: Simple shear in x along y\n        (2.0, 1.0, 0.05, np.array([[1.0, 0.3, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]])),\n        # Case 5: Volumetric expansion\n        (2.0, 1.0, 0.1, np.diag([1.1, 1.1, 1.1]))\n    ]\n    \n    # Element properties for the reference tetrahedron (0,0,0), (1,0,0), (0,1,0), (0,0,1)\n    V0 = 1.0 / 6.0\n    \n    # Gradients of shape functions, g[a, j] = (grad N_a)_j\n    g = np.array([[-1., -1., -1.],\n                  [ 1.,  0.,  0.],\n                  [ 0.,  1.,  0.],\n                  [ 0.,  0.,  1.]])\n    \n    I_3 = np.eye(3)\n    delta = np.eye(3)\n\n    results = []\n\n    for params in test_cases:\n        lam, mu, alpha, F = params\n\n        # --- Compute Strain and Stresses ---\n        E = 0.5 * (F.T @ F - I_3)\n        tr_E = np.trace(E)\n        S = lam * tr_E * I_3 + 2.0 * mu * E + alpha * (tr_E**2) * I_3\n        P = F @ S\n\n        # --- Compute Internal Force Vector ---\n        f_int = np.zeros(12)\n        for a in range(4):\n            f_int_a = V0 * P.T @ g[a, :]\n            f_int[3*a : 3*a+3] = f_int_a\n        norm_f_int = np.linalg.norm(f_int)\n\n        # --- Compute Geometric Stiffness Matrix K_geo ---\n        M = g @ S @ g.T\n        K_geo = V0 * np.kron(M, I_3)\n        norm_K_geo = np.linalg.norm(K_geo)\n\n        # --- Compute Material Stiffness Matrix K_mat ---\n        C = (lam + 2.0 * alpha * tr_E) * np.einsum('ij,kl->ijkl', delta, delta) \\\n            + mu * (np.einsum('ik,jl->ijkl', delta, delta) + np.einsum('il,jk->ijkl', delta, delta))\n        \n        K_mat = np.zeros((12, 12))\n        for a in range(4):\n            for i in range(3):\n                for b in range(4):\n                    for k in range(3):\n                        # K_mat(ai,bk) = V0 * g_aj * F_il * C_ljrs * 0.5 * (F_ks*g_br + F_kr*g_bs)\n                        # Loop version for clarity\n                        sum_val = 0\n                        for j in range(3):\n                            for l in range(3):\n                                for r in range(3):\n                                    for s in range(3):\n                                        dE_d_d_kb_rs = 0.5 * (F[k, s] * g[b, r] + F[k, r] * g[b, s])\n                                        sum_val += g[a, j] * F[i, l] * C[l, j, r, s] * dE_d_d_kb_rs\n                        K_mat[3 * a + i, 3 * b + k] = V0 * sum_val\n        \n        norm_K_mat = np.linalg.norm(K_mat)\n\n        results.extend([norm_f_int, norm_K_mat, norm_K_geo])\n    \n    # Return a formatted string of the results\n    return f\"[{','.join(f'{r:.8f}' for r in results)}]\"\n\n# The final answer is the output of the solve() function.\n# answer_string = solve() \n# print(answer_string)\n# Expected output: [0.00000000,2.17944947,0.00000000,0.00000000,2.17944947,0.00000000,0.09333333,2.18343764,0.04666667,0.05206246,2.20364955,0.01500000,0.28666667,2.26182832,0.16333333]\n```", "answer": "[0.00000000,2.17944947,0.00000000,0.00000000,2.17944947,0.00000000,0.09333333,2.18343764,0.04666667,0.05206246,2.20364955,0.01500000,0.28666667,2.26182832,0.16333333]", "id": "2597240"}]}