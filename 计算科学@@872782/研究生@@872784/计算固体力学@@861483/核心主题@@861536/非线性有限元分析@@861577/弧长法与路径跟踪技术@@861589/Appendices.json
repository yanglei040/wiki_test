{"hands_on_practices": [{"introduction": "掌握弧长法的第一步是理解其核心的数学构造。此练习旨在引导您推导在路径跟踪算法中求解校正步 $(\\delta u, \\delta \\lambda)$ 的核心方程组。通过将非线性平衡方程与位移控制约束方程耦合，并进行Newton-Raphson线性化，您将得到一个“增广边界矩阵”系统，这是所有弧长法校正步骤的 foundational algebraic structure [@problem_id:3544462]。", "problem": "考虑一个计算固体力学中的非线性有限元平衡问题，其中外部载荷通过一个标量载荷因子引入。设平衡残差定义为 $R(u,\\lambda)=r_{int}(u)-\\lambda f_{ext}$，其中 $u$ 是节点位移向量，$\\lambda$ 是标量载荷因子，$r_{int}(u)$ 是内力向量，$f_{ext}$ 是外部参考载荷向量。一个路径跟踪约束以位移控制的形式施加，$g(u)=c^{T}u-s$，其中 $c$ 是一个恒定方向向量，$s$ 是指定的控制值。\n\n从应用于耦合系统 $R(u,\\lambda)=0$ 和 $g(u)=0$ 的牛顿-拉夫森（NR）方法出发，通过将 $R(u+\\delta u,\\lambda+\\delta \\lambda)$ 和 $g(u+\\delta u)$ 展开至一阶，推导 $(\\delta u, \\delta \\lambda)$ 的线性化修正方程。识别切线刚度矩阵 $K_{T}=\\partial r_{int}/\\partial u$ 以及雅可比贡献 $\\partial R/\\partial \\lambda$ 和 $\\partial g/\\partial u$，并说明如何将得到的修正量写成关于 $(\\delta u,\\delta \\lambda)$ 的增广线性系统。\n\n然后，对于某次特定的NR迭代，使用在当前迭代点 $(u_{k},\\lambda_{k})$ 处测得的以下无量纲数据：\n- $K_{T}=\\begin{bmatrix}10  -2 \\\\ -2  6\\end{bmatrix}$，\n- $f_{ext}=\\begin{bmatrix}4 \\\\ 3\\end{bmatrix}$，\n- $c=\\begin{bmatrix}1 \\\\ -1\\end{bmatrix}$，\n- $u_{k}=\\begin{bmatrix}0.1 \\\\ -0.2\\end{bmatrix}$，$s=0.25$，\n- $R=\\begin{bmatrix}1 \\\\ -2\\end{bmatrix}$。\n\n通过求解您推导出的增广系统，计算此NR步骤的载荷因子修正量 $\\delta \\lambda$。将最终的 $\\delta \\lambda$ 作为一个无量纲数报告。将您的答案四舍五入到四位有效数字。", "solution": "该问题要求推导并求解使用位移控制的路径跟踪算法的线性化方程。控制非线性方程组由平衡残差 $R(u, \\lambda)$ 和路径跟踪约束 $g(u)$ 组成。\n\n耦合系统由下式给出：\n$$\nR(u, \\lambda) = r_{int}(u) - \\lambda f_{ext} = 0\n$$\n$$\ng(u) = c^{T}u - s = 0\n$$\n\n我们应用牛顿-拉夫森方法来求解该系统。设当前状态为 $(u_k, \\lambda_k)$。我们寻求修正量 $(\\delta u, \\delta \\lambda)$，使得下一个迭代点 $(u_{k+1}, \\lambda_{k+1}) = (u_k + \\delta u, \\lambda_k + \\delta \\lambda)$ 满足该系统的线性化版本。我们在 $(u_k, \\lambda_k)$ 周围对 $R$ 和 $g$ 进行一阶泰勒展开：\n\n$$\nR(u_k + \\delta u, \\lambda_k + \\delta \\lambda) \\approx R(u_k, \\lambda_k) + \\frac{\\partial R}{\\partial u}\\bigg|_{(u_k, \\lambda_k)} \\delta u + \\frac{\\partial R}{\\partial \\lambda}\\bigg|_{(u_k, \\lambda_k)} \\delta \\lambda = 0\n$$\n$$\ng(u_k + \\delta u) \\approx g(u_k) + \\frac{\\partial g}{\\partial u}\\bigg|_{u_k} \\delta u = 0\n$$\n\n现在我们按要求识别雅可比项。\n残差 $R$ 关于位移向量 $u$ 的偏导数是切线刚度矩阵 $K_T$：\n$$\n\\frac{\\partial R}{\\partial u} = \\frac{\\partial}{\\partial u} (r_{int}(u) - \\lambda f_{ext}) = \\frac{\\partial r_{int}(u)}{\\partial u} = K_T\n$$\n残差 $R$ 关于载荷因子 $\\lambda$ 的偏导数是：\n$$\n\\frac{\\partial R}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} (r_{int}(u) - \\lambda f_{ext}) = -f_{ext}\n$$\n约束 $g$ 关于位移向量 $u$ 的偏导数是：\n$$\n\\frac{\\partial g}{\\partial u} = \\frac{\\partial}{\\partial u} (c^{T}u - s) = c^T\n$$\n$g$ 关于 $\\lambda$ 的偏导数为 $0$，因为 $g$ 不依赖于 $\\lambda$。\n\n设 $R_k = R(u_k, \\lambda_k)$ 和 $g_k = g(u_k)$ 为当前迭代的残差。将导数代入线性化方程可得：\n$$\nK_T \\delta u - f_{ext} \\delta \\lambda = -R_k\n$$\n$$\nc^T \\delta u = -g_k\n$$\n\n这些方程可以写成关于未知修正量 $(\\delta u, \\delta \\lambda)$ 的增广线性系统形式：\n$$\n\\begin{bmatrix}\nK_T   -f_{ext} \\\\\nc^T   0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\delta u \\\\\n\\delta \\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n-R_k \\\\\n-g_k\n\\end{bmatrix}\n$$\n这完成了问题的推导和识别部分。\n\n接下来，我们使用提供的无量纲数据计算载荷因子修正量 $\\delta \\lambda$：\n- 切线刚度矩阵：$K_{T}=\\begin{bmatrix}10  -2 \\\\ -2  6\\end{bmatrix}$\n- 外部参考载荷向量：$f_{ext}=\\begin{bmatrix}4 \\\\ 3\\end{bmatrix}$\n- 约束方向向量：$c=\\begin{bmatrix}1 \\\\ -1\\end{bmatrix}$，所以 $c^T = \\begin{bmatrix}1  -1\\end{bmatrix}$\n- 当前位移向量：$u_{k}=\\begin{bmatrix}0.1 \\\\ -0.2\\end{bmatrix}$\n- 指定控制值：$s=0.25$\n- 当前迭代点的平衡残差：$R_k=R(u_k, \\lambda_k)=\\begin{bmatrix}1 \\\\ -2\\end{bmatrix}$\n\n首先，我们必须计算当前迭代点的约束残差 $g_k$：\n$$\ng_k = c^T u_k - s = \\begin{bmatrix}1  -1\\end{bmatrix} \\begin{bmatrix}0.1 \\\\ -0.2\\end{bmatrix} - 0.25\n$$\n$$\ng_k = (1)(0.1) + (-1)(-0.2) - 0.25 = 0.1 + 0.2 - 0.25 = 0.3 - 0.25 = 0.05\n$$\n\n增广系统的右侧是：\n$$\n\\begin{bmatrix} -R_k \\\\ -g_k \\end{bmatrix} = \\begin{bmatrix} -\\begin{bmatrix}1 \\\\ -2\\end{bmatrix} \\\\ -0.05 \\end{bmatrix} = \\begin{bmatrix} -1 \\\\ 2 \\\\ -0.05 \\end{bmatrix}\n$$\n\n设 $\\delta u = \\begin{bmatrix} \\delta u_1 \\\\ \\delta u_2 \\end{bmatrix}$，完整的数值系统为：\n$$\n\\begin{bmatrix}\n10   -2  -4 \\\\\n-2   6  -3 \\\\\n1   -1  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\delta u_1 \\\\\n\\delta u_2 \\\\\n\\delta \\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n-1 \\\\\n2 \\\\\n-0.05\n\\end{bmatrix}\n$$\n\n我们可以求解这个 $3 \\times 3$ 系统以得到 $\\delta u_1$、$\\delta u_2$ 和 $\\delta \\lambda$。根据第三个方程：\n$$(1)\\delta u_1 + (-1)\\delta u_2 + (0)\\delta \\lambda = -0.05 \\implies \\delta u_1 = \\delta u_2 - 0.05$$\n\n将 $\\delta u_1$ 的这个表达式代入前两个方程。\n根据第一个方程：\n$$10(\\delta u_2 - 0.05) - 2\\delta u_2 - 4\\delta \\lambda = -1$$\n$$10\\delta u_2 - 0.5 - 2\\delta u_2 - 4\\delta \\lambda = -1$$\n$$8\\delta u_2 - 4\\delta \\lambda = -0.5 \\quad (1)$$\n\n根据第二个方程：\n$$-2(\\delta u_2 - 0.05) + 6\\delta u_2 - 3\\delta \\lambda = 2$$\n$$-2\\delta u_2 + 0.1 + 6\\delta u_2 - 3\\delta \\lambda = 2$$\n$$4\\delta u_2 - 3\\delta \\lambda = 1.9 \\quad (2)$$\n\n我们现在得到了一个关于 $\\delta u_2$ 和 $\\delta \\lambda$ 的 $2 \\times 2$ 系统。将方程(2)乘以 $2$：\n$$8\\delta u_2 - 6\\delta \\lambda = 3.8 \\quad (2')$$\n\n从方程(2')中减去方程(1)：\n$$(8\\delta u_2 - 6\\delta \\lambda) - (8\\delta u_2 - 4\\delta \\lambda) = 3.8 - (-0.5)$$\n$$-2\\delta \\lambda = 4.3$$\n$$\\delta \\lambda = -\\frac{4.3}{2} = -2.15$$\n\n问题要求答案四舍五入到四位有效数字。\n$$\\delta \\lambda = -2.150$$", "answer": "$$\\boxed{-2.150}$$", "id": "3544462"}, {"introduction": "从数学推导到稳健的数值实现是计算力学的关键一步。直接求解前一个练习 [@problem_id:3544462] 中推导出的增广系统，尤其是求切线刚度矩阵 $K_T$ 的逆，在计算上是昂贵且不稳定的。本练习 [@problem_id:3544471] 介绍了一种在实际有限元程序中广泛使用的标准高效算法，该算法通过两次线性求解巧妙地避免了矩阵求逆，并引入了正则化技术以处理在极限点附近 $K_T$ 矩阵奇异或病态的情况。", "problem": "您正在为计算固体力学中的非线性平衡问题实现一个带有弧长路径跟踪约束的牛顿型预测-校正步。其基本原理包括以下几点。\n\n- 对于一个非线性有限元模型，在牛顿迭代中的线性化平衡方程表示为位移增量和荷载因子增量之间的一个线性系统，该系统由虚功原理和牛顿线性化导出。这产生一个形如\n  $$K_T \\,\\delta u - f\\,\\delta \\lambda = -r,$$\n  的系统，其中 $K_T$ 是当前切线刚度矩阵，$f$ 是参考荷载向量，$r$ 是当前残差向量，$\\delta u$ 是位移向量的修正量，$\\delta \\lambda$ 是荷载因子的修正量。\n- 路径跟踪约束被线性化为\n  $$a^\\mathsf{T} \\delta u + h\\,\\delta \\lambda = b,$$\n  其中 $a$ 是所选约束对位移变量的导数，$h$ 是对荷载因子的导数，$b$ 是当前迭代的线性化约束的右端项。\n\n您的任务是设计一个数值稳定的算法来计算 $(\\delta u,\\delta \\lambda)$，而无需显式地构建 $K_T^{-1}$。每次牛顿迭代，您必须精确地使用 $K_T$ 进行两次线性求解，并通过与 $a$ 的内积来组合结果。具体来说，从上述基本原理出发，您必须推導出一个数值稳定的 $\\delta \\lambda$ 表达式，该表达式避免了显式矩阵求逆，然后再求出 $\\delta u$。当 $\\delta \\lambda$ 标量公式中的分母变得很小时，该算法必须通过使用一种稳定的除法策略来处理这种情况，该策略能保持与平衡方程的一致性并避免灾难性抵消。\n\n实现要求。\n\n- 设 $w$ 和 $z$ 是以下两个线性系统的唯一解\n  $$K_T w = f,\\qquad K_T z = r.$$\n  每次牛顿迭代，您只允许使用 $K_T$ 进行这两次线性求解。\n- 组合 $w$ 和 $z$ 以构成\n  $$p = a^\\mathsf{T} w + h, \\qquad q = b + a^\\mathsf{T} z.$$\n- 在通用、良态的情况下，计算\n  $$\\delta \\lambda = \\frac{q}{p}。$$\n  当 $|p|$ 很小时，使用 Tikhonov 稳定的标量求解方法对除法进行正则化，例如通过最小化\n  $$(p\\,\\delta \\lambda - q)^2 + \\sigma^2 \\delta \\lambda^2,$$\n  其中 $\\sigma  0$ 是一个根据问题数据进行缩放的小稳定化参数，并取其最小化解\n  $$\\delta \\lambda = \\frac{p\\,q}{p^2 + \\sigma^2}。$$\n  然后计算\n  $$\\delta u = w\\,\\delta \\lambda - z。$$\n- 您的程序必须实现上述逻辑，并根据机器精度以及 $a$、$w$ 和 $h$ 的大小自动选择 $\\sigma$。您可以使用任何合理的、连续依赖于数据并在条件改善时趋于零的缩放方法。您绝不能显式构建 $K_T^{-1}$。\n\n测试套件和要求的输出。\n\n- 使用以下四个测试用例。对于每个用例，$K_T \\in \\mathbb{R}^{2 \\times 2}$，其余向量在 $\\mathbb{R}^2$ 中；所有标量均为实数。\n  1) 正常路径（对称正定）：\n     - $K_T = \\begin{bmatrix} 10  2 \\\\ 2  5 \\end{bmatrix}$，\n       $f = \\begin{bmatrix} 1 \\\\ 0.5 \\end{bmatrix}$，\n       $r = \\begin{bmatrix} -0.2 \\\\ 0.1 \\end{bmatrix}$，\n       $a = \\begin{bmatrix} 0.6 \\\\ -0.8 \\end{bmatrix}$，\n       $h = 0.3$，$b = 0.05$。\n  2) 病态但可解：\n     - $K_T = \\begin{bmatrix} 10^{-3}  0 \\\\ 0  2 \\end{bmatrix}$，\n       $f = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$，\n       $r = \\begin{bmatrix} 10^{-3} \\\\ -0.2 \\end{bmatrix}$，\n       $a = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$，\n       $h = 0$，$b = 0.01$。\n  3) 退化的线性化约束（分母为零且右端项一致）：\n     - $K_T = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix}$，\n       $f = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$，\n       $r = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$，\n       $a = \\begin{bmatrix} -1 \\\\ 0 \\end{bmatrix}$，\n       $h = 1$，$b = 0$。\n  4) 不定但可逆的 $K_T$：\n     - $K_T = \\begin{bmatrix} 0  1 \\\\ 1  0 \\end{bmatrix}$，\n       $f = \\begin{bmatrix} 0.5 \\\\ -1.0 \\end{bmatrix}$，\n       $r = \\begin{bmatrix} 0.3 \\\\ -0.4 \\end{bmatrix}$，\n       $a = \\begin{bmatrix} 0.2 \\\\ 0.9 \\end{bmatrix}$，\n       $h = -0.1$，$b = -0.02$。\n- 对每个测试用例，计算并返回两个量：\n  1) 标量 $\\delta \\lambda$。\n  2) 平衡残差的欧几里得范数，$\\|K_T \\delta u - f \\delta \\lambda + r\\|_2$。\n- 最终输出格式：您的程序应生成单行输出，其中包含所有用例的结果，形式为方括号括起来的逗号分隔列表，顺序为\n  $$[\\delta \\lambda_1, \\rho_1, \\delta \\lambda_2, \\rho_2, \\delta \\lambda_3, \\rho_3, \\delta \\lambda_4, \\rho_4],$$\n  其中 $\\rho_i$ 是第 $i$ 个用例的残差范数。所有量都是无单位的实数。\n- 在这个纯代数问题中，角度单位和物理单位不适用。\n\n您的最终答案必须是一个完整的、可运行的 Python 程序，该程序仅使用指定的库来计算所需的输出。不允许用户输入，并且程序必须以指定格式精确打印一行。", "solution": "该问题要求推导并实现一个数值稳定的算法，用以在弧长约束的 Newton-Raphson 迭代中求解位移修正量 $\\delta u$ 和荷载因子修正量 $\\delta \\lambda$。控制方程组包括一个表示线性化平衡的线性系统和一个表示线性化路径跟踪约束的线性标量方程。\n\n该方程组由以下公式给出：\n$$\n\\begin{align*}\nK_T \\,\\delta u - f\\,\\delta \\lambda = -r \\quad (1) \\\\\na^\\mathsf{T} \\delta u + h\\,\\delta \\lambda = b \\quad (2)\n\\end{align*}\n$$\n这里，$K_T$ 是切线剛度矩阵，$f$ 是参考荷载向量，$r$ 是残差向量，$a$ 是约束相对于位移的梯度，$h$ 是约束相对于荷载因子的梯度，$b$ 是当前的约束值。未知数是向量 $\\delta u$ 和标量 $\\delta \\lambda$。算法不能显式计算 $K_T$ 的逆。\n\n首先，我们推导形式解。假设切线剛度矩阵 $K_T$ 是可逆的，我们可以从方程 $(1)$ 中表达出位移修正量 $\\delta u$：\n$$ \\delta u = K_T^{-1} (f\\,\\delta \\lambda - r) $$\n利用矩阵求逆算子的线性性质，我们可以将其分为两部分：\n$$ \\delta u = (K_T^{-1} f) \\delta \\lambda - (K_T^{-1} r) $$\n问题定义了两个辅助向量 $w$ 和 $z$，作为以下线性系统的解：\n$$ K_T w = f \\implies w = K_T^{-1} f $$\n$$ K_T z = r \\implies z = K_T^{-1} r $$\n每次迭代只允许进行这两次线性求解。将这些定义代入 $\\delta u$ 的表达式中，得到：\n$$ \\delta u = w\\,\\delta \\lambda - z \\quad (3) $$\n一旦荷载因子修正量 $\\delta \\lambda$ 已知，此表达式就给出了位移修正量 $\\delta u$。\n\n为了求出 $\\delta \\lambda$，我们将方程 $(3)$ 代入线性化约束方程 $(2)$：\n$$ a^\\mathsf{T} (w\\,\\delta \\lambda - z) + h\\,\\delta \\lambda = b $$\n展开各项并重新整理以求解 $\\delta \\lambda$：\n$$ (a^\\mathsf{T} w)\\,\\delta \\lambda - a^\\mathsf{T} z + h\\,\\delta \\lambda = b $$\n$$ (a^\\mathsf{T} w + h)\\,\\delta \\lambda = b + a^\\mathsf{T} z $$\n问题定义了两个标量 $p$ 和 $q$：\n$$ p = a^\\mathsf{T} w + h $$\n$$ q = b + a^\\mathsf{T} z $$\n通过这些定义，$\\delta \\lambda$ 的方程简化为一个标量方程：\n$$ p\\,\\delta \\lambda = q $$\n在 $p \\neq 0$ 的一般情况下，解是直接的：\n$$ \\delta \\lambda = \\frac{q}{p} $$\n当 $|p|$ 接近于零时，会出现数值问题。这种情况对应于荷载-位移路径上的一个临界点，此时约束曲面与平衡路径相切。直接计算 $q/p$ 会导致浮点溢出和灾难性抵消错误。\n\n为了处理这个问题，题目规定了一个 Tikhonov 稳定的解。我们不直接求解 $p\\,\\delta\\lambda = q$，而是找到最小化正则化最小二乘泛函的 $\\delta\\lambda$：\n$$ J(\\delta \\lambda) = (p\\,\\delta \\lambda - q)^2 + \\sigma^2 \\delta \\lambda^2 $$\n其中 $\\sigma  0$ 是一个小的正则化参数。通过将导数 $\\frac{dJ}{d\\delta \\lambda}$ 置为零来找到最小值：\n$$ \\frac{dJ}{d\\delta \\lambda} = 2(p\\,\\delta \\lambda - q)p + 2\\sigma^2 \\delta \\lambda = 0 $$\n$$ p^2 \\delta \\lambda - pq + \\sigma^2 \\delta \\lambda = 0 $$\n$$ (p^2 + \\sigma^2) \\delta \\lambda = pq $$\n$$ \\delta \\lambda = \\frac{p\\,q}{p^2 + \\sigma^2} $$\n当确定 $|p|$ 很小时，使用此稳定化公式。参数 $\\sigma$ 必须仔细选择。根据问题要求，一个稳健的选择是根据数据的大小来缩放 $\\sigma$。对于 $p = a^\\mathsf{T}w+h$，一个物理上和数值上都合理的缩放由表达式 $\\|a\\|_2 \\|w\\|_2 + |h|$ 给出。我们可以使用机器精度 $\\epsilon_{\\text{mach}}$ 相对于此尺度来定义 $\\sigma$：\n$$ \\sigma = \\sqrt{\\epsilon_{\\text{mach}}} \\left( \\|a\\|_2 \\|w\\|_2 + |h| \\right) $$\n使用 $\\sqrt{\\epsilon_{\\text{mach}}}$ 是设置容差的一种标准启发式方法，在舍入误差变得显著时使用。如果 $|p|  \\sigma$，算法则切换到稳定化公式。这种方法确保了在所有条件下都能连续且稳定地计算 $\\delta \\lambda$。\n\n最后，我们必须计算平衡残差的欧几里得范数，$\\|K_T \\delta u - f \\delta \\lambda + r\\|_2$。代入方程 $(3)$ 中 $\\delta u$ 的表达式：\n$$ \\text{Residual} = K_T (w\\,\\delta \\lambda - z) - f\\,\\delta \\lambda + r $$\n$$ = (K_T w)\\delta \\lambda - K_T z - f\\,\\delta \\lambda + r $$\n根据 $w$ 和 $z$ 的定义，我们有 $K_T w = f$ 和 $K_T z = r$。将它们代入：\n$$ \\text{Residual} = f\\,\\delta \\lambda - r - f\\,\\delta \\lambda + r = 0 $$\n在精确算术中，无论使用标准公式还是稳定化公式计算 $\\delta \\lambda$，残差都恒等于零。这是因为关系式 $\\delta u = w\\,\\delta \\lambda - z$ 的构造正是为了满足线性化平衡方程 $(1)$。在浮点运算中，计算出的残差范数将是一个很小的数值，反映了线性求解器及后续操作的数值精度。它可以作为实现的一个有价值的内部一致性检查。\n\n总体算法如下：\n$1$. 给定 $K_T, f, r, a, h, b$。\n$2$. 求解 $K_T w = f$ 和 $K_T z = r$ 得到 $w$ 和 $z$。\n$3$. 计算标量 $p = a^\\mathsf{T} w + h$ 和 $q = b + a^\\mathsf{T} z$。\n$4$. 根据问题数据和机器精度计算正则化参数 $\\sigma$。例如，$\\sigma = \\sqrt{\\epsilon_{\\textmach}} (\\|a\\|_2\\|w\\|_2 + |h| + \\delta_{tiny})$，其中 $\\delta_{tiny}$ 是一个小的正常数，以防止 $\\sigma=0$。\n$5$. 如果 $|p|  \\sigma$，计算 $\\delta \\lambda = \\frac{p\\,q}{p^2 + \\sigma^2}$。\n$6$. 否则，计算 $\\delta \\lambda = q / p$。\n$7$. 计算位移修正量 $\\delta u = w\\,\\delta \\lambda - z$。\n$8$. 计算平衡残差范数 $\\|K_T \\delta u - f \\delta \\lambda + r\\|_2$。\n$9$. 返回计算出的 $\\delta \\lambda$ 和残差范数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes predictor-corrector steps for nonlinear equilibrium with an\n    arc-length constraint for a series of test cases.\n    \"\"\"\n    # Define the test cases as specified in the problem statement.\n    # Each case is a tuple: (KT, f, r, a, h, b)\n    test_cases = [\n        # 1) Happy path (symmetric positive definite)\n        (\n            np.array([[10.0, 2.0], [2.0, 5.0]]),\n            np.array([1.0, 0.5]),\n            np.array([-0.2, 0.1]),\n            np.array([0.6, -0.8]),\n            0.3,\n            0.05\n        ),\n        # 2) Ill-conditioned but solvable\n        (\n            np.array([[1e-3, 0.0], [0.0, 2.0]]),\n            np.array([1.0, 1.0]),\n            np.array([1e-3, -0.2]),\n            np.array([1.0, 0.0]),\n            0.0,\n            0.01\n        ),\n        # 3) Degenerate linearized constraint (p=0, q=0)\n        (\n            np.array([[1.0, 0.0], [0.0, 1.0]]),\n            np.array([1.0, 0.0]),\n            np.array([0.0, 0.0]),\n            np.array([-1.0, 0.0]),\n            1.0,\n            0.0\n        ),\n        # 4) Indefinite but invertible KT\n        (\n            np.array([[0.0, 1.0], [1.0, 0.0]]),\n            np.array([0.5, -1.0]),\n            np.array([0.3, -0.4]),\n            np.array([0.2, 0.9]),\n            -0.1,\n            -0.02\n        ),\n    ]\n\n    results = []\n\n    # Get machine epsilon for floating point comparisons\n    eps = np.finfo(float).eps\n\n    for KT, f, r, a, h, b in test_cases:\n        # Step 1: Perform the two linear solves with KT\n        # This is the only place we interact with KT directly for solving\n        try:\n            w = np.linalg.solve(KT, f)\n            z = np.linalg.solve(KT, r)\n        except np.linalg.LinAlgError:\n            # This should not happen for the given test cases as all KT are invertible\n            results.extend([np.nan, np.nan])\n            continue\n        \n        # Step 2: Combine w and z to form scalars p and q\n        p = a.T @ w + h\n        q = b + a.T @ z\n\n        # Step 3: Compute delta_lambda with stabilization\n        #\n        # The algorithm requires an automatic choice of the stabilization parameter sigma,\n        # scaled to the problem data. A robust choice is to scale it relative to the\n        # size of p, which is |a^T w + h|.\n        # We use a scale based on the norm of the constituent parts.\n        \n        # Define a characteristic scale for p\n        p_scale = np.linalg.norm(a) * np.linalg.norm(w) + np.abs(h)\n        \n        # Add a tiny value to prevent scale from being zero if inputs are all zero\n        p_scale += np.finfo(float).tiny\n\n        # Set the regularization parameter and tolerance. Using sqrt(eps) is a common\n        # heuristic for balancing truncation and round-off errors.\n        sigma = np.sqrt(eps) * p_scale\n\n        if np.abs(p)  sigma:\n            # Use the Tikhonov-stabilized formula for small |p|\n            delta_lambda = (p * q) / (p**2 + sigma**2)\n        else:\n            # Use the standard formula for the well-conditioned case\n            delta_lambda = q / p\n\n        # Step 4: Compute the displacement correction delta_u\n        delta_u = w * delta_lambda - z\n\n        # Step 5: Compute the Euclidean norm of the equilibrium residual\n        # As derived, this residual should be close to zero, serving as a\n        # numerical consistency check.\n        residual_vector = KT @ delta_u - f * delta_lambda + r\n        residual_norm = np.linalg.norm(residual_vector)\n        \n        results.append(delta_lambda)\n        results.append(residual_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3544471"}, {"introduction": "理解了弧长法的数学公式和数值求解方法后，我们便能应对结构力学中一个典型且富有挑战性的问题：对称性破缺分岔。这个练习 [@problem_id:2541400] 将路径跟踪框架应用于一个表现出失稳现象的系统，要求您分析切线刚度矩阵的性质，以区分极限点和分岔点这两种不同类型的临界点。它将抽象的数值方法与结构稳定性理论的深刻概念联系起来，展示了弧长法在捕捉复杂非线性行为中的威力。", "problem": "寻求一个在路径跟踪加载下表现出对称性破缺分岔的最小二自由度非线性有限元模型。在有限元法 (FEM) 的标准平衡-残差框架内进行研究，其中平衡表示为 $R(u,\\lambda)=0$，$u \\in \\mathbb{R}^{2}$ 是节点自由度向量，$\\lambda \\in \\mathbb{R}$ 是标量载荷参数。考虑一个受到构型相关的随动载荷作用的对称二自由度系统，其残差如下：\n$$\nR(u,\\lambda) \\;=\\;\n\\begin{pmatrix}\nk\\,u_{1} + \\alpha\\,u_{1}^{3} \\\\\nk\\,u_{2} + \\alpha\\,u_{2}^{3}\n\\end{pmatrix}\n\\;-\\;\n\\lambda\\left[\n\\begin{pmatrix}\np\\\\\np\n\\end{pmatrix}\n\\;+\\;\n\\gamma\\,\n\\begin{pmatrix}\nu_{1}-u_{2}\\\\\nu_{2}-u_{1}\n\\end{pmatrix}\n\\right],\n$$\n其中 $k0$ 和 $\\alpha0$ 是材料刚度参数，$p0$ 是参考载荷幅值，$\\gamma0$ 控制依赖于相对位移 $u_{1}-u_{2}$ 的随动项的大小。假设所有量均为无量纲。\n\n从残差平衡 $R(u,\\lambda)=0$ 的基本定义及其在 Riks 和 Crisfield 意义下的弧长路径跟踪方法中使用的切线线性化出发，完成以下任务：\n\n1) 证明对称子空间 $u_{1}=u_{2}=u$ 定义了一条平衡路径，并推导该路径上 $u$ 和 $\\lambda$ 之间的标量关系。\n\n2) 推导一致切线刚度矩阵 $K_{T}(u,\\lambda)=\\partial R/\\partial u$ 并在对称路径上对其进行求值。确定对称路径上 $K_{T}$ 的对称和反对称特征模态，并用 $u$、$\\lambda$ 和参数表示它们对应的特征值。\n\n3) 陈述表征弧长路径跟踪中简单对称性破缺分岔（叉式分岔）点的线性化条件：特别地，阐述 $K_{T}$ 的奇异性条件、相关的左右零向量，以及在分岔点的增广 Riks/Crisfield 线性化中区分分岔点和极限点的条件。\n\n4) 对于特定参数值 $k=1$, $\\alpha=1$, $p=1$, and $\\gamma=1$，计算对称分支因反对称模态失稳时的临界载荷因子 $\\lambda_{\\star}$。将你的最终答案 $\\lambda_{\\star}$ 表示为一个精确的数值（无量綱）。不包含单位。无需四舍五入。", "solution": "解答按顺序处理四个指定的任务。\n\n1) 首先，我们研究由约束 $u_{1}=u_{2}=u$ 定义的对称子空间。为证明该子空间定义了一条平衡路径，我们将此约束代入残差向量表达式 $R(u,\\lambda)$。\n$$\nR \\;=\\;\n\\begin{pmatrix}\nk\\,u + \\alpha\\,u^{3} \\\\\nk\\,u + \\alpha\\,u^{3}\n\\end{pmatrix}\n\\;-\\;\n\\lambda\\left[\n\\begin{pmatrix}\np\\\\\np\n\\end{pmatrix}\n\\;+\\;\n\\gamma\\,\n\\begin{pmatrix}\nu-u\\\\\nu-u\n\\end{pmatrix}\n\\right]\n\\;=\\;\n\\begin{pmatrix}\nk\\,u + \\alpha\\,u^{3} - \\lambda p \\\\\nk\\,u + \\alpha\\,u^{3} - \\lambda p\n\\end{pmatrix}\n$$\n平衡条件 $R=0$ 要求该向量的两个分量均为零。由于两个分量相同，该条件简化为单个标量方程：\n$$\nk\\,u + \\alpha\\,u^{3} - \\lambda p = 0\n$$\n该方程给出了对称位移 $u$ 和载荷参数 $\\lambda$ 之间的一个隐式关系。我们可以将这条基本路径上的 $\\lambda$ 表示为 $u$ 的函数：\n$$\n\\lambda(u) = \\frac{k\\,u + \\alpha\\,u^{3}}{p}\n$$\n这证实了对称子空间构成了系统的一条有效平衡路径。\n\n2) 接下来，我们推导一致切线刚度矩阵 $K_{T}(u,\\lambda)$，它定义为残差向量相对于位移向量的雅可比矩阵，$K_{T} = \\frac{\\partial R}{\\partial u}$。残差的分量为：\n$R_{1}(u_{1}, u_{2}, \\lambda) = k\\,u_{1} + \\alpha\\,u_{1}^{3} - \\lambda p - \\lambda\\gamma(u_{1}-u_{2})$\n$R_{2}(u_{1}, u_{2}, \\lambda) = k\\,u_{2} + \\alpha\\,u_{2}^{3} - \\lambda p - \\lambda\\gamma(u_{2}-u_{1})$\n偏导数为：\n$\\frac{\\partial R_{1}}{\\partial u_{1}} = k + 3\\alpha u_{1}^{2} - \\lambda\\gamma$\n$\\frac{\\partial R_{1}}{\\partial u_{2}} = \\lambda\\gamma$\n$\\frac{\\partial R_{2}}{\\partial u_{1}} = \\lambda\\gamma$\n$\\frac{\\partial R_{2}}{\\partial u_{2}} = k + 3\\alpha u_{2}^{2} - \\lambda\\gamma$\n组合这些分量得到切线刚度矩阵：\n$$\nK_T(u, \\lambda) = \\begin{pmatrix}\nk + 3\\alpha u_{1}^{2} - \\lambda\\gamma  \\lambda\\gamma \\\\\n\\lambda\\gamma  k + 3\\alpha u_{2}^{2} - \\lambda\\gamma\n\\end{pmatrix}\n$$\n我们现在在对称路径 $u_{1}=u_{2}=u$ 上计算该矩阵：\n$$\nK_T|_{\\text{symm}} = \\begin{pmatrix}\nk + 3\\alpha u^{2} - \\lambda\\gamma  \\lambda\\gamma \\\\\n\\lambda\\gamma  k + 3\\alpha u^{2} - \\lambda\\gamma\n\\end{pmatrix}\n$$\n为了找到特征值和特征模态，我们求解特征方程 $\\det(K_T - \\omega I) = 0$。令 $A = k + 3\\alpha u^{2} - \\lambda\\gamma$ 和 $B = \\lambda\\gamma$。方程变为 $(A-\\omega)^{2} - B^{2} = 0$，由此得出特征值为 $\\omega = A \\pm B$。\n第一个特征值对应于对称模态：\n$\\omega_{S} = A + B = (k + 3\\alpha u^{2} - \\lambda\\gamma) + \\lambda\\gamma = k + 3\\alpha u^{2}$。\n相应的特征向量 $\\phi_{S}$ 满足 $(K_T - \\omega_{S} I) \\phi_{S} = 0$。这导致 $\\phi_{S1} - \\phi_{S2} = 0$，所以对称特征模态为 $\\phi_{S} \\propto \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n第二个特征值对应于反对称模态：\n$\\omega_{A} = A - B = (k + 3\\alpha u^{2} - \\lambda\\gamma) - \\lambda\\gamma = k + 3\\alpha u^{2} - 2\\lambda\\gamma$。\n相应的特征向量 $\\phi_{A}$ 满足 $(K_T - \\omega_{A} I) \\phi_{A} = 0$。这导致 $\\phi_{A1} + \\phi_{A2} = 0$，所以反对称特征模态为 $\\phi_{A} \\propto \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n3) 平衡路径上的临界点发生在切线刚度矩阵 $K_T$ 变为奇异时，即 $\\det(K_T)=0$。这等价于其某个特征值为零。在这样一个点 $(u_{\\star}, \\lambda_{\\star})$，存在一个非零右零向量（临界模态）$\\phi$ 使得 $K_T(u_{\\star}, \\lambda_{\\star})\\phi=0$。由于 $K_T$ 是对称的，左零向量是 $\\phi^T$。\n在弧长法的背景下，极限点和分岔点之间的区别由条件 $\\phi^T (\\partial R / \\partial \\lambda) = 0$ 确定。\n载荷导数向量为 $\\frac{\\partial R}{\\partial \\lambda} = - \\begin{pmatrix} p + \\gamma(u_{1}-u_{2}) \\\\ p + \\gamma(u_{2}-u_{1}) \\end{pmatrix}$。\n在对称路径上 ($u_{1}=u_{2}=u$)，这简化为 $\\frac{\\partial R}{\\partial \\lambda} = -\\begin{pmatrix} p \\\\ p \\end{pmatrix}$。\n如果对称模态是临界的（$\\omega_S=0$, $\\phi = \\phi_S$），条件为：\n$\\phi_S^T \\frac{\\partial R}{\\partial \\lambda} = \\begin{pmatrix} 1  1 \\end{pmatrix} \\left(-\\begin{pmatrix} p \\\\ p \\end{pmatrix}\\right) = -2p$。由于 $p0$，此值非零。对称模态的奇异性对应于**极限点**。\n如果反对称模态是临界的（$\\omega_A=0$, $\\phi = \\phi_A$），条件为：\n$\\phi_A^T \\frac{\\partial R}{\\partial \\lambda} = \\begin{pmatrix} 1  -1 \\end{pmatrix} \\left(-\\begin{pmatrix} p \\\\ p \\end{pmatrix}\\right) = -p - (-p) = 0$。\n这个零结果是**分岔点**的条件。因此，当主路径因反对称模态失稳时，发生对称性破缺分岔（叉式类型），这发生在 $\\omega_A=0$ 时。\n\n4) 最后，我们为参数值 $k=1$, $\\alpha=1$, $p=1$ 和 $\\gamma=1$ 计算临界载荷因子 $\\lambda_{\\star}$。对称性破缺分岔发生在点 $(u_{\\star}, \\lambda_{\\star})$，该点同时满足对称平衡路径方程和反对称模态的奇异性条件。\n两个控制方程是：\n1. 平衡：$k u_{\\star} + \\alpha u_{\\star}^{3} - \\lambda_{\\star} p = 0$\n2. 奇异性：$\\omega_{A} = k + 3\\alpha u_{\\star}^{2} - 2\\lambda_{\\star}\\gamma = 0$\n代入给定的参数值：\n1. $u_{\\star} + u_{\\star}^{3} - \\lambda_{\\star} = 0 \\implies \\lambda_{\\star} = u_{\\star} + u_{\\star}^{3}$\n2. $1 + 3u_{\\star}^{2} - 2\\lambda_{\\star} = 0$\n将第一个方程代入第二个方程：\n$1 + 3u_{\\star}^{2} - 2(u_{\\star} + u_{\\star}^{3}) = 0$\n$1 + 3u_{\\star}^{2} - 2u_{\\star} - 2u_{\\star}^{3} = 0$\n重新整理得到关于 $u_{\\star}$ 的三次多项式：\n$2u_{\\star}^{3} - 3u_{\\star}^{2} + 2u_{\\star} - 1 = 0$\n通过观察，我们测试简单的有理根。对于 $u_{\\star}=1$：\n$2(1)^{3} - 3(1)^{2} + 2(1) - 1 = 2 - 3 + 2 - 1 = 0$。\n因此，$u_{\\star}=1$ 是一个实根。因式分解该多项式得到 $(u_{\\star}-1)(2u_{\\star}^{2} - u_{\\star} + 1) = 0$。二次因子 $2u_{\\star}^{2} - u_{\\star} + 1$ 的判别式为 $\\Delta = (-1)^{2} - 4(2)(1) = -7  0$，所以它没有其他实根。唯一具有物理意义的临界位移是 $u_{\\star}=1$。\n将此值代回 $\\lambda_{\\star}$ 的表达式中：\n$\\lambda_{\\star} = u_{\\star} + u_{\\star}^{3} = 1 + (1)^{3} = 2$。\n对称分支因反对称模态失稳时的临界载荷因子是 $\\lambda_{\\star}=2$。", "answer": "$$\\boxed{2}$$", "id": "2541400"}]}