{"hands_on_practices": [{"introduction": "在将非协调模式或增强位移场应用于有限元分析之前，我们必须首先理解它们必须遵循的基本数学准则。本练习 [@problem_id:3573667] 将引导您通过严格的数学推导，证明一个有效的非协调模式必须满足的两个核心要求：在单元边界上为零以保证单元间的位移连续性，以及与刚体运动模式正交以避免引入伪能量。掌握这些基本原理是设计稳定可靠的增强单元的理论基石。", "problem": "考虑在小应变线性弹性分析的有限元法 (FEM) 中，一个 $4$ 节点等参双线性四边形单元 ($Q4$)。为增强单元的弯曲性能，同时保持与虚功原理的一致性，在标准的双线性位移插值中增加了一个内部的（单元级的）非协调位移场。为防止与刚体运动产生伪耦合，并避免单元间的不协调性，该增强位移场必须在整个单元边界上为零，并且在参考单元上与所有刚体运动 $L^{2}$ 正交。\n\n设参考域为 $\\Omega = [-1,1] \\times [-1,1]$，局部坐标为 $(\\xi,\\eta)$。使用多项式项定义矢量值的增强位移模式（非协调模式），这些项反映了 $\\xi(1-\\eta^{2})$ 和 $\\eta(1-\\xi^{2})$ 的结构，但为确保在 $\\partial\\Omega$ 上为零，还进一步乘以单元边界泡状函数：\n$$\n\\widetilde{\\mathbf{u}}(\\xi,\\eta) \\;=\\; c\n\\begin{pmatrix}\n\\xi\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\\\\n\\eta\\,(1-\\xi^{2})\\,(1-\\eta^{2})\n\\end{pmatrix},\n$$\n其中 $c>0$ 是一个待定的标量归一化常数。\n\n使用在 $\\Omega$ 上定义的 $L^{2}$ 内积\n$$\n\\langle \\mathbf{a},\\mathbf{b}\\rangle \\;=\\; \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{a}(\\xi,\\eta)\\cdot\\mathbf{b}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta.\n$$\n设 $\\Omega$ 上的刚体运动由常数平移 $\\mathbf{t}_{x} = (1,0)^{\\mathsf{T}}$、$\\mathbf{t}_{y} = (0,1)^{\\mathsf{T}}$ 和绕原点的平面内旋转 $\\mathbf{r}(\\xi,\\eta) = (-\\eta,\\xi)^{\\mathsf{T}}$ 表示。\n\n仅从这些定义以及非协调模式在刚体运动下不产生伪能量的要求出发，完成以下任务：\n\n$1.$ 证明 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 在整个边界 $\\partial\\Omega$ 上为零。\n\n$2.$ 证明正交性条件\n$$\n\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle \\;=\\; \\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle \\;=\\; \\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle \\;=\\; 0\n$$\n成立。\n\n$3.$ 确定唯一的正常数 $c$，使得增强模式具有单位 $L^{2}$ 范数，\n$$\n\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)} \\;=\\; \\left(\\int_{-1}^{1}\\int_{-1}^{1} \\|\\widetilde{\\mathbf{u}}(\\xi,\\eta)\\|^{2}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\\right)^{1/2} \\;=\\; 1.\n$$\n\n你的最终答案必须是 $c$ 的精确闭式表达式（无单位，不四舍五入）。", "solution": "在提供解答之前，需对问题进行验证。\n\n### 第1步：提取已知条件\n-   单元类型：用于小应变线性弹性分析的 $4$ 节点等参双线性四边形单元 ($Q4$)。\n-   参考域：$\\Omega = [-1,1] \\times [-1,1]$，局部坐标为 $(\\xi,\\eta)$。\n-   非协调位移模式：$\\widetilde{\\mathbf{u}}(\\xi,\\eta) \\;=\\; c \\begin{pmatrix} \\xi\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\\\ \\eta\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\end{pmatrix}$，其中标量归一化常数 $c>0$。\n-   $L^{2}$ 内积：$\\langle \\mathbf{a},\\mathbf{b}\\rangle \\;=\\; \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{a}(\\xi,\\eta)\\cdot\\mathbf{b}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。\n-   刚体运动：\n    -   $x$ 方向平移：$\\mathbf{t}_{x} = (1,0)^{\\mathsf{T}}$\n    -   $y$ 方向平移：$\\mathbf{t}_{y} = (0,1)^{\\mathsf{T}}$\n    -   平面内旋转：$\\mathbf{r}(\\xi,\\eta) = (-\\eta,\\xi)^{\\mathsf{T}}$\n-   任务：\n    1.  证明 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 在整个边界 $\\partial\\Omega$ 上为零。\n    2.  证明正交性条件 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle \\;=\\; 0$、$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle \\;=\\; 0$ 和 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle \\;=\\; 0$ 成立。\n    3.  确定唯一的正常数 $c$，使得 $\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)} \\;=\\; 1$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题在计算固体力学领域，特别是在有限元法方面，具有坚实的科学基础。非协调模式（或增强假定应变）的概念及其所需性质（在边界上为零、与刚体运动正交）是开发能够避免闭锁现象的稳健有限元的公认原则。该问题是适定的，提供了所有必要的数学定义。语言客观而精确。该问题是自洽的、一致的，并且需要一组明确的数学证明和一次计算，所有这些都是可验证的。未发现任何缺陷。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n***\n\n### 解答\n\n该问题要求证明给定的非协调位移模式 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 的某些性质，并计算其归一化常数 $c$。各项任务按指定顺序进行处理。\n\n**1. 证明在边界上为零**\n\n非协调位移场由下式给出：\n$$\n\\widetilde{\\mathbf{u}}(\\xi,\\eta) = c\n\\begin{pmatrix}\n\\xi\\,(1-\\xi^{2})\\,(1-\\eta^{2}) \\\\\n\\eta\\,(1-\\xi^{2})\\,(1-\\eta^{2})\n\\end{pmatrix}\n$$\n参考域是正方形 $\\Omega = [-1,1] \\times [-1,1]$。其边界 $\\partial\\Omega$ 由四条边组成：\n-   当 $\\eta \\in [-1,1]$ 时，直线 $\\xi = 1$。\n-   当 $\\eta \\in [-1,1]$ 时，直线 $\\xi = -1$。\n-   当 $\\xi \\in [-1,1]$ 时，直线 $\\eta = 1$。\n-   当 $\\xi \\in [-1,1]$ 时，直线 $\\eta = -1$。\n\n任何点 $(\\xi,\\eta) \\in \\partial\\Omega$ 都必须满足 $|\\xi| = 1$ 或 $|\\eta| = 1$。\n\n让我们检查 $\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 两个分量中的公因式 $(1-\\xi^{2})(1-\\eta^{2})$。\n-   如果一个点位于 $|\\xi|=1$ 的边界上，则项 $(1-\\xi^{2})$ 变为 $(1 - (\\pm 1)^{2}) = 1-1=0$。这使得整个乘积 $(1-\\xi^{2})(1-\\eta^{2})$ 等于 $0$。\n-   如果一个点位于 $|\\eta|=1$ 的边界上，则项 $(1-\\eta^{2})$ 变为 $(1 - (\\pm 1)^{2}) = 1-1=0$。这也使得整个乘积 $(1-\\xi^{2})(1-\\eta^{2})$ 等于 $0$。\n\n由于对于 $\\partial\\Omega$ 上的任何点，这些条件中至少有一个成立，因此对于所有 $(\\xi,\\eta) \\in \\partial\\Omega$，因式 $(1-\\xi^{2})(1-\\eta^{2})$ 恒等于零。因此，$\\widetilde{\\mathbf{u}}(\\xi,\\eta)$ 的两个分量在边界上都为零。\n$$\n\\widetilde{\\mathbf{u}}(\\xi,\\eta) = \\mathbf{0} \\quad \\forall (\\xi,\\eta) \\in \\partial\\Omega\n$$\n证明完毕。\n\n**2. 证明与刚体运动的正交性**\n\n我们必须证明 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = 0$、$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle = 0$ 和 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle = 0$。\n\n-   **与 $\\mathbf{t}_{x}$ 的正交性：**\n    内积为 $\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = \\int_{-1}^{1}\\int_{-1}^{1} \\widetilde{\\mathbf{u}}(\\xi,\\eta) \\cdot \\mathbf{t}_{x} \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。点积为：\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{t}_{x} = c \\begin{pmatrix} \\xi(1-\\xi^2)(1-\\eta^2) \\\\ \\eta(1-\\xi^2)(1-\\eta^2) \\end{pmatrix} \\cdot \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = c \\xi(1-\\xi^2)(1-\\eta^2)\n    $$\n    积分为：\n    $$\n    \\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = c \\int_{-1}^{1}\\int_{-1}^{1} \\xi(1-\\xi^2)(1-\\eta^2) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = c \\left( \\int_{-1}^{1} \\xi(1-\\xi^2)\\,\\mathrm{d}\\xi \\right) \\left( \\int_{-1}^{1} (1-\\eta^2)\\,\\mathrm{d}\\eta \\right)\n    $$\n    第一个积分的被积函数 $f(\\xi) = \\xi - \\xi^3$ 是一个奇函数，因为 $f(-\\xi) = (-\\xi) - (-\\xi)^3 = -\\xi + \\xi^3 = -f(\\xi)$。奇函数在对称区间 $[-1,1]$ 上的积分为零。\n    $$\n    \\int_{-1}^{1} \\xi(1-\\xi^2)\\,\\mathrm{d}\\xi = 0\n    $$\n    因此，$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{x}\\rangle = c \\cdot 0 \\cdot \\left( \\int_{-1}^{1} (1-\\eta^2)\\,\\mathrm{d}\\eta \\right) = 0$。\n\n-   **与 $\\mathbf{t}_{y}$ 的正交性：**\n    类似地，点积为：\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{t}_{y} = c \\begin{pmatrix} \\xi(1-\\xi^2)(1-\\eta^2) \\\\ \\eta(1-\\xi^2)(1-\\eta^2) \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = c \\eta(1-\\xi^2)(1-\\eta^2)\n    $$\n    积分为：\n    $$\n    \\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle = c \\int_{-1}^{1}\\int_{-1}^{1} \\eta(1-\\xi^2)(1-\\eta^2) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = c \\left( \\int_{-1}^{1} (1-\\xi^2)\\,\\mathrm{d}\\xi \\right) \\left( \\int_{-1}^{1} \\eta(1-\\eta^2)\\,\\mathrm{d}\\eta \\right)\n    $$\n    第二个积分的被积函数 $g(\\eta) = \\eta - \\eta^3$ 是一个奇函数。因此，其在 $[-1,1]$ 上的积分为零。\n    $$\n    \\int_{-1}^{1} \\eta(1-\\eta^2)\\,\\mathrm{d}\\eta = 0\n    $$\n    因此，$\\langle \\widetilde{\\mathbf{u}},\\mathbf{t}_{y}\\rangle = 0$。\n\n-   **与 $\\mathbf{r}$ 的正交性：**\n    与旋转模式 $\\mathbf{r}(\\xi,\\eta) = (-\\eta, \\xi)^{\\mathsf{T}}$ 的点积为：\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{r} = c \\begin{pmatrix} \\xi(1-\\xi^2)(1-\\eta^2) \\\\ \\eta(1-\\xi^2)(1-\\eta^2) \\end{pmatrix} \\cdot \\begin{pmatrix} -\\eta \\\\ \\xi \\end{pmatrix}\n    $$\n    $$\n    \\widetilde{\\mathbf{u}} \\cdot \\mathbf{r} = c \\left( -\\eta\\xi(1-\\xi^2)(1-\\eta^2) + \\xi\\eta(1-\\xi^2)(1-\\eta^2) \\right) = 0\n    $$\n    由于被积函数在域 $\\Omega$ 内处处恒为零，因此积分为零。\n    $$\n    \\langle \\widetilde{\\mathbf{u}},\\mathbf{r}\\rangle = \\int_{-1}^{1}\\int_{-1}^{1} 0 \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = 0\n    $$\n    正交性证明完毕。\n\n**3. 确定归一化常数 $c$**\n\n归一化条件为 $\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)} = 1$，这等价于 $\\|\\widetilde{\\mathbf{u}}\\|_{L^{2}(\\Omega)}^{2} = 1$。\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} \\|\\widetilde{\\mathbf{u}}(\\xi,\\eta)\\|^{2}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = 1\n$$\n首先，计算向量 $\\widetilde{\\mathbf{u}}$ 的欧几里得范数的平方：\n$$\n\\|\\widetilde{\\mathbf{u}}\\|^{2} = \\left(c\\xi(1-\\xi^2)(1-\\eta^2)\\right)^2 + \\left(c\\eta(1-\\xi^2)(1-\\eta^2)\\right)^2\n$$\n$$\n\\|\\widetilde{\\mathbf{u}}\\|^{2} = c^2\\xi^2(1-\\xi^2)^2(1-\\eta^2)^2 + c^2\\eta^2(1-\\xi^2)^2(1-\\eta^2)^2\n$$\n$$\n\\|\\widetilde{\\mathbf{u}}\\|^{2} = c^2(\\xi^2 + \\eta^2)(1-\\xi^2)^2(1-\\eta^2)^2\n$$\n现在，我们将此表达式在域 $\\Omega$ 上积分：\n$$\n1 = c^2 \\int_{-1}^{1}\\int_{-1}^{1} (\\xi^2 + \\eta^2)(1-\\xi^2)^2(1-\\eta^2)^2 \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n$$\n我们可以将积分分成两部分：\n$$\n\\frac{1}{c^2} = \\int_{-1}^{1}\\int_{-1}^{1} \\xi^2(1-\\xi^2)^2(1-\\eta^2)^2\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta + \\int_{-1}^{1}\\int_{-1}^{1} \\eta^2(1-\\xi^2)^2(1-\\eta^2)^2\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\n$$\n这两个积分可以分离为一维积分的乘积：\n$$\n\\frac{1}{c^2} = \\left( \\int_{-1}^{1} \\xi^2(1-\\xi^2)^2\\,\\mathrm{d}\\xi \\right)\\left( \\int_{-1}^{1} (1-\\eta^2)^2\\,\\mathrm{d}\\eta \\right) + \\left( \\int_{-1}^{1} (1-\\xi^2)^2\\,\\mathrm{d}\\xi \\right)\\left( \\int_{-1}^{1} \\eta^2(1-\\eta^2)^2\\,\\mathrm{d}\\eta \\right)\n$$\n让我们定义两个辅助积分，注意被积函数是偶函数：\n$$\nJ_1 = \\int_{-1}^{1} (1-x^2)^2\\,\\mathrm{d}x = \\int_{-1}^{1} (1 - 2x^2 + x^4)\\,\\mathrm{d}x = 2 \\left[ x - \\frac{2}{3}x^3 + \\frac{1}{5}x^5 \\right]_0^1 = 2\\left(1 - \\frac{2}{3} + \\frac{1}{5}\\right) = 2\\left(\\frac{15-10+3}{15}\\right) = \\frac{16}{15}\n$$\n$$\nJ_2 = \\int_{-1}^{1} x^2(1-x^2)^2\\,\\mathrm{d}x = \\int_{-1}^{1} (x^2 - 2x^4 + x^6)\\,\\mathrm{d}x = 2 \\left[ \\frac{1}{3}x^3 - \\frac{2}{5}x^5 + \\frac{1}{7}x^7 \\right]_0^1 = 2\\left(\\frac{1}{3} - \\frac{2}{5} + \\frac{1}{7}\\right) = 2\\left(\\frac{35-42+15}{105}\\right) = \\frac{16}{105}\n$$\n将这些结果代回关于 $c$ 的方程中：\n$$\n\\frac{1}{c^2} = (J_2)(J_1) + (J_1)(J_2) = 2 J_1 J_2\n$$\n$$\n\\frac{1}{c^2} = 2 \\left( \\frac{16}{15} \\right) \\left( \\frac{16}{105} \\right) = \\frac{2 \\cdot 256}{15 \\cdot 105} = \\frac{512}{1575}\n$$\n解出 $c^2$：\n$$\nc^2 = \\frac{1575}{512}\n$$\n由于问题指定 $c>0$，我们取正平方根：\n$$\nc = \\sqrt{\\frac{1575}{512}}\n$$\n为简化表达式，我们求其质因数：\n$1575 = 3^2 \\cdot 5^2 \\cdot 7 = 225 \\cdot 7$\n$512 = 2^9 = 256 \\cdot 2$\n$$\nc = \\sqrt{\\frac{225 \\cdot 7}{256 \\cdot 2}} = \\frac{\\sqrt{225}\\sqrt{7}}{\\sqrt{256}\\sqrt{2}} = \\frac{15\\sqrt{7}}{16\\sqrt{2}}\n$$\n分母有理化：\n$$\nc = \\frac{15\\sqrt{7}}{16\\sqrt{2}} \\cdot \\frac{\\sqrt{2}}{\\sqrt{2}} = \\frac{15\\sqrt{14}}{16 \\cdot 2} = \\frac{15\\sqrt{14}}{32}\n$$\n这就是归一化常数 $c$ 的最终表达式。", "answer": "$$\\boxed{\\frac{15\\sqrt{14}}{32}}$$", "id": "3573667"}, {"introduction": "任何有限元公式的一个关键考验是“单元检验”（patch test），它验证了单元在常应变状态下精确再现该应变场的能力。本编程练习 [@problem_id:3573570] 将理论付诸实践，通过数值方法展示了正确设计的增强位移模式如何顺利通过单元检验，此时增强自由度对结果无贡献。此外，本练习还通过一个“欠积分”的反例，揭示了不正确的数值实现如何导致检验失败，从而强调了理论与实现并重的重要性。", "problem": "考虑一个二维小应变、线弹性、平面应变四边形单元，其占据物理域 $\\Omega = [0,1]\\times[0,1]$，节点按逆时针顺序位于 $(0,0)$、$(1,0)$、$(1,1)$ 和 $(0,1)$。协调位移场由标准的双线性形函数近似，因此 $\\mathbf{u}_c(x,y) = \\sum_{i=1}^4 N_i(x,y)\\,\\mathbf{d}_i$，其中 $\\mathbf{d}_i \\in \\mathbb{R}^2$ 是节点位移，双线性形函数为\n- $N_1(x,y) = (1-x)(1-y)$,\n- $N_2(x,y) = x(1-y)$,\n- $N_3(x,y) = xy$,\n- $N_4(x,y) = (1-x)y$.\n\n增强位移场通过与一个在 $\\partial\\Omega$ 上为零的气泡函数 $\\phi_b(x,y)$ 相关联的两个内部（单元级）自由度来扩充协调场，即\n- $\\mathbf{u}_{e,1}(x,y) = \\begin{bmatrix}\\phi_b(x,y) \\\\ 0\\end{bmatrix}$,\n- $\\mathbf{u}_{e,2}(x,y) = \\begin{bmatrix}0 \\\\ \\phi_b(x,y)\\end{bmatrix}$,\n其中\n$$\n\\phi_b(x,y) = x(1-x)\\,y(1-y)\\,(x - c), \\quad c = 0.3.\n$$\n总位移场为 $\\mathbf{u}(x,y) = \\mathbf{u}_c(x,y) + \\mathbf{u}_e(x,y)$，其中 $\\mathbf{u}_e(x,y) = \\sum_{\\alpha=1}^{2} \\mathbf{h}_\\alpha(x,y)\\,a_\\alpha$，$\\mathbf{h}_1=\\mathbf{u}_{e,1}$，$\\mathbf{h}_2=\\mathbf{u}_{e,2}$，且 $a_\\alpha \\in \\mathbb{R}$ 为增强参数。\n\n使用小应变张量 $\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\tfrac{1}{2}\\left(\\nabla\\mathbf{u} + \\nabla\\mathbf{u}^\\mathsf{T}\\right)$ 和 Voigt 向量 $\\boldsymbol{\\varepsilon}_v = [\\varepsilon_{xx},\\,\\varepsilon_{yy},\\,\\gamma_{xy}]^\\mathsf{T}$，其中工程剪切应变为 $\\gamma_{xy} = 2\\varepsilon_{xy}$。对于平面应变，本构矩阵 $\\mathbf{C}\\in\\mathbb{R}^{3\\times 3}$ 为\n$$\n\\mathbf{C} = \\begin{bmatrix}\n\\lambda + 2\\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2\\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix}, \\quad\n\\mu = \\dfrac{E}{2(1+\\nu)}, \\quad \\lambda = \\dfrac{E\\nu}{(1+\\nu)(1-2\\nu)},\n$$\n其中 $E$ 是杨氏模量，$\\nu$ 是泊松比。\n\n从虚功原理和单元应变能的定义出发，\n$$\n\\Pi(\\mathbf{d},\\mathbf{a}) = \\tfrac{1}{2}\\int_{\\Omega} \\boldsymbol{\\varepsilon}_v(\\mathbf{u}_c + \\mathbf{u}_e)^\\mathsf{T}\\,\\mathbf{C}\\,\\boldsymbol{\\varepsilon}_v(\\mathbf{u}_c + \\mathbf{u}_e)\\, \\mathrm{d}\\Omega,\n$$\n证明相对于增强参数 $\\mathbf{a}$ 的驻定性可得到一个形如下式的线性系统\n$$\n\\mathbf{K}_{aa}\\,\\mathbf{a} + \\mathbf{K}_{ad}\\,\\mathbf{d} = \\mathbf{0},\n$$\n其分块矩阵为\n$$\n\\mathbf{K}_{dd} = \\int_{\\Omega} \\mathbf{B}_c^\\mathsf{T}\\mathbf{C}\\mathbf{B}_c\\,\\mathrm{d}\\Omega,\\quad\n\\mathbf{K}_{da} = \\int_{\\Omega} \\mathbf{B}_c^\\mathsf{T}\\mathbf{C}\\mathbf{B}_e\\,\\mathrm{d}\\Omega,\\quad\n\\mathbf{K}_{aa} = \\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T}\\mathbf{C}\\mathbf{B}_e\\,\\mathrm{d}\\Omega,\n$$\n且 $\\mathbf{K}_{ad}=\\mathbf{K}_{da}^\\mathsf{T}$。此处，$\\mathbf{B}_c$ 和 $\\mathbf{B}_e$ 分别是与 $\\mathbf{u}_c$ 和 $\\mathbf{u}_e$ 相关的协调和增强应变-位移矩阵。\n\n对于一个给定的均匀应变状态 $\\boldsymbol{\\varepsilon}_0 = [\\varepsilon_{xx}^{(0)},\\,\\varepsilon_{yy}^{(0)},\\,\\gamma_{xy}^{(0)}]^\\mathsf{T}$，精确位移场是线性的，\n$$\n\\mathbf{u}_0(x,y) = \\begin{bmatrix} \\varepsilon_{xx}^{(0)}\\,x + \\tfrac{1}{2}\\gamma_{xy}^{(0)}\\,y \\\\ \\tfrac{1}{2}\\gamma_{xy}^{(0)}\\,x + \\varepsilon_{yy}^{(0)}\\,y \\end{bmatrix},\n$$\n节点值 $\\mathbf{d}$ 可通过在四个节点上计算 $\\mathbf{u}_0$ 得到。在精确积分下，证明缩聚的增强参数\n$$\n\\mathbf{a}^\\star = -\\mathbf{K}_{aa}^{-1}\\,\\mathbf{K}_{ad}\\,\\mathbf{d}\n$$\n对于任何均匀应变状态都必须为 $\\mathbf{0}$，这是由于 $\\phi_b$ 的边界值为零以及对 $\\int_{\\Omega}\\nabla \\phi_b\\,\\mathrm{d}\\Omega$ 应用散度定理的结果。\n\n您的任务是实现一个程序，该程序：\n- 使用在 $\\Omega$ 上的张量积 Gauss–Legendre 求积法，并采用足够高的阶数（为确保精确性，所有分块矩阵每方向使用 $n=5$ 个点）来为所选的气泡函数实现精确积分，从而组装 $\\mathbf{K}_{dd}$、$\\mathbf{K}_{da}$ 和 $\\mathbf{K}_{aa}$。\n- 使用精确的线性位移场从 $\\boldsymbol{\\varepsilon}_0$ 构建 $\\mathbf{d}$。\n- 计算 $\\mathbf{a}^\\star = -\\mathbf{K}_{aa}^{-1}\\mathbf{K}_{ad}\\mathbf{d}$，并以容差 $\\tau = 10^{-12}$ 检查是否满足 $\\|\\mathbf{a}^\\star\\|_2 \\le \\tau$。\n- 作为最后的边缘情况测试，仅对 $\\mathbf{K}_{da}$ 使用位于单元中心的一个高斯点（即在 $[0,1]$ 上每方向 $n=1$）进行刻意地欠积分，同时保持 $\\mathbf{K}_{aa}$ 精确，并验证对于一般的均匀应变状态，得到的 $\\mathbf{a}^\\star$ 未通过零值检验。\n\n使用以下测试套件，其中每个元组列出了 $(E,\\nu,\\varepsilon_{xx}^{(0)},\\varepsilon_{yy}^{(0)},\\gamma_{xy}^{(0)},\\text{integration\\_mode})$，而 $\\text{integration\\_mode}\\in\\{\\text{exact},\\text{under}\\}$ 指定了 $\\mathbf{K}_{da}$ 是使用精确积分还是欠积分：\n- 测试 1：$(200.0,\\,0.3,\\,0.01,\\,0.0,\\,0.0,\\,\\text{exact})$。\n- 测试 2：$(150.0,\\,0.0,\\,0.0,\\,0.02,\\,0.0,\\,\\text{exact})$。\n- 测试 3：$(210.0,\\,0.49,\\,0.0,\\,0.0,\\,0.03,\\,\\text{exact})$。\n- 测试 4：$(123.4,\\,0.27,\\,0.005,\\,-0.002,\\,0.01,\\,\\text{exact})$。\n- 测试 5：$(123.4,\\,0.27,\\,0.005,\\,-0.002,\\,0.01,\\,\\text{under})$。\n\n所有量均为无量纲。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$），其中每个 $\\text{result}_i$ 是一个布尔值，如果 $\\|\\mathbf{a}^\\star\\|_2 \\le \\tau$ 则为 $\\text{True}$，否则为 $\\text{False}$。", "solution": "该问题陈述经评估是有效的。它在科学上基于计算固体力学的原理，特别是增强应变有限元理论。该问题是适定的，包含了所有必要的定义、常数和边界条件，可以得出一个唯一的、可验证的解。语言客观而精确。\n\n问题的核心是验证采用不协调模式（增强应变）公式的四边形单元的斑块检验。斑块检验是有限元公式的一个基本一致性检查，它要求在恒定应变状态下，单元必须能精确地再现该应变场，而无寄生效应。在增强应变方法的背景下，这要求对于任何给定的均匀应变状态，增强参数 $\\mathbf{a}$ 都必须为零。\n\n### 1. 单元公式\n\n总位移场 $\\mathbf{u}$ 被加法分解为一个协调部分 $\\mathbf{u}_c$ 和一个增强（或不协调）部分 $\\mathbf{u}_e$：\n$$\n\\mathbf{u}(x,y) = \\mathbf{u}_c(x,y) + \\mathbf{u}_e(x,y)\n$$\n协调部分确保了单元间的连续性，并由标准的双线性形函数 $N_i$ 和节点位移 $\\mathbf{d}_i \\in \\mathbb{R}^2$ 定义：\n$$\n\\mathbf{u}_c(x,y) = \\sum_{i=1}^4 N_i(x,y) \\mathbf{d}_i\n$$\n节点位移向量为 $\\mathbf{d} = [d_{1x}, d_{1y}, d_{2x}, d_{2y}, d_{3x}, d_{3y}, d_{4x}, d_{4y}]^\\mathsf{T} \\in \\mathbb{R}^8$。\n\n增强部分 $\\mathbf{u}_e$ 在单元内部定义，并在单元边界 $\\partial \\Omega$ 上为零。它由一个气泡函数 $\\phi_b(x,y)$ 和一组内部参数 $\\mathbf{a} = [a_1, a_2]^\\mathsf{T}$ 构成。\n$$\n\\mathbf{u}_e(x,y) = \\sum_{\\alpha=1}^{2} \\mathbf{h}_\\alpha(x,y) a_\\alpha\n= a_1 \\begin{bmatrix}\\phi_b(x,y) \\\\ 0\\end{bmatrix} + a_2 \\begin{bmatrix}0 \\\\ \\phi_b(x,y)\\end{bmatrix}\n$$\n其中 $\\phi_b(x,y) = x(1-x)y(1-y)(x-c)$，且 $c=0.3$。因子 $x(1-x)y(1-y)$ 确保了 $\\phi_b$ 在单位正方形 $\\Omega = [0,1]\\times[0,1]$ 的边界上为零。\n\n### 2. 应变-位移和本构关系\n\n用 Voigt 记法表示的小应变张量 $\\boldsymbol{\\varepsilon}_v = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^\\mathsf{T}$ 由 $\\boldsymbol{\\varepsilon}_v(\\mathbf{u}) = \\mathbf{L} \\mathbf{u}$ 给出，其中 $\\mathbf{L}$ 是微分算子矩阵：\n$$\n\\mathbf{L} = \\begin{bmatrix} \\partial/\\partial x  0 \\\\ 0  \\partial/\\partial y \\\\ \\partial/\\partial y  \\partial/\\partial x \\end{bmatrix}\n$$\n总应变也被分解为：$\\boldsymbol{\\varepsilon}_v = \\boldsymbol{\\varepsilon}_c + \\boldsymbol{\\varepsilon}_e$。\n协调应变为 $\\boldsymbol{\\varepsilon}_c = \\mathbf{L} \\mathbf{u}_c = \\mathbf{L} \\sum_{i=1}^4 N_i \\mathbf{I} \\mathbf{d}_i = (\\sum_{i=1}^4 (\\mathbf{L} N_i \\mathbf{I}) \\mathbf{d}_i)$。这定义了协调应变-位移矩阵 $\\mathbf{B}_c$，它是一个 $3 \\times 8$ 的矩阵，使得 $\\boldsymbol{\\varepsilon}_c = \\mathbf{B}_c \\mathbf{d}$。$\\mathbf{B}_c$ 中对应于节点 $i$ 的列为：\n$$\n\\mathbf{B}_{c,i} = \\begin{bmatrix} \\partial N_i/\\partial x  0 \\\\ 0  \\partial N_i/\\partial y \\\\ \\partial N_i/\\partial y  \\partial N_i/\\partial x \\end{bmatrix}\n$$\n增强应变为 $\\boldsymbol{\\varepsilon}_e = \\mathbf{L} \\mathbf{u}_e = \\mathbf{L} \\sum_{\\alpha=1}^2 \\mathbf{h}_\\alpha a_\\alpha$。这定义了增强应变-位移矩阵 $\\mathbf{B}_e$，它是一个 $3 \\times 2$ 的矩阵，使得 $\\boldsymbol{\\varepsilon}_e = \\mathbf{B}_e \\mathbf{a}$。其列为：\n$$\n\\text{col}_1(\\mathbf{B}_e) = \\mathbf{L} \\begin{bmatrix} \\phi_b \\\\ 0 \\end{bmatrix} = \\begin{bmatrix} \\partial\\phi_b/\\partial x \\\\ 0 \\\\ \\partial\\phi_b/\\partial y \\end{bmatrix}, \\quad\n\\text{col}_2(\\mathbf{B}_e) = \\mathbf{L} \\begin{bmatrix} 0 \\\\ \\phi_b \\end{bmatrix} = \\begin{bmatrix} 0 \\\\ \\partial\\phi_b/\\partial y \\\\ \\partial\\phi_b/\\partial x \\end{bmatrix}\n$$\n所以，\n$$\n\\mathbf{B}_e(x,y) = \\begin{bmatrix}\n\\partial\\phi_b/\\partial x  0 \\\\\n0  \\partial\\phi_b/\\partial y \\\\\n\\partial\\phi_b/\\partial y  \\partial\\phi_b/\\partial x\n\\end{bmatrix}\n$$\n应力和应变通过平面应变本构矩阵 $\\mathbf{C}$ 相关联。\n\n### 3. 驻定性与斑块检验\n\n单元应变能为 $\\Pi = \\frac{1}{2} \\int_\\Omega \\boldsymbol{\\varepsilon}_v^\\mathsf{T} \\mathbf{C} \\boldsymbol{\\varepsilon}_v \\, \\mathrm{d}\\Omega$。代入应变分解：\n$$\n\\Pi(\\mathbf{d}, \\mathbf{a}) = \\tfrac{1}{2}\\int_{\\Omega} (\\mathbf{B}_c\\mathbf{d} + \\mathbf{B}_e\\mathbf{a})^\\mathsf{T}\\,\\mathbf{C}\\,(\\mathbf{B}_c\\mathbf{d} + \\mathbf{B}_e\\mathbf{a})\\, \\mathrm{d}\\Omega\n$$\nHu-Washizu 原理（或本例中的简化版本）要求从增强应变部分导出的应力场与协调应变场正交。一个更直接的方法是强制泛函相对于内部参数 $\\mathbf{a}$（这些参数不与其他单元连接）的驻定性。这引出了一个单元级的静力缩聚过程。\n$$\n\\dfrac{\\partial \\Pi}{\\partial \\mathbf{a}} = \\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\mathbf{C} (\\mathbf{B}_c\\mathbf{d} + \\mathbf{B}_e\\mathbf{a}) \\, \\mathrm{d}\\Omega = \\mathbf{0}\n$$\n整理各项，我们得到问题中给出的系统：\n$$\n\\left(\\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\mathbf{C} \\mathbf{B}_e \\, \\mathrm{d}\\Omega\\right) \\mathbf{a} + \\left(\\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\mathbf{C} \\mathbf{B}_c \\, \\mathrm{d}\\Omega\\right) \\mathbf{d} = \\mathbf{0}\n$$\n这对应于 $\\mathbf{K}_{aa} \\mathbf{a} + \\mathbf{K}_{da}^\\mathsf{T} \\mathbf{d} = \\mathbf{0}$，或 $\\mathbf{K}_{aa} \\mathbf{a} + \\mathbf{K}_{ad} \\mathbf{d} = \\mathbf{0}$。缩聚后的参数则为 $\\mathbf{a}^\\star = -\\mathbf{K}_{aa}^{-1} \\mathbf{K}_{ad} \\mathbf{d}$。\n\n对于斑块检验，我们给定一个均匀应变场 $\\boldsymbol{\\varepsilon}_0$。节点位移 $\\mathbf{d}$ 通过在节点处计算相应的线性位移场 $\\mathbf{u}_0(x,y)$ 来设定。因为标准的双线性单元是一次完备的，协调位移场可以精确地再现这个线性场，即 $\\mathbf{u}_c(x,y) = \\mathbf{u}_0(x,y)$。因此，协调应变场是恒定的，等于目标应变：$\\boldsymbol{\\varepsilon}_c(x,y) = \\mathbf{B}_c(x,y)\\mathbf{d} = \\boldsymbol{\\varepsilon}_0$。\n\n项 $\\mathbf{K}_{ad}\\mathbf{d}$ 可以重写为：\n$$\n\\mathbf{K}_{ad}\\mathbf{d} = \\left(\\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\mathbf{C} \\mathbf{B}_c \\, \\mathrm{d}\\Omega\\right) \\mathbf{d} = \\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\mathbf{C} (\\mathbf{B}_c\\mathbf{d}) \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\mathbf{C} \\boldsymbol{\\varepsilon}_0 \\, \\mathrm{d}\\Omega\n$$\n由于 $\\mathbf{C}$ 和 $\\boldsymbol{\\varepsilon}_0$ 是常数矩阵，它们可以从积分中提出：\n$$\n\\mathbf{K}_{ad}\\mathbf{d} = \\left(\\int_{\\Omega} \\mathbf{B}_e^\\mathsf{T} \\, \\mathrm{d}\\Omega\\right) \\mathbf{C} \\boldsymbol{\\varepsilon}_0\n$$\n关键部分是矩阵 $\\mathbf{B}_e$ 的积分。$\\mathbf{B}_e$ 的每个条目都是 $\\phi_b$ 的导数。考虑一个导数的积分，例如 $\\frac{\\partial\\phi_b}{\\partial x}$：\n$$\n\\int_{\\Omega} \\frac{\\partial\\phi_b}{\\partial x} \\, \\mathrm{d}\\Omega = \\int_0^1 \\int_0^1 \\frac{\\partial\\phi_b}{\\partial x} \\, dx dy = \\int_0^1 \\left[ \\phi_b(x,y) \\right]_{x=0}^{x=1} \\, dy\n$$\n由于 $\\phi_b$ 被定义为在边界 $\\partial \\Omega$ 上（特别是在 $x=0$ 和 $x=1$ 处）为零，因此该积分为零。同样的逻辑也适用于 $\\int_\\Omega \\frac{\\partial\\phi_b}{\\partial y} \\, \\mathrm{d}\\Omega$。这是散度定理的直接推论，因为 $\\int_\\Omega \\nabla \\phi_b \\, \\mathrm{d}\\Omega = \\int_{\\partial \\Omega} \\phi_b \\mathbf{n} \\, dS = \\mathbf{0}$。\n因此，$\\int_\\Omega \\mathbf{B}_e \\, \\mathrm{d}\\Omega = \\mathbf{0}$，这意味着 $\\int_\\Omega \\mathbf{B}_e^\\mathsf{T} \\, \\mathrm{d}\\Omega = \\mathbf{0}$。\n这证明了对于任何均匀应变状态，只要积分是精确执行的，$\\mathbf{K}_{ad}\\mathbf{d} = \\mathbf{0}$。关于 $\\mathbf{a}$ 的系统简化为 $\\mathbf{K}_{aa}\\mathbf{a} = \\mathbf{0}$。只要所选的增强模式不是平凡的，$\\mathbf{K}_{aa}$ 将是正定的，因而是可逆的，从而得出唯一解 $\\mathbf{a}^\\star = \\mathbf{0}$。\n\n### 4. 数值实现\n\n实现将通过数值求积来组装矩阵 $\\mathbf{K}_{dd}$、$\\mathbf{K}_{da}$ 和 $\\mathbf{K}_{aa}$。使用张量积 Gauss-Legendre 法则。积分域为 $[0,1]\\times[0,1]$。标准的 Gauss 点 $\\xi_p \\in [-1,1]$ 和权重 $w_p^{\\text{std}}$ 被映射到点 $x_p = (1+\\xi_p)/2$ 和权重 $w_p = w_p^{\\text{std}}/2$。\n积分近似为：\n$$\n\\mathbf{K} \\approx \\sum_{p=1}^n \\sum_{q=1}^n \\mathbf{F}(x_p, y_q) w_p w_q\n$$\n其中 $\\mathbf{F}$ 是各自的被积函数。问题指定了每方向 $n=5$ 个积分点以进行精确积分。这是足够的，因为被积函数的最高多项式次数为 6。\n对于最后一个测试用例，$\\mathbf{K}_{da}$ 采用 $n=1$ 个点（单元中心）进行刻意地欠积分。在这个特定点上，$\\nabla \\phi_b$ 通常不为零，所以 $\\mathbf{B}_e$ 的数值积分将不为零，导致斑块检验失败，即 $\\mathbf{a}^\\star \\neq \\mathbf{0}$。这验证了积分阶数的重要性。\n\n对于每个测试用例，算法按以下步骤进行：\n1.  定义材料参数 $(E, \\nu)$ 并计算 $\\lambda, \\mu$ 以构成 $\\mathbf{C}$。\n2.  定义均匀应变状态 $\\boldsymbol{\\varepsilon}_0$ 并从精确的线性场 $\\mathbf{u}_0(x,y)$ 计算节点位移向量 $\\mathbf{d}$。\n3.  将刚度矩阵 $\\mathbf{K}_{aa}$、$\\mathbf{K}_{dd}$、$\\mathbf{K}_{da}$ 初始化为零。\n4.  获取所需阶数（$n=5$ 以及需要时的 $n=1$）的 Gauss-Legendre 点和权重。\n5.  通过数值积分组装 $\\mathbf{K}_{aa}$、$\\mathbf{K}_{dd}$（使用 $n=5$）和 $\\mathbf{K}_{da}$（使用 $n=5$ 或 $n=1$）。\n6.  求解线性系统 $\\mathbf{K}_{aa} \\mathbf{a}^\\star = - \\mathbf{K}_{da}^\\mathsf{T} \\mathbf{d}$ 以得到 $\\mathbf{a}^\\star$。\n7.  检查是否 $\\|\\mathbf{a}^\\star\\|_2 \\le 10^{-12}$ 并记录布尔结果。", "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Solves the enhanced strain quadrilateral element problem.\n    \"\"\"\n    \n    test_cases = [\n        (200.0, 0.3, 0.01, 0.0, 0.0, 'exact'),\n        (150.0, 0.0, 0.0, 0.02, 0.0, 'exact'),\n        (210.0, 0.49, 0.0, 0.0, 0.03, 'exact'),\n        (123.4, 0.27, 0.005, -0.002, 0.01, 'exact'),\n        (123.4, 0.27, 0.005, -0.002, 0.01, 'under'),\n    ]\n\n    results = []\n    \n    # Tolerance for checking if the norm of a_star is zero\n    tolerance = 1e-12\n    # Constant c for the bubble function\n    c_const = 0.3\n    # Nodal coordinates (counter-clockwise)\n    nodes = np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]])\n    \n    # --- Define symbolic functions for derivatives ---\n    # Shape function derivatives\n    dN_dx = [\n        lambda x, y: -(1 - y),\n        lambda x, y: 1 - y,\n        lambda x, y: y,\n        lambda x, y: -y,\n    ]\n    dN_dy = [\n        lambda x, y: -(1 - x),\n        lambda x, y: -x,\n        lambda x, y: x,\n        lambda x, y: 1 - x,\n    ]\n    \n    # Bubble function derivatives\n    dphi_b_dx = lambda x, y: (3 * x**2 - 2 * (1 + c_const) * x + c_const) * (y - y**2)\n    dphi_b_dy = lambda x, y: (x**3 - (1 + c_const) * x**2 + c_const * x) * (1 - 2 * y)\n\n    for E, nu, eps_xx0, eps_yy0, gam_xy0, integration_mode in test_cases:\n        # 1. Material and Strain Setup\n        mu = E / (2 * (1 + nu))\n        lame_lambda = E * nu / ((1 + nu) * (1 - 2*nu))\n\n        C = np.array([\n            [lame_lambda + 2 * mu, lame_lambda, 0],\n            [lame_lambda, lame_lambda + 2 * mu, 0],\n            [0, 0, mu]\n        ])\n\n        eps0 = np.array([eps_xx0, eps_yy0, gam_xy0])\n\n        # 2. Compute Nodal Displacements\n        d_vec = np.zeros(8)\n        for i in range(4):\n            x, y = nodes[i]\n            d_vec[2 * i] = eps_xx0 * x + 0.5 * gam_xy0 * y       # u_x\n            d_vec[2 * i + 1] = 0.5 * gam_xy0 * x + eps_yy0 * y   # u_y\n\n        # 3. Numerical Integration Setup\n        n_exact = 5\n        n_under = 1\n        \n        # Gauss points and weights for exact integration on [-1,1]\n        gp_exact, gw_exact_std = leggauss(n_exact)\n        \n        # Mapped points and weights for [0,1]\n        gp_exact_map = 0.5 * (gp_exact + 1)\n        gw_exact_map = 0.5 * gw_exact_std\n\n        # Quadrature rules for each matrix block\n        n_Kaa = n_Kdd = n_exact\n        gw_Kaa = gw_Kdd = gw_exact_map\n        gp_Kaa = gp_Kdd = gp_exact_map\n\n        if integration_mode == 'exact':\n            n_Kda = n_exact\n            gw_Kda = gw_exact_map\n            gp_Kda = gp_exact_map\n        else: # 'under'\n            n_Kda = n_under\n            gp_under, gw_under_std = leggauss(n_under)\n            gp_Kda = 0.5 * (gp_under + 1)\n            gw_Kda = 0.5 * gw_under_std\n\n        # 4. Assemble Matrices\n        K_dd = np.zeros((8, 8))\n        K_da = np.zeros((8, 2))\n        K_aa = np.zeros((2, 2))\n\n        # Helper function for assembly\n        def assemble(K, B1, B2, C_mat, gw_x, gw_y):\n            K += (B1.T @ C_mat @ B2) * gw_x * gw_y\n\n        # Integration for K_dd\n        for i, (gx, wx) in enumerate(zip(gp_Kdd, gw_Kdd)):\n            for j, (gy, wy) in enumerate(zip(gp_Kdd, gw_Kdd)):\n                Bc = np.zeros((3, 8))\n                for k in range(4):\n                    Bc[0, 2 * k] = dN_dx[k](gx, gy)\n                    Bc[1, 2 * k + 1] = dN_dy[k](gx, gy)\n                    Bc[2, 2 * k] = dN_dy[k](gx, gy)\n                    Bc[2, 2 * k + 1] = dN_dx[k](gx, gy)\n                assemble(K_dd, Bc, Bc, C, wx, wy)\n\n        # Integration for K_aa\n        for i, (gx, wx) in enumerate(zip(gp_Kaa, gw_Kaa)):\n            for j, (gy, wy) in enumerate(zip(gp_Kaa, gw_Kaa)):\n                dphib_dx_val = dphi_b_dx(gx, gy)\n                dphib_dy_val = dphi_b_dy(gx, gy)\n                Be = np.array([\n                    [dphib_dx_val, 0],\n                    [0, dphib_dy_val],\n                    [dphib_dy_val, dphib_dx_val]\n                ])\n                assemble(K_aa, Be, Be, C, wx, wy)\n\n        # Integration for K_da\n        for i, (gx, wx) in enumerate(zip(gp_Kda, gw_Kda)):\n            for j, (gy, wy) in enumerate(zip(gp_Kda, gw_Kda)):\n                Bc = np.zeros((3, 8))\n                for k in range(4):\n                    Bc[0, 2 * k] = dN_dx[k](gx, gy)\n                    Bc[1, 2 * k + 1] = dN_dy[k](gx, gy)\n                    Bc[2, 2 * k] = dN_dy[k](gx, gy)\n                    Bc[2, 2 * k + 1] = dN_dx[k](gx, gy)\n                \n                dphib_dx_val = dphi_b_dx(gx, gy)\n                dphib_dy_val = dphi_b_dy(gx, gy)\n                Be = np.array([\n                    [dphib_dx_val, 0],\n                    [0, dphib_dy_val],\n                    [dphib_dy_val, dphib_dx_val]\n                ])\n\n                assemble(K_da, Bc, Be, C, wx, wy)\n\n        # 5. Solve for a_star and check norm\n        K_ad = K_da.T\n        try:\n            a_star = np.linalg.solve(K_aa, -K_ad @ d_vec)\n            norm_a_star = np.linalg.norm(a_star)\n            results.append(norm_a_star = tolerance)\n        except np.linalg.LinAlgError:\n            # Should not happen if K_aa is well-conditioned\n            results.append(False) \n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3573570"}, {"introduction": "引入增强场的关键动机之一是为了解决数值不稳定性，例如困扰着减缩积分单元的“沙漏现象”。本练习 [@problem_id:3573623] 通过特征值分析，让您能够“看见”这些非物理的零能模式，并动手实践如何通过引入一个精心设计的增强位移场来稳定单元。这个过程清晰地揭示了增强模式是如何在不影响刚体运动和单元精度的前提下，选择性地惩罚伪变形模式，从而恢复单元的稳定性和可靠性。", "problem": "您需要实现一个小规模的特征值分析，以精确且可验证的方式揭示二维弹性力学中四节点双线性四边形单元的减缩数值积分如何产生伪零能模式（沙漏模式），以及一种仅针对沙漏子空间的增强方法如何在不影响刚体模态的情况下恢复强制性。您的推导和算法必须从虚功原理和标准等参有限元定义出发。最终产品必须是一个完整的程序，该程序能够构建单元刚度矩阵，执行特征分析，识别伪零能模式，并通过一个精心设计的增强位移场贡献来验证这些模式的消除。\n\n使用以下基础和定义。\n\n- 对于单元层级的小应变线性弹性力学，虚功原理表述为 $\\,\\delta \\Pi_{e} = \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{K}_{e} \\boldsymbol{u}_{e} - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0\\,$，此式对所有容许的虚位移 $\\,\\delta \\boldsymbol{u}_{e}\\,$ 均成立。其中，单元刚度矩阵为 $\\,\\boldsymbol{K}_{e} = \\int_{\\Omega_{e}} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\,\\mathrm{d}\\Omega\\,$。应变-位移矩阵为 $\\,\\boldsymbol{B}\\,$，$\\,\\boldsymbol{C}\\,$ 为本构（材料）矩阵。\n- 考虑一个标准的等参四节点双线性四边形（常简写为 $\\,\\mathrm{Q4}\\,$），其节点坐标为 $\\,\\{(x_{i},y_{i})\\}_{i=1}^{4}\\,$，节点位移向量为 $\\,\\boldsymbol{u}_{e} \\in \\mathbb{R}^{8}\\,$，按 $\\,\\boldsymbol{u}_{e} = [u_{1x},u_{1y},u_{2x},u_{2y},u_{3x},u_{3y},u_{4x},u_{4y}]^{\\mathsf{T}}\\,$ 排序。在父域 $\\,(\\xi,\\eta)\\in[-1,1]^{2}\\,$ 中的双线性形函数为 $\\,N_{1}(\\xi,\\eta)=\\tfrac{1}{4}(1-\\xi)(1-\\eta)\\,$，$\\,N_{2}(\\xi,\\eta)=\\tfrac{1}{4}(1+\\xi)(1-\\eta)\\,$，$\\,N_{3}(\\xi,\\eta)=\\tfrac{1}{4}(1+\\xi)(1+\\eta)\\,$，$\\,N_{4}(\\xi,\\eta)=\\tfrac{1}{4}(1-\\xi)(1+\\eta)\\,$。到物理空间的映射为 $\\,\\boldsymbol{x}(\\xi,\\eta)=\\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,\\boldsymbol{x}_{i}\\,$，其雅可比矩阵为 $\\,\\boldsymbol{J}=\\partial \\boldsymbol{x}/\\partial(\\xi,\\eta)\\,$，且 $\\,\\mathrm{d}\\Omega = \\det(\\boldsymbol{J})\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta\\,$。物理坐标系下的形函数梯度通过 $\\,\\nabla N_{i} = \\boldsymbol{J}^{-1}\\,\\nabla_{\\xi,\\eta} N_{i}\\,$ 获得。\n- 对于二维平面应变问题，本构矩阵为 $\\,\\boldsymbol{C}=\\dfrac{E}{(1+\\nu)(1-2\\nu)}\\begin{bmatrix}1-\\nu  \\nu  0\\\\ \\nu  1-\\nu  0\\\\ 0  0  \\tfrac{1}{2}(1-2\\nu)\\end{bmatrix}\\,$，其中 $\\,E\\,$ 是杨氏模量，$\\,\\nu\\,$ 是泊松比。应变-位移矩阵 $\\,\\boldsymbol{B}\\,$ 由 $\\,\\partial N_{i}/\\partial x\\,$ 和 $\\,\\partial N_{i}/\\partial y\\,$ 的各项以标准方式构建。\n\n您必须实现三种单元刚度矩阵的构建方法：\n- 减缩积分：在 $\\,[-1,1]^{2}\\,$ 上使用位于 $\\,(\\xi,\\eta)=(0,0)\\,$ 的单个高斯点，权重为 $\\,w=4\\,$，因此 $\\,\\boldsymbol{K}_{\\mathrm{red}}=\\boldsymbol{B}(0,0)^{\\mathsf{T}}\\boldsymbol{C}\\,\\boldsymbol{B}(0,0)\\,\\det(\\boldsymbol{J}(0,0))\\,w\\,$。这会产生除刚体模态之外的秩亏，从而导致伪零能模式。\n- 完全积分：使用 $\\,2\\times 2\\,$ 高斯法则，积分点为 $\\,(\\pm 1/\\sqrt{3},\\pm 1/\\sqrt{3})\\,$，权重为 $\\,w=1\\,$，求和得到 $\\,\\boldsymbol{K}_{\\mathrm{full}}\\,$。这在常规情况下能消除伪零能模式，只留下刚体模态。\n- 在减缩积分基础上进行增强位移稳定化：令 $\\,\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}})\\,$ 表示 $\\,\\boldsymbol{K}_{\\mathrm{red}}\\,$ 的零空间。令 $\\,\\mathcal{R}\\,$ 为刚体模态子空间，由两个平移和一个绕形心 $\\,\\boldsymbol{x}_{c}\\,$ 的面内转动所张成，即 $\\,\\boldsymbol{r}_{1}=[1,0,1,0,1,0,1,0]^{\\mathsf{T}}\\,$，$\\,\\boldsymbol{r}_{2}=[0,1,0,1,0,1,0,1]^{\\mathsf{T}}\\,$ 和 $\\,\\boldsymbol{r}_{3}=[-y_{1}^{c},x_{1}^{c},-y_{2}^{c},x_{2}^{c},-y_{3}^{c},x_{3}^{c},-y_{4}^{c},x_{4}^{c}]^{\\mathsf{T}}\\,$，其中 $\\,\\boldsymbol{x}_{i}^{c}=\\boldsymbol{x}_{i}-\\boldsymbol{x}_{c}\\,$ 且 $\\,\\boldsymbol{x}_{c}=\\tfrac{1}{4}\\sum_{i=1}^{4}\\boldsymbol{x}_{i}\\,$。定义沙漏子空间 $\\,\\mathcal{H}=\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}})\\ominus\\mathcal{R}\\,$。构造 $\\,\\mathcal{H}\\,$ 的一个标准正交基 $\\,\\boldsymbol{H}\\in\\mathbb{R}^{8\\times n_{h}}\\,$，其中 $\\,n_{h}\\,$ 是 $\\,\\mathcal{H}\\,$ 的维数。添加一个增强位移稳定项 $\\,\\boldsymbol{K}_{\\mathrm{enh}}=\\beta\\,\\boldsymbol{H}\\boldsymbol{H}^{\\mathsf{T}}\\,$，其中 $\\,\\beta=\\alpha\\,\\mu\\,L\\,$，$\\,\\mu=\\dfrac{E}{2(1+\\nu)}\\,$ 是剪切模量，$\\,L=\\sqrt{A}\\,$ (其中 $\\,A\\,$ 是单元面积)，$\\,\\alpha=1\\,$ 是一个无量纲缩放因子。增强后的刚度为 $\\,\\boldsymbol{K}_{\\mathrm{red+enh}}=\\boldsymbol{K}_{\\mathrm{red}}+\\boldsymbol{K}_{\\mathrm{enh}}\\,$。此构造必须使刚体模态不受罚，且仅提升沙漏模式的能量，从而消除伪零能模式。\n\n您必须按如下方式诊断伪零能模式。给定一个对称矩阵 $\\,\\boldsymbol{K}\\,$，计算其特征值 $\\,\\{\\lambda_{i}\\}\\,$。令 $\\,\\lambda_{\\max}=\\max_{i}|\\lambda_{i}|\\,$ 并定义一个相对阈值 $\\,\\varepsilon=\\max(10^{-8},10^{-8}\\lambda_{\\max})\\,$。计算特征值满足 $\\,|\\lambda_{i}|\\le\\varepsilon\\,$ 的数量 $\\,n_{0}\\,$。伪零能模式的数量为 $\\,n_{\\mathrm{spur}}=\\max(0, n_{0}-3)\\,$，因为对于一个自由单元，二维弹性力学中有 $\\,3\\,$ 个刚体模态。\n\n实现上述内容，并将其应用于以下测试套件。使用平面应变条件，$\\,E=210\\times 10^{9}\\,$ 且 $\\,\\nu=0.30\\,$。定义两种几何形状：\n- 几何 $\\,\\mathcal{G}_{1}\\,$ (正方形): 节点位于 $\\,\\boldsymbol{x}_{1}=(0,0)\\,$, $\\,\\boldsymbol{x}_{2}=(1,0)\\,$, $\\,\\boldsymbol{x}_{3}=(1,1)\\,$, $\\,\\boldsymbol{x}_{4}=(0,1)\\,$，单位为米。\n- 几何 $\\,\\mathcal{G}_{2}\\,$ (扭曲的平行四边形): 节点位于 $\\,\\boldsymbol{x}_{1}=(0,0)\\,$, $\\,\\boldsymbol{x}_{2}=(2,0)\\,$, $\\,\\boldsymbol{x}_{3}=(2.2,1)\\,$, $\\,\\boldsymbol{x}_{4}=(0.2,1)\\,$，单位为米。\n\n构成六个案例，并为每个案例报告整数形式的 $\\,n_{\\mathrm{spur}}\\,$：\n- 案例 $\\,1\\,$: 对 $\\,\\mathcal{G}_{1}\\,$ 使用减缩积分。\n- 案例 $\\,2\\,$: 对 $\\,\\mathcal{G}_{1}\\,$ 使用减缩积分加增强。\n- 案例 $\\,3\\,$: 对 $\\,\\mathcal{G}_{1}\\,$ 使用完全积分。\n- 案例 $\\,4\\,$: 对 $\\,\\mathcal{G}_{2}\\,$ 使用减缩积分。\n- 案例 $\\,5\\,$: 对 $\\,\\mathcal{G}_{2}\\,$ 使用减缩积分加增强。\n- 案例 $\\,6\\,$: 对 $\\,\\mathcal{G}_{2}\\,$ 使用完全积分。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，即 $\\,\\big[ n_{\\mathrm{spur}}^{(1)}, n_{\\mathrm{spur}}^{(2)}, n_{\\mathrm{spur}}^{(3)}, n_{\\mathrm{spur}}^{(4)}, n_{\\mathrm{spur}}^{(5)}, n_{\\mathrm{spur}}^{(6)} \\big]\\,$，其中每个条目是按指定案例顺序排列的整数。输出中不需要物理单位，因为最终要求的量是纯粹的计数。", "solution": "该问题要求在计算固体力学领域中，实现并验证一些数值技术，特别是关于二维线性弹性力学中的四节点双线性四边形（$\\mathrm{Q4}$）单元。核心任务是展示在减缩积分下伪零能模式（沙漏现象）的出现，以及随后使用增强位移场方法将其消除的过程。该分析将通过计算不同单元刚度矩阵的特征值来执行。\n\n推导始于虚功原理，该原理指出，对于处于平衡状态的物体，外力所做的虚功等于在任何容许的虚位移下内应变能的变化。对于单个有限元，这表示为 $\\delta \\Pi_{e} = \\int_{\\Omega_e} \\delta\\boldsymbol{\\varepsilon}^{\\mathsf{T}}\\boldsymbol{\\sigma} \\,\\mathrm{d}\\Omega - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0$，其中 $\\boldsymbol{\\sigma}$ 是应力张量，$\\boldsymbol{\\varepsilon}$ 是应变张量，$\\boldsymbol{u}_e$ 是节点位移向量，$\\boldsymbol{f}_e$ 是节点力向量。\n\n使用线性弹性本构关系 $\\boldsymbol{\\sigma} = \\boldsymbol{C}\\boldsymbol{\\varepsilon}$ 和应变-位移关系 $\\boldsymbol{\\varepsilon} = \\boldsymbol{B} \\boldsymbol{u}_e$，其中 $\\boldsymbol{C}$ 是材料本构矩阵，$\\boldsymbol{B}$ 是应变-位移矩阵，虚功原理可以重写为：\n$$ \\delta \\Pi_{e} = \\int_{\\Omega_e} (\\delta(\\boldsymbol{B}\\boldsymbol{u}_e))^{\\mathsf{T}}\\boldsymbol{C}(\\boldsymbol{B}\\boldsymbol{u}_e) \\,\\mathrm{d}\\Omega - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0 $$\n$$ \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\left( \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\,\\mathrm{d}\\Omega \\right) \\boldsymbol{u}_{e} - \\delta \\boldsymbol{u}_{e}^{\\mathsf{T}} \\boldsymbol{f}_{e} = 0 $$\n由于此式必须对任意虚位移 $\\delta \\boldsymbol{u}_e$ 成立，我们确定单元刚度矩阵 $\\boldsymbol{K}_e$ 为：\n$$ \\boldsymbol{K}_e = \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\,\\mathrm{d}\\Omega $$\n积分是在单元的物理域 $\\Omega_e$ 上进行的。对于等参单元，我们使用几何映射的雅可比矩阵 $\\boldsymbol{J}$ 将此积分映射到父域（通常是 $(\\xi, \\eta) \\in [-1, 1]^2$）上：$\\mathrm{d}\\Omega = \\det(\\boldsymbol{J}) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。刚度矩阵变为：\n$$ \\boldsymbol{K}_e = \\int_{-1}^{1}\\int_{-1}^{1} \\boldsymbol{B}(\\xi, \\eta)^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B}(\\xi, \\eta) \\det(\\boldsymbol{J}(\\xi, \\eta)) \\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta $$\n应变-位移矩阵 $\\boldsymbol{B}$ 由形函数 $N_i$ 的物理梯度构成。对于节点 $i$，其贡献 $\\boldsymbol{B}_i$ 为 $\\boldsymbol{B}_i = \\begin{bmatrix} \\partial N_i/\\partial x  0 \\\\ 0  \\partial N_i/\\partial y \\\\ \\partial N_i/\\partial y  \\partial N_i/\\partial x \\end{bmatrix}$。完整的矩阵为 $\\boldsymbol{B} = [\\boldsymbol{B}_1, \\boldsymbol{B}_2, \\boldsymbol{B}_3, \\boldsymbol{B}_4]$。物理梯度通过链式法则从父空间梯度得到：$\\nabla_{\\boldsymbol{x}} N_i = \\boldsymbol{J}^{-1} \\nabla_{\\boldsymbol{\\xi}} N_i$。\n\n$\\boldsymbol{K}_e$ 的这个积分使用高斯求积进行数值计算。求积法则的选择至关重要。\n1.  **完全积分 ($\\boldsymbol{K}_{\\mathrm{full}}$)**：使用 $2\\times 2$ 高斯法则。它有 $4$ 个积分点 $(\\xi_{gp}, \\eta_{gp})$，权重为 $w_{gp}=1$。对于矩形或平行四边形单元，此积分阶数足以精确积分刚度矩阵，并为一般四边形提供正确的秩，确保没有伪零能模式。矩阵的秩为 $n_{dof} - n_{rbm} = 8 - 3 = 5$，其中 $n_{dof}$ 是自由度数，$n_{rbm}$ 是刚体模态数。$\\boldsymbol{K}_{\\mathrm{full}}$ 的零空间维数为 $3$，由刚体模态张成。\n\n2.  **减缩积分 ($\\boldsymbol{K}_{\\mathrm{red}}$)**：使用位于单元中心 $(\\xi, \\eta) = (0, 0)$ 的单个高斯点，权重为 $w=4$。这种方法计算效率高。然而，仅在此单点计算的应变-位移矩阵 $\\boldsymbol{B}(0,0)$ 可能无法捕捉所有可能的变形模式。某些被称为沙漏模式的变形模式在单元中心产生零应变，即对于沙漏节点位移向量 $\\boldsymbol{u}_{hg}$ 有 $\\boldsymbol{B}(0,0)\\boldsymbol{u}_{hg} = \\boldsymbol{0}$。因此，这些模式具有零应变能（$\\frac{1}{2}\\boldsymbol{u}_{hg}^{\\mathsf{T}}\\boldsymbol{K}_{\\mathrm{red}}\\boldsymbol{u}_{hg}=0$），并作为额外的向量出现在 $\\boldsymbol{K}_{\\mathrm{red}}$ 的零空间中。$\\boldsymbol{K}_{\\mathrm{red}}$ 的秩低于 $5$，导致秩亏和过度柔性的单元格式，在全局分析中可能不稳定。对于矩形单元，存在两个这样的沙漏模式，因此 $\\mathrm{rank}(\\boldsymbol{K}_{\\mathrm{red}})=3$ 且 $\\mathrm{dim}(\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}}))=5$。对于一般的平行四边形，存在一个沙漏模式，因此 $\\mathrm{rank}(\\boldsymbol{K}_{\\mathrm{red}})=4$ 且 $\\mathrm{dim}(\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}}))=4$。\n\n3.  **带增强的减缩积分 ($\\boldsymbol{K}_{\\mathrm{red+enh}}$)**：为了恢复减缩积分单元的稳定性，需要添加一个稳定项 $\\boldsymbol{K}_{\\mathrm{enh}}$。该项必须只惩罚伪沙漏模式，同时保持刚体模态和其他有效变形不受影响。这可以通过定义一个修正的势能 $\\Pi_{e, \\text{enh}} = \\Pi_{e, \\text{red}} + \\Pi_{e, \\text{stab}}$ 来实现，其中 $\\Pi_{e, \\text{stab}}$ 是与沙漏变形相关的罚能。我们将沙漏子空间 $\\mathcal{H}$ 定义为 $\\boldsymbol{K}_{\\mathrm{red}}$ 零空间中与刚体子空间 $\\mathcal{R}$ 正交的部分，即 $\\mathcal{H} = \\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}}) \\ominus \\mathcal{R}$。令 $\\boldsymbol{H}$ 是一个其列向量构成 $\\mathcal{H}$ 的标准正交基的矩阵。沙漏罚能定义为 $\\Pi_{e, \\text{stab}} = \\frac{1}{2}\\beta \\| \\boldsymbol{H}^{\\mathsf{T}}\\boldsymbol{u}_e \\|_2^2 = \\frac{1}{2}\\beta \\boldsymbol{u}_e^{\\mathsf{T}}\\boldsymbol{H}\\boldsymbol{H}^{\\mathsf{T}}\\boldsymbol{u}_e$。对 $\\boldsymbol{u}_e$ 取二次变分，得到稳定刚度 $\\boldsymbol{K}_{\\mathrm{enh}} = \\beta \\boldsymbol{H}\\boldsymbol{H}^{\\mathsf{T}}$。总刚度为 $\\boldsymbol{K}_{\\mathrm{red+enh}} = \\boldsymbol{K}_{\\mathrm{red}} + \\boldsymbol{K}_{\\mathrm{enh}}$。稳定参数 $\\beta$ 根据材料（$\\mu$）和几何（$L$）属性来选择，以提供适当的刚度。关键在于，如果 $\\boldsymbol{u}_e$ 是一个刚体模态，它与 $\\boldsymbol{H}$ 的列向量正交，因此 $\\boldsymbol{H}^{\\mathsf{T}}\\boldsymbol{u}_e=\\boldsymbol{0}$，不施加惩罚。如果 $\\boldsymbol{u}_e$ 是一个沙漏模式，它位于 $\\boldsymbol{H}$ 的张成空间内，罚项则提供必要的能量以防止伪行为。\n\n识别沙漏基 $\\boldsymbol{H}$ 的算法如下：\n- 找到 $\\boldsymbol{K}_{\\mathrm{red}}$ 零空间的一个标准正交基，记为矩阵 $\\boldsymbol{N}_{\\text{basis}}$ 的列向量。\n- 构建刚体模态 $\\boldsymbol{r}_1, \\boldsymbol{r}_2, \\boldsymbol{r}_3$，并找到它们所张成的空间 $\\mathcal{R}$ 的一个标准正交基，记为矩阵 $\\boldsymbol{R}_{\\text{basis}}$ 的列向量。\n- 如果一个向量 $\\boldsymbol{v}$ 位于 $\\mathcal{N}(\\boldsymbol{K}_{\\mathrm{red}})$ 中且与 $\\mathcal{R}$ 正交，则它是一个沙漏模式。这意味着对于某个系数向量 $\\boldsymbol{c}$ 有 $\\boldsymbol{v} = \\boldsymbol{N}_{\\text{basis}}\\boldsymbol{c}$，并且 $\\boldsymbol{R}_{\\text{basis}}^{\\mathsf{T}}\\boldsymbol{v} = \\boldsymbol{0}$。这导出条件 $(\\boldsymbol{R}_{\\text{basis}}^{\\mathsf{T}}\\boldsymbol{N}_{\\text{basis}})\\boldsymbol{c} = \\boldsymbol{0}$。\n- 我们求解矩阵 $(\\boldsymbol{R}_{\\text{basis}}^{\\mathsf{T}}\\boldsymbol{N}_{\\text{basis}})$ 的零空间以找到容许的系数 $\\boldsymbol{c}$。设此零空间的基为 $\\boldsymbol{Z}$。\n- 于是，沙漏子空间的标准正交基为 $\\boldsymbol{H} = \\boldsymbol{N}_{\\text{basis}}\\boldsymbol{Z}$。\n\n最后一步是为每个刚度矩阵诊断伪模式的数量 $n_{\\mathrm{spur}}$。我们计算矩阵的特征值 $\\{\\lambda_i\\}$。零能模式的数量 $n_0$ 是小于数值阈值 $\\varepsilon$ 的特征值的计数。由于一个自由单元有 $3$ 个物理零能模式（刚体模态），伪模式的数量为 $n_{\\mathrm{spur}}=\\max(0, n_0-3)$。此过程可以对每种积分和稳定方案的有效性进行定量验证。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import null_space, orth\n\nclass Q4Element:\n    \"\"\"\n    Represents a 4-node bilinear quadrilateral element in 2D elasticity.\n    \"\"\"\n    def __init__(self, nodes, E, nu):\n        \"\"\"\n        Initializes the element.\n        :param nodes: A list of 4 tuples, each with (x, y) coordinates of the nodes.\n        :param E: Young's modulus.\n        :param nu: Poisson's ratio.\n        \"\"\"\n        self.nodes = np.array(nodes)  # 4x2 array of (x,y) coords\n        if self.nodes.shape != (4, 2):\n            raise ValueError(\"Nodes must be a 4x2 array.\")\n        self.E = E\n        self.nu = nu\n        # Pre-compute the constitutive matrix for plane strain\n        self.C = self._get_constitutive_matrix()\n\n    def _get_constitutive_matrix(self):\n        \"\"\"Computes the plane strain constitutive matrix C.\"\"\"\n        factor = self.E / ((1 + self.nu) * (1 - 2 * self.nu))\n        C = factor * np.array([\n            [1 - self.nu, self.nu, 0],\n            [self.nu, 1 - self.nu, 0],\n            [0, 0, (1 - 2 * self.nu) / 2]\n        ])\n        return C\n\n    def get_shape_func_grads_parent(self, xi, eta):\n        \"\"\"Computes gradients of shape functions w.r.t. parent coordinates (xi, eta).\"\"\"\n        dN_dxi = 0.25 * np.array([-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)])\n        dN_deta = 0.25 * np.array([-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)])\n        return dN_dxi, dN_deta\n\n    def get_B_matrix_and_jacobian_det(self, xi, eta):\n        \"\"\"Computes the strain-displacement matrix B and Jacobian determinant.\"\"\"\n        dN_dxi, dN_deta = self.get_shape_func_grads_parent(xi, eta)\n\n        # Jacobian matrix J = [[dx/dxi, dy/dxi], [dx/deta, dy/deta]]\n        J = np.zeros((2, 2))\n        J[0, 0] = np.dot(dN_dxi, self.nodes[:, 0])  # dx/dxi\n        J[0, 1] = np.dot(dN_dxi, self.nodes[:, 1])  # dy/dxi\n        J[1, 0] = np.dot(dN_deta, self.nodes[:, 0]) # dx/deta\n        J[1, 1] = np.dot(dN_deta, self.nodes[:, 1]) # dy/deta\n        \n        detJ = np.linalg.det(J)\n        if detJ = 0:\n            raise ValueError(\"Jacobian determinant is non-positive, check node ordering.\")\n        \n        invJ = np.linalg.inv(J)\n\n        # Gradients of N w.r.t. physical coordinates (x, y)\n        dN_dxy = invJ @ np.vstack((dN_dxi, dN_deta))\n        dN_dx, dN_dy = dN_dxy[0, :], dN_dxy[1, :]\n\n        # Strain-displacement matrix B\n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2 * i] = dN_dx[i]\n            B[1, 2 * i + 1] = dN_dy[i]\n            B[2, 2 * i] = dN_dy[i]\n            B[2, 2 * i + 1] = dN_dx[i]\n            \n        return B, detJ\n\n    def get_stiffness_matrix_reduced(self):\n        \"\"\"Computes the stiffness matrix using 1-point reduced integration.\"\"\"\n        xi, eta, w = 0.0, 0.0, 4.0\n        B, detJ = self.get_B_matrix_and_jacobian_det(xi, eta)\n        K = B.T @ self.C @ B * detJ * w\n        return K\n\n    def get_stiffness_matrix_full(self):\n        \"\"\"Computes the stiffness matrix using 2x2 full integration.\"\"\"\n        gp_coord = 1.0 / np.sqrt(3)\n        gauss_points = [(-gp_coord, -gp_coord), (gp_coord, -gp_coord),\n                        (gp_coord, gp_coord), (-gp_coord, gp_coord)]\n        weights = [1.0, 1.0, 1.0, 1.0]\n\n        K = np.zeros((8, 8))\n        for (xi, eta), w in zip(gauss_points, weights):\n            B, detJ = self.get_B_matrix_and_jacobian_det(xi, eta)\n            K += B.T @ self.C @ B * detJ * w\n        return K\n\n    def get_stiffness_matrix_enhanced(self):\n        \"\"\"Computes the stiffness matrix with reduced integration plus hourglass control.\"\"\"\n        K_red = self.get_stiffness_matrix_reduced()\n        \n        # 1. Find an orthonormal basis for the null space of K_red\n        N_basis = null_space(K_red)\n\n        # 2. Construct rigid body modes and find an orthonormal basis for their span\n        centroid = np.mean(self.nodes, axis=0)\n        nodes_c = self.nodes - centroid\n        \n        r1 = np.tile([1, 0], 4)\n        r2 = np.tile([0, 1], 4)\n        r3 = np.zeros(8)\n        for i in range(4):\n            r3[2*i] = -nodes_c[i, 1]\n            r3[2*i+1] = nodes_c[i, 0]\n            \n        R_matrix = np.vstack([r1, r2, r3]).T\n        R_basis = orth(R_matrix)\n        \n        # 3. Find hourglass subspace basis H\n        if N_basis.shape[1] > R_basis.shape[1]:\n            M = R_basis.T @ N_basis\n            Z = null_space(M)\n            H = N_basis @ Z\n        else:\n            # The null space of K_red only contains rigid body modes (or fewer).\n            return K_red\n\n        if H.shape[1] == 0:  # No non-rigid-body modes found in the null space\n            return K_red\n        \n        # 4. Calculate stabilization matrix K_enh\n        # Area A using shoelace formula\n        x, y = self.nodes[:, 0], self.nodes[:, 1]\n        A = 0.5 * np.abs(np.dot(x, np.roll(y, -1)) - np.dot(y, np.roll(x, -1)))\n        \n        L = np.sqrt(A)\n        mu = self.E / (2 * (1 + self.nu))\n        alpha = 1.0\n        beta = alpha * mu * L\n        \n        K_enh = beta * (H @ H.T)\n        \n        return K_red + K_enh\n\ndef count_spurious_modes(K):\n    \"\"\"\n    Counts spurious zero-energy modes from a stiffness matrix K.\n    A mode is considered zero-energy if its eigenvalue is close to zero.\n    There are 3 rigid-body modes, so any zero-energy modes beyond 3 are spurious.\n    \"\"\"\n    # Use eigvalsh for symmetric matrices for better performance and stability\n    eigenvalues = np.linalg.eigvalsh(K)\n    \n    if len(eigenvalues) == 0:\n        return 0\n        \n    lambda_max = np.max(np.abs(eigenvalues))\n    # Epsilon threshold as per problem specification\n    epsilon = max(1e-8, 1e-8 * lambda_max) if lambda_max > 0 else 1e-8\n    \n    # Count eigenvalues whose absolute value is less than the threshold\n    n0 = np.sum(np.abs(eigenvalues)  epsilon)\n    \n    # Number of spurious modes is the number of zero modes minus 3 rigid body modes\n    n_spur = max(0, n0 - 3)\n    return int(n_spur)\n\ndef solve():\n    # Define material properties and test geometries\n    E = 210e9\n    nu = 0.30\n\n    nodes_g1 = [(0, 0), (1, 0), (1, 1), (0, 1)]  # Square\n    nodes_g2 = [(0, 0), (2, 0), (2.2, 1), (0.2, 1)] # Distorted parallelogram\n\n    # Define test cases: (geometry_nodes, stiffness_matrix_method_name)\n    test_cases = [\n        (nodes_g1, 'reduced'),\n        (nodes_g1, 'enhanced'),\n        (nodes_g1, 'full'),\n        (nodes_g2, 'reduced'),\n        (nodes_g2, 'enhanced'),\n        (nodes_g2, 'full'),\n    ]\n\n    results = []\n    for nodes, method in test_cases:\n        element = Q4Element(nodes, E, nu)\n        \n        if method == 'reduced':\n            K = element.get_stiffness_matrix_reduced()\n        elif method == 'enhanced':\n            K = element.get_stiffness_matrix_enhanced()\n        elif method == 'full':\n            K = element.get_stiffness_matrix_full()\n        \n        n_spur = count_spurious_modes(K)\n        results.append(n_spur)\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3573623"}]}