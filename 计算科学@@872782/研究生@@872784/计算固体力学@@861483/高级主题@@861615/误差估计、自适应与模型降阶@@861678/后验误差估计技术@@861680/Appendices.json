{"hands_on_practices": [{"introduction": "基于残差的后验误差估计是有限元分析的基石，它通过量化近似解在局部的不平衡程度来评估误差。这类估计子的一个关键组成部分是内部单元边界上的“力密度跳跃项”，它衡量了计算应力场的不连续性。本次实践 [@problem_id:3541963] 将引导您逐步计算这一基本量，让您亲身体验如何从一个给定的有限元解中计算出误差指示子的核心部分。", "problem": "考虑一个在端部载荷作用下的二维悬臂梁，在平面应变条件下建模，使用线性拉格朗日单元 ($P_1$) 通过有限元法 (FEM) 进行离散。关注一个局部内部边 $e$，它是将坐标（单位：米）为 $A=(0,0)$、$B=(1,0)$、$C=(0,1)$ 和 $D=(1,1)$ 的单位正方形沿从 $B$ 到 $C$ 的对角线分割后产生的两个相邻三角形的公共边。设 $T^{+}=\\triangle ABC$ 和 $T^{-}=\\triangle BDC$，并设 $e$ 为连接 $B$ 和 $C$ 的边。离散位移场 $u_h=(u_{h,x},u_{h,y})$ 在每个三角形上是分段仿射的，并在网格顶点处（单位：米）给出如下：\n- $u_h(A)=(0,0)$,\n- $u_h(B)=(1.0\\times 10^{-4},\\,2.0\\times 10^{-4})$,\n- $u_h(C)=(-5.0\\times 10^{-5},\\,3.0\\times 10^{-4})$,\n- $u_h(D)=(9.0\\times 10^{-5},\\,4.7\\times 10^{-4})$。\n假设材料为各向同性、均匀、线性弹性的平面应变材料，其拉梅参数 $(\\lambda,\\mu)$ 分别为 $\\lambda=1.2\\times 10^{9}\\,\\mathrm{Pa}$ 和 $\\mu=0.8\\times 10^{9}\\,\\mathrm{Pa}$。Cauchy应力张量定义为 $\\sigma(u_h)=2\\mu\\,\\varepsilon(u_h)+\\lambda\\,\\mathrm{tr}(\\varepsilon(u_h))\\,I$，其中 $\\varepsilon(u_h)=(\\nabla u_h+(\\nabla u_h)^{\\top})/2$ 是对称梯度，$I$ 是单位张量。在由单元 $T^{+}$ 和 $T^{-}$ 共享的内部边 $e$ 上，沿 $e$ 的外法向单位向量分别表示为 $n^{+}$ (对于 $T^{+}$) 和 $n^{-}$ (对于 $T^{-}$) 并满足 $n^{-}=-n^{+}$，定义牵引力跳跃向量为 $\\llbracket \\sigma(u_h)n \\rrbracket := \\sigma(u_h)|_{T^{+}}\\,n^{+}+\\sigma(u_h)|_{T^{-}}\\,n^{-}$。边范数是 $\\|v\\|_{0,e}=\\left(\\int_{e}|v|^{2}\\,\\mathrm{d}s\\right)^{1/2}$，其中 $|\\,\\cdot\\,|$ 是 $\\mathbb{R}^{2}$ 中的欧几里得范数。使用这些数据和定义，计算边 $e=\\overline{BC}$ 的内部边跳跃贡献 $\\|\\llbracket \\sigma(u_h)n\\rrbracket\\|_{0,e}$。以 $\\mathrm{N}\\,\\mathrm{m}^{-3/2}$ 为单位表示您的最终答案，并将答案四舍五入到四位有效数字。", "solution": "首先对问题进行验证，以确保其科学上合理、自洽且适定。\n\n### 第1步：提取已知条件\n- **几何形状：** 一个单位正方形，顶点为 $A=(0,0)$、$B=(1,0)$、$C=(0,1)$ 和 $D=(1,1)$，单位为米。该区域被划分为两个三角形：$T^{+} = \\triangle ABC$ 和 $T^{-} = \\triangle BDC$。\n- **关注的边：** $e = \\overline{BC}$，$T^{+}$ 和 $T^{-}$ 之间的公共边。\n- **有限元离散：** 线性拉格朗日单元 ($P_1$)。离散位移场 $u_h=(u_{h,x}, u_{h,y})$ 是分段仿射的。\n- **节点位移 (单位：米)：**\n  - $u_h(A) = (0,0)$\n  - $u_h(B) = (1.0 \\times 10^{-4}, 2.0 \\times 10^{-4})$\n  - $u_h(C) = (-5.0 \\times 10^{-5}, 3.0 \\times 10^{-4})$\n  - $u_h(D) = (9.0 \\times 10^{-5}, 4.7 \\times 10^{-4})$\n- **材料模型：** 各向同性、均匀、线性弹性、平面应变。\n- **材料属性 (拉梅参数)：** $\\lambda = 1.2 \\times 10^{9}\\,\\mathrm{Pa}$，$\\mu = 0.8 \\times 10^{9}\\,\\mathrm{Pa}$。\n- **本构关系：** Cauchy应力 $\\sigma(u_h) = 2\\mu\\,\\varepsilon(u_h) + \\lambda\\,\\mathrm{tr}(\\varepsilon(u_h))\\,I$，其中 $\\varepsilon(u_h) = (\\nabla u_h + (\\nabla u_h)^{\\top})/2$。\n- **定义：**\n  - 牵引力跳跃：$\\llbracket \\sigma(u_h)n \\rrbracket = \\sigma(u_h)|_{T^{+}}\\,n^{+} + \\sigma(u_h)|_{T^{-}}\\,n^{-}$，其中 $n^{\\pm}$ 是从 $T^{\\pm}$ 沿 $e$ 的外法向单位向量，且 $n^{-} = -n^{+}$。\n  - 边范数：$\\|v\\|_{0,e} = \\left(\\int_{e}|v|^{2}\\,\\mathrm{d}s\\right)^{1/2}$。\n- **目标：** 计算 $e=\\overline{BC}$ 的 $\\|\\llbracket \\sigma(u_h)n\\rrbracket\\|_{0,e}$，并以 $\\mathrm{N}\\,\\mathrm{m}^{-3/2}$ 为单位提供结果，四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题是计算固体力学中有限元方法后验误差估计的一个标准练习。它在科学上基于线性弹性力学和连续介质力学的原理。所有术语都是标准的且定义精确。所有必需的数据（几何形状、节点位移、材料常数）都已提供，并且在物理上是合理的。问题是适定的、客观的，并且不包含矛盾或歧义。\n\n### 第3步：结论与行动\n问题有效。下面是完整解法。\n\n### 详细解答\n\n求解过程首先计算每个三角形单元上的恒定位移梯度，然后计算应变和应力张量，接着计算牵引力跳跃向量，最后计算所求的边范数。\n\n**1. 位移梯度**\n由于位移场 $u_h$ 在每个三角形上是仿射（线性）的，其梯度 $\\nabla u_h$ 在每个单元上是一个常数矩阵。\n\n对于单元 $T^{+} = \\triangle ABC$，其顶点为 $A(0,0)$、$B(1,0)$ 和 $C(0,1)$，位移场形式为 $u_h(x,y) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}x \\\\ y\\end{pmatrix}$。梯度为 $\\nabla u_h = \\mathbf{B}^T$。系数由节点值求出：\n$u_h(0,0) = \\mathbf{a} = u_h(A) = (0,0)$。\n$u_h(1,0) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}1 \\\\ 0\\end{pmatrix} = u_h(B)$，这意味着 $\\mathbf{B}$ 的第一列是 $u_h(B)$。\n$u_h(0,1) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}0 \\\\ 1\\end{pmatrix} = u_h(C)$，这意味着 $\\mathbf{B}$ 的第二列是 $u_h(C)$。\n所以，$\\mathbf{B} = \\begin{pmatrix} u_{h,x}(B)  u_{h,x}(C) \\\\ u_{h,y}(B)  u_{h,y}(C) \\end{pmatrix} = \\begin{pmatrix} 1.0 \\times 10^{-4}  -5.0 \\times 10^{-5} \\\\ 2.0 \\times 10^{-4}  3.0 \\times 10^{-4} \\end{pmatrix}$。\n$T^{+}$ 上的梯度为：\n$$ \\nabla u_h|_{T^{+}} = \\mathbf{B}^T = \\begin{pmatrix} 1.0 \\times 10^{-4}  2.0 \\times 10^{-4} \\\\ -5.0 \\times 10^{-5}  3.0 \\times 10^{-4} \\end{pmatrix} $$\n\n对于单元 $T^{-} = \\triangle BDC$，其顶点为 $B(1,0)$、$D(1,1)$ 和 $C(0,1)$，我们再次设 $u_h(x,y) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}x \\\\ y\\end{pmatrix}$。我们求解一个线性方程组：\n$u_h(C) = u_h(0,1) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}0 \\\\ 1\\end{pmatrix}$\n$u_h(B) = u_h(1,0) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}$\n$u_h(D) = u_h(1,1) = \\mathbf{a} + \\mathbf{B}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix}$\n由此，我们求得 $\\mathbf{B}$ 的列为 $B_{\\cdot 1} = u_h(D) - u_h(C)$ 和 $B_{\\cdot 2} = u_h(D) - u_h(B)$。\n$B_{\\cdot 1} = \\begin{pmatrix} 9.0 \\times 10^{-5} - (-5.0 \\times 10^{-5}) \\\\ 4.7 \\times 10^{-4} - 3.0 \\times 10^{-4} \\end{pmatrix} = \\begin{pmatrix} 1.4 \\times 10^{-4} \\\\ 1.7 \\times 10^{-4} \\end{pmatrix}$。\n$B_{\\cdot 2} = \\begin{pmatrix} 9.0 \\times 10^{-5} - 1.0 \\times 10^{-4} \\\\ 4.7 \\times 10^{-4} - 2.0 \\times 10^{-4} \\end{pmatrix} = \\begin{pmatrix} -1.0 \\times 10^{-5} \\\\ 2.7 \\times 10^{-4} \\end{pmatrix}$。\n所以，$\\mathbf{B} = \\begin{pmatrix} 1.4 \\times 10^{-4}  -1.0 \\times 10^{-5} \\\\ 1.7 \\times 10^{-4}  2.7 \\times 10^{-4} \\end{pmatrix}$。\n$T^{-}$ 上的梯度为：\n$$ \\nabla u_h|_{T^{-}} = \\mathbf{B}^T = \\begin{pmatrix} 1.4 \\times 10^{-4}  1.7 \\times 10^{-4} \\\\ -1.0 \\times 10^{-5}  2.7 \\times 10^{-4} \\end{pmatrix} $$\n\n**2. 应变和应力张量**\n应变张量为 $\\varepsilon = \\frac{1}{2}(\\nabla u_h + (\\nabla u_h)^T)$。\n在 $T^{+}$ 上：\n$$ \\varepsilon^{+} = \\frac{1}{2}\\left(\\begin{pmatrix} 1.0 \\times 10^{-4}  2.0 \\times 10^{-4} \\\\ -5.0 \\times 10^{-5}  3.0 \\times 10^{-4} \\end{pmatrix} + \\begin{pmatrix} 1.0 \\times 10^{-4}  -5.0 \\times 10^{-5} \\\\ 2.0 \\times 10^{-4}  3.0 \\times 10^{-4} \\end{pmatrix}\\right) = \\begin{pmatrix} 1.0 \\times 10^{-4}  7.5 \\times 10^{-5} \\\\ 7.5 \\times 10^{-5}  3.0 \\times 10^{-4} \\end{pmatrix} $$\n迹为 $\\mathrm{tr}(\\varepsilon^{+}) = (1.0 + 3.0) \\times 10^{-4} = 4.0 \\times 10^{-4}$。\n应力张量 $\\sigma^{+} = 2\\mu\\varepsilon^{+} + \\lambda\\,\\mathrm{tr}(\\varepsilon^{+})I$：\n$$ \\sigma^{+} = 2(0.8 \\times 10^9)\\varepsilon^{+} + (1.2 \\times 10^9)(4.0 \\times 10^{-4})I $$\n$$ \\sigma^{+} = 1.6 \\times 10^9 \\begin{pmatrix} 1.0 \\times 10^{-4}  7.5 \\times 10^{-5} \\\\ 7.5 \\times 10^{-5}  3.0 \\times 10^{-4} \\end{pmatrix} + 4.8 \\times 10^5 I = \\begin{pmatrix} 1.6 \\times 10^5  1.2 \\times 10^5 \\\\ 1.2 \\times 10^5  4.8 \\times 10^5 \\end{pmatrix} + \\begin{pmatrix} 4.8 \\times 10^5  0 \\\\ 0  4.8 \\times 10^5 \\end{pmatrix} $$\n$$ \\sigma^{+} = \\begin{pmatrix} 6.4 \\times 10^5  1.2 \\times 10^5 \\\\ 1.2 \\times 10^5  9.6 \\times 10^5 \\end{pmatrix}\\,\\mathrm{Pa} $$\n\n在 $T^{-}$ 上：\n$$ \\varepsilon^{-} = \\frac{1}{2}\\left(\\begin{pmatrix} 1.4 \\times 10^{-4}  1.7 \\times 10^{-4} \\\\ -1.0 \\times 10^{-5}  2.7 \\times 10^{-4} \\end{pmatrix} + \\begin{pmatrix} 1.4 \\times 10^{-4}  -1.0 \\times 10^{-5} \\\\ 1.7 \\times 10^{-4}  2.7 \\times 10^{-4} \\end{pmatrix}\\right) = \\begin{pmatrix} 1.4 \\times 10^{-4}  8.0 \\times 10^{-5} \\\\ 8.0 \\times 10^{-5}  2.7 \\times 10^{-4} \\end{pmatrix} $$\n迹为 $\\mathrm{tr}(\\varepsilon^{-}) = (1.4 + 2.7) \\times 10^{-4} = 4.1 \\times 10^{-4}$。\n应力张量 $\\sigma^{-} = 2\\mu\\varepsilon^{-} + \\lambda\\,\\mathrm{tr}(\\varepsilon^{-})I$：\n$$ \\sigma^{-} = 2(0.8 \\times 10^9)\\varepsilon^{-} + (1.2 \\times 10^9)(4.1 \\times 10^{-4})I $$\n$$ \\sigma^{-} = 1.6 \\times 10^9 \\begin{pmatrix} 1.4 \\times 10^{-4}  8.0 \\times 10^{-5} \\\\ 8.0 \\times 10^{-5}  2.7 \\times 10^{-4} \\end{pmatrix} + 4.92 \\times 10^5 I = \\begin{pmatrix} 2.24 \\times 10^5  1.28 \\times 10^5 \\\\ 1.28 \\times 10^5  4.32 \\times 10^5 \\end{pmatrix} + \\begin{pmatrix} 4.92 \\times 10^5  0 \\\\ 0  4.92 \\times 10^5 \\end{pmatrix} $$\n$$ \\sigma^{-} = \\begin{pmatrix} 7.16 \\times 10^5  1.28 \\times 10^5 \\\\ 1.28 \\times 10^5  9.24 \\times 10^5 \\end{pmatrix}\\,\\mathrm{Pa} $$\n\n**3. 牵引力跳跃向量**\n边 $e$ 是连接 $B(1,0)$ 和 $C(0,1)$ 的线段 $\\overline{BC}$。沿该边的向量是 $C-B = (-1,1)$。一个正交向量是 $(1,1)$。对于 $T^+ = \\triangle ABC$，顶点 $A(0,0)$ 在直线 $x+y-1=0$ 的一侧，该侧满足 $x+y-10$，所以外法向指向 $x+y-1>0$ 的方向。因此，从 $T^{+}$ 出发的外法向单位向量是：\n$$ n^{+} = \\frac{1}{\\sqrt{1^2+1^2}}(1,1) = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix} $$\n牵引力跳跃定义为 $\\llbracket \\sigma(u_h)n \\rrbracket = \\sigma^{+}n^{+} + \\sigma^{-}n^{-}$。由于 $n^{-} = -n^{+}$，这简化为 $\\llbracket \\sigma(u_h)n \\rrbracket = (\\sigma^{+} - \\sigma^{-})n^{+}$。我们计算应力张量的差：\n$$ \\sigma^{+} - \\sigma^{-} = 10^5 \\left( \\begin{pmatrix} 6.4  1.2 \\\\ 1.2  9.6 \\end{pmatrix} - \\begin{pmatrix} 7.16  1.28 \\\\ 1.28  9.24 \\end{pmatrix} \\right) = 10^5 \\begin{pmatrix} -0.76  -0.08 \\\\ -0.08  0.36 \\end{pmatrix} $$\n牵引力跳跃向量 $J = \\llbracket \\sigma(u_h)n \\rrbracket$ 是：\n$$ J = 10^5 \\begin{pmatrix} -0.76  -0.08 \\\\ -0.08  0.36 \\end{pmatrix} \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix} = \\frac{10^5}{\\sqrt{2}} \\begin{pmatrix} -0.76 - 0.08 \\\\ -0.08 + 0.36 \\end{pmatrix} = \\frac{10^5}{\\sqrt{2}}\\begin{pmatrix} -0.84 \\\\ 0.28 \\end{pmatrix} $$\n由于 $\\sigma^{+}$ 和 $\\sigma^{-}$ 在各自的单元上是常数，跳跃向量 $J$ 沿边 $e$ 是常数。\n\n**4. 边范数计算**\n范数为 $\\|J\\|_{0,e} = \\left(\\int_e |J|^2 \\mathrm{d}s\\right)^{1/2}$。由于 $J$ 是常数，这简化为 $\\|J\\|_{0,e} = \\sqrt{|J|^2 \\cdot \\mathrm{length}(e)} = |J| \\sqrt{\\mathrm{length}(e)}$。\n边 $e$ 的长度为 $L_e = \\sqrt{(1-0)^2 + (0-1)^2} = \\sqrt{2}\\,\\mathrm{m}$。\n跳跃向量的欧几里得范数是：\n$$ |J| = \\left| \\frac{10^5}{\\sqrt{2}}\\begin{pmatrix} -0.84 \\\\ 0.28 \\end{pmatrix} \\right| = \\frac{10^5}{\\sqrt{2}} \\sqrt{(-0.84)^2 + (0.28)^2} = \\frac{10^5}{\\sqrt{2}} \\sqrt{0.7056 + 0.0784} = \\frac{10^5}{\\sqrt{2}} \\sqrt{0.784} $$\n分解项：$\\sqrt{0.784} = 0.28\\sqrt{10}$。\n$$ |J| = \\frac{10^5}{\\sqrt{2}} (0.28 \\sqrt{10}) = \\frac{0.28 \\times 10^5 \\times \\sqrt{10}}{\\sqrt{2}} = 0.28 \\times 10^5 \\sqrt{5}\\,\\mathrm{N}\\,\\mathrm{m}^{-2} $$\n最后，我们计算边范数：\n$$ \\|J\\|_{0,e} = |J| \\sqrt{L_e} = (0.28 \\times 10^5 \\sqrt{5}) \\sqrt{\\sqrt{2}} = 0.28 \\times 10^5 \\sqrt{5} \\sqrt[4]{2} $$\n单位是 $(\\mathrm{N}\\,\\mathrm{m}^{-2}) \\cdot \\mathrm{m}^{1/2} = \\mathrm{N}\\,\\mathrm{m}^{-3/2}$。\n\n**5. 最终数值**\n我们现在计算数值并四舍五入到四位有效数字：\n$$ \\|J\\|_{0,e} = 2.8 \\times 10^4 \\times \\sqrt{5} \\times \\sqrt[4]{2} \\approx 2.8 \\times 10^4 \\times (2.2360679...) \\times (1.1892071...) $$\n$$ \\|J\\|_{0,e} \\approx 2.8 \\times 10^4 \\times (2.6591479...) \\approx 7.445614... \\times 10^4 $$\n四舍五入到四位有效数字，我们得到 $7.446 \\times 10^4$。", "answer": "$$\\boxed{7.446 \\times 10^{4}}$$", "id": "3541963"}, {"introduction": "虽然基于残差的估计子通常关注全局误差的能量范数，但许多工程问题需要精确预测一个特定的“目标量”（Quantity of Interest, QoI），例如某个关键点的应力。对偶加权残差（Dual Weighted Residual, DWR）方法是实现此目标的强大技术。本次实践 [@problem_id:3542027] 将演示如何计算一个DWR误差指示子，它利用一个辅助的“伴随”问题的解来对原始问题的残差进行加权，从而将误差估计的重点聚焦于所选定的目标量上。", "problem": "考虑在参考网格上的一个顶点为 $(0,0)$, $(1,0)$, $(0,1)$ 的单个三角形单元 $K$ 上的均匀各向同性材料的平面应变线性弹性问题。所有量均为无量纲。设 Lamé 参数为 $\\lambda=2$ 和 $\\mu=1$。设体力为 $\\boldsymbol{b}(\\boldsymbol{x})=\\boldsymbol{0}$。Cauchy 应力由 $\\boldsymbol{\\sigma}(\\boldsymbol{u})=2\\mu\\,\\boldsymbol{\\varepsilon}(\\boldsymbol{u})+\\lambda\\,\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\boldsymbol{I}$ 定义，其中小应变张量为 $\\boldsymbol{\\varepsilon}(\\boldsymbol{u})=\\tfrac{1}{2}(\\nabla \\boldsymbol{u}+\\nabla \\boldsymbol{u}^{\\top})$。线性动量平衡的强形式为 $-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u})=\\boldsymbol{b}$。\n\n设限制在 $K$ 上的数值位移（有限元法 (FEM) 中的主解）为二次场\n$$\n\\boldsymbol{u}_h(x,y)=\\begin{pmatrix}x^2+xy\\\\ y^2+xy\\end{pmatrix}.\n$$\n对于一个目标量，单元 $K$ 上的对偶加权残差 (DWR) 后验误差指示子由单元残差泛函 $R_K(\\boldsymbol{u}_h)$ 对伴随权重差的作用定义。在本问题中，取限制在 $K$ 上的伴随位移为\n$$\n\\boldsymbol{z}_h(x,y)=\\begin{pmatrix}x^2\\\\ y^2\\end{pmatrix}, \\qquad \\boldsymbol{z}_h^*(x,y)=\\begin{pmatrix}x^2+x\\\\ y^2+y\\end{pmatrix},\n$$\n使得 $\\boldsymbol{z}_h-\\boldsymbol{z}_h^*=\\begin{pmatrix}-x\\\\ -y\\end{pmatrix}$。假设单元面残差在 $\\partial K$ 上为零，因为数值面力跨面是连续的（例如，$\\boldsymbol{u}_h$ 以相同的多项式延伸到相邻单元，因此面上没有面力跳跃）。\n\n从以上定义和线性动量平衡出发，推导在 $K$ 上 $-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)$ 的表达式，并计算单元 DWR 指示子\n$$\n\\eta_K \\;=\\; R_K(\\boldsymbol{u}_h)\\big(\\boldsymbol{z}_h-\\boldsymbol{z}_h^*\\big) \\;=\\; \\int_{K} \\big(-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)-\\boldsymbol{b}\\big)\\cdot\\big(\\boldsymbol{z}_h-\\boldsymbol{z}_h^*\\big)\\,\\mathrm{d}\\Omega,\n$$\n要求结果精确（不进行四舍五入），并将最终答案表示为单个有理数。此外，请解释在使用 $P_2/P_1$ 单元（二次位移和线性压力）处理近不可压缩线性弹性问题时，对增广伴随解 $\\boldsymbol{z}_h^*$ 的一个实际选择，并说明为什么这样的选择是稳定且有效的。", "solution": "该问题要求计算一个特定三角形单元上的对偶加权残差 (DWR) 后验误差指示子，然后对在相关背景下选择增广伴随解进行概念性解释。\n\n首先，我们验证问题陈述的有效性。\n所有给定量的提取如下：\n- 单元几何形状：一个顶点为 $(0,0)$, $(1,0)$, 和 $(0,1)$ 的三角形单元 $K$。\n- 本构模型：均匀各向同性材料的平面应变线性弹性。\n- Lamé 参数：$\\lambda=2$, $\\mu=1$。\n- 体力：$\\boldsymbol{b}(\\boldsymbol{x})=\\boldsymbol{0}$。\n- 应力-应变关系：$\\boldsymbol{\\sigma}(\\boldsymbol{u})=2\\mu\\,\\boldsymbol{\\varepsilon}(\\boldsymbol{u})+\\lambda\\,\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\boldsymbol{I}$。\n- 应变-位移关系：$\\boldsymbol{\\varepsilon}(\\boldsymbol{u})=\\tfrac{1}{2}(\\nabla \\boldsymbol{u}+\\nabla \\boldsymbol{u}^{\\top})$。\n- 动量平衡 (强形式)：$-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u})=\\boldsymbol{b}$。\n- $K$ 上的数值位移场：$\\boldsymbol{u}_h(x,y)=\\begin{pmatrix}x^2+xy\\\\ y^2+xy\\end{pmatrix}$。\n- $K$ 上的伴随位移场：$\\boldsymbol{z}_h(x,y)=\\begin{pmatrix}x^2\\\\ y^2\\end{pmatrix}$ 和 $\\boldsymbol{z}_h^*(x,y)=\\begin{pmatrix}x^2+x\\\\ y^2+y\\end{pmatrix}$。\n- 伴随权重：$\\boldsymbol{z}_h-\\boldsymbol{z}_h^*=\\begin{pmatrix}-x\\\\ -y\\end{pmatrix}$。\n- 假设：单元面残差为零。\n- DWR 指示子公式：$\\eta_K = \\int_{K} \\big(-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)-\\boldsymbol{b}\\big)\\cdot\\big(\\boldsymbol{z}_h-\\boldsymbol{z}_h^*\\big)\\,\\mathrm{d}\\Omega$。\n\n该问题在科学上基于有限元方法和线性弹性理论。它是适定的，因为所有函数和参数都已明确定义，从而可以得到积分的唯一值。问题陈述是客观的，不包含任何矛盾或计算所需的缺失信息。该问题被认为是有效的。\n\n我们继续求解，求解过程包括两部分。\n\n第 1 部分：DWR 指示子 $\\eta_K$ 的计算。\n\nDWR 指示子由下式给出\n$$\n\\eta_K \\;=\\; \\int_{K} \\big(-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)-\\boldsymbol{b}\\big)\\cdot\\big(\\boldsymbol{z}_h-\\boldsymbol{z}_h^*\\big)\\,\\mathrm{d}\\Omega.\n$$\n已知 $\\boldsymbol{b} = \\boldsymbol{0}$ 且 $\\boldsymbol{z}_h-\\boldsymbol{z}_h^* = \\begin{pmatrix}-x \\\\ -y\\end{pmatrix}$，该表达式简化为\n$$\n\\eta_K \\;=\\; \\int_{K} \\big(-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)\\big)\\cdot\\begin{pmatrix}-x\\\\ -y\\end{pmatrix}\\,\\mathrm{d}\\Omega \\;=\\; \\int_{K} \\big(\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)\\big)\\cdot\\begin{pmatrix}x\\\\ y\\end{pmatrix}\\,\\mathrm{d}\\Omega.\n$$\n为计算此积分，我们必须首先计算单元内部残差 $-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)$。此计算分步进行。\n\n1.  计算位移场 $\\boldsymbol{u}_h = \\begin{pmatrix}u_x \\\\ u_y\\end{pmatrix} = \\begin{pmatrix}x^2+xy \\\\ y^2+xy\\end{pmatrix}$ 的梯度。\n    $$\n    \\nabla \\boldsymbol{u}_h = \\begin{pmatrix} \\frac{\\partial u_x}{\\partial x}  \\frac{\\partial u_x}{\\partial y} \\\\ \\frac{\\partial u_y}{\\partial x}  \\frac{\\partial u_y}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} 2x+y  x \\\\ y  2y+x \\end{pmatrix}.\n    $$\n\n2.  计算小应变张量 $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h) = \\frac{1}{2}(\\nabla \\boldsymbol{u}_h + (\\nabla \\boldsymbol{u}_h)^{\\top})$。\n    $$\n    \\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h) = \\frac{1}{2} \\left( \\begin{pmatrix} 2x+y  x \\\\ y  2y+x \\end{pmatrix} + \\begin{pmatrix} 2x+y  y \\\\ x  2y+x \\end{pmatrix} \\right) = \\frac{1}{2} \\begin{pmatrix} 4x+2y  x+y \\\\ x+y  4y+2x \\end{pmatrix} = \\begin{pmatrix} 2x+y  \\frac{1}{2}(x+y) \\\\ \\frac{1}{2}(x+y)  2y+x \\end{pmatrix}.\n    $$\n\n3.  计算应变张量的迹 $\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h))$。\n    $$\n    \\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h)) = (2x+y) + (2y+x) = 3x+3y.\n    $$\n\n4.  计算 Cauchy 应力张量 $\\boldsymbol{\\sigma}(\\boldsymbol{u}_h) = 2\\mu\\,\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h)+\\lambda\\,\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}_h))\\boldsymbol{I}$，其中 $\\mu=1$ 且 $\\lambda=2$。\n    $$\n    \\boldsymbol{\\sigma}(\\boldsymbol{u}_h) = 2(1) \\begin{pmatrix} 2x+y  \\frac{1}{2}(x+y) \\\\ \\frac{1}{2}(x+y)  2y+x \\end{pmatrix} + 2(3x+3y) \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n    $$\n    $$\n    \\boldsymbol{\\sigma}(\\boldsymbol{u}_h) = \\begin{pmatrix} 4x+2y  x+y \\\\ x+y  4y+2x \\end{pmatrix} + \\begin{pmatrix} 6x+6y  0 \\\\ 0  6x+6y \\end{pmatrix}\n    $$\n    $$\n    \\boldsymbol{\\sigma}(\\boldsymbol{u}_h) = \\begin{pmatrix} 10x+8y  x+y \\\\ x+y  10y+8x \\end{pmatrix} = \\begin{pmatrix} \\sigma_{xx}  \\sigma_{xy} \\\\ \\sigma_{yx}  \\sigma_{yy} \\end{pmatrix}.\n    $$\n\n5.  计算应力张量的散度 $\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)$。\n    $$\n    \\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h) = \\begin{pmatrix} \\frac{\\partial \\sigma_{xx}}{\\partial x} + \\frac{\\partial \\sigma_{xy}}{\\partial y} \\\\ \\frac{\\partial \\sigma_{yx}}{\\partial x} + \\frac{\\partial \\sigma_{yy}}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial}{\\partial x}(10x+8y) + \\frac{\\partial}{\\partial y}(x+y) \\\\ \\frac{\\partial}{\\partial x}(x+y) + \\frac{\\partial}{\\partial y}(10y+8x) \\end{pmatrix} = \\begin{pmatrix} 10 + 1 \\\\ 1 + 10 \\end{pmatrix} = \\begin{pmatrix} 11 \\\\ 11 \\end{pmatrix}.\n    $$\n    单元内部残差为 $-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h) = \\begin{pmatrix} -11 \\\\ -11 \\end{pmatrix}$。\n\n6.  现在，我们构造 $\\eta_K$ 的被积函数。\n    $$\n    \\text{Integrand} = \\big(-\\nabla\\cdot\\boldsymbol{\\sigma}(\\boldsymbol{u}_h)-\\boldsymbol{b}\\big)\\cdot\\big(\\boldsymbol{z}_h-\\boldsymbol{z}_h^*\\big) = \\begin{pmatrix} -11 \\\\ -11 \\end{pmatrix} \\cdot \\begin{pmatrix} -x \\\\ -y \\end{pmatrix} = 11x + 11y = 11(x+y).\n    $$\n\n7.  最后，我们在三角形单元 $K$ 上积分，该区域由 $x \\in [0, 1]$ 和 $y \\in [0, 1-x]$ 定义。\n    $$\n    \\eta_K = \\int_K 11(x+y) \\,\\mathrm{d}\\Omega = 11 \\int_{0}^{1} \\int_{0}^{1-x} (x+y) \\,\\mathrm{d}y\\,\\mathrm{d}x.\n    $$\n    计算关于 $y$ 的内层积分：\n    $$\n    \\int_{0}^{1-x} (x+y) \\,\\mathrm{d}y = \\left[ xy + \\frac{y^2}{2} \\right]_{0}^{1-x} = x(1-x) + \\frac{(1-x)^2}{2} = (x-x^2) + \\frac{1-2x+x^2}{2} = \\frac{2x-2x^2+1-2x+x^2}{2} = \\frac{1-x^2}{2}.\n    $$\n    现在，计算关于 $x$ 的外层积分：\n    $$\n    \\eta_K = 11 \\int_{0}^{1} \\frac{1-x^2}{2} \\,\\mathrm{d}x = \\frac{11}{2} \\left[ x - \\frac{x^3}{3} \\right]_{0}^{1} = \\frac{11}{2} \\left( (1 - \\frac{1^3}{3}) - 0 \\right) = \\frac{11}{2} \\left( 1 - \\frac{1}{3} \\right) = \\frac{11}{2} \\left( \\frac{2}{3} \\right) = \\frac{11}{3}.\n    $$\nDWR 指示子的精确值为 $\\frac{11}{3}$。\n\n第 2 部分：对增广伴随解 $\\boldsymbol{z}_h^*$ 的一个实际选择的解释。\n\n该问题要求为使用 $P_2/P_1$ (Taylor-Hood) 单元求解的近不可压缩线性弹性问题，给出一个对增广伴随解 $\\boldsymbol{z}_h^*$ 的实际选择。这种混合格式对位移使用连续二次 ($P_2$) 有限元，对压力使用连续线性 ($P_1$) 有限元。\n\nDWR 方法的核心思想是近似目标量 $J(\\boldsymbol{u}) - J(\\boldsymbol{u}_h)$ 的误差，该误差可以精确地表示为主问题的残差作用在伴随解的误差 $\\boldsymbol{z}-\\boldsymbol{z}_h$ 上。DWR 指示子通过用一个可计算的近似（通常是 $\\boldsymbol{z}_h^* - \\boldsymbol{z}_h$）来替换精确的伴随误差 $\\boldsymbol{z}-\\boldsymbol{z}_h$ 来近似这个值。这里，$\\boldsymbol{z}_h$ 是在与主解 $\\boldsymbol{u}_h$ 相同的空间（例如 $P_2/P_1$）中计算的伴随解，而 $\\boldsymbol{z}_h^*$ 是一个更精确的“增广”近似。\n\n通过采用分层方法可以获得一个对 $\\boldsymbol{z}_h^*$ 的实用、稳定且有效的选择。具体来说，我们使用比用于 $\\boldsymbol{u}_h$ 和 $\\boldsymbol{z}_h$ 的有限元空间更高阶的空间来求解 $\\boldsymbol{z}_h^*$。对于使用 $P_2/P_1$ 单元的主问题，增广空间的一个合适选择是 $P_3/P_2$ 格式，即对位移使用连续三次 ($P_3$) 单元，对压力使用连续二次 ($P_2$) 单元。\n\n这个选择是有效的，因为根据逼近理论，更高阶的空间为真实的（且通常是光滑的）伴随解 $\\boldsymbol{z}$ 提供了更好的局部逼近。因此，$\\boldsymbol{z}_h^*$ 是比 $\\boldsymbol{z}_h$ 更精确的 $\\boldsymbol{z}$ 的表示，使得差值 $\\boldsymbol{z}_h^* - \\boldsymbol{z}_h$ 成为真实伴随误差 $\\boldsymbol{z}-\\boldsymbol{z}_h$ 的一个良好近似。这会导出一个更精确和可靠的误差指示子 $\\eta_K$。\n\n这个选择是稳定的，因为 $P_3/P_2$ 单元对，像 $P_2/P_1$ 单元对一样，满足 Ladyzhenskaya-Babuška-Brezzi (LBB) 或 inf-sup 条件。这个条件对于近不可压缩弹性（其中 Lamé 参数 $\\lambda$ 变得非常大）的混合格式至关重要，以避免伪压力振荡和体积自锁。通过为增广伴随问题采用稳定的单元对，我们确保 $\\boldsymbol{z}_h^*$ 的计算本身是适定的，并且没有数值伪影，这对最终误差估计的质量至关重要。增广解 $\\boldsymbol{z}_h^*$ 通常是通过在单元片上求解小的局部问题来计算的，使用低阶全局解 $\\boldsymbol{z}_h$ 来提供边界条件。", "answer": "$$\n\\boxed{\\frac{11}{3}}\n$$", "id": "3542027"}, {"introduction": "最后，我们将展示局部误差指示子的最终目的：指导自适应网格细化（Adaptive Mesh Refinement, AMR）。一旦我们获得了单元级的误差指示子，就需要一个策略来决定哪些单元需要细化。本次实践 [@problem_id:3542038] 将实现广泛应用的 Dörfler 标记策略，这是一种“体追踪”（bulk-chasing）算法，它标记出对总估计误差贡献了固定比例的最小单元集。通过在一个经典的L型域问题上运行模拟，您将亲眼见证自适应过程如何有效地处理奇点并恢复最优收敛率，这是后验误差控制的一个关键优势。", "problem": "考虑在二维L形域上带有凹角的小应变线性弹性问题。设物体在平面应变条件下建模，其拉梅参数为 $\\lambda$ 和 $\\mu$，位移场 $\\mathbf{u}$ 由强形式 $-\\nabla \\cdot \\boldsymbol{\\sigma} = \\mathbf{f} \\text{ in } \\Omega$ 控制，其中 $\\boldsymbol{\\sigma} = \\lambda (\\nabla \\cdot \\mathbf{u}) \\mathbf{I} + 2 \\mu \\, \\boldsymbol{\\varepsilon}(\\mathbf{u})$ 且 $\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\tfrac{1}{2}(\\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^{\\top})$，并服从混合边界条件。在带有凹角的域中，解在角点附近表现出奇异应力状态和正则性降低的现象。采用由后验误差估计引导的自适应网格细化方法，以恢复能量范数下的最优收敛率。\n\n一种基于残差跳跃的估计子将全局误差代理划分为每个单元 $K$ 的局部指标 $\\eta_K$，在有限元法（FEM）的标准假设下，该估计子已知是可靠且高效的。一种体追踪策略选择要细化的单元，以确保在每一步中处理掉全局估计子的固定比例部分。Dörfler标记就是这样一种策略。您必须以最小基数的意义上实现此标记策略：在所有能够捕获总平方指标指定比例的单元子集中，选择元素数量最少的一个。\n\n为了在不求解线性弹性方程的情况下实现这一点，我们使用一个与凹角奇异性类别一致的标量代理（这在自适应方法的分析中被广泛采用）。具体来说，在L形域 $\\Omega = [-1,1]^2 \\setminus \\big([0,1]\\times[-1,0]\\big)$ 上，其凹角位于原点，通过以下幂律来模拟角点附近的局部指标缩放规律：\n$$\n\\eta_K \\approx c \\, \\sqrt{h_K} \\, r_K^{\\alpha - 1},\n$$\n其中 $c$ 是一个正常数（设 $c=1$），$h_K$ 是单元尺寸，$r_K$ 是从单元中心到原点的欧氏距离，$\\alpha = 0.544483736782$ 是与齐次标量椭圆模型相关的L形域奇异性指数。该代理与角点奇异性问题的残差跳跃误差估计子的行为一致，并能捕捉到必要的近角点细化偏置。\n\n您的任务是：\n- 通过将 $[-1,1]^2$ 细分为 $n_x \\times n_y$ 个相等大小的正方形，并丢弃那些中心位于被切除的正方形 $[0,1]\\times[-1,0]$ 内的单元，来构建 $\\Omega$ 上的初始均匀正方形剖分。使用 $n_x = n_y = 12$。\n- 对每个单元 $K$，使用上述代理模型计算 $r_K$ 和 $\\eta_K$。通过设置 $r_K \\leftarrow \\max(r_K, 10^{-6})$ 来避免除以零。\n- 实现最小基数的体追踪标记策略，对于给定的参数 $\\theta \\in (0,1)$，选择一个集合 $\\mathcal{M}$，使得所选单元的平方指标之和至少捕获总平方估计子的一个比例，同时被标记的单元数量尽可能少。\n- 通过将每个选定的正方形细分为四个尺寸减半的子正方形来细化标记的单元。中心落在 $\\Omega$ 之外的子单元必须被丢弃；那些在内部的子单元则在网格中替换其父单元。在细化后的网格上重新计算指标。\n- 重复标记-细化循环固定的细化步数，每次使用相同的 $\\theta$。使用 $N_{\\text{steps}} = 7$。\n- 在每一步 $k$，计算全局估计子 $E_k = \\left(\\sum_{K} \\eta_K^2\\right)^{1/2}$ 和网格中当前的单元数量 $N_k$。\n- 通过对最后五个细化步骤的 $(\\log N_k, \\log E_k)$ 进行线性拟合来估计收敛率 $p(\\theta)$，并取 $p(\\theta) = -\\text{slope}$。这近似了模型 $E(N) \\approx C N^{-p}$ 在 $N$ 较大时的收敛率。\n\n将上述内容实现在一个单一程序中，该程序评估几个 $\\theta$ 值并报告估计的收敛率。您必须确保代理模型和细化过程的数值稳定性和科学合理性。\n\n测试套件：\n- 使用以下 $\\theta$ 值：$0.15$、$0.3$、$0.5$、$0.7$、$0.9$。\n- 对于每个 $\\theta$，运行完整的细化循环并按规定计算 $p(\\theta)$。\n\n答案规范：\n- 您的程序的最终输出必须是单行文本，包含测试套件中所有 $\\theta$ 值的估计收敛率列表，按所给顺序排列。\n- 格式必须是用方括号括起来的逗号分隔列表，例如 $[p(0.15),p(0.3),p(0.5),p(0.7),p(0.9)]$。\n- 每个条目必须是一个浮点数。不需要物理单位，也不涉及角度。\n\n您的程序必须是自包含的，无需任何外部输入或文件即可运行。", "solution": "该问题为模拟一个带有角点奇异性问题的自适应网格细化（AMR）过程提供了详细的规范。验证证实了该问题在科学上是合理的、适定的，并包含了确定性实现所需的所有必要信息。这是自适应有限元方法（AFEM）领域的一个标准数值实验。\n\n核心任务是实现一个由Dörfler标记驱动的`标记-细化`循环，使用一个代理误差指标来模拟在L形域上椭圆偏微分方程解的行为。最终目标是对于不同的标记参数 $\\theta$ 值，估计全局误差估计子随单元数量变化的收敛率。\n\n**1. 域和初始网格**\n\n计算域是L形区域 $\\Omega = [-1,1]^2 \\setminus \\big([0,1]\\times[-1,0]\\big)$，其在原点 $(0,0)$ 处有一个凹角。这个角点会在椭圆边值问题解中引发奇异性，从而降低标准数值方法在均匀网格上的性能。\n\n模拟始于构建初始网格。首先将一个正方形域 $[-1,1]^2$ 剖分成 $n_x \\times n_y$ 个较小正方形组成的均匀网格，其中 $n_x = n_y = 12$。这些初始单元的边长为 $h_0 = (1 - (-1))/12 = 2/12 = 1/6$。几何中心 $(x_c, y_c)$ 位于被切除象限内（即满足 $x_c  0$ 且 $y_c  0$）的单元将被丢弃。此过程产生一个包含 $N_0 = 12^2 - 6^2 = 144 - 36 = 108$ 个正方形单元的初始网格，该网格精确地表示了域 $\\Omega$。\n\n网格中的每个单元 $K$ 由其中心坐标和边长 $h_K$ 表示。\n\n**2. 代理误差指标**\n\n我们不求解完整的线性弹性方程（这在计算上是昂贵的），而是对每个单元 $K$ 上的局部误差指标 $\\eta_K$ 使用一个代理模型。该模型旨在模拟真实误差的空间分布，该分布主要由角点奇异性主导。提供的公式为：\n$$\n\\eta_K = c \\, \\sqrt{h_K} \\, r_K^{\\alpha - 1}\n$$\n其中：\n- $c=1$ 是一个常数。\n- $h_K$ 是正方形单元 $K$ 的边长。\n- $r_K$ 是单元 $K$ 中心到凹角原点的欧氏距离。为防止可能以原点为中心的单元导致除以零， $r_K$ 被限制在一个最小值：$r_K \\leftarrow \\max(r_K, 10^{-6})$。\n- $\\alpha = 0.544483736782$ 是奇异性的强度。对于L形域上的泊松方程，角点附近的解 $u$ 具有形式 $u \\sim r^{\\alpha} \\sin(\\alpha \\phi)$，其中 $(r, \\phi)$ 是极坐标。误差集中在解的梯度较大的地方。由于 $\\alpha  1$，当 $r_K \\to 0$ 时，$r_K^{\\alpha - 1}$ 项会变得很大，从而正确地识别出奇异点附近的单元具有较大的误差贡献。\n\n**3. 自适应`标记-细化`算法**\n\n模拟的核心是一个迭代循环，该循环自适应地细化网格。对于给定的标记参数 $\\theta \\in (0,1)$，该循环运行 $N_{\\text{steps}}=7$ 次迭代。每次迭代包括四个主要步骤：计算（COMPUTE）、标记（MARK）、细化（REFINE）和记录（RECORD）。\n\n**3A. 计算（COMPUTE）**\n在步骤 $k$ 的当前网格 $\\mathcal{T}_k$ 上，我们首先使用代理公式计算每个单元 $K \\in \\mathcal{T}_k$ 的误差指标 $\\eta_K$。然后，计算总平方误差估计子，作为局部指标平方和：\n$$\nE_k^2 = \\sum_{K \\in \\mathcal{T}_k} \\eta_K^2\n$$\n\n**3B. 标记（MARK）**\n标记步骤选择网格的一个子集 $\\mathcal{M}_k \\subset \\mathcal{T}_k$进行细化。我们采用Dörfler标记（也称为体标记），其目标是细化足够数量的单元以保证总误差的减少。该策略是找到一个具有最小可能单元数（最小基数）的集合 $\\mathcal{M}_k$，满足以下标准：\n$$\n\\sum_{K \\in \\mathcal{M}_k} \\eta_K^2 \\ge \\theta E_k^2\n$$\n在算法上，这是通过以下步骤实现的：\n1. 根据所有单元的指标值 $\\eta_K$ 进行降序排序。\n2. 遍历排序后的列表，将单元添加到标记集 $\\mathcal{M}_k$ 中，并累加它们的平方指标。\n3. 一旦累加和达到目标阈值 $\\theta E_k^2$，便停止。这种贪心方法保证了我们在标记最少数量单元的同时，选择了那些误差最大的单元。\n\n**3C. 细化（REFINE）**\n$\\mathcal{M}_k$中的被标记单元被细化，而未标记的单元则被移交到下一个网格 $\\mathcal{T}_{k+1}$。对于一个正方形单元的细化过程是一个简单的四分法：\n1. 每个被标记的正方形 $K \\in \\mathcal{M}_k$ 被细分为四个相等的较小正方形（子单元），每个子单元的边长是父单元的一半。\n2. 检查每个子单元的有效性：其中心必须位于域 $\\Omega$ 内。中心位于被切除区域 $[0,1] \\times [-1,0]$ 的子单元将被丢弃。\n3. 新的网格 $\\mathcal{T}_{k+1}$ 由 $\\mathcal{T}_k$ 中未标记的单元和所有有效的新子单元的集合构成。\n\n**3D. 记录（RECORD）**\n在每一步 $k$，我们记录单元数量 $N_k = |\\mathcal{T}_k|$ 和全局误差估计子 $E_k = \\sqrt{E_k^2}$。\n\n**4. 收敛率估计**\n\nAFEM理论预测，对于一个合适的自适应策略，误差 $E$ 相对于单元数量 $N$ 的收敛应遵循幂律：\n$$\nE(N) \\approx C N^{-p}\n$$\n其中 $p$ 是收敛率。对于有奇异性的问题，均匀细化会产生次优的收敛率，但自适应细化可以恢复最优率，这与奇异性指数 $\\alpha$ 有关。对上述关系取对数，得到一个线性方程：\n$$\n\\log E \\approx \\log C - p \\log N\n$$\n这表明 $\\log E$ 关于 $\\log N$ 的图应该是一条斜率为 $-p$ 的直线。\n\n为了估计 $p$，我们对收集到的数据点 $(\\log N_k, \\log E_k)$ 进行线性回归。根据规定，我们使用最后五个细化步骤的数据（从 $k=2$ 到 $k=6$）来估计渐进率，忽略任何初始瞬态行为。计算最佳拟合线的斜率，收敛率则确定为 $p(\\theta) = -\\text{slope}$。对测试套件中的每个 $\\theta$ 值重复此整个过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements an adaptive mesh refinement simulation for an L-shaped domain\n    to estimate the convergence rate of a surrogate error estimator.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    ALPHA = 0.544483736782\n    THETAS = [0.15, 0.3, 0.5, 0.7, 0.9]\n    N_STEPS = 7\n    NX, NY = 12, 12\n    R_CLAMP = 1e-6\n\n    def is_in_domain(center):\n        \"\"\"Checks if a point is within the L-shaped domain.\"\"\"\n        x, y = center\n        # The excised region is where x > 0 and y = 0.\n        return not (x > 0 and y = 0)\n\n    def generate_initial_mesh():\n        \"\"\"Creates the initial uniform mesh on the L-shaped domain.\"\"\"\n        h_initial = 2.0 / NX\n        mesh_elements = []\n        for i in range(NX):\n            for j in range(NY):\n                xc = -1.0 + h_initial / 2.0 + i * h_initial\n                yc = -1.0 + h_initial / 2.0 + j * h_initial\n                if is_in_domain((xc, yc)):\n                    # Each element is [center_x, center_y, size]\n                    mesh_elements.append([xc, yc, h_initial])\n        return np.array(mesh_elements)\n\n    def run_simulation(theta):\n        \"\"\"\n        Runs the full mark-refine simulation for a given theta value.\n        \"\"\"\n        mesh = generate_initial_mesh()\n        log_N_E_data = []\n\n        for step in range(N_STEPS):\n            # 1. COMPUTE: Indicators and global estimator\n            if mesh.shape[0] == 0:\n                # This should not happen in a valid run, but as a safeguard.\n                if len(log_N_E_data) >= 5:\n                    break\n                else: # Not enough data points to fit\n                    return np.nan \n\n            centers = mesh[:, :2]\n            sizes = mesh[:, 2]\n            \n            r_k = np.linalg.norm(centers, axis=1)\n            r_k = np.maximum(r_k, R_CLAMP)\n            \n            eta_k = np.sqrt(sizes) * r_k**(ALPHA - 1)\n            eta_k_sq = eta_k**2\n            \n            E_k_sq = np.sum(eta_k_sq)\n            E_k = np.sqrt(E_k_sq)\n            N_k = mesh.shape[0]\n\n            # 2. RECORD: Store log-log data\n            log_N_E_data.append([np.log(N_k), np.log(E_k)])\n\n            # Stop after recording the last step's data\n            if step == N_STEPS - 1:\n                break\n\n            # 3. MARK: Dörfler marking\n            total_eta_sq = E_k_sq\n            target_sum_sq = theta * total_eta_sq\n            \n            sorted_indices = np.argsort(eta_k)[::-1]\n            sorted_eta_k_sq = eta_k_sq[sorted_indices]\n            \n            cumulative_sum_sq = np.cumsum(sorted_eta_k_sq)\n            \n            # Find the number of elements to mark\n            # np.searchsorted finds the index where target would be inserted.\n            # We need to take all elements up to and including this index.\n            num_to_mark = np.searchsorted(cumulative_sum_sq, target_sum_sq) + 1\n            \n            marked_indices = sorted_indices[:num_to_mark]\n            unmarked_indices = sorted_indices[num_to_mark:]\n\n            # 4. REFINE: Create the new mesh\n            unmarked_elements = mesh[unmarked_indices]\n            \n            newly_refined_elements = []\n            for idx in marked_indices:\n                parent_center = mesh[idx, :2]\n                parent_size = mesh[idx, 2]\n                child_size = parent_size / 2.0\n                offset = child_size / 2.0\n                \n                # Generate 4 children\n                child_centers = [\n                    parent_center + np.array([-offset, -offset]),\n                    parent_center + np.array([ offset, -offset]),\n                    parent_center + np.array([-offset,  offset]),\n                    parent_center + np.array([ offset,  offset]),\n                ]\n                \n                for child_center in child_centers:\n                    if is_in_domain(child_center):\n                        newly_refined_elements.append([child_center[0], child_center[1], child_size])\n            \n            if newly_refined_elements:\n                mesh = np.vstack((unmarked_elements, np.array(newly_refined_elements)))\n            else:\n                mesh = unmarked_elements\n        \n        # 5. ESTIMATE CONVERGENCE RATE\n        # Use the last 5 data points for linear regression\n        if len(log_N_E_data)  5:\n            return np.nan # Cannot fit with fewer than 2 points, but problem asks for 5.\n\n        last_5_data = np.array(log_N_E_data[-5:])\n        log_N = last_5_data[:, 0]\n        log_E = last_5_data[:, 1]\n        \n        # Perform linear regression: log_E = slope * log_N + intercept\n        # np.polyfit returns [slope, intercept]\n        slope, _ = np.polyfit(log_N, log_E, 1)\n        \n        # Convergence rate p = -slope\n        p_theta = -slope\n        return p_theta\n\n    # --- Main Execution ---\n    results = []\n    for theta in THETAS:\n        rate = run_simulation(theta)\n        results.append(rate)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3542038"}]}