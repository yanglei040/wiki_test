{"hands_on_practices": [{"introduction": "要真正理解非局部正则化，一个很好的起点是求解一个理想化的解析模型。本练习将通过一个一维杆的简单案例，帮助您深入了解亥姆霍兹(Helmholtz)型非局部算子是如何将一个尖锐的局部场（在此为一个阶梯函数）“平滑化”的 [@problem_id:3589075]。通过推导并求解其闭合解，您将能直观地看到材料特征长度 $\\ell$ 如何控制应变局部化的范围，并为后续更复杂的数值分析打下坚实的理论基础。", "problem": "考虑一根长度为 $L$ 的一维 (1D) 等截面杆，其占据的空间区间为 $x \\in \\left[-\\frac{L}{2}, \\frac{L}{2}\\right]$，并处于小应变运动学条件下，其中轴向应变由 $\\varepsilon(x) = \\frac{du}{dx}$ 给出，u(x) 为轴向位移。假设由于位于 $x = 0$ 中心的薄弱截面，塑性在一个半宽为 $a$ 的对称区间内发展，使得局部等效塑性应变 $q(x)$ 是一个帽形函数，\n$$\nq(x) = \\begin{cases}\n\\varepsilon_{0}, & |x| \\leq a, \\\\\n0, & a < |x| \\leq \\frac{L}{2},\n\\end{cases}\n$$\n其中参数 $L > 0$，$0 < a < \\frac{L}{2}$，且 $\\varepsilon_{0} > 0$。为对损伤驱动的局部化进行正则化，采用亥姆霍兹 (Helmholtz) 型非局部正则化来处理等效塑性应变，该正则化通过求解一个带有内禀长度尺度 $\\ell > 0$ 的二阶微分算子的滤波场 $\\bar{q}(x)$ 来定义。非局部等效塑性应变 $\\bar{q}(x)$ 通过最小化一个由梯度罚项增广的二次自由能泛函来定义，并受限于在 $x = \\pm \\frac{L}{2}$ 处的自然无通量边界条件。\n\n损伤遵循一个标准的各向同性连续介质损伤力学 (CDM) 指数演化法则，该法则由非局部等效塑性应变驱动，\n$$\nd(x) = 1 - \\exp\\left(-\\frac{\\bar{q}(x)}{\\varepsilon_{f}}\\right),\n$$\n其中 $\\varepsilon_{f} > 0$ 是一个材料参数。\n\n从非局部滤波器的变分定义和相关的欧拉-拉格朗日条件出发，推导在当前一维设定下 $\\bar{q}(x)$ 的控制常微分方程和边界条件。利用关于 $x = 0$ 的对称性，求解 $\\bar{q}(x)$，并确定杆中心 $x = 0$ 处的损伤值。将您关于 $d(0)$ 的最终答案表示为关于 $L$、$a$、$\\ell$、$\\varepsilon_{0}$ 和 $\\varepsilon_{f}$ 的单个闭式解析表达式。最终答案是无量纲的，并且必须精确给出；不要进行任何数值舍入。", "solution": "非局部等效塑性应变 $\\bar{q}(x)$ 被定义为一个由梯度罚项增广的二次泛函的最小化子。对于一维域 $x \\in \\left[-\\frac{L}{2}, \\frac{L}{2}\\right]$，该泛函 $\\mathcal{F}(\\bar{q})$ 由下式给出：\n$$\n\\mathcal{F}(\\bar{q}) = \\frac{1}{2} \\int_{-L/2}^{L/2} \\left[ (\\bar{q}(x) - q(x))^2 + \\ell^2 \\left(\\frac{d\\bar{q}}{dx}\\right)^2 \\right] dx\n$$\n提供驻值条件 $\\delta\\mathcal{F} = 0$ 的欧拉-拉格朗日方程，是通过计算 $\\mathcal{F}$ 相对于 $\\bar{q}(x)$ 的一阶变分来推导的。变分为：\n$$\n\\delta\\mathcal{F} = \\int_{-L/2}^{L/2} \\left[ (\\bar{q} - q) \\delta\\bar{q} + \\ell^2 \\frac{d\\bar{q}}{dx} \\frac{d(\\delta\\bar{q})}{dx} \\right] dx = 0\n$$\n对第二项进行分部积分，得到：\n$$\n\\int_{-L/2}^{L/2} \\ell^2 \\frac{d\\bar{q}}{dx} \\frac{d(\\delta\\bar{q})}{dx} dx = \\left[ \\ell^2 \\frac{d\\bar{q}}{dx} \\delta\\bar{q} \\right]_{-L/2}^{L/2} - \\int_{-L/2}^{L/2} \\ell^2 \\frac{d^2\\bar{q}}{dx^2} \\delta\\bar{q} \\, dx\n$$\n问题指定了自然无通量边界条件，即 $\\frac{d\\bar{q}}{dx}\\left(\\pm\\frac{L}{2}\\right) = 0$。这些条件使得边界项 $\\left[ \\ell^2 \\frac{d\\bar{q}}{dx} \\delta\\bar{q} \\right]_{-L/2}^{L/2}$ 为零。变分陈述简化为：\n$$\n\\int_{-L/2}^{L/2} \\left[ (\\bar{q} - q) - \\ell^2 \\frac{d^2\\bar{q}}{dx^2} \\right] \\delta\\bar{q} \\, dx = 0\n$$\n为使该积分对于任意变分 $\\delta\\bar{q}$ 都为零，括号内的项必须为零。这给出了控制亥姆霍兹常微分方程 (ODE)：\n$$\n\\bar{q}(x) - \\ell^2 \\frac{d^2\\bar{q}}{dx^2} = q(x)\n$$\n由于域、局部场 $q(x)$ 以及边界条件都关于 $x=0$ 对称，解 $\\bar{q}(x)$ 也必须是偶函数。因此，我们可以在半域 $x \\in \\left[0, \\frac{L}{2}\\right]$ 上求解该问题，边界条件为 $\\frac{d\\bar{q}}{dx}(0) = 0$ 和 $\\frac{d\\bar{q}}{dx}\\left(\\frac{L}{2}\\right) = 0$。\n\n该问题在半域上的两个区域内分段求解。\n区域 1：$x \\in [0, a]$，其中 $q(x) = \\varepsilon_{0}$。ODE 的通解为 $\\bar{q}_1(x) = \\varepsilon_{0} + C_1 \\cosh\\left(\\frac{x}{\\ell}\\right) + C_2 \\sinh\\left(\\frac{x}{\\ell}\\right)$。应用对称性条件 $\\frac{d\\bar{q}_1}{dx}(0) = 0$ 得出 $C_2=0$。所以，区域 1 中的解为 $\\bar{q}_1(x) = \\varepsilon_{0} + C_1 \\cosh\\left(\\frac{x}{\\ell}\\right)$。\n\n区域 2：$x \\in \\left(a, \\frac{L}{2}\\right]$，其中 $q(x) = 0$。ODE 是齐次的，通解为 $\\bar{q}_2(x) = C_3 \\cosh\\left(\\frac{x}{\\ell}\\right) + C_4 \\sinh\\left(\\frac{x}{\\ell}\\right)$。\n\n常数 $C_1$、$C_3$ 和 $C_4$ 由 $x=\\frac{L}{2}$ 处的边界条件和 $x=a$ 处的连续性条件（$\\bar{q}$ 和 $\\frac{d\\bar{q}}{dx}$ 连续）确定。\n1.  $x=\\frac{L}{2}$ 处的边界条件：$\\frac{d\\bar{q}_2}{dx}\\left(\\frac{L}{2}\\right) = 0$。\n2.  $\\bar{q}$ 在 $x=a$ 处的连续性：$\\bar{q}_1(a) = \\bar{q}_2(a)$。\n3.  $\\frac{d\\bar{q}}{dx}$ 在 $x=a$ 处的连续性：$\\frac{d\\bar{q}_1}{dx}(a) = \\frac{d\\bar{q}_2}{dx}(a)$。\n\n求解这组线性方程得到积分常数。特别是，对于 $C_1$，我们得到：\n$$\nC_1 = -\\varepsilon_0 \\frac{\\sinh\\left(\\frac{L/2 - a}{\\ell}\\right)}{\\sinh\\left(\\frac{L}{2\\ell}\\right)}\n$$\n\n在中心 $x=0$ 处的非局部等效塑性应变值为：\n$$\n\\bar{q}(0) = \\bar{q}_1(0) = \\varepsilon_{0} + C_1 \\cosh(0) = \\varepsilon_{0} + C_1\n$$\n代入推导出的 $C_1$ 表达式：\n$$\n\\bar{q}(0) = \\varepsilon_{0} - \\varepsilon_{0} \\frac{\\sinh\\left(\\frac{L-2a}{2\\ell}\\right)}{\\sinh\\left(\\frac{L}{2\\ell}\\right)} = \\varepsilon_{0} \\left[ 1 - \\frac{\\sinh\\left(\\frac{L-2a}{2\\ell}\\right)}{\\sinh\\left(\\frac{L}{2\\ell}\\right)} \\right]\n$$\n最后，杆中心的损伤 $d(0)$ 由指数演化法则给出：\n$$\nd(0) = 1 - \\exp\\left(-\\frac{\\bar{q}(0)}{\\varepsilon_{f}}\\right)\n$$\n代入 $\\bar{q}(0)$ 的表达式，即可得到最终的闭式解析表达式。", "answer": "$$\n\\boxed{1 - \\exp\\left(-\\frac{\\varepsilon_0}{\\varepsilon_f} \\left(1 - \\frac{\\sinh\\left(\\frac{L-2a}{2\\ell}\\right)}{\\sinh\\left(\\frac{L}{2\\ell}\\right)}\\right)\\right)}\n$$", "id": "3589075"}, {"introduction": "从连续介质理论到可执行的计算代码，关键一步是开发稳健的本构积分算法。本练习将引导您推导耦合塑性-损伤模型的一致性算法切线模量 $C_{\\mathrm{alg}}$ [@problem_id:3589083]。该切线模量是牛顿-拉夫逊(Newton-Raphson)迭代法实现二次收敛性的核心，对于隐式有限元求解器的效率至关重要。通过这个推导，您将掌握在考虑材料状态变量演化的同时，如何精确线性化高度非线性的本构关系。", "problem": "考虑一个承受单调拉伸载荷的小应变一维均质杆，其在时间上通过后向欧拉格式进行离散，用于有限元法（FEM）中的牛顿-拉夫逊（NR）迭代。该材料模型将各向同性率无关塑性与标量损伤耦合，并采用亥姆霍兹（Helmholtz）型非局部正则化，以塑性应变为损伤驱动变量。其基本依据是小应变运动学、通过自由能势实现的热力学一致性以及塑性流动的正交性。\n\n亥姆霍兹型非局部正则化通过一维算子定义了非局部塑性应变 $\\bar{\\varepsilon}^{p}$\n$$\n\\bar{\\varepsilon}^{p} - \\ell^{2} \\frac{\\partial^{2} \\bar{\\varepsilon}^{p}}{\\partial x^{2}} = \\varepsilon^{p},\n$$\n其中 $\\ell$ 是内禀长度尺度。假设在当前时间步 $n+1$ 时，变形状态是空间均匀的，因此亥姆霍兹方程的解简化为 $\\bar{\\varepsilon}^{p}_{n+1} = \\varepsilon^{p}_{n+1}$。\n\n亥姆霍兹简化产生了以下本构结构：\n- 自由能密度 $\\psi$ 被加法分离为一个弹性应变能和一个损伤储能，其中弹性部分取决于弹性应变 $\\varepsilon^{e} = \\varepsilon - \\varepsilon^{p}$ 和标量损伤 $d \\in [0,1)$：\n$$\n\\psi(\\varepsilon^{e}, d) = \\tfrac{1}{2} (1 - d) E \\, (\\varepsilon^{e})^{2} + W_{d}(d),\n$$\n其中 $E$ 是杨氏模量，$W_{d}(d)$ 是损伤储能函数（推导中不需要其具体形式）。\n- 有效应力（未损伤）定义为\n$$\n\\tilde{\\sigma} = \\frac{\\partial \\psi}{\\partial \\varepsilon^{e}} = E (\\varepsilon - \\varepsilon^{p}),\n$$\n柯西应力则随之表示为\n$$\n\\sigma = (1 - d) \\tilde{\\sigma}.\n$$\n- 塑性在有效应力空间中被表述，使用线性各向同性硬化变量 $\\alpha$、初始屈服应力 $\\sigma_{y0}$ 和硬化模量 $H > 0$。拉伸状态下的屈服函数为\n$$\n\\phi(\\tilde{\\sigma}, \\alpha) = \\tilde{\\sigma} - \\left(\\sigma_{y0} + H \\alpha\\right) \\le 0.\n$$\n- 关联流动法则和硬化法则为\n$$\n\\dot{\\varepsilon}^{p} = \\dot{\\lambda}, \\qquad \\dot{\\alpha} = \\dot{\\lambda},\n$$\n并满足塑性一致性条件 $\\dot{\\lambda} \\ge 0$、$\\phi \\le 0$ 和 $\\dot{\\lambda} \\, \\phi = 0$。\n- 标量损伤作为非局部塑性应变（在当前均匀假设下等于局部塑性应变）的函数进行演化，此处由指数定律指定：\n$$\nd = 1 - \\exp\\!\\left(-\\beta \\, \\varepsilon^{p}\\right),\n$$\n其中 $\\beta > 0$ 是一个材料软化参数。\n\n在时间步 $n+1$ 时，将给定的总应变记为 $\\varepsilon_{n+1}$，前一时刻的内变量记为 $\\varepsilon^{p}_{n}$ 和 $\\alpha_{n}$。假设在时间步 $n+1$ 发生塑性加载，即\n$$\nE \\left(\\varepsilon_{n+1} - \\varepsilon^{p}_{n}\\right) > \\sigma_{y0} + H \\alpha_{n}.\n$$\n使用后向欧拉法，塑性应变和硬化增量为\n$$\n\\varepsilon^{p}_{n+1} = \\varepsilon^{p}_{n} + \\Delta\\lambda, \\qquad \\alpha_{n+1} = \\alpha_{n} + \\Delta\\lambda,\n$$\n其中 $\\Delta\\lambda \\ge 0$ 是塑性乘子。\n\n从这些基本定律和定义出发，推导一维一致算法切线模量的闭式表达式\n$$\nC_{\\mathrm{alg}} = \\frac{\\partial \\sigma_{n+1}}{\\partial \\varepsilon_{n+1}},\n$$\n该模量将用于牛顿-拉夫逊迭代。表达式需明确地用材料参数 $E$、$H$、$\\beta$、$\\sigma_{y0}$ 以及状态变量 $\\varepsilon_{n+1}$、$\\varepsilon^{p}_{n}$、$\\alpha_{n}$ 表示。您必须以单个闭式解析表达式的形式给出最终答案。不要进行数值计算，也不要引入超出指定范围的新参数。推导必须考虑塑性与损伤之间的耦合，并且必须遵循上述空间均匀性的非局部正则化假设。", "solution": "本解答推导在给定耦合塑性-损伤模型下的一维一致算法切线模量 $C_{\\mathrm{alg}} = \\frac{d\\sigma_{n+1}}{d\\varepsilon_{n+1}}$。为清晰起见，除非另有说明，所有变量均指时间步 $n+1$ 的状态，总应变记为 $\\varepsilon$。\n\n由于假设塑性加载，时间步结束时必须满足塑性一致性条件：\n$$\n\\phi = \\tilde{\\sigma} - (\\sigma_{y0} + H\\alpha) = 0\n$$\n将后向欧拉更新法则代入此方程，得到关于塑性乘子增量 $\\Delta\\lambda$ 的离散残差方程：\n$$\nR(\\varepsilon, \\Delta\\lambda) = E(\\varepsilon - \\varepsilon^p_n - \\Delta\\lambda) - (\\sigma_{y0} + H(\\alpha_n + \\Delta\\lambda)) = 0\n$$\n由于该条件在塑性加载过程中持续成立，其全微分必须为零：\n$$\ndR = \\frac{\\partial R}{\\partial \\varepsilon} d\\varepsilon + \\frac{\\partial R}{\\partial \\Delta\\lambda} d\\Delta\\lambda = E \\, d\\varepsilon - (E+H) \\, d\\Delta\\lambda = 0\n$$\n由此可得塑性乘子增量与总应变增量之间的关系：\n$$\n\\frac{d\\Delta\\lambda}{d\\varepsilon} = \\frac{E}{E+H}\n$$\n柯西应力 $\\sigma = (1-d)\\tilde{\\sigma}$ 对总应变 $\\varepsilon$ 的导数可使用链式法则计算：\n$$\nC_{\\mathrm{alg}} = \\frac{d\\sigma}{d\\varepsilon} = \\frac{d(1-d)}{d\\varepsilon}\\tilde{\\sigma} + (1-d)\\frac{d\\tilde{\\sigma}}{d\\varepsilon}\n$$\n各导数项的计算如下：\n- 损伤项：$1-d = \\exp(-\\beta\\varepsilon^p)$，其中 $\\varepsilon^p = \\varepsilon^p_n + \\Delta\\lambda$。\n$$\n\\frac{d(1-d)}{d\\varepsilon} = -\\beta\\exp(-\\beta\\varepsilon^p)\\frac{d\\varepsilon^p}{d\\varepsilon} = -\\beta(1-d)\\frac{d\\Delta\\lambda}{d\\varepsilon}\n$$\n- 有效应力项：$\\tilde{\\sigma}=E(\\varepsilon-\\varepsilon^p)$。\n$$\n\\frac{d\\tilde{\\sigma}}{d\\varepsilon} = E\\left(1 - \\frac{d\\varepsilon^p}{d\\varepsilon}\\right) = E\\left(1 - \\frac{d\\Delta\\lambda}{d\\varepsilon}\\right)\n$$\n将这些导数代入 $C_{\\mathrm{alg}}$ 的表达式中，并利用已求得的 $\\frac{d\\Delta\\lambda}{d\\varepsilon}$：\n$$\nC_{\\mathrm{alg}} = \\left(-\\beta(1-d)\\frac{d\\Delta\\lambda}{d\\varepsilon}\\right)\\tilde{\\sigma} + (1-d)E\\left(1 - \\frac{d\\Delta\\lambda}{d\\varepsilon}\\right) = (1-d) \\left[ E - (E+\\beta\\tilde{\\sigma}) \\frac{d\\Delta\\lambda}{d\\varepsilon} \\right]\n$$\n$$\nC_{\\mathrm{alg}} = (1-d) \\left[ E - (E+\\beta\\tilde{\\sigma}) \\frac{E}{E+H} \\right] = (1-d)E \\frac{H - \\beta\\tilde{\\sigma}}{E+H}\n$$\n该表达式中的所有变量（$d$ 和 $\\tilde{\\sigma}$）都应取为时间步 $n+1$ 结束时的值。为了得到最终的闭式表达式，我们需要用时间步开始时的变量（$\\varepsilon$、$\\varepsilon^p_n$、$\\alpha_n$）来表示它们。从离散残差方程 $R=0$ 可以解出 $\\Delta\\lambda$，进而得到 $\\varepsilon^p_{n+1}$、$\\alpha_{n+1}$、$\\tilde{\\sigma}_{n+1}$ 和 $d_{n+1}$。将这些代入上式，即可得到最终答案。", "answer": "$$\n\\boxed{\\frac{E}{(E+H)^{2}} \\left[ H(E+H) - \\beta E\\left( H(\\varepsilon_{n+1} - \\varepsilon^{p}_{n}) + \\sigma_{y0} + H\\alpha_{n} \\right) \\right] \\exp\\left(-\\frac{\\beta}{E+H} \\left( E\\varepsilon_{n+1} + H\\varepsilon^{p}_{n} - \\sigma_{y0} - H\\alpha_{n} \\right)\\right)}\n$$", "id": "3589083"}, {"introduction": "本综合练习旨在将前面学到的概念融会贯通，构建一个完整的一维耦合塑性-损伤模拟程序。与依赖于一致性切线算子的整体（monolithic）求解策略不同，本练习将采用算子分裂或称“交错”求解格式 [@problem_id:3589093]。您将动手实现一个完整的模拟流程，包括空间离散化、局部塑性返回映射算法、以及非局部损伤方程的全局求解，从而对解决复杂多物理场问题的计算方法获得宝贵的实践经验。", "problem": "考虑一根长度为 $L$ 的一维小应变杆，承受位移控制的单调加载，其规定边界位移为 $u(0)=0$ 和 $u(L)=U(t)$，其中 $t$ 表示参数化加载斜坡的伪时间。该杆具有均匀的横截面积和均匀的弹性模量 $E$。材料表现出具有各向同性硬化的率无关一维塑性，并带有一个标量损伤变量 $d(x)\\in[0,1)$，该变量会降低刚度和屈服应力。通过一个Helmholtz型梯度损伤方程引入非局部正则化。目标是设计并实现一个算子分裂交错求解方案，该方案在一个一维网格上离散，并在载荷增量上交替更新塑性和损伤场，并报告一组测试参数集的特定响应量。\n\n从以下基本和核心定义开始：\n- 小应变运动学：轴向应变定义为 $\\varepsilon(x)=\\dfrac{du}{dx}$，并且在此问题的等应变（Voigt）假设下，应变被认为是空间均匀的 $\\varepsilon(t)=\\dfrac{U(t)}{L}$。\n- Cauchy应力定义为 $\\sigma(x)=E(1-d(x))\\left(\\varepsilon - \\varepsilon^{p}(x)\\right)$，其中 $\\varepsilon^{p}(x)$ 是塑性应变。\n- 具有各向同性硬化的一维率无关塑性采用屈服函数 $f=\\lvert\\sigma\\rvert - \\sigma_{y}(d,\\alpha)$，其中累积塑性应变为 $\\alpha(x)$，损伤退化的屈服应力为 $\\sigma_{y}(d,\\alpha)=\\left(1-k_{d}\\,d\\right)\\left(\\sigma_{y0}+H\\,\\alpha\\right)$。此处，$\\sigma_{y0}$ 是初始屈服应力， $H$ 是各向同性硬化模量， $k_{d}\\in[0,1]$ 是塑性-损伤耦合系数。\n- 在单调拉伸下的一维相关联流动法则导致塑性应变增量 $d\\varepsilon^{p}=d\\lambda$，其中 $d\\lambda\\ge 0$ 是塑性乘子增量，累积塑性应变更新为 $d\\alpha=d\\lambda$。\n- Kuhn-Tucker条件和一致性条件确保在 $f\\le 0$ 时为弹性响应，否则进行塑性修正以强制 $f=0$。\n- 损伤的非局部正则化被设定为一个Helmholtz方程 $(\\mathcal{I}-\\ell^{2}\\,\\Delta)\\, d = \\gamma(x)\\,Y$，其齐次Neumann边界条件为 $\\dfrac{dd}{dx}(0)=0$ 和 $\\dfrac{dd}{dx}(L)=0$。此处 $\\ell$ 是内禀长度（损伤正则化长度尺度），$\\Delta$ 是拉普拉斯算子，$\\gamma(x)$ 是空间非均质性因子，而 $Y$ 是一个损伤驱动能量释放率的代理，选择为弹性应变能密度 $Y=\\dfrac{1}{2}\\,E\\,(1-d)\\left(\\varepsilon-\\varepsilon^{p}\\right)^{2}$，该密度使用最新的塑性更新和前一步的损伤进行评估，以在交错格式中保持右侧项的线性。\n\n设计一个每个载荷增量 $n\\to n+1$ 的算子分裂和交错求解方案：\n- 塑性子问题（局部，在 $x$ 上逐点）：将 $d$ 冻结在增量 $n$ 的值，计算试探应力 $\\sigma_{\\text{tr}}=E(1-d^{n})\\left(\\varepsilon^{n+1}-\\varepsilon^{p,n}\\right)$ 和单调拉伸下的试探屈服函数 $f_{\\text{tr}}=\\sigma_{\\text{tr}}-\\left(1-k_{d}\\,d^{n}\\right)\\left(\\sigma_{y0}+H\\,\\alpha^{n}\\right)$。如果 $f_{\\text{tr}}\\le 0$，则设置 $\\varepsilon^{p,n+1}=\\varepsilon^{p,n}$ 和 $\\alpha^{n+1}=\\alpha^{n}$ 以及 $\\sigma^{n+1}=\\sigma_{\\text{tr}}$。否则，通过从条件 $f=0$ 确定塑性增量 $d\\lambda$ 来强制一致性。从一致性条件推导出 $d\\lambda$ 关于 $E$、$H$、$k_{d}$、$d^{n}$、$\\sigma_{y0}$ 和当前变量的闭式表达式，并相应地更新 $\\varepsilon^{p,n+1}$、$\\alpha^{n+1}$ 和 $\\sigma^{n+1}$。\n- 损伤子问题（非局部，全局）：固定塑性变量 $\\varepsilon^{p,n+1}$ 和 $\\alpha^{n+1}$，计算驱动力 $Y^{n+1}=\\dfrac{1}{2}E(1-d^{n})\\left(\\varepsilon^{n+1}-\\varepsilon^{p,n+1}\\right)^{2}$ 并求解线性系统 $(\\mathcal{I}-\\ell^{2}\\,\\Delta)\\, d^{n+1}=\\gamma(x)\\,Y^{n+1}$，其边界条件为齐次Neumann边界条件。通过逐点投影 $d^{n+1}\\leftarrow\\max\\left(d^{n},\\min\\left(d^{n+1},d_{\\max}\\right)\\right)$ 来强制损伤的不可逆性和有界性，其中 $d_{\\max}<1$ 以避免刚度完全丧失。\n\n空间离散化和算法要求：\n- 使用 $N$ 个等距节点离散化杆， $x_{i}=i\\,\\Delta x$，其中 $i\\in\\{0,1,\\dots,N-1\\}$，$\\Delta x=\\dfrac{L}{N-1}$。使用拉普拉斯算子的有限差分离散，齐次Neumann边界条件通过镜像虚拟节点实现：\n  - 对于内部节点 $i\\in\\{1,\\dots,N-2\\}$，使用 $\\Delta d_{i}\\approx\\dfrac{d_{i-1}-2\\,d_{i}+d_{i+1}}{\\Delta x^{2}}$。\n  - 对于梯度为零的边界节点 $i=0$ 和 $i=N-1$，使用 $\\Delta d_{0}\\approx\\dfrac{2\\,(d_{1}-d_{0})}{\\Delta x^{2}}$ 和 $\\Delta d_{N-1}\\approx\\dfrac{2\\,(d_{N-2}-d_{N-1})}{\\Delta x^{2}}$。\n- 组装线性系统 $(\\mathbf{I}-\\ell^{2}\\,\\mathbf{L})\\,\\mathbf{d}^{n+1}=\\boldsymbol{\\gamma}\\odot\\mathbf{Y}^{n+1}$，其中 $\\mathbf{L}$ 是离散拉普拉斯矩阵，$\\boldsymbol{\\gamma}$ 是空间非均质性因子的向量，$\\odot$ 表示逐点乘法。\n- 使用具有 $N_{\\text{steps}}$ 个增量的加载斜坡，且 $U^{n}=\\dfrac{n}{N_{\\text{steps}}}\\,U_{\\text{final}}$，因此 $\\varepsilon^{n}=\\dfrac{U^{n}}{L}$。\n- 初始化 $\\varepsilon^{p,0}=\\mathbf{0}$、$\\alpha^{0}=\\mathbf{0}$ 和 $d^{0}=\\mathbf{0}$。在加载斜坡结束时，计算并报告：\n  - 空间平均应力 $\\overline{\\sigma}=\\dfrac{1}{N}\\sum_{i=0}^{N-1}E\\,(1-d_{i}^{N_{\\text{steps}}})\\left(\\varepsilon^{N_{\\text{steps}}}-\\varepsilon_{i}^{p,N_{\\text{steps}}}\\right)$，以帕斯卡（Pa）表示。\n  - 中点节点的损伤 $d_{\\text{mid}}=d_{i^{*}}^{N_{\\text{steps}}}$，其中 $i^{*}=\\lfloor\\dfrac{N-1}{2}\\rfloor$，以小数表示。\n  - 空间平均累积塑性应变 $\\overline{\\alpha}=\\dfrac{1}{N}\\sum_{i=0}^{N-1}\\alpha_{i}^{N_{\\text{steps}}}$，以小数表示。\n\n将上述算子分裂算法实现为一个完整、可运行的程序。您的实现必须不接受任何输入，必须直接编码以下三个测试用例，并且必须生成单行输出，该输出包含一个逗号分隔的括号三元组列表，格式为 $[\\,[\\overline{\\sigma}_{1},d_{\\text{mid},1},\\overline{\\alpha}_{1}],\\,[\\overline{\\sigma}_{2},d_{\\text{mid},2},\\overline{\\alpha}_{2}],\\,[\\overline{\\sigma}_{3},d_{\\text{mid},3},\\overline{\\alpha}_{3}]\\,]$。这三个测试用例如下：\n\n- 测试用例1（通用正常路径，均匀非均质性）：\n  - $E=2.00\\times 10^{11}\\,\\text{Pa}$，$H=1.00\\times 10^{9}\\,\\text{Pa}$，$\\sigma_{y0}=3.00\\times 10^{8}\\,\\text{Pa}$，$k_{d}=0.50$，$\\gamma_{0}=1.00\\times 10^{-10}\\,\\text{Pa}^{-1}$，$\\ell=2.00\\times 10^{-2}\\,\\text{m}$，$L=1.00\\,\\text{m}$，$U_{\\text{final}}=2.00\\times 10^{-3}\\,\\text{m}$，$N=51$，$N_{\\text{steps}}=20$，$d_{\\max}=9.90\\times 10^{-1}$，$\\gamma(x)=\\gamma_{0}$。\n- 测试用例2（边界条件检查：零硬化，近局部正则化，均匀非均质性）：\n  - $E=2.00\\times 10^{11}\\,\\text{Pa}$，$H=0.00\\,\\text{Pa}$，$\\sigma_{y0}=1.00\\times 10^{8}\\,\\text{Pa}$，$k_{d}=0.20$，$\\gamma_{0}=1.00\\times 10^{-12}\\,\\text{Pa}^{-1}$，$\\ell=1.00\\times 10^{-3}\\,\\text{m}$，$L=1.00\\,\\text{m}$，$U_{\\text{final}}=6.00\\times 10^{-4}\\,\\text{m}$，$N=21$，$N_{\\text{steps}}=30$，$d_{\\max}=9.90\\times 10^{-1}$，$\\gamma(x)=\\gamma_{0}$。\n- 测试用例3（边缘案例：强耦合及通过高斯凹口集中的非均质性）：\n  - $E=2.00\\times 10^{11}\\,\\text{Pa}$，$H=5.00\\times 10^{8}\\,\\text{Pa}$，$\\sigma_{y0}=2.50\\times 10^{8}\\,\\text{Pa}$，$k_{d}=1.00$，$\\gamma_{0}=5.00\\times 10^{-10}\\,\\text{Pa}^{-1}$，$\\ell=5.00\\times 10^{-2}\\,\\text{m}$，$L=1.00\\,\\text{m}$，$U_{\\text{final}}=1.50\\times 10^{-3}\\,\\text{m}$，$N=101$，$N_{\\text{steps}}=30$，$d_{\\max}=9.50\\times 10^{-1}$，以及 $\\gamma(x)=\\gamma_{0}\\left(1+A\\exp\\left(-\\dfrac{(x-L/2)^{2}}{2\\,w^{2}}\\right)\\right)$，其中 $A=2.00\\times 10^{1}$ and $w=5.00\\times 10^{-2}\\,\\text{m}$。\n\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔结果列表，例如 $[[\\overline{\\sigma}_{1},d_{\\text{mid},1},\\overline{\\alpha}_{1}],[\\overline{\\sigma}_{2},d_{\\text{mid},2},\\overline{\\alpha}_{2}],[\\overline{\\sigma}_{3},d_{\\text{mid},3},\\overline{\\alpha}_{3}]]$，其中 $\\overline{\\sigma}_{i}$ 必须以 $\\text{Pa}$ 为单位，而 $d_{\\text{mid},i}$ 和 $\\overline{\\alpha}_{i}$ 必须是小数（无量纲）。", "solution": "本解答旨在阐明实现问题中所述的算子分裂数值方案所需的关键推导和算法步骤。该方案在每个载荷增量中交替求解一个局部的塑性子问题和一个非局部的损伤子问题。\n\n对于从伪时间步 $n$ 到 $n+1$ 的每个载荷增量，总施加应变是均匀的，由 $\\varepsilon^{n+1} = \\frac{(n+1) U_{\\text{final}}}{N_{\\text{steps}} L}$ 给出。对每个空间节点 $i$ 的状态变量（$\\varepsilon^{p,n+1}_i$, $\\alpha^{n+1}_i$ 和 $d^{n+1}_i$）进行更新。\n\n#### 1. 塑性子问题（局部更新）\n\n对于每个节点 $i$，我们将损伤变量固定在其上一步的值 $d_i^n$ 来确定塑性更新。\n首先，计算试探弹性应力：\n$$ \\sigma_{\\text{tr},i}^{n+1} = E(1-d_i^n)(\\varepsilon^{n+1} - \\varepsilon_i^{p,n}) $$\n该增量开始时的屈服应力为：\n$$ \\sigma_{y,i}^n = (1-k_d d_i^n)(\\sigma_{y0} + H \\alpha_i^n) $$\n对于单调拉伸，试探屈服函数为 $f_{\\text{tr},i} = \\sigma_{\\text{tr},i}^{n+1} - \\sigma_{y,i}^n$。\n\n- 如果 $f_{\\text{tr},i} \\le 0$，该步是弹性的，塑性状态变量不变。\n- 如果 $f_{\\text{tr},i} > 0$，发生塑性流动。我们需求解塑性乘子增量 $d\\lambda_i$ 以强制在步骤结束时满足一致性条件 $f_i^{n+1}=0$。\n\n更新后的状态变量为：\n$$ \\varepsilon_i^{p,n+1} = \\varepsilon_i^{p,n} + d\\lambda_i, \\quad \\alpha_i^{n+1} = \\alpha_i^{n} + d\\lambda_i $$\n步骤结束时的应力和屈服应力为：\n$$ \\sigma_i^{n+1} = E(1-d_i^n)(\\varepsilon^{n+1} - \\varepsilon_i^{p,n+1}) = \\sigma_{\\text{tr},i}^{n+1} - E(1-d_i^n)d\\lambda_i $$\n$$ \\sigma_{y,i}^{n+1} = (1-k_d d_i^n)(\\sigma_{y0} + H \\alpha_i^{n+1}) = \\sigma_{y,i}^n + (1-k_d d_i^n)H d\\lambda_i $$\n一致性条件 $\\sigma_i^{n+1} = \\sigma_{y,i}^{n+1}$ 给出了 $d\\lambda_i$ 的闭式解：\n$$ \\sigma_{\\text{tr},i}^{n+1} - \\sigma_{y,i}^n = [E(1-d_i^n) + H(1-k_d d_i^n)] d\\lambda_i $$\n$$ d\\lambda_i = \\frac{f_{\\text{tr},i}}{E(1-d_i^n) + H(1-k_d d_i^n)} $$\n\n#### 2. 损伤子问题（非局部更新）\n\n在塑性子问题更新后，我们固定 $\\varepsilon_i^{p,n+1}$ 并求解损伤场 $d_i^{n+1}$。\n首先，计算每个节点的损伤驱动能量释放率。为保持问题线性，使用上一步的损伤 $d_i^n$：\n$$ Y_i^{n+1} = \\frac{1}{2} E (1-d_i^n) (\\varepsilon^{n+1} - \\varepsilon_i^{p,n+1})^2 $$\n然后，求解离散化的Helmholtz方程：\n$$ (\\mathbf{I} - \\ell^2 \\mathbf{L}) \\mathbf{d}^{n+1} = \\boldsymbol{\\gamma} \\odot \\mathbf{Y}^{n+1} $$\n其中 $\\mathbf{I}$ 是单位矩阵，$\\mathbf{L}$ 是问题中定义的离散拉普拉斯矩阵，$\\odot$ 是逐元素乘积。$\\boldsymbol{\\gamma}$ 和 $\\mathbf{Y}^{n+1}$ 是节点上的向量。\n求解该线性系统得到 $\\mathbf{d}_{\\text{sol}}^{n+1}$。\n\n最后，通过投影来强制损伤的不可逆性和饱和度约束：\n$$ d_i^{n+1} = \\max(d_i^n, \\min(d_{\\text{sol},i}^{n+1}, d_{\\max})) $$\n\n通过在每个载荷增量中重复执行这两个步骤，即可完成整个模拟。提供的Python代码实现了这一算法。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print results.\n    \"\"\"\n\n    test_cases = [\n        {\n            # Test case 1 (general happy path, uniform heterogeneity)\n            \"E\": 2.00e11, \"H\": 1.00e9, \"sigma_y0\": 3.00e8, \"k_d\": 0.50,\n            \"gamma_0\": 1.00e-10, \"ell\": 2.00e-2, \"L\": 1.00, \"U_final\": 2.00e-3,\n            \"N\": 51, \"N_steps\": 20, \"d_max\": 0.99,\n            \"gamma_func\": lambda x, L, gamma_0, A, w: gamma_0\n        },\n        {\n            # Test case 2 (boundary condition check: vanishing hardening, near-local regularization, uniform heterogeneity)\n            \"E\": 2.00e11, \"H\": 0.00, \"sigma_y0\": 1.00e8, \"k_d\": 0.20,\n            \"gamma_0\": 1.00e-12, \"ell\": 1.00e-3, \"L\": 1.00, \"U_final\": 6.00e-4,\n            \"N\": 21, \"N_steps\": 30, \"d_max\": 0.99,\n            \"gamma_func\": lambda x, L, gamma_0, A, w: gamma_0\n        },\n        {\n            # Test case 3 (edge case: strong coupling and concentrated heterogeneity via a Gaussian notch)\n            \"E\": 2.00e11, \"H\": 5.00e8, \"sigma_y0\": 2.50e8, \"k_d\": 1.00,\n            \"gamma_0\": 5.00e-10, \"ell\": 5.00e-2, \"L\": 1.00, \"U_final\": 1.50e-3,\n            \"N\": 101, \"N_steps\": 30, \"d_max\": 0.95,\n            \"gamma_func\": lambda x, L, gamma_0, A, w: gamma_0 * (1 + A * np.exp(-(x - L/2)**2 / (2 * w**2))),\n            \"A\": 20.0, \"w\": 0.05\n        }\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        result = run_simulation(case)\n        all_results.append(result)\n\n    # Format the final output string as specified\n    result_strings = [f\"[{s},{d},{a}]\" for s, d, a in all_results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\ndef run_simulation(params):\n    \"\"\"\n    Executes the operator-splitting simulation for a single test case.\n    \"\"\"\n    E = params[\"E\"]\n    H = params[\"H\"]\n    sigma_y0 = params[\"sigma_y0\"]\n    k_d = params[\"k_d\"]\n    gamma_0 = params[\"gamma_0\"]\n    ell = params[\"ell\"]\n    L = params[\"L\"]\n    U_final = params[\"U_final\"]\n    N = params[\"N\"]\n    N_steps = params[\"N_steps\"]\n    d_max = params[\"d_max\"]\n    gamma_func = params[\"gamma_func\"]\n    A = params.get(\"A\", 0)\n    w = params.get(\"w\", 1)\n\n    # Spatial discretization\n    x = np.linspace(0, L, N)\n    dx = L / (N - 1)\n    \n    # Initialize state variables\n    p_strain = np.zeros(N)  # plastic strain\n    p_alpha = np.zeros(N)   # accumulated plastic strain\n    damage = np.zeros(N)    # damage\n    \n    # Construct the gamma vector\n    gamma = gamma_func(x, L, gamma_0, A, w) * np.ones(N)\n\n    # Construct the discrete Laplacian matrix L\n    L_mat = np.zeros((N, N))\n    dx2 = dx**2\n    # Interior nodes\n    for i in range(1, N - 1):\n        L_mat[i, i - 1] = 1.0 / dx2\n        L_mat[i, i] = -2.0 / dx2\n        L_mat[i, i + 1] = 1.0 / dx2\n    # Boundary nodes (Neumann)\n    L_mat[0, 0] = -2.0 / dx2\n    L_mat[0, 1] = 2.0 / dx2\n    L_mat[N - 1, N - 2] = 2.0 / dx2\n    L_mat[N - 1, N - 1] = -2.0 / dx2\n\n    # Construct the system matrix A = I - l^2 * L\n    A_mat = np.identity(N) - ell**2 * L_mat\n\n    # Load stepping loop\n    for n in range(N_steps):\n        eps_total = (n + 1) / N_steps * U_final / L\n\n        # --- Plasticity Subproblem (Local) ---\n        d_prev_step = damage.copy()\n        \n        # Trial stress and yield function (vectorized)\n        sigma_tr = E * (1 - d_prev_step) * (eps_total - p_strain)\n        sigma_y = (1 - k_d * d_prev_step) * (sigma_y0 + H * p_alpha)\n        f_tr = sigma_tr - sigma_y\n        \n        # Identify nodes that yield\n        plastic_nodes = f_tr > 0\n        \n        if np.any(plastic_nodes):\n            # Denominator for plastic multiplier increment\n            denom = E * (1 - d_prev_step[plastic_nodes]) + H * (1 - k_d * d_prev_step[plastic_nodes])\n            d_lambda = f_tr[plastic_nodes] / denom\n            \n            # Update plastic variables only for yielding nodes\n            p_strain[plastic_nodes] += d_lambda\n            p_alpha[plastic_nodes] += d_lambda\n        \n        # --- Damage Subproblem (Nonlocal) ---\n        # Damage driving force (uses d from previous step)\n        Y = 0.5 * E * (1 - d_prev_step) * (eps_total - p_strain)**2\n        \n        # Right-hand side of Helmholtz equation\n        b = gamma * Y\n        \n        # Solve for damage\n        d_sol = np.linalg.solve(A_mat, b)\n        \n        # Projection for irreversibility and max damage\n        damage = np.maximum(d_prev_step, np.minimum(d_sol, d_max))\n\n    # --- Post-processing ---\n    eps_final = U_final / L\n    sigma_final = E * (1 - damage) * (eps_final - p_strain)\n    sigma_avg = np.mean(sigma_final)\n    \n    mid_node_idx = (N - 1) // 2\n    d_mid = damage[mid_node_idx]\n    \n    alpha_avg = np.mean(p_alpha)\n\n    return sigma_avg, d_mid, alpha_avg\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3589093"}]}