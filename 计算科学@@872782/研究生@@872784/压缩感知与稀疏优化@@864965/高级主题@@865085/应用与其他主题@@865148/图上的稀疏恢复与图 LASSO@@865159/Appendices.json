{"hands_on_practices": [{"introduction": "要精通图上的稀疏恢复，首先必须熟练掌握描述图结构的基本数学工具。本练习旨在通过关注图拉普拉斯算子——一个在图信号处理和结构学习中都至关重要的核心算子——来提供基础性训练。通过为一个简单的三节点图手动构建关联矩阵 $B$ 和加权拉普拉斯算子 $L$，您将巩固对图拓扑如何转化为线性代数，以及其谱属性（特征值）如何揭示图本身重要特征的理解。", "problem": "考虑一个无向加权图，它有三个标记为 $1$、$2$ 和 $3$ 的节点，以及权重为 $2$ 的边 $(1,2)$ 和权重为 $1$ 的边 $(2,3)$。为定义关联矩阵，需为无向边选择任意方向，例如将 $(1,2)$ 定向为 $1 \\to 2$，将 $(2,3)$ 定向为 $2 \\to 3$。令 $B \\in \\mathbb{R}^{2 \\times 3}$ 表示有向关联矩阵，其中对于从源节点 $u$ 指向汇节点 $v$ 的边，其对应的行在 $u$ 列为 $-1$，在 $v$ 列为 $+1$，其他位置为零。令 $W \\in \\mathbb{R}^{2 \\times 2}$ 为边权重的对角矩阵，其中元素 $W_{ee}$ 等于边 $e$ 的权重。加权图拉普拉斯矩阵由基本关系 $L = B^{\\top} W B$ 定义。\n\n这种基于图的算子在通过全变分正则化实现的图上稀疏恢复中起着核心作用，其中图差分算子 $B$ 编码了边差分的稀疏性。它在某些图模型的推断中也扮演着重要角色，例如其精度矩阵具有拉普拉斯结构的图模型。\n\n任务：\n- 使用上述基本定义，根据给定的图和方向显式构造 $B$ 和 $L$。\n- 计算 $L$ 的所有特征值和对应的特征向量。\n- 使用 $L$ 的谱分解，计算 $L$ 的伪行列式，其定义为所有非零特征值的乘积。\n\n请将 $L$ 的伪行列式的值作为最终答案。无需四舍五入，也无需报告单位。中间步骤必须如上所述，从第一性原理出发进行充分论证。", "solution": "问题要求计算加权图拉普拉斯矩阵 $L$ 的伪行列式。求解过程分三步：首先，根据给定的图结构和定义构造拉普拉斯矩阵 $L$；其次，计算 $L$ 的特征值；第三，将非零特征值相乘计算伪行列式。\n\n首先，我们根据题目陈述构造必要的矩阵。该图有三个节点，我们标记为 $\\{1, 2, 3\\}$，以及两条边。边为 $e_1 = (1,2)$，权重 $w_1 = 2$；以及 $e_2 = (2,3)$，权重 $w_2 = 1$。题目为定义关联矩阵指定了边的方向：第一条边为 $1 \\to 2$，第二条边为 $2 \\to 3$。\n\n根据定义，对于从节点 $u$ 指向节点 $v$ 的边，有向关联矩阵 $B \\in \\mathbb{R}^{2 \\times 3}$ 的对应行在 $u$ 所在的列为 $-1$，在 $v$ 所在的列为 $+1$。\n对于边 $e_1: 1 \\to 2$，$B$ 的第一行为 $\\begin{pmatrix} -1 & 1 & 0 \\end{pmatrix}$。\n对于边 $e_2: 2 \\to 3$，$B$ 的第二行为 $\\begin{pmatrix} 0 & -1 & 1 \\end{pmatrix}$。\n组合这些行得到关联矩阵：\n$$\nB = \\begin{pmatrix} -1 & 1 & 0 \\\\ 0 & -1 & 1 \\end{pmatrix}\n$$\n$B$ 的转置是：\n$$\nB^{\\top} = \\begin{pmatrix} -1 & 0 \\\\ 1 & -1 \\\\ 0 & 1 \\end{pmatrix}\n$$\n权重矩阵 $W \\in \\mathbb{R}^{2 \\times 2}$ 是一个包含边权重的对角矩阵。权重为 $w_1 = 2$ 和 $w_2 = 1$。\n$$\nW = \\begin{pmatrix} 2 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\n加权图拉普拉斯矩阵 $L$ 定义为 $L = B^{\\top} W B$。我们计算这个乘积：\n首先，我们计算 $W B$：\n$$\nW B = \\begin{pmatrix} 2 & 0 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} -1 & 1 & 0 \\\\ 0 & -1 & 1 \\end{pmatrix} = \\begin{pmatrix} -2 & 2 & 0 \\\\ 0 & -1 & 1 \\end{pmatrix}\n$$\n接着，我们计算 $L = B^{\\top} (W B)$：\n$$\nL = B^{\\top} (W B) = \\begin{pmatrix} -1 & 0 \\\\ 1 & -1 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} -2 & 2 & 0 \\\\ 0 & -1 & 1 \\end{pmatrix} = \\begin{pmatrix} (-1)(-2) + (0)(0) & (-1)(2) + (0)(-1) & (-1)(0) + (0)(1) \\\\ (1)(-2) + (-1)(0) & (1)(2) + (-1)(-1) & (1)(0) + (-1)(1) \\\\ (0)(-2) + (1)(0) & (0)(2) + (1)(-1) & (0)(0) + (1)(1) \\end{pmatrix}\n$$\n$$\nL = \\begin{pmatrix} 2 & -2 & 0 \\\\ -2 & 3 & -1 \\\\ 0 & -1 & 1 \\end{pmatrix}\n$$\n这样就完成了构造 $L$ 的第一个任务。值得注意的是，拉普拉斯矩阵 $L$ 不依赖于我们为边选择的方向。\n\n第二个任务是计算 $L$ 的特征值。特征值 $\\lambda$ 是特征方程 $\\det(L - \\lambda I) = 0$ 的根，其中 $I$ 是 $3 \\times 3$ 的单位矩阵。\n$$\nL - \\lambda I = \\begin{pmatrix} 2-\\lambda & -2 & 0 \\\\ -2 & 3-\\lambda & -1 \\\\ 0 & -1 & 1-\\lambda \\end{pmatrix}\n$$\n我们计算行列式：\n$$\n\\det(L - \\lambda I) = (2-\\lambda) \\begin{vmatrix} 3-\\lambda & -1 \\\\ -1 & 1-\\lambda \\end{vmatrix} - (-2) \\begin{vmatrix} -2 & -1 \\\\ 0 & 1-\\lambda \\end{vmatrix}\n$$\n$$\n= (2-\\lambda)((3-\\lambda)(1-\\lambda) - 1) + 2((-2)(1-\\lambda) - 0)\n$$\n$$\n= (2-\\lambda)(\\lambda^2 - 4\\lambda + 3 - 1) + 2(-2 + 2\\lambda)\n$$\n$$\n= (2-\\lambda)(\\lambda^2 - 4\\lambda + 2) - 4 + 4\\lambda\n$$\n$$\n= 2\\lambda^2 - 8\\lambda + 4 - \\lambda^3 + 4\\lambda^2 - 2\\lambda - 4 + 4\\lambda\n$$\n$$\n= -\\lambda^3 + 6\\lambda^2 - 6\\lambda\n$$\n将特征多项式设为零以求特征值：\n$$\n-\\lambda^3 + 6\\lambda^2 - 6\\lambda = 0\n$$\n$$\n-\\lambda(\\lambda^2 - 6\\lambda + 6) = 0\n$$\n可以立即确定一个特征值为 $\\lambda_1 = 0$。这对于连通图的拉普拉斯矩阵是预料之中的；对应的特征向量是全一向量，$v_1 = \\begin{pmatrix} 1 & 1 & 1 \\end{pmatrix}^{\\top}$，因为 $L$ 的行和均为零。\n\n另外两个特征值是二次方程 $\\lambda^2 - 6\\lambda + 6 = 0$ 的根。使用二次公式 $\\lambda = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$：\n$$\n\\lambda = \\frac{6 \\pm \\sqrt{(-6)^2 - 4(1)(6)}}{2(1)} = \\frac{6 \\pm \\sqrt{36 - 24}}{2} = \\frac{6 \\pm \\sqrt{12}}{2}\n$$\n因为 $\\sqrt{12} = \\sqrt{4 \\times 3} = 2\\sqrt{3}$，所以特征值为：\n$$\n\\lambda = \\frac{6 \\pm 2\\sqrt{3}}{2} = 3 \\pm \\sqrt{3}\n$$\n因此，$L$ 的三个特征值是 $\\lambda_1 = 0$，$\\lambda_2 = 3 - \\sqrt{3}$ 和 $\\lambda_3 = 3 + \\sqrt{3}$。\n\n最后一个任务是计算 $L$ 的伪行列式，它被定义为所有非零特征值的乘积。非零特征值是 $\\lambda_2 = 3 - \\sqrt{3}$ 和 $\\lambda_3 = 3 + \\sqrt{3}$。\n伪行列式，记作 $\\det^+(L)$，为：\n$$\n\\det^+(L) = \\lambda_2 \\times \\lambda_3 = (3 - \\sqrt{3})(3 + \\sqrt{3})\n$$\n使用平方差公式 $(a-b)(a+b) = a^2 - b^2$：\n$$\n\\det^+(L) = 3^2 - (\\sqrt{3})^2 = 9 - 3 = 6\n$$\n图拉普拉斯矩阵 $L$ 的伪行列式是 $6$。", "answer": "$$\\boxed{6}$$", "id": "3478305"}, {"introduction": "在建立了基础模块之后，我们现在探讨一个主要应用：使用图LASSO从数据中学习潜在的图结构。本练习将引导您深入了解在估计的精度矩阵中诱导稀疏性的核心机制。通过使用次梯度最优性条件，从第一性原理出发解析最简单的非平凡情况（$p=2$），您将推导出 $\\ell_{1}$ 惩罚项从图中移除一条边的精确阈值，从而深刻洞察数据、模型和正则化参数之间的相互作用。", "problem": "考虑一个零均值高斯图模型，其精度矩阵为 $\\Theta \\in \\mathbb{S}_{++}^{2}$，样本协方差矩阵为 $S \\in \\mathbb{S}_{++}^{2}$，具体如下：\n$$\nS \\;=\\; \\begin{pmatrix} s_{11} & s_{12} \\\\ s_{12} & s_{22} \\end{pmatrix},\n$$\n其中 $s_{11} > 0$，$s_{22} > 0$ 且 $s_{11} s_{22} - s_{12}^{2} > 0$。图最小绝对收缩和选择算子 (Graphical LASSO) 估计量 $\\hat{\\Theta}$ 定义为以下凸优化问题的解：\n$$\n\\min_{\\Theta \\in \\mathbb{S}_{++}^{2}} \\; \\Big\\{ -\\ln \\det(\\Theta) + \\operatorname{tr}(S \\Theta) + \\lambda \\sum_{i \\neq j} |\\theta_{ij}| \\Big\\},\n$$\n其中 $\\ell_{1}$ 惩罚仅应用于非对角元素，$\\lambda \\geq 0$，且 $\\mathbb{S}_{++}^{2}$ 表示 $2 \\times 2$ 对称正定矩阵锥。\n\n仅使用第一性原理，包括目标函数的定义、矩阵对数和迹的基本性质，以及非光滑凸函数的次梯度最优性条件，对 $p=2$ 的情况执行以下操作：\n- 将 $\\Theta$ 参数化为 $\\Theta = \\begin{pmatrix} a & b \\\\ b & c \\end{pmatrix}$，且满足 $a>0$，$c>0$ 和 $ac - b^{2} > 0$。\n- 推导一阶最优性和次梯度条件，并用 $s_{11}$、$s_{12}$、$s_{22}$ 和 $\\lambda$ 显式求解最优解 $\\hat{\\Theta}$。\n- 确定最小的惩罚水平 $\\lambda_{\\mathrm{th}}$（作为 $S$ 的函数），使得对于所有 $\\lambda \\geq \\lambda_{\\mathrm{th}}$，$\\hat{\\Theta}$ 的最优非对角项恰好为零。\n\n将您的最终答案报告为用 $S$ 的元素表示的 $\\lambda_{\\mathrm{th}}$ 的单个闭式解析表达式。无需四舍五入。不涉及单位。", "solution": "问题是要找到在 $p=2$ 的情况下 Graphical LASSO 问题的最小惩罚水平 $\\lambda_{\\mathrm{th}}$，使得对于所有 $\\lambda \\geq \\lambda_{\\mathrm{th}}$，估计的精度矩阵 $\\hat{\\Theta}$ 是对角矩阵。\n\n令目标函数为 $f(\\Theta)$。我们需要在 $\\Theta \\in \\mathbb{S}_{++}^2$ 上最小化 $f(\\Theta)$。\n使用指定的参数化 $\\Theta = \\begin{pmatrix} a & b \\\\ b & c \\end{pmatrix}$ 和 $S = \\begin{pmatrix} s_{11} & s_{12} \\\\ s_{12} & s_{22} \\end{pmatrix}$，我们可以将目标函数的各项写为：\n- $\\det(\\Theta) = ac - b^2$\n- $\\operatorname{tr}(S\\Theta) = \\operatorname{tr}\\left( \\begin{pmatrix} s_{11} & s_{12} \\\\ s_{12} & s_{22} \\end{pmatrix} \\begin{pmatrix} a & b \\\\ b & c \\end{pmatrix} \\right) = s_{11}a + 2s_{12}b + s_{22}c$\n- $\\lambda \\sum_{i \\neq j} |\\theta_{ij}| = \\lambda(|\\theta_{12}| + |\\theta_{21}|) = 2\\lambda|b|$\n\n用 $a$、$b$ 和 $c$ 表示的目标函数为：\n$$ f(a, b, c) = -\\ln(ac - b^2) + s_{11}a + 2s_{12}b + s_{22}c + 2\\lambda|b| $$\n优化受约束 $a>0$，$c>0$ 和 $ac - b^2 > 0$ 的限制。由于这是一个凸优化问题，当零向量包含在目标函数的次微分中时，达到最小值。该函数关于 $a$ 和 $c$ 是可微的，但由于 $|b|$ 项的存在，关于 $b$ 只是次可微的。\n\n让我们计算偏导数和次梯度。\n$f$ 关于 $(a, b, c)$ 的次微分在最优点 $(\\hat{a}, \\hat{b}, \\hat{c})$ 必须包含 $(0, 0, 0)$。\n\n$a$ 的最优性条件是：\n$$ \\frac{\\partial f}{\\partial a} = -\\frac{c}{ac - b^2} + s_{11} = 0 $$\n$c$ 的最优性条件是：\n$$ \\frac{\\partial f}{\\partial c} = -\\frac{a}{ac - b^2} + s_{22} = 0 $$\n$b$ 的次梯度最优性条件是：\n$$ 0 \\in \\frac{\\partial f}{\\partial b} = \\frac{2b}{ac - b^2} + 2s_{12} + 2\\lambda \\partial|b| $$\n其中 $\\partial|b|$ 是绝对值函数在 $b$ 处的次微分。当 $b \\neq 0$ 时，它定义为 $\\operatorname{sgn}(b)$；当 $b=0$ 时，它定义为区间 $[-1, 1]$。令 $z \\in \\partial|b|$。$b$ 的条件可以重写为：\n$$ \\frac{b}{ac - b^2} + s_{12} + \\lambda z = 0 $$\n这三个条件必须在最优解 $\\hat{\\Theta} = \\begin{pmatrix} \\hat{a} & \\hat{b} \\\\ \\hat{b} & \\hat{c} \\end{pmatrix}$ 处成立。\n\n让我们用矩阵形式重新表达这些条件。$\\Theta$ 的逆是 $\\Theta^{-1} = \\frac{1}{ac-b^2}\\begin{pmatrix} c & -b \\\\ -b & a \\end{pmatrix}$。\n最优性条件可以写为：\n- $(\\Theta^{-1})_{11} = \\frac{c}{ac - b^2} = s_{11}$\n- $(\\Theta^{-1})_{22} = \\frac{a}{ac - b^2} = s_{22}$\n- $(\\Theta^{-1})_{12} = \\frac{-b}{ac - b^2} = s_{12} + \\lambda z$\n这可以紧凑地概括为 $\\Theta^{-1} = S + \\Lambda$，其中 $\\Lambda = \\begin{pmatrix} 0 & \\lambda z \\\\ \\lambda z & 0 \\end{pmatrix}$ 且 $z \\in \\partial|b|$。\n\n我们想找到阈值 $\\lambda_{\\mathrm{th}}$，使得对于任何 $\\lambda \\geq \\lambda_{\\mathrm{th}}$，最优非对角元素 $\\hat{b}$ 为零。让我们假设 $\\hat{b} = 0$。\n如果 $\\hat{b} = 0$，精度矩阵是对角的：$\\hat{\\Theta} = \\begin{pmatrix} \\hat{a} & 0 \\\\ 0 & \\hat{c} \\end{pmatrix}$。\n它的逆矩阵也是对角的：$\\hat{\\Theta}^{-1} = \\begin{pmatrix} 1/\\hat{a} & 0 \\\\ 0 & 1/\\hat{c} \\end{pmatrix}$。\n\n现在，我们检查这种形式是否能满足最优性条件。\n根据 $\\hat{\\Theta}^{-1}$ 对角元素上的条件：\n- $(\\hat{\\Theta}^{-1})_{11} = 1/\\hat{a} = s_{11} \\implies \\hat{a} = 1/s_{11}$\n- $(\\hat{\\Theta}^{-1})_{22} = 1/\\hat{c} = s_{22} \\implies \\hat{c} = 1/s_{22}$\n由于 $S \\in \\mathbb{S}_{++}^2$，我们有 $s_{11} > 0$ 和 $s_{22} > 0$，所以 $\\hat{a} > 0$ 且 $\\hat{c} > 0$。行列式为 $\\hat{a}\\hat{c} - \\hat{b}^2 = (s_{11}s_{22})^{-1} > 0$。所得矩阵 $\\hat{\\Theta}$ 是正定的，符合要求。\n\n现在，我们必须满足非对角元素的条件。当 $\\hat{b} = 0$ 时，条件是：\n$(\\hat{\\Theta}^{-1})_{12} = s_{12} + \\lambda z$\n由于 $\\hat{\\Theta}$ 是对角矩阵，$(\\hat{\\Theta}^{-1})_{12} = 0$。因此，条件变为：\n$0 = s_{12} + \\lambda z$\n这意味着 $z = -s_{12}/\\lambda$。\n\n根据 $\\hat{b} = 0$ 情况下次梯度的定义，我们必须有 $z \\in [-1, 1]$。\n因此，存在 $\\hat{b}=0$ 解的条件是：\n$$ -1 \\leq -\\frac{s_{12}}{\\lambda} \\leq 1 $$\n乘以 $-1$ 会反转不等号：\n$$ -1 \\leq \\frac{s_{12}}{\\lambda} \\leq 1 $$\n这等价于：\n$$ \\left| \\frac{s_{12}}{\\lambda} \\right| \\leq 1 $$\n由于 $\\lambda \\geq 0$，我们可以乘以 $\\lambda$（如果 $\\lambda=0$，不等式仅在 $s_{12}=0$ 时成立）。假设 $\\lambda>0$：\n$$ |s_{12}| \\leq \\lambda $$\n这个不等式定义了使最优解 $\\hat{\\Theta}$ 为对角矩阵（$\\hat{b}=0$）的 $\\lambda$ 值的范围。\n\n如果 $\\lambda < |s_{12}|$，那么 $|s_{12}/\\lambda| > 1$，所以不可能找到一个 $z \\in [-1, 1]$ 来满足 $z = -s_{12}/\\lambda$。在这种情况下，解不能有 $\\hat{b}=0$。\n\n因此，满足条件 $\\lambda \\geq |s_{12}|$ 的最小 $\\lambda$ 值（我们称之为 $\\lambda_{\\mathrm{th}}$）恰好是 $|s_{12}|$。对于所有 $\\lambda \\geq |s_{12}|$，最优非对角项 $\\hat{\\theta}_{12}=\\hat{b}$ 为零。\n\n阈值惩罚水平 $\\lambda_{\\mathrm{th}}$ 是诱导出稀疏性的边界值。\n$$ \\lambda_{\\mathrm{th}} = |s_{12}| $$\n这个结果是 Graphical LASSO 一个更一般性质的具体实例：对于对角线以外的元素，若最优解$\\hat{\\Theta}_{ij}$为零，则需满足$|S_{ij}| \\leq \\lambda$。因此，将特定非对角元素设置为零的阈值由样本协方差矩阵中相应项的大小决定。", "answer": "$$\n\\boxed{|s_{12}|}\n$$", "id": "3478302"}, {"introduction": "在理论模型与实际应用之间架起桥梁，通常需要强大的数值算法。本练习将我们的焦点转移到图上稀疏恢复的计算方面，要求您实现图总变差（TV）泛函的近端算子。您将运用Fenchel-Rockafellar对偶性来构建一个更易于处理的对偶问题，然后使用加速投影梯度法这一现代优化中的强大技术来求解。此练习为您在构建用于解决现实世界图信号处理任务的高效求解器方面，提供了宝贵的动手实践经验。", "problem": "给定一个有限、简单、无向图，由一个大小为 $n$ 的节点集 $\\mathcal{V}$ 和一个大小为 $m$ 的边集 $\\mathcal{E}$ 指定，每条边都有一个任意固定的方向。令 $B \\in \\mathbb{R}^{m \\times n}$ 表示有向节点-边关联矩阵，其中对于从 $i$ 指向 $j$ 的边 $e = (i,j)$，$B$ 的第 $e$ 行在第 $i$ 列为 $-1$，在第 $j$ 列为 $+1$，其他位置为 $0$。令 $W \\in \\mathbb{R}^{m \\times m}$ 为一个非负边权重的对角矩阵，其对角线元素为 $w_e > 0$。对于节点上的信号 $x \\in \\mathbb{R}^n$，各向异性图全变分 (graph-TV) 定义为 $\\|W B x\\|_1 = \\sum_{e \\in \\mathcal{E}} w_e |(B x)_e|$。\n\n对于给定的输入向量 $y \\in \\mathbb{R}^n$ 和正则化参数 $\\lambda \\ge 0$，考虑图全变分泛函的近端映射：\n$$\n\\operatorname{prox}_{\\lambda \\|\\cdot\\|_{\\mathrm{graph-TV}}}(y) \\triangleq \\underset{x \\in \\mathbb{R}^n}{\\arg\\min}\\ \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\|W B x\\|_1.\n$$\n您的任务是：\n\n- 从标准凸对偶性和作为支撑函数的 $\\ell_1$ 范数定义出发，推导出一个对偶公式，其最大化变量 $q \\in \\mathbb{R}^m$ 被约束在半径为 $1$ 的 $\\ell_{\\infty}$ 球内，即 $\\|q\\|_{\\infty} \\le 1$。然后解释如何通过对 $\\ell_{\\infty}$ 球进行简单的逐坐标投影来实现对偶问题上的投影梯度法，以及这如何通过 $x^{\\star} = y - \\lambda B^{\\top} W q^{\\star}$ 高效地评估近端映射。\n\n- 实现将任意边差分向量 $v \\in \\mathbb{R}^m$ 投影到半径为 $1$ 的 $\\ell_{\\infty}$ 球上的操作，即实现投影映射 $P_{\\infty}(v) = \\underset{\\|q\\|_{\\infty} \\le 1}{\\arg\\min}\\ \\|q - v\\|_2^2$，并在对偶问题上使用加速投影梯度法来计算 $x^{\\star} = \\operatorname{prox}_{\\lambda \\|\\cdot\\|_{\\mathrm{graph-TV}}}(y)$。\n\n- 您的推导应基于以下基本事实：$\\ell_1$ 范数的 Fenchel 共轭是单位 $\\ell_{\\infty}$ 球的指示函数；用于与线性算子复合的凸函数的 Fenchel–Rockafellar 对偶性；以及向 $\\ell_{\\infty}$ 球的投影是通过逐坐标裁剪完成的。\n\n您的程序必须实现所述算法，并在以下测试套件上进行评估。对于每个测试用例，通过对偶投影梯度法计算原始解 $x^{\\star}$，步长为恒定步长，该步长基于对偶梯度 Lipschitz 常数的幂迭代估计自动选择。然后，为每个测试用例报告两个浮点数：\n- 对偶间隙 $g = f(x^{\\star}) - d(q)$，其中 $f(x) = \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\|W B x\\|_1$ 且 $d(q)$ 是在最终对偶迭代变量 $q$ 处的对偶目标值，必须满足 $g \\ge 0$。\n- 一个 Karush–Kuhn–Tucker (KKT) 违背度度量，定义为两个量的最大值：$\\ell_{\\infty}$ 球可行性违背 $\\max(0, \\|q\\|_{\\infty} - 1)$ 和在 $W B x^{\\star}$ 支撑集上的次梯度一致性违背，即对于固定阈值 $\\varepsilon = 10^{-8}$，$\\max_{e:\\ |(W B x^{\\star})_e| > \\varepsilon} |q_e - \\operatorname{sign}((W B x^{\\star})_e)|$。\n\n测试套件（所有边都是无向的，但假设给定方向为从每对中的第一个节点到第二个节点，所有权重按列出的顺序对应于边）：\n- 情况 1（正常路径）：$n = 5$，$\\mathcal{E} = \\{(0,1),(1,2),(2,3),(3,4)\\}$，$w = [1,1,1,1]$，$y = [1.0, -0.5, 0.3, 2.0, -1.2]$，$\\lambda = 0.7$。\n- 情况 2（边界情况 $\\lambda = 0$）：$n = 5$，$\\mathcal{E} = \\{(0,1),(1,2),(2,3),(3,4)\\}$，$w = [1,1,1,1]$，$y = [0.2, -0.1, 0.0, 0.3, -0.4]$，$\\lambda = 0.0$。\n- 情况 3（具有异构权重的不连通分量）：$n = 6$，$\\mathcal{E} = \\{(0,1),(2,3),(3,4)\\}$，$w = [1.0, 0.5, 2.0]$，$y = [-1.0, 0.0, 2.5, -2.0, 0.7, 1.3]$，$\\lambda = 0.6$。\n- 情况 4（星形图，强正则化）：$n = 6$，$\\mathcal{E} = \\{(0,1),(0,2),(0,3),(0,4),(0,5)\\}$，$w = [1,1,1,1,1]$，$y = [3.0, -1.0, 0.5, -0.5, 2.0, -2.0]$，$\\lambda = 5.0$。\n\n实现细节：\n- 使用变量为 $q \\in \\mathbb{R}^m$ 且受 $\\|q\\|_{\\infty} \\le 1$ 约束的对偶公式。\n- 令 $A = W B B^{\\top} W \\in \\mathbb{R}^{m \\times m}$ 和 $b = W B y \\in \\mathbb{R}^m$。用于最小化的光滑对偶目标函数为 $h(q) = \\frac{1}{2}\\lambda^2 q^{\\top} A q - \\lambda b^{\\top} q$。其梯度为 $\\nabla h(q) = \\lambda^2 A q - \\lambda b$。使用步长为 $1/L$ 的加速投影梯度法，其中 $L$ 是 $\\nabla h$ 的 Lipschitz 常数的估计值，等于 $\\lambda^2 \\|A\\|_2$。使用 50 步幂迭代和 $10^{-10}$ 的相对容差来估计 $\\|A\\|_2$。\n- 向半径为 $1$ 的 $\\ell_{\\infty}$ 球的投影是逐坐标裁剪 $P_{\\infty}(v)_e = \\min\\{\\max\\{v_e,-1\\},1\\}$，对于每个坐标 $e \\in \\{1,\\dots,m\\}$。\n- 计算完 $q$ 后，恢复 $x^{\\star} = y - \\lambda B^{\\top} W q$。\n\n您的程序应按指定顺序为四个测试用例输出一行，包含一个包含 8 个浮点数的扁平列表，顺序如下：$[g_1, k_1, g_2, k_2, g_3, k_3, g_4, k_4]$，其中 $g_i$ 是对偶间隙，$k_i$ 是情况 $i$ 的 KKT 违背度。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[0.001,0.0,0.0,0.0,0.002,0.0001,0.0,0.0]$）。所有数值都是无单位的实数。", "solution": "### 对偶公式推导\n\n原始问题是找到图全变分泛函的近端映射，由下式给出：\n$$\nx^{\\star} = \\underset{x \\in \\mathbb{R}^n}{\\arg\\min}\\ \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\|W B x\\|_1\n$$\n我们可以通过 $\\ell_1$ 范数的对偶表示来推导其对偶问题。向量 $z \\in \\mathbb{R}^m$ 的 $\\ell_1$ 范数可以写成：\n$$\n\\|z\\|_1 = \\sup_{\\|q\\|_{\\infty} \\le 1} q^{\\top} z\n$$\n其中 $\\|q\\|_{\\infty} = \\max_e |q_e|$ 是 $\\ell_{\\infty}$ 范数。将此代入原始目标函数，我们得到一个最小最大问题：\n$$\n\\min_{x \\in \\mathbb{R}^n} \\left( \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\sup_{\\|q\\|_{\\infty} \\le 1} q^{\\top} (W B x) \\right) = \\min_{x \\in \\mathbb{R}^n} \\sup_{\\|q\\|_{\\infty} \\le 1} \\left( \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda q^{\\top} W B x \\right)\n$$\n由于目标函数在 $x$ 上是凸的，在 $q$ 上是线性的（因此是凹的），并且定义域是凸的，根据 Sion 的最小最大定理，我们可以交换 `min` 和 `max` 算子：\n$$\n\\max_{\\|q\\|_{\\infty} \\le 1} \\min_{x \\in \\mathbb{R}^n} \\mathcal{L}(x, q) \\quad \\text{其中} \\quad \\mathcal{L}(x, q) = \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda q^{\\top} W B x\n$$\n为了找到对偶目标，我们首先针对固定的 $q$ 求解关于 $x$ 的内部最小化问题。函数 $\\mathcal{L}(x, q)$ 是二次的且在 $x$ 上是严格凸的。我们通过将其关于 $x$ 的梯度设为零来找到其最小值：\n$$\n\\nabla_x \\mathcal{L}(x, q) = (x - y) + (\\lambda q^{\\top} W B)^{\\top} = (x - y) + \\lambda B^{\\top} W^{\\top} q = 0\n$$\n由于 $W$ 是对角矩阵，所以 $W^{\\top} = W$。唯一的最小化子 $x^{\\star}(q)$ 是：\n$$\nx^{\\star}(q) = y - \\lambda B^{\\top} W q\n$$\n这个方程提供了从最优对偶解 $q^{\\star}$ 恢复最优原始解 $x^{\\star}$ 的关系。\n\n将 $x^{\\star}(q)$ 代回 $\\mathcal{L}(x, q)$ 得到对偶目标函数 $d(q)$：\n$$\nd(q) = \\frac{1}{2}\\|(y - \\lambda B^{\\top} W q) - y\\|_2^2 + \\lambda q^{\\top} W B (y - \\lambda B^{\\top} W q)\n$$\n$$\nd(q) = \\frac{\\lambda^2}{2} q^{\\top} W B B^{\\top} W q + \\lambda (W B y)^{\\top} q - \\lambda^2 q^{\\top} W B B^{\\top} W q\n$$\n$$\nd(q) = \\lambda (W B y)^{\\top} q - \\frac{\\lambda^2}{2} q^{\\top} (W B B^{\\top} W) q\n$$\n对偶问题是在约束集上最大化 $d(q)$。这等价于最小化 $-d(q)$。我们定义凸函数 $h(q) = -d(q)$：\n$$\nh(q) = \\frac{\\lambda^2}{2} q^{\\top} (W B B^{\\top} W) q - \\lambda (W B y)^{\\top} q\n$$\n然后，对偶问题被表述为：\n$$\nq^{\\star} = \\underset{q \\in \\mathbb{R}^m}{\\arg\\min}\\ h(q) \\quad \\text{满足} \\quad \\|q\\|_{\\infty} \\le 1\n$$\n这个问题可以通过投影梯度法高效求解。\n\n### 加速投影梯度法\n\n对偶问题是在一个简单的凸集 $\\mathcal{C} = \\{q \\in \\mathbb{R}^m : \\|q\\|_{\\infty} \\le 1\\}$ 上最小化一个光滑凸函数 $h(q)$。我们将使用加速投影梯度法 (FISTA) 来求解。\n\n$h(q)$ 的梯度为 $\\nabla h(q) = \\lambda^2 (W B B^{\\top} W) q - \\lambda (W B y)$。该梯度是 Lipschitz 连续的，常数 $L = \\lambda^2 \\|W B B^{\\top} W\\|_2$ 可以通过幂迭代法估计。到单位 $\\ell_{\\infty}$ 球上的投影算子 $P_{\\mathcal{C}}(v)$ 是一个简单的逐坐标裁剪函数：$(P_{\\mathcal{C}}(v))_e = \\min(\\max(v_e, -1), 1)$。\n\nFISTA 算法从 $q_0=0, z_1=q_0, t_1=1$ 开始迭代，步长为 $\\alpha=1/L$：\n1.  计算梯度：$\\nabla h(z_k)$。\n2.  执行梯度下降步骤并投影：$q_k = P_{\\mathcal{C}}(z_k - \\alpha \\nabla h(z_k))$。\n3.  更新动量项：$t_{k+1} = \\frac{1 + \\sqrt{1 + 4t_k^2}}{2}$ 和 $z_{k+1} = q_k + \\frac{t_k - 1}{t_{k+1}}(q_k - q_{k-1})$。\n\n迭代收敛后，我们得到近似的最优对偶解 $q^{\\star}$，并用 $x^{\\star} = y - \\lambda B^{\\top} W q^{\\star}$ 恢复最优原始解。", "answer": "```python\nimport numpy as np\n\ndef build_incidence_matrix(n, edges):\n    \"\"\"Constructs the oriented node-edge incidence matrix B.\"\"\"\n    m = len(edges)\n    B = np.zeros((m, n))\n    for i, edge in enumerate(edges):\n        u, v = edge\n        B[i, u] = -1\n        B[i, v] = 1\n    return B\n\ndef power_iteration(A, num_iter=50, tol=1e-10):\n    \"\"\"Estimates the spectral norm of a symmetric matrix A.\"\"\"\n    if A.shape[0] == 0:\n        return 0.0\n    v = np.random.rand(A.shape[1])\n    if np.linalg.norm(v) == 0:\n        return 0.0\n    v = v / np.linalg.norm(v)\n    \n    eigenval_old = 0.0\n    for _ in range(num_iter):\n        Av = A @ v\n        norm_Av = np.linalg.norm(Av)\n        if norm_Av == 0:\n            return 0.0\n        v = Av / norm_Av\n        eigenval = np.dot(v, A @ v)\n        if abs(eigenval - eigenval_old)  tol * (eigenval + 1e-12):\n            break\n        eigenval_old = eigenval\n        \n    return eigenval\n\ndef solve_single_case(n, edges, w, y, lambda_, num_fista_iter=5000, kkt_eps=1e-8):\n    \"\"\"Solves the graph-TV prox problem for a single case.\"\"\"\n    m = len(edges)\n    B = build_incidence_matrix(n, edges)\n    W = np.diag(w) if m > 0 else np.zeros((0,0))\n    \n    if lambda_ == 0.0:\n        x_star = y\n        q = np.zeros(m)\n        gap = 0.0\n        kkt_violation = 0.0\n        return gap, kkt_violation\n\n    # FISTA for lambda > 0\n    A = W @ B @ B.T @ W\n    b = W @ B @ y\n    lambda_b = lambda_ * b\n\n    L_A = power_iteration(A)\n    L = lambda_**2 * L_A\n    alpha = 1.0 / L if L > 1e-15 else 1.0\n\n    q = np.zeros(m)\n    z = np.zeros(m)\n    t = 1.0\n    \n    for _ in range(num_fista_iter):\n        q_prev = q\n        grad_h_z = lambda_**2 * (A @ z) - lambda_b\n        q_next = z - alpha * grad_h_z\n        q_next = np.clip(q_next, -1.0, 1.0)\n\n        t_next = (1.0 + np.sqrt(1.0 + 4.0 * t**2)) / 2.0\n        z = q_next + ((t - 1.0) / t_next) * (q_next - q_prev)\n        \n        q = q_next\n        t = t_next\n    \n    x_star = y - lambda_ * B.T @ W @ q\n    \n    WBx_star = W @ B @ x_star\n    f_x_star = 0.5 * np.linalg.norm(x_star - y)**2 + lambda_ * np.linalg.norm(WBx_star, 1)\n\n    d_q = lambda_b.T @ q - 0.5 * lambda_**2 * q.T @ A @ q\n    \n    gap = f_x_star - d_q\n    \n    feasibility_viol = max(0.0, np.max(np.abs(q)) - 1.0)\n    \n    active_set = np.abs(WBx_star) > kkt_eps\n    if np.any(active_set):\n        consistency_viol = np.max(np.abs(q[active_set] - np.sign(WBx_star[active_set])))\n    else:\n        consistency_viol = 0.0\n        \n    kkt_violation = max(feasibility_viol, consistency_viol)\n    \n    return gap, kkt_violation\n\ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    test_cases = [\n        (5, [(0, 1), (1, 2), (2, 3), (3, 4)], np.array([1.0, 1.0, 1.0, 1.0]), np.array([1.0, -0.5, 0.3, 2.0, -1.2]), 0.7),\n        (5, [(0, 1), (1, 2), (2, 3), (3, 4)], np.array([1.0, 1.0, 1.0, 1.0]), np.array([0.2, -0.1, 0.0, 0.3, -0.4]), 0.0),\n        (6, [(0, 1), (2, 3), (3, 4)], np.array([1.0, 0.5, 2.0]), np.array([-1.0, 0.0, 2.5, -2.0, 0.7, 1.3]), 0.6),\n        (6, [(0, 1), (0, 2), (0, 3), (0, 4), (0, 5)], np.array([1.0, 1.0, 1.0, 1.0, 1.0]), np.array([3.0, -1.0, 0.5, -0.5, 2.0, -2.0]), 5.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        n, edges, w, y, lambda_ = case\n        gap, kkt_viol = solve_single_case(n, edges, w, y, lambda_)\n        results.extend([gap, kkt_viol])\n\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```", "id": "3478308"}]}