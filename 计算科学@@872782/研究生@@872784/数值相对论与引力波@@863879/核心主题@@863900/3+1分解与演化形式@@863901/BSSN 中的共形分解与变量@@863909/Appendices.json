{"hands_on_practices": [{"introduction": "BSSN 形式主义始于对空间度规的共形分解。本练习提供了一个直接的实践机会，将该分解的定义关系应用于一个具体示例 [@problem_id:3468149]。通过从第一性原理出发推导共形因子 $\\phi$ 和共形度规 $\\tilde{\\gamma}_{ij}$，您将巩固对支撑整个 BSSN 系统的基本代数结构的理解。", "problem": "您正在研究广义相对论 $3+1$ 分解框架下的 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 共形分解。BSSN 变量是通过对空间度规进行共形重缩放来定义的，其中物理空间度规 $ \\gamma_{ij} $ 分解为\n$$\n\\gamma_{ij} = \\exp\\!\\left(4 \\phi\\right)\\,\\tilde{\\gamma}_{ij},\n$$\n并满足单位行列式条件\n$$\n\\det\\!\\left(\\tilde{\\gamma}_{ij}\\right) = 1.\n$$\n考虑一个笛卡尔坐标系中的时间切片，其空间度规为\n$$\n\\gamma_{ij} = \n\\begin{pmatrix}\n4  1  0 \\\\\n1  2  0 \\\\\n0  0  3\n\\end{pmatrix}.\n$$\n请从上述核心定义出发，在不使用这些定义和基础线性代数之外的任何额外公式的情况下，对该 $ \\gamma_{ij} $ 进行 BSSN 共形分解：\n- 从第一性原理出发，利用这两个定义关系推导出 $ \\phi $。\n- 显式地计算 $ \\tilde{\\gamma}_{ij} $。\n- 验证单位行列式条件 $ \\det(\\tilde{\\gamma}_{ij}) = 1 $ 成立。\n\n在适当的地方使用符号进行精确计算，不要进行近似。将最终答案表示为 $ \\phi $ 的简化解析表达式。无需数值舍入，且由于 $ \\phi $ 是无量纲的，不涉及任何单位。", "solution": "BSSN 共形分解由以下两个关系定义：\n$$\n\\gamma_{ij} = \\exp\\!\\left(4 \\phi\\right)\\,\\tilde{\\gamma}_{ij}, \\qquad \\det\\!\\left(\\tilde{\\gamma}_{ij}\\right) = 1.\n$$\n我们首先对分解式两边取行列式。利用行列式的乘法性质以及对于一个标量 $ a $ 和一个 $ 3 \\times 3 $ 矩阵 $ M $，有 $ \\det(a M) = a^{3} \\det(M) $ 这一事实，我们得到\n$$\n\\det(\\gamma_{ij}) = \\det\\!\\left(\\exp\\!\\left(4 \\phi\\right)\\,\\tilde{\\gamma}_{ij}\\right) = \\exp\\!\\left(12 \\phi\\right)\\, \\det\\!\\left(\\tilde{\\gamma}_{ij}\\right).\n$$\n代入单位行列式条件 $ \\det(\\tilde{\\gamma}_{ij}) = 1 $，可得\n$$\n\\det(\\gamma_{ij}) = \\exp\\!\\left(12 \\phi\\right).\n$$\n对两边取自然对数，得到\n$$\n\\phi = \\frac{1}{12}\\, \\ln\\!\\left(\\det(\\gamma_{ij})\\right).\n$$\n\n接下来需要计算给定矩阵的 $ \\det(\\gamma_{ij}) $。该矩阵是块对角矩阵，所以\n$$\n\\det(\\gamma_{ij}) = 3 \\, \\det\\!\\begin{pmatrix} 4  1 \\\\ 1  2 \\end{pmatrix} = 3 \\left(4 \\cdot 2 - 1 \\cdot 1\\right) = 3 \\cdot 7 = 21.\n$$\n因此，\n$$\n\\phi = \\frac{1}{12}\\, \\ln(21).\n$$\n\n接下来，我们计算共形度规 $ \\tilde{\\gamma}_{ij} $。根据定义关系，\n$$\n\\tilde{\\gamma}_{ij} = \\exp\\!\\left(-4 \\phi\\right)\\, \\gamma_{ij}.\n$$\n利用 $ \\exp\\!\\left(12 \\phi\\right) = \\det(\\gamma_{ij}) = 21 $，我们有\n$$\n\\exp\\!\\left(4 \\phi\\right) = \\exp\\!\\left(\\frac{4}{12} \\ln(21)\\right) = \\exp\\!\\left(\\frac{1}{3} \\ln(21)\\right) = 21^{1/3},\n$$\n所以\n$$\n\\exp\\!\\left(-4 \\phi\\right) = 21^{-1/3}.\n$$\n因此，\n$$\n\\tilde{\\gamma}_{ij} = 21^{-1/3}\n\\begin{pmatrix}\n4  1  0 \\\\\n1  2  0 \\\\\n0  0  3\n\\end{pmatrix}.\n$$\n\n最后，我们验证单位行列式条件：\n$$\n\\det(\\tilde{\\gamma}_{ij}) = \\det\\!\\left(21^{-1/3} \\gamma_{ij}\\right) = \\left(21^{-1/3}\\right)^{3} \\det(\\gamma_{ij}) = 21^{-1} \\cdot 21 = 1,\n$$\n这与要求相符。至此，分解和验证完成。所要求的 $ \\phi $ 的最终答案是精确表达式 $ \\frac{1}{12} \\ln(21) $。", "answer": "$$\\boxed{\\frac{1}{12}\\ln(21)}$$", "id": "3468149"}, {"introduction": "在理解了度规的分解之后，下一个合理的步骤是探究这种分解如何改变曲率——爱因斯坦场方程的核心组成部分。本练习将引导您通过“纸和笔”的方式，验证里奇张量的共形分解关系，这是 BSSN 演化方程的基石之一 [@problem_id:3468204]。通过证明直接的 ADM 式计算与 BSSN 分解公式的等价性，您将更深刻地体会到该形式主义如何巧妙地分离几何信息。", "problem": "考虑一个在 Arnowitt–Deser–Misner (ADM) $3+1$ 形式下的单一空间超曲面，其笛卡尔坐标为 $(x,y,z)$。采用 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 共形分解 $\\gamma_{ij} = \\exp(4 \\phi)\\,\\tilde{\\gamma}_{ij}$，其中 $\\det \\tilde{\\gamma}_{ij} = 1$。令共形度规为平直的，即 $\\tilde{\\gamma}_{ij}(x) = \\delta_{ij}$，并令共形因子为解析函数 $\\phi(x,y,z) = \\alpha\\,x\\,y + \\beta\\,z^{2}$，其中 $\\alpha$ 和 $\\beta$ 为实常数。在欧几里得笛卡尔分量下进行计算，因此 $\\delta_{ij}$ 及其相关的列维-奇维塔联络被用于在共形部分中升降指标和进行协变微分。\n\n仅从度规的列维-奇维塔联络和里奇曲率的基本定义，以及共形关系 $\\gamma_{ij} = \\exp(4 \\phi)\\,\\tilde{\\gamma}_{ij}$ 出发，完成以下任务：\n\n1. 通过构建 $\\gamma_{ij}$ 的列维-奇维塔联络，并收缩由该联络定义的 Riemann 张量，直接计算里奇张量 $R_{ij}[\\gamma]$（ADM 路径）。\n2. 独立地，在 BSSN 路径中计算分解 $R_{ij} = \\tilde{R}_{ij} + R^{\\phi}_{ij}$，其中 $\\tilde{R}_{ij}$ 是由 $\\tilde{\\gamma}_{ij}$ 构建的里奇张量，而 $R^{\\phi}_{ij}$ 包含由共形因子 $\\phi$ 产生的项。\n3. 定义差张量 $\\Delta R_{ij} \\equiv R_{ij}^{\\text{ADM}} - \\left(\\tilde{R}_{ij} + R^{\\phi}_{ij}\\right)$，并在坐标为 $(x,y,z) = (1,-1,2)$ 的点 $p$ 处求值。\n4. 在点 $p$ 处计算 Frobenius 范数 $N \\equiv \\sqrt{\\gamma^{ik}\\,\\gamma^{jl}\\,\\Delta R_{ij}\\,\\Delta R_{kl}}$。\n\n将 N 的精确值报告为单个实数。无需四舍五入。最终答案以无量纲实数表示。", "solution": "该问题要求使用两种不同的方法计算给定度规 $\\gamma_{ij}$ 的里奇张量，然后求出两种结果之差的 Frobenius 范数。该度规定义在一个三维空间切片上，其笛卡尔坐标为 $(x,y,z)$，我们可以将其表示为 $(x^1, x^2, x^3)$。该度规由一个共形分解给出，$\\gamma_{ij} = \\exp(4 \\phi)\\,\\tilde{\\gamma}_{ij}$，其中共形度规是平直的，$\\tilde{\\gamma}_{ij} = \\delta_{ij}$，共形因子为 $\\phi(x,y,z) = \\alpha\\,x\\,y + \\beta\\,z^{2}$。\n\n问题的核心是验证从其基本定义直接计算里奇张量（ADM 路径）与共形变换下里奇张量的标准公式（BSSN 路径）之间的数学恒等式。如果两种方法都正确执行，其结果必然相同。因此，它们的差 $\\Delta R_{ij}$ 必然是零张量。零张量的 Frobenius 范数必然为零。$\\phi$ 的具体函数形式和求值点 $p$ 对最终结果而言是无关紧要的，因为该恒等式对任何足够光滑的共形因子都成立。我们将通过直接计算来证明这个恒等式。\n\n### 第 1 部分：直接计算 $R_{ij}[\\gamma]$（ADM 路径）\n\n物理度规为 $\\gamma_{ij} = \\exp(4\\phi)\\delta_{ij}$。其逆度规为 $\\gamma^{ij} = \\exp(-4\\phi)\\delta^{ij}$。里奇张量 $R_{ij}$ 是通过克里斯托费尔符号 $\\Gamma^k_{ij}$ 定义的，即 $R_{ij} = R^k_{ikj}$。黎曼曲率张量的分量由 $R^k_{imj} = \\partial_m \\Gamma^k_{ij} - \\partial_j \\Gamma^k_{im} + \\Gamma^p_{ij}\\Gamma^k_{pm} - \\Gamma^p_{im}\\Gamma^k_{pj}$ 给出。对于度规兼容的联络，由于克里斯托费尔符号在其下指标上是对称的，这等价于 $R_{ij} = \\partial_k \\Gamma^k_{ij} - \\partial_j \\Gamma^k_{ik} + \\Gamma^m_{ij}\\Gamma^k_{mk} - \\Gamma^m_{ik}\\Gamma^k_{mj}$。\n\n首先，我们计算度规 $\\gamma_{ij}$ 的克里斯托费尔符号 $\\Gamma^k_{ij}$：\n$$\n\\Gamma^k_{ij} = \\frac{1}{2} \\gamma^{kl} (\\partial_i \\gamma_{jl} + \\partial_j \\gamma_{il} - \\partial_l \\gamma_{ij})\n$$\n度规的导数为 $\\partial_m \\gamma_{ij} = 4 (\\partial_m \\phi) \\exp(4\\phi) \\delta_{ij}$。将此代入 $\\Gamma^k_{ij}$ 的公式中：\n$$\n\\Gamma^k_{ij} = \\frac{1}{2} \\exp(-4\\phi)\\delta^{kl} [4(\\partial_i\\phi)\\exp(4\\phi)\\delta_{jl} + 4(\\partial_j\\phi)\\exp(4\\phi)\\delta_{il} - 4(\\partial_l\\phi)\\exp(4\\phi)\\delta_{ij}]\n$$\n$$\n\\Gamma^k_{ij} = 2 \\delta^{kl} [(\\partial_i\\phi)\\delta_{jl} + (\\partial_j\\phi)\\delta_{il} - (\\partial_l\\phi)\\delta_{ij}]\n$$\n收缩克罗内克符号得到：\n$$\n\\Gamma^k_{ij} = 2 [(\\partial_i\\phi)\\delta^k_j + (\\partial_j\\phi)\\delta^k_i - \\delta_{ij}\\partial^k\\phi]\n$$\n其中 $\\phi$ 的导数的指标使用平直共形度规 $\\delta_{ij}$ 进行升降，例如 $\\partial^k\\phi = \\delta^{kl}\\partial_l\\phi$。\n\n接下来，我们计算里奇张量。经过冗长的代数运算，可以证明：\n线性项为：$\\partial_k \\Gamma^k_{ij} - \\partial_j \\Gamma^k_{ik} = -2\\partial_i\\partial_j\\phi - 2\\delta_{ij}\\tilde{\\Delta}\\phi$。\n二次项为：$\\Gamma^m_{ij}\\Gamma^k_{mk} - \\Gamma^m_{ik}\\Gamma^k_{mj} = -4(\\partial_i\\phi)(\\partial_j\\phi) + 4\\delta_{ij}|\\tilde{\\nabla}\\phi|^2$。\n\n结合线性和二次部分，我们得到 ADM 路径的里奇张量：\n$$\nR_{ij}^{\\text{ADM}} = -2\\partial_i\\partial_j\\phi - 2\\delta_{ij}\\tilde{\\Delta}\\phi - 4(\\partial_i\\phi)(\\partial_j\\phi) + 4\\delta_{ij}|\\tilde{\\nabla}\\phi|^2\n$$\n\n### 第 2 部分：通过 BSSN 分解路径计算\n\nBSSN 形式依赖于微分几何中关于共形变换度规 $\\gamma_{ij} = \\exp(4\\phi)\\tilde{\\gamma}_{ij}$ 的里奇张量的一个标准结果。在 $3$ 维空间中的正确公式是：\n$$\nR_{ij} = \\tilde{R}_{ij} - 2(\\tilde{\\nabla}_i\\tilde{\\nabla}_j\\phi + \\tilde{\\gamma}_{ij}\\tilde{\\Delta}_{\\tilde{\\gamma}}\\phi) - 4\\tilde{\\nabla}_i\\phi\\tilde{\\nabla}_j\\phi + 4\\tilde{\\gamma}_{ij}(\\tilde{\\nabla}\\phi)^2_{\\tilde{\\gamma}}\n$$\n其中 $\\tilde{\\nabla}$ 是与 $\\tilde{\\gamma}_{ij}$ 兼容的协变导数。问题将 BSSN 路径的结果定义为 $R_{ij}^{\\text{BSSN}} = \\tilde{R}_{ij} + R^{\\phi}_{ij}$。\n\n在我们的特定情况下，共形度规是平直的，即 $\\tilde{\\gamma}_{ij} = \\delta_{ij}$，所以其里奇张量 $\\tilde{R}_{ij}$ 为零。协变导数 $\\tilde{\\nabla}$ 变为偏导数 $\\partial$。\n因此，我们有：\n$$\n\\tilde{R}_{ij} = 0\n$$\n而 $R^{\\phi}_{ij}$ 由其余项给出：\n$$\nR^{\\phi}_{ij} = -2(\\partial_i\\partial_j\\phi + \\delta_{ij}\\tilde{\\Delta}\\phi) - 4\\partial_i\\phi\\partial_j\\phi + 4\\delta_{ij}|\\tilde{\\nabla}\\phi|^2\n$$\n$$\nR^{\\phi}_{ij} = -2\\partial_i\\partial_j\\phi - 2\\delta_{ij}\\tilde{\\Delta}\\phi - 4\\partial_i\\phi\\partial_j\\phi + 4\\delta_{ij}|\\tilde{\\nabla}\\phi|^2\n$$\nBSSN 分解的总结果是 $R_{ij}^{\\text{BSSN}} = 0 + R^{\\phi}_{ij} = R^{\\phi}_{ij}$。\n\n### 第 3 部分：差张量 $\\Delta R_{ij}$\n\n问题将差张量定义为 $\\Delta R_{ij} \\equiv R_{ij}^{\\text{ADM}} - (\\tilde{R}_{ij} + R^{\\phi}_{ij})$。\n从第 1 部分和第 2 部分，我们有：\n$$\nR_{ij}^{\\text{ADM}} = -2\\partial_i\\partial_j\\phi - 2\\delta_{ij}\\tilde{\\Delta}\\phi - 4\\partial_i\\phi\\partial_j\\phi + 4\\delta_{ij}|\\tilde{\\nabla}\\phi|^2\n$$\n$$\n\\tilde{R}_{ij} + R^{\\phi}_{ij} = 0 + (-2\\partial_i\\partial_j\\phi - 2\\delta_{ij}\\tilde{\\Delta}\\phi - 4\\partial_i\\phi\\partial_j\\phi + 4\\delta_{ij}|\\tilde{\\nabla}\\phi|^2)\n$$\n这两个表达式是相同的。因此，差张量恒等于零：\n$$\n\\Delta R_{ij} = R_{ij}^{\\text{ADM}} - R_{ij}^{\\text{BSSN}} = 0\n$$\n这个结果是一个数学恒等式，对流形中所有点上的任何足够可微的共形因子 $\\phi$ 都成立。具体形式 $\\phi = \\alpha\\,x\\,y + \\beta\\,z^{2}$ 和坐标为 $(1,-1,2)$ 的点 $p$ 与这个一般性结果是一致的。在点 $p$ 处求值：\n$$\n\\Delta R_{ij}|_p = 0\n$$\n\n### 第 4 部分：Frobenius 范数 $N$\n\nFrobenius 范数定义为 $N \\equiv \\sqrt{\\gamma^{ik}\\,\\gamma^{jl}\\,\\Delta R_{ij}\\,\\Delta R_{kl}}$。\n由于对于所有分量 $(i,j)$ 都有 $\\Delta R_{ij} = 0$，平方根内的项为零：\n$$\n\\gamma^{ik}\\,\\gamma^{jl}\\,\\Delta R_{ij}\\,\\Delta R_{kl} = \\gamma^{ik}\\,\\gamma^{jl}\\,(0)\\,(0) = 0\n$$\n因此，范数为：\n$$\nN = \\sqrt{0} = 0\n$$\n这是一个无量纲实数，符合要求。", "answer": "$$\n\\boxed{0}\n$$", "id": "3468204"}, {"introduction": "BSSN 形式主义的真正威力体现在其数值应用中，其中变量的具体选择对稳定性和准确性至关重要。这个编程练习将带您从解析理论走向计算实践，在一个移动“黑洞”的简化模型中，探究共形因子的不同表示形式（$\\phi$、$\\chi = \\exp(-4\\phi)$ 或 $W = \\exp(-2\\phi)$）的性能表现 [@problem_id:3468207]。这项动手实践将揭示变量选择对数值稳健性的深远影响，并阐明 BSSN 形式主义在现代天体物理模拟（如黑洞并合）中取得成功的关键原因之一。", "problem": "您将实现并分析一个自包含的一维玩具模型，该模型捕捉了在具有 one-plus-log 切片和 Gamma-driver 移动的移动穿刺情境下，Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式中对共形因子变量的不同选择如何影响数值稳定性及哈密顿约束的破坏。目标是比较演化三种不同共形因子变量，即 $\\,\\phi\\,$、$\\,\\chi = e^{-4\\phi}\\,$ 和 $\\,W = e^{-2\\phi}\\,$，对离散化哈密顿约束的数值精度和鲁棒性的影响。\n\n从以下经过充分检验的事实和核心定义开始：\n- 在广义相对论 (GR) 的 $3+1$ 分解中，哈密顿约束是一个标量方程，在真空中，它将空间切片的内禀曲率与外禀曲率及能量密度联系起来。\n- 在 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式中，我们对空间度规进行共形分解 $\\,\\gamma_{ij} = e^{4\\phi} \\tilde{\\gamma}_{ij}\\,$，其中 $\\,\\det \\tilde{\\gamma}_{ij} = 1\\,$，并使用演化变量，包括共形因子 $\\,\\phi\\,$ 或其代数变换 $\\,\\chi = e^{-4\\phi}\\,$ 或 $\\,W = e^{-2\\phi}\\,$。\n- 对于各向同性坐标下对应于 Schwarzschild 黑洞的共形平坦、时间对称的真空初始数据，共形因子为 $\\,\\psi = 1 + \\frac{m}{2r}\\,$，物理空间度规为 $\\,\\gamma_{ij} = \\psi^{4} \\delta_{ij}\\,$。在此设定下，哈密顿约束在远离穿刺点处简化为平直空间拉普拉斯方程 $\\,\\Delta \\psi = 0\\,$。因此，$\\,\\psi\\,$ 的离散拉普拉斯算子应近似为零，其大小提供了哈密顿约束破坏的一种代理度量（在穿刺点处存在一个紧支集分布，我们明确将其从诊断中排除）。\n\n为在不实现完整系统的情况下模拟单个移动穿刺与 one-plus-log 切片和 Gamma-driver 移动，采用以下一维空间中的代理模型：\n- 空间坐标 $\\,x \\in [-L, L]\\,$，使用均匀网格。\n- 正则化的各向同性共形因子\n$$\n\\psi(x) = 1 + \\frac{m}{2\\sqrt{x^{2} + \\varepsilon^{2}}},\n$$\n其中 $\\,m > 0\\,$ 和 $\\,\\varepsilon > 0\\,$ 用于平滑穿刺点，以使所有场都是有限的。\n- 定义三种共形变量表示\n$$\n\\phi = \\ln \\psi,\\quad \\chi = e^{-4\\phi} = \\psi^{-4},\\quad W = e^{-2\\phi} = \\psi^{-2}.\n$$\n- 为模仿具有 one-plus-log 切片和 Gamma-driver 移动的移动穿刺，通过线性输运方程对所选的共形变量 $\\,q \\in \\{\\phi,\\chi,W\\}\\,$ 进行平流：\n$$\n\\partial_{t} q + v_{\\mathrm{eff}}(x) \\,\\partial_{x} q = 0,\n$$\n其有效平流速度为\n$$\nv_{\\mathrm{eff}}(x) = v \\, W(x),\n$$\n其中 $\\,v > 0\\,$ 是一个常数参数，$\\,W(x) = \\psi(x)^{-2}\\,$ 由初始的 $\\,\\psi\\,$ 计算得出。这一选择体现了 one-plus-log 切片会使穿刺点附近的 lapse 函数塌缩，通过一个与 $\\,W\\,$ 成正比的因子减慢平流。Gamma-driver 移动在这里以简化形式表示，即由一个常数 $\\,v\\,$ 驱动并受 $\\,W\\,$ 调制的平流。\n\n数值离散化要求：\n- 使用线方法，并配备强稳定性保持龙格-库塔 (SSP-RK3) 时间积分器。\n- 在每个网格点上，根据 $\\,v_{\\mathrm{eff}}(x)\\,$ 的符号，对空间导数 $\\,\\partial_{x} q\\,$ 使用一阶单调迎风有限差分。对于 $\\,v_{\\mathrm{eff}}(x) > 0\\,$，使用后向差分。\n- 通过在模板需要域外数据时复制边界值的方式，施加简单的出流/零梯度边界条件。\n- 使用 Courant–Friedrichs–Lewy (CFL) 条件选择时间步长 $\\,\\Delta t\\,$\n$$\n\\Delta t = \\mathrm{CFL} \\times \\frac{\\Delta x}{\\max_{x} |v_{\\mathrm{eff}}(x)|}.\n$$\n\n在将 $\\,q\\,$ 演化到指定的最终时间 $\\,T\\,$ 后，通过逆映射重构 $\\,\\psi\\,$：\n- 若 $\\,q = \\phi\\,$，则 $\\,\\psi = e^{\\phi}$。\n- 若 $\\,q = \\chi\\,$，则 $\\,\\psi = \\chi^{-1/4}$。\n- 若 $\\,q = W\\,$，则 $\\,\\psi = W^{-1/2}$。\n\n然后，计算离散哈密顿约束残差代理\n$$\n\\mathcal{H}_i = \\frac{\\psi_{i+1} - 2\\psi_i + \\psi_{i-1}}{\\Delta x^2},\n$$\n该计算仅在满足 $\\,|x_i| \\ge r_{\\mathrm{exc}}\\,$ 的网格点上进行，以排除连续方程包含分布源的穿刺核心。同时排除最外层的网格点，因为其模板会不完整。通过以下两种范数来量化破坏程度：\n- 均方根范数\n$$\n\\|\\mathcal{H}\\|_{2} = \\sqrt{\\frac{1}{N_{\\mathrm{mask}}} \\sum_{i \\in \\mathrm{mask}} \\mathcal{H}_i^2},\n$$\n其中 $\\,N_{\\mathrm{mask}}\\,$ 是掩码中的点数。\n- 最大值范数\n$$\n\\|\\mathcal{H}\\|_{\\infty} = \\max_{i \\in \\mathrm{mask}} |\\mathcal{H}_i|.\n$$\n\n为以下固定的物理剖面参数和诊断实现上述模型：\n- 使用 $\\,m = 1\\,$、$\\,\\varepsilon = 0.05\\,$、$\\,L = 5\\,$ 和 $\\,r_{\\mathrm{exc}} = 0.2\\,$。\n- 使用上面给出的初始 $\\,\\psi\\,$ 剖面在 $\\,t=0\\,$ 时构造 $\\,\\phi\\,$、$\\,\\chi\\,$ 和 $\\,W\\,$。从初始的 $\\,W\\,$ 计算 $\\,v_{\\mathrm{eff}}(x)\\,$ 并使其在时间上保持不变。\n\n您的程序必须实现以下测试套件，其中每个案例是一个元组 $\\,(\\mathrm{var}, N, \\mathrm{CFL}, v, T)\\,$：\n1. $\\,(\\text{\"phi\"}, 801, 0.4, 0.5, 0.5)\\,$\n2. $\\,(\\text{\"W\"}, 801, 0.4, 0.5, 0.5)\\,$\n3. $\\,(\\text{\"chi\"}, 801, 0.4, 0.5, 0.5)\\,$\n4. $\\,(\\text{\"phi\"}, 201, 0.4, 0.5, 0.5)\\,$\n5. $\\,(\\text{\"W\"}, 201, 0.4, 0.5, 0.5)\\,$\n6. $\\,(\\text{\"chi\"}, 201, 0.9, 0.8, 0.5)\\,$\n\n对于每个测试用例，输出一对浮点数 $[\\|\\mathcal{H}\\|_{2}, \\|\\mathcal{H}\\|_{\\infty}]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个包含六个结果的列表，每个结果本身是按照测试套件顺序排列的双元素列表，例如：\n\"[ [h2_case1, hinf_case1], [h2_case2, hinf_case2], ..., [h2_case6, hinf_case6] ]\".\n不出现角度，也无需进行物理单位转换。所有输出必须是无量纲的浮点数。", "solution": "该问题是有效的。它提出了一个适定、有科学依据的数值实验，用于研究数值相对论 BSSN 形式中不同共形变量选择的性质。所有参数和方法都已明确定义，构成一个自包含且可解的问题。\n\n在此，我们介绍一个一维玩具模型的方法论与实现，该模型模拟穿刺的平流，旨在比较 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式中使用的三种不同共形因子变量的数值性能。\n\n**1. 物理与数学模型**\n\n该模型的基础是各向同性坐标下 Schwarzschild 黑洞的共形平坦、时间对称初始数据。在这种简化情境下，广义相对论的哈密顿约束简化为共形因子 $\\psi$ 的平直空间拉普拉斯方程。$\\psi$ 的初始空间剖面由一个正则化形式给出：\n$$\n\\psi(x, t=0) = 1 + \\frac{m}{2\\sqrt{x^2 + \\varepsilon^2}}\n$$\n其中 $m=1$ 是质量参数，$\\varepsilon=0.05$ 是一个正则化参数，用于平滑穿刺点 $x=0$ 处的奇点。空间域为 $x \\in [-L, L]$，其中 $L=5$。\n\n我们研究三种不同的演化变量，均由 $\\psi$ 导出：\n1.  对数共形因子：$\\phi = \\ln \\psi$\n2.  W-因子：$W = e^{-2\\phi} = \\psi^{-2}$\n3.  $\\chi$-因子：$\\chi = e^{-4\\phi} = \\psi^{-4}$\n\n动力学由一个线性平流方程建模，该方程作为在 one-plus-log 切片和 Gamma-driver 移动条件下复杂演化的代理。所选变量 $q \\in \\{\\phi, W, \\chi\\}$ 根据以下方程演化：\n$$\n\\partial_t q + v_{\\mathrm{eff}}(x) \\partial_x q = 0\n$$\n有效平流速度 $v_{\\mathrm{eff}}(x)$ 在时间上是固定的，由初始状态决定：\n$$\nv_{\\mathrm{eff}}(x) = v \\cdot W(x, t=0) = v \\cdot \\psi(x, t=0)^{-2}\n$$\n其中 $v$ 是一个常数参数。由于 $\\psi(x) \\ge 1$，我们有 $W(x) \\le 1$，且在所有测试案例中 $v>0$，因此平流速度 $v_{\\mathrm{eff}}(x)$ 始终为正，表示从左到右的流动。\n\n**2. 数值离散化**\n\n我们采用线方法求解该偏微分方程。空间域 $[-L, L]$ 被离散化为一个包含 $N$ 个点 $x_i$ 的均匀网格，间距为 $\\Delta x = \\frac{2L}{N-1}$。\n\n_空间离散化_：\n空间导数 $\\partial_x q$ 使用一阶迎风格式近似。由于 $v_{\\mathrm{eff}}(x) > 0$ 对所有 $x$ 成立，这对应于后向有限差分：\n$$\n(\\partial_x q)_i \\approx \\frac{q_i - q_{i-1}}{\\Delta x}\n$$\n这将偏微分方程转化为关于网格点值 $q_i(t)$ 的常微分方程 (ODE) 系统：\n$$\n\\frac{dq_i}{dt} = -v_{\\mathrm{eff},i} \\left( \\frac{q_i - q_{i-1}}{\\Delta x} \\right), \\quad \\text{for } i = 1, \\dots, N-1.\n$$\n\n_边界条件_：\n问题指定了“出流/零梯度”边界条件，通过“在模板需要域外数据时复制边界值”来实现。在左侧（入流）边界 $i=0$ 处，后向差分模板需要一个鬼点值 $q_{-1}$。根据指定规则，我们设置 $q_{-1} = q_0$。这导致边界处的空间导数为零：\n$$\n(\\partial_x q)_0 \\approx \\frac{q_0 - q_0}{\\Delta x} = 0\n$$\n因此，边界点的常微分方程为 $\\frac{dq_0}{dt} = 0$，意味着 $q_0$ 在整个演化过程中保持不变。右边界不需要特殊条件，因为对于任何 $i  N$，后向差分模板都不会访问网格外的点。\n\n_时间积分_：\n该常微分方程系统使用三阶强稳定性保持龙格-库塔 (SSP-RK3) 方法进行时间推进。对于一个常微分方程系统 $\\frac{d\\vec{y}}{dt} = \\vec{F}(\\vec{y})$，从 $t_n$ 到 $t_{n+1}=t_n+\\Delta t$ 的一个时间步长计算如下：\n$$\n\\begin{aligned}\n\\vec{y}^{(1)} = \\vec{y}_n + \\Delta t \\vec{F}(\\vec{y}_n) \\\\\n\\vec{y}^{(2)} = \\frac{3}{4} \\vec{y}_n + \\frac{1}{4} \\vec{y}^{(1)} + \\frac{1}{4} \\Delta t \\vec{F}(\\vec{y}^{(1)}) \\\\\n\\vec{y}_{n+1} = \\frac{1}{3} \\vec{y}_n + \\frac{2}{3} \\vec{y}^{(2)} + \\frac{2}{3} \\Delta t \\vec{F}(\\vec{y}^{(2)})\n\\end{aligned}\n$$\n时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定，以确保数值稳定性：\n$$\n\\Delta t = \\mathrm{CFL} \\times \\frac{\\Delta x}{\\max_{i} |v_{\\mathrm{eff},i}|}\n$$\n为了精确达到最终时间 $T$，我们将步数计算为 $N_{\\mathrm{steps}} = \\lceil T / \\Delta t \\rceil$，并使用一个修正后的步长 $\\Delta t' = T/N_{\\mathrm{steps}}$。\n\n**3. 数值误差分析**\n\n在将所选变量 $q$ 演化到最终时间 $T$ 后，我们使用相应的逆变换重构共形因子 $\\psi$：\n- 如果 $q = \\phi$，则 $\\psi = e^{\\phi}$。\n- 如果 $q = \\chi$，则 $\\psi = \\chi^{-1/4}$。\n- 如果 $q = W$，则 $\\psi = W^{-1/2}$。\n\n数值误差通过测量哈密顿约束的破坏程度来量化。对于给定的初始数据，该约束与 $\\psi$ 的拉普拉斯算子成正比。我们在每个内部网格点 $i \\in \\{1, \\dots, N-2\\}$ 处计算该破坏的离散代理：\n$$\n\\mathcal{H}_i = \\frac{\\psi_{i+1} - 2\\psi_i + \\psi_{i-1}}{\\Delta x^2}\n$$\n为避免在穿刺核心（连续方程有源项）和边界附近（模板不完整）进行诊断，我们仅在一组被掩码的网格点上评估破坏程度。该掩码包括所有满足 $|x_i| \\ge r_{\\mathrm{exc}}$ 的内部点 $x_i$，其中 $r_{\\mathrm{exc}}=0.2$。\n\n总破坏程度通过在该掩码区域内的 $N_{\\mathrm{mask}}$ 个点上使用两种范数来量化：\n- L2 (均方根) 范数：$\\|\\mathcal{H}\\|_{2} = \\sqrt{\\frac{1}{N_{\\mathrm{mask}}} \\sum_{i \\in \\mathrm{mask}} \\mathcal{H}_i^2}$\n- L-无穷 (最大值) 范数：$\\|\\mathcal{H}\\|_{\\infty} = \\max_{i \\in \\mathrm{mask}} |\\mathcal{H}_i|$\n\n该实现对提供的测试套件中的每个案例执行这些步骤，并报告结果对 $[\\|\\mathcal{H}\\|_{2}, \\|\\mathcal{H}\\|_{\\infty}]$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the BSSN conformal variable toy model.\n    \"\"\"\n    test_cases = [\n        (\"phi\", 801, 0.4, 0.5, 0.5),\n        (\"W\", 801, 0.4, 0.5, 0.5),\n        (\"chi\", 801, 0.4, 0.5, 0.5),\n        (\"phi\", 201, 0.4, 0.5, 0.5),\n        (\"W\", 201, 0.4, 0.5, 0.5),\n        (\"chi\", 201, 0.9, 0.8, 0.5),\n    ]\n\n    # Fixed physical and diagnostic parameters\n    m = 1.0\n    eps = 0.05\n    L = 5.0\n    r_exc = 0.2\n\n    def rhs(q, v_eff, dx):\n        \"\"\"\n        Calculates the right-hand side of the semi-discretized advection equation\n        using a first-order upwind (backward) scheme.\n        dq/dt = -v_eff * dq/dx\n        \"\"\"\n        dqdt = np.zeros_like(q)\n        # Backward difference for i = 1 to N-1\n        grad_q = (q[1:] - q[:-1]) / dx\n        dqdt[1:] = -v_eff[1:] * grad_q\n        # dqdt[0] is 0 due to the zero-gradient boundary condition at inflow\n        return dqdt\n\n    def ssp_rk3_step(q, dt, v_eff, dx):\n        \"\"\"\n        Performs a single time step using the SSP-RK3 method.\n        \"\"\"\n        # Stage 1\n        q1 = q + dt * rhs(q, v_eff, dx)\n        # Stage 2\n        q2 = 0.75 * q + 0.25 * q1 + 0.25 * dt * rhs(q1, v_eff, dx)\n        # Stage 3\n        q_next = (1.0 / 3.0) * q + (2.0 / 3.0) * q2 + (2.0 / 3.0) * dt * rhs(q2, v_eff, dx)\n        return q_next\n\n    results = []\n    for case in test_cases:\n        var_name, N, CFL, v, T = case\n\n        # 1. Setup grid and initial conditions\n        x = np.linspace(-L, L, N)\n        dx = x[1] - x[0]\n\n        psi_0 = 1.0 + m / (2.0 * np.sqrt(x**2 + eps**2))\n\n        # The advection velocity is fixed in time based on the initial W profile\n        w_initial = psi_0**(-2.0)\n        v_eff = v * w_initial\n\n        if var_name == \"phi\":\n            q0 = np.log(psi_0)\n        elif var_name == \"W\":\n            q0 = psi_0**(-2.0)\n        elif var_name == \"chi\":\n            q0 = psi_0**(-4.0)\n        else:\n            raise ValueError(f\"Unknown variable name: {var_name}\")\n        \n        q = q0.copy()\n\n        # 2. Time evolution\n        dt_cfl = CFL * dx / np.max(np.abs(v_eff))\n        if dt_cfl == 0:\n            # Handle cases with zero velocity if they occurred\n            n_steps = 1\n        else:\n            n_steps = int(np.ceil(T / dt_cfl))\n        \n        # Use a constant dt to reach T exactly\n        dt = T / n_steps\n\n        for _ in range(n_steps):\n            q = ssp_rk3_step(q, dt, v_eff, dx)\n        \n        q_final = q\n\n        # 3. Reconstruct psi and compute Hamiltonian violation\n        if var_name == \"phi\":\n            psi_final = np.exp(q_final)\n        elif var_name == \"W\":\n            psi_final = q_final**(-0.5)\n        elif var_name == \"chi\":\n            psi_final = q_final**(-0.25)\n            \n        # Compute discrete Laplacian (Hamiltonian surrogate)\n        H_residual = np.zeros(N)\n        H_residual[1:-1] = (psi_final[2:] - 2 * psi_final[1:-1] + psi_final[:-2]) / dx**2\n        \n        # 4. Apply mask and compute norms\n        # Mask for valid indices (interior points for Laplacian)\n        interior_indices = np.arange(1, N - 1)\n        x_interior = x[interior_indices]\n        H_interior = H_residual[interior_indices]\n        \n        # Further mask to exclude the puncture core\n        puncture_mask = np.abs(x_interior) >= r_exc\n        \n        H_masked = H_interior[puncture_mask]\n        \n        n_mask = len(H_masked)\n        if n_mask > 0:\n            h2_norm = np.sqrt(np.sum(H_masked**2) / n_mask)\n            hinf_norm = np.max(np.abs(H_masked))\n        else:\n            h2_norm = 0.0\n            hinf_norm = 0.0\n            \n        results.append([h2_norm, hinf_norm])\n\n    # Convert results to string for the required output format\n    result_str = \"[\" + \", \".join([f\"[{res[0]}, {res[1]}]\" for res in results]) + \"]\"\n    print(result_str)\n\nsolve()\n```", "id": "3468207"}]}