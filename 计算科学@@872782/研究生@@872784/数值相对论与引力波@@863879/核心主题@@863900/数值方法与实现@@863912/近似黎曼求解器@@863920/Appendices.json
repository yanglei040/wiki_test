{"hands_on_practices": [{"introduction": "任何数值模拟的基础都是稳定的时间演化。著名的 Courant-Friedrichs-Lewy (CFL) 条件将时间步长 $ \\Delta t $、网格间距 $ \\Delta x $ 和物理信号速度联系在一起。本练习提供了在广义相对论的 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式化背景下，为显式时间积分格式计算最大稳定时间步长的具体实践。它清晰地展示了规范场量（递减函数 $ \\alpha $ 和移位矢量 $ \\beta^x $）如何直接决定引力波的坐标传播速度，从而限制模拟的时间步长 [@problem_id:3464355]。", "problem": "在广义相对论的Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式中张量（辐射）部分于波区（wave zone）的一维有限体积法-线法离散化中，使用Harten–Lax–van Leer (HLL) 近似黎曼求解器来计算单元间的数值通量。假设在固定的时间切片上，以下建模假设成立：\n\n- 引力辐射相对于欧拉观察者以物理光速传播。\n- 沿传播方向的空间度规近似平直，因此在主部中除了直减率（lapse）和移位矢量（shift）之外的几何因子可以忽略，这与渐近平直的波区一致。\n- 沿 $x$ 方向的坐标特征锥仅由直减率 $\\alpha$ 和移位分量 $\\beta^{x}$ 决定。\n- $\\alpha$ 和 $\\beta^{x}$ 的界面值由其相邻单元中心值的算术平均值近似。\n\n给定一个均匀网格，其间距为 $\\Delta x = 0.5\\,M$（所有时间均以 $M$ 为单位表示）。用于显式强稳定保持（Strong–Stability–Preserving）Runge–Kutta (SSP–RK) 时间积分器的Courant–Friedrichs–Lewy (CFL) 系数为 $C_{\\mathrm{CFL}} = 0.45$。四个连续单元中以单元为中心的规范场为：\n- 单元 $i=1$：$\\alpha_{1} = 0.908295106$，$\\beta^{x}_{1} = 0.1739130435$。\n- 单元 $i=2$：$\\alpha_{2} = 0.9128709292$，$\\beta^{x}_{2} = 0.1666666667$。\n- 单元 $i=3$：$\\alpha_{3} = 0.9165151390$，$\\beta^{x}_{3} = 0.1600000000$。\n- 单元 $i=4$：$\\alpha_{4} = 0.919145031$，$\\beta^{x}_{4} = 0.1538461538$。\n\n使用 HLL 方法处理这些单元之间的三个界面 $x_{3/2}$、$x_{5/2}$ 和 $x_{7/2}$，将根据局部直减率和移位矢量计算出的极值坐标特征速度作为左行和右行信号速度。确定在这三个界面上，由 CFL 条件允许的最大稳定全局时间步长 $\\Delta t_{\\max}$。将你的答案四舍五入至四位有效数字，并以 $M$ 为单位表示。", "solution": "经评估，用户提供的问题是有效的。该问题在科学上基于数值相对论的原理，特别是 BSSN 形式及其使用有限体积法的数值解法。问题提法清晰，为得到唯一解提供了所有必要的数据和关系。语言客观，设置一致。因此，我们可以着手求解。\n\n问题要求计算由Courant–Friedrichs–Lewy (CFL) 条件制约的一维系统的最大稳定全局时间步长 $\\Delta t_{\\max}$。对于一个显式时间积分格式，CFL 条件由下式给出：\n$$\n\\Delta t \\le C_{\\mathrm{CFL}} \\frac{\\Delta x}{\\lambda_{\\max}^{\\mathrm{global}}}\n$$\n其中 $C_{\\mathrm{CFL}}$ 是 CFL 系数，$\\Delta x$ 是网格间距，而 $\\lambda_{\\max}^{\\mathrm{global}}$ 是整个计算域上的最大特征速度绝对值。当此不等式取等号时，可获得最大稳定时间步长 $\\Delta t_{\\max}$。\n\n问题陈述，在几何化单位制中，引力辐射相对于欧拉观察者以物理光速 $c=1$ 传播。坐标传播速度，即双曲系统的特征速度（特征值），由时空几何决定，具体来说是直减率函数 $\\alpha$ 和移位矢量分量 $\\beta^{x}$。对于沿 $x$ 方向的传播，左行和右行的特征速度由下式给出：\n$$\n\\lambda_{\\pm} = \\beta^{x} \\pm \\alpha c = \\beta^{x} \\pm \\alpha\n$$\nHLL 近似黎曼求解器需要对信号速度进行估计，此处取这些极值特征速度作为信号速度。CFL 条件取决于任意给定点的最快特征速度的大小。其计算公式为：\n$$\n\\lambda_{\\max}^{\\mathrm{local}} = \\max(|\\beta^{x} + \\alpha|, |\\beta^{x} - \\alpha|)\n$$\n由于直减率 $\\alpha$ 严格为正，且物理上的解要求满足因果条件 $|\\beta^{x}|  \\alpha$，该表达式可简化为：\n$$\n\\lambda_{\\max}^{\\mathrm{local}} = \\alpha + |\\beta^{x}|\n$$\n所有给定的 $\\beta^{x}$ 值均为正，因此 $|\\beta^{x}| = \\beta^{x}$。\n\n问题要求我们在计算单元之间的界面上评估这些速度。在单元 $i$ 和 $i+1$ 之间的界面 $x_{i+1/2}$ 处，$\\alpha$ 和 $\\beta^{x}$ 的值通过单元中心值的算术平均值来近似：\n$$\n\\alpha_{i+1/2} = \\frac{\\alpha_{i} + \\alpha_{i+1}}{2}\n$$\n$$\n\\beta^{x}_{i+1/2} = \\frac{\\beta^{x}_{i} + \\beta^{x}_{i+1}}{2}\n$$\n则界面上的最大局部速度为 $\\lambda_{\\max, i+1/2} = \\alpha_{i+1/2} + \\beta^{x}_{i+1/2}$。全局最大速度是所有相关界面上这些值的最大值。\n\n给定的数据如下：\n- 网格间距：$\\Delta x = 0.5\\,M$\n- CFL 系数：$C_{\\mathrm{CFL}} = 0.45$\n- 单元 $i=1$：$\\alpha_{1} = 0.908295106$，$\\beta^{x}_{1} = 0.1739130435$\n- 单元 $i=2$：$\\alpha_{2} = 0.9128709292$，$\\beta^{x}_{2} = 0.1666666667$\n- 单元 $i=3$：$\\alpha_{3} = 0.9165151390$，$\\beta^{x}_{3} = 0.1600000000$\n- 单元 $i=4$：$\\alpha_{4} = 0.919145031$，$\\beta^{x}_{4} = 0.1538461538$\n\n我们计算三个界面 $x_{3/2}$、$x_{5/2}$ 和 $x_{7/2}$ 处的界面值和最大特征速度。\n\n**界面 $x_{3/2}$（单元 1 和 2 之间）：**\n$$\n\\alpha_{3/2} = \\frac{0.908295106 + 0.9128709292}{2} = 0.9105830176\n$$\n$$\n\\beta^{x}_{3/2} = \\frac{0.1739130435 + 0.1666666667}{2} = 0.1702898551\n$$\n$$\n\\lambda_{\\max, 3/2} = \\alpha_{3/2} + \\beta^{x}_{3/2} = 0.9105830176 + 0.1702898551 = 1.0808728727\n$$\n\n**界面 $x_{5/2}$（单元 2 和 3 之间）：**\n$$\n\\alpha_{5/2} = \\frac{0.9128709292 + 0.9165151390}{2} = 0.9146930341\n$$\n$$\n\\beta^{x}_{5/2} = \\frac{0.1666666667 + 0.1600000000}{2} = 0.16333333335\n$$\n$$\n\\lambda_{\\max, 5/2} = \\alpha_{5/2} + \\beta^{x}_{5/2} = 0.9146930341 + 0.16333333335 = 1.07802636745\n$$\n\n**界面 $x_{7/2}$（单元 3 和 4 之间）：**\n$$\n\\alpha_{7/2} = \\frac{0.9165151390 + 0.919145031}{2} = 0.917830085\n$$\n$$\n\\beta^{x}_{7/2} = \\frac{0.1600000000 + 0.1538461538}{2} = 0.1569230769\n$$\n$$\n\\lambda_{\\max, 7/2} = \\alpha_{7/2} + \\beta^{x}_{7/2} = 0.917830085 + 0.1569230769 = 1.0747531619\n$$\n\n全局最大特征速度是这三个值的最大值：\n$$\n\\lambda_{\\max}^{\\mathrm{global}} = \\max(1.0808728727, 1.07802636745, 1.0747531619) = 1.0808728727\n$$\n\n现在我们可以计算最大稳定时间步长 $\\Delta t_{\\max}$：\n$$\n\\Delta t_{\\max} = C_{\\mathrm{CFL}} \\frac{\\Delta x}{\\lambda_{\\max}^{\\mathrm{global}}} = 0.45 \\times \\frac{0.5}{1.0808728727}\n$$\n$$\n\\Delta t_{\\max} = \\frac{0.225}{1.0808728727} \\approx 0.20816406\\,M\n$$\n根据要求，将此结果四舍五入至四位有效数字，我们得到：\n$$\n\\Delta t_{\\max} \\approx 0.2082\\,M\n$$", "answer": "$$\n\\boxed{0.2082}\n$$", "id": "3464355"}, {"introduction": "将近似黎曼求解器应用于狭义相对论流体力学 (Special Relativistic Hydrodynamics, SRHD) 等完整物理系统，会引入新的挑战，尤其是在处理真空等非理想状态时。本问题将指导您为 SRHD 实现一个稳健的 Harten–Lax–van Leer (HLL) 求解器，重点是“大气”处理（即设置密度和压强下限）这一关键实用技术，以确保数值稳定性。这对于开发模拟双中子星并合等天体物理现象的可靠代码至关重要 [@problem_id:3464284]。", "problem": "要求您推导并实现一个鲁棒的 Harten–Lax–van Leer (HLL) 型近似黎曼求解器，用于一维狭义相对论流体动力学 (SRHD)，该求解器适用于在与引力波模拟相关的区域中模拟物质的数值相对论程序。该模型假设平直时空，并使用光速为1的程序单位，即 $c = 1$。控制系统是守恒律\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0,\n$$\n其中守恒变量 $\\mathbf{U}$ 和通量 $\\mathbf{F}$ 由原始变量 $\\rho$（静止质量密度）、$v$（流体 x 方向速度）和 $p$（压力）以及绝热指数 $\\gamma$ 定义如下。定义洛伦兹因子 $\\Gamma = 1/\\sqrt{1-v^2}$，比焓 $h = 1 + \\epsilon + p/\\rho$（其中 $\\epsilon = p/\\left((\\gamma-1)\\rho\\right)$），以及焓密度 $w = \\rho h = \\rho + \\frac{\\gamma}{\\gamma - 1} p$。然后设置\n$$\n\\mathbf{U} = \\begin{bmatrix} D \\\\ S \\\\ \\tau \\end{bmatrix} = \\begin{bmatrix} \\Gamma \\rho \\\\ w \\Gamma^2 v \\\\ w \\Gamma^2 - p - \\Gamma \\rho \\end{bmatrix}, \\quad\n\\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} D v \\\\ S v + p \\\\ S - D v \\end{bmatrix}.\n$$\n假设理想气体状态方程，相对论声速定义为\n$$\nc_s^2 = \\frac{\\gamma p}{w},\n$$\nx方向的特征速度由相对论速度加法公式给出\n$$\n\\lambda_\\pm = \\frac{v \\pm c_s}{1 \\pm v\\,c_s}.\n$$\nHarten–Lax–van Leer (HLL) 求解器通过两个速度为 $S_L$ 和 $S_R$ 的波来近似黎曼扇，这两个波包围了所有特征场。为了在存在真空和近真空状态时保证鲁棒性，您必须通过对原始变量强制设置下限并限制速度来实施大气处理，具体如下，在进行任何其他计算之前，独立应用于左右状态：\n- $\\rho \\leftarrow \\max(\\rho, \\rho_{\\text{floor}})$,\n- $p \\leftarrow \\max(p, p_{\\text{floor}})$,\n- $v \\leftarrow \\min\\left(\\max\\left(v, -v_{\\max}\\right), v_{\\max}\\right)$，其中 $v_{\\max} = 1 - \\epsilon$ 且固定 $\\epsilon = 10^{-12}$。\n\n您的任务是：\n- 从守恒律的积分（弱）形式出发，并假设黎曼解由两个速度为 $S_L$ 和 $S_R$ 的波之间的一个恒定状态近似，推导界面上的 HLL 数值通量。用 $\\mathbf{U}_L$、$\\mathbf{U}_R$、$\\mathbf{F}_L$、$\\mathbf{F}_R$、$S_L$ 和 $S_R$ 表示最终的 HLL 通量公式，并包括当界面信号速度同号时的适当迎风极限情况。\n- 证明选择 $S_L = \\min\\{\\lambda_-(\\text{left}), \\lambda_-(\\text{right})\\}$ 和 $S_R = \\max\\{\\lambda_+(\\text{left}), \\lambda_+(\\text{right})\\}$ 的合理性，并解释大气下限如何确保在类真空输入下 $c_s^2 \\in [0, 1)$ 是良定义且数值稳定的。\n- 为退化情况 $S_R - S_L \\to 0$ 提供一个数值安全的备用方案，以避免除以零。\n\n实现一个程序，该程序：\n- 对于每个测试用例，应用大气处理，将原始变量转换为守恒变量，计算相对论声速和边界波速 $S_L$ 和 $S_R$，构建界面的 HLL 通量，并以浮点数形式返回通量向量的分量，四舍五入到 $8$ 位小数。\n- 使用 $c=1$ 的程序单位，使得所有返回的通量分量都是无量纲的。\n- 生成一行输出，其中包含结果，格式为逗号分隔的列表的列表，每个内部列表是相应测试用例的三个通量分量 $[F_D, F_S, F_\\tau]$。\n\n测试套件：\n- 案例 1（逆向流，对称热力学）：左侧 $(\\rho_L, v_L, p_L) = (1.0, 0.5, 1.0)$，右侧 $(\\rho_R, v_R, p_R) = (1.0, -0.5, 1.0)$，$\\gamma = 5/3$，$\\rho_{\\text{floor}} = 10^{-12}$，$p_{\\text{floor}} = 10^{-12}$。\n- 案例 2（相对论气体的稀疏波进入真空）：左侧 $(1.0, 0.9, 1.0)$，右侧 $(0.0, 0.0, 0.0)$，$\\gamma = 4/3$，$\\rho_{\\text{floor}} = 10^{-12}$，$p_{\\text{floor}} = 10^{-12}$。\n- 案例 3（静止的类接触间断）：左侧 $(1.0, 0.0, 1.0)$，右侧 $(0.125, 0.0, 1.0)$，$\\gamma = 5/3$，$\\rho_{\\text{floor}} = 10^{-12}$，$p_{\\text{floor}} = 10^{-12}$。\n- 案例 4（近大气状态进入真空）：左侧 $(10^{-9}, 0.0, 10^{-10})$，右侧 $(0.0, 0.0, 0.0)$，$\\gamma = 5/3$，$\\rho_{\\text{floor}} = 10^{-12}$，$p_{\\text{floor}} = 10^{-12}$。\n- 案例 5（向左的均匀超音速平流）：左侧 $(1.0, -0.8, 0.1)$，右侧 $(1.0, -0.8, 0.1)$，$\\gamma = 5/3$，$\\rho_{\\text{floor}} = 10^{-12}$，$p_{\\text{floor}} = 10^{-12}$。\n\n数值细节：\n- 使用 $\\epsilon = 10^{-12}$ 作为速度上限。\n- 在计算 $c_s^2$ 时，将结果限制在区间 $[0, 1 - 10^{-12}]$ 内，以避免超光速的数值伪影。\n- 如果 $S_R \\le 0$，使用右通量；如果 $S_L \\ge 0$，使用左通量；否则使用推导的 HLL 通量。如果 $S_R - S_L$ 的绝对值小于 $10^{-14}$，则使用一个等于算术平均值 $\\left(\\mathbf{F}_L + \\mathbf{F}_R\\right)/2$ 的连续备用方案。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含结果，格式为逗号分隔的列表，用方括号括起来，并按测试用例分组，例如 $[[F_{D,1},F_{S,1},F_{\\tau,1}],[F_{D,2},F_{S,2},F_{\\tau,2}],\\dots]$，其中每个 $F$ 都四舍五入到 8 位小数。", "solution": "用户要求推导并实现用于一维狭义相对论流体动力学 (SRHD) 方程的 Harten–Lax–van Leer (HLL) 近似黎曼求解器。该问题是适定的、科学上合理的，并为完整解决方案提供了所有必要信息。\n\n### 1. HLL 数值通量的推导\n\nSRHD 方程是一个守恒律系统，形式如下：\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0\n$$\n其中 $\\mathbf{U}$ 是守恒变量的向量，$\\mathbf{F}(\\mathbf{U})$ 是相应通量的向量。对于有限体积数值格式，我们需要计算两个计算单元 $i$ 和 $i+1$ 之间界面上的数值通量 $\\mathbf{F}_{i+1/2}$，这两个单元的状态分别为 $\\mathbf{U}_L = \\mathbf{U}_i$ 和 $\\mathbf{U}_R = \\mathbf{U}_{i+1}$。\n\nHLL 求解器近似了界面上的黎曼问题的解。它假设精确解的复杂波结构（对于 SRHD，由两个非线性波和一个接触间断组成）可以简化为单个恒定状态 $\\mathbf{U}_{\\text{HLL}}$，该状态由两个以速度 $S_L$ 和 $S_R$ 传播的波与初始左右状态分隔开。选择这两个速度作为系统中的最小和最大信号速度，确保对于一个被波扇穿过的位于 $x=0$ 的界面，有 $S_L \\le 0 \\le S_R$。\n\n我们通过应用守恒律的积分形式来推导 HLL 通量。将系统在区域 $[x_1, x_2] \\times [t, t+\\Delta t]$ 上积分并应用散度定理，得到跨越以速度 $s$ 移动的间断的 Rankine-Hugoniot 跳跃条件：\n$$\ns(\\mathbf{U}_{\\text{right}} - \\mathbf{U}_{\\text{left}}) = \\mathbf{F}_{\\text{right}} - \\mathbf{F}_{\\text{left}}\n$$\n在 HLL 模型中，我们有两个这样的间断。对包围中间状态 $\\mathbf{U}_{\\text{HLL}}$ 的左波（速度 $S_L$）和右波（速度 $S_R$）应用跳跃条件，我们得到：\n$$\nS_L(\\mathbf{U}_{\\text{HLL}} - \\mathbf{U}_L) = \\mathbf{F}(\\mathbf{U}_{\\text{HLL}}) - \\mathbf{F}_L\n$$\n$$\nS_R(\\mathbf{U}_{\\text{HLL}} - \\mathbf{U}_R) = \\mathbf{F}(\\mathbf{U}_{\\text{HLL}}) - \\mathbf{F}_R\n$$\n这里，$\\mathbf{F}_L = \\mathbf{F}(\\mathbf{U}_L)$，$\\mathbf{F}_R = \\mathbf{F}(\\mathbf{U}_R)$，而 $\\mathbf{F}(\\mathbf{U}_{\\text{HLL}})$ 是对应于未知状态 $\\mathbf{U}_{\\text{HLL}}$ 的通量。HLL 方法通过引入一个与这些跳跃条件一致的单一数值通量 $\\mathbf{F}_{\\text{HLL}}$ 来避免显式计算 $\\mathbf{U}_{\\text{HLL}}$。\n\n获得通量公式的另一条途径是考虑状态 $\\mathbf{U}_{\\text{HLL}}$ 本身。由于 $\\mathbf{F}$ 是 $\\mathbf{U}$ 的非线性函数，从两个跳跃条件中消去 $\\mathbf{F}(\\mathbf{U}_{\\text{HLL}})$ 并不直接。因此，我们将守恒律在两个波之间的区域 $[S_L t, S_R t]$ 上积分。这得到：\n$$\n\\frac{d}{dt} \\int_{S_L t}^{S_R t} \\mathbf{U}(x, t) dx = \\mathbf{F}_L - \\mathbf{F}_R + S_L \\mathbf{U}_L - S_R \\mathbf{U}_R\n$$\n假设对于 $x \\in [S_L t, S_R t]$，$\\mathbf{U}(x,t) = \\mathbf{U}_{\\text{HLL}}$，则积分变为 $\\mathbf{U}_{\\text{HLL}}(S_R - S_L)t$。对 $t$ 求导得到 $\\mathbf{U}_{\\text{HLL}}(S_R-S_L)$。将其与右侧相等，我们可以解出恒定的中间状态：\n$$\n\\mathbf{U}_{\\text{HLL}} = \\frac{S_R \\mathbf{U}_R - S_L \\mathbf{U}_L - (\\mathbf{F}_R - \\mathbf{F}_L)}{S_R - S_L}\n$$\n界面（$x=0$）处的数值通量是通过此表面的通量。在 HLL 近似中，此通量与跨越已穿过界面的波的跳跃条件一致。对于 $S_L  0  S_R$，左波向左移动，右波向右移动。$x=0$ 处的状态是 $\\mathbf{U}_{\\text{HLL}}$。界面处的通量 $\\mathbf{F}_{\\text{HLL}}$ 可以通过任一激波的 Rankine-Hugoniot 条件找到。使用左激波：\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + S_L (\\mathbf{U}_{\\text{HLL}} - \\mathbf{U}_L)\n$$\n代入 $\\mathbf{U}_{\\text{HLL}}$ 的表达式：\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + S_L \\left( \\frac{S_R \\mathbf{U}_R - S_L \\mathbf{U}_L - \\mathbf{F}_R + \\mathbf{F}_L}{S_R - S_L} - \\mathbf{U}_L \\right)\n$$\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + \\frac{S_L}{S_R - S_L} \\left( S_R \\mathbf{U}_R - S_L \\mathbf{U}_L - \\mathbf{F}_R + \\mathbf{F}_L - (S_R-S_L)\\mathbf{U}_L \\right)\n$$\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + \\frac{S_L}{S_R - S_L} \\left( S_R (\\mathbf{U}_R - \\mathbf{U}_L) - (\\mathbf{F}_R - \\mathbf{F}_L) \\right)\n$$\n$$\n(S_R - S_L)\\mathbf{F}_{\\text{HLL}} = (S_R - S_L)\\mathbf{F}_L + S_L S_R(\\mathbf{U}_R - \\mathbf{U}_L) - S_L(\\mathbf{F}_R - \\mathbf{F}_L)\n$$\n$$\n(S_R - S_L)\\mathbf{F}_{\\text{HLL}} = S_R \\mathbf{F}_L - S_L \\mathbf{F}_L + S_L S_R(\\mathbf{U}_R - \\mathbf{U}_L) - S_L \\mathbf{F}_R + S_L \\mathbf{F}_L\n$$\n这可以简化为标准的 HLL 通量公式：\n$$\n\\mathbf{F}_{\\text{HLL}} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\n此公式适用于 $S_L  0  S_R$ 的情况。逻辑必须用迎风情况来补全：\n- 如果 $S_L \\ge 0$，整个黎曼扇结构移动到界面的右侧。因此，界面处的状态是原始的左状态 $\\mathbf{U}_L$。通量为 $\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L$。\n- 如果 $S_R \\le 0$，整个结构移动到界面的左侧。界面处的状态是原始的右状态 $\\mathbf{U}_R$。通量为 $\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_R$。\n\n### 2. 波速选择和大气处理的合理性证明\n\n**波速选择：** SRHD 系统的特征速度是雅可比矩阵 $\\partial \\mathbf{F} / \\partial \\mathbf{U}$ 的特征值。这些是信息传播的速度。对于给定的一维系统，它们是流体速度 $v$（用于接触间断）和流体速度与声速的相对论组合 $\\lambda_\\pm = \\frac{v \\pm c_s}{1 \\pm v c_s}$（用于声波）。为了使数值格式稳定（例如，满足离散熵条件），数值依赖域必须包含真实的物理依赖域。在 HLL 求解器的背景下，这意味着估计的信号速度 $S_L$ 和 $S_R$ 必须包围从界面发出的所有物理特征速度。一个被广泛采用且能保证这一点的鲁棒选择是：\n$$\nS_L = \\min\\{\\lambda_-(\\text{left}), \\lambda_-(\\text{right})\\}\n$$\n$$\nS_R = \\max\\{\\lambda_+(\\text{left}), \\lambda_+(\\text{right})\\}\n$$\n这种选择确保了对于左右两个状态都有 $S_L \\le \\lambda_-  v  \\lambda_+ \\le S_R$，从而包围了整个黎曼扇，产生了一个稳定的 Godunov 型格式。\n\n**大气处理：** 天体物理流的数值模拟经常会遇到密度和压力极低的区域，接近真空。这些状态在数值上具有挑战性。\n1.  **良定义的声速：** 声速定义为 $c_s^2 = \\gamma p / w$，其中 $w = \\rho + \\frac{\\gamma}{\\gamma-1} p$。如果 $\\rho$ 和 $p$ 都为零，则 $w$ 也为零，$c_s^2$ 会变成 $0/0$ 的不定形式。通过强制执行最小下限值 $\\rho \\leftarrow \\max(\\rho, \\rho_{\\text{floor}})$ 和 $p \\leftarrow \\max(p, p_{\\text{floor}})$，其中 $\\rho_{\\text{floor}} > 0$ 和 $p_{\\text{floor}} > 0$，我们确保焓密度 $w$ 严格为正（因为 $\\gamma>1$）。这保证了 $c_s^2$ 总是良定义且非负的。\n2.  **因果性和稳定性：** 对于由给定状态方程描述的物理上真实的理想气体，因果性要求声速小于光速，即 $c_s  1$。这转化为对绝热指数的约束，$\\gamma  2$。表达式 $c_s^2 = \\frac{\\gamma p}{\\rho + \\frac{\\gamma p}{\\gamma-1}}$ 在超相对论极限（$p/\\rho \\to \\infty$）下的最大值为 $\\gamma-1$。对于 $\\gamma=5/3$ 或 $\\gamma=4/3$，此条件得到满足。将 $c_s^2$ 显式地限制在 $[0, 1 - \\epsilon]$ 内，是防止可能在数值上违反此物理界限的浮点误差的额外保障。速度上限 $|v| \\le v_{\\max} = 1-\\epsilon$ 对于防止洛伦兹因子 $\\Gamma = (1-v^2)^{-1/2}$ 变得无穷大或无定义至关重要，否则会导致守恒变量计算中的灾难性故障。\n\n### 3. 退化情况的备用方案\n\n推导出的 HLL 通量公式有一个分母 $S_R - S_L$。在流场几乎均匀的情况下，左右状态非常相似，$\\mathbf{U}_L \\approx \\mathbf{U}_R$，信号速度也会非常接近，$S_L \\approx S_R$。这可能导致除以一个非常小的数，这在数值上是不稳定的，并且会放大分子中的浮点不准确性，产生伪振荡或 `NaN` 值。一个鲁棒的实现必须处理这种退化。一个简单而有效的备用方案是使用左右通量的算术平均值：\n$$\n\\mathbf{F}_{\\text{HLL}} = \\frac{1}{2}(\\mathbf{F}_L + \\mathbf{F}_R)\n$$\n当 $|S_R - S_L|$ 小于一个很小的容差（例如 $10^{-14}$）时，激活此选择。这个通量比标准 HLL 通量更具耗散性，但因为它只在 $\\mathbf{F}_L \\approx \\mathbf{F}_R$ 时使用，所以增加的耗散可以忽略不计，并且它为通过退化状态提供了一个平滑、连续和鲁棒的过渡。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements the HLL approximate Riemann solver for 1D Special\n    Relativistic Hydrodynamics (SRHD).\n    \"\"\"\n\n    def prims_to_cons_flux(rho, v, p, gamma, rho_floor, p_floor, v_max_eps):\n        \"\"\"\n        Converts primitive variables to conserved variables and fluxes,\n        applying atmosphere treatment.\n        \"\"\"\n        # Atmosphere treatment: apply floors and velocity cap\n        v_max = 1.0 - v_max_eps\n        rho_f = max(rho, rho_floor)\n        p_f = max(p, p_floor)\n        v_f = min(max(v, -v_max), v_max)\n\n        # Derived quantities\n        Gamma = 1.0 / np.sqrt(1.0 - v_f**2)\n        # Enthalpy density w = rho*h = rho(1 + eps + p/rho)\n        # eps = p / ((gamma-1)*rho)\n        # h = 1 + p/((gamma-1)*rho) + p/rho = 1 + (gamma*p)/((gamma-1)*rho)\n        # w = rho * h = rho + gamma*p/(gamma-1)\n        w = rho_f + (gamma / (gamma - 1.0)) * p_f\n        \n        # Conserved variables U = [D, S, tau]\n        D = Gamma * rho_f\n        S = w * Gamma**2 * v_f\n        tau = w * Gamma**2 - p_f - D\n        U = np.array([D, S, tau])\n        \n        # Fluxes F = [F_D, F_S, F_tau]\n        F_D = D * v_f\n        F_S = S * v_f + p_f\n        F_tau = S - D * v_f\n        F = np.array([F_D, F_S, F_tau])\n        \n        return rho_f, v_f, p_f, w, U, F\n\n    def compute_hll_flux(state_L, state_R, gamma, rho_floor, p_floor):\n        \"\"\"\n        Computes the HLL flux at the interface between two states.\n        \"\"\"\n        v_max_eps = 1e-12\n        cs2_clip_eps = 1e-12\n        degeneracy_tol = 1e-14\n\n        rho_L, v_L, p_L = state_L\n        rho_R, v_R, p_R = state_R\n\n        # 1. Apply atmosphere and convert to conserved/flux for both states\n        rho_L_f, v_L_f, p_L_f, w_L, U_L, F_L = prims_to_cons_flux(\n            rho_L, v_L, p_L, gamma, rho_floor, p_floor, v_max_eps\n        )\n        rho_R_f, v_R_f, p_R_f, w_R, U_R, F_R = prims_to_cons_flux(\n            rho_R, v_R, p_R, gamma, rho_floor, p_floor, v_max_eps\n        )\n\n        # 2. Compute sound speeds and characteristic speeds\n        # Left state\n        cs2_L = (gamma * p_L_f) / w_L\n        cs2_L = min(max(cs2_L, 0.0), 1.0 - cs2_clip_eps)\n        cs_L = np.sqrt(cs2_L)\n        \n        if (1.0 + v_L_f * cs_L) == 0.0 or (1.0 - v_L_f * cs_L) == 0.0:\n            lambda_p_L = v_L_f\n            lambda_m_L = v_L_f\n        else:\n            lambda_p_L = (v_L_f + cs_L) / (1.0 + v_L_f * cs_L)\n            lambda_m_L = (v_L_f - cs_L) / (1.0 - v_L_f * cs_L)\n\n        # Right state\n        cs2_R = (gamma * p_R_f) / w_R\n        cs2_R = min(max(cs2_R, 0.0), 1.0 - cs2_clip_eps)\n        cs_R = np.sqrt(cs2_R)\n        \n        if (1.0 + v_R_f * cs_R) == 0.0 or (1.0 - v_R_f * cs_R) == 0.0:\n            lambda_p_R = v_R_f\n            lambda_m_R = v_R_f\n        else:\n            lambda_p_R = (v_R_f + cs_R) / (1.0 + v_R_f * cs_R)\n            lambda_m_R = (v_R_f - cs_R) / (1.0 - v_R_f * cs_R)\n\n        # 3. Compute HLL wave speeds S_L and S_R\n        S_L = min(lambda_m_L, lambda_m_R)\n        S_R = max(lambda_p_L, lambda_p_R)\n\n        # 4. Compute HLL flux based on S_L and S_R\n        if S_L = 0.0:\n            F_hll = F_L\n        elif S_R = 0.0:\n            F_hll = F_R\n        else:\n            # Degeneracy fallback\n            if abs(S_R - S_L)  degeneracy_tol:\n                F_hll = 0.5 * (F_L + F_R)\n            else:\n                F_hll = (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n        \n        return F_hll\n\n    test_cases = [\n        # Case 1: counter-streaming, symmetric thermodynamics\n        {'left': (1.0, 0.5, 1.0), 'right': (1.0, -0.5, 1.0), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 2: rarefaction into vacuum with relativistic gas\n        {'left': (1.0, 0.9, 1.0), 'right': (0.0, 0.0, 0.0), \n         'gamma': 4/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 3: contact-like discontinuity at rest\n        {'left': (1.0, 0.0, 1.0), 'right': (0.125, 0.0, 1.0), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 4: near-atmosphere state into vacuum\n        {'left': (1e-9, 0.0, 1e-10), 'right': (0.0, 0.0, 0.0), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 5: uniform supersonic advection to the left\n        {'left': (1.0, -0.8, 0.1), 'right': (1.0, -0.8, 0.1), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n    ]\n\n    results = []\n    for case in test_cases:\n        flux = compute_hll_flux(case['left'], case['right'], case['gamma'],\n                                case['rho_floor'], case['p_floor'])\n        rounded_flux = [f\"{f:.8f}\" for f in flux]\n        results.append(f\"[{','.join(rounded_flux)}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3464284"}, {"introduction": "在近似黎曼求解器中，参数的选择，例如 Harten-Lax-van Leer-Einfeldt (HLLE) 中的波速估计，会引入数值耗散，这可能影响模拟的准确性和稳定性。理解和量化这些影响至关重要。本练习通过一个“规范波”测试（一种验证数值相对论代码的标准工具），探讨了 HLLE 求解器的耗散参数、约束阻尼以及约束违反增长之间的关系。这种实践培养了使用理想化测试平台来诊断数值格式行为并做出明智参数选择的关键技能 [@problem_id:3464380]。", "problem": "考虑一个一维线性对称双曲代理模型，该模型代表了爱因斯坦方程公式化中出现的约束传播子系统。令守恒变量为二分量向量 $U = (C, Z)^{\\mathsf{T}}$，其中 $C$ 表示标量约束，$Z$ 表示其共轭。该系统为\n$$\n\\partial_t U + \\partial_x F(U) = S(x,t),\n$$\n其通量和源项定义为\n$$\nF(U) = \\begin{pmatrix} Z \\\\ c^2 C \\end{pmatrix}, \\qquad S(x,t) = \\begin{pmatrix} -\\eta C \\\\ -\\eta Z + \\sigma\\, \\partial_x g(x,t) \\end{pmatrix}.\n$$\n此处，$c$ 是一个恒定的特征速度，$\\eta \\ge 0$ 是一个恒定的约束阻尼参数，$\\sigma \\ge 0$ 控制与一个给定背景规范波 $g(x,t)$ 的耦合，该规范波模拟了代码测试中使用的纯规范激发。令计算域为周期性，长度为 $L$，$x \\in [0,L)$，规范波定义为\n$$\ng(x,t) = A \\sin\\!\\big(k\\,[x - t]\\big), \\quad k = \\frac{2\\pi n}{L}, \\quad n \\in \\mathbb{Z}^{+},\n$$\n因此\n$$\n\\partial_x g(x,t) = A k \\cos\\!\\big(k\\,[x - t]\\big).\n$$\n你的任务是实现一个带有周期性边界条件的守恒型有限体积半离散化方法，并在单元交界面上使用 Harten-Lax-van Leer-Einfeldt (HLLE) 近似黎曼求解器。在每个交界面上，使用左行和右行信号速度的等幅估计 $s_L = -\\alpha$ 和 $s_R = +\\alpha$，其中 $\\alpha \\ge 0$ 是一个控制 HLLE 耗散的常数参数。使用三阶强稳定保持龙格-库塔 (SSP-RK3) 格式进行时间推进。设均匀网格有 $N$ 个单元，单元宽度为 $\\Delta x = L/N$，单元中心位于 $x_i = (i + 1/2)\\Delta x$，其中 $i = 0,1,\\dots,N-1$。在 $t = 0$ 时初始化，$C(x,0) = 0$ 且 $Z(x,0) = 0$。选择由 Courant-Friedrichs-Lewy (CFL) 数决定的恒定时间步长，\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max(\\alpha, c)}.\n$$\n演化至最终时间 $T$。在 $t=T$ 时，计算约束的离散 $L^2$ 范数，\n$$\n\\lVert C \\rVert_2 = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} C_i^2}.\n$$\n将此范数解释为强迫项和数值耗散共同作用下产生的约束违背量级的代理。你的目标是对于一个代表性的规范波驱动，评估 HLLE 耗散参数 $\\alpha$ 和其他数值相关参数如何影响 $\\lVert C \\rVert_2$。\n\n将以下内容按此精确顺序实现为一个固定的测试套件。对每个案例使用 $L = 1$，$n = 1$，$c = 1$，$A = 0.1$，$\\sigma = 0.5$，$T = 1.0$，以及列出的 $(\\alpha, \\eta, N, \\mathrm{CFL})$：\n\n- 案例 1：$\\alpha = 1.0$，$\\eta = 0.1$，$N = 256$，$\\mathrm{CFL} = 0.4$。\n- 案例 2：$\\alpha = 2.0$，$\\eta = 0.1$，$N = 256$，$\\mathrm{CFL} = 0.4$。\n- 案例 3：$\\alpha = 1.0$，$\\eta = 0.1$，$N = 256$，$\\mathrm{CFL} = 0.9$。\n- 案例 4：$\\alpha = 1.0$，$\\eta = 1.0$，$N = 256$，$\\mathrm{CFL} = 0.4$。\n- 案例 5：$\\alpha = 1.0$，$\\eta = 0.1$，$N = 1024$，$\\mathrm{CFL} = 0.4$。\n\n所有量均为无量纲，因此无需进行单位转换。\n\n你的程序必须：\n- 构建在所有交界面上具有 $s_L = -\\alpha$ 和 $s_R = \\alpha$ 的有限体积 HLLE 空间算子。\n- 实现 SSP-RK3，并在适当的阶段时间点上对非自治源项 $S(x,t)$ 进行阶段求值。\n- 使用周期性边界条件。\n- 对每个案例，报告在时间 $T$ 时的离散 $L^2$ 范数 $\\lVert C \\rVert_2$ 的结果。\n\n最终输出格式：你的程序应产生单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[r1,r2,r3,r4,r5]”），其中每个 $r_j$ 是按上述顺序排列的案例 $j$ 的 $\\lVert C \\rVert_2$ 的浮点数值。", "solution": "我们从线性对称双曲系统开始\n$$\n\\partial_t U + \\partial_x F(U) = S(x,t), \\quad U = \\begin{pmatrix} C \\\\ Z \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} Z \\\\ c^2 C \\end{pmatrix}, \\quad S(x,t) = \\begin{pmatrix} -\\eta C \\\\ -\\eta Z + \\sigma\\, \\partial_x g(x,t) \\end{pmatrix}.\n$$\n通量雅可比矩阵为常数矩阵\n$$\nA = \\frac{\\partial F}{\\partial U} = \\begin{pmatrix} 0  1 \\\\ c^2  0 \\end{pmatrix},\n$$\n其特征值为 $\\lambda_{\\pm} = \\pm c$，当 $c > 0$ 时构成一个严格双曲系统。HLLE (Harten-Lax-van Leer-Einfeldt) 近似黎曼求解器使用两个波速估计 $s_L \\le 0 \\le s_R$ 来界定所有特征速度；在本问题中，我们采用对称界\n$$\ns_L = -\\alpha, \\qquad s_R = \\alpha, \\qquad \\alpha \\ge 0,\n$$\n其中 $\\alpha$ 被解释为信号速度估计。对于交界面上的左状态 $U_L$ 和右状态 $U_R$，以及相应的物理通量 $F_L = F(U_L)$ 和 $F_R = F(U_R)$，HLLE 数值通量为\n$$\nF^{\\mathrm{HLLE}}(U_L,U_R) = \n\\begin{cases}\nF_L,  s_L \\ge 0,\\\\\nF_R,  s_R \\le 0,\\\\\n\\dfrac{s_R F_L - s_L F_R + s_L s_R (U_R - U_L)}{s_R - s_L},  s_L  0  s_R.\n\\end{cases}\n$$\n当 $s_L = -\\alpha$ 和 $s_R = \\alpha$ 时，在中间情况下我们得到\n$$\nF^{\\mathrm{HLLE}}(U_L,U_R) = \\frac{1}{2}\\big(F_L + F_R\\big) - \\frac{\\alpha}{2}\\big(U_R - U_L\\big).\n$$\n这表明 HLLE 通量简化为一个中心通量加上一个与 $\\alpha$ 成正比的耗散项，从而在半离散层面上引入了人工粘性，其尺度类似于 $\\nu_h \\sim \\frac{1}{2}\\alpha\\,\\Delta x$。对于由波数 $k$ 主导的光滑解，耗散率的尺度为 $\\nu_h k^2$，因此较大的 $\\alpha$ 会增加对高频分量的阻尼。在当前的强迫系统中，源项\n$$\nS(x,t) = \\begin{pmatrix} -\\eta C \\\\ -\\eta Z + \\sigma A k \\cos\\!\\big(k\\,[x - t]\\big) \\end{pmatrix}\n$$\n通过 Z 方程驱动约束。对于频率为 $kc$ 的稳态周期性强迫，物理阻尼 $\\eta$ 和数值粘性 $\\nu_h$ 之间的平衡调制了 $C$ 的响应振幅；过大的 $\\alpha$ 会同时对物理分量和伪分量产生阻尼，而较小的 $\\alpha$ 会减少数值阻尼，可能导致更大的振荡响应。因此，一个明智的选择是选取接近物理特征速度 $c$ 的 $\\alpha$ 以避免不必要的耗散，使用小于1的 Courant-Friedrichs-Lewy (CFL) 数来确保显式时间步进的稳定性，并增加分辨率 $N$ 来减少截断误差。阻尼系数 $\\eta$ 可以被调整以减少驱动约束的持续振幅。\n\n空间离散化是在具有周期性边界条件的均匀网格上，使用守恒型有限体积法进行的。设在时间 $t$ 的单元平均值为 $U_i(t) \\approx \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} U(x,t)\\,dx$。半离散的矩量法更新式为\n$$\n\\frac{d U_i}{dt} = -\\frac{1}{\\Delta x}\\left(F^{\\mathrm{HLLE}}_{i+1/2} - F^{\\mathrm{HLLE}}_{i-1/2}\\right) + S_i(t),\n$$\n其中 $F^{\\mathrm{HLLE}}_{i+1/2} = F^{\\mathrm{HLLE}}(U_i, U_{i+1})$，$S_i(t)$ 是在单元中心 $x_i$ 处求值的源项。通过对索引进行模 $N$ 环绕来强制实现周期性。\n\n时间积分使用三阶强稳定保持龙格-库塔 (SSP-RK3) 格式。对于一个一般的非自治常微分方程 $\\dot{U} = \\mathcal{L}(U,t)$，SSP-RK3 的各个阶段可以写作（其阶段时间与龙格-库塔的横坐标对齐）：\n1. $U^{(1)} = U^n + \\Delta t\\, \\mathcal{L}(U^n, t^n)$,\n2. $U^{(2)} = \\frac{3}{4} U^n + \\frac{1}{4}\\left[ U^{(1)} + \\Delta t\\, \\mathcal{L}(U^{(1)}, t^n + \\Delta t) \\right]$,\n3. $U^{n+1} = \\frac{1}{3} U^n + \\frac{2}{3}\\left[ U^{(2)} + \\Delta t\\, \\mathcal{L}(U^{(2)}, t^n + \\tfrac{1}{2}\\Delta t) \\right]$.\n时间步长选择为\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max(\\alpha, c)},\n$$\n其中 $\\mathrm{CFL} \\in (0,1)$。\n\n在 $t=0$ 时的初始数据为 $C(x,0)=0$ 和 $Z(x,0)=0$，规范波 $g(x,t)$ 由解析式给定，其中 $A = 0.1$，$L = 1$，$n = 1$ 因而 $k = 2\\pi$，并且余弦相位内的传播速度为单位速度。源项在每个阶段时间和单元中心使用 $\\partial_x g(x,t) = A k \\cos(k[x - t])$ 进行精确求值。\n\n我们感兴趣的可观测量是在最终时间 $T$ 的 $C$ 的离散 $L^2$ 范数，\n$$\n\\lVert C \\rVert_2 = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} C_i^2}.\n$$\n我们测试五种参数组合来探究 HLLE 耗散及其他参数的影响：\n- 案例 1：$\\alpha = 1.0$, $\\eta = 0.1$, $N = 256$, $\\mathrm{CFL} = 0.4$ (基线，$\\alpha \\approx c$),\n- 案例 2：$\\alpha = 2.0$, $\\eta = 0.1$, $N = 256$, $\\mathrm{CFL} = 0.4$ (过耗散的 HLLE),\n- 案例 3：$\\alpha = 1.0$, $\\eta = 0.1$, $N = 256$, $\\mathrm{CFL} = 0.9$ (接近稳定性极限的大时间步长),\n- 案例 4：$\\alpha = 1.0$, $\\eta = 1.0$, $N = 256$, $\\mathrm{CFL} = 0.4$ (强物理阻尼),\n- 案例 5：$\\alpha = 1.0$, $\\eta = 0.1$, $N = 1024$, $\\mathrm{CFL} = 0.4$ (加密的网格).\n\n基于半离散截断误差分析的定性预期：(i) 增加 $\\alpha$ 会增强人工粘性 $\\nu_h \\sim \\tfrac{1}{2}\\alpha \\Delta x$，这会阻尼响应并减小 $\\lVert C \\rVert_2$，但代价是额外的耗散；(ii) 增加 $\\mathrm{CFL}$ 会提高全局时间离散化误差，并可能增加 $\\lVert C \\rVert_2$；(iii) 增加 $\\eta$ 会通过物理阻尼减少持续振幅，从而减小 $\\lVert C \\rVert_2$；(iv) 增加 $N$ 会减少空间截断误差，通常会减小 $\\lVert C \\rVert_2$。\n\n基于这些考虑，一个旨在最小化约束违背且避免不必要过耗散的原则性参数选择是：取 $\\alpha$ 等于物理特征速度 $c$，为保证稳定性和准确性使用一个适中的 $\\mathrm{CFL}$（例如 $\\mathrm{CFL} \\approx 0.4$），包含与物理模型兼容的足够阻尼 $\\eta$，并在计算资源允许的情况下加密网格（大的 $N$）。随附的程序实现了所述的格式，并以所需格式输出指定测试套件的离散 $L^2$ 范数 $\\lVert C \\rVert_2$。", "answer": "```python\nimport numpy as np\n\ndef hlle_flux(U_left, U_right, c, alpha):\n    \"\"\"\n    Compute HLLE flux for the linear system:\n        U = [C, Z]^T, F(U) = [Z, c^2 * C]^T\n    with symmetric wave speed estimates sL = -alpha, sR = alpha.\n    Vectorized over all interfaces: U_left and U_right are shape (2, N).\n    Returns flux at interfaces, shape (2, N), corresponding to i+1/2.\n    \"\"\"\n    C_L, Z_L = U_left[0], U_left[1]\n    C_R, Z_R = U_right[0], U_right[1]\n\n    # Physical fluxes\n    F_L_0 = Z_L\n    F_L_1 = (c**2) * C_L\n    F_R_0 = Z_R\n    F_R_1 = (c**2) * C_R\n\n    # Central part\n    flux0 = 0.5 * (F_L_0 + F_R_0)\n    flux1 = 0.5 * (F_L_1 + F_R_1)\n\n    # Dissipative part\n    diss0 = 0.5 * alpha * (C_R - C_L)\n    diss1 = 0.5 * alpha * (Z_R - Z_L)\n\n    # HLLE flux equals central minus dissipation\n    flux0 -= diss0\n    flux1 -= diss1\n\n    return np.vstack((flux0, flux1))\n\ndef gauge_dx(x, t, A, k):\n    \"\"\"\n    Exact spatial derivative of the gauge wave: g_x = A*k*cos(k*(x - t)).\n    \"\"\"\n    return A * k * np.cos(k * (x - t))\n\ndef rhs(U, t, x, dx, c, alpha, eta, sigma, A, k):\n    \"\"\"\n    Compute spatial semi-discrete RHS for dU/dt = -div(F_hlle)/dx + S(x,t)\n    with periodic boundary conditions.\n    U shape: (2, N), components: U[0]=C, U[1]=Z\n    \"\"\"\n    N = U.shape[1]\n\n    # Periodic neighbor states\n    U_right = np.roll(U, -1, axis=1)  # U_{i+1}\n    U_left = U                         # U_i\n\n    # Interface fluxes at i+1/2\n    F_half = hlle_flux(U_left, U_right, c=c, alpha=alpha)  # shape (2,N)\n\n    # Flux divergence: (F_{i+1/2} - F_{i-1/2}) / dx\n    F_half_left = np.roll(F_half, 1, axis=1)  # F_{i-1/2}\n    divF = (F_half - F_half_left) / dx\n\n    # Source term at cell centers and time t\n    C = U[0]\n    Z = U[1]\n    S0 = -eta * C\n    S1 = -eta * Z + sigma * gauge_dx(x, t, A, k)\n\n    S = np.vstack((S0, S1))\n\n    # dU/dt = -divF + S\n    return -divF + S\n\ndef ssp_rk3_step(U, t, dt, x, dx, c, alpha, eta, sigma, A, k):\n    \"\"\"\n    Perform one SSP-RK3 time step for nonautonomous RHS(U, t).\n    Stage times follow the c = [0, 1, 1/2] abscissae.\n    \"\"\"\n    # Stage 1\n    L1 = rhs(U, t, x, dx, c, alpha, eta, sigma, A, k)\n    U1 = U + dt * L1\n\n    # Stage 2\n    L2 = rhs(U1, t + dt, x, dx, c, alpha, eta, sigma, A, k)\n    U2 = 0.75 * U + 0.25 * (U1 + dt * L2)\n\n    # Stage 3\n    L3 = rhs(U2, t + 0.5 * dt, x, dx, c, alpha, eta, sigma, A, k)\n    U_np1 = (1.0 / 3.0) * U + (2.0 / 3.0) * (U2 + dt * L3)\n\n    return U_np1\n\ndef run_case(alpha, eta, N, CFL, L=1.0, n=1, c=1.0, A=0.1, sigma=0.5, T=1.0):\n    \"\"\"\n    Run one simulation case and return the discrete L2 norm of C at time T.\n    \"\"\"\n    # Grid setup\n    dx = L / N\n    x = (np.arange(N) + 0.5) * dx\n    k = 2.0 * np.pi * n / L\n\n    # Time step\n    dt = CFL * dx / max(alpha, c)\n\n    # Initial condition: C = 0, Z = 0\n    U = np.zeros((2, N), dtype=np.float64)\n    t = 0.0\n\n    # Time integration loop\n    while t  T - 1e-15:\n        dt_step = min(dt, T - t)\n        U = ssp_rk3_step(U, t, dt_step, x, dx, c, alpha, eta, sigma, A, k)\n        t += dt_step\n\n    # Discrete L2 norm of C\n    C = U[0]\n    l2 = np.sqrt(dx * np.sum(C * C))\n    return float(l2)\n\ndef solve():\n    # Fixed parameters for all cases\n    L = 1.0\n    n = 1\n    c = 1.0\n    A = 0.1\n    sigma = 0.5\n    T = 1.0\n\n    # Test suite: (alpha, eta, N, CFL)\n    test_cases = [\n        (1.0, 0.1, 256, 0.4),  # Case 1\n        (2.0, 0.1, 256, 0.4),  # Case 2\n        (1.0, 0.1, 256, 0.9),  # Case 3\n        (1.0, 1.0, 256, 0.4),  # Case 4\n        (1.0, 0.1, 1024, 0.4), # Case 5\n    ]\n\n    results = []\n    for alpha, eta, N, CFL in test_cases:\n        l2 = run_case(alpha=alpha, eta=eta, N=N, CFL=CFL, L=L, n=n, c=c, A=A, sigma=sigma, T=T)\n        results.append(l2)\n\n    # Final output in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3464380"}]}