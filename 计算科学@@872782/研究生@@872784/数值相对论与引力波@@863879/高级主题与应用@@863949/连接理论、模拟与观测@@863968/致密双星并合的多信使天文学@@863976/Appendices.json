{"hands_on_practices": [{"introduction": "中子星-黑洞并合事件是否能产生电磁对应体并非必然，这关键取决于中子星是在被整个吞噬之前，还是先被潮汐力撕裂。本练习 [@problem_id:3480628] 提供了一个动手推导的机会，以确定这一关键边界。通过平衡黑洞的潮汐力与中子星的自引力，你将计算出允许发生潮汐瓦解（这是驱动千新星爆发的关键过程）的最大黑洞质量。", "problem": "我们建立一个中子星-黑洞双星模型，以评估中子星 (NS) 的潮汐瓦解是否会发生在黑洞 (BH) 的最内稳定圆轨道 (ISCO) 之外。这种情况通常与除了引力波 (GW) 之外还存在电磁 (EM) 对应体有关。考虑一颗引力质量为 $M_{\\mathrm{NS}}=1.40\\,M_{\\odot}$、面积半径为 $R_{\\mathrm{NS}}=12\\,\\mathrm{km}$ 的中子星，它围绕一个无量纲自旋参数为 $\\chi=0.90$ 的 Kerr 黑洞在赤道面顺行圆轨道上运动，其自旋与轨道角动量对齐。假设两个天体均遵循广义相对论 (GR)，将中子星外部时空处理为 Schwarzschild 时空，将黑洞时空处理为 Kerr 时空。\n\n从以下原理出发：\n- 由黑洞引力场引起、作用于中子星上的领头阶潮汐加速度与引力场的梯度成正比，在牛顿四极近似下，对于轨道间距为 $r$ 的情况，其大小正比于 $2 G M_{\\mathrm{BH}} r^{-3} R_{\\mathrm{NS}}$，其中 $M_{\\mathrm{BH}}$ 是黑洞质量，$G$ 是牛顿常数，$c$ 是光速。\n- 在 Schwarzschild 时空中，由位于中子星表面的静态观测者测得的固有表面引力，相对于牛顿值会因一个红移因子而增强，可取为 $g_{\\mathrm{surf}} \\approx \\left(G M_{\\mathrm{NS}}/R_{\\mathrm{NS}}^{2}\\right)/\\sqrt{1-2 C}$，其中 $C \\equiv G M_{\\mathrm{NS}}/(R_{\\mathrm{NS}} c^{2})$ 是中子星的致密性。\n- 在 Kerr 时空中，对于质量为 $M_{\\mathrm{BH}}$、自旋为 $\\chi$ 的黑洞，赤道面顺行运动的最内稳定圆轨道半径由标准的广义相对论表达式 $r_{\\mathrm{ISCO}}(\\chi)$ 给出。\n\n采用以下瓦解判据：如果通过令黑洞潮汐加速度大小与中子星固有表面引力相等而得到的潮汐瓦解半径 $r_{t}$ 满足 $r_{t} \\gtrsim r_{\\mathrm{ISCO}}(\\chi)$，则潮汐瓦解发生在 ISCO 之外。在评估 $r_{\\mathrm{ISCO}}(\\chi)$ 时，在检验粒子极限下处理轨道动力学。\n\n仅使用上述原理，推导当 $r_{t} = r_{\\mathrm{ISCO}}(\\chi)$ 时，最大黑洞质量 $M_{\\mathrm{BH,crit}}$ 的解析表达式，该表达式应以 $M_{\\mathrm{NS}}$、$R_{\\mathrm{NS}}$、$G$、$c$ 和 $\\chi$ 表示。然后，对于给定的 $M_{\\mathrm{NS}}=1.40\\,M_{\\odot}$、$R_{\\mathrm{NS}}=12\\,\\mathrm{km}$ 和 $\\chi=0.90$，对此表达式进行数值计算。将 $M_{\\mathrm{BH,crit}}$ 的最终结果以 $M_{\\odot}$ 为单位表示，并将答案四舍五入到三位有效数字。以太阳质量为单位，将最终答案表述为单个数字。", "solution": "该问题陈述经评估具有科学依据、良定、客观且自洽。所提供的物理原理和近似，例如牛顿四极潮汐加速度和对中子星表面引力的广义相对论修正，是天体物理建模中的标准工具。对 Kerr 时空中最内稳定圆轨道 (ISCO) 的标准广义相对论表达式的引用是明确的。为中子星 (NS) 质量、半径和黑洞 (BH) 自旋提供的数值是符合物理实际的。因此，该问题被认为是有效的。我们着手进行推导和求解。\n\n问题要求找到临界黑洞质量 $M_{\\mathrm{BH,crit}}$，在该质量下，中子星恰好在黑洞的最内稳定圆轨道 $r_{\\mathrm{ISCO}}$ 处发生潮汐瓦解。此条件表示为 $r_{t} = r_{\\mathrm{ISCO}}$，其中 $r_t$ 是潮汐瓦解半径。\n\n首先，我们建立潮汐瓦解半径 $r_t$ 的表达式。这是指当黑洞施加于中子星上的潮汐加速度 $a_{\\mathrm{tidal}}$ 等于中子星自身的固有表面引力 $g_{\\mathrm{surf}}$ 时的轨道间距。\n\n根据问题陈述，潮汐加速度由下式给出：\n$$ a_{\\mathrm{tidal}} = \\frac{2 G M_{\\mathrm{BH}} R_{\\mathrm{NS}}}{r^3} $$\n其中 $M_{\\mathrm{BH}}$ 是黑洞质量，$R_{\\mathrm{NS}}$ 是中子星半径，$r$ 是轨道间距，$G$ 是引力常数。\n\n中子星的固有表面引力由下式给出：\n$$ g_{\\mathrm{surf}} = \\frac{G M_{\\mathrm{NS}}}{R_{\\mathrm{NS}}^{2}} \\frac{1}{\\sqrt{1-2 C}} $$\n其中 $M_{\\mathrm{NS}}$ 是中子星质量，$C$ 是其致密性，定义为：\n$$ C = \\frac{G M_{\\mathrm{NS}}}{R_{\\mathrm{NS}} c^{2}} $$\n其中 $c$ 是光速。\n\n在潮汐半径 $r = r_t$ 处，令 $a_{\\mathrm{tidal}}$ 与 $g_{\\mathrm{surf}}$ 相等，我们得到：\n$$ \\frac{2 G M_{\\mathrm{BH}} R_{\\mathrm{NS}}}{r_t^3} = \\frac{G M_{\\mathrm{NS}}}{R_{\\mathrm{NS}}^{2}} \\frac{1}{\\sqrt{1-2 C}} $$\n解出 $r_t^3$：\n$$ r_t^3 = \\frac{2 M_{\\mathrm{BH}} R_{\\mathrm{NS}}^3}{M_{\\mathrm{NS}}} \\sqrt{1-2 C} $$\n因此，潮汐瓦解半径为：\n$$ r_t = R_{\\mathrm{NS}} \\left( 2 \\frac{M_{\\mathrm{BH}}}{M_{\\mathrm{NS}}} \\right)^{1/3} (1-2C)^{1/6} $$\n\n接下来，我们给出围绕质量为 $M_{\\mathrm{BH}}$、无量纲自旋参数为 $\\chi$ 的 Kerr 黑洞的顺行赤道轨道的最内稳定圆轨道半径 $r_{\\mathrm{ISCO}}$。来自广义相对论的标准表达式为：\n$$ r_{\\mathrm{ISCO}}(\\chi) = \\frac{G M_{\\mathrm{BH}}}{c^2} \\tilde{r}_{\\mathrm{ISCO}}(\\chi) $$\n其中 $\\tilde{r}_{\\mathrm{ISCO}}(\\chi)$ 是一个取决于自旋 $\\chi$ 的无量纲因子：\n$$ \\tilde{r}_{\\mathrm{ISCO}}(\\chi) = 3 + Z_2 - \\sqrt{(3-Z_1)(3+Z_1+2Z_2)} $$\n项 $Z_1$ 和 $Z_2$ 定义为：\n$$ Z_1 = 1 + (1-\\chi^2)^{1/3} \\left[ (1+\\chi)^{1/3} + (1-\\chi)^{1/3} \\right] $$\n$$ Z_2 = \\sqrt{3\\chi^2 + Z_1^2} $$\n\n在 ISCO 处发生瓦解的临界条件是 $r_t = r_{\\mathrm{ISCO}}$，此时黑洞质量为临界质量 $M_{\\mathrm{BH,crit}}$。\n$$ R_{\\mathrm{NS}} \\left( 2 \\frac{M_{\\mathrm{BH,crit}}}{M_{\\mathrm{NS}}} \\right)^{1/3} (1-2C)^{1/6} = \\frac{G M_{\\mathrm{BH,crit}}}{c^2} \\tilde{r}_{\\mathrm{ISCO}}(\\chi) $$\n为了求得 $M_{\\mathrm{BH,crit}}$ 的解析表达式，我们重新整理方程以分离出 $M_{\\mathrm{BH,crit}}$：\n$$ \\frac{M_{\\mathrm{BH,crit}}}{M_{\\mathrm{BH,crit}}^{1/3}} = M_{\\mathrm{BH,crit}}^{2/3} = \\frac{R_{\\mathrm{NS}} c^2}{G \\tilde{r}_{\\mathrm{ISCO}}(\\chi)} \\left( \\frac{2}{M_{\\mathrm{NS}}} \\right)^{1/3} (1-2C)^{1/6} $$\n将两边同时取 $3/2$ 次方，得到所求表达式：\n$$ M_{\\mathrm{BH,crit}} = \\left( \\frac{R_{\\mathrm{NS}} c^2}{G \\tilde{r}_{\\mathrm{ISCO}}(\\chi)} \\right)^{3/2} \\left( \\frac{2}{M_{\\mathrm{NS}}} \\right)^{1/2} (1-2C)^{1/4} $$\n代入致密性 $C = G M_{\\mathrm{NS}}/(R_{\\mathrm{NS}} c^{2})$ 的定义可以简化物理诠释和计算。设 $q = M_{\\mathrm{BH}}/M_{\\mathrm{NS}}$ 为质量比。临界条件变为：\n$$ R_{\\mathrm{NS}} (2q_{\\mathrm{crit}})^{1/3} (1-2C)^{1/6} = \\frac{G q_{\\mathrm{crit}} M_{\\mathrm{NS}}}{c^2} \\tilde{r}_{\\mathrm{ISCO}}(\\chi) $$\n除以 $q_{\\mathrm{crit}}^{1/3}$ 并重新整理得到：\n$$ q_{\\mathrm{crit}}^{2/3} = \\frac{R_{\\mathrm{NS}} c^2}{G M_{\\mathrm{NS}}} \\frac{2^{1/3} (1-2C)^{1/6}}{\\tilde{r}_{\\mathrm{ISCO}}(\\chi)} = \\frac{1}{C} \\frac{2^{1/3} (1-2C)^{1/6}}{\\tilde{r}_{\\mathrm{ISCO}}(\\chi)} $$\n所以，临界质量比 $q_{\\mathrm{crit}}$ 是：\n$$ q_{\\mathrm{crit}} = \\left( \\frac{2^{1/3} (1-2C)^{1/6}}{C \\tilde{r}_{\\mathrm{ISCO}}(\\chi)} \\right)^{3/2} = \\frac{\\sqrt{2} (1-2C)^{1/4}}{C^{3/2} (\\tilde{r}_{\\mathrm{ISCO}}(\\chi))^{3/2}} $$\n临界黑洞质量则为 $M_{\\mathrm{BH,crit}} = q_{\\mathrm{crit}} M_{\\mathrm{NS}}$。\n\n现在，我们用给定的数值对该表达式进行数值计算：\n$M_{\\mathrm{NS}} = 1.40\\,M_{\\odot}$\n$R_{\\mathrm{NS}} = 12\\,\\mathrm{km}$\n$\\chi = 0.90$\n\n首先，我们计算中子星的致密性 $C$。我们使用数值 $G M_{\\odot}/c^2 \\approx 1.477\\,\\mathrm{km}$。\n$$ C = \\frac{G M_{\\mathrm{NS}}}{R_{\\mathrm{NS}} c^2} = \\frac{1.40 \\times (G M_{\\odot}/c^2)}{12\\,\\mathrm{km}} = \\frac{1.40 \\times 1.477\\,\\mathrm{km}}{12\\,\\mathrm{km}} \\approx 0.172317 $$\n\n接下来，我们计算 $\\chi = 0.90$ 时的无量纲 ISCO 半径 $\\tilde{r}_{\\mathrm{ISCO}}(\\chi)$。\n对于 $\\chi=0.90$，我们有 $\\chi^2=0.81$。\n$$ Z_1 = 1 + (1-0.81)^{1/3} \\left[ (1+0.9)^{1/3} + (1-0.9)^{1/3} \\right] $$\n$$ Z_1 = 1 + (0.19)^{1/3} \\left[ (1.9)^{1/3} + (0.1)^{1/3} \\right] $$\n$$ Z_1 \\approx 1 + (0.57488) \\left[ 1.23856 + 0.46416 \\right] = 1 + (0.57488)(1.70272) \\approx 1.97886 $$\n然后，我们计算 $Z_2$：\n$$ Z_2 = \\sqrt{3\\chi^2 + Z_1^2} = \\sqrt{3(0.81) + (1.97886)^2} = \\sqrt{2.43 + 3.91590} = \\sqrt{6.34590} \\approx 2.51911 $$\n最后，我们计算 $\\tilde{r}_{\\mathrm{ISCO}}(0.90)$：\n$$ \\tilde{r}_{\\mathrm{ISCO}}(0.90) = 3 + Z_2 - \\sqrt{(3-Z_1)(3+Z_1+2Z_2)} $$\n$$ \\tilde{r}_{\\mathrm{ISCO}}(0.90) \\approx 3 + 2.51911 - \\sqrt{(3-1.97886)(3+1.97886+2(2.51911))} $$\n$$ \\tilde{r}_{\\mathrm{ISCO}}(0.90) \\approx 5.51911 - \\sqrt{(1.02114)(10.01708)} \\approx 5.51911 - \\sqrt{10.2289} \\approx 5.51911 - 3.19827 \\approx 2.32084 $$\n\n现在我们可以计算临界质量比 $q_{\\mathrm{crit}}$：\n$$ q_{\\mathrm{crit}} = \\frac{\\sqrt{2} (1-2 \\times 0.172317)^{1/4}}{(0.172317)^{3/2} (2.32084)^{3/2}} $$\n$$ q_{\\mathrm{crit}} \\approx \\frac{1.41421 \\times (1-0.344634)^{1/4}}{(0.071485) (3.53580)} \\approx \\frac{1.41421 \\times (0.655366)^{1/4}}{0.25278} \\approx \\frac{1.41421 \\times 0.9001}{0.25278} \\approx \\frac{1.27293}{0.25278} \\approx 5.0357 $$\n\n最后，我们求出临界黑洞质量：\n$$ M_{\\mathrm{BH,crit}} = q_{\\mathrm{crit}} M_{\\mathrm{NS}} \\approx 5.0357 \\times 1.40\\,M_{\\odot} \\approx 7.050\\,M_{\\odot} $$\n四舍五入到三位有效数字，结果是 $7.05\\,M_{\\odot}$。", "answer": "$$\\boxed{7.05}$$", "id": "3480628"}, {"introduction": "多信使天文学最深远的应用之一是利用“标准汽笛”对宇宙膨胀率——哈勃常数 $H_0$ ——进行独立测量。该方法将引力波测得的距离与通过电磁对应体识别的星系红移相结合。在此实践中 [@problem_id:3480634]，你将为单个标准汽笛事件实现一个完整的贝叶斯推断框架，以测量 $H_0$。你将学习如何整合实际的天体物理效应，如本动速度和观测选择偏误，从而得到对宇宙学参数的稳健估计。", "problem": "你的任务是利用具有已知宿主星系的单个多信使标准汽笛事件，构建对哈勃常数 ($H_0$)的原则性贝叶斯推断。你的推断必须包含宿主的光谱红移、宿主本动速度场模型、通过探测视界的选择效应，以及对速度不确定性的宇宙方差贡献。你必须将宇宙方差的贡献传播到 $H_0$ 的后验分布中，并报告后验摘要。该问题基于低红移的哈勃-勒梅特定律和来自引力波的标准汽笛距离测量。\n\n使用的基本和模型假设：\n- 在空间曲率和高阶项可忽略的足够低的红移处，退行速度遵循局域哈勃-勒梅特关系 $v \\approx H_0 d$，其中 $v$ 是退行速度，$d$ 是光度距离，两者均以兼容的单位表示。\n- 观测到的光谱红移 $z_{\\mathrm{obs}}$ 映射到观测退行速度 $v_{\\mathrm{obs}} = c z_{\\mathrm{obs}}$，其中 $c$ 是光速。红移 $z_{\\mathrm{obs}}$ 的测量不确定性被建模为标准差为 $\\sigma_z$ 的高斯分布，这意味着速度不确定性分量为 $c \\sigma_z$。\n- 宿主本动速度场模型提供了一个预测的视线速度 $v_{\\mathrm{field}}$，其高斯残差不确定性为 $\\sigma_{\\mathrm{pec}}$，该不确定性捕捉了对本动流的不完美认知；此外，一个宇宙方差项 $\\sigma_{\\mathrm{cv}}$ 代表了无法被流模型和有限体积效应完美捕捉的随机大尺度结构涨落。这些不确定性在速度域中正交相加。\n- 来自引力波的标准汽笛光度距离测量值 $d_{L,\\mathrm{obs}}$ 被建模为围绕真实光度距离 $d_L$ 的高斯分布，其标准差为 $\\sigma_{d_L}$。\n- 与探测相关的选择效应通过对 $d_L$ 的截断先验来捕捉，该先验在探测视界内的共动体积中是均匀的，这在低红移情况下意味着对于 $0  d_L  d_{\\max}$，先验密度为 $p(d_L) \\propto d_L^2$，否则 $p(d_L) = 0$。这代表了作用于原本按体积加权的源分布上的探测视界截断。\n\n在这些假设下，基于观测到的宿主退行速度和观测到的光度距离的联合似然，通过对潜在的真实光度距离 $d_L$ 进行边缘化，构建 $H_0$ 的边缘后验密度：\n$$\np(H_0 \\mid v_{\\mathrm{obs}}, d_{L,\\mathrm{obs}}) \\propto \\int_{0}^{d_{\\max}}\n\\mathcal{N}\\!\\left(v_{\\mathrm{obs}} \\mid H_0 d_L + v_{\\mathrm{field}}, \\sigma_v\\right)\\,\n\\mathcal{N}\\!\\left(d_{L,\\mathrm{obs}} \\mid d_L, \\sigma_{d_L}\\right)\\,\nd_L^2 \\, \\mathrm{d}d_L,\n$$\n其中\n$$\n\\sigma_v = \\sqrt{(c \\sigma_z)^2 + \\sigma_{\\mathrm{pec}}^2 + \\sigma_{\\mathrm{cv}}^2},\n$$\n且 $\\mathcal{N}(x \\mid \\mu, \\sigma)$ 是变量为 $x$、均值为 $\\mu$、标准差为 $\\sigma$ 的高斯密度。为 $H_0$ 采用一个宽泛的、正常的先验，它在闭区间 $[H_{\\min}, H_{\\max}]$上是均匀的，且 $H_{\\min}  H_{\\max}$。你必须在指定的先验区间上对 $H_0$ 的后验进行归一化。\n\n你的程序必须：\n- 实现上述模型，不引入额外的启发式修正。\n- 在一个跨越 $[H_{\\min}, H_{\\max}]$、步长固定的 $H_0$ 数值网格上计算归一化的后验 $p(H_0 \\mid v_{\\mathrm{obs}}, d_{L,\\mathrm{obs}})$，然后计算 $H_0$ 的后验均值、后验标准差和最大后验（MAP）估计量。\n- 以一致的单位处理所有物理量：$H_0$ 使用 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$，$d_L$ 使用 $\\mathrm{Mpc}$，$v$ 使用 $\\mathrm{km\\,s^{-1}}$，$c$ 使用 $\\mathrm{km\\,s^{-1}}$，$z$ 无单位。所有报告的 $H_0$ 结果均以 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$ 表示，并四舍五入到三位小数。\n\n测试套件：\n评估你对以下四个参数集的推断。对于每种情况，使用 $H_{\\min} = 20$, $H_{\\max} = 120$ 和 $\\Delta H_0 = 0.2$ (单位均为 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$)。使用 $c = 299{,}792.458$ (单位为 $\\mathrm{km\\,s^{-1}}$)。参数以元组形式指定\n$$\n(d_{L,\\mathrm{obs}}, \\sigma_{d_L}, z_{\\mathrm{obs}}, \\sigma_z, v_{\\mathrm{field}}, \\sigma_{\\mathrm{pec}}, \\sigma_{\\mathrm{cv}}, d_{\\max}),\n$$\n单位与模型规范相匹配：\n- 情况1（典型的类双中子星）：$(40, 8, 0.009, 0.0001, 300, 150, 100, 200)$。\n- 情况2（低红移，大宇宙方差）：$(20, 4, 0.004, 0.0001, 250, 200, 300, 150)$。\n- 情况3（接近探测视界，极少流信息）：$(180, 36, 0.040, 0.0002, 0, 300, 150, 200)$。\n- 情况4（强本动流）：$(60, 12, 0.015, 0.0001, 700, 400, 100, 250)$。\n\n答案规范：\n对于每个测试用例，计算并报告一个包含三个值的列表 $[ \\mu_{H_0}, \\sigma_{H_0}, H_{0,\\mathrm{MAP}} ]$，其中 $\\mu_{H_0}$ 是 $H_0$ 的后验均值，$\\sigma_{H_0}$ 是 $H_0$ 的后验标准差，$H_{0,\\mathrm{MAP}}$ 是 $H_0$ 的最大后验估计量。所有三个值都必须以 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$ 为单位，并四舍五入到三位小数。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含四个测试用例的结果，形式为方括号括起来的、以逗号分隔的列表的列表。顺序必须与上面给出的情况1到情况4相对应。例如，输出必须如下所示：\n$$\n[\\,[\\mu_1, \\sigma_1, \\mathrm{MAP}_1],\\,[\\mu_2, \\sigma_2, \\mathrm{MAP}_2],\\,[\\mu_3, \\sigma_3, \\mathrm{MAP}_3],\\,[\\mu_4, \\sigma_4, \\mathrm{MAP}_4]\\,].\n$$", "solution": "目标是使用来自单个多信使标准汽笛事件的数据，对哈勃常数 $H_0$ 进行贝叶斯推断。数据表示为 $\\mathcal{D}$，包括观测到的光度距离 $d_{L,\\mathrm{obs}}$（来自引力波）和观测到的退行速度 $v_{\\mathrm{obs}}$（来自宿主星系的光谱红移 $z_{\\mathrm{obs}}$）。\n\n根据贝叶斯定理，$H_0$ 在给定数据 $\\mathcal{D}$ 下的后验概率密度函数（PDF）与给定 $H_0$ 的数据似然和 $H_0$ 的先验概率的乘积成正比：\n$$\np(H_0 \\mid \\mathcal{D}) \\propto p(\\mathcal{D} \\mid H_0) \\, p(H_0)\n$$\n问题指定了 $H_0$ 在区间 $[H_{\\min}, H_{\\max}]$ 上的均匀先验，因此 $p(H_0)$ 在此范围内为常数，否则为零。\n\n似然 $p(\\mathcal{D} \\mid H_0)$ 因理论模型将 $H_0$ 与真实的、未观测到的（潜在的）光度距离 $d_L$ 联系起来而变得复杂。因此，我们必须通过对 $d_L$ 的所有可能值进行积分来获得边缘似然：\n$$\np(\\mathcal{D} \\mid H_0) = \\int p(\\mathcal{D}, d_L \\mid H_0) \\, \\mathrm{d}d_L\n$$\n使用概率的链式法则，$p(\\mathcal{D}, d_L \\mid H_0) = p(\\mathcal{D} \\mid d_L, H_0) \\, p(d_L \\mid H_0)$。由于源距离的分布 $p(d_L)$ 不依赖于 $H_0$，这可以简化为 $p(\\mathcal{D} \\mid d_L, H_0) \\, p(d_L)$。此外，在给定 $d_L$ 和 $H_0$ 的条件下，测量值 $v_{\\mathrm{obs}}$ 和 $d_{L,\\mathrm{obs}}$ 是条件独立的。具体来说，$d_{L,\\mathrm{obs}}$ 仅依赖于 $d_L$，而 $v_{\\mathrm{obs}}$ 依赖于 $d_L$ 和 $H_0$。因此，联合似然为：\n$$\np(\\mathcal{D} \\mid d_L, H_0) = p(v_{\\mathrm{obs}} \\mid d_L, H_0) \\, p(d_{L,\\mathrm{obs}} \\mid d_L)\n$$\n\n模型假设定义了这些概率分布：\n1. 观测距离 $d_{L,\\mathrm{obs}}$ 的似然是围绕真实距离 $d_L$ 的高斯分布，其标准差为 $\\sigma_{d_L}$：\n   $$\n   p(d_{L,\\mathrm{obs}} \\mid d_L) = \\mathcal{N}(d_{L,\\mathrm{obs}} \\mid d_L, \\sigma_{d_L}) = \\frac{1}{\\sqrt{2\\pi}\\sigma_{d_L}} \\exp\\left(-\\frac{(d_{L,\\mathrm{obs}} - d_L)^2}{2\\sigma_{d_L}^2}\\right)\n   $$\n2. 观测退行速度 $v_{\\mathrm{obs}} = c z_{\\mathrm{obs}}$ 的似然是围绕模型预测速度的高斯分布。模型速度是哈勃流 $H_0 d_L$ 和预测的本动速度 $v_{\\mathrm{field}}$ 之和。总速度不确定性 $\\sigma_v$ 将来自红移测量（$c\\sigma_z$）、本动速度模型（$\\sigma_{\\mathrm{pec}}$）和宇宙方差（$\\sigma_{\\mathrm{cv}}$）的不确定性正交相加：\n   $$\n   p(v_{\\mathrm{obs}} \\mid d_L, H_0) = \\mathcal{N}(v_{\\mathrm{obs}} \\mid H_0 d_L + v_{\\mathrm{field}}, \\sigma_v) = \\frac{1}{\\sqrt{2\\pi}\\sigma_v} \\exp\\left(-\\frac{(v_{\\mathrm{obs}} - (H_0 d_L + v_{\\mathrm{field}}))^2}{2\\sigma_v^2}\\right)\n   $$\n   其中 $\\sigma_v = \\sqrt{(c \\sigma_z)^2 + \\sigma_{\\mathrm{pec}}^2 + \\sigma_{\\mathrm{cv}}^2}$。\n3. 真实距离 $d_L$ 的先验考虑了选择效应，被建模为在探测视界 $d_{\\max}$ 内的共动体积中的均匀分布。对于低红移范围，这对应于当 $d_L \\in (0, d_{\\max})$ 时，先验PDF为 $p(d_L) \\propto d_L^2$，否则 $p(d_L) = 0$。\n\n结合这些元素，$H_0$ 的未归一化边缘后验由对 $d_L$ 的积分给出：\n$$\np(H_0 \\mid \\mathcal{D}) \\propto \\int_{0}^{d_{\\max}}\n\\mathcal{N}\\!\\left(v_{\\mathrm{obs}} \\mid H_0 d_L + v_{\\mathrm{field}}, \\sigma_v\\right)\\,\n\\mathcal{N}\\!\\left(d_{L,\\mathrm{obs}} \\mid d_L, \\sigma_{d_L}\\right)\\,\nd_L^2 \\, \\mathrm{d}d_L\n$$\n该积分没有通用的闭式解析解，必须进行数值计算。\n\n数值计算步骤如下：\n1. 定义一个 $H_0$ 值的离散网格，从 $H_{\\min} = 20 \\, \\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$ 到 $H_{\\max} = 120 \\, \\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$，步长为 $\\Delta H_0 = 0.2 \\, \\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$。\n2. 对于网格上的每个值 $H_{0,i}$，通过对上述表达式从 $d_L = 0$ 到 $d_L = d_{\\max}$ 进行数值积分来计算相应的未归一化后验值 $P_i$。我们使用标准的求积程序进行此积分。被积函数是两个高斯似然和 $d_L^2$ 项的乘积。任何与 $H_0$ 无关的常数前置因子都可以省略，因为它们在归一化过程中会被抵消。\n3. 得到的未归一化后验值数组 $\\{P_i\\}$ 代表了离散网格 $\\{H_{0,i}\\}$ 上的后验分布。我们从这个离散表示中计算摘要统计量。\n4. 后验均值 $\\mu_{H_0}$ 被计算为 $H_0$ 在离散后验上的期望值：\n   $$\n   \\mu_{H_0} = \\mathbb{E}[H_0] = \\frac{\\sum_i H_{0,i} P_i}{\\sum_i P_i}\n   $$\n5. 后验方差 $\\sigma_{H_0}^2$ 计算为 $\\mathbb{E}[H_0^2] - (\\mathbb{E}[H_0])^2$，其中 $\\mathbb{E}[H_0^2] = \\frac{\\sum_i H_{0,i}^2 P_i}{\\sum_i P_i}$。标准差 $\\sigma_{H_0}$ 是方差的平方根。\n6. 最大后验（MAP）估计 $H_{0,\\mathrm{MAP}}$ 是网格上对应于最大后验概率值 $P_i$ 的 $H_0$ 值。\n\n该方法在提供的 Python 代码中实现，该代码通过设置特定参数、在 $H_0$ 网格上执行数值积分以及计算所需的后验摘要来处理每个测试用例。最终结果按指定格式进行格式化。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It orchestrates the calculation of posterior summaries for H0 for each case\n    and prints the final result in the specified format.\n    \"\"\"\n    C = 299792.458  # Speed of light in km/s\n\n    # H0 grid parameters\n    H_min = 20.0\n    H_max = 120.0\n    delta_H = 0.2\n\n    # Test cases: (d_L_obs, sigma_d_L, z_obs, sigma_z, v_field, sigma_pec, sigma_cv, d_max)\n    test_cases = [\n        (40, 8, 0.009, 0.0001, 300, 150, 100, 200),\n        (20, 4, 0.004, 0.0001, 250, 200, 300, 150),\n        (180, 36, 0.040, 0.0002, 0, 300, 150, 200),\n        (60, 12, 0.015, 0.0001, 700, 400, 100, 250),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        summaries = compute_h0_inference(case, C, H_min, H_max, delta_H)\n        all_results.append(summaries)\n\n    # Format the final output string as a list of lists.\n    # e.g., [[val1,val2,val3],[val4,val5,val6]]\n    result_strings = []\n    for res_list in all_results:\n        # Round to 3 decimal places and format\n        s = f\"[{res_list[0]:.3f},{res_list[1]:.3f},{res_list[2]:.3f}]\"\n        result_strings.append(s)\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\ndef compute_h0_inference(params, c_val, h_min, h_max, delta_h):\n    \"\"\"\n    Computes the posterior mean, std dev, and MAP for H0 for a single event.\n\n    Args:\n        params (tuple): A tuple containing the event parameters.\n        c_val (float): The speed of light in km/s.\n        h_min (float): The minimum of the H0 grid.\n        h_max (float): The maximum of the H0 grid.\n        delta_h (float): The step size of the H0 grid.\n\n    Returns:\n        list: A list containing [posterior_mean, posterior_std, posterior_map] for H0.\n    \"\"\"\n    d_L_obs, sigma_d_L, z_obs, sigma_z, v_field, sigma_pec, sigma_cv, d_max = params\n\n    v_obs = c_val * z_obs\n    sigma_v = np.sqrt((c_val * sigma_z)**2 + sigma_pec**2 + sigma_cv**2)\n\n    H0_grid = np.arange(h_min, h_max + delta_h / 2, delta_h)\n    unnormalized_posterior = np.zeros_like(H0_grid)\n\n    def integrand(d_L, H0):\n        \"\"\"\n        The integrand for marginalizing over the true distance d_L.\n        This calculates the product of two Gaussian likelihoods and the d_L^2 prior term.\n        Normalization constants for the Gaussians are omitted as they are independent of H0.\n        \"\"\"\n        # Exponent from the velocity likelihood\n        v_model = H0 * d_L + v_field\n        exp_v = -0.5 * ((v_obs - v_model) / sigma_v)**2\n        \n        # Exponent from the distance likelihood\n        exp_d = -0.5 * ((d_L_obs - d_L) / sigma_d_L)**2\n        \n        # d_L^2 from the volume prior\n        return d_L**2 * np.exp(exp_v + exp_d)\n\n    for i, H0 in enumerate(H0_grid):\n        # Numerical integration over d_L from 0 to d_max\n        integral_val, _ = quad(integrand, 0, d_max, args=(H0,))\n        unnormalized_posterior[i] = integral_val\n\n    # Normalize the posterior (for calculations, sum is enough)\n    # Using the sum of unnormalized values is equivalent to using a proper\n    # normalized discrete probability mass function for calculating moments.\n    total_prob_mass = np.sum(unnormalized_posterior)\n    if total_prob_mass == 0:\n        # Handle cases where the posterior is zero everywhere on the grid\n        return [0.0, 0.0, 0.0]\n\n    # Calculate posterior mean\n    mean_H0 = np.sum(H0_grid * unnormalized_posterior) / total_prob_mass\n\n    # Calculate posterior variance and standard deviation\n    variance_H0 = np.sum((H0_grid**2) * unnormalized_posterior) / total_prob_mass - mean_H0**2\n    std_dev_H0 = np.sqrt(variance_H0)\n\n    # Find Maximum A Posteriori (MAP) estimate\n    map_H0 = H0_grid[np.argmax(unnormalized_posterior)]\n\n    return [mean_H0, std_dev_H0, map_H0]\n\n# Execute the solver\nsolve()\n```", "id": "3480634"}, {"introduction": "在引力波事件之后未能探测到电磁对应体，这本身并非信息的缺失，反而是揭示并合物理过程的关键线索。这种“非探测”可能暗示了并合遗迹迅速塌缩成了黑洞，而这一过程又与未知的致密物质状态方程紧密相关。这项高级练习 [@problem_id:3480640] 将指导你构建一个删失似然分析，以推断中子星的最大质量 $M_{\\rm TOV}$。通过对迅速塌缩和电磁信号过暗而未被探测这两种可能性进行统计建模，你将了解到即便是“零结果”的观测也能为基础物理学提供强有力的约束。", "problem": "观测到了一个引力波事件族群，假设其为双中子星并合事件，但在指定的流量极限下未观测到任何电磁（EM）对应体。没有电磁辐射的原因可能有两个：一是迅速塌缩为黑洞，这会抑制由抛射物供能的辐射；二是没有迅速塌缩，但其固有的电磁辐射低于探测阈值。要求您利用没有电磁对应体和引力波质量后验分布的信息，为最大不旋转中子星质量，即 Tolman–Oppenheimer–Volkoff 质量（TOV；$M_{\\rm TOV}$），构建一个删失似然推断。\n\n使用以下基本依据：\n\n- 流量-光度关系为 $F = L / (4 \\pi d_L^2)$，其中 $F$ 是流量，$L$ 是光度，$d_L$ 是光度距离。\n- 迅速塌缩阈值由一个临界总引力质量 $M_{\\rm thr} = c_{\\rm th} \\, M_{\\rm TOV}$ 建模，其中 $c_{\\rm th}$ 是一个依赖于物态方程的无量纲常数。\n- 对于事件 $i$，引力波推断出的总引力质量近似为正态分布 $M_{\\rm tot} \\sim \\mathcal{N}(\\mu_i, \\sigma_i^2)$，其均值为 $\\mu_i$，标准差为 $\\sigma_i$。\n- 如果一个事件没有迅速塌缩，其电磁光度 $L$ 被建模为对数正态分布，$\\ln L \\sim \\mathcal{N}(\\mu_L, \\sigma_L^2)$，且各事件之间相互独立。\n- 对于未探测到的事件，电磁观测在流量极限 $F_{{\\rm lim},i}$ 处是右删失的，意味着 $F_i  F_{{\\rm lim},i}$，通过流量-光度关系可转换为 $L_i  4 \\pi d_{L,i}^2 F_{{\\rm lim},i}$。\n\n为每个事件 $i$ 定义：\n- 给定 $M_{\\rm TOV}$ 的迅速塌缩概率为 $p_{{\\rm pc},i}(M_{\\rm TOV}) = \\mathbb{P}(M_{\\rm tot}  c_{\\rm th} M_{\\rm TOV})$，此乃基于 $M_{\\rm tot}$ 的正态模型。\n- 在没有迅速塌缩的情况下未探测到的概率为 $p_{{\\rm nd}|{\\rm np},i} = \\mathbb{P}\\left(L  4 \\pi d_{L,i}^2 F_{{\\rm lim},i}\\right)$，此乃基于 $L$ 的对数正态模型。\n\n假设在给定 $M_{\\rm TOV}$ 的条件下各事件是条件独立的，并对 $M_{\\rm TOV}$ 在指定范围内采用均匀先验。在整个样本中只观测到未探测事件的似然是所有事件概率的乘积：\n$$\np_i(\\text{non-detection}\\mid M_{\\rm TOV}) \\equiv p_{{\\rm pc},i}(M_{\\rm TOV}) + \\left[1 - p_{{\\rm pc},i}(M_{\\rm TOV})\\right] \\, p_{{\\rm nd}|{\\rm np},i}.\n$$\n在一组 $M_{\\rm TOV}$ 网格值上计算未归一化的后验分布，将其归一化，并报告总结性统计数据。\n\n单位与数值要求：\n- 以太阳质量（用 $M_\\odot$ 表示）为单位报告 $M_{\\rm TOV}$。\n- 距离必须使用厘米单位；给定的 $d_{L,i}$ 以百万秒差距（Mpc）为单位，您应使用 $1\\,\\text{Mpc} = 3.0856775814913673\\times 10^{24}\\,\\text{cm}$ 进行转换。\n- 流量极限 $F_{{\\rm lim},i}$ 的单位是 $\\text{erg}\\,\\text{s}^{-1}\\,\\text{cm}^{-2}$，光度 $L$ 的单位是 $\\text{erg}\\,\\text{s}^{-1}$。\n- 不涉及角度；无需角度单位。\n- 使用等尾置信区间，其下界为后验分布的 $5\\%$ 分位数，上界为 $95\\%$ 分位数。\n- 所有报告的数值输出均四舍五入到三位小数。\n\n算法要求：\n- 在先验区间上使用一个至少包含 $1000$ 个点的 $M_{\\rm TOV}$ 值网格。\n- 使用 $M_{\\rm tot}$ 正态分布的尾部来评估 $p_{{\\rm pc},i}(M_{\\rm TOV})$。\n- 使用对数正态分布在 $L_{{\\rm lim},i} \\equiv 4 \\pi d_{L,i}^2 F_{{\\rm lim},i}$ 处的累积分布函数来评估 $p_{{\\rm nd}|{\\rm np},i}$。\n- 通过将所有事件的似然与均匀先验相乘来计算后验分布，并通过网格积分进行归一化。\n- 对每个测试用例，计算：\n  1. 最大后验估计 $M_{\\rm TOV}^{\\rm MAP}$。\n  2. 在 $M_{\\rm TOV}^{\\rm MAP}$ 处隐含的迅速塌缩分数，定义为所有事件的 $p_{{\\rm pc},i}(M_{\\rm TOV}^{\\rm MAP})$ 的样本均值。\n  3. 等尾 $90\\%$ 置信区间的置信下界 $M_{\\rm TOV}^{(0.05)}$ 和置信上界 $M_{\\rm TOV}^{(0.95)}$。\n\n测试套件：\n- 对于每个测试用例，$M_{\\rm TOV}$ 的先验在 $[2.0, 2.5]\\,M_\\odot$ 上是均匀分布的。\n\n测试用例 A (理想情况):\n- 事件数量：$5$。\n- 距离（单位 $\\text{Mpc}$）：$(40, 70, 120, 200, 160)$。\n- 流量极限（单位 $\\text{erg}\\,\\text{s}^{-1}\\,\\text{cm}^{-2}$）：$(1.0\\times 10^{-15}, 8.0\\times 10^{-16}, 1.2\\times 10^{-15}, 1.0\\times 10^{-15}, 9.0\\times 10^{-16})$。\n- 总质量均值（单位 $M_\\odot$）：$(2.72, 2.65, 2.80, 2.60, 2.75)$。\n- 总质量标准差（单位 $M_\\odot$）：$(0.06, 0.05, 0.07, 0.05, 0.06)$。\n- 阈值系数：$c_{\\rm th} = 1.3$。\n- 对数正态光度参数：$\\mu_L = \\ln(3\\times 10^{41})$ 和 $\\sigma_L = 1.0$。\n\n测试用例 B (距离主导的删失；边界行为):\n- 事件数量：$4$。\n- 距离（单位 $\\text{Mpc}$）：$(300, 350, 280, 400)$。\n- 流量极限（单位 $\\text{erg}\\,\\text{s}^{-1}\\,\\text{cm}^{-2}$）：$(1.0\\times 10^{-15}, 9.0\\times 10^{-16}, 1.1\\times 10^{-15}, 8.5\\times 10^{-16})$。\n- 总质量均值（单位 $M_\\odot$）：$(2.50, 2.45, 2.55, 2.48)$。\n- 总质量标准差（单位 $M_\\odot$）：$(0.05, 0.05, 0.06, 0.05)$。\n- 阈值系数：$c_{\\rm th} = 1.3$。\n- 对数正态光度参数：$\\mu_L = \\ln(3\\times 10^{41})$ 和 $\\sigma_L = 1.0$。\n\n测试用例 C (具有较大阈值系数的边缘情况):\n- 事件数量：$6$。\n- 距离（单位 $\\text{Mpc}$）：$(60, 90, 110, 140, 180, 220)$。\n- 流量极限（单位 $\\text{erg}\\,\\text{s}^{-1}\\,\\text{cm}^{-2}$）：$(1.1\\times 10^{-15}, 1.0\\times 10^{-15}, 8.0\\times 10^{-16}, 1.2\\times 10^{-15}, 9.0\\times 10^{-16}, 1.0\\times 10^{-15})$。\n- 总质量均值（单位 $M_\\odot$）：$(2.60, 2.68, 2.74, 2.80, 2.52, 2.70)$。\n- 总质量标准差（单位 $M_\\odot$）：$(0.05, 0.06, 0.05, 0.07, 0.05, 0.06)$。\n- 阈值系数：$c_{\\rm th} = 1.5$。\n- 对数正态光度参数：$\\mu_L = \\ln(3\\times 10^{41})$ 和 $\\sigma_L = 0.8$。\n\n您的程序必须为每个测试用例计算元组 $\\left(M_{\\rm TOV}^{\\rm MAP}, f_{\\rm pc}^{\\rm MAP}, M_{\\rm TOV}^{(0.05)}, M_{\\rm TOV}^{(0.95)}\\right)$，其中 $f_{\\rm pc}^{\\rm MAP}$ 是该测试用例中所有事件的 $p_{{\\rm pc},i}(M_{\\rm TOV}^{\\rm MAP})$ 的均值。所有 $M_{\\rm TOV}$ 输出必须以 $M_\\odot$ 为单位，并四舍五入到三位小数；$f_{\\rm pc}^{\\rm MAP}$ 必须是四舍五入到三位小数的小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例（按 A, B, C 的顺序）对应一个内部列表。每个内部列表必须按指定顺序包含上述四个四舍五入的浮点数。例如，输出必须类似于 $[[x_1,y_1,z_1,w_1],[x_2,y_2,z_2,w_2],[x_3,y_3,z_3,w_3]]$，不含空格。", "solution": "目标是利用一组没有电磁（EM）对应体的引力波事件，对最大不旋转中子星质量 $M_{\\rm TOV}$ 进行贝叶斯推断。对于事件 $i$ 缺乏电磁信号的情况，通过一个删失似然模型来解释，该模型考虑了两种可能性：要么双星并合事件迅速塌缩成黑洞（从而抑制了电磁辐射），要么它没有迅速塌缩，但其电磁辐射太微弱而无法被探测到。\n\n推断在贝叶斯定理的框架内进行，该定理指出，在给定观测数据 $\\mathcal{D}$（一系列未探测事件）的情况下，参数 $M_{\\rm TOV}$ 的后验概率分布正比于给定参数时数据的似然与该参数的先验概率的乘积：\n$$\np(M_{\\rm TOV} | \\mathcal{D}) \\propto \\mathcal{L}(\\mathcal{D} | M_{\\rm TOV}) \\pi(M_{\\rm TOV})\n$$\n问题指定了 $M_{\\rm TOV}$ 在区间 $[2.0, 2.5]\\,M_\\odot$ 上的均匀先验分布：\n$$\n\\pi(M_{\\rm TOV}) = \\begin{cases}\n    \\text{常数}   \\text{若 } 2.0 \\le M_{\\rm TOV} / M_\\odot \\le 2.5 \\\\\n    0   \\text{其他情况}\n\\end{cases}\n$$\n由于假设在给定 $M_{\\rm TOV}$ 的条件下各事件是条件独立的，总似然 $\\mathcal{L}(\\mathcal{D} | M_{\\rm TOV})$ 是每个独立事件似然的乘积：\n$$\n\\mathcal{L}(\\mathcal{D} | M_{\\rm TOV}) = \\prod_{i=1}^{N} p_i(\\text{non-detection} | M_{\\rm TOV})\n$$\n其中 $N$ 是样本中的事件总数。\n\n对于每个事件 $i$，未被探测到的概率是导致该结果的两个互斥情景的概率之和，如问题所述：\n$$\np_i(\\text{non-detection}\\mid M_{\\rm TOV}) = p_{{\\rm pc},i}(M_{\\rm TOV}) + \\left[1 - p_{{\\rm pc},i}(M_{\\rm TOV})\\right] \\, p_{{\\rm nd}|{\\rm np},i}\n$$\n这里，$p_{{\\rm pc},i}(M_{\\rm TOV})$ 是迅速塌缩的概率，$p_{{\\rm nd}|{\\rm np},i}$ 是在未发生迅速塌缩的情况下未被探测到的概率。我们现在详细说明这两个部分的计算方法。\n\n1.  **迅速塌缩概率，$p_{{\\rm pc},i}(M_{\\rm TOV})$**：\n    模型假设，如果双星系统的总引力质量 $M_{\\rm tot}$ 超过一个临界质量阈值 $M_{\\rm thr}$，就会发生迅速塌缩。该阈值通过 $M_{\\rm TOV}$ 参数化为 $M_{\\rm thr} = c_{\\rm th} M_{\\rm TOV}$，其中 $c_{\\rm th}$ 是一个给定的常数。事件 $i$ 的总质量 $M_{\\rm tot,i}$ 是从引力波数据中推断出来的，并由一个正态分布描述，$M_{\\rm tot,i} \\sim \\mathcal{N}(\\mu_i, \\sigma_i^2)$。因此，迅速塌缩的概率就是 $M_{\\rm tot,i}$ 大于 $M_{\\rm thr}$ 的概率：\n    $$\n    p_{{\\rm pc},i}(M_{\\rm TOV}) = \\mathbb{P}(M_{\\rm tot,i}  c_{\\rm th} M_{\\rm TOV})\n    $$\n    这使用正态分布的生存函数（即 1 减去累积分布函数，CDF）来计算。如果 $\\Phi_{\\mu_i, \\sigma_i^2}$ 是 $\\mathcal{N}(\\mu_i, \\sigma_i^2)$ 的累积分布函数，那么 $p_{{\\rm pc},i}(M_{\\rm TOV}) = 1 - \\Phi_{\\mu_i, \\sigma_i^2}(c_{\\rm th} M_{\\rm TOV})$。\n\n2.  **未发生迅速塌缩情况下的未探测概率，$p_{{\\rm nd}|{\\rm np},i}$**：\n    如果并合事件没有迅速塌缩，则假定它会产生一定光度 $L$ 的电磁辐射。如果该光度不足以在地球上产生超过观测流量极限 $F_{{\\rm lim},i}$ 的流量 $F_i$，则会发生未探测事件。流量-光度关系为 $F = L / (4 \\pi d_L^2)$，因此未探测意味着 $F_i  F_{{\\rm lim},i}$，这表明内在光度 $L_i$ 必须低于某个极限：\n    $$\n    L_i  4 \\pi d_{L,i}^2 F_{{\\rm lim},i} \\equiv L_{{\\rm lim},i}\n    $$\n    为此计算，以百万秒差距（$\\text{Mpc}$）为单位给出的光度距离 $d_{L,i}$ 必须使用提供的转换因子 $1\\,\\text{Mpc} = 3.0856775814913673\\times 10^{24}\\,\\text{cm}$ 转换为厘米（$\\text{cm}$）。光度 $L$ 被建模为一个对数正态随机变量，其自然对数服从正态分布：$\\ln L \\sim \\mathcal{N}(\\mu_L, \\sigma_L^2)$。因此，未探测到的概率是对数正态分布在光度极限 $L_{{\\rm lim},i}$ 处的累积分布函数（CDF）值：\n    $$\n    p_{{\\rm nd}|{\\rm np},i} = \\mathbb{P}(L  L_{{\\rm lim},i})\n    $$\n    对于每个事件 $i$，这个概率是一个常数，因为它不依赖于 $M_{\\rm TOV}$。\n\n计算步骤如下：\nA.  在先验范围 $[2.0, 2.5]\\,M_\\odot$ 上建立一个至少包含 $1000$ 个候选值的 $M_{\\rm TOV}$ 精细网格。\nB.  对于网格上的每个 $M_{\\rm TOV}$ 值，我们计算总对数似然。为保证数值稳定性，我们使用对数进行计算：\n    $$\n    \\ln \\mathcal{L}(\\mathcal{D} | M_{\\rm TOV}) = \\sum_{i=1}^{N} \\ln \\left( p_{{\\rm pc},i}(M_{\\rm TOV}) + (1 - p_{{\\rm pc},i}(M_{\\rm TOV}))p_{{\\rm nd}|{\\rm np},i} \\right)\n    $$\n    由于先验 $\\pi(M_{\\rm TOV})$ 是均匀的，对数后验分布就是对数似然加上一个常数。因此，后验分布的形状与似然函数的形状相同。\nC.  通过对对数似然取指数，得到未归一化的后验分布。然后将得到的分布在网格上离散化并进行归一化。\nD.  最大后验（MAP）估计 $M_{\\rm TOV}^{\\rm MAP}$ 是网格上使后验概率最大化的 $M_{\\rm TOV}$ 值。\nE.  在 MAP 估计下的隐含迅速塌缩分数 $f_{\\rm pc}^{\\rm MAP}$，是通过对在 $M_{\\rm TOV}^{\\rm MAP}$ 处评估的所有事件的迅速塌缩概率求平均值来计算的：\n    $$\n    f_{\\rm pc}^{\\rm MAP} = \\frac{1}{N} \\sum_{i=1}^N p_{{\\rm pc},i}(M_{\\rm TOV}^{\\rm MAP})\n    $$\nF.  后验累积分布函数（CDF）由归一化的后验网格构建。通过对后验 CDF 进行线性插值，找到与累积概率 $0.05$ 和 $0.95$ 对应的 $M_{\\rm TOV}$ 值，从而确定 $5\\%$ 和 $95\\%$ 的分位数 $M_{\\rm TOV}^{(0.05)}$ 和 $M_{\\rm TOV}^{(0.95)}$。这些值构成了 $90\\%$ 等尾置信区间的边界。\nG.  最后，对每个测试用例，计算出的值 $\\left(M_{\\rm TOV}^{\\rm MAP}, f_{\\rm pc}^{\\rm MAP}, M_{\\rm TOV}^{(0.05)}, M_{\\rm TOV}^{(0.95)}\\right)$ 都四舍五入到三位小数。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm, lognorm\n\ndef solve():\n    \"\"\"\n    Computes the posterior inference for M_TOV based on a set of BNS merger \n    non-detections.\n    \"\"\"\n    \n    # Constants\n    MPC_TO_CM = 3.0856775814913673e24\n\n    # Test suite definition\n    test_cases_data = {\n        'A': {\n            'd_L_mpc': np.array([40., 70., 120., 200., 160.]),\n            'f_lim': np.array([1.0e-15, 8.0e-16, 1.2e-15, 1.0e-15, 9.0e-16]),\n            'mu_m': np.array([2.72, 2.65, 2.80, 2.60, 2.75]),\n            'sigma_m': np.array([0.06, 0.05, 0.07, 0.05, 0.06]),\n            'c_th': 1.3,\n            'mu_L': np.log(3e41),\n            'sigma_L': 1.0,\n        },\n        'B': {\n            'd_L_mpc': np.array([300., 350., 280., 400.]),\n            'f_lim': np.array([1.0e-15, 9.0e-16, 1.1e-15, 8.5e-16]),\n            'mu_m': np.array([2.50, 2.45, 2.55, 2.48]),\n            'sigma_m': np.array([0.05, 0.05, 0.06, 0.05]),\n            'c_th': 1.3,\n            'mu_L': np.log(3e41),\n            'sigma_L': 1.0,\n        },\n        'C': {\n            'd_L_mpc': np.array([60., 90., 110., 140., 180., 220.]),\n            'f_lim': np.array([1.1e-15, 1.0e-15, 8.0e-16, 1.2e-15, 9.0e-16, 1.0e-15]),\n            'mu_m': np.array([2.60, 2.68, 2.74, 2.80, 2.52, 2.70]),\n            'sigma_m': np.array([0.05, 0.06, 0.05, 0.07, 0.05, 0.06]),\n            'c_th': 1.5,\n            'mu_L': np.log(3e41),\n            'sigma_L': 0.8,\n        }\n    }\n\n    # Grid for M_TOV in M_sun\n    m_tov_grid = np.linspace(2.0, 2.5, 2001)\n\n    all_results = []\n\n    for case_id in ['A', 'B', 'C']:\n        case_data = test_cases_data[case_id]\n        \n        num_events = len(case_data['d_L_mpc'])\n        log_posterior = np.zeros_like(m_tov_grid)\n\n        # Precompute values that don't depend on M_TOV\n        d_L_cm = case_data['d_L_mpc'] * MPC_TO_CM\n        L_lim = 4 * np.pi * d_L_cm**2 * case_data['f_lim']\n        \n        mu_L = case_data['mu_L']\n        sigma_L = case_data['sigma_L']\n        scale_L = np.exp(mu_L)\n        \n        p_nd_non_pc_list = lognorm.cdf(L_lim, s=sigma_L, scale=scale_L)\n\n        # Loop over events to compute total log-likelihood\n        for i in range(num_events):\n            p_nd_non_pc = p_nd_non_pc_list[i]\n            mu_m_i = case_data['mu_m'][i]\n            sigma_m_i = case_data['sigma_m'][i]\n            c_th = case_data['c_th']\n            \n            # Vectorized calculation over m_tov_grid\n            m_thr = c_th * m_tov_grid\n            p_pc = norm.sf(m_thr, loc=mu_m_i, scale=sigma_m_i)\n            \n            p_i = p_pc + (1 - p_pc) * p_nd_non_pc\n            log_posterior += np.log(p_i)\n            \n        # Normalize posterior for summary statistics\n        # Subtract max for numerical stability before exponentiating\n        log_posterior -= np.max(log_posterior)\n        unnorm_posterior = np.exp(log_posterior)\n        \n        # MAP estimate\n        map_idx = np.argmax(unnorm_posterior)\n        m_tov_map = m_tov_grid[map_idx]\n\n        # Implied prompt-collapse fraction at MAP\n        c_th = case_data['c_th']\n        m_thr_map = c_th * m_tov_map\n        p_pc_at_map = norm.sf(m_thr_map, loc=case_data['mu_m'], scale=case_data['sigma_m'])\n        f_pc_map = np.mean(p_pc_at_map)\n\n        # Credible interval\n        cdf = np.cumsum(unnorm_posterior)\n        cdf /= cdf[-1] # Normalize CDF to run from 0 to 1\n        \n        m_tov_05 = np.interp(0.05, cdf, m_tov_grid)\n        m_tov_95 = np.interp(0.95, cdf, m_tov_grid)\n\n        # Collect and round results\n        result_tuple = (\n            round(m_tov_map, 3),\n            round(f_pc_map, 3),\n            round(m_tov_05, 3),\n            round(m_tov_95, 3)\n        )\n        all_results.append(list(result_tuple))\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, res))}]\" for res in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "3480640"}]}