## 引言
在现代科学与工程计算中，求解由多物理场耦合现象建模而来的大规模[非线性方程组](@entry_id:178110)是一项核心挑战。传统的[牛顿法](@entry_id:140116)虽然具有快速的局部收敛性，但其要求显式构造并存储巨大的雅可比矩阵，这在三维大规模仿真中往往会成为内存和计算的瓶颈，甚至变得不可行。雅可比无关[牛顿-克雷洛夫](@entry_id:752475)（Jacobian-free [Newton-Krylov](@entry_id:752475), JFNK）方法应运而生，它通过一种巧妙的数值策略解决了这一根本性难题，成为求解前沿计算问题的利器。

本文旨在为读者提供一个关于[JFNK方法](@entry_id:175039)的全面而深入的理解，从其基本原理到高级应用。我们将系统地剖析该方法如何工作，为何有效，以及如何在复杂的实际问题中发挥其最大潜力。您将通过三个循序渐进的章节，开启一段从理论到实践的探索之旅：
- **原理与机制**：本章将深入[JFNK方法](@entry_id:175039)的核心，阐述其如何通过近似[雅可比-向量积](@entry_id:162748)来避免构造[雅可比矩阵](@entry_id:264467)，并详细讨论[预处理](@entry_id:141204)、全局化和非精确求解等关键技术，这些是确保算法效率和鲁棒性的基石。
- **应用与交叉学科联系**：本章将展示JFNK在[计算流体力学](@entry_id:747620)、固体力学及[反应堆物理](@entry_id:158170)等多个领域的强大应用，并探讨其与高阶有限元、[自动微分](@entry_id:144512)和[高性能计算](@entry_id:169980)等先进技术的结合，揭示其在解决真实世界问题中的权衡与优势。
- **动手实践**：本章将通过一系列精心设计的实践问题，引导您验证算法实现的正确性、优化关键参数，并进行高层次的[性能建模](@entry_id:753340)与决策，将理论知识转化为解决问题的实践能力。

现在，让我们一同开始，深入探索[JFNK方法](@entry_id:175039)的精髓，掌握这一应对大规模[非线性](@entry_id:637147)挑战的强大计算工具。

## 原理与机制

[牛顿-克雷洛夫](@entry_id:752475)（[Newton-Krylov](@entry_id:752475)）方法通过将[牛顿法](@entry_id:140116)（外部[非线性](@entry_id:637147)迭代）与[克雷洛夫子空间](@entry_id:751067)法（内部线性迭代）相结合，为求解大规模非线性方程组 $F(u)=0$ 提供了一个强大的框架。本章将深入探讨该方法的“雅可比无关”（Jacobian-free）变体，即 JFNK 方法。我们将阐述其核心原理，分析其关键机制，并展示其在复杂[多物理场耦合](@entry_id:171389)仿真中的卓越能力与适用性。

### [雅可比](@entry_id:264467)无关[范式](@entry_id:161181)

标准的牛顿法在每次迭代 $k$ 时，通过[求解线性系统](@entry_id:146035) $J(u_k)s_k = -F(u_k)$ 来计算更新步长 $s_k$，其中 $J(u_k)$ 是[非线性](@entry_id:637147)残差函数 $F$ 在当前解 $u_k$ 处的[雅可比矩阵](@entry_id:264467)。对于大规模问题，例如由三维[偏微分方程离散化](@entry_id:175821)而来的系统，[雅可比矩阵](@entry_id:264467) $J$ 的显式构造和存储可能构成巨大的计算瓶颈。

考虑一个典型的三维[多物理场](@entry_id:164478)问题，其状态向量维度 $N$ 可达数千万。即使 $J$ 是一个稀疏矩阵，其非零元素的数量也可能达到数十亿。存储这样一个矩阵可能需要数百GB的内存，这在许多[高性能计算](@entry_id:169980)节点上是不可行的。此外，精确计算或组装雅可比矩阵本身也可能非常耗时，特别是当 $F$ 的表达式复杂或涉及查表、积分等操作时。[@problem_id:3511968]

雅可比无关方法的核心思想是：[克雷洛夫子空间](@entry_id:751067)法（如 GMRES）[求解线性系统](@entry_id:146035)时，并不需要知道矩阵 $J$ 的所有元素；它唯一需要的是计算任意给定向量 $v$ 与矩阵 $J$ 的乘积，即**[雅可比-向量积](@entry_id:162748)**（Jacobian-vector product）$Jv$。基于 Fréchet 导数的定义，该乘积可以被一个方向导数逼近：
$$
J(u)v = \lim_{\epsilon \to 0} \frac{F(u + \epsilon v) - F(u)}{\epsilon}
$$
在实践中，我们可以通过选取一个足够小的[有限差分](@entry_id:167874)步长 $\epsilon$ 来近似这个极限：
$$
J(u)v \approx \frac{F(u + \epsilon v) - F(u)}{\epsilon}
$$
这个简单的近似式是 JFNK 方法的基石。它用一次额外的残差函数 $F$ 的求值（即计算 $F(u + \epsilon v)$，因为 $F(u)$ 已经计算过）替换了整个雅可比矩阵的构造、存储和矩阵-向量乘法操作。这极大地降低了内存需求，使得求解原本因内存限制而无法处理的超大规模问题成为可能。

### 关键细节：差分参数的选择

虽然雅可比无关的思想很优雅，但其成功在很大程度上取决于差分参数 $\epsilon$ 的明智选择。$\epsilon$ 的选择需要在两种误差来源之间取得平衡：

1.  **[截断误差](@entry_id:140949)（Truncation Error）**：上述[有限差分公式](@entry_id:177895)是对泰勒展开 $F(u + \epsilon v) = F(u) + \epsilon J(u)v + \mathcal{O}(\epsilon^2)$ 的一阶近似。因此，该近似引入的[截断误差](@entry_id:140949)量级为 $\mathcal{O}(\epsilon)$。为了减小[截断误差](@entry_id:140949)，我们希望 $\epsilon$ 尽可能小。

2.  **舍入误差（Round-off Error）**：在有限精度[浮点运算](@entry_id:749454)中，当 $\epsilon$ 极小时，$u + \epsilon v$ 可能与 $u$ 非常接近，导致 $F(u + \epsilon v)$ 与 $F(u)$ 的计算结果在[有效数字](@entry_id:144089)上大量抵消。这种相减操作中的**[灾难性抵消](@entry_id:146919)**（catastrophic cancellation）会产生一个被[浮点舍入](@entry_id:749455)误差严重污染的结果。这个误差的量级约为 $\mathcal{O}(\epsilon_{\text{mach}} / \epsilon)$，其中 $\epsilon_{\text{mach}}$ 是[机器精度](@entry_id:756332)（对于[双精度](@entry_id:636927)[浮点数](@entry_id:173316)约为 $10^{-16}$）。为了避免[舍入误差](@entry_id:162651)占主导，我们希望 $\epsilon$ 不要太小。

将这两种误差源的贡献相加，总误差大致为 $C_1\epsilon + C_2\epsilon_{\text{mach}}/\epsilon$。通过对 $\epsilon$ 求导并令其为零，可以找到使总误差最小的最优 $\epsilon$，其量级为 $\epsilon_{\text{opt}} \propto \sqrt{\epsilon_{\text{mach}}}$。

然而，在多物理场问题中，状态向量 $u$ 和[方向向量](@entry_id:169562) $v$ 的分量可能具有不同的物理单位和[数量级](@entry_id:264888)。一个固定的 $\epsilon$ 值无法同时适用于所有情况。因此，一种更鲁棒的、考虑了变量尺度的策略被广泛采用。该策略根据 $u$ 和 $v$ 的范数来调整 $\epsilon$：
$$
\epsilon(u, v) = \eta \frac{1 + \|u\|}{\|v\|}
$$
其中，$\eta$ 是一个与 $\sqrt{\epsilon_{\text{mach}}}$ 相当的常数。这种选择旨在使扰动项 $\epsilon v$ 的范数与 $u$ 的范数相称，同时保持 $\epsilon$ 本身较小。当 $u$ 和 $v$ 的分量尺度差异巨大时，使用加权范数 $\| \cdot \|_W$ 代替标准欧几里得范数至关重要，其中权重用于均衡不同物理量的贡献。例如，可以定义对角权重向量 $w$，使得 $w_i$ 大致为相应变量 $u_i$ 典型值的倒数，然后使用加权范数 $\|x\|_W = \sqrt{\sum_i (w_i x_i)^2}$。[@problem_id:3511986]

通过**泰勒测试**（Taylor test），我们可以实验性地验证[有限差分](@entry_id:167874)实现的正确性。通过在一系列几何递减的 $\epsilon_k$ 值下计算近似[雅可比-向量积](@entry_id:162748)与解析[雅可比-向量积](@entry_id:162748)（如果可知）之间的误差 $e(\epsilon_k)$，我们可以在对数-对数图上观察到预期的“V”形误差曲线。在截断误差主导的区域（较大的 $\epsilon_k$），误差曲线的斜率应接近 $1$，证实了方法的一阶收敛性。[@problem_id:3511986]

### 多物理场的挑战：缩放与无量纲化

[多物理场耦合](@entry_id:171389)问题的显著特征是其变量和方程往往涉及不同的物理单位和悬殊的[数量级](@entry_id:264888)。例如，一个热流固耦合问题可能同时包含以帕斯卡（$10^5$ Pa）为单位的压力、以开尔文（$300$ K）为单位的温度以及以米为单位的位移。如果不加处理，直接在这些原始物理量上应用数值方法会导致严重问题。[@problem_id:3511961]

首先，任何基于范数的计算（例如，在克雷洛夫方法中或在[收敛判据](@entry_id:158093)中）都会被[数量级](@entry_id:264888)最大的分量所主导，而忽略其他物理场的贡献。其次，由不同尺度变量和方程构成的[雅可比矩阵](@entry_id:264467)，其元素的[数量级](@entry_id:264888)可能跨越多个量级，导致矩阵变得**病态**（ill-conditioned）。一个病态的线性系统会极大地减慢克雷洛夫求解器的收敛速度，甚至导致其失败。

解决这个问题的根本方法是进行系统的**缩放**（scaling）或**[无量纲化](@entry_id:136704)**（nondimensionalization）。其目标是将所有变量和方程变换为量级大约为 $1$ 的无量纲形式。这可以通过引入特征尺度（如参考压力 $p_{\text{ref}}$、参考温度 $T_{\text{ref}}$ 等）来实现。

例如，定义无量纲变量 $p^* = p/p_{\text{ref}}$ 和 $T^* = T/T_{\text{ref}}$，并将原始方程 $F(p, T)=0$ 改写为关于这些无量纲变量的新方程 $F^*(p^*, T^*)=0$。在这个[无量纲化](@entry_id:136704)的系统中，新的雅可比矩阵 $J^*$ 的所有元素都将具有相似的量级，其条件数会显著改善。[@problem_id:3511961]

在 JFNK 的框架中，这等效于引入对角**变量[缩放矩阵](@entry_id:188350)** $S$ 和**方程[缩放矩阵](@entry_id:188350)** $W$。$S$ 的对角元素是各变量的特征尺度，$W$ 的对角元素是各方程残差的特征尺度的倒数。通过求解变换后的系统，或在计算范数时始终使用加权范数（如 $\|WF(u)\|$ 和 $\|S^{-1}s_k\|$），我们可以确保算法的行为不受物理单位选择的影响，并且数值上更加稳健。这对于[收敛监控](@entry_id:747855)、[全局化策略](@entry_id:177837)和预处理器的设计都至关重要。[@problem_id:3511969]

### 非精确[牛顿-克雷洛夫法](@entry_id:144188)

JFNK 中的“非精确”指的是内部线性系统 $J_k s_k = -F_k$ 并未被精确求解。克雷洛夫求解器在满足某个预设的[停止准则](@entry_id:136282)后便会终止，返回一个近似解 $s_k$。这种不完全求解的策略可以节省大量的计算时间，特别是在牛顿迭代的早期阶段，此时远离解的 $u_k$ 使得[线性模型](@entry_id:178302)本身就不是一个很好的近似，没有必要为其求得精确解。

为了保证外部牛顿迭代的收敛性，对[线性求解器](@entry_id:751329)近似解的精度必须加以控制。这是通过**非精确牛顿条件**（inexact Newton condition）来实现的，通常采用如下形式：
$$
\| J(u_k)s_k + F(u_k) \|_2 \le \eta_k \| F(u_k) \|_2
$$
其中，$\| \cdot \|_2$ 表示欧几里得范数（在经过缩放的系统中），$s_k$ 是克雷洛夫求解器返回的近似[牛顿步](@entry_id:177069)。$\eta_k \in [0, 1)$ 被称为**强制项**（forcing term）。这个条件要求线性系统的相对残差必须小于 $\eta_k$。

$\eta_k$ 的选择对算法的效率和[收敛速度](@entry_id:636873)有显著影响。
- 如果 $\eta_k$ 太小（接近 $0$），则要求[线性系统](@entry_id:147850)求解得非常精确，这会增加内部克雷洛夫迭代的次数，导致计算成本上升。
- 如果 $\eta_k$ 太大（接近 $1$），则线性求解过于粗糙，可能破坏牛顿法的快速收敛性，甚至导致[全局收敛](@entry_id:635436)失败。

一种常见的有效策略是**自适应地选择强制项**。例如，Eisenstat 和 Walker 提出的策略是根据当前[非线性](@entry_id:637147)残差的大小来调整 $\eta_k$，如 $\eta_k = \gamma \|F(u_k)\|^{\theta}$，其中 $\gamma \in (0,1)$ 和 $\theta \in (0,1]$。这种策略使得在迭代初期（$\|F(u_k)\|$ 较大时）允许较大的 $\eta_k$ 以节省计算量，而在接近解时（$\|F(u_k)\|$ 变小时）要求更精确的线性求解（$\eta_k \to 0$），从而恢复[牛顿法](@entry_id:140116)的快速收敛性。理论可以证明，只要 $\eta_k \to 0$，[非精确牛顿法](@entry_id:170292)就能实现**[超线性收敛](@entry_id:141654)**。[@problem_id:3511975] [@problem_id:3511957]

### [全局化策略](@entry_id:177837)：确保鲁棒收敛

牛顿法本质上是一种局部收敛方法，即只有当初始猜测值 $u_0$ 足够接近真实解 $u^*$ 时，才能保证收敛。为了使其对于任意初始值都能稳健地收敛到解（即**[全局收敛](@entry_id:635436)**），必须引入[全局化策略](@entry_id:177837)。在 JFNK 中，最常用的两种策略是线搜索和信赖域。

#### [线搜索](@entry_id:141607) (Line Search)

[线搜索方法](@entry_id:172705)在求得牛顿方向 $p_k$（即近似解 $s_k$）后，并不直接采用完整的步长，而是通过求解一个[一维优化](@entry_id:635076)问题来寻找一个最优的步长因子 $\alpha_k \in (0, 1]$，使得更新后的解 $u_{k+1} = u_k + \alpha_k p_k$ 能够使某个衡量“误差”的**价值函数**（merit function）得到充分下降。对于[非线性方程组](@entry_id:178110)，最常用的[价值函数](@entry_id:144750)是残差的最小二乘范数：
$$
\phi(u) = \frac{1}{2}\|F(u)\|^2
$$
一个关键的理论前提是，非精确[牛顿步](@entry_id:177069) $p_k$ 必须是[价值函数](@entry_id:144750) $\phi$ 的一个**下降方向**，即 $\nabla\phi(u_k)^\top p_k  0$。幸运的是，只要强制项 $\eta_k  1$，这个条件就能得到保证。具体来说，可以证明：
$$
\nabla\phi(u_k)^\top p_k \le -(1-\eta_k)\|F_k\|^2
$$
其中 $F_k=F(u_k)$。由于 $\eta_k  1$ 且 $\|F_k\|^2 > 0$（只要还没收敛），该方向导数必然为负。[@problem_id:3511957]

在实践中，我们通常不进行精确的[线搜索](@entry_id:141607)，而是采用**[回溯线搜索](@entry_id:166118)**（backtracking line search）并满足**Armijo 条件**。从 $\alpha_k=1$ 开始，不断缩小 $\alpha_k$（例如每次减半），直到满足以下充分下降条件为止：
$$
\phi(u_k + \alpha_k p_k) \le \phi(u_k) + c_1 \alpha_k \nabla\phi(u_k)^\top p_k
$$
其中 $c_1$ 是一个小的正常数（如 $10^{-4}$）。因为 $p_k$ 是下降方向，理论上总能找到一个满足条件的 $\alpha_k > 0$。

为了实现快速的局部收敛，我们希望在接近解时能够采用完整的[牛顿步](@entry_id:177069)，即 $\alpha_k=1$。可以证明，如果强制项 $\eta_k \to 0$ 且 Armijo 条件中的参数 $c_1  1/2$，那么当 $k$ 足够大时，$\alpha_k=1$ 将自动满足 Armijo 条件。这保证了 JFNK 方法在全局稳健的同时，也能在局部展现出超线性的收敛速度。[@problem_id:3511957]

#### 信赖域 (Trust Region)

[信赖域方法](@entry_id:138393)是另一种重要的[全局化策略](@entry_id:177837)。它在当前点 $u_k$ 周围定义一个“信赖域”（通常是一个半径为 $\Delta_k$ 的球），并在这个区域内求解一个近似模型（通常是二次模型）的最小化问题来获得试验步长 $s_k$。对于 JFNK，常用的模型是**高斯-牛顿模型**：
$$
m_k(s) = \frac{1}{2}\|F_k + J_k s\|^2, \quad \text{subject to} \quad \|s\| \le \Delta_k
$$
模型下降量（predicted reduction）是 $m_k(0) - m_k(s_k)$。将非精确[牛顿步](@entry_id:177069) $p_k$ 代入，利用 $J_k p_k = -F_k + r_k$（其中 $r_k$ 是线性残差），可以得到模型下降量为 $\frac{1}{2}(\|F_k\|^2 - \|r_k\|^2)$。只要 $\eta_k  1$，这个下降量就是正的。[@problem_id:3511957]

算法随后计算实际下降量 $\phi(u_k) - \phi(u_k+s_k)$，并根据实际下降量与模型下降量的比值 $\rho_k$ 来决定是否接受该步长，并调整下一轮的信赖域半径 $\Delta_{k+1}$。

### JFNK 方法的预处理

对于由[偏微分方程离散化](@entry_id:175821)得到的大规模代数系统，雅可比矩阵通常是病态的，其[条件数](@entry_id:145150)会随着[网格加密](@entry_id:168565)而迅速增长。这导致克雷洛夫求解器的收敛非常缓慢，迭代次数与网格规模相关。为了获得高效且网格无关的收敛性能，**预处理**（preconditioning）是必不可少的。

预处理器的目标是找到一个易于求逆的矩阵 $M \approx J$，然后通过求解变换后的线性系统来加速克雷洛夫方法的收敛。

#### [右预处理](@entry_id:173546)与[左预处理](@entry_id:165660)

[预处理](@entry_id:141204)可以从左侧或右侧作用于原系统：
- **[左预处理](@entry_id:165660)**：求解 $M^{-1}J s = -M^{-1}F$。
- **[右预处理](@entry_id:173546)**：求解 $(J M^{-1})y = -F$，然后计算 $s = M^{-1}y$。

在 JFNK 的背景下，**[右预处理](@entry_id:173546)几乎是唯一的选择**。原因在于非精确牛顿条件的监控。以 GMRES 求解器为例，它在第 $m$ 步迭代中最小化的是其作用的[线性系统](@entry_id:147850)的[残差范数](@entry_id:754273)。
- 对于[左预处理](@entry_id:165660)，GMRES 最小化的是 $\| M^{-1}(J s^{(m)} + F) \|$。这个量通常不等于非精确牛顿条件中需要的 $\| J s^{(m)} + F \|$。因此，为了检查停止条件，每一步 GMRES 迭代后都需要额外计算一次（昂贵的）[雅可比-向量积](@entry_id:162748) $J s^{(m)}$ 来构造未预处理的残差。
- 对于[右预处理](@entry_id:173546)，GMRES 作用于算子 $A = J M^{-1}$ 和右端项 $b = -F$。它最小化的是 $\| A y^{(m)} - b \| = \| (J M^{-1})y^{(m)} + F \|$。代入 $s^{(m)} = M^{-1}y^{(m)}$，我们发现这正是 $\| J s^{(m)} + F \|$。因此，GMRES 内部计算的[残差范数](@entry_id:754273)可以直接用于监控非精确牛顿条件，无需任何额外计算。这一特性使得[右预处理](@entry_id:173546)与 JFNK 方法完美契合。[@problem_id:3511967]

#### [基于物理的预处理](@entry_id:753430)

JFNK 的核心优势在于避免了雅可比矩阵的**组装**，因此，其[预处理器](@entry_id:753679) $M$ 的应用（即计算 $M^{-1}v$）也必须是**无矩阵**（matrix-free）或至少不依赖于完整的 $J$。

对于[多物理场](@entry_id:164478)问题，最有效的预处理器通常是**基于物理的**（physics-based），它们利用了问题的内在块结构。给定雅可比矩阵的块形式：
$$
J(u) = 
\begin{bmatrix}
A  B \\
C  D
\end{bmatrix}
$$
其中 $A$ 和 $D$ 对应于单个物理场的算子（如弹性、热传导），而 $B$ 和 $C$ 是耦合项。
- **块对角[预处理器](@entry_id:753679)**（或块[雅可比](@entry_id:264467)）：$M = \text{diag}(A, D)$。这种方法忽略了耦合，仅当耦合较弱时有效。对于强耦合问题，其性能会很差。[@problem_id:3511980]
- **块三角[预处理器](@entry_id:753679)**（或块高斯-赛德尔）：例如 $M = \begin{bmatrix} A  0 \\ C  D \end{bmatrix}$。这种方法部分地考虑了耦合，性能通常优于块对角。
- **基于[舒尔补](@entry_id:142780)的预处理器**：更高级的方法是近似 $J$ 的块 LU 分解，这涉及到对**[舒尔补](@entry_id:142780)**（Schur complement）$S = D - C A^{-1} B$ 的近似。例如，一个有效的[预处理器](@entry_id:753679)可以基于 $M = \begin{bmatrix} \tilde{A}  0 \\ C  \tilde{S} \end{bmatrix}$，其中 $\tilde{A}$ 和 $\tilde{S}$ 分别是 $A$ 和 $S$ 的易于处理的近似。

为了实现网格无关的收敛性，对角块 $A$ 和 $D$（通常是离散的[椭圆算子](@entry_id:181616)）的逆必须用高效的求解器来近似，例如**[代数多重网格](@entry_id:140593)法**（Algebraic Multigrid, AMG）。AMG 可以在 $\mathcal{O}(N)$ 的复杂度内提供一个近似逆，并且可以无矩阵实现。对于舒尔补 $S$ 的求逆，通常采用一个**内嵌的克雷洛夫求解器**，并用一个更简单的算子（如 $D$ 的近似逆）来[预处理](@entry_id:141204)。整个复杂的预处理过程，包括多重网格和内嵌求解，都可以设计成无矩阵的形式，使其与 JFNK 兼容。[@problem_id:3511980]

#### 柔性与重启动的 GMRES

标准的克雷洛夫方法（如 GMRES）假定其作用的算子在所有内部迭代中是固定的。然而，在高级的 JFNK 应用中，[预处理器](@entry_id:753679) $M$ 本身可能在每次克雷洛夫迭代中发生变化（例如，当 $M^{-1}$ 涉及到一个迭代求解过程，其容忍度是自适应的时）。在这种情况下，标准 GMRES 会失效。为了处理这种**变化的预处理器**，需要使用**柔性 GMRES**（Flexible GMRES, [FGMRES](@entry_id:749308)）。[FGMRES](@entry_id:749308) 修改了标准的 Arnoldi 过程，以牺牲一定的内存为代价，来适应变化的预处理器，同时保持其[残差最小化](@entry_id:754272)性质。[@problem_id:3511975] [@problem_id:3511967]

另外，GMRES 的一个缺点是其内存和计算成本随迭代次数[线性增长](@entry_id:157553)。为了控制成本，通常使用**重启动的 GMRES**（[GMRES(m)](@entry_id:749937)），即每 $m$ 次迭代后就丢弃已构建的[克雷洛夫子空间](@entry_id:751067)，并以当前的解作为初值重新开始。然而，当系统矩阵**非正规**（non-normal）时（这在[多物理场](@entry_id:164478)问题中很常见），重启动可能导致收敛停滞，即使矩阵的[特征值分布](@entry_id:194746)看起来很好。这是因为重启动丢失了已捕获的关于算子的全局信息。[@problem_id:3511975]

### 综合应用：[收敛监控](@entry_id:747855)与方法选择

一个鲁棒的 JFNK 求解器需要可靠的**[停止准则](@entry_id:136282)**。由于多物理场问题中变量和方程的尺度各异，所有[收敛判据](@entry_id:158093)都应基于经过缩放或[无量纲化](@entry_id:136704)的量。一套完整的[停止准则](@entry_id:136282)通常包括：

1.  **缩放后的[残差范数](@entry_id:754273)**：$\|W F(x_k)\|_2 \le \epsilon_{\text{abs}} + \epsilon_{\text{rel}} \|W F(x_0)\|_2$。这确保了方程在指定的相对或绝对精度下得到满足。
2.  **缩放后的更新步长范数**：$\|S^{-1} \Delta x_k\|_2 \le \epsilon_{\text{step}}(\|S^{-1} x_k\|_2 + 1)$。这确保了迭代过程已趋于稳定，解不再发生显著变化。

同时满足这两个条件是宣告收敛的一个稳健标准。只依赖其中一个（例如，仅检查步长小）是危险的，因为算法可能因数值困难而停滞在远离解的地方。[@problem_id:3511969]

JFNK 方法之所以成为求解大规模、强耦合、[非线性](@entry_id:637147)多物理场问题的首选方法之一，是因为它在计算成本、内存占用和收敛鲁棒性之间取得了出色的平衡：
- 与**[稀疏直接求解器](@entry_id:755097)**（如 LU 分解）相比，JFNK 的内存占用要小得多，使其能够处理更大规模的问题。直接法在三维问题上的计算和内存复杂度的增长率（通常超线性）也使其在并行扩展性上不如迭代法。[@problem_id:3511968]
- 与**[不动点迭代](@entry_id:749443)**（如 Picard 或块高斯-赛德尔）相比，JFNK（作为一种牛顿法）具有更强的鲁棒性和更快的局部收敛速度，特别是对于强耦合问题，[不动点迭代](@entry_id:749443)的收敛无法保证，或者收敛极其缓慢。[@problem_id:3511968]

### 高级主题：处理非光滑物理问题

许多重要的物理现象本质上是**非光滑**的，例如接触力学中的单边约束、材料的塑性或损伤、以及相变过程。这些现象在数学上表现为残差函数 $F(u)$ 在某些点上不可微（但通常是 Lipschitz 连续的）。

标准的牛顿法依赖于[可微性](@entry_id:140863)。然而，JFNK 方法可以被巧妙地推广以处理这类问题。关键在于，即使经典的雅可比矩阵不存在，**方向导数**通常仍然存在。JFNK 中使用的[前向差分](@entry_id:173829)[雅可比-向量积](@entry_id:162748)近似，恰好是对**布利甘方向导数**（Bouligand directional derivative）的一阶近似。
$$
\frac{F(u + \epsilon v) - F(u)}{\epsilon} \to F'_B(u; v) \quad \text{as} \quad \epsilon \to 0^+
$$
基于此，一种被称为**[半光滑牛顿法](@entry_id:754689)**（semismooth Newton method）的理论被建立起来。该理论表明，只要函数具有所谓的“半光滑”结构（这包括了由光滑函数和 `max`、`min` 等[函数复合](@entry_id:144881)而成的许多物理模型），即使在不可微点，牛顿法依然能够保持[超线性收敛](@entry_id:141654)。因此，直接应用标准的 JFNK（使用[前向差分](@entry_id:173829)）通常是一种处理非光滑问题的有效策略。[@problem_id:3511970]

处理非光滑问题的其他策略包括：
- **正则化/光滑化**：用一个[光滑函数](@entry_id:267124) $\phi_\mu(u)$ 来近似非光滑项（如 `max(0, x)`），其中 $\mu$ 是一个光滑参数。然后求解这个光滑的近似问题。通过一个连续过程，让 $\mu \to 0$，可以逐步逼近原始非光滑问题的解。
- **主动集策略**（Active-set strategy）：这是一种组合方法，它明确地将问题分解为在不同的“光滑”分支上求解。例如，在接触问题中，算法会维护一个“接触”和“非接触”节点的集合，并在每个集合上求解相应的光滑问题，同时根据迭代过程中的物理条件在集合之间转移节点。[@problem_id:3511970]

这些高级技术进一步扩展了 JFNK 方法的应用范围，使其成为现代[多物理场仿真](@entry_id:145294)中不可或缺的强大工具。