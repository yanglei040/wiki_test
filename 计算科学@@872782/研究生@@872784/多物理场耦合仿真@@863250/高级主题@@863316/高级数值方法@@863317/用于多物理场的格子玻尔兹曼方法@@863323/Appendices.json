{"hands_on_practices": [{"introduction": "在多相流的格子玻尔兹曼方法（LBM）模拟中，一个常见的挑战是在相界面附近出现非物理性的寄生速度，即“伪电流”。这些伪电流源于离散格式在计算界面力时的各向异性误差。这项练习 [@problem_id:3528746] 将指导您通过量纲分析和标度律推导，来预测伪电流的大小，这对于验证多相流模拟的准确性和理解其内在局限性至关重要。", "problem": "考虑一个用于多相流体的二维格子玻尔兹曼方法（LBM），该方法使用非理想状态方程，使得一个界面分隔两相，并且由非理想压力张量引起宏观表面张力。该方法采用单弛豫时间 Bhatnagar-Gross-Krook (BGK) 碰撞算子、标准的 D2Q9 离散速度集和基于伪势的力方案。在实践中，力重构的离散各向异性与非理想状态方程相结合，会产生界面法向和界面切向的离散化误差，这些误差表现为弯曲界面附近的伪电流。\n\n从连续介质、低雷诺数、稳态动量平衡出发，结合弯曲界面处的力学平衡和离散力各向异性标度，推导出一个圆形界面附近最大伪速度的显式渐近标度关系。使用以下基础：\n\n- 牛顿流体的稳态 Stokes 动量平衡，$0 = -\\nabla p + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{f}$，其中 $\\mu$ 是动力黏度，$\\mathbf{f}$ 是体积力密度。\n- Young–Laplace 关系，描述了跨越弯曲界面的压力跳跃与表面张力之间的关系，$\\Delta p = \\sigma \\kappa$，其中 $\\sigma$ 是表面张力，$\\kappa$ 是曲率。对于半径为 $R$ 的圆，$\\kappa = 1/R$。\n- 对于格子间距为 $dx$、时间步长为 $dt$ 的 D2Q9 模型，格子玻尔兹曼方法中弛豫时间与物理单位下运动黏度之间的映射关系，即 $\\nu = \\dfrac{dx^2}{3\\,dt}\\left(\\tau - \\dfrac{1}{2}\\right)$，以及 $\\mu = \\rho \\nu$，其中 $\\rho$ 是质量密度。\n- 一个二阶精度的离散力各向异性，由无量纲系数 $\\alpha$ 表征，该系数定义为界面毛细力重构中主导阶相对误差的幅值。假设界面厚度 $w$ 的标度为 $w \\sim \\mathcal{O}(dx)$。\n\n您的推导必须阐明非理想状态方程如何通过引起的表面张力影响伪电流的强度，并解释为什么预测的伪电流在平面界面极限下会消失。结果应为一个关于 $\\alpha$、$\\sigma$、$dx$、$\\mu$ 和 $R$ 的显式公式，用于表示界面处的最大伪速度，单位为米/秒。\n\n然后，实现一个程序，为一组测试用例计算预测的最大伪速度。对于每个用例，程序應接受直接指定的 $\\mu$ 或指定的 $\\tau$、$dx$、$dt$ 和 $\\rho$，并从中计算出 $\\mu$。如果指定 $R = 0$，则将其解释为平面界面极限，并返回伪速度为精确的零。\n\n物理单位和输出要求：\n\n- 所有速度均以米/秒（m/s）表示，四舍五入至六位小数。\n- 本问题不涉及角度。\n- 不使用百分比。\n\n测试套件和参数覆盖范围：\n\n- 情况1（一般弯曲界面情况；黏度由弛豫时间计算）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 1.0 \\times 10^{-3}$ m，$\\tau = 0.8$，$\\rho = 1000$ kg/m$^3$，$dt = 5.0 \\times 10^{-7}$ s。\n- 情况2（平面界面边界情况）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 0$ m（平面界面极限），$\\mu = 0.02$ Pa·s。\n- 情况3（小半径边界情况；黏度由弛豫时间计算）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 5.0 \\times 10^{-5}$ m，$\\tau = 0.8$，$\\rho = 1000$ kg/m$^3$，$dt = 5.0 \\times 10^{-7}$ s。\n- 情况4（高黏度情况；直接指定黏度）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 1.0 \\times 10^{-3}$ m，$\\mu = 0.1$ Pa·s。\n- 情况5（零各向异性边界情况）：$\\alpha = 0.0$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 5.0 \\times 10^{-4}$ m，$\\mu = 0.02$ Pa·s。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result1,result2,...]$），每个结果以 m/s 为单位，四舍五入至六位小数，并与上述测试用例的顺序相同。", "solution": "该问题是有效的，因为它在科学上基于计算流体力学的原理，特别是针对多相流的格子玻尔兹曼方法（LBM）中数值伪影的分析。这是一个适定、客观的问题，并为推导所要求的标度律和执行所需的计算提供了完整且一致的信息。\n\n最大伪速度（记为 $u_{max}$）的渐近标度律推导如下。\n\n1.  **控制动量平衡：** 伪电流是在毛细力 $\\delta \\mathbf{f}$ 实现过程中的数值误差驱动下的一种稳态流动现象。在低雷诺数极限下，该流动由稳态 Stokes 方程控制：\n    $$ 0 = -\\nabla p_{err} + \\mu \\nabla^2 \\mathbf{u} + \\delta \\mathbf{f} $$\n    这里，$\\mathbf{u}$ 是伪速度场，$p_{err}$ 是相关的误差压力场，$\\mu$ 是动力黏度。从此方程中，我们可以在黏性耗散项和驱动误差力项之间建立平衡：\n    $$ |\\mu \\nabla^2 \\mathbf{u}| \\sim |\\delta \\mathbf{f}| $$\n\n2.  **毛细力的表征：** 非理想状态方程在两流体相之间的界面上产生表面张力 $\\sigma$。如 Young–Laplace 关系所述，该表面张力在弯曲界面上维持一个压力跳跃 $\\Delta p$：\n    $$ \\Delta p = \\sigma \\kappa $$\n    对于半径为 $R$ 的圆形界面，曲率为 $\\kappa = 1/R$。在像 LBM 这样的数值方法中，这个力不是一个真正的表面力，而是被涂抹在一个有限厚度 $w$ 的弥散界面上。相应的力密度大小 $f_{\\sigma}$ 可以通过将压力跳跃分布在该厚度上进行估算：\n    $$ f_{\\sigma} \\sim \\frac{\\Delta p}{w} = \\frac{\\sigma \\kappa}{w} = \\frac{\\sigma}{R w} $$\n\n3.  **误差力的表征：** 问题指出，伪电流源于离散力各向异性，它在毛细力的重构中引入了一个相对误差。该误差的大小由无量纲系数 $\\alpha$ 给出。因此，误差力密度的大小 $\\delta f = |\\delta \\mathbf{f}|$ 与物理力密度的大小成正比：\n    $$ \\delta f \\sim \\alpha f_{\\sigma} \\sim \\frac{\\alpha \\sigma}{R w} $$\n\n4.  **标度分析：** 现在我们将力的估算代入动量平衡。为了估算黏性项，设 $u_{max}$ 为特征伪速度。误差力 $\\delta \\mathbf{f}$ 在厚度为 $w$ 的界面区域内起作用。由此产生的流场最陡峭的速度梯度将出现在相同的长度尺度上。因此，速度空间导数的特征长度为 $L \\sim w$。黏性项的标度如下：\n    $$ |\\mu \\nabla^2 \\mathbf{u}| \\sim \\mu \\frac{u_{max}}{L^2} \\sim \\mu \\frac{u_{max}}{w^2} $$\n    将标度化的黏性项和力项相等：\n    $$ \\mu \\frac{u_{max}}{w^2} \\sim \\frac{\\alpha \\sigma}{R w} $$\n\n5.  **速度标度律的推导：** 求解上述关系式得到 $u_{max}$：\n    $$ u_{max} \\sim \\frac{\\alpha \\sigma w^2}{\\mu R w} = \\frac{\\alpha \\sigma w}{\\mu R} $$\n\n6.  **引入格子离散化：** 问题指出界面厚度 $w$ 与格子间距 $dx$ 成标度关系，即 $w \\sim \\mathcal{O}(dx)$。这是许多弥散界面 LBM 方案的一个基本属性。将此依赖关系代入我们对 $u_{max}$ 的标度律中：\n    $$ u_{max} \\propto \\frac{\\alpha \\sigma \\, dx}{\\mu R} $$\n    为了得到一个显式的渐近公式，我们假设主导阶的比例常数为1。当没有提供精确的预因子（其取决于所使用的具体数值模板）时，这是标度分析中的常见做法。最终公式为：\n    $$ u_{max} = \\frac{\\alpha \\sigma \\, dx}{\\mu R} $$\n    该表达式的单位为 $(\\text{N}/\\text{m}) \\cdot \\text{m} / ((\\text{Pa} \\cdot \\text{s}) \\cdot \\text{m}) = ((\\text{kg} \\cdot \\text{m}/\\text{s}^2)/\\text{m}) \\cdot \\text{m} / ((\\text{kg}/(\\text{m} \\cdot \\text{s})) \\cdot \\text{m}) = (\\text{kg}/\\text{s}^2) / (\\text{kg}/\\text{m}^2 \\cdot \\text{s}) = \\text{m}/\\text{s}$，这正确地是一个速度单位。\n\n7.  **状态方程（EOS）和平面极限的影响：**\n    - 非理想 EOS 是相分离的物理起源，因此也是表面张力 $\\sigma$ 的物理起源。EOS 中更强的分子间势导致更大的 $\\sigma$。推导出的公式 $u_{max} \\propto \\sigma$ 表明，假设所有其他参数恒定，更强的表面张力会导致成比例增大的伪电流。\n    - 在平面界面的极限下，曲率半径 $R \\to \\infty$。该公式正确地预测了伪电流会消失：\n      $$ \\lim_{R \\to \\infty} u_{max} = \\lim_{R \\to \\infty} \\frac{\\alpha \\sigma \\, dx}{\\mu R} = 0 $$\n      这在物理上是正确的，因为对于平面界面，曲率 $\\kappa=0$，意味着驱动毛细力为零，因此计算该力的任何误差也必须为零。\n\n8.  **黏度的计算：** 当没有直接提供动力黏度 $\\mu$ 时，必须从 LBM 参数计算得出。运动黏度 $\\nu$ 由下式给出：\n    $$ \\nu = \\frac{dx^2}{3\\,dt}\\left(\\tau - \\frac{1}{2}\\right) $$\n    然后动力黏度为 $\\mu = \\rho \\nu$，其中 $\\rho$ 是流体密度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum spurious speed in a lattice Boltzmann simulation\n    for a set of test cases based on a derived asymptotic scaling law.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General curved-interface, viscosity from LBM params\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 1.0e-3, 'tau': 0.8, 'rho': 1000, 'dt': 5.0e-7},\n        # Case 2: Planar-interface limit\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 0, 'mu': 0.02},\n        # Case 3: Small-radius edge case\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 5.0e-5, 'tau': 0.8, 'rho': 1000, 'dt': 5.0e-7},\n        # Case 4: High-viscosity case, direct mu\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 1.0e-3, 'mu': 0.1},\n        # Case 5: Zero-anisotropy edge case\n        {'alpha': 0.0, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 5.0e-4, 'mu': 0.02},\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha = case['alpha']\n        sigma = case['sigma']\n        dx = case['dx']\n        R = case['R']\n\n        # Handle special cases that result in zero spurious speed.\n        # R=0 is defined as the planar-interface limit.\n        # alpha=0 means no anisotropy error.\n        if R == 0 or alpha == 0:\n            u_max = 0.0\n            results.append(f\"{u_max:.6f}\")\n            continue\n\n        # Determine dynamic viscosity mu\n        if 'mu' in case:\n            mu = case['mu']\n        else:\n            # Calculate mu from LBM parameters\n            tau = case['tau']\n            rho = case['rho']\n            dt = case['dt']\n            # Kinematic viscosity: nu = c_s^2 * (tau - 0.5) * dt\n            # For D2Q9, c_s^2 = (dx/dt)^2 / 3, so nu = (dx^2 / (3*dt)) * (tau - 0.5)\n            nu = (dx**2 / (3 * dt)) * (tau - 0.5)\n            mu = rho * nu\n\n        # Calculate maximum spurious speed using the derived formula\n        # u_max = (alpha * sigma * dx) / (mu * R)\n        u_max = (alpha * sigma * dx) / (mu * R)\n        \n        # Round and format the result\n        results.append(f\"{u_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3528746"}, {"introduction": "在许多工程和自然现象中，流体在固体表面上的移动接触线动力学是一个核心问题。移动接触线涉及表面张力、粘性力以及流固相互作用之间的复杂平衡，其宏观行为通常可以通过Voinov-Tanner-Cox理论来描述。在本练习 [@problem_id:3528767] 中，您将应用广义纳维边界条件（Generalized Navier Boundary Condition），将微观尺度上的滑移长度与宏观的动态接触角联系起来，从而深入理解LBM如何用于模拟复杂的界面物理。", "problem": "考虑一个光滑固体壁面上的二维移动接触线，该系统处于等温不可压缩牛顿流体中，并使用带有单弛豫时间 Bhatnagar–Gross–Krook (BGK) 碰撞算子的格子玻尔兹曼方法 (LBM) 进行建模。在壁面处，施加广义 Navier 边界条件 (GNBC)，该条件在经典 Navier 滑移的基础上增加了未补偿的 Young 应力。设滑移长度为 $\\lambda_s$，动力粘度为 $\\mu$，表面张力为 $\\sigma$，接触线速度为 $U$，平衡接触角为 $\\theta_e$（以弧度为单位）。毛细数为 $Ca = \\mu U / \\sigma$。假设采用扩散界面描述，界面厚度为 $\\xi$。\n\n基本原理：\n- 经典的 Navier 滑移条件通过 $u_t = \\lambda_s \\tau_{wt}/\\mu$ 关联了壁面处的切向流体速度 $u_t$ 和切向粘性应力 $\\tau_{wt}$。\n- 广义 Navier 边界条件 (GNBC) 在壁面处强制执行切向应力平衡，该平衡表现为粘性应力与因动态接触角 $\\theta$ 偏离平衡接触角 $\\theta_e$ 而产生的未补偿 Young 应力之和。\n- 在小毛细数区域，接触线附近的流体动力学由楔形区域内的 Stokes 流主导，界面的粘性弯曲由宏观长度尺度 $\\ell_{macro}$ 与微观截断长度 $\\ell_{micro}$之比的对数因子控制。\n- 在使用 BGK 的 LBM 中，运动粘度为 $ \\nu = c_s^2 (\\tau - 1/2) \\Delta t $，其中格子声速 $ c_s^2 = 1/3 $，$\\tau$ 是弛豫时间，$\\Delta t$ 是时间步长。并且 $\\mu = \\rho \\nu$，其中 $\\rho$ 为密度。为方便解题，本题中 $\\mu$ 以物理单位直接给出。\n\n任务：\n- 从上述基本原理出发，推导一个连接动态接触角 $\\theta$ 与 $Ca$、$\\theta_e$ 以及宏观与微观长度尺度之比的对数的主导阶渐近关系。使用 $\\ell_{micro} = \\max(\\lambda_s, \\xi)$ 作为物理相关的微观截断，$\\ell_{macro}$ 作为给定的流动宏观长度尺度。定义无量纲系数\n$$\nK \\equiv \\frac{\\theta^3 - \\theta_e^3}{Ca \\, \\ln\\!\\left( \\frac{\\ell_{macro}}{\\ell_{micro}} \\right)}.\n$$\n实现一个算法，在给定 $(\\mu, \\sigma, U, \\theta_e, \\lambda_s, \\xi, \\ell_{macro})$ 的情况下，根据小 $Ca$ 楔形流渐近理论计算动态接触角 $\\theta$（以弧度为单位），并以浮点数形式输出 $\\theta$ 和 $K$。当 $Ca = 0$ 或 $\\ell_{macro} \\le \\ell_{micro}$ 时，为与极限平衡保持一致，设 $\\theta = \\theta_e$ 且 $K = 0$。\n\n单位与数值要求：\n- $\\mu$ 的单位为 $\\mathrm{Pa \\cdot s}$，$\\sigma$ 的单位为 $\\mathrm{N/m}$，$U$ 的单位为 $\\mathrm{m/s}$，$\\theta_e$ 和 $\\theta$ 的单位为弧度，$\\lambda_s$、$\\xi$ 和 $\\ell_{macro}$ 的单位为米。\n- 使用自然对数 $\\ln(\\cdot)$。\n- 所有角度均以弧度表示，所有输出均四舍五入至六位小数。\n\n测试套件：\n计算以下五个测试用例的 $(\\theta, K)$，每个用例均以 $(\\mu, \\sigma, U, \\theta_e, \\lambda_s, \\xi, \\ell_{macro})$ 的形式给出，单位如上所述：\n1. $(0.001, 0.072, 0.01, \\pi/3, 1 \\times 10^{-7}, 5 \\times 10^{-8}, 1 \\times 10^{-3})$。\n2. $(0.001, 0.072, 0, \\pi/3, 1 \\times 10^{-7}, 5 \\times 10^{-8}, 1 \\times 10^{-3})$。\n3. $(0.1, 0.03, 0.02, 0.5235987756, 1 \\times 10^{-6}, 5 \\times 10^{-7}, 5 \\times 10^{-3})$。\n4. $(0.005, 0.05, 0.001, 1.2217304764, 9 \\times 10^{-7}, 1 \\times 10^{-6}, 1.1 \\times 10^{-6})$。\n5. $(0.02, 0.07, 0.005, 0.7853981634, 3 \\times 10^{-7}, 2 \\times 10^{-7}, 2 \\times 10^{-3})$。\n\n最终输出规格：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。\n- 对于每个测试用例，按顺序输出两个浮点数：首先是计算出的动态接触角 $\\theta$（以弧度为单位），然后是系数 $K$，两者均四舍五入至六位小数。\n- 五个案例的输出必须按照测试套件的相同顺序连接，形成一个长度为 10 的列表。\n- 格式示例：$[\\theta_1, K_1, \\theta_2, K_2, \\theta_3, K_3, \\theta_4, K_4, \\theta_5, K_5]$。", "solution": "该问题要求推导移动接触线动态接触角的主导阶渐近关系，并随后应用该关系来计算动态角 $\\theta$ 和无量纲系数 $K$。该物理系统包含与光滑固体壁面接触的等温不可压缩牛顿流体，接触线以速度 $U$ 移动。\n\n核心物理原理在于毛细效应与粘性效应之间的平衡。毛细效应倾向于将接触角恢复到其平衡值 $\\theta_e$，而粘性效应则源于流体运动，导致接触角偏离平衡值。此问题设定在小毛细数区域，其中 $Ca = \\mu U / \\sigma \\ll 1$，$\\mu$ 为动力粘度，$\\sigma$ 为表面张力。在这些条件下，接触线附近的微观楔形区域中的流体动力学由 Stokes 流方程控制。\n\n问题陈述施加了广义 Navier 边界条件 (GNBC)，该条件解释了壁面处的切向应力平衡。这种平衡涉及流体的粘性应力以及因动态接触角 $\\theta$ 偏离其平衡值 $\\theta_e$ 而产生的未补偿 Young 应力。单位长度接触线上的未补偿 Young 力为 $F_Y = \\sigma(\\cos\\theta_e - \\cos\\theta)$。该力对系统做功的速率为 $W_{in} = F_Y U = \\sigma U (\\cos\\theta_e - \\cos\\theta)$。此功与流体内的粘性耗散率 $\\mathcal{D}$ 相平衡。\n\n正如问题“基本原理”部分所述，移动接触线问题的一个关键方面是，对于无滑移边界条件，对粘性耗散的朴素计算会导致接触线处出现不可积的应力奇点。通过引入一个微观截断长度尺度 $\\ell_{micro}$，可以解决这个奇点问题。在该尺度以下，连续介质描述失效或被修正（例如，通过滑移）。问题将此截断指定为 $\\ell_{micro} = \\max(\\lambda_s, \\xi)$，其中 $\\lambda_s$ 是 Navier 滑移长度，$\\xi$ 是扩散界面的厚度。\n\n问题中提到的“粘性弯曲”分析涉及匹配渐近展开，它将“内部”区域（$\\ell_{micro}$ 附近）与“外部”宏观区域（尺度为 $\\ell_{macro}$）连接起来。这项由 Voinov、Tanner 和 Cox 开创的分析表明，总耗散 $\\mathcal{D}$ 与这些长度尺度的比值成对数关系。能量平衡 $W_{in} = \\mathcal{D}$ 得出了接触角和毛细数之间的关系。\n\n对于液体驱替不粘性气体的情况，并在小角度（$\\theta, \\theta_e \\ll 1$）的假设下，该分析得出了著名的 Voinov-Tanner-Cox 定律：\n$$\n\\theta^3 - \\theta_e^3 = C \\cdot Ca \\ln\\left(\\frac{\\ell_{macro}}{\\ell_{micro}}\\right)\n$$\n其中常数 $C$ 被确定为 $9$。尽管这个结果在形式上是为小角度推导的，但它通常作为一个鲁棒模型被用于更大的角度，所提供的测试用例也默认认可了这种方法，其中一些用例的 $\\theta_e$ 值远大于零（例如 $\\pi/3$）。\n\n问题将无量纲系数 $K$ 定义为：\n$$\nK \\equiv \\frac{\\theta^3 - \\theta_e^3}{Ca \\, \\ln\\!\\left( \\frac{\\ell_{macro}}{\\ell_{micro}} \\right)}\n$$\n将此定义与 Voinov-Tanner-Cox 关系进行比较，很明显，问题引导我们采用这一物理定律，其中 $K$ 代表理论上的比例常数 $C$。因此，在一般情况下我们设定 $K=9$。\n\n计算任务是使用此关系求解 $\\theta$。重新排列方程可得：\n$$\n\\theta^3 = \\theta_e^3 + 9 \\cdot Ca \\cdot \\ln\\left(\\frac{\\ell_{macro}}{\\ell_{micro}}\\right)\n$$\n由此，动态接触角 $\\theta$ 可计算为：\n$$\n\\theta = \\left( \\theta_e^3 + 9 \\cdot Ca \\cdot \\ln\\left(\\frac{\\ell_{macro}}{\\ell_{micro}}\\right) \\right)^{1/3}\n$$\n一旦求出 $\\theta$，即可确定 $K$ 的值。对于所有 $Ca > 0$ 且 $\\ell_{macro} > \\ell_{micro}$ 的情况，将 $\\theta^3$ 的表达式代入 $K$ 的定义中，显然可得 $K=9$。\n\n问题为计算指定了边界条件。如果 $Ca = 0$（即 $U=0$），或者长度尺度的排序使得 $\\ell_{macro} \\le \\ell_{micro}$（这使得对数项为非正值，在此物理情境下无意义），则不存在驱动角度偏离平衡的粘性耗散。在这些情况下，动态角等于平衡角，即 $\\theta = \\theta_e$，并且系数 $K$ 设为 $0$，这与无运动或尺度分离失效的物理极限相一致。\n\n算法如下：\n1. 对于每个测试用例 $(\\mu, \\sigma, U, \\theta_e, \\lambda_s, \\xi, \\ell_{macro})$，计算毛细数 $Ca = \\mu U / \\sigma$ 和微观长度尺度 $\\ell_{micro} = \\max(\\lambda_s, \\xi)$。\n2. 检查特殊条件：如果 $Ca = 0$ 或 $\\ell_{macro} \\le \\ell_{micro}$，则设 $\\theta = \\theta_e$ 且 $K = 0$。\n3. 否则，使用公式 $\\theta = (\\theta_e^3 + 9 \\cdot Ca \\cdot \\ln(\\ell_{macro}/\\ell_{micro}))^{1/3}$ 计算 $\\theta$。设 $K=9$。\n4. 报告 $\\theta$ 和 $K$，均四舍五入到六位小数。\n\n此程序基于已建立的移动接触线流体动力学理论，将被实施以解决给定的测试用例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the dynamic contact angle and a related coefficient for a moving\n    contact line based on the Voinov-Tanner-Cox law.\n    \"\"\"\n    # The test suite provides parameters in the order:\n    # (mu, sigma, U, theta_e, lambda_s, xi, l_macro)\n    # Units: mu (Pa.s), sigma (N/m), U (m/s), theta_e (rad),\n    # lambda_s (m), xi (m), l_macro (m).\n    test_cases = [\n        (0.001, 0.072, 0.01, np.pi/3, 1e-7, 5e-8, 1e-3),\n        (0.001, 0.072, 0, np.pi/3, 1e-7, 5e-8, 1e-3),\n        (0.1, 0.03, 0.02, 0.5235987756, 1e-6, 5e-7, 5e-3),\n        (0.005, 0.05, 0.001, 1.2217304764, 9e-7, 1e-6, 1.1e-6),\n        (0.02, 0.07, 0.005, 0.7853981634, 3e-7, 2e-7, 2e-3),\n    ]\n\n    results = []\n    for case in test_cases:\n        mu, sigma, U, theta_e, lambda_s, xi, l_macro = case\n\n        # 1. Calculate Capillary number and microscopic length scale\n        if sigma == 0:\n            # Avoid division by zero, though not expected in test cases.\n            # A non-zero surface tension is fundamental to the problem.\n            Ca = np.inf if U > 0 else 0\n        else:\n            Ca = mu * U / sigma\n        \n        l_micro = max(lambda_s, xi)\n\n        # 2. Check for special cases\n        if Ca == 0 or l_macro <= l_micro:\n            theta = theta_e\n            K = 0.0\n        else:\n            # 3. Apply the Voinov-Tanner-Cox law\n            # The asymptotic relation is theta^3 - theta_e^3 = 9 * Ca * ln(l_macro/l_micro)\n            \n            log_term = np.log(l_macro / l_micro)\n            \n            theta_cubed = theta_e**3 + 9 * Ca * log_term\n            \n            # Ensure the argument for the cube root is non-negative,\n            # though physics dictates it should be for Ca > 0.\n            if theta_cubed < 0:\n                # This physical scenario is unlikely given the problem statement.\n                # However, for robustness, one might take the real root of a negative.\n                theta = -np.cbrt(-theta_cubed)\n            else:\n                theta = np.cbrt(theta_cubed)\n\n            # The coefficient K, by its definition in the problem and the law used,\n            # must be 9 for the non-special cases.\n            K = 9.0\n\n        # 4. Round results to six decimal places and append to the list\n        results.append(round(theta, 6))\n        results.append(round(K, 6))\n\n    # Final print statement in the exact required format.\n    # The map to str is important for correct formatting of floats like 9.0\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3528767"}, {"introduction": "格子玻尔兹曼方法的一大优势在于其灵活性，能够通过与其它数值方法（如有限差分法）耦合，形成功能强大的混合算法，以模拟复杂的非牛顿流体。粘弹性流体（如聚合物溶液）的行为由其本构方程决定，这为模拟带来了额外的挑战。这项高级练习 [@problem_id:3528785] 将引导您构建一个完整的LBM-FDM混合求解器，用于模拟Oldroyd-B流体的四辊磨流动，并捕捉粘弹性流体特有的线圈-拉伸转变现象，展示LBM在尖端多物理场研究中的应用潜力。", "problem": "构建一个完整的、可运行的程序，实现用于等温、不可压缩、粘弹性流体的二维混合格子玻尔兹曼方法（LBM）。该流体由 Oldroyd-B 本构律建模。目标是随着 Weissenberg 数的增加，捕捉并分类周期性强迫、空间周期性流中的线团-拉伸转变。所有数学实体必须用 LaTeX 表示。所有量均为无量纲（格子单位），因此不需要物理单位转换。\n\n您必须基于以下基本内容开始：\n- 带有额外聚合物应力的等温、不可压缩 Navier–Stokes 方程，\n$$\\rho\\left(\\partial_t \\mathbf{u} + \\mathbf{u}\\cdot\\nabla\\mathbf{u}\\right) = -\\nabla p + \\eta_s \\nabla^2 \\mathbf{u} + \\nabla\\cdot\\mathbf{\\tau} + \\mathbf{f}_{\\text{ext}}, \\quad \\nabla\\cdot\\mathbf{u} = 0,$$\n其中 $\\rho$ 是质量密度，$\\mathbf{u}$ 是速度场，$p$ 是压力，$\\eta_s$ 是溶剂粘度，$\\mathbf{\\tau}$ 是聚合物额外应力张量，$\\mathbf{f}_{\\text{ext}}$ 是外部施加的彻体力密度。\n\n- 包含上随钻导数的聚合物应力 Oldroyd-B 本构方程，\n$$\\overset{\\nabla}{\\mathbf{\\tau}} + \\frac{1}{\\lambda}\\mathbf{\\tau} = \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right),$$\n其中\n$$\\overset{\\nabla}{\\mathbf{\\tau}} \\equiv \\partial_t \\mathbf{\\tau} + \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} - \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} - \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right),$$\n其中 $\\lambda$ 是聚合物弛豫时间，$\\eta_p$ 是聚合物对粘度的贡献。\n\n- 用于溶剂动量动力学的、在 D2Q9 格子上的单弛豫时间 Bhatnagar–Gross–Krook (BGK) 格子玻尔兹曼方法 (LBM)。在格子单位中，格子间距 $\\Delta x = 1$ 且时间步长 $\\Delta t = 1$，平衡分布函数使用标准的二阶展开，运动粘度通过以下公式与弛豫时间相关\n$$\\nu = c_s^2\\left(\\tau_s - \\frac{1}{2}\\right), \\quad c_s^2 = \\frac{1}{3}.$$\n通过一个一致的力项格式将外部力和聚合物力引入，该格式将彻体力密度 $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\nabla\\cdot \\mathbf{\\tau}$ 添加到动量方程中。\n\n- 在平面拉伸流中，Hookean 哑铃的线团-拉伸转变发生在临界 Weissenberg 数\n$$Wi_c = \\lambda \\dot{\\epsilon}_0 = \\frac{1}{2},$$\n其中 $\\dot{\\epsilon}_0$ 是驻点附近的局部拉伸率。\n\n您必须在程序中设计并实现以下内容：\n\n1) 区域与离散化。使用一个在 D2Q9 格子上离散的方形周期性区域，包含 $N \\times N$ 个节点。所有场在两个方向上都是周期性的。使用 $N = 32$。定义波数\n$$k = m \\frac{2\\pi}{N},$$\n其中 $m = 4$。\n\n2) 外部强迫。使用彻体力密度驱动一个四辊磨机式的周期流\n$$\\mathbf{f}_{\\text{ext}}(x,y) = f_0 \\begin{bmatrix} \\sin\\left(k x\\right)\\cos\\left(k y\\right) \\\\ -\\cos\\left(k x\\right)\\sin\\left(k y\\right) \\end{bmatrix}.$$\n对于与此强迫平衡的 Stokes 流，稳态速度场具有以下形式\n$$\\mathbf{u}(x,y) \\approx U_0 \\begin{bmatrix} \\sin\\left(k x\\right)\\cos\\left(k y\\right) \\\\ -\\cos\\left(k x\\right)\\sin\\left(k y\\right) \\end{bmatrix},$$\n驻点附近的拉伸率由 $\\dot{\\epsilon}_0 \\approx k U_0$ 给出，并且在 Stokes 极限下，振幅服从\n$$U_0 \\approx \\frac{f_0}{2\\nu k^2}.$$\n选择目标速度振幅 $U_0^\\star = 0.05$ 并由下式确定 $f_0$\n$$f_0 = 2 \\nu k^2 U_0^\\star.$$\n\n3) LBM 溶剂求解器。实现一个 D2Q9 BGK LBM，其弛豫时间 $\\tau_s = 0.6$，因此\n$$\\nu = \\frac{1}{3}\\left(\\tau_s - \\frac{1}{2}\\right).$$\n使用 Guo 力项格式或等效的一致性方法来引入总彻体力密度 $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\nabla\\cdot \\mathbf{\\tau}$。使用带有半步长力校正的标准动量更新来计算宏观速度，\n$$\\rho \\mathbf{u} = \\sum_i \\mathbf{c}_i f_i + \\frac{1}{2}\\mathbf{F}, \\quad \\rho = \\sum_i f_i,$$\n其中 $f_i$ 是分布函数，$\\mathbf{c}_i$ 是离散格子速度。\n\n4) 聚合物应力演化。使用 Oldroyd-B 模型的显式时间积分器，在格子单位中演化聚合物应力 $\\mathbf{\\tau}$，\n$$\\partial_t \\mathbf{\\tau} = - \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} + \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} + \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right) - \\frac{1}{\\lambda}\\mathbf{\\tau} + \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right).$$\n在周期性边界条件下，使用中心差分法离散化空间导数。为了进行数值正则化，引入一个小的、均匀的人工应力扩散项 $\\kappa \\nabla^2 \\mathbf{\\tau}$，其常数 $\\kappa$ 满足 $\\kappa \\ll 1$。使用 $\\kappa = 10^{-4}$。使用 $\\eta_p = 0.02$ 并在所有位置初始化 $\\mathbf{\\tau} = \\mathbf{0}$。\n\n5) 线团-拉伸检测。令驻点附近的拉伸率近似为 $\\dot{\\epsilon}_0 \\approx k U_0^\\star$。临界弛豫时间为\n$$\\lambda_c = \\frac{1}{2 \\dot{\\epsilon}_0} = \\frac{1}{2 k U_0^\\star}.$$\n定义一个包含三个弛豫时间的测试套件，\n$$\\lambda_1 = 0.8\\,\\lambda_c, \\quad \\lambda_2 = 1.0\\,\\lambda_c, \\quad \\lambda_3 = 1.4\\,\\lambda_c.$$\n对于每个 $\\lambda_j$，运行耦合的 LBM–Oldroyd–B 模拟 $T$ 个时间步，其中 $T = 2000$。在每一步，计算\n$$M(t) = \\max_{x,y} \\operatorname{tr}\\left(\\mathbf{\\tau}(x,y,t)\\right),$$\n并记录 $M(t)$。在舍弃 $T_b = 500$ 步的初始瞬态后，通过对最后 $W$ 步的 $\\log\\left(M(t) + \\delta\\right)$ 进行直线拟合来估计指数增长率，其中 $W = 400$，$\\delta = 10^{-12}$ 以避免对零取对数。如果拟合斜率 $s$ 满足 $s > s_{\\text{th}}$（其中 $s_{\\text{th}} = 5\\times 10^{-4}$），则将状态分类为拉伸；否则分类为卷曲。如果在任何时候 $\\max_t M(t)$ 超过一个大的截止值 $M_{\\max} = 10^6$，则立即将该情况分类为拉伸。\n\n6) 测试套件与最终输出。使用固定参数 $N = 32$、$m = 4$、$\\tau_s = 0.6$、$\\eta_p = 0.02$、$\\kappa = 10^{-4}$、$U_0^\\star = 0.05$、$T = 2000$、$T_b = 500$、$W = 400$、$\\delta = 10^{-12}$、$s_{\\text{th}} = 5\\times 10^{-4}$、$M_{\\max} = 10^6$ 和 $\\rho = 1$。三个测试案例是上面定义的弛豫时间 $\\lambda_1$、$\\lambda_2$、$\\lambda_3$。您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的布尔值列表（例如，`[False,False,True]`），分别对应于 $\\lambda_1$、$\\lambda_2$ 和 $\\lambda_3$ 的线团-拉伸分类。所有输出均为无量纲。", "solution": "用户要求构建一个用于粘弹性流体的混合数值模拟。该问题是适定的、有科学依据的，并提供了构建唯一解所需的所有参数和方程。该方法将把用于溶剂流体动力学的格子玻尔兹曼方法（LBM）与用于演化由 Oldroyd-B 本构模型控制的聚合物额外應力张量的有限差分法（FDM）相结合。\n\n模拟按以下步骤进行：\n\n首先，我们建立计算域和初始条件。使用一个尺寸为 $N \\times N$（其中 $N=32$）的二维方形区域，在两个方向上都采用周期性边界条件。格子位置由整数坐标 $(i,j)$ 表示，其中 $i, j \\in \\{0, 1, \\dots, N-1\\}$。相应的物理坐标为 $(x, y) = (i \\Delta x, j \\Delta y)$，其中格子间距设为 $\\Delta x = \\Delta y = 1$。所有场都初始化为静止状态：速度 $\\mathbf{u}(x,y,0) = \\mathbf{0}$，恒定密度 $\\rho(x,y,0) = \\rho_0=1$，以及零聚合物应力 $\\mathbf{\\tau}(x,y,0) = \\mathbf{0}$。\n\n流动由一个不随时间变化的外部彻体力驱动，形成一个四辊磨机模式：\n$$\n\\mathbf{f}_{\\text{ext}}(x,y) = f_0 \\begin{bmatrix} \\sin(kx)\\cos(ky) \\\\ -\\cos(kx)\\sin(ky) \\end{bmatrix}\n$$\n其中波数为 $k = m \\frac{2\\pi}{N}$，且 $m=4$。力振幅 $f_0$ 的选择是为了在 Stokes 流极限下匹配目标速度振幅 $U_0^\\star = 0.05$，由 $f_0 = 2\\nu k^2 U_0^\\star$ 给出。溶剂的运动粘度由 LBM 弛豫参数 $\\tau_s=0.6$ 确定，即 $\\nu = c_s^2(\\tau_s - 1/2)$，其中格子声速的平方为 $c_s^2 = 1/3$。\n\n模拟以 $\\Delta t=1$ 的离散时间步长进行演化。在每个时间步，执行以下计算序列：\n\n1.  **聚合物力计算**：聚合物应力张量 $\\mathbf{\\tau}$ 对流体施加一个力，由其散度 $\\mathbf{F}_p = \\nabla \\cdot \\mathbf{\\tau}$ 给出。该力的分量为：\n    $$\n    (\\mathbf{F}_p)_x = \\frac{\\partial \\tau_{xx}}{\\partial x} + \\frac{\\partial \\tau_{xy}}{\\partial y} \\quad \\text{和} \\quad (\\mathbf{F}_p)_y = \\frac{\\partial \\tau_{yx}}{\\partial x} + \\frac{\\partial \\tau_{yy}}{\\partial y}\n    $$\n    假设应力张量对称（$\\tau_{xy} = \\tau_{yx}$），这些导数在网格上使用带有周期性边界条件的二阶中心差分格式计算。对于一个通用场 $\\phi(x,y)$，导数近似为：\n    $$\n    \\frac{\\partial \\phi}{\\partial x}\\bigg|_{(i,j)} \\approx \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}, \\quad \\frac{\\partial \\phi}{\\partial y}\\bigg|_{(i,j)} \\approx \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}\n    $$\n\n2.  **用于溶剂动力学的 LBM 求解器**：溶剂的运动采用带有 Bhatnagar-Gross-Krook (BGK) 碰撞算子的 D2Q9 格子玻尔兹曼格式进行建模。对于 9 个格子速度 $\\mathbf{c}_i$ 中的每一个，离散粒子分布函数 $f_i(\\mathbf{x}, t)$ 的演化被分为碰撞和迁移两步。作用在流体上的总彻体力密度为 $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\mathbf{F}_p$。\n\n    a. **宏观变量**：宏观流体密度 $\\rho$ 和速度 $\\mathbf{u}$ 从分布函数中恢复。速度计算包含 Guo 力项校正：\n    $$\n    \\rho = \\sum_{i=0}^{8} f_i, \\quad \\rho \\mathbf{u} = \\sum_{i=0}^{8} \\mathbf{c}_i f_i + \\frac{\\Delta t}{2}\\mathbf{F}\n    $$\n\n    b. **碰撞**：碰撞后的分布函数 $f_i^*$ 通过将当前分布 $f_i$ 向局部平衡态 $f_i^{\\text{eq}}$ 松弛并添加一个力项 $S_i$ 来计算：\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau_s} \\left(f_i(\\mathbf{x}, t) - f_i^{\\text{eq}}(\\rho, \\mathbf{u})\\right) + \\Delta t \\, S_i\n    $$\n    平衡分布函数 $f_i^{\\text{eq}}$ 是一个关于速度的二阶多项式：\n    $$\n    f_i^{\\text{eq}} = w_i \\rho \\left( 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right)\n    $$\n    其中 $w_i$是标准的 D2Q9 权重。Guo 力项 $S_i$ 由以下公式给出：\n    $$\n    S_i = \\left(1 - \\frac{1}{2\\tau_s}\\right) w_i \\left[ \\frac{\\mathbf{c}_i - \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})\\mathbf{c}_i}{c_s^4} \\right] \\cdot \\mathbf{F}\n    $$\n\n    c. **迁移**：分布函数根据其离散速度传播到相邻的格点：\n    $$\n    f_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n    $$\n\n3.  **用于聚合物应力的 FDM 求解器**：聚合物应力张量 $\\mathbf{\\tau}$ 根据 Oldroyd-B 本构方程进行演化，该方程使用一阶前向欧拉格式进行显式时间积分。问题中提供的方程是：\n    $$\n    \\partial_t \\mathbf{\\tau} = - \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} + \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} + \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right) - \\frac{1}{\\lambda}\\mathbf{\\tau} + \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right) + \\kappa \\nabla^2 \\mathbf{\\tau}\n    $$\n    这里，$\\lambda$ 是聚合物弛豫时间，$\\eta_p=0.02$ 是聚合物粘度，$\\kappa=10^{-4}$ 是用于数值稳定的人工应力扩散系数。速度 $\\mathbf{u}$ 及其梯度张量 $\\nabla \\mathbf{u}$ 从 LBM 步骤中获得。右侧的所有空间导数（对流项 $\\mathbf{u}\\cdot\\nabla \\mathbf{\\tau}$、$\\nabla \\mathbf{u}$ 中的速度梯度，以及拉普拉斯算子 $\\nabla^2 \\mathbf{\\tau}$）都使用中心差分计算。由于 $\\mathbf{\\tau}$ 是对称的，所以只需演化其分量 $\\tau_{xx}$、$\\tau_{yy}$ 和 $\\tau_{xy}$。\n\n4.  **线团-拉伸转变分析**：模拟针对三个不同的弛豫时间 $\\lambda$ 值进行，这些值是相对于理想拉伸流中线团-拉伸转变的临界值 $\\lambda_c$ 确定的。特征应变率估计为 $\\dot{\\epsilon}_0 \\approx k U_0^\\star$，这给出 $\\lambda_c = (2\\dot{\\epsilon}_0)^{-1}$。测试案例为 $\\lambda_1 = 0.8\\lambda_c$、$\\lambda_2 = 1.0\\lambda_c$ 和 $\\lambda_3 = 1.4\\lambda_c$。\n\n    对于每种情况，模拟运行 $T=2000$ 个时间步。在每一步记录应力张量的最大迹，$M(t) = \\max_{x,y} \\operatorname{tr}(\\mathbf{\\tau}(x,y,t))$。如果 $M(t)$ 超过一个爆破阈值 $M_{\\max}=10^6$，状态将立即被分类为“拉伸”。否则，在完整模拟之后，对 $t \\in [T-W, T-1)$ 的时间序列 $\\log(M(t)+\\delta)$ 进行分析，其中瞬态周期为 $T_b=500$ 步，分析窗口为 $W=400$ 步。对这些数据进行线性回归，如果得到的斜率 $s$ 大于阈值 $s_{\\text{th}}=5 \\times 10^{-4}$，则状态被分类为“拉伸”。否则，它被分类为“卷曲”。然后报告这三种情况的布尔结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a hybrid LBM-FDM solver for a 2D viscoelastic fluid (Oldroyd-B model)\n    to study the coil-stretch transition in a four-roll mill flow.\n    \"\"\"\n\n    # 1) Domain and discretization parameters\n    N = 32\n    m = 4\n    k = m * 2.0 * np.pi / N\n\n    # Simulation and analysis parameters\n    T = 2000\n    T_b = 500  # Burn-in/transient time\n    W = 400    # Analysis window size\n    delta_log = 1e-12\n    s_th = 5e-4\n    M_max = 1e6\n    assert T > T_b + W\n\n    # LBM parameters\n    rho0 = 1.0\n    tau_s = 0.6\n    c_s_sq = 1.0 / 3.0\n    nu = c_s_sq * (tau_s - 0.5)  # Kinematic viscosity eta_s / rho\n    \n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1],\n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=np.int32)\n    w = np.array([4.0/9.0, 1.0/9.0, 1.0/9.0, 1.0/9.0, 1.0/9.0,\n                  1.0/36.0, 1.0/36.0, 1.0/36.0, 1.0/36.0])\n\n    # Fluid and polymer parameters\n    U0_star = 0.05\n    f0 = 2.0 * nu * k**2 * U0_star\n    eta_p = 0.02\n    kappa = 1e-4\n\n    # 2) External forcing setup\n    x = np.arange(N)\n    y = np.arange(N)\n    X, Y = np.meshgrid(x, y)\n    \n    f_ext = np.zeros((2, N, N))\n    f_ext[0, :, :] = f0 * np.sin(k * X) * np.cos(k * Y)\n    f_ext[1, :, :] = -f0 * np.cos(k * X) * np.sin(k * Y)\n\n    # 5) Coil–stretch detection parameters\n    epsilon0_dot = k * U0_star\n    lambda_c = 0.5 / epsilon0_dot\n    lambdas = [0.8 * lambda_c, 1.0 * lambda_c, 1.4 * lambda_c]\n\n    results = []\n\n    # Helper functions for finite differences (periodic BCs, dx=dy=1)\n    def grad_x(field):\n        return (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / 2.0\n\n    def grad_y(field):\n        return (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / 2.0\n\n    def laplacian(field):\n        return (np.roll(field, 1, axis=1) + np.roll(field, -1, axis=1) +\n                np.roll(field, 1, axis=0) + np.roll(field, -1, axis=0) - 4.0 * field)\n\n    for lam in lambdas:\n        # Initialization for each simulation run\n        # LBM fields\n        f = np.zeros((9, N, N))\n        for i in range(9):\n            f[i, :, :] = w[i] * rho0\n        \n        rho = np.full((N, N), rho0)\n        u = np.zeros((2, N, N))\n        \n        # Polymer stress fields (symmetric tensor)\n        tau_xx = np.zeros((N, N))\n        tau_yy = np.zeros((N, N))\n        tau_xy = np.zeros((N, N))\n\n        max_trace_history = np.zeros(T)\n        is_stretched = False\n\n        for t in range(T):\n            # Compute polymer force F_p = div(tau)\n            Fp_x = grad_x(tau_xx) + grad_y(tau_xy)\n            Fp_y = grad_x(tau_xy) + grad_y(tau_yy)\n            \n            # Total force F = f_ext + F_p\n            F = f_ext.copy()\n            F[0] += Fp_x\n            F[1] += Fp_y\n\n            # LBM Step\n            # Macroscopic properties\n            rho = np.sum(f, axis=0)\n            u[0] = (np.sum(f * c[:, 0, np.newaxis, np.newaxis], axis=0) + 0.5 * F[0]) / rho\n            u[1] = (np.sum(f * c[:, 1, np.newaxis, np.newaxis], axis=0) + 0.5 * F[1]) / rho\n\n            # Collision\n            f_eq = np.zeros_like(f)\n            u_dot_u = u[0]**2 + u[1]**2\n            for i in range(9):\n                cu = c[i, 0] * u[0] + c[i, 1] * u[1]\n                f_eq[i] = w[i] * rho * (1 + cu / c_s_sq + cu**2 / (2 * c_s_sq**2) - u_dot_u / (2 * c_s_sq))\n            \n            # Guo forcing term\n            S = np.zeros_like(f)\n            force_factor = 1.0 - 0.5 / tau_s\n            for i in range(9):\n                cu = c[i, 0] * u[0] + c[i, 1] * u[1]\n                force_term_dot_F = ( (c[i,0]-u[0])*F[0] + (c[i,1]-u[1])*F[1] ) / c_s_sq \\\n                                 + ( cu*(c[i,0]*F[0]+c[i,1]*F[1]) ) / (c_s_sq**2)\n                S[i] = force_factor * w[i] * force_term_dot_F\n            \n            f_coll = f - (1.0 / tau_s) * (f - f_eq) + S\n            \n            # Streaming\n            for i in range(9):\n                f[i] = np.roll(f_coll[i], shift=(c[i, 1], c[i, 0]), axis=(0, 1))\n\n            # FDM Step for Polymer Stress (Forward Euler)\n            # Velocity gradients\n            duxdx = grad_x(u[0])\n            duxdy = grad_y(u[0])\n            duydx = grad_x(u[1])\n            duydy = grad_y(u[1])\n            \n            # Terms from Oldroyd-B equation\n            # Convection term: -u . grad(tau)\n            conv_xx = -(u[0] * grad_x(tau_xx) + u[1] * grad_y(tau_xx))\n            conv_yy = -(u[0] * grad_x(tau_yy) + u[1] * grad_y(tau_yy))\n            conv_xy = -(u[0] * grad_x(tau_xy) + u[1] * grad_y(tau_xy))\n            \n            # Stretching/rotation term in problem statement\n            # (nabla u)^T . tau + tau . (nabla u)\n            stretch_rot_xx = 2 * duxdx * tau_xx + (duydx + duxdy) * tau_xy\n            stretch_rot_yy = 2 * duydy * tau_yy + (duydx + duxdy) * tau_xy\n            stretch_rot_xy = (duxdx + duydy) * tau_xy + duxdy * tau_xx + duydx * tau_yy\n            \n            # Relaxation term: -tau / lambda\n            relax_xx = -tau_xx / lam\n            relax_yy = -tau_yy / lam\n            relax_xy = -tau_xy / lam\n            \n            # Strain term: (eta_p/lambda) * (nabla u + (nabla u)^T)\n            strain_rate_factor = eta_p / lam\n            strain_xx = strain_rate_factor * (2 * duxdx)\n            strain_yy = strain_rate_factor * (2 * duydy)\n            strain_xy = strain_rate_factor * (duxdy + duydx)\n            \n            # Artificial diffusion: kappa * laplacian(tau)\n            diff_xx = kappa * laplacian(tau_xx)\n            diff_yy = kappa * laplacian(tau_yy)\n            diff_xy = kappa * laplacian(tau_xy)\n\n            # Update stress tensor (dt=1)\n            tau_xx += conv_xx + stretch_rot_xx + relax_xx + strain_xx + diff_xx\n            tau_yy += conv_yy + stretch_rot_yy + relax_yy + strain_yy + diff_yy\n            tau_xy += conv_xy + stretch_rot_xy + relax_xy + strain_xy + diff_xy\n\n            # Analysis\n            trace_tau = tau_xx + tau_yy\n            max_trace_history[t] = np.max(trace_tau)\n\n            if max_trace_history[t] > M_max:\n                is_stretched = True\n                break\n        \n        if not is_stretched:\n            # Perform linear regression on log(M(t)) for t in [T-W, T)\n            analysis_time = np.arange(T - W, T)\n            analysis_data = np.log(max_trace_history[T - W:T] + delta_log)\n            # numpy.polyfit fits a polynomial p(x) = p[0] * x**deg + ... + p[deg]\n            # For deg=1, p[0] is the slope.\n            slope, _ = np.polyfit(analysis_time, analysis_data, 1)\n            if slope > s_th:\n                is_stretched = True\n        \n        results.append(is_stretched)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3528785"}]}