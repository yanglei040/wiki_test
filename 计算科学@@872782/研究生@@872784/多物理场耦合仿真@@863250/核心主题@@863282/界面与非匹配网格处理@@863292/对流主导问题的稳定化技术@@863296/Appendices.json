{"hands_on_practices": [{"introduction": "这个练习旨在解决对流主导问题中中心差分格式的根本不稳定性。我们将通过推导恢复数值解稳定性所需的最小“人工粘性”量，并以离散极值原理这一严谨的数学准则对其进行量化。这项实践旨在建立为何需要稳定以及如何量化稳定性的直观理解。[@problem_id:3526604]", "problem": "考虑一个多物理场耦合模拟中输运量的标量、稳态、一维对流扩散模型，该模型在均匀网格上由偏微分方程 $a \\, \\frac{d u}{d x} - \\kappa \\, \\frac{d^{2} u}{d x^{2}} = s(x)$ 控制，其中对流速度 $a \\in \\mathbb{R}$ 为常数，分子扩散系数 $\\kappa \\ge 0$，源项 $s(x)$ 平滑。设区域以均匀网格间距 $h>0$ 进行离散。对内部节点上的一阶和二阶导数均使用中心有限差分近似，并通过人工扩散 $\\nu \\ge 0$ 增强分子扩散，作用于节点值 $\\{u_{i}\\}$ 的离散算子通过将 $\\frac{d u}{d x}$ 替换为 $(u_{i+1}-u_{i-1})/(2h)$、将 $\\frac{d^{2} u}{d x^{2}}$ 替换为 $(u_{i+1}-2u_{i}+u_{i-1})/h^{2}$ 而得到，但在离散扩散项中使用总扩散系数 $\\kappa+\\nu$。\n\n从一个通用内部节点出发，通过泰勒级数截断误差展开形成该离散格式的修正方程，并引用线性标量问题的标准离散极值原理（即，系数矩阵是一个$M$矩阵，其内部节点的非对角元素为非正值，行和为非负值），推导：\n\n$1.$ 为使中心格式对所有内部节点满足离散极值原理所需的最小人工扩散 $\\nu_{\\min}$，用 $a$、$\\kappa$ 和 $h$ 表示。\n\n$2.$ 在修正方程中，由该稳定化方法引入的领阶误差项，表示为乘以 $\\frac{d^{2} u}{d x^{2}}$ 的单个系数 $C_{\\text{lead}}$。\n\n以包含 $\\nu_{\\min}$ 和 $C_{\\text{lead}}$ 封闭形式的行矩阵形式提供您的最终答案。无需进行数值评估。如果在推导中引入任何中间符号，请在最终表达式中将其消去。最终答案中不应包含物理单位。不要进行任何四舍五入；要求提供精确表达式。", "solution": "用户希望我分析一维稳态对流扩散方程的有限差分格式。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   **控制方程**：$a \\, \\frac{d u}{d x} - \\kappa \\, \\frac{d^{2} u}{d x^{2}} = s(x)$\n-   **参数**：恒定对流速度 $a \\in \\mathbb{R}$，分子扩散系数 $\\kappa \\ge 0$，均匀网格间距 $h  0$。\n-   **离散格式**：\n    -   项 $\\frac{d u}{d x}$ 由中心差分 $\\frac{u_{i+1}-u_{i-1}}{2h}$ 近似。\n    -   项 $\\frac{d^{2} u}{d x^{2}}$ 由中心差分 $\\frac{u_{i+1}-2u_{i}+u_{i-1}}{h^{2}}$ 近似。\n    -   分子扩散系数 $\\kappa$ 由人工扩散系数 $\\nu \\ge 0$ 增强，在离散扩散项中得到总扩散系数 $\\kappa+\\nu$。\n-   **条件**：离散格式必须满足离散极值原理（DMP）。这被陈述为等价于系数矩阵是$M$矩阵，要求内部节点的非对角元素为非正，行和为非负。\n-   **任务**：\n    1.  推导满足DMP所需的最小人工扩散 $\\nu_{\\min}$。\n    2.  推导稳定化格式的修正方程中与 $\\frac{d^{2} u}{d x^{2}}$ 成比例的领阶误差项系数 $C_{\\text{lead}}$。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题是偏微分方程数值分析中的一个经典练习，特别是在计算流体力学领域。对流扩散方程、有限差分法、人工扩散、离散极值原理、M矩阵和修正方程分析都是标准、成熟的概念。该问题在数学和计算科学方面有坚实的基础。\n-   **适定性**：该问题是适定的。它提供了一套明确的规则和具体的数学结构，要求推导两个特定的量 $\\nu_{\\min}$ 和 $C_{\\text{lead}}$。求解路径唯一且无歧义。\n-   **客观性**：该问题以精确、客观的数学语言陈述。没有主观或基于意见的成分。\n\n**步骤3：结论与行动**\n该问题是有效的。它在科学上是合理的，适定的，并且是客观的。我将继续进行解答。\n\n### 推导\n\n按要求，分析分为两部分：首先推导最小人工扩散 $\\nu_{\\min}$，其次推导领阶误差系数 $C_{\\text{lead}}$。\n\n#### 第1部分：最小人工扩散 ($\\nu_{\\min}$) 的推导\n\n首先，我们构建内部网格节点 $x_i$ 处的离散方程。给定的偏微分方程是：\n$$a \\frac{d u}{d x} - \\kappa \\frac{d^{2} u}{d x^{2}} = s(x)$$\n应用指定的有限差分近似，并使用总扩散系数 $\\kappa + \\nu$，我们得到节点值 $u_i = u(x_i)$ 的离散方程：\n$$a \\left( \\frac{u_{i+1} - u_{i-1}}{2h} \\right) - (\\kappa + \\nu) \\left( \\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} \\right) = s_i$$\n其中 $s_i = s(x_i)$。为了分析系数矩阵的性质，我们将此方程重排，按 $u_{i-1}$、$u_i$ 和 $u_{i+1}$ 对各项进行分组：\n$$\\left( -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) u_{i-1} + \\left( \\frac{2(\\kappa+\\nu)}{h^2} \\right) u_i + \\left( \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) u_{i+1} = s_i$$\n这是一个形式为 $A_{i,i-1}u_{i-1} + A_{i,i}u_i + A_{i,i+1}u_{i+1} = s_i$ 的方程，其中对应于节点 $i$ 的矩阵行的系数为：\n-   $u_{i-1}$ 的非对角系数：$A_{i,i-1} = -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2}$\n-   $u_{i}$ 的对角系数：$A_{i,i} = \\frac{2(\\kappa+\\nu)}{h^2}$\n-   $u_{i+1}$ 的非对角系数：$A_{i,i+1} = \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2}$\n\n问题指出，如果系数矩阵是$M$矩阵，则满足离散极值原理（DMP）。对于这个三对角系统，这为任意内部行 $i$ 的系数施加了以下条件：\n1.  非正非对角元素：$A_{i,i-1} \\le 0$ 和 $A_{i,i+1} \\le 0$。\n2.  非负行和：$A_{i,i-1} + A_{i,i} + A_{i,i+1} \\ge 0$。\n\n我们先检查行和条件：\n$$A_{i,i-1} + A_{i,i} + A_{i,i+1} = \\left( -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) + \\left( \\frac{2(\\kappa+\\nu)}{h^2} \\right) + \\left( \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) = 0$$\n由于行和为 $0$，非负条件得到满足。\n\n现在，我们强制执行非正非对角条件：\n-   对于 $A_{i,i-1} \\le 0$：\n$$-\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\le 0 \\implies -\\frac{a}{2h} \\le \\frac{\\kappa+\\nu}{h^2} \\implies \\kappa+\\nu \\ge -\\frac{ah}{2}$$\n-   对于 $A_{i,i+1} \\le 0$：\n$$\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\le 0 \\implies \\frac{a}{2h} \\le \\frac{\\kappa+\\nu}{h^2} \\implies \\kappa+\\nu \\ge \\frac{ah}{2}$$\n为了对任意 $a \\in \\mathbb{R}$ 同时满足这两个不等式，总扩散系数必须大于或等于两个右侧值的最大值：\n$$\\kappa+\\nu \\ge \\max\\left(\\frac{ah}{2}, -\\frac{ah}{2}\\right)$$\n使用绝对值可以简化为：\n$$\\kappa+\\nu \\ge \\frac{|a|h}{2}$$\n从此不等式，我们可以确定所需的人工扩散 $\\nu$：\n$$\\nu \\ge \\frac{|a|h}{2} - \\kappa$$\n问题要求的是*最小*人工扩散 $\\nu_{\\min}$，并且已知 $\\nu \\ge 0$。因此，$\\nu$ 的最小值必须是 $0$ 和 DMP 条件所要求的值中较大的一个。\n$$\\nu_{\\min} = \\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\n这确保了在对扩散进行最小可能的非负增加的情况下满足DMP。\n\n#### 第2部分：领阶误差项系数 ($C_{\\text{lead}}$) 的推导\n\n为找到领阶误差项的系数，我们通过在点 $x_i$ 附近对离散算子进行泰勒级数展开来推导修正方程。令 $u$ 及其导数 $u'$、$u''$ 等表示在 $x_i$ 处的函数值。\n$u_{i\\pm1} = u(x_i \\pm h)$ 的泰勒展开式为：\n$$u_{i+1} = u + hu' + \\frac{h^2}{2}u'' + \\frac{h^3}{6}u''' + O(h^4)$$\n$$u_{i-1} = u - hu' + \\frac{h^2}{2}u'' - \\frac{h^3}{6}u''' + O(h^4)$$\n我们展开离散导数近似：\n-   对流项：\n$$\\frac{u_{i+1} - u_{i-1}}{2h} = \\frac{(u+hu'+\\frac{h^2}{2}u''+\\frac{h^3}{6}u'''+\\dots) - (u-hu'+\\frac{h^2}{2}u''-\\frac{h^3}{6}u'''+\\dots)}{2h} = \\frac{2hu' + \\frac{h^3}{3}u''' + \\dots}{2h} = u' + \\frac{h^2}{6}u''' + O(h^4)$$\n-   扩散项：\n$$\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} = \\frac{(u+hu'+\\frac{h^2}{2}u''+\\dots) - 2u + (u-hu'+\\frac{h^2}{2}u''+\\dots)}{h^2} = \\frac{h^2u'' + \\frac{h^4}{12}u'''' + \\dots}{h^2} = u'' + \\frac{h^2}{12}u'''' + O(h^4)$$\n作用在精确解 $u$ 上的离散算子 $L_h$ 是：\n$$L_h u = a\\left(u' + \\frac{h^2}{6}u''' + O(h^4)\\right) - (\\kappa+\\nu)\\left(u'' + \\frac{h^2}{12}u'''' + O(h^4)\\right)$$\n$$L_h u = a u' - (\\kappa+\\nu)u'' + \\frac{ah^2}{6}u''' - \\frac{(\\kappa+\\nu)h^2}{12}u'''' + \\dots$$\n原始连续算子是 $L u = a u' - \\kappa u''$。截断误差 $\\tau$ 是差值 $\\tau = L_h u - L u$：\n$$\\tau = (a u' - (\\kappa+\\nu)u'' + \\dots) - (a u' - \\kappa u'')$$\n$$\\tau = -\\nu u'' + \\frac{ah^2}{6}u''' - \\frac{(\\kappa+\\nu)h^2}{12}u'''' + \\dots$$\n问题要求的是与 $\\frac{d^{2} u}{d x^{2}}$（即 $u''$）成比例的领阶误差项的系数 $C_{\\text{lead}}$。领阶误差是 $\\tau$ 展开式中 $h$ 的最低次幂项。我们必须代入 $\\nu = \\nu_{\\min}$ 来分析稳定化后的格式。\n$$\\nu_{\\min} = \\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\n有两种情况：\n1.  **扩散主导情况**：$\\frac{|a|h}{2} \\le \\kappa$。此时 $\\nu_{\\min} = 0$。截断误差变为：\n    $$\\tau = \\frac{ah^2}{6}u''' - \\frac{\\kappa h^2}{12}u'''' + O(h^4)$$\n    领阶误差为 $O(h^2)$，且不包含 $u''$ 项。因此，领阶误差中 $u''$ 的系数为 $C_{\\text{lead}} = 0$。\n2.  **对流主导情况**：$\\frac{|a|h}{2}  \\kappa$。此时 $\\nu_{\\min} = \\frac{|a|h}{2} - \\kappa$。这个值的量级是 $O(h)$。截断误差为：\n    $$\\tau = -\\left(\\frac{|a|h}{2} - \\kappa\\right)u'' + \\frac{ah^2}{6}u''' - \\dots$$\n    项 $-\\nu_{\\min}u''$ 的量级为 $O(h)$，而下一项的量级为 $O(h^2)$。因此，$-\\nu_{\\min}u''$ 是领阶误差项。该项与 $u''$ 成比例，其系数为 $C_{\\text{lead}} = -\\nu_{\\min}$。\n\n结合两种情况，与 $u''$ 成比例的领阶误差项的系数由 $C_{\\text{lead}} = -\\nu_{\\min}$ 给出。\n$$C_{\\text{lead}} = -\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\n在扩散主导的情况下，该表达式正确地计算为 $0$；在对流主导的情况下，计算为 $-(\\frac{|a|h}{2} - \\kappa)$。\n\n最终答案是 $\\nu_{\\min}$ 和 $C_{\\text{lead}}$ 的表达式。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)  -\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)\n\\end{pmatrix}\n}\n$$", "id": "3526604"}, {"introduction": "在理解了人工粘性的基本需求后，我们可以探索更精妙的稳定化方法。此练习将我们从有限差分法带入有限元法的框架，介绍流线迎风/Petrov-Galerkin (SUPG) 方法。我们的目标是推导单元刚度矩阵，并观察SUPG如何巧妙地仅沿流线方向增加耗散，从而提供比简单各向同性人工粘性更具针对性的稳定化。[@problemid:3526619]", "problem": "考虑一个标量场 $c(x)$ 在尺寸为 $h$ 的线性（$P_1$）有限元均匀网格上的稳态一维对流-扩散方程，其系数为常数：\n$$-k\\,\\frac{d^2 c}{dx^2} + u\\,\\frac{d c}{dx} = f,$$\n其中 $k > 0$ 是扩散率，$u \\in \\mathbb{R}$ 是恒定对流速度，$f$ 是源项。设 $N_1(x)$ 和 $N_2(x)$ 为单个单元 $e = [x_1, x_2]$（其中 $x_2 - x_1 = h$）上的常规线性形函数，并假设 $f$ 足够正则以致标准弱形式适用。使用 Galerkin 弱形式，其中扩散项进行分部积分，而对流项保留其守恒的一阶导数形式。流线迎风/彼得罗夫-伽辽金 (SUPG) 稳定化弱形式通过一个流线项来增强测试函数 $w$，在每个单元上可写为\n$$\\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u\\,w'\\,\\big(-k\\,c'' + u\\,c' - f\\big)\\,dx = \\int_{e} w\\,f\\,dx,$$\n其中 $\\tau \\ge 0$ 是稳定化参数，撇号表示关于 $x$ 的导数。对于 $P_1$ 单元，$c$ 的二阶导数在 $e$ 上几乎处处为零，因此 SUPG 项相应地得到简化。令单元 Peclet 数为 $Pe_e = |u|\\,h/(2k)$。\n\n请从第一性原理出发，推导关联单元 $e$ 上 $c$ 的节点值的 $2 \\times 2$ SUPG 稳定化单元刚度矩阵 $K_e(\\tau)$。请清晰地陈述您使用的任何中间积分恒等式，并用 $k$、$u$、$h$ 和 $\\tau$ 以闭合形式表示最终的矩阵。然后，使用您的闭合形式表达式，解析地展示非对角线项如何依赖于 $\\tau$ 来抑制随着 $Pe_e$ 增大而产生的伪振荡，并将 SUPG 的贡献解释为沿流线方向增加的有效扩散。\n\n您的最终答案必须是关于 $k$、$u$、$h$ 和 $\\tau$ 的单元刚度矩阵 $K_e(\\tau)$ 的单一符号表达式。不需要进行数值计算或四舍五入。", "solution": "该问题已经过验证，被认为是具有科学依据、适定、客观且内部一致的。它代表了计算流体动力学和有限元分析领域的一个标准推导过程。\n\n我们从给定的一维稳态对流-扩散方程开始：\n$$ -k\\,\\frac{d^2 c}{dx^2} + u\\,\\frac{d c}{dx} = f $$\n在长度为 $h=x_2-x_1$ 的单个单元 $e = [x_1, x_2]$ 上，流线迎风/彼得罗夫-伽辽金 (SUPG) 弱形式如下：\n$$ \\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u\\,w'\\,\\big(-k\\,c'' + u\\,c' - f\\big)\\,dx = \\int_{e} w\\,f\\,dx $$\n对于线性（$P_1$）有限元，单元上标量场 $c(x)$ 的近似解 $c^h(x)$ 是一个线性多项式。因此，其二阶导数 $c''$ 在单元上几乎处处为零。SUPG 弱形式简化为：\n$$ \\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u^2\\,w' c'\\,dx - \\int_{e} \\tau\\,u\\,w' f\\,dx = \\int_{e} w\\,f\\,dx $$\n为了推导单元刚度矩阵 $K_e(\\tau)$，我们考虑左侧依赖于未知场 $c$ 的项。涉及源函数 $f$ 的项贡献于单元载荷向量，而不是刚度矩阵。整理这些项后，对刚度矩阵有贡献的表达式为：\n$$ \\int_{e} (k + \\tau u^2) w' c' \\,dx + \\int_{e} u\\,w c' \\,dx $$\n在单元 $e$ 上，场 $c(x)$ 被近似为 $c^h(x) = \\sum_{j=1}^{2} c_j N_j(x)$，其中 $c_1$ 和 $c_2$ 分别是 $x_1$ 和 $x_2$ 处的节点值，$N_1(x)$ 和 $N_2(x)$ 是线性拉格朗日基函数（形函数）。为了构建 $2 \\times 2$ 刚度矩阵，我们依次选择每个基函数作为测试函数 $w$，即 $w(x) = N_i(x)$，其中 $i=1, 2$。\n单元刚度矩阵的 $(i,j)$ 元 $K_{ij}$ 是第 $i$ 个方程（其中 $w=N_i$）中节点值 $c_j$ 的系数。因此，\n$$ K_{ij} = \\int_{e} (k + \\tau u^2) N_i'(x) N_j'(x) \\,dx + \\int_{e} u\\,N_i(x) N_j'(x) \\,dx $$\n单元 $e = [x_1, x_2]$ 上的线性形函数定义为：\n$$ N_1(x) = \\frac{x_2 - x}{h}, \\quad N_2(x) = \\frac{x - x_1}{h} $$\n它们关于 $x$ 的导数在整个单元上是常数：\n$$ N_1'(x) = -\\frac{1}{h}, \\quad N_2'(x) = \\frac{1}{h} $$\n现在我们计算刚度矩阵的两个部分：类扩散（对称）部分和对流（反对称）部分。\n\n首先，是类扩散项，它包括标准扩散和 SUPG 贡献。我们将其矩阵表示称为 $K^{\\text{diff\\_supg}}$。\n$$ K^{\\text{diff\\_supg}}_{ij} = \\int_{x_1}^{x_2} (k + \\tau u^2) N_i' N_j' \\,dx $$\n由于被积函数是常数，积分就是被积函数乘以单元长度 $h$。\n$$ K^{\\text{diff\\_supg}}_{11} = (k + \\tau u^2) \\left(-\\frac{1}{h}\\right)\\left(-\\frac{1}{h}\\right) h = \\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{12} = (k + \\tau u^2) \\left(-\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) h = -\\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{21} = (k + \\tau u^2) \\left(\\frac{1}{h}\\right)\\left(-\\frac{1}{h}\\right) h = -\\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{22} = (k + \\tau u^2) \\left(\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) h = \\frac{k + \\tau u^2}{h} $$\n这给出了矩阵：\n$$ K^{\\text{diff\\_supg}} = \\frac{k + \\tau u^2}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} $$\n其次，是对流项。设其矩阵为 $K^{\\text{adv}}$。\n$$ K^{\\text{adv}}_{ij} = \\int_{x_1}^{x_2} u\\,N_i(x) N_j'(x) \\,dx $$\n我们计算必要的积分：\n$$ \\int_{x_1}^{x_2} N_1(x) \\,dx = \\int_{x_1}^{x_2} \\frac{x_2-x}{h} \\,dx = \\frac{h}{2} $$\n$$ \\int_{x_1}^{x_2} N_2(x) \\,dx = \\int_{x_1}^{x_2} \\frac{x-x_1}{h} \\,dx = \\frac{h}{2} $$\n现在我们可以计算 $K^{\\text{adv}}$ 的各项：\n$$ K^{\\text{adv}}_{11} = u \\int_{x_1}^{x_2} N_1(x) N_1'(x) \\,dx = u \\left(-\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_1(x) \\,dx = -\\frac{u}{h} \\frac{h}{2} = -\\frac{u}{2} $$\n$$ K^{\\text{adv}}_{12} = u \\int_{x_1}^{x_2} N_1(x) N_2'(x) \\,dx = u \\left(\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_1(x) \\,dx = \\frac{u}{h} \\frac{h}{2} = \\frac{u}{2} $$\n$$ K^{\\text{adv}}_{21} = u \\int_{x_1}^{x_2} N_2(x) N_1'(x) \\,dx = u \\left(-\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_2(x) \\,dx = -\\frac{u}{h} \\frac{h}{2} = -\\frac{u}{2} $$\n$$ K^{\\text{adv}}_{22} = u \\int_{x_1}^{x_2} N_2(x) N_2'(x) \\,dx = u \\left(\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_2(x) \\,dx = \\frac{u}{h} \\frac{h}{2} = \\frac{u}{2} $$\n这给出了矩阵：\n$$ K^{\\text{adv}} = \\frac{u}{2} \\begin{pmatrix} -1  1 \\\\ -1  1 \\end{pmatrix} $$\n总的 SUPG 稳定化单元刚度矩阵 $K_e(\\tau)$ 是这两个矩阵的和：\n$$ K_e(\\tau) = K^{\\text{diff\\_supg}} + K^{\\text{adv}} = \\frac{k + \\tau u^2}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + \\frac{u}{2} \\begin{pmatrix} -1  1 \\\\ -1  1 \\end{pmatrix} $$\n合并各项，得到矩阵的最终闭合形式表达式：\n$$ K_e(\\tau) = \\begin{pmatrix} \\frac{k+\\tau u^2}{h} - \\frac{u}{2}  -\\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\\\ -\\frac{k+\\tau u^2}{h} - \\frac{u}{2}  \\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\end{pmatrix} $$\n接下来，我们分析非对角线项如何依赖于 $\\tau$ 来抑制振荡。在标准 Galerkin 方法（$\\tau=0$）中，当对流强于扩散时，即单元 Peclet 数 $Pe_e = |u|h/(2k)$ 很大时，会出现伪振荡。这对应于全局刚度矩阵中对角占优性的丧失。避免这些振荡的一个充分条件是组装后的矩阵是一个 M-矩阵，这要求（除其他条件外）非对角线项为非正值。\n考虑 $u  0$ 的情况。产生振荡的可能性来自于项 $K_{12} = -k/h + u/2$。如果 $u/2  k/h$，或 $uh/(2k)  1$（即 $Pe_e  1$），这一项就变为正值，违反了 M-矩阵的属性。SUPG 稳定化后的项是 $K_{12}(\\tau) = -k/h + u/2 - \\tau u^2/h$。增加的项 $-\\tau u^2/h$ 总是非正的（因为 $\\tau \\ge 0$）。通过恰当地选择 $\\tau$，这一项可以抵消来自对流的正贡献，确保 $K_{12}(\\tau) \\le 0$，从而抑制振荡。类似的论证也适用于 $u  0$ 和项 $K_{21}(\\tau)$。因此，$\\tau$ 项增加了目标稳定性。\n\n最后，我们解释 SUPG 的贡献。刚度矩阵是标准 Galerkin 对流-扩散矩阵（$\\tau=0$ 时）和一个源于 SUPG 项的矩阵之和：\n$$ K^{\\text{SUPG}} = \\frac{\\tau u^2}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} $$\n这个矩阵的形式与标准扩散矩阵 $\\frac{k}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$ 完全相同。因此，SUPG 方法可以解释为在物理扩散 $k$ 的基础上增加了一个大小为 $k_{\\text{art}} = \\tau u^2$ 的“人工”或“平衡”扩散，从而得到有效扩散 $k_{\\text{eff}} = k + k_{\\text{art}} = k + \\tau u^2$。在多维问题中，这种附加的扩散是沿着流动方向（流线）特定地作用的，而数值不稳定性正是在这个方向上产生的。在这个一维案例中，流线与 x 轴对齐，因此该方法只是简单地向模型中增加了扩散。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{k+\\tau u^2}{h} - \\frac{u}{2}  -\\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\\\ -\\frac{k+\\tau u^2}{h} - \\frac{u}{2}  \\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\end{pmatrix} } $$", "id": "3526619"}, {"introduction": "这项实践将我们带入现代非线性稳定方法的领域，这对于处理激波等不连续性至关重要。我们将实现熵粘性方法，这是一种能够自动检测需要额外耗散的区域并仅在局部施加粘性的“智能”技术。这个计算练习将理论从纸上带到代码中，通过实现并验证一个数值算法来巩固关键的多物理场仿真技能。[@problem_id:3526624]", "problem": "考虑一个具有无量纲变量、在周期性域上的一维粘性Burgers方程的守恒形式，\n$$\nc_t + \\left(\\frac{c^2}{2}\\right)_x - \\epsilon\\,c_{xx} = 0,\n$$\n其中 $c(x,t)$ 是一个标量场，$\\epsilon > 0$ 是一个小的物理粘性，下标表示偏微分。在多物理场耦合模拟中针对对流主导问题的稳定化技术背景下，熵粘性方法引入了一个额外的、数据驱动的粘性场，以正则化激波，同时在光滑区域保持精度。\n\n仅从与标量守恒律和凸熵函数相关的基本定律和核心定义出发，推导一个算法以：\n- 为粘性Burgers方程构造一个熵对 $(\\eta(c), q(c))$，\n- 获得一个逐点的熵残差 $R_\\eta(x,t)$，该残差量化了对光滑熵平衡的偏离，\n- 使用物理上合理的缩放，从 $R_\\eta(x,t)$ 定义一个稳定化粘性场 $\\nu_E(x,t)$，\n- 使用一个遵循周期性边界条件的守恒显式有限差分格式，以总粘性 $\\nu_{\\text{tot}}(x,t) = \\epsilon + \\nu_E(x,t)$ 演化该偏微分方程，\n- 并数值验证总熵 $E(t) = \\int_0^1 \\eta(c(x,t))\\,dx$ 随时间非增。\n\n计算域为 $x \\in [0,1]$，采用周期性边界条件。使用类似激波的分段常数初始条件\n$$\nc(x,0) = \\begin{cases}\nc_L  \\text{if } x  x_s, \\\\\nc_R  \\text{if } x \\ge x_s,\n\\end{cases}\n$$\n其中 $c_L = 1$, $c_R = 0$ 且 $x_s = 0.5$。所有量均为无量纲。\n\n对于光滑解，离散化必须在空间上具有二阶精度，对对流项 $\\left(\\frac{c^2}{2}\\right)_x$ 必须是守恒的，并且必须将稳定化粘性 $\\nu_E(x,t)$ 与物理粘性 $\\epsilon$ 相加地并入。自适应地选择时间步长 $\\Delta t$ 以满足针对组合对流和扩散的标准显式稳定性约束，该约束用网格间距 $h$、最大特征速度和最大粘性来表示。\n\n你的程序必须实现完整的算法，并为每个测试用例生成一个布尔值，指示在小的数值容差范围内，数值计算的熵 $E(t)$ 在所有时间 $t \\in [0,T]$ 内是否为非增。将所有测试用例的结果汇总到一行输出中，该输出包含一个逗号分隔的Python风格列表。\n\n使用以下测试套件来评估在不同工况下的正确性和鲁棒性：\n- 测试用例1（理想路径）：$N_x = 200$ 个空间点，最终时间 $T = 0.10$，物理粘性 $\\epsilon = 10^{-3}$，熵粘性系数 $C_e = 0.5$，最大粘性上限系数 $C_{\\max} = 0.5$，对流-扩散稳定性因子 $\\text{CFL} = 0.20$。\n- 测试用例2（对流主导，物理粘性非常小）：$N_x = 200$, $T = 0.10$, $\\epsilon = 10^{-6}$, $C_e = 1.5$, $C_{\\max} = 0.7$, $\\text{CFL} = 0.20$。\n- 测试用例3（粗网格边缘情况）：$N_x = 50$, $T = 0.05$, $\\epsilon = 10^{-6}$, $C_e = 1.0$, $C_{\\max} = 1.0$, $\\text{CFL} = 0.20$。\n\n在每种情况下，通过检查离散积分\n$$\nE^n \\approx h \\sum_{i=0}^{N_x-1} \\eta\\!\\left(c_i^n\\right)\n$$\n是否不随时间步索引 $n$ 增加（在小的数值容差范围内），来验证 $E(t)$ 的单调性。使用周期性边界条件，并确保算法在每个时间步都从演化中的解计算稳定化粘性场 $\\nu_E(x,t)$。\n\n你的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如“[$r_1, r_2, r_3$]”，其中每个 $r_k$ 是测试用例 $k$ 的布尔值，指示该情况下 $E(t)$ 是否随时间非增。", "solution": "该问题要求实现并验证一种用于一维粘性Burgers方程的熵粘性稳定化方法。解决方案涉及基于标量守恒律的基本原理推导并数值实现一个算法。\n\n**1. 熵对的构造**\n\n粘性Burgers方程是一个形式为 $\\partial_t c + \\partial_x f(c) = \\partial_x (\\epsilon \\partial_x c)$ 的标量守恒律，其对流通量为 $f(c) = c^2/2$。熵函数 $\\eta(c)$ 必须是守恒量 $c$ 的一个凸函数。相关的熵通量 $q(c)$ 由相容性关系 $q'(c) = \\eta'(c) f'(c)$ 定义。\n\n熵函数的一个标准选择是动能的类似形式，即 $\\eta(c) = c^2/2$。该函数是凸的，因为其二阶导数 $\\eta''(c) = 1$ 为正。\n熵函数的导数是 $\\eta'(c) = c$。\n对流通量的导数是 $f'(c) = c$。\n\n将这些代入相容性关系可得：\n$$\nq'(c) = (c)(c) = c^2\n$$\n对此表达式关于 $c$ 积分，得到熵通量：\n$$\nq(c) = \\int c^2 dc = \\frac{c^3}{3}\n$$\n我们选择积分常数为零。因此，本问题使用的熵对是 $(\\eta(c), q(c)) = (c^2/2, c^3/3)$。\n\n**2. 数值算法设计**\n\n任务的核心是使用自定义的数值格式，在均匀网格 $x_i = i h$（其中 $i = 0, \\ldots, N_x-1$，$h = 1/N_x$）上对偏微分方程进行演化。该格式必须在时间上是显式的，并能处理周期性边界条件。总粘性是数据驱动的，即 $\\nu_{\\text{tot}}(x,t) = \\epsilon + \\nu_E(x,t)$，其中 $\\nu_E$ 是在每个时间步计算的熵粘性。\n\n**2.1. 空间离散化**\n\n在网格点 $x_i$ 处的半离散方程为：\n$$\n\\frac{dc_i}{dt} = - \\left. \\frac{\\partial f(c)}{\\partial x} \\right|_i + \\left. \\frac{\\partial}{\\partial x}\\left(\\nu_{\\text{tot}} \\frac{\\partial c}{\\partial x}\\right) \\right|_i\n$$\n-   **对流项**：按照要求，我们对对流通量导数使用守恒的二阶中心差分格式：\n    $$\n    \\left. \\frac{\\partial f(c)}{\\partial x} \\right|_i \\approx \\frac{f(c_{i+1}) - f(c_{i-1})}{2h}\n    $$\n-   **扩散项**：对于变系数扩散项，采用标准的二阶守恒离散化。在交错网格点 $x_{i+1/2}$ 处的扩散通量近似为 $J_{i+1/2} \\approx \\frac{\\nu_{\\text{tot},i} + \\nu_{\\text{tot},i+1}}{2} \\frac{c_{i+1}-c_i}{h}$。则该通量在网格点 $x_i$ 处的散度为：\n    $$\n    \\left. \\frac{\\partial J}{\\partial x} \\right|_i \\approx \\frac{J_{i+1/2} - J_{i-1/2}}{h}\n    $$\n\n**2.2. 熵粘性计算**\n\n在每个时间步 $n$，给定解 $c^n$，计算熵粘性场 $\\nu_E^n$。\n\n-   **熵残差 ($R_\\eta$)**：该残差度量了数值格式的非耗散部分对熵守恒方程 $\\eta_t + q_x = 0$ 的局部违背程度。我们近似 $\\eta_t \\approx \\eta'(c) c_t$，并使用半离散无粘性常微分方程 $c_t \\approx -f(c)_x$ 来基于当前状态 $c^n$ 定义残差：\n    $$\n    R_{\\eta,i} = \\left| \\eta'(c_i) \\left( -\\frac{f_{i+1} - f_{i-1}}{2h} \\right) + \\left( \\frac{q_{i+1} - q_{i-1}}{2h} \\right) \\right|\n    $$\n    其中 $f_i = f(c_i)$ 且 $q_i = q(c_i)$。\n\n-   **稳定化粘性 ($\\nu_E$)**：残差经过缩放以定义粘性。该缩放涉及网格间距的平方，并通过局部熵变化进行归一化，以确保正确的物理单位和局部化特性。\n    $$\n    \\nu_{E,i} = C_e h^2 \\frac{ |R_{\\eta,i}| }{ |\\eta_{i+1} - \\eta_i| + |\\eta_{i-1} - \\eta_i| + \\delta }\n    $$\n    其中 $C_e$ 是一个指定的系数，$\\delta$ 是一个小数（例如 $10^{-12}$）以防止除以零。\n\n-   **粘性上限**：对 $\\nu_E$ 施加一个上限，以防止其变得过大，从而导致时间步长过小。该上限基于一个局部的类CFL条件：\n    $$\n    \\nu_{\\max, i} = C_{\\max} h |f'(c_i)| = C_{\\max} h |c_i|\n    $$\n    最终的熵粘性为 $\\nu_{E,i} \\leftarrow \\min(\\nu_{E,i}, \\nu_{\\max, i})$。\n\n**2.3. 时间演化与稳定性**\n\n-   **时间步进**：使用显式前向欧拉格式来推进解：\n    $$\n    c_i^{n+1} = c_i^n + \\Delta t \\cdot \\text{RHS}_i(c^n, \\nu_{\\text{tot}}^n)\n    $$\n-   **自适应时间步长 ($\\Delta t$)**：为确保显式格式的稳定性，时间步长 $\\Delta t$ 在每一步都根据最大特征速度和最大总粘性进行计算：\n    $$\n    \\Delta t = \\text{CFL} \\cdot \\frac{h^2}{h \\max_j|c_j| + 2 \\max_j|\\nu_{\\text{tot},j}|}\n    $$\n    其中 `CFL` 是给定的对流-扩散稳定性因子。\n\n**3. 熵耗散的验证**\n\n主要目标是验证总离散熵 $E^n = h \\sum_{i=0}^{N_x-1} \\eta(c_i^n)$ 随时间非增。这通过在每个时间步将新计算的熵 $E^{n+1}$ 与前一个值 $E^n$ 进行比较来检查。由于浮点运算，该检查放宽为 $E^{n+1} \\le E^n + \\tau$，其中 $\\tau$ 是一个小的数值容差。如果在模拟过程中的任何时刻违反了此条件，则认为该测试用例的熵不是非增的。\n\n这个完整的算法在最终程序中被实现，以解决指定测试用例的问题。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D viscous Burgers' equation using the entropy viscosity method\n    and verifies the non-increasing nature of the total discrete entropy.\n    \"\"\"\n\n    test_cases = [\n        # (Nx, T, epsilon, Ce, Cmax, CFL)\n        (200, 0.10, 1e-3, 0.5, 0.5, 0.20),  # Test case 1\n        (200, 0.10, 1e-6, 1.5, 0.7, 0.20),  # Test case 2\n        (50, 0.05, 1e-6, 1.0, 1.0, 0.20),   # Test case 3\n    ]\n\n    results = []\n    for params in test_cases:\n        is_monotonic = run_simulation(*params)\n        results.append(is_monotonic)\n\n    # Format the final output as a Python-style list string\n    print(f\"[{','.join(map(str, [r for r in results]))}]\")\n\ndef run_simulation(Nx, T, epsilon, Ce, Cmax, CFL):\n    \"\"\"\n    Runs a single simulation case for the Burgers' equation.\n\n    Args:\n        Nx (int): Number of spatial points.\n        T (float): Final simulation time.\n        epsilon (float): Physical viscosity.\n        Ce (float): Entropy viscosity coefficient.\n        Cmax (float): Viscosity cap coefficient.\n        CFL (float): Advective-diffusive stability factor.\n\n    Returns:\n        bool: True if the total entropy is non-increasing, False otherwise.\n    \"\"\"\n    # Domain and Grid setup\n    x = np.linspace(0.0, 1.0, Nx, endpoint=False)\n    h = 1.0 / Nx\n\n    # Initial Condition\n    cL, cR, xs = 1.0, 0.0, 0.5\n    c = np.where(x  xs, cL, cR)\n\n    # Entropy-related functions\n    # f(c) = c^2 / 2\n    # eta(c) = c^2 / 2 (entropy)\n    # q(c) = c^3 / 3 (entropy flux)\n    # eta'(c) = c\n    f = lambda u: 0.5 * u**2\n    eta = lambda u: 0.5 * u**2\n    q = lambda u: (1.0/3.0) * u**3\n    eta_prime = lambda u: u\n\n    t = 0.0\n    is_non_increasing = True\n    \n    # Initial total entropy computation\n    # The integral is approximated by a sum using the rectangle rule\n    E_prev = h * np.sum(eta(c))\n    \n    # Numerical tolerance for entropy increase check\n    tolerance = 1e-12\n\n    # Main time loop\n    while t  T:\n        # --- 1. Compute Entropy Viscosity ---\n        \n        # Central difference for advective term (for residual calculation)\n        f_c = f(c)\n        adv_term_res = -(np.roll(f_c, -1) - np.roll(f_c, 1)) / (2.0 * h)\n        \n        # Entropy residual R_eta = | eta'(c)*(-f_x) + q_x |\n        q_c = q(c)\n        R_eta = np.abs(eta_prime(c) * adv_term_res + (np.roll(q_c, -1) - np.roll(q_c, 1)) / (2.0 * h))\n        \n        # Denominator for viscosity scaling\n        eta_c = eta(c)\n        denom = np.abs(np.roll(eta_c, -1) - eta_c) + np.abs(np.roll(eta_c, 1) - eta_c) + 1e-12\n        \n        # Entropy viscosity nu_E\n        nu_E = Ce * h**2 * R_eta / denom\n        \n        # Viscosity cap\n        nu_max = Cmax * h * np.abs(c)\n        nu_E = np.minimum(nu_E, nu_max)\n        \n        # Total viscosity\n        nu_tot = epsilon + nu_E\n\n        # --- 2. Calculate Adaptive Time Step ---\n        c_max_speed = np.max(np.abs(c))\n        nu_max_total = np.max(nu_tot)\n\n        dt = CFL * h**2 / (h * c_max_speed + 2.0 * nu_max_total + 1e-12)\n        \n        # Ensure the final time T is not overshot\n        if t + dt > T:\n            dt = T - t\n\n        # --- 3. Evolve the Solution ---\n        \n        # Advection term: central difference\n        adv_term = -(np.roll(f(c), -1) - np.roll(f(c), 1)) / (2.0 * h)\n\n        # Diffusion term: second-order conservative central difference for variable coefficient\n        # Flux at staggered points i+1/2\n        flux_stag_p_half = 0.5 * (np.roll(nu_tot, -1) + nu_tot) * (np.roll(c, -1) - c) / h\n        # Divergence of the flux\n        diff_term = (flux_stag_p_half - np.roll(flux_stag_p_half, 1)) / h\n        \n        # Right-hand side of the semi-discrete equation\n        rhs = adv_term + diff_term\n        \n        # Update solution using Forward Euler\n        c_new = c + dt * rhs\n        c = c_new\n\n        # --- 4. Verify Entropy ---\n        E_curr = h * np.sum(eta(c))\n        \n        if E_curr > E_prev + tolerance:\n            is_non_increasing = False\n            # Break early as the condition is violated\n            break\n            \n        E_prev = E_curr\n        t += dt\n\n    return is_non_increasing\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3526624"}]}