{"hands_on_practices": [{"introduction": "在高能物理的连续搜索中，一种严谨处理“别处观看效应”的方法是将检验统计量建模为高斯随机场 (Gaussian Random Field, GRF)。本练习 [@problem_id:3539405] 提供了一个基于强大的欧拉示性数 (Euler Characteristic) 启发式方法，来手动推导全局 p 值的近似。这种基于计算统计量“上穿”高阈值次数的方法，构成了许多“别处观看效应”校正方法的理论基石。", "problem": "考虑在宽度为 $L=100\\,\\mathrm{GeV}$ 的搜索区间内，对质量谱中的窄共振进行一维信号峰搜寻，其中探测器限制的相关长度为 $\\ell=2\\,\\mathrm{GeV}$。在零假设下，作为质量 $m$ 的函数的局域发现检验统计量 $Z(m)$ 可被建模为该区间上的一个平滑、平稳、单位方差的高斯随机场 (GRF)。“别处观看效应”指的是，由于在质量范围内进行扫描，与固定 $m$ 处的局域尾部概率相比，全局假阳性概率 $\\mathbb{P}\\!\\left(\\sup_{m \\in [0,L]} Z(m) \\ge u\\right)$ 发生膨胀的现象。\n\n从偏移集 $A_u=\\{m\\in[0,L]: Z(m)\\ge u\\}$ 的定义和高斯随机场在高阈值下的期望欧拉示性数 (EC) 启发式方法出发，推导一维情况下全局超越概率 $p_{\\mathrm{glob}}(u)\\equiv \\mathbb{P}(\\sup Z \\ge u)$ 的前导阶近似。用搜索区间的解析元数量 $R$（其中 $R$ 定义为比率 $R=L/\\ell$）和偏移集的高阈值渐近密度来表示该近似。\n\n使用此前导阶近似计算当 $u=20$ 时的 $p_{\\mathrm{glob}}(u)$，使用给定的 $L$ 和 $\\ell$，并假设一维前导项在如此高的阈值下占主导地位。你可以直接从 $L$ 和 $\\ell$ 估算 $R$。请以标准科学记数法的无量纲小数形式提供你最终的 $p_{\\mathrm{glob}}(20)$ 数值答案，并四舍五入到四位有效数字。", "solution": "用户希望我解决以下问题：\n**问题陈述：** 考虑在宽度为 $L=100\\,\\mathrm{GeV}$ 的搜索区间内，对质量谱中的窄共振进行一维信号峰搜寻，其中探测器限制的相关长度为 $\\ell=2\\,\\mathrm{GeV}$。在零假设下，作为质量 $m$ 的函数的局域发现检验统计量 $Z(m)$ 可被建模为该区间上的一个平滑、平稳、单位方差的高斯随机场 (GRF)。“别处观看效应”指的是，由于在质量范围内进行扫描，与固定 $m$ 处的局域尾部概率相比，全局假阳性概率 $\\mathbb{P}\\!\\left(\\sup_{m \\in [0,L]} Z(m) \\ge u\\right)$ 发生膨胀的现象。\n\n从偏移集 $A_u=\\{m\\in[0,L]: Z(m)\\ge u\\}$ 的定义和高斯随机场在高阈值下的期望欧拉示性数 (EC) 启发式方法出发，推导一维情况下全局超越概率 $p_{\\mathrm{glob}}(u)\\equiv \\mathbb{P}(\\sup Z \\ge u)$ 的前导阶近似。用搜索区间的解析元数量 $R$（其中 $R$ 定义为比率 $R=L/\\ell$）和偏移集的高阈值渐近密度来表示该近似。\n\n使用此前导阶近似计算当 $u=20$ 时的 $p_{\\mathrm{glob}}(u)$，使用给定的 $L$ 和 $\\ell$，并假设一维前导项在如此高的阈值下占主导地位。你可以直接从 $L$ 和 $\\ell$ 估算 $R$。请以标准科学记数法的无量纲小数形式提供你最终的 $p_{\\mathrm{glob}}(20)$ 数值答案，并四舍五入到四位有效数字。\n\n### 第 1 步：提取已知条件\n-   搜索区间宽度：$L=100\\,\\mathrm{GeV}$\n-   相关长度：$\\ell=2\\,\\mathrm{GeV}$\n-   检验统计量 $Z(m)$ 是在区间 $[0, L]$ 上的一个平滑、平稳、单位方差的高斯随机场 (GRF)。\n-   偏移集：$A_u=\\{m\\in[0,L]: Z(m)\\ge u\\}$\n-   全局超越概率：$p_{\\mathrm{glob}}(u)=\\mathbb{P}(\\sup_{m \\in [0,L]} Z(m) \\ge u)$\n-   解析元数量：$R=L/\\ell$\n-   计算阈值：$u=20$\n-   任务1：使用欧拉示性数(EC)启发式方法推导 $p_{\\mathrm{glob}}(u)$ 的前导阶近似。\n-   任务2：计算 $p_{\\mathrm{glob}}(20)$ 的数值。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据。将检验统计量分布建模为高斯随机场，并使用期望欧拉示性数（或在一维情况下，使用用于上穿的Kac-Rice公式）来近似考虑了别处观看效应的全局p值，是统计学及其在高能物理中应用的 cementing 标准且成熟的方法。该问题是适定的，提供了推导唯一解所需的所有信息（$L$、$\\ell$、GRF模型、近似方法）。语言客观、精确。问题是完整且内部一致的。\n\n### 第 3 步：结论与行动\n问题是有效的。将提供完整的解决方案。\n\n### 推导与求解\n问题要求使用期望欧拉示性数 (EC) 启发式方法，求全局超越概率 $p_{\\mathrm{glob}}(u) = \\mathbb{P}(\\sup_{m \\in [0,L]} Z(m) \\ge u)$ 的前导阶近似。对于足够高的阈值 $u$，该概率可以很好地用偏移集 $A_u = \\{m \\in [0,L] : Z(m) \\ge u\\}$ 的期望EC来近似。\n$$ p_{\\mathrm{glob}}(u) \\approx \\mathbb{E}[\\chi(A_u)] $$\n对于一维域，偏移集的欧拉示性数 $\\chi(A_u)$ 是其不相交的连通分量的数量。在高阈值下，这些分量通常是微小的、孤立的区间，其数量等于过程 $Z(m)$ 从下向上穿越水平 $u$ 的次数（一次“上穿”）。因此，前导阶近似由期望上穿数 $\\mathbb{E}[N_u]$ 给出。\n$$ p_{\\mathrm{glob}}(u) \\approx \\mathbb{E}[N_u] $$\n这是 $\\mathbb{E}[\\chi(A_u)]$ 展开式中的前导项，它与搜索区域的大小 $L$ 成正比。问题陈述证实了我们应该使用此项，因为它“在如此高的阈值下占主导地位”。\n\n期望上穿数由Kac-Rice公式给出。对于长度为 $L$ 的区间上的平稳过程 $Z(m)$，其表达式为：\n$$ \\mathbb{E}[N_u] = L \\int_0^\\infty z' p(u, z') \\, dz' $$\n其中 $p(z, z')$ 是过程 $Z(m)$ 及其导数 $Z'(m)$ 在任意给定点 $m$ 的联合概率密度函数 (PDF)。\n\n对于一个平稳、单位方差（$ \\mathrm{Var}(Z)=1 $）的GRF，$Z(m)$ 及其导数 $Z'(m)$ 是独立的高斯随机变量。我们有 $Z(m) \\sim \\mathcal{N}(0, 1)$ 和 $Z'(m) \\sim \\mathcal{N}(0, \\sigma'^2)$，其中 $\\sigma'^2 = \\mathrm{Var}(Z'(m))$。它们各自的PDF为 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2)$ 和 $p(z') = \\frac{1}{\\sigma'\\sqrt{2\\pi}} \\exp(-\\frac{1}{2}(z'/\\sigma')^2)$。联合PDF为 $p(z, z') = p(z)p(z') = \\phi(z) \\frac{1}{\\sigma'} \\phi(z'/\\sigma')$。\n\n将此代入 $z=u$ 处的Kac-Rice公式：\n$$ \\mathbb{E}[N_u] = L \\, \\phi(u) \\int_0^\\infty z' \\frac{1}{\\sigma'\\sqrt{2\\pi}} \\exp\\left(-\\frac{z'^2}{2\\sigma'^2}\\right) \\, dz' $$\n该积分可以通过换元法求解。令 $y = z'/\\sigma'$，则 $dz' = \\sigma' dy$。\n$$ \\int_0^\\infty z' p(z') \\, dz' = \\int_0^\\infty (\\sigma'y) \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{y^2}{2}\\right) \\, dy = \\frac{\\sigma'}{\\sqrt{2\\pi}} \\int_0^\\infty y \\exp\\left(-\\frac{y^2}{2}\\right) \\, dy $$\n该积分的计算结果为 $\\left[-\\exp(-y^2/2)\\right]_0^\\infty = 1$。因此，表达式的积分部分为 $\\sigma'/\\sqrt{2\\pi}$。\n将此结果代回，我们得到：\n$$ \\mathbb{E}[N_u] = L \\, \\phi(u) \\frac{\\sigma'}{\\sqrt{2\\pi}} = L \\left(\\frac{1}{\\sqrt{2\\pi}}\\exp\\left(-\\frac{u^2}{2}\\right)\\right) \\frac{\\sigma'}{\\sqrt{2\\pi}} = L \\frac{\\sigma'}{2\\pi} \\exp\\left(-\\frac{u^2}{2}\\right) $$\n导数的方差 $\\sigma'^2$ 与过程的自相关函数 $C(\\Delta m) = \\mathbb{E}[Z(m)Z(m+\\Delta m)]$ 相关，关系为 $\\sigma'^2 = -C''(0)$。对于一个相关长度为 $\\ell$ 的平滑过程，相关函数的典型选择是高斯核：\n$$ C(\\Delta m) = \\exp\\left(-\\frac{(\\Delta m)^2}{2\\ell^2}\\right) $$\n关于 $\\Delta m$ 的一阶和二阶导数是：\n$$ C'(\\Delta m) = -\\frac{\\Delta m}{\\ell^2} \\exp\\left(-\\frac{(\\Delta m)^2}{2\\ell^2}\\right) $$\n$$ C''(\\Delta m) = \\left(-\\frac{1}{\\ell^2} + \\frac{(\\Delta m)^2}{\\ell^4}\\right) \\exp\\left(-\\frac{(\\Delta m)^2}{2\\ell^2}\\right) $$\n在 $\\Delta m = 0$ 处求值：\n$$ C''(0) = -\\frac{1}{\\ell^2} $$\n因此，导数的方差为 $\\sigma'^2 = -C''(0) = 1/\\ell^2$，这意味着 $\\sigma' = 1/\\ell$。\n\n将 $\\sigma' = 1/\\ell$ 代入 $\\mathbb{E}[N_u]$ 的表达式中：\n$$ p_{\\mathrm{glob}}(u) \\approx \\mathbb{E}[N_u] = \\frac{L}{\\ell} \\frac{1}{2\\pi} \\exp\\left(-\\frac{u^2}{2}\\right) $$\n问题将解析元数量定义为 $R = L/\\ell$。推导出的前导阶近似的最终表达式为：\n$$ p_{\\mathrm{glob}}(u) \\approx \\frac{R}{2\\pi} \\exp\\left(-\\frac{u^2}{2}\\right) $$\n该表达式将全局概率与有效独立搜索区域的数量 $R$ 以及一个高斯抑制因子联系起来。\n\n现在，我们根据给定的参数计算数值：$L=100\\,\\mathrm{GeV}$，$\\ell=2\\,\\mathrm{GeV}$，以及 $u=20$。\n首先，计算解析元数量 $R$：\n$$ R = \\frac{L}{\\ell} = \\frac{100}{2} = 50 $$\n接下来，将 $R=50$ 和 $u=20$ 代入推导出的公式中：\n$$ p_{\\mathrm{glob}}(20) \\approx \\frac{50}{2\\pi} \\exp\\left(-\\frac{20^2}{2}\\right) = \\frac{25}{\\pi} \\exp\\left(-\\frac{400}{2}\\right) = \\frac{25}{\\pi} \\exp(-200) $$\n使用计算器计算数值：\n$$ \\frac{25}{\\pi} \\approx 7.95774715459... $$\n$$ \\exp(-200) \\approx 1.3838965267 \\times 10^{-87} $$\n将这些值相乘：\n$$ p_{\\mathrm{glob}}(20) \\approx (7.95774715459) \\times (1.3838965267 \\times 10^{-87}) \\approx 11.01186 \\times 10^{-87} $$\n以标准科学记数法（$a \\times 10^b$，其中 $1 \\le |a|  10$）表示：\n$$ p_{\\mathrm{glob}}(20) \\approx 1.101186 \\times 10^{-86} $$\n按要求四舍五入到四位有效数字：\n$$ p_{\\mathrm{glob}}(20) \\approx 1.101 \\times 10^{-86} $$", "answer": "$$\\boxed{1.101 \\times 10^{-86}}$$", "id": "3539405"}, {"introduction": "虽然连续模型非常强大，但许多实际分析涉及的是离散的、相互关联的检验点（例如，直方图的“箱”）。本练习 [@problem_id:3539414] 通过处理一个具体的关联矩阵，阐明了“有效试验次数” $M_{\\mathrm{eff}}$ 这一概念。你将学习一种从关联矩阵的谱（即其特征值）计算 $M_{\\mathrm{eff}}$ 的原则性方法，从而量化关联性如何降低多重搜索带来的“惩罚”。", "problem": "考虑一系列由质量箱索引的局部假设检验，每次检验在原假设下，对一个固定的检验统计量产生一个局部尾部概率 $p_{\\mathrm{loc}} \\in [0,1]$。由于有限的质量分辨率和重叠的窗口，相邻的质量箱是相关的。这种相关性由一个 $M \\times M$ 的对称三对角相关矩阵 $\\mathbf{C}$ 建模，其元素为：\n- 对所有 $i$，$C_{ii} = 1$\n- 对 $i = 1,\\dots,M-1$，$C_{i,i+1} = C_{i+1,i} = \\rho$\n- 其他情况下，$C_{ij} = 0$\n其中 $\\rho \\in (-1,1)$ 是相邻箱之间的相关性。你可以假设对于下面测试套件中的 $\\rho$ 和 $M$ 值，$\\mathbf{C}$ 是正定的。\n\n全局“别处看效应”校正概率 $p_{\\mathrm{glob}}$ 定义为在整个搜索范围内观测到至少一个与已观测到的同样显著的局部涨落的概率。当检验是独立的时，$p_{\\mathrm{glob}}$ 和 $p_{\\mathrm{loc}}$ 在 $N$ 次试验中的确切关系由 $p_{\\mathrm{glob}} = 1 - (1 - p_{\\mathrm{loc}})^{N}$ 给出。在存在相关性的情况下，用一个依赖于 $\\mathbf{C}$ 的有效独立试验数 $M_{\\mathrm{eff}}$ 来代替 $N$。请从 $\\mathbf{C}$ 的谱中数值计算 $M_{\\mathrm{eff}}$，然后将 $M_{\\mathrm{eff}}$ 代入独立试验公式中计算 $p_{\\mathrm{glob}}$。\n\n你的程序必须：\n- 为每个给定的 $(M,\\rho)$ 构建 $\\mathbf{C}$。\n- 使用从谱中导出的有原则的有效维度度量，从 $\\mathbf{C}$ 的特征值数值计算 $M_{\\mathrm{eff}}$。\n- 对每种情况，使用将 $M_{\\mathrm{eff}}$ 代替整数计数的独立试验组合方法，从 $p_{\\mathrm{loc}}$ 和 $M_{\\mathrm{eff}}$ 计算 $p_{\\mathrm{glob}}$。所有概率都必须作为 $[0,1]$ 区间内的无量纲数处理，并以小数形式报告，而非百分比。\n\n测试套件：\n1. $M = 100$, $\\rho = 0.5$, $p_{\\mathrm{loc}} = 2.87 \\times 10^{-7}$。\n2. $M = 100$, $\\rho = 0.0$, $p_{\\mathrm{loc}} = 2.87 \\times 10^{-7}$。\n3. $M = 100$, $\\rho = 0.45$, $p_{\\mathrm{loc}} = 10^{-3}$。\n4. $M = 50$, $\\rho = -0.45$, $p_{\\mathrm{loc}} = 0.05$。\n5. $M = 1000$, $\\rho = 0.2$, $p_{\\mathrm{loc}} = 10^{-9}$。\n6. $M = 100$, $\\rho = 0.49$, $p_{\\mathrm{loc}} = 10^{-6}$。\n\n输出规范：\n- 对于每个测试用例，输出一个包含两个元素的列表 $[M_{\\mathrm{eff}}, p_{\\mathrm{glob}}]$。\n- 将所有测试用例的结果汇总到一个列表中，并保持上述顺序。\n- 将每个数值条目四舍五入到十二位有效数字。\n- 你的程序应该生成单行输出，包含由方括号括起来的逗号分隔列表形式的结果。例如，最终输出必须看起来像\n$[ [M_{\\mathrm{eff}}^{(1)},p_{\\mathrm{glob}}^{(1)}], [M_{\\mathrm{eff}}^{(2)},p_{\\mathrm{glob}}^{(2)}], \\dots ]$\n除了标准的逗号和方括号外，没有额外的空格要求。\n\n不应读取任何外部输入；所有参数如上所述，程序必须是自包含且确定性的。", "solution": "用户提供的问题是有效的。它在科学上基于高能物理的统计方法，在其术语的标准解释下是良构的，并且其表述是客观的。因此，我们将继续提供完整的解答。\n\n该问题要求在一系列 $M$ 个相关的假设检验中，从一个局部p值（$p_{\\mathrm{loc}}$）计算全局的，或经“别处看效应”校正的p值（$p_{\\mathrm{glob}}$）。用于组合 $N$ 个独立检验的标准公式 $p_{\\mathrm{glob}} = 1 - (1 - p_{\\mathrm{loc}})^{N}$，可以通过引入有效独立试验数 $M_{\\mathrm{eff}}$ 来适用于相关检验。问题的核心是从所提供的相关模型中确定 $M_{\\mathrm{eff}}$。\n\n**1. 相关模型与有效试验数**\n\n相邻检验之间的相关性由一个 $M \\times M$ 的对称三对角相关矩阵 $\\mathbf{C}$ 描述，其元素为：\n$$\nC_{ij} =\n\\begin{cases}\n1  \\text{若 } i=j \\\\\n\\rho  \\text{若 } |i-j|=1 \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n其中 $\\rho \\in (-1, 1)$ 是相邻箱之间的相关系数。\n\n问题指定 $M_{\\mathrm{eff}}$ 应该是一个“从 $\\mathbf{C}$ 的谱导出的有原则的有效维度度量”。一个用于从一组相关变量中确定有效参数数量或自由度的标准且有原则的度量，是从相关矩阵的特征值 $\\{\\lambda_i\\}_{i=1}^M$ 导出的。这个度量，有时与参与率有关，定义为：\n$$\nM_{\\mathrm{eff}} = \\frac{\\left(\\sum_{i=1}^M \\lambda_i\\right)^2}{\\sum_{i=1}^M \\lambda_i^2}\n$$\n对于任何相关矩阵，其特征值之和等于其迹。$\\mathbf{C}$ 的迹是 $\\mathrm{Tr}(\\mathbf{C}) = \\sum_{i=1}^M C_{ii} = \\sum_{i=1}^M 1 = M$。因此，$M_{\\mathrm{eff}}$ 的公式简化为：\n$$\nM_{\\mathrm{eff}} = \\frac{M^2}{\\sum_{i=1}^M \\lambda_i^2}\n$$\n这个表达式正确地再现了预期的极限情况：对于独立检验（$\\rho=0$），$\\mathbf{C}=\\mathbf{I}$，所有 $\\lambda_i=1$，且 $M_{\\mathrm{eff}} = M^2/M = M$。对于完全相关的检验，$M_{\\mathrm{eff}} \\to 1$。\n\n**2. 特征值与 $M_{\\mathrm{eff}}$ 的解析计算**\n\n矩阵 $\\mathbf{C}$ 是一种特殊类型的对称三对角托普利茨矩阵。这种矩阵的特征值具有已知的解析形式。对于一个主对角线上为 $a$、次对角线上为 $b$ 的 $M \\times M$ 矩阵，其特征值为 $\\lambda_k = a + 2b \\cos\\left(\\frac{k\\pi}{M+1}\\right)$，其中 $k=1, \\dots, M$。在我们的例子中，$a=1$，$b=\\rho$，所以 $\\mathbf{C}$ 的特征值为：\n$$\n\\lambda_k = 1 + 2\\rho \\cos\\left(\\frac{k\\pi}{M+1}\\right), \\quad k=1, \\dots, M\n$$\n虽然可以数值计算这些特征值，但对其平方和 $\\sum_{i=1}^M \\lambda_i^2$ 进行解析计算，能提供一个更优雅、高效和精确的解决方案。\n\n我们计算特征值的平方和：\n$$\n\\sum_{k=1}^M \\lambda_k^2 = \\sum_{k=1}^M \\left(1 + 2\\rho \\cos\\left(\\frac{k\\pi}{M+1}\\right)\\right)^2\n$$\n$$\n= \\sum_{k=1}^M \\left(1 + 4\\rho \\cos\\left(\\frac{k\\pi}{M+1}\\right) + 4\\rho^2 \\cos^2\\left(\\frac{k\\pi}{M+1}\\right)\\right)\n$$\n$$\n= M + 4\\rho \\sum_{k=1}^M \\cos\\left(\\frac{k\\pi}{M+1}\\right) + 4\\rho^2 \\sum_{k=1}^M \\cos^2\\left(\\frac{k\\pi}{M+1}\\right)\n$$\n这些和可以解析地求出。第一个和为零：$\\sum_{k=1}^M \\cos\\left(\\frac{k\\pi}{M+1}\\right) = 0$。对于第二个和，我们使用恒等式 $\\cos^2(x) = \\frac{1}{2}(1+\\cos(2x))$：\n$$\n\\sum_{k=1}^M \\cos^2\\left(\\frac{k\\pi}{M+1}\\right) = \\sum_{k=1}^M \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{2k\\pi}{M+1}\\right)\\right) = \\frac{M}{2} + \\frac{1}{2}\\sum_{k=1}^M \\cos\\left(\\frac{2k\\pi}{M+1}\\right)\n$$\n余下的和计算结果为 $\\sum_{k=1}^M \\cos\\left(\\frac{2k\\pi}{M+1}\\right) = -1$。\n因此，$\\sum_{k=1}^M \\cos^2\\left(\\frac{k\\pi}{M+1}\\right) = \\frac{M}{2} - \\frac{1}{2} = \\frac{M-1}{2}$。\n\n将这些结果代回特征值平方和的表达式中：\n$$\n\\sum_{k=1}^M \\lambda_k^2 = M + 4\\rho(0) + 4\\rho^2\\left(\\frac{M-1}{2}\\right) = M + 2\\rho^2(M-1)\n$$\n这得到了 $M_{\\mathrm{eff}}$ 的一个闭式解析表达式：\n$$\nM_{\\mathrm{eff}} = \\frac{M^2}{M + 2\\rho^2(M-1)}\n$$\n该公式仅依赖于给定的参数 $M$ 和 $\\rho$。\n\n**3. 全局p值的计算**\n\n确定了 $M_{\\mathrm{eff}}$ 后，通过将 $M_{\\mathrm{eff}}$ 代入独立试验公式来计算全局p值：\n$$\np_{\\mathrm{glob}} = 1 - (1 - p_{\\mathrm{loc}})^{M_{\\mathrm{eff}}}\n$$\n为了数值稳定性，尤其是在 $p_{\\mathrm{loc}}$ 很小的情况下，最好使用对数和指数函数来计算。令 $x = -p_{\\mathrm{loc}}$。项 $(1 - p_{\\mathrm{loc}})^{M_{\\mathrm{eff}}} = (1+x)^{M_{\\mathrm{eff}}} = \\exp(M_{\\mathrm{eff}} \\ln(1+x))$。使用库函数 `log1p`（计算 $\\ln(1+x)$）和 `expm1`（计算 $e^y-1$）可以提供更高的精度。计算变为：\n$$\np_{\\mathrm{glob}} = 1 - \\exp(M_{\\mathrm{eff}} \\cdot \\mathrm{log1p}(-p_{\\mathrm{loc}})) = -\\mathrm{expm1}(M_{\\mathrm{eff}} \\cdot \\mathrm{log1p}(-p_{\\mathrm{loc}}))\n$$\n\n**4. 算法总结**\n\n对于由 $(M, \\rho, p_{\\mathrm{loc}})$ 定义的每个测试用例：\n1.  使用导出的解析公式计算 $M_{\\mathrm{eff}}$：$M_{\\mathrm{eff}} = M^2 / (M + 2\\rho^2(M-1))$。\n2.  使用数值稳定的公式计算 $p_{\\mathrm{glob}}$：$p_{\\mathrm{glob}} = -\\mathrm{expm1}(M_{\\mathrm{eff}} \\cdot \\mathrm{log1p}(-p_{\\mathrm{loc}}))$。\n3.  将 $M_{\\mathrm{eff}}$ 和 $p_{\\mathrm{glob}}$ 四舍五入到12位有效数字。\n4.  将结果格式化为二元列表，并汇总以供最终输出。\n\n该方法绕过了数值矩阵对角化，为所需量提供了一个直接、精确且高效的计算。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the look-elsewhere effect problem for a set of test cases.\n    \"\"\"\n\n    test_cases = [\n        # (M, rho, p_loc)\n        (100, 0.5, 2.87e-7),\n        (100, 0.0, 2.87e-7),\n        (100, 0.45, 1e-3),\n        (50, -0.45, 0.05),\n        (1000, 0.2, 1e-9),\n        (100, 0.49, 1e-6),\n    ]\n\n    def round_to_sf(x, sf):\n        \"\"\"\n        Rounds a number x to a specified number of significant figures (sf).\n        \"\"\"\n        if x == 0:\n            return 0.0\n        # Calculate the number of decimal places to round to\n        order_of_magnitude = np.floor(np.log10(np.abs(x)))\n        decimal_places = sf - 1 - int(order_of_magnitude)\n        return np.round(x, decimal_places)\n\n    results_pairs = []\n    for M, rho, p_loc in test_cases:\n        # Step 1: Calculate the effective number of trials, M_eff.\n        # This is the analytical solution derived from the eigenvalues of the\n        # specified tridiagonal correlation matrix.\n        if M == 1:\n            m_eff = 1.0\n        else:\n            m_eff = M**2 / (M + 2 * rho**2 * (M - 1))\n\n        # Step 2: Calculate the global p-value, p_glob.\n        # Use a numerically stable formula to avoid precision loss for small p_loc.\n        # p_glob = 1 - (1 - p_loc)**M_eff\n        #        = -expm1(M_eff * log1p(-p_loc))\n        p_glob = -np.expm1(m_eff * np.log1p(-p_loc))\n\n        # Step 3: Round results to 12 significant figures.\n        m_eff_rounded = round_to_sf(m_eff, 12)\n        p_glob_rounded = round_to_sf(p_glob, 12)\n\n        results_pairs.append([m_eff_rounded, p_glob_rounded])\n\n    # Step 4: Format the output as specified.\n    # We construct the string manually to ensure the exact format is met,\n    # including number representation and brackets.\n    output_parts = []\n    for pair in results_pairs:\n        # Use a general format with sufficient precision to represent the\n        # rounded numbers correctly, including scientific notation.\n        meff_str = f\"{pair[0]:.15g}\"\n        pglob_str = f\"{pair[1]:.15g}\"\n        output_parts.append(f\"[{meff_str},{pglob_str}]\")\n\n    print(f\"[{','.join(output_parts)}]\")\n\n\nsolve()\n```", "id": "3539414"}, {"introduction": "归根结底，理解“别处观看效应”对于评估实验的真实灵敏度至关重要。这最后一个练习将统计形式理论与实验物理学中的一个关键问题联系起来。本练习 [@problem_id:3539395] 要求你量化“别处观看效应”在所需信号强度方面的“代价”，通过计算达到 $5\\sigma$ 全局发现显著性所需的最小信号，你将直接看到搜索范围如何影响发现潜力，并体会局部与全局显著性之间的差异。", "problem": "你的任务是量化在高能物理计算中典型的一维“信号峰”搜索中由“别处观看效应”（look-elsewhere effect）引起的灵敏度损失。考虑一个在质量谱上进行扫描的搜索，其有效独立试验次数表示为 $M_{\\mathrm{eff}}$。其中，每个质量假设都被视为一个计数实验，其期望本底产额为 $b$，信号模型的期望产额在单位信号强度下为 $s_{0}$。实际的信号强度乘子用 $\\mu$ 表示，从而得到期望信号产额 $s(\\mu) = \\mu s_{0}$。假设该搜索在每个质量值处采用基于似然比的局部检验，并使用以 $M_{\\mathrm{eff}}$ 为特征的有效试验因子对整个扫描进行汇总。\n\n从泊松计数似然的定义、剖面似然比的概念，以及通过标准正态分布的累积分布函数（CDF）从尾部概率到高斯等效显著性的标准映射出发，推导一种计算最小信号强度 $\\mu$ 的方法，使得全局显著性 $Z_{\\mathrm{glob}}(\\mu)$ 达到或超过 $5\\sigma$（五西格玛）的发现阈值。然后，量化在同一个最小 $\\mu$ 值下对应的局部中位显著性 $Z_{\\mathrm{loc}}(\\mu)$，以说明由“别处观看效应”引入的灵敏度差距。\n\n科学真实性和普适性要求：\n- 将 $b$ 和 $s_{0}$ 视为无量纲的期望计数值。\n- 角度单位不适用。\n- 程序必须实现一个数值上稳定且逻辑上合理的流程，该流程从基于泊松似然的检验和标准正态尾部概率映射的定义出发，而不依赖于临时的或纯粹经验性的捷径。\n\n你的程序应以完全确定的方式实现以下任务：\n1. 对于每个测试用例 $(M_{\\mathrm{eff}}, b, s_{0})$，计算使得 $Z_{\\mathrm{glob}}(\\mu) \\ge 5$ 的最小 $\\mu$，并报告该最小 $\\mu$ 以及在该 $\\mu$ 值下计算出的相应 $Z_{\\mathrm{loc}}(\\mu)$。\n2. 使用一种稳健的数值搜索方法，其合理性基于似然显著性相对于 $\\mu$ 的单调性。\n\n测试套件：\n- 案例 1：$M_{\\mathrm{eff}} = 1$, $b = 100$, $s_{0} = 5$。\n- 案例 2：$M_{\\mathrm{eff}} = 100$, $b = 100$, $s_{0} = 5$。\n- 案例 3：$M_{\\mathrm{eff}} = 10000$, $b = 1000$, $s_{0} = 10$。\n- 案例 4：$M_{\\mathrm{eff}} = 500$, $b = 1$, $s_{0} = 1$。\n- 案例 5：$M_{\\mathrm{eff}} = 1000$, $b = 10000$, $s_{0} = 50$。\n\n答案规格：\n- 对于每个测试用例，生成一个包含两个浮点数的列表：最小 $\\mu$ 和在该 $\\mu$ 值下计算出的 $Z_{\\mathrm{loc}}(\\mu)$。\n- 所有输出必须是无单位的。\n- 以十进制形式表示浮点数，并四舍五入到小数点后六位。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含五个测试用例的结果，格式为逗号分隔的列表的列表，并用方括号括起来，例如：$[\\,[\\mu_{1}, Z_{\\mathrm{loc},1}], [\\mu_{2}, Z_{\\mathrm{loc},2}], \\dots\\,]$。", "solution": "用户提供的问题已经过严格验证，并被确定为具有科学依据、适定且客观。它概述了高能物理学中一个标准但相当复杂的灵敏度计算。该问题没有科学缺陷、矛盾或含糊之处。所有提供的参数足以推导出唯一且有意义的解。\n\n该问题要求我们量化一维搜索中由“别处观看效应”引起的灵敏度损失。这涉及找到产生 $5\\sigma$ 全局显著性的最小信号强度 $\\mu$，并确定相应的局部显著性。解决方案首先为局部搜索建立统计框架，然后使用提供的有效试验因子 $M_{\\mathrm{eff}}$ 将其扩展到全局背景中。\n\n局部搜索的核心（在固定质量处的“信号峰搜索”）是一个计数实验。观测到的事件数 $n$ 被建模为一个服从泊松分布的随机变量。该分布的均值是期望本底事件数 $b$ 和期望信号事件数 $s(\\mu) = \\mu s_0$ 的和。参数 $\\mu$ 是信号强度乘子。问题假设 $b$ 和 $s_0$ 是已知常数。在给定信号强度 $\\mu$ 的情况下，观测到 $n$ 个事件的泊松似然函数为：\n$$ L(\\mu) = \\frac{(\\mu s_0 + b)^n e^{-(\\mu s_0 + b)}}{n!} $$\n\n为了检验信号的存在，我们将唯本底假设（$\\mathcal{H}_0$，其中 $\\mu=0$）与信号加本底假设（$\\mathcal{H}_1$，其中 $\\mu0$）进行比较。用于发现的标准检验统计量是剖面似然比 $q_0$：\n$$ q_0 = -2 \\ln \\frac{L(\\mu=0)}{L(\\hat{\\mu})} $$\n其中 $\\hat{\\mu}$ 是在给定数据 $n$ 的情况下使似然函数 $L(\\mu)$ 最大化的 $\\mu$ 值。$\\hat{\\mu}$ 的值被约束为非负，因为负的信号强度是非物理的。最大化 $L(\\mu)$ 等同于最大化 $\\ln L(\\mu)$。$\\ln L(\\mu)$ 对 $\\mu$ 的导数是：\n$$ \\frac{d}{d\\mu} \\ln L(\\mu) = \\frac{n s_0}{\\mu s_0 + b} - s_0 $$\n将导数设为零可得 $\\hat{\\mu} s_0 + b = n$，即 $\\hat{\\mu} = (n-b)/s_0$。如果 $n \\le b$，无约束最大值出现在负的 $\\mu$ 处，因此在物理区域 $\\mu \\ge 0$ 内的最大值出现在 $\\hat{\\mu}=0$ 处。因此，检验统计量为：\n$$ q_0 = \\begin{cases} -2 \\ln \\frac{L(0)}{L(\\hat{\\mu})}  \\text{if } n  b \\\\ 0  \\text{if } n \\le b \\end{cases} $$\n对于 $nb$ 的情况，代入似然表达式，我们有 $L(\\hat{\\mu}) = \\frac{n^n e^{-n}}{n!}$ 和 $L(0) = \\frac{b^n e^{-b}}{n!}$。该比值变为 $\\frac{L(0)}{L(\\hat{\\mu})} = \\left(\\frac{b}{n}\\right)^n e^{n-b}$。这给出：\n$$ q_0 = -2 \\left[ n \\ln\\left(\\frac{b}{n}\\right) + n-b \\right] = 2 \\left[ n \\ln\\left(\\frac{n}{b}\\right) - (n-b) \\right] $$\n\n为了计算给定真实信号强度 $\\mu$ 的*中位*显著性，我们使用 Asimov 数据集。在此过程中，观测数据 $n$ 被其在信号强度为 $\\mu$ 的假设下的期望值所替代，即 $n_A = \\mu s_0 + b$。由于发现灵敏度研究假设 $\\mu0$（且 $s_00$），我们有 $n_A  b$，因此可以使用 $q_0$ 的主要公式。用 $n_A$ 代替 $n$ 得到 Asimov 检验统计量 $q_{0,A}$：\n$$ q_{0,A}(\\mu) = 2 \\left[ (\\mu s_0 + b) \\ln\\left(\\frac{\\mu s_0 + b}{b}\\right) - ((\\mu s_0 + b) - b) \\right] $$\n$$ q_{0,A}(\\mu) = 2 \\left[ (\\mu s_0 + b) \\ln\\left(1 + \\frac{\\mu s_0}{b}\\right) - \\mu s_0 \\right] $$\n局部显著性 $Z_{\\mathrm{loc}}$ 通过 $Z_{\\mathrm{loc}} = \\sqrt{q_0}$ 与检验统计量相关（这是 Wilks 定理的一个结果）。因此，中位局部显著性为：\n$$ Z_{\\mathrm{loc}}(\\mu) = \\sqrt{q_{0,A}(\\mu)} = \\sqrt{2 \\left[ (\\mu s_0 + b) \\ln\\left(1 + \\frac{\\mu s_0}{b}\\right) - \\mu s_0 \\right]} $$\n对于 $\\mu  0$，此函数随 $\\mu$ 单调递增。\n\n接下来，我们将局部显著性与全局显著性关联起来。显著性 $Z$ 是通过标准正态分布 $\\Phi(Z)$ 的尾部概率（p值）定义的：\n$$ p = 1 - \\Phi(Z) $$\n其中 $p$ 是唯本底涨落产生一个至少与观测结果一样“类信号”的结果的概率。其逆关系为 $Z = \\Phi^{-1}(1-p)$。\n\n“别处观看效应”通过使用有效独立试验次数 $M_{\\mathrm{eff}}$ 来解释。全局p值 $p_{\\mathrm{glob}}$ 与局部p值 $p_{\\mathrm{loc}}$ 通过 Bonferroni 修正相关联：\n$$ p_{\\mathrm{glob}} \\approx M_{\\mathrm{eff}} \\cdot p_{\\mathrm{loc}} $$\n这种近似对于小的p值是有效的，这在高显著性搜索中正是如此。问题将 $M_{\\mathrm{eff}}$ 作为输入提供，使得这种关系成为定义性的。\n结合这些关系，我们得到局部显著性与全局显著性之间的映射：\n$$ 1 - \\Phi(Z_{\\mathrm{glob}}) = M_{\\mathrm{eff}} \\left[ 1 - \\Phi(Z_{\\mathrm{loc}}) \\right] $$\n\n问题要求找到达到全局显著性 $Z_{\\mathrm{glob}} \\ge 5$ 的最小 $\\mu$。我们求解边界情况，即 $Z_{\\mathrm{glob}} = 5$。\n首先，我们找到与 $5\\sigma$ 全局显著性相对应的所需局部显著性 $Z_{\\mathrm{loc}}^{\\mathrm{req}}$。\n1.  计算目标全局p值：$p_{\\mathrm{glob}}^{\\mathrm{target}} = 1 - \\Phi(5)$。\n2.  计算所需局部p值：$p_{\\mathrm{loc}}^{\\mathrm{req}} = p_{\\mathrm{glob}}^{\\mathrm{target}} / M_{\\mathrm{eff}}$。\n3.  计算所需局部显著性：$Z_{\\mathrm{loc}}^{\\mathrm{req}} = \\Phi^{-1}(1 - p_{\\mathrm{loc}}^{\\mathrm{req}})$。\n\n最后，我们必须找到能产生此所需局部显著性的信号强度 $\\mu$。我们求解以下关于 $\\mu$ 的方程：\n$$ Z_{\\mathrm{loc}}(\\mu) = Z_{\\mathrm{loc}}^{\\mathrm{req}} $$\n将两边平方以简化数值搜索：\n$$ 2 \\left[ (\\mu s_0 + b) \\ln\\left(1 + \\frac{\\mu s_0}{b}\\right) - \\mu s_0 \\right] = (Z_{\\mathrm{loc}}^{\\mathrm{req}})^2 $$\n这是一个关于 $\\mu$ 的超越方程。由于左侧对 $\\mu$ 是单调的，我们可以采用如二分法之类的稳健数值求根方法。我们寻求以下函数的根：\n$$ f(\\mu) = 2 \\left[ (\\mu s_0 + b) \\ln\\left(1 + \\frac{\\mu s_0}{b}\\right) - \\mu s_0 \\right] - (Z_{\\mathrm{loc}}^{\\mathrm{req}})^2 $$\n$\\mu$ 的搜索区间可以通过注意到 $f(0)  0$ 并找到一个上界 $\\mu_{\\mathrm{high}}$ 使得 $f(\\mu_{\\mathrm{high}})  0$ 来确定。$f(\\mu)=0$ 的根就是我们所寻求的最小信号强度 $\\mu^*$。相应的局部显著性是 $Z_{\\mathrm{loc}}(\\mu^*) = Z_{\\mathrm{loc}}^{\\mathrm{req}}$。\n\n每个测试用例 $(M_{\\mathrm{eff}}, b, s_0)$ 的流程是：\n1.  从 $M_{\\mathrm{eff}}$ 和目标 $Z_{\\mathrm{glob}}=5$ 计算 $Z_{\\mathrm{loc}}^{\\mathrm{req}}$。\n2.  数值求解方程 $f(\\mu)=0$ 以找到 $\\mu^*$。\n3.  报告数对 $[\\mu^*, Z_{\\mathrm{loc}}^{\\mathrm{req}}]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the minimal signal strength mu for a 5-sigma global discovery\n    and the corresponding local significance, accounting for the look-elsewhere effect.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1, 100, 5),     # M_eff, b, s0\n        (100, 100, 5),\n        (10000, 1000, 10),\n        (500, 1, 1),\n        (1000, 10000, 50),\n    ]\n\n    results = []\n    \n    # The discovery threshold for global significance\n    Z_GLOB_TARGET = 5.0\n\n    def calculate_mu_and_z_loc(M_eff, b, s0):\n        \"\"\"\n        Calculates the minimal mu and corresponding Z_loc for a single case.\n        \"\"\"\n        # 1. Calculate the target global p-value for Z_glob = 5\n        # Use norm.sf (survival function, 1-cdf) for better precision in the far tail\n        p_glob_target = norm.sf(Z_GLOB_TARGET)\n\n        # 2. Calculate the required local p-value using the trials factor\n        # If M_eff makes p_loc = 1, it's an unphysical scenario, but the code handles it.\n        p_loc_req = min(p_glob_target / M_eff, 1.0)\n\n        # 3. Calculate the required local significance from the local p-value\n        # Use norm.isf (inverse survival function) for precision\n        Z_loc_req = norm.isf(p_loc_req)\n\n        # 4. Define the function whose root we need to find.\n        # This function represents Z_loc_squared(mu) - Z_loc_req_squared = 0\n        Z_loc_req_sq = Z_loc_req**2\n        \n        def objective_func(mu):\n            if mu = 0:\n                return -Z_loc_req_sq\n            \n            s = mu * s0\n            \n            # The Asimov test statistic q_{0,A} is Z_loc_squared\n            # q_0A = 2 * ((s + b) * ln(1 + s/b) - s)\n            term1 = s + b\n            term2 = np.log1p(s / b) # log1p(x) is ln(1+x), more accurate for small x\n            q_0A = 2 * (term1 * term2 - s)\n            \n            return q_0A - Z_loc_req_sq\n\n        # 5. Use a bisection method to find the root mu.\n        # Bisection is robust due to the monotonicity of the objective function.\n        mu_low = 0.0\n        mu_high = 1.0\n        \n        # Find an upper bound for the search interval\n        # The objective function is monotonic, so g(mu_high) must be  0\n        while objective_func(mu_high)  0:\n            mu_high *= 2.0\n            if mu_high > 1e6: # Safety break for pathological cases\n                raise RuntimeError(\"Failed to bracket root for mu.\")\n\n        # Bisection search\n        tolerance = 1e-9\n        max_iterations = 100\n        for _ in range(max_iterations):\n            mu_mid = (mu_low + mu_high) / 2\n            if mu_mid == mu_low or mu_mid == mu_high: # Reached precision limit\n                break\n            \n            g_mid = objective_func(mu_mid)\n            \n            if g_mid  0:\n                mu_low = mu_mid\n            else:\n                mu_high = mu_mid\n            \n            if (mu_high - mu_low)  tolerance:\n                break\n        \n        minimal_mu = (mu_low + mu_high) / 2\n        \n        return [minimal_mu, Z_loc_req]\n\n    for case in test_cases:\n        M_eff, b, s0 = case\n        mu, z_loc = calculate_mu_and_z_loc(M_eff, b, s0)\n        # Format the numbers to six decimal places as required.\n        results.append(f\"[{mu:.6f},{z_loc:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3539395"}]}