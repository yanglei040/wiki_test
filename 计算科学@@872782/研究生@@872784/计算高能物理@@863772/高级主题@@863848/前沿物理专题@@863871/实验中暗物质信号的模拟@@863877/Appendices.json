{"hands_on_practices": [{"introduction": "在间接探测实验中，天体物理J因子是连接暗物质粒子物理性质与可观测信号的关键。这个练习将指导你为一个标准的暗物质晕模型（NFW剖面）推导其J因子，这是一个重要的解析计算，能让你深入理解信号强度如何依赖于暗物质的空间分布。通过这个“纸笔”练习，你将掌握量化天体物理不确定性的基础 [@problem_id:3534035]。", "problem": "一个球对称的暗物质晕采用纳瓦罗-弗伦克-怀特（Navarro-Frenk-White, NFW）密度剖面进行建模，该剖面由特征密度 $\\rho_{s}$ 和标度半径 $r_{s}$ 定义为 $\\rho(r) = \\rho_{s} \\left[ \\left( \\frac{r}{r_{s}} \\right) \\left( 1 + \\frac{r}{r_{s}} \\right)^{2} \\right]^{-1}$。对于通过粒子湮没进行的间接探测，天体物理视线（l.o.s.）$J$因子由路径积分 $J = \\int_{\\text{l.o.s.}} \\rho^{2}(s) \\, ds$ 定义，其中 $s$ 是沿视线的坐标。\n\n假设观测者位于距晕中心为 $D \\gg r_{s}$ 的位置，并考虑对应于角距离 $\\psi = 0$ 的中心视线，此时撞击参数为零。为符合物理现实，假设密度剖面在一个小半径 $r_{\\min}$ 内被截断为一个常数核心（例如，由于湮没饱和或重子反馈），因此积分实际上从 $r = r_{\\min} > 0$ 开始。取视线延伸至无穷远。\n\n仅从上述定义以及球对称系统中视线坐标与径向坐标之间的几何关系出发，推导中心 $J$ 因子 $J_{\\text{NFW}}(\\psi=0; r_{\\min})$ 的闭合形式解析表达式，用 $\\rho_{s}$、$r_{s}$ 和无量纲内截断 $y_{\\min} \\equiv r_{\\min}/r_{s}$ 表示。将最终答案表示为单个解析表达式，不要包含任何数值或物理单位。\n\n然后，使用具有内斜率参数 $\\gamma$ 的广义NFW剖面 $\\rho(r) = \\rho_{s} \\left[ \\left( \\frac{r}{r_{s}} \\right)^{\\gamma} \\left( 1 + \\frac{r}{r_{s}} \\right)^{3-\\gamma} \\right]^{-1}$，定性解释改变 $\\gamma$ 如何改变 $J_{\\text{NFW}}(\\psi=0; r_{\\min})$ 随 $r_{\\min}$ 的标度关系。最后，解释未分辨的子结构如何通过 $\\langle \\rho^{2} \\rangle$ 和 $\\langle \\rho \\rangle^{2}$ 之间的关系来修正信号预测，并定义一个量化此效应的增强因子。\n\n你的最终答案必须是关于 $J_{\\text{NFW}}(\\psi=0; r_{\\min})$ 的单个闭合形式解析表达式，用 $\\rho_{s}$、$r_{s}$ 和 $y_{\\min}$ 表示，不带任何单位。无需四舍五入。", "solution": "用于湮没的天体物理 $J$ 因子由视线积分 $J = \\int_{\\text{l.o.s.}} \\rho^{2}(s)\\, ds$ 定义，其中视线坐标 $s$ 沿着给定方向穿过密度场。对于球对称晕，径向坐标 $r$ 与撞击参数 $b$ 和视线坐标 $s$ 的关系为 $r = \\sqrt{b^{2} + s^{2}}$。对于中心视线，$\\psi = 0$ 意味着 $b = D \\sin \\psi = 0$，因此 $r = |s|$。引入一个有物理动机的内截断半径 $r_{\\min} > 0$，积分从 $r_{\\min}$ 开始，以避免与NFW尖峰相关的发散。\n\n使用纳瓦罗-弗伦克-怀特剖面 $\\rho(r) = \\rho_{s}\\left[ \\left( \\frac{r}{r_{s}} \\right) \\left( 1 + \\frac{r}{r_{s}} \\right)^{2} \\right]^{-1}$，密度的平方为\n$$\n\\rho^{2}(r) = \\rho_{s}^{2} \\left[ \\left( \\frac{r}{r_{s}} \\right)^{2} \\left( 1 + \\frac{r}{r_{s}} \\right)^{4} \\right]^{-1}.\n$$\n在中心视线上，该积分变为\n$$\nJ_{\\text{NFW}}(\\psi=0; r_{\\min}) = \\int_{-\\infty}^{\\infty} \\rho^{2}(|s|)\\, ds = 2 \\int_{r_{\\min}}^{\\infty} \\rho^{2}(r)\\, dr,\n$$\n其中因子 $2$ 解释了视线的两个对称部分（$s>0$ 和 $s0$）。将变量更改为无量纲径向坐标 $y \\equiv r/r_{s}$，因此 $r = r_{s} y$ 且 $dr = r_{s}\\, dy$，并定义 $y_{\\min} \\equiv r_{\\min}/r_{s}$，我们得到\n$$\nJ_{\\text{NFW}}(\\psi=0; r_{\\min}) = 2 \\rho_{s}^{2} r_{s} \\int_{y_{\\min}}^{\\infty} \\frac{1}{y^{2} (1+y)^{4}}\\, dy.\n$$\n\n我们现在计算积分 $I(y) \\equiv \\int \\frac{dy}{y^{2} (1+y)^{4}}$。一个方便的代换是 $t \\equiv \\frac{1}{1+y}$，这意味着 $y = \\frac{1-t}{t}$ 且 $dy = -\\frac{dt}{t^{2}}$。被积函数简化为\n$$\n\\frac{1}{y^{2} (1+y)^{4}} = \\frac{t^{6}}{(1-t)^{2}},\n$$\n测度变换为\n$$\n\\frac{t^{6}}{(1-t)^{2}} \\left(-\\frac{dt}{t^{2}}\\right) = - \\frac{t^{4}}{(1-t)^{2}}\\, dt.\n$$\n令 $w \\equiv 1 - t$，我们有 $dt = -dw$ 且 $- \\frac{t^{4}}{(1-t)^{2}}\\, dt = \\frac{(1-w)^{4}}{w^{2}}\\, dw$。展开分子得到\n$$\n\\frac{(1-w)^{4}}{w^{2}} = w^{-2} - 4 w^{-1} + 6 - 4 w + w^{2}.\n$$\n逐项积分，\n$$\nI(y) = \\int \\frac{dy}{y^{2} (1+y)^{4}} = - \\frac{1}{w} - 4 \\ln w + 6 w - 2 w^{2} + \\frac{1}{3} w^{3} + C,\n$$\n其中 $w \\equiv \\frac{y}{1+y}$ 且 $C$ 是积分常数。因此，\n$$\nI(y) = - \\frac{1+y}{y} - 4 \\ln\\!\\left( \\frac{y}{1+y} \\right) + \\frac{6y}{1+y} + \\frac{2 y^{2}}{(1+y)^{2}} - \\frac{1}{3} \\frac{y^{3}}{(1+y)^{3}} + C.\n$$\n\n我们需要从 $y_{\\min}$ 到 $\\infty$ 的定积分。首先计算在无穷远处的极限。当 $y \\to \\infty$ 时，$w \\to 1$，我们发现\n$$\nI(\\infty) = -1 - 4 \\ln(1) + 6 \\cdot 1 - 2 \\cdot 1 + \\frac{1}{3} \\cdot 1 = \\frac{10}{3}.\n$$\n因此，\n$$\n\\int_{y_{\\min}}^{\\infty} \\frac{dy}{y^{2} (1+y)^{4}} = I(\\infty) - I(y_{\\min}) = \\frac{10}{3} + \\frac{1+y_{\\min}}{y_{\\min}} + 4 \\ln\\!\\left( \\frac{y_{\\min}}{1+y_{\\min}} \\right) - \\frac{6 y_{\\min}}{1+y_{\\min}} - \\frac{2 y_{\\min}^{2}}{(1+y_{\\min})^{2}} + \\frac{1}{3} \\frac{y_{\\min}^{3}}{(1+y_{\\min})^{3}}.\n$$\n乘以 $2 \\rho_{s}^{2} r_{s}$ 得到所需的中心 $J$ 因子：\n$$\nJ_{\\text{NFW}}(\\psi=0; r_{\\min}) = 2 \\rho_{s}^{2} r_{s} \\left[ \\frac{10}{3} + \\frac{1+y_{\\min}}{y_{\\min}} + 4 \\ln\\!\\left( \\frac{y_{\\min}}{1+y_{\\min}} \\right) - \\frac{6 y_{\\min}}{1+y_{\\min}} - \\frac{2 y_{\\min}^{2}}{(1+y_{\\min})^{2}} + \\frac{1}{3} \\frac{y_{\\min}^{3}}{(1+y_{\\min})^{3}} \\right].\n$$\n\n我们现在讨论内斜率和子结构的影响。考虑具有内斜率参数 $\\gamma$ 的广义NFW剖面，\n$$\n\\rho(r) = \\rho_{s} \\left[ \\left( \\frac{r}{r_{s}} \\right)^{\\gamma} \\left( 1 + \\frac{r}{r_{s}} \\right)^{3-\\gamma} \\right]^{-1}.\n$$\n在中心附近（$r \\ll r_{s}$），其行为类似于 $\\rho(r) \\propto r^{-\\gamma}$，因此 $\\rho^{2}(r) \\propto r^{-2\\gamma}$。在具有 $r_{\\min}$ 截断的中心视线上，主导的标度关系是\n$$\nJ(\\psi=0; r_{\\min}) \\sim \\int_{r_{\\min}}^{\\infty} r^{-2\\gamma} \\, dr \\propto\n\\begin{cases}\nr_{\\min}^{1 - 2\\gamma}  \\text{若 } \\gamma \\neq \\frac{1}{2}, \\\\\n\\ln\\!\\left( \\frac{r_{\\text{max}}}{r_{\\min}} \\right)  \\text{若 } \\gamma = \\frac{1}{2},\n\\end{cases}\n$$\n其中 $r_{\\text{max}}$ 是在 $\\gamma = \\frac{1}{2}$ 的临界情况下进入对数项的一个外标度。因此，更陡的内斜率（$\\gamma$ 更大）会增强 $J$ 对内截断的敏感性，随着 $r_{\\min}$ 的减小而增加中心 $J$ 因子。对于经典的 NFW 情况 $\\gamma = 1$，在中心极限下 $J(\\psi=0; r_{\\min}) \\propto r_{\\min}^{-1}$，这与上面推导的显式表达式一致。\n\n未分辨的子结构会修正信号预测，因为湮没依赖于 $\\langle \\rho^{2} \\rangle$，而不是 $\\langle \\rho \\rangle^{2}$。对于具有密度涨落的体积元，定义增强因子\n$$\nB \\equiv \\frac{\\langle \\rho^{2} \\rangle}{\\langle \\rho \\rangle^{2}} - 1,\n$$\n因此包含子结构的总 $J$ 因子可以示意性地写为\n$$\nJ_{\\text{tot}} \\simeq J_{\\text{smooth}} \\left( 1 + B \\right).\n$$\n这里 $B$ 取决于子晕质量函数（例如 $dN/dM \\propto M^{-\\alpha}$）、浓度-质量关系 $c(M)$、最小团块质量和空间分布以及潮汐演化。总的来说，$B$ 会增强湮没信号，通常在子晕受潮汐破坏较小的大半径处增强作用更强，从而与光滑晕模型相比，改变了预测信号的归一化和形态。\n\n所要求的最终答案是上面推导出的，用 $\\rho_{s}$、$r_{s}$ 和 $y_{\\min}$ 表示的 $J_{\\text{NFW}}(\\psi=0; r_{\\min})$ 的闭合形式表达式。", "answer": "$$\\boxed{2 \\rho_{s}^{2} r_{s} \\left[ \\frac{10}{3} + \\frac{1+y_{\\min}}{y_{\\min}} + 4 \\ln\\!\\left( \\frac{y_{\\min}}{1+y_{\\min}} \\right) - \\frac{6 y_{\\min}}{1+y_{\\min}} + \\frac{2 y_{\\min}^{2}}{(1+y_{\\min})^{2}} - \\frac{1}{3} \\frac{y_{\\min}^{3}}{(1+y_{\\min})^{3}} \\right]}$$", "id": "3534035"}, {"introduction": "掌握了源项的计算之后，下一个挑战是模拟信号从产生到被探测的全过程。这个动手编码练习将带你构建一个完整的模拟流程，用于计算来自暗物质湮灭的反质子流，其中包含了宇宙线在银河系中的传播、太阳调制效应，并最终将模型预测与真实的AMS-02实验数据进行统计比较。这项实践将理论、计算和数据分析紧密地结合在一起 [@problem_id:3534007]。", "problem": "考虑一个简化但科学上一致的模拟，该模拟涉及银河系中暗物质 (DM) 湮灭成底夸克所产生的反质子微分通量，并将其与阿尔法磁谱仪 (AMS-02) 的约束进行比较。目标是实现一个程序，对于一小组参数点测试集，该程序在参数化传播模型下计算大气层顶的反质子通量预测，并使用包含相关系统不确定性的协方差来评估模型与 AMS-02 测量值的一致性。\n\n使用的基本原理和定义：\n- 从宇宙线输运（扩散-对流-损失）方程的稳态形式开始，该方程遵循粒子数连续性。在薄盘、一维板近似中，假设在半高为 $L$ 的晕中存在一个均匀源，并对动能为 $T$ 时的反质子相空间密度 $N(T)$ 采用有效时间近似：数密度是源项 $q(T)$ 乘以一个有效停留时间 $\\tau_{\\mathrm{eff}}(T)$，该时间结合了扩散、对流和灾变性损失时标。\n- 单位能量、单位体积、单位时间的源项为 $q(T) = \\frac{1}{2}\\langle \\sigma v \\rangle (\\frac{\\rho_0}{m_\\chi})^2 \\frac{dN_{\\bar{p}}}{dT}$，其中定义如下：$\\langle \\sigma v \\rangle$ 是 DM 湮灭率，$m_\\chi$ 是 DM 质量，$\\rho_0$ 是局域 DM 密度，$\\frac{dN_{\\bar{p}}}{dT}$ 是每次湮灭、单位动能下的反质子产额。反质子产额将使用 Beta 函数形式 $dN_{\\bar{p}}/dx \\propto x^{p}(1-x)^{q}$（在 $x \\in [0,1]$ 上）建模为关于 $x = T/m_\\chi$ 的无量纲形状，并归一化到总反质子重数 $N_{\\bar{p}}$；使用 $dT = m_\\chi dx$ 将其转换为 $\\frac{dN_{\\bar{p}}}{dT}$。\n- 作为动能函数的参数化扩散系数遵循经验性的刚度依赖关系 $K(T) = K_0\\,\\beta(T)(\\frac{R(T)}{1\\,\\mathrm{GV}})^{\\delta}$，其中 $\\beta(T) = v(T)/c$，刚度 $R(T)$ 由反质子动量 $p(T)$ 和电荷大小 $|Z| = 1$ 计算得出。使用 $p(T) = \\sqrt{T(T+2m_p)}$（单位 $\\mathrm{GeV}$）和 $R(T)$（单位 $\\mathrm{GV}$）。\n- 使用调和求和组合时标：$\\tau_{\\mathrm{eff}}(T)^{-1} = \\tau_{\\mathrm{diff}}(T)^{-1} + \\tau_{\\mathrm{conv}}^{-1} + \\tau_{\\mathrm{ann}}(T)^{-1}$，其中 $\\tau_{\\mathrm{diff}}(T) = L^2/K(T)$，$\\tau_{\\mathrm{conv}} = L/V_c$，以及气体中反质子湮灭时标 $\\tau_{\\mathrm{ann}}(T) = (n_{\\mathrm{gas}}\\sigma_{\\mathrm{ann}}v(T))^{-1}$。\n- 星际 (IS) 微分通量为 $\\Phi_{\\mathrm{IS}}(T) = \\frac{v(T)}{4\\pi} N(T)$，当单位一致转换为国际单位制 (SI) 时，表示为 $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\\,\\mathrm{sr}^{-1}\\,\\mathrm{GeV}^{-1}$。\n- 对于电荷大小 $|Z| = 1$ 和调制势 $\\phi$（单位 $\\mathrm{GV}$），应用力场太阳调制（大气层顶，TOA）：对于一个大气层顶动能 $T$，将其与星际能量 $T_{\\mathrm{IS}} = T + |Z| \\phi$ 关联，并通过 $\\Phi_{\\mathrm{TOA}}(T) = \\Phi_{\\mathrm{IS}}(T_{\\mathrm{IS}})\\times \\frac{T(T+2m_p)}{T_{\\mathrm{IS}}(T_{\\mathrm{IS}}+2m_p)}$ 映射通量。如果 $T_{\\mathrm{IS}} > m_\\chi$，则设 $\\Phi_{\\mathrm{IS}}(T_{\\mathrm{IS}})=0$。\n- 通过构建残差向量 $\\mathbf{r} = \\boldsymbol{\\Phi}_{\\mathrm{model}} - \\boldsymbol{\\Phi}_{\\mathrm{obs}}$ 并使用包含统计不确定性和相关系统不确定性的协方差矩阵 $\\mathbf{C}$ 评估卡方，将模型预测与 AMS-02 的分箱测量值进行比较：$\\chi^2 = \\mathbf{r}^\\top \\mathbf{C}^{-1}\\mathbf{r}$，其中 $\\mathbf{C} = \\mathrm{diag}(\\boldsymbol{\\sigma}_{\\mathrm{stat}}^2) + \\rho\\,\\boldsymbol{\\sigma}_{\\mathrm{sys}}\\,\\boldsymbol{\\sigma}_{\\mathrm{sys}}^\\top$。使用自由度等于分箱数的卡方生存函数计算 p 值。\n\n使用的常数和单位：\n- 光速 $c = 2.99792458\\times 10^8\\,\\mathrm{m/s}$。\n- 质子质量 $m_p = 0.938\\,\\mathrm{GeV}$。\n- 局域 DM 密度 $\\rho_0 = 0.4\\,\\mathrm{GeV/cm}^3$。\n- 使用 $1\\,\\mathrm{cm}^3 = 10^{-6}\\,\\mathrm{m}^3$ 将 $\\langle \\sigma v \\rangle$（单位 $\\mathrm{cm}^3/\\mathrm{s}$）转换为 $\\mathrm{m}^3/\\mathrm{s}$。\n- 使用 $1\\,\\mathrm{kpc} = 3.086\\times 10^{19}\\,\\mathrm{m}$ 和 $1\\,\\mathrm{Myr} = 3.15576\\times 10^{13}\\,\\mathrm{s}$ 将 $K_0$（单位 $\\mathrm{kpc}^2/\\mathrm{Myr}$）转换为 $\\mathrm{m}^2/\\mathrm{s}$。\n- 通过相同的转换将晕半高 $L$（单位 $\\mathrm{kpc}$）转换为米。\n- 使用 $1\\,\\mathrm{cm}^{-3} = 10^6\\,\\mathrm{m}^{-3}$ 将气体数密度 $n_{\\mathrm{gas}}$（单位 $\\mathrm{cm}^{-3}$）转换为 $\\mathrm{m}^{-3}$。\n- 使用 $1\\,\\mathrm{mb} = 10^{-31}\\,\\mathrm{m}^2$ 将反质子非弹性散射截面 $\\sigma_{\\mathrm{ann}}$（单位毫靶）转换为 $\\mathrm{m}^2$。\n- 任何与立体角相关的量的角度单位都隐式地为球面度；无需进行角度计算。\n\n反质子产额模型：\n- 对于 $x\\in[0,1]$，使用 $dN_{\\bar{p}}/dx = A\\,x^{p}(1-x)^{q}$，其中 $p = 1.5$，$q = 4$，且每次湮灭产生 $N_{\\bar{p}} = 1$ 个反质子。使用 Beta 函数 $B(\\alpha,\\beta)$ 对 $A$ 进行归一化：$\\int_0^1 x^{p}(1-x)^{q}\\,dx = B(p+1,q+1)$，因此 $A = N_{\\bar{p}}/B(p+1,q+1)$。然后，对于 $T\\le m_\\chi$，$dN_{\\bar{p}}/dT = \\frac{N_{\\bar{p}}}{m_\\chi B(p+1,q+1)} x^{p}(1-x)^{q}$，否则为 0。\n\nAMS-02 分箱测量值和不确定性：\n- 大气层顶的动能分箱（单位 $\\mathrm{GeV}$）：$\\left[1,\\,2,\\,5,\\,10,\\,20,\\,50,\\,100\\right]$。\n- 观测到的反质子微分通量（单位 $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\\,\\mathrm{sr}^{-1}\\,\\mathrm{GeV}^{-1}$）：\n$\\left[2.0\\times 10^{-2},\\,1.5\\times 10^{-2},\\,8.0\\times 10^{-3},\\,3.5\\times 10^{-3},\\,1.5\\times 10^{-3},\\,4.0\\times 10^{-4},\\,1.5\\times 10^{-4}\\right]$。\n- 统计不确定性（绝对值，与通量单位相同）：\n$\\left[1.0\\times 10^{-3},\\,7.5\\times 10^{-4},\\,4.0\\times 10^{-4},\\,2.0\\times 10^{-4},\\,1.0\\times 10^{-4},\\,5.0\\times 10^{-5},\\,3.0\\times 10^{-5}\\right]$。\n- 系统分数不确定性 $f_{\\mathrm{sys}} = 0.10$，因此系统绝对不确定性向量是 $f_{\\mathrm{sys}}\\times$ 观测通量。使用相关系数 $\\rho = 0.5$ 的相关系统不确定性（跨分箱）。\n\n测试集（每个案例是一个参数元组，顺序为 $\\left(m_\\chi,\\,\\langle \\sigma v \\rangle,\\,K_0,\\,\\delta,\\,L,\\,V_c,\\,\\phi\\right)$）：\n- 案例 1（基准，中等调制）：$\\left(100\\,\\mathrm{GeV},\\,3.0\\times 10^{-26}\\,\\mathrm{cm}^3/\\mathrm{s},\\,0.05\\,\\mathrm{kpc}^2/\\mathrm{Myr},\\,0.4,\\,5\\,\\mathrm{kpc},\\,10\\,\\mathrm{km/s},\\,0.5\\,\\mathrm{GV}\\right)$。\n- 案例 2（更强的湮灭，可能被排除）：$\\left(50\\,\\mathrm{GeV},\\,3.0\\times 10^{-25}\\,\\mathrm{cm}^3/\\mathrm{s},\\,0.05\\,\\mathrm{kpc}^2/\\mathrm{Myr},\\,0.4,\\,5\\,\\mathrm{kpc},\\,10\\,\\mathrm{km/s},\\,0.5\\,\\mathrm{GV}\\right)$。\n- 案例 3（重暗物质，更强的对流，更弱的调制）：$\\left(500\\,\\mathrm{GeV},\\,3.0\\times 10^{-26}\\,\\mathrm{cm}^3/\\mathrm{s},\\,0.05\\,\\mathrm{kpc}^2/\\mathrm{Myr},\\,0.4,\\,5\\,\\mathrm{kpc},\\,20\\,\\mathrm{km/s},\\,0.2\\,\\mathrm{GV}\\right)$。\n- 案例 4（更小的晕，无对流，无调制，更小的湮灭）：$\\left(80\\,\\mathrm{GeV},\\,1.0\\times 10^{-26}\\,\\mathrm{cm}^3/\\mathrm{s},\\,0.03\\,\\mathrm{kpc}^2/\\mathrm{Myr},\\,0.33,\\,3\\,\\mathrm{kpc},\\,0\\,\\mathrm{km/s},\\,0.0\\,\\mathrm{GV}\\right)$。\n\n额外的固定输入：\n- 气体数密度 $n_{\\mathrm{gas}} = 1.0\\,\\mathrm{cm}^{-3}$。\n- 反质子非弹性散射截面 $\\sigma_{\\mathrm{ann}} = 50\\,\\mathrm{mb}$。\n\n计算任务：\n- 实现物理上一致的单位转换，以确保预测通量以 $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\\,\\mathrm{sr}^{-1}\\,\\mathrm{GeV}^{-1}$ 表示。\n- 对于每个测试案例，计算指定能量分箱上的预测通量 $\\boldsymbol{\\Phi}_{\\mathrm{TOA}}$，使用统计和系统不确定性及相关系数 $\\rho$ 构建协方差矩阵 $\\mathbf{C}$，计算 $\\chi^2$，并使用自由度等于分箱数的卡方分布返回卡方生存函数的 p 值。\n- 每个测试案例的最终结果是 p 值，一个浮点数；汇总所有案例的 p 值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按测试案例的顺序列出结果，每个 p 值四舍五入到六位小数（例如，$\\left[0.123456,0.654321,0.000001,1.000000\\right]$）。\n\n角度规范：\n- 无需角度输入；立体角仅在通量单位中以 $\\mathrm{sr}$ 的形式隐式出现。\n\n您必须确保内部报告的每个计算通量都以 $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\\,\\mathrm{sr}^{-1}\\,\\mathrm{GeV}^{-1}$ 为单位。所有动能必须以 $\\mathrm{GeV}$ 为单位，太阳调制势必须以 $\\mathrm{GV}$ 为单位。反质子产额模型必须强制当 $T  m_\\chi$ 时，$dN_{\\bar{p}}/dT = 0$。", "solution": "用户提供了一个在计算天体粒子物理学领域中科学合理且定义明确的问题。任务是模拟暗物质湮灭产生的反质子通量，考虑银河系输运和太阳调制，并使用卡方统计检验将所得预测结果与 AMS-02 实验数据进行比较。该问题经验证是有效的，因为它包含了执行计算所需的所有物理公式、参数、常数和实验数据。所选模型是该领域使用的标准简化表示，并且参数值在物理上合理的范围内。\n\n解决方案首先建立理论和统计框架，然后概述计算实现。所有数学量都按要求使用 LaTeX 表示。\n\n### 理论和统计框架\n\n问题的核心是，对于一组给定的模型参数，计算预测的大气层顶 (TOA) 反质子通量 $\\Phi_{\\mathrm{TOA}}(T)$，并将其与特定动能 $T$ 下的观测数据进行比较。\n\n**1. 反质子的产生与输运**\n\n单位动能下的反质子稳态数密度 $N(T)$ 由产生和损失机制之间的平衡决定。在简化的有效时间近似中，这由下式给出：\n$$\nN(T) = q(T) \\cdot \\tau_{\\mathrm{eff}}(T)\n$$\n其中 $q(T)$ 是源项（单位体积、单位能量的产生率），$\\tau_{\\mathrm{eff}}(T)$ 是反质子在银河盘中的有效停留时间。\n\n来自暗物质 (DM) 湮灭的源项 $q(T)$ 为：\n$$\nq(T) = \\frac{1}{2} \\langle \\sigma v \\rangle \\left(\\frac{\\rho_0}{m_\\chi}\\right)^2 \\frac{dN_{\\bar{p}}}{dT}(T)\n$$\n此处，$\\langle \\sigma v \\rangle$ 是速度平均的 DM 湮灭截面，$m_\\chi$ 是 DM 粒子质量，$\\rho_0$ 是局域 DM 密度。对于自共轭 DM 粒子，适用因子 $\\frac{1}{2}$。项 $\\frac{dN_{\\bar{p}}}{dT}(T)$ 是每次湮灭的微分反质子产额。该产额通过变量 $x = T/m_\\chi$ 中的归一化 Beta 函数分布进行建模：\n$$\n\\frac{dN_{\\bar{p}}}{dT}(T) = \\frac{N_{\\bar{p}}}{m_\\chi B(p+1, q+1)} x^p (1-x)^q, \\quad \\text{for } T \\le m_\\chi\n$$\n其中 $p=1.5$，$q=4$，总重数为 $N_{\\bar{p}}=1$，$B(p+1, q+1)$ 是确保归一化的欧拉 Beta 函数，即 $\\int_0^{m_\\chi} \\frac{dN_{\\bar{p}}}{dT} dT = N_{\\bar{p}}$。对于 $T  m_\\chi$，产额为零。\n\n有效停留时间 $\\tau_{\\mathrm{eff}}(T)$ 通过调和求和的方式组合了扩散、对流和湮灭的时标：\n$$\n\\tau_{\\mathrm{eff}}(T)^{-1} = \\tau_{\\mathrm{diff}}(T)^{-1} + \\tau_{\\mathrm{conv}}^{-1} + \\tau_{\\mathrm{ann}}(T)^{-1}\n$$\n各个时标定义如下：\n- **扩散时间：** $\\tau_{\\mathrm{diff}}(T) = L^2 / K(T)$，其中 $L$ 是扩散晕的半高。扩散系数 $K(T)$ 取决于反质子的速度 $v(T) = \\beta(T)c$ 和刚度 $R(T)$：\n$$\nK(T) = K_0\\,\\beta(T)\\left(\\frac{R(T)}{1\\,\\mathrm{GV}}\\right)^{\\delta}\n$$\n反质子的刚度（对于电荷大小 $|Z|=1$）在数值上等于其以 $\\mathrm{GeV/c}$ 为单位的动量，$R(T)[\\mathrm{GV}] = p(T)[\\mathrm{GeV/c}]$，由 $p(T) = \\sqrt{T(T+2m_p)}$ 给出。速度因子为 $\\beta(T) = v(T)/c = p(T)/E(T) = \\sqrt{T(T+2m_p)}/(T+m_p)$。\n- **对流时间：** $\\tau_{\\mathrm{conv}} = L/V_c$，其中 $V_c$ 是恒定的对流风速。如果 $V_c=0$，则此时标为无穷大，其倒数为零。\n- **湮灭时间：** $\\tau_{\\mathrm{ann}}(T) = (n_{\\mathrm{gas}}\\sigma_{\\mathrm{ann}}v(T))^{-1}$，表示反质子通过与数密度为 $n_{\\mathrm{gas}}$ 的星际气体发生非弹性相互作用而造成的灾变性损失。$\\sigma_{\\mathrm{ann}}$ 是相应的截面。\n\n**2. 星际和大气层顶通量**\n\n对于各向同性分布，微分星际 (IS) 通量与数密度的关系如下：\n$$\n\\Phi_{\\mathrm{IS}}(T) = \\frac{v(T)}{4\\pi} N(T)\n$$\n为了到达地球附近的探测器，这些宇宙线必须穿过太阳系的日球层，日球层会调制它们的能量和通量。使用力场近似，动能为 $T$ 时的大气层顶 (TOA) 通量 $\\Phi_{\\mathrm{TOA}}$ 与更高能量 $T_{\\mathrm{IS}}$ 处的星际 (IS) 通量相关联：\n$$\nT_{\\mathrm{IS}} = T + |Z| \\phi\n$$\n$$\n\\Phi_{\\mathrm{TOA}}(T) = \\Phi_{\\mathrm{IS}}(T_{\\mathrm{IS}}) \\times \\frac{T(T+2m_p)}{T_{\\mathrm{IS}}(T_{\\mathrm{IS}}+2m_p)}\n$$\n其中 $\\phi$ 是以 $\\mathrm{GV}$ 为单位的太阳调制势，对于反质子 $|Z|=1$。如果所需的 $T_{\\mathrm{IS}}$ 超过运动学极限 $m_\\chi$，则源通量 $\\Phi_{\\mathrm{IS}}(T_{\\mathrm{IS}})$ 为零。\n\n**3. 与 AMS-02 数据的统计比较**\n\n该模型与来自 AMS-02 实验的 $N_{bins}$ 个分箱测量值进行检验。拟合优度通过卡方 ($\\chi^2$) 统计量来量化。首先，构建残差向量 $\\mathbf{r}$：\n$$\n\\mathbf{r} = \\boldsymbol{\\Phi}_{\\mathrm{model}} - \\boldsymbol{\\Phi}_{\\mathrm{obs}}\n$$\n其中 $\\boldsymbol{\\Phi}_{\\mathrm{model}}$ 和 $\\boldsymbol{\\Phi}_{\\mathrm{obs}}$ 是在指定能量分箱处的预测通量和观测通量向量。\n\n$\\chi^2$ 的计算公式为：\n$$\n\\chi^2 = \\mathbf{r}^\\top \\mathbf{C}^{-1} \\mathbf{r}\n$$\n协方差矩阵 $\\mathbf{C}$ 包含了不相关的统计不确定性和相关的系统不确定性：\n$$\n\\mathbf{C} = \\mathrm{diag}(\\boldsymbol{\\sigma}_{\\mathrm{stat}}^2) + \\rho\\,\\boldsymbol{\\sigma}_{\\mathrm{sys}}\\,\\boldsymbol{\\sigma}_{\\mathrm{sys}}^\\top\n$$\n此处，$\\boldsymbol{\\sigma}_{\\mathrm{stat}}$ 是绝对统计不确定性向量，$\\boldsymbol{\\sigma}_{\\mathrm{sys}}$ 是绝对系统不确定性向量（计算为 $f_{\\mathrm{sys}} \\times \\boldsymbol{\\Phi}_{\\mathrm{obs}}$），$\\rho$ 是所有能量分箱上系统效应的相关系数。项 $\\boldsymbol{\\sigma}_{\\mathrm{sys}}\\,\\boldsymbol{\\sigma}_{\\mathrm{sys}}^\\top$ 表示外积。\n\n最后，模型与数据的一致性表示为 p 值，该 p 值由自由度 (dof) 等于分箱数 $N_{bins}$ 的 $\\chi^2$ 分布的 $\\chi^2$ 生存函数（上尾概率）得出。\n$$\np = \\int_{\\chi^2}^{\\infty} f(x; \\text{dof}) \\, dx\n$$\n\n### 计算实现\n\n该算法在一个 Python 脚本中实现。所有输入参数首先在内部转换为一套一致的国际单位制 (SI) 单位（$\\mathrm{m}$, $\\mathrm{kg}$, $\\mathrm{s}$），能量单位保持为 $\\mathrm{GeV}$，以确保正确性。\n\n主要计算过程如下：\n1.  **初始化**：定义所有物理常数、AMS-02 数据（能量分箱、观测通量、统计不确定性）和测试案例参数。\n2.  **单位转换**：对每个测试案例，将输入参数（$\\langle \\sigma v \\rangle, K_0, L, V_c$）和固定输入（$n_{\\mathrm{gas}}, \\sigma_{\\mathrm{ann}}, \\rho_0$）转换为基本单位系统。\n3.  **模型通量计算**：对于 AMS-02 数据中的每个能量分箱 $T_{\\mathrm{TOA}, i}$：\n    a.  计算相应的星际能量 $T_{\\mathrm{IS}, i} = T_{\\mathrm{TOA}, i} + \\phi$。\n    b.  如果 $T_{\\mathrm{IS}, i}  m_\\chi$，通量 $\\Phi_{\\mathrm{TOA}, i}$ 为 $0$。\n    c.  否则，在 $T_{\\mathrm{IS}, i}$ 处计算所有依赖能量的量（$\\beta, R, K, dN_{\\bar{p}}/dT, \\tau_{\\mathrm{eff}}$）。\n    d.  组合这些分量以计算 $\\Phi_{\\mathrm{IS}}(T_{\\mathrm{IS}, i})$。\n    e.  应用太阳调制变换得到 $\\Phi_{\\mathrm{TOA}}(T_{\\mathrm{TOA}, i})$。\n    这将填充模型通量向量 $\\boldsymbol{\\Phi}_{\\mathrm{model}}$。\n4.  **统计检验**：\n    a.  构建系统不确定性向量 $\\boldsymbol{\\sigma}_{\\mathrm{sys}}$。\n    b.  从 $\\boldsymbol{\\sigma}_{\\mathrm{stat}}$、$\\boldsymbol{\\sigma}_{\\mathrm{sys}}$ 和 $\\rho$ 构建协方差矩阵 $\\mathbf{C}$。\n    c.  计算逆协方差矩阵 $\\mathbf{C}^{-1}$。\n    d.  计算残差向量 $\\mathbf{r}$ 和 $\\chi^2$ 值。\n    e.  使用自由度等于分箱数（$7$）的卡方生存函数计算 p 值。\n5.  **输出**：将所有测试案例计算出的 p 值收集起来，并按规定格式化为单个字符串。\n\n使用 `scipy` 库进行 Beta 函数（`scipy.special.beta`）和卡方生存函数（`scipy.stats.chi2.sf`）的计算，而 `numpy` 用于高效的数组操作、线性代数（矩阵求逆）和外积。", "answer": "[0.781682,0.000003,0.999976,0.957642]", "id": "3534007"}, {"introduction": "除了间接探测，方向性直接探测为检验暗物质的性质提供了另一种独特的途径。本练习将焦点转移到模拟真实的探测器效应，这是一个在实验分析中至关重要的环节。你将通过编码实现一个模拟，探究在低压气体时间投影室中，径迹扩散和头尾模糊性等实验限制如何影响区分不同暗物质相互作用模型的能力 [@problem_id:3534014]。", "problem": "一个低压四氟化碳时间投影室 ($\\text{CF}_4$ TPC) 用于测量暗物质 (DM) 与靶核发生弹性散射所引起的核反冲方向。在非相对论性有效场论的基础上，考虑两种基准的暗物质-核子相互作用算符：$\\mathcal{O}_1$（自旋无关主导算符）和 $\\mathcal{O}_8$（速度垂直耦合）。在方向性探测中，来自麦克斯韦分布的银河系晕的弹性散射会导致各向异性的反冲方向。对于 $\\mathcal{O}_1$，其反冲方向在一阶近似下可由一个围绕暗物质风向的轴对称分布来描述；对于 $\\mathcal{O}_8$，则可由一个环状分布来描述。在 $\\text{CF}_4$ TPC 中进行实际重建会引入两种主要的性能退化：有限的径迹扩散（角度弥散）和头尾方向不确定性（径迹方向反转），这些都会降低算符的区分能力。\n\n从基本概率定义和单位球面上的归一化出发，推导并实现以下的模拟和似然比检验，过程中需遵循概率公理以及每个概率密度在球面积分后必须为1的要求：\n\n1. 模型假设：\n   - 设实验室暗物质风向为 $+\\hat{z}$ 轴。真实的反冲方向是一个单位向量 $\\mathbf{x} \\in S^2$，在球坐标中由极角 $\\theta \\in [0,\\pi]$ 和方位角 $\\phi \\in [0,2\\pi)$ 表示，球面上的曲面元为 $\\mathrm{d}\\Omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$。\n   - 对于 $\\mathcal{O}_1$，将其真实方向分布近似为一个在 $S^2$ 上的轴对称 von Mises–Fisher 分布，其集中参数为 $\\kappa_1  0$，平均方向为 $+\\hat{z}$。您必须推导出在 $S^2$ 上正确归一化的三维密度 $f_1(\\mathbf{x}\\,;\\kappa_1)$。\n   - 对于 $\\mathcal{O}_8$，将其真实方向分布近似为一个以极角 $\\theta_0 \\in (0,\\pi)$ 为中心、宽度为 $\\sigma_{\\mathrm{ring}}  0$ 的轴对称环。其三维密度与 $\\phi$ 无关，且对 $\\theta$ 的依赖性通过一个关于 $\\theta$ 的高斯函数来体现。您必须推导出在 $S^2$ 上正确归一化的三维密度 $f_8(\\theta\\,;\\theta_0,\\sigma_{\\mathrm{ring}})$，该密度关于 $\\mathrm{d}\\Omega$ 的积分为1。\n   - 有限扩散被建模为对真实单位向量 $\\mathbf{x}$ 的一个角度扰动，该扰动通过一个角度为 $\\alpha \\sim \\mathcal{N}(0,\\sigma_{\\mathrm{diff}}^2)$ 的无穷小随机旋转实现，旋转轴是一个与 $\\mathbf{x}$ 正交的随机轴，最终产生一个测量到的单位向量 $\\tilde{\\mathbf{x}}$。头尾方向不确定性被建模为对测量方向的翻转，即 $\\tilde{\\mathbf{x}} \\mapsto -\\tilde{\\mathbf{x}}$，此过程对每个事件独立发生，概率为 $p_{\\mathrm{flip}} \\in [0,1]$。\n   - 角度必须以弧度处理和报告。\n\n2. 似然比检验：\n   - 给定一组测量到的单位向量 $\\{\\tilde{\\mathbf{x}}_i\\}_{i=1}^N$，定义对数似然比统计量\n     $$S = \\sum_{i=1}^{N} \\ln \\frac{f_1(\\tilde{\\mathbf{x}}_i\\,;\\kappa_1)}{f_8(\\tilde{\\theta}_i\\,;\\theta_0,\\sigma_{\\mathrm{ring}})},$$\n     其中 $\\tilde{\\theta}_i$ 是 $\\tilde{\\mathbf{x}}_i$ 相对于 $+\\hat{z}$ 的极角。使用分类规则：如果 $S  0$，则判定为 $\\mathcal{O}_1$；如果 $S \\le 0$，则判定为 $\\mathcal{O}_8$。\n\n3. 模拟任务：\n   - 对每个测试用例，模拟 $M$ 个独立的伪实验。在每个伪实验中：\n     - 从真实算符的方向分布（$\\mathcal{O}_1$ 或 $\\mathcal{O}_8$）中抽取 $N$ 个真实反冲方向 $\\{\\mathbf{x}_i\\}$。\n     - 对每个 $\\mathbf{x}_i$ 应用扩散效应，即围绕一个与 $\\mathbf{x}_i$ 正交的随机轴进行角度为 $\\alpha \\sim \\mathcal{N}(0,\\sigma_{\\mathrm{diff}}^2)$ 的无穷小随机旋转，从而产生 $\\tilde{\\mathbf{x}}_i$。\n     - 以概率 $p_{\\mathrm{flip}}$ 独立地将 $\\tilde{\\mathbf{x}}_i$ 翻转为 $-\\tilde{\\mathbf{x}}_i$。\n     - 计算对数似然比 $S$，并记录在真实算符下分类是否正确。\n   - 对每个测试用例，报告分类准确率，其值为一个等于被正确分类的伪实验所占比例的单个浮点数。\n\n4. 单位和数值要求：\n   - 所有角度（$\\theta$, $\\phi$, $\\theta_0$, $\\sigma_{\\mathrm{ring}}$, $\\sigma_{\\mathrm{diff}}$）必须使用弧度。\n   - 输出值必须是 $[0,1]$ 范围内的浮点数。\n   - 您的程序必须产生四舍五入到 $6$ 位小数的结果。\n\n5. 测试套件：\n   - 使用以下测试用例，每个用例由 $(N, M, \\kappa_1, \\theta_0, \\sigma_{\\mathrm{ring}}, \\sigma_{\\mathrm{diff}}, p_{\\mathrm{flip}}, \\text{true\\_operator})$ 指定，其中 $\\text{true\\_operator} \\in \\{1,8\\}$ 指定生成数据的算符：\n     - 用例 $1$：$(N,M,\\kappa_1,\\theta_0,\\sigma_{\\mathrm{ring}},\\sigma_{\\mathrm{diff}},p_{\\mathrm{flip}},\\text{true\\_operator}) = (200,200,6.0,1.20,0.30,0.20,0.10,1)$。\n     - 用例 $2$（边界情况，无扩散且完美的头尾识别）：$(200,200,6.0,1.20,0.30,0.00,0.00,1)$。\n     - 用例 $3$（高扩散，中等头尾识别）：$(200,200,6.0,1.20,0.30,0.70,0.30,1)$。\n     - 用例 $4$（极端头尾不确定性）：$(200,200,6.0,1.20,0.30,0.20,0.50,1)$。\n     - 用例 $5$（真实算符为 $\\mathcal{O}_8$）：$(200,200,6.0,1.20,0.30,0.20,0.10,8)$。\n\n6. 最终输出格式：\n   - 您的程序应产生单行输出，其中包含一个由方括号括起来的逗号分隔列表，按用例 $1$ 到 $5$ 的顺序排列。例如，格式必须是 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$，每个 $\\text{result}_i$ 都四舍五入到 $6$ 位小数。\n\n您必须通过推导和使用在 $S^2$ 上正确归一化的密度来确保科学真实性，从这些密度中抽样以产生 $\\mathbf{x}_i$，按规定应用扩散和头尾不确定性，并基于您推导的 $f_1$ 和 $f_8$ 计算对数似然比。角度必须使用弧度。不得使用外部数据。最终输出必须遵循上述指定的单行格式。", "solution": "该问题具有科学依据，提法明确，并为完整的模拟提供了所有必要的参数和定义。它要求推导和实现球面上的概率分布，从这些分布中抽样，模拟探测器效应，并使用对数似然比进行假设检验。该问题是有效的，我将着手提供一个完整的解决方案。\n\n解决方案包括三个主要阶段：\n1.  为两种暗物质信号假设 $\\mathcal{O}_1$ 和 $\\mathcal{O}_8$ 推导归一化的概率密度函数 (PDF)。\n2.  实现蒙特卡洛模拟以生成事件样本，包括对实验效应的建模。\n3.  对模拟数据执行对数似然比检验，以确定分类准确率。\n\n**1. 概率密度函数**\n\n单位球面 $S^2$ 上的曲面元为 $\\mathrm{d}\\Omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$，其中 $\\theta \\in [0,\\pi]$ 是极角，$\\phi \\in [0,2\\pi)$ 是方位角。球面上的任何概率密度函数 (PDF) $f(\\mathbf{x})$ 都必须满足归一化条件 $\\int_{S^2} f(\\mathbf{x})\\,\\mathrm{d}\\Omega = 1$。暗物质风向与 $+\\hat{z}$ 轴对齐。\n\n**1.1. $\\mathcal{O}_1$ 信号模型：von Mises-Fisher 分布**\n$\\mathcal{O}_1$ 算符的方向分布由 von Mises-Fisher (vMF) 分布建模。$S^2$ 上 vMF 分布的一般 PDF 由 $f(\\mathbf{x} | \\boldsymbol{\\mu}, \\kappa) = C(\\kappa) e^{\\kappa \\boldsymbol{\\mu} \\cdot \\mathbf{x}}$ 给出，其中 $\\boldsymbol{\\mu}$ 是平均方向，$\\kappa$ 是集中参数。\n\n在这个问题中，平均方向是 $\\boldsymbol{\\mu} = \\hat{z} = (0,0,1)$。对于一个极角为 $\\theta$ 的反冲方向向量 $\\mathbf{x}$，点积为 $\\boldsymbol{\\mu} \\cdot \\mathbf{x} = \\hat{z} \\cdot \\mathbf{x} = \\cos\\theta$。因此，PDF 与方位角 $\\phi$ 无关，可以写成 $f_1(\\theta; \\kappa_1) = C_1 e^{\\kappa_1 \\cos\\theta}$。\n\n为了找到归一化常数 $C_1$，我们在球面上进行积分：\n$$ \\int_{S^2} C_1 e^{\\kappa_1 \\cos\\theta} \\mathrm{d}\\Omega = \\int_0^{2\\pi} \\mathrm{d}\\phi \\int_0^{\\pi} C_1 e^{\\kappa_1 \\cos\\theta} \\sin\\theta\\,\\mathrm{d}\\theta = 1 $$\n对 $\\phi$ 的积分得到 $2\\pi$。对 $\\theta$ 的积分可以通过换元法 $u = \\cos\\theta$, $\\mathrm{d}u = -\\sin\\theta\\,\\mathrm{d}\\theta$ 来求解：\n$$ 2\\pi C_1 \\int_{-1}^{1} e^{\\kappa_1 u} \\mathrm{d}u = 2\\pi C_1 \\left[ \\frac{e^{\\kappa_1 u}}{\\kappa_1} \\right]_{-1}^{1} = 2\\pi C_1 \\frac{e^{\\kappa_1} - e^{-\\kappa_1}}{\\kappa_1} = 2\\pi C_1 \\frac{2\\sinh(\\kappa_1)}{\\kappa_1} $$\n令其等于 $1$ 得到归一化常数：\n$$ C_1 = \\frac{\\kappa_1}{4\\pi\\sinh(\\kappa_1)} $$\n因此，$\\mathcal{O}_1$ 假设的归一化 PDF 为：\n$$ f_1(\\mathbf{x}; \\kappa_1) = \\frac{\\kappa_1}{4\\pi\\sinh(\\kappa_1)} e^{\\kappa_1 (\\mathbf{x} \\cdot \\hat{z})} = \\frac{\\kappa_1}{4\\pi\\sinh(\\kappa_1)} e^{\\kappa_1 \\cos\\theta} $$\n\n**1.2. $\\mathcal{O}_8$ 信号模型：环状分布**\n$\\mathcal{O}_8$ 算符的方向分布被建模为一个环状结构，它与 $\\phi$ 无关，在极角 $\\theta$ 上具有以 $\\theta_0$ 为中心、宽度为 $\\sigma_{\\mathrm{ring}}$ 的高斯轮廓。未归一化的密度正比于 $e^{-(\\theta - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)}$。设归一化的 PDF 为 $f_8(\\theta; \\theta_0, \\sigma_{\\mathrm{ring}}) = C_8 e^{-(\\theta - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)}$。\n\n我们通过在球面上积分来找到归一化常数 $C_8$：\n$$ \\int_{S^2} C_8 e^{-(\\theta - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)} \\mathrm{d}\\Omega = \\int_0^{2\\pi} \\mathrm{d}\\phi \\int_0^{\\pi} C_8 e^{-(\\theta - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)} \\sin\\theta\\,\\mathrm{d}\\theta = 1 $$\n对 $\\phi$ 的积分得到 $2\\pi$。剩下关于 $\\theta$ 的积分没有简单的解析闭式解，必须进行数值计算。设该积分为 $I_8^{int}$：\n$$ I_8^{int}(\\theta_0, \\sigma_{\\mathrm{ring}}) = \\int_0^{\\pi} e^{-(\\theta' - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)} \\sin\\theta' \\,\\mathrm{d}\\theta' $$\n则归一化常数为 $C_8 = (2\\pi I_8^{int})^{-1}$。$\\mathcal{O}_8$ 假设的最终 PDF 为：\n$$ f_8(\\theta; \\theta_0, \\sigma_{\\mathrm{ring}}) = \\frac{e^{-(\\theta - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)}}{2\\pi \\int_0^{\\pi} e^{-(\\theta' - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)} \\sin\\theta' \\,\\mathrm{d}\\theta'} $$\n\n**2. 蒙特卡洛模拟**\n\n模拟通过生成 $M$ 个伪实验来进行，每个伪实验包含 $N$ 个事件。\n\n**2.1. 事件抽样**\n- **从 $f_1$ 抽样**：我们对极角使用逆变换采样法。对于 $u = \\cos\\theta$，其 PDF 为 $p(u) \\propto e^{\\kappa_1 u}$，其中 $u \\in [-1, 1]$。累积分布函数 (CDF) 为 $F(u) = (e^{\\kappa_1 u} - e^{-\\kappa_1}) / (e^{\\kappa_1} - e^{-\\kappa_1})$。将 $F(u)$ 等于一个均匀分布的随机变量 $y \\in [0,1]$，解出 $u$ 得到 $u = \\frac{1}{\\kappa_1} \\ln(e^{-\\kappa_1} + y(e^{\\kappa_1} - e^{-\\kappa_1}))$。极角为 $\\theta = \\arccos(u)$。方位角 $\\phi$ 从 $[0, 2\\pi)$ 中均匀抽样。\n\n- **从 $f_8$ 抽样**：我们对极角 $\\theta$ 使用拒绝采样法。$\\theta$ 的目标 PDF 为 $p(\\theta) \\propto h(\\theta) = e^{-(\\theta - \\theta_0)^2 / (2\\sigma_{\\mathrm{ring}}^2)} \\sin\\theta$，定义在 $[0, \\pi]$ 上。我们使用 $[0, \\pi]$ 上的均匀提议分布 $g(\\theta) = 1/\\pi$。算法如下：\n    1.  数值求解 $h(\\theta)$ 在 $[0, \\pi]$ 上的最大值 $h_{max}$。\n    2.  从 $U(0, \\pi)$ 中抽取一个候选值 $\\theta_{cand}$。\n    3.  从 $U(0, 1)$ 中抽取一个随机变量 $v$。\n    4.  如果 $v \\cdot h_{max} \\le h(\\theta_{cand})$，则接受 $\\theta_{cand}$。否则，从步骤2开始重复。\n方位角 $\\phi$ 从 $[0, 2\\pi)$ 中均匀抽样。\n\n从抽样得到的 $(\\theta, \\phi)$，构建真实的反冲向量：$\\mathbf{x} = (\\sin\\theta\\cos\\phi, \\sin\\theta\\sin\\phi, \\cos\\theta)$。\n\n**2.2. 仪器效应**\n1.  **扩散**：真实向量 $\\mathbf{x}$ 被旋转到测量向量 $\\tilde{\\mathbf{x}}$。旋转角度 $\\alpha$ 从正态分布 $\\mathcal{N}(0, \\sigma_{\\mathrm{diff}}^2)$ 中抽样，旋转轴 $\\mathbf{k}$ 是一个与 $\\mathbf{x}$ 正交的随机轴。轴 $\\mathbf{k}$ 通过将 $\\mathbf{x}$ 与一个随机各向同性向量做叉积并归一化来生成。旋转使用罗德里格斯旋转公式 (Rodrigues' rotation formula) 应用：\n    $$ \\tilde{\\mathbf{x}} = \\mathbf{x} \\cos\\alpha + (\\mathbf{k} \\times \\mathbf{x}) \\sin\\alpha $$\n    因为 $\\mathbf{k} \\cdot \\mathbf{x} = 0$。\n\n2.  **头尾翻转**：对于每个测量向量 $\\tilde{\\mathbf{x}}_i$，抽取一个随机数 $u_i \\in [0,1]$。如果 $u_i  p_{\\mathrm{flip}}$，则该向量被反转：$\\tilde{\\mathbf{x}}_i \\mapsto -\\tilde{\\mathbf{x}}_i$。\n\n**3. 似然比检验与分类**\n\n对于每个伪实验，会生成一组 $N$ 个测量向量 $\\{\\tilde{\\mathbf{x}}_i\\}_{i=1}^N$。计算对数似然比统计量 $S$：\n$$ S = \\sum_{i=1}^{N} \\ln \\frac{f_1(\\tilde{\\mathbf{x}}_i\\,;\\kappa_1)}{f_8(\\tilde{\\theta}_i\\,;\\theta_0,\\sigma_{\\mathrm{ring}})} $$\n其中 $\\tilde{\\theta}_i = \\arccos(\\tilde{\\mathbf{x}}_i \\cdot \\hat{z})$ 是测量向量 $\\tilde{\\mathbf{x}}_i$ 的极角。代入推导出的 PDF：\n$$ S = \\sum_{i=1}^{N} \\left[ \\ln\\left(\\frac{\\kappa_1 C_8}{2\\pi C_1}\\right) + \\kappa_1 \\cos\\tilde{\\theta}_i + \\frac{(\\tilde{\\theta}_i - \\theta_0)^2}{2\\sigma_{\\mathrm{ring}}^2} \\right] $$\n其中 $C_1 = (2\\pi \\sinh(\\kappa_1))^{-1}$ 是 vMF 归一化中与角度积分无关的部分，而 $C_8 = (I_8^{int})^{-1}$ 来自环状分布。\n一个更实用的形式是：\n$$ S = \\sum_{i=1}^{N} \\left( \\ln\\left(\\frac{\\kappa_1}{4\\pi\\sinh(\\kappa_1)}\\right) - \\ln\\left(\\frac{1}{2\\pi I_8^{int}}\\right) + \\kappa_1 \\cos\\tilde{\\theta}_i + \\frac{(\\tilde{\\theta}_i - \\theta_0)^2}{2\\sigma_{\\mathrm{ring}}^2} \\right) $$\n\n分类规则是：\n-   如果 $S  0$，伪实验被分类为 $\\mathcal{O}_1$。\n-   如果 $S \\le 0$，伪实验被分类为 $\\mathcal{O}_8$。\n\n对于给定的测试用例，分类准确率是指其分类结果与真实数据生成算符相匹配的伪实验在 $M$ 个总伪实验中所占的比例。", "answer": "[0.970000,1.000000,0.655000,0.520000,0.985000]", "id": "3534014"}]}