{"hands_on_practices": [{"introduction": "在计算高能物理中，许多可观测量的分布源于更基本的物理过程。这项练习将一个具体的物理场景（横动量分布）与一种基础的采样技术联系起来，要求您从第一性原理出发，推导出瑞利分布的概率密度函数（PDF）和累积分布函数（CDF），并实现核心的逆变换采样算法。通过这个实践，您将掌握从物理模型到可执行采样代码的关键技能，并学习如何通过统计检验来验证采样器的正确性。[@problem_id:3532740]", "problem": "您正在为一个对撞机事件中的各向同性软背景建模，其中，一条重建径迹的横向动量分量 $p_{x}$ 和 $p_{y}$ 被建模为均值为零、方差为 $\\sigma^{2}$ 的独立同分布高斯随机变量。在本练习中，将所有变量视为无量纲的。从独立高斯变量的联合密度和变量替换定理出发，推导出横向动量大小 $p_{T} = \\sqrt{p_{x}^{2} + p_{y}^{2}}$ 的分布。您的推导必须从独立高斯变量联合密度的基本定义以及变换到极坐标的雅可比行列式开始，不得使用任何预先给定的目标分布形式。然后，求出累积分布函数 (CDF) 并推导其逆函数，以便能从 $[0,1)$ 上的均匀分布通过逆变换采样来对 $p_{T}$ 进行采样。\n\n为 $p_{T}$ 实现两种采样器：\n- 通过变换高斯分量进行采样的采样器：独立地抽取 $p_{x} \\sim \\mathcal{N}(0,\\sigma^{2})$ 和 $p_{y} \\sim \\mathcal{N}(0,\\sigma^{2})$，然后返回 $p_{T}=\\sqrt{p_{x}^{2}+p_{y}^{2}}$。\n- 逆变换采样器：抽取 $U \\sim \\mathrm{Uniform}[0,1)$，并使用您推导出的逆累积分布函数 (CDF) 对 $U$ 进行变换。为保证在 $U \\approx 0$ 附近的数值稳定性，请使用基于 $\\log1p$ 的公式来实现，以避免灾难性抵消。\n\n使用以下具有固定种子和样本大小的测试套件。所有随机数生成必须使用带有固定种子的现代伪随机数生成器，以确保可复现性。\n\n参考定义：\n- $\\mathcal{N}(0,\\sigma^{2})$ 的概率密度函数 (PDF) 是 $f(x) = \\dfrac{1}{\\sqrt{2\\pi}\\sigma}\\exp\\!\\left(-\\dfrac{x^{2}}{2\\sigma^{2}}\\right)$。\n- 累积分布函数 (CDF) 是概率密度函数 (PDF) 从 $-\\infty$ 到其参数的积分。\n- 柯尔莫哥洛夫-斯米尔诺夫 (Kolmogorov–Smirnov, KS) 统计量是经验累积分布函数与理论累积分布函数之间绝对差的上确界；柯尔莫哥洛夫-斯米尔诺夫 (Kolmogorov–Smirnov, KS) 检验为拟合优度提供一个 $p$ 值。\n\n测试套件和要求输出：\n- 情况A（均值检查）：使用逆变换采样器，参数为 $\\sigma = 1.25$，样本大小为 $N = 2\\times 10^{5}$，种子为 $s_{1} = 123456$。计算经验均值 $\\hat{\\mu}$，并与所推导分布的理论均值 $\\mu_{\\mathrm{th}}$进行比较。输出一个布尔值，指示相对误差 $\\left|\\hat{\\mu}-\\mu_{\\mathrm{th}}\\right|/\\mu_{\\mathrm{th}}$ 是否小于 $\\epsilon_{\\mu} = 0.01$（以小数表示）。\n- 情况B（方差检查）：使用与情况A相同的样本，计算经验方差 $\\widehat{\\mathrm{Var}}$，并与理论方差 $\\mathrm{Var}_{\\mathrm{th}}$ 进行比较。输出一个布尔值，指示相对误差 $\\left|\\widehat{\\mathrm{Var}}-\\mathrm{Var}_{\\mathrm{th}}\\right|/\\mathrm{Var}_{\\mathrm{th}}$ 是否小于 $\\epsilon_{\\mathrm{var}} = 0.02$（以小数表示）。\n- 情况C（单样本 Kolmogorov–Smirnov 拟合优度检验）：使用与情况A相同的样本，计算原假设（即样本遵循给定 $\\sigma$ 的推导分布）的 Kolmogorov–Smirnov $p$ 值。将此 $p$ 值作为浮点数输出，保留 $6$ 位小数。\n- 情况D（逆变换数值稳定性）：对于 $\\sigma = 2.0$ 和均匀分布输入 $U \\in \\{0,\\;10^{-12},\\;0.5,\\;1-10^{-12}\\}$，计算逆变换采样器的输出，并将这四个值以浮点数列表的形式返回，每个值保留 $6$ 位小数，顺序与所列 $U$ 值相对应。\n- 情况E（双样本分布一致性）：设 $\\sigma = 0.8$，$N = 1.5\\times 10^{5}$。使用高斯分量法和种子 $s_{2} = 20231017$ 生成一个样本，并使用逆变换采样器和种子 $s_{3} = 424242$ 生成另一个独立样本。计算这两个样本之间的双样本 Kolmogorov–Smirnov 统计量。输出一个布尔值，指示该统计量是否小于 $\\delta = 0.02$（以小数表示）。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的条目按以下顺序排列：\n$[\\text{mean\\_ok},\\text{var\\_ok},\\text{ks\\_p\\_value},\\text{inverse\\_values},\\text{twosample\\_ok}]$，\n其中 $\\text{mean\\_ok}$、$\\text{var\\_ok}$ 和 $\\text{twosample\\_ok}$ 是布尔值；$\\text{ks\\_p\\_value}$ 是一个保留 $6$ 位小数的浮点数；而 $\\text{inverse\\_values}$ 是一个包含四个浮点数的列表，每个浮点数保留 $6$ 位小数。例如，一个语法正确的行应类似于 $[True,True,0.123456,[0.000000,1.234567,2.345678,9.876543],True]$（此处的数字仅为示例）。", "solution": "该问题要求推导横向动量大小 $p_{T}$ 的概率分布，然后实现并测试两种采样方法。推导过程必须从第一性原理开始。\n\n### 第一部分：$p_{T}$ 分布的推导\n\n给定横向动量分量 $p_x$ 和 $p_y$ 是来自均值为 $0$、方差为 $\\sigma^2$ 的高斯分布的独立同分布 (i.i.d.) 随机变量。对于这样一个变量（例如 $z$），其概率密度函数 (PDF) 为：\n$$\nf(z; \\sigma) = \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{z^2}{2\\sigma^2}\\right)\n$$\n由于 $p_x$ 和 $p_y$ 是独立的，它们的联合概率密度函数 $f(p_x, p_y)$ 是它们各自 PDF 的乘积：\n$$\nf(p_x, p_y) = f(p_x; \\sigma) f(p_y; \\sigma) = \\left(\\frac{1}{\\sqrt{2\\pi}\\sigma}\\right) \\exp\\left(-\\frac{p_x^2}{2\\sigma^2}\\right) \\left(\\frac{1}{\\sqrt{2\\pi}\\sigma}\\right) \\exp\\left(-\\frac{p_y^2}{2\\sigma^2}\\right)\n$$\n$$\nf(p_x, p_y) = \\frac{1}{2\\pi\\sigma^2} \\exp\\left(-\\frac{p_x^2 + p_y^2}{2\\sigma^2}\\right)\n$$\n横向动量大小定义为 $p_T = \\sqrt{p_x^2 + p_y^2}$。为了找到 $p_T$ 的分布，我们进行变量替换，从笛卡尔坐标 $(p_x, p_y)$ 变换到极坐标 $(p_T, \\theta)$，其中：\n$$\np_x = p_T \\cos\\theta\n$$\n$$\np_y = p_T \\sin\\theta\n$$\n变换范围是 $p_T \\in [0, \\infty)$ 和 $\\theta \\in [0, 2\\pi)$。根据变量替换定理，新的联合 PDF $g(p_T, \\theta)$ 与原始 PDF $f(p_x, p_y)$ 通过变换的雅可比行列式的绝对值 $|J|$ 相关联。\n$$\ng(p_T, \\theta) = f(p_x(p_T, \\theta), p_y(p_T, \\theta)) |J|\n$$\n雅可比行列式 $J$ 为：\n$$\nJ = \\det \\begin{pmatrix} \\frac{\\partial p_x}{\\partial p_T}  \\frac{\\partial p_x}{\\partial \\theta} \\\\ \\frac{\\partial p_y}{\\partial p_T}  \\frac{\\partial p_y}{\\partial \\theta} \\end{pmatrix} = \\det \\begin{pmatrix} \\cos\\theta  -p_T \\sin\\theta \\\\ \\sin\\theta  p_T \\cos\\theta \\end{pmatrix} = (p_T \\cos^2\\theta) - (-p_T \\sin^2\\theta) = p_T(\\cos^2\\theta + \\sin^2\\theta) = p_T\n$$\n由于 $p_T \\ge 0$，我们有 $|J| = p_T$。我们还注意到 $p_x^2 + p_y^2 = (p_T\\cos\\theta)^2 + (p_T\\sin\\theta)^2 = p_T^2$。将这些代入变换公式，得到 $p_T$ 和 $\\theta$ 的联合 PDF：\n$$\ng(p_T, \\theta) = \\frac{1}{2\\pi\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right) p_T\n$$\n为了找到 $p_T$ 的边际 PDF（我们记为 $h(p_T)$），我们将联合 PDF $g(p_T, \\theta)$ 对所有可能的 $\\theta$ 值进行积分：\n$$\nh(p_T) = \\int_0^{2\\pi} g(p_T, \\theta) \\,d\\theta = \\int_0^{2\\pi} \\frac{p_T}{2\\pi\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right) \\,d\\theta\n$$\n被积函数与 $\\theta$ 无关，因此我们有：\n$$\nh(p_T) = \\frac{p_T}{2\\pi\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right) \\int_0^{2\\pi} 1 \\,d\\theta = \\frac{p_T}{2\\pi\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right) [2\\pi]\n$$\n$$\nh(p_T) = \\frac{p_T}{\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right), \\quad \\text{for } p_T \\ge 0\n$$\n这是尺度参数为 $\\sigma$ 的瑞利分布的 PDF。\n\n### 第二部分：累积分布函数 (CDF) 和逆变换采样\n\nCDF $F(p_T)$ 是 PDF 从 $0$ 到某个值 $p_T$ 的积分：\n$$\nF(p_T) = \\int_0^{p_T} h(t) \\,dt = \\int_0^{p_T} \\frac{t}{\\sigma^2} \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right) \\,dt\n$$\n我们使用换元法，令 $u = \\frac{t^2}{2\\sigma^2}$，这意味着 $du = \\frac{2t}{2\\sigma^2} dt = \\frac{t}{\\sigma^2} dt$。积分上下限从 $t=0$ 变为 $u=0$，从 $t=p_T$ 变为 $u = p_T^2/(2\\sigma^2)$。\n$$\nF(p_T) = \\int_0^{p_T^2/(2\\sigma^2)} e^{-u} \\,du = \\left[-e^{-u}\\right]_0^{p_T^2/(2\\sigma^2)} = -e^{-p_T^2/(2\\sigma^2)} - (-e^0) = 1 - \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right)\n$$\n对于逆变换采样，我们将 CDF 等于一个从 $[0,1)$ 上的均匀分布中抽取的随机变量 $U$，即 $U = F(p_T)$，然后解出 $p_T$：\n$$\nU = 1 - \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right)\n$$\n$$\n1-U = \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right)\n$$\n$$\n\\ln(1-U) = -\\frac{p_T^2}{2\\sigma^2}\n$$\n$$\np_T^2 = -2\\sigma^2 \\ln(1-U)\n$$\n$$\np_T = \\sqrt{-2\\sigma^2 \\ln(1-U)}\n$$\n这就是逆 CDF，$p_T = F^{-1}(U)$。当 $U$ 接近 $0$ 时，为保证数值稳定性，计算 $\\ln(1-U)$ 可能会遭受灾难性抵消。我们使用函数 $\\mathrm{log1p}(x) = \\ln(1+x)$，该函数在实现上对小的 $|x|$ 值是精确的。我们可以将 $\\ln(1-U)$ 写为 $\\mathrm{log1p}(-U)$。数值稳定的公式是：\n$$\np_T = \\sqrt{-2\\sigma^2 \\mathrm{log1p}(-U)}\n$$\n\n### 第三部分：理论矩\n\n为了进行验证测试，我们需要瑞利分布的理论均值（$\\mu_{\\mathrm{th}}$）和方差（$\\mathrm{Var}_{\\mathrm{th}}$）。\n均值是 $p_T$ 的期望值：\n$$\n\\mu_{\\mathrm{th}} = E[p_T] = \\int_0^\\infty p_T h(p_T) \\,dp_T = \\int_0^\\infty \\frac{p_T^2}{\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right) \\,dp_T\n$$\n该积分计算结果为：\n$$\n\\mu_{\\mathrm{th}} = \\sigma \\sqrt{\\frac{\\pi}{2}}\n$$\n二阶矩是 $p_T^2$ 的期望值：\n$$\nE[p_T^2] = \\int_0^\\infty p_T^2 h(p_T) \\,dp_T = \\int_0^\\infty \\frac{p_T^3}{\\sigma^2} \\exp\\left(-\\frac{p_T^2}{2\\sigma^2}\\right) \\,dp_T\n$$\n该积分计算结果为：\n$$\nE[p_T^2] = 2\\sigma^2\n$$\n方差则由 $\\mathrm{Var}_{\\mathrm{th}} = E[p_T^2] - (E[p_T])^2$ 给出：\n$$\n\\mathrm{Var}_{\\mathrm{th}} = 2\\sigma^2 - \\left(\\sigma\\sqrt{\\frac{\\pi}{2}}\\right)^2 = 2\\sigma^2 - \\sigma^2 \\frac{\\pi}{2} = \\sigma^2\\left(2 - \\frac{\\pi}{2}\\right)\n$$\n这些公式将用于验证生成的样本。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef sampler_gauss_components(sigma, n_samples, rng):\n    \"\"\"\n    Generates pT samples by transforming Gaussian-distributed components.\n    p_x, p_y ~ N(0, sigma^2)\n    pT = sqrt(p_x^2 + p_y^2)\n    \"\"\"\n    px = rng.normal(loc=0.0, scale=sigma, size=n_samples)\n    py = rng.normal(loc=0.0, scale=sigma, size=n_samples)\n    return np.sqrt(px**2 + py**2)\n\ndef sampler_inverse_transform(sigma, n_samples, rng, u_values=None):\n    \"\"\"\n    Generates pT samples using inverse transform sampling from the derived CDF.\n    Uses log1p for numerical stability.\n    If u_values is provided, it transforms those instead of generating new ones.\n    \"\"\"\n    if u_values is None:\n        u_values = rng.uniform(low=0.0, high=1.0, size=n_samples)\n    \n    # The term np.log1p(-u_values) is equivalent to np.log(1-u_values) but\n    # provides higher precision for small u_values.\n    return np.sqrt(-2 * sigma**2 * np.log1p(-u_values))\n\ndef solve():\n    \"\"\"\n    Performs all derivations, implementations, and tests as specified in the problem.\n    \"\"\"\n    \n    results = []\n\n    # Case A, B, C setup\n    sigma_A = 1.25\n    N_A = 2 * 10**5\n    seed_1 = 123456\n    rng_A = np.random.default_rng(seed_1)\n    \n    # Generate one sample for cases A, B, C\n    samples_A = sampler_inverse_transform(sigma_A, N_A, rng_A)\n\n    # --- Case A: Mean Check ---\n    mu_th = sigma_A * np.sqrt(np.pi / 2.0)\n    mu_hat = np.mean(samples_A)\n    rel_error_mu = np.abs(mu_hat - mu_th) / mu_th\n    epsilon_mu = 0.01\n    mean_ok = rel_error_mu  epsilon_mu\n    \n    # --- Case B: Variance Check ---\n    var_th = sigma_A**2 * (2.0 - np.pi / 2.0)\n    var_hat = np.var(samples_A)\n    rel_error_var = np.abs(var_hat - var_th) / var_th\n    epsilon_var = 0.02\n    var_ok = rel_error_var  epsilon_var\n\n    # --- Case C: One-sample KS Goodness-of-Fit ---\n    # The derived distribution is a Rayleigh distribution with scale=sigma.\n    # We use scipy.stats.rayleigh for the theoretical CDF.\n    # The parameters for scipy.stats.rayleigh are (loc, scale).\n    _, ks_p_value = stats.kstest(samples_A, 'rayleigh', args=(0, sigma_A))\n\n    # --- Case D: Inverse Transform Numerical Stability ---\n    sigma_D = 2.0\n    u_values_D = np.array([0.0, 1e-12, 0.5, 1.0 - 1e-12])\n    inverse_values = sampler_inverse_transform(sigma_D, n_samples=None, rng=None, u_values=u_values_D)\n\n    # --- Case E: Two-sample Distributional Consistency ---\n    sigma_E = 0.8\n    N_E = int(1.5 * 10**5)\n    seed_2 = 20231017\n    seed_3 = 424242\n    delta = 0.02\n\n    rng_E2 = np.random.default_rng(seed_2)\n    sample_E_gauss = sampler_gauss_components(sigma_E, N_E, rng_E2)\n\n    rng_E3 = np.random.default_rng(seed_3)\n    sample_E_inv = sampler_inverse_transform(sigma_E, N_E, rng_E3)\n\n    ks_stat_2samp, _ = stats.ks_2samp(sample_E_gauss, sample_E_inv)\n    twosample_ok = ks_stat_2samp  delta\n\n    # --- Format and Print Final Output ---\n    # Format the list of floats for Case D as a string to match the required output style\n    inverse_values_str = f\"[{','.join([f'{v:.6f}' for v in inverse_values])}]\"\n\n    # Assemble the final result string, ensuring booleans are capitalized\n    final_output_str = (\n        f\"[{str(mean_ok)},\"\n        f\"{str(var_ok)},\"\n        f\"{ks_p_value:.6f},\"\n        f\"{inverse_values_str},\"\n        f\"{str(twosample_ok)}]\"\n    )\n    \n    print(final_output_str)\n\nsolve()\n```", "id": "3532740"}, {"introduction": "虽然逆变换采样法直接且高效，但它要求累积分布函数（CDF）及其反函数具有解析形式，这并非总是可行。当直接方法不适用时，接受-拒绝采样法提供了一种功能强大且灵活的替代方案。本练习的核心在于设计和优化一个拒绝采样器，通过解析计算来最小化拒绝常数 $M$，从而最大化采样效率，这在处理计算成本高昂的大规模蒙特卡洛模拟时至关重要。[@problem_id:3532780]", "problem": "在计算高能物理的无箱共振建模中，一种常见的线型是对称布莱特-维格纳分布，它与柯西分布一致。假设探测器级别的接受度施加一个半宽为 $L0$（以共振宽度为单位）的对称窗口，使得目标采样密度为在 $\\left[-L,L\\right]$ 上的截断柯西分布，其概率密度函数在 $|x|\\leq L$ 时为 $f(x)\\propto \\frac{1}{1+x^{2}}$，在 $|x|L$ 时为 $f(x)=0$。您的任务是为 $f$ 设计一个高效的独立拒绝采样器，使用一个在高能蒙特卡洛管道中易于采样的标准分布尺度族作为包络。\n\n从拒绝采样的定义和基础微积分出发，考虑包络族 $g_{\\sigma}(x)=\\frac{1}{\\pi\\,\\sigma\\left(1+\\left(x/\\sigma\\right)^{2}\\right)}$（$\\sigma0$），这是在 $\\mathbb{R}$ 上尺度为 $\\sigma$ 的柯西分布。对于给定的 $L$，确定拒绝常数 $M(\\sigma,L)$ 使得对所有 $x\\in\\mathbb{R}$ 都有 $f(x)\\leq M(\\sigma,L)\\,g_{\\sigma}(x)$，然后对 $\\sigma0$ 最小化 $M(\\sigma,L)$。从第一性原理出发：\n\n- 在 $\\left[-L,L\\right]$ 上归一化 $f$。\n- 推导 $M(\\sigma,L)=\\sup_{x\\in\\mathbb{R}}\\frac{f(x)}{g_{\\sigma}(x)}$。\n- 对 $\\sigma0$ 最小化 $M(\\sigma,L)$ 以获得最优值 $M^{\\star}(L)$ 和相应的接受概率 $A^{\\star}(L)=\\frac{1}{M^{\\star}(L)}$。\n\n作为比较，使用截断柯西分布的逆累积分布函数的定制变换方法具有单位接受概率。利用这一事实，在标准成本模型下（其中提议数与接受概率成反比），计算优化后的拒绝采样器与定制变换方法之间的期望提议数之比 $R(L)$。\n\n将您的最终答案表示为一个单行矩阵，按顺序包含最小拒绝常数 $M^{\\star}(L)$、相应的接受概率 $A^{\\star}(L)$ 和提议数比率 $R(L)$，所有这些都表示为 $L$ 的精确解析函数。不需要单位，也不需要数值四舍五入。", "solution": "用户提供了一个关于为截断柯西分布优化拒绝采样器的计算物理问题。该问题是有效的，因为它基于标准的统计方法，具有科学依据，问题设定良好、客观且内部一致。我将进行完整的推导。\n\n问题要求三个量：最小拒绝常数 $M^{\\star}(L)$、相应的接受概率 $A^{\\star}(L)$ 以及性能比率 $R(L)$，所有这些都作为截断半宽 $L$ 的函数。\n\n**步骤1：归一化目标概率密度函数 (PDF)**\n\n目标分布的概率密度函数 $f(x)$ 在区间 $\\left[-L, L\\right]$ 上与 $\\frac{1}{1+x^2}$ 成正比，在其他地方为零。首先，我们必须找到归一化常数 $C$。\n$$\nC = \\int_{-L}^{L} \\frac{1}{1+x^2} \\, dx\n$$\n$\\frac{1}{1+x^2}$ 的不定积分是 $\\arctan(x)$。\n$$\nC = \\left[ \\arctan(x) \\right]_{-L}^{L} = \\arctan(L) - \\arctan(-L)\n$$\n由于 $\\arctan(x)$ 是一个奇函数，所以 $\\arctan(-L) = -\\arctan(L)$。\n$$\nC = \\arctan(L) - (-\\arctan(L)) = 2\\arctan(L)\n$$\n因此，归一化后的概率密度函数 $f(x)$ 为：\n$$\nf(x) = \\begin{cases} \\frac{1}{2\\arctan(L)} \\frac{1}{1+x^2}  \\text{if } |x| \\leq L \\\\ 0  \\text{if } |x|  L \\end{cases}\n$$\n\n**步骤2：推导拒绝常数 $M(\\sigma, L)$**\n\n提议分布是尺度参数为 $\\sigma  0$ 的柯西分布 $g_{\\sigma}(x)$：\n$$\ng_{\\sigma}(x) = \\frac{1}{\\pi\\sigma\\left(1 + (x/\\sigma)^2\\right)}\n$$\n拒绝常数 $M(\\sigma, L)$ 定义为目标PDF与提议PDF之比在整个实数线上的上确界。\n$$\nM(\\sigma, L) = \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g_{\\sigma}(x)}\n$$\n由于当 $|x|  L$ 时 $f(x)=0$，我们只需要考虑 $x \\in [-L, L]$。对于这个区间内的 $x$，比值为：\n$$\n\\frac{f(x)}{g_{\\sigma}(x)} = \\frac{\\frac{1}{2\\arctan(L)(1+x^2)}}{\\frac{1}{\\pi\\sigma(1+x^2/\\sigma^2)}} = \\frac{\\pi\\sigma}{2\\arctan(L)} \\frac{1+x^2/\\sigma^2}{1+x^2}\n$$\n为了找到上确界，我们必须最大化依赖于 $x$ 的项，我们将其表示为 $q(x, \\sigma)$：\n$$\nq(x, \\sigma) = \\frac{1+x^2/\\sigma^2}{1+x^2}\n$$\n由于 $q(x, \\sigma)$ 是关于 $x$ 的偶函数，我们可以分析它在 $x \\in [0, L]$ 上的行为。我们计算关于 $x$ 的导数：\n$$\n\\frac{dq}{dx} = \\frac{(2x/\\sigma^2)(1+x^2) - (1+x^2/\\sigma^2)(2x)}{(1+x^2)^2} = \\frac{2x(1/\\sigma^2 - 1)}{(1+x^2)^2} = \\frac{2x(1-\\sigma^2)}{\\sigma^2(1+x^2)^2}\n$$\n当 $x0$ 时，导数的符号由 $1-\\sigma^2$ 的符号决定。\n- 如果 $\\sigma^2  1$（即 $0  \\sigma  1$），则 $1-\\sigma^2  0$，因此 $\\frac{dq}{dx}  0$。函数 $q(x, \\sigma)$ 在 $[0, L]$ 上是递增的。最大值出现在 $x=L$ 处。\n- 如果 $\\sigma^2  1$（即 $\\sigma  1$），则 $1-\\sigma^2  0$，因此 $\\frac{dq}{dx}  0$。函数 $q(x, \\sigma)$ 在 $[0, L]$ 上是递减的。最大值出现在 $x=0$ 处。\n- 如果 $\\sigma^2 = 1$（即 $\\sigma = 1$），则 $\\frac{dq}{dx}=0$。函数 $q(x, \\sigma)$ 是常数， $q(x,1)=1$。\n\n$q(x, \\sigma)$ 在 $[-L,L]$ 上的上确界是：\n$$\n\\sup_{x \\in [-L,L]} q(x, \\sigma) = \\begin{cases} q(L, \\sigma) = \\frac{1+L^2/\\sigma^2}{1+L^2}  \\text{if } 0  \\sigma \\leq 1 \\\\ q(0, \\sigma) = 1  \\text{if } \\sigma  1 \\end{cases}\n$$\n将此代回 $M(\\sigma, L)$ 的表达式中：\n$$\nM(\\sigma, L) = \\frac{\\pi\\sigma}{2\\arctan(L)} \\times \\begin{cases} \\frac{1+L^2/\\sigma^2}{1+L^2}  \\text{if } 0  \\sigma \\leq 1 \\\\ 1  \\text{if } \\sigma  1 \\end{cases}\n$$\n对于 $0  \\sigma \\leq 1$：\n$$\nM(\\sigma, L) = \\frac{\\pi\\sigma}{2\\arctan(L)(1+L^2)} \\left(\\frac{\\sigma^2+L^2}{\\sigma^2}\\right) = \\frac{\\pi}{2\\arctan(L)(1+L^2)} \\left(\\sigma + \\frac{L^2}{\\sigma}\\right)\n$$\n对于 $\\sigma  1$：\n$$\nM(\\sigma, L) = \\frac{\\pi\\sigma}{2\\arctan(L)}\n$$\n\n**步骤3：对 $\\sigma  0$ 最小化 $M(\\sigma, L)$**\n\n我们现在对 $\\sigma$ 最小化 $M(\\sigma, L)$ 以找到最优拒绝常数 $M^{\\star}(L)$。我们分析 $\\sigma$ 的两种情况。\n\n情况1：$0  \\sigma \\leq 1$。令 $M_1(\\sigma) = \\frac{\\pi}{2\\arctan(L)(1+L^2)} \\left(\\sigma + \\frac{L^2}{\\sigma}\\right)$。\n我们通过对 $\\sigma$求导来找到最小值：\n$$\n\\frac{dM_1}{d\\sigma} = \\frac{\\pi}{2\\arctan(L)(1+L^2)} \\left(1 - \\frac{L^2}{\\sigma^2}\\right)\n$$\n令导数为零得到 $\\sigma^2=L^2$，因此 $\\sigma=L$（因为 $\\sigma, L  0$）。\n- 如果 $0  L \\leq 1$，临界点 $\\sigma=L$ 在区间 $(0, 1]$ 内。二阶导数检验确认这是一个最小值。\n- 如果 $L  1$，则对于任何 $\\sigma \\in (0,1]$，我们有 $\\sigma  L$，因此 $1 - L^2/\\sigma^2  0$。$M_1(\\sigma)$ 在 $(0,1]$ 上是一个递减函数。此区间上的最小值出现在边界 $\\sigma=1$ 处。\n\n情况2：$\\sigma  1$。令 $M_2(\\sigma) = \\frac{\\pi\\sigma}{2\\arctan(L)}$。这是一个关于 $\\sigma$ 的线性函数，斜率为正。它在 $\\sigma  1$ 上是严格递增的。当 $\\sigma \\to 1^+$ 时，它在此区间上的最小值被逼近。\n\n结合这些结果来找到全局最小值 $M^{\\star}(L) = \\min_{\\sigma0} M(\\sigma, L)$：\n- 如果 $0  L \\leq 1$：在 $(0, 1]$ 上的最小值在 $\\sigma=L$ 处，值为 $M(L, L) = \\frac{\\pi}{2\\arctan(L)(1+L^2)}(L+L^2/L) = \\frac{\\pi L}{\\arctan(L)(1+L^2)}$。当 $\\sigma  1$ 时，函数从值 $M(1, L) = \\frac{\\pi}{2\\arctan(L)}$ 开始递增。由于对所有 $L0$ 都有 $\\frac{2L}{1+L^2} \\leq 1$（且仅当 $L=1$ 时等号成立），我们有 $\\frac{\\pi L}{\\arctan(L)(1+L^2)} \\leq \\frac{\\pi}{2\\arctan(L)}$。因此，全局最小值在 $\\sigma=L$ 处。\n- 如果 $L  1$：在 $(0, 1]$ 上的最小值出现在 $\\sigma=1$ 处。当 $\\sigma  1$ 时，函数是递增的。因此，全局最小值在 $\\sigma=1$ 处。值为 $M(1, L) = \\frac{\\pi}{2\\arctan(L)}$。\n\n所以，最小拒绝常数 $M^{\\star}(L)$ 是：\n$$\nM^{\\star}(L) = \\begin{cases} \\frac{\\pi L}{(1+L^2)\\arctan(L)}  \\text{if } 0  L \\leq 1 \\\\ \\frac{\\pi}{2\\arctan(L)}  \\text{if } L  1 \\end{cases}\n$$\n\n**步骤4：确定接受概率 $A^{\\star}(L)$ 和比率 $R(L)$**\n\n拒绝采样器的最大接受概率为 $A^{\\star}(L) = \\frac{1}{M^{\\star}(L)}$。\n$$\nA^{\\star}(L) = \\begin{cases} \\frac{(1+L^2)\\arctan(L)}{\\pi L}  \\text{if } 0  L \\leq 1 \\\\ \\frac{2\\arctan(L)}{\\pi}  \\text{if } L  1 \\end{cases}\n$$\n比率 $R(L)$ 是期望提议数的比率。期望提议数是接受概率的倒数。定制变换方法的接受概率为 $A_{\\text{trans}}=1$。\n$$\nR(L) = \\frac{\\text{Expected Proposals (Rejection Sampling)}}{\\text{Expected Proposals (Transformation Method)}} = \\frac{1/A^{\\star}(L)}{1/A_{\\text{trans}}} = \\frac{1/A^{\\star}(L)}{1} = \\frac{1}{A^{\\star}(L)}\n$$\n因此，$R(L) = M^{\\star}(L)$。\n\n所需的三个量是：\n1. $M^{\\star}(L) = \\begin{cases} \\frac{\\pi L}{(1+L^2)\\arctan(L)}  \\text{if } 0  L \\leq 1 \\\\ \\frac{\\pi}{2\\arctan(L)}  \\text{if } L  1 \\end{cases}$\n2. $A^{\\star}(L) = \\begin{cases} \\frac{(1+L^2)\\arctan(L)}{\\pi L}  \\text{if } 0  L \\leq 1 \\\\ \\frac{2\\arctan(L)}{\\pi}  \\text{if } L  1 \\end{cases}$\n3. $R(L) = M^{\\star}(L) = \\begin{cases} \\frac{\\pi L}{(1+L^2)\\arctan(L)}  \\text{if } 0  L \\leq 1 \\\\ \\frac{\\pi}{2\\arctan(L)}  \\text{if } L  1 \\end{cases}$\n\n将这些量收集到一个单行矩阵中作为最终答案。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\begin{cases} \\frac{\\pi L}{(1+L^2)\\arctan(L)}  \\text{if } 0  L \\leq 1 \\\\ \\frac{\\pi}{2\\arctan(L)}  \\text{if } L  1 \\end{cases}  \\begin{cases} \\frac{(1+L^2)\\arctan(L)}{\\pi L}  \\text{if } 0  L \\leq 1 \\\\ \\frac{2\\arctan(L)}{\\pi}  \\text{if } L  1 \\end{cases}  \\begin{cases} \\frac{\\pi L}{(1+L^2)\\arctan(L)}  \\text{if } 0  L \\leq 1 \\\\ \\frac{\\pi}{2\\arctan(L)}  \\text{if } L  1 \\end{cases}\n\\end{pmatrix}\n}\n$$", "id": "3532780"}, {"introduction": "在现代高能物理分析中，探索复杂的高维后验概率分布是贝叶斯推断的核心。对于这类问题，马尔可夫链蒙特卡洛（MCMC）方法是不可或缺的工具。这项高级实践将带您深入MCMC的理论核心，分析Metropolis-Hastings算法的收敛性能。通过推导谱隙（spectral gap）的渐近估计，您将学会如何从理论上评估不同提议分布（proposal distribution）对算法混合时间（mixing time）的影响，这是确保MCMC采样结果可靠性的关键一步。[@problem_id:3532724]", "problem": "考虑一个 Metropolis–Hastings (MH) 马尔可夫链蒙特卡洛 (MCMC) 算法，其目标分布为一个源自线性化带电粒子追踪拟合的多元高斯后验。目标分布为零均值多元正态分布，其协方差矩阵为 $\\Sigma \\in \\mathbb{R}^{d \\times d}$，即\n$$\n\\pi(\\mathbf{x}) \\propto \\exp\\left(-\\tfrac{1}{2}\\,\\mathbf{x}^{\\top}\\Sigma^{-1}\\mathbf{x}\\right), \\quad \\mathbf{x}\\in\\mathbb{R}^d.\n$$\n考虑两种提议机制：\n\n1. 一个标量、各向同性的高斯随机游走提议\n$\nq_{\\mathrm{sc}}(\\mathbf{y}\\mid \\mathbf{x}) = \\mathcal{N}(\\mathbf{y};\\,\\mathbf{x},\\, s^2 I_d),\n$\n其中 $s0$ 是提议步长。\n\n2. 一个与目标协方差对齐的预处理高斯随机游走提议\n$\nq_{\\mathrm{pc}}(\\mathbf{y}\\mid \\mathbf{x}) = \\mathcal{N}(\\mathbf{y};\\,\\mathbf{x},\\, s^2 \\Sigma).\n$\n\n两种提议都在一个标准的 Metropolis–Hastings 接受-拒绝步骤中使用，以使生成的马尔可夫链是 $\\pi$-可逆的。\n\n您的任务是通过马尔可夫算子的谱隙来分析其在 $L^2(\\pi)$ 上的混合性质。令 $P$ 表示作用于关于 $\\pi$ 的平方可积函数上的 MH 转移核。$L^2(\\pi)$ 谱隙定义为\n$$\n\\mathrm{gap}(P) \\equiv 1 - \\|P\\|_{L^2_0(\\pi)\\to L^2_0(\\pi)} = \\inf_{f\\in L^2(\\pi),\\,\\mathbb{E}_{\\pi}[f]=0,\\,f\\not\\equiv 0} \\frac{\\mathcal{E}_P(f,f)}{\\mathrm{Var}_{\\pi}(f)},\n$$\n其中 Dirichlet 型为\n$$\n\\mathcal{E}_P(f,f) = \\tfrac{1}{2}\\,\\mathbb{E}_{\\pi}\\left[\\int \\left(f(\\mathbf{y})-f(\\mathbf{x})\\right)^2 \\,\\alpha(\\mathbf{x},\\mathbf{y})\\, q(\\mathbf{y}\\mid \\mathbf{x})\\, \\mathrm{d}\\mathbf{y}\\right],\n$$\n其中 $\\alpha(\\mathbf{x},\\mathbf{y})$ 是 MH 接受概率，$q$ 是提议密度。\n\n仅从上述基本定义、多元正态分布满足高斯庞加莱不等式\n$\n\\mathrm{Var}_{\\pi}(f) \\leq \\mathbb{E}_{\\pi}\\left[\\nabla f(\\mathbf{x})^{\\top}\\Sigma\\,\\nabla f(\\mathbf{x})\\right]\n$\n（对于足够光滑的 $f$）这一事实，以及 $f(\\mathbf{y})$ 在 $\\mathbf{x}$ 附近的基本泰勒展开出发，完成以下任务：\n\n- 针对标量提议 $q_{\\mathrm{sc}}(\\mathbf{y}\\mid \\mathbf{x})$ 和预处理提议 $q_{\\mathrm{pc}}(\\mathbf{y}\\mid \\mathbf{x})$，在 $s\\to 0$ 的情况下，推导相应 MH 核的 $L^2(\\pi)$ 谱隙的小步长渐近估计。您的推导必须为标量提议生成一个用 $s$ 和 $\\Sigma$ 的特征值表示的下界估计和一个上界估计，并为预处理提议生成一个与 $\\Sigma$ 的特征值无关的估计。您的推导必须通过 $\\Sigma$ 的极端特征值（表示为 $\\lambda_{\\min}(\\Sigma)$ 和 $\\lambda_{\\max}(\\Sigma)$）明确表示。\n\n- 使用推导出的表达式，实现一个程序，为下面列出的每个测试用例计算三个值：标量提议谱隙的渐近下界估计、标量提议谱隙的渐近上界估计，以及预处理提议谱隙的渐近估计。每个值都必须是一个实数。\n\n- 您的程序必须输出一行，包含一个列表的列表，每个内部列表对应一个测试用例，并按指定顺序排列。每个内部列表的形式必须是 $[\\mathrm{gap\\_lower\\_scalar}, \\mathrm{gap\\_upper\\_scalar}, \\mathrm{gap\\_preconditioned}]$，其中每个浮点数值都四舍五入到恰好 $10$ 位小数。\n\n本问题不涉及物理单位。不出现角度。所有量均为无量纲实数。\n\n测试套件（每个测试用例是由 $\\Sigma$ 的特征值列表和步长 $s$ 组成的一对）：\n\n1. $\\left([\\;4.0\\;],\\, 0.1\\right)$\n2. $\\left([\\;1.0,\\,4.0,\\,9.0\\;],\\, 0.05\\right)$\n3. $\\left([\\;0.01,\\,1.0,\\,1.0,\\,2.0,\\,10.0\\;],\\, 0.02\\right)$\n4. $\\left([\\;3.0,\\,3.0,\\,3.0\\;],\\, 0.2\\right)$\n5. $\\left([\\;0.5,\\,1.0,\\,3.0,\\,100.0\\;],\\, 0.1\\right)$\n\n最终输出格式：您的程序应生成单行输出，包含一个由方括号括起来的、逗号分隔的列表的列表形式的结果。例如，包含两个测试用例的输出应类似于 $[[a,b,c],[d,e,f]]$，其中每个 $a,b,c,d,e,f$ 都四舍五入到恰好 $10$ 位小数。", "solution": "该问题被评估为有效的，因为它在科学上基于马尔可夫链蒙特卡洛方法的理论，问题设定良好且目标明确，并且没有任何可指明的缺陷。可以进行推导和实现。\n\n任务是为两种不同的提议机制，推导 Metropolis-Hastings (MH) 核的 $L^2(\\pi)$ 谱隙在小步长 ($s \\to 0$) 情况下的渐近估计。目标分布是一个 d 维零均值多元正态分布 $\\pi(\\mathbf{x}) = \\mathcal{N}(\\mathbf{x}; \\mathbf{0}, \\Sigma)$。\n\n谱隙定义为：\n$$\n\\mathrm{gap}(P) = \\inf_{f\\in L^2(\\pi),\\,\\mathbb{E}_{\\pi}[f]=0,\\,f\\not\\equiv 0} \\frac{\\mathcal{E}_P(f,f)}{\\mathrm{Var}_{\\pi}(f)}\n$$\n其中 Dirichlet 型为：\n$$\n\\mathcal{E}_P(f,f) = \\tfrac{1}{2}\\,\\mathbb{E}_{\\pi}\\left[\\int \\left(f(\\mathbf{y})-f(\\mathbf{x})\\right)^2 \\,\\alpha(\\mathbf{x},\\mathbf{y})\\, q(\\mathbf{y}\\mid \\mathbf{x})\\, \\mathrm{d}\\mathbf{y}\\right]\n$$\n提议是随机游走形式 $\\mathbf{y} = \\mathbf{x} + s\\mathbf{z}$，其中 $s$ 是步长，$\\mathbf{z}$ 是一个随机向量。对于小步长 $s$，我们可以对 $f(\\mathbf{y})$ 在 $\\mathbf{x}$ 附近进行泰勒展开：\n$$\nf(\\mathbf{y}) - f(\\mathbf{x}) = f(\\mathbf{x} + s\\mathbf{z}) - f(\\mathbf{x}) = s\\nabla f(\\mathbf{x})^{\\top}\\mathbf{z} + O(s^2)\n$$\n在 $s \\to 0$ 的极限下，我们有 $\\mathbf{y} \\to \\mathbf{x}$。接受概率 $\\alpha(\\mathbf{x},\\mathbf{y}) = \\min(1, \\pi(\\mathbf{y})/\\pi(\\mathbf{x}))$ 趋近于 1，因为 $\\pi(\\mathbf{y})/\\pi(\\mathbf{x}) \\to 1$。通过设 $\\alpha(\\mathbf{x},\\mathbf{y}) \\approx 1$ 并使用泰勒展开的主导项，可以得到 Dirichlet 型的一阶近似：\n$$\n\\mathcal{E}_P(f,f) \\approx \\tfrac{1}{2}\\,\\mathbb{E}_{\\pi;\\mathbf{x}}\\left[\\int \\left(s\\nabla f(\\mathbf{x})^{\\top}\\mathbf{z}\\right)^2 q(\\mathbf{y}\\mid \\mathbf{x})\\, \\mathrm{d}\\mathbf{y}\\right]\n$$\n该积分是关于 $\\mathbf{y}$ 的，等价于关于 $\\mathbf{z}$ 的期望。令 $C_z = \\mathbb{E}[\\mathbf{z}\\mathbf{z}^{\\top}]$ 为 $\\mathbf{z}$ 的协方差矩阵。\n$$\n\\mathcal{E}_P(f,f) \\approx \\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\mathbb{E}_{\\mathbf{z}}\\left[ (\\nabla f(\\mathbf{x})^{\\top}\\mathbf{z})(\\mathbf{z}^{\\top}\\nabla f(\\mathbf{x})) \\right] \\right]\n$$\n$$\n\\mathcal{E}_P(f,f) \\approx \\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\nabla f(\\mathbf{x})^{\\top} \\mathbb{E}_{\\mathbf{z}}[\\mathbf{z}\\mathbf{z}^{\\top}] \\nabla f(\\mathbf{x}) \\right] = \\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\nabla f(\\mathbf{x})^{\\top} C_z \\nabla f(\\mathbf{x}) \\right]\n$$\n谱隙表达式的分母是 $\\mathrm{Var}_{\\pi}(f)$，对此问题提供了高斯庞加莱不等式：\n$$\n\\mathrm{Var}_{\\pi}(f) \\leq \\mathbb{E}_{\\pi}\\left[\\nabla f(\\mathbf{x})^{\\top}\\Sigma\\,\\nabla f(\\mathbf{x})\\right]\n$$\n已知对于形式为 $f(\\mathbf{x}) = \\mathbf{v}^\\top\\mathbf{x}$ 的线性函数，此不等式取等号。\n\n我们现在分析这两种具体的提议。\n\n**1. 标量、各向同性高斯提议 ($q_{\\mathrm{sc}}$)**\n提议为 $q_{\\mathrm{sc}}(\\mathbf{y}\\mid \\mathbf{x}) = \\mathcal{N}(\\mathbf{y};\\,\\mathbf{x},\\, s^2 I_d)$。这意味着提议增量 $\\mathbf{y}-\\mathbf{x}$ 的协方差为 $s^2 I_d$。由于我们定义了 $\\mathbf{y}-\\mathbf{x} = s\\mathbf{z}$，因此 $\\mathbf{z}$ 的协方差为 $C_z = I_d$。\nDirichlet 型的近似为：\n$$\n\\mathcal{E}_{P_{\\mathrm{sc}}}(f,f) \\approx \\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\nabla f^{\\top} I_d \\nabla f \\right] = \\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]\n$$\n定义谱隙的比率的渐近表达式为：\n$$\n\\frac{\\mathcal{E}_{P_{\\mathrm{sc}}}(f,f)}{\\mathrm{Var}_{\\pi}(f)} \\approx \\frac{\\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]}{\\mathrm{Var}_{\\pi}(f)}\n$$\n对分母使用庞加莱不等式，我们可以为此比率建立一个下界：\n$$\n\\frac{\\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]}{\\mathrm{Var}_{\\pi}(f)} \\geq \\frac{\\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]}{\\mathbb{E}_{\\pi}\\left[\\nabla f^{\\top}\\Sigma\\,\\nabla f\\right]} = \\frac{s^2}{2} \\frac{\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]}{\\mathbb{E}_{\\pi}\\left[\\nabla f^{\\top}\\Sigma\\,\\nabla f\\right]}\n$$\n期望的比率由 $\\Sigma^{-1}$ 的极端特征值 $1/\\lambda_{\\max}(\\Sigma)$ 和 $1/\\lambda_{\\min}(\\Sigma)$ 界定。具体来说，$\\inf_f \\frac{\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]}{\\mathbb{E}_{\\pi}\\left[\\nabla f^{\\top}\\Sigma\\,\\nabla f\\right]} = \\frac{1}{\\lambda_{\\max}(\\Sigma)}$。这为谱隙提供了一个下界估计，代表了链的最慢混合模式：\n$$\n\\mathrm{gap}_{\\mathrm{sc, lower}} = \\frac{s^2}{2\\lambda_{\\max}(\\Sigma)}\n$$\n问题也要求一个上界估计。在 MCMC 性能的背景下，这通常指最快混合模式的收敛速率，它对应于相同期望比率的上确界：$\\sup_f \\frac{\\mathbb{E}_{\\pi}\\left[ \\|\\nabla f\\|^2 \\right]}{\\mathbb{E}_{\\pi}\\left[\\nabla f^{\\top}\\Sigma\\,\\nabla f\\right]} = \\frac{1}{\\lambda_{\\min}(\\Sigma)}$。这给出了上界估计：\n$$\n\\mathrm{gap}_{\\mathrm{sc, upper}} = \\frac{s^2}{2\\lambda_{\\min}(\\Sigma)}\n$$\n当使用各向同性提议时，这两个估计刻画了目标分布不同主轴上的收敛速度范围。\n\n**2. 预处理高斯提议 ($q_{\\mathrm{pc}}$)**\n提议为 $q_{\\mathrm{pc}}(\\mathbf{y}\\mid \\mathbf{x}) = \\mathcal{N}(\\mathbf{y};\\,\\mathbf{x},\\, s^2 \\Sigma)$。提议增量 $\\mathbf{y}-\\mathbf{x}$ 的协方差为 $s^2 \\Sigma$。这意味着 $C_z = \\Sigma$。\nDirichlet 型的近似变为：\n$$\n\\mathcal{E}_{P_{\\mathrm{pc}}}(f,f) \\approx \\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[ \\nabla f^{\\top} \\Sigma \\nabla f \\right]\n$$\n该比率的渐近表达式为：\n$$\n\\frac{\\mathcal{E}_{P_{\\mathrm{pc}}}(f,f)}{\\mathrm{Var}_{\\pi}(f)} \\approx \\frac{\\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[\\nabla f^{\\top}\\Sigma\\,\\nabla f\\right]}{\\mathrm{Var}_{\\pi}(f)}\n$$\n从庞加莱不等式可知，分母总是小于或等于分子（相差一个因子 $\\tfrac{s^2}{2}$）。因此：\n$$\n\\frac{\\tfrac{s^2}{2}\\,\\mathbb{E}_{\\pi}\\left[\\nabla f^{\\top}\\Sigma\\,\\nabla f\\right]}{\\mathrm{Var}_{\\pi}(f)} \\geq \\frac{s^2}{2}\n$$\n已知这种预处理算法的扩散极限的最慢模式与线性函数 $f(\\mathbf{x}) = \\mathbf{v}^{\\top}\\mathbf{x}$ 相关联。对于此类函数，庞加莱不等式取等号：$\\mathrm{Var}_{\\pi}(f) = \\mathbb{E}_{\\pi}[\\nabla f^{\\top}\\Sigma \\nabla f]$。对于这些函数，该比率恰好是 $\\tfrac{s^2}{2}$。由于谱隙是此比率在所有函数上的下确界，这表明谱隙精确为 $\\tfrac{s^2}{2}$。此估计与 $\\Sigma$ 的特征值无关，符合要求。\n$$\n\\mathrm{gap}_{\\mathrm{pc}} = \\frac{s^2}{2}\n$$\n\n**公式总结：**\n- 标量提议的渐近下界估计：$\\mathrm{gap}_{\\mathrm{sc, lower}} = \\frac{s^2}{2 \\lambda_{\\max}(\\Sigma)}$\n- 标量提议的渐近上界估计：$\\mathrm{gap}_{\\mathrm{sc, upper}} = \\frac{s^2}{2 \\lambda_{\\min}(\\Sigma)}$\n- 预处理提议的渐近估计：$\\mathrm{gap}_{\\mathrm{pc}} = \\frac{s^2}{2}$\n\n这些公式将被实现以解决给定的测试用例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating asymptotic spectral gap estimates\n    for Metropolis-Hastings algorithms with scalar and preconditioned proposals.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of (list_of_eigenvalues, step_size_s).\n    test_cases = [\n        ([4.0], 0.1),\n        ([1.0, 4.0, 9.0], 0.05),\n        ([0.01, 1.0, 1.0, 2.0, 10.0], 0.02),\n        ([3.0, 3.0, 3.0], 0.2),\n        ([0.5, 1.0, 3.0, 100.0], 0.1)\n    ]\n\n    # This list will store the string representation of each inner list of results.\n    final_result_strings = []\n\n    for eigenvalues, s in test_cases:\n        # Find the extremal eigenvalues of the covariance matrix Sigma.\n        lambda_min = np.min(eigenvalues)\n        lambda_max = np.max(eigenvalues)\n        \n        # Calculate s^2, a common term in all estimates.\n        s_squared = s**2\n        \n        # 1. Asymptotic lower estimate for the scalar proposal spectral gap.\n        # Formula: s^2 / (2 * lambda_max)\n        gap_lower_scalar = s_squared / (2.0 * lambda_max)\n        \n        # 2. Asymptotic upper estimate for the scalar proposal spectral gap.\n        # Formula: s^2 / (2 * lambda_min)\n        gap_upper_scalar = s_squared / (2.0 * lambda_min)\n        \n        # 3. Asymptotic estimate for the preconditioned proposal spectral gap.\n        # Formula: s^2 / 2\n        gap_preconditioned = s_squared / 2.0\n        \n        # Format the results for the current test case into a string '[val1,val2,val3]'\n        # with each value rounded to 10 decimal places.\n        inner_string = (\n            f\"[{gap_lower_scalar:.10f},\"\n            f\"{gap_upper_scalar:.10f},\"\n            f\"{gap_preconditioned:.10f}]\"\n        )\n        final_result_strings.append(inner_string)\n\n    # Final print statement in the exact required format '[[...],[...],...]'.\n    # This is achieved by joining the formatted strings of the inner lists.\n    print(f\"[{','.join(final_result_strings)}]\")\n\nsolve()\n```", "id": "3532724"}]}