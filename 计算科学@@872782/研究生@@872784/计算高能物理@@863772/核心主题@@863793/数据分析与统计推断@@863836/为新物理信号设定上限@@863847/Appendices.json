{"hands_on_practices": [{"introduction": "在探索新物理的征程中，建立新信号强度的上限是核心任务之一。这项基础练习从最简单的情景入手：一个无背景（$b=0$）的计数实验中未观测到任何事件（$n=0$）。通过这个理想化的案例，我们得以清晰地对比频率主义和贝叶斯主义这两种主流统计思想在设定上限时的基本逻辑和推导过程 [@problem_id:3533332]。", "problem": "一个高能物理搜寻中的计数实验被建模为泊松过程。预期事件数是未知信号产额和已知本底产额之和。设未知信号产额用 $\\mu \\geq 0$ 表示，已知本底产额用 $b \\geq 0$ 表示。那么，观测到的事件数 $n$ 服从泊松概率质量函数 $P(n \\mid \\mu, b) = \\exp\\!\\left(-(\\mu + b)\\right)\\,(\\mu + b)^{n}/n!$。考虑单个信号区产生 $n = 0$ 个观测事件且预期本底为 $b = 0$ 的情况。使用此模型，并从泊松过程和置信区间构造的基本定义出发，执行以下操作：\n\n1. 使用 Neyman 构造法，推导在置信水平为 $1-\\alpha$ 时 $\\mu$ 的经典频率主义单边上限。该单边区间的下端点固定为0。提供上限关于 $\\alpha$ 的最终闭式表达式。\n\n2. 独立地，在 $\\mu \\geq 0$ 上为平坦的无信息先验下，使用贝叶斯定理和同一模型的泊松似然，推导 $\\mu$ 的 $1-\\alpha$ 贝叶斯可信上限。提供上限关于 $\\alpha$ 的最终闭式表达式。\n\n3. 比较上述两个结果，确定在这种特殊情况下，经典频率主义上限和贝叶斯可信上限是否一致，如果一致，请提供共同的闭式表达式。\n\n你的最终答案必须是仅含 $\\alpha$ 的单个闭式解析表达式。量 $\\mu$ 是无量纲的（事件计数），因此无需指明单位。最终结果无需进行数值舍入。", "solution": "首先根据所需标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   **模型**：计数实验被建模为泊松过程。\n-   **信号产额**：$\\mu \\geq 0$（未知）。\n-   **本底产额**：$b \\geq 0$（已知）。\n-   **总预期事件数**：$\\mu + b$。\n-   **观测事件数**：$n$。\n-   **概率质量函数 (PMF)**：$P(n \\mid \\mu, b) = \\exp(-(\\mu + b))\\,(\\mu + b)^{n}/n!$。\n-   **特定条件**：观测事件数 $n = 0$，预期本底 $b = 0$。\n-   **置信水平 (CL)**：$1-\\alpha$。\n-   **任务 1 (频率主义)**：使用 Neyman 构造法推导在置信水平 $1-\\alpha$ 下 $\\mu$ 的单边上限，区间为 $[0, \\mu_{up}]$。\n-   **任务 2 (贝叶斯主义)**：在 $\\mu \\geq 0$ 上使用无信息的平坦先验，推导 $\\mu$ 的 $1-\\alpha$ 贝叶斯可信上限。\n-   **任务 3 (比较)**：比较结果，如果相同则提供共同表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题陈述的有效性进行评估。\n-   **科学基础**：该问题使用泊松分布，这是粒子物理学和其他领域中计数实验的标准且正确的统计模型。频率主义上限（Neyman 构造）和贝叶斯可信上限的概念是统计推断中基础且成熟的方法。该场景虽然简化（$b=0$, $n=0$），但代表了一个有效且重要的极限情况（一个无本底且没有观测到事件的实验）。\n-   **适定性**：该问题定义明确，提供了所有必要信息：统计模型、具体数据、期望的置信/可信水平以及要使用的统计框架。问题精确，并能推导出唯一的解。\n-   **客观性**：语言清晰、正式，不含任何主观或基于观点的内容。\n\n该问题没有违反任何无效标准。它在科学上是合理的，陈述正式，信息完整，并在统计数据分析领域提出了一个非平凡但可解的问题。\n\n### 步骤 3：结论与行动\n问题被判定为 **有效**。现在开始推导解答。\n\n***\n\n### 1. 频率主义上限推导\n\n在置信水平为 $1-\\alpha$ 时，经典的频率主义单边上限 $\\mu_{up}$ 是基于 Neyman 原则构造的。对于单边区间 $[0, \\mu_{up}]$，该上限被定义为参数 $\\mu$ 的一个值，在该值下，观测到与实际观测结果 $n_{obs}$ 同样或更具约束性的结果的概率等于 $\\alpha$。在计数实验中，对于信号的上限而言，观测到的事件数越少，其约束性就越强。\n\n给定观测到的事件数 $n_{obs}$，上限 $\\mu_{up}$ 是解以下方程的 $\\mu$ 值：\n$$P(n \\leq n_{obs} \\mid \\mu_{up}) = \\alpha$$\n\n问题指定了泊松模型。在给定条件 $b=0$下，总预期事件数就是 $\\mu$。概率质量函数为：\n$$P(n \\mid \\mu) = \\frac{\\exp(-\\mu) \\mu^n}{n!}$$\n\n问题指出观测到的事件数为 $n_{obs} = 0$。将此代入上限的定义方程，我们得到：\n$$P(n \\leq 0 \\mid \\mu_{up}) = \\alpha$$\n对于泊松分布， $n \\leq 0$ 唯一可能发生的情况是 $n=0$。因此，方程简化为：\n$$P(n = 0 \\mid \\mu_{up}) = \\alpha$$\n\n使用 $n=0$ 的泊松 PMF：\n$$P(n=0 \\mid \\mu_{up}) = \\frac{\\exp(-\\mu_{up}) \\mu_{up}^0}{0!} = \\exp(-\\mu_{up})$$\n这里我们使用了 $\\mu_{up}^0 = 1$ 和 $0! = 1$。\n\n令其等于 $\\alpha$：\n$$\\exp(-\\mu_{up}) = \\alpha$$\n\n为求解 $\\mu_{up}$，我们对两边取自然对数：\n$$-\\mu_{up} = \\ln(\\alpha)$$\n$$\\mu_{up} = -\\ln(\\alpha)$$\n这就是 $\\mu$ 的经典频率主义单边上限。\n\n### 2. 贝叶斯可信上限推导\n\n贝叶斯主义方法始于未知参数 $\\mu$ 的一个先验概率分布，记为 $\\pi(\\mu)$。通过贝叶斯定理，使用观测数据 $n_{obs}$ 将其更新为后验概率分布 $P(\\mu \\mid n_{obs})$。一个 $1-\\alpha$ 可信区间是参数空间中的一个区间，该区间包含总后验概率的 $1-\\alpha$。对于单边上限 $\\mu_{up}$，区间为 $[0, \\mu_{up}]$，且必须满足：\n$$\\int_0^{\\mu_{up}} P(\\mu \\mid n_{obs}) \\, d\\mu = 1-\\alpha$$\n\n贝叶斯定理表述为：\n$$P(\\mu \\mid n) = \\frac{P(n \\mid \\mu) \\pi(\\mu)}{\\int_0^{\\infty} P(n \\mid \\mu') \\pi(\\mu') \\, d\\mu'}$$\n\n问题提供了以下信息：\n-   **似然**，$P(n \\mid \\mu)$：$b=0$ 的泊松分布，因此 $P(n \\mid \\mu) = \\frac{\\exp(-\\mu) \\mu^n}{n!}$。\n-   **先验**，$\\pi(\\mu)$：对于 $\\mu \\geq 0$ 是平坦的无信息先验。我们可以将其写为 $\\pi(\\mu) = C$（对于 $\\mu \\geq 0$），其中 $C$ 是一个常数。由于该常数将被约掉，我们可以设 $C=1$。\n-   **数据**，$n_{obs} = 0$。\n\n首先，我们构造贝叶斯定理的分子（未归一化的后验）：\n$$P(n=0 \\mid \\mu) \\pi(\\mu) = \\left( \\frac{\\exp(-\\mu) \\mu^0}{0!} \\right) \\cdot 1 = \\exp(-\\mu)$$\n\n接下来，我们计算分母，即归一化常数（也称为边缘似然或证据）：\n$$\\int_0^{\\infty} P(n=0 \\mid \\mu') \\pi(\\mu') \\, d\\mu' = \\int_0^{\\infty} \\exp(-\\mu') \\, d\\mu'$$\n该积分的计算结果为：\n$$\\int_0^{\\infty} \\exp(-\\mu') \\, d\\mu' = [-\\exp(-\\mu')]_0^{\\infty} = (-\\lim_{x \\to \\infty} \\exp(-x)) - (-\\exp(0)) = 0 - (-1) = 1$$\n\n因此，给定 $n=0$ 时 $\\mu$ 的归一化后验分布为：\n$$P(\\mu \\mid n=0) = \\frac{\\exp(-\\mu)}{1} = \\exp(-\\mu) \\quad \\text{for } \\mu \\geq 0$$\n该后验分布是率参数为 1 的指数分布。\n\n现在，我们通过将后验分布从 $0$ 积分到 $\\mu_{up}$ 并将结果设为 $1-\\alpha$ 来求得上界 $\\mu_{up}$：\n$$\\int_0^{\\mu_{up}} \\exp(-\\mu) \\, d\\mu = 1-\\alpha$$\n执行积分：\n$$[-\\exp(-\\mu)]_0^{\\mu_{up}} = 1-\\alpha$$\n$$(-\\exp(-\\mu_{up})) - (-\\exp(0)) = 1-\\alpha$$\n$$-\\exp(-\\mu_{up}) + 1 = 1-\\alpha$$\n\n求解 $\\exp(-\\mu_{up})$：\n$$-\\exp(-\\mu_{up}) = -\\alpha$$\n$$\\exp(-\\mu_{up}) = \\alpha$$\n\n最后，求解 $\\mu_{up}$：\n$$-\\mu_{up} = \\ln(\\alpha)$$\n$$\\mu_{up} = -\\ln(\\alpha)$$\n这就是 $\\mu$ 的贝叶斯 $1-\\alpha$ 可信上限。\n\n### 3. 结果比较\n\n在 $1-\\alpha$ 置信水平下，为 $n=0$ 和 $b=0$ 推导出的经典频率主义单边上限是：\n$$\\mu_{up}^{\\text{freq}} = -\\ln(\\alpha)$$\n\n在 $1-\\alpha$ 可信度下，为 $n=0$, $b=0$ 且在 $\\mu \\geq 0$ 上使用平坦先验推导出的贝叶斯单边可信上限是：\n$$\\mu_{up}^{\\text{Bayes}} = -\\ln(\\alpha)$$\n\n两个结果是相同的。这是一个特殊但值得注意的情况，即频率主义和贝叶斯主义的结果在此一致。因此，该限值的共同闭式表达式为 $-\\ln(\\alpha)$。", "answer": "$$\\boxed{-\\ln(\\alpha)}$$", "id": "3533332"}, {"introduction": "为了提升统计显著性，高能物理实验通常会将来自多个独立测量渠道的数据进行联合分析。本练习将引导你从单渠道分析过渡到更贴近真实的联合分析场景，学习如何使用多变量高斯模型来合并测量结果，并特别关注如何处理渠道间相关的系统误差 [@problem_id:3533325]。通过亲手编程实现，你将深入理解联合分析中处理协方差矩阵的关键作用。", "problem": "给定一个在高能物理计算背景下的多通道组合问题，要求为一个非负信号强度参数 $\\,\\mu\\,$ 设置上限。该组合涉及 $\\,3\\,$ 个统计独立的计数通道，其测量值被近似为联合高斯分布。每个通道 $\\,i\\,$ 提供一个标量可观测值 $\\,y_i\\,$，其模型为 $\\,y_i = \\mu s_i + b_i + \\epsilon_i\\,$，其中 $\\,s_i\\,$ 是单位信号强度的预期信号产额，$\\,b_i\\,$ 是标称本底期望，而涨落向量 $\\,\\boldsymbol{\\epsilon}\\,$ 服从一个多元正态分布 $\\,\\mathcal{N}(\\boldsymbol{0}, \\boldsymbol{\\Sigma})\\,$。协方差 $\\,\\boldsymbol{\\Sigma}\\,$ 是一个统计分量和一个具有块结构的系统分量之和。请使用以下基础要素作为您推导的起点：\n\n- 均值为 $\\,\\boldsymbol{\\mu}_{y}(\\mu) = \\mu \\boldsymbol{s} + \\boldsymbol{b}\\,$、协方差为 $\\,\\boldsymbol{\\Sigma}\\,$ 的多元正态模型的似然函数，以及相应的最大似然方法。\n- 具有已知协方差的线性模型的广义最小二乘推断。\n- 单个感兴趣参数 $\\,\\mu\\,$ 在物理约束 $\\,\\mu \\ge 0\\,$ 下，轮廓似然比的大样本渐近行为（Wald 近似）。\n- 在置信度为 $\\,1 - \\alpha\\,$（其中 $\\,\\alpha = 0.05\\,$）下，用于单边上限的置信水平（CL）反演。\n\n明确定义这 $\\,3\\,$ 个通道的输入如下：\n\n- 信号期望向量 $\\,\\boldsymbol{s} = (s_1, s_2, s_3) = (3.0, 2.0, 1.5)\\,$。\n- 本底期望向量 $\\,\\boldsymbol{b} = (b_1, b_2, b_3) = (25.0, 18.0, 12.0)\\,$。\n- 统计协方差（泊松近似） $\\,\\boldsymbol{\\Sigma}_{\\text{stat}} = \\mathrm{diag}(b_1, b_2, b_3)\\,$。\n- 系统协方差 $\\,\\boldsymbol{\\Sigma}_{\\text{sys}}\\,$ 由块结构定义：\n  - 通道 $\\,1\\,$ 和 $\\,2\\,$ 共享一个部分相关的讨厌参数，其分数尺度为 $\\,f_{12} = 0.08\\,$，相关系数为 $\\,\\rho_{12} = 0.7\\,$。这对 $\\,i \\in \\{1,2\\}\\,$ 的对角线贡献了 $\\,f_{12}^2 b_i^2\\,$，并对 $\\,\\{1,2\\}\\,$ 块的非对角元贡献了 $\\,\\rho_{12} f_{12}^2 b_1 b_2\\,$。\n  - 通道 $\\,3\\,$ 有一个独立讨厌参数，其分数尺度为 $\\,f_3 = 0.10\\,$，仅对 $\\,\\{3,3\\}\\,$ 元贡献了 $\\,f_3^2 b_3^2\\,$。\n- 完整协方差为 $\\,\\boldsymbol{\\Sigma} = \\boldsymbol{\\Sigma}_{\\text{stat}} + \\boldsymbol{\\Sigma}_{\\text{sys}}\\,$。\n\n相关性误设被建模为仅在通道 $\\,1\\,$ 和 $\\,2\\,$ 之间的系统协方差块的非对角元膨胀。对于一个标量膨胀因子 $\\,\\kappa \\ge 0\\,$，误设的协方差为\n$$\n\\boldsymbol{\\Sigma}(\\kappa) = \\boldsymbol{\\Sigma}_{\\text{stat}} + \\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa),\n\\quad\n\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa)_{12} = \\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa)_{21} = \\kappa \\,\\rho_{12} f_{12}^2 b_1 b_2,\n$$\n其中所有对角元相对于 $\\,\\boldsymbol{\\Sigma}_{\\text{sys}}\\,$ 保持不变，所有其他非对角元等于 $\\,0\\,$。\n\n假设观测数据向量等于标称本底期望（Asimov 数据集），即 $\\,\\boldsymbol{y} = \\boldsymbol{b}\\,$。从上述基础要素出发，从第一性原理推导：\n\n- 通过最大化高斯似然获得的 $\\,\\mu\\,$ 的估计量（不要假设任何预先提供的公式）。\n- 在已知 $\\,\\boldsymbol{\\Sigma}(\\kappa)\\,$ 的模型下，该估计量的抽样方差。\n- 通过对具有物理约束 $\\,\\mu \\ge 0\\,$ 的相应单边 Wald 检验进行渐近反演，获得的 $\\,\\mu\\,$ 的单边 $\\,95\\,$% 置信水平（CL）上限。\n\n您必须将这些推导实现在一个完整的程序中，该程序：\n\n- 为每个提供的测试值 $\\,\\kappa\\,$ 构建 $\\,\\boldsymbol{\\Sigma}(\\kappa)\\,$。\n- 使用推导出的表达式计算 $\\,\\mu\\,$ 在 $\\,95\\,$% CL 下的组合上限。\n- 使用 $\\,\\alpha = 0.05\\,$ 作为置信水平。\n- 将所有量视为无量纲；不需要物理单位。\n- 将结果输出为小数点后保留 $\\,6\\,$ 位的小数浮点数。\n\n测试套件：\n\n- 情况 $\\,1\\,$ (正常路径): $\\,\\kappa = 1.0\\,$。\n- 情况 $\\,2\\,$ (缩减): $\\,\\kappa = 0.5\\,$。\n- 情况 $\\,3\\,$ (无相关): $\\,\\kappa = 0.0\\,$。\n- 情况 $\\,4\\,$ (在强相关边缘附近膨胀但仍保持正定): $\\,\\kappa = 1.3\\,$。\n\n最终输出格式：\n\n- 您的程序应产生单行输出，其中包含一个逗号分隔的列表，用方括号括起来（例如，$\\,\\texttt{[result1,result2,result3,result4]}\\,$），结果顺序与上面列出的测试情况一致。", "solution": "该问题要求从一个三通道测量的组合中，推导并计算信号强度参数 $\\mu$ 的单边 $95\\%$ 置信水平（CL）上限。推导必须从第一性原理开始，即多元高斯似然、广义最小二乘法，以及似然估计量的渐近性质（Wald 近似）。\n\n设测量向量为 $\\boldsymbol{y} = (y_1, y_2, y_3)^T$。统计模型由下式给出：\n$$\n\\boldsymbol{y} = \\mu \\boldsymbol{s} + \\boldsymbol{b} + \\boldsymbol{\\epsilon},\n$$\n其中 $\\boldsymbol{s}$ 是信号期望向量，$\\boldsymbol{b}$ 是本底期望向量，$\\boldsymbol{\\epsilon}$ 是一个随机涨落向量。涨落被建模为均值为零、协方差矩阵为 $\\boldsymbol{\\Sigma}$ 的多元正态分布，即 $\\boldsymbol{\\epsilon} \\sim \\mathcal{N}(\\boldsymbol{0}, \\boldsymbol{\\Sigma})$。因此，可观测值 $\\boldsymbol{y}$ 的分布为 $\\boldsymbol{y} \\sim \\mathcal{N}(\\mu \\boldsymbol{s} + \\boldsymbol{b}, \\boldsymbol{\\Sigma})$。\n\n### 第1部分：$\\mu$ 的最大似然估计量的推导\n\n似然函数 $L(\\mu)$ 是在观测数据 $\\boldsymbol{y}$ 处评估的多元正态分布的概率密度函数，并被视为参数 $\\mu$ 的函数：\n$$\nL(\\mu | \\boldsymbol{y}) = \\frac{1}{(2\\pi)^{3/2} |\\boldsymbol{\\Sigma}|^{1/2}} \\exp\\left(-\\frac{1}{2} (\\boldsymbol{y} - (\\mu \\boldsymbol{s} + \\boldsymbol{b}))^T \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{y} - (\\mu \\boldsymbol{s} + \\boldsymbol{b}))\\right).\n$$\n为了找到最大似然估计量（MLE）$\\hat{\\mu}$，我们最大化 $L(\\mu)$。等价且更方便的是最大化对数似然函数 $\\ln L(\\mu)$：\n$$\n\\ln L(\\mu) = C - \\frac{1}{2} (\\boldsymbol{y} - \\boldsymbol{b} - \\mu \\boldsymbol{s})^T \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{y} - \\boldsymbol{b} - \\mu \\boldsymbol{s}),\n$$\n其中 $C = -\\frac{3}{2}\\ln(2\\pi) - \\frac{1}{2}\\ln|\\boldsymbol{\\Sigma}|$ 是一个与 $\\mu$ 无关的常数。最大化 $\\ln L(\\mu)$ 等价于最小化二次项，即广义卡方函数 $\\chi^2(\\mu)$：\n$$\n\\chi^2(\\mu) = (\\boldsymbol{d} - \\mu\\boldsymbol{s})^T \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{d} - \\mu\\boldsymbol{s}),\n$$\n这里我们定义 $\\boldsymbol{d} = \\boldsymbol{y} - \\boldsymbol{b}$。将这个关于 $\\mu$ 的二次型展开：\n$$\n\\chi^2(\\mu) = \\boldsymbol{d}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{d} - 2\\mu \\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{d} + \\mu^2 \\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}.\n$$\n为了找到使 $\\chi^2(\\mu)$ 最小的 $\\mu$ 值，我们计算关于 $\\mu$ 的导数并将其设为零：\n$$\n\\frac{d\\chi^2}{d\\mu} = -2\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{d} + 2\\mu \\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s} = 0.\n$$\n解出 $\\mu$ 得到无约束的最大似然估计量 $\\hat{\\mu}$：\n$$\n\\hat{\\mu} = \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{d}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}} = \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{y} - \\boldsymbol{b})}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}.\n$$\n这是线性模型 $\\boldsymbol{d} = \\mu \\boldsymbol{s} + \\boldsymbol{\\epsilon}$ 的著名广义最小二乘（GLS）估计量。\n\n### 第2部分：$\\hat{\\mu}$ 的抽样方差的推导\n\n估计量 $\\hat{\\mu}$ 是随机变量 $\\boldsymbol{y}$ 的线性函数。其抽样方差 $\\mathrm{Var}(\\hat{\\mu}) = \\sigma_{\\hat{\\mu}}^2$ 可以使用随机向量线性变换的性质来计算。我们注意到 $\\boldsymbol{s}$、$\\boldsymbol{b}$ 和 $\\boldsymbol{\\Sigma}$ 是常数。\n$$\n\\hat{\\mu} = \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}} \\boldsymbol{y} - \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{b}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}.\n$$\n$\\hat{\\mu}$ 的方差仅取决于涉及 $\\boldsymbol{y}$ 的项：\n$$\n\\sigma_{\\hat{\\mu}}^2 = \\mathrm{Var}\\left(\\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}} \\boldsymbol{y}\\right).\n$$\n使用规则 $\\mathrm{Var}(\\boldsymbol{A}\\boldsymbol{y}) = \\boldsymbol{A} \\mathrm{Cov}(\\boldsymbol{y}) \\boldsymbol{A}^T$，其中 $\\boldsymbol{A} = \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}$ 且 $\\mathrm{Cov}(\\boldsymbol{y}) = \\boldsymbol{\\Sigma}$：\n$$\n\\sigma_{\\hat{\\mu}}^2 = \\left(\\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}\\right) \\boldsymbol{\\Sigma} \\left(\\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}\\right)^T = \\frac{1}{(\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s})^2} (\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1}) \\boldsymbol{\\Sigma} (\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{s}).\n$$\n因为 $\\boldsymbol{\\Sigma}$ 是对称的，所以 $(\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1})^T = \\boldsymbol{\\Sigma}^{-T}\\boldsymbol{s} = \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{s}$。简化表达式：\n$$\n\\sigma_{\\hat{\\mu}}^2 = \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}{(\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s})^2} = \\frac{1}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}}.\n$$\n因此，估计量的标准差是 $\\sigma_{\\hat{\\mu}} = (\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s})^{-1/2}$。\n\n### 第3部分：单边上限的推导\n\n我们使用 Wald 近似，该近似指出对于大样本，MLE $\\hat{\\mu}$ 近似地服从以真值 $\\mu_{\\text{true}}$ 为中心、方差为 $\\sigma_{\\hat{\\mu}}^2$ 的正态分布：$\\hat{\\mu} \\sim \\mathcal{N}(\\mu_{\\text{true}}, \\sigma_{\\hat{\\mu}}^2)$。\n\n为了在置信水平 $1-\\alpha$ 下找到单边上限 $\\mu_{\\text{up}}$，我们采用反演假设检验的标准方法。我们找到 $\\mu_{\\text{up}}$ 的值，使得如果它是真实的信号强度，观测到的结果与唯本底假设的相容性至少与我们实际观测到的 ($\\hat{\\mu}_{\\text{obs}}$) 一样好的概率等于 $\\alpha$。与唯本底假设相容意味着估计的信号强度值更小（或更负）。\n因此，对于一个假设的信号强度 $\\mu$，p 值为 $p_{\\mu} = P(\\hat{\\mu} \\le \\hat{\\mu}_{\\text{obs}} | \\mu_{\\text{true}}=\\mu)$。\n$$\np_{\\mu} = P\\left(\\frac{\\hat{\\mu} - \\mu}{\\sigma_{\\hat{\\mu}}} \\le \\frac{\\hat{\\mu}_{\\text{obs}} - \\mu}{\\sigma_{\\hat{\\mu}}}\\right) = \\Phi\\left(\\frac{\\hat{\\mu}_{\\text{obs}} - \\mu}{\\sigma_{\\hat{\\mu}}}\\right),\n$$\n其中 $\\Phi$ 是标准正态分布 $\\mathcal{N}(0, 1)$ 的累积分布函数（CDF）。上限 $\\mu_{\\text{up}}$ 是使得 $p_{\\mu} = \\alpha$ 的 $\\mu$ 值：\n$$\n\\Phi\\left(\\frac{\\hat{\\mu}_{\\text{obs}} - \\mu_{\\text{up}}}{\\sigma_{\\hat{\\mu}}}\\right) = \\alpha.\n$$\n设 $Z_{\\alpha} = \\Phi^{-1}(\\alpha)$ 是标准正态分布的 $\\alpha$-分位数。那么：\n$$\n\\frac{\\hat{\\mu}_{\\text{obs}} - \\mu_{\\text{up}}}{\\sigma_{\\hat{\\mu}}} = Z_{\\alpha}.\n$$\n解出 $\\mu_{\\text{up}}$：\n$$\n\\mu_{\\text{up}} = \\hat{\\mu}_{\\text{obs}} - Z_{\\alpha} \\sigma_{\\hat{\\mu}}.\n$$\n使用恒等式 $Z_{\\alpha} = -Z_{1-\\alpha}$，表达式变为：\n$$\n\\mu_{\\text{up}} = \\hat{\\mu}_{\\text{obs}} + Z_{1-\\alpha} \\sigma_{\\hat{\\mu}}.\n$$\n问题指定使用 Asimov 数据集，其中观测数据等于标称本底期望，即 $\\boldsymbol{y} = \\boldsymbol{b}$。对于这个数据集，$\\boldsymbol{d} = \\boldsymbol{y} - \\boldsymbol{b} = \\boldsymbol{0}$。观测到的估计量是：\n$$\n\\hat{\\mu}_{\\text{obs}} = \\frac{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{0}}{\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s}} = 0.\n$$\n这个值满足物理约束 $\\mu \\ge 0$。上限的公式简化为：\n$$\n\\mu_{\\text{up}} = Z_{1-\\alpha} \\sigma_{\\hat{\\mu}} = Z_{1-\\alpha} (\\boldsymbol{s}^T \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{s})^{-1/2}.\n$$\n对于 $95\\%$ CL，$\\alpha = 0.05$，且 $Z_{0.95} \\approx 1.64485$。\n\n### 第4部分：具体问题的应用\n\n最后一步是为每个测试情况构建协方差矩阵 $\\boldsymbol{\\Sigma}(\\kappa)$ 并应用推导出的公式。\n总协方差为 $\\boldsymbol{\\Sigma}(\\kappa) = \\boldsymbol{\\Sigma}_{\\text{stat}} + \\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa)$。\n- 信号向量：$\\boldsymbol{s} = (3.0, 2.0, 1.5)^T$。\n- 本底向量：$\\boldsymbol{b} = (25.0, 18.0, 12.0)^T$。\n- 统计协方差：$\\boldsymbol{\\Sigma}_{\\text{stat}} = \\mathrm{diag}(b_1, b_2, b_3) = \\mathrm{diag}(25, 18, 12)$。\n- 系统协方差 $\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa)$：\n  - $(\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa))_{11} = (f_{12} b_1)^2 = (0.08 \\times 25.0)^2 = 4.0$。\n  - $(\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa))_{22} = (f_{12} b_2)^2 = (0.08 \\times 18.0)^2 = 2.0736$。\n  - $(\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa))_{33} = (f_3 b_3)^2 = (0.10 \\times 12.0)^2 = 1.44$。\n  - 受 $\\kappa$ 影响的非对角项是：\n    $(\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa))_{12} = (\\boldsymbol{\\Sigma}_{\\text{sys}}(\\kappa))_{21} = \\kappa \\rho_{12} f_{12}^2 b_1 b_2 = \\kappa \\times 0.7 \\times 0.08^2 \\times 25.0 \\times 18.0 = 2.016 \\kappa$。\n  - 所有其他非对角元均为 $0$。\n\n对于给定的 $\\kappa$，完整的协方差矩阵是：\n$$\n\\boldsymbol{\\Sigma}(\\kappa) = \\begin{pmatrix} 25  0  0 \\\\ 0  18  0 \\\\ 0  0  12 \\end{pmatrix} + \\begin{pmatrix} 4.0  2.016\\kappa  0 \\\\ 2.016\\kappa  2.0736  0 \\\\ 0  0  1.44 \\end{pmatrix} = \\begin{pmatrix} 29.0  2.016\\kappa  0 \\\\ 2.016\\kappa  20.0736  0 \\\\ 0  0  13.44 \\end{pmatrix}.\n$$\n对于测试套件中的每个 $\\kappa \\in \\{1.0, 0.5, 0.0, 1.3\\}$，我们将计算这个矩阵，求其逆矩阵，计算 $\\boldsymbol{s}^T \\boldsymbol{\\Sigma}(\\kappa)^{-1} \\boldsymbol{s}$，最后计算 $\\mu_{\\text{up}}(\\kappa)$。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Calculates the 95% CL upper limit on the signal strength parameter mu\n    for a 3-channel combination problem with varying correlation misspecification.\n    \"\"\"\n    \n    # Define problem inputs\n    s_vec = np.array([3.0, 2.0, 1.5])\n    b_vec = np.array([25.0, 18.0, 12.0])\n    \n    f12 = 0.08\n    rho12 = 0.7\n    f3 = 0.10\n    alpha = 0.05\n    \n    # Test cases for the correlation inflation factor kappa\n    test_cases = [1.0, 0.5, 0.0, 1.3]\n    \n    results = []\n    \n    # Calculate the quantile of the standard normal distribution\n    # for a one-sided 95% confidence interval\n    z_val = norm.ppf(1 - alpha)\n    \n    # Calculate the statistical covariance matrix (diagonal)\n    # This component is independent of kappa\n    sigma_stat = np.diag(b_vec)\n    \n    for kappa in test_cases:\n        # Step 1: Construct the covariance matrix Sigma(kappa)\n        \n        # Initialize the systematic covariance matrix\n        sigma_sys_k = np.zeros((3, 3))\n        \n        # Calculate diagonal elements of the systematic covariance matrix\n        sigma_sys_k[0, 0] = (f12 * b_vec[0])**2\n        sigma_sys_k[1, 1] = (f12 * b_vec[1])**2\n        sigma_sys_k[2, 2] = (f3 * b_vec[2])**2\n        \n        # Calculate the off-diagonal element for channels 1 and 2\n        off_diag = kappa * rho12 * (f12**2) * b_vec[0] * b_vec[1]\n        sigma_sys_k[0, 1] = off_diag\n        sigma_sys_k[1, 0] = off_diag\n        \n        # The full covariance is the sum of statistical and systematic components\n        sigma_k = sigma_stat + sigma_sys_k\n        \n        # Step 2: Calculate the standard deviation of the mu estimator\n        \n        # Invert the covariance matrix\n        sigma_inv_k = np.linalg.inv(sigma_k)\n        \n        # Calculate the Fisher information for mu (s^T * Sigma^-1 * s)\n        fisher_info_mu = s_vec.T @ sigma_inv_k @ s_vec\n        \n        # The standard deviation of the mu estimator is sqrt(1 / Fisher_info)\n        sigma_mu = np.sqrt(1 / fisher_info_mu)\n        \n        # Step 3: Calculate the 95% CL upper limit\n        \n        # For the Asimov dataset (y=b), the best-fit mu_hat is 0.\n        # The upper limit mu_up = mu_hat + Z * sigma_mu = 0 + Z * sigma_mu\n        mu_up = z_val * sigma_mu\n        \n        results.append(mu_up)\n        \n    # Format the final output as specified\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "3533325"}, {"introduction": "在设计复杂的物理分析时，预估其实验灵敏度是一项至关重要的工作。这项高级练习介绍了高能物理领域广泛使用的$CL_s$方法和Asimov数据集的概念，旨在推导出预期上限的渐近解析公式。通过解决这个问题，你将掌握用于实验设计和评估发现潜力的强大分析工具，理解其背后的统计原理 [@problem_id:3533347]。", "problem": "对单参数信号强度假设 $ \\mu \\ge 0 $ 使用剖面似然比检验统计量 $ q_{\\mu} \\equiv -2 \\ln \\lambda(\\mu) $ 进行检验，其中 $ \\lambda(\\mu) $ 是由数据和讨厌参数 $ \\boldsymbol{\\theta} $ 的似然函数 $ L(\\mu,\\boldsymbol{\\theta}) $ 构建的剖面似然比。在大样本情况下，假设对于单边检验，瓦尔德展开成立：\n- 如果 $ \\hat{\\mu} \\le \\mu $，则 $ q_{\\mu} \\approx \\frac{(\\mu - \\hat{\\mu})^{2}}{\\sigma^{2}} $，\n- 如果 $ \\hat{\\mu}  \\mu $，则 $ q_{\\mu} = 0 $，\n其中 $ \\hat{\\mu} $ 是 $ \\mu $ 的最大似然估计量，$ \\sigma $ 是在真实参数值下计算的 $ \\hat{\\mu} $ 的渐近标准差。\n\n进一步假设，在数据生成（真实）信号强度为 $ \\mu' $ 的情况下，$ \\hat{\\mu} \\sim \\mathcal{N}(\\mu', \\sigma^{2}) $，并且在考虑了上述单边截断的情况下，$ q_{\\mu} $ 的分布可以很好地由一个自由度为1、非中心参数为 $ \\Lambda = \\frac{(\\mu - \\mu')^{2}}{\\sigma^{2}} $ 的非中心卡方分布来近似。\n\n定义修正置信水平 (CLs) 为\n$$\nCL_{s}(\\mu) \\equiv \\frac{p_{\\mu}}{1 - p_{b}},\n$$\n其中 $ p_{\\mu} = \\Pr(q_{\\mu} \\ge q_{\\mu,\\text{obs}} \\mid \\mu \\text{ is true}) $ 和 $ p_{b} = \\Pr(q_{\\mu} \\ge q_{\\mu,\\text{obs}} \\mid \\mu'=0) $ 分别是同一检验统计量 $ q_{\\mu} $ 在信号假设和本底假设 ($ \\mu'=0 $) 下的尾部概率。\n\n为了构建预期上限中位数，将观测到的检验统计量设置为其在本底假设下的阿西莫夫值（阿西莫夫数据集被定义为等于模型期望的理想化数据集，它确定性地得出 $ \\hat{\\mu}_{A} = \\mu' $ 和 $ q_{\\mu,A} = -2 \\ln \\lambda_{A}(\\mu) $）。用 $ \\sigma $ 表示在 $ \\mu'=0 $ 处计算的 $ \\hat{\\mu} $ 的阿西莫夫标准差。\n\n仅使用上述假设，推导并求解方程 $ CL_{s}(\\mu) = \\alpha $，以得到预期上限中位数 $ \\mu_{\\text{up}} $ 的闭合形式解，并用 $ \\sigma $、$ \\alpha $ 以及标准正态累积分布函数 $ \\Phi(\\cdot) $ 及其反函数 $ \\Phi^{-1}(\\cdot) $ 表示最终答案。不需要进行数值计算。请以单个解析表达式的形式提供最终答案。由于 $ \\mu $ 是无量纲的，因此不需要物理单位。", "solution": "首先对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 一个单参数信号强度假设 $ \\mu \\ge 0 $。\n- 剖面似然比检验统计量为 $ q_{\\mu} \\equiv -2 \\ln \\lambda(\\mu) $，来自似然函数 $ L(\\mu,\\boldsymbol{\\theta}) $。\n- 在大样本情况下，单边检验的瓦尔德展开成立：\n  - 如果 $ \\hat{\\mu} \\le \\mu $，则 $ q_{\\mu} \\approx \\frac{(\\mu - \\hat{\\mu})^{2}}{\\sigma^{2}} $。\n  - 如果 $ \\hat{\\mu} > \\mu $，则 $ q_{\\mu} = 0 $。\n- $ \\hat{\\mu} $ 是 $ \\mu $ 的最大似然估计量。\n- 在真实信号强度 $ \\mu' $ 下，估计量的分布为 $ \\hat{\\mu} \\sim \\mathcal{N}(\\mu', \\sigma^{2}) $。\n- 修正置信水平 (CLs) 定义为 $CL_{s}(\\mu) \\equiv \\frac{p_{\\mu}}{1 - p_{b}}$。\n- $ p_{\\mu} = \\Pr(q_{\\mu} \\ge q_{\\mu,\\text{obs}} \\mid \\mu \\text{ is true}) $，这意味着真实信号强度为 $ \\mu' = \\mu $。\n- $ p_{b} = \\Pr(q_{\\mu} \\ge q_{\\mu,\\text{obs}} \\mid \\mu'=0) $。\n- 对于预期上限中位数，观测检验统计量 $ q_{\\mu,\\text{obs}} $ 被设置为其在本底假设 ($ \\mu'=0 $) 下的阿西莫夫值。\n- 阿西莫夫数据集定义为估计量取其期望值，$ \\hat{\\mu}_{A} = \\mu' $。\n- $ \\sigma $ 是在 $ \\mu'=0 $ 时计算的 $ \\hat{\\mu} $ 的阿西莫夫标准差。\n- 任务是求解方程 $ CL_{s}(\\mu) = \\alpha $ 以得到预期上限中位数 $ \\mu_{\\text{up}} $ 的闭合形式解。\n\n### 步骤2：使用提取的已知条件进行验证\n问题陈述是严谨的，并提供了推导所需的所有统计假设。这些假设（瓦尔德近似、高斯MLE分布、阿西莫夫数据集）是高能物理中用于推导预期灵敏度渐近公式的标准框架。问题在科学上是合理的且定义明确。\n\n### 步骤3：推导预期上限中位数\n\n我们的目标是求解方程 $ CL_{s}(\\mu_{\\text{up}}) = \\alpha $。我们需要分别计算 $ p_{\\mu} $ 和 $ p_b $ 的表达式。\n\n**1. 确定阿西莫夫观测值 $ q_{\\mu,\\text{obs}} $**\n\n预期上限是在“典型”的仅本底实验中预期的上限。这个“典型”实验由阿西莫夫数据集表示，其中观测数据等于仅本底假设（$\\mu'=0$）下的期望值。根据定义，这导致最大似然估计量取其期望值，即 $\\hat{\\mu}_{\\text{obs}} = \\hat{\\mu}_{A} = \\mu' = 0$。\n\n现在，我们将这个观测值代入检验统计量的定义中。我们正在检验一个假设 $\\mu > 0$，而我们的观测值是 $\\hat{\\mu}_{\\text{obs}} = 0$。由于 $\\hat{\\mu}_{\\text{obs}} = 0 \\le \\mu$，我们使用瓦尔德展开的第一种情况：\n$$\nq_{\\mu,\\text{obs}} = q_{\\mu,A} = \\frac{(\\mu - \\hat{\\mu}_{\\text{obs}})^{2}}{\\sigma^{2}} = \\frac{(\\mu - 0)^{2}}{\\sigma^{2}} = \\frac{\\mu^{2}}{\\sigma^{2}}\n$$\n\n**2. 计算 $p_{\\mu}$**\n\n$ p_{\\mu} $ 是在信号假设（即真实参数 $\\mu'=\\mu$）下，得到比 $q_{\\mu,\\text{obs}}$ 更极端结果的概率。\n$$\np_{\\mu} = \\Pr(q_{\\mu} \\ge q_{\\mu,\\text{obs}} \\mid \\mu'=\\mu)\n$$\n在此假设下，估计量 $\\hat{\\mu}$ 服从 $\\mathcal{N}(\\mu, \\sigma^2)$ 分布。\n条件 $q_{\\mu} \\ge q_{\\mu, \\text{obs}}$ 意味着 $\\frac{(\\mu - \\hat{\\mu})^{2}}{\\sigma^{2}} \\ge \\frac{\\mu^{2}}{\\sigma^{2}}$ （当 $\\hat{\\mu} \\le \\mu$ 时；否则 $q_\\mu=0$）。\n这简化为 $(\\mu - \\hat{\\mu})^2 \\ge \\mu^2$。由于我们处于 $\\hat{\\mu} \\le \\mu$ 的区域，$\\mu - \\hat{\\mu} \\ge 0$。因此，我们可以对两边取平方根，得到 $\\mu - \\hat{\\mu} \\ge \\mu$，这进一步简化为 $\\hat{\\mu} \\le 0$。\n因此，概率变为：\n$$\np_{\\mu} = \\Pr(\\hat{\\mu} \\le 0 \\mid \\mu'=\\mu)\n$$\n为了计算这个概率，我们将 $\\hat{\\mu}$ 标准化。令 $Z = (\\hat{\\mu} - \\mu)/\\sigma$，则 $Z \\sim \\mathcal{N}(0, 1)$。\n$$\np_{\\mu} = \\Pr\\left(\\frac{\\hat{\\mu} - \\mu}{\\sigma} \\le \\frac{0 - \\mu}{\\sigma}\\right) = \\Pr\\left(Z \\le -\\frac{\\mu}{\\sigma}\\right) = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right)\n$$\n其中 $\\Phi$ 是标准正态累积分布函数。\n\n**3. 计算 $p_{b}$**\n\n$ p_{b} $ 是在仅本底假设（即真实参数 $\\mu'=0$）下，得到比 $q_{\\mu,\\text{obs}}$ 更极端结果的概率。\n$$\np_{b} = \\Pr(q_{\\mu} \\ge q_{\\mu,\\text{obs}} \\mid \\mu'=0)\n$$\n在此假设下，估计量 $\\hat{\\mu}$ 服从 $\\mathcal{N}(0, \\sigma^2)$ 分布。\n条件与之前完全相同，即 $q_{\\mu} \\ge q_{\\mu, \\text{obs}}$ 等价于 $\\hat{\\mu} \\le 0$。\n因此，概率变为：\n$$\np_{b} = \\Pr(\\hat{\\mu} \\le 0 \\mid \\mu'=0)\n$$\n标准化 $\\hat{\\mu}$，令 $Z = (\\hat{\\mu} - 0)/\\sigma$，则 $Z \\sim \\mathcal{N}(0, 1)$。\n$$\np_{b} = \\Pr\\left(\\frac{\\hat{\\mu} - 0}{\\sigma} \\le \\frac{0 - 0}{\\sigma}\\right) = \\Pr(Z \\le 0) = \\Phi(0) = \\frac{1}{2}\n$$\n\n**4. 求解 $CL_s(\\mu_{\\text{up}}) = \\alpha$**\n\n现在我们将 $p_{\\mu}$ 和 $p_b$ 的表达式代入 $CL_s$ 定义中，并令其等于 $\\alpha$ 来求解 $\\mu_{\\text{up}}$。\n$$\nCL_{s}(\\mu_{\\text{up}}) = \\frac{p_{\\mu_{\\text{up}}}}{1 - p_{b}} = \\frac{\\Phi(-\\mu_{\\text{up}}/\\sigma)}{1 - 1/2} = 2 \\Phi(-\\mu_{\\text{up}}/\\sigma) = \\alpha\n$$\n解这个方程：\n$$\n\\Phi(-\\mu_{\\text{up}}/\\sigma) = \\frac{\\alpha}{2}\n$$\n应用标准正态CDF的对称性性质 $\\Phi(-x) = 1 - \\Phi(x)$：\n$$\n1 - \\Phi(\\mu_{\\text{up}}/\\sigma) = \\frac{\\alpha}{2}\n$$\n$$\n\\Phi(\\mu_{\\text{up}}/\\sigma) = 1 - \\frac{\\alpha}{2}\n$$\n最后，应用逆累积分布函数 $\\Phi^{-1}$：\n$$\n\\frac{\\mu_{\\text{up}}}{\\sigma} = \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right)\n$$\n$$\n\\mu_{\\text{up}} = \\sigma \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right)\n$$\n这就是预期上限中位数的闭合形式解。", "answer": "$$\n\\boxed{\\sigma \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right)}\n$$", "id": "3533347"}]}