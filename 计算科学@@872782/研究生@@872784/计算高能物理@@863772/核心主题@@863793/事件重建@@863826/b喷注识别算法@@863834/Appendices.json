{"hands_on_practices": [{"introduction": "有符号撞击参数是 b 喷注标记中的一个基本观测量。它量化了径迹与主碰撞点的偏离程度，而其符号则提供了关于该偏离是否沿着喷注方向的关键信息。这个动手练习 [@problem_id:3505937] 将引导您从第一性原理出发，通过几何计算来确定这一关键变量，从而巩固您对其区分重味喷注和轻味喷注能力的理解。", "problem": "在计算高能物理的b喷注鉴别算法（b味标记）中，三维碰撞参数（IP）是一个几何量，用于量化带电粒子径迹相对于主顶点（PV）的位移。带符号的三维碰撞参数是通过根据喷注方向赋予一个符号来构建的，其目的是增强重味喷注和轻味喷注之间的鉴别能力。主顶点（PV）位于原点。喷注轴由单位向量 $\\hat{n}_{\\text{jet}} = \\left(\\frac{3}{5}, 0, \\frac{4}{5}\\right)$ 给出。考虑三条重建的带电粒子径迹。每条径迹在局部被近似为一条直线，其参数方程为 $\\vec{r}_i(t) = \\vec{r}_{0,i} + t \\hat{u}_i$，其中 $\\vec{r}_{0,i}$ 是径迹上的一个点，$\\hat{u}_i$ 是沿径迹的单位方向向量。给定的径迹和测量分辨率如下：\n- 径迹 $1$：$\\vec{r}_{0,1} = (0.4, -0.3, 0)\\ \\mathrm{mm}$，$\\hat{u}_1 = \\left(\\frac{3}{5}, \\frac{4}{5}, 0\\right)$，$\\sigma_1 = 0.03\\ \\mathrm{mm}$。\n- 径迹 $2$：$\\vec{r}_{0,2} = (0.6, 0, 0)\\ \\mathrm{mm}$，$\\hat{u}_2 = (0, 0, 1)$，$\\sigma_2 = 0.04\\ \\mathrm{mm}$。\n- 径迹 $3$：$\\vec{r}_{0,3} = (-0.6, 0, 0.2)\\ \\mathrm{mm}$，$\\hat{u}_3 = (0, 1, 0)$，$\\sigma_3 = 0.03\\ \\mathrm{mm}$。\n\n从三维欧几里得几何的第一性原理出发，对每条径迹确定其到主顶点（PV）的最近点（PCA）、三维碰撞参数的模长 $d_{3\\mathrm{D},i}$，以及其符号。该符号由PCA位移在喷注轴上的标量投影定义，即如果 $(\\vec{r}_{\\text{PCA},i} - \\vec{r}_{\\text{PV}}) \\cdot \\hat{n}_{\\text{jet}} > 0$ 则为正，如果 $(\\vec{r}_{\\text{PCA},i} - \\vec{r}_{\\text{PV}}) \\cdot \\hat{n}_{\\text{jet}} < 0$ 则为负。使用IP的高斯测量模型，其中每条径迹的分辨率为 $\\sigma_i$，构建组合的带符号碰撞参数显著性\n$$\nS \\equiv \\sum_{i=1}^{3} \\frac{d_{3\\mathrm{D},i}^{\\text{signed}}}{\\sigma_i}.\n$$\n基于物理和统计推理，讨论上述符号约定如何影响重味喷注和轻味喷注之间的鉴别能力。\n\n根据给定的数值输入计算 $S$。将您的最终答案 $S$ 四舍五入到四位有效数字。将 $S$ 表示为一个无单位的无量纲数。", "solution": "该问题经验证具有科学依据，提法明确，客观且内容完整。所有必要信息均已提供，且所涉及概念是实验高能物理的基础。我们可以开始求解。\n\n问题要求计算三条带电粒子径迹相对于位于原点 $\\vec{r}_{\\text{PV}} = \\vec{0}$ 的主顶点（PV）的组合带符号碰撞参数显著性 $S$。求解过程对每条径迹都需要几个步骤：确定最近点（PCA），计算三维碰撞参数的模长（$d_{3\\mathrm{D}}$），根据喷注方向赋予符号，最后计算显著性。\n\n带电粒子径迹 $i$ 被建模为一条参数方程为 $\\vec{r}_i(t) = \\vec{r}_{0,i} + t \\hat{u}_i$ 的直线。从主顶点（原点）到该径迹上任意一点的向量是 $\\vec{r}_i(t)$。从主顶点到该点的距离平方是 $d^2(t) = |\\vec{r}_i(t)|^2 = \\vec{r}_i(t) \\cdot \\vec{r}_i(t)$。最近点（PCA）对应于使该距离最小化的参数 $t$ 的值，记为 $t_{\\text{PCA}}$。这发生在向量 $\\vec{r}_i(t_{\\text{PCA}})$ 与径迹的方向向量 $\\hat{u}_i$ 正交时。\n$$\n\\frac{d}{dt} d^2(t) \\Big|_{t=t_{\\text{PCA}}} = 2 \\vec{r}_i(t_{\\text{PCA}}) \\cdot \\frac{d\\vec{r}_i}{dt} = 2 \\vec{r}_i(t_{\\text{PCA}}) \\cdot \\hat{u}_i = 0\n$$\n代入径迹的参数方程：\n$$\n(\\vec{r}_{0,i} + t_{\\text{PCA},i} \\hat{u}_i) \\cdot \\hat{u}_i = 0\n$$\n$$\n\\vec{r}_{0,i} \\cdot \\hat{u}_i + t_{\\text{PCA},i} (\\hat{u}_i \\cdot \\hat{u}_i) = 0\n$$\n由于 $\\hat{u}_i$ 是单位向量，$\\hat{u}_i \\cdot \\hat{u}_i = 1$。这给出了在PCA处的参数值：\n$$\nt_{\\text{PCA},i} = -(\\vec{r}_{0,i} \\cdot \\hat{u}_i)\n$$\nPCA的位置向量则为：\n$$\n\\vec{r}_{\\text{PCA},i} = \\vec{r}_{0,i} + t_{\\text{PCA},i} \\hat{u}_i = \\vec{r}_{0,i} - (\\vec{r}_{0,i} \\cdot \\hat{u}_i) \\hat{u}_i\n$$\n三维碰撞参数的模长 $d_{3\\mathrm{D},i}$ 是从主顶点（原点）到该点的距离：\n$$\nd_{3\\mathrm{D},i} = |\\vec{r}_{\\text{PCA},i}|\n$$\n碰撞参数的符号由PCA向量与喷注轴单位向量 $\\hat{n}_{\\text{jet}} = \\left(\\frac{3}{5}, 0, \\frac{4}{5}\\right)$ 的标量积决定。\n带符号的碰撞参数是 $d_{3\\mathrm{D},i}^{\\text{signed}} = (\\text{sign}(\\vec{r}_{\\text{PCA},i} \\cdot \\hat{n}_{\\text{jet}})) d_{3\\mathrm{D},i}$。\n最后，组合显著性是 $S = \\sum_{i=1}^{3} S_i = \\sum_{i=1}^{3} \\frac{d_{3\\mathrm{D},i}^{\\text{signed}}}{\\sigma_i}$。\n\n我们现在将此过程应用于每条径迹。\n\n**径迹 1：**\n- $\\vec{r}_{0,1} = (0.4, -0.3, 0)\\ \\mathrm{mm}$\n- $\\hat{u}_1 = \\left(\\frac{3}{5}, \\frac{4}{5}, 0\\right) = (0.6, 0.8, 0)$\n- $\\sigma_1 = 0.03\\ \\mathrm{mm}$\n\n首先，我们求解 $t_{\\text{PCA},1}$：\n$$\n\\vec{r}_{0,1} \\cdot \\hat{u}_1 = (0.4)(0.6) + (-0.3)(0.8) + (0)(0) = 0.24 - 0.24 = 0\n$$\n$$\nt_{\\text{PCA},1} = -0 = 0\n$$\n这表明点 $\\vec{r}_{0,1}$ 本身就是最近点。\n$$\n\\vec{r}_{\\text{PCA},1} = \\vec{r}_{0,1} = (0.4, -0.3, 0)\\ \\mathrm{mm}\n$$\n碰撞参数的模长为：\n$$\nd_{3\\mathrm{D},1} = |\\vec{r}_{\\text{PCA},1}| = \\sqrt{(0.4)^2 + (-0.3)^2 + 0^2} = \\sqrt{0.16 + 0.09} = \\sqrt{0.25} = 0.5\\ \\mathrm{mm}\n$$\n接下来，我们使用 $\\hat{n}_{\\text{jet}} = (0.6, 0, 0.8)$ 来确定符号：\n$$\n\\vec{r}_{\\text{PCA},1} \\cdot \\hat{n}_{\\text{jet}} = (0.4)(0.6) + (-0.3)(0) + (0)(0.8) = 0.24\n$$\n由于标量积为正，符号为正。\n$$\nd_{3\\mathrm{D},1}^{\\text{signed}} = +0.5\\ \\mathrm{mm}\n$$\n径迹 $1$ 的显著性为：\n$$\nS_1 = \\frac{d_{3\\mathrm{D},1}^{\\text{signed}}}{\\sigma_1} = \\frac{0.5}{0.03} = \\frac{50}{3}\n$$\n\n**径迹 2：**\n- $\\vec{r}_{0,2} = (0.6, 0, 0)\\ \\mathrm{mm}$\n- $\\hat{u}_2 = (0, 0, 1)$\n- $\\sigma_2 = 0.04\\ \\mathrm{mm}$\n\n求解 $t_{\\text{PCA},2}$：\n$$\n\\vec{r}_{0,2} \\cdot \\hat{u}_2 = (0.6)(0) + (0)(0) + (0)(1) = 0\n$$\n$$\nt_{\\text{PCA},2} = -0 = 0\n$$\n所以，$\\vec{r}_{\\text{PCA},2} = \\vec{r}_{0,2} = (0.6, 0, 0)\\ \\mathrm{mm}$。\n碰撞参数的模长为：\n$$\nd_{3\\mathrm{D},2} = |\\vec{r}_{\\text{PCA},2}| = \\sqrt{(0.6)^2 + 0^2 + 0^2} = 0.6\\ \\mathrm{mm}\n$$\n确定符号：\n$$\n\\vec{r}_{\\text{PCA},2} \\cdot \\hat{n}_{\\text{jet}} = (0.6)(0.6) + (0)(0) + (0)(0.8) = 0.36\n$$\n标量积为正，所以符号为正。\n$$\nd_{3\\mathrm{D},2}^{\\text{signed}} = +0.6\\ \\mathrm{mm}\n$$\n径迹 $2$ 的显著性为：\n$$\nS_2 = \\frac{d_{3\\mathrm{D},2}^{\\text{signed}}}{\\sigma_2} = \\frac{0.6}{0.04} = 15\n$$\n\n**径迹 3：**\n- $\\vec{r}_{0,3} = (-0.6, 0, 0.2)\\ \\mathrm{mm}$\n- $\\hat{u}_3 = (0, 1, 0)$\n- $\\sigma_3 = 0.03\\ \\mathrm{mm}$\n\n求解 $t_{\\text{PCA},3}$：\n$$\n\\vec{r}_{0,3} \\cdot \\hat{u}_3 = (-0.6)(0) + (0)(1) + (0.2)(0) = 0\n$$\n$$\nt_{\\text{PCA},3} = -0 = 0\n$$\n所以，$\\vec{r}_{\\text{PCA},3} = \\vec{r}_{0,3} = (-0.6, 0, 0.2)\\ \\mathrm{mm}$。\n碰撞参数的模长为：\n$$\nd_{3\\mathrm{D},3} = |\\vec{r}_{\\text{PCA},3}| = \\sqrt{(-0.6)^2 + 0^2 + (0.2)^2} = \\sqrt{0.36 + 0.04} = \\sqrt{0.4}\\ \\mathrm{mm}\n$$\n确定符号：\n$$\n\\vec{r}_{\\text{PCA},3} \\cdot \\hat{n}_{\\text{jet}} = (-0.6)(0.6) + (0)(0) + (0.2)(0.8) = -0.36 + 0.16 = -0.20\n$$\n标量积为负，所以符号为负。\n$$\nd_{3\\mathrm{D},3}^{\\text{signed}} = -\\sqrt{0.4}\\ \\mathrm{mm}\n$$\n径迹 $3$ 的显著性为：\n$$\nS_3 = \\frac{d_{3\\mathrm{D},3}^{\\text{signed}}}{\\sigma_3} = \\frac{-\\sqrt{0.4}}{0.03}\n$$\n\n**组合显著性：**\n总显著性 $S$ 是各个显著性之和：\n$$\nS = S_1 + S_2 + S_3 = \\frac{50}{3} + 15 + \\frac{-\\sqrt{0.4}}{0.03}\n$$\n我们通分并合并各项：\n$$\nS = \\frac{50}{3} + \\frac{45}{3} - \\frac{\\sqrt{0.4}}{0.03} = \\frac{95}{3} - \\frac{\\sqrt{4 \\times 10^{-1}}}{3 \\times 10^{-2}} = \\frac{95}{3} - \\frac{2 \\times 10^{-1/2}}{3 \\times 10^{-2}}\n$$\n让我们将其表示为更便于数值计算的形式：\n$$\nS = \\frac{95}{3} - \\frac{\\sqrt{0.4}}{0.03} = \\frac{95}{3} - \\frac{\\sqrt{4/10}}{3/100} = \\frac{95}{3} - \\frac{2/\\sqrt{10}}{3/100} = \\frac{95}{3} - \\frac{200}{3\\sqrt{10}}\n$$\n$$\nS = \\frac{1}{3} \\left( 95 - \\frac{200}{\\sqrt{10}} \\right) = \\frac{1}{3} \\left( 95 - \\frac{200\\sqrt{10}}{10} \\right) = \\frac{1}{3} (95 - 20\\sqrt{10})\n$$\n现在，我们计算数值：\n$$\nS \\approx \\frac{1}{3} (95 - 20 \\times 3.16227766) = \\frac{1}{3} (95 - 63.2455532) = \\frac{31.7544468}{3} \\approx 10.5848156\n$$\n四舍五入到四位有效数字得到 $10.58$。\n\n**关于鉴别能力的讨论：**\n使用带符号的碰撞参数显著增强了区分源于重味夸克（底夸克、粲夸克）的喷注与源于轻味夸克（上夸克、下夸克、奇夸克）或胶子的喷注的能力。其物理原因如下：\n\n$1$. **重味喷注：** 含有b夸克的强子（B强子）具有约 $1.5 \\times 10^{-12}\\ \\mathrm{s}$ 的可观寿命。在高能碰撞中，它们以大的洛伦兹因子产生，使其能够在衰变前从主相互作用点（PV）飞越一段宏观距离（通常在毫米量级）。这个衰变点形成一个有位移的次级顶点（SV）。源于该SV的带电粒子的径迹在反向外推时不会指向PV。因此，这些径迹表现出较大的碰撞参数。关键在于，SV相对于PV的位移方向是 *沿着* B强子的运动方向，而B强子的运动方向与整个喷注轴 $\\hat{n}_{\\text{jet}}$ 高度相关。因此，从PV到这样一条径迹的PCA的位移向量 $\\vec{r}_{\\text{PCA}}$，在喷注轴上的投影往往为正。这导致带符号碰撞参数的分布主要为正值。\n\n$2$. **轻味喷注：** 轻夸克和胶子会迅速强子化，这意味着产生的喷注中的粒子实际上都源于PV。对这些径迹测得的任何非零碰撞参数主要归因于径迹探测器的有限分辨率和多重散射。这些效应本质上是随机的。向量 $\\vec{r}_{\\text{PCA}}$ 在垂直于径迹的平面内将具有随机的朝向。因此，其在喷注轴上的投影 $\\vec{r}_{\\text{PCA}} \\cdot \\hat{n}_{\\text{jet}}$ 为正和为负的概率大致相等。由此产生的带符号碰撞参数的分布关于零对称。\n\n$3$. **统计分离：** 通过对带符号的碰撞参数显著性求和，$S = \\sum_i S_i$，我们利用了这一差异。对于重味喷注，各个项 $S_i$ 大多为正且相干地相加，从而得到一个大的正值 $S$。对于轻味喷注，各项 $S_i$ 是正负混合的，倾向于相互抵消，导致 $S$ 的值与围绕零的随机游走一致。因此，重味喷注（“信号”）的检验统计量 $S$ 的分布将具有一个大的正均值，而轻味喷注（“背景”）的分布将以零为中心。因此，对足够大的 $S$ 值进行筛选，可以有效地选择出重味喷注富集的喷注样本。", "answer": "$$\n\\boxed{10.58}\n$$", "id": "3505937"}, {"introduction": "虽然单个径迹能提供线索，但将来自同个次级作用点的多条径迹信息结合起来，可以形成一个更为强大的特征信号。本练习 [@problem_id:3505861] 深入探讨了次级顶点重建的统计过程，您将使用最大似然法来寻找最佳顶点位置及其不确定度。通过计算飞行距离显著性，您将学会如何量化一个顶点是否真正偏离了主相互作用点这一判断的可信度。", "problem": "在计算高能物理中，底夸克喷注鉴别（b-tagging）的一个关键组成部分是重建一个离位的次级顶点，其位置是根据带电粒子的径迹来估计的。考虑卡尔曼滤波器框架内静态情况下的一个特例，即线性高斯测量模型：次级顶点在横向平面中的位置，用向量 $\\mathbf{r} \\in \\mathbb{R}^{2}$ 表示。假设有一组 $N$ 条重建径迹，每条径迹都对同一个顶点位置提供了一个无偏高斯估计 $\\mathbf{r}_{i}$，其已知的协方差矩阵 $\\mathbf{C}_{i}$ 是对称正定的。在给定 $\\mathbf{r}$ 的条件下，这些径迹是条件独立的。主顶点（PV）的位置 $\\mathbf{r}_{\\mathrm{PV}}$ 已知，其高斯不确定度由协方差矩阵 $\\mathbf{V}_{\\mathrm{PV}}$ 描述。一个单位向量 $\\hat{\\mathbf{u}}$ 近似表示横向平面中的喷注轴。沿 $\\hat{\\mathbf{u}}$ 的飞行距离是投影 $L = \\hat{\\mathbf{u}}^{\\top}(\\mathbf{\\hat{r}} - \\mathbf{r}_{\\mathrm{PV}})$，其不确定度 $\\sigma_{L}$ 是通过主顶点和次级顶点协方差的线性传播得到的。\n\n从卡尔曼滤波器测量模型所隐含的高斯似然出发，构建次级顶点位置的似然函数 $\\mathcal{L}(\\mathbf{r})$，推导其最大似然估计量 $\\mathbf{\\hat{r}}$，求出最优解处的顶点卡方值 $\\chi^{2}$，并展示如何根据后验协方差 $\\mathbf{V}_{\\mathrm{SV}}$ 和 $\\mathbf{V}_{\\mathrm{PV}}$ 计算飞行距离显著性 $S = L / \\sigma_{L}$。\n\n然后，对于以下单位为毫米的科学真实数据集，计算飞行距离显著性。使用毫米作为距离单位，并将最终的显著性表示为一个纯数。将最终答案四舍五入到四位有效数字。\n\n径迹 ($N = 3$):\n- 径迹 1: $\\mathbf{r}_{1} = \\begin{pmatrix} 0.50 \\\\ 0.30 \\end{pmatrix}$, $\\mathbf{C}_{1} = \\begin{pmatrix} (0.040)^{2}  0 \\\\ 0  (0.040)^{2} \\end{pmatrix}$.\n- 径迹 2: $\\mathbf{r}_{2} = \\begin{pmatrix} 0.62 \\\\ 0.28 \\end{pmatrix}$, $\\mathbf{C}_{2} = \\begin{pmatrix} (0.040)^{2}  0 \\\\ 0  (0.040)^{2} \\end{pmatrix}$.\n- 径迹 3: $\\mathbf{r}_{3} = \\begin{pmatrix} 0.55 \\\\ 0.35 \\end{pmatrix}$, $\\mathbf{C}_{3} = \\begin{pmatrix} (0.040)^{2}  0 \\\\ 0  (0.040)^{2} \\end{pmatrix}$.\n\n主顶点 (PV): $\\mathbf{r}_{\\mathrm{PV}} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$, $\\mathbf{V}_{\\mathrm{PV}} = \\begin{pmatrix} (0.010)^{2}  0 \\\\ 0  (0.010)^{2} \\end{pmatrix}$.\n\n喷注轴单位向量: $\\hat{\\mathbf{u}} = \\begin{pmatrix} 0.8 \\\\ 0.6 \\end{pmatrix}$.", "solution": "用户提供的问题已经过验证，被认为是具有科学依据、良定、客观和完整的。在**高**能物理的背景下，所有提供的数据和条件都是一致且符合实际的。该问题是最大似然估计和误差传播的一个标准应用。因此，我们可以着手求解。\n\n该问题要求推导顶点拟合中的关键量，并对飞行距离显著性进行数值计算。我们将首先给出理论推导，然后将其应用于给定的数据集。\n\n**第一部分：理论推导**\n\n设真实的次级顶点 (SV) 位置为二维向量 $\\mathbf{r}$。我们有 $N$ 个测量值（径迹），其中每条径迹 $i$ 提供了顶点位置的一个估计 $\\mathbf{r}_i$。每条径迹的测量模型是一个多元高斯分布，其均值为 $\\mathbf{r}$，协方差矩阵 $\\mathbf{C}_i$ 已知且为对称正定。在给定 $\\mathbf{r}$ 的条件下，观测到 $\\mathbf{r}_i$ 的概率密度函数为：\n$$p(\\mathbf{r}_i | \\mathbf{r}) = \\frac{1}{2\\pi \\sqrt{\\det(\\mathbf{C}_i)}} \\exp\\left(-\\frac{1}{2}(\\mathbf{r}_i - \\mathbf{r})^{\\top} \\mathbf{C}_i^{-1} (\\mathbf{r}_i - \\mathbf{r})\\right)$$\n在给定 $\\mathbf{r}$ 的条件下，这些径迹是条件独立的，因此这组 $N$ 条径迹的总似然函数 $\\mathcal{L}(\\mathbf{r})$ 是各个概率密度的乘积：\n$$\\mathcal{L}(\\mathbf{r}) = \\prod_{i=1}^{N} p(\\mathbf{r}_i | \\mathbf{r})$$\n在计算上，处理负对数似然更为方便，它与一个卡方函数 $\\chi^2(\\mathbf{r})$ 成正比：\n$$\\chi^2(\\mathbf{r}) = -2 \\ln \\mathcal{L}(\\mathbf{r}) + \\text{const} = \\sum_{i=1}^{N} (\\mathbf{r}_i - \\mathbf{r})^{\\top} \\mathbf{C}_i^{-1} (\\mathbf{r}_i - \\mathbf{r})$$\n顶点位置的最大似然估计量 (MLE)，记为 $\\mathbf{\\hat{r}}$，是使 $\\chi^2(\\mathbf{r})$ 最小化的 $\\mathbf{r}$ 值。我们通过将 $\\chi^2(\\mathbf{r})$ 对 $\\mathbf{r}$ 的梯度设为零来求得此值：\n$$\\nabla_{\\mathbf{r}} \\chi^2(\\mathbf{r}) = \\sum_{i=1}^{N} \\nabla_{\\mathbf{r}} \\left( (\\mathbf{r}_i - \\mathbf{r})^{\\top} \\mathbf{C}_i^{-1} (\\mathbf{r}_i - \\mathbf{r}) \\right) = \\sum_{i=1}^{N} -2 \\mathbf{C}_i^{-1} (\\mathbf{r}_i - \\mathbf{r}) = \\mathbf{0}$$\n除以 $-2$ 并整理各项可得：\n$$\\sum_{i=1}^{N} \\mathbf{C}_i^{-1} \\mathbf{r}_i - \\left(\\sum_{i=1}^{N} \\mathbf{C}_i^{-1}\\right) \\mathbf{r} = \\mathbf{0}$$\n解出 $\\mathbf{r}$ 即可得到最大似然估计量 $\\mathbf{\\hat{r}}$：\n$$\\mathbf{\\hat{r}} = \\left(\\sum_{i=1}^{N} \\mathbf{C}_i^{-1}\\right)^{-1} \\left(\\sum_{i=1}^{N} \\mathbf{C}_i^{-1} \\mathbf{r}_i\\right)$$\n这是一个广义加权平均，其中每个测量的权重矩阵是其协方差矩阵的逆，即 $\\mathbf{W}_i = \\mathbf{C}_i^{-1}$。估计的次级顶点位置的后验协方差矩阵 $\\mathbf{V}_{\\mathrm{SV}}$ 由权重矩阵之和的逆给出：\n$$\\mathbf{V}_{\\mathrm{SV}} = \\left(\\sum_{i=1}^{N} \\mathbf{C}_i^{-1}\\right)^{-1}$$\n最优解处的顶点卡方值是在 $\\mathbf{\\hat{r}}$ 处计算的 $\\chi^2$ 函数值：\n$$\\chi^{2}_{\\text{vertex}} = \\sum_{i=1}^{N} (\\mathbf{r}_i - \\mathbf{\\hat{r}})^{\\top} \\mathbf{C}_i^{-1} (\\mathbf{r}_i - \\mathbf{\\hat{r}})$$\n这个量可作为顶点拟合的拟合优度度量。\n\n接下来，我们讨论飞行距离显著性。飞行距离 $L$ 是位移向量 $(\\mathbf{\\hat{r}} - \\mathbf{r}_{\\mathrm{PV}})$ 在喷注轴单位向量 $\\hat{\\mathbf{u}}$ 上的投影：\n$$L = \\hat{\\mathbf{u}}^{\\top}(\\mathbf{\\hat{r}} - \\mathbf{r}_{\\mathrm{PV}})$$\n$L$ 的不确定度，记为 $\\sigma_L$，通过线性误差传播求得。位移向量 $\\mathbf{d} = \\mathbf{\\hat{r}} - \\mathbf{r}_{\\mathrm{PV}}$ 的协方差矩阵 $\\mathbf{V_d}$ 是 $\\mathbf{\\hat{r}}$ 和 $\\mathbf{r}_{\\mathrm{PV}}$ 的协方差之和，因为它们是独立变量（主顶点位置的确定独立于构成次级顶点的径迹）。\n$$\\mathbf{V_d} = \\mathbf{V}_{\\mathrm{SV}} + \\mathbf{V}_{\\mathrm{PV}}$$\n标量投影 $L = \\hat{\\mathbf{u}}^{\\top}\\mathbf{d}$ 的方差由下式给出：\n$$\\sigma_L^2 = \\hat{\\mathbf{u}}^{\\top} \\mathbf{V_d} \\hat{\\mathbf{u}} = \\hat{\\mathbf{u}}^{\\top} (\\mathbf{V}_{\\mathrm{SV}} + \\mathbf{V}_{\\mathrm{PV}}) \\hat{\\mathbf{u}}$$\n飞行距离显著性 $S$ 是飞行距离与其不确定度的比值：\n$$S = \\frac{L}{\\sigma_L} = \\frac{\\hat{\\mathbf{u}}^{\\top}(\\mathbf{\\hat{r}} - \\mathbf{r}_{\\mathrm{PV}})}{\\sqrt{\\hat{\\mathbf{u}}^{\\top} (\\mathbf{V}_{\\mathrm{SV}} + \\mathbf{V}_{\\mathrm{PV}}) \\hat{\\mathbf{u}}}}$$\n\n**第二部分：数值计算**\n\n我们得到以下单位为毫米的数据集：\n径迹数量：$N=3$。\n径迹位置：$\\mathbf{r}_{1} = \\begin{pmatrix} 0.50 \\\\ 0.30 \\end{pmatrix}$，$\\mathbf{r}_{2} = \\begin{pmatrix} 0.62 \\\\ 0.28 \\end{pmatrix}$，$\\mathbf{r}_{3} = \\begin{pmatrix} 0.55 \\\\ 0.35 \\end{pmatrix}$。\n径迹协方差：$\\mathbf{C}_{1} = \\mathbf{C}_{2} = \\mathbf{C}_{3} = \\mathbf{C} = \\begin{pmatrix} (0.040)^{2}  0 \\\\ 0  (0.040)^{2} \\end{pmatrix} = \\begin{pmatrix} 0.0016  0 \\\\ 0  0.0016 \\end{pmatrix}$。\n主顶点位置：$\\mathbf{r}_{\\mathrm{PV}} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n主顶点协方差：$\\mathbf{V}_{\\mathrm{PV}} = \\begin{pmatrix} (0.010)^{2}  0 \\\\ 0  (0.010)^{2} \\end{pmatrix} = \\begin{pmatrix} 0.0001  0 \\\\ 0  0.0001 \\end{pmatrix}$。\n喷注轴单位向量：$\\hat{\\mathbf{u}} = \\begin{pmatrix} 0.8 \\\\ 0.6 \\end{pmatrix}$。\n\n由于所有径迹的协方差 $\\mathbf{C}_i$ 都相同且等于 $\\mathbf{C}$，$\\mathbf{\\hat{r}}$ 的公式简化为算术平均值：\n$$\\mathbf{\\hat{r}} = \\left(N \\mathbf{C}^{-1}\\right)^{-1} \\left(\\mathbf{C}^{-1} \\sum_{i=1}^{N} \\mathbf{r}_i\\right) = \\frac{1}{N} \\mathbf{C} \\mathbf{C}^{-1} \\sum_{i=1}^{N} \\mathbf{r}_i = \\frac{1}{N} \\sum_{i=1}^{N} \\mathbf{r}_i$$\n计算 $\\mathbf{\\hat{r}}$：\n$$\\mathbf{\\hat{r}} = \\frac{1}{3} \\left( \\begin{pmatrix} 0.50 \\\\ 0.30 \\end{pmatrix} + \\begin{pmatrix} 0.62 \\\\ 0.28 \\end{pmatrix} + \\begin{pmatrix} 0.55 \\\\ 0.35 \\end{pmatrix} \\right) = \\frac{1}{3} \\begin{pmatrix} 1.67 \\\\ 0.93 \\end{pmatrix} = \\begin{pmatrix} 1.67/3 \\\\ 0.31 \\end{pmatrix}$$\n飞行距离 $L$ 为：\n$$L = \\hat{\\mathbf{u}}^{\\top}(\\mathbf{\\hat{r}} - \\mathbf{r}_{\\mathrm{PV}}) = \\begin{pmatrix} 0.8  0.6 \\end{pmatrix} \\left( \\begin{pmatrix} 1.67/3 \\\\ 0.31 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\right)$$\n$$L = 0.8 \\times \\frac{1.67}{3} + 0.6 \\times 0.31 = \\frac{1.336}{3} + 0.186 = \\frac{1.336 + 3 \\times 0.186}{3} = \\frac{1.336 + 0.558}{3} = \\frac{1.894}{3} \\approx 0.63133...$$\n现在我们计算不确定度。首先，次级顶点的协方差 $\\mathbf{V}_{\\mathrm{SV}}$ 为：\n$$\\mathbf{V}_{\\mathrm{SV}} = \\left(\\sum_{i=1}^{3} \\mathbf{C}^{-1}\\right)^{-1} = (3 \\mathbf{C}^{-1})^{-1} = \\frac{1}{3} \\mathbf{C} = \\frac{1}{3} \\begin{pmatrix} 0.0016  0 \\\\ 0  0.0016 \\end{pmatrix}$$\n位移向量的总协方差为：\n$$\\mathbf{V}_{\\mathrm{SV}} + \\mathbf{V}_{\\mathrm{PV}} = \\begin{pmatrix} \\frac{0.0016}{3}  0 \\\\ 0  \\frac{0.0016}{3} \\end{pmatrix} + \\begin{pmatrix} 0.0001  0 \\\\ 0  0.0001 \\end{pmatrix} = \\begin{pmatrix} \\frac{0.0016}{3} + 0.0001  0 \\\\ 0  \\frac{0.0016}{3} + 0.0001 \\end{pmatrix}$$\n$$\\mathbf{V}_{\\mathrm{SV}} + \\mathbf{V}_{\\mathrm{PV}} = \\begin{pmatrix} \\frac{0.0016+0.0003}{3}  0 \\\\ 0  \\frac{0.0016+0.0003}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{0.0019}{3}  0 \\\\ 0  \\frac{0.0019}{3} \\end{pmatrix} = \\frac{0.0019}{3} \\mathbf{I}$$\n其中 $\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。\n飞行距离的方差 $\\sigma_L^2$ 为：\n$$\\sigma_L^2 = \\hat{\\mathbf{u}}^{\\top} \\left( \\frac{0.0019}{3} \\mathbf{I} \\right) \\hat{\\mathbf{u}} = \\frac{0.0019}{3} (\\hat{\\mathbf{u}}^{\\top} \\hat{\\mathbf{u}})$$\n由于 $\\hat{\\mathbf{u}}$ 是一个单位向量，$\\hat{\\mathbf{u}}^{\\top} \\hat{\\mathbf{u}} = \\|\\hat{\\mathbf{u}}\\|^2 = 0.8^2 + 0.6^2 = 0.64 + 0.36 = 1$。\n因此，方差就是标量前因子：\n$$\\sigma_L^2 = \\frac{0.0019}{3} \\approx 0.0006333...$$\n不确定度 $\\sigma_L$ 是其平方根：\n$$\\sigma_L = \\sqrt{\\frac{0.0019}{3}} \\approx 0.025166...$$\n最后，飞行距离显著性 $S$ 为：\n$$S = \\frac{L}{\\sigma_L} = \\frac{1.894/3}{\\sqrt{0.0019/3}} \\approx \\frac{0.63133...}{0.025166...} \\approx 25.08643...$$\n将结果四舍五入到四位有效数字，我们得到 $25.09$。", "answer": "$$\\boxed{25.09}$$", "id": "3505861"}, {"introduction": "现代 b 喷注标记算法严重依赖于机器学习，但将原始的物理观测量直接输入神经网络通常并非最佳选择。这个计算练习 [@problem_id:3505888] 探讨了特征工程这一关键步骤，检验了不同的径迹特征参数化和归一化方案如何影响训练过程的数值稳定性。您将定量评估这些影响，并发现基于物理知识构建的不变性特征表示的优势。", "problem": "设计并实现一个程序，用于定量评估不同的带电粒子径迹特征参数化和归一化选择，如何影响在通过底喷注标记识别底夸克喷注的背景下，一个简单前馈神经网络代理模型所使用的输入设计矩阵的数值条件。该研究必须侧重于标准的逐径迹参数化选择和一组模拟常见探测器级讨厌变量的变换，并且必须提出并测试基于物理学知识的不变特征缩放方法。\n\n从标准的五参数逐径迹表示法开始：横向撞击参数 $d_0$、纵向撞击参数 $z_0$、方位角 $\\phi$、极角 $\\theta$ 以及电荷动量比 $q/p$。所有角度都必须以弧度为单位。对每个测试案例，使用以下物理上合理的生成模型来生成一个包含 $N$ 条径迹的合成样本：\n- 从一个对瞬发径迹和次级径迹进行混合建模的分布中抽取 $d_0$（单位为毫米）：以概率 $f_{\\mathrm{disp}}$ 从 $d_0 \\sim \\mathcal{N}(\\mu_{\\mathrm{disp}},\\sigma_{\\mathrm{disp}})$ 中抽样，以概率 $1 - f_{\\mathrm{disp}}$ 从 $d_0 \\sim \\mathcal{N}(0,\\sigma_{d_0})$ 中抽样，其中 $\\mu_{\\mathrm{disp}}$ 和 $\\sigma_{\\mathrm{disp}}$ 是单位为毫米的正常数。\n- 从 $z_0 \\sim \\mathcal{N}(0,\\sigma_{z_0})$ 中抽取 $z_0$（单位为毫米）。\n- 从 $[-\\pi,\\pi)$ 上的均匀分布中抽取 $\\phi$。\n- 从 $[-1,1]$ 上均匀抽取 $\\cos\\theta$，并设置 $\\theta = \\arccos(\\cos\\theta)$。\n- 从一个中位数量级在几个吉电子伏特附近的对数正态分布中抽取粒子动量 $p$（单位为吉电子伏特），并从 $\\{-1,+1\\}$ 中均匀选择电荷 $q$；设置 $q/p$ 的单位为 $\\mathrm{GeV}^{-1}$。\n\n对应用于整个事件的两种具有物理动机的讨厌变换进行建模：\n- 按角度 $\\alpha$ 进行全局方位角旋转：$\\phi \\mapsto \\phi' = \\phi + \\alpha$，然后折叠到 $[-\\pi,\\pi)$ 区间内。\n- 按 $(\\Delta x,\\Delta y)$（单位为毫米）进行横向束斑平移。在小弧度近似下，带符号的横向撞击参数 $d_0$ 近似变换为 $d_0' = d_0 + \\Delta x \\cdot (-\\sin\\phi') + \\Delta y \\cdot \\cos\\phi'$，而 $z_0$、$\\theta$ 和 $q/p$ 在纯横向平移下保持不变。\n\n定义并比较三种应用于逐径迹特征的归一化或缩放方案：\n- 方案 A（原始）：使用五个原始特征 $(d_0,z_0,\\phi,\\theta,q/p)$，不进行任何归一化。\n- 方案 B（z-score）：对五个原始特征中的每一个，减去在测试案例的径迹上计算出的样本均值，并除以样本标准差。\n- 方案 C（基于物理学知识的不变性）：构建一个无量纲、有界的特征集，该特征集对角度折叠不敏感，并且对全局旋转的敏感度降低。使用以下映射和尺度：\n  - 用数对 $(\\cos\\phi,\\sin\\phi)$ 替换 $\\phi$。\n  - 用数对 $(\\cos\\theta,\\sin\\theta)$ 替换 $\\theta$。\n  - 用特征分辨率 $\\sigma_{d_0}$ 缩放 $d_0$，得到 $d_0/\\sigma_{d_0}$。\n  - 用 $\\sigma_{z_0}$ 缩放 $z_0$，得到 $z_0/\\sigma_{z_0}$。\n  - 用参考动量 $p_{\\mathrm{ref}}$ 缩放 $q/p$，得到 $(q/p)\\cdot p_{\\mathrm{ref}}$。\n  得到的特征向量有七个分量 $(d_0/\\sigma_{d_0}, z_0/\\sigma_{z_0}, \\cos\\phi, \\sin\\phi, \\cos\\theta, \\sin\\theta, (q/p)\\cdot p_{\\mathrm{ref}})$。\n\n使用 $N \\times d$ 设计矩阵 $X$ 的 $2$-范数条件数 $\\kappa_2(X)$ 作为数值稳定性的代理指标，其中 $d$ 是给定方案的特征维度（$5$ 或 $7$）。对于每个测试案例和方案，通过奇异值分解计算 $\\kappa_2(X)$。\n\n实现以下测试套件，所有测试均使用 $N = 5000$ 条径迹和固定的随机种子 $42$ 以确保可复现性，并使用以下参数值：\n- 混合模型参数：$f_{\\mathrm{disp}} = 0.1$, $\\mu_{\\mathrm{disp}} = 0.5\\,\\mathrm{mm}$, $\\sigma_{\\mathrm{disp}} = 0.1\\,\\mathrm{mm}$, $\\sigma_{d_0} = 0.05\\,\\mathrm{mm}$, $\\sigma_{z_0} = 1.0\\,\\mathrm{mm}$。\n- 动量分布：$\\ln p \\sim \\mathcal{N}(\\ln 5, 0.6^2)$，单位为 $\\mathrm{GeV}$。\n- 用于基于物理学知识缩放的参考动量：$p_{\\mathrm{ref}} = 10.0\\,\\mathrm{GeV}$。\n\n测试案例，每个案例由 $(\\alpha,\\Delta x,\\Delta y,s)$ 定义，其中 $s$ 作用于整个事件的 $q/p$：\n1. 基准：$(0, 0, 0, 1)$。\n2. 纯旋转：$(\\pi/2, 0, 0, 1)$。\n3. 纯平移：$(0, 0.2, -0.1, 1)$，其中 $\\Delta x$ 和 $\\Delta y$ 的单位为毫米。\n4. 旋转和动量扭曲：$(\\pi/3, 0, 0, 3)$。\n\n对于每个测试案例，按以下顺序计算并记录三个浮点数结果：方案 A、方案 B 和方案 C 的 $2$-范数条件数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,\\dots,r_{12}]$），其中 $r_{3k-2}$、$r_{3k-1}$ 和 $r_{3k}$ 对应于上述序列中第 $k$ 个测试案例的三种方案的结果。\n\n程序中的所有物理量必须遵守指定的单位。最终输出是无量纲的浮点数。给定固定的随机种子，程序必须是确定性的，并且不得需要用户输入或外部文件。", "solution": "该问题要求对不同的特征参数化和归一化方案如何影响用于 b 喷注识别的机器学习背景下的设计矩阵的数值条件进行定量分析。数值稳定性将使用设计矩阵 $X$ 的 $2$-范数条件数 $\\kappa_2(X)$ 进行评估。高条件数意味着输入数据的微小扰动可能导致线性代数运算（这是神经网络等训练算法的基础）的输出发生巨大变化，从而可能导致收敛缓慢或训练不稳定。我们将实现一个具有物理动机的带电粒子径迹生成模型，应用实际的讨厌变换，使用三种不同方案构建设计矩阵，并计算它们的条件数。\n\n首先，我们为包含 $N$ 条带电粒子径迹的合成样本建立生成模型。每条径迹由五个标准参数描述：横向撞击参数 $d_0$（单位为 mm）、纵向撞击参数 $z_0$（单位为 mm）、方位角 $\\phi$（单位为弧度）、极角 $\\theta$（单位为弧度）和电荷动量比 $q/p$（单位为 $\\mathrm{GeV}^{-1}$）。所选分布具有物理代表性：\n- $d_0$：两个高斯分布的混合模型模拟了 b 喷注中径迹的两个主要来源。一个窄的高斯分布 $\\mathcal{N}(0, \\sigma_{d_0})$ 代表源自主要相互作用顶点的“瞬发”径迹。一个更宽且有位移的高斯分布 $\\mathcal{N}(\\mu_{\\mathrm{disp}}, \\sigma_{\\mathrm{disp}})$ 代表来自长寿命 B 强子衰变的“次级”径迹，这些 B 强子在衰变前会行进一段可测量的距离。有 $f_{\\mathrm{disp}}$ 比例的径迹来自这个次级径迹群体。\n- $z_0$：单个高斯分布 $\\mathcal{N}(0, \\sigma_{z_0})$ 模拟了径迹起点沿束流轴的弥散。\n- $\\phi$ 和 $\\theta$：$\\phi$ 在 $[-\\pi, \\pi)$ 上的均匀分布以及 $\\cos\\theta$ 在 $[-1, 1]$ 上的均匀分布反映了粒子的各向同性或柱对称产生，这是一种常见的近似。然后通过 $\\theta = \\arccos(\\cos\\theta)$ 推导出 $\\theta$，其自然落在 $[0, \\pi]$ 区间内。\n- $q/p$：动量大小 $p$ 从对数正态分布中抽取，这对于喷注中粒子陡峭下降的动量谱是一个很好的经验模型。电荷 $q$ 从 $\\{-1, +1\\}$ 中均匀选择。\n\n接下来，我们将常见的实验系统不确定性建模为应用于整组径迹的讨厌变换：\n1.  全局方位角旋转 $\\phi \\mapsto \\phi' = \\phi + \\alpha$。\n2.  横向束斑平移 $(\\Delta x, \\Delta y)$，这会移动假定的原点。根据一阶近似，这会影响横向撞击参数：$d_0' = d_0 - \\Delta x \\sin\\phi' + \\Delta y \\cos\\phi'$。该公式正确地使用了旋转后的角度 $\\phi'$，因为撞击参数是在最终坐标系中几何定义的。\n3.  对 $q/p$ 进行缩放 $q/p \\mapsto s \\cdot (q/p)$，用以模拟磁场或动量重建尺度的潜在标定误差。\n\n然后，我们使用三种不同的方案构建 $N \\times d$ 的设计矩阵 $X$，其中 $d$ 是特征的数量。\n- **方案 A（原始）**：特征是未经转换的原始物理量 $(d_0, z_0, \\phi, \\theta, q/p)$。这些特征具有不同的物理单位和数值尺度（例如，$d_0 \\sim 10^{-1}$ mm vs. $\\phi \\sim 1$ rad），众所周知这会产生条件恶劣的矩阵。维度为 $d=5$。\n- **方案 B（Z-score）**：对五个原始特征中的每一个单独进行标准化，即减去其样本均值并除以其样本标准差。这使得所有特征的均值为 $0$，标准差为 $1$。虽然这种变换在统一尺度上是有效的，但它是数据依赖的，并且会破坏原始数据中存在的任何固有物理对称性或不变性。维度为 $d=5$。\n- **方案 C（基于物理学知识的不变性）**：该方案利用物理洞察力来创建更鲁棒的特征集。维度为 $d=7$。\n    - 角度 $\\phi$ 和 $\\theta$ 分别被映射到 $(\\cos\\phi, \\sin\\phi)$ 和 $(\\cos\\theta, \\sin\\theta)$。这消除了在折叠点（例如 $\\phi=-\\pi$ vs. $\\phi=\\pi$）的人为不连续性，并将旋转表示为二维子空间中的线性变换，这更易于机器学习模型处理。\n    - $d_0$ 和 $z_0$ 通过其特征分辨率 $\\sigma_{d_0}$ 和 $\\sigma_{z_0}$ 进行缩放，产生量级为 1 的无量纲量 $d_0/\\sigma_{d_0}$ 和 $z_0/\\sigma_{z_0}$。\n    - 电荷动量比 $q/p$ 通过参考动量 $p_{\\mathrm{ref}}$ 进行缩放，以产生另一个无量纲特征 $(q/p) \\cdot p_{\\mathrm{ref}}$。\n    这种方法旨在通过设计创建无量纲、具有相似数值范围并在指定的讨厌变换下表现出更稳定行为的特征。\n\n分析的核心是计算 $2$-范数条件数 $\\kappa_2(X)$，其定义为矩阵 $X$ 的最大奇异值与最小奇异值的比值：$\\kappa_2(X) = \\sigma_{\\max} / \\sigma_{\\min}$。我们使用奇异值分解（SVD）来计算奇异值。$\\kappa_2(X) \\approx 1$ 是理想情况，表示一个条件良好的矩阵。数值大则表示条件差。\n\n实现过程将首先使用固定的随机种子生成一个包含 $N=5000$ 条径迹的数据集以保证可复现性。对于四个测试案例中的每一个——它们应用了不同的讨厌变换组合——我们将生成数据，应用变换，为方案 A、B 和 C 构建设计矩阵，并计算它们各自的条件数。这种系统性比较将揭示哪种特征工程策略在面对真实的实验变化时能产生数值最稳定的表示。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# language: Python\n# version: 3.12\n# libraries:\n#   name: numpy, version: 1.23.5\n#   name: scipy, version: 1.11.4\n\ndef generate_tracks(N, seed, f_disp, mu_disp, sigma_disp, sigma_d0, sigma_z0, p_log_mean, p_log_std):\n    \"\"\"\n    Generates a synthetic sample of N tracks based on the specified physical model.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n\n    # 1. Generate d_0 from the mixture model\n    is_displaced = rng.uniform(0, 1, N)  f_disp\n    n_disp = np.sum(is_displaced)\n    n_prompt = N - n_disp\n    \n    d0 = np.zeros(N, dtype=np.float64)\n    d0[is_displaced] = rng.normal(loc=mu_disp, scale=sigma_disp, size=n_disp)\n    d0[~is_displaced] = rng.normal(loc=0.0, scale=sigma_d0, size=n_prompt)\n\n    # 2. Generate z_0\n    z0 = rng.normal(loc=0.0, scale=sigma_z0, size=N)\n\n    # 3. Generate phi\n    phi = rng.uniform(-np.pi, np.pi, size=N)\n\n    # 4. Generate theta\n    cos_theta = rng.uniform(-1.0, 1.0, size=N)\n    theta = np.arccos(cos_theta)\n\n    # 5. Generate q/p\n    log_p = rng.normal(loc=p_log_mean, scale=p_log_std, size=N)\n    p = np.exp(log_p)\n    q = rng.choice([-1, 1], size=N)\n    q_over_p = q / p\n\n    return d0, z0, phi, theta, q_over_p, cos_theta\n\ndef apply_transformations(d0, z0, phi, theta, q_over_p, alpha, delta_x, delta_y, s):\n    \"\"\"\n    Applies event-wide nuisance transformations to the track features.\n    \"\"\"\n    # Apply azimuthal rotation and wrap to [-pi, pi)\n    phi_prime = np.arctan2(np.sin(phi + alpha), np.cos(phi + alpha))\n\n    # Apply beamspot translation\n    d0_prime = d0 - delta_x * np.sin(phi_prime) + delta_y * np.cos(phi_prime)\n    \n    # z0 and theta are unchanged by these transformations\n    z0_prime = z0\n    theta_prime = theta\n\n    # Apply momentum scale distortion\n    q_over_p_prime = q_over_p * s\n    \n    return d0_prime, z0_prime, phi_prime, theta_prime, q_over_p_prime\n\ndef compute_condition_number(X):\n    \"\"\"\n    Computes the 2-norm condition number of matrix X using SVD.\n    \"\"\"\n    try:\n        s = np.linalg.svd(X, compute_uv=False)\n        # Check for singularity\n        if s[-1]  1e-12:  # Use a small tolerance for floating point\n            return np.inf\n        return s[0] / s[-1]\n    except np.linalg.LinAlgError:\n        # This can happen for ill-conditioned matrices, though unlikely here.\n        return np.inf\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and analysis.\n    \"\"\"\n    # Global parameters\n    N = 5000\n    RANDOM_SEED = 42\n    \n    # Generative model parameters\n    F_DISP = 0.1\n    MU_DISP = 0.5  # mm\n    SIGMA_DISP = 0.1  # mm\n    SIGMA_D0 = 0.05  # mm\n    SIGMA_Z0 = 1.0  # mm\n    P_LOG_MEAN = np.log(5.0) # Corresponds to median p = 5 GeV\n    P_LOG_STD = 0.6\n    \n    # Physics-informed scaling parameters\n    P_REF = 10.0  # GeV\n\n    # Test cases: (alpha, delta_x, delta_y, s)\n    test_cases = [\n        (0.0, 0.0, 0.0, 1.0),          # 1. Baseline\n        (np.pi / 2, 0.0, 0.0, 1.0),    # 2. Pure rotation\n        (0.0, 0.2, -0.1, 1.0),         # 3. Pure translation\n        (np.pi / 3, 0.0, 0.0, 3.0),    # 4. Rotation and momentum distortion\n    ]\n\n    all_results = []\n\n    # Generate base tracks once\n    d0_raw, z0_raw, phi_raw, theta_raw, q_over_p_raw, cos_theta_raw = generate_tracks(\n        N, RANDOM_SEED, F_DISP, MU_DISP, SIGMA_DISP, SIGMA_D0, SIGMA_Z0, P_LOG_MEAN, P_LOG_STD\n    )\n\n    for alpha, delta_x, delta_y, s in test_cases:\n        # Apply transformations for the current test case\n        d0_t, z0_t, phi_t, theta_t, q_over_p_t = apply_transformations(\n            d0_raw, z0_raw, phi_raw, theta_raw, q_over_p_raw, alpha, delta_x, delta_y, s\n        )\n        \n        # --- Scheme A: Raw features ---\n        X_A = np.column_stack([d0_t, z0_t, phi_t, theta_t, q_over_p_t])\n        kappa_A = compute_condition_number(X_A)\n        all_results.append(kappa_A)\n\n        # --- Scheme B: Z-score normalization ---\n        # Note: Mean and std are calculated on the transformed data for this test case\n        mean_A = np.mean(X_A, axis=0)\n        std_A = np.std(X_A, axis=0)\n        # Avoid division by zero if a feature is constant (highly unlikely)\n        std_A[std_A == 0] = 1.0\n        X_B = (X_A - mean_A) / std_A\n        kappa_B = compute_condition_number(X_B)\n        all_results.append(kappa_B)\n        \n        # --- Scheme C: Physics-informed invariant scaling ---\n        # Note: This scheme uses the transformed values, but its scales are fixed constants.\n        d0_scaled = d0_t / SIGMA_D0\n        z0_scaled = z0_t / SIGMA_Z0\n        cos_phi = np.cos(phi_t)\n        sin_phi = np.sin(phi_t)\n        # The original cos_theta is unaffected by the transformations\n        cos_theta_t = np.cos(theta_t) # theta_t is same as theta_raw\n        sin_theta = np.sin(theta_t)\n        q_over_p_scaled = q_over_p_t * P_REF\n        \n        X_C = np.column_stack([\n            d0_scaled, z0_scaled, cos_phi, sin_phi, cos_theta_t, sin_theta, q_over_p_scaled\n        ])\n        kappa_C = compute_condition_number(X_C)\n        all_results.append(kappa_C)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.6f}' for r in all_results)}]\")\n\nsolve()\n```", "id": "3505888"}]}