{"hands_on_practices": [{"introduction": "从连续时间的物理理论到离散时间的计算算法的转换，是计算科学中的核心挑战。本练习将指导您从朗之万动力学的倒向Kolmogorov算符出发，构建一个对称的二阶积分方案 [@problem_id:3496417]。这个过程不仅能加深您对随机积分器背后数学原理的理解，还能让您掌握分析其弱精度阶数的方法，这是评估和开发高级采样算法的关键技能。", "problem": "考虑一个在$d$维空间中，由$n$个粒子组成的系统，其在绝对温度$T>0$下的朗之万(Langevin)动力学。系统的位置为$q \\in \\mathbb{R}^{nd}$，动量为$p \\in \\mathbb{R}^{nd}$。设质量矩阵为$M = m I_{nd}$，其中$m>0$；摩擦系数为$\\gamma>0$；势能为$U(q)$，其导数光滑。其伊藤(Itô)意义下的随机微分方程为\n$$\n\\mathrm{d}q \\;=\\; M^{-1} p \\,\\mathrm{d}t, \n\\qquad\n\\mathrm{d}p \\;=\\; -\\nabla U(q)\\,\\mathrm{d}t \\;-\\; \\gamma p\\,\\mathrm{d}t \\;+\\; \\sqrt{2\\gamma \\beta^{-1} M}\\,\\mathrm{d}W_t,\n$$\n其中$\\beta = (k_B T)^{-1}$，$k_B$是玻尔兹曼(Boltzmann)常数，$W_t$是$\\mathbb{R}^{nd}$上的标准维纳(Wiener)过程。记数值时间步长为$\\Delta t>0$。您可以假设确保该系统不变密度存在性、唯一性、遍历性和光滑性的所有标准条件均成立。\n\n1) 从光滑测试函数$\\psi(q,p)$的后向科尔莫戈罗夫(Kolmogorov)生成元出发，\n$$\n\\mathcal{L}\\psi \\;=\\; (M^{-1}p)\\cdot\\nabla_q \\psi \\;-\\; \\nabla U(q)\\cdot \\nabla_p \\psi \\;-\\; \\gamma p\\cdot \\nabla_p \\psi \\;+\\; \\gamma \\beta^{-1}\\, M : \\nabla_p \\nabla_p \\psi,\n$$\n将$\\mathcal{L}$分解为三个子生成元，分别对应由动量引起的$q$的输运、由力引起的$p$的确定性冲量，以及$p$的奥恩斯坦-乌伦贝克(Ornstein–Uhlenbeck)热化。利用这些子流的精确解，构建一个在单个时间步长$\\Delta t$上的对称二阶特罗特(Trotter)（斯特朗(Strang)）分裂格式，该格式以五阶段对称组合的方式交替执行这些子流。写出从$(q^n,p^n)$到$(q^{n+1},p^{n+1})$一步的显式闭式更新形式。\n\n2) 仅使用上述定义和由微分算子生成的半群的标准组合理论，证明此对称格式的单步数值传播子拥有一个修正的后向生成元，其形式为\n$$\n\\mathcal{L}_{\\Delta t} \\;=\\; \\mathcal{L} \\;+\\; \\Delta t^{2} \\mathcal{L}_2 \\;+\\; \\mathcal{O}(\\Delta t^{4}),\n$$\n其中$\\mathcal{L}_2$是某个具有光滑系数的微分算子。然后论证，对于任何仅依赖于位形的光滑可观测量$\\varphi(q)$，当$\\Delta t \\to 0$时，由该数值格式计算的长时间平均值收敛于精确的正则平均值，其偏差为$\\Delta t^{2}$阶。您可以使用遍历定理、积分器定义的马尔可夫链存在光滑不变密度，以及光滑生成元微扰下不变测度的标准微扰理论，但不能使用任何针对该特定格式的现成公式。\n\n报告您推导的对称格式在$\\Delta t \\to 0$极限下对位形平均$\\varphi(q)$所实现的弱阶$p$（以纯数字形式）。您最终报告的值必须是一个不带单位的纯数字。不需要四舍五入。", "solution": "该问题陈述是计算统计力学中一个有效且适定的问题。它要求推导和分析一种用于朗之万动力学的数值积分器。所有提供的信息在科学上都是合理的且自洽的。我将开始进行解答。\n\n该问题分为两部分。第一部分要求基于后向科尔莫戈罗夫生成元的分裂，构建一个用于朗之万动力学的对称二阶数值积分格式。第二部分要求分析该格式对于长时间位形平均的领头阶误差项。\n\n设系统的状态为$(q,p) \\in \\mathbb{R}^{nd} \\times \\mathbb{R}^{nd}$。在朗之万动力学下，光滑测试函数$\\psi(q,p)$的时间演化由后向科尔莫戈罗夫方程$\\frac{\\partial \\mathbb{E}[\\psi(q_t,p_t)]}{\\partial t} = \\mathcal{L} \\mathbb{E}[\\psi(q_t,p_t)]$控制，其中生成元$\\mathcal{L}$由下式给出：\n$$\n\\mathcal{L}\\psi \\;=\\; (M^{-1}p)\\cdot\\nabla_q \\psi \\;-\\; \\nabla U(q)\\cdot \\nabla_p \\psi \\;-\\; \\gamma p\\cdot \\nabla_p \\psi \\;+\\; \\gamma \\beta^{-1}\\, M : \\nabla_p \\nabla_p \\psi\n$$\n记号$A:B$表示弗罗贝尼乌斯(Frobenius)内积，即$\\sum_{ij} A_{ij} B_{ij}$。由于质量矩阵为$M = m I_{nd}$，该项可简化为$\\gamma \\beta^{-1} m \\sum_{i=1}^{nd} \\frac{\\partial^2 \\psi}{\\partial p_i^2} = \\gamma \\beta^{-1} m \\Delta_p \\psi$。\n\n### 第1部分：对称分裂格式的构建\n\n首先，我们按要求将生成元$\\mathcal{L}$分解为三个部分。\n1.  **$q$的输运（位置漂移，称之为A）：** 对应于项$(M^{-1}p)\\cdot\\nabla_q \\psi$。相关的算子是$\\mathcal{L}_A = (M^{-1}p)\\cdot\\nabla_q$。动力学方程为$\\mathrm{d}q = M^{-1}p \\, \\mathrm{d}t$和$\\mathrm{d}p=0$。\n\n2.  **$p$的确定性冲量（力更新，称之为B）：** 对应于项$-\\nabla U(q)\\cdot \\nabla_p \\psi$。相关的算子是$\\mathcal{L}_B = -\\nabla U(q)\\cdot \\nabla_p$。动力学方程为$\\mathrm{d}q=0$和$\\mathrm{d}p = -\\nabla U(q) \\, \\mathrm{d}t$。\n\n3.  **$p$的奥恩斯坦-乌伦贝克热化（称之为O）：** 对应于其余项，这些项描述了与热浴的耦合。相关的算子是$\\mathcal{L}_O = -\\gamma p\\cdot \\nabla_p + \\gamma \\beta^{-1} M : \\nabla_p \\nabla_p$。动力学方程为$\\mathrm{d}q=0$和$\\mathrm{d}p = -\\gamma p \\, \\mathrm{d}t + \\sqrt{2\\gamma \\beta^{-1} M} \\, \\mathrm{d}W_t$。\n\n完整的生成元是$\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_O$。为构建数值格式，我们使用特罗特-斯特朗分裂。传播子$\\exp(\\Delta t \\mathcal{L})$的一个对称五阶段组合可以构造为：\n$$\n\\mathcal{S}_{\\Delta t} = \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_O\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp(\\Delta t \\mathcal{L}_B) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_O\\right)\n$$\n这是一个回文组合，保证了二阶精度。要实现它，我们需要每个子问题在时间步长$t$内的精确解（流）。\n\n**精确子流：**\n设$(q(0), p(0))$是每个子问题的初始状态。\n-   **$\\mathcal{L}_A$在时间$t$上的流：** $\\Phi_A^t(q(0), p(0))$\n    $\\dot{q} = M^{-1}p = m^{-1}p$，$\\dot{p}=0$。\n    解：$p(t) = p(0)$，$q(t) = q(0) + t m^{-1} p(0)$。\n\n-   **$\\mathcal{L}_B$在时间$t$上的流：** $\\Phi_B^t(q(0), p(0))$\n    $\\dot{q}=0$，$\\dot{p}=-\\nabla U(q)$。由于$q$是常数，这是一个简单的更新。\n    解：$q(t) = q(0)$，$p(t) = p(0) - t \\nabla U(q(0))$。\n\n-   **$\\mathcal{L}_O$在时间$t$上的流：** $\\Phi_O^t(q(0), p(0))$\n    $\\mathrm{d}q=0$，$\\mathrm{d}p = -\\gamma p \\, \\mathrm{d}t + \\sqrt{2\\gamma k_B T m} \\, \\mathrm{d}W_t$。这是$p$的每个分量上的标准奥恩斯坦-乌伦贝克过程。其精确解传播一个高斯分布。单个实现由下式给出：\n    $p(t) = p(0) \\exp(-\\gamma t) + \\sqrt{k_B T m(1-\\exp(-2\\gamma t))} R$，其中$R \\in \\mathbb{R}^{nd}$是一个由独立标准正态随机变量组成的向量，$R \\sim \\mathcal{N}(0, I_{nd})$。\n\n应用五阶段对称分裂，我们得到从$(q^n, p^n)$到$(q^{n+1}, p^{n+1})$在一个时间步长$\\Delta t$内的更新。设$(q^{(0)}, p^{(0)}) = (q^n, p^n)$。\n\n1.  **阶段1（O步，半步）：** 应用$\\Phi_O^{\\Delta t/2}$。位置不变。\n    $p^{(1)} = p^n \\exp\\left(-\\gamma \\frac{\\Delta t}{2}\\right) + \\sqrt{k_B T m \\left(1 - \\exp(-\\gamma \\Delta t)\\right)} R_1$\n    $q^{(1)} = q^n$\n    这里$R_1 \\sim \\mathcal{N}(0, I_{nd})$。注意平方根内指数的参数是$-2\\gamma(\\Delta t/2) = -\\gamma \\Delta t$。\n\n2.  **阶段2（A步，半步）：** 对$(q^{(1)}, p^{(1)})$应用$\\Phi_A^{\\Delta t/2}$。动量不变。\n    $q^{(2)} = q^{(1)} + \\frac{\\Delta t}{2m} p^{(1)}$\n    $p^{(2)} = p^{(1)}$\n\n3.  **阶段3（B步，整步）：** 对$(q^{(2)}, p^{(2)})$应用$\\Phi_B^{\\Delta t}$。位置不变。\n    $p^{(3)} = p^{(2)} - \\Delta t \\nabla U(q^{(2)})$\n    $q^{(3)} = q^{(2)}$\n\n4.  **阶段4（A步，半步）：** 对$(q^{(3)}, p^{(3)})$应用$\\Phi_A^{\\Delta t/2}$。动量不变。\n    $q^{(4)} = q^{(3)} + \\frac{\\Delta t}{2m} p^{(3)}$\n    $p^{(4)} = p^{(3)}$\n\n5.  **阶段5（O步，半步）：** 对$(q^{(4)}, p^{(4)})$应用$\\Phi_O^{\\Delta t/2}$。位置不变。\n    $p^{(5)} = p^{(4)} \\exp\\left(-\\gamma \\frac{\\Delta t}{2}\\right) + \\sqrt{k_B T m \\left(1 - \\exp(-\\gamma \\Delta t)\\right)} R_2$\n    $q^{(5)} = q^{(4)}$\n    这里$R_2 \\sim \\mathcal{N}(0, I_{nd})$，且与$R_1$独立。\n\n最终状态为$(q^{n+1}, p^{n+1}) = (q^{(5)}, p^{(5)})$。这一系列更新构成了显式闭式格式。\n\n### 第2部分：修正生成元与弱阶\n\n单步数值传播子$\\mathcal{S}_{\\Delta t}$可以形式上写为$\\exp(\\Delta t \\mathcal{L}_{\\Delta t})$，其中$\\mathcal{L}_{\\Delta t}$是修正的后向生成元。对于像我们构造的这种对称分裂格式，贝克尔-坎贝尔-豪斯多夫（Baker-Campbell-Hausdorff, BCH）公式确保修正生成元具有关于时间步长$\\Delta t$的偶数次幂展开：\n$$\n\\mathcal{L}_{\\Delta t} = \\mathcal{L} + \\Delta t^2 \\mathcal{L}_2 + \\Delta t^4 \\mathcal{L}_4 + \\dots\n$$\n精确生成元是$\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_O$。误差算子$\\mathcal{L}_2$是基本生成元$\\mathcal{L}_A, \\mathcal{L}_B, \\mathcal{L}_O$的嵌套对易子的和。例如，$\\mathcal{L}_A + \\mathcal{L}_B$的对称分裂（Verlet部分）以及随后与$\\mathcal{L}_O$的对称分裂都在生成元中引入了$\\mathcal{O}(\\Delta t^2)$的误差。组合后的误差算子$\\mathcal{L}_2$是一个复杂的微分算子，但其存在性由组合理论保证。由于$\\mathcal{L}_A, \\mathcal{L}_B, \\mathcal{L}_O$是具有光滑系数的微分算子（假设$U(q)$光滑），它们的对易子也是具有光滑系数的微分算子。因此，具有这些性质的算子$\\mathcal{L}_2$是存在的。\n\n现在，我们分析对位形可观测量$\\varphi(q)$的长时间平均的影响。精确的正则平均为$\\langle \\varphi \\rangle = \\int \\varphi(q) \\rho(q,p) \\mathrm{d}q \\mathrm{d}p$，其中$\\rho(q,p) \\propto \\exp(-\\beta H(q,p))$是满足$\\mathcal{L}^* \\rho = 0$的不变密度。这里$\\mathcal{L}^*$是福克-普朗克(Fokker-Planck)算子，即$\\mathcal{L}$的形式伴随算子。\n\n该数值格式作为一个遍历的马尔可夫链，拥有一个唯一的光滑不变密度$\\rho_{\\Delta t}(q,p)$，它是修正动力学的稳态解。该密度满足$\\mathcal{L}_{\\Delta t}^* \\rho_{\\Delta t} = 0$，其中$\\mathcal{L}_{\\Delta t}^* = \\mathcal{L}^* + \\Delta t^2 \\mathcal{L}_2^* + \\mathcal{O}(\\Delta t^4)$是修正生成元的伴随算子。\n\n我们使用微扰理论来寻找$\\rho_{\\Delta t}$中的误差。我们将$\\rho_{\\Delta t}$展开为$\\Delta t^2$的幂级数：\n$$\n\\rho_{\\Delta t} = \\rho + \\Delta t^2 \\rho_2 + \\mathcal{O}(\\Delta t^4)\n$$\n将此代入$\\mathcal{L}_{\\Delta t}^* \\rho_{\\Delta t} = 0$中：\n$$\n(\\mathcal{L}^* + \\Delta t^2 \\mathcal{L}_2^* + \\mathcal{O}(\\Delta t^4)) (\\rho + \\Delta t^2 \\rho_2 + \\mathcal{O}(\\Delta t^4)) = 0\n$$\n展开并按$\\Delta t$的幂次收集项：\n-   $\\mathcal{O}(1)$: $\\mathcal{L}^* \\rho = 0$。根据$\\rho$的定义，此式成立。\n-   $\\mathcal{O}(\\Delta t^2)$: $\\mathcal{L}^* \\rho_2 + \\mathcal{L}_2^* \\rho = 0$。\n\n这为一阶修正项$\\rho_2$给出了一个泊松方程：\n$$\n\\mathcal{L}^* \\rho_2 = -\\mathcal{L}_2^* \\rho\n$$\n$\\varphi(q)$长时间平均的偏差是关于$\\rho_{\\Delta t}$和$\\rho$的平均值之差：\n$$\n\\langle \\varphi \\rangle_{\\Delta t} - \\langle \\varphi \\rangle = \\int \\varphi(q) (\\rho_{\\Delta t} - \\rho) \\mathrm{d}q \\mathrm{d}p = \\Delta t^2 \\int \\varphi(q) \\rho_2(q,p) \\mathrm{d}q \\mathrm{d}p + \\mathcal{O}(\\Delta t^4)\n$$\n为了计算该积分，我们通过求解泊松方程$\\mathcal{L}\\psi = \\varphi(q) - \\langle \\varphi \\rangle$引入一个辅助函数$\\psi$。这样的解是存在的，因为右侧相对于不变测度$\\rho$的均值为零。\n该积分变为：\n\\begin{align*}\n\\int \\varphi(q) \\rho_2 \\mathrm{d}q \\mathrm{d}p = \\int (\\langle \\varphi \\rangle + \\mathcal{L}\\psi) \\rho_2 \\mathrm{d}q \\mathrm{d}p \\\\\n= \\langle \\varphi \\rangle \\int \\rho_2 \\mathrm{d}q \\mathrm{d}p + \\int (\\mathcal{L}\\psi) \\rho_2 \\mathrm{d}q \\mathrm{d}p\n\\end{align*}\n由于$\\rho$和$\\rho_{\\Delta t}$都是概率密度，它们的积分都为$1$，这意味着$\\int \\rho_2 \\mathrm{d}q \\mathrm{d}p = 0$。利用伴随性将算子$\\mathcal{L}$作用于$\\rho_2$：\n$$\n\\int \\varphi(q) \\rho_2 \\mathrm{d}q \\mathrm{d}p = \\int \\psi (\\mathcal{L}^* \\rho_2) \\mathrm{d}q \\mathrm{d}p = \\int \\psi (-\\mathcal{L}_2^* \\rho) \\mathrm{d}q \\mathrm{d}p = - \\int (\\mathcal{L}_2 \\psi) \\rho \\mathrm{d}q \\mathrm{d}p = - \\langle \\mathcal{L}_2 \\psi \\rangle\n$$\n因此，位形平均的偏差为：\n$$\n\\langle \\varphi \\rangle_{\\Delta t} - \\langle \\varphi \\rangle = -\\Delta t^2 \\langle \\mathcal{L}_2 \\psi \\rangle + \\mathcal{O}(\\Delta t^4)\n$$\n对于一般的可观测量$\\varphi(q)$，$\\langle \\mathcal{L}_2 \\psi \\rangle$项通常不为零。因此偏差为$\\Delta t^2$阶。这表明该对称格式对于正则分布的采样具有二阶精度。问题在此静态（长时间）误差的背景下使用“弱阶”一词。在此背景下，误差的阶数是领头误差项中$\\Delta t$的指数，即$2$。", "answer": "$$\\boxed{2}$$", "id": "3496417"}, {"introduction": "在分子动力学模拟中，一些看似常规的操作实际上会对模拟结果产生深刻影响。本练习将探讨一个常见的实践——移除系统质心运动——如何直接影响温度的计算以及控温器参数的设定 [@problem_id:3496428]。通过分析Nosé-Hoover控温器，您将学会如何根据系统自由度的变化精确调整算法参数，以保持一致的动力学响应，这是确保模拟物理真实性的重要一步。", "problem": "在一个周期性单元中，对$N$个相同原子进行三维分子动力学（MD）模拟，目标温度为$T_{0}$。瞬时动能定义为$K = \\sum_{i=1}^{N} \\frac{1}{2} m v_{i}^{2}$，温度通过能量均分原理从动能估算得出。该模拟在每个时间步通过从所有原子速度中减去瞬时质心（COM）速度来移除净质心（COM）运动。假设没有其他完整约束。\n\n仅从第一性原理和核心定义出发，完成以下任务：\n\n1. 推导移除质心运动如何修改基于动能的温度估算器，明确展示由此产生的自由度以及估算器对它们的依赖关系。证明当移除三个平动自由度时，对于固定的瞬时动能$K$，该估算器变化的因子。\n\n2. 考虑一个单变量Nosé–Hoover（NH）恒温器。带有质量参数$Q$的NH摩擦变量$\\xi$通过扩展的运动方程与动量耦合。在平衡点附近线性化耦合的动能-恒温器动力学，并用$g$、$k_{B}$、$T_{0}$和$Q$推导出动能涨落的小振幅弛豫频率$\\omega$，其中$g$是活性的二次自由度数目。利用此关系，确定当因移除质心运动而减少$g$时，为了保持相同的弛豫时间尺度，$Q$必须如何调整。用减少后的自由度、$k_{B}$、$T_{0}$和一个选定的时间尺度参数来符号化地表示调整后的$Q$。\n\n3. 将你的结果应用于一个$N = 1000$个原子、温度$T_{0} = 300\\,\\mathrm{K}$且已移除质心运动的系统。选择一个目标小振幅弛豫时间尺度$\\tau = 0.5\\,\\mathrm{ps}$，该时间尺度在移除质心运动前后保持不变。计算在移除质心运动后能实现相同$\\tau$的调整后的Nosé–Hoover质量参数$Q'$。以$\\mathrm{J\\,ps^{2}}$为单位表示$Q'$的最终值，并将你的答案四舍五入到四位有效数字。\n\n在你的推理中，你可以参考牛顿定律、动能的定义和能量均分定理。你不能在未从这些基础上推导的情况下假设任何恒温器特定的快捷公式。最终答案应该是$Q'$的单个数值，以$\\mathrm{J\\,ps^{2}}$为单位，并四舍五入到四位有效数字。", "solution": "该问题被验证为具有科学依据、良定且客观。它包含计算统计力学中的标准推导和应用。\n\n解答根据问题陈述的要求分三部分呈现。\n\n第1部分：修正后温度估算器的推导。\n\n能量均分定理指出，对于一个在温度$T_{0}$下处于热平衡的系统，哈密顿量中与每个独立二次自由度相关的平均能量为$\\frac{1}{2} k_{B} T_{0}$，其中$k_{B}$是玻尔兹曼常数。在分子动力学（MD）模拟中，通过将此原理扩展到瞬时动能$K$，瞬时温度$T$被估算出来。如果系统拥有$g$个动能自由度，瞬时温度$T$由以下关系式定义：\n$$K = \\frac{g}{2} k_{B} T$$\n由此，温度估算器为：\n$$T = \\frac{2K}{g k_{B}}$$\n对于一个在三维空间中运动的$N$个点状原子系统，每个原子有3个平动自由度，对应于其速度分量$(v_{ix}, v_{iy}, v_{iz})$。这类自由度的总数为$g = 3N$。总动能为$K = \\sum_{i=1}^{N} \\frac{1}{2} m v_{i}^{2}$。因此，标准的温度估算器为：\n$$T = \\frac{2K}{3N k_{B}}$$\n当移除净质心（COM）运动时，对系统的速度施加了一个约束。质心速度定义为$\\mathbf{V}_{\\text{COM}} = \\frac{\\sum_{i=1}^{N} m \\mathbf{v}_{i}}{\\sum_{i=1}^{N} m} = \\frac{1}{N} \\sum_{i=1}^{N} \\mathbf{v}_{i}$。移除质心运动意味着在任何时候都强制$\\mathbf{V}_{\\text{COM}} = \\mathbf{0}$。这在原子速度上引入了三个线性约束：\n$$\\sum_{i=1}^{N} v_{ix} = 0, \\quad \\sum_{i=1}^{N} v_{iy} = 0, \\quad \\sum_{i=1}^{N} v_{iz} = 0$$\n这些约束减少了独立速度分量的数量。原始的$3N$个自由度减少了3个。新的活性自由度数目，记为$g'$，是：\n$$g' = 3N - 3$$\n系统的动能$K$现在由满足这些约束的速度计算得出。温度估算器必须进行调整以反映自由度数目的变化。新的估算器$T'$为：\n$$T' = \\frac{2K}{g' k_{B}} = \\frac{2K}{(3N-3)k_{B}}$$\n为了找到在瞬时动能$K$固定的情况下估算器变化的因子，我们计算新估算器$T'$与旧估算器$T$的比率：\n$$\\frac{T'}{T} = \\frac{\\frac{2K}{(3N-3)k_{B}}}{\\frac{2K}{3N k_{B}}} = \\frac{3N}{3N-3} = \\frac{3N}{3(N-1)} = \\frac{N}{N-1}$$\n因此，对于给定的动能$K$，移除质心运动会使估算温度增加一个因子$\\frac{N}{N-1}$。\n\n第2部分：Nosé–Hoover动力学与恒温器参数调整。\n\nNosé–Hoover（NH）恒温器通过一个扩展的相空间变量，即摩擦系数$\\xi$，将物理系统与热库耦合。原子动量$\\mathbf{p}_{i}$和恒温器变量$\\xi$的运动方程为：\n$$\\dot{\\mathbf{p}}_{i} = \\mathbf{F}_{i} - \\xi \\mathbf{p}_{i}$$\n$$\\dot{\\xi} = \\frac{1}{Q} \\left( \\sum_{i=1}^{N} \\frac{p_{i}^{2}}{m} - g k_{B} T_{0} \\right) = \\frac{1}{Q} (2K - g k_{B} T_{0})$$\n这里，$Q$是恒温器的“质量”参数，它决定了温度涨落的时间尺度，$g$是活性自由度的数目。\n\n为了分析动能涨落的动力学，我们首先推导$K = \\sum_{i=1}^{N} \\frac{p_{i}^{2}}{2m}$的运动方程：\n$$\\dot{K} = \\frac{d}{dt} \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i} \\cdot \\mathbf{p}_{i}}{2m} = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i} \\cdot \\dot{\\mathbf{p}}_{i}}{m} = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i} \\cdot (\\mathbf{F}_{i} - \\xi \\mathbf{p}_{i})}{m}$$\n$$\\dot{K} = \\sum_{i=1}^{N} \\mathbf{v}_{i} \\cdot \\mathbf{F}_{i} - \\xi \\sum_{i=1}^{N} \\frac{p_{i}^{2}}{m} = \\sum_{i=1}^{N} \\mathbf{v}_{i} \\cdot \\mathbf{F}_{i} - 2\\xi K$$\n我们定义一个涨落项$\\Gamma(t) = \\sum_{i=1}^{N} \\mathbf{v}_{i} \\cdot \\mathbf{F}_{i}$，它代表与势能面的能量交换。$K$和$\\xi$的耦合动力学为：\n$$ \\begin{cases} \\dot{K} = \\Gamma(t) - 2\\xi K \\\\ \\dot{\\xi} = \\frac{1}{Q} (2K - g k_{B} T_{0}) \\end{cases} $$\n我们在平衡态附近将这些方程线性化，平衡态的特征是$\\langle \\xi \\rangle = 0$和$\\langle K \\rangle = K_{0} = \\frac{g}{2} k_{B} T_{0}$。我们引入小偏差$\\delta K = K - K_{0}$和$\\delta \\xi = \\xi - 0$。线性化后的方程变为：\n$$ \\begin{cases} \\delta\\dot{K} \\approx \\Gamma(t) - 2 K_{0} \\delta\\xi \\\\ \\delta\\dot{\\xi} \\approx \\frac{1}{Q} (2(K_{0}+\\delta K) - g k_{B} T_{0}) = \\frac{2 \\delta K}{Q} \\end{cases} $$\n对第一个方程关于时间求导，并代入第二个方程，得到一个关于$\\delta K$的方程：\n$$\\delta\\ddot{K} \\approx \\dot{\\Gamma}(t) - 2K_{0}\\delta\\dot{\\xi} = \\dot{\\Gamma}(t) - 2K_{0} \\left( \\frac{2\\delta K}{Q} \\right)$$\n$$\\delta\\ddot{K} + \\left( \\frac{4K_{0}}{Q} \\right) \\delta K = \\dot{\\Gamma}(t)$$\n这是一个受驱谐振子的方程。小振幅动能涨落的自然频率$\\omega$由下式给出：\n$$\\omega^{2} = \\frac{4K_{0}}{Q} = \\frac{4}{Q} \\left( \\frac{g}{2} k_{B} T_{0} \\right) = \\frac{2g k_{B} T_{0}}{Q}$$\n所以，弛豫频率为$\\omega = \\sqrt{\\frac{2g k_{B} T_{0}}{Q}}$。弛豫时间尺度为$\\tau = \\frac{2\\pi}{\\omega}$。\n当自由度数目从$g$变为$g'$时，为了保持相同的弛豫时间尺度$\\tau$（也就是相同的频率$\\omega$），比率$\\frac{g}{Q}$必须保持恒定：\n$$\\frac{g}{Q} = \\frac{g'}{Q'} \\implies Q' = Q \\frac{g'}{g}$$\n这表明恒温器质量$Q$必须与自由度数目成比例地缩放，以维持一个恒定的响应频率。\n为了用期望的时间尺度$\\tau$来表示调整后的质量$Q'$，我们重排频率方程：\n$$Q' = \\frac{2g' k_{B} T_{0}}{\\omega^{2}}$$\n代入$\\omega = \\frac{2\\pi}{\\tau}$，我们得到：\n$$Q' = \\frac{2g' k_{B} T_{0}}{(2\\pi/\\tau)^{2}} = \\frac{g' k_{B} T_{0} \\tau^{2}}{2\\pi^{2}}$$\n这为具有$g'$个自由度的系统提供了实现目标时间尺度$\\tau$的调整后质量参数$Q'$的符号表达式。\n\n第3部分：调整后恒温器质量$Q'$的数值计算。\n\n问题指定了一个包含$N = 1000$个原子、目标温度为$T_{0} = 300\\,\\mathrm{K}$的系统。质心运动被移除。期望的弛豫时间尺度为$\\tau = 0.5\\,\\mathrm{ps}$。\n\n首先，我们计算活性自由度的数目$g'$：\n$$g' = 3N - 3 = 3(1000) - 3 = 2997$$\n接下来，我们使用推导出的$Q'$公式以及给定的参数和常数：\n$$Q' = \\frac{g' k_{B} T_{0} \\tau^{2}}{2\\pi^{2}}$$\n物理常数为：\n$k_{B} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$\n参数为：\n$g' = 2997$\n$T_{0} = 300\\,\\mathrm{K}$\n$\\tau = 0.5\\,\\mathrm{ps}$\n\n我们现在将这些值代入$Q'$的表达式中。单位必须被正确处理，以得到以$\\mathrm{J\\,ps^{2}}$为单位的最终答案。\n$$Q' = \\frac{(2997) \\times (1.380649 \\times 10^{-23}\\,\\mathrm{J/K}) \\times (300\\,\\mathrm{K}) \\times (0.5\\,\\mathrm{ps})^{2}}{2\\pi^{2}}$$\n$$Q' = \\frac{2997 \\times (1.380649 \\times 10^{-23}) \\times 300 \\times 0.25}{2\\pi^{2}} \\,\\mathrm{J\\,ps^{2}}$$\n项$k_{B} T_{0}$为$(1.380649 \\times 10^{-23}\\,\\mathrm{J/K}) \\times (300\\,\\mathrm{K}) = 4.141947 \\times 10^{-21}\\,\\mathrm{J}$。\n分子变为：\n$$ \\text{Numerator} = 2997 \\times (4.141947 \\times 10^{-21}\\,\\mathrm{J}) \\times (0.25\\,\\mathrm{ps}^{2}) \\approx 3.1032178 \\times 10^{-18}\\,\\mathrm{J\\,ps^{2}} $$\n分母为：\n$$ \\text{Denominator} = 2\\pi^{2} \\approx 19.7392088 $$\n进行除法运算：\n$$ Q' \\approx \\frac{3.1032178 \\times 10^{-18}}{19.7392088} \\,\\mathrm{J\\,ps^{2}} \\approx 1.572101 \\times 10^{-19}\\,\\mathrm{J\\,ps^{2}} $$\n按要求将结果四舍五入到四位有效数字：\n$$ Q' \\approx 1.572 \\times 10^{-19}\\,\\mathrm{J\\,ps^{2}} $$\n这是为实现期望的弛豫时间尺度所需的调整后Nosé–Hoover质量参数。", "answer": "$$\\boxed{1.572 \\times 10^{-19}}$$", "id": "3496428"}, {"introduction": "一个有效的控温器不仅要能控制平均动能，更关键的是要确保系统能够遍历所有可及的相空间，即满足遍历性假设。本练习将通过一个具体的数值实验，检验Nosé–Hoover链在多势阱体系中的遍历性采样能力 [@problem_id:3496461]。您将通过比较模拟得到的驻留时间分布与理论上的玻尔兹曼统计分布，来定量评估采样器的性能，这是验证一个采样算法在面对复杂能量形貌时是否可靠的黄金标准。", "problem": "设计并实现一个完整、独立的数值实验，通过将基于经验停留时间的势阱占据分数与相应的玻尔兹曼权重进行比较，来评估一个 Nosé–Hoover 链采样器对于在三势阱势中演化的一维粒子是否有效遍历。你的程序必须实现：使用 Nosé–Hoover 链恒温器对确定性动力学进行时间积分，计算在预定义势阱中的停留时间，通过数值积分评估理论玻尔兹曼概率，并基于一个定量的差异度量对指定的测试用例判定“通过”或“失败”。\n\n所有模拟均在约化的无量纲单位下进行。将粒子质量设为 $m = 1$，玻尔兹曼常数设为 $k_{\\mathrm{B}} = 1$。势能为\n$$\nV(x) = \\frac{x^{6}}{6} - \\frac{a}{4}\\,x^{4} + \\frac{b}{2}\\,x^{2},\n$$\n其中参数为 $a = 5$ 和 $b = 4$。对于这些参数，离原点最近的局部极大值点位于 $x = \\pm 1$，并且该势具有三个势阱：左势阱 $(-\\infty,-1)$、中势阱 $[-1,1]$ 和右势阱 $(1,\\infty)$。\n\n实现一个长度为 $M$ 的 Nosé–Hoover 链，用于将动能温度控制在目标温度 $T$。使用单个物理坐标 $x$ 和速度 $v = \\dot{x}$。令 $\\xi_{j}$ 表示第 $j$ 个恒温器变量，$Q_{j}$ 表示相应的恒温器质量。需要积分的运动方程是适用于单自由度系统的标准 Nosé–Hoover 链常微分方程：\n- $\\dot{x} = v$，\n- $\\dot{v} = \\frac{F(x)}{m} - \\xi_{1}\\,v$，其中 $F(x) = -\\frac{d V}{d x}$，\n- 对于 $j = 1$：$\\dot{\\xi}_{1} = \\frac{m v^{2} - k_{\\mathrm{B}} T}{Q_{1}} - \\xi_{2}\\,\\xi_{1}$（如果 $M \\ge 2$），以及 $\\dot{\\xi}_{1} = \\frac{m v^{2} - k_{\\mathrm{B}} T}{Q_{1}}$（如果 $M = 1$），\n- 对于 $j = 2,\\dots,M-1$：$\\dot{\\xi}_{j} = \\frac{Q_{j-1}\\,\\xi_{j-1}^{2} - k_{\\mathrm{B}} T}{Q_{j}} - \\xi_{j+1}\\,\\xi_{j}$，\n- 对于 $j = M$：$\\dot{\\xi}_{M} = \\frac{Q_{M-1}\\,\\xi_{M-1}^{2} - k_{\\mathrm{B}} T}{Q_{M}}$。\n\n根据 $Q_{j} = k_{\\mathrm{B}} T\\,\\tau^{2}$（对于所有 $j \\in \\{1,\\dots,M\\}$）选择恒温器质量，其中 $\\tau$ 是用户指定的恒温器时间尺度。使用固定时间步长 $\\Delta t$ 和一个你选择的固定步长显式积分器来对上述系统进行数值积分。你的数值实验必须：\n- 以时间步长 $\\Delta t$ 模拟总共 $N_{\\text{steps}}$ 步，\n- 从所有统计数据中舍弃初始的 $N_{\\text{burn}}$ 步预烧期，\n- 通过将轨迹分割成在每个势阱内的最大连续段，并以 $\\Delta t$ 的时间单位记录每个段的持续时间，来计算停留时间分布，\n- 计算经验占据分数向量 $\\hat{\\boldsymbol{p}} = (\\hat{p}_{\\mathrm{L}}, \\hat{p}_{\\mathrm{C}}, \\hat{p}_{\\mathrm{R}})$，即预烧期后模拟时间在三个势阱中各自所占的比例，\n- 通过以下公式计算理论玻尔兹曼概率 $\\boldsymbol{p}^{\\star} = (p_{\\mathrm{L}}^{\\star}, p_{\\mathrm{C}}^{\\star}, p_{\\mathrm{R}}^{\\star})$，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$ 且配分函数 $Z$ 等于这三个积分之和；对积分进行高精度数值计算，\n$$\np_{\\mathrm{L}}^{\\star} = \\frac{1}{Z}\\int_{-\\infty}^{-1} e^{-\\beta V(x)}\\,dx,\\quad\np_{\\mathrm{C}}^{\\star} = \\frac{1}{Z}\\int_{-1}^{1} e^{-\\beta V(x)}\\,dx,\\quad\np_{\\mathrm{R}}^{\\star} = \\frac{1}{Z}\\int_{1}^{\\infty} e^{-\\beta V(x)}\\,dx,\n$$\n- 计算全变差\n$$\nD_{\\mathrm{TV}}(\\hat{\\boldsymbol{p}}, \\boldsymbol{p}^{\\star}) = \\frac{1}{2}\\sum_{w \\in \\{\\mathrm{L},\\mathrm{C},\\mathrm{R}\\}} \\left|\\hat{p}_{w} - p_{w}^{\\star}\\right|。\n$$\n\n如果 $D_{\\mathrm{TV}}(\\hat{\\boldsymbol{p}}, \\boldsymbol{p}^{\\star}) \\le \\varepsilon$，则测试用例被判定为“通过”，其中 $\\varepsilon$ 是为该用例提供的容差。否则为“失败”。使用以下测试套件，其中每个元组为 $(T, M, \\Delta t, N_{\\text{steps}}, N_{\\text{burn}}, \\tau, \\varepsilon)$：\n- 用例 1：$(0.5, 3, 0.002, 60000, 5000, 0.2, 0.12)$，\n- 用例 2：$(0.1, 3, 0.002, 40000, 5000, 0.2, 0.20)$，\n- 用例 3：$(0.5, 1, 0.002, 40000, 5000, 0.2, 0.12)$，\n- 用例 4：$(0.5, 5, 0.002, 80000, 5000, 0.2, 0.10)$。\n\n初始化要求：\n- 设置初始位置为 $x(0) = 0$，\n- 从均值为零、方差为 $k_{\\mathrm{B}} T / m$ 的高斯分布中抽取初始速度，使用固定的随机种子以确保结果是确定性的，\n- 将所有恒温器变量初始化为 $\\xi_{j}(0) = 0$。\n\n所有量均为无量纲。你的程序必须为每个测试用例计算一个布尔值，根据上述标准指示通过（true）或失败（false）。你的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[true,false,true,true]”），并保留 Python 布尔值的大小写（“True”和“False”）。不要求输出角度或百分比。最终输出必须严格遵循此格式，不得包含任何额外文本。", "solution": "该问题要求设计并实现一个数值实验，以评估 Nosé–Hoover 链恒温器的遍历采样效率。所考虑的系统是一个质量为 $m=1$ 的一维粒子，在由下式给出的对称三势阱势中运动\n$$\nV(x) = \\frac{x^{6}}{6} - \\frac{a}{4}\\,x^{4} + \\frac{b}{2}\\,x^{2}\n$$\n参数为 $a=5$ 和 $b=4$。玻尔兹曼常数设为 $k_{\\mathrm{B}}=1$。遍历性的评估是通过将从长时间分子动力学轨迹中获得的势阱经验占据分数，与从玻尔兹曼分布推导出的理论概率进行比较来执行的。\n\n首先，我们定义物理系统。作用在粒子上的力是势的负梯度：\n$$\nF(x) = -\\frac{dV(x)}{dx} = -\\left(x^{5} - ax^{3} + bx\\right) = -x^{5} + 5x^{3} - 4x.\n$$\n系统的温度由一个长度为 $M$ 的 Nosé–Hoover 链控制。整个系统的状态由粒子的位置 $x$、速度 $v$ 以及 $M$ 个恒温器变量 $\\xi_{1}, \\xi_{2}, \\dots, \\xi_{M}$ 描述。这个扩展系统的运动方程是一组耦合的一阶常微分方程（ODE）：\n\\begin{align*}\n\\dot{x} = v \\\\\n\\dot{v} = \\frac{F(x)}{m} - \\xi_{1} v \\\\\n\\dot{\\xi}_{1} = \\frac{1}{Q_{1}}(m v^{2} - k_{\\mathrm{B}} T) - \\begin{cases} 0  \\text{if } M=1 \\\\ \\xi_{2} \\xi_{1}  \\text{if } M \\ge 2 \\end{cases} \\\\\n\\dot{\\xi}_{j} = \\frac{1}{Q_{j}}(Q_{j-1} \\xi_{j-1}^{2} - k_{\\mathrm{B}} T) - \\xi_{j+1} \\xi_{j}, \\quad \\text{for } j=2, \\dots, M-1 \\\\\n\\dot{\\xi}_{M} = \\frac{1}{Q_{M}}(Q_{M-1} \\xi_{M-1}^{2} - k_{\\mathrm{B}} T), \\quad \\text{for } M \\ge 2\n\\end{align*}\n其中 $T$ 是目标温度，$Q_j$ 是恒温器的“质量”，对于给定的时间尺度参数 $\\tau$，设置为 $Q_j = k_{\\mathrm{B}} T \\tau^2$。这个恒温器链旨在生成正则系综动力学。第一个恒温器变量 $\\xi_1$ 直接与物理粒子的动能耦合，而后续的变量 $\\xi_2, \\ldots, \\xi_M$ 形成一个链，对前一个变量进行恒温控制，这有助于抑制振荡并改善相空间探索，这是简单的 Nosé-Hoover 恒温器（$M=1$）的一个已知问题。\n\n为了数值求解这些常微分方程，需要一个鲁棒的积分方案。尽管像 Martyna-Tuckerman-Klein 算法这样的辛积分器很常用，但对于这个问题，我们选择四阶 Runge-Kutta (RK4) 方法。RK4 是一种通用的、显式的、高精度的积分器，适用于在有限时间间隔内求解性状良好的常微分方程组。虽然它不是辛算法，但其高阶特性可以最小化每步的能量漂移，并且恒温器的作用旨在校正任何此类漂移，以长期维持目标温度。状态向量为 $Y = (x, v, \\xi_1, \\dots, \\xi_M)$，积分通过迭代应用 RK4 更新规则来进行。\n\n实验的核心是检验遍历性假说，该假说指出，对于一个遍历系统，一个可观测量的时间平均值等于其系综平均值。在这里，可观测量是粒子相对于三个势阱的位置：左势阱 $W_L = (-\\infty, -1)$、中势阱 $W_C = [-1, 1]$ 和右势阱 $W_R = (1, \\infty)$。\n对于一个势阱 $w \\in \\{\\mathrm{L}, \\mathrm{C}, \\mathrm{R}\\}$，其经验占据分数（记为 $\\hat{p}_w$）计算为（在初始 $N_{\\text{burn}}$ 步的预烧期之后）粒子在该势阱中停留的模拟时间所占的比例。\n$$\n\\hat{p}_{w} = \\frac{\\text{预烧期后在势阱 } w \\text{ 中的步数}}{\\text{预烧期后的总步数}}\n$$\n理论概率 $p_w^{\\star}$ 是从正则系综的玻尔兹曼分布推导出来的。在一个区域内发现粒子的概率与玻尔兹曼因子 $e^{-\\beta V(x)}$ 在该区域上的积分成正比，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$。概率为：\n$$\np_{w}^{\\star} = \\frac{1}{Z} \\int_{x \\in W_w} e^{-\\beta V(x)} dx\n$$\n其中 $Z = \\int_{-\\infty}^{\\infty} e^{-\\beta V(x)} dx$ 是配分函数，确保归一化（$\\sum_w p_w^{\\star} = 1$）。由于 $V(x)$ 的复杂性，这些积分需要通过数值方法高精度地计算，使用标准的求积方法，例如 `scipy.integrate.quad` 提供的方法。\n\n最后，模拟分布与理论分布之间的差异通过全变差距离来量化：\n$$\nD_{\\mathrm{TV}}(\\hat{\\boldsymbol{p}}, \\boldsymbol{p}^{\\star}) = \\frac{1}{2}\\sum_{w \\in \\{\\mathrm{L},\\mathrm{C},\\mathrm{R}\\}} \\left|\\hat{p}_{w} - p_{w}^{\\star}\\right|.\n$$\n如果此差异小于或等于给定的容差 $\\varepsilon$，则该测试用例被视为“通过”，这表明模拟以与目标正则系综一致的方式对构型空间进行了采样。通过固定随机数生成器的种子，整个过程（包括初始速度的抽取）是确定性的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\n# language: Python\n# version: 3.12\n# libraries:\n#   name: numpy, version: 1.23.5\n#   name: scipy, version: 1.11.4\n\ndef solve():\n    \"\"\"\n    Main function to run the series of numerical experiments.\n    \"\"\"\n    # Define test cases: (T, M, dt, N_steps, N_burn, tau, epsilon)\n    test_cases = [\n        (0.5, 3, 0.002, 60000, 5000, 0.2, 0.12),\n        (0.1, 3, 0.002, 40000, 5000, 0.2, 0.20),\n        (0.5, 1, 0.002, 40000, 5000, 0.2, 0.12),\n        (0.5, 5, 0.002, 80000, 5000, 0.2, 0.10),\n    ]\n\n    # Global parameters\n    m = 1.0\n    k_B = 1.0\n    a = 5.0\n    b = 4.0\n    \n    # Use a fixed seed for reproducibility as requested\n    np.random.seed(12345)\n\n    def V(x):\n        \"\"\"Potential energy function V(x).\"\"\"\n        return (x**6 / 6.0) - (a / 4.0) * x**4 + (b / 2.0) * x**2\n\n    def F(x):\n        \"\"\"Force function F(x) = -dV/dx.\"\"\"\n        return -(x**5 - a * x**3 + b * x)\n\n    def calculate_theoretical_probabilities(T):\n        \"\"\"\n        Computes theoretical well probabilities using numerical quadrature.\n        \"\"\"\n        beta = 1.0 / (k_B * T)\n        integrand = lambda x: np.exp(-beta * V(x))\n\n        I_L, _ = quad(integrand, -np.inf, -1.0)\n        I_C, _ = quad(integrand, -1.0, 1.0)\n        I_R, _ = quad(integrand, 1.0, np.inf)\n\n        Z = I_L + I_C + I_R\n        return np.array([I_L / Z, I_C / Z, I_R / Z])\n\n    def get_derivatives(state, T, M, Q, m_val):\n        \"\"\"\n        Computes the time derivatives of the state vector [x, v, xi_1, ..., xi_M].\n        \"\"\"\n        x, v = state[0], state[1]\n        xi = state[2:]\n        \n        derivs = np.zeros_like(state)\n        \n        # d_x/dt\n        derivs[0] = v\n        # d_v/dt\n        derivs[1] = F(x) / m_val - xi[0] * v\n        \n        # d_xi/dt\n        if M == 1:\n            g1 = m_val * v**2 - k_B * T\n            derivs[2] = g1 / Q[0]\n        else: # M >= 2\n            # j = 1\n            g1 = m_val * v**2 - k_B * T\n            derivs[2] = g1 / Q[0] - xi[1] * xi[0]\n            \n            # j = 2 to M-1\n            for j in range(1, M - 1):\n                gj_plus_1 = Q[j - 1] * xi[j - 1]**2 - k_B * T\n                derivs[j + 2] = gj_plus_1 / Q[j] - xi[j + 1] * xi[j]\n                \n            # j = M\n            gM = Q[M - 2] * xi[M - 2]**2 - k_B * T\n            derivs[M + 1] = gM / Q[M - 1]\n            \n        return derivs\n\n    def run_simulation(T, M, dt, N_steps, N_burn, tau):\n        \"\"\"\n        Runs a single MD simulation with a Nosé-Hoover chain thermostat.\n        \"\"\"\n        # Initial conditions\n        x0 = 0.0\n        v0 = np.random.normal(loc=0.0, scale=np.sqrt(k_B * T / m))\n        xi0 = np.zeros(M)\n        \n        state = np.concatenate(([x0, v0], xi0))\n        \n        Q_vals = np.full(M, k_B * T * tau**2)\n        \n        residence_counts = np.zeros(3) # [Left, Center, Right]\n\n        for step in range(N_steps):\n            # RK4 integrator\n            k1 = dt * get_derivatives(state, T, M, Q_vals, m)\n            k2 = dt * get_derivatives(state + 0.5 * k1, T, M, Q_vals, m)\n            k3 = dt * get_derivatives(state + 0.5 * k2, T, M, Q_vals, m)\n            k4 = dt * get_derivatives(state + k3, T, M, Q_vals, m)\n            state += (k1 + 2 * k2 + 2 * k3 + k4) / 6.0\n            \n            if step >= N_burn:\n                x_pos = state[0]\n                if x_pos  -1.0:\n                    residence_counts[0] += 1\n                elif x_pos > 1.0:\n                    residence_counts[2] += 1\n                else:\n                    residence_counts[1] += 1\n        \n        total_production_steps = N_steps - N_burn\n        if total_production_steps > 0:\n            p_hat = residence_counts / total_production_steps\n        else:\n            p_hat = np.array([0.0, 0.0, 0.0])\n            \n        return p_hat\n\n    results = []\n    for T, M, dt, N_steps, N_burn, tau, epsilon in test_cases:\n        p_star = calculate_theoretical_probabilities(T)\n        p_hat = run_simulation(T, M, dt, N_steps, N_burn, tau)\n        \n        D_TV = 0.5 * np.sum(np.abs(p_hat - p_star))\n        \n        pass_fail = D_TV = epsilon\n        results.append(pass_fail)\n\n    # Format the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3496461"}]}