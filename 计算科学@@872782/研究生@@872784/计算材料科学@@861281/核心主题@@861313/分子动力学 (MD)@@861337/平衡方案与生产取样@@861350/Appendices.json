{"hands_on_practices": [{"introduction": "在我们平衡一个系统或取样其性质之前，我们必须确保模拟的基本设置在物理上是合理的。在使用周期性边界条件的模拟中，一个关键的考虑是防止一个粒子与其自身的周期性映像发生相互作用，这是一种非物理的人为现象。这项实践练习 [@problem_id:3449022] 将指导您从第一性原理出发，推导为保证最小映像约定的完整性所需的最小模拟盒子尺寸，这是高效精确分子动力学模拟的基石。", "problem": "一个简单流体的三维分子动力学（MD）模拟在一个边长为 $L$ 的立方体盒子中采用周期性边界条件（PBC）。原子间作用力是成对相加、各向同性的，并通过一个明确的实空间截断半径 $r_{c}$ 进行截断，因此对势 $u(r)$ 满足当 $r \\ge r_{c}$ 时 $u(r)=0$。该模拟使用最小镜像约定：对于位于位置 $\\mathbf{r}_{i}$ 和 $\\mathbf{r}_{j}$ 的任意一对粒子，用于计算它们相互作用的位移是晶格约化矢量 $\\Delta \\mathbf{r}_{ij}=\\mathbf{r}_{i}-\\mathbf{r}_{j}-L\\mathbf{n}$，其中选择 $\\mathbf{n}\\in\\mathbb{Z}^{3}$ 以使 $\\Delta \\mathbf{r}_{ij}$ 的每个笛卡尔分量都位于区间 $\\left(-\\frac{L}{2},\\frac{L}{2}\\right]$ 内。该模拟在构造上排除了自身对（即没有 $i=j$ 项），但为确保物理上有意义的生产采样，要求任何粒子都不能与任何其他粒子的多个周期性镜像发生相互作用，特别是，任何粒子周围半径为 $r_{c}$ 的相互作用球体不应包含该粒子自身的任何周期性镜像。\n\n仅从周期性边界条件（PBC）、最小镜像约定以及立方布拉菲晶格的几何形状的定义出发，推导出一个关于 $r_{c}$ 的函数，即 $L$ 的明确阈值，以保证对于各向同性系统，上述唯一性和无自相互作用的条件得以满足。计算满足此要求的最小 $L$，并用 $r_{c}$ 的解析式表示。请以 $r_{c}$ 的单个精确表达式形式提供最小 $L$ 的最终答案。不要使用任何数值近似或四舍五入。", "solution": "该问题是有效的。它具有科学依据，问题提出得很好且客观，呈现了计算材料科学领域中一个标准且基础的几何约束问题，特别是关于分子动力学模拟的设置。它没有任何说明中列出的导致问题无效的缺陷。因此，我们可以进行推导。\n\n该问题要求推导模拟盒子边长 $L$ 作为相互作用截断半径 $r_c$ 的函数的明确阈值，以满足在具有周期性边界条件（PBC）和最小镜像约定（MIC）的立方体盒子中进行模拟的两个条件。我们来分析这两个条件。\n\n假设模拟盒子是一个顶点位于 $(\\pm \\frac{L}{2}, \\pm \\frac{L}{2}, \\pm \\frac{L}{2})$ 的立方体。在周期性边界条件下，模拟空间是一个三维环面。位于位置 $\\mathbf{r}$ 的粒子在所有 $\\mathbf{r} + L\\mathbf{n}$ 的位置都有周期性镜像，其中 $\\mathbf{n}$ 是一个整数分量向量，$\\mathbf{n} \\in \\mathbb{Z}^3$。任意两个粒子 $i$ 和 $j$ 之间的相互作用仅在它们的间距 $r$ 小于 $r_c$ 时才非零。最小镜像约定规定，这个距离是在粒子 $i$ 和粒子 $j$ 的单个、唯一的最近周期性镜像之间计算的。\n\n需要满足的两个条件是：\n1.  任何粒子都不能与任何其他粒子的多个周期性镜像发生相互作用。\n2.  任何粒子周围半径为 $r_c$ 的相互作用球体不应包含该粒子自身的任何周期性镜像。\n\n我们来逐一分析每个条件，以找出它对 $L$ 和 $r_c$ 施加的约束。\n\n**条件1的分析：相互作用对象的唯一性**\n\n最小镜像约定是近似计算短程力的埃瓦尔德求和法的一种计算捷径。为了使这种近似在一个具有简单球形截断的系统中物理上一致，一个粒子的相互作用球体不能包含任何其他粒子的一个以上周期性镜像。如果包含多个，最小镜像约定会任意选择较近的镜像而忽略另一个镜像的能量贡献，从而导致不正确的力计算。\n\n我们考虑位于位置 $\\mathbf{r}_i$ 的粒子 $i$ 和位于位置 $\\mathbf{r}_j$ 的另一个粒子 $j$。粒子 $j$ 的所有周期性镜像的集合位于位置 $\\{ \\mathbf{r}_j + L\\mathbf{n} \\mid \\mathbf{n} \\in \\mathbb{Z}^3 \\}$。\n我们考虑粒子 $j$ 的两个不同镜像，它们对应两个不同的整数向量 $\\mathbf{n}_1$ 和 $\\mathbf{n}_2$，其中 $\\mathbf{n}_1 \\neq \\mathbf{n}_2$。这两个镜像的位置分别是 $\\mathbf{p}_1 = \\mathbf{r}_j + L\\mathbf{n}_1$ 和 $\\mathbf{p}_2 = \\mathbf{r}_j + L\\mathbf{n}_2$。\n\n分隔这两个镜像的向量是 $\\mathbf{p}_1 - \\mathbf{p}_2 = L(\\mathbf{n}_1 - \\mathbf{n}_2)$。令 $\\mathbf{m} = \\mathbf{n}_1 - \\mathbf{n}_2$。由于 $\\mathbf{n}_1$ 和 $\\mathbf{n}_2$ 是不同的整数向量，$\\mathbf{m}$ 是一个非零整数向量，即 $\\mathbf{m} \\in \\mathbb{Z}^3 \\setminus \\{\\mathbf{0}\\}$。\n\n这两个镜像之间的距离是 $\\|\\mathbf{p}_1 - \\mathbf{p}_2\\| = \\|L\\mathbf{m}\\| = L\\|\\mathbf{m}\\|$。为了找到一个粒子的任意两个不同镜像之间的最小距离，我们需要找到非零整数向量 $\\mathbf{m}=(m_x, m_y, m_z)$ 的最小模。模的平方是 $\\|\\mathbf{m}\\|^2 = m_x^2 + m_y^2 + m_z^2$。由于 $m_x, m_y, m_z$ 是整数且不全为零，该和的最小可能值为 $1$（例如，对于 $\\mathbf{m}=(1,0,0)$）。因此，最小模为 $\\|\\mathbf{m}\\|_{min} = 1$。\n\n因此，粒子 $j$ 的任意两个不同周期性镜像之间的最小距离是 $L \\times \\|\\mathbf{m}\\|_{min} = L$。\n\n为了使粒子 $i$ 可能与这两个镜像 $\\mathbf{p}_1$ 和 $\\mathbf{p}_2$ 都发生相互作用，它们必须都位于其半径为 $r_c$ 的相互作用球体内。一个半径为 $r_c$ 的球体只有在两点之间的距离小于或等于其直径 $2r_c$ 时，才能同时包含这两点。\n为保证粒子 $j$ 的任意镜像中，最多只有一个能处于粒子 $i$ 的相互作用球体内，我们必须确保 $j$ 的任意两个镜像之间的最小距离大于相互作用球体的直径。当两个距离相等时，达到明确的阈值。\n因此，我们必须施加以下条件：\n$$L \\ge 2r_c$$\n\n**条件2的分析：无自相互作用**\n\n该条件指出，一个粒子不能与其自身的任何周期性镜像发生相互作用。\n设粒子 $i$ 位于位置 $\\mathbf{r}_i$。其自身的周期性镜像位于位置 $\\mathbf{r}_i + L\\mathbf{n}$，其中 $\\mathbf{n}$ 是所有非零整数向量，即 $\\mathbf{n} \\in \\mathbb{Z}^3 \\setminus \\{\\mathbf{0}\\}$。\n粒子 $i$ 与其自身的一个镜像之间的距离是 $\\|\\mathbf{r}_i - (\\mathbf{r}_i + L\\mathbf{n})\\| = \\|-L\\mathbf{n}\\| = L\\|\\mathbf{n}\\|$。\n\n粒子 $i$ 的最近周期性镜像对应于 $\\|\\mathbf{n}\\|$ 最小且 $\\mathbf{n} \\neq \\mathbf{0}$ 的情况。如前所述，最小模为 $\\|\\mathbf{n}\\|_{min} = 1$。\n因此，一个粒子到其最近自身镜像的距离恰好是 $L$。\n\n粒子 $i$ 周围的相互作用球体半径为 $r_c$。为使该球体不包含该粒子的任何自身镜像，其半径必须小于或等于到最近镜像的距离。\n这给出了条件：\n$$r_c \\le L$$\n或等价地，\n$$L \\ge r_c$$\n\n**条件整合**\n\n我们已经推导出了两个必要条件：\n1. 来自相互作用对象的唯一性：$L \\ge 2r_c$\n2. 来自无自身镜像相互作用：$L \\ge r_c$\n\n对于任何物理上有意义的相互作用，截断半径 $r_c$ 必须为正。因此，第一个条件 $L \\ge 2r_c$ 比第二个条件 $L \\ge r_c$ 更严格。如果第一个条件满足，第二个条件将自动满足。因此，确保两个条件都得到满足的主导约束是 $L \\ge 2r_c$。\n\n问题要求满足此要求的最小 $L$。最小的 $L$ 值在等式成立时取得，这代表了明确的阈值。\n$$L_{min} = 2r_c$$\n这是立方体系中著名的半盒子准则，它确保了在使用球形截断时最小镜像约定的完整性。", "answer": "$$ \\boxed{2r_c} $$", "id": "3449022"}, {"introduction": "设置好模拟盒子后，下一个关键步骤是使系统达到热力学平衡。但我们如何验证系统是否真正达到了平衡？这项练习 [@problem_id:3449055] 介绍了一种强大的诊断技术：在短暂的微正则系综（NVE）运行中分析总能量漂移。通过理解数值积分误差如何随时间步长 $ \\Delta t $ 缩放，您可以将其与物理弛豫区分开来，从而确认系统的稳定性并验证您选择的模拟参数。", "problem": "考虑一个使用经典分子动力学 (MD) 在微正则系综（也称为粒子数、体积和能量恒定的 NVE 系综）下建模的大型晶体固体。其哈密顿量为 $H(q,p) = T(p) + U(q)$，其中 $q$ 和 $p$ 分别是位置和动量，$T(p) = \\sum_{i} \\frac{p_{i}^{2}}{2 m_{i}}$ 是动能，$U(q)$ 是势能。数值积分使用速度 Verlet 算法，时间步长为 $\\Delta t$。在进行生产取样之前，系统在恒温器下进行了平衡，然后移除恒温器以进行 NVE 运行。为了评估先前的平衡是否充分，并选择一个在 NVE 生产中能够实现可接受的能量守恒的时间步长，您在不同的 $\\Delta t$ 值下执行了两次短暂的引导性 NVE 运行，并测量了瞬时总能量 $E(t)$ 随时间 $t$ 的变化。在每次引导性运行中，对 $E(t)$ 进行线性拟合得到一个能量漂移率 $s = dE/dt$，假定该漂移率在短时间窗口内是恒定的。测量结果如下：\n- $\\Delta t_{1} = 1.0$ 飞秒，$s_{1} = 0.005$ 千焦耳每摩尔每皮秒，\n- $\\Delta t_{2} = 2.0$ 飞秒，$s_{2} = 0.020$ 千焦耳每摩尔每皮秒。\n\n从 $H(q,p)$ 的 Hamilton 方程和速度 Verlet 更新的定义出发，推导能量漂移率 $s$ 相对于时间步长 $\\Delta t$ 对时间可逆辛积分器的主阶标度关系，并解释如何使用该标度关系来诊断能量漂移是由数值积分误差引起的，还是由先前平衡不充分导致的残余物理弛豫引起的。然后，假设测量结果与推导出的主阶标度关系一致，确定关联 $s$ 和 $\\Delta t$ 的比例系数。最后，生产标准是在持续时间为 $T_{\\mathrm{prod}} = 1.0$ 纳秒的生产轨迹上，相对能量漂移必须小于 $r_{\\mathrm{thr}} = 1.0 \\times 10^{-3}$。生产运行开始时系统的初始总能量大小为 $E_{0} = 5.0 \\times 10^{3}$ 千焦耳每摩尔。使用推导出的关系，计算满足生产标准的最大允许时间步长 $\\Delta t_{\\max}$。将最终的 $\\Delta t_{\\max}$ 以飞秒为单位表示，并将您的数值答案四舍五入到三位有效数字。", "solution": "问题陈述被评估为有效。它在科学上基于计算材料科学的原理，特别是经典分子动力学 (MD) 模拟。问题是良定的、客观的且内部一致的，提供了进行唯一且有意义的求解所需的所有必要数据。给定的物理量和模拟参数值是符合实际的。\n\n该问题需要一个四部分分析：(1) 推导能量漂移随积分时间步长的标度关系，(2) 解释该标度关系如何区分数值误差和物理弛豫，(3) 根据提供的数据确定比例常数，以及 (4) 基于给定的稳定性标准计算生产运行的最大允许时间步长。\n\n首先，我们分析 NVE 模拟中能量漂移的来源。在一个完美的解析世界中，Hamilton 运动方程精确地守恒总能量 $H(q,p)$。哈密顿量的时间导数为：\n$$\n\\frac{dH}{dt} = \\sum_i \\left( \\frac{\\partial H}{\\partial q_i} \\dot{q}_i + \\frac{\\partial H}{\\partial p_i} \\dot{p}_i \\right)\n$$\n使用 Hamilton 方程，$\\dot{q}_i = \\frac{\\partial H}{\\partial p_i}$ 和 $\\dot{p}_i = -\\frac{\\partial H}{\\partial q_i}$，上式变为：\n$$\n\\frac{dH}{dt} = \\sum_i \\left( (-\\dot{p}_i) \\dot{q}_i + (\\dot{q}_i) \\dot{p}_i \\right) = 0\n$$\n像速度 Verlet 算法这样的数值积分器会引入离散化误差。辛积分器（如速度 Verlet）的一个关键特征是它们并不精确守恒真实的哈密顿量 $H$。相反，它们精确守恒一个与 $H$ 相近的修正或“影子”哈密顿量 $\\tilde{H}$。对于一个对称的二阶积分器，影子哈密顿量可以表示为时间步长 $\\Delta t$ 的偶次幂级数：\n$$\n\\tilde{H}(q,p) = H(q,p) + H_2(q,p)(\\Delta t)^2 + H_4(q,p)(\\Delta t)^4 + \\mathcal{O}((\\Delta t)^6)\n$$\n系统的能量 $E(t)=H(q(t),p(t))$ 是沿着积分器生成的轨迹计算的，因此会发生波动。守恒值 $\\tilde{H}$ 与轨迹上 $H$ 的平均值之间的差异与 $(\\Delta t)^2$ 成比例。理想情况下，能量应该只在一个恒定值附近有界振荡，但在实践中，诸如有限浮点精度以及更重要的局部截断误差的累积等因素，可能导致长期的系统性漂移。对于二阶积分器，能量的局部误差（每步）为 $\\mathcal{O}((\\Delta t)^3)$ 阶。在总模拟时间 $T_{\\text{sim}} = N \\Delta t$ 内，全局误差会累积，导致漂移。这种数值能量漂移的速率 $s_{\\text{num}} = dE/dt$ 预计与积分器的主导误差项成比例。对于像速度 Verlet 这样的二阶方案，该漂移速率与时间步长成二次方关系：\n$$\ns_{\\text{num}} \\propto (\\Delta t)^2\n$$\n这可以写成 $s_{\\text{num}} = k (\\Delta t)^2$，其中 $k$ 是一个比例常数，它依赖于系统的属性（例如，原子振动频率、势能面）。\n\n这种标度行为是一个强大的诊断工具。观测到的能量漂移 $s$ 可以有两个主要组成部分：数值漂移 $s_{\\text{num}}$ 和由不完全平衡引起的物理漂移 $s_{\\text{phys}}$。如果在 NVE 生产运行开始时系统尚未达到热平衡，它将继续向平衡态弛豫。这种物理弛豫（例如，结构重排、子系统间的温度重新分布）是一个不可逆过程，其速率 $s_{\\text{phys}}$ 是系统当前状态的内在属性，应独立于数值时间步长 $\\Delta t$。因此，总的观测漂移为：\n$$\ns(\\Delta t) = s_{\\text{phys}} + s_{\\text{num}} = s_{\\text{phys}} + k (\\Delta t)^2\n$$\n通过在两个或更多不同的时间步长 $\\Delta t$ 下测量漂移率 $s$，可以区分这两种贡献。如果 $s$ 对 $(\\Delta t)^2$ 的图得到一条具有非零 y 轴截距的直线，则截距的值对应于 $s_{\\text{phys}}$，表明平衡不充分。如果截距为零（在统计误差范围内），则 $s_{\\text{phys}} \\approx 0$，这表示系统已充分平衡，观测到的漂移纯粹是数值赝象。\n\n问题提供了两个测量值：\n1. $\\Delta t_{1} = 1.0 \\text{ fs}$，$s_{1} = 0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1}$\n2. $\\Delta t_{2} = 2.0 \\text{ fs}$，$s_{2} = 0.020 \\text{ kJ mol}^{-1} \\text{ps}^{-1}$\n\n我们检查漂移率的比率与时间步长平方的比率：\n$$\n\\frac{s_2}{s_1} = \\frac{0.020}{0.005} = 4\n$$\n$$\n\\left(\\frac{\\Delta t_2}{\\Delta t_1}\\right)^2 = \\left(\\frac{2.0}{1.0}\\right)^2 = 4\n$$\n由于 $\\frac{s_2}{s_1} = \\left(\\frac{\\Delta t_2}{\\Delta t_1}\\right)^2$，这证实了观测到的漂移与主阶数值误差标度关系 $s = k (\\Delta t)^2$ 一致，我们可以得出结论，物理弛豫分量可以忽略不计，$s_{\\text{phys}} \\approx 0$。先前的平衡是充分的。\n\n我们现在确定比例系数 $k$。使用第一个数据点：\n$$\nk = \\frac{s_1}{(\\Delta t_1)^2} = \\frac{0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1}}{(1.0 \\text{ fs})^2} = 0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1} \\text{fs}^{-2}\n$$\n$k$ 的单位正确地反映了这种关系。\n\n最后，我们计算满足生产标准的最大允许时间步长 $\\Delta t_{\\max}$。该标准规定，在持续时间为 $T_{\\mathrm{prod}}$ 的生产运行中，相对能量漂移必须小于阈值 $r_{\\mathrm{thr}}$。总能量变化为 $\\Delta E_{\\mathrm{prod}} = s \\cdot T_{\\mathrm{prod}}$。该标准是：\n$$\n\\frac{|\\Delta E_{\\mathrm{prod}}|}{|E_0|} \\le r_{\\mathrm{thr}}\n$$\n代入 $\\Delta E_{\\mathrm{prod}} = k (\\Delta t)^2 T_{\\mathrm{prod}}$ 并在条件的边界上求解最大时间步长 $\\Delta t_{\\max}$：\n$$\n\\frac{k (\\Delta t_{\\max})^2 T_{\\mathrm{prod}}}{|E_0|} = r_{\\mathrm{thr}}\n$$\n$$\n\\Delta t_{\\max} = \\sqrt{\\frac{r_{\\mathrm{thr}} |E_0|}{k T_{\\mathrm{prod}}}}\n$$\n给定的值为：\n- $r_{\\mathrm{thr}} = 1.0 \\times 10^{-3}$\n- $E_{0} = 5.0 \\times 10^{3} \\text{ kJ mol}^{-1}$\n- $T_{\\mathrm{prod}} = 1.0 \\text{ ns} = 1.0 \\times 10^3 \\text{ ps}$\n- $k = 0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1} \\text{fs}^{-2}$\n\n我们将这些值代入 $\\Delta t_{\\max}$ 的方程中：\n$$\n\\Delta t_{\\max} = \\sqrt{\\frac{(1.0 \\times 10^{-3}) \\cdot (5.0 \\times 10^{3} \\text{ kJ mol}^{-1})}{(0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1} \\text{fs}^{-2}) \\cdot (1.0 \\times 10^3 \\text{ ps})}}\n$$\n$$\n\\Delta t_{\\max} = \\sqrt{\\frac{5.0 \\text{ kJ mol}^{-1}}{5.0 \\text{ kJ mol}^{-1} \\text{fs}^{-2}}} = \\sqrt{1.0 \\text{ fs}^2} = 1.0 \\text{ fs}\n$$\n问题要求答案四舍五入到三位有效数字。因此，最大允许时间步长为 $1.00 \\text{ fs}$。", "answer": "$$\n\\boxed{1.00}\n$$", "id": "3449055"}, {"introduction": "一旦系统充分平衡，就进入了生产阶段，我们在此阶段收集数据以测量物理性质。简单地将模拟运行“很长时间”是低效且不科学的。这最后一个实践练习 [@problem_id:3449010] 将为您提供工具，像设计一个严谨的实验一样设计生产阶段的模拟，基于可观测量内在的涨落和关联时间，精确计算达到目标统计误差所需的模拟时长。", "problem": "您的任务是为来自平稳、遍历的分子动力学轨迹的单个标量可观测量设计一个有原则的生产-采样方案。假设该可观测量具有一个由 $\\sigma$ 表示的平衡（平稳）标准差（与可观测量的物理单位相同），一个平衡均值 $\\mu$（其大小 $\\lvert \\mu \\rvert$ 已知），以及一个由 $\\tau_{\\mathrm{int}}$ 表示的有限积分自相关时间（IAT），单位为皮秒（ps）。采样频率足够高，因此连续时间近似是有效的。给定一个以小数表示的目标相对误差容限 $\\rho$（例如，$\\rho = 0.01$ 表示百分之一），您必须确保样本均值的相对标准误差不超过 $\\rho$。您还必须强制要求有效非相关样本数量有一个硬性最小值 $N_{\\mathrm{eff,min}}$，以防止小样本病态问题。生产阶段必须在初始的平衡化抛弃阶段之后进行，该阶段定义为 $T_{\\mathrm{eq}} = B \\, \\tau_{\\mathrm{int}}$，其中 $B$ 是一个无量纲因子，$T_{\\mathrm{eq}}$ 的单位是ps。\n\n您可以假设的基本原理：\n- 该过程在平衡后是平稳且遍历的，具有有限方差和有限IAT。\n- 对于相关平稳过程的中心极限定理适用于随着轨迹时长的增长的样本均值。\n- 对于连续时间过程，积分自相关时间 $\\tau_{\\mathrm{int}}$ 定义为归一化自相关函数在非负时间上的积分。\n\n任务：\n1. 从所述基本原理出发，推导出一个表达式，用于计算所需的最小生产时长 $T_{\\mathrm{prod}}$（单位ps），以使样本均值的相对标准误差最多为 $\\rho$。该表达式应以 $\\sigma$、$\\lvert \\mu \\rvert$、$\\tau_{\\mathrm{int}}$ 和 $\\rho$ 表示。同时，通过要求 $T_{\\mathrm{prod}}$ 至少不小于由 $N_{\\mathrm{eff,min}}$ 所隐含的值来强制执行有效非相关样本的硬性最小数量，其中在连续时间近似下，时长为 $T$ 的生产运行的有效样本大小为 $N_{\\mathrm{eff}} = T / \\left(2 \\tau_{\\mathrm{int}}\\right)$。\n2. 提出了一个在生产过程中在线调整运行长度的监控计划。该计划在平衡化后使用由监控窗口 $W$（单位ps）分隔的周期性检查点，但为确保更新具有统计意义，需将监控窗口向上取整为 $W_{\\mathrm{eff}} = \\max\\{W, \\, w_{\\min} \\tau_{\\mathrm{int}}\\}$，其中 $w_{\\min}$ 是一个无量纲乘数。在每个检查点，将通过分块或批次均值法重新估计 $\\sigma$ 和 $\\tau_{\\mathrm{int}}$，并重新计算停止目标。对于此编程任务，仅通过报告检查点数量 $K = \\lceil T_{\\mathrm{prod}} / W_{\\mathrm{eff}} \\rceil$ 和最后一个检查点的时间 $t_{\\mathrm{last}} = T_{\\mathrm{eq}} + T_{\\mathrm{prod}}$（ps）来总结该计划。\n3. 对于每个测试用例，计算：\n   - $T_{\\mathrm{prod}}$（单位ps），\n   - $T_{\\mathrm{total}} = T_{\\mathrm{eq}} + T_{\\mathrm{prod}}$（单位ps），\n   - $K$（整数），\n   - $t_{\\mathrm{last}}$（单位ps）。\n   所有时间均四舍五入到三位小数。所有时间必须以ps为单位表示。\n\n测试套件：\n提供一个程序，为以下测试用例计算上述值。每个测试用例是一个元组 $(\\sigma, \\tau_{\\mathrm{int}}, \\lvert \\mu \\rvert, \\rho, B, N_{\\mathrm{eff,min}}, W, w_{\\min})$，其中 $\\sigma$ 和 $\\lvert \\mu \\rvert$ 的单位与可观测量一致，$\\tau_{\\mathrm{int}}$ 的单位是ps，$\\rho$ 是一个小数，$B$ 是无量纲的，$N_{\\mathrm{eff,min}}$ 是无量纲的，$W$ 的单位是ps，$w_{\\min}$ 是无量纲的。\n\n- 案例 A（一般情况）：$(5.0, 2.0, 100.0, 0.01, 10.0, 50, 5.0, 4.0)$\n- 案例 B（大变异系数，长 $\\tau_{\\mathrm{int}}$）：$(20.0, 5.0, 5.0, 0.05, 15.0, 30, 25.0, 3.0)$\n- 案例 C（极小的 $\\tau_{\\mathrm{int}}$，紧凑的监控乘数）：$(1.0, 0.01, 10.0, 0.02, 8.0, 50, 0.05, 10.0)$\n- 案例 D（由 $N_{\\mathrm{eff,min}}$ 主导的短生产过程，非常稀疏的监控）：$(2.0, 1.0, 50.0, 0.1, 10.0, 5, 100.0, 2.0)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个包含四个子列表的列表，每个测试用例一个子列表，每个子列表的形式为 $[T_{\\mathrm{prod}}, T_{\\mathrm{total}}, K, t_{\\mathrm{last}}]$，其中时间单位为ps（四舍五入到三位小数），$K$ 为整数。该列表必须打印在单行中，不含任何额外文本，例如：\n[[a1,b1,c1,d1],[a2,b2,c2,d2],[a3,b3,c3,d3],[a4,b4,c4,d4]]。", "solution": "问题陈述已经过验证，被认为是计算材料科学中一个有效且适定的问题。它在科学上基于时间序列分析的统计力学，提供了一套完整且一致的定义和数据，并以客观、正式的语言表述。没有发现可识别的缺陷。因此，我们可以着手解决。\n\n主要目标是推导出一套公式，用于规划分子动力学模拟，以达到标量可观测量的期望统计精度。这涉及根据可观测量的统计特性确定必要的平衡和生产时长。\n\n首先，我们推导所需的最小生产时间 $T_{\\mathrm{prod}}$。问题指定了 $T_{\\mathrm{prod}}$ 必须满足的两个独立约束：一个基于目标相对误差，另一个基于有效样本的最小数量。\n\n此分析的基础是时间相关可观测量的样本均值的方差。对于一个具有平衡均值 $\\mu$ 和方差 $\\sigma^2$ 的平稳遍历过程 $A(t)$，在时长为 $T_{\\mathrm{prod}}$ 的生产运行中，样本均值为 $\\bar{A} = \\frac{1}{T_{\\mathrm{prod}}} \\int_{0}^{T_{\\mathrm{prod}}} A(t) dt$。对于足够长的轨迹（$T_{\\mathrm{prod}} \\gg \\tau_{\\mathrm{int}}$），相关过程的中心极限定理指出，样本均值的方差 $\\mathrm{Var}(\\bar{A})$ 近似为：\n$$ \\mathrm{Var}(\\bar{A}) \\approx \\frac{2 \\sigma^2 \\tau_{\\mathrm{int}}}{T_{\\mathrm{prod}}} $$\n其中 $\\tau_{\\mathrm{int}}$ 是积分自相关时间。均值的标准误差 $SE(\\bar{A})$ 是该方差的平方根：\n$$ SE(\\bar{A}) = \\sqrt{\\mathrm{Var}(\\bar{A})} \\approx \\sigma \\sqrt{\\frac{2 \\tau_{\\mathrm{int}}}{T_{\\mathrm{prod}}}} $$\n\n第一个约束是相对标准误差不得超过容限 $\\rho$：\n$$ \\frac{SE(\\bar{A})}{\\lvert \\mu \\rvert} \\le \\rho $$\n代入 $SE(\\bar{A})$ 的表达式可得：\n$$ \\frac{1}{\\lvert \\mu \\rvert} \\sigma \\sqrt{\\frac{2 \\tau_{\\mathrm{int}}}{T_{\\mathrm{prod}}}} \\le \\rho $$\n为了找到满足此条件的最小持续时间，我们求解 $T_{\\mathrm{prod}}$。对不等式两边平方（由于所有项均为非负，这是允许的），得到：\n$$ \\frac{\\sigma^2}{\\lvert \\mu \\rvert^2} \\frac{2 \\tau_{\\mathrm{int}}}{T_{\\mathrm{prod}}} \\le \\rho^2 $$\n$$ T_{\\mathrm{prod}} \\ge \\frac{2 \\sigma^2 \\tau_{\\mathrm{int}}}{\\rho^2 \\lvert \\mu \\rvert^2} = 2 \\tau_{\\mathrm{int}} \\left( \\frac{\\sigma}{\\rho \\lvert \\mu \\rvert} \\right)^2 $$\n我们将这个基于误差容限的最小生产时间表示为 $T_{\\mathrm{prod},\\rho}$。\n\n第二个约束是有效非相关样本数量的硬性最小值 $N_{\\mathrm{eff,min}}$。问题给出了时长为 $T_{\\mathrm{prod}}$ 的运行的有效样本大小 $N_{\\mathrm{eff}}$ 的定义：\n$$ N_{\\mathrm{eff}} = \\frac{T_{\\mathrm{prod}}}{2 \\tau_{\\mathrm{int}}} $$\n约束条件为 $N_{\\mathrm{eff}} \\ge N_{\\mathrm{eff,min}}$，这可转换为：\n$$ \\frac{T_{\\mathrm{prod}}}{2 \\tau_{\\mathrm{int}}} \\ge N_{\\mathrm{eff,min}} $$\n求解 $T_{\\mathrm{prod}}$ 得到基于此样本大小要求的最小生产时间，我们将其表示为 $T_{\\mathrm{prod},N}$：\n$$ T_{\\mathrm{prod}} \\ge 2 \\tau_{\\mathrm{int}} N_{\\mathrm{eff,min}} $$\n所以，$T_{\\mathrm{prod},N} = 2 \\tau_{\\mathrm{int}} N_{\\mathrm{eff,min}}$。\n\n为同时满足这两个约束，所选的生产时长 $T_{\\mathrm{prod}}$ 必须至少与 $T_{\\mathrm{prod},\\rho}$ 和 $T_{\\mathrm{prod},N}$ 一样大。因此，我们必须取两者中的最大值：\n$$ T_{\\mathrm{prod}} = \\max\\left( T_{\\mathrm{prod},\\rho}, T_{\\mathrm{prod},N} \\right) = \\max\\left( 2 \\tau_{\\mathrm{int}} \\left( \\frac{\\sigma}{\\rho \\lvert \\mu \\rvert} \\right)^2, \\, 2 \\tau_{\\mathrm{int}} N_{\\mathrm{eff,min}} \\right) $$\n这可以更紧凑地写为：\n$$ T_{\\mathrm{prod}} = 2 \\tau_{\\mathrm{int}} \\max\\left( \\left( \\frac{\\sigma}{\\rho \\lvert \\mu \\rvert} \\right)^2, \\, N_{\\mathrm{eff,min}} \\right) $$\n这个表达式提供了所需生产时间的最终公式。\n\n接下来，我们定义模拟计划所需的其他量。被舍弃的初始平衡阶段，其时长 $T_{\\mathrm{eq}}$ 定义为：\n$$ T_{\\mathrm{eq}} = B \\, \\tau_{\\mathrm{int}} $$\n其中 $B$ 是一个无量纲乘数。\n\n总模拟时间 $T_{\\mathrm{total}}$ 是平衡和生产时长的总和：\n$$ T_{\\mathrm{total}} = T_{\\mathrm{eq}} + T_{\\mathrm{prod}} $$\n\n监控计划涉及检查点。检查点之间的间隔基于一个有效的监控窗口 $W_{\\mathrm{eff}}$，该窗口被定义为不小于自相关时间的倍数：\n$$ W_{\\mathrm{eff}} = \\max\\{W, \\, w_{\\min} \\tau_{\\mathrm{int}}\\} $$\n其中 $W$ 是期望的基础窗口大小，$w_{\\min}$ 是一个无量纲因子。\n\n生产阶段的检查点数量 $K$ 是总生产时间除以有效窗口大小，并向上取整，以确保覆盖整个运行过程：\n$$ K = \\left\\lceil \\frac{T_{\\mathrm{prod}}}{W_{\\mathrm{eff}}} \\right\\rceil $$\n其中 $\\lceil \\cdot \\rceil$ 是向上取整函数。\n\n最后，最后一个检查点的时间 $t_{\\mathrm{last}}$ 在问题陈述中被明确定义为整个模拟运行结束时的时间：\n$$ t_{\\mathrm{last}} = T_{\\mathrm{eq}} + T_{\\mathrm{prod}} = T_{\\mathrm{total}} $$\n\n这些推导和定义的公式在随附的Python程序中实现，用于计算每个测试用例所需的值。所有基于时间的结果都按要求四舍五入到三位小数。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a molecular dynamics simulation plan based on statistical targets.\n    \"\"\"\n    # Test cases are provided as tuples of the form:\n    # (sigma, tau_int, abs_mu, rho, B, N_eff_min, W, w_min)\n    test_cases = [\n        (5.0, 2.0, 100.0, 0.01, 10.0, 50, 5.0, 4.0),\n        (20.0, 5.0, 5.0, 0.05, 15.0, 30, 25.0, 3.0),\n        (1.0, 0.01, 10.0, 0.02, 8.0, 50, 0.05, 10.0),\n        (2.0, 1.0, 50.0, 0.1, 10.0, 5, 100.0, 2.0)\n    ]\n\n    all_results_str = []\n\n    for case in test_cases:\n        sigma, tau_int, abs_mu, rho, B, N_eff_min, W, w_min = case\n\n        # Task 1: Calculate the minimum production duration T_prod.\n        # This requires satisfying two constraints: one on relative error\n        # and one on the minimum number of effective samples.\n\n        # Calculate the required number of effective samples from the error tolerance.\n        # This term is (sigma / (rho * |mu|))^2.\n        # A check for abs_mu being zero is prudent in a general-purpose function,\n        # but is not necessary for the given test cases.\n        term_from_error = (sigma / (rho * abs_mu))**2\n\n        # The production duration is determined by the maximum of the two requirements.\n        T_prod = 2 * tau_int * max(term_from_error, N_eff_min)\n\n        # Calculate equilibration time and total simulation time.\n        T_eq = B * tau_int\n        T_total = T_eq + T_prod\n\n        # Task 2: Calculate monitoring plan parameters.\n\n        # The effective monitoring window ensures statistically meaningful updates.\n        W_eff = max(W, w_min * tau_int)\n\n        # The number of checkpoints is the number of windows needed to cover T_prod.\n        K = int(np.ceil(T_prod / W_eff))\n\n        # The time of the last checkpoint is defined as the end of the total run.\n        t_last = T_total\n\n        # Format the results for the current test case as a string.\n        # Times are rounded to three decimal places.\n        sublist_str = (\n            f\"[{T_prod:.3f},\"\n            f\"{T_total:.3f},\"\n            f\"{K},\"\n            f\"{t_last:.3f}]\"\n        )\n        all_results_str.append(sublist_str)\n\n    # Combine the string representations of each sublist into the final output string.\n    final_output = f\"[{','.join(all_results_str)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3449010"}]}