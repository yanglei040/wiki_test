{"hands_on_practices": [{"introduction": "理解不同统计系综之间的根本差异是掌握统计力学的关键。本练习采用一个简单且可精确求解的二位点晶格气模型，让您能够直接比较正则系综（粒子数$N$固定）和巨正则系综（粒子数$N$可变）的行为。通过枚举所有可能的微观状态，您不仅将计算热力学性质，还将亲眼见证涨落-响应定理的实际应用，从而将微观的粒子数涨落与宏观的可压缩性等性质联系起来。这项实践旨在巩固选择不同系综的理论基础，并深化您对系综理论的直观理解 [@problem_id:3467666]。", "problem": "考虑一个一维格点气体模型，该模型包含 $2$ 个标记为 $i \\in \\{1,2\\}$ 的位点，其硬核占据变量为 $n_i \\in \\{0,1\\}$。相互作用能为 $E(n_1,n_2) = -\\epsilon\\, n_1 n_2$，其中 $\\epsilon > 0$。除了与粒子数相关的化学功外，没有其他外场。系统处于温度 $T$ 下，逆温度为 $\\beta \\equiv 1/(k_B T)$，其中 $k_B$ 是玻尔兹曼常数。\n\n您将比较此有限系统的正则系综和巨正则系综，并将粒子数涨落与计算材料科学取样中的相关响应函数联系起来。\n\n从统计力学的基本定义和 Metropolis-Hastings (MH) 动力学的细致平衡出发，完成以下任务：\n\n1) 粒子数 $N$ 固定的正则系综：对于 $N=1$，通过枚举微观态及其能量，使用 $Z_{N}(T) = \\sum_{\\{\\mathbf{n}: \\sum_i n_i = N\\}} \\exp(-\\beta E)$ 构建正则配分函数 $Z_{N=1}(T)$。解释为什么在 $N$ 固定的正则系综中粒子数涨落为零，并讨论当 $\\mu$ 不是正则系综的控制变量时，这对定义为 $\\chi_N \\equiv \\left(\\partial \\langle N \\rangle / \\partial \\mu\\right)_{T,V}$ 的粒子数感受率有何影响。\n\n2) 巨正则系综和 Metropolis-Hastings 接受概率：在巨正则系综中，组态的权重为 $\\exp[-\\beta (E - \\mu N)]$，其中 $\\mu$ 是化学势，$N = n_1 + n_2$。考虑一个巨正则蒙特卡洛 (GCMC) 方案，该方案均匀随机地选择一个位点并提议翻转其占据数 $n_i \\to 1 - n_i$。从细致平衡出发，为这些对称提议推导 MH 接受概率 $p_{\\text{acc}} = \\min\\{1, \\exp[-\\beta (\\Delta E - \\mu \\Delta N)]\\}$，其中 $\\Delta E$ 和 $\\Delta N$ 分别是能量和粒子数的变化量。\n\n3) 通过枚举进行精确的巨正则计算：枚举 $4$ 个微观态以构建巨配分函数 $\\Xi(\\mu,T) = \\sum_{\\{n_1,n_2\\}} \\exp[-\\beta (E - \\mu N)]$。从第一性原理出发，计算巨正则系综平均值 $\\langle N \\rangle$ 和 $\\langle N^2 \\rangle$，并证明涨落-响应关系成立，即 $\\operatorname{Var}(N) = \\langle N^2 \\rangle - \\langle N \\rangle^2 = k_B T \\left(\\partial \\langle N \\rangle / \\partial \\mu\\right)_{T,V}$。\n\n4) 有限尺寸的压缩率和感受率：将有限尺寸的粒子数感受率定义为 $\\chi_N \\equiv \\left(\\partial \\langle N \\rangle / \\partial \\mu\\right)_{T,V}$，将单位体积 $V$ 的格点气体等温压缩率定义为 $\\kappa_T^{(\\text{lat})} \\equiv \\beta\\, \\operatorname{Var}(N)/V$。解释这些量如何将粒子数涨落与有限格点巨正则取样中的可测量响应联系起来。\n\n给出这个包含 $2$ 个位点的格点气体的巨正则粒子数方差 $\\operatorname{Var}(N)$ 作为 $\\beta$、$\\mu$ 和 $\\epsilon$ 的函数的精确闭合形式解析表达式，作为您的最终答案。不需要进行数值计算，也不需要四舍五入。最终答案必须是单个无单位的闭合形式解析表达式。", "solution": "题目陈述经审阅后被确定为有效。它在科学上基于统计力学原理，定义清晰完整，问题适定，并且表述客观。该问题是统计物理学中一个标准（尽管简单）的练习，完全可以使用所提供的信息来解决。\n\n1) 粒子数固定的正则系综 N=1：\n\n在正则系综中，粒子数 $N$、体积（或位点数）$V$ 和温度 $T$ 是固定的。对于给定的 $2$ 位点格点， $V=2$。题目指定了固定的粒子数 $N=1$。位点 $i$ 的占据数为 $n_i \\in \\{0,1\\}$，约束条件为 $\\sum_{i=1}^2 n_i = N = 1$。因此，可能的微观态 $(n_1, n_2)$ 是 $(1,0)$ 和 $(0,1)$。\n\n每个微观态的相互作用能使用 $E(n_1,n_2) = -\\epsilon n_1 n_2$ 计算：\n- 对于态 $(1,0)$，能量为 $E_{1,0} = -\\epsilon (1)(0) = 0$。\n- 对于态 $(0,1)$，能量为 $E_{0,1} = -\\epsilon (0)(1) = 0$。\n\n对于固定粒子数 $N$ 的正则配分函数 $Z_N(T)$ 是对所有允许的微观态的玻尔兹曼因子 $\\exp(-\\beta E)$求和，其中 $\\beta = 1/(k_B T)$。对于 $N=1$：\n$$Z_{N=1}(T) = \\sum_{\\{\\mathbf{n}: \\sum_i n_i = 1\\}} \\exp(-\\beta E) = \\exp(-\\beta E_{1,0}) + \\exp(-\\beta E_{0,1}) = \\exp(-\\beta \\cdot 0) + \\exp(-\\beta \\cdot 0) = 1 + 1 = 2$$\n在正则系综中，根据定义，粒子数 $N$ 是固定的。它是一个系综参数，而不是一个涨落量。因此，粒子数的期望值就是 $\\langle N \\rangle = N=1$，其平方的期望值为 $\\langle N^2 \\rangle = N^2=1^2=1$。因此，衡量粒子数涨落的粒子数方差恒等于零：\n$$\\operatorname{Var}(N) = \\langle N^2 \\rangle - \\langle N \\rangle^2 = 1 - 1^2 = 0$$\n粒子数感受率定义为 $\\chi_N \\equiv \\left(\\partial \\langle N \\rangle / \\partial \\mu\\right)_{T,V}$。在正则系综中，化学势 $\\mu$ 不是一个控制系统状态的独立热力学变量；相反，它是由固定的 $N, V, T$ 决定的。由于 $\\langle N \\rangle = N$ 是一个常数，它对任何变量（包括派生的化学势）的导数都为零。因此，将粒子数感受率作为对外部 $\\mu$ 的响应这一概念在正则系综中是不适用的，该量在形式上为零。\n\n2) 巨正则系综和 Metropolis-Hastings 接受概率：\n\n在巨正则系综 (GCE) 中，一个微观态 $\\nu = \\{n_1, n_2, \\dots\\}$ 的概率 $P(\\nu)$ 由下式给出：\n$$P(\\nu) = \\frac{1}{\\Xi} \\exp[-\\beta (E_\\nu - \\mu N_\\nu)]$$\n其中 $\\Xi$ 是巨配分函数，$E_\\nu$ 是能量，$N_\\nu$ 是粒子数，$\\mu$ 是化学势。\n\nMetropolis-Hastings 算法满足细致平衡条件，这确保了马尔可夫链收敛到所需的平衡分布：\n$$P(\\nu) T(\\nu \\to \\nu') = P(\\nu') T(\\nu' \\to \\nu)$$\n此处，$T(\\nu \\to \\nu')$ 是从状态 $\\nu$ 到状态 $\\nu'$ 的转移概率。它由提议概率 $g(\\nu \\to \\nu')$ 和接受概率 $p_{\\text{acc}}(\\nu \\to \\nu')$ 组成：$T(\\nu \\to \\nu') = g(\\nu \\to \\nu') p_{\\text{acc}}(\\nu \\to \\nu')$。\n\n提议的移动是等概率 $1/2$ 地选择两个位点之一 $i \\in \\{1,2\\}$ 并翻转其占据数 $n_i \\to 1-n_i$。这个提议是对称的：从 $\\nu$ 到 $\\nu'$ 的移动提议概率（例如，将位点 $i$ 从 $0$ 翻转到 $1$）与从 $\\nu'$ 到 $\\nu$ 的逆向移动提议概率（将位点 $i$ 从 $1$ 翻转到 $0$）相同。因此，$g(\\nu \\to \\nu') = g(\\nu' \\to \\nu)$。\n\n将此代入细致平衡方程，得到：\n$$P(\\nu) g(\\nu \\to \\nu') p_{\\text{acc}}(\\nu \\to \\nu') = P(\\nu') g(\\nu \\to \\nu') p_{\\text{acc}}(\\nu' \\to \\nu)$$\n$$\\frac{p_{\\text{acc}}(\\nu \\to \\nu')}{p_{\\text{acc}}(\\nu' \\to \\nu)} = \\frac{P(\\nu')}{P(\\nu)} = \\frac{\\exp[-\\beta (E' - \\mu N')]}{\\exp[-\\beta (E - \\mu N)]} = \\exp[-\\beta ((E'-E) - \\mu(N'-N))]$$\n定义 $\\Delta E = E' - E$ 和 $\\Delta N = N' - N$，我们有：\n$$\\frac{p_{\\text{acc}}(\\nu \\to \\nu')}{p_{\\text{acc}}(\\nu' \\to \\nu)} = \\exp[-\\beta (\\Delta E - \\mu \\Delta N)]$$\nMetropolis-Hastings 对接受概率的选择是 $p_{\\text{acc}}(\\nu \\to \\nu') = \\min\\{1, P(\\nu')/P(\\nu)\\}$。因此，GCMC 移动的接受概率是：\n$$p_{\\text{acc}} = \\min\\{1, \\exp[-\\beta (\\Delta E - \\mu \\Delta N)]\\}$$\n\n3) 通过枚举进行精确的巨正则计算：\n\n我们枚举系统可能的 $2^2=4$ 个微观态 $(n_1, n_2)$：\n- 态 1: $(0,0)$。$N=0$, $E=0$。巨正则权重为 $\\exp[-\\beta(0-\\mu \\cdot 0)] = 1$。\n- 态 2: $(1,0)$。$N=1$, $E=0$。权重为 $\\exp[-\\beta(0-\\mu \\cdot 1)] = \\exp(\\beta\\mu)$。\n- 态 3: $(0,1)$。$N=1$, $E=0$。权重为 $\\exp[-\\beta(0-\\mu \\cdot 1)] = \\exp(\\beta\\mu)$。\n- 态 4: $(1,1)$。$N=2$, $E=-\\epsilon$。权重为 $\\exp[-\\beta(-\\epsilon-\\mu \\cdot 2)] = \\exp(\\beta(\\epsilon+2\\mu))$。\n\n巨配分函数 $\\Xi(\\mu, T)$ 是这些权重的总和：\n$$\\Xi = 1 + 2\\exp(\\beta\\mu) + \\exp(\\beta(\\epsilon+2\\mu))$$\n平均粒子数 $\\langle N \\rangle$ 由 $\\langle N \\rangle = \\frac{1}{\\beta} \\frac{\\partial \\ln \\Xi}{\\partial \\mu}$ 给出：\n$$\\frac{\\partial \\Xi}{\\partial \\mu} = 2\\beta\\exp(\\beta\\mu) + 2\\beta\\exp(\\beta(\\epsilon+2\\mu))$$\n$$\\langle N \\rangle = \\frac{1}{\\beta \\Xi} \\frac{\\partial \\Xi}{\\partial \\mu} = \\frac{2\\exp(\\beta\\mu) + 2\\exp(\\beta(\\epsilon+2\\mu))}{1 + 2\\exp(\\beta\\mu) + \\exp(\\beta(\\epsilon+2\\mu))}$$\n粒子数平方的平均值 $\\langle N^2 \\rangle$ 由 $\\langle N^2 \\rangle = \\frac{1}{\\beta^2 \\Xi} \\frac{\\partial^2 \\Xi}{\\partial \\mu^2}$ 给出：\n$$\\frac{\\partial^2 \\Xi}{\\partial \\mu^2} = 2\\beta^2\\exp(\\beta\\mu) + 4\\beta^2\\exp(\\beta(\\epsilon+2\\mu))$$\n$$\\langle N^2 \\rangle = \\frac{1}{\\beta^2 \\Xi} \\frac{\\partial^2 \\Xi}{\\partial \\mu^2} = \\frac{2\\exp(\\beta\\mu) + 4\\exp(\\beta(\\epsilon+2\\mu))}{1 + 2\\exp(\\beta\\mu) + \\exp(\\beta(\\epsilon+2\\mu))}$$\n为了验证涨落-响应关系，我们计算恒等式 $\\operatorname{Var}(N) = k_B T (\\partial \\langle N \\rangle / \\partial \\mu)_{T,V}$ 的两边。\n左边是方差：$\\operatorname{Var}(N) = \\langle N^2 \\rangle - \\langle N \\rangle^2$。\n右边是 $k_B T \\frac{\\partial \\langle N \\rangle}{\\partial \\mu} = \\frac{1}{\\beta} \\frac{\\partial \\langle N \\rangle}{\\partial \\mu}$。使用 $\\langle N \\rangle = \\frac{1}{\\beta}\\frac{\\partial \\ln\\Xi}{\\partial\\mu}$，我们有：\n$$\\frac{1}{\\beta} \\frac{\\partial \\langle N \\rangle}{\\partial \\mu} = \\frac{1}{\\beta^2} \\frac{\\partial^2 \\ln\\Xi}{\\partial\\mu^2} = \\frac{1}{\\beta^2} \\frac{\\partial}{\\partial\\mu} \\left( \\frac{1}{\\Xi}\\frac{\\partial\\Xi}{\\partial\\mu} \\right) = \\frac{1}{\\beta^2} \\left( \\frac{1}{\\Xi}\\frac{\\partial^2\\Xi}{\\partial\\mu^2} - \\frac{1}{\\Xi^2}\\left(\\frac{\\partial\\Xi}{\\partial\\mu}\\right)^2 \\right)$$\n$$= \\frac{1}{\\beta^2\\Xi}\\frac{\\partial^2\\Xi}{\\partial\\mu^2} - \\left(\\frac{1}{\\beta\\Xi}\\frac{\\partial\\Xi}{\\partial\\mu}\\right)^2$$\n这恰好是 $\\langle N^2 \\rangle - \\langle N \\rangle^2$ 的定义。因此，涨落-响应关系对该系统被证明成立。\n\n4) 有限尺寸的压缩率和感受率：\n\n粒子数感受率 $\\chi_N$ 和格点气体压缩率 $\\kappa_T^{(\\text{lat})}$ 定义为：\n$$\\chi_N \\equiv \\left(\\frac{\\partial \\langle N \\rangle}{\\partial \\mu}\\right)_{T,V} \\quad \\text{和} \\quad \\kappa_T^{(\\text{lat})} \\equiv \\frac{\\beta}{V} \\operatorname{Var}(N)$$\n从第 3 部分推导的涨落-响应关系，我们有 $\\operatorname{Var}(N) = k_B T \\chi_N = \\frac{1}{\\beta} \\chi_N$。\n这直接意味着感受率和方差之间的联系：$\\chi_N = \\beta \\operatorname{Var}(N)$。\n将此代入压缩率的定义中得到：\n$$\\kappa_T^{(\\text{lat})} = \\frac{\\beta}{V} \\left( \\frac{1}{\\beta} \\chi_N \\right) = \\frac{\\chi_N}{V}$$\n这些关系表明，在 GCMC 模拟中通过 $\\operatorname{Var}(N)$ 测量的粒子数涨落并非随机噪声，而是包含深刻的物理信息。方差与热力学响应函数——粒子数感受率成正比。而后者又与等温压缩率相关。因此，通过在单个固定 $(\\mu, V, T)$ 的巨正则模拟中观察和量化粒子数的自然涨落，人们可以计算系统的宏观响应性质，而无需在不同的 $\\mu$ 值下执行多次模拟并数值近似求导。\n\n最后，我们推导粒子数方差 $\\operatorname{Var}(N) = \\langle N^2 \\rangle - \\langle N \\rangle^2$ 的显式解析表达式。\n令 $x = \\exp(\\beta\\mu)$ 和 $y = \\exp(\\beta\\epsilon)$。配分函数为 $\\Xi = 1 + 2x + yx^2$。\n$$\\langle N \\rangle = \\frac{2x + 2yx^2}{\\Xi} \\quad \\text{和} \\quad \\langle N^2 \\rangle = \\frac{2x + 4yx^2}{\\Xi}$$\n$$\\operatorname{Var}(N) = \\frac{2x + 4yx^2}{\\Xi} - \\left(\\frac{2x + 2yx^2}{\\Xi}\\right)^2 = \\frac{(2x + 4yx^2)\\Xi - (2x + 2yx^2)^2}{\\Xi^2}$$\n分子是：\n$$(2x + 4yx^2)(1+2x+yx^2) - (4x^2 + 8yx^3 + 4y^2x^4)$$\n$$= (2x + 4x^2 + 2yx^3 + 4yx^2 + 8yx^3 + 4y^2x^4) - (4x^2 + 8yx^3 + 4y^2x^4)$$\n$$= 2x + (4x^2 - 4x^2) + 4yx^2 + (2yx^3 + 8yx^3 - 8yx^3) + (4y^2x^4 - 4y^2x^4)$$\n$$= 2x + 4yx^2 + 2yx^3$$\n代回原始变量：\n$$\\operatorname{Var}(N) = \\frac{2\\exp(\\beta\\mu) + 4\\exp(\\beta\\epsilon)\\exp(2\\beta\\mu) + 2\\exp(\\beta\\epsilon)\\exp(3\\beta\\mu)}{(1 + 2\\exp(\\beta\\mu) + \\exp(\\beta\\epsilon)\\exp(2\\beta\\mu))^2}$$\n这可以写成：\n$$\\operatorname{Var}(N) = \\frac{2\\exp(\\beta\\mu) + 4\\exp(\\beta\\epsilon + 2\\beta\\mu) + 2\\exp(\\beta\\epsilon + 3\\beta\\mu)}{\\left(1 + 2\\exp(\\beta\\mu) + \\exp(\\beta\\epsilon + 2\\beta\\mu)\\right)^2}$$\n这就是粒子数方差的最终表达式。", "answer": "$$\\boxed{\\frac{2\\exp(\\beta\\mu) + 4\\exp(\\beta\\epsilon + 2\\beta\\mu) + 2\\exp(\\beta\\epsilon + 3\\beta\\mu)}{\\left(1 + 2\\exp(\\beta\\mu) + \\exp(\\beta\\epsilon + 2\\beta\\mu)\\right)^2}}$$", "id": "3467666"}, {"introduction": "在理解了系综的物理意义之后，我们转向如何高效地进行模拟。对于一个包含$N$个粒子的系统，简单地计算每次移动后的总能量变化$\\Delta E$在计算上是昂贵的。本练习聚焦于蒙特卡洛模拟的核心：在给定成对势的情况下，高效地计算粒子移动引起的能量变化。更重要的是，您将设计并实现关键的数据结构，例如元胞链表和邻居列表，这些结构能将计算能量变化的平均时间复杂度从$O(N)$降低到$O(1)$。这项实践将理论公式与模拟大规模系统所必需的高性能算法联系起来，为您搭建了从理论到实践的桥梁 [@problem_id:3467668]。", "problem": "给定一个边长为 $L$ 的三维、周期性、立方模拟单元格，其中包含 $N$ 个经典的、通过对加势相互作用的点粒子。所有量均采用约化的 Lennard-Jones（无量纲）单位，其中玻尔兹曼常数 $k_{\\mathrm{B}}=1$，Lennard-Jones 势阱深度 $\\epsilon=1$，Lennard-Jones 直径 $\\sigma=1$，热德布罗意波长 $\\Lambda=1$。周期性边界条件使用最小镜像约定。对势在截断距离 $r_c$ 处被截断和移位，因此对相互作用能 $u(r)$ 为\n$$\nu(r) = \\begin{cases}\n4\\left[\\left(\\dfrac{1}{r}\\right)^{12} - \\left(\\dfrac{1}{r}\\right)^{6}\\right] - 4\\left[\\left(\\dfrac{1}{r_c}\\right)^{12} - \\left(\\dfrac{1}{r_c}\\right)^{6}\\right],  r  r_c,\\\\\n0,  r \\ge r_c.\n\\end{cases}\n$$\n总势能为 $U = \\sum_{1 \\le i  j \\le N} u(r_{ij})$。\n\n你的任务是推导并实现用于计算蒙特卡洛移动的能量变化和接受概率的表达式。\n\n1) 粒子位移能量变化：\n对于一个包含 $N$ 个粒子的固定系统，推导单个粒子 $k$ 从位置 $\\mathbf{r}_k$ 位移到 $\\mathbf{r}_k'$ 所引起的总势能变化 $\\Delta E$ 的表达式。该表达式应以对势 $u(r)$ 的形式给出，并且计算复杂度应为 $O(N)$，而不是 $O(N^2)$。\n\n2) 用于粒子位移的邻居列表：\n为了将计算 $\\Delta E$ 的平均时间复杂度从 $O(N)$ 降低到 $O(1)$，通常会使用邻居列表。对于每个粒子 $i$，邻居列表包含所有距离 $r_{ij}$ 小于邻居列表截断半径 $r_n$ 的粒子 $j$。为了确保在多次移动后列表仍然有效，通常选择 $r_n = r_c + r_s$，其中 $r_s$ 是一个“表皮”厚度。解释为什么对于粒子位移，$\\Delta E$ 可以仅使用粒子 $k$ 的邻居列表中的粒子来计算，前提是粒子 $k$ 的位移幅度小于 $r_s$。\n\n3) 粒子插入/删除的接受概率：\n对于巨正则蒙特卡洛模拟，除了粒子位移外，还需要粒子插入和删除移动。在活度 $z \\equiv \\exp(\\beta\\mu)/\\Lambda^3 = \\exp(\\beta\\mu)$ 给定的情况下，推导 Metropolis-Hastings 接受概率 $p_{\\text{ins}}$（对于在体积 $V$ 内的随机位置插入一个新粒子）和 $p_{\\text{del}}$（对于随机删除一个现有粒子）的表达式。这些表达式应以 $N$、$\\beta$、$\\mu$、$V$ 和由于移动引起的势能变化 $\\Delta E$（分别为 $\\Delta E_{\\text{ins}}$ 或 $\\Delta E_{\\text{del}}$）为函数。\n\n4) 实施与测试：\n在下面的 Python 代码骨架中，实现逻辑以计算六个不同测试用例的 $\\Delta E$ 或接受概率。\n- 使用 $L=8.0$，$r_c=2.5$，$r_s=0.6$。\n- 对于粒子位移测试，你的代码应首先构建所移动粒子的邻居列表（$r_n = r_c + r_s$），然后仅使用该列表中的粒子来计算 $\\Delta E$。\n- 对于粒子插入测试，你必须实现一个元胞链表，其单元格大小 $l_{\\text{cell}} \\ge r_c + r_s$，以高效地计算 $\\Delta E_{\\text{ins}}$。\n- 对于粒子删除测试，$\\Delta E_{\\text{del}}$ 是移除一个粒子所节省的能量。\n- 最终输出必须是一个包含六个浮点数的 Python 列表，格式为 `[result1, result2, result3, result4, result5, result6]`，每个结果保留8位小数。", "solution": "该问题被评估为有效的，因为它在科学上基于统计力学和计算物理学，定义明确，所有必要参数均已给出，并且其表述是客观的。它代表了实现蒙特卡洛模拟组件的一个标准的、不平凡的练习。\n\n### 任务 1：粒子位移能量变化的推导\n\n$N$ 粒子系统的总势能由所有不重复对的总和给出：\n$$\nU = \\sum_{1 \\le i  j \\le N} u(r_{ij})\n$$\n其中 $u(r_{ij})$ 是粒子 $i$ 和 $j$ 之间的对势。\n\n当单个粒子（例如粒子 $k$）从初始位置 $\\mathbf{r}_k$ 位移到新位置 $\\mathbf{r}_k'$ 时，所有其他粒子 $\\{\\mathbf{r}_j\\}_{j \\neq k}$ 的位置保持不变。我们可以将总能量和分解为涉及粒子 $k$ 的项和不涉及粒子 $k$ 的项。\n\n初始总能量 $U_{\\text{old}}$ 为：\n$$\nU_{\\text{old}} = \\sum_{j \\neq k} u(r_{kj}) + \\sum_{1 \\le i  j \\le N, i,j \\neq k} u(r_{ij})\n$$\n第一项表示粒子 $k$ 与所有其他粒子的相互作用能。第二项是所有其他粒子之间的相互作用能。注意，总和 $\\sum_{j \\neq k}$ 隐式地覆盖了所有涉及 $k$ 的对。\n\n将粒子 $k$ 位移到 $\\mathbf{r}_k'$ 后的新总能量 $U_{\\text{new}}$ 为：\n$$\nU_{\\text{new}} = \\sum_{j \\neq k} u(r'_{kj}) + \\sum_{1 \\le i  j \\le N, i,j \\neq k} u(r_{ij})\n$$\n这里，$r_{kj}$ 是 $\\mathbf{r}_k$ 和 $\\mathbf{r}_j$ 之间的距离，而 $r'_{kj}$ 是新位置 $\\mathbf{r}_k'$ 和 $\\mathbf{r}_j$ 之间的距离。\n\n势能的变化 $\\Delta E$ 定义为 $U_{\\text{new}} - U_{\\text{old}}$。从 $U_{\\text{new}}$ 中减去 $U_{\\text{old}}$ 的表达式，不依赖于粒子 $k$ 位置的第二项被消掉：\n$$\n\\Delta E = \\left( \\sum_{j \\neq k} u(r'_{kj}) + \\sum_{1 \\le i  j \\le N, i,j \\neq k} u(r_{ij}) \\right) - \\left( \\sum_{j \\neq k} u(r_{kj}) + \\sum_{1 \\le i  j \\le N, i,j \\neq k} u(r_{ij}) \\right)\n$$\n$$\n\\Delta E = \\sum_{j \\neq k} u(r'_{kj}) - \\sum_{j \\neq k} u(r_{kj}) = \\sum_{j \\neq k} \\left[ u(r'_{kj}) - u(r_{kj}) \\right]\n$$\n该表达式仅涉及与被移动粒子 $k$ 相关的项。求和遍及 $N-1$ 个其他粒子，因此计算复杂度为 $O(N)$。\n\n### 任务 2：用于粒子位移的邻居列表\n\n在构建邻居列表时，我们存储所有与粒子 $k$ 的距离在 $r_n = r_c + r_s$ 之内的粒子。现在，考虑移动粒子 $k$ 一个位移 $\\Delta\\mathbf{r}_k$，其幅度 $|\\Delta\\mathbf{r}_k|  r_s$。\n\n对于任何不在邻居列表中的粒子 $j$，我们知道它与粒子 $k$ 的原始距离 $r_{kj} \\ge r_n = r_c + r_s$。移动后，根据三角不等式，新距离 $r'_{kj} = |\\mathbf{r}_k' - \\mathbf{r}_j| = |(\\mathbf{r}_k - \\mathbf{r}_j) + \\Delta\\mathbf{r}_k| \\ge ||\\mathbf{r}_k - \\mathbf{r}_j| - |\\Delta\\mathbf{r}_k|| = |r_{kj} - |\\Delta\\mathbf{r}_k||$。\n由于 $r_{kj} \\ge r_c + r_s$ 且 $|\\Delta\\mathbf{r}_k|  r_s$，我们有 $r'_{kj} > (r_c + r_s) - r_s = r_c$。\n由于 $r'_{kj} > r_c$，粒子 $j$ 与粒子 $k$ 在其新位置的相互作用能 $u(r'_{kj})$ 仍然为零。原始相互作用能 $u(r_{kj})$ 也为零，因为 $r_{kj} > r_c$。因此，不在邻居列表中的粒子对能量变化的贡献为零。\n\n对于任何在邻居列表中的粒子 $j$，原始距离 $r_{kj}  r_n$。移动后，新距离 $r'_{kj}$ 可能小于或大于 $r_c$。因此，只有这些邻居才能对 $\\Delta E$ 产生非零贡献。通过仅对粒子 $k$ 的邻居列表中的粒子求和，我们可以在多次移动中显著减少计算量，只要粒子 $k$ 的累积位移不超过 $r_s$。\n\n### 任务 3：粒子插入/删除的接受概率\n\n我们使用 Metropolis-Hastings 接受准则：$\\alpha = \\min(1, \\text{ratio})$，其中 $\\text{ratio} = \\frac{\\pi(B) g(B \\to A)}{\\pi(A) g(A \\to B)}$。\n给定活度 $z \\equiv \\exp(\\beta\\mu)$ 和 $\\Lambda=1$，巨正则权重为 $\\pi(N, \\mathbf{r}^N) \\propto z^N \\exp(-\\beta U_N)$。\n\n**粒子插入 (N → N+1):**\n- 状态 $A$: $(N, \\mathbf{r}^N)$；状态 $B$: $(N+1, \\mathbf{r}^{N+1})$。\n- 提议概率 $g(A \\to B)$: 在体积 $V$ 内均匀选择一个位置，概率密度为 $1/V$。\n- 提议概率 $g(B \\to A)$: 从 $N+1$ 个粒子中选择一个删除，概率为 $1/(N+1)$。\n$$\n\\text{ratio}_{\\text{ins}} = \\frac{z^{N+1} \\exp(-\\beta U_{N+1})}{z^N \\exp(-\\beta U_N)} \\cdot \\frac{1/(N+1)}{1/V} = z \\exp(-\\beta \\Delta E_{\\text{ins}}) \\frac{V}{N+1}\n$$\n$$\np_{\\text{ins}} = \\min\\left(1, \\frac{zV}{N+1} \\exp(-\\beta \\Delta E_{\\text{ins}})\\right) = \\min\\left(1, \\frac{V\\exp(\\beta\\mu)}{N+1} \\exp(-\\beta \\Delta E_{\\text{ins}})\\right)\n$$\n其中 $\\Delta E_{\\text{ins}} = U_{N+1} - U_N$。\n\n**粒子删除 (N → N-1):**\n- 状态 $A$: $(N, \\mathbf{r}^N)$；状态 $B$: $(N-1, \\mathbf{r}^{N-1})$。\n- 提议概率 $g(A \\to B)$: 从 $N$ 个粒子中选择一个删除，概率为 $1/N$。\n- 提议概率 $g(B \\to A)$: 将被删除的粒子重新插入其旧位置，概率密度为 $1/V$。\n$$\n\\text{ratio}_{\\text{del}} = \\frac{z^{N-1} \\exp(-\\beta U_{N-1})}{z^N \\exp(-\\beta U_N)} \\cdot \\frac{1/V}{1/N} = z^{-1} \\exp(-\\beta \\Delta E_{\\text{del}}) \\frac{N}{V}\n$$\n$$\np_{\\text{del}} = \\min\\left(1, \\frac{N}{zV} \\exp(-\\beta \\Delta E_{\\text{del}})\\right) = \\min\\left(1, \\frac{N}{V\\exp(\\beta\\mu)} \\exp(-\\beta \\Delta E_{\\text{del}})\\right)\n$$\n其中 $\\Delta E_{\\text{del}} = U_{N-1} - U_N$。\n\n### 任务 4：实施与测试", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational materials science problem by calculating energy changes\n    and acceptance probabilities for Monte Carlo moves in canonical and grand\n    canonical ensembles.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    L = 8.0\n    rc = 2.5\n    rs = 0.6\n    \n    # --- Helper Functions ---\n\n    def mic_vector(vec, box_length):\n        \"\"\"Applies the minimum image convention to a displacement vector.\"\"\"\n        return vec - box_length * np.round(vec / box_length)\n\n    # Pre-calculate the potential shift at the cutoff distance\n    rc_inv6 = rc**-6\n    rc_inv12 = rc_inv6**2\n    U_SHIFT = 4.0 * (rc_inv12 - rc_inv6)\n\n    def potential(r_sq, rc_sq):\n        \"\"\"\n        Calculates the truncated and shifted Lennard-Jones potential.\n        Takes squared distances to avoid unnecessary sqrt operations.\n        \"\"\"\n        if r_sq >= rc_sq:\n            return 0.0\n        \n        r_inv2 = 1.0 / r_sq\n        r_inv6 = r_inv2 * r_inv2 * r_inv2\n        r_inv12 = r_inv6 * r_inv6\n        \n        return 4.0 * (r_inv12 - r_inv6) - U_SHIFT\n\n    # --- Test Suite Definition ---\n    test_cases = [\n        # Test 1: Canonical displacement, general case\n        {\n            \"type\": \"displacement\",\n            \"N\": 4,\n            \"pos\": np.array([\n                [1.0, 1.0, 1.0], [3.1, 1.0, 1.0], \n                [1.0, 3.1, 1.0], [1.0, 1.0, 3.1]\n            ]),\n            \"i_move\": 0,\n            \"dr\": np.array([0.2, 0.0, 0.0])\n        },\n        # Test 2: Canonical displacement, anisotropic\n        {\n            \"type\": \"displacement\",\n            \"N\": 4,\n            \"pos\": np.array([\n                [1.0, 1.0, 1.0], [3.1, 1.0, 1.0], \n                [1.0, 3.1, 1.0], [1.0, 1.0, 3.1]\n            ]),\n            \"i_move\": 0,\n            \"dr\": np.array([-0.25, 0.1, 0.0])\n        },\n        # Test 3: Grand canonical insertion\n        {\n            \"type\": \"insertion\",\n            \"N\": 4,\n            \"pos\": np.array([\n                [1.0, 1.0, 1.0], [3.1, 1.0, 1.0], \n                [1.0, 3.1, 1.0], [1.0, 1.0, 3.1]\n            ]),\n            \"r_ins\": np.array([2.0, 2.0, 2.0]),\n            \"T\": 1.2,\n            \"mu\": -2.0\n        },\n        # Test 4: Grand canonical deletion\n        {\n            \"type\": \"deletion\",\n            \"N\": 4,\n            \"pos\": np.array([\n                [1.0, 1.0, 1.0], [3.1, 1.0, 1.0], \n                [1.0, 3.1, 1.0], [1.0, 1.0, 3.1]\n            ]),\n            \"i_del\": 1,\n            \"T\": 1.2,\n            \"mu\": -2.0\n        },\n        # Test 5: Canonical displacement, no neighbors\n        {\n            \"type\": \"displacement\",\n            \"N\": 2,\n            \"pos\": np.array([[1.0, 1.0, 1.0], [5.0, 1.0, 1.0]]),\n            \"i_move\": 0,\n            \"dr\": np.array([0.2, 0.0, 0.0])\n        },\n        # Test 6: Canonical displacement, pair at cutoff\n        {\n            \"type\": \"displacement\",\n            \"N\": 2,\n            \"pos\": np.array([[1.0, 1.0, 1.0], [3.5, 1.0, 1.0]]),\n            \"i_move\": 0,\n            \"dr\": np.array([0.0, 0.1, 0.0])\n        }\n    ]\n\n    results = []\n    rc_sq = rc**2\n    r_neighbor_sq = (rc + rs)**2\n\n    for case in test_cases:\n        move_type = case[\"type\"]\n        pos = case[\"pos\"]\n        N = case[\"N\"]\n\n        if move_type == \"displacement\":\n            i_move = case[\"i_move\"]\n            dr = case[\"dr\"]\n            \n            r_i_old = pos[i_move]\n            r_i_new = r_i_old + dr\n            \n            delta_E = 0.0\n            \n            # Per prompt, build neighbor list for particle i, then compute delta_E\n            neighbors = []\n            for j in range(N):\n                if i_move == j:\n                    continue\n                dist_vec = mic_vector(r_i_old - pos[j], L)\n                dist_sq = np.dot(dist_vec, dist_vec)\n                if dist_sq  r_neighbor_sq:\n                    neighbors.append(j)\n\n            for j in neighbors:\n                r_j = pos[j]\n                \n                dist_vec_old = mic_vector(r_i_old - r_j, L)\n                dist_sq_old = np.dot(dist_vec_old, dist_vec_old)\n\n                dist_vec_new = mic_vector(r_i_new - r_j, L)\n                dist_sq_new = np.dot(dist_vec_new, dist_vec_new)\n\n                u_old = potential(dist_sq_old, rc_sq)\n                u_new = potential(dist_sq_new, rc_sq)\n                delta_E += u_new - u_old\n\n            results.append(delta_E)\n\n        elif move_type == \"insertion\":\n            r_ins = case[\"r_ins\"]\n            T = case[\"T\"]\n            mu = case[\"mu\"]\n            V = L**3\n            beta = 1.0 / T\n\n            # Build cell-linked list for neighbor search\n            l_cell = rc + rs\n            M = int(L / l_cell)\n            inv_l_cell = 1.0 / l_cell\n            head = -np.ones((M, M, M), dtype=int)\n            llist = -np.ones(N, dtype=int)\n\n            for i in range(N):\n                c = (pos[i] * inv_l_cell).astype(int)\n                cx, cy, cz = c[0] % M, c[1] % M, c[2] % M\n                llist[i] = head[cx, cy, cz]\n                head[cx, cy, cz] = i\n\n            delta_E_ins = 0.0\n            c_ins = (r_ins * inv_l_cell).astype(int)\n            cx, cy, cz = c_ins[0], c_ins[1], c_ins[2]\n\n            # Search neighbor cells\n            for dcx in [-1, 0, 1]:\n                for dcy in [-1, 0, 1]:\n                    for dcz in [-1, 0, 1]:\n                        ncx = (cx + dcx + M) % M\n                        ncy = (cy + dcy + M) % M\n                        ncz = (cz + dcz + M) % M\n\n                        p_idx = head[ncx, ncy, ncz]\n                        while p_idx != -1:\n                            dist_vec = mic_vector(r_ins - pos[p_idx], L)\n                            dist_sq = np.dot(dist_vec, dist_vec)\n                            if dist_sq  rc_sq:\n                                delta_E_ins += potential(dist_sq, rc_sq)\n                            p_idx = llist[p_idx]\n            \n            prob_arg = (V / (N + 1.0)) * np.exp(beta * mu - beta * delta_E_ins)\n            p_ins = min(1.0, prob_arg)\n            results.append(p_ins)\n\n        elif move_type == \"deletion\":\n            i_del = case[\"i_del\"]\n            T = case[\"T\"]\n            mu = case[\"mu\"]\n            V = L**3\n            beta = 1.0 / T\n\n            energy_of_idel = 0.0\n            r_i_del = pos[i_del]\n            \n            for j in range(N):\n                if i_del == j:\n                    continue\n                dist_vec = mic_vector(r_i_del - pos[j], L)\n                dist_sq = np.dot(dist_vec, dist_vec)\n                energy_of_idel += potential(dist_sq, rc_sq)\n\n            delta_E_del = -energy_of_idel\n            \n            prob_arg = (N / V) * np.exp(-beta * mu - beta * delta_E_del)\n            p_del = min(1.0, prob_arg)\n            results.append(p_del)\n\n    # Final printing in the required format\n    print(f\"[{','.join(f'{x:.8f}' for x in results)}]\")\n\nsolve()\n```", "id": "3467668"}, {"introduction": "巨正则蒙特卡洛（GCMC）模拟是一种强大的工具，尤其适用于研究开放系统，但这要求我们正确处理改变粒子数的移动类型。本练习要求您从第一性原理出发，推导粒子插入和删除过程中的Metropolis-Hastings接受概率。此推导依赖于细致平衡条件在巨正则分布下的具体应用。掌握这一推导对于正确实现或理解GCMC代码至关重要，它将迫使您仔细考虑提议概率以及相空间维度的变化，从而加深对马尔可夫链蒙特卡洛方法的理解 [@problem_id:3467672]。", "problem": "考虑一个由无差别点状粒子组成的均匀三维流体，该流体被限制在固定体积 $V$ 内，处于绝对温度 $T$ 和化学势 $\\mu$ 下。该系统在巨正则系综下使用马尔可夫链蒙特卡罗（MCMC; Markov chain Monte Carlo）方法进行模拟，其中粒子数 $N$ 可以涨落。具有 $N$ 个粒子且坐标为 $\\mathbf{r}^{N} = (\\mathbf{r}_{1}, \\dots, \\mathbf{r}_{N})$ 的微观状态的位形能为 $U_{N}(\\mathbf{r}^{N})$，该能量是有限的，并且平滑地依赖于粒子间距。在由带标记的粒子坐标和粒子数构成的增广状态空间上，目标概率密度与巨正则权重成正比\n$$\n\\pi(N, \\mathbf{r}^{N}) \\propto z^{N} \\exp(-\\beta U_{N}(\\mathbf{r}^{N})),\n$$\n其中 $\\beta = 1/(k_{B} T)$，$k_{B}$ 为玻尔兹曼常数，$z$ 是与化学势 $\\mu$ 和热波长相关的活度，其选择使得 $\\pi$ 在带标记坐标的状态空间上被正确归一化。MCMC 转移核采用两种以相等频率选择的互补移动类型：粒子插入和粒子删除。对于从状态 $(N, \\mathbf{r}^{N})$ 到 $(N+1, \\mathbf{r}^{N+1})$ 的粒子插入，在体积 $V$ 内均匀地提议一个试探位置 $\\mathbf{r}_{\\star}$。对于从状态 $(N, \\mathbf{r}^{N})$ 到 $(N-1, \\mathbf{r}^{N-1})$ 的粒子删除，从 $N$ 个现有粒子中均匀随机地选择一个移除。令插入的 Metropolis 接受概率表示为 $\\alpha_{\\text{ins}}$，删除的表示为 $\\alpha_{\\text{del}}$，对于所考虑的正向移动，能量变化定义为 $\\Delta E = U_{\\text{new}} - U_{\\text{old}}$。仅使用巨正则系综的原理、上述 $\\pi(N, \\mathbf{r}^{N})$ 的定义以及 MCMC 中转移概率的细致平衡条件，推导出 $\\alpha_{\\text{ins}}$ 和 $\\alpha_{\\text{del}}$ 关于 $z$、$V$、$N$、$\\beta$ 和 $\\Delta E$ 的闭式表达式。将最终答案表示为解析表达式，且不要引入除已说明参数之外的任何新参数。不需要进行数值计算，也无需四舍五入。", "solution": "所述问题在科学上是合理的、提法恰当的，并包含了进行严格推导所需的所有信息。它描述了一个标准的巨正则蒙特卡罗（GCMC）模拟过程，因此是计算统计力学中的一个有效问题。\n\n在马尔可夫链蒙特卡罗（MCMC）模拟中，支配接受概率的核心原理是细致平衡条件。该条件确保马尔可夫链在平衡时，根据所需的目标概率分布（在本例中为巨正则系综分布 $\\pi(N, \\mathbf{r}^{N})$）对状态进行抽样。对于任意两个状态，比如状态 $A$ 和状态 $B$，细致平衡条件表明从 $A$ 到 $B$ 的转移速率必须等于从 $B$ 到 $A$ 的转移速率：\n$$\n\\pi(A) P(A \\to B) = \\pi(B) P(B \\to A)\n$$\n其中 $\\pi(X)$ 是状态 $X$ 的平衡概率（或概率密度），$P(X \\to Y)$ 是从状态 $X$ 移动到状态 $Y$ 的转移概率。转移概率是提议概率 $g(X \\to Y)$ 和接受概率 $\\alpha(X \\to Y)$ 的乘积。因此，该条件变为：\n$$\n\\pi(A) g(A \\to B) \\alpha(A \\to B) = \\pi(B) g(B \\to A) \\alpha(B \\to A)\n$$\nMetropolis-Hastings 算法为接受概率提供了一个有效的选择：\n$$\n\\alpha(A \\to B) = \\min \\left(1, \\frac{\\pi(B) g(B \\to A)}{\\pi(A) g(A \\to B)}\\right)\n$$\n我们将应用这一形式体系来推导粒子插入（$\\alpha_{\\text{ins}}$）和粒子删除（$\\alpha_{\\text{del}}$）的接受概率。\n\n首先，我们推导粒子插入的接受概率 $\\alpha_{\\text{ins}}$。\n正向移动是一次插入尝试。初始状态 $A$ 有 $N$ 个粒子，位形为 $\\mathbf{r}^{N}$。其位形能为 $U_{\\text{old}} = U_{N}(\\mathbf{r}^{N})$。在一个从体积 $V$ 中均匀选择的随机位置 $\\mathbf{r}_{\\star}$ 处提议一个新粒子。新状态 $B$ 有 $N+1$ 个粒子，位形为 $\\mathbf{r}^{N+1} = (\\mathbf{r}^{N}, \\mathbf{r}_{\\star})$，能量为 $U_{\\text{new}} = U_{N+1}(\\mathbf{r}^{N+1})$。能量变化为 $\\Delta E = U_{\\text{new}} - U_{\\text{old}}$。\n\n平衡概率密度被给出为与 $\\pi(N, \\mathbf{r}^{N}) \\propto z^{N} \\exp(-\\beta U_{N}(\\mathbf{r}^{N}))$ 成正比。让我们为 Metropolis-Hastings 公式建立比率，并密切注意提议概率和状态空间的维度。带标记粒子的状态空间是一个增广空间，$\\cup_{N=0}^{\\infty} V^{N}$，因此从 $N$ 个粒子到 $N+1$ 个粒子的转变是在不同维度的空间之间移动。\n\n让我们考虑在状态 $A$ 附近的无穷小体积 $d\\mathbf{r}^{N}$ 和状态 $B$ 附近的无穷小体积 $d\\mathbf{r}^{N+1}$ 之间的转移。\n从状态 $A$ 提议新状态 $B$ 的概率涉及选择一个粒子位置。由于新位置 $\\mathbf{r}_{\\star}$ 是从体积 $V$ 中均匀选择的，提议概率*密度*为 $g(A \\to B) = 1/V$。提议移动到特定的无穷小体积 $d\\mathbf{r}_{\\star}$ 内的概率是 $(1/V)d\\mathbf{r}_{\\star}$。\n逆向移动是从状态 $B$ 中删除新添加的粒子以返回状态 $A$。状态 $B$ 有 $N+1$ 个粒子。均匀随机地选择一个粒子进行删除。选择位于 $\\mathbf{r}_{\\star}$ 的特定粒子的概率是 $g(B \\to A) = 1/(N+1)$。\n\n对于相应无穷小相空间体积之间的转移，细致平衡必须成立：\n$$\n[\\pi(A) d\\mathbf{r}^{N}] \\cdot [g(A \\to B) d\\mathbf{r}_{\\star}] \\cdot \\alpha_{\\text{ins}} = [\\pi(B) d\\mathbf{r}^{N+1}] \\cdot [g(B \\to A)] \\cdot \\alpha_{\\text{del, reverse}}\n$$\n代入问题中对 $\\pi$ 的定义以及我们找到的提议概率：\n$$\n[C z^{N} \\exp(-\\beta U_{N}) d\\mathbf{r}^{N}] \\cdot [\\frac{1}{V} d\\mathbf{r}_{\\star}] \\cdot \\alpha_{\\text{ins}} = [C z^{N+1} \\exp(-\\beta U_{N+1}) d\\mathbf{r}^{N+1}] \\cdot [\\frac{1}{N+1}] \\cdot \\alpha_{\\text{del, reverse}}\n$$\n其中 $C$ 是一个归一化常数。由于 $d\\mathbf{r}^{N+1} = d\\mathbf{r}^{N}d\\mathbf{r}_{\\star}$，微分体积元和常数 $C$ 在等式两边被消去，得到：\n$$\nz^{N} \\exp(-\\beta U_{N}) \\frac{1}{V} \\alpha_{\\text{ins}} = z^{N+1} \\exp(-\\beta U_{N+1}) \\frac{1}{N+1} \\alpha_{\\text{del, reverse}}\n$$\nMetropolis-Hastings 接受概率 $\\alpha_{\\text{ins}}$ 所需的比率为：\n$$\n\\text{Ratio}_{\\text{ins}} = \\frac{\\pi(B) g(B \\to A)}{\\pi(A) g(A \\to B)} = \\frac{z^{N+1} \\exp(-\\beta U_{N+1})}{z^{N} \\exp(-\\beta U_{N})} \\cdot \\frac{1/(N+1)}{1/V}\n$$\n$$\n\\text{Ratio}_{\\text{ins}} = z \\exp(-\\beta(U_{N+1} - U_{N})) \\frac{V}{N+1} = \\frac{zV}{N+1} \\exp(-\\beta \\Delta E)\n$$\n因此，插入的接受概率为：\n$$\n\\alpha_{\\text{ins}} = \\min\\left(1, \\frac{zV}{N+1} \\exp(-\\beta \\Delta E)\\right)\n$$\n这里，$N$ 是插入前的粒子数，$\\Delta E = U_{N+1} - U_N$。\n\n接下来，我们推导粒子删除的接受概率 $\\alpha_{\\text{del}}$。\n正向移动是一次删除尝试。初始状态 $A$ 有 $N$ 个粒子，位形为 $\\mathbf{r}^{N}$，能量为 $U_{\\text{old}} = U_{N}(\\mathbf{r}^{N})$。从 $N$ 个粒子中均匀随机地选择一个并移除。新状态 $B$ 有 $N-1$ 个粒子，位形为 $\\mathbf{r}^{N-1}$，能量为 $U_{\\text{new}} = U_{N-1}(\\mathbf{r}^{N-1})$。能量变化为 $\\Delta E = U_{\\text{new}} - U_{\\text{old}}$。\n\n对于这个正向移动（删除），提议概率 $g(A \\to B)$ 是从 $N$ 个粒子中选择一个特定粒子的概率，即 $1/N$。\n逆向移动是从状态 $B$（有 $N-1$ 个粒子）到状态 $A$（有 $N$ 个粒子）的插入。这涉及到将被移除的粒子重新插入其原始位置。这次插入的提议概率密度为 $g(B \\to A) = 1/V$。\n\n遵循同样的细致平衡步骤：\n$$\n\\text{Ratio}_{\\text{del}} = \\frac{\\pi(B) g(B \\to A)}{\\pi(A) g(A \\to B)} = \\frac{z^{N-1} \\exp(-\\beta U_{N-1})}{z^{N} \\exp(-\\beta U_{N})} \\cdot \\frac{1/V}{1/N}\n$$\n$$\n\\text{Ratio}_{\\text{del}} = z^{-1} \\exp(-\\beta(U_{N-1} - U_{N})) \\frac{N}{V} = \\frac{N}{zV} \\exp(-\\beta \\Delta E)\n$$\n因此，删除的接受概率为：\n$$\n\\alpha_{\\text{del}} = \\min\\left(1, \\frac{N}{zV} \\exp(-\\beta \\Delta E)\\right)\n$$\n这里，$N$ 是删除前的粒子数，$\\Delta E = U_{N-1} - U_N$。\n\n这两个表达式提供了所要求的完整答案。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\min\\left(1, \\frac{zV}{N+1} \\exp(-\\beta \\Delta E)\\right)  \\min\\left(1, \\frac{N}{zV} \\exp(-\\beta \\Delta E)\\right) \\end{pmatrix}}\n$$", "id": "3467672"}]}