{"hands_on_practices": [{"introduction": "从第一性原理计算中获得的最基本信息是系统的总能量。然而，总能量的绝对值本身意义不大，更有价值的是通过比较不同构型或组分的总能量来预测材料的稳定性。本练习将指导您计算两种关键的热力学量——内聚能和形成能，它们分别量化了将孤立原子结合成晶体以及由元素库形成化合物时的能量变化。通过这个练习，您将掌握利用总能量数据来评估和预测材料热力学稳定性的核心技能。[@problem_id:3498173]", "problem": "给定一组通过密度泛函理论 (DFT) 计算得到的零温零压下的基态总能量和孤立原子参考值。根据零温零压下的基本热力学定义，每个系统的基态总能量等于其内能，而物种 $i$ 的化学势是在体积和熵固定的情况下，内能相对于粒子数 $N_i$ 的变化。单质固体的内聚能是孤立原子结合成晶体时获得的能量。多组分晶体的形成能是该晶体与其组分原子（这些原子储存在由化学势表征的外部源中）之间的能量差。你的任务是实现一个程序，利用这些原理为下面的参数集计算内聚能和形成能。\n\n仅使用以下基本依据：\n- 在零温零压下，基态总能量等于内能和焓，因此所有能量都可以直接取自所提供的基态总能量值。\n- 物种 $i$ 的化学势，记作 $\\mu_i$，表示从其源中向系统添加一个物种 $i$ 的原子所引起的能量变化。\n- 对于包含整数个分子式单位的晶胞，每个分子式单位的基态总能量等于晶胞能量除以分子式单位数。\n- 对于单质体系，每个原子的内聚能是孤立原子与晶体状态下原子之间的能量差。\n- 对于化合物 $A_x B_y C_z$，每个分子式单位的形成能是化合物每个分子式单位的基态能量与从具有特定化学势的外部源中取出的 $x$ 个 $A$ 原子、$y$ 个 $B$ 原子和 $z$ 个 $C$ 原子的能量之差。\n- 化学势可以写成 $\\mu_i = \\mu_i^{0} + \\Delta \\mu_i$，其中当参考单质基态 $\\mu_i^{0}$ 时，$\\Delta \\mu_i \\le 0$。当一个化合物在零温零压下与源处于平衡状态时，该化合物每个分子式单位的基态能量等于对源化学势的适当求和。\n\n所有答案必须以电子伏特表示，内聚能以 $\\mathrm{eV}$/原子为单位报告，每种形成能以 $\\mathrm{eV}$/分子式单位为单位报告。将每个报告的浮点数四舍五入到三位小数。\n\n实现一个程序，为以下测试套件计算所要求的量。每个测试产生一个浮点数。\n\n测试套件：\n- 测试 $1$ (每个原子的单质内聚能):\n  - 一个立方单质晶体的每个模拟晶胞包含 $N = 8$ 个原子，其基态总能量为 $E_{\\mathrm{cell}} = -42.400\\,\\mathrm{eV}$。孤立原子参考能量为 $E_{\\mathrm{atom}}^{\\mathrm{iso}} = -0.900\\,\\mathrm{eV}$。计算每个原子的内聚能，单位为 $\\mathrm{eV}$/原子。\n- 测试 $2$ (在单质源条件下，每个分子式单位的二元化合物形成能):\n  - 一个二元化合物 $A B_2$ 的模拟晶胞包含 $n_{\\mathrm{fu}} = 2$ 个分子式单位。晶胞的基态总能量为 $E_{\\mathrm{cell}} = -36.000\\,\\mathrm{eV}$。单质源的化学势为 $\\mu_A^{0} = -3.000\\,\\mathrm{eV}$ 和 $\\mu_B^{0} = -4.000\\,\\mathrm{eV}$。当源处于单质极限时，即 $\\mu_A = \\mu_A^{0}$ 和 $\\mu_B = \\mu_B^{0}$ 时，计算每个分子式单位的形成能，单位为 $\\mathrm{eV}$/分子式单位。\n- 测试 $3$ (在指定源偏移和平衡约束下，每个分子式单位的二元化合物形成能):\n  - 考虑与测试 $2$ 中相同的 $A B_2$ 化合物和晶胞。设源的偏移为 $\\Delta \\mu_B = -1.000\\,\\mathrm{eV}$ 和一个未知的 $\\Delta \\mu_A$，其中 $\\mu_B = \\mu_B^{0} + \\Delta \\mu_B$ 且 $\\mu_A = \\mu_A^{0} + \\Delta \\mu_A$。施加热力学平衡条件，即化合物和源在零压下具有相同的每个分子式单位的基态能量，并用此条件确定未知的 $\\Delta \\mu_A$。然后计算在这些源条件下每个分子式单位的形成能，单位为 $\\mathrm{eV}$/分子式单位。\n- 测试 $4$ (在非单质源条件下，每个分子式单位的三元化合物形成能):\n  - 一个三元化合物 $A_2 B C$ 的模拟晶胞中含有 $n_{\\mathrm{fu}} = 1$ 个分子式单位，其基态总能量为 $E_{\\mathrm{cell}} = -22.000\\,\\mathrm{eV}$。单质参考化学势为 $\\mu_A^{0} = -3.000\\,\\mathrm{eV}$、$\\mu_B^{0} = -4.000\\,\\mathrm{eV}$ 和 $\\mu_C^{0} = -5.000\\,\\mathrm{eV}$。源由偏移量 $\\Delta \\mu_A = -1.000\\,\\mathrm{eV}$、$\\Delta \\mu_B = -0.500\\,\\mathrm{eV}$ 和 $\\Delta \\mu_C = 0.000\\,\\mathrm{eV}$ 指定，因此 $\\mu_A = \\mu_A^{0} + \\Delta \\mu_A$、$\\mu_B = \\mu_B^{0} + \\Delta \\mu_B$ 和 $\\mu_C = \\mu_C^{0} + \\Delta \\mu_C$。计算每个分子式单位的形成能，单位为 $\\mathrm{eV}$/分子式单位。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4]$），其中 $r_k$ 是测试 $k$ 的浮点数结果，四舍五入到三位小数。要求的输出类型仅为浮点数，单位如上所述。", "solution": "问题陈述经核实具有科学依据、提法恰当且客观。它基于热力学和固态物理学在计算材料科学中的应用基本原理，提供了一套清晰的定义和数据。所有数据都是自洽的，足以让每个测试用例推导出唯一的解。\n\n解决方案需要应用零温零压（$T=0\\,\\mathrm{K}$, $P=0\\,\\mathrm{Pa}$）下内聚能和形成能的标准定义，此时基态总能量等同于内能和焓。\n\n单质固体的内聚能 $E_{\\text{coh}}$ 衡量了由孤立原子形成晶体时获得的能量。以单个原子为基准，其定义为：\n$$E_{\\text{coh}} = E_{\\text{atom}}^{\\text{iso}} - E_{\\text{atom}}^{\\text{crystal}}$$\n其中 $E_{\\text{atom}}^{\\text{iso}}$ 是孤立原子的基态能量，$E_{\\text{atom}}^{\\text{crystal}}$ 是晶体中每个原子的基态能量。\n\n对于分子式单位为 $A_{n_A}B_{n_B}C_{n_C}\\dots$ 的化合物，其形成能 $E_{\\text{form}}$ 量化了它相对于一组由其构成元素组成的外部源的稳定性。以每个分子式单位为基准，其定义为：\n$$E_{\\text{form}} = E_{\\text{f.u.}}^{\\text{cmpd}} - \\sum_i n_i \\mu_i$$\n其中 $E_{\\text{f.u.}}^{\\text{cmpd}}$ 是化合物每个分子式单位的基态能量，$n_i$ 是分子式单位中物种 $i$ 的原子数，$\\mu_i$ 是物种 $i$ 在其各自源中的化学势。化学势 $\\mu_i$ 由 $\\mu_i = \\mu_i^0 + \\Delta\\mu_i$ 给出，其中 $\\mu_i^0$ 是物种 $i$ 的单质基态下每个原子的能量，而 $\\Delta\\mu_i \\leq 0$ 是化学势偏移。\n\n现在我们将这些原理应用于每个测试用例。\n\n测试 $1$：每个原子的单质内聚能。\n问题提供了一个模拟晶胞的基态总能量 $E_{\\mathrm{cell}} = -42.400\\,\\mathrm{eV}$，其中包含 $N = 8$ 个某种元素的原子。晶体中每个原子的能量为：\n$$E_{\\text{atom}}^{\\text{crystal}} = \\frac{E_{\\mathrm{cell}}}{N} = \\frac{-42.400\\,\\mathrm{eV}}{8} = -5.300\\,\\mathrm{eV}$$\n孤立原子参考能量为 $E_{\\mathrm{atom}}^{\\mathrm{iso}} = -0.900\\,\\mathrm{eV}$。因此，每个原子的内聚能为：\n$$E_{\\text{coh}} = E_{\\mathrm{atom}}^{\\mathrm{iso}} - E_{\\text{atom}}^{\\text{crystal}} = (-0.900\\,\\mathrm{eV}) - (-5.300\\,\\mathrm{eV}) = 4.400\\,\\mathrm{eV}$$\n\n测试 $2$：在单质源条件下，每个分子式单位的二元化合物形成能。\n问题描述了一个二元化合物 $AB_2$，其模拟晶胞含有 $n_{\\mathrm{fu}} = 2$ 个分子式单位，总能量为 $E_{\\mathrm{cell}} = -36.000\\,\\mathrm{eV}$。该化合物每个分子式单位的能量为：\n$$E_{\\text{f.u.}}^{AB_2} = \\frac{E_{\\mathrm{cell}}}{n_{\\mathrm{fu}}} = \\frac{-36.000\\,\\mathrm{eV}}{2} = -18.000\\,\\mathrm{eV}$$\n源处于单质极限，意味着 $\\Delta\\mu_A=0$ 和 $\\Delta\\mu_B=0$。因此化学势为 $\\mu_A = \\mu_A^0 = -3.000\\,\\mathrm{eV}$ 和 $\\mu_B = \\mu_B^0 = -4.000\\,\\mathrm{eV}$。对于化学计量比为 $A_1 B_2$ 的情况，每个分子式单位的形成能计算如下：\n$$E_{\\text{form}} = E_{\\text{f.u.}}^{AB_2} - (1 \\cdot \\mu_A + 2 \\cdot \\mu_B)$$\n$$E_{\\text{form}} = -18.000\\,\\mathrm{eV} - (1 \\cdot (-3.000\\,\\mathrm{eV}) + 2 \\cdot (-4.000\\,\\mathrm{eV}))$$\n$$E_{\\text{form}} = -18.000\\,\\mathrm{eV} - (-3.000\\,\\mathrm{eV} - 8.000\\,\\mathrm{eV}) = -18.000\\,\\mathrm{eV} - (-11.000\\,\\mathrm{eV}) = -7.000\\,\\mathrm{eV}$$\n\n测试 $3$：在平衡约束下，每个分子式单位的二元化合物形成能。\n此测试使用与测试 $2$ 相同的化合物 $AB_2$，所以 $E_{\\text{f.u.}}^{AB_2} = -18.000\\,\\mathrm{eV}$。问题施加了热力学平衡条件，该条件指出化合物每个分子式单位的基态能量等于其在源中各组分化学势的总和：\n$$E_{\\text{f.u.}}^{AB_2} = 1 \\cdot \\mu_A + 2 \\cdot \\mu_B$$\n根据定义，形成能是相对于这些相同的源化学势计算的：\n$$E_{\\text{form}} = E_{\\text{f.u.}}^{AB_2} - (1 \\cdot \\mu_A + 2 \\cdot \\mu_B)$$\n将平衡条件代入形成能的定义中，得到：\n$$E_{\\text{form}} = (1 \\cdot \\mu_A + 2 \\cdot \\mu_B) - (1 \\cdot \\mu_A + 2 \\cdot \\mu_B) = 0.000\\,\\mathrm{eV}$$\n这个结果是定义的直接推论。根据定义，一个与一组源处于平衡状态的化合物，其相对于这些源的形成能为零。化学势偏移的具体值（$\\Delta \\mu_B = -1.000\\,\\mathrm{eV}$ 以及由此得出的 $\\Delta \\mu_A = -5.000\\,\\mathrm{eV}$）被用来确定源的条件，但在这些平衡条件下，形成能根据定义恒为零。\n\n测试 $4$：每个分子式单位的三元化合物形成能。\n问题考虑一个三元化合物 $A_2 B C$，其晶胞中含有 $n_{\\mathrm{fu}} = 1$ 个分子式单位，总能量为 $E_{\\mathrm{cell}} = -22.000\\,\\mathrm{eV}$。因此，每个分子式单位的能量为 $E_{\\text{f.u.}}^{A_2BC} = E_{\\mathrm{cell}} / n_{\\mathrm{fu}} = -22.000\\,\\mathrm{eV}$。源的化学势由其相对于单质参考的偏移量指定：\n$$\\mu_A = \\mu_A^0 + \\Delta\\mu_A = -3.000\\,\\mathrm{eV} + (-1.000\\,\\mathrm{eV}) = -4.000\\,\\mathrm{eV}$$\n$$\\mu_B = \\mu_B^0 + \\Delta\\mu_B = -4.000\\,\\mathrm{eV} + (-0.500\\,\\mathrm{eV}) = -4.500\\,\\mathrm{eV}$$\n$$\\mu_C = \\mu_C^0 + \\Delta\\mu_C = -5.000\\,\\mathrm{eV} + 0.000\\,\\mathrm{eV} = -5.000\\,\\mathrm{eV}$$\n对于化学计量比为 $A_2 B_1 C_1$ 的情况，形成能为：\n$$E_{\\text{form}} = E_{\\text{f.u.}}^{A_2BC} - (2 \\cdot \\mu_A + 1 \\cdot \\mu_B + 1 \\cdot \\mu_C)$$\n$$E_{\\text{form}} = -22.000\\,\\mathrm{eV} - (2 \\cdot (-4.000\\,\\mathrm{eV}) + 1 \\cdot (-4.500\\,\\mathrm{eV}) + 1 \\cdot (-5.000\\,\\mathrm{eV}))$$\n$$E_{\\text{form}} = -22.000\\,\\mathrm{eV} - (-8.000\\,\\mathrm{eV} - 4.500\\,\\mathrm{eV} - 5.000\\,\\mathrm{eV})$$\n$$E_{\\text{form}} = -22.000\\,\\mathrm{eV} - (-17.500\\,\\mathrm{eV}) = -4.500\\,\\mathrm{eV}$$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are necessary.\n\ndef solve():\n    \"\"\"\n    Computes cohesive and formation energies based on provided DFT total energies and chemical potentials.\n    \"\"\"\n\n    # --- Test 1: Elemental cohesive energy per atom ---\n    # Given data for an elemental crystal.\n    E_cell_1 = -42.400  # eV\n    N_1 = 8             # atoms\n    E_atom_iso_1 = -0.900 # eV\n\n    # Cohesive energy is the energy of the isolated atom minus the energy per atom in the crystal.\n    E_atom_crystal_1 = E_cell_1 / N_1\n    r1 = E_atom_iso_1 - E_atom_crystal_1\n\n    # --- Test 2: Binary formation energy at elemental reservoirs ---\n    # Given data for a binary compound AB2.\n    E_cell_2 = -36.000  # eV\n    n_fu_2 = 2          # formula units\n    mu_A0_2 = -3.000    # eV\n    mu_B0_2 = -4.000    # eV\n\n    # Energy per formula unit of the compound.\n    E_fu_2 = E_cell_2 / n_fu_2\n    # Reservoirs are at the elemental limit.\n    mu_A_2 = mu_A0_2\n    mu_B_2 = mu_B0_2\n    # Stoichiometry of AB2 is x=1, y=2.\n    x_2, y_2 = 1, 2\n    # Formation energy is the compound's energy minus the weighted sum of reservoir chemical potentials.\n    r2 = E_fu_2 - (x_2 * mu_A_2 + y_2 * mu_B_2)\n\n    # --- Test 3: Binary formation energy under equilibrium ---\n    # Same compound as Test 2. The equilibrium condition dictates that the compound's\n    # energy per formula unit equals the summed chemical potentials of the components.\n    # E_fu = x*mu_A + y*mu_B\n    # The formation energy is defined as E_form = E_fu - (x*mu_A + y*mu_B).\n    # Under equilibrium, these two quantities are equal, so their difference is zero.\n    r3 = 0.0\n\n    # --- Test 4: Ternary formation energy with non-elemental reservoirs ---\n    # Given data for a ternary compound A2BC.\n    E_cell_4 = -22.000  # eV\n    n_fu_4 = 1          # formula unit\n    mu_A0_4 = -3.000    # eV\n    mu_B0_4 = -4.000    # eV\n    mu_C0_4 = -5.000    # eV\n    delta_mu_A_4 = -1.000 # eV\n    delta_mu_B_4 = -0.500 # eV\n    delta_mu_C_4 = 0.000  # eV\n\n    # Energy per formula unit of the compound.\n    E_fu_4 = E_cell_4 / n_fu_4\n    # Calculate absolute chemical potentials from the given shifts.\n    mu_A_4 = mu_A0_4 + delta_mu_A_4\n    mu_B_4 = mu_B0_4 + delta_mu_B_4\n    mu_C_4 = mu_C0_4 + delta_mu_C_4\n    # Stoichiometry of A2BC is x=2, y=1, z=1.\n    x_4, y_4, z_4 = 2, 1, 1\n    # Calculate formation energy.\n    r4 = E_fu_4 - (x_4 * mu_A_4 + y_4 * mu_B_4 + z_4 * mu_C_4)\n\n    # Collect all results.\n    results = [r1, r2, r3, r4]\n\n    # Format the final output string as a comma-separated list of floats\n    # rounded to three decimal places, enclosed in square brackets.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nsolve()\n```", "id": "3498173"}, {"introduction": "材料的许多重要物理和化学性质，如催化活性和电子特性，都由其表面决定。因此，准确计算表面能对于理解和设计功能材料至关重要。本练习将引导您使用周期性平板模型（slab model）这一标准方法来计算表面能，并解决在模拟中遇到的一个关键技术难题：由极性表面产生的虚假静电相互作用。您将亲手实现偶极校正，并通过对不同厚度平板的计算结果进行拟合与外推，最终得到收敛的、具有物理意义的表面能。[@problem_id:3498188]", "problem": "使用 Kohn-Sham 密度泛函理论计算的基态总能来模拟晶体表面的周期性平板模型。该平板包含 $N$ 个原子层，并沿表面法线方向由厚度为 $L_z$ 的真空层隔开。当置于三维周期性边界条件中时，具有非零面外偶极矩 $p_z$ 的平板会与其周期性镜像之间产生赝静电相互作用。这些相互作用会改变平板的总能，必须进行修正才能恢复其内禀的表面能。从创造两个表面所需的过剩能的热力学定义以及周期性重复偶极子片层的经典静电学出发，推导一个物理上自洽的、以平板总能、每原子层的体相参考能量、表面积和静电偶极修正表示的单位面积表面自由能表达式，并解释当 $N \\to \\infty$ 时的渐近厚度依赖性。然后，实现一个数值程序，该程序 (i) 对每个平板总能应用适当的偶极修正，(ii) 对每个平板厚度评估单位面积的表面能，以及 (iii) 通过将表面能的厚度依赖性拟合到一个由物理有限尺寸效应驱动的有理渐近形式，来提取半无限厚度极限。\n\n您的程序必须：\n- 在原子单位和国际单位制转换中使用以下常量：玻尔半径 $a_0 = 5.29177210903\\times 10^{-11}\\ \\text{m}$ 和哈特里能量 $E_{\\text{H}} = 4.3597447222071\\times 10^{-18}\\ \\text{J}$。\n- 所有平板总能、体相参考能量和偶极修正均以哈特里 (Hartree) 为单位处理。在最后使用 $E_{\\text{H}}$ 和 $a_0$ 将单位面积的能量转换为焦耳/平方米。\n- 假设对于沿表面法线方向具有净偶极子 $p_z$ 的重复平板，其赝静电相互作用能在原子单位下与真空长度 $L_z$ 和表面积 $A$ 成反比，这与周期性偶极子阵列的经典静电学一致。您必须在推导中明确地包含此修正，并证明其函数形式的合理性。\n\n数据生成和评估协议：\n- 对每个测试用例，通过组合与 $N$ 成正比的体相项、与表面积成正比的恒定双表面过剩项、随 $N$ 衰减的有限厚度相互作用项、偶极相互作用项，以及在一个边缘情况下，一个随 $L_z^2$ 衰减的残余项（代表主导偶极修正未捕捉到的高阶多极相互作用），以哈特里为单位构建合成的平板总能。所有量均在下面指定。计算出合成的测量平板能量后，应用偶极修正，然后评估修正后的表面能。\n- 对每个测试用例，将修正后表面能的厚度依赖性拟合到模型 $y = a + b x$（其中 $x = 1/N$），$a$ 代表单位面积的半无限厚度表面能。以 $\\text{J}/\\text{m}^2$ 为单位报告 $a$。\n- 通过计算在固定 $N$ 下，修正后的表面能在所有指定的 $L_z$ 值上的分布范围来评估真空收敛性；如果所有 $N$ 的最大分布范围不超过 $10^{-2}\\ \\text{J}/\\text{m}^2$ 的容差，则声明为收敛。\n\n测试套件：\n- 测试用例 1（理想情况）：\n    - 表面积 $A = 75.0$（单位 $a_0^2$）。\n    - 每原子层体相能量 $E_{\\text{bulk}} = -5.0$（单位 Hartree）。\n    - 偶极矩 $p_z = 1.0$（单位 $e\\cdot a_0$）。\n    - 平板厚度 $N \\in \\{4,6,8,10,12\\}$。\n    - 真空长度 $L_z \\in \\{60.0,80.0,100.0\\}$（单位 $a_0$）。\n    - 用于合成数据生成的真实半无限表面能参数 $\\gamma_{\\infty} = 1.2$（单位 $\\text{J}/\\text{m}^2$）。\n    - 有限厚度系数 $b = 0.3$（单位 $\\text{J}/\\text{m}^2$）。\n    - 残余高阶相互作用系数 $c_{\\text{res}} = 0.0$（单位 Hartree$\\cdot a_0^2$）。\n- 测试用例 2（更强偶极子，修正后仍收敛）：\n    - 表面积 $A = 120.0$（单位 $a_0^2$）。\n    - 每原子层体相能量 $E_{\\text{bulk}} = -8.3$（单位 Hartree）。\n    - 偶极矩 $p_z = 3.0$（单位 $e\\cdot a_0$）。\n    - 平板厚度 $N \\in \\{5,7,9,11,13\\}$。\n    - 真空长度 $L_z \\in \\{70.0,100.0,140.0\\}$（单位 $a_0$）。\n    - 用于合成数据生成的真实半无限表面能参数 $\\gamma_{\\infty} = 2.0$（单位 $\\text{J}/\\text{m}^2$）。\n    - 有限厚度系数 $b = 0.25$（单位 $\\text{J}/\\text{m}^2$）。\n    - 残余高阶相互作用系数 $c_{\\text{res}} = 0.0$（单位 Hartree$\\cdot a_0^2$）。\n- 测试用例 3（真空不足且存在残余高阶相互作用的边缘情况）：\n    - 表面积 $A = 60.0$（单位 $a_0^2$）。\n    - 每原子层体相能量 $E_{\\text{bulk}} = -3.5$（单位 Hartree）。\n    - 偶极矩 $p_z = 3.0$（单位 $e\\cdot a_0$）。\n    - 平板厚度 $N \\in \\{3,4,5,6\\}$。\n    - 真空长度 $L_z \\in \\{30.0,40.0,50.0\\}$（单位 $a_0$）。\n    - 用于合成数据生成的真实半无限表面能参数 $\\gamma_{\\infty} = 0.8$（单位 $\\text{J}/\\text{m}^2$）。\n    - 有限厚度系数 $b = 0.5$（单位 $\\text{J}/\\text{m}^2$）。\n    - 残余高阶相互作用系数 $c_{\\text{res}} = 6.0$（单位 Hartree$\\cdot a_0^2$）。\n\n每个 $(N,L_z)$ 的合成测量平板能量应按以下方式以哈特里为单位构建：\n- 使用从 $\\text{J}/\\text{m}^2$ 到哈特里的转换（通过 $E_{\\text{H}}$ 和 $a_0$），从指定的 $\\gamma_{\\infty}$ 计算出以哈特里为单位的双表面过剩能。\n- 添加一个与表面积成正比且按 $1/N$ 衰减的有限厚度相互作用项。\n- 在原子单位中，添加一个与 $A L_z$ 成反比的偶极相互作用项。\n- 仅对边缘情况，添加一个以哈特里为单位、与 $1/L_z^2$ 成正比的残余项。\n- 将所有贡献与体相项 $N E_{\\text{bulk}}$ 相加。\n\n您的程序必须实现上述完整流程，计算修正后的表面能，对每个测试用例使用该用例中最大的 $L_z$ 进行拟合，并输出半无限厚度表面能的估计值和拟合的均方根误差（单位为 $\\text{J}/\\text{m}^2$），同时附上一个指示是否满足真空收敛标准的布尔值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[\\gamma_1,\\text{conv}_1,\\text{rmse}_1,\\gamma_2,\\text{conv}_2,\\text{rmse}_2,\\gamma_3,\\text{conv}_3,\\text{rmse}_3]$，其中每个 $\\gamma_i$ 和 $\\text{rmse}_i$ 均以 $\\text{J}/\\text{m}^2$ 为单位，并四舍五入到 $6$ 位小数，而每个 $\\text{conv}_i$ 是一个布尔值。", "solution": "该问题要求从总能计算中推导出一个物理上自洽的晶体平板表面自由能表达式，并实现一个数值程序从合成数据中提取该物理量。该过程涉及修正使用周期性边界条件的模拟中固有的赝静电相互作用。\n\n### 第 1 步：理论推导与物理原理\n\n单位面积的表面自由能 $\\gamma$ 代表相对于体相材料创造一个表面所需的过剩能量。对于一个由 $N$ 个原子层构成、表面积为 $A$ 且产生两个相同表面的晶体平板，其表面能在无限厚平板的极限下正式定义为：\n$$ \\gamma = \\lim_{N\\to\\infty} \\frac{1}{2A} \\left[ E_{\\text{slab,iso}}(N, A) - N E_{\\text{bulk}} \\right] $$\n这里，$E_{\\text{slab,iso}}(N, A)$ 是一个理想的、孤立的 $N$ 层平板的总能，$E_{\\text{bulk}}$ 是体相晶体中单个原子层的参考能量。因子 $\\frac{1}{2}$ 是因为创造了两个表面。\n\n在实践中，总能通常使用周期性边界条件（PBC）计算。将一个平板放置在面积为 $A$、高度为 $L_{\\text{cell}}$ 的计算超胞中，该超胞在所有三个维度上周期性重复。超胞高度由平板厚度加上厚度为 $L_z$ 的真空区域组成，因此 $L_{\\text{cell}} \\approx L_{\\text{slab}} + L_z$。如果平板具有垂直于其表面的净偶极矩 $p_z$，周期性重复会产生一个无限的偶极子片层序列。这种排列会在整个超胞（包括平板内部）产生一个赝均匀电场，从而改变计算出的总能。\n\n这种赝能量贡献 $E_{\\text{dipole}}$ 可以从经典静电学推导得出。一个单位面积偶极矩为 $\\mu_z = p_z/A$ 的偶极子片层会产生一个大小为 $\\Delta V = 4\\pi \\mu_z$ 的势阶（在原子单位中，$4\\pi\\epsilon_0=1$）。在周期性重复的系统中，这个势阶呈锯齿状。为了保持势的周期性，实际上会引入一个虚拟背景电荷，这导致整个胞中存在一个恒定电场 $E = \\Delta V / L_{\\text{cell}} = 4\\pi p_z / (A L_{\\text{cell}})$。该场的能量密度为 $u = E^2 / (8\\pi)$。因此，在胞体积 $V = A L_{\\text{cell}}$ 中的总赝能量为：\n$$ E_{\\text{dipole}} = u \\cdot V = \\frac{1}{8\\pi} \\left( \\frac{4\\pi p_z}{A L_{\\text{cell}}} \\right)^2 (A L_{\\text{cell}}) = \\frac{2\\pi p_z^2}{A L_{\\text{cell}}} $$\n由于真空区域 $L_z$ 通常远大于物理平板的厚度，通常近似为 $L_{\\text{cell}} \\approx L_z$。问题陈述中指出相互作用能与 $1/(A L_z)$ 成比例，这暗示了此近似。该公式为偶极修正的函数形式提供了依据。计算得到的总能 $E_{\\text{slab}}^{\\text{measured}}$ 是真实孤立平板能量与此赝能项之和。为了恢复物理上有意义的孤立平板能量，必须减去此项：\n$$ E_{\\text{slab}}^{\\text{corrected}}(N, A, L_z) = E_{\\text{slab}}^{\\text{measured}}(N, A, L_z) - \\frac{2\\pi p_z^2}{A L_z} $$\n在此表达式中，所有量（$E, p_z, A, L_z$）均以原子单位表示。\n\n利用修正后的能量，我们可以定义厚度为 $N$、真空层为 $L_z$ 的有限平板的表面能：\n$$ \\gamma(N, L_z) = \\frac{1}{2A} \\left[ E_{\\text{slab}}^{\\text{corrected}}(N, A, L_z) - N E_{\\text{bulk}} \\right] $$\n\n对于有限的 $N$，$\\gamma(N, L_z)$ 仍然偏离真实的半无限极限 $\\gamma_{\\infty}$。这些有限尺寸效应源于量子限制效应以及平板两个表面之间的残余相互作用。这些效应通常随平板厚度衰减。一个常见且有物理动机的主导阶 N 依赖性模型是有理渐近形式：\n$$ \\gamma(N) = \\gamma_{\\infty} + \\frac{B}{N} $$\n其中 $B$ 是一个常数。这个方程解释了渐近厚度依赖性：当 $N \\to \\infty$ 时，$B/N$ 项消失，$\\gamma(N)$ 收敛到真实的表面能 $\\gamma_{\\infty}$。这种函数形式为对计算出的表面能 $\\gamma(N)$ 随 $1/N$ 进行线性拟合的数值程序提供了依据。该拟合的截距提供了对 $\\gamma_{\\infty}$ 的估计。修正后的能量对 $L_z$ 的非零依赖性表明，主导阶偶极修正不充分，可能存在更高阶的多极相互作用或周期性镜像之间的波函数重叠，这些作用通常衰减得更快，例如，按 $1/L_z^2$ 衰减。\n\n### 第 2 步：数值实现计划\n\n对于每个测试用例，数值程序将遵循以下步骤：\n1.  **常量与转换**：定义物理常量 $a_0$ 和 $E_{\\text{H}}$。计算从 Hartree/$a_0^2$ 到 J/m$^2$ 的转换因子：\n    $$ \\text{factor} = \\frac{E_{\\text{H}}}{a_0^2} = \\frac{4.3597447222071 \\times 10^{-18} \\text{ J}}{(5.29177210903 \\times 10^{-11} \\text{ m})^2} $$\n\n2.  **合成数据生成**：对于平板厚度 $N$ 和真空长度 $L_z$ 的每种组合，根据指定的模型以哈特里原子单位生成“测量的”总能 $E_{\\text{slab}}^{\\text{measured}}$：\n    $$ E_{\\text{slab}}^{\\text{measured}}(N, L_z) = N E_{\\text{bulk}} + 2A \\gamma_{\\infty}^{\\text{au}} + \\frac{2 A b^{\\text{au}}}{N} + \\frac{2\\pi p_z^2}{A L_z} + \\frac{c_{\\text{res}}}{L_z^2} $$\n    其中 $\\gamma_{\\infty}^{\\text{au}}$ 和 $b^{\\text{au}}$ 是以 J/m$^2$ 给出的输入参数，通过除以转换因子转换为原子单位 (Hartree/$a_0^2$)。\n\n3.  **能量修正与表面能计算**：\n    *   对每个生成的能量应用偶极修正：$E_{\\text{slab}}^{\\text{corrected}} = E_{\\text{slab}}^{\\text{measured}} - \\frac{2\\pi p_z^2}{A L_z}$。\n    *   以原子单位计算每个 $(N, L_z)$ 对的表面能：$\\gamma^{\\text{au}}(N, L_z) = \\frac{1}{2A} (E_{\\text{slab}}^{\\text{corrected}} - N E_{\\text{bulk}})$。\n\n4.  **真空收敛性分析**：\n    *   对于每个平板厚度 $N$，计算所有真空长度 $L_z$ 上的表面能分布范围：$\\Delta\\gamma(N) = \\max_{L_z} \\gamma^{\\text{au}}(N, L_z) - \\min_{L_z} \\gamma^{\\text{au}}(N, L_z)$。\n    *   找出所有 $N$ 中的最大分布范围：$\\Delta\\gamma_{\\max} = \\max_{N} \\Delta\\gamma(N)$。\n    *   将 $\\Delta\\gamma_{\\max}$ 转换为 J/m$^2$ 并检查其是否小于或等于 $10^{-2}$ J/m$^2$ 的容差。这决定了布尔收敛标志。\n\n5.  **外推至无限厚度**：\n    *   对每个测试用例，选择对应于最大真空长度 $L_{z,\\max}$ 的数据。\n    *   构建数据集 $\\{ (x_i, y_i) \\}$，其中 $x_i = 1/N_i$，$y_i = \\gamma^{\\text{au}}(N_i, L_{z,\\max})$。\n    *   使用 `numpy.polyfit` 对模型 $y = a + b'x$ 进行线性最小二乘拟合。截距 $a$ 是 $\\gamma_{\\infty}$ 在原子单位下的估计值。\n    *   计算拟合的均方根误差 (RMSE)：$\\text{RMSE} = \\sqrt{\\frac{1}{k} \\sum_{i=1}^k (y_i - (a+b'x_i))^2}$，其中 $k$ 是 $N$ 值的数量。\n    *   将得到的截距 $a$ 和 RMSE 乘以转换因子，转换为 J/m$^2$。\n\n6.  **输出格式化**：收集每个测试用例的外推表面能 $\\gamma$、收敛标志和 RMSE，并将它们格式化为所需的单行字符串输出。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational materials science problem by simulating slab energy data,\n    applying dipole corrections, checking for vacuum convergence, and extracting the\n    semi-infinite surface energy via a linear fit.\n    \"\"\"\n    # Physical constants in SI units\n    A0 = 5.29177210903e-11  # Bohr radius in meters\n    EH = 4.3597447222071e-18 # Hartree energy in Joules\n\n    # Conversion factor from Hartree/a0^2 to J/m^2\n    HARTREE_PER_A02_TO_J_PER_M2 = EH / (A0**2)\n    # Conversion factor from J/m^2 to Hartree/a0^2\n    J_PER_M2_TO_HARTREE_PER_A02 = 1.0 / HARTREE_PER_A02_TO_J_PER_M2\n\n    # Vacuum convergence tolerance in J/m^2\n    VACUUM_TOLERANCE_SI = 1e-2\n\n    test_cases = [\n        # Test case 1 (happy path)\n        {\n            \"A\": 75.0, \"E_bulk\": -5.0, \"p_z\": 1.0,\n            \"N_values\": [4, 6, 8, 10, 12],\n            \"Lz_values\": [60.0, 80.0, 100.0],\n            \"gamma_inf_si\": 1.2, \"b_si\": 0.3, \"c_res\": 0.0\n        },\n        # Test case 2 (stronger dipole)\n        {\n            \"A\": 120.0, \"E_bulk\": -8.3, \"p_z\": 3.0,\n            \"N_values\": [5, 7, 9, 11, 13],\n            \"Lz_values\": [70.0, 100.0, 140.0],\n            \"gamma_inf_si\": 2.0, \"b_si\": 0.25, \"c_res\": 0.0\n        },\n        # Test case 3 (insufficient vacuum, residual interactions)\n        {\n            \"A\": 60.0, \"E_bulk\": -3.5, \"p_z\": 3.0,\n            \"N_values\": [3, 4, 5, 6],\n            \"Lz_values\": [30.0, 40.0, 50.0],\n            \"gamma_inf_si\": 0.8, \"b_si\": 0.5, \"c_res\": 6.0\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        A = case[\"A\"]\n        E_bulk = case[\"E_bulk\"]\n        p_z = case[\"p_z\"]\n        N_values = np.array(case[\"N_values\"])\n        Lz_values = np.array(case[\"Lz_values\"])\n        gamma_inf_si = case[\"gamma_inf_si\"]\n        b_si = case[\"b_si\"]\n        c_res = case[\"c_res\"]\n\n        # Convert SI parameters to atomic units\n        gamma_inf_au = gamma_inf_si * J_PER_M2_TO_HARTREE_PER_A02\n        b_au = b_si * J_PER_M2_TO_HARTREE_PER_A02\n\n        # Dictionary to store calculated surface energies\n        gamma_values_au = {N: {} for N in N_values}\n\n        # --- Data Generation and Analysis ---\n        for N in N_values:\n            for Lz in Lz_values:\n                # 1. Generate synthetic measured energy in Hartree\n                E_bulk_term = N * E_bulk\n                E_surface_term = 2.0 * A * gamma_inf_au\n                E_finite_N_term = (2.0 * A * b_au) / N\n                E_dipole_term = (2.0 * np.pi * p_z**2) / (A * Lz)\n                E_residual_term = c_res / (Lz**2)\n                \n                E_measured_au = (E_bulk_term + E_surface_term + E_finite_N_term +\n                                 E_dipole_term + E_residual_term)\n\n                # 2. Apply dipole correction\n                E_corrected_au = E_measured_au - E_dipole_term\n\n                # 3. Calculate surface energy in atomic units\n                gamma_au = (E_corrected_au - N * E_bulk) / (2.0 * A)\n                gamma_values_au[N][Lz] = gamma_au\n\n        # --- Vacuum Convergence Check ---\n        max_spread_au = 0.0\n        for N in N_values:\n            gammas_for_N = list(gamma_values_au[N].values())\n            spread_au = np.max(gammas_for_N) - np.min(gammas_for_N)\n            if spread_au > max_spread_au:\n                max_spread_au = spread_au\n        \n        max_spread_si = max_spread_au * HARTREE_PER_A02_TO_J_PER_M2\n        is_converged = max_spread_si <= VACUUM_TOLERANCE_SI\n\n        # --- Fit for Semi-Infinite Surface Energy ---\n        Lz_max = np.max(Lz_values)\n        x_fit = 1.0 / N_values\n        y_fit = np.array([gamma_values_au[N][Lz_max] for N in N_values])\n\n        # Linear fit: y = b'*x + a\n        # numpy.polyfit returns coefficients [b', a] for degree 1\n        fit_coeffs = np.polyfit(x_fit, y_fit, 1)\n        slope, intercept_au = fit_coeffs[0], fit_coeffs[1]\n\n        # Convert intercept to SI units\n        gamma_fit_si = intercept_au * HARTREE_PER_A02_TO_J_PER_M2\n\n        # --- RMSE Calculation ---\n        y_pred = np.polyval(fit_coeffs, x_fit)\n        rmse_au = np.sqrt(np.mean((y_fit - y_pred)**2))\n        rmse_si = rmse_au * HARTREE_PER_A02_TO_J_PER_M2\n\n        # Append results for this case\n        results.extend([\n            round(gamma_fit_si, 6),\n            is_converged,\n            round(rmse_si, 6)\n        ])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3498188"}, {"introduction": "材料的力学响应是其最重要的基态性质之一，它决定了材料在应力下的行为。弹性常数作为连接微观能量与宏观力学行为的桥梁，可以通过计算总能量对应变的二阶导数来确定。本练习将指导您如何通过施加特定的剪切应变，从能量-应变关系中精确提取立方晶体的弹性常数 $C_{44}$。您不仅将学习到“能量-应变”法的基本原理，还将接触到一个更深层次的概念——普莱误差（Pulay error），并学会如何通过系统性外推来消除这种计算伪影，从而获得高精度的力学性能预测。[@problem_id:3498179]", "problem": "考虑一个处于零外部应力下的立方晶体。总能量作为微小均匀应变张量 $\\boldsymbol{\\epsilon}$ 的函数，可进行二次展开\n$$\nE(\\boldsymbol{\\epsilon}) = E_0 + \\frac{1}{2} V_0 \\sum_{i,j,k,l} C_{ijkl}\\,\\epsilon_{ij}\\,\\epsilon_{kl} + \\mathcal{O}\\!\\left(\\|\\boldsymbol{\\epsilon}\\|^3\\right),\n$$\n其中 $E_0$ 是未应变时的能量，$V_0$ 是平衡体积，$C_{ijkl}$ 是弹性劲度。在 Voigt 记法中，对于立方材料，独立的弹性常数为 $C_{11}$、$C_{12}$ 和 $C_{44}$。使用对称性匹配的应变来分离特定的弹性常数。特别地，使用 $xy$ 平面内的纯剪切模式，其工程剪切应变为 $\\gamma$，由对称张量 $\\epsilon_{xy} = \\epsilon_{yx} = \\gamma/2$ 定义，所有其他分量为零。\n\n为了研究基组不完备性（Pulay 误差）对通过曲率提取的弹性常数的影响，我们考虑一个合成的、但物理上一致的能量预言机，它在选定的平面波截断能 $E_{\\text{cut}}$ 下返回总能量（每个晶胞）$E(\\boldsymbol{\\epsilon}; E_{\\text{cut}})$。该预言机由三部分构成：\n1. 由真实弹性常数构建的谐波弹性能量密度 $U_{\\text{harm}}$，\n2. 与 $E_{\\text{cut}}$ 成反比且对应变为二次方的 Pulay 误差能量密度 $U_{\\text{Pulay}}$，\n3. 一个小的四次剪切非谐性 $U_{\\text{anh}}$，它与 $E_{\\text{cut}}$ 无关，并用于正则化步长效应。\n\n所有能量单位为电子伏特，体积单位为立方埃，应变为无量纲，弹性常数单位为吉帕斯卡。设转换常数为 $\\kappa = 160.21766208$ 吉帕斯卡每 $\\text{electronvolt}/\\text{Å}^3$。该预言机为\n$$\nE(\\boldsymbol{\\epsilon}; E_{\\text{cut}}) = E_0 + V_0 \\left[ U_{\\text{harm}}(\\boldsymbol{\\epsilon}) + U_{\\text{Pulay}}(\\boldsymbol{\\epsilon}; E_{\\text{cut}}) + U_{\\text{anh}}(\\boldsymbol{\\epsilon}) \\right],\n$$\n其中\n$$\nU_{\\text{harm}}(\\boldsymbol{\\epsilon}) = \\frac{1}{\\kappa} \\left( \\frac{1}{2} C_{11} \\left(\\epsilon_{xx}^2 + \\epsilon_{yy}^2 + \\epsilon_{zz}^2 \\right) + C_{12} \\left(\\epsilon_{xx}\\epsilon_{yy} + \\epsilon_{yy}\\epsilon_{zz} + \\epsilon_{zz}\\epsilon_{xx} \\right) + 2 C_{44} \\left( \\epsilon_{xy}^2 + \\epsilon_{yz}^2 + \\epsilon_{xz}^2 \\right) \\right),\n$$\n$$\nU_{\\text{Pulay}}(\\boldsymbol{\\epsilon}; E_{\\text{cut}}) = \\frac{1}{\\kappa} \\left( \\frac{1}{2} \\frac{K_{\\text{vol}}}{E_{\\text{cut}}} (\\epsilon_{xx} + \\epsilon_{yy} + \\epsilon_{zz})^2 + 2 \\frac{K_{\\text{sh}}}{E_{\\text{cut}}} \\left( \\epsilon_{xy}^2 + \\epsilon_{yz}^2 + \\epsilon_{xz}^2 \\right) + \\frac{1}{2} \\frac{K_{\\text{diag}}}{E_{\\text{cut}}} \\left(\\epsilon_{xx}^2 + \\epsilon_{yy}^2 + \\epsilon_{zz}^2 \\right) \\right),\n$$\n$$\nU_{\\text{anh}}(\\boldsymbol{\\epsilon}) = \\frac{1}{4} H_{\\text{sh}} \\left( (2\\epsilon_{xy})^4 + (2\\epsilon_{yz})^4 + (2\\epsilon_{xz})^4 \\right).\n$$\n使用的常数如下\n- $E_0 = -10.0$ 电子伏特,\n- $V_0 = 15.0$ $\\text{Å}^3$,\n- $C_{11} = 250.0$ 吉帕斯卡,\n- $C_{12} = 150.0$ 吉帕斯卡,\n- $C_{44} = 120.0$ 吉帕斯卡,\n- $K_{\\text{vol}} = 1000.0$ 吉帕斯卡$\\cdot$电子伏特,\n- $K_{\\text{sh}} = 7200.0$ 吉帕斯卡$\\cdot$电子伏特,\n- $K_{\\text{diag}} = 500.0$ 吉帕斯卡$\\cdot$电子伏特,\n- $H_{\\text{sh}} = 0.02$ 电子伏特$/\\text{Å}^3$,\n- $\\kappa = 160.21766208$ 吉帕斯卡每电子伏特$/\\text{Å}^3$。\n\n你的任务是编写一个完整的程序，该程序：\n- 使用上述常数实现预言机 $E(\\boldsymbol{\\epsilon}; E_{\\text{cut}})$。\n- 使用上述对称性匹配的纯剪切模式（工程剪切应变为 $\\gamma$），通过步长为 $\\Delta \\gamma$ 的三点中心差分公式，数值估算在 $\\gamma = 0$ 处的曲率 $\\partial^2 E / \\partial \\gamma^2$：\n$$\n\\left.\\frac{\\partial^2 E}{\\partial \\gamma^2}\\right|_{\\gamma=0} \\approx \\frac{E(\\gamma=+\\Delta \\gamma; E_{\\text{cut}}) - 2 E(\\gamma=0; E_{\\text{cut}}) + E(\\gamma=-\\Delta \\gamma; E_{\\text{cut}})}{(\\Delta \\gamma)^2}.\n$$\n- 使用体积 $V_0$ 和转换常数 $\\kappa$，将曲率转换为 $C_{44}$ 的估计值（单位为吉帕斯卡）。\n\n在你的解答中，必须从第一性原理推导出到 $C_{44}$（单位为吉帕斯卡）的转换，但你的程序必须实现最终的表达式。\n\n测试套件和要求的输出：\n- 使用三个截断能 $E_{\\text{cut}} \\in \\{300.0, 600.0, 1200.0\\}$ 电子伏特，并取 $\\Delta \\gamma = 0.02$，生成三个 $C_{44}$ 的估计值。\n- 对这三个估计值与 $1/E_{\\text{cut}}$ 的关系进行线性最小二乘拟合，模型为 $C_{44}(E_{\\text{cut}}) = C_{44}^{(\\infty)} + A \\cdot (1/E_{\\text{cut}})$，并报告外推得到的 $C_{44}^{(\\infty)}$。\n- 此外，计算在 $E_{\\text{cut}} = 300.0$ 电子伏特和较大步长 $\\Delta \\gamma = 0.05$ 时的估计值。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$\n\\left[ C_{44}(300.0,\\Delta \\gamma=0.02),\\; C_{44}(600.0,\\Delta \\gamma=0.02),\\; C_{44}(1200.0,\\Delta \\gamma=0.02),\\; C_{44}^{(\\infty)}\\ \\text{from fit},\\; C_{44}(300.0,\\Delta \\gamma=0.05) \\right],\n$$\n每个条目都以吉帕斯卡为单位表示，四舍五入到 $6$ 位小数，不含任何附加文本。不涉及角度。物理单位必须与规定完全一致。输出中的所有数值必须是浮点数。\n\n科学真实性要求：确保你的实现遵循上述定义，使用指定的常数，并忠实地应用对称性匹配的应变。不允许使用外部数据；预言机必须直接根据此处给出的公式实现。程序必须是自包含的，并且不需要任何输入。", "solution": "该问题在科学和数学上是适定且自洽的。所有必需的常数、物理模型和数值步骤均已提供，从而可以得到唯一且可验证的解。我们将进行推导和实现。\n\n主要目标是通过分析立方晶体对特定剪切应变的总能量响应来确定弹性常数 $C_{44}$。给定一个能量预言机 $E(\\boldsymbol{\\epsilon}; E_{\\text{cut}})$，它将总能量建模为应变张量 $\\boldsymbol{\\epsilon}$ 和一个计算参数（平面波截断能 $E_{\\text{cut}}$）的函数。该预言机包括谐波、Pulay 误差和非谐性贡献。\n\n首先，我们推导在指定应变下能量与弹性常数 $C_{44}$ 之间的关系。问题规定了 $xy$ 平面内的一个纯剪切变形，由工程剪切应变 $\\gamma$ 定义。相应的对称应变张量 $\\boldsymbol{\\epsilon}$ 的分量为 $\\epsilon_{xy} = \\epsilon_{yx} = \\gamma/2$，所有其他分量 $\\epsilon_{ij}$ 均为零。\n\n我们将这个特定的应变张量代入给定的能量预言机各分量中：\n$E(\\boldsymbol{\\epsilon}; E_{\\text{cut}}) = E_0 + V_0 \\left[ U_{\\text{harm}}(\\boldsymbol{\\epsilon}) + U_{\\text{Pulay}}(\\boldsymbol{\\epsilon}; E_{\\text{cut}}) + U_{\\text{anh}}(\\boldsymbol{\\epsilon}) \\right]$。\n\n1.  **谐波项 $U_{\\text{harm}}$**：\n    通用形式为 $U_{\\text{harm}}(\\boldsymbol{\\epsilon}) = \\frac{1}{\\kappa} \\left( \\frac{1}{2} C_{11} \\left(\\epsilon_{xx}^2 + \\epsilon_{yy}^2 + \\epsilon_{zz}^2 \\right) + C_{12} \\left(\\epsilon_{xx}\\epsilon_{yy} + \\epsilon_{yy}\\epsilon_{zz} + \\epsilon_{zz}\\epsilon_{xx} \\right) + 2 C_{44} \\left( \\epsilon_{xy}^2 + \\epsilon_{yz}^2 + \\epsilon_{xz}^2 \\right) \\right)$。\n    对于我们的应变，只有 $\\epsilon_{xy}$ 非零。表达式简化为：\n    $$\n    U_{\\text{harm}}(\\gamma) = \\frac{1}{\\kappa} \\left( 2 C_{44} \\epsilon_{xy}^2 \\right) = \\frac{2 C_{44}}{\\kappa} \\left(\\frac{\\gamma}{2}\\right)^2 = \\frac{C_{44}}{2\\kappa} \\gamma^2.\n    $$\n\n2.  **Pulay 误差项 $U_{\\text{Pulay}}$**：\n    通用形式为 $U_{\\text{Pulay}}(\\boldsymbol{\\epsilon}; E_{\\text{cut}}) = \\frac{1}{\\kappa} \\left( \\frac{1}{2} \\frac{K_{\\text{vol}}}{E_{\\text{cut}}} (\\epsilon_{xx} + \\epsilon_{yy} + \\epsilon_{zz})^2 + 2 \\frac{K_{\\text{sh}}}{E_{\\text{cut}}} \\left( \\epsilon_{xy}^2 + \\epsilon_{yz}^2 + \\epsilon_{xz}^2 \\right) + \\frac{1}{2} \\frac{K_{\\text{diag}}}{E_{\\text{cut}}} \\left(\\epsilon_{xx}^2 + \\epsilon_{yy}^2 + \\epsilon_{zz}^2 \\right) \\right)$。\n    同样，只有涉及 $\\epsilon_{xy}^2$ 的项保留下来：\n    $$\n    U_{\\text{Pulay}}(\\gamma; E_{\\text{cut}}) = \\frac{1}{\\kappa} \\left( 2 \\frac{K_{\\text{sh}}}{E_{\\text{cut}}} \\epsilon_{xy}^2 \\right) = \\frac{2 K_{\\text{sh}}}{\\kappa E_{\\text{cut}}} \\left(\\frac{\\gamma}{2}\\right)^2 = \\frac{K_{\\text{sh}}}{2\\kappa E_{\\text{cut}}} \\gamma^2.\n    $$\n\n3.  **非谐性项 $U_{\\text{anh}}$**：\n    通用形式为 $U_{\\text{anh}}(\\boldsymbol{\\epsilon}) = \\frac{1}{4} H_{\\text{sh}} \\left( (2\\epsilon_{xy})^4 + (2\\epsilon_{yz})^4 + (2\\epsilon_{xz})^4 \\right)$。\n    这简化为：\n    $$\n    U_{\\text{anh}}(\\gamma) = \\frac{1}{4} H_{\\text{sh}} \\left( 2 \\frac{\\gamma}{2} \\right)^4 = \\frac{H_{\\text{sh}}}{4} \\gamma^4.\n    $$\n\n结合这些项，总能量作为工程剪切应变 $\\gamma$ 的函数为：\n$$\nE(\\gamma; E_{\\text{cut}}) = E_0 + V_0 \\left[ \\left( \\frac{C_{44}}{2\\kappa} + \\frac{K_{\\text{sh}}}{2\\kappa E_{\\text{cut}}} \\right) \\gamma^2 + \\frac{H_{\\text{sh}}}{4} \\gamma^4 \\right].\n$$\n根据弹性常数的定义，对于这种剪切，单位体积的能量有一个二次项 $\\frac{1}{2}C_{44}\\gamma^2$。因此，总能量对 $\\gamma$ 的二阶导数在 $\\gamma=0$ 处的值与 $C_{44}$ 相关：\n$$\n\\left.\\frac{\\partial^2 E}{\\partial \\gamma^2}\\right|_{\\gamma=0} = V_0 \\left( \\frac{C_{44}}{\\kappa} + \\frac{K_{\\text{sh}}}{\\kappa E_{\\text{cut}}} \\right).\n$$\n整理此式可得一种从能量曲率求有效弹性常数的方法：\n$$\nC_{44} + \\frac{K_{\\text{sh}}}{E_{\\text{cut}}} = \\frac{\\kappa}{V_0} \\left.\\frac{\\partial^2 E}{\\partial \\gamma^2}\\right|_{\\gamma=0}.\n$$\n问题要求使用步长为 $\\Delta\\gamma$ 的三点中心差分公式对该二阶导数进行数值估算：\n$$\n\\left.\\frac{\\partial^2 E}{\\partial \\gamma^2}\\right|_{\\gamma=0} \\approx \\frac{E(+\\Delta \\gamma; E_{\\text{cut}}) - 2 E(0; E_{\\text{cut}}) + E(-\\Delta \\gamma; E_{\\text{cut}})}{(\\Delta \\gamma)^2}.\n$$\n我们来分析分子部分。注意 $E(\\gamma)$ 只依赖于 $\\gamma$ 的偶数次幂，所以 $E(+\\Delta\\gamma) = E(-\\Delta\\gamma)$。此外，$E(0; E_{\\text{cut}}) = E_0$。\n$$\nE(\\Delta\\gamma) - 2 E_0 + E(\\Delta\\gamma) = 2(E(\\Delta\\gamma) - E_0) = 2 V_0 \\left[ \\left( \\frac{C_{44}}{2\\kappa} + \\frac{K_{\\text{sh}}}{2\\kappa E_{\\text{cut}}} \\right) (\\Delta\\gamma)^2 + \\frac{H_{\\text{sh}}}{4} (\\Delta\\gamma)^4 \\right].\n$$\n那么，数值二阶导数为：\n$$\n\\left( \\frac{\\partial^2 E}{\\partial \\gamma^2} \\right)_{\\text{num}} = \\frac{2 V_0 \\left[ \\left( \\frac{C_{44}}{2\\kappa} + \\frac{K_{\\text{sh}}}{2\\kappa E_{\\text{cut}}} \\right) (\\Delta\\gamma)^2 + \\frac{H_{\\text{sh}}}{4} (\\Delta\\gamma)^4 \\right]}{(\\Delta\\gamma)^2} = \\frac{V_0}{\\kappa}\\left(C_{44} + \\frac{K_{\\text{sh}}}{E_{\\text{cut}}}\\right) + \\frac{V_0 H_{\\text{sh}}}{2} (\\Delta\\gamma)^2.\n$$\n数值估计的弹性常数，我们记为 $C_{44}^{\\text{est}}$，是通过将此数值曲率乘以 $\\kappa/V_0$ 得到的：\n$$\nC_{44}^{\\text{est}}(E_{\\text{cut}}, \\Delta\\gamma) = \\frac{\\kappa}{V_0} \\left( \\frac{\\partial^2 E}{\\partial \\gamma^2} \\right)_{\\text{num}} = \\left(C_{44} + \\frac{K_{\\text{sh}}}{E_{\\text{cut}}}\\right) + \\frac{\\kappa H_{\\text{sh}}}{2} (\\Delta\\gamma)^2.\n$$\n这个方程表明，与真实值 $C_{44}$ 相比，估计的常数有两个误差来源：一个与 $1/E_{\\text{cut}}$ 成正比的 Pulay 误差项，以及一个与 $(\\Delta\\gamma)^2$ 成正比的有限差分截断误差。\n\n任务要求对固定的 $\\Delta\\gamma$，进行 $C_{44}^{\\text{est}}$ 相对于 $1/E_{\\text{cut}}$ 的线性最小二乘拟合。我们推导出的 $C_{44}^{\\text{est}}$ 表达式具有线性方程 $y = m x + b$ 的形式：\n$$\nC_{44}^{\\text{est}} = K_{\\text{sh}} \\cdot \\left(\\frac{1}{E_{\\text{cut}}}\\right) + \\left(C_{44} + \\frac{\\kappa H_{\\text{sh}}}{2} (\\Delta\\gamma)^2\\right),\n$$\n其中 $y = C_{44}^{\\text{est}}$，$x = 1/E_{\\text{cut}}$，斜率 $m=K_{\\text{sh}}$，y 轴截距 $b = C_{44} + \\frac{\\kappa H_{\\text{sh}}}{2} (\\Delta\\gamma)^2$。在无限截断能下的外推值 $C_{44}^{(\\infty)}$ 是此拟合的 y 轴截距 $b$。\n\n算法如下：\n1. 基于简化的能量表达式 $E(\\gamma; E_{\\text{cut}})$，实现一个函数 `energy_oracle(gamma, e_cut)`。\n2. 实现一个函数 `calculate_C44_est(e_cut, delta_gamma)`，该函数计算三个能量点 $E(+\\Delta\\gamma)$、$E(0)$ 和 $E(-\\Delta\\gamma)$，应用中心差分公式得到曲率，并使用因子 $\\kappa/V_0$ 将其转换为 $C_{44}^{\\text{est}}$。\n3. 计算三个估计值 $C_{44}^{\\text{est}}(300, 0.02)$、$C_{44}^{\\text{est}}(600, 0.02)$ 和 $C_{44}^{\\text{est}}(1200, 0.02)$。\n4. 对点 $(1/300, C_{44}^{\\text{est}}(300, 0.02))$、$(1/600, C_{44}^{\\text{est}}(600, 0.02))$ 和 $(1/1200, C_{44}^{\\text{est}}(1200, 0.02))$ 进行线性最小二乘拟合。此拟合的截距即为 $C_{44}^{(\\infty)}$。\n5. 计算最后一个要求的值，$C_{44}^{\\text{est}}(300, 0.05)$。\n6. 组合五个结果并按指定格式打印。将使用 `numpy.polyfit` 函数进行线性回归。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# No other libraries are needed or permitted.\n\ndef solve():\n    \"\"\"\n    Solves the computational materials science problem as described.\n    1. Implements the energy oracle for a specific shear strain.\n    2. Uses a numerical derivative to estimate the C44 elastic constant.\n    3. Performs a series of calculations and a linear extrapolation.\n    \"\"\"\n    \n    # Define the physical constants from the problem statement.\n    E0 = -10.0  # unstrained energy in eV\n    V0 = 15.0  # equilibrium volume in A^3\n    C44_true = 120.0  # true C44 in GPa\n    K_sh = 7200.0  # Pulay error shear constant in GPa*eV\n    H_sh = 0.02  # Anharmonic shear constant in eV/A^3\n    kappa = 160.21766208  # conversion constant GPa / (eV/A^3)\n\n    def energy_oracle(gamma, e_cut):\n        \"\"\"\n        Calculates the total energy for a given engineering shear strain gamma\n        and plane-wave cutoff energy e_cut.\n        The general formula is simplified for the specific shear strain.\n        \"\"\"\n        # For shear strain, epsilon_xy = gamma/2.\n        # U_harm = (1/kappa) * (2 * C44_true * (gamma/2)**2)\n        # U_pulay = (1/kappa) * (2 * K_sh/e_cut * (gamma/2)**2)\n        # U_anh = (1/4) * H_sh * gamma**4\n        # Total energy E = E0 + V0 * (U_harm + U_pulay + U_anh)\n        \n        # Combining terms for efficiency:\n        gamma_sq = gamma**2\n        \n        energy_density_quadratic = (C44_true / (2.0 * kappa) + K_sh / (2.0 * kappa * e_cut)) * gamma_sq\n        energy_density_quartic = (H_sh / 4.0) * gamma**4\n        \n        total_energy = E0 + V0 * (energy_density_quadratic + energy_density_quartic)\n        \n        return total_energy\n\n    def calculate_c44_est(e_cut, delta_gamma):\n        \"\"\"\n        Numerically estimates C44 using the three-point central difference formula.\n        \"\"\"\n        # Calculate energy at the three required points\n        e_plus = energy_oracle(delta_gamma, e_cut)\n        e_zero = energy_oracle(0.0, e_cut)\n        # Due to symmetry (even powers of gamma), e_minus = e_plus\n        e_minus = e_plus\n\n        # Calculate the second derivative (curvature) numerically\n        curvature = (e_plus - 2.0 * e_zero + e_minus) / (delta_gamma**2)\n\n        # Convert curvature to the estimated C44 in GPa\n        c44_estimated = curvature * kappa / V0\n        \n        return c44_estimated\n\n    # Define the test cases from the problem statement.\n    e_cuts_for_fit = [300.0, 600.0, 1200.0]\n    delta_gamma_for_fit = 0.02\n    \n    # Calculate the three C44 estimates for the fit\n    c44_fit_values = [calculate_c44_est(ec, delta_gamma_for_fit) for ec in e_cuts_for_fit]\n    \n    # Perform the linear least-squares fit\n    # Model: C44_est = C44_inf + A * (1/E_cut)\n    # x-values are 1/E_cut, y-values are the calculated C44 estimates\n    x_fit = 1.0 / np.array(e_cuts_for_fit)\n    y_fit = np.array(c44_fit_values)\n    \n    # np.polyfit(x, y, 1) returns [slope, intercept] for a linear fit\n    # The extrapolated C44 at infinite cutoff is the intercept\n    slope, c44_extrapolated = np.polyfit(x_fit, y_fit, 1)\n\n    # Calculate the additional test case\n    e_cut_final = 300.0\n    delta_gamma_final = 0.05\n    c44_final_case = calculate_c44_est(e_cut_final, delta_gamma_final)\n    \n    # Assemble the final list of results in the required order\n    results = [\n        c44_fit_values[0],\n        c44_fit_values[1],\n        c44_fit_values[2],\n        c44_extrapolated,\n        c44_final_case\n    ]\n\n    # Format the final output string exactly as specified\n    # Each value rounded to 6 decimal places.\n    output_string = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    \n    print(output_string)\n\nsolve()\n```", "id": "3498179"}]}