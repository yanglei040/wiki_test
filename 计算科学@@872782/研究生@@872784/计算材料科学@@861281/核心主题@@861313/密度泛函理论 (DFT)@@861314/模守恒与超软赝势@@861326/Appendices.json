{"hands_on_practices": [{"introduction": "赝势构建中的一项核心任务是，创造一个能够再现特定平滑赝波函数的势。本练习 [@problem_id:3470110] 让你通过“反演”径向薛定谔方程，亲手进行这一基本推导。你将证明，对于给定的目标波函数和能量，其对应的赝势是唯一确定的，这是生成任何赝势的基石。", "problem": "在构建模守恒赝势（Norm-Conserving Pseudopotential）的过程中，关键一步是通过“反演”薛定谔方程，从一个给定的、平滑的赝波函数来确定其对应的赝势。假定在一个原子的核心区域 $0 < r \\le r_c$ 内，我们为 $s$ 轨道（角动量 $l=0$）设计了一个约化赝部分波函数，其形式为 $u_0(r) = r \\exp(-\\alpha r^2)$，其中 $\\alpha > 0$ 是一个常数。请推导在参考能量 $\\epsilon_0$ 下，能够产生此波函数的局域赝势 $V_0^{\\mathrm{PS}}(r)$ 的解析表达式。", "solution": "该问题陈述经评估有效。它在科学上基于量子力学和计算材料科学的原理，特别是在构建赝势的标准方法上。该问题是适定的、客观的，并提供了一套自洽且一致的已知条件，从而可以推导出唯一且有意义的解。\n\n目标是找到局域赝势 $V_0^{\\mathrm{PS}}(r)$，该赝势在特定的参考能量 $\\epsilon_0$ 下产生给定的赝部分波 $u_0(r)$。其控制方程是原子单位制下的单粒子径向薛定谔方程。对于 $s$ 轨道，角动量量子数 $l=0$，这使得方程大大简化，因为离心势项 $\\frac{l(l+1)}{2r^2}$ 为零。\n\n$l=0$ 时的径向薛定谔方程为：\n$$\n-\\frac{1}{2}\\frac{d^2 u_0(r)}{dr^2} + V_0^{\\mathrm{PS}}(r) u_0(r) = \\epsilon_0 u_0(r)\n$$\n此方程在指定区域 $0 < r \\le r_c$ 内成立。为了求出势 $V_0^{\\mathrm{PS}}(r)$，我们可以重新整理此方程。这个过程通常被称为薛定谔方程的“反演”。\n$$\nV_0^{\\mathrm{PS}}(r) u_0(r) = \\epsilon_0 u_0(r) + \\frac{1}{2}\\frac{d^2 u_0(r)}{dr^2}\n$$\n在感兴趣的区域内，$u_0(r) \\neq 0$，我们可以除以 $u_0(r)$ 来分离出 $V_0^{\\mathrm{PS}}(r)$：\n$$\nV_0^{\\mathrm{PS}}(r) = \\epsilon_0 + \\frac{1}{2u_0(r)}\\frac{d^2 u_0(r)}{dr^2}\n$$\n问题给出了赝部分波的函数形式：\n$$\nu_0(r) = r \\exp(-\\alpha r^2)\n$$\n其中 $\\alpha > 0$。下一步是计算 $u_0(r)$ 关于 $r$ 的一阶和二阶导数。\n\n首先，我们使用乘法法则计算一阶导数 $\\frac{du_0}{dr}$：\n$$\n\\frac{d u_0(r)}{dr} = \\frac{d}{dr}\\left(r \\exp(-\\alpha r^2)\\right) = \\left(\\frac{d}{dr}r\\right)\\exp(-\\alpha r^2) + r\\left(\\frac{d}{dr}\\exp(-\\alpha r^2)\\right)\n$$\n$$\n\\frac{d u_0(r)}{dr} = 1 \\cdot \\exp(-\\alpha r^2) + r \\cdot (-2\\alpha r)\\exp(-\\alpha r^2)\n$$\n$$\n\\frac{d u_0(r)}{dr} = (1 - 2\\alpha r^2) \\exp(-\\alpha r^2)\n$$\n接下来，我们通过对一阶导数求导来计算二阶导数 $\\frac{d^2u_0}{dr^2}$，同样使用乘法法则：\n$$\n\\frac{d^2 u_0(r)}{dr^2} = \\frac{d}{dr}\\left( (1 - 2\\alpha r^2) \\exp(-\\alpha r^2) \\right)\n$$\n$$\n\\frac{d^2 u_0(r)}{dr^2} = \\left(\\frac{d}{dr}(1 - 2\\alpha r^2)\\right)\\exp(-\\alpha r^2) + (1 - 2\\alpha r^2)\\left(\\frac{d}{dr}\\exp(-\\alpha r^2)\\right)\n$$\n$$\n\\frac{d^2 u_0(r)}{dr^2} = (-4\\alpha r)\\exp(-\\alpha r^2) + (1 - 2\\alpha r^2)(-2\\alpha r)\\exp(-\\alpha r^2)\n$$\n提出公因子项 $\\exp(-\\alpha r^2)$：\n$$\n\\frac{d^2 u_0(r)}{dr^2} = \\left[ -4\\alpha r - 2\\alpha r(1 - 2\\alpha r^2) \\right] \\exp(-\\alpha r^2)\n$$\n$$\n\\frac{d^2 u_0(r)}{dr^2} = \\left[ -4\\alpha r - 2\\alpha r + 4\\alpha^2 r^3 \\right] \\exp(-\\alpha r^2)\n$$\n$$\n\\frac{d^2 u_0(r)}{dr^2} = (-6\\alpha r + 4\\alpha^2 r^3) \\exp(-\\alpha r^2)\n$$\n现在，我们将这个二阶导数代回到 $V_0^{\\mathrm{PS}}(r)$ 的表达式中：\n$$\nV_0^{\\mathrm{PS}}(r) = \\epsilon_0 + \\frac{1}{2u_0(r)} \\left[ (-6\\alpha r + 4\\alpha^2 r^3) \\exp(-\\alpha r^2) \\right]\n$$\n代入 $u_0(r) = r \\exp(-\\alpha r^2)$ 的表达式：\n$$\nV_0^{\\mathrm{PS}}(r) = \\epsilon_0 + \\frac{(-6\\alpha r + 4\\alpha^2 r^3) \\exp(-\\alpha r^2)}{2 r \\exp(-\\alpha r^2)}\n$$\n分子和分母中的项 $\\exp(-\\alpha r^2)$ 可以消去：\n$$\nV_0^{\\mathrm{PS}}(r) = \\epsilon_0 + \\frac{-6\\alpha r + 4\\alpha^2 r^3}{2r}\n$$\n最后，我们通过将分子中的每一项都除以 $2r$ 来化简该分数：\n$$\nV_0^{\\mathrm{PS}}(r) = \\epsilon_0 + \\frac{-6\\alpha r}{2r} + \\frac{4\\alpha^2 r^3}{2r}\n$$\n$$\nV_0^{\\mathrm{PS}}(r) = \\epsilon_0 - 3\\alpha + 2\\alpha^2 r^2\n$$\n这是核心半径内局域赝势分量的闭合形式解析表达式。它是一个光滑、有限的势，是关于 $r$ 的二次函数，这与赝势构建的目标是一致的。", "answer": "$$\\boxed{\\epsilon_0 - 3\\alpha + 2\\alpha^{2}r^{2}}$$", "id": "3470110"}, {"introduction": "模守恒赝势在核心半径内保持电荷守恒，而超软赝势则放宽了这一限制以获得更高的计算效率。本练习 [@problem_id:3470104] 探讨了超软赝势的核心概念：“模亏损”及其通过局域增强电荷进行的修正。通过解析推导和简单的编程练习，你将亲手验证物理总电荷是如何通过这种增强机制得以守恒的。", "problem": "考虑 Kohn–Sham 密度泛函理论 (DFT) 中的价电子密度。对于一个孤立原子，假设存在一个球对称的全电子价电子密度 $n^{\\mathrm{AE}}(r)$，其积分等于价电子数 $Z_v$。在保范赝势中，赝密度 $n^{\\mathrm{NC}}(r)$ 在定义的核心半径 $r_c$ 内保持积分电荷守恒，而在超软赝势中，赝密度 $n^{\\mathrm{US}}(r)$ 不要求在 $r_c$ 内部范数守恒。超软赝势引入了一个局域化的增强电荷密度 $q^{\\mathrm{aug}}(r)$，该密度分布在增强区域（通常是核心区）内，使得当增强电荷加到赝密度上时，任意区域内具有物理意义的积分电荷得以恢复。\n\n从以原子为中心、半径为 $R$ 的球体内的积分电荷的定义出发，\n$$\nQ(R) \\equiv \\int_{|\\mathbf{r}|\\le R} n(\\mathbf{r})\\, \\mathrm{d}^3 r = \\int_0^R 4\\pi r^2\\, n(r)\\, \\mathrm{d}r,\n$$\n考虑以下用于只考虑价电子计算的、具有物理动机且易于处理的超软赝势模型：\n\n- 每个原子 $a$ 的全电子价电子密度由一个 Slater 型（类氢原子）球对称密度建模\n$$\nn_a^{\\mathrm{AE}}(r) = \\frac{Z_{v,a}}{\\pi a_a^3}\\,\\exp\\!\\left(-\\frac{2r}{a_a}\\right),\n$$\n该密度被归一化，使得\n$$\n\\int_0^\\infty 4\\pi r^2\\, n_a^{\\mathrm{AE}}(r)\\, \\mathrm{d}r = Z_{v,a}.\n$$\n此处 $Z_{v,a}$ 是价电子数（单位为电子），$a_a$ 是特征衰减长度（单位为玻尔半径）。\n\n- 超软赝密度 $n_a^{\\mathrm{US}}(r)$ 的定义为：在核心半径 $r_{c,a}$ 之外与全电子密度相匹配，在核心内部为一个平滑的缩放密度，\n$$\nn_a^{\\mathrm{US}}(r) =\n\\begin{cases}\n\\alpha_a\\, n_a^{\\mathrm{AE}}(r), & 0 \\le r \\le r_{c,a},\\\\\nn_a^{\\mathrm{AE}}(r), & r \\ge r_{c,a},\n\\end{cases}\n$$\n其中常数 $0 < \\alpha_a < 1$ 用于模拟核心区域内减小的范数。\n\n- 增强密度 $q_a^{\\mathrm{aug}}(r)$ 局域在核心内部，并定义为恢复缺失的价电荷，\n$$\nq_a^{\\mathrm{aug}}(r) =\n\\begin{cases}\n\\left(1-\\alpha_a\\right)\\, n_a^{\\mathrm{AE}}(r), & 0 \\le r \\le r_{c,a},\\\\\n0, & r \\ge r_{c,a}.\n\\end{cases}\n$$\n\n对于一个双原子分子，其中两个原子 $a\\in\\{1,2\\}$ 相距 $d$ 玻尔半径，假设价电子密度满足独立原子叠加近似，并关注以每个原子为中心的球体内的单原子积分电荷。在此近似下，围绕原子 $a$ 的小球体内部的全电子价电荷与赝价电荷之差仅源于该原子自身的核心区域，因为另一个原子的价电子密度在其自身核心区之外对全电子和赝势的贡献是相同的，并且当间距 $d$ 足够大时，其增强区域不会与该小球体发生重叠。\n\n任务：\n\n1. 根据给定的定义，推导半径为 $R$ 的球体内的全电子积分价电荷\n$$\nQ_a^{\\mathrm{AE}}(R) = \\int_0^R 4\\pi r^2\\, n_a^{\\mathrm{AE}}(r)\\, \\mathrm{d}r,\n$$\n的表达式，并证明其可以表示为闭合形式。\n\n2. 使用 $Q_a^{\\mathrm{AE}}(R)$，推导\n$$\nQ_a^{\\mathrm{US}}(R) = \\int_0^R 4\\pi r^2\\, n_a^{\\mathrm{US}}(r)\\, \\mathrm{d}r,\\quad\nQ_a^{\\mathrm{aug}}(R) = \\int_0^R 4\\pi r^2\\, q_a^{\\mathrm{aug}}(r)\\, \\mathrm{d}r,\n$$\n的分段表达式，并用它们证明对于任何 $R\\ge 0$，\n$$\nQ_a^{\\mathrm{AE}}(R) = Q_a^{\\mathrm{US}}(R) + Q_a^{\\mathrm{aug}}(R)\n$$\n成立。\n\n3. 实现一个程序，对于下面指定的参数值，为每个测试用例计算\n$$\n\\Delta_{\\mathrm{before}} \\equiv Q_a^{\\mathrm{AE}}(R) - Q_a^{\\mathrm{US}}(R), \\quad\n\\Delta_{\\mathrm{after}} \\equiv Q_a^{\\mathrm{AE}}(R) - \\left(Q_a^{\\mathrm{US}}(R) + Q_a^{\\mathrm{aug}}(R)\\right),\n$$\n这两个量，两者均以电子为单位表示。您的程序必须输出单行结果：一个用方括号括起来的逗号分隔列表，其中包含浮点数序列\n$$\n[\\Delta_{\\mathrm{before}}^{(1)}, \\Delta_{\\mathrm{after}}^{(1)}, \\Delta_{\\mathrm{before}}^{(2)}, \\Delta_{\\mathrm{after}}^{(2)}, \\dots]\n$$\n其顺序与下面给出的测试套件用例的顺序完全一致。\n\n使用原子单位，长度单位为玻尔半径，电荷单位为电子。不涉及角度。不需要百分比。\n\n测试套件（双原子分子，以原子为中心的球体，大间距以确保增强区域不与另一个原子的球体发生重叠）：\n\n- 原子间距：$d = 4.0$ 玻尔半径。\n\n- 原子 1 参数：$Z_{v,1} = 1$ 电子，$a_1 = 0.8$ 玻尔半径，$r_{c,1} = 0.5$ 玻尔半径，$\\alpha_1 = 0.55$。待测试半径：$R \\in \\{0.25, 0.5, 1.5\\}$ 玻尔半径。\n\n- 原子 2 参数：$Z_{v,2} = 4$ 电子，$a_2 = 1.1$ 玻尔半径，$r_{c,2} = 0.9$ 玻尔半径，$\\alpha_2 = 0.65$。待测试半径：$R \\in \\{0.6, 0.9, 2.2\\}$ 玻尔半径。\n\n覆盖性设计：\n- 选择 $R<r_c$、$R=r_c$ 和 $R>r_c$ 来全面测试分段表达式。\n- 使用不同元素的参数，以确保模型的通用性。", "solution": "该问题具有科学依据，提法恰当且内容自洽。它基于计算材料科学中的成熟概念，特别是密度泛函理论（DFT）和赝势理论。所提供的电子密度模型和积分电荷的定义是一致的，并允许得出唯一的、可验证的解。因此，该问题被认为是有效的，下面将给出完整的解答。\n\n解答过程按问题陈述的要求分为三个部分。首先，推导全电子积分电荷的闭合形式表达式。其次，推导超软赝电荷和增强电荷的表达式，并证明基本的电荷守恒恒等式。最后，基于这些推导，详细说明计算实现的策略。\n\n**1. 全电子积分电荷 $Q_a^{\\mathrm{AE}}(R)$ 的推导**\n\n半径为 $R$ 的球体内的全电子（AE）积分价电荷 $Q_a^{\\mathrm{AE}}(R)$ 由以下积分定义：\n$$\nQ_a^{\\mathrm{AE}}(R) = \\int_0^R 4\\pi r^2\\, n_a^{\\mathrm{AE}}(r)\\, \\mathrm{d}r\n$$\n问题给出了全电子价电子密度的模型：\n$$\nn_a^{\\mathrm{AE}}(r) = \\frac{Z_{v,a}}{\\pi a_a^3}\\,\\exp\\!\\left(-\\frac{2r}{a_a}\\right)\n$$\n将此代入积分可得：\n$$\nQ_a^{\\mathrm{AE}}(R) = \\int_0^R 4\\pi r^2 \\left(\\frac{Z_{v,a}}{\\pi a_a^3}\\,\\exp\\!\\left(-\\frac{2r}{a_a}\\right)\\right)\\, \\mathrm{d}r = \\frac{4 Z_{v,a}}{a_a^3} \\int_0^R r^2 \\exp\\!\\left(-\\frac{2r}{a_a}\\right)\\, \\mathrm{d}r\n$$\n为求解此积分，我们可以使用重复分部积分法或标准积分公式。形式为 $\\int x^2 e^{-cx} dx$ 的不定积分为：\n$$\n\\int r^2 e^{-cr}\\, \\mathrm{d}r = -e^{-cr} \\left(\\frac{r^2}{c} + \\frac{2r}{c^2} + \\frac{2}{c^3}\\right)\n$$\n在我们的例子中，常数是 $c = 2/a_a$。定积分为：\n$$\n\\int_0^R r^2 \\exp\\!\\left(-\\frac{2r}{a_a}\\right)\\, \\mathrm{d}r = \\left[ -e^{-2r/a_a} \\left(\\frac{r^2}{2/a_a} + \\frac{2r}{(2/a_a)^2} + \\frac{2}{(2/a_a)^3}\\right) \\right]_0^R\n$$\n$$\n= \\left[ -e^{-2r/a_a} \\left(\\frac{a_a r^2}{2} + \\frac{a_a^2 r}{2} + \\frac{a_a^3}{4}\\right) \\right]_0^R\n$$\n$$\n= \\left( -e^{-2R/a_a} \\left(\\frac{a_a R^2}{2} + \\frac{a_a^2 R}{2} + \\frac{a_a^3}{4}\\right) \\right) - \\left( -e^0 \\left(0 + 0 + \\frac{a_a^3}{4}\\right) \\right)\n$$\n$$\n= \\frac{a_a^3}{4} - e^{-2R/a_a} \\left(\\frac{a_a R^2}{2} + \\frac{a_a^2 R}{2} + \\frac{a_a^3}{4}\\right)\n$$\n将此结果代回 $Q_a^{\\mathrm{AE}}(R)$ 的表达式中：\n$$\nQ_a^{\\mathrm{AE}}(R) = \\frac{4 Z_{v,a}}{a_a^3} \\left[ \\frac{a_a^3}{4} - e^{-2R/a_a} \\left(\\frac{a_a R^2}{2} + \\frac{a_a^2 R}{2} + \\frac{a_a^3}{4}\\right) \\right]\n$$\n$$\n= Z_{v,a} \\left[ 1 - \\frac{4}{a_a^3} e^{-2R/a_a} \\left(\\frac{a_a R^2}{2} + \\frac{a_a^2 R}{2} + \\frac{a_a^3}{4}\\right) \\right]\n$$\n简化括号内的项，我们得到最终的闭合形式表达式：\n$$\nQ_a^{\\mathrm{AE}}(R) = Z_{v,a} \\left[ 1 - \\exp\\!\\left(-\\frac{2R}{a_a}\\right) \\left(1 + \\frac{2R}{a_a} + \\frac{2R^2}{a_a^2}\\right) \\right]\n$$\n该表达式等价于 $Z_{v,a} \\left[1 - e^{-x}(1+x+x^2/2)\\right]$，其中 $x=2R/a_a$，这是一种与下不完全伽玛函数相关的形式。\n\n**2. $Q_a^{\\mathrm{US}}(R)$、$Q_a^{\\mathrm{aug}}(R)$ 的推导及守恒证明**\n\n超软（US）赝密度 $n_a^{\\mathrm{US}}(r)$ 和增强密度 $q_a^{\\mathrm{aug}}(r)$ 的分段定义导致了其积分电荷的分段表达式。令 $r_c \\equiv r_{c,a}$。\n\n对于 US 积分电荷 $Q_a^{\\mathrm{US}}(R) = \\int_0^R 4\\pi r^2 n_a^{\\mathrm{US}}(r) \\mathrm{d}r$：\n- 如果 $0 \\le R \\le r_c$：\n$$\nQ_a^{\\mathrm{US}}(R) = \\int_0^R 4\\pi r^2 \\left( \\alpha_a n_a^{\\mathrm{AE}}(r) \\right) \\mathrm{d}r = \\alpha_a \\int_0^R 4\\pi r^2 n_a^{\\mathrm{AE}}(r) \\mathrm{d}r = \\alpha_a Q_a^{\\mathrm{AE}}(R)\n$$\n- 如果 $R \\ge r_c$：\n$$\nQ_a^{\\mathrm{US}}(R) = \\int_0^{r_c} 4\\pi r^2 n_a^{\\mathrm{US}}(r) \\mathrm{d}r + \\int_{r_c}^R 4\\pi r^2 n_a^{\\mathrm{US}}(r) \\mathrm{d}r\n$$\n$$\n= \\int_0^{r_c} 4\\pi r^2 \\left( \\alpha_a n_a^{\\mathrm{AE}}(r) \\right) \\mathrm{d}r + \\int_{r_c}^R 4\\pi r^2 n_a^{\\mathrm{AE}}(r) \\mathrm{d}r\n$$\n$$\n= \\alpha_a Q_a^{\\mathrm{AE}}(r_c) + \\left( Q_a^{\\mathrm{AE}}(R) - Q_a^{\\mathrm{AE}}(r_c) \\right) = Q_a^{\\mathrm{AE}}(R) - (1 - \\alpha_a) Q_a^{\\mathrm{AE}}(r_c)\n$$\n\n对于增强积分电荷 $Q_a^{\\mathrm{aug}}(R) = \\int_0^R 4\\pi r^2 q_a^{\\mathrm{aug}}(r) \\mathrm{d}r$：\n- 如果 $0 \\le R \\le r_c$：\n$$\nQ_a^{\\mathrm{aug}}(R) = \\int_0^R 4\\pi r^2 \\left( (1-\\alpha_a) n_a^{\\mathrm{AE}}(r) \\right) \\mathrm{d}r = (1-\\alpha_a) Q_a^{\\mathrm{AE}}(R)\n$$\n- 如果 $R \\ge r_c$：\n$$\nQ_a^{\\mathrm{aug}}(R) = \\int_0^{r_c} 4\\pi r^2 q_a^{\\mathrm{aug}}(r) \\mathrm{d}r + \\int_{r_c}^R 4\\pi r^2 q_a^{\\mathrm{aug}}(r) \\mathrm{d}r\n$$\n$$\n= \\int_0^{r_c} 4\\pi r^2 \\left( (1-\\alpha_a) n_a^{\\mathrm{AE}}(r) \\right) \\mathrm{d}r + \\int_{r_c}^R 4\\pi r^2 (0) \\mathrm{d}r = (1-\\alpha_a) Q_a^{\\mathrm{AE}}(r_c)\n$$\n\n现在，我们证明对于任何 $R \\ge 0$，$Q_a^{\\mathrm{AE}}(R) = Q_a^{\\mathrm{US}}(R) + Q_a^{\\mathrm{aug}}(R)$ 成立。\n- 对于 $0 \\le R \\le r_c$：\n$$\nQ_a^{\\mathrm{US}}(R) + Q_a^{\\mathrm{aug}}(R) = \\alpha_a Q_a^{\\mathrm{AE}}(R) + (1-\\alpha_a) Q_a^{\\mathrm{AE}}(R) = (\\alpha_a + 1 - \\alpha_a) Q_a^{\\mathrm{AE}}(R) = Q_a^{\\mathrm{AE}}(R)\n$$\n- 对于 $R \\ge r_c$：\n$$\nQ_a^{\\mathrm{US}}(R) + Q_a^{\\mathrm{aug}}(R) = \\left( Q_a^{\\mathrm{AE}}(R) - (1 - \\alpha_a) Q_a^{\\mathrm{AE}}(r_c) \\right) + \\left( (1-\\alpha_a) Q_a^{\\mathrm{AE}}(r_c) \\right) = Q_a^{\\mathrm{AE}}(R)\n$$\n该恒等式对所有 $R \\ge 0$ 均成立，证实了增强电荷在所有半径处都能正确地恢复全电子电荷。\n\n**3. 计算实现**\n\n需要计算的量是：\n$$\n\\Delta_{\\mathrm{before}} \\equiv Q_a^{\\mathrm{AE}}(R) - Q_a^{\\mathrm{US}}(R)\n$$\n$$\n\\Delta_{\\mathrm{after}} \\equiv Q_a^{\\mathrm{AE}}(R) - \\left(Q_a^{\\mathrm{US}}(R) + Q_a^{\\mathrm{aug}}(R)\\right)\n$$\n根据第 2 部分证明的恒等式，可以立即看出：\n$$\n\\Delta_{\\mathrm{after}} = Q_a^{\\mathrm{AE}}(R) - Q_a^{\\mathrm{AE}}(R) = 0\n$$\n这对于所有测试用例都成立（在浮点精度范围内）。实现时会将此值精确设置为 $0.0$。\n\n对于 $\\Delta_{\\mathrm{before}}$，我们代入推导出的 $Q_a^{\\mathrm{US}}(R)$ 表达式：\n- 如果 $0 \\le R \\le r_c$：\n$$\n\\Delta_{\\mathrm{before}} = Q_a^{\\mathrm{AE}}(R) - \\alpha_a Q_a^{\\mathrm{AE}}(R) = (1-\\alpha_a) Q_a^{\\mathrm{AE}}(R)\n$$\n- 如果 $R \\ge r_c$：\n$$\n\\Delta_{\\mathrm{before}} = Q_a^{\\mathrm{AE}}(R) - \\left( Q_a^{\\mathrm{AE}}(R) - (1 - \\alpha_a) Q_a^{\\mathrm{AE}}(r_c) \\right) = (1-\\alpha_a) Q_a^{\\mathrm{AE}}(r_c)\n$$\n这两种情况可以合并为一个表达式：\n$$\n\\Delta_{\\mathrm{before}} = (1-\\alpha_a) Q_a^{\\mathrm{AE}}(\\min(R, r_c))\n$$\n值得注意的是，这与增强电荷 $Q_a^{\\mathrm{aug}}(R)$ 的表达式完全相同。这是符合预期的，因为增强电荷的精确定义就是全电子密度和赝电子密度之差。\n\n程序将实现一个函数，使用第 1 部分的公式计算 $Q_a^{\\mathrm{AE}}(R)$。然后，它将使用该函数，根据上面推导的简洁公式为每个测试用例计算 $\\Delta_{\\mathrm{before}}$，并将 $\\Delta_{\\mathrm{after}}$ 设置为 0。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating charge differences for an ultrasoft\n    pseudopotential model.\n    \"\"\"\n\n    def q_ae(R, Zv, a_val):\n        \"\"\"\n        Calculates the all-electron integrated charge Q_a^AE(R).\n\n        Args:\n            R (float): Radius of the integration sphere.\n            Zv (float): Number of valence electrons.\n            a_val (float): Characteristic decay length.\n\n        Returns:\n            float: The integrated all-electron charge.\n        \"\"\"\n        if R == 0.0:\n            return 0.0\n        \n        # We use the derived formula:\n        # Q_a^AE(R) = Zv * [1 - exp(-x) * (1 + x + x^2/2)] where x = 2*R/a_val\n        x = 2.0 * R / a_val\n        poly_term = 1.0 + x + 0.5 * x**2\n        exp_term = np.exp(-x)\n        \n        return Zv * (1.0 - exp_term * poly_term)\n\n    # test_cases format: (Zv, a, rc, alpha, R)\n    test_cases = [\n        # Atom 1 parameters: Zv=1, a=0.8, rc=0.5, alpha=0.55\n        # R values: 0.25, 0.5, 1.5\n        (1.0, 0.8, 0.5, 0.55, 0.25),\n        (1.0, 0.8, 0.5, 0.55, 0.5),\n        (1.0, 0.8, 0.5, 0.55, 1.5),\n        \n        # Atom 2 parameters: Zv=4, a=1.1, rc=0.9, alpha=0.65\n        # R values: 0.6, 0.9, 2.2\n        (4.0, 1.1, 0.9, 0.65, 0.6),\n        (4.0, 1.1, 0.9, 0.65, 0.9),\n        (4.0, 1.1, 0.9, 0.65, 2.2),\n    ]\n\n    results = []\n    for Zv, a_val, rc, alpha, R in test_cases:\n        # From the derivation, Delta_after is analytically zero.\n        # Delta_after = Q_ae - (Q_us + Q_aug) = Q_ae - Q_ae = 0\n        delta_after = 0.0\n\n        # From the derivation, Delta_before = Q_ae - Q_us, which equals Q_aug.\n        # Q_aug(R) = (1-alpha) * Q_ae(min(R, rc))\n        R_effective = min(R, rc)\n        q_ae_at_Reff = q_ae(R_effective, Zv, a_val)\n        delta_before = (1.0 - alpha) * q_ae_at_Reff\n        \n        results.append(delta_before)\n        results.append(delta_after)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3470104"}, {"introduction": "赝势的设计是一门充满权衡的艺术。本综合练习 [@problem_id:3470115] 模拟了赝势设计与验证的真实过程，让你深入探索计算效率（由平面波截断能 $E_{\\mathrm{cut}}$ 决定）与物理准确性（即可移植性）之间的基本权衡。通过构建和比较两个具有不同核心半径的赝势，你将量化地理解一个“更软”的赝势（具有更大的核心半径）如何降低计算成本，但可能在不同化学环境中牺牲准确性。", "problem": "你的任务是构建一个简化的、自洽的计算研究，模拟针对单一元素的两种具有不同核心半径的保范赝势的设计与评估。其目标是在多个能量点上匹配相同的散射相移，同时量化平面波截断能与不同环境下键长的可移植性误差之间的权衡关系。程序必须精确地按照规定实现以下模型和计算。\n\n使用的基本原理和定义：\n- 散射相移源于稳态径向薛定谔方程，并通过分波展开来定义。在原子单位制中，设折合质量为 $1$，波矢 $k$ 与能量 $E$ 满足关系 $k = \\sqrt{2 E}$。\n- 对于 $s$ 波（角动量 $l=0$），有效力程展开为 $k \\cot \\delta_0(E) = -\\frac{1}{a_0} + \\frac{r_0}{2} k^2$。\n- 对于 $p$ 波（角动量 $l=1$），低能有效展开为 $k^3 \\cot \\delta_1(E) = -\\frac{1}{a_1} + \\frac{r_1}{2} k^2$。\n- 相移可以通过这些展开式计算得出，使用反正切函数的主值以保证连续性：对于 $l=0$，$\\delta_0(E) = \\arctan\\left( \\frac{k}{-\\frac{1}{a_0} + \\frac{r_0}{2} k^2} \\right)$；对于 $l=1$，$\\delta_1(E) = \\arctan\\left( \\frac{k^3}{-\\frac{1}{a_1} + \\frac{r_1}{2} k^2} \\right)$。\n- 一个保范赝势应能在选定的核心半径内再现散射性质并保持价电子波函数的径向范数。在本模型中，你需要在指定能量点上施加相移匹配，并在一个低能锚点处施加零偏差和零斜率，以模拟保范约束。\n\n参考相移：\n- 将全电子参考散射视为由上述具有固定参数的有效力程形式给出。使用 $a_0 = 1.20$ (单位 bohr)，$r_0 = 2.50$ (单位 bohr)，$a_1 = 1.00$ (单位 bohr$^3$) 和 $r_1 = 1.80$ (单位 bohr)。能量单位为 Hartree，相移单位为弧度。\n\n赝势构建：\n- 你将通过定义通道 $l \\in \\{0,1\\}$ 的相移作为对参考值的微扰，来构建两种赝势，记为 $\\mathrm{PP}_A$ 和 $\\mathrm{PP}_B$：\n$$\n\\delta_l^{\\mathrm{PP}}(E; r_c) = \\delta_l^{\\mathrm{ref}}(E) + \\gamma_l(r_c)\\, h_l(E),\n$$\n其中 $r_c$ 是赝势的核心半径，$h_l(E)$ 是一个光滑的微扰多项式，$\\gamma_l(r_c)$ 是一个与硬度相关的振幅标度。在三个拟合能量点 $E_1, E_2, E_3$ 上施加匹配，使得 $h_l(E_i)=0$，并在最低能量 $E_1$ 处强制一个二重根以施加零斜率，即：\n$$\nh_l(E) = C_l \\,(E - E_1)^2 (E - E_2)(E - E_3),\n$$\n其中常数 $C_0 = 0.02$ 和 $C_1 = 0.015$。设振幅标度为\n$$\n\\gamma_l(r_c) = \\frac{c_l}{r_c^4}, \\quad c_0 = 0.12, \\quad c_1 = 0.10.\n$$\n这种构建方法确保了 $\\delta_l^{\\mathrm{PP}}(E_i; r_c) = \\delta_l^{\\mathrm{ref}}(E_i)$ 和 $\\frac{d}{dE}\\delta_l^{\\mathrm{PP}}(E_1; r_c) = \\frac{d}{dE}\\delta_l^{\\mathrm{ref}}(E_1)$，这共同模拟了在锚点能量处的保范约束。\n\n平面波截断模型：\n- 通过一个高斯包络 $|V_l(G)|^2 \\propto \\exp\\left( - (G r_c)^2 \\right)$ 来模拟赝势形状因子的倒易空间衰减，其中 $G$ 是倒易空间矢量的大小。定义超出截断值 $G_{\\mathrm{cut}}$ 的尾部占比为\n$$\nf_{\\mathrm{tail}}(G_{\\mathrm{cut}}; r_c) = \\frac{\\int_{G_{\\mathrm{cut}}}^{\\infty} 4\\pi G^2 \\exp\\left( - (G r_c)^2 \\right)\\, dG}{\\int_{0}^{\\infty} 4\\pi G^2 \\exp\\left( - (G r_c)^2 \\right)\\, dG}.\n$$\n使用标准高斯积分，该比例可简化为：\n$$\nf_{\\mathrm{tail}}(G_{\\mathrm{cut}}; r_c) = \\mathrm{erfc}(z) + \\frac{2}{\\sqrt{\\pi}} z e^{-z^2}, \\quad z = r_c\\, G_{\\mathrm{cut}},\n$$\n其中 $\\mathrm{erfc}$ 是互补误差函数。对于给定的容差 $\\varepsilon$，通过求解 $f_{\\mathrm{tail}}(G_{\\mathrm{cut}}; r_c) \\le \\varepsilon$ 来确定 $G_{\\mathrm{cut}}$。相应的平面波动能截断为\n$$\nE_{\\mathrm{cut}} = \\frac{G_{\\mathrm{cut}}^2}{2},\n$$\n单位为 Hartree。使用 $1\\,\\mathrm{Hartree} = 27.2114\\,\\mathrm{eV}$ 将 $E_{\\mathrm{cut}}$ 表示为电子伏特 (eV)。\n\n键长的可移植性误差：\n- 对于一个由价散射能量上的能量分布 $P_{\\mathrm{env}}(E)$ 以及 $s$ 和 $p$ 通道的权重 $w_0$ 和 $w_1$ 所表征的给定环境，定义一个键长误差的代理指标为：\n$$\n\\Delta R_{\\mathrm{env}}(r_c) = \\alpha \\sum_{l=0}^{1} w_l \\int_{0}^{E_{\\max}} P_{\\mathrm{env}}(E) \\left| \\delta_l^{\\mathrm{PP}}(E; r_c) - \\delta_l^{\\mathrm{ref}}(E) \\right|\\, dE,\n$$\n其中灵敏度 $\\alpha = 0.02$ (单位 angstrom per radian)，$E_{\\max} = 2.0$ (Hartree)，且 $P_{\\mathrm{env}}(E)$ 在 $[0,E_{\\max}]$ 上是归一化的。使用 $w_0 = 0.6$ 和 $w_1 = 0.4$。\n\n环境：\n- 使用三种环境，其能量分布为截断到 $[0,E_{\\max}]$ 并重新归一化的高斯分布：\n1. 类分子环境：均值 $\\mu_1 = 0.20$ (Hartree)，标准差 $\\sigma_1 = 0.10$ (Hartree)。\n2. 类离子环境：均值 $\\mu_2 = 0.60$ (Hartree)，标准差 $\\sigma_2 = 0.20$ (Hartree)。\n3. 类金属环境：均值 $\\mu_3 = 1.20$ (Hartree)，标准差 $\\sigma_3 = 0.40$ (Hartree)。\n将每个 $P_{\\mathrm{env}}(E)$ 定义为在 $[0,E_{\\max}]$ 上的归一化高斯密度。\n\n拟合能量：\n- 使用 $E_1 = 0.20$ (Hartree)，$E_2 = 0.80$ (Hartree) 和 $E_3 = 1.50$ (Hartree) 进行匹配。\n\n测试套件：\n- 提供三个测试用例，每个用例指定两个核心半径和容差：\n1. 用例 1：$r_{c,A} = 1.20$ (bohr)，$r_{c,B} = 1.80$ (bohr)，$\\varepsilon = 1.0\\times 10^{-4}$。\n2. 用例 2：$r_{c,A} = 1.00$ (bohr)，$r_{c,B} = 2.20$ (bohr)，$\\varepsilon = 1.0\\times 10^{-5}$。\n3. 用例 3：$r_{c,A} = 1.60$ (bohr)，$r_{c,B} = 1.60$ (bohr)，$\\varepsilon = 5.0\\times 10^{-5}$。\n\n计算要求：\n- 根据有效展开和赝势微扰计算 $l=0,1$ 的相移。\n- 对于每个测试用例中的每种赝势，通过求解尾部准则来确定 $E_{\\mathrm{cut}}$；将最终的平面波截断能以电子伏特 (eV) 表示。\n- 对于每个测试用例中的每种赝势，计算三种环境下的 $\\Delta R_{\\mathrm{env}}$；将键长误差以埃 (Å) 表示。使用数值积分方法，在 $[0,E_{\\max}]$ 上均匀采样 $E$，并采用足够的分辨率以确保数值稳定性。\n- 内部计算时，角度单位必须为弧度，能量单位必须为 Hartree，最终报告的 $E_{\\mathrm{cut}}$ 以电子伏特 (eV) 为单位，$\\Delta R_{\\mathrm{env}}$ 以埃 (Å) 为单位。\n\n最终输出格式：\n- 你的程序应生成一个单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，按顺序输出以下八个数字：\n1. $E_{\\mathrm{cut},A}$ (eV),\n2. $E_{\\mathrm{cut},B}$ (eV),\n3. $\\Delta R_{\\mathrm{mol},A}$ (Å),\n4. $\\Delta R_{\\mathrm{mol},B}$ (Å),\n5. $\\Delta R_{\\mathrm{ion},A}$ (Å),\n6. $\\Delta R_{\\mathrm{ion},B}$ (Å),\n7. $\\Delta R_{\\mathrm{met},A}$ (Å),\n8. $\\Delta R_{\\mathrm{met},B}$ (Å)。\n- 将所有三个测试用例的结果按相同顺序连接成一个单一的扁平列表。\n- 列表条目必须是数值浮点数。\n\n程序必须是完整的，无需外部输入即可运行。所有常数和函数都必须明确实现。请遵循上述定义以确保科学真实性。目标教育水平为计算材料科学领域的高阶研究生。代码必须用 Python 编写，且不得需要超出指定范围的任何额外库。", "solution": "该问题要求构建和评估两种具有不同核心半径 $r_{c,A}$ 和 $r_{c,B}$ 的保范赝势 $\\mathrm{PP}_A$ 和 $\\mathrm{PP}_B$。分析的核心是量化赝势设计中的基本权衡关系：由平面波动能截断能 $E_{\\mathrm{cut}}$ 代表的计算效率与由不同化学环境下的键长误差 $\\Delta R_{\\mathrm{env}}$ 作为代理指标的可移植性之间的平衡。\n\n解决方案通过遵循一系列受物理原理驱动的建模步骤来实现。除非另有说明，所有计算均在原子单位制（能量单位 Hartree，长度单位 Bohr）下进行。\n\n**1. 全电子参考散射模型**\n\n真实全电子势的散射性质通过 $s$ 波 ($l=0$) 的有效力程展开和 $p$ 波 ($l=1$) 的类似低能展开来建模，这些展开给出了散射相移 $\\delta_l^{\\mathrm{ref}}(E)$。波矢 $k$ 与能量 $E$ 的关系为 $k = \\sqrt{2E}$。\n\n对于 $s$ 波 ($l=0$)，展开式为：\n$$\nk \\cot \\delta_0^{\\mathrm{ref}}(E) = -\\frac{1}{a_0} + \\frac{r_0}{2} k^2\n$$\n对于 $p$ 波 ($l=1$)，展开式为：\n$$\nk^3 \\cot \\delta_1^{\\mathrm{ref}}(E) = -\\frac{1}{a_1} + \\frac{r_1}{2} k^2\n$$\n其中 $a_0 = 1.20\\,\\mathrm{bohr}$、$r_0 = 2.50\\,\\mathrm{bohr}$、$a_1 = 1.00\\,\\mathrm{bohr}^3$ 和 $r_1 = 1.80\\,\\mathrm{bohr}$ 分别是散射长度和有效力程参数。相移使用反正切函数的主值计算，以确保连续性，具体如下：\n$$\n\\delta_0^{\\mathrm{ref}}(E) = \\arctan\\left( \\frac{k}{-\\frac{1}{a_0} + \\frac{r_0}{2} k^2} \\right)\n$$\n$$\n\\delta_1^{\\mathrm{ref}}(E) = \\arctan\\left( \\frac{k^3}{-\\frac{1}{a_1} + \\frac{r_1}{2} k^2} \\right)\n$$\n\n**2. 赝势构建**\n\n赝势相移 $\\delta_l^{\\mathrm{PP}}(E; r_c)$ 被构建为对参考相移的微扰。这确保了赝势在特定的拟合能量点上能模拟真实势。该模型为：\n$$\n\\delta_l^{\\mathrm{PP}}(E; r_c) = \\delta_l^{\\mathrm{ref}}(E) + \\gamma_l(r_c)\\, h_l(E)\n$$\n微扰由两部分组成：\n- 一个光滑的多项式函数 $h_l(E)$，其设计使其在拟合能量点 $E_1 = 0.20$、$E_2 = 0.80$ 和 $E_3 = 1.50$ (均为 Hartree) 处为零。在 $E_1$ 处的二重根强制其导数也与参考值匹配，这是保范约束的一个关键组成部分。\n$$\nh_l(E) = C_l \\,(E - E_1)^2 (E - E_2)(E - E_3)\n$$\n其中给定常数 $C_0 = 0.02$ 和 $C_1 = 0.015$。\n- 一个与硬度相关的振幅 $\\gamma_l(r_c)$，它随核心半径 $r_c$ 缩放。较小的 $r_c$（一个“更硬”的势）意味着在远离拟合能量点的地方有更大的微扰。\n$$\n\\gamma_l(r_c) = \\frac{c_l}{r_c^4}\n$$\n其中常数 $c_0 = 0.12$ 和 $c_1 = 0.10$。\n\n**3. 平面波截断能 ($E_{\\mathrm{cut}}$)**\n\n平面波计算的计算成本主要由动能截断能 $E_{\\mathrm{cut}}$ 决定。该截断能与赝势在实空间的平滑度有关。一个更平滑的势（较大的 $r_c$）在倒易空间中衰减得更快，因此需要一个较低的 $E_{\\mathrm{cut}}$。这种关系通过假设赝势的形状因子按高斯函数衰减来建模，即 $|V_l(G)|^2 \\propto \\exp\\left( - (G r_c)^2 \\right)$，其中 $G$ 是倒易空间矢量的大小。\n\n所需的倒易空间截断值 $G_{\\mathrm{cut}}$ 是通过确保势在 $G_{\\mathrm{cut}}$ 之外的“尾部”占比小于指定的容差 $\\varepsilon$ 来确定的。该尾部占比由下式给出：\n$$\nf_{\\mathrm{tail}}(G_{\\mathrm{cut}}; r_c) = \\mathrm{erfc}(z) + \\frac{2}{\\sqrt{\\pi}} z e^{-z^2}, \\quad \\text{其中 } z = r_c\\, G_{\\mathrm{cut}}\n$$\n我们必须数值求解非线性方程 $f_{\\mathrm{tail}}(z) = \\varepsilon$ 以得到变量 $z$。为此，我们采用了一个求根算法，具体为 Brent's method，利用了 $f_{\\mathrm{tail}}(z)$ 在 $z > 0$ 时是一个单调递减函数这一事实。一旦找到解 $z^*$，我们便可得到 $G_{\\mathrm{cut}} = z^* / r_c$。相应的平面波动能截断能为：\n$$\nE_{\\mathrm{cut}} = \\frac{G_{\\mathrm{cut}}^2}{2}\n$$\n这个值以 Hartree 计算，然后转换为电子伏特 ($1\\,\\mathrm{Hartree} = 27.2114\\,\\mathrm{eV}$)。\n\n**4. 可移植性误差 ($\\Delta R_{\\mathrm{env}}$)**\n\n赝势的可移植性评估其在不同于拟合环境的化学环境中的准确性。我们使用一个预测键长误差的代理指标 $\\Delta R_{\\mathrm{env}}$，它被定义为赝势相移与参考相移之间绝对差值在一个能量范围内的加权积分。\n$$\n\\Delta R_{\\mathrm{env}}(r_c) = \\alpha \\sum_{l=0}^{1} w_l \\int_{0}^{E_{\\max}} P_{\\mathrm{env}}(E) \\left| \\delta_l^{\\mathrm{PP}}(E; r_c) - \\delta_l^{\\mathrm{ref}}(E) \\right|\\, dE\n$$\n给定的参数为 $\\alpha = 0.02\\,\\mathrm{Å/rad}$、$w_0 = 0.6$、$w_1 = 0.4$ 和 $E_{\\max} = 2.0\\,\\mathrm{H}$。项 $|\\delta_l^{\\mathrm{PP}} - \\delta_l^{\\mathrm{ref}}|$ 可简化为 $|\\gamma_l(r_c) h_l(E)|$。误差的表达式可以重构，将依赖于 $r_c$ 的部分与积分分离开来：\n$$\n\\Delta R_{\\mathrm{env}}(r_c) = \\frac{\\alpha}{r_c^4} \\sum_{l=0}^{1} w_l c_l J_{l, \\mathrm{env}} \\quad \\text{其中} \\quad J_{l, \\mathrm{env}} = \\int_{0}^{E_{\\max}} P_{\\mathrm{env}}(E) |h_l(E)|\\, dE\n$$\n能量分布 $P_{\\mathrm{env}}(E)$ 针对三种不同的环境（类分子、类离子、类金属）进行建模，使用一个由均值 $\\mu$ 和标准差 $\\sigma$ 定义的高斯分布，该分布被截断到区间 $[0, E_{\\max}]$ 并随后重新归一化。与 $r_c$ 无关的积分 $J_{l, \\mathrm{env}}$，对于每种环境都通过数值积分（在精细能量网格上使用梯形法则）预先计算。有了这些积分，就可以为任意给定的 $r_c$ 高效地计算 $\\Delta R_{\\mathrm{env}}(r_c)$。\n\n**5. 计算执行**\n\n整个计算流程包括：\n1. 针对三种指定环境（类分子、类离子、类金属）预先计算固定积分 $J_{l, \\mathrm{env}}$。\n2. 遍历每个测试用例，每个用例提供了 $r_{c,A}$、$r_{c,B}$ 和截断容差 $\\varepsilon$ 的值。\n3. 对于每种赝势（$\\mathrm{PP}_A$ 和 $\\mathrm{PP}_B$），通过数值求解 $G_{\\mathrm{cut}}$ 来计算 $E_{\\mathrm{cut}}$，然后将其转换为能量。\n4. 对于每种赝势，使用预先计算的积分计算三种环境下的可移植性误差 $\\Delta R_{\\mathrm{env}}$。\n5. 整理每个测试用例的八个结果值，并将它们格式化为指定的输出字符串。\n此流程系统地根据定义的度量标准来评估所构建的赝势。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erfc, erf\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to construct, evaluate, and compare pseudopotentials.\n    \"\"\"\n    # Define physical constants and model parameters\n    HARTREE_TO_EV = 27.2114\n\n    # Reference scattering parameters (all in atomic units)\n    A0, R0 = 1.20, 2.50  # s-wave (l=0)\n    A1, R1 = 1.00, 1.80  # p-wave (l=1)\n\n    # Pseudopotential construction parameters\n    C_L = {0: 0.02, 1: 0.015}\n    C_l = {0: 0.12, 1: 0.10}\n    E1, E2, E3 = 0.20, 0.80, 1.50\n\n    # Transferability error parameters\n    ALPHA = 0.02\n    EMAX = 2.0\n    W_L = {0: 0.6, 1: 0.4}\n\n    # Environment parameters (mu, sigma) in Hartree\n    ENVIRONMENTS = {\n        'mol': (0.20, 0.10),\n        'ion': (0.60, 0.20),\n        'met': (1.20, 0.40)\n    }\n\n    # Numerical integration parameters\n    N_PTS = 2001\n    E_GRID = np.linspace(0, EMAX, N_PTS)\n\n    # Test cases: (rc_A, rc_B, epsilon)\n    test_cases = [\n        (1.20, 1.80, 1.0e-4),\n        (1.00, 2.20, 1.0e-5),\n        (1.60, 1.60, 5.0e-5),\n    ]\n\n    def h_l(E, l):\n        \"\"\"Calculates the perturbation polynomial h_l(E).\"\"\"\n        return C_L[l] * (E - E1)**2 * (E - E2) * (E - E3)\n\n    def gamma_l(rc, l):\n        \"\"\"Calculates the scaling amplitude gamma_l(rc).\"\"\"\n        return C_l[l] / rc**4\n\n    def calculate_Ecut(rc, epsilon):\n        \"\"\"Calculates the plane-wave cutoff energy E_cut in eV.\"\"\"\n        \n        def f_tail_minus_eps(z):\n            \"\"\"Function whose root needs to be found: f_tail(z) - epsilon.\"\"\"\n            if z < 0: return 1.0 - epsilon # Domain is z >= 0\n            return erfc(z) + (2.0 / np.sqrt(np.pi)) * z * np.exp(-z**2) - epsilon\n\n        # Brent's method to find the root z* of f_tail(z) = epsilon\n        # Bracket [0.01, 8.0] is safe as f(0.01) > 0 and f(8) < 0 for relevant epsilon.\n        try:\n            z_star = brentq(f_tail_minus_eps, 0.01, 8.0)\n        except ValueError:\n            # Fallback for extreme epsilon values, though not expected here\n            if epsilon >= 1.0: return 0.0 # No cutoff needed\n            z_star = 0.0\n\n        G_cut = z_star / rc\n        E_cut_H = G_cut**2 / 2.0\n        return E_cut_H * HARTREE_TO_EV\n\n    def get_J_integrals(env_params):\n        \"\"\"Pre-calculates the transferability integrals J_l for a given environment.\"\"\"\n        mu, sigma = env_params\n        \n        # Renormalized truncated Gaussian probability distribution P_env(E)\n        unnorm_P = (1.0 / (sigma * np.sqrt(2.0 * np.pi))) * np.exp(-((E_GRID - mu)**2) / (2.0 * sigma**2))\n        \n        norm_const = 0.5 * (erf((EMAX - mu) / (sigma * np.sqrt(2.0))) - erf(-mu / (sigma * np.sqrt(2.0))))\n        \n        if norm_const < 1e-15: # Effectively zero probability in the domain\n            return 0.0, 0.0\n\n        P_env = unnorm_P / norm_const\n        \n        # Calculate integrals J_0 and J_1 using the trapezoidal rule\n        h0_vals = h_l(E_GRID, 0)\n        h1_vals = h_l(E_GRID, 1)\n        \n        integrand0 = P_env * np.abs(h0_vals)\n        integrand1 = P_env * np.abs(h1_vals)\n        \n        J0 = np.trapz(integrand0, E_GRID)\n        J1 = np.trapz(integrand1, E_GRID)\n        \n        return J0, J1\n\n    def calculate_delta_R(rc, j_integrals):\n        \"\"\"Calculates the bond length error proxy Delta_R.\"\"\"\n        J0, J1 = j_integrals\n        \n        # gamma is positive, so abs(gamma) = gamma\n        g0 = gamma_l(rc, 0)\n        g1 = gamma_l(rc, 1)\n        \n        delta_R = ALPHA * (W_L[0] * g0 * J0 + W_L[1] * g1 * J1)\n        return delta_R\n\n    # --- Main Calculation Loop ---\n    results = []\n    \n    # Pre-calculate J integrals for each environment\n    j_integrals_all_envs = {name: get_J_integrals(params) for name, params in ENVIRONMENTS.items()}\n\n    for rc_A, rc_B, epsilon in test_cases:\n        # --- Calculations for Pseudopotential A ---\n        Ecut_A = calculate_Ecut(rc_A, epsilon)\n        delta_R_mol_A = calculate_delta_R(rc_A, j_integrals_all_envs['mol'])\n        delta_R_ion_A = calculate_delta_R(rc_A, j_integrals_all_envs['ion'])\n        delta_R_met_A = calculate_delta_R(rc_A, j_integrals_all_envs['met'])\n        \n        # --- Calculations for Pseudopotential B ---\n        Ecut_B = calculate_Ecut(rc_B, epsilon)\n        delta_R_mol_B = calculate_delta_R(rc_B, j_integrals_all_envs['mol'])\n        delta_R_ion_B = calculate_delta_R(rc_B, j_integrals_all_envs['ion'])\n        delta_R_met_B = calculate_delta_R(rc_B, j_integrals_all_envs['met'])\n        \n        results.extend([\n            Ecut_A, Ecut_B,\n            delta_R_mol_A, delta_R_mol_B,\n            delta_R_ion_A, delta_R_ion_B,\n            delta_R_met_A, delta_R_met_B,\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3470115"}]}