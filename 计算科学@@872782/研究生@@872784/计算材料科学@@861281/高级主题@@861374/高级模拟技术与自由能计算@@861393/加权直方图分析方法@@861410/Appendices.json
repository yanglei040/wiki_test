{"hands_on_practices": [{"introduction": "本节的第一个实践是一个关键的健全性检验。通过将加权直方图分析方法（WHAM）的形式化理论应用于最简单的情景——合并多个无偏置的模拟数据，我们可以验证它是否能正确地简化为统计上最优的直观操作，即汇集所有数据。这个练习将巩固你对 WHAM 核心方程及其基本含义的理解。[@problem_id:2465761]", "problem": "考虑应用加权直方图分析方法 (WHAM; Weighted Histogram Analysis Method) 来合并来自多个独立的、无偏的分子模拟的数据。假设对同一系统，在温度 $T$ 下进行了 $M$ 次独立的正则系综模拟，所有模拟都没有沿着反应坐标 $\\xi$ 施加任何外部偏置。每次模拟 $i \\in \\{1,\\dots,M\\}$ 都会在 $K$ 个离散的区间 $\\{\\xi_k\\}_{k=1}^K$ 上生成 $\\xi$ 的直方图，其计数为 $n_i(\\xi_k)$，总帧数为 $N_i = \\sum_{k=1}^K n_i(\\xi_k)$。假设样本是有效不相关的，并且所有模拟都对相同的平衡分布进行采样，因为它们共享相同的哈密顿量、温度且没有偏置。\n\nWHAM 引入了每次模拟的自由能偏移量 $F_i$（无量纲，即以 $k_{\\mathrm{B}}T$ 为单位），并返回平均力势 (PMF) $W(\\xi)$ 的估计值，根据定义，$W(\\xi) = -k_{\\mathrm{B}}T \\ln p(\\xi) + C$，其中 $C$ 是任意常数，$p(\\xi)$ 是沿 $\\xi$ 的平衡概率密度。\n\n在这种无偏的、相同系综的设置下，哪个选项最能预测 WHAM 的输出 $F_i$ 和最终的 PMF $W(\\xi)$？\n\nA. 所有的 $F_i$ 在相差一个共同的加性常数的情况下是相等的（例如，按照惯例它们都可以设为 $0$），并且 $W(\\xi)$ 是从合并的直方图 $p(\\xi_k) = \\left(\\sum_{i=1}^M n_i(\\xi_k)\\right)\\Big/\\left(\\sum_{i=1}^M N_i\\right)$ 构建的 PMF，即 $W(\\xi_k) = -k_{\\mathrm{B}}T \\ln\\left[\\left(\\sum_{i=1}^M n_i(\\xi_k)\\right)\\Big/\\left(\\sum_{i=1}^M N_i\\right)\\right] + C$。\n\nB. 偏移量满足 $F_i = -\\ln N_i + \\text{const}$，因此较短的模拟获得较大的权重，并且 $W(\\xi)$ 是每次模拟 PMF 的算术平均值，$W(\\xi_k) = \\frac{1}{M}\\sum_{i=1}^M\\left[-k_{\\mathrm{B}}T \\ln\\left(n_i(\\xi_k)/N_i\\right)\\right] + C$。\n\nC. 偏移量满足 $F_i = \\ln N_i + \\text{const}$，因此较长的模拟获得较大的偏移量，并且 $W(\\xi)$ 是从合并的直方图构建的，但通过分母中的 $N_i^2$ 进行加权。\n\nD. 所有的 $F_i$ 都是任意的且不收敛，并且 $W(\\xi)$ 等于从任何单个轨迹而不是从组合数据估计的 PMF，因此合并运行除了一个整体常数外，不会改变 PMF。", "solution": "首先对问题陈述进行严格验证，以确保其科学和逻辑上的合理性。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n*   **方法**：加权直方图分析方法 (WHAM)。\n*   **系统**：对同一系统在相同温度 $T$ 下进行的 $M$ 次独立的正则系综模拟。\n*   **偏置**：所有模拟都没有沿着反应坐标 $\\xi$ 施加任何外部偏置。这意味着对于所有模拟 $i \\in \\{1,\\dots,M\\}$，偏置势能为 $V_i(\\xi) = 0$。\n*   **数据**：对于每次模拟 $i$，在 $K$ 个离散的区间 $\\{\\xi_k\\}_{k=1}^K$ 上收集了 $\\xi$ 的直方图。模拟 $i$ 在区间 $\\xi_k$ 中的计数为 $n_i(\\xi_k)$。模拟 $i$ 的总帧数为 $N_i = \\sum_{k=1}^K n_i(\\xi_k)$。\n*   **假设**：样本是有效不相关的。所有模拟都对相同的平衡分布进行采样。\n*   **输出**：WHAM 产生每次模拟的无量纲自由能偏移量 $F_i$（以 $k_{\\mathrm{B}}T$ 为单位）和平均力势 (PMF) $W(\\xi)$ 的估计。\n*   **定义**：PMF 由 $W(\\xi) = -k_{\\mathrm{B}}T \\ln p(\\xi) + C$ 定义，其中 $p(\\xi)$ 是平衡概率密度，$C$ 是任意常数。对于离散坐标，这表示为 $W(\\xi_k) = -k_{\\mathrm{B}}T \\ln p(\\xi_k) + C$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n1.  **科学依据**：该问题在统计力学和计算化学的原理上有坚实的基础。WHAM 是一种标准的、成熟的方法。\n2.  **适定性**：该问题是适定的。它描述了一个具体的、可解的情景（合并来自相同的、无偏的模拟的数据），并要求得到一个已定义算法 (WHAM) 的输出。\n3.  **客观性**：语言技术性强且精确，没有主观或模糊的陈述干扰形式化分析。\n4.  **缺陷**：问题陈述没有违反任何基本原理，不是不完整或矛盾的，并且呈现了一个可行的情景。这个设置是分析 WHAM 行为的典型案例。\n\n**步骤3：结论与行动**\n\n问题陈述是**有效的**。将根据 WHAM 的基本方程推导解答。\n\n### 解答推导\n\n加权直方图分析方法 (WHAM) 提供了一组自洽方程来确定无偏的概率分布 $p(\\xi)$ 和模拟的自由能 $F_i$。让我们将模拟 $i$ 在区间 $\\xi_k$ 中的无量纲偏置势表示为 $U_i(\\xi_k) = V_i(\\xi_k) / (k_{\\mathrm{B}}T)$。问题陈述中说明没有偏置，所以对于所有的 $i$ 和 $k$，$U_i(\\xi_k) = 0$。\n\nWHAM 的两个核心自洽方程是：\n1.  在无偏系综中，观察到系统处于区间 $\\xi_k$ 的估计概率由以下公式给出：\n    $$p(\\xi_k) = \\frac{\\sum_{i=1}^M n_i(\\xi_k)}{\\sum_{j=1}^M N_j \\exp(F_j - U_j(\\xi_k))}$$\n2.  模拟 $i$ 的自由能偏移量 $F_i$ 由一致性条件确定：\n    $$\\exp(-F_i) = \\sum_{k=1}^K p(\\xi_k) \\exp(-U_i(\\xi_k))$$\n\n我们现在应用这个问题的特定条件，即所有模拟都是无偏的，即对所有的 $i, k$ 都有 $U_i(\\xi_k) = 0$。\n\n在此条件下，WHAM 方程显著简化。\n方程 (2) 变为：\n$$ \\exp(-F_i) = \\sum_{k=1}^K p(\\xi_k) \\exp(-0) = \\sum_{k=1}^K p(\\xi_k) $$\n由于 $p(\\xi_k)$ 是 $K$ 个区间上的概率分布，它必须是归一化的，即 $\\sum_{k=1}^K p(\\xi_k) = 1$。因此，对于每次模拟 $i$：\n$$ \\exp(-F_i) = 1 $$\n这意味着对于所有的 $i \\in \\{1, \\dots, M\\}$，都有 $F_i = 0$。\n\n更一般地，自由能 $F_i$ 仅在相差一个集体加性常数的情况下是确定的。如果我们对所有 $i$ 都有 $F_i = C$，则方程 (2) 给出 $\\exp(-C) = \\sum_k p(\\xi_k)$。而方程 (1) 变为 $p(\\xi_k) = (\\sum_i n_i(\\xi_k)) / (\\exp(C) \\sum_j N_j)$。将这个 $p(\\xi_k)$ 对 $k$ 求和得到 $\\sum_k p(\\xi_k) = (\\sum_i N_i) / (\\exp(C) \\sum_j N_j) = \\exp(-C)$。这是一个恒等式，$\\exp(-C) = \\exp(-C)$，意味着任何常数 $C$ 都是一个有效的解。因此，所有的 $F_i$ 必须彼此相等，$F_1=F_2=\\dots=F_M$。按照惯例，可以通过将其中一个自由能设为零（例如 $F_1=0$）来固定参考，这意味着所有自由能都必须为零。所以，“所有的 $F_i$ 在相差一个共同的加性常数的情况下是相等的”是正确的陈述，并将它们全部设为 $0$ 是一个有效且常见的选择。\n\n现在，我们将 $F_j=0$ 和 $U_j(\\xi_k)=0$ 代入方程 (1)：\n$$ p(\\xi_k) = \\frac{\\sum_{i=1}^M n_i(\\xi_k)}{\\sum_{j=1}^M N_j \\exp(0 - 0)} = \\frac{\\sum_{i=1}^M n_i(\\xi_k)}{\\sum_{j=1}^M N_j} $$\n这个 $p(\\xi_k)$ 的表达式就是归一化的合并直方图，其中所有模拟的计数被加总，然后除以所有模拟的总样本数。这是从完全相同分布的多次采样中合并数据的统计最优方法。\n\n最后，我们使用给出的定义计算 PMF $W(\\xi_k)$：\n$$ W(\\xi_k) = -k_{\\mathrm{B}}T \\ln p(\\xi_k) + C $$\n代入我们推导出的 $p(\\xi_k)$ 表达式：\n$$ W(\\xi_k) = -k_{\\mathrm{B}}T \\ln\\left( \\frac{\\sum_{i=1}^M n_i(\\xi_k)}{\\sum_{j=1}^M N_j} \\right) + C $$\n这是直接从所有模拟的合并数据计算出的 PMF。\n\n### 逐项分析\n\n**A. 所有的 $F_i$ 在相差一个共同的加性常数的情况下是相等的（例如，按照惯例它们都可以设为 $0$），并且 $W(\\xi)$ 是从合并的直方图 $p(\\xi_k) = \\left(\\sum_{i=1}^M n_i(\\xi_k)\\right)\\Big/\\left(\\sum_{i=1}^M N_i\\right)$ 构建的 PMF，即 $W(\\xi_k) = -k_{\\mathrm{B}}T \\ln\\left[\\left(\\sum_{i=1}^M n_i(\\xi_k)\\right)\\Big/\\left(\\sum_{i=1}^M N_i\\right)\\right] + C$。**\n这个陈述与我们的推导完全吻合。关于自由能偏移量 $F_i$ 的结论和 PMF $W(\\xi_k)$ 的表达式都是正确的。\n**结论：正确。**\n\n**B. 偏移量满足 $F_i = -\\ln N_i + \\text{const}$，因此较短的模拟获得较大的权重，并且 $W(\\xi)$ 是每次模拟 PMF 的算术平均值，$W(\\xi_k) = \\frac{1}{M}\\sum_{i=1}^M\\left[-k_{\\mathrm{B}}T \\ln\\left(n_i(\\xi_k)/N_i\\right)\\right] + C$。**\n这是不正确的。我们的推导表明所有的 $F_i$ 都相等，不依赖于 $N_i$。此外，取各个 PMF 的算术平均值在统计上是次优的，也不是 WHAM 所规定的。它错误地给予了长模拟和短模拟相等的权重。\n**结论：不正确。**\n\n**C. 偏移量满足 $F_i = \\ln N_i + \\text{const}$，因此较长的模拟获得较大的偏移量，并且 $W(\\xi)$ 是从合并的直方图构建的，但通过分母中的 $N_i^2$ 进行加权。**\n这是不正确的。偏移量 $F_i$ 都相等。在 WHAM 中，每次模拟的权重与其长度 $N_i$ 成正比，而不是 $N_i^2$。这种提出的形式与 WHAM 方程不一致。\n**结论：不正确。**\n\n**D. 所有的 $F_i$ 都是任意的且不收敛，并且 $W(\\xi)$ 等于从任何单个轨迹而不是从组合数据估计的 PMF，因此合并运行除了一个整体常数外，不会改变 PMF。**\n这在多个方面都是不正确的。$F_i$ 确实会收敛到一个明确定义的解（它们都相等）。PMF 是从任何单个轨迹估计的说法是错误的；WHAM 的设计旨在优化地组合所有轨迹的数据，从而提高统计精度。认为合并数据除了一个任意常数外没有任何好处，这与统计学的基本原理相矛盾。\n**结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "2465761"}, {"introduction": "一次成功的 WHAM 分析在很大程度上取决于输入数据的质量。本实践聚焦于伞形采样的关键“实验设计”阶段：如何策略性地选择偏置势，以确保相邻窗口之间有足够的统计重叠。你将学习如何利用对体系平均力势（PMF）曲率的先验知识来设计谐波限制势，从而在整个反应坐标上获得均匀的采样质量。[@problem_id:3503120]", "problem": "在加权直方图分析方法（WHAM）中，要可靠地重建平均力势，关键在于设计伞形采样窗口，使其沿选定的扩散坐标具有充分的统计重叠。考虑一个一维扩散坐标 $x$，其平均力势 $F(x)$ 的全局形式未知，但在选定的窗口中心附近具有已知的局域曲率 $F''(x)$。你需要设计谐波伞形窗口 $W_i(x)=\\frac{1}{2}k_i\\left(x-x_i^0\\right)^{2}$，以实现相邻直方图之间的均匀重叠。\n\n假设以下科学上真实的设置：\n- 温度为 $T$，玻尔兹曼常数为 $k_{B}$，且 $\\beta=1/(k_{B}T)$。\n- 平均力势的局域曲率为 $F''(x)=\\left(25+10x^{2}\\right)\\,\\frac{k_{B}T}{\\mathrm{nm}^{2}}$，其中 $x$ 的单位为 $\\mathrm{nm}$。\n- 需要覆盖的扩散坐标范围是 $x\\in[-0.9,0.9]\\,\\mathrm{nm}$。\n- 你将放置 $N=7$ 个窗口，其中心 $x_i^0$ 在该范围内均匀分布。\n- 你将为组合的二次近似选择一个恒定的目标有效曲率 $\\kappa^{\\ast}$，定义为 $\\kappa_i=F''(x_i^0)+k_i$，使得对所有 $i$ 都有 $\\kappa_i=\\kappa^{\\ast}$。\n- 在此工作体系中，假设 $F(x)$ 在每个 $x_i^0$ 附近的泰勒展开的局域线性项与伞形限制相比可以忽略不计，因此 $p_i(x)\\propto\\exp\\left[-\\beta\\left(F(x)+W_i(x)\\right)\\right]$ 的峰值约在 $x_i^0$ 处，并且每个窗口中的采样分布可以很好地用一个方差为 $\\sigma^{2}=\\frac{k_{B}T}{\\kappa^{\\ast}}$ 的高斯分布来近似。\n\n任务：\n1. 使用统计力学原理和 $F(x)+W_i(x)$ 在每个 $x_i^0$ 附近的谐波近似，推导出 $k_i$ 关于 $\\kappa^{\\ast}$ 和 $F''(x_i^0)$ 的设计规则。然后，对于 $\\kappa^{\\ast}=50\\,\\frac{k_{B}T}{\\mathrm{nm}^{2}}$，指定范围内的 $x_i^0$ 集合及相应的 $k_i$ 值。\n2. 将两个相邻窗口 $i$ 和 $i+1$ 之间的重叠定义为重叠系数 $O$，其值为它们的归一化概率密度的逐点最小值的面积，即 $O=\\int_{-\\infty}^{\\infty}\\min\\left(p_i(x),p_{i+1}(x)\\right)\\,\\mathrm{d}x$。在上述假设下，利用你的设计所蕴含的均匀间距和恒定方差，计算任意两个相邻窗口之间的预期重叠 $O$。将最终的重叠表示为一个纯数（无量纲），并将答案四舍五入到四位有效数字。\n\n仅在需要证明热力学关系时使用 $T=300\\,\\mathrm{K}$；但请注意，所提供的曲率已经以 $k_{B}T/\\mathrm{nm}^{2}$ 为单位进行了缩放，因此你最终的重叠结果不需要转换为焦耳。你的最终答案必须是一个实数值。将答案四舍五入到四位有效数字。", "solution": "用户希望我解决一个关于加权直方图分析方法（WHAM）中伞形采样窗口设计的问题。\n\n### 步骤 1：提取给定条件\n-   平均力势用 $F(x)$ 表示。\n-   一维扩散坐标为 $x$。\n-   伞形窗口具有谐波形式：$W_i(x)=\\frac{1}{2}k_i\\left(x-x_i^0\\right)^{2}$。\n-   温度为 $T$，玻尔兹曼常数为 $k_{B}$，且 $\\beta=1/(k_{B}T)$。\n-   平均力势的局域曲率由 $F''(x)=\\left(25+10x^{2}\\right)\\,\\frac{k_{B}T}{\\mathrm{nm}^{2}}$ 给出，其中 $x$ 的单位为 $\\mathrm{nm}$。\n-   需要覆盖的扩散坐标范围是 $x\\in[-0.9,0.9]\\,\\mathrm{nm}$。\n-   窗口数量为 $N=7$。\n-   窗口中心 $x_i^0$ 在指定范围内均匀分布。\n-   为组合势选择了一个恒定的目标有效曲率 $\\kappa^{\\ast}$，定义为 $\\kappa_i=F''(x_i^0)+k_i$，使得对所有 $i$ 都有 $\\kappa_i=\\kappa^{\\ast}$。\n-   目标有效曲率的值为 $\\kappa^{\\ast}=50\\,\\frac{k_{B}T}{\\mathrm{nm}^{2}}$。\n-   每个窗口中的概率分布 $p_i(x)\\propto\\exp\\left[-\\beta\\left(F(x)+W_i(x)\\right)\\right]$ 近似为以 $x_i^0$ 为中心、方差为 $\\sigma^{2}=\\frac{k_{B}T}{\\kappa^{\\ast}}$ 的高斯分布。\n-   相邻窗口间的重叠系数定义为 $O=\\int_{-\\infty}^{\\infty}\\min\\left(p_i(x),p_{i+1}(x)\\right)\\,\\mathrm{d}x$。\n\n### 步骤 2：使用提取的给定条件进行验证\n-   **科学依据**：该问题基于统计力学和计算化学的标准原理，特别是伞形采样和WHAM背后的理论。势的谐波近似和概率分布的高斯模型在此背景下是标准且有效的。所有物理量及其单位都是适当的。\n-   **问题定义明确**：问题陈述清晰，并提供了所有必要的信息和约束以得出唯一解。诸如分布的高斯形式和PMF展开中可忽略的线性项等假设，使得该问题可以解析求解。\n-   **客观性**：问题以精确、客观的语言表述，不含任何主观或基于意见的陈述。\n-   **完整性与一致性**：问题是自洽的。所提供的数据是一致的。为使谐波常数 $k_i$ 具有物理意义（即为正值），必须对所有 $i$ 满足 $\\kappa^{\\ast}  F''(x_i^0)$。$F''(x)$ 的最大值出现在区间的边界处，即 $x=\\pm 0.9\\,\\mathrm{nm}$。在这些点上，$F''(x=\\pm 0.9) = (25+10(0.9)^2)\\frac{k_B T}{\\mathrm{nm}^2} = (25+8.1)\\frac{k_B T}{\\mathrm{nm}^2} = 33.1\\,\\frac{k_B T}{\\mathrm{nm}^2}$。由于 $\\kappa^{\\ast}=50\\,\\frac{k_B T}{\\mathrm{nm}^2}$ 大于 $33.1\\,\\frac{k_B T}{\\mathrm{nm}^2}$，因此所有弹簧常数 $k_i$ 都将为正值。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n\n问题分为两个任务。我们首先解决伞形采样窗口的设计问题，然后计算它们之间的重叠。\n\n**任务1：伞形窗口的设计规则和参数**\n\n在窗口 $i$ 中系统经历的总势能为 $U_i(x) = F(x) + W_i(x)$。我们被告知，在一个 $U_i(x)$ 在窗口中心 $x_i^0$ 附近的二次近似有效的体系中进行计算。我们对平均力势 $F(x)$ 在 $x_i^0$ 附近进行泰勒展开：\n$$F(x) \\approx F(x_i^0) + F'(x_i^0)(x-x_i^0) + \\frac{1}{2}F''(x_i^0)(x-x_i^0)^2$$\n问题陈述指明线性项 $F'(x_i^0)(x-x_i^0)$ 可被视为可以忽略不计。因此，总势能近似为：\n$$U_i(x) \\approx F(x_i^0) + \\frac{1}{2}F''(x_i^0)(x-x_i^0)^2 + \\frac{1}{2}k_i(x-x_i^0)^2$$\n$$U_i(x) \\approx F(x_i^0) + \\frac{1}{2}\\left(F''(x_i^0) + k_i\\right)(x-x_i^0)^2$$\n坐标 $x$ 在窗口 $i$ 中的概率分布由玻尔兹曼分布给出，$p_i(x) \\propto \\exp(-\\beta U_i(x))$：\n$$p_i(x) \\propto \\exp\\left(-\\beta F(x_i^0)\\right) \\exp\\left(-\\frac{\\beta}{2}\\left(F''(x_i^0) + k_i\\right)(x-x_i^0)^2\\right)$$\n这是一个以 $x_i^0$ 为中心的高斯分布。问题将有效曲率定义为 $\\kappa_i = F''(x_i^0) + k_i$。设计准则是该曲率对所有窗口都为常数，即 $\\kappa_i = \\kappa^{\\ast}$。由此，我们推导出谐波弹簧常数 $k_i$ 的设计规则：\n$$k_i = \\kappa^{\\ast} - F''(x_i^0)$$\n这就完成了任务1的推导部分。\n\n接下来，我们计算 $N=7$ 个窗口的具体值。中心 $x_i^0$ 在区间 $[-0.9, 0.9]\\,\\mathrm{nm}$ 内均匀分布。中心之间的间距为 $\\Delta x = \\frac{0.9 - (-0.9)}{N-1} = \\frac{1.8}{6} = 0.3\\,\\mathrm{nm}$。\n窗口中心为，对于 $i=1, \\dots, 7$：\n$x_1^0 = -0.9\\,\\mathrm{nm}$\n$x_2^0 = -0.6\\,\\mathrm{nm}$\n$x_3^0 = -0.3\\,\\mathrm{nm}$\n$x_4^0 = 0.0\\,\\mathrm{nm}$\n$x_5^0 = 0.3\\,\\mathrm{nm}$\n$x_6^0 = 0.6\\,\\mathrm{nm}$\n$x_7^0 = 0.9\\,\\mathrm{nm}$\n\n现在，我们使用 $\\kappa^{\\ast}=50\\,\\frac{k_{B}T}{\\mathrm{nm}^{2}}$ 计算每个窗口的局域PMF曲率 $F''(x_i^0)$ 和所需的弹簧常数 $k_i$。$F''$ 和 $k_i$ 的单位是 $\\frac{k_B T}{\\mathrm{nm}^2}$。\n\n$i=1,7$：$x^0 = \\pm 0.9 \\implies (x^0)^2=0.81$。$F''(x^0) = 25+10(0.81) = 33.1$。$k_{1,7} = 50 - 33.1 = 16.9$。\n$i=2,6$：$x^0 = \\pm 0.6 \\implies (x^0)^2=0.36$。$F''(x^0) = 25+10(0.36) = 28.6$。$k_{2,6} = 50 - 28.6 = 21.4$。\n$i=3,5$：$x^0 = \\pm 0.3 \\implies (x^0)^2=0.09$。$F''(x^0) = 25+10(0.09) = 25.9$。$k_{3,5} = 50 - 25.9 = 24.1$。\n$i=4$：$x^0 = 0.0 \\implies (x^0)^2=0.0$。$F''(x^0) = 25+10(0) = 25.0$。$k_4 = 50 - 25.0 = 25.0$。\n\n**任务2：重叠计算**\n\n该设计确保了所有窗口具有相同的有效曲率 $\\kappa^{\\ast}$。每个窗口 $i$ 的概率分布 $p_i(x)$ 是一个归一化的高斯分布，其均值为 $x_i^0$，方差为 $\\sigma^2 = \\frac{k_B T}{\\kappa^{\\ast}}$：\n$$p_i(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x - x_i^0)^2}{2\\sigma^2}\\right)$$\n两个相邻窗口 $i$ 和 $i+1$ 之间的重叠 $O$ 由 $O=\\int_{-\\infty}^{\\infty}\\min\\left(p_i(x),p_{i+1}(x)\\right)\\,\\mathrm{d}x$ 给出。\n\n设中心为 $x_i^0$ 和 $x_{i+1}^0$。当两个分布的指数相等时，它们的值也相等：\n$(x-x_i^0)^2 = (x-x_{i+1}^0)^2$。此方程在中点 $x_c = \\frac{x_i^0+x_{i+1}^0}{2}$ 处成立。\n对于 $x  x_c$，$x$ 距离 $x_i^0$ 比距离 $x_{i+1}^0$ 更近，因此 $|x-x_i^0|  |x-x_{i+1}^0|$，这意味着 $p_i(x)  p_{i+1}(x)$。因此，对于 $x  x_c$，$\\min(p_i, p_{i+1}) = p_{i+1}(x)$。\n对于 $x > x_c$，$x$ 距离 $x_{i+1}^0$ 比距离 $x_i^0$ 更近，因此 $|x-x_{i+1}^0|  |x-x_i^0|$，这意味着 $p_{i+1}(x)  p_i(x)$。因此，对于 $x > x_c$，$\\min(p_i, p_{i+1}) = p_i(x)$。\n\n因此，重叠积分为：\n$$O = \\int_{-\\infty}^{x_c} p_{i+1}(x)\\,\\mathrm{d}x + \\int_{x_c}^{\\infty} p_i(x)\\,\\mathrm{d}x$$\n令 $\\Phi(z)$ 为标准正态分布 $N(0,1)$ 的累积分布函数（CDF）。正态分布 $N(\\mu, \\sigma^2)$ 的CDF为 $F(x) = \\Phi\\left(\\frac{x-\\mu}{\\sigma}\\right)$。\n第一个积分是 $p_{i+1}(x)$ 在 $x_c$ 处的CDF值：\n$$\\int_{-\\infty}^{x_c} p_{i+1}(x)\\,\\mathrm{d}x = \\Phi\\left(\\frac{x_c - x_{i+1}^0}{\\sigma}\\right)$$\n第二个积分是 $1$ 减去 $p_i(x)$ 在 $x_c$ 处的CDF值：\n$$\\int_{x_c}^{\\infty} p_i(x)\\,\\mathrm{d}x = 1 - \\Phi\\left(\\frac{x_c - x_i^0}{\\sigma}\\right)$$\n利用属性 $\\Phi(-z) = 1-\\Phi(z)$，第二个积分也等于 $\\Phi\\left(-\\frac{x_c - x_i^0}{\\sigma}\\right) = \\Phi\\left(\\frac{x_i^0 - x_c}{\\sigma}\\right)$。\n中心之间的距离是 $\\Delta x = x_{i+1}^0 - x_i^0$。\n所以，$x_c - x_{i+1}^0 = \\frac{x_i^0+x_{i+1}^0}{2} - x_{i+1}^0 = \\frac{x_i^0-x_{i+1}^0}{2} = -\\frac{\\Delta x}{2}$。\n并且 $x_i^0 - x_c = x_i^0 - \\frac{x_i^0+x_{i+1}^0}{2} = \\frac{x_i^0-x_{i+1}^0}{2} = -\\frac{\\Delta x}{2}$。\n将这些代入积分表达式中：\n$$O = \\Phi\\left(-\\frac{\\Delta x}{2\\sigma}\\right) + \\Phi\\left(-\\frac{\\Delta x}{2\\sigma}\\right) = 2\\Phi\\left(-\\frac{\\Delta x}{2\\sigma}\\right)$$\n现在我们计算数值。\n窗口中心之间的间距是 $\\Delta x = 0.3\\,\\mathrm{nm}$。\n方差是 $\\sigma^2 = \\frac{k_B T}{\\kappa^{\\ast}} = \\frac{k_B T}{50\\,k_{B}T/\\mathrm{nm}^2} = \\frac{1}{50}\\,\\mathrm{nm}^2$。\n标准差是 $\\sigma = \\sqrt{\\frac{1}{50}}\\,\\mathrm{nm} = \\frac{1}{5\\sqrt{2}}\\,\\mathrm{nm}$。\nCDF的自变量是：\n$$-\\frac{\\Delta x}{2\\sigma} = -\\frac{0.3\\,\\mathrm{nm}}{2 \\left(\\frac{1}{5\\sqrt{2}}\\,\\mathrm{nm}\\right)} = -\\frac{0.3 \\times 5\\sqrt{2}}{2} = -0.15 \\times 5\\sqrt{2} = -0.75\\sqrt{2}$$\n数值上，$-0.75\\sqrt{2} \\approx -1.06066$。\n所以，$O = 2\\Phi(-0.75\\sqrt{2})$。\n这与互补误差函数 $\\mathrm{erfc}(z) = 1 - \\mathrm{erf}(z)$ 相关，关系式为 $2\\Phi(-z) = \\mathrm{erfc}(z/\\sqrt{2})$。\n$$O = \\mathrm{erfc}\\left(\\frac{0.75\\sqrt{2}}{\\sqrt{2}}\\right) = \\mathrm{erfc}(0.75)$$\n使用标准库或表格查找误差函数，$\\mathrm{erf}(0.75) \\approx 0.7111556$。\n$$O = 1 - \\mathrm{erf}(0.75) \\approx 1 - 0.7111556 = 0.2888444$$\n将结果四舍五入到四位有效数字，我们得到 $0.2888$。", "answer": "$$\\boxed{0.2888}$$", "id": "3503120"}, {"introduction": "WHAM 的核心是求解一组自洽的非线性方程。这个高级实践将带你深入 WHAM 的数值引擎内部。通过处理一个小的离散系统，你不仅将求解自由能偏移量，还将通过检验其雅可比矩阵和迭代矩阵来分析迭代求解方法的稳定性和收敛速度。[@problem_id:3503134]", "problem": "考虑在计算材料科学中，使用加权直方图分析方法（WHAM）重构一个离散反应坐标上的无偏分布。两个由 $i \\in \\{1,2\\}$ 索引的伞形窗，对一个具有两个由 $k \\in \\{1,2\\}$ 索引的离散区间的反应坐标进行采样。每个窗在共同温度 $T$ 下使用一个偏置势 $u_i(x_k)$，并产生一个直方图计数 $H_i(x_k)$，总样本量为 $N_i$。在约化单位下进行计算，其中玻尔兹曼常数与温度的乘积 $k_B T$ 设为 1，因此逆温度为 $\\beta = 1$。并假设区间宽度相等，从而使离散化雅可比因子可以消去。\n\n定义未知的窗归一化常数 $f_i$（自由能偏移量）。无偏区间概率 $P(x_k)$ 通过对有偏系综进行玻尔兹曼重加权来确定，并且必须满足离散归一化。从重加权和归一化的统计力学定义出发，并利用强制有偏系综与无偏概率相协调的最大似然一致性条件，推导关于 $\\{f_i\\}$（$i=1,2$）的非线性方程组 $G_i(\\mathbf{f})=0$，其中 $G_i$ 强制执行窗 $i$ 的归一化一致性。\n\n对于以下特定数据集\n- $N_1 = N_2 = 100$，\n- $H_1(x_1) = 80$, $H_1(x_2) = 20$，\n- $H_2(x_1) = 20$, $H_2(x_2) = 80$，\n- $u_1(x_1) = 0$, $u_1(x_2) = \\ln(4)$，\n- $u_2(x_1) = \\ln(4)$, $u_2(x_2) = 0$，\n完成以下任务：\n\n1. 从玻尔兹曼重加权的第一性原理出发，写出以归一化常数 $\\{f_i\\}$ 和给定数据表示的无偏概率 $P(x_k)$，并明确陈述定义 $\\{f_i\\}$ 的两个非线性一致性方程 $G_i(\\mathbf{f})=0$。\n\n2. 推导雅可比矩阵元 $\\partial G_i / \\partial f_j$（$i,j \\in \\{1,2\\}$），并针对此离散双区间、双窗情况进行简化。求解与所推导方程一致的归一化常数 $\\{f_i\\}$。\n\n3. 考虑用于归一化常数的标准 WHAM 不动点更新映射，\n$$\nf_i^{\\text{new}} = - \\ln\\left( \\sum_{k=1}^{2} P(x_k;\\mathbf{f}) \\,\\exp\\!\\left[ - u_i(x_k) \\right] \\right),\n$$\n其中 $P(x_k;\\mathbf{f})$ 根据当前的 $\\mathbf{f}$ 计算。推导在解 $\\mathbf{f}^{\\ast}$ 处求值的迭代矩阵 $M = \\left[ \\partial f_i^{\\text{new}} / \\partial f_j \\right]_{i,j}$，并用先前推导的雅可比矩阵和 $\\{f_i\\}$ 的解值表示 $M$。计算给定数据下 $M$ 的谱半径 $\\rho$。将最终的谱半径表示为单个实数。由于谱半径是无量纲的，因此不需要单位，如果得到精确值，则无需四舍五入。", "solution": "该问题经验证具有科学依据、适定且客观。已提供加权直方图分析方法（WHAM）所需的所有数据和定义。我们开始解答。\n\n该问题要求完成与双窗、双区间 WHAM 计算相关的三项任务。我们在 $\\beta = (k_B T)^{-1} = 1$ 的约化单位下进行计算。\n\n为避免与归一化概率混淆，我们将区间 $k$ 的未归一化概率密度或态密度记为 $\\rho(x_k)$。基本的 WHAM 方程是通过最大化观测到给定直方图 $\\{H_i(x_k)\\}$ 的似然性推导出来的，它将态密度 $\\rho(x_k)$ 与模拟数据和自由能偏移量 $f_i$ 联系起来：\n$$ \\rho(x_k) = \\frac{\\sum_{i=1}^2 H_i(x_k)}{\\sum_{j=1}^2 N_j \\exp(f_j - u_j(x_k))} $$\n自由能偏移量 $f_i$ 本身通过态密度自洽地定义：\n$$ \\exp(-f_i) = \\sum_{k=1}^2 \\rho(x_k) \\exp(-u_i(x_k)) $$\n观测到系统处于区间 $k$ 的真实归一化概率为 $P(x_k) = \\rho(x_k) / \\sum_l \\rho(x_l)$。上述一致性方程使用的是未归一化的态密度 $\\rho(x_k)$。\n\n**1. 非线性一致性方程的推导**\n\n题目要求一个方程组 $G_i(\\mathbf{f})=0$。这些方程直接由自由能的自洽条件推导而来。我们定义 $G_i$ 为其根代表此条件的函数：\n$$ G_i(\\mathbf{f}) = \\exp(-f_i) - \\sum_{k=1}^2 \\rho(x_k; \\mathbf{f}) \\exp(-u_i(x_k)) = 0 $$\n代入 $\\rho(x_k; \\mathbf{f})$ 的表达式，得到关于 $\\mathbf{f} = \\{f_1, f_2\\}$ 的显式非线性方程：\n$$ G_i(\\mathbf{f}) = \\exp(-f_i) - \\sum_{k=1}^2 \\left( \\frac{\\sum_{j=1}^2 H_j(x_k)}{\\sum_{l=1}^2 N_l \\exp(f_l - u_l(x_k))} \\right) \\exp(-u_i(x_k)) = 0 $$\n对于 $i=1, 2$，这定义了一个包含两个方程的方程组。\n\n使用所提供的数据集：\n$N_1 = 100$, $N_2 = 100$。\n$H(x_1) = H_1(x_1) + H_2(x_1) = 80 + 20 = 100$。\n$H(x_2) = H_1(x_2) + H_2(x_2) = 20 + 80 = 100$。\n$u_1(x_1) = 0$, $u_1(x_2) = \\ln(4)$。所以 $\\exp(-u_1(x_1))=1$, $\\exp(-u_1(x_2))=1/4$。\n$u_2(x_1) = \\ln(4)$, $u_2(x_2) = 0$。所以 $\\exp(-u_2(x_1))=1/4$, $\\exp(-u_2(x_2))=1$。\n\n令 $e_i = \\exp(f_i)$。分母为：\n$D_1 = N_1 e_1 \\exp(-u_1(x_1)) + N_2 e_2 \\exp(-u_2(x_1)) = 100 e_1 + 100 e_2 (1/4) = 100 e_1 + 25 e_2$。\n$D_2 = N_1 e_1 \\exp(-u_1(x_2)) + N_2 e_2 \\exp(-u_2(x_2)) = 100 e_1 (1/4) + 100 e_2 = 25 e_1 + 100 e_2$。\n\n密度为 $\\rho(x_1) = 100/D_1$ 和 $\\rho(x_2) = 100/D_2$。方程 $G_i(\\mathbf{f})=0$ 为：\n$G_1(\\mathbf{f}) = e_1^{-1} - [\\rho(x_1) \\exp(-u_1(x_1)) + \\rho(x_2) \\exp(-u_1(x_2))] = e_1^{-1} - \\left[ \\frac{100}{100 e_1 + 25 e_2} \\cdot 1 + \\frac{100}{25 e_1 + 100 e_2} \\cdot \\frac{1}{4} \\right] = 0$。\n$G_2(\\mathbf{f}) = e_2^{-1} - [\\rho(x_1) \\exp(-u_2(x_1)) + \\rho(x_2) \\exp(-u_2(x_2))] = e_2^{-1} - \\left[ \\frac{100}{100 e_1 + 25 e_2} \\cdot \\frac{1}{4} + \\frac{100}{25 e_1 + 100 e_2} \\cdot 1 \\right] = 0$。\n这就是两个显式的非线性一致性方程。\n\n**2. 雅可比矩阵和 $\\{f_i\\}$ 的解**\n\n自由能 $f_i$ 的定义仅相差一个任意的加法常数。我们可以通过将一个自由能设为零来固定这个常数，例如，设 $f_1=0$，这意味着 $e_1=1$。我们使用第一个方程 $G_1=0$ 来求解 $f_2$（或 $e_2=\\exp(f_2)$）：\n$1 - \\left[ \\frac{100}{100 + 25 e_2} + \\frac{25}{25 + 100 e_2} \\right] = 0$。\n$1 = \\frac{4}{4 + e_2} + \\frac{1}{1 + 4e_2}$。\n乘以公分母 $(4+e_2)(1+4e_2)$：\n$(4+e_2)(1+4e_2) = 4(1+4e_2) + (4+e_2)$。\n$4 + 16e_2 + e_2 + 4e_2^2 = 4 + 16e_2 + 4 + e_2$。\n$4e_2^2 + 17e_2 + 4 = 17e_2 + 8$。\n$4e_2^2 = 4 \\implies e_2^2 = 1$。\n由于 $e_2 = \\exp(f_2)$ 必须为正，我们得到 $e_2 = 1$，这意味着 $f_2=0$。\n解为 $\\mathbf{f}^*=(0,0)$（在相差一个任意加法常数的意义下）。我们可以在 $G_2=0$ 方程中验证这个解。当 $e_1=1, e_2=1$ 时：$1^{-1} - [\\frac{25}{125} + \\frac{100}{125}] = 1 - [\\frac{1}{5} + \\frac{4}{5}] = 1-1=0$。解是一致的。\n\n雅可比矩阵为 $J_{ij} = \\partial G_i / \\partial f_j$。\n$$ \\frac{\\partial G_i}{\\partial f_j} = \\frac{\\partial}{\\partial f_j} \\left( \\exp(-f_i) - \\sum_k \\rho_k \\exp(-u_{ik}) \\right) = -\\delta_{ij}\\exp(-f_i) - \\sum_k \\exp(-u_{ik}) \\frac{\\partial \\rho_k}{\\partial f_j} $$\n$\\rho_k$ 的导数是：\n$$ \\frac{\\partial \\rho_k}{\\partial f_j} = \\frac{\\partial}{\\partial f_j}\\left( \\frac{H_{tot}(k)}{D_k} \\right) = - \\frac{H_{tot}(k)}{D_k^2} \\frac{\\partial D_k}{\\partial f_j} = - \\frac{\\rho_k}{D_k} \\left( N_j \\exp(f_j-u_j(k)) \\right) $$\n综合这些，雅可比矩阵元为：\n$$ J_{ij} = -\\delta_{ij}\\exp(-f_i) + \\sum_k \\exp(-u_{ik}) \\rho_k \\frac{N_j \\exp(f_j - u_j(k))}{D_k} $$\n我们在解 $\\mathbf{f}^*=(0,0)$ 处计算该值。此时：$f_1=f_2=0$, $e_1=e_2=1$。\n$D_1 = 125, D_2 = 125$。\n$\\rho(x_1) = 100/125 = 4/5$, $\\rho(x_2) = 100/125 = 4/5$。\n$J_{11} = -1 + \\left[ \\exp(-u_{11})\\rho_1 \\frac{N_1 e^{-u_{11}}}{D_1} + \\exp(-u_{12})\\rho_2 \\frac{N_1 e^{-u_{12}}}{D_2} \\right] = -1 + \\left[ 1\\cdot\\frac{4}{5}\\frac{100}{125} + \\frac{1}{4}\\frac{4}{5}\\frac{100/4}{125} \\right] = -1 + \\left[ \\frac{16}{25} + \\frac{1}{25} \\right] = -\\frac{8}{25}$。\n$J_{12} = 0 + \\left[ \\exp(-u_{11})\\rho_1 \\frac{N_2 e^{-u_{21}}}{D_1} + \\exp(-u_{12})\\rho_2 \\frac{N_2 e^{-u_{22}}}{D_2} \\right] = \\left[ 1\\cdot\\frac{4}{5}\\frac{100/4}{125} + \\frac{1}{4}\\frac{4}{5}\\frac{100}{125} \\right] = \\left[ \\frac{4}{25} + \\frac{4}{25} \\right] = \\frac{8}{25}$。\n根据问题设置的对称性，$J_{21}=J_{12}$ 且 $J_{22}=J_{11}$。所以，$J = \\begin{pmatrix} -8/25  8/25 \\\\ 8/25  -8/25 \\end{pmatrix}$。\n\n**3. 迭代矩阵和谱半径**\n\n给定的不动点映射为：\n$$ f_i^{\\text{new}} = h_i(\\mathbf{f}) = - \\ln\\left( \\sum_{k=1}^{2} P(x_k;\\mathbf{f}) \\exp(-u_i(x_k)) \\right) $$\n此处，$P(x_k;\\mathbf{f})$ 是归一化概率：$P(x_k;\\mathbf{f}) = \\rho(x_k;\\mathbf{f}) / S(\\mathbf{f})$，其中 $S(\\mathbf{f}) = \\sum_l \\rho(x_l;\\mathbf{f})$。\n因此，$h_i(\\mathbf{f}) = -\\ln\\left( \\frac{\\sum_k \\rho_k \\exp(-u_{ik})}{S(\\mathbf{f})} \\right) = -\\ln\\left(\\sum_k \\rho_k \\exp(-u_{ik})\\right) + \\ln(S(\\mathbf{f}))$。\n迭代矩阵为在 $\\mathbf{f}^*=(0,0)$ 处求值的 $M_{ij} = \\partial h_i / \\partial f_j$。\n$M_{ij} = \\frac{\\partial}{\\partial f_j} \\left( -\\ln\\left(\\sum_k \\rho_k e^{-u_{ik}}\\right) \\right) + \\frac{\\partial}{\\partial f_j} \\ln(S(\\mathbf{f}))$。\n\n对于第一项，注意到 $\\exp(-f_i) - G_i(\\mathbf{f}) = \\sum_k \\rho_k \\exp(-u_{ik})$。在解 $\\mathbf{f}^*$ 处，$G_i(\\mathbf{f}^*)=0$，所以 $\\sum_k \\rho_k \\exp(-u_{ik}) = \\exp(-f_i^*)$。\n令 $g_i(\\mathbf{f}) = -\\ln(\\sum_k \\rho_k e^{-u_{ik}})$。在解处，$g_i(\\mathbf{f}^*) = f_i^*$。$g_i$ 的雅可比矩阵与 $J$ 相关。\n$J_{ij} = \\frac{\\partial G_i}{\\partial f_j} = \\frac{\\partial}{\\partial f_j}(\\exp(-f_i) - \\exp(-g_i(\\mathbf{f}))) = -\\delta_{ij}e^{-f_i} + e^{-g_i}\\frac{\\partial g_i}{\\partial f_j}$。\n在 $\\mathbf{f}^*$ 处，$e^{-f_i^*} = e^{-g_i(\\mathbf{f}^*)}$，所以 $J_{ij}^* = e^{-f_i^*} (\\frac{\\partial g_i}{\\partial f_j}^* - \\delta_{ij})$。\n在 $\\mathbf{f}^*=(0,0)$ 处，$J = \\frac{\\partial g}{\\partial f} - I$，所以 $\\frac{\\partial g}{\\partial f} = J+I = \\begin{pmatrix} 17/25  8/25 \\\\ 8/25  17/25 \\end{pmatrix}$。\n\n第二项是 $\\frac{\\partial \\ln S}{\\partial f_j} = \\frac{1}{S} \\sum_k \\frac{\\partial \\rho_k}{\\partial f_j}$。我们称此矩阵为 $C$。在 $\\mathbf{f}^*=(0,0)$ 处：\n$S = \\rho_1+\\rho_2 = 4/5+4/5 = 8/5$。\n我们需要 $\\sum_k \\partial \\rho_k / \\partial f_j$。\n在 $\\mathbf{f}^*=(0,0)$ 处使用 $\\partial \\rho_k/\\partial f_j = - (\\rho_k/D_k) N_j e^{f_j-u_{jk}}$：\n$\\frac{\\partial \\rho_1}{\\partial f_1} = -\\frac{4/5}{125}100 = -\\frac{16}{25}$。$\\frac{\\partial \\rho_2}{\\partial f_1} = -\\frac{4/5}{125}(100/4) = -\\frac{4}{25}$。\n$\\sum_k \\frac{\\partial \\rho_k}{\\partial f_1} = -16/25 - 4/25 = -20/25 = -4/5$。\n根据对称性，$\\sum_k \\partial \\rho_k / \\partial f_2$ 也等于 $-4/5$。\n所以，$C_{i1} = C_{i2} = \\frac{1}{S} \\sum_k \\frac{\\partial \\rho_k}{\\partial f_j} = \\frac{1}{8/5} (-4/5) = -1/2$。\n第二项的矩阵是 $C = \\begin{pmatrix} -1/2  -1/2 \\\\ -1/2  -1/2 \\end{pmatrix}$。\n\n完整的迭代矩阵是 $M = \\frac{\\partial g}{\\partial f} + C = (J+I)+C$。\n$M = \\begin{pmatrix} 17/25  8/25 \\\\ 8/25  17/25 \\end{pmatrix} - \\begin{pmatrix} 1/2  1/2 \\\\ 1/2  1/2 \\end{pmatrix} = \\begin{pmatrix} 34/50-25/50  16/50-25/50 \\\\ 16/50-25/50  34/50-25/50 \\end{pmatrix} = \\begin{pmatrix} 9/50  -9/50 \\\\ -9/50  9/50 \\end{pmatrix}$。\n\n为了求谱半径 $\\rho(M)$，我们求 $M$ 的特征值 $\\lambda$：\n$\\det(M-\\lambda I) = \\det \\begin{pmatrix} 9/50 - \\lambda  -9/50 \\\\ -9/50  9/50 - \\lambda \\end{pmatrix} = 0$。\n$(9/50 - \\lambda)^2 - (-9/50)^2 = 0$。\n$(9/50 - \\lambda)^2 = (9/50)^2$。\n这给出了两个解：$9/50 - \\lambda = 9/50 \\implies \\lambda_1 = 0$。\n和 $9/50 - \\lambda = -9/50 \\implies \\lambda_2 = 18/50 = 9/25$。\n特征值为 $\\{0, 9/25\\}$。谱半径是特征值绝对值的最大值。\n$\\rho(M) = \\max(|0|, |9/25|) = 9/25$。", "answer": "$$\\boxed{\\frac{9}{25}}$$", "id": "3503134"}]}