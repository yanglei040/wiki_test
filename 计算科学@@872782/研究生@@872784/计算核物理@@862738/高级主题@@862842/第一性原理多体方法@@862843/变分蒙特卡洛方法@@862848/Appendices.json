{"hands_on_practices": [{"introduction": "理论通过实践得以升华。在变分蒙特卡洛（VMC）方法中，最核心的概念是局域能量 $E_L$。这项实践将通过一个简单但非平凡的系统（氦原子，其数学处理类似于一个简化的双核子系统），指导你一步步推导局域能量，从而牢固掌握动能和势能算符如何作用于试验波函数，并最终构成 $E_L$。[@problem_id:2466739]", "problem": "在玻恩–奥本海默近似和非相对论近似下，考虑一个核电荷数为 $Z=2$ 且固定在原点的氦原子。使用原子单位，其中 $\\hbar = m_{e} = e = 1$ 且 $1/(4\\pi\\varepsilon_{0})=1$。该双电子体系的电子哈密顿量为\n$$\n\\hat{H} = -\\frac{1}{2}\\nabla_{1}^{2} - \\frac{1}{2}\\nabla_{2}^{2} - \\frac{Z}{r_{1}} - \\frac{Z}{r_{2}} + \\frac{1}{r_{12}},\n$$\n其中 $r_{i} = |\\mathbf{r}_{i}|$（$i=1,2$），且 $r_{12} = |\\mathbf{r}_{1} - \\mathbf{r}_{2}|$。在变分蒙特卡洛（VMC）方法中，局域能量定义为\n$$\nE_{L}(\\mathbf{R}) = \\frac{\\hat{H}\\Psi_{T}(\\mathbf{R})}{\\Psi_{T}(\\mathbf{R})},\n$$\n其中 $\\mathbf{R} = (\\mathbf{r}_{1},\\mathbf{r}_{2})$。对于试探波函数\n$$\n\\Psi_{T}(\\mathbf{R}) = \\exp(-\\alpha r_{1})\\,\\exp(-\\alpha r_{2}),\n$$\n其中 $\\alpha > 0$ 是变分参数，请推导当 $Z=2$ 时，$E_{L}(\\mathbf{R})$ 作为 $r_{1}$、$r_{2}$、$r_{12}$ 和 $\\alpha$ 的显式函数。\n\n请将最终答案表示为一个无单位的单一闭式解析表达式。", "solution": "该问题陈述经评估有效。其科学基础扎实、问题提法恰当、客观，并包含了进行严格推导所需的所有信息。这是计算量子化学中应用变分蒙特卡洛方法的一个标准练习。我们开始求解。\n\n目标是推导由给定试探波函数 $\\Psi_{T}(\\mathbf{R})$ 描述的氦原子的局域能量 $E_{L}(\\mathbf{R})$。局域能量定义为：\n$$\nE_{L}(\\mathbf{R}) = \\frac{\\hat{H}\\Psi_{T}(\\mathbf{R})}{\\Psi_{T}(\\mathbf{R})}\n$$\n哈密顿量 $\\hat{H}$ 在原子单位下给出：\n$$\n\\hat{H} = -\\frac{1}{2}\\nabla_{1}^{2} - \\frac{1}{2}\\nabla_{2}^{2} - \\frac{Z}{r_{1}} - \\frac{Z}{r_{2}} + \\frac{1}{r_{12}}\n$$\n我们可以将哈密顿量分解为一个动能算符 $\\hat{T}$ 和一个势能算符 $\\hat{V}$：\n$$\n\\hat{T} = -\\frac{1}{2}\\nabla_{1}^{2} - \\frac{1}{2}\\nabla_{2}^{2}\n$$\n$$\n\\hat{V} = -\\frac{Z}{r_{1}} - \\frac{Z}{r_{2}} + \\frac{1}{r_{12}}\n$$\n因此，局域能量可以写成动能和势能贡献之和：\n$$\nE_{L}(\\mathbf{R}) = \\frac{\\hat{T}\\Psi_{T}(\\mathbf{R})}{\\Psi_{T}(\\mathbf{R})} + \\frac{\\hat{V}\\Psi_{T}(\\mathbf{R})}{\\Psi_{T}(\\mathbf{R})}\n$$\n势能算符 $\\hat{V}$ 是一个乘法算符。它对 $\\Psi_{T}(\\mathbf{R})$ 的作用就是乘以势能函数 $V(\\mathbf{R})$。因此，对局域能量的势能贡献为：\n$$\n\\frac{\\hat{V}\\Psi_{T}(\\mathbf{R})}{\\Psi_{T}(\\mathbf{R})} = V(\\mathbf{R}) = -\\frac{Z}{r_{1}} - \\frac{Z}{r_{2}} + \\frac{1}{r_{12}}\n$$\n接下来，我们计算动能贡献。试探波函数为：\n$$\n\\Psi_{T}(\\mathbf{R}) = \\exp(-\\alpha r_{1})\\,\\exp(-\\alpha r_{2})\n$$\n其中 $r_1 = |\\mathbf{r}_1|$ 且 $r_2 = |\\mathbf{r}_2|$。该波函数是两个函数的乘积，一个仅依赖于电子1的坐标，$\\psi(\\mathbf{r}_{1}) = \\exp(-\\alpha r_{1})$，另一个仅依赖于电子2的坐标，$\\psi(\\mathbf{r}_{2}) = \\exp(-\\alpha r_{2})$。所以，$\\Psi_{T}(\\mathbf{R}) = \\psi(\\mathbf{r}_{1})\\psi(\\mathbf{r}_{2})$。\n\n动能算符 $\\hat{T}$ 对 $\\Psi_{T}$ 的作用为：\n$$\n\\hat{T}\\Psi_{T} = \\left(-\\frac{1}{2}\\nabla_{1}^{2} - \\frac{1}{2}\\nabla_{2}^{2}\\right) \\psi(\\mathbf{r}_{1})\\psi(\\mathbf{r}_{2})\n$$\n由于波函数和算符的可分离性，上式变为：\n$$\n\\hat{T}\\Psi_{T} = \\psi(\\mathbf{r}_{2})\\left(-\\frac{1}{2}\\nabla_{1}^{2}\\psi(\\mathbf{r}_{1})\\right) + \\psi(\\mathbf{r}_{1})\\left(-\\frac{1}{2}\\nabla_{2}^{2}\\psi(\\mathbf{r}_{2})\\right)\n$$\n那么，对局域能量的动能贡献为：\n$$\n\\frac{\\hat{T}\\Psi_{T}}{\\Psi_{T}} = \\frac{\\psi(\\mathbf{r}_{2})\\left(-\\frac{1}{2}\\nabla_{1}^{2}\\psi(\\mathbf{r}_{1})\\right) + \\psi(\\mathbf{r}_{1})\\left(-\\frac{1}{2}\\nabla_{2}^{2}\\psi(\\mathbf{r}_{2})\\right)}{\\psi(\\mathbf{r}_{1})\\psi(\\mathbf{r}_{2})} = -\\frac{1}{2}\\frac{\\nabla_{1}^{2}\\psi(\\mathbf{r}_{1})}{\\psi(\\mathbf{r}_{1})} - \\frac{1}{2}\\frac{\\nabla_{2}^{2}\\psi(\\mathbf{r}_{2})}{\\psi(\\mathbf{r}_{2})}\n$$\n我们需要计算 $\\psi(\\mathbf{r}) = \\exp(-\\alpha r)$ 的 $\\nabla^{2}\\psi(\\mathbf{r})$。由于 $\\psi$ 仅依赖于径向坐标 $r$，我们使用球坐标下拉普拉斯算子的径向部分：\n$$\n\\nabla^{2}f(r) = \\frac{1}{r^{2}}\\frac{\\partial}{\\partial r}\\left(r^{2}\\frac{\\partial f}{\\partial r}\\right) = \\frac{\\partial^{2}f}{\\partial r^{2}} + \\frac{2}{r}\\frac{\\partial f}{\\partial r}\n$$\n对于 $f(r) = \\exp(-\\alpha r)$：\n一阶导数为 $\\frac{\\partial f}{\\partial r} = -\\alpha\\exp(-\\alpha r)$。\n二阶导数为 $\\frac{\\partial^{2}f}{\\partial r^{2}} = \\alpha^{2}\\exp(-\\alpha r)$。\n将这些代入拉普拉斯算子表达式：\n$$\n\\nabla^{2}\\exp(-\\alpha r) = \\alpha^{2}\\exp(-\\alpha r) + \\frac{2}{r}(-\\alpha\\exp(-\\alpha r)) = \\left(\\alpha^{2} - \\frac{2\\alpha}{r}\\right)\\exp(-\\alpha r)\n$$\n因此，对于单个电子：\n$$\n\\frac{\\nabla^{2}\\psi(\\mathbf{r})}{\\psi(\\mathbf{r})} = \\frac{(\\alpha^{2} - \\frac{2\\alpha}{r})\\exp(-\\alpha r)}{\\exp(-\\alpha r)} = \\alpha^{2} - \\frac{2\\alpha}{r}\n$$\n一个电子对局域能量的动能贡献为：\n$$\n-\\frac{1}{2}\\frac{\\nabla^{2}\\psi(\\mathbf{r})}{\\psi(\\mathbf{r})} = -\\frac{1}{2}\\left(\\alpha^{2} - \\frac{2\\alpha}{r}\\right) = -\\frac{\\alpha^{2}}{2} + \\frac{\\alpha}{r}\n$$\n对 $E_{L}$ 的总动能贡献是两个电子之和：\n$$\n\\frac{\\hat{T}\\Psi_{T}}{\\Psi_{T}} = \\left(-\\frac{\\alpha^{2}}{2} + \\frac{\\alpha}{r_{1}}\\right) + \\left(-\\frac{\\alpha^{2}}{2} + \\frac{\\alpha}{r_{2}}\\right) = -\\alpha^{2} + \\frac{\\alpha}{r_{1}} + \\frac{\\alpha}{r_{2}}\n$$\n最后，我们将动能和势能贡献结合起来，得到完整的局域能量 $E_{L}(\\mathbf{R})$：\n$$\nE_{L}(\\mathbf{R}) = \\left(-\\alpha^{2} + \\frac{\\alpha}{r_{1}} + \\frac{\\alpha}{r_{2}}\\right) + \\left(-\\frac{Z}{r_{1}} - \\frac{Z}{r_{2}} + \\frac{1}{r_{12}}\\right)\n$$\n合并含 $r_{1}$ 和 $r_{2}$ 的项：\n$$\nE_{L}(\\mathbf{R}) = -\\alpha^{2} + \\frac{\\alpha - Z}{r_{1}} + \\frac{\\alpha - Z}{r_{2}} + \\frac{1}{r_{12}}\n$$\n题目指明氦的核电荷数为 $Z=2$。代入此值得到最终表达式：\n$$\nE_{L}(\\mathbf{R}) = -\\alpha^{2} + \\frac{\\alpha - 2}{r_{1}} + \\frac{\\alpha - 2}{r_{2}} + \\frac{1}{r_{12}}\n$$\n这可以写成：\n$$\nE_{L}(\\mathbf{R}) = -\\alpha^{2} - \\frac{2 - \\alpha}{r_{1}} - \\frac{2 - \\alpha}{r_{2}} + \\frac{1}{r_{12}}\n$$\n这就是局域能量作为 $r_{1}$、$r_{2}$、$r_{12}$ 和 $\\alpha$ 的显式表达式。", "answer": "$$\n\\boxed{-\\alpha^{2} - \\frac{2-\\alpha}{r_{1}} - \\frac{2-\\alpha}{r_{2}} + \\frac{1}{r_{12}}}\n$$", "id": "2466739"}, {"introduction": "真实的核系统涉及复杂的、依赖于自旋的相互作用。这项实践将展示如何在VMC框架内，计算核力中一个关键组成部分——自旋-轨道相互作用——对局域能量的贡献。你需要运用角动量代数来处理 $^{3}P_{2}$ 耦合通道，这是连接VMC计算与核结构理论的一项关键技能。[@problem_id:3610699]", "problem": "考虑一个嵌入在基于壳模型的 Slater 行列式波函数 $\\Phi_{\\mathrm{SD}}$ 中的双核子子系统，该波函数在变分蒙特卡罗 (VMC) 方法中用作试探态。多体试探态为 $\\Psi_{T}(\\mathbf{R},\\Sigma)$，由 $\\Phi_{\\mathrm{SD}}$ 构造。在给定的蒙特卡罗行走者构型 $(\\mathbf{R},\\Sigma)$ 处的瞬时局域能量由比值 $E_{L}(\\mathbf{R},\\Sigma) = \\frac{H\\,\\Psi_{T}(\\mathbf{R},\\Sigma)}{\\Psi_{T}(\\mathbf{R},\\Sigma)}$ 定义，其中 $H$ 是多体哈密顿量。假设您在此处计算的唯一非零贡献来自核子 $1$ 和 $2$ 之间的两体自旋-轨道相互作用，其形式为\n$$\nH_{LS} = V_{LS}(r_{12})\\,\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12},\n$$\n其中 $\\mathbf{L}_{12}$ 是相对轨道角动量算符，$\\mathbf{S}_{12} = \\mathbf{s}_{1} + \\mathbf{s}_{2}$ 是该核子对的总自旋算符。在自然单位制中进行计算，取 $\\hbar = 1$，因此 $\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$ 是无量纲的，而 $V_{LS}(r_{12})$ 具有能量单位。\n\n假设一个特定的蒙特卡罗行走者构型抽样到核子 $1$ 和 $2$ 在 $^{3}P_{2}$ 道中的两体相对态，即轨道角动量 $L = 1$，总自旋 $S = 1$，总角动量 $J = 2$。在此构型下，粒子间距为 $r_{12} = 1.4\\,\\text{fm}$。自旋-轨道势中的径向强度由下式指定：\n$$\nV_{LS}(r) = \\alpha\\,r^{-3}\\,\\exp(-\\gamma r),\n$$\n其中 $\\alpha = 25\\,\\text{MeV}\\cdot\\text{fm}^{3}$ 且 $\\gamma = 0.8\\,\\text{fm}^{-1}$。\n\n从局域能量的定义和基本的角动量相加规则出发，计算自旋-轨道势 $V_{LS}(r_{12})\\,\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$ 对该构型下局域能量的贡献。以 $\\text{MeV}$ 为单位表示最终能量，并将您的答案四舍五入到四位有效数字。", "solution": "该问题要求计算在特定蒙特卡罗构型下，两体自旋-轨道相互作用 $H_{LS}$ 对局域能量 $E_L$ 的贡献。局域能量定义为 $E_{L}(\\mathbf{R},\\Sigma) = \\frac{H\\,\\Psi_{T}(\\mathbf{R},\\Sigma)}{\\Psi_{T}(\\mathbf{R},\\Sigma)}$。因此，哈密顿量中特定项（如 $H_{LS}$）的贡献由下式给出：\n$$\n(E_L)_{LS} = \\frac{H_{LS}\\,\\Psi_{T}(\\mathbf{R},\\Sigma)}{\\Psi_{T}(\\mathbf{R},\\Sigma)}\n$$\n核子对 $(1,2)$ 的自旋-轨道哈密顿量为 $H_{LS} = V_{LS}(r_{12})\\,\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$。\n\n问题陈述，在给定构型下，该双核子子系统处于 $^{3}P_{2}$ 态。该记法指定了该核子对的相对轨道角动量 ($L$)、总自旋 ($S$) 和总角动量 ($J$) 的量子数。一个具有确定 $L$、$S$ 和 $J$ 的态是算符 $\\mathbf{L}_{12}^2$、$\\mathbf{S}_{12}^2$ 和 $\\mathbf{J}^2$ 的本征态，其中 $\\mathbf{J} = \\mathbf{L}_{12} + \\mathbf{S}_{12}$。因此，它也是算符 $\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$ 的本征态。\n\n我们可以用角动量平方算符来表示算符 $\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$。从总角动量的定义 $\\mathbf{J} = \\mathbf{L}_{12} + \\mathbf{S}_{12}$ 出发，我们将其平方：\n$$\n\\mathbf{J}^2 = (\\mathbf{L}_{12} + \\mathbf{S}_{12}) \\cdot (\\mathbf{L}_{12} + \\mathbf{S}_{12}) = \\mathbf{L}_{12}^2 + \\mathbf{S}_{12}^2 + 2\\,\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}\n$$\n由于轨道和自旋算符作用于不同的空间，它们是对易的。重新整理该方程得到：\n$$\n\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12} = \\frac{1}{2} \\left( \\mathbf{J}^2 - \\mathbf{L}_{12}^2 - \\mathbf{S}_{12}^2 \\right)\n$$\n当该算符作用于本征态 $|L, S, J, M_J\\rangle$ 上时，结果是该态乘以一个本征值 $\\lambda_{LS}$。在 $\\hbar=1$ 的单位制中，$\\mathbf{J}^2$、$\\mathbf{L}_{12}^2$ 和 $\\mathbf{S}_{12}^2$ 的本征值分别为 $J(J+1)$、$L(L+1)$ 和 $S(S+1)$。因此，$\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$ 的本征值为：\n$$\n\\lambda_{LS} = \\frac{1}{2} \\left[ J(J+1) - L(L+1) - S(S+1) \\right]\n$$\n接下来，我们从光谱记法 $^{2S+1}L_J$（在此为 $^{3}P_{2}$）中确定量子数 $L$、$S$ 和 $J$。\n- 上标 $2S+1 = 3$，意味着 $2S=2$，所以总自旋为 $S=1$。\n- 字母 $P$ 对应于轨道角动量。按照惯例（$S, P, D, F, \\ldots$ 分别对应 $L=0, 1, 2, 3, \\ldots$），$P$ 表示 $L=1$。\n- 下标是总角动量，所以 $J=2$。\n\n我们将这些量子数（$L=1$, $S=1$, $J=2$）代入 $\\lambda_{LS}$ 的表达式中：\n$$\n\\lambda_{LS} = \\frac{1}{2} \\left[ 2(2+1) - 1(1+1) - 1(1+1) \\right]\n$$\n$$\n\\lambda_{LS} = \\frac{1}{2} \\left[ 2(3) - 1(2) - 1(2) \\right] = \\frac{1}{2} [6 - 2 - 2] = \\frac{1}{2} [2] = 1\n$$\n由于此构型下的波函数是 $\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12}$ 的本征态，其本征值为 $\\lambda_{LS}=1$，局域能量的计算简化为：\n$$\n(E_L)_{LS} = \\frac{V_{LS}(r_{12})\\,(\\mathbf{L}_{12}\\!\\cdot\\!\\mathbf{S}_{12})\\,\\Psi_{T}}{\\Psi_{T}} = \\frac{V_{LS}(r_{12})\\,(\\lambda_{LS})\\,\\Psi_{T}}{\\Psi_{T}} = V_{LS}(r_{12}) \\times \\lambda_{LS}\n$$\n当 $\\lambda_{LS}=1$ 时，对局域能量的贡献就是势能径向函数在给定间距处的值，即 $(E_L)_{LS} = V_{LS}(r_{12})$。\n\n势能由 $V_{LS}(r) = \\alpha\\,r^{-3}\\,\\exp(-\\gamma r)$ 给出。我们有以下给定参数：\n- 粒子间距: $r_{12} = 1.4\\,\\text{fm}$\n- 强度参数: $\\alpha = 25\\,\\text{MeV}\\cdot\\text{fm}^{3}$\n- 范围参数: $\\gamma = 0.8\\,\\text{fm}^{-1}$\n\n现在我们可以将这些值代入势函数中：\n$$\n(E_L)_{LS} = V_{LS}(1.4\\,\\text{fm}) = (25\\,\\text{MeV}\\cdot\\text{fm}^{3}) \\times (1.4\\,\\text{fm})^{-3} \\times \\exp\\left(-(0.8\\,\\text{fm}^{-1}) \\times (1.4\\,\\text{fm})\\right)\n$$\n单位正确抵消，最终结果的单位为 $\\text{MeV}$。\n$$\n(E_L)_{LS} = \\frac{25}{(1.4)^3} \\exp(-0.8 \\times 1.4) \\,\\text{MeV}\n$$\n$$\n(E_L)_{LS} = \\frac{25}{2.744} \\exp(-1.12) \\,\\text{MeV}\n$$\n$$\n(E_L)_{LS} \\approx (9.110787...) \\times (0.326279...) \\,\\text{MeV}\n$$\n$$\n(E_L)_{LS} \\approx 2.9733435... \\,\\text{MeV}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n(E_L)_{LS} \\approx 2.973 \\,\\text{MeV}\n$$\n这就是自旋-轨道势对给定蒙特卡罗构型下局域能量的贡献。", "answer": "$$\n\\boxed{2.973}\n$$", "id": "3610699"}, {"introduction": "推导出局域能量只是VMC方法的一部分，我们还需要高效地对构型空间进行抽样。这项终极实践将从纸笔分析转向实际的编程实现，直面核物理中短程相互作用导致的势能奇异性这一核心挑战。你将实现并比较都会-调整朗之万算法（Metropolis-Adjusted Langevin Algorithm, MALA）的不同版本，亲身体验算法设计如何直接影响抽样效率。[@problem_id:3610701]", "problem": "考虑一个三维变分蒙特卡罗采样器，其目标是双体试探波函数的模平方，该模型用于模拟由核力引起的短程相关性。设位置是一个矢量 $\\mathbf{x}\\in\\mathbb{R}^3$，其中 $r=\\|\\mathbf{x}\\|$。目标概率密度为 $\\pi(\\mathbf{x})\\propto|\\Psi(r)|^2$，其中试探波函数使用以下径向族之一：\n- 局域接触型族（在原点处奇异）：$\\Psi_{\\mathrm{L}}(r)=\\exp\\left(-\\frac{c}{r}\\right)$，导出 $\\ln \\pi_{\\mathrm{L}}(\\mathbf{x})=-\\frac{2c}{r}$。\n- 非局域弥散型族（在原点处有限）：$\\Psi_{\\mathrm{NL}}(r)=\\exp\\left(-\\frac{c}{\\sqrt{r^2+\\lambda^2}}\\right)$，导出 $\\ln \\pi_{\\mathrm{NL}}(\\mathbf{x})=-\\frac{2c}{\\sqrt{r^2+\\lambda^2}}$。\n\n你将实现一个在 $\\mathbb{R}^3$ 中的 Metropolis-Hastings 调整的朗之万算法 (MALA)，其提议为\n$$\n\\mathbf{y}=\\mathbf{x}+\\frac{\\tau}{2}\\,\\mathbf{b}(\\mathbf{x})+\\sqrt{\\tau}\\,\\boldsymbol{\\xi},\\quad \\boldsymbol{\\xi}\\sim \\mathcal{N}(\\mathbf{0},\\mathbf{I}_3),\n$$\n其中 $\\tau>0$ 是时间步长，$\\mathbf{b}(\\mathbf{x})$ 是漂移矢量。通用的接受概率为\n$$\n\\alpha(\\mathbf{x}\\to\\mathbf{y})=\\min\\left(1,\\exp\\big[\\ln\\pi(\\mathbf{y})-\\ln\\pi(\\mathbf{x})+\\ln q(\\mathbf{y}\\to\\mathbf{x})-\\ln q(\\mathbf{x}\\to\\mathbf{y})\\big]\\right),\n$$\n其中高斯提议密度具有均值 $\\mathbf{m}(\\mathbf{x})=\\mathbf{x}+\\frac{\\tau}{2}\\mathbf{b}(\\mathbf{x})$ 和协方差 $\\tau\\mathbf{I}_3$，并且\n$$\n\\ln q(\\mathbf{x}\\to\\mathbf{y})=-\\frac{\\|\\mathbf{y}-\\mathbf{m}(\\mathbf{x})\\|^2}{2\\tau}+\\text{const}.\n$$\n常数项在 Metropolis-Hastings 比率中被消去。对于与给定目标 $\\pi(\\mathbf{x})$ 相关联的未经修改的 MALA，漂移选择为对数目标的梯度，\n$$\n\\mathbf{b}(\\mathbf{x})=\\nabla_{\\mathbf{x}}\\ln\\pi(\\mathbf{x}).\n$$\n对于局域接触型族，这在原点处给出一个奇异漂移：\n$$\n\\mathbf{b}_{\\mathrm{L}}(\\mathbf{x})=\\frac{2c}{r^3}\\,\\mathbf{x}.\n$$\n对于非局域弥散型族，漂移是有限的：\n$$\n\\mathbf{b}_{\\mathrm{NL}}(\\mathbf{x})=\\frac{2c}{(r^2+\\lambda^2)^{3/2}}\\,\\mathbf{x}.\n$$\n为了缓解局域接触型漂移在 $r\\to 0$ 附近的奇异行为，使用一个正则化的漂移，它保持目标 $\\pi_{\\mathrm{L}}$ 不变，而只修改提议：\n$$\n\\mathbf{b}_{\\mathrm{reg}}(\\mathbf{x};\\varepsilon)=\\frac{2c}{(r^2+\\varepsilon^2)^{3/2}}\\,\\mathbf{x}.\n$$\n这个选择的动机可以在于，在未正则化漂移的分母中用 $\\sqrt{r^2+\\varepsilon^2}$ 替换 $r$，这在 $r\\to 0$ 时限制了漂移的大小。接受步骤仍然是正确的，因为提议密度是与所选漂移一致地计算的，而 Metropolis-Hastings 比率中的目标仍然是 $\\pi_{\\mathrm{L}}$。\n\n从不含时 Schrödinger 方程和变分原理出发，可以用上述形式的 $\\Psi(r)$ 来模拟短程相关性，其中 $c>0$ 编码了短程相关强度，$\\lambda>0$ 对应于非局域调节长度。在对 $\\pi(\\mathbf{x})\\propto|\\Psi(r)|^2$ 进行蒙特卡罗采样时，漂移来自重要性采样的 Fokker-Planck 形式，对于经典的 MALA，它等于 $\\ln \\pi$ 的梯度。局域接触型相互作用的奇异性质会在小 $r$ 处引起大的漂移，这会降低接受率。非局域调节器和所提出的正则化方法缓解了这个问题。\n\n你的任务是实现以下三个变体，并根据时间步长凭经验测量它们的 Metropolis 接受率：\n- 变体 A（局域，未正则化）：目标 $\\pi_{\\mathrm{L}}$，漂移 $\\mathbf{b}_{\\mathrm{L}}$。\n- 变体 B（局域，正则化）：目标 $\\pi_{\\mathrm{L}}$，漂移 $\\mathbf{b}_{\\mathrm{reg}}(\\cdot;\\varepsilon)$。\n- 变体 C（非局域）：目标 $\\pi_{\\mathrm{NL}}$，漂移 $\\mathbf{b}_{\\mathrm{NL}}$。\n\n实现和数值要求：\n- 在三维空间中工作，所有量均为无量纲。\n- 使用初始状态 $\\mathbf{x}_0=(r_0,0,0)$。\n- 使用上面定义的接受规则，以对数形式计算所有概率以避免下溢或上溢。\n- 在每个测试用例中使用固定的随机种子以保证可复现性。\n\n测试套件：\n使用 $c=0.5$ 和以下四个测试用例，每个用例运行 $N=20000$ 次 Metropolis 提议，并使用指定的参数和随机种子。在所有情况下，设置 $r_0=0.02$。\n1. 变体 A：$\\tau=0.2$，种子 $=7$。\n2. 变体 B：$\\tau=0.2$，$\\varepsilon=0.05$，种子 $=7$。\n3. 变体 C：$\\tau=0.2$，$\\lambda=0.05$，种子 $=7$。\n4. 变体 B（大时间步长的边缘情况）：$\\tau=1.0$，$\\varepsilon=0.05$，种子 $=7$。\n\n对于每种情况，计算接受率，定义为接受的提议数除以 $N$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含四个测试用例的接受率，形式为方括号内以逗号分隔的小数值列表，四舍五入到四位小数。例如：\"[0.8123,0.9340,0.9512,0.4721]\"。", "solution": "问题陈述已经过严格验证，被认为是科学上合理、定义明确且完整的。唯一且可验证解所需的所有条件、参数和定义均已提供。该问题是 Metropolis-Hastings 调整的朗之万算法 (MALA) 在计算核物理领域的一个标准应用，重点是比较针对奇异势和正则化势的不同重要性采样策略。\n\n任务是为目标概率密度 $\\pi(\\mathbf{x}) \\propto |\\Psi(r)|^2$（其中 $r = \\|\\mathbf{x}\\|$）实现一个三维（$\\mathbb{R}^3$）MALA 采样器。我们将基于试探波函数 $\\Psi(r)$ 和相关漂移项 $\\mathbf{b}(\\mathbf{x})$ 的不同选择，比较该算法的三个变体。性能指标是 Metropolis 接受率。\n\nMALA 是一种马尔可夫链蒙特卡罗 (MCMC) 方法，它利用目标分布的梯度信息来比简单的随机行走更智能地提议移动。从当前状态 $\\mathbf{x}$ 到新状态 $\\mathbf{y}$ 的提议由朗之万随机微分方程的离散化给出：\n$$\n\\mathbf{y} = \\mathbf{x} + \\frac{\\tau}{2}\\mathbf{b}(\\mathbf{x}) + \\sqrt{\\tau}\\boldsymbol{\\xi}\n$$\n其中 $\\tau > 0$ 是时间步长，$\\mathbf{b}(\\mathbf{x})$ 是漂移矢量，$\\boldsymbol{\\xi}$ 是从标准多元正态分布 $\\boldsymbol{\\xi} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_3)$ 中抽取的随机矢量。\n\n提议 $\\mathbf{y}$ 根据 Metropolis-Hastings 准则被接受或拒绝。接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{y})$ 为：\n$$\n\\alpha(\\mathbf{x}\\to\\mathbf{y}) = \\min\\left(1, \\frac{\\pi(\\mathbf{y})q(\\mathbf{y}\\to\\mathbf{x})}{\\pi(\\mathbf{x})q(\\mathbf{x}\\to\\mathbf{y})}\\right)\n$$\n其中 $q(\\mathbf{x}\\to\\mathbf{y})$ 是从 $\\mathbf{x}$ 移动到 $\\mathbf{y}$ 的提议概率密度。给定提议机制，该密度是一个高斯分布，其均值为 $\\mathbf{m}(\\mathbf{x}) = \\mathbf{x} + \\frac{\\tau}{2}\\mathbf{b}(\\mathbf{x})$，协方差为 $\\tau\\mathbf{I}_3$。其对数为：\n$$\n\\ln q(\\mathbf{x}\\to\\mathbf{y}) = -\\frac{\\|\\mathbf{y} - \\mathbf{m}(\\mathbf{x})\\|^2}{2\\tau} - \\frac{3}{2}\\ln(2\\pi\\tau)\n$$\n为避免数值下溢并提高稳定性，我们使用接受率的对数。对数接受概率的指数为：\n$$\n\\ln\\left(\\frac{\\pi(\\mathbf{y})q(\\mathbf{y}\\to\\mathbf{x})}{\\pi(\\mathbf{x})q(\\mathbf{x}\\to\\mathbf{y})}\\right) = \\ln\\pi(\\mathbf{y}) - \\ln\\pi(\\mathbf{x}) + \\ln q(\\mathbf{y}\\to\\mathbf{x}) - \\ln q(\\mathbf{x}\\to\\mathbf{y})\n$$\n提议密度的比率得到简化，因为常数项被消去：\n$$\n\\ln q(\\mathbf{y}\\to\\mathbf{x}) - \\ln q(\\mathbf{x}\\to\\mathbf{y}) = \\frac{1}{2\\tau} \\left( \\|\\mathbf{y} - \\mathbf{m}(\\mathbf{x})\\|^2 - \\|\\mathbf{x} - \\mathbf{m}(\\mathbf{y})\\|^2 \\right)\n$$\n其中 $\\mathbf{m}(\\mathbf{y}) = \\mathbf{y} + \\frac{\\tau}{2}\\mathbf{b}(\\mathbf{y})$。如果 $\\ln u  \\min(0, \\text{对数接受指数})$，则移动被接受，其中 $u \\sim \\mathcal{U}(0,1)$。\n\n该问题指定了三个不同的变体，由其对数目标密度 $\\ln\\pi(\\mathbf{x})$ 和漂移矢量 $\\mathbf{b}(\\mathbf{x})$ 定义。\n\n**变体 A（局域，未正则化）：**\n该变体使用局域接触型波函数，导致目标密度在原点处奇异。\n- 对数目标：$\\ln\\pi_{\\mathrm{L}}(\\mathbf{x}) = -\\dfrac{2c}{r}$，其中 $r = \\|\\mathbf{x}\\|$。\n- 漂移（经典选择）：$\\mathbf{b}_{\\mathrm{L}}(\\mathbf{x}) = \\nabla_{\\mathbf{x}}\\ln\\pi_{\\mathrm{L}}(\\mathbf{x}) = \\dfrac{2c}{r^3}\\mathbf{x}$。该漂移在 $r=0$ 处也是奇异的。\n\n**变体 B（局域，正则化）：**\n该变体使用与变体 A 相同的奇异目标密度，但采用正则化漂移矢量以提高原点附近的采样稳定性。这代表了一种非经典的 MALA，其中漂移不是对数目标的梯度。\n- 对数目标：$\\ln\\pi_{\\mathrm{L}}(\\mathbf{x}) = -\\dfrac{2c}{r}$。\n- 漂移（正则化提议）：$\\mathbf{b}_{\\mathrm{reg}}(\\mathbf{x};\\varepsilon) = \\dfrac{2c}{(r^2+\\varepsilon^2)^{3/2}}\\mathbf{x}$。接受概率的计算正确地将 $\\mathbf{b}_{\\mathrm{reg}}$ 用于提议项 $q$，但将 $\\pi_{\\mathrm{L}}$ 用于目标项。\n\n**变体 C（非局域）：**\n该变体使用非局域弥散型波函数，它在原点处是有限的，从而对目标密度和漂移都进行了正则化。\n- 对数目标：$\\ln\\pi_{\\mathrm{NL}}(\\mathbf{x}) = -\\dfrac{2c}{\\sqrt{r^2+\\lambda^2}}$。\n- 漂移（经典选择）：$\\mathbf{b}_{\\mathrm{NL}}(\\mathbf{x}) = \\nabla_{\\mathbf{x}}\\ln\\pi_{\\mathrm{NL}}(\\mathbf{x}) = \\dfrac{2c}{(r^2+\\lambda^2)^{3/2}}\\mathbf{x}$。\n\n对于数值实现，我们在 $\\mathbf{x}_0=(r_0, 0, 0)$ 处初始化状态，其中 $r_0=0.02$。然后我们对每个测试用例运行 $N=20000$ 次迭代。在每次迭代中，我们执行上述的提议和接受步骤，使用特定于每个变体的函数。接受率是接受的提议总数除以 $N$。\n\n四个测试用例的具体参数如下：\n1.  **用例 1（变体 A）：** $c=0.5, \\tau=0.2$，种子 $=7$。\n2.  **用例 2（变体 B）：** $c=0.5, \\tau=0.2, \\varepsilon=0.05$，种子 $=7$。\n3.  **用例 3（变体 C）：** $c=0.5, \\tau=0.2, \\lambda=0.05$，种子 $=7$。\n4.  **用例 4（变体 B）：** $c=0.5, \\tau=1.0, \\varepsilon=0.05$，种子 $=7$。\n\n实现将对每个模拟使用固定的随机种子以确保可复现性。为了处理 $\\ln\\pi_{\\mathrm{L}}$ 在 $r=0$ 处的奇异性，我们赋值 $\\ln\\pi_{\\mathrm{L}}(r=0) = -\\infty$，以确保任何到原点的提议都被拒绝。对于奇异漂移 $\\mathbf{b}_{\\mathrm{L}}$，实现了一个检查以防止除以零，如果 $r$ 在数值上与零无法区分，则返回一个零漂移矢量。\n\n```python\nimport numpy as np\n\ndef log_pi_L(r, c):\n    \"\"\"Computes the log-target for the local-contact-like family.\"\"\"\n    if r  1e-15:\n        return -np.inf\n    return -2.0 * c / r\n\ndef log_pi_NL(r, c, lam):\n    \"\"\"Computes the log-target for the nonlocal-smeared family.\"\"\"\n    return -2.0 * c / np.sqrt(r**2 + lam**2)\n\ndef drift_L(x, r, c):\n    \"\"\"Computes the unregularized drift for the local target.\"\"\"\n    if r  1e-15:\n        return np.zeros_like(x)\n    return (2.0 * c / r**3) * x\n\ndef drift_reg(x, r, c, eps):\n    \"\"\"Computes the regularized drift.\"\"\"\n    r_sq = r**2\n    return (2.0 * c / (r_sq + eps**2)**1.5) * x\n\ndef drift_NL(x, r, c, lam):\n    \"\"\"Computes the drift for the nonlocal target.\"\"\"\n    r_sq = r**2\n    return (2.0 * c / (r_sq + lam**2)**1.5) * x\n\ndef run_mala_simulation(N, x0, tau, seed, log_pi_func, drift_func):\n    \"\"\"\n    Runs a MALA simulation for a given number of steps and returns the acceptance rate.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    x = np.copy(x0)\n    dim = len(x)\n    accepted_count = 0\n\n    for _ in range(N):\n        r_x = np.linalg.norm(x)\n        b_x = drift_func(x, r_x)\n        \n        # Proposal step\n        xi = rng.normal(size=dim)\n        m_x = x + 0.5 * tau * b_x\n        y = m_x + np.sqrt(tau) * xi\n        \n        r_y = np.linalg.norm(y)\n        b_y = drift_func(y, r_y)\n        \n        # Acceptance step\n        log_pi_x = log_pi_func(r_x)\n        log_pi_y = log_pi_func(r_y)\n\n        # The log-acceptance probability exponent\n        log_alpha_exponent = log_pi_y - log_pi_x\n        \n        if np.isfinite(log_alpha_exponent):\n            m_y = y + 0.5 * tau * b_y\n            log_q_ratio = (np.sum((y - m_x)**2) - np.sum((x - m_y)**2)) / (2.0 * tau)\n            log_alpha_exponent += log_q_ratio\n\n        if np.log(rng.uniform())  min(0.0, log_alpha_exponent):\n            x = y\n            accepted_count += 1\n            \n    return accepted_count / N\n\ndef solve():\n    \"\"\"\n    Sets up and runs the four test cases as specified in the problem statement.\n    \"\"\"\n    c = 0.5\n    N = 20000\n    r0 = 0.02\n    x0 = np.array([r0, 0.0, 0.0])\n    \n    test_cases = [\n        {'variant': 'A', 'tau': 0.2, 'seed': 7, 'params': {}},\n        {'variant': 'B', 'tau': 0.2, 'seed': 7, 'params': {'eps': 0.05}},\n        {'variant': 'C', 'tau': 0.2, 'seed': 7, 'params': {'lam': 0.05}},\n        {'variant': 'B', 'tau': 1.0, 'seed': 7, 'params': {'eps': 0.05}}\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        tau = case['tau']\n        seed = case['seed']\n        params = case['params']\n        \n        if case['variant'] == 'A':\n            log_pi = lambda r: log_pi_L(r, c)\n            drift = lambda x, r: drift_L(x, r, c)\n        \n        elif case['variant'] == 'B':\n            eps = params['eps']\n            log_pi = lambda r: log_pi_L(r, c)\n            drift = lambda x, r: drift_reg(x, r, c, eps)\n            \n        elif case['variant'] == 'C':\n            lam = params['lam']\n            log_pi = lambda r: log_pi_NL(r, c, lam)\n            drift = lambda x, r: drift_NL(x, r, c, lam)\n\n        rate = run_mala_simulation(N, x0, tau, seed, log_pi, drift)\n        results.append(rate)\n\n    # This part is for generating the answer string, not part of the required output format.\n    # print(f\"[{','.join(f'{r:.4f}' for r in results)}]\")\n\n# To generate the answer, one would run solve()\n# solve()\n```", "answer": "[0.1740,0.9419,0.9413,0.4907]", "id": "3610701"}]}