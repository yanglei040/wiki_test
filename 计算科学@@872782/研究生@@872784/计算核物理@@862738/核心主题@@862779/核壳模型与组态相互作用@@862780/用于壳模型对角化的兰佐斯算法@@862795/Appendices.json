{"hands_on_practices": [{"introduction": "为了高效地使用任何算法，我们首先必须理解其计算成本。这个练习将单步 Lanczos 迭代分解为其基本步骤，并要求计算总的浮点运算（FLOPs）次数。这项分析对于识别计算瓶颈至关重要，并揭示了为何在大规模壳模型计算中，哈密顿量与矢量的乘积 ($H v$) 会主导总运行时间 [@problem_id:3603207]。", "problem": "您正在实现Lanczos算法，以在磁量子数方案（m-方案）中计算一个大规模稀疏原子核壳模型哈密顿量的极端本征对。哈密顿量 $H$ 表示为单体和双体部分之和，并通过一个预先计算的、关于斯莱特行列式之间非零耦合的连接列表作用于一个态矢量。多体基的维度为 $N$，单体连接数为 $M_{1}$，双体连接数为 $M_{2}$。在累积 $y \\leftarrow H v$ 时，每个连接贡献一次乘法和一次加法，因此 $y \\leftarrow H v$ 的代价是 $2(M_{1} + M_{2})$ 次浮点运算（FLOPs），其中一次浮点运算（FLOP）定义为一次加法或一次乘法。在一次Lanczos迭代中，您对 $\\mathbb{R}^{N}$ 中的矢量执行以下步骤：\n(1) $y \\leftarrow H v$, \n(2) $\\alpha \\leftarrow v^{\\top} y$, \n(3) $y \\leftarrow y - \\alpha v - \\beta_{\\mathrm{prev}} v_{\\mathrm{prev}}$, \n(4) $\\beta \\leftarrow \\| y \\|_{2}$, 以及 \n(5) $v_{\\mathrm{next}} \\leftarrow y / \\beta$。\n假设采用以下FLOP模型：每次加法或乘法代价为 $1$ FLOP，每次除法代价为 $d$ FLOPs，每次平方根代价为 $s$ FLOPs。不存在再正交化和重启开销。仅从这些定义和Lanczos迭代的标准结构出发，推导单次迭代总FLOP数 $C_{\\mathrm{iter}}$ 关于 $M_{1}$、$M_{2}$、$N$、$d$ 和 $s$ 的闭式解析表达式。然后，在m-方案实现中双体项占主导地位的假设下（即 $M_{2} \\gg M_{1}$ 和 $M_{2} \\gg N$），将 $C_{\\mathrm{iter}}$ 简化为其主导项。将您的最终答案表示为 $C_{\\mathrm{iter}}$ 的主阶解析表达式。", "solution": "问题要求推导将标准Lanczos迭代应用于原子核壳模型哈密顿量时，每次迭代的总浮点运算（FLOP）数，记为 $C_{\\mathrm{iter}}$。随后，该表达式必须在指定的占优条件下简化为其主导项。\n\n分析将按照问题陈述中提供的方式，将一次完整的Lanczos迭代分解为其五个组成步骤。对于每个步骤，我们将根据给定的FLOP模型计算浮点运算（加法、乘法、除法、平方根）的次数，其中加法和乘法的代价为 $1$ FLOP，除法为 $d$ FLOPs，平方根为 $s$ FLOPs。所有矢量均在 $\\mathbb{R}^{N}$ 中。\n\n1.  **步骤1：哈密顿量-矢量乘积，$y \\leftarrow H v$**\n    问题陈述指明，将哈密顿量 $H$ 作用于矢量 $v$ 的代价由预计算数据结构中的单体（$M_1$）和双体（$M_2$）连接数决定。每个连接对应一次乘法和一次加法。\n    此步骤的总FLOP数明确给出为：\n    $$C_1 = 2(M_1 + M_2)$$\n\n2.  **步骤2：点积，$\\alpha \\leftarrow v^{\\top} y$**\n    此步骤计算两个维度为 $N$ 的矢量 $v$ 和 $y$ 的点积。点积定义为 $\\alpha = \\sum_{i=1}^{N} v_i y_i$。该计算涉及 $N$ 次乘法（用于每个项 $v_i y_i$）和 $N-1$ 次加法（用于将这些乘积相加）。\n    此步骤的总FLOP数为：\n    $$C_2 = N + (N-1) = 2N - 1$$\n\n3.  **步骤3：矢量更新（正交化），$y \\leftarrow y - \\alpha v - \\beta_{\\mathrm{prev}} v_{\\mathrm{prev}}$**\n    该操作通过减去当前和前一个Lanczos矢量 $v$ 和 $v_{\\mathrm{prev}}$ 的缩放版本来更新矢量 $y$。此更新是逐分量执行的。对于从 $1$ 到 $N$ 的每个分量 $i$，操作为 $y_i \\leftarrow y_i - \\alpha v_i - \\beta_{\\mathrm{prev}} (v_{\\mathrm{prev}})_i$。这需要两次乘法（用于计算 $\\alpha v_i$ 和 $\\beta_{\\mathrm{prev}} (v_{\\mathrm{prev}})_i$）和两次减法。由于一次减法代价为 $1$ FLOP，因此对 $N$ 个分量的总代价是 $2N$ 次乘法和 $2N$ 次减法。\n    此步骤的总FLOP数为：\n    $$C_3 = 2N + 2N = 4N$$\n\n4.  **步骤4：矢量范数，$\\beta \\leftarrow \\| y \\|_{2}$**\n    此步骤计算更新后的矢量 $y$ 的欧几里得范数（或 $2$-范数），即 $\\beta = \\sqrt{\\sum_{i=1}^{N} y_i^2}$。计算过程如下：\n    -   计算每个分量的平方 $y_i^2$：$N$ 次乘法。\n    -   将平方相加：$N-1$ 次加法。\n    -   对总和取平方根：$1$ 次平方根运算。\n    此步骤的总FLOP数为：\n    $$C_4 = N + (N-1) + s = 2N - 1 + s$$\n\n5.  **步骤5：矢量归一化，$v_{\\mathrm{next}} \\leftarrow y / \\beta$**\n    此步骤将矢量 $y$ 归一化，以生成下一个Lanczos矢量 $v_{\\mathrm{next}}$。该操作包括将矢量 $y$ 的 $N$ 个分量中的每一个都除以标量 $\\beta$。这构成了 $N$ 次独立的除法运算。\n    考虑到每次除法的代价为 $d$ FLOPs，此步骤的总FLOP数为：\n    $$C_5 = N d$$\n\n每次迭代的总FLOP数 $C_{\\mathrm{iter}}$ 是这五个步骤代价的总和：\n$$C_{\\mathrm{iter}} = C_1 + C_2 + C_3 + C_4 + C_5$$\n$$C_{\\mathrm{iter}} = (2(M_1 + M_2)) + (2N - 1) + (4N) + (2N - 1 + s) + (Nd)$$\n合并各项，我们得到闭式解析表达式：\n$$C_{\\mathrm{iter}} = 2M_1 + 2M_2 + 8N + Nd + s - 2$$\n\n问题的第二部分要求在相互作用的双体部分占主导地位的假设下，将此表达式简化为其主导项。这由条件 $M_2 \\gg M_1$ 和 $M_2 \\gg N$ 表明。这些条件意味着 $M_2$ 是表征问题规模的最大参数。我们在 $M_2$ 很大的渐近极限下分析 $C_{\\mathrm{iter}}$ 的行为。\n\n$C_{\\mathrm{iter}}$ 的表达式是几项之和：$2M_2$、$2M_1$、$8N$、$Nd$ 和 $s-2$。\n- 项 $2M_2$ 与 $M_2$ 成正比。\n- 因为 $M_2 \\gg M_1$，项 $2M_1$ 与 $2M_2$ 相比可以忽略不计。\n- 因为 $M_2 \\gg N$，项 $8N$ 与 $2M_2$ 相比可以忽略不计。\n- 因为 $M_2 \\gg N$ 且 $d$ 是一个固定常数，项 $Nd$ 与 $2M_2$ 相比也可以忽略不计。\n- 项 $s-2$ 是一个常数，因此对于大的 $M_2$ 来说可以忽略不计。\n\n形式上，我们可以将 $C_{\\mathrm{iter}}$ 写为：\n$$C_{\\mathrm{iter}} = 2M_2 \\left(1 + \\frac{M_1}{M_2} + \\frac{4N}{M_2} + \\frac{Nd}{2M_2} + \\frac{s-2}{2M_2}\\right)$$\n在 $M_2 \\rightarrow \\infty$ 的极限下，比率 $\\frac{M_1}{M_2}$、$\\frac{N}{M_2}$ 和 $\\frac{1}{M_2}$ 都趋近于零。因此，括号中的表达式趋近于 $1$。$C_{\\mathrm{iter}}$ 表达式中的主导项（或主阶项）是随问题规模增长最快的那一项，也就是与 $M_2$ 成正比的项。\n\n因此，单次迭代FLOP数的主阶解析表达式为：\n$$C_{\\mathrm{iter}} \\approx 2M_2$$\n这个结果反映了一个众所周知的事实，即在大规模壳模型计算中，计算代价绝大部分由应用哈密顿量的双体部分所主导。", "answer": "$$\\boxed{2M_2}$$", "id": "3603207"}, {"introduction": "在理解了每次迭代的成本之后，下一个关键问题是确定算法何时找到了足够精确的本征对近似解。本练习引入了里兹对（Ritz pair）和残差范数（residual norm）的概念，后者是衡量近似本征对质量的一个实用且计算成本低廉的指标。通过一个具体的微型例子，你将对 Lanczos 过程如何预示本征值的收敛获得直观的理解 [@problem_id:3603131]。", "problem": "在原子核壳模型哈密顿量的大规模对角化中，我们使用 Lanczos 算法来构建一个标准正交 Krylov 基和一个投影对称三对角矩阵。考虑一个作用于维度 $N \\gg 4$ 的希尔伯特空间上的实对称哈密顿量 $H$，以及一次从归一化初始向量 $v_1$ 开始的 Lanczos 运行，该运行产生 4 步标准正交 Lanczos 基 $Q_{4} = [v_{1}, v_{2}, v_{3}, v_{4}]$ 和相关的对称三对角矩阵 $T_{4} \\in \\mathbb{R}^{4 \\times 4}$，其对角元为 $\\alpha_{i}$，次/超对角元为 $\\beta_{i}$，由三项递推关系确定。设系数指定为\n$$\n\\alpha_{1}=\\alpha_{2}=\\alpha_{3}=\\alpha_{4}=0,\\quad \\beta_{1}=\\beta_{2}=\\beta_{3}=1,\\quad \\beta_{4}=\\frac{1}{100}.\n$$\n因此，\n$$\nT_{4}=\\begin{pmatrix}\n0  1  0  0 \\\\\n1  0  1  0 \\\\\n0  1  0  1 \\\\\n0  0  1  0\n\\end{pmatrix}.\n$$\n从 $H$ 的 Lanczos 三项递推关系和 Lanczos 向量的标准正交性出发，推导通过对角化 $T_{4}$ 并通过 $x=Q_{4}y$ 将 $y$ 嵌入回全空间得到的 Ritz 对 $(\\lambda,y)$ 的残差形式。然后，对于给定的 $T_{4}$：\n- 计算 $T_4$ 的四个特征值和相应的归一化特征向量 $y$。\n- 使用推导出的残差表达式，根据每个归一化特征向量的最后一个分量 $y_4$ 和给定的 $\\beta_4=\\frac{1}{100}$，计算嵌入的 Ritz 对的四个残差范数。\n\n将所有特征值和残差范数表示为精确的闭合形式，而非数值近似值。将你的最终答案以一个单行矩阵的形式报告，该矩阵包含按升序排列的四个特征值，其后是按相同顺序排列的四个对应的残差范数。不需要单位，不允许四舍五入。", "solution": "本问题要求推导 Lanczos 残差范数，并针对从一个特定的 $4 \\times 4$ 三对角矩阵 $T_4$ 中找到的 Ritz 对进行求值。\n\n首先，我们推导 Ritz 对残差范数的一般表达式。Lanczos 算法通过一个三项递推关系生成一系列称为 Lanczos 向量的标准正交向量 $v_j$。该递推关系通过将哈密顿量 $H$ 应用于每个向量 $v_j$，并将结果与前两个向量正交化来定义。对于一个实对称哈密顿量 $H$，该递推关系为：\n$$Hv_j = \\beta_{j-1}v_{j-1} + \\alpha_j v_j + \\beta_j v_{j+1}$$\n其中 $v_0=0$，$v_1$ 是一个选定的归一化初始向量，系数 $\\alpha_j$ 和 $\\beta_j$ 由下式给出：\n$$\\alpha_j = v_j^T H v_j$$\n$$\\beta_j = \\| H v_j - \\alpha_j v_j - \\beta_{j-1}v_{j-1} \\|$$\n经过 $k$ 步后，此过程生成一个标准正交基 $Q_k = [v_1, v_2, \\dots, v_k]$ 和一个实对称三对角矩阵 $T_k$，其对角元为 $\\alpha_j$，非对角元为 $\\beta_j$。该递推关系可以写成矩阵形式：\n$$HQ_k = Q_k T_k + r_k e_k^T$$\n其中 $r_k = \\beta_k v_{k+1}$ 是 $k$ 步 Lanczos 过程的残差向量，$e_k$ 是 $\\mathbb{R}^k$ 中的第 $k$ 个标准基向量，即 $e_k = (0, \\dots, 0, 1)^T$。\n\n一个 Ritz 对 $(\\lambda, x)$ 是 $H$ 的一个特征对的近似。它是通过对角化投影矩阵 $T_k$ 得到的：\n$$T_k y = \\lambda y$$\n其中 $y$ 是 $T_k$ 的一个归一化特征向量，$\\lambda$ 是对应的特征值（Ritz 值）。Ritz 向量 $x$ 是将 $y$ 投影回全希尔伯特空间的结果：\n$$x = Q_k y$$\nRitz 对 $(\\lambda, x)$ 的残差定义为 $R = Hx - \\lambda x$。我们求其范数 $\\|R\\|$。代入 $x$ 和 $HQ_k$ 的表达式：\n$$R = H(Q_k y) - \\lambda(Q_k y) = (HQ_k)y - Q_k(\\lambda y)$$\n$$R = (Q_k T_k + r_k e_k^T)y - Q_k(T_k y)$$\n使用 $T_k y = \\lambda y$，第二项变为 $Q_k(\\lambda y)$。由于矩阵乘法满足结合律，这等于 $Q_k T_k y$。\n$$R = Q_k T_k y + r_k e_k^T y - Q_k T_k y = r_k e_k^T y$$\n代入 $r_k = \\beta_k v_{k+1}$：\n$$R = (\\beta_k v_{k+1}) (e_k^T y)$$\n项 $e_k^T y$ 是 $e_k$ 和 $y$ 的标量积，它提取出向量 $y$ 的第 $k$ 个分量，记作 $y_k$。\n$$R = \\beta_k y_k v_{k+1}$$\n于是残差的范数是：\n$$\\|R\\| = \\|\\beta_k y_k v_{k+1}\\| = |\\beta_k| |y_k| \\|v_{k+1}\\|$$\n由于 Lanczos 向量是标准正交的，$\\|v_{k+1}\\|=1$。因此，残差范数由下式给出：\n$$\\|R\\| = |\\beta_k| |y_k|$$\n对于本问题，$k=4$，所以给定 Ritz 对的残差范数是 $\\|R\\| = |\\beta_4| |y_4|$。\n\n接下来，我们必须找到给定矩阵 $T_4$ 的特征值和特征向量：\n$$T_4 = \\begin{pmatrix} 0  1  0  0 \\\\ 1  0  1  0 \\\\ 0  1  0  1 \\\\ 0  0  1  0 \\end{pmatrix}$$\n特征多项式是 $P(\\lambda) = \\det(T_4 - \\lambda I)$：\n$$P(\\lambda) = \\det \\begin{pmatrix} -\\lambda  1  0  0 \\\\ 1  -\\lambda  1  0 \\\\ 0  1  -\\lambda  1 \\\\ 0  0  1  -\\lambda \\end{pmatrix}$$\n沿第一行展开：\n$$P(\\lambda) = -\\lambda \\det \\begin{pmatrix} -\\lambda  1  0 \\\\ 1  -\\lambda  1 \\\\ 0  1  -\\lambda \\end{pmatrix} - 1 \\det \\begin{pmatrix} 1  1  0 \\\\ 0  -\\lambda  1 \\\\ 0  1  -\\lambda \\end{pmatrix}$$\n$$P(\\lambda) = -\\lambda(-\\lambda(\\lambda^2-1) - 1(-\\lambda)) - 1(1(\\lambda^2-1))$$\n$$P(\\lambda) = -\\lambda(-\\lambda^3 + 2\\lambda) - (\\lambda^2-1) = \\lambda^4 - 2\\lambda^2 - \\lambda^2 + 1 = \\lambda^4 - 3\\lambda^2 + 1$$\n令 $u = \\lambda^2$。特征方程变为关于 $u$ 的二次方程：$u^2 - 3u + 1 = 0$。\n$u$ 的解是：\n$$u = \\frac{3 \\pm \\sqrt{9-4}}{2} = \\frac{3 \\pm \\sqrt{5}}{2}$$\n所以，$\\lambda^2 = \\frac{3 + \\sqrt{5}}{2}$ 或 $\\lambda^2 = \\frac{3 - \\sqrt{5}}{2}$。\n这些值与黄金比例 $\\phi = \\frac{1+\\sqrt{5}}{2}$ 的平方有关。具体来说，$\\phi^2 = \\frac{3+\\sqrt{5}}{2}$ 且 $(1/\\phi)^2 = (\\frac{\\sqrt{5}-1}{2})^2 = \\frac{3-\\sqrt{5}}{2}$。\n四个特征值是 $\\lambda = \\pm \\phi$ 和 $\\lambda = \\pm 1/\\phi$。\n按升序排列，特征值 $\\lambda_1, \\lambda_2, \\lambda_3, \\lambda_4$ 是：\n$$\\lambda_1 = -\\frac{1+\\sqrt{5}}{2}, \\quad \\lambda_2 = -\\frac{\\sqrt{5}-1}{2} = \\frac{1-\\sqrt{5}}{2}, \\quad \\lambda_3 = \\frac{\\sqrt{5}-1}{2}, \\quad \\lambda_4 = \\frac{1+\\sqrt{5}}{2}$$\n\n现在我们求相应的归一化特征向量 $y = (y_1, y_2, y_3, y_4)^T$。对于一个特征值 $\\lambda$，特征向量满足方程组 $(T_4 - \\lambda I)y = 0$。我们可以通过从最后一个分量开始反向求解来确定未归一化的特征向量。设 $y_4=1$。\n- 从方程 $y_3 - \\lambda y_4 = 0$，我们得到 $y_3 = \\lambda y_4 = \\lambda$。\n- 从方程 $y_2 - \\lambda y_3 + y_4 = 0$，我们得到 $y_2 = \\lambda y_3 - y_4 = \\lambda(\\lambda) - 1 = \\lambda^2 - 1$。\n- 从方程 $y_1 - \\lambda y_2 + y_3 = 0$，我们得到 $y_1 = \\lambda y_2 - y_3 = \\lambda(\\lambda^2-1) - \\lambda = \\lambda^3 - 2\\lambda$。\n因此，未归一化的特征向量与 $(\\lambda^3-2\\lambda, \\lambda^2-1, \\lambda, 1)^T$ 成比例。该向量的范数平方为 $S(\\lambda) = (\\lambda^3-2\\lambda)^2 + (\\lambda^2-1)^2 + \\lambda^2 + 1^2$。利用特征方程 $\\lambda^4 = 3\\lambda^2 - 1$，我们可以简化这个表达式：\n$S(\\lambda) = -\\lambda^4+5\\lambda^2+1 = -(3\\lambda^2-1) + 5\\lambda^2+1 = 2\\lambda^2+2$。\n因此，归一化特征向量的第四个分量 $y_4$ 的绝对值为 $|y_4| = \\frac{1}{\\sqrt{S(\\lambda)}} = \\frac{1}{\\sqrt{2\\lambda^2+2}}$。\n\n对于两端的特征值 $\\lambda_1 = -\\phi$ 和 $\\lambda_4 = \\phi$，我们有 $\\lambda^2 = \\phi^2 = \\frac{3+\\sqrt{5}}{2}$。\n$|y_4| = \\frac{1}{\\sqrt{2\\phi^2+2}} = \\frac{1}{\\sqrt{2(\\frac{3+\\sqrt{5}}{2})+2}} = \\frac{1}{\\sqrt{5+\\sqrt{5}}}$。\n残差范数为 $\\|R\\| = |\\beta_4||y_4| = \\frac{1}{100} \\frac{1}{\\sqrt{5+\\sqrt{5}}}$。\n\n对于内部的特征值 $\\lambda_2 = -1/\\phi$ 和 $\\lambda_3 = 1/\\phi$，我们有 $\\lambda^2 = (1/\\phi)^2 = \\frac{3-\\sqrt{5}}{2}$。\n$|y_4| = \\frac{1}{\\sqrt{2(1/\\phi)^2+2}} = \\frac{1}{\\sqrt{2(\\frac{3-\\sqrt{5}}{2})+2}} = \\frac{1}{\\sqrt{5-\\sqrt{5}}}$。\n残差范数为 $\\|R\\| = |\\beta_4||y_4| = \\frac{1}{100} \\frac{1}{\\sqrt{5-\\sqrt{5}}}$。\n\n最终结果按特征值升序排列。\n特征值：\n$\\lambda_1 = -\\frac{1+\\sqrt{5}}{2}$\n$\\lambda_2 = \\frac{1-\\sqrt{5}}{2}$\n$\\lambda_3 = \\frac{\\sqrt{5}-1}{2}$\n$\\lambda_4 = \\frac{1+\\sqrt{5}}{2}$\n\n对应的残差范数：\n对于 $\\lambda_1$: $R_1 = \\frac{1}{100\\sqrt{5+\\sqrt{5}}}$\n对于 $\\lambda_2$: $R_2 = \\frac{1}{100\\sqrt{5-\\sqrt{5}}}$\n对于 $\\lambda_3$: $R_3 = \\frac{1}{100\\sqrt{5-\\sqrt{5}}}$\n对于 $\\lambda_4$: $R_4 = \\frac{1}{100\\sqrt{5+\\sqrt{5}}}$\n这些就是所要求的精确闭合形式表达式。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{1+\\sqrt{5}}{2}  \\frac{1-\\sqrt{5}}{2}  \\frac{\\sqrt{5}-1}{2}  \\frac{1+\\sqrt{5}}{2}  \\frac{1}{100\\sqrt{5+\\sqrt{5}}}  \\frac{1}{100\\sqrt{5-\\sqrt{5}}}  \\frac{1}{100\\sqrt{5-\\sqrt{5}}}  \\frac{1}{100\\sqrt{5+\\sqrt{5}}}\n\\end{pmatrix}\n}\n$$", "id": "3603131"}, {"introduction": "对于壳模型问题所涉及的巨大维度，“教科书式”的 Lanczos 算法通常是不切实际的，因为它需要存储一组不断增长的 Lanczos 矢量。本练习通过探索厚重启（thick-restart）策略来解决这一现实世界中的限制，这是一种限制内存使用的常用技术。你将学习如何通过平衡内存预算与确保稳健收敛所需的信息量，来确定一个实用的重启窗口大小，特别是在具有密集谱的现实场景中 [@problem_id:3603169]。", "problem": "考虑一个在钙核区进行的大尺度组态相互作用壳模型计算，该计算使用一个质子-中子 $pf$ 壳价空间（包含单粒子轨道 $0f_{7/2}$、$0f_{5/2}$、$1p_{3/2}$ 和 $1p_{1/2}$）。多体哈密顿量在 $M$-方案基矢下是厄米和稀疏的，并使用 Lanczos 算法及厚重启策略进行对角化，以计算 $k$ 个最低本征态。\n\n假设存在以下科学上符合实际的场景和约束条件：\n- 在固定总投影量子数后，工作基矢的维度为 $N = 2.4 \\times 10^{7}$。\n- 该算法使用双精度存储，因此每个矢量分量占用 $8$ 字节。\n- 厚重启策略在重启时保留 $w$ 个 Ritz 矢量，并需要三个额外的全长工作矢量用于递推和再正交化。\n- $M_{\\text{vec}} = 20\\,\\mathrm{GB}$ 的内存预算专门用于存储这些 Lanczos 矢量，且在此规模下没有其他数组占用此预算。\n- 您的目标是计算 $k = 30$ 个最低本征态。\n- 在具有成簇低能谱的典型 $pf$ 壳空间中，为实现厚重启的稳健收敛，需要在目标 $k$ 个本征态之外，维持一个由 $g = 20$ 个额外 Ritz 矢量组成的“保护带”，以缓冲近简并或紧密成簇的态。\n\n从 Lanczos Krylov 子空间和厚重启机制的定义出发，利用基本的存储计算，确定一个与内存预算和预期收敛行为相符的实际重启窗口大小 $w$。将最终答案表示为 $w$ 的整数值。最终答案中不要包含单位。", "solution": "用户提供了一个问题，需要在强制验证后解决。\n\n### 步骤 1：提取已知条件\n- **背景**：在钙核区进行的大尺度组态相互作用壳模型计算。\n- **价空间**：质子-中子 $pf$ 壳 ($0f_{7/2}$, $0f_{5/2}$, $1p_{3/2}$, $1p_{1/2}$)。\n- **哈密顿量性质**：在 $M$-方案基矢下是厄米的和稀疏的。\n- **算法**：使用厚重启策略的 Lanczos 算法。\n- **基矢维度**：$N = 2.4 \\times 10^{7}$。\n- **存储精度**：双精度，对应每个矢量分量 $8$ 字节。\n- **厚重启的矢量存储**：该算法在重启时保留 $w$ 个 Ritz 矢量，并需要三个额外的全长工作矢量用于递推和再正交化步骤。\n- **内存预算**：总共 $M_{\\text{vec}} = 20\\,\\mathrm{GB}$ 专门分配给这些 Lanczos 矢量。\n- **目标本征态**：需要计算 $k = 30$ 个最低本征态。\n- **收敛保护带**：维持一个由 $g = 20$ 个额外 Ritz 矢量组成的保护带，以确保稳健收敛。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在计算核物理领域内定义明确且具有科学依据。所有提供的参数和描述的场景对于现代大尺度壳模型计算而言都是现实和标准的。Lanczos 算法、厚重启策略以及保护带概念的使用是既定的实践方法。基矢维度、内存预算和目标态的数量与当前的研究标准一致。该问题是自洽的，提供了执行所需计算的所有必要数据。不存在矛盾、歧义或违反科学原理的地方。\n\n### 步骤 3：结论与行动\n问题有效。将提供一个完整的、有理有据的解答。\n\n### 解答\n该问题要求为厚重启 Lanczos 算法确定一个实际可行的重启窗口大小，记为 $w$。该值必须与预期的收敛行为和可用的内存预算都相符。\n\n首先，我们根据问题的物理背景，特别是收敛特性，来确定对 $w$ 的要求。目标是计算 $k=30$ 个最低本征态。在基于 Lanczos 的方法中，尤其是在处理 $pf$ 壳中常见的稠密或成簇的能谱时，有必要计算比所需本征态数量更多的 Ritz 矢量来确保其收敛。这是通过引入一个“保护带”来管理的。问题指定了一个由 $g=20$ 个额外 Ritz 矢量组成的保护带。因此，为了确保稳健收敛，在重启过程中应保留的 Ritz 矢量数量是所需本征态数量与保护带大小之和。这定义了实际的重启窗口大小 $w$：\n$$ w = k + g $$\n代入给定值：\n$$ w = 30 + 20 = 50 $$\n这个值 $w=50$ 代表了由计算的收敛要求所决定的重启窗口大小。\n\n接下来，我们必须验证这个选择是否与指定的内存预算相符。Lanczos 矢量所消耗的总内存不得超过分配的预算 $M_{\\text{vec}} = 20\\,\\mathrm{GB}$。\n\n必须同时保存在内存中的全长矢量总数 $n_{\\text{vec}}$，包括重启时保留的 $w$ 个 Ritz 矢量，以及算法所需的三个额外工作矢量。\n$$ n_{\\text{vec}} = w + 3 $$\n对于我们提出的 $w=50$，矢量数量为：\n$$ n_{\\text{vec}} = 50 + 3 = 53 $$\n\n存储单个全长矢量所需的内存 $S_{\\text{vec}}$ 由基矢维度 $N$ 和每个分量的存储大小决定。计算使用双精度，即每个分量 $8$ 字节。\n$$ S_{\\text{vec}} = N \\times (\\text{每个分量的字节数}) $$\n$$ S_{\\text{vec}} = (2.4 \\times 10^{7}) \\times 8\\,\\text{字节} = 1.92 \\times 10^{8}\\,\\text{字节} $$\n\n所需的总内存 $M_{\\text{req}}$ 是矢量数量与每个矢量大小的乘积。\n$$ M_{\\text{req}} = n_{\\text{vec}} \\times S_{\\text{vec}} $$\n$$ M_{\\text{req}} = 53 \\times (1.92 \\times 10^{8}\\,\\text{字节}) = 101.76 \\times 10^{8}\\,\\text{字节} = 1.0176 \\times 10^{10}\\,\\text{字节} $$\n\n现在，必须将这个所需内存与可用预算 $M_{\\text{vec}} = 20\\,\\mathrm{GB}$ 进行比较。我们将使用标准的国际单位制 (SI) 定义，其中 $1\\,\\mathrm{GB} = 10^{9}\\,\\text{bytes}$。\n$$ M_{\\text{vec}} = 20 \\times 10^{9}\\,\\text{字节} = 2.0 \\times 10^{10}\\,\\text{字节} $$\n\n我们现在可以检查 $w=50$ 的内存需求是否在预算范围内：\n$$ M_{\\text{req}} = 1.0176 \\times 10^{10}\\,\\text{字节} $$\n$$ M_{\\text{vec}} = 2.0 \\times 10^{10}\\,\\text{字节} $$\n由于 $1.0176 \\times 10^{10}  2.0 \\times 10^{10}$，所需内存远低于分配的预算。\n\n问题要求确定一个实际可行的重启窗口大小 $w$。收敛行为表明应取 $w=50$。我们的存储计算证实，在给定的内存约束下，这个选择是可行的。因此，重启窗口大小的实际且一致的值为 $w=50$。", "answer": "$$\\boxed{50}$$", "id": "3603169"}]}