{"hands_on_practices": [{"introduction": "连续谱离散耦合通道（CDCC）方法的核心在于将总散射波函数在一个由弹核内部状态构成的基上展开。理论上，这个基是无限的，但在实际计算中必须进行截断。本练习将引导你探索模型空间收敛性这一基本概念，通过一个简化的幺正模型，研究如何基于物理直觉选择截断参数，并量化截断对结果的影响。你将亲自实现对弹核内禀轨道角动量 $l$ 和质心轨道角动量 $L$ 的截断，并分析弹性散射和破裂反应截面随模型空间增大的收敛趋势。这项实践旨在培养任何大规模数值模拟都需具备的关键技能：系统地检验计算结果对模型空间大小的依赖性，并为所选的截断提供物理解释 ([@problem_id:3552265])。", "problem": "考虑一个简化的连续谱离散化耦合道 (CDCC) 方法的实现，用于描述两体弹核在无结构靶上的散射过程。连续谱离散化耦合道方法将总散射波函数在一个耦合道基中展开，该基由弹核内禀态和质心 (c.m.) 分波构成。在本问题中，你将实现弹核内禀轨道角动量 $l$ 和质心轨道角动量 $L$ 的截断方案，利用半经典和离心势垒论证来为所选的截断值提供物理依据，并通过考察截断边界增大时的收敛趋势来评估其对弹性散射和破裂反应观测量产生的影响。\n\n从以下基本原理出发：\n\n- 用于跃迁矩阵 $T$ 的 Lippmann-Schwinger 方程：$$T(E) = V + V G_0(E) T(E),$$ 其中 $G_0(E)$ 是自由预解算符，$V$ 是相互作用。\n- 通过主值积分定义反应矩阵 $K$（也称为 $K$ 矩阵），由此得到幺正散射矩阵 $S$，其表达式为 $$S = (I - i K)(I + i K)^{-1},$$ 其中 $I$ 是单位矩阵。\n- 质心运动的分波展开，其中给定的质心轨道角动量 $L$ 在半经典近似下对应于碰撞参数 $b \\approx (L + 1/2)/k$（$k$ 为质心波数），较大的 $L$ 对应于较大的 $b$，此时相互作用较弱。\n- 弹核内禀运动的离心势垒，对于内禀轨道角动量 $l$ 和弹核尺寸标度 $a_{\\text{proj}}$，在半径 $a_{\\text{proj}}$ 处的离心能标近似为 $$E_{\\text{cent}}(l) \\approx \\frac{l(l+1)\\hbar^2}{2 \\mu a_{\\text{proj}}^2},$$ 其中 $\\mu$ 是约化质量。\n\n为使计算易于处理，同时保持幺正性和 CDCC 方法的核心思想，我们对每个质心分波 $L$ 采用一个秩一可分离耦合模型。其道基由一个弹性道（弹核基态）和一组由 $(l,n)$ 索引的离散化连续谱道组成，其中 $l$ 是弹核内禀轨道角动量，$n$ 用于枚举内禀连续谱能量箱。对于每个固定的 $L$，定义一个耦合矢量 $v^{(L)}$，其分量为\n$$v^{(L)}_0 = g_0 f_L(L), \\quad v^{(L)}_{(l,n)} = g_0 \\beta f_L(L) f_l(l) b_n,$$\n其中 $g_0$ 是基础耦合强度，$\\beta$ 是一个控制弹性耦合与破裂耦合平衡的无量纲比率，$f_L(L)$ 和 $f_l(l)$ 是具有物理动机的形状因子，用以确保耦合强度随 $L$ 和 $l$ 的增加而衰减，$b_n$ 是能量箱权重，对每个 $l$ 满足 $\\sum_n b_n^2 = 1$。使用秩一 $K$ 矩阵\n$$K^{(L)} = v^{(L)} \\left(v^{(L)}\\right)^{\\mathrm{T}}$$\n来为每个 $L$ 构建幺正 $S$ 矩阵，方法如下：\n$$S^{(L)} = \\left(I - i K^{(L)}\\right)\\left(I + i K^{(L)}\\right)^{-1}.$$\n\n使用半经典和势垒论证来定义形状因子：\n- 对于质心分波，使用 $$f_L(L) = \\exp\\left(-\\left(\\frac{L}{L_c}\\right)^2\\right), \\quad L_c \\equiv k R_{\\text{int}},$$ 其中 $R_{\\text{int}}$ 是质心动力学的有效相互作用半径，$k$ 是质心波数。这确保了在碰撞参数 $b \\gg R_{\\text{int}}$（即 $L \\gg k R_{\\text{int}}$）时，耦合可以忽略不计。\n- 对于弹核内禀运动，使用 $$f_l(l) = \\exp\\left(-\\left(\\frac{l}{l_c}\\right)^2\\right), \\quad l_c \\equiv a_{\\text{proj}} \\sqrt{2 \\mu E_{\\max}}/\\hbar,$$ 其中 $E_{\\max}$ 是所包含的最大内禀连续谱能量，$\\mu$ 是弹核的约化质量，$a_{\\text{proj}}$ 是特征弹核尺寸。这确保了当 $l$ 在 $a_{\\text{proj}}$ 处的离心势垒远超 $E_{\\max}$ 时，耦合会被抑制。\n\n对于每个 $L$，根据幺正 $S$ 矩阵元定义弹性存活概率和破裂概率：\n$$P_{\\text{el}}^{(L)} = \\left|S^{(L)}_{00}\\right|^2, \\quad P_{\\text{bu}}^{(L)} = \\sum_{\\alpha \\neq 0} \\left|S^{(L)}_{\\alpha 0}\\right|^2,$$\n其中 $0$ 表示弹性道，$\\alpha$ 遍历所有离散化连续谱道 $(l,n)$。因为在此模型中 $S^{(L)}$ 是幺正的，所以对于每一个 $L$ 都有 $P_{\\text{el}}^{(L)} + P_{\\text{bu}}^{(L)} = 1$。\n\n使用通常的 $(2L+1)$ 权重对所有质心分波的观测量进行汇总：\n$$\\overline{P}_{\\text{el}} = \\frac{\\sum_{L=0}^{L_{\\max}} (2L+1) P_{\\text{el}}^{(L)}}{\\sum_{L=0}^{L_{\\max}} (2L+1)}, \\quad \\overline{P}_{\\text{bu}} = \\frac{\\sum_{L=0}^{L_{\\max}} (2L+1) P_{\\text{bu}}^{(L)}}{\\sum_{L=0}^{L_{\\max}} (2L+1)}.$$\n\n通过将内禀轨道角动量限制在 $0 \\le l \\le l_{\\max}$ 范围内，并将质心轨道角动量限制在 $0 \\le L \\le L_{\\max}$ 范围内，来实施截断方案。使用以下论据为截断值提供物理依据：\n- 质心半经典论证 $L_{\\text{phys}} \\approx \\lceil k R_{\\text{int}} \\rceil$，表明当 $L \\gg k R_{\\text{int}}$ 时，其贡献可以忽略不计。\n- 内禀离心势垒论证 $l_{\\text{phys}} \\approx \\lceil a_{\\text{proj}} \\sqrt{2 \\mu E_{\\max}}/\\hbar \\rceil$，表明当 $E_{\\text{cent}}(l)$ 超过 $E_{\\max}$ 后，与 $l$ 的耦合可以忽略不计。\n\n使用自然单位制，其中 $\\hbar = 1, \\mu = 1$，并将所有最终观测量表示为无量纲小数。离散化的连续谱对每个 $l$ 使用 $N_{\\text{bins}}$ 个能量箱，权重均等，为 $b_n = 1/\\sqrt{N_{\\text{bins}}}$。\n\n你必须使用以下固定的物理和模型参数（在所有测试用例中保持不变）来实现程序：\n- 质心波数 $k = 0.7$，\n- 相互作用半径 $R_{\\text{int}} = 5.0$，\n- 弹核尺寸 $a_{\\text{proj}} = 2.0$，\n- 约化质量 $\\mu = 1.0$，\n- 最大内禀连续谱能量 $E_{\\max} = 2.0$，\n- 基础耦合强度 $g_0 = 0.5$，\n- 弹性与破裂比率 $\\beta = 1.0$，\n- 每个 $l$ 的能量箱数量：$N_{\\text{bins}} = 6$。\n\n定义以下截断测试套件，它探测了不同的区域（低于物理截断值、在截断值处以及远高于截断值），并包括一个内禀 $l_{\\max}$ 不足但 $L_{\\max}$ 饱和的边缘情况：\n- 测试用例 1: $(l_{\\max}, L_{\\max}) = (0, 2)$,\n- 测试用例 2: $(l_{\\max}, L_{\\max}) = (4, 4)$,\n- 测试用例 3: $(l_{\\max}, L_{\\max}) = (8, 20)$,\n- 测试用例 4: $(l_{\\max}, L_{\\max}) = (1, 10)$。\n\n对于每个测试用例，计算如上定义的 $\\overline{P}_{\\text{el}}$ 和 $\\overline{P}_{\\text{bu}}$。此外，通过计算每个测试用例与套件中最大截断值（以 $(l_{\\max}, L_{\\max}) = (8, 20)$ 为参考）的标量差来评估收敛性：\n$$D_{\\text{ref}} = \\left|\\overline{P}_{\\text{el}} - \\overline{P}_{\\text{el}}^{\\text{ref}}\\right| + \\left|\\overline{P}_{\\text{bu}} - \\overline{P}_{\\text{bu}}^{\\text{ref}}\\right|,$$\n该值为无量纲。\n\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。该列表必须按顺序包含测试用例 1 到 4 的结果：每个测试用例的三元组 $(\\overline{P}_{\\text{el}}, \\overline{P}_{\\text{bu}}, D_{\\text{ref}})$。例如，输出格式必须为\n$$[\\overline{P}_{\\text{el}}^{(1)}, \\overline{P}_{\\text{bu}}^{(1)}, D_{\\text{ref}}^{(1)}, \\overline{P}_{\\text{el}}^{(2)}, \\overline{P}_{\\text{bu}}^{(2)}, D_{\\text{ref}}^{(2)}, \\overline{P}_{\\text{el}}^{(3)}, \\overline{P}_{\\text{bu}}^{(3)}, D_{\\text{ref}}^{(3)}, \\overline{P}_{\\text{el}}^{(4)}, \\overline{P}_{\\text{bu}}^{(4)}, D_{\\text_ref}^{(4)}],$$\n所有值均为无量纲小数。", "solution": "该问题要求实现一个简化的连续谱离散化耦合道 (CDCC) 方法的实现，用于描述两体弹核在无结构靶上的散射过程。问题的核心在于为一个由一组耦合薛定谔方程描述、并被截断到有限模型空间的系统计算散射观测量。我们的模型通过对每个由轨道角动量 $L$ 索引的质心 (c.m.) 分波使用秩一可分离反应矩阵 ($K$ 矩阵) 来简化此问题。这种方法保证了散射矩阵 ($S$ 矩阵) 的幺正性，这对于保持概率守恒至关重要。\n\n首先，我们使用自然单位制 ($\\hbar=1, \\mu=1$) 中给定的参数来确定问题的物理标度。\n质心波数为 $k=0.7$，相互作用半径为 $R_{\\text{int}}=5.0$。定义形状因子 $f_L(L)$ 的特征质心角动量 $L_c$ 由 $L_c \\equiv k R_{\\text{int}}$ 给出。\n$$L_c = (0.7) \\times (5.0) = 3.5$$\n在半经典近似下，这对应于碰撞参数 $b \\approx L_c/k = R_{\\text{int}}$。当 $L \\gg L_c$ 时，弹核与靶核的间距很大，相互作用变得可以忽略。对 $L$ 求和的一个合理的物理截断值是 $L_{\\text{phys}} \\approx \\lceil L_c \\rceil = \\lceil 3.5 \\rceil = 4$。形状因子 $f_L(L) = \\exp(-(L/L_c)^2)$ 通过抑制 $L > L_c$ 时的耦合，实现了这一物理直觉。\n\n同样，对于弹核的内禀运动，我们有弹核尺寸 $a_{\\text{proj}}=2.0$，约化质量 $\\mu=1.0$，以及最大内禀连续谱能量 $E_{\\max}=2.0$。特征内禀角动量 $l_c$ 由离心势垒能量等于 $E_{\\max}$ 的点确定。\n$$l_c \\equiv a_{\\text{proj}} \\sqrt{2 \\mu E_{\\max}}/\\hbar = (2.0) \\sqrt{2 \\times 1.0 \\times 2.0} / 1 = 4.0$$\n内禀角动量的一个合理物理截断值是 $l_{\\text{phys}} \\approx \\lceil l_c \\rceil = \\lceil 4.0 \\rceil = 4$。与 $l > l_c$ 的内禀态的耦合被离心势垒强烈抑制，这一特性由形状因子 $f_l(l) = \\exp(-(l/l_c)^2)$ 所体现。所选的测试用例恰当地探究了在这些物理截断值（$l_{\\text{phys}}=4, L_{\\text{phys}}=4$）之下、之上以及截断值本身处的截断情况。\n\n对于每个分波 $L$ 和给定的内禀截断 $l_{\\max}$，道空间由一个弹性道（索引为 $0$）和一组离散化的连续谱（破裂）道组成。破裂道由 $(\\alpha = (l,n))$ 索引，其中 $l \\in [0, 1, \\dots, l_{\\max}]$ 且 $n \\in [0, 1, \\dots, N_{\\text{bins}}-1]$。总道数为 $N_{\\text{ch}} = 1 + (l_{\\max}+1) \\times N_{\\text{bins}}$。\n\n该模型为每个 $L$ 定义了一个秩一 $K$ 矩阵：\n$$K^{(L)} = v^{(L)} \\left(v^{(L)}\\right)^{\\mathrm{T}}$$\n其中 $v^{(L)}$ 是一个维度为 $N_{\\text{ch}}$ 的实矢量。其分量由下式给出：\n$$v^{(L)}_0 = g_0 f_L(L)$$\n$$v^{(L)}_{(l,n)} = g_0 \\beta f_L(L) f_l(l) b_n$$\n其中常数 $g_0=0.5, \\beta=1.0$, 且 $b_n = 1/\\sqrt{N_{\\text{bins}}} = 1/\\sqrt{6}$。\n\n$S$ 矩阵与 $K$ 矩阵的关系为 $S = (I - iK)(I + iK)^{-1}$。这可以简化为 $S = I - 2iK(I+iK)^{-1}$。对于秩一矩阵 $K = vv^{\\mathrm{T}}$，其逆矩阵 $(I+iK)^{-1}$ 可以使用 Sherman-Morrison 公式求得：$(I+ivv^{\\mathrm{T}})^{-1} = I - \\frac{i}{1+iv^{\\mathrm{T}}v}vv^{\\mathrm{T}}$。代入此式可得到 $S^{(L)}$ 的一个简单表达式：\n$$S^{(L)} = I - 2i(v^{(L)} (v^{(L)})^{\\mathrm{T}}) \\left(I - \\frac{i}{1+i\\|v^{(L)}\\|^2} v^{(L)} (v^{(L)})^{\\mathrm{T}}\\right)$$\n$$S^{(L)} = I - 2i v^{(L)} (v^{(L)})^{\\mathrm{T}} \\left(1 - \\frac{i\\|v^{(L)}\\|^2}{1+i\\|v^{(L)}\\|^2}\\right) = I - 2i v^{(L)} (v^{(L)})^{\\mathrm{T}} \\left(\\frac{1}{1+i\\|v^{(L)}\\|^2}\\right)$$\n$$S^{(L)} = I - \\frac{2i}{1+i\\|v^{(L)}\\|^2} v^{(L)} (v^{(L)})^{\\mathrm{T}}$$\n其中 $\\|v^{(L)}\\|^2 = (v^{(L)})^{\\mathrm{T}}v^{(L)}$ 是耦合矢量的模方。因此，$S$ 矩阵的矩阵元为：\n$$S^{(L)}_{ij} = \\delta_{ij} - \\frac{2i}{1+i\\|v^{(L)}\\|^2} v^{(L)}_i v^{(L)}_j$$\n\n由此，我们推导出分波 $L$ 的弹性散射概率和破裂概率。\n弹性概率为 $P_{\\text{el}}^{(L)} = |S^{(L)}_{00}|^2$：\n$$S^{(L)}_{00} = 1 - \\frac{2i (v^{(L)}_0)^2}{1+i\\|v^{(L)}\\|^2} = \\frac{1+i\\|v^{(L)}\\|^2 - 2i(v^{(L)}_0)^2}{1+i\\|v^{(L)}\\|^2} = \\frac{1 + i\\left(\\|v^{(L)}\\|_{\\text{bu}}^2 - (v^{(L)}_0)^2\\right)}{1+i\\|v^{(L)}\\|^2}$$\n其中我们定义 $\\|v^{(L)}\\|_{\\text{bu}}^2 = \\sum_{\\alpha \\neq 0} (v^{(L)}_\\alpha)^2$。于是概率为：\n$$P_{\\text{el}}^{(L)} = |S^{(L)}_{00}|^2 = \\frac{1 + \\left(\\|v^{(L)}\\|_{\\text{bu}}^2 - (v^{(L)}_0)^2\\right)^2}{1 + (\\|v^{(L)}\\|^2)^2}$$\n总破裂概率 $P_{\\text{bu}}^{(L)} = \\sum_{\\alpha \\neq 0} |S^{(L)}_{\\alpha 0}|^2$ 为：\n$$S^{(L)}_{\\alpha 0} = -\\frac{2i v^{(L)}_\\alpha v^{(L)}_0}{1+i\\|v^{(L)}\\|^2}$$\n$$P_{\\text{bu}}^{(L)} = \\sum_{\\alpha \\neq 0} \\left|-\\frac{2i v^{(L)}_\\alpha v^{(L)}_0}{1+i\\|v^{(L)}\\|^2}\\right|^2 = \\frac{4 (v^{(L)}_0)^2}{|1+i\\|v^{(L)}\\|^2|^2} \\sum_{\\alpha \\neq 0}(v^{(L)}_\\alpha)^2 = \\frac{4 (v^{(L)}_0)^2 \\|v^{(L)}\\|_{\\text{bu}}^2}{1 + (\\|v^{(L)}\\|^2)^2}$$\n可以验证，这些表达式满足幺正性条件 $P_{\\text{el}}^{(L)} + P_{\\text{bu}}^{(L)} = 1$。\n\n对于给定的截断 $(l_{\\max}, L_{\\max})$，计算过程如下：\n1. 对于每个 $L \\in [0, 1, \\dots, L_{\\max}]$:\n    a. 计算 $f_L(L) = \\exp(-(L/L_c)^2)$。\n    b. 计算 $(v_0^{(L)})^2 = (g_0 f_L(L))^2$。\n    c. 计算 $\\|v^{(L)}\\|^2_{\\text{bu}} = \\sum_{l=0}^{l_{\\max}} \\sum_{n=0}^{N_{\\text{bins}}-1} (g_0 \\beta f_L(L) f_l(l) b_n)^2$。由于 $\\sum_n b_n^2 = 1$，此式可简化为 $\\|v^{(L)}\\|^2_{\\text{bu}} = (g_0 \\beta f_L(L))^2 \\sum_{l=0}^{l_{\\max}} (f_l(l))^2$。\n    d. 计算 $\\|v^{(L)}\\|^2 = (v_0^{(L)})^2 + \\|v^{(L)}\\|^2_{\\text{bu}}$。\n    e. 使用上述公式计算 $P_{\\text{el}}^{(L)}$ 和 $P_{\\text{bu}}^{(L)}$。\n2. 通过对所有分波按权重 $(2L+1)$ 求和来获得总观测量：\n$$\\overline{P}_{\\text{el}} = \\frac{\\sum_{L=0}^{L_{\\max}} (2L+1) P_{\\textel}^{(L)}}{\\sum_{L=0}^{L_{\\max}} (2L+1)}, \\quad \\overline{P}_{\\text{bu}} = 1 - \\overline{P}_{\\text{el}}$$\n分母即为 $(L_{\\max}+1)^2$。\n\n最后，我们评估收敛性。参考计算使用 $(l_{\\max}, L_{\\max}) = (8, 20)$，该值远高于物理截断值，从而得到 $\\overline{P}_{\\text{el}}^{\\text{ref}}$ 和 $\\overline{P}_{\\text{bu}}^{\\text{ref}}$。对于每个测试用例，我们计算差异度量：\n$$D_{\\text{ref}} = |\\overline{P}_{\\text{el}} - \\overline{P}_{\\text{el}}^{\\text{ref}}| + |\\overline{P}_{\\text{bu}} - \\overline{P}_{\\text{bu}}^{\\text{ref}}|$$\n由于幺正性（$\\overline{P}_{\\text{el}} + \\overline{P}_{\\text{bu}} = 1$），此式可简化为 $D_{\\text{ref}} = 2|\\overline{P}_{\\text{el}} - \\overline{P}_{\\text{el}}^{\\text{ref}}|$。对于参考用例本身，$D_{\\text{ref}}$ 根据定义为 $0$。实现将遵循此逻辑来为每个测试用例计算所需的三元组 $(\\overline{P}_{\\text{el}}, \\overline{P}_{\\text{bu}}, D_{\\text{ref}})$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the simplified CDCC problem for a given set of test cases.\n    \"\"\"\n\n    # --- Fixed Physical and Model Parameters ---\n    k = 0.7          # c.m. wavenumber\n    R_int = 5.0      # interaction radius\n    a_proj = 2.0     # projectile size\n    mu = 1.0         # reduced mass\n    E_max = 2.0      # maximum internal continuum energy\n    g0 = 0.5         # base coupling strength\n    beta = 1.0       # elastic-to-breakup ratio\n    N_bins = 6       # number of bins per l\n    hbar = 1.0       # Planck constant (natural units)\n    \n    # --- Characteristic Angular Momenta ---\n    L_c = k * R_int\n    l_c = a_proj * np.sqrt(2 * mu * E_max) / hbar\n\n    # --- Test Suite ---\n    test_cases = [\n        (0, 2),   # Test Case 1\n        (4, 4),   # Test Case 2\n        (8, 20),  # Test Case 3 (Reference)\n        (1, 10),  # Test Case 4\n    ]\n\n    def calculate_observables(l_max, L_max):\n        \"\"\"\n        Calculates integrated probabilities for given truncations.\n        \n        Args:\n            l_max (int): Maximum internal orbital angular momentum.\n            L_max (int): Maximum c.m. orbital angular momentum.\n            \n        Returns:\n            tuple: A tuple containing (P_el_bar, P_bu_bar).\n        \"\"\"\n        sum_pel_num = 0.0\n        sum_pbu_num = 0.0\n\n        # Pre-calculate sum over f_l(l)^2 as it's independent of L\n        f_l_sq_sum = 0.0\n        for l_val in range(l_max + 1):\n            f_l = np.exp(-((l_val / l_c)**2))\n            f_l_sq_sum += f_l**2\n        \n        for L_val in range(L_max + 1):\n            f_L = np.exp(-((L_val / L_c)**2))\n            \n            # v0^2: elastic channel part of coupling norm squared\n            v0_sq = (g0 * f_L)**2\n            \n            # Sum over breakup channels. The sum over bins 'n' gives 1.\n            # v_bu^2: breakup channels part of coupling norm squared\n            v_bu_sq = (g0 * beta * f_L)**2 * f_l_sq_sum\n            \n            # Total norm squared of the coupling vector v^(L)\n            v_norm_sq = v0_sq + v_bu_sq\n\n            if v_norm_sq  1e-15: # Negligible coupling for very high L\n                P_el_L = 1.0\n                P_bu_L = 0.0\n            else:\n                # Calculate partial wave probabilities using derived formulas\n                numerator_pel = 1 + (v_bu_sq - v0_sq)**2\n                denominator = 1 + v_norm_sq**2\n                P_el_L = numerator_pel / denominator\n                P_bu_L = 1.0 - P_el_L # By unitarity\n            \n            # Weight by (2L+1)\n            weight = 2 * L_val + 1\n            sum_pel_num += weight * P_el_L\n            sum_pbu_num += weight * P_bu_L\n            \n        # Normalization factor for the sums\n        norm_factor = (L_max + 1)**2\n\n        if norm_factor == 0:\n            return 1.0, 0.0\n\n        P_el_bar = sum_pel_num / norm_factor\n        P_bu_bar = sum_pbu_num / norm_factor\n        \n        return P_el_bar, P_bu_bar\n\n    # --- Main Calculation Loop ---\n    \n    # First, calculate reference values from the case with largest truncations\n    ref_l_max, ref_L_max = 8, 20\n    P_el_ref, P_bu_ref = calculate_observables(ref_l_max, ref_L_max)\n    \n    all_results = []\n    \n    for l_max, L_max in test_cases:\n        P_el, P_bu = calculate_observables(l_max, L_max)\n        \n        # Calculate the convergence metric D_ref\n        # D_ref = |P_el - P_el_ref| + |P_bu - P_bu_ref| = 2 * |P_el - P_el_ref|\n        D_ref = 2.0 * np.abs(P_el - P_el_ref)\n        \n        all_results.extend([P_el, P_bu, D_ref])\n\n    # Format output as a single comma-separated list in brackets\n    output_str = f\"[{','.join(f'{val:.8f}' for val in all_results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3552265"}, {"introduction": "在构建了CDCC计算所需的模型空间之后，下一步是定义驱动不同通道间跃迁的耦合势。这些势通常通过多极展开来表示，而保留哪些多极成分是模型构建中的一个关键决策。本练习将让你深入研究截断耦合势多极展开所带来的影响 ([@problem_id:3552310])。你将通过数值求解耦合的径向薛定谔方程，直接观察增加多极项（即增大 $\\lambda_{\\max}$）如何改变散射概率，并检验其对散射矩阵幺正性的影响。这项实践提供了求解耦合方程组的实践经验，并让你更深刻地理解相互作用模型的细节是如何最终体现在散射观测量上的。", "problem": "考虑一个简化的连续离散耦合道 (Continuum-Discretized Coupled-Channel, CDCC) 散射问题，该问题处于一个分波中，其中弹靶相对运动由从不含时薛定谔方程导出的耦合径向方程描述。使用自然单位制，使得 $\\hbar^2/(2\\mu)=1$，因此能量和势的单位与长度平方的倒数相同。假设为 $s$ 波散射（轨道角动量 $L=0$）和 $N=3$ 个通道：一个标记为 $i=0$ 的基态通道和两个标记为 $i=1$ 和 $i=2$ 的离散化连续谱箱。入射通道的总能量为 $E$，各谱箱的内禀激发能为 $\\epsilon_0=0$、$\\epsilon_1$ 和 $\\epsilon_2$，由此得到通道波数 $k_i=\\sqrt{E-\\epsilon_i}$，您必须假设它们是实数且为正（所有通道都是开放的）。约化径向波函数 $u_i(R)$ 的耦合方程为\n$$\nu_i''(R) \\;=\\; \\sum_{j=0}^{N-1} \\left[V_{ij}(R) - k_i^2 \\delta_{ij}\\right] u_j(R),\n$$\n并在原点处具有正则边界条件。耦合势矩阵是在多极阶 $\\lambda_{\\max}$ 处截断的多极展开，\n$$\nV(R;\\lambda_{\\max}) \\;=\\; \\sum_{\\lambda=0}^{\\lambda_{\\max}} F_{\\lambda}(R)\\, C^{(\\lambda)},\n$$\n其中 $F_{\\lambda}(R)$ 是短程径向形状因子，$C^{(\\lambda)}$ 是编码多极 $\\lambda$ 的通道耦合的实对称结构矩阵。多极截断指数 $\\lambda_{\\max}$ 控制保留多少个多极。目标是对 $\\lambda_{\\max}$ 进行敏感性研究，并量化其对散射矩阵的幺正性和可观测量预测的影响。\n\n您必须使用的出发点和定义：\n- 具有实厄米势的矩阵形式的不含时多通道薛定谔方程会导致开放通道的幺正散射。\n- 对于 $L=0$，每个开放通道中约化径向方程的渐近自由解与里卡蒂-汉克尔函数成正比，对于 $L=0$，该函数简化为 $\\hat{h}_0^{\\pm}(x)=e^{\\pm i x}$，其导数为 $\\mathrm{d}\\hat{h}_0^{\\pm}/\\mathrm{d}R = \\pm i k\\, e^{\\pm i k R}$。\n- 对于通道 $c$ 中的入射波，物理散射解可以渐近地写为入射波和出射波的叠加，并且可以通过将数值传播的正则解与这些渐近形式在势可以忽略的大半径处进行匹配来提取散射矩阵 $S$。\n\n在此问题中，请使用以下具体、科学上合理且自洽的模型要素：\n- 通道数 $N=3$。\n- 总能量 $E = 4.0$。\n- 内禀能量 $\\epsilon_0=0.0$, $\\epsilon_1=0.5$, $\\epsilon_2=1.0$，因此 $k_0=\\sqrt{4.0}$, $k_1=\\sqrt{3.5}$, $k_2=\\sqrt{3.0}$。\n- 径向形状因子\n$$\nF_{\\lambda}(R) \\;=\\; V_0\\, \\alpha^{\\lambda}\\, \\left(\\frac{R}{R_0}\\right)^{\\lambda} \\exp\\!\\left(-\\left(\\frac{R}{R_0}\\right)^{2}\\right),\n$$\n其中 $V_0 = 1.0$, $\\alpha=0.4$, $R_0=2.0$。\n- 对于 $\\lambda=0,1,2,3,4$ 的实对称结构矩阵 $C^{(\\lambda)}$ 定义如下：\n    - $C^{(0)} = \\mathrm{diag}(-0.5,-0.45,-0.4)$。\n    - $C^{(1)}$ 的非对角元 $(0,1)=(1,0)=0.2$ 和 $(1,2)=(2,1)=0.2$ 不为零，其余元素为零。\n    - $C^{(2)}$ 的对角元为 $(0.05,0.04,0.03)$，非对角元 $(0,2)=(2,0)=0.1$ 不为零，其余元素为零。\n    - $C^{(3)}$ 的非对角元 $(0,1)=(1,0)=0.05$ 和 $(1,2)=(2,1)=-0.05$ 不为零，其余元素为零。\n    - $C^{(4)}$ 的对角元为 $(0.02,0.02,0.02)$，非对角元 $(0,2)=(2,0)=0.03$ 不为零，其余元素为零。\n- 对于 $\\lambda\\lambda_{\\max}$，$C^{(\\lambda)}$ 不包含在求和中。\n- 使用一阶系统传播由 $N$ 个线性无关正则解构成的基本矩阵，从 $R_{\\min}$ 到 $R_{\\max}$：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}R}\\begin{pmatrix}U\\\\ U'\\end{pmatrix} \\;=\\; \\begin{pmatrix} U' \\\\ Q(R)\\, U \\end{pmatrix}, \\quad Q(R) \\equiv V(R;\\lambda_{\\max}) - K^2,\\quad K^2=\\mathrm{diag}(k_0^2,k_1^2,k_2^2),\n$$\n在小半径 $R_{\\min}$ 处的初始条件由 $U(R_{\\min}) = R_{\\min}\\, I$ 和 $U'(R_{\\min}) = I$ 给出，其中 $I$ 是 $N\\times N$ 单位矩阵。\n- 在势可忽略的匹配半径 $R_{\\max}$ 处，构建对数导数矩阵 $Y=U'(R_{\\max})\\, U(R_{\\max})^{-1}$，并定义对角矩阵 $H^{\\pm}=\\mathrm{diag}(e^{\\pm i k_i R_{\\max}})$ 和 $(H^{\\pm})'=\\mathrm{diag}(\\pm i k_i e^{\\pm i k_i R_{\\max}})$。开放通道的散射矩阵 $S$ 满足线性系统\n$$\n\\left[-Y H^{+} + (H^{+})'\\right] S \\;=\\; (H^{-})' - Y H^{-}.\n$$\n- 考虑通道 $c=0$ 中的入射波。定义弹性散射概率 $P_{\\mathrm{el}}=|S_{00}|^2$，非弹性散射概率 $P_{01}=|S_{10}|^2$ 和 $P_{02}=|S_{20}|^2$，以及幺正性缺陷 $D=\\left|1 - \\left(P_{\\mathrm{el}} + P_{01} + P_{02}\\right)\\right|$。\n\n您的任务是编写一个完整的程序，该程序：\n- 实现上述模型和数值步骤。\n- 使用以下数值参数：$R_{\\min}=1\\times 10^{-5}$，$R_{\\max}=30.0$，并使用绝对容差 $\\mathrm{atol}=1\\times 10^{-12}$ 和相对容差 $\\mathrm{rtol}=1\\times 10^{-9}$ 的鲁棒常微分方程求解器进行积分。\n- 对于测试组 $\\{\\;0,\\;1,\\;2,\\;3,\\;4\\;\\}$ 中的每个 $\\lambda_{\\max}$，计算如上定义的量 $D$、$P_{\\mathrm{el}}$、$P_{01}$ 和 $P_{02}$。\n\n将所有输出表示为无单位的浮点数。您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按 $\\lambda_{\\max}$ 递增排序，并展平为\n$$\n[\\;D(\\lambda_{\\max}{=}0),\\; P_{\\mathrm{el}}(\\lambda_{\\max}{=}0),\\; P_{01}(\\lambda_{\\max}{=}0),\\; P_{02}(\\lambda_{\\max}{=}0),\\; \\dots,\\; D(\\lambda_{\\max}{=}4),\\; P_{\\mathrm{el}}(\\lambda_{\\max}{=}4),\\; P_{01}(\\lambda_{\\max}{=}4),\\; P_{02}(\\lambda_{\\max}{=}4)\\;].\n$$\n\n因此，测试组是参数值 $\\lambda_{\\max}\\in\\{\\,0,\\,1,\\,2,\\,3,\\,4\\,\\}$ 的集合。最终列表中每个条目的预期数据类型是浮点数。通过平面波因子 $e^{\\pm i k_i R}$，角度被隐式地以弧度为单位，您必须一致地使用弧度。在所选单位制中，所有量都是无量纲的。", "solution": "该问题要求数值求解一组耦合径向薛定谔方程，以在连续离散耦合道 (CDCC) 框架内模拟一个简化的核散射过程。目标是分析散射可观测量对耦合势多极展开截断的敏感性。该分析是针对一个所有通道都开放的 3 通道系统进行的，仅考虑 $s$ 波（$L=0$）散射。\n\n控制方程是关于约化径向波函数 $u_i(R)$ 的一组 $N=3$ 个耦合二阶常微分方程 (ODE)，其中 $R$ 是弹靶分离距离：\n$$\nu_i''(R) \\;=\\; \\sum_{j=0}^{N-1} \\left[V_{ij}(R) - k_i^2 \\delta_{ij}\\right] u_j(R)\n$$\n这里，$k_i = \\sqrt{E - \\epsilon_i}$ 是通道 $i$ 中的波数，其中 $E$ 是总能量，$\\epsilon_i$ 是通道的内禀激发能。问题指定 $E=4.0$ 和 $\\{\\epsilon_0, \\epsilon_1, \\epsilon_2\\} = \\{0.0, 0.5, 1.0\\}$，这导致实数通道波数 $k_0=2.0$，$k_1=\\sqrt{3.5}$ 和 $k_2=\\sqrt{3.0}$。单位的选择使得 $\\hbar^2/(2\\mu)=1$。\n\n耦合势矩阵 $V(R)$ 由一个截断的多极展开式构成：\n$$\nV(R;\\lambda_{\\max}) \\;=\\; \\sum_{\\lambda=0}^{\\lambda_{\\max}} F_{\\lambda}(R)\\, C^{(\\lambda)}\n$$\n其中 $\\lambda_{\\max}$ 是所包含的最大多极阶。径向形状因子 $F_{\\lambda}(R)$ 由高斯函数形式给出，结构矩阵 $C^{(\\lambda)}$ 作为实的对称常数矩阵提供。这确保了总势 $V(R;\\lambda_{\\max})$ 是厄米的（即实的对称的），这是流守恒和幺正散射矩阵（$S$ 矩阵）的条件。\n\n数值解是通过将二阶系统重构为一个关于基本解矩阵 $U(R)$ 及其导数 $U'(R)$ 的一阶系统来获得的。$U(R)$ 的列代表三个在原点处正则的线性无关解。该一阶系统为：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}R}\\begin{pmatrix} U(R) \\\\ U'(R) \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0  I \\\\ Q(R)  0 \\end{pmatrix} \\begin{pmatrix} U(R) \\\\ U'(R) \\end{pmatrix} \\;=\\; \\begin{pmatrix} U'(R) \\\\ Q(R)\\, U(R) \\end{pmatrix}\n$$\n其中 $I$ 是 $3 \\times 3$ 单位矩阵，$Q(R) = V(R;\\lambda_{\\max}) - K^2$，且 $K^2 = \\mathrm{diag}(k_0^2, k_1^2, k_2^2)$。对于 $s$ 波散射，正则解在 $R=0$ 附近的行为是 $u_i(R) \\propto R$。这决定了基本矩阵解在小半径 $R_{\\min}$ 处的初始条件：\n$$\nU(R_{\\min}) = R_{\\min} \\cdot I, \\quad U'(R_{\\min}) = I\n$$\n这个由 $2N^2 = 18$ 个耦合一阶常微分方程组成的系统被从 $R=R_{\\min}$ 数值积分到大匹配半径 $R=R_{\\max}$，在此处短程势 $V(R)$ 可以忽略不计。对于此问题，$R_{\\min}=10^{-5}$ 且 $R_{\\max}=30.0$。我们使用一个高精度常微分方程求解器（`scipy.integrate.solve_ivp`）来获得 $U(R_{\\max})$ 和 $U'(R_{\\max})$。\n\n在 $R_{\\max}$ 处，将数值解与散射波函数的已知渐近形式进行匹配，以提取 $S$ 矩阵。渐近解是入射波和出射波的线性组合，对于 $L=0$，它们分别是简单的平面波 $e^{-ik_i R}$ 和 $e^{+ik_i R}$。使用对数导数矩阵 $Y$ 可以方便地进行此匹配，其定义为：\n$$\nY = U'(R_{\\max}) [U(R_{\\max})]^{-1}\n$$\n然后通过求解以下线性矩阵方程来找到 $S$ 矩阵：\n$$\n\\left[ (H^{+})' - Y H^{+} \\right] S \\;=\\; (H^{-})' - Y H^{-}\n$$\n其中 $H^{\\pm} = \\mathrm{diag}(e^{\\pm i k_i R_{\\max}})$ 和 $(H^{\\pm})' = \\mathrm{diag}(\\pm i k_i e^{\\pm i k_i R_{\\max}})$ 是包含渐近基函数在匹配半径处的值和导数的对角矩阵。这是一个 $A S = B$ 形式的系统，求解以获得复矩阵 $S$。\n\n分析是针对基态（通道 $c=0$）中的入射波进行的。相关的散射可观测量由所得 $S$ 矩阵的第一列（$S_{j0}$）确定：\n- 弹性散射概率：$P_{\\mathrm{el}} = |S_{00}|^2$\n- 非弹性散射概率：$P_{01} = |S_{10}|^2$ 和 $P_{02} = |S_{20}|^2$\n- 幺正性缺陷：$D = |1 - (P_{\\mathrm{el}} + P_{01} + P_{02})| = \\left|1 - \\sum_{j=0}^{2} |S_{j0}|^2\\right|$。这个量衡量了偏离流守恒的程度。对于精确的幺正计算，$D$ 将为零。\n\n对截断参数 $\\lambda_{\\max}$ 在集合 $\\{0, 1, 2, 3, 4\\}$ 中的每个值都执行上述过程。对每个 $\\lambda_{\\max}$ 计算得到的四个可观测量（$D$, $P_{\\mathrm{el}}$, $P_{01}$, $P_{02}$），并以展平列表的形式作为最终结果呈现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the CDCC scattering problem for a range of multipole truncations.\n    \"\"\"\n    # === Problem Parameters ===\n    N = 3  # Number of channels\n    E = 4.0  # Total energy\n    epsilons = np.array([0.0, 0.5, 1.0])  # Intrinsic energies\n    \n    # Form factor parameters\n    V0 = 1.0\n    R0 = 2.0\n    alpha = 0.4\n\n    # Numerical integration parameters\n    R_min = 1e-5\n    R_max = 30.0\n    atol = 1e-12\n    rtol = 1e-9\n\n    # Derived constants\n    k_squared = E - epsilons\n    k = np.sqrt(k_squared)\n    K2_mat = np.diag(k_squared)\n\n    # Structure Matrices C^(lambda)\n    C0 = np.diag([-0.5, -0.45, -0.4])\n    C1 = np.array([[0.0, 0.2, 0.0], [0.2, 0.0, 0.2], [0.0, 0.2, 0.0]])\n    C2 = np.array([[0.05, 0.0, 0.1], [0.0, 0.04, 0.0], [0.1, 0.0, 0.03]])\n    C3 = np.array([[0.0, 0.05, 0.0], [0.05, 0.0, -0.05], [0.0, -0.05, 0.0]])\n    C4 = np.array([[0.02, 0.0, 0.03], [0.0, 0.02, 0.0], [0.03, 0.0, 0.02]])\n    C_matrices = [C0, C1, C2, C3, C4]\n\n    # Test cases for lambda_max\n    test_cases = [0, 1, 2, 3, 4]\n    \n    final_results = []\n\n    for lambda_max in test_cases:\n        \n        def get_potential(R):\n            \"\"\"Computes the potential matrix V(R) for a given lambda_max.\"\"\"\n            V_mat = np.zeros((N, N))\n            # Avoid R=0 issues, though R_min > 0\n            if R == 0:\n                # Only lambda=0 contributes at R=0\n                V_mat += V0 * C_matrices[0]\n                return V_mat\n\n            R_over_R0_sq = (R / R0)**2\n            exp_term = np.exp(-R_over_R0_sq)\n\n            # F_lambda(R) = V0 * alpha^lambda * (R/R0)^lambda * exp(-(R/R0)^2)\n            # F_lambda = F_{lambda-1} * alpha * (R/R0)\n            F_lambda_val = V0 * exp_term\n            for lam in range(lambda_max + 1):\n                V_mat += F_lambda_val * C_matrices[lam]\n                # Prepare for next iteration\n                F_lambda_val *= alpha * (R / R0)\n            return V_mat\n\n        def ode_system(R, y):\n            \"\"\"Defines the first-order system dy/dR for the ODE solver.\"\"\"\n            # y contains flattened U and U' matrices\n            # y = [u11, u12, ..., u33, u'11, u'12, ..., u'33]\n            U = y[:N*N].reshape((N, N))\n            U_prime = y[N*N:].reshape((N, N))\n            \n            # dU/dR = U'\n            dU_dR = U_prime\n            \n            # dU'/dR = (V(R) - K^2) U(R)\n            V_R = get_potential(R)\n            Q_R = V_R - K2_mat\n            dU_prime_dR = Q_R @ U\n            \n            # Return flattened derivatives\n            return np.concatenate((dU_dR.flatten(), dU_prime_dR.flatten()))\n\n        # Initial conditions at R_min\n        U0 = R_min * np.identity(N)\n        U_prime0 = np.identity(N)\n        y0 = np.concatenate((U0.flatten(), U_prime0.flatten()))\n        \n        # Integrate the ODE system\n        solution = solve_ivp(\n            ode_system, \n            [R_min, R_max], \n            y0, \n            method='DOP853',  # A robust high-order method\n            atol=atol, \n            rtol=rtol\n        )\n        \n        # Extract solution at R_max\n        y_max = solution.y[:, -1]\n        U_max = y_max[:N*N].reshape((N, N))\n        U_prime_max = y_max[N*N:].reshape((N, N))\n        \n        # Calculate logarithmic derivative matrix Y\n        Y = U_prime_max @ np.linalg.inv(U_max)\n        \n        # Calculate S-matrix\n        H_plus = np.diag(np.exp(1j * k * R_max))\n        H_minus = np.diag(np.exp(-1j * k * R_max))\n        H_plus_prime = np.diag(1j * k * np.exp(1j * k * R_max))\n        H_minus_prime = np.diag(-1j * k * np.exp(-1j * k * R_max))\n        \n        # Solve [ (H^+)' - Y H^+ ] S = (H^-)' - Y H^-\n        A = H_plus_prime - Y @ H_plus\n        B = H_minus_prime - Y @ H_minus\n        S_matrix = np.linalg.solve(A, B)\n        \n        # Calculate observables for incoming wave in channel 0\n        S_col0 = S_matrix[:, 0]\n        P_el = np.abs(S_col0[0])**2\n        P_01 = np.abs(S_col0[1])**2\n        P_02 = np.abs(S_col0[2])**2\n        \n        # Unitarity defect\n        total_prob = P_el + P_01 + P_02\n        D = np.abs(1.0 - total_prob)\n        \n        final_results.extend([D, P_el, P_01, P_02])\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "id": "3552310"}, {"introduction": "CDCC方法名称中的“D”（Discretized，离散化）指的是用一组离散的“能量箱”（bins）来近似连续的破裂能谱。如何构建这些能量箱并非小事，它能显著影响计算的准确性，尤其是在处理连续谱中的共振结构时。本练习将对比两种常用的连续谱离散化方案：等能量间隔分箱与等动量间隔分箱 ([@problem_id:3552257])。你将通过量化分析，研究这两种方案在分辨一个尖锐共振峰时的表现差异，后者是核连续谱中一种常见且重要的物理现象。通过完成这项练习，你将对连续谱离散化的精妙之处获得关键洞见，理解不同的分箱选择如何影响对物理结构的描述以及对总反应截面等积分量的计算精度。", "problem": "考虑一个计算核物理中连续谱离散化耦合道（CDCC）方法的简化模型，其中向弹核-靶核连续谱的破裂强度主要由相对运动中的单个窄共振主导。该连续谱通过构建等能量宽度或等动量宽度的箱（bin）来近似。您的任务是实现并比较这些分箱方案，通过量化它们如何解析窄共振以及如何影响破裂可观测量的离散化评估来进行比较。\n\n起点假设和定义：\n- 相对运动是非相对论性的，且由s波主导，其约化质量为$\\mu$，动量$k$与能量$E$的关系为\n$$\nE(k) = \\frac{(\\hbar c)^2 k^2}{2 \\mu},\n$$\n其中$\\hbar c = 197.3269804\\,\\text{MeV}\\cdot\\text{fm}$，$\\mu$的单位为$\\text{MeV}$（使用$c = 1$）。\n- 作为能量$E$的函数的破裂强度由一个Breit-Wigner（洛伦兹）线型建模，其中心位于共振能量$E_R$，宽度为$\\Gamma$，\n$$\nB(E) = \\frac{(\\Gamma/2)^2}{(E - E_R)^2 + (\\Gamma/2)^2}.\n$$\n此函数是无量纲的，且其上界为$B(E_R) = 1$。\n\n分箱方案：\n- 等能量分箱：将能量区间$[E_{\\min}, E_{\\max}]$划分为$N$个等宽度的箱，宽度为$\\Delta E = (E_{\\max} - E_{\\min})/N$，第$i$个箱覆盖$[E_i, E_{i+1}]$，其中$E_i = E_{\\min} + i \\Delta E$。\n- 等动量分箱：将动量区间$[k_{\\min}, k_{\\max}]$划分为$N$个等宽度的箱，宽度为$\\Delta k$，其中$k_{\\min} = \\sqrt{2\\mu E_{\\min}}/(\\hbar c)$和$k_{\\max} = \\sqrt{2\\mu E_{\\max}}/(\\hbar c)$，第$j$个箱覆盖$[k_j, k_{j+1}]$，其中$k_j = k_{\\min} + j \\Delta k$。\n\n对于每种方案，定义：\n1. 第$i$个箱（能量箱）中的箱平均共振强度为\n$$\n\\overline{B}^{(E)}_i = \\frac{1}{\\Delta E} \\int_{E_i}^{E_{i+1}} B(E)\\, dE,\n$$\n以及第$j$个箱（动量箱）中的\n$$\n\\overline{B}^{(k)}_j = \\frac{1}{\\Delta k} \\int_{k_j}^{k_{j+1}} B(E(k))\\, dk.\n$$\n2. 每种方案的共振峰分辨率度量，定义为最大箱平均高度比\n$$\nH_E = \\frac{\\max_i \\overline{B}^{(E)}_i}{B(E_R)}, \\quad H_k = \\frac{\\max_j \\overline{B}^{(k)}_j}{B(E_R)}.\n$$\n3. 最共振箱（即达到最大平均值的箱）的质心，以能量单位表示。对于能量箱$i^\\star$，\n$$\nE_{\\text{centroid}}^{(E)} = \\frac{\\int_{E_{i^\\star}}^{E_{i^\\star+1}} E\\, B(E)\\, dE}{\\int_{E_{i^\\star}}^{E_{i^\\star+1}} B(E)\\, dE},\n$$\n对于动量箱$j^\\star$，\n$$\nE_{\\text{centroid}}^{(k)} = \\frac{\\int_{k_{j^\\star}}^{k_{j^\\star+1}} E(k)\\, B(E(k))\\, dk}{\\int_{k_{j^\\star}}^{k_{j^\\star+1}} B(E(k))\\, dk}.\n$$\n报告质心位移\n$$\n\\Delta E_E = E_{\\text{centroid}}^{(E)} - E_R,\\quad \\Delta E_k = E_{\\text{centroid}}^{(k)} - E_R,\n$$\n以$\\text{MeV}$表示。\n4. 对$[E_{\\min}, E_{\\max}]$上总破裂强度的离散近似，通过箱中心值的黎曼和计算。对于能量分箱方案，使用\n$$\nS_E^{\\text{disc}} = \\sum_{i=0}^{N-1} B\\!\\left(E_i + \\frac{\\Delta E}{2}\\right) \\Delta E,\n$$\n对于动量分箱方案，通过雅可比行列式变换来近似相同的能量域积分，\n$$\n\\frac{dE}{dk} = \\frac{(\\hbar c)^2 k}{\\mu},\n$$\n因此\n$$\nS_k^{\\text{disc}} = \\sum_{j=0}^{N-1} B\\!\\left(E\\!\\left(k_j + \\frac{\\Delta k}{2}\\right)\\right) \\left.\\frac{dE}{dk}\\right|_{k = k_j + \\Delta k/2} \\Delta k.\n$$\n将每个离散结果与精确的能量域积分进行比较\n$$\nS_{\\text{exact}} = \\int_{E_{\\min}}^{E_{\\max}} B(E)\\, dE,\n$$\n并报告绝对误差\n$$\n\\varepsilon_E = \\left|S_E^{\\text{disc}} - S_{\\text{exact}}\\right|,\\quad \\varepsilon_k = \\left|S_k^{\\text{disc}} - S_{\\text{exact}}\\right|.\n$$\n以$\\text{MeV}$表示$\\varepsilon_E$和$\\varepsilon_k$。\n\n科学依据约束：\n- 从联系$E$和$k$的非相对论运动学以及$B(E)$的标准Breit-Wigner共振形式出发。\n- 所有在$k$和$E$之间的变换都必须通过$E(k)$和雅可比行列式$dE/dk$进行。\n\n测试套件：\n使用以下测试用例，每个用例都是一个元组$(\\mu, E_R, \\Gamma, E_{\\min}, E_{\\max}, N)$，其中$\\mu$的单位是$\\text{MeV}$，能量单位是$\\text{MeV}$，$N$是无量纲的：\n- 用例A（窄共振，中等箱数）：$(470.0, 2.0, 0.05, 0.0, 5.0, 50)$。\n- 用例B（非常窄，近阈值）：$(470.0, 0.2, 0.01, 0.0, 1.0, 40)$。\n- 用例C（较宽共振，粗糙分箱）：$(470.0, 2.5, 0.5, 0.0, 5.0, 10)$。\n\n输出规范：\n- 对于每个用例，计算并返回一个按固定顺序排列的包含六个浮点数的列表\n$$\n\\left[ H_E,\\; H_k,\\; \\varepsilon_E,\\; \\varepsilon_k,\\; \\Delta E_E,\\; \\Delta E_k \\right],\n$$\n其中$H_E$和$H_k$是无量纲的，而$\\varepsilon_E$、$\\varepsilon_k$、$\\Delta E_E$和$\\Delta E_k$必须以$\\text{MeV}$表示。\n- 您的程序应生成单行输出，其中包含所有用例的结果，形式为用方括号括起来的逗号分隔列表，每个用例本身也编码为一个方括号列表，每个浮点数格式化为小数点后六位。例如，\n$$\n\\left[ [h_{E,1}, h_{k,1}, \\varepsilon_{E,1}, \\varepsilon_{k,1}, \\Delta E_{E,1}, \\Delta E_{k,1}], [h_{E,2}, \\dots], [h_{E,3}, \\dots] \\right].\n$$\n不应打印任何其他文本。\n\n本问题不使用数值角度单位。所有能量必须以$\\text{MeV}$处理和报告，所有动量以$\\text{fm}^{-1}$处理和报告。", "solution": "该解决方案实现并比较了连续谱离散化耦合道（CDCC）方法中使用的两种常见离散化方案：等能量分箱和等动量分箱。问题的核心是量化当连续谱被离散化为有限数量的箱时，每种方案表示一个尖锐物理特征——Breit-Wigner共振——的效果如何。\n\n首先，我们定义模型的基础物理和数学。运动学关系由非相对论能量-动量关系$E(k) = \\frac{(\\hbar c)^2 k^2}{2 \\mu}$给出。破裂强度由一个无量纲的Breit-Wigner函数$B(E) = \\frac{(\\Gamma/2)^2}{(E - E_R)^2 + (\\Gamma/2)^2}$建模。\n\n对于等能量分箱方案，能量区间$[E_{\\min}, E_{\\max}]$被划分为$N$个等宽度的箱。箱平均强度$\\overline{B}^{(E)}_i$通过对$B(E)$进行解析积分得到，从而计算出峰分辨率$H_E$。最共振箱的质心位移$\\Delta E_E$和总强度的离散化误差$\\varepsilon_E$也通过解析积分和中点黎曼和计算。\n\n对于等动量分箱方案，动量区间$[k_{\\min}, k_{\\max}]$被划分为$N$个等宽度的箱，这导致能量箱的宽度非均匀。箱平均强度$\\overline{B}^{(k)}_j$通过对变换后的被积函数$B(E(k))$进行数值积分得到，从而计算出峰分辨率$H_k$。质心位移$\\Delta E_k$和离散化误差$\\varepsilon_k$也通过数值积分和变换后的黎曼和计算。\n\n此过程被应用于每个测试用例，以比较两种方案的性能。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes and compares metrics for equal-energy and equal-momentum binning\n    schemes in a simplified CDCC model for three test cases.\n    \"\"\"\n    # Physical constant\n    hbar_c = 197.3269804  # MeV fm\n\n    # Test suite: (mu, E_R, Gamma, E_min, E_max, N)\n    test_cases = [\n        (470.0, 2.0, 0.05, 0.0, 5.0, 50),   # Case A\n        (470.0, 0.2, 0.01, 0.0, 1.0, 40),   # Case B\n        (470.0, 2.5, 0.5, 0.0, 5.0, 10),    # Case C\n    ]\n\n    all_results = []\n    for case in test_cases:\n        mu, E_R, Gamma, E_min, E_max, N = case\n        g2 = Gamma / 2.0\n        g2_sq = g2**2\n\n        # --- Common Model Functions ---\n\n        def B(E):\n            \"\"\"Breit-Wigner resonance shape.\"\"\"\n            return g2_sq / ((E - E_R)**2 + g2_sq)\n\n        def E_of_k(k):\n            \"\"\"Energy as a function of momentum.\"\"\"\n            return (hbar_c * k)**2 / (2 * mu)\n\n        def dE_dk(k):\n            \"\"\"Jacobian dE/dk.\"\"\"\n            return (hbar_c**2 * k) / mu\n\n        # --- Analytic Integrals for Energy Bins ---\n        \n        def integral_B_E(E):\n            \"\"\"Antiderivative of B(E).\"\"\"\n            return g2 * np.arctan((E - E_R) / g2)\n\n        def definite_integral_B_E(E1, E2):\n            \"\"\"Definite integral of B(E) from E1 to E2.\"\"\"\n            return integral_B_E(E2) - integral_B_E(E1)\n\n        def integral_E_B_E(E):\n            \"\"\"Antiderivative of E*B(E).\"\"\"\n            term1 = 0.5 * g2_sq * np.log((E - E_R)**2 + g2_sq)\n            term2 = E_R * g2 * np.arctan((E - E_R) / g2)\n            return term1 + term2\n\n        def definite_integral_E_B_E(E1, E2):\n            \"\"\"Definite integral of E*B(E) from E1 to E2.\"\"\"\n            return integral_E_B_E(E2) - integral_E_B_E(E1)\n        \n        S_exact = definite_integral_B_E(E_min, E_max)\n\n        # --- 1. Equal-Energy Binning ---\n\n        delta_E = (E_max - E_min) / N\n        E_bins = np.linspace(E_min, E_max, N + 1)\n        \n        B_bar_E_i = np.array([(definite_integral_B_E(E_bins[i], E_bins[i+1])) / delta_E for i in range(N)])\n        \n        # H_E (B(E_R) = 1)\n        H_E = np.max(B_bar_E_i)\n        \n        i_star = np.argmax(B_bar_E_i)\n        E_i_star, E_i1_star = E_bins[i_star], E_bins[i_star+1]\n        \n        # Centroid and shift for energy bins\n        num_E_centroid = definite_integral_E_B_E(E_i_star, E_i1_star)\n        den_E_centroid = definite_integral_B_E(E_i_star, E_i1_star)\n        E_centroid_E = num_E_centroid / den_E_centroid if den_E_centroid != 0 else E_R\n        delta_E_E = E_centroid_E - E_R\n        \n        # Discretized sum and error for energy bins\n        E_centers = E_bins[:-1] + delta_E / 2.0\n        S_E_disc = np.sum(B(E_centers)) * delta_E\n        epsilon_E = abs(S_E_disc - S_exact)\n\n        # --- 2. Equal-Momentum Binning ---\n\n        k_min = np.sqrt(2 * mu * E_min) / hbar_c if E_min > 0 else 0.0\n        k_max = np.sqrt(2 * mu * E_max) / hbar_c\n        delta_k = (k_max - k_min) / N\n        k_bins = np.linspace(k_min, k_max, N + 1)\n        \n        # Integrands for momentum space\n        def B_of_E_k(k):\n            return B(E_of_k(k))\n        \n        def E_k_B_of_E_k(k):\n            return E_of_k(k) * B_of_E_k(k)\n        \n        B_bar_k_j = np.array([quad(B_of_E_k, k_bins[j], k_bins[j+1])[0] / delta_k for j in range(N)])\n\n        # H_k (B(E_R) = 1)\n        H_k = np.max(B_bar_k_j)\n        \n        j_star = np.argmax(B_bar_k_j)\n        k_j_star, k_j1_star = k_bins[j_star], k_bins[j_star+1]\n        \n        # Centroid and shift for momentum bins\n        num_k_centroid, _ = quad(E_k_B_of_E_k, k_j_star, k_j1_star, limit=100)\n        den_k_centroid, _ = quad(B_of_E_k, k_j_star, k_j1_star, limit=100)\n        E_centroid_k = num_k_centroid / den_k_centroid if den_k_centroid != 0 else E_R\n        delta_E_k = E_centroid_k - E_R\n        \n        # Discretized sum and error for momentum bins\n        k_centers = k_bins[:-1] + delta_k / 2.0\n        sum_integrand = B(E_of_k(k_centers)) * dE_dk(k_centers)\n        S_k_disc = np.sum(sum_integrand) * delta_k\n        epsilon_k = abs(S_k_disc - S_exact)\n\n        all_results.append([H_E, H_k, epsilon_E, epsilon_k, delta_E_E, delta_E_k])\n\n    # Format and print the final output\n    formatted_rows = []\n    for row in all_results:\n        formatted_floats = [f\"{val:.6f}\" for val in row]\n        formatted_rows.append(f\"[{','.join(formatted_floats)}]\")\n    final_output = f\"[{','.join(formatted_rows)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3552257"}]}