{"hands_on_practices": [{"introduction": "在将任何相互作用用于大规模计算之前，我们必须首先确保其数值实现正确地遵循了基本物理原理，例如全同粒子之间的置换对称性和伽利略不变性（或平移不变性）。本练习提供了一个动手实践的模板，用于为一个模型三核子力创建单元测试，以数值方式验证这些关键属性。掌握这种实践对于开发稳健的代码和防止可能破坏复杂多体计算的微妙错误至关重要 [@problem_id:3609312]。", "problem": "给定一类在坐标空间中的三核子相互作用，它们是局域的、实的，并且仅依赖于相对坐标。考虑三个核子，它们在三维欧几里得空间中的位置矢量分别为 $\\mathbf{r}_1$、$\\mathbf{r}_2$ 和 $\\mathbf{r}_3$，并定义成对的相对矢量 $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$。三核子势算符由下式指定\n$$\nV_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3; C, R, \\alpha)\n=\nC \\exp\\left( - \\frac{|\\mathbf{r}_{12}|^2 + |\\mathbf{r}_{23}|^2 + |\\mathbf{r}_{31}|^2}{2 R^2} \\right)\n\\left[ 1 + \\alpha \\frac{\\mathbf{r}_{12}\\cdot\\mathbf{r}_{23} + \\mathbf{r}_{23}\\cdot\\mathbf{r}_{31} + \\mathbf{r}_{31}\\cdot\\mathbf{r}_{12}}{R^2} \\right],\n$$\n其中 $C$ 是强度参数（能量量纲），$R$ 是长度标度调节参数，$\\alpha$ 是一个无量纲参数。根据其构造，该形式具有平移不变性，并在循环置换下对称，它代表了在带有局域调节子的手征有效场论中使用的局域三体力。\n\n您的任务是编写一个完整的、可运行的程序，为算符 $V_3$ 的三个基本性质构建单元测试：置换对称性、厄米性和伽利略不变性。请使用以下基本依据和定义：\n\n- 置换对称性：如果 $\\hat{\\mathcal{P}}$ 是粒子标签 $\\{1,2,3\\}$ 的任意一个置换，则该算符满足\n$$\nV_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) = V_3(\\mathbf{r}_{\\mathcal{P}(1)},\\mathbf{r}_{\\mathcal{P}(2)},\\mathbf{r}_{\\mathcal{P}(3)}).\n$$\n\n- 厄米性：对于位置表象中任意平方可积的波函数 $\\psi$ 和 $\\phi$，如果满足以下条件，则算符是厄米的\n$$\n\\langle \\psi | \\hat{V}_3 | \\phi \\rangle = \\left( \\langle \\phi | \\hat{V}_3 | \\psi \\rangle \\right)^*,\n$$\n其中\n$$\n\\langle \\psi | \\hat{V}_3 | \\phi \\rangle = \\int_{\\mathbb{R}^9} \\psi^*(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) \\, V_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) \\, \\phi(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) \\, d^3\\mathbf{r}_1\\, d^3\\mathbf{r}_2\\, d^3\\mathbf{r}_3.\n$$\n\n- 伽利略不变性（算符形式的平移不变性）：在坐标表象中定义总动量算符 $\\hat{\\mathbf{P}}_{\\text{tot}} = - i \\hbar \\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i}$。在 $\\hbar = 1$ 的单位制中，平移不变性要求\n$$\n[\\hat{V}_3, \\hat{\\mathbf{P}}_{\\text{tot}}] = \\hat{0},\n$$\n这等价于以下陈述\n$$\n\\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} V_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) = \\mathbf{0}.\n$$\n\n程序必须通过明确定义的测试来数值验证这些性质：\n\n1. 置换对称性测试：对于每个指定的参数集 $(C, R, \\alpha)$，在三个不同的坐标三元组上计算 $V_3$ 的值，并与两种非平凡的标签置换进行比较：循环置换 $(1,2,3)\\to(2,3,1)$ 和对换 $(1 \\leftrightarrow 3)$。报告在这些检查中的最大绝对差值是否低于容差 $\\varepsilon_{\\text{perm}} = 10^{-12}$。\n\n2. 厄米性测试：对于每个指定的参数集 $(C, R, \\alpha)$，定义两个复值波函数\n$$\n\\psi(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) = \\exp\\left( - a \\left( |\\mathbf{r}_1|^2 + |\\mathbf{r}_2|^2 + |\\mathbf{r}_3|^2 \\right) \\right) \\exp\\left( i \\, \\mathbf{k} \\cdot \\left( \\mathbf{r}_1 + 2\\mathbf{r}_2 - \\mathbf{r}_3 \\right) \\right),\n$$\n$$\n\\phi(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) = \\exp\\left( - b \\left( |\\mathbf{r}_1 - \\mathbf{d}|^2 + |\\mathbf{r}_2 + \\mathbf{d}|^2 + |\\mathbf{r}_3|^2 \\right) \\right) \\exp\\left( i \\, \\mathbf{q} \\cdot \\left( 2\\mathbf{r}_1 - \\mathbf{r}_2 + \\mathbf{r}_3 \\right) \\right),\n$$\n其中 $a = 0.25\\, \\text{fm}^{-2}$，$b = 0.3\\, \\text{fm}^{-2}$，$\\mathbf{k} = (0.7, -0.6, 0.5)\\, \\text{fm}^{-1}$，$\\mathbf{q} = (-0.4, 0.3, -0.2)\\, \\text{fm}^{-1}$，以及 $\\mathbf{d} = (0.2, -0.1, 0.0)\\, \\text{fm}$。使用从每个坐标分量的标准差为 $\\sigma = 2.0 \\, \\text{fm}$ 的三粒子因子化高斯分布中抽取的 $N=20000$ 个独立样本，通过蒙特卡洛抽样在 $\\mathbb{R}^9$ 上近似两个矩阵元 $\\langle \\psi | \\hat{V}_3 | \\phi \\rangle$ 和 $\\langle \\phi | \\hat{V}_3 | \\psi \\rangle$。计算相对偏差\n$$\n\\delta_{\\text{herm}} = \\frac{\\left| \\langle \\psi | \\hat{V}_3 | \\phi \\rangle - \\left( \\langle \\phi | \\hat{V}_3 | \\psi \\rangle \\right)^* \\right|}{\\max\\left( \\left| \\langle \\psi | \\hat{V}_3 | \\phi \\rangle \\right|, \\left| \\langle \\phi | \\hat{V}_3 | \\psi \\rangle \\right|, 10^{-12} \\right)},\n$$\n并报告 $\\delta_{\\text{herm}}  10^{-12}$ 是否成立。注意：数值近似必须对两个矩阵元使用同一组随机样本，并且不得执行任何重要性加权；比较是相对于由抽样分布定义的高斯测度进行的。\n\n3. 伽利略不变性测试：对于每个指定的参数集 $(C, R, \\alpha)$ 以及与置换测试中相同的三个坐标三元组，计算梯度之和\n$$\n\\mathbf{G}(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) = \\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} V_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3),\n$$\n并报告在这三个坐标三元组上的最大欧几里得范数 $\\max \\|\\mathbf{G}\\|$ 是否低于 $\\varepsilon_{\\text{gal}} = 10^{-12}$。\n\n测试中使用以下坐标三元组（单位为飞米）（它们作为一个固定的测试套件，涵盖了一个典型情况、一个简并边界和一个大分离边缘情况）：\n- 三元组 A：$\\mathbf{r}_1 = (0.1,-0.3,0.5)$，$\\mathbf{r}_2 = (1.0,0.2,-0.4)$，$\\mathbf{r}_3 = (-0.7,0.5,0.1)$。\n- 三元组 B：$\\mathbf{r}_1 = (0.0,0.0,0.0)$，$\\mathbf{r}_2 = (0.0,0.0,0.0)$，$\\mathbf{r}_3 = (0.0,0.0,0.0)$。\n- 三元组 C：$\\mathbf{r}_1 = (5.0,0.0,0.0)$，$\\mathbf{r}_2 = (-5.0,0.0,0.0)$，$\\mathbf{r}_3 = (0.0,0.0,0.0)$。\n\n待测试的参数集为：\n- 情况 1：$(C, R, \\alpha) = (1.0, 1.8, 0.35)$。\n- 情况 2：$(C, R, \\alpha) = (2.5, 0.8, -0.5)$。\n- 情况 3：$(C, R, \\alpha) = (0.5, 3.0, 1.2)$。\n- 情况 4：$(C, R, \\alpha) = (1.0, 1.0, 0.0)$。\n\n所有长度必须以飞米（fm）为单位处理，所有动量以反飞米（$\\text{fm}^{-1}$）为单位处理。程序的输出是布尔值，指示在每种情况下，每个性质是否在指定的容差内成立。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，条目按\n$$\n[\\text{case1\\_perm}, \\text{case1\\_herm}, \\text{case1\\_gal}, \\text{case2\\_perm}, \\text{case2\\_herm}, \\text{case2\\_gal}, \\text{case3\\_perm}, \\text{case3\\_herm}, \\text{case3\\_gal}, \\text{case4\\_perm}, \\text{case4\\_herm}, \\text{case4\\_gal}],\n$$\n的顺序排列，其中每一项都是一个布尔值。不应打印任何其他文本。", "solution": "我们从坐标表象中量子力学算符的基本原理开始。设 $\\hat{V}_3$ 是一个局域的、实的势算符，其作用是通过与一个标量函数 $V_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3)$ 相乘来实现，并设 $\\psi$ 和 $\\phi$ 是希尔伯特空间 $L^2(\\mathbb{R}^9)$ 中的波函数。\n\n置换对称性源于 $V_3$ 仅仅依赖于成对的相对矢量集合 $\\{\\mathbf{r}_{12}, \\mathbf{r}_{23}, \\mathbf{r}_{31}\\}$ 以及在重新标记下对称的标量组合。具体来说，量 $|\\mathbf{r}_{12}|^2 + |\\mathbf{r}_{23}|^2 + |\\mathbf{r}_{31}|^2$ 和 $\\mathbf{r}_{12}\\cdot\\mathbf{r}_{23} + \\mathbf{r}_{23}\\cdot\\mathbf{r}_{31} + \\mathbf{r}_{31}\\cdot\\mathbf{r}_{12}$ 在 $\\{1,2,3\\}$ 的任何置换下都是不变的，因为置换只是重新标记了相同的对称和中的指标。因此，根据构造，\n$$\nV_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3) = V_3(\\mathbf{r}_{\\mathcal{P}(1)},\\mathbf{r}_{\\mathcal{P}(2)},\\mathbf{r}_{\\mathcal{P}(3)})\n$$\n对于任何置换 $\\mathcal{P}$ 都成立。数值测试在给定的坐标三元组上计算 $V_3$，并将其与非平凡置换下的结果进行比较，验证绝对差值是否低于容差 $\\varepsilon_{\\text{perm}}$。\n\n对于局域实势，其厄米性可以从第一性原理确立。矩阵元\n$$\n\\langle \\psi | \\hat{V}_3 | \\phi \\rangle = \\int \\psi^*(\\mathbf{r})\\, V_3(\\mathbf{r})\\, \\phi(\\mathbf{r}) \\, d^9\\mathbf{r}\n$$\n及其伴随\n$$\n\\left( \\langle \\phi | \\hat{V}_3 | \\psi \\rangle \\right)^* = \\left( \\int \\phi^*(\\mathbf{r})\\, V_3(\\mathbf{r})\\, \\psi(\\mathbf{r}) \\, d^9\\mathbf{r} \\right)^* = \\int \\left( \\phi^*(\\mathbf{r})\\, V_3(\\mathbf{r})\\, \\psi(\\mathbf{r}) \\right)^* \\, d^9\\mathbf{r}.\n$$\n由于 $V_3(\\mathbf{r})$ 是实的且乘法是可交换的，我们逐点有\n$$\n\\left( \\phi^*(\\mathbf{r})\\, V_3(\\mathbf{r})\\, \\psi(\\mathbf{r}) \\right)^* = \\phi(\\mathbf{r})\\, V_3(\\mathbf{r})\\, \\psi^*(\\mathbf{r}) = \\psi^*(\\mathbf{r})\\, V_3(\\mathbf{r})\\, \\phi(\\mathbf{r}),\n$$\n因为两边都等于 $V_3(\\mathbf{r}) \\psi^*(\\mathbf{r}) \\phi(\\mathbf{r})$。因此\n$$\n\\langle \\psi | \\hat{V}_3 | \\phi \\rangle = \\left( \\langle \\phi | \\hat{V}_3 | \\psi \\rangle \\right)^*,\n$$\n这证明了厄米性。在数值上，我们通过蒙特卡洛抽样，相对于一个高斯测度（抽样分布）来近似这些积分；该等式在任何正权重测度下都保持有效，并且为了最小化随机差异，对两个估计使用了相同的样本。然后我们计算相对偏差 $\\delta_{\\text{herm}}$ 并断言它低于 $\\varepsilon_{\\text{herm}}$。\n\n伽利略不变性被理解为算符的平移不变性。使用 $\\hat{\\mathbf{P}}_{\\text{tot}} = - i \\hbar \\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i}$ 且 $\\hbar = 1$，对易子作用于一个测试函数 $\\Psi$ 上为\n$$\n[\\hat{V}_3, \\hat{\\mathbf{P}}_{\\text{tot}}]\\Psi = \\hat{V}_3 \\left( - i \\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} \\Psi \\right) - \\left( - i \\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} \\left( \\hat{V}_3 \\Psi \\right) \\right).\n$$\n使用乘法法则展开第二项得到\n$$\n= - i \\left[ \\hat{V}_3 \\sum_{i} \\nabla_{\\mathbf{r}_i} \\Psi - \\sum_{i} \\left( (\\nabla_{\\mathbf{r}_i} V_3) \\Psi + V_3 \\nabla_{\\mathbf{r}_i} \\Psi \\right) \\right] = i \\left( \\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} V_3 \\right) \\Psi.\n$$\n因此，$[\\hat{V}_3, \\hat{\\mathbf{P}}_{\\text{tot}}] = \\hat{0}$ 当且仅当 $\\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} V_3 = \\mathbf{0}$。对于给定的 $V_3$，我们解析地计算其梯度。定义\n$$\nS = |\\mathbf{r}_{12}|^2 + |\\mathbf{r}_{23}|^2 + |\\mathbf{r}_{31}|^2, \\quad U = \\frac{\\mathbf{r}_{12}\\cdot\\mathbf{r}_{23} + \\mathbf{r}_{23}\\cdot\\mathbf{r}_{31} + \\mathbf{r}_{31}\\cdot\\mathbf{r}_{12}}{R^2},\n$$\n并写出 $V_3 = C e^{-S/(2R^2)} (1 + \\alpha U) \\equiv C A G$，其中 $A = e^{-S/(2R^2)}$ 且 $G = 1 + \\alpha U$。使用 $\\nabla_{\\mathbf{r}_1} S = 2(\\mathbf{r}_{12} - \\mathbf{r}_{31})$，$\\nabla_{\\mathbf{r}_2} S = 2(\\mathbf{r}_{23} - \\mathbf{r}_{12})$，$\\nabla_{\\mathbf{r}_3} S = 2(\\mathbf{r}_{31} - \\mathbf{r}_{23})$，以及\n$$\n\\nabla_{\\mathbf{r}_1} U = \\frac{-\\mathbf{r}_{12} + \\mathbf{r}_{31}}{R^2}, \\quad\n\\nabla_{\\mathbf{r}_2} U = \\frac{-\\mathbf{r}_{23} + \\mathbf{r}_{12}}{R^2}, \\quad\n\\nabla_{\\mathbf{r}_3} U = \\frac{-\\mathbf{r}_{31} + \\mathbf{r}_{23}}{R^2},\n$$\n我们得到\n$$\n\\nabla_{\\mathbf{r}_i} V_3 = C A \\left( - \\frac{\\nabla_{\\mathbf{r}_i} S}{2R^2} G + \\alpha \\nabla_{\\mathbf{r}_i} U \\right).\n$$\n代入表达式得到紧凑形式\n$$\n\\nabla_{\\mathbf{r}_1} V_3 = - C A \\frac{(\\mathbf{r}_{12} - \\mathbf{r}_{31})}{R^2} (G - \\alpha), \\quad\n\\nabla_{\\mathbf{r}_2} V_3 = - C A \\frac{(\\mathbf{r}_{23} - \\mathbf{r}_{12})}{R^2} (G - \\alpha), \\quad\n\\nabla_{\\mathbf{r}_3} V_3 = - C A \\frac{(\\mathbf{r}_{31} - \\mathbf{r}_{23})}{R^2} (G - \\alpha).\n$$\n对 $i=1,2,3$ 求和得到\n$$\n\\sum_{i=1}^3 \\nabla_{\\mathbf{r}_i} V_3 = - C A \\frac{(G - \\alpha)}{R^2} \\left[ (\\mathbf{r}_{12} - \\mathbf{r}_{31}) + (\\mathbf{r}_{23} - \\mathbf{r}_{12}) + (\\mathbf{r}_{31} - \\mathbf{r}_{23}) \\right] = \\mathbf{0}.\n$$\n这个解析恒等式证明了平移不变性。在数值上，我们计算这些梯度，并对给定的坐标三元组计算其和的欧几里得范数，断言其低于容差 $\\varepsilon_{\\text{gal}}$。\n\n算法设计：\n- 使用给定公式实现函数 $V_3(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3; C, R, \\alpha)$，确保数值稳定性和矢量化。\n- 使用推导出的表达式实现解析梯度 $\\nabla_{\\mathbf{r}_i} V_3$（对于 $i=1,2,3$），然后将它们求和以测试伽利略不变性。\n- 对于置换对称性，在指定的坐标三元组及其置换版本上计算 $V_3$；将绝对差值与 $\\varepsilon_{\\text{perm}}$ 进行比较。\n- 对于厄米性，定义具有所提供参数的 $\\psi$ 和 $\\phi$，从乘积高斯分布中为 $(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3)$ 抽取 $N$ 个样本，计算 $\\langle \\psi | V_3 | \\phi \\rangle$ 和 $\\langle \\phi | V_3 | \\psi \\rangle$ 的蒙特卡洛估计，并检查 $\\delta_{\\text{herm}}  \\varepsilon_{\\text{herm}}$。\n- 按规定顺序为每个案例组装结果，并以指定格式打印单行输出。\n\n所有涉及长度的量必须使用飞米，动量使用反飞米。程序输出布尔值，它们是无单位的。最终的打印语句必须只包含所描述的列表，不含任何额外文本。", "answer": "```python\nimport numpy as np\n\n# Seed the random number generator for reproducibility\nnp.random.seed(42)\n\ndef three_body_potential(r1, r2, r3, C, R, alpha):\n    \"\"\"\n    Compute the local three-nucleon potential V3(r1, r2, r3; C, R, alpha).\n    r1, r2, r3 are arrays of shape (..., 3). Broadcasting is supported.\n    \"\"\"\n    r12 = r1 - r2\n    r23 = r2 - r3\n    r31 = r3 - r1\n    s = np.sum(r12 * r12, axis=-1) + np.sum(r23 * r23, axis=-1) + np.sum(r31 * r31, axis=-1)\n    dot_sum = np.sum(r12 * r23, axis=-1) + np.sum(r23 * r31, axis=-1) + np.sum(r31 * r12, axis=-1)\n    A = np.exp(-s / (2.0 * R**2))\n    G = 1.0 + alpha * (dot_sum / (R**2))\n    return C * A * G\n\ndef gradients_sum(r1, r2, r3, C, R, alpha):\n    \"\"\"\n    Compute the sum of gradients \\sum_i \\nabla_{r_i} V3 analytically for given coordinates.\n    This should be analytically zero. This function computes it numerically to verify.\n    \"\"\"\n    r12 = r1 - r2\n    r23 = r2 - r3\n    r31 = r3 - r1\n    s_val = np.dot(r12, r12) + np.dot(r23, r23) + np.dot(r31, r31)\n    dot_sum = np.dot(r12, r23) + np.dot(r23, r31) + np.dot(r31, r12)\n    \n    A = np.exp(-s_val / (2.0 * R**2))\n    G = 1.0 + alpha * (dot_sum / (R**2))\n\n    prefactor = -C * A * (G - alpha) / (R**2)\n\n    grad1 = prefactor * (r12 - r31)\n    grad2 = prefactor * (r23 - r12)\n    grad3 = prefactor * (r31 - r23)\n\n    return grad1 + grad2 + grad3\n\ndef psi_wavefunction(r1, r2, r3, a, k_vec):\n    \"\"\" psi(r1,r2,r3) \"\"\"\n    norm_sq = np.sum(r1*r1, -1) + np.sum(r2*r2, -1) + np.sum(r3*r3, -1)\n    phase_arg = np.sum(k_vec * (r1 + 2.0*r2 - r3), -1)\n    return np.exp(-a * norm_sq) * np.exp(1j * phase_arg)\n\ndef phi_wavefunction(r1, r2, r3, b, q_vec, d_vec):\n    \"\"\" phi(r1,r2,r3) \"\"\"\n    r1_s = r1 - d_vec\n    r2_s = r2 + d_vec\n    norm_sq = np.sum(r1_s*r1_s, -1) + np.sum(r2_s*r2_s, -1) + np.sum(r3*r3, -1)\n    phase_arg = np.sum(q_vec * (2.0*r1 - r2 + r3), -1)\n    return np.exp(-b * norm_sq) * np.exp(1j * phase_arg)\n\ndef permutation_test(C, R, alpha, coords, tol=1e-12):\n    max_diff = 0.0\n    for r1, r2, r3 in coords:\n        v_orig = three_body_potential(r1, r2, r3, C, R, alpha)\n        # Cyclic permutation: (1,2,3) -> (2,3,1)\n        v_cyclic = three_body_potential(r2, r3, r1, C, R, alpha)\n        # Transposition: (1,3) -> (3,2,1)\n        v_transp = three_body_potential(r3, r2, r1, C, R, alpha)\n        \n        diff1 = abs(v_orig - v_cyclic)\n        diff2 = abs(v_orig - v_transp)\n        max_diff = max(max_diff, diff1, diff2)\n    return max_diff  tol\n\ndef hermiticity_test(C, R, alpha, N_samples=20000, sigma=2.0, tol=1e-12):\n    a, b = 0.25, 0.3\n    k_vec = np.array([0.7, -0.6, 0.5])\n    q_vec = np.array([-0.4, 0.3, -0.2])\n    d_vec = np.array([0.2, -0.1, 0.0])\n    \n    samples = np.random.normal(loc=0.0, scale=sigma, size=(N_samples, 3, 3))\n    r1, r2, r3 = samples[:,0,:], samples[:,1,:], samples[:,2,:]\n\n    V3_vals = three_body_potential(r1, r2, r3, C, R, alpha)\n    psi_vals = psi_wavefunction(r1, r2, r3, a, k_vec)\n    phi_vals = phi_wavefunction(r1, r2, r3, b, q_vec, d_vec)\n\n    integrand1 = np.conj(psi_vals) * V3_vals * phi_vals\n    integrand2 = np.conj(phi_vals) * V3_vals * psi_vals\n    \n    m_psi_V_phi = np.mean(integrand1)\n    m_phi_V_psi = np.mean(integrand2)\n\n    numerator = np.abs(m_psi_V_phi - np.conj(m_phi_V_psi))\n    denominator = max(np.abs(m_psi_V_phi), np.abs(m_phi_V_psi), 1e-12)\n    delta_herm = numerator / denominator\n    \n    # The problem specifies a very tight tolerance for an MC test.\n    # The result may be False, which is a valid outcome of the test.\n    return delta_herm  tol\n\ndef galilean_test(C, R, alpha, coords, tol=1e-12):\n    max_norm = 0.0\n    for r1, r2, r3 in coords:\n        grad_sum = gradients_sum(r1, r2, r3, C, R, alpha)\n        norm = np.linalg.norm(grad_sum)\n        max_norm = max(max_norm, norm)\n    return max_norm  tol\n\ndef main():\n    coords_list = [\n        (np.array([0.1, -0.3, 0.5]), np.array([1.0, 0.2, -0.4]), np.array([-0.7, 0.5, 0.1])),\n        (np.array([0.0, 0.0, 0.0]), np.array([0.0, 0.0, 0.0]), np.array([0.0, 0.0, 0.0])),\n        (np.array([5.0, 0.0, 0.0]), np.array([-5.0, 0.0, 0.0]), np.array([0.0, 0.0, 0.0]))\n    ]\n    \n    param_sets = [\n        (1.0, 1.8, 0.35),\n        (2.5, 0.8, -0.5),\n        (0.5, 3.0, 1.2),\n        (1.0, 1.0, 0.0)\n    ]\n    \n    results = []\n    for C, R, alpha in param_sets:\n        perm_ok = permutation_test(C, R, alpha, coords_list)\n        herm_ok = hermiticity_test(C, R, alpha)\n        gal_ok = galilean_test(C, R, alpha, coords_list)\n        results.extend([perm_ok, herm_ok, gal_ok])\n    \n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nmain()\n```", "id": "3609312"}, {"introduction": "在实际的多体计算中，使用完整的三核子力（3N）在计算上往往是不可行的，这使得截断成为必要，例如在分波基矢中进行截断。本练习使用一个代理模型来模拟一个真实的研究任务：评估这种截断对关键物理可观测量（如核物质饱和性质和同位素能量）的影响。通过识别最重要的分波渠道，您将培养出对模型空间约减和理论不确定性来源的直觉 [@problem_id:3609397]。", "problem": "在核多体理论中，三核子（3N）相互作用可以按照总角动量 $J$、宇称 $\\pi$ 和同位旋 $T$（统称为 $J^{\\pi}T$ 道）标记的分波进行组织。在哈特里-福克（HF）水平上，固定密度下的总能量可以近似为两核子（2N）基线和按道分解的 3N 部分的附加贡献，后者的密度依赖性是平滑的。在此问题中，您将通过仅包含 $J^{\\pi}T$ 道的一个子集来量化截断 3N 分波空间所引起的误差。您的目标是使用下面完全指定的简化代理模型，确定能够在指定的目标精度内，再现无限核物质饱和性质和简单的钙同位素能量系统性规律的最小道集。\n\n给定以下用于对称无限核物质在零温度下每核子能量的代理模型：\n- 设密度为 $\\rho$，单位为 $\\text{fm}^{-3}$，并定义 $r \\equiv \\rho/\\rho_{0}$，其中参考密度 $\\rho_{0} = 0.16\\,\\text{fm}^{-3}$。\n- 2N 基线对每核子能量的贡献（单位为 $\\text{MeV}$）为\n$$\nE_{2\\text{N}}(r) = D + C\\,r^{2} + B\\, r^{4/3} - A\\, r + K\\, r^{2/3},\n$$\n其中常数 $K=12.0\\,\\text{MeV}$、$A=28.0\\,\\text{MeV}$、$B=10.0\\,\\text{MeV}$、$C=0.5\\,\\text{MeV}$ 和 $D=-14.5\\,\\text{MeV}$。\n\n- 3N 贡献是各道函数的总和，\n$$\nE_{3\\text{N}}(r;\\mathcal{S}) = \\sum_{c \\in \\mathcal{S}} w_{c}\\, r^{n_{c}},\n$$\n其中 $\\mathcal{S}$ 是所包含的道集，$w_{c}$ 是道的权重（单位为 $\\text{MeV}$），$n_{c}$ 是密度指数。八个可用道由 $c \\in \\{0,1,2,3,4,5,6,7\\}$ 索引，并代表主要的 $J^{\\pi}T$ 部分：\n- $c=0$: $(0^{+},1)$，其中 $(w_{0},n_{0})=(0.7,1.0)$，\n- $c=1$: $(1^{+},0)$，其中 $(w_{1},n_{1})=(0.6,4/3)$，\n- $c=2$: $(2^{+},1)$，其中 $(w_{2},n_{2})=(0.9,5/3)$，\n- $c=3$: $(3^{+},0)$，其中 $(w_{3},n_{3})=(0.8,2.0)$，\n- $c=4$: $(1^{-},1)$，其中 $(w_{4},n_{4})=(0.4,7/3)$，\n- $c=5$: $(2^{-},0)$，其中 $(w_{5},n_{5})=(0.3,8/3)$，\n- $c=6$: $(3^{-},1)$，其中 $(w_{6},n_{6})=(0.2,3.0)$，\n- $c=7$: $(2^{+},0)$，其中 $(w_{7},n_{7})=(0.1,2.5)$。\n\n因此，对于选定的子集 $\\mathcal{S}$，总的每核子能量为\n$$\n\\frac{E}{A}(r;\\mathcal{S}) = E_{2\\text{N}}(r) + E_{3\\text{N}}(r;\\mathcal{S}).\n$$\n\n对于给定的子集 $\\mathcal{S}$，将核物质饱和点定义为在区间 $\\rho \\in [0.14, 0.18]\\,\\text{fm}^{-3}$（即 $r \\in [0.14/0.16, 0.18/0.16]$）内使 $\\frac{E}{A}(r;\\mathcal{S})$ 最小化的密度 $\\rho_{\\text{sat}}(\\mathcal{S})$。相应的最小每核子能量为 $E_{\\text{min}}(\\mathcal{S}) = \\min_{r \\in [0.14/0.16, 0.18/0.16]} \\frac{E}{A}(r;\\mathcal{S})$。“基准真相”参考由全道集 $\\mathcal{F}=\\{0,1,2,3,4,5,6,7\\}$ 定义，产生 $\\rho_{\\text{sat}}(\\mathcal{F})$ 和 $E_{\\text{min}}(\\mathcal{F})$。\n\n钙的系统性规律被建模为添加到两个核素（$^{40}\\text{Ca}$ 和 $^{48}\\text{Ca}$）的 2N 基线上的线性道和。对于子集 $\\mathcal{S}$，总基态能量（单位为 $\\text{MeV}$）为\n$$\nE_{40}(\\mathcal{S}) = E^{(40)}_{2\\text{N}} + \\sum_{c\\in\\mathcal{S}} b^{(40)}_{c}, \\quad\nE_{48}(\\mathcal{S}) = E^{(48)}_{2\\text{N}} + \\sum_{c\\in\\mathcal{S}} b^{(48)}_{c}.\n$$\n2N 基线为 $E^{(40)}_{2\\text{N}}=-355.0\\,\\text{MeV}$ 和 $E^{(48)}_{2\\text{N}}=-434.0\\,\\text{MeV}$。道系数（单位为 $\\text{MeV}$）如下：\n- 对于 $^{40}\\text{Ca}$：$\\big(b^{(40)}_{0},b^{(40)}_{1},b^{(40)}_{2},b^{(40)}_{3},b^{(40)}_{4},b^{(40)}_{5},b^{(40)}_{6},b^{(40)}_{7}\\big) = (2.5,2.0,3.0,2.5,1.0,1.0,0.5,0.5)$。\n- 对于 $^{48}\\text{Ca}$：$\\big(b^{(48)}_{0},b^{(48)}_{1},b^{(48)}_{2},b^{(48)}_{3},b^{(48)}_{4},b^{(48)}_{5},b^{(48)}_{6},b^{(48)}_{7}\\big) = (3.0,2.5,3.5,3.0,2.0,1.5,1.0,1.5)$。\n\n“基准真相”钙能量由全道集 $\\mathcal{F}$ 定义。\n\n误差度量。对于任何子集 $\\mathcal{S}$，定义相对于全道参考的四个绝对误差：\n- 核物质最小能量误差（单位为 $\\text{MeV}$）：\n$$\n\\Delta E_{\\text{min}}(\\mathcal{S}) \\equiv \\left| E_{\\text{min}}(\\mathcal{S}) - E_{\\text{min}}(\\mathcal{F}) \\right|.\n$$\n- 核物质饱和密度误差（单位为 $\\text{fm}^{-3}$）：\n$$\n\\Delta \\rho_{\\text{sat}}(\\mathcal{S}) \\equiv \\left| \\rho_{\\text{sat}}(\\mathcal{S}) - \\rho_{\\text{sat}}(\\mathcal{F}) \\right|.\n$$\n- 钙能量误差（单位为 $\\text{MeV}$）：\n$$\n\\Delta E_{40}(\\mathcal{S}) \\equiv \\left| E_{40}(\\mathcal{S}) - E_{40}(\\mathcal{F}) \\right|, \\quad\n\\Delta E_{48}(\\mathcal{S}) \\equiv \\left| E_{48}(\\mathcal{S}) - E_{48}(\\mathcal{F}) \\right|.\n$$\n\n可行性与最优性判据。对于给定的容差四元组 $(\\varepsilon_{E}, \\varepsilon_{\\rho}, \\varepsilon_{40}, \\varepsilon_{48})$，子集 $\\mathcal{S}$ 是可行的，当且仅当\n$$\n\\Delta E_{\\text{min}}(\\mathcal{S}) \\le \\varepsilon_{E}, \\quad\n\\Delta \\rho_{\\text{sat}}(\\mathcal{S}) \\le \\varepsilon_{\\rho}, \\quad\n\\Delta E_{40}(\\mathcal{S}) \\le \\varepsilon_{40}, \\quad\n\\Delta E_{48}(\\mathcal{S}) \\le \\varepsilon_{48}.\n$$\n在所有可行的子集中，选择一个基数 $|\\mathcal{S}|$ 最小的。如果多个子集具有相同的最小基数，则选择字典序最小的有序索引列表。如果没有可行的子集，则返回单元列表 $[-1]$。\n\n您的程序必须：\n- 完全按照上述规定使用模型和常数。\n- 通过在 $\\rho \\in [0.14,0.18]\\,\\text{fm}^{-3}$ 上对 $\\frac{E}{A}(r;\\mathcal{F})$ 进行数值最小化来确定全道参考值。\n- 对于每个候选子集 $\\mathcal{S} \\subseteq \\{0,1,2,3,4,5,6,7\\}$，计算所有四个误差并测试可行性。\n- 对于测试套件中的每个容差四元组，根据上述规则返回最小可行道集。\n\n数值细节：\n- 通过在 $[0.14,0.18]\\,\\text{fm}^{-3}$ 上以不大于 $0.0001\\,\\text{fm}^{-3}$ 的步长在均匀网格上采样 $\\rho$ 来执行饱和搜索。将 $\\rho_{\\text{sat}}$ 报告为使 $\\frac{E}{A}$ 最小化的网格点。\n- 所有能量必须以 $\\text{MeV}$ 为单位处理，密度以 $\\text{fm}^{-3}$ 为单位处理。最终返回的道索引是无量纲整数。\n\n测试套件。为以下容差四元组 $(\\varepsilon_{E}, \\varepsilon_{\\rho}, \\varepsilon_{40}, \\varepsilon_{48})$ 运行您的程序：\n- 情况 1（中等）：$(0.5, 0.004, 1.0, 1.5)$。\n- 情况 2（严格）：$(0.1, 0.001, 0.5, 0.5)$。\n- 情况 3（宽松）：$(5.0, 0.02, 20.0, 25.0)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表的列表，其中每个内部列表是对应测试用例的字典序排序的最小可行道索引集，例如 \"[[0,1,2],[0,1,2,3],[]]\"。如果某个情况不可行，其位置应包含 \"[-1]\"。输出必须是单行，不含任何额外文本。", "solution": "该问题要求我们确定三核子（3N）相互作用道的最小子集，这些子集能够在指定的误差容限内再现关键的核性质。这些性质包括无限对称核物质的饱和能量和饱和密度，以及 $^{40}\\text{Ca}$ 和 $^{48}\\text{Ca}$ 同位素的基态能量。问题为这些量提供了一个代理模型。我们的任务是根据给定的可行性和最优性判据，系统地搜索最优的道子集。\n\n首先，我们形式化该模型。对称核物质中的每核子能量 $\\frac{E}{A}$ 是约化密度 $r = \\rho/\\rho_{0}$ 的函数，其中 $\\rho_{0} = 0.16\\,\\text{fm}^{-3}$。它由两核子（2N）基线和 3N 贡献组成：\n$$\n\\frac{E}{A}(r;\\mathcal{S}) = E_{2\\text{N}}(r) + E_{3\\text{N}}(r;\\mathcal{S})\n$$\n其中 $\\mathcal{S}$ 是所选的 3N 道的子集。\n\n2N 贡献由下式给出：\n$$\nE_{2\\text{N}}(r) = D + C\\,r^{2} + B\\, r^{4/3} - A\\, r + K\\, r^{2/3}\n$$\n指定的常数为 $K=12.0\\,\\text{MeV}$、$A=28.0\\,\\text{MeV}$、$B=10.0\\,\\text{MeV}$、$C=0.5\\,\\text{MeV}$ 和 $D=-14.5\\,\\text{MeV}$。\n\n3N 贡献是包含在子集 $\\mathcal{S} \\subseteq \\{0,1,2,3,4,5,6,7\\}$ 中的道 $c$ 的和：\n$$\nE_{3\\text{N}}(r;\\mathcal{S}) = \\sum_{c \\in \\mathcal{S}} w_{c}\\, r^{n_{c}}\n$$\n八个道的参数为：\n- $c=0$: $(w_{0},n_{0})=(0.7,1.0)$\n- $c=1$: $(w_{1},n_{1})=(0.6,4/3)$\n- $c=2$: $(w_{2},n_{2})=(0.9,5/3)$\n- $c=3$: $(w_{3},n_{3})=(0.8,2.0)$\n- $c=4$: $(w_{4},n_{4})=(0.4,7/3)$\n- $c=5$: $(w_{5},n_{5})=(0.3,8/3)$\n- $c=6$: $(w_{6},n_{6})=(0.2,3.0)$\n- $c=7$: $(w_{7},n_{7})=(0.1,2.5)$\n\n$^{40}\\text{Ca}$ 和 $^{48}\\text{Ca}$ 的基态能量也是对 $\\mathcal{S}$ 中各道的求和：\n$$\nE_{40}(\\mathcal{S}) = E^{(40)}_{2\\text{N}} + \\sum_{c\\in\\mathcal{S}} b^{(40)}_{c}\n$$\n$$\nE_{48}(\\mathcal{S}) = E^{(48)}_{2\\text{N}} + \\sum_{c\\in\\mathcal{S}} b^{(48)}_{c}\n$$\n2N 基线为 $E^{(40)}_{2\\text{N}}=-355.0\\,\\text{MeV}$ 和 $E^{(48)}_{2\\text{N}}=-434.0\\,\\text{MeV}$。道系数为：\n- 对于 $^{40}\\text{Ca}$：$\\vec{b}^{(40)} = (2.5,2.0,3.0,2.5,1.0,1.0,0.5,0.5)\\,\\text{MeV}$。\n- 对于 $^{48}\\text{Ca}$：$\\vec{b}^{(48)} = (3.0,2.5,3.5,3.0,2.0,1.5,1.0,1.5)\\,\\text{MeV}$。\n\n问题的核心是将使用截断子集 $\\mathcal{S}$ 的计算与使用全道集 $\\mathcal{F} = \\{0,1,2,3,4,5,6,7\\}$ 的“基准真相”参考计算进行比较。四个误差度量被定义为与参考值的绝对差：\n$$\n\\Delta E_{\\text{min}}(\\mathcal{S}) \\equiv \\left| E_{\\text{min}}(\\mathcal{S}) - E_{\\text{min}}(\\mathcal{F}) \\right|\n$$\n$$\n\\Delta \\rho_{\\text{sat}}(\\mathcal{S}) \\equiv \\left| \\rho_{\\text{sat}}(\\mathcal{S}) - \\rho_{\\text{sat}}(\\mathcal{F}) \\right|\n$$\n$$\n\\Delta E_{40}(\\mathcal{S}) \\equiv \\left| E_{40}(\\mathcal{S}) - E_{40}(\\mathcal{F}) \\right|\n$$\n$$\n\\Delta E_{48}(\\mathcal{S}) \\equiv \\left| E_{48}(\\mathcal{S}) - E_{48}(\\mathcal{F}) \\right|\n$$\n核物质性质 $E_{\\text{min}}(\\mathcal{S})$ 和 $\\rho_{\\text{sat}}(\\mathcal{S})$ 是通过在密度范围 $\\rho \\in [0.14, 0.18]\\,\\text{fm}^{-3}$ 上最小化 $\\frac{E}{A}(r;\\mathcal{S})$ 得到的最小每核子能量及其对应的密度。\n\n钙的能量误差可以被简化。设 $\\mathcal{S}^c = \\mathcal{F} \\setminus \\mathcal{S}$ 为被省略的道集。那么：\n$$\n\\Delta E_{40}(\\mathcal{S}) = \\left| \\left(E^{(40)}_{2\\text{N}} + \\sum_{c\\in\\mathcal{S}} b^{(40)}_{c}\\right) - \\left(E^{(40)}_{2\\text{N}} + \\sum_{c\\in\\mathcal{F}} b^{(40)}_{c}\\right) \\right| = \\left| -\\sum_{c\\in\\mathcal{S}^c} b^{(40)}_{c} \\right| = \\sum_{c\\in\\mathcal{S}^c} b^{(40)}_{c}\n$$\n因为所有的 $b^{(40)}_{c} \\ge 0$。类似地，$\\Delta E_{48}(\\mathcal{S}) = \\sum_{c\\in\\mathcal{S}^c} b^{(48)}_{c}$。\n\n为每个测试用例寻找最优子集的算法方法是一个系统性的、有序的搜索过程。\n1.  **参考值计算**：我们首先计算参考值。函数 $\\frac{E}{A}(r;\\mathcal{F})$ 在一个从 $0.14\\,\\text{fm}^{-3}$ 到 $0.18\\,\\text{fm}^{-3}$、步长为 $0.0001\\,\\text{fm}^{-3}$ 的均匀密度网格上进行求值，如问题所述。此网格上的最小值产生 $E_{\\text{min}}(\\mathcal{F})$，对应的密度为 $\\rho_{\\text{sat}}(\\mathcal{F})$。根据定义，参考钙能量误差为零，但我们预先计算总和 $\\sum_{c \\in \\mathcal{F}} b_c$ 以加速后续的误差计算。\n\n2.  **系统性子集搜索**：寻找最优子集必须遍历 $\\mathcal{F}$ 的幂集，该幂集包含 $2^8 = 256$ 个子集。为满足最优性判据（最小基数，然后是字典序最小），我们首先按子集大小 $|\\mathcal{S}|$ 从 $k=0$ 到 $k=8$ 迭代所有子集 $\\mathcal{S}$，对于每个大小，再按其元素的字典序进行迭代。对于由容差四元组 $(\\varepsilon_{E}, \\varepsilon_{\\rho}, \\varepsilon_{40}, \\varepsilon_{48})$ 定义的三个测试用例中的每一个，我们寻找此序列中第一个可行的子集。\n\n3.  **可行性检查**：对于有序序列中的每个子集 $\\mathcal{S}$，我们执行以下操作：\n    a. 我们构建函数 $\\frac{E}{A}(r;\\mathcal{S})$ 并使用相同的数值网格搜索找到其饱和点 ($E_{\\text{min}}(\\mathcal{S}), \\rho_{\\text{sat}}(\\mathcal{S})$)。\n    b. 我们计算四个误差 $\\Delta E_{\\text{min}}(\\mathcal{S})$、$\\Delta \\rho_{\\text{sat}}(\\mathcal{S})$、$\\Delta E_{40}(\\mathcal{S})$ 和 $\\Delta E_{48}(\\mathcal{S})$。\n    c. 对于每个尚未解决的测试用例，我们通过将误差与容差进行比较来检查子集是否可行：$\\Delta E_{\\text{min}} \\le \\varepsilon_{E}$、$\\Delta \\rho_{\\text{sat}} \\le \\varepsilon_{\\rho}$、$\\Delta E_{40} \\le \\varepsilon_{40}$ 和 $\\Delta E_{48} \\le \\varepsilon_{48}$。\n    d. 如果发现某个子集对于给定的测试用例是可行的，它会立即被选为该用例的最优解，并且不再需要为该用例检查其他子集。这是由搜索的特定顺序保证的。\n\n4.  **最终结果组装**：如果搜索完成，但某个特定的测试用例没有找到可行的子集，则该用例的结果是单元列表 $[-1]$。最终输出是所有测试用例最优子集的集合。\n\n这种确定性算法确保了为每个用例返回的子集确实是元素数量最少的那个，并且在这些子集中是字典序最靠前的那个。", "answer": "```python\nimport numpy as np\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves the nuclear channel truncation problem by systematically searching for\n    minimal feasible channel subsets.\n    \"\"\"\n    #\n    # --- Model Parameters ---\n    #\n    RHO0 = 0.16  # Reference density in fm^-3\n\n    # 2N constants (MeV)\n    K, A, B, C, D = 12.0, 28.0, 10.0, 0.5, -14.5\n\n    # 3N channel parameters (w_c in MeV, n_c is dimensionless)\n    CHANNELS = {\n        0: {'w': 0.7, 'n': 1.0},\n        1: {'w': 0.6, 'n': 4.0/3.0},\n        2: {'w': 0.9, 'n': 5.0/3.0},\n        3: {'w': 0.8, 'n': 2.0},\n        4: {'w': 0.4, 'n': 7.0/3.0},\n        5: {'w': 0.3, 'n': 8.0/3.0},\n        6: {'w': 0.2, 'n': 3.0},\n        7: {'w': 0.1, 'n': 2.5},\n    }\n    \n    # Calcium coefficients (MeV)\n    B40_C = np.array([2.5, 2.0, 3.0, 2.5, 1.0, 1.0, 0.5, 0.5])\n    B48_C = np.array([3.0, 2.5, 3.5, 3.0, 2.0, 1.5, 1.0, 1.5])\n    \n    # Test cases (tolerances)\n    test_cases = [\n        (0.5, 0.004, 1.0, 1.5),  # Case 1 (moderate)\n        (0.1, 0.001, 0.5, 0.5),  # Case 2 (tight)\n        (5.0, 0.02, 20.0, 25.0), # Case 3 (loose)\n    ]\n    \n    #\n    # --- Numerical Setup ---\n    #\n    RHO_MIN, RHO_MAX, RHO_STEP = 0.14, 0.18, 0.0001\n    rho_grid = np.arange(RHO_MIN, RHO_MAX + RHO_STEP, RHO_STEP)\n    r_grid = rho_grid / RHO0\n\n    #\n    # --- Helper Functions ---\n    #\n    def get_e_per_a(r_vals, subset):\n        \"\"\"Calculates E/A for a given subset of channels.\"\"\"\n        e_2n = D + C * r_vals**2 + B * r_vals**(4/3) - A * r_vals + K * r_vals**(2/3)\n        e_3n = np.zeros_like(r_vals)\n        for c in subset:\n            e_3n += CHANNELS[c]['w'] * r_vals**CHANNELS[c]['n']\n        return e_2n + e_3n\n\n    def get_saturation_point(e_per_a_vals, rho_vals):\n        \"\"\"Finds saturation energy and density from an E/A curve.\"\"\"\n        min_idx = np.argmin(e_per_a_vals)\n        e_min = e_per_a_vals[min_idx]\n        rho_sat = rho_vals[min_idx]\n        return e_min, rho_sat\n\n    #\n    # --- Main Calculation ---\n    #\n    # 1. Calculate reference values using the full channel set\n    full_set = list(range(8))\n    e_per_a_ref = get_e_per_a(r_grid, full_set)\n    e_min_ref, rho_sat_ref = get_saturation_point(e_per_a_ref, rho_grid)\n    \n    total_b40 = np.sum(B40_C)\n    total_b48 = np.sum(B48_C)\n\n    # 2. Iterate through subsets, ordered by cardinality then lexicographically\n    all_channels = list(range(8))\n    results = [None] * len(test_cases)\n    \n    for k in range(len(all_channels) + 1):\n        if all(res is not None for res in results):\n            break\n            \n        for subset_tuple in combinations(all_channels, k):\n            subset = list(subset_tuple)\n            \n            e_per_a_subset = get_e_per_a(r_grid, subset)\n            e_min_subset, rho_sat_subset = get_saturation_point(e_per_a_subset, rho_grid)\n            \n            delta_e_min = abs(e_min_subset - e_min_ref)\n            delta_rho_sat = abs(rho_sat_subset - rho_sat_ref)\n            \n            sum_b40_subset = np.sum(B40_C[subset])\n            sum_b48_subset = np.sum(B48_C[subset])\n            \n            delta_e40 = total_b40 - sum_b40_subset\n            delta_e48 = total_b48 - sum_b48_subset\n            \n            for i, case in enumerate(test_cases):\n                if results[i] is not None:\n                    continue\n                \n                eps_E, eps_rho, eps_40, eps_48 = case\n                \n                is_feasible = (\n                    delta_e_min = eps_E and\n                    delta_rho_sat = eps_rho and\n                    delta_e40 = eps_40 and\n                    delta_e48 = eps_48\n                )\n                \n                if is_feasible:\n                    results[i] = subset\n\n    # 3. Finalize results: if any case is still unsolved, mark as infeasible\n    for i in range(len(results)):\n        if results[i] is None:\n            results[i] = [-1]\n\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n```", "id": "3609397"}, {"introduction": "手征有效场论的预测能力依赖于通过拟合实验数据来精确确定其低能常数（LECs），例如三核子力的参数 $c_D$ 和 $c_E$。这项高级练习介绍了一种前沿技术，用于在介质中相似性重整化群（IMSRG）框架内计算核能对这些低能常数的敏感性。通过实现这种梯度计算的简化版本，您将深入了解那些促成现代核相互作用高效优化的强大方法 [@problem_id:3609341]。", "problem": "你的任务是设计一个最小化的、但科学上一致的数值框架，以通过介质内相似性重整化群 (IMSRG) 捕捉三核子力如何影响中等质量原子核能量预测的本质。你的目标是计算能量相对于两个手征有效场论 (EFT) 低能常数（表示为 $c_D$ 和 $c_E$）的敏感性，单位为兆电子伏特 (MeV)。该框架必须是纯算法的，并且必须能够实现为一个完整的、可运行的程序。\n\n基本出发点如下：\n- 从一个闭壳层参考态的正规序哈密顿量开始，截断到双体水平，其中三核子力的贡献由依赖于密度的有效单体和双体项近似。参数 $c_D$ 和 $c_E$ 仅通过这些正规序项引入，并被视为无量纲的低能常数。\n- 采用相似性重整化群 (SRG) 的思想，以介质内相似性重整化群 (IMSRG) 的形式，其中一个反厄米生成元驱动哈密顿量趋向于块对角形式，从而将参考态与激发态解耦。使用由 $\\eta(s) = [H_d(s), H_{od}(s)]$ 定义的 Wegner 生成元，其中 $H_d(s)$ 是 $H(s)$ 的对角部分，$H_{od}(s)$ 是非对角部分，$s$ 是满足 $s \\ge 0$ 的连续流参数。流方程为 $dH(s)/ds = [\\eta(s), H(s)]$。\n- 为确保通用性和计算简便性，限制在一个双能级模型（一个空穴轨道和一个粒子轨道）内，其哈密顿量为\n$$\nH(s) = \\begin{pmatrix}\ne_h(s)  v(s) \\\\\nv(s)  e_p(s)\n\\end{pmatrix},\n$$\n其中 $e_h(s)$ 和 $e_p(s)$ 是能级能量，$v(s)$ 是非对角耦合。所有量都是实数且 $H(s)$ 是对称的。在 $s=0$ 时的初始条件通过以下方式编码了对 $c_D$ 和 $c_E$ 的正规序依赖关系\n$$\ne_h(0) = \\varepsilon_h + \\alpha_{hD} \\, \\rho \\, c_D + \\alpha_{hE} \\, \\rho^2 \\, c_E,\n$$\n$$\ne_p(0) = \\varepsilon_p + \\alpha_{pD} \\, \\rho \\, c_D + \\alpha_{pE} \\, \\rho^2 \\, c_E,\n$$\n$$\nv(0) = v_0 + \\beta_D \\, \\rho \\, c_D + \\beta_E \\, \\rho \\, c_E,\n$$\n其中 $\\varepsilon_h$, $\\varepsilon_p$, $v_0$, $\\alpha_{hD}$, $\\alpha_{hE}$, $\\alpha_{pD}$, $\\alpha_{pE}$, $\\beta_D$, $\\beta_E$ 为已知常数，核物质密度 $\\rho$ 的单位为 $\\text{fm}^{-3}$。将 $c_D$ 和 $c_E$ 视为变量。\n\n从这些定义和 SRG 流出发，你必须：\n1. 在双能级模型中使用 Wegner 生成元推导 $H(s)$ 的流方程。使用对易子定义和分解 $H(s) = H_d(s) + H_{od}(s)$。\n2. 通过对参数微分 $H(s)$ 的流并应用链式法则构建一个切向线性系统，为 $\\partial e_h(s)/\\partial c_D$, $\\partial e_p(s)/\\partial c_D$, $\\partial v(s)/\\partial c_D$ 以及关于 $c_E$ 的类似导数，构建并实现一个前向模式敏感性传播。除了初始条件外，流方程的右侧没有显式的 $c_D$ 或 $c_E$ 依赖性，因此参数敏感性完全通过流相对于状态的雅可比矩阵来演化。\n3. 在指定的最终流参数 $s_{\\text{max}}$（一个正实数）下，计算最低本征值 $\\lambda_{\\min}(H(s_{\\text{max}}))$ 及其相关的归一化本征矢。使用一阶微扰理论计算最低本征值相对于 $c_D$ 和 $c_E$ 的敏感性为\n$$\n\\frac{\\partial \\lambda_{\\min}}{\\partial p} = \\mathbf{v}_{\\min}^\\top \\left( \\frac{\\partial H}{\\partial p} \\right) \\mathbf{v}_{\\min}, \\quad p \\in \\{c_D, c_E\\},\n$$\n其中 $\\mathbf{v}_{\\min}$ 是对应于 $\\lambda_{\\min}$ 的归一化本征矢，而在 $s_{\\text{max}}$ 处的 $\\frac{\\partial H}{\\partial p}$ 由传播的敏感性构成。以 $\\text{MeV}$ 为单位报告这些导数。\n\n实现此过程并将其应用于以下测试套件。对于每个测试用例，使用所提供的值来定义 $s=0$ 时的初始条件，将 IMSRG 流积分到给定的 $s_{\\text{max}}$，执行敏感性传播，并输出两个能量导数 $\\left[\\frac{\\partial E}{\\partial c_D}, \\frac{\\partial E}{\\partial c_E}\\right]$，其中 $E = \\lambda_{\\min}(H(s_{\\text{max}}))$，两个导数都以 $\\text{MeV}$ 为单位表示为浮点数。\n\n测试套件（每个用例列出 $\\varepsilon_h$, $\\varepsilon_p$, $v_0$, $\\rho$, $\\alpha_{hD}$, $\\alpha_{hE}$, $\\alpha_{pD}$, $\\alpha_{pE}$, $\\beta_D$, $\\beta_E$, $c_D$, $c_E$, $s_{\\text{max}}$）：\n- 用例 1 (中等质量，典型耦合): $\\varepsilon_h = -12.0 \\, \\text{MeV}$, $\\varepsilon_p = 3.0 \\, \\text{MeV}$, $v_0 = 1.5 \\, \\text{MeV}$, $\\rho = 0.16 \\, \\text{fm}^{-3}$, $\\alpha_{hD} = 2.0$, $\\alpha_{hE} = 1.5$, $\\alpha_{pD} = 1.0$, $\\alpha_{pE} = 0.5$, $\\beta_D = 0.8$, $\\beta_E = 0.2$, $c_D = -0.2$, $c_E = -0.5$, $s_{\\text{max}} = 20.0$。\n- 用例 2 (无耦合的边界情况): $\\varepsilon_h = -10.0 \\, \\text{MeV}$, $\\varepsilon_p = 2.0 \\, \\text{MeV}$, $v_0 = 0.0 \\, \\text{MeV}$, $\\rho = 0.16 \\, \\text{fm}^{-3}$, $\\alpha_{hD} = 2.0$, $\\alpha_{hE} = 1.5$, $\\alpha_{pD} = 1.0$, $\\alpha_{pE} = 0.5$, $\\beta_D = 0.8$, $\\beta_E = 0.2$, $c_D = 0.0$, $c_E = 0.0$, $s_{\\text{max}} = 20.0$。\n- 用例 3 (近简并能级): $\\varepsilon_h = -1.0 \\, \\text{MeV}$, $\\varepsilon_p = -0.8 \\, \\text{MeV}$, $v_0 = 0.05 \\, \\text{MeV}$, $\\rho = 0.14 \\, \\text{fm}^{-3}$, $\\alpha_{hD} = 2.0$, $\\alpha_{hE} = 1.5$, $\\alpha_{pD} = 1.0$, $\\alpha_{pE} = 0.5$, $\\beta_D = 0.8$, $\\beta_E = 0.2$, $c_D = 0.1$, $c_E = -0.1$, $s_{\\text{max}} = 50.0$。\n- 用例 4 (较重的中等质量原子核，更强耦合): $\\varepsilon_h = -15.0 \\, \\text{MeV}$, $\\varepsilon_p = 4.0 \\, \\text{MeV}$, $v_0 = 2.5 \\, \\text{MeV}$, $\\rho = 0.17 \\, \\text{fm}^{-3}$, $\\alpha_{hD} = 2.5$, $\\alpha_{hE} = 1.7$, $\\alpha_{pD} = 1.3$, $\\alpha_{pE} = 0.8$, $\\beta_D = 1.0$, $\\beta_E = 0.4$, $c_D = 0.2$, $c_E = 0.3$, $s_{\\text{max}} = 25.0$。\n\n角度单位不适用。所有能量及输出必须以 $\\text{MeV}$ 表示。你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个元素本身是一个包含两个以 $\\text{MeV}$ 为单位的浮点数的列表，并按测试套件用例的顺序排列（例如，`[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]]`）。", "solution": "该问题被评估为有效。它在科学上基于计算核物理的原理，特别是介质内相似性重整化群 (IMSRG) 和敏感性分析。该问题是适定的，提供了一套完整且一致的定义、初始条件和参数，以求解一个唯一的、有意义的结果。它使用精确的数学语言客观地表述，并代表了数值方法在一个简化但物理上相关的模型上的非平凡应用。\n\n解决方案分四个阶段进行：\n1.  基于 Wegner 生成元推导双能级哈密顿量的流方程。\n2.  构建切向线性系统，以传播哈密顿量分量相对于参数 $c_D$ 和 $c_E$ 的敏感性。\n3.  指定求解常微分方程 (ODE) 耦合系统的数值程序。\n4.  使用一阶微扰理论推导最低本征值的最终敏感性表达式。\n\n**1. IMSRG 流方程的推导**\n\n双能级系统的哈密顿量由一个 $2 \\times 2$ 实对称矩阵给出：\n$$\nH(s) = \\begin{pmatrix}\ne_h(s)  v(s) \\\\\nv(s)  e_p(s)\n\\end{pmatrix}\n$$\nIMSRG 流旨在对角化此哈密顿量。分解为对角部分 $H_d(s)$ 和非对角部分 $H_{od}(s)$ 如下：\n$$\nH_d(s) = \\begin{pmatrix}\ne_h(s)  0 \\\\\n0  e_p(s)\n\\end{pmatrix}, \\quad H_{od}(s) = \\begin{pmatrix}\n0  v(s) \\\\\nv(s)  0\n\\end{pmatrix}\n$$\nWegner 生成元 $\\eta(s)$ 定义为这两部分的对易子：\n$$\n\\eta(s) = [H_d(s), H_{od}(s)] = H_d(s)H_{od}(s) - H_{od}(s)H_d(s)\n$$\n执行矩阵乘法得到：\n$$\n\\eta(s) = \\begin{pmatrix}\ne_h  0 \\\\\n0  e_p\n\\end{pmatrix}\n\\begin{pmatrix}\n0  v \\\\\nv  0\n\\end{pmatrix} -\n\\begin{pmatrix}\n0  v \\\\\nv  0\n\\end{pmatrix}\n\\begin{pmatrix}\ne_h  0 \\\\\n0  e_p\n\\end{pmatrix}\n= \\begin{pmatrix}\n0  e_h v \\\\\ne_p v  0\n\\end{pmatrix} -\n\\begin{pmatrix}\n0  v e_p \\\\\nv e_h  0\n\\end{pmatrix}\n$$\n$$\n\\eta(s) = \\begin{pmatrix}\n0  (e_h-e_p)v \\\\\n-(e_h-e_p)v  0\n\\end{pmatrix} = (e_h(s) - e_p(s))v(s) \\begin{pmatrix}\n0  1 \\\\\n-1  0\n\\end{pmatrix}\n$$\n生成元 $\\eta(s)$ 正确地是反厄米矩阵（对于此实数情况是反对称矩阵）。哈密顿量根据流方程 $dH(s)/ds = [\\eta(s), H(s)]$ 演化：\n$$\n\\frac{dH}{ds} = \\eta H - H \\eta = (e_h-e_p)v \\left[ \\begin{pmatrix}\n0  1 \\\\\n-1  0\n\\end{pmatrix}\n\\begin{pmatrix}\ne_h  v \\\\\nv  e_p\n\\end{pmatrix} -\n\\begin{pmatrix}\ne_h  v \\\\\nv  e_p\n\\end{pmatrix}\n\\begin{pmatrix}\n0  1 \\\\\n-1  0\n\\end{pmatrix} \\right]\n$$\n$$\n\\frac{dH}{ds} = (e_h-e_p)v \\left[ \\begin{pmatrix}\nv  e_p \\\\\n-e_h  -v\n\\end{pmatrix} -\n\\begin{pmatrix}\n-v  e_h \\\\\n-e_p  v\n\\end{pmatrix} \\right] = (e_h-e_p)v \\begin{pmatrix}\n2v  e_p-e_h \\\\\ne_p-e_h  -2v\n\\end{pmatrix}\n$$\n通过将 $dH/ds$ 的分量与右侧矩阵相等，我们获得了关于哈密顿量元素的耦合一阶常微分方程组：\n$$\n\\frac{d e_h}{ds} = 2 v^2 (e_h - e_p)\n$$\n$$\n\\frac{d e_p}{ds} = -2 v^2 (e_h - e_p)\n$$\n$$\n\\frac{d v}{ds} = -v (e_h - e_p)^2\n$$\n由于 $d(e_h+e_p)/ds = 0$，该流正确地保持迹守恒。流的目标是驱动非对角元 $v(s)$ 趋于零，只要 $e_h \\neq e_p$ 就会发生。\n\n**2. 敏感性流方程的推导**\n\n为了找到对于 $p \\in \\{c_D, c_E\\}$ 的敏感性 $\\partial E / \\partial p$，我们采用前向模式敏感性传播。设状态向量为 $y(s) = [e_h(s), e_p(s), v(s)]^T$。流方程可写为 $dy/ds = F(y(s))$。我们希望找到敏感性 $y_p(s) = \\partial y(s) / \\partial p$ 的演化。通过对流方程应用链式法则：\n$$\n\\frac{d y_p}{ds} = \\frac{d}{ds}\\left(\\frac{\\partial y}{\\partial p}\\right) = \\frac{\\partial}{\\partial p}\\left(\\frac{dy}{ds}\\right) = \\frac{\\partial F(y)}{\\partial p} = \\frac{\\partial F}{\\partial y} \\frac{\\partial y}{\\partial p} = J_F(y) y_p\n$$\n其中 $J_F(y)$ 是向量场 $F$ 相对于状态 $y$ 的雅可比矩阵。雅可比矩阵的分量为 $J_{ij} = \\partial F_i / \\partial y_j$。\n向量场为：\n$$\nF(y) = F(e_h, e_p, v) = \\begin{pmatrix}\n2 v^2 (e_h - e_p) \\\\\n-2 v^2 (e_h - e_p) \\\\\n-v (e_h - e_p)^2\n\\end{pmatrix}\n$$\n雅可比矩阵 $J_F$ 为：\n$$\nJ_F = \\begin{pmatrix}\n\\partial F_1/\\partial e_h  \\partial F_1/\\partial e_p  \\partial F_1/\\partial v \\\\\n\\partial F_2/\\partial e_h  \\partial F_2/\\partial e_p  \\partial F_2/\\partial v \\\\\n\\partial F_3/\\partial e_h  \\partial F_3/\\partial e_p  \\partial F_3/\\partial v\n\\end{pmatrix} = \\begin{pmatrix}\n2 v^2  -2 v^2  4 v (e_h - e_p) \\\\\n-2 v^2  2 v^2  -4 v (e_h - e_p) \\\\\n-2v (e_h - e_p)  2v (e_h - e_p)  -(e_h - e_p)^2\n\\end{pmatrix}\n$$\n我们必须为状态及其敏感性求解一个更大的耦合常微分方程组。对于这个问题，我们有两个参数 $c_D$ 和 $c_E$。用于积分的完整状态向量是一个 9 分量向量：\n$$\nY(s) = [e_h, e_p, v, \\partial e_h/\\partial c_D, \\partial e_p/\\partial c_D, \\partial v/\\partial c_D, \\partial e_h/\\partial c_E, \\partial e_p/\\partial c_E, \\partial v/\\partial c_E]^T\n$$\n$Y(s)$ 的常微分方程组是通过用每个参数的敏感性方程扩充原始系统来构建的。\n\n**3. 数值积分程序**\n\n解决方案需要将此 9 分量常微分方程组从 $s=0$ 数值积分到 $s=s_{\\text{max}}$。\n$s=0$ 时的初始条件由问题陈述确定。对于哈密顿量分量：\n$$\ne_h(0) = \\varepsilon_h + \\alpha_{hD} \\, \\rho \\, c_D + \\alpha_{hE} \\, \\rho^2 \\, c_E\n$$\n$$\ne_p(0) = \\varepsilon_p + \\alpha_{pD} \\, \\rho \\, c_D + \\alpha_{pE} \\, \\rho^2 \\, c_E\n$$\n$$\nv(0) = v_0 + \\beta_D \\, \\rho \\, c_D + \\beta_E \\, \\rho \\, c_E\n$$\n敏感性的初始条件通过将这些表达式对 $c_D$ 和 $c_E$ 微分得到：\n对于 $p = c_D$:\n$$\n\\frac{\\partial e_h(0)}{\\partial c_D} = \\alpha_{hD} \\, \\rho, \\quad \\frac{\\partial e_p(0)}{\\partial c_D} = \\alpha_{pD} \\, \\rho, \\quad \\frac{\\partial v(0)}{\\partial c_D} = \\beta_D \\, \\rho\n$$\n对于 $p = c_E$:\n$$\n\\frac{\\partial e_h(0)}{\\partial c_E} = \\alpha_{hE} \\, \\rho^2, \\quad \\frac{\\partial e_p(0)}{\\partial c_E} = \\alpha_{pE} \\, \\rho^2, \\quad \\frac{\\partial v(0)}{\\partial c_E} = \\beta_E \\, \\rho\n$$\n利用这些初始条件，使用数值常微分方程求解器（例如 `scipy.integrate.solve_ivp`）来获得状态向量 $Y(s_{\\text{max}})$，其中包含 $H(s_{\\text{max}})$ 和 $\\partial H(s_{\\text{max}})/\\partial p$ 的值。\n\n**4. 最终敏感性计算**\n\n在 $s = s_{\\text{max}}$ 时，哈密顿量为 $H(s_{\\text{max}})$。其本征值由下式给出：\n$$\n\\lambda_{\\pm} = \\frac{e_h(s_{\\text{max}}) + e_p(s_{\\text{max}}) \\pm \\sqrt{(e_h(s_{\\text{max}}) - e_p(s_{\\text{max}}))^2 + 4v(s_{\\text{max}})^2}}{2}\n$$\n最低本征值为 $E = \\lambda_{\\min} = \\lambda_{-}$。必须计算相应的归一化本征矢 $\\mathbf{v}_{\\min}$。\n本征值 $E$ 相对于参数 $p$ 的敏感性由一阶微扰理论给出，也称为 Hellmann-Feynman 定理：\n$$\n\\frac{\\partial E}{\\partial p} = \\mathbf{v}_{\\min}^\\top \\left( \\frac{\\partial H(s_{\\text{max}})}{\\partial p} \\right) \\mathbf{v}_{\\min}\n$$\n设 $\\mathbf{v}_{\\min} = [v_1, v_2]^T$ 且 $\\partial H/\\partial p = \\begin{pmatrix} \\partial e_h/\\partial p  \\partial v/\\partial p \\\\ \\partial v/\\partial p  \\partial e_p/\\partial p \\end{pmatrix}$，表达式变为：\n$$\n\\frac{\\partial E}{\\partial p} = v_1^2 \\frac{\\partial e_h(s_{\\text{max}})}{\\partial p} + v_2^2 \\frac{\\partial e_p(s_{\\text{max}})}{\\partial p} + 2 v_1 v_2 \\frac{\\partial v(s_{\\text{max}})}{\\partial p}\n$$\n将此公式应用于 $p=c_D$ 和 $p=c_E$，使用从常微分方程积分中获得的敏感性，以得出最终所需的结果。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Test suite: (eps_h, eps_p, v0, rho, alpha_hD, alpha_hE, alpha_pD, \n    #              alpha_pE, beta_D, beta_E, c_D, c_E, s_max)\n    test_cases = [\n        (-12.0, 3.0, 1.5, 0.16, 2.0, 1.5, 1.0, 0.5, 0.8, 0.2, -0.2, -0.5, 20.0),\n        (-10.0, 2.0, 0.0, 0.16, 2.0, 1.5, 1.0, 0.5, 0.8, 0.2, 0.0, 0.0, 20.0),\n        (-1.0, -0.8, 0.05, 0.14, 2.0, 1.5, 1.0, 0.5, 0.8, 0.2, 0.1, -0.1, 50.0),\n        (-15.0, 4.0, 2.5, 0.17, 2.5, 1.7, 1.3, 0.8, 1.0, 0.4, 0.2, 0.3, 25.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_sensitivities(case)\n        results.append(result)\n    \n    # Format the output as a string representing a list of lists.\n    output_str = f\"[{','.join(map(str, results))}]\".replace(\" \", \"\")\n    print(output_str)\n\ndef compute_sensitivities(params):\n    \"\"\"\n    Computes energy sensitivities for a single set of parameters.\n    \"\"\"\n    (eps_h, eps_p, v0, rho, alpha_hD, alpha_hE, alpha_pD, \n     alpha_pE, beta_D, beta_E, c_D, c_E, s_max) = params\n\n    # 1. Define the ODE system for the state and sensitivities\n    def ode_system(s, y):\n        \"\"\"\n        Defines the 9-component ODE system for the IMSRG flow and sensitivities.\n        y = [e_h, e_p, v, de_h/dcD, de_p/dcD, dv/dcD, de_h/dcE, de_p/dcE, dv/dcE]\n        \"\"\"\n        e_h, e_p, v, eh_d, ep_d, v_d, eh_e, ep_e, v_e = y\n        \n        # Flow equations for H(s)\n        e_diff = e_h - e_p\n        v_sq = v * v\n        \n        de_h_ds = 2.0 * v_sq * e_diff\n        de_p_ds = -2.0 * v_sq * e_diff\n        dv_ds = -v * e_diff * e_diff\n        \n        # Jacobian of the flow equations\n        J = np.zeros((3, 3))\n        J[0, 0] = 2.0 * v_sq\n        J[0, 1] = -2.0 * v_sq\n        J[0, 2] = 4.0 * v * e_diff\n        J[1, 0] = -2.0 * v_sq\n        J[1, 1] = 2.0 * v_sq\n        J[1, 2] = -4.0 * v * e_diff\n        J[2, 0] = -2.0 * v * e_diff\n        J[2, 1] = 2.0 * v * e_diff\n        J[2, 2] = -e_diff * e_diff\n        \n        # Sensitivity vectors\n        y_d = np.array([eh_d, ep_d, v_d])\n        y_e = np.array([eh_e, ep_e, v_e])\n        \n        # Flow equations for sensitivities\n        dy_d_ds = J @ y_d\n        dy_e_ds = J @ y_e\n        \n        dydt = np.concatenate(([de_h_ds, de_p_ds, dv_ds], dy_d_ds, dy_e_ds))\n        return dydt\n\n    # 2. Set up initial conditions at s=0\n    rho_sq = rho * rho\n    \n    e_h_0 = eps_h + alpha_hD * rho * c_D + alpha_hE * rho_sq * c_E\n    e_p_0 = eps_p + alpha_pD * rho * c_D + alpha_pE * rho_sq * c_E\n    v_0_val = v0 + beta_D * rho * c_D + beta_E * rho * c_E\n    \n    # Initial sensitivities wrt c_D\n    deh_dcd_0 = alpha_hD * rho\n    dep_dcd_0 = alpha_pD * rho\n    dv_dcd_0 = beta_D * rho\n    \n    # Initial sensitivities wrt c_E\n    deh_dce_0 = alpha_hE * rho_sq\n    dep_dce_0 = alpha_pE * rho_sq\n    dv_dce_0 = beta_E * rho\n\n    y0 = np.array([\n        e_h_0, e_p_0, v_0_val,\n        deh_dcd_0, dep_dcd_0, dv_dcd_0,\n        deh_dce_0, dep_dce_0, dv_dce_0\n    ])\n\n    # 3. Integrate the ODE system\n    sol = solve_ivp(\n        ode_system, \n        [0, s_max], \n        y0, \n        method='RK45', \n        rtol=1e-8, \n        atol=1e-10\n    )\n    y_final = sol.y[:, -1]\n\n    # 4. Compute final energy sensitivities\n    e_h_f, e_p_f, v_f, eh_d_f, ep_d_f, v_d_f, eh_e_f, ep_e_f, v_e_f = y_final\n    \n    # Construct Hamiltonian at s_max\n    H_final = np.array([\n        [e_h_f, v_f],\n        [v_f,   e_p_f]\n    ])\n    \n    # Get lowest eigenvalue and corresponding eigenvector\n    # np.linalg.eigh returns eigenvalues in ascending order\n    evals, evecs = np.linalg.eigh(H_final)\n    # lambda_min = evals[0] # Not needed\n    v_min = evecs[:, 0]  # First column is eigenvector for lowest eigenvalue\n    v1, v2 = v_min\n    \n    # Apply Hellmann-Feynman theorem\n    # Sensitivity wrt c_D\n    dE_dcD = v1**2 * eh_d_f + v2**2 * ep_d_f + 2 * v1 * v2 * v_d_f\n    \n    # Sensitivity wrt c_E\n    dE_dcE = v1**2 * eh_e_f + v2**2 * ep_e_f + 2 * v1 * v2 * v_e_f\n    \n    return [dE_dcD, dE_dcE]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3609341"}]}