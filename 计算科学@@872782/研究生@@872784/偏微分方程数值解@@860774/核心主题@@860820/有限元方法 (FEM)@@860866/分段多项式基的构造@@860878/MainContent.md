## 引言
分片多项式[基函数](@entry_id:170178)的构造是现代数值方法，特别是有限元方法（FEM），用于求解偏微分方程（PDEs）的理论基石。它提供了一个强大而灵活的框架，能够将复杂的连续问题转化为可解的离散代数系统。然而，从定义一个抽象的多项式空间到构建一个在整个计算域上有效且协调的[全局基函数](@entry_id:749917)，其中涉及的数学原理与技术细节是深刻而关键的。准确理解这些构造过程中的微妙之处，例如如何选择恰当的多项式空间、如何保证插值问题的唯一性，以及如何处理任意几何形状，是开发高效、可靠[数值模拟](@entry_id:137087)程序的先决条件。本文旨在系统性地解决这一知识鸿沟。

在接下来的章节中，我们将踏上一段从理论到实践的旅程。“原则与机理”章节将深入探讨分片多项式[基函数](@entry_id:170178)的数学基础，从局部单元上的多项式空间（$P_k, Q_k$）定义，到确保[基函数](@entry_id:170178)唯一性的[单值性](@entry_id:174849)概念，再到通过[等参映射](@entry_id:173239)将局部构造“拼接”为全局协调[函数空间](@entry_id:143478)的机理。随后，“应用与[交叉](@entry_id:147634)学科联系”章节将展示这些理论在实践中的强大威力，不仅涵盖了数值积分、矩阵组装等核心实现问题，还将探索[谱元法](@entry_id:755171)、间断伽辽金（DG）方法、[等几何分析](@entry_id:752839)（IGA）等前沿技术，并揭示其如何为处理奇异性、各向异性等复杂物理现象量身定制，以及如何与[计算机图形学](@entry_id:148077)、[不确定性量化](@entry_id:138597)等领域[交叉](@entry_id:147634)融合。最后，“动手实践”部分将通过一系列精心设计的编程与理论练习，帮助读者将抽象概念转化为具体的计算技能。

## 原则与机理

在[数值求解偏微分方程](@entry_id:634353)的背景下，分片多项式基的构造是有限元方法等现代数值技术的核心。继引言章节之后，本章将深入探讨定义和构建这些[基函数](@entry_id:170178)的数学原则与核心机理。我们将从定义局部单元上的基础多项式空间开始，介绍确保插值问题[适定性](@entry_id:148590)的[单值性](@entry_id:174849)（unisolvency）概念，然后探讨如何将这些局部构造“拼接”成一个全局协调的[函数空间](@entry_id:143478)，并分析单元几何形状与映射对[基函数](@entry_id:170178)性质的深刻影响。

### 基础[多项式空间](@entry_id:144410)

有限元方法的第一步是将求解域 $\Omega$ 剖分成一组互不重叠的简单几何形状，即单元（elements）。最常见的单元类型是单纯形（二维中的三角形，三维中的四面体）和超立方体（二维中的四边形，三维中的六面体）。在每个单元 $K$上，我们定义一个有限维的函数空间，通常是多项式空间。

#### $P_k$ 空间：总次数多项式

对于一个 $d$ 维单纯形单元 $K$，最自然的[多项式空间](@entry_id:144410)选择是 **$P_k(K)$ 空间**，它由在 $K$ 上的所有总次数（total degree）不超过 $k$ 的多项式组成。一个 $d$ 维变量 $\boldsymbol{x} = (x_1, \dots, x_d)$ 的多项式可以表示为单项式 $x_1^{\alpha_1} x_2^{\alpha_2} \cdots x_d^{\alpha_d}$ 的线性组合，其总次数为 $|\boldsymbol{\alpha}| = \sum_{i=1}^d \alpha_i$。因此，$P_k(K)$ 空间由所有总次数 $|\boldsymbol{\alpha}| \le k$ 的单项式张成。

这个空间的维数，即其[基函数](@entry_id:170178)的数量，是一个基本的组合问题。计算维数相当于计算满足不等式 $\alpha_1 + \dots + \alpha_d \le k$ 的非负整数解 $(\alpha_1, \dots, \alpha_d)$ 的数量。通过引入一个“松弛”变量 $\alpha_{d+1} = k - \sum_{i=1}^d \alpha_i \ge 0$，该问题等价于计算方程 $\alpha_1 + \dots + \alpha_d + \alpha_{d+1} = k$ 的非负整数解的数量。使用经典的“[隔板法](@entry_id:152143)”（stars and bars method），这相当于在 $k$ 个“星星”和 $d$ 个“隔板”构成的 $k+d$ 个位置中选择 $d$ 个位置放置隔板。因此，解的数量，即 $P_k(K)$ 的维数，由二项式系数给出 [@problem_id:3431687]：

$$
\dim P_k(K) = \binom{k+d}{d} = \frac{(k+d)!}{k!d!}
$$

例如，对于二维的三角形（$d=2$），维数为 $\binom{k+2}{2} = \frac{(k+2)(k+1)}{2}$。对于三维的四面体（$d=3$），维数为 $\binom{k+3}{3} = \frac{(k+3)(k+2)(k+1)}{6}$。

#### $Q_k$ 空间：[张量积](@entry_id:140694)多项式

对于一个 $d$ 维超立方体单元 $K$（通常通过仿射变换映射到[参考单元](@entry_id:168425) $[-1,1]^d$），标准的选择是 **$Q_k(K)$ 空间**。这个空间由每个坐标变量的次数都不超过 $k$ 的多项式组成。它是一个[张量积](@entry_id:140694)构造的产物，其基单项式形如 $x_1^{\alpha_1} \cdots x_d^{\alpha_d}$，其中每个指数都满足 $0 \le \alpha_i \le k$。

$Q_k(K)$ 空间的维数计算非常直观。由于每个指数 $\alpha_i$ 都有 $k+1$ 个独立的可能取值（从 $0$ 到 $k$），根据[乘法原理](@entry_id:273377)，总的[基函数](@entry_id:170178)数量为 [@problem_id:3431711]：

$$
\dim Q_k(K) = (k+1)^d
$$

#### $P_k$ 与 $Q_k$ 的比较

$P_k$ 和 $Q_k$ 空间在结构和性质上有显著差异 [@problem_id:3431683]。首先，在相同的变量上定义时，$P_k$ 空间是 $Q_k$ 空间的[真子集](@entry_id:152276)，即 $P_k \subset Q_k$。这是因为任何一个总次数不超过 $k$ 的单项式，其每个分量指数必然也不超过 $k$。其次，对于 $k \ge 1$ 和 $d > 1$，维数满足 $\dim P_k(K) < \dim Q_k(K)$。例如，在二维情况下，$k=2$ 时，$\dim P_2 = 6$ 而 $\dim Q_2 = 9$。

这种差异源于它们内在的各向异性（anisotropy）特性。$P_k$ 空间是各向同性的，其定义在[坐标系](@entry_id:156346)旋转下保持不变。而 $Q_k$ 空间是各向异性的，它偏好于参考单元的坐标轴方向。$Q_k$ 包含了诸如 $x_1^k x_2^k$ 这样的高阶[交叉](@entry_id:147634)项（其总次数为 $2k$），这使得它在逼近具有与网格轴对齐的强[方向性](@entry_id:266095)特征的函数时可能更有效。相反，$P_k$ 对于逼近光滑、各向同性的函数则更为经济。

#### 经济型空间：Serendipity 族

为了在保持较高逼近能力的同时减少自由度数量，$Q_k$ 空间的一个重要替代品是 **Serendipity 空间**，记为 $S_k$ [@problem_id:3431693]。这些空间通过系统地移除 $Q_k$ 空间中不影响边界多项式阶数的“纯内部”高阶项来构造，从而在计算成本和逼近精度之间取得了更好的平衡。例如，在二维四边形上，8节点的 $S_2$ 空间是 $Q_2$ 空间（9节点，包含一个中心节点）的一个常用替代方案。$S_2$ 空间由 $P_2$ 空间加上两个三次项 $x^2y$ 和 $xy^2$ 构成（在参考单元上），其自由度通常与单元的8个边界节点（4个顶点和4个边中点）相关联。一般而言，Serendipity 空间族包含了完整的 $P_k$ 空间，并且是 $Q_k$ 空间的[真子集](@entry_id:152276)，即 $P_k \subset S_k \subset Q_k$。这种构造在保持与 $Q_k$ 相同的边界逼近能力的同时，显著减少了内部自由度的数量。

### 构造[局部基](@entry_id:151573)：[单值性](@entry_id:174849)概念

一旦确定了单元上的多项式空间，下一步就是为其构造一个显式的基。这通常通过定义一组线性泛函，即**自由度**（Degrees of Freedom, DoFs），来完成，这些自由度唯一地确定空间中的任何一个多项式。

一个由 $N$ 个自由度 $\{\mathcal{N}_i\}_{i=1}^N$ 组成的集合对于一个 $N$ 维多项式空间 $V$ 被称为是**单值的**（unisolvent），如果对于 $p \in V$，$\mathcal{N}_i(p) = 0$ 对所有 $i$ 成立的唯一可能是 $p=0$。这个性质保证了对于任意给定的数据 $\{d_i\}_{i=1}^N$，插值问题“寻找 $p \in V$ 使得 $\mathcal{N}_i(p) = d_i$”存在唯一解。这个解 $p$ 可以表示为对偶基（dual basis）$\{\phi_j\}_{j=1}^N$ 的[线性组合](@entry_id:154743) $p = \sum_j d_j \phi_j$，其中对偶基满足 $\mathcal{N}_i(\phi_j) = \delta_{ij}$（Kronecker delta）。

最常见的自由度类型是**节点自由度**（nodal DoFs），即在单元上特定点处的函数值评估。

一个构造成功的范例是在参考正方形 $[-1,1]^2$ 上为 $Q_k$ 空间构造[节点基](@entry_id:752522)。这可以通过一维情况的张量积来实现。首先，在 $[-1,1]$ 上选取 $k+1$ 个不同的节点，构造相应的一维 $k$ 次拉格朗日（Lagrange）[基函数](@entry_id:170178) $\{\ell_i(x)\}_{i=0}^k$。然后，二维的[节点基](@entry_id:752522)函数 $\phi_{ij}(x,y)$ 就可以简单地取为一维[基函数](@entry_id:170178)的乘积：$\phi_{ij}(x,y) = \ell_i(x) \ell_j(y)$ [@problem_id:3431692]。例如，对于 $Q_3$ 空间，我们可以在每个方向上取4个[等距节点](@entry_id:168260)，按升序记为 $\{s_1, s_2, s_3, s_4\} = \{-1, -1/3, 1/3, 1\}$。那么，对应于[张量积](@entry_id:140694)节点 $(s_3, s_2) = (1/3, -1/3)$ 的[基函数](@entry_id:170178) $\phi_{3,2}(x,y)$ 可以通过计算 $\ell_3(x)\ell_2(y)$ 得出，其具体形式为 $\phi_{3,2}(x,y) = -\frac{81}{256} (x^2-1)(3x+1)(y^2-1)(3y-1)$。

然而，节点自由度的选择必须非常小心，否则可能破坏[单值性](@entry_id:174849)。一个经典的**反例**是为三角形上的 $P_2$ 空间（维数为6）选择自由度。如果将所有6个节点都放置在一条二次曲线上，那么这个节点配置就不是单值的 [@problem_id:3431691]。例如，考虑由方程 $q(x,y) = y - x + x^2 = 0$ 定义的抛物线。由于 $q(x,y)$ 本身是一个总次数为2的多项式，即 $q \in P_2(T)$，并且它不为零。如果我们选择的6个节点都位于这条抛物线上，那么对于这6个节点 $z_i$，都有 $q(z_i)=0$。这就意味着我们找到了一个非零多项式，它在所有节点处都为零，这直接违反了[单值性](@entry_id:174849)的定义。其后果是，与此节点集相关的插值问题是**病态的**（ill-posed）：对于任意给定的节点值，解可能不存在；即使存在，也不是唯一的。

自由度的选择并不局限于节点值。**非节点自由度**，如矩（moments）——即函数在单元的边或内部的积分——也常被使用。例如，在三角形上构造一个 $P_2$ 空间的基，可以不使用内部节点，而是使用三个顶点值和三个边上的积分（一阶矩）作为自由度 [@problem_id:3431728]。与边 $E_{12}$ 的矩 $\int_{E_{12}} v \, ds$ 对偶的[基函数](@entry_id:170178) $\varphi_{12}$ 必须在所有三个顶点处为零，并且在除 $E_{12}$ 之外的其他两条边上的积分为零，而在 $E_{12}$ 上的积分为1。通过求解这些条件，可以确定该[基函数](@entry_id:170178)的显式表达式。例如，在顶点为 $(0,0), (1,0), (0,1)$ 的单位直角三角形上，与连接顶点 $(0,0)$ 和 $(1,0)$ 的边相关联的矩-对偶[基函数](@entry_id:170178)为 $\varphi_{12}(x,y) = 6x(1-x-y)$。这种构造在某些应用中（如 Raviart-Thomas 单元）至关重要。

### 从局部到全局：协调性与映射

构建了局部单元上的[基函数](@entry_id:170178)后，我们需要将它们“粘合”在一起，形成定义在整个计算域 $\Omega$ 上的全局分片多项式函数。这个过程必须保证最终的全局函数属于我们目标求解的特定索博列夫（Sobolev）空间，这个性质被称为**协调性**（conformity）。

不同的[偏微分方程](@entry_id:141332)的[变分形式](@entry_id:166033)要求解位于不同的[索博列夫空间](@entry_id:141995)。为了保证协调性，必须在相邻单元的公共界面上强制实施特定的连续性条件 [@problem_id:3431696]。这些条件源于[弱导数](@entry_id:189356)的定义：
- **$H^1(\Omega)$ 协调性**：这个空间要求函数本身及其[一阶导数](@entry_id:749425)都是平方可积的。对于分片多项式函数，这转化为要求函数在所有单元界面上是**连续的**。即，标量迹（scalar trace）$u|_F$ 必须是单值的。
- **$H(\text{div},\Omega)$ 协调性**：这个空间用于描述向量场，要求向量场本身及其散度是平方可积的。协调性要求向量场的**法向分量** $\boldsymbol{v} \cdot \boldsymbol{n}_F$ 在所有单元界面上是连续的。其切向分量可以不连续。
- **$H(\text{curl},\Omega)$ 协调性**：这个空间也用于描述向量场，要求向量场本身及其旋度是平方可积的。协调性要求向量场的**切向分量**（二维中为 $\boldsymbol{v} \cdot \boldsymbol{t}_F$，三维中为 $\boldsymbol{n}_F \times \boldsymbol{v}$）在所有单元界面上是连续的。其法向分量可以不连续。

这些连续性要求通过在共享界面（顶点、边、面）上的自由度在相邻单元间共享来实现。例如，对于标准的 $H^1$ 协调拉格朗日单元，共享顶点和边节点的自由度值确保了函数在这些点和边上的连续性 [@problem_id:3431683]。

#### [等参映射](@entry_id:173239)

为了处理任意形状和大小的物理单元 $K$，我们通常在统一的**[参考单元](@entry_id:168425)** $\widehat{K}$（如单位单纯形或单位立方体）上定义[基函数](@entry_id:170178)，然后通过一个**[等参映射](@entry_id:173239)**（isoparametric mapping）$F_K: \widehat{K} \to K$ 将它们转换到物理单元上。物理空间中的[基函数](@entry_id:170178) $\phi_i$ 由参考[基函数](@entry_id:170178) $\hat{\phi}_i$ 通过复合映射定义：$\phi_i(\boldsymbol{x}) = \hat{\phi}_i(F_K^{-1}(\boldsymbol{x}))$。

映射 $F_K$ 的性质对物理[基函数](@entry_id:170178)的性质有决定性影响。
- **[仿射映射](@entry_id:746332)**：对于直边的单纯形，映射 $F_K$ 是仿射的（即线性变换加平移）。[仿射映射](@entry_id:746332)及其逆映射都保持多项式的总次数。因此，[参考单元](@entry_id:168425)上的一个 $P_k$ 空间多项式，在映射到物理单元后，仍然是一个 $P_k$ 空间多项式 [@problem_id:3431683] [@problem_id:3431684]。
- **非[仿射映射](@entry_id:746332)**：对于弯曲的单元或大多数四边形/[六面体单元](@entry_id:174602)（即使是直边的），映射 $F_K$ 是非仿射的（例如，[双线性](@entry_id:146819)或更高次的[多项式映射](@entry_id:153569)）。一个至关重要的后果是，当映射 $F_K$ 的次数 $r > 1$ 时，其逆映射 $F_K^{-1}$ 通常**不是多项式**，而是[有理函数](@entry_id:154279)，甚至可能包含根式。这意味着，即使参考[基函数](@entry_id:170178) $\hat{\phi}_i$ 是多项式，映射到物理单元上的[基函数](@entry_id:170178) $\phi_i$ 一般来说也**不再是多项式** [@problem_id:3431684]。

这个发现对[数值积分](@entry_id:136578)（即**求积**）有深远影响。有限元方法需要计算形如 $\int_K \phi_i \phi_j \, d\boldsymbol{x}$（[质量矩阵](@entry_id:177093)）和 $\int_K \nabla \phi_i \cdot \nabla \phi_j \, d\boldsymbol{x}$（刚度矩阵）的积分。通过[变量替换](@entry_id:141386)将这些[积分变换](@entry_id:186209)回[参考单元](@entry_id:168425) $\widehat{K}$ 上进行计算，我们发现：
- **[质量矩阵](@entry_id:177093)**积分的被积函数在 $\widehat{K}$ 上是 $\hat{\phi}_i(\boldsymbol{\xi}) \hat{\phi}_j(\boldsymbol{\xi}) \det(J_K(\boldsymbol{\xi}))$，其中 $J_K$ 是映射的雅可比矩阵。如果映射是 $r$ 次多项式，$\det(J_K)$ 是多项式，因此整个被积函数也是多项式。这意味着[质量矩阵](@entry_id:177093)可以用足够高阶的[高斯求积](@entry_id:146011)等方法**精确积分**。
- **刚度矩阵**积分的被积函数在 $\widehat{K}$ 上更为复杂，它包含 $J_K^{-1}$ 项。由于 $J_K$ 是多项式矩阵，其逆 $J_K^{-1}$ 是一个**有理函数矩阵**。因此，[刚度矩阵](@entry_id:178659)的被积函数通常不是多项式，无法用标准的多项式精确求积法则来精确计算。

然而，这并不意味着方法会失效。理论分析（[Strang引理](@entry_id:168943)）表明，尽管存在求积误差，但只要我们选择的求积法则精度足够高（即它能精确积分足够高次的多项式），由求积引入的**[相容性误差](@entry_id:747725)**（consistency error）就会比[插值误差](@entry_id:139425)更高阶，从而不影响有限元方法的整体最优[收敛阶](@entry_id:146394) [@problem_id:3431684]。

### 高等主题与实践考量

#### 形状正则性

在[有限元分析](@entry_id:138109)的收敛性理论中，总是会假设网格族是**形状正则的**（shape-regular）。这意味着单元不能被任意地“压扁”或“拉长”。这个假设的必要性可以通过一个简单的例子来阐明 [@problem_id:3431685]。考虑一个矩形单元序列 $K_\delta = (0,1) \times (0,\delta)$，当 $\delta \to 0$ 时，其宽高比趋于无穷。对于一个定义在该单元上的多项式 $p_\delta(x,y) = y^k$，我们可以计算其梯度的 $L^2$ 范数与自身 $L^2$ 范数的比值。计算表明，$\|\nabla p_\delta\|_{L^2(K_\delta)} / \|p_\delta\|_{L^2(K_\delta)}$ 的行为像 $\delta^{-1}$。经典的**逆估计**（inverse estimate）指出，对于形状正则的单元，$\|\nabla v\|_{L^2(K)} \le C h_K^{-1} \|v\|_{L^2(K)}$ 对空间中所有函数 $v$ 成立，其中常数 $C$ 是一致的。但在我们的例子中，当 $\delta \to 0$ 时，$C$ 必须像 $\delta^{-1}$ 一样增长，因此不存在一个不依赖于 $\delta$ 的统一常数 $C$。这表明，在各向异性退化的单元上，标准[基函数](@entry_id:170178)的稳定性和逼近性质会恶化，从而突显了形状正则性假设在保证数值方法稳定性和可靠性方面的重要性。

#### [基函数](@entry_id:170178)缩放与[条件数](@entry_id:145150)

[基函数](@entry_id:170178)的选择不仅影响逼近性质，还直接影响最终代数系统的**条件数**。一个条件数过大的矩阵会导致[迭代求解器](@entry_id:136910)收敛缓慢，并放大[舍入误差](@entry_id:162651)。为了获得一个表现良好的系统，对[基函数](@entry_id:170178)进行适当的**缩放**（scaling）至关重要。

一个理想的目标是使[基函数](@entry_id:170178)在某个相关的范数下是（或接近）正交的。例如，在间断 Galerkin (DG) 方法中，我们希望局部质量矩阵 $M^K_{ij} = \int_K \phi_i \phi_j \, d\boldsymbol{x}$ 是良态的（well-conditioned），最好是[单位矩阵](@entry_id:156724)或其常数倍。通过变量代换，我们知道这个积分等于 $\int_{\widehat{K}} \hat{\phi}_i \hat{\phi}_j |\det(J_K)| \, d\boldsymbol{\xi}$。这表明物理[基函数](@entry_id:170178) $\phi_i$ 的缩放因子应该包含一项 $|\det(J_K)|^{-1/2} \approx h_K^{-d/2}$ 来抵消单元尺寸的影响。此外，为了处理不同次数多项式范数的差异，还需要一个依赖于多项式次数的缩放因子。例如，对于勒让德（Legendre）多项式基，可以通过乘以 $\sqrt{(2\alpha_i+1)/2}$ 这样的因子来实现一维 $L^2$ 正交归一化 [@problem_id:3431717]。通过这种方式精心选择缩放因子，可以使得质量矩阵的[条件数](@entry_id:145150)不依赖于单元尺寸 $h_K$ 和多项式次数 $p$，这对于高阶有限元方法的效率和鲁棒性至关重要。