## 引言
在科学与工程计算领域，尤其是在求解偏微分方程的有限元方法（FEM）中，高效准确地计算定义在复杂几何域上的积分是一项基础而关键的任务。尽管一维高斯求积为区间积分提供了最优解，但将其推广到三角形和四边形等二维单元上则带来了新的理论挑战与丰富的实践问题。这些问题包括如何在非对称域上构建最优求积点，以及如何处理由真实世界几何（如弯曲边界或扭曲网格）引起的复杂性。本文旨在系统性地解决这一知识鸿沟，为读者提供一个关于二维[高斯求积](@entry_id:146011)的全面视角。

本文将分为三个核心部分。在“原理与机制”一章中，我们将从[矩匹配](@entry_id:144382)法这一第一性原理出发，学习如何为标准三角形和四边形构建求积法则。接着，在“应用与[交叉](@entry_id:147634)学科联系”一章中，我们将探索这些[求积法则](@entry_id:753909)在有限元分析、[计算力学](@entry_id:174464)、电磁学等多个领域的实际应用，并揭示求积精度的选择如何深刻影响数值解的稳定性与物理保真度。最后，“动手实践”部分将通过具体的编程和计算练习，帮助读者将理论知识转化为解决实际问题的能力。通过这一结构化的学习路径，您将掌握在现代数值模拟中有效应用高斯求积的核心技能。

## 原理与机制

在[偏微分方程数值解](@entry_id:753287)的背景下，特别是在有限元方法 (FEM) 中，对定义在几何单纯形（如三角形和四边形）上的函数进行精确和高效的积分是至关重要的。虽然一维[高斯积分](@entry_id:187139)（Gauss-Legendre 求积）为定义在区间上的积分提供了一个优雅且最优的解决方案，但将其推广到二维及更高维度的复杂域则带来了新的挑战和一系列丰富的理论。本章旨在系统地阐述在三角形和四边形上构建和应用高斯型[求积法则](@entry_id:753909)的原理与机制。我们将从构建这些法则的基本原则——[矩匹配](@entry_id:144382)法——出发，探索它们在[有限元装配](@entry_id:167564)中的实际应用，并讨论在更复杂场景（如弯曲单元和畸形单元）中出现的关键问题。

### [矩匹配](@entry_id:144382)法：求积法则的基石

[数值求积](@entry_id:136578)的核心思想是用一个有限的加权和来逼近一个积分的值。对于一个定义在域 $\Omega \subset \mathbb{R}^2$ 上的函数 $f(\boldsymbol{x})$，其求积法则形式如下：
$$
\int_{\Omega} f(\boldsymbol{x}) \, d\boldsymbol{x} \approx \sum_{k=1}^{N} w_k f(\boldsymbol{x}_k)
$$
其中，$\{\boldsymbol{x}_k\}_{k=1}^N$ 是求积**节点 (nodes)**，而 $\{w_k\}_{k=1}^N$ 是相应的**权重 (weights)**。一个[求积法则](@entry_id:753909)的优劣取决于其**精度阶 (degree of precision)**，即该法则能够精确积分的最高次多项式的次数。

为了构建一个具有特定精度阶的[求积法则](@entry_id:753909)，我们采用**[矩匹配](@entry_id:144382)法 (method of moments)**。其原理是：若一个[求积法则](@entry_id:753909)能够精确地积分多项式空间的一组基，那么它就能精确地积分该空间中的任何多项式。在二维空间中，最自然的基是单项式基 $\{x^i y^j\}$。因此，为了使[求积法则](@entry_id:753909)对所有总次数不超过 $d$ 的多项式都精确，我们必须确保对于所有满足 $i+j \le d$ 的非负整数 $i,j$，以下等式成立：
$$
\sum_{k=1}^{N} w_k x_k^i y_k^j = \int_{\Omega} x^i y^j \, d\boldsymbol{x}
$$
右侧的积分被称为**矩 (moment)**。每一个这样的等式都构成一个关于未知节点 $\boldsymbol{x}_k$ 和权重 $w_k$ 的（通常是[非线性](@entry_id:637147)的）方程。通过求解这个[方程组](@entry_id:193238)，我们便可以确定求积法则的参数。

对于标准[参考单元](@entry_id:168425)，这些矩具有已知的解析形式。
- 对于**标准参考三角形** $\hat{\mathcal{T}} = \{(x,y) \in \mathbb{R}^2 \mid x \ge 0, y \ge 0, x+y \le 1\}$，单项式的矩由一个简洁的公式给出：
$$
\int_{\hat{\mathcal{T}}} x^i y^j \, dx\,dy = \frac{i!\,j!}{(i+j+2)!}
$$
- 对于**标准参考正方形** $\hat{Q} = [-1,1] \times [-1,1]$，矩的计算可以分解为两个一维积分的乘积：
$$
\int_{-1}^{1} \int_{-1}^{1} x^i y^j \, dx\,dy = \left( \int_{-1}^{1} x^i \, dx \right) \left( \int_{-1}^{1} y^j \, dy \right)
$$
其中，一维积分的结果为：
$$
\int_{-1}^{1} z^m \, dz = \begin{cases} \frac{2}{m+1}  \text{若 } m \text{ 为偶数} \\ 0  \text{若 } m \text{ 为奇数} \end{cases}
$$
这些公式是构建和验证[求积法则](@entry_id:753909)的出发点。

### 三角形求积法则的构建

由于三角形域的非对称性，直接构建[高斯点](@entry_id:170251)和权重比一维情况复杂得多。通常，我们会预设一个具有特定对称性的节点[分布](@entry_id:182848)（即**[拟设](@entry_id:184384) (ansatz)**），以简化[矩方程](@entry_id:149666)系统。

让我们通过构建一个在参考三角形上对总次数不超过2的多项式精确的对称三点[求积法则](@entry_id:753909)，来具体说明这一过程。为了利用单元的对称性，我们通常使用**[重心坐标](@entry_id:155488) (barycentric coordinates)** $(\lambda_1, \lambda_2, \lambda_3)$ 来描述点的位置，其中 $\lambda_1 + \lambda_2 + \lambda_3 = 1$。对于以 $(0,0), (1,0), (0,1)$ 为顶点的参考三角形，[重心坐标](@entry_id:155488)到[笛卡尔坐标](@entry_id:167698)的映射为 $(x,y) = (\lambda_2, \lambda_3)$。

我们采用一个对称的[拟设](@entry_id:184384)：三个求积点的权重相同，均为 $w$，其[重心坐标](@entry_id:155488)分别是三元组 $(a, a, 1-2a)$ 的[循环排列](@entry_id:273014)。这一拟设自动满足了关于三角形三条中线的对称性。这些[重心坐标](@entry_id:155488)对应的笛卡尔坐标节点为：
- $(\lambda_1, \lambda_2, \lambda_3) = (a, a, 1-2a) \implies (x_1, y_1) = (a, 1-2a)$
- $(\lambda_1, \lambda_2, \lambda_3) = (1-2a, a, a) \implies (x_2, y_2) = (a, a)$
- $(\lambda_1, \lambda_2, \lambda_3) = (a, 1-2a, a) \implies (x_3, y_3) = (1-2a, a)$

为了保证求积点严格位于三角形内部，所有[重心坐标](@entry_id:155488)必须为正，即 $a > 0$ 且 $1-2a > 0$，这导出约束 $0  a  1/2$。

现在，我们建立[矩方程](@entry_id:149666)。[精度阶](@entry_id:145189)为2要求该法则能精确积分单项式 $\{1, x, y, x^2, xy, y^2\}$。
1.  **次数 0 ($f=1$)**:
    $I(1) = \text{Area}(\hat{\mathcal{T}}) = 1/2$。求积和为 $Q(1) = w(1+1+1) = 3w$。
    因此，$3w = 1/2 \implies w = 1/6$。

2.  **次数 1 ($f=x, f=y$)**:
    $I(x) = 1/6$。求积和为 $Q(x) = w(a + a + (1-2a)) = w$。
    因此，$w=1/6$，这与前一个结果一致。由于对称性，$f=y$ 的方程给出相同的信息。

3.  **次数 2 ($f=x^2, f=y^2, f=xy$)**:
    $I(x^2) = 1/12$。求积和为 $Q(x^2) = w(a^2 + a^2 + (1-2a)^2) = w(6a^2 - 4a + 1)$。
    代入 $w=1/6$，我们得到 $1/12 = (1/6)(6a^2 - 4a + 1)$，化简后得到二次方程 $12a^2 - 8a + 1 = 0$。
    $I(xy) = 1/24$。求积和为 $Q(xy) = w(a(1-2a) + a^2 + (1-2a)a) = w(2a - 3a^2)$。
    代入 $w=1/6$，我们得到 $1/24 = (1/6)(2a-3a^2)$，这同样化简为 $12a^2 - 8a + 1 = 0$。

求解这个[二次方程](@entry_id:163234)得到两个解 $a=1/2$ 和 $a=1/6$。根据内部节点的约束 $0  a  1/2$，我们必须舍弃 $a=1/2$（它会将节点置于边界上），从而得到唯一解 $a=1/6$。

因此，我们成功地从第一性原理导出了一个著名的2阶精度3点[求积法则](@entry_id:753909)：权重为 $w=1/6$，节点由[重心坐标](@entry_id:155488) $(1/6, 1/6, 2/3)$ 的[循环排列](@entry_id:273014)给出。

更高阶的法则也可以用类似的方法构建。例如，一个对3次多项式精确的4点对称[求积法则](@entry_id:753909)，其[拟设](@entry_id:184384)可以是一个中心点（重心）和三个[对称点](@entry_id:174836)。求解相应的[矩方程](@entry_id:149666)系统会得到一个包含负权重 $w_0 = -9/32$ 和正权重 $w_1 = 25/96$ 的解。负权重的出现是高维高斯求积的一个不寻常但有效的特征，尽管在某些应用中可能会因[数值稳定性](@entry_id:146550)问题而不受欢迎。

### 四边形[求积法则](@entry_id:753909)的构建

对于定义在标准参考正方形 $\hat{Q}=[-1,1]\times[-1,1]$ 上的求积，最流行的方法是**[张量积](@entry_id:140694) (tensor product)** 构造。

该方法从一个一维高斯-勒让德 (Gauss-Legendre) 求积法则出发。一个 $n$ 点的一维[高斯-勒让德法则](@entry_id:636900)在 $[-1,1]$ 上对最高 $2n-1$ 次的多项式是精确的。其节点是 $n$ 阶勒让德多项式 $P_n(x)$ 的根，权重也有解析表达式。通过求解[矩方程](@entry_id:149666)，我们也可以得到这些参数。例如，一个 $n=2$ 的一维法则，其节点为 $\pm 1/\sqrt{3}$，权重均为 $1$。

二维[张量积法则](@entry_id:177156)通过取一维节点集的笛卡尔积来获得其节点，并通过相应一维权重的乘积来获得其权重。若一维 $n$ 点法则的节点和权重为 $\{\xi_i\}_{i=1}^n$ 和 $\{\omega_i\}_{i=1}^n$，则二维 $n \times n$ 点[张量积法则](@entry_id:177156)的节点和权重为：
- **节点**: $(\xi_i, \xi_j)$，其中 $i,j \in \{1, \dots, n\}$
- **权重**: $\omega_i \omega_j$

这个 $n \times n$ 点的[张量积法则](@entry_id:177156)能够精确积分所有形式为 $p(x,y) = \sum_{i=0}^{2n-1}\sum_{j=0}^{2n-1} c_{ij} x^i y^j$ 的多项式。

值得注意的是，[张量积法则](@entry_id:177156)的精度自然地与**[张量积](@entry_id:140694)[多项式空间](@entry_id:144410) $\mathbb{Q}_k$** 相关联，该空间由所有在每个变量中次数最高为 $k$ 的多项式组成。一个 $n \times n$ 点的[张量积法则](@entry_id:177156)对 $\mathbb{Q}_{2n-1}$ 空间是精确的。相对地，三角形求积法则的精度通常是针对**完全[多项式空间](@entry_id:144410) $\mathbb{P}_k$** 来定义的，该空间包含所有总次数不超过 $k$ 的多项式。这两个空间的维度（即所包含的独立单项式数量）是不同的：
- $\dim(\mathbb{P}_k) = \frac{(k+1)(k+2)}{2}$
- $\dim(\mathbb{Q}_k) = (k+1)^2$
在相同次数 $k$ 下，$\mathbb{Q}_k$ 空间包含比 $\mathbb{P}_k$ 更多的单项式，因此通常需要更多的求积点来达到相同的[精度阶](@entry_id:145189)。

除了[张量积法则](@entry_id:177156)，也可以为正方形构建非[张量积](@entry_id:140694)的对称求积法则。例如，一个对总次数不超过3的多项式精确的5点对称法则，可以由一个[中心点](@entry_id:636820) $(0,0)$ 和四个角点 $(\pm 1, \pm 1)$ 构成。通过求解 $M_{00}$ 和 $M_{20}$ 的[矩方程](@entry_id:149666)，我们可以得到一个简单的线性系统，解得[中心点](@entry_id:636820)权重为 $8/3$，四个角点权重均为 $1/3$。

### 在有限元方法中的应用：变量变换与雅可比行列式

在有限元方法中，我们通常需要在一个“物理”单元 $K$ 上计算积分，而不是在参考单元 $\hat{K}$ 上。这是通过一个从[参考单元](@entry_id:168425)到物理单元的**映射 (mapping)** $F: \hat{K} \to K$ 来完成的。利用[多重积分](@entry_id:146170)的**变量变换定理**，物理单元上的积分可以转化为参考单元上的积分：
$$
\int_{K} f(\boldsymbol{x}) \, d\boldsymbol{x} = \int_{\hat{K}} f(F(\hat{\boldsymbol{x}})) \, |\det(J_F(\hat{\boldsymbol{x}}))| \, d\hat{\boldsymbol{x}}
$$
其中 $J_F$ 是映射 $F$ 的**雅可比矩阵 (Jacobian matrix)**，$\det(J_F)$ 是其[行列式](@entry_id:142978)。[求积法则](@entry_id:753909)因此在[参考单元](@entry_id:168425)上应用：
$$
\int_{K} f(\boldsymbol{x}) \, d\boldsymbol{x} \approx \sum_{k=1}^{N} w_k \, f(F(\hat{\boldsymbol{x}}_k)) \, |\det(J_F(\hat{\boldsymbol{x}}_k))|
$$

#### [仿射映射](@entry_id:746332)与常数雅可比行列式

最简单的情况是当物理单元 $K$ 本身就是三角形或平行四边形时，我们可以使用**[仿射映射](@entry_id:746332) (affine mapping)**。[仿射映射](@entry_id:746332)的一个关键特性是它的雅可比矩阵 $J_F$ 是一个常数矩阵。因此，其[行列式](@entry_id:142978) $\det(J_F)$ 也是一个常数，可以被提到求积和的外面。

例如，考虑将一个参考三角形 $\hat{T}$ 映射到顶点为 $\boldsymbol{v}_1, \boldsymbol{v}_2, \boldsymbol{v}_3$ 的物理三角形 $K_T$。一个标准的[仿射映射](@entry_id:746332)为 $F_T(\hat{\xi}, \hat{\eta}) = \boldsymbol{v}_1(1-\hat{\xi}-\hat{\eta}) + \boldsymbol{v}_2\hat{\xi} + \boldsymbol{v}_3\hat{\eta}$。其雅可比行列式的[绝对值](@entry_id:147688)等于两个单元面积之比，即 $|\det(J_T)| = \text{Area}(K_T) / \text{Area}(\hat{T})$。对于一个线性函数，其在[仿射映射](@entry_id:746332)下的变换仍然是线性的，因此一个对线性多项式精确的求积法则（如单点[重心](@entry_id:273519)法则）在经过仿射变换后仍然能够精确地计算积分。

一个至关重要的实现细节是雅可比行列式的符号。$\det(J_F)$ 的符号反映了映射是否保持定向。如果参考单元的顶点是逆时针排序，而物理单元的顶点是顺时针排序，$\det(J_F)$ 将为负值。标准的变量变换公式要求使用**雅可比行列式的[绝对值](@entry_id:147688)** $|\det(J_F)|$。如果一个实现错误地省略了[绝对值](@entry_id:147688)，它将在定向反转的单元上计算出符号错误的积分值。

#### 确定所需积分精度

在[有限元分析](@entry_id:138109)中，一个核心任务是确定需要多高精度的[求积法则](@entry_id:753909)才能精确地（或足够精确地）计算[单元刚度矩阵](@entry_id:139369)和[质量矩阵](@entry_id:177093)。这取决于三个因素：[基函数](@entry_id:170178)的次数、[偏微分方程](@entry_id:141332)中系数的性质，以及[几何映射](@entry_id:749852)的类型。

以一个二阶[椭圆方程](@entry_id:169190) $-\nabla \cdot (\kappa \nabla u) + s u = f$ 为例。其[单元刚度矩阵](@entry_id:139369)和[质量矩阵](@entry_id:177093)的项分别为：
$$
K_{ij}^{(K)} = \int_{K} \nabla N_i \cdot (\kappa \nabla N_j) \, d\boldsymbol{x}, \qquad M_{ij}^{(K)} = \int_{K} N_i N_j s \, d\boldsymbol{x}
$$
其中 $N_i, N_j$ 是形函数。要精确计算这些积分，求积法则的精度阶必须至少等于被积函数的最高多项式次数。

- **对于[三角形单元](@entry_id:167871)**（使用 $\mathbb{P}_m$ 形函数）：
    - 质量矩阵被积函数 $N_i N_j s$ 的总次数为 $\deg(N_i) + \deg(N_j) + \deg(s) = m + m + \deg(s)$。
    - [刚度矩阵](@entry_id:178659)被积函数 $\kappa (\nabla N_i \cdot \nabla N_j)$ 的总次数为 $\deg(\kappa) + \deg(\nabla N_i) + \deg(\nabla N_j) = \deg(\kappa) + (m-1) + (m-1)$。
    - 所需的求积精度 $t_T$ 是这两个次数中的较大者。例如，对于三次形函数（$m=3$）、二次系数 $\kappa$（$r=2$）和四次系数 $s$（$q=4$），刚度被积函数次数为 $2 + (3-1) + (3-1) = 6$，而质量被积函数次数为 $3+3+4 = 10$。因此，需要一个至少对10次多项式精确的求积法则。

- **对于[四边形单元](@entry_id:176937)**（使用 $\mathbb{Q}_m$ 形函数）：
    - 分析是针对每个坐标方向独立进行的。
    - 质量矩阵被积函数在 $\xi$ 方向的次数为 $\deg_{\xi}(N_i) + \deg_{\xi}(N_j) + \deg_{\xi}(s) = m + m + \deg_{\xi}(s)$。
    - [刚度矩阵](@entry_id:178659)的分析更为复杂，因为它涉及到梯度项的乘积。例如，$\kappa (\partial_{\xi}N_i)(\partial_{\xi}N_j)$ 在 $\xi$ 方向的次数为 $\deg_{\xi}(\kappa) + (m-1) + (m-1)$。
    - 最终，我们需要一个一维 $n_Q$ 点的求积法则，其满足 $2n_Q - 1 \ge \max(\deg_{\xi}(\text{integrands}), \deg_{\eta}(\text{integrands}))$。

### 高级主题与实践考量

#### [等参映射](@entry_id:173239)与精度损失

当物理单元是弯曲的（例如，具有抛物线边界），我们使用**[等参映射](@entry_id:173239) (isoparametric mapping)**。在这种情况下，[几何映射](@entry_id:749852) $F$ 与形函数 $N_i$ 使用相同的多项式基。例如，一个八节点二次[四边形单元](@entry_id:176937)使用二次多项式来描述其几何形状。

一个关键的后果是，即使对于最简单的[双线性映射](@entry_id:186502)（用于平面四边形），[雅可比矩阵](@entry_id:264467) $J_F$ 通常也不再是常数，而是参考坐标 $(\hat{\xi}, \hat{\eta})$ 的函数。更重要的是，即使被积函数 $f(x,y)$ 在物理[坐标系](@entry_id:156346)中是一个简单的多项式，经过变量变换后的被积函数 $f(F(\hat{\boldsymbol{x}})) |\det(J_F(\hat{\boldsymbol{x}}))|$ 在参考[坐标系](@entry_id:156346)中通常**不再是多项式**，而是一个有理函数。

例如，考虑一个简单的二次多项式 $f(x,y)=x^2y$ 在一个由非[仿射映射](@entry_id:746332)定义的弯曲单元上的积分。变换后的被积函数可能包含 $\hat{\xi}$ 和 $\hat{\eta}$ 的高次项和分式项。这意味着，任何基于多项式精度的[求积法则](@entry_id:753909)，无论其阶数多高，都无法“精确地”计算这个积分。在这种情况下，使用高斯求积会引入一个**求积误差 (quadrature error)**。在实践中，我们选择一个足够高阶的法则，以确保这个误差远小于有限元方法本身固有的[离散化误差](@entry_id:748522)。

#### 畸形单元的稳健性

在[网格生成](@entry_id:149105)过程中，特别是在[自适应网格细化](@entry_id:143852)或复杂几何建模中，可能会出现形状极差的单元，如非常“瘦长”或几乎“退化”（例如，两个顶点几乎重合）的单元。一个自然的问题是，[求积法则](@entry_id:753909)在这些畸形单元上的表现如何。

- 对于使用**[仿射映射](@entry_id:746332)**的三角形，数值积分的稳健性非常高。由于雅可比行列式是常数，且线性或多项式性质在变换后得以保持，因此即使单元的几何形状非常扭曲，只要它没有完全退化（即面积为正），[求积法则](@entry_id:753909)的数学精确性依然成立。任何误差都主要来源于浮点运算，而不是几何形状本身。

- 对于使用**双线性或更高阶映射**的四边形，情况则更为微妙。尽管对于某些多项式被积函数，变换后的被积函数仍然是[求积法则](@entry_id:753909)能够精确处理的多项式，但畸形的几何形状会导致雅可比行列式 $\det(J_F(\hat{\boldsymbol{x}}))$ 在[参考单元](@entry_id:168425)内部发生剧烈变化。这可能导致被积函数在数值上表现出“坏的行为”，使得求积和的计算对[浮点误差](@entry_id:173912)更为敏感。在极端情况下，如果四边形是非凸的，$\det(J_F)$ 可能在单元内部变号，这将导致灾难性的计算错误。因此，保持单元的良好几何品质是保证有限元解可靠性的一个重要方面。

总之，二维域上的高斯求积是一个理论深刻且实践性强的领域。从基于[矩匹配](@entry_id:144382)的系统构建，到在有限元框架内的实际应用，再到处理高级几何挑战，对其原理和机制的透彻理解对于任何从事计算科学与工程的研究者都至关重要。