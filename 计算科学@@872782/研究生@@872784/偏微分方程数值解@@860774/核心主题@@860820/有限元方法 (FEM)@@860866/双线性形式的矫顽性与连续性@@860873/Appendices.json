{"hands_on_practices": [{"introduction": "建立偏微分方程 (PDE) 的物理系数与相应变分形式的数学性质之间的联系是数值分析的基础。本练习旨在通过一个标准的扩散问题，直接从扩散张量 $A(x)$ 的有界性假设出发，推导出双线性形式的强制性和连续性常数的显式界。通过这个实践 [@problem_id:3371888]，你将掌握如何将抽象的强制性和连续性概念与具体的物理参数 $\\alpha_{0}$ 和 $\\alpha_{1}$ 联系起来。", "problem": "设 $\\Omega \\subset \\mathbb{R}^{d}$ 是一个有界 Lipschitz 域，并令 $V := H_{0}^{1}(\\Omega)$ 表示索博列夫空间 (Sobolev space)，其内的函数具有平方可积的弱梯度且在 $\\partial \\Omega$ 上为零。考虑一个可测的对称矩阵场 $A : \\Omega \\to \\mathbb{R}^{d \\times d}$，满足一致椭圆性和有界性条件：存在常数 $0  \\alpha_{0} \\leq \\alpha_{1}  \\infty$，使得对于几乎所有的 $x \\in \\Omega$：\n$$\n\\alpha_{0} I \\leq A(x) \\leq \\alpha_{1} I,\n$$\n在对称矩阵的意义下成立。定义双线性形式 $a : V \\times V \\to \\mathbb{R}$ 为\n$$\na(u,v) := \\int_{\\Omega} \\nabla u(x)^{\\top} A(x) \\nabla v(x)\\, \\mathrm{d}x,\n$$\n以及相关的能量范数 $\\|v\\|_{a} := \\big(a(v,v)\\big)^{1/2}$。从对称性、正定性的核心定义以及由 $A(x)$ 的假设所编码的点态矩阵不等式出发，确定最大的常数 $c_{\\mathrm{low}}$ 和最小的常数 $c_{\\mathrm{up}}$，仅用 $\\alpha_{0}$ 和 $\\alpha_{1}$ 显式表示，使得对于任意 $v \\in V$ 都成立：\n$$\nc_{\\mathrm{low}}\\, \\|\\nabla v\\|_{L^{2}(\\Omega)} \\leq \\|v\\|_{a} \\leq c_{\\mathrm{up}}\\, \\|\\nabla v\\|_{L^{2}(\\Omega)}.\n$$\n以有序对 $\\big(c_{\\mathrm{low}}, c_{\\mathrm{up}}\\big)$ 的封闭形式给出最终答案。不需要进行数值舍入。答案无需单位。作为背景，此问题涉及在偏微分方程（PDE）数值解的双线性形式的矫顽性（coercivity）和连续性分析中出现的范数等价常数。", "solution": "目标是确定最大的常数 $c_{\\mathrm{low}}$ 和最小的常数 $c_{\\mathrm{up}}$，使得对于所有 $v \\in V := H_{0}^{1}(\\Omega)$，以下范数等价关系成立：\n$$\nc_{\\mathrm{low}}\\, \\|\\nabla v\\|_{L^{2}(\\Omega)} \\leq \\|v\\|_{a} \\leq c_{\\mathrm{up}}\\, \\|\\nabla v\\|_{L^{2}(\\Omega)}.\n$$\n范数 $\\|v\\|_{a}$ 定义为 $\\|v\\|_{a} := \\big(a(v,v)\\big)^{1/2}$，其中双线性形式 $a(u,v)$ 由下式给出：\n$$\na(u,v) := \\int_{\\Omega} \\nabla u(x)^{\\top} A(x) \\nabla v(x)\\, \\mathrm{d}x.\n$$\n问题陈述中给出，对称矩阵场 $A(x)$ 对于几乎所有的 $x \\in \\Omega$ 都满足条件 $0  \\alpha_{0} I \\leq A(x) \\leq \\alpha_{1} I$。在对称矩阵（或二次型）的意义下，该不等式意味着对于任意向量 $\\xi \\in \\mathbb{R}^{d}$，以下关系对几乎所有的 $x \\in \\Omega$ 成立：\n$$\n\\xi^{\\top} (\\alpha_{0} I) \\xi \\leq \\xi^{\\top} A(x) \\xi \\leq \\xi^{\\top} (\\alpha_{1} I) \\xi.\n$$\n利用单位矩阵 $I$ 的性质，这可以简化为\n$$\n\\alpha_{0} \\xi^{\\top}\\xi \\leq \\xi^{\\top} A(x) \\xi \\leq \\alpha_{1} \\xi^{\\top}\\xi.\n$$\n回顾 $\\xi^{\\top}\\xi$ 是 $\\xi$ 的欧几里得范数的平方，记为 $\\|\\xi\\|^2$，则该不等式为\n$$\n\\alpha_{0} \\|\\xi\\|^{2} \\leq \\xi^{\\top} A(x) \\xi \\leq \\alpha_{1} \\|\\xi\\|^{2}.\n$$\n这个点态不等式对任意向量 $\\xi \\in \\mathbb{R}^{d}$ 均成立。对于函数 $v \\in V$，其梯度 $\\nabla v(x)$ 是一个向量场，因此对于几乎所有的 $x \\in \\Omega$，向量 $\\nabla v(x) \\in \\mathbb{R}^{d}$。因此，我们可以将 $\\xi = \\nabla v(x)$ 代入不等式：\n$$\n\\alpha_{0} \\|\\nabla v(x)\\|^{2} \\leq \\nabla v(x)^{\\top} A(x) \\nabla v(x) \\leq \\alpha_{1} \\|\\nabla v(x)\\|^{2}.\n$$\n这个不等式将双线性形式 $a(v,v)$ 的被积函数与梯度的范数平方联系起来。由于这对于几乎所有的 $x \\in \\Omega$ 都成立，并且所有项都是非负的，我们可以在域 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} \\alpha_{0} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x \\leq \\int_{\\Omega} \\nabla v(x)^{\\top} A(x) \\nabla v(x) \\, \\mathrm{d}x \\leq \\int_{\\Omega} \\alpha_{1} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x.\n$$\n常数 $\\alpha_0$ 和 $\\alpha_1$ 与 $x$ 无关，因此可以从积分中提出：\n$$\n\\alpha_{0} \\int_{\\Omega} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x \\leq \\int_{\\Omega} \\nabla v(x)^{\\top} A(x) \\nabla v(x) \\, \\mathrm{d}x \\leq \\alpha_{1} \\int_{\\Omega} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x.\n$$\n现在我们将这些项与它们对应的范数定义等同起来。根据定义，中间项是 $a(v,v) = \\|v\\|_{a}^{2}$。积分 $\\int_{\\Omega} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x$ 正是 $v$ 的梯度的 $L^2$-范数平方，记为 $\\|\\nabla v\\|_{L^{2}(\\Omega)}^{2}$。代入这些定义可得：\n$$\n\\alpha_{0} \\|\\nabla v\\|_{L^{2}(\\Omega)}^{2} \\leq \\|v\\|_{a}^{2} \\leq \\alpha_{1} \\|\\nabla v\\|_{L^{2}(\\Omega)}^{2}.\n$$\n由于范数是非负的，我们可以对不等式的所有部分取平方根，而不会改变不等号的方向：\n$$\n\\sqrt{\\alpha_{0}} \\|\\nabla v\\|_{L^{2}(\\Omega)} \\leq \\|v\\|_{a} \\leq \\sqrt{\\alpha_{1}} \\|\\nabla v\\|_{L^{2}(\\Omega)}.\n$$\n这证明了常数的存在性，并给出了候选值：$c_{\\mathrm{low}} = \\sqrt{\\alpha_{0}}$ 和 $c_{\\mathrm{up}} = \\sqrt{\\alpha_{1}}$。\n\n问题要求 $c_{\\mathrm{low}}$ 的最大可能值和 $c_{\\mathrm{up}}$ 的最小可能值。我们必须验证我们找到的常数是否最优。\n\n为了证明 $c_{\\mathrm{up}} = \\sqrt{\\alpha_{1}}$ 是最小可能上界常数，我们必须证明对于任何更小的常数，不等式对于某个有效的 $A(x)$ 选择会不成立。考虑特定的矩阵场 $A(x) = \\alpha_{1}I$。这是一个有效的选择，因为它满足 $\\alpha_0 I \\leq \\alpha_1 I \\leq \\alpha_1 I$，这是因为 $\\alpha_0 \\leq \\alpha_1$。对于这个特定的 $A(x)$，能量范数变为：\n$$\n\\|v\\|_{a}^{2} = a(v,v) = \\int_{\\Omega} \\nabla v(x)^{\\top} (\\alpha_{1}I) \\nabla v(x) \\, \\mathrm{d}x = \\alpha_{1} \\int_{\\Omega} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x = \\alpha_{1} \\|\\nabla v\\|_{L^{2}(\\Omega)}^{2}.\n$$\n取平方根得到 $\\|v\\|_{a} = \\sqrt{\\alpha_{1}}\\|\\nabla v\\|_{L^{2}(\\Omega)}$。不等式 $\\|v\\|_{a} \\leq c_{\\mathrm{up}}\\|\\nabla v\\|_{L^{2}(\\Omega)}$ 变为 $\\sqrt{\\alpha_{1}}\\|\\nabla v\\|_{L^{2}(\\Omega)} \\leq c_{\\mathrm{up}}\\|\\nabla v\\|_{L^{2}(\\Omega)}$。对于任何 $\\|\\nabla v\\|_{L^{2}(\\Omega)} \\neq 0$ 的 $v \\in V$，这意味着 $c_{\\mathrm{up}} \\geq \\sqrt{\\alpha_{1}}$。因为我们已经证明 $c_{\\mathrm{up}} = \\sqrt{\\alpha_{1}}$ 对所有有效的 $A(x)$ 都成立，所以它必定是最小可能上界。\n\n类似地，为了证明 $c_{\\mathrm{low}} = \\sqrt{\\alpha_{0}}$ 是最大可能下界常数，我们考虑特定的矩阵场 $A(x) = \\alpha_{0}I$。这是一个有效的选择，因为 $\\alpha_0 I \\leq \\alpha_0 I \\leq \\alpha_1 I$。对于这个 $A(x)$，能量范数是：\n$$\n\\|v\\|_{a}^{2} = a(v,v) = \\int_{\\Omega} \\nabla v(x)^{\\top} (\\alpha_{0}I) \\nabla v(x) \\, \\mathrm{d}x = \\alpha_{0} \\int_{\\Omega} \\|\\nabla v(x)\\|^{2} \\, \\mathrm{d}x = \\alpha_{0} \\|\\nabla v\\|_{L^{2}(\\Omega)}^{2}.\n$$\n取平方根得到 $\\|v\\|_{a} = \\sqrt{\\alpha_{0}}\\|\\nabla v\\|_{L^{2}(\\Omega)}$。不等式 $c_{\\mathrm{low}}\\|\\nabla v\\|_{L^{2}(\\Omega)} \\leq \\|v\\|_{a}$ 变为 $c_{\\mathrm{low}}\\|\\nabla v\\|_{L^{2}(\\Omega)} \\leq \\sqrt{\\alpha_{0}}\\|\\nabla v\\|_{L^{2}(\\Omega)}$。对于任何 $\\|\\nabla v\\|_{L^{2}(\\Omega)} \\neq 0$ 的 $v \\in V$，这意味着 $c_{\\mathrm{low}} \\leq \\sqrt{\\alpha_{0}}$。因为我们已经证明 $c_{\\mathrm{low}} = \\sqrt{\\alpha_{0}}$ 对所有有效的 $A(x)$ 都成立，所以它必定是最大可能下界。\n\n总之，最优常数是 $c_{\\mathrm{low}} = \\sqrt{\\alpha_{0}}$ 和 $c_{\\mathrm{up}} = \\sqrt{\\alpha_{1}}$。\n因此，有序对是 $\\big(\\sqrt{\\alpha_{0}}, \\sqrt{\\alpha_{1}}\\big)$。这些常数通常分别被称为双线性形式 $a(\\cdot,\\cdot)$ 在 $H_0^1(\\Omega)$ 上关于范数 $\\|\\nabla \\cdot\\|_{L^2(\\Omega)}$ 的矫顽性常数和连续性常数。", "answer": "$$\\boxed{\\big(\\sqrt{\\alpha_{0}}, \\sqrt{\\alpha_{1}}\\big)}$$", "id": "3371888"}, {"introduction": "在有限元分析中，选择合适的范数来衡量误差至关重要。本练习 [@problem_id:3371865] 引导你使用由双线性形式本身定义的能量范数 $\\|\\cdot\\|_E$ 来应用 Céa 引理。你会发现，在这种“自然”范数下，伽辽金近似是真实解的最佳逼近，这揭示了有限元方法一个深刻而优雅的最优性原理。", "problem": "考虑在一个有界利普希茨域 $\\Omega \\subset \\mathbb{R}^{d}$ 上的反应扩散偏微分方程（PDE）$-\\epsilon \\Delta u + \\beta u = f$，其边界条件为在 $\\partial \\Omega$ 上有齐次狄利克雷边界条件 $u=0$，其中 $\\epsilon0$ 和 $\\beta \\ge 0$ 是常数，且 $f \\in H^{-1}(\\Omega)$。令 $V:=H_{0}^{1}(\\Omega)$，并定义双线性形式 $a:V \\times V \\to \\mathbb{R}$ 和线性泛函 $\\ell:V \\to \\mathbb{R}$ 如下：\n$$\na(u,v) := \\int_{\\Omega} \\left( \\epsilon \\nabla u \\cdot \\nabla v + \\beta u v \\right) \\, dx, \n\\qquad \n\\ell(v) := \\langle f, v \\rangle_{H^{-1},H_{0}^{1}}.\n$$\n设 $u \\in V$ 是满足对于所有 $v \\in V$ 都有 $a(u,v)=\\ell(v)$ 的唯一弱解。对于一个协调的有限维子空间 $V_{h} \\subset V$（例如，在一个形状正则网格上的标准 $H^{1}$-协调有限元空间），伽辽金近似解 $u_{h} \\in V_{h}$ 定义为对于所有 $v_{h} \\in V_{h}$ 都有 $a(u_{h},v_{h})=\\ell(v_{h})$。在 $V$ 上定义能量范数 $\\|\\cdot\\|_{E}$ 如下：\n$$\n\\|v\\|_{E} := \\left( a(v,v) \\right)^{1/2} = \\left( \\int_{\\Omega} \\left( \\epsilon |\\nabla v|^{2} + \\beta |v|^{2} \\right) \\, dx \\right)^{1/2}.\n$$\n仅从希尔伯特空间上双线性形式的强制性和连续性的核心定义以及上述假设出发，并且不假设任何先验误差估计，在能量范数下应用 Céa 引理，并确定最小常数 $K(\\epsilon,\\beta)$，使得以下最佳逼近估计成立：\n$$\n\\|u - u_{h}\\|_{E} \\le K(\\epsilon,\\beta) \\inf_{v_{h} \\in V_{h}} \\|u - v_{h}\\|_{E}.\n$$\n将 $K(\\epsilon,\\beta)$ 表示为仅含 $\\epsilon$ 和 $\\beta$ 的闭式解析表达式。你可以假设 $V_{h}$ 的逼近类是任意的，但在 $H_{0}^{1}(\\Omega)$ 中是协调的。你的最终答案必须是 $K(\\epsilon,\\beta)$ 的一个单一显式表达式。", "solution": "该问题要求确定不等式\n$$\n\\|u - u_{h}\\|_{E} \\le K(\\epsilon,\\beta) \\inf_{v_{h} \\in V_{h}} \\|u - v_{h}\\|_{E}\n$$\n中的常数 $K(\\epsilon, \\beta)$，此不等式源于将 Céa 引理应用于给定问题，且误差在能量范数 $\\|\\cdot\\|_{E}$ 中度量。\n\n让我们首先回顾 Céa 引理的一般性陈述。设 $V$ 是一个赋有范数 $\\|\\cdot\\|_{V}$ 的希尔伯特空间，且 $a(\\cdot, \\cdot): V \\times V \\to \\mathbb{R}$ 是一个双线性形式。如果 $a(\\cdot, \\cdot)$ 是连续的，其连续性常数为 $M  0$，即\n$$\n|a(w, z)| \\le M \\|w\\|_{V} \\|z\\|_{V} \\quad \\forall w, z \\in V,\n$$\n并且是强制的，其强制性常数为 $\\alpha  0$，即\n$$\na(w, w) \\ge \\alpha \\|w\\|_{V}^2 \\quad \\forall w \\in V,\n$$\n那么问题 $a(u,v) = \\ell(v)$ 的唯一解 $u \\in V$ 及其伽辽金近似解 $u_h \\in V_h \\subset V$ 满足先验误差估计：\n$$\n\\|u - u_h\\|_{V} \\le \\frac{M}{\\alpha} \\inf_{v_h \\in V_h} \\|u - v_h\\|_{V}.\n$$\n因此，Céa 引理中的常数是比值 $M/\\alpha$。\n\n在当前问题的背景下，希尔伯特空间是 $V = H_0^1(\\Omega)$，双线性形式是 $a(u,v) = \\int_{\\Omega} (\\epsilon \\nabla u \\cdot \\nabla v + \\beta u v) \\, dx$，并且我们被明确指示使用能量范数，其定义为\n$$\n\\|v\\|_{E} := \\left( a(v,v) \\right)^{1/2}.\n$$\n这意味着我们必须在 Céa 引理的框架下设置 $\\|\\cdot\\|_{V} = \\|\\cdot\\|_{E}$，并确定相应的常数 $M$ 和 $\\alpha$。\n\n首先，我们必须验证 $a(\\cdot, \\cdot)$ 定义了一个内积，并且 $\\|\\cdot\\|_E$ 是 $V = H_0^1(\\Omega)$ 上的一个有效范数。\n双线性形式 $a(\\cdot, \\cdot)$ 显然是对称的。要成为一个内积，它还必须是正定的。对于任意 $v \\in H_0^1(\\Omega)$，\n$$\na(v,v) = \\int_{\\Omega} \\left( \\epsilon |\\nabla v|^{2} + \\beta |v|^{2} \\right) \\, dx = \\epsilon \\|\\nabla v\\|_{L^2(\\Omega)}^2 + \\beta \\|v\\|_{L^2(\\Omega)}^2.\n$$\n由于 $\\epsilon  0$ 和 $\\beta \\ge 0$，两项都是非负的。如果 $a(v,v) = 0$，则 $\\epsilon \\|\\nabla v\\|_{L^2(\\Omega)}^2 = 0$ 和 $\\beta \\|v\\|_{L^2(\\Omega)}^2 = 0$。由于 $\\epsilon  0$，我们必须有 $\\|\\nabla v\\|_{L^2(\\Omega)} = 0$，这意味着 $v$ 几乎处处为常数。由于 $v \\in H_0^1(\\Omega)$，它在边界 $\\partial\\Omega$ 上的迹为零。对于一个常数函数，要在有界域的边界上有零迹，该函数必须恒为零。因此，$v=0$。这证实了对于所有 $v \\neq 0$ 都有 $a(v,v)  0$，所以 $a(\\cdot, \\cdot)$ 是 $H_0^1(\\Omega)$ 上的一个内积，并且 $\\|\\cdot\\|_E = \\sqrt{a(\\cdot,\\cdot)}$ 是由该内积导出的范数。\n\n现在，我们确定 $a(\\cdot, \\cdot)$ 关于能量范数 $\\|\\cdot\\|_E$ 的强制性和连续性常数。\n\n1.  **强制性**：我们寻找最大的常数 $\\alpha  0$ 使得对于所有 $v \\in V$ 都有 $a(v,v) \\ge \\alpha \\|v\\|_{E}^2$。\n    根据能量范数的定义，我们有 $\\|v\\|_{E}^2 = a(v,v)$。\n    因此，强制性不等式为\n    $$\n    a(v,v) \\ge \\alpha \\, a(v,v).\n    $$\n    由于对于任意非零 $v \\in V$ 都有 $a(v,v)  0$，此不等式当且仅当 $\\alpha \\le 1$ 时成立。因此，强制性常数的最大可能值为 $\\alpha = 1$。\n\n2.  **连续性**：我们寻找最小的常数 $M  0$ 使得对于所有 $u, v \\in V$ 都有 $|a(u,v)| \\le M \\|u\\|_{E} \\|v\\|_{E}$。\n    如前所述，$a(\\cdot, \\cdot)$ 是一个内积，$\\|\\cdot\\|_E$ 是由它导出的范数。内积空间的柯西-施瓦茨不等式指出，对于空间中的任意 $u, v$，其内积的绝对值小于或等于它们范数的乘积。将此应用于我们的内积 $a(\\cdot, \\cdot)$ 和范数 $\\|\\cdot\\|_E$：\n    $$\n    |a(u,v)| \\le \\sqrt{a(u,u)} \\sqrt{a(v,v)}.\n    $$\n    代入能量范数的定义，这变为\n    $$\n    |a(u,v)| \\le \\|u\\|_{E} \\|v\\|_{E}.\n    $$\n    将其与连续性的定义 $|a(u,v)| \\le M \\|u\\|_{E} \\|v\\|_{E}$ 进行比较，我们看到当 $M=1$ 时不等式成立。如果 $u$ 和 $v$ 线性相关（例如，$u=v$），则等号成立，因此连续性常数的最小可能值为 $M = 1$。\n\n最后，问题中的常数 $K(\\epsilon, \\beta)$ 对应于 Céa 引理中的常数 $M/\\alpha$。代入我们找到的值：\n$$\nK(\\epsilon, \\beta) = \\frac{M}{\\alpha} = \\frac{1}{1} = 1.\n$$\n该估计为 $\\|u - u_h\\|_E \\le \\inf_{v_h \\in V_h} \\|u - v_h\\|_E$。这个基本结果表明，当误差在能量范数中度量时，伽辽金近似解 $u_h$ 是从子空间 $V_h$ 中对真解 $u$ 的最佳逼近。该常数与参数 $\\epsilon$ 和 $\\beta$ 无关，因为这些参数已被吸收到范数本身的定义中。", "answer": "$$\\boxed{1}$$", "id": "3371865"}, {"introduction": "理论上的强制性并不能保证离散后系统一定具有良好的数值稳定性，尤其是在处理具有不连续系数的问题时。本编码练习 [@problem_id:3371899] 旨在通过一个具体的数值实验，展示系数跳跃与网格的错位如何影响离散强制性常数 $\\alpha_h$。此外，你将实现一种与网格对齐情况感知相关的稳定化方法，以恢复数值格式的鲁棒性，从而弥合连续理论与计算实践之间的鸿沟。", "problem": "考虑在区间 $I=[0,1]$ 上的标量扩散模型问题，该问题具有齐次狄利克雷边界条件，在索博列夫空间 $H^1_0(I)$ 中用双线性形式表示\n$$\na(u,v) = \\int_0^1 \\kappa(x)\\, u'(x)\\, v'(x)\\,\\mathrm{d}x,\n$$\n其中扩散系数 $\\kappa(x)$ 是严格为正且具有跳跃间断点的分片常数函数。设用于定义能量范数的参考对称双线性形式为\n$$\ns(u,v) = \\int_0^1 u'(x)\\, v'(x)\\,\\mathrm{d}x.\n$$\n连续矫顽性常数 $\\alpha$ 和连续性常数 $L$ 是满足以下不等式的最佳常数：\n$$\n\\alpha\\, s(u,u) \\le a(u,u) \\le L\\, s(u,u)\\quad\\text{for all } u\\in H^1_0(I).\n$$\n在协调分片线性有限元方法 (FEM) 中，对于一个具有 $N$ 个单元和 $N-1$ 个内部自由度的均匀网格，通过组装单元贡献来定义离散双线性形式。对每个长度为 $h_e=x_{e+1}-x_e$ 的单元 $e=[x_e,x_{e+1}]$：\n- 参考刚度贡献为\n$$\ns_e(\\phi_i,\\phi_j) = \\int_{x_e}^{x_{e+1}} \\phi_i'(x)\\,\\phi_j'(x)\\,\\mathrm{d}x = \\frac{1}{h_e}\n\\begin{bmatrix}\n1  -1\\\\\n-1  1\n\\end{bmatrix}_{ij},\n$$\n对于限制在单元 $e$ 上的局部节点基 $\\{\\phi_i\\}$。\n- 采用欠积分的离散扩散贡献使用中点法则定义\n$$\na^{\\mathrm{mid}}_e(\\phi_i,\\phi_j) = \\kappa(x_e^{\\mathrm{mid}})\\, s_e(\\phi_i,\\phi_j),\\quad x_e^{\\mathrm{mid}}=\\tfrac{1}{2}(x_e+x_{e+1}),\n$$\n如果 $\\kappa$ 在 $e$ 上是常数，则该计算是精确的，但当 $\\kappa$ 的跳跃发生在 $e$ 内部时，可能会错误地表示 $a$。\n令全局离散形式 $A$ 和 $S$ 是通过将 $\\{a^{\\mathrm{mid}}_e\\}$ 和 $\\{s_e\\}$ 组装到内部自由度上得到的对称正定 (SPD) 矩阵。离散矫顽性常数和连续性常数，分别记为 $\\alpha_h$ 和 $L_h$，被定义为矩阵对 $(A,S)$ 的最小和最大广义特征值：\n$$\n\\alpha_h = \\min_{x\\ne 0}\\frac{x^\\top A x}{x^\\top S x},\\qquad\nL_h = \\max_{x\\ne 0}\\frac{x^\\top A x}{x^\\top S x}.\n$$\n\n任务 1. 实现一个程序，对于给定的均匀网格和系数 $\\kappa(x)$，构造矩阵 $A$ 和 $S$。构造 $A$ 时对每个单元使用中点法则，构造 $S$ 时使用精确组装。通过广义对称特征值问题计算 $(\\alpha_h,L_h)$。\n\n任务 2. 定义一种对齐感知稳定化方法，该方法仅在 $\\kappa$ 不是常数的单元上增强离散双线性形式。在每个单元 $e=[x_e,x_{e+1}]$ 上，令系数振荡指标为\n$$\n\\mathrm{osc}_e = \\left|\\kappa(x_e)-\\kappa(x_{e+1})\\right|.\n$$\n对于给定的稳定化参数 $\\gamma0$，定义稳定化离散形式\n$$\nA^{\\mathrm{stab}} = A + \\sum_e \\gamma\\, \\mathrm{osc}_e\\, S_e,\n$$\n其中 $S_e$ 是组装到全局矩阵中的局部参考刚度贡献。计算稳定化离散矫顽性常数\n$$\n\\alpha_h^{\\mathrm{stab}} = \\min_{x\\ne 0}\\frac{x^\\top A^{\\mathrm{stab}} x}{x^\\top S x}.\n$$\n\n你必须评估系数间断点与网格对齐和未对齐时对 $(\\alpha_h,L_h)$ 的影响，并证明所提出的对齐感知稳定化方法能够恢复鲁棒的矫顽性（即，在不同的对齐情况和高对比度下，$\\alpha_h^{\\mathrm{stab}}$ 保持稳定）。\n\n使用以下系数配置和网格的测试套件。在每个项目中，$N$ 是均匀单元的数量，$\\gamma$ 是稳定化参数。\n\n- 测试用例 1 (对齐的阶跃，中等对比度)：$N=20$，$\\gamma=0.5$，以及\n$$\n\\kappa(x)=\\begin{cases}\n0.2,  x  0.5,\\\\\n2.0,  x\\ge 0.5.\n\\end{cases}\n$$\n由于 $x=0.5$ 是一个节点，跳跃与网格对齐。\n\n- 测试用例 2 (未对齐的阶跃，相同对比度)：$N=20$，$\\gamma=0.5$，以及\n$$\n\\kappa(x)=\\begin{cases}\n0.2,  x  0.55,\\\\\n2.0,  x\\ge 0.55.\n\\end{cases}\n$$\n由于 $x=0.55$ 严格位于一个单元内部，跳跃与网格未对齐。\n\n- 测试用例 3 (粗网格上未对齐的窄低传导率层，高对比度)：$N=10$，$\\gamma=0.5$，以及\n$$\n\\kappa(x)=\\begin{cases}\n10^{-4},  0.49\\le x\\le 0.51,\\\\\n1.0,  \\text{otherwise}.\n\\end{cases}\n$$\n低传导率层的宽度小于单元尺寸，因此一些中点可能完全错过该层。\n\n- 测试用例 4 (细网格上未对齐的窄低传导率层，高对比度)：$N=200$，$\\gamma=0.5$，以及\n$$\n\\kappa(x)=\\begin{cases}\n10^{-4},  0.49\\le x\\le 0.51,\\\\\n1.0,  \\text{otherwise}.\n\\end{cases}\n$$\n细网格增加了中点在该层中采样的机会。\n\n你的程序必须：\n- 按描述组装 $A$、$S$ 和 $A^{\\mathrm{stab}}$。\n- 对每个测试用例，计算并报告三个浮点数 $(\\alpha_h,\\alpha_h^{\\mathrm{stab}},L_h)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表的列表。每个测试用例对应一个列表，格式为 $[\\alpha_h,\\alpha_h^{\\mathrm{stab}},L_h]$，使用 Python 默认的浮点数字符串表示形式，并用一对单独的方括号括起来。例如，包含两个用例的输出看起来像 $[[0.1,0.3,2.0],[\\dots]]$。\n\n不涉及物理单位。不使用角度。输出中不得出现百分比。", "solution": "我们从索博列夫空间 $H^1_0(I)$ 中双线性形式的矫顽性和连续性的经典定义开始。对于严格为正的扩散系数 $\\kappa(x)$，双线性形式 $a(u,v)=\\int_0^1 \\kappa(x)\\,u'(x)\\,v'(x)\\,\\mathrm{d}x$ 相对于由 $s(u,v)=\\int_0^1 u'(x)\\,v'(x)\\,\\mathrm{d}x$ 导出的能量半范数是连续和矫顽的，其最佳常数为\n$$\n\\alpha=\\operatorname*{ess\\,inf}_{x\\in I}\\kappa(x),\\qquad L=\\operatorname*{ess\\,sup}_{x\\in I}\\kappa(x).\n$$\n在协调分片线性有限元方法 (FEM) 中，我们考虑由与内部节点相关的帽函数 $\\{\\phi_i\\}$ 张成的离散空间。单元级参考刚度为\n$$\nS_e=\\frac{1}{h_e}\\begin{bmatrix}1  -1\\\\-1  1\\end{bmatrix},\n$$\n这是通过在均匀网格上精确积分 $\\int_{x_e}^{x_{e+1}}\\phi_i'(x)\\phi_j'(x)\\,\\mathrm{d}x$ 得出的，并且在施加齐次狄利克雷边界条件后，全局参考刚度矩阵 $S$ 是对称正定的 (SPD)。\n\n为了揭示 $\\kappa$ 的间断点与网格之间的对齐关系所产生的影响，我们通过在单元中点处计算 $\\kappa$ 的值来刻意地对扩散双线性形式进行欠积分：\n$$\nA=\\sum_e \\kappa(x_e^{\\mathrm{mid}}) S_e,\n$$\n如果 $\\kappa$ 在每个单元上是常数（对齐情况），这个计算是精确的；但如果间断点位于单元内部（未对齐情况），则会产生偏差。离散矫顽性常数和连续性常数可从广义对称特征值问题获得\n$$\nA x = \\lambda S x,\n$$\n其中 $\\alpha_h=\\min\\lambda$ 且 $L_h=\\max\\lambda$。这源于瑞利商的特性：\n$$\n\\lambda(x)=\\frac{x^\\top A x}{x^\\top S x}=\\frac{\\sum_e \\kappa(x_e^{\\mathrm{mid}})\\int_e |u'_h|^2}{\\sum_e \\int_e |u'_h|^2},\n$$\n其中 $u_h=\\sum_i x_i\\phi_i$。在所有非零 $x$ 上的最小值是离散矫顽性常数 $\\alpha_h$，最大值是离散连续性常数 $L_h$。\n\n如果 $\\kappa$ 的一个跳跃发生在单元内部，中点值可能是低值侧或高值侧，这可能导致相对于精确积分而言，单元贡献被错误地表示。在极端情况下，例如一个非常窄的低传导率层，粗网格的中点可能完全错过该层，从而得到的矩阵 $A$ 仅反映高传导率区域。这使得 $\\alpha_h$ 对对齐情况非常敏感：当中点错过低值区域时，$\\alpha_h$ 可能接近高值；反之则接近低值。尽管 $A$ 保持对称正定（因为 $\\kappa(x_e^{\\mathrm{mid}})0$），但在鲁棒的离散化方法中，$\\alpha_h$ 对对齐的依赖性是不希望看到的，尤其是在高对比度情况下。\n\n为了恢复独立于对齐的鲁棒矫顽性，我们提出一种对齐感知的稳定化方法，该方法仅在 $\\kappa$ 在单元内部有变化的单元上增强离散双线性形式。我们通过振荡指标来量化这种变化\n$$\n\\mathrm{osc}_e=|\\kappa(x_e)-\\kappa(x_{e+1})|.\n$$\n对于分片常数 $\\kappa$，除非有跳跃穿过单元 $e$，否则 $\\mathrm{osc}_e=0$。我们定义稳定化的离散双线性形式为\n$$\nA^{\\mathrm{stab}}=A+\\sum_e \\gamma\\,\\mathrm{osc}_e\\,S_e,\n$$\n其中稳定化参数 $\\gamma0$。这增加了一个集中在未对齐间断点附近的对称半正定校正项，从而增加了这些单元上的局部刚度贡献。稳定化形式的瑞利商为\n$$\n\\frac{x^\\top A^{\\mathrm{stab}} x}{x^\\top S x} = \\frac{x^\\top A x}{x^\\top S x} + \\gamma\\frac{\\sum_e \\mathrm{osc}_e\\, x^\\top S_e x}{x^\\top S x}.\n$$\n由于 $\\sum_e \\mathrm{osc}_e\\, x^\\top S_e x \\ge 0$，对于任何非零 $x$，添加稳定化项都会严格增加瑞利商的值，从而增大了最小广义特征值 $\\alpha_h^{\\mathrm{stab}}$。因为在远离跳跃点的地方 $\\mathrm{osc}_e$ 为零，所以这种校正是对齐感知的：它只加强那些有跳跃穿过其内部的单元，从而消除了对中点采样是取到低值还是高值的敏感性。对于未稳定化的形式，最大广义特征值 $L_h$ 仍然是中点近似下连续性常数的一个度量。对于稳定化的形式，有效的连续性常数会增加，但问题只要求计算 $A$ 的 $L_h$。\n\n算法设计：\n- 构建具有 $N$ 个单元的均匀网格，并通过将 $S_e$ 累加到内部自由度来组装全局矩阵 $S$。对于单元 $e$，局部到全局的映射是节点对 $(e,e+1)$；在施加齐次狄利克雷边界条件后，影响边界节点的贡献被舍弃。\n- 对每个单元使用 $\\kappa(x_e^{\\mathrm{mid}})$ 和 $S_e$ 组装 $A$。\n- 计算稳定化矩阵 $A^{\\mathrm{stab}}=A+\\sum_e \\gamma\\, \\mathrm{osc}_e\\, S_e$，其中 $\\mathrm{osc}_e=|\\kappa(x_e)-\\kappa(x_{e+1})|$。\n- 使用求解对称定矩阵束的程序来解广义对称特征值问题 $A x=\\lambda S x$ 以获得所有特征值；取其最小值和最大值作为 $\\alpha_h$ 和 $L_h$。类似地，解 $A^{\\mathrm{stab}} x=\\lambda S x$ 以获得 $\\alpha_h^{\\mathrm{stab}}$。\n- 评估测试用例：\n  - 对齐的阶跃：中点积分在每个单元上都是精确的；$\\alpha_h$ 匹配 $\\kappa$ 的低值，$L_h$ 匹配高值。\n  - 未对齐的阶跃：中点积分在两侧采样；如果至少有一个单元的中点位于低值区域，$\\alpha_h$ 通常等于低值。\n  - 粗网格上未对齐的窄低层：中点可能完全错过低层，导致 $\\alpha_h$ 接近高值；稳定化仅作用于跨越跳跃的单元，从而在所有对齐情况下统一提高下界。\n  - 细网格上未对齐的窄低层：中点在某些单元中对低层进行采样，使得 $\\alpha_h$ 接近低值；稳定化在保持鲁棒矫顽性的同时，降低了对对齐的敏感性。\n\n该方法整合了以下基本原理：矫顽性常数和连续性常数源于相对于参考能量范数的瑞利商的极值化，而稳定化应在系数间断点处添加局部化的半正定项，以抵消由对齐引起的欠积分伪影。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef assemble_matrices(N, kappa_fn, gamma):\n    \"\"\"\n    Assemble the global matrices A (midpoint-integrated diffusion),\n    S (exact reference stiffness), and A_stab = A + sum_e gamma*osc_e*S_e\n    for a uniform mesh with N elements on [0,1] and homogeneous Dirichlet BCs.\n    \"\"\"\n    # Number of interior DOFs\n    n = N - 1\n    if n = 0:\n        return np.array([[]]), np.array([[]]), np.array([[]])\n        \n    A = np.zeros((n, n))\n    S = np.zeros((n, n))\n    A_stab = np.zeros((n, n))\n\n    # Uniform mesh nodes\n    xs = np.linspace(0.0, 1.0, N + 1)\n\n    for e in range(N):\n        xL = xs[e]\n        xR = xs[e + 1]\n        h = xR - xL\n        x_mid = 0.5 * (xL + xR)\n\n        # Local stiffness matrix for reference form\n        S_loc = (1.0 / h) * np.array([[1.0, -1.0],\n                                      [-1.0,  1.0]])\n\n        # Midpoint coefficient\n        k_mid = kappa_fn(x_mid)\n\n        # Oscillation indicator across the element\n        osc_e = abs(kappa_fn(xL) - kappa_fn(xR))\n\n        # Local diffusion contributions\n        A_loc = k_mid * S_loc\n        A_stab_loc = A_loc + gamma * osc_e * S_loc\n\n        # Map local to global indices (interior DOFs are 0..N-2 for nodes 1..N-1)\n        iL = e\n        iR = e + 1\n        gL = iL - 1 if 1 = iL = N - 1 else None\n        gR = iR - 1 if 1 = iR = N - 1 else None\n\n        # Assemble S\n        if gL is not None:\n            S[gL, gL] += S_loc[0, 0]\n            if gR is not None:\n                S[gL, gR] += S_loc[0, 1]\n        if gR is not None:\n            S[gR, gR] += S_loc[1, 1]\n            if gL is not None:\n                S[gR, gL] += S_loc[1, 0]\n\n        # Assemble A and A_stab\n        if gL is not None:\n            A[gL, gL] += A_loc[0, 0]\n            A_stab[gL, gL] += A_stab_loc[0, 0]\n            if gR is not None:\n                A[gL, gR] += A_loc[0, 1]\n                A_stab[gL, gR] += A_stab_loc[0, 1]\n        if gR is not None:\n            A[gR, gR] += A_loc[1, 1]\n            A_stab[gR, gR] += A_stab_loc[1, 1]\n            if gL is not None:\n                A[gR, gL] += A_loc[1, 0]\n                A_stab[gR, gL] += A_stab_loc[1, 0]\n\n    return A, S, A_stab\n\ndef compute_extremal_generalized_eigenvalues(A, S):\n    \"\"\"\n    Compute smallest and largest generalized eigenvalues of the symmetric definite pencil (A, S).\n    \"\"\"\n    if A.shape[0] == 0:\n        return float('nan'), float('nan')\n        \n    # Use scipy.linalg.eigh for generalized symmetric eigenproblem\n    # eigh returns eigenvalues in ascending order\n    evals = eigh(A, S, eigvals_only=True)\n    # Guard against numerical issues: filter non-positive due to roundoff (should not occur for SPD)\n    evals = np.real(evals)\n    # Smallest and largest\n    alpha = float(evals[0])\n    L = float(evals[-1])\n    return alpha, L\n\ndef test_suite():\n    results = []\n\n    # Test Case 1: aligned step at x=0.5, N=20, gamma=0.5\n    N1 = 20\n    gamma1 = 0.5\n    def kappa1(x):\n        return 0.2 if x  0.5 else 2.0\n    A1, S1, A1s = assemble_matrices(N1, kappa1, gamma1)\n    alpha1, L1 = compute_extremal_generalized_eigenvalues(A1, S1)\n    alpha1s, _ = compute_extremal_generalized_eigenvalues(A1s, S1)\n    results.append([alpha1, alpha1s, L1])\n\n    # Test Case 2: misaligned step at x=0.55, N=20, gamma=0.5\n    N2 = 20\n    gamma2 = 0.5\n    def kappa2(x):\n        return 0.2 if x  0.55 else 2.0\n    A2, S2, A2s = assemble_matrices(N2, kappa2, gamma2)\n    alpha2, L2 = compute_extremal_generalized_eigenvalues(A2, S2)\n    alpha2s, _ = compute_extremal_generalized_eigenvalues(A2s, S2)\n    results.append([alpha2, alpha2s, L2])\n\n    # Test Case 3: misaligned narrow low layer on coarse mesh, N=10, gamma=0.5\n    N3 = 10\n    gamma3 = 0.5\n    def kappa3(x):\n        return 1e-4 if (0.49 = x = 0.51) else 1.0\n    A3, S3, A3s = assemble_matrices(N3, kappa3, gamma3)\n    alpha3, L3 = compute_extremal_generalized_eigenvalues(A3, S3)\n    alpha3s, _ = compute_extremal_generalized_eigenvalues(A3s, S3)\n    results.append([alpha3, alpha3s, L3])\n\n    # Test Case 4: misaligned narrow low layer on fine mesh, N=200, gamma=0.5\n    N4 = 200\n    gamma4 = 0.5\n    def kappa4(x):\n        return 1e-4 if (0.49 = x = 0.51) else 1.0\n    A4, S4, A4s = assemble_matrices(N4, kappa4, gamma4)\n    alpha4, L4 = compute_extremal_generalized_eigenvalues(A4, S4)\n    alpha4s, _ = compute_extremal_generalized_eigenvalues(A4s, S4)\n    results.append([alpha4, alpha4s, L4])\n\n    return results\n\ndef solve():\n    results = test_suite()\n    # Format as required: single line, comma-separated list of lists\n    # Use default float string representation\n    def format_list(lst):\n        return \"[\" + \",\".join(str(x) for x in lst) + \"]\"\n    print(\"[\" + \",\".join(format_list(case) for case in results) + \"]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3371899"}]}