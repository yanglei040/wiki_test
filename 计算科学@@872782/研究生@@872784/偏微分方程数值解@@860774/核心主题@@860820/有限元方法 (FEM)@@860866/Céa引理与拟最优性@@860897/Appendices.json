{"hands_on_practices": [{"introduction": "许多物理系统，如复合材料或多孔介质流，都涉及性质差异巨大的材料。本练习将演示如何为此类问题严格推导连续性和矫顽性常数，并揭示Céa引理中的准最优常数与材料性质的“对比度”直接相关[@problem_id:3368751]。这项实践旨在构建应用连续性和矫顽性定义的基础分析技能。", "problem": "设 $\\Omega \\subset \\mathbb{R}^{d}$ 是一个有界 Lipschitz 域，并设 $V := H^{1}_{0}(\\Omega)$ 是索博列夫空间，其函数具有在 $\\partial \\Omega$ 上为零的平方可积弱梯度，该空间配备范数 $\\|v\\|_{V} := \\|\\nabla v\\|_{L^{2}(\\Omega)^{d}}$。考虑双线性形式\n$$\na(u,v) := \\int_{\\Omega} A(x)\\,\\nabla u(x) \\cdot \\nabla v(x)\\,dx,\n$$\n其中 $A:\\Omega \\to \\mathbb{R}^{d \\times d}$ 是一个对称正定 (SPD) 矩阵场，它在 $\\Omega$ 的一个形状正则剖分上是分片常数。假设存在正常数 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$，使得对于几乎所有的 $x \\in \\Omega$，$A(x)$ 的所有特征值都位于区间 $[\\lambda_{\\min},\\lambda_{\\max}]$ 内。定义对比度 $\\kappa := \\lambda_{\\max}/\\lambda_{\\min}$，该值可能很大（高对比度情况）。设 $u \\in V$ 是变分问题 $a(u,v) = \\ell(v)$（对于所有 $v \\in V$）的唯一解，其中 $\\ell \\in V^{\\ast}$ 是一个有界线性泛函。并设 $V_{h} \\subset V$ 是任意一个协调有限维子空间，其 Galerkin 近似解 $u_{h} \\in V_{h}$ 满足 $a(u_{h},v_{h}) = \\ell(v_{h})$（对于所有 $v_{h} \\in V_{h}$）。\n\n仅使用 $A$ 的 SPD 性质以及双线性形式在 $V$ 上关于范数 $\\|\\cdot\\|_{V}$ 的连续性和矫顽性的定义，推导出显式常数 $M$ 和 $\\alpha$，使得\n$$\n|a(u,v)| \\le M\\,\\|u\\|_{V}\\,\\|v\\|_{V} \\quad \\text{对所有 } u,v \\in V,\n$$\n并且\n$$\na(v,v) \\ge \\alpha\\,\\|v\\|_{V}^{2} \\quad \\text{对所有 } v \\in V.\n$$\n然后，基于 Céa 引理的标准形式，确定准最优常数并分析其对对比度 $\\kappa$ 的依赖性。以 $\\kappa$ 的单个封闭形式解析表达式给出准最优常数的最终答案。不需要数值近似。", "solution": "用户提供的文本是一个有效的问题陈述。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **域和函数空间**：$\\Omega \\subset \\mathbb{R}^{d}$ 是一个有界 Lipschitz 域。函数空间为 $V := H^{1}_{0}(\\Omega)$。\n- **范数**：空间 $V$ 配备范数 $\\|v\\|_{V} := \\|\\nabla v\\|_{L^{2}(\\Omega)^{d}}$。\n- **双线性形式**：$a(u,v) := \\int_{\\Omega} A(x)\\,\\nabla u(x) \\cdot \\nabla v(x)\\,dx$。\n- **系数矩阵**：$A:\\Omega \\to \\mathbb{R}^{d \\times d}$ 是一个对称正定 (SPD) 矩阵场，且为分片常数。\n- **特征值界**：存在正常数 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$，使得对于几乎所有的 $x \\in \\Omega$，$A(x)$ 的所有特征值都位于区间 $[\\lambda_{\\min},\\lambda_{\\max}]$ 内。\n- **对比度**：对比度定义为 $\\kappa := \\lambda_{\\max}/\\lambda_{\\min}$。\n- **变分问题**：精确解 $u \\in V$ 满足 $a(u,v) = \\ell(v)$（对于所有 $v \\in V$），其中 $\\ell \\in V^{\\ast}$ 是一个有界线性泛函。\n- **Galerkin 近似**：$V_{h} \\subset V$ 是一个协调有限维子空间。近似解 $u_{h} \\in V_{h}$ 满足 $a(u_{h},v_{h}) = \\ell(v_{h})$（对于所有 $v_{h} \\in V_{h}$）。\n- **目标**：推导双线性形式 $a(\\cdot,\\cdot)$ 关于范数 $\\|\\cdot\\|_{V}$ 的连续性常数 $M$ 和矫顽性常数 $\\alpha$。然后，从 Céa 引理中确定准最优常数，并用对比度 $\\kappa$ 表示它。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上和数学上都是合理的。它描述了二阶椭圆偏微分方程有限元分析的标准框架。其假设（有界 Lipschitz 域、$H^1_0(\\Omega)$ 空间、SPD 系数矩阵）是确保通过 Lax-Milgram 定理获得适定性的标准假设。该问题是适定的、客观的、完整的、一致的，并提出了一个对偏微分方程数值分析至关重要的非平凡问题。因此，它被认为是**有效的**。\n\n**步骤3：结论和行动**\n问题是有效的。将提供完整的解答。\n\n### 解答\n\n解答分为三部分：首先，推导连续性常数 $M$；其次，推导矫顽性常数 $\\alpha$；第三，将这些常数应用于 Céa 引理，以对比度 $\\kappa$ 表示准最优常数。\n\n**1. 连续性常数 $M$ 的推导**\n\n双线性形式 $a(u,v)$ 的连续性要求找到一个常数 $M > 0$，使得对所有 $u, v \\in V$，都有 $|a(u,v)| \\le M \\|u\\|_{V} \\|v\\|_{V}$。\n\n我们从双线性形式的定义开始：\n$$\na(u,v) = \\int_{\\Omega} A(x)\\,\\nabla u(x) \\cdot \\nabla v(x)\\,dx\n$$\n取绝对值，我们有：\n$$\n|a(u,v)| = \\left| \\int_{\\Omega} \\nabla v(x)^{T} A(x) \\nabla u(x) \\,dx \\right|\n$$\n使用积分的三角不等式（$L^1$ 范数性质的一个特例），我们将绝对值移到积分内部：\n$$\n|a(u,v)| \\le \\int_{\\Omega} |\\nabla v(x)^{T} A(x) \\nabla u(x)| \\,dx\n$$\n对于每个 $x \\in \\Omega$，$\\nabla u(x)$ 和 $\\nabla v(x)$ 是 $\\mathbb{R}^{d}$ 中的向量。我们可以应用欧几里得点积在 $\\mathbb{R}^{d}$ 中的柯西-施瓦茨不等式：对于向量 $\\mathbf{p}, \\mathbf{q} \\in \\mathbb{R}^d$，有 $|\\mathbf{p} \\cdot \\mathbf{q}| \\le \\|\\mathbf{p}\\|_{\\mathbb{R}^d} \\|\\mathbf{q}\\|_{\\mathbb{R}^d}$。令 $\\mathbf{p} = A(x)\\nabla u(x)$ 和 $\\mathbf{q} = \\nabla v(x)$。\n$$\n|\\nabla v(x)^{T} A(x) \\nabla u(x)| \\le \\|A(x)\\nabla u(x)\\|_{\\mathbb{R}^d} \\|\\nabla v(x)\\|_{\\mathbb{R}^d}\n$$\n矩阵-向量乘积的范数 $\\|A(x)\\nabla u(x)\\|_{\\mathbb{R}^d}$ 可以由 $A(x)$ 的算子范数（由向量欧几里得范数诱导）来界定，对于对称矩阵，该范数是其绝对值最大的特征值。由于 $A(x)$ 是正定的，其所有特征值都是正的。$A(x)$ 的最大特征值记为 $\\lambda_{\\max}(A(x))$。\n$$\n\\|A(x)\\nabla u(x)\\|_{\\mathbb{R}^d} \\le \\lambda_{\\max}(A(x)) \\|\\nabla u(x)\\|_{\\mathbb{R}^d}\n$$\n根据假设，对于几乎所有的 $x \\in \\Omega$，$\\lambda_{\\max}(A(x)) \\le \\lambda_{\\max}$。因此，\n$$\n|\\nabla v(x)^{T} A(x) \\nabla u(x)| \\le \\lambda_{\\max} \\|\\nabla u(x)\\|_{\\mathbb{R}^d} \\|\\nabla v(x)\\|_{\\mathbb{R}^d}\n$$\n将此代入积分不等式：\n$$\n|a(u,v)| \\le \\int_{\\Omega} \\lambda_{\\max} \\|\\nabla u(x)\\|_{\\mathbb{R}^d} \\|\\nabla v(x)\\|_{\\mathbb{R}^d} \\,dx\n$$\n我们可以将常数 $\\lambda_{\\max}$ 提取到积分外部。剩下的积分形式为 $\\int_{\\Omega} f(x)g(x)\\,dx$，其中 $f(x) = \\|\\nabla u(x)\\|_{\\mathbb{R}^d}$，$g(x) = \\|\\nabla v(x)\\|_{\\mathbb{R}^d}$。我们应用 $L^{2}(\\Omega)$ 函数的柯西-施瓦茨不等式：\n$$\n\\int_{\\Omega} f(x)g(x)\\,dx \\le \\left(\\int_{\\Omega} f(x)^2\\,dx\\right)^{1/2} \\left(\\int_{\\Omega} g(x)^2\\,dx\\right)^{1/2}\n$$\n应用此不等式得到：\n$$\n|a(u,v)| \\le \\lambda_{\\max} \\left(\\int_{\\Omega} \\|\\nabla u(x)\\|_{\\mathbb{R}^d}^2 \\,dx\\right)^{1/2} \\left(\\int_{\\Omega} \\|\\nabla v(x)\\|_{\\mathbb{R}^d}^2 \\,dx\\right)^{1/2}\n$$\n根据定义，$\\|\\nabla w\\|_{L^2(\\Omega)^d} = \\left(\\int_{\\Omega} \\|\\nabla w(x)\\|_{\\mathbb{R}^d}^2 \\,dx\\right)^{1/2}$。这正是范数 $\\|w\\|_{V}$。因此，我们有：\n$$\n|a(u,v)| \\le \\lambda_{\\max} \\|\\nabla u\\|_{L^{2}(\\Omega)^{d}} \\|\\nabla v\\|_{L^{2}(\\Omega)^{d}} = \\lambda_{\\max} \\|u\\|_{V} \\|v\\|_{V}\n$$\n所以，连续性常数是 $M = \\lambda_{\\max}$。\n\n**2. 矫顽性常数 $\\alpha$ 的推导**\n\n双线性形式 $a(v,v)$ 的矫顽性（或 V-椭圆性）要求找到一个常数 $\\alpha > 0$，使得对所有 $v \\in V$，都有 $a(v,v) \\ge \\alpha \\|v\\|_{V}^{2}$。\n\n我们从 $a(v,v)$ 的定义开始：\n$$\na(v,v) = \\int_{\\Omega} \\nabla v(x)^{T} A(x) \\nabla v(x) \\,dx\n$$\n对于一个对称矩阵 $A(x)$，二次型 $\\mathbf{p}^{T}A(x)\\mathbf{p}$ 由其最小特征值下界。具体来说，$\\mathbf{p}^{T}A(x)\\mathbf{p} \\ge \\lambda_{\\min}(A(x)) \\|\\mathbf{p}\\|_{\\mathbb{R}^d}^2$，其中 $\\lambda_{\\min}(A(x))$ 是 $A(x)$ 的最小特征值。\n令 $\\mathbf{p} = \\nabla v(x)$，我们有：\n$$\n\\nabla v(x)^{T} A(x) \\nabla v(x) \\ge \\lambda_{\\min}(A(x)) \\|\\nabla v(x)\\|_{\\mathbb{R}^d}^2\n$$\n根据假设，对于几乎所有的 $x \\in \\Omega$，$\\lambda_{\\min}(A(x)) \\ge \\lambda_{\\min}$。因此，\n$$\n\\nabla v(x)^{T} A(x) \\nabla v(x) \\ge \\lambda_{\\min} \\|\\nabla v(x)\\|_{\\mathbb{R}^d}^2\n$$\n在域 $\\Omega$ 上对该不等式积分：\n$$\na(v,v) = \\int_{\\Omega} \\nabla v(x)^{T} A(x) \\nabla v(x) \\,dx \\ge \\int_{\\Omega} \\lambda_{\\min} \\|\\nabla v(x)\\|_{\\mathbb{R}^d}^2 \\,dx\n$$\n我们将常数 $\\lambda_{\\min}$ 从积分中提取出来：\n$$\na(v,v) \\ge \\lambda_{\\min} \\int_{\\Omega} \\|\\nabla v(x)\\|_{\\mathbb{R}^d}^2 \\,dx\n$$\n该积分是梯度在 $L^{2}(\\Omega)^{d}$ 中的范数的平方，这正是 $\\|v\\|_{V}^2$ 的定义：\n$$\na(v,v) \\ge \\lambda_{\\min} \\|v\\|_{V}^2\n$$\n所以，矫顽性常数是 $\\alpha = \\lambda_{\\min}$。\n\n**3. Céa 引理和准最优常数**\n\nCéa 引理为 Galerkin 近似解 $u_h$ 在由双线性形式诱导的能量范数中的误差提供了上界。在我们的例子中，这个范数是 $\\|\\cdot\\|_V$。该引理的标准形式是：\n$$\n\\|u - u_h\\|_{V} \\le C \\inf_{v_h \\in V_h} \\|u - v_h\\|_{V}\n$$\n常数 $C$ 是准最优常数。我们使用常数 $M$ 和 $\\alpha$ 来推导它。\n\n从精确解 $u$ 和 Galerkin 解 $u_h$ 的定义，我们得到 Galerkin 正交性：\n$$\na(u - u_h, v_h) = a(u, v_h) - a(u_h, v_h) = \\ell(v_h) - \\ell(v_h) = 0 \\quad \\text{对所有 } v_h \\in V_h.\n$$\n现在，我们对误差 $e = u - u_h$ 使用矫顽性：\n$$\n\\alpha \\|u - u_h\\|_{V}^2 \\le a(u - u_h, u - u_h)\n$$\n对于任意的 $v_h \\in V_h$，我们可以写成 $u - u_h = (u - v_h) + (v_h - u_h)$。利用 $a(\\cdot,\\cdot)$ 的双线性：\n$$\na(u - u_h, u - u_h) = a(u - u_h, (u - v_h) + (v_h - u_h)) = a(u - u_h, u - v_h) + a(u - u_h, v_h - u_h)\n$$\n由于 $v_h - u_h \\in V_h$，Galerkin 正交性意味着第二项为零。因此，\n$$\na(u-u_h, u-u_h) = a(u-u_h, u-v_h)\n$$\n将此与矫顽性不等式结合：\n$$\n\\alpha \\|u - u_h\\|_{V}^2 \\le a(u - u_h, u - v_h)\n$$\n接下来，我们将连续性性质应用于右侧：\n$$\na(u - u_h, u - v_h) \\le M \\|u - u_h\\|_{V} \\|u - v_h\\|_{V}\n$$\n结合最后两个不等式，我们得到：\n$$\n\\alpha \\|u - u_h\\|_{V}^2 \\le M \\|u - u_h\\|_{V} \\|u - v_h\\|_{V}\n$$\n如果 $\\|u - u_h\\|_{V} \\neq 0$，我们可以将两边同时除以 $\\alpha \\|u - u_h\\|_{V}$：\n$$\n\\|u - u_h\\|_{V} \\le \\frac{M}{\\alpha} \\|u - v_h\\|_{V}\n$$\n这个不等式对任何 $v_h \\in V_h$ 都成立。由于左侧与 $v_h$ 的选择无关，我们可以在右侧对所有 $v_h \\in V_h$ 取下确界，以获得最紧的可能界：\n$$\n\\|u - u_h\\|_{V} \\le \\frac{M}{\\alpha} \\inf_{v_h \\in V_h} \\|u - v_h\\|_{V}\n$$\n将此与 Céa 引理的标准形式进行比较，准最优常数是 $C = \\frac{M}{\\alpha}$。\n\n最后，我们用对比度 $\\kappa$ 来表示这个常数。我们发现 $M = \\lambda_{\\max}$ 和 $\\alpha = \\lambda_{\\min}$。问题将对比度定义为 $\\kappa = \\lambda_{\\max}/\\lambda_{\\min}$。\n因此，准最优常数是：\n$$\nC = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\kappa\n$$\n分析表明，准最优常数等于扩散系数的对比度。一个高对比度问题（大的 $\\kappa$）会导致一个大的准最优常数，这表明 Galerkin 解在能量范数下可能不那么接近 $V_h$ 中的最佳近似解。", "answer": "$$\\boxed{\\kappa}$$", "id": "3368751"}, {"introduction": "像Céa引理这样的理论保证依赖于特定的假设。本练习将故意违反其中一个最关键的假设——有限元空间的协调性（conformity），以观察其后果[@problem_id:3368752]。通过计算这个反例，我们将更深刻地理解为何 $V_h \\subset V$ 这一条件不仅是数学上的便利，更是保证近似质量的基石。", "problem": "考虑区间 $(0,1)$ 上的一维模型偏微分方程 (PDE)：求 $u \\in H^{1}_{0}(0,1)$ 使得\n$$\n\\int_{0}^{1} u'(x)\\,v'(x)\\,\\mathrm{d}x \\;=\\; \\int_{0}^{1} v(x)\\,\\mathrm{d}x \\quad \\text{对于所有 } v \\in H^{1}_{0}(0,1),\n$$\n其中 $H^{1}_{0}(0,1)$ 是通常的 Sobolev 空间，其内的函数导数平方可积且在端点处为零，双线性形式为 $a(u,v)=\\int_{0}^{1} u'(x)\\,v'(x)\\,\\mathrm{d}x$，能量范数为 $\\|w\\|_{a}=\\big(a(w,w)\\big)^{1/2}=\\|w'\\|_{L^{2}(0,1)}$。该变分形式源于强形式 $-u''(x)=1$（在 $(0,1)$ 上）以及边界条件 $u(0)=0$ 和 $u(1)=0$。\n\n保证 Galerkin 近似拟最优性的一个已知充分条件是离散试验空间与连续空间的协调性。为探究一种失效模式，我们特意使用非协调的一维试验空间来破坏其协调性\n$$\nW_{h} \\;=\\; \\operatorname{span}\\{\\,\\varphi\\,\\}, \\quad \\varphi(x)=x,\n$$\n该空间不是 $H^{1}_{0}(0,1)$ 的子空间，因为 $\\varphi(1)\\neq 0$。通过非协调 Galerkin 方程定义离散近似解 $u_{h}\\in W_{h}$\n$$\n\\int_{0}^{1} u_{h}'(x)\\,w'(x)\\,\\mathrm{d}x \\;=\\; \\int_{0}^{1} w(x)\\,\\mathrm{d}x \\quad \\text{对于所有 } w \\in W_{h}.\n$$\n在能量范数 $\\|\\cdot\\|_{a}$ 下度量误差。计算比率\n$$\nR \\;=\\; \\frac{\\|u - u_{h}\\|_{a}}{\\displaystyle \\inf_{w \\in W_{h}} \\|u - w\\|_{a}}\n$$\n的精确值。请用精确值表示最终答案；无需四舍五入。", "solution": "目标是计算比率 $R = \\frac{\\|u - u_{h}\\|_{a}}{\\displaystyle \\inf_{w \\in W_{h}} \\|u - w\\|_{a}}$。这需要几个步骤：首先，求出连续问题的精确解 $u$；其次，通过非协调 Galerkin 方法求出离散近似解 $u_h$；第三，计算误差 $\\|u - u_h\\|_a$；第四，计算最佳逼近误差 $\\inf_{w \\in W_{h}} \\|u - w\\|_{a}$。\n\n步骤 1：求精确解 $u(x)$。\n问题以其弱形式给出。对应的强形式是区间 $(0,1)$ 上的 Poisson 方程 $-u''(x) = 1$，以及齐次 Dirichlet 边界条件 $u(0)=0$ 和 $u(1)=0$。\n将微分方程 $-u''(x) = 1$ 对 $x$ 积分一次，得到：\n$$\n-u'(x) = x + C_1\n$$\n其中 $C_1$ 是一个积分常数。\n再次积分得到：\n$$\n-u(x) = \\frac{1}{2}x^2 + C_1 x + C_2\n$$\n所以 $u(x) = -\\frac{1}{2}x^2 - C_1 x - C_2$。\n我们应用边界条件来确定常数 $C_1$ 和 $C_2$。\n条件 $u(0)=0$ 意味着：\n$$\nu(0) = -\\frac{1}{2}(0)^2 - C_1(0) - C_2 = 0 \\implies C_2 = 0\n$$\n条件 $u(1)=0$ 意味着：\n$$\nu(1) = -\\frac{1}{2}(1)^2 - C_1(1) - 0 = 0 \\implies -\\frac{1}{2} - C_1 = 0 \\implies C_1 = -\\frac{1}{2}\n$$\n代入 $C_1$ 和 $C_2$ 的值，得到精确解为：\n$$\nu(x) = -\\frac{1}{2}x^2 - \\left(-\\frac{1}{2}\\right)x - 0 = \\frac{1}{2}x - \\frac{1}{2}x^2 = \\frac{1}{2}x(1-x)\n$$\n精确解的导数为：\n$$\nu'(x) = \\frac{1}{2} - x\n$$\n\n步骤 2：求离散近似解 $u_h(x)$。\n离散试验空间为 $W_h = \\operatorname{span}\\{\\varphi\\}$，其中 $\\varphi(x)=x$。$W_h$ 中的一个元素 $u_h$ 可以写成 $u_h(x) = c \\, \\varphi(x) = cx$ 的形式，其中 $c \\in \\mathbb{R}$ 是一个常系数。其导数为 $u_h'(x) = c$。\n非协调 Galerkin 方程为：\n$$\n\\int_{0}^{1} u_{h}'(x)\\,w'(x)\\,\\mathrm{d}x \\;=\\; \\int_{0}^{1} w(x)\\,\\mathrm{d}x \\quad \\text{对于所有 } w \\in W_h\n$$\n由于 $W_h$ 是一个一维空间，只需用基函数 $w(x) = \\varphi(x) = x$ 进行测试即可。它的导数是 $w'(x) = 1$。\n将 $u_h'(x)=c$ 和 $w(x)=x, w'(x)=1$ 代入 Galerkin 方程，得到：\n$$\n\\int_{0}^{1} c \\cdot 1 \\,\\mathrm{d}x \\;=\\; \\int_{0}^{1} x\\,\\mathrm{d}x\n$$\n计算积分：\n左边 (LHS) 是：\n$$\n\\int_{0}^{1} c \\,\\mathrm{d}x = c [x]_{0}^{1} = c\n$$\n右边 (RHS) 是：\n$$\n\\int_{0}^{1} x\\,\\mathrm{d}x = \\left[\\frac{1}{2}x^2\\right]_{0}^{1} = \\frac{1}{2}\n$$\n令 LHS 和 RHS 相等，得到 $c = \\frac{1}{2}$。\n因此，离散近似解为 $u_h(x) = \\frac{1}{2}x$，其导数为 $u_h'(x) = \\frac{1}{2}$。\n\n步骤 3：计算分子 $\\|u - u_h\\|_a$。\n分子是在能量范数下度量的离散解的误差。根据定义，$\\|v\\|_a^2 = \\int_0^1 (v'(x))^2 \\mathrm{d}x$。\n$$\n\\|u - u_h\\|_a^2 = \\int_{0}^{1} (u'(x) - u_h'(x))^2\\,\\mathrm{d}x\n$$\n导数之差为：\n$$\nu'(x) - u_h'(x) = \\left(\\frac{1}{2} - x\\right) - \\frac{1}{2} = -x\n$$\n将此代入积分：\n$$\n\\|u - u_h\\|_a^2 = \\int_{0}^{1} (-x)^2\\,\\mathrm{d}x = \\int_{0}^{1} x^2\\,\\mathrm{d}x = \\left[\\frac{1}{3}x^3\\right]_{0}^{1} = \\frac{1}{3}\n$$\n因此，误差为：\n$$\n\\|u - u_h\\|_a = \\sqrt{\\frac{1}{3}} = \\frac{1}{\\sqrt{3}}\n$$\n\n步骤 4：计算分母 $\\inf_{w \\in W_{h}} \\|u - w\\|_{a}$。\n分母是最佳逼近误差，即在能量范数下，精确解 $u$ 与离散空间 $W_h$ 中任意函数 $w$ 之间的最小可能误差。\n$W_h$ 中的一个任意函数 $w$ 具有形式 $w(x) = \\alpha x$，其中 $\\alpha \\in \\mathbb{R}$，所以 $w'(x) = \\alpha$。\n我们想要找到使 $\\|u-w\\|_a$ 最小化的 $\\alpha$ 的值。这等价于最小化范数的平方 $\\|u-w\\|_a^2$。\n$$\n\\|u - w\\|_a^2 = \\int_{0}^{1} (u'(x) - w'(x))^2\\,\\mathrm{d}x = \\int_{0}^{1} \\left(\\left(\\frac{1}{2} - x\\right) - \\alpha\\right)^2\\,\\mathrm{d}x\n$$\n令 $E(\\alpha) = \\|u - w\\|_a^2$。为了找到最小值，我们将 $E(\\alpha)$ 对 $\\alpha$ 求导，并令其导数为零。\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}\\alpha} = \\frac{\\mathrm{d}}{\\mathrm{d}\\alpha} \\int_{0}^{1} \\left(\\frac{1}{2} - \\alpha - x\\right)^2\\,\\mathrm{d}x = \\int_{0}^{1} 2\\left(\\frac{1}{2} - \\alpha - x\\right)(-1)\\,\\mathrm{d}x = -2 \\int_{0}^{1} \\left(\\frac{1}{2} - \\alpha - x\\right)\\,\\mathrm{d}x\n$$\n令 $\\frac{\\mathrm{d}E}{\\mathrm{d}\\alpha} = 0$：\n$$\n\\int_{0}^{1} \\left(\\frac{1}{2} - \\alpha - x\\right)\\,\\mathrm{d}x = 0\n$$\n$$\n\\left[\\frac{1}{2}x - \\alpha x - \\frac{1}{2}x^2\\right]_{0}^{1} = 0\n$$\n$$\n\\left(\\frac{1}{2} - \\alpha - \\frac{1}{2}\\right) - 0 = 0 \\implies -\\alpha = 0 \\implies \\alpha = 0\n$$\n当 $\\alpha=0$ 时达到下确界，这对应于最佳逼近为 $w(x)=0$。\n那么下确界的值为 $\\|u - 0\\|_a = \\|u\\|_a$。\n我们计算 $\\|u\\|_a^2$：\n$$\n\\|u\\|_a^2 = \\int_{0}^{1} (u'(x))^2\\,\\mathrm{d}x = \\int_{0}^{1} \\left(\\frac{1}{2} - x\\right)^2\\,\\mathrm{d}x = \\int_{0}^{1} \\left(\\frac{1}{4} - x + x^2\\right)\\,\\mathrm{d}x\n$$\n$$\n\\|u\\|_a^2 = \\left[\\frac{1}{4}x - \\frac{1}{2}x^2 + \\frac{1}{3}x^3\\right]_{0}^{1} = \\frac{1}{4} - \\frac{1}{2} + \\frac{1}{3} = \\frac{3 - 6 + 4}{12} = \\frac{1}{12}\n$$\n所以，最佳逼近误差为：\n$$\n\\inf_{w \\in W_{h}} \\|u - w\\|_{a} = \\sqrt{\\frac{1}{12}} = \\frac{1}{\\sqrt{4 \\cdot 3}} = \\frac{1}{2\\sqrt{3}}\n$$\n\n步骤 5：计算比率 $R$。\n最后，我们计算比率 $R$：\n$$\nR = \\frac{\\|u - u_{h}\\|_{a}}{\\displaystyle \\inf_{w \\in W_{h}} \\|u - w\\|_{a}} = \\frac{1/\\sqrt{3}}{1/(2\\sqrt{3})} = \\frac{1}{\\sqrt{3}} \\cdot \\frac{2\\sqrt{3}}{1} = 2\n$$\n比率的值为 2。这个结果大于 1，表明由于使用了非协调试验空间而导致了拟最优性的丧失。对于一个具有对称双线性形式的协调方法，Céa's 引理将保证该比率恰好为 1。", "answer": "$$\\boxed{2}$$", "id": "3368752"}, {"introduction": "Céa引理给出的误差界限是否过于悲观，或者实际误差真的会像理论界限预测的那么大吗？这个高级实践将指导你构建一个“最坏情况”的算例，其中实际误差接近理论极限[@problem_id:3368757]。这项练习揭示了常数 $M/\\alpha$ 的实际意义，并展示了偏微分方程系数与解的特征之间的相互作用如何导致准最优性的损失。", "problem": "考虑在 Sobolev 空间 $H_0^1(0,1)$ 上提出的以下变分问题：求 $u \\in H_0^1(0,1)$，使得对所有 $v \\in H_0^1(0,1)$，\n$$\na(u,v) = \\ell(v),\n$$\n其中双线性形式 $a(\\cdot,\\cdot)$ 和线性泛函 $\\ell(\\cdot)$ 由下式给出\n$$\na(u,v) := \\int_0^1 \\left( \\varepsilon\\, u'(x)\\, v'(x) + \\kappa\\, u(x)\\, v(x) \\right)\\, dx,\n\\quad\n\\ell(v) := \\int_0^1 f(x)\\, v(x)\\, dx,\n$$\n其中参数 $\\varepsilon > 0$ 和 $\\kappa > 0$ 为正，且 $f$ 的选择是为了产生一个给定的精确解 $u$。设 Hilbert 空间范数为\n$$\n\\|w\\|_V := \\left( \\int_0^1 \\left( w'(x)^2 + w(x)^2 \\right)\\, dx \\right)^{1/2}.\n$$\n假设采用协调伽辽金方法，其有限元法 (FEM) 子空间 $V_h \\subset H_0^1(0,1)$ 由相对于 $[0,1]$ 上网格 $\\mathcal{T}_h$ 的连续分段线性函数组成，并满足齐次 Dirichlet 边界条件。伽辽金解 $u_h \\in V_h$ 满足\n$$\na(u_h, v_h) = \\ell(v_h) \\quad \\text{for all } v_h \\in V_h.\n$$\n回顾 Céa 引理：如果 $a(\\cdot,\\cdot)$ 在 $H_0^1(0,1)$ 上关于 $\\|\\cdot\\|_V$ 是连续和强制的，即，\n$$\n|a(w,v)| \\le M\\, \\|w\\|_V\\, \\|v\\|_V \\quad \\text{and} \\quad a(w,w) \\ge \\alpha\\, \\|w\\|_V^2 \\quad \\text{for all } w,v \\in H_0^1(0,1),\n$$\n那么\n$$\n\\|u - u_h\\|_V \\le \\frac{M}{\\alpha} \\inf_{v_h \\in V_h} \\|u - v_h\\|_V.\n$$\n对于给定的 $a(\\cdot,\\cdot)$ 和 $\\|\\cdot\\|_V$，可以验证连续性常数和强制性常数满足\n$$\nM = \\max\\{\\varepsilon, \\kappa\\}, \\qquad \\alpha = \\min\\{\\varepsilon, \\kappa\\}.\n$$\n您的任务是通过构造配置来数值探究 Céa 引理中常数 $M/\\alpha$ 的尖锐性，在这些配置中\n$$\n\\|u - u_h\\|_V \\approx \\frac{M}{\\alpha} \\inf_{v_h \\in V_h} \\|u - v_h\\|_V.\n$$\n在区间 $[0,1]$ 上的一维空间中进行。使用精确解\n$$\nu(x) = \\sin(\\pi x) + \\sigma \\sin(K \\pi x),\n$$\n其中 $\\sigma = 1$，频率参数 $K \\ge 1$ 为整数。选择 $f$ 使得 $u$ 解出偏微分方程的强形式\n$$\n- \\varepsilon\\, u''(x) + \\kappa\\, u(x) = f(x),\n$$\n并满足齐次 Dirichlet 边界条件 $u(0) = u(1) = 0$。在均匀或分级网格 $\\mathcal{T}_h$ 上使用标准分段线性节点基函数组装有限元系统，并计算：\n- 伽辽金解 $u_h \\in V_h$，\n- $V$-范数下的最佳逼近 $p_h \\in V_h$，定义为以下问题的唯一解\n$$\n(p_h, w_h)_V = (u, w_h)_V \\quad \\text{for all } w_h \\in V_h,\n$$\n其中 $(\\cdot,\\cdot)_V$ 表示与 $\\|\\cdot\\|_V$ 相关联的内积，\n- 误差 $\\|u - u_h\\|_V$ 和 $\\inf_{v_h \\in V_h} \\|u - v_h\\|_V = \\|u - p_h\\|_V$，\n- 饱和因子\n$$\nS := \\frac{\\|u - u_h\\|_V}{\\|u - p_h\\|_V} \\cdot \\frac{\\alpha}{M},\n$$\n当 Céa 界接近尖锐时，理想情况下该因子接近 $1$。\n\n实现一个程序，对于下面的每个测试用例，该程序组装用于 $a(\\cdot,\\cdot)$ 和 $(\\cdot,\\cdot)_V$ 的有限元矩阵，根据精确解 $u$ 构建右端项，求解 $u_h$ 和 $p_h$，使用数值积分评估 $V$-范数误差，并输出饱和因子 $S$。\n\n您必须处理以下参数值测试套件，该套件测试了不同的情形和网格：\n1. 正常路径（中等对比度，均匀网格）：$(\\varepsilon, \\kappa, K, N, \\text{mesh}) = (0.05, 1.0, 12, 64, \\text{uniform})$。\n2. 小扩散高对比度（均匀网格）：$(\\varepsilon, \\kappa, K, N, \\text{mesh}) = (10^{-3}, 1.0, 30, 128, \\text{uniform})$。\n3. 小扩散高对比度（分级网格）：$(\\varepsilon, \\kappa, K, N, \\text{mesh}) = (10^{-3}, 1.0, 30, 128, \\text{graded})$ 其中分级网格的节点为 $x_i = (i/N)^\\gamma$，分级指数 $\\gamma = 2$。\n4. 小反应高对比度（均匀网格）：$(\\varepsilon, \\kappa, K, N, \\text{mesh}) = (1.0, 10^{-3}, 2, 64, \\text{uniform})$。\n5. 小反应高对比度（分级网格）：$(\\varepsilon, \\kappa, K, N, \\text{mesh}) = (1.0, 10^{-3}, 2, 64, \\text{graded})$ 其中 $\\gamma = 2$。\n\n所有量均为无量纲。您的程序应生成单行输出，其中包含五个测试用例的饱和因子，格式为方括号内以逗号分隔的列表（例如，“[s1,s2,s3,s4,s5]”）。每个 $s_i$ 都必须是浮点数。使用充分的数值积分，以确保对所选频率 $K$ 的 $V$-范数进行准确评估。", "solution": "出发点是在区间 $[0,1]$ 上具有齐次 Dirichlet 边界条件的强椭圆二阶偏微分方程的变分形式。空间为 $H_0^1(0,1)$，双线性形式和线性泛函为\n$$\na(u,v) = \\int_0^1 \\left( \\varepsilon\\, u'(x)\\, v'(x) + \\kappa\\, u(x)\\, v(x) \\right)\\, dx, \\quad \\ell(v) = \\int_0^1 f(x)\\, v(x)\\, dx,\n$$\n其中 $\\varepsilon > 0$ 且 $\\kappa > 0$。我们选择 Hilbert 空间范数\n$$\n\\|w\\|_V := \\left( \\int_0^1 \\left( w'(x)^2 + w(x)^2 \\right)\\, dx \\right)^{1/2},\n$$\n及其关联的内积\n$$\n(w,v)_V := \\int_0^1 \\left( w'(x)\\, v'(x) + w(x)\\, v(x) \\right)\\, dx.\n$$\n根据 Cauchy–Schwarz 不等式以及 $\\varepsilon$ 和 $\\kappa$ 的正性，双线性形式 $a(\\cdot,\\cdot)$ 关于 $\\|\\cdot\\|_V$ 是连续和强制的：\n$$\n|a(w,v)| \\le \\max\\{\\varepsilon, \\kappa\\}\\, \\|w\\|_V\\, \\|v\\|_V = M\\, \\|w\\|_V\\, \\|v\\|_V,\n$$\n并且\n$$\na(w,w) = \\varepsilon \\int_0^1 w'(x)^2\\, dx + \\kappa \\int_0^1 w(x)^2\\, dx \\ge \\min\\{\\varepsilon, \\kappa\\} \\left( \\int_0^1 w'(x)^2\\, dx + \\int_0^1 w(x)^2\\, dx \\right) = \\alpha\\, \\|w\\|_V^2.\n$$\n因此，Céa 引理适用并得出\n$$\n\\|u - u_h\\|_V \\le \\frac{M}{\\alpha} \\inf_{v_h \\in V_h} \\|u - v_h\\|_V.\n$$\n评估尖锐性的核心思想是，Céa 引理的证明中使用的不等式在某些极端配置下会变成近似等式。具体来说：\n- 当下界 $a(w,w) \\ge \\alpha \\|w\\|_V^2$ 中，$\\|w\\|_V$ 对应于较弱系数的部分占主导地位时，该不等式几乎成为等式。例如，如果 $\\varepsilon \\ll \\kappa$，那么对于 $L^2$ 贡献与其 $H^1$ 半范数相比可以忽略不计的函数（如高振荡函数），该界几乎是尖锐的。\n- 当上界 $|a(w,w)| \\le M \\|w\\|_V^2$ 中，$\\|w\\|_V$ 对应于较强系数的部分占主导地位时，该不等式几乎成为等式。\n\n伽辽金解 $u_h$ 是 $u$ 在 $V_h$ 上的 $a(\\cdot,\\cdot)$-正交投影，而最佳逼近 $p_h$ 是 $u$ 在 $V_h$ 上的 $(\\cdot,\\cdot)_V$-正交投影。如果 $a(\\cdot,\\cdot)$ 和 $(\\cdot,\\cdot)_V$ 的权重显著不同（例如 $\\varepsilon \\ll \\kappa$ 或 $\\kappa \\ll \\varepsilon$），那么这些投影可能会有很大差异，比率 $\\|u-u_h\\|_V / \\|u - p_h\\|_V$ 可能接近极端因子 $M/\\alpha$。\n\n我们通过以下构造来实现这一点：\n1. 选择精确解\n$$\nu(x) = \\sin(\\pi x) + \\sigma \\sin(K \\pi x),\n$$\n其中 $\\sigma = 1$，频率 $K \\in \\mathbb{N}$。这结合了一个低频模式和一个高频模式，使得当 $K$ 较大时，导数项占主导地位。\n2. 通过强形式 $- \\varepsilon u'' + \\kappa u = f$ 计算 $f$。由于 $u''(x) = -\\pi^2 \\sin(\\pi x) - \\sigma K^2 \\pi^2 \\sin(K \\pi x)$，可得\n$$\nf(x) = (\\varepsilon \\pi^2 + \\kappa)\\, \\sin(\\pi x) + \\sigma (\\varepsilon K^2 \\pi^2 + \\kappa)\\, \\sin(K \\pi x).\n$$\n3. 用均匀或分级网格 $\\mathcal{T}_h$ 对 $[0,1]$ 进行离散化，分级网格的节点为 $x_i = (i/N)^\\gamma$，分级指数 $\\gamma = 2$。设 $V_h$ 为在 $0$ 和 $1$ 处为零的分段线性函数空间。\n4. 组装全局有限元矩阵：\n- 刚度矩阵 $K_h$，其元素为\n$$\n(K_h)_{ij} = \\int_0^1 \\varphi_i'(x)\\, \\varphi_j'(x)\\, dx,\n$$\n- 质量矩阵 $M_h$，其元素为\n$$\n(M_h)_{ij} = \\int_0^1 \\varphi_i(x)\\, \\varphi_j(x)\\, dx,\n$$\n其中 $\\{\\varphi_i\\}$ 是与内部节点相关的节点基函数。\n这些矩阵是逐单元计算的，使用每个区间 $[x_a, x_b]$ 上分段线性单元的标准局部公式：\n$$\nK_e = \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad\nM_e = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix},\n$$\n其中 $h = x_b - x_a$。\n5. 通过数值积分为伽辽金问题构建载荷向量 $F_h$：\n$$\n(F_h)_i = \\int_0^1 f(x)\\, \\varphi_i(x)\\, dx.\n$$\n6. 求解伽辽金线性系统\n$$\nA_h\\, \\mathbf{u}_h = \\mathbf{F}_h, \\quad \\text{where } A_h = \\varepsilon K_h + \\kappa M_h,\n$$\n以获得 $u_h$ 在基 $\\{\\varphi_i\\}$ 中的系数向量 $\\mathbf{u}_h$。\n7. 通过求解以下方程计算 $(\\cdot,\\cdot)_V$-正交投影 $p_h$\n$$\nS_h\\, \\mathbf{p}_h = \\mathbf{b}_h, \\quad \\text{where } S_h = K_h + M_h, \\quad (\\mathbf{b}_h)_i = \\int_0^1 \\left( u'(x)\\, \\varphi_i'(x) + u(x)\\, \\varphi_i(x) \\right)\\, dx.\n$$\n8. 在每个单元上使用数值积分评估 $V$-范数误差 $\\|u - u_h\\|_V$ 和 $\\|u - p_h\\|_V$：\n$$\n\\|u - w_h\\|_V^2 = \\int_0^1 \\left( (u'(x) - w_h'(x))^2 + (u(x) - w_h(x))^2 \\right)\\, dx,\n$$\n其中 $w_h$ 是 $u_h$ 或 $p_h$，对于线性单元，$w_h'$ 在每个单元上是分段常数。采用高阶 Gauss–Legendre 积分，其点数与 $K$ 成正比，以解决振荡问题。\n9. 计算饱和因子\n$$\nS = \\frac{\\|u - u_h\\|_V}{\\|u - p_h\\|_V} \\cdot \\frac{\\alpha}{M}, \\quad \\alpha = \\min\\{\\varepsilon,\\kappa\\}, \\quad M = \\max\\{\\varepsilon,\\kappa\\}.\n$$\n根据 Céa 引理，有 $S \\le 1$。接近 $1$ 的 $S$ 值表明，在所选的双线性形式和网格下，常数 $M/\\alpha$ 接近尖锐。\n\n算法说明：\n- $K_h$ 和 $M_h$ 的组装使用线性有限元的规范局部单元矩阵，并满足齐次 Dirichlet 边界条件，跳过边界节点。\n- 对于载荷和误差积分，每个单元使用足够多点数的 Gauss–Legendre 积分可确保精确地积分涉及三角函数和线性基函数的乘积。对于给定的测试套件，选择如 $n_q = \\max\\{16, 2K\\}$ 个点数可以在效率和准确性之间取得平衡。\n- 由于测试套件中的问题规模较小，线性系统是对称正定的，并使用标准的稠密求解器进行求解。\n\n该程序实现了这些步骤，并以方括号内逗号分隔的单个列表形式输出指定五个测试用例的饱和因子，为不同的双线性形式（由 $\\varepsilon$ 和 $\\kappa$ 控制）和网格（均匀与分级）如何能几乎饱和准最优性界中的 Céa 常数提供了数值证据。", "answer": "```python\nimport numpy as np\n\n# We will not use SciPy to keep dependencies minimal, numpy suffices for small systems.\n\ndef gauss_legendre(n, a, b):\n    # Returns nodes and weights for Gauss-Legendre quadrature on [a, b]\n    x, w = np.polynomial.legendre.leggauss(n)\n    # map from [-1,1] to [a,b]\n    xm = 0.5 * (b - a) * x + 0.5 * (a + b)\n    wm = 0.5 * (b - a) * w\n    return xm, wm\n\ndef make_mesh(N, mesh_type='uniform', gamma=2.0):\n    if mesh_type == 'uniform':\n        nodes = np.linspace(0.0, 1.0, N + 1)\n    elif mesh_type == 'graded':\n        i = np.arange(N + 1)\n        nodes = (i / N) ** gamma\n    else:\n        raise ValueError(\"Unknown mesh_type\")\n    return nodes\n\ndef assemble_matrices(nodes):\n    # Assemble global stiffness K_h and mass M_h for linear FEM on [0,1]\n    N = len(nodes) - 1\n    n_internal = N - 1\n    K = np.zeros((n_internal, n_internal))\n    M = np.zeros((n_internal, n_internal))\n    for e in range(N):\n        xa = nodes[e]\n        xb = nodes[e + 1]\n        h = xb - xa\n        # local matrices\n        Ke = (1.0 / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n        Me = (h / 6.0) * np.array([[2.0, 1.0], [1.0, 2.0]])\n        # global indices for internal nodes: 0..N\n        # internal nodes are 1..N-1\n        g0 = e      # left node index in global numbering\n        g1 = e + 1  # right node index\n        # map to internal index (0..n_internal-1), skip boundaries\n        idx = []\n        if 1 = g0 = N - 1:\n            idx.append(g0 - 1)\n        else:\n            idx.append(None)\n        if 1 = g1 = N - 1:\n            idx.append(g1 - 1)\n        else:\n            idx.append(None)\n        # assemble\n        for i_local in range(2):\n            gi = idx[i_local]\n            if gi is None:\n                continue\n            for j_local in range(2):\n                gj = idx[j_local]\n                if gj is None:\n                    continue\n                K[gi, gj] += Ke[i_local, j_local]\n                M[gi, gj] += Me[i_local, j_local]\n    return K, M\n\ndef u_exact(x, Kfreq, sigma=1.0):\n    return np.sin(np.pi * x) + sigma * np.sin(Kfreq * np.pi * x)\n\ndef du_exact(x, Kfreq, sigma=1.0):\n    return np.pi * np.cos(np.pi * x) + sigma * Kfreq * np.pi * np.cos(Kfreq * np.pi * x)\n\ndef f_rhs(x, eps, kap, Kfreq, sigma=1.0):\n    # f = -eps u'' + kap u\n    # u'' = -pi^2 sin(pi x) - sigma * K^2 * pi^2 * sin(K pi x)\n    term1 = (eps * (np.pi ** 2) + kap) * np.sin(np.pi * x)\n    term2 = sigma * (eps * (Kfreq ** 2) * (np.pi ** 2) + kap) * np.sin(Kfreq * np.pi * x)\n    return term1 + term2\n\ndef assemble_load(nodes, eps, kap, Kfreq, sigma=1.0):\n    # Assemble load vector F_h with (F)_i = \\int f(x) * phi_i(x)\n    N = len(nodes) - 1\n    n_internal = N - 1\n    F = np.zeros(n_internal)\n    # Quadrature points per element, scale with frequency to capture oscillations\n    nq = max(16, 2 * Kfreq)\n    for e in range(N):\n        xa = nodes[e]\n        xb = nodes[e + 1]\n        h = xb - xa\n        xq, wq = gauss_legendre(nq, xa, xb)\n        # local basis functions N1 and N2 on element\n        # N1(xa)=1,N1(xb)=0 ; N2(xa)=0,N2(xb)=1\n        N1 = (xb - xq) / h\n        N2 = (xq - xa) / h\n        fq = f_rhs(xq, eps, kap, Kfreq, sigma)\n        # contributions to local load vector\n        Fe_local = np.array([np.dot(wq, fq * N1), np.dot(wq, fq * N2)])\n        # global indices\n        g0 = e\n        g1 = e + 1\n        idx0 = g0 - 1 if 1 = g0 = N - 1 else None\n        idx1 = g1 - 1 if 1 = g1 = N - 1 else None\n        if idx0 is not None:\n            F[idx0] += Fe_local[0]\n        if idx1 is not None:\n            F[idx1] += Fe_local[1]\n    return F\n\ndef assemble_V_rhs(nodes, Kfreq, sigma=1.0):\n    # Assemble b_V with (b)_i = \\int [ u'(x) * phi_i'(x) + u(x) * phi_i(x) ] dx\n    N = len(nodes) - 1\n    n_internal = N - 1\n    b = np.zeros(n_internal)\n    nq = max(16, 2 * Kfreq)\n    for e in range(N):\n        xa = nodes[e]\n        xb = nodes[e + 1]\n        h = xb - xa\n        # phi' are constants on element:\n        # local derivatives: dN1/dx = -1/h, dN2/dx = 1/h\n        dN_local = np.array([-1.0 / h, 1.0 / h])\n        xq, wq = gauss_legendre(nq, xa, xb)\n        uq = u_exact(xq, Kfreq, sigma)\n        # local N1, N2 values\n        N1 = (xb - xq) / h\n        N2 = (xq - xa) / h\n        # local contributions: integrate u' * phi_i' + u * phi_i\n        # u' term: \\int u'(x) dx * phi_i' is exact integral of u' times constant, but we do quadrature for uniformity\n        duq = du_exact(xq, Kfreq, sigma)\n        # local vector\n        b_local = np.zeros(2)\n        b_local[0] = np.dot(wq, duq * dN_local[0] + uq * N1)\n        b_local[1] = np.dot(wq, duq * dN_local[1] + uq * N2)\n        # global indices\n        g0 = e\n        g1 = e + 1\n        idx0 = g0 - 1 if 1 = g0 = N - 1 else None\n        idx1 = g1 - 1 if 1 = g1 = N - 1 else None\n        if idx0 is not None:\n            b[idx0] += b_local[0]\n        if idx1 is not None:\n            b[idx1] += b_local[1]\n    return b\n\ndef eval_fem_function_on_element(x, xa, xb, c_left, c_right):\n    # Evaluate piecewise linear FEM function at points x in [xa,xb]\n    h = xb - xa\n    N1 = (xb - x) / h\n    N2 = (x - xa) / h\n    return c_left * N1 + c_right * N2\n\ndef eval_fem_derivative_on_element(xa, xb, c_left, c_right):\n    # Derivative is constant on element\n    h = xb - xa\n    return (-c_left + c_right) / h\n\ndef compute_V_error(nodes, coeff, Kfreq, sigma=1.0):\n    # Compute ||u - w_h||_V with w_h represented by coeff on internal nodes\n    N = len(nodes) - 1\n    n_internal = N - 1\n    err_sq = 0.0\n    # quadrature points per element\n    nq = max(16, 2 * Kfreq)\n    for e in range(N):\n        xa = nodes[e]\n        xb = nodes[e + 1]\n        # coefficients at element nodes, apply Dirichlet at boundaries\n        g0 = e\n        g1 = e + 1\n        if g0 == 0:\n            c0 = 0.0\n        else:\n            c0 = coeff[g0 - 1]\n        if g1 == N:\n            c1 = 0.0\n        else:\n            c1 = coeff[g1 - 1]\n        xq, wq = gauss_legendre(nq, xa, xb)\n        uh = eval_fem_function_on_element(xq, xa, xb, c0, c1)\n        duh = eval_fem_derivative_on_element(xa, xb, c0, c1)\n        ue = u_exact(xq, Kfreq, sigma)\n        due = du_exact(xq, Kfreq, sigma)\n        diff = ue - uh\n        ddiff = due - duh\n        err_sq += np.dot(wq, ddiff * ddiff + diff * diff)\n    return np.sqrt(err_sq)\n\ndef run_case(eps, kap, Kfreq, N, mesh_type):\n    nodes = make_mesh(N, mesh_type=mesh_type, gamma=2.0)\n    Kmat, Mmat = assemble_matrices(nodes)\n    F = assemble_load(nodes, eps, kap, Kfreq, sigma=1.0)\n    A = eps * Kmat + kap * Mmat\n    # Solve Galerkin system\n    uh_coeff = np.linalg.solve(A, F)\n    # Solve V-projection system\n    S = Kmat + Mmat\n    bV = assemble_V_rhs(nodes, Kfreq, sigma=1.0)\n    ph_coeff = np.linalg.solve(S, bV)\n    # Compute errors\n    e_gal = compute_V_error(nodes, uh_coeff, Kfreq, sigma=1.0)\n    e_best = compute_V_error(nodes, ph_coeff, Kfreq, sigma=1.0)\n    # Compute M/alpha and saturation factor S = (e_gal/e_best) * (alpha/M)\n    M = max(eps, kap)\n    alpha = min(eps, kap)\n    sat = (e_gal / e_best) * (alpha / M)\n    return sat\n\ndef solve():\n    test_cases = [\n        (0.05, 1.0, 12, 64, 'uniform'),    # Case 1\n        (1e-3, 1.0, 30, 128, 'uniform'),   # Case 2\n        (1e-3, 1.0, 30, 128, 'graded'),    # Case 3\n        (1.0, 1e-3, 2, 64, 'uniform'),     # Case 4\n        (1.0, 1e-3, 2, 64, 'graded'),      # Case 5\n    ]\n    results = []\n    for eps, kap, Kfreq, N, mesh_type in test_cases:\n        sat = run_case(eps, kap, Kfreq, N, mesh_type)\n        results.append(sat)\n    # Print as single line with comma-separated floats in list format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3368757"}]}