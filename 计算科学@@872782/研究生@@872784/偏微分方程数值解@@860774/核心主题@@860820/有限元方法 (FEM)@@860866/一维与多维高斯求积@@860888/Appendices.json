{"hands_on_practices": [{"introduction": "掌握任何数值方法的第一步都是从基本原理上理解其构造。本练习 [@problem_id:3398412] 将引导您从头开始，仅使用勒让德 (Legendre) 多项式的正交性，推导出一个一维高斯求积法则。这个过程不仅能加深您对求积节点和权重来源的理解，还将展示高斯求积惊人的代数精度。", "problem": "考虑在跨越区间 $[0,2]$ 的单个有限元上的一维泊松方程，其中局部质量矩阵或刚度矩阵的项需要计算多项式积分。请使用从参考区间构造的高斯求积法计算一个多项式被积函数的积分。从勒让德多项式的定义性质和高斯-勒让德求积的构造出发，完成以下任务：\n\n1. 从第一性原理出发，仅使用勒让德多项式在 $[-1,1]$ 上的正交性以及对特定次数以下多项式的精确性，通过确定其节点和权重，推导在 $[-1,1]$ 上的$3$点高斯-勒让德求积法则。不要使用现成的表格公式。\n\n2. 通过从参考单元出发的标准仿射映射，将此$3$点法则从 $[-1,1]$ 映射到区间 $[0,2]$，并应用它来近似计算积分 $\\int_{0}^{2} x^{5} \\, dx$。\n\n3. 基于高斯-勒让德求积的精确阶，为该被积函数计算值的精确性提供理论证明，并通过使用推导出的节点和权重的显式代数验证来证实它。\n\n以精确解析形式表示最终积分值。无需四舍五入。", "solution": "本题要求使用从第一性原理推导的3点高斯-勒让德求积法则来计算积分 $\\int_{0}^{2} x^{5} \\, dx$。解答按要求分为三部分：求积法则的推导、对特定积分的应用，以及对结果精确性的证明。\n\n**第一部分：推导$3$点高斯-勒让德求积法则**\n\n一个通用的$n$点高斯-勒让德求积法则将函数 $g(t)$ 在参考区间 $[-1, 1]$ 上的积分近似为一个加权和：\n$$\n\\int_{-1}^{1} g(t) \\, dt \\approx \\sum_{i=1}^{n} w_i g(t_i)\n$$\n该法则被构造成对最高 $2n-1$ 次的多项式是精确的。对于一个$3$点法则（$n=3$），其精确阶为 $2(3)-1 = 5$。$n$个求积节点 $t_i$ 是$n$次勒让德多项式 $P_n(t)$ 的根，而$n$个权重 $w_i$ 的选择是为了满足精确性性质。\n\n首先，我们确定$3$次勒让德多项式 $P_3(t)$。勒让德多项式可以使用Bonnet递推关系生成：\n$$\n(k+1)P_{k+1}(t) = (2k+1)tP_k(t) - kP_{k-1}(t)\n$$\n其中前两个多项式为 $P_0(t) = 1$ 和 $P_1(t) = t$。\n\n当 $k=1$ 时：\n$$\n(1+1)P_2(t) = (2(1)+1)tP_1(t) - 1 P_0(t) \\implies 2P_2(t) = 3t(t) - 1(1) = 3t^2 - 1\n$$\n$$\nP_2(t) = \\frac{1}{2}(3t^2 - 1)\n$$\n当 $k=2$ 时：\n$$\n(2+1)P_3(t) = (2(2)+1)tP_2(t) - 2P_1(t) \\implies 3P_3(t) = 5t\\left(\\frac{1}{2}(3t^2 - 1)\\right) - 2t\n$$\n$$\n3P_3(t) = \\frac{15}{2}t^3 - \\frac{5}{2}t - 2t = \\frac{15}{2}t^3 - \\frac{9}{2}t = \\frac{3}{2}(5t^3 - 3t)\n$$\n$$\nP_3(t) = \\frac{1}{2}(5t^3 - 3t)\n$$\n求积节点 $t_1, t_2, t_3$ 是 $P_3(t)=0$ 的根：\n$$\n\\frac{1}{2}(5t^3 - 3t) = 0 \\implies t(5t^2 - 3) = 0\n$$\n这些根是 $t_2=0$ 和 $5t^2 - 3 = 0$，后者给出 $t^2 = \\frac{3}{5}$，所以 $t = \\pm\\sqrt{\\frac{3}{5}}$。\n因此，节点为：\n$$\nt_1 = -\\sqrt{\\frac{3}{5}}, \\quad t_2 = 0, \\quad t_3 = \\sqrt{\\frac{3}{5}}\n$$\n接下来，我们通过要求求积公式对最高为$2$次的多项式（即 $g(t)=1$、$g(t)=t$ 和 $g(t)=t^2$）精确，来求出权重 $w_1, w_2, w_3$。\n\n对于 $g(t)=1$：\n$$\n\\int_{-1}^{1} 1 \\, dt = 2 = \\sum_{i=1}^{3} w_i (1) = w_1 + w_2 + w_3\n$$\n对于 $g(t)=t$：\n$$\n\\int_{-1}^{1} t \\, dt = 0 = \\sum_{i=1}^{3} w_i t_i = w_1\\left(-\\sqrt{\\frac{3}{5}}\\right) + w_2(0) + w_3\\left(\\sqrt{\\frac{3}{5}}\\right) = \\sqrt{\\frac{3}{5}}(w_3 - w_1)\n$$\n这表示 $w_1 = w_3$。\n\n对于 $g(t)=t^2$：\n$$\n\\int_{-1}^{1} t^2 \\, dt = \\left[\\frac{t^3}{3}\\right]_{-1}^{1} = \\frac{2}{3} = \\sum_{i=1}^{3} w_i t_i^2 = w_1\\left(-\\sqrt{\\frac{3}{5}}\\right)^2 + w_2(0)^2 + w_3\\left(\\sqrt{\\frac{3}{5}}\\right)^2\n$$\n$$\n\\frac{2}{3} = w_1\\left(\\frac{3}{5}\\right) + w_3\\left(\\frac{3}{5}\\right) = \\frac{3}{5}(w_1 + w_3)\n$$\n使用 $w_1=w_3$，我们得到 $\\frac{2}{3} = \\frac{3}{5}(2w_1)$，这给出 $w_1 = \\frac{2}{3} \\cdot \\frac{5}{6} = \\frac{10}{18} = \\frac{5}{9}$。\n所以，$w_1 = w_3 = \\frac{5}{9}$。\n将这些代入第一个方程 $w_1 + w_2 + w_3 = 2$：\n$$\n\\frac{5}{9} + w_2 + \\frac{5}{9} = 2 \\implies w_2 = 2 - \\frac{10}{9} = \\frac{18-10}{9} = \\frac{8}{9}\n$$\n$[-1,1]$ 上的$3$点高斯-勒让德求积法则由以下定义：\n节点：$t_1 = -\\sqrt{\\frac{3}{5}}, t_2 = 0, t_3 = \\sqrt{\\frac{3}{5}}$\n权重：$w_1 = \\frac{5}{9}, w_2 = \\frac{8}{9}, w_3 = \\frac{5}{9}$\n\n**第二部分：应用于积分 $\\int_{0}^{2} x^{5} \\, dx$**\n\n为了应用该求积法则，我们必须将积分区间 $[0,2]$ 映射到参考区间 $[-1,1]$。我们使用仿射变换 $x(t) = at+b$。\n条件是 $x(-1)=0$ 和 $x(1)=2$：\n$$\n-a+b=0 \\implies b=a\n$$\n$$\na+b=2 \\implies a+a=2 \\implies 2a=2 \\implies a=1\n$$\n所以，$a=1$ 且 $b=1$，映射关系为 $x(t) = t+1$。微分元为 $dx = dt$。\n我们变换积分：\n$$\nI = \\int_{0}^{2} x^{5} \\, dx = \\int_{-1}^{1} (t+1)^{5} \\, dt\n$$\n令 $g(t) = (t+1)^5$。我们现在应用推导出的$3$点法则：\n$$\nI \\approx \\sum_{i=1}^{3} w_i g(t_i) = w_1 g(t_1) + w_2 g(t_2) + w_3 g(t_3)\n$$\n$$\nI \\approx \\frac{5}{9}g\\left(-\\sqrt{\\frac{3}{5}}\\right) + \\frac{8}{9}g(0) + \\frac{5}{9}g\\left(\\sqrt{\\frac{3}{5}}\\right)\n$$\n$$\nI \\approx \\frac{5}{9}\\left(1-\\sqrt{\\frac{3}{5}}\\right)^5 + \\frac{8}{9}(1+0)^5 + \\frac{5}{9}\\left(1+\\sqrt{\\frac{3}{5}}\\right)^5\n$$\n令 $A = \\sqrt{3/5}$。表达式为 $\\frac{5}{9}\\left[ (1-A)^5 + (1+A)^5 \\right] + \\frac{8}{9}$。\n使用二项式展开，$(1\\pm A)^5 = 1 \\pm 5A + 10A^2 \\pm 10A^3 + 5A^4 \\pm A^5$。\n和为 $(1-A)^5 + (1+A)^5 = 2(1 + 10A^2 + 5A^4)$。\n我们有 $A^2 = \\frac{3}{5}$ 和 $A^4 = \\left(\\frac{3}{5}\\right)^2 = \\frac{9}{25}$。\n代入这些值：\n$$\n2\\left(1 + 10\\left(\\frac{3}{5}\\right) + 5\\left(\\frac{9}{25}\\right)\\right) = 2\\left(1 + 6 + \\frac{9}{5}\\right) = 2\\left(7 + \\frac{9}{5}\\right) = 2\\left(\\frac{35+9}{5}\\right) = 2\\left(\\frac{44}{5}\\right) = \\frac{88}{5}\n$$\n现在，将此结果代回到 $I$ 的表达式中：\n$$\nI \\approx \\frac{5}{9} \\left( \\frac{88}{5} \\right) + \\frac{8}{9} = \\frac{88}{9} + \\frac{8}{9} = \\frac{96}{9} = \\frac{32}{3}\n$$\n\n**第三部分：精确性的证明与验证**\n\n首先，提供理论证明。一个$n$点高斯-勒让德求积法则的精确阶是 $2n-1$。对于我们的$n=3$点法则，精确阶为 $2(3)-1=5$。这意味着该求积法则能在区间 $[-1,1]$ 上精确地计算任何最高为$5$次的多项式的积分。变换后的被积函数 $g(t) = (t+1)^5$ 是一个$5$次多项式。由于被积函数的次数（$5$）小于或等于精确阶（$5$），因此由求积法则计算出的值不是近似值，而是积分 $\\int_{-1}^1 (t+1)^5 \\, dt$ 的精确值。\n\n其次，为了证实这一点，我们通过直接计算原积分来进行显式的代数验证：\n$$\n\\int_{0}^{2} x^{5} \\, dx = \\left[ \\frac{x^6}{6} \\right]_{0}^{2} = \\frac{2^6}{6} - \\frac{0^6}{6} = \\frac{64}{6} = \\frac{32}{3}\n$$\n通过直接解析积分得到的值是 $\\frac{32}{3}$，这与通过$3$点高斯-勒让德求积法则得到的值完全相同。这证实了精确性的理论预测，也证实了我们推导出的节点、权重及其应用的正确性。", "answer": "$$\n\\boxed{\\frac{32}{3}}\n$$", "id": "3398412"}, {"introduction": "虽然从第一性原理推导对于理解概念至关重要，但在实践中，我们需要更通用和稳健的算法来生成求积法则。本练习 [@problem_id:3398441] 介绍了一种优雅而强大的方法——戈卢布-韦尔施 (Golub-Welsch) 算法，它将高斯求积问题转化为一个特征值问题。这个练习还将此一维法则通过张量积自然地推广到二维矩形域上，这是高维求积的标准技术。", "problem": "设权重函数 $w(x)=1$ 定义在区间 $[-1,1]$ 上，并考虑关于此权重的 Legendre 正交多项式族。仅从以下基本事实出发：(i) 任何关于紧致区间上正权重函数的规范正交多项式系 $\\{p_k(x)\\}_{k\\ge 0}$ 都满足一个三项递推关系，其形式为 $x\\,p_k(x)=\\beta_{k+1}\\,p_{k+1}(x)+\\alpha_k\\,p_k(x)+\\beta_k\\,p_{k-1}(x)$，其中 $\\alpha_k$ 为实数，$\\beta_k$ 为严格正数；(ii) Gaussian 求积的节点和权重源于与该规范正交基中乘以 $x$ 的乘法算子相关的谱测度。请完成以下任务：\n\n1) 显式推导在 $[-1,1]$ 上，对于 $n=3$ 的规范正交 Legendre 多项式的对称三对角 Jacobi 矩阵 $J\\in\\mathbb{R}^{n\\times n}$。您必须从第一性原理出发，确定 $J$ 的非零元素的具体数值，包括规范正交化的影响。\n\n2) 仅使用与 $J$ 相关的特征值问题，以机器精度求出在 $[-1,1]$ 上 $n=3$ 的 Gauss–Legendre 求积节点和权重。您必须从理论上证明为什么 $J$ 的特征值是求积节点，以及如何从特征向量和零阶矩 $\\mu_0=\\int_{-1}^{1}w(x)\\,\\mathrm{d}x$ 中恢复权重。\n\n3) 解释并实现 Gaussian 求积到多维的张量积（tensor-product）扩展，并将其应用于一个二元可分离的被积函数。\n\n您的程序必须通过算法实现上述推导，并生成数值输出，通过以下测试套件验证其正确性。除非另有说明，所有比较都必须使用双精度浮点数和容差 $\\tau=10^{-14}$ 进行。\n\n测试套件：\n- 测试 $\\mathrm{T1}$（基于特征值的节点）：从 $J$ 的特征值计算节点 $\\{x_i\\}_{i=1}^3$，并将其与按升序排列的解析值 $\\{-\\sqrt{3/5},\\,0,\\,\\sqrt{3/5}\\}$ 进行比较。将最大绝对差作为单个浮点数报告。\n- 测试 $\\mathrm{T2}$（基于特征值的权重）：从特征向量和 $\\mu_0=2$ 计算权重 $\\{w_i\\}_{i=1}^3$，并将其与按节点顺序排列的解析值 $\\{5/9,\\,8/9,\\,5/9\\}$ 进行比较。将最大绝对差作为单个浮点数报告。\n- 测试 $\\mathrm{T3}$（一维多项式精确性）：使用计算出的节点和权重，对 $k\\in\\{0,1,2,3,4,5\\}$ 近似计算 $\\int_{-1}^{1} x^k\\,\\mathrm{d}x$，并与精确值（当 $k$ 为偶数时为 $2/(k+1)$，当 $k$ 为奇数时为 $0$）进行比较。将这 6 个情况下的最大绝对误差作为单个浮点数报告。\n- 测试 $\\mathrm{T4}$（二维张量积精确性）：根据一维节点和权重构造张量积求积法则，并近似计算 $\\iint_{[-1,1]^2} x^4\\,y^2\\,\\mathrm{d}x\\,\\mathrm{d}y$。与精确值 $(2/5)\\cdot(2/3)=4/15$ 进行比较。将绝对误差作为单个浮点数报告。\n- 测试 $\\mathrm{T5}$（二维光滑非多项式函数）：使用相同的张量积求积法则，近似计算 $\\iint_{[-1,1]^2} e^{x+y}\\,\\mathrm{d}x\\,\\mathrm{d}y$，并与精确值 $\\left(\\int_{-1}^{1} e^x\\,\\mathrm{d}x\\right)^2=\\left(e-1/e\\right)^2$ 进行比较。将绝对误差作为单个浮点数报告。\n- 测试 $\\mathrm{T6}$（权重合理性检查）：验证所有计算出的权重均为严格正数，且 $\\sum_{i=1}^3 w_i=2$ 在容差 $\\tau$ 范围内成立。报告一个布尔值，当且仅当两个条件都满足时为真。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含 $\\mathrm{T1}$ 到 $\\mathrm{T6}$ 的结果，按此顺序排列，形式为一个用方括号括起来的逗号分隔列表，例如 `[v_A,v_B,v_C,v_D,v_E,v_F]`，其中 `v_A,...,v_E` 是浮点数，`v_F` 是一个布尔值。不应打印任何其他文本。", "solution": "该问题是有效的，要求推导并实现用于生成 Gauss-Legendre 求积法则的 Golub-Welsch 算法，然后应用张量积扩展来处理二维积分。\n\n### 第1部分：Jacobi 矩阵的推导 ($n=3$)\n\n对于区间 $[a, b]$ 上关于权重函数 $w(x)$ 的一组规范正交多项式 $\\{p_k(x)\\}_{k=0}^{n-1}$，其三项递推关系由下式给出\n$$x\\,p_k(x) = \\beta_{k+1}\\,p_{k+1}(x) + \\alpha_k\\,p_k(x) + \\beta_k\\,p_{k-1}(x)$$\n对于 $k = 0, 1, \\dots, n-2$，并约定 $p_{-1}(x) = 0$。系数 $\\alpha_k$ 和 $\\beta_k$ 是实数，且 $\\beta_k > 0$。这个方程组可以写成矩阵形式，从而得到 Jacobi 矩阵。对于一个大小为 $n$ 的系统，其 $n \\times n$ 对称三对角 Jacobi 矩阵 $J_n$ 为：\n$$\nJ_n = \\begin{pmatrix}\n\\alpha_0  \\beta_1  0  \\dots  0 \\\\\n\\beta_1  \\alpha_1  \\beta_2   0 \\\\\n0  \\beta_2  \\alpha_2  \\ddots  \\vdots \\\\\n\\vdots   \\ddots  \\ddots  \\beta_{n-1} \\\\\n0  0  \\dots  \\beta_{n-1}  \\alpha_{n-1}\n\\end{pmatrix}\n$$\n这些系数由内积 $\\langle f, g \\rangle = \\int_a^b f(x)g(x)w(x)\\,\\mathrm{d}x$ 定义如下：\n- $\\alpha_k = \\langle x p_k, p_k \\rangle = \\int_a^b x (p_k(x))^2 w(x)\\,\\mathrm{d}x$\n- $\\beta_k = \\langle x p_{k-1}, p_k \\rangle = \\int_a^b x p_{k-1}(x) p_k(x) w(x)\\,\\mathrm{d}x$\n\n对于本问题，我们考虑在 $[-1, 1]$ 上权重函数为 $w(x) = 1$ 的 Legendre 多项式。标准的 Legendre 多项式记为 $P_k(x)$，它们是正交的但非规范正交的。其归一化由 $\\int_{-1}^1 (P_k(x))^2\\,\\mathrm{d}x = \\frac{2}{2k+1}$ 给出。\n相应的规范正交多项式 $p_k(x)$ 通过缩放得到：\n$$p_k(x) = \\sqrt{\\frac{2k+1}{2}} P_k(x)$$\n零阶多项式为 $P_0(x)=1$，因此 $p_0(x) = \\sqrt{1/2}$。\n\n首先，我们确定对角元素 $\\alpha_k$。函数 $(p_k(x))^2 w(x) = (p_k(x))^2$ 在 $[-1, 1]$ 上总是一个偶函数，因为 $p_k(x)$ 具有确定的奇偶性（$p_k(-x) = (-1)^k p_k(x)$）。一个奇函数（即 $x$ 乘以一个偶函数）在对称区间 $[-1, 1]$ 上的积分为零。\n$$\\alpha_k = \\int_{-1}^1 x (p_k(x))^2 \\,\\mathrm{d}x = 0 \\quad \\text{对所有 } k$$\n因此，规范正交 Legendre 多项式的 Jacobi 矩阵的主对角线元素全为零。\n\n接下来，我们确定非对角元素 $\\beta_k$。我们使用 Legendre 多项式 $P_k(x)$ 的标准递推关系：\n$$(k+1)P_{k+1}(x) = (2k+1)x P_k(x) - k P_{k-1}(x)$$\n整理得到 $x P_k(x)$：\n$$x P_k(x) = \\frac{k+1}{2k+1} P_{k+1}(x) + \\frac{k}{2k+1} P_{k-1}(x)$$\n现在，我们将 $P_k(x) = \\sqrt{\\frac{2}{2k+1}} p_k(x)$ 代入此关系式：\n$$x \\sqrt{\\frac{2}{2k+1}} p_k(x) = \\frac{k+1}{2k+1} \\sqrt{\\frac{2}{2(k+1)+1}} p_{k+1}(x) + \\frac{k}{2k+1} \\sqrt{\\frac{2}{2(k-1)+1}} p_{k-1}(x)$$\n两边乘以 $\\sqrt{\\frac{2k+1}{2}}$ 得到规范正交多项式 $p_k(x)$ 的递推关系：\n$$x p_k(x) = \\frac{k+1}{2k+1} \\sqrt{\\frac{2k+1}{2k+3}} p_{k+1}(x) + \\frac{k}{2k+1} \\sqrt{\\frac{2k+1}{2k-1}} p_{k-1}(x)$$\n$$x p_k(x) = \\frac{k+1}{\\sqrt{(2k+1)(2k+3)}} p_{k+1}(x) + \\frac{k}{\\sqrt{(2k-1)(2k+1)}} p_{k-1}(x)$$\n通过将其与一般形式 $x\\,p_k(x) = \\beta_{k+1}\\,p_{k+1}(x) + \\alpha_k\\,p_k(x) + \\beta_k\\,p_{k-1}(x)$ 进行比较，我们识别出当 $k \\ge 1$ 时的系数：\n$$\\alpha_k = 0 \\quad \\text{且} \\quad \\beta_k = \\frac{k}{\\sqrt{4k^2-1}}$$\n对于 $n=3$，我们需要构造矩阵 $J_3$，这需要 $\\alpha_0, \\alpha_1, \\alpha_2$ 和 $\\beta_1, \\beta_2$。\n- 对角线元素为 $\\alpha_0 = \\alpha_1 = \\alpha_2 = 0$。\n- 非对角线元素为：\n  - $\\beta_1 = \\frac{1}{\\sqrt{4(1)^2-1}} = \\frac{1}{\\sqrt{3}}$\n  - $\\beta_2 = \\frac{2}{\\sqrt{4(2)^2-1}} = \\frac{2}{\\sqrt{15}}$\n最终得到的 $3 \\times 3$ Jacobi 矩阵是：\n$$\nJ_3 = \\begin{pmatrix}\n0  1/\\sqrt{3}  0 \\\\\n1/\\sqrt{3}  0  2/\\sqrt{15} \\\\\n0  2/\\sqrt{15}  0\n\\end{pmatrix}\n$$\n\n### 第2部分：从特征值计算 Gaussian 求积节点和权重\n\nGaussian 求积与 Jacobi 矩阵之间的联系是数值分析中的一个基本结果，通常被称为 Golub-Welsch 算法。\n\n**理论证明：**\n设 $\\vec{p}(x) = [p_0(x), p_1(x), \\dots, p_{n-1}(x)]^T$ 是前 $n$ 个规范正交多项式构成的向量。对于 $k=0, \\dots, n-2$ 的三项递推关系可以表示为矩阵形式：\n$$x \\vec{p}(x) = J_n \\vec{p}(x) + \\beta_n p_n(x) \\vec{e}_{n-1}$$\n其中 $\\vec{e}_{n-1} = [0, \\dots, 0, 1]^T$。\n$n$ 点 Gaussian 求积法则的 $n$ 个节点 $\\{x_i\\}_{i=1}^n$ 正是 $n$ 次正交多项式 $p_n(x)$ 的根。如果我们在 $p_n(x)$ 的一个根 $x_i$ 处计算该矩阵方程，则 $p_n(x_i)$ 项会消失：\n$$x_i \\vec{p}(x_i) = J_n \\vec{p}(x_i)$$\n这是标准的特征值方程 $A\\vec{v} = \\lambda\\vec{v}$。它表明 $p_n(x)$ 的根 $x_i$ 是 Jacobi 矩阵 $J_n$ 的特征值，而相应的特征向量与在这些根处求值的多项式向量 $\\vec{p}(x_i)$ 成比例。\n\n求积权重 $\\{w_i\\}_{i=1}^n$ 可以从 $J_n$ 的归一化特征向量中恢复。设 $J_n = V \\Lambda V^T$ 是 $J_n$ 的谱分解，其中 $\\Lambda = \\mathrm{diag}(x_1, \\dots, x_n)$，$V$ 是一个正交矩阵，其列 $\\vec{v}_i$ 是归一化的特征向量。一个标准结果表明，权重与归一化特征向量的第一个分量相关。对于规范正交多项式 $p_k(x)$，其常数项为 $p_0(x) = 1/\\sqrt{\\mu_0}$，其中 $\\mu_0 = \\int_a^b w(x)\\,\\mathrm{d}x$ 是零阶矩。权重公式为 $w_i = \\mu_0 (v_{i,0})^2$，其中 $v_{i,0}$ 是与特征值 $x_i$ 对应的归一化特征向量 $\\vec{v}_i$ 的第一个分量。\n\n对于本问题，$\\mu_0 = \\int_{-1}^1 1\\,\\mathrm{d}x = 2$。因此，权重由 $w_i = 2 (v_{i,0})^2$ 给出。\n\n**n=3 的计算：**\n我们计算 $J_3$ 的特征值和特征向量。特征值将是节点 $\\{x_i\\}_{i=1}^3$。权重 $\\{w_i\\}_{i=1}^3$ 计算为 $w_i = 2 (v_{i,0})^2$，其中 $v_{i,0}$ 是对应于 $x_i$ 的归一化特征向量的第一个分量。\n\n### 第3部分：多维的张量积求积\n\n为了近似计算矩形域上的二维积分 $\\iint_{[-1,1]^2} f(x,y)\\,\\mathrm{d}x\\,\\mathrm{d}y$，我们可以迭代地应用一维求积法则。根据 Fubini 定理，该积分可以写成：\n$$\\int_{-1}^1 \\left( \\int_{-1}^1 f(x,y)\\,\\mathrm{d}y \\right) \\mathrm{d}x$$\n我们可以使用 $n$ 点 Gauss-Legendre 法则 $\\{x_j, w_j\\}_{j=1}^n$ 来近似内部积分：\n$$\\int_{-1}^1 f(x,y)\\,\\mathrm{d}y \\approx \\sum_{j=1}^n w_j f(x, y_j)$$\n将此代回外部积分：\n$$\\int_{-1}^1 \\left( \\sum_{j=1}^n w_j f(x, y_j) \\right) \\mathrm{d}x = \\sum_{j=1}^n w_j \\int_{-1}^1 f(x, y_j) \\mathrm{d}x$$\n对剩余的积分应用相同的求积法则（节点为 $\\{x_i, w_i\\}_{i=1}^n$）得到张量积法则：\n$$\\iint_{[-1,1]^2} f(x,y)\\,\\mathrm{d}x\\,\\mathrm{d}y \\approx \\sum_{j=1}^n w_j \\left( \\sum_{i=1}^n w_i f(x_i, y_j) \\right) = \\sum_{i=1}^n \\sum_{j=1}^n w_i w_j f(x_i, y_j)$$\n此公式使用一个包含 $n^2$ 个点 $(x_i, y_j)$ 的网格，其对应的权重为 $w_i w_j$。该方法对于可分离函数 $f(x,y) = g(x)h(y)$ 特别高效，因为积分及其近似都变成了乘积形式：\n$$\\iint_{[-1,1]^2} g(x)h(y)\\,\\mathrm{d}x\\,\\mathrm{d}y = \\left( \\int_{-1}^1 g(x)\\,\\mathrm{d}x \\right) \\left( \\int_{-1}^1 h(y)\\,\\mathrm{d}y \\right) \\approx \\left( \\sum_{i=1}^n w_i g(x_i) \\right) \\left( \\sum_{j=1}^n w_j h(y_j) \\right)$$\n测试将涉及一个可分离的多项式和一个非多项式的光滑函数，对它们将使用计算出的 3 点 Gauss-Legendre 节点和权重来应用张量积法则。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and applies the 3-point Gauss-Legendre quadrature rule\n    using the Golub-Welsch algorithm (eigenvalue problem of the Jacobi matrix).\n    \"\"\"\n\n    # --- Part 1  2: Derive Jacobi Matrix, compute Nodes and Weights ---\n    n = 3\n    \n    # The Jacobi matrix for orthonormal Legendre polynomials has alpha_k = 0.\n    # The off-diagonal entries are beta_k = k / sqrt(4k^2 - 1).\n    beta = [k / np.sqrt(4 * k**2 - 1) for k in range(1, n)]\n    \n    # Construct the symmetric tridiagonal Jacobi matrix J\n    J = np.diag(beta, k=1) + np.diag(beta, k=-1)\n    \n    # The nodes are the eigenvalues of J.\n    # The weights are derived from the first component of the eigenvectors.\n    # np.linalg.eigh is used for symmetric matrices; it returns sorted eigenvalues\n    # and corresponding eigenvectors as columns.\n    nodes, V = np.linalg.eigh(J)\n    \n    # The zeroth moment (total mass) is mu_0 = integral from -1 to 1 of w(x)=1 dx.\n    mu0 = 2.0\n    \n    # Weights w_i = mu_0 * (v_{i,0})^2, where v_{i,0} is the first component of\n    # the i-th normalized eigenvector. Eigenvectors are columns of V, so we\n    # take the first row of V.\n    weights = mu0 * V[0, :]**2\n\n    # --- Part 3: Run Test Suite ---\n    results = []\n    \n    # T1: Compare computed nodes to analytic values\n    analytic_nodes = np.array([-np.sqrt(3.0 / 5.0), 0, np.sqrt(3.0 / 5.0)])\n    test1_error = np.max(np.abs(nodes - analytic_nodes))\n    results.append(test1_error)\n    \n    # T2: Compare computed weights to analytic values\n    # The weights correspond to the increasingly sorted nodes.\n    # For node 0, weight is 8/9. For nodes +/-sqrt(3/5), weight is 5/9.\n    analytic_weights = np.array([5.0 / 9.0, 8.0 / 9.0, 5.0 / 9.0])\n    test2_error = np.max(np.abs(weights - analytic_weights))\n    results.append(test2_error)\n    \n    # T3: Check polynomial exactness in 1D\n    # A n-point Gauss rule is exact for polynomials of degree up to 2n-1.\n    # For n=3, it should be exact for degrees up to 5.\n    max_poly_error = 0.0\n    for k in range(6):\n        integrand_values = nodes**k\n        quadrature_result = np.sum(weights * integrand_values)\n        exact_result = 0.0 if k % 2 != 0 else 2.0 / (k + 1)\n        error = np.abs(quadrature_result - exact_result)\n        if error > max_poly_error:\n            max_poly_error = error\n    results.append(max_poly_error)\n    \n    # T4: Check tensor-product quadrature for a separable polynomial in 2D\n    # The 3-point rule is exact for x^4 and y^2 individually.\n    f_t4 = lambda x, y: x**4 * y**2\n    # Use np.outer to efficiently compute tensor product sums\n    integral_t4_outer_product = f_t4(nodes[:, np.newaxis], nodes[np.newaxis, :])\n    integral_t4_approx = np.sum(np.outer(weights, weights) * integral_t4_outer_product)\n    integral_t4_exact = (2.0 / 5.0) * (2.0 / 3.0)\n    test4_error = np.abs(integral_t4_approx - integral_t4_exact)\n    results.append(test4_error)\n\n    # T5: Check tensor-product quadrature for a smooth non-polynomial in 2D\n    f_t5 = lambda x, y: np.exp(x + y)\n    integral_t5_outer_product = f_t5(nodes[:, np.newaxis], nodes[np.newaxis, :])\n    integral_t5_approx = np.sum(np.outer(weights, weights) * integral_t5_outer_product)\n    integral_t5_exact = (np.exp(1.0) - np.exp(-1.0))**2\n    test5_error = np.abs(integral_t5_approx - integral_t5_exact)\n    results.append(test5_error)\n\n    # T6: Sanity check for weights\n    tau = 1e-14\n    are_positive = np.all(weights > 0)\n    sum_is_mu0 = np.abs(np.sum(weights) - mu0)  tau\n    test6_result = are_positive and sum_is_mu0\n    results.append(test6_result)\n\n    # Format and print final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3398441"}, {"introduction": "现实世界中的许多问题，尤其是在有限元方法 (FEM) 中，涉及的区域并非简单的矩形，而是像三角形这样的复杂几何形状。本练习 [@problem_id:3398406] 旨在应对这一挑战，指导您为标准三角形参考单元构造一个对称的求积法则。通过为一组单项式强制执行积分精确性，您将体会到矩匹配 (moment-matching) 这一核心原则如何被推广应用于非张量积域。", "problem": "在构建用于三角形网格上二阶椭圆偏微分方程（PDE）的伽辽金有限元法（FEM）算子时，通常需要在每个单元上对最高三次的多项式被积函数进行精确的数值积分。考虑参考三角形 $\\mathcal{T} \\subset \\mathbb{R}^{2}$，其顶点为 $(0,0)$, $(1,0)$ 和 $(0,1)$，因此 $\\mathcal{T} = \\{(x,y) \\,:\\, x \\ge 0,\\ y \\ge 0,\\ x+y \\le 1\\}$。使用满足 $\\lambda_{1}+\\lambda_{2}+\\lambda_{3}=1$ 的重心坐标 $(\\lambda_{1},\\lambda_{2},\\lambda_{3})$ 以及映射 $(x,y) = (\\lambda_{2}, \\lambda_{3})$，在 $\\mathcal{T}$ 上构造一个代数精度为 $3$ 的对称求积格式。该格式有四个节点：三个节点位于 $(a,a,1-2a)$ 的排列上，一个节点位于形心 $(\\tfrac{1}{3},\\tfrac{1}{3},\\tfrac{1}{3})$。为三个排列节点赋予共同的权重 $w_{a}$，为形心节点赋予权重 $w_{c}$。通过对所有满足 $i+j \\le 3$ 的单项式 $x^{i} y^{j}$ 强制积分精确，来确定参数 $a$、$w_{a}$ 和 $w_{c}$。其中，解析积分值是通过在 $\\mathcal{T}$ 上应用贝塔函数恒等式从基本原理推导得出。然后，使用你所构造的格式，评估最大绝对误差\n$$\nE \\;=\\; \\max_{\\,i,j \\,\\ge 0,\\, i+j \\le 3} \\left| \\int_{\\mathcal{T}} x^{i} y^{j} \\, dx\\,dy \\;-\\; \\sum_{k=1}^{4} w_{k}\\, x_{k}^{i} y_{k}^{j} \\right|.\n$$\n将 $E$ 的最终值表示为一个不带单位的实数。无需四舍五入。", "solution": "问题要求在参考三角形 $\\mathcal{T}$ 上构造一个对称的四点求积格式，并随后计算其对最高三次单项式的最大误差。求解过程分两个阶段：首先，确定该格式的参数；其次，根据格式的性质评估误差。\n\n参考三角形由 $\\mathcal{T} = \\{(x,y) \\in \\mathbb{R}^{2} \\,|\\, x \\ge 0, y \\ge 0, x+y \\le 1\\}$ 给出。$\\mathcal{T}$ 的面积为 $\\frac{1}{2}$。问题指定了一个形式为\n$$ \\int_{\\mathcal{T}} f(x,y) \\,dx\\,dy \\approx \\sum_{k=1}^{4} w_k f(x_k, y_k) $$\n的求积格式，该格式必须对所有总次数最高为 $3$ 的多项式 $f(x,y)$ 精确。这等价于要求该格式对所有满足 $i,j \\ge 0$ 和 $i+j \\le 3$ 的单项式 $x^i y^j$ 精确。\n\n首先，我们确定这些单项式积分的精确值。利用贝塔函数恒等式，我们推导出 $I_{ij} = \\int_{\\mathcal{T}} x^i y^j \\,dx\\,dy$ 的通用公式：\n$$ I_{ij} = \\int_0^1 \\int_0^{1-y} x^i y^j \\,dx\\,dy = \\int_0^1 y^j \\left[ \\frac{x^{i+1}}{i+1} \\right]_0^{1-y} dy = \\frac{1}{i+1} \\int_0^1 y^j (1-y)^{i+1} dy $$\n该积分可表示为贝塔函数 $B(j+1, i+2)$。因此，\n$$ I_{ij} = \\frac{1}{i+1} \\frac{\\Gamma(j+1)\\Gamma(i+2)}{\\Gamma(j+i+3)} = \\frac{1}{i+1} \\frac{j! (i+1)!}{(i+j+2)!} = \\frac{i! j!}{(i+j+2)!} $$\n使用此公式，我们计算所需的精确积分值：\n\\begin{itemize}\n    \\item 0次：$I_{00} = \\frac{0!0!}{2!} = \\frac{1}{2}$\n    \\item 1次：$I_{10} = \\frac{1!0!}{3!} = \\frac{1}{6}$，$I_{01} = \\frac{0!1!}{3!} = \\frac{1}{6}$\n    \\item 2次：$I_{20} = \\frac{2!0!}{4!} = \\frac{1}{12}$，$I_{11} = \\frac{1!1!}{4!} = \\frac{1}{24}$\n    \\item 3次：$I_{30} = \\frac{3!0!}{5!} = \\frac{1}{20}$，$I_{21} = \\frac{2!1!}{5!} = \\frac{1}{60}$\n\\end{itemize}\n由于区域 $\\mathcal{T}$ 关于直线 $y=x$ 对称，我们有 $I_{ij} = I_{ji}$。\n\n该求积格式有四个节点。从重心坐标 $(\\lambda_1, \\lambda_2, \\lambda_3)$ 到笛卡尔坐标的映射为 $(x,y) = (\\lambda_2, \\lambda_3)$。\n\\begin{enumerate}\n    \\item 一个节点在形心 $P_c$：重心坐标为 $(\\frac{1}{3},\\frac{1}{3},\\frac{1}{3})$，笛卡尔坐标为 $(x_c,y_c) = (\\frac{1}{3},\\frac{1}{3})$。权重为 $w_c$。\n    \\item 三个节点由重心坐标 $(a,a,1-2a)$ 的排列定义。节点位于 $\\mathcal{T}$ 内的约束要求 $a \\ge 0$ 和 $1-2a \\ge 0$，因此 $0 \\le a \\le \\frac{1}{2}$。\n    \\begin{itemize}\n        \\item $P_{a1}$：由 $(\\lambda_1,\\lambda_2,\\lambda_3) = (a,a,1-2a) \\implies (x,y) = (a, 1-2a)$\n        \\item $P_{a2}$：由 $(\\lambda_1,\\lambda_2,\\lambda_3) = (a,1-2a,a) \\implies (x,y) = (1-2a, a)$\n        \\item $P_{a3}$：由 $(\\lambda_1,\\lambda_2,\\lambda_3) = (1-2a,a,a) \\implies (x,y) = (a, a)$\n    \\end{itemize}\n    这三个节点有共同的权重 $w_a$。\n\\end{enumerate}\n对于函数 $f(x,y)$，求积和（记为 $Q(f)$）为：\n$$ Q(f) = w_c f(\\tfrac{1}{3},\\tfrac{1}{3}) + w_a \\left[ f(a, 1-2a) + f(1-2a, a) + f(a,a) \\right] $$\n我们强制当 $i+j \\le 3$ 时，$Q(x^i y^j) = I_{ij}$。由于该格式构造的对称性，如果条件对 $x^i y^j$ 成立，则对 $x^j y^i$ 也自动成立。我们只需要测试一组非对称单项式的基：\n\\begin{enumerate}\n    \\item 0次 ($1$)：$I_{00} = \\frac{1}{2}$。$Q(1) = w_c + 3w_a$。$\\implies w_c + 3w_a = \\frac{1}{2} \\quad (1)$\n    \\item 1次 ($x$)：$I_{10} = \\frac{1}{6}$。$Q(x) = w_c(\\frac{1}{3}) + w_a(a + (1-2a) + a) = \\frac{w_c}{3} + w_a$。$\\implies \\frac{w_c}{3} + w_a = \\frac{1}{6} \\quad (2)$\n    将方程(2)乘以 $3$ 得到 $w_c + 3w_a = \\frac{1}{2}$，这与(1)相同。这表明此方程与前一个线性相关，我们必须继续考虑更高次数的单项式。\n    \\item 2次 ($x^2$)：$I_{20} = \\frac{1}{12}$。$Q(x^2) = w_c(\\frac{1}{3})^2 + w_a(a^2 + (1-2a)^2 + a^2) = \\frac{w_c}{9} + w_a(6a^2-4a+1)$。\n    $\\implies \\frac{w_c}{9} + w_a(6a^2-4a+1) = \\frac{1}{12} \\quad (3)$\n    \\item 2次 ($xy$)：$I_{11} = \\frac{1}{24}$。$Q(xy) = w_c(\\frac{1}{3})^2 + w_a(a(1-2a) + (1-2a)a + a^2) = \\frac{w_c}{9} + w_a(2a-3a^2)$。\n    $\\implies \\frac{w_c}{9} + w_a(2a-3a^2) = \\frac{1}{24} \\quad (4)$\n\\end{enumerate}\n(3)减去(4)：$w_a[(6a^2-4a+1) - (2a-3a^2)] = \\frac{1}{12} - \\frac{1}{24} = \\frac{1}{24}$。\n这可以简化为 $w_a(9a^2 - 6a + 1) = \\frac{1}{24}$，或 $w_a(3a-1)^2 = \\frac{1}{24} \\quad (5)$。\n将(1)中的 $w_c = \\frac{1}{2} - 3w_a$ 代入(4)可以证实同样的关系，这表明二次多项式的方程只提供了一个新的独立约束。我们必须使用三次多项式。\n\\begin{enumerate}\n    \\item[5.] 3次 ($x^3$)：$I_{30} = \\frac{1}{20}$。$Q(x^3) = w_c(\\frac{1}{27}) + w_a(a^3 + (1-2a)^3 + a^3) = \\frac{w_c}{27} + w_a(-6a^3+12a^2-6a+1)$。\n    $\\implies \\frac{w_c}{27} + w_a(-6a^3+12a^2-6a+1) = \\frac{1}{20} \\quad (6)$\n    \\item[6.] 3次 ($x^2y$)：$I_{21} = \\frac{1}{60}$。$Q(x^2y) = w_c(\\frac{1}{27}) + w_a(a^2(1-2a) + (1-2a)^2 a + a^3) = \\frac{w_c}{27} + w_a(3a^3-3a^2+a)$。\n    $\\implies \\frac{w_c}{27} + w_a(3a^3-3a^2+a) = \\frac{1}{60} \\quad (7)$\n\\end{enumerate}\n(6)减去(7)：$w_a[(-6a^3+12a^2-6a+1) - (3a^3-3a^2+a)] = \\frac{1}{20} - \\frac{1}{60} = \\frac{1}{30}$。\n这可以简化为 $w_a(-9a^3+15a^2-7a+1) = \\frac{1}{30} \\quad (8)$。\n我们现在求解由(5)和(8)组成的方程组。假设 $a \\ne \\frac{1}{3}$（因为如果 $a=\\frac{1}{3}$，(5)式将变为 $0 = \\frac{1}{24}$，这是一个矛盾），我们可以用(8)除以(5)：\n$$ \\frac{w_a(-9a^3+15a^2-7a+1)}{w_a(9a^2-6a+1)} = \\frac{1/30}{1/24} = \\frac{24}{30} = \\frac{4}{5} $$\n$$ 5(-9a^3+15a^2-7a+1) = 4(9a^2-6a+1) $$\n$$ -45a^3 + 75a^2 - 35a + 5 = 36a^2 - 24a + 4 $$\n$$ 45a^3 - 39a^2 + 11a - 1 = 0 $$\n这个关于 $a$ 的三次方程可以因式分解为 $(5a-1)(9a^2-6a+1) = (5a-1)(3a-1)^2 = 0$。\n其根为 $a = \\frac{1}{5}$ 和一个二重根 $a = \\frac{1}{3}$。如前所述，$a \\ne \\frac{1}{3}$，所以唯一有效的解是 $a = \\frac{1}{5}$。该值位于要求的范围 $[0, \\frac{1}{2}]$ 内。\n\n当 $a = \\frac{1}{5}$ 时，我们求权重。由(5)式：\n$w_a(3(\\frac{1}{5})-1)^2 = \\frac{1}{24} \\implies w_a(-\\frac{2}{5})^2 = \\frac{1}{24} \\implies w_a(\\frac{4}{25}) = \\frac{1}{24} \\implies w_a = \\frac{25}{96}$。\n由(1)式：\n$w_c = \\frac{1}{2} - 3w_a = \\frac{1}{2} - 3(\\frac{25}{96}) = \\frac{1}{2} - \\frac{75}{96} = \\frac{48-75}{96} = -\\frac{27}{96} = -\\frac{9}{32}$。\n\n因此，参数为 $a = \\frac{1}{5}$，$w_a = \\frac{25}{96}$ 和 $w_c = -\\frac{9}{32}$。我们成功地构造了指定的求积格式。根据其构造，它对所有总次数最高为 $3$ 的多项式都是精确的；它的代数精度为 $3$。\n\n最后，我们必须评估最大绝对误差：\n$$ E \\;=\\; \\max_{\\,i,j \\,\\ge 0,\\, i+j \\le 3} \\left| \\int_{\\mathcal{T}} x^{i} y^{j} \\, dx\\,dy \\;-\\; \\sum_{k=1}^{4} w_{k}\\, x_{k}^{i} y_{k}^{j} \\right| $$\n单项式集合 $\\{x^i y^j \\,:\\, i,j \\ge 0, i+j \\le 3\\}$ 构成了次数至多为 $3$ 的多项式空间的一组基。我们的构造强制要求对这些基底单项式中的每一个，求积误差都精确为零。也就是说，对于每一对满足 $i,j \\ge 0$ 且 $i+j \\le 3$ 的整数 $i, j$：\n$$ \\int_{\\mathcal{T}} x^{i} y^{j} \\, dx\\,dy \\;-\\; \\sum_{k=1}^{4} w_{k}\\, x_{k}^{i} y_{k}^{j} = 0 $$\n因此，对于所有考虑的单项式，绝对值内的项均为 $0$。一组零的最大值是 $0$。\n因此，$E=0$。", "answer": "$$\\boxed{0}$$", "id": "3398406"}]}