{"hands_on_practices": [{"introduction": "MINRES 算法的核心是 Lanczos 过程，它为对称矩阵构建了一个理想的 Krylov 子空间。通过这个练习 [@problem_id:3421772]，你将亲手执行 Lanczos 迭代的初始步骤，从而直观地理解算法如何将一个大型复杂问题转化为一个更小、更简单的三对角形式。这种实践对于掌握 MINRES 的内部工作机制至关重要。", "problem": "考虑源于一维泊松方程 $-u''(x)=f(x)$ 在单位区间上采用齐次狄利克雷边界条件的中心有限差分离散化所产生的线性系统。为简化起见，网格参数的缩放已被吸收到右端项中。所得到的对称正定矩阵为\n$$\nA=\\begin{pmatrix}\n2  -1  0 \\\\\n-1  2  -1 \\\\\n0  -1  2\n\\end{pmatrix},\n$$\n这是用于偏微分方程数值解的克雷洛夫子空间方法中的一个标准模型问题。在最小残差方法（MINRES）中，Lanczos 过程为克雷洛夫子空间生成一个标准正交基，并生成 $A$ 的一个对称三对角投影。无转置拟最小残差方法（TFQMR）是一种用于非对称问题的相关方法，但此处的重点是与 MINRES 相关的对称情况。\n\n从初始猜测 $x_0=\\mathbf{0}$ 和右端向量 $b=\\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}$ 开始，定义初始残差 $r_0=b-Ax_0$ 和第一个 Lanczos 基向量 $v_1=r_0/\\|r_0\\|$。使用克雷洛夫子空间的基本定义以及刻画对称矩阵上 Lanczos 过程的三项递推关系，执行恰好两次 Lanczos 迭代，以构造标准正交基向量 $v_1$ 和 $v_2$，并组装 $2\\times 2$ 的三对角矩阵 $T_2$，其元素是这些迭代生成的投影系数。\n\n作为与支撑 MINRES 的谱压缩相关的最终标量诊断，计算三对角矩阵 $T_2$ 的行列式。将此行列式以单个精确实数的形式给出。无需四舍五入，不涉及单位。答案必须以单个实数值数字的形式给出。", "solution": "问题要求计算一个 $2 \\times 2$ 三对角矩阵 $T_2$ 的行列式，该矩阵是通过对给定对称矩阵 $A$ 执行两次 Lanczos 过程迭代生成的。该过程从一个特定的右端向量 $b$ 和初始猜测 $x_0$ 开始。\n\n给定的矩阵是：\n$$\nA=\\begin{pmatrix}\n2  -1  0 \\\\\n-1  2  -1 \\\\\n0  -1  2\n\\end{pmatrix}\n$$\n右端向量为 $b=\\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}$，初始猜测为 $x_0=\\mathbf{0}=\\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix}$。\n\nLanczos 过程是一个迭代算法，它为克雷洛夫子空间 $\\mathcal{K}_k(A, r_0) = \\text{span}\\{r_0, Ar_0, \\dots, A^{k-1}r_0\\}$ 生成一个标准正交基 $\\{v_j\\}$，并生成一个对称三对角矩阵 $T_k$，其元素是三项递推关系的系数。标准算法如下：\n\n1.  初始化：计算初始残差 $r_0 = b - Ax_0$。设 $\\beta_1 = \\|r_0\\|_2$ 且 $v_1 = r_0 / \\beta_1$。设 $v_0 = \\mathbf{0}$。\n2.  对 $j=1, 2, \\dots$ 进行迭代：\n    a. 计算 $w_j = A v_j$。\n    b. 计算对角系数 $\\alpha_j = v_j^T w_j$。\n    c. 计算未归一化的下一个向量 $\\tilde{v}_{j+1} = w_j - \\alpha_j v_j - \\beta_j v_{j-1}$。\n    d. 计算非对角系数 $\\beta_{j+1} = \\|\\tilde{v}_{j+1}\\|_2$。\n    e. 如果 $\\beta_{j+1} \\neq 0$，则进行归一化以得到下一个基向量 $v_{j+1} = \\tilde{v}_{j+1} / \\beta_{j+1}$。\n\n我们将执行此过程两次迭代，以找到构成矩阵 $T_2$ 的系数 $\\alpha_1$、$\\beta_2$ 和 $\\alpha_2$。\n\n**初始化步骤：**\n\n首先，我们计算初始残差 $r_0$：\n$$\nr_0 = b - Ax_0 = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} - \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}\n$$\n接下来，我们计算 $r_0$ 的欧几里得范数以求得 $\\beta_1$，然后将 $r_0$ 归一化以得到 $v_1$：\n$$\n\\beta_1 = \\|r_0\\|_2 = \\sqrt{1^2 + 0^2 + 0^2} = 1\n$$\n$$\nv_1 = \\frac{r_0}{\\beta_1} = \\frac{1}{1} \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}\n$$\n问题陈述定义了 $v_1=r_0/\\|r_0\\|$，这与我们的初始化是一致的。\n\n**第一次 Lanczos 迭代 ($j=1$)：**\n\n我们计算 $w_1 = Av_1$：\n$$\nw_1 = Av_1 = \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix}\n$$\n第一个对角系数 $\\alpha_1$ 是 $w_1$ 在 $v_1$ 上的投影：\n$$\n\\alpha_1 = v_1^T w_1 = \\begin{pmatrix}1  0  0\\end{pmatrix} \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix} = (1)(2) + (0)(-1) + (0)(0) = 2\n$$\n现在我们计算下一步的未归一化向量。对于 $j=1$，递推关系为 $\\tilde{v}_2 = w_1 - \\alpha_1 v_1 - \\beta_1 v_0$。由于 $v_0 = \\mathbf{0}$，这可以简化为：\n$$\n\\tilde{v}_2 = w_1 - \\alpha_1 v_1 = \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix} - 2 \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix}\n$$\n第一个非对角系数 $\\beta_2$ 是该向量的范数：\n$$\n\\beta_2 = \\|\\tilde{v}_2\\|_2 = \\sqrt{0^2 + (-1)^2 + 0^2} = 1\n$$\n由于 $\\beta_2 \\neq 0$，我们求得第二个标准正交基向量 $v_2$：\n$$\nv_2 = \\frac{\\tilde{v}_2}{\\beta_2} = \\frac{1}{1} \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix}\n$$\n\n**第二次 Lanczos 迭代 ($j=2$)：**\n\n我们计算 $w_2 = Av_2$：\n$$\nw_2 = Av_2 = \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ -2 \\\\ 1\\end{pmatrix}\n$$\n第二个对角系数 $\\alpha_2$ 是 $w_2$ 在 $v_2$ 上的投影：\n$$\n\\alpha_2 = v_2^T w_2 = \\begin{pmatrix}0  -1  0\\end{pmatrix} \\begin{pmatrix}1 \\\\ -2 \\\\ 1\\end{pmatrix} = (0)(1) + (-1)(-2) + (0)(1) = 2\n$$\n问题只要求构造 $T_2$，所以我们不需要计算 $\\beta_3$ 或 $v_3$。\n\n**构造和评估 $T_2$：**\n\n由 Lanczos 过程生成的 $k \\times k$ 三对角矩阵 $T_k$ 由下式给出：\n$$\nT_k = \\begin{pmatrix}\n\\alpha_1  \\beta_2   \\\\\n\\beta_2  \\alpha_2  \\ddots  \\\\\n  \\ddots  \\ddots  \\beta_k \\\\\n   & \\beta_k  \\alpha_k\n\\end{pmatrix}\n$$\n对于 $k=2$，使用我们计算出的系数（$\\alpha_1=2$，$\\beta_2=1$，$\\alpha_2=2$），矩阵 $T_2$ 为：\n$$\nT_2 = \\begin{pmatrix}\n\\alpha_1  \\beta_2 \\\\\n\\beta_2  \\alpha_2\n\\end{pmatrix} = \\begin{pmatrix}\n2  1 \\\\\n1  2\n\\end{pmatrix}\n$$\n最后一步是计算 $T_2$ 的行列式：\n$$\n\\det(T_2) = (\\alpha_1)(\\alpha_2) - (\\beta_2)^2 = (2)(2) - (1)^2 = 4 - 1 = 3\n$$\n三对角矩阵 $T_2$ 的行列式是 $3$。", "answer": "$$\\boxed{3}$$", "id": "3421772"}, {"introduction": "预处理是加速 Krylov 子空间方法收敛的关键技术，但其应用可能伴随着微妙的陷阱。本练习 [@problem_id:3421783] 揭示了在使用 TFQMR 等算法进行左预处理时，算法监控的残差范数可能与真实残差范数存在巨大差异，从而导致过早收敛的假象。解决这个问题不仅能让你识别数值计算中的一个重要隐患，还能让你学会如何设计更稳健的收敛判据。", "problem": "考虑区间 $\\left[0,1\\right]$ 上的一维稳态对流扩散边界值问题，\n$$\n-\\varepsilon\\,u''(x) + \\beta\\,u'(x) = f(x),\\quad u(0)=0,\\quad u(1)=0,\n$$\n其中 $\\varepsilon$ 和 $\\beta$ 为正常数。在具有两个内部点的均匀网格上，对 $u''(x)$ 使用二阶中心差分，对 $u'(x)$ 使用一阶迎风格式进行离散化，得到的线性系统为 $A\\,x=b$，其中\n$$\nA=\\begin{pmatrix}\n2\\varepsilon/h^{2}+\\beta/h  & -\\varepsilon/h^{2} \\\\\n-\\left(\\varepsilon/h^{2}+\\beta/h\\right)  & 2\\varepsilon/h^{2}+\\beta/h\n\\end{pmatrix},\n$$\n其中 $h$ 是均匀网格间距。令 $\\varepsilon=10^{-4}$，$\\beta=2$，$h=1/3$，并选择右端项 $b=\\begin{pmatrix}0 \\\\ 1\\end{pmatrix}$。考虑使用对角矩阵进行左预处理\n$$\nM=\\begin{pmatrix}\n1  & 0 \\\\\n0  & 10^{5}\n\\end{pmatrix},\n$$\n因此左预处理系统为 $M^{-1}A\\,x=M^{-1}b$。设 $r_{k}=b-A\\,x_{k}$ 表示在第 $k$ 次迭代解 $x_{k}$ 处的真实残差，$\\hat{r}_{k}=M^{-1}r_{k}$ 表示由无转置拟最小残差 (TFQMR) 算法监控的左预处理残差。\n\n(a) 仅使用残差和预处理的核心定义，评估在 $x_{0}=\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$ 处的初始残差，并计算比率\n$$\nR=\\frac{\\|r_{0}\\|_{2}}{\\|\\hat{r}_{0}\\|_{2}},\n$$\n以证明在左预处理 TFQMR 中，递归监控的残差显著低估了真实残差的情况。\n\n(b) 从范数等价性和算子范数的次可乘性出发，推导一个容差自适应策略，保证当 TFQMR 的递归监控器满足 $\\|\\hat{r}_{k}\\|_{2}\\le \\tau_{\\mathrm{TFQMR}}$ 时，有 $\\|r_{k}\\|_{2}\\le t_{\\mathrm{true}}$。将该自适应策略表示为 $\\tau_{\\mathrm{TFQMR}}=\\alpha\\,t_{\\mathrm{true}}$ 的形式，并用 $M$ 表示 $\\alpha$。\n\n(c) 对于上面给定的特定矩阵 $M$，数值计算缩放因子 $\\alpha$，并提供其四舍五入到四位有效数字的值。最终数值不需要单位。", "solution": "该问题分为三个部分：(a) 数值演示，(b) 理论推导，以及 (c) 最终的数值计算。我们将依次解决每个部分。\n\n(a) 初始残差及其范数比的计算。\n给定参数 $\\varepsilon = 10^{-4}$，$\\beta = 2$，以及网格间距 $h = 1/3$。我们首先计算矩阵 $A$ 的元素。\n所需的项为：\n$$\n\\frac{\\varepsilon}{h^2} = \\frac{10^{-4}}{(1/3)^2} = \\frac{10^{-4}}{1/9} = 9 \\times 10^{-4} = 0.0009\n$$\n$$\n\\frac{\\beta}{h} = \\frac{2}{1/3} = 6\n$$\n使用这些值，我们可以构建矩阵 $A$：\n$$\nA = \\begin{pmatrix}\n2\\varepsilon/h^{2}+\\beta/h  & -\\varepsilon/h^{2} \\\\\n-\\left(\\varepsilon/h^{2}+\\beta/h\\right)  & 2\\varepsilon/h^{2}+\\beta/h\n\\end{pmatrix}\n= \\begin{pmatrix}\n2(0.0009) + 6  & -0.0009 \\\\\n-(0.0009 + 6)  & 2(0.0009) + 6\n\\end{pmatrix}\n= \\begin{pmatrix}\n6.0018  & -0.0009 \\\\\n-6.0009  & 6.0018\n\\end{pmatrix}\n$$\n解的初始猜测为 $x_0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。初始真实残差 $r_0$ 定义为 $r_0 = b - A x_0$。由于 $x_0$ 是零向量，这可以简化为 $r_0 = b$。\n给定 $b = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，我们有 $r_0 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$。\n初始真实残差的欧几里得范数（或 $L_2$-范数）是：\n$$\n\\|r_0\\|_2 = \\sqrt{0^2 + 1^2} = 1\n$$\n接下来，我们计算初始左预处理残差 $\\hat{r}_0 = M^{-1}r_0$。预处理矩阵为 $M = \\begin{pmatrix} 1  & 0 \\\\ 0  & 10^5 \\end{pmatrix}$。其逆矩阵为：\n$$\nM^{-1} = \\begin{pmatrix} 1^{-1}  & 0 \\\\ 0  & (10^5)^{-1} \\end{pmatrix} = \\begin{pmatrix} 1  & 0 \\\\ 0  & 10^{-5} \\end{pmatrix}\n$$\n现在我们计算 $\\hat{r}_0$：\n$$\n\\hat{r}_0 = M^{-1}r_0 = \\begin{pmatrix} 1  & 0 \\\\ 0  & 10^{-5} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} (1)(0) + (0)(1) \\\\ (0)(0) + (10^{-5})(1) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 10^{-5} \\end{pmatrix}\n$$\n初始预处理残差的欧几里得范数是：\n$$\n\\|\\hat{r}_0\\|_2 = \\sqrt{0^2 + (10^{-5})^2} = 10^{-5}\n$$\n最后，我们计算比率 $R$：\n$$\nR = \\frac{\\|r_0\\|_2}{\\|\\hat{r}_0\\|_2} = \\frac{1}{10^{-5}} = 10^5\n$$\n这个结果表明，对于这个特定的问题设置，被监控的残差范数 $\\|\\hat{r}_0\\|_2$ 比真实残差的范数 $\\|r_0\\|_2$ 小 $5$ 个数量级。\n\n(b) 容差自适应策略的推导。\n真实残差 $r_k$ 和左预处理残差 $\\hat{r}_k$ 之间的关系由 $\\hat{r}_k = M^{-1}r_k$ 给出。\n从左侧乘以 $M$，我们得到用预处理残差表示真实残差的表达式：\n$$\nr_k = M\\hat{r}_k\n$$\n我们关心这些向量范数之间的关系。对两边取向量 $2$-范数，我们得到：\n$$\n\\|r_k\\|_2 = \\|M\\hat{r}_k\\|_2\n$$\n使用诱导矩阵范数的次可乘性（也称为相容性），即对于任何相容的矩阵 $A$ 和向量 $v$，有 $\\|Av\\| \\le \\|A\\|\\|v\\|$，我们可以建立一个不等式：\n$$\n\\|M\\hat{r}_k\\|_2 \\le \\|M\\|_2 \\|\\hat{r}_k\\|_2\n$$\n其中 $\\|M\\|_2$ 是由向量 $2$-范数诱导的矩阵 $2$-范数（算子范数）。这导出了不等式：\n$$\n\\|r_k\\|_2 \\le \\|M\\|_2 \\|\\hat{r}_k\\|_2\n$$\nTFQMR 算法监控预处理残差范数 $\\|\\hat{r}_k\\|_2$，并且通常在它低于用户定义的容差（我们记为 $\\tau_{\\mathrm{TFQMR}}$）时停止。也就是说，停止准则是 $\\|\\hat{r}_k\\|_2 \\le \\tau_{\\mathrm{TFQMR}}$。\n将此代入我们的不等式，可以得到终止时真实残差范数的上界：\n$$\n\\|r_k\\|_2 \\le \\|M\\|_2 \\tau_{\\mathrm{TFQMR}}\n$$\n我们的目标是确保真实残差范数受期望容差 $t_{\\mathrm{true}}$ 的限制，即 $\\|r_k\\|_2 \\le t_{\\mathrm{true}}$。为了保证这一点，我们必须选择 $\\tau_{\\mathrm{TFQMR}}$，使得 $\\|r_k\\|_2$ 的上界至多为 $t_{\\mathrm{true}}$：\n$$\n\\|M\\|_2 \\tau_{\\mathrm{TFQMR}} \\le t_{\\mathrm{true}}\n$$\n为了获得满足此条件的限制最少（最大）的可能容差 $\\tau_{\\mathrm{TFQMR}}$，我们将两项设为相等：\n$$\n\\|M\\|_2 \\tau_{\\mathrm{TFQMR}} = t_{\\mathrm{true}}\n$$\n解出 $\\tau_{\\mathrm{TFQMR}}$，我们得到自适应容差策略：\n$$\n\\tau_{\\mathrm{TFQMR}} = \\frac{1}{\\|M\\|_2} t_{\\mathrm{true}}\n$$\n将其与要求的形式 $\\tau_{\\mathrm{TFQMR}} = \\alpha\\,t_{\\mathrm{true}}$ 进行比较，我们确定缩放因子 $\\alpha$ 为：\n$$\n\\alpha = \\frac{1}{\\|M\\|_2}\n$$\n\n(c) 缩放因子 $\\alpha$ 的数值计算。\n根据 (b) 部分的结果，我们有 $\\alpha = 1/\\|M\\|_2$。我们需要计算给定预处理器 $M$ 的 $2$-范数：\n$$\nM = \\begin{pmatrix} 1  & 0 \\\\ 0  & 10^5 \\end{pmatrix}\n$$\n矩阵 $2$-范数 $\\|M\\|_2$ 定义为 $M$ 的最大奇异值。对于对角矩阵 $D = \\mathrm{diag}(d_1, d_2, \\dots, d_n)$，奇异值就是对角元素 $|d_i|$ 的绝对值。$2$-范数是这些值的最大值。\n在本例中，$M$ 的对角元素是 $1$ 和 $10^5$。它们的绝对值是 $1$ 和 $10^5$。\n因此，$M$ 的 $2$-范数是：\n$$\n\\|M\\|_2 = \\max(|1|, |10^5|) = 10^5\n$$\n现在我们可以计算缩放因子 $\\alpha$：\n$$\n\\alpha = \\frac{1}{\\|M\\|_2} = \\frac{1}{10^5} = 10^{-5}\n$$\n题目要求将此值四舍五入到四位有效数字。精确值为 $0.00001$。为了用四位有效数字表示，我们将其写成科学记数法形式 $1.000 \\times 10^{-5}$。", "answer": "$$\n\\boxed{1.000 \\times 10^{-5}}\n$$", "id": "3421783"}, {"introduction": "在实际的科学计算中，我们常常面对一个“黑箱”算子，其数学性质（如对称性或正定性）是未知的。在这种情况下，如何选择最合适的求解器（如专用的 MINRES 或通用的 TFQMR）是一个核心的实践问题。这个练习 [@problem_id:3421838] 将指导你如何设计一套仅依赖于算子作用的矩阵无关测试，为你的算子进行“体检”，并基于“体检”结果制定出明智的求解器选择策略。", "problem": "您正在为一个线性系统 $A u = b$ 实现一个无矩阵 Krylov 求解器，该系统由线性偏微分方程的有限元离散化产生。算子 $A$ 仅以函数形式提供，对于给定的向量 $x$ 返回 $A x$。一个左预条件子 $M^{-1}$ 通过一个函数提供，对于任意向量 $r$ 返回 $M^{-1} r$，但显式矩阵 $A$ 和 $M$ 并未被组装。您必须根据算子是否对称及其定性，在最小残差方法 (MINRES) 和无转置拟最小残差方法 (TFQMR) 之间做出选择，并且必须确保所选求解器要求的任何预处理假设都成立。\n\n从内积空间中自伴性和定性的定义出发，提出无矩阵数值测试来评估：\n\n- $A$ 是否关于欧几里得内积 $\\langle x, y \\rangle = x^{\\top} y$ 是对称的（自伴的），以及\n- $A$ 是正定的、不定的还是半正定的，\n\n并解释如何根据测试结果在 MINRES 和 TFQMR 之间调整求解器的选择，同时考虑到预处理在所需内积中的作用。考虑到偏微分方程可能会产生一个零空间（例如，Poisson 问题中的纯 Neumann 边界条件），并且预条件子在实践中可能不是精确对称的。假设使用双精度算术，机器单位舍入误差 $\\epsilon_{\\mathrm{mach}}$ 的量级为 $10^{-16}$。\n\n在这些约束条件下，以下哪个选项给出了一套科学上合理的无矩阵测试方法和正确的求解器选择策略？\n\nA. 使用随机探针测试来检验对称性：抽取 $k$ 对随机非零向量对 $(x_i, y_i)$ 并计算归一化的反对称性度量\n$\\eta_i = \\dfrac{\\left|\\langle A x_i, y_i \\rangle - \\langle x_i, A y_i \\rangle\\right|}{\\|x_i\\| \\, \\|A y_i\\| + \\|y_i\\| \\, \\|A x_i\\|}$，如果 $\\max_i \\eta_i \\le c \\, \\epsilon_{\\mathrm{mach}}$ 对于一个适度的常数 $c$ 成立，则接受对称性。对于定性，使用随机起始向量对 $A$ 运行 $m$ 步无矩阵 Lanczos 算法，以估计在欧几里得内积下的极端 Ritz 值 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$；如果 $\\lambda_{\\min} > 0$，则分类为对称正定；如果 $\\lambda_{\\min} < 0 < \\lambda_{\\max}$，则为不定；如果 $\\lambda_{\\min} \\approx 0 \\le \\lambda_{\\max}$，则为半正定；如果存在已知的零空间（例如，常数向量），在测试前将其投影掉。通过检查对于随机非零 $z$ 是否有 $\\langle M z, z \\rangle > 0$ 以及在 $\\langle M u, v \\rangle - \\langle u, M v \\rangle$ 中是否存在小的反对称性，来验证预条件子是否为对称正定。如果 $A$ 是对称的（定性可以是不定的）并且 $M$ 是对称正定的，则选择 MINRES，对预处理的 MINRES 使用 $M$-内积 $\\langle x, y \\rangle_M = \\langle M x, y \\rangle$；否则，选择 TFQMR。\n\nB. 为了测试对称性，对随机的 $x$ 逼近 $\\|A x - A^{\\top} x\\|$，如果范数低于 $10^{-8}$ 则接受对称性；为了测试定性，检查 $\\|A x\\|$ 是否随 $\\|x\\|$ 单调增加。仅当 $A$ 是对称正定时选择 TFQMR；否则，选择 MINRES，因为它对任何 $A$ 都能最小化残差。\n\nC. 使用单向量能量测试：抽取一个随机非零向量 $x$ 并计算 $\\rho(x) = \\langle A x, x \\rangle / \\langle x, x \\rangle$。如果 $\\rho(x) > 0$，则断定 $A$ 是对称正定的；如果 $\\rho(x) < 0$，则断定 $A$ 是非对称的。对于对称不定系统选择共轭梯度法，因为它比 MINRES 更快；否则选择 TFQMR。\n\nD. 使用单一方向导数测试：选取一个随机非零向量对 $(x, y)$，计算 $\\left|\\langle A x, y \\rangle - \\langle x, A y \\rangle\\right|$，如果它低于 $10^{-3}$ 则接受对称性。如果曾观察到负的 Rayleigh 商 $\\langle A x, x \\rangle / \\langle x, x \\rangle$，则断定 $A$ 是非对称的。只要 $M$ 是正定的，就总是在左预处理系统 $M^{-1} A u = M^{-1} b$ 上使用 MINRES，因为左预处理在欧几里得内积中能将任何 $A$ 对称化；否则使用 TFQMR。", "solution": "用户要求对问题陈述进行严格验证，然后详细推导正确答案并对每个选项进行评估。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n*   **系统**：待求解的线性系统 $A u = b$。\n*   **来源**：该系统源于线性偏微分方程 (PDE) 的有限元离散化。\n*   **算子 $A$**：仅以无矩阵函数形式提供，该函数为给定向量 $x$ 计算乘积 $A x$。显式矩阵 $A$ 未被组装。\n*   **预条件子 $M^{-1}$**：一个左预条件子以无矩阵函数形式提供，该函数为给定向量 $r$ 计算 $M^{-1} r$。显式矩阵 $M$ 未被组装。\n*   **可选求解器**：最小残差方法 (MINRES) 和无转置拟最小残差方法 (TFQMR)。\n*   **决策标准**：选择取决于算子 $A$ 是否对称及其定性。所选求解器要求的预处理假设也必须成立。\n*   **附加背景**：\n    *   该偏微分方程可能导致 $A$ 存在零空间。\n    *   预条件子在实践中可能不是精确对称的。\n    *   计算在双精度算术下进行，机器单位舍入误差 $\\epsilon_{\\mathrm{mach}} \\approx 10^{-16}$。\n*   **任务**：提出用于评估 $A$ 的对称性和定性的无矩阵数值测试，并解释考虑到预条件子的情况下，在 MINRES 和 TFQMR 之间进行求解器选择的逻辑。\n\n**步骤2：使用提取的已知条件进行验证**\n\n1.  **科学上合理（关键）**：该问题牢固地植根于数值线性代数领域，特别是大规模线性系统的迭代求解。MINRES 和 TFQMR 是标准的 Krylov 子空间方法。对称性（自伴性）、定性、无矩阵实现和预处理等概念是核心且描述准确。诸如某些偏微分方程边界条件（如纯 Neumann）产生的零空间和不完美的预条件子等实际考虑，反映了计算科学中的真实挑战。该问题在科学上是合理的。\n2.  **良定性**：该问题是良定的。它要求基于已建立的数值原理提出一套程序和决策策略。可以构建一个清晰、合乎逻辑且有意义的解决方案。\n3.  **客观性（关键）**：问题陈述使用了来自数学和计算机科学的精确、无偏见且标准的技术术语。没有主观或基于意见的元素。\n4.  **其他缺陷**：\n    *   **完整性**：问题是自包含的，并提供了制定测试和选择策略所需的所有必要信息。\n    *   **一致性**：没有内部矛盾。\n    *   **现实性**：所描述的场景对于开发高性能科学计算软件的从业者来说非常现实。\n\n**步骤3：结论和行动**\n\n问题陈述是**有效的**。这是一个在数值分析领域中表述良好的问题。我将继续推导解决方案并评估各个选项。\n\n### 解题推导\n\n核心任务是设计一个无矩阵的测试和求解器选择策略。\n\n**1. 理论基础**\n\n*   **MINRES**：该算法专为线性系统 $Ax=b$ 设计，其中矩阵 $A$ 是对称的（自伴的）。它可以是不定的。其效率源于从 Lanczos 过程中导出的短递推关系，该关系仅对对称算子有效。对于预处理系统，MINRES 应用于 $M^{-1}Ax = M^{-1}b$。为了使短递推关系成立，系统的算子 $M^{-1}A$ 必须在某个内积下是自伴的。如果 $A$ 在欧几里得内积（$\\langle x,y \\rangle = x^\\top y$）下是对称的，并且预条件子 $M$ 是对称正定的（SPD），那么算子 $M^{-1}A$ 在 $M$-内积（定义为 $\\langle x,y \\rangle_M = \\langle Mx, y \\rangle$）下是自伴的。\n    *   验证：$\\langle M^{-1}Ax, y \\rangle_M = \\langle M(M^{-1}A)x, y \\rangle = \\langle Ax, y \\rangle$。\n    *   并且 $\\langle x, M^{-1}Ay \\rangle_M = \\langle Mx, M^{-1}Ay \\rangle = \\langle M(M^{-1}A)y, x \\rangle = \\langle Ay, x \\rangle$。\n    *   由于 $A$ 是对称的，$\\langle Ax, y \\rangle = \\langle x, Ay \\rangle$，这证明了 $\\langle M^{-1}Ax, y \\rangle_M = \\langle x, M^{-1}Ay \\rangle_M$。\n    *   因此，使用预处理 MINRES 的条件是：**(i) $A$ 是对称的，并且 (ii) $M$ 是对称正定的。**\n\n*   **TFQMR**：该算法专为一般的非对称线性系统设计。它不要求对称性或定性。当更专门（且通常更快）的方法如 MINRES 或 CG 的条件不满足时，它是一个合适的“主力”求解器。\n\n**2. 无矩阵测试**\n\n*   **测试 $A$ 的对称性**：\n    实算子 $A$ 在欧几里得内积下的自伴性定义为对于所有向量 $x, y$ 都有 $\\langle Ax, y \\rangle = \\langle x, Ay \\rangle$。数值测试无法检查所有向量对，但可以使用随机向量来探测此条件。单个向量对不鲁棒。一个鲁棒的测试涉及抽取几对随机向量对 $(x_i, y_i)$ 并检查偏离对称性的量级。关键是，偏差必须被归一化，以独立于向量的尺度和算子范数。一个精心设计的相对度量是：\n    $$ \\eta = \\frac{|\\langle Ax, y \\rangle - \\langle x, Ay \\rangle|}{|\\langle Ax, y \\rangle| + |\\langle x, Ay \\rangle|} \\quad \\text{或类似形式} \\quad \\frac{|\\langle Ax, y \\rangle - \\langle x, Ay \\rangle|}{\\|Ax\\|\\|y\\| + \\|x\\|\\|Ay\\|} $$\n    在浮点运算中，如果 $A$ 确实是对称的，这个度量 $\\eta$ 应该在 $\\epsilon_{\\mathrm{mach}} \\approx 10^{-16}$ 的量级上。我们将测试 $\\max_i \\eta_i \\le C \\cdot \\epsilon_{\\mathrm{mach}}$，其中 $C$ 是某个小常数。\n\n*   **测试 $A$ 的定性**：\n    该性质是为对称矩阵定义的，基于 Rayleigh 商 $\\langle Ax, x \\rangle / \\langle x, x \\rangle$ 的符号。\n    *   **正定**：对所有非零 $x$，$\\langle Ax, x \\rangle > 0$。所有特征值均为正。\n    *   **半正定**：对所有非零 $x$，$\\langle Ax, x \\rangle \\ge 0$。所有特征值均为非负。零空间导致零特征值。\n    *   **不定**：$\\langle Ax, x \\rangle$ 可以是正、负或零。存在正负特征值。\n    用几个随机向量进行测试是不可靠的。需要一种系统的方法来估计极端特征值 $\\lambda_{\\min}(A)$ 和 $\\lambda_{\\max}(A)$。无矩阵 Lanczos 算法是理想的工具。通过用随机起始向量对 $A$ 运行少量步骤（$m$）的 Lanczos 算法，可以得到一个 $m \\times m$ 的三对角矩阵 $T_m$。$T_m$ 的特征值（Ritz 值）是 $A$ 极端特征值的极好近似。然后可以根据估计的 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$ 的符号对 $A$ 进行分类。如果事先知道存在零空间（例如，全一向量），则 Lanczos 的起始向量应与其正交。\n\n*   **测试预条件子 $M$**：\n    我们需要仅使用算子 $M^{-1}$ 来检查 $M$ 是否为对称正定。如果 $M$ 是对称正定的，那么 $M^{-1}$ 也是对称正定的。\n    *   **对称性**：我们测试 $M^{-1}$ 是否对称：对于随机向量 $u, v$，检查 $|\\langle M^{-1}u, v \\rangle - \\langle u, M^{-1}v \\rangle|$ 是否接近于零（使用适当的归一化）。\n    *   **正定性**：我们测试 $M^{-1}$ 是否正定：对于几个随机非零向量 $r$，检查 $\\langle M^{-1}r, r \\rangle > 0$。这等价于通过代入 $r = Mz$ 来检查 $\\langle z, Mz \\rangle > 0$。\n\n**3. 求解器选择策略**\n\n1.  使用随机对探针测试来检验 $A$ 是否对称。\n2.  如果 $A$ 不对称，选择 **TFQMR**。\n3.  如果 $A$ 是对称的，继续检查预条件子 $M$（通过 $M^{-1}$）的对称正定性质。\n4.  如果 $M$ 不是对称正定的，则预处理 MINRES 的理论基础无效。选择 **TFQMR**。\n5.  如果 $A$ 是对称的且 $M$ 是对称正定的，选择 **MINRES**。$A$ 的定性并不妨碍使用 MINRES（它适用于对称不定系统）。然而，了解定性仍然有用。可以执行基于 Lanczos 的测试来确定 $A$ 是正定、不定还是半正定。如果发现它是对称正定的，原则上可以切换到共轭梯度（CG）方法，它对于对称正定系统比 MINRES 稍有效率。但在 MINRES 与 TFQMR 的选择中，MINRES 是正确的答案。\n\n### 逐项分析\n\n**选项 A：**\n*   **对称性测试**：“抽取 $k$ 对随机非零向量对 $(x_i, y_i)$”并使用归一化度量 $\\eta_i = \\dfrac{\\left|\\langle A x_i, y_i \\rangle - \\langle x_i, A y_i \\rangle\\right|}{\\|x_i\\| \\, \\|A y_i\\| + \\|y_i\\| \\, \\|A x_i\\|}$。这个测试是鲁棒的，经过良好归一化，并正确地与机器精度 $\\epsilon_{\\mathrm{mach}}$ 进行比较。这是一种先进的方法。**正确**。\n*   **定性测试**：“对 $A$ 运行 $m$ 步无矩阵 Lanczos 算法……以估计极端 Ritz 值 $\\lambda_{\\min}$ 和 $\\lambda_{\\max}$”。这是标准且最可靠的无矩阵方法。基于这些值的符号进行分类也是正确的。承认需要投影掉已知的零空间也是正确的。**正确**。\n*   **预条件子检查**：它正确地指出了需要验证 $M$ 是对称正定。测试正定性 $\\langle Mz, z \\rangle > 0$ 通过检查随机 $r$ 的 $\\langle r, M^{-1}r \\rangle > 0$ 来正确实现。测试 $M$ 的对称性通过检查 $M^{-1}$ 的对称性来正确实现。虽然选项的措辞是测试 $M$，但所描述的操作隐含地依赖于 $M^{-1}$，这才是可用的并且是等效的检查。**正确**。\n*   **求解器选择**：“如果 $A$ 是对称的……且 $M$ 是对称正定的，则选择 MINRES，使用 $M$-内积”。这正确地陈述了预处理 MINRES 的必要和充分条件。“否则，选择 TFQMR”是正确的后备选择。**正确**。\n*   **对 A 的结论**：此选项提供了一个科学上合理、鲁棒且完整的程序，与数值线性代数的原理完美对齐。**正确**。\n\n**选项 B：**\n*   **对称性测试**：“对随机的 $x$ 逼近 $\\|A x - A^{\\top} x\\|$”。在仅知道 $A$ 的作用而不知道 $A^\\top$ 的无矩阵设置中，这是不可能的。这是一个根本性缺陷。**不正确**。\n*   **定性测试**：“检查 $\\|A x\\|$ 是否随 $\\|x\\|$ 单调增加”。这不是定性的测试。对于一个特征值为 $\\lambda_1, \\lambda_n$ 的对称正定矩阵 $A$，范数关系是 $\\lambda_1 \\|x\\| \\le \\|Ax\\| \\le \\lambda_n \\|x\\|$。这个条件并不意味着所述的单调性。**不正确**。\n*   **求解器选择**：“仅当 $A$ 是对称正定时选择 TFQMR”。这是反过来的。TFQMR 用于非对称系统。对于对称正定系统，人们会使用 CG（或 MINRES）。“否则，选择 MINRES，因为它对任何 $A$ 都能最小化残差”。这是危险的错误。MINRES 需要一个对称算子。GMRES 是为一般非对称矩阵最小化残差的经典方法。**不正确**。\n*   **对 B 的结论**：此选项在每个方面都存在缺陷：测试要么不可能，要么毫无意义，求解器选择逻辑完全错误。**不正确**。\n\n**选项 C：**\n*   **对称性与定性测试**：“单向量能量测试”不鲁棒。单个随机向量是不够的。“如果 $\\rho(x) > 0$，则断定 $A$ 是对称正定的”是一个逻辑谬误。一个非对称矩阵也可以有正的 Rayleigh 商。“如果 $\\rho(x) < 0$，则断定 $A$ 是非对称的”也是错误的；对称不定矩阵有负的 Rayleigh 商。**不正确**。\n*   **求解器选择**：“对于对称不定系统选择共轭梯度法”。CG 仅适用于对称正定系统。在不定系统上使用它会导致崩溃或失败。MINRES 在这里是正确的选择。**不正确**。\n*   **对 C 的结论**：此选项显示出对矩阵基本性质和 Krylov 求解器适用性的缺乏理解。**不正确**。\n\n**选项 D：**\n*   **对称性测试**：使用单个向量对 $(x, y)$ 不鲁棒。$10^{-3}$ 的阈值是武断的、未缩放且过大；它会错误分类许多矩阵。**不正确**。\n*   **定性测试**：“如果曾观察到负的 Rayleigh 商……则断定 A 是非对称的”。这与 C 中的错误相同。一个对称不定矩阵会被错误地归类为非对称。**不正确**。\n*   **求解器选择**：“只要 $M$ 是正定的，就总是在左预处理系统 $M^{-1} A u = M^{-1} b$ 上使用 MINRES，因为左预处理在欧几里得内积中能将任何 $A$ 对称化”。这是一个严重的误解。左预处理并*不*在欧几里得内积中对称化算子 $M^{-1}A$（除非 $A$ 和 $M$ 恰好可交换）。这个陈述是根本错误的，会导致将 MINRES 应用于非对称算子，使其失败。**不正确**。\n*   **对 D 的结论**：测试不鲁棒，求解器选择策略基于一个关于预处理和对称性的危险错误前提。**不正确**。", "answer": "$$\\boxed{A}$$", "id": "3421838"}]}