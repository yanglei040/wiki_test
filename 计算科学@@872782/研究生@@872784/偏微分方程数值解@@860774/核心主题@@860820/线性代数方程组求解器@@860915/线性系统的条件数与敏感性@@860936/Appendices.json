{"hands_on_practices": [{"introduction": "理解偏微分方程的数值方法如何导致病态系统是该领域的基石。第一个练习提供了一个基础的分析性实践来揭示这种关系。通过推导离散化一维泊松方程的条件数的渐近行为，我们将精确地看到网格加密为何以及如何内在地产生一个更敏感的线性系统。[@problem_id:3372809]", "problem": "考虑在区间 $(0,1)$ 上的一维 Poisson 偏微分方程 (PDE) $-u''(x)=f(x)$，带有齐次 Dirichlet 边界条件 $u(0)=u(1)=0$。使用 $n$ 个内部网格点将定义域离散化，均匀间距为 $h=1/(n+1)$，并用中心二阶差分近似 $-u''(x)$。这将得到线性系统 $A\\mathbf{u}=\\mathbf{f}$，其中 $A$ 为 $n\\times n$ 矩阵 $A=(1/h^{2})\\,\\mathrm{tridiag}(-1,2,-1)$。\n\n仅从欧几里得范数 (2-范数)、矩阵的 2-范数条件数以及带有齐次 Dirichlet 边界条件的离散二阶差分算子的基本定义出发，推导当 $h\\to 0$ 时，2-范数条件数 $\\kappa_{2}(A)$ 的主阶渐近行为。具体来说，证明 $\\kappa_{2}(A)\\sim C\\,h^{-2}$ 并确定精确常数 $C$。\n\n你的最终答案必须是 $C$ 的精确闭式解值（一个以符号表示的实数，而非数值近似）。最终答案中不要提供中间步骤或任何其他量。", "solution": "矩阵 $A$ 源于在带有齐次 Dirichlet 边界条件的均匀网格上对负二阶导数 $-u''(x)$ 的中心二阶差分近似。矩阵 $A$ 是实对称、严格对角占优的，其对角线元素为正，非对角线元素为负，因此它是对称正定 (SPD) 的。\n\n根据定义，$A$ 的欧几里得范数 (2-范数) 条件数为\n$$\n\\kappa_{2}(A)=\\|A\\|_{2}\\,\\|A^{-1}\\|_{2}.\n$$\n对于一个对称正定矩阵，谱范数 $\\|A\\|_{2}$ 等于 $A$ 的最大特征值，而 $\\|A^{-1}\\|_{2}$ 等于 $A$ 的最小特征值的倒数。因此，\n$$\n\\kappa_{2}(A)=\\frac{\\lambda_{\\max}(A)}{\\lambda_{\\min}(A)}.\n$$\n\n为了确定 $A$ 的特征值，我们使用在齐次 Dirichlet 边界条件下的离散二阶差分算子。令网格索引为 $j=1,2,\\dots,n$，并定义向量分量 $v^{(k)}_{j}=\\sin\\!\\big(j\\theta_{k}\\big)$，其中\n$$\n\\theta_{k}=\\frac{k\\pi}{n+1}, \\quad k=1,2,\\dots,n.\n$$\n这 $n$ 个向量构成一个正交基，与齐次 Dirichlet 边界条件 $v^{(k)}_{0}=v^{(k)}_{n+1}=0$ 一致。\n\n将 $A$ 应用于 $v^{(k)}$：\n$$\n(Av^{(k)})_{j}=\\frac{1}{h^{2}}\\Big(-v^{(k)}_{j-1}+2v^{(k)}_{j}-v^{(k)}_{j+1}\\Big)=\\frac{1}{h^{2}}\\Big(-\\sin((j-1)\\theta_{k})+2\\sin(j\\theta_{k})-\\sin((j+1)\\theta_{k})\\Big).\n$$\n使用三角恒等式\n$$\n-\\sin((j-1)\\theta)+2\\sin(j\\theta)-\\sin((j+1)\\theta)=2\\big(1-\\cos\\theta\\big)\\sin(j\\theta)=4\\sin^{2}\\!\\Big(\\frac{\\theta}{2}\\Big)\\sin(j\\theta),\n$$\n我们得到\n$$\n(Av^{(k)})_{j}=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{\\theta_{k}}{2}\\Big)\\sin(j\\theta_{k})=\\lambda_{k}\\,v^{(k)}_{j},\n$$\n特征值为\n$$\n\\lambda_{k}=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{k\\pi}{2(n+1)}\\Big), \\quad k=1,2,\\dots,n.\n$$\n\n因此，\n$$\n\\lambda_{\\min}(A)=\\lambda_{1}=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{\\pi}{2(n+1)}\\Big), \\qquad \\lambda_{\\max}(A)=\\lambda_{n}=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{n\\pi}{2(n+1)}\\Big).\n$$\n\n我们现在提取当 $h\\to 0$ 时的主阶渐近式。由于 $h=1/(n+1)$，当 $h\\to 0$ 时，我们有 $n\\to\\infty$。\n\n对于最小特征值，\n$$\n\\lambda_{\\min}(A)=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{\\pi}{2(n+1)}\\Big)=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{\\pi h}{2}\\Big).\n$$\n使用当 $x\\to 0$ 时的小角近似 $\\sin x \\sim x$，我们得到\n$$\n\\sin\\!\\Big(\\frac{\\pi h}{2}\\Big)\\sim \\frac{\\pi h}{2} \\quad \\text{as } h\\to 0,\n$$\n所以\n$$\n\\lambda_{\\min}(A)\\sim \\frac{4}{h^{2}}\\Big(\\frac{\\pi h}{2}\\Big)^{2}=\\pi^{2}.\n$$\n\n对于最大特征值，\n$$\n\\lambda_{\\max}(A)=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{n\\pi}{2(n+1)}\\Big)=\\frac{4}{h^{2}}\\sin^{2}\\!\\Big(\\frac{\\pi}{2}-\\frac{\\pi}{2(n+1)}\\Big).\n$$\n使用 $\\sin\\!\\big(\\frac{\\pi}{2}-\\varepsilon\\big)=\\cos(\\varepsilon)$ 以及当 $\\varepsilon\\to 0$ 时 $\\cos(\\varepsilon)\\to 1$，我们得到\n$$\n\\sin^{2}\\!\\Big(\\frac{\\pi}{2}-\\frac{\\pi}{2(n+1)}\\Big)\\to 1 \\quad \\text{as } n\\to\\infty,\n$$\n因此\n$$\n\\lambda_{\\max}(A)\\sim \\frac{4}{h^{2}}.\n$$\n\n因此，2-范数条件数满足\n$$\n\\kappa_{2}(A)=\\frac{\\lambda_{\\max}(A)}{\\lambda_{\\min}(A)}\\sim \\frac{(4/h^{2})}{\\pi^{2}}=\\Big(\\frac{4}{\\pi^{2}}\\Big)h^{-2} \\quad \\text{as } h\\to 0.\n$$\n这确定了渐近关系 $\\kappa_{2}(A)\\sim C\\,h^{-2}$ 中的精确常数 $C$：\n$$\nC=\\frac{4}{\\pi^{2}}.\n$$", "answer": "$$\\boxed{\\frac{4}{\\pi^{2}}}$$", "id": "3372809"}, {"introduction": "虽然对称矩阵的特征值能告诉我们很多关于其条件数的信息，但对于流体动力学中常见的非对称系统，情况要复杂得多。本实践探讨了一个模拟平流过程的典型非正规矩阵，揭示了特征值有时会具有高度的误导性。我们将分析，尽管其所有特征值都等于一，其巨大的条件数如何对迭代求解器的收敛准则构成重大挑战。[@problem_id:3372780]", "problem": "考虑由稳态一维线性平流方程的粗糙双单元迎风离散化产生的线性系统，该系统可以由非正规矩阵建模\n$$\nA(\\alpha) \\;=\\; \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix},\n$$\n其中 $\\alpha > 0$ 代表由强平流相对于扩散引起的单向耦合强度。对于任意 $\\alpha$，该矩阵的所有特征值都等于 1，但当 $\\alpha$ 很大时，它是高度非正规的。从奇异值、2-范数和 2-范数条件数的定义出发，推导 $\\kappa_2\\!\\left(A(\\alpha)\\right)$ 关于 $\\alpha$ 的精确闭式表达式。然后，从关联迭代误差 $e_k$ 和残差 $r_k$ 的恒等式 $e_k = A^{-1} r_k$ 出发，解释大的 $\\kappa_2\\!\\left(A(\\alpha)\\right)$ 对 Krylov 子空间迭代求解器（如广义最小残差法，GMRES）中基于残差的停止准则的影响。\n\n最后，对于特定参数选择 $\\alpha = 50$ 和停止准则 $\\|r_k\\|_2 / \\|b\\|_2 \\le \\tau$ 中的残差容忍度 $\\tau = 1 \\times 10^{-8}$，计算相对误差 $\\|e_k\\|_2/\\|x^\\star\\|_2$ 的界 $\\kappa_2\\!\\left(A(50)\\right)\\,\\tau$。将最终数值答案四舍五入到四位有效数字，并以科学记数法的十进制形式表示。", "solution": "解答分为三个部分：首先，推导条件数 $\\kappa_2(A(\\alpha))$；其次，解释其对迭代求解器的影响；第三，进行具体的数值计算。\n\n**第一部分：2-范数条件数的推导**\n\n可逆矩阵 $A$ 的 2-范数条件数定义为 $\\kappa_2(A) = \\|A\\|_2 \\|A^{-1}\\|_2$。矩阵 $M$ 的 2-范数，记为 $\\|M\\|_2$，是其最大的奇异值 $\\sigma_{\\max}(M)$。$M$ 的奇异值是对称半正定矩阵 $M^T M$ 的特征值的平方根。\n\n给定矩阵为\n$$\nA(\\alpha) = \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix}\n$$\n其转置为\n$$\nA(\\alpha)^T = \\begin{pmatrix} 1  0 \\\\ \\alpha  1 \\end{pmatrix}\n$$\n我们首先计算乘积 $A(\\alpha)^T A(\\alpha)$：\n$$\nA(\\alpha)^T A(\\alpha) = \\begin{pmatrix} 1  0 \\\\ \\alpha  1 \\end{pmatrix} \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 1  \\alpha \\\\ \\alpha  \\alpha^2 + 1 \\end{pmatrix}\n$$\n$A(\\alpha)^T A(\\alpha)$ 的特征值 $\\lambda$ 通过求解特征方程 $\\det(A(\\alpha)^T A(\\alpha) - \\lambda I) = 0$ 得到：\n$$\n\\det \\begin{pmatrix} 1-\\lambda  \\alpha \\\\ \\alpha  \\alpha^2 + 1 - \\lambda \\end{pmatrix} = 0\n$$\n$$\n(1-\\lambda)(\\alpha^2 + 1 - \\lambda) - \\alpha^2 = 0\n$$\n$$\n\\lambda^2 - (\\alpha^2+2)\\lambda + (\\alpha^2+1) - \\alpha^2 = 0\n$$\n$$\n\\lambda^2 - (\\alpha^2+2)\\lambda + 1 = 0\n$$\n使用二次公式，特征值为：\n$$\n\\lambda = \\frac{(\\alpha^2+2) \\pm \\sqrt{(\\alpha^2+2)^2 - 4}}{2} = \\frac{\\alpha^2+2 \\pm \\sqrt{\\alpha^4 + 4\\alpha^2 + 4 - 4}}{2}\n$$\n$$\n\\lambda = \\frac{\\alpha^2+2 \\pm \\sqrt{\\alpha^4 + 4\\alpha^2}}{2} = \\frac{\\alpha^2+2 \\pm \\sqrt{\\alpha^2(\\alpha^2+4)}}{2}\n$$\n因为题目声明 $\\alpha > 0$，所以我们有 $\\sqrt{\\alpha^2} = \\alpha$。\n$$\n\\lambda = \\frac{\\alpha^2+2 \\pm \\alpha\\sqrt{\\alpha^2+4}}{2}\n$$\n设特征值为 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$。$A(\\alpha)$ 的奇异值为 $\\sigma_{\\max} = \\sqrt{\\lambda_{\\max}}$ 和 $\\sigma_{\\min} = \\sqrt{\\lambda_{\\min}}$。因此，$\\|A(\\alpha)\\|_2 = \\sigma_{\\max}$。\n逆矩阵 $A^{-1}$ 的奇异值是 $A$ 的奇异值的倒数。因此，$A(\\alpha)^{-1}$ 的奇异值是 $1/\\sigma_{\\max}$ 和 $1/\\sigma_{\\min}$。$A(\\alpha)^{-1}$ 的最大奇异值是 $1/\\sigma_{\\min}$。\n所以，$\\|A(\\alpha)^{-1}\\|_2 = 1/\\sigma_{\\min}$。\n\n于是条件数为：\n$$\n\\kappa_2(A(\\alpha)) = \\|A(\\alpha)\\|_2 \\|A(\\alpha)^{-1}\\|_2 = \\frac{\\sigma_{\\max}}{\\sigma_{\\min}} = \\frac{\\sqrt{\\lambda_{\\max}}}{\\sqrt{\\lambda_{\\min}}} = \\sqrt{\\frac{\\lambda_{\\max}}{\\lambda_{\\min}}}\n$$\n根据特征方程 $\\lambda^2 - (\\alpha^2+2)\\lambda + 1 = 0$，由韦达定理可知，两根之积为 $\\lambda_{\\max}\\lambda_{\\min} = 1$。这意味着 $\\lambda_{\\min} = 1/\\lambda_{\\max}$。\n将此代入条件数的表达式中：\n$$\n\\kappa_2(A(\\alpha)) = \\sqrt{\\frac{\\lambda_{\\max}}{1/\\lambda_{\\max}}} = \\sqrt{\\lambda_{\\max}^2} = \\lambda_{\\max}\n$$\n因此，条件数恰好是 $A(\\alpha)^T A(\\alpha)$ 的最大特征值。\n$$\n\\kappa_2(A(\\alpha)) = \\frac{\\alpha^2 + 2 + \\alpha\\sqrt{\\alpha^2+4}}{2}\n$$\n对于大的 $\\alpha$，我们可以近似这个表达式。当 $\\alpha \\to \\infty$ 时，$\\sqrt{\\alpha^2+4} \\approx \\alpha$。因此，$\\kappa_2(A(\\alpha)) \\approx \\frac{\\alpha^2+2+\\alpha^2}{2} = \\frac{2\\alpha^2+2}{2} = \\alpha^2+1$。更仔细的展开给出 $\\kappa_2(A(\\alpha)) \\approx \\alpha^2+2$。这表明条件数随 $\\alpha$呈二次方增长。\n\n**第二部分：对迭代求解器的影响**\n\n我们被要求从恒等式 $e_k = A^{-1} r_k$ 出发，其中 $e_k = x^\\star - x_k$ 是求解 $A x = b$ 的迭代方法在第 $k$ 次迭代时的误差向量，$r_k = b - A x_k$ 是残差向量。\n对该恒等式取 2-范数，我们得到 $\\|e_k\\|_2 = \\|A^{-1} r_k\\|_2$。\n根据诱导矩阵范数的定义，我们有不等式：\n$$\n\\|e_k\\|_2 \\le \\|A^{-1}\\|_2 \\|r_k\\|_2\n$$\n为了得到相对误差 $\\|e_k\\|_2/\\|x^\\star\\|_2$ 的界，我们使用 $b = A x^\\star$ 这一事实。取范数，我们得到 $\\|b\\|_2 = \\|A x^\\star\\|_2 \\le \\|A\\|_2 \\|x^\\star\\|_2$。这意味着 $1/\\|x^\\star\\|_2 \\le \\|A\\|_2/\\|b\\|_2$，假设 $x^\\star \\neq 0$。\n结合这些不等式，我们有：\n$$\n\\frac{\\|e_k\\|_2}{\\|x^\\star\\|_2} \\le \\frac{\\|A^{-1}\\|_2 \\|r_k\\|_2}{\\|x^\\star\\|_2} \\le \\|A^{-1}\\|_2 \\|r_k\\|_2 \\frac{\\|A\\|_2}{\\|b\\|_2}\n$$\n重新整理这些项，得到标准界：\n$$\n\\frac{\\|e_k\\|_2}{\\|x^\\star\\|_2} \\le \\|A\\|_2 \\|A^{-1}\\|_2 \\frac{\\|r_k\\|_2}{\\|b\\|_2} = \\kappa_2(A) \\frac{\\|r_k\\|_2}{\\|b\\|_2}\n$$\n像 GMRES 这样的 Krylov 子空间方法旨在最小化残差的范数 $\\|r_k\\|_2$。停止准则通常基于相对残差，例如，对于某个小的容忍度 $\\tau$，有 $\\|r_k\\|_2 / \\|b\\|_2 \\le \\tau$。\n\n推导出的不等式揭示了求解病态矩阵线性系统的一个关键方面。如果 $\\kappa_2(A)$ 很大，一个小的相对残差 $\\|r_k\\|_2/\\|b\\|_2$ 并不一定意味着一个小的相对误差 $\\|e_k\\|_2/\\|x^\\star\\|_2$。误差可能比残差大，其因子可达 $\\kappa_2(A)$。\n\n对于矩阵 $A(\\alpha)$，我们发现 $\\kappa_2(A(\\alpha))$ 随 $\\alpha$ 呈二次方增长。这意味着对于强平流（大 $\\alpha$），尽管其所有特征值都为 1，该矩阵却是极端病态的。这种高度非正规性导致一种情况，即像 GMRES 这样的迭代求解器，通过将相对残差降低到容忍度 $\\tau$ 来终止，其解的相对误差可能由 $\\kappa_2(A(\\alpha))\\tau$ 界定，而这个值可能仍然大到无法接受。这说明了基于残差的停止准则对于高度非正规系统的潜在不可靠性。在这种情况下，残差范数不是误差范数的忠实指标。\n\n**第三部分：数值计算**\n\n给定 $\\alpha = 50$ 和残差容忍度 $\\tau = 1 \\times 10^{-8}$。我们需要计算相对误差的上界，即 $\\kappa_2(A(50)) \\, \\tau$。\n首先，我们使用推导出的公式计算 $\\kappa_2(A(50))$：\n$$\n\\kappa_2(A(50)) = \\frac{50^2 + 2 + 50\\sqrt{50^2+4}}{2} = \\frac{2500 + 2 + 50\\sqrt{2500+4}}{2}\n$$\n$$\n\\kappa_2(A(50)) = \\frac{2502 + 50\\sqrt{2504}}{2} = 1251 + 25\\sqrt{2504}\n$$\n现在，我们计算数值：\n$$\n\\sqrt{2504} \\approx 50.03998401\n$$\n$$\n\\kappa_2(A(50)) \\approx 1251 + 25 \\times 50.03998401 = 1251 + 1250.99960025 = 2501.99960025\n$$\n相对误差的界是：\n$$\n\\kappa_2(A(50)) \\, \\tau \\approx 2501.99960025 \\times (1 \\times 10^{-8}) \\approx 2.50199960025 \\times 10^{-5}\n$$\n我们被要求将此结果四舍五入到四位有效数字。前四位有效数字是 $2, 5, 0, 1$。第五位有效数字是 $9$，这意味着我们必须将第四位数字向上取整。\n将 $2.5019...$ 四舍五入到四位有效数字得到 $2.502$。\n最终结果以科学记数法表示为 $2.502 \\times 10^{-5}$。", "answer": "$$\\boxed{2.502 \\times 10^{-5}}$$", "id": "3372780"}, {"introduction": "关于条件数的理论见解具有深远的实际影响，最终限制了我们能够计算的范围。这最后一个计算练习通过检验二维泊松方程，将理论与实践联系起来。我们将确定在何种网格分辨率下，问题由于标准的浮点算术精度而变得无法求解，然后展示预处理技术如何能有效地控制病态问题，从而使那些原本难以处理的问题变得可解。[@problem_id:3372810]", "problem": "考虑单位正方形上的模型椭圆偏微分方程（PDE）泊松问题 $-\\Delta u = f$，其带有齐次狄利克雷边界条件。令 $A_h$ 表示在 $n \\times n$ 内部网格上使用标准五点差分格式对负拉普拉斯算子进行的有限差分离散化，网格间距为 $h = 1/(n+1)$；由此产生的线性系统为 $A_h x = b$。矩阵 $A_h$ 是对称正定的。在有限精度算术中求解 $A_h x = b$ 的敏感性由谱范数（欧几里得范数）下的条件数 $\\kappa_2(A_h)$决定，其定义为 $\\kappa_2(A_h) = \\|A_h\\|_2 \\|A_h^{-1}\\|_2$，对于对称正定矩阵，它等于最大特征值与最小特征值之比。机器精度由机器ε $\\epsilon_{\\mathrm{mach}}$ 来表征，它是在浮点运算中使 $1 + \\epsilon_{\\mathrm{mach}} \\neq 1$ 成立的最小正数。在共轭梯度（CG）法中，有限精度会导致搜索方向上正交性的丧失，以及一个可达到的精度极限，该极限与 $\\kappa_2(A_h)\\,\\epsilon_{\\mathrm{mach}}$ 成比例。从以下基本依据出发：通过五点差分格式对离散算子 $A_h$ 的定义，以及谱条件数和机器ε的定义。推导二维狄利克雷问题中 $\\kappa_2(A_h)$ 对 $h$ 的渐近依赖关系，并用它来确定网格间距 $h$，在该间距下 $\\kappa_2(A_h) \\approx 1/\\epsilon_{\\mathrm{mach}}$，这对应于舍入误差导致基本上所有有效数字都丢失的阈值。为 IEEE 754 双精度和由 long double 类型表示的扩展精度量化这些阈值。此外，分析简单对角缩放（雅可比均衡）$\\tilde{A}_h = D^{-1/2} A_h D^{-1/2}$（其中 $D = \\mathrm{diag}(A_h)$）对此算子条件数的影响，并评估一个移位预处理器 $M = A_h + \\alpha I$ 作为右预处理器，即分析 $M^{-1} A_h$ 的谱以减轻敏感性。\n\n您的任务是：\n\n1. 对给定的 $n$，使用五点差分格式和 $h = 1/(n+1)$ 显式地将 $A_h$ 构造为稀疏矩阵。数值计算其最小和最大特征值，从而计算 $\\kappa_2(A_h)$。\n\n2. 从离散算子的结构及其谱出发，推导渐近标度关系 $\\kappa_2(A_h) \\sim c\\,h^{-2}$，其中常数 $c  0$。使用此渐近关系计算由 $\\kappa_2(A_{h^\\star}) = 1/\\epsilon$ 定义的阈值网格间距 $h^\\star(\\epsilon)$，针对两种机器精度：IEEE 754 双精度和您环境中的 long double 精度。将 $h^\\star$ 表示为浮点数。\n\n3. 对于 $n = 32$ 的代表性网格，数值计算 $\\kappa_2(A_h)$，然后使用启发式公式 $d(\\epsilon) = \\max\\{0,-\\log_{10}(\\kappa_2(A_h)\\,\\epsilon)\\}$ 估计在无预处理的理想共轭梯度法下可达到的解中可信十进制数字的位数。计算双精度和 long double 精度下的 $d(\\epsilon)$。将 $d(\\epsilon)$ 表示为浮点数。\n\n4. 通过构建 $\\tilde{A}_h = D^{-1/2}A_hD^{-1/2}$ 来分析使用 $D = \\mathrm{diag}(A_h)$ 的对角缩放。确定此缩放是否改变该算子的 $\\kappa_2$，并报告一个布尔值以指示变化（如果 $\\kappa_2$ 改变则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$）。\n\n5. 考虑右预处理算子 $M^{-1}A_h$，其中 $M = A_h + \\alpha I$ 且 $\\alpha  0$。证明 $M^{-1}A_h$ 的特征值为 $\\lambda_i/( \\lambda_i + \\alpha)$，其中 $\\lambda_i$ 是 $A_h$ 的特征值。使用为 $n=32$ 数值计算的极端特征值，评估当选择 $\\alpha = \\lambda_{\\min}(A_h)$ 时 $M^{-1}A_h$ 的条件数，并计算相应的双精度下的 $d(\\epsilon)$。将这些值表示为浮点数。\n\n角度单位不适用，并且此问题中没有物理单位。\n\n测试套件：\n- 情况1（正常路径）：$n = 32$ 用于数值特征值和条件数计算。\n- 情况2（边界阈值）：根据渐近分析计算 IEEE 754 双精度和 long double 精度的 $h^\\star$。\n- 情况3（边界情况缓解）：在 $n=32$ 时使用 $\\alpha = \\lambda_{\\min}(A_h)$ 进行预处理及其对条件数和数字位数的影响。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，结果按以下顺序排列：\n$[h^\\star_{\\text{double}}, h^\\star_{\\text{longdouble}}, n=32 \\text{ 时的 } \\kappa_2(A_h), n=32 \\text{ 时的 } d_{\\text{double}}, n=32 \\text{ 时的 } d_{\\text{longdouble}}, \\text{JacobiChanges}, \\alpha=\\lambda_{\\min} \\text{ 时的 } \\kappa_2(M^{-1}A_h), d_{\\text{double,pre}}]$。\n除 $\\text{JacobiChanges}$ 必须为布尔值外，每个条目都必须是浮点数。", "solution": "该问题研究了由单位正方形上带有齐次狄利克雷边界条件的泊松方程 $-\\Delta u = f$ 的五点有限差分离散化所产生的线性系统 $A_h x = b$ 的敏感性。该敏感性通过谱条件数 $\\kappa_2(A_h)$ 来量化。\n\n**1. 矩阵构造和数值条件数**\n\n离散算子 $A_h$ 作用于一个按字典序排列的未知网格值向量。对于一个 $n \\times n$ 的内部点网格，网格间距为 $h = 1/(n+1)$，未知数的总数为 $N = n^2$。在网格点 $(i,j)$ 处，负拉普拉斯算子的五点差分格式由下式给出：\n$$\n(-\\Delta u)_{i,j} \\approx \\frac{1}{h^2} (4u_{i,j} - u_{i-1,j} - u_{i+1,j} - u_{i,j-1} - u_{i,j+1})\n$$\n这种结构产生一个大小为 $n^2 \\times n^2$ 的块三对角矩阵 $A_h$。一种更优雅的构造方法是利用克罗内克积。令 $I_n$ 为 $n \\times n$ 的单位矩阵，$T_n$ 为表示一维二阶导数的 $n \\times n$ 三对角矩阵：\n$$\nT_n = \\begin{pmatrix}\n2  -1   \\\\\n-1  2  \\ddots  \\\\\n  \\ddots  \\ddots  -1 \\\\\n   -1  2\n\\end{pmatrix}\n$$\n矩阵 $A_h$ 则由下式给出：\n$$\nA_h = \\frac{1}{h^2} (I_n \\otimes T_n + T_n \\otimes I_n)\n$$\n对于像 $A_h$ 这样的对称正定矩阵，谱条件数是其最大特征值与最小特征值之比，即 $\\kappa_2(A_h) = \\lambda_{\\max}(A_h) / \\lambda_{\\min}(A_h)$。对于 $n=32$，我们构造这个 $1024 \\times 1024$ 的矩阵，并数值计算其极端特征值。\n\n**2. 渐近分析和阈值网格间距 $h^\\star$**\n\n$T_n$ 的特征值为 $\\mu_k = 2 - 2\\cos(k\\pi/(n+1)) = 2 - 2\\cos(k\\pi h)$，其中 $k = 1, \\dots, n$。因此，$A_h$ 的特征值可以解析地得到：\n$$\n\\lambda_{k,j} = \\frac{1}{h^2} (\\mu_k + \\mu_j) = \\frac{1}{h^2} (4 - 2\\cos(k\\pi h) - 2\\cos(j\\pi h)) \\quad \\text{其中 } k,j = 1, \\dots, n.\n$$\n最小特征值 $\\lambda_{\\min}$ 对应于最低频率，即 $(k,j)=(1,1)$：\n$$\n\\lambda_{\\min} = \\lambda_{1,1} = \\frac{1}{h^2} (4 - 4\\cos(\\pi h))\n$$\n对小的 $x$（即小的 $h$）使用泰勒展开 $\\cos(x) \\approx 1 - x^2/2$，我们得到：\n$$\n\\lambda_{\\min} \\approx \\frac{1}{h^2} \\left(4 - 4\\left(1 - \\frac{(\\pi h)^2}{2}\\right)\\right) = \\frac{2\\pi^2 h^2}{h^2} = 2\\pi^2\n$$\n最大特征值 $\\lambda_{\\max}$ 对应于最高频率，即 $(k,j)=(n,n)$：\n$$\n\\lambda_{\\max} = \\lambda_{n,n} = \\frac{1}{h^2} (4 - 2\\cos(n\\pi h) - 2\\cos(n\\pi h)) = \\frac{1}{h^2}(4 - 4\\cos(n\\pi h))\n$$\n因为 $h=1/(n+1)$，我们有 $n\\pi h = n\\pi/(n+1) = \\pi - \\pi/(n+1) = \\pi - \\pi h$。因此，$\\cos(n\\pi h) = \\cos(\\pi - \\pi h) = -\\cos(\\pi h)$。\n$$\n\\lambda_{\\max} = \\frac{1}{h^2} (4 + 4\\cos(\\pi h)) \\approx \\frac{1}{h^2} (4 + 4(1)) = \\frac{8}{h^2}\n$$\n当 $h \\to 0$ 时，条件数的渐近行为是：\n$$\n\\kappa_2(A_h) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} \\approx \\frac{8/h^2}{2\\pi^2} = \\frac{4}{\\pi^2 h^2} = c h^{-2} \\quad \\text{其中 } c = \\frac{4}{\\pi^2}\n$$\n阈值网格间距 $h^\\star$ 由 $\\kappa_2(A_{h^\\star}) = 1/\\epsilon_{\\mathrm{mach}}$ 定义。使用渐近公式：\n$$\n\\frac{4}{\\pi^2 (h^\\star)^2} = \\frac{1}{\\epsilon_{\\mathrm{mach}}} \\implies (h^\\star)^2 = \\frac{4 \\epsilon_{\\mathrm{mach}}}{\\pi^2} \\implies h^\\star(\\epsilon_{\\mathrm{mach}}) = \\frac{2\\sqrt{\\epsilon_{\\mathrm{mach}}}}{\\pi}\n$$\n我们为 IEEE 754 双精度（$\\epsilon_{\\text{double}}$）和可用的 long double 精度（$\\epsilon_{\\text{longdouble}}$）计算这个值，其具体数值取决于执行环境。\n\n**3. 共轭梯度法中的可信数字位数**\n\n通过像共轭梯度（CG）这样的迭代方法计算出的解中，可信十进制数字的位数可以用启发式方法估计。解的相对误差通常受一个与 $\\kappa_2(A_h)\\epsilon_{\\mathrm{mach}}$ 成比例的项的限制。因此，丢失的数字位数与 $\\log_{10}(\\kappa_2(A_h)\\epsilon_{\\mathrm{mach}})$ 相关。一个常用的可信数字位数 $d(\\epsilon)$ 的启发式公式是：\n$$\nd(\\epsilon) = \\max\\{0, -\\log_{10}(\\kappa_2(A_h)\\epsilon)\\}\n$$\n我们使用为 $n=32$ 数值计算的 $\\kappa_2(A_h)$ 值以及双精度和 long double 精度的机器ε值来应用此公式。\n\n**4. 对角缩放（雅可比均衡）**\n\n对角缩放，或称为雅可比均衡，是一种预处理技术，其中缩放后的矩阵为 $\\tilde{A}_h = D^{-1/2}A_hD^{-1/2}$，且 $D = \\mathrm{diag}(A_h)$。对于均匀网格上的标准五点差分格式， $A_h$ 的每个对角线元素都对应于中心节点 $u_{i,j}$ 的系数，该系数统一为 $4/h^2$。因此，$D$ 是单位矩阵的一个标量倍数：\n$$\nD = \\frac{4}{h^2} I\n$$\n因此，$D^{-1/2} = (\\sqrt{h^2/4})I = (h/2)I$。缩放后的矩阵是：\n$$\n\\tilde{A}_h = \\left(\\frac{h}{2}I\\right) A_h \\left(\\frac{h}{2}I\\right) = \\frac{h^2}{4} A_h\n$$\n由于 $\\tilde{A}_h$ 是 $A_h$ 的一个标量倍数，其特征值为 $\\tilde{\\lambda}_i = (h^2/4)\\lambda_i$。条件数在标量乘法下是不变的：\n$$\n\\kappa_2(\\tilde{A}_h) = \\frac{\\tilde{\\lambda}_{\\max}}{\\tilde{\\lambda}_{\\min}} = \\frac{(h^2/4)\\lambda_{\\max}}{(h^2/4)\\lambda_{\\min}} = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\kappa_2(A_h)\n$$\n对于这个特定的算子，雅可比缩放对条件数没有影响。因此，所要求的布尔值 `JacobiChanges` 为 `False`。\n\n**5. 移位预处理器分析**\n\n我们分析右预处理算子 $P = M^{-1}A_h$，其中预处理器为 $M = A_h + \\alpha I$ 且 $\\alpha > 0$。$A_h$ 的特征值为 $\\lambda_i$，对应的特征向量为 $v_i$。由于 $A_h$ 和 $I$ 可交换，它们共享相同的特征向量。因此，$v_i$ 也是 $M$ 的一个特征向量：\n$$\nM v_i = (A_h + \\alpha I) v_i = A_h v_i + \\alpha v_i = (\\lambda_i + \\alpha) v_i\n$$\n$P$ 对特征向量 $v_i$ 的作用是：\n$$\nP v_i = M^{-1}A_h v_i = M^{-1}(\\lambda_i v_i) = \\lambda_i M^{-1}v_i = \\lambda_i \\frac{1}{\\lambda_i + \\alpha} v_i\n$$\n预处理后矩阵 $P$ 的特征值为 $\\mu_i = \\frac{\\lambda_i}{\\lambda_i + \\alpha}$。函数 $f(x) = x/(x+\\alpha)$ 在 $x > 0$ 和 $\\alpha>0$ 时是单调递增的。\n当选择 $\\alpha = \\lambda_{\\min}(A_h)$ 时，新的特征值为：\n$$\n\\mu_{\\min} = \\frac{\\lambda_{\\min}}{\\lambda_{\\min} + \\alpha} = \\frac{\\lambda_{\\min}}{\\lambda_{\\min} + \\lambda_{\\min}} = \\frac{1}{2}\n$$\n$$\n\\mu_{\\max} = \\frac{\\lambda_{\\max}}{\\lambda_{\\max} + \\alpha} = \\frac{\\lambda_{\\max}}{\\lambda_{\\max} + \\lambda_{\\min}}\n$$\n预处理后系统的条件数为：\n$$\n\\kappa_2(P) = \\frac{\\mu_{\\max}}{\\mu_{\\min}} = \\frac{\\lambda_{\\max}/(\\lambda_{\\max} + \\lambda_{\\min})}{1/2} = \\frac{2\\lambda_{\\max}}{\\lambda_{\\max} + \\lambda_{\\min}} = \\frac{2(\\lambda_{\\max}/\\lambda_{\\min})}{(\\lambda_{\\max}/\\lambda_{\\min}) + 1} = \\frac{2\\kappa_2(A_h)}{\\kappa_2(A_h)+1}\n$$\n这个变换将一个大的条件数 $\\kappa_2(A_h) \\gg 1$ 映射到一个接近 $2$ 的值，这是一个显著的改进。我们使用数值方法找到的极端特征值为 $n=32$ 计算这个新的条件数，并计算相应的双精度下的可信数字位数。", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import diags, kron, identity\nfrom scipy.sparse.linalg import eigsh\n\ndef solve():\n    \"\"\"\n    Computes various metrics related to the condition number of the finite difference\n    discretization of the 2D Poisson equation.\n    \"\"\"\n    # Define parameters for the main numerical case\n    n = 32\n\n    # Get machine precisions for double and long double floating point types.\n    # Note: The precision of np.longdouble is platform-dependent and may be\n    # equivalent to np.float64 on some systems.\n    eps_double = np.finfo(np.float64).eps\n    eps_longdouble = npfinfo(np.longdouble).eps\n\n    # ---- Task 2: Asymptotic threshold h_star ----\n    # Derive h_star from kappa_2(A_h) = 4 / (pi^2 * h^2) = 1/epsilon\n    # h_star = 2 * sqrt(epsilon) / pi\n    h_star_double = (2.0 * np.sqrt(eps_double)) / np.pi\n    h_star_longdouble = (2.0 * np.sqrt(eps_longdouble)) / np.pi\n\n    # ---- Numerical computations for n=32 ----\n    h = 1.0 / (n + 1)\n    h_sq = h**2\n\n    # ---- Task 1: Construct A_h and compute its condition number ----\n    # Create the 1D discrete Laplacian matrix T_n\n    diagonals = [-1.0 * np.ones(n - 1), 2.0 * np.ones(n), -1.0 * np.ones(n - 1)]\n    offsets = [-1, 0, 1]\n    T_n = diags(diagonals, offsets, shape=(n, n), format='csr')\n    \n    # Create the 2D discrete Laplacian A_h using Kronecker products\n    I_n = identity(n, format='csr')\n    A_h_unscaled = kron(I_n, T_n) + kron(T_n, I_n)\n    A_h = (1.0 / h_sq) * A_h_unscaled\n\n    # Compute extreme eigenvalues (smallest and largest) of A_h.\n    # For a sparse SPD matrix, eigsh with which='BE' (Both Ends) is efficient.\n    # It returns k/2 smallest and k/2 largest eigenvalues. For k=2, this is\n    # the smallest and the largest.\n    try:\n        # eigsh returns eigenvalues in ascending order.\n        eigenvalues = eigsh(A_h, k=2, which='BE', return_eigenvectors=False)\n        lambda_min_A = eigenvalues[0]\n        lambda_max_A = eigenvalues[1]\n    except Exception as e:\n        # Fallback in case 'BE' is not supported or fails, though it should not.\n        # This is more robust.\n        lambda_min_val = eigsh(A_h, k=1, which='SA', return_eigenvectors=False)\n        lambda_max_val = eigsh(A_h, k=1, which='LA', return_eigenvectors=False)\n        lambda_min_A = lambda_min_val[0]\n        lambda_max_A = lambda_max_val[0]\n\n    # Compute the condition number of A_h\n    kappa_A_h = lambda_max_A / lambda_min_A\n\n    # ---- Task 3: Compute trustworthy digits for the original system ----\n    # d(eps) = max(0, -log10(kappa * eps))\n    arg_double = kappa_A_h * eps_double\n    arg_longdouble = kappa_A_h * eps_longdouble\n\n    d_double = max(0.0, -np.log10(arg_double))\n    d_longdouble = max(0.0, -np.log10(arg_longdouble))\n\n    # ---- Task 4: Analyze Jacobi (diagonal) scaling ----\n    # As derived in the solution, for this specific constant-diagonal operator,\n    # Jacobi scaling is equivalent to scalar multiplication and does not change\n    # the condition number.\n    JacobiChanges = False\n\n    # ---- Task 5: Analyze shifted preconditioning ----\n    # Preconditioner M = A_h + alpha*I, with alpha = lambda_min(A_h)\n    alpha = lambda_min_A\n    \n    # The condition number of M_inv * A_h is kappa_new = (2*kappa) / (kappa+1)\n    kappa_M_inv_A = (2.0 * kappa_A_h) / (kappa_A_h + 1.0)\n    # Direct computation from eigenvalues:\n    # kappa_M_inv_A = (2 * lambda_max_A) / (lambda_max_A + lambda_min_A)\n\n    # Compute trustworthy digits for the preconditioned system\n    arg_pre_double = kappa_M_inv_A * eps_double\n    d_double_pre = max(0.0, -np.log10(arg_pre_double))\n    \n    # ---- Final Output Assembly ----\n    # Assemble results in the specified order.\n    results = [\n        h_star_double,\n        h_star_longdouble,\n        kappa_A_h,\n        d_double,\n        d_longdouble,\n        JacobiChanges,\n        kappa_M_inv_A,\n        d_double_pre\n    ]\n\n    # Format the final output string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3372810"}]}