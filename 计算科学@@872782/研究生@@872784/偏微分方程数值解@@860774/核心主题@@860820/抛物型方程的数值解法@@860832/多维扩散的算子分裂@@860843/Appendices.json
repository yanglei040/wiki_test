{"hands_on_practices": [{"introduction": "我们首先从一个基本但至关重要的实践开始：验证数值代码的正确性。在开发复杂的模拟程序时，我们如何确保代码准确地求解了它应该求解的偏微分方程？“人造解方法”（Method of Manufactured Solutions, MMS）提供了一个严谨的答案。通过预先设定一个解析解，我们可以反推出一个源项，从而创建一个具有已知精确解的测试问题。这个练习 [@problem_id:3427454] 将指导你完成这一过程，并让你思考 Strang-ADI 方法的预期时间收敛阶，将理论精度与实际验证联系起来。", "problem": "考虑在单位正方形 $\\Omega=(0,1)\\times(0,1)$ 上的二维空间线性各向异性扩散方程，其具有齐次狄利克雷边界条件和一个光滑源项：\n$$\nu_{t} = a\\,u_{xx} + b\\,u_{yy} + f(x,y,t), \\quad (x,y)\\in\\Omega,\\ t0,\n$$\n$$\nu(x,y,t)=0 \\text{ for } (x,y)\\in\\partial\\Omega,\\ t\\ge 0,\n$$\n以及初始条件\n$$\nu(x,y,0) = \\sin(\\pi x)\\sin(2\\pi y).\n$$\n令各向异性系数为 $a=1$ 和 $b=4$。你将使用人造解方法，通过指定精确解\n$$\nu(x,y,t) = \\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y),\n$$\n来确定强迫项 $f(x,y,t)$，使得 $u$ 精确地满足该偏微分方程以及边界和初始条件。\n\n此外，考虑通过Strang交替方向隐式 (ADI) 算子分裂在时间上推进解，其中将 $a\\,u_{xx}$ 和 $b\\,u_{yy}$ 视为分裂算子。假设所有空间离散化都具有足够高的阶数，以至于时间精度占主导地位，并假设精确解足够光滑以证明形式时间阶的合理性。陈述在这种线性情况下，Strang-ADI 时间离散化的预期理论时间精度阶 $r$。\n\n将你的最终答案以一个双元素行向量的形式报告，其第一个元素是 $f(x,y,t)$ 的闭式解析表达式，第二个元素是整数时间阶 $r$。不需要四舍五入，也不涉及单位。", "solution": "该问题由两部分组成。第一部分是为一个给定的偏微分方程（PDE）和一个指定的“人造”解 $u(x,y,t)$ 确定强迫项 $f(x,y,t)$。第二部分是陈述应用于此PDE的Strang交替方向隐式（ADI）方法的理论时间精度阶。\n\n首先，我将验证问题陈述。\n提取所有给定条件并检查其一致性。\nPDE为 $u_{t} = a\\,u_{xx} + b\\,u_{yy} + f(x,y,t)$，其中 $a=1$，$b=4$。\n区域为 $\\Omega=(0,1)\\times(0,1)$，具有齐次狄利克雷边界条件 $u(x,y,t)=0$ 对于 $(x,y)\\in\\partial\\Omega$。\n初始条件为 $u(x,y,0) = \\sin(\\pi x)\\sin(2\\pi y)$。\n指定的解为 $u(x,y,t) = \\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)$。\n我们来检查一致性。\n当 $t=0$ 时，指定的解为 $u(x,y,0) = \\exp(-0)\\,\\sin(\\pi x)\\,\\sin(2\\pi y) = \\sin(\\pi x)\\sin(2\\pi y)$，与初始条件相符。\n在 $\\Omega$ 的边界上：\n当 $x=0$ 时：$u(0,y,t) = \\exp(-t)\\,\\sin(0)\\,\\sin(2\\pi y) = 0$。\n当 $x=1$ 时：$u(1,y,t) = \\exp(-t)\\,\\sin(\\pi)\\,\\sin(2\\pi y) = 0$。\n当 $y=0$ 时：$u(x,0,t) = \\exp(-t)\\,\\sin(\\pi x)\\,\\sin(0) = 0$。\n当 $y=1$ 时：$u(x,1,t) = \\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi) = 0$。\n所有边界和初始条件都由指定的解满足。该问题具有科学依据，是适定的，并且不包含矛盾或歧义。该问题是有效的。\n\n第一部分：确定强迫项 $f(x,y,t)$。\n强迫项 $f(x,y,t)$ 可以从PDE中分离出来：\n$$\nf(x,y,t) = u_t - a\\,u_{xx} - b\\,u_{yy}\n$$\n我们需要计算指定解 $u(x,y,t) = \\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)$ 的偏导数。\n\n关于时间 $t$ 的偏导数是：\n$$\nu_t = \\frac{\\partial}{\\partial t}\\left(\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\\right) = -\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\n$$\n关于 $x$ 的一阶和二阶偏导数是：\n$$\nu_x = \\frac{\\partial}{\\partial x}\\left(\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\\right) = \\pi\\exp(-t)\\,\\cos(\\pi x)\\,\\sin(2\\pi y)\n$$\n$$\nu_{xx} = \\frac{\\partial}{\\partial x}\\left(\\pi\\exp(-t)\\,\\cos(\\pi x)\\,\\sin(2\\pi y)\\right) = -\\pi^2\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\n$$\n关于 $y$ 的一阶和二阶偏导数是：\n$$\nu_y = \\frac{\\partial}{\\partial y}\\left(\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\\right) = 2\\pi\\exp(-t)\\,\\sin(\\pi x)\\,\\cos(2\\pi y)\n$$\n$$\nu_{yy} = \\frac{\\partial}{\\partial y}\\left(2\\pi\\exp(-t)\\,\\sin(\\pi x)\\,\\cos(2\\pi y)\\right) = -4\\pi^2\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\n$$\n现在，将这些导数以及系数 $a=1$ 和 $b=4$ 代入 $f(x,y,t)$ 的表达式中：\n$$\nf(x,y,t) = \\left(-\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\\right) - (1)\\left(-\\pi^2\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\\right) - (4)\\left(-4\\pi^2\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\\right)\n$$\n我们可以提取公因式 $\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)$：\n$$\nf(x,y,t) = \\left(-1 - (-\\pi^2) - 4(-4\\pi^2)\\right)\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\n$$\n$$\nf(x,y,t) = \\left(-1 + \\pi^2 + 16\\pi^2\\right)\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\n$$\n$$\nf(x,y,t) = \\left(17\\pi^2 - 1\\right)\\exp(-t)\\,\\sin(\\pi x)\\,\\sin(2\\pi y)\n$$\n这是强迫项的闭式解析表达式。\n\n第二部分：Strang-ADI的时间精度阶 $r$。\n给定的PDE形式为 $u_t = \\mathcal{L}u + f$，其中线性算子 $\\mathcal{L}$ 被分裂为两部分，$\\mathcal{L} = \\mathcal{L}_x + \\mathcal{L}_y$，其中 $\\mathcal{L}_x = a\\frac{\\partial^2}{\\partial x^2}$ 和 $\\mathcal{L}_y = b\\frac{\\partial^2}{\\partial y^2}$。\n\n算子分裂法通过求解一系列更简单的子问题来逼近完整方程的解。Strang分裂是步骤的对称组合，对于大小为 $\\Delta t$ 的时间步长，可以写为：\n$$\nu^{n+1} \\approx \\mathcal{S}_x(\\Delta t/2) \\mathcal{S}_y(\\Delta t) \\mathcal{S}_x(\\Delta t/2) u^n\n$$\n其中 $\\mathcal{S}_x(\\tau)$ 和 $\\mathcal{S}_y(\\tau)$ 是子问题 $u_t = \\mathcal{L}_x u$ 和 $u_t = \\mathcal{L}_y u$ 在时间间隔 $\\tau$ 内的演化算子。\n\n这种对称组合确保了该方法在时间上是二阶精确的，前提是单个传播子 $\\mathcal{S}_x$ 和 $\\mathcal{S}_y$ 至少是一阶精确的。在ADI方法的背景下，每个子步骤通常使用Crank-Nicolson方法求解，该方法本身是二阶精确的。对于大小为 $\\tau$ 的步长，Crank-Nicolson传播子是精确指数算子的一个近似，其误差为 $O(\\tau^3)$ 阶。\n$$\n\\mathcal{S}_{\\text{CN}}(\\tau) = \\exp(\\tau \\mathcal{L}) + O(\\tau^3)\n$$\nStrang分裂组合的局部截断误差可以通过算子指数的泰勒级数展开找到。组合 $e^{\\Delta t/2 A} e^{\\Delta t B} e^{\\Delta t/2 A}$ 与 $e^{\\Delta t(A+B)}$ 的展开式在 $(\\Delta t)^2$ 阶项之前都相匹配。第一个误差项是 $(\\Delta t)^3$ 阶的，与算子 $A$ 和 $B$ 的对易子有关。因此，Strang分裂法的局部截断误差为 $O((\\Delta t)^3)$。\n\n对于一个局部截断误差为 $p+1$ 阶的数值方法，其全局误差为 $p$ 阶。因此，对于局部截断误差为 $O((\\Delta t)^3)$ 的情况，Strang分裂法的全局时间精度阶为 $2$。\n这对于线性问题普遍成立，无论算子 $\\mathcal{L}_x$ 和 $\\mathcal{L}_y$ 是否可交换。在这个特定问题中，由于算子包含对不同自变量（以及常数系数）的偏导数，它们是可交换的：对于足够光滑的 $u$，有 $\\mathcal{L}_x\\mathcal{L}_y u = \\mathcal{L}_y\\mathcal{L}_x u$。这种可交换性简化了分析并证实了二阶精度，但它并非Strang分裂法达到二阶精度的必要条件。\n\n因此，预期的理论时间精度阶 $r$ 为 $2$。\n\n最终答案由两部分组成：$f(x,y,t)$ 的表达式和 $r$ 的整数值。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n(17\\pi^2 - 1)\\exp(-t)\\sin(\\pi x)\\sin(2\\pi y)  2\n\\end{pmatrix}\n}\n$$", "id": "3427454"}, {"introduction": "虽然隐式方法因其优越的稳定性而备受青睐，但其具体实现细节却至关重要。一个数值格式仅仅稳定是不够的，我们还需要理解其稳定性的边界在哪里，尤其是在混合使用不同格式时。这个练习 [@problem_id:3427455] 探究了一种混合 ADI 格式，其中一个空间方向采用显式欧拉法处理，而另一个方向采用隐式欧拉法。通过 von Neumann (傅里叶) 分析，你将推导出该格式保持稳定的精确条件，从而揭示整个计算过程的稳定性是由其最薄弱的环节（即显式部分）决定的深刻原理。", "problem": "考虑在一个矩形环面（双向周期）上的二维各向异性扩散方程，\n$$\n\\frac{\\partial u}{\\partial t} \\;=\\; \\kappa_{x}\\,\\frac{\\partial^{2} u}{\\partial x^{2}} \\;+\\; \\kappa_{y}\\,\\frac{\\partial^{2} u}{\\partial y^{2}},\n$$\n其中 $\\kappa_{x}0$ 和 $\\kappa_{y}0$ 是常数扩散系数。设空间域通过均匀网格离散化，在 $x$ 方向和 $y$ 方向的间距分别为 $h_{x}$ 和 $h_{y}$，并用标准的二阶中心差分近似空间二阶导数，使得离散算子 $L_{x}$ 和 $L_{y}$ 通过以下方式作用于网格函数 $\\{u_{i,j}\\}$：\n$$\n(L_{x} u)_{i,j} \\;=\\; \\frac{u_{i+1,j} - 2 u_{i,j} + u_{i-1,j}}{h_{x}^{2}}, \n\\qquad\n(L_{y} u)_{i,j} \\;=\\; \\frac{u_{i,j+1} - 2 u_{i,j} + u_{i,j-1}}{h_{y}^{2}}.\n$$\n定义一个大小为 $\\Delta t$ 的时间步，采用交替方向隐式（ADI）类型的算子分裂方法，该方法对 $x$ 方向的扩散分数步使用显式欧拉法，对 $y$ 方向的扩散分数步使用隐式欧拉法，每步作用于大小为 $\\Delta t/2$ 的半步：\n$$\n\\text{步骤 A（$x$ 方向显式）：}\\quad w^{n+\\frac{1}{2}} \\;=\\; u^{n} \\;+\\; \\frac{\\Delta t}{2}\\,\\kappa_{x}\\,L_{x} u^{n},\n$$\n$$\n\\text{步骤 B（$y$ 方向隐式）：}\\quad \\bigl(I \\;-\\; \\frac{\\Delta t}{2}\\,\\kappa_{y}\\,L_{y}\\bigr)\\,u^{n+1} \\;=\\; w^{n+\\frac{1}{2}}.\n$$\n假设双向均为周期性边界条件，并使用冯·诺依曼（傅里葉）分析法及平面波模态来评估线性稳定性。确定一个闭式解析表达式，表示最大的允许时间步长 $\\Delta t_{\\max}$，使得对于所有傅里葉模态，单步放大因子的模至多为 $1$。你的答案必须仅用 $\\kappa_{x}$ 和 $h_{x}$ 的符号表示。不需要进行数值计算。", "solution": "问题陈述已经过验证，并被认定为有效。它具有科学依据，是适定的、客观的，并包含推导出唯一解而无矛盾所需的所有必要信息。我们可以开始求解。\n\n该问题要求对给定的二维各向异性扩散方程的算子分裂格式进行线性稳定性分析。按要求，选择的方法是冯·诺依曼（或傅里葉）分析法。我们考虑网格上数值解的一个单一平面波模态，其形式为：\n$$\nu_{i,j}^{n} = g^{n} \\exp(\\mathrm{i}(k_x i h_x + k_y j h_y))\n$$\n其中 $n$ 是时间层索引，$(i,j)$ 是空间网格索引，$g$ 是一个时间步 $\\Delta t$ 的复放大因子，$\\mathrm{i} = \\sqrt{-1}$ 是虚数单位，$k_x$ 和 $k_y$ 分别是 $x$ 和 $y$ 方向的波数。为方便起见，我们定义无量纲相位角 $\\theta_x = k_x h_x$ 和 $\\theta_y = k_y h_y$。于是模态的空间部分为 $\\exp(\\mathrm{i}(i\\theta_x + j\\theta_y))$。如果放大因子的模对于所有可能的实波数（对应于 $\\theta_x \\in [-\\pi, \\pi]$ 和 $\\theta_y \\in [-\\pi, \\pi]$）都满足 $|g| \\leq 1$，则数值格式的稳定性得到保证。\n\n首先，我们确定离散空间算子 $L_x$ 和 $L_y$ 对此傅里葉模态的作用。\n对于算子 $L_x$：\n$$\n(L_x u)_{i,j} = \\frac{u_{i+1,j} - 2 u_{i,j} + u_{i-1,j}}{h_{x}^{2}}\n$$\n代入 $u_{i,j} = \\exp(\\mathrm{i}(i\\theta_x + j\\theta_y))$：\n$$\n(L_x u)_{i,j} = \\frac{\\exp(\\mathrm{i}((i+1)\\theta_x + j\\theta_y)) - 2\\exp(\\mathrm{i}(i\\theta_x + j\\theta_y)) + \\exp(\\mathrm{i}((i-1)\\theta_x + j\\theta_y))}{h_x^2}\n$$\n$$\n(L_x u)_{i,j} = \\frac{\\exp(\\mathrm{i}\\theta_x) - 2 + \\exp(-\\mathrm{i}\\theta_x)}{h_x^2} u_{i,j} = \\frac{2\\cos(\\theta_x) - 2}{h_x^2} u_{i,j}\n$$\n使用恒等式 $1 - \\cos(\\theta_x) = 2\\sin^2(\\theta_x/2)$，我们找到算子 $L_x$ 的符号（特征值）$\\hat{L}_x$：\n$$\n\\hat{L}_x(\\theta_x) = -\\frac{4}{h_x^2} \\sin^2\\left(\\frac{\\theta_x}{2}\\right)\n$$\n通过完全相同的论证，算子 $L_y$ 的符号为：\n$$\n\\hat{L}_y(\\theta_y) = -\\frac{4}{h_y^2} \\sin^2\\left(\\frac{\\theta_y}{2}\\right)\n$$\n\n接下来，我们将这些算子应用于两步时间推进格式。设 $\\hat{u}^n$ 表示在时间层 $n$ 的解的傅里葉振幅。\n步骤 A 是针对 $x$ 方向扩散的显式欧拉半步：\n$$\nw^{n+\\frac{1}{2}} = u^{n} + \\frac{\\Delta t}{2}\\kappa_{x}L_{x} u^{n}\n$$\n在傅里葉空间中，这变为：\n$$\n\\hat{w}^{n+\\frac{1}{2}} = \\left(1 + \\frac{\\Delta t}{2}\\kappa_{x}\\hat{L}_x(\\theta_x)\\right) \\hat{u}^{n}\n$$\n步骤 B 是针对 $y$ 方向扩散的隐式欧拉半步：\n$$\n\\left(I - \\frac{\\Delta t}{2}\\kappa_{y}L_{y}\\right)u^{n+1} = w^{n+\\frac{1}{2}}\n$$\n在傅里葉空间中，这变为：\n$$\n\\left(1 - \\frac{\\Delta t}{2}\\kappa_{y}\\hat{L}_y(\\theta_y)\\right)\\hat{u}^{n+1} = \\hat{w}^{n+\\frac{1}{2}}\n$$\n结合这两个步骤，我们消去 $\\hat{w}^{n+\\frac{1}{2}}$ 来找到 $\\hat{u}^{n+1}$ 和 $\\hat{u}^{n}$ 之间的关系：\n$$\n\\left(1 - \\frac{\\Delta t}{2}\\kappa_{y}\\hat{L}_y(\\theta_y)\\right)\\hat{u}^{n+1} = \\left(1 + \\frac{\\Delta t}{2}\\kappa_{x}\\hat{L}_x(\\theta_x)\\right) \\hat{u}^{n}\n$$\n因此，放大因子 $g = \\hat{u}^{n+1}/\\hat{u}^{n}$ 为：\n$$\ng(\\theta_x, \\theta_y) = \\frac{1 + \\frac{\\Delta t}{2}\\kappa_{x}\\hat{L}_x(\\theta_x)}{1 - \\frac{\\Delta t}{2}\\kappa_{y}\\hat{L}_y(\\theta_y)}\n$$\n代入符号 $\\hat{L}_x$ 和 $\\hat{L}_y$ 的表达式：\n$$\ng(\\theta_x, \\theta_y) = \\frac{1 - \\frac{\\Delta t}{2}\\kappa_{x}\\frac{4}{h_x^2}\\sin^2(\\frac{\\theta_x}{2})}{1 + \\frac{\\Delta t}{2}\\kappa_{y}\\frac{4}{h_y^2}\\sin^2(\\frac{\\theta_y}{2})} = \\frac{1 - \\frac{2\\Delta t \\kappa_x}{h_x^2}\\sin^2(\\frac{\\theta_x}{2})}{1 + \\frac{2\\Delta t \\kappa_y}{h_y^2}\\sin^2(\\frac{\\theta_y}{2})}\n$$\n为使符号清晰，我们定义两个非负量 $A$ 和 $B$：\n$$\nA = \\frac{2\\Delta t \\kappa_x}{h_x^2}\\sin^2\\left(\\frac{\\theta_x}{2}\\right) \\geq 0\n$$\n$$\nB = \\frac{2\\Delta t \\kappa_y}{h_y^2}\\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\geq 0\n$$\n放大因子则为 $g = \\frac{1 - A}{1 + B}$。稳定性条件是 $|g| \\leq 1$。\n$$\n\\left|\\frac{1 - A}{1 + B}\\right| \\leq 1\n$$\n由于 $B \\geq 0$，分母 $1+B$ 严格为正。因此我们可以两边同乘以它：\n$$\n|1 - A| \\leq 1 + B\n$$\n这个单一不等式等价于两个独立的不等式：\n$1)$ $(1 - A) \\leq (1 + B) \\implies -A \\leq B \\implies A+B \\ge 0$。这个条件总是满足的，因为 $A \\geq 0$ 和 $B \\geq 0$。\n$2)$ $-(1 + B) \\leq (1 - A) \\implies -1 - B \\leq 1 - A \\implies A - B \\leq 2$。\n\n这第二个不等式 $A-B \\leq 2$ 是稳定性的必要条件。它必须对所有可能的傅里葉模态都成立，即对所有 $\\theta_x, \\theta_y \\in [-\\pi, \\pi]$。将 $A$ 和 $B$ 的表达式代回：\n$$\n\\frac{2\\Delta t \\kappa_x}{h_x^2}\\sin^2\\left(\\frac{\\theta_x}{2}\\right) - \\frac{2\\Delta t \\kappa_y}{h_y^2}\\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\leq 2\n$$\n提出因子 $\\Delta t$：\n$$\n\\Delta t \\left( \\frac{2\\kappa_x}{h_x^2}\\sin^2\\left(\\frac{\\theta_x}{2}\\right) - \\frac{2\\kappa_y}{h_y^2}\\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\right) \\leq 2\n$$\n为了找到对 $\\Delta t$ 最严格的限制条件，我们必须求出括号内表达式在所有 $\\theta_x$ 和 $\\theta_y$ 上的最大可能值。项 $\\sin^2(\\theta/2)$ 的取值范围是从 0 到 1。当正项最大化且负项最小化时，该表达式取得最大值。这发生在以下情况：\n$$\n\\sin^2\\left(\\frac{\\theta_x}{2}\\right) = 1 \\quad (\\text{例如，对于 } \\theta_x = \\pi)\n$$\n$$\n\\sin^2\\left(\\frac{\\theta_y}{2}\\right) = 0 \\quad (\\text{对于 } \\theta_y = 0)\n$$\n括号内表达式的最大值为：\n$$\n\\max_{\\theta_x, \\theta_y} \\left( \\frac{2\\kappa_x}{h_x^2}\\sin^2\\left(\\frac{\\theta_x}{2}\\right) - \\frac{2\\kappa_y}{h_y^2}\\sin^2\\left(\\frac{\\theta_y}{2}\\right) \\right) = \\frac{2\\kappa_x}{h_x^2}(1) - \\frac{2\\kappa_y}{h_y^2}(0) = \\frac{2\\kappa_x}{h_x^2}\n$$\n因此，稳定性条件简化为：\n$$\n\\Delta t \\left( \\frac{2\\kappa_x}{h_x^2} \\right) \\leq 2\n$$\n解出 $\\Delta t$：\n$$\n\\Delta t \\leq \\frac{h_x^2}{\\kappa_x}\n$$\n最大的允许时间步长 $\\Delta t_{\\max}$ 是此不等式的上界。这个结果只依赖于 $\\kappa_x$ 和 $h_x$，正如问题所规定的。该格式的稳定性完全由其显式部分决定，这与对此类方法的分析是一致的。对 $y$ 方向的隐式处理并未减轻由 $x$ 方向的显式处理所施加的稳定性约束。", "answer": "$$\\boxed{\\frac{h_{x}^{2}}{\\kappa_{x}}}$$", "id": "3427455"}, {"introduction": "对于许多物理现象，如热量或物质浓度，数值解必须保持非负性才能具有物理意义。然而，许多无条件稳定的格式（如基于 Crank-Nicolson 的 ADI）并不能保证这一特性。这个综合性练习 [@problem_id:3427434] 将引导你设计、分析并实现一个能够无条件保持正性的 ADI 格式。你将利用 M-矩阵的强大性质来从理论上证明该格式的优点，并最终通过编写代码来实际验证这一理论，处理具有陡峭梯度的初始条件。", "problem": "考虑单位正方形域上的二维线性扩散偏微分方程（PDE），其带有齐次狄利克雷边界条件：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(\\alpha_x \\frac{\\partial u}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(\\alpha_y \\frac{\\partial u}{\\partial y}\\right), \\quad (x,y)\\in(0,1)\\times(0,1), \\ t0,\n$$\n其中\n$$\nu(x,y,0) = u_0(x,y)\\ge 0, \\quad u(0,y,t)=u(1,y,t)=u(x,0,t)=u(x,1,t)=0.\n$$\n假设扩散系数 $\\alpha_x0$ 和 $\\alpha_y0$ 为正常数。定义一个包含 $N\\times N$ 个内部点的均匀网格，网格间距为 $h=1/(N+1)$，并令 $u_{i,j}^n$ 为 $u(x_i,y_j,t^n)$ 的数值近似，其中 $x_i=ih$，$y_j=jh$，$t^n=n\\Delta t$，且 $i,j\\in\\{1,2,\\dots,N\\}$。\n\n您的任务是：\n\n- 提出一种基于算子分裂的交替方向隐式（ADI）变体方案，在每个时间步 $\\Delta t$ 内，执行两次一维隐式求解，一次在 $x$ 方向，一次在 $y$ 方向。每次求解都由一个单调的、两点通量（中心二阶差分）离散化构建，从而产生一个严格对角占优的三对角系统。设计必须从时间上的向后欧拉离散和每个方向上空间上的标准中心二阶差分出发，不得引用任何未说明的公式。\n\n- 使用 M-矩阵的基本定义（非对角元素非正，对角元素为正，且逆矩阵非负）以及严格对角占优 L-矩阵的著名单调性，证明对于所提出的方案，如果 $u^n$ 按分量 $\\ge 0$，则 $u^{n+1}$ 也按分量 $\\ge 0$。您的证明必须说明为什么这种保正性在没有任何 Courant–Friedrichs–Lewy (CFL) 限制的情况下成立，即对于任意大的 $\\Delta t$ 都成立，前提是两次一维隐式求解的系统都是由这种单调离散化构建的。您可以使用 M-矩阵的逆矩阵是逐项非负这一标准事实。\n\n- 在一个完整的、可运行的程序中实现所提出的 ADI 分裂方案。该程序通过在每一步中顺序应用 $x$ 方向的隐式求解和 $y$ 方向的隐式求解（即向后欧拉的 Lie 分裂）来推进时间上的解。通过消除边界未知数来施加齐次狄利克雷边界条件。对于每个方向上的线性系统，精确求解所得到的三对角系统（例如，通过 Thomas 算法），以避免额外的近似误差。\n\n- 通过选择一个非负初始条件 $u_0(x,y)$ 来测试方案在陡峭梯度下的表现，该初始条件是一个正方形的特征函数：\n$$\nu_0(x,y)=\\begin{cases}\n1,  (x,y)\\in [0.2,0.3]\\times[0.2,0.3],\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\n在内部网格点上进行采样。由于 $u_0\\ge 0$，在 $u^{n+1}$ 中出现的任何负值都将表示保正性失效。\n\n- 定义以下参数值的测试套件，其中每个案例指定 $(N,\\alpha_x,\\alpha_y,\\Delta t,T)$ 并需要运行 $T/\\Delta t$ 个时间步：\n    - 案例 1：$(64,1.0,1.0,10^{-2},2\\times 10^{-2})$。\n    - 案例 2：$(64,1.0,1.0,1.0,1.0)$。\n    - 案例 3：$(64,10.0,0.1,0.1,0.2)$。\n    - 案例 4：$(8,1.0,1.0,0.5,1.0)$。\n\n这些案例包含的时间步 $\\Delta t$ 远超标准的显式 Courant–Friedrichs–Lewy (CFL) 界限（例如，对于向前欧拉离散，在各向同性情况 $\\alpha_x=\\alpha_y=1$ 和 $h=1/(N+1)$下，会有 $\\Delta t \\lesssim h^2/4$），但您的隐式分裂方案应保持保正性。\n\n对于每个案例，计算时间 $T$ 后的数值解，并报告是否满足 $\\min_{i,j} u_{i,j}^{n_{\\text{final}}}\\ge -10^{-12}$。将四个布尔结果按案例顺序组合成一个列表。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，$[result_1,result_2,result_3,result_4]$）。", "solution": "该问题要求设计、证明保正性并实现一个用于二维线性扩散方程的交替方向隐式（ADI）方案。\n\n控制偏微分方程为：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(\\alpha_x \\frac{\\partial u}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(\\alpha_y \\frac{\\partial u}{\\partial y}\\right)\n$$\n对于常数扩散系数 $\\alpha_x  0$ 和 $\\alpha_y  0$，方程简化为：\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha_x \\frac{\\partial^2 u}{\\partial x^2} + \\alpha_y \\frac{\\partial^2 u}{\\partial y^2} = (\\mathcal{L}_x + \\mathcal{L}_y)u\n$$\n其中 $\\mathcal{L}_x u = \\alpha_x \\frac{\\partial^2 u}{\\partial x^2}$ 和 $\\mathcal{L}_y u = \\alpha_y \\frac{\\partial^2 u}{\\partial y^2}$ 是一维扩散算子。区域为 $(x,y)\\in(0,1)\\times(0,1)$，带有齐次狄利克雷边界条件。\n\n### 1. 提出的 ADI 方案\n我们从用于时间离散的向后欧拉方法开始：\n$$\n\\frac{u^{n+1} - u^n}{\\Delta t} = (\\mathcal{L}_x + \\mathcal{L}_y)u^{n+1}\n$$\n令 $U^n$ 为 $N \\times N$ 内部网格上数值解 $u_{i,j}^n$ 的向量。使用标准中心二阶差分对算子 $\\mathcal{L}_x$ 和 $\\mathcal{L}_y$ 进行空间离散，得到矩阵算子 $A_x$ 和 $A_y$。完全隐式格式为 $(I - \\Delta t(A_x + A_y))U^{n+1} = U^n$。对矩阵 $I - \\Delta t(A_x + A_y)$ 求逆的计算成本很高，因为它不是三对角矩阵。\n\n问题要求一个执行两次独立一维隐式求解的 ADI 变体。这可以通过对向后欧拉更新进行 Lie-Trotter 分裂来实现。从 $t^n$ 到 $t^{n+1}$ 的时间步被分解为两个子步骤，涉及一个中间解 $u^*$：\n\n**步骤 1：$x$ 方向的隐式求解。**\n我们在 $x$ 方向上隐式求解方程 $\\frac{u^* - u^n}{\\Delta t} = \\mathcal{L}_x u^*$。在间距为 $h = 1/(N+1)$ 的网格上对 $\\mathcal{L}_x$ 使用中心差分，对每个网格点 $(i,j)$ 我们得到：\n$$\n\\frac{u_{i,j}^* - u_{i,j}^n}{\\Delta t} = \\alpha_x \\frac{u_{i+1,j}^* - 2u_{i,j}^* + u_{i-1,j}^*}{h^2}\n$$\n整理各项，将未知数 $u^*$ 放在左侧，得到：\n$$\n-\\frac{\\alpha_x \\Delta t}{h^2} u_{i-1,j}^* + \\left(1 + 2\\frac{\\alpha_x \\Delta t}{h^2}\\right) u_{i,j}^* - \\frac{\\alpha_x \\Delta t}{h^2} u_{i+1,j}^* = u_{i,j}^n\n$$\n对于每个固定的行索引 $j \\in \\{1, 2, \\dots, N\\}$，该方程构成一个 $N \\times N$ 的三对角线性方程组。齐次狄利克雷条件 $u_{0,j}^* = u_{N+1,j}^* = 0$ 被纳入其中。\n\n**步骤 2：$y$ 方向的隐式求解。**\n接下来，我们在 $y$ 方向上隐式求解 $\\frac{u^{n+1} - u^*}{\\Delta t} = \\mathcal{L}_y u^{n+1}$。类似地对 $\\mathcal{L}_y$ 进行离散化，对每个网格点 $(i,j)$ 我们得到：\n$$\n\\frac{u_{i,j}^{n+1} - u_{i,j}^*}{\\Delta t} = \\alpha_y \\frac{u_{i,j+1}^{n+1} - 2u_{i,j}^{n+1} + u_{i,j-1}^{n+1}}{h^2}\n$$\n整理后得到：\n$$\n-\\frac{\\alpha_y \\Delta t}{h^2} u_{i,j-1}^{n+1} + \\left(1 + 2\\frac{\\alpha_y \\Delta t}{h^2}\\right) u_{i,j}^{n+1} - \\frac{\\alpha_y \\Delta t}{h^2} u_{i,j+1}^{n+1} = u_{i,j}^*\n$$\n对于每个固定的列索引 $i \\in \\{1, 2, \\dots, N\\}$，这为未知数 $u^{n+1}$ 构成一个 $N \\times N$ 的三对角系统，并纳入了边界条件 $u_{i,0}^{n+1} = u_{i,N+1}^{n+1} = 0$。\n\n这个两步过程构成了所提出的 ADI 方案。在每个时间步 $\\Delta t$，它需要为 $x$ 方向扫描求解 $N$ 个大小为 $N \\times N$ 的三对角系统，然后为 $y$ 方向扫描求解 $N$ 个大小为 $N \\times N$ 的三对角系统。这在计算上远比求解一个大的二维系统高效。\n\n### 2. 无条件保正性证明\n我们必须证明，如果对所有 $i,j$ 都有 $u_{i,j}^n \\ge 0$，则对于任何 $\\Delta t  0$，都有 $u_{i,j}^{n+1} \\ge 0$。证明依赖于 M-矩阵的性质。\n\n我们来分析步骤 1 中的线性系统。定义 $x$ 方向的库朗数为 $r_x = \\frac{\\alpha_x \\Delta t}{h^2}$。对于固定的行 $j$，系统为 $M_x U_j^* = U_j^n$，其中 $U_j^*$ 是未知数向量 $(u_{1,j}^*, \\dots, u_{N,j}^*)^T$，$U_j^n$ 是已知数向量 $(u_{1,j}^n, \\dots, u_{N,j}^n)^T$，$M_x$ 是 $N \\times N$ 的三对角矩阵：\n$$\nM_x = \\begin{pmatrix}\n1+2r_x  -r_x   \\\\\n-r_x  1+2r_x  -r_x  \\\\\n  \\ddots  \\ddots  \\ddots  \\\\\n   -r_x  1+2r_x  -r_x \\\\\n    -r_x  1+2r_x\n\\end{pmatrix}\n$$\nM-矩阵是一种 Z-矩阵（非对角元素非正），其逆矩阵非负。一个 Z-矩阵成为 M-矩阵的充分条件是它具有正的对角元素并且是严格对角占优的。\n\n1.  **对角元素**：$M_x$ 的对角元素是 $1+2r_x$。由于 $\\alpha_x  0$，$\\Delta t  0$ 且 $h  0$，我们有 $r_x  0$，所以 $1+2r_x  1  0$。\n2.  **非对角元素**：非零的非对角元素是 $-r_x$，它们是负数。因此，$M_x$ 是一个 Z-矩阵。\n3.  **严格对角占优**：对于任意行 $k \\in \\{1, \\dots, N\\}$，我们检查对角元素的绝对值是否超过该行非对角元素绝对值之和。\n    -   对于行 $k=1$ 或 $k=N$：$|1+2r_x|  |-r_x|$，即 $1+2r_x  r_x$，或 $1+r_x  0$。这总是成立的。\n    -   对于行 $k \\in \\{2, \\dots, N-1\\}$：$|1+2r_x|  |-r_x| + |-r_x|$，即 $1+2r_x  2r_x$，或 $1  0$。这总是成立的。\n\n由于对于任何 $\\Delta t  0$，$M_x$ 都具有正对角元素和非正非对角元素，并且是严格对角占优的，因此它是一个 M-矩阵。根据 M-矩阵的性质，其逆矩阵 $M_x^{-1}$ 的所有元素都是非负的，即 $(M_x^{-1})_{ik} \\ge 0$。\n\n从步骤 1 可知，解为 $U_j^* = M_x^{-1} U_j^n$。如果我们假设 $U^n \\ge 0$（按分量），即对所有 $i,j$ 都有 $u_{i,j}^n \\ge 0$，那么每个向量 $U_j^n$ 都是非负的。一个非负矩阵（$M_x^{-1}$）和一个非负向量（$U_j^n$）的乘积是一个非负向量。因此，对所有 $j$ 都有 $U_j^* \\ge 0$，这意味着中间解 $u_{i,j}^* \\ge 0$ 对所有 $i,j$ 成立。\n\n完全相同的论证也适用于步骤 2。令 $r_y = \\frac{\\alpha_y \\Delta t}{h^2}$。系统为 $M_y U_i^{n+1} = U_i^*$，其中 $M_y$ 是一个三对角矩阵，其对角元素为 $1+2r_y$，非对角元素为 $-r_y$。对于任何 $\\Delta t  0$，$M_y$ 也是一个 M-矩阵，其逆矩阵 $M_y^{-1}$ 是非负的。\n步骤 2 的解是 $U_i^{n+1} = M_y^{-1} U_i^*$。由于我们已经证明 $u_{i,j}^* \\ge 0$，所以对于每个列 $i$，向量 $U_i^*$ 是非负的。因此，$U_i^{n+1}$ 也是非负的。这对所有列 $i \\in \\{1, \\dots, N\\}$ 都成立。\n\n我们得出结论，如果 $u^n \\ge 0$，则 $u^{n+1} \\ge 0$。初始条件指定为 $u_0(x,y) \\ge 0$，因此 $U^0 \\ge 0$。通过数学归纳法，可以推断出对于所有后续时间步 $n  0$，都有 $U^n \\ge 0$。这种保正性是无条件保持的，对时间步长 $\\Delta t$ 的大小没有任何限制。\n\n### 3. 实现与测试\n该方案按所述方式实现。创建一个函数来为给定的一组参数 $(N,\\alpha_x,\\alpha_y,\\Delta t,T)$ 运行模拟。初始条件是在网格上采样的特征函数。时间演化执行的步数等于 $T/\\Delta t$。在每一步中，执行两次扫描（首先是针对 $x$ 方向的行扫描，然后是针对 $y$ 方向的列扫描）。使用标准库例程（`scipy.linalg.solve_banded`）精确求解所得到的三对角系统。在最后一个时间步之后，计算解数组的最小值，并与阈值 $-10^{-12}$ 进行比较，以验证保正性，同时考虑到潜在的浮点误差。所选的测试案例包括了会违反显式方法 CFL 条件的大时间步，从而展示了所提出的隐式分裂方案的无条件稳定性和保正性。", "answer": "```python\n# The complete and runnable Python 3 code for the ADI scheme.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef run_simulation(N, alpha_x, alpha_y, dt, T):\n    \"\"\"\n    Runs the ADI simulation for the 2D diffusion equation.\n\n    Args:\n        N (int): Number of interior grid points in each dimension.\n        alpha_x (float): Diffusion coefficient in the x-direction.\n        alpha_y (float): Diffusion coefficient in the y-direction.\n        dt (float): Time step size.\n        T (float): Total simulation time.\n\n    Returns:\n        bool: True if the minimum value of the final solution is = -1e-12,\n              False otherwise.\n    \"\"\"\n    h = 1.0 / (N + 1)\n    \n    # Set up initial condition\n    u_current = np.zeros((N, N))\n    x_coords = np.linspace(h, 1.0 - h, N)\n    y_coords = np.linspace(h, 1.0 - h, N)\n    \n    for j in range(N):\n        for i in range(N):\n            if 0.2 = x_coords[i] = 0.3 and 0.2 = y_coords[j] = 0.3:\n                u_current[j, i] = 1.0\n\n    # Ensure the number of steps is an integer\n    num_steps = int(round(T / dt))\n\n    # Pre-computation for x-solve tridiagonal matrix\n    r_x = alpha_x * dt / (h * h)\n    ab_x = np.zeros((3, N))\n    ab_x[0, 1:] = -r_x        # Upper diagonal\n    ab_x[1, :] = 1.0 + 2.0 * r_x  # Main diagonal\n    ab_x[2, :-1] = -r_x       # Lower diagonal\n\n    # Pre-computation for y-solve tridiagonal matrix\n    r_y = alpha_y * dt / (h * h)\n    ab_y = np.zeros((3, N))\n    ab_y[0, 1:] = -r_y        # Upper diagonal\n    ab_y[1, :] = 1.0 + 2.0 * r_y  # Main diagonal\n    ab_y[2, :-1] = -r_y       # Lower diagonal\n    \n    for _ in range(num_steps):\n        # Step 1: Implicit solve in x-direction for each row\n        u_star = np.zeros((N, N))\n        for j in range(N):\n            rhs = u_current[j, :]\n            u_star[j, :] = solve_banded((1, 1), ab_x, rhs, check_finite=False)\n            \n        # Step 2: Implicit solve in y-direction for each column\n        u_next = np.zeros((N, N))\n        for i in range(N):\n            rhs = u_star[:, i]\n            u_next[:, i] = solve_banded((1, 1), ab_y, rhs, check_finite=False)\n            \n        u_current = u_next\n        \n    min_val = np.min(u_current)\n    return min_val = -1e-12\n\ndef solve():\n    \"\"\"\n    Defines the test suite, runs the simulations, and prints the results.\n    \"\"\"\n    # Test cases: (N, alpha_x, alpha_y, dt, T)\n    test_cases = [\n        (64, 1.0, 1.0, 1e-2, 2e-2),\n        (64, 1.0, 1.0, 1.0, 1.0),\n        (64, 10.0, 0.1, 0.1, 0.2),\n        (8, 1.0, 1.0, 0.5, 1.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        N, alpha_x, alpha_y, dt, T = params\n        is_positive = run_simulation(N, alpha_x, alpha_y, dt, T)\n        results.append(str(is_positive).lower())\n\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solution process\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3427434"}]}