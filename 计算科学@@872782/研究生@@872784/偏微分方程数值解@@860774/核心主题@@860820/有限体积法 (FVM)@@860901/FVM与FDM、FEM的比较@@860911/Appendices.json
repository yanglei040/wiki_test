{"hands_on_practices": [{"introduction": "尽管有限体积法（FVM）和有限元法（FEM）源于不同的物理和数学原理——即局部守恒和变分形式——但它们在特定情况下可以惊人地相似。本练习将通过推导FVM的离散格林恒等式，揭示这两种方法之间深刻的内在联系。你将证明，在一个基础的一维案例中，它与FEM的代数形式是等价的，从而加深对两种方法共享的数学结构的理解。", "problem": "考虑一个有界 Lipschitz 域 $\\Omega \\subset \\mathbb{R}^{d}$ 上的标量扩散模型 $- \\nabla \\cdot \\big(\\kappa \\nabla u\\big) = f$，其中扩散系数 $\\kappa(x)$ 足够光滑，并在边界 $\\partial \\Omega$ 上满足齐次狄利克雷边界条件 $u=0$。设 $\\mathcal{T}_{h}$ 是 $\\Omega$ 的一个一致的多胞体剖分，将其划分为控制体 $K$，并设 $\\mathcal{F}$ 表示所有 $(d-1)$ 维面的集合。对于任意由两个相邻单元 $K$ 和 $L$ 共享的内部面 $F$，记作 $F=K|L$，并设 $n_{K,F}$ 为 $F$ 上从 $K$ 向外指的单位法向量。假设对于 $K \\in \\mathcal{T}_{h}$ 和 $F \\subset \\partial K$，采用了一致的两点通量近似：\n$$\n\\Phi_{K,F}(u_{h}) \\approx - \\int_{F} \\kappa \\nabla u \\cdot n_{K,F} \\, \\mathrm{d}s = T_{F} \\, (u_{K} - u_{L}),\n$$\n其中 $T_{F} > 0$ 是与 $F$ 相关联的对称传导率，$u_{K}$ 和 $u_{L}$ 是基于单元的近似值。对于一对单元常数场 $u_{h}$ 和 $v_{h}$，定义有限体积法 (FVM) 的双线性形式为\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) := \\sum_{K \\in \\mathcal{T}_{h}} v_{K} \\sum_{F \\subset \\partial K} \\Phi_{K,F}(u_{h}).\n$$\n\n任务：\n1) 以局部守恒和散度定理为基本依据，推导一个离散格林恒等式，证明 FVM 扩散双线性形式可以重新表示为数值通量乘以测试函数跳跃值在所有面上的总和。你的推导必须明确说明内部面通量的反对称性，并得出以下形式的表达式：\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) = \\sum_{F \\in \\mathcal{F}_{\\mathrm{int}}} T_{F} \\, [u_{h}]_{F} \\, [v_{h}]_{F} \\; + \\; \\text{(边界面项)},\n$$\n其中 $[w]_{F}$ 表示单元常数场 $w$ 跨过内部面 $F$ 的跳跃值，$\\mathcal{F}_{\\mathrm{int}}$ 是内部面的集合。解释在什么情况下边界面项会消失。\n\n2) 考虑在匹配的单纯形网格上使用分段仿射（也称为 $P^{1}$）试探空间和检验空间的标准协调伽辽金有限元法 (FEM)，其精确双线性形式为\n$$\na^{\\mathrm{FEM}}(u_{h},v_{h}) := \\int_{\\Omega} \\kappa \\, \\nabla u_{h} \\cdot \\nabla v_{h} \\, \\mathrm{d}x.\n$$\n从连续分部积分公式出发，证明在精确求积下，FEM 双线性形式可以组织为法向通量乘以迹在所有面上的精确求和，当 $u_{h}$ 和 $v_{h}$ 是分段仿射函数，并且基于面的传导率 $T_{F}$ 的选择与 $\\kappa$ 在与 $F$ 相邻的每个单元上的精确平均值一致时，该形式在代数上与任务1中的离散格林恒等式相吻合。简要地将这种精确性与均匀一维网格上的中心差分有限差分法 (FDM) 进行对比。\n\n3) 特化到一维空间，域为 $[0,1]$。设 $N \\in \\mathbb{N}$ 为子区间的数量，且 $h := 1/N$。考虑在均匀网格上使用顶点中心 FVM，节点为 $x_{i} := i h$，$i=0,1,\\dots,N$，控制体为 $[x_{i-1/2},x_{i+1/2}]$，其中 $x_{i \\pm 1/2} := x_{i} \\pm h/2$。定义在内部面 $x_{i+1/2}$ 处的两点数值通量为\n$$\n\\Phi_{i+1/2}(u_{h}) := - \\kappa(x_{i+1/2}) \\, \\frac{u_{i+1} - u_{i}}{h},\n$$\n并根据离散格林恒等式定义 FVM 扩散双线性形式为\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) := \\sum_{i=0}^{N-1} \\kappa(x_{i+1/2}) \\, \\frac{(u_{i+1} - u_{i})(v_{i+1} - v_{i})}{h}.\n$$\n设扩散系数是仿射的，$\\kappa(x) := \\kappa_{0} + \\alpha x$，其中 $\\kappa_{0} > 0$ 且 $\\alpha$ 为实数。设 $I_{h}$ 表示到网格上连续分段仿射函数空间中的节点插值算子。定义 $u_{h} := I_{h}(x(1-x))$ 和 $v_{h} := I_{h}(x(1-x))$。使用 FEM 的精确求积，计算量\n$$\nD(h) := a_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) - a^{\\mathrm{FEM}}(u_{h},v_{h})\n$$\n将结果表示为 $\\kappa_{0}$、$\\alpha$ 和 $h$ 的闭合形式函数。请以单一的闭合形式解析表达式给出你的最终答案。无需进行四舍五入。", "solution": "该问题被验证为具有科学依据、适定且客观。它包含偏微分方程数值分析领域的标准推导和计算。\n\n### 任务1：FVM 离散格林恒等式的推导\n\n我们从单元常数场 $u_{h}$ 和 $v_{h}$ 的有限体积法 (FVM) 双线性形式的定义开始：\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) := \\sum_{K \\in \\mathcal{T}_{h}} v_{K} \\sum_{F \\subset \\partial K} \\Phi_{K,F}(u_{h})\n$$\n其核心原理是局部守恒，即控制体 $K$ 边界上的通量总和与在 $K$ 上积分的源项相平衡。该双线性形式代表了扩散算子的弱形式。\n\n基本步骤是改变求和的顺序。我们不对单元及其面求和，而是对网格中的所有面求和，然后考虑共享每个面的单元。所有面的集合 $\\mathcal{F}$ 可以被剖分为内部面的集合 $\\mathcal{F}_{\\mathrm{int}}$ 和边界面集合 $\\mathcal{F}_{\\mathrm{bnd}}$。\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) = \\sum_{F \\in \\mathcal{F}} \\sum_{K \\text{ s.t. } F \\subset \\partial K} v_{K} \\, \\Phi_{K,F}(u_{h})\n$$\n对于一个内部面 $F \\in \\mathcal{F}_{\\mathrm{int}}$，它被恰好两个单元（比如 $K$ 和 $L$）共享，所以我们记作 $F=K|L$。来自这个面的对总和的贡献是：\n$$\nv_{K} \\Phi_{K,F}(u_{h}) + v_{L} \\Phi_{L,F}(u_{h})\n$$\n数值通量 $\\Phi_{K,F}(u_{h})$ 近似于物理通量积分 $- \\int_{F} \\kappa \\nabla u \\cdot n_{K,F} \\, \\mathrm{d}s$。物理通量的一个关键性质是关于法向量的反对称性。也就是说，由于在面 $F$ 上，从 $L$ 出发的外法线是 $n_{L,F} = -n_{K,F}$，所以从 $L$到 $K$ 的通量是从 $K$ 到 $L$ 通量的负值。一致的数值通量必须遵守这一点：$\\Phi_{L,F}(u_h) = -\\Phi_{K,F}(u_h)$。让我们用给定的两点通量近似来验证这一点：\n$$\n\\Phi_{K,F}(u_{h}) = T_{F} \\, (u_{K} - u_{L})\n$$\n根据设定的对称性（$F=K|L$ 与 $F=L|K$ 相同，且 $T_F$ 与该面相关联），从单元 $L$ 出发的通量为：\n$$\n\\Phi_{L,F}(u_{h}) = T_{F} \\, (u_{L} - u_{K}) = -T_{F} \\, (u_{K} - u_{L}) = -\\Phi_{K,F}(u_{h})\n$$\n该性质成立。将其代入来自面 $F$ 的贡献中：\n$$\nv_{K} \\Phi_{K,F}(u_{h}) + v_{L} (-\\Phi_{K,F}(u_{h})) = (v_{K} - v_{L}) \\Phi_{K,F}(u_{h})\n$$\n现在，我们定义一个单元常数场 $w_h$ 跨过内部面 $F=K|L$ 的跳跃值。让我们为每个 $F \\in \\mathcal{F}_{\\mathrm{int}}$ 固定一个唯一的法向量 $n_F$，例如，将其方向规定为从全局索引较小的单元指向较大的单元。如果 $n_F = n_{K,F}$，我们将跳跃值定义为 $[w_{h}]_{F} := w_{K} - w_{L}$。通量 $\\Phi_{K,F}(u_h)$ 的表达式与此方向一致，因此 $\\Phi_{K,F}(u_h) = T_F [u_h]_F$。那么来自内部面 $F$ 的贡献是：\n$$\n[v_{h}]_{F} \\, T_{F} \\, [u_{h}]_{F} = T_{F} \\, [u_{h}]_{F} \\, [v_{h}]_{F}\n$$\n对所有内部面求和，我们得到目标表达式的第一部分：\n$$\n\\sum_{F \\in \\mathcal{F}_{\\mathrm{int}}} T_{F} \\, [u_{h}]_{F} \\, [v_{h}]_{F}\n$$\n对于一个边界面 $F \\in \\mathcal{F}_{\\mathrm{bnd}}$，它只属于一个单元，比如 $K$。问题指定了齐次狄利克雷边界条件 $u=0$ on $\\partial\\Omega$。一个一致的格式通过将域外 $u$ 的值设为 0 来包含这一点。因此，如果我们用 $u_L$ 表示外部 \"虚拟\" 单元中的值，我们有 $u_L=0$。通量为 $\\Phi_{K,F}(u_{h}) = T_{F}(u_{K} - 0) = T_{F} u_{K}$。因此，来自所有边界面的贡献是：\n$$\n\\sum_{F \\in \\mathcal{F}_{\\mathrm{bnd}}} v_{K(F)} \\, \\Phi_{K(F),F}(u_{h}) = \\sum_{F \\in \\mathcal{F}_{\\mathrm{bnd}}} v_{K(F)} \\, T_{F} \\, u_{K(F)}\n$$\n其中 $K(F)$ 是 $\\mathcal{T}_h$ 中以 $F$ 为其边界面的唯一单元。结合内部和边界部分，我们得到离散格林恒等式：\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) = \\sum_{F \\in \\mathcal{F}_{\\mathrm{int}}} T_{F} \\, [u_{h}]_{F} \\, [v_{h}]_{F} + \\sum_{F \\in \\mathcal{F}_{\\mathrm{bnd}}} v_{K(F)} \\, T_{F} \\, u_{K(F)}\n$$\n在变分法中对齐次狄利克雷边界条件的标准处理下，边界面项会消失。试探函数 $u_h$ 和检验函数 $v_h$ 必须属于满足这些条件的离散空间。对于基于单元的 FVM，这转化为要求如果单元 $K$ “在边界上”（例如，其单元中心位于 $\\partial\\Omega$ 上或与之相邻，具体取决于格式的细节），则 $w_K=0$。如果检验函数 $v_h$ 从这样的空间中选取，那么对于所有与边界相邻的单元，$v_K=0$，导致边界面项 $\\sum v_{K(F)} T_F u_{K(F)}$ 恒等于零。\n\n### 任务2：与 FEM 和 FDM 的比较\n\n标准协调伽辽金有限元法 (FEM) 的双线性形式是：\n$$\na^{\\mathrm{FEM}}(u_{h},v_{h}) := \\int_{\\Omega} \\kappa \\, \\nabla u_{h} \\cdot \\nabla v_{h} \\, \\mathrm{d}x\n$$\n我们可以将其表示为网格 $\\mathcal{T}_h$ 的单元（单纯形） $K$ 上的积分之和：\n$$\na^{\\mathrm{FEM}}(u_{h},v_{h}) = \\sum_{K \\in \\mathcal{T}_h} \\int_{K} \\kappa \\, \\nabla u_{h} \\cdot \\nabla v_{h} \\, \\mathrm{d}x\n$$\n对于 $P^1$（分段仿射）单元，试探/检验函数 $\\nabla u_h$ 或 $\\nabla v_h$ 的梯度在每个单元 $K$ 上都是一个常向量。因此，我们可以写成：\n$$\na^{\\mathrm{FEM}}(u_{h},v_{h}) = \\sum_{K \\in \\mathcal{T}_h} (\\nabla u_{h}|_K \\cdot \\nabla v_{h}|_K) \\int_{K} \\kappa \\, \\mathrm{d}x\n$$\n这是对单元的求和。为了得到一个类似于 FVM 形式的对面求和，为清晰起见，我们考虑一维情况，在均匀网格 $x_i=ih$ 上。单元是区间 $K_i = [x_i, x_{i+1}]$。在这样的区间上，$u_h(x)$ 是仿射的，其导数是常数：$u_h'(x) = \\frac{u_{i+1} - u_i}{h}$。该双线性形式变为：\n$$\na^{\\mathrm{FEM}}(u_{h},v_{h}) = \\sum_{i=0}^{N-1} \\int_{x_i}^{x_{i+1}} \\kappa(x) \\left(\\frac{u_{i+1}-u_i}{h}\\right) \\left(\\frac{v_{i+1}-v_i}{h}\\right) \\mathrm{d}x\n$$\n$$\na^{\\mathrm{FEM}}(u_{h},v_{h}) = \\sum_{i=0}^{N-1} \\left( \\frac{1}{h} \\int_{x_i}^{x_{i+1}} \\kappa(x) \\, \\mathrm{d}x \\right) \\frac{(u_{i+1}-u_i)(v_{i+1}-v_i)}{h}\n$$\n这个表达式现在是一个“对面的精确求和”，其中“面”被解释为节点 $i$ 和 $i+1$ 之间的连接。它与任务1中推导出的 FVM 离散格林恒等式 $a_h(u,v) = \\sum T_F [u]_F [v]_F$ 具有相同的代数结构。在这一维背景下，“跳跃值” $[u]_F$ 对应于差值 $(u_{i+1}-u_i)$（或其负值，由于是乘积形式所以无所谓），而连接 $i$ 和 $i+1$ 的面的传导率 $T_F$ 由 FEM 公式隐式定义为：\n$$\nT_{i,i+1}^{\\mathrm{FEM}} = \\frac{1}{h^2} \\int_{x_i}^{x_{i+1}} \\kappa(x) \\, \\mathrm{d}x\n$$\n另一方面，FVM 公式中的传导率是由代数近似定义的，例如 $T_F = \\frac{\\kappa(x_F)}{A_F}$，其中 $x_F$ 是面上的一个点，$A_F$ 是一个几何因子。对于任务3中展示的一维情况，$T_{i+1/2} = \\kappa(x_{i+1/2})/h$。如果选择 FVM 的传导率来匹配 FEM 的传导率，即 $T_F$ 基于 $\\kappa$ 在相应单元上的积分平均值，则 FVM 和 FEM 在代数上是一致的。\n\n在一维均匀网格上，节点 $x_i$ 处 $-(\\kappa u')' = f$ 的中心差分有限差分法 (FDM) 格式为 $-\\frac{1}{h} [ \\kappa_{i+1/2}\\frac{u_{i+1}-u_i}{h} - \\kappa_{i-1/2}\\frac{u_i-u_{i-1}}{h} ] = f_i$。这与从控制体 $[x_{i-1/2}, x_{i+1/2}]$ 上的守恒推导出的顶点中心 FVM 完全相同。其区别在于，FEM 自然地使用 $\\kappa$ 的积分平均值（这使其对单元平均值是精确的），而 FDM/FVM 通常使用点值（例如，中点值）。如果点值等于平均值，这两种方法就重合了，例如，当 $\\kappa(x)$ 在单元上是常数或仿射函数时，情况就是如此。\n\n### 任务3：差值 $D(h)$ 的计算\n\n我们需要计算 $D(h) := a_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) - a^{\\mathrm{FEM}}(u_{h},v_{h})$，其中 $u_h = v_h = I_h(x(1-x))$ 且 $\\kappa(x) = \\kappa_0 + \\alpha x$。网格是均匀的，步长为 $h=1/N$。\n\n首先，我们确定节点值 $u_i$。由于 $u_h$ 是 $u(x)=x(1-x)$ 的节点插值，节点上的值就是 $u_i = u(x_i)$。\n$$\nu_i = x_i(1-x_i) = (ih)(1-ih) = ih - i^2h^2\n$$\n边界条件 $u_0=0$ 和 $u_N=0$ 得到满足。我们需要相邻节点值之间的差：\n$$\nu_{i+1} - u_i = \\left((i+1)h - (i+1)^2h^2\\right) - (ih - i^2h^2) \\\\\n= h - h^2((i+1)^2 - i^2) \\\\\n= h - h^2(2i+1)\n$$\n由于 $u_h=v_h$，我们将为每种方法计算 $a(u_h, u_h)$。\n\n**1. FVM 双线性形式计算**\n问题将 FVM 双线性形式定义为：\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},u_{h}) = \\sum_{i=0}^{N-1} \\kappa(x_{i+1/2}) \\, \\frac{(u_{i+1} - u_{i})^2}{h}\n$$\n这里，$x_{i+1/2} = x_i + h/2 = (i+1/2)h$。代入 $\\kappa(x) = \\kappa_0 + \\alpha x$：\n$$\n\\kappa(x_{i+1/2}) = \\kappa_0 + \\alpha (i+1/2)h\n$$\n再代入 $(u_{i+1}-u_i)$ 的表达式：\n$$\na_{h}^{\\mathrm{FVM}}(u_{h},u_{h}) = \\sum_{i=0}^{N-1} (\\kappa_0 + \\alpha (i+1/2)h) \\, \\frac{(h - h^2(2i+1))^2}{h}\n$$\n\n**2. FEM 双线性形式计算**\n使用精确求积的 FEM 双线性形式是：\n$$\na^{\\mathrm{FEM}}(u_{h},u_{h}) = \\int_{0}^{1} \\kappa(x) (u_h'(x))^2 \\, \\mathrm{d}x = \\sum_{i=0}^{N-1} \\int_{x_i}^{x_{i+1}} \\kappa(x) (u_h'(x))^2 \\, \\mathrm{d}x\n$$\n在区间 $[x_i, x_{i+1}]$ 上，$u_h(x)$ 是仿射的，所以其导数是常数：\n$$\nu_h'(x) = \\frac{u_{i+1}-u_i}{h} = \\frac{h - h^2(2i+1)}{h} = 1 - h(2i+1)\n$$\n所以，我们可以对每个单元将导数的平方提到积分外面：\n$$\na^{\\mathrm{FEM}}(u_{h},u_{h}) = \\sum_{i=0}^{N-1} \\left(\\frac{u_{i+1}-u_i}{h}\\right)^2 \\int_{x_i}^{x_{i+1}} \\kappa(x) \\, \\mathrm{d}x\n$$\n我们计算仿射函数 $\\kappa(x)$ 的积分：\n$$\n\\int_{x_i}^{x_{i+1}} (\\kappa_0 + \\alpha x) \\, \\mathrm{d}x = \\left[ \\kappa_0 x + \\frac{\\alpha}{2} x^2 \\right]_{ih}^{(i+1)h} \\\\\n= \\kappa_0 ((i+1)h - ih) + \\frac{\\alpha}{2} (((i+1)h)^2 - (ih)^2) \\\\\n= \\kappa_0 h + \\frac{\\alpha h^2}{2} ((i+1)^2 - i^2) \\\\\n= \\kappa_0 h + \\frac{\\alpha h^2}{2} (2i+1) \\\\\n= h (\\kappa_0 + \\alpha h(i+1/2)) = h \\, \\kappa(x_{i+1/2})\n$$\n这个结果表明，对于一个仿射函数，它在一个区间上的积分恰好是区间长度乘以该函数在中点处的值（中点求积法则对仿射函数是精确的）。\n将此代回 $a^{\\mathrm{FEM}}$ 的表达式中：\n$$\na^{\\mathrm{FEM}}(u_{h},u_{h}) = \\sum_{i=0}^{N-1} \\frac{(u_{i+1}-u_i)^2}{h^2} \\left( h \\, \\kappa(x_{i+1/2}) \\right) \\\\\n= \\sum_{i=0}^{N-1} \\kappa(x_{i+1/2}) \\, \\frac{(u_{i+1}-u_i)^2}{h}\n$$\n这个表达式与为 $a_{h}^{\\mathrm{FVM}}(u_{h},u_{h})$ 定义的表达式完全相同。\n\n**3. 差值 $D(h)$**\n由于在给定条件下，$a_{h}^{\\mathrm{FVM}}(u_{h},u_{h})$ 和 $a^{\\mathrm{FEM}}(u_{h},u_{h})$ 的表达式完全相同，它们的差为零。\n$$\nD(h) = a_{h}^{\\mathrm{FVM}}(u_{h},v_{h}) - a^{\\mathrm{FEM}}(u_{h},v_{h}) = 0\n$$\n这个特定场景（均匀一维网格，P1 FEM 对比顶点中心 FVM，线性 $\\kappa$）是两种方法等价的一个例子。", "answer": "$$\n\\boxed{0}\n$$", "id": "3372431"}, {"introduction": "在理想情况下看到了FVM和FEM的相似性之后 [@problem_id:3372431]，我们现在将探讨一个它们表现出显著差异的场景。本练习将考察它们在非正交（扭曲）网格上的性能，这是实际应用中常见的挑战。通过亲手计算一种简化的有限体积格式所产生的通量误差，你将直接观察到其在非正交网格上的不一致性，并理解为何有限元法的变分基础使其在处理这类几何复杂性时具有根本优势。", "problem": "考虑具有各向同性扩散系数的稳态扩散方程，\n$$-\\nabla \\cdot \\left( k \\nabla u \\right) = 0 \\quad \\text{in } \\Omega,$$\n其中常数 $k=1$。假设计算网格由两个相邻的、共享一个公共内表面的、扭曲的凸四边形控制体组成。左侧控制体的顶点为\n$$(0,0), \\ (1,0.1), \\ (1,1.1), \\ (0,1),$$\n右侧控制体的顶点为\n$$(1,0.1), \\ (2,0.4), \\ (2,1.2), \\ (1,1.1).$$\n假设有限体积法 (FVM) 的主未知量位于每个控制体的中心，此处定义为该控制体四个顶点坐标的算术平均值。共享的内表面是连接 $(1,0.1)$ 和 $(1,1.1)$ 的直线段，从左侧控制体指向右侧控制体的单位外法向量为 $\\boldsymbol{n}=(1,0)$，表面长度为 $|\\Gamma|=1$。\n\n令精确标量场为线性场，\n$$u(x,y) = 2x - y,$$\n因此精确梯度为常数。请比较通过以下两种方法计算的穿过共享内表面的通量：\n- 有限体积法 (FVM-TPFA) 的两点通量近似，该方法将面法向离散梯度取为相邻单元中心值的差值投影到面法向上，再除以单元中心之间的法向距离；\n- 通过投影 $P_1$ 有限元法 (FEM) 梯度得到的通量，此处理解为在表面上对精确线性梯度进行积分，即 $\\displaystyle -\\int_{\\Gamma} \\nabla u \\cdot \\boldsymbol{n} \\, \\mathrm{d}s$，对于线性场，$P_1$ FEM 可以精确重现该梯度。\n\n1. 计算差值\n$$\\Delta F \\equiv F_{\\text{TPFA}} - F_{\\text{FEM}},$$\n使用上述几何数据和 $k=1$。将最终答案精确表示为一个最简分数。\n\n2. 从伽辽金双线性形式和 FVM 两点通量组装的定义出发，分析在有限体积法 (FVM-TPFA)、有限差分法 (FDM) 和有限元法 (FEM) 中，哪种方法在此类扭曲网格上能保持离散算子的对称性和正定性，并解释原因。您的分析必须追溯到其底层的变分形式（对于 FEM）和传递率构造（对于 FVM-TPFA），并应评论正交性对于结构化网格上 FDM 的作用。\n\n您的最终答案必须仅为 $\\Delta F$ 的精确值，不带单位，也无需四舍五入。", "solution": "我们从离散化方法所基于的扩散通量定律和弱形式开始。\n\n对于常数 $k=1$，物理扩散通量密度为\n$$\\boldsymbol{q} = -\\nabla u.$$\n对于一个单位法向量为 $\\boldsymbol{n}$ 的表面 $\\Gamma$，连续表面通量为\n$$F = \\int_{\\Gamma} \\boldsymbol{q} \\cdot \\boldsymbol{n} \\, \\mathrm{d}s = -\\int_{\\Gamma} \\nabla u \\cdot \\boldsymbol{n} \\, \\mathrm{d}s.$$\n\n对于 $P_1$ 有限元法 (FEM)，伽辽金双线性形式为\n$$a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, \\mathrm{d}x,$$\n对于正常数 $k$，该形式在 $H_0^1(\\Omega)$ 上是对称且强制的。当精确解 $u$ 是线性的， $P_1$ FEM 形函数在四边形网格的三角剖分（例如，通过将每个四边形分割成两个三角形）中的每个三角形上都能精确重现 $\\nabla u$，因此通过在 $\\Gamma$ 上投影 $P_1$ 梯度得到的表面通量等于精确的表面通量。\n\n我们现在计算特定网格上的这两个目标通量。\n\n1. 几何形状和精确梯度。\n\n表面 $\\Gamma$ 连接 $(1,0.1)$ 和 $(1,1.1)$，因此它是垂直的，长度为 $|\\Gamma|=1$，其从左到右的单位法向量为 $\\boldsymbol{n}=(1,0)$。精确场为\n$$u(x,y) = 2x - y,$$\n所以\n$$\\nabla u = \\begin{pmatrix} 2 \\\\ -1 \\end{pmatrix}.$$\n\n因此，精确的面法向通量（也就是 $P_1$ FEM 表面通量）是\n$$F_{\\text{FEM}} \\equiv -\\int_{\\Gamma} \\nabla u \\cdot \\boldsymbol{n} \\, \\mathrm{d}s = -\\left( \\nabla u \\cdot \\boldsymbol{n} \\right) |\\Gamma| = -\\left( 2 \\right)\\cdot 1 = -2.$$\n\n2. 穿过 $\\Gamma$ 的有限体积法两点通量。\n\n我们将控制体中心定义为顶点坐标的算术平均值。\n\n左侧控制体的顶点为 $(0,0)$、$(1,0.1)$、$(1,1.1)$、$(0,1)$，因此左侧中心为\n$$\\boldsymbol{x}_L = \\left( \\frac{0+1+1+0}{4}, \\frac{0+0.1+1.1+1}{4} \\right) = \\left( \\frac{2}{4}, \\frac{2.2}{4} \\right) = \\left( 0.5, \\, 0.55 \\right).$$\n\n右侧控制体的顶点为 $(1,0.1)$、$(2,0.4)$、$(2,1.2)$、$(1,1.1)$，因此右侧中心为\n$$\\boldsymbol{x}_R = \\left( \\frac{1+2+2+1}{4}, \\frac{0.1+0.4+1.2+1.1}{4} \\right) = \\left( \\frac{6}{4}, \\frac{2.8}{4} \\right) = \\left( 1.5, \\, 0.7 \\right).$$\n\n两点通量近似 (TPFA) 使用的法向距离是中心连线向量在面法向上的投影：\n$$d_n = \\left( \\boldsymbol{x}_R - \\boldsymbol{x}_L \\right) \\cdot \\boldsymbol{n} = \\left( (1.5-0.5), \\, (0.7-0.55) \\right) \\cdot (1,0) = 1.$$\n\n单元中心的未知量位于 $\\boldsymbol{x}_L$ 和 $\\boldsymbol{x}_R$ 处，所以我们在此计算 $u$ 的值：\n$$u_L = u(\\boldsymbol{x}_L) = 2 \\cdot 0.5 - 0.55 = 1 - 0.55 = \\frac{9}{20},$$\n$$u_R = u(\\boldsymbol{x}_R) = 2 \\cdot 1.5 - 0.7 = 3 - 0.7 = \\frac{23}{10}.$$\n\n因此，单元中心值的跃变是\n$$u_R - u_L = \\frac{23}{10} - \\frac{9}{20} = \\frac{46 - 9}{20} = \\frac{37}{20}.$$\n\n当 $k=1$ 且表面长度 $|\\Gamma|=1$ 时，从左到右的 TPFA 表面通量为\n$$F_{\\text{TPFA}} = - \\frac{u_R - u_L}{d_n} \\, |\\Gamma| = - \\frac{ \\frac{37}{20} }{1} \\cdot 1 = -\\frac{37}{20}.$$\n\n3. 通量差值。\n\n所求的差值为\n$$\\Delta F \\equiv F_{\\text{TPFA}} - F_{\\text{FEM}} = \\left( -\\frac{37}{20} \\right) - \\left( -2 \\right) = -\\frac{37}{20} + \\frac{40}{20} = \\frac{3}{20}.$$\n\n这个非零值的产生是由于非正交性：中心连线向量相对于表面有一个切向分量，因此两点差 $u_R - u_L$ 包含了 $u$ 的切向变化（此处与 -1 乘以切向偏移 $\\frac{3}{20}$ 成比例），而这部分不属于真正的法向导数。\n\n4. FVM-TPFA、FDM 和 FEM 的对称性与正定性分析。\n\n- 有限元法 (FEM)：协调的 $P_1$ 伽辽金法从双线性形式组装刚度矩阵 $\\boldsymbol{K}$\n$$a(u,v) = \\int_{\\Omega} k \\nabla u \\cdot \\nabla v \\, \\mathrm{d}x.$$\n对于常数 $k>0$，$a(\\cdot,\\cdot)$ 在 $H_0^1(\\Omega)$ 上是对称且强制的，这意味着对于狄利克雷边界条件，组装的离散算子是对称正定的，与网格扭曲无关。此外，对于线性的 $u$，$P_1$ FEM 在每个单元上都是精确的，如上文所用。\n\n- 有限体积法两点通量 (FVM-TPFA)：TPFA 为单元 $i$ 和 $j$ 之间的每个内表面构造一个形式如下的通量\n$$F_{ij} = -T_{ij} \\left( u_j - u_i \\right),$$\n其中传递率 $T_{ij} = T_{ji} > 0$ 取决于表面积、扩散系数和法向距离 $d_n$。在整个网格上进行组装后，得到的矩阵其非对角线项为 $-T_{ij} \\le 0$，对角线项为 $\\sum_{j} T_{ij} > 0$，从而产生一个对称的 M-矩阵。因此，当按照定义应用 TPFA 时（不带非正交修正项），只要网格连通性使得 $T_{ij}>0$，离散算子就是对称正定的。然而，在扭曲的非正交网格上，TPFA 通常与连续算子不一致（如上文非零的 $\\Delta F$ 所示）。恢复一致性的补救措施（例如，添加依赖于切向梯度的非正交修正）通常会引入非对称耦合，并可能危及对称性，在某些情况下还会危及正定性。\n\n- 有限差分法 (FDM)：在结构化的正交网格上，使用中心差分格式离散 $-\\Delta u$ 时，在狄利克雷边界条件下，离散算子是对称正定的（一个对称的 M-矩阵）。在非源自正交结构化网格的扭曲四边形网格上（例如，任意凸四边形），朴素的有限差分法不能直接应用；需要基于坐标变换的离散化或 mimetic/类有限体积的公式。如果没有精心构造以反映对称的变分形式，在扭曲网格上可能会失去对称性。\n\n结论：协调的 $P_1$ FEM 无论网格如何扭曲，都能保持对称性和正定性。FVM-TPFA 作为一个纯粹的两点格式，保持了对称性和正定性，但在非正交网格上不具有一致性，导致本例中出现通量误差 $\\Delta F = \\frac{3}{20}$；恢复一致性的修正通常会破坏对称性。经典的中心差分 FDM 在正交结构化网格上保持对称性和正定性，但将其推广到扭曲的四边形网格需要特别小心才能保留这些性质。", "answer": "$$\\boxed{\\frac{3}{20}}$$", "id": "3372497"}, {"introduction": "从基本性质转向实际应用考量，本练习旨在比较FVM和FEM为实现更高精度所需付出的计算成本。通过分析一个三阶FVM和一个$P_2$ FEM，你将需要计算各自的自由度数量以及精确积分所需的求积点数。这项实践为你提供了一个量化依据，以帮助你理解在内存需求和计算负载方面，不同高阶离散化策略之间的权衡。", "problem": "考虑标量扩散方程 $-\\nabla\\cdot(k\\nabla u)=f$，该方程定义在单位正方形域上，并在一个由 $M\\times M$ 个边长为 $h=\\frac{1}{M}$ 的全等方形控制体组成的均匀笛卡尔网格上进行离散化。假设 $k(x,y)$ 是一个总次数最多为 $1$ 的多项式（即仿射），并且 $f$ 是光滑的。您将设计一种基于逐单元二次重构和面求积的三阶有限体积法（FVM），并将其自由度和求积要求与标准二次 Lagrange 有限元法（FEM）（记为 $P_2$ FEM）进行比较。提及有限差分法（FDM）是为了提供宏观背景，但在本问题的任何计算中均不使用。\n\n使用以下基本定义和建模假设：\n- 在有限体积法中，每个控制体存储一个未知量，代表 $u$ 的单元平均值，并通过在每个面上对 $k\\nabla u\\cdot n$进行积分来计算法向扩散通量。每个单元上 $u$ 的三阶精确重构使用一个二次多项式，因此 $\\nabla u$ 在空间上是线性的。\n- 为保证 FVM 在面段上的通量积分具有三阶精度，一维面求积必须对由重构和系数 $k$ 产生的精确被积函数次数以下的所有多项式都是精确的。对于具有 $n$ 个点的一维 Gauss–Legendre 求积，其精确性对次数最高为 $2n-1$ 的所有多项式都成立。\n- 在协调三角剖分上的 $P_2$ FEM 中，使用三角形上的连续分片二次基函数。在笛卡尔网格的每个正方形上，使用一条一致的对角线将该正方形细分为两个三角形。全局 $P_2$ 自由度的数量等于三角剖分中唯一顶点的数量加上唯一边的数量。每个三角形上的刚度积分涉及形式为 $k\\,(\\nabla\\varphi_i\\cdot\\nabla\\varphi_j)$ 的被积函数，其中 $\\varphi_i$ 和 $\\varphi_j$ 是 $P_2$ 基函数。对于仿射的 $k$，并且由于 $\\nabla\\varphi_i$ 和 $\\nabla\\varphi_j$ 在每个三角形上是线性多项式，被积函数是一个总次数为 $3$ 的多项式。在三角形上，对次数最高为 $3$ 的所有多项式都精确的最小度数精确求积法则需要 $4$ 个点。\n\n任务：\n- 在上述网格上，推导 FVM 的全局自由度数和 $P_2$ FEM 的全局自由度数，表示为 $M$ 的函数。\n- 确定 FVM 中每个面所需的最小一维求积点数，以精确积分由二次重构和仿射 $k$ 产生的面通量被积函数，并计算由此产生的每个正方形的总面求積点数。\n- 确定 $P_2$ FEM 中每个三角形所需的最小三角形求积点数，以精确积分带仿射 $k$ 的刚度被积函数，并计算由此产生的每个正方形的总单元求積点数。\n- 令 $R_{\\mathrm{dof}}(M)$ 为全局 $P_2$ FEM 自由度与全局 FVM 自由度之比。令 $R_{\\mathrm{quad}}$ 为 $P_2$ FEM 刚度积分所需的每个正方形的总求积点数与 FVM 面通量积分所需的总求积点数之比。定义复合比 $S(M)=R_{\\mathrm{dof}}(M)\\,R_{\\mathrm{quad}}$。\n\n计算 $S(M)$，结果为一个关于 $M$ 的单一简化解析表达式。不要包含任何单位。在任何中间计算中不要使用有限差分法。您的最终答案必须是一个单一的封闭形式解析表达式。", "solution": "目标是计算复合比 $S(M) = R_{\\mathrm{dof}}(M) R_{\\mathrm{quad}}$，其中 $R_{\\mathrm{dof}}(M)$ 是 $P_2$ 有限元法（FEM）与三阶有限体积法（FVM）的全局自由度（DoF）之比，而 $R_{\\mathrm{quad}}$ 是两种方法每个方形单元的总求积点数之比。分析在单位域上的一个 $M \\times M$ 方形均匀笛卡尔网格上进行。\n\n首先，我们确定每种方法的全局自由度数。\n\n**1. 有限体积法自由度 ($N_{\\mathrm{FVM}}$)**\n根据问题陈述，FVM 格式在每个控制体存储一个未知量，该未知量代表解 $u$ 的单元平均值。该域被离散化为一个 $M \\times M$ 的控制体网格。因此，FVM 的总自由度数等于控制体的数量。\n$$N_{\\mathrm{FVM}} = M \\times M = M^2$$\n\n**2. 有限元法自由度 ($N_{\\mathrm{FEM}}$)**\n指定的方法是协调三角剖分上的 $P_2$ Lagrange FEM。通过用一条一致的对角线细分笛卡尔网格中的每一个 $M^2$ 正方形来形成三角剖分。$P_2$ 单元的自由度位于每个三角形单元的顶点和边的中点。问题陈述指出，全局自由度数是三角剖分中唯一顶点数和唯一边数之和。这等同于计算网格中唯一节点（顶点和边中点）的总数。\n\n让我们来计算这些节点：\n- **顶点**：三角剖分的顶点是底层 $M \\times M$ 方形网格的顶点。一个 $M \\times M$ 的方形网格在每个方向上有 $(M+1)$ 条线，因此唯一顶点的数量是：\n  $$N_{\\mathrm{vertices}} = (M+1) \\times (M+1) = (M+1)^2$$\n- **边及其中心点**：三角剖分的边由方形网格的水平和垂直边，以及为形成三角形而引入的对角线组成。\n  - 水平边数：有 $(M+1)$ 条水平网格线，每条包含 $M$ 个线段。总数：$M(M+1)$。\n  - 垂直边数：有 $(M+1)$ 条垂直网格线，每条包含 $M$ 个线段。总数：$M(M+1)$。\n  - 对角线边数：$M^2$ 个正方形中的每一个都被一条对角线分割。总数：$M^2$。\n  三角剖分中唯一边的总数是这些计数的总和：\n  $$N_{\\mathrm{edges}} = M(M+1) + M(M+1) + M^2 = 2M^2 + 2M + M^2 = 3M^2 + 2M$$\n- **总自由度**：$P_2$ FEM 的总自由度数是唯一节点的总数，即唯一顶点数和唯一边中点数（等于唯一边数）之和。\n  $$N_{\\mathrm{FEM}} = N_{\\mathrm{vertices}} + N_{\\mathrm{edges}} = (M+1)^2 + (3M^2 + 2M)$$\n  $$N_{\\mathrm{FEM}} = (M^2 + 2M + 1) + (3M^2 + 2M) = 4M^2 + 4M + 1$$\n  这个表达式可以因式分解为：\n  $$N_{\\mathrm{FEM}} = (2M+1)^2$$\n\n接下来，我们确定每种方法每个方形单元所需的求积点数。\n\n**3. 有限体积法求积点 ($Q_{\\mathrm{FVM}}$)**\nFVM 通量是通过在方形控制体的 4 个面上积分 $k \\nabla u \\cdot n$ 来计算的。\n- 系数 $k$ 是一个仿射多项式（总次数为 1）。\n- 在每个单元内，解 $u$被重构为一个二次多项式（次数为 2）。\n- 因此，梯度 $\\nabla u$ 是一个由线性多项式组成的向量（次数为 1）。\n- 面上的被积函数是 $k$ 与 $\\nabla u$ 的一个分量的乘积。当限制在一维面上（例如，一个 $x$ 恒定，$y$ 变化的线段），$k$ 和 $\\nabla u$ 的相关分量都是积分变量的线性函数。\n- 两个线性多项式的乘积是一个二次多项式（次数为 2）。\n- 问题陈述指出，一个 $n$ 点一维 Gauss-Legendre 求积法则对次数最高为 $2n-1$ 的多项式是精确的。为了对一个 2 次多项式精确，我们需要 $2n-1 \\ge 2$，这意味着 $2n \\ge 3$，或 $n \\ge 1.5$。因此，最小的整数点数是 $n=2$。\n- 每个方形控制体有 4 个面。每个正方形的总求积点数是：\n  $$Q_{\\mathrm{FVM}} = 4 \\text{ faces/square} \\times 2 \\text{ points/face} = 8 \\text{ points/square}$$\n\n**4. 有限元法求積点 ($Q_{\\mathrm{FEM}}$)**\nFEM 刚度矩阵项是通过在每个三角形单元上积分 $k \\,(\\nabla\\varphi_i \\cdot \\nabla\\varphi_j)$ 来计算的，其中 $\\varphi_i$ 和 $\\varphi_j$ 是 $P_2$ 基函数。\n- 在每个三角形上，基函数 $\\varphi_i, \\varphi_j$ 是二次多项式（次数为 2）。\n- 它们的梯度 $\\nabla\\varphi_i, \\nabla\\varphi_j$ 是由线性多项式组成的向量（次数为 1）。\n- 点积 $\\nabla\\varphi_i \\cdot \\nabla\\varphi_j$ 是一个总次数最高为 $1+1=2$ 的多项式。\n- 系数 $k$ 是一个仿射多项式（次数为 1）。\n- 被积函数 $k \\,(\\nabla\\varphi_i \\cdot \\nabla\\varphi_j)$ 是一个 1 次多项式和一个 2 次多项式的乘积，结果是一个总次数最高为 $1+2=3$ 的多项式。\n- 问题陈述指出，在三角形上对次数为 3 的多项式精确的最小求積法則需要 4 个点。\n- 每个方形单元被细分为 2 个三角形。每个正方形的总求积点数是：\n  $$Q_{\\mathrm{FEM}} = 2 \\text{ triangles/square} \\times 4 \\text{ points/triangle} = 8 \\text{ points/square}$$\n\n最后，我们计算所需的比率和复合表达式 $S(M)$。\n\n**5. 比率和复合表达式 $S(M)$**\n自由度之比为：\n$$R_{\\mathrm{dof}}(M) = \\frac{N_{\\mathrm{FEM}}}{N_{\\mathrm{FVM}}} = \\frac{(2M+1)^2}{M^2} = \\left(\\frac{2M+1}{M}\\right)^2 = \\left(2 + \\frac{1}{M}\\right)^2$$\n每个正方形的求积点数之比为：\n$$R_{\\mathrm{quad}} = \\frac{Q_{\\mathrm{FEM}}}{Q_{\\mathrm{FVM}}} = \\frac{8}{8} = 1$$\n复合比 $S(M)$ 是这两个比率的乘积：\n$$S(M) = R_{\\mathrm{dof}}(M) \\cdot R_{\\mathrm{quad}} = \\left(2 + \\frac{1}{M}\\right)^2 \\cdot 1 = \\left(2 + \\frac{1}{M}\\right)^2$$\n\n这就是 $S(M)$ 的最终简化解析表达式。", "answer": "$$\\boxed{\\left(2 + \\frac{1}{M}\\right)^2}$$", "id": "3372466"}]}