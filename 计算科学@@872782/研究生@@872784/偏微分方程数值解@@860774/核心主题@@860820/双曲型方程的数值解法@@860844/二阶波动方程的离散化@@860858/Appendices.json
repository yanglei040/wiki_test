{"hands_on_practices": [{"introduction": "数值稳定性是任何时域推进格式成功的先决条件，一个不稳定的格式会产生无物理意义的发散解。本练习将引导你使用冯·诺依曼分析法，这是研究线性、常系数偏微分方程数值格式稳定性的标准工具。通过这个练习，你将亲自推导出著名的 Courant-Friedrichs-Lewy (CFL) 条件，从而深刻理解显式格式中时间步长和空间步长之间必须满足的内在约束。[@problem_id:3278584]", "problem": "考虑一维波动方程（一个二阶双曲型偏微分方程（PDE）），其形式为 $u_{tt} = c^2 u_{xx}$，定义在间距为 $\\Delta x$ 的均匀空间网格和均匀时间步长 $\\Delta t$上。假设通过在网格点 $x_j = j \\Delta x$ 和 $t^n = n \\Delta t$ 处同时对时间和空间应用二阶中心差分来近似 $u_{tt}$ 和 $u_{xx}$，从而构建一个显式有限差分格式。假设采用周期性边界条件，以使离散傅里叶模式可被接受，并定义无量纲的 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda = \\dfrac{c \\Delta t}{\\Delta x}$。\n\n仅从离散格式和线性常系数格式稳定性的适当基本定义出发，确定使得该方法对所有空间傅里叶波数都稳定的 $\\lambda$ 的最大允许值。你的最终答案必须是一个实数。无需四舍五入，最终答案中也无需物理单位。", "solution": "该问题陈述经评估有效。它具有科学依据、适定、客观，并包含足够的信息以获得唯一解。所涉及的概念——一维波动方程、有限差分法和冯·诺伊曼稳定性分析——在数值分析领域是标准且明确定义的。因此，我们可以进行推导。\n\n问题考虑的是一维波动方程，一个二阶双曲型偏微分方程 (PDE)：\n$$\nu_{tt} = c^2 u_{xx}\n$$\n其中 $u$ 是波幅，$t$ 是时间，$x$ 是空间坐标，$c$ 是波速。问题指定了使用二阶中心差分对时间和空间导数进行离散化。令 $U_j^n$ 为 $u(x_j, t^n)$ 的数值近似，其中 $x_j = j \\Delta x$ 且 $t^n = n \\Delta t$。\n\n在点 $(x_j, t^n)$ 处，时间导数 $u_{tt}$ 的二阶中心差分近似为：\n$$\nu_{tt} \\approx \\frac{U_j^{n+1} - 2U_j^n + U_j^{n-1}}{(\\Delta t)^2}\n$$\n在点 $(x_j, t^n)$ 处，空间导数 $u_{xx}$ 的二阶中心差分近似为：\n$$\nu_{xx} \\approx \\frac{U_{j+1}^n - 2U_j^n + U_{j-1}^n}{(\\Delta x)^2}\n$$\n将这些近似代入偏微分方程，得到有限差分方程：\n$$\n\\frac{U_j^{n+1} - 2U_j^n + U_j^{n-1}}{(\\Delta t)^2} = c^2 \\frac{U_{j+1}^n - 2U_j^n + U_{j-1}^n}{(\\Delta x)^2}\n$$\n这个格式是显式的，因为我们可以重新整理它，用当前和之前时间层级的解 $U^n$ 和 $U^{n-1}$ 来求解未来时间层级的解 $U_j^{n+1}$。让我们引入 Courant–Friedrichs–Lewy (CFL) 数，$\\lambda = \\frac{c \\Delta t}{\\Delta x}$。重新整理方程以求解 $U_j^{n+1}$：\n$$\nU_j^{n+1} - 2U_j^n + U_j^{n-1} = \\left( \\frac{c \\Delta t}{\\Delta x} \\right)^2 (U_{j+1}^n - 2U_j^n + U_{j-1}^n)\n$$\n$$\nU_j^{n+1} = 2U_j^n - U_j^{n-1} + \\lambda^2 (U_{j+1}^n - 2U_j^n + U_{j-1}^n)\n$$\n为了分析这个具有周期性边界条件的线性常系数格式的稳定性，我们采用冯·诺伊曼稳定性分析。我们假设一个单傅里叶模式形式的解：\n$$\nU_j^n = G^n e^{i k x_j} = G^n e^{i k j \\Delta x}\n$$\n其中 $k$ 是空间波数，$i = \\sqrt{-1}$，$G = G(k)$是每个时间步的放大因子。为使格式稳定，放大因子的模必须对所有波数 $k$ 满足 $|G| \\le 1$。将傅里叶模式代入有限差分格式：\n$$\nG^{n+1} e^{i k j \\Delta x} = 2G^n e^{i k j \\Delta x} - G^{n-1} e^{i k j \\Delta x} + \\lambda^2 \\left( G^n e^{i k (j+1) \\Delta x} - 2G^n e^{i k j \\Delta x} + G^n e^{i k (j-1) \\Delta x} \\right)\n$$\n除以公共的非零项 $G^{n-1} e^{i k j \\Delta x}$，得到关于 $G$ 的特征方程：\n$$\nG^2 = 2G - 1 + \\lambda^2 G (e^{i k \\Delta x} - 2 + e^{-i k \\Delta x})\n$$\n使用恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$，其中 $\\theta = k \\Delta x$，我们简化括号中的表达式：\n$$\nG^2 = 2G - 1 + \\lambda^2 G (2\\cos(k \\Delta x) - 2)\n$$\n$$\nG^2 = 2G - 1 - 2\\lambda^2 G (1 - \\cos(k \\Delta x))\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\nG^2 = 2G - 1 - 4\\lambda^2 G \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n将此式重新整理成标准二次型 $aG^2+bG+c=0$：\n$$\nG^2 - 2\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)G + 1 = 0\n$$\n该二次方程的根由公式 $G = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 给出：\n$$\nG = \\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right) \\pm \\sqrt{\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)^2 - 1}\n$$\n为了稳定性，我们需要 $|G| \\le 1$。根的乘积是 $G_1 G_2 = c/a = 1$。如果根是实数，为保证稳定性，我们必须有 $|G| \\le 1$，这意味着一个根的模必须大于或等于1，而另一个根的模小于或等于1。只有当两个根的模都恰好为1时，才能避免无界增长。这发生在根等于1或-1的情况下。\n如果根是一对共轭复数，它们的乘积为1意味着它们的模也为1。复数根的条件是二次方程的判别式为负或零。\n$$\n\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)^2 - 1 \\le 0\n$$\n$$\n\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)^2 \\le 1\n$$\n两边取平方根得到：\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1\n$$\n这个不等式代表了两个条件：\n1. $1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1 \\implies -2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 0$。这是恒成立的，因为 $\\lambda^2 \\ge 0$ 并且正弦平方项是非负的。\n2. $-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\implies 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 2 \\implies \\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1$。\n\n这第二个条件，$\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1$，是稳定性的充要条件。它必须对所有可能的空间波数 $k$ 成立。为确保这一点，我们必须考虑“最坏情况”，这对应于使项 $\\sin^2\\left(\\frac{k \\Delta x}{2}\\right)$ 最大化的 $k$ 值。无量纲波数 $\\theta = k \\Delta x$ 的范围可以从 $-\\pi$ 到 $\\pi$。$\\sin^2(\\theta/2)$ 的最大值出现在 $\\theta/2 = \\pm \\pi/2$ 时，即 $\\theta = \\pm \\pi$。这对应于网格上可表示的最高频率模式（奈奎斯特频率）。在这个频率下：\n$$\n\\max \\left[ \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\right] = \\sin^2\\left(\\frac{\\pi}{2}\\right) = 1^2 = 1\n$$\n将这个最大值代入稳定性条件，得到对 $\\lambda$ 最严格的约束：\n$$\n\\lambda^2 \\cdot 1 \\le 1 \\implies \\lambda^2 \\le 1\n$$\n由于 CFL 数 $\\lambda = \\frac{c \\Delta t}{\\Delta x}$ 是用正量（$c, \\Delta t, \\Delta x$）定义的，所以 $\\lambda$ 是非负的。因此，稳定性条件简化为：\n$$\n0 \\le \\lambda \\le 1\n$$\n问题要求的是使方法稳定的 $\\lambda$ 的最大允许值。这是推导出的区间的上界。\n$$\n\\lambda_{\\max} = 1\n$$", "answer": "$$\n\\boxed{1}\n$$", "id": "3278584"}, {"introduction": "一个稳定的数值格式不一定能保证高精度，尤其是在模拟波的传播时。数值频散是常见的误差来源，它导致不同频率的波在离散网格上以错误的速度传播。这个编程实践将让你通过一个精心设计的“恶意”初始条件——网格所能表示的最高频率波，来直观地观察并量化这一效应，从而加深对数值误差本质的理解。[@problem_id:3229319]", "problem": "考虑定义在周期区间 $[0,L)$ 上的一维线性波偏微分方程 (PDE) $u_{tt} = c^2 u_{xx}$，其中 $u(x,t)$ 在时间和空间上二次可微，$c$ 是恒定的波速，$L$ 是域的长度。数值任务是研究一种标准的二阶显式有限差分法的色散特性，其初始条件特意选择为给定空间网格上可以表示的最高频率。\n\n你将使用一个包含 $N$ 个点的均匀网格，空间步长为 $\\Delta x = L/N$，时间步长为 $\\Delta t$。设网格点为 $x_i = i \\,\\Delta x$（其中 $i = 0,1,\\dots,N-1$），时间层级为 $t^n = n \\,\\Delta t$（其中整数 $n \\ge 0$）。使用周期性边界条件，意味着索引对 $N$ 取模。此网格上可表示的最高波数（奈奎斯特模式）为 $k_{\\max} = \\pi/\\Delta x$。将“恶意”初始位移定义为 $u(x,0) = \\cos(k_{\\max} x)$，初始速度定义为 $u_t(x,0) = 0$。该初始条件最大限度地暴露了数值色散，因为它位于离散谱的边缘。\n\n实现一个与 $u_{tt} = c^2 u_{xx}$ 相容的二阶精度显式有限差分方法，在上述网格上对时间和空间均使用中心差分。在近似空间导数时使用周期性边界条件。根据 $u(x,0)$ 初始化 $u^0$，并利用 $u_t(x,0)$ 以及该方法与偏微分方程的相容性来构造 $u^1$，以使整个格式在时间上保持二阶精度。\n\n对于每次模拟，通过利用该模式在固定网格点上的离散时间行为，或通过将演化解 $u^n$ 与初始空间模式 $\\phi_i = \\cos(k_{\\max} x_i)$ 相关联，来估计与奈奎斯特模式相关的数值角频率 $\\omega_{\\text{num}}$。具体来说，对于近似单模的时间序列，利用余弦序列的恒等式从序列 $\\{u^n\\}$ 中估计 $\\cos(\\omega_{\\text{num}} \\Delta t)$，并在多个时间层级上对此估计值进行平均以减少数值噪声。计算由连续偏微分方程为此模式导出的精确角频率 $\\omega_{\\text{exact}} = c\\,k_{\\max}}$。将色散误差度量定义为无量纲浮点数\n$$\nE = \\left| \\frac{\\omega_{\\text{num}}}{\\omega_{\\text{exact}}} - 1 \\right|.\n$$\n\n所有物理量必须使用适当的单位处理：选择 $L$ 的单位为米，$c$ 的单位为米/秒，$\\Delta t$ 的单位为秒；三角函数中的角度以弧度为单位。为保证稳定性，应遵守 Courant–Friedrichs–Lewy (CFL) 条件；定义无量纲的 Courant 数 $s = \\frac{c\\,\\Delta t}{\\Delta x}$，并使用 $s \\le 1$ 的值。\n\n您的程序必须：\n- 使用 $k_{\\max} = \\pi/\\Delta x$ 构造恶意初始条件。\n- 在周期性边界条件下，使用二阶显式中心有限差分法推进解。\n- 根据时间序列估计 $\\omega_{\\text{num}}$ 并为每个测试用例计算 $E$。\n- 将每个 $E$ 四舍五入到 8 位小数。\n\n使用以下测试套件，其中固定 $L$ 和 $c$ 并改变 Courant 数 $s$ 来探究不同机制下的色散：\n- 用例 1：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 0.2$，$n_{\\text{steps}} = 200$。\n- 用例 2：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 0.5$，$n_{\\text{steps}} = 200$。\n- 用例 3：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 0.9$，$n_{\\text{steps}} = 200$。\n- 用例 4：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 1.0$，$n_{\\text{steps}} = 200$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，顺序与上述测试用例相同。例如，输出格式必须为\n$[E_1,E_2,E_3,E_4]$,\n其中每个 $E_j$ 是用例 $j$ 的色散误差，四舍五入到 8 位小数。", "solution": "该问题要求研究一维线性波方程 $u_{tt} = c^2 u_{xx}$ 的标准二阶显式有限差分法的数值色散。分析重点是一个特定的初始条件，即奈奎斯特模式，它是离散网格上可表示的最高频率模式。这个选择最大限度地暴露了格式的色散误差。\n\n首先，我们定义计算域和离散化。空间域是一个周期区间 $[0,L)$，离散化为 $N$ 个点 $x_i = i \\Delta x$（其中 $i=0, 1, \\dots, N-1$），网格间距为 $\\Delta x = L/N$。时间被离散化为多个层级 $t^n = n \\Delta t$，其中 $\\Delta t$ 是时间步长。在网格点 $x_i$ 和时间 $t^n$ 的解表示为 $u_i^n \\approx u(x_i, t^n)$。\n\n偏微分方程 $u_{tt} = c^2 u_{xx}$ 使用对时间和空间导数的二阶精度中心有限差分进行近似：\n$$\n\\frac{\\partial^2 u}{\\partial t^2}\\bigg|_{i,n} \\approx \\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{i,n} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\n将这些表达式代入偏微分方程并重新整理，得到显式时间推进格式，通常称为蛙跳法：\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\left(\\frac{c \\Delta t}{\\Delta x}\\right)^2 (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n令 $s = \\frac{c \\Delta t}{\\Delta x}$ 为无量纲的 Courant 数。该格式可以写成：\n$$\nu_i^{n+1} = 2(1-s^2)u_i^n + s^2(u_{i+1}^n + u_{i-1}^n) - u_i^{n-1}\n$$\n强制执行周期性边界条件，意味着索引对 $N$ 取模，使得 $u_N^n = u_0^n$ 且 $u_{-1}^n = u_{N-1}^n$。此格式在 $s \\le 1$ 时是稳定的。\n\n初始条件被指定为一种旨在探测最坏情况色散的“恶意”模式。初始位移为 $u(x,0) = \\cos(k_{\\max}x)$，其中 $k_{\\max} = \\pi/\\Delta x$ 是奈奎斯特波数。在离散网格上，这变为：\n$$\nu_i^0 = u(x_i, 0) = \\cos(k_{\\max} x_i) = \\cos\\left(\\frac{\\pi}{\\Delta x} i \\Delta x\\right) = \\cos(i\\pi) = (-1)^i\n$$\n这个初始条件对应于一种锯齿状或棋盘状的模式，是网格上可以表示的最高频率波。初始速度为 $u_t(x,0)=0$。\n\n蛙跳法是一种三层方法，需要前两个时间步 $u^n$ 和 $u^{n-1}$ 的数据来计算 $u^{n+1}$。为了找到第一个时间步的解 $u^1$，我们必须使用一种不同的方法来保持格式的二阶精度。使用 $u(x,t)$ 在 $t=0$ 附近的泰勒级数展开：\n$$\nu(x, \\Delta t) = u(x,0) + \\Delta t \\, u_t(x,0) + \\frac{(\\Delta t)^2}{2} u_{tt}(x,0) + O((\\Delta t)^3)\n$$\n利用初始条件 $u_t(x,0)=0$ 和偏微分方程本身 $u_{tt}(x,0) = c^2 u_{xx}(x,0)$，我们得到：\n$$\nu(x, \\Delta t) \\approx u(x,0) + \\frac{c^2 (\\Delta t)^2}{2} u_{xx}(x,0)\n$$\n在空间上离散化此表达式，得到 $u_i^1$ 的公式：\n$$\nu_i^1 = u_i^0 + \\frac{s^2}{2} (u_{i+1}^0 - 2u_i^0 + u_{i-1}^0) = (1-s^2)u_i^0 + \\frac{s^2}{2}(u_{i+1}^0 + u_{i-1}^0)\n$$\n在确定了 $u^0$ 和 $u^1$ 之后，主蛙跳循环就可以对所有后续时间步进行。\n\n为了量化色散误差，我们必须估计数值角频率 $\\omega_{\\text{num}}$，并将其与精确角频率 $\\omega_{\\text{exact}}$ 进行比较。对于波数为 $k$ 的波，连续偏微分方程意味着线性色散关系 $\\omega = c k$。对于奈奎斯特模式，这给出：\n$$\n\\omega_{\\text{exact}} = c k_{\\max} = \\frac{c \\pi}{\\Delta x}\n$$\n对于指定的初始条件，数值解预期会按 $u_i^n \\approx (-1)^i \\cos(\\omega_{\\text{num}} n \\Delta t)$ 的形式演化。该模式随时间变化的振幅 $A_n = \\cos(\\omega_{\\text{num}} n \\Delta t)$，可以通过将数值解向量 $U^n = \\{u_i^n\\}_{i=0}^{N-1}$ 投影到初始模式形状向量 $\\phi = \\{(-1)^i\\}_{i=0}^{N-1}$ 上来分离：\n$$\nA_n = \\frac{1}{N} \\sum_{i=0}^{N-1} u_i^n \\phi_i\n$$\n序列 $\\{A_n\\}$ 遵循余弦的三项递推关系：$A_{n+1} + A_{n-1} = 2 A_n \\cos(\\omega_{\\text{num}} \\Delta t)$。我们可以重新整理这个关系式来估计相位步长的余弦值：\n$$\n\\cos(\\omega_{\\text{num}} \\Delta t) = \\frac{A_{n+1} + A_{n-1}}{2 A_n}\n$$\n通过为每个时间步 $n$（其中 $A_n$ 不接近于零）计算此量，并对结果进行平均，我们得到一个稳健的估计值 $\\cos_{\\text{est}}$。然后通过以下方式恢复数值角频率：\n$$\n\\omega_{\\text{num}} = \\frac{1}{\\Delta t} \\arccos(\\cos_{\\text{est}})\n$$\n最后，色散误差度量 $E$ 计算为数值频率与精确频率之间的相对差异：\n$$\nE = \\left| \\frac{\\omega_{\\text{num}}}{\\omega_{\\text{exact}}} - 1 \\right|\n$$\n对每组给定的参数重复此过程，以分析色散误差如何随 Courant 数 $s$ 变化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the wave equation for the Nyquist mode to analyze numerical dispersion.\n    \"\"\"\n    # test_cases: (L, c, N, s, n_steps)\n    test_cases = [\n        (1.0, 1.0, 128, 0.2, 200),\n        (1.0, 1.0, 128, 0.5, 200),\n        (1.0, 1.0, 128, 0.9, 200),\n        (1.0, 1.0, 128, 1.0, 200),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, c, N, s, n_steps = case\n\n        # Grid and simulation parameters\n        dx = L / N\n        dt = s * dx / c\n        \n        # Store solution history\n        u_history = np.zeros((n_steps + 1, N))\n\n        # Initial condition u^0: Nyquist mode u(x,0) = cos(pi*x/dx)\n        # u_i^0 = cos(pi * i*dx / dx) = cos(i*pi) = (-1)^i\n        u_curr = np.array([(-1)**i for i in range(N)], dtype=float)\n        u_history[0, :] = u_curr\n        \n        # First time step u^1, using u_t(x,0) = 0\n        # u_i^1 = (1-s^2)u_i^0 + (s^2/2)(u_{i+1}^0 + u_{i-1}^0)\n        u_prev = np.copy(u_curr) # This will be u^0\n        u_ip1 = np.roll(u_curr, -1)\n        u_im1 = np.roll(u_curr, 1)\n        u_curr = (1 - s**2) * u_curr + (s**2 / 2.0) * (u_ip1 + u_im1)\n        u_history[1, :] = u_curr\n\n        # Main loop (leapfrog scheme)\n        for n in range(1, n_steps):\n            u_ip1 = np.roll(u_curr, -1)\n            u_im1 = np.roll(u_curr, 1)\n            u_next = 2.0 * (1.0 - s**2) * u_curr + s**2 * (u_ip1 + u_im1) - u_prev\n            \n            u_prev = np.copy(u_curr)\n            u_curr = np.copy(u_next)\n            u_history[n + 1, :] = u_curr\n\n        # Post-processing: Estimate numerical frequency\n        # Initial mode shape\n        phi = np.array([(-1)**i for i in range(N)], dtype=float)\n        \n        # Project solution onto the mode shape to get amplitudes A_n\n        # A_n = dot(u_n, phi) / N\n        amplitudes = np.dot(u_history, phi) / N\n\n        cos_estimates = []\n        # Estimate cos(omega_num * dt) from the amplitude recurrence\n        # cos(theta) = (A_{n+1} + A_{n-1}) / (2 * A_n)\n        for n in range(1, n_steps):\n            # Avoid division by zero or small numbers\n            if abs(amplitudes[n]) > 1e-10:\n                cos_est = (amplitudes[n+1] + amplitudes[n-1]) / (2.0 * amplitudes[n])\n                cos_estimates.append(cos_est)\n\n        if not cos_estimates:\n             # Fallback if no valid estimates could be made (highly unlikely)\n             # Use the analytical dispersion relation for the Nyquist mode\n             avg_cos_est = 1.0 - 2.0 * s**2\n        else:\n             avg_cos_est = np.mean(cos_estimates)\n\n        # Clip to handle potential floating-point errors pushing value outside [-1, 1]\n        avg_cos_est = np.clip(avg_cos_est, -1.0, 1.0)\n        \n        omega_num = np.arccos(avg_cos_est) / dt\n\n        # Calculate exact frequency and dispersion error\n        k_max = np.pi / dx\n        omega_exact = c * k_max\n        \n        # Ensure omega_exact is not zero to avoid division errors\n        if abs(omega_exact)  1e-12:\n            dispersion_error = 0.0 if abs(omega_num)  1e-12 else np.inf\n        else:\n            dispersion_error = abs(omega_num / omega_exact - 1.0)\n            \n        results.append(round(dispersion_error, 8))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3229319"}, {"introduction": "在认识到标准二阶格式的频散误差后，一个自然的问题是如何改进它。本练习将带你进入高级数值方法设计的领域，通过构建一个四阶紧致差分格式来解决这个问题。你不仅需要推导格式的系数，还将通过最小化相速度误差来优化其自由参数，这展示了从数值方法的使用者到设计者所需具备的关键技能。[@problem_id:3381690]", "problem": "考虑在一维周期性域上的声波方程 $u_{tt} = c^{2} u_{xx}$，其空间网格间距为均匀的 $h$，时间步长为 $\\Delta t$。使用中心二阶有限差分（FD）格式对时间进行离散化，并使用如下形式的三点紧致四阶有限差分（FD）模板来近似空间二阶导数 $u_{xx}$：\n$$\n\\alpha\\, u''_{j-1} + u''_{j} + \\alpha\\, u''_{j+1}\n= \\frac{1}{h^{2}}\\Big[ A\\,(u_{j-1} - 2 u_{j} + u_{j+1}) + B\\,(u_{j-2} - 2 u_{j} + u_{j+2})\\Big],\n$$\n其中 $\\alpha$ 是一个自由实数参数，$A$ 和 $B$ 是待定的实系数，其选择应使得空间截断误差为四阶。此处 $u''_{j}$ 表示在网格点 $x_{j} = j h$ 处对 $u_{xx}$ 的离散近似。\n\n从泰勒展开和离散傅里叶分析的基本定义出发，在不引入任何未声明假设的情况下，完成以下任务：\n\n- 通过将在 $x_j$ 处模板的泰勒级数系数与连续算子 $u_{xx}$ 的系数进行匹配，来强制实现四阶相容性，并将 $A$ 和 $B$ 用 $\\alpha$ 表示。\n\n- 对全离散格式\n$$\n\\frac{u^{n+1}_{j} - 2 u^{n}_{j} + u^{n-1}_{j}}{\\Delta t^{2}} = c^{2}\\, u''^{\\,n}_{j},\n$$\n采用平面波拟设 $u^{n}_{j} = \\widehat{u}\\, \\exp\\!\\big(i (j \\theta - n \\omega \\Delta t)\\big)$（其中 $\\theta = k h$，$k$ 为物理波数）进行离散傅里叶（冯·诺依曼）分析。推导由此得到的 $\\omega$ 和 $k$ 之间的隐式色散关系，并确定一个实数非负的修正波数 $\\tilde{k}(h)$，使得该色散关系可以写成如下形式：\n$$\n\\frac{2}{\\Delta t}\\,\\sin\\!\\Big(\\frac{\\omega \\Delta t}{2}\\Big) = \\pm\\, c\\, \\tilde{k}(h).\n$$\n\n- 定义无量纲修正波数 $\\tilde{\\theta}(\\theta;\\alpha) = h\\, \\tilde{k}(h)$，并求出其关于小 $\\theta$ 的展开式，直到并包含 $\\theta^5$ 阶项。仅使用此展开式，构造在频带 $\\theta \\in [0, \\pi/2]$ 上平均的相位误差平方的主阶贡献，并确定使该贡献最小化的 $\\alpha$ 值。你必须证明为什么最小化 $\\tilde{\\theta}(\\theta;\\alpha) - \\theta$ 展开式中 $\\theta^5$ 项的系数能够实现在该频带上的所述主阶最小化。\n\n将 $\\alpha$ 的最优值报告为一个精确的数字。不需要进行数值舍入，最终答案不包含单位。", "solution": "该问题是有效的，因为它科学地基于偏微分方程数值分析的原理，是适定的、客观且自洽的。\n\n第一个任务是通过要求空间离散化具有四阶精度，来确定系数 $A$ 和 $B$ 关于参数 $\\alpha$ 的表达式。给定的模板将相邻点上的离散二阶导数 $u''$ 与函数值 $u$ 联系起来：\n$$\n\\alpha\\, u''_{j-1} + u''_{j} + \\alpha\\, u''_{j+1} = \\frac{1}{h^{2}}\\Big[ A\\,(u_{j-1} - 2 u_{j} + u_{j+1}) + B\\,(u_{j-2} - 2 u_{j} + u_{j+2})\\Big]\n$$\n为实现四阶精度，我们将所有项在点 $x_j=jh$ 附近进行泰勒级数展开，并代入该关系式进行分析。设 $u$ 是一个足够光滑的函数，并令 $u^{(n)}_j$ 表示其在 $x_j$ 处的 $n$ 阶导数。\n左边 (LHS) 可以展开为：\n$$\n\\text{LHS} = \\alpha u'' (x_j-h) + u''(x_j) + \\alpha u''(x_j+h)\n$$\n使用 $u''(x_j \\pm h)$ 的泰勒展开：\n$$\nu''(x_j \\pm h) = u''_j \\pm h u'''_j + \\frac{h^2}{2} u''''_j \\pm \\frac{h^3}{6} u^{(5)}_j + \\frac{h^4}{24} u^{(6)}_j + \\mathcal{O}(h^5)\n$$\nLHS 变为：\n$$\n\\text{LHS} = \\alpha\\left(u''_j - h u'''_j + \\frac{h^2}{2} u''''_j - \\frac{h^3}{6} u^{(5)}_j + \\frac{h^4}{24} u^{(6)}_j \\right) + u''_j + \\alpha\\left(u''_j + h u'''_j + \\frac{h^2}{2} u''''_j + \\frac{h^3}{6} u^{(5)}_j + \\frac{h^4}{24} u^{(6)}_j \\right) + \\mathcal{O}(h^6)\n$$\n$$\n\\text{LHS} = (1+2\\alpha) u''_j + \\alpha h^2 u''''_j + \\frac{\\alpha h^4}{12} u^{(6)}_j + \\mathcal{O}(h^6)\n$$\n右边 (RHS) 涉及有限差分算子。我们展开 $u_{j\\pm 1}$ 和 $u_{j\\pm 2}$ 各项：\n$$\nu_{j+1} - 2u_j + u_{j-1} = h^2 u''_j + \\frac{h^4}{12}u''''_j + \\frac{h^6}{360}u^{(6)}_j + \\mathcal{O}(h^8)\n$$\n$$\nu_{j+2} - 2u_j + u_{j-2} = (2h)^2 u''_j + \\frac{(2h)^4}{12}u''''_j + \\frac{(2h)^6}{360}u^{(6)}_j + \\mathcal{O}(h^8) = 4h^2 u''_j + \\frac{4h^4}{3}u''''_j + \\frac{8h^6}{45}u^{(6)}_j + \\mathcal{O}(h^8)\n$$\n将这些代入 RHS 表达式：\n$$\n\\text{RHS} = \\frac{1}{h^2}\\left[ A\\left(h^2 u''_j + \\frac{h^4}{12}u''''_j + \\frac{h^6}{360}u^{(6)}_j\\right) + B\\left(4h^2 u''_j + \\frac{4h^4}{3}u''''_j + \\frac{8h^6}{45}u^{(6)}_j\\right) \\right] + \\mathcal{O}(h^6)\n$$\n$$\n\\text{RHS} = (A+4B)u''_j + \\left(\\frac{A}{12}+\\frac{4B}{3}\\right)h^2 u''''_j + \\left(\\frac{A}{360}+\\frac{8B}{45}\\right)h^4 u^{(6)}_j + \\mathcal{O}(h^6)\n$$\n令 LHS 和 RHS 相等，并匹配导数 $u''_j, u''''_j, \\dots$ 的系数，我们得到一个方程组。为使该算子以四阶精度近似二阶导数 $u''$，$u''_j$ 和 $u''''_j$ 的系数必须匹配，而主误差项（涉及 $u^{(6)}_j$）的系数将定义截断误差。\n匹配 $u''_j$ 的系数：\n$$\n1+2\\alpha = A+4B\n$$\n匹配 $u''''_j$ 的系数：\n$$\n\\alpha h^2 = \\left(\\frac{A}{12}+\\frac{4B}{3}\\right)h^2 \\implies \\alpha = \\frac{A+16B}{12} \\implies 12\\alpha = A+16B\n$$\n我们现在求解这个关于 $A$ 和 $B$ 的线性系统。第二个方程减去第一个方程得到：\n$$\n(A+16B) - (A+4B) = 12\\alpha - (1+2\\alpha) \\implies 12B = 10\\alpha - 1 \\implies B = \\frac{10\\alpha-1}{12}\n$$\n将 $B$ 代回第一个方程：\n$$\nA = 1+2\\alpha - 4B = 1+2\\alpha - 4\\left(\\frac{10\\alpha-1}{12}\\right) = 1+2\\alpha - \\frac{10\\alpha-1}{3} = \\frac{3(1+2\\alpha)-(10\\alpha-1)}{3} = \\frac{3+6\\alpha-10\\alpha+1}{3} = \\frac{4-4\\alpha}{3}\n$$\n所以，系数为 $A = \\frac{4(1-\\alpha)}{3}$ 和 $B = \\frac{10\\alpha-1}{12}$。\n\n接下来，我们对全离散格式进行离散傅里叶（冯·诺依曼）分析：\n$$\n\\frac{u^{n+1}_{j} - 2 u^{n}_{j} + u^{n-1}_{j}}{\\Delta t^{2}} = c^{2}\\, u''^{\\,n}_{j}\n$$\n我们代入平面波拟设 $u^{n}_{j} = \\widehat{u}\\, \\exp(i(j\\theta - n\\omega\\Delta t))$，其中 $\\theta=kh$。\n对于 LHS（时间导数）：\n$$\n\\frac{\\widehat{u}e^{i(j\\theta - n\\omega\\Delta t)}(e^{-i\\omega\\Delta t} - 2 + e^{i\\omega\\Delta t})}{\\Delta t^2} = \\frac{u^n_j(2\\cos(\\omega\\Delta t)-2)}{\\Delta t^2} = -\\frac{4u^n_j \\sin^2(\\omega\\Delta t/2)}{\\Delta t^2}\n$$\n对于 RHS（空间算子），我们首先找到 $u''$ 的傅里叶符号。设 $u''^n_j = \\hat{u}''(\\theta) u^n_j$。将它和 $u^n_j$ 代入空间模板的定义中：\n$$\n\\hat{u}''(\\theta) u^n_j (\\alpha e^{-i\\theta} + 1 + \\alpha e^{i\\theta}) = \\frac{u^n_j}{h^2}\\Big[ A(e^{-i\\theta} - 2 + e^{i\\theta}) + B(e^{-i2\\theta} - 2 + e^{i2\\theta})\\Big]\n$$\n$$\n\\hat{u}''(\\theta) (1+2\\alpha\\cos\\theta) = \\frac{1}{h^2}\\Big[ A(2\\cos\\theta-2) + B(2\\cos(2\\theta)-2)\\Big]\n$$\n$$\n\\hat{u}''(\\theta) = \\frac{2}{h^2} \\frac{A(\\cos\\theta-1) + B(\\cos(2\\theta)-1)}{1+2\\alpha\\cos\\theta}\n$$\n令波动方程经过傅里叶变换后的 LHS 和 RHS 相等：\n$$\n-\\frac{4 \\sin^2(\\omega\\Delta t/2)}{\\Delta t^2} = c^2 \\hat{u}''(\\theta) = c^2 \\frac{2}{h^2} \\frac{A(\\cos\\theta-1) + B(\\cos(2\\theta)-1)}{1+2\\alpha\\cos\\theta}\n$$\n问题要求色散关系的形式为 $\\frac{2}{\\Delta t}\\,\\sin(\\frac{\\omega \\Delta t}{2}) = \\pm\\, c\\, \\tilde{k}(h)$。将其平方得到 $\\frac{4}{\\Delta t^2}\\sin^2(\\frac{\\omega \\Delta t}{2}) = c^2 \\tilde{k}(h)^2$。将此与我们推导出的色散关系进行比较，我们确定：\n$$\n\\tilde{k}(h)^2 = - \\hat{u}''(\\theta) = -\\frac{2}{h^2} \\frac{A(\\cos\\theta-1) + B(\\cos(2\\theta)-1)}{1+2\\alpha\\cos\\theta}\n$$\n使用恒等式 $\\cos\\theta-1 = -2\\sin^2(\\theta/2)$ 和 $\\cos(2\\theta)-1=-2\\sin^2\\theta=-8\\sin^2(\\theta/2)\\cos^2(\\theta/2)$：\n$$\n\\tilde{k}(h)^2 = -\\frac{2}{h^2} \\frac{A(-2\\sin^2(\\theta/2)) + B(-8\\sin^2(\\theta/2)\\cos^2(\\theta/2))}{1+2\\alpha\\cos\\theta} = \\frac{4\\sin^2(\\theta/2)}{h^2} \\frac{A + 4B\\cos^2(\\theta/2)}{1+2\\alpha\\cos\\theta}\n$$\n取平方根（并注意 $\\tilde{k}$ 是实数且非负）：\n$$\n\\tilde{k}(h) = \\frac{2}{h} \\sin(\\theta/2) \\sqrt{\\frac{A + 4B\\cos^2(\\theta/2)}{1+2\\alpha\\cos\\theta}}\n$$\n这就是修正波数 $\\tilde{k}(h)$ 的表达式。\n\n最后，我们分析无量纲修正波数 $\\tilde{\\theta}(\\theta;\\alpha) = h \\tilde{k}(h)$。我们有 $\\tilde{\\theta}^2 = h^2 \\tilde{k}(h)^2 = -h^2 \\hat{u}''(\\theta)$。我们对小 $\\theta$ 展开 $\\tilde{\\theta}^2$。从泰勒级数匹配中，我们发现对光滑函数上的算子取等号可得：\n$$\n(1+2\\alpha) u''_j + \\alpha h^2 u''''_j + \\frac{\\alpha h^4}{12}u^{(6)}_j + \\dots = (A+4B)u''_j + \\frac{A+16B}{12}h^2u''''_j + \\frac{A+64B}{360}h^4u^{(6)}_j + \\dots\n$$\n代入 $A+4B=1+2\\alpha$ 和 $A+16B=12\\alpha$，这个关系定义了将 $u''$ 映射到 $u$ 的差分的算子的截断误差。该算子本身给出了作为 $u$ 的函数的 $u''$。该算子的符号是 $-k^2_{eff} = -\\tilde{k}^2 = -\\tilde{\\theta}^2/h^2$。所以 $\\tilde{\\theta}^2$ 是数值二阶导数算子符号的负值（乘以 $h^2$）。从模板的傅里叶分析可知：\n$$\n\\tilde{\\theta}^2 = -h^2\\hat{u}''(\\theta) = - \\frac{2(A(\\cos\\theta-1)+B(\\cos(2\\theta)-1))}{1+2\\alpha\\cos\\theta}\n$$\n我们对小 $\\theta=kh$ 展开分子 $N(\\theta)$ 和分母 $D(\\theta)$：\n$N(\\theta) = -2[A(-\\frac{\\theta^2}{2}+\\frac{\\theta^4}{24}-\\frac{\\theta^6}{720}) + B(-2\\theta^2+\\frac{2\\theta^4}{3}-\\frac{4\\theta^6}{45})] + \\mathcal{O}(\\theta^8) = (A+4B)\\theta^2 - (\\frac{A}{12}+\\frac{4B}{3})\\theta^4 + (\\frac{A}{360}+\\frac{8B}{45})\\theta^6 + \\mathcal{O}(\\theta^8)$。\n$D(\\theta) = 1+2\\alpha\\cos\\theta = 1+2\\alpha(1-\\frac{\\theta^2}{2}+\\frac{\\theta^4}{24}-\\dots) = (1+2\\alpha)-\\alpha\\theta^2+\\frac{\\alpha}{12}\\theta^4+\\mathcal{O}(\\theta^6)$。\n使用 $A+4B=1+2\\alpha$ 和 $A+16B=12\\alpha$，可得 $\\frac{A}{12}+\\frac{4B}{3}=\\alpha$：\n$N(\\theta) = (1+2\\alpha)\\theta^2 - \\alpha\\theta^4 + \\frac{A+64B}{360}\\theta^6 + \\mathcal{O}(\\theta^8)$。\n我们来计算 $A+64B = \\frac{4-4\\alpha}{3} + 64\\frac{10\\alpha-1}{12} = \\frac{4-4\\alpha}{3} + \\frac{16(10\\alpha-1)}{3} = \\frac{4-4\\alpha+160\\alpha-16}{3} = 52\\alpha-4$。\n所以，$N(\\theta)=(1+2\\alpha)\\theta^2 - \\alpha\\theta^4 + \\frac{52\\alpha-4}{360}\\theta^6 + \\mathcal{O}(\\theta^8)$。\n现在，$\\tilde{\\theta}^2 = \\frac{N(\\theta)}{D(\\theta)} = \\frac{(1+2\\alpha)\\theta^2 - \\alpha\\theta^4 + \\frac{52\\alpha-4}{360}\\theta^6 + \\dots}{(1+2\\alpha) - \\alpha\\theta^2 + \\frac{\\alpha}{12}\\theta^4+\\dots}$。\n进行除法展开：\n$\\tilde{\\theta}^2 = \\theta^2 + \\frac{1}{1+2\\alpha}\\left[\\left(\\frac{52\\alpha-4}{360}\\right) - \\frac{\\alpha}{12}\\right]\\theta^6 + \\mathcal{O}(\\theta^8) = \\theta^2 + \\frac{52\\alpha-4-30\\alpha}{360(1+2\\alpha)}\\theta^6 + \\mathcal{O}(\\theta^8) = \\theta^2 + \\frac{22\\alpha-4}{360(1+2\\alpha)}\\theta^6 + \\mathcal{O}(\\theta^8)$。\n为了求 $\\tilde{\\theta}$，我们取平方根：\n$\\tilde{\\theta} = \\sqrt{\\theta^2 + \\frac{22\\alpha-4}{360(1+2\\alpha)}\\theta^6 + \\dots} = \\theta\\left(1 + \\frac{22\\alpha-4}{360(1+2\\alpha)}\\theta^4 + \\dots\\right)^{1/2}$。\n对小 $x$ 使用 $(1+x)^{1/2} \\approx 1+x/2$：\n$\\tilde{\\theta} \\approx \\theta\\left(1 + \\frac{1}{2}\\frac{22\\alpha-4}{360(1+2\\alpha)}\\theta^4\\right) = \\theta + \\frac{11\\alpha-2}{360(1+2\\alpha)}\\theta^5$。\n这是 $\\tilde{\\theta}$ 直到 $\\mathcal{O}(\\theta^5)$ 阶项的展开式。相位误差为 $E(\\theta;\\alpha) = \\tilde{\\theta} - \\theta$。其对于小 $\\theta$ 的主阶项是：\n$E(\\theta;\\alpha) \\approx K(\\alpha)\\theta^5$，其中 $K(\\alpha) = \\frac{11\\alpha-2}{360(1+2\\alpha)}$。\n问题要求最小化在频带 $\\theta \\in [0, \\pi/2]$ 上平均的相位误差平方的主阶贡献。该误差由积分 $\\int_0^{\\pi/2}(\\tilde{\\theta}-\\theta)^2 d\\theta$ 给出。\n对于小 $\\theta$，被积函数的主阶行为是 $(K(\\alpha)\\theta^5)^2 = K(\\alpha)^2 \\theta^{10}$。因此，对积分的主阶贡献是 $\\int_0^{\\pi/2} K(\\alpha)^2 \\theta^{10}d\\theta = K(\\alpha)^2 [\\frac{\\theta^{11}}{11}]_0^{\\pi/2} = K(\\alpha)^2 \\frac{(\\pi/2)^{11}}{11}$。\n要最小化这个量，我们必须最小化 $K(\\alpha)^2$，因为其余部分是一个正常数。$K(\\alpha)^2$ 的最小值是 $0$，这当且仅当 $K(\\alpha)=0$ 时发生。这种 $\\alpha$ 的选择消除了 $\\mathcal{O}(\\theta^5)$ 误差项，使得相位误差为 $\\mathcal{O}(\\theta^7)$ 阶，从而为更宽的波数频带产生一个更精确的格式。\n将系数 $K(\\alpha)$ 设为零：\n$$\n\\frac{11\\alpha-2}{360(1+2\\alpha)} = 0 \\implies 11\\alpha - 2 = 0\n$$\n这得出了 $\\alpha$ 的最优值：\n$$\n\\alpha = \\frac{2}{11}\n$$\n这个值不会使分母 $1+2\\alpha$ 为零，因此它是一个有效的解。", "answer": "$$\\boxed{\\frac{2}{11}}$$", "id": "3381690"}]}