{"hands_on_practices": [{"introduction": "在观察到数值行为的差异后，我们自然会探究其背后的数学原理。本练习将引导您深入分析格式的局部截断误差，这是衡量数值精度的理论基石。通过泰勒展开，您将揭示中心差分格式的高精度来源以及迎风格式引入的数值黏性，并理解佩克莱数 $Pe$ 如何决定这些误差项的相对重要性，从而为设计自适应格式提供理论依据[@problem_id:3430230]。", "problem": "考虑一维稳态对流扩散方程\n$$- \\nu\\, u''(x) + a\\, u'(x) = f(x),$$\n该方程定义在一个光滑的求解域上，使用间距为 $$\\Delta x > 0$$ 的均匀网格，且参数 $$\\nu > 0$$ 和 $$a > 0$$ 为常数。假设 $$u \\in C^{4}$$，因此所有直至四阶的导数都存在且有界。定义单元佩克莱数（Péclet number）为\n$$Pe = \\frac{a\\, \\Delta x}{\\nu}.$$\n使用标准的二阶中心差分格式离散化扩散项，并考虑在网格点 $$x_i$$ 处对流项的两种备选方案：\n- $$u'(x_i)$$ 的二阶中心差分格式，以及\n- 当 $$a > 0$$ 时，$$u'(x_i)$$ 的一阶迎风（后向）差分格式。\n从关于 $$x_i$$ 的泰勒展开出发，推导两种离散化方案在 $$x_i$$ 处的局部截断误差，直至并包含其首个非零项，结果用 $$u^{(k)}(x_i)$$、$$\\nu$$、$$a$$ 和 $$\\Delta x$$ 表示。然后，在一个数据驱动建模场景的启发下，假设对高分辨率训练场进行回归分析得到了条件期望\n$$\\mathbb{E}\\!\\left[\\frac{|u^{(3)}(x_i)|}{|u''(x_i)|}\\,\\Big|\\,Pe\\right] = c\\, \\frac{Pe}{\\Delta x},$$\n其中拟合常数 $$c = 1.72$$ 在所关注的工作范围内有效。利用此模型，通过令中心差分和迎风差分格式的主导对流截断误差的期望大小相等，来提出一个自动的格式切换阈值，并求解该阈值 $$Pe^{\\ast}$$。将您的最终答案表示为一个纯数（无单位），并四舍五入到四位有效数字。", "solution": "根据指定标准，该问题被评估为有效。它具有科学依据，是适定的、客观的，并包含足够的信息来推导出唯一解。\n\n目标是找到一个阈值佩克莱数 $Pe^{\\ast}$，用于在一维稳态对流扩散方程中，对流项在中心差分格式和迎风差分格式之间进行切换。该方程由\n$$ - \\nu\\, u''(x) + a\\, u'(x) = f(x) $$\n给出，其中参数 $\\nu > 0$ 和 $a > 0$ 为常数。阈值 $Pe^{\\ast}$ 是通过令两种格式的主导对流截断误差的期望大小相等来确定的。\n\n首先，我们推导在网格点 $x_i$ 处对流项 $a u'(x)$ 的离散化的局部截断误差。我们使用 $u(x)$ 在 $x_i$ 附近的泰勒级数展开，假设解 $u$ 足够光滑 ($u \\in C^4$)。令 $u_i = u(x_i)$，$u_{i+1} = u(x_i + \\Delta x)$，以及 $u_{i-1} = u(x_i - \\Delta x)$。展开式为：\n$$ u_{i+1} = u_i + u'_i \\Delta x + \\frac{u''_i}{2!} (\\Delta x)^2 + \\frac{u'''_i}{3!} (\\Delta x)^3 + \\frac{u^{(4)}_i}{4!} (\\Delta x)^4 + O((\\Delta x)^5) $$\n$$ u_{i-1} = u_i - u'_i \\Delta x + \\frac{u''_i}{2!} (\\Delta x)^2 - \\frac{u'''_i}{3!} (\\Delta x)^3 + \\frac{u^{(4)}_i}{4!} (\\Delta x)^4 + O((\\Delta x)^5) $$\n\n问题要求考虑一阶导数项 $u'(x_i)$ 的两种离散化方法。\n\n1.  **二阶中心差分格式：**\n    $u'(x_i)$ 的近似由 $\\frac{u_{i+1} - u_{i-1}}{2\\Delta x}$ 给出。为了求截断误差，我们代入泰勒展开式：\n    $$ u_{i+1} - u_{i-1} = \\left(u_i + u'_i \\Delta x + \\frac{u''_i}{2}(\\Delta x)^2 + \\frac{u'''_i}{6}(\\Delta x)^3 + \\dots\\right) - \\left(u_i - u'_i \\Delta x + \\frac{u''_i}{2}(\\Delta x)^2 - \\frac{u'''_i}{6}(\\Delta x)^3 + \\dots\\right) $$\n    $$ u_{i+1} - u_{i-1} = 2u'_i \\Delta x + \\frac{2u'''_i}{6}(\\Delta x)^3 + O((\\Delta x)^5) = 2u'_i \\Delta x + \\frac{u'''_i}{3}(\\Delta x)^3 + O((\\Delta x)^5) $$\n    除以 $2\\Delta x$ 得到离散化导数的表达式：\n    $$ \\frac{u_{i+1} - u_{i-1}}{2\\Delta x} = u'_i + \\frac{u'''_i}{6}(\\Delta x)^2 + O((\\Delta x)^4) $$\n    对流项的局部截断误差 $\\tau_{conv}^{CD}$ 是离散项与精确项之差：\n    $$ \\tau_{conv}^{CD} = a \\left(\\frac{u_{i+1} - u_{i-1}}{2\\Delta x}\\right) - a u'_i = a \\left(u'_i + \\frac{u'''_i}{6}(\\Delta x)^2 + O((\\Delta x)^4)\\right) - a u'_i $$\n    中心差分格式的对流截断误差的首个非零项是：\n    $$ \\tau_{conv, leading}^{CD} = a \\frac{u'''(x_i)}{6}(\\Delta x)^2 $$\n\n2.  **一阶迎风（后向）差分格式：**\n    由于 $a > 0$，迎风方向与流动方向相反，因此我们使用后向差分。$u'(x_i)$ 的近似为 $\\frac{u_i - u_{i-1}}{\\Delta x}$。使用 $u_{i-1}$ 的泰勒展开式：\n    $$ \\frac{u_i - u_{i-1}}{\\Delta x} = \\frac{1}{\\Delta x} \\left(u_i - \\left(u_i - u'_i \\Delta x + \\frac{u''_i}{2}(\\Delta x)^2 - \\frac{u'''_i}{6}(\\Delta x)^3 + \\dots\\right)\\right) $$\n    $$ \\frac{u_i - u_{i-1}}{\\Delta x} = \\frac{1}{\\Delta x} \\left(u'_i \\Delta x - \\frac{u''_i}{2}(\\Delta x)^2 + \\frac{u'''_i}{6}(\\Delta x)^3 - \\dots\\right) = u'_i - \\frac{u''_i}{2}\\Delta x + O((\\Delta x)^2) $$\n    对流项的局部截断误差 $\\tau_{conv}^{UW}$ 是：\n    $$ \\tau_{conv}^{UW} = a \\left(\\frac{u_i - u_{i-1}}{\\Delta x}\\right) - a u'_i = a \\left(u'_i - \\frac{u''_i}{2}\\Delta x + O((\\Delta x)^2)\\right) - a u'_i $$\n    迎风格式的对流截断误差的首个非零项是：\n    $$ \\tau_{conv, leading}^{UW} = -a \\frac{u''(x_i)}{2}\\Delta x $$\n\n下一步是通过令这些主导误差的期望大小相等来求得阈值 $Pe^{\\ast}$。\n大小分别为：\n$$ |\\tau_{conv, leading}^{CD}| = \\left|a \\frac{u'''(x_i)}{6}(\\Delta x)^2\\right| = \\frac{a(\\Delta x)^2}{6}|u'''(x_i)| $$\n$$ |\\tau_{conv, leading}^{UW}| = \\left|-a \\frac{u''(x_i)}{2}\\Delta x\\right| = \\frac{a \\Delta x}{2}|u''(x_i)| $$\n切换条件是 $\\mathbb{E}[|\\tau_{conv, leading}^{CD}| \\,|\\, Pe^{\\ast}] = \\mathbb{E}[|\\tau_{conv, leading}^{UW}| \\,|\\, Pe^{\\ast}]$。\n$$ \\mathbb{E}\\left[\\frac{a(\\Delta x)^2}{6}|u'''(x_i)| \\,\\Big|\\, Pe^{\\ast}\\right] = \\mathbb{E}\\left[\\frac{a \\Delta x}{2}|u''(x_i)| \\,\\Big|\\, Pe^{\\ast}\\right] $$\n由于 $a$ 和 $\\Delta x$ 是常数，我们可以写成：\n$$ \\frac{a(\\Delta x)^2}{6}\\mathbb{E}[|u'''(x_i)| \\,|\\, Pe^{\\ast}] = \\frac{a \\Delta x}{2}\\mathbb{E}[|u''(x_i)| \\,|\\, Pe^{\\ast}] $$\n为了继续进行，我们使用所提供的数据驱动模型：\n$$ \\mathbb{E}\\!\\left[\\frac{|u^{(3)}(x_i)|}{|u''(x_i)|}\\,\\Big|\\,Pe\\right] = c\\, \\frac{Pe}{\\Delta x} $$\n其中 $c = 1.72$。令 $R = \\frac{|u^{(3)}(x_i)|}{|u''(x_i)|}$。那么 $|u'''(x_i)| = R \\cdot |u''(x_i)|$。取期望，我们得到 $\\mathbb{E}[|u'''(x_i)|] = \\mathbb{E}[R \\cdot |u''(x_i)|]$。在这个数据驱动建模问题的背景下，我们做出一个合理的假设，即随机变量 $R$ 和 $|u''(x_i)|$ 是不相关的。因此，$\\mathbb{E}[R \\cdot |u''(x_i)|] \\approx \\mathbb{E}[R]\\mathbb{E}[|u''(x_i)|]$。将此应用于我们在阈值 $Pe^{\\ast}$ 处的等式：\n$$ \\frac{a(\\Delta x)^2}{6}\\mathbb{E}\\left[\\frac{|u'''(x_i)|}{|u''(x_i)|} \\,\\Big|\\, Pe^{\\ast}\\right]\\mathbb{E}[|u''(x_i)| \\,|\\, Pe^{\\ast}] = \\frac{a \\Delta x}{2}\\mathbb{E}[|u''(x_i)| \\,|\\, Pe^{\\ast}] $$\n假设解不是平凡的，$\\mathbb{E}[|u''(x_i)| \\,|\\, Pe^{\\ast}]$ 非零，因此我们可以用它来除等式两边，并同时除以 $\\frac{a \\Delta x}{2}$：\n$$ \\frac{\\Delta x}{3}\\mathbb{E}\\left[\\frac{|u'''(x_i)|}{|u''(x_i)|} \\,\\Big|\\, Pe^{\\ast}\\right] = 1 $$\n现在，我们将给定模型在 $Pe = Pe^{\\ast}$ 时的条件期望代入：\n$$ \\frac{\\Delta x}{3} \\left(c \\frac{Pe^{\\ast}}{\\Delta x}\\right) = 1 $$\n化简表达式：\n$$ \\frac{c \\, Pe^{\\ast}}{3} = 1 $$\n求解阈值佩克莱数 $Pe^{\\ast}$：\n$$ Pe^{\\ast} = \\frac{3}{c} $$\n给定拟合常数 $c = 1.72$，我们可以计算出 $Pe^{\\ast}$ 的数值：\n$$ Pe^{\\ast} = \\frac{3}{1.72} \\approx 1.7441860465... $$\n问题要求将答案四舍五入到四位有效数字。\n$$ Pe^{\\ast} \\approx 1.744 $$", "answer": "$$\\boxed{1.744}$$", "id": "3430230"}, {"introduction": "理解理论权衡是第一步，而最终目标是构建能够应对复杂物理场景的稳健数值工具。这个综合性练习将挑战您实现一个现代的自适应求解器，它能根据瞬时佩克莱数 $Pe(t)$ 自动切换通量计算格式。通过完成一系列精心设计的基准测试，您不仅能掌握混合格式的实现技巧，还能学会如何验证其在动态切换过程中的稳定性和准确性，这是计算科学家的一项核心技能[@problem_id:3430209]。", "problem": "考虑一维线性平流-扩散方程，其描述了一个被动标量场 $c(x,t)$ 在周期性域 $x \\in [0,1]$ 上的演化：\n$$\n\\frac{\\partial c}{\\partial t} + u(t)\\,\\frac{\\partial c}{\\partial x} = \\nu\\,\\frac{\\partial^2 c}{\\partial x^2},\n$$\n其中 $u(t)$ 是一个随时间变化的平流速度，$\\nu > 0$ 是一个恒定的运动学扩散系数，并采用周期性边界条件。初始条件是一个以 $x_0$ 为中心、标准差为 $\\sigma$ 的局部高斯层：\n$$\nc(x,0) = \\exp\\!\\left(-\\frac{d(x,x_0)^2}{2\\sigma^2}\\right), \\quad d(x,x_0) = \\min\\{|x-x_0|,\\,1-|x-x_0|\\}.\n$$\n网格使用包含 $N$ 个点的均匀网格，间距为 $\\Delta x = 1/N$。\n\n无量纲局部面 Péclet 数（Péclet 数）定义为\n$$\nPe(t) = \\frac{|u(t)|\\,\\Delta x}{\\nu}.\n$$\n平流项需要采用通量切换离散化方法。该格式必须在每个时间步根据 $Pe(t)$ 自主选择数值通量类型（由于 $u(t)$ 在空间上是均匀的，因此该选择是全局的）：\n- 如果 $Pe(t) < 1$，平流项使用中心通量，即在面 $i+\\tfrac{1}{2}$ 处，$F^{\\text{adv}}_{i+\\frac{1}{2}} = u(t)\\,\\frac{c_i + c_{i+1}}{2}$。\n- 如果 $Pe(t) \\ge 1$，平流项使用一阶迎风通量，即当 $u(t) \\ge 0$ 时，$F^{\\text{adv}}_{i+\\frac{1}{2}} = u(t)\\,c_i$；当 $u(t) < 0$ 时，$F^{\\text{adv}}_{i+\\frac{1}{2}} = u(t)\\,c_{i+1}$。\n\n通过隐式-显式（IMEX）步长进行时间离散：使用标准的周期性二阶差分算子隐式处理扩散项，并使用从所选通量类型得到的守恒通量差分显式处理平流项。从时间层级 $n$ 到 $n+1$ 的半离散更新（时间步长为 $\\Delta t$）为\n$$\n\\frac{c^{n+1} - c^n}{\\Delta t} + \\mathcal{A}\\!\\left(u^n, c^n\\right) = \\nu\\,\\mathcal{D}\\,c^{n+1},\n$$\n其中 $\\mathcal{A}$ 是由所选面通量构成的离散平流散度，$\\mathcal{D}$ 是离散周期性拉普拉斯算子。使用一个稳定的自适应时间步长，满足 Courant 型限制\n$$\n\\Delta t = C_{\\text{CFL}}\\min\\!\\left\\{\\frac{\\Delta x^2}{\\nu},\\,\\frac{\\Delta x}{\\max(|u(t)|, \\epsilon)}\\right\\},\n$$\n其中 $C_{\\text{CFL}} \\in (0,1)$ 是一个固定的常数，$\\epsilon$ 是一个小的正数，以避免除以零。\n\n使用以下固定的数值选择实现上述方案：\n- $N = 256$，$\\nu = 10^{-3}$，$C_{\\text{CFL}} = 0.4$，$x_0 = 0.3$，$\\sigma = 0.03$。\n- 网格在 $[0,1]$ 上是周期且均匀的。\n\n验证目标：创建一个基准测试，其中移动的层使 $Pe(t)$ 穿越 1，并要求格式能自主切换通量类型。通过下面的测试套件，验证切换过程不会引入迟滞或时间上的尖峰。\n\n测试套件规范。您的程序必须执行以下三个测试用例，并为每个用例返回一个布尔值：\n\n- 测试用例 1（斜坡穿越，过冲检查）：设 $T_1 = 1$，$u(t) = U_{\\max}\\,\\sin\\!\\left(2\\pi t/T_1\\right)$，其中 $U_{\\max} = 0.6$。这个选择迫使 $Pe(t)$ 穿越 $1$。演化到 $t=T_1$。定义过冲量度\n$$\n\\mathcal{O} = \\max\\!\\{0,\\,\\max_x c(x,T_1) - 1\\} + \\max\\!\\{0,\\, -\\min_x c(x,T_1)\\}.\n$$\n如果 $\\mathcal{O} \\le 5\\times 10^{-3}$，返回 $\\text{True}$，否则返回 $\\text{False}$。\n\n- 测试用例 2（阈值附近切换，通过扩散一致性检验无迟滞或尖峰）：设 $T_2 = 0.5$。定义 $u_{\\text{thr}} = \\nu/\\Delta x$。定义 $u_{\\text{low}} = 0.8\\,u_{\\text{thr}}$ 和 $u_{\\text{high}} = 1.2\\,u_{\\text{thr}}$。定义一个分段常数、零均值的切换速度，它每 $\\tau = 0.01$ 循环一次，序列为 $\\{+u_{\\text{low}},-u_{\\text{low}},+u_{\\text{high}},-u_{\\text{high}}\\}$，并在 $[0,T_2]$ 上重复。这会产生对 $Pe(t)=1$ 的重复穿越，且净平流量为零。使用自主切换格式演化到 $t=T_2$。同时，演化一个具有相同初始条件但 $u(t)\\equiv 0$（纯扩散）的参考解到 $t=T_2$。令 $c_{\\text{tog}}(x,T_2)$ 为切换运行的结果，$c_{\\text{diff}}(x,T_2)$ 为纯扩散运行的结果。定义相对 $L^2$ 差异\n$$\n\\mathcal{E} = \\frac{\\left(\\sum_i \\left[c_{\\text{tog}}(x_i,T_2)-c_{\\text{diff}}(x_i,T_2)\\right]^2\\right)^{1/2}}{\\left(\\sum_i \\left[c_{\\text{diff}}(x_i,T_2)\\right]^2\\right)^{1/2} + 10^{-14}}.\n$$\n如果 $\\mathcal{E} \\le 2\\times 10^{-2}$，返回 $\\text{True}$，否则返回 $\\text{False}$。\n\n- 测试用例 3（始终为扩散主导，等效于强制中心格式）：设 $T_3 = 0.5$，$u(t)\\equiv U_{\\text{small}}$，其中 $U_{\\text{small}} = 0.05$，使得对所有 $t$ 都有 $Pe(t) < 1$。使用自主切换格式演化到 $t=T_3$（该格式应始终选择中心通量）。独立地，强制始终使用中心通量（无切换）演化到 $t=T_3$。令最终状态为 $c_{\\text{auto}}(x,T_3)$ 和 $c_{\\text{cent}}(x,T_3)$。定义无穷范数差异\n$$\n\\Delta_{\\infty} = \\max_i \\left|c_{\\text{auto}}(x_i,T_3)-c_{\\text{cent}}(x_i,T_3)\\right|.\n$$\n如果 $\\Delta_{\\infty} \\le 10^{-12}$，返回 $\\text{True}$，否则返回 $\\text{False}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\,\\text{result}_1,\\text{result}_2,\\text{result}_3\\,]$），其中每个 $\\text{result}_k$ 是按上述顺序对测试用例 $k$ 的布尔值结果。本问题中的所有量均为无量纲；输出中不需要物理单位。", "solution": "该问题要求数值求解一维线性平流-扩散方程，\n$$\n\\frac{\\partial c}{\\partial t} + u(t)\\,\\frac{\\partial c}{\\partial x} = \\nu\\,\\frac{\\partial^2 c}{\\partial x^2},\n$$\n该方程定义在周期性域 $x \\in [0,1]$ 上。解决方案需要实现一个用于平流项的通量切换格式，该格式由局部 Péclet 数指导，并采用一个隐式-显式（IMEX）时间积分方法。\n\n**空间离散化**\n空间域 $[0,1]$ 被离散为 $N$ 个均匀的网格单元，单元中心位于 $x_i = i\\Delta x$，其中 $i=0, \\dots, N-1$，$\\Delta x = 1/N$。在 $(x_i, t)$ 处的离散浓度记为 $c_i(t)$。我们采用有限体积法，其中单元 $i$ 的半离散方程为：\n$$\n\\frac{d c_i}{dt} = -\\frac{F^{\\text{adv}}_{i+\\frac{1}{2}} - F^{\\text{adv}}_{i-\\frac{1}{2}}}{\\Delta x} + \\frac{F^{\\text{diff}}_{i+\\frac{1}{2}} - F^{\\text{diff}}_{i-\\frac{1}{2}}}{\\Delta x}\n$$\n扩散通量使用中心差分格式进行离散，这导出了我们熟悉的离散拉普拉斯算子 $\\mathcal{D}$：\n$$\n\\left(\\mathcal{D}c\\right)_i = \\frac{c_{i+1} - 2c_i + c_{i-1}}{\\Delta x^2}\n$$\n平流通量 $F^{\\text{adv}}$ 通过一个依赖于 Péclet 数 $Pe(t) = \\frac{|u(t)|\\Delta x}{\\nu}$ 的切换格式来处理。这个数比较了在一个网格单元上平流与扩散的速率。\n如果 $Pe(t) < 1$，表明在网格尺度上扩散占主导，此时为了保证精度，使用非耗散的中心通量是合适的：\n$$\nF^{\\text{adv}}_{i+\\frac{1}{2}} = u(t)\\,\\frac{c_i + c_{i+1}}{2}\n$$\n这导致平流项的标准二阶中心差分形式：$(\\mathcal{A}c)_i = u(t)\\frac{c_{i+1}-c_{i-1}}{2\\Delta x}$。\n如果 $Pe(t) \\ge 1$，表明平流占主导，此时需要使用稳定的一阶迎风通量以防止非物理振荡：\n$$\nF^{\\text{adv}}_{i+\\frac{1}{2}} =\n\\begin{cases}\nu(t)\\,c_i  &\\text{若 } u(t) \\ge 0 \\\\\nu(t)\\,c_{i+1}  &\\text{若 } u(t) < 0\n\\end{cases}\n$$\n这导致平流项采用一阶后向或前向差分，分别为 $(\\mathcal{A}c)_i = u(t)\\frac{c_i-c_{i-1}}{\\Delta x}$（对于 $u \\ge 0$）和 $(\\mathcal{A}c)_i = u(t)\\frac{c_{i+1}-c_{i}}{\\Delta x}$（对于 $u < 0$）。\n通过对索引应用模运算来处理所有模板操作，从而实现周期性边界条件。\n\n**时间离散化与 IMEX 格式**\n半离散方程为 $ \\frac{dc}{dt} = -\\mathcal{A}(u,c) + \\nu \\mathcal{D}c $。这是一个常微分方程组。扩散项通常会引入刚性，使得显式方法需要过小的时间步长。而平流项的时间步长限制则不那么严格。因此，IMEX 格式是理想选择，它显式处理平流项，隐式处理扩散项。\n应用一个一阶 IMEX (欧拉) 格式，从时间 $t^n$ 推进到 $t^{n+1}=t^n+\\Delta t$：\n$$\n\\frac{c^{n+1} - c^n}{\\Delta t} = -\\mathcal{A}(u(t^n), c^n) + \\nu \\mathcal{D}c^{n+1}\n$$\n重新整理以求解未知状态 $c^{n+1}$：\n$$\n(I - \\Delta t\\,\\nu\\,\\mathcal{D})c^{n+1} = c^n - \\Delta t\\,\\mathcal{A}(u^n, c^n)\n$$\n其中 $I$ 是单位算子，$u^n = u(t^n)$。\n\n**通过 FFT 求解隐式系统**\n关于 $c^{n+1}$ 的方程是一个线性系统。令 $M = (I - \\Delta t\\,\\nu\\,D)$ 为系统矩阵，其中 $D$ 是周期性离散拉普拉斯算子 $\\mathcal{D}$ 的矩阵表示。由于 $D$ 是一个循环矩阵，因此 $M$ 也是循环矩阵。这类系统可以在傅里叶空间中高效求解。\n令 $\\hat{c} = \\mathcal{F}(c)$ 表示离散傅里叶变换 (DFT)。卷积定理指出，在实空间中应用一个循环矩阵等价于在傅里叶空间中逐元素乘以其特征值。\n离散拉普拉斯算子 $\\mathcal{D}$ 对每个傅里叶模态 $k$ 的特征值 $\\lambda_k$ 为：\n$$\n\\lambda_k = \\frac{2}{\\Delta x^2} \\left(\\cos\\left(\\frac{2\\pi k}{N}\\right) - 1\\right)\n$$\n将系统变换到傅里叶空间得到：\n$$\n(1 - \\Delta t\\,\\nu\\,\\lambda_k)\\hat{c}^{n+1}_k = \\mathcal{F}\\left(c^n - \\Delta t\\,\\mathcal{A}(u^n, c^n)\\right)_k\n$$\n这个对角系统对每个傅里叶分量 $\\hat{c}^{n+1}_k$ 都可以轻易求解。然后通过逆离散傅里叶变换 (inverse DFT) 恢复解 $c^{n+1}$，即 $c^{n+1} = \\mathcal{F}^{-1}(\\hat{c}^{n+1})$。这种谱方法的计算复杂度为每个时间步 $\\mathcal{O}(N\\log N)$，非常高效。\n\n**自适应时间步进**\n显式处理平流项的稳定性要求时间步长 $\\Delta t$ 满足 Courant-Friedrichs-Lewy (CFL) 条件，即 $\\Delta t \\lesssim \\Delta x/|u|$。尽管扩散项被隐式处理（因此无条件稳定），但其时间尺度 $\\Delta t \\lesssim \\Delta x^2/\\nu$ 仍与精度相关。根据题目要求，我们使用一个同时考虑两种时间尺度的自适应时间步长：\n$$\n\\Delta t = C_{\\text{CFL}}\\min\\!\\left\\{\\frac{\\Delta x^2}{\\nu},\\,\\frac{\\Delta x}{\\max(|u(t)|, \\epsilon)}\\right\\}\n$$\n其中 $C_{\\text{CFL}} = 0.4$。小参数 $\\epsilon$ 用于防止当 $u(t)$ 接近零时发生除以零的错误。时间步长在每一步开始时重新计算。为确保精确达到最终时间，最后一个时间步长如有必要则截断。\n\n**初始条件**\n初始条件是一个高斯脉冲，使用周期性距离度量来定义，以确保其在域边界上是平滑的：\n$$\nc(x,0) = \\exp\\!\\left(-\\frac{d(x,x_0)^2}{2\\sigma^2}\\right), \\quad d(x,x_0) = \\min\\{|x-x_0|,\\,1-|x-x_0|\\}.\n$$\n\n**测试用例实现**\n基于上述原理，实现了一个鲁棒的求解器函数。该函数接受初始条件、用于速度剖面 $u(t)$ 的函数句柄以及最终积分时间 $T$。对于测试用例 3，添加了一种模式以强制使用中心差分格式，从而绕过 Péclet 数的检查。然后，通过使用为每个用例指定的特定参数（$u(t)$, $T$ 等）和验证逻辑调用此求解器来执行三个测试用例。结果被收集并按规定格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.fft import fft, ifft\n\ndef solve():\n    \"\"\"\n    Main function to execute the test suite and print results.\n    \"\"\"\n    # --- Global constants from the problem statement ---\n    N = 256\n    NU = 1e-3\n    C_CFL = 0.4\n    X0 = 0.3\n    SIGMA = 0.03\n    EPSILON = 1e-14\n    DX = 1.0 / N\n\n    class PdeSolver:\n        \"\"\"\n        A solver for the 1D advection-diffusion equation using a flux-switching\n        IMEX scheme.\n        \"\"\"\n        def __init__(self, n_points, nu, cfl, epsilon, flux_mode='auto'):\n            self.N = n_points\n            self.nu = nu\n            self.C_CFL = cfl\n            self.epsilon = epsilon\n            self.dx = 1.0 / self.N\n            self.flux_mode = flux_mode\n\n            # Precompute eigenvalues for the implicit diffusion solver\n            k_freq = np.fft.fftfreq(self.N, d=self.dx)\n            # Eigenvalues of the discrete periodic Laplacian (2nd-order central diff)\n            self.laplacian_eigenvalues = 2 * (np.cos(2 * np.pi * k_freq * self.dx) - 1) / self.dx**2\n\n        def get_advection_divergence(self, c, u_t):\n            \"\"\"\n            Computes the advection term's spatial derivative using a flux-switching scheme.\n            \"\"\"\n            peclet = abs(u_t) * self.dx / self.nu\n            \n            use_centered = (peclet  1.0)\n            if self.flux_mode == 'force_central':\n                use_centered = True\n            \n            c_p1 = np.roll(c, -1)\n            c_m1 = np.roll(c, 1)\n\n            if use_centered:\n                # Centered difference for advection\n                adv_div = u_t * (c_p1 - c_m1) / (2 * self.dx)\n            else:\n                # First-order upwind difference for advection\n                if u_t >= 0:\n                    adv_div = u_t * (c - c_m1) / self.dx\n                else:\n                    adv_div = u_t * (c_p1 - c) / self.dx\n            return adv_div\n\n        def run(self, c0, u_func, T_final):\n            \"\"\"\n            Evolves the PDE from an initial condition c0 to a final time T_final.\n            \"\"\"\n            c = np.copy(c0)\n            t = 0.0\n\n            while t  T_final:\n                u_t = u_func(t)\n                \n                # Adaptive time step based on CFL-like conditions\n                dt_diff = self.dx**2 / self.nu\n                dt_adv = self.dx / max(abs(u_t), self.epsilon)\n                dt = self.C_CFL * min(dt_diff, dt_adv)\n                \n                if t + dt > T_final:\n                    dt = T_final - t\n                \n                if dt = 0:\n                    break\n\n                # Step 1: Explicit advection (forms the RHS of the IMEX scheme)\n                adv_div = self.get_advection_divergence(c, u_t)\n                rhs = c - dt * adv_div\n\n                # Step 2: Implicit diffusion (solved in Fourier space)\n                rhs_hat = fft(rhs)\n                c_hat_new = rhs_hat / (1.0 - self.nu * dt * self.laplacian_eigenvalues)\n                c_new = ifft(c_hat_new).real\n\n                c = c_new\n                t += dt\n                \n            return c\n\n    def setup_initial_condition(n_points, x0, sigma):\n        \"\"\"\n        Generates the periodic Gaussian initial condition.\n        \"\"\"\n        dx = 1.0 / n_points\n        x = np.arange(n_points) * dx\n        d = np.abs(x - x0)\n        d = np.minimum(d, 1.0 - d)\n        return np.exp(-d**2 / (2 * sigma**2))\n\n    def run_test_case_1():\n        \"\"\"\n        Test case 1: Ramp crossing, overshoot check.\n        \"\"\"\n        T1 = 1.0\n        U_max = 0.6\n        def u_func(t):\n            return U_max * np.sin(2 * np.pi * t / T1)\n\n        c0 = setup_initial_condition(N, X0, SIGMA)\n        solver = PdeSolver(N, NU, C_CFL, EPSILON, flux_mode='auto')\n        c_final = solver.run(c0, u_func, T1)\n        \n        overshoot = max(0, np.max(c_final) - 1.0) + max(0, -np.min(c_final))\n        return overshoot = 5e-3\n\n    def run_test_case_2():\n        \"\"\"\n        Test case 2: Toggle around threshold, consistency with pure diffusion.\n        \"\"\"\n        T2 = 0.5\n        tau = 0.01\n        u_thr = NU / DX\n        u_low = 0.8 * u_thr\n        u_high = 1.2 * u_thr\n        \n        def u_toggling_func(t):\n            t_cycle = t % (4 * tau)\n            if t_cycle  tau:\n                return u_low\n            elif t_cycle  2 * tau:\n                return -u_low\n            elif t_cycle  3 * tau:\n                return u_high\n            else:\n                return -u_high\n                \n        def u_zero_func(t):\n            return 0.0\n\n        c0 = setup_initial_condition(N, X0, SIGMA)\n        solver = PdeSolver(N, NU, C_CFL, EPSILON, flux_mode='auto')\n        \n        c_tog = solver.run(c0, u_toggling_func, T2)\n        c_diff = solver.run(c0, u_zero_func, T2)\n        \n        numerator = np.sqrt(np.sum((c_tog - c_diff)**2))\n        denominator = np.sqrt(np.sum(c_diff**2)) + 1e-14\n        error = numerator / denominator\n        \n        return error = 2e-2\n\n    def run_test_case_3():\n        \"\"\"\n        Test case 3: Always diffusive regime, equivalence to forced central scheme.\n        \"\"\"\n        T3 = 0.5\n        U_small = 0.05\n        \n        def u_func(t):\n            return U_small\n\n        c0 = setup_initial_condition(N, X0, SIGMA)\n        solver_auto = PdeSolver(N, NU, C_CFL, EPSILON, flux_mode='auto')\n        solver_central = PdeSolver(N, NU, C_CFL, EPSILON, flux_mode='force_central')\n        \n        c_auto = solver_auto.run(c0, u_func, T3)\n        c_cent = solver_central.run(c0, u_func, T3)\n        \n        discrepancy = np.max(np.abs(c_auto - c_cent))\n        \n        return discrepancy = 1e-12\n\n    test_cases = [\n        run_test_case_1,\n        run_test_case_2,\n        run_test_case_3\n    ]\n    results = [case() for case in test_cases]\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3430209"}]}