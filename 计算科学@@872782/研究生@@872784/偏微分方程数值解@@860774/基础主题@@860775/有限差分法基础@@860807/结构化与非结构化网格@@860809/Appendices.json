{"hands_on_practices": [{"introduction": "在有限元方法中，刚度矩阵和载荷向量的精确计算是核心步骤，这通常依赖于对单元上的多项式进行积分。此练习 [@problem_id:3450633] 提供了一个在单个非结构化网格单元（一个三角形）上进行数值积分的具体计算。通过比较低阶积分规则（形心点规则）与对二次多项式精确的高斯求积法的结果，您可以亲手量化由于积分不准确而引入的“积分误差”，从而深入理解数值求积在有限元计算中的关键作用。", "problem": "考虑一个二维线性三角形有限元，该有限元取自用于求解偏微分方程（PDE）的非结构化网格。设该三角形单元的顶点为 $(0,0)$、$(1,0)$ 和 $(0,2)$，因此其面积为 $A=\\frac{1}{2}\\times 1\\times 2=1$。假设由分段光滑场和系数产生的单元被积函数为二次多项式\n$$\np(x,y)=3x^{2}-2xy+5y^{2}+4x-y+7.\n$$\n使用高斯求积（GQ）作为一种对特定次数以下的多项式精确的近似积分法则的基本定义，通过对称3点三角形GQ法则计算单元积分 $\\int_{T}p(x,y)\\,\\mathrm{d}A$。该法则的求积点在重心坐标下由 $\\left(\\frac{2}{3},\\frac{1}{6},\\frac{1}{6}\\right)$ 的排列给出，且权重相等。然后，通过欠积分的1点形心法则（重心坐标为 $\\left(\\frac{1}{3},\\frac{1}{3},\\frac{1}{3}\\right)$，单个权重等于 $A$）计算同一個积分。报告有符号误差 $E=I_{1\\text{-pt}}-I_{\\text{exact}}$，其中 $I_{\\text{exact}}$ 是通过3点法则（该法则对于线性三角形上的二次多项式是精确的）获得的积分值，而 $I_{1\\text{-pt}}$ 是形心1点法则的值。将最终答案表示为一个精确的有理数。无需单位。", "solution": "用户提供了一个有效的问题陈述。任务是计算二次多项式 $p(x,y)$ 在特定三角形单元 $T$ 上的积分的有符号误差 $E=I_{1\\text{-pt}}-I_{\\text{exact}}$。$I_{1\\text{-pt}}$ 是用1点形心法则近似的积分值，$I_{\\text{exact}}$ 是用对称3点高斯求积（GQ）法则计算的积分值，该法则对此类多项式是精确的。\n\n三角形单元 $T$ 的顶点为 $v_1=(0,0)$、$v_2=(1,0)$ 和 $v_3=(0,2)$。其面积由公式 $A = \\frac{1}{2}|(x_1(y_2 - y_3) + x_2(y_3 - y_1) + x_3(y_1 - y_2))| = \\frac{1}{2}|(0(0-2) + 1(2-0) + 0(0-0))| = \\frac{1}{2}|2| = 1$ 给出。这证实了给定的面积 $A=1$。\n\n被积函数为二次多项式 $p(x,y)=3x^{2}-2xy+5y^{2}+4x-y+7$。\n\n首先，我们使用1点形心法则计算积分 $I_{1\\text{-pt}}$。该法则将积分近似为单元面积乘以被积函数在单元形心处的值。\n形心的重心坐标为 $(\\lambda_1, \\lambda_2, \\lambda_3) = (\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3})$。\n形心的笛卡尔坐标 $(x_c, y_c)$ 是顶点坐标的平均值：\n$$x_c = \\frac{x_1+x_2+x_3}{3} = \\frac{0+1+0}{3} = \\frac{1}{3}$$\n$$y_c = \\frac{y_1+y_2+y_3}{3} = \\frac{0+0+2}{3} = \\frac{2}{3}$$\n求积法则是 $\\int_T p(x,y)\\,\\mathrm{d}A \\approx A \\cdot p(x_c, y_c)$。\n我们在形心 $(x_c, y_c) = (\\frac{1}{3}, \\frac{2}{3})$ 处计算 $p(x,y)$ 的值：\n$$p\\left(\\frac{1}{3}, \\frac{2}{3}\\right) = 3\\left(\\frac{1}{3}\\right)^{2} - 2\\left(\\frac{1}{3}\\right)\\left(\\frac{2}{3}\\right) + 5\\left(\\frac{2}{3}\\right)^{2} + 4\\left(\\frac{1}{3}\\right) - \\left(\\frac{2}{3}\\right) + 7$$\n$$p\\left(\\frac{1}{3}, \\frac{2}{3}\\right) = 3\\left(\\frac{1}{9}\\right) - \\frac{4}{9} + 5\\left(\\frac{4}{9}\\right) + \\frac{4}{3} - \\frac{2}{3} + 7$$\n$$p\\left(\\frac{1}{3}, \\frac{2}{3}\\right) = \\frac{3}{9} - \\frac{4}{9} + \\frac{20}{9} + \\frac{12}{9} - \\frac{6}{9} + \\frac{63}{9} = \\frac{3-4+20+12-6+63}{9} = \\frac{88}{9}$$\n因此，由1点法则得到的积分值为：\n$$I_{1\\text{-pt}} = A \\cdot p\\left(\\frac{1}{3}, \\frac{2}{3}\\right) = 1 \\cdot \\frac{88}{9} = \\frac{88}{9}$$\n\n接下来，我们使用对称3点GQ法则计算积分。问题陈述中说明该法则对线性三角形上的二次多项式是精确的，因此结果将是 $I_{\\text{exact}}$。该法则由 $\\int_T f(x,y)\\,\\mathrm{d}A \\approx A \\sum_{i=1}^3 w_i f(x_i, y_i)$ 给出。\n权重是相等的，所以 $w_1=w_2=w_3=w$。对于基于重心坐标的法则，权重之和归一化为1，因此 $3w=1$，得出 $w=\\frac{1}{3}$。\n求积点在重心坐标 $(\\lambda_1, \\lambda_2, \\lambda_3)$ 下由 $(\\frac{2}{3}, \\frac{1}{6}, \\frac{1}{6})$ 的排列给出。\n从重心坐标到笛卡尔坐标 $(x,y)$ 的映射由 $(x,y) = \\lambda_1 v_1 + \\lambda_2 v_2 + \\lambda_3 v_3$ 给出。\n当 $v_1=(0,0)$、$v_2=(1,0)$ 和 $v_3=(0,2)$ 时，映射为：\n$$(x,y) = \\lambda_1(0,0) + \\lambda_2(1,0) + \\lambda_3(0,2) = (\\lambda_2, 2\\lambda_3)$$\n现在我们求出三个求积点的笛卡尔坐标，并计算多项式在每个点的值。\n\n点 1: $(\\lambda_1, \\lambda_2, \\lambda_3) = (\\frac{2}{3}, \\frac{1}{6}, \\frac{1}{6})$。\n笛卡尔坐标：$(x_1, y_1) = (\\frac{1}{6}, 2 \\cdot \\frac{1}{6}) = (\\frac{1}{6}, \\frac{1}{3})$。\n$$p\\left(\\frac{1}{6}, \\frac{1}{3}\\right) = 3\\left(\\frac{1}{36}\\right) - 2\\left(\\frac{1}{6}\\right)\\left(\\frac{1}{3}\\right) + 5\\left(\\frac{1}{9}\\right) + 4\\left(\\frac{1}{6}\\right) - \\frac{1}{3} + 7 = \\frac{3}{36} - \\frac{2}{18} + \\frac{5}{9} + \\frac{4}{6} - \\frac{1}{3} + 7$$\n$$p\\left(\\frac{1}{6}, \\frac{1}{3}\\right) = \\frac{3}{36} - \\frac{4}{36} + \\frac{20}{36} + \\frac{24}{36} - \\frac{12}{36} + \\frac{252}{36} = \\frac{283}{36}$$\n\n点 2: $(\\lambda_1, \\lambda_2, \\lambda_3) = (\\frac{1}{6}, \\frac{2}{3}, \\frac{1}{6})$。\n笛卡尔坐标：$(x_2, y_2) = (\\frac{2}{3}, 2 \\cdot \\frac{1}{6}) = (\\frac{2}{3}, \\frac{1}{3})$。\n$$p\\left(\\frac{2}{3}, \\frac{1}{3}\\right) = 3\\left(\\frac{4}{9}\\right) - 2\\left(\\frac{2}{3}\\right)\\left(\\frac{1}{3}\\right) + 5\\left(\\frac{1}{9}\\right) + 4\\left(\\frac{2}{3}\\right) - \\frac{1}{3} + 7 = \\frac{12}{9} - \\frac{4}{9} + \\frac{5}{9} + \\frac{8}{3} - \\frac{1}{3} + 7$$\n$$p\\left(\\frac{2}{3}, \\frac{1}{3}\\right) = \\frac{12-4+5}{9} + \\frac{24-3}{9} + \\frac{63}{9} = \\frac{13+21+63}{9} = \\frac{97}{9} = \\frac{388}{36}$$\n\n点 3: $(\\lambda_1, \\lambda_2, \\lambda_3) = (\\frac{1}{6}, \\frac{1}{6}, \\frac{2}{3})$。\n笛卡尔坐标：$(x_3, y_3) = (\\frac{1}{6}, 2 \\cdot \\frac{2}{3}) = (\\frac{1}{6}, \\frac{4}{3})$。\n$$p\\left(\\frac{1}{6}, \\frac{4}{3}\\right) = 3\\left(\\frac{1}{36}\\right) - 2\\left(\\frac{1}{6}\\right)\\left(\\frac{4}{3}\\right) + 5\\left(\\frac{16}{9}\\right) + 4\\left(\\frac{1}{6}\\right) - \\frac{4}{3} + 7 = \\frac{3}{36} - \\frac{8}{18} + \\frac{80}{9} + \\frac{4}{6} - \\frac{4}{3} + 7$$\n$$p\\left(\\frac{1}{6}, \\frac{4}{3}\\right) = \\frac{3}{36} - \\frac{16}{36} + \\frac{320}{36} + \\frac{24}{36} - \\frac{48}{36} + \\frac{252}{36} = \\frac{3-16+320+24-48+252}{36} = \\frac{535}{36}$$\n\n现在，我们计算精确的积分值：\n$$I_{\\text{exact}} = A \\sum_{i=1}^3 w_i p(x_i, y_i) = 1 \\cdot \\frac{1}{3} \\left( p(x_1, y_1) + p(x_2, y_2) + p(x_3, y_3) \\right)$$\n$$I_{\\text{exact}} = \\frac{1}{3} \\left( \\frac{283}{36} + \\frac{388}{36} + \\frac{535}{36} \\right) = \\frac{1}{3} \\left( \\frac{283+388+535}{36} \\right) = \\frac{1}{3} \\left( \\frac{1206}{36} \\right)$$\n化简分数 $\\frac{1206}{36}$: $\\frac{1206 \\div 6}{36 \\div 6} = \\frac{201}{6} = \\frac{201 \\div 3}{6 \\div 3} = \\frac{67}{2}$。\n$$I_{\\text{exact}} = \\frac{1}{3} \\cdot \\frac{67}{2} = \\frac{67}{6}$$\n\n最后，我们计算有符号误差 $E = I_{1\\text{-pt}} - I_{\\text{exact}}$：\n$$E = \\frac{88}{9} - \\frac{67}{6}$$\n$9$ 和 $6$ 的最小公倍数是 $18$。\n$$E = \\frac{88 \\cdot 2}{18} - \\frac{67 \\cdot 3}{18} = \\frac{176}{18} - \\frac{201}{18} = \\frac{176 - 201}{18} = -\\frac{25}{18}$$\n有符号误差为 $-\\frac{25}{18}$。", "answer": "$$\\boxed{-\\frac{25}{18}}$$", "id": "3450633"}, {"introduction": "从单个单元扩展到整个计算域，非结构化网格中单元的几何质量对数值解的稳定性和准确性有着深远的影响。这个编码练习 [@problem_id:3450603] 旨在揭示这一关键联系，它指导您通过在一个三维泊松问题中故意制造质量低劣的“细长条”四面体网格。通过量化刚度矩阵条件数 $\\kappa(K)$ 的恶化和解误差的增加，您将直观地体验到为何高质量的网格生成与控制对于可靠的科学计算至关重要。", "problem": "您将研究非结构化网格中极度扁平的四面体（通常称为“薄片单元”）如何影响有限元法（FEM）刚度矩阵的条件数以及三维泊松问题数值解的精度。在标量场 $u$ 的域 $\\Omega = (0,1)^3$ 中进行研究。考虑使用拉普拉斯算子的模型问题，即泊松方程\n$$\n\\Delta u = f \\text{ in } \\Omega,\n$$\n附带 Dirichlet 边界条件\n$$\nu = u^\\star \\text{ on } \\partial \\Omega,\n$$\n其中，精确解被指定为二次多项式\n$$\nu^\\star(x,y,z) = x^2 + y^2 + z^2,\n$$\n因此源项是其拉普拉斯算子\n$$\nf = \\Delta u^\\star = 2 + 2 + 2 = 6.\n$$\n您将使用标准的连续伽辽金有限元法（CG-FEM），在四面体上采用一阶分段线性基函数。刚度矩阵 $K$ 的元素为\n$$\nK_{ij} = \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\Omega,\n$$\n载荷向量 $b$ 的元素为\n$$\nb_i = \\int_{\\Omega} f \\, \\phi_i \\, d\\Omega,\n$$\n其中 $\\{\\phi_i\\}$ 是节点基函数。使用单元组装法，并对每个顶点为 $\\mathbf{p}_0,\\mathbf{p}_1,\\mathbf{p}_2,\\mathbf{p}_3 \\in \\mathbb{R}^3$ 的四面体进行以下基本几何构造：\n- 定义 $3 \\times 3$ 的类雅可比矩阵\n$$\nT = \\big[ \\mathbf{p}_1 - \\mathbf{p}_0 \\ \\ \\mathbf{p}_2 - \\mathbf{p}_0 \\ \\ \\mathbf{p}_3 - \\mathbf{p}_0 \\big].\n$$\n- 单元体积为\n$$\nV_e = \\frac{|\\det(T)|}{6}.\n$$\n- 物理坐标中线性形函数的梯度在单元上是常数，并通过参考单元的梯度获得：\n$$\n\\nabla \\phi_0 = -T^{-\\top} \\begin{bmatrix} 1 \\\\ 1 \\\\ 1 \\end{bmatrix}, \\quad\n\\nabla \\phi_1 = T^{-\\top} \\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\n\\nabla \\phi_2 = T^{-\\top} \\begin{bmatrix} 0 \\\\ 1 \\\\ 0 \\end{bmatrix}, \\quad\n\\nabla \\phi_3 = T^{-\\top} \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.\n$$\n- 单元刚度矩阵为\n$$\nK^{(e)}_{ij} = V_e \\, \\nabla \\phi_i \\cdot \\nabla \\phi_j.\n$$\n- 由于 $f$ 是常数，使用精确的单元载荷向量\n$$\nb^{(e)}_i = f \\, \\int_{e} \\phi_i \\, d\\Omega = f \\, \\frac{V_e}{4}.\n$$\n通过消除边界自由度来施加 Dirichlet 边界条件：将未知向量写为 $u = \\begin{bmatrix} u_I \\\\ u_B \\end{bmatrix}$，对应于内部节点和边界节点，并求解\n$$\nK_{II} \\, u_I = b_I - K_{IB} u_B\n$$\n其中 $u_B$ 设置为在边界节点处计算的精确边界值 $u^\\star$。求解后，通过插入 $u_I$ 和 $u_B$ 来恢复完整向量 $u$。\n\n网格生成和薄片单元控制必须按以下步骤进行。从一个六面体结构化网格开始，该网格由 $\\Omega$ 上每个坐标轴 $N$ 个细分的均匀划分形成，然后使用一致的长对角线模式将每个六面体分割成6个四面体，从而创建一个非结构化的四面体网格。为了引入薄片单元，在平面 $z = 1/2$ 周围的板层中应用各向异性几何畸变：\n- 固定板层半宽 $w = 1/4$，板层中心 $z_0 = 1/2$，以及一个比例因子 $s \\in (0,1]$。\n- 对于每个坐标为 $z$ 的网格节点，如果 $|z - z_0| \\le w$，则将其映射到\n$$\nz' = z_0 + s \\, (z - z_0),\n$$\n否则保持不变。这将板层的厚度压缩了因子 $s$，并在 $s \\ll 1$ 时产生高度非常小的薄片四面体。\n作为一种几何上的薄片单元移除策略，通过以下映射在板层中强制执行一个最小比例 $s_{\\min} \\in (0,1]$ 来对畸变网格进行后处理\n$$\nz' = z_0 + \\max(s, s_{\\min}) \\, (z - z_0)\n$$\n对于所有满足 $|z - z_0| \\le w$ 的节点。这个简单的策略增加了板层中四面体的最小高度。\n\n量化：\n- 消去后的刚度矩阵 $K_{II}$ 的谱条件数，定义为\n$$\n\\kappa(K_{II}) = \\frac{\\lambda_{\\max}(K_{II})}{\\lambda_{\\min}(K_{II})},\n$$\n其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是最大和最小特征值。\n- FEM解 $u_h$ 相对于 $u^\\star$ 的相对离散 $L^2$ 误差，通过单元质心积分近似：\n$$\n\\| e \\|_{L^2(\\Omega)} \\approx \\left( \\sum_{e} V_e \\, \\big( u_h(\\mathbf{c}_e) - u^\\star(\\mathbf{c}_e) \\big)^2 \\right)^{1/2},\n$$\n$$\n\\| u^\\star \\|_{L^2(\\Omega)} \\approx \\left( \\sum_{e} V_e \\, \\big( u^\\star(\\mathbf{c}_e) \\big)^2 \\right)^{1/2},\n$$\n$$\n\\text{RelErr} = \\frac{\\| e \\|_{L^2(\\Omega)}}{\\| u^\\star \\|_{L^2(\\Omega)}},\n$$\n其中 $\\mathbf{c}_e$ 是四面体 $e$ 的质心，$u_h(\\mathbf{c}_e)$ 是该四面体上 $u_h$ 的节点值的平均值（对于线性的 $u_h$，在质心处此值为精确值）。\n\n实现一个程序，该程序构建网格，组装并求解 FEM 系统，计算 $\\kappa(K_{II})$ 和 $\\text{RelErr}$，并为以下测试套件汇总结果：\n- 测试 1 (基准良形)：$N = 6$，$s = 1.0$，无薄片单元移除（无后处理）。\n- 测试 2 (中度薄片)：$N = 6$，$s = 0.2$，无薄片单元移除。\n- 测试 3 (极端薄片)：$N = 6$，$s = 0.02$，无薄片单元移除。\n- 测试 4 (应用薄片单元移除)：$N = 6$，$s = 0.02$，使用 $s_{\\min} = 0.2$ 进行薄片单元移除。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果的顺序必须完全如下\n$$\n[\\kappa_1,\\text{RelErr}_1,\\kappa_2,\\text{RelErr}_2,\\kappa_3,\\text{RelErr}_3,\\kappa_4,\\text{RelErr}_4],\n$$\n其中 $\\kappa_i$ 和 $\\text{RelErr}_i$ 对应于测试 $i$（$i \\in \\{1,2,3,4\\}$）。所有输出必须是无单位的实数。不需要用户输入；所有参数必须如上所述在代码中定义。请遵循此处所述的定义和程序，并仅使用指定的数值库，以确保科学真实性。", "solution": "该问题被评估为有效。这是一个适定的、科学上合理的数值实验，旨在研究网格质量对有限元法（FEM）的影响。所有必要的参数、方程和程序都已提供，从而可以得到一个唯一且可验证的解。\n\n核心任务是在域 $\\Omega = (0,1)^3$ 上求解三维泊松方程 $\\Delta u = f$。精确解为 $u^\\star(x,y,z) = x^2 + y^2 + z^2$，这意味着源项为常数 $f = \\Delta u^\\star = 6$。指定了 Dirichlet 边界条件，在边界 $\\partial \\Omega$ 上 $u = u^\\star$。我们将采用在四面体网格上使用分段线性基函数的连续伽辽金有限元法。\n\n求解过程涉及四个主要阶段：网格生成、FEM 系统组装、代数系统求解以及分析指标（条件数和误差）的计算。对四个不同的测试案例重复此过程，每个案例都具有不同程度的网格畸变。\n\n**1. 网格生成与畸变**\n\n首先，在一组均匀的笛卡尔网格上生成节点集。对于每个轴上的 $N$ 个细分，我们得到 $(N+1)^3$ 个节点 $\\mathbf{p}_{ijk} = (x_i, y_j, z_k)$，其中 $x_i = i/N$，$y_j = j/N$，$z_k = k/N$，对于 $i,j,k \\in \\{0, 1, \\dots, N\\}$。\n\n然后，对这个规则的节点分布进行各向异性几何畸变，以创建形状不良的“薄片”四面体。畸变作用于位于由 $z \\in [z_0 - w, z_0 + w]$ 定义的板层内的节点的 $z$ 坐标，其中中心为 $z_0 = 1/2$，半宽为 $w = 1/4$。对于任何满足 $|z - z_0| \\le w$ 的 $z$ 坐标节点，其坐标根据以下公式进行映射：\n$$\nz' = z_0 + s_{\\text{eff}} (z - z_0)\n$$\n其中 $s_{\\text{eff}}$ 是一个有效的缩放因子。对于没有薄片单元移除的测试，$s_{\\text{eff}} = s$。对于有薄片单元移除的测试，比例因子被校正以强制执行最低质量，从而得到 $s_{\\text{eff}} = \\max(s, s_{\\min})$。板层外的节点保持不变。这种变换在板层内沿 $z$ 方向压缩网格，较小的 $s_{\\text{eff}}$ 值会导致更极端的压缩和更扁平的单元。\n\n域 $\\Omega$ 被划分为 $N^3$ 个六面体单元。然后，每个六面体都使用基于其主对角线的一致模式被细分为 6 个四面体。对于一个局部角点索引为 $p_0, \\dots, p_7$ 的六面体，我们使用连接 $p_0$ 和 $p_6$ 的对角线。这六个四面体是通过取在此对角线上相交的相邻面而成对形成的。对于由网格索引 $(i,j,k)$ 到 $(i+1,j+1,k+1)$ 定义的六面体，这将产生以下六个四面体，由它们的全局节点索引指定：\n- $(\\text{idx}(i,j,k), \\text{idx}(i+1,j,k), \\text{idx}(i+1,j+1,k), \\text{idx}(i+1,j+1,k+1))$\n- $(\\text{idx}(i,j,k), \\text{idx}(i,j+1,k), \\text{idx}(i+1,j+1,k), \\text{idx}(i+1,j+1,k+1))$\n- $(\\text{idx}(i,j,k), \\text{idx}(i,j+1,k), \\text{idx}(i,j+1,k+1), \\text{idx}(i+1,j+1,k+1))$\n- $(\\text{idx}(i,j,k), \\text{idx}(i,j,k+1), \\text{idx}(i,j+1,k+1), \\text{idx}(i+1,j+1,k+1))$\n- $(\\text{idx}(i,j,k), \\text{idx}(i,j,k+1), \\text{idx}(i+1,j,k+1), \\text{idx}(i+1,j+1,k+1))$\n- $(\\text{idx}(i,j,k), \\text{idx}(i+1,j,k), \\text{idx}(i+1,j,k+1), \\text{idx}(i+1,j+1,k+1))$\n这就构成了最终的非结构化四面体网格。\n\n**2. 有限元系统组装**\n\nFEM 离散化得到一个线性方程组 $K u = b$。全局刚度矩阵 $K$ 和载荷向量 $b$ 是由单元级的贡献组装而成。对于每个顶点为 $\\mathbf{p}_0, \\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{p}_3$ 的四面体单元 $e$：\n\n- 由从顶点 $\\mathbf{p}_0$ 出发的单元边向量构成一个 $3 \\times 3$ 矩阵 $T$：$T = [\\mathbf{p}_1 - \\mathbf{p}_0, \\mathbf{p}_2 - \\mathbf{p}_0, \\mathbf{p}_3 - \\mathbf{p}_0]$。\n- 单元的体积为 $V_e = |\\det(T)| / 6$。\n- 四个线性基函数 $\\phi_i$ 的梯度在单元内是常数，并使用 $T$ 的逆转置计算得出：$\\nabla\\phi_0 = -T^{-\\top}[1,1,1]^\\top$，$\\nabla\\phi_1=T^{-\\top}[1,0,0]^\\top$ 等。\n- $4 \\times 4$ 的单元刚度矩阵 $K^{(e)}$ 的元素为 $K^{(e)}_{ij} = V_e (\\nabla \\phi_i \\cdot \\nabla \\phi_j)$。\n- $4 \\times 1$ 的单元载荷向量 $b^{(e)}$ 的元素为 $b^{(e)}_i = f (V_e / 4)$，其中 $f=6$。\n\n然后，根据单元顶点的全局索引，将这些局部矩阵和向量累加到相应的全局数组中。\n\n**3. 边界条件与求解**\n\nDirichlet 边界条件通过将节点划分为内部（$I$）和边界（$B$）集来施加。全局系统 $K u = b$ 被重排为：\n$$\n\\begin{bmatrix} K_{II}  K_{IB} \\\\ K_{BI}  K_{BB} \\end{bmatrix}\n\\begin{bmatrix} u_I \\\\ u_B \\end{bmatrix}\n=\n\\begin{bmatrix} b_I \\\\ b_B \\end{bmatrix}\n$$\n边界节点处的解值 $u_B$ 是已知的，因为它们是由精确解给出的：$u_B = u^\\star(\\mathbf{p}_B)$，其中 $\\mathbf{p}_B$ 是边界节点的坐标。这使我们能够通过简化的系统求解未知的内部值 $u_I$：\n$$\nK_{II} u_I = b_I - K_{IB} u_B\n$$\n对此线性系统求解 $u_I$。矩阵 $K_{II}$ 是对称正定的，保证了唯一解的存在。\n\n**4. 性能指标**\n\n计算两个关键指标来评估网格畸变的影响：\n\n- **谱条件数**：矩阵 $K_{II}$ 的条件数由其谱条件数 $\\kappa(K_{II}) = \\lambda_{\\max}(K_{II}) / \\lambda_{\\min}(K_{II})$ 来衡量，其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是 $K_{II}$ 的最大和最小特征值。高条件数表示数值敏感性，并可能给迭代求解器带来困难。特征值由组装好的矩阵 $K_{II}$ 计算得出。\n\n- **相对 $L^2$ 误差**：数值解 $u_h$ 的精度通过（离散的）$L^2$ 范数下的相对误差来量化。这通过在所有单元上使用基于质心的求积规则来近似：\n$$\n\\text{RelErr} = \\frac{\\| u_h - u^\\star \\|_{L^2(\\Omega)}}{\\| u^\\star \\|_{L^2(\\Omega)}} \\approx \\frac{\\left( \\sum_{e} V_e \\, (u_h(\\mathbf{c}_e) - u^\\star(\\mathbf{c}_e))^2 \\right)^{1/2}}{\\left( \\sum_{e} V_e \\, (u^\\star(\\mathbf{c}_e))^2 \\right)^{1/2}}\n$$\n这里，$\\mathbf{c}_e$ 是四面体 $e$ 的质心。对于线性有限元，解 $u_h$ 在质心处的值恰好是其四个节点值的平均值。\n\n该程序针对指定的四个测试案例分别执行：一个没有畸变的基准案例（$s=1.0$），两个具有中度（$s=0.2$）和极端（$s=0.02$）畸变的案例，以及最后一个展示薄片单元移除的案例，该案例使用最小比例因子 $s_{\\min}=0.2$ 重新映射极端薄片案例的几何形状。预计这最后一个测试案例将恢复中度薄片案例的结果，因为有效比例因子变为 $\\max(0.02, 0.2) = 0.2$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import ... is not needed for this problem\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, s, s_min_option) where s_min_option is s_min or None.\n    test_cases = [\n        (6, 1.0, None),    # Test 1: Baseline\n        (6, 0.2, None),    # Test 2: Moderate slivers\n        (6, 0.02, None),   # Test 3: Extreme slivers\n        (6, 0.02, 0.2),    # Test 4: Sliver removal\n    ]\n\n    # Source term f for the Poisson equation.\n    f_source = 6.0\n\n    # Exact solution u_star(x,y,z) = x^2 + y^2 + z^2\n    def u_star(p):\n        return p[0]**2 + p[1]**2 + p[2]**2\n\n    results = []\n    for N, s, s_min_option in test_cases:\n        kappa, rel_err = run_simulation(N, s, s_min_option, f_source, u_star)\n        results.extend([kappa, rel_err])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\ndef run_simulation(N, s, s_min_option, f, u_star_func):\n    \"\"\"\n    Performs a single FEM simulation for a given set of parameters.\n    \"\"\"\n    \n    # --- 1. Mesh Generation ---\n    w = 0.25  # Slab half-width\n    z0 = 0.5  # Slab center\n    \n    s_eff = s\n    if s_min_option is not None:\n        s_eff = max(s, s_min_option)\n\n    # Generate nodes\n    num_nodes = (N + 1)**3\n    nodes = np.zeros((num_nodes, 3))\n    node_idx = lambda i, j, k: i + j * (N + 1) + k * (N + 1)**2\n    \n    for k in range(N + 1):\n        for j in range(N + 1):\n            for i in range(N + 1):\n                idx = node_idx(i, j, k)\n                x, y, z = i/N, j/N, k/N\n                if abs(z - z0) = w:\n                    z = z0 + s_eff * (z - z0)\n                nodes[idx] = [x, y, z]\n\n    # Generate tetrahedra from hexahedra\n    num_hex = N**3\n    num_tets = 6 * num_hex\n    tets = np.zeros((num_tets, 4), dtype=int)\n    \n    tet_idx = 0\n    for k in range(N):\n        for j in range(N):\n            for i in range(N):\n                # 8 corners of the hex\n                p = [node_idx(i+di, j+dj, k+dk) for dk in range(2) for dj in range(2) for di in range(2)]\n                # p_ijk indices: i is fastest, k is slowest\n                # p[0]=p_000, p[1]=p_100, p[2]=p_010, p[3]=p_110\n                # p[4]=p_001, p[5]=p_101, p[6]=p_011, p[7]=p_111\n                # Custom re-ordering to match a common splitting pattern\n                p_std = [p[0], p[1], p[3], p[2], p[4], p[5], p[7], p[6]]\n                p0, p1, p2, p3, p4, p5, p6, p7 = p_std\n\n                # Split hex into 6 tets using main diagonal p0-p6\n                tets[tet_idx + 0] = [p0, p1, p2, p6]\n                tets[tet_idx + 1] = [p0, p2, p3, p6]\n                tets[tet_idx + 2] = [p0, p3, p7, p6]\n                tets[tet_idx + 3] = [p0, p4, p7, p6]\n                tets[tet_idx + 4] = [p0, p4, p5, p6]\n                tets[tet_idx + 5] = [p0, p5, p1, p6]\n                tet_idx += 6\n\n    # Identify interior and boundary nodes\n    is_boundary = np.zeros(num_nodes, dtype=bool)\n    for k in range(N + 1):\n        for j in range(N + 1):\n            for i in range(N + 1):\n                if i == 0 or i == N or j == 0 or j == N or k == 0 or k == N:\n                    is_boundary[node_idx(i, j, k)] = True\n    \n    interior_nodes = np.where(~is_boundary)[0]\n    boundary_nodes = np.where(is_boundary)[0]\n    num_interior = len(interior_nodes)\n\n    global_to_interior_map = {glob_idx: i for i, glob_idx in enumerate(interior_nodes)}\n\n    # --- 2. FEM Assembly ---\n    K_II = np.zeros((num_interior, num_interior))\n    K_IB = np.zeros((num_interior, len(boundary_nodes)))\n    b_I = np.zeros(num_interior)\n    \n    # Gradients of barycentric coordinates on reference tet\n    grad_ref = np.array([[-1,-1,-1], [1,0,0], [0,1,0], [0,0,1]], dtype=float).T\n\n    for tet in tets:\n        p0, p1, p2, p3 = nodes[tet[0]], nodes[tet[1]], nodes[tet[2]], nodes[tet[3]]\n        \n        T = np.array([p1 - p0, p2 - p0, p3 - p0]).T\n        T_inv_T = np.linalg.inv(T).T\n        \n        det_T = np.linalg.det(T)\n        vol = abs(det_T) / 6.0\n        \n        # Gradients in physical coordinates\n        grad_phi = T_inv_T @ grad_ref\n        \n        # Element stiffness matrix\n        K_e = vol * (grad_phi.T @ grad_phi)\n        \n        # Element load vector\n        b_e = f * vol / 4.0\n        \n        # Assemble into global system (partitioned)\n        for i_local in range(4):\n            glob_i = tet[i_local]\n            is_i_interior = not is_boundary[glob_i]\n\n            if is_i_interior:\n                ii = global_to_interior_map[glob_i]\n                b_I[ii] += b_e\n                \n            for j_local in range(4):\n                glob_j = tet[j_local]\n                is_j_interior = not is_boundary[glob_j]\n                \n                if is_i_interior and is_j_interior:\n                    ii = global_to_interior_map[glob_i]\n                    jj = global_to_interior_map[glob_j]\n                    K_II[ii, jj] += K_e[i_local, j_local]\n                elif is_i_interior and not is_j_interior:\n                    ii = global_to_interior_map[glob_i]\n                    bj = np.where(boundary_nodes == glob_j)[0][0]\n                    K_IB[ii, bj] += K_e[i_local, j_local]\n\n    # --- 3. Apply BCs and Solve ---\n    u_B = np.array([u_star_func(nodes[idx]) for idx in boundary_nodes])\n    \n    rhs = b_I - K_IB @ u_B\n    u_I = np.linalg.solve(K_II, rhs)\n\n    # --- 4. Compute Metrics ---\n    # Condition number\n    eigvals = np.linalg.eigvalsh(K_II)\n    kappa = eigvals[-1] / eigvals[0]\n    \n    # Reconstruct full solution vector\n    u_full = np.zeros(num_nodes)\n    u_full[interior_nodes] = u_I\n    u_full[boundary_nodes] = u_B\n\n    # L2 Error\n    err_sq_norm = 0.0\n    ustar_sq_norm = 0.0\n    for tet in tets:\n        p_coords = nodes[tet]\n        centroid = np.mean(p_coords, axis=0)\n        \n        # Volume of current tet\n        p0, p1, p2, p3 = p_coords[0], p_coords[1], p_coords[2], p_coords[3]\n        T_mat = np.array([p1 - p0, p2 - p0, p3 - p0]).T\n        vol = abs(np.linalg.det(T_mat)) / 6.0\n        \n        u_h_centroid = np.mean(u_full[tet])\n        u_star_centroid = u_star_func(centroid)\n        \n        err_sq_norm += vol * (u_h_centroid - u_star_centroid)**2\n        ustar_sq_norm += vol * (u_star_centroid)**2\n\n    rel_err = np.sqrt(err_sq_norm / ustar_sq_norm) if ustar_sq_norm  0 else 0.0\n    \n    return kappa, rel_err\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3450603"}, {"introduction": "除了影响静态系统的 conditioning，网格几何还直接制约着求解双曲型守恒律（如平流方程）的显式时间步进方法的稳定性。此练习 [@problem_id:3450651] 将焦点转向有限体积法，并提出一个涉及钝角三角形的经典挑战，这类几何形状对许多数值格式都构成考验。通过为这个特定情况推导出一个保证解的正定性的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，即形如 $\\Delta t \\le \\frac{C(\\gamma,h)}{|\\boldsymbol{a}|}$ 的约束，您将深刻体会到局部网格特征如何对全局模拟的时间步长施加严格的限制。", "problem": "考虑在非结构化三角网格上的线性平流方程 $u_{t} + \\boldsymbol{a} \\cdot \\nabla u = 0$，其中速度 $\\boldsymbol{a} \\in \\mathbb{R}^{2}$ 为常数。我们关注一个单一的等腰三角形控制体 $K$，其两条等边长度为 $h$，与底边相对的顶点处有一个钝顶角 $\\gamma \\in \\left(\\frac{\\pi}{2}, \\pi\\right)$。所有角度均以弧度为单位。设 $\\boldsymbol{a}$ 与钝顶角的角平分线对齐，方向从底边指向顶点，因此它与底边正交，并从底边一侧指向三角形内部。\n\n您使用单元中心有限体积法进行离散化，采用前向欧拉时间步进和迎风数值通量。在 $K$ 内部，您使用带有保正限制器的分片线性重构，该限制器保证，当时间 $t^{n}$ 时所有相邻单元的平均值非负时，用于通量计算的每个重构的面上状态也非负。假设边 $e$ 上的外向单位法向量记为 $\\boldsymbol{n}_{e}$，边长记为 $|e|$。$K$ 的前向欧拉更新公式为\n$$\n\\bar{u}_{K}^{\\,n+1} \\;=\\; \\bar{u}_{K}^{\\,n} \\;-\\; \\frac{\\Delta t}{|K|} \\sum_{e \\subset \\partial K} \\left(\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}\\right)\\, u_{e}^{\\text{up}}\\, |e| ,\n$$\n其中 $|K|$ 是 $K$ 的面积，$u_{e}^{\\text{up}}$ 是在边 $e$ 上的迎风状态，该状态取自经过保正限制的重构。\n\n仅使用有限体积法的守恒形式、迎风通量的定义以及限制器保持重构状态非负性的性质，推导一个形如\n$$\n\\Delta t \\;\\le\\; \\frac{C(\\gamma,h)}{|\\boldsymbol{a}|}\n$$\n的 Courant–Friedrichs–Lewy (CFL) 约束，该约束保证，在时间 $t^{n}$ 进入通量计算的数据为非负时，$\\bar{u}_{K}^{\\,n+1} \\ge 0$ 成立。对于此三角形-速度配置，计算 $C(\\gamma,h)$ 关于 $h$ 和 $\\gamma$ 的精确闭式表达式。以 $h$、$\\gamma$ 和 $|\\boldsymbol{a}|$ 的形式，为最大允许时间步长 $\\Delta t_{\\max}$ 提供一个单一的解析表达式。无需进行四舍五入。", "solution": "对问题陈述的分析始于对其前提和结构的验证。该问题在偏微分方程数值方法这一成熟领域具有坚实的科学基础。这是一个适定问题，提供了特定的几何形状、一个控制方程、一种离散化格式和一个明确的目标。其语言客观、正式。设定是自洽的，没有内部矛盾。因此，该问题被认为是有效的，有必要给出完整解答。\n\n目标是推导时间步长 $\\Delta t$ 的 Courant–Friedrichs–Lewy (CFL) 条件，以保证在时间 $t^n$ 的所有相关数据均为非负的情况下，单元平均值 $\\bar{u}_{K}^{\\,n+1}$ 的正性，即 $\\bar{u}_{K}^{\\,n+1} \\ge 0$。\n\n有限体积更新公式如下：\n$$\n\\bar{u}_{K}^{\\,n+1} \\;=\\; \\bar{u}_{K}^{\\,n} \\;-\\; \\frac{\\Delta t}{|K|} \\sum_{e \\subset \\partial K} \\left(\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}\\right)\\, u_{e}^{\\text{up}}\\, |e|\n$$\n其中 $|K|$ 是三角形单元 $K$ 的面积，$\\boldsymbol{a}$ 是恒定的平流速度，$\\boldsymbol{n}_{e}$ 是边 $e$ 的外向单位法向量， $|e|$ 是边长，$u_{e}^{\\text{up}}$ 是边 $e$ 上的迎风状态。\n\n保证正性的条件是 $\\bar{u}_{K}^{\\,n+1} \\ge 0$。代入更新公式，我们要求：\n$$\n\\bar{u}_{K}^{\\,n} \\;-\\; \\frac{\\Delta t}{|K|} \\sum_{e \\subset \\partial K} \\left(\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}\\right)\\, u_{e}^{\\text{up}}\\, |e| \\ge 0\n$$\n\n边上的求和可以分解为流入边界（其中 $\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}  0$）和流出边界（其中 $\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e} > 0$）的贡献。令 $\\partial K_{\\text{in}} = \\{ e \\subset \\partial K \\mid \\boldsymbol{a} \\cdot \\boldsymbol{n}_e  0 \\}$ 和 $\\partial K_{\\text{out}} = \\{ e \\subset \\partial K \\mid \\boldsymbol{a} \\cdot \\boldsymbol{n}_e > 0 \\}$。$\\boldsymbol{a} \\cdot \\boldsymbol{n}_e = 0$ 的情况对求和没有贡献。\n在流入边界上，$u_{e}^{\\text{up}}$ 取自相邻单元的重构。在流出边界上，它取自单元 $K$ 内部的重构。我们分别用 $u_{e,\\text{neigh}}^{\\text{up}}$ 和 $u_{e,K}^{\\text{up}}$ 表示它们。不等式变为：\n$$\n\\bar{u}_{K}^{\\,n} - \\frac{\\Delta t}{|K|} \\left( \\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) u_{e,K}^{\\text{up}} |e| + \\sum_{e \\in \\partial K_{\\text{in}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) u_{e,\\text{neigh}}^{\\text{up}} |e| \\right) \\ge 0\n$$\n问题陈述指出，如果邻域中的单元平均值为非负，则保正限制器能确保重构的面上状态 $u_{e}^{\\text{up}}$ 也为非负。我们假设处于这种情况，因此 $\\bar{u}_{K}^{\\,n} \\ge 0$ 且 $u_{e,\\text{neigh}}^{\\text{up}} \\ge 0$。\n\n流入项 $\\sum_{e \\in \\partial K_{\\text{in}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) u_{e,\\text{neigh}}^{\\text{up}} |e|$ 是非正项之和，因为 $\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}  0$ 且 $u_{e,\\text{neigh}}^{\\text{up}} \\ge 0$。因此，整个和 $\\le 0$。对 $\\Delta t$ 最严格的条件（即维持 $\\bar{u}_{K}^{\\,n+1}$ 正性的“最坏情况”）出现在对 $\\bar{u}_{K}^{\\,n+1}$ 的这个有利的、非负的贡献为最小值（即零）时。这对应于所有流入边上的 $u_{e,\\text{neigh}}^{\\text{up}} = 0$ 的情况。此时条件简化为：\n$$\n\\bar{u}_{K}^{\\,n} - \\frac{\\Delta t}{|K|} \\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) u_{e,K}^{\\text{up}} |e| \\ge 0\n$$\n对 $\\Delta t$ 进行整理：\n$$\n\\Delta t \\le \\frac{\\bar{u}_{K}^{\\,n} |K|}{\\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) u_{e,K}^{\\text{up}} |e|}\n$$\n这个条件取决于状态 $\\bar{u}_{K}^{\\,n}$ 和重构值 $u_{e,K}^{\\text{up}}$。为了推导一个与数据无关的单一 CFL 约束，必须为 $\\sum (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) u_{e,K}^{\\text{up}} |e|$ 这一项找到一个与 $\\bar{u}_{K}^{\\,n}$ 成比例的界。尽管没有给出保正限制器的具体形式，但通过考虑此类格式在具有挑战性的场景中所需的行为，可以推导出一个鲁棒且充分的条件。为了鲁棒地保证正性，特别是当 $\\bar{u}_K^n$ 是一个局部极值时，许多高阶格式实际上会降至一阶精度。在这种一阶极限情况下，流出面上的重构值就是单元平均值，即 $u_{e,K}^{\\text{up}} = \\bar{u}_{K}^{\\,n}$。通过强制执行从此情况推导出的 CFL 条件，我们得到了一个足以保证正性的时间步长。\n\n设 $u_{e,K}^{\\text{up}} = \\bar{u}_{K}^{\\,n}$，不等式变为：\n$$\n\\Delta t \\le \\frac{\\bar{u}_{K}^{\\,n} |K|}{\\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) \\bar{u}_{K}^{\\,n} |e|} = \\frac{|K|}{\\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) |e|}\n$$\n这是一阶迎风有限体积格式的标准 CFL 条件，我们现在针对指定的几何形状对其进行计算。\n\n控制体 $K$ 是一个等腰三角形，有两条长度为 $h$ 的边和一个钝顶角 $\\gamma$。另外两个角相等，为 $\\alpha = (\\pi-\\gamma)/2$。向量 $\\boldsymbol{a}$ 与底边正交并指向顶点。让我们建立一个坐标系，其中顶点位于 y 轴正半轴，底边位于 x 轴上。三角形的高为 $H = h \\cos(\\alpha) = h \\cos(\\frac{\\pi-\\gamma}{2}) = h \\sin(\\frac{\\gamma}{2})$。底边长为 $b = 2h\\sin(\\alpha) = 2h \\sin(\\frac{\\pi-\\gamma}{2}) = 2h\\cos(\\frac{\\gamma}{2})$。\n三角形的面积为 $|K| = \\frac{1}{2} b H = \\frac{1}{2} (2h\\cos(\\frac{\\gamma}{2})) (h\\sin(\\frac{\\gamma}{2})) = h^2 \\sin(\\frac{\\gamma}{2})\\cos(\\frac{\\gamma}{2})$。这也可以写成 $|K| = \\frac{1}{2}h^2\\sin\\gamma$。\n\n速度向量为 $\\boldsymbol{a} = (0, |\\boldsymbol{a}|)$。三条边分别是底边（$e_1$）和两条等边（$e_2, e_3$）。\n- **底边 ($e_1$)**：外向法向量为 $\\boldsymbol{n}_{e_1} = (0, -1)$。点积为 $\\boldsymbol{a} \\cdot \\boldsymbol{n}_{e_1} = -|\\boldsymbol{a}|  0$。这是一条流入边。\n- **等边 ($e_2, e_3$)**：这两条边构成顶点。我们来求它们的法向量。从顶点 $(0, H)$ 到一个底边顶点（比如 $(b/2, 0)$）的向量有一个斜率。由于 $\\boldsymbol{a}$ 是从底边指向三角形内部的，这两条上边的外向法向量将具有正的 y 分量。更严格地说，垂直的 y 轴与边 $e_2$ 之间的夹角是 $\\gamma/2$。法向量 $\\boldsymbol{n}_{e_2}$ 与此边垂直。边 $e_2$ 相对于 y 轴负方向的角度是 $\\gamma/2$。沿边 $e_2$ 从顶点到基底的向量，归一化后的方向是 $(\\sin(\\gamma/2), -\\cos(\\gamma/2))$。法向量 $\\boldsymbol{n}_{e_2}$ 必须是正交的并指向外部。这得到 $\\boldsymbol{n}_{e_2} = (\\cos(\\gamma/2), \\sin(\\gamma/2))$。根据对称性，$\\boldsymbol{n}_{e_3} = (-\\cos(\\gamma/2), \\sin(\\gamma/2))$。\n点积为：\n- $\\boldsymbol{a} \\cdot \\boldsymbol{n}_{e_2} = (0, |\\boldsymbol{a}|) \\cdot (\\cos(\\frac{\\gamma}{2}), \\sin(\\frac{\\gamma}{2})) = |\\boldsymbol{a}|\\sin(\\frac{\\gamma}{2})$。因为 $\\gamma \\in (\\pi/2, \\pi)$，所以 $\\gamma/2 \\in (\\pi/4, \\pi/2)$，因此 $\\sin(\\gamma/2)0$。这是一条流出边。\n- $\\boldsymbol{a} \\cdot \\boldsymbol{n}_{e_3} = (0, |\\boldsymbol{a}|) \\cdot (-\\cos(\\frac{\\gamma}{2}), \\sin(\\frac{\\gamma}{2})) = |\\boldsymbol{a}|\\sin(\\frac{\\gamma}{2})$。这也是一条流出边。\n\n流出边界 $\\partial K_{\\text{out}}$ 由两条长度为 $h$ 的等边 $e_2$ 和 $e_3$ 组成。我们现在可以计算 CFL 条件的分母：\n$$\n\\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) |e| = (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e_2})|e_2| + (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e_3})|e_3|\n= (|\\boldsymbol{a}|\\sin(\\frac{\\gamma}{2}))h + (|\\boldsymbol{a}|\\sin(\\frac{\\gamma}{2}))h\n= 2h|\\boldsymbol{a}|\\sin(\\frac{\\gamma}{2})\n$$\n注：通常会使用另一种三角形几何的计算方法。顶点 $V_3=(0, h\\cos(\\gamma/2))$，底边顶点 $V_1, V_2 = (\\mp h \\sin(\\gamma/2), 0)$。面积 $|K| = h^2 \\sin(\\gamma/2)\\cos(\\gamma/2)$。此设置会得到相同的结果。\n\n现在我们将面积和流出项的和代入 CFL 不等式：\n$$\n\\Delta t \\le \\frac{|K|}{\\sum_{e \\in \\partial K_{\\text{out}}} (\\boldsymbol{a}\\cdot \\boldsymbol{n}_{e}) |e|} = \\frac{h^2 \\sin(\\frac{\\gamma}{2})\\cos(\\frac{\\gamma}{2})}{2h|\\boldsymbol{a}|\\sin(\\frac{\\gamma}{2})}\n$$\n项 $h$ 和 $\\sin(\\gamma/2)$ 消掉了：\n$$\n\\Delta t \\le \\frac{h\\cos(\\frac{\\gamma}{2})}{2|\\boldsymbol{a}|}\n$$\n这个表达式给出了在推导出的条件下最大允许时间步长 $\\Delta t_{\\max}$。余弦项是正的，因为 $\\gamma/2 \\in (\\pi/4, \\pi/2)$。\n\n最大允许时间步长的最终结果是：\n$$\n\\Delta t_{\\max} = \\frac{h\\cos(\\frac{\\gamma}{2})}{2|\\boldsymbol{a}|}\n$$", "answer": "$$\\boxed{\\frac{h\\cos\\left(\\frac{\\gamma}{2}\\right)}{2|\\boldsymbol{a}|}}$$", "id": "3450651"}]}