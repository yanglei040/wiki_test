{"hands_on_practices": [{"introduction": "局部一维（LOD）方法的一个主要优点是其计算效率，尤其是在求解线性问题时。本练习将引导你通过第一性原理分析该方法所需的浮点运算（flop）次数，从而揭示在常系数问题中通过预计算矩阵因子分解所能获得的巨大加速效果。通过这项练习[@problem_id:3417697]，你将亲手量化LOD方法的计算优势，并理解该优势在系数随空间或时间变化时为何会减弱，这是评估数值方法性能的一项基本技能。", "problem": "考虑一个方形区域上的二维热方程，其扩散系数为常数，在每个空间方向上有$n$个内部点的均匀网格上进行离散化，并使用局部一维（LOD）分裂法进行时间推进。记$A_{x}$和$A_{y}$分别为在$x$和$y$方向上的一维二阶差分矩阵，它们由带狄利克雷边界条件的标准中心差分法产生。在每个时间步的一次隐式LOD扫描中，您需要在$x$方向上求解$n$个独立的$n$阶三对角系统，其系数矩阵为$\\left(I - \\theta \\Delta t A_{x}\\right)$；在$y$方向上求解$n$个独立的$n$阶三对角系统，其系数矩阵为$\\left(I - \\theta \\Delta t A_{y}\\right)$。其中，$I$是单位矩阵，$\\theta \\in (0,1]$是一个固定的方法参数，$\\Delta t$是时间步长。假设共有$m$个时间步。\n\n使用以下基础：\n- LOD分裂法将多维隐式步骤简化为沿网格线的一系列一维隐式求解。对于均匀网格上的恒定系数，给定方向上所有网格线的三对角系数矩阵在每个时间步都是相同的。\n- 一次浮点运算（flop）指一次加法、减法、乘法或除法，每次计为$1$。\n- 使用Thomas算法（三对角LU分解后进行前向和后向代换）求解三对角系统，您必须从第一性原理推导其分解和求解阶段的浮点运算数。\n\n任务：\n1. 推导通过Thomas算法将单个$n \\times n$三对角矩阵分解为下双对角和上双对角因子的浮点运算数，以及使用这些预计算的因子求解一个右端项的浮点运算数。\n2. 使用这些计数，推导在$m$个时间步内的总浮点运算成本，针对以下两种情况：\n   - $\\left(I - \\theta \\Delta t A_{\\alpha}\\right)$（其中$\\alpha \\in \\{x,y\\}$）的LU分解在每个方向上预计算一次，并对所有网格线和所有时间步重用（恒定系数情况）。\n   - LU分解在每个时间步的每次网格线求解时都重新计算（无重用情况）。\n3. 将加速比$S(n,m)$定义为无重用情况下的总浮点运算数与预计算并重用情况下的总浮点运算数的比率。以闭式形式给出$S(n,m)$。\n4. 在您的推导中，简要解释当系数是空间可变的，以至于不同网格线和/或不同时间步的矩阵不同时，情况会发生什么变化。\n\n您的最终答案必须是$S(n,m)$的闭式解析表达式。不需要数值四舍五入，也不需要物理单位。", "solution": "问题陈述经评估有效。它在数值线性代数和偏微分方程数值解领域具有科学依据。其前提准确，且其组成部分——局部一维(LOD)方法、Thomas算法以及浮点运算(flop)的定义——都有明确定义且是标准的。该问题是自洽的、客观的且适定的，根据所提供的信息可以得出一个唯一的解析解。\n\n我们开始推导。\n\n### 任务1：Thomas算法的浮点运算数\n\nThomas算法求解一个$n \\times n$的三对角线性系统$T\\mathbf{u}=\\mathbf{d}$。该过程包括两个阶段：矩阵$T$的分解（等效于前向消元）和使用计算出的因子进行求解（前向和后向代换）。我们将基于Crout分解$T=LU$推导每个阶段的浮点运算数，其中$L$是一个下双对角矩阵，$U$是一个单位上双对角矩阵。\n\n设三对角矩阵$T$的下对角元为$a_i$（$i=2, \\dots, n$），主对角元为$b_i$（$i=1, \\dots, n$），上对角元为$c_i$（$i=1, \\dots, n-1$）。分解$T = LU$得到：\n$$\nL = \\begin{pmatrix}\n\\alpha_1    \\\\\na_2  \\alpha_2   \\\\\n \\ddots  \\ddots  \\\\\n  a_n  \\alpha_n\n\\end{pmatrix}, \\quad\nU = \\begin{pmatrix}\n1  \\beta_1   \\\\\n 1  \\beta_2  \\\\\n  \\ddots  \\ddots \\\\\n   1\n\\end{pmatrix}\n$$\n将$T$的元素与$LU$的元素相等，可得到因子元素$\\alpha_i$和$\\beta_i$的递推关系：\n- $\\alpha_1 = b_1$\n- $\\alpha_i \\beta_i = c_i \\implies \\beta_i = c_i / \\alpha_i$，对于$i=1, \\dots, n-1$。\n- $a_i \\beta_{i-1} + \\alpha_i = b_i \\implies \\alpha_i = b_i - a_i \\beta_{i-1}$，对于$i=2, \\dots, n$。\n\n**1. A. 分解成本 ($C_{fact}(n)$):**\n该阶段计算$n$个$\\alpha_i$值和$n-1$个$\\beta_i$值。\n- 对于$i=1$：\n  - $\\alpha_1 = b_1$（0次浮点运算）\n  - $\\beta_1 = c_1 / \\alpha_1$（1次除法）\n- 对于$i=2, \\dots, n-1$：\n  - $\\alpha_i = b_i - a_i \\beta_{i-1}$（1次乘法，1次减法 = 2次浮点运算）\n  - $\\beta_i = c_i / \\alpha_i$（1次除法）\n  这个循环运行$n-2$次，每次耗费3次浮点运算。总计：$3(n-2)$次浮点运算。\n- 对于$i=n$：\n  - $\\alpha_n = b_n - a_n \\beta_{n-1}$（1次乘法，1次减法 = 2次浮点运算）\n\n总分解成本是这些成本的总和：\n$C_{fact}(n) = 1 + 3(n-2) + 2 = 1 + 3n - 6 + 2 = 3n - 3$。\n因此，分解单个$n \\times n$三对角矩阵的成本为$C_{fact}(n) = 3(n-1)$次浮点运算。\n\n**1. B. 求解成本 ($C_{solve}(n)$):**\n此阶段使用预计算的因子$L$和$U$对给定的右端项$\\mathbf{d}$求解$T\\mathbf{u}=LU\\mathbf{u}=\\mathbf{d}$。这是一个两步过程：\n1.  求解$L\\mathbf{y} = \\mathbf{d}$（前向代换）：\n    - $y_1 = d_1 / \\alpha_1$（1次除法）\n    - 对于$i=2, \\dots, n$：$a_i y_{i-1} + \\alpha_i y_i = d_i \\implies y_i = (d_i - a_i y_{i-1}) / \\alpha_i$。每次迭代耗费1次乘法、1次减法和1次除法，总共3次浮点运算。该循环运行$n-1$次迭代。\n    前向代换的成本：$1 + 3(n-1) = 3n-2$次浮点运算。\n\n2.  求解$U\\mathbf{u} = \\mathbf{y}$（后向代换）：\n    - $u_n = y_n$（0次浮点运算，因为最后一个方程是$1 \\cdot u_n = y_n$）\n    - 对于$i=n-1, \\dots, 1$：$u_i + \\beta_i u_{i+1} = y_i \\implies u_i = y_i - \\beta_i u_{i+1}$。每次迭代耗费1次乘法和1次减法，总共2次浮点运算。该循环运行$n-1$次迭代。\n    后向代换的成本：$2(n-1)$次浮点运算。\n\n使用预计算因子求解一个系统的总成本是：\n$C_{solve}(n) = (3n-2) + 2(n-1) = 3n-2 + 2n-2 = 5n-4$。\n\n总结如下：\n- 分解成本：$C_{fact}(n) = 3n-3$\n- 求解成本（使用因子）：$C_{solve}(n) = 5n-4$\n\n### 任务2：LOD方法的总浮点运算成本\n\nLOD方法每个时间步包含两次扫描：一次在x方向，一次在y方向。每次扫描需要求解$n$个独立的$n \\times n$三对角系统。模拟运行$m$个时间步。\n\n**情况A：预计算并重用**\n在这种情况下，系数矩阵$\\left(I - \\theta \\Delta t A_{x}\\right)$和$\\left(I - \\theta \\Delta t A_{y}\\right)$对所有网格线和所有时间步都是恒定的。这使得LU分解可以最大程度地重用。我们只需要为整个模拟分解两个矩阵：一个用于x方向，一个用于y方向。\n\n- **总分解成本：**\n  $C_{fact, \\text{total}} = 2 \\times C_{fact}(n) = 2(3n-3) = 6n-6$。\n\n- **总求解成本：**\n  在每个时间步，我们在x方向求解$n$个系统，在y方向求解$n$个系统，总共$2n$个系统。这个过程重复$m$个时间步。\n  $C_{solve, \\text{total}} = m \\times (2n) \\times C_{solve}(n) = 2mn(5n-4)$。\n\n- **总成本（重用）：**\n  $C_{\\text{reuse}} = C_{fact, \\text{total}} + C_{solve, \\text{total}} = (6n-6) + 2mn(5n-4)$。\n\n**情况B：无重用**\n在这种情况下，每次求解系统时都会重新计算LU分解。这相当于“从头开始”求解每个系统。\n\n- **每个系统成本（从头开始）：**\n  $C_{\\text{scratch}}(n) = C_{fact}(n) + C_{solve}(n) = (3n-3) + (5n-4) = 8n-7$。\n\n- **总成本（无重用）：**\n  在整个模拟过程中要求解的系统总数为$m \\times 2n = 2mn$。\n  $C_{\\text{no-reuse}} = (2mn) \\times C_{\\text{scratch}}(n) = 2mn(8n-7)$。\n\n### 任务4：可变系数的影响\n\n“无重用”的情况不仅仅是一个理论构造。它模拟了重要的物理情景。如果偏微分方程的系数，如热扩散系数，是空间可变的（即，依赖于$x$和$y$），那么矩阵$A_x$和$A_y$会依赖于网格线。例如，在网格线$y_j$处的矩阵$(I - \\theta \\Delta t A_x)$将不同于$y_k$处的矩阵（其中$j \\neq k$）。在这种情况下，必须为x方向扫描计算$n$个不同的分解，为y方向扫描计算$n$个不同的分解。如果系数也是时间依赖的，那么这$2n$个分解必须在$m$个时间步中的每一步都重新计算。后一种空间和时间可变系数的情况与成本模型$C_{\\text{no-reuse}}$完全对应，因为分解不能跨网格线或时间步重用。\n\n### 任务3：加速比 $S(n,m)$\n\n加速比$S(n,m)$是无重用情况下的总浮点运算数与预计算并重用情况下的总浮点运算数的比率。\n\n$$S(n,m) = \\frac{C_{\\text{no-reuse}}}{C_{\\text{reuse}}}$$\n代入推导出的表达式：\n$$S(n,m) = \\frac{2mn(8n-7)}{(6n-6) + 2mn(5n-4)}$$\n我们可以通过将分子和分母同时除以$2$来简化此表达式：\n$$S(n,m) = \\frac{mn(8n-7)}{3(n-1) + mn(5n-4)}$$\n这就是加速比的最终闭式表达式。", "answer": "$$\n\\boxed{\\frac{mn(8n-7)}{3(n-1) + mn(5n-4)}}\n$$", "id": "3417697"}, {"introduction": "在解决了简单的热方程之后，我们将注意力转向更复杂的反应扩散模型，这类模型在化学、生物学和物理学中广泛存在。当系统中引入非线性反应项时，确保数值解的稳定性以及像“正定性”这样的物理属性变得至关重要。本练习[@problem_id:3417655]将引导你分析在一个包含非线性反应项的LOD分裂格式中，如何推导出保证解的稳定性和唯一性的时间步长限制，这对于模拟真实的物理过程至关重要。", "problem": "考虑单位正方形上的二维反应扩散方程，其边界条件为齐次狄利克雷边界条件，\n$$\nu_{t} \\;=\\; u_{xx} \\,+\\, u_{yy} \\,+\\, R(u), \\quad (x,y)\\in(0,1)^{2}, \\quad t>0,\n$$\n初始条件为 $u(x,y,0)=u_{0}(x,y)\\ge 0$。假设 $R:\\mathbb{R}\\to\\mathbb{R}$ 是非负、非递减的函数，对于所有 $u\\in\\mathbb{R}$ 都有 $R(u)\\ge 0$，并且在 $[0,\\infty)$ 上是全局利普希茨的，利普希茨常数为 $L>0$，因此对于所有 $u,v\\ge 0$ 都有 $|R(u)-R(v)|\\le L\\,|u-v|$。\n\n使用在两个方向上间距均为 $h$ 的均匀笛卡尔网格对 $(0,1)^{2}$ 进行离散化，并用二阶中心差分近似 $u_{xx}$ 和 $u_{yy}$。设 $A_{x}$ 和 $A_{y}$ 分别表示沿 $x$ 和 $y$ 方向的一维离散拉普拉斯算子，它们作用于内部点上的网格函数，并将齐次狄利克雷边界值合并到右端项中。考虑在大小为 $\\Delta t>0$ 的单个时间步长上进行局部一维（LOD）Lie 分裂，该分裂由以下三个子步骤组成：\n$$\n\\text{(x-扩散)}\\quad (I \\,-\\, \\Delta t\\,A_{x})\\,u^{(1)} \\;=\\; u^{n},\n$$\n$$\n\\text{(y-扩散)}\\quad (I \\,-\\, \\Delta t\\,A_{y})\\,u^{(2)} \\;=\\; u^{(1)},\n$$\n$$\n\\text{(反应)}\\quad u^{n+1} \\,-\\, \\Delta t\\,R\\!\\left(u^{n+1}\\right) \\;=\\; u^{(2)},\n$$\n其中每个方程都在内部网格点上求解，而反应子步骤则是逐点求解的。\n\n从离散扩散算子和非负、非递减反应项的定义和性质出发，推导使完整LOD格式保持正性并且在 $L^{1}$ 范数下稳定的条件。此处的稳定意味着扩散子步骤是 $L^{1}$-收缩的，并且反应子步骤具有有限的 $L^{1}$ 放大因子。确定以全局利普希茨常数 $L$ 表示的最大允许时间步长 $\\Delta t_{\\max}$，该步长能保证隐式反应子步骤的唯一性和单调性，从而保证整个LOD步骤的适定性和 $L^{1}$ 稳定性。将你的最终答案以 $\\Delta t_{\\max}$ 的单个闭式解析表达式形式给出。", "solution": "问题陈述经分析是科学上合理的、适定的、客观且自洽的。它代表了偏微分方程数值分析中的一个标准问题。求解过程如下。\n\n设计算域为一个点网格 $(x_i, y_j) = (ih, jh)$，其中 $i, j \\in \\{1, \\dots, N-1\\}$，$h$ 是两个方向上的网格间距。设 $u^n_{ij}$ 表示 $u(x_i, y_j, t_n)$ 的数值近似。网格函数 $v$ 的离散 $L^1$ 范数由 $\\|v\\|_1 = \\sum_{i,j} |v_{ij}|h^2$ 给出。\n\n局部一维（LOD）格式包含三个子步骤，用于从时间 $t_n$ 推进到 $t_{n+1} = t_n + \\Delta t$。我们假设初始数据 $u^n$ 是非负的，即对所有 $i,j$ 都有 $u^n_{ij} \\ge 0$，并分析每个子步骤的正性保持和 $L^1$ 稳定性。\n\n### 子步骤1：x-扩散\n\n第一个子步骤由 $(I - \\Delta t A_x) u^{(1)} = u^n$ 给出。这是一个需求解中间解 $u^{(1)}$ 的线性方程组。算子 $A_x$ 表示对关于 $x$ 的二阶偏导数的标准二阶中心差分近似：\n$$(A_x v)_{ij} = \\frac{v_{i+1,j} - 2v_{ij} + v_{i-1,j}}{h^2}$$\n对于每个固定的行索引 $j$，该方程构成一个关于未知向量 $(u^{(1)}_{1j}, \\dots, u^{(1)}_{N-1,j})$ 的线性系统。该系统的矩阵形式为 $M_x \\mathbf{u}^{(1)}_j = \\mathbf{u}^n_j$，其中 $\\mathbf{u}_j$ 是表示沿第 $j$ 行的网格函数值的向量，矩阵 $M_x = I - \\Delta t \\mathbf{A}_x$。这里，$\\mathbf{A}_x$ 是在单行上表示算子 $A_x$ 的 $(N-1) \\times (N-1)$ 矩阵，带有齐次狄利克雷边界条件（$u_{0j} = u_{Nj} = 0$）。矩阵 $M_x$ 是一个对称三对角矩阵，其对角元素为 $1 + 2\\Delta t/h^2$，非对角元素为 $-\\Delta t/h^2$。\n\n**正性保持：** 矩阵 $M_x$ 具有正的对角元素和非正的非对角元素。它也是严格对角占优的，因为 $|1 + 2\\Delta t/h^2| > |-\\Delta t/h^2| + |-\\Delta t/h^2|$（对于内部行）和 $|1 + 2\\Delta t/h^2| > |-\\Delta t/h^2|$（对于边界行），这可以简化为 $1 > 0$。一个具有非正非对角元素的严格对角占优矩阵是一个M-矩阵。M-矩阵的一个关键性质是其逆矩阵 $M_x^{-1}$ 的所有元素都是非负的。\n由于 $u^{(1)} = (I - \\Delta t A_x)^{-1} u^n$，并假设对所有 $i,j$ 都有 $u^n_{ij} \\ge 0$，因此可推断出 $u^{(1)}_{ij} \\ge 0$。所以，对于任何 $\\Delta t > 0$，此子步骤都是无条件保持正性的。\n\n**$L^1$-收缩性：** 我们需要证明 $\\|u^{(1)}\\|_1 \\le \\|u^n\\|_1$。\n设 $S_x = (I - \\Delta t A_x)^{-1}$ 为此子步骤的解算子。我们已经证明 $S_x$ 是一个（逐元素的）非负矩阵。让我们分析其在某一行上的矩阵表示 $M_x^{-1}$ 的列和。设 $\\mathbf{1}$ 是全1向量。$M_x^{-1}$ 第 $k$ 列的元素之和由 $\\mathbf{1}^T M_x^{-1} \\mathbf{e}_k$ 给出。\n或者，考虑对于固定的 $j$，解向量 $w_i = u^{(1)}_{ij}$ 的某一行中元素的和。将方程 $(w - \\Delta t A_x w)_{i} = v_i$（其中 $v_i = u^n_{ij}$）对 $i = 1, \\dots, N-1$ 求和：\n$$ \\sum_{i=1}^{N-1} w_i - \\Delta t \\sum_{i=1}^{N-1} (A_x w)_i = \\sum_{i=1}^{N-1} v_i $$\n离散拉普拉斯项的和，考虑到 $w_0=w_N=0$，为：\n$$ \\sum_{i=1}^{N-1} (A_x w)_i = \\frac{1}{h^2} \\sum_{i=1}^{N-1} (w_{i+1} - 2w_i + w_{i-1}) = \\frac{1}{h^2} (-w_1 - w_{N-1}) $$\n由于 $v_i = u^n_{ij} \\ge 0$，我们有 $w_i = u^{(1)}_{ij} \\ge 0$。因此，$-w_1-w_{N-1} \\le 0$，这意味着 $\\sum_i (A_x w)_i \\le 0$。\n所以，$\\sum_i w_i = \\sum_i v_i + \\Delta t \\sum_i (A_x w)_i \\le \\sum_i v_i$。\n由于这对每一行 $j$ 都成立，我们可以对 $j$ 求和：$\\sum_j \\sum_i u^{(1)}_{ij} \\le \\sum_j \\sum_i u^n_{ij}$。\n因为 $u^n$ 和 $u^{(1)}$ 是非负的，这等价于 $\\sum_{i,j} |u^{(1)}_{ij}| \\le \\sum_{i,j} |u^n_{ij}|$，即 $\\|u^{(1)}\\|_1 \\le \\|u^n\\|_1$。\n对于非负数据，此子步骤是无条件 $L^1$-收缩的。对于任何数据，一个更一般的证明也无条件地显示了这一点。\n\n### 子步骤2：y-扩散\n\n第二个子步骤是 $(I - \\Delta t A_y) u^{(2)} = u^{(1)}$。其分析与第一个子步骤完全相同，只是索引 $i$ 和 $j$ 的角色互换。算子 $A_y$ 作用于列。该步骤无条件保持正性且是 $L^1$-收缩的。因此，如果 $u^n \\ge 0$，我们有 $u^{(2)} \\ge 0$ 且 $\\|u^{(2)}\\|_1 \\le \\|u^{(1)}\\|_1 \\le \\|u^n\\|_1$。\n\n### 子步骤3：反应\n\n第三个子步骤是关于 $u^{n+1}$ 的逐点非线性方程：\n$$ u^{n+1}_{ij} - \\Delta t R(u^{n+1}_{ij}) = u^{(2)}_{ij} $$\n设 $w = u^{n+1}_{ij}$ 和 $v = u^{(2)}_{ij}$。我们需要求解 $f(w) = w - \\Delta t R(w) = v$。从前面的步骤可知，$v \\ge 0$。\n\n**正性保持：** 我们必须证明 $w \\ge 0$。假设 $w  0$ 以寻求矛盾。问题陈述中指出，对于所有 $u \\in \\mathbb{R}$ 都有 $R(u) \\ge 0$。因此，如果 $w  0$，那么 $R(w) \\ge 0$。由此得出 $f(w) = w - \\Delta t R(w)  0$。然而，我们求解的是 $f(w) = v$，并且我们知道 $v \\ge 0$。这是一个矛盾。因此，$w$ 必须是非负的。此步骤无条件保持正性。\n\n**适定性（唯一性和单调性）：** 对于任意给定的 $v$，要存在唯一的解 $w$，函数 $f(w)$ 必须是一个双射。一个充分条件是 $f(w)$ 严格递增。我们分析其导数（或斜率）。因为我们已经确定 $w \\ge 0$，所以我们可以使用 $R(u)$ 在 $[0, \\infty)$ 上的性质。对于 $u \\ge 0$，反应项 $R(u)$ 是非递减的，并且是全局利普希茨的，常数为 $L  0$。这意味着对于任意 $w_1, w_2 \\ge 0$ 且 $w_1 \\ne w_2$，我们有 $0 \\le \\frac{R(w_1) - R(w_2)}{w_1 - w_2} \\le L$。\n$f(w)$ 的斜率由下式给出：\n$$ \\frac{f(w_1) - f(w_2)}{w_1 - w_2} = 1 - \\Delta t \\frac{R(w_1) - R(w_2)}{w_1 - w_2} $$\n为使 $f(w)$ 严格递增，我们要求其斜率严格为正。\n$$ 1 - \\Delta t \\frac{R(w_1) - R(w_2)}{w_1 - w_2}  0 $$\n由于涉及 $R$ 的商以 $L$ 为界，保证对所有 $w_1, w_2$ 该不等式成立的一个充分条件是 $1 - \\Delta t L  0$。这得出了对时间步长的条件：\n$$ \\Delta t  \\frac{1}{L} $$\n如果这个条件成立，$f(w)$ 就是严格递增的，这保证了对于任何 $v$ 都存在唯一的解 $w$。这也保证了单调性：如果 $v_a  v_b$，那么对应的解 $w_a  w_b$。如果 $\\Delta t = 1/L$，唯一性可能会丧失（例如，当 $R(u)=Lu$ 时）。\n\n**$L^1$ 稳定性：** 我们考察这个子步骤的放大因子。设 $w_a$ 和 $w_b$ 是对应于输入 $v_a$ 和 $v_b$ 的解。\n$$ |v_a - v_b| = |f(w_a) - f(w_b)| = \\left| 1 - \\Delta t \\frac{R(w_a) - R(w_b)}{w_a - w_b} \\right| |w_a - w_b| $$\n在条件 $\\Delta t  1/L$ 下，我们有 $1 - \\Delta t L  0$，并且绝对值内的项的下界为 $1 - \\Delta t L$。所以：\n$$ |v_a - v_b| \\ge (1 - \\Delta t L)|w_a - w_b| $$\n$$ |w_a - w_b| \\le \\frac{1}{1 - \\Delta t L} |v_a - v_b| $$\n这个不等式对每个网格点都逐点成立。对所有网格点求和并乘以 $h^2$，我们得到了两个解之差在 $L^1$ 范数下的稳定性估计：\n$$ \\|w_a - w_b\\|_1 \\le \\frac{1}{1 - \\Delta t L} \\|v_a - v_b\\|_1 $$\n扰动的放大因子是 $(1 - \\Delta t L)^{-1}$。为使该因子有限，我们要求 $\\Delta t  1/L$。这确保了反应子步骤的 $L^1$ 稳定性。\n\n### 综合与结论\n\n扩散子步骤是无条件保持正性且 $L^1$-收缩的。反应子步骤是无条件保持正性的。然而，要使整个LOD格式是适定且 $L^1$-稳定的，反应子步骤必须是适定的（保证唯一性）并具有有限的 $L^1$ 放大因子。这两个性质都导向了对时间步长的相同约束：$\\Delta t  1/L$。\n\n问题要求保证这些性质的最大允许时间步长 $\\Delta t_{\\max}$。有效时间步长的集合是区间 $(0, 1/L)$。该集合的上确界是 $1/L$。因此，最大允许时间步长为 $\\Delta t_{\\max} = 1/L$。任何实际实现都必须使用严格小于此值的某个时间步长 $\\Delta t$。", "answer": "$$\\boxed{\\frac{1}{L}}$$", "id": "3417655"}, {"introduction": "最后，我们应对在现代超级计算机上求解大规模三维问题的挑战。当从单处理器转向并行计算环境时，算法的性能不仅取决于其计算复杂度，更关键地取决于数据如何在众多处理器之间分布和通信。本练习[@problem_id:3417642]将要求你评估几种不同的区域分解策略（例如块状、板状和笔状分解）对LOD方法并行效率的影响，通过分析计算与通信之间的权衡，你将学会如何设计能够有效利用大规模并行资源的数值方案。", "problem": "考虑一个三维热方程 $u_t = \\kappa \\left(u_{xx} + u_{yy} + u_{zz}\\right)$，它定义在一个均匀的笛卡尔网格上，网格大小为 $N_x = N_y = N_z = 512$。该方程在空间上通过二阶中心差分进行离散，在时间上通过局域一维 (LOD) 分裂格式进行推进。在每个时间步中，LOD 方法执行三个隐式一维子步骤（每个空间方向一个），每个子步骤都简化为沿着与相应坐标轴平行的直线求解独立的三对角系统。假设每个三对角系统都通过 Thomas 算法求解，每次扫描中每个未知数的计算时间为 $t_c = 8\\,\\mathrm{ns}$。您有 $P = 512$ 个处理器可用。\n\n假设采用以下并行性能模型：\n- 对于给定的扫描，如果所有三对角系统都位于每个处理器本地（无跨处理器耦合），则每次扫描的总计算时间与每个处理器的未知数总数成正比，并且仅在扫描之间重新分布数据布局时才需要通信。数据重分布（全局转置）的每个未知数通信时间为 $t_m = 4\\,\\mathrm{ns}$，并且需要移动整个全局数据集。\n- 如果一次扫描需要求解跨越多个处理器的三对角系统（分布式行求解），则沿这些行的处理器间通信导致的每个未知数的有效时间为 $t_{\\ell} = 20\\,\\mathrm{ns}$，且不能与计算重叠。\n- 忽略延迟、启动成本和缓存效应。假设负载完美均衡，并且所有处理器都平等参与。\n\n您的任务是估算并行效率，并确定一种能够最大化独立一维求解并发性的区域分解策略。并行效率定义为 $E = T_1/(P\\,T_P)$，在上述完美负载均衡的模型下，这可以简化为 $E \\approx T_{\\mathrm{comp}}/(T_{\\mathrm{comp}} + T_{\\mathrm{comm}})$，其中 $T_{\\mathrm{comp}}$ 是所有三次 LOD 扫描的总计算时间，$T_{\\mathrm{comm}}$ 是该时间步中产生的总通信时间。\n\n在所述模型下，哪个选项最准确？\n\nA. 使用静态三维块（砖块）分解，将区域分解为 $512$ 个相等的子域。三次扫描中的每一次都需要跨越块边界进行分布式三对角求解，从而在所有三个方向上都产生通信。效率为 $E \\approx \\dfrac{3\\,t_c}{3\\,t_c + 3\\,t_{\\ell}}$，得出 $E \\approx \\dfrac{24}{24 + 60} \\approx 0.286$。由于每个一维线都被分割到不同的块中，并发性受到限制。\n\nB. 使用静态 z-slab（板层）分解，将区域分解为 $512$ 个板层，因此每个处理器拥有完整的 $x$-$y$ 平面，但只拥有 $z$ 轴上的一部分层级。$x$ 和 $y$ 方向的扫描是纯本地的，而 $z$ 方向的扫描需要沿 $z$ 轴进行分布式三对角求解。效率为 $E \\approx \\dfrac{3\\,t_c}{3\\,t_c + t_{\\ell}}$，得出 $E \\approx \\dfrac{24}{24 + 20} \\approx 0.750$。在两次扫描中并发性最大化，在 $z$ 扫描中并发性降低。\n\nC. 使用旋转二维 pencil（束）分解：存储与当前扫描方向对齐的 pencil，并在每个时间步执行两次全局转置，以便为后续扫描重新对齐 pencil。每次扫描中的所有三对角求解都是本地的，通信开销仅为两次转置。效率为 $E \\approx \\dfrac{3\\,t_c}{3\\,t_c + 2\\,t_m}$，得出 $E \\approx \\dfrac{24}{24 + 8} = 0.750$。由于活动方向上的所有一维线都是独立且本地的，因此在所有三次扫描中并发性都达到最大化。\n\nD. 使用方向循环方案，在每个时间步中执行三次全局转置（每次扫描前），以使所有扫描都是本地的。效率为 $E \\approx \\dfrac{3\\,t_c}{3\\,t_c + 3\\,t_m}$，得出 $E \\approx \\dfrac{24}{24 + 12} \\approx 0.667$。在所有扫描中并发性都达到最大化，但与两次转置相比，额外的转置降低了效率。\n\n选择一个选项，该选项正确估算了并行效率，并提出了在此模型下能为 LOD 方法最大化跨线或跨平面独立一维求解并发性的区域分解策略。", "solution": "问题陈述是分析求解偏微分方程并行算法方面的一个形式规范的练习。所描述的参数、模型和方法是科学计算领域的标准。该问题具有科学依据、自成体系且客观。因此，该问题是有效的。\n\n问题的核心是评估应用于三维热方程 $u_t = \\kappa (\\nabla^2 u)$ 的局域一维 (LOD) 时间步进格式的不同并行区域分解策略。网格维度为 $N_x = N_y = N_z = 512$，我们有 $P = 512$ 个处理器。总网格点数为 $N_{total} = 512^3$，因此在完美负载均衡的假设下，每个处理器负责 $N_{proc} = N_{total}/P = 512^2$ 个网格点。\n\nLOD 方法每个时间步涉及三次顺序扫描，每个空间维度（$x, y, z$）一次。在每次扫描中，会求解一组一维问题（三对角系统）。并行实现的效率关键取决于这些三对角系统是处理器本地的，还是分布在多个处理器上。\n\n问题提供了一个简化的性能模型，其中包含计算和通信的每个未知数的时间成本：\n-   每次扫描每个未知数的计算时间：$t_c = 8\\,\\mathrm{ns}$。\n-   全局转置每个未知数的通信时间：$t_m = 4\\,\\mathrm{ns}$。\n-   分布式行求解每个未知数的通信时间：$t_{\\ell} = 20\\,\\mathrm{ns}$。\n\n一个完整时间步（三次扫描）中每个未知数的总计算时间为 $T_{\\mathrm{comp}} = 3\\,t_c = 3 \\times 8\\,\\mathrm{ns} = 24\\,\\mathrm{ns}$。并行效率估计为 $E \\approx T_{\\mathrm{comp}} / (T_{\\mathrm{comp}} + T_{\\mathrm{comm}})$，其中 $T_{\\mathrm{comm}}$ 是每个时间步中每个未知数的总通信时间，这取决于分解策略。最大化独立一维求解的并发性意味着选择一种分解方式，使得三对角系统尽可能不分布在多个处理器上。\n\n让我们评估每个选项：\n\n**A. 使用静态三维块（砖块）分解...**\n-   **分解：** 将 $512 \\times 512 \\times 512$ 的区域划分为 $P=512$ 个块。一个逻辑上的处理器布局可以是 $P_x \\times P_y \\times P_z = 8 \\times 8 \\times 8 = 512$。每个处理器持有一个 $64 \\times 64 \\times 64$ 的子网格。\n-   **分析：** 在 $x$-扫描中，三对角系统沿 $x$ 轴。由于区域在 $x$ 方向上被划分（$P_x=8$），每条 $x$ 线都被分割到 $8$ 个处理器上。这需要分布式行求解。同样，$y$-扫描和 $z$-扫描也需要分布式行求解。\n-   **并发性：** Thomas 算法沿一条线是顺序执行的。当线被分布时，处理器必须通信来求解它们，这严重限制了独立求解的并发性。此策略不能最大化并发性。\n-   **通信与效率：** 三次扫描中的每一次都会产生分布式行求解的通信成本 $t_{\\ell}$。\n    $$T_{\\mathrm{comm}} = t_{\\ell} + t_{\\ell} + t_{\\ell} = 3\\,t_{\\ell} = 3 \\times 20\\,\\mathrm{ns} = 60\\,\\mathrm{ns}$$\n    效率为：\n    $$E \\approx \\frac{3\\,t_c}{3\\,t_c + 3\\,t_{\\ell}} = \\frac{24}{24 + 60} = \\frac{24}{84} \\approx 0.2857$$\n-   **结论：** **不正确**。计算是正确的，但声称此策略能最大化并发性的说法是错误的；对于这类算法，它反而使并发性最小化。\n\n**B. 使用静态 $z$-slab 分解...**\n-   **分解：** 区域沿 $z$ 轴被划分为 $P=512$ 个板层。每个处理器持有一个单一 $z$ 索引对应的完整的 $512 \\times 512$ 数据平面。处理器网格为 $P_x \\times P_y \\times P_z = 1 \\times 1 \\times 512$。\n-   **分析：** 在 $x$-扫描中，三对角系统沿 $x$ 轴。由于区域在 $x$ 方向上未被划分（$P_x=1$），每条 $x$ 线都完全包含在一个处理器的板层内。求解是本地的。同样，在 $y$-扫描中，求解也是本地的。在 $z$-扫描中，三对角系统沿 $z$ 轴。由于区域在 $z$ 方向上被划分为 $512$ 个板层（$P_z=512$），每条 $z$ 线都分布在所有 $512$ 个处理器上。这需要分布式行求解。\n-   **并发性：** 对于 $x$ 和 $y$ 扫描，并发性很高（每个处理器有许多独立的线），但对于 $z$ 扫描则很低。此策略不能在所有三次扫描中都最大化并发性。\n-   **通信与效率：** 通信成本仅在 $z$-扫描中产生。\n    $$T_{\\mathrm{comm}} = t_{\\ell} = 20\\,\\mathrm{ns}$$\n    效率为：\n    $$E \\approx \\frac{3\\,t_c}{3\\,t_c + t_{\\ell}} = \\frac{24}{24 + 20} = \\frac{24}{44} \\approx 0.545$$\n-   **结论：** **不正确**。该选项声称最终效率约为 $0.750$，这是一个严重的计算错误（$24/44 \\neq 0.75$）。此外，该策略并未在所有扫描中最大化并发性。\n\n**C. 使用旋转二维 pencil 分解... 每个时间步两次全局转置...**\n-   **分解：** 这种动态策略会重新对齐数据布局以匹配扫描方向。\n    1.  **$x$-扫描：** 数据排列成 $x$-pencil（在 $y$-$z$ 平面内划分）。所有 $x$ 线都是本地的。扫描期间无通信。\n    2.  **转置 1：** 一次全局数据转置（从 $y$-$z$ 平面到 $x$-$z$ 平面）将数据重新排列为 $y$-pencil。成本：$t_m$。\n    3.  **$y$-扫描：** 现在所有 $y$ 线都是本地的。扫描期间无通信。\n    4.  **转置 2：** 另一次转置（从 $x$-$z$ 平面到 $x$-$y$ 平面）将数据重新排列为 $z$-pencil。成本：$t_m$。\n    5.  **$z$-扫描：** 现在所有 $z$ 线都是本地的。扫描期间无通信。\n-   **并发性：** 该策略确保对于每次扫描，相应的一维系统都完全位于处理器本地。这使得所有处理器可以并行求解各自独立的成组三对角系统，从而最大化了独立求解的并发性。\n-   **通信与效率：** 通信开销包括两次转置。\n    $$T_{\\mathrm{comm}} = t_m + t_m = 2\\,t_m = 2 \\times 4\\,\\mathrm{ns} = 8\\,\\mathrm{ns}$$\n    效率为：\n    $$E \\approx \\frac{3\\,t_c}{3\\,t_c + 2\\,t_m} = \\frac{24}{24 + 8} = \\frac{24}{32} = 0.750$$\n    这个方案是可行的，例如，通过在连续的时间步中交替扫描的顺序，平均每个时间步产生两次转置。\n-   **结论：** **正确**。该选项正确地指出了最大化并发性的策略（pencil 分解）。它描述了一个使用两次转置的有效、高性能的实现，并且基于选项中陈述的前提，其效率计算在算术和概念上都是正确的。\n\n**D. 使用方向循环方案，在每个时间步中执行三次全局转置...**\n-   **分解：** 这也是一种旋转 pencil 分解，但它在每个时间步结束时执行第三次转置，以将数据恢复到其原始布局（例如，$x$-pencil）。顺序为：$x$-求解（本地） $\\rightarrow$ 转置 $\\rightarrow$ $y$-求解（本地） $\\rightarrow$ 转置 $\\rightarrow$ $z$-求解（本地） $\\rightarrow$ 转置。\n-   **并发性：** 与选项 C 类似，此策略最大化了独立求解的并发性，因为每次扫描中的所有行求解都是本地的。\n-   **通信与效率：** 通信成本为三次转置。\n    $$T_{\\mathrm{comm}} = t_m + t_m + t_m = 3\\,t_m = 3 \\times 4\\,\\mathrm{ns} = 12\\,\\mathrm{ns}$$\n    效率为：\n    $$E \\approx \\frac{3\\,t_c}{3\\,t_c + 3\\,t_m} = \\frac{24}{24 + 12} = \\frac{24}{36} = \\frac{2}{3} \\approx 0.667$$\n-   **结论：** **不正确**。尽管这描述了一种有效且广泛使用的高并发策略，并且计算正确，但选项 C 中的策略以更高的效率（$E=0.750  E\\approx0.667$）实现了相同的最大并发性。因此，在寻找最佳策略的问题上，选项 C 代表了一个更优且更准确的答案。问题要求选择最准确的单个选项，而 C 描述了一种更优越的方法。\n\n**结论：**\n选项 A 和 B 失败，因为它们没有最大化并发性。选项 B 还包含一个数值错误。选项 C 和 D 都描述了最大化并发性的策略。然而，C 中的双转置方案比 D 中的三转置方案更高效。由于双转置方案是一种有效且更优的实现，选项 C 是该问题的最准确和最佳答案。", "answer": "C", "id": "3417642"}]}