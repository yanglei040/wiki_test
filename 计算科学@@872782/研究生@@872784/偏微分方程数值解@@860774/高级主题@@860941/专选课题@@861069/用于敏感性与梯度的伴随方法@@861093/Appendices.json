{"hands_on_practices": [{"introduction": "理论的掌握始于“纸和笔”的推导。本练习将指导您通过拉格朗日乘子法，为时间依赖的（抛物型）偏微分方程约束优化问题推导其连续伴随方程和梯度表达式。这是理解伴随方法核心思想的基石，它将清晰地揭示伴随系统为何是“时间反向”的，以及其终端条件和边界条件是如何从正向问题中自然产生的。[@problem_id:3361153]", "problem": "考虑一个有界 Lipschitz 区域 $\\Omega \\subset \\mathbb{R}^{d}$，其边界为 $\\partial \\Omega$，并设一个固定的终止时间 $T>0$。令 $\\kappa(x)$ 为一个标量扩散系数，满足 $\\kappa \\in C^{1}(\\overline{\\Omega})$ 和 $0  \\kappa_{\\min} \\le \\kappa(x) \\le \\kappa_{\\max}  \\infty$。对于给定的源项 $s \\in L^{2}(\\Omega \\times (0,T))$，状态 $u:\\Omega \\times [0,T]\\to \\mathbb{R}$ 定义为以下抛物型初边值问题的唯一弱解：\n$$\n\\begin{cases}\nu_{t}(x,t)-\\nabla \\cdot \\big(\\kappa(x)\\nabla u(x,t)\\big)=s(x,t),  (x,t)\\in \\Omega \\times (0,T),\\\\\nu(x,t)=0,  (x,t)\\in \\partial \\Omega \\times (0,T),\\\\\nu(x,0)=u_{0}(x),  x\\in \\Omega,\n\\end{cases}\n$$\n其中 $u_{0}\\in L^{2}(\\Omega)$ 是固定的。令 $d \\in L^{2}(\\Omega \\times (0,T))$ 为给定的时空数据，并定义如下的追踪型目标泛函：\n$$\nJ(u)=\\frac{1}{2}\\int_{0}^{T}\\!\\!\\int_{\\Omega} \\big(u(x,t)-d(x,t)\\big)^{2}\\,dx\\,dt.\n$$\n将状态方程视为连接 $u$ 和 $s$ 的约束条件，并通过状态 $u(s)$ 将 $J$ 视为 $s$ 的泛函。仅使用基础工具（Banach 空间中 Gâteaux 导数的链式法则、约束优化的 Lagrange 乘子法，以及与给定边界和初始数据相符的时空分部积分法），推导 $J$ 关于源项 $s(x,t)$ 的 $L^{2}(\\Omega\\times(0,T))$-梯度的显式解析表达式。你的最终答案必须是一个单一的闭式解析表达式，用良定偏微分方程定义的量来表示。不要引入任何正则化。请将最终答案表示为单一的解析表达式，且不包含单位。", "solution": "所述问题是有效的。这是一个在偏微分方程最优控制领域中科学基础扎实、良定的问题。所有必需的数据、函数和条件均已提供，并且它们是相互一致的。因此，我们可以着手推导解答。\n\n目标是求目标泛函 $J$ 关于源项 $s$ 的 $L^{2}(\\Omega\\times(0,T))$-梯度。状态变量 $u$ 通过状态方程与控制变量 $s$相联系，该方程作为一个约束条件。我们采用 Lagrange 乘子法来处理此约束。\n\n设状态空间为 $u$ 的一个适当函数空间，控制空间为 $s$ 的 $L^{2}(\\Omega\\times(0,T))$，约束的对偶空间为 Lagrange 乘子 $p$（通常称为伴随状态）所在的空间。Lagrange 泛函 $\\mathcal{L}(u,s,p)$ 定义为：\n$$\n\\mathcal{L}(u,s,p) = J(u) - \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\left(u_{t} - \\nabla \\cdot (\\kappa \\nabla u) - s\\right) p \\,dx\\,dt\n$$\n由于状态 $u$ 由 $s$ 唯一确定（对于固定的 $u_0$），我们可以将 $J$ 视为仅关于 $s$ 的泛函，即 $j(s) = J(u(s))$。对于 $p$ 的任何选择，如果 $u(s)$ 滿足状态方程，则 Lagrange 泛函中的积分项为零，因此 $j(s) = \\mathcal{L}(u(s), s, p)$。\n\n我们希望计算 $j(s)$ 在任意方向 $\\delta s \\in L^{2}(\\Omega\\times(0,T))$ 上的 Gâteaux 导数。设 $u(s)$ 是对应于 $s$ 的解，$\\delta u$ 是解映射 $u(s)$ 在方向 $\\delta s$ 上的 Gâteaux 导数。对 $\\mathcal{L}(u(s), s, p)$ 应用链式法则，我们得到：\n$$\nDj(s)[\\delta s] = \\frac{\\partial \\mathcal{L}}{\\partial u}(u,s,p)[\\delta u] + \\frac{\\partial \\mathcal{L}}{\\partial s}(u,s,p)[\\delta s]\n$$\n伴随法的核心是选择伴随状态 $p$，使得依赖于未知灵敏度 $\\delta u$ 的第一项消失。这个选择将定义伴随方程。我们来计算 $\\mathcal{L}$ 关于 $u$ 在方向 $\\delta u$ 上的偏 Gâteaux 导数：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial u}[\\delta u] = \\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} \\mathcal{L}(u+\\epsilon\\delta u, s, p) = \\int_{0}^{T}\\!\\!\\int_{\\Omega} (u-d)\\delta u \\,dx\\,dt - \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\left(\\delta u_{t} - \\nabla \\cdot (\\kappa \\nabla \\delta u)\\right) p \\,dx\\,dt\n$$\n为了消去 $\\delta u$，我们对第二项使用分部积分，将导数转移到 $p$ 上。\n首先，我们对时间导数项关于时间 $t$ 进行分部积分：\n$$\n-\\int_{0}^{T}\\!\\!\\int_{\\Omega} \\delta u_{t} p \\,dx\\,dt = -\\int_{\\Omega} \\left( [\\delta u(x,t) p(x,t)]_{t=0}^{t=T} - \\int_{0}^{T} \\delta u(x,t) p_{t}(x,t) \\,dt \\right) dx\n$$\n$$\n= -\\int_{\\Omega} \\delta u(x,T) p(x,T) \\,dx + \\int_{\\Omega} \\delta u(x,0) p(x,0) \\,dx + \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\delta u p_{t} \\,dx\\,dt\n$$\n变分 $\\delta u$ 对应于源项中的变分 $\\delta s$，而初始条件 $u_0$ 是固定的。因此，$\\delta u$ 的初始条件为 $\\delta u(x,0)=0$。所以 $\\int_{\\Omega} \\delta u(x,0) p(x,0) \\,dx$ 项消失。\n\n接下来，我们对扩散项关于空间变量进行分部积分。使用 Green 第一恒等式 $\\int_{\\Omega} (\\nabla\\cdot\\mathbf{F})\\psi \\,dx = \\int_{\\partial\\Omega} (\\mathbf{F}\\cdot\\mathbf{n})\\psi \\,dS - \\int_{\\Omega} \\mathbf{F}\\cdot\\nabla\\psi \\,dx$，令 $\\mathbf{F} = \\kappa\\nabla\\delta u$ 和 $\\psi=p$，我们得到：\n$$\n\\int_{\\Omega} (\\nabla \\cdot (\\kappa \\nabla \\delta u)) p \\,dx = \\int_{\\partial \\Omega} p (\\kappa \\nabla \\delta u \\cdot \\mathbf{n}) \\,dS - \\int_{\\Omega} \\kappa \\nabla \\delta u \\cdot \\nabla p \\,dx\n$$\n为了使边界积分对任意 $\\delta u$ 都为零，我们对伴随状态施加齐次 Dirichlet 边界条件，$p(x,t)=0$ 对 $(x,t) \\in \\partial\\Omega \\times (0,T)$ 成立。然后，再次应用分部积分：\n$$\n- \\int_{\\Omega} \\kappa \\nabla \\delta u \\cdot \\nabla p \\,dx = \\int_{\\Omega} \\delta u (\\nabla \\cdot (\\kappa \\nabla p)) \\,dx - \\int_{\\partial\\Omega} \\delta u (\\kappa \\nabla p \\cdot \\mathbf{n}) \\,dS\n$$\n状态 $u$ 在 $\\partial\\Omega \\times(0,T)$上满足 $u=0$，所以其变分 $\\delta u$ 在边界上也必须为零。因此，第二个边界积分也消失。结合这些结果得到：\n$$\n\\int_{0}^{T}\\!\\!\\int_{\\Omega} (\\nabla \\cdot (\\kappa \\nabla \\delta u)) p \\,dx\\,dt = \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\delta u (\\nabla \\cdot (\\kappa \\nabla p)) \\,dx\\,dt\n$$\n将这些结果代回到 $\\frac{\\partial \\mathcal{L}}{\\partial u}[\\delta u]$ 的表达式中：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial u}[\\delta u] = \\int_{0}^{T}\\!\\!\\int_{\\Omega} (u-d)\\delta u \\,dx\\,dt - \\left( \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\delta u p_{t} \\,dx\\,dt - \\int_{\\Omega} \\delta u(x,T) p(x,T) \\,dx + \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\delta u (\\nabla \\cdot (\\kappa\\nabla p)) \\,dx\\,dt \\right)\n$$\n重新组合含有 $\\delta u$ 的项：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial u}[\\delta u] = -\\int_{0}^{T}\\!\\!\\int_{\\Omega} \\left( -p_{t} - \\nabla \\cdot (\\kappa \\nabla p) - (u-d) \\right) \\delta u \\,dx\\,dt + \\int_{\\Omega} \\delta u(x,T) p(x,T) \\,dx\n$$\n为了使该表达式对于任何容许的变分 $\\delta u$ 都为零，乘以 $\\delta u$ 的被积函数必须为零。这就得到了 $p$ 的伴随方程：\n$$\n\\begin{cases}\n-p_{t}(x,t)-\\nabla \\cdot \\big(\\kappa(x)\\nabla p(x,t)\\big) = u(x,t)-d(x,t),  (x,t)\\in \\Omega \\times (0,T)\\\\\np(x,t)=0,  (x,t)\\in \\partial \\Omega \\times (0,T)\\\\\np(x,T)=0,  x\\in \\Omega\n\\end{cases}\n$$\n这是一个良定的向后时间的线性抛物型方程。通过如此选择 $p$，我们有 $\\frac{\\partial \\mathcal{L}}{\\partial u}[\\delta u] = 0$。\n\n现在 $j(s)$ 的 Gâteaux 导数简化为：\n$$\nDj(s)[\\delta s] = \\frac{\\partial \\mathcal{L}}{\\partial s}(u,s,p)[\\delta s] = \\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} \\mathcal{L}(u, s+\\epsilon\\delta s, p)\n$$\n$$\n= \\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} \\left( J(u) - \\int_{0}^{T}\\!\\!\\int_{\\Omega} \\left(u_{t} - \\nabla \\cdot (\\kappa \\nabla u) - (s+\\epsilon\\delta s)\\right) p \\,dx\\,dt \\right)\n$$\n$$\n= - \\int_{0}^{T}\\!\\!\\int_{\\Omega} (-\\delta s) p \\,dx\\,dt = \\int_{0}^{T}\\!\\!\\int_{\\Omega} p \\cdot \\delta s \\,dx\\,dt\n$$\n$L^{2}(\\Omega\\times(0,T))$-梯度，我们记为 $\\nabla_s J(s)$，通过内积由 Riesz 表示定理定义：\n$$\nDj(s)[\\delta s] = \\langle \\nabla_s J(s), \\delta s \\rangle_{L^{2}(\\Omega\\times(0,T))} = \\int_{0}^{T}\\!\\!\\int_{\\Omega} (\\nabla_s J(s)) \\delta s \\,dx\\,dt\n$$\n将此式与我们推导出的 $Dj(s)[\\delta s]$ 表达式进行比较，我们确定梯度即为伴随状态 $p(x,t)$。\n$$\n\\nabla_s J(s) = p(x,t)\n$$\n其中 $u(x,t)$ 是正问题的解，$p(x,t)$ 是上面定义的伴随问题的解。", "answer": "$$\n\\boxed{p(x,t)}\n$$", "id": "3361153"}, {"introduction": "在将连续理论应用于实际计算时，我们必须面对离散化带来的挑战。此练习旨在搭建从连续到离散的桥梁，通过一个经典的线性平流方程，让您亲手推导离散伴随算子。您将发现，正向问题中迎风格式的选择如何通过离散分部求和（summation by parts）直接决定了伴随算子（一个下风格式）的结构，并深刻理解伴随问题中流入/流出边界角色互换的根本原因。[@problem_id:3361154]", "problem": "考虑在空间区间 $[0,1]$ 和时间 $t \\in [0,T]$ 上的线性平流偏微分方程 (PDE) $u_{t} + a\\,u_{x} = 0$，其中平流速度 $a0$ 为常数。正问题设定了入流狄利克雷边界条件 $u(0,t) = g(t)$ 和初始条件 $u(x,0) = u_{0}(x)$。使用均匀网格 $x_{i} = i h$（其中 $h = 1/N$，索引 $i = 0,1,\\dots,N$）对空间进行离散化，并针对内部自由度 $i=1,\\dots,N$ 定义半离散线方法系统，采用适用于 $a0$ 的一阶迎风空间差分格式：\n$$\n\\frac{d u_{i}}{dt} + \\frac{a}{h}\\left(u_{i} - u_{i-1}\\right) = 0,\\quad i=1,\\dots,N,\n$$\n其中 $u_{0}(t)$ 由入流边界数据 $g(t)$ 提供。\n\n设离散内积为内部自由度上的集中质量 $L^{2}$ 内积 $\\langle p,u\\rangle = h \\sum_{i=1}^{N} p_{i}\\,u_{i}$。通过关系式 $\\langle p, A u\\rangle = \\langle A^{\\ast} p, u\\rangle$ (对所有内部向量 $p$ 和 $u$ 成立) 定义空间算子 $A$ 的离散伴随算子 $A^{\\ast}$。假设目标泛函为 $J(u) = h \\sum_{i=1}^{N} q_{i}\\,u_{i}(T)$，其中 $q$ 是给定的终端权重向量，并考虑由以下方程控制的、时间上向后演化的离散伴随状态 $p(t)$：\n$$\n\\frac{d p}{dt} - A^{\\ast} p = 0,\\quad t \\in [0,T],\n$$\n其终端条件为 $p(T) = q$，并附带一个待定的适当的伴随边界条件。\n\n从离散伴随的定义、给定的内积以及所述的正向迎风格式出发，推导伴随空间算子 $A^{\\ast}$ 的显式内部格式，即 $(A^{\\ast} p)_{j}$ 对于 $j=1,\\dots,N-1$ 的公式。此外，基于第一性原理和离散分部求和恒等式，解释对于 $a0$ 的情况，伴随边界条件如何在出流边界上施加，以及为什么相对于正问题，入流/出流的角色会发生逆转。\n\n你的最终答案必须是内部伴随格式 $(A^{\\ast} p)_{j}$（对于 $1 \\le j \\le N-1$）的单一闭式解析表达式。无需进行数值近似。", "solution": "解答需要从给定的离散正向算子 $A$ 和指定的内积推导出离散伴随算子 $A^{\\ast}$。定义伴随的关系是 $\\langle p, A u \\rangle = \\langle A^{\\ast} p, u \\rangle$ 对所有代表内部自由度的向量 $p$ 和 $u$ 成立。\n\n首先，我们确定空间算子 $A$ 对内部向量 $u = (u_1, u_2, \\dots, u_N)^T$ 的作用。半离散系统由 $\\frac{d u_i}{dt} + (Au)_i = 0$ 给出，其中涉及 $u_0$ 的边界项被视为一个源项。为了定义线性算子 $A$，我们考虑具有齐次边界条件（即 $u_0=0$）的系统。非齐次情况可以通过将 $u_0$ 项移到ODE系统的右侧来处理。\n\n当 $u_0=0$ 时，应用于内部向量 $u$ 的正向算子 $A$ 的分量为：\n$$\n(A u)_i = \\frac{a}{h} (u_i - u_{i-1}) \\quad \\text{对于 } i=2, \\dots, N\n$$\n$$\n(A u)_1 = \\frac{a}{h} (u_1 - u_0) = \\frac{a}{h} u_1\n$$\n\n内积为 $\\langle p, u \\rangle = h \\sum_{i=1}^{N} p_i u_i$。我们从伴随定义的左侧 $\\langle p, A u \\rangle$ 开始。\n\n$$\n\\langle p, A u \\rangle = h \\sum_{i=1}^{N} p_i (A u)_i = h \\left[ p_1 (A u)_1 + \\sum_{i=2}^{N} p_i (A u)_i \\right]\n$$\n代入 $A u$ 的分量：\n$$\n\\langle p, A u \\rangle = h \\left[ p_1 \\left(\\frac{a}{h} u_1\\right) + \\sum_{i=2}^{N} p_i \\left(\\frac{a}{h} (u_i - u_{i-1})\\right) \\right] = a \\left[ p_1 u_1 + \\sum_{i=2}^{N} p_i u_i - \\sum_{i=2}^{N} p_i u_{i-1} \\right]\n$$\n为了将其重排成 $\\langle A^{\\ast} p, u \\rangle$ 的形式，我们需要按 $u$ 的分量对项进行分组。我们通过对最后一项求和重新索引来进行离散分部求和。令 $j=i-1$，则 $i=j+1$。求和变为 $\\sum_{j=1}^{N-1} p_{j+1} u_j$。\n$$\n\\langle p, A u \\rangle = a \\left[ p_1 u_1 + \\sum_{i=2}^{N} p_i u_i - \\sum_{j=1}^{N-1} p_{j+1} u_j \\right]\n$$\n现在，我们收集每个 $u_j$ 的系数：\n对于 $j=1$：$a(p_1 - p_2)u_1$\n对于 $j=2, \\dots, N-1$：$a(p_j - p_{j+1})u_j$\n对于 $j=N$：$a p_N u_N$\n\n所以表达式变为：\n$$\n\\langle p, A u \\rangle = a(p_1 - p_2) u_1 + \\sum_{j=2}^{N-1} a(p_j - p_{j+1}) u_j + a p_N u_N = \\sum_{j=1}^{N-1} a(p_j-p_{j+1})u_j + a p_N u_N\n$$\n我们必须将其等同于 $\\langle A^{\\ast} p, u \\rangle = h \\sum_{j=1}^{N} (A^{\\ast} p)_j u_j = \\sum_{j=1}^{N} h (A^{\\ast} p)_j u_j$。\n通过比较 $j=1, \\dots, N$ 时每个 $u_j$ 的系数，我们可以确定 $A^{\\ast}p$ 的分量：\n对于 $j = 1, \\dots, N-1$：\n$$\nh (A^{\\ast} p)_j = a(p_j - p_{j+1}) \\implies (A^{\\ast} p)_j = \\frac{a}{h}(p_j - p_{j+1})\n$$\n这就是所要求的伴随算子**内部格式**的显式公式。\n\n为了完整起见，在边界点 $j=N$ 处：\n$$\nh (A^{\\ast} p)_N = a p_N \\implies (A^{\\ast} p)_N = \\frac{a}{h} p_N\n$$\n\n现在是任务的解释部分。\n\n正向空间算子 $A$ 使用一阶迎风格式，$(Au)_i = \\frac{a}{h}(u_i - u_{i-1})$，它使用后向差分来近似 $a u_x$。对于 $a0$，信息沿 $x$ 增加的方向传播。迎风格式通过从“迎风”侧（较小的 $x$）获取信息来正确地模拟这一点。因此，边界 $x=0$ 是一个必须指定条件的入流边界，而 $x=1$ 是一个出流边界，在这里不需要条件，因为解由内部动力学决定。\n\n推导出的内部伴随算子格式 $(A^{\\ast} p)_j = \\frac{a}{h}(p_j - p_{j+1})$ 是一个缩放的负前向差分，近似于 $-a \\frac{\\partial p}{\\partial x}$。伴随PDE是 $\\frac{dp}{dt} = A^*p$，约等于 $p_t = -a p_x$。该伴随方程的特征线由 $\\frac{dx}{dt} = -a$ 给出。这意味着对于伴随问题，信息沿 $x$ 减小的方向传播。特征方向的这种逆转是正问题和伴随问题之间入流和出流边界角色互换的根本原因。正向入流（$x=0$）是伴随的出流，正向出流（$x=1$）是伴随的入流。\n\n在正向出流边界（$x=1$，对应于索引 $j=N$）上的伴随边界条件问题可以通过检查格式来理解。内部伴随格式 $(A^{\\ast}p)_j = \\frac{a}{h}(p_j - p_{j+1})$ 使用来自点 $j+1$ 的信息来更新点 $j$。这是一个下风格式。如果我们在边界点 $j=N$ 应用这个通用格式，我们会得到 $(A^{\\ast} p)_N = \\frac{a}{h}(p_N - p_{N+1})$，这将需要域外“幽灵点”处 $p_{N+1}$ 的值。然而，我们通过分部求和的严格推导得到了一个特定的边界格式，$(A^{\\ast} p)_N = \\frac{a}{h} p_N$。比较这两种形式：\n$$\n\\frac{a}{h} p_N = \\frac{a}{h}(p_N - p_{N+1})\n$$\n当且仅当 $p_{N+1}(t) = 0$ 时，此等式成立。因此，直接从有限域上的分部求和恒等式推导出的离散伴随公式，在数学上等价于在直至边界的任何地方都使用内部下风格式，并在幽灵点上施加一个齐次狄利克雷边界条件 $p_{N+1}=0$。这是在正问题的出流边界上伴随边界条件的离散实现。", "answer": "$$\n\\boxed{\\frac{a}{h}(p_{j} - p_{j+1})}\n$$", "id": "3361154"}, {"introduction": "最终，我们需要将理论和推导转化为可靠的计算机代码。本练习是一个综合性的实践，要求您为一个非线性问题实现从状态求解、伴随求解到梯度计算的完整流程。更重要的是，它引入了梯度验证的“黄金标准”——泰勒余项测试（Taylor test）。通过这项验证，您可以确保自己实现的复杂梯度代码是正确的，这是在实际研究和工程应用中建立对优化算法信心的关键一步。[@problem_id:3361125]", "problem": "考虑一个在空间区间 $(0,1)$ 上的偏微分方程（PDE）约束优化问题，其中状态变量为 $u(x)$，分布式控制 $m(x)$ 作为源项。控制非线性PDE为\n$$\n- \\frac{d^2 u}{dx^2} + \\beta\\, u(x)^3 = m(x), \\quad x \\in (0,1),\n$$\n服从齐次Dirichlet边界条件\n$$\nu(0) = 0, \\quad u(1) = 0.\n$$\n设期望状态为 $u_d(x)$，并考虑目标泛函\n$$\nJ(u,m) = \\frac{1}{2} \\int_0^1 \\big(u(x) - u_d(x)\\big)^2 \\, dx + \\frac{\\gamma}{2} \\int_0^1 m(x)^2 \\, dx.\n$$\n从变分法和PDE约束优化的拉格朗日框架出发，通过引入伴随变量 $\\lambda(x)$ 并要求拉格朗日量关于 $u$ 和 $m$ 的平稳性，推导必要的一阶最优性条件。从这些条件中，得到伴随PDE以及 $J$ 关于 $m$ 的梯度。\n\n在包含边界点 $x_0 = 0$ 和 $x_{N-1} = 1$ 的 $N$ 个点的均匀网格上对问题进行离散化，步长为 $h = 1/(N-1)$。在 $N-2$ 个内部节点上，对 $-d^2u/dx^2$ 使用二阶中心有限差分，并强制 $u_0=u_{N-1}=0$。所有积分均通过在内部节点上使用均匀权重 $h$ 的黎曼和进行近似。对于非线性PDE，实现一个带有回溯线搜索的牛顿法来求解内部节点上的离散状态 $u$。然后求解离散伴随方程以获得内部节点上的离散伴随变量。使用这些来构建关于 $m$ 的离散梯度。\n\n使用随机扰动和泰勒余项检验，实现伴随梯度的验证程序。具体来说，对于一个固定的基线控制 $m$ 和一个在离散 $L^2$ 内积中归一化的随机扰动方向 $\\delta m$，计算\n$$\nR(\\varepsilon) = J\\big(m + \\varepsilon \\delta m\\big) - J(m) - \\varepsilon \\langle \\nabla J(m), \\delta m \\rangle_h,\n$$\n其中 $\\langle a, b \\rangle_h = h \\sum_i a_i b_i$ 表示内部节点上的离散内积。通过计算证明，对于足够小的 $\\varepsilon$，$R(\\varepsilon)$ 与 $\\varepsilon$呈二次方缩放关系，即 $R(\\varepsilon) = \\mathcal{O}(\\varepsilon^2)$，这是通过对 $\\log R$ 与 $\\log \\varepsilon$ 进行线性拟合来估计斜率 $p$ 实现的。\n\n你的程序必须构建以下参数集的测试套件，并为每个测试报告从拟合中获得的估计阶数 $p$。在所有测试中，使用在内部节点上求值的 $u_d(x) = \\sin(\\pi x)$ 和基线控制 $m(x) = \\sin(2\\pi x) + 0.5 \\sin(\\pi x)$。通过抽取独立的标准正态分布项并归一化到单位离散 $L^2$ 范数来生成随机扰动 $\\delta m$；为保证可复现性，每个测试使用指定的随机种子。对于每个测试，使用同一组 $\\varepsilon$ 值\n$$\n\\varepsilon \\in \\left\\{10^{-1}, \\; 5 \\times 10^{-2}, \\; 2.5 \\times 10^{-2}, \\; 1.25 \\times 10^{-2} \\right\\}.\n$$\n\n测试套件：\n- 测试A (正常路径): $N = 128$, $\\beta = 1$, $\\gamma = 10^{-3}$, 随机种子 $s = 7$。\n- 测试B (边界情况: 线性状态方程): $N = 96$, $\\beta = 0$, $\\gamma = 10^{-2}$, 随机种子 $s = 13$。\n- 测试C (边缘情况: 更强的非线性且无正则化): $N = 160$, $\\beta = 5$, $\\gamma = 0$, 随机种子 $s = 21$。\n\n你的程序应生成单行输出，其中包含按顺序排列的测试A、B和C的估计阶数 $p$，四舍五入到三位小数，并以逗号分隔的列表形式包含在方括号中（例如，$[2.000,2.000,2.000]$）。不涉及物理单位。角度（如果有）必须以弧度为单位，但此问题不涉及角度。所有数值输出必须为浮点数。", "solution": "#### 1. 连续最优性条件\n我们通过用伴随变量（拉格朗日乘子）$\\lambda(x)$ 对PDE约束进行加权，来增广目标 $J$，从而引入拉格朗日泛函 $\\mathcal{L}(u, m, \\lambda)$：\n$$\n\\mathcal{L}(u, m, \\lambda) = J(u, m) + \\int_0^1 \\lambda(x) \\left( - \\frac{d^2 u}{dx^2} + \\beta u^3 - m \\right) dx.\n$$\n一阶必要最优性条件是通过要求 $\\mathcal{L}$ 关于 $u$、$m$ 和 $\\lambda$ 的Fréchet导数（弗雷歇导数）为零来找到的。\n\n- **关于 $\\lambda$ 的平稳性**：$\\frac{\\delta \\mathcal{L}}{\\delta \\lambda} = 0$ 恢复了状态方程：\n  $$ - \\frac{d^2 u}{dx^2} + \\beta u^3 = m, \\quad u(0)=u(1)=0. $$\n- **关于 $u$ 的平稳性**：$\\frac{\\delta \\mathcal{L}}{\\delta u} = 0$。在方向 $\\delta u$ 上对 $u$ 求导，并应用分部积分（使用 $\\delta u(0)=\\delta u(1)=0$），得到**伴随方程**。我们必须施加 $\\lambda(0)=\\lambda(1)=0$ 来消除边界项。\n  $$ - \\frac{d^2 \\lambda}{dx^2} + (3\\beta u^2) \\lambda = -(u - u_d), \\quad \\lambda(0)=\\lambda(1)=0. $$\n- **关于 $m$ 的平稳性**：$\\frac{\\delta \\mathcal{L}}{\\delta m} = 0$。约化泛函 $\\hat{J}(m) = J(u(m), m)$ 关于 $m$ 的导数定义了梯度。\n  $$ \\nabla_m J = \\gamma m - \\lambda. $$\n因此，最优性系统由状态方程、伴随方程和梯度表达式组成。\n\n#### 2. 离散化\n设网格由 $N$ 个点 $x_i = ih$（$i=0, \\dots, N-1$）组成，步长为 $h=1/(N-1)$。我们在 $N-2$ 个内部节点上求解变量。设 $\\mathbf{u}, \\mathbf{m}, \\boldsymbol{\\lambda} \\in \\mathbb{R}^{N-2}$ 为这些变量的向量。\n\n- **离散状态方程**：我们对 $-d^2/dx^2$ 使用二阶有限差分近似。设 $\\mathbf{A}$ 为表示此算子的 $(N-2) \\times (N-2)$ 矩阵：\n  $$ \\mathbf{A}_{ij} = \\frac{1}{h^2} \\begin{cases} 2   \\text{if } i=j \\\\ -1  \\text{if } |i-j|=1 \\\\ 0   \\text{otherwise} \\end{cases} $$\n  状态 $\\mathbf{u}$ 的离散非线性系统为：\n  $$ \\mathbf{R}(\\mathbf{u}, \\mathbf{m}) \\equiv \\mathbf{A}\\mathbf{u} + \\beta \\mathbf{u}^3 - \\mathbf{m} = \\mathbf{0}, $$\n  其中 $\\mathbf{u}^3$ 是逐元素的。\n\n- **离散伴随方程**：离散化连续伴随方程得到伴随向量 $\\boldsymbol{\\lambda}$ 的一个线性系统：\n  $$ \\left( \\mathbf{A} + 3\\beta \\, \\text{diag}(\\mathbf{u}^2) \\right) \\boldsymbol{\\lambda} = -(\\mathbf{u} - \\mathbf{u}_d). $$\n  左侧的矩阵是状态残差 $\\mathbf{R}$ 关于 $\\mathbf{u}$ 的雅可比矩阵的转置，即 $\\left( \\frac{\\partial \\mathbf{R}}{\\partial \\mathbf{u}} \\right)^T$。由于 $\\mathbf{A}$ 是对称的，且第二项是对角的，所以它就是雅可比矩阵本身，$\\mathbf{K}(\\mathbf{u}) = \\frac{\\partial \\mathbf{R}}{\\partial \\mathbf{u}} = \\mathbf{A} + 3\\beta \\, \\text{diag}(\\mathbf{u}^2)$。\n\n- **离散梯度**：离散梯度向量 $\\mathbf{g}$ 为：\n  $$ \\mathbf{g} = \\gamma \\mathbf{m} - \\boldsymbol{\\lambda}. $$\n\n#### 3. 数值求解器\n- **状态求解器（牛顿法）**：为了求解 $\\mathbf{R}(\\mathbf{u}) = \\mathbf{0}$，我们使用牛顿法。从一个初始猜测 $\\mathbf{u}_0$ 开始，我们迭代：\n  1. 求解线性系统以获得更新量 $\\delta \\mathbf{u}_k$：$\\mathbf{K}(\\mathbf{u}_k) \\delta \\mathbf{u}_k = -\\mathbf{R}(\\mathbf{u}_k)$。\n  2. 执行回溯线搜索以找到一个步长 $\\alpha_k \\in (0, 1]$，确保残差范数有足够下降。\n  3. 更新状态：$\\mathbf{u}_{k+1} = \\mathbf{u}_k + \\alpha_k \\delta \\mathbf{u}_k$。\n当残差或更新步长的范数低于一个容差时，迭代停止。\n\n- **伴随求解器**：这是一个线性系统求解问题：$\\mathbf{K}(\\mathbf{u})\\boldsymbol{\\lambda} = -(\\mathbf{u} - \\mathbf{u}_d)$。我们可以重用牛顿求解器中的雅可比矩阵结构。\n\n#### 4. 梯度验证\n约化泛函 $\\hat{J}(m)$ 的泰勒展开为：\n$$ \\hat{J}(m + \\varepsilon \\delta m) = \\hat{J}(m) + \\varepsilon \\langle \\nabla_m \\hat{J}(m), \\delta m \\rangle_h + \\mathcal{O}(\\varepsilon^2). $$\n余项 $R(\\varepsilon) = \\hat{J}(m + \\varepsilon \\delta m) - \\hat{J}(m) - \\varepsilon \\langle \\mathbf{g}, \\delta m \\rangle_h$ 预计为 $\\mathcal{O}(\\varepsilon^2)$。为验证这一点，我们为一系列递减的 $\\varepsilon$ 值计算 $R(\\varepsilon)$。$|R(\\varepsilon)|$ vs. $\\varepsilon$ 的对数-对数图应产生一条斜率 $p \\approx 2$ 的直线。我们使用对数变换后的数据的线性多项式拟合来估计这个斜率。\n\n每个测试用例的总体算法如下：\n1. 初始化参数（$N, \\beta, \\gamma, h$ 等）和基于网格的函数（$\\mathbf{m}, \\mathbf{u}_d$）。\n2. 给定基线控制 $\\mathbf{m}$，求解状态方程以得到基线状态 $\\mathbf{u}$。\n3. 计算基线目标值 $J_0$。\n4. 使用基线状态 $\\mathbf{u}$ 求解伴随方程以得到 $\\boldsymbol{\\lambda}$。\n5. 计算基线处的梯度 $\\mathbf{g}$。\n6. 生成一个随机、归一化的扰动方向 $\\delta \\mathbf{m}$。\n7. 对于测试集中的每个 $\\varepsilon$：\n    a. 计算扰动后的控制 $\\mathbf{m}_{\\text{pert}} = \\mathbf{m} + \\varepsilon \\delta \\mathbf{m}$。\n    b. 求解状态方程以获得扰动后的状态 $\\mathbf{u}_{\\text{pert}}$。\n    c. 计算扰动后的目标值 $J_{\\text{pert}}$。\n    d. 计算泰勒余项 $R(\\varepsilon)$。\n8. 对 $\\log |R(\\varepsilon)|$ vs. $\\log \\varepsilon$ 进行线性回归以找到斜率 $p$。\n9. 将 $p$ 附加到结果列表中。\n处理完所有测试用例后，对结果进行格式化并打印。", "answer": "[2.000, 2.000, 2.000]", "id": "3361125"}]}