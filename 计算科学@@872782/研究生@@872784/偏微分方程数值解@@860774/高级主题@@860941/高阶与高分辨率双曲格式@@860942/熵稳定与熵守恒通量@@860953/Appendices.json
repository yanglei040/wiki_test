{"hands_on_practices": [{"introduction": "本章的第一个动手实践为理解和构建熵稳定格式奠定了基础。从经典的非线性标量守恒律——伯格斯方程（Burgers' equation）出发，你将从第一性原理推导出一个熵守恒通量。接着，你将学习如何通过添加一个精心构造的数值耗散项，将其转化为一个熵稳定通量，并分析为何某些耗散项的选择对于正确捕捉激波等物理现象至关重要 [@problem_id:3314743]。", "problem": "给定一个标量守恒律，即伯格斯方程 (Burgers’ equation)，写作 $u_t + (f(u))_x = 0$，其中 $f(u) = \\tfrac{1}{2} u^2$。考虑一个凸熵对 $(U(u), F(u))$，其中 $U(u) = \\tfrac{1}{2} u^2$，熵变量为 $v(u) = \\tfrac{dU}{du} = u$，熵通量 $F(u)$ 由要求 $\\tfrac{dF}{du} = v(u) \\tfrac{df}{du}$ 定义。设熵势为 $\\psi(u) = v(u) f(u) - F(u)$。假设使用均匀网格，并在左右状态 $u_L$ 和 $u_R$ 之间的界面上使用两点数值通量。\n\n您的任务是：\n- 从连续层面的熵不等式、熵变量的定义以及守恒所需的离散伸缩求和出发，推导一个两点熵守恒 (EC) 通量 $f^{ec}(u_L, u_R)$，该通量对其参数对称，并与 $f(u)$ 一致。\n- 通过添加一个在熵变量中对称正定的耗散项，构造一个熵稳定 (ES) 通量：$f^{es}(u_L, u_R) = f^{ec}(u_L, u_R) - \\tfrac{1}{2} \\alpha(u_L, u_R) \\, (v_R - v_L)$，其中 $\\alpha(u_L, u_R) \\ge 0$ 是一个标量耗散系数，$v_L = v(u_L)$，$v_R = v(u_R)$。证明单个界面上的离散熵产生等于 $(v_R - v_L)$ 的一个非正二次型，并给出其对于伯格斯方程的显式表达式。\n- 分析在激波附近 $\\alpha(u_L, u_R)$ 所需的基于特征值的缩放。利用特征速度为 $\\lambda(u) = f'(u) = u$ 这一事实。推导所得两点通量满足单调性的一个关于 $\\alpha(u_L, u_R)$ 的充分条件，并将其具体化为伯格斯方程下一个包含 $u_L$ 和 $u_R$ 的界。比较以下两种缩放：Roe 缩放 $\\alpha_{\\mathrm{roe}} = \\left|\\tfrac{u_L + u_R}{2}\\right|$ 和 Rusanov（局部 Lax–Friedrichs）缩放 $\\alpha_{\\max} = \\max(|u_L|, |u_R|)$。从熵耗散的严格性和单调性角度解释，为什么跨音速激波需要更大的缩放。\n\n实现要求：\n- 实现以下函数：\n  - 熵守恒通量 $f^{ec}(u_L, u_R)$。\n  - 熵势 $\\psi(u)$ 和熵变量 $v(u)$。\n  - 耗散缩放 $\\alpha_{\\mathrm{roe}}(u_L, u_R)$ 和 $\\alpha_{\\max}(u_L, u_R)$。\n  - 每个界面的离散熵产生 $\\Sigma(u_L, u_R; \\alpha) = (v_R - v_L)\\, f^{es}(u_L,u_R) - (\\psi_R - \\psi_L)$。\n- 对每个界面状态对，计算：\n  - 熵守恒通量值 $f^{ec}(u_L, u_R)$，为浮点数，保留六（6）位小数。\n  - 使用 Rusanov 缩放的离散熵产生 $\\Sigma(u_L, u_R; \\alpha_{\\max})$，为浮点数，保留六（6）位小数。\n  - 一个布尔值，指示对于非相同状态，Roe 缩放是否是严格正定的，即当 $u_L \\ne u_R$ 时，是否有 $\\alpha_{\\mathrm{roe}}(u_L, u_R)  0$（如果 $u_L = u_R$，则视为真）。\n  - 一个布尔值，指示 Roe 缩放是否满足充分的单调性界限，即是否有 $\\alpha_{\\mathrm{roe}}(u_L, u_R) \\ge \\alpha_{\\max}(u_L, u_R)$。\n  - 一个布尔值，验证熵守恒通量的对称性，即 $f^{ec}(u_L, u_R) = f^{ec}(u_R, u_L)$ 是否在 $10^{-12}$ 的容差内成立。\n\n测试套件：\n- 使用以下界面状态对 $(u_L, u_R)$：\n  - $(0.2, 0.3)$\n  - $(1.0, -1.0)$\n  - $(0.5, 0.1)$\n  - $(0.7, 0.7)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是 $[f^{ec}, \\Sigma_{\\max}, \\mathrm{SPD}_{\\mathrm{roe}}, \\mathrm{MONO}_{\\mathrm{roe}}, \\mathrm{SYM}_{ec}]$ 形式的列表，其中前两项是浮点数，其余项是布尔值。例如：$[[0.123456,-0.001234,True,False,True],[\\dots],\\dots]$。", "solution": "该问题要求推导并实现用于标量伯格斯方程 $u_t + (f(u))_x = 0$ 的熵守恒和熵稳定数值通量，其中通量为 $f(u) = \\tfrac{1}{2} u^2$。该分析是设计用于双曲守恒律的现代激波捕捉格式的基础。\n\n给定凸熵函数 $U(u) = \\tfrac{1}{2} u^2$。由此，我们推导相关量。熵变量 $v(u)$ 定义为熵函数关于守恒变量 $u$ 的导数：\n$$\nv(u) = \\frac{dU}{du} = \\frac{d}{du} \\left(\\frac{1}{2} u^2\\right) = u\n$$\n熵通量 $F(u)$ 由相容性条件 $\\tfrac{dF}{du} = v(u) \\tfrac{df}{du}$ 定义。代入我们的具体函数：\n$$\n\\frac{dF}{du} = (u) \\frac{d}{du}\\left(\\frac{1}{2} u^2\\right) = u \\cdot u = u^2\n$$\n对 $u$ 积分得到熵通量，不失一般性，我们可以将积分常数设为零：\n$$\nF(u) = \\int u^2 du = \\frac{1}{3} u^3\n$$\n最后，熵势 $\\psi(u)$ 定义为 $\\psi(u) = v(u) f(u) - F(u)$：\n$$\n\\psi(u) = (u) \\left(\\frac{1}{2} u^2\\right) - \\frac{1}{3} u^3 = \\frac{1}{2} u^3 - \\frac{1}{3} u^3 = \\frac{1}{6} u^3\n$$\n\n如果一个两点数值通量 $f^{ec}(u_L, u_R)$ 满足离散熵恒等式，即它平衡了界面上熵变量的跳跃与熵势的跳跃，则该通量是熵守恒的：\n$$\n(v_R - v_L) f^{ec}(u_L, u_R) = \\psi_R - \\psi_L\n$$\n这里，$v_L = v(u_L)$，$v_R = v(u_R)$，$\\psi_L = \\psi(u_L)$，$\\psi_R = \\psi(u_R)$。令 $\\llbracket \\cdot \\rrbracket$ 表示跳跃算子，例如 $\\llbracket v \\rrbracket = v_R - v_L$。条件为 $\\llbracket v \\rrbracket f^{ec} = \\llbracket \\psi \\rrbracket$。\n\n对于 $\\llbracket v \\rrbracket \\ne 0$ 的情况，求解 $f^{ec}(u_L, u_R)$：\n$$\nf^{ec}(u_L, u_R) = \\frac{\\psi_R - \\psi_L}{v_R - v_L} = \\frac{\\frac{1}{6} u_R^3 - \\frac{1}{6} u_L^3}{u_R - u_L}\n$$\n使用立方差的代数恒等式 $a^3 - b^3 = (a-b)(a^2+ab+b^2)$，我们简化表达式：\n$$\nf^{ec}(u_L, u_R) = \\frac{1}{6} \\frac{(u_R - u_L)(u_R^2 + u_R u_L + u_L^2)}{u_R - u_L} = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2)\n$$\n通过取极限，该表达式对于 $u_L = u_R = u$ 的情况也是良定的，得到 $f^{ec}(u, u) = \\frac{1}{6}(3u^2) = \\frac{1}{2}u^2 = f(u)$，这表明其具有一致性。该公式在其参数上显然是对称的，即 $f^{ec}(u_L, u_R) = f^{ec}(u_R, u_L)$。\n\n熵稳定 (ES) 通量 $f^{es}$ 是通过向熵守恒通量添加一个数值耗散项来构造的。所添加的项在熵变量中必须是对称正定的。其一般形式为：\n$$\nf^{es}(u_L, u_R) = f^{ec}(u_L, u_R) - \\frac{1}{2} \\mathbf{R} (v_R - v_L)\n$$\n其中 $\\mathbf{R}$ 是一个对称正定矩阵。对于标量方程，这简化为：\n$$\nf^{es}(u_L, u_R) = f^{ec}(u_L, u_R) - \\frac{1}{2} \\alpha(u_L, u_R) (v_R - v_L)\n$$\n其中标量耗散系数 $\\alpha(u_L, u_R) \\ge 0$。\n\n界面处的离散熵产生（或耗散）$\\Sigma$ 定义为离散熵恒等式被违背的量：\n$$\n\\Sigma(u_L, u_R; \\alpha) = (v_R - v_L) f^{es}(u_L, u_R) - (\\psi_R - \\psi_L)\n$$\n代入 $f^{es}$ 的定义：\n$$\n\\Sigma = (v_R - v_L) \\left[f^{ec}(u_L, u_R) - \\frac{1}{2} \\alpha (v_R - v_L)\\right] - (\\psi_R - \\psi_L)\n$$\n整理各项：\n$$\n\\Sigma = \\left[(v_R-v_L)f^{ec}(u_L, u_R) - (\\psi_R - \\psi_L)\\right] - \\frac{1}{2}\\alpha(v_R-v_L)^2\n$$\n根据熵守恒通量的定义，方括号中的项为零。剩下：\n$$\n\\Sigma(u_L, u_R; \\alpha) = -\\frac{1}{2} \\alpha(u_L, u_R) (v_R - v_L)^2\n$$\n由于 $\\alpha \\ge 0$，我们有 $\\Sigma \\le 0$。熵产生是熵变量跳跃的一个非正二次型。这确保了格式满足离散熵不等式，使其熵稳定。对于伯格斯方程和我们选择的熵，$v(u)=u$，所以 $\\Sigma = -\\frac{1}{2} \\alpha(u_L, u_R) (u_R - u_L)^2$。\n\n耗散系数 $\\alpha$ 的选择至关重要。它必须足够大以确保稳定性并强制执行物理求解属性（如激波附近的单调性），但又不能大到过度涂抹（“扩散”）解。\n伯格斯方程的特征速度是 $\\lambda(u) = f'(u) = u$。基于特征值，$\\alpha$ 的两个常见选择是：\n1.  Roe 缩放：$\\alpha_{\\mathrm{roe}} = \\left|\\frac{f(u_R)-f(u_L)}{u_R-u_L}\\right| = \\left|\\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R-u_L}\\right| = \\left|\\frac{u_L+u_R}{2}\\right|$。这与 Roe 平均波速成正比。\n2.  Rusanov (局部 Lax-Friedrichs) 缩放：$\\alpha_{\\max} = \\max(|\\lambda(u_L)|, |\\lambda(u_R)|) = \\max(|u_L|, |u_R|)$。这是局部最大波速的大小。\n\n一阶格式单调性的一个充分条件通常是数值粘性足够大，以主导任何反扩散项。问题提出了一个针对充分单调性界限的特定检查：$\\alpha \\ge \\alpha_{\\max}(u_L, u_R)$。我们被要求测试 Roe 缩放是否满足此界限，即 $\\alpha_{\\mathrm{roe}} \\ge \\alpha_{\\max}$ 是否成立。根据三角不等式， $|u_L+u_R| \\le |u_L|+|u_R|$，因此 $\\alpha_{\\mathrm{roe}} = |\\frac{u_L+u_R}{2}| \\le \\frac{|u_L|+|u_R|}{2}$。同时，$\\max(|u_L|, |u_R|) \\ge \\frac{|u_L|+|u_R|}{2}$。因此，$\\alpha_{\\mathrm{roe}} \\le \\alpha_{\\max}$。等式仅在特殊情况下成立（例如 $u_L=u_R$），但总的来说，Roe 缩放提供的耗散小于 Rusanov 缩放，并且不满足这个强单调性条件。\n\n对于像 $\\alpha_{\\max}$ 这样更大的缩放的需求在跨音速激波处最为明显。对于伯格斯方程，跨音速激波是指特征速度 $\\lambda(u)=u$ 变号的激波，即 $u_L  0$ 且 $u_R  0$（对于激波）或反之。一个临界情况是驻定激波，其激波速度 $\\frac{u_L+u_R}{2}=0$，意味着 $u_L = -u_R$。\n在这种情况下，Roe 缩放给出 $\\alpha_{\\mathrm{roe}} = |\\frac{u_L-u_L}{2}| = 0$。当耗散为零时，熵产生 $\\Sigma = 0$。该格式变为熵守恒的，这对于激波是不正确的，因为物理激波必须严格耗散熵。这种未能引入耗散的现象，即所谓的“熵修正失效”(entropy glitch)，允许形成非物理的解，如膨胀激波。\n相比之下，对于非平凡的激波，Rusanov 缩放给出 $\\alpha_{\\max} = \\max(|u_L|, |-u_L|) = |u_L|  0$。这确保了 $\\Sigma  0$，提供了热力学第二定律（在其流体力学形式下即 Lax 熵条件）所要求的严格熵耗散，从而稳定了数值解并选择了物理上正确的激波。这说明了为什么需要一个对激波速度变为零不敏感的更大缩放来实现鲁棒性，尤其是在正确捕捉跨音速现象时。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of analyzing entropy-stable fluxes for Burgers' equation.\n    \"\"\"\n\n    test_cases = [\n        (0.2, 0.3),\n        (1.0, -1.0),\n        (0.5, 0.1),\n        (0.7, 0.7)\n    ]\n\n    def f_ec(u_L, u_R):\n        \"\"\"\n        Computes the entropy-conservative (EC) flux for Burgers' equation.\n        f_ec(u_L, u_R) = (1/6) * (u_L^2 + u_L*u_R + u_R^2)\n        \"\"\"\n        return (1/6) * (u_L**2 + u_L * u_R + u_R**2)\n\n    def v(u):\n        \"\"\"\n        Computes the entropy variable v(u) = u.\n        \"\"\"\n        return u\n\n    def psi(u):\n        \"\"\"\n        Computes the entropy potential psi(u) = (1/6) * u^3.\n        \"\"\"\n        return (1/6) * u**3\n\n    def alpha_roe(u_L, u_R):\n        \"\"\"\n        Computes the Roe dissipation scaling.\n        alpha_roe = |(u_L + u_R) / 2|\n        \"\"\"\n        return np.abs((u_L + u_R) / 2)\n\n    def alpha_max(u_L, u_R):\n        \"\"\"\n        Computes the Rusanov (local Lax-Friedrichs) dissipation scaling.\n        alpha_max = max(|u_L|, |u_R|)\n        \"\"\"\n        return np.maximum(np.abs(u_L), np.abs(u_R))\n\n    def sigma(u_L, u_R, alpha_func):\n        \"\"\"\n        Computes the per-interface discrete entropy production Sigma.\n        Sigma = -0.5 * alpha(u_L, u_R) * (v_R - v_L)^2\n        For the chosen entropy, v(u) = u.\n        \"\"\"\n        diss_coeff = alpha_func(u_L, u_R)\n        v_L, v_R = v(u_L), v(u_R)\n        return -0.5 * diss_coeff * (v_R - v_L)**2\n\n    results = []\n    for u_L, u_R in test_cases:\n        # 1. Compute the entropy-conservative flux value\n        f_ec_val = round(f_ec(u_L, u_R), 6)\n\n        # 2. Compute the discrete entropy production using Rusanov scaling\n        sigma_max_val = round(sigma(u_L, u_R, alpha_max), 6)\n        # Handle potential -0.0\n        if sigma_max_val == -0.0:\n            sigma_max_val = 0.0\n\n        # 3. Check if Roe scaling is strictly positive definite for non-identical states\n        # The condition is alpha_roe  0 if u_L != u_R. This is true unless u_L + u_R = 0.\n        # It is also defined as True if u_L == u_R.\n        spd_roe = (u_L == u_R) or (u_L + u_R != 0)\n\n        # 4. Check if Roe scaling satisfies the sufficient monotonicity bound\n        # The problem defines this bound as alpha_max.\n        ar = alpha_roe(u_L, u_R)\n        am = alpha_max(u_L, u_R)\n        # Use a small tolerance for floating point comparison\n        mono_roe = ar = am or np.isclose(ar, am)\n\n        # 5. Verify the symmetry of the entropy-conservative flux\n        sym_ec = np.isclose(f_ec(u_L, u_R), f_ec(u_R, u_L), atol=1e-12, rtol=0)\n\n        results.append([f_ec_val, sigma_max_val, spd_roe, mono_roe, sym_ec])\n    \n    # Format the final output string exactly as required, handling lists within lists\n    # by converting each inner list to its string representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3314743"}, {"introduction": "在之前练习的基础上，我们现在深入研究一个关键的失效模式：当数值耗散不足时会发生什么？本实践以常见的局部Lax-Friedrichs（LLF）通量为案例，展示了低估耗散如何导致非物理性的熵产生，从而违反了热力学第二定律。你将分析性地确定这种失效发生的条件，并推导出一个能保证熵条件恒成立的鲁棒的耗散系数，从而加深对“稳定性”来源的理解 [@problem_id:3386414]。", "problem": "考虑带 Burgers 通量的一维标量守恒律。设守恒变量为 $u \\in \\mathbb{R}$，通量为 $f(u) = \\tfrac{1}{2}u^{2}$。考虑凸熵 $U(u) = \\tfrac{1}{2}u^{2}$，其熵通量 $G(u)$ 的选择满足熵对的相容性条件。设熵变量为 $v = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u}$，熵势为 $\\psi(u) = v(u) f(u) - G(u)$。在左右两态 $u_{L}$ 和 $u_{R}$ 之间的单个界面上，将离散熵产（界面贡献）定义为标量：\n$$\n\\sigma = \\big(v_{R} - v_{L}\\big) \\, \\widehat{f}(u_{L},u_{R}) - \\big(\\psi(u_{R}) - \\psi(u_{L})\\big),\n$$\n其中 $\\widehat{f}$ 是一个两点数值通量。\n\n你的任务是分析 Local Lax-Friedrichs (LLF) 通量中数值耗散不足如何影响界面熵产 $\\sigma$ 的符号，并为界面耗散系数提出一个鲁棒的估计器，以保证 Burgers 方程的离散熵产为非正。你必须仅从基本定律和核心定义出发，不使用任何非由第一性原理推导出的简化公式。\n\n具体要求如下：\n\n- 使用 $f(u) = \\tfrac{1}{2}u^{2}$，$U(u) = \\tfrac{1}{2}u^{2}$，并根据熵对的定义验证 $v(u) = u$ 和 $\\psi(u)$。使用标准的 LLF 通量，该通量由一个中心部分和一个由系数 $\\alpha \\ge 0$（基于局部波速）缩放的对称耗散项定义。LLF 通量的中心部分必须只使用 $f(u_{L})$ 和 $f(u_{R})$，且反对称耗散必须依赖于状态间的跳跃。根据这些定义，推导出界面上 $\\sigma$ 作为 $u_{L}$、$u_{R}$ 和 $\\alpha$ 的函数表达式。\n\n- 解析地确定，当耗散系数 $\\alpha$ 相对于 Burgers 的 LLF 通量中所需的界限被低估时，$\\sigma$ 变为严格为正的条件。用 $u_{L}$ 和 $u_{R}$ 来量化这个条件。\n\n- 为界面耗散系数提出一个鲁棒估计器 $\\alpha_{\\mathrm{rob}}(u_{L},u_{R})$，该估计器在使用 LLF 通量时能保证对于 Burgers 方程的所有 $u_{L}$ 和 $u_{R}$ 都有 $\\sigma \\le 0$。你的估计器必须纯粹用两个状态 $u_{L}$ 和 $u_{R}$ 以及 $f$ 的标准特征来表示；它不能依赖任何外部调整参数。\n\n- 实现一个程序，对于一组给定的测试用例，评估使用低估耗散 $\\alpha_{\\mathrm{under}} = k \\cdot \\max\\{|f'(u_{L})|,|f'(u_{R})|\\}$（其中 $0  k  1$）的 LLF 通量的 $\\sigma$ 符号，并将其与使用你的鲁棒估计器 $\\alpha_{\\mathrm{rob}}(u_{L},u_{R})$ 时的 $\\sigma$ 符号进行比较。对于每个测试用例，程序必须返回一个包含两个布尔值的列表，分别指示在低估耗散和鲁棒耗散下 $\\sigma \\le 0$ 是否成立。\n\n使用以下参数三元组 $(u_{L},u_{R},k)$ 的测试套件来全面评估不同场景：\n\n1. $(0,2,0.1)$：一个正跳跃，耗散被严重低估。\n2. $(1,5,0.1)$：一个更大的正跳跃，耗散被严重低估。\n3. $(5,1,0.1)$：一个负跳跃，耗散被严重低估。\n4. $(2,2,0.1)$：零跳跃。\n5. $(-1,2,0.1)$：一个穿过零点的正跳跃，耗散被严重低估。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素是一个包含两个条目的列表，其中包含两个布尔值，对应于同一测试用例的两种耗散选择（例如，\"[[true_case1_under,true_case1_rob],[...],...]\"）。布尔值必须使用编程语言的原生布尔字面量打印。\n\n不涉及物理单位或角度单位。所有答案都是无量纲的。", "solution": "首先验证问题陈述，以确保其具有科学依据、适定且客观。\n\n### 步骤1：提取已知条件\n- **守恒律**：一维标量守恒律 $\\partial_t u + \\partial_x f(u) = 0$。\n- **通量函数**：$f(u) = \\tfrac{1}{2}u^{2}$ (Burgers 方程)。\n- **守恒变量**：$u \\in \\mathbb{R}$。\n- **熵函数**：一个凸熵 $U(u) = \\tfrac{1}{2}u^{2}$。\n- **熵通量**：$G(u)$，由相容性条件 $\\dfrac{\\mathrm{d}G}{\\mathrm{d}u} = v(u) \\dfrac{\\mathrm{d}f}{\\mathrm{d}u}$ 定义。\n- **熵变量**：$v = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u}$。\n- **熵势**：$\\psi(u) = v(u) f(u) - G(u)$。\n- **界面状态**：$u_{L}$ 和 $u_{R}$。\n- **离散熵产**：$\\sigma = \\big(v_{R} - v_{L}\\big) \\, \\widehat{f}(u_{L},u_{R}) - \\big(\\psi(u_{R}) - \\psi(u_{L})\\big)$。\n- **数值通量**：Local Lax-Friedrichs (LLF) 通量 $\\widehat{f}(u_L, u_R)$，带有一个基于 $f(u_L)$ 和 $f(u_R)$ 的中心部分，以及一个由系数 $\\alpha \\ge 0$ 缩放的反对称耗散项。\n- **低估的耗散**：$\\alpha_{\\mathrm{under}} = k \\cdot \\max\\{|f'(u_{L})|,|f'(u_{R})|\\}$，其中 $0  k  1$。\n- **任务**：\n    1.  推导 $\\sigma$ 作为 $u_L$、$u_R$ 和 $\\alpha$ 的函数表达式。\n    2.  找出 $\\sigma  0$ 的解析条件。\n    3.  提出一个保证 $\\sigma \\le 0$ 的鲁棒估计器 $\\alpha_{\\mathrm{rob}}(u_{L},u_{R})$。\n    4.  实现一个程序，用给定的测试用例测试使用 $\\alpha_{\\mathrm{under}}$ 和 $\\alpha_{\\mathrm{rob}}$ 时 $\\sigma \\le 0$ 是否成立。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，涉及守恒律数值方法的熵稳定性等既有概念。问题是适定的，提供了推导唯一解所需的所有定义。语言客观、正式。设置完整且内部一致。该任务是数值格式分析中的一个标准练习，完全可以通过数学推导和计算进行验证。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将提供完整的解决方案。\n\n---\n\n按要求从第一性原理推导求解。\n\n### 熵相关量的推导\n给定通量 $f(u) = \\tfrac{1}{2}u^2$ 和熵函数 $U(u) = \\tfrac{1}{2}u^2$。\n\n1.  **熵变量 $v(u)$**：熵变量是熵函数关于守恒变量的导数。\n    $$\n    v(u) = \\frac{\\mathrm{d}U}{\\mathrm{d}u} = \\frac{\\mathrm{d}}{\\mathrm{d}u}\\left(\\frac{1}{2}u^2\\right) = u\n    $$\n    因此，$v_L = u_L$ 且 $v_R = u_R$。\n\n2.  **熵通量 $G(u)$**：熵通量由相容性条件 $\\dfrac{\\mathrm{d}G}{\\mathrm{d}u} = v(u) \\dfrac{\\mathrm{d}f}{\\mathrm{d}u}$ 确定。物理通量的导数为 $\\dfrac{\\mathrm{d}f}{\\mathrm{d}u} = \\dfrac{\\mathrm{d}}{\\mathrm{d}u}(\\tfrac{1}{2}u^2) = u$。\n    $$\n    \\frac{\\mathrm{d}G}{\\mathrm{d}u} = v(u) \\frac{\\mathrm{d}f}{\\mathrm{d}u} = u \\cdot u = u^2\n    $$\n    对 $u$ 积分得到熵通量（不失一般性，积分常数设为零）：\n    $$\n    G(u) = \\int u^2 \\, \\mathrm{d}u = \\frac{1}{3}u^3\n    $$\n\n3.  **熵势 $\\psi(u)$**：熵势定义为 $\\psi(u) = v(u)f(u) - G(u)$。\n    $$\n    \\psi(u) = (u)\\left(\\frac{1}{2}u^2\\right) - \\left(\\frac{1}{3}u^3\\right) = \\frac{1}{2}u^3 - \\frac{1}{3}u^3 = \\frac{1}{6}u^3\n    $$\n    因此，跨界面的熵势跳跃为 $\\psi(u_R) - \\psi(u_L) = \\tfrac{1}{6}u_R^3 - \\tfrac{1}{6}u_L^3$。\n\n### 界面熵产 $\\sigma$ 的推导\n\n1.  **Local Lax-Friedrichs (LLF) 通量**：LLF 通量定义为通量的平均值加上一个与状态跳跃成正比的耗散项。\n    $$\n    \\widehat{f}(u_L, u_R) = \\frac{f(u_L) + f(u_R)}{2} - \\frac{\\alpha}{2}(u_R - u_L)\n    $$\n    代入 $f(u) = \\tfrac{1}{2}u^2$：\n    $$\n    \\widehat{f}(u_L, u_R) = \\frac{\\frac{1}{2}u_L^2 + \\frac{1}{2}u_R^2}{2} - \\frac{\\alpha}{2}(u_R - u_L) = \\frac{1}{4}(u_L^2 + u_R^2) - \\frac{\\alpha}{2}(u_R - u_L)\n    $$\n\n2.  **$\\sigma$ 的表达式**：将推导出的量代入 $\\sigma$ 的定义中。\n    $$\n    \\sigma = (v_R - v_L) \\widehat{f}(u_L, u_R) - (\\psi_R - \\psi_L)\n    $$\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{1}{4}(u_L^2 + u_R^2) - \\frac{\\alpha}{2}(u_R - u_L) \\right] - \\left( \\frac{1}{6}u_R^3 - \\frac{1}{6}u_L^3 \\right)\n    $$\n    为简化起见，我们使用代数恒等式 $u_R^3 - u_L^3 = (u_R - u_L)(u_R^2 + u_R u_L + u_L^2)$。\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{1}{4}(u_L^2 + u_R^2) \\right] - \\frac{\\alpha}{2}(u_R - u_L)^2 - \\frac{1}{6}(u_R - u_L)(u_R^2 + u_R u_L + u_L^2)\n    $$\n    提出公因子 $(u_R - u_L)$：\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{1}{4}(u_L^2 + u_R^2) - \\frac{1}{6}(u_R^2 + u_R u_L + u_L^2) \\right] - \\frac{\\alpha}{2}(u_R - u_L)^2\n    $$\n    将括号内的项用公分母 $12$ 合并：\n    $$\n    \\frac{3(u_L^2 + u_R^2) - 2(u_R^2 + u_R u_L + u_L^2)}{12} = \\frac{3u_L^2 + 3u_R^2 - 2u_R^2 - 2u_R u_L - 2u_L^2}{12} = \\frac{u_L^2 - 2u_L u_R + u_R^2}{12} = \\frac{(u_R - u_L)^2}{12}\n    $$\n    将此代回 $\\sigma$ 的表达式中：\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{(u_R - u_L)^2}{12} \\right] - \\frac{\\alpha}{2}(u_R - u_L)^2 = \\frac{(u_R - u_L)^3}{12} - \\frac{\\alpha}{2}(u_R - u_L)^2\n    $$\n    此表达式可以进行因式分解以便于分析：\n    $$\n    \\sigma = (u_R - u_L)^2 \\left[ \\frac{u_R - u_L}{12} - \\frac{\\alpha}{2} \\right]\n    $$\n\n### 正熵产的条件（$\\sigma  0$）\n\n离散熵条件要求数值格式不产生熵，即 $\\sigma \\le 0$。我们分析该条件在何种情况下会被违反。\n项 $(u_R - u_L)^2$ 总是非负的。如果 $u_L = u_R$，则 $\\sigma = 0$。对于 $u_L \\neq u_R$，$\\sigma$ 的符号由括号中的项决定。\n违反熵条件（$\\sigma  0$）的情况发生当且仅当：\n$$\n\\frac{u_R - u_L}{12} - \\frac{\\alpha}{2}  0 \\implies \\frac{u_R - u_L}{6}  \\alpha\n$$\n该不等式只有在 $u_R - u_L  0$ 时才能满足，这对应于精确解中的一个膨胀扇。在这种情况下产生正 $\\sigma$ 的数值格式容许了非物理的“膨胀激波”。因此，耗散不足（$\\alpha$ 太小）会导致在 $u_L  u_R$ 的状态下违反热力学第二定律。对于物理激波（$u_L  u_R$），$u_R - u_L  0$，使得括号中的项为负（因为 $\\alpha \\ge 0$），因此 $\\sigma \\le 0$，这在物理上是正确的（熵被耗散）。\n\n### 鲁棒耗散估计器 $\\alpha_{\\mathrm{rob}}$\n\n为保证熵条件 $\\sigma \\le 0$ 总是被满足，我们必须选择 $\\alpha$ 使得括号中的项总是非正。\n$$\n\\frac{u_R - u_L}{12} - \\frac{\\alpha}{2} \\le 0 \\implies \\alpha \\ge \\frac{u_R - u_L}{6}\n$$\n这个条件必须对所有可能的状态 $(u_L, u_R)$ 成立。\n- 如果 $u_R - u_L \\le 0$，则右侧为非正。由于要求 $\\alpha \\ge 0$，任何有效的 $\\alpha$ 都满足该条件。\n- 如果 $u_R - u_L  0$，我们必须强制 $\\alpha \\ge \\frac{u_R - u_L}{6}$。\n\n为了在所有情况下都满足这个条件，我们必须选择 $\\alpha$ 至少为右侧可能的最大值。一个鲁棒估计器 $\\alpha_{\\mathrm{rob}}$ 可以被定义为普遍满足此条件的最小值。\n$$\n\\alpha_{\\mathrm{rob}}(u_L, u_R) = \\max\\left(0, \\frac{u_R - u_L}{6}\\right)\n$$\n这个估计器保证 $\\sigma \\le 0$。具体来说，如果 $u_L \\ge u_R$，则 $\\alpha_{\\mathrm{rob}} = 0$ 且 $\\sigma = \\frac{(u_R - u_L)^3}{12} \\le 0$。如果 $u_L  u_R$，则 $\\alpha = \\frac{u_R - u_L}{6}$，这导致 $\\sigma = (u_R - u_L)^2 \\left[ \\frac{u_R - u_L}{12} - \\frac{1}{2}\\left(\\frac{u_R - u_L}{6}\\right) \\right] = 0$。因此，对于任何状态对 $(u_L, u_R)$，这种耗散选择确保了 $\\sigma \\le 0$。这个估计器仅依赖于状态 $u_L$ 和 $u_R$，其推导从根本上与 $f(u)$ 和 $U(u)$ 的性质相关联。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the interface entropy production for the Burgers equation\n    with an LLF numerical flux, comparing an underestimated dissipation\n    with a robustly derived one.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (u_L, u_R, k).\n    test_cases = [\n        (0.0, 2.0, 0.1),  # Positive jump, strongly underestimated dissipation\n        (1.0, 5.0, 0.1),  # Larger positive jump, strongly underestimated dissipation\n        (5.0, 1.0, 0.1),  # Negative jump (physical shock)\n        (2.0, 2.0, 0.1),  # Zero jump\n        (-1.0, 2.0, 0.1), # Positive jump crossing zero\n    ]\n\n    results = []\n    \n    # A small tolerance for floating point comparisons to zero.\n    TOL = 1e-12\n\n    for u_L, u_R, k in test_cases:\n        # This function calculates the interface entropy production sigma\n        # based on the derived formula:\n        # sigma = (u_R - u_L)^3 / 12 - alpha / 2 * (u_R - u_L)^2\n        def calculate_sigma(alpha):\n            du = u_R - u_L\n            sigma = (du**3) / 12.0 - (alpha / 2.0) * (du**2)\n            return sigma\n\n        # --- Case 1: Underestimated Dissipation ---\n        \n        # Characteristic speeds are f'(u) = u for Burgers' equation.\n        f_prime_L = u_L\n        f_prime_R = u_R\n        \n        # Standard LLF dissipation coefficient is max(|f'(u_L)|, |f'(u_R)|).\n        # We use an underestimated version scaled by k.\n        alpha_under = k * max(abs(f_prime_L), abs(f_prime_R))\n        \n        sigma_under = calculate_sigma(alpha_under)\n        \n        # Check if the entropy condition sigma = 0 is satisfied.\n        is_entropy_stable_under = (sigma_under = TOL)\n\n        # --- Case 2: Robust Dissipation ---\n        \n        # Robust estimator derived from first principles to guarantee sigma = 0.\n        # alpha_rob = max(0, (u_R - u_L) / 6)\n        alpha_rob = max(0.0, (u_R - u_L) / 6.0)\n        \n        sigma_rob = calculate_sigma(alpha_rob)\n\n        # Check if the entropy condition sigma = 0 is satisfied.\n        is_entropy_stable_rob = (sigma_rob = TOL)\n        \n        # Store the boolean results as a formatted string.\n        # The problem asks for lowercase boolean literals in the output.\n        result_str = f\"[{str(is_entropy_stable_under).lower()},{str(is_entropy_stable_rob).lower()}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    # Example: [[false,true],[false,true],...]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3386414"}, {"introduction": "最后的实践将我们引向更高级和更实用的格式设计。在这里，你将不再使用一个全局定义的耗散系数，而是构建一个“智能”的人工粘性模型，该模型能根据熵残差的大小，仅在激波等需要数值正则化的区域自动激活。你不仅需要证明所得格式的熵稳定性，还将学习如何校准粘性系数以控制激波的厚度，从而将抽象的数值理论与实际的计算需求联系起来 [@problem_id:3386455]。", "problem": "考虑在一维周期性域上，采用以单元为中心的有限体积离散化的标量守恒律 $u_t + f(u)_x = 0$。重点关注无粘伯格斯方程，其中 $f(u) = \\frac{1}{2}u^2$，以及严格凸的数学熵 $\\eta(u) = \\frac{1}{2}u^2$ 和相应的熵通量 $q(u) = \\frac{1}{3}u^3$。设熵变量为 $v(u) = \\eta'(u) = u$，熵势为 $\\psi(u) = v(u) f(u) - q(u) = \\frac{1}{6}u^3$。使用一个包含 $N$ 个单元的均匀网格，间距为 $h$，并用 $u_i$ 表示单元 $i$ 内的单元平均值。\n\n一个在界面 $x_{i+\\frac{1}{2}}$ 处具有两点数值通量 $F_{i+\\frac{1}{2}}$ 的有限体积半离散格式通过以下方式演化解：\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{h}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right).\n$$\n针对无粘伯格斯方程的熵守恒（EC）数值通量 $F^{\\mathrm{ec}}(u_L,u_R)$ 基于 Tadmor 的路径积分定义，其闭合形式等于\n$$\nF^{\\mathrm{ec}}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right),\n$$\n该通量满足关于熵势 $\\psi(u)$ 的离散链式法则性质。\n\n你需要：\n1) 推导一个与离散熵残差 $\\mathcal{R}_{\\eta}$ 成正比的人工粘性模型。将单元 $i$ 处的离散熵残差通过稳态代理定义为\n$$\n\\mathcal{R}_{\\eta,i} = \\left|\\frac{q(u_{i+1}) - q(u_{i-1})}{2h}\\right|,\n$$\n其中 $q(u) = \\frac{1}{3}u^3$ 且索引为周期性的。将其归一化为\n$$\n\\alpha_i = \\frac{\\mathcal{R}_{\\eta,i}}{\\max_j \\mathcal{R}_{\\eta,j} + \\varepsilon},\n$$\n其中 $\\varepsilon  0$ 是一个小数，并定义界面指示器为\n$$\n\\alpha_{i+\\frac{1}{2}} = \\max\\left(\\alpha_i,\\alpha_{i+1}\\right).\n$$\n提出一个形式为\n$$\n\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}}\\, h\\, \\alpha_{i+\\frac{1}{2}},\n$$\n的界面粘性 $\\nu_{i+\\frac{1}{2}}$，其中 $C_{\\mathrm{av}} \\ge 0$ 是一个校准常数。使用耗散通量\n$$\nF^{\\mathrm{diss}}_{i+\\frac{1}{2}} = -\\frac{\\nu_{i+\\frac{1}{2}}}{h}\\left(v(u_{i+1}) - v(u_i)\\right),\n$$\n和组合数值通量\n$$\nF_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i,u_{i+1}) + F^{\\mathrm{diss}}_{i+\\frac{1}{2}}.\n$$\n\n2) 证明在周期性边界条件下，假设 $C_{\\mathrm{av}} \\ge 0$ 和 $\\varepsilon  0$，所得到的半离散格式满足离散熵不等式\n$$\n\\frac{d}{dt}\\left(h \\sum_{i=0}^{N-1} \\eta(u_i)\\right) \\le 0\n$$\n\n3) 校准 $C_{\\mathrm{av}}$ 以控制激波厚度。考虑当存在常数粘性 $\\nu  0$ 时，连接 $u_L  u_R$ 的粘性伯格斯行波。利用已知的行波解结构，通过双曲正切剖面的斜率尺度的倒数来定义特征厚度长度尺度 $L$，即\n$$\nL = \\frac{4 \\nu}{\\Delta u}, \\quad \\Delta u = u_L - u_R.\n$$\n如果期望目标激波厚度跨越 $M$ 个网格单元，则设 $L = M h$，并获得目标粘性\n$$\n\\nu_{\\mathrm{target}} = \\frac{1}{4}\\, \\Delta u \\, M \\, h,\n$$\n并在 $\\max_{i+\\frac{1}{2}} \\alpha_{i+\\frac{1}{2}} = 1$ 的条件下，选择 $C_{\\mathrm{av}} = \\nu_{\\mathrm{target}}/h$。\n\n你的程序必须为无粘伯格斯方程实现上述内容，并为以下测试套件生成结果。所有计算都是无量纲的，因此不需要物理单位。\n\n测试套件和要求的输出：\n- 测试 $1$（EC 通量的熵守恒性）：设 $N=64, h=1/N, x_i = \\left(i+\\frac{1}{2}\\right)h$，且 $u_i = 0.5 + 0.4 \\sin(2\\pi x_i)$，对于 $i=0,\\dots,N-1$。仅使用 $F_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i,u_{i+1})$（即 $\\nu_{i+\\frac{1}{2}}=0$），计算半离散熵产生率\n$$\n\\frac{dH}{dt} = h \\sum_{i=0}^{N-1} v(u_i) \\frac{d u_i}{dt},\n$$\n输出 $|dH/dt|$ 的绝对值，格式为浮点数。\n\n- 测试 $2$（基于残差粘性的熵稳定性）：设 $N=100, h=1/N$，且\n$$\nu_i = \\begin{cases}\n1.0,  x_i  0.5,\\\\\n0.2,  x_i \\ge 0.5,\n\\end{cases}\n$$\n其中 $x_i = \\left(i+\\frac{1}{2}\\right)h$。根据离散熵残差构建 $\\alpha_{i+\\frac{1}{2}}$，取 $M=4$，使用 $u_L=1.0$ 和 $u_R=0.2$ 计算 $\\nu_{\\mathrm{target}}$，设 $C_{\\mathrm{av}} = \\nu_{\\mathrm{target}}/h$，且 $\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}} h \\alpha_{i+\\frac{1}{2}}$。使用 $F_{i+\\frac{1}{2}} = F^{\\mathrm{ec}} + F^{\\mathrm{diss}}$，如上计算 $dH/dt$，并输出一个布尔值，指示 $dH/dt \\le 10^{-13}$ 是否成立。\n\n- 测试 $3$（目标粘性）：对于 $u_L=1.0, u_R=0.2, h=0.01$ 和 $M=4$，计算并输出 $\\nu_{\\mathrm{target}}$，格式为浮点数。\n\n- 测试 $4$（校准后的 $C_{\\mathrm{av}}$）：使用测试 $3$ 的参数，计算并输出 $C_{\\mathrm{av}} = \\nu_{\\mathrm{target}}/h$，格式为浮点数。\n\n- 测试 $5$（平滑区域激活水平）：使用测试 $1$ 的正弦波数据和测试 $4$ 的 $C_{\\mathrm{av}}$，构建 $\\alpha_{i+\\frac{1}{2}}$ 和 $\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}} h \\alpha_{i+\\frac{1}{2}}$，并输出界面粘性的平均值 $\\frac{1}{N}\\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}}$，格式为浮点数。\n\n最终输出格式要求：\n你的程序应生成单行输出，其中包含测试 $1$–$5$ 的结果，形式为逗号分隔的列表，并用方括号括起来（例如，\"[result1,result2,result3,result4,result5]\"）。", "solution": "该问题要求为无粘伯格斯方程构建并分析一个熵稳定的有限体积格式，并对其进行数值实现以完成一系列测试。解答分为三部分：首先，构建数值格式；其次，对其熵稳定性进行形式化证明；第三，阐述校准人工粘性的原理。\n\n对于标量守恒律 $\\partial_t u + \\partial_x f(u) = 0$，一个熵稳定的有限体积格式是通过将一个熵守恒（EC）通量与一个精心设计的数值耗散项相结合来构建的。单元 $i$ 中单元平均值 $u_i$ 的半离散方程为\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{h}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\n其中 $h$ 是均匀的单元宽度，$F_{i+\\frac{1}{2}}$ 是单元 $i$ 和单元 $i+1$ 之间界面的数值通量。总数值通量由下式给出\n$$\nF_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i, u_{i+1}) + F^{\\mathrm{diss}}_{i+\\frac{1}{2}}.\n$$\n\n对于物理通量为 $f(u) = \\frac{1}{2}u^2$ 的无粘伯格斯方程，我们使用严格凸的熵函数 $\\eta(u) = \\frac{1}{2}u^2$。相应的熵变量为 $v(u) = \\eta'(u) = u$，熵通量为 $q(u) = \\frac{1}{3}u^3$。熵势为 $\\psi(u) = v(u)f(u) - q(u) = \\frac{1}{6}u^3$。\n\n熵守恒通量 $F^{\\mathrm{ec}}$ 被定义为满足离散熵恒等式 $(v(u_{i+1})-v(u_i)) F^{\\mathrm{ec}}(u_i, u_{i+1}) = \\psi(u_{i+1}) - \\psi(u_i)$。对于伯格斯方程，该通量具有闭合形式：\n$$\nF^{\\mathrm{ec}}(u_i, u_{i+1}) = \\frac{1}{6}\\left(u_i^2 + u_i u_{i+1} + u_{i+1}^2\\right).\n$$\n该通量离散化了动力学的对流部分，而没有引入数值上的熵产生或耗散。\n\n为了确保稳定性并正确捕捉激波，需要添加一个耗散通量 $F^{\\mathrm{diss}}$。该项起到人工粘性的作用。其形式为\n$$\nF^{\\mathrm{diss}}_{i+\\frac{1}{2}} = -\\frac{\\nu_{i+\\frac{1}{2}}}{h}\\left(v(u_{i+1}) - v(u_i)\\right) = -\\frac{\\nu_{i+\\frac{1}{2}}}{h}\\left(u_{i+1} - u_i\\right)\n$$\n其中 $\\nu_{i+\\frac{1}{2}} \\ge 0$ 是基于界面的粘性系数。为了将耗散限制在需要的区域（即激波或陡峭梯度附近），$\\nu_{i+\\frac{1}{2}}$ 与一个激波传感器成正比。问题提出了一种基于离散熵残差的传感器，该残差衡量了在离散层面上局部违反熵守恒方程的程度。单元 $i$ 中的熵残差定义为\n$$\n\\mathcal{R}_{\\eta,i} = \\left|\\frac{q(u_{i+1}) - q(u_{i-1})}{2h}\\right|.\n$$\n该残差被归一化以创建一个缩放因子 $\\alpha_i \\in [0, 1]$：\n$$\n\\alpha_i = \\frac{\\mathcal{R}_{\\eta,i}}{\\max_j \\mathcal{R}_{\\eta,j} + \\varepsilon},\n$$\n其中 $\\varepsilon  0$ 是一个小的参数，用于防止在光滑区域出现除以零的情况。基于界面的指示器 $\\alpha_{i+\\frac{1}{2}}$ 取其相邻单元值的最大值，以确保耗散的模板足够宽：\n$$\n\\alpha_{i+\\frac{1}{2}} = \\max\\left(\\alpha_i, \\alpha_{i+1}\\right).\n$$\n最后，界面粘性定义为\n$$\n\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}}\\, h\\, \\alpha_{i+\\frac{1}{2}},\n$$\n其中 $C_{\\mathrm{av}} \\ge 0$ 是一个用户定义的常数，用于控制粘性的总量。\n\n**熵稳定性证明**\n\n我们必须证明该半离散格式满足单元层面上的离散熵不等式，求和后即可得到全局熵不等式 $\\frac{d}{dt}\\left(h \\sum_{i} \\eta(u_i)\\right) \\le 0$。总离散熵 $H = h \\sum_{i=0}^{N-1} \\eta(u_i)$ 的变化率为\n$$\n\\frac{dH}{dt} = \\frac{d}{dt} \\left(h \\sum_{i=0}^{N-1} \\eta(u_i)\\right) = h \\sum_{i=0}^{N-1} \\frac{d\\eta(u_i)}{dt}.\n$$\n使用链式法则，$\\frac{d\\eta(u_i)}{dt} = \\eta'(u_i) \\frac{du_i}{dt} = v_i \\frac{du_i}{dt}$，其中 $v_i = v(u_i)$。\n$$\n\\frac{dH}{dt} = h \\sum_{i=0}^{N-1} v_i \\frac{du_i}{dt}.\n$$\n代入有限体积格式 $\\frac{du_i}{dt} = -\\frac{1}{h}(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}})$：\n$$\n\\frac{dH}{dt} = - \\sum_{i=0}^{N-1} v_i \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right).\n$$\n对周期性域应用分部求和（边界项相互抵消）：\n$$\n\\sum_{i=0}^{N-1} v_i \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right) = \\sum_{i=0}^{N-1} (v_i - v_{i+1}) F_{i+\\frac{1}{2}}.\n$$\n因此，\n$$\n\\frac{dH}{dt} = - \\sum_{i=0}^{N-1} (v_i - v_{i+1}) F_{i+\\frac{1}{2}} = \\sum_{i=0}^{N-1} (v_{i+1} - v_i) F_{i+\\frac{1}{2}}.\n$$\n现在，我们代入完整的数值通量 $F_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i, u_{i+1}) + F^{\\mathrm{diss}}_{i+\\frac{1}{2}}$：\n$$\n\\frac{dH}{dt} = \\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{ec}}(u_i, u_{i+1}) + \\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{diss}}_{i+\\frac{1}{2}}.\n$$\n第一项涉及 EC 通量，由于 $F^{\\mathrm{ec}}$ 的定义性质，它是一个伸缩和：\n$$\n\\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{ec}}(u_i, u_{i+1}) = \\sum_{i=0}^{N-1} (\\psi(u_{i+1}) - \\psi(u_i)) = \\psi(u_N) - \\psi(u_0).\n$$\n在周期性边界条件下，$u_N = u_0$，这意味着 $\\psi(u_N) = \\psi(u_0)$，因此该和恰好为零。这证明了通量第一部分的“熵守恒”性质。\n\n第二项涉及耗散通量：\n$$\n\\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{diss}}_{i+\\frac{1}{2}} = \\sum_{i=0}^{N-1} (v_{i+1} - v_i) \\left( -\\frac{\\nu_{i+\\frac{1}{2}}}{h}(v_{i+1} - v_i) \\right) = -\\frac{1}{h} \\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2.\n$$\n问题指定 $C_{\\mathrm{av}} \\ge 0$, $h  0$ 和 $\\varepsilon  0$。粘性系数 $\\nu_{i+\\frac{1}{2}}$ 的构造确保了其非负性：\n$$\n\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}}\\, h\\, \\underbrace{\\max(\\alpha_i, \\alpha_{i+1})}_{\\ge 0} \\ge 0.\n$$\n由于 $\\nu_{i+\\frac{1}{2}} \\ge 0$ 且 $(v_{i+1} - v_i)^2 \\ge 0$，和中的每一项都是非负的。因此，整个和是非负的：\n$$\n\\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2 \\ge 0.\n$$\n结合因子 $-\\frac{1}{h}  0$，耗散通量的贡献是非正的：\n$$\n-\\frac{1}{h} \\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2 \\le 0.\n$$\n将两部分放在一起，我们得到：\n$$\n\\frac{dH}{dt} = 0 + \\left( -\\frac{1}{h} \\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2 \\right) \\le 0.\n$$\n这就完成了该半离散格式是熵稳定的证明。\n\n**人工粘性的校准**\n\n常数 $C_{\\mathrm{av}}$ 必须被校准以提供适当的粘性量。目标是添加足够的粘性以稳定格式并在期望数量的网格单元上捕捉激波，但又不能过多以至于过度抹平解的光滑特征。\n\n校准策略基于将数值粘性与粘性伯格斯方程 $u_t + (\\frac{1}{2}u^2)_x = \\nu u_{xx}$ 的解析行波解中的物理粘性进行匹配。该方程有一个稳态行波解，连接左状态 $u_L$ 和右状态 $u_R$（其中 $u_L  u_R$），由一个双曲正切剖面给出。该波的特征厚度 $L$ 由最大斜率的倒数定义，其尺度为 $L = \\frac{4\\nu}{\\Delta u}$，其中 $\\Delta u = u_L - u_R$。\n\n为了在大约 $M$ 个网格单元上解析激波，我们将目标厚度设为 $L = M h$。通过令两种 $L$ 的表达式相等，我们可以解出产生这种激波剖面所需的物理粘性 $\\nu$：\n$$\nMh = \\frac{4\\nu}{\\Delta u} \\implies \\nu = \\frac{1}{4} \\Delta u M h.\n$$\n这个值 $\\nu_{\\mathrm{target}} = \\frac{1}{4} \\Delta u M h$，成为我们在激波附近人工粘性系数 $\\nu_{i+\\frac{1}{2}}$ 的目标。\n\n数值粘性为 $\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}} h \\alpha_{i+\\frac{1}{2}}$。在一个尖锐且充分发展的激波中心，熵残差预计是最大的，导致 $\\alpha_{i+\\frac{1}{2}} \\approx 1$。假设在激波处 $\\max \\alpha_{i+\\frac{1}{2}} = 1$，数值粘性变为 $\\nu_{i+\\frac{1}{2}} \\approx C_{\\mathrm{av}} h$。我们令其等于目标粘性：\n$$\nC_{\\mathrm{av}} h = \\nu_{\\mathrm{target}} \\implies C_{\\mathrm{av}} = \\frac{\\nu_{\\mathrm{target}}}{h} = \\frac{1}{4} \\Delta u M.\n$$\n这提供了一种有原则的方法来根据期望的激波解析度 $M$ 和激波强度 $\\Delta u$ 来选择 $C_{\\mathrm{av}}$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running a suite of five tests on an entropy-stable\n    finite volume scheme for the inviscid Burgers' equation.\n    \"\"\"\n    \n    # Define entropy-related functions for Burgers' equation\n    def q(u):\n        \"\"\"Entropy flux for eta(u) = u^2/2.\"\"\"\n        return u**3 / 3.0\n\n    def v(u):\n        \"\"\"Entropy variable for eta(u) = u^2/2.\"\"\"\n        return u\n\n    def F_ec(uL, uR):\n        \"\"\"Entropy-conservative flux for Burgers' equation.\"\"\"\n        return (uL**2 + uL * uR + uR**2) / 6.0\n\n    results = []\n    \n    # A small constant for normalization to avoid division by zero.\n    epsilon = np.finfo(float).eps\n\n    # --- Test 1: Entropy conservation of EC flux ---\n    N1 = 64\n    h1 = 1.0 / N1\n    x1 = (np.arange(N1) + 0.5) * h1\n    u1 = 0.5 + 0.4 * np.sin(2 * np.pi * x1)\n\n    u1_p1 = np.roll(u1, -1)  # u_{i+1}\n    \n    # Calculate EC flux at i+1/2 interfaces\n    F_ec_half_p1 = F_ec(u1, u1_p1)\n    # Flux at i-1/2 is the rolled version of flux at i+1/2\n    F_ec_half_m1 = np.roll(F_ec_half_p1, 1)\n\n    dudt1 = -(F_ec_half_p1 - F_ec_half_m1) / h1\n    dHdt1 = h1 * np.sum(v(u1) * dudt1)\n    results.append(np.abs(dHdt1))\n\n    # --- Test 2: Entropy-stability with residual-based viscosity ---\n    N2 = 100\n    h2 = 1.0 / N2\n    x2 = (np.arange(N2) + 0.5) * h2\n    u2 = np.ones(N2)\n    u2[x2 >= 0.5] = 0.2\n\n    # Neighbors for residual calculation\n    u2_p1 = np.roll(u2, -1)  # u_{i+1}\n    u2_m1 = np.roll(u2, 1)   # u_{i-1}\n    \n    # 1. Discrete entropy residual\n    R_eta_i = np.abs((q(u2_p1) - q(u2_m1)) / (2.0 * h2))\n    \n    # 2. Normalized residual\n    max_R = np.max(R_eta_i)\n    alpha_i = R_eta_i / (max_R + epsilon)\n    \n    # 3. Face indicator\n    alpha_i_p1 = np.roll(alpha_i, -1)\n    alpha_half = np.maximum(alpha_i, alpha_i_p1)\n\n    # 4. Calibration constant\n    uL_2, uR_2, M2 = 1.0, 0.2, 4.0\n    delta_u2 = uL_2 - uR_2\n    nu_target2 = 0.25 * delta_u2 * M2 * h2\n    C_av2 = nu_target2 / h2 # = 0.25 * delta_u2 * M2\n    \n    # 5. Face viscosity\n    nu_half2 = C_av2 * h2 * alpha_half\n\n    # 6. Total numerical flux\n    F_ec_half2 = F_ec(u2, u2_p1)\n    F_diss_half2 = -nu_half2 / h2 * (v(u2_p1) - v(u2))\n    F_total_half2 = F_ec_half2 + F_diss_half2\n    \n    # 7. Entropy production rate\n    F_total_half_m2 = np.roll(F_total_half2, 1)\n    dudt2 = -(F_total_half2 - F_total_half_m2) / h2\n    dHdt2 = h2 * np.sum(v(u2) * dudt2)\n    \n    results.append(dHdt2 = 1e-13)\n\n    # --- Test 3: Target viscosity calculation ---\n    uL_3, uR_3, h3, M3 = 1.0, 0.2, 0.01, 4.0\n    delta_u3 = uL_3 - uR_3\n    nu_target3 = 0.25 * delta_u3 * M3 * h3\n    results.append(nu_target3)\n\n    # --- Test 4: Calibrated C_av calculation ---\n    C_av4 = nu_target3 / h3 # Using parameters from Test 3\n    results.append(C_av4)\n\n    # --- Test 5: Smoothness activation level ---\n    # Use sine wave from Test 1 and C_av from Test 4\n    u_p1_T5 = np.roll(u1, -1)\n    u_m1_T5 = np.roll(u1, 1)\n\n    R_eta_i_T5 = np.abs((q(u_p1_T5) - q(u_m1_T5)) / (2.0 * h1))\n    max_R_T5 = np.max(R_eta_i_T5)\n    \n    alpha_i_T5 = R_eta_i_T5 / (max_R_T5 + epsilon)\n    alpha_i_p1_T5 = np.roll(alpha_i_T5, -1)\n    alpha_half_T5 = np.maximum(alpha_i_T5, alpha_i_p1_T5)\n    \n    C_av5 = C_av4 # C_av from Test 4\n    nu_half5 = C_av5 * h1 * alpha_half_T5\n    \n    mean_nu5 = np.mean(nu_half5)\n    results.append(mean_nu5)\n    \n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3386455"}]}