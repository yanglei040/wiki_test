{"hands_on_practices": [{"introduction": "深入理解离散格式稳定性的来源是数值偏微分方程研究的核心。本练习将探讨在求解对流占优问题时，一个常见的难题——伪振荡（spurious oscillations）——如何与网格的几何特性直接相关。通过分析间断Galerkin（DG）方法，您将推导并实现一个仅基于几何学的判据，该判据揭示了著名的Delaunay条件如何成为保证数值解稳定性的关键 [@problem_id:3377002]。", "problem": "考虑在一个多边形域上具有常数系数的稳态二维对流扩散方程，\n$$\n- \\varepsilon \\nabla^2 u + \\boldsymbol{b} \\cdot \\nabla u = 0,\n$$\n其中在边界的流入部分指定了狄利克雷（Dirichlet）数据。假设采用不连续伽辽金（Discontinuous Galerkin, DG）格式，其中扩散项使用对称内部罚函数，对流项使用迎风数值通量，每个单元使用线性多项式阶数。令特征网格尺寸为 $h$，扩散系数为 $\\varepsilon$，恒定速度为 $\\boldsymbol{b}$，单元佩克莱数（Péclet number）定义为\n$$\nPe = \\frac{\\lVert \\boldsymbol{b} \\rVert h}{2 \\varepsilon},\n$$\n我们关注的情形是 $Pe \\gg 1$。\n\n从以下基本依据和核心定义出发：\n- 一个平面点集的德劳内（Delaunay）三角剖分是指这样一种三角剖分，其中每个三角形的开放外接圆内不包含该剖分中的任何顶点。等价地，对于共享一条内部边的两个三角形，局部德劳内准则规定，公共边所对的两个角之和最多为 $\\pi$。这与沃罗诺伊图（Voronoi diagrams）紧密相关，因为德劳内三角剖分是沃罗诺伊图的直线对偶，而局部德劳内条件等价于沃罗诺伊边位于相应原始边的垂直平分线段内。\n- 对于二维扩散的分段线性逼近，跨越一条内部边的两个节点之间基于边的刚度耦合的对称部分，与该边所对的两个角 $\\alpha$ 和 $\\beta$ 的余切之和成正比，即 $\\tfrac{1}{2}(\\cot \\alpha + \\cot \\beta)$。利用三角恒等式，\n$$\n\\cot \\alpha + \\cot \\beta = \\frac{\\sin(\\alpha + \\beta)}{\\sin \\alpha \\, \\sin \\beta},\n$$\n该耦合的符号由 $\\sin(\\alpha + \\beta)$ 决定。特别地，当且仅当 $\\alpha + \\beta \\le \\pi$（即局部德劳内条件）时，该耦合为非负。\n- 在具有内部罚函数的 DG 格式中，跨越内部边的对称内部一致性项再现了与连续分段线性扩散离散化相同的符号结构。迎风对流通量在离散算子矩阵中贡献了非正的非对角元。一个充分的边单调性条件（因此也是防止伪振荡的离散极值原理）是，全局矩阵中每条内部边对应的非对角元都是非正的。对于 $Pe \\gg 1$ 的情况，如果一条内部边几乎与 $\\boldsymbol{b}$ 相切（因此跨越该边的 $|\\boldsymbol{b} \\cdot \\boldsymbol{n}|$ 很小），那么对流项的贡献就太弱，无法抵消任何由扩散产生的正非对角元。因此，任何对局部德劳内条件的违反，即任何满足 $\\alpha + \\beta > \\pi$ 的内部边，都可能引发伪振荡。\n\n任务。您必须：\n- 从上述基础出发，推导一个在高佩克莱数情形下仅与几何相关的振荡起始阈值。您的推导必须表明，对于一条由两个三角形共享的内部边，其对角 $\\alpha$ 和 $\\beta$ 以弧度表示，当且仅当 $\\alpha + \\beta > \\pi$ 时，预计会发生伪振荡。\n- 实现一个完整的、可运行的程序，该程序给定一个由沿对角线分割四边形形成的平面双三角形网格构成的小型测试套件，为每个测试用例计算：\n  1. 对角线所对的角之和 $\\alpha + \\beta$（以弧度为单位）。\n  2. 一个布尔指示符，当且仅当 $\\alpha + \\beta > \\pi$（预测有振荡）时为真，否则（无振荡）为假。\n- 您必须始终使用弧度作为角度单位。您的输出中不需要除弧度以外的任何物理单位。\n\n测试套件。使用以下五个案例，每个案例由四个点和一条选定的对角线定义，该对角线将其分割成两个三角形。在每个案例中，内部边是连接所列第一和第三个点的对角线。点以笛卡尔坐标给出：\n- 案例 1：$\\left(0,0\\right)$、$\\left(1,0\\right)$、$\\left(1,1\\right)$、$\\left(0,1\\right)$；对角线连接 $\\left(0,0\\right)$ 和 $\\left(1,1\\right)$。\n- 案例 2：$\\left(0,0\\right)$、$\\left(0.6,0.58\\right)$、$\\left(1,1\\right)$、$\\left(0.4,0.44\\right)$；对角线连接 $\\left(0,0\\right)$ 和 $\\left(1,1\\right)$。\n- 案例 3：$\\left(0,0\\right)$、$\\left(1,0.2\\right)$、$\\left(1,1\\right)$、$\\left(0.2,1\\right)$；对角线连接 $\\left(0,0\\right)$ 和 $\\left(1,1\\right)$。\n- 案例 4：$\\left(0,0\\right)$、$\\left(0.51,0.49\\right)$、$\\left(1,1\\right)$、$\\left(0.49,0.51\\right)$；对角线连接 $\\left(0,0\\right)$ 和 $\\left(1,1\\right)$。\n- 案例 5：$\\left(0,0\\right)$、$\\left(0.75,0.70\\right)$、$\\left(1,1\\right)$、$\\left(0.25,0.30\\right)$；对角线连接 $\\left(0,0\\right)$ 和 $\\left(1,1\\right)$。\n\n对于每个测试，将这四个点解释为定义了两个共享对角线 $\\overline{p_0 p_2}$ 的三角形 $\\triangle \\left(p_0,p_1,p_2\\right)$ 和 $\\triangle \\left(p_0,p_3,p_2\\right)$。两个对角分别位于顶点 $p_1$ 和 $p_3$；计算它们的和 $\\alpha + \\beta$（以弧度为单位）。然后评估上面定义的布尔预测振荡指示符。\n\n最终输出格式。您的程序应生成单行输出，其中包含五个案例的布尔结果，格式为用方括号括起来的逗号分隔列表，例如 $\\left[\\mathrm{False},\\mathrm{True},\\ldots\\right]$。", "solution": "任务是为稳态对流扩散方程的不连续伽辽金（DG）数值格式推导一个仅与几何相关的伪振荡起始阈值，然后实现一个程序将此阈值应用于一组测试用例。分析是在高佩克莱数（$Pe \\gg 1$）情形下进行的，此时对流占主导地位。\n\n控制方程为 $- \\varepsilon \\nabla^2 u + \\boldsymbol{b} \\cdot \\nabla u = 0$。数值解没有伪振荡的一个充分条件是它满足离散极值原理。如果全局系统矩阵（我们称之为 $A$）是一个 M-矩阵，这通常可以得到保证，M-矩阵要求其所有非对角元都是非正的。\n\n矩阵 $A$ 来自 DG 离散化。对于网格中两个单元（三角形）共享的任何内部边，矩阵 $A$ 中耦合该边两侧自由度的非对角元是扩散项贡献 $A_D$ 和对流项贡献 $A_C$ 的和。我们必须分析总的非对角元 $A_{ij} = (A_D)_{ij} + (A_C)_{ij}$ 的符号。\n\n1.  **扩散项的贡献（$A_D$）**：题目对扩散项 $- \\varepsilon \\nabla^2 u$ 使用对称内部罚函数伽辽金（SIPG）方法。题目陈述断言，所得矩阵元的符号结构与标准的连续分段线性有限元方法相同。对于算子 $-\\nabla^2 u$，与两个三角形共享的一条边相对应的非对角刚度矩阵元与 $-(\\cot \\alpha + \\cot \\beta)$ 成正比，其中 $\\alpha$ 和 $\\beta$ 是该公共边所对的角。扩散系数 $\\varepsilon$ 是一个正的缩放因子。因此，扩散项贡献的符号就是 $-(\\cot \\alpha + \\cot \\beta)$ 的符号。\n\n    利用三角恒等式 $\\cot \\alpha + \\cot \\beta = \\frac{\\sin(\\alpha + \\beta)}{\\sin \\alpha \\sin \\beta}$，由于 $\\alpha, \\beta \\in (0, \\pi)$ 意味着 $\\sin\\alpha > 0$ 和 $\\sin\\beta > 0$，扩散贡献的符号变为 $-\\sin(\\alpha + \\beta)$ 的符号。\n    -   如果局部德劳内条件 $\\alpha + \\beta \\le \\pi$ 成立，那么 $\\sin(\\alpha + \\beta) \\ge 0$，这使得扩散贡献 $(A_D)_{ij}$ 为非正。这是一个稳定项。\n    -   如果违反了局部德劳内条件，即 $\\alpha + \\beta > \\pi$，那么 $\\sin(\\alpha + \\beta)  0$，这使得扩散贡献 $(A_D)_{ij}$ 为正。正的非对角元违反了 M-矩阵条件，可能导致不稳定性。\n\n2.  **对流项的贡献（$A_C$）**：对流项 $\\boldsymbol{b} \\cdot \\nabla u$ 使用迎风数值通量进行离散化。如题目所述，这种选择是稳定的，并为系统矩阵的非对角线贡献非正元，即 $(A_C)_{ij} \\le 0$。\n\n3.  **总非对角元与高佩克莱数分析**：总非对角元为 $A_{ij} = (A_D)_{ij} + (A_C)_{ij}$。\n    -   如果 $\\alpha + \\beta \\le \\pi$（德劳内边），那么 $(A_D)_{ij} \\le 0$ 且 $(A_C)_{ij} \\le 0$，所以 $A_{ij} \\le 0$。该边满足 M-矩阵条件，预计不会产生源于此边的振荡。\n    -   如果 $\\alpha + \\beta > \\pi$（非德劳内边），那么 $(A_D)_{ij} > 0$。$A_{ij}$ 的整体符号现在取决于正的扩散项和负的对流项之间的竞争。M-矩阵条件仅在 $|(A_C)_{ij}| \\ge (A_D)_{ij}$ 时成立。\n\n    对于高佩克莱数情形（$Pe \\gg 1$）的关键见解已在题目陈述中给出。跨越单位法向量为 $\\boldsymbol{n}_e$ 的边 $e$ 的稳定化迎风通量的大小，取决于量 $|\\boldsymbol{b} \\cdot \\boldsymbol{n}_e|$。如果流向 $\\boldsymbol{b}$ 几乎与边 $e$ 相切，那么 $\\boldsymbol{b}$ 就几乎与 $\\boldsymbol{n}_e$ 正交，因此 $|\\boldsymbol{b} \\cdot \\boldsymbol{n}_e|$ 变得非常小。在这种情况下，稳定化贡献 $(A_C)_{ij}$ 可以变得任意弱，而与 $\\lVert\\boldsymbol{b}\\rVert$ 的大小或 $\\varepsilon$ 的小量无关。\n\n    由于恒定速度 $\\boldsymbol{b}$ 相对于网格的方向是任意的，一个鲁棒的格式应该对任何 $\\boldsymbol{b}$ 都稳定。如果网格中包含一条满足 $\\alpha + \\beta > \\pi$ 的边，总可以选取一个几乎与该边平行的流向 $\\boldsymbol{b}$。对于这样的流动，稳定化的迎风项消失，非对角元的符号由正的扩散项主导：$A_{ij} \\approx (A_D)_{ij} > 0$。这种对 M-矩阵条件的违反是引发伪振荡的众所周知的触发因素。\n\n    因此，振荡的可能性从根本上与网格几何形状本身相关。纯粹的几何条件 $\\alpha + \\beta > \\pi$ 是预测高佩克莱数极限下振荡起始的充分判据，因为它表明存在一个会引发不稳定性的“最坏情况”流向。\n\n计算任务是为每个给定的网格配置计算角度和 $\\alpha + \\beta$，并检查其是否超过 $\\pi$。这些角是在共享对角线所对的顶点处计算的。对于顶点为 $P_1, P_2, P_3$ 的三角形，顶点 $P_2$ 处的角 $\\theta$ 可以使用向量 $\\vec{v}_{21} = P_1 - P_2$ 和 $\\vec{v}_{23} = P_3 - P_2$ 的点积公式计算：\n$$\n\\theta = \\arccos\\left( \\frac{\\vec{v}_{21} \\cdot \\vec{v}_{23}}{\\lVert\\vec{v}_{21}\\rVert \\lVert\\vec{v}_{23}\\rVert} \\right)\n$$\n程序将为每个测试用例实现这一计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by analyzing the geometry of five two-triangle meshes.\n    For each mesh, it computes the sum of the angles opposite the common\n    diagonal and determines if this sum exceeds pi, which is the criterion\n    for predicting numerical oscillations in a high-Peclet number regime.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case has four points p0, p1, p2, p3. The triangles are\n    # (p0, p1, p2) and (p0, p3, p2), sharing the diagonal p0-p2.\n    # The angles of interest, alpha and beta, are at p1 and p3 respectively.\n    test_cases = [\n        # Case 1: Square, Delaunay diagonal.\n        {'p0':_p([0,0]), 'p1':_p([1,0]), 'p2':_p([1,1]), 'p3':_p([0,1])},\n        # Case 2: Convex quad, non-Delaunay diagonal.\n        {'p0':_p([0,0]), 'p1':_p([0.6,0.58]), 'p2':_p([1,1]), 'p3':_p([0.4,0.44])},\n        # Case 3: Concave quad, non-Delaunay diagonal.\n        {'p0':_p([0,0]), 'p1':_p([1,0.2]), 'p2':_p([1,1]), 'p3':_p([0.2,1])},\n        # Case 4: Sliver quad, highly non-Delaunay.\n        {'p0':_p([0,0]), 'p1':_p([0.51,0.49]), 'p2':_p([1,1]), 'p3':_p([0.49,0.51])},\n        # Case 5: Convex quad, non-Delaunay.\n        {'p0':_p([0,0]), 'p1':_p([0.75,0.70]), 'p2':_p([1,1]), 'p3':_p([0.25,0.30])},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p0, p1, p2, p3 = case['p0'], case['p1'], case['p2'], case['p3']\n        \n        # Calculate angle alpha at p1 for triangle (p0, p1, p2).\n        alpha = _calculate_angle(p0, p1, p2)\n        \n        # Calculate angle beta at p3 for triangle (p0, p3, p2).\n        beta = _calculate_angle(p0, p3, p2)\n        \n        angle_sum = alpha + beta\n        \n        # The geometry-only threshold for predicted oscillations is alpha + beta > pi.\n        # This corresponds to the diagonal violating the local Delaunay condition.\n        oscillation_predicted = angle_sum > np.pi\n        \n        results.append(oscillation_predicted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _p(coords):\n    \"\"\"Helper function to create a numpy array from coordinates.\"\"\"\n    return np.array(coords, dtype=np.float64)\n\ndef _calculate_angle(pA, pB, pC):\n    \"\"\"\n    Calculates the angle at vertex pB in triangle pA-pB-pC in radians.\n    \n    Args:\n        pA, pB, pC: Numpy arrays representing the coordinates of the vertices.\n        \n    Returns:\n        The angle at pB in radians.\n    \"\"\"\n    # Vectors from pB to pA and pC\n    vec_BA = pA - pB\n    vec_BC = pC - pB\n    \n    # Dot product of the two vectors\n    dot_product = np.dot(vec_BA, vec_BC)\n    \n    # Product of the magnitudes (norms) of the vectors\n    norm_product = np.linalg.norm(vec_BA) * np.linalg.norm(vec_BC)\n    \n    # To prevent domain errors with arccos due to floating point inaccuracies,\n    # clip the value to be within [-1.0, 1.0].\n    cosine_of_angle = np.clip(dot_product / norm_product, -1.0, 1.0)\n    \n    # Calculate the angle using arccos gives the result in radians\n    angle_rad = np.arccos(cosine_of_angle)\n    \n    return angle_rad\n\nsolve()\n```", "id": "3377002"}, {"introduction": "在确保了数值格式的稳定性之后，我们自然地转向下一个核心议题：精度。本练习聚焦于经典的有限元方法（FEM），并深入探讨其关键步骤——使用数值积分（quadrature）组装刚度矩阵和质量矩阵。您将分析积分公式的精度要求如何依赖于基函数的阶数，并量化计算当网格单元变形时（即便是Delaunay网格也无法完全避免的几何畸变）是如何影响积分误差的 [@problem_id:3377010]。", "problem": "您正在使用次数为 $k \\in \\{1,2\\}$ 的Lagrange元，为一个定义在多边形域 $\\Omega \\subset \\mathbb{R}^{2}$ 上的标量扩散偏微分方程 (PDE) $-\\nabla \\cdot (\\kappa \\nabla u) = f$ 组装有限元矩阵。计算网格是一个Delaunay三角剖分，由一个对所有三角形强制保证最小内角 $\\alpha_{0} \\in (0,\\pi/3]$ 的加密算法生成。假设系数 $\\kappa0$ 为常数，且所有单元映射均为仿射映射。对于张成Lagrange空间的形函数 $\\{\\phi_{i}\\}$，局部质量矩阵定义为 $M_{ij}^{(T)} = \\int_{T} \\phi_{i} \\phi_{j} \\,\\mathrm{d}x$，局部刚度矩阵定义为 $K_{ij}^{(T)} = \\int_{T} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\,\\mathrm{d}x$。\n\n(a) 部分：如果一个三角形求积法则能在任意三角形上精确地积分所有总次数不超过 $q$ 的多项式，则称该法则的精确次数达到 $q$。请仅使用Lagrange基函数和仿射映射的基本性质，确定当使用多项式次数 $k=1$ 和 $k=2$ 时，为保证在任意三角形 $T$ 上精确计算 $M_{ij}^{(T)}$ 和 $K_{ij}^{(T)}$ 所需的最小多项式精确次数 $q$。\n\n(b) 部分：为量化在使用降阶积分时单元扭曲对求积误差的影响，考虑一个单参数仿射三角形族 $T_{s}$。该族三角形是通过线性映射 $A_{s} = \\mathrm{diag}(s,1)$（其中 $s \\ge 1$）映射参考三角形 $\\widehat{T} = \\{(\\xi,\\eta) \\in \\mathbb{R}^{2} : \\xi \\ge 0,\\, \\eta \\ge 0,\\, \\xi + \\eta \\le 1\\}$ 得到的，即 $(x,y) = A_{s}(\\xi,\\eta)^{\\top}$。在 $\\widehat{T}$ 上，考虑二次Lagrange边基函数 $\\widehat{\\phi}_{23}(\\xi,\\eta) = 4 \\lambda_{2} \\lambda_{3} = 4 \\xi \\eta$，其中 $\\lambda_{2}(\\xi,\\eta) = \\xi$ 和 $\\lambda_{3}(\\xi,\\eta) = \\eta$ 是重心坐标。令 $\\phi_{23}$ 为其在 $T_{s}$ 上的对应函数。\n\n定义局部刚度项 $a_{23,23}(s) := \\int_{T_{s}} \\nabla \\phi_{23} \\cdot \\nabla \\phi_{23} \\,\\mathrm{d}x$。使用 $T_s$ 上的单点形心求积法则来近似此积分，该法则对次数最高为1的多项式是精确的。请以 $s$ 的解析表达式形式，推导出求积误差的闭式解\n$$\nE(s) \\;:=\\; a_{23,23}(s) \\;-\\; \\Big(\\text{area}(T_{s})\\Big)\\, \\Big(\\nabla \\phi_{23} \\cdot \\nabla \\phi_{23}\\Big)\\Big|_{\\text{centroid of }T_{s}},\n$$\n。\n\n将您的最终答案表示为一个行矩阵 $\\big[q_{\\mathrm{mass}}^{(1)},\\, q_{\\mathrm{stiff}}^{(1)},\\, q_{\\mathrm{mass}}^{(2)},\\, q_{\\mathrm{stiff}}^{(2)},\\, E(s)\\big]$，其中 $q_{\\mathrm{mass}}^{(k)}$ 和 $q_{\\mathrm{stiff}}^{(k)}$ 分别表示多项式次数为 $k$ 时质量矩阵和刚度矩阵的最小精确次数。无需单位。不要对 $E(s)$ 进行数值简化。最终答案必须是指定的单个行矩阵。", "solution": "该问题经验证具有科学依据、是适定的且客观的。这是有限元方法理论中的一个标准问题。\n\n### (a)部分：最小求积精确次数\n\n目标是找到一个求积法则所需的最小多项式精确次数 $q$，以便对次数为 $k$ 的Lagrange元精确计算局部质量矩阵和刚度矩阵。单元映射是仿射的，这意味着参考单元上的多项式基函数会被映射为任意物理单元 $T$ 上相同次数的多项式基函数。\n\n设 $\\{\\phi_i\\}$ 为单元 $T$ 上的Lagrange基函数集。对于次数为 $k$ 的元，每个 $\\phi_i$ 都是一个总次数不超过 $k$ 的多项式。\n\n**局部质量矩阵 ($M^{(T)}$):**\n局部质量矩阵的项由 $M_{ij}^{(T)} = \\int_{T} \\phi_{i} \\phi_{j} \\,\\mathrm{d}x$ 给出。被积函数是两个基函数 $\\phi_i \\phi_j$ 的乘积。由于 $\\phi_i$ 和 $\\phi_j$ 是次数最高为 $k$ 的多项式，它们的乘积是一个次数最高为 $k+k=2k$ 的多项式。因此，要精确计算该积分，求积法则必须对总次数最高为 $2k$ 的多项式精确。所需的最小精确次数为 $q_{\\mathrm{mass}}^{(k)} = 2k$。\n\n对于线性元 ($k=1$)：\n$q_{\\mathrm{mass}}^{(1)} = 2(1) = 2$。\n\n对于二次单元 ($k=2$)：\n$q_{\\mathrm{mass}}^{(2)} = 2(2) = 4$。\n\n**局部刚度矩阵 ($K^{(T)}$):**\n局部刚度矩阵的项由 $K_{ij}^{(T)} = \\int_{T} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\,\\mathrm{d}x$ 给出。被积函数是 $\\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} = \\frac{\\partial \\phi_i}{\\partial x}\\frac{\\partial \\phi_j}{\\partial x} + \\frac{\\partial \\phi_i}{\\partial y}\\frac{\\partial \\phi_j}{\\partial y}$。如果 $\\phi_i$ 是一个次数最高为 $k$ 的多项式，其一阶偏导数 $\\frac{\\partial \\phi_i}{\\partial x}$ 和 $\\frac{\\partial \\phi_i}{\\partial y}$ 是次数最高为 $k-1$ 的多项式。任意两个此类偏导数的乘积，例如 $\\frac{\\partial \\phi_i}{\\partial x}\\frac{\\partial \\phi_j}{\\partial x}$，是一个次数最高为 $(k-1) + (k-1) = 2k-2$ 的多项式。整个被积函数是这类乘积的和，因此是一个次数最高为 $2k-2$ 的多项式。要精确计算此积分，求积法则必须对次数最高为 $2k-2$ 的多项式精确。所需的最小精确次数为 $q_{\\mathrm{stiff}}^{(k)} = 2k-2$。\n\n对于线性元 ($k=1$)：\n$q_{\\mathrm{stiff}}^{(1)} = 2(1) - 2 = 0$。被积函数是一个常数，因此一个对0次多项式（即常数）精确的法则是足够的。\n\n对于二次单元 ($k=2$)：\n$q_{\\mathrm{stiff}}^{(2)} = 2(2) - 2 = 2$。\n\n### (b)部分：求积误差计算\n\n我们需要计算在一个三角形族 $T_s$ 上特定刚度矩阵项的误差 $E(s)$。\n\n**1. 几何与函数设置**\n从参考单元 $\\widehat{T}$ 到物理单元 $T_s$ 的映射由仿射变换 $F(\\xi, \\eta) = (x, y)^{\\top}$ 给出，其中 $x = s\\xi$ 且 $y = \\eta$。该映射的雅可比矩阵是\n$$J_F = \\begin{pmatrix} s  0 \\\\ 0  1 \\end{pmatrix},$$\n其行列式是 $|\\det(J_F)| = s$。\n物理三角形 $T_s$ 的面积是 $\\text{area}(T_s) = \\int_{\\widehat{T}} |\\det(J_F)| \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = s \\cdot \\text{area}(\\widehat{T}) = s \\cdot \\frac{1}{2} = \\frac{s}{2}$。\n参考基函数是 $\\widehat{\\phi}_{23}(\\xi, \\eta) = 4\\xi\\eta$。物理基函数是 $\\phi_{23}(x,y) = \\widehat{\\phi}_{23}(F^{-1}(x,y))$。逆映射是 $F^{-1}(x,y) = (\\xi, \\eta)^{\\top} = (x/s, y)^{\\top}$，所以 $\\phi_{23}(x,y) = 4(x/s)y = \\frac{4}{s}xy$。\n\n**2. 精确积分计算**\n刚度项为 $a_{23,23}(s) = \\int_{T_s} \\nabla\\phi_{23} \\cdot \\nabla\\phi_{23} \\, \\mathrm{d}x$。我们通过变量代换到参考单元 $\\widehat{T}$ 来执行此积分。\n物理梯度 $\\nabla_x \\phi_{23}$ 与参考梯度 $\\nabla_\\xi \\widehat{\\phi}_{23}$ 的关系为 $\\nabla_x \\phi_{23} = (J_F^{-T}) \\nabla_\\xi \\widehat{\\phi}_{23}$。\n首先，我们求参考梯度：\n$$\\nabla_\\xi \\widehat{\\phi}_{23} = \\left(\\frac{\\partial}{\\partial\\xi}(4\\xi\\eta), \\frac{\\partial}{\\partial\\eta}(4\\xi\\eta)\\right)^{\\top} = (4\\eta, 4\\xi)^{\\top}。$$\n雅可比矩阵的逆转置是 $J_F^{-T} = (J_F^{-1})^T = \\begin{pmatrix} 1/s  0 \\\\ 0  1 \\end{pmatrix}^T = \\begin{pmatrix} 1/s  0 \\\\ 0  1 \\end{pmatrix}$。\n所以，用参考坐标表示的物理梯度是：\n$$\\nabla_x \\phi_{23} = \\begin{pmatrix} 1/s  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 4\\eta \\\\ 4\\xi \\end{pmatrix} = \\begin{pmatrix} 4\\eta/s \\\\ 4\\xi \\end{pmatrix}。$$\n被积函数是点积：\n$$\\nabla\\phi_{23} \\cdot \\nabla\\phi_{23} = \\left(\\frac{4\\eta}{s}\\right)^2 + (4\\xi)^2 = \\frac{16\\eta^2}{s^2} + 16\\xi^2。$$\n积分为：\n$$a_{23,23}(s) = \\int_{\\widehat{T}} \\left(\\frac{16\\eta^2}{s^2} + 16\\xi^2\\right) |\\det(J_F)| \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = s \\int_{\\widehat{T}} \\left(\\frac{16\\eta^2}{s^2} + 16\\xi^2\\right) \\mathrm{d}\\xi\\mathrm{d}\\eta。$$\n$$a_{23,23}(s) = \\frac{16}{s} \\int_{\\widehat{T}} \\eta^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta + 16s \\int_{\\widehat{T}} \\xi^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta。$$\n使用单位参考三角形上的标准积分公式 $\\int_{\\widehat{T}} \\xi^a \\eta^b \\,d\\xi d\\eta = \\frac{a!b!}{(a+b+2)!}$：\n$$\\int_{\\widehat{T}} \\eta^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = \\frac{0!2!}{(0+2+2)!} = \\frac{2}{24} = \\frac{1}{12}。$$\n$$\\int_{\\widehat{T}} \\xi^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = \\frac{2!0!}{(2+0+2)!} = \\frac{2}{24} = \\frac{1}{12}。$$\n代入这些值：\n$$a_{23,23}(s) = \\frac{16}{s} \\left(\\frac{1}{12}\\right) + 16s \\left(\\frac{1}{12}\\right) = \\frac{4}{3s} + \\frac{4s}{3}。$$\n\n**3. 近似积分计算**\n单点形心求积法则将积分近似为 $Q(g) = \\text{area}(T_s) \\cdot g(x_c, y_c)$，其中 $(x_c, y_c)$ 是 $T_s$ 的形心。\n$T_s$ 的顶点是 $(0,0)$、$(s,0)$ 和 $(0,1)$。形心是顶点坐标的平均值：\n$$(x_c, y_c) = \\left(\\frac{0+s+0}{3}, \\frac{0+0+1}{3}\\right) = \\left(\\frac{s}{3}, \\frac{1}{3}\\right)。$$\n在物理坐标系下的被积函数是 $\\nabla\\phi_{23} \\cdot \\nabla\\phi_{23} = (\\frac{\\partial}{\\partial x}(\\frac{4xy}{s}))^2 + (\\frac{\\partial}{\\partial y}(\\frac{4xy}{s}))^2 = (\\frac{4y}{s})^2 + (\\frac{4x}{s})^2 = \\frac{16}{s^2}(y^2+x^2)$。\n在形心处计算被积函数的值：\n$$\\left.\\left(\\nabla\\phi_{23} \\cdot \\nabla\\phi_{23}\\right)\\right|_{(s/3, 1/3)} = \\frac{16}{s^2}\\left(\\left(\\frac{1}{3}\\right)^2 + \\left(\\frac{s}{3}\\right)^2\\right) = \\frac{16}{s^2}\\left(\\frac{1}{9} + \\frac{s^2}{9}\\right) = \\frac{16(1+s^2)}{9s^2}。$$\n近似积分为：\n$$Q_s = \\text{area}(T_s) \\cdot \\frac{16(1+s^2)}{9s^2} = \\frac{s}{2} \\cdot \\frac{16(1+s^2)}{9s^2} = \\frac{8(1+s^2)}{9s} = \\frac{8}{9s} + \\frac{8s}{9}。$$\n\n**4. 求积误差**\n误差是精确值减去近似值：\n$$E(s) = a_{23,23}(s) - Q_s = \\left(\\frac{4}{3s} + \\frac{4s}{3}\\right) - \\left(\\frac{8}{9s} + \\frac{8s}{9}\\right)。$$\n$$E(s) = \\left(\\frac{4s}{3} - \\frac{8s}{9}\\right) + \\left(\\frac{4}{3s} - \\frac{8}{9s}\\right) = \\left(\\frac{12s - 8s}{9}\\right) + \\left(\\frac{12 - 8}{9s}\\right) = \\frac{4s}{9} + \\frac{4}{9s}。$$\n\n**结果总结**\n所需的值为：\n- $q_{\\mathrm{mass}}^{(1)} = 2$\n- $q_{\\mathrm{stiff}}^{(1)} = 0$\n- $q_{\\mathrm{mass}}^{(2)} = 4$\n- $q_{\\mathrm{stiff}}^{(2)} = 2$\n- $E(s) = \\frac{4s}{9} + \\frac{4}{9s}$\n\n将这些组合成一个单一的行矩阵作为最终答案。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2   0  4  2  \\frac{4s}{9} + \\frac{4}{9s}\n\\end{pmatrix}\n}\n$$", "id": "3377010"}, {"introduction": "Delaunay三角剖分的对偶结构——Voronoi图——为有限体积法（FVM）提供了天然的离散框架。由于Voronoi单元的边界与Delaunay三角剖分的边正交，通量计算得以简化，形成了简洁的“两点通量格式”。本练习将带您处理FVM实现中的一个关键实践环节：边界条件的处理，您将设计一种“虚拟单元”（ghost-cell）策略来施加Dirichlet和Neumann边界条件，并分析其对离散格式相容性（consistency）的影响 [@problem_id:3376977]。", "problem": "考虑定义在光滑有界域 $\\Omega \\subset \\mathbb{R}^{2}$（边界为 $\\partial \\Omega$）上的稳态各向同性扩散偏微分方程 (PDE) $-\\nabla \\cdot (k \\nabla u) = f$，其中 $k  0$ 为常数扩散系数，且 $u$ 足够光滑。通过对点集 $\\{\\boldsymbol{x}_{i}\\}$ 进行Delaunay三角剖分 (DT) 来离散化 $\\Omega$，并为有限体积法 (FVM) 构建相关的Voronoi图控制体积 $\\{V_{i}\\}$。假设Voronoi面上的通量为标准的二点格式：对于由单元 $i$ 和 $j$ 共享的一个面，扩散通量近似为 $F_{ij} = -|\\Gamma_{ij}|\\, k \\,\\frac{u_{j} - u_{i}}{d_{ij}}$，其中 $|\\Gamma_{ij}|$ 是面的长度，$d_{ij}$ 是沿垂直于该面的直线方向上 $\\boldsymbol{x}_{i}$ 和 $\\boldsymbol{x}_{j}$ 之间的距离。\n\n关注邻接 $\\partial \\Omega$ 的一个局部平直部分的单个控制体积 $V_{i}$，该部分具有单位外法向量 $\\boldsymbol{n}$ 和边界面的形心 $\\boldsymbol{x}_{\\Gamma} \\in \\partial \\Omega$。设生成点 $\\boldsymbol{x}_{i}$ 位于一个有向距离 $d_{i} = h  0$ 处，该距离是沿内法线方向 $-\\boldsymbol{n}$ 从点 $\\boldsymbol{x}_{\\Gamma}$ 处的切线算起；并设与 $V_i$ 相关的边界Voronoi面长度为 $|\\Gamma|$。\n\n为了在此边界面上以二点通量形式施加边界条件，引入一个单一的虚单元，其虚生成点为 $\\boldsymbol{x}_{g}$，位于沿外法线方向 $+\\boldsymbol{n}$ 距 $\\boldsymbol{x}_{\\Gamma}$ 有向距离为 $d_{g}$ 的位置，并使用边界通量\n$$\nF_{i\\partial} \\;=\\; -|\\Gamma|\\, k \\,\\frac{u_{g} - u_{i}}{d_{i} + d_{g}},\n$$\n其中 $u_{g}$ 是未知的虚值。为确保与Voronoi正交性的几何一致性，假设 $d_{g} = h$（关于边界的对称反射）。考虑在 $\\boldsymbol{x}_{\\Gamma}$ 处的两种边界条件类型：\n- Dirichlet条件：$u(\\boldsymbol{x}_{\\Gamma}) = u_{b}$，其中 $u_{b}$ 已知；\n- Neumann条件：$\\partial_{n} u(\\boldsymbol{x}_{\\Gamma}) = g_{n}$，其中法向导数 $g_{n}$ 已知。\n\n从控制体积守恒定律和散度定理出发，并使用沿法向坐标 $s$ 的泰勒展开（其中 $s=0$ 位于 $\\boldsymbol{x}_{\\Gamma}$ 处，$s0$ 指向内法线方向 $-\\boldsymbol{n}$），执行以下操作：\n1. 为每种边界条件类型构建一个虚单元策略 $u_{g}$，该策略保证对所有线性函数 $u(s)$ 精确，并保证在 $V_{i}$ 的离散平衡中边界面通量 $F_{i\\partial}$ 的守恒性。\n2. 通过推导展开式\n$$\nF_{i\\partial}^{\\text{disc}} \\;-\\; F_{i\\partial}^{\\text{exact}} \\;=\\; \\mathcal{C}\\, h \\;+\\; \\mathcal{O}\\!\\left(h^{2}\\right),\n$$\n中的系数 $\\mathcal{C}$，来量化边界面通量的主阶相容性误差。此操作需对每种边界条件类型，在 $h \\to 0$ 时进行。用 $|\\Gamma|$、$k$ 以及在 $\\boldsymbol{x}_{\\Gamma}$ 处计算的 $u$ 的法向导数来表示 $\\mathcal{C}$。\n\n将分别对应Dirichlet和Neumann边界条件的四个量 $\\big(u_{g}^{D},\\, \\mathcal{C}^{D},\\, u_{g}^{N},\\, \\mathcal{C}^{N}\\big)$，以单个闭式解析表达式的形式报告。无需进行数值代入。", "solution": "问题陈述已经过验证，被认为是有效的。它在偏微分方程数值分析领域具有科学依据，是适定的，并使用了客观、正式的语言。不存在矛盾、信息缺失或不成立的前提。我们可以开始求解。\n\n问题要求推导在Dirichlet和Neumann两种条件下，边界上一个有限体积通量近似的虚单元值以及主阶相容性误差。\n\n让我们建立一个垂直于边界的一维坐标系。问题定义了一个坐标 $s$，表示从边界切线算起的有向距离，在边界点 $\\boldsymbol{x}_{\\Gamma}$ 处 $s=0$，且 $s0$ 指向区域 $\\Omega$ 内部（沿内法线方向 $-\\boldsymbol{n}$）。\n内部节点 $\\boldsymbol{x}_i$ 位于 $s = d_i = h$。\n虚节点 $\\boldsymbol{x}_g$ 位于沿外法线 $+\\boldsymbol{n}$ 距离为 $d_g = h$ 的位置，这对应于 $s = -h$。\n解 $u$ 在内部节点的值为 $u_i = u(s=h)$。在边界上的值为 $u(s=0)$。虚值为 $u_g$。\n\n通过边界面 $\\Gamma$ 流出区域的精确通量由通量向量 $\\boldsymbol{q} = -k\\nabla u$ 的法向分量的积分给出。\n$$\nF_{i\\partial}^{\\text{exact}} = \\int_{\\Gamma} \\boldsymbol{q} \\cdot \\boldsymbol{n} \\, d\\Gamma = \\int_{\\Gamma} (-k \\nabla u) \\cdot \\boldsymbol{n} \\, d\\Gamma = \\int_{\\Gamma} -k \\, \\partial_n u \\, d\\Gamma\n$$\n其中 $\\partial_n u = \\nabla u \\cdot \\boldsymbol{n}$ 是沿外法线 $\\boldsymbol{n}$ 方向的导数。\n由于坐标 $s$ 沿 $-\\boldsymbol{n}$ 方向，我们有关系式 $\\frac{d}{ds} = -\\frac{d}{dn}$，或 $\\partial_n u = -\\frac{du}{ds}$。\n将此代入通量定义中：\n$$\nF_{i\\partial}^{\\text{exact}} = \\int_{\\Gamma} -k \\left(-\\frac{du}{ds}\\right) \\, d\\Gamma = \\int_{\\Gamma} k \\frac{du}{ds} \\, d\\Gamma\n$$\n对于一个长度为 $|\\Gamma|$ 的小面，我们可以将其近似为：\n$$\nF_{i\\partial}^{\\text{exact}} \\approx |\\Gamma|\\, k \\,\\frac{du}{ds}\\bigg|_{s=0}\n$$\n流出控制体积 $V_i$ 并通过边界面的离散通量由下式给出：\n$$\nF_{i\\partial}^{\\text{disc}} = -|\\Gamma|\\, k \\,\\frac{u_{g} - u_{i}}{d_{i} + d_{g}} = -|\\Gamma|\\, k \\,\\frac{u_{g} - u_{i}}{2h} = |\\Gamma|\\, k \\,\\frac{u_{i} - u_{g}}{2h}\n$$\n我们对 $u(s)$ 在 $s=0$ 附近进行泰勒级数展开：\n$$\nu(s) = u(0) + s \\frac{du}{ds}\\bigg|_{0} + \\frac{s^2}{2!} \\frac{d^2u}{ds^2}\\bigg|_{0} + \\mathcal{O}(s^3)\n$$\n使用简写 $u_0 = u(0)$, $u'_0 = \\frac{du}{ds}\\big|_{0}$, $u''_0 = \\frac{d^2u}{ds^2}\\big|_{0}$，我们有：\n$$\nu_i = u(h) = u_0 + h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)\n$$\n\n### 1. Dirichlet边界条件：$u(\\boldsymbol{x}_{\\Gamma}) = u_b$\n对于此条件，$u(0) = u_b$，所以 $u_0 = u_b$。\n\n首先，我们确定虚单元值 $u_g^D$。该策略对于任何线性函数 $u(s) = as+b$ 都必须是精确的。对于这样的函数，$u_b = b$，$u_i = ah+b$。我们需要用 $u_i$ 和 $u_b$ 来表示 $u_g$。一个标准的二阶精确方法是假设边界值是内部值和虚值的平均值，这两者相对于边界是对称的：\n$$\nu_b \\approx \\frac{u_i + u_g}{2}\n$$\n求解 $u_g$ 得到虚单元策略：\n$$\nu_g^D = 2u_b - u_i\n$$\n这对线性函数是精确的，因为 $2b - (ah+b) = b-ah = u(-h)$。\n\n接下来，我们分析通量的相容性误差。我们将 $u_g^D$ 代入离散通量公式：\n$$\nF_{i\\partial}^{\\text{disc}, D} = |\\Gamma|\\, k \\,\\frac{u_{i} - u_{g}^D}{2h} = |\\Gamma|\\, k \\,\\frac{u_{i} - (2u_b - u_i)}{2h} = |\\Gamma|\\, k \\,\\frac{2u_i - 2u_b}{2h} = |\\Gamma|\\, k \\,\\frac{u_i - u_b}{h}\n$$\n现在，使用 $u_i$ 在 $s=0$ 附近的泰勒展开，并设 $u_b = u_0$：\n$$\nu_i - u_b = (u_0 + h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)) - u_0 = h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)\n$$\n将此代入离散通量表达式：\n$$\nF_{i\\partial}^{\\text{disc}, D} = |\\Gamma|\\, k \\,\\frac{h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)}{h} = |\\Gamma|\\, k \\left( u'_0 + \\frac{h}{2} u''_0 + \\mathcal{O}(h^2) \\right)\n$$\n精确通量是 $F_{i\\partial}^{\\text{exact}} = |\\Gamma|\\, k \\,u'_0$。相容性误差是其差值：\n$$\nF_{i\\partial}^{\\text{disc}, D} - F_{i\\partial}^{\\text{exact}} = |\\Gamma|\\, k \\left( u'_0 + \\frac{h}{2} u''_0 \\right) - |\\Gamma|\\, k \\, u'_0 + \\mathcal{O}(h^2) = \\frac{1}{2} |\\Gamma|\\, k \\, u''_0 \\, h + \\mathcal{O}(h^2)\n$$\n与形式 $\\mathcal{C}h + \\mathcal{O}(h^2)$ 进行比较，我们找到Dirichlet情况下的系数：\n$$\n\\mathcal{C}^D = \\frac{1}{2} |\\Gamma|\\, k \\, u''_0 = \\frac{1}{2} |\\Gamma|\\, k \\, \\frac{d^2u}{ds^2}\\bigg|_{\\boldsymbol{x}_\\Gamma}\n$$\n\n### 2. Neumann边界条件：$\\partial_n u(\\boldsymbol{x}_{\\Gamma}) = g_n$\n该条件是以外法向导数的形式给出的。我们将其与我们的坐标 $s$ 联系起来：$\\partial_n u = - \\frac{du}{ds}$，因此在 $s=0$ 处的条件是 $-\\frac{du}{ds}\\big|_{0} = g_n$，即 $u'_0 = -g_n$。\n\n首先，我们确定虚单元值 $u_g^N$。我们使用中心差分来近似边界上的导数，这是二阶精确的：\n$$\nu'_0 \\approx \\frac{u(h) - u(-h)}{2h} \\approx \\frac{u_i - u_g}{2h}\n$$\n令此近似值等于已知的导数值：\n$$\n\\frac{u_i - u_g}{2h} = u'_0 = -g_n\n$$\n求解 $u_g$ 得到虚单元策略：\n$$\nu_i - u_g = -2h g_n \\implies u_g^N = u_i + 2h g_n\n$$\n该策略对线性函数 $u(s)=as+b$（其中 $u'_0=a=-g_n$）是精确的，因为 $u_g^N = (ah+b) + 2h(-a) = b-ah = u(-h)$。\n\n接下来，我们分析相容性误差。我们将 $u_g^N$ 代入离散通量公式：\n$$\nF_{i\\partial}^{\\text{disc}, N} = |\\Gamma|\\, k \\,\\frac{u_i - u_g^N}{2h} = |\\Gamma|\\, k \\,\\frac{u_i - (u_i + 2h g_n)}{2h} = |\\Gamma|\\, k \\,\\frac{-2h g_n}{2h} = -|\\Gamma|\\, k \\, g_n\n$$\n精确通量由下式给出：\n$$\nF_{i\\partial}^{\\text{exact}} \\approx |\\Gamma|\\, k \\, u'_0 = |\\Gamma|\\, k \\, (-g_n) = -|\\Gamma|\\, k \\, g_n\n$$\n根据给定的边界数据，所构造的离散通量与精确通量相同。因此，相容性误差为零：\n$$\nF_{i\\partial}^{\\text{disc}, N} - F_{i\\partial}^{\\text{exact}} = (-|\\Gamma|\\, k \\, g_n) - (-|\\Gamma|\\, k \\, g_n) = 0\n$$\n这意味着主阶误差系数 $\\mathcal{C}^N$ 为零。\n\n### 结果总结\n这四个量是：\n- Dirichlet虚值：$u_{g}^{D} = 2u_{b} - u_{i}$\n- Dirichlet误差系数：$\\mathcal{C}^{D} = \\frac{1}{2}|\\Gamma|k\\frac{d^2u}{ds^2}\\bigg|_{\\boldsymbol{x}_\\Gamma}$\n- Neumann虚值：$u_{g}^{N} = u_{i} + 2hg_{n}$\n- Neumann误差系数：$\\mathcal{C}^{N} = 0$", "answer": "$$\n\\boxed{\\begin{pmatrix} 2u_{b} - u_{i}  \\frac{1}{2}|\\Gamma|k\\frac{d^{2}u}{ds^{2}}\\bigg|_{\\boldsymbol{x}_\\Gamma}  u_{i} + 2hg_{n}  0 \\end{pmatrix}}\n$$", "id": "3376977"}]}