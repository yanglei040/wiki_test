{"hands_on_practices": [{"introduction": "要深入理解托卡马克中的磁场结构，一个核心概念是安全因子$q$。这项实践将理论与实践联系起来，要求您从安培定律和$q$因子的基本定义出发，推导出它与环向磁场$B_{\\phi}$和等离子体电流密度$j_{\\phi}$之间的直接关系。通过这项计算，您将亲身体验如何通过调整外部磁场来维持等离子体的宏观稳定性，这是托卡马克运行中的一个关键控制任务[@problem_id:3723079]。", "problem": "一个大环径比、圆形截面的托卡马克，其大半径为 $R_{0} = 3.0\\ \\mathrm{m}$，在轴上运行着空间均匀的环向磁场 $B_{\\phi}(0) = 5.3\\ \\mathrm{T}$。假设磁几何是轴对称的，沙弗拉诺夫位移可以忽略不计，并且环向磁场在磁通面上近似恒定。靠近磁轴处的等离子体电流密度是平滑的，并且可以展开为 $j_{\\phi}(r) = j_{0} + \\mathcal{O}(r^{2})$，初始轴上值为 $j_{0} = 1.20 \\times 10^{6}\\ \\mathrm{A/m^{2}}$。在一次剖面演化事件之后，电流剖面变得更尖锐，使得轴上电流密度增加到 $j_{0}^{\\prime} = 1.44 \\times 10^{6}\\ \\mathrm{A/m^{2}}$，而几何假设仍然有效。\n\n仅使用 (i) 安全因子 $q$ 作为环向与极向磁力线缠绕比的基本定义，以及 (ii) 在圆柱近似下靠近磁轴处的极向磁场的安培定律，推导出轴上安全因子 $q(0)$ 关于 $B_{\\phi}(0)$、$R_{0}$ 和 $j_{0}$ 的表达式。然后，确定当 $j_{0}$ 变为 $j_{0}^{\\prime}$ 时，为保持 $q(0)$ 不变所需的轴上环向磁场变化量 $\\Delta B_{\\phi}(0) \\equiv B_{\\phi}^{\\prime}(0) - B_{\\phi}(0)$。\n\n用 $\\mathrm{T}$ 作单位，将 $\\Delta B_{\\phi}(0)$ 的最终答案四舍五入到三位有效数字。", "solution": "首先验证问题陈述的科学合理性、自洽性和清晰度。\n\n### 步骤 1：提取已知条件\n-   托卡马克几何：大环径比、圆形截面。\n-   大半径：$R_{0} = 3.0\\ \\mathrm{m}$。\n-   初始轴上环向磁场：$B_{\\phi}(0) = 5.3\\ \\mathrm{T}$。\n-   假设：轴对称几何，可忽略的沙弗拉诺夫位移，环向磁场 $B_{\\phi}$ 在磁通面上近似恒定。\n-   靠近磁轴（$r=0$）的初始电流密度剖面：$j_{\\phi}(r) = j_{0} + \\mathcal{O}(r^{2})$。\n-   初始轴上电流密度：$j_{0} = 1.20 \\times 10^{6}\\ \\mathrm{A/m^{2}}$。\n-   最终轴上电流密度：$j_{0}^{\\prime} = 1.44 \\times 10^{6}\\ \\mathrm{A/m^{2}}$。\n-   目标：首先，推导轴上安全因子 $q(0)$ 关于 $B_{\\phi}(0)$、$R_{0}$ 和 $j_{0}$ 的表达式。其次，确定在 $j_{0}$ 变为 $j_{0}^{\\prime}$ 的过程中，为保持 $q(0)$ 不变所需的轴上环向磁场变化量 $\\Delta B_{\\phi}(0) = B_{\\phi}^{\\prime}(0) - B_{\\phi}(0)$。\n-   要求使用的方法：（i）安全因子 $q$ 的基本定义，以及（ii）圆柱近似下的安培定律。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上基于应用于托卡马克聚变装置的磁流体动力学（MHD）原理。安全因子、环向和极向磁场以及安培定律的概念是等离子体物理学中的标准内容。所提供的大半径、磁场和电流密度的数值对于大型托卡马克是物理上现实的。该问题是适定的，提供了推导唯一解所需的所有必要信息和假设（例如，大环径比、轴附近的圆柱近似）。语言客观且明确。该问题不违反任何指定的无效标准。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n### 轴上安全因子 $q(0)$ 的推导\n安全因子 $q$ 用于量化磁通面上磁力线的螺距。它被定义为磁力线每绕行极向一圈所完成的环向绕行圈数。在环坐标系 $(r, \\theta, \\phi)$ 中，其中 $r$ 是小半径，$\\theta$ 是极向角，$\\phi$ 是环向角，磁力线的路径由以下微分方程描述：\n$$\n\\frac{dl_{\\phi}}{B_{\\phi}} = \\frac{dl_{\\theta}}{B_{\\theta}}\n$$\n其中 $dl_{\\phi}$ 和 $dl_{\\theta}$ 分别是环向和极向的微分弧长，而 $B_{\\phi}$ 和 $B_{\\theta}$ 是相应的磁场分量。\n\n对于大环径比（$R_0 \\gg r$）的圆形托卡马克，我们可以使用圆柱近似。磁通面上某点的大半径为 $R = R_0 + r\\cos\\theta \\approx R_0$。弧长由 $dl_{\\phi} = R d\\phi \\approx R_0 d\\phi$ 和 $dl_{\\theta} = r d\\theta$ 给出。将这些代入磁力线方程可得：\n$$\n\\frac{R_0 d\\phi}{B_{\\phi}} = \\frac{r d\\theta}{B_{\\theta}}\n$$\n在小半径为 $r$ 的磁通面上的安全因子 $q(r)$ 是角度微分变化的比率：\n$$\nq(r) = \\frac{d\\phi}{d\\theta} = \\frac{r B_{\\phi}(r)}{R_0 B_{\\theta}(r)}\n$$\n我们需要在磁轴上计算这个表达式，即在极限 $r \\to 0$ 的情况下。问题陈述中指出，环向磁场在磁通面上近似恒定，因此在轴附近我们可以取 $B_{\\phi}(r) \\approx B_{\\phi}(0)$。因此，轴上安全因子为：\n$$\nq(0) = \\lim_{r \\to 0} q(r) = \\frac{B_{\\phi}(0)}{R_0} \\lim_{r \\to 0} \\left( \\frac{r}{B_{\\theta}(r)} \\right)\n$$\n为了计算这个极限，我们必须使用安培定律 $\\oint \\vec{B} \\cdot d\\vec{l} = \\mu_0 I_{enc}$ 来确定靠近磁轴处极向磁场 $B_{\\theta}(r)$ 的行为。我们将此定律应用于以磁轴为中心、半径为 $r$ 的圆形安培环路。由于轴对称性，$B_{\\theta}$ 在此环路上是恒定的。线积分为：\n$$\n\\oint \\vec{B} \\cdot d\\vec{l} = B_{\\theta}(r) (2\\pi r)\n$$\n闭合电流 $I_{enc}$ 是环向电流密度 $j_{\\phi}$ 在环路所围圆形面积上的积分。问题给出的轴附近电流密度为 $j_{\\phi}(r) = j_0 + \\mathcal{O}(r^2)$。对于小 $r$，我们可以近似认为 $j_{\\phi}(r) \\approx j_0$。\n$$\nI_{enc} = \\int_{0}^{r} j_{\\phi}(r') 2\\pi r' dr' \\approx \\int_{0}^{r} j_0 2\\pi r' dr' = j_0 \\pi r^2\n$$\n令安培定律的两部分相等：\n$$\nB_{\\theta}(r) (2\\pi r) = \\mu_0 (j_0 \\pi r^2)\n$$\n求解 $B_{\\theta}(r)$ 得到其在轴附近对 $r$ 的线性依赖关系：\n$$\nB_{\\theta}(r) = \\frac{\\mu_0 j_0 r}{2}\n$$\n现在我们可以计算 $q(0)$ 的极限：\n$$\n\\lim_{r \\to 0} \\left( \\frac{r}{B_{\\theta}(r)} \\right) = \\lim_{r \\to 0} \\left( \\frac{r}{\\frac{\\mu_0 j_0 r}{2}} \\right) = \\frac{2}{\\mu_0 j_0}\n$$\n将此结果代入 $q(0)$ 的表达式，得到最终推导出的公式：\n$$\nq(0) = \\frac{B_{\\phi}(0)}{R_0} \\left( \\frac{2}{\\mu_0 j_0} \\right) = \\frac{2 B_{\\phi}(0)}{\\mu_0 R_0 j_0}\n$$\n这完成了问题的第一部分。\n\n### 所需环向磁场变化的计算\n问题陈述中指出，当轴上电流密度从 $j_0$ 变为 $j_0'$ 时，轴上安全因子 $q(0)$ 保持不变。设初始状态为 $(B_{\\phi}(0), j_0)$，最终状态为 $(B_{\\phi}'(0), j_0')$。条件是 $q_{initial}(0) = q_{final}(0)$。使用推导出的公式：\n$$\n\\frac{2 B_{\\phi}(0)}{\\mu_0 R_0 j_0} = \\frac{2 B_{\\phi}'(0)}{\\mu_0 R_0 j_0'}\n$$\n常数 $2$、$\\mu_0$ 和 $R_0$ 相互抵消，留下轴上环向磁场与轴上电流密度之间的正比关系：\n$$\n\\frac{B_{\\phi}(0)}{j_0} = \\frac{B_{\\phi}'(0)}{j_0'}\n$$\n我们想要求解变化量 $\\Delta B_{\\phi}(0) = B_{\\phi}'(0) - B_{\\phi}(0)$。首先，我们求解最终的环向磁场 $B_{\\phi}'(0)$：\n$$\nB_{\\phi}'(0) = B_{\\phi}(0) \\frac{j_0'}{j_0}\n$$\n然后，变化量为：\n$$\n\\Delta B_{\\phi}(0) = B_{\\phi}(0) \\frac{j_0'}{j_0} - B_{\\phi}(0) = B_{\\phi}(0) \\left( \\frac{j_0'}{j_0} - 1 \\right)\n$$\n现在，我们代入给定的数值：$B_{\\phi}(0) = 5.3\\ \\mathrm{T}$，$j_{0} = 1.20 \\times 10^{6}\\ \\mathrm{A/m^{2}}$，以及 $j_{0}^{\\prime} = 1.44 \\times 10^{6}\\ \\mathrm{A/m^{2}}$。\n$$\n\\Delta B_{\\phi}(0) = 5.3 \\left( \\frac{1.44 \\times 10^{6}}{1.20 \\times 10^{6}} - 1 \\right)\n$$\n$$\n\\Delta B_{\\phi}(0) = 5.3 \\left( \\frac{1.44}{1.20} - 1 \\right) = 5.3 \\left( 1.2 - 1 \\right)\n$$\n$$\n\\Delta B_{\\phi}(0) = 5.3 \\times 0.2 = 1.06\\ \\mathrm{T}\n$$\n结果 $1.06$ 已经是用三位有效数字表示的。因此，所需的轴上环向磁场增量为 $1.06\\ \\mathrm{T}$。", "answer": "$$\n\\boxed{1.06}\n$$", "id": "3723079"}, {"introduction": "在掌握了等离子体芯部的基本物理后，我们将注意力转向等离子体边界的精细控制，这对热量和粒子排出至关重要。本练习探讨了一种先进的偏滤器位形——“雪花”偏滤器，它要求在特定位置产生一个二阶磁零点。您将运用磁通函数$\\psi$的泰勒展开和真空磁场的基本方程，推导出实现这种复杂磁场几何所需的严格数学条件，并将其与外部线圈的电流配置联系起来[@problem_id:3723083]。", "problem": "考虑一个轴对称托卡马克偏滤器区域，其局部环向电流密度可忽略不计，因此静磁真空条件适用。设磁场 $\\mathbf{B}$ 通过极向磁通函数 $\\psi(R,Z)$ 表示为 $\\mathbf{B} = \\frac{1}{R}\\nabla \\psi \\times \\hat{\\boldsymbol{\\phi}} + B_{\\phi}\\hat{\\boldsymbol{\\phi}}$。回想一下，在真空区域，麦克斯韦方程组简化为 $\\nabla \\cdot \\mathbf{B} = 0$ 和 $\\nabla \\times \\mathbf{B} = \\mathbf{0}$，这对轴对称极向磁通意味着真空Grad-Shafranov算符满足 $\\,\\Delta^{\\ast}\\psi = 0\\,$，其中 $\\Delta^{\\ast}\\psi \\equiv R\\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^{2}\\psi}{\\partial Z^{2}}$。\n\n设 $(R_{0},Z_{0})$ 为一个候选的偏滤器零点。引入局部笛卡尔坐标 $(x,y)$，定义为 $x \\equiv R - R_{0}$ 和 $y \\equiv Z - Z_{0}$，并假设关于 $Z=Z_{0}$ 存在局部中平面对​​称性 $y \\mapsto -y$ 以及尺度分离 $|x|,|y| \\ll R_{0}$，因此 $\\,\\psi\\,$ 的主导阶行为由满足 $\\,\\Delta^{\\ast}\\psi = 0\\,$ 的二维谐波展开决定。\n\n从上述基本定律和定义出发，完成以下任务：\n\n1. 使用 $\\,\\psi(x,y)\\,$ 的泰勒展开和轴对称真空条件 $\\,\\Delta^{\\ast}\\psi = 0\\,$，严格推导区分标准磁X点和“雪花”偏滤器零点的局域判据。特别地，展示在 $(x,y)=(0,0)$ 处，$\\,\\psi\\,$ 的梯度和黑塞矩阵（Hessian）产生二阶零点所需的必要条件，并从第一性原理出发，解释为何这会导致极向磁力线几何结构呈现出雪花位型特有的六条分界线。\n\n2. 假设在 $(x,y)=(0,0)$ 附近的总极向磁通可以写为一个基线贡献（来自所有其他线圈和等离子体电流）和两个由 $k=1,2$ 索引的可调极向场线圈回路的叠加：\n$$\n\\psi(x,y) = \\psi_{\\mathrm{bg}}(x,y) + \\sum_{k=1}^{2} \\psi_{k}(x,y), \\quad \\psi_{k} \\text{ linear in } I_{k},\n$$\n并且，与中平面对称性和 $\\,\\Delta^{\\ast}\\psi = 0\\,$ 一致，每个贡献的主导项具有以下形式\n$$\n\\psi_{\\mathrm{bg}}(x,y) = A\\,x + \\frac{B}{2}\\,(x^{2} - y^{2}) + \\text{更高阶项},\n$$\n$$\n\\psi_{k}(x,y) = \\alpha_{k}\\,I_{k}\\,x + \\frac{\\beta_{k}}{2}\\,I_{k}\\,(x^{2} - y^{2}) + \\text{更高阶项},\n$$\n其中 $A$ 和 $B$ 是在 $(R_{0},Z_{0})$ 处评估的基线偶极和四极系数，而 $\\alpha_{k}$、$\\beta_{k}$ 是由线圈几何形状和真空场格林函数决定的线圈-磁通响应系数。利用线性叠加和第1部分的判据，推导在 $(x,y)=(0,0)$ 处实现二阶零点所需的关于 $I_{1}$ 和 $I_{2}$ 的代数条件。\n\n3. 求解所得方程组，得到仅用 $A$, $B$, $\\alpha_{1}$, $\\alpha_{2}$, $\\beta_{1}$ 和 $\\beta_{2}$ 表示的电流比 $\\,I_{2}/I_{1}\\,$ 的闭式解析表达式。假设存在非零电流的解，并且高阶项产生一个非零的三阶系数。将最终答案表示为单个解析表达式。不需要进行数值计算。\n\n你的最终答案必须是单个闭式表达式。不需要四舍五入。电流比是无量纲的；最终答案中不要包含单位。", "solution": "该问题已经过验证，被认为是科学上合理、问题明确、客观且内部一致的。它提出了一个等离子体物理和磁流体动力学中的标准（尽管是高级的）问题。未发现任何缺陷。因此，我们可以着手求解。\n\n解答分为三部分，对应于问题陈述中列出的任务。\n\n首先，我们推导区分标准磁X点和“雪花”偏滤器零点的局域判据。\n极向平面中的磁零点是极向磁场 $\\mathbf{B}_p$ 为零的位置。极向场由 $\\mathbf{B}_p = \\frac{1}{R}\\nabla \\psi \\times \\hat{\\boldsymbol{\\phi}} = \\frac{1}{R}\\left(\\frac{\\partial \\psi}{\\partial Z}\\hat{\\mathbf{R}} - \\frac{\\partial \\psi}{\\partial R}\\hat{\\mathbf{Z}}\\right)$ 给出。在局部坐标 $x = R - R_0$ 和 $y = Z - Z_0$ 中，这变为 $\\mathbf{B}_p = \\frac{1}{R_0+x}\\left(\\frac{\\partial \\psi}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial \\psi}{\\partial x}\\hat{\\mathbf{y}}\\right)$。为了使 $\\mathbf{B}_p$ 在点 $(R_0, Z_0)$（对应于 $(x,y)=(0,0)$）处为零，极向磁通函数的梯度必须为零：在 $(0,0)$ 处 $\\nabla \\psi = \\mathbf{0}$。这意味着在 $(0,0)$ 处 $\\frac{\\partial \\psi}{\\partial x}\\big|_{(0,0)} = 0$ 且 $\\frac{\\partial \\psi}{\\partial y}\\big|_{(0,0)} = 0$。\n\n我们在零点 $(0,0)$ 附近对 $\\psi(x,y)$ 进行泰勒展开。为方便起见，将常数 $\\psi(0,0)$ 设为0（因为它仅仅是标记磁通面），并应用条件 $\\nabla\\psi|_{(0,0)} = \\mathbf{0}$，展开从二阶项开始：\n$$\n\\psi(x,y) = \\frac{1}{2}\\left( \\psi_{xx}x^2 + 2\\psi_{xy}xy + \\psi_{yy}y^2 \\right) + \\frac{1}{6}\\left( \\psi_{xxx}x^3 + 3\\psi_{xxy}x^2y + 3\\psi_{xyy}xy^2 + \\psi_{yyy}y^3 \\right) + \\dots\n$$\n其中下标表示在 $(0,0)$ 处计算的偏导数。\n\n问题陈述了中平面对称性 $y \\mapsto -y$，这意味着 $\\psi(x,y) = \\psi(x,-y)$。为了保持这种对称性，泰勒展开中所有含 $y$ 的奇次幂的项都必须为零。这要求 $\\psi_y = 0$（已经确定）、$\\psi_{xy} = 0$、$\\psi_{xxy} = 0$、$\\psi_{yyy} = 0$ 等等。展开简化为：\n$$\n\\psi(x,y) = \\frac{1}{2}\\left( \\psi_{xx}x^2 + \\psi_{yy}y^2 \\right) + \\frac{1}{6}\\left( \\psi_{xxx}x^3 + 3\\psi_{xyy}xy^2 \\right) + \\dots\n$$\n真空Grad-Shafranov方程 $\\Delta^{\\ast}\\psi = 0$ 必须被满足。在局部坐标系中，对于 $|x| \\ll R_0$ 的情况，该算符近似为 $\\Delta^{\\ast}\\psi \\approx \\frac{\\partial^2\\psi}{\\partial x^2} + \\frac{\\partial^2\\psi}{\\partial y^2} - \\frac{1}{R_0}\\frac{\\partial\\psi}{\\partial x}$。在零点 $(0,0)$ 处计算该式，其中 $\\frac{\\partial\\psi}{\\partial x} = 0$，我们得到条件 $\\psi_{xx} + \\psi_{yy} = 0$，即 $\\psi_{yy} = -\\psi_{xx}$。\n\n一个标准的X点，或一阶零点，其特征是在 $(0,0)$ 处 $\\nabla\\psi|_{(0,0)} = \\mathbf{0}$ 且二阶导数的黑塞矩阵 $\\mathbf{H}$ 非退化。在 $(0,0)$ 处的黑塞矩阵为 $\\mathbf{H} = \\begin{pmatrix} \\psi_{xx} & \\psi_{xy} \\\\ \\psi_{xy} & \\psi_{yy} \\end{pmatrix} = \\begin{pmatrix} \\psi_{xx} & 0 \\\\ 0 & -\\psi_{xx} \\end{pmatrix}$。非退化的黑塞矩阵意味着 $\\det(\\mathbf{H}) = -\\psi_{xx}^2 \\neq 0$，这表示 $\\psi_{xx} \\neq 0$。在这种情况下，$\\psi$ 的局域行为由二次项主导：\n$$\n\\psi(x,y) \\approx \\frac{1}{2}\\psi_{xx}(x^2 - y^2)\n$$\n由 $\\psi(x,y) = 0$ 定义的分界线由 $x^2 - y^2 = 0$ 给出，从而得到两条直线 $y = \\pm x$。这两条线在原点相交，形成四个不同的区域，这是X点的特征。\n\n“雪花”偏滤器零点是一个二阶零点。当满足一阶零点的条件（在 $(0,0)$ 处 $\\nabla\\psi|_{(0,0)} = \\mathbf{0}$）并且黑塞矩阵为零矩阵 $\\mathbf{H} = \\mathbf{0}$ 时，就会出现这种情况。这意味着在零点处所有二阶偏导数都为零：$\\psi_{xx} = \\psi_{yy} = \\psi_{xy} = 0$。\n\n对于二阶零点，泰勒展开从三阶项开始。由于对称性和真空条件，其形式为：\n$$\n\\psi(x,y) \\approx \\frac{1}{6}\\left( \\psi_{xxx}x^3 + 3\\psi_{xyy}xy^2 \\right)\n$$\n为了找到三阶导数之间的关系，我们对真空Grad-Shafranov方程求导：$\\frac{\\partial}{\\partial x}(\\Delta^{\\ast}\\psi)|_{(0,0)} = 0$。\n$$\n\\frac{\\partial}{\\partial x}\\left(\\frac{\\partial^2\\psi}{\\partial x^2} + \\frac{\\partial^2\\psi}{\\partial y^2} - \\frac{1}{R_0}\\frac{\\partial\\psi}{\\partial x}\\right)\\bigg|_{(0,0)} = \\left(\\psi_{xxx} + \\psi_{xyy} - \\frac{1}{R_0}\\psi_{xx}\\right)\\bigg|_{(0,0)} = 0\n$$\n由于对于二阶零点 $\\psi_{xx} = 0$，我们必须有 $\\psi_{xxx} + \\psi_{xyy} = 0$。我们定义一个非零常数 $C_3 = \\psi_{xyy}$（问题假设存在一个非零的三阶系数）。那么 $\\psi_{xxx} = -C_3$。磁通函数变为：\n$$\n\\psi(x,y) \\approx \\frac{1}{6}(-C_3 x^3 + 3C_3 xy^2) = \\frac{C_3}{6}x(3y^2 - x^2)\n$$\n通过设 $\\psi(x,y) = 0$ 可以找到分界线拓扑，得到 $x(3y^2 - x^2) = 0$。解定义了三条在原点相交的直线：$x=0$，以及 $3y^2-x^2=0 \\implies y = \\pm \\frac{x}{\\sqrt{3}}$。这三条线之间相隔60度角，将极向平面分成六个区域，这是雪花偏滤器的定义性几何结构。\n\n总而言之，判据如下：\n-   标准X点（一阶零点）：$\\nabla\\psi=\\mathbf{0}$ 且 $\\mathbf{H} \\neq \\mathbf{0}$。\n-   雪花（二阶零点）：$\\nabla\\psi=\\mathbf{0}$ 且 $\\mathbf{H} = \\mathbf{0}$（并具有非零的三阶导数）。\n\n接下来，我们推导为实现二阶零点，线圈电流 $I_1$ 和 $I_2$ 需要满足的条件。总极向磁通由叠加给出：\n$$\n\\psi(x,y) = \\psi_{\\mathrm{bg}}(x,y) + \\psi_{1}(x,y) + \\psi_{2}(x,y)\n$$\n代入给定的形式：\n$$\n\\psi(x,y) = \\left( A\\,x + \\frac{B}{2}\\,(x^{2} - y^{2}) \\right) + \\left( \\alpha_{1}\\,I_{1}\\,x + \\frac{\\beta_{1}}{2}\\,I_{1}\\,(x^{2} - y^{2}) \\right) + \\left( \\alpha_{2}\\,I_{2}\\,x + \\frac{\\beta_{2}}{2}\\,I_{2}\\,(x^{2} - y^{2}) \\right) + \\dots\n$$\n按 $x$ 和 $y$ 的幂次合并项：\n$$\n\\psi(x,y) = (A + \\alpha_{1}I_{1} + \\alpha_{2}I_{2})x + \\frac{1}{2}(B + \\beta_{1}I_{1} + \\beta_{2}I_{2})(x^2 - y^2) + \\dots\n$$\n要在 $(0,0)$ 处创建一个二阶零点，我们必须在该点强制执行条件 $\\nabla\\psi=\\mathbf{0}$ 和 $\\mathbf{H}=\\mathbf{0}$。\n在 $(0,0)$ 处关于 $x$ 的一阶导数是 $x$ 的线性项的系数：\n$$\n\\frac{\\partial \\psi}{\\partial x}\\bigg|_{(0,0)} = A + \\alpha_{1}I_{1} + \\alpha_{2}I_{2}\n$$\n条件 $\\frac{\\partial \\psi}{\\partial x} = 0$ 给出我们的第一个方程：\n$$\nA + \\alpha_{1}I_{1} + \\alpha_{2}I_{2} = 0\n$$\n在 $(0,0)$ 处关于 $x$ 的二阶导数是 $x^2$ 项的系数乘以 $2!/2$：\n$$\n\\frac{\\partial^2 \\psi}{\\partial x^2}\\bigg|_{(0,0)} = B + \\beta_{1}I_{1} + \\beta_{2}I_{2}\n$$\n条件 $\\mathbf{H}=\\mathbf{0}$ 要求 $\\psi_{xx}=0$，这给出我们的第二个方程：\n$$\nB + \\beta_{1}I_{1} + \\beta_{2}I_{2} = 0\n$$\n其他条件（$\\psi_y=0$, $\\psi_{xy}=0$, $\\psi_{yy}=-\\psi_{xx}=0$）由磁通函数的给定形式自动满足，该形式遵守了所需的对称性和真空约束。因此，关于 $I_1$ 和 $I_2$ 的代数条件是以下耦合线性系统：\n$$\n\\alpha_{1}I_{1} + \\alpha_{2}I_{2} = -A\n$$\n$$\n\\beta_{1}I_{1} + \\beta_{2}I_{2} = -B\n$$\n\n最后，我们求解这个方程组以得到电流比 $I_2/I_1$。我们可以使用克莱默法则求解 $I_1$ 和 $I_2$。系数矩阵的行列式为 $D = \\alpha_1\\beta_2 - \\alpha_2\\beta_1$。\n$I_{1}$ 的解为：\n$$\nI_{1} = \\frac{\\det\\begin{pmatrix} -A & \\alpha_2 \\\\ -B & \\beta_2 \\end{pmatrix}}{D} = \\frac{-A\\beta_2 - (-B\\alpha_2)}{D} = \\frac{B\\alpha_2 - A\\beta_2}{D}\n$$\n$I_{2}$ 的解为：\n$$\nI_{2} = \\frac{\\det\\begin{pmatrix} \\alpha_1 & -A \\\\ \\beta_1 & -B \\end{pmatrix}}{D} = \\frac{-B\\alpha_1 - (-A\\beta_1)}{D} = \\frac{A\\beta_1 - B\\alpha_1}{D}\n$$\n问题假设存在非零电流的解，这意味着 $D \\neq 0$，$I_1 \\neq 0$ 且 $I_2 \\neq 0$。那么比值 $I_2/I_1$ 为：\n$$\n\\frac{I_2}{I_1} = \\frac{(A\\beta_1 - B\\alpha_1)/D}{(B\\alpha_2 - A\\beta_2)/D}\n$$\n行列式 $D$ 在 $D \\neq 0$ 的条件下可以消去，剩下：\n$$\n\\frac{I_2}{I_1} = \\frac{A\\beta_1 - B\\alpha_1}{B\\alpha_2 - A\\beta_2}\n$$\n该表达式以给定的背景和线圈响应系数来表示所需的电流比。", "answer": "$$\n\\boxed{\\frac{A \\beta_1 - B \\alpha_1}{B \\alpha_2 - A \\beta_2}}\n$$", "id": "3723083"}, {"introduction": "虽然解析模型为我们提供了深刻的物理洞察，但真实的聚变装置设计与控制严重依赖于复杂的计算机模拟。这项实践让您有机会亲身体验这一过程，将电磁学理论转化为一个实际的计算任务。您将构建一个数值模型，通过求解一个正则化的线性反问题来计算实现特定等离子体边界形状所需的极向场线圈电流，并分析该设计的鲁棒性，这直接关系到控制系统的稳定性和效率[@problem_id:3723089]。", "problem": "考虑一个用于核聚变的轴对称环形装置，其中等离子体边界的形状由外部极向场（PF）线圈实现。在真空静磁学框架下工作，并假设轴对称性。令极向磁通函数表示为 $\\psi(R,Z)$，其中 $R$ 是大半径，$Z$ 是垂直坐标。本问题的基本依据是：\n- 真空中的静磁麦克斯韦方程组 $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$ 和 $\\nabla \\cdot \\mathbf{B} = 0$，其中在等离子体区域内 $\\mathbf{J} = \\mathbf{0}$（真空假设），这意味着外部线圈产生的场可以线性叠加。\n- 在轴对称情况下，磁矢量势只有一个环向分量 $A_\\phi(R,Z)$，使得 $\\psi(R,Z) = R A_\\phi(R,Z)$。对于一个位于 $(R=a, Z=Z_0)$、半径为 $a$、携带电流 $I$ 的圆形电流环，其贡献由经过充分检验的磁矢量势环向分量的椭圆积分表达式给出，\n$$\nA_\\phi(R,Z) = \\frac{\\mu_0 I}{2\\pi} \\frac{1}{k} \\sqrt{\\frac{a}{R}} \\left[ \\left(2 - k^2\\right) K(k^2) - 2 E(k^2) \\right],\n$$\n其模数的平方为\n$$\nk^2 = \\frac{4 a R}{(a+R)^2 + (Z-Z_0)^2},\n$$\n其中 $K(m)$ 和 $E(m)$ 分别是参数为 $m = k^2$ 的第一类和第二类完全椭圆积分。所有PF线圈都建模为此类圆形环路，因此 $\\psi(R,Z)$ 是它们贡献的线性叠加，$\\psi(R,Z) = \\sum_{j=1}^{N_c} \\psi_j(R,Z)$，其中 $\\psi_j(R,Z) = R A_{\\phi,j}(R,Z)$。\n\n目标是计算实现指定等$\\psi$等离子体边界轮廓所需的PF线圈电流，并量化对线圈位置的敏感度。将此问题表述为一个线性逆问题：在期望的边界上选择 $N_p$ 个点 $(R_i, Z_i)$，并强制执行约束 $\\psi(R_i, Z_i) \\approx \\psi_b$ 对所有 $i \\in \\{1,\\dots,N_p\\}$ 成立，其中 $\\psi_b$ 是一个指定的恒定磁通值。构建线性系统\n$$\n\\mathbf{A} \\mathbf{I} \\approx \\mathbf{b},\n$$\n其中 $\\mathbf{A} \\in \\mathbb{R}^{N_p \\times N_c}$ 的元素为 $A_{ij} = \\psi_j(R_i, Z_i)$（对于线圈 $j$ 中的单位电流），$\\mathbf{I} \\in \\mathbb{R}^{N_c}$ 是待求的线圈电流矢量，$\\mathbf{b} \\in \\mathbb{R}^{N_p}$ 的元素为 $b_i = \\psi_b$。使用Tikhonov正则化最小二乘法求解 $\\mathbf{I}$：\n$$\n\\mathbf{I}^\\star = \\arg\\min_{\\mathbf{I}} \\left\\| \\mathbf{A} \\mathbf{I} - \\mathbf{b} \\right\\|_2^2 + \\lambda^2 \\left\\| \\mathbf{I} \\right\\|_2^2,\n$$\n其正规方程解为\n$$\n\\left(\\mathbf{A}^\\top \\mathbf{A} + \\lambda^2 \\mathbf{I}_{N_c}\\right) \\mathbf{I}^\\star = \\mathbf{A}^\\top \\mathbf{b}。\n$$\n通过以下方式量化对线圈位置的敏感度：\n- $2$-范数条件数 $\\kappa_2(\\mathbf{A}) = \\sigma_{\\max}(\\mathbf{A}) / \\sigma_{\\min}(\\mathbf{A})$，其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是 $\\mathbf{A}$ 的最大和最小奇异值。\n- 对所有线圈中心进行均匀垂直扰动 $\\Delta Z$ 的有限差分敏感度度量：对于线圈位置 $(R_j, Z_j + \\Delta Z)$ 重新计算 $\\mathbf{I}^{\\star,\\mathrm{pert}}$，并报告无量纲相对变化\n$$\n\\delta = \\frac{\\left\\| \\mathbf{I}^{\\star,\\mathrm{pert}} - \\mathbf{I}^\\star \\right\\|_2}{\\left\\| \\mathbf{I}^\\star \\right\\|_2}。\n$$\n\n所有距离单位必须为米，电流单位为安培，磁导率 $\\mu_0$ 单位为亨利每米，磁通量单位为韦伯。角度必须以弧度指定和使用。\n\n使用以下测试套件。在每种情况下，定义一个大半径为 $R_0$、小半径为 $a_p$、拉长比为 $\\kappa$ 的拉长等离子体边界，并在角度 $\\theta \\in \\{0, \\pi/4, \\pi/2, 3\\pi/4, \\pi, 5\\pi/4, 3\\pi/2, 7\\pi/4\\}$ 处采样 $N_p = 8$ 个边界点：\n$$\nR(\\theta) = R_0 + a_p \\cos\\theta, \\quad Z(\\theta) = \\kappa a_p \\sin\\theta.\n$$\n使用正则化参数 $\\lambda = 10^{-3}$ 和扰动 $\\Delta Z = 0.01$。\n\n- 测试案例1（适定成形）：\n  - $R_0 = 3.0$, $a_p = 1.0$, $\\kappa = 1.7$, $\\psi_b = 1.0$。\n  - PF线圈组 ($N_c = 4$): $(R_c,Z_c) \\in \\{(3.0, 1.6), (3.0, -1.6), (5.0, 0.0), (1.5, 0.0)\\}$。\n\n- 测试案例2（近共线线圈，可控性降低）：\n  - $R_0 = 3.0$, $a_p = 1.0$, $\\kappa = 1.7$, $\\psi_b = 1.0$。\n  - PF线圈组 ($N_c = 3$): $(R_c,Z_c) \\in \\{(3.5, 0.0), (3.6, 0.0), (3.7, 0.0)\\}$。\n\n- 测试案例3（线圈远离等离子体放置，弱耦合）：\n  - $R_0 = 3.0$, $a_p = 1.0$, $\\kappa = 1.7$, $\\psi_b = 1.0$。\n  - PF线圈组 ($N_c = 4$): $(R_c,Z_c) \\in \\{(8.0, 3.5), (8.0, -3.5), (0.5, 3.5), (0.5, -3.5)\\}$。\n\n您的程序必须：\n- 使用给定的 $A_\\phi$ 公式和完全椭圆积分，实现针对圆形环路的上述物理模型。\n- 对每个测试案例，通过叠加单位电流下的 $\\psi_j$ 来构建 $\\mathbf{A}$。\n- 通过正规方程求解 $\\mathbf{I}^\\star$。\n- 通过奇异值计算 $\\kappa_2(\\mathbf{A})$。\n- 通过指定的 $\\Delta Z$ 扰动计算 $\\delta$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔结果列表。每个测试案例的结果必须是 $[\\text{currents}, \\kappa_2, \\delta]$ 形式的列表，其中 $\\text{currents}$ 是浮点数线圈电流（单位：安培）的列表。例如，全局输出应类似于 $[[[I_1,\\dots,I_{N_c}],\\kappa_2,\\delta],[[\\dots],\\dots,\\dots],[[\\dots],\\dots,\\dots]]$，不含空格。所有电流以安培表示，磁通量以韦伯表示，距离以米表示，角度以弧度表示。最终的电流和敏感度指标是测试套件所要求的无量纲浮点数或浮点数列表。", "solution": "用户提供的问题已经过分析，并被确定为**有效**。这是一个基于科学、适定且客观的计算等离子体物理学问题。所有必要的数据和定义均已提供，其框架与电磁学和数值分析的既定原则一致。现在我将提供完整的解决方案。\n\n### 基于原理的解决方案设计\n\n该问题要求计算一组极向场（PF）线圈中的电流，以在轴对称环形装置中形成等离子体边界，并随后分析该解的敏感性。解决方案通过以下基于静磁学和线性代数原理的步骤来制定。\n\n#### 1. 物理模型：来自电流环的极向磁通\n\n该问题的基础是真空静磁学。在轴对称系统中，磁场 $\\mathbf{B}$ 可以从一个单分量的磁矢量势 $\\mathbf{A} = A_\\phi(R,Z) \\hat{\\phi}$ 导出，其中 $R$ 是大半径，$Z$ 是垂直坐标。在极向平面（$R,Z$-平面）中的磁场线位于等极向磁通面上，即 $\\psi$ 为常数的面。极向磁通与矢量势的关系为 $\\psi(R,Z) = R A_\\phi(R,Z)$。\n\n问题指出，面向等离子体的线圈被建模为圆形电流环。在点 $(R,Z)$ 处，由一个半径为 $a$，位于对称轴上 $Z=Z_0$ 处，并承载电流 $I$ 的单个环路产生的环向矢量势 $A_\\phi$ 的贡献由下式给出：\n$$\nA_{\\phi,j}(R,Z) = \\frac{\\mu_0 I_j}{2\\pi} \\frac{1}{k_j} \\sqrt{\\frac{a_j}{R}} \\left[ \\left(2 - k_j^2\\right) K(k_j^2) - 2 E(k_j^2) \\right]\n$$\n此处，下标 $j$ 指的是第 $j$ 个线圈，其半径为 $a_j = R_j$（其自身的大半径），位于 $(R_j, Z_j)$。模数的平方 $k_j^2$ 取决于线圈和目标点的坐标：\n$$\nk_j^2 = \\frac{4 a_j R}{(a_j+R)^2 + (Z-Z_j)^2}\n$$\n$K(m)$ 和 $E(m)$ 是参数为 $m=k^2$ 的第一类和第二类完全椭圆积分。常数 $\\mu_0$ 是自由空间的磁导率。\n\n由于麦克斯韦方程在真空中是线性的，来自 $N_c$ 个线圈的总极向磁通是每个线圈磁通的线性叠加：\n$$\n\\psi(R,Z) = \\sum_{j=1}^{N_c} \\psi_j(R,Z) = \\sum_{j=1}^{N_c} R A_{\\phi,j}(R,Z)\n$$\n\n#### 2. 数学公式化：线性逆问题\n\n目标是找到线圈电流 $I_j$，使得产生的极向磁通 $\\psi(R,Z)$ 在期望的等离子体边界上近似于一个常数值 $\\psi_b$。该边界由一组 $N_p$ 个点 $(R_i, Z_i)$ 定义。在每个点上评估磁通方程，得到一个线性方程组：\n$$\n\\sum_{j=1}^{N_c} \\psi_j(R_i, Z_i; I_j) \\approx \\psi_b \\quad \\text{for } i = 1, \\dots, N_p\n$$\n我们可以通过定义线圈 $j$ 在点 $i$ 处每单位安培产生的磁通为 $G_{ij} = \\psi_j(R_i, Z_i; I_j=1\\text{ A})$ 来分离未知电流 $I_j$。该系统随后变为：\n$$\n\\sum_{j=1}^{N_c} G_{ij} I_j \\approx \\psi_b \\quad \\text{for } i = 1, \\dots, N_p\n$$\n这是一个线性方程组，可以写成矩阵形式：\n$$\n\\mathbf{A} \\mathbf{I} \\approx \\mathbf{b}\n$$\n其中 $\\mathbf{A}$ 是 $N_p \\times N_c$ 矩阵，其元素为 $A_{ij} = G_{ij}$，$\\mathbf{I}$ 是 $N_c \\times 1$ 的未知电流矢量，$\\mathbf{b}$ 是 $N_p \\times 1$ 的矢量，其所有元素均为 $\\psi_b$。\n\n#### 3. 计算策略：Tikhonov正则化最小二乘法\n\n矩阵 $\\mathbf{A}$ 可能是病态的，意味着 $\\mathbf{b}$ 的微小变化可能导致解 $\\mathbf{I}$ 的巨大变化。当线圈彼此靠近或远离等离子体时，这种情况很常见。为了找到一个稳定且具有物理意义的解，我们使用Tikhonov正则化。我们寻求最小化一个同时惩罚解误差和电流量值的成本函数：\n$$\n\\mathbf{I}^\\star = \\arg\\min_{\\mathbf{I}} \\left\\| \\mathbf{A} \\mathbf{I} - \\mathbf{b} \\right\\|_2^2 + \\lambda^2 \\left\\| \\mathbf{I} \\right\\|_2^2\n$$\n其中 $\\lambda$ 是正则化参数。该最小化问题的解通过求解相关的正规方程得到：\n$$\n\\left(\\mathbf{A}^\\top \\mathbf{A} + \\lambda^2 \\mathbf{I}_{N_c}\\right) \\mathbf{I}^\\star = \\mathbf{A}^\\top \\mathbf{b}\n$$\n其中 $\\mathbf{I}_{N_c}$ 是 $N_c \\times N_c$ 的单位矩阵。对于 $\\lambda > 0$，这个线性系统是良态的，可以可靠地求解出最优电流矢量 $\\mathbf{I}^\\star$。\n\n#### 4. 敏感度分析\n\n为评估线圈配置的质量和鲁棒性，计算两个度量指标：\n- **条件数**：未正则化矩阵 $\\mathbf{A}$ 的 $2$-范数条件数 $\\kappa_2(\\mathbf{A}) = \\sigma_{\\max}(\\mathbf{A}) / \\sigma_{\\min}(\\mathbf{A})$，用于衡量误差的放大程度。大的 $\\kappa_2$ 值表明问题是病态的，线圈组难以在边界上产生独立的场形。它由 $\\mathbf{A}$ 的最大（$\\sigma_{\\max}$）和最小（$\\sigma_{\\min}$）奇异值计算得出。\n- **扰动敏感度（$\\delta$）**：使用有限差分方法来量化解对线圈放置误差的敏感度。线圈位置受到一个小的垂直位移扰动，$(R_j, Z_j) \\rightarrow (R_j, Z_j + \\Delta Z)$，计算一个新的矩阵 $\\mathbf{A}_{\\text{pert}}$，并找到新的电流矢量 $\\mathbf{I}^{\\star,\\text{pert}}$。解矢量的相对变化计算如下：\n$$\n\\delta = \\frac{\\left\\| \\mathbf{I}^{\\star,\\text{pert}} - \\mathbf{I}^\\star \\right\\|_2}{\\left\\| \\mathbf{I}^\\star \\right\\|_2}\n$$\n\n### 算法实现\n\n对每个测试案例，通过以下步骤实现解决方案：\n1.  设置物理和数值常数：$\\mu_0$, $\\lambda = 10^{-3}$, $\\Delta Z = 0.01$。定义测试案例参数：等离子体形状（$R_0, a_p, \\kappa$），目标磁通 $\\psi_b$，以及线圈位置。\n2.  使用参数方程 $R(\\theta) = R_0 + a_p \\cos\\theta$ 和 $Z(\\theta) = \\kappa a_p \\sin\\theta$（对于 $\\theta \\in \\{0, \\frac{\\pi}{4}, \\dots, \\frac{7\\pi}{4}\\}$）生成 $N_p=8$ 个等离子体边界点 $(R_i, Z_i)$。\n3.  实现一个函数，用于计算单个线圈产生的单位电流磁通 $\\psi_j(R, Z)$，使用提供的公式和 `scipy.special` 中的椭圆积分。\n4.  通过用线圈 $j$ 在单位电流下于边界点 $i$ 处产生的磁通填充每个元素 $A_{ij}$ 来构建矩阵 $\\mathbf{A}$。\n5.  构建目标矢量 $\\mathbf{b}$，它是一个大小为 $N_p$、所有值均为 $\\psi_b$ 的矢量。\n6.  求解正则化正规方程 $\\left(\\mathbf{A}^\\top \\mathbf{A} + \\lambda^2 \\mathbf{I}_{N_c}\\right) \\mathbf{I}^\\star = \\mathbf{A}^\\top \\mathbf{b}$ 来找到基准电流矢量 $\\mathbf{I}^\\star$。\n7.  计算 $\\mathbf{A}$ 的奇异值，并计算条件数 $\\kappa_2(\\mathbf{A})$。如果 $\\sigma_{\\min}$ 在数值上为零，则条件数视为无穷大。\n8.  将所有线圈的垂直位置扰动 $\\Delta Z$。\n9.  重新计算矩阵 $\\mathbf{A}_{\\text{pert}}$ 并求解扰动后的电流矢量 $\\mathbf{I}^{\\star,\\text{pert}}$。\n10. 计算敏感度度量 $\\delta$。\n11. 收集该测试案例的结果：电流列表 $\\mathbf{I}^\\star$、条件数 $\\kappa_2$ 和敏感度 $\\delta$。\n12. 对所有测试案例重复以上步骤，并将收集到的结果格式化为指定的单行字符串。非有限浮点结果（例如，条件数为无穷大）将被替换为可表示的最大 `float64` 值，以确保有效的数值输出字符串。", "answer": "```python\nimport numpy as np\nfrom scipy.special import ellipk, ellipe\nfrom scipy.constants import mu_0\nimport json\n\ndef _calculate_psi_unit_current(R_target, Z_target, R_coil, Z_coil):\n    \"\"\"\n    Calculates the poloidal flux at (R_target, Z_target) from a single coil\n    at (R_coil, Z_coil) with unit current (1 Ampere).\n    \n    Args:\n        R_target (float): Major radius of the target point.\n        Z_target (float): Vertical position of the target point.\n        R_coil (float): Major radius of the coil (which is also its radius 'a').\n        Z_coil (float): Vertical position of the coil.\n\n    Returns:\n        float: Poloidal flux psi in Webers for a 1 Ampere current.\n    \"\"\"\n    if R_target == 0 or R_coil == 0:\n        return 0.0\n\n    k2_num = 4.0 * R_coil * R_target\n    k2_den = (R_coil + R_target)**2 + (Z_target - Z_coil)**2\n\n    if k2_den == 0.0:\n        return np.inf  # Should not happen as points are distinct\n\n    k2 = k2_num / k2_den\n    \n    # Due to floating point issues, k2 can slightly exceed 1.\n    if k2 > 1.0:\n        k2 = 1.0\n    \n    if k2 == 1.0:\n        return np.inf\n\n    k = np.sqrt(k2)\n    K_m = ellipk(k2)\n    E_m = ellipe(k2)\n\n    # A_phi = (mu_0 * I) / (2 * pi) * (1/k) * sqrt(a/R) * [ (2-k^2)K(k^2) - 2E(k^2) ]\n    # with a = R_coil, R = R_target, I = 1.\n    term1 = (1.0 / k) * np.sqrt(R_coil / R_target)\n    term2 = (2.0 - k2) * K_m - 2.0 * E_m\n    \n    A_phi = (mu_0 / (2.0 * np.pi)) * term1 * term2\n    \n    psi = R_target * A_phi\n    return psi\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: well-posed shaping\n        {\n            \"R0\": 3.0, \"ap\": 1.0, \"kappa\": 1.7, \"psi_b\": 1.0,\n            \"coils\": [(3.0, 1.6), (3.0, -1.6), (5.0, 0.0), (1.5, 0.0)]\n        },\n        # Test Case 2: nearly collinear coils\n        {\n            \"R0\": 3.0, \"ap\": 1.0, \"kappa\": 1.7, \"psi_b\": 1.0,\n            \"coils\": [(3.5, 0.0), (3.6, 0.0), (3.7, 0.0)]\n        },\n        # Test Case 3: coils placed far from plasma\n        {\n            \"R0\": 3.0, \"ap\": 1.0, \"kappa\": 1.7, \"psi_b\": 1.0,\n            \"coils\": [(8.0, 3.5), (8.0, -3.5), (0.5, 3.5), (0.5, -3.5)]\n        }\n    ]\n\n    lambda_reg = 1.0e-3\n    delta_Z_pert = 0.01\n    Np = 8\n    \n    thetas = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n    \n    all_results = []\n\n    for case in test_cases:\n        Nc = len(case['coils'])\n        R_pts = case['R0'] + case['ap'] * np.cos(thetas)\n        Z_pts = case['kappa'] * case['ap'] * np.sin(thetas)\n\n        def get_currents(coil_locations):\n            A = np.zeros((Np, Nc))\n            for i in range(Np):\n                for j in range(Nc):\n                    R_c, Z_c = coil_locations[j]\n                    A[i, j] = _calculate_psi_unit_current(R_pts[i], Z_pts[i], R_c, Z_c)\n            \n            b = np.full(Np, case['psi_b'])\n            \n            M = A.T @ A + lambda_reg**2 * np.eye(Nc)\n            v = A.T @ b\n            I_star = np.linalg.solve(M, v)\n            return A, I_star\n\n        # --- Base Calculation ---\n        A_base, I_star_base = get_currents(case['coils'])\n\n        # --- Sensitivity Metrics ---\n        # 1. Condition Number\n        singular_values = np.linalg.svd(A_base, compute_uv=False)\n        s_min = singular_values.min()\n        if s_min < np.finfo(float).eps * singular_values.max():\n             kappa_2 = np.inf\n        else:\n             kappa_2 = singular_values.max() / s_min\n\n        # 2. Perturbation Sensitivity\n        perturbed_coils = [(R_c, Z_c + delta_Z_pert) for R_c, Z_c in case['coils']]\n        _, I_star_pert = get_currents(perturbed_coils)\n\n        norm_I_base = np.linalg.norm(I_star_base)\n        if norm_I_base == 0:\n            delta = np.inf if np.linalg.norm(I_star_pert) > 0 else 0.0\n        else:\n            delta = np.linalg.norm(I_star_pert - I_star_base) / norm_I_base\n        \n        all_results.append([I_star_base.tolist(), kappa_2, delta])\n\n    # --- Format Output ---\n    # Convert non-finite floats to max float value for valid JSON-like numeric output\n    max_float = np.finfo(np.float64).max\n    for i in range(len(all_results)):\n        if not np.isfinite(all_results[i][1]):\n            all_results[i][1] = max_float\n        if not np.isfinite(all_results[i][2]):\n            all_results[i][2] = max_float\n    \n    # Use json.dumps for robust, compact formatting without spaces.\n    print(json.dumps(all_results, separators=(',', ':')))\n\nsolve()\n```", "id": "3723089"}]}