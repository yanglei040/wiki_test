{
        "hands_on_practices": [
            {
                "introduction": "要真正掌握一个算法，最好的方法就是从最简单的例子入手。这个练习将广义最小残差方法（GMRES）简化为其最核心的步骤：在第一次迭代中，我们在初始残差的方向上寻找最优解。通过手工计算一个 $2 \\times 2$ 系统的单步 GMRES [@problem_id:2214790]，你将直观地理解该方法如何通过最小化残差范数来逼近解，为后续更复杂的迭代过程打下坚实的基础。",
                "problem": "广义最小残差（GMRES）方法是一种迭代算法，用于求解线性方程组 $Ax=b$ 的近似解。考虑由矩阵 $A$ 和向量 $b$ 定义的线性系统：\n$$\nA = \\begin{pmatrix} 2  1 \\\\ -1  3 \\end{pmatrix}, \\quad b = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n从初始猜测 $x_0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 开始，应用一步 GMRES 算法求出第一个近似解 $x_1$。将你的答案表示为一个分量为有理数的列向量。",
                "solution": "GMRES 在仿射空间 $x_{0}+\\mathcal{K}_{1}(A,r_{0})$ 上最小化残差的 2-范数，其中 $r_{0}=b-Ax_{0}$ 且 $\\mathcal{K}_{1}(A,r_{0})=\\mathrm{span}\\{r_{0}\\}$。当 $x_{0}=\\begin{pmatrix}0\\\\0\\end{pmatrix}$ 时，我们有\n$$\nr_{0}=b=\\begin{pmatrix}1\\\\2\\end{pmatrix}.\n$$\n经过一步 GMRES 迭代后，$x_{1}$ 的形式为 $x_{1}=x_{0}+\\alpha r_{0}$，其中选择 $\\alpha$ 以最小化\n$$\n\\|b-A(x_{0}+\\alpha r_{0})\\|_{2}=\\|r_{0}-\\alpha A r_{0}\\|_{2}.\n$$\n令 $w=A r_{0}$。那么最小化问题是 $\\min_{\\alpha}\\|r_{0}-\\alpha w\\|_{2}^{2}$。使用欧几里得内积，定义\n$$\n\\phi(\\alpha)=(r_{0}-\\alpha w)^{T}(r_{0}-\\alpha w)=r_{0}^{T}r_{0}-2\\alpha w^{T}r_{0}+\\alpha^{2}w^{T}w.\n$$\n令 $\\frac{d\\phi}{d\\alpha}=0$ 可得\n$$\n-2\\,w^{T}r_{0}+2\\alpha\\,w^{T}w=0 \\quad\\Rightarrow\\quad \\alpha=\\frac{w^{T}r_{0}}{w^{T}w}.\n$$\n计算 $w$ 和所需的内积：\n$$\nw=A r_{0}=A b=\\begin{pmatrix}2  1\\\\ -1  3\\end{pmatrix}\\begin{pmatrix}1\\\\2\\end{pmatrix}=\\begin{pmatrix}4\\\\5\\end{pmatrix},\\quad\nw^{T}r_{0}=\\begin{pmatrix}4  5\\end{pmatrix}\\begin{pmatrix}1\\\\2\\end{pmatrix}=14,\\quad\nw^{T}w=4^{2}+5^{2}=41.\n$$\n因此\n$$\n\\alpha=\\frac{14}{41},\\qquad x_{1}=x_{0}+\\alpha r_{0}=\\frac{14}{41}\\begin{pmatrix}1\\\\2\\end{pmatrix}=\\begin{pmatrix}\\frac{14}{41}\\\\ \\frac{28}{41}\\end{pmatrix}.\n$$\n这个 $x_{1}$ 是 GMRES(1) 的迭代解，即在 $x_{0}+\\mathrm{span}\\{r_{0}\\}$ 上残差范数的最小化子。",
                "answer": "$$\\boxed{\\begin{pmatrix}\\frac{14}{41}\\\\ \\frac{28}{41}\\end{pmatrix}}$$",
                "id": "2214790"
            },
            {
                "introduction": "理解了单步 GMRES 的核心思想后，我们来深入探讨算法在多次迭代中的完整工作流程。这个练习 [@problem_id:3616841] 将引导你手动执行一个小型 $3 \\times 3$ 非对称系统的两步 GMRES 迭代。你将亲身实践 Arnoldi 过程来构建 Krylov 子空间的正交基，并使用 Givens 旋转来高效地求解产生的最小二乘子问题，从而全面了解 GMRES 算法内部的精妙机制。",
                "problem": "考虑一个小型非对称线性系统，该系统由用于线性化地震走时层析成像的一维稳态对流扩散算子的粗糙有限体积离散化产生。设系统矩阵为\n$$\nA = \\begin{pmatrix}\n1  0  0 \\\\\n1  3  0 \\\\\n0  1  2\n\\end{pmatrix},\n$$\n右端项为\n$$\nb = \\begin{pmatrix}\n1 \\\\\n0 \\\\\n0\n\\end{pmatrix},\n$$\n初始猜测值为\n$$\nx_0 = \\begin{pmatrix}\n0 \\\\\n0 \\\\\n0\n\\end{pmatrix}.\n$$\n从初始残差 $r_0 = b - A x_0$ 开始，执行两步 Arnoldi 过程，构建 $m = 2$ 时的标准正交基 $V_{m+1}$ 和 $(m+1) \\times m$ 的上 Hessenberg 矩阵 $\\bar{H}_m$。然后，对 $\\bar{H}_m$ 应用两次连续的 Givens 旋转以消除其次对角线元素，从而得到一个上三角矩阵 $R_m$，同时更新变换后的右端项。使用此结果显式地计算广义最小残差 (GMRES) 迭代解 $x_m = x_0 + V_m y$ 和残差 $r_m = b - A x_m$。将 $x_m$ 的三个分量和 $r_m$ 的三个分量作为一个单行矩阵报告。无需四舍五入，也无需物理单位。在首次使用广义最小残差 (GMRES) 时对其进行定义，并从基本原理出发，从 Krylov 子空间的构建和标准正交化开始。",
                "solution": "首先对问题进行验证，以确保其是适定的、有科学依据的和自洽的。\n\n### 步骤 1：提取给定信息\n- 系统矩阵：$A = \\begin{pmatrix} 1  0  0 \\\\ 1  3  0 \\\\ 0  1  2 \\end{pmatrix}$\n- 右端向量：$b = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$\n- 初始猜测值：$x_0 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$\n- GMRES 步数 (Krylov 子空间维度)：$m = 2$\n\n### 步骤 2：使用提取的信息进行验证\n- **有科学依据**：该问题探讨了广义最小残差 (GMRES) 方法，这是数值线性代数中用于求解非对称线性系统的标准和基本算法。地震层析成像的背景是此类方法的有效应用领域。该问题在数学上和科学上都是合理的。\n- **适定性**：矩阵 $A$ 是一个 $3 \\times 3$ 的下三角矩阵。其行列式是对角线元素的乘积，$\\det(A) = 1 \\cdot 3 \\cdot 2 = 6 \\neq 0$。由于矩阵是非奇异的，系统 $Ax = b$ 存在唯一解。该问题要求执行一个明确定义的算法 (GMRES) 的特定步数，这将导出一个唯一的迭代解 $x_2$。\n- **目标明确**：该问题使用精确的数学定义进行陈述，不含主观或模糊的语言。\n- **完整性**：所有执行所需计算的必要数据（$A$、$b$、$x_0$ 和 $m$）均已提供。\n\n### 步骤 3：结论与行动\n问题有效。将提供详细的解答。\n\n---\n\n广义最小残差 (GMRES) 方法是一种求解线性方程组 $Ax = b$ 的迭代算法，尤其适用于矩阵 $A$ 是大型、稀疏和非对称的情况。从一个初始猜测值 $x_0$ 开始，GMRES 在仿射空间 $x_0 + K_m(A, r_0)$ 中寻找一个近似解 $x_m$，其中 $K_m(A, r_0) = \\text{span}\\{r_0, Ar_0, \\dots, A^{m-1}r_0\\}$ 是由 $A$ 和初始残差 $r_0 = b - Ax_0$ 生成的 $m$ 维 Krylov 子空间。迭代解 $x_m$ 的选择是为了最小化残差的欧几里得范数，即 $x_m = \\arg \\min_{z \\in x_0 + K_m} \\|b - Az\\|_2$。\n\n求解过程包括三个主要阶段：\n1.  使用 Arnoldi 过程为 Krylov 子空间 $K_{m+1}(A, r_0)$ 生成一个标准正交基 $V_{m+1}$ 和一个上 Hessenberg 矩阵 $\\bar{H}_m$。\n2.  求解一个小型最小二乘问题，以找到在 Krylov 子空间中最小化残差的向量 $y_m$。\n3.  计算近似解 $x_m = x_0 + V_m y_m$ 和相应的残差 $r_m = b - A x_m$。\n\n现在我们将针对给定问题执行这些步骤，其中 $m=2$。\n\n**1. 初始设置与 Arnoldi 过程**\n\n首先，计算初始残差 $r_0$：\n$$\nr_0 = b - A x_0 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 1  0  0 \\\\ 1  3  0 \\\\ 0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n其范数为 $\\|r_0\\|_2 = \\sqrt{1^2 + 0^2 + 0^2} = 1$。\nKrylov 子空间的第一个基向量是：\n$$\nv_1 = \\frac{r_0}{\\|r_0\\|_2} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n现在，我们执行 $m=2$ 步 Arnoldi 过程。\n\n**步骤 k=1：**\n计算 $w_1 = A v_1$：\n$$\nw_1 = \\begin{pmatrix} 1  0  0 \\\\ 1  3  0 \\\\ 0  1  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n将 $w_1$ 与之前的基向量（仅 $v_1$）正交化：\n$$\nh_{1,1} = v_1^T w_1 = \\begin{pmatrix} 1  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} = 1\n$$\n$$\n\\tilde{w}_1 = w_1 - h_{1,1} v_1 = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} - 1 \\cdot \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n计算范数和下一个基向量：\n$$\nh_{2,1} = \\|\\tilde{w}_1\\|_2 = \\sqrt{0^2 + 1^2 + 0^2} = 1\n$$\n$$\nv_2 = \\frac{\\tilde{w}_1}{h_{2,1}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n\n**步骤 k=2：**\n计算 $w_2 = A v_2$：\n$$\nw_2 = \\begin{pmatrix} 1  0  0 \\\\ 1  3  0 \\\\ 0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 3 \\\\ 1 \\end{pmatrix}\n$$\n将 $w_2$ 与 $v_1$ 和 $v_2$ 正交化：\n$$\nh_{1,2} = v_1^T w_2 = \\begin{pmatrix} 1  0  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 3 \\\\ 1 \\end{pmatrix} = 0\n$$\n$$\nh_{2,2} = v_2^T w_2 = \\begin{pmatrix} 0  1  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 3 \\\\ 1 \\end{pmatrix} = 3\n$$\n$$\n\\tilde{w}_2 = w_2 - h_{1,2} v_1 - h_{2,2} v_2 = \\begin{pmatrix} 0 \\\\ 3 \\\\ 1 \\end{pmatrix} - 0 \\cdot \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 3 \\cdot \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n计算范数和下一个基向量：\n$$\nh_{3,2} = \\|\\tilde{w}_2\\|_2 = \\sqrt{0^2 + 0^2 + 1^2} = 1\n$$\n$$\nv_3 = \\frac{\\tilde{w}_2}{h_{3,2}} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\nArnoldi 过程产生标准正交基矩阵 $V_3 = [v_1, v_2, v_3] = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} = I$ 和 $(m+1) \\times m = 3 \\times 2$ 的上 Hessenberg 矩阵 $\\bar{H}_2$：\n$$\n\\bar{H}_2 = \\begin{pmatrix} h_{1,1}  h_{1,2} \\\\ h_{2,1}  h_{2,2} \\\\ 0  h_{3,2} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 1  3 \\\\ 0  1 \\end{pmatrix}\n$$\n\n**2. 最小二乘问题与 Givens 旋转**\n\nGMRES 迭代解为 $x_m = x_0 + V_m y_m$，其中 $y_m$ 求解最小二乘问题：\n$$\ny_m = \\arg \\min_{y \\in \\mathbb{R}^m} \\| \\|r_0\\|_2 e_1 - \\bar{H}_m y \\|_2\n$$\n对于 $m=2$，且 $\\|r_0\\|_2=1$，该问题变为：\n$$\ny_2 = \\arg \\min_{y \\in \\mathbb{R}^2} \\left\\| \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 1  0 \\\\ 1  3 \\\\ 0  1 \\end{pmatrix} y \\right\\|_2\n$$\n我们通过应用一系列 Givens 旋转将 $\\bar{H}_2$ 转换为上三角矩阵 $R_2$ 来解决这个问题。\n\n**第一次 Givens 旋转 $\\Omega_1$：**\n为了消除元素 $h_{2,1}=1$，我们对第 1 行和第 2 行应用旋转。\n设 $a = h_{1,1} = 1$ 和 $b = h_{2,1} = 1$。旋转系数为 $c = \\frac{a}{\\sqrt{a^2+b^2}} = \\frac{1}{\\sqrt{2}}$ 和 $s = \\frac{b}{\\sqrt{a^2+b^2}} = \\frac{1}{\\sqrt{2}}$。\n旋转矩阵为 $\\Omega_1 = \\begin{pmatrix} c  s  0 \\\\ -s  c  0 \\\\ 0  0  1 \\end{pmatrix} = \\begin{pmatrix} 1/\\sqrt{2}  1/\\sqrt{2}  0 \\\\ -1/\\sqrt{2}  1/\\sqrt{2}  0 \\\\ 0  0  1 \\end{pmatrix}$。\n将 $\\Omega_1$ 应用于 $\\bar{H}_2$：\n$$\n\\Omega_1 \\bar{H}_2 = \\begin{pmatrix} 1/\\sqrt{2}  1/\\sqrt{2}  0 \\\\ -1/\\sqrt{2}  1/\\sqrt{2}  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 1  3 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} \\sqrt{2}  3/\\sqrt{2} \\\\ 0  3/\\sqrt{2} \\\\ 0  1 \\end{pmatrix}\n$$\n将 $\\Omega_1$ 应用于右端向量 $g = \\|r_0\\|_2 e_1 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$：\n$$\n\\Omega_1 g = \\begin{pmatrix} 1/\\sqrt{2}  1/\\sqrt{2}  0 \\\\ -1/\\sqrt{2}  1/\\sqrt{2}  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/\\sqrt{2} \\\\ -1/\\sqrt{2} \\\\ 0 \\end{pmatrix}\n$$\n\n**第二次 Givens 旋转 $\\Omega_2$：**\n为了消除位置 $(3,2)$ 处的元素 $1$，我们对变换后系统的第 2 行和第 3 行应用旋转。\n设 $a = 3/\\sqrt{2}$ 和 $b = 1$。旋转系数为 $c = \\frac{a}{\\sqrt{a^2+b^2}} = \\frac{3/\\sqrt{2}}{\\sqrt{9/2+1}} = \\frac{3/\\sqrt{2}}{\\sqrt{11/2}} = \\frac{3}{\\sqrt{11}}$ 和 $s = \\frac{b}{\\sqrt{a^2+b^2}} = \\frac{1}{\\sqrt{11/2}} = \\frac{\\sqrt{2}}{\\sqrt{11}}$。\n旋转矩阵为 $\\Omega_2 = \\begin{pmatrix} 1  0  0 \\\\ 0  c  s \\\\ 0  -s  c \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  3/\\sqrt{11}  \\sqrt{2}/\\sqrt{11} \\\\ 0  -\\sqrt{2}/\\sqrt{11}  3/\\sqrt{11} \\end{pmatrix}$。\n将 $\\Omega_2$ 应用于 $\\Omega_1 \\bar{H}_2$：\n$$\n\\Omega_2 (\\Omega_1 \\bar{H}_2) = \\begin{pmatrix} 1  0  0 \\\\ 0  3/\\sqrt{11}  \\sqrt{2}/\\sqrt{11} \\\\ 0  -\\sqrt{2}/\\sqrt{11}  3/\\sqrt{11} \\end{pmatrix} \\begin{pmatrix} \\sqrt{2}  3/\\sqrt{2} \\\\ 0  3/\\sqrt{2} \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} \\sqrt{2}  3/\\sqrt{2} \\\\ 0  \\frac{9}{\\sqrt{22}} + \\frac{\\sqrt{2}}{\\sqrt{11}} \\\\ 0  \\frac{-3\\sqrt{2}}{\\sqrt{22}} + \\frac{3}{\\sqrt{11}} \\end{pmatrix} = \\begin{pmatrix} \\sqrt{2}  3/\\sqrt{2} \\\\ 0  \\sqrt{11/2} \\\\ 0  0 \\end{pmatrix}\n$$\n这给出了上三角矩阵 $R_2 = \\begin{pmatrix} \\sqrt{2}  3/\\sqrt{2} \\\\ 0  \\sqrt{11/2} \\end{pmatrix}$。\n将 $\\Omega_2$ 应用于变换后的右端项 $\\Omega_1 g$：\n$$\ng' = \\Omega_2 (\\Omega_1 g) = \\begin{pmatrix} 1  0  0 \\\\ 0  3/\\sqrt{11}  \\sqrt{2}/\\sqrt{11} \\\\ 0  -\\sqrt{2}/\\sqrt{11}  3/\\sqrt{11} \\end{pmatrix} \\begin{pmatrix} 1/\\sqrt{2} \\\\ -1/\\sqrt{2} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/\\sqrt{2} \\\\ -3/\\sqrt{22} \\\\ 1/\\sqrt{11} \\end{pmatrix}\n$$\n最小二乘问题现在等价于求解 $R_2 y_2 = g'_1$，其中 $g'_1$ 由 $g'$ 的前两个分量组成。\n$$\n\\begin{pmatrix} \\sqrt{2}  3/\\sqrt{2} \\\\ 0  \\sqrt{11/2} \\end{pmatrix} \\begin{pmatrix} y_1 \\\\ y_2 \\end{pmatrix} = \\begin{pmatrix} 1/\\sqrt{2} \\\\ -3/\\sqrt{22} \\end{pmatrix}\n$$\n通过回代求解：\n从第二行得到：\n$\\sqrt{11/2} \\cdot y_2 = -3/\\sqrt{22} \\implies y_2 = \\frac{-3}{\\sqrt{22}} \\frac{\\sqrt{2}}{\\sqrt{11}} = \\frac{-3}{\\sqrt{11}\\sqrt{2}} \\frac{\\sqrt{2}}{\\sqrt{11}} = -\\frac{3}{11}$。\n从第一行得到：\n$\\sqrt{2} \\cdot y_1 + (3/\\sqrt{2}) y_2 = 1/\\sqrt{2} \\implies \\sqrt{2} \\cdot y_1 + (3/\\sqrt{2})(-3/11) = 1/\\sqrt{2}$。\n$\\sqrt{2} \\cdot y_1 = 1/\\sqrt{2} + 9/(11\\sqrt{2}) = \\frac{11+9}{11\\sqrt{2}} = \\frac{20}{11\\sqrt{2}}$。\n$y_1 = \\frac{20}{11\\sqrt{2}} \\frac{1}{\\sqrt{2}} = \\frac{20}{22} = \\frac{10}{11}$。\n因此，$y_2 = \\begin{pmatrix} 10/11 \\\\ -3/11 \\end{pmatrix}$。\n\n**3. 计算解和残差**\n\nGMRES 迭代解 $x_2$ 是：\n$$\nx_2 = x_0 + V_2 y_2 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 10/11 \\\\ -3/11 \\end{pmatrix} = \\begin{pmatrix} 10/11 \\\\ -3/11 \\\\ 0 \\end{pmatrix}\n$$\n最终残差 $r_2$ 是：\n$$\nr_2 = b - A x_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 1  0  0 \\\\ 1  3  0 \\\\ 0  1  2 \\end{pmatrix} \\begin{pmatrix} 10/11 \\\\ -3/11 \\\\ 0 \\end{pmatrix}\n$$\n$$\nA x_2 = \\begin{pmatrix} 1 \\cdot (10/11) \\\\ 1 \\cdot (10/11) + 3 \\cdot (-3/11) \\\\ 1 \\cdot (-3/11) \\end{pmatrix} = \\begin{pmatrix} 10/11 \\\\ 1/11 \\\\ -3/11 \\end{pmatrix}\n$$\n$$\nr_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 10/11 \\\\ 1/11 \\\\ -3/11 \\end{pmatrix} = \\begin{pmatrix} 1/11 \\\\ -1/11 \\\\ 3/11 \\end{pmatrix}\n$$\n最终结果由 $x_2$ 的三个分量和 $r_2$ 的三个分量组成。\n$x_2 = (10/11, -3/11, 0)$\n$r_2 = (1/11, -1/11, 3/11)$",
                "answer": "$$\n\\boxed{\n\\begin{pmatrix} \\frac{10}{11}  -\\frac{3}{11}  0  \\frac{1}{11}  -\\frac{1}{11}  \\frac{3}{11} \\end{pmatrix}\n}\n$$",
                "id": "3616841"
            },
            {
                "introduction": "理论计算和实际的数值计算之间存在着一道鸿沟，这道鸿沟主要由有限精度算术引起。最后一个练习将带你从纸笔计算走向计算实现，直面 GMRES 在实践中遇到的核心挑战之一：数值稳定性 [@problem_id:3616879]。你将设计一个计算实验，通过量化 Arnoldi 过程中基向量之间正交性的损失，来探索当 Krylov 向量变得近乎共线时，算法的稳定性会如何受到影响。这对于在高性能计算中有效应用 GMRES 至关重要。",
                "problem": "您的任务是设计并实现一个计算过程，该过程用于量化通过 Arnoldi 过程为离散一维 Helmholtz 算子生成的广义最小残差方法（GMRES）中连续 Krylov 向量之间的角度关系。目标是测量在正交归一化之前，连续的 Krylov 方向有多接近共线，以及计算出的 Arnoldi 基向量有多接近正交，并在数值稳定性的背景下解释这些度量。\n\n从以下基本概念开始：\n- 线性系统形式为 $A x = b$，其中 $A$ 是一个方阵，$x$ 是未知向量，$b$ 是给定的右端向量。\n- 由 $A$ 和初始残差 $r_0$ 生成的 $m$ 维 Krylov 子空间为 $\\mathcal{K}_m(A,r_0) = \\operatorname{span}\\{ r_0, A r_0, A^2 r_0, \\ldots, A^{m-1} r_0\\}$。\n- Arnoldi 过程构建了 $\\mathcal{K}_m(A,r_0)$ 的一个标准正交基 $\\{ v_1, v_2, \\ldots, v_m \\}$ 和一个上 Hessenberg 矩阵 $H_m$，满足 $A V_m = V_{m+1} H_m$，其中 $V_m = [v_1,\\ldots,v_m]$ 且 $V_{m+1} = [v_1,\\ldots,v_{m+1}]$。\n- 两个向量 $u$ 和 $v$ 之间的欧几里得内积为 $\\langle u, v \\rangle = u^\\top v$，欧几里得范数为 $\\| v \\|_2 = \\sqrt{v^\\top v}$，非零向量 $u$ 和 $v$ 之间的角度 $\\theta$ 定义为 $\\cos(\\theta) = \\frac{|\\langle u, v \\rangle|}{\\|u\\|_2 \\|v\\|_2}$，其中 $\\theta \\in [0,\\pi]$。\n\n算子与离散化：\n- 考虑在长度为 $L = 1$ 的单位区间上具有齐次 Dirichlet 边界条件的一维频域声学 Helmholtz 算子\n$$\nA = -\\frac{d^2}{dx^2} - k^2,\n$$\n其中 $k$ 是波数。使用二阶中心有限差分在 $n$ 个内部网格点上进行离散化，步长为 $h = \\frac{L}{n+1}$，以获得 $n \\times n$ 矩阵\n$$\nA = \\frac{1}{h^2} \\operatorname{tridiag}(-1, 2, -1) - k^2 I,\n$$\n其中 $I$ 是单位矩阵，$\\operatorname{tridiag}(-1,2,-1)$ 表示主对角线为 2，第一副对角线和第一超对角线为 -1 的三对角矩阵。\n\n初始化与 Arnoldi 过程：\n- 使用零初始猜测 $x_0 = 0$，因此初始残差为 $r_0 = b$，并选择右端项为 $b_i = \\sin(\\pi x_i)$，其中 $x_i = i h$，$i = 1, 2, \\ldots, n$。\n- 使用经典 Gram-Schmidt 方法（不进行重正交化）实现 $m$ 步 Arnoldi 过程，以产生 Arnoldi 向量 $\\{v_1, \\ldots, v_m\\}$。将 $v_1$ 归一化为 $v_1 = r_0 / \\| r_0 \\|_2$。\n\n角度计算与稳定性度量：\n- 在每次 Arnoldi 迭代 $i$（$i = 1, 2, \\ldots, m-1$）中，使用以下公式计算当前 Krylov 向量 $v_i$ 与下一个正交归一化之前的 Krylov 方向（即 $A v_i$）之间的原始角度\n$$\n\\theta_i^{\\text{raw}} = \\arccos\\left( \\frac{|\\langle v_i, A v_i \\rangle|}{\\| v_i \\|_2 \\, \\| A v_i \\|_2} \\right).\n$$\n- 同时，计算正交归一化后连续 Arnoldi 基向量之间的角度，\n$$\n\\theta_i^{\\text{basis}} = \\arccos\\left( |\\langle v_i, v_{i+1} \\rangle| \\right),\n$$\n在精确算术中，该角度理想情况下应等于 $\\frac{\\pi}{2}$。将与正交性的偏差量化为\n$$\n\\delta_i = \\left| \\theta_i^{\\text{basis}} - \\frac{\\pi}{2} \\right|.\n$$\n- 对于每个测试用例，报告一对稳定性度量：迭代过程中的最小原始角度 $\\min_{1 \\le i \\le m-1} \\theta_i^{\\text{raw}}$，以及迭代过程中的最大正交性偏差 $\\max_{1 \\le i \\le m-1} \\delta_i$。所有角度必须以弧度报告。\n\n测试套件：\n- 使用以下测试用例，每个用例以三元组 $(n, k, m)$ 的形式给出：\n    1. $(n, k, m) = (64, 0.0, 30)$: $k = 0$ 的纯拉普拉斯情况（对称正定算子）。\n    2. $(n, k, m) = (64, 3.13, 30)$: 波数接近 $n=64$ 时 $-\\frac{d^2}{dx^2}$ 最小特征值的平方根（近共振状态）。\n    3. $(n, k, m) = (128, 80.0, 50)$: 高波数不定状态。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例对应一个包含两个浮点数的列表，以弧度表示，形式为 $[\\min_i \\theta_i^{\\text{raw}}, \\max_i \\delta_i]$。例如，输出必须具有以下形式\n$$\n[\\,[a_1,b_1],[a_2,b_2],[a_3,b_3]\\,],\n$$\n但在打印的字符串中任何地方都不能有空格，即使用精确格式\n\"[ [a1,b1],[a2,b2],[a3,b3] ]\"，去除所有空格后成为 \"[[a1,b1],[a2,b2],[a3,b3]]\"。所有角度必须以弧度为单位。",
                "solution": "该问题是有效的。它提出了一个在数值线性代数领域中定义明确、有科学依据的任务，具体涉及将 Arnoldi 过程应用于离散 Helmholtz 算子时的稳定性问题。所有必要的数据、定义和条件都已提供，问题没有矛盾或含糊之处。\n\n解决方案首先构建离散算子，然后按照规定使用经典 Gram-Schmidt 实现 Arnoldi 过程，最后为每个测试用例计算所需的稳定性度量。\n\n### 算子离散化\n在单位区间 $L=1$ 上具有齐次 Dirichlet 边界条件的一维 Helmholtz 算子 $A = -\\frac{d^2}{dx^2} - k^2$，使用二阶中心有限差分方案在 $n$ 个内部点的网格上进行离散化。网格间距为 $h = \\frac{1}{n+1}$。这会得到算子的一个 $n \\times n$ 矩阵表示：\n$$\nA = \\frac{1}{h^2} \\operatorname{tridiag}(-1, 2, -1) - k^2 I\n$$\n其中 $I$ 是 $n \\times n$ 单位矩阵，$\\operatorname{tridiag}(-1, 2, -1)$ 是一个主对角线为 $2$、次对角线和超对角线为 $-1$ 的对称三对角矩阵。这个矩阵 $A$ 的性质严重依赖于波数 $k$：\n1.  当 $k=0$ 时，算子 $A$ 是离散拉普拉斯算子，它是一个对称正定（SPD）矩阵。\n2.  当 $k > 0$ 时，矩阵 $A$ 变为 $A = L - k^2 I$，其中 $L$ 是离散拉普拉斯算子。该矩阵是对称的，但如果 $k^2$ 大于 $L$ 的最小特征值，则可能是不定的。当 $k^2$ 接近 $L$ 的一个特征值时，对应于物理上的近共振状态，此时矩阵 $A$ 接近奇异，对迭代求解器构成了重大挑战。\n3.  对于大的 $k$，矩阵 $A$ 是高度不定的，其特征值分布在零的两侧，这也是一个计算上要求很高的情景。\n\n### Arnoldi 过程与稳定性度量\nArnoldi 过程为 Krylov 子空间 $\\mathcal{K}_m(A, r_0) = \\operatorname{span}\\{r_0, Ar_0, \\ldots, A^{m-1}r_0\\}$ 生成一个标准正交基 $\\{v_1, v_2, \\ldots, v_m\\}$。初始向量由初始残差导出。对于初始猜测 $x_0 = 0$，残差为 $r_0 = b - Ax_0 = b$。第一个基向量被归一化为 $v_1 = r_0 / \\|r_0\\|_2$。\n\n后续的基向量 $v_{i+1}$（对于 $i=1, \\ldots, m-1$）通过经典 Gram-Schmidt (CGS) 过程生成，该过程包括取向量 $Av_i$ 并将其与所有先前生成的基向量 $\\{v_1, \\ldots, v_i\\}$ 正交化。算法如下：\n1.  从 $v_1 = r_0 / \\|r_0\\|_2$ 开始。\n2.  对于 $i = 1, 2, \\ldots, m-1$：\n    a. 计算下一个方向：$w = Av_i$。\n    b. 将 $w$ 与当前基 $\\{v_1, \\ldots, v_i\\}$ 正交化：\n       对于 $j=1, \\ldots, i$：\n       $h_{ji} = \\langle v_j, w \\rangle$\n       $w \\leftarrow w - h_{ji} v_j$\n    c. 归一化新向量：$h_{i+1,i} = \\|w\\|_2$。\n    d. 新的基向量是 $v_{i+1} = w / h_{i+1,i}$。\n\n此过程执行 $m-1$ 步以生成基 $\\{v_1, \\ldots, v_m\\}$。在每一步 $i$，计算两个稳定性度量：\n\n1.  **原始角度 $\\theta_i^{\\text{raw}}$**：此度量是当前基向量 $v_i$ 与其在 $A$ 下的像 $Av_i$ 之间的角度，计算公式为：\n    $$\n    \\theta_i^{\\text{raw}} = \\arccos\\left( \\frac{|\\langle v_i, Av_i \\rangle|}{\\|v_i\\|_2 \\|Av_i\\|_2} \\right)\n    $$\n    由于 $\\|v_i\\|_2=1$，这简化为 $\\arccos(|\\langle v_i, Av_i \\rangle| / \\|Av_i\\|_2)$。$\\theta_i^{\\text{raw}}$ 的小值表示 $Av_i$ 与 $v_i$ 几乎对齐，这表明 $v_i$ 是 $A$ 的一个近似特征向量。这也可能意味着 Krylov 基变得病态，因为 $Av_i$ 提供的新信息与现有子空间并非强线性无关。我们报告 $\\min_i \\theta_i^{\\text{raw}}$。\n\n2.  **正交性偏差 $\\delta_i$**：此度量量化了连续生成的基向量之间的正交性损失，这是 CGS 算法由于浮点运算而存在的已知问题。它基于角度 $\\theta_i^{\\text{basis}} = \\arccos(|\\langle v_i, v_{i+1} \\rangle|)$ 定义：\n    $$\n    \\delta_i = \\left| \\theta_i^{\\text{basis}} - \\frac{\\pi}{2} \\right|\n    $$\n    在精确算术中，$\\langle v_i, v_{i+1} \\rangle = 0$，因此 $\\theta_i^{\\text{basis}}$ 将是 $\\frac{\\pi}{2}$，$\\delta_i$ 将是 $0$。非零的 $\\delta_i$ 表示数值上正交性的损失。大的 $\\delta_i$ 值表明基构建中存在严重的稳定性问题。我们报告 $\\max_i \\delta_i$。\n\n### 计算实现\n该解决方案使用 `NumPy` 库在 Python 中实现。\n- 为了效率，矩阵 $A$ 使用 `numpy.diag` 构建。\n- 右端向量 $b$ 是根据网格点上指定的正弦函数形成的。\n- 一个主循环从 $i=1$ 迭代到 $m-1$。在每次迭代中，它执行一步基于 CGS 的 Arnoldi 过程，从 $v_i$ 和现有基 $\\{v_1, \\ldots, v_i\\}$ 计算 $v_{i+1}$。\n- 在此循环内，计算并存储 $\\theta_i^{\\text{raw}}$ 和 $\\delta_i$ 的值。\n- 循环完成后，确定所有计算出的 $\\theta_i^{\\text{raw}}$ 的最小值和所有 $\\delta_i$ 的最大值。\n- 此过程应用于问题陈述中提供的三个测试用例 $(n, k, m)$ 中的每一个，并将最终结果格式化为所需的字符串输出。",
                "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef arnoldi_stability_analysis(n, k, m):\n    \"\"\"\n    Performs Arnoldi process using Classical Gram-Schmidt and computes stability metrics.\n\n    Args:\n        n (int): Number of interior grid points.\n        k (float): Wavenumber.\n        m (int): Number of Arnoldi iterations to produce m basis vectors.\n\n    Returns:\n        A list containing two floats: [min_raw_angle, max_ortho_deviation].\n    \"\"\"\n    # Part 1: Setup Operator and Initial Vectors\n    h = 1.0 / (n + 1.0)\n    \n    # Construct the discrete Helmholtz operator A\n    main_diag = np.full(n, 2.0 / h**2 - k**2)\n    off_diag = np.full(n - 1, -1.0 / h**2)\n    A = np.diag(main_diag) + np.diag(off_diag, k=1) + np.diag(off_diag, k=-1)\n    \n    # Construct the right-hand side vector b\n    x_grid = np.arange(1, n + 1) * h\n    b = np.sin(np.pi * x_grid)\n    \n    # Initialize for Arnoldi: r0 = b, v1 = r0 / ||r0||\n    r0 = b\n    norm_r0 = np.linalg.norm(r0)\n    v1 = r0 / norm_r0\n    \n    # Store basis vectors in a list\n    v_list = [v1]\n    \n    raw_angles = []\n    ortho_deviations = []\n    \n    # Part 2: Arnoldi Iteration Loop\n    # The loop runs m-1 times to produce v_2, ..., v_m and the corresponding metrics.\n    # The problem indices are i = 1, ..., m-1.\n    # Loop index `j` from 0 to m-2 corresponds to problem index i = j+1.\n    for j in range(m - 1):\n        # Current vector is v_{j+1}, which is v_list[j]\n        v_current = v_list[j]\n        \n        # Compute the next Krylov direction before orthonormalization\n        Av_current = A @ v_current\n        \n        # 2a: Compute raw angle theta_{j+1}^raw\n        norm_Av = np.linalg.norm(Av_current)\n        if norm_Av  np.finfo(float).eps:\n            # This would be a breakdown, unlikely here.\n            break\n            \n        cos_theta_raw_arg = np.abs(np.dot(v_current, Av_current)) / norm_Av\n        # Clamp argument to arccos to handle potential floating point inaccuracies\n        cos_theta_raw_arg = min(1.0, cos_theta_raw_arg)\n        \n        theta_raw = np.arccos(cos_theta_raw_arg)\n        raw_angles.append(theta_raw)\n        \n        # 2b: Classical Gram-Schmidt to compute v_{j+2}\n        w_ortho = Av_current\n        # Orthogonalize against v_1, ..., v_{j+1}\n        for v_prev in v_list:\n            h = np.dot(v_prev, w_ortho)\n            w_ortho = w_ortho - h * v_prev\n            \n        norm_w = np.linalg.norm(w_ortho)\n        if norm_w  np.finfo(float).eps:\n            # Breakdown of Arnoldi process\n            break\n            \n        v_next = w_ortho / norm_w\n        \n        # 2c: Compute orthogonality deviation delta_{j+1}\n        cos_theta_basis_arg = np.abs(np.dot(v_current, v_next))\n        # Clamp argument to arccos\n        cos_theta_basis_arg = min(1.0, cos_theta_basis_arg)\n        \n        theta_basis = np.arccos(cos_theta_basis_arg)\n        delta = np.abs(theta_basis - np.pi / 2.0)\n        ortho_deviations.append(delta)\n        \n        # Add the new basis vector to the list\n        v_list.append(v_next)\n        \n    # Part 3: Calculate final metrics\n    min_raw_angle = np.min(raw_angles) if raw_angles else np.nan\n    max_ortho_dev = np.max(ortho_deviations) if ortho_deviations else np.nan\n    \n    return [min_raw_angle, max_ortho_dev]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (64, 0.0, 30),\n        (64, 3.13, 30),\n        (128, 80.0, 50),\n    ]\n\n    results = []\n    for case in test_cases:\n        n_val, k_val, m_val = case\n        result = arnoldi_stability_analysis(n_val, k_val, m_val)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # [[a1,b1],[a2,b2],[a3,b3]] with no spaces.\n    results_str_list = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(results_str_list)}]\")\n\nsolve()\n```",
                "id": "3616879"
            }
        ]
    }