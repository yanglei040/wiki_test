{
        "hands_on_practices": [
            {
                "introduction": "理解计算成本的第一步是学会精确地计算基本运算。即使是像多项式求值这样基础的任务，算法的选择也会对性能产生巨大影响。这个练习 [@problem_id:3538828] 将通过比较朴素方法与高效的霍纳（Horner）方法，来具体展示这一点，为你进行浮点运算（flop）计数和算法分析打下坚实基础。",
                "problem": "考虑一个 $n$ 次多项式 $p(x) = a_{0} + a_{1} x + a_{2} x^{2} + \\cdots + a_{n} x^{n}$，其中所有系数 $a_{k}$ (对于 $k \\in \\{0,1,\\dots,n\\}$) 均为实数且通常为非零值，$x \\in \\mathbb{R}$ 是一个给定的标量。您将使用两种不同的方法来计算 $p(x)$ 的值，并计算浮点运算次数 (FLOPs)。根据定义，一次浮点加法消耗 $1$ FLOP，一次浮点乘法消耗 $1$ FLOP；不允许使用其他类型的运算，且不允许使用积和熔加运算 (FMA)。\n\n方法 A (霍纳法则)：使用从最高次系数开始的嵌套递推来计算 $p(x)$ 的值，即，首先初始化 $y := a_{n}$，然后对于 $k = n-1, n-2, \\dots, 0$ 迭代更新 $y := y \\cdot x + a_{k}$。\n\n方法 B (朴素单项式求值)：通过分别计算每个单项式 $a_{k} x^{k}$ 然后求和来计算 $p(x)$ 的值。对于每个 $k \\geq 1$，从值 $x$ 本身开始，通过重复乘以 $x$ 来计算 $x^{k}$ (因此构造 $x^{k}$ 恰好使用 $k-1$ 次乘法)，然后将结果与 $a_{k}$ 相乘一次，并将其加入一个初始化为 $a_{0}$ 的累加器中。在不同单项式的计算之间，不要重用任何 $x$ 的中间幂次。\n\n从多项式的基本定义和 FLOPs 的算术结构出发，推导方法 A 和方法 B 的精确 FLOPs 计数，作为 $n$ 的函数。然后，将方法 B 的 FLOPs 计数与方法 A 的 FLOPs 计数的比率表示为关于 $n$ 的单个闭式表达式。请提供此比率作为您的最终答案。无需四舍五入。",
                "solution": "题目要求对使用两种不同算法——霍纳法则和朴素单项式求值——来计算一个 $n$ 次多项式的值所需的计算成本（以浮点运算次数 (FLOPs) 衡量）进行比较分析。我们需要推导每种方法的 FLOPs 计数，然后确定朴素方法的成本与霍纳法则成本的比率。\n\n多项式由 $p(x) = \\sum_{k=0}^{n} a_k x^k$ 给出，其中 $n$ 是次数，$a_k \\in \\mathbb{R}$ 是系数，$x \\in \\mathbb{R}$ 是求值点。根据定义，一次浮点加法或一次浮点乘法贡献 $1$ FLOP。\n\n首先，我们分析方法 A，即霍纳法则。该算法由一个初始化和一个递推定义：\n1.  用最高次系数初始化累加器 $y$：$y := a_{n}$。这是一个赋值操作，成本为 $0$ FLOPs。\n2.  对于 $k = n-1, n-2, \\dots, 0$ 迭代更新累加器：$y := y \\cdot x + a_{k}$。\n\n让我们考察迭代步骤 $y := y \\cdot x + a_{k}$ 的计算成本。此操作包含一次乘法 ($y \\cdot x$) 和一次加法 (结果加上 $a_k$)。因此，每次迭代的成本恰好是 $1$ 次乘法 FLOP 和 $1$ 次加法 FLOP，总共为每次迭代 $2$ FLOPs。\n\n循环的索引 $k$ 从 $n-1$ 递减到 $0$。迭代次数是这个范围内的整数个数，即 $(n-1) - 0 + 1 = n$。\n方法 A 的总 FLOPs 计数，记为 $C_A(n)$，是迭代次数与每次迭代成本的乘积。\n$$C_A(n) = n \\times (\\text{1 次乘法} + \\text{1 次加法}) = n \\times (1 + 1) \\text{ FLOPs} = 2n \\text{ FLOPs}$$\n因此，霍纳法则的总成本是 $C_A(n) = 2n$。\n\n接下来，我们分析方法 B，即朴素单项式求值。该算法定义如下：\n1.  初始化求和的累加器，$S := a_0$。这成本为 $0$ FLOPs。\n2.  对于从 $1$ 到 $n$ 的每个索引 $k$，计算项 $a_k x^k$ 并将其加到累加器中：$S := S + a_k x^k$。\n\n题目规定，对于每个 $k \\geq 1$，幂 $x^k$ 是通过 $k-1$ 次连续乘法计算的（例如，$x^2 = x \\cdot x$, $x^3 = x^2 \\cdot x$ 等），并且在不同单项式的计算之间不重用 $x$ 的任何中间幂。\n\n让我们为给定的 $k \\in \\{1, 2, \\dots, n\\}$ 分解计算单个项 $a_k x^k$ 并将其加到总和中的 FLOPs：\n-   计算幂 $x^k$：这需要 $k-1$ 次乘法。\n-   乘以系数 $a_k$：这需要 $1$ 次乘法。\n-   将结果 $a_k x^k$ 加到累加器 $S$ 中：这需要 $1$ 次加法。\n\n第 $k$ 项的总乘法次数是 $(k-1) + 1 = k$。\n第 $k$ 项的总加法次数是 $1$。\n因此，处理第 $k$ 项的总 FLOPs 是 $k+1$。\n\n为了找到方法 B 的总 FLOPs 计数 $C_B(n)$，我们必须将从 $k=1$ 到 $n$ 的所有项的成本相加。\n总乘法次数是每项乘法次数的总和：\n$$M_B(n) = \\sum_{k=1}^{n} k = \\frac{n(n+1)}{2}$$\n总加法次数是每项加法次数的总和：\n$$A_B(n) = \\sum_{k=1}^{n} 1 = n$$\n方法 B 的总 FLOPs 计数是所有乘法和加法的总和：\n$$C_B(n) = M_B(n) + A_B(n) = \\frac{n(n+1)}{2} + n = \\frac{n^2+n}{2} + \\frac{2n}{2} = \\frac{n^2+3n}{2}$$\n\n最后，题目要求我们找到方法 B 的 FLOPs 计数与方法 A 的 FLOPs 计数的比率。设此比率为 $R(n)$。\n$$R(n) = \\frac{C_B(n)}{C_A(n)} = \\frac{\\frac{n^2+3n}{2}}{2n}$$\n对于次数 $n \\ge 1$ 的多项式，$C_A(n)$ 和 $C_B(n)$ 均为非零，因此可以进行简化。对于边界情况 $n=0$，$p(x)=a_0$，两种方法都需要 $0$ FLOPs，使得比率不确定 ($0/0$)。然而，题目要求一个单一的闭式表达式，这表明我们应该找到一个对于 $n \\ge 1$（此时计算不是平凡的）成立的公式。对于 $n \\ge 1$，我们可以简化 $R(n)$ 的表达式：\n$$R(n) = \\frac{n^2+3n}{4n} = \\frac{n(n+3)}{4n}$$\n由于 $n \\neq 0$，我们可以从分子和分母中约去因子 $n$：\n$$R(n) = \\frac{n+3}{4}$$\n这个闭式表达式给出了对于任何次数 $n \\ge 1$ 的多项式，其计算成本的比率。",
                "answer": "$$\\boxed{\\frac{n+3}{4}}$$",
                "id": "3538828"
            },
            {
                "introduction": "在科学计算中，我们常常需要用相同的系数矩阵求解多个线性方程组。这个练习 [@problem_id:2160772] 探讨了一种核心策略：通过一次性的高成本计算（LU 分解）来摊销后续求解过程的成本。你会发现，与每次都从头求解相比，这种“预计算”的策略在处理多个右端项时展现出巨大的效率优势，这凸显了分析整个问题工作流的重要性。",
                "problem": "一个计算科学家团队正在对一个复杂的物理系统进行建模，该系统的状态由向量 $x$ 表示，由线性方程组 $Ax=b$ 决定。矩阵 $A$ 的大小为 $600 \\times 600$，描述了系统固定的内部相互作用，并且不会改变。该团队需要分析系统对100种不同外部条件的响应，每种条件由一个唯一的右端向量 $b$ 表示。\n\n为了高效地解决这个问题，他们首先计算矩阵 $A$ 的LU（Lower-Upper）分解。一个 $N \\times N$ 矩阵进行LU分解所需的浮点运算（flops）近似次数由公式 $\\frac{2}{3}N^3$ 给出。\n\n一旦获得分解 $A=LU$，对于任意给定的 $b$ 求解 $x$ 是一个两步过程：首先求解下三角系统 $Ly=b$（前向替换），然后求解上三角系统 $Ux=y$（后向替换）。求解一个 $N \\times N$ 三角系统（无论是下三角还是上三角）所需的近似浮点运算次数为 $N^2$。\n\n计算求解所有100种不同外部条件的解所需的总浮点运算次数。此计算必须包括执行LU分解的一次性成本。",
                "solution": "令 $N=600$ 表示矩阵的维度，令 $R=100$ 表示不同右端向量的数量。\n\n一个 $N \\times N$ 矩阵的LU分解成本由以下公式给出\n$$\n\\frac{2}{3}N^{3}。\n$$\n求解一个下三角系统和一个上三角系统的成本是每个右端向量 $N^{2}+N^{2}=2N^{2}$。对于 $R$ 个右端向量，总计为\n$$\n2RN^{2}。\n$$\n因此，总浮点运算次数为\n$$\n\\frac{2}{3}N^{3}+2RN^{2}。\n$$\n代入 $N=600$ 和 $R=100$，\n$$\n\\frac{2}{3}\\cdot 600^{3}+2\\cdot 100 \\cdot 600^{2}。\n$$\n精确计算每一项：\n$$\n600^{3}=(6\\cdot 10^{2})^{3}=216\\cdot 10^{6}=216{,}000{,}000,\n$$\n所以\n$$\n\\frac{2}{3}\\cdot 600^{3}=\\frac{2}{3}\\cdot 216{,}000{,}000=144{,}000{,}000。\n$$\n另外，\n$$\n600^{2}=360{,}000,\\quad 2\\cdot 100 \\cdot 600^{2}=200\\cdot 360{,}000=72{,}000{,}000。\n$$\n将两部分贡献相加，\n$$\n144{,}000{,}000+72{,}000{,}000=216{,}000{,}000。\n$$\n因此，总浮点运算次数为 $216{,}000{,}000$。",
                "answer": "$$\\boxed{216000000}$$",
                "id": "2160772"
            },
            {
                "introduction": "最小二乘法是数据拟合和统计分析的基石，而选择何种算法求解最小二乘问题则需要对计算成本有深刻的理解。这个高级练习 [@problem_id:3538906] 将两种标准方法——构建格拉姆（Gram）矩阵（即正规方程法）和使用豪斯霍尔德（Householder）QR 分解——进行了直接的成本对决。通过从第一性原理推导精确的浮点运算数，你将洞悉在计算速度和数值稳定性之间进行权衡的艺术，这是专家进行算法选择的关键。",
                "problem": "设 $A \\in \\mathbb{R}^{m \\times n}$，其中 $m \\geq n$ 且 $A$ 为列满秩矩阵，并设 $b \\in \\mathbb{R}^{m}$。在实数算术中进行运算，并采用以下浮点运算（flop）模型：每次浮点加法、减法、乘法或除法计为一次浮点运算；计算平方根不计入浮点运算。忽略内存传输和缓存效应。长度为 $\\ell$ 的两个向量的点积成本为 $2\\ell - 1$ 次浮点运算，一个 $\\ell \\times p$ 矩阵的秩一更新 $U := U - u v^{T}$（在向量 $v$ 可用后作为外积减法执行）成本为 $2 \\ell p$ 次浮点运算。你可以使用以下结论：对于一个 $n \\times n$ 的上三角矩阵，回代求解的浮点运算次数恰好为 $n^{2}$。\n\n1) 从第一性原理出发，推导通过利用对称性（只计算上三角部分并将其复制到下三角部分）形成格拉姆矩阵 $G = A^{T} A$ 的精确浮点运算次数。你的推导必须考虑到每个元素 $G_{ij}$（其中 $1 \\leq i \\leq j \\leq n$）是 $\\mathbb{R}^{m}$ 中两个向量的点积。\n\n2) 从第一性原理出发，推导使用非分块的基于 Householder 的 $QR$ 方法求解线性最小二乘问题 $\\min_{x \\in \\mathbb{R}^{n}} \\|A x - b\\|_{2}$ 的精确浮点运算次数，过程中不显式形成 $Q$：\n- 在第 $j$ 步（$1 \\leq j \\leq n$），构造一个长度为 $\\ell_{j} = m - j + 1$ 的 Householder 反射矩阵 $H_{j} = I - \\tau_{j} v_{j} v_{j}^{T}$，它将第 $j$ 列的次对角线部分置零。假设构造 $v_{j}$ 和 $\\tau_{j}$ 的成本恰好为 $2 \\ell_{j}$ 次浮点运算（对应于一次点积加上可忽略的标量运算），并忽略平方根的计算成本。\n- 仅将 $H_{j}$ 应用于由第 $j+1$ 列到第 $n$ 列组成的 $A$ 的尾随子矩阵；不显式更新第 $j$ 列。实现 $A \\leftarrow A - v_{j} \\left(\\tau_{j} v_{j}^{T} A\\right)$，并精确计算此应用的成本。\n- 在同一次扫描中，将 $H_{j}$ 应用于 $b$ 的最后 $\\ell_{j}$ 个元素，即执行 $b \\leftarrow b - v_{j} \\left(\\tau_{j} v_{j}^{T} b\\right)$。\n- 在所有反射矩阵应用完毕后，通过回代求解 $R x = Q^{T} b$，其中 $R$ 是得到的 $n \\times n$ 上三角因子。\n\n3) 设 $F_{\\mathrm{Gram}}(m,n)$ 是你在第 1 部分得到的浮点运算次数，$F_{\\mathrm{QR\\_solve}}(m,n)$ 是你在第 2 部分得到的浮点运算次数。给出比率\n$$\nR(m,n) \\;=\\; \\frac{F_{\\mathrm{Gram}}(m,n)}{F_{\\mathrm{QR\\_solve}}(m,n)}.\n$$\n的简化、闭式解析表达式。你的最终答案必须是这个单一的表达式。不要提供任何数值近似。如果简化因子，请保持表达式的精确性。不需要单位。",
                "solution": "该问题要求基于一个特定的浮点运算（flop）模型，推导两种不同的浮点运算次数及其后续的比率。首先，我们将推导形成格拉姆矩阵的浮点运算次数。其次，我们将推导使用基于 Householder QR 的方法求解线性最小二乘问题的浮点运算次数。最后，我们将计算这两个次数的比率。\n\n第 1 部分：形成格拉姆矩阵的浮点运算次数，$F_{\\mathrm{Gram}}(m,n)$。\n格拉姆矩阵定义为 $G = A^{T} A$，其中 $A \\in \\mathbb{R}^{m \\times n}$。得到的矩阵 $G$ 是一个 $n \\times n$ 的对称矩阵。$G_{ij}$ 元素是 $A$ 的第 $i$ 列（记为 $a_i \\in \\mathbb{R}^m$）和 $A$ 的第 $j$ 列（记为 $a_j \\in \\mathbb{R}^m$）的点积。即 $G_{ij} = a_i^T a_j$。\n问题指明要利用对称性，只计算 $G$ 的上三角部分，即 $1 \\le i \\le j \\le n$ 的元素 $G_{ij}$。此类元素的数量是前 $n$ 个整数之和：$n + (n-1) + \\dots + 1 = \\frac{n(n+1)}{2}$。\n每个元素是两个长度为 $m$ 的向量的点积。根据所提供的浮点运算模型，两个长度为 $\\ell$ 的向量的点积成本为 $2\\ell - 1$ 次浮点运算。在我们的例子中，$\\ell=m$，所以计算每个元素 $G_{ij}$ 的成本是 $2m-1$ 次浮点运算。\n因此，形成格拉姆矩阵 $G$ 的总浮点运算次数是待计算元素数量与每个元素成本的乘积：\n$$\nF_{\\mathrm{Gram}}(m,n) = \\frac{n(n+1)}{2} (2m-1)\n$$\n此表达式是在给定模型下形成格拉姆矩阵的精确浮点运算次数。\n\n第 2 部分：通过 Householder QR 求解最小二乘问题的浮点运算次数，$F_{\\mathrm{QR\\_solve}}(m,n)$。\n该方法包括 $n$ 步 Householder 变换，将 $A$ 约简为上三角形式 $R$，然后求解一个三角系统。我们将这 $n$ 步的成本相加，并加上最终回代求解的成本。\n\n在第 $j$ 步，对于 $j = 1, \\dots, n$，我们构造并应用一个 Householder 反射矩阵 $H_j = I - \\tau_j v_j v_j^T$。向量 $v_j$ 的长度为 $\\ell_j = m-j+1$。\n第 $j$ 步的成本分解如下：\n1.  构造 $v_j$ 和 $\\tau_j$：问题指明此成本恰好为 $2\\ell_j = 2(m-j+1)$ 次浮点运算。\n2.  将 $H_j$ 应用于 $A$ 的尾随子矩阵：反射矩阵应用于子矩阵 $A(j:m, j+1:n)$，其维度为 $\\ell_j \\times (n-j)$。更新操作为 $A \\leftarrow A - v_j(\\tau_j v_j^T A)$。执行时，首先计算行向量 $w^T = \\tau_j (v_j^T A(j:m, j+1:n))$，然后执行更新 $A(j:m, j+1:n) \\leftarrow A(j:m, j+1:n) - v_j w^T$。\n    - 计算 $v_j^T A(j:m, j+1:n)$ 涉及 $n-j$ 次长度为 $\\ell_j$ 的向量的点积。这需要 $(n-j)(2\\ell_j - 1)$ 次浮点运算。\n    - 乘以 $\\tau_j$ 需要额外的 $n-j$ 次浮点运算。\n    - 秩-1 更新 $A(j:m, j+1:n) - v_j w^T$ 涉及一个长度为 $\\ell_j$ 的向量和一个长度为 $n-j$ 的向量的外积，以及一个矩阵减法。这需要 $\\ell_j(n-j)$ 次乘法和 $\\ell_j(n-j)$ 次减法，总共 $2\\ell_j(n-j)$ 次浮点运算。\n    - 在第 $j$ 步更新矩阵的总成本是 $(n-j)(2\\ell_j-1) + (n-j) + 2\\ell_j(n-j) = (n-j)(2\\ell_j-1+1) + 2\\ell_j(n-j) = 2\\ell_j(n-j) + 2\\ell_j(n-j) = 4\\ell_j(n-j) = 4(m-j+1)(n-j)$ 次浮点运算。当 $j=n$ 时，此成本为零。\n3.  将 $H_j$ 应用于向量 $b$：反射矩阵应用于 $b$ 的最后 $\\ell_j$ 个元素。更新操作为 $b \\leftarrow b - v_j(\\tau_j v_j^T b)$。\n    - 点积 $v_j^T b$（长度为 $\\ell_j$ 的向量）成本为 $2\\ell_j - 1$ 次浮点运算。\n    - 乘以 $\\tau_j$ 成本为 1 次浮点运算。\n    - 缩放后的向量减法成本为 $2\\ell_j$ 次浮点运算（$\\ell_j$ 次乘法和 $\\ell_j$ 次减法）。\n    - 更新 $b$ 的总成本是 $(2\\ell_j - 1) + 1 + 2\\ell_j = 4\\ell_j = 4(m-j+1)$ 次浮点运算。\n\nQR 分解阶段的总成本是这些成本在 $j=1, \\dots, n$ 上的总和：\n$$\nF_{\\mathrm{QR\\_fact}}(m,n) = \\sum_{j=1}^{n} \\left( 2(m-j+1) + 4(m-j+1)(n-j) + 4(m-j+1) \\right)\n$$\n$$\nF_{\\mathrm{QR\\_fact}}(m,n) = \\sum_{j=1}^{n} \\left( 6(m-j+1) + 4(m-j+1)(n-j) \\right)\n$$\n我们分别计算这两个和。令 $k = j-1$。\n第一个和是 $6 \\sum_{j=1}^{n} (m-j+1) = 6 \\sum_{j=1}^{n} (m+1-j) = 6(n(m+1) - \\frac{n(n+1)}{2}) = 3n(2m+2-n-1) = 3n(2m-n+1)$。\n第二个和是 $4 \\sum_{j=1}^{n} (m-j+1)(n-j) = 4 \\sum_{k=0}^{n-1} (m-k)(n-1-k)$。\n$4 \\sum_{k=0}^{n-1} [m(n-1) - k(m+n-1) + k^2] = 4[m(n-1)n - (m+n-1)\\frac{(n-1)n}{2} + \\frac{(n-1)n(2n-1)}{6}]$。\n提取公因式 $\\frac{2n(n-1)}{3}$ 得到 $\\frac{2n(n-1)}{3}[6m - 3(m+n-1) + (2n-1)] = \\frac{2n(n-1)}{3}(3m-n+2)$。\n将两个和相加：\n$F_{\\mathrm{QR\\_fact}}(m,n) = 3n(2m-n+1) + \\frac{2n(n-1)(3m-n+2)}{3}$\n$= \\frac{9n(2m-n+1) + 2n(n-1)(3m-n+2)}{3}$\n$= \\frac{n}{3} [18m - 9n + 9 + 6mn - 6m - 2n^2 + 6n - 4]$\n$= \\frac{n}{3} (6mn - 2n^2 + 12m - 3n + 5)$。\nQR 分解后，系统 $Rx = Q^T b$ 通过回代求解。问题指明这需要 $n^2$ 次浮点运算。\n因此，基于 QR 的解法的总成本是：\n$$\nF_{\\mathrm{QR\\_solve}}(m,n) = F_{\\mathrm{QR\\_fact}}(m,n) + n^2 = \\frac{n}{3} (6mn - 2n^2 + 12m - 3n + 5) + n^2\n$$\n$$\nF_{\\mathrm{QR\\_solve}}(m,n) = \\frac{6mn^2 - 2n^3 + 12mn - 3n^2 + 5n + 3n^2}{3} = \\frac{6mn^2 - 2n^3 + 12mn + 5n}{3}\n$$\n$$\nF_{\\mathrm{QR\\_solve}}(m,n) = \\frac{n(6mn - 2n^2 + 12m + 5)}{3}\n$$\n\n第 3 部分：比率 $R(m,n)$。\n我们需要求比率 $R(m,n) = \\frac{F_{\\mathrm{Gram}}(m,n)}{F_{\\mathrm{QR\\_solve}}(m,n)}$。\n$$\nR(m,n) = \\frac{\\frac{n(n+1)(2m-1)}{2}}{\\frac{n(6mn - 2n^2 + 12m + 5)}{3}}\n$$\n假设 $n \\ge 1$，我们可以消去分子和分母中的因子 $n$。\n$$\nR(m,n) = \\frac{3(n+1)(2m-1)}{2(6mn - 2n^2 + 12m + 5)}\n$$\n这就是该比率的简化、闭式解析表达式。无法通过因式分解进一步简化，因为分子中的项 $(n+1)$ 不能整除分母括号中的多项式（在 $n=-1$ 处求值得到 $-6m - 2 + 12m + 5 = 6m+3 \\ne 0$），项 $(2m-1)$ 也不能（在 $m=1/2$ 处求值得到 $3n - 2n^2 + 6 + 5 = -2n^2+3n+11 \\ne 0$）。",
                "answer": "$$\n\\boxed{\\frac{3(n+1)(2m-1)}{2(6mn - 2n^{2} + 12m + 5)}}\n$$",
                "id": "3538906"
            }
        ]
    }