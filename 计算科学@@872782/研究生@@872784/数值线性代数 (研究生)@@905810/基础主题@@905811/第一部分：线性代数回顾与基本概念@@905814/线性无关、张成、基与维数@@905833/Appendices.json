{
        "hands_on_practices": [
            {
                "introduction": "线性无关的理论定义，例如方阵的行列式不为零，是清晰而明确的。然而，在有限精度运算的世界里，这些定义变得非常脆弱。本练习 [@problem_id:3555833] 提供了一个极具说服力的动手实践，展示了由于尺度问题，这类朴素的检验方法会如何产生误导，并强调了基于 $QR$ 分解和奇异值分解（$SVD$）的稳健、尺度自适应诊断方法的必要性。掌握这一实践是培养真正数值直觉的关键第一步。",
                "problem": "假设数值线性代数在有限精度浮点运算中执行，机器epsilon用 $\\epsilon_{\\mathrm{mach}}$ 表示。使用的基本定义如下。对于矩阵 $A \\in \\mathbb{R}^{m \\times n}$，如果 $A x = 0$ 的唯一解是 $x = 0$，则其列向量组是线性无关的。$A$ 的列空间（或称生成空间）是其列向量的所有线性组合的集合。列空间的维数是 $A$ 的秩。方阵 $A \\in \\mathbb{R}^{n \\times n}$ 的行列式等于其奇异值的乘积，并且随列的缩放而乘法缩放。一种用于判断数值秩的稳健诊断方法是使用正交分解或奇异值分解 (SVD)。在列主元 QR 分解 $A P = Q R$ 中，$P$ 是一个置换矩阵，$Q$ 是正交矩阵，$R$ 是上梯形矩阵，此时 $R$ 的对角线元素通常会衰减，从而揭示秩。在奇异值分解 $A = U \\Sigma V^\\top$ 中，$\\Sigma$ 的对角线包含按非递增顺序排列的奇异值 $\\sigma_i$。推荐的数值秩阈值为 $ \\tau_{\\mathrm{rel}} = \\max(m,n)\\,\\epsilon_{\\mathrm{mach}}\\,\\|A\\|_2$，其中 $\\|A\\|_2 = \\sigma_{\\max}(A)$ 是谱范数。与固定的绝对容差不同，此阈值比较的是相对于尺度的量级。\n\n实现一个程序，对给定的矩阵测试套件 $A$ 执行以下三种诊断：\n\n- 一种基于行列式的朴素无关性检验：\n  - 如果 $A$ 是方阵，计算 $d = \\det(A)$，若 $|d| > \\theta$，则判定列向量无关，其中 $\\theta = 10^{-15}$ 是一个固定的绝对容差。\n  - 如果 $A$ 是 $m \\ge n$ 的矩形矩阵，计算 $g = \\det(A^\\top A)$，若 $|g| > \\theta$，则判定列向量无关，使用相同的固定绝对容差 $\\theta = 10^{-15}$。\n- 通过列主元 QR 分解得到的稳健数值秩：计算列主元 QR 分解 $A P = Q R$。定义 $\\tau_{\\mathrm{QR}} = \\max(m,n)\\,\\epsilon_{\\mathrm{mach}}\\,|R_{11}|$。令 $r_{\\mathrm{QR}}$ 为对角线元素 $|R_{ii}|$ 中严格大于 $\\tau_{\\mathrm{QR}}$ 的个数。\n- 通过 SVD 得到的稳健数值秩：计算 $A$ 的奇异值 $\\{\\sigma_i\\}$。定义 $\\tau_{\\mathrm{SVD}} = \\max(m,n)\\,\\epsilon_{\\mathrm{mach}}\\,\\sigma_{\\max}$。令 $r_{\\mathrm{SVD}}$ 为奇异值 $\\sigma_i$ 中严格大于 $\\tau_{\\mathrm{SVD}}$ 的个数。\n\n目标是构建并评估一些场景，在这些场景中，基于行列式的朴素检验由于浮点数缩放而产生误导，而基于主元 QR 和 SVD 的稳健诊断方法则能提供对数值无关性的尺度感知评估。\n\n测试套件。使用以下矩阵（所有元素均为以 10 为底的科学记数法）：\n\n- 案例 $\\mathbf{A_1}$（方阵，满代数秩，但行列式极小）： \n  $$A_1 = \\begin{bmatrix}\n  1  1  1 \\\\\n  0  10^{-12}  0 \\\\\n  0  0  10^{-12}\n  \\end{bmatrix} \\in \\mathbb{R}^{3 \\times 3}.$$\n  代数秩为 $3$，且 $\\det(A_1) = 10^{-24}$。\n\n- 案例 $\\mathbf{A_2}$（方阵，具有极端的列缩放，行列式绝对值大，但在相对阈值下是数值秩亏的）：\n  $$A_2 = \\mathrm{diag}\\!\\left(10^{16}, 1, 10^{-16}\\right) \\in \\mathbb{R}^{3 \\times 3}.$$\n  代数秩为 $3$，$\\det(A_2) = 1$，奇异值恰好为 $\\{10^{16}, 1, 10^{-16}\\}$。\n\n- 案例 $\\mathbf{A_3}$（矩形矩阵，对一个良态高矩阵进行均匀缩放；朴素的 Gram 行列式值极小纯粹是由于其绝对尺度，但相对于该尺度其数值秩是满的）：\n  $$A_3 = 10^{-10} \\cdot \\begin{bmatrix}\n  1  0  1 \\\\\n  0  1  1 \\\\\n  0  0  1 \\\\\n  0  0  1 \\\\\n  0  0  1\n  \\end{bmatrix} \\in \\mathbb{R}^{5 \\times 3}.$$\n  代数秩为 $3$。注意 $A_3^\\top A_3$ 的缩放因子为 $10^{-20}$，其行列式的缩放因子为 $10^{-60}$。\n\n对于每个案例，你的程序应生成一个包含三个部分的列表：\n- 上述基于行列式的朴素无关性检验的布尔值结果。\n- 使用阈值 $\\tau_{\\mathrm{QR}}$ 从列主元 QR 分解得到的整数数值秩 $r_{\\mathrm{QR}}$。\n- 使用阈值 $\\tau_{\\mathrm{SVD}}$ 从 SVD 得到的整数数值秩 $r_{\\mathrm{SVD}}$。\n\n最终输出格式。将所有测试案例的结果汇总到一个单行的 Python 风格的列表的列表中，顺序为 $[A_1, A_2, A_3]$。每个内部列表的形式必须是 $[\\text{naive}, r_{\\mathrm{QR}}, r_{\\mathrm{SVD}}]$。你的程序应生成包含此汇总列表的单行输出，例如，格式类似于 $[ [\\text{b}, k, \\ell], [\\text{b}, k, \\ell], [\\text{b}, k, \\ell] ]$，其中 $\\text{b}$ 是一个布尔值，$k, \\ell$ 是整数。本任务中不需要物理单位，也没有角度或百分比。",
                "solution": "该问题是有效的，因为它基于数值线性代数的原理，具有科学依据；它在数学上是适定的，并提供了所有必要信息；而且其陈述是客观的。我们开始求解。\n\n这个问题的核心是对比用于检验线性无关性的朴素、尺度依赖的测试方法与稳健、尺度感知的数值方法。我们需要使用三种不同的诊断方法来评估三个矩阵：一种基于行列式并使用固定绝对阈值的测试，一种基于列主元 QR 分解的秩测试，以及一种基于奇异值分解 (SVD) 的秩测试。标准双精度浮点运算的机器 epsilon $\\epsilon_{\\mathrm{mach}}$ 约为 $2.22 \\times 10^{-16}$。\n\n**诊断方法**\n\n1.  **朴素行列式检验**：该检验利用了这样一个性质：$\\mathbb{R}^n$ 中的 $n$ 个向量线性无关，当且仅当由这些向量构成的矩阵的行列式非零。对于一个 $m \\times n$ 的矩形矩阵 $A$（其中 $m \\ge n$），其列向量线性无关，当且仅当 Gram 矩阵 $A^\\top A$ 是非奇异的，即 $\\det(A^\\top A) \\ne 0$。在有限精度下，我们检验是否 $|\\det| > \\theta$，其中 $\\theta = 10^{-15}$ 是一个固定的绝对容差。这种方法是出了名的不可靠，因为行列式对矩阵列的缩放高度敏感。对于一个矩阵 $A \\in \\mathbb{R}^{n \\times n}$，如果其中一列乘以一个因子 $c$，行列式也会乘以 $c$。对于 Gram 矩阵的行列式，如果 $A \\in \\mathbb{R}^{m \\times n}$ 被缩放为 $c A$，则 $\\det((cA)^\\top(cA)) = \\det(c^2 A^\\top A) = (c^2)^n \\det(A^\\top A) = c^{2n} \\det(A^\\top A)$。这种对缩放的极端敏感性可能导致行列式的值变得极小或极大，即使对于良态矩阵也是如此，从而在与固定阈值比较时得出错误的结论。\n\n2.  **稳健的 QR 秩检验**：列主元 QR 分解 $AP = QR$ 将矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 分解为一个正交矩阵 $Q$、一个上梯形矩阵 $R$ 和一个对 $A$ 的列进行重排的置换矩阵 $P$。在分解的每一步，都选择剩余范数最大的列作为下一个主元。这种启发式方法确保了 $R$ 的对角线元素的量值是非递增的：$|R_{11}| \\ge |R_{22}| \\ge \\dots$。数值秩通过计算对角线元素 $|R_{ii}|$ 中相对于矩阵尺度而言显著大于零的元素数量来估计。指定的阈值为 $\\tau_{\\mathrm{QR}} = \\max(m,n)\\,\\epsilon_{\\mathrm{mach}}\\,|R_{11}|$。由于列主元选择使得 $|R_{11}|$ 成为 $A$ 的范数的一个良好估计，因此这个阈值是自适应于矩阵尺度的。秩 $r_{\\mathrm{QR}}$ 是满足 $|R_{ii}| > \\tau_{\\mathrm{QR}}$ 的索引 $i$ 的数量。虽然这种方法很稳健，但可能会被特定的矩阵结构所误导。\n\n3.  **稳健的 SVD 秩检验**：奇异值分解 $A = U \\Sigma V^\\top$ 是确定数值秩最可靠的工具。它将 $A \\in \\mathbb{R}^{m \\times n}$ 分解为正交矩阵 $U$ 和 $V$，以及一个对角矩阵 $\\Sigma$，其对角线元素 $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge \\sigma_{\\min(m,n)} \\ge 0$ 是 $A$ 的奇异值。奇异值是通过矩阵 $A$ 变换单位球面后得到的超椭球的半轴长度。它们为矩阵在向量空间上的作用提供了一个稳定且基本的度量。数值秩是相对于最大奇异值 $\\sigma_{\\max} = \\|A\\|_2$ 而言显著的奇异值的数量。指定的阈值为 $\\tau_{\\mathrm{SVD}} = \\max(m,n)\\,\\epsilon_{\\mathrm{mach}}\\,\\sigma_{\\max}$。秩 $r_{\\mathrm{SVD}}$ 是满足 $\\sigma_i > \\tau_{\\mathrm{SVD}}$ 的奇异值 $\\sigma_i$ 的数量。\n\n现在我们将这三种诊断方法应用于每个测试案例。\n\n**案例 $\\mathbf{A_1}$**\n矩阵为 $A_1 = \\begin{bmatrix} 1  1  1 \\\\ 0  10^{-12}  0 \\\\ 0  0  10^{-12} \\end{bmatrix}$。这里，$m=3, n=3$。\n- **朴素检验**：$A_1$ 是方阵，所以我们计算其行列式。$\\det(A_1) = 1 \\cdot (10^{-12} \\cdot 10^{-12} - 0) = 10^{-24}$。与固定阈值 $\\theta = 10^{-15}$ 比较，我们发现 $|\\det(A_1)| = 10^{-24} \\le 10^{-15}$。朴素检验错误地断定其列向量是线性相关的。结果：`False`。\n- **QR 秩检验**：对 $A_1$ 进行列主元 QR 分解。一个标准的实现会得到一个对角线元素绝对值约为 $\\{1.732, 10^{-12}, 10^{-12}\\}$ 的 $R$ 矩阵。第一个对角线元素 $|R_{11}|$ 约为 $1.732$。阈值为 $\\tau_{\\mathrm{QR}} = 3 \\cdot \\epsilon_{\\mathrm{mach}} \\cdot |R_{11}| \\approx 3 \\cdot (2.22 \\times 10^{-16}) \\cdot 1.732 \\approx 1.15 \\times 10^{-15}$。$R$ 的所有三个对角线元素的绝对值都大于此阈值。因此，$r_{\\mathrm{QR}} = 3$。\n- **SVD 秩检验**：$A_1$ 的奇异值约为 $\\sigma = \\{1.732, 10^{-12}, 10^{-12}\\}$。最大奇异值为 $\\sigma_{\\max} \\approx 1.732$。阈值为 $\\tau_{\\mathrm{SVD}} = 3 \\cdot \\epsilon_{\\mathrm{mach}} \\cdot \\sigma_{\\max} \\approx 1.15 \\times 10^{-15}$。\n  - $\\sigma_1 \\approx 1.732 > 1.15 \\times 10^{-15}$ (真)\n  - $\\sigma_2 = 10^{-12} > 1.15 \\times 10^{-15}$ (真)\n  - $\\sigma_3 = 10^{-12} > 1.15 \\times 10^{-15}$ (真)\n  所有三个奇异值都高于阈值。SVD 正确地将数值秩识别为 $3$。因此，$r_{\\mathrm{SVD}} = 3$。\n- **$A_1$ 的结果**： `[False, 3, 3]`。\n\n**案例 $\\mathbf{A_2}$**\n矩阵为 $A_2 = \\mathrm{diag}(10^{16}, 1, 10^{-16})$。这里，$m=3, n=3$。\n- **朴素检验**：$A_2$ 是方阵。$\\det(A_2) = 10^{16} \\cdot 1 \\cdot 10^{-16} = 1$。由于 $|\\det(A_2)| = 1 > 10^{-15}$，朴素检验断定其列向量是无关的。结果：`True`。这在代数上是正确的，但在数值上具有误导性。\n- **QR 秩检验**：由于 $A_2$ 是对角矩阵，且其元素已按量值排序，列主元 QR 分解的结果为 $P=I, Q=I, R=A_2$。$R$ 的对角线元素为 $\\{10^{16}, 1, 10^{-16}\\}$。最大值为 $|R_{11}| = 10^{16}$。阈值为 $\\tau_{\\mathrm{QR}} = 3 \\cdot \\epsilon_{\\mathrm{mach}} \\cdot |R_{11}| = 3 \\cdot (2.22 \\times 10^{-16}) \\cdot 10^{16} \\approx 6.66$。\n  - $|R_{11}| = 10^{16} > 6.66$ (真)\n  - $|R_{22}| = 1 > 6.66$ (假)\n  - $|R_{33}| = 10^{-16} > 6.66$ (假)\n  只有一个对角线元素超过相对阈值。因此，$r_{\\mathrm{QR}} = 1$。\n- **SVD 秩检验**：对于一个正对角矩阵，奇异值就是其对角线元素。$\\sigma = \\{10^{16}, 1, 10^{-16}\\}$。最大奇异值为 $\\sigma_{\\max} = 10^{16}$。阈值为 $\\tau_{\\mathrm{SVD}} = 3 \\cdot \\epsilon_{\\mathrm{mach}} \\cdot \\sigma_{\\max} \\approx 6.66$。\n  - $\\sigma_1 = 10^{16} > 6.66$ (真)\n  - $\\sigma_2 = 1 > 6.66$ (假)\n  - $\\sigma_3 = 10^{-16} > 6.66$ (假)\n  只有一个奇异值超过阈值。数值秩被正确地识别为 $1$。条件数 $\\sigma_{\\max}/\\sigma_{\\min}$ 是 $10^{32}$，表明该矩阵是极端病态的。因此，$r_{\\mathrm{SVD}} = 1$。\n- **$A_2$ 的结果**：`[True, 1, 1]`。\n\n**案例 $\\mathbf{A_3}$**\n矩阵为 $A_3 = 10^{-10} \\cdot B$，其中 $B = \\begin{bmatrix} 1  0  1 \\\\ 0  1  1 \\\\ 0  0  1 \\\\ 0  0  1 \\\\ 0  0  1 \\end{bmatrix}$。这里，$m=5, n=3$。\n- **朴素检验**：$A_3$ 是矩形矩阵。我们计算 $g = \\det(A_3^\\top A_3)$。\n  $A_3^\\top A_3 = (10^{-10})^2 B^\\top B = 10^{-20} B^\\top B$。矩阵 $B^\\top B = \\begin{bmatrix} 1  0  1 \\\\ 0  1  1 \\\\ 1  1  5 \\end{bmatrix}$ 的行列式为 $\\det(B^\\top B) = 3$。\n  因此，$\\det(A_3^\\top A_3) = (10^{-10})^{2 \\times 3} \\det(B^\\top B) = 3 \\times 10^{-60}$。\n  由于 $|g| = 3 \\times 10^{-60} \\le 10^{-15}$，朴素检验断定其列向量是线性相关的。结果：`False`。这个结论是错误的，其原因是矩阵的整体尺度过小，而非存在任何线性相关性。\n- **QR 秩检验**：$A_3$ 的 QR 分解得到的 $R$ 矩阵的对角线元素将是 $B$ 的 QR 分解得到的对角线元素的 $10^{-10}$ 倍。对于 $B$，列主元分解为其 $R$ 因子产生的对角线元素约为 $\\{-2.236, 1.183, 0.942\\}$。对于 $A_3$，其 $R$ 因子的对角线元素约为 $\\{ -2.236 \\times 10^{-10}, 1.183 \\times 10^{-10}, 0.942 \\times 10^{-10} \\}$。最大值为 $|R_{11}| \\approx 2.236 \\times 10^{-10}$。阈值为 $\\tau_{\\mathrm{QR}} = \\max(5,3) \\cdot \\epsilon_{\\mathrm{mach}} \\cdot |R_{11}| = 5 \\cdot (2.22 \\times 10^{-16}) \\cdot (2.236 \\times 10^{-10}) \\approx 2.48 \\times 10^{-25}$。\n  所有三个对角线元素的量级都在 $10^{-10}$ 左右，远大于 $\\tau_{\\mathrm{QR}}$。因此，$r_{\\mathrm{QR}} = 3$。\n- **SVD 秩检验**：奇异值是线性缩放的：$\\sigma_i(A_3) = 10^{-10} \\sigma_i(B)$。$B$ 的奇异值约为 $\\{2.418, 1.239, 0.811\\}$。因此，$A_3$ 的奇异值为 $\\{2.418 \\times 10^{-10}, 1.239 \\times 10^{-10}, 0.811 \\times 10^{-10}\\}$。最大奇异值为 $\\sigma_{\\max} \\approx 2.418 \\times 10^{-10}$。阈值为 $\\tau_{\\mathrm{SVD}} = \\max(5,3) \\cdot \\epsilon_{\\mathrm{mach}} \\cdot \\sigma_{\\max} = 5 \\cdot (2.22 \\times 10^{-16}) \\cdot (2.418 \\times 10^{-10}) \\approx 2.68 \\times 10^{-25}$。\n  $A_3$ 的所有三个奇异值的量级都在 $10^{-10}$ 左右，远高于阈值。因此，$r_{\\mathrm{SVD}} = 3$。\n- **$A_3$ 的结果**：`[False, 3, 3]`。\n\n最终的汇总结果表明，朴素的行列式检验是不可靠的，而 SVD 提供了最稳健的评估，列主元 QR 分解则是一个强大但并非万无一失的替代方法。",
                "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import qr\n\ndef solve():\n    \"\"\"\n    Implements and compares three methods for diagnosing linear independence\n    and numerical rank for a suite of test matrices.\n    \"\"\"\n    \n    # Define machine epsilon for double precision floating point numbers.\n    epsilon_mach = np.finfo(float).eps\n    \n    # Define the fixed absolute tolerance for the naive determinant test.\n    theta = 1e-15\n\n    # Define the test suite of matrices.\n    A1 = np.array([\n        [1.0, 1.0, 1.0],\n        [0.0, 1e-12, 0.0],\n        [0.0, 0.0, 1e-12]\n    ])\n\n    A2 = np.diag([1e16, 1.0, 1e-16])\n\n    A3 = 1e-10 * np.array([\n        [1.0, 0.0, 1.0],\n        [0.0, 1.0, 1.0],\n        [0.0, 0.0, 1.0],\n        [0.0, 0.0, 1.0],\n        [0.0, 0.0, 1.0]\n    ])\n\n    test_cases = [A1, A2, A3]\n    \n    results = []\n    \n    for A in test_cases:\n        m, n = A.shape\n        \n        # 1. Naive determinant-based independence test\n        naive_result = False\n        if m == n:\n            # Square matrix case\n            det_val = np.linalg.det(A)\n            if np.abs(det_val) > theta:\n                naive_result = True\n        elif m > n:\n            # Rectangular matrix case (tall)\n            gram_det = np.linalg.det(A.T @ A)\n            if np.abs(gram_det) > theta:\n                naive_result = True\n        \n        # 2. Robust numerical rank via column-pivoted QR\n        _, R, _ = qr(A, pivoting=True)\n        # The diagonal of R from scipy.linalg.qr (m,n) is the first min(m,n) elements\n        R_diag_abs = np.abs(np.diag(R))\n        tau_qr = max(m, n) * epsilon_mach * R_diag_abs[0]\n        # Count diagonal entries strictly greater than the threshold.\n        # Ensure we only check up to the number of columns.\n        r_qr = np.sum(R_diag_abs[:n] > tau_qr)\n        \n        # 3. Robust numerical rank via SVD\n        s = np.linalg.svd(A, compute_uv=False)\n        sigma_max = s[0] if s.size > 0 else 0\n        tau_svd = max(m, n) * epsilon_mach * sigma_max\n        # Count singular values strictly greater than the threshold.\n        r_svd = np.sum(s > tau_svd)\n        \n        results.append([naive_result, r_qr, r_svd])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```",
                "id": "3555833"
            },
            {
                "introduction": "一旦我们能够可靠地诊断数值无关性，下一步自然是为一组给定的向量构造一个稳定的基。本练习 [@problem_id:3555869] 将指导你实现改进的格拉姆-施密特（MGS）算法，这是数值线性代数中用于稳定正交化的基石。通过解决这个问题，你不仅将构造出一个基，还将学会如何处理近似线性相关的情况，并量化结果的数值质量，从而更深刻地领会基构造的实践艺术。",
                "problem": "给定一个实矩阵 $A \\in \\mathbb{R}^{m \\times n}$，其列向量可能近似线性相关。任务是实现一个基于修正的格拉姆-施密特算法的数值稳定的标准正交化过程，以构建一个矩阵 $Q \\in \\mathbb{R}^{m \\times n}$。该矩阵的列向量与矩阵 $A$ 的列向量张成相同的子空间，并且在数值无关性允许的情况下是标准正交的。使用此构造，通过估计谱范数 $\\|Q^\\top Q - I\\|_2$ 来诊断数值无关性，其中 $I \\in \\mathbb{R}^{n \\times n}$ 是单位矩阵。值 $\\|Q^\\top Q - I\\|_2$ 量化了与精确标准正交性的偏差，并可作为一种诊断手段：较小的值表示 $A$ 的列向量数值上是线性无关的，而接近1或更大的值则表示失去了数值无关性（例如，存在精确线性相关或零列向量）。\n\n需要使用的基本概念和定义：\n- 线性无关：如果方程 $\\sum_{j=1}^n \\alpha_j a_j = 0$ 的唯一解是所有 $j$ 都有 $\\alpha_j = 0$，则 $A$ 的列向量 $\\{a_1,\\dots,a_n\\}$ 是线性无关的。\n- 生成空间：$A$ 的列向量的生成空间是 $A$ 的列向量的所有线性组合的集合。\n- 基：一个子空间的基是张成该子空间的一组线性无关的向量。\n- 维数：一个子空间的基中向量的数目是该子空间的维数。\n- 内积：对于 $u,v \\in \\mathbb{R}^m$，$(u,v) = u^\\top v$。\n- 正交投影：给定一个标准正交集 $\\{q_1,\\dots,q_k\\}$，$v$ 在 $\\mathrm{span}\\{q_1,\\dots,q_k\\}$ 上的投影是 $\\sum_{i=1}^k (q_i^\\top v) q_i$。\n- 修正的格拉姆-施密特算法 (MGS)：使用内积迭代地将 $A$ 的每一列与先前形成的标准正交向量进行正交化；当残差范数低于容差时，将该列视为数值相关，并将 $Q$ 的对应列设置为零向量。\n- 谱范数：对于任何矩阵 $M$，$\\|M\\|_2$ 等于其最大奇异值，这是数值线性代数中一个经过充分检验的事实。\n\n实现要求：\n1. 实现修正的格拉姆-施密特过程，从 $A$ 生成 $Q$ 和 $R$，遵循基于内积和残差归一化的迭代正交化。如果在对第 $j$ 列进行正交化后，残差范数 $r_{jj} = \\|v_j\\|_2$ 低于容差阈值，则声明该列为数值相关，并将 $Q$ 的对应列设置为零向量。否则，设置 $q_j = v_j / r_{jj}$。\n2. 容差可以基于双精度机器ε和 $A$ 的尺度，例如，取决于 $m$、$n$ 和 $\\|A\\|_2$；确保数值稳健性，不依赖任何未经检验的捷径。\n3. 计算诊断值 $\\|Q^\\top Q - I\\|_2$，其中 $I$ 是大小为 $n \\times n$ 的单位矩阵。使用一种稳定的方法；可以利用 $\\|M\\|_2$ 等于 $M$ 的最大奇异值这一经过充分检验的事实。\n4. 对于每个测试用例，返回单个浮点数 $\\|Q^\\top Q - I\\|_2$。\n\n测试套件：\n在程序中明确编码以下矩阵 $A$：\n- 情况 1（良态，数值无关）：$m = 5$，$n = 3$，其中\n  $$\n  A_1 = \\begin{bmatrix}\n  1  0  0 \\\\\n  0  1  0 \\\\\n  0  0  1 \\\\\n  1  1  0 \\\\\n  0  1  1\n  \\end{bmatrix}.\n  $$\n- 情况 2（近似相关的列）：$m = 5$，$n = 3$，列向量为\n  $$\n  a_1 = \\begin{bmatrix} 1 \\\\ 2 \\\\ 3 \\\\ 4 \\\\ 5 \\end{bmatrix},\\quad\n  a_2 = \\begin{bmatrix} 1.0000000001 \\\\ 2 \\\\ 2.9999999999 \\\\ 4 \\\\ 5.0000000001 \\end{bmatrix},\\quad\n  a_3 = \\begin{bmatrix} 5 \\\\ 4 \\\\ 3 \\\\ 2 \\\\ 1 \\end{bmatrix},\n  $$\n  且 $A_2 = [a_1\\ a_2\\ a_3]$。\n- 情况 3（精确相关）：$m = 5$，$n = 3$，列向量为\n  $$\n  a_1 = \\begin{bmatrix} 1 \\\\ 2 \\\\ 3 \\\\ 4 \\\\ 5 \\end{bmatrix},\\quad\n  a_2 = \\begin{bmatrix} 1 \\\\ 2 \\\\ 3 \\\\ 4 \\\\ 5 \\end{bmatrix},\\quad\n  a_3 = \\begin{bmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 1 \\\\ 2 \\end{bmatrix},\n  $$\n  且 $A_3 = [a_1\\ a_2\\ a_3]$。\n- 情况 4（病态但满秩）：$m = 4$，$n = 4$，希尔伯特矩阵 $H$，其元素为\n  $$\n  (A_4)_{ij} = \\frac{1}{i + j - 1},\\quad 1 \\le i \\le 4,\\ 1 \\le j \\le 4.\n  $$\n- 情况 5（零列作为边界情况）：$m = 4$，$n = 3$，其中\n  $$\n  A_5 = \\begin{bmatrix}\n  1  0  0 \\\\\n  0  1  0 \\\\\n  0  0  0 \\\\\n  0  0  0\n  \\end{bmatrix}.\n  $$\n\n最终输出格式：\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序为 $[\\|Q_1^\\top Q_1 - I\\|_2,\\ \\|Q_2^\\top Q_2 - I\\|_2,\\ \\|Q_3^\\top Q_3 - I\\|_2,\\ \\|Q_4^\\top Q_4 - I\\|_2,\\ \\|Q_5^\\top Q_5 - I\\|_2]$，其中 $Q_k$ 是由你的修正格拉姆-施密特实现从 $A_k$ 计算出的矩阵。每个条目必须是单个浮点数。此问题不涉及任何物理单位或角度单位。",
                "solution": "该问题要求实现修正的格拉姆-施密特 (MGS) 算法，为给定矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 的列空间构建一个标准正交基。此过程将用于诊断 $A$ 的列向量的数值线性无关性。诊断指标是与标准正交性偏差的谱范数，即 $\\|Q^\\top Q - I\\|_2$，其中 $Q$ 是计算得到的具有标准正交列的矩阵，$I$ 是 $n \\times n$ 的单位矩阵。\n\n解决方案的核心是MGS算法，选择该算法是因为其相比经典版本具有更优越的数值稳定性。该算法迭代地生成一组标准正交向量 $\\{q_1, q_2, \\dots, q_n\\}$，它们与 $A$ 的列向量 $\\{a_1, a_2, \\dots, a_n\\}$ 张成相同的空间。\n\n设 $A = [a_1 | a_2 | \\dots | a_n]$。我们初始化一个工作矩阵 $V = A$。MGS算法按以下步骤对 $j = 1, \\dots, n$ 进行处理：\n\n1.  **归一化**：当前向量 $v_j$ 被归一化以产生下一个标准正交向量 $q_j$。首先，计算其欧几里得范数 $r_{jj} = \\|v_j\\|_2$。\n    -   如果 $r_{jj}$ 小于预定义的容差 $\\tau$，则向量 $a_j$ 被认为与前面的向量 $\\{a_1, \\dots, a_{j-1}\\}$ 数值上线性相关。在这种情况下，相应的基向量被设置为零，$q_j = 0$，表示此列不会增加生成空间的维度。\n    -   否则，对该向量进行归一化：$q_j = v_j / r_{jj}$。\n\n2.  **正交化**：工作集中的剩余向量 $\\{v_{j+1}, \\dots, v_n\\}$ 将与新生成的向量 $q_j$ 正交化。对于每个 $k = j+1, \\dots, n$，我们通过减去 $v_k$ 在 $q_j$ 上的投影来更新 $v_k$：\n    $$\n    r_{jk} = q_j^\\top v_k\n    $$\n    $$\n    v_k \\leftarrow v_k - r_{jk} q_j\n    $$\n    这种对剩余向量的即时更新是与经典格拉姆-施密特算法的关键区别，也是MGS数值稳定性增强的根源。通过与 $q_j$ 进行正交化，我们确保后续对向量 $v_k$ 的计算能最小化与 $q_j$ 平行的分量的影响。\n\n容差 $\\tau$ 的选择对于稳健地识别数值相关性至关重要。问题陈述指出，它应基于矩阵维度 $m, n$、机器ε $\\varepsilon$ 以及矩阵的尺度，如 $\\|A\\|_2$。在数值分析文献（例如 Golub  Van Loan 的《矩阵计算》）中，一个常见且合理的选择是使用与矩阵初始范数成比例的容差。我们将使用弗罗贝尼乌斯范数 $\\|A\\|_F$ 作为谱范数 $\\|A\\|_2$ 的一种计算高效的替代。因此，容差定义为：\n$$\n\\tau = \\sqrt{n} \\cdot \\varepsilon \\cdot \\|A\\|_F\n$$\n其中 $\\varepsilon$ 是双精度机器ε。此公式根据输入矩阵的大小和量级来调整容差，为判断残差范数是否在数值上为零提供了一个稳健的阈值。\n\n在计算出矩阵 $Q = [q_1 | q_2 | \\dots | q_n]$ 后，我们评估其与完美标准正交性的偏差。一个理想的标准正交矩阵 $Q$ 满足 $Q^\\top Q = I$。数值误差，特别是那些由 $A$ 中近似线性相关性放大的误差，会导致计算出的 $Q$ 偏离此属性。诊断指标 $\\|Q^\\top Q - I\\|_2$ 量化了这种偏差。矩阵 $M$ 的谱范数 $\\|M\\|_2$ 是其最大奇异值。对于对称矩阵 $Q^\\top Q - I$，这等于其最大绝对值特征值，即 $\\|Q^\\top Q - I\\|_2 = \\max_i |\\lambda_i(Q^\\top Q - I)|$。\n\n如果 $A$ 的列向量数值无关且良态，MGS算法会产生一个非常接近标准正交的矩阵 $Q$，因此 $\\|Q^\\top Q - I\\|_2$ 将是一个小值，数量级约为 $\\varepsilon$。如果一个列向量 $a_j$ 被检测为数值相关，则对应的 $q_j$ 被设为零向量。这会使 $Q^\\top Q$ 的第 $j$ 行和第 $j$ 列为零。因此，$Q^\\top Q - I$ 的第 $j$ 个对角元素为 $-1$，这意味着它的一个特征值为 $-1$。所以，谱范数 $\\|Q^\\top Q - I\\|_2$ 将至少为 $1$，从而正确地标记出数值满秩的丧失。对于那些近似相关但未被容差过滤掉的列，MGS 仍会产生一个正交性显著丧失的矩阵 $Q$，从而导致诊断范数值较大。\n\n实现将遵循以下步骤：\n1.  定义一个函数，用于执行带有指定容差逻辑的修正格拉姆-施密特正交化。\n2.  对每个测试用例矩阵 $A_k$，计算相应的 $Q_k$。\n3.  计算矩阵 $M_k = Q_k^\\top Q_k - I$。\n4.  使用标准的数值库函数计算谱范数 $\\|M_k\\|_2$，即求最大奇异值。\n5.  收集所有测试用例的这些诊断值，并按要求格式化它们。",
                "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by implementing the Modified Gram-Schmidt algorithm,\n    applying it to a suite of test cases, and computing a diagnostic\n    for numerical independence.\n    \"\"\"\n\n    def modified_gram_schmidt(A: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Computes an orthonormal basis Q for the column space of A using the\n        Modified Gram-Schmidt algorithm. Handles numerical dependence by\n        setting columns of Q to zero if the residual norm is below a tolerance.\n\n        Args:\n            A: The input matrix of shape (m, n).\n\n        Returns:\n            A matrix Q of shape (m, n) whose columns form an orthonormal basis\n            for the column space of A.\n        \"\"\"\n        m, n = A.shape\n        if n == 0:\n            return np.zeros((m, 0), dtype=float)\n\n        A_float = A.astype(float)\n        V = A_float.copy()\n        Q = np.zeros_like(A_float)\n\n        # Use the norm of the original matrix A_float for a stable tolerance.\n        norm_A_fro = np.linalg.norm(A_float, 'fro')\n        \n        # Tolerance based on numerical analysis literature (e.g., Golub  Van Loan).\n        # A small norm_A_fro should not lead to a zero tolerance.\n        # np.finfo(float).eps is approx 2.22e-16.\n        # Add a small value to norm_A_fro to handle the case of a zero matrix A.\n        tol = np.sqrt(n) * np.finfo(float).eps * (norm_A_fro + np.finfo(float).tiny)\n\n        for j in range(n):\n            v_j = V[:, j]\n            norm_v_j = np.linalg.norm(v_j)\n\n            if norm_v_j < tol:\n                # The column is numerically dependent on the previous columns.\n                # The corresponding column of Q remains the zero vector.\n                pass  # Q[:, j] is already zero\n            else:\n                q_j = v_j / norm_v_j\n                Q[:, j] = q_j\n                \n                # Orthogonalize the remaining vectors against the new q_j.\n                # This is the \"modified\" part of the algorithm.\n                for k in range(j + 1, n):\n                    # Compute projection coefficient\n                    r_jk = np.dot(q_j, V[:, k])\n                    # Subtract projection\n                    V[:, k] -= r_jk * q_j\n        return Q\n\n    def calculate_diagnostic(Q: np.ndarray) -> float:\n        \"\"\"\n        Calculates the diagnostic value ||Q^T Q - I||_2.\n\n        Args:\n            Q: The matrix with orthonormalized columns.\n\n        Returns:\n            The spectral norm of (Q^T Q - I).\n        \"\"\"\n        m, n = Q.shape\n        if n == 0:\n            return 0.0\n\n        I = np.identity(n)\n        M = Q.T @ Q - I\n        \n        # The spectral norm (ord=2) is the largest singular value.\n        spectral_norm = np.linalg.norm(M, ord=2)\n        return float(spectral_norm)\n\n    # Test Case 1: Well-conditioned, numerically independent\n    A1 = np.array([\n        [1, 0, 0],\n        [0, 1, 0],\n        [0, 0, 1],\n        [1, 1, 0],\n        [0, 1, 1]\n    ], dtype=float)\n\n    # Test Case 2: Nearly dependent columns\n    a2_1 = np.array([1, 2, 3, 4, 5], dtype=float)\n    a2_2 = np.array([1.0000000001, 2, 2.9999999999, 4, 5.0000000001], dtype=float)\n    a2_3 = np.array([5, 4, 3, 2, 1], dtype=float)\n    A2 = np.stack([a2_1, a2_2, a2_3], axis=1)\n\n    # Test Case 3: Exact dependence\n    a3_1 = np.array([1, 2, 3, 4, 5], dtype=float)\n    a3_2 = np.array([1, 2, 3, 4, 5], dtype=float)\n    a3_3 = np.array([2, 1, 0, 1, 2], dtype=float)\n    A3 = np.stack([a3_1, a3_2, a3_3], axis=1)\n\n    # Test Case 4: Ill-conditioned but full rank (Hilbert matrix)\n    n_hilbert = 4\n    A4 = np.array([[1.0 / (i + j - 1) for j in range(1, n_hilbert + 1)] for i in range(1, n_hilbert + 1)], dtype=float)\n    \n    # Test Case 5: Zero column as an edge case\n    A5 = np.array([\n        [1, 0, 0],\n        [0, 1, 0],\n        [0, 0, 0],\n        [0, 0, 0]\n    ], dtype=float)\n    \n    test_cases = [A1, A2, A3, A4, A5]\n    results = []\n\n    for A in test_cases:\n        Q = modified_gram_schmidt(A)\n        diagnostic = calculate_diagnostic(Q)\n        results.append(diagnostic)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```",
                "id": "3555869"
            },
            {
                "introduction": "在掌握了诊断无关性和构造基的工具后，我们现在可以解决一个更微妙的问题：如何比较两个不同的子空间？本练习 [@problem_id:3555879] 引入了主角度的概念，为量化子空间之间的对齐或“距离”提供了一个严谨的几何与代数框架。你将推导这一几何概念与一个互积矩阵的奇异值之间的联系，从而利用奇异值分解（$SVD$）精确地揭示向量空间之间的关系。",
                "problem": "设 $\\mathbb{R}^{4}$ 赋有标准内积。考虑两个二维子空间 $\\mathcal{S}_{1} = \\operatorname{span}(Q_{1})$ 和 $\\mathcal{S}_{2} = \\operatorname{span}(Q_{2})$，其中 $Q_{1} \\in \\mathbb{R}^{4 \\times 2}$ 和 $Q_{2} \\in \\mathbb{R}^{4 \\times 2}$ 的列是标准正交的。$Q_{1}$ 和 $Q_{2}$ 的列由下式给出\n$$\nQ_{1} \\;=\\; \\begin{pmatrix}\n1  0\\\\\n0  1\\\\\n0  0\\\\\n0  0\n\\end{pmatrix}, \n\\qquad\nQ_{2} \\;=\\; \\begin{pmatrix}\n\\frac{3}{5}  0\\\\\n0  \\frac{3}{5}\\\\\n\\frac{4}{5}  0\\\\\n0  \\frac{4}{5}\n\\end{pmatrix}.\n$$\n请仅使用数值线性代数中的基本定义和性质，通过分析交叉格拉姆矩阵 $Q_{1}^{\\top} Q_{2}$ 的奇异值，来确定 $\\mathcal{S}_{1}$ 和 $\\mathcal{S}_{2}$ 之间的主交角。在您的推理中，请从标准正交基的定义、作为约束最大化问题解的主向量和主交角的定义，以及矩阵奇异值作为单位球面上的双线性形式最优值的特性出发。然后，将这些原理论证地联系起来，以说明 $Q_{1}^{\\top} Q_{2}$ 的奇异值如何编码主交角的余弦值。最后，从概念上解释接近 $1$ 或接近 $0$ 的奇异值如何分别揭示子空间之间的强重叠或近乎独立性，包括这对交集 $\\mathcal{S}_{1} \\cap \\mathcal{S}_{2}$ 维数的意义。\n\n报告最大主交角的精确形式作为您的最终答案，以弧度表示。不要提供数值近似值。",
                "solution": "**问题验证**\n\n**第一步：提取已知条件**\n- 向量空间：$\\mathbb{R}^{4}$，赋有标准内积。\n- 子空间 $\\mathcal{S}_{1} = \\operatorname{span}(Q_{1})$，一个二维子空间。\n- 子空间 $\\mathcal{S}_{2} = \\operatorname{span}(Q_{2})$，一个二维子空间。\n- $Q_{1} \\in \\mathbb{R}^{4 \\times 2}$ 的列是标准正交的。 $Q_{1} = \\begin{pmatrix} 1  0\\\\ 0  1\\\\ 0  0\\\\ 0  0 \\end{pmatrix}$。\n- $Q_{2} \\in \\mathbb{R}^{4 \\times 2}$ 的列是标准正交的。 $Q_{2} = \\begin{pmatrix} \\frac{3}{5}  0\\\\ 0  \\frac{3}{5}\\\\ \\frac{4}{5}  0\\\\ 0  \\frac{4}{5} \\end{pmatrix}$。\n- 任务：通过分析 $Q_{1}^{\\top} Q_{2}$ 的奇异值来确定 $\\mathcal{S}_{1}$ 和 $\\mathcal{S}_{2}$ 之间的主交角。\n- 方法论要求：\n    1. 从基本定义（标准正交基、作为约束最大值的主交角、作为最优双线性形式的奇异值分解）出发。\n    2. 将这些原理论证地联系起来。\n    3. 解释奇异值的含义。\n- 最终答案：最大主交角的精确形式（弧度）。\n\n**第二步：使用提取的已知条件进行验证**\n- 该问题具有科学依据。主交角和奇异值分解是数值线性代数中标准的、公认的概念。\n- 该问题是适定的。矩阵和子空间的维度是一致的。所提供的矩阵 $Q_1$ 和 $Q_2$ 是明确给出的，且它们的列确实如所述是标准正交的。对于 $Q_1$，其列是嵌入在 $\\mathbb{R}^4$ 中的 $\\mathbb{R}^2$ 的标准基向量，显然是标准正交的。对于 $Q_2$，其列是 $q_{21} = (\\frac{3}{5}, 0, \\frac{4}{5}, 0)^\\top$ 和 $q_{22} = (0, \\frac{3}{5}, 0, \\frac{4}{5})^\\top$。我们验证：$\\|q_{21}\\|^2 = (\\frac{3}{5})^2 + (\\frac{4}{5})^2 = \\frac{9}{25} + \\frac{16}{25} = 1$，$\\|q_{22}\\|^2 = (\\frac{3}{5})^2 + (\\frac{4}{5})^2 = 1$，以及 $q_{21}^\\top q_{22} = 0$。因此，前提条件是事实正确的。\n- 该问题是客观、完整的，并且不包含任何矛盾。存在唯一的解，并且可以从所提供的数据中推导出来。\n\n**第三步：结论与行动**\n问题是有效的。将提供一个完整的解答。\n\n**解答**\n\n设 $\\mathcal{S}_{1}$ 和 $\\mathcal{S}_{2}$ 是 $\\mathbb{R}^{p}$ 的两个子空间，其维度分别为 $d_1$ 和 $d_2$。设 $k = \\min(d_1, d_2)$。$\\mathcal{S}_{1}$ 和 $\\mathcal{S}_{2}$ 之间的主交角 $0 \\le \\theta_1 \\le \\theta_2 \\le \\dots \\le \\theta_k \\le \\frac{\\pi}{2}$ 是通过一系列约束优化问题递归定义的。\n\n第一个，也是最小的主交角 $\\theta_1$ 由下式给出\n$$ \\cos(\\theta_1) = \\max_{u \\in \\mathcal{S}_1, v \\in \\mathcal{S}_2} \\frac{u^\\top v}{\\|u\\| \\|v\\|} = \\max_{\\substack{u \\in \\mathcal{S}_1, \\|u\\|=1 \\\\ v \\in \\mathcal{S}_2, \\|v\\|=1}} u^\\top v $$\n设 $u_1$ 和 $v_1$ 是达到此最大值的向量（称为第一对主向量）。随后的主交角是通过在各自子空间内，先前找到的主向量的正交补中，寻找向量之间夹角余弦的最大值来找到的。对于 $j=2, \\dots, k$，第 $j$ 个主交角 $\\theta_j$ 定义为\n$$ \\cos(\\theta_j) = \\max_{\\substack{u \\in \\mathcal{S}_1, \\|u\\|=1, u \\perp u_1, \\dots, u \\perp u_{j-1} \\\\ v \\in \\mathcal{S}_2, \\|v\\|=1, v \\perp v_1, \\dots, v \\perp v_{j-1}}} u^\\top v $$\n其中 $\\{u_i\\}_{i=1}^{j-1}$ 和 $\\{v_i\\}_{i=1}^{j-1}$ 是先前确定的主向量。按照惯例，主交角是按顺序排列的，使得 $0 \\le \\theta_1 \\le \\theta_2 \\le \\dots \\le \\theta_k \\le \\frac{\\pi}{2}$，这意味着它们的余弦值按 $1 \\ge \\cos(\\theta_1) \\ge \\cos(\\theta_2) \\ge \\dots \\ge \\cos(\\theta_k) \\ge 0$ 的顺序排列。\n\n现在，我们将这个定义与奇异值分解（SVD）联系起来。设 $Q_1 \\in \\mathbb{R}^{p \\times d_1}$ 和 $Q_2 \\in \\mathbb{R}^{p \\times d_2}$ 是其列向量分别构成 $\\mathcal{S}_1$ 和 $\\mathcal{S}_2$ 的标准正交基的矩阵。$\\mathcal{S}_1$ 中的任何向量 $u$ 都可以唯一地表示为 $u = Q_1 x$，其中 $x \\in \\mathbb{R}^{d_1}$。因为 $Q_1$ 的列是标准正交的，我们有 $Q_1^\\top Q_1 = I_{d_1}$，即 $d_1 \\times d_1$ 的单位矩阵。这意味着范数是保持的：$\\|u\\|^2 = u^\\top u = (Q_1 x)^\\top (Q_1 x) = x^\\top Q_1^\\top Q_1 x = x^\\top I_{d_1} x = \\|x\\|^2$。类似地，$\\mathcal{S}_2$ 中的任何向量 $v$ 都可以写成 $v = Q_2 y$，其中 $y \\in \\mathbb{R}^{d_2}$，并且 $\\|v\\| = \\|y\\|$。\n\n将这些表示代入 $\\cos(\\theta_1)$ 的定义中：\n$$ \\cos(\\theta_1) = \\max_{\\substack{x \\in \\mathbb{R}^{d_1}, \\|x\\|=1 \\\\ y \\in \\mathbb{R}^{d_2}, \\|y\\|=1}} (Q_1 x)^\\top (Q_2 y) = \\max_{\\substack{x \\in \\mathbb{R}^{d_1}, \\|x\\|=1 \\\\ y \\in \\mathbb{R}^{d_2}, \\|y\\|=1}} x^\\top (Q_1^\\top Q_2) y $$\n设 $M = Q_1^\\top Q_2$。该表达式变为 $\\max_{\\|x\\|=1, \\|y\\|=1} x^\\top M y$。这正是矩阵 $M$ 的最大奇异值 $\\sigma_1$ 的变分定义。达到此最大值的向量 $x_1$ 和 $y_1$ 是对应于 $\\sigma_1$ 的 $M$ 的右奇异向量和左奇异向量。因此，$\\cos(\\theta_1) = \\sigma_1(Q_1^\\top Q_2)$。\n\n后续主交角的递归定义与其他奇异值的递归定义完全一致。例如，$\\cos(\\theta_2)$ 是通过在与第一主向量正交的向量上最大化内积来定义的。这个正交性条件 $u_2 \\perp u_1 = Q_1 x_1$，可转换为 $(Q_1 x_2)^\\top (Q_1 x_1) = x_2^\\top Q_1^\\top Q_1 x_1 = x_2^\\top x_1 = 0$。类似地，$v_2 \\perp v_1$ 意味着 $y_2^\\top y_1 = 0$。因此，\n$$ \\cos(\\theta_2) = \\max_{\\substack{x \\in \\mathbb{R}^{d_1}, \\|x\\|=1, x \\perp x_1 \\\\ y \\in \\mathbb{R}^{d_2}, \\|y\\|=1, y \\perp y_1}} x^\\top M y = \\sigma_2(M) $$\n总的来说，主交角的余弦值是矩阵 $M = Q_1^\\top Q_2$ 的奇异值：\n$$ \\cos(\\theta_i) = \\sigma_i(Q_1^\\top Q_2) \\quad \\text{for } i = 1, \\dots, k $$\n\n在此问题中，环境空间是 $\\mathbb{R}^{4}$ ($p=4$)，子空间 $\\mathcal{S}_1$ 和 $\\mathcal{S}_2$ 都是二维的 ($d_1=d_2=2$)。主交角的数量为 $k=\\min(2,2)=2$。给定的矩阵 $Q_1$ 和 $Q_2$ 是：\n$$ Q_{1} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}, \\quad Q_{2} = \\begin{pmatrix} \\frac{3}{5}  0 \\\\ 0  \\frac{3}{5} \\\\ \\frac{4}{5}  0 \\\\ 0  \\frac{4}{5} \\end{pmatrix} $$\n我们计算矩阵 $M = Q_1^\\top Q_2$：\n$$ M = Q_{1}^{\\top} Q_{2} = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\end{pmatrix} \\begin{pmatrix} \\frac{3}{5}  0 \\\\ 0  \\frac{3}{5} \\\\ \\frac{4}{5}  0 \\\\ 0  \\frac{4}{5} \\end{pmatrix} = \\begin{pmatrix} (1)(\\frac{3}{5}) + (0)(0) + (0)(\\frac{4}{5}) + (0)(0)  (1)(0) + (0)(\\frac{3}{5}) + (0)(0) + (0)(\\frac{4}{5}) \\\\ (0)(\\frac{3}{5}) + (1)(0) + (0)(\\frac{4}{5}) + (0)(0)  (0)(0) + (1)(\\frac{3}{5}) + (0)(0) + (0)(\\frac{4}{5}) \\end{pmatrix} $$\n$$ M = \\begin{pmatrix} \\frac{3}{5}  0 \\\\ 0  \\frac{3}{5} \\end{pmatrix} $$\n需要求 $M$ 的奇异值。由于 $M$ 是一个具有非负对角元素的对角矩阵，其奇异值就是对角元素本身，按非递增顺序排列。在这里，对角元素是相等的。因此，奇异值为 $\\sigma_1 = \\frac{3}{5}$ 和 $\\sigma_2 = \\frac{3}{5}$。\n\n根据我们的推导，主交角的余弦值就是这些奇异值：\n$$ \\cos(\\theta_1) = \\sigma_1 = \\frac{3}{5} \\implies \\theta_1 = \\arccos\\left(\\frac{3}{5}\\right) $$\n$$ \\cos(\\theta_2) = \\sigma_2 = \\frac{3}{5} \\implies \\theta_2 = \\arccos\\left(\\frac{3}{5}\\right) $$\n两个主交角相等。因此，最大的主交角是 $\\theta_2 = \\arccos\\left(\\frac{3}{5}\\right)$。\n\n从概念上讲，$Q_1^\\top Q_2$ 奇异值的大小表示子空间之间的对齐程度。\n奇异值 $\\sigma_i = 1$ 对应于主交角 $\\theta_i = 0$，意味着相应的主向量是相同的（$u_i=v_i$）。这样的向量位于两个子空间的交集中。等于 $1$ 的奇异值的数量恰好是交集 $\\mathcal{S}_1 \\cap \\mathcal{S}_2$ 的维数。在这个问题中，没有奇异值等于 $1$，所以我们可以得出结论 $\\dim(\\mathcal{S}_1 \\cap \\mathcal{S}_2) = 0$。\n奇异值 $\\sigma_i = 0$ 对应于主交角 $\\theta_i = \\frac{\\pi}{2}$，意味着相应的主向量是正交的（$u_i \\perp v_i$），并且子空间拥有一个相互正交的方向。在这个问题中，没有奇异值等于 $0$，因此子空间在任何主方向上都不是正交的。\n计算出的奇异值 $\\sigma_1 = \\sigma_2 = \\frac{3}{5}$ 表明两个子空间之间存在中等程度的，且在本例中是对称的对齐。\n\n问题要求的是最大主交角。由于主交角是按 $\\theta_1 \\le \\theta_2$ 排序的，最大的角是 $\\theta_2$。我们已经求得 $\\theta_1 = \\theta_2 = \\arccos\\left(\\frac{3}{5}\\right)$。因此，最大主交角是 $\\arccos\\left(\\frac{3}{5}\\right)$。",
                "answer": "$$\\boxed{\\arccos\\left(\\frac{3}{5}\\right)}$$",
                "id": "3555879"
            }
        ]
    }