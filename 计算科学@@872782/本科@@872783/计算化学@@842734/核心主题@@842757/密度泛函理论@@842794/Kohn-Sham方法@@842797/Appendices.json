{"hands_on_practices": [{"introduction": "虽然 Kohn-Sham 轨道在理论上是辅助的数学构造，但它们的能量在实践中常被用来近似估算如电离势等物理量。这个练习提供了一个动手实践的机会，让你比较 Kohn-Sham DFT 中这种近似的准确性与 Hartree-Fock 理论中定义更严格的 Koopmans 定理。通过这个练习，你将深入理解 Kohn-Sham 轨道能级的实际效用和解释时的细微差别。[@problem_id:2464919]", "problem": "给定在计算化学中用于近似计算电子系统第一电离势的定义。在 Hartree-Fock (HF) 近似和 Koopmans 定理下，第一电离势由最高占据分子轨道 (HOMO) 能量的负数来近似，即 $I_{\\mathrm{HF}} \\approx -\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{HF}}$。在 Kohn-Sham (KS) 密度泛函理论中，一个常见的实用近似是将最高占据 Kohn-Sham 轨道能量的负数作为第一电离势的估计值，即 $I_{\\mathrm{KS}} \\approx -\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{KS}}$。所有能量都必须以哈特里原子单位 $\\left(E_{\\mathrm{h}}\\right)$ 处理。\n\n针对一系列十个小的闭壳层系统，为您提供了以下测试集。每个测试用例是一个三元组 $\\left(\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{HF}}, \\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{KS}}, I_{\\mathrm{ref}}\\right)$，其中 $\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{HF}}$ 是以 $E_{\\mathrm{h}}$ 为单位的 HF HOMO 能量，$\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{KS}}$ 是以 $E_{\\mathrm{h}}$ 为单位的 KS HOMO 能量，而 $I_{\\mathrm{ref}}$ 是以 $E_{\\mathrm{h}}$ 为单位的参考第一电离势：\n- 系统 1: $\\left(-0.570, -0.300, 0.567\\right)$\n- 系统 2: $\\left(-0.605, -0.330, 0.572\\right)$\n- 系统 3: $\\left(-0.540, -0.310, 0.515\\right)$\n- 系统 4: $\\left(-0.502, -0.285, 0.464\\right)$\n- 系统 5: $\\left(-0.490, -0.270, 0.464\\right)$\n- 系统 6: $\\left(-0.400, -0.400, 0.400\\right)$\n- 系统 7: $\\left(-0.500, -0.300, 0.400\\right)$\n- 系统 8: $\\left(-0.700, -0.460, 0.470\\right)$\n- 系统 9: $\\left(-0.350, -0.345, 0.348\\right)$\n- 系统 10: $\\left(-0.001, -0.0005, 0.0008\\right)$\n\n对于每个系统 $i$，定义基于 HF 的近似 $I_{\\mathrm{HF},i} = -\\varepsilon_{\\mathrm{HOMO},i}^{\\mathrm{HF}}$ 和基于 Kohn-Sham 的近似 $I_{\\mathrm{KS},i} = -\\varepsilon_{\\mathrm{HOMO},i}^{\\mathrm{KS}}$。然后计算绝对误差的有符号差值\n$$\n\\Delta_i = \\left| I_{\\mathrm{KS},i} - I_{\\mathrm{ref},i} \\right| - \\left| I_{\\mathrm{HF},i} - I_{\\mathrm{ref},i} \\right|.\n$$\n负的 $\\Delta_i$ 表示对于系统 $i$，基于 Kohn-Sham 的近似更接近参考值，正的 $\\Delta_i$ 表示 Hartree-Fock Koopmans 近似更接近，而 $\\Delta_i = 0$ 表示两者精度相同。\n\n所有量都以哈特里原子单位 $E_{\\mathrm{h}}$ 计算和报告。本问题不涉及角度和百分比。\n\n您的程序必须：\n- 使用上述测试集。\n- 对于每个系统 $i$，按定义计算 $\\Delta_i$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，按系统 $1$ 到 $10$ 的顺序排列，每个 $\\Delta_i$ 四舍五入到六位小数。例如，包含三个假设结果的输出应如下所示：$\\left[\\Delta_1,\\Delta_2,\\Delta_3\\right] = [0.123456,-0.000010,0.000000]$，其中每个条目都以 $E_{\\mathrm{h}}$ 为单位。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,...,result10]”）。", "solution": "对问题陈述进行验证。\n\n步骤 1：提取已知信息。\n提供的已知信息如下：\n- 第一电离势的 Hartree-Fock (HF) 近似：$I_{\\mathrm{HF}} \\approx -\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{HF}}$。\n- 第一电离势的 Kohn-Sham (KS) 密度泛函理论近似：$I_{\\mathrm{KS}} \\approx -\\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{KS}}$。\n- 所有能量值均以哈特里原子单位 $E_{\\mathrm{h}}$ 给出。\n- 一个包含十个系统的测试集，每个系统由一个三元组 $(\\varepsilon_{\\mathrm{HOMO},i}^{\\mathrm{HF}}, \\varepsilon_{\\mathrm{HOMO},i}^{\\mathrm{KS}}, I_{\\mathrm{ref},i})$ 定义：\n  - 系统 1: $(-0.570, -0.300, 0.567)$\n  - 系统 2: $(-0.605, -0.330, 0.572)$\n  - 系统 3: $(-0.540, -0.310, 0.515)$\n  - 系统 4: $(-0.502, -0.285, 0.464)$\n  - 系统 5: $(-0.490, -0.270, 0.464)$\n  - 系统 6: $(-0.400, -0.400, 0.400)$\n  - 系统 7: $(-0.500, -0.300, 0.400)$\n  - 系统 8: $(-0.700, -0.460, 0.470)$\n  - 系统 9: $(-0.350, -0.345, 0.348)$\n  - 系统 10: $(-0.001, -0.0005, 0.0008)$\n- 对于每个系统 $i$，近似值被精确定义为 $I_{\\mathrm{HF},i} = -\\varepsilon_{\\mathrm{HOMO},i}^{\\mathrm{HF}}$ 和 $I_{\\mathrm{KS},i} = -\\varepsilon_{\\mathrm{HOMO},i}^{\\mathrm{KS}}$。\n- 需要计算的量是绝对误差的有符号差值：\n$$\n\\Delta_i = \\left| I_{\\mathrm{KS},i} - I_{\\mathrm{ref},i} \\right| - \\left| I_{\\mathrm{HF},i} - I_{\\mathrm{ref},i} \\right|.\n$$\n\n步骤 2：验证已知信息。\n从科学依据、良构性和客观性方面对问题进行评估。\n- **科学依据**：该问题基于计算量子化学中的既有概念。使用 Hartree-Fock 轨道能量（通过 Koopmans 定理）和 Kohn-Sham 轨道能量来近似第一电离势是标准的、尽管是近似的程序。所提供的轨道能量和电离势的数值对于小型电子系统而言在物理上是合理的。该问题在科学上是合理的。\n- **良构性**：该问题在数学上是良构的。所有必要的数据都已提供，目标量 $\\Delta_i$ 的公式是明确且无歧义的。可以为每个系统计算出唯一的结果。\n- **客观性**：问题陈述使用精确、客观的语言，没有主观断言或含糊之处。\n\n步骤 3：结论。\n问题有效。这是一个基于明确定义和合理科学背景的直接计算任务。将构建一个解决方案。\n\n任务是为十个系统中的每一个计算 $\\Delta_i$ 的值。计算过程首先从 HF 和 KS 方法确定近似电离势，然后计算它们各自相对于参考电离势 $I_{\\mathrm{ref},i}$ 的绝对误差。\n\n我们将 KS 近似的绝对误差定义为 $E_{\\mathrm{KS}, i} = | I_{\\mathrm{KS},i} - I_{\\mathrm{ref},i} |$，将 HF 近似的绝对误差定义为 $E_{\\mathrm{HF}, i} = | I_{\\mathrm{HF},i} - I_{\\mathrm{ref},i} |$。目标量即为 $\\Delta_i = E_{\\mathrm{KS}, i} - E_{\\mathrm{HF}, i}$。\n\n此过程应用于每个系统。我们以系统 1 为例演示计算过程。\n对于系统 1，给定的数据是 $(\\varepsilon_{\\mathrm{HOMO},1}^{\\mathrm{HF}}, \\varepsilon_{\\mathrm{HOMO},1}^{\\mathrm{KS}}, I_{\\mathrm{ref},1}) = (-0.570, -0.300, 0.567)$。\n\n1.  计算 HF 和 KS 电离势近似值：\n    $$I_{\\mathrm{HF},1} = -\\varepsilon_{\\mathrm{HOMO},1}^{\\mathrm{HF}} = -(-0.570) = 0.570 \\, E_{\\mathrm{h}}$$\n    $$I_{\\mathrm{KS},1} = -\\varepsilon_{\\mathrm{HOMO},1}^{\\mathrm{KS}} = -(-0.300) = 0.300 \\, E_{\\mathrm{h}}$$\n\n2.  计算每个近似值的绝对误差：\n    $$E_{\\mathrm{HF},1} = |I_{\\mathrm{HF},1} - I_{\\mathrm{ref},1}| = |0.570 - 0.567| = |0.003| = 0.003 \\, E_{\\mathrm{h}}$$\n    $$E_{\\mathrm{KS},1} = |I_{\\mathrm{KS},1} - I_{\\mathrm{ref},1}| = |0.300 - 0.567| = |-0.267| = 0.267 \\, E_{\\mathrm{h}}$$\n\n3.  计算绝对误差的有符号差值：\n    $$\\Delta_1 = E_{\\mathrm{KS},1} - E_{\\mathrm{HF},1} = 0.267 - 0.003 = 0.264 \\, E_{\\mathrm{h}}$$\n\n对所有十个系统重复此计算。结果如下：\n- 对于系统 1: $\\Delta_1 = |0.300 - 0.567| - |0.570 - 0.567| = 0.267 - 0.003 = 0.264$\n- 对于系统 2: $\\Delta_2 = |0.330 - 0.572| - |0.605 - 0.572| = 0.242 - 0.033 = 0.209$\n- 对于系统 3: $\\Delta_3 = |0.310 - 0.515| - |0.540 - 0.515| = 0.205 - 0.025 = 0.180$\n- 对于系统 4: $\\Delta_4 = |0.285 - 0.464| - |0.502 - 0.464| = 0.179 - 0.038 = 0.141$\n- 对于系统 5: $\\Delta_5 = |0.270 - 0.464| - |0.490 - 0.464| = 0.194 - 0.026 = 0.168$\n- 对于系统 6: $\\Delta_6 = |0.400 - 0.400| - |0.400 - 0.400| = 0.000 - 0.000 = 0.000$\n- 对于系统 7: $\\Delta_7 = |0.300 - 0.400| - |0.500 - 0.400| = 0.100 - 0.100 = 0.000$\n- 对于系统 8: $\\Delta_8 = |0.460 - 0.470| - |0.700 - 0.470| = 0.010 - 0.230 = -0.220$\n- 对于系统 9: $\\Delta_9 = |0.345 - 0.348| - |0.350 - 0.348| = 0.003 - 0.002 = 0.001$\n- 对于系统 10: $\\Delta_{10} = |0.0005 - 0.0008| - |0.001 - 0.0008| = 0.0003 - 0.0002 = 0.0001$\n\n最终输出要求将这些值格式化为一个列表，每个数字四舍五入到六位小数。\n最终的 $\\Delta_i$ 值列表是：\n$[0.264000, 0.209000, 0.180000, 0.141000, 0.168000, 0.000000, 0.000000, -0.220000, 0.001000, 0.000100]$。\n构建一个 Python 程序来执行这些计算并按规定格式化输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing Hartree-Fock and Kohn-Sham approximations\n    for the first ionization potential against reference values.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (HF HOMO energy, KS HOMO energy, reference IP)\n    # All values are in Hartree atomic units (E_h).\n    test_cases = [\n        (-0.570, -0.300, 0.567),   # System 1\n        (-0.605, -0.330, 0.572),   # System 2\n        (-0.540, -0.310, 0.515),   # System 3\n        (-0.502, -0.285, 0.464),   # System 4\n        (-0.490, -0.270, 0.464),   # System 5\n        (-0.400, -0.400, 0.400),   # System 6\n        (-0.500, -0.300, 0.400),   # System 7\n        (-0.700, -0.460, 0.470),   # System 8\n        (-0.350, -0.345, 0.348),   # System 9\n        (-0.001, -0.0005, 0.0008), # System 10\n    ]\n\n    results = []\n    for case in test_cases:\n        eps_homo_hf, eps_homo_ks, i_ref = case\n\n        # Calculate the ionization potential approximations.\n        # I_HF = -eps_HOMO_HF (Koopmans' theorem)\n        # I_KS = -eps_HOMO_KS (Common KS-DFT approximation)\n        i_hf = -eps_homo_hf\n        i_ks = -eps_homo_ks\n\n        # Calculate the absolute errors for each method.\n        error_hf = np.abs(i_hf - i_ref)\n        error_ks = np.abs(i_ks - i_ref)\n\n        # Calculate the signed difference of absolute errors.\n        # Delta = |I_KS - I_ref| - |I_HF - I_ref|\n        delta = error_ks - error_hf\n\n        results.append(delta)\n\n    # Format the results as a comma-separated string with each number\n    # rounded to six decimal places, enclosed in square brackets.\n    # The f-string format specifier \"{value:.6f}\" ensures this rounding and formatting.\n    output_string = f\"[{','.join(f'{d:.6f}' for d in results)}]\"\n\n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```", "id": "2464919"}, {"introduction": "“精确”的交换相关泛函形式是未知的，这催生了被称为“Jacob 天梯”的近似方法层级。本练习将引导你为一维模型反应构建并测试来自四个主要“梯级”（LDA, GGA, meta-GGA, 混合泛函）的泛函。这将让你具体理解，在泛函中增加成分的复杂性（如密度梯度和动能密度）如何影响像反应能垒这样的重要化学性质。[@problem_id:2464923]", "problem": "您将通过密度泛函理论（DFT）的 Kohn-Sham（KS）方法，实现一个基于模型的原理性计算，以比较由雅各布阶梯前四级中的每一种交换相关近似（局域密度近似（LDA）、广义梯度近似（GGA）、meta-广义梯度近似（meta-GGA）和一种混合泛函）所预测的反应势垒高度。您将从 Hohenberg–Kohn 定理和 Kohn–Sham 映射的基本陈述出发，然后沿着一个反应坐标定义一个一维模型密度，并针对反应物态密度和类过渡态密度评估该密度上的总能量泛函。反应势垒定义为过渡态能量与反应物能量之差，两者均以原子单位（Hartree）表示。最终程序必须为一小组测试用例计算这些势垒高度，并以指定格式打印出来。\n\n基本原理：\n- Hohenberg–Kohn 定理断言，基态能量是电子密度的泛函，而 Kohn–Sham 构造将相互作用问题映射到有效势中的非相互作用电子，从而得到一个能量泛函 $E[n]$，该泛函可分解为动能、Hartree 和交换相关分量。\n- 对于单电子系统，von Weizsäcker 动能泛函是精确的，并且 Hartree–Fock 交换精确地抵消了 Hartree 自相互作用：$E_{x}^{\\mathrm{exact}}[n] = -E_{H}[n]$。\n\n使用的模型定义：\n- 在一个空间维度上进行计算，坐标为 $x$（单位为玻尔）。在区间 $[-L, L]$ 上定义一个包含 $N_x$ 个点的均匀网格，间距为 $\\Delta x = \\frac{2L}{N_x-1}$。将网格点记为 $x_i$，$i=1,\\dots,N_x$。\n- 定义一个归一化的反应物密度 $n_R(x)$ 和一个归一化的过渡态密度 $n_{TS}(x)$，它们代表一个势阱半间距为 $a$ 的双势阱反应坐标：\n  - 反应物密度：\n    $n_R(x) = C_R \\exp\\!\\left(-\\frac{(x + a)^2}{2 \\sigma_R^2}\\right)$, $\\int_{-L}^{L} n_R(x)\\,dx = 1$。\n  - 过渡态密度（对称，离域在两个势阱上）：\n    $n_{TS}(x) = C_{TS} \\left[\\tfrac{1}{2}\\exp\\!\\left(-\\frac{(x - a)^2}{2 \\sigma_{TS}^2}\\right) + \\tfrac{1}{2}\\exp\\!\\left(-\\frac{(x + a)^2}{2 \\sigma_{TS}^2}\\right)\\right]$, $\\int_{-L}^{L} n_{TS}(x)\\,dx = 1$。\n- 对于给定的密度 $n(x)$，使用以下模型总能量泛函（原子单位）：\n  $E[n] = T_{W}[n] + E_{H}[n] + E_{x}[n]$，\n  其中：\n  - von Weizsäcker 动能（对单电子精确）：\n    $T_{W}[n] = \\frac{1}{8}\\int_{-L}^{L} \\frac{\\left|\\nabla n(x)\\right|^{2}}{n(x) + \\eta}\\,dx$，\n    其中有一个小的正则化项 $\\eta = 10^{-12}$，以避免在数值计算的尾部出现除以零的情况。\n  - 软库仑 Hartree 能量：\n    $E_{H}[n] = \\frac{1}{2}\\int_{-L}^{L}\\int_{-L}^{L} \\frac{n(x)\\,n(x')}{\\sqrt{(x-x')^{2} + \\epsilon^{2}}}\\,dx\\,dx'$，\n    其中软化参数 $\\epsilon > 0$（单位为玻尔）。\n  - 交换能 $E_{x}[n]$ 取决于所在的阶梯：\n    1. LDA 交换（非极化）：\n       $E_{x}^{\\mathrm{LDA}}[n] = \\int_{-L}^{L} e_{x}^{\\mathrm{LDA}}(n(x))\\,dx, \\quad e_{x}^{\\mathrm{LDA}}(n) = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{\\frac{1}{3}} n^{\\frac{4}{3}}$。\n       忽略相关能（设为零）。\n    2. GGA 交换，使用一个类 Perdew–Burke–Ernzerhof (PBE) 的增强因子：\n       $E_{x}^{\\mathrm{GGA}}[n] = \\int_{-L}^{L} e_{x}^{\\mathrm{LDA}}(n(x))\\,F_{x}(s(x))\\,dx$，\n       $F_{x}(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu s^{2}/\\kappa}$, $\\kappa = 0.804$, $\\mu = 0.21951$，\n       其中约化梯度为\n       $s(x) = \\frac{|\\nabla n(x)|}{2\\,k_{F}(n(x))\\,n(x)}$, $k_{F}(n) = \\left(3\\pi^{2} n\\right)^{\\frac{1}{3}}$，\n       计算时，为保证数值稳定性，$n(x)$ 的值被 $\\eta$ 从下方截断。\n    3. meta-GGA 交换，引入一个简单的依赖于动能密度的衰减因子：\n       $E_{x}^{\\mathrm{meta}}[n] = \\int_{-L}^{L} e_{x}^{\\mathrm{LDA}}(n(x))\\,F_{x}(s(x))\\,G(t_{W}(x))\\,dx$，\n       $G(t_{W}) = 1 - \\beta \\frac{t_{W}}{1 + t_{W}}$, $\\beta = 0.2$，\n       其中\n       $t_{W}(x) = \\frac{\\tau_{W}(x)}{\\tau_{TF}(x)}$, $\\tau_{W}(x) = \\frac{|\\nabla n(x)|^{2}}{8\\,(n(x)+\\eta)}$, $\\tau_{TF}(x) = \\frac{3}{10}\\left(3\\pi^{2}\\right)^{\\frac{2}{3}} n(x)^{\\frac{5}{3}}$。\n    4. 混合泛函，它将一部分比例为 $a$ 的精确（类 Hartree–Fock）交换与半局域 meta-GGA 交换混合。对于单电子密度 $n(x)$，精确交换等于负的 Hartree 能量，因此我们定义：\n       $E_{x}^{\\mathrm{hyb}}[n] = (1-a)\\,E_{x}^{\\mathrm{meta}}[n] + a\\,E_{x}^{\\mathrm{exact}}[n]$, $E_{x}^{\\mathrm{exact}}[n] = -E_{H}[n]$。\n       因此，总的混合能量变为：\n       $E^{\\mathrm{hyb}}[n] = T_{W}[n] + (1-a)\\,E_{H}[n] + (1-a)\\,E_{x}^{\\mathrm{meta}}[n]$。\n\n对于每一级阶梯，将反应势垒高度定义为：\n$B = E[n_{TS}] - E[n_{R}]$，\n单位为 Hartree。\n\n数值计算细节：\n- 在均匀网格上使用中心有限差分来近似 $\\nabla n(x)$。\n- 在均匀网格上使用矩形法则进行数值积分，即用 $\\sum_{i=1}^{N_x} f(x_i)\\,\\Delta x$ 替换 $\\int f(x)\\,dx$。对于 $E_{H}[n]$ 中的二重积分，使用相应的二维矩形法则和相同的间距，即 $\\iint \\cdot \\,dx\\,dx' \\approx \\sum_{i,j} (\\cdot)\\,(\\Delta x)^2$。\n- 使用相同的空间网格来构建 $n_R(x)$ 和 $n_{TS}(x)$ 并评估所有泛函。\n- 所有能量必须以 Hartree 为单位报告，并四舍五入到小数点后六位。\n\n待评估的测试套件：\n对于每个用例，使用元组 $(L,\\ N_x,\\ \\epsilon,\\ a,\\ \\sigma_R,\\ \\sigma_{TS},\\ a_{\\mathrm{hyb}})$，其中 $a_{\\mathrm{hyb}} = 0.25$：\n1. 用例 A (理想情况): $(12.0,\\ 801,\\ 0.5,\\ 2.0,\\ 0.6,\\ 0.9,\\ 0.25)$。\n2. 用例 B (更陡的密度，梯度边界): $(10.0,\\ 601,\\ 0.5,\\ 1.0,\\ 0.4,\\ 0.5,\\ 0.25)$。\n3. 用例 C (更离域的过渡态，更软的相互作用): $(15.0,\\ 1001,\\ 0.7,\\ 3.0,\\ 0.8,\\ 1.2,\\ 0.25)$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的扁平列表。该列表必须按顺序包含，对于上述给定的每个用例，按 LDA、GGA、meta-GGA、混合泛函的顺序排列的四个势垒高度。例如，输出必须如下所示：\n$$[B_{A,\\mathrm{LDA}}, B_{A,\\mathrm{GGA}}, B_{A,\\mathrm{meta}}, B_{A,\\mathrm{hyb}}, B_{B,\\mathrm{LDA}}, \\dots, B_{C,\\mathrm{hyb}}]$$\n其中每个 $B$ 都四舍五入到小数点后六位，并以 Hartree 为单位表示。\n\n您的任务：\n- 忠实地实现上述定义，并为测试套件计算势垒高度。通过遵循所提供的定义和数值稳定性说明，确保实现过程的科学合理性。", "solution": "所提出的问题是计算化学中一个定义明确且有科学依据的练习。它要求实现一个一维模型系统，以研究密度泛函理论（DFT）中雅各布阶梯前四级交换相关泛函的行为。该问题是自包含的，为完整的数值解提供了所有必要的定义、常数和参数。一维密度和能量泛函的定义，虽然是其三维对应物的简化类比，但为了此模型计算的目的已明确说明。此类模型对于教学目的和获得对不同近似性能的定性洞察非常有价值。因此，该问题是有效的，我们接下来将概述解决方案。\n\n核心任务是为交换相关泛函的四种不同近似计算反应势垒 `$B = E[n_{TS}] - E[n_{R}]$`。这需要几个不同的步骤：在离散网格上构建密度，实现总能量各分量的公式，最后组合这些分量以求得总能量和势垒高度。所有计算均在原子单位下进行，能量单位为 Hartree，长度单位为 Bohr。\n\n首先，我们建立计算域。连续的一维空间 `$x$` 在区间 `[-L, L]` 上被离散化为一个包含 `$N_x$` 个点的均匀网格。网格点用 `$x_i$` 表示（$i = 1, \\dots, N_x$），具有恒定的间距 `$\\Delta x = \\frac{2L}{N_x - 1}$`。\n\n在这个网格上，我们构建反应物密度 `$n_R(x)$` 和过渡态密度 `$n_{TS}(x)$`。反应物态由一个局域在单个势阱中的类高斯函数表示，而过渡态则由两个高斯函数的对称线性组合表示，对应于两个势阱之间的离域密度。其解析形式如下：\n$$n_{R, \\text{un-norm}}(x) = \\exp\\!\\left(-\\frac{(x + a)^2}{2 \\sigma_R^2}\\right)$$\n$$n_{TS, \\text{un-norm}}(x) = \\frac{1}{2}\\exp\\!\\left(-\\frac{(x - a)^2}{2 \\sigma_{TS}^2}\\right) + \\frac{1}{2}\\exp\\!\\left(-\\frac{(x + a)^2}{2 \\sigma_{TS}^2}\\right)$$\n这些密度必须归一化，使得在整个域上的积分等于 `$1$`，代表一个单电子。在数值上，这通过使用矩形积分法则来实现：`$\\int f(x) dx \\approx \\sum_{i=1}^{N_x} f(x_i) \\Delta x$`。因此，对于给定的未归一化密度 `$n_{\\text{un-norm}}(x_i)$`，其归一化常数 `$C$` 为 `$C = \\left( \\sum_i n_{\\text{un-norm}}(x_i) \\Delta x \\right)^{-1}$`。最终的离散密度则为 `$n(x_i) = C \\cdot n_{\\text{un-norm}}(x_i)$`。\n\n接下来，我们为 `$n_R$` 和 `$n_{TS}$` 评估总能量泛函 `$E[n]$`。总能量是动能、Hartree 和交换分量的总和：`$E[n] = T_{W}[n] + E_{H}[n] + E_{x}[n]$`。\n\nvon Weizsäcker 动能 `$T_W[n]$` 由下式给出：\n$$T_{W}[n] = \\frac{1}{8}\\int \\frac{\\left|\\nabla n(x)\\right|^{2}}{n(x) + \\eta}\\,dx \\approx \\frac{\\Delta x}{8} \\sum_i \\frac{\\left|\\nabla n_i\\right|^{2}}{n_i + \\eta}$$\n梯度 `$\\nabla n_i = \\frac{dn}{dx}|_{x_i}$` 对内部点使用中心有限差分方案近似，对边界点使用单边差分近似。一个小的正则化参数 `$\\eta = 10^{-12}$` 确保了在密度 `$n(x)$` 趋近于零的区域的数值稳定性。\n\nHartree 能量 `$E_H[n]$` 代表经典的静电自排斥。其软库仑形式在离散网格上使用二维矩形法则进行评估：\n$$E_{H}[n] = \\frac{1}{2}\\iint \\frac{n(x)\\,n(x')}{\\sqrt{(x-x')^{2} + \\epsilon^{2}}}\\,dx\\,dx' \\approx \\frac{(\\Delta x)^2}{2} \\sum_{i,j} \\frac{n_i n_j}{\\sqrt{(x_i-x_j)^{2} + \\epsilon^{2}}}$$\n其中 `$\\epsilon$` 是软化参数。这个 `$O(N_x^2)$` 的计算是整个过程中计算量最大的部分。\n\n交换能 `$E_x[n]$` 是雅各布阶梯四级之间差异所在。\n\n$1$。**LDA (局域密度近似)**：这是最简单的近似，仅依赖于局域密度 `$n(x)$`。\n$$E_{x}^{\\mathrm{LDA}}[n] = \\int e_{x}^{\\mathrm{LDA}}(n(x))\\,dx \\approx \\Delta x \\sum_i \\left( -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{\\frac{1}{3}} n_i^{\\frac{4}{3}} \\right)$$\n\n$2$。**GGA (广义梯度近似)**：这一级通过引入对密度局域梯度 `$\\nabla n(x)$` 的依赖性（通过约化密度梯度 `$s(x)$`）来改进 LDA。\n$$E_{x}^{\\mathrm{GGA}}[n] = \\int e_{x}^{\\mathrm{LDA}}(n(x)) F_x(s(x)) \\,dx \\approx \\Delta x \\sum_i e_{x}^{\\mathrm{LDA}}(n_i) F_x(s_i)$$\n增强因子为 `$F_{x}(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu s^{2}/\\kappa}$`，其中常数 `$\\kappa = 0.804$` 和 `$\\mu = 0.21951$`。约化梯度 `$s_i$` 在每个网格点上使用 `$s_i = \\frac{|\\nabla n_i|}{2 k_F(n_i) n_i}$` 计算，其中 `$k_F(n) = (3\\pi^2 n)^{1/3}$` 是费米波矢。为保持稳定性，分母中和幂次中的密度 `$n_i$` 在数值上被 `$\\eta$` 从下方截断。\n\n$3$。**meta-GGA**：这一级增加了对动能密度的依赖性，提供了更大的灵活性。此处使用了 von Weizsäcker 动能密度 `$\\tau_W(x) = \\frac{|\\nabla n(x)|^2}{8(n(x)+\\eta)}$`。\n$$E_{x}^{\\mathrm{meta}}[n] = \\int e_{x}^{\\mathrm{LDA}}(n(x)) F_x(s(x)) G(t_W(x)) \\,dx \\approx \\Delta x \\sum_i e_{x}^{\\mathrm{LDA}}(n_i) F_x(s_i) G(t_{W,i})$$\n衰减因子为 `$G(t_W) = 1 - \\beta \\frac{t_W}{1 + t_W}$`，其中 `$\\beta=0.2$`。成分 `$t_W(x)$` 是 von Weizsäcker 动能密度与 Thomas-Fermi 动能密度的比值，即 `$t_W = \\tau_W / \\tau_{TF}$`，其中 `$\\tau_{TF}(x) = \\frac{3}{10}(3\\pi^2)^{2/3} n(x)^{5/3}$`。同样，在必要时应用数值正则化。\n\n$4$。**混合泛函**：这一级将一部分精确交换与半局域泛函混合。对于单电子系统，精确交换能完全抵消了虚假的 Hartree 自相互作用，即 `$E_{x}^{\\mathrm{exact}}[n] = -E_{H}[n]$`。因此，混合泛函的总能量定义为：\n$$E^{\\mathrm{hyb}}[n] = T_{W}[n] + (1-a)\\,E_{H}[n] + (1-a)\\,E_{x}^{\\mathrm{meta}}[n]$$\n这里，`$a$` 是精确交换的比例，给定为 `$0.25$`。\n\n对于由元组 `$(L, N_x, \\epsilon, a, \\sigma_R, \\sigma_{TS}, a_{\\mathrm{hyb}})$` 指定的每个测试用例，我们首先构建 `$n_R$` 和 `$n_{TS}$`。然后，对于每种密度，我们计算四种总能量：`$E^{\\mathrm{LDA}}$`、`$E^{\\mathrm{GGA}}$`、`$E^{\\mathrm{meta}}$` 和 `$E^{\\mathrm{hyb}}$`。然后将每种泛函的反应势垒计算为差值 `$B = E[n_{TS}] - E[n_{R}]$`。最终结果被收集并格式化为单个列表，四舍五入到小数点后六位，从而为该模型问题提供了泛函的定量比较。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# A strict Russian professor would define constants at the top, not inside functions.\n# These constants are derived from the problem statement.\nETA = 1e-12\nKAPPA = 0.804\nMU = 0.21951\nBETA = 0.2\n\n# Pre-calculate factors for efficiency.\nLDA_C = -3.0 / 4.0 * (3.0 / np.pi)**(1.0 / 3.0)\nKF_C = (3.0 * np.pi**2)**(1.0 / 3.0)\nTAUTF_C = 3.0 / 10.0 * (3.0 * np.pi**2)**(2.0 / 3.0)\n\ndef compute_total_energies(n_grid, x_grid, dx, epsilon, a_hyb):\n    \"\"\"\n    Computes the total energy of a given 1D density for all four functionals.\n    The implementation follows the definitions provided in the problem statement meticulously.\n    \"\"\"\n    # Step 1: Calculate the gradient of the density.\n    # np.gradient uses centered differences for interior points, which is appropriate.\n    grad_n = np.gradient(n_grid, dx)\n\n    # Step 2: Calculate the von Weizsäcker kinetic energy, T_W.\n    # The term n(x) + eta is used as per the formula's regularization.\n    T_w_integrand = 0.125 * np.abs(grad_n)**2 / (n_grid + ETA)\n    T_w = np.sum(T_w_integrand) * dx\n\n    # Step 3: Calculate the soft-Coulomb Hartree energy, E_H.\n    # This O(N^2) calculation is vectorized with numpy for performance.\n    x_i, x_j = np.meshgrid(x_grid, x_grid, indexing='ij')\n    n_i, n_j = np.meshgrid(n_grid, n_grid, indexing='ij')\n    dist_sq = (x_i - x_j)**2\n    E_h_integrand = (n_i * n_j) / np.sqrt(dist_sq + epsilon**2)\n    E_h = 0.5 * np.sum(E_h_integrand) * dx**2\n\n    # Step 4: Calculate exchange energies for a tour of Jacob's Ladder.\n    # For stability in fractional powers and denominators, clip n_grid from below.\n    n_clipped = np.maximum(n_grid, ETA)\n\n    # Rung 1: LDA Exchange Energy\n    ex_lda_density = LDA_C * n_clipped**(4.0 / 3.0)\n    Ex_lda = np.sum(ex_lda_density) * dx\n\n    # Rung 2: GGA Exchange Energy\n    kF = KF_C * n_clipped**(1.0 / 3.0)\n    s = np.abs(grad_n) / (2.0 * kF * n_clipped)\n    Fx = 1.0 + KAPPA - KAPPA / (1.0 + MU * s**2 / KAPPA)\n    Ex_gga = np.sum(ex_lda_density * Fx) * dx\n\n    # Rung 3: meta-GGA Exchange Energy\n    tau_w_density = 0.125 * np.abs(grad_n)**2 / (n_grid + ETA)\n    tau_tf_density = TAUTF_C * n_clipped**(5.0 / 3.0)\n    # Add regularization to denominator to prevent potential 0/0 issues.\n    t_w = tau_w_density / (tau_tf_density + ETA)\n    G_tW = 1.0 - BETA * t_w / (1.0 + t_w)\n    Ex_mgga = np.sum(ex_lda_density * Fx * G_tW) * dx\n\n    # Step 5: Assemble the total energies for each functional.\n    E_lda = T_w + E_h + Ex_lda\n    E_gga = T_w + E_h + Ex_gga\n    E_mgga = T_w + E_h + Ex_mgga\n\n    # Rung 4: Hybrid Functional Total Energy\n    # Using the specific simplified total energy expression for the hybrid.\n    E_hyb = T_w + (1.0 - a_hyb) * E_h + (1.0 - a_hyb) * Ex_mgga\n\n    return {\"lda\": E_lda, \"gga\": E_gga, \"meta\": E_mgga, \"hyb\": E_hyb}\n\ndef compute_barriers_for_case(case):\n    \"\"\"\n    Orchestrates the calculation for a single test case from the problem suite.\n    \"\"\"\n    L, Nx, epsilon, a_sep, sigma_R, sigma_TS, a_hyb = case\n\n    # Setup the spatial grid.\n    x_grid = np.linspace(-L, L, Nx)\n    dx = x_grid[1] - x_grid[0]\n\n    # Construct and normalize the reactant density (n_R).\n    n_R_unnormalized = np.exp(-(x_grid + a_sep)**2 / (2.0 * sigma_R**2))\n    norm_R = np.sum(n_R_unnormalized) * dx\n    n_R_grid = n_R_unnormalized / norm_R\n\n    # Construct and normalize the transition-state density (n_TS).\n    n_TS_unnormalized = 0.5 * (np.exp(-(x_grid - a_sep)**2 / (2.0 * sigma_TS**2)) +\n                               np.exp(-(x_grid + a_sep)**2 / (2.0 * sigma_TS**2)))\n    norm_TS = np.sum(n_TS_unnormalized) * dx\n    n_TS_grid = n_TS_unnormalized / norm_TS\n\n    # Calculate total energies for both reactant and transition-state densities.\n    energies_R = compute_total_energies(n_R_grid, x_grid, dx, epsilon, a_hyb)\n    energies_TS = compute_total_energies(n_TS_grid, x_grid, dx, epsilon, a_hyb)\n\n    # The barrier height is the difference in energy.\n    barrier_lda = energies_TS[\"lda\"] - energies_R[\"lda\"]\n    barrier_gga = energies_TS[\"gga\"] - energies_R[\"gga\"]\n    barrier_meta = energies_TS[\"meta\"] - energies_R[\"meta\"]\n    barrier_hyb = energies_TS[\"hyb\"] - energies_R[\"hyb\"]\n\n    return [barrier_lda, barrier_gga, barrier_meta, barrier_hyb]\n\ndef solve():\n    \"\"\"\n    Main function to execute the full problem: iterate through test cases,\n    compute barriers, and print the results in the required format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N_x, epsilon, a, sigma_R, sigma_TS, a_hyb)\n        (12.0, 801, 0.5, 2.0, 0.6, 0.9, 0.25),\n        (10.0, 601, 0.5, 1.0, 0.4, 0.5, 0.25),\n        (15.0, 1001, 0.7, 3.0, 0.8, 1.2, 0.25),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        barriers = compute_barriers_for_case(case)\n        all_results.extend(barriers)\n\n    # Format the results to exactly six decimal places as requested.\n    formatted_results = [f\"{res:.6f}\" for res in all_results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2464923"}, {"introduction": "标准密度泛函最显著的缺陷之一是自相互作用误差（SIE），它会导致对具有定域电子的材料（如过渡金属氧化物）的错误预测。本练习使用一个简单但功能强大的模型来演示 SIE 如何导致错误地将绝缘体预测为金属。然后，它展示了 DFT+U 方法如何通过惩罚非整数的电子占据数来修正这一错误，从而打开带隙，得到定性正确的描述。[@problem_id:2464929]", "problem": "构建一个独立的程序，该程序在密度泛函理论 (DFT) 的 Kohn-Sham (KS) 方法框架下，模拟一个易于产生自相互作用的近似泛函如何错误地预测局域过渡金属 $d$-轨道（如氧化镍中）的金属态，以及 DFT 加 Hubbard $U$ (DFT+U) 形式的在位校正如何通过惩罚 $d$-轨道的分数占据来打开带隙。\n\n使用以下玩具但有科学依据的设置。考虑一个具有两个自旋通道 $\\uparrow$ 和 $\\downarrow$ 的单局域 $d$-轨道，其总固定占据数为 $N = n_{\\uparrow} + n_{\\downarrow} = 1$。设裸单电子在位能为 $\\varepsilon_d$（单位为电子伏特），并令 $U \\ge 0$（单位为电子伏特）参数化标准泛函未能完美捕捉的在位相互作用强度。定义以下两个能量模型。\n\n1. 易于产生自相互作用的 DFT 模型（SIE 模型）：总能量作为总占据数 $N$ 的函数为\n$$\nE_{\\mathrm{SIE}}(N) = \\varepsilon_d\\,N + \\frac{U}{2}\\,N^2.\n$$\nKS 轨道能（两个自旋相同）是泛函导数\n$$\n\\epsilon^{\\mathrm{SIE}}_{\\sigma} = \\frac{\\partial E_{\\mathrm{SIE}}}{\\partial N} = \\varepsilon_d + U N,\n$$\n因此当 $N=1$ 时，$\\epsilon^{\\mathrm{SIE}}_{\\uparrow} = \\epsilon^{\\mathrm{SIE}}_{\\downarrow}$。将 KS 带隙定义为自洽解中最低未占 KS 特征值与最高已占 KS 特征值之差。在此模型下，当 $N=1$ 时，自旋简并的 KS 能级意味着 KS 带隙为零，\n$$\nE_g^{\\mathrm{SIE}} = 0.\n$$\n\n2. DFT 加 Hubbard $U$ 模型（DFT+U，Dudarev 风格）：校正后的能量泛函通过以下方式惩罚分数占据\n$$\nE_{U}(n_{\\uparrow}, n_{\\downarrow}) = \\varepsilon_d\\,(n_{\\uparrow} + n_{\\downarrow}) + \\frac{U}{2}\\Big[n_{\\uparrow}\\big(1 - n_{\\uparrow}\\big) + n_{\\downarrow}\\big(1 - n_{\\downarrow}\\big)\\Big],\n$$\n约束条件为 $n_{\\uparrow} + n_{\\downarrow} = 1$ 和 $0 \\le n_{\\sigma} \\le 1$。KS 轨道能是偏导数\n$$\n\\epsilon^{U}_{\\sigma} = \\frac{\\partial E_U}{\\partial n_{\\sigma}} = \\varepsilon_d + \\frac{U}{2}\\big(1 - 2 n_{\\sigma}\\big).\n$$\n在 $n_{\\uparrow} + n_{\\downarrow} = 1$ 的约束下，能量最小值处占据数变为整数，$n_{\\uparrow} \\in \\{0,1\\}$ 且 $n_{\\downarrow} = 1 - n_{\\uparrow}$，因此一个自旋通道被占据，而另一个未被占据。此时 KS 带隙为\n$$\nE_g^{U} = \\epsilon^{U}_{\\text{unoccupied}} - \\epsilon^{U}_{\\text{occupied}} = U.\n$$\n\n对于每个测试用例 $(\\varepsilon_d, U)$，你的程序必须计算并返回有序对 $\\big(E_g^{\\mathrm{SIE}}, E_g^{U}\\big)$，两者均以电子伏特表示，并四舍五入到三位小数。\n\n用于评估的测试套件：\n- 案例 1 (理想路径): $\\varepsilon_d = 0.0\\,\\mathrm{eV}$，$U = 4.0\\,\\mathrm{eV}$。\n- 案例 2 (在位能偏移): $\\varepsilon_d = 1.0\\,\\mathrm{eV}$，$U = 3.0\\,\\mathrm{eV}$。\n- 案例 3 (弱关联): $\\varepsilon_d = -2.0\\,\\mathrm{eV}$，$U = 0.5\\,\\mathrm{eV}$。\n- 案例 4 (边界条件): $\\varepsilon_d = 0.0\\,\\mathrm{eV}$，$U = 0.0\\,\\mathrm{eV}$。\n\n物理单位：所有能量必须以电子伏特表示，并四舍五入到三位小数。\n\n最终输出格式：你的程序应生成单行输出，其中包含结果，形式为逗号分隔的对列表，每对以 $\\big(E_g^{\\mathrm{SIE}}, E_g^{U}\\big)$ 的顺序写成一个双元素列表。总输出必须是一个包含所有对的单一列表，例如 $[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]$，其中每个 $a_i$ 和 $b_i$ 都四舍五入到三位小数，并且不打印任何单位。", "solution": "问题陈述已经过严格验证，并被确定为是合理的。它在科学上基于密度泛函理论 (DFT) 的原理，问题设定良好，目标清晰唯一，且表述客观。所提出的模型虽然经过简化，但正确地抓住了近似 DFT 泛函中自相互作用误差 (SIE) 的本质及其通过 DFT+U 方法的修正。可以继续进行求解。\n\n任务是计算描述单个局域轨道（具有两个自旋通道，由总共 $N=1$ 个电子占据）的两种不同能量模型的 Kohn-Sham (KS) 带隙。输入参数是裸在位能 $\\varepsilon_d$ 和在位 Hubbard 相互作用参数 $U$。\n\n首先，我们分析易于产生自相互作用的模型，记为 SIE 模型。总能量由下式给出：\n$$\nE_{\\mathrm{SIE}}(N) = \\varepsilon_d\\,N + \\frac{U}{2}\\,N^2\n$$\n在这里，能量仅是总电子数 $N$ 的函数。这种泛函形式是局域或半局域密度泛函的典型特征，这些泛函无法区分一个电子与其它电子相互作用和该电子与自身相互作用。能量泛函是 $N$ 的一个凸函数，具体来说是一个开口向上的抛物线。对于固定的总占据数 $N=1$，系统对于该占据数如何在自旋通道间分布是无所谓的，即 $n_{\\uparrow}=n_{\\downarrow}=0.5$ 在能量上等价于 $n_{\\uparrow}=1, n_{\\downarrow}=0$。KS 轨道能定义为总能量相对于电子数的导数。由于 $E_{\\mathrm{SIE}}$ 仅依赖于 $N$，导数必须是关于 $N$ 的：\n$$\n\\epsilon^{\\mathrm{SIE}}_{\\sigma} = \\frac{\\partial E_{\\mathrm{SIE}}}{\\partial N} = \\varepsilon_d + U N\n$$\n对于总占据数 $N=1$，自旋向上 ($\\sigma = \\uparrow$) 和自旋向下 ($\\sigma = \\downarrow$) 通道的 KS 能量是相同的：\n$$\n\\epsilon^{\\mathrm{SIE}}_{\\uparrow} = \\epsilon^{\\mathrm{SIE}}_{\\downarrow} = \\varepsilon_d + U\n$$\n该系统包含一个分布在两个简并自旋态上的电子。因此，最高已占分子轨道 (HOMO) 和最低未占分子轨道 (LUMO) 是同一个简并能级。带隙定义为 LUMO 和 HOMO 能量之差，因此为零。\n$$\nE_g^{\\mathrm{SIE}} = 0\n$$\n这个结果正确地模拟了此类泛函的失败之处，即它们为实际是绝缘体的系统预测了金属态 ($E_g=0$)，这是源于自相互作用的离域误差的典型表现。$\\varepsilon_d$ 的值影响能级的绝对位置，但不影响带隙。\n\n接下来，我们分析 DFT+U 模型，该模型引入了一个校正项以惩罚非整数占据。能量泛函给出如下：\n$$\nE_{U}(n_{\\uparrow}, n_{\\downarrow}) = \\varepsilon_d\\,(n_{\\uparrow} + n_{\\downarrow}) + \\frac{U}{2}\\Big[n_{\\uparrow}\\big(1 - n_{\\uparrow}\\big) + n_{\\downarrow}\\big(1 - n_{\\downarrow}\\big)\\Big]\n$$\n这是 Dudarev 等人的公式。我们受约束条件 $n_{\\uparrow} + n_{\\downarrow} = 1$ 的限制。我们通过设置 $n_{\\uparrow} = n$ 和 $n_{\\downarrow} = 1-n$ 来分析能量，其中 $n \\in [0, 1]$。\n$$\nE_{U}(n) = \\varepsilon_d(n + (1-n)) + \\frac{U}{2}\\Big[n(1-n) + (1-n)(1-(1-n))\\Big]\n$$\n$$\nE_{U}(n) = \\varepsilon_d + U(n - n^2)\n$$\n能量依赖于单个变量 $n$。项 $U(n - n^2)$ 是一个凹抛物线，在 $n=0.5$ 处有最大值。为了在 $U>0$ 时最小化总能量，$n$ 必须取其定义域边界上的值，即 $n=0$ 或 $n=1$。这对应于整数占据：$(n_{\\uparrow}, n_{\\downarrow}) = (1, 0)$ 或 $(0, 1)$。这正确地迫使电子完全局域在某个自旋通道中，从而打破了自旋简并。\n\n我们选择基态为 $(n_{\\uparrow}, n_{\\downarrow}) = (1, 0)$。在此构型中，自旋向上的轨道被占据，而自旋向下的轨道未被占据。KS 轨道能是关于单个自旋占据数的偏导数：\n$$\n\\epsilon^{U}_{\\sigma} = \\frac{\\partial E_U}{\\partial n_{\\sigma}} = \\varepsilon_d + \\frac{U}{2}\\big(1 - 2 n_{\\sigma}\\big)\n$$\n对于占据的（自旋向上）通道，其 $n_{\\uparrow}=1$：\n$$\n\\epsilon^{U}_{\\text{occupied}} = \\epsilon^{U}_{\\uparrow} = \\varepsilon_d + \\frac{U}{2}(1 - 2 \\cdot 1) = \\varepsilon_d - \\frac{U}{2}\n$$\n对于未占据的（自旋向下）通道，其 $n_{\\downarrow}=0$：\n$$\n\\epsilon^{U}_{\\text{unoccupied}} = \\epsilon^{U}_{\\downarrow} = \\varepsilon_d + \\frac{U}{2}(1 - 2 \\cdot 0) = \\varepsilon_d + \\frac{U}{2}\n$$\nKS 带隙 $E_g^{U}$ 是未占据能级和已占据能级之差：\n$$\nE_g^{U} = \\epsilon^{U}_{\\text{unoccupied}} - \\epsilon^{U}_{\\text{occupied}} = \\left(\\varepsilon_d + \\frac{U}{2}\\right) - \\left(\\varepsilon_d - \\frac{U}{2}\\right) = U\n$$\nDFT+U 校正成功地打开了一个大小为 $U$ 的带隙，从而正确地预测了绝缘态。在位能 $\\varepsilon_d$ 同等地移动了两个能级，但并不影响带隙。\n\n总而言之，对于任何给定的测试用例 $(\\varepsilon_d, U)$，计算出的带隙为：\n- $E_g^{\\mathrm{SIE}} = 0$\n- $E_g^{U} = U$\n\n计算任务是将这些简单的关系应用于所提供的测试用例集，并按规定格式化输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the band gaps for a simplified DFT and DFT+U model\n    of a single localized d-orbital.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each case is a tuple (epsilon_d, U) in electronvolts.\n    test_cases = [\n        (0.0, 4.0),   # Case 1 (happy path)\n        (1.0, 3.0),   # Case 2 (shifted on-site energy)\n        (-2.0, 0.5),  # Case 3 (weak correlation)\n        (0.0, 0.0),   # Case 4 (boundary condition)\n    ]\n\n    results = []\n    \n    # Process each test case based on the derived formulas.\n    for case in test_cases:\n        # The problem statement defines epsilon_d and U, but the band gap\n        # calculations are simplified as per the model's conclusions.\n        # epsilon_d is not needed for the final band gap calculation.\n        _epsilon_d, u_val = case\n        \n        # In the self-interaction-prone (SIE) model, the KS levels are\n        # degenerate for N=1, resulting in a zero band gap.\n        eg_sie = 0.0\n        \n        # In the DFT+U model, the correction opens a gap equal to U.\n        eg_u = u_val\n        \n        # Format the results to three decimal places and store them as a string\n        # representing a two-element list.\n        result_pair_str = f\"[{eg_sie:.3f},{eg_u:.3f}]\"\n        results.append(result_pair_str)\n\n    # Final print statement in the exact required format: a string representing\n    # a list of lists.\n    # Example: [[0.000,4.000],[0.000,3.000],[0.000,0.500],[0.000,0.000]]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2464929"}]}