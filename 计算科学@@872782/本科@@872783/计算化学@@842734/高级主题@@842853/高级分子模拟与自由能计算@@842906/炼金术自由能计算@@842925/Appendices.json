{"hands_on_practices": [{"introduction": "任何可靠的自由能计算都始于一个稳健的理论方案。热力学循环是该方案的基石，它提供了一个严谨的框架，将一个我们想求得但难以直接测量的自由能差，与一系列在计算上更易于实现的炼金术步骤联系起来。本练习将挑战你像计算化学家一样思考，设计出正确的“炼金术路线图”。通过评估针对一个真实研究问题——计算两种配体与目标蛋白的相对结合亲和力——的几种不同方案，你将掌握构建热力学上严谨路径的核心技能 [@problem_id:2448825]。这确保了你的计算工作能够导向一个有意义且正确的物理量。", "problem": "您的任务是计算在等温等压条件下，pH值为7时，苯与酚相对于工程改造的T$4$溶菌酶L$99$A疏水腔的相对结合自由能。在pH值为7时，两种配体都呈中性，您可以假设它们在腔内具有共同的结合姿势，并且所有模拟对共享的原子使用相同的力场参数，炼金术变换使用软核势。长程静电作用采用粒子网格埃瓦尔德（PME）方法处理，并一致地应用长程色散校正。如果使用任何位置或朝向约束，必须在不同环境中保持一致的应用。请选择所有能够计算出此体系中酚相对于苯的期望相对结合自由能的热力学上严格的炼金术循环。\n\nA. 在蛋白质结合位点中对苯进行到酚的单拓扑相对炼金术变换，以获得该过程的可逆功；并独立地在体相水中进行相同的变换。在两种环境中使用相同的约束方案（如有），以使约束的贡献相互抵消。相对结合自由能通过结合态和溶剂化态变换自由能之差获得。\n\nB. 通过双解偶联方法分别计算苯和酚的绝对结合自由能：将每种配体与蛋白质环境和体相水进行炼金术解偶联，以获得每种配体的绝对标准结合自由能，包括所使用的任何约束相关的标准态校正。然后，相对结合自由能就是两种绝对结合自由能之差。\n\nC. 仅执行蛋白质结合态下苯到酚的相对变换，并将其可逆功直接解释为相对结合自由能，因为两种配体都是中性的，溶剂化效应被隐式抵消了。\n\nD. 在体相水中，将苯变换为酚盐以捕捉氢键差异，而在蛋白质结合位点中，将苯变换为中性酚。将两者的可逆功相减以获得相对结合自由能。\n\nE. 在蛋白质中，将苯完全解偶联，并在一个独立的模拟中，将酚从无到有地耦合到蛋白质环境中，然后取这两个可逆功的差值。不要在体相水中进行任何模拟，因为结合位点定义了相关的参考态。\n\nF. 使用分子力学泊松-玻尔兹曼表面积（MM-PBSA）方法，对与蛋白质结合以及在水中的苯和酚的终点轨迹来估计相对结合自由能，并将该差异解释为炼金术相对结合自由能。", "solution": "将首先对问题陈述进行严格验证。\n\n### 步骤1：提取已知条件\n- **目标：** 计算酚（$L_2$）相对于苯（$L_1$）与T$4$溶菌酶L$99$A突变体结合的相对结合自由能 $\\Delta\\Delta G_{\\text{bind}}$。\n- **系统：** 蛋白质为T$4$溶菌酶L$99$A。配体为苯（$L_1$）和酚（$L_2$）。\n- **条件：** 等温等压系综，pH $7$。\n- **配体性质：** 在pH $7$时，苯和酚均为中性。\n- **假设与方法细节：**\n    - 配体共享一个共同的结合姿势。\n    - 炼金术变换采用单拓扑方法。\n    - 共享原子的力场参数相同。\n    - 炼金术变换使用软核势。\n    - 长程静电作用通过粒子网格埃瓦尔德（PME）处理。\n    - 应用了长程色散校正。\n    - 位置/朝向约束在不同环境中一致应用。\n- **任务：** 识别所有能够得出期望的相对结合自由能的热力学上严格的炼金术循环。\n\n### 步骤2：使用提取的已知条件进行验证\n对问题陈述的有效性进行评估。\n\n- **科学依据：** 该问题牢固地建立在计算化学和分子生物物理学领域。它描述了一个典型问题——计算相对配体结合亲和力——使用了标准的、最先进的模拟技术（炼金术自由能微扰或热力学积分、PME、软核势）。所选的系统，即T$4$溶菌酶L$99$A与小芳香族配体，是广泛用于验证此类方法的基准。所涉及的概念，如热力学循环和作为状态函数的吉布斯自由能，是统计力学和热力学的基本原理。该问题在科学上是合理的。\n- **问题的适定性：** 目标陈述清晰：确定所提出的程序中哪些代表了通往相对结合自由能的热力学严格路径。上下文和约束条件（pH、温度、压力、模拟细节）已充分指定，足以根据既定理论对所提出的方法进行明确评估。可以确定一组唯一的正确选项。\n- **客观性：** 该问题使用精确、无歧义的技术语言进行表述。它不含主观主张或意见。\n\n### 步骤3：结论与行动\n问题陈述是**有效的**。它具有科学依据，问题适定且客观。将推导解决方案。\n\n### 正确答案的推导\n\n目标量是酚（$L_2$）相对于苯（$L_1$）与蛋白质（$P$）结合的相对结合自由能 $\\Delta\\Delta G_{\\text{bind}}$。其定义为它们绝对结合自由能的差值：\n$$ \\Delta\\Delta G_{\\text{bind}} \\equiv \\Delta G_{\\text{bind}}(L_2) - \\Delta G_{\\text{bind}}(L_1) $$\n其中 $\\Delta G_{\\text{bind}}(L_1)$ 和 $\\Delta G_{\\text{bind}}(L_2)$ 是以下结合过程的标准自由能：\n$$ P + L_1 \\rightleftharpoons PL_1 \\quad (\\Delta G_{\\text{bind}}(L_1)) $$\n$$ P + L_2 \\rightleftharpoons PL_2 \\quad (\\Delta G_{\\text{bind}}(L_2)) $$\n\n因为吉布斯自由能$G$是一个状态函数，所以两个状态之间的自由能变化与所采取的路径无关。这一原理允许构建一个非物理的，或称“炼金术”的热力学循环来计算 $\\Delta\\Delta G_{\\text{bind}}$。该循环连接了四个相关状态：（$P+L_1$）、（$PL_1$）、（$P+L_2$）和（$PL_2$）。\n\n相对结合自由能的典型热力学循环如下：\n$$\n\\begin{array}{ccc}\nP + L_1  \\xrightarrow{\\Delta G_{\\text{bind}}(L_1)}  PL_1 \\\\\n\\downarrow{\\Delta G_{\\text{solv}}(L_1 \\to L_2)}     \\downarrow{\\Delta G_{\\text{prot}}(L_1 \\to L_2)} \\\\\nP + L_2  \\xrightarrow{\\Delta G_{\\text{bind}}(L_2)}  PL_2\n\\end{array}\n$$\n\n垂直路径代表配体 $L_1$ 到 $L_2$ 的炼金术变换。此变换在体相溶剂（水）中进行一次，得到 $\\Delta G_{\\text{solv}}(L_1 \\to L_2)$；在蛋白质结合位点中进行一次，得到 $\\Delta G_{\\text{prot}}(L_1 \\to L_2)$。\n\n对于一个闭合循环，净自由能变化为零：\n$$ \\Delta G_{\\text{bind}}(L_1) + \\Delta G_{\\text{prot}}(L_1 \\to L_2) - \\Delta G_{\\text{bind}}(L_2) - \\Delta G_{\\text{solv}}(L_1 \\to L_2) = 0 $$\n整理此方程得到炼金术相对结合自由能计算的基本关系式：\n$$ \\Delta\\Delta G_{\\text{bind}} = \\Delta G_{\\text{bind}}(L_2) - \\Delta G_{\\text{bind}}(L_1) = \\Delta G_{\\text{prot}}(L_1 \\to L_2) - \\Delta G_{\\text{solv}}(L_1 \\to L_2) $$\n任何正确实现此方程或替代的但同样有效的热力学路径的程序，都被认为是严格的。\n\n### 逐项分析选项\n\n**A. 在蛋白质结合位点中对苯进行到酚的单拓扑相对炼金术变换，以获得该过程的可逆功；并独立地在体相水中进行相同的变换。在两种环境中使用相同的约束方案（如有），以使约束的贡献相互抵消。相对结合自由能通过结合态和溶剂化态变换自由能之差获得。**\n\n此选项精确地描述了上述热力学循环的教科书式实现。蛋白质中“该过程的可逆功”是 $\\Delta G_{\\text{prot}}(L_1 \\to L_2)$，而在体相水中的功是 $\\Delta G_{\\text{solv}}(L_1 \\to L_2)$。取其差值 $\\Delta G_{\\text{prot}} - \\Delta G_{\\text{solv}}$，正确地得出了 $\\Delta\\Delta G_{\\text{bind}}$。提及一致的约束对于正确性至关重要，因为任何人工施加的约束势必须在两种环境中都应用，其贡献才能相互抵消。该程序在热力学上是严格的。\n\n**结论：正确**\n\n**B. 通过双解偶联方法分别计算苯和酚的绝对结合自由能：将每种配体与蛋白质环境和体相水进行炼金术解偶联，以获得每种配体的绝对标准结合自由能，包括所使用的任何约束相关的标准态校正。然后，相对结合自由能就是两种绝对结合自由能之差。**\n\n此选项提出了另一种同样有效的热力学路径。绝对结合自由能 $\\Delta G_{\\text{bind}}(L)$ 可以通过将配体与其环境解偶联来计算。这需要每种配体进行两组模拟：一组用于在蛋白质复合物中解偶联（$PL \\to P + L$），另一组用于在溶剂中解偶联（$L_{\\text{solv}} \\to L_{\\text{gas}}$），从中获得溶剂化自由能。计算 $\\Delta G_{\\text{bind}}(L)$ 的循环是严格的。通过对苯（$L_1$）和酚（$L_2$）执行这整个过程，分别获得 $\\Delta G_{\\text{bind}}(L_1)$ 和 $\\Delta G_{\\text{bind}}(L_2)$，然后可以通过简单的减法计算相对自由能：$\\Delta\\Delta G_{\\text{bind}} = \\Delta G_{\\text{bind}}(L_2) - \\Delta G_{\\text{bind}}(L_1)$。虽然这种路径通常比选项A中的相对循环效率低，且可能更容易出现抽样误差，但它在热力学上是合理且严格的。\n\n**结论：正确**\n\n**C. 仅执行蛋白质结合态下苯到酚的相对变换，并将其可逆功直接解释为相对结合自由能，因为两种配体都是中性的，溶剂化效应被隐式抵消了。**\n\n此选项声称 $\\Delta\\Delta G_{\\text{bind}} = \\Delta G_{\\text{prot}}(L_1 \\to L_2)$。这意味着严格方程中的另一项 $\\Delta G_{\\text{solv}}(L_1 \\to L_2)$ 为零。在水中将苯转化为酚涉及用一个羟基替换一个氢原子。羟基是高极性的，是有效的氢键供体和受体。苯是非极性的。因此，酚在水中的溶剂化自由能比苯的要有利得多（更负）。$\\Delta G_{\\text{solv}}(\\text{phenol}) \\ll \\Delta G_{\\text{solv}}(\\text{benzene})$，这使得 $\\Delta G_{\\text{solv}}(L_1 \\to L_2)$ 是一个大的非零值。两种配体都是中性的论点，与其差异溶剂化的大小无关。这种方法在热力学上是无效的。\n\n**结论：错误**\n\n**D. 在体相水中，将苯变换为酚盐以捕捉氢键差异，而在蛋白质结合位点中，将苯变换为中性酚。将两者的可逆功相减以获得相对结合自由能。**\n\n这种方法存在根本性缺陷，因为它破坏了闭合热力学循环的要求。要使循环有效，炼金术变换的初始态和最终态必须在两种环境（蛋白质和溶剂）中完全相同。在这里，蛋白质中的变换是苯 $\\to$ 酚，而水中的变换是苯 $\\to$ 酚盐。用这些路径构建的循环无法闭合，也无法关联到所需的结合自由能。此外，在pH $7$ 时，酚（pKa $\\approx 10$）几乎完全以其中性质子化形式存在，因此将其转化为酚盐与问题所述的条件在物理上不一致。\n\n**结论：错误**\n\n**E. 在蛋白质中，将苯完全解偶联，并在一个独立的模拟中，将酚从无到有地耦合到蛋白质环境中，然后取这两个可逆功的差值。不要在体相水中进行任何模拟，因为结合位点定义了相关的参考态。**\n\n此选项正确地描述了一种计算蛋白质中变换自由能差 $\\Delta G_{\\text{prot}}(L_1 \\to L_2)$ 的方法，即使用一个不相互作用的“虚拟”态作为中间体：$PL_1 \\to P + \\text{dummy} \\to PL_2$。然而，它随后犯了与选项C相同的致命错误：完全忽略了在体相溶剂中相应的变换 $\\Delta G_{\\text{solv}}(L_1 \\to L_2)$。结合自由能是相对于体相溶剂中的配体来定义的，而不是真空或某个其他任意的参考态。忽略计算中的溶剂路径使得结果在计算结合亲和力方面在热力学上毫无意义。\n\n**结论：错误**\n\n**F. 使用分子力学泊松-玻尔兹曼表面积（MM-PBSA）方法，对与蛋白质结合以及在水中的苯和酚的终点轨迹来估计相对结合自由能，并将该差异解释为炼金术相对结合自由能。**\n\n问题明确要求*热力学上严格的炼金术循环*。MM-PBSA是一种“端点”方法，而不是炼金术方法。它依赖于一些重要的近似，例如使用连续介质溶剂模型（泊松-玻尔兹曼）、用于非极性溶剂化的经验模型，并且通常完全忽略结合时的构象熵变。虽然它对于快速估算很有用，但它在与基于统计力学路径抽样（如FEP或TI）的方法相同的意义上不被认为是热力学严格的。它不属于所要求的方法类别。\n\n**结论：错误**", "answer": "$$\\boxed{AB}$$", "id": "2448825"}, {"introduction": "设计好热力学循环之后，下一步就是计算循环中每个炼金术转变（即每个“分支”）的自由能变化。这需要将统计力学的原理与具体的数值算法联系起来。本练习将带你从第一性原理走向可执行的代码。你将推导自由能微扰（FEP）方法中的基础Zwanzig方程，并实现一个数值稳定的算法来处理给定的模拟数据 [@problem_id:2448772]。这个动手实践揭示了如何将模拟中获得的系综平均值转化为宏观热力学量的奥秘，并强调了如数值精度等实际挑战。", "problem": "您正在使用炼金术转换来模拟蛋白质-配体复合物中单个活性位点残基的侧链突变为甘氨酸时结合自由能的变化。您的目标是通过执行以下逻辑来估算侧链对结合的能量贡献：在两种环境——蛋白质-配体复合物和不含配体的蛋白质（apo）——中进行炼金术突变，并通过一个热力学循环将所得的自由能变化组合起来。\n\n您的推导和算法应基于以下来自统计力学和计算化学且经过充分检验的原理：适用于恒温系统的正则系综、配分函数的定义、由配分函数定义的亥姆霍兹自由能，以及相对于参考态平衡分布的系综平均的解释。请仅使用这些原理作为起点；不要假设任何特定的自由能变化估计量或公式。请推导一个估计量，该估计量能从在参考态记录的瞬时势能差样本中得出两个炼金术状态之间的自由能差。然后，应用该估计量计算在每种环境中残基侧链突变为甘氨酸的摩尔自由能变化，最后计算这两个自由能变化的差值，以获得侧链的结合自由能贡献。\n\n单位和常数：\n- 所有能量必须视为摩尔量，单位为千焦耳每摩尔。用 $U$ 表示能量，单位为 $\\mathrm{kJ\\,mol^{-1}}$。\n- 温度必须以开尔文为单位。用 $T$ 表示温度，单位为 $\\mathrm{K}$。\n- 使用摩尔气体常数 $R$，单位为 $\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。\n- 定义 $\\beta = 1/(R T)$ 并确保任何推导出的表达式在量纲上都是一致的。\n- 所有最终结果以 $\\mathrm{kJ\\,mol^{-1}}$ 表示，并四舍五入到三位小数。\n\n热力学循环和目标量：\n- 令 $\\Delta G_{\\mathrm{complex}}$ 表示在蛋白质-配体复合物中从野生型到甘氨酸的炼金术突变的摩尔自由能变化。\n- 令 $\\Delta G_{\\mathrm{apo}}$ 表示在不含配体的蛋白质（apo）中相同突变的摩尔自由能变化。\n- 定义侧链对结合的贡献为 $\\Delta\\Delta G = \\Delta G_{\\mathrm{complex}} - \\Delta G_{\\mathrm{apo}}$。\n\n数据和测试套件：\n对于下面的每个测试用例，您将获得一个温度 $T$ 和两个瞬时势能差的有限样本，一个用于复合物，一个用于apo蛋白质。每个样本是一个从野生型状态的模拟中收集的值列表 $\\{\\Delta U_i\\}_{i=1}^n$（单位为 $\\mathrm{kJ\\,mol^{-1}}$），其中每个 $\\Delta U_i$ 是甘氨酸突变体哈密顿量和野生型哈密顿量之间的瞬时势能差，两者都在野生型系统的相同构象下进行评估。\n\n使用以下测试用例：\n- A用例（通用，中等方差），温度 $T=298.15\\,\\mathrm{K}$：\n  - 复合物：$(4.8, 5.2, 5.0, 6.1, 3.9, 5.5, 4.7, 5.3)\\,\\mathrm{kJ\\,mol^{-1}}$。\n  - Apo：$(-1.0, -2.2, -0.5, -1.8, -1.2, -2.0, -1.5, -0.9)\\,\\mathrm{kJ\\,mol^{-1}}$。\n- B用例（合理性检查，分布匹配），温度 $T=298.15\\,\\mathrm{K}$：\n  - 复合物：$(0.2, -0.1, 0.0, 0.1, -0.2)\\,\\mathrm{kJ\\,mol^{-1}}$。\n  - Apo：$(0.2, -0.1, 0.0, 0.1, -0.2)\\,\\mathrm{kJ\\,mol^{-1}}$。\n- C用例（重尾分布，数值稳定性），温度 $T=298.15\\,\\mathrm{K}$：\n  - 复合物：$(2.0, 3.5, 4.0, 2.5, 3.0, 15.0, 0.0, 6.0, 12.0, 1.5)\\,\\mathrm{kJ\\,mol^{-1}}$。\n  - Apo：$(1.0, 2.5, 3.0, 2.0, 2.2, 10.0, 0.5, 4.0, 1.8, 1.0)\\,\\mathrm{kJ\\,mol^{-1}}$。\n- D用例（边界情况，单一样本），温度 $T=298.15\\,\\mathrm{K}$：\n  - 复合物：$(0.0)\\,\\mathrm{kJ\\,mol^{-1}}$。\n  - Apo：$(0.0)\\,\\mathrm{kJ\\,mol^{-1}}$。\n- E用例（不同温度，符号变化），温度 $T=350.00\\,\\mathrm{K}$：\n  - 复合物：$(-2.5, -1.8, -2.2, -1.0)\\,\\mathrm{kJ\\,mol^{-1}}$。\n  - Apo：$(-0.2, 0.4, 0.1, 0.0)\\,\\mathrm{kJ\\,mol^{-1}}$。\n\n程序要求：\n- 从第一性原理推导一个估计量，用 $\\{\\Delta U_i\\}$ 和 $T$ 表示，用于计算每种环境中炼金术突变的摩尔自由能变化，然后如上定义，通过作差计算 $\\Delta\\Delta G$。\n- 实现一个数值稳定的算法，从提供的样本和温度中计算所需的自由能。使用摩尔气体常数值 $R=0.008314462618\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。\n- 对于五个用例中的每一个，计算单个标量 $\\Delta\\Delta G$（单位为 $\\mathrm{kJ\\,mol^{-1}}$），四舍五入到三位小数。\n- 您的程序应生成单行输出，其中包含 A 到 E 用例的结果，按顺序排列，形式为逗号分隔并用方括号括起来的列表，例如：“[x_A,x_B,x_C,x_D,x_E]”。每个 $x$ 必须是一个以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位的浮点数，四舍五入到三位小数，输出中不含单位或其他额外文本。", "solution": "所提出的问题是计算生物物理学中一个定义明确的标准任务，具体而言是使用炼金术自由能微扰方法计算相对结合自由能。该问题在科学上是合理的，基于统计力学的基本原理。它内部一致，为解决问题提供了所有必要的数据和常数。我发现其表述中没有任何缺陷。因此，我将进行严谨的推导和求解。\n\n目标是计算单个残基的侧链对配体结合自由能的贡献。这被表述为在两个不同环境——蛋白质-配体复合物和apo蛋白质——中将侧链突变为甘氨酸的炼金术自由能变化的差值。这通过热力学循环表示：\n$$ \\Delta\\Delta G = \\Delta G_{\\mathrm{complex}} - \\Delta G_{\\mathrm{apo}} $$\n\n我的任务是首先为单个炼金术转换的自由能变化 $\\Delta G$ 推导一个有效的估计量，然后将其应用于所提供的数据。\n\n**从第一性原理推导自由能估计量**\n\n我们从正则系综（恒定N, V, T）中摩尔亥姆霍兹自由能 $A$ 的基本定义开始。对于凝聚相系统，亥姆霍兹自由能变化 $\\Delta A$ 是吉布斯自由能变化 $\\Delta G$ 的一个非常好的近似，因为压强-体积项可以忽略不计。问题中使用了符号 $G$，这是惯例。\n\n摩尔自由能 $G$ 通过以下公式与正则配分函数 $Q$ 相关：\n$$ G = -RT \\ln Q $$\n其中 $R$ 是摩尔气体常数，$T$ 是温度。配分函数 $Q$ 是对系统所有微观状态的积分。在经典力学中，它分解为动能和势能（构象）部分。由于动能仅取决于动量和温度，在计算相同温度下两个状态之间的自由能差时，其贡献会相互抵消。因此，我们可以专注于构象配分函数 $Z$：\n$$ Z = \\int e^{-U(\\mathbf{r}) / (RT)} \\, d\\mathbf{r} $$\n其中 $U(\\mathbf{r})$ 是系统在给定构象 $\\mathbf{r}$ 下的势能，积分遍及所有构象空间。\n\n我们考虑两个状态之间的炼金术转换：状态 $0$（参考态，或野生型态）和状态 $1$（目标态，或突变体态）。这些状态由它们各自的势能函数 $U_0(\\mathbf{r})$ 和 $U_1(\\mathbf{r})$ 定义。它们的自由能是：\n$$ G_0 = -RT \\ln Z_0 = -RT \\ln \\int e^{-U_0(\\mathbf{r}) / (RT)} \\, d\\mathbf{r} $$\n$$ G_1 = -RT \\ln Z_1 = -RT \\ln \\int e^{-U_1(\\mathbf{r}) / (RT)} \\, d\\mathbf{r} $$\n\n自由能差 $\\Delta G = G_1 - G_0$ 是：\n$$ \\Delta G = -RT \\left( \\ln Z_1 - \\ln Z_0 \\right) = -RT \\ln\\left(\\frac{Z_1}{Z_0}\\right) $$\n为了使这个表达式可计算，我们处理配分函数的比率：\n$$ \\frac{Z_1}{Z_0} = \\frac{\\int e^{-U_1(\\mathbf{r}) / (RT)} \\, d\\mathbf{r}}{\\int e^{-U_0(\\mathbf{r}) / (RT)} \\, d\\mathbf{r}} $$\n我们在分子中的被积函数上同乘同除 $e^{-U_0(\\mathbf{r})/(RT)}$：\n$$ \\frac{Z_1}{Z_0} = \\frac{\\int e^{-(U_1(\\mathbf{r}) - U_0(\\mathbf{r})) / (RT)} e^{-U_0(\\mathbf{r}) / (RT)} \\, d\\mathbf{r}}{\\int e^{-U_0(\\mathbf{r}) / (RT)} \\, d\\mathbf{r}} $$\n令势能差为 $\\Delta U(\\mathbf{r}) = U_1(\\mathbf{r}) - U_0(\\mathbf{r})$。令 $\\beta = 1/(RT)$。表达式变为：\n$$ \\frac{Z_1}{Z_0} = \\frac{\\int e^{-\\beta \\Delta U(\\mathbf{r})} e^{-\\beta U_0(\\mathbf{r})} \\, d\\mathbf{r}}{Z_0} $$\n这正是物理量 $e^{-\\beta \\Delta U}$ 在参考系综（状态 $0$）上的系综平均的定义，记作 $\\langle \\dots \\rangle_0$。\n$$ \\frac{Z_1}{Z_0} = \\left\\langle e^{-\\beta \\Delta U} \\right\\rangle_0 $$\n将此代回 $\\Delta G$ 的表达式，得到 Zwanzig 方程，也称为自由能微扰（FEP）公式：\n$$ \\Delta G = -RT \\ln\\left\\langle e^{-\\Delta U / (RT)} \\right\\rangle_0 $$\n这是一个形式上精确的结果。问题提供了从参考态模拟中抽取的 $n$ 个构象的有限样本。系综平均 $\\langle \\dots \\rangle_0$ 随后通过对此样本的算术平均值进行估计：\n$$ \\left\\langle e^{-\\Delta U / (RT)} \\right\\rangle_0 \\approx \\frac{1}{n} \\sum_{i=1}^{n} e^{-\\Delta U_i / (RT)} $$\n其中 $\\{\\Delta U_i\\}$ 是所提供的瞬时势能差样本。因此，我们对 $\\Delta G$ 的最终估计量是：\n$$ \\Delta G_{est} = -RT \\ln\\left(\\frac{1}{n} \\sum_{i=1}^{n} e^{-\\Delta U_i / (RT)}\\right) $$\n\n**数值稳定的算法**\n\n直接计算指数和可能在数值上不稳定，如果参数是大的正数，则有上溢的风险；如果参数是大的负数，则有精度损失的风险。一种标准的稳定方法是 log-sum-exp 技巧。我们必须计算平均值的自然对数：$\\ln\\left(\\frac{1}{n} \\sum e^{a_i}\\right)$，其中 $a_i = -\\Delta U_i / (RT)$。这可以重写为：\n$$ \\ln\\left(\\frac{1}{n} \\sum e^{a_i}\\right) = \\ln\\left(\\sum e^{a_i}\\right) - \\ln(n) $$\n术语 $\\ln(\\sum e^{a_i})$ 可以通过以下方式稳定地计算：\n$$ \\ln\\left(\\sum_{i=1}^{n} e^{a_i}\\right) = a_{\\max} + \\ln\\left(\\sum_{i=1}^{n} e^{a_i - a_{\\max}}\\right) $$\n其中 $a_{\\max} = \\max_i(a_i)$。通过减去最大值，指数函数的参数保证小于或等于零，从而防止上溢。\n\n因此，用于计算 $\\Delta G$ 的完整、数值稳定的算法如下：\n1.  对于给定的样本 $\\{\\Delta U_i\\}$ 和温度 $T$，计算参数向量 $\\mathbf{a} = \\{a_i\\}$，其中 $a_i = -\\Delta U_i / (RT)$。\n2.  计算 $\\mathbf{a}$ 的 log-sum-exp，例如使用 `scipy.special.logsumexp`。\n3.  计算自由能 $\\Delta G = -RT \\left( \\mathrm{logsumexp}(\\mathbf{a}) - \\ln(n) \\right)$。\n\n对每个测试用例应用此过程来计算 $\\Delta G_{\\mathrm{complex}}$ 和 $\\Delta G_{\\mathrm{apo}}$。最终结果通过 $\\Delta\\Delta G = \\Delta G_{\\mathrm{complex}} - \\Delta G_{\\mathrm{apo}}$ 获得，然后四舍五入到三位小数。", "answer": "```python\nimport numpy as np\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Derives and applies a numerically stable estimator for alchemical free energy calculations\n    to compute the change in binding free energy upon a sidechain mutation. This function\n    will calculate the results for all test cases and print the final output string.\n    \"\"\"\n\n    # Define the molar gas constant in specified units.\n    # R has units of kJ mol^-1 K^-1\n    R = 0.008314462618\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Temperature in K, Complex dU sample, Apo dU sample)\n    test_cases = [\n        (298.15, [4.8, 5.2, 5.0, 6.1, 3.9, 5.5, 4.7, 5.3], [-1.0, -2.2, -0.5, -1.8, -1.2, -2.0, -1.5, -0.9]),\n        (298.15, [0.2, -0.1, 0.0, 0.1, -0.2], [0.2, -0.1, 0.0, 0.1, -0.2]),\n        (298.15, [2.0, 3.5, 4.0, 2.5, 3.0, 15.0, 0.0, 6.0, 12.0, 1.5], [1.0, 2.5, 3.0, 2.0, 2.2, 10.0, 0.5, 4.0, 1.8, 1.0]),\n        (298.15, [0.0], [0.0]),\n        (350.00, [-2.5, -1.8, -2.2, -1.0], [-0.2, 0.4, 0.1, 0.0])\n    ]\n\n    def calculate_delta_g(T, delta_u_samples, R_const):\n        \"\"\"\n        Calculates the free energy change (Delta G) from a sample of potential energy\n        differences using the Zwanzig formula with a numerically stable implementation.\n\n        Args:\n            T (float): Temperature in Kelvin.\n            delta_u_samples (list or np.ndarray): A sample of instantaneous potential\n                                                  energy differences (kJ/mol).\n            R_const (float): The molar gas constant in kJ/(mol*K).\n\n        Returns:\n            float: The estimated free energy change Delta G in kJ/mol.\n        \"\"\"\n        delta_u_samples = np.array(delta_u_samples, dtype=np.float64)\n        n = len(delta_u_samples)\n        \n        if n == 0:\n            return np.nan\n\n        beta = 1.0 / (R_const * T)\n        \n        args = -beta * delta_u_samples\n        \n        log_sum_exp_val = logsumexp(args)\n        \n        log_avg_exp = log_sum_exp_val - np.log(n)\n        delta_g = -log_avg_exp / beta\n        return delta_g\n\n    results = []\n    for T, complex_du, apo_du in test_cases:\n        delta_g_complex = calculate_delta_g(T, complex_du, R)\n        delta_g_apo = calculate_delta_g(T, apo_du, R)\n        delta_delta_g = delta_g_complex - delta_g_apo\n        results.append(f\"{delta_delta_g:.3f}\")\n\n    # The problem asks the user's program to generate a single-line output.\n    # We print it here to show the result of running the code.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the main function to produce the result when the script is run.\nif __name__ == '__main__':\n    solve()\n```", "id": "2448772"}, {"introduction": "在计算研究的实际应用中，模拟过程是有限的，并且会受到各种误差来源的影响。因此，对任何从业者来说，一项至关重要的技能是能够批判性地评估计算结果并诊断潜在问题。本练习展示了一个有问题的自由能计算的典型症状：滞后现象，即正向和反向的炼金术转变结果不一致。通过分析一个假设但符合实际的场景，你将学会识别导致这种偏差的最常见原因，例如采样不足和相空间重叠度差 [@problem_id:2455783]。这项实践能磨练你的诊断能力，使你能够识别计算何时失败并理解其背后的原因。", "problem": "一名研究人员对状态 $A$ 和 $B$ 之间的炼金术转换进行了两次独立的单向自由能微扰（FEP）计算。报告值为 $\\Delta G_{A \\to B} = 10~\\text{kcal}\\,\\text{mol}^{-1}$ 和 $\\Delta G_{B \\to A} = -12~\\text{kcal}\\,\\text{mol}^{-1}$。在严格的平衡统计力学中，吉布斯自由能差是一个状态函数。以下哪项是导致正向和反向估算值之间出现差异的最可能原因？选择所有适用选项。\n\nA. 采样不足以及相邻炼金术状态之间（特别是在中间 $\\lambda$ 值处）的相空间重叠性差，导致单向 FEP 估算出现偏差。\n\nB. 使用过少中间耦合参数（$\\lambda$）窗口，并且忽略了范德华相互作用的软核势，这可能导致端点奇点和磁滞现象。\n\nC. 在分子模拟中，吉布斯自由能不是一个状态函数，因此 $\\Delta G_{A \\to B}$ 和 $-\\Delta G_{B \\to A}$ 无需一致。\n\nD. 在两个方向上应用了不一致的长程静电或净电荷校正方案（例如，不同的截断设置或在一个方向上省略了有限尺寸电荷校正）。\n\nE. 使用如 Bennett 接受率（BAR）或多态 Bennett 接受率（MBAR）等双向估计器，这会放大方向间的差异并增加磁滞现象。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 进行了两次独立的单向自由能微扰（FEP）计算。\n- 转换在状态 $A$ 和状态 $B$ 之间进行。\n- 正向自由能变化报告为 $\\Delta G_{A \\to B} = 10~\\text{kcal}\\,\\text{mol}^{-1}$。\n- 反向自由能变化报告为 $\\Delta G_{B \\to A} = -12~\\text{kcal}\\,\\text{mol}^{-1}$。\n- 一个既定原理：在严格的平衡统计力学中，吉布斯自由能是一个状态函数。\n- 问题要求找出观察到的差异的最可能来源。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固地植根于统计力学和计算化学的原理。FEP 的使用、状态函数的概念以及磁滞现象（$\\Delta G_{A \\to B} \\neq -\\Delta G_{B \\to A}$）的出现都是该领域的标准课题。\n- **问题的适定性：** 这是一个适定问题。它提出了分子模拟中一个常见的数值伪影，并探究其物理和方法论上的根源。存在一组明确的解释。\n- **客观性：** 该问题是基于客观、定量的数据和公认的科学概念来陈述的。\n\n**步骤3：结论和行动**\n问题陈述在科学上是合理的、适定的和客观的。它不包含任何使其无效的缺陷。我将继续提供完整的解答。\n\n***\n\n基本原理是吉布斯自由能 $G$ 是一个状态函数。这意味着对于两个状态 $A$ 和 $B$ 之间的任何可逆路径，自由能差必须满足关系 $\\Delta G_{A \\to B} = G_B - G_A = -(G_A - G_B) = -\\Delta G_{B \\to A}$。该问题提供了来自计算实验的数值估计：$\\Delta G_{A \\to B} = 10~\\text{kcal}\\,\\text{mol}^{-1}$ 和 $\\Delta G_{B \\to A} = -12~\\text{kcal}\\,\\text{mol}^{-1}$。从反向计算中，我们可以推断出正向变化应为 $-\\Delta G_{B \\to A} = -(-12~\\text{kcal}\\,\\text{mol}^{-1}) = 12~\\text{kcal}\\,\\text{mol}^{-1}$。\n\n在正向和反向估计值之间存在 $12 - 10 = 2~\\text{kcal}\\,\\text{mol}^{-1}$ 的差异。这种现象被称为磁滞，是非平衡效应或模拟与计算方案中系统误差的标志。我们必须评估各个选项作为此误差的潜在来源。\n\n单向 FEP 计算基于 Zwanzig 恒等式：\n$$ \\Delta G_{A \\to B} = -k_B T \\ln \\left\\langle \\exp\\left(-\\frac{U_B - U_A}{k_B T}\\right) \\right\\rangle_A $$\n其中系综平均 $\\langle \\dots \\rangle_A$ 是在状态 $A$ 的模拟中计算的。该恒等式仅在无限采样时才精确。在有限模拟中，其准确性关键取决于状态 $A$ 和 $B$ 之间的相空间重叠程度。如果状态 $B$ 的重要（低能）构象在状态 $A$ 的系综中非常罕见，模拟将无法充分采样它们，从而导致有偏估计和高方差。指数平均由少数样本主导，这是一个众所周知的数值难题。为了缓解这个问题，总的转换通常被分解为由耦合参数 $\\lambda$ 定义的一系列中间状态，即 $A = \\lambda_0 \\to \\lambda_1 \\to \\dots \\to \\lambda_N = B$。总自由能则为 $\\Delta G = \\sum_{i=0}^{N-1} \\Delta G_{\\lambda_i \\to \\lambda_{i+1}}$。\n\n**A. 采样不足以及相邻炼金术状态之间（特别是在中间 $\\lambda$ 值处）的相空间重叠性差，导致单向 FEP 估算出现偏差。**\n由 Zwanzig 公式给出的单向 FEP 估计器是已知的有偏估计器，尤其是在采样不足时。“相空间重叠性差”意味着在 $\\lambda_i$ 处采样的系综没有充分代表 $\\lambda_{i+1}$ 处系综的重要构象。这导致指数平均无法系统性地收敛，从而得到不准确的 $\\Delta G_{\\lambda_i \\to \\lambda_{i+1}}$。当对所有窗口求和时，这些误差会累积。这种采样不足是 FEP 计算中出现磁滞现象的主要和最根本的原因。正向和反向路径没有以相同的统计权重对相空间的相同部分进行采样，从而导致了观察到的差异。\n**结论：正确。**\n\n**B. 使用过少中间耦合参数（$\\lambda$）窗口，并且忽略了范德华相互作用的软核势，这可能导致端点奇点和磁滞现象。**\n这个选项详细说明了直接导致选项 A 中描述的一般性问题的具体技术错误。\n1.  **过少的 $\\lambda$ 窗口：** 如果中间状态之间的步长太大，哈密顿量的变化会过于突然，这必然导致相邻窗口之间的相空间重叠性差。这直接导致了采样问题和磁滞现象。\n2.  **忽略软核势：** 当一个原子被炼金术式地“创造”或“湮灭”时，其 Lennard-Jones（范德华）势能项可能会在粒子从一个点出现或消失到一个点时引起奇点。这会导致在端点处（$\\lambda \\approx 0$ 或 $\\lambda \\approx 1$）出现无限大的势能和力，使模拟不稳定，无法对能量差进行采样。软核势通过修改相互作用势来防止这种发散。在此类转换中不使用软核势是一个严重错误，会引入大的、不受控制的伪影和显著的磁滞现象。\n这两点都是导致报告中差异的有效且常见的原因。\n**结论：正确。**\n\n**C. 在分子模拟中，吉布斯自由能不是一个状态函数，因此 $\\Delta G_{A \\to B}$ 和 $-\\Delta G_{B \\to A}$ 无需一致。**\n这个说法根本上是错误的。整个分子模拟应用于热力学的框架都建立在统计力学原理之上，其中吉布斯自由能公理上是一个状态函数。数值估计未能满足 $\\Delta G_{A \\to B} = -\\Delta G_{B \\to A}$ 并不是物理原理的失败，而是计算方法未能达到使该原理成立的条件（例如，平衡、充分采样）。这个说法将数值伪影与所谓违反热力学基本定律混为一谈。\n**结论：不正确。**\n\n**D. 在两个方向上应用了不一致的长程静电或净电荷校正方案（例如，不同的截断设置或在一个方向上省略了有限尺寸电荷校正）。**\n为了正确检验 $\\Delta G_{A \\to B} = -\\Delta G_{B \\to A}$ 这一恒等式，物理系统及其哈密顿量在正向（$A \\to B$）和反向（$B \\to A$）计算中必须被完全相同地定义。如果使用了不同的方法来处理长程静电（例如，一个方向用 Particle Mesh Ewald，另一个方向用简单的截断）或力场的其他方面，那么正向计算中的状态 $A$ 和 $B$ 就与反向计算中的状态 $A$ 和 $B$ 不同了。这样计算的将是 $\\Delta G_{A \\to B}$ 和 $-\\Delta G_{B' \\to A'}$，其中带撇的状态是由不同的哈密顿量定义的。这种模拟方案上的不一致是系统误差的一个明显来源，肯定会导致差异。这是一个可能的操作性错误。\n**结论：正确。**\n\n**E. 使用如 Bennett 接受率（BAR）或多态 Bennett 接受率（MBAR）等双向估计器，这会放大方向间的差异并增加磁滞现象。**\n这个说法与事实完全相反。像 BAR 及其多态推广 MBAR 这样的双向估计器是专门设计用来通过优化组合正向和反向模拟的数据来*减少*或*消除*磁滞现象的。它们在给定收集的数据下，提供自由能差的最小方差估计，从而为 $\\Delta G_{A \\to B}$ 得出一个单一、一致的值。众所周知，它们在统计上比单向 FEP 更加稳健和高效，特别是在相空间重叠性差的情况下。因此，使用 BAR 或 MBAR 会缓解问题，而不是放大问题。\n**结论：不正确。**", "answer": "$$\\boxed{ABD}$$", "id": "2455783"}]}