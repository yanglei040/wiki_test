{"hands_on_practices": [{"introduction": "自由能计算的威力源于自由能是一个态函数，这使得我们可以通过设计巧妙的“热力学循环”，将难以直接计算的物理过程替换为一系列易于模拟的步骤。本练习旨在挑战你批判性地评估这些循环，因为一个微小的状态定义错误就可能让整个计算失效。通过识别和理解其中的缺陷[@problem_id:2391895]，你将巩固对路径无关基本原理以及如何正确定义热力学状态的理解。", "problem": "您被要求评估计算两种小溶质（标记为 $A$ 和 $B$）之间相对溶剂化自由能的方案，这两种溶质可以被认为是与蛋白质建模相关的侧链类似物。目标量是 $B$ 和 $A$ 之间的溶剂化自由能之差，有人提出了基于炼金术转化的热力学循环，以利用自由能的路径无关性。假设系统处于平衡态，遵循经典统计力学，并具有明确定义的热力学状态。一个热力学状态由溶质的分子特性和质子化状态、溶剂的组成以及诸如温度 $T$、压力 $P$ 和粒子数 $N$ 等热力学变量指定，并对系综使用适当的自由能势。\n\n哪个选项提出了一个有缺陷的计算相对溶剂化自由能的热力学循环，并正确解释了它为什么违反路径无关性？\n\nA. 在溶剂分支中，在液态水中，使用恒定粒子数、压力、温度 ($NPT$) 系综，在固定的 $T$ 和 $P$ 下，执行从 $A$ 到 $B$ 的炼金术转化，并保持溶质的净电荷不变。在真空分支中，在真空中，使用恒定粒子数、体积、温度 ($NVT$) 系综，在相同的 $T$ 下，执行从 $A$ 到 $B$ 的相同炼金术转化，并保持溶质的净电荷不变。两个分支使用相同的标准态，且没有额外的约束。该循环尊重路径无关性，因为其四个角是 $A$ 和 $B$ 在溶剂中和真空中的相同热力学状态。\n\nB. 在溶剂分支中，在液态水中，在固定的 $T$ 和 $P$ 下，将 $A^{+1}$ 炼金术转化为 $B^{0}$。在真空分支中，在真空中，在相同的 $T$ 下，将 $A^{+1}$ 炼金术转化为 $B^{+1}$。该循环存在缺陷且违反了路径无关性，因为对应于 $B$ 的两个角不代表相同的热力学状态（在溶剂和真空中有不同的净电荷），因此状态空间中的环路不闭合。\n\nC. 在溶剂分支中，在水中，在温度 $T_{1}$ 下，使用 $NPT$ 系综将 $A$ 炼金术转化为 $B$。在真空分支中，在真空中，在温度 $T_{2}$ 下，使用 $NVT$ 系综将 $A$ 炼金术转化为 $B$，其中 $T_{1} \\neq T_{2}$。该循环仍然尊重路径无关性，因为自由能是状态函数，因此只要初始和最终物种是 $A$ 和 $B$，自由能就与分支中使用的热力学变量无关。\n\nD. 在溶剂分支和真空分支中，在相同的 $T$ 下将 $A$ 炼金术转化为 $B$，溶剂使用 $NPT$ 系综，真空使用 $NVT$ 系综，同时保持溶质的净电荷并使用一致的标准态。炼金术耦合参数 $\\lambda$ 在溶剂分支中从 $0$ 到 $1$ 进行非线性映射，但在真空分支中是线性映射。该循环存在缺陷且违反了路径无关性，因为不同的 $\\lambda$ 方案会改变相同终态之间的自由能差。", "solution": "从第一性原理出发。Helmholtz 自由能 $F(T,V,N)$ 和 Gibbs 自由能 $G(T,P,N)$ 是状态函数，其值仅取决于热力学状态变量和系统的哈密顿量（包括组成、质子化状态、净电荷和任何施加的约束）。对于一个由明确定义的状态组成的闭合热力学循环，环路上的自由能变化之和必须为零：\n$$\n\\oint dX = 0,\n$$\n其中 $X$ 是所用系综的适当自由能势，前提是循环的各个角代表相同的热力学状态。路径无关性意味着两个指定状态之间的自由能差与所取路径无关，但前提是该路径连接相同的初始和最终状态，并且对由相同变量定义的状态一致地使用相同的热力学势。\n\n对于相对溶剂化，一个有效的循环将溶剂中 $A \\to B$ 的炼金术转化与真空中相同的转化联系起来。如果四个角是真空中的 $A$、溶剂中的 $A$、真空中的 $B$ 和溶剂中的 $B$，并且它们在相同的 $T$ 下定义，具有一致的标准态和组成，那么环路闭合，该循环就能得出所需的溶剂化自由能之差。\n\n评估每个选项：\n\nA. 溶剂分支在固定的 $T$ 和 $P$ 下，在水中将 $A \\to B$ 进行转化，并保持净电荷守恒；真空分支在相同的 $T$ 下，在真空中将 $A \\to B$ 进行转化，并保持净电荷守恒。标准态和约束是一致的。四个角是相同的四个热力学状态：溶剂中的 $A$、真空中的 $A$、溶剂中的 $B$、真空中的 $B$。尽管溶剂 ($NPT$) 和真空 ($NVT$) 使用了不同的系综，但这是标准且一致的，因为溶剂状态通过 $G(T,P,N)$ 进行比较，而真空状态通过 $F(T,V,N)$ 进行比较，并且当对每个相使用适当的相同热力学条件时，两个炼金术分支的差值对应于相对溶剂化自由能。没有违反路径无关性；循环是闭合的。结论 — 对于问题来说不正确，因为它不是一个有缺陷的循环，也没有违反路径无关性。\n\nB. 溶剂分支是在固定的 $T$ 和 $P$ 下的 $A^{+1} \\to B^{0}$，而真空分支是在相同 $T$ 下的 $A^{+1} \\to B^{+1}$。标记为 $B$ 的两个角不同：一个是溶剂中的 $B^{0}$，另一个是真空中的 $B^{+1}$。这不是相同的化学状态（净电荷不同），所以这个所谓的“循环”并未在状态空间中遍历一个闭合环路。形式上，环路和为\n$$\n\\Delta G^{\\mathrm{solv}}_{A^{+1} \\to B^{0}} - \\Delta F^{\\mathrm{vac}}_{A^{+1} \\to B^{+1}}\n= \\left(\\Delta G^{\\mathrm{solv}}_{A^{+1} \\to B^{+1}} + \\Delta G^{\\mathrm{solv}}_{B^{+1} \\to B^{0}}\\right) - \\Delta F^{\\mathrm{vac}}_{A^{+1} \\to B^{+1}},\n$$\n它与所期望的\n$$\n\\Delta G^{\\mathrm{solv}}_{A^{+1} \\to B^{+1}} - \\Delta F^{\\mathrm{vac}}_{A^{+1} \\to B^{+1}}\n$$\n相差一个额外的充电或中和项 $\\Delta G^{\\mathrm{solv}}_{B^{+1} \\to B^{0}}$。因为一个额外的转化实际上只包含在一个分支中，所以环路不能满足 $\\oint dX = 0$。因此，该构造违反了路径无关性的条件。结论 — 正确，因为它描述了一个有缺陷的循环，并正确解释了由于状态不一致（净电荷不同）导致环路不闭合，从而使路径无关性失效。\n\nC. 溶剂分支在 $T_{1}$ 下运行，真空分支在 $T_{2}$ 下运行，且 $T_{1} \\neq T_{2}$。该选项声称这是可接受的，因为自由能是状态函数，与热力学变量无关。这一说法是错误的。自由能确实是状态函数，但它们参数化地依赖于热力学变量；改变 $T$ 会改变热力学状态。在不同的 $T$ 值下，“溶剂中的 $A$”和“溶剂中的 $B$”这两个角处于 $T_{1}$，而真空中的角处于 $T_{2}$，因此该循环没有在不同分支之间连接相同的热力学状态，并且不闭合。此外，在没有进行适当的热力学转换的情况下，将 $G(T_{1},P,N)$ 与 $F(T_{2},V,N)$ 混合使用是不一致的。结论 — 对于问题来说不正确：虽然循环有缺陷，但其解释断言了有效性，因此它没有正确解释为何违反。\n\nD. 两个分支都在相同的 $T$ 下将 $A$ 转化为 $B$，保持净电荷并使用一致的标准态；溶剂使用 $NPT$ 系综，真空使用 $NVT$ 系综。唯一的区别是炼金术参数 $\\lambda$ 的方案（非线性与线性）。两个明确定义的终态之间的自由能差与 $\\lambda$ 中的路径参数化无关，前提是实现了平衡采样并且哈密顿量连接的是相同的端点。非线性与线性的 $\\lambda$ 方案不改变状态函数的差值；它只影响数值效率和收敛性，而不影响在充分采样极限下的精确值。因此，没有违反路径无关性。结论 — 对于问题来说不正确，因为该循环并不像声称的那样有缺陷，并且给出的理由是错误的。\n\n因此，只有选项 B 既提出了一个有缺陷的热力学循环，又正确地解释了它为何违反路径无关性：由于只有一个分支中发生了净电荷变化，导致各个角的状态不一致，因此状态空间中的循环不闭合，环路和不能为零。", "answer": "$$\\boxed{B}$$", "id": "2391895"}, {"introduction": "在设计了有效的热力学循环之后，我们需要为循环的每一个步骤建立具体的物理模型。本练习将指导你构建一个基础但核心的水合自由能模型，这是理解分子识别和蛋白质折叠等过程的关键。你将亲手实现经典的Born模型来处理静电相互作用，并结合一个与表面积相关的非极性项，从而深入了解如何用简洁的物理模型来近似复杂的溶剂效应[@problem_id:2455813]。", "problem": "要求您使用一个基于物理的连续介质溶剂模型，计算单个氨基酸侧链从 Alanine 突变为 Valine 时的水合自由能变化。您的程序必须实现以下建模假设，这些假设需从统计力学和经典静电学的基础定义中推导得出：\n\n- 水合自由能是将溶质从真空转移到连续介质溶剂中的可逆功。突变引起的变化定义为 Valine 侧链的水合自由能减去 Alanine 侧链的水合自由能。您必须假设其可加性分解为一个极性静电项和一个基于溶剂可及表面积 (Solvent Accessible Surface Area (SASA)) 的非极性项。\n\n- 对于极性项，使用经典充电理论，考虑一个净电荷为 $q$、半径为 $R$ 的单一球形位点嵌入在相对介电常数为 $\\varepsilon_s$ 的介电连续体中。可逆充电功必须与 Born 模型一致，您应在推理中推导出该模型，然后进行实现。使用库仑转换常数 $k_e = 332.06371$，单位为 $\\mathrm{kcal \\cdot \\AA/(mol \\cdot e^2)}$，元电荷 $e$ 和埃（Ångström）$\\AA$。溶剂介电常数 $\\varepsilon_s$ 是无量纲的。\n\n- 对于非极性项，将空腔形成和色散的自由能近似为与 SASA 成正比：$G_{\\mathrm{np}} = \\gamma A + \\beta$，其中对于单一球形位点 $A = 4 \\pi R^2$，$\\gamma$ 是一个单位为 $\\mathrm{kcal/(mol \\cdot \\AA^2)}$ 的常数，$\\beta$ 是一个单位为 $\\mathrm{kcal/mol}$ 的偏移量。对于两个状态间 $\\beta$ 不变的突变，偏移量 $\\beta$ 会被抵消。\n\n给定一组定义了 Alanine 和 Valine 的溶剂和侧链球体参数，计算水合自由能变化\n$$\n\\Delta \\Delta G_{\\mathrm{hyd}} = \\left[G_{\\mathrm{polar}}^{\\mathrm{Val}} + G_{\\mathrm{np}}^{\\mathrm{Val}}\\right] - \\left[G_{\\mathrm{polar}}^{\\mathrm{Ala}} + G_{\\mathrm{np}}^{\\mathrm{Ala}}\\right]\n$$\n单位为 $\\mathrm{kcal/mol}$。\n\n您的程序必须从上述第一性原理出发实现该模型，并为以下测试套件生成数值结果。每个案例都指定了溶剂介电常数 $\\varepsilon_s$、非极性系数 $\\gamma$、非极性偏移量 $\\beta$，以及 Alanine 和 Valine 的球形位点参数：电荷 $q$（单位为 $e$）和半径 $R$（单位为 $\\AA$）。每个案例中的所有量都必须按照明确说明的单位进行解释。\n\n- 案例 $1$（正常路径，类水溶剂，中性基团）：$\\varepsilon_s = 78.37$, $\\gamma = 0.005$, $\\beta = 0.0$, Alanine: $q_{\\mathrm{Ala}} = 0.0$, $R_{\\mathrm{Ala}} = 2.0$; Valine: $q_{\\mathrm{Val}} = 0.0$, $R_{\\mathrm{Val}} = 2.5$。\n- 案例 $2$（边界情况，无突变）：$\\varepsilon_s = 78.37$, $\\gamma = 0.005$, $\\beta = 0.0$, Alanine: $q_{\\mathrm{Ala}} = 0.0$, $R_{\\mathrm{Ala}} = 2.0$; Valine: $q_{\\mathrm{Val}} = 0.0$, $R_{\\mathrm{Val}} = 2.0$。\n- 案例 $3$（非极性项中的参数敏感性）：$\\varepsilon_s = 78.37$, $\\gamma = 0.0072$, $\\beta = 0.0$, Alanine: $q_{\\mathrm{Ala}} = 0.0$, $R_{\\mathrm{Ala}} = 2.0$; Valine: $q_{\\mathrm{Val}} = 0.0$, $R_{\\mathrm{Val}} = 2.5$。\n- 案例 $4$（不同溶剂介电常数，中性基团）：$\\varepsilon_s = 32.60$, $\\gamma = 0.005$, $\\beta = 0.0$, Alanine: $q_{\\mathrm{Ala}} = 0.0$, $R_{\\mathrm{Ala}} = 2.0$; Valine: $q_{\\mathrm{Val}} = 0.0$, $R_{\\mathrm{Val}} = 2.5$。\n\n对您程序的要求：\n- 使用上述物理常数和定义，推导并实现与介电连续体中充电功一致的极性贡献。\n- 使用 $A = 4 \\pi R^2$ 计算球体的 SASA，并计算非极性能 $G_{\\mathrm{np}} = \\gamma A + \\beta$。\n- 计算每个案例的 $\\Delta \\Delta G_{\\mathrm{hyd}}$（单位为 $\\mathrm{kcal/mol}$），并将每个结果精确到小数点后 $6$ 位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4]$，其中每个 $x_i$ 是案例 $i$ 的浮点数结果，四舍五入到小数点后 $6$ 位。\n\n所有最终数值答案均以 $\\mathrm{kcal/mol}$ 表示。不涉及角度。本问题不出现百分比。", "solution": "该问题是有效的，因为它在科学上基于经典静电学和统计力学的原理，给出了所有必需的参数，定义明确，并且以客观、正式的语言表述。我们现在将着手解决。\n\n目标是计算 Alanine ($\\mathrm{Ala}$) 侧链突变为 Valine ($\\mathrm{Val}$) 侧链的水合自由能变化 $\\Delta \\Delta G_{\\mathrm{hyd}}$。总水合自由能 $\\Delta G_{\\mathrm{hyd}}$ 定义为将溶质从真空转移到溶剂中的可逆功。突变的变化由下式给出：\n$$ \\Delta \\Delta G_{\\mathrm{hyd}} = \\Delta G_{\\mathrm{hyd}}(\\mathrm{Val}) - \\Delta G_{\\mathrm{hyd}}(\\mathrm{Ala}) $$\n指定的模型将水合自由能分解为静电极性项 $G_{\\mathrm{polar}}$ 和与表面积相关的非极性项 $G_{\\mathrm{np}}$。因此，对于给定的物种 $i$（$\\mathrm{Ala}$ 或 $\\mathrm{Val}$）：\n$$ \\Delta G_{\\mathrm{hyd}}^{i} = G_{\\mathrm{polar}}^{i} + G_{\\mathrm{np}}^{i} $$\n突变的总变化为：\n$$ \\Delta \\Delta G_{\\mathrm{hyd}} = (G_{\\mathrm{polar}}^{\\mathrm{Val}} + G_{\\mathrm{np}}^{\\mathrm{Val}}) - (G_{\\mathrm{polar}}^{\\mathrm{Ala}} + G_{\\mathrm{np}}^{\\mathrm{Ala}}) = (G_{\\mathrm{polar}}^{\\mathrm{Val}} - G_{\\mathrm{polar}}^{\\mathrm{Ala}}) + (G_{\\mathrm{np}}^{\\mathrm{Val}} - G_{\\mathrm{np}}^{\\mathrm{Ala}}) $$\n\n我们将根据规定的基本原理推导每一项。\n\n首先，我们使用 Born 模型处理极性贡献 $G_{\\mathrm{polar}}$。该项代表将一个带电球体从真空（相对介电常数 $\\varepsilon_{vac} = 1$）转移到相对介电常数为 $\\varepsilon_s$ 的溶剂中的静电功。这个功等于离子静电自能的变化。半径为 $R$ 的导电球体的自能是将其从净电荷 $0$ 充电到最终电荷 $Q$ 所需的功。\n\n在介电常数均匀为 $\\varepsilon$ 的介质中，半径为 $R$、携带电荷为 $q'$ 的球体表面的静电势 $\\phi$ 为 $\\phi(q') = k_c \\frac{q'}{\\varepsilon R}$，其中 $k_c = (4\\pi\\varepsilon_0)^{-1}$ 是国际单位制中的库仑常数。将一个额外的无穷小电荷 $dq'$ 带到球体表面所需的增量功 $dW$ 为 $dW = \\phi(q') dq'$。\n总自能 $W_{self}$ 是将球体从 $0$ 充电到 $Q$ 时此功的积分：\n$$ W_{self} = \\int_0^Q \\phi(q') dq' = \\int_0^Q k_c \\frac{q'}{\\varepsilon R} dq' = \\frac{k_c Q^2}{2\\varepsilon R} $$\n问题提供了一个预先分解的库仑转换常数 $k_e$，单位为 $\\mathrm{kcal \\cdot \\AA/(mol \\cdot e^2)}$。该常数设计用于电荷 $q$ 以纯数字（单位为元电荷 $e$）表示、半径 $R$ 以埃（$\\AA$）表示的情况，以产生单位为 $\\mathrm{kcal/mol}$ 的能量。在这些单位中，自能的公式变为：\n$$ W_{self} = \\frac{k_e q^2}{2\\varepsilon R} $$\n水合自由能的极性贡献 $G_{\\mathrm{polar}}$ 是在溶剂（$\\varepsilon = \\varepsilon_s$）中和在真空（$\\varepsilon = 1$）中自能的差值：\n$$ G_{\\mathrm{polar}} = W_{self}(\\text{solvent}) - W_{self}(\\text{vacuum}) = \\frac{k_e q^2}{2\\varepsilon_s R} - \\frac{k_e q^2}{2R} $$\n提取公因式，我们得到 Born 方程：\n$$ G_{\\mathrm{polar}} = \\frac{k_e q^2}{2R} \\left(\\frac{1}{\\varepsilon_s} - 1\\right) $$\n\n其次，我们构建非极性贡献 $G_{\\mathrm{np}}$。问题陈述此项是溶剂可及表面积 (SASA) $A$ 的线性函数：\n$$ G_{\\mathrm{np}} = \\gamma A + \\beta $$\n这里，$\\gamma$ 是表面张力系数，单位为 $\\mathrm{kcal/(mol \\cdot \\AA^2)}$，$\\beta$ 是一个常数偏移量，单位为 $\\mathrm{kcal/mol}$。侧链被建模为半径为 $R$ 的球体。球体的表面积为：\n$$ A = 4\\pi R^2 $$\n将其代入 $G_{\\mathrm{np}}$ 的表达式中，得到：\n$$ G_{\\mathrm{np}} = \\gamma (4\\pi R^2) + \\beta $$\n\n现在，我们结合这些部分来计算突变的总体自由能变化 $\\Delta \\Delta G_{\\mathrm{hyd}}$。\n极性项的变化是：\n$$ \\Delta G_{\\mathrm{polar}} = G_{\\mathrm{polar}}^{\\mathrm{Val}} - G_{\\mathrm{polar}}^{\\mathrm{Ala}} = \\frac{k_e}{2} \\left(\\frac{1}{\\varepsilon_s} - 1\\right) \\left( \\frac{q_{\\mathrm{Val}}^2}{R_{\\mathrm{Val}}} - \\frac{q_{\\mathrm{Ala}}^2}{R_{\\mathrm{Ala}}} \\right) $$\n非极性项的变化是：\n$$ \\Delta G_{\\mathrm{np}} = G_{\\mathrm{np}}^{\\mathrm{Val}} - G_{\\mathrm{np}}^{\\mathrm{Ala}} = \\left(\\gamma (4\\pi R_{\\mathrm{Val}}^2) + \\beta\\right) - \\left(\\gamma (4\\pi R_{\\mathrm{Ala}}^2) + \\beta\\right) $$\n如问题所述，假设两种状态的偏移量 $\\beta$ 相同，因此相互抵消：\n$$ \\Delta G_{\\mathrm{np}} = 4\\pi\\gamma (R_{\\mathrm{Val}}^2 - R_{\\mathrm{Ala}}^2) $$\n总的水合自由能变化是这两项贡献之和：\n$$ \\Delta \\Delta G_{\\mathrm{hyd}} = \\frac{k_e}{2} \\left(\\frac{1}{\\varepsilon_s} - 1\\right) \\left( \\frac{q_{\\mathrm{Val}}^2}{R_{\\mathrm{Val}}} - \\frac{q_{\\mathrm{Ala}}^2}{R_{\\mathrm{Ala}}} \\right) + 4\\pi\\gamma (R_{\\mathrm{Val}}^2 - R_{\\mathrm{Ala}}^2) $$\n此最终方程用于计算每个测试案例的数值结果。对于所有给定的案例，电荷 $q_{\\mathrm{Ala}}$ 和 $q_{\\mathrm{Val}}$ 均为 $0.0$，这使得极性贡献 $\\Delta G_{\\mathrm{polar}}$ 为零，从而简化了计算。因此，计算仅需考虑非极性项。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in hydration free energy for mutating Alanine to Valine\n    using a continuum solvent model.\n    \"\"\"\n\n    # Define physical constants from the problem statement.\n    # Coulomb conversion constant in kcal.A/(mol.e^2).\n    k_e = 332.06371\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (epsilon_s, gamma, q_Ala, R_Ala, q_Val, R_Val)\n    # beta is 0.0 in all cases and cancels out, so it is omitted.\n    test_cases = [\n        # Case 1: happy path, water-like solvent, neutral groups\n        (78.37, 0.005, 0.0, 2.0, 0.0, 2.5),\n        # Case 2: boundary, no mutation\n        (78.37, 0.005, 0.0, 2.0, 0.0, 2.0),\n        # Case 3: parameter sensitivity in the nonpolar term\n        (78.37, 0.0072, 0.0, 2.0, 0.0, 2.5),\n        # Case 4: different solvent permittivity with neutral groups\n        (32.60, 0.005, 0.0, 2.0, 0.0, 2.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        epsilon_s, gamma, q_ala, r_ala, q_val, r_val = case\n\n        # Calculate the change in the polar (electrostatic) free energy.\n        # This term is zero for all test cases since all charges are 0.\n        # However, it is implemented for generality.\n        polar_factor = (k_e / 2.0) * (1.0 / epsilon_s - 1.0)\n        \n        # Handle division by zero if radius is zero (not in test cases, but good practice).\n        term_val = q_val**2 / r_val if r_val != 0 else 0\n        term_ala = q_ala**2 / r_ala if r_ala != 0 else 0\n        \n        delta_g_polar = polar_factor * (term_val - term_ala)\n\n        # Calculate the change in the nonpolar free energy (SASA-based).\n        # The offset beta cancels out.\n        # A = 4 * pi * R^2\n        delta_g_nonpolar = 4.0 * np.pi * gamma * (r_val**2 - r_ala**2)\n        \n        # Total change in hydration free energy\n        delta_delta_g_hyd = delta_g_polar + delta_g_nonpolar\n\n        # Round the result to 6 decimal places as required.\n        results.append(round(delta_delta_g_hyd, 6))\n\n    # Format the final output as a comma-separated list in brackets.\n    # The map(str, ...) ensures float representation is standard.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2455813"}, {"introduction": "理论模型和热力学循环最终要通过分析分子模拟数据来接受检验。本练习让你扮演一名计算生物化学家，使用强大的贝内特接受率（Bennett Acceptance Ratio, BAR）方法来处理模拟数据，并计算蛋白质突变对配体结合亲和力的影响。通过处理这些模拟的“真实”数据[@problem_id:2448843]，你将掌握从复杂数据集中提取精确自由能结果的最可靠技术之一，从而连接起理论公式与实际应用的桥梁。", "problem": "给定一个热力学循环，用于评估受体蛋白单点突变后结合自由能的变化。该循环使用两种分子状态之间的相对炼金术循环：野生型状态（状态 $A$）和突变型状态（状态 $B$）。由突变引起的结合自由能变化定义为在结合（受体-配体复合物）环境下的突变自由能与在非结合（体相溶剂）环境下的突变自由能之差。将结合环境和非结合环境中的突变自由能分别表示为 $\\Delta G_{\\mathrm{bound}}$ 和 $\\Delta G_{\\mathrm{unbound}}$。需要报告的结合自由能变化值为 $\\Delta\\Delta G_{\\mathrm{bind}} = \\Delta G_{\\mathrm{bound}} - \\Delta G_{\\mathrm{unbound}}$。\n\n对于每种环境，您会得到从炼金术变换的每个端点状态的构象中评估出的有限势能差样本。具体来说，对于环境 $s \\in \\{\\mathrm{bound},\\mathrm{unbound}\\}$：\n- 一组“正向系综”样本 $\\{\\Delta u^{(f)}_{i}\\}$，其中 $\\Delta u^{(f)}_{i} = u_B(x_i)-u_A(x_i)$，而 $\\{x_i\\}$ 是从状态 $A$ 的正则系综中抽取的构象。\n- 一组“反向系综”样本 $\\{\\Delta u^{(r)}_{j}\\}$，其中 $\\Delta u^{(r)}_{j} = u_A(y_j)-u_B(y_j)$，而 $\\{y_j\\}$ 是从状态 $B$ 的正则系综中抽取的构象。\n\n所有势能均以 $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ 为单位表示。温度为 $T = 300\\,\\mathrm{K}$，玻尔兹曼常数为 $k_{\\mathrm{B}} = 0.00831446261815324\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$。请仅使用这些单位得出最终答案，并以 $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ 为单位表示每个报告的自由能变化。\n\n您的任务是使用给定的样本和温度 $T$ 下的正则统计力学定义，为每个测试用例计算 $\\Delta G_{\\mathrm{bound}}$ 和 $\\Delta G_{\\mathrm{unbound}}$，然后报告该用例的 $\\Delta\\Delta G_{\\mathrm{bind}}$。将每个报告的 $\\Delta\\Delta G_{\\mathrm{bind}}$ 值四舍五入到恰好三位小数，单位为 $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n\n测试套件：\n- 用例 $1$（典型的良好采样场景）：\n  - 结合，正向系综 $\\{\\Delta u^{(f)}_{i}\\}$: [ $-2.2$, $-1.8$, $-2.0$, $-2.1$, $-1.9$ ]\n  - 结合，反向系综 $\\{\\Delta u^{(r)}_{j}\\}$: [ $2.2$, $1.8$, $2.0$, $2.1$, $1.9$ ]\n  - 非结合，正向系综 $\\{\\Delta u^{(f)}_{i}\\}$: [ $0.8$, $1.2$, $1.0$, $1.1$, $0.9$ ]\n  - 非结合，反向系综 $\\{\\Delta u^{(r)}_{j}\\}$: [ $-1.2$, $-0.8$, $-1.0$, $-1.1$, $-0.9$ ]\n- 用例 $2$（平衡变换，突变自由能和结合变化接近于零）：\n  - 结合，正向系综 $\\{\\Delta u^{(f)}_{i}\\}$: [ $-0.1$, $0.0$, $0.1$ ]\n  - 结合，反向系综 $\\{\\Delta u^{(r)}_{j}\\}$: [ $0.1$, $0.0$, $-0.1$ ]\n  - 非结合，正向系综 $\\{\\Delta u^{(f)}_{i}\\}$: [ $-0.1$, $0.0$, $0.1$ ]\n  - 非结合，反向系综 $\\{\\Delta u^{(r)}_{j}\\}$: [ $0.1$, $0.0$, $-0.1$ ]\n- 用例 $3$（强稳定性的结合变换，伴随一个稳定性稍弱的非结合变换）：\n  - 结合，正向系综 $\\{\\Delta u^{(f)}_{i}\\}$: [ $-5.5$, $-4.5$, $-5.0$ ]\n  - 结合，反向系综 $\\{\\Delta u^{(r)}_{j}\\}$: [ $4.5$, $5.5$, $5.0$ ]\n  - 非结合，正向系综 $\\{\\Delta u^{(f)}_{i}\\}$: [ $-4.9$, $-4.7$, $-4.8$ ]\n  - 非结合，反向系综 $\\{\\Delta u^{(r)}_{j}\\}$: [ $4.7$, $4.9$, $4.8$ ]\n\n您的程序必须计算每种情况下的 $\\Delta\\Delta G_{\\mathrm{bind}}$，并将三个结果作为单行输出，格式为方括号括起来的逗号分隔列表，例如 $[a,b,c]$，其中 $a$、$b$ 和 $c$ 均为浮点数，单位为 $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$，并精确到三位小数。不应打印额外的文本或行。", "solution": "问题陈述已经过严格审查，并被确定为 **有效** 的。这是一个定义明确的计算统计力学问题，基于基本原理，没有任何科学或逻辑上的不一致之处。所提供的数据是完整的，足以得到唯一解。\n\n任务是计算蛋白质突变引起的结合自由能变化 $\\Delta\\Delta G_{\\mathrm{bind}}$。该量定义为 $\\Delta\\Delta G_{\\mathrm{bind}} = \\Delta G_{\\mathrm{bound}} - \\Delta G_{\\mathrm{unbound}}$，其中 $\\Delta G_{\\mathrm{bound}}$ 和 $\\Delta G_{\\mathrm{unbound}}$ 分别是在结合态和非结合态下突变的自由能变化。对于每种状态，我们都获得了来自初始态（野生型，$A$）和最终态（突变型，$B$）的分子动力学模拟的势能差样本。\n\n使用来自两个系综的样本计算自由能差 $\\Delta G = G_B - G_A$ 的最具统计稳健性的方法是 Bennett 接受率（BAR）方法。该方法提供了 $\\Delta G$ 的最小方差估计，被认为是金标准。我们将采用 BAR 方法来计算 $\\Delta G_{\\mathrm{bound}}$ 和 $\\Delta G_{\\mathrm{unbound}}$。\n\n两个状态 $A$ 和 $B$ 之间的亥姆霍兹自由能差由 $\\Delta G = -k_{\\mathrm{B}}T \\ln(Z_B/Z_A)$ 给出，其中 $Z$ 是正则配分函数，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度。BAR 方法为 $\\Delta G$ 提供了一个隐式方程：\n$$\n\\left\\langle \\frac{1}{1 + e^{\\beta(\\Delta U - \\Delta G)}} \\right\\rangle_B = \\left\\langle \\frac{1}{1 + e^{-\\beta(\\Delta U - \\Delta G)}} \\right\\rangle_A\n$$\n此处，$\\beta = 1/(k_{\\mathrm{B}}T)$，$\\Delta U = U_B - U_A$ 是势能差，$\\langle \\cdot \\rangle_A$ 和 $\\langle \\cdot \\rangle_B$ 分别表示在状态 $A$ 和 $B$ 上的正则系综平均。\n\n问题提供了有限样本来估计这些平均值：\n- 来自状态 $A$ 的正向样本：$\\{\\Delta u^{(f)}_{i}\\}_{i=1}^{N_f}$，其中 $\\Delta u^{(f)}_{i} = U_B(x_i) - U_A(x_i)$。\n- 来自状态 $B$ 的反向样本：$\\{\\Delta u^{(r)}_{j}\\}_{j=1}^{N_r}$，其中 $\\Delta u^{(r)}_{j} = U_A(y_j) - U_B(y_j)$。注意，这意味着 $\\Delta U(y_j) = -\\Delta u^{(r)}_{j}$。\n\n将样本平均值代入 BAR 方程，我们得到需求解 $\\Delta G$ 的方程：\n$$\n\\frac{1}{N_f} \\sum_{i=1}^{N_f} \\frac{1}{1 + e^{-\\beta(\\Delta u^{(f)}_{i} - \\Delta G)}} = \\frac{1}{N_r} \\sum_{j=1}^{N_r} \\frac{1}{1 + e^{\\beta(-\\Delta u^{(r)}_{j} - \\Delta G)}}\n$$\n由于所有测试用例中，正向样本数 $N_f$ 等于反向样本数 $N_r$，因此可以通过消去前置因子 $1/N_f$ 和 $1/N_r$ 来稍微简化方程。我们必须找到函数 $F(\\Delta G)$ 的根：\n$$\nF(\\Delta G) = \\sum_{i=1}^{N_f} \\frac{1}{1 + e^{-\\beta(\\Delta u^{(f)}_{i} - \\Delta G)}} - \\sum_{j=1}^{N_r} \\frac{1}{1 + e^{\\beta(-\\Delta u^{(r)}_{j} - \\Delta G)}} = 0\n$$\n这是一个可以数值求解的非线性方程。函数 $F(\\Delta G)$ 是单调的，保证了根的唯一性。我们将使用数值求根算法，特别是 `SciPy` 库提供的 Brent-Dekker 方法 (`brentq`)，因其稳健性而选用。\n\n每个测试用例的步骤如下：\n1.  定义物理常数：$T = 300\\,\\mathrm{K}$ 和 $k_{\\mathrm{B}} = 0.00831446261815324\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$。由此计算热能项 $\\beta = 1/(k_{\\mathrm{B}}T)$。\n2.  对于 `bound` 环境，使用提供的正向和反向样本 $\\{\\Delta u^{(f, \\mathrm{bound})}_{i}\\}$ 和 $\\{\\Delta u^{(r, \\mathrm{bound})}_{j}\\}$ 来建立并求解 BAR 方程，得到 $\\Delta G_{\\mathrm{bound}}$。\n3.  对于 `unbound` 环境，使用提供的样本 $\\{\\Delta u^{(f, \\mathrm{unbound})}_{i}\\}$ 和 $\\{\\Delta u^{(r, \\mathrm{unbound})}_{j}\\}$ 来建立并求解 BAR 方程，得到 $\\Delta G_{\\mathrm{unbound}}$。\n4.  计算最终量 $\\Delta\\Delta G_{\\mathrm{bind}} = \\Delta G_{\\mathrm{bound}} - \\Delta G_{\\mathrm{unbound}}$。\n5.  按要求将结果值四舍五入到三位小数。\n\n$k_{\\mathrm{B}}T$ 的计算如下：\n$k_{\\mathrm{B}}T = (0.00831446261815324\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}) \\times (300\\,\\mathrm{K}) \\approx 2.494338785\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n\n在提供的测试数据中有一个有趣的观察结果，即对称性：对于每个用例，正向样本集 $\\{\\Delta u_i^{(f)}\\}$ 与取反后的反向样本集 $\\{-\\Delta u_j^{(r)}\\}$ 相同。此外，这些集合中的每一个都在其算术平均值周围呈数值对称。在这些特定条件下，BAR 方程的解就是能量样本的算术平均值，$\\Delta G = \\overline{\\Delta u^{(f)}}$。虽然这提供了一个方便的解析检验，但实现将使用通用的数值求解器来展示 BAR 方法的严格应用。\n\n- 对于用例 1：\n  - $\\Delta G_{\\mathrm{bound}} = \\text{mean}([-2.2, -1.8, -2.0, -2.1, -1.9]) = -2.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  - $\\Delta G_{\\mathrm{unbound}} = \\text{mean}([0.8, 1.2, 1.0, 1.1, 0.9]) = 1.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  - $\\Delta\\Delta G_{\\mathrm{bind}} = -2.0 - 1.0 = -3.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n- 对于用例 2：\n  - $\\Delta G_{\\mathrm{bound}} = \\text{mean}([-0.1, 0.0, 0.1]) = 0.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  - $\\Delta G_{\\mathrm{unbound}} = \\text{mean}([-0.1, 0.0, 0.1]) = 0.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  - $\\Delta\\Delta G_{\\mathrm{bind}} = 0.0 - 0.0 = 0.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n- 对于用例 3：\n  - $\\Delta G_{\\mathrm{bound}} = \\text{mean}([-5.5, -4.5, -5.0]) = -5.0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  - $\\Delta G_{\\mathrm{unbound}} = \\text{mean}([-4.9, -4.7, -4.8]) = -4.8\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  - $\\Delta\\Delta G_{\\mathrm{bind}} = -5.0 - (-4.8) = -0.2\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n\n数值实现将在格式化最终输出之前确认这些值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve_bar(u_fwd: np.ndarray, u_rev: np.ndarray, beta: float) -> float:\n    \"\"\"\n    Calculates the free energy difference using the Bennett Acceptance Ratio (BAR) method.\n\n    Args:\n        u_fwd: Array of forward potential energy differences (U_B - U_A) from state A.\n        u_rev: Array of reverse potential energy differences (U_A - U_B) from state B.\n        beta: The inverse temperature, 1/(k_B * T).\n\n    Returns:\n        The estimated free energy difference, dG.\n    \"\"\"\n    n_fwd = len(u_fwd)\n    n_rev = len(u_rev)\n\n    def bar_equation(dG: float) -> float:\n        \"\"\"The BAR equation G(dG) = 0 that we need to solve for dG.\"\"\"\n        # Arguments for the exponential function, computed with care to avoid overflow\n        # although with typical dG values it's not an issue.\n        # Note: log-sum-exp trick is not directly applicable here as it is a sum of sigmoids.\n        # The equation to solve is:\n        # (1/N_f) * sum(sigmoid(beta*(dG - u_f))) = (1/N_r) * sum(sigmoid(-beta*(dG + u_r)))\n        # which is equivalent to:\n        # (1/N_f) * sum(1/(1+exp(-beta(dG-u_f)))) = (1/N_r) * sum(1/(1+exp(beta(dG+u_r))))\n        # And also equivalent to the form used here:\n        # (1/N_f) * sum(1/(1+exp(beta*(u_f-dG)))) = (1/N_r) * sum(1/(1+exp(-beta*(-u_r-dG))))\n        \n        arg_fwd = beta * (u_fwd - dG)\n        sum_fwd = np.sum(1.0 / (1.0 + np.exp(arg_fwd)))\n\n        arg_rev = -beta * (-u_rev - dG)\n        sum_rev = np.sum(1.0 / (1.0 + np.exp(arg_rev)))\n\n        return (sum_fwd / n_fwd) - (sum_rev / n_rev)\n\n    # Provide a generous bracket for the root-finding algorithm.\n    # The root should be close to the mean of the energy differences.\n    all_u = np.concatenate([u_fwd, -u_rev])\n    min_u, max_u = np.min(all_u), np.max(all_u)\n    # A wide bracket ensures robustness.\n    bracket = [min_u - 50.0, max_u + 50.0]\n\n    try:\n        sol = root_scalar(bar_equation, bracket=bracket, method='brentq')\n        return sol.root\n    except ValueError:\n        # This fallback can be useful if the bracket is not valid,\n        # which is unlikely here but good practice.\n        # A simple average is a reasonable initial guess.\n        initial_guess = np.mean(all_u)\n        sol = root_scalar(bar_equation, x0=initial_guess, method='brentq', bracket=bracket)\n        return sol.root\n\ndef solve():\n    \"\"\"\n    Main function to run the free energy calculations for all test cases.\n    \"\"\"\n    # Define constants\n    T = 300.0  # Temperature in Kelvin\n    k_B = 0.00831446261815324  # Boltzmann constant in kJ/(mol*K)\n    beta = 1.0 / (k_B * T)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (\n            [-2.2, -1.8, -2.0, -2.1, -1.9],  # Bound, forward\n            [2.2, 1.8, 2.0, 2.1, 1.9],       # Bound, reverse\n            [0.8, 1.2, 1.0, 1.1, 0.9],       # Unbound, forward\n            [-1.2, -0.8, -1.0, -1.1, -0.9]   # Unbound, reverse\n        ),\n        # Case 2\n        (\n            [-0.1, 0.0, 0.1],                # Bound, forward\n            [0.1, 0.0, -0.1],                # Bound, reverse\n            [-0.1, 0.0, 0.1],                # Unbound, forward\n            [0.1, 0.0, -0.1]                 # Unbound, reverse\n        ),\n        # Case 3\n        (\n            [-5.5, -4.5, -5.0],              # Bound, forward\n            [4.5, 5.5, 5.0],                 # Bound, reverse\n            [-4.9, -4.7, -4.8],              # Unbound, forward\n            [4.7, 4.9, 4.8]                  # Unbound, reverse\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack data for the current case\n        bound_fwd, bound_rev, unbound_fwd, unbound_rev = case\n\n        # Convert lists to numpy arrays for efficient computation\n        bound_fwd_np = np.array(bound_fwd)\n        bound_rev_np = np.array(bound_rev)\n        unbound_fwd_np = np.array(unbound_fwd)\n        unbound_rev_np = np.array(unbound_rev)\n\n        # Calculate free energy change for the bound state\n        dG_bound = solve_bar(bound_fwd_np, bound_rev_np, beta)\n\n        # Calculate free energy change for the unbound state\n        dG_unbound = solve_bar(unbound_fwd_np, unbound_rev_np, beta)\n\n        # Calculate the final binding free energy shift\n        ddG_bind = dG_bound - dG_unbound\n        \n        # Append the result formatted to three decimal places\n        results.append(f\"{ddG_bind:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```", "id": "2448843"}]}