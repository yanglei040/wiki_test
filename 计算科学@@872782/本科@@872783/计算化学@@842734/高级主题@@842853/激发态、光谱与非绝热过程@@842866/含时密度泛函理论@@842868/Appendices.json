{"hands_on_practices": [{"introduction": "在信任任何含时密度泛函理论（TD-DFT）的计算结果之前，我们必须首先确保其所依赖的基态密度泛函理论（DFT）计算是可靠的。一个常见的陷阱是，对一个可能具有开壳层或双自由基特征的体系，错误地使用了限制性的闭壳层方法进行描述。本练习 [@problem_id:1417491] 将向你展示，一个看似“非物理”的TD-DFT结果——负的激发能——实际上是一个至关重要的诊断信号，它揭示了你的基态参考态可能存在不稳定性。", "problem": "一位本科生研究员正在研究一个已知具有显著双自由基特征的分子的电子性质。他们首先使用密度泛函理论 (DFT) 和自旋限制形式论进行标准的基态计算，该形式论假设所有电子都在轨道中配对，从而得到一个闭壳层单重态 ($S_0$)。为了探测激发态，他们接着以这个自旋限制的 $S_0$ 态为参考，进行了一次含时密度泛函理论 (TD-DFT) 计算。TD-DFT 计算的输出报告称，最低的三重态 ($T_1$) 的激发能为 -0.15 哈特里 (Hartrees)。\n\n基于这个看似不符合物理规律的负激发能结果，关于初始的基态 DFT 计算，最可能的结论是什么？\n\nA. DFT 计算中使用的数值积分格点不够密集，导致了一个虚假的、非物理的结果，该结果在用更精细的格点重新计算后会消失。\n\nB. 所选的基组不足以描述三重态，导致其能量被人为地降低到基态以下。需要一个大得多的基组。\n\nC. 对于这个分子，自旋限制形式论是一个不正确的假设。真实的基态能量低于计算出的自旋限制单重态，并且这个能量更低的状态很可能具有三重态或开壳层特征。\n\nD. TD-DFT 方法从根本上无法描述任何分子系统的三重态，负能量是这种理论局限性的常见人为产物。", "solution": "这个问题的核心在于理解激发能代表什么，以及含时密度泛函理论 (TD-DFT) 是如何计算它的。\n\n1.  **激发能的定义**：在量子力学中，激发能 ($\\Delta E$) 是激发态和基态之间的能量差。根据定义，基态是系统的最低能量状态。因此，对于一个物理上真实的过程，激发能必须是正的：\n    $$\n    \\Delta E = E_{\\text{excited}} - E_{\\text{ground}} \\ge 0\n    $$\n    负的激发能意味着所谓的“激发态”实际上比被假定为“基态”的状态能量更低。\n\n2.  **TD-DFT 的背景**：TD-DFT 是一种计算激发态性质的方法。它基于一个参考态进行运算，这个参考态通常是使用标准密度泛函理论 (DFT) 计算出的基态。然后，激发态的能量是*相对于*这个 DFT 参考态来计算的。在这个问题中，参考态是一个自旋限制的闭壳层单重态，我们可以表示为 $E(S_0, \\text{restricted})$。\n\n3.  **分析结果**：TD-DFT 计算得出了最低三重态 ($T_1$) 的负激发能。我们称这个能量为 $\\Delta E(T_1)$。根据 TD-DFT 的原理，这意味着：\n    $$\n    \\Delta E(T_1) = E(T_1) - E(S_0, \\text{restricted})  0\n    $$\n    这可以重新排列为：\n    $$\n    E(T_1)  E(S_0, \\text{restricted})\n    $$\n    这个不等式表明，计算出的三重态 ($T_1$) 的能量低于用作参考的自旋限制单重态 ($S_0$) 的能量。\n\n4.  **物理解释**：TD-DFT 中的负激发能实际上并非“不符合物理规律”。相反，它是一个诊断工具，揭示了参考 DFT 计算中的不稳定性。它表明参考态 $E(S_0, \\text{restricted})$ *不是* 系统的真实基态。由于自旋限制形式论的约束（强制所有电子配对），计算被强制进入了一个能量更高的解。存在另一个能量更低的电子构型——在这种情况下，是一个具有三重态特征的构型。这对于具有双自由基特征的分子来说是常见现象，其中能量最低的单重态通常是开壳层单重态，而三重态的能量可能非常接近甚至低于被不恰当描述的闭壳层单重态的能量。TD-DFT 的负激发能是参考态这种所谓的“三重态不稳定性”的标志。\n\n5.  **评估选项**：\n    *   **A. 数值积分格点：** 虽然不良的格点会导致数值噪音和收敛问题，但它不是导致像负激发能这样定性错误结果的根本原因。这种特定的现象是参考态稳定性问题的著名指标，而不是简单的数值精度问题。\n    *   **B. 基组不足：** 不足的基组可能导致所有态的能量不准确。然而，与格点问题一样，除非它加剧了潜在的稳定性问题，否则通常不会表现为负激发能。主要原因是参考波函数本身的性质。\n    *   **C. 不正确的自旋限制形式论：** 这与我们的分析完全一致。负激发能是自旋限制单重态参考态能量高于三重态的直接后果。这意味着基态是闭壳层单重态的假设是错误的，真实的基态更适合用不同的电子构型（例如，开壳层或非限制构型）来描述。\n    *   **D. TD-DFT 无法描述三重态：** 这种说法过于绝对且不正确。TD-DFT，特别是在大多数代码中使用的绝热近似下，可以并且确实计算三重态激发能。这里的问题不是 TD-DFT 的普遍失败，而是提供给 TD-DFT 计算的*输入参考态*的特定问题。该方法正确地诊断出了有缺陷的参考态。\n\n因此，最准确的结论是，自旋限制 DFT 计算未能找到该分子的真实基态。", "answer": "$$\\boxed{C}$$", "id": "1417491"}, {"introduction": "TD-DFT的一个核心应用是预测分子的光谱性质，从而与实验直接对话。本练习 [@problem_id:1417512] 将引导你完成一个标准的光物理性质计算流程，用以预测斯托克斯位移（Stokes shift），这是荧光材料的一个关键参数。你将学习如何利用基态和激发态几何构型下的能量计算值，来确定垂直吸收和发射过程的能量，从而架起量子化学计算与实验光谱学之间的桥梁。", "problem": "一位计算化学家正在研究一种新合成的有机分子的光物理性质，该分子旨在用于有机发光二极管（OLEDs）。目标是预测斯托克斯位移，即吸收光谱和发射光谱最大值之间的能量差。这通过使用量子化学方法模拟分子在光激发下的行为来实现。\n\n计算方案包括以下步骤，基于用于基态的密度泛函理论（DFT）和用于激发态的含时密度泛函理论（TD-DFT）：\n1.  分子几何结构在其电子基态（$S_0$）下进行优化，得到平衡几何结构 $R_0$。\n2.  然后在其第一单重激发态（$S_1$）下优化几何结构，得到弛豫的激发态平衡几何结构 $R_1$。\n\n接着进行一系列单点能计算。这些计算得到的总电子能量如下所示。注意，$E(S_i, R_j)$ 表示在固定的原子核几何结构 $R_j$ 下计算的电子态 $S_i$ 的能量。\n\n-   在优化的基态几何结构下的基态能量，$E(S_0, R_0) = -450.1234$ 哈特里。\n-   在优化的基态几何结构下的第一激发态能量，$E(S_1, R_0) = -449.9948$ 哈特里。\n-   在优化的激发态几何结构下的第一激发态能量，$E(S_1, R_1) = -449.9985$ 哈特里。\n-   在优化的激发态几何结构下的基态能量，$E(S_0, R_1) = -450.1197$ 哈特里。\n\n使用所提供的数据和换算因子 1 哈特里 = 27.2114 eV，计算该分子的斯托克斯位移。答案以电子伏特（eV）表示，并四舍五入到三位有效数字。", "solution": "根据弗兰克-康登原理，斯托克斯位移定义为垂直吸收能（从 $R_{0}$ 处的 $S_{0}$ 到 $R_{0}$ 处的 $S_{1}$）与垂直发射能（从 $R_{1}$ 处的 $S_{1}$ 到 $R_{1}$ 处的 $S_{0}$）之间的差值。\n\n定义吸收能：\n$$\nE_{\\text{abs}}=\\left[E(S_{1},R_{0})-E(S_{0},R_{0})\\right].\n$$\n代入给定值（单位为哈特里）：\n$$\nE_{\\text{abs}} = \\left[-449.9948 - (-450.1234)\\right] = 0.1286.\n$$\n\n定义发射能：\n$$\nE_{\\text{em}}=\\left[E(S_{1},R_{1})-E(S_{0},R_{1})\\right].\n$$\n代入给定值（单位为哈特里）：\n$$\nE_{\\text{em}} = \\left[-449.9985 - (-450.1197)\\right] = 0.1212.\n$$\n\n那么，以能量单位表示的斯托克斯位移为：\n$$\n\\Delta E_{\\text{Stokes}} = E_{\\text{abs}} - E_{\\text{em}} = 0.1286 - 0.1212 = 0.0074 \\text{ Hartree}.\n$$\n\n使用 $1 \\text{ Hartree} = 27.2114 \\text{ eV}$ 将哈特里转换为电子伏特：\n$$\n\\Delta E_{\\text{Stokes}} (\\text{eV}) = 0.0074 \\times 27.2114 = 0.20136436 \\text{ eV}.\n$$\n\n四舍五入到三位有效数字：\n$$\n\\Delta E_{\\text{Stokes}} = 0.201 \\text{ eV}.\n$$", "answer": "$$\\boxed{0.201}$$", "id": "1417512"}, {"introduction": "任何计算方法都有其适用范围和局限性，理解这些局限性与掌握其应用同等重要。本练习 [@problem_id:2466214] 将通过一个简明但深刻的理论模型，揭示TD-DFT最著名的缺陷之一：对长程电荷转移（charge-transfer）激发的灾难性失败。通过从第一性原理出发，推导正确的物理能量并将其与错误的TD-DFT预测进行比较，你将深刻理解为何标准的半局域（semilocal）泛函在这种情况下会失效，以及其能量表达式中缺失了哪个关键的物理项。", "problem": "要求您编写一个完整、可运行的程序，在一个最小但有科学依据的模型中，演示含时密度泛函理论（TD-DFT）如何在使用标准广义梯度近似（GGA）泛函时，错误地预测空间分离的给体-受体对存在虚假的低能量电荷转移激发。您的程序必须从第一性原理出发实现以下逻辑。\n\n从密度泛函理论（DFT）中电离势和电子亲和能的基本定义，以及分离电荷的静电相互作用出发。利用这些原理，推导大分离距离下最低的给体到受体电荷转移激发能的表达式。然后，使用线性响应 TD-DFT，并利用对于空间上不重叠的轨道，绝热半局域哈特里-交换-相关核函数（Hartree–exchange–correlation kernel）产生的耦合可以忽略不计这一事实，推导半局域 GGA 泛函做出的相应预测。最后，通过引入导数不连续性，将科恩-沈（Kohn–Sham）轨道能量差与基本能隙联系起来。在您的推导中，请勿使用或引用任何已有的简化公式；相反，仅根据以下基础进行推理：\n- 基本定义：通过总能量差定义的电离势 $I$ 和电子亲和能 $A$，以及相距为 $R$ 的两个单位电荷之间的静电相互作用能。\n- 线性响应理论核心思想：激发能来自一个由无相互作用的跃迁能量和一个耦合项决定的响应极点，并且对于轨道重叠可忽略的空间分离片段间的电荷转移，局域绝热核函数提供的长程耦合可忽略不计。\n- 一个经过充分检验的概念性事实：多体基本能隙通过导数不连续性与科恩-沈（Kohn–Sham）能隙相关联。\n\n为每个测试用例实现一个最小双片段模型，包含以下参数：\n- 给体电离势 $I_D$，单位为哈特里（Hartree）。\n- 受体电子亲和能 $A_A$，单位为哈特里（Hartree）。\n- 中心间距 $R$，单位为玻尔（bohr）。\n- 一个有效的正导数不连续性参数 $\\Delta_{\\mathrm{xc}}$，单位为哈特里（Hartree），该参数捕捉了半局域 GGA 泛函典型的能隙低估特征。\n\n对于每个测试用例，计算：\n1. 基于上述原理的、符合物理直觉的大分离距离电荷转移激发能，以哈特里（Hartree）为单位，此处表示为 $E_{\\mathrm{true}}$。\n2. 绝热半局域 GGA TD-DFT 对相同电荷转移激发的预测值，以哈特里（Hartree）为单位，此处表示为 $E_{\\mathrm{GGA}}$。\n3. 带符号误差 $\\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}}$，单位为哈特里（Hartree）。\n4. 一个布尔标志，当且仅当 GGA 预测值虚假地偏低时为真，定义为严格不等式 $E_{\\mathrm{GGA}}  E_{\\mathrm{true}}$。\n\n您的程序必须使用以下固定的参数元组 $(I_D,A_A,R,\\Delta_{\\mathrm{xc}})$ 测试集，单位为原子单位制（能量为哈特里，距离为玻尔）：\n- 测试 1（一般分离对）：$(0.30, 0.08, 30.0, 0.12)$。\n- 测试 2（极大分离距离）：$(0.30, 0.08, 200.0, 0.12)$。\n- 测试 3（小基本能隙导致接近于零的 GGA 激发能）：$(0.20, 0.08, 25.0, 0.12)$。\n- 测试 4（数值平衡点，在该 $R$ 值下低估量等于缺失的静电作用）：$(0.25, 0.05, 8.\\overline{3}, 0.12)$，其中 $8.\\overline{3}$ 表示 $25/3$ 玻尔。\n\n所有能量必须以哈特里（Hartree）为单位，并四舍五入到六位小数。对于每个测试用例，您的程序必须按顺序输出 $E_{\\mathrm{true}}$、$E_{\\mathrm{GGA}}$、$\\Delta E$ 和布尔标志这四个值。将所有测试用例的结果汇总到一个扁平列表中。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，\"[result1,result2,result3,...]\"）。\n\n不涉及角度单位。不允许外部输入；程序必须完全自包含，并在执行时产生所需的单行输出。", "solution": "问题陈述具有科学依据、提法明确，并包含推导唯一解所需的所有信息。它描述了常见密度泛函近似的一种众所周知的失效模式。因此，该问题被认为是有效的，并将基于所提供的第一性原理构建解决方案。\n\n我们首先推导在大分离距离下物理上正确的电荷转移（$CT$）激发能的表达式，记为 $E_{\\mathrm{true}}$。一个 $CT$ 激发过程涉及将一个电子从给体分子 $D$ 转移到相距为 $R$ 的受体分子 $A$。该过程可表示为 $D^0A^0 \\rightarrow D^+A^-$。此激发的能量 $\\omega_{CT}$ 是最终态和初始态总能量之差：\n$$ \\omega_{CT} = E(D^+A^-) - E(D^0A^0) $$\n在大分离距离 $R$ 的极限下，组合系统的能量可以近似为其非相互作用组分片段的能量之和，再加上它们的经典静电相互作用能。对于初始中性态，其能量为：\n$$ E(D^0A^0) \\approx E(D^0) + E(A^0) $$\n对于最终的离子态，其能量包括新形成的离子之间的静电引力：\n$$ E(D^+A^-) \\approx E(D^+) + E(A^-) + E_{\\mathrm{int}} $$\n此处，$E(X)$ 表示物种 $X$ 的总能量。根据库仑定律，$D^+$ 上的 $+1e$ 点电荷与 $A^-$ 上的 $-1e$ 点电荷之间的相互作用能 $E_{\\mathrm{int}}$ 为：在原子单位制中，能量单位为哈特里，距离单位为玻尔，该能量为：\n$$ E_{\\mathrm{int}} = -\\frac{1}{R} $$\n将这些表达式代入 $\\omega_{CT}$ 的方程中，我们得到：\n$$ \\omega_{CT} \\approx \\left( E(D^+) + E(A^-) - \\frac{1}{R} \\right) - \\left( E(D^0) + E(A^0) \\right) $$\n按物种重新组合各项可得：\n$$ \\omega_{CT} \\approx \\left( E(D^+) - E(D^0) \\right) + \\left( E(A^-) - E(A^0) \\right) - \\frac{1}{R} $$\n括号中的项对应于基本定义。给体的电离势 $I_D$ 是移去一个电子所需的能量：\n$$ I_D = E(D^+) - E(D^0) $$\n受体的电子亲和能 $A_A$ 是捕获一个电子所释放的能量，定义为：\n$$ A_A = E(A^0) - E(A^-) $$\n根据此定义，可以得出 $E(A^-) - E(A^0) = -A_A$。将 $I_D$ 和 $A_A$ 的定义代入，我们便得到真实的大分离距离电荷转移激发能的表达式：\n$$ E_{\\mathrm{true}} = I_D - A_A - \\frac{1}{R} $$\n\n接下来，我们推导绝热半局域含时密度泛函理论（$TD-DFT$）的相应预测值，记为 $E_{\\mathrm{GGA}}$。在线性响应 $TD-DFT$ 框架内，激发能 $\\omega$ 是通过求解一个矩阵方程的本征值得到的。对于从一个占据的科恩-沈（$KS$）轨道 $\\phi_i$ 到一个虚拟的 $KS$ 轨道 $\\phi_a$ 的单次激发，其在绝热近似下的激发能由下式给出：\n$$ \\omega_{ia} = \\varepsilon_a - \\varepsilon_i + K_{ia,ia} $$\n其中 $\\varepsilon_i$ 和 $\\varepsilon_a$ 是 $KS$ 轨道的能量，$K_{ia,ia}$ 是耦合矩阵元。该矩阵元依赖于哈特里-交换-相关（$HXC$）核函数 $f_{HXC}$：\n$$ K_{ia,ia} = \\iint \\phi_i^*(\\mathbf{r})\\phi_a(\\mathbf{r}) f_{HXC}(\\mathbf{r}, \\mathbf{r}') \\phi_a^*(\\mathbf{r}')\\phi_i(\\mathbf{r}') d\\mathbf{r} d\\mathbf{r}' $$\n对于我们所考虑的 $CT$ 激发，占据轨道 $\\phi_i$ 是给体的最高占据分子轨道（$HOMO_D$），虚拟轨道 $\\phi_a$ 是受体的最低未占分子轨道（$LUMO_A$）。在大分离距离 $R$ 下，这些轨道在空间上是孤立的，它们的重叠乘积 $\\phi_i(\\mathbf{r})\\phi_a(\\mathbf{r})$ 对于所有 $\\mathbf{r}$ 都可以忽略不计。\n对于像广义梯度近似（$GGA$）这样的半局域泛函，其核函数 $f_{HXC}^{GGA}(\\mathbf{r}, \\mathbf{r}')$ 实际上是局域的，意味着它会随着距离 $|\\mathbf{r} - \\mathbf{r}'|$ 的增加而迅速衰减为零。局域核函数和可忽略的轨道重叠共同导致耦合积分 $K_{ia,ia}$ 变为零：\n$$ K_{ia,ia}^{GGA} \\approx 0 $$\n因此，$TD-GGA$ 激发能虚假地简化为所涉及的 $KS$ 轨道能量的简单差值：\n$$ E_{\\mathrm{GGA}} = \\omega_{CT}^{GGA} \\approx \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D} $$\n为了使这个表达式有用，我们必须将此 $KS$ 轨道能隙与物理量 $I_D$ 和 $A_A$ 联系起来。组合的 $D-A$ 系统的基本多体能隙为 $E_{gap} = I_D - A_A$。相应的 $KS$ 能隙为 $\\varepsilon_{gap}^{KS} = \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}$。对于一个精确的泛函，这些量通过交换相关势的导数不连续性 $\\Delta_{xc}$ 相关联：\n$$ E_{gap} = \\varepsilon_{gap}^{KS} + \\Delta_{xc} \\implies I_D - A_A = (\\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}) + \\Delta_{xc} $$\n像 $GGA$ 这样的近似泛函存在一个已知的系统性误差，该误差实际上对应于缺失的导数不连续性。本问题提供了一个有效的参数 $\\Delta_{\\mathrm{xc}}  0$ 来模拟这一缺陷。在 $GGA$ 框架下，重排预测 $KS$ 能隙的方程可得：\n$$ \\varepsilon_{LUMO,A}^{GGA} - \\varepsilon_{HOMO,D}^{GGA} = (I_D - A_A) - \\Delta_{\\mathrm{xc}} $$\n这就给出了 $TD-GGA$ 电荷转移激发能的最终表达式：\n$$ E_{\\mathrm{GGA}} = I_D - A_A - \\Delta_{\\mathrm{xc}} $$\n这个结果错误地显示了激发能在大的 $R$ 值下趋于一个常数，完全忽略了正确的 $-1/R$ 渐近行为。\n\n最后，我们计算带符号误差 $\\Delta E$ 并建立虚假低预测的条件。误差是 $GGA$ 预测值与真实值之间的差：\n$$ \\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}} = (I_D - A_A - \\Delta_{\\mathrm{xc}}) - \\left(I_D - A_A - \\frac{1}{R}\\right) $$\n$$ \\Delta E = \\frac{1}{R} - \\Delta_{\\mathrm{xc}} $$\n$GGA$ 的预测值是虚假地偏低当且仅当 $E_{\\mathrm{GGA}}  E_{\\mathrm{true}}$，这意味着 $\\Delta E  0$。这给出了条件：\n$$ \\frac{1}{R} - \\Delta_{\\mathrm{xc}}  0 \\implies \\frac{1}{R}  \\Delta_{\\mathrm{xc}} $$\n随着分离距离 $R$ 的增加，$1/R$ 会减小。对于任何存在非零能隙低估误差（$\\Delta_{\\mathrm{xc}}  0$）的系统，都存在一个分离距离，超过该距离后上述不等式即成立，这证明了绝热半局域泛函在描述长程电荷转移方面的根本性失败。下面的程序实现了这些推导出的公式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the true and TD-GGA charge-transfer excitation energies for a\n    series of donor-acceptor pairs to demonstrate the failure of semilocal DFT.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (I_D, A_A, R, delta_xc) in atomic units.\n    test_cases = [\n        # Test 1: General separated pair\n        (0.30, 0.08, 30.0, 0.12),\n        # Test 2: Very large separation\n        (0.30, 0.08, 200.0, 0.12),\n        # Test 3: Small fundamental gap\n        (0.20, 0.08, 25.0, 0.12),\n        # Test 4: Numerical balance point\n        (0.25, 0.05, 25.0/3.0, 0.12),\n    ]\n\n    results = []\n    for case in test_cases:\n        I_D, A_A, R, delta_xc = case\n        \n        # 1. Calculate the physically motivated charge-transfer energy, E_true.\n        # This is derived from E_true = I_D - A_A - 1/R.\n        E_true = I_D - A_A - 1.0/R\n        \n        # 2. Calculate the adiabatic semilocal GGA TD-DFT prediction, E_GGA.\n        # This is derived from E_GGA = I_D - A_A - delta_xc.\n        E_gga = I_D - A_A - delta_xc\n        \n        # 3. Calculate the signed error, delta_E.\n        # This is delta_E = E_GGA - E_true, which simplifies to 1/R - delta_xc.\n        delta_E = 1.0/R - delta_xc\n\n        # 4. Determine if the GGA prediction is spuriously low.\n        # This is true if E_GGA  E_true.\n        is_spurious = E_gga  E_true\n\n        # Append the four required results for this test case.\n        # Energies are rounded to six decimal places.\n        results.append(np.round(E_true, 6))\n        results.append(np.round(E_gga, 6))\n        results.append(np.round(delta_E, 6))\n        results.append(is_spurious)\n        \n    # Final print statement in the exact required format.\n    # The boolean `True`/`False` is converted to string \"True\"/\"False\".\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2466214"}]}