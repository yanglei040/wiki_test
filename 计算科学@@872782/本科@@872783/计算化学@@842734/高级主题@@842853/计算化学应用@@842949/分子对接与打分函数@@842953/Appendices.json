{"hands_on_practices": [{"introduction": "在我们将对接软件用于预测新分子与靶蛋白的结合模式之前，我们如何能确信其预测结果是可靠的呢？“重新对接”（Redocking）是任何基于结构的药物设计项目中至关重要的第一步验证。这项练习 [@problem_id:2150153] 旨在探讨该技术的核心目的：通过检验我们选择的计算方法是否能够准确复现已知的、通过实验测定的结合构象，来建立对该方法用于筛选未知化合物的信心。", "problem": "在一个基于结构的药物设计项目中，研究人员获得了一个靶酶与其已知的强效抑制剂复合物的高分辨率X射线晶体结构。蛋白质数据库（PDB）文件包含了酶和结合的抑制剂的坐标。在继续针对该酶筛选大型虚拟化合物库之前，研究人员执行了一个称为“重对接”（redocking）的初始计算步骤。这包括通过计算将抑制剂从结合位点中移除，将其视为柔性配体，然后使用对接软件将其放回到刚性酶的同一结合位点中。\n\n这个重对接程序的主要科学目标是什么？\n\nA. 验证所选的对接算法和打分函数能够准确地再现实验观察到的已知抑制剂的结合姿势。\n\nB. 计算抑制剂与酶之间精确的、绝对的结合自由能。\n\nC. 发现酶表面上其他未知的结合位点。\n\nD. 通过计算精修和提高酶的初始X射线晶体结构的分辨率。\n\nE. 生成一组新的、结构多样的化合物，这些化合物被预测比原始抑制剂结合得更紧密。", "solution": "我们首先定义重对接程序：给定一个通过X射线晶体学实验确定的酶-抑制剂复合物姿势，通过计算将抑制剂移除，然后使用选定的对接算法和打分函数将其重新对接到刚性受体的结合位点中。此步骤的科学作用是测试对接方案能否在与实验复合物紧密匹配的条件下，恢复已知配体的晶体学结合模式（姿势）。\n\n因此，主要目标是方法学上的验证：如果算法和打分函数能够以与晶体学坐标相比很小的均方根偏差再现实验观察到的姿势，那么它们就被认为适用于（或可以进行调整）对同一靶点的新型化合物进行前瞻性虚拟筛选。这为在该特定系统内进行姿势预测和排序建立了信心。\n\n我们现在排除其他解释：\n- 选项B是不正确的，因为对接打分函数并非设计用于产生精确的、绝对的结合自由能；精确的绝对自由能计算需要严谨的方法，如炼金术自由能计算，而不是标准对接。\n- 选项C是不正确的，因为发现其他结合位点通常涉及盲对接或结合位点检测算法；重对接专注于已知的位点和已知的配体。\n- 选项D是不正确的，因为提高晶体学分辨率是一项晶体学/精修任务（例如，针对衍射数据进行精修），而不是对接任务。\n- 选项E是不正确的，因为生成新化合物是一项设计或枚举活动；虽然经过验证的对接方法之后可能被用来筛选新化合物，但重对接本身并不会生成新的分子。\n\n因此，重对接的主要科学目标是通过再现已知的实验姿势来验证对接算法和打分函数。", "answer": "$$\\boxed{A}$$", "id": "2150153"}, {"introduction": "评分函数通过加和多种能量项来估算结合亲和力，其中静电相互作用是描述极性识别最关键的部分之一。然而，静电能计算的准确性在很大程度上取决于分配给配体和蛋白质原子的局部电荷。这项练习 [@problem_id:2458208] 将引导你深入探究静电项，通过使用两种不同的原子电荷模型来计算能量，从而让你亲身体会参数选择（如此处的电荷模型）如何显著影响最终的对接分数。", "problem": "一个蛋白质-配体复合物通过一个对接打分函数进行评估，其静电项由一个带有均匀有效相对介电常数的库仑表达式建模。具体而言，静电贡献为\n$$\nE_{\\mathrm{elec}} \\;=\\; k_e \\sum_{i \\in \\text{protein}} \\sum_{j \\in \\text{ligand}} \\frac{q_i q_j}{\\varepsilon_r r_{ij}} \\,,\n$$\n其中 $k_e = 332.06371\\ \\mathrm{kcal\\ mol^{-1}\\ \\AA\\ e^{-2}}$，$\\varepsilon_r$ 是相对介电常数，$q_i$ 和 $q_j$ 是以元电荷 $e$ 为单位的部分电荷，$r_{ij}$ 是以 $\\mathrm{\\AA}$ 为单位的原子间距。假设 $\\varepsilon_r = 4$，并仅考虑以下三个蛋白质-配体原子对及其固定几何构型：\n\n- 原子对 $1$：蛋白质赖氨酸末端氮原子 $\\mathrm{N\\zeta}$，电荷 $q_{\\mathrm{N\\zeta}} = +0.40$，与配体羰基氧的距离为 $r_1 = 3.0\\ \\mathrm{\\AA}$。\n- 原子对 $2$：蛋白质天冬氨酸羧基氧原子 $\\mathrm{O\\delta1}$，电荷 $q_{\\mathrm{O\\delta1}} = -0.50$，与配体酰胺氢的距离为 $r_2 = 2.0\\ \\mathrm{\\AA}$。\n- 原子对 $3$：蛋白质主链羰基氧原子，电荷 $q_{\\mathrm{O_{bb}}} = -0.42$，与配体羰基碳的距离为 $r_3 = 3.4\\ \\mathrm{\\AA}$。\n\n比较了两种配体电荷模型，其中蛋白质电荷和几何构型保持不变：\n\n- 配体上的Gasteiger电荷：\n  - 配体羰基氧: $q_{\\mathrm{O_{lig}}} = -0.35$，\n  - 配体酰胺氢: $q_{\\mathrm{H_{lig}}} = +0.10$，\n  - 配体羰基碳: $q_{\\mathrm{C_{lig}}} = +0.30$。\n- 配体上的带键电荷校正的Austin模型1 (AM1-BCC)电荷：\n  - 配体羰基氧: $q_{\\mathrm{O_{lig}}} = -0.55$，\n  - 配体酰胺氢: $q_{\\mathrm{H_{lig}}} = +0.20$，\n  - 配体羰基碳: $q_{\\mathrm{C_{lig}}} = +0.50$。\n\n基于这些数据，考虑以下关于在对接分数的静电分量中使用Gasteiger电荷与AM1-BCC电荷对配体的影响的陈述。选择所有正确的陈述。\n\nA. 在所述条件下，对于该复合物，使用AM1-BCC配体电荷计算的静电能比使用Gasteiger电荷更有利（更负）。\n\nB. 在所述条件下，对于该复合物，使用Gasteiger配体电荷计算的静电能比使用AM1-BCC电荷更有利（更负）。\n\nC. 如果在相同的设置下使用更大的相对介电常数（例如，将 $\\varepsilon_r$ 从 $4$ 增加到 $20$）进行评估，AM1-BCC和Gasteiger电荷计算的静电能之差的绝对值将会减小。\n\nD. 对于任何固定的蛋白质电荷集和几何构型，由静电项得出的配体排序与所使用的配体电荷模型无关，因此Gasteiger和AM1-BCC总会产生相同的排序。", "solution": "该问题陈述具有科学依据，表述清晰，客观且自洽。它描述了计算化学中用于估算蛋白质-配体复合物中静电相互作用的一种标准（尽管简化了）的计算方法。所有必需的物理常数、参数以及几何/电荷数据均已提供。不存在矛盾或模糊之处。因此，我将开始推导解决方案。\n\n指定原子对对接到分数的静电贡献由以下公式给出：\n$$\nE_{\\mathrm{elec}} \\;=\\; k_e \\sum_{k=1}^{3} \\frac{q_{\\text{prot},k} q_{\\text{lig},k}}{\\varepsilon_r r_{k}}\n$$\n其中 $k$ 是三个原子对的索引。这可以重写为：\n$$\nE_{\\mathrm{elec}} \\;=\\; \\frac{k_e}{\\varepsilon_r} \\left( \\frac{q_{\\mathrm{N\\zeta}} q_{\\mathrm{O_{lig}}}}{r_1} + \\frac{q_{\\mathrm{O\\delta1}} q_{\\mathrm{H_{lig}}}}{r_2} + \\frac{q_{\\mathrm{O_{bb}}} q_{\\mathrm{C_{lig}}}}{r_3} \\right)\n$$\n提供的常数为 $k_e = 332.06371\\ \\mathrm{kcal\\ mol^{-1}\\ \\AA\\ e^{-2}}$ 和 $\\varepsilon_r = 4$。恒定的前置因子是：\n$$\nC = \\frac{k_e}{\\varepsilon_r} = \\frac{332.06371}{4} = 83.0159275 \\ \\mathrm{kcal\\ mol^{-1}\\ \\AA\\ e^{-2}}\n$$\n蛋白质电荷和距离是固定的：\n- 原子对 $1$：$q_{\\mathrm{N\\zeta}} = +0.40$, $r_1 = 3.0\\ \\mathrm{\\AA}$\n- 原子对 $2$：$q_{\\mathrm{O\\delta1}} = -0.50$, $r_2 = 2.0\\ \\mathrm{\\AA}$\n- 原子对 $3$：$q_{\\mathrm{O_{bb}}} = -0.42$, $r_3 = 3.4\\ \\mathrm{\\AA}$\n\n我们必须计算两种给定配体电荷模型的总静电能。令 $S$ 代表括号内电荷乘积除以距离项的总和。\n\n**Gasteiger电荷的计算**\n配体原子的Gasteiger电荷为：$q_{\\mathrm{O_{lig, Gast}}} = -0.35$, $q_{\\mathrm{H_{lig, Gast}}} = +0.10$, 和 $q_{\\mathrm{C_{lig, Gast}}} = +0.30$。\n$$\nS_{\\mathrm{Gast}} = \\frac{(+0.40)(-0.35)}{3.0} + \\frac{(-0.50)(+0.10)}{2.0} + \\frac{(-0.42)(+0.30)}{3.4}\n$$\n$$\nS_{\\mathrm{Gast}} = \\frac{-0.14}{3.0} + \\frac{-0.05}{2.0} + \\frac{-0.126}{3.4}\n$$\n$$\nS_{\\mathrm{Gast}} = -0.04666\\dots - 0.025 - 0.03705\\dots \\approx -0.108726\\ e^2 \\mathrm{\\AA}^{-1}\n$$\n相应的静电能是：\n$$\nE_{\\mathrm{elec, Gast}} = C \\cdot S_{\\mathrm{Gast}} \\approx 83.0159275 \\times (-0.108726) \\approx -9.026 \\ \\mathrm{kcal\\ mol^{-1}}\n$$\n\n**AM1-BCC电荷的计算**\n配体原子的AM1-BCC电荷为：$q_{\\mathrm{O_{lig, AM1}}} = -0.55$, $q_{\\mathrm{H_{lig, AM1}}} = +0.20$, 和 $q_{\\mathrm{C_{lig, AM1}}} = +0.50$。\n$$\nS_{\\mathrm{AM1}} = \\frac{(+0.40)(-0.55)}{3.0} + \\frac{(-0.50)(+0.20)}{2.0} + \\frac{(-0.42)(+0.50)}{3.4}\n$$\n$$\nS_{\\mathrm{AM1}} = \\frac{-0.22}{3.0} + \\frac{-0.10}{2.0} + \\frac{-0.21}{3.4}\n$$\n$$\nS_{\\mathrm{AM1}} = -0.07333\\dots - 0.05 - 0.06176\\dots \\approx -0.185098\\ e^2 \\mathrm{\\AA}^{-1}\n$$\n相应的静电能是：\n$$\nE_{\\mathrm{elec, AM1}} = C \\cdot S_{\\mathrm{AM1}} \\approx 83.0159275 \\times (-0.185098) \\approx -15.366 \\ \\mathrm{kcal\\ mol^{-1}}\n$$\n\n现在，我们来评估每个陈述。\n\n**A. 在所述条件下，对于该复合物，使用AM1-BCC配体电荷计算的静电能比使用Gasteiger电荷更有利（更负）。**\n我们的计算得出 $E_{\\mathrm{elec, AM1}} \\approx -15.37 \\ \\mathrm{kcal\\ mol^{-1}}$ 和 $E_{\\mathrm{elec, Gast}} \\approx -9.03 \\ \\mathrm{kcal\\ mol^{-1}}$。由于 $-15.37  -9.03$，用AM1-BCC电荷计算出的能量确实更负，表明静电相互作用更有利。这是因为AM1-BCC模型为所涉及的配体基团产生了更极化的电荷，增强了有利的相互作用（正的蛋白质电荷与负的配体电荷，以及负的蛋白质电荷与正的配体电荷），但对于这种特定的几何构型，总体效应是总能量更负。\n结论：**正确**。\n\n**B. 在所述条件下，对于该复合物，使用Gasteiger配体电荷计算的静电能比使用AM1-BCC电荷更有利（更负）。**\n这个陈述与陈述A完全相反。我们的计算显示 $E_{\\mathrm{elec, Gast}} > E_{\\mathrm{elec, AM1}}$。使用Gasteiger电荷的能量更不负，因此更不利。\n结论：**不正确**。\n\n**C. 如果在相同的设置下使用更大的相对介电常数（例如，将 $\\varepsilon_r$ 从 $4$ 增加到 $20$）进行评估，AM1-BCC和Gasteiger电荷计算的静电能之差的绝对值将会减小。**\n让我们定义静电能的差值 $\\Delta E_{\\mathrm{elec}}$。\n$$\n\\Delta E_{\\mathrm{elec}} = E_{\\mathrm{elec, AM1}} - E_{\\mathrm{elec, Gast}} = \\frac{k_e}{\\varepsilon_r} (S_{\\mathrm{AM1}} - S_{\\mathrm{Gast}})\n$$\n这个差值的绝对值是：\n$$\n|\\Delta E_{\\mathrm{elec}}| = \\left| \\frac{k_e}{\\varepsilon_r} (S_{\\mathrm{AM1}} - S_{\\mathrm{Gast}}) \\right| = \\frac{k_e |S_{\\mathrm{AM1}} - S_{\\mathrm{Gast}}|}{\\varepsilon_r}\n$$\n由于对于给定的系统，$k_e$、$S_{\\mathrm{AM1}}$ 和 $S_{\\mathrm{Gast}}$ 都是常数，能量差的绝对值 $|\\Delta E_{\\mathrm{elec}}|$ 与相对介电常数 $\\varepsilon_r$ 成反比。因此，增加 $\\varepsilon_r$（例如，从 $4$ 增加到 $20$）将导致该差值的绝对值减小。\n对于 $\\varepsilon_r = 4$， $|\\Delta E_{\\mathrm{elec}}| \\approx |-15.366 - (-9.026)| = 6.34 \\ \\mathrm{kcal\\ mol^{-1}}$。\n对于 $\\varepsilon_r = 20$， $|\\Delta E_{\\mathrm{elec}}| = \\frac{4}{20} \\times 6.34 = 0.2 \\times 6.34 = 1.268 \\ \\mathrm{kcal\\ mol^{-1}}$。\n绝对值从 $6.34$ 减小到 $1.268 \\ \\mathrm{kcal\\ mol^{-1}}$。\n结论：**正确**。\n\n**D. 对于任何固定的蛋白质电荷集和几何构型，由静电项得出的配体排序与所使用的配体电荷模型无关，因此Gasteiger和AM1-BCC总会产生相同的排序。**\n这是一个关于普遍不变性的陈述，但它在事实上是错误的。Gasteiger和AM1-BCC是分配部分电荷的两种根本不同的方法。Gasteiger是一种基于电负性均衡的经验方法，而AM1-BCC则是从半经验量子力学计算（AM1）中推导出电荷，然后应用校正（BCC）以更好地重现高水平的从头算静电势。所得到的电荷分布可能存在显著差异，不仅在数值大小上，在整个分子中的分布模式上也可能不同。静电分数实际上是代表蛋白质静电场的向量与配体部分电荷向量之间的点积。没有任何物理定律或数学必然性规定，从不同模型为一组不同配体推导出的电荷向量，在投影到任意蛋白质的场向量上时会保持其相对顺序。可以构建一个简单的有效反例，包含两个配体和一个蛋白质，其中使用Gasteiger电荷的配体排序为A $ > $ B，而使用AM1-BCC电荷时排序变为B $ > $ A。因此，该排序不是不变的。\n结论：**不正确**。", "answer": "$$\\boxed{AC}$$", "id": "2458208"}, {"introduction": "分子对接中的评分函数总是在计算速度和物理精度之间进行权衡。快速的经验评分函数非常适合从数百万个化合物中进行初步筛选，但要从初筛得到的候选分子中找出最优的，则通常需要更精确（也更耗时）的方法。这项高级练习 [@problem_id:2458163] 模拟了一个在药物发现中非常实用的工作流程：“重新打分”（Rescoring）。你将实现一个快速的经验评分函数和一个包含极化效应、物理上更严谨的“类量子化学”评分函数。通过比较两种方法对同一组配体构象的排序，你将理解为何“重新打分”是一种强大的策略，并体会到精确预测结合模式所面临的挑战。", "problem": "给定一个固定受体口袋和单个配体的一组 $10$ 个对接配体构象，以约化单位表示。您的任务是为每个构象计算两个打分函数：一个经验对接分数和一个基于物理动机项的类量子力学（QM-like）重打分，然后使用斯皮尔曼等级相关系数比较它们的排名。所有量都是无量纲的，并以约化单位表示，其中静电前因子设为 $k_e = 1$，所有距离、能量和电荷都与此选择一致。\n\n定义和参数：\n- 有 $M$ 个受体相互作用位点，索引为 $j \\in \\{0,1,\\dots,M-1\\}$，以及 $N$ 个配体原子，索引为 $i \\in \\{0,1,\\dots,N-1\\}$。\n- 每个受体位点 $j$ 具有位置 $\\mathbf{R}_j \\in \\mathbb{R}^3$、电荷 $Q_j$、Lennard-Jones参数 $\\sigma_j$ 和 $\\varepsilon_j$、各向同性极化率 $\\alpha_j$ 以及疏水性标志 $H_j \\in \\{0,1\\}$。\n- 每个配体原子 $i$ 具有参数：内在电荷 $q_i$、Lennard-Jones参数 $\\sigma_i$ 和 $\\varepsilon_i$、各向同性极化率 $\\alpha_i$ 以及疏水性标志 $h_i \\in \\{0,1\\}$。对于每个构象 $p \\in \\{0,1,\\dots,9\\}$，该原子有一个位置 $\\mathbf{r}_{i}^{(p)} \\in \\mathbb{R}^3$。\n- 对于任何配对 $(i,j)$ 和构象 $p$，令 $r_{ij}^{(p)} = \\|\\mathbf{r}_{i}^{(p)} - \\mathbf{R}_j\\|$ 并定义Lennard-Jones组合规则 $\\sigma_{ij} = \\dfrac{\\sigma_i + \\sigma_j}{2}$ 和 $\\varepsilon_{ij} = \\sqrt{\\varepsilon_i \\varepsilon_j}$。\n\n构象 $p$ 的经验对接分数：\n- 设屏蔽静电作用使用一个距离依赖的介电常数 $\\epsilon(r) = d \\, r$，其中 $d = 4$。\n- 定义成对Lennard-Jones相互作用为\n$$\nU_{ij}^{\\mathrm{LJ}}(r) = 4 \\, \\varepsilon_{ij} \\left[ \\left(\\dfrac{\\sigma_{ij}}{r}\\right)^{12} - \\left(\\dfrac{\\sigma_{ij}}{r}\\right)^{6} \\right].\n$$\n- 定义屏蔽库仑相互作用为\n$$\nU_{ij}^{\\mathrm{el,emp}}(r) = \\dfrac{q_i Q_j}{\\epsilon(r) \\, r} = \\dfrac{q_i Q_j}{d \\, r^2}.\n$$\n- 定义疏水接触数 $C^{(p)}$ 为满足 $h_i = 1$、$H_j = 1$ 和 $r_{ij}^{(p)} \\le r_c$（截断半径 $r_c = 1.2$）的配对 $(i,j)$ 的数量。疏水性贡献为 $- \\gamma \\, C^{(p)}$，其中 $\\gamma = 0.05$。\n- 经验对接分数为\n$$\nS_{\\mathrm{emp}}^{(p)} = \\sum_{i=0}^{N-1} \\sum_{j=0}^{M-1} \\left[ U_{ij}^{\\mathrm{LJ}}\\!\\left(r_{ij}^{(p)}\\right) + U_{ij}^{\\mathrm{el,emp}}\\!\\left(r_{ij}^{(p)}\\right) \\right] - \\gamma \\, C^{(p)}.\n$$\n\n构象 $p$ 的类QM重打分：\n- 使用未屏蔽的库仑相互作用\n$$\nU_{ij}^{\\mathrm{el,qm}}(r) = \\dfrac{q_i Q_j}{r}.\n$$\n- 定义由永久受体电荷在配体原子 $i$ 处产生的电场为\n$$\n\\mathbf{E}_i^{(p)} = \\sum_{j=0}^{M-1} Q_j \\, \\dfrac{\\mathbf{r}_{i}^{(p)} - \\mathbf{R}_j}{\\left(r_{ij}^{(p)}\\right)^3}.\n$$\n- 定义由永久配体电荷在受体位点 $j$ 处产生的电场为\n$$\n\\mathbf{E}_j^{(p)} = \\sum_{i=0}^{N-1} q_i \\, \\dfrac{\\mathbf{R}_j - \\mathbf{r}_{i}^{(p)}}{\\left(r_{ij}^{(p)}\\right)^3}.\n$$\n- 极化能使用一阶诱导偶极近似：\n$$\nE_{\\mathrm{pol}}^{(p)} = -\\dfrac{1}{2}\\left( \\sum_{i=0}^{N-1} \\alpha_i \\, \\left\\|\\mathbf{E}_i^{(p)}\\right\\|^2 + \\sum_{j=0}^{M-1} \\alpha_j \\, \\left\\|\\mathbf{E}_j^{(p)}\\right\\|^2 \\right).\n$$\n- 类QM重打分能量为\n$$\nE_{\\mathrm{qm}}^{(p)} = \\sum_{i=0}^{N-1} \\sum_{j=0}^{M-1} \\left[ U_{ij}^{\\mathrm{LJ}}\\!\\left(r_{ij}^{(p)}\\right) + U_{ij}^{\\mathrm{el,qm}}\\!\\left(r_{ij}^{(p)}\\right) \\right] + E_{\\mathrm{pol}}^{(p)}.\n$$\n\n排名与相关性：\n- 对于每个打分函数，值越小越好。按分数递增的顺序对 $10$ 个构象进行排名。如果两个分数在 $\\tau = 10^{-12}$ 的容差范围内相等，则通过较小的构象索引来打破平局。\n- 使用以下公式计算两个排名之间的斯皮尔曼等级相关系数 $\\rho$\n$$\n\\rho = 1 - \\dfrac{6 \\sum_{p=0}^{9} d_p^2}{n(n^2 - 1)},\n$$\n其中 $n = 10$，$d_p$ 是在两个打分函数下分配给构象 $p$ 的排名位置（最优为 $0$）之间的差异。\n\n数据集（测试套件）：\n- 受体有 $M = 4$ 个位点，参数如下：\n  - $j = 0$: $\\mathbf{R}_0 = (0.00, 0.00, 0.00)$, $Q_0 = -0.5$, $\\sigma_0 = 1.00$, $\\varepsilon_0 = 0.20$, $\\alpha_0 = 0.10$, $H_0 = 0$。\n  - $j = 1$: $\\mathbf{R}_1 = (1.50, 0.00, 0.20)$, $Q_1 = +0.4$, $\\sigma_1 = 1.00$, $\\varepsilon_1 = 0.20$, $\\alpha_1 = 0.08$, $H_1 = 0$。\n  - $j = 2$: $\\mathbf{R}_2 = (0.00, 1.80, -0.30)$, $Q_2 = 0.0$, $\\sigma_2 = 1.20$, $\\varepsilon_2 = 0.25$, $\\alpha_2 = 0.12$, $H_2 = 1$。\n  - $j = 3$: $\\mathbf{R}_3 = (-1.40, -0.50, 0.40)$, $Q_3 = -0.2$, $\\sigma_3 = 1.10$, $\\varepsilon_3 = 0.22$, $\\alpha_3 = 0.09$, $H_3 = 1$。\n- 配体有 $N = 3$ 个原子，参数如下：\n  - $i = 0$: $q_0 = +0.3$, $\\sigma_0 = 1.00$, $\\varepsilon_0 = 0.18$, $\\alpha_0 = 0.12$, $h_0 = 0$。\n  - $i = 1$: $q_1 = -0.2$, $\\sigma_1 = 0.90$, $\\varepsilon_1 = 0.15$, $\\alpha_1 = 0.10$, $h_1 = 1$。\n  - $i = 2$: $q_2 = -0.1$, $\\sigma_2 = 0.85$, $\\varepsilon_2 = 0.14$, $\\alpha_2 = 0.09$, $h_2 = 1$。\n- $10$ 个构象 $p \\in \\{0,1,\\dots,9\\}$ 提供了 $\\mathbf{r}_i^{(p)}$：\n  - $p = 0$: $\\mathbf{r}_0^{(0)} = (0.2, 0.4, 0.1)$, $\\mathbf{r}_1^{(0)} = (0.9, 0.4, 0.1)$, $\\mathbf{r}_2^{(0)} = (0.2, 1.1, 0.1)$。\n  - $p = 1$: $\\mathbf{r}_0^{(1)} = (0.8, 0.1, 0.2)$, $\\mathbf{r}_1^{(1)} = (1.4, 0.1, 0.2)$, $\\mathbf{r}_2^{(1)} = (0.8, 0.7, 0.2)$。\n  - $p = 2$: $\\mathbf{r}_0^{(2)} = (-0.8, -0.2, 0.3)$, $\\mathbf{r}_1^{(2)} = (-0.1, -0.2, 0.3)$, $\\mathbf{r}_2^{(2)} = (-0.8, 0.5, 0.3)$。\n  - $p = 3$: $\\mathbf{r}_0^{(3)} = (0.1, 1.2, -0.1)$, $\\mathbf{r}_1^{(3)} = (0.8, 1.2, -0.1)$, $\\mathbf{r}_2^{(3)} = (0.1, 1.9, -0.1)$。\n  - $p = 4$: $\\mathbf{r}_0^{(4)} = (0.3, 0.1, 0.0)$, $\\mathbf{r}_1^{(4)} = (0.9, 0.1, 0.0)$, $\\mathbf{r}_2^{(4)} = (0.3, 0.7, 0.0)$。\n  - $p = 5$: $\\mathbf{r}_0^{(5)} = (2.5, 2.5, 0.0)$, $\\mathbf{r}_1^{(5)} = (3.2, 2.5, 0.0)$, $\\mathbf{r}_2^{(5)} = (2.5, 3.2, 0.0)$。\n  - $p = 6$: $\\mathbf{r}_0^{(6)} = (1.2, -0.1, 0.2)$, $\\mathbf{r}_1^{(6)} = (1.8, -0.1, 0.2)$, $\\mathbf{r}_2^{(6)} = (1.2, 0.6, 0.2)$。\n  - $p = 7$: $\\mathbf{r}_0^{(7)} = (-1.0, -0.6, 0.4)$, $\\mathbf{r}_1^{(7)} = (-0.3, -0.6, 0.4)$, $\\mathbf{r}_2^{(7)} = (-1.0, 0.1, 0.4)$。\n  - $p = 8$: $\\mathbf{r}_0^{(8)} = (0.1, 0.2, 0.9)$, $\\mathbf{r}_1^{(8)} = (0.8, 0.2, 0.9)$, $\\mathbf{r}_2^{(8)} = (0.1, 0.9, 0.9)$。\n  - $p = 9$: $\\mathbf{r}_0^{(9)} = (5.0, 5.0, 5.0)$, $\\mathbf{r}_1^{(9)} = (5.7, 5.0, 5.0)$, $\\mathbf{r}_2^{(9)} = (5.0, 5.7, 5.0)$。\n\n要求：\n- 使用上述定义为每个 $p \\in \\{0,\\dots,9\\}$ 计算 $S_{\\mathrm{emp}}^{(p)}$ 和 $E_{\\mathrm{qm}}^{(p)}$。\n- 分别按 $S_{\\mathrm{emp}}^{(p)}$ 和 $E_{\\mathrm{qm}}^{(p)}$ 的递增顺序对构象进行排序，生成两个排名。当分数在 $\\tau = 10^{-12}$ 容差内相等时，以较小的 $p$ 打破平局。\n- 使用提供的公式计算两个排名之间的斯皮尔曼等级相关系数 $\\rho$。\n- 最终输出格式：您的程序应生成一行输出，其中包含一个逗号分隔的列表，列表用方括号括起来，即 $[\\text{empirical\\_ranking},\\text{qm\\_ranking},\\rho]$，其中每个排名是按分数递增顺序排列的 $10$ 个构象索引的列表，$\\rho$ 以小数形式打印，小数点后保留六位。例如，结构必须像 $[[a_0,a_1,...,a_9],[b_0,b_1,...,b_9],0.123456]$。", "solution": "所呈现的问题是计算化学领域中一个明确定义的练习，特别是在分子对接和打分领域。它要求对受体口袋内的一组配体构象实现并比较两种不同的打分函数。第一个函数 $S_{\\mathrm{emp}}$ 是一个经验分数，为计算效率而设计。第二个函数 $E_{\\mathrm{qm}}$ 是一个更具物理细节的模型，包含了极化效应，旨在获得更高的准确性。我们的目标是为给定的十个构象计算这些分数，根据每个分数对构象进行排名，并使用斯皮尔曼等级相关系数 $\\rho$ 来量化这两个排名之间的一致性。\n\n整个计算在一个约化的、无量纲的单位体系中进行，其中静电前因子 $k_e$为1。所有提供的参数和坐标都与该体系一致。\n\n计算过程执行如下：\n首先，将提供的所有关于受体、配体和十个构象的数据存储在适当的数据结构中。我们有 $M=4$ 个受体位点和 $N=3$ 个配体原子。构象由 $p \\in \\{0, 1, \\dots, 9\\}$ 索引。\n\n对于每个构象 $p$，我们计算两个分数 $S_{\\mathrm{emp}}^{(p)}$ 和 $E_{\\mathrm{qm}}^{(p)}$。这涉及到遍历所有 $N \\times M$ 对配体原子 $(i)$ 和受体位点 $(j)$。\n\n对于每对 $(i, j)$，我们首先计算距离 $r_{ij}^{(p)} = \\|\\mathbf{r}_{i}^{(p)} - \\mathbf{R}_j\\|$，其中 $\\mathbf{r}_{i}^{(p)}$ 是构象 $p$ 中配体原子 $i$ 的位置，$\\mathbf{R}_j$ 是受体位点 $j$ 的位置。我们还使用提供的混合规则确定组合的Lennard-Jones参数：$\\sigma_{ij} = (\\sigma_i + \\sigma_j)/2$ 和 $\\varepsilon_{ij} = \\sqrt{\\varepsilon_i \\varepsilon_j}$。\n\nLennard-Jones势是范德华相互作用的标准模型，为每对计算：\n$$\nU_{ij}^{\\mathrm{LJ}}(r_{ij}^{(p)}) = 4 \\, \\varepsilon_{ij} \\left[ \\left(\\dfrac{\\sigma_{ij}}{r_{ij}^{(p)}}\\right)^{12} - \\left(\\dfrac{\\sigma_{ij}}{r_{ij}^{(p)}}\\right)^{6} \\right]\n$$\n该项对两个打分函数都有贡献，代表短程排斥和中程吸引。\n\n两种打分函数主要在处理静电相互作用方面有所不同。\n\n经验分数 $S_{\\mathrm{emp}}^{(p)}$ 采用简化的模型以提高计算速度。它使用一个距离依赖的介电常数 $\\epsilon(r) = d \\cdot r$（其中 $d=4$）来模拟溶剂屏蔽效应。静电相互作用为：\n$$\nU_{ij}^{\\mathrm{el,emp}}(r_{ij}^{(p)}) = \\dfrac{q_i Q_j}{d \\, (r_{ij}^{(p)})^2}\n$$\n此外，$S_{\\mathrm{emp}}^{(p)}$ 包括一个经验疏水项。我们计算疏水接触数 $C^{(p)}$，其中接触定义为具有疏水标志 $h_i=1$ 和 $H_j=1$ 且距离 $r_{ij}^{(p)} \\le r_c = 1.2$ 的配对 $(i,j)$。该项对分数的贡献为 $-\\gamma \\, C^{(p)}$，其中 $\\gamma = 0.05$。\n一个构象的总经验分数是所有配对的总和加上疏水性加成：\n$$\nS_{\\mathrm{emp}}^{(p)} = \\sum_{i=0}^{N-1} \\sum_{j=0}^{M-1} \\left[ U_{ij}^{\\mathrm{LJ}}\\!\\left(r_{ij}^{(p)}\\right) + U_{ij}^{\\mathrm{el,emp}}\\!\\left(r_{ij}^{(p)}\\right) \\right] - \\gamma \\, C^{(p)}\n$$\n\n类QM分数 $E_{\\mathrm{qm}}^{(p)}$ 旨在达到更高的物理真实性。它使用基本的未屏蔽库仑定律来处理直接的静电相互作用：\n$$\nU_{ij}^{\\mathrm{el,qm}}(r_{ij}^{(p)}) = \\dfrac{q_i Q_j}{r_{ij}^{(p)}}\n$$\n关键是，该模型还考虑了电子极化，这是一种诱导效应，即每个分子的电荷分布因另一个分子的电场而扭曲。这是使用一阶近似来计算的。首先，计算受体的永久电荷在每个配体原子 $i$ 上施加的电场：\n$$\n\\mathbf{E}_i^{(p)} = \\sum_{j=0}^{M-1} Q_j \\, \\dfrac{\\mathbf{r}_{i}^{(p)} - \\mathbf{R}_j}{\\left(r_{ij}^{(p)}\\right)^3}\n$$\n类似地，来自配体电荷的在每个受体位点 $j$ 处的电场为：\n$$\n\\mathbf{E}_j^{(p)} = \\sum_{i=0}^{N-1} q_i \\, \\dfrac{\\mathbf{R}_j - \\mathbf{r}_{i}^{(p)}}{\\left(r_{ij}^{(p)}\\right)^3}\n$$\n然后，极化能是产生这些诱导偶极子所做的功：\n$$\nE_{\\mathrm{pol}}^{(p)} = -\\dfrac{1}{2}\\left( \\sum_{i=0}^{N-1} \\alpha_i \\, \\left\\|\\mathbf{E}_i^{(p)}\\right\\|^2 + \\sum_{j=0}^{M-1} \\alpha_j \\, \\left\\|\\mathbf{E}_j^{(p)}\\right\\|^2 \\right)\n$$\n其中 $\\alpha_i$ 和 $\\alpha_j$ 是各向同性极化率。总的类QM分数是Lennard-Jones、未屏蔽库仑和极化能的总和：\n$$\nE_{\\mathrm{qm}}^{(p)} = \\sum_{i=0}^{N-1} \\sum_{j=0}^{M-1} \\left[ U_{ij}^{\\mathrm{LJ}}\\!\\left(r_{ij}^{(p)}\\right) + U_{ij}^{\\mathrm{el,qm}}\\!\\left(r_{ij}^{(p)}\\right) \\right] + E_{\\mathrm{pol}}^{(p)}\n$$\n\n在计算出 $S_{\\mathrm{emp}}^{(p)}$ 和 $E_{\\mathrm{qm}}^{(p)}$ 的 $10$ 个值之后，我们对构象进行排名。对于每个打分函数，构象按其分数的升序排列（分数越低越好）。使用一个自定义的排序比较来处理平局：如果两个分数彼此之差在容差 $\\tau = 10^{-12}$ 之内，则原始索引 $p$ 较小的构象排名更高。这将产生两个构象索引的排名列表。\n\n最后，我们使用斯皮尔曼等级相关系数 $\\rho$ 来评估这两个排名之间的相关性。对于每个构象 $p$，我们找到它在经验列表中的排名（从 $0$ 到 $9$）$\\text{rank}_{\\mathrm{emp}}(p)$，以及它在类QM列表中的排名 $\\text{rank}_{\\mathrm{qm}}(p)$。计算每个构象的排名差的平方，$d_p^2 = (\\text{rank}_{\\mathrm{emp}}(p) - \\text{rank}_{\\mathrm{qm}}(p))^2$。然后系数由下式给出：\n$$\n\\rho = 1 - \\dfrac{6 \\sum_{p=0}^{9} d_p^2}{n(n^2 - 1)}\n$$\n其中构象数 $n=10$。这个 $\\rho$ 值范围从 $+1$（完全相关）到 $-1$（完全反相关），$0$ 表示无相关性。\n\n最终输出将包括两个排序后的构象索引列表和计算出的 $\\rho$ 值，四舍五入到小数点后六位。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom functools import cmp_to_key\n\ndef solve():\n    \"\"\"\n    Computes and compares empirical and QM-like scoring functions for 10 ligand poses.\n    \"\"\"\n    \n    # --- Data Definition ---\n    # Receptor parameters (M=4 sites)\n    receptor_params = {\n        'R': np.array([\n            [0.00, 0.00, 0.00], [1.50, 0.00, 0.20], [0.00, 1.80, -0.30], [-1.40, -0.50, 0.40]\n        ]),\n        'Q': np.array([-0.5, 0.4, 0.0, -0.2]),\n        'sigma': np.array([1.00, 1.00, 1.20, 1.10]),\n        'epsilon': np.array([0.20, 0.20, 0.25, 0.22]),\n        'alpha': np.array([0.10, 0.08, 0.12, 0.09]),\n        'H': np.array([0, 0, 1, 1], dtype=int)\n    }\n    M = 4\n\n    # Ligand parameters (N=3 atoms)\n    ligand_params = {\n        'q': np.array([0.3, -0.2, -0.1]),\n        'sigma': np.array([1.00, 0.90, 0.85]),\n        'epsilon': np.array([0.18, 0.15, 0.14]),\n        'alpha': np.array([0.12, 0.10, 0.09]),\n        'h': np.array([0, 1, 1], dtype=int)\n    }\n    N = 3\n\n    # Ligand poses (10 poses, p=0..9)\n    poses = np.array([\n        [[0.2, 0.4, 0.1], [0.9, 0.4, 0.1], [0.2, 1.1, 0.1]],         # p=0\n        [[0.8, 0.1, 0.2], [1.4, 0.1, 0.2], [0.8, 0.7, 0.2]],         # p=1\n        [[-0.8, -0.2, 0.3], [-0.1, -0.2, 0.3], [-0.8, 0.5, 0.3]],    # p=2\n        [[0.1, 1.2, -0.1], [0.8, 1.2, -0.1], [0.1, 1.9, -0.1]],      # p=3\n        [[0.3, 0.1, 0.0], [0.9, 0.1, 0.0], [0.3, 0.7, 0.0]],         # p=4\n        [[2.5, 2.5, 0.0], [3.2, 2.5, 0.0], [2.5, 3.2, 0.0]],         # p=5\n        [[1.2, -0.1, 0.2], [1.8, -0.1, 0.2], [1.2, 0.6, 0.2]],       # p=6\n        [[-1.0, -0.6, 0.4], [-0.3, -0.6, 0.4], [-1.0, 0.1, 0.4]],    # p=7\n        [[0.1, 0.2, 0.9], [0.8, 0.2, 0.9], [0.1, 0.9, 0.9]],         # p=8\n        [[5.0, 5.0, 5.0], [5.7, 5.0, 5.0], [5.0, 5.7, 5.0]],         # p=9\n    ])\n    num_poses = 10\n\n    # Constants\n    d_diel = 4.0\n    gamma_hydrophobic = 0.05\n    rc_hydrophobic = 1.2\n    tau_tiebreak = 1e-12\n    \n    emp_scores = np.zeros(num_poses)\n    qm_scores = np.zeros(num_poses)\n\n    for p in range(num_poses):\n        S_emp_p = 0.0\n        E_qm_p = 0.0\n        hydrophobic_contacts = 0\n        ligand_E_fields = np.zeros((N, 3))\n        receptor_E_fields = np.zeros((M, 3))\n\n        for i in range(N):\n            for j in range(M):\n                r_vec = poses[p, i, :] - receptor_params['R'][j, :]\n                r_dist = np.linalg.norm(r_vec)\n\n                # Avoid division by zero, though not expected with this data\n                if r_dist  1e-9:\n                    S_emp_p = float('inf')\n                    E_qm_p = float('inf')\n                    continue\n\n                # Lennard-Jones parameters and energy\n                sigma_ij = (ligand_params['sigma'][i] + receptor_params['sigma'][j]) / 2.0\n                epsilon_ij = np.sqrt(ligand_params['epsilon'][i] * receptor_params['epsilon'][j])\n                ratio = sigma_ij / r_dist\n                U_lj = 4.0 * epsilon_ij * (ratio**12 - ratio**6)\n                \n                # Empirical score terms\n                U_el_emp = (ligand_params['q'][i] * receptor_params['Q'][j]) / (d_diel * r_dist**2)\n                S_emp_p += U_lj + U_el_emp\n                \n                # QM-like score terms\n                U_el_qm = (ligand_params['q'][i] * receptor_params['Q'][j]) / r_dist\n                E_qm_p += U_lj + U_el_qm\n                \n                # Hydrophobic contact\n                if ligand_params['h'][i] == 1 and receptor_params['H'][j] == 1 and r_dist = rc_hydrophobic:\n                    hydrophobic_contacts += 1\n                \n                # Electric field contributions\n                r_vec_over_r_cubed = r_vec / r_dist**3\n                ligand_E_fields[i, :] += receptor_params['Q'][j] * r_vec_over_r_cubed\n                receptor_E_fields[j, :] -= ligand_params['q'][i] * r_vec_over_r_cubed\n\n\n        # Finalize empirical score\n        S_emp_p -= gamma_hydrophobic * hydrophobic_contacts\n        emp_scores[p] = S_emp_p\n\n        # Finalize QM-like score\n        E_pol = 0.0\n        # Ligand polarization\n        E_i_norm_sq = np.sum(ligand_E_fields**2, axis=1)\n        E_pol -= 0.5 * np.sum(ligand_params['alpha'] * E_i_norm_sq)\n        # Receptor polarization\n        E_j_norm_sq = np.sum(receptor_E_fields**2, axis=1)\n        E_pol -= 0.5 * np.sum(receptor_params['alpha'] * E_j_norm_sq)\n        \n        E_qm_p += E_pol\n        qm_scores[p] = E_qm_p\n\n    # --- Ranking ---\n    def compare_scores(item1, item2):\n        score1, idx1 = item1\n        score2, idx2 = item2\n        if abs(score1 - score2) = tau_tiebreak:\n            return idx1 - idx2\n        return -1 if score1  score2 else 1\n\n    emp_scores_with_indices = [(score, i) for i, score in enumerate(emp_scores)]\n    qm_scores_with_indices = [(score, i) for i, score in enumerate(qm_scores)]\n    \n    sorted_emp = sorted(emp_scores_with_indices, key=cmp_to_key(compare_scores))\n    emp_ranking = [item[1] for item in sorted_emp]\n    \n    sorted_qm = sorted(qm_scores_with_indices, key=cmp_to_key(compare_scores))\n    qm_ranking = [item[1] for item in sorted_qm]\n\n    # --- Spearman Correlation ---\n    n = num_poses\n    emp_ranks = {pose_idx: rank for rank, pose_idx in enumerate(emp_ranking)}\n    qm_ranks = {pose_idx: rank for rank, pose_idx in enumerate(qm_ranking)}\n    \n    sum_d_sq = 0.0\n    for p in range(n):\n        d = emp_ranks[p] - qm_ranks[p]\n        sum_d_sq += d**2\n        \n    rho = 1.0 - (6.0 * sum_d_sq) / (n * (n**2 - 1))\n\n    # --- Final Output ---\n    emp_ranking_str = f\"[{','.join(map(str, emp_ranking))}]\"\n    qm_ranking_str = f\"[{','.join(map(str, qm_ranking))}]\"\n    rho_str = f\"{rho:.6f}\"\n    \n    print(f\"[{emp_ranking_str},{qm_ranking_str},{rho_str}]\")\n\n\nsolve()\n```", "id": "2458163"}]}