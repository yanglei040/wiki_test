{"hands_on_practices": [{"introduction": "要掌握可极化力场的精髓，我们必须从其基础物理学出发。第一个练习将引导你推导最简单系统中的感应能：一个可极化粒子与一个点电荷的相互作用。通过这个练习[@problem_id:2460442]，你将揭示出主导非共价极化相互作用的核心方程。", "problem": "一个电中性、各向同性、线性可极化的粒子，其极化率为 $\\alpha$，放置在真空中，距离一个固定的点电荷 $q$ 为 $r$。真空的介电常数为 $\\varepsilon_{0}$。该粒子没有永久偶极矩。假设粒子处的局域电场仅为该点电荷产生的电场，并且准静态近似成立。感生偶极矩由 $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}_{\\text{loc}}$ 定义，其中 $\\mathbf{E}_{\\text{loc}}$ 是粒子处的局域电场。\n\n仅使用这些假设和基础静电学原理，确定电荷与可极化粒子之间相互作用的感应（极化）能，并将其表示为 $q$、$\\alpha$、$r$ 和 $\\varepsilon_{0}$ 的函数。请以仅包含 $q$、$\\alpha$、$r$ 和 $\\varepsilon_{0}$ 的单一闭合形式解析表达式给出你的答案。不要进行数值计算，最终表达式中也不要包含单位。", "solution": "对问题陈述进行严格评估后，认定其有效。这是一个经典静电学中提法恰当、有科学依据的问题，包含了所有必要信息且无矛盾之处。因此，我们可以进行严谨的求解。\n\n问题要求解一个固定的点电荷 $q$ 和一个电中性、线性可极化粒子之间的相互作用感应能。给定的已知量是电荷 $q$、粒子的标量极化率 $\\alpha$、它们之间的距离 $r$ 以及真空介电常数 $\\varepsilon_{0}$。该粒子没有永久偶极矩。\n\n这种相互作用的基础是由点电荷 $q$ 产生的电场。根据库仑定律，距离电荷 $r$ 处的电场 $\\mathbf{E}$ 的大小由以下公式给出：\n$$ E = \\frac{|q|}{4\\pi\\varepsilon_0 r^2} $$\n问题陈述指出，这个由点电荷产生的场被认为是粒子处的局域场 $\\mathbf{E}_{\\text{loc}}$。因此，有 $E_{\\text{loc}} = E$。\n\n该粒子是线性可极化的，这由关系式 $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}_{\\text{loc}}$ 描述，其中 $\\boldsymbol{\\mu}$ 是感生偶极矩。由于 $\\alpha$ 是一个正的标量常数，感生偶极矩 $\\boldsymbol{\\mu}$ 始终与局域电场 $\\mathbf{E}_{\\text{loc}}$ 方向一致。\n\n该系统的总势能，我们称之为感应能 $U_{ind}$，并不仅仅是偶极子在场中的能量 $U = -\\boldsymbol{\\mu} \\cdot \\mathbf{E}$。该公式适用于永久偶极子。对于感生偶极子，我们必须考虑首先形成偶极子所需的能量。总感应能是两项之和：第一项是对粒子做功使其极化所需要的能量 $W_{pol}$，第二项是由此产生的偶极子与其产生场相互作用的能量 $U_{int}$。\n\n克服其内部恢复力对粒子做功，这部分功以势能的形式储存在粒子内部。该能量通过对功元 $d W = E' d\\mu'$ 从无极化状态积分到最终状态来计算：\n$$ W_{pol} = \\int_0^{\\mu} E' d\\mu' $$\n根据线性关系 $\\mu' = \\alpha E'$，我们可以写出 $d\\mu' = \\alpha dE'$。然后对场强进行积分：\n$$ W_{pol} = \\int_0^{E} E' (\\alpha dE') = \\alpha \\int_0^{E} E' dE' = \\frac{1}{2} \\alpha E^2 $$\n这一项代表储存在极化粒子中的能量。\n\n接下来，感生偶极子 $\\boldsymbol{\\mu}$ 与外电场 $\\mathbf{E}$ 相互作用的势能由标准公式给出：\n$$ U_{int} = -\\boldsymbol{\\mu} \\cdot \\mathbf{E} $$\n代入感生偶极子的定义 $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}$，我们得到：\n$$ U_{int} = -(\\alpha \\mathbf{E}) \\cdot \\mathbf{E} = -\\alpha E^2 $$\n总感应能是这两部分贡献之和：\n$$ U_{ind} = W_{pol} + U_{int} = \\frac{1}{2}\\alpha E^2 - \\alpha E^2 = -\\frac{1}{2}\\alpha E^2 $$\n这个结果 $U_{ind} = -\\frac{1}{2}\\alpha E^2$ 是极化现象的基石。因子 $\\frac{1}{2}$ 正确地区分了感生偶极子与永久偶极子的能量。另一种推导方法，基于将力 $\\mathbf{F} = (\\boldsymbol{\\mu} \\cdot \\nabla)\\mathbf{E}$ 从无穷远处积分到当前位置，也能得到相同的势能表达式，从而证实了其正确性。\n\n为了得到最终表达式，我们将电场强度大小的平方 $E^2$ 代入我们的能量方程。\n$$ E^2 = \\left(\\frac{|q|}{4\\pi\\varepsilon_0 r^2}\\right)^2 = \\frac{q^2}{(4\\pi\\varepsilon_0)^2 r^4} $$\n注意，能量取决于 $q^2$，因此无论电荷 $q$ 的符号如何，相互作用都是吸引力。\n\n将此代入 $U_{ind}$ 的表达式中，我们得到感应能的最终解析表达式：\n$$ U_{ind} = -\\frac{1}{2} \\alpha \\left( \\frac{q^2}{(4\\pi\\varepsilon_0)^2 r^4} \\right) = - \\frac{\\alpha q^2}{2(4\\pi\\varepsilon_0)^2 r^4} $$\n这个表达式代表了作为给定参数 $q$、$\\alpha$、$r$ 和 $\\varepsilon_0$ 函数的完整解。", "answer": "$$ \\boxed{- \\frac{\\alpha q^2}{2(4 \\pi \\varepsilon_{0})^2 r^4}} $$", "id": "2460442"}, {"introduction": "真实的分子体系包含许多相互作用的粒子，其中每个感应偶极子都会产生一个电场，反过来又会极化其邻近粒子。本练习[@problem_id:2460405]将探讨这种相互感应现象，并揭示一种被称为“极化灾变”的关键不稳定性。理解这一概念对于领会现代可极化模型中遇到的数值挑战及其解决方案（如阻尼函数）至关重要。", "problem": "您将对同一直线上的两个各向同性、可极化点粒子之间的相互感应进行建模，以说明当它们相互靠近时极化灾变的发生。每个粒子都具有各向同性的极化率，并受到一个与粒子间轴共线的均匀外部电场的作用。\n\n给定位于 $z$ 轴上的两个粒子，中心间距为 $r$，假设外部电场是均匀的，大小为 $E_0$，方向沿 $+\\hat{z}$。粒子 $i$ 上的感应偶极矩由线性响应关系 $\\mu_i = \\alpha^{\\mathrm{SI}}_i E^{\\mathrm{loc}}_i$ 定义，其中 $\\alpha^{\\mathrm{SI}}_i$ 是国际单位制（SI）中的极化率，而 $E^{\\mathrm{loc}}_i$ 是粒子 $i$ 处的局域场。对于 $z$ 轴上的两个共线偶极子，在距离 $r$ 处由偶极矩 $\\mu$ 产生的轴上电场为 $E_z = \\dfrac{2 \\mu}{4 \\pi \\varepsilon_0 r^3}$，如果 $\\mu$ 沿 $+\\hat{z}$ 方向，则电场方向也沿 $+\\hat{z}$。因此，局域场满足\n$$\nE^{\\mathrm{loc}}_1 = E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3}, \\quad\nE^{\\mathrm{loc}}_2 = E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3}.\n$$\n使用以体积单位（在化学中常用）表示的极化率与国际单位制（SI）单位之间的关系：\n$$\n\\alpha^{\\mathrm{SI}}_i = 4 \\pi \\varepsilon_0 \\, \\alpha^{\\mathrm{vol}}_i,\n$$\n其中 $\\alpha^{\\mathrm{vol}}_i$ 是一个体积，单位为 $\\mathrm{m}^3$。真空介电常数为 $\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\ \\mathrm{F\\,m^{-1}}$。使用 $1\\ \\mathrm{\\AA} = 1 \\times 10^{-10}\\ \\mathrm{m}$ 转换距离，使用 $1\\ \\mathrm{\\AA}^3 = 1 \\times 10^{-30}\\ \\mathrm{m}^3$ 转换极化率体积。以德拜（Debye）为单位报告感应偶极矩的大小，其中 $1\\ \\mathrm{D} = 3.33564 \\times 10^{-30}\\ \\mathrm{C\\,m}$。\n\n根据第一性原理，耦合线性响应方程为\n$$\n\\mu_1 = \\alpha^{\\mathrm{SI}}_1 \\left( E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3} \\right), \\qquad\n\\mu_2 = \\alpha^{\\mathrm{SI}}_2 \\left( E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3} \\right).\n$$\n对于下面的每个测试用例，确定这些方程是否对 $(\\mu_1,\\mu_2)$ 有唯一的有限解（这等价于相关的齐次系统——通过设置 $E_0 = 0$ 获得——只有平凡解）。当且仅当存在唯一的有限解时，计算其大小 $|\\mu_1|$（以德拜为单位）。如果耦合方程没有唯一的有限解（即，齐次系统有非零解），则对该测试用例返回特殊浮点值 NaN。当相关的 $2 \\times 2$ 线性算子的行列式在相对容差 $\\tau = 1 \\times 10^{-12}$ 内数值上为零时，视为齐次系统非唯一性发生。\n\n最终答案以德拜为单位表示，并四舍五入到六位有效数字。\n\n使用以下测试套件。每个测试用例是一个元组 $(\\alpha^{\\mathrm{vol}}_1[\\mathrm{\\AA}^3], \\alpha^{\\mathrm{vol}}_2[\\mathrm{\\AA}^3], r[\\mathrm{\\AA}], E_0[\\mathrm{V/m}])$：\n- 测试 $1$：$(10.0, 10.0, 5.0, 1.0 \\times 10^{8})$\n- 测试 $2$：$(10.0, 10.0, 2.75, 1.0 \\times 10^{8})$\n- 测试 $3$：$(10.0, 10.0, 2.714417617, 1.0 \\times 10^{8})$ （选择的值在机器精度内处于解析灾变阈值）\n- 测试 $4$：$(10.0, 10.0, 2.60, 1.0 \\times 10^{8})$\n- 测试 $5$：$(5.0, 50.0, 2.50, 1.0 \\times 10^{8})$\n\n最终输出格式：您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果（例如，“[x1,x2,x3,x4,x5]”）。每个 $x_k$ 必须是单个浮点数（四舍五入后的德拜单位大小）或表示 NaN 的标记“nan”。不允许有额外的字符或空格。", "solution": "该问题要求分析一个耦合线性方程组，该方程组描述了均匀外部电场中两个可极化粒子的相互感应。主要任务是确定感应偶极矩存在唯一有限解的条件，并在找到该解时计算其中一个偶极矩的大小 $|\\mu_1|$。这种现象是计算化学中极化响应的一个经典例子，解的发散对应于极化灾变。\n\n感应偶极矩 $\\mu_1$ 和 $\\mu_2$ 的控制方程如下：\n$$\n\\mu_1 = \\alpha^{\\mathrm{SI}}_1 \\left( E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3} \\right)\n$$\n$$\n\\mu_2 = \\alpha^{\\mathrm{SI}}_2 \\left( E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3} \\right)\n$$\n这里，$\\alpha^{\\mathrm{SI}}_i$ 是国际单位制（SI）中的极化率，$E_0$ 是外部电场大小，$r$ 是粒子间距离，$\\varepsilon_0$ 是真空介电常数。\n\n为了简化该系统，我们使用所提供的国际单位制极化率与体积单位极化率 $\\alpha^{\\mathrm{vol}}_i$ 之间的关系：\n$$\n\\alpha^{\\mathrm{SI}}_i = 4 \\pi \\varepsilon_0 \\, \\alpha^{\\mathrm{vol}}_i\n$$\n将此关系代入耦合方程中，得到：\n$$\n\\mu_1 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_1 \\left( E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3} \\right) = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_1 E_0 + \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\mu_2\n$$\n$$\n\\mu_2 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_2 \\left( E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3} \\right) = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_2 E_0 + \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} \\mu_1\n$$\n只要 $\\alpha^{\\mathrm{vol}}_i$ 和 $r^3$ 用一致的单位（例如 $\\mathrm{m}^3$）表示，这种简化就是有效的，从而使得比率 $\\alpha^{\\mathrm{vol}}_i/r^3$ 成为无量纲量。\n\n我们可以将这些方程重排为标准矩阵形式 $A \\mathbf{x} = \\mathbf{b}$，其中 $\\mathbf{x} = [\\mu_1, \\mu_2]^T$：\n$$\n\\mu_1 - \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\mu_2 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_1 E_0\n$$\n$$\n- \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} \\mu_1 + \\mu_2 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_2 E_0\n$$\n这对应于矩阵系统：\n$$\n\\begin{pmatrix}\n1  - \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\\\\n- \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3}  1\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mu_1 \\\\\n\\mu_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 \\\\\n4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_2\n\\end{pmatrix}\n$$\n当且仅当系数矩阵的行列式不为零时，$(\\mu_1, \\mu_2)$ 存在唯一的有限解。其行列式为：\n$$\n\\det(A) = (1)(1) - \\left(- \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\right) \\left(- \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} \\right) = 1 - \\frac{4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2}{r^6}\n$$\n极化灾变发生在 $\\det(A) = 0$ 时。问题为此条件指定了一个数值判据：如果 $|\\det(A)| \\le \\tau$（其中容差 $\\tau = 1 \\times 10^{-12}$），则认为系统没有唯一的有限解。如果满足此条件，结果为 NaN。\n\n如果 $|\\det(A)|  \\tau$，我们继续计算 $\\mu_1$。使用 Cramer 法则：\n$$\n\\mu_1 = \\frac{\\det \\begin{pmatrix} 4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1  - \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\\\ 4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_2  1 \\end{pmatrix}}{\\det(A)}\n= \\frac{(4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1)(1) - (- \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3})(4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_2)}{1 - \\frac{4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2}{r^6}}\n$$\n简化分子：\n$$\n\\text{Numerator} = 4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 \\left(1 + \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3}\\right)\n$$\n因此，$\\mu_1$ 的表达式为：\n$$\n\\mu_1 = \\frac{4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 \\left(1 + \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3}\\right)}{1 - \\frac{4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2}{r^6}}\n$$\n在计算中，正确处理单位至关重要。比率 $\\alpha^{\\mathrm{vol}}/r^3$ 和 $\\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2/r^6$ 是无量纲的，因此可以直接使用以 $\\mathrm{\\AA}^3$ 和 $\\mathrm{\\AA}$ 为单位提供的值来计算这些项。但是，前置因子 $4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1$ 必须在国际单位制中计算，以得出单位为库仑-米 ($C \\cdot m$) 的 $\\mu_1$。这需要将 $\\alpha^{\\mathrm{vol}}_1$ 从 $\\mathrm{\\AA}^3$ 转换为 $\\mathrm{m}^3$。然后将得到的单位为 C$\\cdot$m 的 $\\mu_1$ 转换为德拜 ($D$)，并将其大小 $|\\mu_1|$ 四舍五入到六位有效数字。\n\n每个测试用例的算法如下：\n1. 读取输入值：$\\alpha^{\\mathrm{vol}}_1$ [$\\mathrm{\\AA}^3$]、$\\alpha^{\\mathrm{vol}}_2$ [$\\mathrm{\\AA}^3$]、$r$ [$\\mathrm{\\AA}$] 和 $E_0$ [V/m]。\n2. 计算行列式 $D = 1 - 4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2 / r^6$。\n3. 如果 $|D| \\le 1 \\times 10^{-12}$，则解发散。此情况的结果为 NaN。\n4. 否则，使用推导出的公式计算国际单位制下的 $\\mu_1$。确保将 $\\alpha^{\\mathrm{vol}}_1$ 转换为 $\\mathrm{m}^3$ 用于计算分子中的前置因子。\n5. 取绝对值以求得大小 $|\\mu_1|$。\n6. 使用给定的转换因子 $1 \\mathrm{D} = 3.33564 \\times 10^{-30} \\mathrm{C \\cdot m}$ 将 $|\\mu_1|$ 从 C$\\cdot$m 转换为德拜。\n7. 将结果格式化为六位有效数字。\n将此过程应用于每个测试用例，以生成最终的结果列表。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the induced dipole moment for a system of two interacting\n    polarizable particles in an external electric field, checking for the\n    polarization catastrophe.\n    \"\"\"\n    # Define physical and conversion constants.\n    # Vacuum permittivity in F/m.\n    EPSILON_0 = 8.8541878128e-12\n    # Conversion from Angstrom^3 to m^3.\n    A3_TO_M3 = 1e-30\n    # Conversion from C*m to Debye.\n    C_M_TO_D = 1 / 3.33564e-30\n    # Numerical tolerance for determinant singularity.\n    TOLERANCE = 1e-12\n\n    # Define the test suite. Each tuple contains:\n    # (alpha_vol_1 [A^3], alpha_vol_2 [A^3], r [A], E_0 [V/m])\n    test_cases = [\n        (10.0, 10.0, 5.0, 1.0e8),\n        (10.0, 10.0, 2.75, 1.0e8),\n        (10.0, 10.0, 2.714417617, 1.0e8),\n        (10.0, 10.0, 2.60, 1.0e8),\n        (5.0, 50.0, 2.50, 1.0e8),\n    ]\n\n    results = []\n    \n    for alpha_v1_A3, alpha_v2_A3, r_A, E0_Vm in test_cases:\n        # The terms in the determinant calculation are dimensionless,\n        # so we can use the provided units (Angstroms) directly.\n        r6 = r_A**6\n        \n        # Calculate the determinant of the linear system's matrix.\n        det = 1.0 - (4.0 * alpha_v1_A3 * alpha_v2_A3) / r6\n        \n        # Check for polarization catastrophe against the given tolerance.\n        if abs(det) = TOLERANCE:\n            results.append(\"nan\")\n        else:\n            # Convert polarizability from Angstrom^3 to m^3 for SI calculation.\n            alpha_v1_SI = alpha_v1_A3 * A3_TO_M3\n            r3 = r_A**3\n            \n            # The term in the numerator is also dimensionless.\n            num_dimless_term = 1.0 + (2.0 * alpha_v2_A3) / r3\n            \n            # Calculate the numerator of the expression for mu_1 in SI units.\n            numerator_SI = 4.0 * np.pi * EPSILON_0 * E0_Vm * alpha_v1_SI * num_dimless_term\n            \n            # Calculate mu_1 in SI units (C*m).\n            mu1_SI = numerator_SI / det\n            \n            # Calculate the magnitude of mu_1 in Debye.\n            mu1_D_magnitude = abs(mu1_SI * C_M_TO_D)\n            \n            # Format the result to six significant digits.\n            formatted_result = f\"{mu1_D_magnitude:.6g}\"\n            results.append(formatted_result)\n\n    # Print the final list of results in the specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2460405"}, {"introduction": "在掌握了基本原理之后，我们现在可以将其应用于更真实、更复杂的场景：一个生物分子。这个实践练习[@problem_id:2460445]要求你设计一个算法，用于识别蛋白质结构中的“极化热点”。这项技能可以直接应用于分析模拟数据，并理解在哪些区域极化效应对体系能量的贡献最为关键。", "problem": "您的任务是设计一个完整、可运行的程序。该程序从基础静电学和线性响应理论出发，在给定的模型蛋白质快照中，识别出极化能最显著的残基（区域）。仅使用由永久电荷产生的电场来驱动极化，并忽略感应偶极子之间的相互感应。从已确立的原理出发：点电荷电场的矢量叠加原理，以及各向同性可极化位点的感应偶极子与局域电场之间的线性关系。基于这些原理，推导出一个仅依赖于永久电荷和位点极化率的、可计算的单位点极化能一阶度量。然后，按残基汇总这些贡献，以确定哪个残基具有最大绝对值的极化能。当数值在容差范围内相等时，选择最小的残基索引来打破僵局。使用约化静电单位，其中库仑常数 $k = 1$，因此不会出现物理单位换算因子。最终输出为残基索引，因此是无单位的整数。\n\n算法要求：\n- 将每个原子 $i$ 建模为一个位置矢量 $\\mathbf{r}_i \\in \\mathbb{R}^3$、一个永久电荷 $q_i$ 和一个各向同性极化率 $\\alpha_i \\ge 0$。\n- 定义一个残基映射，将每个原子索引 $i$ 分配给一个残基索引 $R(i) \\in \\{0,1,\\dots, M-1\\}$（共 $M$ 个残基）。\n- 仅使用由永久电荷产生的电场来定义每个可极化位点的局域电场；排除原子对其自身局域电场的任何贡献。\n- 通过将其所有原子的位点贡献相加，来汇总每个残基的一阶极化能贡献，并选择具有最大绝对值极化能的残基。如果多个残基的该值在容差 $\\varepsilon = 10^{-12}$ 范围内相等，则选择其中最小的残基索引。\n\n您的程序必须为以下每个测试用例计算结果，并将所有结果以逗号分隔的列表形式打印在单一行中，并用方括号括起来。索引是从零开始的整数。\n\n测试套件：\n- 测试用例 1（三个残基，采用带电-中性-带电的线性排列，旨在在中心残基中产生强电场）：\n  - 原子数：$6$。\n  - 位置 $\\mathbf{r}_i$（以任意约化长度单位计）：\n    - $\\mathbf{r}_0 = (0.0, 0.0, 0.0)$,\n    - $\\mathbf{r}_1 = (0.2, 0.0, 0.0)$,\n    - $\\mathbf{r}_2 = (0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_3 = (0.6, 0.0, 0.0)$,\n    - $\\mathbf{r}_4 = (1.0, 0.0, 0.0)$,\n    - $\\mathbf{r}_5 = (1.2, 0.0, 0.0)$。\n  - 电荷 $q_i$：$[+0.5, +0.3, 0.0, 0.0, -0.6, -0.3]$。\n  - 极化率 $\\alpha_i$：$[0.8, 0.5, 1.0, 1.2, 0.7, 0.4]$。\n  - 残基映射 $R(i)$：$[0, 0, 1, 1, 2, 2]$。\n  - 残基数 $M = 3$。\n- 测试用例 2（一个残基的极化率为零，强外部偶极场跨越一个中心可极化残基）：\n  - 原子数：$6$。\n  - 位置 $\\mathbf{r}_i$：\n    - $\\mathbf{r}_0 = (0.0, 0.0, 0.0)$,\n    - $\\mathbf{r}_1 = (0.1, 0.0, 0.0)$,\n    - $\\mathbf{r}_2 = (0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_3 = (0.6, 0.0, 0.0)$,\n    - $\\mathbf{r}_4 = (-0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_5 = (1.5, 0.0, 0.0)$。\n  - 电荷 $q_i$：$[0.0, 0.0, 0.0, 0.0, +1.0, -1.0]$。\n  - 极化率 $\\alpha_i$：$[0.0, 0.0, 1.0, 1.0, 0.2, 0.2]$。\n  - 残基映射 $R(i)$：$[0, 0, 1, 1, 2, 2]$。\n  - 残基数 $M = 3$。\n- 测试用例 3（两个可极化残基之间因对称性出现数值相等，通过选择最小索引来解决）：\n  - 原子数：$4$。\n  - 位置 $\\mathbf{r}_i$：\n    - $\\mathbf{r}_0 = (-0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_1 = (0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_2 = (-1.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_3 = (1.5, 0.0, 0.0)$。\n  - 电荷 $q_i$：$[0.0, 0.0, +1.0, -1.0]$。\n  - 极化率 $\\alpha_i$：$[1.0, 1.0, 0.0, 0.0]$。\n  - 残基映射 $R(i)$：$[0, 1, 2, 2]$。\n  - 残基数 $M = 3$。\n\n强制执行的实现细节：\n- 使用约化静电单位，其中 $k = 1$；距离仅通过几何因子出现，结果是无单位的索引。\n- 不涉及角度；不需要角度单位。\n- 相等情况定义为绝对差值小于或等于 $\\varepsilon = 10^{-12}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_1,r_2,r_3]$），其中每个 $r_j$ 是测试用例 $j$ 所选出的残基索引。", "solution": "问题陈述已经过验证，并被认定为有效。它在科学上基于经典静电学原理，在数学上是适定的，并为所需的计算提供了完整而无歧义的规范。因此，我们直接进行解法的推导。\n\n该系统由一组 $N$ 个原子位点组成，其中每个位点 $i$ 由一个位置矢量 $\\mathbf{r}_i \\in \\mathbb{R}^3$、一个静态部分电荷 $q_i$ 和一个各向同性标量极化率 $\\alpha_i \\ge 0$ 来表征。这些原子被分组成 $M$ 个不相交的残基，由一个从原子索引到残基索引的映射 $R(i)$ 指定。\n\n第一步是确定每个可极化位点 $i$ 处的电场。根据问题描述，这个表示为 $\\mathbf{E}_i^0$ 的电场仅由所有其他原子（$j \\neq i$）的永久电荷 $q_j$ 产生。位于 $\\mathbf{r}_j$ 的点电荷 $q_j$ 对 $\\mathbf{r}_i$ 处电场的贡献由库仑定律给出。使用指定的约化单位，其中静电常数 $k=1$，表达式为：\n$$\n\\mathbf{E}_{ij} = \\frac{q_j (\\mathbf{r}_i - \\mathbf{r}_j)}{|\\mathbf{r}_i - \\mathbf{r}_j|^3}\n$$\n根据叠加原理，由永久电荷分布在位点 $i$ 产生的总电场是所有其他位点电场的矢量和：\n$$\n\\mathbf{E}_i^0 = \\sum_{j=0, j \\neq i}^{N-1} \\mathbf{E}_{ij} = \\sum_{j=0, j \\neq i}^{N-1} \\frac{q_j (\\mathbf{r}_i - \\mathbf{r}_j)}{|\\mathbf{r}_i - \\mathbf{r}_j|^3}\n$$\n这个电场 $\\mathbf{E}_i^0$ 是“零阶”场，因为它仅源于固定的永久电荷。\n\n第二步是计算在位点 $i$ 处感应出的偶极矩 $\\mathbf{p}_i$。对于一个极化率为 $\\alpha_i$ 的各向同性位点，感应偶极子与局域电场成线性正比。问题指定了一个忽略相互极化的一阶近似。因此，感应场就是 $\\mathbf{E}_i^0$。\n$$\n\\mathbf{p}_i = \\alpha_i \\mathbf{E}_i^0\n$$\n这种近似是常见的，它定义了一个非自洽的极化模型。如果 $\\alpha_i = 0$，则不会感应出偶极子，即 $\\mathbf{p}_i = \\mathbf{0}$，该位点对极化能没有贡献。\n\n第三步是计算极化能。感应偶极子 $\\mathbf{p}_i$ 在产生它的电场 $\\mathbf{E}_i^0$ 中的势能 $U_i$ 由以下公式给出：\n$$\nU_i = -\\frac{1}{2} \\mathbf{p}_i \\cdot \\mathbf{E}_i^0\n$$\n因子 $\\frac{1}{2}$ 的出现是因为储存的能量是在可极化实体内分离电荷所做的功，而这个功随电场线性增长。代入 $\\mathbf{p}_i$ 的表达式，我们得到位点 $i$ 极化能的直接公式：\n$$\nU_i = -\\frac{1}{2} \\alpha_i |\\mathbf{E}_i^0|^2\n$$\n由于 $\\alpha_i \\ge 0$ 且 $|\\mathbf{E}_i^0|^2 \\ge 0$，位点极化能 $U_i$ 总是小于或等于零。\n\n第四步是按残基汇总这些位点层面的能量。残基 $k$ 的总极化能，记为 $U_{R_k}$，是所有属于残基 $k$ 的原子 $i$ 的极化能的标量和。设 $S_k = \\{i \\mid R(i) = k\\}$ 为残基 $k$ 中原子的索引集合。那么：\n$$\nU_{R_k} = \\sum_{i \\in S_k} U_i = \\sum_{i \\in S_k} \\left(-\\frac{1}{2} \\alpha_i |\\mathbf{E}_i^0|^2\\right)\n$$\n\n最终目标是识别出具有最大极化能绝对值 $|U_{R_k}|$ 的残基。计算流程如下：\n1. 对于一个给定的包含 $N$ 个原子和 $M$ 个残基的系统，初始化一个大小为 $M$ 的残基能量数组 $E_{\\text{res}}$，其所有元素均为零。\n2. 对从 $0$ 到 $N-1$ 的每个原子 $i$：\n    a. 如果极化率 $\\alpha_i$ 为零，其能量贡献也为零。继续处理下一个原子。\n    b. 计算电场矢量 $\\mathbf{E}_i^0 = \\sum_{j \\neq i} \\frac{q_j (\\mathbf{r}_i - \\mathbf{r}_j)}{|\\mathbf{r}_i - \\mathbf{r}_j|^3}$。\n    c. 计算该电场模的平方, $|\\mathbf{E}_i^0|^2 = \\mathbf{E}_i^0 \\cdot \\mathbf{E}_i^0$。\n    d. 计算位点极化能 $U_i = -0.5 \\times \\alpha_i \\times |\\mathbf{E}_i^0|^2$。\n    e. 确定原子 $i$ 的残基索引 $k = R(i)$。\n    f. 将该位点能量加到其所属残基的总能量中：$E_{\\text{res}}[k] = E_{\\text{res}}[k] + U_i$。\n3. 遍历所有原子后，数组 $E_{\\text{res}}$ 包含每个残基的总极化能。\n4. 计算 $E_{\\text{res}}$ 中每个元素的绝对值，以获得能量的量值。\n5. 找到最大绝对值 $U_{\\max} = \\max_k |E_{\\text{res}}[k]|$。\n6. 识别出残基索引集合 $K_{\\text{max}} = \\{k \\mid |E_{\\text{res}}[k]| \\ge U_{\\max} - \\varepsilon\\}$，其中 $\\varepsilon = 10^{-12}$ 是为浮点数比较指定的容差。\n7. 最终答案是该集合中的最小索引 $\\min(K_{\\text{max}})$。这通过在具有最大能量绝对值的残基中选择最小的残基索引来解决任何数值相等的情况。\n此流程是确定性的，并为任何有效输入提供唯一解。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all defined test cases.\n    The function encapsulates the problem's logic and prints the final result\n    in the specified format.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], [0.2, 0.0, 0.0], [0.5, 0.0, 0.0],\n                [0.6, 0.0, 0.0], [1.0, 0.0, 0.0], [1.2, 0.0, 0.0]\n            ]),\n            \"charges\": np.array([+0.5, +0.3, 0.0, 0.0, -0.6, -0.3]),\n            \"polarizabilities\": np.array([0.8, 0.5, 1.0, 1.2, 0.7, 0.4]),\n            \"residue_map\": np.array([0, 0, 1, 1, 2, 2]),\n            \"num_residues\": 3\n        },\n        # Test case 2\n        {\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], [0.1, 0.0, 0.0], [0.5, 0.0, 0.0],\n                [0.6, 0.0, 0.0], [-0.5, 0.0, 0.0], [1.5, 0.0, 0.0]\n            ]),\n            \"charges\": np.array([0.0, 0.0, 0.0, 0.0, +1.0, -1.0]),\n            \"polarizabilities\": np.array([0.0, 0.0, 1.0, 1.0, 0.2, 0.2]),\n            \"residue_map\": np.array([0, 0, 1, 1, 2, 2]),\n            \"num_residues\": 3\n        },\n        # Test case 3\n        {\n            \"positions\": np.array([\n                [-0.5, 0.0, 0.0], [0.5, 0.0, 0.0],\n                [-1.5, 0.0, 0.0], [1.5, 0.0, 0.0]\n            ]),\n            \"charges\": np.array([0.0, 0.0, +1.0, -1.0]),\n            \"polarizabilities\": np.array([1.0, 1.0, 0.0, 0.0]),\n            \"residue_map\": np.array([0, 1, 2, 2]),\n            \"num_residues\": 3\n        }\n    ]\n\n    results = []\n    TOLERANCE = 1e-12\n\n    for case in test_cases:\n        positions = case[\"positions\"]\n        charges = case[\"charges\"]\n        polarizabilities = case[\"polarizabilities\"]\n        residue_map = case[\"residue_map\"]\n        num_residues = case[\"num_residues\"]\n        \n        num_atoms = len(positions)\n        residue_energies = np.zeros(num_residues)\n\n        for i in range(num_atoms):\n            alpha_i = polarizabilities[i]\n            # If site is not polarizable, its energy contribution is zero.\n            if alpha_i == 0.0:\n                continue\n\n            pos_i = positions[i]\n            E_i = np.zeros(3)\n\n            # Sum electric field contributions from all other atoms j\n            for j in range(num_atoms):\n                if i == j:\n                    continue\n                \n                q_j = charges[j]\n                if q_j == 0.0:\n                    continue\n                    \n                pos_j = positions[j]\n                \n                # Vector from j to i\n                r_ij_vec = pos_i - pos_j\n                dist_sq = np.dot(r_ij_vec, r_ij_vec)\n                \n                # Positions are distinct in test data, so dist_sq > 0\n                dist = np.sqrt(dist_sq)\n                dist_cubed = dist_sq * dist\n                \n                # E_field = (k*q / r^3) * r_vec, with k=1\n                E_i += (q_j / dist_cubed) * r_ij_vec\n            \n            # Site polarization energy: U_i = -1/2 * alpha_i * |E_i|^2\n            E_i_mag_sq = np.dot(E_i, E_i)\n            U_i = -0.5 * alpha_i * E_i_mag_sq\n            \n            # Aggregate energy into the corresponding residue\n            res_idx = residue_map[i]\n            residue_energies[res_idx] += U_i\n            \n        # Find residue with the largest magnitude of polarization energy\n        magnitudes = np.abs(residue_energies)\n        max_magnitude = np.max(magnitudes)\n        \n        # Find the smallest index of all residues that are tied for the max magnitude\n        # within the given tolerance.\n        candidate_indices = np.where(max_magnitude - magnitudes = TOLERANCE)[0]\n        result_index = np.min(candidate_indices)\n        \n        results.append(result_index)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2460445"}]}