{"hands_on_practices": [{"introduction": "本练习将预期效用理论应用于法律和解谈判的场景。你需要推导出使原告在接受确定性赔款与承担庭审风险之间效用无差异的和解金额。这项练习旨在锻炼你将现实问题转化为效用最大化框架并进行分析求解的能力。[@problem_id:2391038]", "problem": "一位初始财富为 $W>0$ 的原告面临一个抉择：是接受一个确定的和解方案，还是继续进行诉讼。根据期望效用理论（EUT），原告使用一个恒定相对风险厌恶（CRRA）效用函数 $u(x)=\\frac{x^{1-\\gamma}}{1-\\gamma}$ 来评估结果，其中风险厌恶参数 $\\gamma>0$ 且 $\\gamma\\neq 1$，定义域为 $x>0$。\n\n如果原告接受金额为 $S\\geq 0$ 的和解，原告将产生一笔与和解相关的成本 $K_{S}\\geq 0$，并以确定的最终财富 $W+S-K_{S}$ 告终。如果原告选择继续诉讼，法院将以概率 $p\\in(0,1)$ 判给总计 $D>0$ 的损害赔偿，否则判为零。律师通过适用于总判决金额的胜诉酬金获得报酬，费率为 $c\\in(0,1)$，因此如果原告胜诉，原告将获得净损害赔偿 $(1-c)D$。继续诉讼会产生一笔由原告承担的诉讼成本 $K_{T}\\geq 0$，无论结果如何都需支付。因此，在诉讼情况下，原告的最终财富有 $p$ 的概率为 $W-K_{T}+(1-c)D$，有 $1-p$ 的概率为 $W-K_{T}$。\n\n假设所有相关的最终财富水平均为严格正数：$W-K_{T}>0$，$W-K_{T}+(1-c)D>0$ 且 $W+S-K_{S}>0$。\n\n设 $S^{\\ast}$ 表示在期望效用最大化的情况下，使原告在接受和解与进行诉讼之间无差异的和解金额。推导 $S^{\\ast}$ 关于参数 $W$、$\\gamma$、$p$、$D$、$c$、$K_{S}$ 和 $K_{T}$ 的封闭形式表达式。你的最终答案必须是单一的解析表达式。不要进行近似计算。", "solution": "在尝试求解之前，需对问题陈述进行验证。\n\n逐字提取已知条件：\n- 初始财富：$W > 0$。\n- 效用函数：$u(x) = \\frac{x^{1-\\gamma}}{1-\\gamma}$，其中 $\\gamma > 0$，$\\gamma \\neq 1$，定义域为 $x > 0$。\n- 和解金额：$S \\geq 0$。\n- 和解成本：$K_S \\geq 0$。\n- 和解后的最终财富：$W + S - K_S$。\n- 诉讼获胜概率：$p \\in (0,1)$。\n- 总损害赔偿：$D > 0$。\n- 胜诉酬金费率：$c \\in (0,1)$。\n- 净损害赔偿：$(1-c)D$。\n- 诉讼成本：$K_T \\geq 0$。\n- 诉讼获胜后的最终财富：$W - K_T + (1-c)D$。\n- 诉讼败诉后的最终财富：$W - K_T$。\n- 正值假设：$W - K_T > 0$，$W - K_T + (1-c)D > 0$ 且 $W + S - K_S > 0$。\n- 目标：推导无差异和解金额 $S^{\\ast}$ 的封闭形式表达式。\n\n该问题在科学上基于期望效用理论，这是经济学中的一个基本概念。问题提法严谨，所有必要的参数和约束都已定义，从而可以得到唯一解。语言客观而精确。所有假设，例如最终财富状态为正值，都已明确说明，以确保效用函数是良定义的。因此，该问题是有效的。我们可以开始推导。\n\n核心原则是，如果从确定选项（和解）中获得的效用等于从不确定选项（诉讼）中获得的期望效用，则原告对这两个选项无差异。\n\n设 $S^{\\ast}$ 是使原告无差异的和解金额。接受此和解的最终财富是一个确定数额，我们将其记为 $W_{S^{\\ast}}$。\n$$\nW_{S^{\\ast}} = W + S^{\\ast} - K_S\n$$\n从此确定结果中获得的效用为 $u(W_{S^{\\ast}})$。\n\n如果原告继续诉讼，结果是一个博弈。设胜诉时的最终财富为 $W_{win}$，败诉时的最终财富为 $W_{lose}$。\n$$\nW_{win} = W - K_T + (1-c)D\n$$\n$$\nW_{lose} = W - K_T\n$$\n获胜的概率是 $p$，败诉的概率是 $1-p$。诉讼的期望效用，记为 $E[u(\\text{Trial})]$，是可能结果效用的概率加权平均值。\n$$\nE[u(\\text{Trial})] = p \\cdot u(W_{win}) + (1-p) \\cdot u(W_{lose})\n$$\n因此，无差异条件是：\n$$\nu(W_{S^{\\ast}}) = E[u(\\text{Trial})]\n$$\n将指定的CRRA效用函数 $u(x) = \\frac{x^{1-\\gamma}}{1-\\gamma}$ 代入无差异条件，得到：\n$$\n\\frac{(W_{S^{\\ast}})^{1-\\gamma}}{1-\\gamma} = p \\frac{(W_{win})^{1-\\gamma}}{1-\\gamma} + (1-p) \\frac{(W_{lose})^{1-\\gamma}}{1-\\gamma}\n$$\n由于题目说明 $\\gamma \\neq 1$，分母 $(1-\\gamma)$ 非零，可以通过乘法从所有项中消去。\n$$\n(W_{S^{\\ast}})^{1-\\gamma} = p (W_{win})^{1-\\gamma} + (1-p) (W_{lose})^{1-\\gamma}\n$$\n该方程定义了确定性等价关系。项 $W_{S^{\\ast}}$ 是诉讼博弈的确定性等价财富，并根据与和解相关的成本进行了调整。为了求解 $W_{S^{\\ast}}$，我们将方程两边同时取 $\\frac{1}{1-\\gamma}$ 次幂。\n$$\nW_{S^{\\ast}} = \\left[ p (W_{win})^{1-\\gamma} + (1-p) (W_{lose})^{1-\\gamma} \\right]^{\\frac{1}{1-\\gamma}}\n$$\n现在，我们代入 $W_{S^{\\ast}}$、$W_{win}$ 和 $W_{lose}$ 的表达式：\n$$\nW + S^{\\ast} - K_S = \\left[ p (W - K_T + (1-c)D)^{1-\\gamma} + (1-p) (W - K_T)^{1-\\gamma} \\right]^{\\frac{1}{1-\\gamma}}\n$$\n最后一步是通过代数方法分离出 $S^{\\ast}$。这是一个简单的整理。\n$$\nS^{\\ast} = \\left[ p(W - K_T + (1-c)D)^{1-\\gamma} + (1-p)(W - K_T)^{1-\\gamma} \\right]^{\\frac{1}{1-\\gamma}} - W + K_S\n$$\n该表达式给出了作为给定参数函数的无差异和解金额 $S^{\\ast}$ 所需的封闭形式。所有最终财富状态均为严格正数的假设确保了所有取幂的项都是正的，从而使表达式是良定义的。", "answer": "$$\n\\boxed{\\left[ p(W - K_T + (1-c)D)^{1-\\gamma} + (1-p)(W - K_T)^{1-\\gamma} \\right]^{\\frac{1}{1-\\gamma}} - W + K_S}\n$$", "id": "2391038"}, {"introduction": "本练习将带你进入量化金融领域，应用预期效用理论评估一个复杂的结构性产品。你将学习如何处理基于连续概率分布（正态分布）的回报，并运用恒定绝对风险厌恶（CARA）效用函数的性质进行定量计算。这个练习展示了预期效用理论在现代金融风险管理中的实际应用。[@problem_id:2391039]", "problem": "一位具有恒定绝对风险规避（CARA）效用的投资者，其效用函数定义为 $U(w) = -\\exp(-\\gamma w)$，风险规避参数 $\\gamma = 3.0 \\times 10^{-6}$，正在考虑购买一份为期一年、平价发行的、基于一篮子国际股票指数的结构性票据。该投资者将其全部初始财富 $W_{0} = 1.0 \\times 10^{6}$ 用于以 $1.0 \\times 10^{6}$ 的价格购买一张该票据，并且没有其他风险或收入来源。该票据的到期收益为\n$$\nX = N \\left( 1 + \\beta \\sum_{i=1}^{3} w_{i} R_{i} \\right),\n$$\n其中名义本金 $N = 1.0 \\times 10^{6}$，$\\beta = 0.8$，权重为 $(w_{1}, w_{2}, w_{3}) = (0.5, 0.3, 0.2)$，$(R_{1}, R_{2}, R_{3})$ 分别是美国、欧洲和新兴市场指数的一年期简单回报率。假设 $(R_{1}, R_{2}, R_{3})$ 服从联合正态分布，其均值向量为\n$$\n\\boldsymbol{\\mu} = \\begin{pmatrix} 0.06 \\\\ 0.04 \\\\ 0.08 \\end{pmatrix}\n$$\n且协方差矩阵为\n$$\n\\boldsymbol{\\Sigma} = \\begin{pmatrix}\n0.0225  0.0162  0.0150 \\\\\n0.0162  0.0324  0.0225 \\\\\n0.0150  0.0225  0.0625\n\\end{pmatrix}.\n$$\n投资者的期末财富等于票据的收益，即 $W_{T} = X$。\n\n在这些假设下，计算期望效用 $\\mathbb{E}[U(W_{T})]$。将最终答案表示为一个纯数（无单位），并四舍五入至四位有效数字。", "solution": "问题陈述已经过验证，被认为是科学合理的、定义明确的、客观的。它包含了所有必要信息，没有矛盾或含糊之处。我现在开始解答。\n\n投资者的期末财富 $W_{T}$ 等于结构性票据的收益 $X$。收益由下式给出：\n$$\nW_T = X = N \\left( 1 + \\beta \\sum_{i=1}^{3} w_{i} R_{i} \\right)\n$$\n设指数篮子的加权平均回报率为 $R_p = \\sum_{i=1}^{3} w_{i} R_{i}$。期末财富可以写成 $R_p$ 的线性函数：\n$$\nW_T = N + N \\beta R_p\n$$\n回报率 $(R_1, R_2, R_3)$ 服从联合正态分布。联合正态随机变量的线性组合也是一个正态分布的随机变量。因此，$R_p$ 服从正态分布。由于 $W_T$ 是 $R_p$ 的线性变换，所以 $W_T$ 也服从正态分布，即 $W_T \\sim \\mathcal{N}(\\mu_{W_T}, \\sigma^2_{W_T})$。\n\n为了求出期望效用，我们必须首先确定该分布的参数：均值 $\\mu_{W_T} = \\mathbb{E}[W_T]$ 和方差 $\\sigma^2_{W_T} = \\text{Var}(W_T)$。\n\n期末财富的均值为：\n$$\n\\mu_{W_T} = \\mathbb{E}[N + N \\beta R_p] = N + N \\beta \\mathbb{E}[R_p]\n$$\n投资组合的期望回报率 $\\mathbb{E}[R_p]$ 是单个期望回报率的加权平均值：\n$$\n\\mathbb{E}[R_p] = \\mathbb{E}\\left[\\sum_{i=1}^{3} w_{i} R_{i}\\right] = \\sum_{i=1}^{3} w_{i} \\mathbb{E}[R_{i}] = \\mathbf{w}^T \\boldsymbol{\\mu}\n$$\n使用给定值 $\\mathbf{w} = \\begin{pmatrix} 0.5 \\\\ 0.3 \\\\ 0.2 \\end{pmatrix}$ 和 $\\boldsymbol{\\mu} = \\begin{pmatrix} 0.06 \\\\ 0.04 \\\\ 0.08 \\end{pmatrix}$：\n$$\n\\mathbb{E}[R_p] = (0.5)(0.06) + (0.3)(0.04) + (0.2)(0.08) = 0.030 + 0.012 + 0.016 = 0.058\n$$\n现在我们可以用 $N = 1.0 \\times 10^{6}$ 和 $\\beta = 0.8$ 计算 $\\mu_{W_T}$：\n$$\n\\mu_{W_T} = (1.0 \\times 10^{6}) + (1.0 \\times 10^{6})(0.8)(0.058) = 1.0 \\times 10^{6} (1 + 0.0464) = 1,046,400\n$$\n\n期末财富的方差是：\n$$\n\\sigma^2_{W_T} = \\text{Var}(N + N \\beta R_p) = (N \\beta)^2 \\text{Var}(R_p)\n$$\n投资组合回报率的方差 $\\text{Var}(R_p)$ 由下式给出：\n$$\n\\text{Var}(R_p) = \\mathbf{w}^T \\boldsymbol{\\Sigma} \\mathbf{w}\n$$\n其中 $\\boldsymbol{\\Sigma}$ 是回报率的协方差矩阵。我们计算这个二次型：\n$$\n\\mathbf{w}^T \\boldsymbol{\\Sigma} = \\begin{pmatrix} 0.5  0.3  0.2 \\end{pmatrix} \\begin{pmatrix} 0.0225  0.0162  0.0150 \\\\ 0.0162  0.0324  0.0225 \\\\ 0.0150  0.0225  0.0625 \\end{pmatrix}\n$$\n$$\n\\mathbf{w}^T \\boldsymbol{\\Sigma} = \\begin{pmatrix} (0.5)(0.0225) + (0.3)(0.0162) + (0.2)(0.0150) \\\\ (0.5)(0.0162) + (0.3)(0.0324) + (0.2)(0.0225) \\\\ (0.5)(0.0150) + (0.3)(0.0225) + (0.2)(0.0625) \\end{pmatrix}^T\n$$\n$$\n\\mathbf{w}^T \\boldsymbol{\\Sigma} = \\begin{pmatrix} 0.01125 + 0.00486 + 0.003 \\\\ 0.0081 + 0.00972 + 0.0045 \\\\ 0.0075 + 0.00675 + 0.0125 \\end{pmatrix}^T = \\begin{pmatrix} 0.01911  0.02232  0.02675 \\end{pmatrix}\n$$\n现在，我们用 $\\mathbf{w}$ 进行后乘：\n$$\n\\text{Var}(R_p) = \\mathbf{w}^T \\boldsymbol{\\Sigma} \\mathbf{w} = \\begin{pmatrix} 0.01911  0.02232  0.02675 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 0.3 \\\\ 0.2 \\end{pmatrix}\n$$\n$$\n\\text{Var}(R_p) = (0.01911)(0.5) + (0.02232)(0.3) + (0.02675)(0.2) = 0.009555 + 0.006696 + 0.005350 = 0.021601\n$$\n现在我们计算 $\\sigma^2_{W_T}$：\n$$\n\\sigma^2_{W_T} = ((1.0 \\times 10^{6})(0.8))^2 (0.021601) = (8.0 \\times 10^5)^2 (0.021601) = (6.4 \\times 10^{11})(0.021601) = 1.382464 \\times 10^{10}\n$$\n\n投资者的效用函数是 $U(W_T) = -\\exp(-\\gamma W_T)$。期望效用是 $\\mathbb{E}[U(W_T)] = \\mathbb{E}[-\\exp(-\\gamma W_T)] = -\\mathbb{E}[\\exp(-\\gamma W_T)]$。项 $\\mathbb{E}[\\exp(t W_T)]$ 是随机变量 $W_T$ 的矩生成函数（MGF）。对于一个正态分布的变量 $W_T \\sim \\mathcal{N}(\\mu_{W_T}, \\sigma^2_{W_T})$，其矩生成函数为 $M_{W_T}(t) = \\exp(\\mu_{W_T} t + \\frac{1}{2}\\sigma^2_{W_T} t^2)$。\n我们在 $t = -\\gamma$ 处计算矩生成函数：\n$$\n\\mathbb{E}[\\exp(-\\gamma W_T)] = M_{W_T}(-\\gamma) = \\exp(\\mu_{W_T}(-\\gamma) + \\frac{1}{2}\\sigma^2_{W_T}(-\\gamma)^2) = \\exp(-\\gamma \\mu_{W_T} + \\frac{1}{2}\\gamma^2 \\sigma^2_{W_T})\n$$\n因此，期望效用是：\n$$\n\\mathbb{E}[U(W_T)] = -\\exp\\left(-\\gamma \\mu_{W_T} + \\frac{1}{2}\\gamma^2 \\sigma^2_{W_T}\\right)\n$$\n代入给定值 $\\gamma = 3.0 \\times 10^{-6}$ 以及计算出的均值和方差：\n指数部分是：\n$$\n-\\gamma \\mu_{W_T} + \\frac{1}{2}\\gamma^2 \\sigma^2_{W_T} = -(3.0 \\times 10^{-6})(1,046,400) + \\frac{1}{2}(3.0 \\times 10^{-6})^2 (1.382464 \\times 10^{10})\n$$\n$$\n= -3.1392 + \\frac{1}{2}(9.0 \\times 10^{-12})(1.382464 \\times 10^{10})\n$$\n$$\n= -3.1392 + (4.5)(1.382464 \\times 10^{-2}) = -3.1392 + 0.06221088 = -3.07698912\n$$\n最后，期望效用是：\n$$\n\\mathbb{E}[U(W_T)] = -\\exp(-3.07698912) \\approx -0.04610142\n$$\n四舍五入到四位有效数字，结果是 $-0.04610$。", "answer": "$$\n\\boxed{-0.04610}\n$$", "id": "2391039"}, {"introduction": "本练习要求你通过编程来解决一个更复杂的决策问题：农户如何在利润和气候适应性之间权衡以选择作物。你将实现一个基于多属性效用函数的决策模型，以应对具有多个不确定性状态的现实挑战。这旨在培养你使用计算方法将预期效用理论应用于跨学科问题的能力。[@problem_id:2391045]", "problem": "考虑一个有限的作物集合，以 $c \\in \\{1,2,\\dots,C\\}$ 为索引，以及一个有限的气候状态集合，以 $s \\in \\{1,2,\\dots,S\\}$ 为索引。每个气候状态 $s$ 发生的概率为 $p_s$，其中 $\\sum_{s=1}^{S} p_s = 1$，并且具有一个不利严重性参数 $k_s \\in [0,1]$。一种作物 $c$ 具有基础产量 $y_c > 0$、一个抗逆性参数 $\\rho_c \\in [0,1]$ 和生产成本 $C_c \\ge 0$。市场价格为 $P > 0$。在气候状态 $s$ 下，作物 $c$ 的实现产量因子由 $1 - k_s(1 - \\rho_c)$ 给出，因此作物 $c$ 在状态 $s$ 下的状态依存利润为\n$$\nx_{c,s} \\;=\\; P \\, y_c \\, \\bigl(1 - k_s(1 - \\rho_c)\\bigr) \\;-\\; C_c.\n$$\n假设在以下参数化中，所有作物 $c$ 和状态 $s$ 的 $x_{c,s} > 0$。\n\n农场主使用期望效用评估作物选择，其状态依存效用函数结合了利润和作物抗逆性。令 $\\gamma \\ge 0$ 表示恒定相对风险厌恶(CRRA)系数，令 $\\eta \\ge 0$ 对抗逆性的贡献进行加权。对于 $\\gamma \\ne 1$，作物 $c$ 在状态 $s$ 下的每个状态的效用定义为\n$$\nu(x_{c,s},\\rho_c) \\;=\\; \\frac{x_{c,s}^{\\,1-\\gamma}}{1-\\gamma} \\;+\\; \\eta \\,\\ln\\!\\bigl(1+\\rho_c\\bigr),\n$$\n作物 $c$ 的期望效用为\n$$\n\\mathrm{EU}_c \\;=\\; \\sum_{s=1}^{S} p_s \\, u(x_{c,s},\\rho_c).\n$$\n决策问题是选择 $c^\\star \\in \\arg\\max_{c \\in \\{1,\\dots,C\\}} \\mathrm{EU}_c$。如果两种或多种作物的期望效用完全相等，则在最大化者中选择最小的索引 $c$。\n\n您的任务是编写一个完整的程序，对于以下每个独立的测试用例，返回在给定参数下使期望效用最大化的作物的 1-based 索引。\n\n测试套件：\n- 测试用例 A (基线，两种气候状态):\n  - $P = 250$, $\\gamma = 0.5$, $\\eta = 50$.\n  - 气候: $S=2$, 概率 $(p_1,p_2) = (0.7, 0.3)$, 严重性 $(k_1,k_2) = (0.0, 0.4)$.\n  - 作物: $C=3$.\n    - $c=1$: $y_1 = 4.0$, $C_1 = 400$, $\\rho_1 = 0.2$.\n    - $c=2$: $y_2 = 3.5$, $C_2 = 320$, $\\rho_2 = 0.6$.\n    - $c=3$: $y_3 = 3.8$, $C_3 = 360$, $\\rho_3 = 0.4$.\n- 测试用例 B (风险中性，忽略抗逆性):\n  - $P = 200$, $\\gamma = 0.0$, $\\eta = 0.0$.\n  - 气候: $S=2$, 概率 $(p_1,p_2) = (0.4, 0.6)$, 严重性 $(k_1,k_2) = (0.0, 0.5)$.\n  - 作物: $C=3$.\n    - $c=1$: $y_1 = 5.0$, $C_1 = 700$, $\\rho_1 = 0.9$.\n    - $c=2$: $y_2 = 4.0$, $C_2 = 400$, $\\rho_2 = 0.2$.\n    - $c=3$: $y_3 = 4.5$, $C_3 = 550$, $\\rho_3 = 0.5$.\n- 测试用例 C (单一状态，高风险厌恶，重视抗逆性):\n  - $P = 300$, $\\gamma = 2.0$, $\\eta = 20.0$.\n  - 气候: $S=1$, 概率 $(p_1) = (1.0)$, 严重性 $(k_1) = (0.7)$.\n  - 作物: $C=3$.\n    - $c=1$: $y_1 = 3.0$, $C_1 = 200$, $\\rho_1 = 0.0$.\n    - $c=2$: $y_2 = 3.4$, $C_2 = 180$, $\\rho_2 = 0.5$.\n    - $c=3$: $y_3 = 2.8$, $C_3 = 150$, $\\rho_3 = 0.9$.\n- 测试用例 D (构造的平局用例):\n  - $P = 100$, $\\gamma = 0.8$, $\\eta = 10.0$.\n  - 气候: $S=2$, 概率 $(p_1,p_2) = (0.5, 0.5)$, 严重性 $(k_1,k_2) = (0.0, 0.2)$.\n  - 作物: $C=3$.\n    - $c=1$: $y_1 = 2.0$, $C_1 = 50$, $\\rho_1 = 0.3$.\n    - $c=2$: $y_2 = 2.0$, $C_2 = 50$, $\\rho_2 = 0.3$.\n    - $c=3$: $y_3 = 1.8$, $C_3 = 60$, $\\rho_3 = 0.1$.\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例所选作物的索引，格式为逗号分隔的列表，并用方括号括起来，例如 $[c_A,c_B,c_C,c_D]$，其中每个 $c_\\cdot$ 是一个整数 $\\{1,2,3\\}$，对应于指定平局决胜规则下的最大化作物。", "solution": "该问题已经过验证，被认为是有效的。它在科学上基于期望效用理论，问题设定良好，目标明确，并通过平局决胜规则保证了唯一解，并且所有必要的参数和定义都已明确。该问题是决策理论在不确定性下的一个直接应用。\n\n决策者的目标是从有限集合 $\\{1, 2, \\dots, C\\}$ 中选择一种作物 $c$，以最大化期望效用。作物 $c$ 的期望效用表示为 $\\mathrm{EU}_c$，定义在一组气候状态 $s \\in \\{1, 2, \\dots, S\\}$ 上，每个状态以概率 $p_s$ 发生。\n\n对于 $\\gamma \\ne 1$，作物 $c$ 在状态 $s$ 下的每个状态的效用函数为：\n$$\nu(x_{c,s},\\rho_c) = \\frac{x_{c,s}^{\\,1-\\gamma}}{1-\\gamma} + \\eta \\,\\ln(1+\\rho_c)\n$$\n其中 $x_{c,s}$ 是状态依存利润，$\\rho_c$ 是作物的抗逆性，$\\gamma$ 是恒定相对风险厌恶系数，$\\eta$ 是抗逆性效用贡献的权重。利润 $x_{c,s}$ 由以下公式确定：\n$$\nx_{c,s} = P \\, y_c \\, \\bigl(1 - k_s(1 - \\rho_c)\\bigr) - C_c\n$$\n其中市场价格为 $P$，基础产量为 $y_c$，状态严重性为 $k_s$，生产成本为 $C_c$。问题陈述保证了 $x_{c,s} > 0$。\n\n作物 $c$ 的期望效用是每个状态效用的概率加权和：\n$$\n\\mathrm{EU}_c = \\sum_{s=1}^{S} p_s \\, u(x_{c,s},\\rho_c) = \\sum_{s=1}^{S} p_s \\left( \\frac{x_{c,s}^{\\,1-\\gamma}}{1-\\gamma} + \\eta \\,\\ln(1+\\rho_c) \\right)\n$$\n由于对于给定的作物 $c$，项 $\\eta \\,\\ln(1+\\rho_c)$ 在所有状态 $s$ 中是恒定的，我们可以简化表达式：\n$$\n\\mathrm{EU}_c = \\left( \\sum_{s=1}^{S} p_s \\frac{x_{c,s}^{\\,1-\\gamma}}{1-\\gamma} \\right) + \\eta \\,\\ln(1+\\rho_c) \\left( \\sum_{s=1}^{S} p_s \\right)\n$$\n鉴于 $\\sum_{s=1}^{S} p_s = 1$，表达式简化为：\n$$\n\\mathrm{EU}_c = \\left( \\sum_{s=1}^{S} p_s \\frac{x_{c,s}^{\\,1-\\gamma}}{1-\\gamma} \\right) + \\eta \\,\\ln(1+\\rho_c)\n$$\n这个公式计算上更高效。最优作物 $c^\\star$ 是使该值最大化的作物，平局则通过选择最小的作物索引来打破。\n\n我们现在将此过程应用于每个测试用例。\n\n测试用例 A：$P = 250$, $\\gamma = 0.5$, $\\eta = 50$.\n气候状态：$S=2$, 概率 $(p_1, p_2) = (0.7, 0.3)$, 严重性 $(k_1, k_2) = (0.0, 0.4)$.\n使用 $1-\\gamma = 0.5$ 来评估效用。\n\n作物 1：$y_1=4.0$, $C_1=400$, $\\rho_1=0.2$.\n$x_{1,1} = 250 \\cdot 4.0 \\cdot (1 - 0.0(1-0.2)) - 400 = 600$.\n$x_{1,2} = 250 \\cdot 4.0 \\cdot (1 - 0.4(1-0.2)) - 400 = 280$.\n$\\mathrm{EU}_1 = \\left( 0.7 \\frac{600^{0.5}}{0.5} + 0.3 \\frac{280^{0.5}}{0.5} \\right) + 50 \\ln(1+0.2) \\approx 53.448$.\n\n作物 2：$y_2=3.5$, $C_2=320$, $\\rho_2=0.6$.\n$x_{2,1} = 250 \\cdot 3.5 \\cdot (1 - 0.0(1-0.6)) - 320 = 555$.\n$x_{2,2} = 250 \\cdot 3.5 \\cdot (1 - 0.4(1-0.6)) - 320 = 415$.\n$\\mathrm{EU}_2 = \\left( 0.7 \\frac{555^{0.5}}{0.5} + 0.3 \\frac{415^{0.5}}{0.5} \\right) + 50 \\ln(1+0.6) \\approx 68.704$.\n\n作物 3：$y_3=3.8$, $C_3=360$, $\\rho_3=0.4$.\n$x_{3,1} = 250 \\cdot 3.8 \\cdot (1 - 0.0(1-0.4)) - 360 = 590$.\n$x_{3,2} = 250 \\cdot 3.8 \\cdot (1 - 0.4(1-0.4)) - 360 = 362$.\n$\\mathrm{EU}_3 = \\left( 0.7 \\frac{590^{0.5}}{0.5} + 0.3 \\frac{362^{0.5}}{0.5} \\right) + 50 \\ln(1+0.4) \\approx 62.247$.\n\n比较：$\\mathrm{EU}_2 > \\mathrm{EU}_3 > \\mathrm{EU}_1$。最优选择是 $c^\\star = 2$。\n\n测试用例 B：$P = 200$, $\\gamma = 0.0$, $\\eta = 0.0$.\n这里，$\\gamma=0$ 且 $\\eta=0$。效用函数简化为 $u(x_{c,s}) = x_{c,s}$，目标是最大化期望利润 $\\mathrm{E}[x_c] = \\sum_{s=1}^S p_s x_{c,s}$。\n气候状态：$S=2$, 概率 $(p_1, p_2) = (0.4, 0.6)$, 严重性 $(k_1, k_2) = (0.0, 0.5)$.\n\n作物 1：$y_1=5.0$, $C_1=700$, $\\rho_1=0.9$.\n$x_{1,1} = 200 \\cdot 5.0 \\cdot (1) - 700 = 300$.\n$x_{1,2} = 200 \\cdot 5.0 \\cdot (1 - 0.5(1-0.9)) - 700 = 250$.\n$\\mathrm{EU}_1 = 0.4 \\cdot 300 + 0.6 \\cdot 250 = 120 + 150 = 270$.\n\n作物 2：$y_2=4.0$, $C_2=400$, $\\rho_2=0.2$.\n$x_{2,1} = 200 \\cdot 4.0 \\cdot (1) - 400 = 400$.\n$x_{2,2} = 200 \\cdot 4.0 \\cdot (1 - 0.5(1-0.2)) - 400 = 80$.\n$\\mathrm{EU}_2 = 0.4 \\cdot 400 + 0.6 \\cdot 80 = 160 + 48 = 208$.\n\n作物 3：$y_3=4.5$, $C_3=550$, $\\rho_3=0.5$.\n$x_{3,1} = 200 \\cdot 4.5 \\cdot (1) - 550 = 350$.\n$x_{3,2} = 200 \\cdot 4.5 \\cdot (1 - 0.5(1-0.5)) - 550 = 125$.\n$\\mathrm{EU}_3 = 0.4 \\cdot 350 + 0.6 \\cdot 125 = 140 + 75 = 215$.\n\n比较：$\\mathrm{EU}_1 > \\mathrm{EU}_3 > \\mathrm{EU}_2$。最优选择是 $c^\\star = 1$。\n\n测试用例 C：$P = 300$, $\\gamma = 2.0$, $\\eta = 20.0$.\n气候状态：$S=1$, 概率 $(p_1) = (1.0)$, 严重性 $(k_1) = (0.7)$.\n这是一个确定性情况。$\\mathrm{EU}_c$ 仅仅是 $u(x_{c,1}, \\rho_c)$。\n使用 $1-\\gamma = -1$ 来评估效用，因此 $u(x, \\rho) = -x^{-1} + \\eta \\ln(1+\\rho)$。\n\n作物 1：$y_1=3.0$, $C_1=200$, $\\rho_1=0.0$.\n$x_{1,1} = 300 \\cdot 3.0 \\cdot (1 - 0.7(1-0.0)) - 200 = 70$.\n$\\mathrm{EU}_1 = -1/70 + 20 \\ln(1.0) \\approx -0.01429$.\n\n作物 2：$y_2=3.4$, $C_2=180$, $\\rho_2=0.5$.\n$x_{2,1} = 300 \\cdot 3.4 \\cdot (1 - 0.7(1-0.5)) - 180 = 483$.\n$\\mathrm{EU}_2 = -1/483 + 20 \\ln(1.5) \\approx 8.1073$.\n\n作物 3：$y_3=2.8$, $C_3=150$, $\\rho_3=0.9$.\n$x_{3,1} = 300 \\cdot 2.8 \\cdot (1 - 0.7(1-0.9)) - 150 = 631.2$.\n$\\mathrm{EU}_3 = -1/631.2 + 20 \\ln(1.9) \\approx 12.8354$.\n\n比较：$\\mathrm{EU}_3 > \\mathrm{EU}_2 > \\mathrm{EU}_1$。最优选择是 $c^\\star = 3$。\n\n测试用例 D：$P = 100$, $\\gamma = 0.8$, $\\eta = 10.0$.\n气候状态：$S=2$, 概率 $(p_1,p_2) = (0.5, 0.5)$, 严重性 $(k_1,k_2) = (0.0, 0.2)$.\n使用 $1-\\gamma = 0.2$ 来评估效用。\n\n作物 1 和 2 是相同的：$y=2.0$, $C=50$, $\\rho=0.3$。它们将有相同的期望效用。\n$x_{\\cdot,1} = 100 \\cdot 2.0 \\cdot (1) - 50 = 150$.\n$x_{\\cdot,2} = 100 \\cdot 2.0 \\cdot (1 - 0.2(1-0.3)) - 50 = 122$.\n$\\mathrm{EU}_{1,2} = \\left( 0.5 \\frac{150^{0.2}}{0.2} + 0.5 \\frac{122^{0.2}}{0.2} \\right) + 10 \\ln(1+0.3) \\approx 15.9661$.\n\n作物 3：$y_3=1.8$, $C_3=60$, $\\rho_3=0.1$.\n$x_{3,1} = 100 \\cdot 1.8 \\cdot (1) - 60 = 120$.\n$x_{3,2} = 100 \\cdot 1.8 \\cdot (1 - 0.2(1-0.1)) - 60 = 87.6$.\n$\\mathrm{EU}_3 = \\left( 0.5 \\frac{120^{0.2}}{0.2} + 0.5 \\frac{87.6^{0.2}}{0.2} \\right) + 10 \\ln(1+0.1) \\approx 13.5806$.\n\n比较：$\\mathrm{EU}_1 = \\mathrm{EU}_2 > \\mathrm{EU}_3$。最大化作物是 1 和 2。平局决胜规则要求选择最小的索引。最优选择是 $c^\\star = 1$。\n\n最终结果：\n- 测试用例 A: $c^\\star = 2$\n- 测试用例 B: $c^\\star = 1$\n- 测试用例 C: $c^\\star = 3$\n- 测试用例 D: $c^\\star = 1$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_optimal_crop(P, gamma, eta, climate, crops):\n    \"\"\"\n    Calculates the optimal crop based on expected utility maximization.\n\n    Args:\n        P (float): Market price.\n        gamma (float): CRRA coefficient.\n        eta (float): Resilience weight in utility.\n        climate (dict): Dictionary with climate state probabilities 'p' and severities 'k'.\n        crops (list): A list of dictionaries, where each dictionary defines a crop's\n                      parameters 'y' (yield), 'C' (cost), and 'rho' (resilience).\n\n    Returns:\n        int: The 1-based index of the optimal crop.\n    \"\"\"\n    num_crops = len(crops)\n    expected_utilities = np.zeros(num_crops)\n\n    p_s = np.array(climate['p'])\n    k_s = np.array(climate['k'])\n\n    for c_idx, crop_data in enumerate(crops):\n        y_c = crop_data['y']\n        C_c = crop_data['C']\n        rho_c = crop_data['rho']\n\n        # Calculate state-contingent profits x_{c,s} as a numpy array\n        # x_cs = P * y_c * (1 - k_s * (1 - rho_c)) - C_c\n        x_cs = P * y_c * (1 - k_s * (1 - rho_c)) - C_c\n\n        # The expected utility is separable into a profit component and a resilience component.\n        # EU_c = E[u(profit)] + u(resilience)\n        # This is derived from EU_c = sum(p_s * (u_profit_s + u_resilience))\n        # which simplifies to sum(p_s * u_profit_s) + u_resilience * sum(p_s)\n        # and since sum(p_s) = 1, it becomes E[u(profit)] + u(resilience).\n\n        # Calculate the expected utility from profit\n        if gamma == 0.0:\n            # For gamma = 0, u(x) = x, so EU is expected profit.\n            profit_utility_part = np.sum(p_s * x_cs)\n        else:\n            # For gamma != 1 (as per problem), u(x) = x^(1-gamma) / (1-gamma).\n            # The problem guarantees x_cs > 0.\n            profit_utility_part = np.sum(p_s * (np.power(x_cs, 1 - gamma) / (1 - gamma)))\n\n        # Calculate the utility from resilience\n        resilience_utility_part = eta * np.log(1 + rho_c)\n\n        expected_utilities[c_idx] = profit_utility_part + resilience_utility_part\n\n    # Find the crop with the maximum EU.\n    # np.argmax() returns the index of the first occurrence of the maximum value,\n    # which correctly implements the specified tie-breaking rule (select smallest index).\n    # Add 1 to convert from 0-based to 1-based index.\n    optimal_crop_index = np.argmax(expected_utilities) + 1\n    \n    return optimal_crop_index\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite for the crop selection problem.\n    \"\"\"\n    test_cases = [\n        # Test case A: baseline\n        {\n            \"P\": 250.0, \"gamma\": 0.5, \"eta\": 50.0,\n            \"climate\": {\"p\": [0.7, 0.3], \"k\": [0.0, 0.4]},\n            \"crops\": [\n                {\"y\": 4.0, \"C\": 400.0, \"rho\": 0.2},\n                {\"y\": 3.5, \"C\": 320.0, \"rho\": 0.6},\n                {\"y\": 3.8, \"C\": 360.0, \"rho\": 0.4}\n            ]\n        },\n        # Test case B: risk-neutral, resilience ignored\n        {\n            \"P\": 200.0, \"gamma\": 0.0, \"eta\": 0.0,\n            \"climate\": {\"p\": [0.4, 0.6], \"k\": [0.0, 0.5]},\n            \"crops\": [\n                {\"y\": 5.0, \"C\": 700.0, \"rho\": 0.9},\n                {\"y\": 4.0, \"C\": 400.0, \"rho\": 0.2},\n                {\"y\": 4.5, \"C\": 550.0, \"rho\": 0.5}\n            ]\n        },\n        # Test case C: single-state, high risk aversion\n        {\n            \"P\": 300.0, \"gamma\": 2.0, \"eta\": 20.0,\n            \"climate\": {\"p\": [1.0], \"k\": [0.7]},\n            \"crops\": [\n                {\"y\": 3.0, \"C\": 200.0, \"rho\": 0.0},\n                {\"y\": 3.4, \"C\": 180.0, \"rho\": 0.5},\n                {\"y\": 2.8, \"C\": 150.0, \"rho\": 0.9}\n            ]\n        },\n        # Test case D: tie case by construction\n        {\n            \"P\": 100.0, \"gamma\": 0.8, \"eta\": 10.0,\n            \"climate\": {\"p\": [0.5, 0.5], \"k\": [0.0, 0.2]},\n            \"crops\": [\n                {\"y\": 2.0, \"C\": 50.0, \"rho\": 0.3},\n                {\"y\": 2.0, \"C\": 50.0, \"rho\": 0.3},\n                {\"y\": 1.8, \"C\": 60.0, \"rho\": 0.1}\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_optimal_crop(\n            case[\"P\"], case[\"gamma\"], case[\"eta\"], case[\"climate\"], case[\"crops\"]\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2391045"}]}