{"hands_on_practices": [{"introduction": "这项练习旨在弥合抽象的Merton模型与可观察到的金融市场特征之间的鸿沟。你将探索模型的跳跃强度和大小等参数如何直接转化为资产回报中的“肥尾”或超额峰度，这是像Black-Scholes这样的纯扩散模型无法捕捉到的一个特征。通过这项实践，你将巩固对跳跃扩散模型为何对现实资产价格建模至关重要的理解 ([@problem_id:2410121])。", "problem": "考虑用于资产价格过程的 Merton 跳跃扩散模型，其中期限为 $T$ 的对数回报，记为 $X_T = \\ln(S_T/S_0)$，被建模为一个独立的布朗运动驱动的扩散部分和一个复合泊松跳跃部分之和。具体来说，假设：\n- 扩散部分的波动率参数为 $\\sigma > 0$，\n- 跳跃的到达遵循强度为 $\\lambda \\ge 0$ 的泊松过程，\n- 对数跳跃幅度是独立同分布的，服从 $Y \\sim \\mathcal{N}(m, \\delta^2)$，其中 $m \\in \\mathbb{R}$ 且 $\\delta > 0$，\n- 扩散部分和跳跃部分是独立的。\n\n要求您在此模型下，分析 $X_T$ 的隐含超额峰度的期限结构，即其作为到期日 $T$ 的函数，在不同跳跃参数下的表现。\n\n仅从以下基本原理出发：\n- 独立随机变量之和的矩生成函数等于它们各自矩生成函数的乘积，\n- 累积量生成函数是矩生成函数的自然对数，\n- 对于独立变量求和，累积量是可加的，\n- 强度为 $\\lambda$、跳跃幅度矩生成函数为 $M_Y(u)$ 的复合泊松和的累积量生成函数是 $\\lambda T \\left(M_Y(u) - 1\\right)$，\n- 二阶中心矩（方差）和四阶中心矩可以从累积量中获得，而超额峰度是标准化的四阶累积量，\n\n推导 $X_T$ 的超额峰度作为 $(\\lambda, m, \\delta, \\sigma, T)$ 的函数公式。然后实现一个程序，为下面的参数集计算其值。\n\n本任务使用的定义：\n- 对于一个方差为 $\\operatorname{Var}(X)$、四阶累积量为 $\\kappa_4$ 的随机变量，其超额峰度定义为 $\\gamma_2 = \\kappa_4 / \\operatorname{Var}(X)^2$（一个无量纲量）。\n\n重要说明：\n- $X_T$ 的漂移项不影响方差或超额峰度，因此，除了上述基本原理所要求的，您不能假设或使用任何特定的漂移参数。\n- 本问题不涉及角度。\n- 不涉及物理单位；所有输出均为纯实数。\n\n需要实现和评估的测试套件：\n- 参数集 $1$：$(\\lambda, m, \\delta, \\sigma) = (0.5, -0.1, 0.2, 0.2)$，到期日 $T \\in \\{0.1, 0.5, 1.0, 2.0\\}$（年）。\n- 参数集 $2$：$(\\lambda, m, \\delta, \\sigma) = (0.0, -0.1, 0.2, 0.2)$，到期日 $T \\in \\{0.1, 0.5, 1.0, 2.0\\}$（年）。\n- 参数集 $3$：$(\\lambda, m, \\delta, \\sigma) = (1.0, 0.0, 0.4, 0.15)$，到期日 $T \\in \\{0.01, 0.1, 1.0, 5.0\\}$（年）。\n\n您的程序必须：\n- 对于测试套件中的每个 $(\\lambda, m, \\delta, \\sigma, T)$ 组合，仅使用上面列出的基本原理计算超额峰度 $\\gamma_2$，\n- 将每个结果四舍五入到恰好 $6$ 位小数，\n- 按以下顺序将所有结果汇总到一个列表中：按 $1, 2, 3$ 的顺序迭代参数集，在每个参数集内，按上述指定的顺序迭代到期日 $T$，\n- 生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[r_1,r_2,\\dots,r_n]$），且不含空格。\n\n您的输出必须是一个四舍五入到六位小数的实数（浮点数）列表，不带任何额外的文本或格式。", "solution": "问题陈述具有科学依据，提法恰当且客观。它提出了一个计算金融领域的标准问题，该问题基于已建立的 Merton 跳跃扩散模型和概率论的基本原理。所有必要的参数和定义都已提供，并且没有内部矛盾或含糊之处。因此，该问题是有效的，并将推导出一个解决方案。\n\n目标是在 Merton 模型中，推导时间期限为 $T$ 的对数回报 $X_T = \\ln(S_T/S_0)$ 的超额峰度公式，然后为特定的参数集计算其值。推导过程将从所提供的基本原理出发。\n\n对数回报 $X_T$ 被建模为两个独立随机部分之和：一个我们记为 $D_T$ 的扩散部分，以及一个记为 $J_T$ 的复合泊松跳跃部分。因此，$X_T = D_T + J_T$。\n\n根据所提供的原理，独立随机变量之和的累积量生成函数（CGF）是它们各自 CGF 的和。设 $K_{X_T}(u)$、$K_{D_T}(u)$ 和 $K_{J_T}(u)$ 分别是 $X_T$、$D_T$ 和 $J_T$ 的 CGF。那么，$K_{X_T}(u) = K_{D_T}(u) + K_{J_T}(u)$。\n\n首先，我们描述扩散部分 $D_T$ 的 CGF。问题陈述其波动率为 $\\sigma > 0$。在长度为 $T$ 的区间上，对数回报的扩散部分（忽略不影响中心矩的漂移项）是一个缩放的维纳过程，$D_T = \\sigma W_T$，其中 $W_T \\sim \\mathcal{N}(0, T)$。因此，$D_T$ 服从正态分布，$D_T \\sim \\mathcal{N}(0, \\sigma^2 T)$。均值为 $\\mu$、方差为 $\\nu^2$ 的正态随机变量的 CGF 是 $\\mu u + \\frac{1}{2}\\nu^2 u^2$。对于 $D_T$，其 $\\mu = 0$ 且 $\\nu^2 = \\sigma^2 T$，其 CGF 为：\n$$ K_{D_T}(u) = \\frac{1}{2}\\sigma^2 T u^2 $$\n\n其次，我们描述跳跃部分 $J_T$ 的 CGF。如问题所述，对于到达强度为 $\\lambda$、跳跃幅度随机变量为 $Y$ 的复合泊松过程，其 CGF 为 $K_{J_T}(u) = \\lambda T (M_Y(u) - 1)$，其中 $M_Y(u)$ 是跳跃幅度 $Y$ 的矩生成函数（MGF）。给定跳跃幅度服从正态分布，$Y \\sim \\mathcal{N}(m, \\delta^2)$。正态随机变量 $Y$ 的 MGF 是 $M_Y(u) = E[e^{uY}] = \\exp(mu + \\frac{1}{2}\\delta^2 u^2)$。将此代入 $K_{J_T}(u)$ 的表达式中：\n$$ K_{J_T}(u) = \\lambda T \\left(\\exp\\left(mu + \\frac{1}{2}\\delta^2 u^2\\right) - 1\\right) $$\n\n对数回报 $X_T$ 的总 CGF 是这两个部分 CGF 的和：\n$$ K_{X_T}(u) = \\frac{1}{2}\\sigma^2 T u^2 + \\lambda T \\left(\\exp\\left(mu + \\frac{1}{2}\\delta^2 u^2\\right) - 1\\right) $$\n\n随机变量的累积量 $\\kappa_n$ 可通过对其 CGF 求导获得：$\\kappa_n = \\frac{d^n K(u)}{du^n}\\Big|_{u=0}$。一个更直接的方法是利用独立变量累积量的可加性：$\\kappa_n(X_T) = \\kappa_n(D_T) + \\kappa_n(J_T)$。\n\n对于正态扩散部分 $D_T \\sim \\mathcal{N}(0, \\sigma^2 T)$，唯一非零的累积量是二阶累积量，即方差：$\\kappa_2(D_T) = \\sigma^2 T$。所有其他累积量，包括四阶累积量，均为零，即 $\\kappa_4(D_T) = 0$。\n\n对于复合泊松跳跃部分 $J_T$，其 $n$ 阶累积量由 $\\kappa_n(J_T) = \\lambda T E[Y^n]$ 给出，其中 $E[Y^n]$ 是跳跃幅度 $Y \\sim \\mathcal{N}(m, \\delta^2)$ 的 $n$ 阶原点矩。我们需要二阶和四阶累积量。\n$Y$ 的二阶原点矩为 $E[Y^2] = \\operatorname{Var}(Y) + (E[Y])^2 = \\delta^2 + m^2$。\n$Y$ 的四阶原点矩为 $E[Y^4] = E[(Y-m+m)^4]$。令 $Z = Y-m \\sim \\mathcal{N}(0, \\delta^2)$，对于奇数 $k$，$E[Z^k]=0$，且 $E[Z^2]=\\delta^2$，$E[Z^4]=3\\delta^4$。则 $E[Y^4] = E[(Z+m)^4] = E[Z^4 + 4mZ^3 + 6m^2Z^2 + 4m^3Z + m^4] = E[Z^4] + 6m^2E[Z^2] + m^4 = 3\\delta^4 + 6m^2\\delta^2 + m^4$。\n因此，跳跃部分所需的累积量为：\n$$ \\kappa_2(J_T) = \\lambda T E[Y^2] = \\lambda T (m^2 + \\delta^2) $$\n$$ \\kappa_4(J_T) = \\lambda T E[Y^4] = \\lambda T (m^4 + 6m^2\\delta^2 + 3\\delta^4) $$\n\n现在我们可以求出 $X_T$ 的总累积量。\n$X_T$ 的方差是二阶累积量 $\\kappa_2(X_T)$:\n$$ \\operatorname{Var}(X_T) = \\kappa_2(X_T) = \\kappa_2(D_T) + \\kappa_2(J_T) = \\sigma^2 T + \\lambda T (m^2 + \\delta^2) $$\n$X_T$ 的四阶累积量是 $\\kappa_4(X_T)$:\n$$ \\kappa_4(X_T) = \\kappa_4(D_T) + \\kappa_4(J_T) = 0 + \\lambda T (m^4 + 6m^2\\delta^2 + 3\\delta^4) = \\lambda T (m^4 + 6m^2\\delta^2 + 3\\delta^4) $$\n\n超额峰度 $\\gamma_2$ 定义为标准化的四阶累积量，$\\gamma_2 = \\kappa_4 / \\operatorname{Var}(X)^2 = \\kappa_4 / \\kappa_2^2$。代入我们推导出的 $\\kappa_2(X_T)$ 和 $\\kappa_4(X_T)$ 的表达式：\n$$ \\gamma_2 = \\frac{\\lambda T (m^4 + 6m^2\\delta^2 + 3\\delta^4)}{\\left[\\sigma^2 T + \\lambda T (m^2 + \\delta^2)\\right]^2} $$\n从分母中提出因子 $T$：\n$$ \\gamma_2 = \\frac{\\lambda T (m^4 + 6m^2\\delta^2 + 3\\delta^4)}{T^2 \\left[\\sigma^2 + \\lambda (m^2 + \\delta^2)\\right]^2} $$\n这可以简化为超额峰度作为模型参数和时间期限 $T$ 的函数的最终公式：\n$$ \\gamma_2(\\lambda, m, \\delta, \\sigma, T) = \\frac{\\lambda (m^4 + 6m^2\\delta^2 + 3\\delta^4)}{T \\left(\\sigma^2 + \\lambda (m^2 + \\delta^2)\\right)^2} $$\n\n该公式表明，超额峰度与到期日 $T$ 成反比，并且完全由跳跃部分产生（因为如果 $\\lambda = 0$，则 $\\gamma_2 = 0$）。我们现在实现这个公式，来为给定的测试套件计算所需的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the excess kurtosis for the Merton jump-diffusion model for several\n    parameter sets and maturities.\n    \"\"\"\n    \n    # Test cases are structured as:\n    # (lambda, m, delta, sigma, list_of_T)\n    test_cases = [\n        (0.5, -0.1, 0.2, 0.2, [0.1, 0.5, 1.0, 2.0]),\n        (0.0, -0.1, 0.2, 0.2, [0.1, 0.5, 1.0, 2.0]),\n        (1.0, 0.0, 0.4, 0.15, [0.01, 0.1, 1.0, 5.0]),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        lambda_val, m, delta, sigma, T_list = case\n\n        # The formula for excess kurtosis is:\n        # gamma_2 = [lambda * E(Y^4)] / (T * (Var(X_T)/T)^2)\n        # where E(Y^4) = m^4 + 6*m^2*delta^2 + 3*delta^4\n        # and Var(X_T)/T = sigma^2 + lambda * (m^2 + delta^2)\n        \n        # Pre-compute parts of the formula that are independent of T.\n        # Handle the case where lambda is 0, which implies no jumps and zero excess kurtosis.\n        if lambda_val == 0.0:\n            for T in T_list:\n                results.append(\"0.000000\")\n            continue\n\n        # Numerator term from the formula, related to jump size moments\n        jump_moment_term = lambda_val * (m**4 + 6 * m**2 * delta**2 + 3 * delta**4)\n\n        # Denominator term (squared), representing the variance per unit time\n        variance_per_unit_time = sigma**2 + lambda_val * (m**2 + delta**2)\n        \n        # The part of the formula that is constant with respect to T\n        kurtosis_constant_C = jump_moment_term / (variance_per_unit_time**2)\n\n        for T in T_list:\n            # Excess kurtosis is inversely proportional to T\n            gamma_2 = kurtosis_constant_C / T\n            \n            # Format the result to exactly 6 decimal places as a string.\n            # Using string formatting handles rounding and ensures trailing zeros.\n            results.append(f\"{gamma_2:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2410121"}, {"introduction": "基于你对模型各组成部分的理解，本练习将其应用于一个真实的金融工具：方差互换。你将推导出方差互换的公允执行价格，它直接取决于连续扩散和随机跳跃对总方差的各自贡献。这项练习展示了Merton模型在为流行的波动率衍生品定价方面的实用价值 ([@problem_id:2410146])。", "problem": "一个股价过程在风险中性测度下被建模为 Merton 跳跃扩散过程。设 $S_t$ 表示股价，设 $X_t = \\ln S_t$ 表示股价的对数。$S_t$ 的风险中性动态由下式给出\n$$\n\\frac{dS_t}{S_{t-}} = \\left(r - q - \\lambda \\kappa \\right) dt + \\sigma \\, dW_t + (J - 1) \\, dN_t,\n$$\n其中 $r$ 是连续复利无风险利率， $q$ 是连续股息率，$\\sigma \\ge 0$ 是扩散波动率，$W_t$ 是标准布朗运动，$N_t$ 是强度为 $\\lambda \\ge 0$ 的泊松过程，$J$ 是乘性跳跃大小，其中 $\\ln J \\sim \\mathcal{N}(\\mu_J, \\delta_J^2)$ 且与 $W_t$ 和 $N_t$ 相互独立，并且 $\\kappa = \\mathbb{E}[J - 1] = e^{\\mu_J + \\tfrac{1}{2}\\delta_J^2} - 1$。所有参数均为常数。假设所有期望均在风险中性测度下计算。\n\n一份到期日为 $T$ 的方差互换在时间 $T$ 支付基于对数回报的年化已实现方差的收益：\n$$\n\\text{Payoff} = N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right),\n$$\n其中 $[X]_T$ 是 $X_t$ 在 $[0,T]$ 上的二次变分，$K$ 是约定的方差执行价（以小数而非百分比表示），$N_{\\text{var}}$ 是方差名义本金。0 时刻价格是此收益以利率 $r$ 计算的风险中性贴现期望。\n\n任务：\n1) 仅从上述模型定义以及关于二次变分和泊松过程矩的成熟事实出发，推导公平年化方差互换执行价 $K_{\\text{var}}$ 关于模型参数 $(\\sigma, \\lambda, \\mu_J, \\delta_J)$ 的表达式。\n\n2) 使用您推导的表达式编写一个程序，用于计算：\n- 公平执行价 $K_{\\text{var}}$，以及\n- 对于给定的约定执行价 $K$ 和方差名义本金 $N_{\\text{var}}$，一份方差互换的 0 时刻现值 $\\text{PV}_0$，使用风险中性贴现因子 $e^{-rT}$，其中收益为 $N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right)$。\n\n所有与利率、波动率、强度和执行价相关的输入都必须以小数形式提供（例如，对于 20% 的扩散波动率，输入 $\\sigma = 0.2$）。不涉及任何物理单位或角度。所有输出必须四舍五入到 10 位小数。\n\n测试集：\n使用以下五个参数组，每个参数组指定为 $(\\sigma, \\lambda, \\mu_J, \\delta_J, T, r, q, K, N_{\\text{var}})$，所有条目均为小数：\n- 案例 A: $(0.2, 0.5, -0.1, 0.2, 1.0, 0.03, 0.0, 0.06, 10000)$\n- 案例 B: $(0.3, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.09, 7500)$\n- 案例 C: $(0.0, 1.2, 0.05, 0.3, 0.5, 0.01, 0.0, 0.12, 5000)$\n- 案例 D: $(0.25, 0.05, -0.2, 0.0, 1.5, 0.05, 0.0, 0.0645, 8000)$\n- 案例 E: $(0.15, 0.4, -0.02, 0.1, 3.0, 0.07, 0.02, 0.02, 12000)$\n\n输出规格：\n您的程序应生成单行输出，其中包含所有测试案例的结果，格式为一个用方括号括起来的逗号分隔列表，其中每个测试案例的结果本身是一个包含两个浮点数 $[K_{\\text{var}}, \\text{PV}_0]$ 的列表，两者均四舍五入到 10 位小数。例如：\n\"[[Kvar_A,PV_A],[Kvar_B,PV_B],[Kvar_C,PV_C],[Kvar_D,PV_D],[Kvar_E,PV_E]]\"。", "solution": "问题陈述需经过验证。\n\n### 步骤 1：提取已知条件\n- **模型**：风险中性测度下的 Merton 跳跃扩散模型，用于股价 $S_t$。\n- **股价动态**：\n$$\n\\frac{dS_t}{S_{t-}} = \\left(r - q - \\lambda \\kappa \\right) dt + \\sigma \\, dW_t + (J - 1) \\, dN_t\n$$\n- **对数价格**：$X_t = \\ln S_t$。\n- **参数**：\n  - $r$：连续复利无风险利率。\n  - $q$：连续股息率。\n  - $\\sigma \\ge 0$：扩散波动率。\n  - $W_t$：标准布朗运动。\n  - $N_t$：强度为 $\\lambda \\ge 0$ 的泊松过程。\n  - $J$：乘性跳跃大小，其中 $\\ln J \\sim \\mathcal{N}(\\mu_J, \\delta_J^2)$。\n  - $\\kappa = \\mathbb{E}[J - 1] = e^{\\mu_J + \\tfrac{1}{2}\\delta_J^2} - 1$。\n- **假设**：$J$ 与 $W_t$ 和 $N_t$ 相互独立。所有期望均在风险中性测度下计算。所有参数均为常数。\n- **方差互换收益**：在到期日 $T$ 支付 $N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right)$。\n  - $[X]_T$：$X_t$ 在 $[0,T]$ 上的二次变分。\n  - $K$：约定的方差执行价。\n  - $N_{\\text{var}}$：方差名义本金。\n- **任务 1**：推导公平年化方差互换执行价 $K_{\\text{var}}$ 关于参数 $(\\sigma, \\lambda, \\mu_J, \\delta_J)$ 的表达式。\n- **任务 2**：编写程序计算 $K_{\\text{var}}$ 和方差互换的 0 时刻现值 $\\text{PV}_0$。\n- **测试集**：提供了五个参数组：$(\\sigma, \\lambda, \\mu_J, \\delta_J, T, r, q, K, N_{\\text{var}})$。\n  - 案例 A: $(0.2, 0.5, -0.1, 0.2, 1.0, 0.03, 0.0, 0.06, 10000)$\n  - 案例 B: $(0.3, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.09, 7500)$\n  - 案例 C: $(0.0, 1.2, 0.05, 0.3, 0.5, 0.01, 0.0, 0.12, 5000)$\n  - 案例 D: $(0.25, 0.05, -0.2, 0.0, 1.5, 0.05, 0.0, 0.0645, 8000)$\n  - 案例 E: $(0.15, 0.4, -0.02, 0.1, 3.0, 0.07, 0.02, 0.02, 12000)$\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：Merton 跳跃扩散模型是现代量化金融的基石。方差互换的定义、其基于对数回报二次变分的收益结构以及风险中性定价都是标准且成熟的概念。该问题牢固地植根于金融数学。\n- **适定性**：问题提供了一套完整的模型参数，并要求推导特定的、明确定义的量（$K_{\\text{var}}$ 和 $\\text{PV}_0$）。任务清晰，并且基于标准理论存在唯一解。\n- **客观性**：问题以精确、形式化的数学语言陈述，没有任何主观性或模糊性。\n- **一致性与完整性**：模型被完全指定。补偿项 $\\lambda \\kappa$ 的定义与贴现后资产价格在风险中性测度下是鞅的要求一致。计算所需的所有参数都在测试集中提供。问题是自洽且内部一致的。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。这是一个计算金融学中标准的、适定的问题，需要基于随机微积分进行严谨的推导。将提供解答。\n\n### 推导与求解\n求解过程分三步进行：首先，我们推导对数价格 $X_t$ 的动态过程；其次，我们推导 $X_t$ 的预期二次变分以找到公平方差执行价 $K_{\\text{var}}$；第三，我们推导方差互换的现值。\n\n**1. 对数价格 $X_t$ 的动态过程**\n\n我们从股价 $S_t$ 的随机微分方程（SDE）开始：\n$$\ndS_t = S_{t-} \\left(r - q - \\lambda \\kappa \\right) dt + S_{t-} \\sigma \\, dW_t + S_{t-} (J - 1) \\, dN_t\n$$\n为了找到 $X_t = \\ln S_t$ 的动态过程，我们应用跳跃扩散过程的 Itô 引理。对于函数 $f(S_t)$，其动态过程由下式给出：\n$$\ndf(S_t) = \\frac{\\partial f}{\\partial S_{t-}} dS_t^c + \\frac{1}{2} \\frac{\\partial^2 f}{\\partial S_{t-}^2} (dS_t^c)^2 + \\left[ f(S_t) - f(S_{t-}) \\right] dN_t\n$$\n这里，$f(S) = \\ln S$，因此 $\\frac{\\partial f}{\\partial S} = \\frac{1}{S}$ 且 $\\frac{\\partial^2 f}{\\partial S^2} = -\\frac{1}{S^2}$。动态的连续部分是 $dS_t^c = S_{t-}(r - q - \\lambda \\kappa) dt + S_{t-} \\sigma dW_t$。连续部分的二次变分是 $(dS_t^c)^2 = (S_{t-} \\sigma dW_t)^2 = S_{t-}^2 \\sigma^2 dt$。\n\n在发生跳跃时，价格从 $S_{t-}$ 变为 $S_t = S_{t-} J$。对数价格的变化是 $\\Delta X_t = \\ln(S_t) - \\ln(S_{t-}) = \\ln(S_{t-}J) - \\ln(S_{t-}) = \\ln J$。\n\n将这些代入 Itô 公式：\n$$\ndX_t = \\frac{1}{S_{t-}} \\left[ S_{t-} \\left(r - q - \\lambda \\kappa \\right) dt + S_{t-} \\sigma \\, dW_t \\right] + \\frac{1}{2} \\left( -\\frac{1}{S_{t-}^2} \\right) S_{t-}^2 \\sigma^2 dt + \\ln J \\, dN_t\n$$\n简化表达式得到对数价格 $X_t$ 的 SDE：\n$$\ndX_t = \\left( r - q - \\lambda \\kappa - \\frac{1}{2}\\sigma^2 \\right) dt + \\sigma dW_t + \\ln J \\, dN_t\n$$\n\n**2. 公平方差执行价 $K_{\\text{var}}$**\n\n公平执行价 $K_{\\text{var}}$ 是使互换初始价值为零的 $K$ 值。这等价于风险中性下的预期年化已实现方差：\n$$\nK_{\\text{var}} = \\frac{1}{T} \\mathbb{E} \\left[ [X]_T \\right]\n$$\n跳跃扩散过程 $X_t$ 的二次变分 $[X]_T$ 是连续（布朗）部分的二次变分与跳跃平方和之和：\n$$\n[X]_T = \\left[ \\int_0^T \\sigma dW_t \\right]_T + \\left[ \\sum_{i=1}^{N_T} \\ln J_i \\right]_T = \\int_0^T \\sigma^2 dt + \\sum_{i=1}^{N_T} (\\ln J_i)^2\n$$\n由于 $\\sigma$ 是常数，上式简化为：\n$$\n[X]_T = \\sigma^2 T + \\sum_{i=1}^{N_T} (\\ln J_i)^2\n$$\n现在，我们在风险中性测度下取期望。根据期望的线性性质：\n$$\n\\mathbb{E} \\left[ [X]_T \\right] = \\mathbb{E}[\\sigma^2 T] + \\mathbb{E}\\left[ \\sum_{i=1}^{N_T} (\\ln J_i)^2 \\right] = \\sigma^2 T + \\mathbb{E}\\left[ \\sum_{i=1}^{N_T} (\\ln J_i)^2 \\right]\n$$\n第二项是随机和的期望。使用全期望定律（以 $N_T$ 为条件），其中跳跃大小 $(\\ln J_i)^2$ 与跳跃次数 $N_T$ 无关：\n$$\n\\mathbb{E}\\left[ \\sum_{i=1}^{N_T} (\\ln J_i)^2 \\right] = \\mathbb{E}[N_T] \\mathbb{E}[(\\ln J)^2]\n$$\n对于强度为 $\\lambda$ 的泊松过程，$\\mathbb{E}[N_T] = \\lambda T$。\n对于跳跃部分，我们已知 $\\ln J \\sim \\mathcal{N}(\\mu_J, \\delta_J^2)$。一个正态随机变量 $Z \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 的二阶矩是 $\\mathbb{E}[Z^2] = \\text{Var}(Z) + (\\mathbb{E}[Z])^2 = \\sigma^2 + \\mu^2$。\n因此，$\\mathbb{E}[(\\ln J)^2] = \\delta_J^2 + \\mu_J^2$。\n\n将这些结果代回：\n$$\n\\mathbb{E} \\left[ [X]_T \\right] = \\sigma^2 T + (\\lambda T) (\\mu_J^2 + \\delta_J^2)\n$$\n最后，我们通过除以 $T$ 来找到公平年化方差执行价 $K_{\\text{var}}$：\n$$\nK_{\\text{var}} = \\frac{1}{T} \\left( \\sigma^2 T + \\lambda T (\\mu_J^2 + \\delta_J^2) \\right)\n$$\n$$\nK_{\\text{var}} = \\sigma^2 + \\lambda (\\mu_J^2 + \\delta_J^2)\n$$\n正如预期，在此模型下，该表达式与 $T$、$r$ 和 $q$ 无关。\n\n**3. 方差互换的现值 $\\text{PV}_0$**\n\n方差互换的 0 时刻价格，或现值 $\\text{PV}_0$，是其收益的贴现风险中性期望：\n$$\n\\text{PV}_0 = e^{-rT} \\mathbb{E} \\left[ N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right) \\right]\n$$\n利用期望的线性性质并提出常数：\n$$\n\\text{PV}_0 = e^{-rT} N_{\\text{var}} \\left( \\frac{1}{T} \\mathbb{E} \\left[ [X]_T \\right] - K \\right)\n$$\n我们已经证明 $\\frac{1}{T} \\mathbb{E} \\left[ [X]_T \\right] = K_{\\text{var}}$。因此，现值为：\n$$\n\\text{PV}_0 = e^{-rT} N_{\\text{var}} (K_{\\text{var}} - K)\n$$\n\n这些推导出的公式将在程序中实现。\n- 公平执行价：$K_{\\text{var}} = \\sigma^2 + \\lambda (\\mu_J^2 + \\delta_J^2)$\n- 现值：$\\text{PV}_0 = N_{\\text{var}} (K_{\\text{var}} - K) e^{-rT}$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the fair variance strike and present value of a variance swap\n    under the Merton jump-diffusion model for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, lam, mu_J, delta_J, T, r, q, K, N_var)\n    test_cases = [\n        (0.2, 0.5, -0.1, 0.2, 1.0, 0.03, 0.0, 0.06, 10000),     # Case A\n        (0.3, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.09, 7500),      # Case B\n        (0.0, 1.2, 0.05, 0.3, 0.5, 0.01, 0.0, 0.12, 5000),    # Case C\n        (0.25, 0.05, -0.2, 0.0, 1.5, 0.05, 0.0, 0.0645, 8000),# Case D\n        (0.15, 0.4, -0.02, 0.1, 3.0, 0.07, 0.02, 0.02, 12000),   # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack the parameters for the current test case.\n        # The dividend yield 'q' is part of the model definition but does not\n        # affect the quadratic variation of the log-price, so it is not used in the final formulas.\n        sigma, lam, mu_J, delta_J, T, r, q, K, N_var = case\n\n        # 1. Calculate the fair annualized variance swap strike (K_var).\n        # The formula is K_var = sigma^2 + lambda * (mu_J^2 + delta_J^2).\n        # This represents the annualized expected quadratic variation of log-returns.\n        # It is the sum of the variance from the continuous diffusion part (sigma^2)\n        # and the variance from the jump part (lambda * E[(ln J)^2]).\n        \n        # contribution from jumps is jump frequency * expected squared log-jump size\n        jump_variance_contribution = lam * (mu_J**2 + delta_J**2)\n        \n        # fair strike is sum of diffusion variance and jump variance\n        k_var = sigma**2 + jump_variance_contribution\n\n        # 2. Calculate the time-0 present value (PV_0) of the variance swap.\n        # The formula is PV_0 = N_var * (K_var - K) * exp(-r*T).\n        # This is the discounted risk-neutral expectation of the swap's payoff.\n        \n        pv_0 = N_var * (k_var - K) * np.exp(-r * T)\n\n        # Round the results to 10 decimal places as required.\n        k_var_rounded = round(k_var, 10)\n        pv_0_rounded = round(pv_0, 10)\n        \n        results.append([k_var_rounded, pv_0_rounded])\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list is used to format each pair.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2410146"}, {"introduction": "最后的这项实践将从定价领域转向不确定性下的投资决策领域。你将解决一个经典问题：当资产之一面临跳跃风险时，如何为投资者确定最优的投资组合配置。这不仅需要最大化预期效用，还必须管理潜在的突然大幅亏损，凸显了跳跃风险在投资组合管理中的关键作用 ([@problem_id:2410147])。", "problem": "一位具有恒定相对风险厌恶 (CRRA) 效用的投资者，在一个包含一种无风险资产和一种风险资产（其价格遵循跳跃-扩散过程）的市场中，选择一个恒定的投资组合权重。该投资者的期末财富效用为 CRRA 效用，其相对风险厌恶系数等于 $1$（对数效用），即 $U(W) = \\ln(W)$。无风险资产以连续复利率 $r$ 增长。风险资产价格 $S_t$ 根据 Merton 跳跃-扩散模型演变\n$$\n\\frac{dS_t}{S_{t-}} = \\mu\\,dt + \\sigma\\,dB_t + y\\,dN_t,\n$$\n其中 $B_t$ 是一个标准布朗运动，$N_t$ 是一个强度为 $\\lambda$ 且独立于 $B_t$ 的泊松过程，$y$ 是一个恒定的跳跃幅度，满足 $-1 < y < \\infty$。投资者选择将财富的一个恒定比例 $w$ 投资于风险资产，其余部分投资于无风险资产。假设财富 $W_t$ 必须几乎必然为正。\n\n您的任务是推导并计算最优权重 $w^{\\star}$。\n\n参数：\n- 无风险利率：$r = 0.02$\n- 风险资产漂移：$\\mu = 0.10$\n- 风险资产波动率：$\\sigma = 0.20$\n- 跳跃强度：$\\lambda = 0.10$\n- 跳跃幅度：$y = -0.20$\n\n您需要找到满足约束 $w < 5$ 的最优权重。您的答案应四舍五入到四位有效数字。", "solution": "本题要求确定最优的恒定投资组合权重 $w^{\\star}$，以最大化具有对数效用 $U(W) = \\ln(W)$ 的投资者的期末财富期望效用。市场由一个回报率为恒定值 $r$ 的无风险资产和一个价格 $S_t$ 遵循 Merton 跳跃-扩散模型的风险资产组成。\n\n首先，我们必须验证问题的有效性。\n步骤1：提取已知条件。\n- 效用函数：$U(W) = \\ln(W)$，对应相对风险厌恶系数 $\\gamma=1$。\n- 无风险利率：$r$。\n- 风险资产价格动态：$\\frac{dS_t}{S_{t-}} = \\mu\\,dt + \\sigma\\,dB_t + y\\,dN_t$。\n- $B_t$ 是标准布朗运动。\n- $N_t$ 是强度为 $\\lambda$ 的泊松过程，独立于 $B_t$。\n- $y$ 是恒定的跳跃幅度，满足 $-1 < y < \\infty$。\n- $w$ 是投资于风险资产的财富的恒定比例。\n- 约束条件：财富 $W_t$ 必须几乎必然为正。\n- 参数值：$r = 0.02$, $\\mu = 0.10$, $\\sigma = 0.20$, $\\lambda = 0.10$, $y = -0.20$。\n- 目标：求出最优权重 $w^{\\star}$ 并将结果四舍五入到四位有效数字。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据，植根于 Robert C. Merton 发展的跳跃-扩散过程下的投资组合优化理论。这是一个提法恰当的问题，提供了明确的目标函数（最大化期望对数效用）和所有必要的参数。语言客观、精确。约束条件定义清晰，是此类问题的标准约束。因此，该问题是有效的。\n\n步骤3：结论与行动。\n问题有效。将推导解答。\n\n财富过程 $W_t$ 根据结合了无风险资产和风险资产回报的随机微分方程 (SDE) 演变。投资于风险资产的财富比例为 $w$，投资于无风险资产的比例为 $1-w$。财富的微分 $dW_t$ 由下式给出：\n$$\ndW_t = W_t (1-w) (r dt) + W_t w \\frac{dS_t}{S_{t-}}\n$$\n代入风险资产的 SDE，我们得到财富动态：\n$$\n\\frac{dW_t}{W_{t-}} = (1-w) r dt + w (\\mu dt + \\sigma dB_t + y dN_t)\n$$\n$$\n\\frac{dW_t}{W_{t-}} = ((1-w)r + w\\mu) dt + w\\sigma dB_t + wy dN_t\n$$\n在跳跃时刻 $\\tau$，财富从 $W_{\\tau-}$ 变为 $W_{\\tau} = W_{\\tau-} + W_{\\tau-}wy = W_{\\tau-}(1+wy)$。问题陈述财富必须几乎必然为正。这意味着在任何跳跃时刻，$W_{\\tau} > 0$。由于 $W_{\\tau-} > 0$，我们必须满足以下条件：\n$$\n1 + wy > 0\n$$\n给定参数 $y = -0.20$，这对投资组合权重 $w$ 施加了一个约束：\n$$\n1 + w(-0.20) > 0 \\implies 1 > 0.20w \\implies w < \\frac{1}{0.20} \\implies w < 5\n$$\n这个约束对于找到正确的解至关重要。\n\n投资者的目标是最大化 $E[U(W_T)] = E[\\ln(W_T)]$。为此，我们将跳跃-扩散过程的伊藤引理应用于函数 $f(W_t) = \\ln(W_t)$。$\\ln(W_t)$ 的 SDE 为：\n$$\nd\\ln(W_t) = \\left( \\frac{\\partial \\ln(W)}{\\partial W} \\mu_W + \\frac{1}{2} \\frac{\\partial^2 \\ln(W)}{\\partial W^2} \\sigma_W^2 \\right) dt + \\frac{\\partial \\ln(W)}{\\partial W} \\sigma_W dB_t + (\\ln(W_{t-}(1+wy)) - \\ln(W_{t-})) dN_t\n$$\n其中 $\\mu_W = W_{t-}((1-w)r + w\\mu)$ 是财富的漂移项，$\\sigma_W = W_{t-}w\\sigma$ 是财富的扩散项。导数为 $\\frac{\\partial \\ln(W)}{\\partial W} = \\frac{1}{W}$ 和 $\\frac{\\partial^2 \\ln(W)}{\\partial W^2} = -\\frac{1}{W^2}$。将这些代入公式可得：\n$$\nd\\ln(W_t) = \\left( \\frac{1}{W_{t-}} W_{t-}((1-w)r + w\\mu) - \\frac{1}{2} \\frac{1}{W_{t-}^2} (W_{t-}w\\sigma)^2 \\right) dt + \\frac{1}{W_{t-}} (W_{t-}w\\sigma) dB_t + \\ln(1+wy) dN_t\n$$\n化简此表达式可得：\n$$\nd\\ln(W_t) = \\left( r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 \\right) dt + w\\sigma dB_t + \\ln(1+wy) dN_t\n$$\n从 $t=0$ 到 $t=T$ 积分并取期望：\n$$\nE[\\ln(W_T)] = \\ln(W_0) + \\int_0^T E[ d\\ln(W_t) ]\n$$\n$$\nE[\\ln(W_T)] = \\ln(W_0) + \\int_0^T \\left( r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 \\right) dt + E\\left[\\int_0^T w\\sigma dB_t\\right] + E\\left[\\int_0^T \\ln(1+wy) dN_t\\right]\n$$\n使用性质 $E[dB_t] = 0$ 和 $E[dN_t] = \\lambda dt$，我们得到：\n$$\nE[\\ln(W_T)] = \\ln(W_0) + T \\left( r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 + \\lambda\\ln(1+wy) \\right)\n$$\n为了最大化期望期末对数效用，我们必须最大化与时间无关的增长率项，我们将其定义为 $g(w)$：\n$$\ng(w) = r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 + \\lambda\\ln(1+wy)\n$$\n优化问题是在 $w < 5$ 的约束下求 $\\max_{w} g(w)$。我们使用一阶条件 (FOC) $\\frac{dg}{dw} = 0$ 来找到最优权重 $w^{\\star}$：\n$$\n\\frac{dg}{dw} = (\\mu-r) - w\\sigma^2 + \\frac{\\lambda y}{1+wy} = 0\n$$\n取得最大值的二阶条件 (SOC) 是 $\\frac{d^2g}{dw^2} < 0$：\n$$\n\\frac{d^2g}{dw^2} = -\\sigma^2 - \\frac{\\lambda y^2}{(1+wy)^2}\n$$\n由于 $\\sigma^2 > 0$、$\\lambda > 0$ 和 $y^2 > 0$，对于任何满足 $1+wy \\ne 0$ 的 $w$，二阶条件总是成立的。因此，一阶条件的解将在定义域内产生一个全局最大值。\n\n现在我们求解关于 $w$ 的一阶条件。代入给定参数：$r = 0.02$, $\\mu = 0.10$, $\\sigma = 0.20$, $\\lambda = 0.10$, $y = -0.20$。这得到 $\\mu-r = 0.08$ 和 $\\sigma^2 = 0.04$。\n$$\n0.08 - w(0.04) + \\frac{0.10(-0.20)}{1+w(-0.20)} = 0\n$$\n$$\n0.08 - 0.04w - \\frac{0.02}{1-0.20w} = 0\n$$\n将整个方程乘以 $(1-0.20w)$ 以消去分母：\n$$\n(0.08 - 0.04w)(1 - 0.20w) - 0.02 = 0\n$$\n$$\n0.08 - 0.016w - 0.04w + 0.008w^2 - 0.02 = 0\n$$\n$$\n0.008w^2 - 0.056w + 0.06 = 0\n$$\n为了简化，乘以 $1000$ 再除以 $4$：\n$$\n8w^2 - 56w + 60 = 0\n$$\n$$\n2w^2 - 14w + 15 = 0\n$$\n我们使用求根公式 $w = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 来解这个关于 $w$ 的二次方程，其中 $a=2, b=-14, c=15$：\n$$\nw = \\frac{14 \\pm \\sqrt{(-14)^2 - 4(2)(15)}}{2(2)} = \\frac{14 \\pm \\sqrt{196 - 120}}{4} = \\frac{14 \\pm \\sqrt{76}}{4}\n$$\n由于 $\\sqrt{76} = \\sqrt{4 \\times 19} = 2\\sqrt{19}$，解为：\n$$\nw = \\frac{14 \\pm 2\\sqrt{19}}{4} = \\frac{7 \\pm \\sqrt{19}}{2}\n$$\n这提供了两个潜在的根：\n$$\nw_1 = \\frac{7 + \\sqrt{19}}{2} \\quad \\text{和} \\quad w_2 = \\frac{7 - \\sqrt{19}}{2}\n$$\n我们必须根据正值约束 $w < 5$ 来检查这些解。\n数值上，$\\sqrt{19} \\approx 4.3589$。\n$$\nw_1 \\approx \\frac{7 + 4.3589}{2} \\approx \\frac{11.3589}{2} \\approx 5.679\n$$\n$$\nw_2 \\approx \\frac{7 - 4.3589}{2} \\approx \\frac{2.6411}{2} \\approx 1.32055\n$$\n解 $w_1 \\approx 5.679$ 违反了约束 $w < 5$。因此，它不是一个可接受的解。\n解 $w_2 \\approx 1.32055$ 满足约束 $w < 5$，是唯一的最优权重 $w^{\\star}$。\n题目要求答案四舍五入到四位有效数字。\n$$\nw^{\\star} = 1.32055\\ldots \\approx 1.321\n$$\n这就是分配给风险资产的最优财富比例。", "answer": "$$\\boxed{1.321}$$", "id": "2410147"}]}