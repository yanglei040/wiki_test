{"hands_on_practices": [{"introduction": "在深入研究HJM框架的复杂性之前，我们首先需要掌握其核心的随机过程构建模块。这个练习将带你计算一个典型随机积分的二次变分，这个积分形式是HJM模型中远期利率动态的基础 ([@problem_id:1328957])。通过这个练习，你将能更好地理解利率路径的累积方差如何量化，这是分析利率衍生品风险的关键一步。", "problem": "设 $\\{B_t\\}_{t \\ge 0}$ 是一个定义在概率空间 $(\\Omega, \\mathcal{F}, \\mathbb{P})$ 上的标准一维布朗运动，且 $B_0 = 0$。在许多随机模型中，过程是通过对函数关于布朗运动进行积分来构造的。刻画此类过程的一个关键量是其二次变差，它直观地度量了过程路径的累积方差。\n\n考虑一个固定的终端时刻 $T > 0$。定义一个随机过程 $\\{X_t\\}_{t \\in [0, T]}$，由伊藤积分给出：\n$$\nX_t = \\int_0^t (T-s) \\, dB_s\n$$\n这种类型的积分出现在用于为远期利率建模的 Heath-Jarrow-Morton 框架中。\n\n你的任务是计算过程 $X_t$ 在时间区间 $[0, t]$ 上的二次变差，记为 $[X]_t$，其中 $t \\in [0, T]$。\n\n请用 $t$ 和 $T$ 给出你的答案的闭式解析表达式。", "solution": "我们考虑由伊藤积分 $X_{t} = \\int_{0}^{t} (T - s)\\, dB_{s}$ 定义的过程，其中 $t \\in [0, T]$。关于连续局部鞅的一个标准结果表明，如果 $X_{t} = \\int_{0}^{t} H_{s}\\, dB_{s}$，其中被积函数 $H_{s}$ 是适应的且平方可积的，那么其二次变差为\n$$\n[X]_{t} = \\int_{0}^{t} H_{s}^{2}\\, ds.\n$$\n将此结果应用于 $H_{s} = T - s$，我们得到\n$$\n[X]_{t} = \\int_{0}^{t} (T - s)^{2}\\, ds.\n$$\n为了计算该积分，我们使用 $(T - s)^{2}$ 的反导数：\n$$\n\\int (T - s)^{2}\\, ds = -\\frac{(T - s)^{3}}{3} + C.\n$$\n因此，\n$$\n[X]_{t} = \\left[-\\frac{(T - s)^{3}}{3}\\right]_{s=0}^{s=t} = \\frac{T^{3} - (T - t)^{3}}{3}.\n$$\n等价地，展开 $(T - t)^{3}$ 可得\n$$\n[X]_{t} = T^{2} t - T t^{2} + \\frac{t^{3}}{3}.\n$$\n两种形式都提供了所要求的用 $t$ 和 $T$ 表示的闭式表达式。", "answer": "$$\\boxed{T^{2}t - T t^{2} + \\frac{t^{3}}{3}}$$", "id": "1328957"}, {"introduction": "HJM框架的无套利漂移条件是理论上的一个优美结果，但在实际应用中，我们必须依赖数值方法来计算它。这个练习将引导你将理论付诸实践，通过编写代码来近似计算漂移项中的积分，并分析其数值误差和收敛阶 ([@problem_id:2398783])。这项实践不仅能加深你对模型结构的理解，还能锻炼你作为量化分析师评估和验证数值算法的关键技能。", "problem": "考虑风险中性测度下瞬时远期利率 $f(t,T)$ 的单因子 Heath-Jarrow-Morton (HJM) 框架。设远期利率的波动率是确定性的，由 $\\sigma(t,T) = a \\exp(-b\\,(T-t))$ 给出，其中 $a > 0$ 和 $b > 0$ 为常数。对于任意固定的评估时间 $t_0$ 和到期日 $T \\ge t_0$，瞬时远期利率的 HJM 无套利漂移为\n$$\n\\alpha(t_0,T) = \\sigma(t_0,T)\\int_{t_0}^{T} \\sigma(t_0,u)\\,du.\n$$\n将在 $[t_0,T]$ 上使用 $N \\in \\mathbb{N}$ 个相等子区间的左端点黎曼和近似定义为\n$$\nS_N(t_0,T) = \\sum_{k=0}^{N-1} \\sigma\\!\\left(t_0,\\, t_0 + k\\,\\Delta\\right)\\,\\Delta,\n\\quad \\text{其中} \\quad \\Delta = \\frac{T - t_0}{N}.\n$$\n定义近似漂移\n$$\n\\alpha_N(t_0,T) = \\sigma(t_0,T)\\,S_N(t_0,T).\n$$\n对于下方的每组参数，设 $\\{T_j\\}_{j=0}^{M}$ 为一个均匀的到期日网格，其中 $T_j = t_0 + j\\frac{H}{M}$，对于 $j \\in \\{0,1,\\dots,M\\}$，$M$ 是给定的正整数。对于指定列表 $\\mathcal{N}$ 中的每个 $N$，将在该到期日网格上的最大绝对漂移误差定义为\n$$\nE_N = \\max_{0 \\le j \\le M} \\left| \\alpha(t_0, T_j) - \\alpha_N(t_0, T_j) \\right|.\n$$\n对于列表 $\\mathcal{N}$ 中的两个连续值 $N$ 和 $2N$（其中 $2N$ 紧随 $N$ 之后），定义观测阶为\n$$\np_N = \\frac{\\log\\!\\left(E_N / E_{2N}\\right)}{\\log(2)}.\n$$\n对于下方的每个测试用例，您的程序必须计算：(i) $E_{N_{\\text{last}}}$，即在 $\\mathcal{N}$ 中最大 $N$ 处的最大绝对误差，以及 (ii) $p_{N_{\\text{last}}/2}$，即根据 $\\mathcal{N}$ 的最后两个条目计算出的观测阶。最终输出中的所有数值必须四舍五入到10位小数。\n\n使用以下测试套件。在每个用例中，到期日网格大小为 $M = 2000$。\n\n- 测试用例 1：$a = 0.02$, $b = 0.8$, $t_0 = 0.5$, $H = 5.0$, $\\mathcal{N} = [5, 10, 20, 40, 80]$。\n- 测试用例 2：$a = 0.7$, $b = 1.2$, $t_0 = 0.0$, $H = 0.1$, $\\mathcal{N} = [4, 8, 16, 32, 64]$。\n- 测试用例 3：$a = 0.03$, $b = 0.1$, $t_0 = 0.0$, $H = 30.0$, $\\mathcal{N} = [10, 20, 40, 80, 160]$。\n- 测试用例 4：$a = 0.015$, $b = 5.0$, $t_0 = 1.0$, $H = 2.0$, $\\mathcal{N} = [6, 12, 24, 48, 96]$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于每个测试用例，输出一个双元素列表 $[E_{N_{\\text{last}}}, p_{N_{\\text{last}}/2}]$。最终输出格式必须为\n$[[E^{(1)},p^{(1)}],[E^{(2)},p^{(2)}],[E^{(3)},p^{(3)}],[E^{(4)},p^{(4)}]]$，\n其中每个 $E^{(i)}$ 和 $p^{(i)}$ 都四舍五入到10位小数，并且打印行中任何地方都无空格。", "solution": "问题陈述是计算金融领域一个定义明确的练习，具体涉及单因子 Heath-Jarrow-Morton (HJM) 框架。它在科学上是合理的，在数学上是一致的，并且所有参数都已提供。因此，该问题被认为是有效的，并将构建一个解决方案。\n\n任务是计算 HJM 无套利漂移近似的数值精度。瞬时远期利率 $f(t,T)$ 的波动率由确定性函数给出：\n$$ \\sigma(t,T) = a \\exp(-b(T-t)) $$\n其中 $a > 0$ 和 $b > 0$ 是常数。\n\n首先，我们推导在风险中性测度下精确 HJM 无套利漂移 $\\alpha(t_0, T)$ 的解析表达式。对于一个固定的评估时间 $t_0$，漂移定义为：\n$$ \\alpha(t_0,T) = \\sigma(t_0,T) \\int_{t_0}^{T} \\sigma(t_0,u) \\, du $$\n积分项通过对函数 $\\sigma(t_0, u) = a \\exp(-b(u-t_0))$ 就到期日变量 $u$ 进行直接积分来评估：\n$$ \\int_{t_0}^{T} a e^{-b(u-t_0)} \\, du = a \\left[ -\\frac{1}{b} e^{-b(u-t_0)} \\right]_{u=t_0}^{u=T} = -\\frac{a}{b} \\left( e^{-b(T-t_0)} - e^{0} \\right) = \\frac{a}{b} \\left( 1 - e^{-b(T-t_0)} \\right) $$\n将此结果代入 $\\alpha(t_0,T)$ 的表达式中，我们得到封闭解：\n$$ \\alpha(t_0,T) = \\left( a e^{-b(T-t_0)} \\right) \\left( \\frac{a}{b} (1 - e^{-b(T-t_0)}) \\right) = \\frac{a^2}{b} e^{-b(T-t_0)} \\left(1 - e^{-b(T-t_0)}\\right) $$\n这个精确公式对于计算数值近似的误差至关重要。\n\n其次，我们分析基于左端点黎曼和 $S_N(t_0,T)$ 的近似漂移 $\\alpha_N(t_0,T)$：\n$$ \\alpha_N(t_0,T) = \\sigma(t_0,T) S_N(t_0,T), \\quad \\text{其中} \\quad S_N(t_0,T) = \\sum_{k=0}^{N-1} \\sigma(t_0, t_0 + k\\Delta) \\Delta, \\quad \\Delta = \\frac{T - t_0}{N} $$\n为实现计算效率，我们通过将其识别为有限几何级数来重构该和：\n$$ S_N(t_0,T) = a\\Delta \\sum_{k=0}^{N-1} e^{-bk\\Delta} = a\\Delta \\sum_{k=0}^{N-1} (e^{-b\\Delta})^k $$\n使用几何级数求和公式 $\\sum_{k=0}^{n-1} r^k = (1 - r^n) / (1 - r)$，其中 $r = e^{-b\\Delta}$ 且 $n=N$：\n$$ S_N(t_0,T) = a\\Delta \\frac{1 - (e^{-b\\Delta})^N}{1 - e^{-b\\Delta}} = a\\Delta \\frac{1 - e^{-bN\\Delta}}{1 - e^{-b\\Delta}} $$\n由于 $N\\Delta = T-t_0$，该和的表达式变为：\n$$ S_N(t_0,T) = a \\frac{T-t_0}{N} \\frac{1 - e^{-b(T-t_0)}}{1 - e^{-b(T-t_0)/N}} $$\n该公式在 $T > t_0$ 时成立。对于平凡情况 $T=t_0$，我们有 $\\Delta=0$，积分为 $0$，因此 $\\alpha(t_0,t_0)=0$ 且 $\\alpha_N(t_0,t_0)=0$，导致误差为 $0$。对于数值实现，为防止 $\\Delta$ 很小时的精度损失，表达式 $1 - e^{-x}$ 应计算为 $- \\mathtt{expm1}(-x)$，其中 $\\mathtt{expm1}$ 是用于计算 $e^x - 1$ 的标准库函数。\n\n每个测试用例的计算步骤如下：\n1. 定义一个均匀的到期日网格 $\\{T_j\\}_{j=0}^M$，由 $T_j = t_0 + j \\frac{H}{M}$ 给出，其中 $j=0, 1, \\dots, M$。\n2. 使用解析公式为整个网格计算精确漂移值向量 $\\alpha(t_0, T_j)$。\n3. 对于列表 $\\mathcal{N}$ 中的每个子区间数量 $N$：\n    a. 使用 $S_N(t_0,T_j)$ 的几何级数公式为网格计算近似漂移值向量 $\\alpha_N(t_0, T_j)$。\n    b. 计算绝对误差向量 $|\\alpha(t_0, T_j) - \\alpha_N(t_0, T_j)|$。\n    c. 找出最大绝对误差 $E_N = \\max_{0 \\le j \\le M} |\\alpha(t_0, T_j) - \\alpha_N(t_0, T_j)|$。\n4. 一旦计算出所有误差 $\\{E_N\\}_{N \\in \\mathcal{N}}$，确定所需的输出：\n    a. 最终误差 $E_{N_{\\text{last}}}$，对应于 $\\mathcal{N}$ 中最大的 $N$。\n    b. 观测收敛阶 $p_{N_{\\text{last}}/2}$，从序列中最后两个误差计算得出：\n$$ p_{N_{\\text{last}}/2} = \\frac{\\log(E_{N_{\\text{last}}/2} / E_{N_{\\text{last}}})}{\\log(2)} $$\n数值积分理论表明，左端点黎曼和的误差是 $O(1/N)$ 阶的，因此我们预期 $p_N \\approx 1$。\n\n实现将利用 `numpy` 库进行向量化计算以确保效率。根据要求，所有最终数值结果将四舍五入到10位小数。", "answer": "[[0.0000000300,1.0000329528],[0.0000000000,1.0000000108],[0.0000004245,0.9995186981],[0.0000000000,1.0001856726]]", "id": "2398783"}, {"introduction": "最后一个练习旨在引导你探索HJM模型更深层次的特性。表面上看，这是一个关于比较欧拉（Euler）和米尔斯坦（Milstein）两种数值格式稳定性的问题，但其背后揭示了高斯HJM模型一个出人意料的优雅性质 ([@problem_id:2398794])。通过解决这个问题，你将亲身体会到，在特定模型结构下，数值离散化误差有时会以一种精巧的方式相互抵消，从而加深你对模型分析结构的认识。", "problem": "考虑一个单因子 Heath-Jarrow-Morton (HJM) 模型，采用 Musiela 参数化方法描述瞬时远期利率 $f(t,\\tau)$，其中时间 $t \\ge 0$，距离到期时间 $\\tau \\ge 0$。在风险中性测度下，远期利率遵循以下随机微分方程：\n$$\n\\mathrm{d} f(t,\\tau) = \\mu(t,\\tau)\\,\\mathrm{d}t + \\sigma(t,\\tau)\\,\\mathrm{d}W_t,\n$$\n其中 $W_t$ 是一个标准布朗运动。假设波动率是可分离的单因子形式：\n$$\n\\sigma(t,\\tau) = a(t)\\,b(\\tau),\n$$\n其中 $a(t) = 1 + c\\,t$ 且 $b(\\tau) = \\alpha\\, e^{-\\beta \\tau}$，参数 $c > 0$、$\\alpha > 0$ 和 $\\beta > 0$。在无套利条件下，漂移项由下式给出：\n$$\n\\mu(t,\\tau) = \\sigma(t,\\tau)\\,\\int_{0}^{\\tau} \\sigma(t,s)\\,\\mathrm{d}s.\n$$\n设初始远期曲线为：\n$$\nf(0,\\tau) = \\theta + \\phi\\, e^{-\\gamma \\tau},\n$$\n其中参数 $\\theta > 0$、$\\phi > 0$ 和 $\\gamma > 0$。\n\n固定一个视界时间 $t_\\star > 0$。对于一个到期日 $T > t_\\star$，定义 $S = T - t_\\star$ 以及在时间 $t_\\star$ 的零息债券价格为：\n$$\nP(t_\\star,T) = \\exp\\Big(-\\int_{0}^{S} f(t_\\star,s)\\,\\mathrm{d}s\\Big).\n$$\n定义并计算上述模型所隐含的期望债券价格 $\\mathbb{E}[P(t_\\star,T)]$ 的精确值。\n\n现在，考虑在区间 $[0,t_\\star]$ 上对远期利率动态进行时间离散化，使用两种格式：Euler-Maruyama 格式和 Milstein 格式。对于一个均匀时间步长 $\\Delta t$，设 $N = t_\\star/\\Delta t$ 为一个整数，时间节点为 $t_k = k\\,\\Delta t$，$k = 0,1,\\dots,N-1$。对于每种格式，通过将模型定义中所有的时间积分替换为在 $\\{t_k\\}_{k=0}^{N-1}$ 上求值的相应左黎曼和，定义相应的 $\\mathbb{E}[P(t_\\star,T)]$ 的离散时间近似。\n\n仅使用上述定义（不引入任何外部假设），通过将 Euler-Maruyama 和 Milstein 离散化的离散时间近似值与精确值进行比较，分析这两种离散化方法在多个时间步长下的数值稳定性。分析必须针对以下构成测试套件的参数值进行：\n\n- 波动率形状参数：$\\alpha = 0.04$，$\\beta = 0.8$。\n- 时间变化参数：$c = 0.6$。\n- 初始曲线参数：$\\theta = 0.02$，$\\phi = 0.015$，$\\gamma = 0.7$。\n- 视界：$t_\\star = 1.0$。\n- 到期情况（表示为 $S = T - t_\\star$）：$S \\in \\{0.1, 1.0, 5.0\\}$。\n- 时间步长：$\\Delta t \\in \\{0.5, 0.25, 0.125\\}$。\n\n对于集合 $\\{0.1, 1.0, 5.0\\}$ 中的每个 $S$：\n\n1. 计算精确值 $\\mathbb{E}[P(t_\\star,T)]$。\n2. 对于集合 $\\{0.5, 0.25, 0.125\\}$ 中的每个 $\\Delta t$，计算基于 Euler-Maruyama 的离散近似和基于 Milstein 的离散近似 $\\mathbb{E}[P(t_\\star,T)]$。\n3. 对于每个 $S$，报告两个聚合诊断指标：\n   - 在三个 $\\Delta t$ 值上，Euler-Maruyama 和 Milstein 近似之间的最大绝对差值（一个非负实数）。\n   - 一个布尔指标，当且仅当 Euler-Maruyama 格式的绝对近似误差随着 $\\Delta t$ 在序列 $0.5 \\to 0.25 \\to 0.125$ 中减小时严格递减，该指标为真，否则为假。\n\n您的程序应生成单行输出，按以下顺序包含六个结果：\n$$\n[\\text{max\\_diff}(S{=}0.1), \\text{stable}(S{=}0.1), \\text{max\\_diff}(S{=}1.0), \\text{stable}(S{=}1.0), \\text{max\\_diff}(S{=}5.0), \\text{stable}(S{=}5.0)].\n$$\n每个 $\\text{max\\_diff}(\\cdot)$ 必须是一个实数，每个 $\\text{stable}(\\cdot)$ 必须是一个布尔值。任何量都不需要单位。程序不得读取任何输入，并且必须确定性地运行。", "solution": "用户提供了一个计算金融领域的问题，具体涉及 Heath-Jarrow-Morton (HJM) 框架。需要对问题进行验证，如果有效，则予以解决。\n\n### 第 1 步：问题验证\n\n**1.1. 提取给定条件**\n\n*   **模型：** 单因子 Heath-Jarrow-Morton (HJM) 模型，Musiela 参数化。\n*   **远期利率随机微分方程：** $\\mathrm{d} f(t,\\tau) = \\mu(t,\\tau)\\,\\mathrm{d}t + \\sigma(t,\\tau)\\,\\mathrm{d}W_t$。\n*   **波动率：** $\\sigma(t,\\tau) = a(t)\\,b(\\tau)$，其中 $a(t) = 1 + c\\,t$ 且 $b(\\tau) = \\alpha\\, e^{-\\beta \\tau}$。参数 $c, \\alpha, \\beta > 0$。\n*   **无套利漂移项：** $\\mu(t,\\tau) = \\sigma(t,\\tau)\\,\\int_{0}^{\\tau} \\sigma(t,s)\\,\\mathrm{d}s$。\n*   **初始曲线：** $f(0,\\tau) = \\theta + \\phi\\, e^{-\\gamma \\tau}$，其中参数 $\\theta, \\phi, \\gamma > 0$。\n*   **债券价格：** 对于 $S = T - t_\\star$，$P(t_\\star,T) = \\exp\\Big(-\\int_{0}^{S} f(t_\\star,s)\\,\\mathrm{d}s\\Big)$。\n*   **任务 1 (精确)：** 计算 $\\mathbb{E}[P(t_\\star,T)]$。\n*   **任务 2 (离散)：** 使用 Euler-Maruyama 和 Milstein 格式在时间网格 $\\{t_k = k\\Delta t\\}_{k=0}^{N-1}$（其中 $N=t_\\star/\\Delta t$）上定义并计算 $\\mathbb{E}[P(t_\\star,T)]$ 的近似值。所有时间积分都用左黎曼和替换。\n*   **任务 3 (分析)：** 将离散近似值与精确值进行比较，并计算指定的诊断指标（`max_diff`, `stable`）。\n*   **参数值：**\n    *   $\\alpha = 0.04$, $\\beta = 0.8$, $c = 0.6$。\n    *   $\\theta = 0.02$, $\\phi = 0.015$, $\\gamma = 0.7$。\n    *   $t_\\star = 1.0$。\n    *   $S \\in \\{0.1, 1.0, 5.0\\}$。\n    *   $\\Delta t \\in \\{0.5, 0.25, 0.125\\}$。\n\n**1.2. 验证结论**\n\n该问题是**有效的**。\n*   **科学依据充分：** HJM 框架、Musiela 参数化以及指定的波动率结构构成了一个标准的高斯 HJM 模型，这是利率理论的基石。无套利漂移条件陈述正确。\n*   **适定的：** 所有必要的函数、参数和计算步骤都已明确定义。目标清晰且可以量化。\n*   **客观的：** 问题以精确、无歧义的数学语言表述。\n\n问题表述严谨，满足有效科学问题的所有标准。我现在将进行求解。\n\n### 第 2 步：求解推导\n\n问题的核心在于认识到所指定的模型是一个高斯 HJM 模型，因为波动率函数 $\\sigma(t,\\tau)$ 是确定性的（它不依赖于状态变量 $f$）。这对解法有深远的影响。\n\n**A 部分：$\\mathbb{E}[P(t_\\star,T)]$ 的精确计算**\n\n时间 $t$ 的远期利率是以下随机微分方程的解：\n$$ f(t, \\tau) = f(0, \\tau) + \\int_0^t \\mu(s, \\tau)\\,\\mathrm{d}s + \\int_0^t \\sigma(s, \\tau)\\,\\mathrm{d}W_s $$\n债券价格取决于积分远期利率 $X = \\int_0^S f(t_\\star, s)\\,\\mathrm{d}s$。由于 $f(t_\\star, \\tau)$ 是高斯过程 ($W_t$) 的线性泛函，它本身就是一个高斯过程，其积分 $X$ 是一个高斯随机变量。为了求 $\\mathbb{E}[e^{-X}]$，我们需要它的均值 $\\mu_X$ 和方差 $\\sigma_X^2$，因为 $\\mathbb{E}[e^{-X}] = \\exp(-\\mu_X + \\frac{1}{2}\\sigma_X^2)$。\n\n1.  **$X$ 的均值：**\n    $\\mu_X = \\mathbb{E}[X] = \\mathbb{E}\\left[\\int_0^S f(t_\\star, s)\\,\\mathrm{d}s\\right]$。根据 Fubini 定理，我们可以交换期望和积分的顺序：\n    $$ \\mu_X = \\int_0^S \\mathbb{E}[f(t_\\star, s)]\\,\\mathrm{d}s $$\n    远期利率的期望为：\n    $$ \\mathbb{E}[f(t_\\star, \\tau)] = f(0, \\tau) + \\int_0^{t_\\star} \\mu(s, \\tau)\\,\\mathrm{d}s $$\n    漂移项是 $\\mu(s, \\tau) = \\sigma(s, \\tau) \\int_0^\\tau \\sigma(s, v)\\,\\mathrm{d}v = a(s)^2 b(\\tau) \\int_0^\\tau b(v)\\,\\mathrm{d}v$。\n    设 $G(\\tau) = \\int_0^\\tau b(v)\\,\\mathrm{d}v = \\int_0^\\tau \\alpha e^{-\\beta v}\\,\\mathrm{d}v = \\frac{\\alpha}{\\beta}(1 - e^{-\\beta\\tau})$。\n    则 $\\mu(s, \\tau) = a(s)^2 b(\\tau) G(\\tau)$。\n    对时间 $s \\in [0, t_\\star]$ 积分：\n    $$ \\int_0^{t_\\star} \\mu(s, \\tau)\\,\\mathrm{d}s = b(\\tau)G(\\tau) \\int_0^{t_\\star} a(s)^2\\,\\mathrm{d}s = b(\\tau)G(\\tau) I_\\mu(t_\\star) $$\n    其中 $I_\\mu(t_\\star) = \\int_0^{t_\\star} (1+cs)^2\\,\\mathrm{d}s = t_\\star + c t_\\star^2 + \\frac{c^2}{3} t_\\star^3$。\n    现在，我们将 $\\mathbb{E}[f(t_\\star, s)]$ 对 $s \\in [0, S]$ 积分：\n    $$ \\mu_X = \\int_0^S f(0, s)\\,\\mathrm{d}s + \\int_0^S b(s)G(s)I_\\mu(t_\\star)\\,\\mathrm{d}s $$\n    设 $A(S) = \\int_0^S f(0, s)\\,\\mathrm{d}s = \\int_0^S (\\theta + \\phi e^{-\\gamma s})\\,\\mathrm{d}s = \\theta S + \\frac{\\phi}{\\gamma}(1 - e^{-\\gamma S})$。\n    第二个积分是 $\\int_0^S b(s)G(s)\\,\\mathrm{d}s = \\int_0^S G(s)G'(s)\\,\\mathrm{d}s = \\left[\\frac{1}{2}G(s)^2\\right]_0^S = \\frac{1}{2}G(S)^2$。\n    因此，$\\mu_X = A(S) + \\frac{1}{2}G(S)^2 I_\\mu(t_\\star)$。\n\n2.  **$X$ 的方差：**\n    $$ \\sigma_X^2 = \\text{Var}\\left(\\int_0^S f(t_\\star, s)\\,\\mathrm{d}s\\right) = \\text{Var}\\left(\\int_0^S \\left(f(0, s) + \\int_0^{t_\\star} \\mu(u,s)\\,\\mathrm{d}u + \\int_0^{t_\\star} \\sigma(u,s)\\,\\mathrm{d}W_u\\right)\\,\\mathrm{d}s\\right) $$\n    方差仅来自随机积分项。\n    $$ \\sigma_X^2 = \\text{Var}\\left(\\int_0^S \\int_0^{t_\\star} \\sigma(u,s)\\,\\mathrm{d}W_u\\,\\mathrm{d}s\\right) $$\n    使用随机 Fubini 定理：\n    $$ = \\text{Var}\\left(\\int_0^{t_\\star} \\left(\\int_0^S \\sigma(u,s)\\,\\mathrm{d}s\\right)\\,\\mathrm{d}W_u\\right) = \\text{Var}\\left(\\int_0^{t_\\star} a(u)G(S)\\,\\mathrm{d}W_u\\right) $$\n    这是一个被积函数为确定性函数的 Itô 积分。其方差为被积函数平方的积分：\n    $$ \\sigma_X^2 = \\int_0^{t_\\star} (a(u)G(S))^2\\,\\mathrm{d}u = G(S)^2 \\int_0^{t_\\star} a(u)^2\\,\\mathrm{d}u = G(S)^2 I_\\mu(t_\\star) $$\n\n3.  **最终期望：**\n    $$ \\mathbb{E}[P(t_\\star,T)] = \\exp\\left(-\\mu_X + \\frac{1}{2}\\sigma_X^2\\right) = \\exp\\left(-\\left(A(S) + \\frac{1}{2}G(S)^2 I_\\mu(t_\\star)\\right) + \\frac{1}{2}G(S)^2 I_\\mu(t_\\star)\\right) $$\n    涉及 $I_\\mu(t_\\star)$ 的项完全抵消。这是一个源于无套利条件的经典结果。\n    $$ \\mathbb{E}[P(t_\\star,T)] = \\exp(-A(S)) $$\n    精确值为 $P_{exact} = \\exp\\left(-\\left[\\theta S + \\frac{\\phi}{\\gamma}(1 - e^{-\\gamma S})\\right]\\right)$。\n\n**B 部分：离散化格式**\n\n问题要求分析 Euler-Maruyama 和 Milstein 格式。\n随机微分方程为 $df(t,\\tau) = \\mu(t,\\tau)dt + \\sigma(t,\\tau)dW_t$。波动率项 $\\sigma(t,\\tau)$ 不依赖于状态 $f$。因此，它关于 $f$ 的泛函导数为零。这意味着 Milstein 修正项 $\\frac{1}{2}\\sigma \\frac{\\partial \\sigma}{\\partial f}((\\Delta W)^2 - \\Delta t)$ 恒等于零。\n对于这个特定模型，**Milstein 格式与 Euler-Maruyama 格式完全相同。**\n这立即意味着它们近似值之间的差值为零，因此对于所有 $S$，$\\text{max\\_diff}(S) = 0$。\n\n我们来分析 Euler 近似 $P_{Euler}$。它遵循与 A 部分完全相同的逻辑推导，但将连续时间积分 $I_\\mu(t_\\star) = \\int_0^{t_\\star} a(t)^2 dt$ 替换为其离散的左黎曼和等价形式：\n$$ I_{\\mu, discrete}(\\Delta t) = \\sum_{k=0}^{N-1} a(t_k)^2 \\Delta t = \\Delta t \\sum_{k=0}^{N-1} (1+ct_k)^2 $$\n其中 $t_k = k\\Delta t$ 且 $N = t_\\star / \\Delta t$。\n积分远期利率的离散化版本 $X_N$ 也是一个高斯随机变量。其均值和方差通过将 A 部分公式中的 $I_\\mu(t_\\star)$ 替换为 $I_{\\mu, discrete}(\\Delta t)$ 来得到：\n*   $\\mu_{X_N} = A(S) + \\frac{1}{2}G(S)^2 I_{\\mu, discrete}(\\Delta t)$\n*   $\\sigma_{X_N}^2 = G(S)^2 I_{\\mu, discrete}(\\Delta t)$\n\n因此，基于 Euler-Maruyama 的期望债券价格近似值为：\n$$ P_{Euler}(\\Delta t) = \\exp\\left(-\\mu_{X_N} + \\frac{1}{2}\\sigma_{X_N}^2\\right) = \\exp\\left(-\\left(A(S) + \\frac{1}{2}G(S)^2 I_{\\mu, discrete}(\\Delta t)\\right) + \\frac{1}{2}G(S)^2 I_{\\mu, discrete}(\\Delta t)\\right) $$\n$$ P_{Euler}(\\Delta t) = \\exp(-A(S)) $$\n这证明了该模型的一个关键性质：无论时间步长 $\\Delta t$ 如何，期望债券价格的离散近似值都与精确解析值相同。这不是一个数值上的巧合，而是高斯结构和无套利条件的解析结果，其中对数价格的均值和方差项中的离散化误差恰好相互抵消。\n\n**C 部分：诊断指标计算**\n\n1.  **最大绝对差值 ($\\text{max\\_diff}$):**\n    如上所示，对于所有 $\\Delta t$，$P_{Euler}(\\Delta t) = P_{Milstein}(\\Delta t) = \\exp(-A(S))$。\n    两种近似之间的绝对差值为 $|P_{Euler}(\\Delta t) - P_{Milstein}(\\Delta t)| = 0$（对每个 $\\Delta t$）。\n    因此，在所有 $\\Delta t$ 上的最大绝对差值为 $0$。\n\n2.  **稳定性指标 ($\\text{stable}$):**\n    Euler 格式的绝对近似误差为 $|P_{Euler}(\\Delta t) - P_{exact}|$。\n    由于 $P_{Euler}(\\Delta t) = P_{exact} = \\exp(-A(S))$，误差为 $| \\exp(-A(S)) - \\exp(-A(S)) | = 0$（对所有 $\\Delta t$）。\n    对于 $\\Delta t \\in \\{0.5, 0.25, 0.125\\}$，误差序列为 $\\{0, 0, 0\\}$。\n    布尔指标为真的条件是误差*严格递减*。由于 $0 \\ngtr 0$，该条件不满足。该指标为 `false`。\n\n**对所有 S 的结论：**\n对于每个给定的 $S$ 值，结果将是相同的：$\\text{max\\_diff} = 0.0$ 和 $\\text{stable} = \\text{False}$。下面的实现将通过数值方式执行符号计算，以确认这一解析结论。", "answer": "[0.0,False,0.0,False,0.0,False]", "id": "2398794"}]}