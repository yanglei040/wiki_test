{"hands_on_practices": [{"introduction": "要掌握信赖域方法，第一步是理解其核心子问题。这个练习将引导你解决一个最简单的一维信赖域子问题[@problem_id:2224504]。通过这个实践，你将亲手计算并理解模型的最优解与信赖域边界之间的权衡，这是整个算法的基础。", "problem": "在无约束优化的背景下，信赖域方法在当前点周围，用一个更简单的模型函数 $m(p)$ 来迭代地近似一个复杂函数。然后，通过求解信赖域子问题来确定下一步的步长 $p$，该子问题涉及在半径为 $\\Delta > 0$ 的“信赖域”内最小化此模型，在该区域内，模型被认为是原始函数的可靠近似。该子问题可正式表述为：\n$$\n\\min_{p} m(p) \\quad \\text{subject to} \\quad \\|p\\| \\le \\Delta\n$$\n考虑一个一维优化场景，其中步长 $p \\in \\mathbb{R}$ 的模型函数是一个由以下公式给出的二次函数：\n$$\nm(p) = g p + \\frac{1}{2} H p^2 + c\n$$\n其中梯度项 $g = 2$，Hessian 项 $H = 6$，以及一个任意常数 $c$。该步长受信赖域半径 $\\Delta = 0.1$ 的约束。\n\n确定求解此一维信赖域子问题的最优步长 $p$。请以精确小数形式提供您的答案。", "solution": "我们必须在信赖域约束 $|p| \\le \\Delta$ 下最小化二次模型 $m(p) = g p + \\frac{1}{2} H p^{2} + c$，给定值为 $g=2$，$H=6$ 和 $\\Delta=0.1$。常数 $c$ 不影响最小化子，可以忽略。\n\n考虑信赖域子问题的拉格朗日函数：\n$$\n\\mathcal{L}(p,\\lambda) = g p + \\frac{1}{2} H p^{2} + \\lambda \\left(p^{2} - \\Delta^{2}\\right),\n$$\n其中 $\\lambda \\ge 0$。Karush-Kuhn-Tucker 条件是：\n1. 平稳性：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial p} = g + H p + 2 \\lambda p = 0.\n$$\n2. 原始可行性：$|p| \\le \\Delta$。\n3. 对偶可行性：$\\lambda \\ge 0$。\n4. 互补松弛性：$\\lambda \\left(p^{2} - \\Delta^{2}\\right) = 0$。\n\n情况 1 (内部解)：如果 $|p| < \\Delta$，则 $\\lambda = 0$，根据平稳性条件可得\n$$\ng + H p = 0 \\quad \\Rightarrow \\quad p_{u} = -\\frac{g}{H}.\n$$\n对于 $g=2$ 和 $H=6$，这得到 $p_{u} = -\\frac{2}{6} = -\\frac{1}{3}$。检查可行性：$|p_{u}| = \\frac{1}{3} > 0.1 = \\Delta$，因此内部解是不可行的。\n\n情况 2 (边界解)：此时 $p^{2} = \\Delta^{2}$，所以 $p = \\pm \\Delta$。平稳性条件变为\n$$\ng + H p + 2 \\lambda p = 0 \\quad \\Rightarrow \\quad (H + 2 \\lambda) p = -g.\n$$\n因为 $H + 2 \\lambda \\ge 0$，所以 $p$ 的符号必须与 $-g$ 的符号相匹配。由于 $g = 2 > 0$，我们必须取 $p = -\\Delta = -0.1$。为了验证对偶可行性，求解 $\\lambda$：\n$$\n(H + 2 \\lambda)(-\\Delta) = -g \\quad \\Rightarrow \\quad (H + 2 \\lambda)\\Delta = g \\quad \\Rightarrow \\quad 2 \\lambda = \\frac{g}{\\Delta} - H.\n$$\n代入 $g=2$, $\\Delta=0.1$ 和 $H=6$ 得\n$$\n2 \\lambda = \\frac{2}{0.1} - 6 = 20 - 6 = 14 \\quad \\Rightarrow \\quad \\lambda = 7 \\ge 0,\n$$\n这满足了对偶可行性和互补松弛性。\n\n因此，最优信赖域步长是负梯度方向上的边界步长：\n$$\np^{\\star} = -\\Delta = -0.1.\n$$", "answer": "$$\\boxed{-0.1}$$", "id": "2224504"}, {"introduction": "信赖域方法的一个关键优势是它能够有效处理非凸问题，特别是能够“逃离”梯度为零但并非局部最小点的鞍点。这个练习[@problem_id:2444737]将你置于一个典型的鞍点之上。通过求解这个子问题，你将发现算法如何利用模型的负曲率信息来确定下降方向，从而揭示信赖域方法在复杂优化问题中保持稳健性的一个深刻原因。", "problem": "考虑一个双变量二次目标函数的无约束最小化问题，\n$$f(x) = -x_{1}^{2} + x_{2}^{2}, \\quad x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}.$$\n在当前迭代点\n$$x_{k} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix},$$\n一个使用欧几里得范数和信赖域半径 $\\Delta > 0$ 的信赖域方法构建了如下二次模型\n$$m_{k}(s) = f(x_{k}) + \\nabla f(x_{k})^{\\top} s + \\tfrac{1}{2}\\, s^{\\top} \\nabla^{2} f(x_{k})\\, s,$$\n并通过求解以下问题来计算精确的信赖域步长\n$$\\min_{s \\in \\mathbb{R}^{2}} \\; m_{k}(s) \\quad \\text{subject to} \\quad \\|s\\|_{2} \\le \\Delta.$$\n在所有全局极小值点中，约定所选步长的第一个分量为非负。\n\n请确定精确的信赖域步长 $s_{k}$，作为 $\\Delta$ 的函数。请以 $1 \\times 2$ 行向量的形式给出你的答案。不需要进行数值舍入。", "solution": "我们从二次目标函数的梯度和Hessian矩阵的定义开始。目标函数为\n$$f(x) = -x_{1}^{2} + x_{2}^{2},$$\n因此，对于任意 $x \\in \\mathbb{R}^{2}$，其梯度和Hessian矩阵为\n$$\\nabla f(x) = \\begin{pmatrix} -2 x_{1} \\\\ 2 x_{2} \\end{pmatrix}, \\qquad \\nabla^{2} f(x) = \\begin{pmatrix} -2  0 \\\\ 0  2 \\end{pmatrix}.$$\n在信赖域中心 $x_{k} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 处，梯度为\n$$\\nabla f(x_{k}) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.$$\n因此，在 $x_{k}$ 处的二次模型为\n$$m_{k}(s) = f(x_{k}) + \\nabla f(x_{k})^{\\top} s + \\tfrac{1}{2}\\, s^{\\top} \\nabla^{2} f(x_{k})\\, s = f(0) + \\tfrac{1}{2}\\, s^{\\top} H s,$$\n其中我们记 $H \\coloneqq \\nabla^{2} f(x_{k}) = \\begin{pmatrix} -2  0 \\\\ 0  2 \\end{pmatrix}$。常数项 $f(0)$ 与 $m_{k}$ 的极小值点无关，因此信赖域子问题简化为\n$$\\min_{\\|s\\|_{2} \\le \\Delta} \\; \\tfrac{1}{2}\\, s^{\\top} H s.$$\n由于 $H$ 是对称不定的，我们分析其特征结构。$H$ 的特征对（特征值和对应的特征向量）为\n$$(\\lambda_{1}, v_{1}) = (-2, \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}), \\qquad (\\lambda_{2}, v_{2}) = (2, \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}).$$\n对于任意非零向量 $s$，可写作 $s = r u$，其中 $r = \\|s\\|_{2}$ 且 $\\|u\\|_{2} = 1$。则\n$$\\tfrac{1}{2}\\, s^{\\top} H s = \\tfrac{1}{2}\\, r^{2}\\, u^{\\top} H u.$$\n对于固定的 $r$，在单位向量 $u$ 上进行最小化等价于最小化瑞利商 $u^{\\top} H u$，其最小值在与 $H$ 的最小特征值相关联的任意特征向量处取得。由于最小特征值为 $\\lambda_{\\min} = -2$，对应的特征向量为 $\\pm v_{1}$，因此在球面 $\\|s\\|_{2} = r$ 上的极小值点为 $s = r (\\pm v_{1})$。\n\n在信赖域 $\\|s\\|_{2} \\le \\Delta$ 内，当 $r$ 沿着负曲率方向增加时，目标函数值减小，因此约束极小值点位于边界上，此时 $r = \\Delta$，方向 $u$ 等于 $\\lambda_{\\min}$ 的一个特征向量。根据约定，$s$ 的第一个分量为非负，我们选择 $u = v_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 而不是 $-v_{1}$。因此，精确的信赖域步长为\n$$s_{k} = \\Delta \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.$$\n该步长与模型的负曲率方向一致，因此沿着鞍点的不稳定流形移动，这展示了信赖域方法如何沿负曲率方向逃离鞍点。\n\n表示为 $1 \\times 2$ 的行向量，该步长为\n$$\\begin{pmatrix} \\Delta  0 \\end{pmatrix}.$$", "answer": "$$\\boxed{\\begin{pmatrix}\\Delta  0\\end{pmatrix}}$$", "id": "2444737"}, {"introduction": "信赖域方法的强大之处不仅在于其子问题的构造，还在于其动态调整信赖域半径的自适应机制。该机制通过评估二次模型预测的改善（$pred_k$）与实际函数值的改善（$ared_k$）之间的一致性（由比率 $\\rho_k$ 度量）来工作。这个练习[@problem_id:2444749]模拟了一个模型近似效果很差的场景，你需要计算 $\\rho_k$ 值并据此更新信赖域半径，从而亲身体验该方法是如何通过收缩信赖域来“自我纠正”，以应对模型失配并保证算法的稳健性。", "problem": "考虑一个在计算金融领域的二元选择模型的最大似然估计（MLE）中出现的校准子问题。设单次观测的伯努利结果的负对数似然被建模为单一标量索引 $x$ 的函数：\n$$\nf(x) \\;=\\; \\ln\\!\\big(1+\\exp(x)\\big) \\;-\\; \\bar{y}\\,x,\n$$\n其中 $\\bar{y}\\in(0,1)$ 是观测结果的样本均值。在信赖域迭代的第 $k$ 步，假设当前迭代点为 $x_k = 0$，样本均值为 $\\bar{y} = 0.51$。关于 $x_k$ 的信赖域二次模型为\n$$\nm_k(p) \\;=\\; f(x_k) \\;+\\; g_k\\,p \\;+\\; \\tfrac{1}{2}\\,B_k\\,p^2,\n$$\n其中梯度为 $g_k = \\nabla f(x_k)$，对称Hessian近似为 $B_k$。假设 $B_k = 0.01$，这严重低估了在 $x_k$ 处的真实曲率。信赖域半径为 $\\delta_k = 1$，所用的步长是沿负梯度方向的柯西点，在一维情况下即为\n$$\np_k \\;=\\; \\delta_k\\,\\mathrm{sign}(-g_k).\n$$\n定义信赖域接受率\n$$\n\\rho_k \\;=\\; \\frac{f(x_k) - f(x_k + p_k)}{m_k(0) - m_k(p_k)}.\n$$\n信赖域半径的更新策略如下：\n- 如果 $\\rho_k < 0$，则设置 $\\delta_{k+1} = 0.1\\,\\delta_k$，\n- 如果 $0 \\le \\rho_k < 0.25$，则设置 $\\delta_{k+1} = 0.5\\,\\delta_k$，\n- 如果 $\\rho_k \\ge 0.25$，则设置 $\\delta_{k+1} = 2\\,\\delta_k$。\n\n计算 $\\delta_{k+1}$。将最终答案表示为一个纯数字，无需四舍五入。", "solution": "该问题要求基于当前迭代的数据和指定的更新规则，计算下一个信赖域半径 $\\delta_{k+1}$。这需要计算信赖域接受率 $\\rho_k$。\n\n接受率定义为：\n$$\n\\rho_k \\;=\\; \\frac{f(x_k) - f(x_k + p_k)}{m_k(0) - m_k(p_k)}\n$$\n该比率将目标函数的实际减少量 $ared_k = f(x_k) - f(x_k + p_k)$ 与二次模型预测的减少量 $pred_k = m_k(0) - m_k(p_k)$ 进行比较。我们必须计算这两个量。\n\n首先，我们确定与当前迭代点 $x_k=0$ 相关的量。目标函数由下式给出：\n$$\nf(x) \\;=\\; \\ln(1+\\exp(x)) - \\bar{y}x\n$$\n由于样本均值为 $\\bar{y} = 0.51$，该函数为：\n$$\nf(x) \\;=\\; \\ln(1+\\exp(x)) - 0.51x\n$$\n在当前迭代点 $x_k=0$ 处，函数值为：\n$$\nf(x_k) = f(0) = \\ln(1+\\exp(0)) - 0.51(0) = \\ln(1+1) = \\ln(2)\n$$\n为求得步长 $p_k$，我们首先计算梯度 $g_k = \\nabla f(x_k) = f'(x_k)$。$f(x)$ 的导数是：\n$$\nf'(x) = \\frac{d}{dx} \\left( \\ln(1+\\exp(x)) - 0.51x \\right) = \\frac{\\exp(x)}{1+\\exp(x)} - 0.51\n$$\n计算在 $x_k=0$ 处的梯度：\n$$\ng_k = f'(0) = \\frac{\\exp(0)}{1+\\exp(0)} - 0.51 = \\frac{1}{1+1} - 0.51 = 0.5 - 0.51 = -0.01\n$$\n步长 $p_k$ 由柯西点给出，对于此一维问题，指定为 $p_k = \\delta_k\\,\\mathrm{sign}(-g_k)$。信赖域半径为 $\\delta_k=1$：\n$$\np_k = 1 \\cdot \\mathrm{sign}(-(-0.01)) = \\mathrm{sign}(0.01) = 1\n$$\n新的点是 $x_k + p_k = 0 + 1 = 1$。\n\n现在，我们计算实际减少量 $ared_k = f(x_k) - f(x_k + p_k)$。我们有 $f(x_k) = \\ln(2)$。在新点处的函数值为：\n$$\nf(x_k + p_k) = f(1) = \\ln(1+\\exp(1)) - 0.51(1) = \\ln(1+e) - 0.51\n$$\n实际减少量为：\n$$\nared_k = \\ln(2) - \\left( \\ln(1+e) - 0.51 \\right) = \\ln(2) - \\ln(1+e) + 0.51\n$$\n接下来，我们计算预测减少量 $pred_k = m_k(0) - m_k(p_k)$。二次模型是：\n$$\nm_k(p) = f(x_k) + g_k p + \\frac{1}{2} B_k p^2\n$$\n在 $p=0$ 处，我们有 $m_k(0) = f(x_k)$。因此，预测减少量为：\n$$\npred_k = m_k(0) - m_k(p_k) = f(x_k) - \\left( f(x_k) + g_k p_k + \\frac{1}{2} B_k p_k^2 \\right) = -g_k p_k - \\frac{1}{2} B_k p_k^2\n$$\n使用值 $g_k = -0.01$，$p_k=1$ 和给定的Hessian近似 $B_k=0.01$：\n$$\npred_k = -(-0.01)(1) - \\frac{1}{2}(0.01)(1)^2 = 0.01 - 0.005 = 0.005\n$$\n接受率为：\n$$\n\\rho_k = \\frac{ared_k}{pred_k} = \\frac{\\ln(2) - \\ln(1+e) + 0.51}{0.005}\n$$\n为了应用信赖域半径更新规则，我们必须确定 $\\rho_k$ 落在哪个范围内。这需要确定分子 $N = \\ln(2) - \\ln(1+e) + 0.51$ 的符号。\n分母 $0.005$ 是正数。$\\rho_k$ 的符号就是 $N$ 的符号。\n我们可以将分子重写为 $N = \\ln\\left(\\frac{2}{1+e}\\right) + 0.51$。\n让我们确定各项的界限。我们知道 $e \\approx 2.718$。因此，$1+e \\approx 3.718$。\n项 $\\ln(2) \\approx 0.693$。\n项 $\\ln(1+e) = \\ln(1+\\exp(1)) > \\ln(1+2.7) = \\ln(3.7)$。因为 $e  3.7  e^2$，我们有 $1 = \\ln(e)  \\ln(3.7)  2$。更精确地，$\\ln(3.7) \\approx 1.308$。\n所以，$\\ln(2) - \\ln(1+e)$ 大约是 $0.693 - 1.308 = -0.615$。\n分子 $N \\approx -0.615 + 0.51 = -0.105$。分子是负数。\n一个更正式的论证是：我们希望证明 $f(1) > f(0)$，这等价于 $ared_k < 0$。这意味着我们必须证明 $\\ln(1+e) - 0.51 > \\ln(2)$，或者 $\\ln\\left(\\frac{1+e}{2}\\right) > 0.51$。这等价于 $\\frac{1+e}{2} > \\exp(0.51)$。\n使用已知界限 $2.71  e  2.72$，我们有 $3.71  1+e  3.72$，所以 $1.855  \\frac{1+e}{2}  1.86$。\n对于另一边，对 $x \\in (0,1)$ 使用不等式 $e^x  \\frac{1}{1-x}$，我们有 $\\exp(0.51)  \\frac{1}{1-0.51} = \\frac{1}{0.49} \\approx 2.04$。这个界限不够紧。\n使用 $e^x > 1+x$，我们有 $e^{0.51} > 1.51$。\n让我们使用来自泰勒级数的更紧的界限：$e^x \\approx 1+x+\\frac{x^2}{2}$。\n$e^{0.51} \\approx 1 + 0.51 + \\frac{0.51^2}{2} = 1.51 + \\frac{0.2601}{2} = 1.51+0.13005 = 1.64005$。\n$\\frac{1+e}{2}$ 的值约为 $1.859$，明显大于 $1.64$。\n因此，$f(1) > f(0)$，这意味着实际减少量 $ared_k = f(0)-f(1)$ 是负数。\n由于 $ared_k < 0$ 且 $pred_k = 0.005 > 0$，比率 $\\rho_k = \\frac{ared_k}{pred_k}$ 是负数。\n\n信赖域半径的更新策略如下：\n- 如果 $\\rho_k < 0$，则设置 $\\delta_{k+1} = 0.1\\,\\delta_k$，\n- 如果 $0 \\le \\rho_k < 0.25$，则设置 $\\delta_{k+1} = 0.5\\,\\delta_k$，\n- 如果 $\\rho_k \\ge 0.25$，则设置 $\\delta_{k+1} = 2\\,\\delta_k$。\n\n正如我们已经确定 $\\rho_k < 0$，应用第一条规则。\n给定 $\\delta_k = 1$，新的半径为：\n$$\n\\delta_{k+1} = 0.1 \\cdot \\delta_k = 0.1 \\cdot 1 = 0.1\n$$\n问题现已解决。下一个信赖域半径是 $0.1$。", "answer": "$$\n\\boxed{0.1}\n$$", "id": "2444749"}]}