{"hands_on_practices": [{"introduction": "掌握马科维茨模型的第一步是理解如何量化投资组合的风险。这个练习将直接应用投资组合方差公式于一个简单的双资产情景。通过这个计算，你将亲身体验资产权重、单个资产风险以及它们之间的相关性如何共同决定了整个投资组合的风险水平，这是构建和分析更复杂投资组合的基石 [@problem_id:2438015]。", "problem": "考虑一个计算金融中的投资组合，包含两种风险资产，其回报率分别为 $r_{1}$ 和 $r_{2}$。设回报率的标准差分别为 $\\sigma_{1} = 0.4$ 和 $\\sigma_{2} = 0.2$，相关系数为 $\\rho = 0.95$。投资组合中资产1的权重为 $w$，资产2的权重为 $1 - w$，且不允许卖空，因此 $w \\in [0,1]$。假设二阶矩存在，并使用定义 $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。确定 $w \\in [0,1]$ 的值，使得投资组合的方差等于目标水平 $0.085$。将你的答案四舍五入到 $6$ 位有效数字。", "solution": "该问题需要经过验证。\n\n**步骤1：提取已知条件**\n-   资产数量：$2$。\n-   回报率：$r_{1}$，$r_{2}$。\n-   资产1的标准差：$\\sigma_{1} = 0.4$。\n-   资产2的标准差：$\\sigma_{2} = 0.2$。\n-   回报率的相关系数：$\\rho = 0.95$。\n-   资产1的权重：$w$。\n-   资产2的权重：$1 - w$。\n-   权重约束：$w \\in [0,1]$。\n-   协方差定义：$\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。\n-   目标投资组合方差：$\\sigma_{p}^2 = 0.085$。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于现代金融学的基本概念——Markowitz投资组合理论。投资组合方差的公式是标准的。所有提供的常数在数值上都是合理的。该问题具有科学依据。\n-   **适定性**：问题要求找到一个特定的值 $w$ 以产生目标方差。这需要解一个关于 $w$ 的方程。该设定导出一个二次方程，这是一个适定的数学问题。\n-   **客观性**：问题使用了来自金融学和数学的精确、客观和标准的术语进行陈述。\n-   **完整性**：所有必要的数据（$\\sigma_1, \\sigma_2, \\rho$, 目标方差）和约束条件（$w \\in [0,1]$）都已提供，足以构建和解决问题。\n-   **一致性**：数据和条件是内部一致的。不存在矛盾。\n\n**步骤3：结论与行动**\n问题是有效的。将提供解答。\n\n一个包含两种资产、权重分别为 $w_{1}$ 和 $w_{2}$ 的投资组合的方差由以下公式给出：\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\operatorname{Cov}(r_{1}, r_{2})\n$$\n协方差定义为 $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。将其代入方差公式得到：\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\rho \\sigma_{1} \\sigma_{2}\n$$\n在这个问题中，权重为 $w_{1} = w$ 和 $w_{2} = 1 - w$。我们给定的值为：$\\sigma_{1} = 0.4$，$\\sigma_{2} = 0.2$，以及 $\\rho = 0.95$。\n让我们将这些值代入方差方程：\n$$\n\\sigma_{p}^2(w) = w^2 \\sigma_{1}^2 + (1-w)^2 \\sigma_{2}^2 + 2w(1-w)\\rho\\sigma_{1}\\sigma_{2}\n$$\n首先，我们计算所需的项：\n-   资产1的方差：$\\sigma_{1}^2 = (0.4)^2 = 0.16$。\n-   资产2的方差：$\\sigma_{2}^2 = (0.2)^2 = 0.04$。\n-   协方差项：$\\rho \\sigma_{1} \\sigma_{2} = (0.95)(0.4)(0.2) = 0.076$。\n\n现在，我们将这些数值代入 $\\sigma_{p}^2(w)$ 的表达式中：\n$$\n\\sigma_{p}^2(w) = w^2(0.16) + (1-w)^2(0.04) + 2w(1-w)(0.076)\n$$\n为了求出 $w$ 的值，我们展开并简化这个表达式：\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + (1 - 2w + w^2)(0.04) + (2w - 2w^2)(0.076)\n$$\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + 0.04 - 0.08w + 0.04w^2 + 0.152w - 0.152w^2\n$$\n按 $w$ 的幂次对各项进行分组：\n$$\n\\sigma_{p}^2(w) = (0.16 + 0.04 - 0.152)w^2 + (-0.08 + 0.152)w + 0.04\n$$\n$$\n\\sigma_{p}^2(w) = 0.048w^2 + 0.072w + 0.04\n$$\n问题要求投资组合的方差等于目标水平 $0.085$。我们将 $\\sigma_{p}^2(w)$ 的表达式设为这个值：\n$$\n0.048w^2 + 0.072w + 0.04 = 0.085\n$$\n这形成了一个二次方程。为了解出 $w$，我们将方程重新整理为标准形式 $Aw^2 + Bw + C = 0$：\n$$\n0.048w^2 + 0.072w + (0.04 - 0.085) = 0\n$$\n$$\n0.048w^2 + 0.072w - 0.045 = 0\n$$\n为了简化系数，我们可以将整个方程乘以 $1000$：\n$$\n48w^2 + 72w - 45 = 0\n$$\n这个方程可以通过将所有项除以它们的最大公约数 $3$ 来进一步简化：\n$$\n16w^2 + 24w - 15 = 0\n$$\n这个问题已经被简化为求解一个二次方程的根。虽然像二分法这样的数值算法可以近似求解根，但解析解是精确的，因此更优。我们应用二次公式 $w = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$，其中 $A=16$，$B=24$，$C=-15$。\n\n首先，计算判别式 $\\Delta = B^2 - 4AC$：\n$$\n\\Delta = (24)^2 - 4(16)(-15) = 576 + 960 = 1536\n$$\n现在，求 $w$ 的根：\n$$\nw = \\frac{-24 \\pm \\sqrt{1536}}{2(16)} = \\frac{-24 \\pm \\sqrt{256 \\times 6}}{32} = \\frac{-24 \\pm 16\\sqrt{6}}{32}\n$$\n简化 $w$ 的表达式：\n$$\nw = \\frac{-3 \\pm 2\\sqrt{6}}{4}\n$$\n这给出了 $w$ 的两个可能解：\n$$\nw_{1} = \\frac{-3 + 2\\sqrt{6}}{4} \\quad \\text{and} \\quad w_{2} = \\frac{-3 - 2\\sqrt{6}}{4}\n$$\n问题规定不允许卖空，这施加了约束条件 $w \\in [0,1]$。我们必须检查哪个解落在这个区间内。\n使用近似值 $\\sqrt{6} \\approx 2.449$：\n$$\nw_{1} \\approx \\frac{-3 + 2(2.449)}{4} = \\frac{-3 + 4.898}{4} = \\frac{1.898}{4} \\approx 0.4745\n$$\n这个解 $w_1$ 在区间 $[0,1]$ 内。\n$$\nw_{2} \\approx \\frac{-3 - 2(2.449)}{4} = \\frac{-3 - 4.898}{4} = \\frac{-7.898}{4} \\approx -1.9745\n$$\n这个解 $w_2$ 是负数，因此在允许的区间 $[0,1]$ 之外。它对应于资产1的空头头寸，这是被禁止的。\n\n因此，唯一有效的权重是 $w = \\frac{-3 + 2\\sqrt{6}}{4}$。\n问题要求一个四舍五入到 $6$ 位有效数字的数值答案。\n$$\nw = \\frac{-3 + 2\\sqrt{6}}{4} \\approx 0.474744871...\n$$\n将此值四舍五入到 $6$ 位有效数字，得到 $0.474745$。", "answer": "$$\n\\boxed{0.474745}\n$$", "id": "2438015"}, {"introduction": "仅仅计算风险是不够的，理解风险分散的深层逻辑更为关键。这个练习挑战了一个普遍的直觉：一项资产只有在提供高回报时才有价值。通过分析一个预期收益等于无风险利率的风险资产，本题将引导你认识到协方差在投资组合构建中的决定性作用，揭示了资产如何仅因其风险分散或对冲价值而被纳入最优投资组合中 [@problem_id:2442560]。", "problem": "考虑一个标准的均值-方差框架，其中有 $N \\ge 2$ 种风险资产，其超额收益向量为 $R - R_f \\mathbf{1}$，其中期望收益为 $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{R}]$，无风险利率为 $R_f$，$\\mathbf{1}$ 是 $N \\times 1$ 的全一向量，风险收益的协方差矩阵为 $\\boldsymbol{\\Sigma}$，该矩阵是对称正定的。假设投资者可以按无风险利率 $R_f$ 无限借入或贷出资金，并且允许卖空风险资产。支持资本配置线（CAL）的最优风险资产组合是唯一的切点投资组合。\n\n假设某一种特定的风险资产 $i$ 满足 $\\mathbb{E}[R_i] = R_f$ 且 $\\operatorname{Var}(R_i)  0$。\n\n下列关于切点投资组合构成的陈述中，哪些是正确的？\n\nA. 资产 $i$ 在切点投资组合中的权重必须为零，因为其独立的夏普比率为零。\n\nB. 尽管 $\\mathbb{E}[R_i] = R_f$，由于其与其他资产的协方差，资产 $i$ 在切点投资组合中仍可能获得非零权重。\n\nC. 如果不允许卖空，为了改善分散化，资产 $i$ 必须以严格为正的权重进入切点投资组合。\n\nD. 如果资产 $i$ 与所有其他风险资产不相关，那么它在切点投资组合中的权重为零。\n\nE. 相对于不包含资产 $i$ 的投资域，将资产 $i$ 加入可投资域不能改变资本配置线（CAL）的斜率。", "solution": "该问题陈述需经过验证。\n\n**步骤 1：提取已知条件**\n- 我们处于一个标准的均值-方差框架中。\n- 存在 $N \\ge 2$ 种风险资产。\n- 超额收益向量为 $\\mathbf{R} - R_f \\mathbf{1}$。\n- 期望收益向量为 $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{R}]$。\n- 无风险利率为 $R_f$。\n- $\\mathbf{1}$ 是 $N \\times 1$ 的全一向量。\n- 风险收益的协方差矩阵为 $\\boldsymbol{\\Sigma}$，该矩阵是对称且正定的。\n- 投资者可以按无风险利率 $R_f$ 无限借入或贷出。\n- 允许卖空风险资产。\n- 最优风险资产组合是支持资本配置线（CAL）的唯一切点投资组合。\n- 对于某一特定风险资产 $i$，给定条件为 $\\mathbb{E}[R_i] = R_f$ 且 $\\operatorname{Var}(R_i)  0$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，植根于成熟的 Markowitz 投资组合理论。均值-方差优化、切点投资组合和资本配置线的概念是金融经济学中的标准内容。语言精确客观。定义问题所需的所有要素均已提供：一组具有已知期望收益 $\\boldsymbol{\\mu}$ 和正定协方差矩阵 $\\boldsymbol{\\Sigma}$ 的风险资产，以及一种无风险资产。关于资产 $i$ 的条件，$\\mathbb{E}[R_i] = R_f$ 且 $\\operatorname{Var}(R_i)  0$，是此框架内一个具体且明确定义的场景。一个隐含的假设（对此类问题而言是标准的）是，并非所有风险资产的期望收益都等于无风险利率，即 $\\boldsymbol{\\mu} \\ne R_f \\mathbf{1}$，这确保了存在一个非平凡的切点投资组合。该问题定义明确且内部一致。\n\n**步骤 3：结论与行动**\n问题陈述有效。将推导解答。\n\n切点投资组合是使夏普比率最大化的风险资产组合。其权重向量 $\\mathbf{w}_{TP}$ 与导致最高夏普比率的无约束优化问题的解成正比。未归一化的权重，记为 $\\mathbf{w}^*$，由以下公式给出：\n$$ \\mathbf{w}^* = k \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e $$\n其中 $k$ 为某个正常数比例常数。此处，$\\boldsymbol{\\mu}_e$ 是相对于无风险利率的期望超额收益向量：\n$$ \\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - R_f \\mathbf{1} $$\n资产 $j$ 的单个未归一化权重 $w_j^*$ 由该向量乘积的第 $j$ 个分量给出：\n$$ w_j^* = k \\sum_{l=1}^N (\\boldsymbol{\\Sigma}^{-1})_{jl} (\\mu_l - R_f) $$\n我们关心的是资产 $i$ 的权重，对此我们有特定条件 $\\mu_i = \\mathbb{E}[R_i] = R_f$。这意味着期望超额收益向量的第 $i$ 个分量为零：$(\\boldsymbol{\\mu}_e)_i = \\mu_i - R_f = 0$。\n\n让我们写出资产 $i$ 的未归一化权重 $w_i^*$ 的表达式：\n$$ w_i^* = k \\sum_{l=1}^N (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) $$\n我们可以将 $l=i$ 的项从和式中分离出来：\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} (\\mu_i - R_f) + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) $$\n代入给定条件 $\\mu_i - R_f = 0$：\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} \\cdot 0 + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) = k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) $$\n归一化权重 $w_{i,TP}$ 是 $w_i^* / (\\mathbf{1}^T \\mathbf{w}^*)$。如果 $w_i^* = 0$，则 $w_{i,TP} = 0$。如果 $w_i^* \\ne 0$，则 $w_{i,TP} \\ne 0$，前提是切点投资组合本身是明确定义的（即 $\\mathbf{1}^T \\mathbf{w}^* \\ne 0$）。\n\n我们现在评估每个陈述。\n\n**A. 资产 $i$ 在切点投资组合中的权重必须为零，因为其独立的夏普比率为零。**\n资产 $i$ 的独立夏普比率确实为 $(\\mu_i - R_f) / \\sigma_i = 0$，因为 $\\mu_i=R_f$ 且 $\\sigma_i = \\sqrt{\\operatorname{Var}(R_i)}  0$。然而，其权重*必须*为零的结论是不正确的。我们推导出的 $w_i^*$ 公式为 $k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f)$。这个和式通常不等于零。对于 $l \\neq i$ 的项 $(\\boldsymbol{\\Sigma}^{-1})_{il}$ 是逆协方差矩阵的非对角元素，如果资产 $i$ 与其他资产相关，这些元素通常是非零的。如果至少有另一个资产 $l$ 的超额收益 $\\mu_l - R_f \\neq 0$，且其对应的逆协方差项 $(\\boldsymbol{\\Sigma}^{-1})_{il}$ 也非零，则权重 $w_i^*$ 可以是非零的。这种非零权重源于资产 $i$ 在投资组合中提供的分散化好处（或对冲作用），这无法通过其独立的特性来捕捉。\n**结论：错误。**\n\n**B. 尽管 $\\mathbb{E}[R_i] = R_f$，由于其与其他资产的协方差，资产 $i$ 在切点投资组合中仍可能获得非零权重。**\n该陈述声称 $w_i^*$ 有可能为非零。如通用公式 $w_i^* = k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f)$ 所示，非零权重确实是可能的。矩阵 $\\boldsymbol{\\Sigma}^{-1}$（精度矩阵）反映了资产的整个协方差结构。资产 $i$ 的非零权重将会出现，除非其他资产的超额收益的加权和（权重是精度矩阵第 $i$ 行的元素）恰好为零。这并非普遍情况。因此，资产 $i$ 与其他资产的协方差可以，并且通常会导致一个非零权重。\n**结论：正确。**\n\n**C. 如果不允许卖空，为了改善分散化，资产 $i$ 必须以严格为正的权重进入切点投资组合。**\n在所有 $j$ 都满足 $w_j \\ge 0$ 的约束下，解是使用库恩-塔克条件找到的。一个权重 $w_j=0$ 的资产 $j$ 只有在其对投资组合夏普比率的边际贡献为正时，才能以正权重进入投资组合。投资组合 $P$ 的夏普比率 $S_P$ 相对于微小增加资产 $i$ 的边际变化由 $\\frac{\\partial S_P}{\\partial w_i}$ 给出。由于 $\\mu_i - R_f = 0$，在 $w_i = 0$ 时，该导数简化为与 $-\\operatorname{Cov}(R_i, R_P)$ 成正比，其中 $R_P$ 是由其他资产形成的最优投资组合的收益。为了让资产 $i$ 以严格为正的权重进入，该导数必须为正。这要求 $\\operatorname{Cov}(R_i, R_P)  0$。也就是说，资产 $i$ 必须与由其他可用资产构成的切点投资组合呈负相关。这个条件并不总是满足。如果协方差为非负，资产 $i$ 的最优权重将为零。因此，它*必须*进入的说法是错误的。\n**结论：错误。**\n\n**D. 如果资产 $i$ 与所有其他风险资产不相关，那么它在切点投资组合中的权重为零。**\n资产 $i$ 与所有其他风险资产不相关的条件意味着对于所有 $l \\neq i$，$\\Sigma_{il} = \\operatorname{Cov}(R_i, R_l) = 0$。这意味着协方差矩阵 $\\boldsymbol{\\Sigma}$ 的第 $i$ 行和第 $i$ 列除了对角元素 $\\Sigma_{ii} = \\sigma_i^2$ 外，所有条目都为零。对于逆矩阵 $\\boldsymbol{\\Sigma}^{-1}$，这种结构意味着其第 $i$ 行和第 $i$ 列除了对角元素外也为零。具体来说，对于所有 $l \\neq i$，$(\\boldsymbol{\\Sigma}^{-1})_{il} = 0$，且 $(\\boldsymbol{\\Sigma}^{-1})_{ii} = 1/\\Sigma_{ii} = 1/\\sigma_i^2$。\n将此代入我们的 $w_i^*$ 公式中：\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} (\\mu_i - R_f) + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) $$\n$$ w_i^* = k \\left( \\frac{1}{\\sigma_i^2} \\cdot 0 + \\sum_{l \\neq i} 0 \\cdot (\\mu_l - R_f) \\right) = 0 $$\n由于未归一化的权重 $w_i^*$ 为零，归一化的权重 $w_{i,TP}$ 也必须为零。一个超额收益为零且与所有其他资产不相关的资产，既不提供回报溢价，也不提供分散化好处，因此从逻辑上应被排除在最优风险资产组合之外。\n**结论：正确。**\n\n**E. 相对于不包含资产 $i$ 的投资域，将资产 $i$ 加入可投资域不能改变资本配置线（CAL）的斜率。**\n资本配置线（CAL）的斜率是切点投资组合的夏普比率 $S_{TP}$。向投资域中添加一个新资产永远不会降低可达到的最大夏普比率；它要么使其保持不变，要么增加它。问题在于斜率是否可能增加。设 $S_A$ 是不含资产 $i$ 的投资域的最大夏普比率，而 $S_B$ 是包含资产 $i$ 的投资域的最大夏普比率。可以证明，两个平方夏普比率之间的关系是：\n$$ S_B^2 = S_A^2 + \\frac{(\\operatorname{Cov}(R_i, R_{TP_A}))^2 / \\sigma_{TP_A}^2}{\\sigma_i^2(1-\\rho_{i,TP_A}^2)} \\ge S_A^2 $$\n其中 $R_{TP_A}$ 是原始投资域的切点投资组合的回报，$\\rho_{i,TP_A}$ 是资产 $i$ 与该投资组合之间的相关性。夏普比率的增加（$S_B > S_A$）将会发生，除非 $\\operatorname{Cov}(R_i, R_{TP_A}) = 0$。在一般情况下，此协方差不为零。因此，加入资产 $i$ 通常会改变（增加）资本配置线（CAL）的斜率。声称它“不能改变”是错误的。\n**结论：错误。**", "answer": "$$\\boxed{BD}$$", "id": "2442560"}, {"introduction": "理论的优雅在现实世界中常常面临严峻的考验。马科维茨模型的输出质量完全取决于其输入参数——预期收益和协方差——而这些参数的准确估计是出了名的困难。这个编程练习 [@problem_id:2442584] 模拟了一个经典场景：一个基于历史数据优化的投资组合，在市场环境发生剧变（如金融危机）时，其表现可能逊于一个更简单的策略。这个练习为我们提供了关于模型风险和稳健投资组合构建重要性的深刻一课。", "problem": "给定一个包含 $N$ 种风险资产的设定。对于每种资产 $i \\in \\{1,\\dots,N\\}$，设危机前的预期收益为向量 $\\boldsymbol{\\mu}_{\\text{pre}} \\in \\mathbb{R}^N$ 的第 $i$ 个分量，危机前的收益协方差矩阵为 $\\boldsymbol{\\Sigma}_{\\text{pre}} \\in \\mathbb{R}^{N \\times N}$，该矩阵为对称正定矩阵。在金融危机期间，预期收益和协方差分别变为 $\\boldsymbol{\\mu}_{\\text{crisis}} \\in \\mathbb{R}^N$ 和 $\\boldsymbol{\\Sigma}_{\\text{crisis}} \\in \\mathbb{R}^{N \\times N}$。每期的无风险利率为 $r_f \\in \\mathbb{R}$。所有收益率必须以小数形式处理和报告（例如，$0.01$ 表示百分之一）。\n\n定义两种完全投资的投资组合：\n- 等权重投资组合，其权重对于所有 $i$ 均为 $w^{\\text{eq}}_i = \\frac{1}{N}$。\n- Markowitz最优投资组合（完全投资下的切线投资组合），由危机前参数计算得出，是最大化危机前夏普比率 $(\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{pre}} - r_f)/\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{pre}}\\boldsymbol{w}}$ 问题的解 $\\boldsymbol{w}^{\\star} \\in \\mathbb{R}^N$，约束条件为 $\\sum_{i=1}^{N} w_i = 1$。\n\n对于每个给定的测试用例，使用 $\\boldsymbol{\\mu}_{\\text{crisis}}$ 和 $\\boldsymbol{\\Sigma}_{\\text{crisis}}$ 计算两种投资组合的样本外危机时期夏普比率：\n$$\n\\text{SR}(\\boldsymbol{w}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f)\n= \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}}}.\n$$\n然后，为每个测试用例输出差值\n$$\n\\Delta = \\text{SR}(\\boldsymbol{w}^{\\text{eq}}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f) - \\text{SR}(\\boldsymbol{w}^{\\star}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f),\n$$\n四舍五入到 $6$ 位小数。\n\n使用以下测试套件，其中包含 $3$ 个用例，分别用于评估典型性能、相等条件和压力配置。在所有用例中，均使用 $r_f = 0.0$ 和 $N = 3$。\n\n- 测试用例 $1$（典型配置）：\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.010, 0.012, 0.008]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0004, 0.0005, 0.0003])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.025, -0.022, -0.010]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0015, 0.0009])$\n- 测试用例 $2$（所有资产相同的对称边界）：\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.010, 0.010, 0.010]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0004, 0.0004, 0.0004])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.020, -0.020, -0.020]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0012, 0.0012])$\n- 测试用例 $3$（危机前集中和不利的危机逆转的压力配置）：\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.020, 0.008, 0.006]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0003, 0.0006, 0.0005])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.040, -0.010, -0.012]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0024, 0.0020])$\n\n您的程序应生成单行输出，其中包含 $3$ 个测试用例的结果，格式为方括号内以逗号分隔的列表，例如 $[\\Delta_1,\\Delta_2,\\Delta_3]$，其中每个 $\\Delta_k$ 是一个四舍五入到 $6$ 位小数的浮点数。", "solution": "问题陈述已经过严谨分析。它内容自洽，科学上基于成熟的金融理论，数学上是适定的。所有参数均已提供，且无内部矛盾。因此，该问题被认定为有效，并将提供解决方案。\n\n任务是比较两种不同投资组合配置策略的样本外（危机时期）表现：一种是简单的等权重投资组合，另一种是 Markowitz 最优化的切线投资组合。表现指标是夏普比率。问题的核心在于，首先确定每种投资组合的资产权重，然后使用这些权重计算它们在危机条件下的各自的夏普比率。\n\n让我们定义一个包含 $N$ 种风险资产的市场的参数：\n- $\\boldsymbol{\\mu}_{\\text{pre}} \\in \\mathbb{R}^N$: 危机前的预期收益向量。\n- $\\boldsymbol{\\Sigma}_{\\text{pre}} \\in \\mathbb{R}^{N \\times N}$: 危机前的收益协方差矩阵。\n- $\\boldsymbol{\\mu}_{\\text{crisis}} \\in \\mathbb{R}^N$: 危机期间的预期收益向量。\n- $\\boldsymbol{\\Sigma}_{\\text{crisis}} \\in \\mathbb{R}^{N \\times N}$: 危机期间的收益协方差矩阵。\n- $r_f \\in \\mathbb{R}$: 无风险收益率。\n\n一个权重向量为 $\\boldsymbol{w} \\in \\mathbb{R}^N$ 的投资组合的夏普比率由下式给出\n$$\n\\text{SR}(\\boldsymbol{w}; \\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f) = \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}\\boldsymbol{w}}}\n$$\n其中 $\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}$ 是投资组合的预期收益，$\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}\\boldsymbol{w}}$ 是其标准差（波动率）。\n\n分析过程分为四个步骤。\n\n步骤 1：等权重投资组合（$\\boldsymbol{w}^{\\text{eq}}$）\n该投资组合通过将资本平均分配给所有 $N$ 种资产来构建。因此，每种资产 $i$ 的权重为 $w^{\\text{eq}}_i = \\frac{1}{N}$。权重向量为\n$$\n\\boldsymbol{w}^{\\text{eq}} = \\frac{1}{N}\\boldsymbol{1}\n$$\n其中 $\\boldsymbol{1}$ 是 $N$ 维全一向量。对于给定的问题，$N=3$，所以 $\\boldsymbol{w}^{\\text{eq}} = [1/3, 1/3, 1/3]^{\\top}$。\n\n步骤 2：Markowitz 最优化切线投资组合（$\\boldsymbol{w}^{\\star}$）\n这个投资组合 $\\boldsymbol{w}^{\\star}$ 是最大化危机前夏普比率问题的解，约束条件是投资组合被完全投资（$\\sum_{i=1}^{N} w_i = 1$）。该优化问题是：\n$$\n\\max_{\\boldsymbol{w}} \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{pre}} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{pre}}\\boldsymbol{w}}} \\quad \\text{subject to} \\quad \\boldsymbol{w}^{\\top}\\boldsymbol{1} = 1\n$$\n令 $\\boldsymbol{\\mu}_{\\text{excess}} = \\boldsymbol{\\mu}_{\\text{pre}} - r_f \\boldsymbol{1}$ 为危机前超出无风险利率的超额收益向量。该问题的解在投资组合理论中是公认的。未缩放的最优权重与 $\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}}$ 成正比。为满足完全投资约束，我们对这些权重进行归一化：\n$$\n\\boldsymbol{w}^{\\star} = \\frac{\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}}}{\\boldsymbol{1}^{\\top}(\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}})}\n$$\n该向量 $\\boldsymbol{w}^{\\star}$ 使用危机前参数计算得出。它代表了基于危机前可用信息的最优配置策略。\n\n步骤 3：计算样本外夏普比率\n我们需要评估两种投资组合在危机期间的表现。这意味着我们使用权重向量 $\\boldsymbol{w}^{\\text{eq}}$ 和 $\\boldsymbol{w}^{\\star}$（它们是固定的），并使用危机时期的参数 $\\boldsymbol{\\mu}_{\\text{crisis}}$ 和 $\\boldsymbol{\\Sigma}_{\\text{crisis}}$ 来计算它们的夏普比率。\n等权重投资组合的夏普比率为：\n$$\n\\text{SR}_{\\text{eq}} = \\frac{(\\boldsymbol{w}^{\\text{eq}})^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{(\\boldsymbol{w}^{\\text{eq}})^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}^{\\text{eq}}}}\n$$\nMarkowitz 投资组合的夏普比率为：\n$$\n\\text{SR}_{\\star} = \\frac{(\\boldsymbol{w}^{\\star})^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{(\\boldsymbol{w}^{\\star})^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}^{\\star}}}\n$$\n\n步骤 4：最终差值计算\n每个测试用例的最终输出是这两个样本外夏普比率之间的差值：\n$$\n\\Delta = \\text{SR}_{\\text{eq}} - \\text{SR}_{\\star}\n$$\n该量衡量了在样本外危机数据上评估时，朴素的等权重策略相比于 Markowitz 最优化策略的表现好多少（如果为正）或差多少（如果为负）。一个正的 $\\Delta$ 表明，简单的多样化投资比最优化的投资组合更具稳健性，后者很可能对未持续存在的危机前条件过度拟合。\n\n在实现方面，我们注意到所有提供的协方差矩阵都是对角矩阵。一个对角矩阵 $\\boldsymbol{\\Sigma} = \\mathrm{diag}([\\sigma_1^2, \\dots, \\sigma_N^2])$ 的逆矩阵也是对角的：$\\boldsymbol{\\Sigma}^{-1} = \\mathrm{diag}([1/\\sigma_1^2, \\dots, 1/\\sigma_N^2])$。这简化了 $\\boldsymbol{w}^{\\star}$ 的计算。对于所有测试用例，$N=3$ 且 $r_f=0.0$，这进一步将 $\\boldsymbol{\\mu}_{\\text{excess}}$ 简化为 $\\boldsymbol{\\mu}_{\\text{pre}}$。将使用这些公式为每个测试用例进行计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the portfolio performance comparison problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.010, 0.012, 0.008]),\n            \"Sigma_pre\": np.diag([0.0004, 0.0005, 0.0003]),\n            \"mu_crisis\": np.array([-0.025, -0.022, -0.010]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0015, 0.0009])\n        },\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.010, 0.010, 0.010]),\n            \"Sigma_pre\": np.diag([0.0004, 0.0004, 0.0004]),\n            \"mu_crisis\": np.array([-0.020, -0.020, -0.020]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0012, 0.0012])\n        },\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.020, 0.008, 0.006]),\n            \"Sigma_pre\": np.diag([0.0003, 0.0006, 0.0005]),\n            \"mu_crisis\": np.array([-0.040, -0.010, -0.012]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0024, 0.0020])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        r_f = case[\"r_f\"]\n        mu_pre = case[\"mu_pre\"]\n        Sigma_pre = case[\"Sigma_pre\"]\n        mu_crisis = case[\"mu_crisis\"]\n        Sigma_crisis = case[\"Sigma_crisis\"]\n\n        # 1. Define the equal-weight portfolio\n        w_eq = np.ones(N) / N\n\n        # 2. Compute the Markowitz-optimized portfolio (tangency portfolio)\n        # using pre-crisis parameters.\n        mu_excess_pre = mu_pre - r_f * np.ones(N)\n        Sigma_pre_inv = np.linalg.inv(Sigma_pre)\n        \n        # Unscaled weights for tangency portfolio\n        w_tilde = Sigma_pre_inv @ mu_excess_pre\n        \n        # Normalize weights to sum to 1\n        w_star = w_tilde / np.sum(w_tilde)\n\n        def calculate_sharpe_ratio(w, mu, Sigma, rf):\n            \"\"\"\n            Calculates the Sharpe ratio for a given portfolio and market parameters.\n            \"\"\"\n            portfolio_return = w.T @ mu\n            portfolio_variance = w.T @ Sigma @ w\n            if portfolio_variance == 0:\n                # Handle cases with zero or negative variance for numerical stability.\n                # A portfolio with zero volatility and positive excess return has infinite Sharpe ratio.\n                # Here, we expect positive variance.\n                return np.inf if portfolio_return - rf > 0 else -np.inf if portfolio_return - rf  0 else 0.0\n            \n            portfolio_std_dev = np.sqrt(portfolio_variance)\n            return (portfolio_return - rf) / portfolio_std_dev\n\n        # 3. Calculate out-of-sample Sharpe ratios using crisis parameters\n        sr_eq = calculate_sharpe_ratio(w_eq, mu_crisis, Sigma_crisis, r_f)\n        sr_star = calculate_sharpe_ratio(w_star, mu_crisis, Sigma_crisis, r_f)\n        \n        # 4. Compute the difference and round to 6 decimals\n        delta = sr_eq - sr_star\n        results.append(round(delta, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2442584"}]}