{"hands_on_practices": [{"introduction": "理论模型通常假设资产回报在时间上是独立同分布的（IID），但这在现实世界中往往不成立。资产回报可能表现出短期自相关，即今天的回报可能与昨天的回报相关。这个练习将指导您如何调整风险计算，当回报不再是时间上独立时，这对准确评估风险和构建资本配置线（CAL）至关重要 [@problem_id:2438505]。", "problem": "一位投资者评估一项风险资产，其单日算术回报率（记为第 $t$ 天的 $r_{t}$）是协方差平稳的，满足 $\\mathbb{E}[r_{t}] = \\mu_{d}$，$\\operatorname{Var}(r_{t}) = \\sigma_{d}^{2}$，以及一阶自相关 $\\operatorname{Corr}(r_{t}, r_{t-1}) = \\rho$。假设对于所有 $k \\geq 2$，$\\operatorname{Cov}(r_{t}, r_{t-k}) = 0$。该投资者的单一决策期为 $n$ 个交易日，并且为了进行均值-方差分析，该风险资产的单期算术回报率定义为 $n$ 日累计算术回报率\n$$\nR_{n} \\equiv \\sum_{t=1}^{n} r_{t}.\n$$\n$n$ 日无风险简单回报率为已知常数 $R_{f,n}$。投资者通过将财富的 $y$ 份投资于风险资产，将 $1-y$ 份投资于无风险资产，来构建一个为期一个周期的投资组合。此风险资产与无风险资产的资本配置线（CAL）是当 $y$ 变化时所有可达到的组合 $\\big(\\sigma_{p}(y), \\mathbb{E}[R_{p}(y)]\\big)$ 的集合，其中 $R_{p}(y)$ 是单期投资组合的算术回报率，而 $\\sigma_{p}(y)$ 是其标准差。\n\n给定参数\n- $\\mu_{d} = 5 \\times 10^{-4}$,\n- $\\sigma_{d} = 10^{-2}$,\n- $\\rho = 0.2$,\n- $n = 20$,\n- $R_{f,n} = 2 \\times 10^{-3}$,\n\n计算资本配置线的斜率，其定义为\n$$\nS \\equiv \\frac{\\mathbb{E}[R_{n}] - R_{f,n}}{\\sigma_{n}},\n$$\n其中 $\\sigma_{n} \\equiv \\sqrt{\\operatorname{Var}(R_{n})}$ 是根据给定的自相关进行调整后的 $n$ 日累计算术回报率的标准差。\n\n将 $S$ 的最终数值表示为小数，并四舍五入到四位有效数字。", "solution": "资本配置线（CAL）描述了在单个决策期内，一项风险资产和一项无风险资产的所有线性组合。当只有一项风险资产和一项无风险资产时，单期投资组合的算术回报率为 $R_{p}(y) = y R_{n} + (1-y) R_{f,n}$，因此 $\\mathbb{E}[R_{p}(y)] = R_{f,n} + y\\big(\\mathbb{E}[R_{n}] - R_{f,n}\\big)$ 且 $\\sigma_{p}(y) = |y|\\,\\sigma_{n}$，因为无风险回报率是非随机的。因此，CAL 的斜率等于该时期内风险资产的夏普比率：\n$$\nS = \\frac{\\mathbb{E}[R_{n}] - R_{f,n}}{\\sigma_{n}}.\n$$\n\n为了在计算 $\\sigma_{n}$ 时对自相关进行调整，我们从协方差平稳过程中和的方差开始。根据定义，\n$$\nR_{n} = \\sum_{t=1}^{n} r_{t}, \\quad \\mathbb{E}[R_{n}] = \\sum_{t=1}^{n} \\mathbb{E}[r_{t}] = n \\mu_{d}.\n$$\n方差为\n$$\n\\operatorname{Var}(R_{n}) = \\operatorname{Var}\\!\\Big(\\sum_{t=1}^{n} r_{t}\\Big) = \\sum_{t=1}^{n} \\operatorname{Var}(r_{t}) + 2 \\sum_{1 \\leq i  j \\leq n} \\operatorname{Cov}(r_{i}, r_{j}).\n$$\n设 $\\gamma_{k} \\equiv \\operatorname{Cov}(r_{t}, r_{t-k})$ 对于 $k \\geq 0$。在协方差平稳性下，$\\gamma_{0} = \\sigma_{d}^{2}$，并且根据给定假设，$\\gamma_{1} = \\rho \\sigma_{d}^{2}$ 且对于所有 $k \\geq 2$，$\\gamma_{k} = 0$。那么只有滞后-0 和滞后-1 的项有贡献：\n- 有 $n$ 个滞后-0 项，其和为 $n \\sigma_{d}^{2}$。\n- 有 $(n-1)$ 个不同的滞后-1 对 $(i,j)$ 满足 $j=i+1$，由于 $(i,j)$ 和 $(j,i)$ 的对称性，每一对在双重求和中出现两次，贡献了 $2(n-1)\\gamma_{1} = 2(n-1)\\rho \\sigma_{d}^{2}$。\n\n因此，\n$$\n\\operatorname{Var}(R_{n}) = n \\sigma_{d}^{2} + 2(n-1)\\rho \\sigma_{d}^{2} = \\sigma_{d}^{2}\\Big[n + 2(n-1)\\rho\\Big],\n$$\n并且\n$$\n\\sigma_{n} = \\sigma_{d}\\,\\sqrt{n + 2(n-1)\\rho}.\n$$\n\n现在代入给定值：\n- $\\mu_{d} = 5 \\times 10^{-4}$,\n- $\\sigma_{d} = 10^{-2}$,\n- $\\rho = 0.2$,\n- $n = 20$,\n- $R_{f,n} = 2 \\times 10^{-3}$.\n\n计算均值：\n$$\n\\mathbb{E}[R_{n}] = n \\mu_{d} = 20 \\times 5 \\times 10^{-4} = 1.0 \\times 10^{-2}.\n$$\n计算标准差：\n$$\n\\sigma_{n} = 10^{-2} \\sqrt{20 + 2 \\times 19 \\times 0.2} = 10^{-2} \\sqrt{20 + 7.6} = 10^{-2} \\sqrt{27.6}.\n$$\n因此，\n$$\nS = \\frac{1.0 \\times 10^{-2} - 2 \\times 10^{-3}}{10^{-2} \\sqrt{27.6}} = \\frac{8.0 \\times 10^{-3}}{10^{-2} \\sqrt{27.6}} = \\frac{0.8}{\\sqrt{27.6}}.\n$$\n进行数值计算：\n$$\n\\sqrt{27.6} \\approx 5.2536,\\quad S \\approx \\frac{0.8}{5.2536} \\approx 0.1523.\n$$\n四舍五入到四位有效数字，$S = 0.1523$。", "answer": "$$\\boxed{0.1523}$$", "id": "2438505"}, {"introduction": "“无风险”资产真的没有风险吗？虽然国库券在名义上是无风险的，但其真实的、经通货膨胀调整后的回报却是不确定的。本练习探讨了通货膨胀风险如何影响名义上无风险资产的真实回报，并揭示了这对真实资本配置线（real CAL）几何形状的影响 [@problem_id:2438498]。通过这个实践，您将学会量化这种风险，并理解为何在真实回报的框架下，资本配置线不再从一个清晰的无风险点出发。", "problem": "一位投资者以实际（经通胀调整的）价值评估单期投资组合选择。名义无风险资产是一种国库券，其在该期间内支付一定的名义简单回报率为 $r_f^{N} = 0.03$。设总通货膨胀率为 $I \\equiv 1 + \\pi$，其中 $\\ln I \\sim \\mathcal{N}(\\mu_I, \\sigma_I^2)$，参数为 $\\mu_I = 0.02$ 和 $\\sigma_I = 0.04$。假设 $I$ 在统计上独立于国库券的名义支付，也独立于任何风险资产的名义回报。国库券的事后实际简单回报率定义为 $R_f^{\\text{real}} \\equiv \\dfrac{1 + r_f^{N}}{I} - 1$。在以实际价值表示的均值-标准差图中，资本配置线（CAL）是通过将名义国库券和风险市场投资组合（两者均以实际价值评估）进行线性组合而获得的均值-方差组合的集合。\n\n哪个选项正确地量化了 $R_f^{\\text{real}}$ 的期望值和标准差，并说明了其对实际资本配置线 y 轴截距的影响？\n\nA. $\\mathbb{E}[R_f^{\\text{real}}] \\approx r_f^{N} - \\mathbb{E}[\\pi] \\approx 0.0090$，$\\operatorname{sd}(R_f^{\\text{real}}) = 0$。实际资本配置线仍然在约 $0.90\\%$ 处与 y 轴锐利相交。\n\nB. $\\mathbb{E}[R_f^{\\text{real}}] = (1 + r_f^{N})\\,\\mathbb{E}\\!\\left[\\dfrac{1}{I}\\right] - 1 \\approx 0.0104$ 且 $\\operatorname{sd}(R_f^{\\text{real}}) = (1 + r_f^{N})\\sqrt{\\operatorname{Var}\\!\\left(\\dfrac{1}{I}\\right)} \\approx 0.0405$。因此，实际的“无风险”点具有正的水平离散度；实际资本配置线的 y 轴截距不再是 y 轴上的一个锐点，而是变成一个中心在 $1.04\\%$ 附近、具有非零水平宽度的弥散带。\n\nC. $\\mathbb{E}[R_f^{\\text{real}}] = \\dfrac{1 + r_f^{N}}{1 + \\mathbb{E}[\\pi]} - 1 \\approx 0.0088$ 且 $\\operatorname{sd}(R_f^{\\text{real}}) \\approx 0.0400$。通货膨胀风险在大型投资组合中被分散掉，因此实际资本配置线的 y 轴截距不受影响。\n\nD. $\\mathbb{E}[R_f^{\\text{real}}] = r_f^{N} = 0.03$ 而由于通货膨胀 $\\operatorname{sd}(R_f^{\\text{real}})  0$。实际资本配置线的 y 轴截距保持在 $3\\%$，但随着风险资产波动性的增加，资本配置线旋转以获得更小的斜率。", "solution": "问题陈述是计算金融学中的一个有效练习。它具有科学依据，是适定的和客观的。为获得唯一解提供了所有必要的数据和定义。\n\n问题要求计算名义国库券的实际简单回报率的期望值和标准差，以及其对以实际价值表示的资本配置线（CAL）的影响。\n\n首先，我们定义并分析实际简单回报率的随机变量 $R_f^{\\text{real}}$。\n给定数据：\n名义无风险简单回报率为 $r_f^{N} = 0.03$。\n因此，国库券的总名义回报率为 $1 + r_f^{N} = 1.03$，这是一个常数。\n总通货膨胀率为 $I \\equiv 1 + \\pi$。\n总通货膨胀率的对数分布为 $\\ln I \\sim \\mathcal{N}(\\mu_I, \\sigma_I^2)$，参数为 $\\mu_I = 0.02$ 和 $\\sigma_I = 0.04$。\n这意味着 $I$ 服从对数正态分布。\n国库券的事后实际简单回报率定义为：\n$$R_f^{\\text{real}} = \\frac{1 + r_f^{N}}{I} - 1 = \\frac{1.03}{I} - 1$$\n为了找到 $R_f^{\\text{real}}$ 的期望值和标准差，我们需要随机变量 $1/I$ 的前两阶矩。\n设 $X = \\ln I$。我们已知 $X \\sim \\mathcal{N}(\\mu_I, \\sigma_I^2)$。\n我们感兴趣的变量是 $1/I = e^{-\\ln I} = e^{-X}$。\n由于 $X$ 是正态分布的，$-X$ 也是正态分布的：$-X \\sim \\mathcal{N}(-\\mu_I, \\sigma_I^2)$。\n因此，$1/I$ 是一个服从对数正态分布的随机变量。\n\n一个对数正态变量 $Y = e^W$ 的 k 阶矩（其中 $W \\sim \\mathcal{N}(\\mu_W, \\sigma_W^2)$）由 $\\mathbb{E}[Y^k] = e^{k\\mu_W + \\frac{1}{2}k^2\\sigma_W^2}$ 给出。\n对于我们的变量 $1/I$，其基础正态变量是 $W = -X$，其中 $\\mu_W = -\\mu_I = -0.02$ 且 $\\sigma_W = \\sigma_I = 0.04$。\n\n$1/I$ 的期望值是其一阶矩 ($k=1$):\n$$\\mathbb{E}\\left[\\frac{1}{I}\\right] = e^{1 \\cdot (-\\mu_I) + \\frac{1}{2}(1)^2\\sigma_I^2} = e^{-\\mu_I + \\frac{1}{2}\\sigma_I^2}$$\n代入给定值：\n$$\\mathbb{E}\\left[\\frac{1}{I}\\right] = e^{-0.02 + \\frac{1}{2}(0.04)^2} = e^{-0.02 + \\frac{1}{2}(0.0016)} = e^{-0.02 + 0.0008} = e^{-0.0192}$$\n$$e^{-0.0192} \\approx 0.9809904$$\n现在，我们可以计算实际回报率的期望值：\n$$\\mathbb{E}[R_f^{\\text{real}}] = \\mathbb{E}\\left[\\frac{1.03}{I} - 1\\right] = 1.03 \\cdot \\mathbb{E}\\left[\\frac{1}{I}\\right] - 1$$\n$$\\mathbb{E}[R_f^{\\text{real}}] = 1.03 \\cdot e^{-0.0192} - 1 \\approx 1.03 \\cdot (0.9809904) - 1$$\n$$\\mathbb{E}[R_f^{\\text{real}}] \\approx 1.0104199 - 1 = 0.0104199 \\approx 0.0104$$\n\n接下来，我们计算标准差 $\\operatorname{sd}(R_f^{\\text{real}})$。首先，我们求方差 $\\operatorname{Var}(R_f^{\\text{real}})$。\n$$\\operatorname{Var}(R_f^{\\text{real}}) = \\operatorname{Var}\\left(\\frac{1.03}{I} - 1\\right) = \\operatorname{Var}\\left(\\frac{1.03}{I}\\right) = (1.03)^2 \\operatorname{Var}\\left(\\frac{1}{I}\\right)$$\n对数正态变量 $Y$ 的方差可以计算为 $\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2$。\n我们需要 $1/I$ 的二阶矩 ($k=2$)：\n$$\\mathbb{E}\\left[\\left(\\frac{1}{I}\\right)^2\\right] = e^{2 \\cdot (-\\mu_I) + \\frac{1}{2}(2)^2\\sigma_I^2} = e^{-2\\mu_I + 2\\sigma_I^2}$$\n代入这些值：\n$$\\mathbb{E}\\left[\\left(\\frac{1}{I}\\right)^2\\right] = e^{-2(0.02) + 2(0.04)^2} = e^{-0.04 + 2(0.0016)} = e^{-0.04 + 0.0032} = e^{-0.0368}$$\n$$e^{-0.0368} \\approx 0.9638703$$\n我们已经求得 $(\\mathbb{E}[1/I])^2 = (e^{-0.0192})^2 = e^{-0.0384} \\approx (0.9809904)^2 \\approx 0.9623422$。\n所以，$1/I$ 的方差是：\n$$\\operatorname{Var}\\left(\\frac{1}{I}\\right) = \\mathbb{E}\\left[\\left(\\frac{1}{I}\\right)^2\\right] - \\left(\\mathbb{E}\\left[\\frac{1}{I}\\right]\\right)^2 = e^{-0.0368} - e^{-0.0384}$$\n$$\\operatorname{Var}\\left(\\frac{1}{I}\\right) \\approx 0.9638703 - 0.9623319 = 0.0015384$$\n现在，将此代入 $R_f^{\\text{real}}$ 的方差表达式中：\n$$\\operatorname{Var}(R_f^{\\text{real}}) = (1.03)^2 \\cdot \\operatorname{Var}\\left(\\frac{1}{I}\\right) \\approx 1.0609 \\cdot (0.0015384) \\approx 0.0016321$$\n标准差是方差的平方根：\n$$\\operatorname{sd}(R_f^{\\text{real}}) = \\sqrt{\\operatorname{Var}(R_f^{\\text{real}})} \\approx \\sqrt{0.0016321} \\approx 0.040399$$\n四舍五入到四位小数，我们得到 $\\operatorname{sd}(R_f^{\\text{real}}) \\approx 0.0404$。\n\n对实际资本配置线的影响：在标准的均值-标准差图中，一个轴是期望回报率 $\\mathbb{E}[R]$，另一个轴是标准差 $\\operatorname{sd}(R)$，无风险资产是纵轴（y轴）上的一个点，因为其标准差为零。资本配置线是从该点出发并与风险资产的有效前沿相切的线。\n在本题中，名义国库券仅在名义上是无风险的。当其回报率转换为实际价值时，它会受到通货膨胀风险的影响。正如我们计算的，其真实回报率的标准差为 $\\operatorname{sd}(R_f^{\\text{real}}) \\approx 0.0404$，这是非零的。\n因此，在以实际价值表示的均值-标准差图中，国库券不再是无风险资产。它是一个风险资产，由点 $(\\sigma, \\mu) = (\\operatorname{sd}(R_f^{\\text{real}}), \\mathbb{E}[R_f^{\\text{real}}]) \\approx (0.0404, 0.0104)$ 表示。\n这个点不在 y 轴上。由该资产与风险市场投资组合构成的“实际资本配置线”是一条连接风险 $(\\sigma0)$ 平面中两点的曲线（除非相关性是完美的，否则为双曲线）。它没有传统意义上的无风险利率的 y 轴截距。资本配置线的基础已经从一个无风险点转移到一个风险点。\n\n现在，我们评估每个选项：\n\n**A. $\\mathbb{E}[R_f^{\\text{real}}] \\approx r_f^{N} - \\mathbb{E}[\\pi] \\approx 0.0090$，$\\operatorname{sd}(R_f^{\\text{real}}) = 0$。实际资本配置线仍然在约 $0.90\\%$ 处与 y 轴锐利相交。**\n期望回报率的计算使用了一阶费雪近似，这不如精确公式精确。更关键的是，它错误地指出实际回报率的标准差为零。由于通货膨胀是不确定的，名义资产的实际回报率也是不确定的。对资本配置线的影响也是错误的，因为该资产在实际价值上不是无风险的。\n结论：**错误**。\n\n**B. $\\mathbb{E}[R_f^{\\text{real}}] = (1 + r_f^{N})\\,\\mathbb{E}\\!\\left[\\dfrac{1}{I}\\right] - 1 \\approx 0.0104$ 且 $\\operatorname{sd}(R_f^{\\text{real}}) = (1 + r_f^{N})\\sqrt{\\operatorname{Var}\\!\\left(\\dfrac{1}{I}\\right)} \\approx 0.0405$。因此，实际的“无风险”点具有正的水平离散度；实际资本配置线的 y 轴截距不再是 y 轴上的一个锐点，而是变成一个中心在 $1.04\\%$ 附近、具有非零水平宽度的弥散带。**\n期望值的公式是正确的，数值 $\\approx 0.0104$ 与我们的计算相符。标准差的公式也是正确的。我们的计算得出 $\\approx 0.0404$，这与提供的数值 $0.0405$ 非常接近；微小的差异可能是由于问题构建过程中的四舍五入造成的。对其影响的定性描述是准确的：所谓的“无风险”资产现在具有正的标准差（“水平离散度”），因此不是 y 轴上的一个点。将这种变化描述为变成一个“弥散带”是一种非技术性但概念上正确的表达方式，说明确定的无风险锚点已经消失。\n结论：**正确**。\n\n**C. $\\mathbb{E}[R_f^{\\text{real}}] = \\dfrac{1 + r_f^{N}}{1 + \\mathbb{E}[\\pi]} - 1 \\approx 0.0088$ 且 $\\operatorname{sd}(R_f^{\\text{real}}) \\approx 0.0400$。通货膨胀风险在大型投资组合中被分散掉，因此实际资本配置线的 y 轴截距不受影响。**\n期望值的公式是错误的；这是对期望的错误应用，因为 $\\mathbb{E}[1/I] \\neq 1/\\mathbb{E}[I]$。标准差值 $0.0400$ 是一个常见但不太精确的近似值 ($\\operatorname{sd}(R_f^{\\text{real}}) \\approx \\sigma_I$)。关于通货膨胀风险可以通过分散化消除的说法是根本错误的。通货膨胀是系统性风险的来源，因为它影响经济中所有名义合同的实际价值。它不能通过投资组合多样化来消除。\n结论：**错误**。\n\n**D. $\\mathbb{E}[R_f^{\\text{real}}] = r_f^{N} = 0.03$ 而由于通货膨胀 $\\operatorname{sd}(R_f^{\\text{real}})  0$。实际资本配置线的 y 轴截距保持在 $3\\%$，但随着风险资产波动性的增加，资本配置线旋转以获得更小的斜率。**\n这个选项错误地声称预期实际回报率等于名义无风险利率，完全忽略了通货膨胀的影响。虽然它正确地指出标准差大于零，但其 y 轴截距保持在 $3\\%$ 的结论是矛盾的。如果标准差为正，该点就不可能在 y 轴上。\n结论：**错误**。", "answer": "$$\\boxed{B}$$", "id": "2438498"}, {"introduction": "从理论转向实践，我们如何在一个包含数十甚至数百种资产的世界中找到最优的切点投资组合？对于大型投资组合来说，解析求解变得不切实际，数值方法成为必需。这个编程练习将让您亲身体验专业人士用来执行大规模投资组合优化的计算方法，通过编写代码找到切点投资组合并构建资本市场线（CML）[@problem_id:2438483]。", "problem": "给定一个包含$50$种风险资产的投资域。设$R$为资产回报率的$50 \\times 50$相关系数矩阵，$\\sigma \\in \\mathbb{R}^{50}$为资产标准差向量，$\\mu \\in \\mathbb{R}^{50}$为预期回报率向量（均以小数而非百分比表示），$\\Sigma = D R D$为协方差矩阵，其中$D = \\operatorname{diag}(\\sigma)$。存在一个无风险利率$r_f \\in \\mathbb{R}$（也以小数表示）。考虑由无风险资产和切点投资组合构成的资本配置线（CAL），在均衡状态下也称为资本市场线（CML）。\n\n将切点投资组合$w^\\star \\in \\mathbb{R}^{50}$定义为最大化夏普比率的最优化问题的解，允许卖空并满足预算约束：\n- 在$w \\in \\mathbb{R}^{50}$上最大化$(\\mu^\\top w - r_f)/\\sqrt{w^\\top \\Sigma w}$，\n- 约束条件为$\\mathbf{1}^\\top w = 1$，其中$\\mathbf{1}$是$\\mathbb{R}^{50}$中的全一向量。\n\n设资本配置线（CAL）的斜率为$S = (\\mu^\\top w^\\star - r_f)/\\sqrt{(w^\\star)^\\top \\Sigma w^\\star}$。对于任何目标标准差$\\bar{\\sigma} \\ge 0$，CAL上的预期回报率为$E_{\\text{CAL}}(\\bar{\\sigma}) = r_f + S \\, \\bar{\\sigma}$。\n\n对于下方的每个测试案例，你必须：\n- 按规定构建$R$、$\\sigma$、$\\mu$和$\\Sigma$；\n- 在约束$\\mathbf{1}^\\top w^\\star = 1$下（允许卖空），为给定的$r_f$计算切点投资组合$w^\\star$；\n- 为目标标准差$\\bar{\\sigma} \\in \\{0.0, 0.05, 0.15\\}$计算CAL斜率$S$和CAL预期回报率$E_{\\text{CAL}}(\\bar{\\sigma})$。\n\n所有回报率和标准差都是无单位的小数。报告所有浮点输出时，四舍五入至$6$位小数。\n\n每个案例的测试套件和数据构建方法：\n- 对于给定的种子$s \\in \\mathbb{Z}$，使用该种子定义一个随机数生成器。生成一个$A \\in \\mathbb{R}^{50 \\times 50}$矩阵，其元素为独立的标准正态分布。设$M = A A^\\top$。通过$R_{ij} = M_{ij}/\\sqrt{M_{ii} M_{jj}}$对所有$i,j$定义相关系数矩阵。对于每个$i \\in \\{1,\\dots,50\\}$，从$[0.05, 0.35]$的连续均匀分布中独立抽取$\\sigma_i$。对于每个$i \\in \\{1,\\dots,50\\}$，从$[0.02, 0.18]$的连续均匀分布中独立抽取$\\mu_i$。设$D = \\operatorname{diag}(\\sigma)$和$\\Sigma = D R D$。\n- 使用以下测试案例：\n    1. 案例1：种子$s=7$，无风险利率$r_f = 0.02$。\n    2. 案例2：种子$s=11$，无风险利率$r_f = 0.00$。\n    3. 案例3：种子$s=13$，无风险利率$r_f = -0.01$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试案例，输出列表$[S, E_{\\text{CAL}}(0.0), E_{\\text{CAL}}(0.05), E_{\\text{CAL}}(0.15)]$，其中每个条目都四舍五入到$6$位小数。总输出必须是一个包含按顺序排列的三个测试案例结果的单一列表。例如，最终输出格式必须为：\n[[S1,E1_0.0,E1_0.05,E1_0.15],[S2,E2_0.0,E2_0.05,E2_0.15],[S3,E3_0.0,E3_0.05,E3_0.15]]。", "solution": "该问题陈述经验证在科学上是合理的、提法是恰当的、客观的且自包含的。它描述了现代投资组合理论中的一个标准问题：确定资本配置线（CAL）。我们将进行完整的推导和计算求解。\n\n基本任务是找到“切点投资组合”，即与无风险资产结合时能提供最佳风险-回报权衡的风险资产投资组合。该投资组合位于风险资产有效前沿与预期回报率-标准差平面上从无风险利率点出发的切线的切点处。这条线就是资本配置线。CAL的斜率是切点投资组合的夏普比率。\n\n设 $w \\in \\mathbb{R}^{50}$ 为 $50$ 种风险资产的权重向量，使得权重之和为一：$\\mathbf{1}^\\top w = 1$，其中 $\\mathbf{1}$ 是全一向量。允许卖空，所以 $w_i \\in \\mathbb{R}$。这样一个投资组合的预期回报率为 $E[R_p] = \\mu^\\top w$，其方差为 $\\sigma_p^2 = w^\\top \\Sigma w$，其中 $\\mu$ 是预期回报率向量，$\\Sigma$ 是资产回报率的协方差矩阵。\n\n目标是最大化风险资产投资组合的夏普比率 $S_p$：\n$$ \\text{maximize}_{w} \\quad S_p(w) = \\frac{\\mu^\\top w - r_f}{\\sqrt{w^\\top \\Sigma w}} $$\n受预算约束：\n$$ \\mathbf{1}^\\top w = 1 $$\n其中 $r_f$ 是无风险回报率。\n\n设 $\\mu_e = \\mu - r_f \\mathbf{1}$ 为超额预期回报率（超过无风险利率）的向量。目标函数变为最大化 $(\\mu_e^\\top w)/\\sqrt{w^\\top \\Sigma w}$。投资组合理论中的一个已知结果是，此问题的解是一个权重 $w$ 与 $\\Sigma^{-1} \\mu_e}$ 成比例的投资组合。这可以通过求解一个等价的最优化问题来正式证明：对于固定的超额回报水平 $\\mu_e^\\top w = C}$（其中 $C  0$ 为某个常数），最小化方差 $\\frac{1}{2} w^\\top \\Sigma w}$。这个等价问题的拉格朗日函数是 $\\mathcal{L}(w, \\lambda) = \\frac{1}{2} w^\\top \\Sigma w - \\lambda (\\mu_e^\\top w - C)$。\n对 $w$ 求导并设为零，得到一阶条件：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial w} = \\Sigma w - \\lambda \\mu_e = 0 $$\n假设 $\\Sigma$ 是可逆的（根据指定的构造方法，其可逆概率为 $1$），我们发现任何此类最优投资组合的权重都具有以下形式：\n$$ w = \\lambda \\Sigma^{-1} \\mu_e $$\n这意味着切点投资组合 $w^\\star$ 的权重与我们记为 $w_{\\text{unscaled}} = \\Sigma^{-1} \\mu_e}$ 的向量成比例。\n\n为了找到满足预算约束 $\\mathbf{1}^\\top w^\\star = 1$ 的特定权重 $w^\\star$，我们必须对这个未归一化的权重向量进行归一化。设 $k = \\mathbf{1}^\\top w_{\\text{unscaled}}$ 为未归一化权重的总和。归一化后的切点投资组合权重为：\n$$ w^\\star = \\frac{w_{\\text{unscaled}}}{k} = \\frac{\\Sigma^{-1} \\mu_e}{\\mathbf{1}^\\top (\\Sigma^{-1} \\mu_e)} = \\frac{\\Sigma^{-1} (\\mu - r_f \\mathbf{1})}{\\mathbf{1}^\\top \\Sigma^{-1} (\\mu - r_f \\mathbf{1})} $$\n在计算上，解线性方程组 $\\Sigma w_{\\text{unscaled}} = \\mu_e}$ 来求 $w_{\\text{unscaled}}$ 比直接计算 $\\Sigma}$ 的逆矩阵在数值上更稳定。\n\n一旦确定了切点投资组合的权重 $w^\\star$，我们就可以计算其预期回报率 $\\mu_p^\\star = \\mu^\\top w^\\star$ 和标准差 $\\sigma_p^\\star = \\sqrt{(w^\\star)^\\top \\Sigma w^\\star}$。\n\n资本配置线的斜率 $S$ 是该切点投资组合的夏普比率：\n$$ S = \\frac{\\mu_p^\\star - r_f}{\\sigma_p^\\star} = \\frac{\\mu^\\top w^\\star - r_f}{\\sqrt{(w^\\star)^\\top \\Sigma w^\\star}} $$\n\n最后，对于给定的目标标准差 $\\bar{\\sigma} \\ge 0$，CAL上的预期回报率由以下线性关系给出：\n$$ E_{\\text{CAL}}(\\bar{\\sigma}) = r_f + S \\cdot \\bar{\\sigma} $$\n此公式描述了通过将一定比例的资本分配给切点投资组合，其余部分分配给无风险资产而形成的完整投资组合的预期回报率。对于 $\\bar{\\sigma} = 0.0$，投资组合 $100\\%$ 投资于无风险资产，且 $E_{\\text{CAL}}(0.0) = r_f$。\n\n每个测试案例的算法如下：\n1.  使用给定的种子 $s$ 初始化一个随机数生成器。\n2.  生成一个 $50 \\times 50$ 的标准正态随机变量矩阵 $A$，其元素来自 $\\mathcal{N}(0, 1)$。\n3.  计算 $M = A A^\\top$。\n4.  构造相关系数矩阵 $R$，其中 $R_{ij} = M_{ij} / \\sqrt{M_{ii} M_{jj}}$。\n5.  从 $U(0.05, 0.35)$ 生成标准差向量 $\\sigma$，并从 $U(0.02, 0.18)$ 生成预期回报率向量 $\\mu$。\n6.  构造协方差矩阵 $\\Sigma = D R D$，其中 $D = \\operatorname{diag}(\\sigma)$。\n7.  计算超额回报向量 $\\mu_e = \\mu - r_f \\mathbf{1}$。\n8.  解线性方程组 $\\Sigma w_{\\text{unscaled}} = \\mu_e}$ 求 $w_{\\text{unscaled}}$。\n9.  归一化权重： $w^\\star = w_{\\text{unscaled}} / (\\mathbf{1}^\\top w_{\\text{unscaled}})$。\n10. 计算CAL斜率 $S = (\\mu^\\top w^\\star - r_f) / \\sqrt{(w^\\star)^\\top \\Sigma w^\\star}$。\n11. 对于 $\\bar{\\sigma} \\in \\{0.0, 0.05, 0.15\\}$，计算 $E_{\\text{CAL}}(\\bar{\\sigma}) = r_f + S \\cdot \\bar{\\sigma}$。\n12. 整理结果并四舍五入到 $6$ 位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Capital Allocation Line slope and expected returns for several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (seed, risk-free rate)\n        (7, 0.02),\n        (11, 0.00),\n        (13, -0.01),\n    ]\n\n    target_sigmas = [0.0, 0.05, 0.15]\n    all_results = []\n    \n    for case in test_cases:\n        s, r_f = case\n        \n        # --- Start of calculation for one case ---\n        N = 50  # Number of assets\n        rng = np.random.default_rng(seed=s)\n\n        # Step 1: Generate asset parameters\n        # Generate random matrix A and use it to construct a valid correlation matrix R\n        A = rng.standard_normal((N, N))\n        M = A @ A.T\n\n        # R_ij = M_ij / sqrt(M_ii * M_jj)\n        diag_M = np.diag(M)\n        diag_M_inv_sqrt = np.diag(1.0 / np.sqrt(diag_M))\n        R = diag_M_inv_sqrt @ M @ diag_M_inv_sqrt\n\n        # Generate vectors for standard deviation and expected return\n        sigma_vec = rng.uniform(0.05, 0.35, N)\n        mu_vec = rng.uniform(0.02, 0.18, N)\n\n        # Construct covariance matrix Sigma = D * R * D\n        D = np.diag(sigma_vec)\n        Sigma = D @ R @ D\n\n        # Step 2: Compute the tangency portfolio\n        # Vector of excess returns over the risk-free rate\n        mu_e = mu_vec - r_f\n        \n        # Solve the linear system Sigma * w_unscaled = mu_e for unscaled weights.\n        # This is more numerically stable than inverting Sigma.\n        w_unscaled = np.linalg.solve(Sigma, mu_e)\n\n        # Normalize weights to sum to 1 to get the tangency portfolio weights\n        w_star = w_unscaled / np.sum(w_unscaled)\n\n        # Step 3: Compute the CAL slope S\n        # Calculate expected return and standard deviation of the tangency portfolio\n        mu_p_star = mu_vec.T @ w_star\n        sigma_p_star = np.sqrt(w_star.T @ Sigma @ w_star)\n\n        # The slope S is the Sharpe ratio of the tangency portfolio\n        S = (mu_p_star - r_f) / sigma_p_star\n\n        # Step 4: Compute CAL expected returns for target standard deviations\n        E_cal_values = [r_f + S * ts for ts in target_sigmas]\n        \n        # Collect the results for the current case: [S, E_CAL(0.0), E_CAL(0.05), E_CAL(0.15)]\n        case_result_list = [S] + E_cal_values\n        \n        # --- End of calculation for one case ---\n        all_results.append(case_result_list)\n\n    # Final print statement in the exact required format.\n    # Format: [[S1,E1_0.0,E1_0.05,E1_0.15],[S2,...],[S3,...]]\n    outer_parts = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        inner_parts = [f\"{val:.6f}\" for val in res_list]\n        outer_parts.append(f\"[{','.join(inner_parts)}]\")\n    \n    final_output_str = f\"[{','.join(outer_parts)}]\"\n\n    print(final_output_str)\n\nsolve()\n\n```", "id": "2438483"}]}