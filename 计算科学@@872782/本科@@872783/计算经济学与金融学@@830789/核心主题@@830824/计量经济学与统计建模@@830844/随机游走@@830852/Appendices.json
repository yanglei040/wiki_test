{"hands_on_practices": [{"introduction": "深入理解随机游走的第一步是掌握其路径的基本性质。本练习探讨了一个核心概念：首次返回原点的概率[@problem_id:2425131]。通过解决这个经典问题，你将运用组合数学的方法，洞悉随机游走路径的内在结构，为理解更复杂的随机过程（如布朗运动）奠定基础。", "problem": "考虑一个程式化的市场微观结构模型，其中中间价在离散时间内，每一步以相等的概率独立地向上或向下变动一个单位价格(tick)。设 $\\{X_{k}\\}_{k \\geq 1}$ 是独立同分布的，满足 $\\mathbb{P}(X_{k}=1)=\\mathbb{P}(X_{k}=-1)=\\tfrac{1}{2}$，并定义对称一维随机游走 $S_{0}=0$ 和 $S_{n}=\\sum_{k=1}^{n} X_{k}$ (对于 $n \\geq 1$)。定义首次返回到起始水平的时间为 $\\tau=\\min\\{k \\geq 1 : S_{k}=0\\}$。对于一个给定的正整数 $n$，计算概率 $\\mathbb{P}(\\tau=2n)$，结果表示为 $n$ 的一个闭式函数。最终答案需为关于 $n$ 的单一解析表达式。无需四舍五入。", "solution": "我们从对称简单随机游走的定义开始。长度为 $2n$ 的路径由序列 $(X_{1},\\dots,X_{2n})$ 决定，其中每个元素都在 $\\{-1,1\\}$ 中，并且每个这样的序列出现的概率为 $2^{-2n}$。事件 $\\{\\tau=2n\\}$ 指的是 $S_{2n}=0$ 且对于所有 $1 \\leq k \\leq 2n-1$ 都有 $S_{k} \\neq 0$ 的事件。因为 $S_{k}$ 与 $k$ 具有相同的奇偶性，所以返回到 0 只能在偶数时刻发生，因此关注 $2n$ 是很自然的。\n\n为了计算实现 $\\{\\tau=2n\\}$ 的序列数量，我们首先根据第一步的符号进行分类。根据对称性，以 $X_{1}=1$ 开始的有效路径数量等于以 $X_{1}=-1$ 开始的有效路径数量。因此，我们只需计算以 $X_{1}=1$ 开始、以 $X_{2n}=-1$ 结束，且在中间过程中保持严格为正的有效路径数量，然后乘以 2。\n\n考虑满足 $X_{1}=1$，$X_{2n}=-1$ 且对于 $1 \\leq k \\leq 2n-1$ 有 $S_{k} \\geq 1$ 的路径。去掉第一步和最后一步，对于剩下的 $2n-2$ 步，我们通过向下平移 1 个单位来定义一个变换后的路径：令 $Y_{j}=S_{j+1}-1$ (对于 $j=0,1,\\dots,2n-2$)，其中 $Y_{0}=0$ 且 $Y_{2n-2}=0$。条件 $S_{k} \\geq 1$ (对于 $1 \\leq k \\leq 2n-1$) 变为 $Y_{j} \\geq 0$ (对于所有 $0 \\leq j \\leq 2n-2$)。因此，变换后的路径是一条长度为 $2n-2$ 的戴克路径（Dyck path），即一条在整数上从 0 开始并在 0 结束且永不低于 0 的最近邻路径。此类戴克路径的数量是卡特兰数 $C_{n-1}$，其中\n$$\nC_{n-1}=\\frac{1}{n}\\binom{2n-2}{n-1}.\n$$\n根据对称性，以 $X_{1}=-1$ 开始并在时刻 $2n-1$ 之前保持严格为负（然后在时刻 $2n$ 步进到 0）的有效路径数量也是 $C_{n-1}$。因此，实现 $\\{\\tau=2n\\}$ 的总序列数为 $2 C_{n-1}$。\n\n由于每个序列的概率为 $2^{-2n}$，我们得到\n$$\n\\mathbb{P}(\\tau=2n)=\\frac{2 C_{n-1}}{2^{2n}}=\\frac{2}{2^{2n}}\\cdot \\frac{1}{n}\\binom{2n-2}{n-1}.\n$$\n这个表达式可以代数地简化为中心二项式形式。使用恒等式\n$$\n\\frac{2}{n}\\binom{2n-2}{n-1}=\\frac{1}{2n-1}\\binom{2n}{n},\n$$\n我们得出结论\n$$\n\\mathbb{P}(\\tau=2n)=\\frac{1}{2n-1}\\binom{2n}{n} 2^{-2n}.\n$$\n这就是所求的用 $n$ 表示的闭式表达式。", "answer": "$$\\boxed{\\frac{1}{2n-1}\\binom{2n}{n}2^{-2n}}$$", "id": "2425131"}, {"introduction": "随机游走是为资产价格动态建模的基石，尤其在金融衍生品定价领域。本练习将指导你如何为一个“障碍”数字期权定价[@problem_id:2425167]，当标的资产（被建模为随机游走）首次触及预设壁垒时，该期权支付固定收益。通过运用首步分析和风险中性定价原理，你将学会如何建立并求解一个描述期权价格的差分方程，这是量化金融中的一项核心技能。", "problem": "考虑一个状态变量 $X_{t}$ 的离散时间模型，该变量在有限格点 $\\{0,1,2,\\dots,H\\}$ 上进行一维随机游走，其中 $H \\in \\mathbb{N}$ 且 $H \\geq 2$。该过程从 $X_{0} = i$ 开始，其中 $i \\in \\{1,2,\\dots,H-1\\}$，并根据以下内部状态的转移概率演化：\n- $\\mathbb{P}(X_{t+1} = x+1 \\mid X_{t} = x) = p$，\n- $\\mathbb{P}(X_{t+1} = x-1 \\mid X_{t} = x) = 1-p$，\n对于所有 $x \\in \\{1,2,\\dots,H-1\\}$，其中 $p \\in (0,1)$。边界状态 $0$ 和 $H$ 是吸收态：一旦 $X_{t}$ 到达 $0$ 或 $H$，它将停留在那里。\n\n设每期无风险总回报为 $1+r$，其中 $r > 0$，并定义贴现因子 $\\beta \\equiv (1+r)^{-1} \\in (0,1)$。根据风险中性定价原理，任何支付的0时刻价格是在风险中性测度下该支付的贴现期望。\n\n定义停时 $\\tau_{H} \\equiv \\inf\\{t \\geq 0 : X_{t} = H\\}$ 和 $\\tau_{0} \\equiv \\inf\\{t \\geq 0 : X_{t} = 0\\}$。考虑一个数字向上敲入障碍期权，该期权在首次到达上边界 $H$ 时支付1个记账单位，否则支付0。确切地说，当初始状态为 $X_{0}=i$ 时，其0时刻价值为\n$$\nV(i) \\equiv \\mathbb{E}_{i}\\big[\\beta^{\\tau_{H}} \\mathbf{1}_{\\{\\tau_{H}  \\tau_{0}\\}}\\big],\n$$\n其中 $\\mathbb{E}_{i}[\\cdot]$ 表示在 $X_{0}=i$ 条件下的期望。\n\n从风险中性定价原理、$X_{t}$ 的马尔可夫性质以及首步分析（不使用任何现成公式）出发，推导 $V(i)$ 作为 $H$、$i$、$p$ 和 $\\beta$ 的函数的闭式表达式。你的最终答案必须是关于这些参数的单一闭式解析表达式。不要提供不等式或待解方程；请提供显式表达式。无需四舍五入。", "solution": "所提出的问题是随机过程领域中的一个明确界定的问题，具体涉及在具有吸收边界的有限格点上的一维随机游走。任务是在风险中性框架内计算一种特定衍生证券——数字障碍期权的价格。该问题具有科学依据、内容自洽且客观。我们将对其进行严格推导。\n\n期权的价值 $V(i)$ 定义为在初始状态 $X_{0}=i$ 条件下的贴现期望支付：\n$$\nV(i) = \\mathbb{E}_{i}\\big[\\beta^{\\tau_{H}} \\mathbf{1}_{\\{\\tau_{H}  \\tau_{0}\\}}\\big]\n$$\n此处，$\\tau_{H}$ 和 $\\tau_{0}$ 分别是首次到达上边界 $H$ 和下边界 $0$ 的时间。状态空间为 $\\{0, 1, \\dots, H\\}$。状态 $0$ 和 $H$ 是吸收态。\n\n$V(i)$ 的边界条件由吸收态的性质决定：\n1. 如果过程从 $i=0$ 开始，它会立即被吸收。因此，$\\tau_{0}=0$ 且 $\\tau_{H}$ 必须大于 $0$。条件 $\\tau_{H}  \\tau_{0}$ 不满足，所以支付为 $0$。因此，$V(0)=0$。\n2. 如果过程从 $i=H$ 开始，它会立即被吸收。因此，$\\tau_{H}=0$。此时尚未到达下边界，所以 $\\tau_{0} > 0$。条件 $\\tau_{H}  \\tau_{0}$ 满足。支付在时间 $t=0$ 实现，所以贴现值为 $\\beta^{0} \\cdot 1 = 1$。因此，$V(H)=1$。\n\n对于任何内部状态 $i \\in \\{1, 2, \\dots, H-1\\}$，我们可以利用全期望定律和过程 $X_{t}$ 的马尔可夫性质进行首步分析。我们将期望以第一步（从 $t=0$ 到 $t=1$）的结果为条件：\n$$\nV(i) = \\mathbb{E}_{i}\\left[ \\mathbb{E}\\left[ \\beta^{\\tau_{H}} \\mathbf{1}_{\\{\\tau_{H}  \\tau_{0}\\}} \\mid X_1 \\right] \\right]\n$$\n在时间 $t=1$ 时，过程将以概率 $p$ 处于状态 $i+1$，或以概率 $1-p$ 处于状态 $i-1$。\n如果 $X_{1}=i+1$，则已过去一个时间步。从此刻起计算贴现期望支付的问题，与从状态 $i+1$ 开始的原始问题相同，但所有未来的支付都必须额外贴现一个因子 $\\beta$。因此，其价值为 $\\beta V(i+1)$。\n类似地，如果 $X_{1}=i-1$，则后续价值为 $\\beta V(i-1)$。\n\n综合这些可能性，我们得到关于 $V(i)$ 的以下二阶线性齐次差分方程：\n$$\nV(i) = p \\cdot (\\beta V(i+1)) + (1-p) \\cdot (\\beta V(i-1))\n$$\n这可以重写为：\n$$\np\\beta V(i+1) - V(i) + (1-p)\\beta V(i-1) = 0\n$$\n对于 $i \\in \\{1, 2, \\dots, H-1\\}$。\n\n为了解这个递推关系，我们假设解的形式为 $V(i) = \\lambda^{i}$。将其代入方程得到特征方程：\n$$\np\\beta \\lambda^{i+1} - \\lambda^{i} + (1-p)\\beta \\lambda^{i-1} = 0\n$$\n假设 $\\lambda \\neq 0$，我们两边同除以 $\\lambda^{i-1}$，得到一个关于 $\\lambda$ 的二次方程：\n$$\np\\beta \\lambda^2 - \\lambda + (1-p)\\beta = 0\n$$\n该二次方程的根由求根公式给出：\n$$\n\\lambda_{1,2} = \\frac{1 \\pm \\sqrt{1 - 4(p\\beta)((1-p)\\beta)}}{2p\\beta} = \\frac{1 \\pm \\sqrt{1 - 4p(1-p)\\beta^2}}{2p\\beta}\n$$\n鉴于 $p \\in (0,1)$ 和 $\\beta \\in (0,1)$，项 $p(1-p)$ 的界限为 $0  p(1-p) \\leq \\frac{1}{4}$，且 $\\beta^2 \\in (0,1)$。因此，判别式 $1 - 4p(1-p)\\beta^2$ 严格大于零且小于1。这确保了存在两个不相等的实根 $\\lambda_1$ 和 $\\lambda_2$。\n\n该差分方程的通解是这两个根的幂的线性组合：\n$$\nV(i) = c_1 \\lambda_1^i + c_2 \\lambda_2^i\n$$\n其中 $c_1$ 和 $c_2$ 是由边界条件决定的常数。\n令 $\\lambda_1$ 为带加号的根，$\\lambda_2$ 为带减号的根。\n使用边界条件 $V(0)=0$：\n$$\nV(0) = c_1 \\lambda_1^0 + c_2 \\lambda_2^0 = c_1 + c_2 = 0 \\implies c_2 = -c_1\n$$\n这将通解简化为：\n$$\nV(i) = c_1 (\\lambda_1^i - \\lambda_2^i)\n$$\n现在，我们应用第二个边界条件 $V(H)=1$：\n$$\nV(H) = c_1 (\\lambda_1^H - \\lambda_2^H) = 1\n$$\n由于 $\\lambda_1 \\neq \\lambda_2$，且两者均为正数，对于 $H \\ge 1$，有 $\\lambda_1^H - \\lambda_2^H \\neq 0$。我们可以解出 $c_1$：\n$$\nc_1 = \\frac{1}{\\lambda_1^H - \\lambda_2^H}\n$$\n将 $c_1$ 代回 $V(i)$ 的表达式中，我们得到最终的闭式解：\n$$\nV(i) = \\frac{\\lambda_1^i - \\lambda_2^i}{\\lambda_1^H - \\lambda_2^H}\n$$\n代入根 $\\lambda_1$ 和 $\\lambda_2$ 的表达式，我们便得到了 $V(i)$ 作为 $H, i, p$ 和 $\\beta$ 的函数的显式解。", "answer": "$$\n\\boxed{\\frac{\\left(\\frac{1 + \\sqrt{1 - 4p(1-p)\\beta^2}}{2p\\beta}\\right)^{i} - \\left(\\frac{1 - \\sqrt{1 - 4p(1-p)\\beta^2}}{2p\\beta}\\right)^{i}}{\\left(\\frac{1 + \\sqrt{1 - 4p(1-p)\\beta^2}}{2p\\beta}\\right)^{H} - \\left(\\frac{1 - \\sqrt{1 - 4p(1-p)\\beta^2}}{2p\\beta}\\right)^{H}}}\n$$", "id": "2425167"}, {"introduction": "理论模型通常忽略交易成本等现实摩擦，但在实际投资中，这些成本会显著影响策略表现。本练习旨在量化一个重要的实际问题：在恒定比例再平衡策略中，交易成本对最终财富的侵蚀效应[@problem_id:2425097]。通过编程计算不同情景下的财富差异，你将直观地理解为何最小化交易成本是量化策略设计中的一个关键考量。", "problem": "考虑单一风险资产和零回报的现金账户。时间是离散的，周期由 $t \\in \\{1,2,\\dots,T\\}$ 索引。风险资产的单周期毛回报率 $G_t \\in \\{1 + r_u, 1 + r_d\\}$ 是独立同分布（i.i.d.）的，其中 $r_u > 0$，$r_d  0$，且 $\\mathbb{P}(G_t = 1 + r_u) = p \\in (0,1)$。现金账户在每个周期的毛回报率等于 $1$。投资者以初始财富 $W_0 > 0$ 开始。\n\n投资者遵循固定比例再平衡策略：在每个周期 $t$ 结束时，观察到 $G_t$ 后，投资者立即将投资组合再平衡，以为下一周期设定固定的风险权重 $f \\in [0,1]$。交易成本是按比例计算的，并且在时间上是恒定的，每交易一美元的费率为 $\\tau \\in [0,1)$。设时间 $t$ 的美元交易量为风险资产和现金之间为达到下一周期的目标权重而交换的绝对美元金额。在时间 $t$ 支付的交易成本是该美元交易量的 $\\tau$ 倍，从总财富中扣除。假设在 $t=0$ 时，对目标权重 $f$ 的初始分配是无成本的。假设 $f \\tau  1$。\n\n将在交易成本率为 $\\tau$ 的情况下 $T$ 个周期后投资者的期末财富定义为 $W_T^{(\\tau)}$。类似地，当 $\\tau = 0$ 时定义 $W_T^{(0)}$。\n\n您的任务是为每个给定的参数集计算交易成本对期末财富的预期影响，即数量 $\\mathbb{E}[W_T^{(\\tau)}] - \\mathbb{E}[W_T^{(0)}]$。\n\n所有答案均以实数（浮点数）表示。不涉及物理单位。\n\n测试套件。您的程序必须为以下每个参数集 $(W_0, T, p, r_u, r_d, f, \\tau)$ 计算 $\\mathbb{E}[W_T^{(\\tau)}] - \\mathbb{E}[W_T^{(0)}]$ 的值：\n\n- 案例 1（一般情况）：$(1.0, 10, 0.55, 0.015, -0.010, 0.60, 0.002)$。\n- 案例 2（无成本边界）：$(1.0, 10, 0.55, 0.015, -0.010, 0.60, 0.000)$。\n- 案例 3（无风险敞口边界）：$(1.0, 15, 0.60, 0.020, -0.015, 0.00, 0.010)$。\n- 案例 4（零期限边界）：$(1.0, 0, 0.50, 0.020, -0.020, 0.50, 0.010)$。\n- 案例 5（更高波动率和敞口）：$(1.0, 20, 0.60, 0.030, -0.020, 0.80, 0.005)$。\n- 案例 6（对称涨跌，正交易成本）：$(1.0, 20, 0.50, 0.020, -0.020, 0.50, 0.010)$。\n\n最终输出格式。您的程序应生成一行输出，其中包含案例 $1$ 到 $6$ 的结果，按顺序排列，以逗号分隔并用方括号括起来。每个值必须四舍五入到 $12$ 位小数。例如，一个有效的输出格式是 $[\\text{result}_1,\\text{result}_2,\\dots,\\text{result}_6]$。", "solution": "所陈述的问题经过了严格的验证，并被认定为有效。它在科学上基于金融数学的既定原则，特别是投资组合理论和交易成本下的资产价格动态。该问题是适定的、客观的且自洽的，提供了确定唯一解所需的所有必要参数和条件。这是计算金融中一个关于给定交易策略对财富动态影响的标准练习。\n\n任务是计算有交易成本再平衡的投资组合与无交易成本再平衡的投资组合的预期期末财富之差，即 $\\mathbb{E}[W_T^{(\\tau)}] - \\mathbb{E}[W_T^{(0)}]$。我们将首先推导两种情况下预期期末财富的表达式。\n\n让我们从零交易成本的情况开始，即 $\\tau = 0$。\n投资者以财富 $W_0$ 开始，将比例 $f$ 分配给风险资产，比例 $1-f$ 分配给现金账户。此初始分配是无成本的。在任何周期 $t$ 的开始（即在 $t-1$ 时再平衡后），投资于风险资产的财富为 $f W_{t-1}^{(0)}$，现金为 $(1-f) W_{t-1}^{(0)}$。在周期 $t$ 期间，风险资产的价值乘以毛回报率 $G_t$，而现金账户的价值乘以 $1$。在周期 $t$ 结束时，再平衡前的财富为：\n$$W_{t, \\text{pre-rebal}}^{(0)} = (f W_{t-1}^{(0)}) G_t + ((1-f) W_{t-1}^{(0)}) \\cdot 1 = W_{t-1}^{(0)} (1 - f + fG_t)$$\n由于 $\\tau = 0$，再平衡没有成本。因此，再平衡后的财富 $W_t^{(0)}$ 等于再平衡前的财富。财富演化由递推关系给出：\n$$W_t^{(0)} = W_{t-1}^{(0)} R_t^{(0)}, \\quad \\text{其中 } R_t^{(0)} = 1 - f + fG_t$$\n单周期投资组合回报率 $R_t^{(0)}$ 是一个独立同分布（i.i.d.）的随机变量，因为资产回报率 $G_t$ 是独立同分布的。$T$ 个周期后的期末财富为 $W_T^{(0)} = W_0 \\prod_{t=1}^T R_t^{(0)}$。\n根据独立同分布随机变量的性质，乘积的期望等于期望的乘积：\n$$\\mathbb{E}[W_T^{(0)}] = W_0 \\mathbb{E}\\left[\\prod_{t=1}^T R_t^{(0)}\\right] = W_0 \\left(\\mathbb{E}[R_1^{(0)}]\\right)^T$$\n单周期的预期回报率为：\n$$\\mathbb{E}[R_1^{(0)}] = \\mathbb{E}[1 - f + fG_1] = 1 - f + f\\mathbb{E}[G_1]$$\n给定 $\\mathbb{P}(G_t = 1 + r_u) = p$ 和 $\\mathbb{P}(G_t = 1 + r_d) = 1-p$，我们有 $\\mathbb{E}[G_1] = p(1+r_u) + (1-p)(1+r_d)$。设 $\\mu_G = \\mathbb{E}[G_1]$。那么，单周期投资组合的预期回报率为 $\\mu^{(0)} = 1 - f + f\\mu_G$。最后：\n$$\\mathbb{E}[W_T^{(0)}] = W_0 \\left(p(1 - f + f(1+r_u)) + (1-p)(1 - f + f(1+r_d))\\right)^T = W_0 \\left(p(1+fr_u) + (1-p)(1+fr_d)\\right)^T$$\n\n接下来，我们考虑有按比例计算的交易成本的情况，即 $\\tau > 0$。\n在时间 $t$ 再平衡前的财富，记为 $W_{t, \\text{pre}}^{(\\tau)}$，仍然由 $W_{t, \\text{pre}}^{(\\tau)} = W_{t-1}^{(\\tau)} (1 - f + fG_t)$ 给出，其中 $W_{t-1}^{(\\tau)}$ 是在时间 $t-1$ 扣除所有成本并再平衡后的财富。关键区别在于再平衡的成本。再平衡交易取决于风险资产的权重是漂移到目标 $f$ 之上还是之下。再平衡前的风险权重为 $f'_t = \\frac{f W_{t-1}^{(\\tau)} G_t}{W_{t, \\text{pre}}^{(\\tau)}} = \\frac{fG_t}{1-f+fG_t}$。如果 $f'_t \\neq f$，则需要进行交易。\n- 如果 $G_t > 1$，则 $f'_t > f$。投资者必须卖出一部分风险资产。\n- 如果 $G_t  1$，则 $f'_t  f$。投资者必须购买更多的风险资产。\n\n让我们分析这两种情况来找到再平衡后的财富 $W_t^{(\\tau)}$。\n设 $A_{t, \\text{pre}} = fW_{t-1}^{(\\tau)}G_t$ 为交易前风险资产的价值，而 $C_{t, \\text{pre}} = (1-f)W_{t-1}^{(\\tau)}$ 为现金价值。\n设 $W_t^{(\\tau)}$ 为交易后的财富。目标持仓为 $A_{t, \\text{post}} = fW_t^{(\\tau)}$ 和 $C_{t, \\text{post}} = (1-f)W_t^{(\\tau)}$。\n\n情况 1：卖出风险资产 ($G_t=1+r_u > 1$)。\n卖出资产的金额为 $\\Delta A = A_{t, \\text{pre}} - A_{t, \\text{post}} = fW_{t-1}^{(\\tau)}G_t - fW_t^{(\\tau)}$。这是交易量。成本为 $\\tau \\Delta A$。出售所得并加入现金的金额为 $(1-\\tau)\\Delta A$。\n现金余额必须对平：$C_{t, \\text{post}} = C_{t, \\text{pre}} + (1-\\tau)\\Delta A$。\n$$(1-f)W_t^{(\\tau)} = (1-f)W_{t-1}^{(\\tau)} + (1-\\tau)(fW_{t-1}^{(\\tau)}G_t - fW_t^{(\\tau)})$$\n整理关于 $W_t^{(\\tau)}$ 和 $W_{t-1}^{(\\tau)}$ 的项：\n$$W_t^{(\\tau)}[(1-f) + f(1-\\tau)] = W_{t-1}^{(\\tau)}[(1-f) + f(1-\\tau)G_t]$$\n$$W_t^{(\\tau)}(1-f\\tau) = W_{t-1}^{(\\tau)}(1-f+f(1-\\tau)G_t)$$\n因此，当 $G_t = 1+r_u$ 时，单周期毛回报率为：\n$$R_u^{(\\tau)} = \\frac{W_t^{(\\tau)}}{W_{t-1}^{(\\tau)}} = \\frac{1-f+f(1-\\tau)(1+r_u)}{1-f\\tau}$$\n\n情况 2：买入风险资产 ($G_t=1+r_d  1$)。\n买入资产的金额为 $\\Delta A = A_{t, \\text{post}} - A_{t, \\text{pre}} = fW_t^{(\\tau)} - fW_{t-1}^{(\\tau)}G_t$。这是交易量。成本为 $\\tau \\Delta A$。为支付此次购买及成本，所需现金为 $(1+\\tau)\\Delta A$。\n现金余额必须对平：$C_{t, \\text{post}} = C_{t, \\text{pre}} - (1+\\tau)\\Delta A$。\n$$(1-f)W_t^{(\\tau)} = (1-f)W_{t-1}^{(\\tau)} - (1+\\tau)(fW_t^{(\\tau)} - fW_{t-1}^{(\\tau)}G_t)$$\n整理各项：\n$$W_t^{(\\tau)}[(1-f) + f(1+\\tau)] = W_{t-1}^{(\\tau)}[(1-f) + f(1+\\tau)G_t]$$\n$$W_t^{(\\tau)}(1+f\\tau) = W_{t-1}^{(\\tau)}(1-f+f(1+\\tau)G_t)$$\n因此，当 $G_t = 1+r_d$ 时，单周期毛回报率为：\n$$R_d^{(\\tau)} = \\frac{W_t^{(\\tau)}}{W_{t-1}^{(\\tau)}} = \\frac{1-f+f(1+\\tau)(1+r_d)}{1+f\\tau}$$\n\n有交易成本的财富动态为 $W_t^{(\\tau)} = W_{t-1}^{(\\tau)} R_t^{(\\tau)}$，其中 $R_t^{(\\tau)}$ 是一个独立同分布的随机变量，以概率 $p$ 取值 $R_u^{(\\tau)}$，以概率 $1-p$ 取值 $R_d^{(\\tau)}$。\n预期期末财富为：\n$$\\mathbb{E}[W_T^{(\\tau)}] = W_0 (\\mathbb{E}[R_1^{(\\tau)}])^T$$\n其中，单周期预期回报率为 $\\mu^{(\\tau)} = \\mathbb{E}[R_1^{(\\tau)}] = p R_u^{(\\tau)} + (1-p) R_d^{(\\tau)}$。\n\n问题要求计算 $\\mathbb{E}[W_T^{(\\tau)}] - \\mathbb{E}[W_T^{(0)}]$。这可以通过应用推导出的公式来计算。\n算法如下：\n1. 对于给定的参数集 $(W_0, T, p, r_u, r_d, f, \\tau)$，计算有成本的单周期预期回报率 $\\mu^{(\\tau)}$。\n2. 计算无成本的单周期预期回报率 $\\mu^{(0)}$（这等同于在 $R_u^{(\\tau)}$ 和 $R_d^{(\\tau)}$ 的公式中设置 $\\tau=0$）。\n3. 计算 $\\mathbb{E}[W_T^{(\\tau)}] = W_0 (\\mu^{(\\tau)})^T$ 和 $\\mathbb{E}[W_T^{(0)}] = W_0 (\\mu^{(0)})^T$。\n4. 最终结果是这两个值之间的差。必须特别注意边界情况 $T=0$ 或 $f=0$，此时不发生交易，差值显然为 $0$。我们的公式在这些情况下正确地退化为预期回报率为 $1$，从而导致财富为 $W_0$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the expected effect of transaction costs on terminal wealth for a series of test cases.\n    \"\"\"\n    # Test suite: (W0, T, p, ru, rd, f, tau)\n    test_cases = [\n        # Case 1 (general case)\n        (1.0, 10, 0.55, 0.015, -0.010, 0.60, 0.002),\n        # Case 2 (no cost boundary)\n        (1.0, 10, 0.55, 0.015, -0.010, 0.60, 0.000),\n        # Case 3 (no risky exposure boundary)\n        (1.0, 15, 0.60, 0.020, -0.015, 0.00, 0.010),\n        # Case 4 (zero horizon boundary)\n        (1.0, 0, 0.50, 0.020, -0.020, 0.50, 0.010),\n        # Case 5 (higher volatility and exposure)\n        (1.0, 20, 0.60, 0.030, -0.020, 0.80, 0.005),\n        # Case 6 (symmetric up/down, positive trading cost)\n        (1.0, 20, 0.50, 0.020, -0.020, 0.50, 0.010),\n    ]\n\n    def calculate_expected_wealth(W0, T, p, ru, rd, f, tau):\n        \"\"\"\n        Calculates the expected terminal wealth E[W_T] based on the derived formulas.\n        \"\"\"\n        # Handle boundary cases where no trading occurs.\n        if T == 0 or f == 0:\n            return W0\n\n        # Gross returns for the risky asset\n        Gu = 1.0 + ru\n        Gd = 1.0 + rd\n\n        # Calculate one-period portfolio gross returns including transaction costs.\n        # R_u corresponds to selling the appreciated asset.\n        numerator_u = 1.0 - f + f * (1.0 - tau) * Gu\n        denominator_u = 1.0 - f * tau\n        R_u = numerator_u / denominator_u\n\n        # R_d corresponds to buying the depreciated asset.\n        numerator_d = 1.0 - f + f * (1.0 + tau) * Gd\n        denominator_d = 1.0 + f * tau\n        R_d = numerator_d / denominator_d\n        \n        # Calculate expected one-period portfolio gross return.\n        mu = p * R_u + (1.0 - p) * R_d\n        \n        # Calculate expected terminal wealth.\n        expected_W_T = W0 * (mu ** T)\n        \n        return expected_W_T\n\n    results = []\n    for case in test_cases:\n        W0, T, p, ru, rd, f, tau = case\n        \n        # Calculate expected wealth with transaction costs\n        E_WT_tau = calculate_expected_wealth(W0, T, p, ru, rd, f, tau)\n        \n        # Calculate expected wealth without transaction costs (tau=0)\n        E_WT_0 = calculate_expected_wealth(W0, T, p, ru, rd, f, 0.0)\n        \n        # Compute the difference\n        difference = E_WT_tau - E_WT_0\n        results.append(round(difference, 12))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2425097"}]}