{"hands_on_practices": [{"introduction": "为了真正掌握病态问题，从视觉上观察其效果会很有帮助。第一个练习将引导你构建一个简单的 $2 \\times 2$ 病态矩阵，并观察它如何将一个单位圆变换成一个被极度拉长的椭圆。通过将矩阵的奇异值与椭圆的几何形状联系起来，你将对病态如何代表空间中的极端拉伸建立起强大的直觉。[@problem_id:3240924]", "problem": "要求您构建并分析一个严重病态的线性变换。从矩阵二范数、奇异值和条件数的定义出发，执行以下操作：\n\n- 构建一个显式的实数 $2 \\times 2$ 矩阵 $A$，使其关于矩阵二范数的条件数满足 $\\kappa_{2}(A) = 10^{8}$ 且 $\\det(A) = 1$。\n- 仅使用这些定义和正交变换的基本性质，证明单位圆在 $A$ 作用下的像是一个椭圆。确定这个椭圆的半轴。\n- 使用其几何定义来定义所得椭圆的离心率 $e$，并推导出用半轴表示 $e$ 的表达式。\n- 对您构建的矩阵计算 $e$，并以单个精确的解析表达式形式提供最终值。\n\n您的最终答案必须是一个实值表达式。不需要四舍五入，也没有单位。", "solution": "该问题要求构建并分析一个严重病态的 $2 \\times 2$ 实矩阵 $A$。分析内容包括其在单位圆上的几何作用以及计算所得椭圆的离心率。\n\n首先，我们必须构建满足给定条件的矩阵 $A$。设 $2 \\times 2$ 矩阵 $A$ 的奇异值为 $\\sigma_1$ 和 $\\sigma_2$，对于可逆矩阵，我们约定 $\\sigma_1 \\ge \\sigma_2  0$。\n\n关于矩阵二范数的条件数 $\\kappa_2(A)$ 定义为最大奇异值与最小奇异值之比：\n$$ \\kappa_2(A) = \\frac{\\sigma_1}{\\sigma_2} $$\n给定条件为 $\\kappa_2(A) = 10^8$。因此，我们有以下方程：\n$$ \\frac{\\sigma_1}{\\sigma_2} = 10^8 $$\n$A$ 的行列式 $\\det(A)$ 与奇异值的关系为 $|\\det(A)| = \\sigma_1 \\sigma_2$。给定条件为 $\\det(A) = 1$，这意味着 $\\sigma_1 \\sigma_2 = 1$。\n\n现在我们得到一个关于两个未知奇异值 $\\sigma_1$ 和 $\\sigma_2$ 的方程组：\n1. $\\sigma_1 = 10^8 \\sigma_2$\n2. $\\sigma_1 \\sigma_2 = 1$\n\n将第一个方程代入第二个方程得到：\n$$ (10^8 \\sigma_2) \\sigma_2 = 1 \\implies \\sigma_2^2 = 10^{-8} $$\n因为奇异值是非负的，我们取正平方根：\n$$ \\sigma_2 = \\sqrt{10^{-8}} = 10^{-4} $$\n现在，我们用第一个方程求出 $\\sigma_1$：\n$$ \\sigma_1 = 10^8 \\sigma_2 = 10^8 \\cdot 10^{-4} = 10^4 $$\n所需的奇异值为 $\\sigma_1 = 10^4$ 和 $\\sigma_2 = 10^{-4}$。\n\n为了构建一个显式矩阵 $A$，我们可以使用奇异值分解 (SVD)，它表明任何实矩阵 $A$ 都可以写成 $A = U\\Sigma V^T$ 的形式，其中 $U$ 和 $V$ 是正交矩阵，$\\Sigma$ 是包含奇异值的对角矩阵。对于我们的 $2 \\times 2$ 情况：\n$$ \\Sigma = \\begin{pmatrix} \\sigma_1  0 \\\\ 0  \\sigma_2 \\end{pmatrix} = \\begin{pmatrix} 10^4  0 \\\\ 0  10^{-4} \\end{pmatrix} $$\n构建 $A$ 的最简单方法是选择 $U$ 和 $V$ 为单位矩阵 $I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$，这是一个正交矩阵。这得到：\n$$ A = I \\Sigma I^T = \\Sigma = \\begin{pmatrix} 10^4  0 \\\\ 0  10^{-4} \\end{pmatrix} $$\n这个矩阵是实的 $2 \\times 2$ 矩阵，并且满足 $\\kappa_2(A) = \\frac{10^4}{10^{-4}} = 10^8$ 和 $\\det(A) = (10^4)(10^{-4}) = 1$。\n\n接下来，我们证明单位圆在 $A$ 作用下的像是一个椭圆。单位圆是满足 $\\|\\mathbf{x}\\|_2 = 1$ 的向量集合 $\\mathbf{x} \\in \\mathbb{R}^2$。其像是向量集合 $\\mathbf{y} = A\\mathbf{x}$。使用 SVD，我们有 $\\mathbf{y} = U\\Sigma V^T \\mathbf{x}$。\n令 $\\mathbf{z} = V^T \\mathbf{x}$。由于 $V^T$ 是一个正交变换，它保持欧几里得范数不变，因此 $\\|\\mathbf{z}\\|_2 = \\|V^T \\mathbf{x}\\|_2 = \\|\\mathbf{x}\\|_2 = 1$。当 $\\mathbf{x}$ 描绘单位圆时，$\\mathbf{z}$ 也描绘单位圆。\n将 $\\mathbf{z}$ 参数化表示为 $\\mathbf{z} = \\begin{pmatrix} \\cos(\\theta) \\\\ \\sin(\\theta) \\end{pmatrix}$，其中 $\\theta \\in [0, 2\\pi)$。\n那么向量 $\\mathbf{w} = \\Sigma \\mathbf{z}$ 为：\n$$ \\mathbf{w} = \\begin{pmatrix} \\sigma_1  0 \\\\ 0  \\sigma_2 \\end{pmatrix} \\begin{pmatrix} \\cos(\\theta) \\\\ \\sin(\\theta) \\end{pmatrix} = \\begin{pmatrix} \\sigma_1\\cos(\\theta) \\\\ \\sigma_2\\sin(\\theta) \\end{pmatrix} $$\n$\\mathbf{w}$ 的分量 $w_1 = \\sigma_1\\cos(\\theta)$ 和 $w_2 = \\sigma_2\\sin(\\theta)$ 满足椭圆方程：\n$$ \\left(\\frac{w_1}{\\sigma_1}\\right)^2 + \\left(\\frac{w_2}{\\sigma_2}\\right)^2 = \\cos^2(\\theta) + \\sin^2(\\theta) = 1 $$\n这个椭圆以原点为中心，半轴长度为 $\\sigma_1$ 和 $\\sigma_2$，且与坐标轴对齐。\n最终的像向量是 $\\mathbf{y} = U\\mathbf{w}$。矩阵 $U$ 表示一个正交变换（旋转或反射），它将由 $\\mathbf{w}$ 描绘的椭圆映射到另一个椭圆。此变换保持半轴的长度不变。\n因此，单位圆在 $A$ 作用下的像是一个椭圆，其半轴长度等于 $A$ 的奇异值。半长轴为 $a = \\sigma_1 = 10^4$，半短轴为 $b = \\sigma_2 = 10^{-4}$。\n\n现在我们推导离心率 $e$ 的表达式。对于一个半长轴为 $a$、半短轴为 $b$ 的椭圆，中心到每个焦点的距离（记为 $c$）由关系 $a^2 = b^2 + c^2$ 给出。这得到 $c = \\sqrt{a^2 - b^2}$。离心率 $e$ 的几何定义是中心到焦点的距离与半长轴之比：\n$$ e = \\frac{c}{a} = \\frac{\\sqrt{a^2 - b^2}}{a} $$\n我们可以将其重写为：\n$$ e = \\sqrt{\\frac{a^2 - b^2}{a^2}} = \\sqrt{1 - \\left(\\frac{b}{a}\\right)^2} $$\n\n最后，我们计算我们特定椭圆的 $e$。半轴为 $a = 10^4$ 和 $b = 10^{-4}$。将这些值代入离心率的表达式中：\n$$ e = \\sqrt{1 - \\left(\\frac{10^{-4}}{10^4}\\right)^2} $$\n$$ e = \\sqrt{1 - (10^{-8})^2} $$\n$$ e = \\sqrt{1 - 10^{-16}} $$\n这就是该椭圆离心率的精确解析表达式。", "answer": "$$\\boxed{\\sqrt{1 - 10^{-16}}}$$", "id": "3240924"}, {"introduction": "除了宏观的几何图像，病态问题对求解线性方程组有着精确的量化影响。这个练习将展示，系统敏感性并非均匀的；特定方向上的微小输入误差可能被急剧放大。通过分析一个与奇异向量对齐的扰动，你将计算出这个放大因子，并直接看到它与系统的最小奇异值之间的关系。[@problem_id:3240884]", "problem": "考虑一个实矩阵 $A \\in \\mathbb{R}^{3 \\times 3}$，其奇异值分解 (singular value decomposition, SVD) 为 $A = Q \\Sigma V^{\\top}$，其中 $Q$ 和 $V$ 是正交矩阵，$\\Sigma = \\operatorname{diag}(\\sigma_{1}, \\sigma_{2}, \\sigma_{3})$，且已知奇异值 $\\sigma_{1} = 6$，$\\sigma_{2} = 2$，$\\sigma_{3} = 10^{-12}$。设左奇异向量为 $Q$ 的列，分别表示为 $u_{1}$、$u_{2}$ 和 $u_{3}$，其中 $u_{3}$ 对应最小的奇异值 $\\sigma_{3}$。您将构造一个几乎与 $u_{3}$ 正交的右侧向量 $b$，并分析解 $x = A^{\\dagger} b$ 的敏感性，其中 $A^{\\dagger}$ 表示摩尔-彭若斯伪逆 (Moore–Penrose pseudoinverse, MPP)。\n\n定义 $b_{0} = u_{1} + u_{2}$ 和 $b = b_{0} + \\varepsilon u_{3}$，其中 $\\varepsilon = 10^{-9}$。令 $x_{0} = A^{\\dagger} b_{0}$ 和 $x = A^{\\dagger} b$。仅使用基本定义（奇异向量的标准正交性、线性和通过SVD定义的伪逆），推导解相对于沿 $u_{3}$ 方向扰动的放大因子：\n$$\ng \\equiv \\frac{\\|x - x_{0}\\|_{2}}{\\|b - b_{0}\\|_{2}},\n$$\n其中 $\\|\\cdot\\|_{2}$ 表示欧几里得范数。请以纯数字形式给出 $g$ 的最终值。不需要单位。除了基本定义外，不要使用任何快捷公式。最终答案必须是单个实数。无需四舍五入。", "solution": "问题要求计算放大因子 $g$，其定义为解的变化量的范数与右侧向量变化量的范数之比。\n$$\ng \\equiv \\frac{\\|x - x_{0}\\|_{2}}{\\|b - b_{0}\\|_{2}}\n$$\n变量定义如下：\n- 矩阵 $A \\in \\mathbb{R}^{3 \\times 3}$，其SVD为 $A = Q \\Sigma V^{\\top}$。\n- $Q = [u_1, u_2, u_3]$ 和 $V = [v_1, v_2, v_3]$ 是正交矩阵，其中 $\\{u_i\\}$ 和 $\\{v_i\\}$ 分别是左、右奇异向量集。\n- $\\Sigma = \\operatorname{diag}(\\sigma_{1}, \\sigma_{2}, \\sigma_{3})$，奇异值为 $\\sigma_{1} = 6$, $\\sigma_{2} = 2$, $\\sigma_{3} = 10^{-12}$。\n- $b_{0} = u_{1} + u_{2}$。\n- $b = b_{0} + \\varepsilon u_{3}$，其中 $\\varepsilon = 10^{-9}$。\n- $x_{0} = A^{\\dagger} b_{0}$ 和 $x = A^{\\dagger} b$，其中 $A^{\\dagger}$ 是摩尔-彭若斯伪逆。\n\n首先，我们使用 $A$ 的SVD来定义摩尔-彭若斯伪逆 $A^{\\dagger}$：\n$$\nA^{\\dagger} = V \\Sigma^{\\dagger} Q^{\\top}\n$$\n由于所有给定的奇异值 $\\sigma_i$ 都不为零，矩阵 $\\Sigma^{\\dagger}$ 是奇异值倒数构成的对角矩阵：\n$$\n\\Sigma^{\\dagger} = \\operatorname{diag}(\\sigma_{1}^{-1}, \\sigma_{2}^{-1}, \\sigma_{3}^{-1})\n$$\n\n接下来，我们分析 $g$ 表达式的分子，即 $\\|x - x_{0}\\|_{2}$。\n解 $x$ 和 $x_0$ 之间的差为：\n$$\nx - x_{0} = A^{\\dagger} b - A^{\\dagger} b_{0}\n$$\n根据矩阵-向量乘法的线性性质，我们可以写出：\n$$\nx - x_{0} = A^{\\dagger} (b - b_{0})\n$$\n右侧向量 $b$ 和 $b_0$ 之间的差为：\n$$\nb - b_{0} = (b_{0} + \\varepsilon u_{3}) - b_{0} = \\varepsilon u_{3}\n$$\n将此代入解的差的表达式中：\n$$\nx - x_{0} = A^{\\dagger} (\\varepsilon u_{3}) = \\varepsilon (A^{\\dagger} u_{3})\n$$\n现在，我们使用基于SVD的定义来计算 $A^{\\dagger}$ 对向量 $u_3$ 的作用：\n$$\nA^{\\dagger} u_{3} = (V \\Sigma^{\\dagger} Q^{\\top}) u_{3} = V \\Sigma^{\\dagger} (Q^{\\top} u_{3})\n$$\n矩阵 $Q$ 是正交的，因此其列 $\\{u_1, u_2, u_3\\}$ 构成一个标准正交基。矩阵 $Q^{\\top}$ 的行是 $u_1^{\\top}$、$u_2^{\\top}$ 和 $u_3^{\\top}$。乘积 $Q^{\\top} u_{3}$ 是一个列向量，其第 $i$ 个分量是 $u_{i}^{\\top} u_{3}$。由于标准正交性，$u_{i}^{\\top} u_{j} = \\delta_{ij}$（克罗内克δ函数）。因此：\n$$\nQ^{\\top} u_{3} = \\begin{pmatrix} u_{1}^{\\top} u_{3} \\\\ u_{2}^{\\top} u_{3} \\\\ u_{3}^{\\top} u_{3} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n将此结果代回 $A^{\\dagger} u_{3}$ 的表达式中：\n$$\nA^{\\dagger} u_{3} = V \\Sigma^{\\dagger} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = V \\begin{pmatrix} \\sigma_{1}^{-1}  0  0 \\\\ 0  \\sigma_{2}^{-1}  0 \\\\ 0  0  \\sigma_{3}^{-1} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = V \\begin{pmatrix} 0 \\\\ 0 \\\\ \\sigma_{3}^{-1} \\end{pmatrix}\n$$\n由于 $V$ 是以右奇异向量为列的矩阵，即 $V = [v_1, v_2, v_3]$，最终的乘积是：\n$$\nA^{\\dagger} u_{3} = [v_1, v_2, v_3] \\begin{pmatrix} 0 \\\\ 0 \\\\ \\sigma_{3}^{-1} \\end{pmatrix} = 0 \\cdot v_{1} + 0 \\cdot v_{2} + \\sigma_{3}^{-1} \\cdot v_{3} = \\sigma_{3}^{-1} v_{3}\n$$\n现在我们可以写出解的差的最终表达式：\n$$\nx - x_{0} = \\varepsilon (\\sigma_{3}^{-1} v_{3})\n$$\n我们计算该向量的欧几里得范数，作为 $g$ 的分子：\n$$\n\\|x - x_{0}\\|_{2} = \\|\\varepsilon \\sigma_{3}^{-1} v_{3}\\|_{2} = |\\varepsilon \\sigma_{3}^{-1}| \\|v_{3}\\|_{2}\n$$\n向量 $v_3$ 是正交矩阵 $V$ 的一列，因此它是一个单位向量，即 $\\|v_{3}\\|_{2} = 1$。鉴于 $\\varepsilon = 10^{-9}  0$ 和 $\\sigma_{3} = 10^{-12}  0$，绝对值可以去掉：\n$$\n\\|x - x_{0}\\|_{2} = \\varepsilon \\sigma_{3}^{-1}\n$$\n现在我们分析 $g$ 的分母，即 $\\|b - b_{0}\\|_{2}$。\n我们已经得出 $b - b_{0} = \\varepsilon u_{3}$。其范数为：\n$$\n\\|b - b_{0}\\|_{2} = \\|\\varepsilon u_{3}\\|_{2} = |\\varepsilon| \\|u_{3}\\|_{2}\n$$\n同样地，$u_3$ 是正交矩阵 $Q$ 的一列，所以它是一个单位向量，$\\|u_{3}\\|_{2} = 1$。由于 $\\varepsilon  0$，我们有：\n$$\n\\|b - b_{0}\\|_{2} = \\varepsilon\n$$\n最后，我们通过计算两个范数的比值来求得放大因子 $g$：\n$$\ng = \\frac{\\|x - x_{0}\\|_{2}}{\\|b - b_{0}\\|_{2}} = \\frac{\\varepsilon \\sigma_{3}^{-1}}{\\varepsilon} = \\sigma_{3}^{-1}\n$$\n代入给定的 $\\sigma_{3}$ 值：\n$$\ng = (10^{-12})^{-1} = 10^{12}\n$$\n结果表明，沿对应于最小奇异值的左奇异向量方向的微小扰动，在解中被放大了，放大因子等于该奇异值的倒数。这展示了病态系统特有的敏感性。", "answer": "$$\\boxed{10^{12}}$$", "id": "3240884"}, {"introduction": "病态问题不仅仅是理论上的好奇心，它在数据分析（如曲线拟合）中是一个实际的挑战。最后一个练习将让你扮演数值分析师的角色，首先诊断一个由不佳基函数选择引起的严重病态案例。然后，你将实施一个强大的缓解策略——切换到正交多项式基——并量化系统稳定性的显著改善。[@problem_id:3240835]", "problem": "考虑一个标量响应 $y$ 对一组基函数 $\\{\\phi_j(x)\\}_{j=0}^{m-1}$ 在样本点 $\\{x_i\\}_{i=0}^{n-1}$ 上求值的普通最小二乘曲线拟合问题。设设计矩阵 $A \\in \\mathbb{R}^{n \\times m}$ 的元素为 $A_{ij} = \\phi_j(x_i)$，当 $A$ 的列线性无关时，最小二乘法方程为 $A^\\top A \\beta = A^\\top y$，其解系数为 $\\beta \\in \\mathbb{R}^m$。一个具有高度相关列的矩阵在进行最小二乘计算时容易出现数值不稳定性，这可以通过矩阵的条件数来诊断。从向量 $2$-范数下的诱导矩阵范数和 Moore–Penrose 伪逆的核心定义出发，设计并实现一个数值稳定的算法来计算一个满列秩矩形设计矩阵的 $2$-范数条件数 $\\kappa_2(A)$，其推导过程需基于奇异值分解（SVD）且不假设任何快捷公式。然后，通过将样本域映射到 $[-1,1]$ 并使用相应最高阶的 Legendre 多项式作为新基，重新设计基函数以降低列相关性，并评估其对 $\\kappa_2$ 的影响。\n\n您的程序必须构建以下测试套件，计算每种情况下定义的改善因子，即比率 $r = \\kappa_2(A_{\\text{orig}})/\\kappa_2(A_{\\text{redesign}})$，并在一行中以单个列表的形式输出这三个改善因子。\n\n测试套件：\n- 情况 1（边界情况，接近共线性）：$n = 50$，样本 $x_i = 1 + \\left(\\frac{i}{n-1} - \\frac{1}{2}\\right)\\cdot 2\\times 10^{-3}$，其中 $i = 0,1,\\dots,n-1$。原始基函数为 $\\phi_0(x) = 1$，$\\phi_1(x) = x$，$\\phi_2(x) = x + \\varepsilon$，其中 $\\varepsilon = 10^{-6}$。重新设计的基函数：使用样本的最小值和最大值将 $x$ 仿射映射到 $t \\in [-1,1]$，并使用 Legendre 多项式 $P_k(t)$，其中 $k = 0,1,2$。\n- 情况 2（理想情况，中度相关的单项式）：$n = 100$，样本 $x_i = \\frac{i}{n-1}$，其中 $i = 0,1,\\dots,n-1$。原始基函数为 $\\phi_k(x) = x^k$，其中 $k = 0,1,\\dots,6$。重新设计的基函数：将 $x$ 映射到 $t = 2x - 1$，并使用 Legendre 多项式 $P_k(t)$，其中 $k = 0,1,\\dots,6$。\n- 情况 3（边缘情况，已接近正交）：$n = 80$，样本 $x_i = -1 + \\frac{2i}{n-1}$，其中 $i = 0,1,\\dots,n-1$。原始基函数为 Legendre 多项式 $P_k(x)$，其中 $k = 0,1,\\dots,6$。重新设计的基函数：使用样本的最小值和最大值将 $x$ 仿射映射到 $t \\in [-1,1]$，并使用 Legendre 多项式 $P_k(t)$，其中 $k = 0,1,\\dots,6$。\n\n实现细节要求：\n- 通过在指定的样本点上计算所述的基函数来构建每个设计矩阵 $A$，将 $\\phi_j$ 的值放在第 $j$ 列。\n- 通过从诱导 $2$-范数和 Moore–Penrose 伪逆的定义进行推导，实现 $\\kappa_2(A)$ 的计算，最终得到一个基于 SVD 的算法。在问题陈述中，不要假设任何条件数的封闭形式快捷方式；您的解答必须从第一性原理出发证明算法步骤的合理性。\n- 使用它们在 $[-1,1]$ 上的三项递推关系来实现整数阶 $k \\ge 0$ 的 Legendre 多项式 $P_k(t)$；不要调用任何外部特殊函数库。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个改善因子，格式为逗号分隔的列表并用方括号括起来（例如，$[r_1,r_2,r_3]$），其中每个 $r_i$ 是一个对应于上述顺序中第 $i$ 种情况的十进制浮点数。", "solution": "该问题要求推导并实现一种方法，用于计算矩形设计矩阵 $A$ 的 $2$-范数条件数 $\\kappa_2(A)$，并评估通过重新设计基函数在改善条件数方面取得的效果。推导必须基于奇异值分解（SVD）并从第一性原理开始。\n\n### 第 1 部分：通过 SVD 推导 $2$-范数条件数\n\n问题指定推导必须从诱导 $2$-范数和 Moore-Penrose 伪逆的核心定义开始。\n\n**1. 诱导 $2$-范数**\n\n对于矩阵 $A \\in \\mathbb{R}^{n \\times m}$，其诱导 $2$-范数（记作 $\\|A\\|_2$）定义为向量的欧几里得范数经 $A$ 矩阵相乘后的最大放大率：\n$$\n\\|A\\|_2 = \\max_{\\vec{v} \\in \\mathbb{R}^m, \\vec{v} \\neq \\vec{0}} \\frac{\\|A\\vec{v}\\|_2}{\\|\\vec{v}\\|_2}\n$$\n被最大化的量，即瑞利商，可以平方处理：\n$$\n\\frac{\\|A\\vec{v}\\|_2^2}{\\|\\vec{v}\\|_2^2} = \\frac{(A\\vec{v})^\\top (A\\vec{v})}{\\vec{v}^\\top \\vec{v}} = \\frac{\\vec{v}^\\top A^\\top A \\vec{v}}{\\vec{v}^\\top \\vec{v}}\n$$\n矩阵 $A^\\top A$ 是一个大小为 $m \\times m$ 的对称半正定矩阵。该瑞利商的最大值是 $A^\\top A$ 的最大特征值，记作 $\\lambda_{\\max}(A^\\top A)$。因此，\n$$\n\\|A\\|_2^2 = \\lambda_{\\max}(A^\\top A) \\implies \\|A\\|_2 = \\sqrt{\\lambda_{\\max}(A^\\top A)}\n$$\n\n**2. 奇异值分解 (SVD)**\n\n任何矩阵 $A \\in \\mathbb{R}^{n \\times m}$ 都有一个奇异值分解（SVD），其形式为：\n$$\nA = U \\Sigma V^\\top\n$$\n其中 $U \\in \\mathbb{R}^{n \\times n}$ 是一个正交矩阵（$U^\\top U = I_n$），$V \\in \\mathbb{R}^{m \\times m}$ 是一个正交矩阵（$V^\\top V = I_m$），$\\Sigma \\in \\mathbb{R}^{n \\times m}$ 是一个包含 $A$ 的奇异值 $\\sigma_i$ 的矩形对角矩阵。奇异值非负，且通常按 $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge \\sigma_r  0$ 的顺序排列，其中 $r$ 是 $A$ 的秩。在本问题中，给定 $A$ 是满列秩，所以 $r=m$ 且所有 $m$ 个奇异值均为正。\n\n让我们将 $A^\\top A$ 的特征值与 $A$ 的奇异值联系起来。\n$$\nA^\\top A = (U \\Sigma V^\\top)^\\top (U \\Sigma V^\\top) = (V \\Sigma^\\top U^\\top) (U \\Sigma V^\\top)\n$$\n由于 $U^\\top U = I_n$，上式可简化为：\n$$\nA^\\top A = V \\Sigma^\\top \\Sigma V^\\top\n$$\n这是 $A^\\top A$ 的特征分解。$V$ 的列是 $A^\\top A$ 的特征向量，而 $m \\times m$ 矩阵 $\\Sigma^\\top \\Sigma$ 的对角线元素是相应的特征值。矩阵 $\\Sigma^\\top \\Sigma$ 是对角矩阵，其元素为 $\\sigma_1^2, \\sigma_2^2, \\dots, \\sigma_m^2$。\n因此，$A^\\top A$ 的特征值是 $A$ 的奇异值的平方：$\\lambda_i(A^\\top A) = \\sigma_i^2$。\n\n由此，我们可以用奇异值来表示 $A$ 的 $2$-范数：\n$$\n\\|A\\|_2 = \\sqrt{\\lambda_{\\max}(A^\\top A)} = \\sqrt{\\sigma_1^2} = \\sigma_1 = \\sigma_{\\max}(A)\n$$\n\n**3. Moore-Penrose 伪逆**\n\n对于一个矩形矩阵 $A$，其条件数是根据其伪逆 $A^+$ 定义的。Moore-Penrose 伪逆 $A^+$ 是满足四个特定准则的唯一矩阵。对于一个 $n \\ge m$ 且满列秩（如问题所述）的矩阵 $A \\in \\mathbb{R}^{n \\times m}$，其伪逆有一个简单而明确的形式：\n$$\nA^+ = (A^\\top A)^{-1} A^\\top\n$$\n伪逆 $A^+$ 的 SVD 可以从 $A$ 的 SVD 导出，其形式为 $A^+ = V \\Sigma^+ U^\\top$，其中 $\\Sigma^+$ 是 $\\Sigma$ 的伪逆。对于一个满列秩的“高”矩阵 $A$，$\\Sigma$ 是一个 $n \\times m$ 矩阵，其顶部的 $m \\times m$ 块是一个对角矩阵 $D = \\text{diag}(\\sigma_1, \\dots, \\sigma_m)$，其余部分为零。其伪逆 $\\Sigma^+$ 是一个 $m \\times n$ 矩阵，其中左侧的 $m \\times m$ 块是 $D^{-1} = \\text{diag}(1/\\sigma_1, \\dots, 1/\\sigma_m)$，其余部分为零。\n\n$A^+$ 的奇异值是 $A$ 的非零奇异值的倒数。因此，$A^+$ 的奇异值为 $1/\\sigma_1, 1/\\sigma_2, \\dots, 1/\\sigma_m$。\n\n**4. 条件数**\n\n$A$ 的 $2$-范数条件数定义为：\n$$\n\\kappa_2(A) = \\|A\\|_2 \\|A^+\\|_2\n$$\n利用 $2$-范数与最大奇异值之间的关系，我们有：\n$$\n\\|A\\|_2 = \\sigma_{\\max}(A) = \\sigma_1\n$$\n$$\n\\|A^+\\|_2 = \\sigma_{\\max}(A^+) = \\frac{1}{\\sigma_{\\min}(A)} = \\frac{1}{\\sigma_m}\n$$\n这里，$\\sigma_{\\min}(A)$ 指的是 $A$ 的最小非零奇异值。由于 $A$ 是满列秩，其所有 $m$ 个奇异值都是非零的，所以 $\\sigma_{\\min}(A) = \\sigma_m  0$。\n\n综合这些结果，得到条件数的期望表达式：\n$$\n\\kappa_2(A) = \\sigma_{\\max}(A) \\cdot \\frac{1}{\\sigma_{\\min}(A)} = \\frac{\\sigma_1}{\\sigma_m}\n$$\n这个推导过程提供了一个稳定的算法：计算 $A$ 的 SVD，找出最大和最小的奇异值，然后计算它们的比值。这种方法避免了构造可能病态程度更高的矩阵 $A^\\top A$。\n\n### 第 2 部分：基函数重新设计与 Legendre 多项式\n\n最小二乘问题中的病态条件通常源于设计矩阵 $A$ 的列之间的高度相关性。一个常见原因是在一个不以 0 为中心的区间上使用单项式基函数 $\\{\\phi_k(x) = x^k\\}$。为缓解此问题，可以使用正交多项式基。\n\n**1. 仿射变换**\n\n要使用定义在规范区间（如 $[-1, 1]$）上的正交多项式，必须将样本域 $[x_{\\min}, x_{\\max}]$ 映射到该区间。可以使用仿射变换 $t = f(x) = ax+b$。我们要求 $f(x_{\\min}) = -1$ 和 $f(x_{\\max}) = 1$。求解这个关于 $a$ 和 $b$ 的二元一次方程组，可得：\n$$\na = \\frac{2}{x_{\\max} - x_{\\min}} \\quad \\text{和} \\quad b = - \\frac{x_{\\max} + x_{\\min}}{x_{\\max} - x_{\\min}}\n$$\n因此，变换为：\n$$\nt_i = \\frac{2(x_i - x_{\\min})}{x_{\\max} - x_{\\min}} - 1\n$$\n对于情况 2，$x \\in [0, 1]$，这给出 $t = \\frac{2(x - 0)}{1 - 0} - 1 = 2x - 1$。对于情况 3，$x \\in [-1, 1]$，这给出 $t = \\frac{2(x - (-1))}{1 - (-1)} - 1 = x$。\n\n**2. Legendre 多项式**\n\nLegendre 多项式 $P_k(t)$ 是在区间 $[-1, 1]$ 上关于权重函数 $w(t)=1$ 的一个正交多项式序列。它们可以通过三项递推关系（Bonnet 递推公式）生成：\n$$\nP_0(t) = 1\n$$\n$$\nP_1(t) = t\n$$\n$$\n(k+1)P_{k+1}(t) = (2k+1)tP_k(t) - kP_{k-1}(t) \\quad \\text{对于 } k \\ge 1\n$$\n对于变换后的变量 $t$，使用这些多项式作为基函数 $\\phi_k(t) = P_k(t)$，会使得设计矩阵的列近似正交，从而显著降低条件数。改善效果通过比率 $r = \\kappa_2(A_{\\text{orig}}) / \\kappa_2(A_{\\text{redesign}})$ 来量化。\n\n### 第 3 部分：测试用例执行计划\n\n对于每种情况，算法按以下步骤进行：\n1.  生成样本点 $x_i$，其中 $i=0, \\dots, n-1$。\n2.  通过在每个 $x_i$ 上评估指定的原始基函数，构建原始设计矩阵 $A_{\\text{orig}} \\in \\mathbb{R}^{n \\times m}$。\n3.  使用 SVD 例程计算 $A_{\\text{orig}}$ 的奇异值。计算 $\\kappa_2(A_{\\text{orig}}) = \\sigma_{\\max}/\\sigma_{\\min}$。\n4.  应用仿射变换将 $x_i$ 点映射到 $t_i \\in [-1, 1]$。\n5.  通过评估所需最高阶的 Legendre 多项式 $P_k(t_i)$，构建重新设计的设计矩阵 $A_{\\text{redesign}} \\in \\mathbb{R}^{n \\times m}$。\n6.  计算 $A_{\\text{redesign}}$ 的奇异值并计算 $\\kappa_2(A_{\\text{redesign}})$。\n7.  计算改善因子 $r = \\kappa_2(A_{\\text{orig}}) / \\kappa_2(A_{\\text{redesign}})$。\n然后报告这三种情况的结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef legendre_poly_values(max_k: int, t_values: np.ndarray) - np.ndarray:\n    \"\"\"\n    Computes Legendre polynomial values P_k(t) for k=0 to max_k.\n\n    Args:\n        max_k: The maximum degree of the polynomial.\n        t_values: A 1D numpy array of points t to evaluate the polynomials at.\n\n    Returns:\n        A numpy array of shape (len(t_values), max_k + 1), where column j\n        contains the values of P_j(t).\n    \"\"\"\n    n_samples = len(t_values)\n    # The matrix p_matrix will store P_k(t) in column k.\n    p_matrix = np.zeros((n_samples, max_k + 1))\n\n    # Base case P_0(t) = 1\n    if max_k = 0:\n        p_matrix[:, 0] = 1.0\n\n    # Base case P_1(t) = t\n    if max_k = 1:\n        p_matrix[:, 1] = t_values\n\n    # Recurrence relation for k = 1:\n    # (k+1)P_{k+1}(t) = (2k+1)t*P_k(t) - k*P_{k-1}(t)\n    for k in range(1, max_k):\n        # This calculates P_{k+1}(t) and stores it in column k+1.\n        pk_plus_1 = ((2 * k + 1) * t_values * p_matrix[:, k] - k * p_matrix[:, k - 1]) / (k + 1)\n        p_matrix[:, k + 1] = pk_plus_1\n        \n    return p_matrix\n\ndef compute_condition_number(A: np.ndarray) - float:\n    \"\"\"\n    Computes the 2-norm condition number of a matrix A using SVD.\n    kappa_2(A) = sigma_max / sigma_min.\n    \"\"\"\n    try:\n        singular_values = np.linalg.svd(A, compute_uv=False)\n        # Assuming A has full column rank, the smallest singular value is non-zero.\n        # Handle potential floating point underflow for sigma_min.\n        if singular_values[-1]  np.finfo(float).eps:\n            return np.inf\n        return singular_values[0] / singular_values[-1]\n    except np.linalg.LinAlgError:\n        return np.inf\n\ndef solve():\n    \"\"\"\n    Main function to run test suite and compute improvement factors.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (boundary, near-collinearity)\n        {\n            \"n\": 50,\n            \"m\": 3,\n            \"x_gen\": lambda n: 1.0 + (np.arange(n, dtype=float) / (n - 1) - 0.5) * 2e-3,\n            \"orig_basis_builder\": lambda x, m: np.column_stack([np.ones_like(x), x, x + 1e-6]),\n            \"redesign_max_k\": 2\n        },\n        # Case 2 (happy path, moderately correlated monomials)\n        {\n            \"n\": 100,\n            \"m\": 7,\n            \"x_gen\": lambda n: np.arange(n, dtype=float) / (n - 1),\n            \"orig_basis_builder\": lambda x, m: np.vander(x, m, increasing=True),\n            \"redesign_max_k\": 6\n        },\n        # Case 3 (edge case, already near-orthogonal)\n        {\n            \"n\": 80,\n            \"m\": 7,\n            \"x_gen\": lambda n: -1.0 + 2.0 * np.arange(n, dtype=float) / (n - 1),\n            \"orig_basis_builder\": lambda x, m: legendre_poly_values(m - 1, x),\n            \"redesign_max_k\": 6\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        n = case[\"n\"]\n        m = case[\"m\"]\n        \n        # 1. Generate sample points\n        x_i = case[\"x_gen\"](n)\n\n        # 2. Construct and analyze original design matrix\n        A_orig = case[\"orig_basis_builder\"](x_i, m)\n        kappa_orig = compute_condition_number(A_orig)\n\n        # 3. Transform sample points for redesign\n        x_min, x_max = np.min(x_i), np.max(x_i)\n        # Affine map x to t in [-1, 1]\n        # Avoid division by zero if x_min == x_max\n        if x_max  x_min:\n            t_i = 2.0 * (x_i - x_min) / (x_max - x_min) - 1.0\n        else: # all points are the same\n            t_i = np.zeros_like(x_i)\n\n        # 4. Construct and analyze redesigned design matrix\n        max_k = case[\"redesign_max_k\"]\n        A_redesign = legendre_poly_values(max_k, t_i)\n        kappa_redesign = compute_condition_number(A_redesign)\n        \n        # 5. Compute improvement factor\n        if kappa_redesign  np.finfo(float).eps:\n            improvement_factor = kappa_orig / kappa_redesign\n        else:\n            # If redesigned kappa is near zero, improvement is effectively infinite.\n            improvement_factor = np.inf\n            \n        results.append(improvement_factor)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3240835"}]}