{"hands_on_practices": [{"introduction": "为了真正理解一个概念，从最简单的情况入手往往是最好的方法。本练习将探讨一个看似微不足道但极具启发性的问题：如何为仅有的两个数据点构建三次样条？[@problem_id:3220918] 这个思想实验将迫使我们回归自然样条和钳制样条的根本定义，从而揭示它们在没有内部节点时的本质区别。通过此练习，您将亲身体会到不同的边界条件如何从根本上决定了插值曲线的形态。", "problem": "考虑一个恰好包含 $2$ 个不同节点 $\\{(x_0,y_0),(x_1,y_1)\\}$（其中 $x_0  x_1$）的数据集。区间上的三次样条被定义为一个函数，它在每个子区间上是次数至多为 $3$ 的多项式，对给定数据进行插值，并且是二阶连续可微的。当只有一个子区间 $[x_0,x_1]$ 时，不存在内部节点，因此在内部节点处的所有连续性条件都是空泛满足的。边界条件区分了常见的样条变体：自然样条施加条件 $s''(x_0)=0$ 和 $s''(x_1)=0$，而钳制样条则对给定的端点斜率 $m_0$ 和 $m_1$ 施加条件 $s'(x_0)=m_0$ 和 $s'(x_1)=m_1$。仅使用这些基本定义，仔细推断当只有 $2$ 个数据点时，样条的存在性、唯一性及其最终形式。\n\n哪个陈述是正确的？\n\n- A. 对于 $2$ 个数据点，自然三次样条是未定义的，因为没有内部节点，且通常的三对角系统无法形成；类似地，钳制样条也是未定义的，除非添加更多的点。\n- B. 对于 $2$ 个数据点，自然三次样条存在且退化为穿过 $(x_0,y_0)$ 和 $(x_1,y_1)$ 的唯一一条直线；钳制三次样条存在且退化为在 $[x_0,x_1]$ 上匹配 $s(x_i)=y_i$ 和 $s'(x_i)=m_i$（其中 $i\\in\\{0,1\\}$）的唯一一个三次 Hermite 插值多项式。\n- C. 对于 $2$ 个数据点，自然样条和钳制样条都存在，并且在 $[x_0,x_1]$ 上总是相同的三次多项式，与规定的端点斜率无关。\n- D. 对于 $2$ 个数据点，钳制三次样条仅当规定的斜率 $m_0$ 和 $m_1$ 都等于割线斜率 $(y_1-y_0)/(x_1-x_0)$ 时才存在；否则，不存在解。\n- E. 对于 $2$ 个数据点，自然三次样条是这两个点的任意一个三次插值多项式，因为在没有内部节点时，二阶导数的连续性条件是空泛满足的。", "solution": "问题陈述提出了一个关于在只有 $2$ 个不同数据点的最小情况下，自然和钳制三次样条的存在性、唯一性和形式的问题。在继续之前，我们必须验证问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n- 数据集：恰好 $2$ 个不同节点 $\\{(x_0,y_0),(x_1,y_1)\\}$，其中 $x_0  x_1$。\n- 样条定义：一个函数 $s(x)$，它在区间 $[x_0,x_1]$ 上是次数至多为 $3$ 的多项式。\n- 插值条件：$s(x_0) = y_0$ 和 $s(x_1) = y_1$。\n- 连续性条件：由于只有一个区间 $[x_0,x_1]$ 且没有内部节点，因此在内部节点处 $s(x)$、$s'(x)$ 和 $s''(x)$ 的连续性条件是空泛满足的。\n- 自然样条边界条件：$s''(x_0) = 0$ 和 $s''(x_1) = 0$。\n- 钳制样条边界条件：对于给定的斜率 $m_0$ 和 $m_1$，有 $s'(x_0) = m_0$ 和 $s'(x_1) = m_1$。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题陈述在科学上和数学上都是合理的。它是适定的、客观的和自洽的。所提供的三次样条、自然样条和钳制样条的定义在数值分析领域是标准的。2 个点的场景是一个完全有效（尽管简单）的案例，可以应用这些定义。该问题不违反任何基本原则，没有歧义，并要求严格应用定义来确定所得函数的性质。这是一个有效的练习，旨在理解样条的基本定义，超越了在更大数据集上的常见应用。\n\n### 步骤 3：结论与行动\n问题是有效的。我们现在将继续进行解的正式推导。\n\n### 推导过程\n\n单个区间 $[x_0,x_1]$ 上的三次样条是一个次数至多为 $3$ 的多项式 $s(x)$。我们可以将此多项式表示为：\n$$s(x) = a_3 x^3 + a_2 x^2 + a_1 x + a_0$$\n该多项式有 $4$ 个必须确定的系数（$a_3, a_2, a_1, a_0$）。插值条件 $s(x_0) = y_0$ 和 $s(x_1) = y_1$ 提供了 $2$ 个线性方程。为了唯一地确定该多项式，还需要 $2$ 个额外的条件。这些条件由边界条件提供。\n\n**情况 1：自然三次样条**\n\n自然样条施加以下边界条件：\n1. $s''(x_0) = 0$\n2. $s''(x_1) = 0$\n\n让我们计算 $s(x)$ 的二阶导数：\n$$s'(x) = 3a_3 x^2 + 2a_2 x + a_1$$\n$$s''(x) = 6a_3 x + 2a_2$$\n二阶导数 $s''(x)$ 是 $x$ 的一个线性函数。边界条件指出这个线性函数在两个不同的点 $x_0$ 和 $x_1$ 处为零。一个非零的线性函数最多只能有一个根。因此，要使 $s''(x)$ 在两个不同的点处为零，它必须是零多项式。\n$$s''(x) = 0 \\quad \\forall x \\in [x_0, x_1]$$\n这意味着 $6a_3 = 0$ 和 $2a_2 = 0$，即 $a_3 = 0$ 和 $a_2 = 0$。\n\n当 $a_3=0$ 和 $a_2=0$ 时，样条函数 $s(x)$ 简化为一个线性多项式：\n$$s(x) = a_1 x + a_0$$\n剩下的系数 $a_1$ 和 $a_0$ 由 $2$ 个插值条件确定：\n1. $s(x_0) = a_1 x_0 + a_0 = y_0$\n2. $s(x_1) = a_1 x_1 + a_0 = y_1$\n这是一个关于 $2$ 个未知数（$a_1, a_0$）的 $2$ 元线性方程组。由于 $x_0 \\neq x_1$，该方程组有唯一解。该解定义了穿过点 $(x_0, y_0)$ 和 $(x_1, y_1)$ 的唯一一条直线。\n因此，对于 $2$ 个数据点，自然三次样条存在、唯一，并且是连接这两点的直线。\n\n**情况 2：钳制三次样条**\n\n钳制样条对一阶导数施加边界条件：\n1. $s'(x_0) = m_0$\n2. $s'(x_1) = m_1$\n\n我们总共有 $4$ 个条件来确定三次多项式 $s(x)$ 的 $4$ 个系数：\n1. $s(x_0) = y_0$\n2. $s(x_1) = y_1$\n3. $s'(x_0) = m_0$\n4. $s'(x_1) = m_1$\n\n这些条件恰好是定义区间 $[x_0, x_1]$ 上唯一的三次 Hermite 插值多项式的条件。对于任意给定的值集 $\\{y_0, y_1, m_0, m_1\\}$ 以及不同的点 $x_0$ 和 $x_1$，数值分析中的一个标准结果是，存在一个唯一的次数至多为 $3$ 的多项式满足这 $4$ 个条件。其存在性和唯一性是保证的，因为关于系数 $(a_3, a_2, a_1, a_0)$ 的相关 $4 \\times 4$ 线性系统是非奇异的。\n\n因此，对于 $2$ 个数据点，钳制三次样条存在，并与由端点处的函数值和指定的导数值所定义的唯一三次 Hermite 插值多项式相同。除非斜率 $m_0$ 和 $m_1$ 恰好等于割线斜率 $(y_1-y_0)/(x_1-x_0)$，否则该多项式的次数将高于 $1$。\n\n### 逐项分析\n\n- **A. 对于 $2$ 个数据点，自然三次样条是未定义的，因为没有内部节点，且通常的三对角系统无法形成；类似地，钳制样条也是未定义的，除非添加更多的点。**\n这个陈述是不正确的。三对角系统是解决多节点情况的一种计算方法，而不是基本定义的一部分。缺少这种特定的计算结构并不意味着该数学对象是未定义的。如上所述，将基本定义应用于 $2$ 点情况，对自然样条和钳制样条都能得出唯一的、定义良好的函数。\n**结论：不正确。**\n\n- **B. 对于 $2$ 个数据点，自然三次样条存在且退化为穿过 $(x_0,y_0)$ 和 $(x_1,y_1)$ 的唯一一条直线；钳制三次样条存在且退化为在 $[x_0,x_1]$ 上匹配 $s(x_i)=y_i$ 和 $s'(x_i)=m_i$（其中 $i\\in\\{0,1\\}$）的唯一一个三次 Hermite 插值多项式。**\n这个陈述与我们的推导完全一致。\n自然样条条件 $s''(x_0)=0$ 和 $s''(x_1)=0$ 迫使三次多项式成为线性的。插值条件随后选择了穿过这两个点的唯一一条直线。\n钳制样条条件 $s(x_0)=y_0, s(x_1)=y_1, s'(x_0)=m_0, s'(x_1)=m_1$ 是区间 $[x_0,x_1]$ 上三次 Hermite 插值的明确定义，已知其有唯一解。\n**结论：正确。**\n\n- **C. 对于 $2$ 个数据点，自然样条和钳制样条都存在，并且在 $[x_0,x_1]$ 上总是相同的三次多项式，与规定的端点斜率无关。**\n这个陈述是不正确的。自然样条是一个线性多项式（次数为 $1$）。钳制样条通常是一个三次多项式（次数最高为 $3$），其系数直接取决于规定的斜率 $m_0$ 和 $m_1$。它们并非“总是相同”，并且钳制样条也并非“与规定的端点斜率无关”。它们仅在规定的斜率 $m_0$ 和 $m_1$ 都等于连接两点的直线斜率 $(y_1-y_0)/(x_1-x_0)$ 这一特定情况下才相同。\n**结论：不正确。**\n\n- **D. 对于 $2$ 个数据点，钳制三次样条仅当规定的斜率 $m_0$ 和 $m_1$ 都等于割线斜率 $(y_1-y_0)/(x_1-x_0)$ 时才存在；否则，不存在解。**\n这个陈述是不正确的。正如在钳制样条的推导中所确立的，对于*任何*给定的 $m_0$ 和 $m_1$ 值，都存在一个唯一的解（三次 Hermite 插值多项式）。所提到的条件不是存在的条件；而是（三次）钳制样条退化为（线性）自然样条的特定条件。\n**结论：不正确。**\n\n- **E. 对于 $2$ 个数据点，自然三次样条是这两个点的任意一个三次插值多项式，因为在没有内部节点时，二阶导数的连续性条件是空泛满足的。**\n这个陈述是不正确的。它将内部节点处空泛满足的连续性条件与非空泛的边界条件混淆了。自然样条的定义明确施加了 $s''(x_0)=0$ 和 $s''(x_1)=0$。这是 $2$ 个强有力的约束，与 $2$ 个插值约束一起，唯一地确定了该多项式。这导致了一个单一、唯一的解（即直线），而不是一个“任意三次插值多项式”的族。有无数个三次多项式可以插值两个点，但其中只有一个是自然样条。\n**结论：不正确。**", "answer": "$$\\boxed{B}$$", "id": "3220918"}, {"introduction": "在掌握了最基本情况下的概念后，下一步是引入一个内部节点，构建一个包含两个三次多项式片段的样条。本练习要求您从第一性原理出发，为三个数据点（即两个区间）推导自然和钳制样条的显式表达式 [@problem_id:3220853]。通过手动求解这个小型方程组，您将深入理解 $C^2$ 连续性条件和边界条件如何共同作用以确保样条的平滑性，并直观地看到一个端点的约束如何影响整个曲线的形状。", "problem": "设 $x_0=0$，$x_1=1$ 和 $x_2=2$ 是三个不同的节点，其对应的数据值为 $y_0$、$y_1$ 和 $y_2$。考虑一个二次连续可微的分段三次插值函数 $S(x)$，它在 $[x_0,x_1]$ 上由三次多项式 $S_0(x)$ 构成，在 $[x_1,x_2]$ 上由三次多项式 $S_1(x)$ 构成，满足在节点处的标准三次样条插值条件以及在内部节点 $x_1$ 处的一阶和二阶导数连续性。仅从三次样条的定义性质（在每个区间上是分段三次的，在闭区间 $[x_0,x_2]$ 上具有 $C^2$ 连续性，在节点处进行插值，以及边界条件）出发，完成以下任务。\n\n1. 推导在 $[0,2]$ 上的自然三次样条的闭式表达式，即唯一的满足 $S''(x_0)=0$ 和 $S''(x_2)=0$ 的 $S(x)$。通过从插值条件和平滑性条件中显式求解两个三次多项式 $S_0(x)$ 和 $S_1(x)$ 的系数来完成。\n2. 推导在 $[0,2]$ 上的钳制三次样条的闭式表达式，即唯一的满足 $S'(x_0)=m_0$ 和 $S'(x_2)=m_2$ 的 $S(x)$，其中 $m_0$ 和 $m_2$ 是给定的端点斜率。同样通过从插值条件和平滑性条件中显式求解 $S_0(x)$ 和 $S_1(x)$ 的系数来完成。\n3. 使用你推导出的显式公式，通过将其系数表示为 $y_0$、$y_1$、$y_2$ 以及（在钳制情况下）$m_0$ 和 $m_2$ 的函数，来分析端点约束如何传播到 $[0,1]$ 上的内部三次多项式 $S_0(x)$。特别地，讨论哪些端点量影响 $S_0(x)$ 的三次项系数。\n\n你最终报告的答案必须是一个单一的解析表达式：自然样条中 $S_0(x)$ 的 $x^3$ 系数减去钳制样条中 $S_0(x)$ 的 $x^3$ 系数，用 $y_0$、$y_1$、$y_2$、$m_0$ 和 $m_2$ 表示。不需要进行数值计算，也不需要四舍五入。不要包含单位。", "solution": "问题是为给定的三个节点推导和比较自然三次样条和钳制三次样条。推导将从三次样条的基本性质出发。\n\n插值数据 $(x_i, y_i)$（$i=0, 1, \\dots, n$）的三次样条 $S(x)$ 是一个分段三次函数。在每个子区间 $[x_i, x_{i+1}]$ 上，$S(x)$ 是一个三次多项式，记为 $S_i(x)$。该样条及其一阶和二阶导数是连续的，即 $S(x) \\in C^2[x_0, x_n]$。\n\n在本问题中，我们有节点 $x_0=0$, $x_1=1$ 和 $x_2=2$，以及对应的数据值 $y_0, y_1, y_2$。步长是均匀的：$h_0 = x_1 - x_0 = 1$ 且 $h_1 = x_2 - x_1 = 1$。令 $h=1$。该样条由两个三次多项式段组成：$[0,1]$ 上的 $S_0(x)$ 和 $[1,2]$ 上的 $S_1(x)$。\n\n由于 $S_i(x)$ 是一个三次多项式，其二阶导数 $S_i''(x)$ 是一个线性函数。由于 $S(x)$ 的 $C^2$ 连续性，节点处的二阶导数值 $M_i = S''(x_i)$ 是良定义的。$S_i''(x)$ 的线性性质使其可以表示为：\n$$S_i''(x) = M_i \\frac{x_{i+1} - x}{h_i} + M_{i+1} \\frac{x - x_i}{h_i}$$\n将此表达式对 $x$ 积分两次，并施加插值条件 $S_i(x_i) = y_i$ 和 $S_i(x_{i+1}) = y_{i+1}$，得到 $S_i(x)$ 的表达式：\n$$S_i(x) = \\frac{M_i}{6h_i}(x_{i+1}-x)^3 + \\frac{M_{i+1}}{6h_i}(x-x_i)^3 + \\left(\\frac{y_i}{h_i} - \\frac{M_i h_i}{6}\\right)(x_{i+1}-x) + \\left(\\frac{y_{i+1}}{h_i} - \\frac{M_{i+1}h_i}{6}\\right)(x-x_i)$$\n一阶导数的连续性条件 $S'_{i-1}(x_i) = S'_i(x_i)$ 为未知的矩 $M_i$ 提供了一个线性方程组。对于一个内部节点 $x_i$，该条件导出以下通用方程：\n$$h_{i-1}M_{i-1} + 2(h_{i-1}+h_i)M_i + h_iM_{i+1} = 6\\left(\\frac{y_{i+1}-y_i}{h_i} - \\frac{y_i-y_{i-1}}{h_{i-1}}\\right)$$\n在我们的具体情况下，只有一个内部节点 $x_1=1$。当 $h_0=h_1=1$ 时，对于 $i=1$ 的方程变为：\n$$1 \\cdot M_0 + 2(1+1)M_1 + 1 \\cdot M_2 = 6\\left(\\frac{y_2-y_1}{1} - \\frac{y_1-y_0}{1}\\right)$$\n$$M_0 + 4M_1 + M_2 = 6(y_0 - 2y_1 + y_2)$$\n这个单一方程有三个未知数 $M_0, M_1, M_2$。另外两个方程由边界条件提供。\n\n我们可以将多项式段 $S_0(x)$ 和 $S_1(x)$ 表示为 $S_i(x) = a_i + b_i(x-x_i) + c_i(x-x_i)^2 + d_i(x-x_i)^3$ 的形式。系数由在 $x_i$ 处的导数给出：\n$a_i = S(x_i) = y_i$\n$b_i = S'(x_i)$\n$c_i = S''(x_i)/2 = M_i/2$\n$d_i = S'''(x_i)/6 = \\frac{M_{i+1}-M_i}{6h_i}$\n一阶导数 $S'(x_i)$ 也可以用矩来表示：$S'_i(x_i) = \\frac{y_{i+1}-y_i}{h_i} - \\frac{h_i}{6}(2M_i+M_{i+1})$。\n\n### 1. 自然三次样条\n自然边界条件是 $S''(x_0)=0$ 和 $S''(x_2)=0$，这意味着 $M_0=0$ 和 $M_2=0$。\n将这些代入连续性方程：\n$$0 + 4M_1 + 0 = 6(y_0 - 2y_1 + y_2)$$\n$$M_1 = \\frac{3}{2}(y_0 - 2y_1 + y_2)$$\n现在我们求 $[0,1]$ 上 $S_{0,nat}(x)$ 的系数：\n$a_0 = y_0$\n$c_0 = M_0/2 = 0$\n$d_0 = \\frac{M_1 - M_0}{6h_0} = \\frac{M_1 - 0}{6(1)} = \\frac{1}{6} \\left(\\frac{3}{2}(y_0 - 2y_1 + y_2)\\right) = \\frac{1}{4}(y_0 - 2y_1 + y_2)$\n$b_0 = S'_0(x_0) = \\frac{y_1-y_0}{h_0} - \\frac{h_0}{6}(2M_0+M_1) = (y_1-y_0) - \\frac{1}{6}(0+M_1) = y_1 - y_0 - \\frac{1}{6}\\left(\\frac{3}{2}(y_0 - 2y_1 + y_2)\\right)$\n$b_0 = y_1 - y_0 - \\frac{1}{4}y_0 + \\frac{1}{2}y_1 - \\frac{1}{4}y_2 = -\\frac{5}{4}y_0 + \\frac{3}{2}y_1 - \\frac{1}{4}y_2$\n因此，自然样条的第一个多项式段是：\n$$S_{0,nat}(x) = y_0 + \\left(-\\frac{5}{4}y_0 + \\frac{3}{2}y_1 - \\frac{1}{4}y_2\\right) x + \\frac{1}{4}(y_0 - 2y_1 + y_2) x^3$$\n为完整起见，对于 $[1,2]$ 上的 $S_{1,nat}(x)$：\n$a_1 = y_1$, $c_1 = M_1/2 = \\frac{3}{4}(y_0 - 2y_1 + y_2)$, $d_1 = \\frac{M_2-M_1}{6h_1} = -\\frac{M_1}{6} = -\\frac{1}{4}(y_0 - 2y_1 + y_2)$, 以及 $b_1 = S'_1(x_1) = S'_0(x_1) = b_0 + 2c_0 + 3d_0 = b_0+3d_0 = (-\\frac{5}{4}y_0 + \\frac{3}{2}y_1 - \\frac{1}{4}y_2) + 3(\\frac{1}{4}(y_0 - 2y_1 + y_2)) = -\\frac{1}{2}y_0 + \\frac{1}{2}y_2$。\n\n### 2. 钳制三次样条\n钳制边界条件是 $S'(x_0)=m_0$ 和 $S'(x_2)=m_2$。\n条件 $S'_0(x_0)=m_0$ 给出：\n$m_0 = \\frac{y_1-y_0}{h_0} - \\frac{h_0}{6}(2M_0+M_1) \\implies m_0 = y_1 - y_0 - \\frac{1}{6}(2M_0+M_1)$, 这导出：\n$2M_0 + M_1 = 6(y_1 - y_0 - m_0)$\n条件 $S'_1(x_2)=m_2$ 给出：\n$m_2 = S'_1(x_1+h_1) = \\frac{y_2-y_1}{h_1} + \\frac{h_1}{6}(M_1+2M_2) \\implies m_2 = y_2 - y_1 + \\frac{1}{6}(M_1+2M_2)$, 这导出：\n$M_1 + 2M_2 = 6(m_2 - y_2 + y_1)$\n我们得到一个关于 $M_0, M_1, M_2$ 的三元线性方程组：\n(1) $M_0 + 4M_1 + M_2 = 6(y_0 - 2y_1 + y_2)$\n(2) $2M_0 + M_1 = 6(y_1 - y_0 - m_0)$\n(3) $M_1 + 2M_2 = 6(m_2 - y_2 + y_1)$\n由(2)和(3)，我们将 $M_0$ 和 $M_2$ 用 $M_1$ 表示：\n$M_0 = 3(y_1-y_0-m_0) - \\frac{1}{2}M_1$\n$M_2 = 3(m_2-y_2+y_1) - \\frac{1}{2}M_1$\n将这些代入(1)：\n$[3(y_1-y_0-m_0) - \\frac{1}{2}M_1] + 4M_1 + [3(m_2-y_2+y_1) - \\frac{1}{2}M_1] = 6(y_0 - 2y_1 + y_2)$\n$3M_1 - 3y_0 + 6y_1 - 3y_2 - 3m_0 + 3m_2 = 6y_0 - 12y_1 + 6y_2$\n$3M_1 = 9y_0 - 18y_1 + 9y_2 + 3m_0 - 3m_2$\n$M_1 = 3(y_0 - 2y_1 + y_2) + m_0 - m_2$\n现在我们求 $M_0$：\n$M_0 = 3(y_1-y_0-m_0) - \\frac{1}{2}(3(y_0 - 2y_1 + y_2) + m_0 - m_2) = -\\frac{9}{2}y_0 + 6y_1 - \\frac{3}{2}y_2 - \\frac{7}{2}m_0 + \\frac{1}{2}m_2$.\n现在我们求 $[0,1]$ 上 $S_{0,clamped}(x)$ 的系数：\n$a_0 = y_0$\n$b_0 = S'_0(x_0) = m_0$\n$c_0 = M_0/2 = -\\frac{9}{4}y_0 + 3y_1 - \\frac{3}{4}y_2 - \\frac{7}{4}m_0 + \\frac{1}{4}m_2$\n$d_0 = \\frac{M_1 - M_0}{6h_0} = \\frac{1}{6}(M_1 - M_0)$\n$M_1-M_0 = (3y_0-6y_1+3y_2+m_0-m_2) - (-\\frac{9}{2}y_0+6y_1-\\frac{3}{2}y_2-\\frac{7}{2}m_0+\\frac{1}{2}m_2) = \\frac{15}{2}y_0 - 12y_1 + \\frac{9}{2}y_2 + \\frac{9}{2}m_0 - \\frac{3}{2}m_2$\n$d_0 = \\frac{1}{6}\\left(\\frac{15}{2}y_0 - 12y_1 + \\frac{9}{2}y_2 + \\frac{9}{2}m_0 - \\frac{3}{2}m_2\\right) = \\frac{5}{4}y_0 - 2y_1 + \\frac{3}{4}y_2 + \\frac{3}{4}m_0 - \\frac{1}{4}m_2$\n钳制样条的第一个多项式段是：\n$$S_{0,clamped}(x) = y_0 + m_0 x + \\left(-\\frac{9}{4}y_0 + 3y_1 - \\frac{3}{4}y_2 - \\frac{7}{4}m_0 + \\frac{1}{4}m_2\\right) x^2 + \\left(\\frac{5}{4}y_0 - 2y_1 + \\frac{3}{4}y_2 + \\frac{3}{4}m_0 - \\frac{1}{4}m_2\\right) x^3$$\n\n### 3. 分析与比较\n问题的最后一部分是分析两种情况下 $S_0(x)$ 的三次项系数并计算它们的差值。\n\n自然样条 $S_{0,nat}(x)$ 的三次项系数是 $d_{0,nat} = \\frac{1}{4}(y_0 - 2y_1 + y_2)$。该系数取决于所有三个数据值 $y_0, y_1, y_2$。来自端点 $x_2=2$ 的信息，即 $y_2$，传播到了第一个区间 $[0,1]$ 上多项式的系数中。这说明了样条插值的全局性；任何一个数据点的改变都会影响整个曲线。\n\n钳制样条 $S_{0,clamped}(x)$ 的三次项系数是 $d_{0,clamped} = \\frac{5}{4}y_0 - 2y_1 + \\frac{3}{4}y_2 + \\frac{3}{4}m_0 - \\frac{1}{4}m_2$。该系数取决于所有数据值 $y_0, y_1, y_2$，以及两个端点斜率约束 $m_0$ 和 $m_2$。这种影响同样是全局性的：远端点 $x_2=2$ 处给定的斜率 $m_2$ 会影响初始区间 $[0,1]$ 上样条的三次项。\n\n两个三次项系数之差为：\n$$d_{0,nat} - d_{0,clamped} = \\left(\\frac{1}{4}y_0 - \\frac{1}{2}y_1 + \\frac{1}{4}y_2\\right) - \\left(\\frac{5}{4}y_0 - 2y_1 + \\frac{3}{4}y_2 + \\frac{3}{4}m_0 - \\frac{1}{4}m_2\\right)$$\n$$d_{0,nat} - d_{0,clamped} = \\left(\\frac{1}{4} - \\frac{5}{4}\\right)y_0 + \\left(-\\frac{1}{2} + 2\\right)y_1 + \\left(\\frac{1}{4} - \\frac{3}{4}\\right)y_2 - \\frac{3}{4}m_0 + \\frac{1}{4}m_2$$\n$$d_{0,nat} - d_{0,clamped} = -y_0 + \\frac{3}{2}y_1 - \\frac{1}{2}y_2 - \\frac{3}{4}m_0 + \\frac{1}{4}m_2$$", "answer": "$$\\boxed{-y_0 + \\frac{3}{2}y_1 - \\frac{1}{2}y_2 - \\frac{3}{4}m_0 + \\frac{1}{4}m_2}$$", "id": "3220853"}, {"introduction": "理论推导为我们提供了坚实的基础，但真正的挑战和乐趣在于将这些知识付诸实践并观察其效果。本练习是一个编程任务，旨在揭示自然样条的一个重要实践问题：当数据点出现急剧变化时，它可能会产生不符合直觉的振荡 [@problem_id:3220873]。您将通过代码实现自然样条和钳制样条，并利用一个精心设计的数据集来复现这种振荡现象，然后探索如何通过设定钳制边界条件来有效抑制它，从而生成更符合预期的平滑曲线。", "problem": "要求您从第一性原理出发，实现具有两种不同端点边界条件（即自然边界条件和钳制边界条件）的三次样条插值的构建与求值。三次样条是一个分段函数，由在连续子区间上的三次多项式组成，它插值给定的数据点，并在整个定义域上二阶连续可微。自然边界条件将端点的二阶导数设置为零，而钳制边界条件则指定端点的一阶导数。您的任务是：\n- 针对严格递增的横坐标 $\\{x_i\\}_{i=0}^{n-1}$ 和纵坐标 $\\{y_i\\}_{i=0}^{n-1}$，推导出一个算法公式，用于计算在自然或钳制边界条件下唯一的三次样条插值。推导必须从其定义属性开始：区间内为三次函数、满足插值约束，以及在内部节点处直到二阶导数都连续。\n- 实现两种边界条件的选择。对于钳制边界条件，使用由单边割线斜率给出的端点导数，\n$$\ns_0 \\equiv \\frac{y_1 - y_0}{x_1 - x_0}, \\quad s_{n-1} \\equiv \\frac{y_{n-1} - y_{n-2}}{x_{n-1} - x_{n-2}}.\n$$\n\n为了量化反直觉的振荡，将一个子区间 $[x_i,x_{i+1}]$ 上的超调量定义如下。设 $m_i = \\min\\{y_i,y_{i+1}\\}$ 且 $M_i = \\max\\{y_i,y_{i+1}\\}$。设 $S(x)$ 表示样条函数的值。在 $[x_i,x_{i+1}]$ 上的超调量为\n$$\n\\Delta_i \\equiv \\max\\Big\\{ \\max_{x \\in [x_i,x_{i+1}]} \\big(S(x) - M_i\\big), \\ \\max_{x \\in [x_i,x_{i+1}]}\\big(m_i - S(x)\\big), \\ 0 \\Big\\}.\n$$\n全局超调量为 $\\Delta \\equiv \\max_i \\Delta_i$。通过在每个 $[x_i,x_{i+1}]$ 上的一个包含 $1001$ 个点的均匀网格上计算 $S(x)$ 的值，来数值逼近子区间的最大值。\n\n实现一个单一的程序，该程序：\n- 为测试套件中的每个数据集，构建自然样条和钳制样条（使用上述的 $s_0$ 和 $s_{n-1}$）。\n- 计算并报告每个样条的全局超调量 $\\Delta$。\n\n您的实现必须是完全自包含的，并且除了指定的库之外，不得调用任何外部库。所有计算均在纯数学范畴内进行（无物理单位）。\n\n测试套件。使用以下数据集，每个数据集均以等长且 $x$ 严格递增的列表 $x$ 和 $y$ 给出：\n\n- 情况 A（左端陡峭，导致自然样条在左端点附近产生大的振荡）：\n  - $x = [\\,0.0,\\,0.5,\\,0.6,\\,2.0\\,]$\n  - $y = [\\,0.0,\\,1.0,\\,10.0,\\,12.0\\,]$\n\n- 情况 B（近线性，理想情况）：\n  - $x = [\\,0.0,\\,1.0,\\,2.0,\\,3.0\\,]$\n  - $y = [\\,0.0,\\,1.0,\\,2.0,\\,3.0\\,]$\n\n- 情况 C（右端陡峭，导致自然样条在右端点附近产生大的振荡）：\n  - $x = [\\,0.0,\\,1.4,\\,1.5,\\,2.0\\,]$\n  - $y = [\\,0.0,\\,2.0,\\,3.0,\\,3.2\\,]$\n\n对于每种情况，计算并返回一对超调量 $\\Delta_{\\text{natural}}$ 和 $\\Delta_{\\text{clamped}}$ 作为浮点数。您的程序应生成单行输出，其中包含按顺序连接的所有结果，形式为逗号分隔的列表，并用方括号括起，顺序如下\n$$\n[\\,\\Delta_{\\text{natural}}^{(A)},\\,\\Delta_{\\text{clamped}}^{(A)},\\,\\Delta_{\\text{natural}}^{(B)},\\,\\Delta_{\\text{clamped}}^{(B)},\\,\\Delta_{\\text{natural}}^{(C)},\\,\\Delta_{\\text{clamped}}^{(C)}\\,].\n$$", "solution": "用户要求推导并实现用于自然和钳制两种边界条件的三次样条插值。推导过程必须从第一性原理出发，实现部分必须计算几个测试用例的全局超调量。\n\n### 三次样条插值的推导\n\n对一组具有严格递增横坐标 $x_0  x_1  \\ldots  x_{n-1}$ 的 $n$ 个数据点 $(x_i, y_i)$（其中 $i=0, 1, \\ldots, n-1$）进行插值的三次样条函数 $S(x)$ 是一个在 $[x_0, x_{n-1}]$ 上定义的分段函数。对于每个子区间 $[x_i, x_{i+1}]$，样条段 $S_i(x)$ 是一个三次多项式。整个样条函数 $S(x)$ 必须满足以下属性：\n1.  **插值性**：对所有 $i=0, \\ldots, n-1$，$S(x_i) = y_i$。\n2.  **连续性**：$S(x)$ 在 $[x_0, x_{n-1}]$ 上二阶连续可微，即 $S \\in C^2[x_0, x_{n-1}]$。这意味着在每个内部节点 $x_i$（$i=1, \\ldots, n-2$）处，$S_{i-1}(x_i) = S_i(x_i)$，$S'_{i-1}(x_i) = S'_i(x_i)$，以及 $S''_{i-1}(x_i) = S''_i(x_i)$。\n\n让我们将样条函数在节点处的二阶导数定义为 $M_i = S''(x_i)$，其中 $i=0, \\ldots, n-1$。由于每个样条段 $S_i(x)$ 是一个三次多项式，其二阶导数 $S_i''(x)$ 是一个线性函数。在区间 $[x_i, x_{i+1}]$ 上，$S_i''(x)$ 经过点 $(x_i, M_i)$ 和 $(x_{i+1}, M_{i+1})$。设 $h_i = x_{i+1} - x_i$。线性函数 $S_i''(x)$ 可以用拉格朗日线性插值公式写出：\n$$\nS_i''(x) = M_i \\frac{x_{i+1} - x}{h_i} + M_{i+1} \\frac{x - x_i}{h_i}\n$$\n对 $S_i''(x)$ 关于 $x$ 积分两次，得到三次多项式 $S_i(x)$ 的一般形式：\n$$\nS_i(x) = M_i \\frac{(x_{i+1} - x)^3}{6h_i} + M_{i+1} \\frac{(x - x_i)^3}{6h_i} + C(x-x_i) + D(x_{i+1}-x)\n$$\n其中 $C$ 和 $D$ 是积分常数，其形式便于应用插值条件。\n我们强制施加插值条件 $S_i(x_i) = y_i$ 和 $S_i(x_{i+1}) = y_{i+1}$：\n在 $x=x_i$ 处：$y_i = M_i \\frac{h_i^3}{6h_i} + D h_i \\implies D = \\frac{y_i}{h_i} - \\frac{M_i h_i}{6}$。\n在 $x=x_{i+1}$ 处：$y_{i+1} = M_{i+1} \\frac{h_i^3}{6h_i} + C h_i \\implies C = \\frac{y_{i+1}}{h_i} - \\frac{M_{i+1} h_i}{6}$。\n\n将这些常数代回，我们得到样条段 $S_i(x)$ 的表达式，它用已知的数据点和未知的二阶导数值 $M_i$ 表示：\n$$\nS_i(x) = \\frac{M_i}{6h_i}(x_{i+1}-x)^3 + \\frac{M_{i+1}}{6h_i}(x-x_i)^3 + \\left(\\frac{y_{i+1}}{h_i} - \\frac{M_{i+1}h_i}{6}\\right)(x-x_i) + \\left(\\frac{y_i}{h_i} - \\frac{M_i h_i}{6}\\right)(x_{i+1}-x)\n$$\n这个方程定义了在每个子区间 $[x_i, x_{i+1}]$（$i=0, \\ldots, n-2$）上的样条函数。为了找到未知的 $M_i$ 值，我们在内部节点 $x_i$（$i=1, \\ldots, n-2$）处使用一阶导数的连续性条件 $S'_{i-1}(x_i) = S'_i(x_i)$。\n\n首先，我们求出导数 $S'_i(x)$：\n$$\nS'_i(x) = -\\frac{M_i}{2h_i}(x_{i+1}-x)^2 + \\frac{M_{i+1}}{2h_i}(x-x_i)^2 + \\left(\\frac{y_{i+1}}{h_i} - \\frac{M_{i+1}h_i}{6}\\right) - \\left(\\frac{y_i}{h_i} - \\frac{M_i h_i}{6}\\right)\n$$\n计算在节点处的导数值：\n$S'_i(x_i) = -\\frac{M_i h_i}{2} + \\frac{y_{i+1}-y_i}{h_i} - \\frac{M_{i+1}h_i}{6} + \\frac{M_i h_i}{6} = \\frac{y_{i+1}-y_i}{h_i} - \\frac{h_i}{3}M_i - \\frac{h_i}{6}M_{i+1}$。\n$S'_{i-1}(x_i) = \\frac{M_{i-1}h_{i-1}}{6} + \\frac{M_i h_{i-1}}{3} + \\frac{y_i-y_{i-1}}{h_{i-1}}$。\n\n令 $S'_{i-1}(x_i) = S'_i(x_i)$ 对 $i=1, \\ldots, n-2$ 成立：\n$$\n\\frac{y_i-y_{i-1}}{h_{i-1}} + \\frac{h_{i-1}}{6}M_{i-1} + \\frac{h_{i-1}}{3}M_i = \\frac{y_{i+1}-y_i}{h_i} - \\frac{h_i}{3}M_i - \\frac{h_i}{6}M_{i+1}\n$$\n重新整理各项，将未知数 $M_{i-1}$、$M_i$ 和 $M_{i+1}$ 分组：\n$$\nh_{i-1}M_{i-1} + (2h_{i-1} + 2h_i)M_i + h_iM_{i+1} = 6\\left(\\frac{y_{i+1}-y_i}{h_i} - \\frac{y_i-y_{i-1}}{h_{i-1}}\\right)\n$$\n这个基本关系式为 $n$ 个未知数 $M_0, \\ldots, M_{n-1}$ 提供了 $n-2$ 个线性方程。为了获得唯一解，我们需要两个额外的方程，这两个方程由边界条件提供。\n\n### 边界条件\n\n**1. 自然样条：**\n自然边界条件指定端点曲率为零：$S''(x_0)=0$ 和 $S''(x_{n-1})=0$。这直接转化为：\n$$\nM_0 = 0, \\quad M_{n-1} = 0\n$$\n将这些代入通用方程组，剩下 $n-2$ 个方程求解 $n-2$ 个未知数 $M_1, \\ldots, M_{n-2}$。该方程组形成一个严格对角占优的三对角矩阵，保证了唯一解的存在。\n\n**2. 钳制样条：**\n钳制边界条件指定端点处的一阶导数：$S'(x_0)=s_0$ 和 $S'(x_{n-1})=s_{n-1}$。\n使用我们对 $S'_i(x_i)$ 的表达式，设 $i=0$：\n$S'(x_0) = S'_0(x_0) = \\frac{y_1-y_0}{h_0} - \\frac{h_0}{3}M_0 - \\frac{h_0}{6}M_1 = s_0$。\n整理后得到第一个边界方程：\n$$\n2h_0M_0 + h_0M_1 = 6\\left(\\frac{y_1-y_0}{h_0} - s_0\\right)\n$$\n对于 $x_{n-1}$ 处的条件，我们计算 $S'_{n-2}(x_{n-1})=s_{n-1}$：\n$S'_{n-2}(x_{n-1}) = \\frac{y_{n-1}-y_{n-2}}{h_{n-2}} + \\frac{h_{n-2}}{6}M_{n-2} + \\frac{h_{n-2}}{3}M_{n-1} = s_{n-1}$。\n整理后得到第二个边界方程：\n$$\nh_{n-2}M_{n-2} + 2h_{n-2}M_{n-1} = 6\\left(s_{n-1} - \\frac{y_{n-1}-y_{n-2}}{h_{n-2}}\\right)\n$$\n问题为 $s_0$ 和 $s_{n-1}$ 指定了特定的值：\n$s_0 = \\frac{y_1 - y_0}{x_1 - x_0} = \\frac{y_1 - y_0}{h_0}$\n$s_{n-1} = \\frac{y_{n-1} - y_{n-2}}{x_{n-1} - x_{n-2}} = \\frac{y_{n-1} - y_{n-2}}{h_{n-2}}$\n通过这些选择，两个边界方程的右侧都变为零：\n$2h_0M_0 + h_0M_1 = 0 \\implies 2M_0 + M_1 = 0$。\n$h_{n-2}M_{n-2} + 2h_{n-2}M_{n-1} = 0 \\implies M_{n-2} + 2M_{n-1} = 0$。\n这两个方程与 $n-2$ 个内部方程结合，构成了一个求解未知数 $M_0, \\ldots, M_{n-1}$ 的完整的 $n \\times n$ 三对角系统。该系统也是严格对角占优的，并有唯一解。\n\n### 超调量计算\n\n一个子区间 $[x_i, x_{i+1}]$ 上的超调量定义为：\n$$\n\\Delta_i = \\max\\left\\{ \\max_{x \\in [x_i,x_{i+1}]} \\left(S(x) - \\max\\{y_i,y_{i+1}\\}\\right), \\ \\max_{x \\in [x_i,x_{i+1}]}\\left(\\min\\{y_i,y_{i+1}\\} - S(x)\\right), \\ 0 \\right\\}\n$$\n全局超调量是所有子区间超调量的最大值，$\\Delta = \\max_i \\Delta_i$。在计算上，通过在一个跨越 $[x_i, x_{i+1}]$ 的包含 $1001$ 个点的精细均匀网格上计算样条函数 $S(x)$ 的值，来近似每个子区间上的最大值。这个过程量化了样条函数在其插值的数据点范围之外振荡的程度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_tdma(lower, main, upper, d):\n    \"\"\"\n    Solves a tridiagonal system of equations Ax=d using the Thomas algorithm.\n\n    Args:\n        lower (np.ndarray): The lower diagonal of A (length n-1).\n        main (np.ndarray): The main diagonal of A (length n).\n        upper (np.ndarray): The upper diagonal of A (length n-1).\n        d (np.ndarray): The right-hand side vector (length n).\n\n    Returns:\n        np.ndarray: The solution vector x.\n    \"\"\"\n    n = len(main)\n    c_p = np.zeros(n)\n    d_p = np.zeros(n)\n\n    # Forward elimination\n    c_p[0] = upper[0] / main[0]\n    d_p[0] = d[0] / main[0]\n    for i in range(1, n):\n        denom = main[i] - lower[i-1] * c_p[i-1]\n        if i  n - 1:\n            c_p[i] = upper[i] / denom\n        d_p[i] = (d[i] - lower[i-1] * d_p[i-1]) / denom\n\n    # Backward substitution\n    x = np.zeros(n)\n    x[n-1] = d_p[n-1]\n    for i in range(n-2, -1, -1):\n        x[i] = d_p[i] - c_p[i] * x[i+1]\n    return x\n\nclass CubicSpline:\n    \"\"\"\n    A class for computing and evaluating cubic spline interpolants.\n    \"\"\"\n    def __init__(self, x, y, bc_type='natural'):\n        self.x = np.asarray(x, dtype=float)\n        self.y = np.asarray(y, dtype=float)\n        self.n = len(x)\n        \n        if self.n  2:\n            raise ValueError(\"Need at least 2 points for interpolation.\")\n        \n        self.h = self.x[1:] - self.x[:-1]\n        \n        if np.any(self.h = 0):\n            raise ValueError(\"x coordinates must be strictly increasing.\")\n\n        if bc_type == 'natural':\n            self._compute_natural_spline()\n        elif bc_type == 'clamped':\n            self._compute_clamped_spline()\n        else:\n            raise ValueError(f\"Unsupported boundary condition type: {bc_type}\")\n\n    def _compute_natural_spline(self):\n        \"\"\"Computes the second derivatives M for a natural spline.\"\"\"\n        if self.n == 2:\n            self.M = np.zeros(self.n)\n            return\n\n        N = self.n - 2  # Size of the internal system\n        \n        A_lower = self.h[1:-1]\n        A_main = 2 * (self.h[:-1] + self.h[1:])\n        A_upper = self.h[1:-1]\n\n        delta = (self.y[1:] - self.y[:-1]) / self.h\n        b_rhs = 6 * (delta[1:] - delta[:-1])\n\n        M_internal = solve_tdma(A_lower, A_main, A_upper, b_rhs)\n        \n        self.M = np.zeros(self.n)\n        self.M[1:-1] = M_internal\n\n    def _compute_clamped_spline(self):\n        \"\"\"Computes the second derivatives M for a clamped spline with specified derivatives.\"\"\"\n        if self.n == 2:\n            self.M = np.zeros(self.n)\n            return\n\n        N = self.n\n        A_lower = np.zeros(N - 1)\n        A_main = np.zeros(N)\n        A_upper = np.zeros(N - 1)\n        b_rhs = np.zeros(N)\n\n        # First row from boundary condition: 2*h_0*M_0 + h_0*M_1 = 0\n        A_main[0] = 2.0 * self.h[0]\n        A_upper[0] = self.h[0]\n        b_rhs[0] = 0.0\n\n        # Internal rows\n        delta = (self.y[1:] - self.y[:-1]) / self.h\n        internal_rhs = 6 * (delta[1:] - delta[:-1])\n        b_rhs[1:-1] = internal_rhs\n\n        A_main[1:-1] = 2 * (self.h[:-1] + self.h[1:])\n        A_lower[:-1] = self.h[:-1]\n        A_upper[1:] = self.h[1:]\n\n        # Last row from boundary condition: h_{n-2}*M_{n-2} + 2*h_{n-2}*M_{n-1} = 0\n        A_lower[-1] = self.h[N-2]\n        A_main[-1] = 2.0 * self.h[N-2]\n        b_rhs[-1] = 0.0\n        \n        self.M = solve_tdma(A_lower, A_main, A_upper, b_rhs)\n\n    def evaluate(self, x_eval):\n        \"\"\"Evaluates the spline at given points.\"\"\"\n        x_eval = np.asarray(x_eval)\n        indices = np.searchsorted(self.x, x_eval, side='right') - 1\n        indices = np.clip(indices, 0, self.n - 2)\n\n        xi = self.x[indices]\n        xi1 = self.x[indices + 1]\n        yi = self.y[indices]\n        yi1 = self.y[indices + 1]\n        hi = self.h[indices]\n        Mi = self.M[indices]\n        Mi1 = self.M[indices + 1]\n\n        t = x_eval - xi\n        t_comp = xi1 - x_eval\n        \n        term1 = (Mi / (6 * hi)) * (t_comp**3)\n        term2 = (Mi1 / (6 * hi)) * (t**3)\n        term3 = (yi1 / hi - Mi1 * hi / 6) * t\n        term4 = (yi / hi - Mi * hi / 6) * t_comp\n        \n        return term1 + term2 + term3 + term4\n\ndef calculate_overshoot(spline, n_grid=1001):\n    \"\"\"Calculates the global overshoot magnitude for a given spline.\"\"\"\n    max_overshoot = 0.0\n    for i in range(spline.n - 1):\n        xi, xi1 = spline.x[i], spline.x[i+1]\n        yi, yi1 = spline.y[i], spline.y[i+1]\n        \n        m_i = min(yi, yi1)\n        M_i = max(yi, yi1)\n        \n        x_grid = np.linspace(xi, xi1, n_grid)\n        y_grid = spline.evaluate(x_grid)\n        \n        overshoot = np.max(y_grid) - M_i\n        undershoot = m_i - np.min(y_grid)\n        \n        interval_max_deviation = max(overshoot, undershoot, 0.0)\n        \n        if interval_max_deviation > max_overshoot:\n            max_overshoot = interval_max_deviation\n            \n    return max_overshoot\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case A (left-end steepening)\n        {'x': [0.0, 0.5, 0.6, 2.0], 'y': [0.0, 1.0, 10.0, 12.0]},\n        # Case B (near-linear)\n        {'x': [0.0, 1.0, 2.0, 3.0], 'y': [0.0, 1.0, 2.0, 3.0]},\n        # Case C (right-end steepening)\n        {'x': [0.0, 1.4, 1.5, 2.0], 'y': [0.0, 2.0, 3.0, 3.2]}\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        x = case['x']\n        y = case['y']\n        \n        # Natural Spline\n        natural_spline = CubicSpline(x, y, bc_type='natural')\n        delta_natural = calculate_overshoot(natural_spline)\n        results.append(delta_natural)\n        \n        # Clamped Spline\n        clamped_spline = CubicSpline(x, y, bc_type='clamped')\n        delta_clamped = calculate_overshoot(clamped_spline)\n        results.append(delta_clamped)\n\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```", "id": "3220873"}]}