{"hands_on_practices": [{"introduction": "提升蒙特卡洛估计精度最直观的方法之一是使用控制变量。该技术利用了另一个随机变量，这个变量与我们感兴趣的量高度相关，但其期望值是已知的。本练习 [@problem_id:1348989] 将指导你找到最优地融合这一“控制”信息的方法，从而实现最大程度的方差缩减。", "problem": "一位分析师正在尝试估计 $\\theta = E[(U+1)^2]$ 的值，其中 $U$ 是一个在区间 $[0, 1]$ 上均匀分布的随机变量。标准方法是使用一个简单的蒙特卡洛估计量，即生成 $X = (U+1)^2$ 的样本并对其求平均。该估计量的精度由单个样本的方差 $\\text{Var}(X)$ 决定。\n\n为了提高估计的效率，有人提出了一种控制变量技术。使用一个相关的随机变量 $C = U$（其期望值已知）构造了一个新的估计量。单个样本的新估计量由 $X(b) = X - b(C - E[C])$ 给出，其中 $b$ 是一个有待优化的实值常数系数。\n\n你的任务是确定该技术所提供的理论上的改进。首先，找到使新估计量方差 $\\text{Var}(X(b))$ 最小化的最优系数 $b^*$。然后，计算方差缩减因子，即单个优化控制变量样本的方差与单个简单样本的方差之比。\n\n将此方差缩减因子 $\\frac{\\text{Var}(X(b^*))}{\\text{Var}(X)}$ 表示为一个精确分数。", "solution": "设 $U \\sim \\text{Unif}[0,1]$，$X=(U+1)^{2}$ 且 $C=U$。对于 $k \\geq 0$，$E[U^{k}]=\\frac{1}{k+1}$。因此 $E[U]=\\frac{1}{2}$，$E[U^{2}]=\\frac{1}{3}$，$E[U^{3}]=\\frac{1}{4}$，$E[U^{4}]=\\frac{1}{5}$，且 $\\text{Var}(U)=\\frac{1}{12}$。\n\n将 $X$ 展开为 $X=U^{2}+2U+1$。那么\n$$\nE[X]=E[U^{2}]+2E[U]+1=\\frac{1}{3}+1+1=\\frac{7}{3}.\n$$\n同样\n$$\nX^{2}=(U^{2}+2U+1)^{2}=U^{4}+4U^{3}+6U^{2}+4U+1,\n$$\n所以\n$$\nE[X^{2}]=\\frac{1}{5}+4\\cdot\\frac{1}{4}+6\\cdot\\frac{1}{3}+4\\cdot\\frac{1}{2}+1=\\frac{31}{5}.\n$$\n因此\n$$\n\\text{Var}(X)=E[X^{2}]-(E[X])^{2}=\\frac{31}{5}-\\left(\\frac{7}{3}\\right)^{2}=\\frac{34}{45}.\n$$\n\n计算与 $C=U$ 的协方差：\n$$\n\\text{Cov}(U^{2},U)=E[U^{3}]-E[U^{2}]E[U]=\\frac{1}{4}-\\frac{1}{3}\\cdot\\frac{1}{2}=\\frac{1}{12},\n$$\n所以\n$$\n\\text{Cov}(X,C)=\\text{Cov}(U^{2}+2U+1,U)=\\frac{1}{12}+2\\cdot\\text{Var}(U)=\\frac{1}{12}+2\\cdot\\frac{1}{12}=\\frac{1}{4},\n$$\n且 $\\text{Var}(C)=\\text{Var}(U)=\\frac{1}{12}$。\n\n对于控制变量估计量 $X(b)=X-b(C-E[C])$，其方差为\n$$\n\\text{Var}(X(b))=\\text{Var}(X)-2b\\,\\text{Cov}(X,C)+b^{2}\\text{Var}(C).\n$$\n最小化关于 $b$ 的二次式可得\n$$\nb^{*}=\\frac{\\text{Cov}(X,C)}{\\text{Var}(C)}=\\frac{\\frac{1}{4}}{\\frac{1}{12}}=3,\n$$\n最小化的方差为\n$$\n\\text{Var}(X(b^{*}))=\\text{Var}(X)-\\frac{\\text{Cov}(X,C)^{2}}{\\text{Var}(C)}=\\frac{34}{45}-\\frac{\\left(\\frac{1}{4}\\right)^{2}}{\\frac{1}{12}}=\\frac{34}{45}-\\frac{3}{4}=\\frac{1}{180}.\n$$\n\n因此，方差缩减因子为\n$$\n\\frac{\\text{Var}(X(b^{*}))}{\\text{Var}(X)}=\\frac{\\frac{1}{180}}{\\frac{34}{45}}=\\frac{1}{136}.\n$$", "answer": "$$\\boxed{\\frac{1}{136}}$$", "id": "1348989"}, {"introduction": "对偶变量法是一种巧妙的方差缩减技术，它通过在抽样过程中直接引入负相关性来降低方差。我们不再使用独立的样本，而是构造具有负相关性的成对样本。这个实践问题 [@problem_id:1349000] 将此概念应用于一个实际的物理场景，让你看到如何利用这种对称性，在模拟次数相同的情况下获得更精确的估计。", "problem": "一个工程师团队正在设计一种新颖的微型弹射系统。在该系统中，抛射物以与水平面成固定角度 $\\theta$ 的方式发射。由于能源的波动，初始发射速度 $v_0$ 是一个随机变量。已知它在最小速度 $v_{min}$ 和最大速度 $v_{max}$ 之间服从均匀分布。抛射物达到的最大高度 $H$ 由公式 $H(v_0) = \\frac{(v_0 \\sin\\theta)^2}{2g}$ 给出，其中 $g$ 是重力加速度。\n\n为了估计期望最大高度 $E[H]$，该团队采用了对偶变量法，这是一种方差缩减技术。一个特定的发射速度 $v$ 是通过使用逆变换采样公式从一个标准均匀随机变量 $u \\sim U(0,1)$ 生成的：$v = v_{min} + (v_{max} - v_{min})u$。然后，使用单次抽取的 $u_1$ 及其对偶对应项 $u'_1 = 1 - u_1$ 生成一对对偶速度 $(v_1, v'_1)$。\n\n给定系统的以下参数：\n- 发射角度：$\\theta = 30^{\\circ}$\n- 最小速度：$v_{min} = 20.0$ m/s\n- 最大速度：$v_{max} = 50.0$ m/s\n- 重力加速度：$g = 9.81 \\, \\text{m/s}^2$\n\n根据从标准均匀分布 $U(0,1)$ 中单次随机抽取的 $u_1 = 0.300$，计算期望最大高度的对偶变量估计值。答案以米为单位，并四舍五入到三位有效数字。", "solution": "我们寻求使用一对对偶变量对期望最大高度的对偶变量估计。最大高度作为发射速度的函数由以下公式给出：\n$$\nH(v_{0})=\\frac{(v_{0}\\sin\\theta)^{2}}{2g}。\n$$\n在 $[v_{\\min},v_{\\max}]$ 上的均匀速度的逆变换采样为\n$$\nv(u)=v_{\\min}+(v_{\\max}-v_{\\min})u,\n$$\n而对偶对使用 $u_{1}$ 和 $u_{1}'=1-u_{1}$，得到速度\n$$\nv_{1}=v(u_{1}),\\qquad v_{1}'=v(u_{1}').\n$$\n基于一对的对偶变量估计量是其平均值\n$$\n\\widehat{E}_{\\text{AV}}=\\frac{H(v_{1})+H(v_{1}')}{2}。\n$$\n\n当 $\\theta=30^{\\circ}$ 时，我们使用 $\\sin(30^{\\circ})=\\frac{1}{2}$，因此\n$$\nH(v)=\\frac{v^{2}\\sin^{2}(30^{\\circ})}{2g}=\\frac{v^{2}}{8g}。\n$$\n给定 $v_{\\min}=20.0$，$v_{\\max}=50.0$ 和 $u_{1}=0.300$，\n$$\nv_{1}=20.0+(50.0-20.0)\\cdot 0.300=20.0+30.0\\cdot 0.300=29.0,\n$$\n$$\nu_{1}'=1-0.300=0.700,\\qquad v_{1}'=20.0+30.0\\cdot 0.700=41.0。\n$$\n因此\n$$\nH(v_{1})=\\frac{29.0^{2}}{8g}=\\frac{841}{8g},\\qquad H(v_{1}')=\\frac{41.0^{2}}{8g}=\\frac{1681}{8g}。\n$$\n对偶估计值为\n$$\n\\widehat{E}_{\\text{AV}}=\\frac{1}{2}\\left(\\frac{841}{8g}+\\frac{1681}{8g}\\right)=\\frac{841+1681}{16g}=\\frac{2522}{16g}。\n$$\n当 $g=9.81$ 时，这得出\n$$\n\\widehat{E}_{\\text{AV}}=\\frac{2522}{16\\times 9.81}=\\frac{2522}{156.96}\\approx 16.0678。\n$$\n四舍五入到三位有效数字，估计值为 $16.1$ 米。", "answer": "$$\\boxed{16.1}$$", "id": "1349000"}, {"introduction": "重要性抽样可以说是最强大和通用的方差缩减技术之一，尤其适用于罕见事件的模拟。其核心思想是改变抽样分布本身，将计算资源集中在状态空间中的“重要”区域。这个高级练习 [@problem_id:2446710] 不仅展示了重要性抽样的基本机理，还要求你推导出理论上最优的抽样分布以最小化方差，让你一窥这一强大方法的理想极限。", "problem": "考虑在计算经济学和金融学相关的蒙特卡洛情景中，计算一个正态分布随机变量的指数的期望的任务。令 $X \\sim \\mathcal{N}(0, 100)$，并定义 $h(x) = \\exp(x)$。你将通过重要性采样来估计 $\\mathbb{E}[\\exp(X)]$，使用的提议分布 $Q$ 由 $Y \\sim \\mathcal{N}(\\mu, 100)$ 给出，其中位移参数 $\\mu \\in \\mathbb{R}$ 未知。令 $p(x)$ 和 $q_{\\mu}(x)$ 分别表示 $\\mathcal{N}(0, 100)$ 和 $\\mathcal{N}(\\mu, 100)$ 的概率密度函数。基于从 $q_{\\mu}$ 中抽取的 $n$ 个独立同分布样本 $\\{Y_i\\}_{i=1}^{n}$ 的重要性采样估计量为\n$$\nI_n(\\mu) \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} h(Y_i)\\, w_{\\mu}(Y_i), \\quad \\text{其中 } w_{\\mu}(y) \\;=\\; \\frac{p(y)}{q_{\\mu}(y)}.\n$$\n从基本原理出发，不借助任何特定的方差缩减公式，完成以下任务：\n1. 推导 $\\mathbb{E}[\\exp(X)]$ 的闭式表达式。\n2. 将 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\,w_{\\mu}(Y))$ 推导为 $\\mu$ 的函数，并找出使该方差在 $\\mu \\in \\mathbb{R}$ 上最小化的值 $\\mu^{\\star}$。\n\n请以一个有序对的形式提供你的最终答案，该有序对包含 $\\mathbb{E}[\\exp(X)]$ 的精确值和最优位移 $\\mu^{\\star}$。不需要进行数值四舍五入，你的答案应为精确值且不带单位。", "solution": "我们首先回顾相关定义。目标分布为 $X \\sim \\mathcal{N}(0, 100)$，其密度函数为\n$$\np(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100,\n$$\n提议分布为 $Y \\sim \\mathcal{N}(\\mu, 100)$，其密度函数为\n$$\nq_{\\mu}(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100.\n$$\n重要性权重为 $w_{\\mu}(x) = p(x)/q_{\\mu}(x)$。\n\n步骤 1：计算 $\\mathbb{E}[\\exp(X)]$ 的闭式表达式。根据定义，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(x)\\, p(x)\\, dx \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(x - \\frac{x^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n对指数部分进行配方。写出\n$$\nx - \\frac{x^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left(x^{2} - 2\\sigma^{2} x \\right) \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left[(x - \\sigma^{2})^{2} - \\sigma^{4}\\right] \\;=\\; -\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}} + \\frac{\\sigma^{2}}{2}.\n$$\n因此，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right),\n$$\n因为该积分等于 $\\sqrt{2\\pi}\\, \\sigma$。当 $\\sigma^{2} = 100$ 时，可得\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\exp(50).\n$$\n\n步骤 2：推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y))$ 并将其关于 $\\mu$ 最小化。注意到\n$$\n\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y)) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;-\\; \\left(\\mathbb{E}[\\exp(X)]\\right)^{2}.\n$$\n第二项不依赖于 $\\mu$，因此最小化方差等价于最小化二阶矩\n$$\nM(\\mu) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(2x)\\, \\frac{p(x)^{2}}{q_{\\mu}(x)}\\, dx.\n$$\n使用 $p$ 和 $q_{\\mu}$ 的显式形式以及共同的方差 $\\sigma^{2}$，\n$$\n\\frac{p(x)^{2}}{q_{\\mu}(x)} \\;=\\; \\frac{\\left(\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)\\right)^{2}}{\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)} \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right).\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n合并指数项：\n$$\n2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x + \\frac{\\mu^{2}}{2\\sigma^{2}}.\n$$\n通过定义\n$$\nm \\;=\\; 2\\sigma^{2} - \\mu,\n$$\n进行配方，使得\n$$\n-\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x \\;=\\; -\\frac{(x - m)^{2}}{2\\sigma^{2}} + \\frac{m^{2}}{2\\sigma^{2}}.\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left(\\frac{m^{2}}{2\\sigma^{2}} + \\frac{\\mu^{2}}{2\\sigma^{2}}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - m)^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{m^{2} + \\mu^{2}}{2\\sigma^{2}}\\right).\n$$\n代入 $m = 2\\sigma^{2} - \\mu$，\n$$\nm^{2} + \\mu^{2} \\;=\\; (2\\sigma^{2} - \\mu)^{2} + \\mu^{2} \\;=\\; 4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2},\n$$\n因此\n$$\nM(\\mu) \\;=\\; \\exp\\!\\left(\\frac{4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2}}{2\\sigma^{2}}\\right) \\;=\\; \\exp\\!\\left(2\\sigma^{2} - 2\\mu + \\frac{\\mu^{2}}{\\sigma^{2}}\\right).\n$$\n作为 $\\mu$ 的函数，最小化 $M(\\mu)$ 等价于最小化其指数部分\n$$\ng(\\mu) \\;=\\; \\frac{\\mu^{2}}{\\sigma^{2}} - 2\\mu + 2\\sigma^{2}.\n$$\n这是一个关于 $\\mu$ 的凸二次函数，其导数为\n$$\ng'(\\mu) \\;=\\; \\frac{2\\mu}{\\sigma^{2}} - 2,\n$$\n该导数在以下点为零\n$$\n\\mu^{\\star} \\;=\\; \\sigma^{2}.\n$$\n由于 $g''(\\mu) = 2/\\sigma^{2}  0$，该临界点是唯一的最小值点。当 $\\sigma^{2} = 100$ 时，最优位移为\n$$\n\\mu^{\\star} \\;=\\; 100.\n$$\n在 $\\mu^{\\star} = \\sigma^{2}$ 时，提议密度 $q_{\\mu^{\\star}}$ 与 $h(x)\\, p(x)$ 成正比，这会得到一个零方差重要性采样估计量，与以下结果一致：\n$$\n\\operatorname{Var}_{q_{\\mu^{\\star}}}(h(Y)\\,w_{\\mu^{\\star}}(Y)) \\;=\\; M(\\mu^{\\star}) - \\left(\\mathbb{E}[\\exp(X)]\\right)^{2} \\;=\\; \\exp(\\sigma^{2}) - \\exp(\\sigma^{2}) \\;=\\; 0.\n$$\n汇总结果，精确期望值为 $\\exp(50)$，最优位移为 $\\mu^{\\star} = 100$。", "answer": "$$\\boxed{\\begin{pmatrix}\\exp(50)  100\\end{pmatrix}}$$", "id": "2446710"}]}