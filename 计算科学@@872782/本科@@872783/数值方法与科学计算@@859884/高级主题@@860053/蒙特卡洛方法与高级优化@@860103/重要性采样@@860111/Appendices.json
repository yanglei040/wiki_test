{"hands_on_practices": [{"introduction": "重要性采样估计量的效率由其方差来衡量，较低的方差意味着更快的收敛速度和更可靠的估计结果。本练习将通过一个具体的例子，指导您如何计算估计量的方差，并理解它如何依赖于所选提议分布的参数。通过在熟悉的高斯分布设定下估算一个矩，您将掌握分析重要性采样估计量性能的基本技能。[@problem_id:767801]", "problem": "重要性采样（Importance Sampling）是一种用于蒙特卡洛（Monte Carlo）方法中的方差缩减技术，它通过从一个不同的分布中采样来估计特定分布的性质。考虑估计期望 $I = E_p[h(x)]$ 的问题，其中 $p(x)$ 是目标概率密度函数（PDF），$h(x)$ 是我们感兴趣的函数。我们不从 $p(x)$ 中抽取样本，而是从一个提议分布（proposal distribution）$q(x)$ 中抽取 $N$ 个样本 $\\{x_i\\}_{i=1}^N$。然后使用重要性采样估计量来估计该期望：\n$$\n\\hat{I}_N = \\frac{1}{N} \\sum_{i=1}^N w(x_i) h(x_i)\n$$\n其中 $w(x) = \\frac{p(x)}{q(x)}$ 是重要性权重。该估计量是无偏的，即 $E_q[\\hat{I}_N] = I$。单个样本（$N=1$）的估计量的方差由 $\\text{Var}_q(w(X)h(X))$ 给出，其中 $X \\sim q(x)$。\n\n**问题：**\n设目标分布 $p(x)$ 是标准正态分布 $\\mathcal{N}(x|0, 1)$，其概率密度函数为 $p(x) = \\frac{1}{\\sqrt{2\\pi}} e^{-x^2/2}$。我们希望估计该分布的四阶矩，对应于函数 $h(x) = x^4$。\n\n提议分布 $q(x)$ 被选为一个均值为零、方差为 $\\sigma_q^2$ 的正态分布，即 $q(x) = \\mathcal{N}(x|0, \\sigma_q^2)$，其概率密度函数为 $q(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma_q} e^{-x^2/(2\\sigma_q^2)}$。\n\n请推导单样本重要性采样估计量的方差 $\\text{Var}_q(w(X)h(X))$ 作为 $\\sigma_q$ 的函数的封闭形式表达式。你可以假设方差是有限的，这个条件在 $\\sigma_q^2 > 1/2$ 时成立。", "solution": "1. 方差为  \n$$\n\\mathrm{Var}_q\\bigl(w(X)h(X)\\bigr)\n=E_q\\bigl[(w(X)h(X))^2\\bigr]-\\bigl(E_q[w(X)h(X)]\\bigr)^2.\n$$\n由于 $h(x)=x^4$，$w(x)=\\frac{p(x)}{q(x)}$，且 $I=E_p[x^4]=3$，我们需要计算 \n$$\nE_q\\bigl[(w(X)x^4)^2\\bigr]\n=\\int q(x)\\Bigl(\\frac{p(x)}{q(x)}\\Bigr)^2 x^8\\,dx\n=\\int \\frac{p(x)^2}{q(x)}\\,x^8\\,dx.\n$$\n\n2. 代入高斯密度函数：\n$$\np(x)=\\frac{1}{\\sqrt{2\\pi}}e^{-x^2/2},\\quad\nq(x)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_q}e^{-x^2/(2\\sigma_q^2)}.\n$$\n则\n$$\n\\frac{p(x)^2}{q(x)}\n=\\frac{\\frac1{2\\pi}e^{-x^2}}{\\frac1{\\sqrt{2\\pi}\\,\\sigma_q}e^{-x^2/(2\\sigma_q^2)}}\n=\\frac{\\sigma_q}{\\sqrt{2\\pi}}\\,e^{-x^2\\bigl(1-\\tfrac1{2\\sigma_q^2}\\bigr)}.\n$$\n\n3. 令 \n$$\na=1-\\frac1{2\\sigma_q^2}=\\frac{2\\sigma_q^2-1}{2\\sigma_q^2},\\quad\n\\int_{-\\infty}^{\\infty}x^8e^{-a x^2}dx\n=\\frac{7!!}{2^4}\\,a^{-4-\\frac12}\\sqrt\\pi\n=\\frac{105\\sqrt\\pi}{16\\,a^{9/2}}.\n$$\n因此\n$$\nE_q\\bigl[(w(X)x^4)^2\\bigr]\n=\\frac{\\sigma_q}{\\sqrt{2\\pi}}\\cdot\\frac{105\\sqrt\\pi}{16\\,a^{9/2}}\n=\\frac{105\\,\\sigma_q}{16\\sqrt2\\,a^{9/2}}\n=\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}.\n$$\n\n4. 因此\n$$\n\\mathrm{Var}_q(w(X)x^4)\n=\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}-3^2\n=\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}-9.\n$$", "answer": "$$\\boxed{\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}-9}$$", "id": "767801"}, {"introduction": "在学会如何分析方差之后，理解估计量在何种情况下会失效至关重要。本练习探讨了一个经典的反例，其中一个看似合理的均匀提议分布，却导致了无限方差，使得估计完全失效。通过分析这个问题，您将深刻理解为何提议分布必须充分覆盖被积函数取值较大的区域，即“提议分布应具有比目标更重的尾部”这一核心原则。[@problem_id:3241984]", "problem": "考虑使用重要性采样（IS）估计积分 $$I=\\int_{-1}^{1}\\frac{1}{\\sqrt{1-x^{2}}}\\,dx$$ 的任务，其中建议密度是区间 $$[-1,1]$$ 上的均匀分布，即当 $$x\\in[-1,1]$$ 时 $$q(x)=\\frac{1}{2}$$，否则 $$q(x)=0$$。与一个样本 $$X\\sim q$$ 相关的重要性采样权重定义为 $$W=\\frac{f(X)}{q(X)}$$，其中 $$f(x)=\\frac{1}{\\sqrt{1-x^{2}}}$$。 \n\n从重要性采样的基本定义和可积奇点的性质出发，进行以下分析以评估该估计量的可靠性：\n- 显式地导出作为 $$X$$ 函数的 IS 权重 $$W$$，并分析其在端点 $$x=\\pm 1$$ 附近的行为。\n- 使用建议分布下二阶矩的定义，确定 $$\\int_{-1}^{1}\\frac{f(x)^{2}}{q(x)}\\,dx$$ 是有限的还是无限的，并通过不依赖于启发式捷径的原则性论证来证明您的结论。\n- 为了量化在 $$X\\sim q$$ 下 $$W$$ 的尾部厚度，确定当 $$t\\to\\infty$$ 时尾部概率 $$\\mathbb{P}(W>t)$$ 的精确主阶渐近衰减。特别地，推导当 $$t\\to\\infty$$ 时渐近式 $$\\mathbb{P}(W>t)\\sim c\\,t^{-2}$$ 中的精确常数 $$c$$。\n\n请从第一性原理出发提供完整的推导过程。您最终报告的答案必须是单一常数 $$c$$（无中间量），并以精确形式写出。不需要四舍五入，也不涉及单位。", "solution": "本题要求对用于积分 $I=\\int_{-1}^{1}\\frac{1}{\\sqrt{1-x^{2}}}\\,dx$ 的重要性采样方案进行三部分分析。目标被积函数是 $f(x)=\\frac{1}{\\sqrt{1-x^{2}}}$，提议概率密度函数（PDF）是区间 $[-1,1]$ 上的均匀分布，即当 $x\\in[-1,1]$ 时 $q(x)=\\frac{1}{2}$，否则 $q(x)=0$。\n\n首先，我们推导 IS 权重 $W(x)$ 并分析其行为。权重函数定义为目标被积函数与提议密度的比值：\n$$W(x) = \\frac{f(x)}{q(x)} = \\frac{\\frac{1}{\\sqrt{1-x^{2}}}}{\\frac{1}{2}} = \\frac{2}{\\sqrt{1-x^{2}}}$$\n该表达式对 $x \\in (-1, 1)$ 有效。当 $x$ 趋近于区间端点 $x=\\pm 1$ 时，$1-x^2$ 项从正方向趋近于 $0$。因此，$\\sqrt{1-x^2} \\to 0^{+}$，权重 $W(x)$ 发散至无穷大：\n$$\\lim_{x\\to \\pm 1} W(x) = \\lim_{x\\to \\pm 1} \\frac{2}{\\sqrt{1-x^{2}}} = \\infty$$\n这表明在积分域边界附近抽取的样本将具有极大的权重，是估计量可能具有高方差或无限方差的迹象。\n\n其次，我们确定在提议分布下权重的二阶矩是否有限。IS 估计量的方差是有限的，当且仅当权重的二阶矩 $\\mathbb{E}_q[W^2]$ 是有限的。该矩由以下积分给出：\n$$\\mathbb{E}_q[W^2] = \\int_{-1}^{1} W(x)^2 q(x) \\, dx = \\int_{-1}^{1} \\left(\\frac{f(x)}{q(x)}\\right)^2 q(x) \\, dx = \\int_{-1}^{1} \\frac{f(x)^2}{q(x)} \\, dx$$\n代入 $f(x)$ 和 $q(x)$ 的表达式：\n$$\\frac{f(x)^2}{q(x)} = \\frac{\\left(\\frac{1}{\\sqrt{1-x^{2}}}\\right)^2}{\\frac{1}{2}} = \\frac{\\frac{1}{1-x^2}}{\\frac{1}{2}} = \\frac{2}{1-x^2}$$\n因此，我们必须计算该积分：\n$$\\mathbb{E}_q[W^2] = \\int_{-1}^{1} \\frac{2}{1-x^2} \\, dx$$\n这是一个瑕积分，因为在 $x=-1$ 和 $x=1$ 处存在不可积的奇点。我们可以计算其不定积分：\n$$\\int \\frac{2}{1-x^2} \\, dx = 2 \\cdot \\frac{1}{2} \\ln\\left|\\frac{1+x}{1-x}\\right| + C = \\ln\\left|\\frac{1+x}{1-x}\\right| + C$$\n计算从 $-1$ 到 $1$ 的定积分：\n$$\\int_{-1}^{1} \\frac{2}{1-x^2} \\, dx = \\lim_{a \\to 1^{-}} \\lim_{b \\to -1^{+}} \\left[ \\ln\\left(\\frac{1+x}{1-x}\\right) \\right]_b^a$$\n当 $a \\to 1^{-}$ 时，$\\ln\\left(\\frac{1+a}{1-a}\\right) \\to \\ln\\left(\\frac{2}{0^{+}}\\right) \\to \\infty$，且当 $b \\to -1^{+}$ 时，$\\ln\\left(\\frac{1+b}{1-b}\\right) \\to \\ln\\left(\\frac{0^{+}}{2}\\right) \\to -\\infty$。该积分发散。因此，二阶矩 $\\mathbb{E}_q[W^2]$ 是无限的，这意味着 IS 估计量的方差是无限的。\n\n第三，我们求解尾部概率渐近衰减 $\\mathbb{P}(W>t) \\sim c\\,t^{-2}$ 中的常数 $c$。该概率是针对从提议分布 $q$ 中抽取的随机变量 $X \\sim \\text{Uniform}[-1, 1]$ 而言的。我们需要计算事件 $W(X) > t$ 的概率：\n$$\\mathbb{P}(W > t) = \\mathbb{P}\\left(\\frac{2}{\\sqrt{1-X^2}} > t\\right)$$\n对于 $t>2$，我们可以重排不等式：\n$$\\frac{4}{t^2} > 1-X^2 \\quad \\Rightarrow \\quad X^2 > 1 - \\frac{4}{t^2}$$\n该不等式等价于 $|X| > \\sqrt{1 - \\frac{4}{t^2}}$。令 $a_t = \\sqrt{1 - \\frac{4}{t^2}}$。事件为 $|X| > a_t$，即 $X \\in (-1, -a_t) \\cup (a_t, 1)$。通过在该集合上对 PDF $q(x)=\\frac{1}{2}$ 进行积分来计算概率：\n$$\\mathbb{P}(W > t) = \\int_{-1}^{-a_t} \\frac{1}{2} \\, dx + \\int_{a_t}^{1} \\frac{1}{2} \\, dx = 1 - a_t$$\n代入 $a_t$ 的表达式：\n$$\\mathbb{P}(W > t) = 1 - \\sqrt{1 - \\frac{4}{t^2}}$$\n为了找到当 $t \\to \\infty$ 时的主阶渐近行为，我们使用 $\\sqrt{1-u}$ 在 $u \\to 0$ 时的泰勒展开：$\\sqrt{1-u} = 1 - \\frac{1}{2}u + O(u^2)$。令 $u = \\frac{4}{t^2}$：\n$$\\mathbb{P}(W > t) = 1 - \\left(1 - \\frac{1}{2}\\left(\\frac{4}{t^2}\\right) + O\\left(\\frac{1}{t^4}\\right)\\right) = \\frac{2}{t^2} + O\\left(\\frac{1}{t^4}\\right)$$\n因此，渐近关系 $\\mathbb{P}(W>t) \\sim c\\,t^{-2}$ 中的常数 $c=2$。", "answer": "$$\\boxed{2}$$", "id": "3241984"}, {"introduction": "在分析了给定的提议分布之后，一个自然的问题是我们能否系统地设计出最优的提议分布。本练习将引导您从分析转向设计，介绍一种强大的技术——指数扭转 (exponential tilting)，来解决罕见事件概率的估计问题。通过运用大偏差理论的原理，您将学会如何主动构建一个高效的重要性采样方案，这代表了从评估到优化的关键一步。[@problem_id:3241853]", "problem": "设 $X_{1}, X_{2}, \\dots, X_{n}$ 为独立同分布的随机变量，且 $X_{i} \\sim \\text{Exp}(1)$，并定义部分和为 $S_{n} = \\sum_{i=1}^{n} X_{i}$。考虑稀有事件概率 $\\mathbb{P}(S_{n} > c)$，其中阈值 $c > n$ 为一固定值。为高效地估计此概率，使用重要性抽样和指数倾斜的测度变换：对于参数 $\\theta$（其中 $\\theta  1$），在新的密度函数 $f_{\\theta}(x)$ 下对每个 $X_{i}$ 进行抽样，该密度函数与原始 $\\text{Exp}(1)$ 密度函数乘以 $\\exp(\\theta x)$ 成正比，并通过适当的似然比对样本进行加权，以构建 $\\mathbb{P}(S_{n}  c)$ 的无偏估计量。\n\n从以下基础出发：\n- 对于 $X \\sim \\text{Exp}(1)$，其矩生成函数 $M_{X}(\\theta) = \\mathbb{E}[\\exp(\\theta X)]$ 和累积量生成函数 $\\Lambda(\\theta) = \\ln M_{X}(\\theta)$，\n- 样本均值 $\\bar{X}_{n} = S_{n}/n$ 的 Cramér 大偏差原理及其良速率函数 $I(x) = \\sup_{\\theta  1} \\{\\theta x - \\Lambda(\\theta)\\}$，\n- 独立同分布和的 Esscher（指数）测度变换，\n\n根据大偏差理论，从第一性原理出发，不使用任何预先给定的捷径，推导当 $n \\to \\infty$ 时能够渐近最小化 $\\mathbb{P}(S_{n}  c)$ 的重要性抽样估计量方差的指数倾斜参数 $\\theta^{\\star}$。请将最终答案表示为关于 $n$ 和 $c$ 的封闭形式解析表达式。无需进行数值近似或四舍五入。", "solution": "我们的目标是确定一个指数倾斜参数，该参数为估计稀有事件概率 $\\mathbb{P}(S_{n}  c)$（其中 $c  n$）提供一个渐近最优的重要性抽样（IS）方案。推导过程从矩生成函数（MGF）、累积量生成函数（CGF）和 Cramér 大偏差原理的定义出发。\n\n首先，回顾对于 $X \\sim \\text{Exp}(1)$，其概率密度函数为 $f(x) = \\exp(-x)$（$x \\ge 0$）。矩生成函数 $M_{X}(\\theta)$ 和累积量生成函数 $\\Lambda(\\theta)$ 为\n$$\nM_{X}(\\theta) = \\mathbb{E}[\\exp(\\theta X)] = \\int_{0}^{\\infty} \\exp(\\theta x) \\exp(-x)\\, dx = \\frac{1}{1 - \\theta}, \\quad \\theta  1,\n$$\n$$\n\\Lambda(\\theta) = \\ln M_{X}(\\theta) = -\\ln(1 - \\theta), \\quad \\theta  1.\n$$\n\n在参数为 $\\theta$ 的指数倾斜下，$X$ 的新密度是 Esscher 变换\n$$\nf_{\\theta}(x) = \\exp\\big(\\theta x - \\Lambda(\\theta)\\big) f(x) = \\exp\\big(\\theta x + \\ln(1-\\theta)\\big) \\exp(-x) = (1-\\theta)\\,\\exp\\big(-(1-\\theta) x\\big),\n$$\n这是速率为 $1 - \\theta$ 的指数分布的密度函数（因此倾斜后的 $X$ 的均值为 $1/(1-\\theta)$）。在此测度变换下，从 $f_{\\theta}$ 中独立抽取 $X_{1},\\dots,X_{n}$，得到的 $S_{n}$ 的分布是 $n$ 个速率为 $1-\\theta$ 的独立指数分布之和，即形状参数为 $n$、速率参数为 $1-\\theta$ 的伽马分布。\n\n使用此倾斜的 $\\mathbb{P}(S_{n}  c)$ 的重要性抽样估计量为 $\\hat{p} = \\mathbf{1}\\{S_{n} > c\\}\\exp(-\\theta S_n + n\\Lambda(\\theta))$，其中指数项是用于校正测度变换的重要性权重。\n\n为了在 $n \\to \\infty$ 时渐近最小化 $\\hat{p}$ 的方差（等价于其二阶矩），我们使用大偏差理论。令 $\\bar{X}_{n} = S_{n}/n$。根据 Cramér 定理，对于具有共同累积量生成函数 $\\Lambda(\\theta)$ 的独立同分布随机变量，样本均值满足大偏差原理（LDP），其良凸速率函数由 Legendre 变换给出\n$$\nI(x) = \\sup_{\\theta  1}\\{\\theta x - \\Lambda(\\theta)\\}.\n$$\n对于此处考虑的指数分布，该速率函数可以明确计算，但我们只需要其变分特征。\n\n通过指数倾斜进行方差缩减的指导原则是，最优倾斜使新测度下的典型值与稀有事件的阈值对齐。形式上，渐近最小化 $\\hat{p}$ 二阶矩的 Esscher 倾斜对应于选择一个倾斜参数，该参数在点 $x = c/n$ 处最大化速率函数中的变分表达式。这是在 $x = c/n$ 处 Legendre 变换的最优解，其特征由一阶条件给出\n$$\n\\Lambda'(\\theta^{\\star}) = x,\n$$\n在 $x = c/n$ 处求值。这个条件的产生是因为当 $\\Lambda$ 是严格凸函数时，对于固定的 $x$，函数 $\\theta \\mapsto \\theta x - \\Lambda(\\theta)$ 在 $\\theta$ 上是严格凹的，并且最大化点满足导数条件 $x - \\Lambda'(\\theta) = 0$。\n\n我们计算 $\\Lambda'(\\theta)$：\n$$\n\\Lambda(\\theta) = -\\ln(1-\\theta) \\quad \\Rightarrow \\quad \\Lambda'(\\theta) = \\frac{1}{1 - \\theta}.\n$$\n令 $\\Lambda'(\\theta^{\\star}) = c/n$ 可得\n$$\n\\frac{1}{1 - \\theta^{\\star}} = \\frac{c}{n}\n\\quad \\Rightarrow \\quad \n1 - \\theta^{\\star} = \\frac{n}{c}\n\\quad \\Rightarrow \\quad \n\\theta^{\\star} = 1 - \\frac{n}{c}.\n$$\n因为 $c  n$，我们有 $\\theta^{\\star} \\in (0, 1)$，这对于 Esscher 倾斜是允许的。解释这个选择，在最优倾斜下，每个倾斜后的 $X_{i}$ 的均值为\n$$\n\\mathbb{E}_{\\theta^{\\star}}[X_{i}] = \\frac{1}{1 - \\theta^{\\star}} = \\frac{c}{n},\n$$\n因此，在倾斜测度下，样本均值 $\\bar{X}_{n}$ 的典型值等于稀有事件阈值 $c/n$。根据大偏差原理和 Legendre 变换的凸对偶结构，这种对齐确保了在所有指数倾斜中，该重要性抽样方案渐近地最小化了估计量的方差。\n\n因此，从大偏差考虑推导出的最优指数倾斜参数是\n$$\n\\theta^{\\star} = 1 - \\frac{n}{c}.\n$$", "answer": "$$\\boxed{1 - \\frac{n}{c}}$$", "id": "3241853"}]}