{"hands_on_practices": [{"introduction": "辛积分法的一个核心特性是，尽管它们不严格保持能量，但它们能精确保持一个相关的几何量——相空间体积（或二维系统中的面积）。这项练习将这个抽象概念具体化。你将通过分析计算，比较由辛欧拉方法生成的离散轨迹所包围的多边形面积与谐振子在相空间中的精确椭圆轨迹面积，从而揭示该方法底层的几何保真度。[@problem_id:3235414]", "problem": "考虑一维谐振子，其哈密顿量为 $H(q,p)=\\frac{p^{2}}{2m}+\\frac{1}{2}m\\omega^{2}q^{2}$，其中 $m>0$ 为质量，$\\omega>0$ 为角频率。一个固定的能量 $E>0$ 在 $(q,p)$ 平面中定义了一个相空间椭圆 $H(q,p)=E$。在离散时间中，使用辛欧拉（SE）方法演化该系统，其更新规则为\n$$\np_{n+1}=p_{n}-h\\,m\\omega^{2}q_{n},\\qquad q_{n+1}=q_{n}+\\frac{h}{m}\\,p_{n+1},\n$$\n其中 $h>0$ 是时间步长。假设所选的 $h$ 使得得到的线性映射的旋转角 $\\theta$ 满足 $M\\theta=2\\pi$，其中 $M\\geq 3$ 为某个整数，从而使得 SE 轨迹是严格周期的，每个循环有 $M$ 个不同的点。令 $A_{\\text{exact}}$ 表示连续能量椭圆 $H(q,p)=E$ 的精确面积。令 $A_{\\text{SE}}$ 表示按顺序连接一个 SE 循环的 $M$ 个连续点所形成的多边形的面积。\n\n假设初始条件的选择使得 SE 映射的不变椭圆（与其守恒的二次型相关联）所包围的面积与连续能量椭圆的面积相同，即其面积等于 $A_{\\text{exact}}$。在这些假设下，确定比值\n$$\nR=\\frac{A_{\\text{SE}}}{A_{\\text{exact}}}\n$$\n的闭式解析表达式。\n将您的最终答案表示为单一的简化解析表达式（无数值近似）。不需要单位，也无需四舍五入。", "solution": "该问题陈述科学严谨、适定、客观且内部一致。这是几何数值积分领域的一个标准问题。因此，该问题是有效的，并将提供解答。\n\n目标是计算比值 $R = \\frac{A_{\\text{SE}}}{A_{\\text{exact}}}$。推导将分五个步骤进行：\n1.  计算由连续哈密顿量定义的相空间椭圆的精确面积 $A_{\\text{exact}}$。\n2.  重新缩放坐标以简化哈密顿量和辛欧拉（SE）映射。面积之比在这种缩放变换下是不变的。\n3.  在重新缩放的坐标下分析 SE 映射的性质，包括其守恒的二次型以及相应椭圆的面积。\n4.  计算由离散 SE 轨迹形成的多边形的面积 $A_{\\text{SE}}$。\n5.  结合结果求出所需比值 R。\n\n**第一步：连续能量椭圆的面积 ($A_{\\text{exact}}$)**\n一维谐振子的哈密顿量由下式给出\n$$H(q,p) = \\frac{p^2}{2m} + \\frac{1}{2}m\\omega^2q^2$$\n对于固定的能量 $E > 0$，相空间中的轨迹是一个由 $H(q,p) = E$ 定义的椭圆。我们可以将此方程写成椭圆的标准形式 $\\frac{x^2}{a^2} + \\frac{y^2}{b^2} = 1$：\n$$ \\frac{q^2}{2E/(m\\omega^2)} + \\frac{p^2}{2mE} = 1 $$\n在 $(q,p)$ 平面中，椭圆的半轴是 $a_q = \\sqrt{\\frac{2E}{m\\omega^2}}$ 和 $a_p = \\sqrt{2mE}$。该椭圆的面积 $A_{\\text{exact}}$ 由 $\\pi$ 乘以其半轴之积给出：\n$$ A_{\\text{exact}} = \\pi a_q a_p = \\pi \\sqrt{\\frac{2E}{m\\omega^2}} \\sqrt{2mE} = \\pi \\sqrt{\\frac{4mE^2}{m\\omega^2}} = \\frac{2\\pi E}{\\omega} $$\n\n**第二步：坐标的重新缩放**\n为简化问题，我们引入无量纲的正则坐标 $(\\tilde{q}, \\tilde{p})$：\n$$ \\tilde{q} = \\omega\\sqrt{m} q \\qquad \\text{和} \\qquad \\tilde{p} = \\frac{p}{\\sqrt{m}} $$\n面积元变换为 $d\\tilde{q}d\\tilde{p} = \\left| \\det \\left(\\frac{\\partial(\\tilde{q},\\tilde{p})}{\\partial(q,p)}\\right) \\right| dq dp = \\omega dq dp$。在 $(q,p)$ 平面中的面积 $A$ 对应于 $(\\tilde{q},\\tilde{p})$ 平面中的面积 $\\tilde{A} = \\omega A$。比值 $R = \\frac{A_{\\text{SE}}}{A_{\\text{exact}}} = \\frac{\\tilde{A}_{\\text{SE}}/\\omega}{\\tilde{A}_{\\text{exact}}/\\omega} = \\frac{\\tilde{A}_{\\text{SE}}}{\\tilde{A}_{\\text{exact}}}$ 在此变换下是不变的。\n\n在这些新坐标下，哈密顿量变为：\n$$ H = \\frac{(\\sqrt{m}\\tilde{p})^2}{2m} + \\frac{1}{2}m\\omega^2\\left(\\frac{\\tilde{q}}{\\omega\\sqrt{m}}\\right)^2 = \\frac{1}{2}\\tilde{p}^2 + \\frac{1}{2}\\tilde{q}^2 $$\nSE 更新规则 $p_{n+1}=p_n-h\\,m\\omega^2q_n$ 和 $q_{n+1}=q_n+\\frac{h}{m}\\,p_{n+1}$ 变换为：\n$$ \\sqrt{m}\\tilde{p}_{n+1} = \\sqrt{m}\\tilde{p}_n - hm\\omega^2 \\frac{\\tilde{q}_n}{\\omega\\sqrt{m}} \\implies \\tilde{p}_{n+1} = \\tilde{p}_n - (h\\omega)\\tilde{q}_n $$\n$$ \\frac{\\tilde{q}_{n+1}}{\\omega\\sqrt{m}} = \\frac{\\tilde{q}_n}{\\omega\\sqrt{m}} + \\frac{h}{m}\\sqrt{m}\\tilde{p}_{n+1} \\implies \\tilde{q}_{n+1} = \\tilde{q}_n + (h\\omega)\\tilde{p}_{n+1} $$\n令 $\\tau = h\\omega$。对于 $\\tilde{z}_n = (\\tilde{q}_n, \\tilde{p}_n)^T$ 的映射为 $\\tilde{z}_{n+1} = \\tilde{S} \\tilde{z}_n$，其中矩阵 $\\tilde{S}$ 是：\n$$ \\tilde{S} = \\begin{pmatrix} 1-\\tau^2  \\tau \\\\ -\\tau  1 \\end{pmatrix} $$\n\n**第三步：SE 映射及其不变椭圆的分析**\n$\\tilde{S}$ 的特征值满足 $\\lambda^2 - \\text{tr}(\\tilde{S})\\lambda + \\det(\\tilde{S}) = 0$。此处，$\\det(\\tilde{S})=1$ 且 $\\text{tr}(\\tilde{S})=2-\\tau^2$。如果 $|\\text{tr}(\\tilde{S})|  2$，即 $\\tau  2$，则特征值是单位圆上的共轭复数。该映射表示一个旋转，旋转角 $\\theta$ 满足 $\\text{tr}(\\tilde{S}) = 2\\cos\\theta$。\n$$ 2\\cos\\theta = 2 - \\tau^2 \\implies \\tau^2 = 2(1-\\cos\\theta) = 4\\sin^2(\\theta/2) $$\n鉴于轨迹是 M 个点的周期轨迹，旋转角必须为 $\\theta = 2\\pi/M$。因此：\n$$ \\tau = h\\omega = 2\\sin(\\pi/M) $$\nSE 映射保持一个修正的二次型守恒：$\\tilde{H}_{\\text{SE}}(\\tilde{q},\\tilde{p}) = \\frac{1}{2}(\\tilde{q}^2+\\tilde{p}^2) - \\frac{\\tau}{2}\\tilde{q}\\tilde{p} = \\tilde{E}_{\\text{SE}}$。由 $\\tilde{H}_{\\text{SE}} = \\tilde{E}_{\\text{SE}}$ 定义的椭圆面积为 $\\tilde{A}_{\\text{SE, ellipse}} = \\frac{2\\pi \\tilde{E}_{\\text{SE}}}{\\sqrt{1-\\tau^2/4}}$。代入 $\\tau=2\\sin(\\pi/M)$：\n$$ \\tilde{A}_{\\text{SE, ellipse}} = \\frac{2\\pi \\tilde{E}_{\\text{SE}}}{\\sqrt{1-\\sin^2(\\pi/M)}} = \\frac{2\\pi \\tilde{E}_{\\text{SE}}}{\\cos(\\pi/M)} $$\n问题假设 $\\tilde{A}_{\\text{SE, ellipse}} = \\tilde{A}_{\\text{exact}}$。在缩放坐标中，我们有 $\\frac{1}{2}(\\tilde{q}^2+\\tilde{p}^2) = E$，这是一个半径为 $\\sqrt{2E}$ 的圆。因此，$\\tilde{A}_{\\text{exact}} = \\pi(\\sqrt{2E})^2 = 2\\pi E$。匹配条件给出：\n$$ \\frac{2\\pi \\tilde{E}_{\\text{SE}}}{\\cos(\\pi/M)} = 2\\pi E \\implies \\tilde{E}_{\\text{SE}} = E\\cos(\\pi/M) $$\n\n**第四步：多边形的面积 ($A_{\\text{SE}}$)**\n多边形的面积 $\\tilde{A}_{\\text{SE}}$ 是由原点和连续顶点 $\\tilde{z}_k$ 和 $\\tilde{z}_{k+1}$ 构成的 M 个三角形的面积之和。单个三角形的有向面积为 $\\frac{1}{2}\\det(\\tilde{z}_k, \\tilde{z}_{k+1})$。\n$$ \\det(\\tilde{z}_k, \\tilde{z}_{k+1}) = \\det(\\tilde{z}_k, \\tilde{S}\\tilde{z}_k) = \\tilde{q}_k\\tilde{p}_{k+1} - \\tilde{p}_k\\tilde{q}_{k+1} $$\n使用矩阵 $\\tilde{S}$，我们发现：\n$$ \\det(\\tilde{z}_k, \\tilde{S}\\tilde{z}_k) = -\\tau(\\tilde{q}_k^2+\\tilde{p}_k^2) + \\tau^2\\tilde{q}_k\\tilde{p}_k $$\n这可以用守恒量 $\\tilde{H}_{\\text{SE}}$ 来表示：\n$$ \\det(\\tilde{z}_k, \\tilde{S}\\tilde{z}_k) = -2\\tau \\left( \\frac{1}{2}(\\tilde{q}_k^2+\\tilde{p}_k^2) - \\frac{\\tau}{2}\\tilde{q}_k\\tilde{p}_k \\right) = -2\\tau \\tilde{H}_{\\text{SE}}(\\tilde{q}_k, \\tilde{p}_k) $$\n由于 $\\tilde{H}_{\\text{SE}}$ 沿轨迹是常数，其值为 $\\tilde{E}_{\\text{SE}}$。因此，每个三角形的有向面积是恒定的：$\\frac{1}{2}(-2\\tau\\tilde{E}_{\\text{SE}}) = -\\tau\\tilde{E}_{\\text{SE}}$。多边形的总面积是这些有向面积之和的绝对值：\n$$ \\tilde{A}_{\\text{SE}} = \\left| \\sum_{k=0}^{M-1} (-\\tau\\tilde{E}_{\\text{SE}}) \\right| = |-M\\tau\\tilde{E}_{\\text{SE}}| = M\\tau\\tilde{E}_{\\text{SE}} $$\n（面积必须为正，且 $M, \\tau, \\tilde{E}_{\\text{SE}}$ 均为正值）。\n\n**第五步：最终比值**\n现在，代入 $\\tau$ 和 $\\tilde{E}_{\\text{SE}}$ 的表达式：\n$$ \\tilde{A}_{\\text{SE}} = M \\left(2\\sin\\left(\\frac{\\pi}{M}\\right)\\right) \\left(E\\cos\\left(\\frac{\\pi}{M}\\right)\\right) = M E \\left(2\\sin\\left(\\frac{\\pi}{M}\\right)\\cos\\left(\\frac{\\pi}{M}\\right)\\right) $$\n使用倍角公式 $2\\sin x \\cos x = \\sin(2x)$，我们得到：\n$$ \\tilde{A}_{\\text{SE}} = M E \\sin\\left(\\frac{2\\pi}{M}\\right) $$\n最后，比值 $R$ 为：\n$$ R = \\frac{\\tilde{A}_{\\text{SE}}}{\\tilde{A}_{\\text{exact}}} = \\frac{M E \\sin\\left(\\frac{2\\pi}{M}\\right)}{2\\pi E} = \\frac{M}{2\\pi}\\sin\\left(\\frac{2\\pi}{M}\\right) $$", "answer": "$$\\boxed{\\frac{M}{2\\pi}\\sin\\left(\\frac{2\\pi}{M}\\right)}$$", "id": "3235414"}, {"introduction": "保持几何结构的一个关键优势是在长期模拟中表现出卓越的精度，尤其对于振荡系统。这项练习旨在直接比较两种方法的相位（或频率）误差：一种是简单的辛欧拉法，另一种是高阶但非辛的经典四阶龙格-库塔（RK4）方法。通过这个对比，你将发现即使是低阶的几何积分法，在长期积分中也具有出色的相位保持特性。[@problem_id:3235367]", "problem": "考虑哈密顿简谐振子，其哈密顿量为 $H(q,p) = \\tfrac{1}{2} p^{2} + \\tfrac{1}{2} \\omega^{2} q^{2}$，因此，哈密顿方程给出线性常微分方程（ODE）系统 $q' = p$, $p' = -\\omega^{2} q$，等价于 $y' = A y$，其中 $y = (q,p)^{\\mathsf{T}}$ 且 $A = \\begin{pmatrix} 0  1 \\\\ -\\omega^{2}  0 \\end{pmatrix}$。对于步长为 $h$ 的单步法，数值频率 $\\Omega_{\\text{num}}$ 定义如下：如果单步更新为 $y_{n+1} = M y_{n}$，且 $M$ 的特征值为 $\\lambda_{\\pm} = \\rho \\exp(\\pm i \\theta)$，其中 $\\rho  0$ 且 $\\theta \\in \\mathbb{R}$（对于足够小的 $h$），那么每步的旋转角为 $\\theta$（以弧度为单位），数值频率为 $\\Omega_{\\text{num}} = \\theta / h$。\n\n您将分析以下两种方法以固定步长 $h$ 应用于该振子时，当 $h \\to 0$ 时的主阶相位误差（频率误差）$\\Delta \\Omega = \\Omega_{\\text{num}} - \\omega$：\n\n- 辛欧拉法（半隐式，先冲后漂）：$p_{n+1} = p_{n} - h \\,\\omega^{2} q_{n}$，$q_{n+1} = q_{n} + h\\, p_{n+1}$。假设 $0  \\omega h  2$，从而使更新是一个旋转。\n\n- 经典四阶 Runge–Kutta 法 (RK4)：对于步长为 $h$ 的 $y' = f(y)$，该方法由下式给出\n$k_{1} = f(y_{n})$，\n$k_{2} = f(y_{n} + \\tfrac{h}{2} k_{1})$，\n$k_{3} = f(y_{n} + \\tfrac{h}{2} k_{2})$，\n$k_{4} = f(y_{n} + h k_{3})$，\n$y_{n+1} = y_{n} + \\tfrac{h}{6} (k_{1} + 2 k_{2} + 2 k_{3} + k_{4})$。\n将其应用于 $f(y) = A y$。\n\n从这些定义和 $A$ 的线性代数出发，推导在 $h$ 的主非零阶下，相位误差 $\\Delta \\Omega_{\\text{SE}}$ 和 $\\Delta \\Omega_{\\text{RK4}}$ 作为 $\\omega$ 和 $h$ 的函数的渐近表达式，该表达式对小的 $h$ 有效。\n\n将您的最终答案表示为一个单行矩阵，按顺序包含 $\\bigl[\\Delta \\Omega_{\\text{SE}}, \\Delta \\Omega_{\\text{RK4}}\\bigr]$ 这两个表达式。角度使用弧度。不要包含单位。无需四舍五入；给出精确的符号系数。", "solution": "问题要求计算两种数值方法应用于简谐振子系统 $y' = Ay$ 时的首阶相位误差 $\\Delta \\Omega = \\Omega_{\\text{num}} - \\omega$，其中 $y = (q,p)^{\\mathsf{T}}$ 且 $A = \\begin{pmatrix} 0  1 \\\\ -\\omega^{2}  0 \\end{pmatrix}$。数值频率 $\\Omega_{\\text{num}}$ 定义为 $\\theta/h$，其中 $\\theta$ 是单步更新矩阵 $M$ 的特征值 $\\rho \\exp(\\pm i\\theta)$ 所对应的每步旋转角。\n\n矩阵 $A$ 的特征值是 $\\lambda^2 + \\omega^2 = 0$ 的解，即 $\\lambda_{\\pm} = \\pm i\\omega$。步长为 $h$ 的精确流由矩阵指数 $\\exp(hA)$ 给出。其特征值为 $\\exp(\\pm i\\omega h)$。这对应于精确的旋转角 $\\theta_{\\text{exact}} = \\omega h$ 和频率 $\\Omega_{\\text{exact}} = \\omega$。\n\n### 辛欧拉法（SE）分析\n\n所定义的辛欧拉法为：\n$p_{n+1} = p_{n} - h \\omega^{2} q_{n}$\n$q_{n+1} = q_{n} + h p_{n+1}$\n\n将第一个方程代入第二个方程，得到关于 $y_{n} = (q_n, p_n)^{\\mathsf{T}}$ 的显式更新规则：\n$q_{n+1} = q_{n} + h (p_n - h \\omega^2 q_n) = (1 - \\omega^2 h^2) q_n + h p_n$\n$p_{n+1} = -h \\omega^2 q_n + p_n$\n\n这可以写成矩阵形式 $y_{n+1} = M_{\\text{SE}} y_n$，其中更新矩阵 $M_{\\text{SE}}$ 为：\n$$\nM_{\\text{SE}} = \\begin{pmatrix} 1 - \\omega^{2}h^{2}  h \\\\ -h\\omega^{2}  1 \\end{pmatrix}\n$$\n$M_{\\text{SE}}$ 的特征值 $\\lambda$ 由特征方程 $\\det(M_{\\text{SE}} - \\lambda I) = 0$ 给出。\n$M_{\\text{SE}}$ 的迹为 $\\text{tr}(M_{\\text{SE}}) = 2 - \\omega^2 h^2$。\n行列式为 $\\det(M_{\\text{SE}}) = (1 - \\omega^2 h^2)(1) - (h)(-h\\omega^2) = 1$。\n特征方程为 $\\lambda^2 - \\text{tr}(M_{\\text{SE}})\\lambda + \\det(M_{\\text{SE}}) = 0$，即：\n$$\n\\lambda^{2} - (2 - \\omega^{2}h^{2})\\lambda + 1 = 0\n$$\n判别式为 $D = (2 - \\omega^2 h^2)^2 - 4 = 4 - 4\\omega^2 h^2 + \\omega^4 h^4 - 4 = \\omega^2 h^2(\\omega^2 h^2 - 4)$。\n条件 $0  \\omega h  2$ 意味着 $D  0$，因此特征值是单位圆上的一对共轭复数（因为 $\\det(M_{\\text{SE}})=1$）。设特征值为 $\\lambda_{\\pm} = \\exp(\\pm i \\theta_{\\text{SE}})$。\n特征值之和为 $\\lambda_+ + \\lambda_- = 2\\cos(\\theta_{\\text{SE}})$，它必须等于 $M_{\\text{SE}}$ 的迹。\n$$\n2\\cos(\\theta_{\\text{SE}}) = 2 - \\omega^{2}h^{2} \\implies \\cos(\\theta_{\\text{SE}}) = 1 - \\frac{\\omega^{2}h^{2}}{2}\n$$\n数值频率为 $\\Omega_{\\text{SE}} = \\theta_{\\text{SE}}/h$。我们需要求解 $\\theta_{\\text{SE}}$ 并针对小 $h$ 进行展开。\n$\\theta_{\\text{SE}} = \\arccos\\left(1 - \\frac{\\omega^{2}h^{2}}{2}\\right)$。\n设 $x = \\frac{\\omega^2 h^2}{2}$。对于小 $h$，$x$ 也很小。我们使用 $\\arccos(1-x)$ 对小 $x0$ 的泰勒级数展开：\n$\\arccos(1-x) = \\sqrt{2x} + \\frac{1}{6\\sqrt{2}}x^{3/2} + O(x^{5/2})$。\n代入 $x = \\frac{\\omega^2 h^2}{2}$：\n$$\n\\theta_{\\text{SE}} = \\sqrt{2 \\cdot \\frac{\\omega^{2}h^{2}}{2}} + \\frac{1}{6\\sqrt{2}}\\left(\\frac{\\omega^{2}h^{2}}{2}\\right)^{3/2} + O(h^5)\n$$\n$$\n\\theta_{\\text{SE}} = \\omega h + \\frac{1}{6\\sqrt{2}} \\frac{\\omega^{3}h^{3}}{2\\sqrt{2}} + O(h^5) = \\omega h + \\frac{\\omega^{3}h^{3}}{24} + O(h^5)\n$$\n数值频率为：\n$$\n\\Omega_{\\text{SE}} = \\frac{\\theta_{\\text{SE}}}{h} = \\omega + \\frac{\\omega^{3}h^{2}}{24} + O(h^4)\n$$\n辛欧拉法的首阶相位误差为：\n$$\n\\Delta \\Omega_{\\text{SE}} = \\Omega_{\\text{SE}} - \\omega = \\frac{\\omega^{3}h^{2}}{24}\n$$\n\n### 经典 Runge-Kutta 法（RK4）分析\n\n对于线性常微分方程 $y' = Ay$，RK4 方法给出一个线性更新 $y_{n+1} = M_{\\text{RK4}}y_n$。矩阵 $M_{\\text{RK4}}$ 是一个关于 $hA$ 的多项式：\n$$\nM_{\\text{RK4}} = I + hA + \\frac{(hA)^2}{2!} + \\frac{(hA)^3}{3!} + \\frac{(hA)^4}{4!}\n$$\n$M_{\\text{RK4}}$ 的特征值 $\\lambda_{\\text{RK4}}$ 是通过将相同的多项式应用于 $A$ 的特征值 $\\pm i\\omega$ 来找到的。设 $z=\\omega h$。\n$$\n\\lambda_{\\text{RK4}, \\pm} = 1 + (\\pm i\\omega h) + \\frac{(\\pm i\\omega h)^2}{2} + \\frac{(\\pm i\\omega h)^3}{6} + \\frac{(\\pm i\\omega h)^4}{24}\n$$\n$$\n\\lambda_{\\text{RK4}, \\pm} = 1 \\pm i(\\omega h) - \\frac{(\\omega h)^2}{2} \\mp i\\frac{(\\omega h)^3}{6} + \\frac{(\\omega h)^4}{24}\n$$\n$$\n\\lambda_{\\text{RK4}, \\pm} = \\left(1 - \\frac{z^2}{2} + \\frac{z^4}{24}\\right) \\pm i\\left(z - \\frac{z^3}{6}\\right)\n$$\n特征值的形式为 $\\rho \\exp(\\pm i\\theta_{\\text{RK4}})$。角度 $\\theta_{\\text{RK4}}$ 由复数 $\\lambda_{\\text{RK4},+}$ 的辐角给出。\n$$\n\\theta_{\\text{RK4}} = \\arg(\\lambda_{\\text{RK4},+}) = \\arctan\\left(\\frac{\\text{Im}(\\lambda_{\\text{RK4},+})}{\\text{Re}(\\lambda_{\\text{RK4},+})}\\right) = \\arctan\\left(\\frac{z - z^3/6}{1 - z^2/2 + z^4/24}\\right)\n$$\n为了找到首阶误差，我们对小 $z = \\omega h$ 展开此表达式。设反正切函数的自变量为 $X$。\n$$\nX = \\frac{z(1-z^2/6)}{1-z^2/2+z^4/24}\n$$\n我们将 $X$ 展开为关于 $z$ 的泰勒级数：\n$X = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 - \\left(\\frac{z^2}{2}-\\frac{z^4}{24}\\right)\\right)^{-1}$\n$ = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 + \\left(\\frac{z^2}{2}-\\frac{z^4}{24}\\right) + \\left(\\frac{z^2}{2}\\right)^2 + O(z^6)\\right)$\n$ = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 + \\frac{z^2}{2} + \\frac{5z^4}{24} + O(z^6)\\right)$\n$ = z\\left(1 + \\frac{z^2}{2} + \\frac{5z^4}{24} - \\frac{z^2}{6} - \\frac{z^4}{12} + O(z^6)\\right)$\n$ = z\\left(1 + \\frac{z^2}{3} + \\frac{z^4}{8} + O(z^6)\\right) = z + \\frac{z^3}{3} + \\frac{z^5}{8} + O(z^7)$\n\n$\\tan(z)$ 的泰勒级数为 $\\tan(z) = z + \\frac{z^3}{3} + \\frac{2z^5}{15} + O(z^7)$。\n因此，我们可以用 $\\tan(z)$ 来表示 $X$：\n$X = \\tan(z) + \\left(\\frac{1}{8} - \\frac{2}{15}\\right)z^5 + O(z^7) = \\tan(z) - \\frac{z^5}{120} + O(z^7)$。\n\n现在我们求 $\\theta_{\\text{RK4}} = \\arctan(X)$。设 $T = \\tan(z)$ 和 $\\epsilon = -z^5/120 + O(z^7)$。\n$\\theta_{\\text{RK4}} = \\arctan(T+\\epsilon) = \\arctan(T) + \\frac{\\epsilon}{1+T^2} + O(\\epsilon^2)$。\n因为对于小 $z$，$\\arctan(T)=\\arctan(\\tan(z)) = z$，并且 $1/(1+T^2) = 1/(1+\\tan^2(z)) = \\cos^2(z) = 1-z^2/2+O(z^4)$，我们有：\n$\\theta_{\\text{RK4}} = z + \\left(-\\frac{z^5}{120} + O(z^7)\\right)(\\cos^2(z)) = z - \\frac{z^5}{120} + O(z^7)$。\n代入 $z=\\omega h$：\n$$\n\\theta_{\\text{RK4}} = \\omega h - \\frac{(\\omega h)^5}{120} + O(h^7)\n$$\nRK4 的数值频率为：\n$$\n\\Omega_{\\text{RK4}} = \\frac{\\theta_{\\text{RK4}}}{h} = \\omega - \\frac{\\omega^5 h^4}{120} + O(h^6)\n$$\nRK4 的首阶相位误差为：\n$$\n\\Delta \\Omega_{\\text{RK4}} = \\Omega_{\\text{RK4}} - \\omega = -\\frac{\\omega^5 h^4}{120}\n$$\n最终结果由两个推导出的相位误差表达式组成。\n$\\Delta \\Omega_{\\text{SE}} = \\frac{\\omega^3 h^2}{24}$\n$\\Delta \\Omega_{\\text{RK4}} = -\\frac{\\omega^5 h^4}{120}$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\omega^{3}h^{2}}{24}  -\\frac{\\omega^{5}h^{4}}{120} \\end{pmatrix}}\n$$", "id": "3235367"}, {"introduction": "现在，让我们从理论走向实践。这个编程练习将让你亲眼见证使用辛积分法与非辛积分法在长期模拟中的不同后果。通过分别实现辛欧拉法和标准的休恩（Heun）方法，你将直接观察到前者能量误差的有界性与后者能量的系统性漂移，从而巩固几何积分在理论上的优势。[@problem_id:3235506]", "problem": "考虑一个由二阶常微分方程 (ODE) $q''(t) + q(t) = 0$ 控制的保守谐振子，其单位角频率为 1。引入正则动量 $p(t) = q'(t)$，得到一阶系统 $q'(t) = p(t)$ 和 $p'(t) = -q(t)$，这定义了一个哈密顿系统，其哈密顿量为 $H(q,p) = \\frac{1}{2} q^2 + \\frac{1}{2} p^2$。其精确解使状态 $(q(t),p(t))$ 以每秒 1 弧度的角速度在半径为 $\\sqrt{q^2 + p^2}$ 的圆上旋转。您的任务是为此系统实现两种数值积分器，比较它们的相位精度，并评估它们的能量行为。\n\n您必须实现：\n- 显式梯形法（Heun 法），这是一种二阶两步龙格-库塔法，通过对一个预测步和一个校正步的斜率进行平均而构成。\n- 辛欧拉法（踢-漂变体），该方法首先使用势梯度更新动量，然后使用新的动量更新位置，从而保持正则辛二形式。\n\n对于每个测试用例，执行以下步骤：\n1. 将二阶 ODE 转换为一阶系统 $q'(t) = p(t)$ 和 $p'(t) = -q(t)$。\n2. 从初始条件 $(q(0),p(0)) = (q_0,p_0)$ 开始，使用两种方法以均匀步长 $h$ 进行积分，共 $N = \\mathrm{round}(T/h)$ 步，其中 $T$ 是预期的总时间。令 $T_{\\text{eff}} = N h$ 表示有效积分时间。\n3. 计算在 $t = T_{\\text{eff}}$ 时的精确相位 $\\phi_{\\text{exact}} = \\phi_0 - T_{\\text{eff}}$，其中 $\\phi_0 = \\mathrm{atan2}(p_0,q_0)$。使用双参数反正切函数定义相位，并以弧度表示角度。\n4. 对于每种方法，计算最终状态 $(q_N,p_N)$ 的数值相位 $\\phi_{\\text{num}} = \\mathrm{atan2}(p_N,q_N)$。定义有符号最小角差 $\\Delta \\phi = \\phi_{\\text{num}} - \\phi_{\\text{exact}}$，将其包装到区间 $[-\\pi,\\pi]$ 内，并报告其绝对值 $|\\Delta \\phi|$ 作为相位误差（以弧度为单位）。\n5. 计算振幅比 $\\rho = \\frac{\\sqrt{q_N^2 + p_N^2}}{\\sqrt{q_0^2 + p_0^2}}$ 以评估与精确圆周运动的偏差。\n6. 为每个测试用例生成一个布尔标志，指示 Heun 方法的绝对相位误差是否严格大于辛欧拉法的绝对相位误差。\n\n角度单位必须是弧度。时间 $T$ 和步长 $h$ 必须以秒为单位处理，角频率等于每秒 1 弧度。所有浮点输出必须四舍五入到 6 位小数。\n\n测试套件：\n- 情况 1：$(q_0,p_0) = (1.0,0.0)$，$h = 0.2$ 秒，$T = 40\\pi$ 秒。\n- 情况 2：$(q_0,p_0) = (1.0,0.0)$，$h = 0.9$ 秒，$T = 40\\pi$ 秒。\n- 情况 3：$(q_0,p_0) = (0.7,0.3)$，$h = 0.05$ 秒，$T = 80\\pi$ 秒。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个内部列表。每个内部列表必须采用以下形式：\n$[\\text{phase\\_error\\_Heun}, \\text{phase\\_error\\_SymplecticEuler}, \\text{amplitude\\_ratio\\_Heun}, \\text{amplitude\\_ratio\\_SymplecticEuler}, \\text{Heun\\_phase\\_worse}]$，\n其中前四个条目是四舍五入到 6 位小数的浮点数，最后一个是布尔值。例如，输出格式必须类似于 $[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],[a_3,b_3,c_3,d_3,e_3]]$。", "solution": "问题陈述已经过分析，被认为是有效的。它具有科学依据、良定、客观，并包含了进行求解所需的所有必要信息。\n\n该问题研究了简谐振子的数值积分，这是物理学中的一个基本模型。其控制性的二阶常微分方程 (ODE) 为：\n$$\nq''(t) + q(t) = 0\n$$\n引入正则动量 $p(t) = q'(t)$，我们得到等效的一阶哈密顿系统：\n$$\n\\begin{cases}\nq'(t) = p(t) \\\\\np'(t) = -q(t)\n\\end{cases}\n$$\n该系统可以写成向量形式 $\\mathbf{y}'(t) = f(\\mathbf{y}(t))$，其中 $\\mathbf{y} = [q, p]^T$ 且 $f(\\mathbf{y}) = [p, -q]^T$。系统的哈密顿量 $H(q,p) = \\frac{1}{2}q^2 + \\frac{1}{2}p^2$ 是一个守恒量，代表总能量。精确解的轨迹是 $(q,p)$ 相空间中的圆，对应于恒定的能量。\n\n我们将实现并比较两种数值方法来近似该系统的解。\n\n### 显式梯形法（Heun 法）\nHeun 法是一种二阶龙格-库塔法。它是一种显式、两步的预测-校正方法。给定在时间 $t_n$ 的状态 $\\mathbf{y}_n = [q_n, p_n]^T$，在 $t_{n+1} = t_n + h$ 的状态通过以下方式求得：\n1. 预测步：$\\mathbf{k}_1 = f(\\mathbf{y}_n) = [p_n, -q_n]^T$。使用前向欧拉法估计一个初步状态 $\\mathbf{y}^*$：$\\mathbf{y}^* = \\mathbf{y}_n + h \\mathbf{k}_1$。\n2. 校正步：在预测状态处评估斜率：$\\mathbf{k}_2 = f(\\mathbf{y}^*) = f(\\mathbf{y}_n + h \\mathbf{k}_1)$。\n3. 更新：平均两个斜率以更新状态：$\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{2}(\\mathbf{k}_1 + \\mathbf{k}_2)$。\n\n对于我们的特定系统：\n$\\mathbf{k}_1 = [p_n, -q_n]^T$。\n$\\mathbf{y}^* = [q_n + h p_n, p_n - h q_n]^T$。\n$\\mathbf{k}_2 = [p_n - h q_n, -(q_n + h p_n)]^T$。\n更新方程为：\n$$\nq_{n+1} = q_n + \\frac{h}{2}(p_n + (p_n - h q_n)) = (1 - \\frac{h^2}{2})q_n + h p_n\n$$\n$$\np_{n+1} = p_n + \\frac{h}{2}(-q_n - (q_n + h p_n)) = -h q_n + (1 - \\frac{h^2}{2})p_n\n$$\n以矩阵形式，更新为 $\\mathbf{y}_{n+1} = M_H \\mathbf{y}_n$，其中放大矩阵 $M_H$ 为：\n$$\nM_H = \\begin{pmatrix} 1 - \\frac{h^2}{2}  h \\\\ -h  1 - \\frac{h^2}{2} \\end{pmatrix}\n$$\n该矩阵的行列式为 $\\det(M_H) = (1 - \\frac{h^2}{2})^2 + h^2 = 1 + \\frac{h^4}{4}$。由于 $\\det(M_H)  1$，该方法不是辛方法。相空间元素的面积不被保持，对于该系统，数值能量（以及振幅）将随时间系统性地增加。\n\n### 辛欧拉法（踢-漂）\n辛积分器旨在保持哈密顿系统的正则辛二形式，这带来了卓越的长期稳定性，尤其是在能量守恒方面。指定的踢-漂变体是一种一阶半隐式方法。它首先更新动量（踢），然后使用新的动量更新位置（漂）。\n对于一个可分离的哈密顿量 $H(q,p) = T(p) + V(q)$，更新步骤为：\n1. 踢：$p_{n+1} = p_n - h V'(q_n)$。\n2. 漂：$q_{n+1} = q_n + h T'(p_{n+1})$。\n\n对于我们的系统，$V(q) = \\frac{1}{2}q^2 \\implies V'(q)=q$ 且 $T(p) = \\frac{1}{2}p^2 \\implies T'(p)=p$。更新方程为：\n$$\np_{n+1} = p_n - h q_n\n$$\n$$\nq_{n+1} = q_n + h p_{n+1} = q_n + h (p_n - h q_n) = (1 - h^2)q_n + h p_n\n$$\n以矩阵形式，$\\mathbf{y}_{n+1} = M_{SE} \\mathbf{y}_n$，其放大矩阵 $M_{SE}$ 为：\n$$\nM_{SE} = \\begin{pmatrix} 1 - h^2  h \\\\ -h  1 \\end{pmatrix}\n$$\n其行列式为 $\\det(M_{SE}) = (1 - h^2)(1) - (h)(-h) = 1$。该方法是辛方法。它不守恒精确的哈密顿量 $H$，但它精确地守恒一个附近的“影子”哈密顿量。因此，在长积分时间内，数值能量误差保持有界。\n\n### 分析与计算过程\n对于每个具有初始条件 $(q_0, p_0)$、步长 $h$ 和总时间 $T$ 的测试用例，我们执行以下操作：\n1. 计算步数 $N = \\mathrm{round}(T/h)$ 和有效积分时间 $T_{\\text{eff}} = N h$。\n2. 对于两种方法，迭代各自的矩阵更新 $N$ 次以找到最终状态 $(q_N, p_N)$。\n3. 初始半径为 $R_0 = \\sqrt{q_0^2 + p_0^2}$。最终半径为 $R_N = \\sqrt{q_N^2 + p_N^2}$。振幅比为 $\\rho = R_N / R_0$。此比率衡量数值能量耗散或增长，因为 $H = \\frac{1}{2}R^2$。\n4. 初始相位为 $\\phi_0 = \\mathrm{atan2}(p_0, q_0)$。精确解的相位演化为 $\\phi(t) = \\phi_0 - t$。因此，精确的最终相位为 $\\phi_{\\text{exact}} = \\phi_0 - T_{\\text{eff}}$。\n5. 数值最终相位为 $\\phi_{\\text{num}} = \\mathrm{atan2}(p_N, q_N)$。\n6. 相位误差是最小角差 $\\Delta\\phi = \\phi_{\\text{num}} - \\phi_{\\text{exact}}$。使用 $((\\Delta\\phi + \\pi) \\pmod{2\\pi}) - \\pi$ 将其包装到区间 $[-\\pi, \\pi]$ 内。我们报告其绝对值 $|\\Delta\\phi|$。\n7. 我们比较absolute相位误差，以确定 Heun 方法的误差是否严格大于辛欧拉法的误差。\n\n这一过程可以直接比较标准龙格-库塔法与几何积分器，突显后者在保守系统长期模拟中的优势。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the harmonic oscillator problem using Heun's and Symplectic Euler\n    methods and compares their phase accuracy and amplitude stability.\n    \"\"\"\n\n    # Test suite with initial conditions, step size, and total time.\n    # (q0, p0), h, T\n    test_cases = [\n        ((1.0, 0.0), 0.2, 40 * np.pi),  # Case 1\n        ((1.0, 0.0), 0.9, 40 * np.pi),  # Case 2\n        ((0.7, 0.3), 0.05, 80 * np.pi), # Case 3\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        (q0, p0), h, T = case\n        \n        y0 = np.array([q0, p0])\n\n        # 1. Calculate integration parameters\n        N = int(np.round(T / h))\n        T_eff = N * h\n\n        # 2. Define update matrices for the methods\n        # Heun's method matrix\n        M_H = np.array([\n            [1 - 0.5 * h**2, h],\n            [-h, 1 - 0.5 * h**2]\n        ])\n\n        # Symplectic Euler (kick-drift) matrix\n        M_SE = np.array([\n            [1 - h**2, h],\n            [-h, 1]\n        ])\n\n        # 3. Integrate using both methods\n        y_heun = y0.copy()\n        for _ in range(N):\n            y_heun = M_H @ y_heun\n        \n        y_se = y0.copy()\n        for _ in range(N):\n            y_se = M_SE @ y_se\n        \n        qN_heun, pN_heun = y_heun\n        qN_se, pN_se = y_se\n\n        # 4. Compute exact quantities and initial values\n        phi0 = np.arctan2(p0, q0)\n        phi_exact = phi0 - T_eff\n        r0 = np.linalg.norm(y0)\n        # Handle the case of (0,0) initial condition to avoid division by zero\n        if r0 == 0:\n            r0 = 1.0\n\n        # Create a helper function for calculating metrics\n        def calculate_metrics(qN, pN):\n            # Compute numerical phase\n            phi_num = np.arctan2(pN, qN)\n            \n            # Compute and wrap phase error\n            delta_phi = phi_num - phi_exact\n            wrapped_delta_phi = (delta_phi + np.pi) % (2 * np.pi) - np.pi\n            phase_error = np.abs(wrapped_delta_phi)\n            \n            # Compute amplitude ratio\n            rN = np.linalg.norm(np.array([qN, pN]))\n            amplitude_ratio = rN / r0\n            \n            return phase_error, amplitude_ratio\n\n        # 5. Calculate metrics for each method\n        phase_error_heun, amp_ratio_heun = calculate_metrics(qN_heun, pN_heun)\n        phase_error_se, amp_ratio_se = calculate_metrics(qN_se, pN_se)\n        \n        # 6. Compare phase errors\n        heun_phase_worse = phase_error_heun > phase_error_se\n        \n        # 7. Collect and format results for the current test case\n        case_results = [\n            phase_error_heun,\n            phase_error_se,\n            amp_ratio_heun,\n            amp_ratio_se,\n            heun_phase_worse,\n        ]\n        all_results.append(case_results)\n    \n    # 8. Format the final output string exactly as required\n    results_str_list = []\n    for res in all_results:\n        s = (f\"[{res[0]:.6f},{res[1]:.6f},\"\n             f\"{res[2]:.6f},{res[3]:.6f},\"\n             f\"{res[4]}]\")\n        results_str_list.append(s)\n    \n    final_output = f\"[{','.join(results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3235506"}]}