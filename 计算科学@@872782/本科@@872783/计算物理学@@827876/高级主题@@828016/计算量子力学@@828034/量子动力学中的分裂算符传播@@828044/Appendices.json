{"hands_on_practices": [{"introduction": "理论学习的最终目的是解决实际问题。本章将通过一系列动手实践，带你深入探索如何应用分裂算符方法来模拟量子动力学。让我们从一个基础但至关重要的练习开始：数值验证海森堡不确定性原理。[@problem_id:2452266] 这个练习将模拟一个自由高斯波包的演化，这是一个理想的起点，因为它让我们能够专注于分裂算符方法的核心——在位置空间和动量空间之间切换——而无需处理复杂的势能。通过计算波包在演化过程中位置和动量标准差的乘积，你将亲眼见证量子力学中最深刻和反直觉的原理之一。", "problem": "考虑一个一维、非相对论性、无自旋的量子粒子，其质量为 $m$，被限制在长度为 $L$ 的周期性区间内，使用哈特里原子单位制（因此 $\\hbar=1$ 且 $m=1$）。其动力学由含时薛定谔方程决定\n$$\ni \\,\\frac{\\partial}{\\partial t}\\,\\psi(x,t) \\;=\\; \\hat{H}\\,\\psi(x,t), \\qquad \\hat{H} \\;=\\; \\frac{\\hat{p}^2}{2 m}, \\qquad \\hat{p} \\;=\\; -\\,i\\,\\frac{\\partial}{\\partial x},\n$$\n在区间 $x\\in[-L/2,L/2)$ 上具有周期性边界条件。初始波函数是归一化的高斯波包\n$$\n\\psi(x,0) \\;=\\; \\left(\\frac{1}{2\\pi\\,\\sigma_x^2}\\right)^{1/4}\\,\\exp\\!\\left(-\\frac{(x-x_0)^2}{4\\,\\sigma_x^2}\\right)\\,\\exp\\!\\left(i\\,p_0\\,(x-x_0)\\right),\n$$\n其位置空间宽度参数为 $\\sigma_x>0$，平均位置为 $x_0$，平均动量为 $p_0$。\n\n对于每个时间 $t$，位置和动量的期望值及方差定义如下\n$$\n\\langle x\\rangle_t \\;=\\; \\int_{-L/2}^{L/2} \\psi^*(x,t)\\,x\\,\\psi(x,t)\\,dx,\\quad\n\\langle x^2\\rangle_t \\;=\\; \\int_{-L/2}^{L/2} \\psi^*(x,t)\\,x^2\\,\\psi(x,t)\\,dx,\n$$\n$$\n\\langle p\\rangle_t \\;=\\; \\int_{-L/2}^{L/2} \\psi^*(x,t)\\,\\Big(-i\\,\\frac{\\partial}{\\partial x}\\Big)\\,\\psi(x,t)\\,dx,\\quad\n\\langle p^2\\rangle_t \\;=\\; \\int_{-L/2}^{L/2} \\psi^*(x,t)\\,\\Big(-\\frac{\\partial^2}{\\partial x^2}\\Big)\\,\\psi(x,t)\\,dx,\n$$\n以及相关的标准差\n$$\n\\Delta x(t) \\;=\\; \\sqrt{\\langle x^2\\rangle_t - \\langle x\\rangle_t^2},\\qquad\n\\Delta p(t) \\;=\\; \\sqrt{\\langle p^2\\rangle_t - \\langle p\\rangle_t^2}.\n$$\n所有量均采用原子单位；时间必须以原子时间单位处理，动量以原子动量单位处理，长度以玻尔半径处理。海森堡不确定性原理指出，对于所有 $t$，\n$$\n\\Delta x(t)\\,\\Delta p(t) \\;\\ge\\; \\frac{1}{2}.\n$$\n\n任务：对于以下参数集测试套件，使用在 $[-L/2,L/2)$ 上的 $N$ 个网格点的空间离散化方法，根据上述薛定谔方程在周期性域上精确演化 $\\psi(x,t)$。对于每个参数集，计算在指定时间 $\\{t_k\\}$ 的值列表 $\\{\\Delta x(t_k)\\,\\Delta p(t_k)\\}$，然后计算最小值 $S=\\min_k \\Delta x(t_k)\\,\\Delta p(t_k)$，并将其与 $1/2$ 进行比较，数值容差为 $\\tau=10^{-3}$。对于每个测试用例，返回布尔值 $S \\ge 1/2 - \\tau$。\n\n使用以下测试套件，其中所有数字均为原子单位：\n- 情况 1：$L=100.0$，$N=4096$，$\\sigma_x=1.0$，$x_0=0.0$，$p_0=0.0$，时间 $t\\in\\{0.0,\\,1.0,\\,2.0,\\,5.0,\\,10.0\\}$。\n- 情况 2：$L=100.0$，$N=4096$，$\\sigma_x=0.2$，$x_0=0.0$，$p_0=0.0$，时间 $t\\in\\{0.0,\\,0.2,\\,0.5,\\,1.0,\\,2.0\\}$。\n- 情况 3：$L=100.0$，$N=4096$，$\\sigma_x=3.0$，$x_0=-10.0$，$p_0=2.0$，时间 $t\\in\\{0.0,\\,1.0,\\,5.0,\\,10.0,\\,20.0\\}$。\n- 情况 4：$L=100.0$，$N=4096$，$\\sigma_x=0.5$，$x_0=20.0$，$p_0=5.0$，时间 $t\\in\\{0.0,\\,0.5,\\,1.0,\\,2.0,\\,5.0\\}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含案例 1 到 4 的布尔结果，以逗号分隔的列表形式，并用方括号括起来，不含空格，例如，“[True,False,True,True]”。", "solution": "问题陈述已解析和验证。\n\n已知条件：\n一个一维、非相对论性、无自旋的量子粒子，质量 $m=1$，处于哈特里原子单位制中，其中 $\\hbar=1$。该粒子被限制在由 $x \\in [-L/2, L/2)$ 定义的长度为 $L$ 的周期性区间内。其控制方程是含时薛定谔方程（TDSE）：\n$$\ni \\,\\frac{\\partial}{\\partial t}\\,\\psi(x,t) \\;=\\; \\hat{H}\\,\\psi(x,t)\n$$\n其自由粒子哈密顿量为：\n$$\n\\hat{H} \\;=\\; \\frac{\\hat{p}^2}{2 m}, \\qquad \\hat{p} \\;=\\; -\\,i\\,\\frac{\\partial}{\\partial x}\n$$\n在 $t=0$ 时的初始状态是一个归一化的高斯波包：\n$$\n\\psi(x,0) \\;=\\; \\left(\\frac{1}{2\\pi\\,\\sigma_x^2}\\right)^{1/4}\\,\\exp\\!\\left(-\\frac{(x-x_0)^2}{4\\,\\sigma_x^2}\\right)\\,\\exp\\!\\left(i\\,p_0\\,(x-x_0)\\right)\n$$\n可观测量由在域 $[-L/2, L/2)$ 上的标准期望值积分定义。位置和动量的标准差分别为 $\\Delta x(t)$ 和 $\\Delta p(t)$。任务是数值演化该系统，计算在指定时间 $t_k$ 的不确定性乘积 $\\Delta x(t_k)\\,\\Delta p(t_k)$，找到最小值 $S = \\min_k \\Delta x(t_k)\\,\\Delta p(t_k)$，并验证在容差 $\\tau=10^{-3}$ 下是否满足 $S \\ge 1/2 - \\tau$。提供了四个具有特定参数（$L, N, \\sigma_x, x_0, p_0, \\{t_k\\}$）的测试用例。\n\n验证结论：\n该问题在科学上和数学上都是合理的。它描述了量子动力学中的一个基本问题：自由粒子的时间演化。所有概念、方程和参数都定义明确，并与量子力学原理一致。“使用空间离散化精确演化...”的请求被理解为使用谱方法，如分步傅里叶方法，该方法对于自由粒子情况下的离散化系统是数值精确的。该问题是适定的、客观的且计算上可行的。初始高斯形式是在无限域上定义的，但对于给定的参数，它在周期性盒子内是良好局域化的，这使得将其用作周期性域上的初始状态成为一个有效的近似。我们将继续进行求解。\n\n基于原理的求解设计：\n\n含时薛定谔方程的解 $\\psi(x,t) = e^{-i\\hat{H}t}\\psi(x,0)$，可以在动量本征态的基下使用谱方法高效计算。哈密顿量 $\\hat{H} = \\hat{p}^2/(2m)$ 在动量（傅里叶）基中是对角的。在长度为 $L$ 的周期性域上，动量算符的本征函数是平面波 $\\phi_k(x) = \\frac{1}{\\sqrt{L}} e^{ikx}$，其中波矢 $k$ 被量化为 $k_n = 2\\pi n/L$（$n$ 为整数）。\n\n哈密顿量在这些基态上的作用是简单的乘法：$\\hat{H} \\phi_k(x) = \\frac{k^2}{2m} \\phi_k(x)$。因此，时间演化算符 $e^{-i\\hat{H}t}$ 在这个基上的作用也是一个简单的乘法：$e^{-i\\hat{H}t} \\phi_k(x) = e^{-i\\frac{k^2}{2m}t} \\phi_k(x)$。\n\n被称为分步傅里叶方法的数值算法，通过快速傅里叶变换（FFT）利用了这一性质，FFT 能在位置和动量表示之间高效地变换波函数。\n\n分步过程如下：\n\n1.  **离散化与初始状态准备**：\n    空间域 $x \\in [-L/2, L/2)$ 被离散化为 $N$ 个网格点 $x_j$，间距为 $\\Delta x = L/N$。初始波函数 $\\psi(x,0)$ 在这些网格点上进行求值。给定的 $\\psi(x,0)$ 的解析形式在技术上是在无限域上归一化的。对于我们的有限周期性域，我们必须在网格上进行数值归一化：\n    $$\n    \\psi_j(0) = \\frac{\\phi_j}{\\sqrt{\\sum_{l=0}^{N-1} |\\phi_l|^2 \\Delta x}}\n    $$\n    其中 $\\phi_j$ 是在 $x_j$ 处求值的未归一化高斯波包。这确保了初始状态满足概率守恒条件 $\\int |\\psi|^2 dx \\approx \\sum_j |\\psi_j(0)|^2 \\Delta x = 1$。\n\n2.  **傅里叶空间中的时间演化**：\n    对于每个所需的时间 $t_k$，波函数 $\\psi(x, t_k)$ 从初始状态 $\\psi(x, 0)$ 计算得出：\n    a.  使用 FFT 将初始状态变换到动量表示：$\\tilde{\\psi}(k, 0) = \\mathcal{F}\\{\\psi(x, 0)\\}$。相应的动量网格 $k_n$ 由空间离散化通过 $k = 2\\pi \\cdot \\text{fftfreq}(N, \\Delta x)$ 确定。\n    b.  通过与对角的时间演化算符相乘，在动量空间中演化状态：\n        $$\n        \\tilde{\\psi}(k, t_k) = \\tilde{\\psi}(k, 0) \\cdot e^{-i \\frac{k^2}{2m} t_k}\n        $$\n        由于我们使用哈特里原子单位制，$m=1$。\n    c.  使用逆 FFT 将状态变换回位置表示：$\\psi(x, t_k) = \\mathcal{F}^{-1}\\{\\tilde{\\psi}(k, t_k)\\}$。`numpy` 的 FFT 和 IFFT 函数是互逆的，确保状态向量的范数在整个演化过程中保持不变。\n\n3.  **可观测量的计算**：\n    对于每个演化后的状态 $\\psi(x, t_k)$，我们计算所需的标准差 $\\Delta x(t_k)$ 和 $\\Delta p(t_k)$。\n\n    a.  **位置不确定性 $\\Delta x(t_k)$**：期望值 $\\langle x \\rangle_{t_k}$ 和 $\\langle x^2 \\rangle_{t_k}$ 通过数值积分（对网格点求和）计算，如问题陈述中所定义：\n        $$\n        \\langle x \\rangle_{t_k} \\approx \\sum_j x_j |\\psi_j(t_k)|^2 \\Delta x\n        $$\n        $$\n        \\langle x^2 \\rangle_{t_k} \\approx \\sum_j x_j^2 |\\psi_j(t_k)|^2 \\Delta x\n        $$\n        位置方差为 $\\Delta x(t_k)^2 = \\langle x^2 \\rangle_{t_k} - \\langle x \\rangle_{t_k}^2$。需要特别注意周期性域上位置坐标 $x_j$ 的定义，因为这会影响期望值的计算，特别是当波包接近或穿过边界 $x = \\pm L/2$ 时。\n\n    b.  **动量不确定性 $\\Delta p(t_k)$**：动量可观测量在动量表示中计算最为方便和准确。对于自由粒子，动量分布 $|\\tilde{\\psi}(k, t)|^2$ 不随时间变化，因为演化算符是一个纯相位因子。因此，$\\Delta p(t)$ 对所有 $t$ 都是常数。我们可以从初始状态 $\\tilde{\\psi}(k, 0)$ 计算一次：\n        $$\n        \\langle p \\rangle \\approx \\frac{\\sum_n k_n |\\tilde{\\psi}_n(0)|^2}{\\sum_n |\\tilde{\\psi}_n(0)|^2}\n        $$\n        $$\n        \\langle p^2 \\rangle \\approx \\frac{\\sum_n k_n^2 |\\tilde{\\psi}_n(0)|^2}{\\sum_n |\\tilde{\\psi}_n(0)|^2}\n        $$\n        动量方差为 $\\Delta p^2 = \\langle p^2 \\rangle - \\langle p \\rangle^2$。这种计算是稳健的，因为它直接从动量概率分布计算均值和方差。\n\n4.  **对海森堡不确定性原理的验证**：\n    对于每个测试用例，生成不确定性乘积的列表 $\\{\\Delta x(t_k)\\Delta p(t_k)\\}$。找到最小值 $S$。初始状态是一个最小不确定性波包，其 $\\Delta x(0) \\Delta p(0) = 1/2$。对于自由粒子，$\\Delta p$ 是常数，而 $\\Delta x$ 随时间增加（波包展宽）。因此，最小不确定性乘积必然出现在 $t=0$ 时。数值模拟必须确认 $S \\ge 1/2 - \\tau$。预计所有情况的结果都为 `True`，因为这是对基本的海森堡不确定性原理的数值验证。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    为给定的测试用例求解量子力学问题。\n    \"\"\"\n    test_cases = [\n        # Case 1: L=100.0, N=4096, sigma_x=1.0, x0=0.0, p0=0.0, times\n        (100.0, 4096, 1.0, 0.0, 0.0, [0.0, 1.0, 2.0, 5.0, 10.0]),\n        # Case 2: L=100.0, N=4096, sigma_x=0.2, x0=0.0, p0=0.0, times\n        (100.0, 4096, 0.2, 0.0, 0.0, [0.0, 0.2, 0.5, 1.0, 2.0]),\n        # Case 3: L=100.0, N=4096, sigma_x=3.0, x0=-10.0, p0=2.0, times\n        (100.0, 4096, 3.0, -10.0, 2.0, [0.0, 1.0, 5.0, 10.0, 20.0]),\n        # Case 4: L=100.0, N=4096, sigma_x=0.5, x0=20.0, p0=5.0, times\n        (100.0, 4096, 0.5, 20.0, 5.0, [0.0, 0.5, 1.0, 2.0, 5.0]),\n    ]\n\n    results = []\n    for case_params in test_cases:\n        results.append(run_simulation(*case_params))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(L, N, sigma_x, x0, p0, times):\n    \"\"\"\n    为单个参数集执行量子模拟。\n    \"\"\"\n    # Mass m=1 and h_bar=1 in Hartree atomic units\n    m = 1.0\n    h_bar = 1.0\n    \n    # 1. Discretization\n    # Spatial grid\n    dx = L / N\n    x = np.arange(N) * dx - L / 2.0\n\n    # Momentum grid\n    # fftfreq provides frequency f. Wavevector k = 2*pi*f. Momentum p = h_bar*k.\n    k = 2.0 * np.pi * np.fft.fftfreq(N, d=dx)\n\n    # 2. Initial State Preparation\n    # Unnormalized initial wavepacket\n    psi0_unnormalized = np.exp(-((x - x0)**2) / (4.0 * sigma_x**2)) * \\\n                        np.exp(1j * p0 * (x - x0))\n\n    # Numerically normalize the state on the discrete grid\n    norm_factor = np.sqrt(np.sum(np.abs(psi0_unnormalized)**2) * dx)\n    psi0 = psi0_unnormalized / norm_factor\n\n    # 3. Calculate Momentum Uncertainty (constant for free particle)\n    psi0_k = np.fft.fft(psi0)\n    prob_k = np.abs(psi0_k)**2\n    k_norm = np.sum(prob_k)\n\n    # Expectation values for momentum\n    exp_p = np.sum(k * prob_k) / k_norm\n    exp_p2 = np.sum(k**2 * prob_k) / k_norm\n    \n    # Standard deviation of momentum\n    var_p = exp_p2 - exp_p**2\n    delta_p = np.sqrt(var_p)\n\n    uncertainty_products = []\n\n    # 4. Time Evolution and Observable Calculation\n    for t in times:\n        # Evolve in momentum space\n        time_evolution_operator = np.exp(-1j * (k**2) / (2.0 * m) * t)\n        psi_k_t = psi0_k * time_evolution_operator\n\n        # Transform back to position space\n        psi_t = np.fft.ifft(psi_k_t)\n        \n        # Calculate position uncertainty\n        prob_x = np.abs(psi_t)**2\n        \n        # Expectation values for position\n        # Normalization of psi_t is preserved by the unitary evolution\n        # so we can use the integral approximation sum(...)*dx directly.\n        # np.sum(prob_x)*dx should be 1.0\n        exp_x = np.sum(x * prob_x) * dx\n        exp_x2 = np.sum(x**2 * prob_x) * dx\n\n        # Standard deviation of position\n        var_x = exp_x2 - exp_x**2\n        delta_x = np.sqrt(var_x)\n\n        # Calculate and store the uncertainty product\n        uncertainty_products.append(delta_x * delta_p)\n\n    # 5. Final Verification\n    S = np.min(uncertainty_products)\n    tau = 1e-3\n    \n    # The Heisenberg Uncertainty Principle states delta_x * delta_p >= h_bar / 2\n    # With h_bar = 1, this is >= 0.5\n    return S >= (h_bar / 2.0 - tau)\n\nsolve()\n```", "id": "2452266"}, {"introduction": "在掌握了基本的波包动力学模拟后，我们来探讨一个更深层次的概念：薛定谔方程的基本对称性。[@problem_id:2441280] 物理定律对于所有惯性参考系中的观测者都应该是相同的，这便是伽利略不变性原理。本练习将通过数值实验来检验自由粒子薛定谔方程的伽利略不变性。你需要推导并实现伽利略变换下波函数的正确变换形式，这不仅是一个有趣的计算挑战，更能加深你对量子理论数学结构及其背后物理原理的理解。", "problem": "实现并使用分裂算符传播方法，检验一维自由粒子含时薛定谔方程的伽利略不变性。从一维空间的基本含时薛定谔方程 $$i\\hbar\\,\\frac{\\partial \\psi(x,t)}{\\partial t}=\\left[-\\frac{\\hbar^2}{2m}\\frac{\\partial^2}{\\partial x^2}+V(x,t)\\right]\\psi(x,t),$$ 以及惯性系之间的伽利略变换定义 $$x' = x - vt,\\quad t'=t,$$ 开始，其中 $v$ 是一个恒定的相对速度。您必须从第一性原理出发，推导出连接无撇号坐标系和带撇号坐标系解的精确变换，并陈述薛定谔动力学形式保持不变的条件。然后，实现一个数值实验来验证此不变性。\n\n您必须按以下步骤进行。\n\n- 使用基于将时间演化算符分解为动能和势能部分的分裂算符传播方法，并通过快速傅里叶变换（FFT; Fast Fourier Transform）在谱域上实现它。对于自由粒子，使用 $V(x,t)=0$。\n\n- 在原子单位制中进行计算，即设 $\\hbar=1$ 和 $m=1$。因此，所有量都是无量纲的。所有相位必须以弧度处理。\n\n- 在长度为 $L$ 的域上，使用包含 $N$ 个点的均匀周期性网格来离散化空间。使用 $N=2048$ 和 $L=400$。设空间网格为 $[-L/2,L/2)$ 区间内的 $N$ 个等距点。\n\n- 在无撇号（实验室）坐标系中，使用一个高斯波包作为初始状态，其中心位置为 $x_0$，平均动量为 $p_0$，空间宽度为 $\\sigma$。取 $x_0=-50$，$p_0=2$ 和 $\\sigma=5$。对状态进行归一化，使得 $\\int |\\psi(x,0)|^2\\,dx$ 的离散近似值等于 $1$。\n\n- 使用均匀的时间步长 $\\Delta t$ 将状态演化总时间 $T$。使用 $T=10$ 和 $\\Delta t=0.1$。\n\n- 对于每个测试速度 $v$，执行两次计算直到时间 $T$：\n  1. 在无撇号坐标系中传播初始状态以获得 $\\psi(x,T)$。然后，使用您从薛定谔方程和伽利略变换 $x' = x - vt$ 推导出的正确变换，将此结果在同一时间转换到带撇号坐标系中。\n  2. 使用您推导出的变换，在 $t=0$ 时于带撇号坐标系中构建正确的经变换的初始状态，然后在带撇号坐标系中将其传播到 $t=T$。\n\n- 通过计算归一化均方根误差来量化 $t=T$ 时两个带撇号坐标系状态之间的差异：\n  $$\\varepsilon(v)=\\sqrt{\\frac{\\int | \\phi_{\\text{direct}}(x',T)-\\phi_{\\text{from-lab}}(x',T) |^2\\,dx'}{\\int |\\phi_{\\text{from-lab}}(x',T)|^2\\,dx'}}$$\n  使用一致的离散近似来计算积分。在正确的不变性和数值计算下，预期的结果是 $\\varepsilon(v)$ 非常小。\n\n测试组。使用以下速度（在相同的原子单位制下）：\n- $v=0$（基准），\n- $v=0.5$（中等正值），\n- $v=-0.75$（中等负值），\n- $v=1.25$（分辨率限制内的较大正值）。\n\n您的程序必须生成单行输出，其中包含上述四种速度对应的四个 $\\varepsilon(v)$ 数值，形式为用方括号括起来的逗号分隔列表，例如“[$\\varepsilon(v_1)$,$\\varepsilon(v_2)$,$\\varepsilon(v_3)$,$\\varepsilon(v_4)$]”。这些条目必须是无量纲的实数。不应打印其他任何文本。数值实验的实现方式必须是完全确定性的，并且不需要任何用户输入或外部文件。", "solution": "我们从一维含时薛定谔方程开始，\n$$i\\hbar\\,\\frac{\\partial \\psi(x,t)}{\\partial t}=\\left[-\\frac{\\hbar^2}{2m}\\frac{\\partial^2}{\\partial x^2}+V(x,t)\\right]\\psi(x,t).$$\n我们考虑一个伽利略变换，变换到一个相对于无撇号（实验室）坐标系以恒定速度 $v$ 移动的带撇号坐标系，其坐标关系为 $x'=x-vt$ 和 $t'=t$。我们寻求波函数之间的一种变换，使得如果 $\\psi(x,t)$ 是无撇号坐标系中给定势的解，那么由\n$$\\phi(x',t)=e^{i\\alpha(x',t)}\\psi(x'+vt,t)$$\n定义的 $\\phi(x',t)$ 在带撇号坐标系中满足薛定谔方程，理想情况下，对于自由粒子，其形式应与原方程相同。我们使用链式法则计算导数。定义 $x=x'+vt$ 并为简洁起见省略显式的函数依赖关系。那么\n$$\\frac{\\partial \\phi}{\\partial t}=e^{i\\alpha}\\left(i\\frac{\\partial \\alpha}{\\partial t}\\psi+\\frac{\\partial \\psi}{\\partial t}+v\\frac{\\partial \\psi}{\\partial x}\\right),$$\n$$\\frac{\\partial \\phi}{\\partial x'}=e^{i\\alpha}\\left(i\\frac{\\partial \\alpha}{\\partial x'}\\psi+\\frac{\\partial \\psi}{\\partial x}\\right),\\quad\n\\frac{\\partial^2 \\phi}{\\partial x'^2}=e^{i\\alpha}\\left[(i\\frac{\\partial \\alpha}{\\partial x'})^2\\psi+i\\frac{\\partial^2 \\alpha}{\\partial x'^2}\\psi+2i\\frac{\\partial \\alpha}{\\partial x'}\\frac{\\partial \\psi}{\\partial x}+\\frac{\\partial^2 \\psi}{\\partial x^2}\\right].$$\n代入自由粒子的带撇号薛定谔方程 $i\\hbar \\partial_t \\phi=-(\\hbar^2/2m)\\partial_{x'}^2\\phi$，使用无撇号自由薛定谔方程 $i\\hbar \\partial_t \\psi=-(\\hbar^2/2m)\\partial_x^2\\psi$，并匹配独立结构 $\\psi$ 和 $\\partial_x \\psi$ 的系数。这得到以下条件：\n$$\\frac{\\partial \\alpha}{\\partial x'}=-\\frac{mv}{\\hbar},\\qquad \\frac{\\partial \\alpha}{\\partial t}=-\\frac{mv^2}{2\\hbar}.$$\n积分并舍去一个不相关的附加常数相位，得到\n$$\\alpha(x',t)=-\\frac{mv}{\\hbar}x'-\\frac{mv^2}{2\\hbar}t.$$\n因此，对于自由粒子，伽利略变换的作用为\n$$\\phi(x',t)=\\exp\\left[-\\frac{i}{\\hbar}\\left(m v x'+\\frac{1}{2}m v^2 t\\right)\\right]\\psi(x'+vt,t),$$\n这保证了如果 $\\psi$ 在无撇号坐标系中满足自由薛定谔方程，那么 $\\phi$ 在带撇号坐标系中也满足该方程。在 $t=0$ 时，$x'=x$，初始状态必须变换为\n$$\\phi(x',0)=\\exp\\left(-\\frac{i}{\\hbar} m v x'\\right)\\psi(x',0),$$\n这使得平均动量改变了 $-mv$，这与伽利略变换的预期相符。\n\n我们现在设计数值方案。在原子单位制中，设 $\\hbar=1$ 和 $m=1$。我们使用一个长度为 $L$ 的周期性空间域，由 $N$ 个均匀点离散化，间距为 $\\Delta x=L/N$。分裂算符法基于二阶分解\n$$e^{-i(T+V)\\Delta t}\\approx e^{-iV\\Delta t/2}\\,e^{-iT\\Delta t}\\,e^{-iV\\Delta t/2},$$\n其中 $T=\\hat{p}^2/(2m)$ 和 $V=V(\\hat{x},t)$ 分别是动能和势能算符。对于自由粒子，$V=0$，传播算符精确地简化为\n$$\\psi(x,t+\\Delta t)=\\mathcal{F}^{-1}\\left[e^{-i\\frac{k^2}{2m}\\Delta t}\\,\\mathcal{F}\\{\\psi(x,t)\\}(k)\\right],$$\n其中 $\\mathcal{F}$ 表示空间傅里叶变换，$k$ 是波数。在总时间 $T$ 内，重复应用等效于在傅里叶空间中乘以一次 $e^{-i\\frac{k^2}{2m}T}$。\n\n我们初始化一个归一化的高斯波包\n$$\\psi(x,0)=\\mathcal{N}\\,\\exp\\left[-\\frac{(x-x_0)^2}{4\\sigma^2}\\right]\\exp\\left(i p_0 (x-x_0)\\right),$$\n其中 $x_0=-50$，$p_0=2$，$\\sigma=5$，且选择 $\\mathcal{N}$ 使得 $\\int |\\psi(x,0)|^2 dx$ 的离散近似值等于 $1$。在无撇号坐标系中的传播得到 $\\psi(x,T)$。为了从无撇号坐标系的演化中构造带撇号坐标系的预测，我们需要 $\\psi(x'+vt,T)$，即在平移坐标处求值的无撇号坐标系结果。我们使用傅里叶位移定理高效地计算它：对于任意函数 $f(x)$，\n$$f(x+\\Delta)=\\mathcal{F}^{-1}\\left[e^{ik\\Delta}\\,\\mathcal{F}\\{f\\}(k)\\right].$$\n因此，我们通过谱方法得到 $\\psi(x'+vT,T)$，并乘以推导出的相位因子，得到\n$$\\phi_{\\text{from-lab}}(x',T)=\\exp\\left[-i\\left(m v x'+\\frac{1}{2}m v^2 T\\right)\\right]\\psi(x'+vT,T),$$\n其中 $m=1$。独立地，我们构造经变换的初始状态\n$$\\phi(x',0)=\\exp(-i m v x')\\psi(x',0),$$\n并在带撇号坐标系中进行传播（此处与无撇号坐标系的传播相同，因为自由哈密顿量是形式不变的）。这得到 $\\phi_{\\text{direct}}(x',T)$。\n\n我们通过归一化均方根误差来量化差异\n$$\\varepsilon(v)=\\sqrt{\\frac{\\int | \\phi_{\\text{direct}}(x',T)-\\phi_{\\text{from-lab}}(x',T) |^2\\,dx'}{\\int |\\phi_{\\text{from-lab}}(x',T)|^2\\,dx'}},$$\n其中离散求和近似于积分，即 $\\int \\cdot\\,dx' \\approx \\Delta x \\sum \\cdot$。在精确算术和连续统理论中，对于自由粒子 $\\varepsilon(v)=0$。在数值上，使用谱传播和谱位移方法，在足够大的网格上，并在足够短的时间内以避免周期性边界效应，对于所有指定的测试速度，即 $v=0, v=0.5, v=-0.75, v=1.25$，$\\varepsilon(v)$ 应该接近机器精度。\n\n算法总结：\n- 构建空间网格，在 $[-L/2,L/2)$ 上取 $N=2048$ 个点，其中 $L=400$。通过离散FFT约定，计算整数模式的傅里叶波数 $k=2\\pi n/L$。\n- 构建并归一化初始高斯波包，参数为 $x_0=-50$，$p_0=2$ 和 $\\sigma=5$。\n- 使用精确的自由粒子谱传播算符 $e^{-i k^2 T/2}$，在无撇号坐标系中传播到 $T=10$。\n- 对于每个测试速度 $v\\in\\{0,0.5,-0.75,1.25\\}$：\n  - 使用傅里叶位移定理，取 $\\Delta=vT$ 来计算 $\\psi(x'+vT,T)$。\n  - 通过乘以 $\\exp\\left[-i\\left(v x'+\\frac{1}{2} v^2 T\\right)\\right]$（其中 $m=1$）来构成 $\\phi_{\\text{from-lab}}(x',T)$。\n  - 构成经变换的初始状态 $\\phi(x',0)=\\exp(-i v x')\\psi(x',0)$ 并将其传播以获得 $\\phi_{\\text{direct}}(x',T)$。\n  - 通过离散的归一化均方根误差计算 $\\varepsilon(v)$。\n- 将列表 $[\\varepsilon(0),\\varepsilon(0.5),\\varepsilon(-0.75),\\varepsilon(1.25)]$ 作为单行输出。\n\n由于所有操作都是在谱域中进行的，并且自由粒子传播算符在此表示下是精确的，因此所得误差应该极小，从而验证了自由薛定谔方程在附带推导出的含位置和时间的相位变换下的伽利略不变性。", "answer": "```python\nimport numpy as np\n\ndef gaussian_wavepacket(x, x0, p0, sigma):\n    # Unnormalized minimal-uncertainty Gaussian with mean position x0 and momentum p0\n    psi = np.exp(-((x - x0) ** 2) / (4.0 * sigma ** 2)) * np.exp(1j * p0 * (x - x0))\n    return psi\n\ndef normalize(psi, dx):\n    norm = np.sqrt(np.sum(np.abs(psi) ** 2) * dx)\n    return psi / norm\n\ndef propagate_free_spectral(psi0, k, T, m=1.0):\n    # Exact free-particle spectral propagation over time T: multiply by exp(-i k^2 T / 2m) in k-space\n    psi_k0 = np.fft.fft(psi0)\n    phase = np.exp(-1j * (k ** 2) * T / (2.0 * m))\n    psi_kT = psi_k0 * phase\n    psi_T = np.fft.ifft(psi_kT)\n    return psi_T\n\ndef spectral_shift(psi, k, delta):\n    # Compute psi(x + delta) using the Fourier shift theorem\n    psi_k = np.fft.fft(psi)\n    shifted = np.fft.ifft(psi_k * np.exp(1j * k * delta))\n    return shifted\n\ndef boost_phase(x, v, t, m=1.0, hbar=1.0):\n    # Phase factor for Galilean boost: exp(-i (m v x + (1/2) m v^2 t) / hbar)\n    return np.exp(-1j * (m * v * x + 0.5 * m * v * v * t) / hbar)\n\ndef compute_error(phi_direct, phi_from_lab, dx):\n    num = np.sum(np.abs(phi_direct - phi_from_lab) ** 2) * dx\n    den = np.sum(np.abs(phi_from_lab) ** 2) * dx\n    return float(np.sqrt(num / den))\n\ndef solve():\n    # Parameters (atomic units): hbar = 1, m = 1\n    hbar = 1.0\n    m = 1.0\n    N = 2048\n    L = 400.0\n    dx = L / N\n    # Spatial grid centered at 0 with periodic boundary conditions\n    x = np.linspace(-L / 2.0, L / 2.0, N, endpoint=False)\n    # Fourier wavenumbers consistent with numpy FFT conventions\n    k = 2.0 * np.pi * np.fft.fftfreq(N, d=dx)\n\n    # Initial Gaussian parameters\n    x0 = -50.0\n    p0 = 2.0\n    sigma = 5.0\n\n    # Time parameters\n    T = 10.0  # total propagation time\n\n    # Construct and normalize initial state in lab frame\n    psi0 = gaussian_wavepacket(x, x0, p0, sigma)\n    psi0 = normalize(psi0, dx)\n\n    # Propagate in lab frame to time T\n    psi_lab_T = propagate_free_spectral(psi0, k, T, m=m)\n\n    # Test velocities\n    test_cases = [0.0, 0.5, -0.75, 1.25]\n\n    results = []\n    for v in test_cases:\n        # Expected primed-frame state from lab propagation: phi_from_lab(x', T)\n        psi_shifted = spectral_shift(psi_lab_T, k, v * T)  # psi(x' + v T, T)\n        phase_T = boost_phase(x, v, T, m=m, hbar=hbar)\n        phi_from_lab = phase_T * psi_shifted\n\n        # Direct primed-frame propagation\n        phase_0 = boost_phase(x, v, 0.0, m=m, hbar=hbar)\n        phi0 = phase_0 * psi0  # boosted initial state at t=0\n        phi_direct_T = propagate_free_spectral(phi0, k, T, m=m)\n\n        # Compute normalized RMS error\n        err = compute_error(phi_direct_T, phi_from_lab, dx)\n        results.append(err)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2441280"}, {"introduction": "我们的最终实践将展示分裂算符方法的强大通用性，将其应用范围从线性量子力学扩展到非线性系统。[@problem_id:2441319] 我们将处理描述玻色-爱因斯坦凝聚等系统的格罗斯-皮塔耶夫斯基方程（GPE），其特殊之处在于包含一个与波函数自身概率密度相关的非线性相互作用项 $g|\\psi|^2$。更进一步，你将学习并应用“虚时演化”这一巧妙的计算技巧，它将薛定谔方程转化为一个最终会收敛到系统基态的扩散方程。这项练习不仅让你掌握了求解非线性偏微分方程的强大工具，也为你打开了通往计算凝聚态物理前沿研究的大门。", "problem": "你需要实现一个完整的、可运行的程序，该程序将分裂算符（时间分裂谱）方法应用于一维空间中的非线性Gross-Pitaevskii方程，其中有效势取决于演化中的波函数。你的任务是，对于一小组测试案例，通过归一化虚时演化方法计算所获得的定态的化学势，并按指定格式将结果单行输出。\n\n从一维含时Gross-Pitaevskii方程开始，采用无量纲单位，其中约化普朗克常数和粒子质量均为1，即 $\\hbar = 1$ 和 $m = 1$：\n$$\n\\mathrm{i}\\,\\frac{\\partial \\psi(x,t)}{\\partial t} \\;=\\; \\left[-\\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} \\;+\\; V_{\\mathrm{ext}}(x) \\;+\\; g\\,|\\psi(x,t)|^2 \\right] \\psi(x,t).\n$$\n通过将 $t$ 替换为 $-\\,\\mathrm{i}\\,\\tau$ 在虚时间中演化以获得定态基态，并在每个时间步后对波函数进行归一化，以满足 $\\int |\\psi(x,\\tau)|^2\\,\\mathrm{d}x = 1$。使用一个二阶精度的对称分裂算符格式，该格式在傅里叶空间中的动能算符和实空间中的外势与非线性势之和之间交替进行。使用与有限域上的离散傅里叶变换一致的周期性边界条件。\n\n对于给定的最终归一化态 $\\psi(x)$，使用由定态Gross-Pitaevskii方程所隐含的定义来计算定态解的化学势 $\\mu$：\n$$\n\\mu\\,\\psi(x) \\;=\\; \\left[-\\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} \\;+\\; V_{\\mathrm{ext}}(x) \\;+\\; g\\,|\\psi(x)|^2 \\right]\\psi(x),\n$$\n并将 $\\mu$ 表示为一个根据 $\\psi(x)$ 及其梯度计算出的标量。所有积分必须通过数值网格上适当的黎曼和来近似，并且动能贡献所需的空间导数必须以与所选网格上的傅里叶表示一致的方式计算。\n\n所有量均为无量纲单位，因此你的程序必须以无量纲能量单位输出化学势。\n\n为以下参数集的测试套件实现你的程序，所有测试均在一维空间中进行：\n- 案例 A（线性谐振子，基准检验）：\n  - 外势 $V_{\\mathrm{ext}}(x) = \\tfrac{1}{2}\\,\\omega^2 x^2$，$ \\omega = 1.0$。\n  - 相互作用强度 $g = 0.0$。\n  - 区域长度 $L = 20.0$，采用周期性边界条件，$N = 512$ 个网格点，因此 $\\Delta x = L/N$。\n  - 虚时间步长 $\\Delta \\tau = 0.001$，步数 $N_{\\mathrm{steps}} = 2500$。\n  - 初始波函数：归一化高斯函数 $\\psi(x,0) \\propto \\exp\\!\\big(-x^2/(2\\sigma^2)\\big)$，其中 $\\sigma = 1.0$，归一化至 $\\int |\\psi(x,0)|^2\\,\\mathrm{d}x = 1$。\n- 案例 B（排斥性非线性谐振子）：\n  - 外势 $V_{\\mathrm{ext}}(x) = \\tfrac{1}{2}\\,\\omega^2 x^2$，$ \\omega = 1.0$。\n  - 相互作用强度 $g = 1.0$。\n  - 区域长度 $L = 20.0$，采用周期性边界条件，$N = 512$ 个网格点。\n  - 虚时间步长 $\\Delta \\tau = 0.001$，步数 $N_{\\mathrm{steps}} = 2500$。\n  - 初始波函数：归一化高斯函数，$\\sigma = 1.0$，归一化为1。\n- 案例 C（周期性盒子，均匀定态）：\n  - 外势 $V_{\\mathrm{ext}}(x) = 0$。\n  - 相互作用强度 $g = 2.0$。\n  - 区域长度 $L = 10.0$，采用周期性边界条件，$N = 512$ 个网格点。\n  - 虚时间步长 $\\Delta \\tau = 0.001$，步数 $N_{\\mathrm{steps}} = 10$。\n  - 初始波函数：均匀波函数 $\\psi(x,0) = 1/\\sqrt{L}$，使其恰好被归一化。\n\n你的程序必须：\n- 对每个案例，使用虚时间步长上二阶的对称分裂算符格式演化至最终时间，并在每个时间步后进行归一化以保持 $\\int |\\psi|^2\\,\\mathrm{d}x = 1$。\n- 对每个案例，从最终的归一化态计算化学势 $\\mu$。\n- 生成单行输出，其中包含三个结果，形式为方括号内逗号分隔的列表，例如 $\\texttt{[0.500000,1.234567,0.200000]}$，每个值四舍五入到 $6$ 位小数。\n\n约束和实现细节：\n- 空间网格：$x_j = x_{\\min} + j\\,\\Delta x$，其中 $x_{\\min} = -L/2$，$j = 0,1,\\dots,N-1$，且 $\\Delta x = L/N$。\n- 波数：必须使用与离散傅里叶变换和周期性边界条件一致的 $k$-网格来进行动能步和谱导数的计算。\n- 算法必须是完全自包含的，且不得读取任何输入。\n- 你的程序必须计算并按要求的输出格式返回上述三个案例的化学势。\n\n你的最终程序必须是一个完整的、可运行的脚本，只打印一行：一个格式为 $\\texttt{[}\\mu_A,\\mu_B,\\mu_C\\texttt{]}$ 的列表，其中每个条目四舍五入到 $6$ 位小数。", "solution": "该问题要求实现一个数值算法，以找到一维Gross-Pitaevskii方程（GPE）的定态基态，并计算其相关的化学势 $\\mu$。指定的方法是使用二阶对称分裂算符格式的虚时演化。\n\n含时GPE方程如下：\n$$\n\\mathrm{i}\\,\\frac{\\partial \\psi(x,t)}{\\partial t} \\;=\\; \\hat{H}\\psi(x,t) \\;=\\; \\left[-\\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} \\;+\\; V_{\\mathrm{ext}}(x) \\;+\\; g\\,|\\psi(x,t)|^2 \\right] \\psi(x,t)\n$$\n其中质量 $m$ 和约化普朗克常数 $\\hbar$ 均设为1。哈密顿算符 $\\hat{H}$ 由一个动能算符 $\\hat{T} = -\\frac{1}{2}\\frac{\\partial^2}{\\partial x^2}$ 和一个势能算符 $\\hat{V}(x, \\psi) = V_{\\mathrm{ext}}(x) + g\\,|\\psi(x,t)|^2$ 组成，后者包含一个依赖于波函数密度本身的项。\n\n为找到基态，我们采用虚时演化方法。这通过替换 $t \\to -i\\tau$ 实现，将薛定谔方程转换为一个关于虚时变量 $\\tau$ 的扩散型方程：\n$$\n\\frac{\\partial \\psi(x,\\tau)}{\\partial \\tau} \\;=\\; -\\hat{H}\\psi(x,\\tau)\n$$\n此方程在一个小时间步长 $\\Delta\\tau$ 上的形式解为 $\\psi(x, \\tau+\\Delta\\tau) = e^{-\\hat{H}\\Delta\\tau}\\psi(x,\\tau)$。当一个任意初始态按此规则演化时，对应于较高能量本征态的分量比基态分量衰减得更快。通过在每一步重复应用演化算符并重新归一化波函数，该状态会收敛到基态，即 $\\hat{H}$ 的具有最低本征值的本征态。\n\n演化算符 $e^{-\\hat{H}\\Delta\\tau} = e^{-(\\hat{T} + \\hat{V})\\Delta\\tau}$ 难以直接计算，因为动能算符 $\\hat{T}$ 和势能算符 $\\hat{V}$ 不对易（$\\left[\\hat{T}, \\hat{V}\\right] \\neq 0$）。分裂算符方法通过分离动能和势能的演化来近似该演化过程。采用一种二阶精度的对称分裂，也称为Strang分裂：\n$$\ne^{-(\\hat{T} + \\hat{V})\\Delta\\tau} \\approx e^{-\\hat{V}\\Delta\\tau/2} \\, e^{-\\hat{T}\\Delta\\tau} \\, e^{-\\hat{V}\\Delta\\tau/2} + O(\\Delta\\tau^3)\n$$\n该格式在从 $\\tau$ 到 $\\tau + \\Delta\\tau$ 的单个时间步中按算法实现如下：\n\n1.  **势能半步：** 首先，波函数在势能算符下演化半个步长 $\\Delta\\tau/2$。此操作在位置空间中是局域的，相当于一个简单的乘法。对于非线性GPE，必须使用当前状态 $\\psi(x,\\tau)$ 来计算势：\n    $$\n    \\psi'(x) = e^{-(V_{\\mathrm{ext}}(x) + g|\\psi(x,\\tau)|^2)\\Delta\\tau/2} \\psi(x,\\tau)\n    $$\n2.  **动能全步：** 动能算符 $\\hat{T}$ 在动量（或 $k$）空间中是局域的。使用快速傅里叶变换（FFT）可以最有效地执行演化。状态 $\\psi'(x)$ 被变换到傅里叶空间，$\\tilde{\\psi}'(k) = \\mathcal{F}\\{\\psi'(x)\\}$。在此基底下，动能算符是对角的，$\\hat{T}_k = k^2/2$，因此演化是一个乘法：\n    $$\n    \\tilde{\\psi}''(k) = e^{-k^2\\Delta\\tau/2} \\tilde{\\psi}'(k)\n    $$\n    然后将结果变换回位置空间：$\\psi''(x) = \\mathcal{F}^{-1}\\{\\tilde{\\psi}''(k)\\}$。波矢网格 $k_j$ 必须与空间网格 $x_j$ 一致，这可以通过使用 `fftfreq` 函数实现，其中 $k_j = 2\\pi f_j$，$f_j$ 是离散频率。对于长度为 $L$、有 $N$ 个点且网格间距为 $\\Delta x = L/N$ 的空间域，波矢为 $k = 2\\pi \\cdot \\texttt{fftfreq}(N, d=\\Delta x)$。\n\n3.  **势能半步（第二次）：** 最后在势能算符下再演化半个步长 $\\Delta\\tau/2$，完成对称步。使用更新后的波函数 $\\psi''(x)$ 重新计算势，以确保对称性和稳定性：\n    $$\n    \\psi(x, \\tau+\\Delta\\tau)_{\\text{un-norm}} = e^{-(V_{\\mathrm{ext}}(x) + g|\\psi''(x)|^2)\\Delta\\tau/2} \\psi''(x)\n    $$\n4.  **归一化：** 由于虚时演化不保持范数，因此必须在每个完整步骤后对波函数进行重新归一化，以维持物理约束 $\\int |\\psi|^2 dx = 1$。该积分由黎曼和近似：$I = \\sum_j |\\psi_j|^2 \\Delta x$。然后将波函数更新为 $\\psi_j \\to \\psi_j / \\sqrt{I}$。\n\n经过足够多的步数 $N_{\\mathrm{steps}}$ 后，波函数 $\\psi(x)$ 收敛到定态基态。化学势 $\\mu$ 是对应于此状态的本征值，由定态GPE定义：$\\hat{H}\\psi(x) = \\mu\\psi(x)$。$\\mu$ 的值计算为哈密顿算符相对于最终归一化态的期望值：\n$$\n\\mu = \\langle \\psi | \\hat{H} | \\psi \\rangle = \\int \\psi^*(x) \\hat{H} \\psi(x) \\, dx\n$$\n该期望值是三个能量贡献的总和：\n- **动能：** $E_{kin} = \\int \\psi^*(x) \\left(-\\frac{1}{2}\\frac{\\partial^2}{\\partial x^2}\\right) \\psi(x) \\, dx$。这可以在傅里叶空间中高效计算：$E_{kin} = \\int \\tilde{\\psi}^*(k) \\left(\\frac{k^2}{2}\\right) \\tilde{\\psi}(k) \\, dk$。在数值上，这是 $\\sum_j |\\tilde{\\psi}_j|^2 \\frac{k_j^2}{2}$（使用适当的FFT归一化），或者更直接地，通过将动能算符应用于 $\\psi$ 并计算内积：$E_{kin} \\approx \\Delta x \\sum_j \\psi_j^* \\mathcal{F}^{-1}\\{ (k^2/2) \\mathcal{F}\\{\\psi_j\\} \\}$。\n- **外势能：** $E_{pot, ext} = \\int V_{\\mathrm{ext}}(x) |\\psi(x)|^2 \\, dx$。这通过求和 $\\Delta x \\sum_j V_{\\mathrm{ext}}(x_j) |\\psi_j|^2$ 来近似。\n- **相互作用能：** $E_{int} = \\int g |\\psi(x)|^4 \\, dx$。这通过求和 $\\Delta x \\sum_j g |\\psi_j|^4$ 来近似。\n\n化学势是总和 $\\mu = E_{kin} + E_{pot, ext} + E_{int}$。该算法应用于指定的三个测试案例中的每一个，从而得出它们各自的化学势。", "answer": "```python\nimport numpy as np\nfrom scipy.fft import fft, ifft, fftfreq\n\ndef compute_mu(params):\n    \"\"\"\n    Computes the chemical potential for a given Gross-Pitaevskii equation setup\n    using imaginary-time propagation with a split-operator method.\n    \"\"\"\n    L = params[\"L\"]\n    N = params[\"N\"]\n    g = params[\"g\"]\n    V_ext_func = params[\"V_ext_func\"]\n    dt = params[\"dt\"]\n    N_steps = params[\"N_steps\"]\n    psi0_func = params[\"psi0_func\"]\n\n    dx = L / N\n    x = np.linspace(-L / 2, L / 2 - dx, N)\n    k = 2 * np.pi * fftfreq(N, d=dx)\n\n    T_k = 0.5 * k**2\n    kinetic_propagator = np.exp(-T_k * dt)\n    V_ext = V_ext_func(x)\n\n    psi = psi0_func(x).astype(np.complex128)\n    norm_sq = np.sum(np.abs(psi)**2) * dx\n    psi = psi / np.sqrt(norm_sq)\n\n    for _ in range(N_steps):\n        V_eff = V_ext + g * np.abs(psi)**2\n        psi *= np.exp(-V_eff * dt / 2.0)\n\n        psi_k = fft(psi)\n        psi_k *= kinetic_propagator\n        psi = ifft(psi_k)\n\n        V_eff = V_ext + g * np.abs(psi)**2\n        psi *= np.exp(-V_eff * dt / 2.0)\n\n        norm_sq = np.sum(np.abs(psi)**2) * dx\n        psi /= np.sqrt(norm_sq)\n\n    psi_k = fft(psi)\n    E_kin = np.real(np.sum(np.conj(psi) * ifft(T_k * psi_k)) * dx)\n    E_pot_ext = np.sum(V_ext * np.abs(psi)**2) * dx\n    E_int = np.sum(g * np.abs(psi)**4) * dx\n    \n    mu = E_kin + E_pot_ext + E_int\n    return mu\n\ndef solve():\n    params_A = {\n        \"L\": 20.0, \"N\": 512, \"g\": 0.0,\n        \"V_ext_func\": lambda x: 0.5 * (1.0**2) * x**2,\n        \"dt\": 0.001, \"N_steps\": 2500,\n        \"psi0_func\": lambda x: np.exp(-x**2 / (2 * 1.0**2))\n    }\n\n    params_B = {\n        \"L\": 20.0, \"N\": 512, \"g\": 1.0,\n        \"V_ext_func\": lambda x: 0.5 * (1.0**2) * x**2,\n        \"dt\": 0.001, \"N_steps\": 2500,\n        \"psi0_func\": lambda x: np.exp(-x**2 / (2 * 1.0**2))\n    }\n\n    params_C = {\n        \"L\": 10.0, \"N\": 512, \"g\": 2.0,\n        \"V_ext_func\": lambda x: np.zeros_like(x),\n        \"dt\": 0.001, \"N_steps\": 10,\n        \"psi0_func\": lambda x: np.ones_like(x)\n    }\n\n    mu_A = compute_mu(params_A)\n    mu_B = compute_mu(params_B)\n    mu_C = compute_mu(params_C)\n    \n    print(f\"[{mu_A:.6f},{mu_B:.6f},{mu_C:.6f}]\")\n\nsolve()\n```", "id": "2441319"}]}