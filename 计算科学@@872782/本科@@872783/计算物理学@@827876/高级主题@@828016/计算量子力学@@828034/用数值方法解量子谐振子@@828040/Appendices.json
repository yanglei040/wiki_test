{"hands_on_practices": [{"introduction": "我们将从一个基本问题入手：当一个量子谐振子被置于静电场中时会发生什么？这个练习 [@problem_id:2431866] 让你能够通过数值方法计算二次斯塔克效应（Stark effect）。你将学习如何在一个方便的基组（即未受扰动的谐振子本征态）中构建哈密顿量矩阵，并通过对其进行对角化来找到新的能级。这是一种将连续的算符问题转化为有限维矩阵问题的核心技术，是计算量子物理学的基石。", "problem": "考虑一个一维量子谐振子 (QHO)，其质量为 $m$，角频率为 $\\omega$，粒子电荷为 $q$，受到沿坐标 $x$ 方向、大小为 $\\mathcal{E}$ 的空间均匀静电场的作用。其哈密顿量由下式给出\n$$\n\\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2} m \\omega^2 \\hat{x}^2 - q \\mathcal{E}\\,\\hat{x}.\n$$\n在无量纲谐振子单位制下进行计算，该单位制定义为令 $\\hbar=1$、$m=1$、$\\omega=1$ 和 $q=1$。在此单位制中，能量以 $\\hbar\\omega$ 为单位，长度以 $\\sqrt{\\hbar/(m\\omega)}$ 为单位，电场强度 $\\mathcal{E}$ 是无量纲的。在此单位制下，未受扰动的量子谐振子的本征能量为 $E_n^{(0)} = n + \\tfrac{1}{2}$，其中 $n \\in \\{0,1,2,\\dots\\}$。\n\n您的任务是，对于给定的有限基底大小 $N$ 和场强 $\\mathcal{E}$，计算最低 $k$ 个谐振子能级的数值能量位移 $\\Delta E_n^{\\text{num}}(\\mathcal{E}) = E_n(\\mathcal{E}) - E_n^{(0)}$，并将其与弱场微扰理论预测的二次斯塔克位移进行比较，在此单位制下，对所有 $n$ 该位移为 $\\Delta E_n^{\\text{pert}}(\\mathcal{E}) = -\\tfrac{\\mathcal{E}^2}{2}$。对于每个指定的测试用例 $(\\mathcal{E}, N, k)$，计算前 $k$ 个能级的最大绝对偏差\n$$\n\\varepsilon_{\\max} = \\max_{0 \\le n \\le k-1} \\left| \\Delta E_n^{\\text{num}}(\\mathcal{E}) - \\Delta E_n^{\\text{pert}}(\\mathcal{E}) \\right|,\n$$\n并以无量纲能量单位表示。\n\n使用以下参数值测试套件，这些测试共同探测了零场边界情况、弱场一致性、更大基底下改进的收敛性以及一个截断压力边缘情况：\n- 测试 1：$(\\mathcal{E}, N, k) = (0.0, 20, 5)$。\n- 测试 2：$(\\mathcal{E}, N, k) = (0.05, 20, 5)$。\n- 测试 3：$(\\mathcal{E}, N, k) = (0.2, 30, 5)$。\n- 测试 4：$(\\mathcal{E}, N, k) = (1.0, 12, 5)$。\n\n您的程序必须输出一行，其中包含上述四个测试的 $\\varepsilon_{\\max}$ 值，形式为方括号内以逗号分隔的列表，每个值四舍五入到小数点后 $10$ 位，例如 $[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\varepsilon_4]$。在指定单位制中，所有量都是无量纲的，因此无需报告物理单位。角度未出现，因此不需要角度单位。不使用百分比；任何分数量必须表示为小数或分数，不带百分号。", "solution": "所述问题是有效的。这是一个计算量子力学中的适定问题，它具有科学依据、客观性，并包含求解所需的所有必要信息。我们将着手解决它。\n\n任务是求解在一维量子谐振子 (QHO) 受到静电场影响下的能级。该系统的哈密顿量由下式给出：\n$$\n\\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2} m \\omega^2 \\hat{x}^2 - q \\mathcal{E}\\,\\hat{x}\n$$\n我们在无量纲单位制下工作，其中 $\\hbar=1$、$m=1$、$\\omega=1$ 和 $q=1$。哈密顿量简化为：\n$$\n\\hat{H} = \\left(\\frac{\\hat{p}^2}{2} + \\frac{1}{2} \\hat{x}^2\\right) - \\mathcal{E}\\,\\hat{x} = \\hat{H}_0 + \\hat{V}\n$$\n其中 $\\hat{H}_0$ 是未受扰动的 QHO 的哈密顿量，而 $\\hat{V} = -\\mathcal{E}\\hat{x}$ 是由电场 $\\mathcal{E}$ 引起的微扰势。\n\n解决此类问题的标准数值方法是将哈密顿量表示为在合适基底下的矩阵，然后求其本征值。自然选择的基底是未受扰动的哈密顿量的本征态集合 $\\{|n\\rangle\\}$，其中 $n \\in \\{0, 1, 2, \\dots\\}$。这些态满足 $\\hat{H}_0|n\\rangle = E_n^{(0)}|n\\rangle$，其未受扰动的能量为 $E_n^{(0)} = n + \\frac{1}{2}$。\n\n在实践中，我们必须将这个无限维基底截断到一个有限大小，比如 $N$。因此，我们将在截断基底 $\\{|0\\rangle, |1\\rangle, \\dots, |N-1\\rangle\\}$ 中工作。哈密顿量由一个 $N \\times N$ 矩阵表示，其矩阵元为 $H_{m,n} = \\langle m|\\hat{H}|n\\rangle$。\n\n矩阵元的计算如下：\n$$\nH_{m,n} = \\langle m|\\hat{H}_0|n\\rangle + \\langle m|\\hat{V}|n\\rangle = E_n^{(0)}\\delta_{m,n} - \\mathcal{E}\\langle m|\\hat{x}|n\\rangle\n$$\n为了找到位置算符 $\\hat{x}$ 的矩阵元，我们用下降算符 ($\\hat{a}$) 和上升算符 ($\\hat{a}^\\dagger$) 来表示它。在我们选择的单位制中，$\\hat{x} = \\frac{1}{\\sqrt{2}}(\\hat{a} + \\hat{a}^\\dagger)$。这些算符对基态的作用是众所周知的：\n$$\n\\hat{a}|n\\rangle = \\sqrt{n}|n-1\\rangle \\quad \\text{和} \\quad \\hat{a}^\\dagger|n\\rangle = \\sqrt{n+1}|n+1\\rangle\n$$\n这导出了 $\\hat{x}$ 的矩阵元：\n$$\n\\langle m|\\hat{x}|n\\rangle = \\frac{1}{\\sqrt{2}} \\left( \\sqrt{n}\\langle m|n-1\\rangle + \\sqrt{n+1}\\langle m|n+1\\rangle \\right) = \\frac{1}{\\sqrt{2}} \\left( \\sqrt{n}\\delta_{m,n-1} + \\sqrt{n+1}\\delta_{m,n+1} \\right)\n$$\n唯一的非零元素位于次对角线 ($m=n-1$) 和超对角线 ($m=n+1$) 上。\n\n因此，完整的哈密顿矩阵 $H$ 是一个实对称三对角矩阵，其矩阵元对于 $m,n \\in \\{0, 1, \\dots, N-1\\}$ 如下：\n- 对角元：$H_{n,n} = E_n^{(0)} = n + \\frac{1}{2}$\n- 非对角元：$H_{n,n+1} = H_{n+1,n} = -\\mathcal{E} \\langle n|\\hat{x}|n+1\\rangle = -\\mathcal{E} \\sqrt{\\frac{n+1}{2}}$\n\n数值能级 $E_n^{\\text{num}}(\\mathcal{E})$ 是这个 $N \\times N$ 矩阵的本征值。我们的任务是计算这些本征值中最低的 $k$ 个。\n\n问题要求将数值能量位移 $\\Delta E_n^{\\text{num}}(\\mathcal{E}) = E_n^{\\text{num}}(\\mathcal{E}) - E_n^{(0)}$ 与二阶微扰理论的结果 $\\Delta E_n^{\\text{pert}}(\\mathcal{E}) = -\\frac{\\mathcal{E}^2}{2}$ 进行比较。一个重要的物理洞察是，对于这个特定系统，微扰理论的结果实际上是精确的。这可以通过对哈密顿量中的势能项进行配方看出来：\n$$\nV(\\hat{x}) = \\frac{1}{2}\\hat{x}^2 - \\mathcal{E}\\hat{x} = \\frac{1}{2}(\\hat{x}^2 - 2\\mathcal{E}\\hat{x} + \\mathcal{E}^2) - \\frac{\\mathcal{E}^2}{2} = \\frac{1}{2}(\\hat{x} - \\mathcal{E})^2 - \\frac{\\mathcal{E}^2}{2}\n$$\n完整的哈密顿量是 $\\hat{H} = \\frac{\\hat{p}^2}{2} + \\frac{1}{2}(\\hat{x} - \\mathcal{E})^2 - \\frac{\\mathcal{E}^2}{2}$。这是一个势能最小值从 $x=0$ 平移到 $x=\\mathcal{E}$ 的 QHO 的哈密顿量，外加一个值为 $-\\frac{\\mathcal{E}^2}{2}$ 的恒定能量偏移。简单的坐标平移不会改变相对于新最小值的能谱。因此，精确的能量本征值为 $E_n(\\mathcal{E}) = (n + \\frac{1}{2}) - \\frac{\\mathcal{E}^2}{2}$。\n\n因此，精确的能量位移为 $\\Delta E_n^{\\text{exact}}(\\mathcal{E}) = E_n(\\mathcal{E}) - E_n^{(0)} = -\\frac{\\mathcal{E}^2}{2}$，这与为 $\\Delta E_n^{\\text{pert}}(\\mathcal{E})$ 提供的公式相同。因此，要计算的量\n$$\n\\varepsilon_{\\max} = \\max_{0 \\le n \\le k-1} \\left| \\Delta E_n^{\\text{num}}(\\mathcal{E}) - \\Delta E_n^{\\text{pert}}(\\mathcal{E}) \\right|\n$$\n代表了对最低 $k$ 个态使用数值对角化方法产生的最大绝对误差，该误差源于将无限维希尔伯特空间截断为大小为 $N$ 的有限基底。\n\n每个测试用例 $(\\mathcal{E}, N, k)$ 的计算步骤如下：\n1.  对于给定的基底大小 $N$，构建三对角哈密顿矩阵的对角元和非对角元。\n2.  如果 $\\mathcal{E}=0$，矩阵是纯对角的，因此 $E_n^{\\text{num}} = n+\\frac{1}{2}$。位移 $\\Delta E_n^{\\text{num}}$ 和 $\\Delta E_n^{\\text{pert}}$ 均为零，所以 $\\varepsilon_{\\max}=0$。\n3.  如果 $\\mathcal{E} \\neq 0$，使用高效的数值算法，例如 `scipy.linalg.eigh_tridiagonal`，来计算 $N \\times N$ 矩阵的最低 $k$ 个本征值。这些是 $n=0, \\dots, k-1$ 时的 $E_n^{\\text{num}}(\\mathcal{E})$。\n4.  计算这 $k$ 个能级的数值位移 $\\Delta E_n^{\\text{num}}(\\mathcal{E}) = E_n^{\\text{num}}(\\mathcal{E}) - (n+\\frac{1}{2})$。\n5.  计算每个能级与精确位移的偏差：$|\\Delta E_n^{\\text{num}}(\\mathcal{E}) - (-\\frac{\\mathcal{E}^2}{2})|$。\n6.  结果 $\\varepsilon_{\\max}$ 是这 $k$ 个偏差中的最大值。\n将实施此程序来评估指定的测试用例。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Solves the quantum harmonic oscillator in a static electric field problem\n    by numerical diagonalization and compares it to the exact result.\n    \"\"\"\n    # Test cases: (Electric Field E, Basis Size N, Number of levels k)\n    test_cases = [\n        (0.0, 20, 5),\n        (0.05, 20, 5),\n        (0.2, 30, 5),\n        (1.0, 12, 5),\n    ]\n\n    results = []\n\n    for E_field, N, k in test_cases:\n        # For a zero field, the Hamiltonian matrix is already diagonal.\n        # The eigenvalues are exactly the unperturbed ones, so the numerical\n        # shift is zero. The perturbative shift is also zero.\n        # Thus, the deviation is exactly zero.\n        if E_field == 0.0:\n            eps_max = 0.0\n            results.append(f\"{eps_max:.10f}\")\n            continue\n\n        # Construct the components of the tridiagonal Hamiltonian matrix.\n        # H_nn = n + 0.5\n        diag = np.arange(N, dtype=float) + 0.5\n        \n        # H_{n, n+1} = -E * sqrt((n+1)/2)\n        off_diag = -E_field * np.sqrt((np.arange(N - 1, dtype=float) + 1.0) / 2.0)\n\n        # Diagonalize the tridiagonal Hamiltonian to find the lowest k eigenvalues.\n        # The 'select' and 'select_range' arguments allow for an efficient\n        # calculation of only the desired subset of eigenvalues.\n        E_num = eigh_tridiagonal(\n            diag, off_diag, eigvals_only=True, select='i', select_range=(0, k - 1)\n        )\n\n        # Unperturbed energies for the lowest k levels.\n        E0 = np.arange(k, dtype=float) + 0.5\n\n        # Numerical energy shift for each level.\n        delta_E_num = E_num - E0\n\n        # The \"perturbative\" shift is exact for the QHO Stark effect.\n        delta_E_pert = -E_field**2 / 2.0\n\n        # Calculate the absolute deviation for each of the k levels.\n        deviations = np.abs(delta_E_num - delta_E_pert)\n\n        # Find the maximum deviation among the k levels.\n        eps_max = np.max(deviations)\n\n        # Store the result formatted to 10 decimal places.\n        results.append(f\"{eps_max:.10f}\")\n\n    # Print the final list of results in the required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2431866"}, {"introduction": "从一维系统过渡到高维系统会引入新的物理现象，例如简并。在这个练习 [@problem_id:2431837] 中，你将探索一个二维各向同性谐振子，并观察一个微扰势 $V_{\\mathrm{pert}} = \\epsilon x y$ 如何解除第一激发态的能量简并。与上一个练习中的基组展开法不同，你将使用有限差分法，在空间网格上离散化薛定谔方程，这是一种求解偏微分方程的强大通用技术。", "problem": "构建一个完整的程序，对于一个二维各向同性量子谐振子 (QHO)，数值计算微扰 $V_{\\mathrm{pert}} = \\epsilon \\, x y$ 如何消除第一激发态的简并。在自然单位制中进行计算，其中约化普朗克常数 $\\hbar = 1$，粒子质量 $m = 1$，振子角频率 $\\omega = 1$，使得能量以 $\\hbar \\omega$ 为单位表示，长度以 $\\sqrt{\\hbar/(m \\omega)}$ 为单位表示。未受微扰的哈密顿量为 $H_{0} = -\\tfrac{1}{2} \\nabla^{2} + \\tfrac{1}{2}\\left(x^{2} + y^{2}\\right)$，受微扰的哈密顿量为 $H = H_{0} + \\epsilon \\, x y$。考虑定义在整个平面 $\\mathbb{R}^{2}$ 上的定态薛定谔方程 $H \\psi = E \\psi$。\n\n为了使问题在数值上适定，将定义域近似为一个正方形 $[-L, L] \\times [-L, L]$，并在此正方形的边界上施加边界条件 $\\psi = 0$。沿每个坐标方向使用具有 $N$ 个内部点的均匀网格。对于下面列出的每组参数，计算高于基态能量的两个最低能量本征值，即离散哈密顿量的第二小和第三小本征值，并按升序报告它们。所有能量均以 $\\hbar \\omega$ 为单位表示，并四舍五入到六位小数的浮点数。\n\n使用的测试用例参数集 $(L, N, \\epsilon)$ 如下：\n- 情况 A：$(L, N, \\epsilon) = (6.0, 80, 0.10)$。\n- 情况 B：$(L, N, \\epsilon) = (6.0, 80, 0.00)$。\n- 情况 C：$(L, N, \\epsilon) = (6.0, 80, -0.08)$。\n- 情况 D：$(L, N, \\epsilon) = (4.0, 64, 0.10)$。\n\n你的程序必须生成单行输出，其中包含所有情况的汇总结果，格式为一个逗号分隔的列表的列表，每个内部列表按升序包含该情况的两个能量值。确切的输出格式要求如下：\n\"[[E_A_2,E_A_3],[E_B_2,E_B_3],[E_C_2,E_C_3],[E_D_2,E_D_3]]\"\n其中 $E_{\\cdot,2}$ 和 $E_{\\cdot,3}$ 表示每种情况下的第二小和第三小本征值。每个打印出的能量值必须四舍五入到六位小数。输出行中不得包含任何额外文本。", "solution": "所提出的问题是一个有效的计算物理练习。它要求对一个受微扰的二维量子谐振子 (QHO) 的定态薛定谔方程进行数值求解。所有参数和数值规格均已提供，且问题在科学上是合理的、适定的和客观的。\n\n在指定的自然单位制（$\\hbar=1$，$m=1$，$ \\omega=1$）下，二维各向同性量子谐振子的未受微扰哈密顿量由下式给出：\n$$\nH_0 = -\\frac{1}{2} \\nabla^2 + \\frac{1}{2}(x^2 + y^2)\n$$\n该系统的能量本征值是解析已知的：\n$$\nE_{n_x, n_y} = (n_x + \\frac{1}{2}) + (n_y + \\frac{1}{2}) = n_x + n_y + 1\n$$\n其中 $n_x, n_y = 0, 1, 2, \\dots$ 是量子数。基态 ($n_x=0, n_y=0$) 的能量为 $E_0=1$ 且非简并。第一激发态可以通过两种方式形成，即 $(n_x, n_y) = (1, 0)$ 或 $(n_x, n_y) = (0, 1)$。这两个态具有相同的能量 $E_1 = 2$，因此第一激发能级是二重简并的。\n\n引入微扰 $V_{\\mathrm{pert}} = \\epsilon x y$，得到总哈密顿量：\n$$\nH = H_0 + V_{\\mathrm{pert}} = -\\frac{1}{2} \\nabla^2 + \\frac{1}{2}(x^2 + y^2) + \\epsilon x y\n$$\n根据简并微扰理论，该微扰将消除第一激发态的简并。能量的移动量是在简并本征态基底下计算的微扰矩阵的本征值。对能级的一阶修正为 $\\Delta E = \\pm \\frac{\\epsilon}{2}$。因此，两个新的能级预计为 $E' \\approx 2 \\pm \\frac{\\epsilon}{2}$。这个理论结果为我们的数值解提供了一个基准。\n\n为了数值求解本征值问题 $H\\psi = E\\psi$，我们在有限区域上对问题进行离散化。连续平面 $\\mathbb{R}^2$ 被一个带有狄利克雷边界条件（即在边界上 $\\psi=0$）的正方形 $[-L, L] \\times [-L, L]$ 所替代。该区域被离散化为一个每个方向有 $N$ 个内部点的均匀网格。网格间距为 $h = \\frac{2L}{N+1}$。内部格点为 $(x_i, y_j)$，其中 $x_i = -L+i h$ 且 $y_j = -L+j h$，对于 $i,j \\in \\{1, 2, \\dots, N\\}$。\n\n拉普拉斯算子 $\\nabla^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ 使用五点中心差分格式进行近似：\n$$\n\\nabla^2 \\psi(x_i, y_j) \\approx \\frac{\\psi_{i+1,j} + \\psi_{i-1,j} + \\psi_{i,j+1} + \\psi_{i,j-1} - 4\\psi_{i,j}}{h^2}\n$$\n其中 $\\psi_{i,j} = \\psi(x_i, y_j)$。将此代入薛定谔方程，得到一个关于 $N^2$ 个内部格点上 $\\psi$ 值的线性方程组。这可以被表述为一个矩阵本征值问题，$H_{\\text{matrix}} \\vec{\\psi} = E \\vec{\\psi}$。\n\n状态向量 $\\vec{\\psi}$ 是一个大小为 $N^2$ 的一维向量，通过将波函数值 $\\psi_{i,j}$ 的二维网格“扁平化”得到。哈密顿矩阵 $H_{\\text{matrix}}$ 是一个 $N^2 \\times N^2$ 的矩阵。它由动能部分 $T_{\\text{matrix}}$ 和势能部分 $V_{\\text{matrix}}$ 组成。\n\n动能矩阵 $T_{\\text{matrix}}$ 是一个稀疏矩阵，表示离散化的算子 $-\\frac{1}{2}\\nabla^2$。它可以巧妙地通过一维拉普拉斯矩阵的克罗内克和来构建。设 $T_{1D}$ 为表示一维二阶导数的 $N \\times N$ 三对角矩阵：\n$$\nT_{1D} = \\begin{pmatrix}\n2  & -1   &        \\\\\n-1 &  2  & -1  &   \\\\\n   & \\ddots & \\ddots & \\ddots \\\\\n   &        &  -1 & 2\n\\end{pmatrix}\n$$\n动能矩阵则为：\n$$\nT_{\\text{matrix}} = \\frac{1}{2h^2} (T_{1D} \\otimes I_N + I_N \\otimes T_{1D})\n$$\n其中 $I_N$ 是 $N \\times N$ 的单位矩阵，$\\otimes$ 是克罗内克积。\n\n势能矩阵 $V_{\\text{matrix}}$ 是一个对角矩阵，其对角线元素是在 $N^2$ 个格点上每个点的势能 $V(x,y) = \\frac{1}{2}(x^2+y^2) + \\epsilon x y$ 的值：\n$$\n(V_{\\text{matrix}})_{k,k} = \\frac{1}{2}(x_i^2+y_j^2) + \\epsilon x_i y_j\n$$\n其中单个索引 $k$ 对应于格点 $(i,j)$。\n\n完整的哈密顿矩阵为 $H_{\\text{matrix}} = T_{\\text{matrix}} + V_{\\text{matrix}}$。这是一个大型、稀疏且对称（厄米）的矩阵。我们需要找到它的本征值。问题要求的是第二小和第三小的本征值。这些可以通过迭代算法（例如 `scipy.sparse.linalg.eigs` 中实现的算法）高效地计算，而无需构建完整的稠密矩阵。我们请求 $k=3$ 个绝对值最小 ('SM') 的本征值。由于对于给定的参数 ($|\\epsilon| < 1$)，哈密顿量是正定的，因此这对应于三个最低的能量本征值。然后对结果进行排序，并选取第二和第三个值。对每组参数 $(L, N, \\epsilon)$ 重复此过程。", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import diags, kronsum\nfrom scipy.sparse.linalg import eigs\n\ndef compute_energies(L, N, epsilon):\n    \"\"\"\n    Computes the second and third smallest eigenvalues of the 2D QHO Hamiltonian.\n\n    Args:\n        L (float): The half-width of the square domain [-L, L] x [-L, L].\n        N (int): The number of interior grid points along each coordinate.\n        epsilon (float): The strength of the perturbation potential.\n\n    Returns:\n        list[float]: A list containing the second and third smallest eigenvalues.\n    \"\"\"\n    # 1. Define grid parameters\n    h = 2.0 * L / (N + 1)\n    \n    # 2. Create coordinates for interior grid points\n    grid_coords_1d = np.linspace(-L + h, L - h, N)\n    xx, yy = np.meshgrid(grid_coords_1d, grid_coords_1d)\n    \n    # Flatten coordinates for potential matrix construction\n    x_flat = xx.flatten()\n    y_flat = yy.flatten()\n\n    # 3. Construct the potential energy matrix (V_matrix)\n    V_flat = 0.5 * (x_flat**2 + y_flat**2) + epsilon * x_flat * y_flat\n    V_matrix = diags([V_flat], [0], shape=(N**2, N**2), format='csc')\n\n    # 4. Construct the kinetic energy matrix (T_matrix)\n    # Construct the 1D second derivative matrix\n    diag_1d = np.full(N, 2.0)\n    offdiag_1d = np.full(N-1, -1.0)\n    T_1d = diags([offdiag_1d, diag_1d, offdiag_1d], [-1, 0, 1], shape=(N, N), format='csc')\n    \n    # Use Kronecker sum to get the 2D Laplacian, then scale for kinetic energy\n    # T_matrix = (1 / (2 * h**2)) * (T_1d ⊗ I + I ⊗ T_1d)\n    T_matrix = (0.5 / h**2) * kronsum(T_1d, T_1d, format='csc')\n    \n    # 5. Construct the total Hamiltonian matrix\n    H_matrix = T_matrix + V_matrix\n\n    # 6. Find the 3 lowest eigenvalues\n    # 'SM' finds eigenvalues with the smallest magnitude. Since H is positive definite,\n    # these are the smallest eigenvalues.\n    # The matrix H_matrix is symmetric, so eigenvalues will be real.\n    num_eigenvalues = 3\n    eigenvalues = eigs(H_matrix, k=num_eigenvalues, which='SM', return_eigenvectors=False)\n    \n    # Sort the real parts of the eigenvalues in ascending order\n    sorted_eigenvalues = np.sort(np.real(eigenvalues))\n\n    # 7. Return the second and third eigenvalues\n    return [sorted_eigenvalues[1], sorted_eigenvalues[2]]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N, epsilon)\n        (6.0, 80, 0.10),   # Case A\n        (6.0, 80, 0.00),   # Case B\n        (6.0, 80, -0.08),  # Case C\n        (4.0, 64, 0.10),   # Case D\n    ]\n\n    results = []\n    for L, N, epsilon in test_cases:\n        energies = compute_energies(L, N, epsilon)\n        results.append(energies)\n\n    # Format the output string as specified\n    result_strings = []\n    for e_pair in results:\n        # Round each energy to six decimal places\n        e2_str = f\"{e_pair[0]:.6f}\"\n        e3_str = f\"{e_pair[1]:.6f}\"\n        result_strings.append(f\"[{e2_str},{e3_str}]\")\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\n# Execute the solver\nsolve()\n```", "id": "2431837"}, {"introduction": "当系统的复杂性增加时，确定性方法（如矩阵对角化）的计算成本会急剧上升。为了应对这一挑战，我们转向一种完全不同的范式：随机方法。这个练习 [@problem_id:2431867] 将指导你使用变分蒙特卡洛（Variational Monte Carlo, VMC）方法，这是一种基于量子力学变分原理和统计抽样的强大技术。你将通过对一个试探波函数进行优化，来估算谐振子的基态能量，从而掌握一种可扩展到复杂多体系统的现代计算物理学核心技能。", "problem": "考虑一个一维量子谐振子，其哈密顿量为\n$$\n\\hat{H} = -\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2} + \\frac{1}{2} m \\omega^2 x^2,\n$$\n其中 $m$ 是质量，$\\omega$ 是角频率，$\\hbar$ 是约化普朗克常数。设试探波函数为\n$$\n\\psi_T(x,\\alpha) = e^{-\\alpha x^2},\n$$\n其中 $\\alpha \\gt 0$ 是一个变分参数。对于给定的 $\\alpha$，变分能量泛函为\n$$\nE(\\alpha) = \\frac{\\int_{-\\infty}^{\\infty} \\psi_T(x,\\alpha) \\, \\hat{H} \\, \\psi_T(x,\\alpha) \\, dx}{\\int_{-\\infty}^{\\infty} |\\psi_T(x,\\alpha)|^2 \\, dx}.\n$$\n定义概率密度\n$$\n\\rho_\\alpha(x) \\propto |\\psi_T(x,\\alpha)|^2 = e^{-2\\alpha x^2},\n$$\n以及相应的局域能量\n$$\nE_L(x;\\alpha) = \\frac{\\hat{H}\\psi_T(x,\\alpha)}{\\psi_T(x,\\alpha)}.\n$$\n变分能量可以表示为期望值\n$$\nE(\\alpha) = \\mathbb{E}_{x \\sim \\rho_\\alpha}[E_L(x;\\alpha)].\n$$\n在本问题中，你必须通过从 $\\rho_\\alpha(x)$ 进行统计抽样来数值估计 $E(\\alpha)$，并在指定区间内确定使该估计值最小的 $\\alpha$ 值。在整个计算过程中，使用自然单位制，令 $\\hbar = 1$。所有能量均以该单位制报告，并且所有报告的浮点数均四舍五入到6位小数。\n\n对于下述测试套件中的每个测试用例，通过在闭区间 $[\\alpha_{\\min}, \\alpha_{\\max}]$ 上的一个包含 $N_\\alpha$ 个点的均匀网格上计算 $E(\\alpha)$ 来估计最小化 $\\alpha$，并选择具有最小估计能量的网格点。对于每个网格点 $\\alpha$，通过计算从 $\\rho_\\alpha(x) \\propto e^{-2\\alpha x^2}$ 中抽取的 $N_{\\text{samples}}$ 个独立样本 $x$ 的 $E_L(x;\\alpha)$ 的算术平均值来近似 $E(\\alpha)$。在生成独立样本时，请使用提供的随机种子以保证可复现性。对于每个测试用例，输出数对 $[\\alpha_{\\text{opt}}, E(\\alpha_{\\text{opt}})]$，其中 $\\alpha_{\\text{opt}}$ 是最小化的网格值。\n\n使用以下测试套件。对于每个用例，参数以 $(m,\\omega,\\alpha_{\\min},\\alpha_{\\max},N_\\alpha,N_{\\text{samples}},\\text{seed})$ 的形式给出：\n- 用例 $1$：$(m=\\;1.0,\\;\\omega=\\;1.0,\\;\\alpha_{\\min}=\\;0.2,\\;\\alpha_{\\max}=\\;1.0,\\;N_\\alpha=\\;41,\\;N_{\\text{samples}}=\\;50000,\\;\\text{seed}=\\;12345)$。\n- 用例 $2$：$(m=\\;2.0,\\;\\omega=\\;0.5,\\;\\alpha_{\\min}=\\;0.2,\\;\\alpha_{\\max}=\\;0.9,\\;N_\\alpha=\\;36,\\;N_{\\text{samples}}=\\;50000,\\;\\text{seed}=\\;24680)$。\n- 用例 $3$：$(m=\\;0.5,\\;\\omega=\\;3.0,\\;\\alpha_{\\min}=\\;0.3,\\;\\alpha_{\\max}=\\;1.2,\\;N_\\alpha=\\;46,\\;N_{\\text{samples}}=\\;50000,\\;\\text{seed}=\\;98765)$。\n- 用例 $4$ （样本较少的边界情况）：$(m=\\;1.0,\\;\\omega=\\;2.0,\\;\\alpha_{\\min}=\\;0.5,\\;\\alpha_{\\max}=\\;1.5,\\;N_\\alpha=\\;26,\\;N_{\\text{samples}}=\\;5000,\\;\\text{seed}=\\;13579)$。\n\n最终输出格式：您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表。其中每个测试用例贡献一个双元素列表 $[\\alpha_{\\text{opt}}, E(\\alpha_{\\text{opt}})]$，两个条目均四舍五入到6位小数。例如，包含两个用例的输出将类似于 $[[\\alpha_1,E_1],[\\alpha_2,E_2]]$，并用数值替换。在本问题中，输出必须是包含按上述用例顺序排列的四个此类数对的单行。", "solution": "所给问题是计算量子物理中的一个标准练习，具体而言是应用变分蒙特卡洛 (VMC) 方法来确定一维量子谐振子的基态能量。在继续之前，有必要进行严谨的验证。\n\n该问题基于量子力学变分原理，使用高斯试探波函数 $\\psi_T(x, \\alpha) = e^{-\\alpha x^2}$。该方法涉及通过统计抽样的方式，数值计算表示为组态空间上积分的哈密顿量期望值。所有组成部分——哈密顿量、试探波函数、变分能量泛函 $E(\\alpha)$ 的定义，以及将其重构为局域能量 $E_L(x; \\alpha)$ 期望值的形式——都是标准的且在科学上是合理的。参数和目标都以足够的精度指定，且没有内部矛盾。因此，该问题被认为是**有效**的，可以构建一个解。\n\n该方法论的核心是为一组变分参数 $\\alpha$ 计算变分能量 $E(\\alpha)$。该能量被定义为局域能量 $E_L(x;\\alpha)$ 在概率分布 $\\rho_\\alpha(x) \\propto |\\psi_T(x,\\alpha)|^2$ 上的期望值。\n\n首先，我们必须推导局域能量 $E_L(x;\\alpha)$ 的解析表达式。局域能量定义为：\n$$\nE_L(x;\\alpha) = \\frac{\\hat{H}\\psi_T(x,\\alpha)}{\\psi_T(x,\\alpha)}\n$$\n哈密顿量为 $\\hat{H} = -\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2} + \\frac{1}{2} m \\omega^2 x^2$。试探波函数为 $\\psi_T(x,\\alpha) = e^{-\\alpha x^2}$。我们计算 $\\psi_T$ 的必要导数：\n$$\n\\frac{d\\psi_T}{dx} = -2\\alpha x e^{-\\alpha x^2}\n$$\n$$\n\\frac{d^2\\psi_T}{dx^2} = \\frac{d}{dx}(-2\\alpha x e^{-\\alpha x^2}) = -2\\alpha e^{-\\alpha x^2} + 4\\alpha^2 x^2 e^{-\\alpha x^2} = (4\\alpha^2 x^2 - 2\\alpha)e^{-\\alpha x^2}\n$$\n将哈密顿算符 $\\hat{H}$ 应用于 $\\psi_T$ 得到：\n$$\n\\hat{H}\\psi_T(x,\\alpha) = -\\frac{\\hbar^2}{2m}(4\\alpha^2 x^2 - 2\\alpha)e^{-\\alpha x^2} + \\frac{1}{2} m \\omega^2 x^2 e^{-\\alpha x^2}\n$$\n$$\n\\hat{H}\\psi_T(x,\\alpha) = \\left(\\frac{\\hbar^2\\alpha}{m} - \\frac{2\\hbar^2\\alpha^2}{m} x^2 + \\frac{1}{2} m \\omega^2 x^2 \\right) e^{-\\alpha x^2}\n$$\n除以 $\\psi_T(x,\\alpha) = e^{-\\alpha x^2}$ 得到局域能量：\n$$\nE_L(x;\\alpha) = \\frac{\\hbar^2\\alpha}{m} + \\left(\\frac{1}{2} m \\omega^2 - \\frac{2\\hbar^2\\alpha^2}{m}\\right)x^2\n$$\n根据问题陈述，我们在自然单位制中工作，其中 $\\hbar = 1$。表达式简化为：\n$$\nE_L(x;\\alpha) = \\frac{\\alpha}{m} + \\left(\\frac{1}{2} m \\omega^2 - \\frac{2\\alpha^2}{m}\\right)x^2\n$$\n这 就是在抽样位置 $x$ 处要求值的函数。\n\n接下来，我们讨论抽样过程。变分能量 $E(\\alpha)$ 是 $E_L(x;\\alpha)$ 关于概率密度 $\\rho_\\alpha(x) \\propto |\\psi_T(x,\\alpha)|^2 = e^{-2\\alpha x^2}$ 的期望值。这个密度函数对应于均值 $\\mu = 0$ 的正态（高斯）分布。正态分布 $N(\\mu, \\sigma^2)$ 的概率密度函数是 $\\frac{1}{\\sqrt{2\\pi\\sigma^2}}e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}$。对于 $\\mu=0$，比较其指数项：\n$$\n-2\\alpha x^2 = -\\frac{x^2}{2\\sigma^2}\n$$\n由此，我们推断出抽样分布的方差：$2\\alpha = \\frac{1}{2\\sigma^2}$，这意味着 $\\sigma^2 = \\frac{1}{4\\alpha}$。因此，标准差为 $\\sigma = \\frac{1}{2\\sqrt{\\alpha}}$。这是一个关键结果：要从 $\\rho_\\alpha(x)$ 中抽样，必须从均值为 $0$、标准差为 $\\frac{1}{2\\sqrt{\\alpha}}$ 的正态分布中生成随机数。\n\n对于一个给定的测试用例 $(m, \\omega, \\alpha_{\\min}, \\alpha_{\\max}, N_\\alpha, N_{\\text{samples}}, \\text{seed})$，解决该问题的数值算法如下：\n$1$. 在区间 $[\\alpha_{\\min}, \\alpha_{\\max}]$ 上为参数 $\\alpha$ 构建一个包含 $N_\\alpha$ 个值的均匀网格。\n$2$. 对于此网格上的每个 $\\alpha$ 值，估计其变分能量 $E(\\alpha)$。\n$3$. 为估计 $E(\\alpha)$，从正态分布 $N(\\mu=0, \\sigma^2 = 1/(4\\alpha))$ 中抽取 $N_{\\text{samples}}$ 个独立的随机变量 $\\{x_i\\}$。\n$4$. 对于每个样本 $x_i$，使用推导出的公式计算局域能量 $E_L(x_i; \\alpha)$。\n$5$. 变分能量的估计值是这些局域能量的算术平均值：\n$$\nE(\\alpha) \\approx \\bar{E}(\\alpha) = \\frac{1}{N_{\\text{samples}}} \\sum_{i=1}^{N_{\\text{samples}}} E_L(x_i; \\alpha)\n$$\n$6$. 在计算完网格上所有 $\\alpha$ 的 $\\bar{E}(\\alpha)$ 后，找出产生最小能量 $\\bar{E}(\\alpha_{\\text{opt}})$ 的值 $\\alpha_{\\text{opt}}$。\n$7$. 数对 $[\\alpha_{\\text{opt}}, \\bar{E}(\\alpha_{\\text{opt}})]$ 构成该测试用例的结果。\n\n实现将利用 `numpy` 库进行高效的数组操作并使用其随机数生成器。为每个测试用例创建一个独立的随机数生成器实例，并使用提供的值作为种子，以确保可复现性。最终的数值结果 $\\alpha_{\\text{opt}}$ 及其对应的能量，将按要求四舍五入到6位小数。整个过程是使用基本统计方法对变分原理的一个直接而稳健的实现。", "answer": "```python\nimport numpy as np\n\ndef run_simulation(m, w, alpha_min, alpha_max, N_alpha, N_samples, seed):\n    \"\"\"\n    Performs Variational Monte Carlo to find the optimal alpha and ground state energy.\n\n    Args:\n        m (float): Mass of the particle.\n        w (float): Angular frequency of the oscillator.\n        alpha_min (float): Minimum of the alpha search range.\n        alpha_max (float): Maximum of the alpha search range.\n        N_alpha (int): Number of grid points for alpha.\n        N_samples (int): Number of samples for Monte Carlo integration.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        list: A two-element list containing the optimal alpha and the minimum energy.\n    \"\"\"\n    # Initialize a random number generator for reproducibility for this case\n    rng = np.random.default_rng(seed)\n\n    # Create the grid of alpha values\n    alpha_grid = np.linspace(alpha_min, alpha_max, N_alpha)\n\n    # Array to store the estimated energies for each alpha\n    estimated_energies = np.empty(N_alpha)\n\n    # Loop over each alpha in the grid\n    for i, alpha in enumerate(alpha_grid):\n        # The sampling distribution is a normal distribution N(0, sigma^2)\n        # where the variance sigma^2 = 1 / (4*alpha).\n        # The standard deviation is sigma = 1 / (2 * sqrt(alpha)).\n        sigma = 1.0 / (2.0 * np.sqrt(alpha))\n\n        # Generate N_samples from the normal distribution\n        x_samples = rng.normal(loc=0.0, scale=sigma, size=N_samples)\n\n        # Calculate the local energy for each sample.\n        # The expression for local energy E_L with hbar = 1 is:\n        # E_L(x;alpha) = alpha/m + (0.5*m*w^2 - 2*alpha^2/m) * x^2\n        # This is computed in a vectorized way for efficiency.\n        kinetic_term = alpha / m\n        potential_term_coeff = 0.5 * m * w**2 - 2.0 * alpha**2 / m\n        local_energies = kinetic_term + potential_term_coeff * np.square(x_samples)\n\n        # The estimated energy E(alpha) is the mean of the local energies\n        estimated_energies[i] = np.mean(local_energies)\n\n    # Find the index of the minimum energy on the grid\n    min_energy_idx = np.argmin(estimated_energies)\n\n    # The optimal alpha and corresponding minimum energy are at that index\n    alpha_opt = alpha_grid[min_energy_idx]\n    min_energy = estimated_energies[min_energy_idx]\n\n    return [alpha_opt, min_energy]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results in the required format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (m, omega, alpha_min, alpha_max, N_alpha, N_samples, seed)\n    test_cases = [\n        (1.0, 1.0, 0.2, 1.0, 41, 50000, 12345),\n        (2.0, 0.5, 0.2, 0.9, 36, 50000, 24680),\n        (0.5, 3.0, 0.3, 1.2, 46, 50000, 98765),\n        (1.0, 2.0, 0.5, 1.5, 26, 5000, 13579)\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = run_simulation(*case)\n        all_results.append(result)\n\n    # Format the final output string according to the specification:\n    # [[alpha1,E1],[alpha2,E2],...] with no spaces and 6 decimal places.\n    output_parts = [f\"[{alpha:.6f},{energy:.6f}]\" for alpha, energy in all_results]\n    final_output_string = f\"[{','.join(output_parts)}]\"\n\n    print(final_output_string)\n\nsolve()\n```", "id": "2431867"}]}