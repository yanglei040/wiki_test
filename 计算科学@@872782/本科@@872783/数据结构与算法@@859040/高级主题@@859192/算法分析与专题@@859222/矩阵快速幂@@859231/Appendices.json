{"hands_on_practices": [{"introduction": "理论学习之后，最好的巩固方式就是实践。我们将从一个非常直观和基础的应用开始：在图中进行路径计数。矩阵的幂与图中长度为 $k$ 的路径数量之间存在着深刻的联系，这一性质使得矩阵快速幂成为解决复杂网络中可达性问题的强大代数工具。这个练习 [@problem_id:3249456] 将引导你运用邻接矩阵来计算特定长度的路径数，并通过修改矩阵来处理“禁止通行”等约束，从而让你对矩阵快速幂在图论中的应用建立坚实的直观理解。", "problem": "考虑一个有限有向图 $G$，其顶点集为 $V=\\{1,2,3\\}$，边集为 $E=\\{(1,2),(1,3),(2,1),(2,3),(3,1),(3,2)\\}$。设 $A$ 为图 $G$ 的邻接矩阵，按顶点顺序 $(1,2,3)$ 索引，因此\n$$\nA=\\begin{pmatrix}\n0  1  1 \\\\\n1  0  1 \\\\\n1  1  0\n\\end{pmatrix}.\n$$\n要求你计算长度固定且不经过某条特定有向边的有向游走（可能重复访问顶点和边）的数量。形式上，定义禁止边为 $e=(3,2)$，源顶点为 $u=1$，目标顶点为 $v=2$，长度参数为 $k=5$。请仅使用有向图邻接矩阵的基本定义，并基于数据结构和算法的基本原理进行推理，确定从顶点 $u$ 到顶点 $v$ 长度恰好为 $k$ 且不使用边 $e$ 的有向游走的确切数量。请以单个整数形式给出最终答案。无需四舍五入。", "solution": "问题要求计算在给定有向图中，两顶点之间特定长度的有向游走数量，并附加一条约束条件：不得使用某条特定的边。\n\n设 $G=(V, E)$ 是一个有 $n$ 个顶点的有向图，设 $A$ 是其邻接矩阵，其中如果存在从顶点 $i$ 到顶点 $j$ 的边，则 $A_{ij} = 1$，否则 $A_{ij} = 0$。图论和算法中的一个基本原理指出，从源顶点 $u$到目标顶点 $v$ 的长度为 $k$ 的不同游走数量由矩阵 $A^k$ 的第 $(u,v)$ 个元素给出。我们可以通过对长度 $k$ 进行归纳来证明这个原理。\n\n**基础情形 ($k=1$)**：从 $u$ 到 $v$ 的长度为 $1$ 的游走存在，当且仅当存在一条有向边 $(u,v) \\in E$。此类游走的数量在 $(u,v) \\in E$ 时为 $1$，否则为 $0$。这正是邻接矩阵元素 $A_{uv}$ 的定义。因此，该原理对 $k=1$ 成立，因为 $(A^1)_{uv} = A_{uv}$。\n\n**归纳步骤**：假设该原理对于某个长度 $m \\ge 1$ 成立。也就是说，从任意顶点 $i$ 到任意顶点 $j$ 的长度为 $m$ 的游走数量由 $(A^m)_{ij}$ 给出。现在，考虑一条从 $u$ 到 $v$ 长度为 $m+1$ 的游走。任何这样的游走都由一条从 $u$ 到某个中间顶点 $p \\in V$ 的长度为 $m$ 的游走，后接一条从 $p$ 到 $v$ 的单边组成。为了找到此类游走的总数，我们可以对所有可能的中间顶点 $p$ 求和：\n$$\n\\text{长度为 } m+1 \\text{ 的 } u \\to v \\text{ 游走数} = \\sum_{p \\in V} (\\text{长度为 } m \\text{ 的 } u \\to p \\text{ 游走数}) \\times (\\text{长度为 } 1 \\text{ 的 } p \\to v \\text{ 游走数})\n$$\n根据归纳假设和基础情形，此和可以写成矩阵元素的形式：\n$$\n\\sum_{p=1}^{n} (A^m)_{up} \\cdot A_{pv}\n$$\n根据矩阵乘法的定义，这个和正是乘积矩阵 $A^m \\cdot A = A^{m+1}$ 的第 $(u,v)$ 个元素。因此，从 $u$ 到 $v$ 的长度为 $m+1$ 的游走数量是 $(A^{m+1})_{uv}$。根据数学归纳法原理，该命题对所有整数 $k \\ge 1$ 均成立。\n\n问题要求我们计算不使用禁止边 $e=(3,2)$ 的游走。这等价于在一个修改后的图 $G'$ 中计数游走，该图与原图 $G$ 相同，只是移除了边 $e$。这个新图的邻接矩阵（我们称之为 $A'$）将与原矩阵 $A$ 相同，只是对应于禁止边的元素被设为 $0$。\n\n给定的邻接矩阵为：\n$$\nA = \\begin{pmatrix} 0  1  1 \\\\ 1  0  1 \\\\ 1  1  0 \\end{pmatrix}\n$$\n顶点按顺序 $(1, 2, 3)$ 索引。禁止边 $e=(3,2)$ 对应于第 3 行第 2 列的元素。因此，我们通过将该元素设置为 $0$ 来构造矩阵 $A'$：\n$$\nA' = \\begin{pmatrix} 0  1  1 \\\\ 1  0  1 \\\\ 1  0  0 \\end{pmatrix}\n$$\n问题指定源顶点 $u=1$，目标顶点 $v=2$，以及游走长度 $k=5$。根据已建立的原理，在图 $G'$ 中从 $u$ 到 $v$ 长度为 $k$ 的游走数量由矩阵 $(A')^5$ 的第 $(1,2)$ 个元素给出。我们的任务就是计算这个值。\n\n我们按顺序计算 $A'$ 的幂。\n首先，我们计算 $A'^2$：\n$$\nA'^2 = A' \\cdot A' = \\begin{pmatrix} 0  1  1 \\\\ 1  0  1 \\\\ 1  0  0 \\end{pmatrix} \\begin{pmatrix} 0  1  1 \\\\ 1  0  1 \\\\ 1  0  0 \\end{pmatrix} = \\begin{pmatrix} 2  0  1 \\\\ 1  1  1 \\\\ 0  1  1 \\end{pmatrix}\n$$\n接着，我们可以通过对 $A'^2$ 平方来计算 $A'^4$：\n$$\nA'^4 = A'^2 \\cdot A'^2 = \\begin{pmatrix} 2  0  1 \\\\ 1  1  1 \\\\ 0  1  1 \\end{pmatrix} \\begin{pmatrix} 2  0  1 \\\\ 1  1  1 \\\\ 0  1  1 \\end{pmatrix} = \\begin{pmatrix} 4  1  3 \\\\ 3  2  3 \\\\ 1  2  2 \\end{pmatrix}\n$$\n最后，我们通过将 $A'^4$ 乘以 $A'$ 来计算 $A'^5$：\n$$\nA'^5 = A'^4 \\cdot A' = \\begin{pmatrix} 4  1  3 \\\\ 3  2  3 \\\\ 1  2  2 \\end{pmatrix} \\begin{pmatrix} 0  1  1 \\\\ 1  0  1 \\\\ 1  0  0 \\end{pmatrix} = \\begin{pmatrix} 4  4  5 \\\\ 5  3  5 \\\\ 4  1  3 \\end{pmatrix}\n$$\n从顶点 $u=1$ 到顶点 $v=2$ 长度为 $k=5$ 且不使用边 $(3,2)$ 的有向游走数量是矩阵 $A'^5$ 的第 $(1,2)$ 个元素。\n$$\n((A')^5)_{12} = 4\n$$\n因此，恰好有 $4$ 条这样的游走。", "answer": "$$\n\\boxed{4}\n$$", "id": "3249456"}, {"introduction": "掌握了图上的应用后，我们可以将视野拓宽到更广阔的领域：求解线性递推关系。许多动态规划、组合计数问题，其核心都可以归结为一个线性递推模型，例如经典的爬楼梯问题。通过练习 [@problem_id:3249460]，你将学会如何将一个高阶递推关系转化为一个一阶的矩阵状态转移方程。这种转化是矩阵快速幂应用的关键一步，它使得我们能够从初始状态“跳跃”到第 $n$ 个状态，而计算时间复杂度仅为 $O(\\log n)$，极大地提高了计算大规模递推项的效率。", "problem": "一个楼梯有 $n$ 级台阶。你可以通过大小属于集合 $S = \\{1, 2, 5\\}$ 的步子来爬这个楼梯。设 $W(n)$ 表示步长之和恰好为 $n$ 的不同有序步子序列（顺序很重要）的数量。假设 $W(0) = 1$（空序列算作一种方式），并且对于所有 $k  0$，有 $W(k) = 0$。从组合分解的第一性原理和线性递推的移位寄存器表示出发，推导出 $W(n)$ 的线性递推关系，将其转换为适用于快速幂运算的矩阵形式，并使用该框架确定 $W(25)$ 的值。将最终答案表示为一个整数。不需要四舍五入。", "solution": "为了求解 $W(n)$，我们首先从第一性原理推导其线性递推关系。要到达第 $n$ 级台阶，最后一步的步长必须是 $1$、$2$ 或 $5$。\n- 如果最后一步是步长为 1 的步子，那么之前必须位于第 $n-1$ 级台阶，有 $W(n-1)$ 种方式到达那里。\n- 如果最后一步是步长为 2 的步子，那么之前必须位于第 $n-2$ 级台阶，有 $W(n-2)$ 种方式到达那里。\n- 如果最后一步是步长为 5 的步子，那么之前必须位于第 $n-5$ 级台阶，有 $W(n-5)$ 种方式到达那里。\n\n由于这三种情况是互斥的，我们可以将总方法数相加，得到以下递推关系：\n$$W(n) = W(n-1) + W(n-2) + W(n-5)$$\n这是一个五阶线性递推关系。为了求解它，我们需要五个初始值。根据问题定义 $W(0)=1$ 和 $W(k)=0$ (对于 $k0$)，我们可以计算出：\n- $W(0) = 1$\n- $W(1) = W(0) + W(-1) + W(-4) = 1 + 0 + 0 = 1$\n- $W(2) = W(1) + W(0) + W(-3) = 1 + 1 + 0 = 2$\n- $W(3) = W(2) + W(1) + W(-2) = 2 + 1 + 0 = 3$\n- $W(4) = W(3) + W(2) + W(-1) = 3 + 2 + 0 = 5$\n\n接下来，我们将此递推关系转换为矩阵形式。我们定义一个状态向量，它包含了计算下一项所需的所有信息：\n$$ V_k = \\begin{pmatrix} W(k) \\\\ W(k-1) \\\\ W(k-2) \\\\ W(k-3) \\\\ W(k-4) \\end{pmatrix} $$\n我们的目标是找到一个转移矩阵 $M$，使得 $V_{k+1} = M V_k$。根据递推关系和状态向量的定义，我们可以写出 $V_{k+1}$ 的分量：\n- $W(k+1) = 1 \\cdot W(k) + 1 \\cdot W(k-1) + 0 \\cdot W(k-2) + 0 \\cdot W(k-3) + 1 \\cdot W(k-4)$\n- $W(k) = 1 \\cdot W(k)$\n- $W(k-1) = 1 \\cdot W(k-1)$\n- ...以此类推。\n\n这构成了如下的矩阵方程：\n$$ V_{k+1} = \\begin{pmatrix} W(k+1) \\\\ W(k) \\\\ W(k-1) \\\\ W(k-2) \\\\ W(k-3) \\end{pmatrix} = \\begin{pmatrix} 1  1  0  0  1 \\\\ 1  0  0  0  0 \\\\ 0  1  0  0  0 \\\\ 0  0  1  0  0 \\\\ 0  0  0  1  0 \\end{pmatrix} \\begin{pmatrix} W(k) \\\\ W(k-1) \\\\ W(k-2) \\\\ W(k-3) \\\\ W(k-4) \\end{pmatrix} = M V_k $$\n重复应用此关系，我们得到 $V_n = M^{n-k} V_k$。为了计算 $W(25)$，我们可以从一个已知的初始向量开始，例如 $V_4$：\n$$ V_4 = \\begin{pmatrix} W(4) \\\\ W(3) \\\\ W(2) \\\\ W(1) \\\\ W(0) \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 3 \\\\ 2 \\\\ 1 \\\\ 1 \\end{pmatrix} $$\n我们需要计算 $V_{25} = M^{25-4} V_4 = M^{21} V_4$。$W(25)$ 就是结果向量 $V_{25}$ 的第一个分量。\n\n使用矩阵快速幂（也称二分求幂）算法计算 $M^{21}$，然后将其与 $V_4$ 相乘。这个过程将计算 $M$ 的幂所需的操作次数从 $O(n)$ 减少到 $O(\\log n)$ 次矩阵乘法。\n执行此计算（例如，通过计算 $M^{16}$, $M^4$, $M^1$ 并将它们相乘以得到 $M^{21}$），然后将结果矩阵乘以 $V_4$，我们得到 $W(25)$ 的值。\n$$ V_{25} = M^{21} V_4 $$\n计算结果向量的第一个分量，我们得到 $W(25) = 382396$。", "answer": "$$\\boxed{382396}$$", "id": "3249460"}, {"introduction": "矩阵快速幂不仅是一种高效的计算技巧，更是一种揭示数学结构深层联系的分析工具。除了计算递推数列的特定项，我们还能利用矩阵的性质来推导数列的通项公式。这个练习 [@problem_id:3249485] 将带领你探索一个经典的组合问题，该问题等价于斐波那契数列。你将通过矩阵对角化这一线性代数中的核心方法，从矩阵的特征值和特征向量出发，最终推导出著名的比内公式 (Binet's formula)，深刻体会算法、线性代数与离散数学之间的优美融合。", "problem": "设 $n$ 是一个非负整数。$n$ 的一个有序分拆是一个其和为 $n$ 的正整数有限序列，其中顺序是重要的。只考虑每个部分均为 $1$ 或 $2$ 的有序分拆。运用数据结构和算法的原理，从有序分拆的基本定义和递归分解的计数方法出发，推导出一个线性递推关系来捕捉此类分拆的数量。接着，为此递推关系构建一个一阶线性状态转移表示，并使用矩阵指数法来获得将 $n$ 分拆为 $1$ 和 $2$ 的有序分拆数量的精确、闭式解析表达式。你的最终答案必须是关于 $n$ 的单个简化解析表达式。不需要数值近似，也不涉及任何单位。", "solution": "设 $C_n$ 表示将非负整数 $n$ 分拆为大小为 $1$ 或 $2$ 的部分的有序分拆的数量。\n\n首先，我们通过考虑分拆的最后一部分来推导递推关系。\n1.  如果最后一部分是 $1$，那么前面各部分的总和必须是 $n-1$。这些前面的部分构成了 $n-1$ 的一个有效分拆，其数量为 $C_{n-1}$。\n2.  如果最后一部分是 $2$，那么前面各部分的总和必须是 $n-2$。这些前面的部分构成了 $n-2$ 的一个有效分拆，其数量为 $C_{n-2}$。\n\n由于对于 $n \\ge 2$，这两种情况是互斥且穷尽的，我们可以将 $C_n$ 的递推关系写为：\n$$ C_n = C_{n-1} + C_{n-2} \\quad \\text{for } n \\ge 2 $$\n为了解这个二阶递推关系，我们需要两个初始条件。\n- 对于 $n=0$：唯一的分拆是空序列，其和为 $0$。因此，$C_0 = 1$。\n- 对于 $n=1$：唯一的分拆是 $(1)$。因此，$C_1 = 1$。\n该序列 $C_n$ (从 $n=0$ 开始) 为 $1, 1, 2, 3, 5, \\dots$，这对应于斐波那契数列 $F_{n+1}$（约定 $F_0=0, F_1=1$）。\n\n接下来，我们构建一个一阶线性状态转移表示。设状态向量为 $\\mathbf{v}_n = \\begin{pmatrix} C_n \\\\ C_{n-1} \\end{pmatrix}$。递推关系可以写成矩阵形式：\n$$ \\mathbf{v}_n = \\begin{pmatrix} C_n \\\\ C_{n-1} \\end{pmatrix} = \\begin{pmatrix} 1  1 \\\\ 1  0 \\end{pmatrix} \\begin{pmatrix} C_{n-1} \\\\ C_{n-2} \\end{pmatrix} = M \\mathbf{v}_{n-1} $$\n其中 $M = \\begin{pmatrix} 1  1 \\\\ 1  0 \\end{pmatrix}$。通过重复应用，我们得到 $\\mathbf{v}_n = M^{n-1} \\mathbf{v}_1$，其中初始状态向量为 $\\mathbf{v}_1 = \\begin{pmatrix} C_1 \\\\ C_0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n\n为了获得 $M^{n-1}$ 的闭式解，我们将矩阵 $M$ 对角化。首先，我们求解特征方程 $\\det(M - \\lambda I) = 0$ 来找到其特征值：\n$$ \\det \\begin{pmatrix} 1-\\lambda  1 \\\\ 1  -\\lambda \\end{pmatrix} = (1-\\lambda)(-\\lambda) - 1 = \\lambda^2 - \\lambda - 1 = 0 $$\n特征值是 $\\lambda_1 = \\phi = \\frac{1+\\sqrt{5}}{2}$ (黄金比例) 和 $\\lambda_2 = \\psi = \\frac{1-\\sqrt{5}}{2}$。\n\n对应的特征向量分别为 $\\mathbf{e}_1 = \\begin{pmatrix} \\phi \\\\ 1 \\end{pmatrix}$ 和 $\\mathbf{e}_2 = \\begin{pmatrix} \\psi \\\\ 1 \\end{pmatrix}$。我们用特征向量构成矩阵 $P$，用特征值构成对角矩阵 $D$：\n$$ P = \\begin{pmatrix} \\phi  \\psi \\\\ 1  1 \\end{pmatrix}, \\quad D = \\begin{pmatrix} \\phi  0 \\\\ 0  \\psi \\end{pmatrix} $$\n$P$ 的逆矩阵是 $P^{-1} = \\frac{1}{\\phi - \\psi} \\begin{pmatrix} 1  -\\psi \\\\ -1  \\phi \\end{pmatrix} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 1  -\\psi \\\\ -1  \\phi \\end{pmatrix}$。\n\n矩阵的幂为 $M^{n-1} = P D^{n-1} P^{-1}$。因此，$\\mathbf{v}_n = P D^{n-1} P^{-1} \\mathbf{v}_1$。我们现在计算这个表达式：\n$$ \\mathbf{v}_n = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} \\phi  \\psi \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} \\phi^{n-1}  0 \\\\ 0  \\psi^{n-1} \\end{pmatrix} \\begin{pmatrix} 1  -\\psi \\\\ -1  \\phi \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} $$\n$$ \\mathbf{v}_n = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} \\phi  \\psi \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} \\phi^{n-1}  0 \\\\ 0  \\psi^{n-1} \\end{pmatrix} \\begin{pmatrix} 1-\\psi \\\\ \\phi-1 \\end{pmatrix} $$\n利用性质 $\\phi-1 = 1/\\phi$ 和 $1-\\psi = \\phi$，我们得到 $\\begin{pmatrix} 1-\\psi \\\\ \\phi-1 \\end{pmatrix} = \\begin{pmatrix} \\phi \\\\ 1/\\phi \\end{pmatrix}$。\n但是，更简单的方法是先计算 $M^{n-1}$，然后与 $\\mathbf{v}_1$ 相乘。\n$$ M^{n-1} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} \\phi^n - \\psi^n  \\phi^{n-1} - \\psi^{n-1} \\\\ \\phi^{n-1} - \\psi^{n-1}  \\phi^{n-2} - \\psi^{n-2} \\end{pmatrix} $$\n这可以通过注意 $M^k$ 的元素是斐波那契数来简化。$M^k = \\begin{pmatrix} F_{k+1}  F_k \\\\ F_k  F_{k-1} \\end{pmatrix}$。因此，$M^{n-1} = \\begin{pmatrix} F_{n}  F_{n-1} \\\\ F_{n-1}  F_{n-2} \\end{pmatrix}$。\n$$ \\mathbf{v}_n = \\begin{pmatrix} C_n \\\\ C_{n-1} \\end{pmatrix} = \\begin{pmatrix} F_{n}  F_{n-1} \\\\ F_{n-1}  F_{n-2} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} F_n + F_{n-1} \\\\ F_{n-1} + F_{n-2} \\end{pmatrix} = \\begin{pmatrix} F_{n+1} \\\\ F_n \\end{pmatrix} $$\n所以 $C_n = F_{n+1}$。使用斐波那契数的比内公式 $F_k = \\frac{\\phi^k - \\psi^k}{\\sqrt{5}}$，我们得到 $C_n$ 的闭式表达式：\n$$ C_n = F_{n+1} = \\frac{\\phi^{n+1} - \\psi^{n+1}}{\\sqrt{5}} $$\n代入 $\\phi$ 和 $\\psi$ 的值，我们得到最终的解析表达式：\n$$ C_n = \\frac{1}{\\sqrt{5}} \\left( \\left(\\frac{1+\\sqrt{5}}{2}\\right)^{n+1} - \\left(\\frac{1-\\sqrt{5}}{2}\\right)^{n+1} \\right) $$\n该公式对所有非负整数 $n$ 均有效。", "answer": "$$\n\\boxed{\\frac{1}{\\sqrt{5}} \\left( \\left(\\frac{1+\\sqrt{5}}{2}\\right)^{n+1} - \\left(\\frac{1-\\sqrt{5}}{2}\\right)^{n+1} \\right)}\n$$", "id": "3249485"}]}