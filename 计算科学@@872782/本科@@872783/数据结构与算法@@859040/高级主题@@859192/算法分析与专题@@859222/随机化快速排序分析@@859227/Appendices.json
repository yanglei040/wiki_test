{"hands_on_practices": [{"introduction": "在深入分析算法的整体性能之前，理解随机主元选择的直接后果至关重要。第一个练习提出了一个简单但根本性的问题：我们得到一次完美平衡划分的几率有多大？通过解决这个问题，你将直接应用统一主元选择的核心原则，为更复杂的分析奠定基础。[@problem_id:3264015]", "problem": "考虑标准的随机化快速排序算法，该算法应用于一个包含 $n$ 个不同键值的输入数组，这些键值取自一个全序集。在递归的根节点，算法从 $n$ 个键值中均匀随机地选择一个主元 (pivot)，将剩余的 $n-1$ 个键值划分为小于主元和大于主元两部分，然后递归地对得到的两个子数组进行排序。令 $k$ 表示严格小于主元的键的数量（因此左子问题的规模为 $k$，右子问题的规模为 $n-1-k$）。将 $k=\\lfloor n/2 \\rfloor$ 的情况定义为一次完全平衡的划分。\n\n从“主元是从 $n$ 个不同的键值中均匀随机选择的，并且其在 $n$ 个键值中的排名等可能地为从 $1$ 到 $n$ 的任意整数”这一核心定义出发，请从第一性原理推导出根节点的划分是完全平衡的（即 $k=\\lfloor n/2 \\rfloor$）的确切概率（作为 $n$ 的函数）。\n\n将你的最终答案表示为一个关于 $n$ 的单一简化闭式表达式。无需四舍五入。", "solution": "让我们将 $n$ 个不同的键值按排序顺序表示为 $z_1  z_2  \\dots  z_n$。主元（我们称之为 $p$）是从这 $n$ 个键值中均匀随机选择的。这意味着选择任何特定的键 $z_i$ 作为主元的概率是 $P(p=z_i) = 1/n$，对于任意 $i \\in \\{1, 2, \\dots, n\\}$。\n\n主元的排名决定了 $k$ 的值。如果选中的主元是 $z_i$，那么恰好有 $i-1$ 个键值比它小。因此，严格小于主元的键的数量 $k$ 等于 $i-1$。\n\n设 $R$ 为表示所选主元在 $n$ 个键值中排名的随机变量。根据问题定义，主元是均匀随机选择的，这意味着它的排名在集合 $\\{1, 2, \\dots, n\\}$ 上也是均匀随机的。因此，对于从 $1$ 到 $n$ 的任意整数 $i$，$P(R=i) = 1/n$。\n\n我们关心的是划分完全平衡的概率，即 $k = \\lfloor n/2 \\rfloor$。从上一步我们知道 $k = R-1$。所以，我们想要求解概率 $P(k = \\lfloor n/2 \\rfloor)$。\n\n将 $k=R-1$ 代入方程，我们得到：\n$P(R-1 = \\lfloor n/2 \\rfloor) = P(R = \\lfloor n/2 \\rfloor + 1)$\n\n令 $i_0 = \\lfloor n/2 \\rfloor + 1$。因为 $n \\ge 1$（这样快速排序才有意义），我们有 $0 \\le \\lfloor n/2 \\rfloor \\le n-1$。这意味着 $1 \\le \\lfloor n/2 \\rfloor + 1 \\le n$。因此，$i_0$ 是一个介于 $1$ 和 $n$ 之间（含两端）的整数。\n\n因为排名 $R$ 在 $\\{1, 2, \\dots, n\\}$ 上是均匀分布的，$R$ 在此范围内取任何特定值 $i_0$ 的概率是 $1/n$。\n因此，$P(R = i_0) = P(R = \\lfloor n/2 \\rfloor + 1) = \\frac{1}{n}$。\n\n根节点划分完全平衡的概率恰好是 $\\frac{1}{n}$，无论 $n$ 是奇数还是偶数。这是因为恰好只有一个主元排名可以导致完全平衡的划分，而 $n$ 个可能的排名中的每一个都是等可能的，概率为 $1/n$。", "answer": "$$\\boxed{\\frac{1}{n}}$$", "id": "3264015"}, {"introduction": "在理解了主元选择的基础之上，我们现在可以分析算法的整体期望性能。这个练习将引导你完成算法分析中最经典的结果之一：推导随机快速排序的精确期望比较次数。你将运用强大的指示器随机变量技术，将一个复杂的全局问题分解为一系列简单概率的总和。[@problem_id:3263936]", "problem": "考虑一个快速排序算法的版本，其输入数组 $A$ 是集合 $\\{1, 2, \\ldots, n\\}$ 的一个排列，其中 $n \\geq 2$。在每次对连续子数组 $A[L..R]$ 进行操作的递归调用中，令 $m = R - L + 1$ 表示子数组的长度。该算法通过调用一个随机数生成器 (RNG) 来从子数组中均匀随机地选择枢轴索引。该RNG返回一个从区间 $[0, 1)$ 中均匀抽取的独立同分布 (i.i.d.) 实数值 $\\operatorname{rand}()$，然后将枢轴索引设置为 $L - 1 + \\lceil \\operatorname{rand}() \\cdot m \\rceil$。接着，使用仅有的键值比较对子数组进行划分，其中枢轴键与子数组中的每个其他键恰好比较一次，然后算法对两个分区进行递归。假设不同递归层级上的RNG调用是相互独立的。\n\n仅使用概率论中期望的基础定义、上述枢轴选择的均匀性以及快速排序的结构行为，推导出算法在整个执行过程中所执行的键值比较总数的精确期望值，并以包含 $n$ 和第 $n$ 个调和数 $H_n = \\sum_{k=1}^{n} \\frac{1}{k}$ 的闭式解析表达式表示。\n\n最终答案必须是只含 $n$ 和 $H_n$ 的单个解析表达式。不需要进行数值取整。", "solution": "令 $X$ 为随机变量，表示随机化快速排序算法对大小为 $n$ 的输入所执行的键值比较总次数。我们的目标是计算 $X$ 的期望，记为 $\\mathbb{E}[X]$。\n\n我们使用指示器随机变量的方法。令输入数组中的不同元素排序后为 $z_1  z_2  \\ldots  z_n$。由于输入是 $\\{1, 2, \\ldots, n\\}$ 的一个排列，我们有 $z_i = i$ 对于 $i \\in \\{1, 2, \\ldots, n\\}$。\n\n对于任意一对元素 $(z_i, z_j)$ 且 $i  j$，令 $X_{ij}$ 为一个指示器随机变量，当且仅当 $z_i$ 和 $z_j$ 在算法执行过程中的某个时刻被比较时，$X_{ij}=1$。\n总比较次数 $X$ 是所有满足 $1 \\le i  j \\le n$ 的元素对的指示器变量之和：\n$$ X = \\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} X_{ij} $$\n根据期望的线性性质，期望总比较次数为：\n$$ \\mathbb{E}[X] = \\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} \\mathbb{E}[X_{ij}] $$\n指示器随机变量的期望是它所指示事件的概率，因此 $\\mathbb{E}[X_{ij}] = P(z_i \\text{ 和 } z_j \\text{ 被比较})$。\n\n现在，我们分析两个元素 $z_i$ 和 $z_j$ 被比较的条件。考虑由它们及它们之间所有元素组成的集合 $S_{ij} = \\{z_i, z_{i+1}, \\ldots, z_j\\}$。$z_i$ 和 $z_j$ 会被比较，当且仅当在集合 $S_{ij}$ 中，第一个被选为枢轴的元素是 $z_i$ 或 $z_j$。如果任何其他元素 $z_k$ (其中 $i  k  j$) 首先被选为枢轴，那么 $z_i$ 和 $z_j$ 将被分到不同的子数组中，从而永远不会被比较。\n\n由于枢轴是从当前子数组中均匀随机选择的，因此在 $S_{ij}$ 中的任何元素都有同等的机会成为该集合中第一个被选为枢轴的元素。集合 $S_{ij}$ 包含 $j - i + 1$ 个元素。在这 $j - i + 1$ 个等可能的结果中，有两个（枢轴为 $z_i$ 或 $z_j$）会导致比较发生。\n因此，比较的概率是：\n$$ P(z_i \\text{ 和 } z_j \\text{ 被比较}) = \\frac{2}{j - i + 1} $$\n现在我们通过对所有配对求和来计算总的期望比较次数：\n$$ \\mathbb{E}[X] = \\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} \\frac{2}{j-i+1} $$\n为了计算这个双重求和，我们通过令 $k = j-i+1$ 来重新索引。$k$ 表示集合 $S_{ij}$ 的大小，其范围从 $2$ 到 $n$。对于一个固定的 $k$，满足 $j-i+1=k$ 的配对 $(i,j)$ 共有 $n-k+1$ 对。\n\n我们可以重写求和式：\n$$ \\mathbb{E}[X] = \\sum_{k=2}^{n} (n-k+1) \\frac{2}{k} = 2 \\sum_{k=2}^{n} \\frac{n-k+1}{k} $$\n拆分求和内的项：\n$$ \\mathbb{E}[X] = 2 \\sum_{k=2}^{n} \\left(\\frac{n+1}{k} - \\frac{k}{k}\\right) = 2 \\sum_{k=2}^{n} \\left(\\frac{n+1}{k} - 1\\right) $$\n将求和分成两部分：\n$$ \\mathbb{E}[X] = 2 \\left( \\sum_{k=2}^{n} \\frac{n+1}{k} - \\sum_{k=2}^{n} 1 \\right) $$\n第一部分为 $(n+1) \\sum_{k=2}^{n} \\frac{1}{k}$。使用第 $n$ 个调和数 $H_n = \\sum_{k=1}^{n} \\frac{1}{k}$ 的定义，我们有 $\\sum_{k=2}^{n} \\frac{1}{k} = H_n - 1$。\n第二部分为 $\\sum_{k=2}^{n} 1 = n-1$。\n将这些结果代入 $\\mathbb{E}[X]$ 的表达式中：\n$$ \\mathbb{E}[X] = 2 \\left( (n+1)(H_n - 1) - (n-1) \\right) $$\n简化该表达式：\n$$ \\mathbb{E}[X] = 2 \\left( (n+1)H_n - (n+1) - n + 1 \\right) $$\n$$ \\mathbb{E}[X] = 2 \\left( (n+1)H_n - 2n \\right) $$\n$$ \\mathbb{E}[X] = 2(n+1)H_n - 4n $$\n这就是期望键值比较总数的最终闭式表达式。", "answer": "$$\\boxed{2(n+1)H_n - 4n}$$", "id": "3263936"}, {"introduction": "虽然随机快速排序在平均情况下的效率很高，但其每一步的最差情况表现如何呢？最后一个练习将探讨最不平衡的划分——即主元是当前子数组中最小或最大元素——的期望发生频率。通过建立并求解一个递推关系，你将深入了解这些“坏运气”事件的发生规律，并掌握另一种有价值的算法分析工具。[@problem_id:3263955]", "problem": "考虑对一个包含$n$个不同键值的数组执行标准随机快速排序，在每次递归调用中，轴点从当前子数组中均匀随机选取，然后一个划分操作将子数组分割成小于轴点的元素和大于轴点的元素。假设划分过程仅在大小至少为$2$的子数组上调用，而大小为$0$或$1$的子数组构成基本情况，不执行划分。\n\n定义这样一种划分为：其产生的两个子数组中有一个的大小为$0$；等价地说，为该次划分所选的轴点是被划分的子数组中的最小或最大元素。令$X_n$表示在对大小为$n$的输入完整执行随机快速排序期间，此类划分的总数。\n\n仅从上述算法定义和概率论的基本规则（如条件化和期望的线性性）出发，推导期望值$\\mathbb{E}[X_n]$作为$n$的函数的闭式表达式，其中$n \\ge 2$。你的最终答案必须是关于$n$的单一解析表达式，不含未求值的和式或递推式。", "solution": "令$X_n$为随机变量，表示在对一个包含$n$个不同键值的数组执行随机快速排序期间，轴点为其所在子数组中最小或最大元素的划分总数。我们需要求解$X_n$的期望值，记为$E_n = \\mathbb{E}[X_n]$，其中$n \\ge 2$。\n\n题目说明了划分操作仅在大小至少为$2$的子数组上调用。这意味着对于大小为$0$或$1$的子数组，递归终止，不执行划分。因此，对于大小为$n=0$或$n=1$的输入，此类划分的数目为$0$。相应的期望值为：\n$E_0 = \\mathbb{E}[X_0] = 0$\n$E_1 = \\mathbb{E}[X_1] = 0$\n\n对于$n \\ge 2$，算法开始时从$n$个元素中均匀随机地选择一个轴点。设所选轴点的秩为$k$，其中$k \\in \\{1, 2, \\dots, n\\}$。任何特定秩$k$被选中的概率是$\\frac{1}{n}$。\n\n围绕秩为$k$的轴点对大小为$n$的数组进行划分后，数组被分割成大小为$k-1$和$n-k$的两个子数组。然后算法对这两个子数组进行递归排序。指定的划分总数$X_n$是第一次划分的贡献与后续递归调用的贡献之和。\n\n令$I$为一个指示随机变量，表示第一次划分（在大小为$n$的数组上）是轴点为最小或最大元素的事件。该事件发生当且仅当所选轴点的秩为$k=1$（最小）或$k=n$（最大）。对于$n \\ge 2$，此事件的概率为$P(k=1) + P(k=n) = \\frac{1}{n} + \\frac{1}{n} = \\frac{2}{n}$。因此，$I$的期望值为$\\mathbb{E}[I] = \\frac{2}{n}$。\n\n我们可以利用全期望定律，通过对第一次所选轴点的秩$k$进行条件化，来建立$E_n$的递推关系。\n$$E_n = \\mathbb{E}[X_n] = \\sum_{k=1}^{n} \\mathbb{E}[X_n | \\text{pivot rank is } k] \\cdot P(\\text{pivot rank is } k)$$\n给定轴点的秩为$k$，指定的划分总数是以下各项之和：\n1. 第一次划分是否属于指定类型（即$k=1$或$k=n$）。\n2. 在大小为$k-1$的子数组上递归调用中指定划分的数目。\n3. 在大小为$n-k$的子数组上递归调用中指定划分的数目。\n\n根据期望的线性性，条件期望为：\n$$\\mathbb{E}[X_n | \\text{pivot rank is } k] = \\mathbb{E}[I | \\text{pivot rank is } k] + \\mathbb{E}[X_{k-1}] + \\mathbb{E}[X_{n-k}]$$\n项$\\mathbb{E}[I | \\text{pivot rank is } k]$在$k=1$或$k=n$时为$1$，否则为$0$。递归调用的期望分别为$E_{k-1}$和$E_{n-k}$，因为子问题的随机化与第一次轴点的选择是独立的。\n因此，$\\mathbbE}[X_n | \\text{pivot rank is } k] = (\\delta_{k,1} + \\delta_{k,n}) + E_{k-1} + E_{n-k}$，其中$\\delta_{i,j}$是克罗内克δ。\n\n将此代入$E_n$的和式中：\n$$E_n = \\sum_{k=1}^{n} \\left[ (\\delta_{k,1} + \\delta_{k,n}) + E_{k-1} + E_{n-k} \\right] \\frac{1}{n}$$\n$$E_n = \\frac{1}{n} \\left[ \\sum_{k=1}^{n}(\\delta_{k,1} + \\delta_{k,n}) + \\sum_{k=1}^{n}E_{k-1} + \\sum_{k=1}^{n}E_{n-k} \\right]$$\n第一个和式的值为$2$，因为它在$k=1$和$k=n$时为$1$，否则为$0$。接下来的两个和式是相同的，如下标变换$j=n-k$所示：$\\sum_{k=1}^{n}E_{n-k} = \\sum_{j=0}^{n-1}E_j$。\n$$E_n = \\frac{1}{n} \\left[ 2 + 2\\sum_{j=0}^{n-1}E_j \\right]$$\n此递推关系对$n \\ge 2$成立。\n\n为了解这个递推关系，我们首先两边乘以$n$：\n$$n E_n = 2 + 2\\sum_{j=0}^{n-1}E_j \\quad (*)$$\n该方程对$n \\ge 2$有效。我们可以为$n-1$写出同样的关系式，这对$n-1 \\ge 2$（即$n \\ge 3$）有效：\n$$(n-1)E_{n-1} = 2 + 2\\sum_{j=0}^{n-2}E_j \\quad (**)$$\n对于$n \\ge 3$，从$(*)$中减去$(**)$：\n$$n E_n - (n-1)E_{n-1} = \\left(2 + 2\\sum_{j=0}^{n-1}E_j\\right) - \\left(2 + 2\\sum_{j=0}^{n-2}E_j\\right)$$\n$$n E_n - (n-1)E_{n-1} = 2E_{n-1}$$\n$$n E_n = (n-1)E_{n-1} + 2E_{n-1} = (n+1)E_{n-1}$$\n这给出了一个对$n \\ge 3$更简单的递推关系：\n$$E_n = \\frac{n+1}{n} E_{n-1}$$\n我们可以通过将递推关系展开到$E_2$来求解：\n$$E_n = \\frac{n+1}{n}E_{n-1} = \\frac{n+1}{n} \\cdot \\frac{n}{n-1}E_{n-2} = \\dots = \\left(\\frac{n+1}{n} \\cdot \\frac{n}{n-1} \\cdot \\frac{n-1}{n-2} \\cdots \\frac{4}{3}\\right)E_2$$\n这是一个伸缩积：\n$$E_n = \\frac{n+1}{3}E_2$$\n此解对$n \\ge 3$有效。为了求$E_2$的值，我们使用原始递推关系$(*)$并代入$n=2$：\n$$2 E_2 = 2 + 2\\sum_{j=0}^{1}E_j = 2 + 2(E_0 + E_1)$$\n使用基本情况$E_0=0$和$E_1=0$：\n$$2 E_2 = 2 + 2(0+0) = 2 \\implies E_2 = 1$$\n这也可以通过观察来验证：对于一个大小为$2$的数组，任何选定的轴点必然是最小或最大元素，因此恰好发生一次划分，且这次划分总是属于指定类型。\n\n将$E_2=1$代入$E_n$的解中：\n$$E_n = \\frac{n+1}{3} \\quad \\text{for } n \\ge 3$$\n最后，我们检查该公式是否也对边界情况$n=2$成立：\n$$E_2 = \\frac{2+1}{3} = \\frac{3}{3} = 1$$\n这与我们计算出的$E_2$的值相符。因此，对于任何$n \\ge 2$，此类划分的期望数的闭式表达式为$\\frac{n+1}{3}$。", "answer": "$$\n\\boxed{\\frac{n+1}{3}}\n$$", "id": "3263955"}]}