{"hands_on_practices": [{"introduction": "k-mer谱的形状揭示了基因组结构的关键信息，例如其大小、杂合度和重复序列含量。这个实践练习将通过分析一个假设的k-mer谱来量化基因组的重复性。通过计算代表独特序列的单倍体峰和代表重复序列的峰下面积之比，你将学会如何从原始计数数据中提取有意义的生物学指标，这是基因组组装和分析中的一项基本技能 [@problem_id:2400957]。", "problem": "k-mer 直方图是通过统计测序读段中长度为 $k$ 的不同子串（k-mer）的数量，并记录每个不同的 k-mer 在读段中出现的次数来构建的。排除低频错误 k-mer 后，对于一个二倍体基因组，剩余的非错误 k-mer 的丰度通常会在平均覆盖度附近形成一个主导的单倍体峰（对应唯一序列），并在更高的丰度处形成对应于重复序列的次级峰。考虑一个深度测序的二倍体基因组（$k=31$）的非错误 k-mer 谱的非重叠分箱。选择的分箱旨在分离两个峰：一个中心位于覆盖度 $c \\approx 40$ 附近的单倍体峰，以及一个中心位于覆盖度 $c \\approx 80$ 附近的重复序列峰。对于每个列出的覆盖度值 $c$，给出了在该丰度下记录的不同 k-mer 的数量。\n\n单倍体峰覆盖度值和计数（覆盖度 $c$；该分箱中不同 k-mer 的数量）：\n- $c = 32$：$2.40 \\times 10^{5}$\n- $c = 36$：$4.80 \\times 10^{5}$\n- $c = 40$：$6.00 \\times 10^{5}$\n- $c = 44$：$4.50 \\times 10^{5}$\n- $c = 48$：$2.00 \\times 10^{5}$\n\n重复序列峰覆盖度值和计数（覆盖度 $c$；该分箱中不同 k-mer 的数量）：\n- $c = 68$：$1.00 \\times 10^{5}$\n- $c = 72$：$2.50 \\times 10^{5}$\n- $c = 76$：$4.00 \\times 10^{5}$\n- $c = 80$：$4.50 \\times 10^{5}$\n- $c = 84$：$4.00 \\times 10^{5}$\n- $c = 88$：$2.80 \\times 10^{5}$\n- $c = 92$：$1.20 \\times 10^{5}$\n\n将重复序列复杂度指数 $R$ 定义为重复序列峰下面积与单倍体峰下面积之比，其中每个峰的面积定义为其覆盖度分箱内所列不同 k-mer 数量的总和。计算 $R$。将您的答案四舍五入到四位有效数字。", "solution": "k-mer 直方图记录了对于每个丰度 $c$，观测到恰好 $c$ 次的不同 k-mer 的数量。当峰区间不重叠且被选择用于分离一个峰时，峰下面积通过对该区间内所有分箱的不同 k-mer 数量求和得到。根据问题中的定义，重复序列复杂度指数 $R$ 为\n$$\nR \\equiv \\frac{A_{\\text{repeat}}}{A_{\\text{haploid}}},\n$$\n其中 $A_{\\text{repeat}}$ 是重复序列峰计数的总和，$A_{\\text{haploid}}$ 是单倍体峰计数的总和。\n\n首先，计算单倍体峰的面积：\n\n$$\nA_{\\text{haploid}} = \\left(2.40 \\times 10^{5}\\right) + \\left(4.80 \\times 10^{5}\\right) + \\left(6.00 \\times 10^{5}\\right) + \\left(4.50 \\times 10^{5}\\right) + \\left(2.00 \\times 10^{5}\\right).\n$$\n\n将各项分组以简化计算：\n\n$$\n\\left(2.40 + 4.80\\right) \\times 10^{5} = 7.20 \\times 10^{5},\n$$\n\n\n$$\n7.20 \\times 10^{5} + 6.00 \\times 10^{5} = 1.32 \\times 10^{6},\n$$\n\n\n$$\n1.32 \\times 10^{6} + 4.50 \\times 10^{5} = 1.77 \\times 10^{6},\n$$\n\n\n$$\n1.77 \\times 10^{6} + 2.00 \\times 10^{5} = 1.97 \\times 10^{6}.\n$$\n\n因此，\n\n$$\nA_{\\text{haploid}} = 1.97 \\times 10^{6}.\n$$\n\n\n接下来，计算重复序列峰的面积：\n\n$$\nA_{\\text{repeat}} = \\left(1.00 \\times 10^{5}\\right) + \\left(2.50 \\times 10^{5}\\right) + \\left(4.00 \\times 10^{5}\\right) + \\left(4.50 \\times 10^{5}\\right) + \\left(4.00 \\times 10^{5}\\right) + \\left(2.80 \\times 10^{5}\\right) + \\left(1.20 \\times 10^{5}\\right).\n$$\n\n逐步求和：\n\n$$\n\\left(1.00 + 2.50\\right) \\times 10^{5} = 3.50 \\times 10^{5},\n$$\n\n\n$$\n3.50 \\times 10^{5} + 4.00 \\times 10^{5} = 7.50 \\times 10^{5},\n$$\n\n\n$$\n7.50 \\times 10^{5} + 4.50 \\times 10^{5} = 1.20 \\times 10^{6},\n$$\n\n\n$$\n1.20 \\times 10^{6} + 4.00 \\times 10^{5} = 1.60 \\times 10^{6},\n$$\n\n\n$$\n1.60 \\times 10^{6} + 2.80 \\times 10^{5} = 1.88 \\times 10^{6},\n$$\n\n\n$$\n1.88 \\times 10^{6} + 1.20 \\times 10^{5} = 2.00 \\times 10^{6}.\n$$\n\n因此，\n\n$$\nA_{\\text{repeat}} = 2.00 \\times 10^{6}.\n$$\n\n\n构建比率：\n\n$$\nR = \\frac{A_{\\text{repeat}}}{A_{\\text{haploid}}} = \\frac{2.00 \\times 10^{6}}{1.97 \\times 10^{6}} = \\frac{2.00}{1.97}.\n$$\n\n\n计算比率：\n\n$$\n\\frac{2.00}{1.97} = 1.015228426\\ldots\n$$\n\n四舍五入到四位有效数字，\n\n$$\nR = 1.015.\n$$", "answer": "$$\\boxed{1.015}$$", "id": "2400957"}, {"introduction": "k-mer谱分析在医学基因组学中具有重要应用，尤其是在分析包含不同细胞群体的混合样本（如肿瘤组织）时。这个练习模拟了一个在癌症研究中常见的场景：从肿瘤-正常混合样本的测序数据中识别体细胞突变。通过这个练习，你将学习如何基于肿瘤纯度和测序深度等关键参数，建立一个数学模型来预测携带体细胞突变的k-mer在谱中的预期位置 [@problem_id:2401000]。", "problem": "对一个由正常细胞和肿瘤细胞混合组成的组织样本进行全基因组测序实验。肿瘤细胞比例（肿瘤纯度）为 $0.15$。测序是无偏的，因此源自肿瘤细胞的 reads 的预期比例等于肿瘤细胞比例。在所有考虑的位点上，基因组是二倍体且拷贝数中性。相对于所选的 $k$ 值，reads 足够长，因此一个独特的 $k$-mer 的预期多重性等于其基因组位点上的预期测序深度。测序错误已被过滤，因此错误的 $k$-mer 可以忽略不计，并且 $k$ 值足够大，使得覆盖单核苷酸体细胞突变的 $k$-mer 在基因组中是唯一的。\n\n设混合样本的平均单碱基测序深度为 $D = 80$。考虑那些唯一跨越仅存在于肿瘤细胞中的杂合性体细胞点突变的 $k$-mer。在上述假设下，您预期这些携带突变的 $k$-mer 会以何种预期多重性 $x$（这些携带突变的 $k$-mer 在 $k$-mer 多重性谱中峰值的众数位置）出现？请以单个实数形式提供 $x$。无需四舍五入，答案中不应包含单位。", "solution": "**步骤1：提取已知条件**\n- 肿瘤细胞比例（肿瘤纯度）：$p = 0.15$\n- 基因组状态：二倍体且拷贝数中性。\n- 混合样本的平均单碱基测序深度：$D = 80$\n- 突变类型：仅存在于肿瘤细胞中的杂合性体细胞点突变。\n- 假设1：源自肿瘤细胞的 reads 的预期比例等于肿瘤细胞比例。\n- 假设2：一个独特的 $k$-mer 的预期多重性等于其基因组位点上的预期测序深度（具体而言，是该 $k$-mer 所跨越的等位基因的测序深度）。\n- 假设3：测序错误可以忽略不计。\n- 假设4：覆盖单核苷酸体细胞突变的 $k$-mer 在基因组中是唯一的。\n\n**求解过程**\n\n目标是计算仅在肿瘤细胞中发现的、包含杂合性体细胞突变的 $k$-mer 的预期多重性 $x$。该多重性等同于突变等位基因的预期测序深度。\n\n设 $D$ 为混合样本的总平均测序深度，给定值为 $D = 80$。\n设 $p$ 为肿瘤纯度，即样本中肿瘤细胞的比例，给定值为 $p = 0.15$。因此，正常细胞的比例为 $1-p$。\n\n总测序深度 $D$ 由源自正常细胞和肿瘤细胞的 reads 组成。\n来自正常细胞的预期深度贡献为 $D_{normal} = D \\times (1-p)$。\n来自肿瘤细胞的预期深度贡献为 $D_{tumor} = D \\times p$。\n\n我们考虑一个存在杂合性体细胞突变的特定基因组位点。设参考等位基因为 'A'，突变等位基因为 'a'。\n- **正常细胞：** 这些细胞是二倍体，不包含该突变。它们在此位点的基因型为 AA。\n- **肿瘤细胞：** 这些细胞是二倍体，并包含一个杂合突变。它们在此位点的基因型为 Aa。\n\n覆盖此位点的 reads 将由支持等位基因 'A' 的 reads 和支持等位基因 'a' 的 reads 组成。我们需要找到支持突变等位基因 'a' 的 reads 的预期深度。\n\n来自正常细胞（基因型 AA）的 reads 只会支持参考等位基因 'A'。\n来自肿瘤细胞（基因型 Aa）的 reads，由于是二倍体且杂合，将平均分配以支持参考等位基因 'A' 和突变等位基因 'a'。因此，在肿瘤细胞群体中，'a' 等位基因的频率为 $0.5$。\n\n突变等位基因的预期深度 $D_a$ 完全来源于肿瘤细胞。它等于来自肿瘤细胞的深度与这些细胞中 'a' 等位基因频率的乘积。\n$$\nD_a = D_{tumor} \\times (\\text{frequency of 'a' in tumor cells})\n$$\n代入 $D_{tumor}$ 和等位基因频率的表达式：\n$$\nD_a = (D \\times p) \\times 0.5\n$$\n问题陈述，一个唯一的 $k$-mer 的预期多重性 $x$ 等于它所跨越的等位基因的预期测序深度。因此，携带突变的 $k$-mer 的预期多重性等于 $D_a$。\n$$\nx = D_a = 0.5 \\times p \\times D\n$$\n现在，我们代入给定的数值：$D = 80$ 和 $p = 0.15$。\n$$\nx = 0.5 \\times 0.15 \\times 80\n$$\n$$\nx = 0.5 \\times (0.15 \\times 80) = 0.5 \\times 12\n$$\n$$\nx = 6\n$$\n跨越杂合性体细胞突变的 $k$-mer 的预期多重性为 $6$。该值代表了在 $k$-mer 多重性谱中体细胞突变峰的预期位置。对于杂合性种系变异，其对应的峰值预期多重性将为 $0.5 \\times D = 0.5 \\times 80 = 40$。对于纯合参考 $k$-mer，其峰值将在 $D = 80$ 处。计算出的值 $6$ 与该模型一致。", "answer": "$$\\boxed{6}$$", "id": "2401000"}, {"introduction": "在k-mer分析中，一个普遍的挑战是区分真实的生物信号和测序错误，后者通常在k-mer谱中形成一个巨大的“错误峰”（计数为1的k-mer）。这个实践练习引入了一种严谨的统计学方法，通过将数据集分成两半并比较它们之间单元体k-mer的重叠情况，来检验这个峰是否完全由随机错误构成。这项技能对于确保数据质量至关重要，并能帮助你辨别真实的低频变异与技术噪音 [@problem_id:2400981]。", "problem": "给定一个短脱氧核糖核酸（DNA）读长集，以及一个整数的子串长度参数 $k$。将一个 $k$-mer 定义为在字母表 $\\{A,C,G,T\\}$ 上任意长度为 $k$ 的连续子串。对于每个测试用例，读长集根据读长索引的奇偶性被确定性地划分为两个不相交的一半：偶数索引（从索引0开始）的读长构成第一半，奇数索引的读长构成第二半。对于任意一半 $h \\in \\{1,2\\}$，设 $S_h$ 为在该半部分中出现次数恰好为1的 $k$-mer 的集合（即，相对于该半部分的单元体）。定义 $N_h = |S_h|$，定义 $M = |S_1 \\cap S_2|$，并定义 $U = 4^k$。\n\n考虑一个原假设，即某一半中的所有单元体 $k$-mer 都源于随机独立的测序错误，并且等可能地成为 $U$ 种可能的 $k$-mer 中的任何一种。在此原假设下，$S_1$ 和 $S_2$ 之间的重叠 $M$ 可以用一个泊松随机变量建模，其速率参数为\n$$\n\\lambda \\;=\\; \\frac{N_1 \\cdot N_2}{U}.\n$$\n使用一个单边检验，当 $M$ 值较大时拒绝原假设，其 $p$-值计算如下\n$$\np \\;=\\; \\mathbb{P}\\big[X \\ge M \\,\\big|\\, X \\sim \\mathrm{Poisson}(\\lambda)\\big].\n$$\n固定显著性水平 $\\alpha = 0.01$。如果 $\\lambda = 0$ 且 $M = 0$，则根据定义将 $p$ 设为 $1$。您的程序必须为每个测试用例计算一个布尔值决策，指示是否拒绝原假设（即所有单元体都是错误），以及在合并的单元体集合 $S = S_1 \\cup S_2$ 中生物学上真实的单元体所占比例的估计值。定义估计量\n$$\n\\widehat{f} \\;=\\; \\max\\!\\left(0,\\; \\frac{M - \\lambda}{|S|}\\right),\n$$\n并约定如果 $|S| = 0$，则 $\\widehat{f} = 0$。报告 $\\widehat{f}$，四舍五入到六位小数（平局时舍入到最近的偶数）。在这里，“生物学上真实的”被操作化定义为：其在两个独立半部分中的重复出现超过了原假设下预测的随机碰撞水平的 $k$-mer。\n\n对于下面的每个测试用例：\n- 通过在每半部分的每个读长上滑动一个长度为 $k$ 的窗口，来提取该半部分中的所有 $k$-mer。\n- 在每半部分内部对 $k$-mer 进行计数，以确定 $S_1$ 和 $S_2$。\n- 计算 $N_1$、$N_2$、$M$、$\\lambda$、单边 $p$-值、在 $\\alpha = 0.01$ 下的拒绝决策以及 $\\widehat{f}$。\n\n测试套件（三个用例）：\n1. 用例 A（结构化重叠，$k=5$）。读长（索引 0 到 3）：\n   - 索引 0: \"ACGTTGCATG\"\n   - 索引 1: \"GCATGTCAGT\"\n   - 索引 2: \"TCAGTACGAT\"\n   - 索引 3: \"ACGATGACCT\"\n   使用 $k=5$。\n2. 用例 B（不相交构成，$k=7$）。读长（索引 0 到 1）：\n   - 索引 0: \"AACCAACCA\"\n   - 索引 1: \"GGTTGGTTG\"\n   使用 $k=7$。\n3. 用例 C（边界情况，无 $k$-mer，$k=5$）。读长（索引 0 到 3）：\n   - 索引 0: \"ACGT\"\n   - 索引 1: \"TGCA\"\n   - 索引 2: \"GATC\"\n   - 索引 3: \"CTAG\"\n   使用 $k=5$。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个测试用例的结果应为一个双元素列表 $[d, \\widehat{f}]$，其中 $d$ 是一个布尔值，$\\widehat{f}$ 是一个四舍五入到六位小数的浮点数。例如，一个包含三个用例的输出应如下所示\n  \"[[True,0.123456],[False,0.000000],[False,0.500000]]\"。", "solution": "问题的核心是对两组独特的、低计数的子串（$k$-mer）进行统计比较，这两组子串源自一个DNA读长数据集的两个独立分区。原假设 $H_0$ 假定，在一个数据分区中仅出现一次的所有 $k$-mer（单元体）都是随机测序错误的结果。如果这是真的，那么对于给定的分区（半部分）$h$，其单元体 $k$-mer 集合 $S_h$ 可以被建模为一个大小为 $N_h = |S_h|$ 的随机样本，该样本从大小为 $U = 4^k$ 的所有可能的 $k$-mer 全集中抽取。\n\n在这个随机抽样模型下，两个单元体集合 $S_1$ 和 $S_2$ 之间的共同元素数量 $M = |S_1 \\cap S_2|$ 预计会很小。问题指定用泊松分布对这个重叠计数 $M$ 进行建模。该分布的速率参数 $\\lambda$ 代表期望的重叠数。其推导如下：对于 $S_1$ 中的任意一个 $k$-mer，它同样出现在 $S_2$ 中的概率（如果 $S_2$ 是一个随机样本）是 $p_{overlap} = N_2 / U$。因为 $S_1$ 中有 $N_1$ 个这样的 $k$-mer，所以期望的总重叠数是 $\\mathbb{E}[M] = N_1 \\cdot p_{overlap} = N_1 N_2 / U$。因此，我们得到了指定的速率参数 $\\lambda = \\frac{N_1 N_2}{U}$。\n\n该统计检验是关于观测到的重叠计数 $M$ 的一个单边检验。一个显著大于其期望 $\\lambda$ 的 $M$ 值将提供反对原假设的证据，表明除了随机机会之外，还有其他因素导致相同的单元体出现在两个独立的分区中。我们计算 $p$-值，它是在假设 $H_0$ 为真的情况下，观测到 $M$ 或更多重叠的概率。这由泊松分布的生存函数给出：\n$$\np \\;=\\; \\mathbb{P}\\big[X \\ge M \\,\\big|\\, X \\sim \\mathrm{Poisson}(\\lambda)\\big] \\;=\\; \\sum_{i=M}^{\\infty} \\frac{e^{-\\lambda}\\lambda^i}{i!}\n$$\n如果这个 $p$-值小于或等于显著性水平 $\\alpha = 0.01$，我们就拒绝原假设。\n\n最后，我们被要求估计“生物学上真实的”单元体的比例 $\\widehat{f}$。数量 $M - \\lambda$ 代表观测到的重叠数超过随机机会所期望的数量。这个超出的数量被用作对在两个分区中都是单元体的真实生物学 $k$-mer 数量的估计。分母 $|S| = |S_1 \\cup S_2|$ 是在两个半部分中观测到的独特单元体的总数。因此，估计量为：\n$$\n\\widehat{f} \\;=\\; \\max\\!\\left(0,\\; \\frac{M - \\lambda}{|S|}\\right)\n$$\n$\\max(0, \\cdot)$ 函数确保该比例为非负数，因为负比例没有意义。\n\n我们现在将此过程应用于每个测试用例。\n\n**用例 A：**\n1.  **输入：**$k=5$。读长被划分为第1半：`[\"ACGTTGCATG\", \"TCAGTACGAT\"]` 和第2半：`[\"GCATGTCAGT\", \"ACGATGACCT\"]`。\n2.  **$k$-mer 集合：**我们提取所有的 $5$-mer。\n    - 第1半产生12个不同的 $5$-mer，每个计数为1。因此，$S_1$ 包含这12个 $k$-mer，且 $N_1 = 12$。\n    - 第2半产生12个不同的 $5$-mer，每个计数为1。因此，$S_2$ 包含这12个 $k$-mer，且 $N_2 = 12$。\n3.  **统计数据：**交集为 $S_1 \\cap S_2 = \\{$`\"GCATG\"`, `\"TCAGT\"`, `\"ACGAT\"`$\\}$，因此 $M = 3$。独立单元体的总数为 $|S| = |S_1 \\cup S_2| = N_1 + N_2 - M = 12 + 12 - 3 = 21$。\n4.  **假设检验：**可能的 $5$-mer 总数为 $U = 4^5 = 1024$。泊松速率为 $\\lambda = \\frac{12 \\cdot 12}{1024} = \\frac{144}{1024} = 0.140625$。我们计算从 $\\mathrm{Poisson}(0.140625)$ 分布中观测到 $M = 3$ 个重叠的 $p$-值：\n    $p = \\mathbb{P}[X \\ge 3] \\approx 0.000316$。\n    由于 $p \\approx 0.000316 \\le 0.01$，我们拒绝原假设。决策为 `True`。\n5.  **估计量：**真实单元体的比例估计为：\n    $\\widehat{f} = \\max\\left(0, \\frac{3 - 0.140625}{21}\\right) = \\frac{2.859375}{21} \\approx 0.1361607$。四舍五入到六位小数，$\\widehat{f} = 0.136161$。\n\n**用例 B：**\n1.  **输入：**$k=7$。读长被划分为第1半：`[\"AACCAACCA\"]` 和第2半：`[\"GGTTGGTTG\"]`。\n2.  **$k$-mer 集合：**我们提取所有的 $7$-mer。\n    - 第1半产生3个不同的 $7$-mer，每个计数为1。所以，$N_1 = 3$。\n    - 第2半产生3个不同的 $7$-mer，每个计数为1。所以，$N_2 = 3$。\n3.  **统计数据：**这两组 $k$-mer 不相交。$S_1 \\cap S_2 = \\emptyset$，所以 $M = 0$。独立单元体的总数为 $|S| = N_1 + N_2 - M = 3 + 3 - 0 = 6$。\n4.  **假设检验：**可能的 $7$-mer 总数为 $U = 4^7 = 16384$。泊松速率为 $\\lambda = \\frac{3 \\cdot 3}{16384} = \\frac{9}{16384} \\approx 0.000549$。我们计算观测到 $M=0$ 的 $p$-值：\n    $p = \\mathbb{P}[X \\ge 0] = 1$。\n    由于 $p = 1  0.01$，我们不拒绝原假设。决策为 `False`。\n5.  **估计量：**真实单元体的比例估计为：\n    $\\widehat{f} = \\max\\left(0, \\frac{0 - 9/16384}{6}\\right) = 0$。四舍五入到六位小数，$\\widehat{f} = 0.000000$。\n\n**用例 C：**\n1.  **输入：**$k=5$。四个读长 `[\"ACGT\", \"TGCA\", \"GATC\", \"CTAG\"]` 的长度都为4。\n2.  **$k$-mer 集合：**无法从长度为4的字符串中提取长度为 $k=5$ 的子串。因此，两个半部分都产生零个 $k$-mer。$S_1 = \\emptyset$ 且 $S_2 = \\emptyset$。\n3.  **统计数据：**从空集中，我们得到 $N_1 = 0$，$N_2 = 0$，$M = 0$ 且 $|S|=0$。\n4.  **假设检验：**泊松速率为 $\\lambda = \\frac{0 \\cdot 0}{1024} = 0$。问题定义对于 $\\lambda = 0$ 且 $M=0$ 的情况，我们必须将 $p$ 设为1。\n    由于 $p = 1  0.01$，我们不拒绝原假设。决策为 `False`。\n5.  **估计量：**问题定义如果 $|S|=0$，则 $\\widehat{f}=0$。因此，$\\widehat{f} = 0.000000$。", "answer": "```\n[[True, 0.136161],[False, 0.000000],[False, 0.000000]]\n```", "id": "2400981"}]}