{"hands_on_practices": [{"introduction": "最大似然法构建的系统发育树不仅仅是进化关系的示意图，其分支长度也包含了丰富的定量信息。在系统发育图中，分支长度通常与进化变化的数量成正比，理解分支长度的精确含义是解读分析结果、避免常见误解的关键第一步。这个练习将帮助你通过一个具体的例子来阐明分支长度的统计学意义。[@problem_id:1946202]", "problem": "一个进化生物学家团队正在使用一个线粒体基因的DNA序列数据，研究四种深海珊瑚（物种A、B、C和D）之间的亲缘关系。他们对序列进行比对，并采用最大似然（ML）系统发育分析，这是一种推断进化树的统计方法。ML算法会针对给定的树拓扑结构和核苷酸替换模型，计算观测到的序列数据的似然值，其输出包括一个系统发育图，其中分支长度与估计的进化变化量成正比。\n\n得到的系统发育图显示了 ((A,B),C),D) 的树拓扑结构。通往物种A、物种B的分支以及连接它们的内部分支都相对较短。通往物种C的分支长度中等。然而，通往物种D的末端分支异常地长，表明ML模型为该谱系估计的分支长度参数值很高。\n\n根据最大似然系统发育学的原理，以下哪个陈述为通往物种D的长分支提供了最直接和最确切的解释？\n\nA. 物种D是“活化石”，代表了整个类群的祖先状态。\n\nB. 在通往物种D的谱系中，线粒体基因每个位点累积的估计核苷酸替换数明显多于其他谱系。\n\nC. 物种D的序列数据可能包含大量测序错误，模型将其误认为是真实的突变。\n\nD. 物种D必定是包含物种A、B和C的进化支的外群。\n\nE. 在通往物种D的谱系中，物种形成速率要慢得多。", "solution": "在指定核苷酸替换模型的最大似然系统发育分析中，似然函数为 $\\mathcal{L}(\\text{data} \\mid \\text{topology}, \\{\\ell_{i}\\}, \\theta)$，其中 $\\ell_{i}$ 是分支长度，$\\theta$ 是模型参数。分支长度的ML估计值使该似然函数最大化，并被解释为沿每个分支每个位点的预期替换数，通常以“每个位点的替换数”为单位。形式上，对于一个随时间变化的瞬时替换率为 $r(t)$ 的谱系，其分支长度为 $\\ell=\\int r(t)\\,dt$，因此，较大的 $\\ell$ 反映了该谱系沿线累积的每个位点预期替换数更大。\n\n在报告的系统发育图中，通往物种D的末端分支相对于其他分支异常地长。根据ML系统发育图中分支长度的定义，最直接和最确切的解释是，ML模型估计出沿通往D的谱系，每个位点的核苷酸替换数远大于其他谱系。\n\n评估各个选项：\n- A是错误的：长分支并不表示祖先状态；它表示推断出的变化更大，而不是停滞或原始性。\n- B是正确的：更长的分支长度直接意味着在该谱系上，根据ML模型估计的每个位点的替换数更多。\n- C不是一个直接或确切的解释：虽然测序错误原则上可以夸大表观的变化，但这只是一个关于数据质量的推测性假设，并不能仅从ML的输出中推断出来。\n- D是错误的：长分支并不意味着外群地位；确定根需要外部信息，而长分支吸引是一个已知的假象，但它既不是确定无疑的，也不是外群的定义。\n- E是错误的：分支长度反映的是分子水平的变化（每个位点的替换数），而不是物种形成速率。\n\n因此，最直接和最确切的解释是，通往物种D的谱系累积了更多的每个位点估计替换数。", "answer": "$$\\boxed{B}$$", "id": "1946202"}, {"introduction": "在真实的生物信息学分析中，我们处理的数据集很少是完美无缺的，缺失数据是普遍存在的挑战。一个强大的统计方法，如最大似然法，必须有原则性地处理这些不完整信息的能力。此练习探讨了当序列比对中某个物种含有大量缺失数据（用“?”表示）时，最大似然法是如何通过边际化（marginalization）来严谨地处理这种情况，并揭示了这种处理方式对分支长度估计的具体统计学影响。[@problem_id:2402743]", "problem": "在最大似然法（ML）的系统发育分析中，考虑一个固定的、正确指定的包含四个分类单元的无根树，其拓扑结构已知，但分支长度未知。假设使用一个时间同质性、时间可逆性、平稳的核苷酸替换模型，该模型具有相等的碱基频率和相等的替换速率（即 Jukes–Cantor 模型），以及一个长度为 $N$ 的比对序列，其中各位点在该树上独立同分布地演化。其中一个分类单元（称之为分类单元 $D$）有 $90\\%$ 的位点被编码为缺失数据（用符号“?”表示），且分类单元 $D$ 的数据缺失在各位点间独立发生，并且与真实的核苷酸状态无关（即完全随机缺失）。在标准的ML缺失数据处理方法中，叶节点上的“?”被视为未知/模糊状态，单位点的似然值会通过对该叶节点所有可能的真实核苷酸状态进行边缘化来计算。\n\n设 $b_{D}$ 表示连接到分类单元 $D$ 的末端分支长度。以下哪个陈述最能描述分类单元 $D$ 的 $90\\%$ 缺失数据对其分支长度 $b_{D}$ 的ML估计产生的影响？\n\nA. 只有能观测到分类单元 $D$ 的大约 $0.1N$ 个位点直接为 $b_{D}$ 提供信息；在模型下，剩下的大约 $0.9N$ 个位点对 $b_{D}$ 不贡献任何信息，因此当 $N \\to \\infty$ 时，$b_{D}$ 的ML估计量保持一致性，但相对于完整数据的情况，其方差会增加。\n\nB. 因为“?”被视为与每个核苷酸都匹配，所以缺失位点的单位点似然值对较长分支的惩罚最强，因此随着 $N$ 的增加，$b_{D}$ 的ML估计值会趋向于 $0$。\n\nC. 分类单元 $D$ 的 $90\\%$ 缺失数据导致树中所有分支的长度（包括与 $D$ 无关的内部分支）被低估大约 $90\\%$。\n\nD. 缺失位点会引导算法为分类单元 $D$ 填补随机的核苷酸，这会系统性地将 $b_{D}$ 的ML估计值抬高到其真实值之上。\n\nE. 无论其他分类单元的数据如何，在分类单元 $D$ 存在 $90\\%$ 缺失数据的情况下，与 $D$ 相邻的内部分支变得不可识别，因此对于该分支，ML估计问题缺少一个明确定义的最大值。", "solution": "给定树的拓扑结构和分支长度 $\\mathbf{b}$，比对序列 $S$ 的总似然值是每个位点似然值的乘积，这是基于独立性的假设：\n$$L(\\mathbf{b} | S) = \\prod_{i=1}^{N} L_i(\\mathbf{b} | S_i)$$\n其中 $S_i$ 是位点 $i$ 的字符数据。对数似然值为 $\\ell(\\mathbf{b}) = \\sum_{i=1}^{N} \\log L_i(\\mathbf{b} | S_i)$。\n\n单一位点的似然值使用 Felsenstein 的剪枝算法计算。该算法通过在每个内部节点上递归计算“部分似然”，并对每个节点所有可能的状态求和，从而计算出在树的叶节点上观测到当前状态的概率。\n\n我们来分析比对序列中两类位点的计算：\n1.  **能观测到分类单元 $D$ 的位点**：这对应于大约 $0.1N$ 个位点。在这样的位点，分类单元 $D$ 的状态是一个特定的核苷酸（例如，$A$、$C$、$G$ 或 $T$）。剪枝算法从这个叶节点开始，其部分似然向量对于观测到的状态为1，其他状态为0（例如，对于状态 $A$，向量为 $(1, 0, 0, 0)^T$）。这个向量沿着长度为 $b_D$ 的分支向树的上方传播。该位点的似然贡献将明确地依赖于分支长度 $b_D$ 上的转移概率。因此，这些位点包含关于 $b_D$ 的信息。\n\n2.  **分类单元 $D$ 数据缺失的位点**：这对应于大约 $0.9N$ 个位点。分类单元 $D$ 的状态是“?”。标准的ML实践将其视为模糊性，意味着真实状态可能是任何可能的核苷酸。似然值通过对这些可能性进行边缘化来计算。在剪枝算法中，这是通过将分类单元 $D$ 的初始部分似然向量设置为 $(1, 1, 1, 1)^T$ 来实现的。\n\n设 $P(b_D)$ 是连接到分类单元 $D$ 的分支的转移概率矩阵。该矩阵的元素 $[P(b_D)]_{xy}$ 给出了在祖先节点状态为 $x$ 的条件下，在叶节点观测到状态 $y$ 的概率。当这个向量从叶节点 $D$ 传播到其父节点 $u$ 时，得到的部分似然向量由 $P(b_D)^T (1, 1, 1, 1)^T$ 给出。\n\n对于任何时间可逆的替换模型，包括 Jukes-Cantor 模型，转移矩阵 $P(t)$ 的各列之和为1。这是因为碱基的均匀分布是平稳的。因此，转置矩阵 $P(t)^T$ 的各行之和为1。乘积 $P(b_D)^T (1, 1, 1, 1)^T$ 得到一个向量，其元素是 $P(b_D)^T$ 各行之和，结果就是 $(1, 1, 1, 1)^T$。\n\n这意味着包含分类单元 $D$ 的子树对树其余部分的贡献是一个全为1的向量，该向量与分支长度 $b_D$ 无关。因此，对于分类单元 $D$ 数据为“?”的任何位点，其总似然值不是 $b_D$ 的函数。\n\n总对数似然可以被划分为：\n$$\\ell(\\mathbf{b}) = \\sum_{i \\in \\text{sites with observed } D} \\log L_i(\\mathbf{b}) + \\sum_{j \\in \\text{sites with missing } D} \\log L_j(\\mathbf{b})$$\n为了找到 $b_D$ 的ML估计值，我们求解 $\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = 0$。\n其导数为：\n$$\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = \\sum_{i \\in \\text{sites with observed } D} \\frac{\\partial \\log L_i(\\mathbf{b})}{\\partial b_D} + \\sum_{j \\in \\text{sites with missing } D} \\frac{\\partial \\log L_j(\\mathbf{b})}{\\partial b_D}$$\n由于对于 $D$ 数据缺失的位点，$L_j(\\mathbf{b})$ 与 $b_D$ 无关，因此第二项为零。\n$$\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = \\sum_{i \\in \\text{sites with observed } D} \\frac{\\partial \\log L_i(\\mathbf{b})}{\\partial b_D}$$\n这表明，只有能够观测到分类单元 $D$ 数据的位点才对其末端分支长度 $b_D$ 的估计有贡献。\n\n其统计学上的后果如下：\n- **一致性**：$b_D$ 的ML估计量是基于大约 $0.1N$ 的有效样本量。由于当 $N \\to \\infty$ 时，这个样本量仍然趋于无穷大，因此 $b_D$ 的ML估计量保持一致性（即，它依概率收敛于 $b_D$ 的真实值）。不存在系统性偏差。\n- **方差**：关于一个参数的信息量与样本量有关。现在，$b_D$ 的费雪信息仅来源于大约 $10\\%$ 的位点。由于ML估计量的渐近方差是费雪信息的倒数，因此 $b_D$ 估计值的方差将大约是完整数据情况下的10倍。\n\n现在，我们来评估每个选项：\n\n**A. 只有能观测到分类单元 $D$ 的大约 $0.1N$ 个位点直接为 $b_{D}$ 提供信息；在模型下，剩下的大约 $0.9N$ 个位点对 $b_{D}$ 不贡献任何信息，因此当 $N \\to \\infty$ 时，$b_{D}$ 的ML估计量保持一致性，但相对于完整数据的情况，其方差会增加。**\n该陈述与我们的推导完全一致。分类单元 $D$ 数据缺失的位点对对数似然函数关于 $b_D$ 的梯度的贡献为零，这意味着它们不为 $b_D$ 的估计提供任何信息。估计量保持一致性，因为信息性位点的数量仍随 $N$ 增长到无穷大。方差增加是因为有效样本量急剧减少。**正确。**\n\n**B. 因为“?”被视为与每个核苷酸都匹配，所以缺失位点的单位点似然值对较长分支的惩罚最强，因此随着 $N$ 的增加，$b_{D}$ 的ML估计值会趋向于 $0$。**\n这是不正确的。如上所示，缺失位点的单位点似然值与 $b_D$ 无关。它既不惩罚也不偏好任何特定的 $b_D$ 值。$b_D$ 的ML估计量是一致的，而不是偏向于 $0$。**不正确。**\n\n**C. 分类单元 $D$ 的 $90\\%$ 缺失数据导致树中所有分支的长度（包括与 $D$ 无关的内部分支）被低估大约 $90\\%$。**\n这是不正确的。其他分支长度（例如分类单元 $A$、$B$ 和 $C$ 子树内的分支）的估计利用了所有 $N$ 个位点的信息。对于 $D$ 缺失的 $90\\%$ 的位点，数据表现得像一个三分类单元的比对序列，这对于 $A$、$B$ 和 $C$ 之间的关系仍然是信息性的。没有理由预期会出现系统性低估，更不用说低估 $90\\%$ 了。所有分支长度的估计量都应该是一致的。**不正确。**\n\n**D. 缺失位点会引导算法为分类单元 $D$ 填补随机的核苷酸，这会系统性地将 $b_{D}$ 的ML估计值抬高到其真实值之上。**\n这是对ML方法的错误描述。ML不会用随机值来填补（即“填充”）缺失数据。它正确地对不确定性进行积分（边缘化）。这个过程不会引入系统性偏差；$b_D$ 的估计量是一致的。填补随机数据可能会导致偏差（高估 $b_D$，因为随机数据会比真实数据看起来分化更大），但这不是指定算法所做的事情。**不正确。**\n\n**E. 无论其他分类单元的数据如何，在分类单元 $D$ 存在 $90\\%$ 缺失数据的情况下，与 $D$ 相邻的内部分支变得不可识别，因此对于该分支，ML估计问题缺少一个明确定义的最大值。**\n这是不正确的。一个无根的四分类单元树有一个内部分支。尽管在分类单元 $D$ 缺失的 $90\\%$ 的位点中，该分支确实是不可识别的（因为数据退化为一个三分类单元的星状树），但在所有四个分类单元都被观测到的 $10\\%$ 的位点中，它仍然是可识别的。只要存在非零比例的完整数据位点，四分类单元树的所有参数在理论上都是可识别的。估计问题有一个明确定义的最大值，尽管内部分支的估计精度会很差。**不正确。**", "answer": "$$\\boxed{A}$$", "id": "2402743"}, {"introduction": "系统发育分析的目标不仅是找到一棵“最佳”树，还包括评估我们对树中各个分支的置信度。一个核心问题是：数据是否显著支持某个特定的进化分支？这个问题可以通过检验一个内部自分支（internal branch）的长度是否显著大于零来回答。这个练习将引导你探索一个内部自分支长度为零的极限情况，这在数学上等同于一个未解析的多歧分叉（polytomy），从而让你理解系统发育中假设检验的基本原理。[@problem_id:2402770]", "problem": "考虑一棵具有 $n \\ge 4$ 个分类单元的无根、完全二分的系统发育树 $T$。沿每条分支的序列演化由一个均匀、时间可逆的连续时间马尔可夫链 (CTMC) 建模，其速率矩阵为 $Q$，因此沿长度为 $t$ 的分支的转移概率矩阵为 $P(t)=\\exp(Qt)$。令 $L(T,\\mathbf{t}\\,|\\,\\mathcal{D})$ 表示在固定的比对 $\\mathcal{D}$ 下的最大似然 (ML) 系统发育似然值，该值在标准的位点独立性假设下计算，其中 $\\mathbf{t}$ 表示非负分支长度的向量。现在选择 $T$ 的一条内部边 $e^{\\ast}$，并将其长度精确设置为 $t_{e^{\\ast}}=0$，从而折叠该边，并在由 $e^{\\ast}$ 连接的两个内部节点的位置上创建一个度为 $4$ 的单个节点（一个四分支多分体结构）。考虑该多分体结构的三种二分解析，这些解析是通过恢复一条正长度的内部分支，以三种可能的方式之一分割四个相邻的子树而获得的。\n\n关于似然值的哪项陈述是正确的？\n\nA. 函数 $t \\mapsto L(T,\\mathbf{t}\\,|\\,\\mathcal{D})$ 在 $t_{e^{\\ast}}=0$ 处是连续的，因此设置 $t_{e^{\\ast}}=0$ 所得的值与从任意一种二分解析得到的 $\\lim_{t \\to 0^{+}} L$ 相同，并且这三个极限在 $t=0$ 处重合。\n\nB. 似然值在 $t_{e^{\\ast}}=0$ 处变得无定义，因为该边上的转移概率无法计算，所以标准的剪枝递归会失败。\n\nC. 对于任何数据集 $\\mathcal{D}$，强制 $t_{e^{\\ast}}=0$ 会严格增加似然值，因为在没有惩罚项的最大似然估计中，减少一个参数可以防止过拟合。\n\nD. 在 $t_{e^{\\ast}}=0$ 处的似然值等于通过多分体结构的三种二分解析所获得的 3 棵完全解析树的最大化似然值的算术平均值。\n\nE. 对于邻近多分体结构的任意固定二分解析，将 $L$ 视为内部分支长度 $t:=t_{e^{\\ast}}$ 的函数，则有 $L(t=0) \\le \\sup_{t>0} L(t)$，等式成立当且仅当该内部分支长度的最大似然估计值为 $t^{\\star}=0$。", "solution": "我们分析在速率矩阵为 $Q$ 的连续时间马尔可夫链 (CTMC) 模型下，将单个内部分支长度精确设置为零的影响。\n\n基本原理设置。在 CTMC 模型下，沿长度为 $t$ 的分支的转移概率矩阵为 $P(t)=\\exp(Qt)$。矩阵指数满足 $P(0)=\\exp(Q \\cdot 0)=I$，其中 $I$ 是单位矩阵。对于给定的无根树 $T$、分支长度 $\\mathbf{t}$ 和比对 $\\mathcal{D}$，位点似然值的计算方法是：在任意根节点乘以平衡分布，然后对所有内部节点状态求和，求和内容是所有边上由其端点状态决定的相应转移概率的乘积（Felsenstein 的剪枝算法）。总似然值 $L(T,\\mathbf{t}\\,|\\,\\mathcal{D})$ 是这些位点似然值在所有位点上的乘积（或对数似然值之和）。\n\n$t_{e^{\\ast}}=0$ 的影响。如果我们将边 $e^{\\ast}$ 的长度设置为 $t_{e^{\\ast}}=0$，则 $P(t_{e^{\\ast}})=P(0)=I$，这意味着与 $e^{\\ast}$ 相邻的两个节点上的状态在该边上必须相同的概率为 1。在剪枝递归中，这相当于将两个节点合并为一个节点，因此在折叠后的树上进行评估是明确定义的。因为 $t \\mapsto \\exp(Qt)$ 是连续的（实际上是解析的），所以作为 $t_{e^{\\ast}}$ 的函数的似然值在 $t=0$ 处是连续的，并且在 $t=0$ 处的值等于 $t \\to 0^{+}$ 时的极限。\n\n不同二分解析下极限的等价性。在一棵无根二分树中，折叠一条内部边 $e^{\\ast}$ 会产生一个度为 4 的节点，该节点与四个子树相邻。这三种二分解析对应于用一条正长度的内部分支重新连接这些子树的三种可能方式。对于每一种二分解析，让新引入的内部分支长度 $t \\to 0^{+}$ 会迫使该边上的 $P(t) \\to I$，因此似然值收敛于同一个折叠后的、未解析的四分支结构的似然值。因此，来自所有三种解析的极限是重合的，并且等于多分体结构（$t=0$）处的似然值。\n\n优化方面的启示。对于任意固定的二分解析，考虑似然值 $L(t)$ 作为内部分支长度 $t:=t_{e^{\\ast}} \\ge 0$ 的函数，其中所有其他分支长度和模型参数都已相应地优化（或保持固定）。因为 $t=0$ 是允许域 $t \\ge 0$ 中的一个特定值，所以有 $L(0) \\le \\sup_{t \\ge 0} L(t)$。如果我们将注意力限制在 $t>0$ 上，连续性意味着 $\\sup_{t>0} L(t) \\ge L(0)$，等式成立当且仅当最大值出现在边界 $t^{\\star}=0$ 处（即，该内部分支的最大似然估计值为零）。在没有任何惩罚项的情况下，仅仅将一个参数固定为特定值通常不能严格增加最大似然值，除非无约束最优解已经位于该值上。\n\n逐项分析：\n\nA. 此陈述正确。由于 $P(t)=\\exp(Qt)$ 是连续的且 $P(0)=I$，因此似然值作为 $t_{e^{\\ast}}$ 的函数在 $t=0$ 处是连续的。折叠该边所得的值与取 $t \\to 0^{+}$ 时的极限相同。此外，当 $t \\to 0^{+}$ 时，四分支结构的三种可能的二分解析都收敛于同一棵折叠后的树，因此它们的极限重合。\n\nB. 此陈述不正确。在 $t=0$ 处，$P(0)=I$ 是明确定义的，并且剪枝算法仍然适用。不存在奇点；相反，该边强制其端点上的状态相同。\n\nC. 此陈述不正确。在无惩罚项的最大似然 (ML) 中，减少自由参数的数量本身并不能保证似然值会增加。对于单个内部分支长度 $t$，$L(0)$ 不能超过 $L(t)$ 在 $t \\ge 0$ 上的上确界；只有当最大似然估计值为 $t^{\\star}=0$ 时，两者才会相等。\n\nD. 此陈述不正确。算术平均关系没有理论依据。$t=0$ 处的值等于三个似然函数在 $t \\to 0^{+}$ 时的共同极限，而不是它们在各自的最大似然分支长度下（通常不同）的最大化值的平均值。\n\nE. 此陈述正确。对于任意固定的解析，$L(0) \\le \\sup_{t>0} L(t)$ 根据上确界的定义和在 0 处的连续性而成立，等式成立当且仅当最大似然估计值位于边界 $t^{\\star}=0$ 处。\n\n因此，正确的选项是 A 和 E。", "answer": "$$\\boxed{AE}$$", "id": "2402770"}]}