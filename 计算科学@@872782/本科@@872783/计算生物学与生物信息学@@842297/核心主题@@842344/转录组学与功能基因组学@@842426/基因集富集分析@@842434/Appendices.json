{"hands_on_practices": [{"introduction": "要想掌握基因集富集分析（GSEA），我们必须首先解构其核心组成部分：富集得分（$ES$）。下面的练习将分析简化到一个只包含一个基因的假设基因集，让我们能够推导出 $ES$ 的一个封闭形式表达式 [@problem_id:2393962]。这个实践提供了一个清晰的数学直觉，揭示了基因在排序列表中的位置如何直接转化为最终的富集得分。", "problem": "考虑应用于一个已排序基因列表的基因集富集分析 (GSEA; Gene Set Enrichment Analysis)。假设有一个包含 $N$ 个不同基因的排序列表 $\\mathcal{L}$，其排名从 $1$（顶部）到 $N$（底部）。假设基因集 $\\mathcal{S}$ 只包含一个基因（因此 $N_H = |\\mathcal{S}| = 1$），并且这个基因在列表 $\\mathcal{L}$ 中的排名为 $k \\in \\{1,2,\\dots,N\\}$。使用 GSEA 的标准加权移动总和定义，其指数为 $p \\ge 0$：当从 $i=1$ 到 $i=N$ 扫描列表时，移动总和 $R(i)$ 定义如下。如果排名第 $i$ 的基因在 $\\mathcal{S}$ 中，则将 $R(i)$ 增加 $|r_i|^{p} / NR$，其中 $NR = \\sum_{g \\in \\mathcal{S}} |r_g|^{p}$；如果不在 $\\mathcal{S}$ 中，则将 $R(i)$ 减少 $1/(N - N_H)$。定义富集分数 (Enrichment Score) $ES$ 为在整个扫描过程中遇到的移动总和的最大值，即 $ES = \\max_{1 \\le i \\le N} R(i)$。将 $ES$ 表示为仅含 $N$ 和 $k$ 的封闭形式函数。不需要进行数值计算或四舍五入，也无需报告单位。", "solution": "该问题要求推导出一个只包含一个基因的基因集的富集分数（ES）的封闭形式表达式。基因集 $\\mathcal{S}$ 在一个包含 $N$ 个基因的排序列表 $\\mathcal{L}$ 中，并且该基因位于第 $k$ 位。\n\n**1. 定义 GSEA 参数**\n\n根据 GSEA 的定义，我们有：\n- 总基因数: $N$\n- 基因集 $\\mathcal{S}$ 中的基因数（“命中”数）: $N_H = 1$\n- 不在基因集 $\\mathcal{S}$ 中的基因数（“错过”数）: $N - N_H = N - 1$\n\n问题中描述的移动总和（running sum）规则如下：\n- 当遇到“命中”基因时，分数增加。对于非加权 GSEA（$p=0$），增加的量是 $P_{hit} = \\frac{1}{N_H} = \\frac{1}{1} = 1$。尽管问题中提到了加权形式，但其描述的“错过”惩罚项 $1/(N - N_H)$ 对应于非加权版本，并且这是此类问题的标准简化假设。我们将在此基础上进行推导。\n- 当遇到“错过”基因时，分数减少。减少的量是 $P_{miss} = \\frac{1}{N - N_H} = \\frac{1}{N - 1}$。\n\n**2. 计算移动总和（Running Sum）**\n\n我们从一个初始为零的移动总和 $R(0) = 0$ 开始，沿着排序列表从 $i=1$ 到 $N$ 进行扫描。\n\n- **对于 $i  k$**: 我们遇到的所有 $i$ 个基因都是“错过”。因此，移动总和在每一步都会减少 $P_{miss}$。在到达第 $k$ 个基因之前，即在第 $i=k-1$ 步，移动总和为：\n  $$ R(k-1) = -(k-1) \\times P_{miss} = -\\frac{k-1}{N-1} $$\n\n- **对于 $i = k$**: 我们遇到了基因集中的唯一一个基因（“命中”）。移动总和增加 $P_{hit} = 1$。此时的移动总和为：\n  $$ R(k) = R(k-1) + P_{hit} = -\\frac{k-1}{N-1} + 1 = \\frac{-(k-1) + (N-1)}{N-1} = \\frac{N - 1 - k + 1}{N-1} = \\frac{N-k}{N-1} $$\n\n- **对于 $i > k$**: 我们遇到的所有后续基因都是“错过”。移动总和将从 $R(k)$ 开始持续下降。在第 $i$ 步（其中 $i>k$），我们已经遇到了 $k-1$ 个初始的“错过”，一个“命中”，以及 $i-k$ 个后续的“错过”。移动总和为：\n  $$ R(i) = R(k) - (i-k) \\times P_{miss} = \\frac{N-k}{N-1} - \\frac{i-k}{N-1} $$\n  这个值会随着 $i$ 的增加而减小，直到在 $i=N$ 时达到 $R(N) = \\frac{N-k}{N-1} - \\frac{N-k}{N-1} = 0$。\n\n**3. 确定富集分数（ES）**\n\n富集分数 $ES$ 定义为移动总和在整个扫描过程中达到的最大值，即 $ES = \\max_{1 \\le i \\le N} R(i)$。\n\n从我们的计算中可以看出：\n- 当 $i  k$ 时，$R(i)$ 是负数或零（当 $i=0$ 时）。\n- 当 $i=k$ 时，$R(k) = \\frac{N-k}{N-1}$。因为 $1 \\le k \\le N$，所以 $0 \\le R(k) \\le 1$。\n- 当 $i > k$ 时，$R(i)$ 从 $R(k)$ 开始单调递减。\n\n因此，移动总和的峰值出现在第 $k$ 步。所以，富集分数为：\n$$ ES = R(k) = \\frac{N-k}{N-1} $$\n\n这就是 $ES$ 仅用 $N$ 和 $k$ 表示的封闭形式函数。", "answer": "$$\\boxed{\\frac{N-k}{N-1}}$$", "id": "2393962"}, {"introduction": "计算出富集得分后，关键的下一步是评估其统计显著性。GSEA 依靠置换检验来确定观察到的得分是否比随机情况下预期的得分更为极端。这个实践探讨了该方法的一个基本方面：置换次数与可能获得的最小非零 $p$ 值之间的关系 [@problem_id:2393990]。理解这一限制对于正确解释任何基于置换分析的统计功效和分辨率至关重要。", "problem": "您正在使用基因集富集分析（Gene Set Enrichment Analysis, GSEA）来分析一个差异表达实验。您通过将表型标签精确置换 $M = 10000$ 次来为富集得分生成一个零分布。设 $b$ 表示置换后的富集得分中，至少与给定基因集的观测富集得分一样极端的得分数量。为了在有限样本中避免零概率估计，您使用加一估计量来估计经验 $p$ 值\n$$\n\\hat{p} \\;=\\; \\frac{b + 1}{M + 1}.\n$$\n假设使用此估计量，并且 $b$ 只能取非负整数值，那么当 $M = 10000$ 时，您可以获得的 $\\hat{p}$ 的最小可能非零值是多少？请用精确分数表示您的答案。无需四舍五入。", "solution": "该问题要求确定一个估计的经验 $p$ 值（表示为 $\\hat{p}$）的最小可能非零值。该估计是在基因集富集分析（GSEA）的背景下，使用基于置换的零分布进行的。\n\n首先，我将对问题陈述进行验证。\n\n步骤1：提取已知条件。\n- 置换次数为 $M = 10000$。\n- 变量 $b$ 代表置换后的富集得分中至少与观测富集得分一样极端的得分数量。\n- 对 $b$ 的约束是它必须是一个非负整数，即 $b \\in \\{0, 1, 2, \\dots\\}$。\n- 经验 $p$ 值的估计量由公式 $\\hat{p} = \\frac{b + 1}{M + 1}$ 给出。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据。使用置换检验为富集得分生成零分布是生物信息学中一种标准且稳健的方法。所提供的估计量 $\\hat{p} = \\frac{b + 1}{M + 1}$ 是一种众所周知的技术，称为“加一”或拉普拉斯平滑法则，用于避免报告 $p$ 值为 $0$，这是有限抽样产生的人为结果。该问题是适定的，提供了所有必要信息且无矛盾。语言客观且明确。这是一个源于有效科学背景的、简单明了的数学问题。\n\n步骤3：结论与行动。\n问题有效。我将继续进行求解。\n\n估计的 $p$ 值的表达式为\n$$\n\\hat{p} \\;=\\; \\frac{b + 1}{M + 1}\n$$\n我们已知置换次数 $M = 10000$。将这个值代入表达式得到：\n$$\n\\hat{p} \\;=\\; \\frac{b + 1}{10000 + 1} \\;=\\; \\frac{b + 1}{10001}\n$$\n问题陈述 $b$ 是一个非负整数。这意味着 $b$ 的可能值集合是 $b \\in \\{0, 1, 2, 3, \\dots\\}$。\n\n我们被要求找到 $\\hat{p}$ 的最小可能非零值。$\\hat{p}$ 的值是 $b$ 的函数。分母 $10001$ 是一个正常数。因此，要最小化分数 $\\hat{p}$ 的值，我们必须最小化其分子 $b + 1$ 的值。\n\n当 $b$ 本身最小时，表达式 $b+1$ 也最小。根据问题的约束条件，$b$ 作为非负整数的最小可能值是 $0$。\n\n让我们将 $b$ 的最小值代入 $\\hat{p}$ 的表达式中：\n当 $b = 0$ 时，\n$$\n\\hat{p}_{min} \\;=\\; \\frac{0 + 1}{10001} \\;=\\; \\frac{1}{10001}\n$$\n这个值 $\\frac{1}{10001}$ 显然是非零的。对于任何其他允许的 $b$ 值，例如 $b=1, 2, 3, \\dots$，分子 $b+1$ 将会更大。例如，如果 $b=1$，那么 $\\hat{p} = \\frac{1+1}{10001} = \\frac{2}{10001}$。因为对于所有 $b > 0$ 的情况，都有 $\\frac{1}{10001}  \\frac{2}{10001}$ 等，所以为 $b=0$ 计算出的值确实是 $\\hat{p}$ 的最小可能值。\n\n问题要求答案以精确分数的形式给出，而 $\\frac{1}{10001}$ 正是这样一个分数。", "answer": "$$\\boxed{\\frac{1}{10001}}$$", "id": "2393990"}, {"introduction": "现实世界的生物信息学数据常常呈现出看似矛盾的结果，需要仔细解读。这个实践探讨了一个常见的 GSEA 场景：一个基因集获得了很高的富集得分（接近 1），表明其显著富集，但其假发现率（FDR）也很高，意味着结果不具有统计显著性 [@problem_id:2393971]。解决这个悖论需要对多重检验校正、归一化过程以及通路冗余等潜在的生物学混杂因素有更深入的理解。", "problem": "您对一个来自病例-对照研究的基因排序列表进行了基因集富集分析（GSEA）。对于一个生物通路（基因集），其富集分数（ES）接近 $1$ （例如，$ES \\approx 0.95$），但该通路的假发现率（FDR）却很高（例如，$FDR > 0.25$）。在GSEA中，富集分数（ES）概括了基因集中的基因在排序列表的顶部或底部的集中程度，而假发现率（FDR）则估计了在至少同样极端的研究结果中假阳性的预期比例，并考虑了对所有基因集进行的多重检验校正。哪些陈述最能解释这种情况如何可能发生及其含义？\n\nA. 一个大的 $ES$ 值表明该基因集的基因在排序列表的一端高度集中，但如果许多基因集（或表型标签置换）获得了相似或更高的分数，就可能出现高的 $FDR$；在对多重检验进行校正后，观察到的富集不具有统计学显著性。\n\nB. 这种差异的发生仅仅是因为置换次数太少；随着置换次数的增加，一个大的 $ES$ 值总会产生一个小的 $FDR$ 值，因此该通路实际上是显著富集的。\n\nC. 基因集之间的重叠和共调控可能导致许多基因集在观察到的排序下获得高分，从而夸大了跨基因集的零假设分布并增加了 $FDR$；该信号是非特异性的，可能反映了广泛的转变而非通路特异性的富集。\n\nD. 因为 $ES \\in [-1,1]$，接近 $1$ 的值保证了统计学显著性；因此，当 $ES \\approx 1$ 时出现 $FDR > 0.25$ 表明存在计算错误。\n\nE. 小的基因集可能偶然获得极端的 $ES$ 值；通过基因集大小进行归一化并与基于标签置换构建的零假设分布进行比较后，该分数对于相似大小的基因集可能很常见，从而导致高 $FDR$，因此不应提出通路水平的结论。", "solution": "问题陈述已提交验证。\n\n**第1步：提取已知信息**\n- 分析方法：基因集富集分析 (GSEA)\n- 输入数据：来自病例-对照研究的基因排序列表。\n- 观察结果：对于一个特定的生物通路（基因集），富集分数 ($ES$) 约等于 $0.95$。\n- 观察结果：对于同一通路，假发现率 ($FDR$) 大于 $0.25$。\n- 提供的 $ES$ 定义：富集分数概括了基因集中的基因在排序列表的顶部或底部的集中程度。\n- 提供的 $FDR$ 定义：假发现率估计了在至少同样极端的研究结果中假阳性的预期比例，并考虑了对所有基因集进行的多重检验校正。\n- 问题：解释这种结果（$ES \\approx 0.95$ 且 $FDR > 0.25$）如何可能发生及其含义。\n\n**第2步：使用提取的已知信息进行验证**\n- **科学基础**：该问题基于计算生物学和统计学的既定原则，特别是 Subramanian 等人开发的 GSEA 方法。富集分数、表型置换和假发现率校正等概念是该领域的核心。所述数值（$ES \\approx 0.95$，$FDR > 0.25$）是合理的，代表了真实世界数据分析中的常见情况。\n- **适定性**：问题是适定的。它提出了一组不矛盾的观察结果，并要求根据其底层方法论给出合乎逻辑的解释。可以推导出一套有意义且具体的解释。\n- **客观性**：问题以客观、技术性的语言陈述。\n- **完整性**：问题提供了足够的信息和定义来进行严谨的分析。高 $ES$ 和高 $FDR$ 的明显悖论是问题的核心，而不是设置中的缺陷。\n\n**第3步：结论与行动**\n问题陈述在科学上是合理的、适定的和完整的。因此，它是**有效的**。将继续进行解答。\n\n**原理推导**\n\n基因集富集分析（GSEA）方法论建立在几个关键的统计概念之上，必须理解这些概念才能解决这一明显的差异。\n\n$1$。 **富集分数 ($ES$)**：给定一个包含所有基因的排序列表 $L$（例如，从“病例”表型中表达上调最多的基因到下调最多的基因）和一个预定义的基因集 $S$，分析过程是沿着列表 $L$ 向下进行。计算一个累加和统计量。每当遇到一个属于 $S$ 的基因（一次“命中”），该总和就增加；每当遇到一个不属于 $S$ 的基因（一次“未命中”），该总和就减少。命中时增加的幅度由该基因的秩相关性加权。富集分数 $ES$ 定义为该累加和与零的最大偏差。一个接近 $+1$ 的 $ES$ 值表示基因集 $S$ 中的基因主要分布在排序列表 $L$ 的顶部。一个接近 $-1$ 的 $ES$ 值表示集中在底部。一个接近 $0$ 的 $ES$ 值表示随机分布。观察到的 $ES \\approx 0.95$ 正确地表明了该通路基因在列表一端的非常强的集中。它本质上是该基因集的效应量的一种度量。\n\n$2$。 **显著性检验与零分布**：一个大的 $ES$ 值本身并不能证明其具有统计学显著性。分数的显著性是通过将其与一个零分布进行比较来评估的。GSEA 通过大量次（例如，$N = 1000$）置换表型标签（病例 vs. 对照）来生成这个零分布。对于每次置换，都会重复整个基因排序过程以及对基因集 $S$ 的后续 $ES$ 计算。这样就创建了一个 $ES_{null}$ 分数的分布，该分布代表了在基因集与表型之间没有关联的零假设下，该基因集偶然可能获得的分数范围。基因集 $S$ 的名义p值是满足 $|ES_{null}| \\ge |ES_{obs}|$ 的置换次数所占的比例。\n\n$3$。 **多重假设检验校正 (FDR)**：在典型的分析中，成千上万的基因集被同时检验。这构成了一个巨大的多重检验问题，必须进行严格的校正。GSEA 为此目的使用假发现率（$FDR$）。该过程包括对每个基因集的观察到的 $ES$ 进行归一化，以考虑基因集大小的差异。这是通过将观察到的 $ES$ 除以该基因集 $ES_{null}$ 分数绝对值的平均值来完成的，从而得到一个标准化富集分数（$NES$）。对所有基因集的所有 $ES_{null}$ 分数也应用类似的归一化。然后，通过将我们感兴趣的通路的观察到的 $NES$ 与所有置换中所有基因集的所有 $NES_{null}$ 分数的汇总分布进行比较来计算 $FDR$。一个大于 $0.25$ 的 $FDR$ 值表明，如果我们宣布所有具有至少与观察到的 $NES$ 一样大的 $NES$ 值的通路为显著，我们预计这些声明中超过 $25\\%$ 是假阳性。按照惯例，这不被认为是统计学显著的。\n\n问题的核心是解释为什么一个大的效应量（$ES \\approx 0.95$）没有转化为统计学显著性（$FDR > 0.25$）。这种情况发生于观察到的（和归一化的）分数虽然绝对值很大，但相对于从所有测试的基因集和置换中构建的零分布来说不够极端。\n\n**逐项分析**\n\nA. 一个大的 $ES$ 值表明该基因集的基因在排序列表的一端高度集中，但如果许多基因集（或表型标签置换）获得了相似或更高的分数，就可能出现高的 $FDR$；在对多重检验进行校正后，观察到的富集不具有统计学显著性。\n\n该陈述是对 GSEA 多重检验校正过程的精确和准确的描述。如陈述所述，$ES$ 衡量集中程度。由 $FDR$ 量化的统计学显著性是通过将观察到的标准化富集分数（$NES$）与从所有置换和所有测试的基因集中汇总的零分布进行比较来确定的。如果许多其他基因集（在实际数据中）或许多置换实例（在零模型中）获得了与所讨论通路观察到的分数相当或更大的分数，那么这一发现就不算特殊。由此产生的高 $FDR$ 正确地反映了在考虑了多重检验的全部负担后，该富集不具有统计学显著性。\n\n结论：**正确**。\n\nB. 这种差异的发生仅仅是因为置换次数太少；随着置换次数的增加，一个大的 $ES$ 值总会产生一个小的 $FDR$ 值，因此该通路实际上是显著富集的。\n\n这个陈述有根本性的缺陷。增加置换次数可以提高 $p$ 值和 $FDR$ 估计的分辨率和稳定性，但它不会改变潜在的统计现实。如果观察到的富集相对于零分布并非真正显著，更多的置换只会收敛到一个更精确但仍然很高的 $FDR$ 值。声称只要有足够的置换次数，一个大的 $ES$ 值*总会*产生一个小的 $FDR$ 值是错误的。它忽略了正在测试的其他基因集的关键背景以及置换的结果。\n\n结论：**不正确**。\n\nC. 基因集之间的重叠和共调控可能导致许多基因集在观察到的排序下获得高分，从而夸大了跨基因集的零假设分布并增加了 $FDR$；该信号是非特异性的，可能反映了广泛的转变而非通路特异性的富集。\n\n该陈述为这种统计现象提供了一个复杂而常见的生物学解释。生物通路不是独立的；由于功能上的关系，它们经常共享基因。如果一组共调控的基因受到强烈扰动并出现在排序列表的顶部，那么每个包含这些基因相当一部分的基因集都会表现出高的 $ES$。这导致许多观察到的基因集具有高 $NES$ 值的情况。$FDR$ 计算正确地捕捉到了这种非特异性。任何单个基因集的统计学显著性都减弱了，因为富集信号被稀释到了许多相关的基因集中。因此，高 $FDR$ 意味着该信号并非我们感兴趣的单个通路所特有。这是导致选项 A 所描述情况发生的一个主要原因。\n\n结论：**正确**。\n\nD. 因为 $ES \\in [-1,1]$，接近 $1$ 的值保证了统计学显著性；因此，当 $ES \\approx 1$ 时出现 $FDR > 0.25$ 表明存在计算错误。\n\n该陈述显示了对统计推断的基本误解。一个统计量的大小（$ES$，一种效应量）与其统计学显著性（$p$ 值或 $FDR$）是不同的。一个大的效应可能偶然被观察到，其显著性只能相对于一个适当的零分布并在多重比较校正后进行判断。$ES$ 的范围是 $[-1, 1]$ 与此原则无关。将这种常见且被充分理解的统计结果归因于“计算错误”是不科学和不正确的。\n\n结论：**不正确**。\n\nE. 小的基因集可能偶然获得极端的 $ES$ 值；通过基因集大小进行归一化并与基于标签置换构建的零假设分布进行比较后，该分数对于相似大小的基因集可能很常见，从而导致高 $FDR$，因此不应提出通路水平的结论。\n\n该陈述指出了另一个有效的机制。由于抽样变异性，如果一个小基因集中的少数几个成员恰好位于排序列表的顶部，它就可以获得非常高的 $ES$。GSEA 方法论通过将原始 $ES$ 归一化以产生 $NES$ 来明确地考虑这一点。这种归一化是基于置换下相似大小基因集的 $ES$ 值分布。如果高 $ES$ 值对于小基因集来说是偶然常见的，那么归一化会减小分数的大小，导致一个不极端的 $NES$，从而产生一个高 $FDR$。结论“不应提出通路水平的结论”是对高 $FDR$ 的正确解释。\n\n结论：**正确**。", "answer": "$$\\boxed{ACE}$$", "id": "2393971"}]}