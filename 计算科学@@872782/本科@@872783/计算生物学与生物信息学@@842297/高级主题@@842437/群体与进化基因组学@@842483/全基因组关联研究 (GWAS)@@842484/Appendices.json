{"hands_on_practices": [{"introduction": "全基因组关联研究（GWAS）的威力在于其能够同时检测数百万个遗传变异。然而，这种大规模的并行检验也带来了严峻的统计挑战，即多重检验问题。这个练习将引导你计算Bonferroni校正后的显著性阈值，这是控制全基因组范围内假阳性发现的第一道防线，也是理解GWAS结果可靠性的关键一步。[@problem_id:1494362]", "problem": "一个遗传学家团队正在进行一项全基因组关联分析（GWAS），以识别与一种新发现的复杂疾病相关的遗传标记。GWAS涉及扫描许多个体的基因组，以确定是否有任何特定的遗传变异在患有该疾病的人群中比在对照组中更常见。本研究中分析的遗传变异是单核苷酸多态性（SNPs）。\n\n在这项具体研究中，研究人员正在同时检验 $m = 1,000,000$ 个独立的SNPs与该疾病的统计关联性。传统上，对于单次统计检验，显著性的p值阈值（alpha水平）设定为 $\\alpha = 0.05$。然而，进行如此大量的检验会显著增加纯粹由偶然因素导致至少出现一个“假阳性”结果（I类错误）的概率。\n\n为了应对这个多重检验问题，研究团队决定控制家族错误率（FWER），其定义为在所有进行的检验中犯一个或多个I类错误的概率。他们的目标是将FWER保持在0.05或以下。为实现这一目标，他们将对其显著性阈值应用Bonferroni校正。\n\n给定待检验的独立SNPs数量和期望的FWER，计算一个SNP必须满足的、经过Bonferroni校正的新的p值阈值，才能被认为是统计学显著的。请用科学记数法表示您的答案。", "solution": "在Bonferroni程序下，家族错误率满足Bonferroni不等式：\n$$\n\\text{FWER} \\leq \\sum_{i=1}^{m} \\alpha_{i}.\n$$\n如果 $m$ 个检验中的每一个都在相同的单次检验显著性水平 $\\alpha^{*}$ 下进行，那么\n$$\n\\text{FWER} \\leq m \\alpha^{*}.\n$$\n为了将FWER控制在期望的水平 $\\alpha$，选择 $\\alpha^{*}$ 使得\n$$\nm \\alpha^{*} \\leq \\alpha \\quad \\Rightarrow \\quad \\alpha^{*} = \\frac{\\alpha}{m}.\n$$\n当 $\\alpha = 0.05$ 且 $m = 1{,}000{,}000 = 10^{6}$ 时，将 $0.05 = 5 \\times 10^{-2}$ 代入计算\n$$\n\\alpha^{*} = \\frac{5 \\times 10^{-2}}{10^{6}} = 5 \\times 10^{-2-6} = 5 \\times 10^{-8}.\n$$\n因此，经过Bonferroni校正的p值阈值为 $5 \\times 10^{-8}$。", "answer": "$$\\boxed{5 \\times 10^{-8}}$$", "id": "1494362"}, {"introduction": "在GWAS分析中，群体分层等混杂因素可能导致检验统计量系统性地“膨胀”，从而产生大量虚假的关联信号。基因组膨胀因子（$\\lambda$）是评估这种系统性偏差的关键诊断工具。通过这个练习，你将学会如何从一组观测到的卡方统计量中计算$\\lambda$值，并理解它如何帮助我们判断研究结果的可靠性。[@problem_id:2394670]", "problem": "在全基因组关联研究 (GWAS) 中，基因组膨胀因子 ($\\lambda$) 用于量化由群体分层等混杂因素引起的检验统计量的系统性膨胀。考虑针对单核苷酸多态性 (SNPs) 的两种模拟情景：一种是没有分层的无效情景，另一种是具有强群体结构的分层情景。对于每种情景，一个加性关联检验为每个 SNP 产生一个一自由度 ($1$ d.f.) 的卡方统计量。观测到的卡方统计量如下：\n\n无效情景 ($n = 21$ 个 SNPs)：\n$$\\{0.03,\\, 0.07,\\, 0.12,\\, 0.19,\\, 0.26,\\, 0.31,\\, 0.37,\\, 0.41,\\, 0.44,\\, 0.45,\\, 0.46,\\, 0.49,\\, 0.53,\\, 0.61,\\, 0.74,\\, 0.88,\\, 1.02,\\, 1.18,\\, 1.36,\\, 1.57,\\, 1.82\\}.$$\n\n分层情景 ($n = 21$ 个 SNPs)：\n$$\\{0.054,\\, 0.126,\\, 0.216,\\, 0.342,\\, 0.468,\\, 0.558,\\, 0.666,\\, 0.738,\\, 0.792,\\, 0.81,\\, 0.828,\\, 0.882,\\, 0.954,\\, 1.098,\\, 1.332,\\, 1.584,\\, 1.836,\\, 2.124,\\, 2.448,\\, 2.826,\\, 3.276\\}.$$\n\n根据定义，对于一个具有 $1$ 自由度的关联检验，基因组膨胀因子为\n$$\\lambda \\;=\\; \\frac{\\operatorname{median}\\!\\left(\\chi^{2}_{\\text{obs}}\\right)}{\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)},$$\n其中 $\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)$ 是在零假设下一个自由度为 $1$ 的卡方分布的总体中位数。\n\n计算无效情景和分层情景的 $\\lambda$。将你的最终答案以单行矩阵 $\\bigl[\\lambda_{\\text{null}}\\;\\;\\lambda_{\\text{stratified}}\\bigr]$ 的形式报告，并四舍五入至 $4$ 位有效数字。无需单位。", "solution": "首先对问题陈述进行严格验证。\n\n**第一步：提取已知信息**\n-   背景是全基因组关联研究 (GWAS)。\n-   需要计算的量是基因组膨胀因子 $\\lambda$。\n-   每个单核苷酸多态性 (SNP) 的检验统计量服从一自由度 ($1$ d.f.) 的卡方分布。\n-   提出了两种情景，每种情景都有 $n = 21$ 个 SNP。\n-   无效情景下观测到的卡方统计量集合是：\n    $\\chi^{2}_{\\text{obs, null}} = \\{0.03,\\, 0.07,\\, 0.12,\\, 0.19,\\, 0.26,\\, 0.31,\\, 0.37,\\, 0.41,\\, 0.44,\\, 0.45,\\, 0.46,\\, 0.49,\\, 0.53,\\, 0.61,\\, 0.74,\\, 0.88,\\, 1.02,\\, 1.18,\\, 1.36,\\, 1.57,\\, 1.82\\}$。\n-   分层情景下观测到的卡方统计量集合是：\n    $\\chi^{2}_{\\text{obs, stratified}} = \\{0.054,\\, 0.126,\\, 0.216,\\, 0.342,\\, 0.468,\\, 0.558,\\, 0.666,\\, 0.738,\\, 0.792,\\, 0.81,\\, 0.828,\\, 0.882,\\, 0.954,\\, 1.098,\\, 1.332,\\, 1.584,\\, 1.836,\\, 2.124,\\, 2.448,\\, 2.826,\\, 3.276\\}$。\n-   基因组膨胀因子的定义如下：\n    $$\\lambda \\;=\\; \\frac{\\operatorname{median}\\!\\left(\\chi^{2}_{\\text{obs}}\\right)}{\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)}$$\n    其中 $\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)$ 是自由度为 $1$ 的 $\\chi^{2}$ 分布的总体中位数。\n-   最终答案必须是一个行矩阵 $[\\lambda_{\\text{null}}\\;\\;\\lambda_{\\text{stratified}}]$，数值四舍五入至 $4$ 位有效数字。\n\n**第二步：使用提取的已知信息进行验证**\n-   **科学依据**：该问题在科学上是合理的。基因组膨胀因子 $\\lambda$ 是 GWAS 中用于检测和量化群体分层等混杂因素的标准度量。卡方统计量及其理论零分布的使用是该领域的基础。所提供的公式是正确的定义。\n-   **适定性**：该问题是适定的。它提供了所有必要的数据（两种情景的观测统计量）和一个清晰、明确的计算公式。唯一需要的外部信息，即 $\\chi^{2}_{1}$ 分布的中位数，是一个已知的统计常数，其获取是标准科学知识的一部分，而不是缺失的数据。\n-   **客观性**：问题以精确、客观的语言陈述，不含任何主观或推测性内容。\n\n**第三步：结论与行动**\n该问题被认为是**有效的**。这是一个基于统计遗传学既定原则的直接计算练习。我们可以着手求解。\n\n**求解推导**\n\n任务是计算无效情景和分层情景这两种情况下的基因组膨胀因子 $\\lambda$。计算需要三个部分：每种情景下观测到的 $\\chi^{2}$ 统计量的中位数，以及自由度为 $1$ 的 $\\chi^{2}$ 分布的理论中位数。\n\n首先，我们确定理论中位数 $\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)$。一个服从一自由度卡方分布的随机变量 $X$ ($X \\sim \\chi^{2}_{1}$) 可以表示为一个标准正态随机变量的平方，$X = Z^2$，其中 $Z \\sim N(0,1)$。$X$ 的中位数是满足 $P(X \\le m) = 0.5$ 的值 $m$。这等价于 $P(Z^2 \\le m) = 0.5$，可以简化为 $P(-\\sqrt{m} \\le Z \\le \\sqrt{m}) = 0.5$。\n\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数 (CDF)。那么，$P(-\\sqrt{m} \\le Z \\le \\sqrt{m}) = \\Phi(\\sqrt{m}) - \\Phi(-\\sqrt{m})$。由于正态分布的对称性，$\\Phi(-z) = 1 - \\Phi(z)$，所以该表达式变为 $2\\Phi(\\sqrt{m}) - 1$。\n我们将此式设为等于 $0.5$：\n$$2\\Phi(\\sqrt{m}) - 1 = 0.5$$\n$$\\Phi(\\sqrt{m}) = \\frac{1.5}{2} = 0.75$$\n因此，$\\sqrt{m}$ 是标准正态分布的 $0.75$-分位数，通常记为 $z_{0.75}$。中位数 $m$ 是这个分位数的平方。\n$$m = \\left(z_{0.75}\\right)^2$$\n$z_{0.75}$ 的值是一个标准的统计常数，约为 $0.67449$。\n$$\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right) = (0.67449)^2 \\approx 0.454936$$\n\n接下来，我们计算每种情景下观测到的 $\\chi^{2}$ 统计量的中位数。对于两种情景，观测数量均为 $n = 21$，这是一个奇数。对于一个大小为 $n$ 的已排序数据集，中位数是位于第 $\\frac{n+1}{2}$ 位置的值。\n对于 $n = 21$，中位数是位于第 $\\frac{21+1}{2} = 11$ 位置的值。\n\n对于**无效情景**，所提供的统计量列表已经按升序排列。第 $11$ 个值是 $0.46$。\n$$\\operatorname{median}(\\chi^{2}_{\\text{obs, null}}) = 0.46$$\n\n对于**分层情景**，列表也已排序。第 $11$ 个值是 $0.828$。\n$$\\operatorname{median}(\\chi^{2}_{\\text{obs, stratified}}) = 0.828$$\n\n现在我们将 $\\lambda$ 的公式应用于每种情景。\n\n对于无效情景：\n$$\\lambda_{\\text{null}} = \\frac{\\operatorname{median}(\\chi^{2}_{\\text{obs, null}})}{\\operatorname{median}(\\chi^{2}_{1,\\text{null}})} = \\frac{0.46}{0.454936} \\approx 1.01113$$\n四舍五入到 $4$ 位有效数字，我们得到 $\\lambda_{\\text{null}} = 1.011$。这个值非常接近 $1$，这在无群体分层的零假设下是预期的。\n\n对于分层情景：\n$$\\lambda_{\\text{stratified}} = \\frac{\\operatorname{median}(\\chi^{2}_{\\text{obs, stratified}})}{\\operatorname{median}(\\chi^{2}_{1,\\text{null}})} = \\frac{0.828}{0.454936} \\approx 1.82001$$\n四舍五入到 $4$ 位有效数字，我们得到 $\\lambda_{\\text{stratified}} = 1.820$。这个值显著大于 $1$，表明检验统计量存在系统性膨胀，这与存在群体结构的情况一致。\n\n最终答案是包含这两个值的行矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.011  1.820\n\\end{pmatrix}\n}\n$$", "id": "2394670"}, {"introduction": "数据质量是任何GWAS分析的基石，而基因分型错误是常见的干扰源。哈迪-温伯格平衡（Hardy-Weinberg Equilibrium, HWE）检验是识别这类错误的一种经典而有效的方法，尤其是在对照组样本中。通过编程实现HWE精确检验，你将掌握一项至关重要的数据质量控制技能，学会如何过滤掉可能由技术误差而非真实生物学效应驱动的可疑SNP。[@problem_id:2394652]", "problem": "您的任务是构建一个程序，为全基因组关联研究（GWAS）实现一个质量控制过滤器。该过滤器必须检测并标记对照样本中与哈迪-温伯格平衡（HWE）存在统计学显著性偏离的单核苷酸多态性（SNP）。一个SNP是双等位基因的，其等位基因表示为 $A$ 和 $a$。对于每个SNP，您会得到对照组中的基因型计数：纯合子 $AA$ 的计数为 $n_{AA}$，杂合子 $Aa$ 的计数为 $n_{Aa}$，纯合子 $aa$ 的计数为 $n_{aa}$。令 $n = n_{AA} + n_{Aa} + n_{aa}$ 表示对照组个体的数量。\n\n在哈迪-温伯格平衡（HWE）的原假设下，假定群体是在给定基础等位基因频率的情况下通过随机交配产生的。考虑HWE的精确条件检验，该检验以样本中一个等位基因的总拷贝数为条件。假设有 $2n$ 个染色体位置，令 $r$ 表示这 $2n$ 个位置中稀有等位基因的拷贝数。假设在原假设下，将 $r$ 个稀有等位基因拷贝分配到 $2n$ 个染色体位置的每种方式都是等可能的。对于一个给定的观测基因型配置，双侧精确 $p$ 值的定义为：在原假设下，所有具有相同总等位基因计数且可能性不高于观测配置的基因型配置的条件概率之和。\n\n对于每个SNP，使用以下决策规则：如果精确的双侧HWE $p$值严格小于给定的显著性水平 $\\alpha$，则移除该SNP（标记为 $1$），否则保留它（标记为 $0$）。\n\n实现一个程序，将此规则应用于以下由独立SNP组成的测试套件，每个SNP指定为一个元组 $(n_{AA}, n_{Aa}, n_{aa}, \\alpha)$：\n\n- 测试 $1$：$(50, 20, 30, 10^{-6})$，即 $n_{AA} = 50$, $n_{Aa} = 20$, $n_{aa} = 30$, $\\alpha = 10^{-6}$。\n- 测试 $2$：$(36, 48, 16, 10^{-6})$，即 $n_{AA} = 36$, $n_{Aa} = 48$, $n_{aa} = 16$, $\\alpha = 10^{-6}$。\n- 测试 $3$：$(100, 0, 0, 10^{-6})$，即 $n_{AA} = 100$, $n_{Aa} = 0$, $n_{aa} = 0$, $\\alpha = 10^{-6}$。\n- 测试 $4$：$(18, 2, 0, 0.05)$，即 $n_{AA} = 18$, $n_{Aa} = 2$, $n_{aa} = 0$, $\\alpha = 0.05$。\n- 测试 $5$：$(0, 10, 0, 0.01)$，即 $n_{AA} = 0$, $n_{Aa} = 10$, $n_{aa} = 0$, $\\alpha = 0.01$。\n- 测试 $6$：$(405, 90, 5, 0.05)$，即 $n_{AA} = 405$, $n_{Aa} = 90$, $n_{aa} = 5$, $\\alpha = 0.05$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的整数列表，其顺序与上述测试相同，如果SNP被移除，则每个条目为 $1$，否则为 $0$。例如，一个有效的输出格式是 $[1,0,1]$（这只是格式示例，不是正确答案）。", "solution": "对用户提供的问题进行严格验证。\n\n步骤1：提取给定信息\n- **任务**：为全基因组关联研究（GWAS）实现一个质量控制过滤器，以移除偏离哈迪-温伯格平衡（HWE）的单核苷酸多态性（SNP）。\n- **模型**：SNP是双等位基因的，等位基因为 $A$ 和 $a$。\n- **输入数据**：对于每个SNP，给出基因型计数：$n_{AA}$、$n_{Aa}$、$n_{aa}$。\n- **总样本量**：$n = n_{AA} + n_{Aa} + n_{aa}$。\n- **统计检验**：HWE的双侧精确条件检验。\n- **条件化**：检验以每个等位基因的观测总数为条件。\n- **原假设（$H_0$）**：基因型计数遵循HWE。在$H_0$下，将 $r$ 个稀有等位基因拷贝分配到 $2n$ 个染色体位置的每种方式都是等可能的。\n- **P值定义**：所有具有相同总等位基因计数且可能性不高于观测配置的基因型配置的条件概率之和。\n- **决策规则**：如果 $p  \\alpha$，则移除SNP（标记为 $1$）；否则，保留SNP（标记为 $0$）。\n- **测试用例**：\n    - 测试 1：$(n_{AA}=50, n_{Aa}=20, n_{aa}=30, \\alpha=10^{-6})$\n    - 测试 2：$(n_{AA}=36, n_{Aa}=48, n_{aa}=16, \\alpha=10^{-6})$\n    - 测试 3：$(n_{AA}=100, n_{Aa}=0, n_{aa}=0, \\alpha=10^{-6})$\n    - 测试 4：$(n_{AA}=18, n_{Aa}=2, n_{aa}=0, \\alpha=0.05)$\n    - 测试 5：$(n_{AA}=0, n_{Aa}=10, n_{aa}=0, \\alpha=0.01)$\n    - 测试 6：$(n_{AA}=405, n_{Aa}=90, n_{aa}=5, \\alpha=0.05)$\n- **输出格式**：包含逗号分隔的结果列表的单行，例如 `[1,0,1]`。\n\n步骤2：使用提取的给定信息进行验证\n- **科学性**：该问题是有效的。它描述了HWE精确检验的实现，这是群体遗传学和生物信息学中一个标准和基础的统计程序，常用于GWAS的质量控制。等位基因、基因型和HWE的概念是遗传学的基石。\n- **适定性**：该问题是有效的。它提供了所有必要的组成部分：输入数据（$n_{AA}$、$n_{Aa}$、$n_{aa}$、$\\alpha$）、要使用的特定统计检验（条件精确检验）、$p$ 值的精确定义以及明确的决策规则。这种结构使得每个测试用例都有一个唯一、可计算的解。\n- **客观性**：该问题是有效的。它使用客观、技术性的语言表述，没有主观性或歧义。\n\n步骤3：结论与行动\n该问题具有科学合理性、适定性和客观性。它是**有效的**。将构建一个解决方案。\n\n---\n\n该问题要求实现哈迪-温伯格平衡（HWE）的精确检验。该检验是遗传学研究中质量控制的标准程序，因为与HWE的显著偏离可能表明存在基因分型错误。解决方案涉及为一组给定的观测基因型计数计算双侧 $p$ 值，并将其与显著性水平 $\\alpha$ 进行比较。\n\n设一个双等位基因SNP的观测基因型计数为 $n_{AA}$、$n_{Aa}$ 和 $n_{aa}$。样本中的个体总数为 $n = n_{AA} + n_{Aa} + n_{aa}$。我们表示为 $A$ 和 $a$ 的两个等位基因的计数是：\n- $A$ 等位基因数：$N_A = 2n_{AA} + n_{Aa}$\n- $a$ 等位基因数：$N_a = 2n_{aa} + n_{Aa}$\n样本中的等位基因总数为 $2n = N_A + N_a$。\n\nHWE的精确检验以观测到的等位基因计数 $N_A$ 和 $N_a$ 为条件。在HWE的原假设下，我们可以将样本中的 $2n$ 个等位基因概念化为随机配对形成 $n$ 个二倍体个体。保持等位基因计数 $N_A$ 和 $N_a$ 固定，会限制可能的基因型配置。具体来说，如果我们知道杂合子的数量 $n_{Aa}$，纯合子的计数就确定了：\n$$ n_{AA} = \\frac{N_A - n_{Aa}}{2} $$\n$$ n_{aa} = \\frac{N_a - n_{Aa}}{2} $$\n由于 $n_{AA}$ 和 $n_{aa}$ 必须是非负整数，杂合子的数量 $n_{Aa}$ 对于固定的 $N_A$ 和 $N_a$ 唯一地定义了基因型计数。在给定等位基因计数的情况下，观测到特定杂合子计数 $k$ 的概率遵循从组合论证中得出的特定概率分布。概率质量函数（PMF）为：\n$$ P(n_{Aa} = k | n, N_A, N_a) = \\frac{n! N_A! N_a! 2^k}{(2n)! n_{AA_k}! k! n_{aa_k}!} $$\n其中 $n_{AA_k} = (N_A - k)/2$ 和 $n_{aa_k} = (N_a - k)/2$。\n\n$k$ 的可能取值范围（分布的支撑集）由基因型计数必须为非负整数的约束条件决定。\n1.  $k \\geq 0$\n2.  $n_{AA_k} \\geq 0 \\implies k \\leq N_A$\n3.  $n_{aa_k} \\geq 0 \\implies k \\leq N_a$\n4.  此外，为了使 $n_{AA_k}$ 和 $n_{aa_k}$ 为整数，$(N_A - k)$ 和 $(N_a - k)$ 必须是偶数。这意味着 $k$ 必须与 $N_A$ 和 $N_a$ 具有相同的奇偶性（同为偶数或同为奇数）。注意，$N_A$ 和 $N_a$ 总是有相同的奇偶性，因为它们的和 $2n$ 是偶数。\n\n双侧 $p$ 值的定义是所有与观测配置等可能或更不可能的配置的概率之和。设观测到的杂合子计数为 $n_{Aa,obs}$。此观测的概率为 $P_{obs} = P(n_{Aa} = n_{Aa,obs})$。则 $p$ 值为：\n$$ p = \\sum_{k \\in \\text{support}} P(n_{Aa} = k) \\quad \\text{such that} \\quad P(n_{Aa} = k) \\leq P_{obs} $$\n\n计算涉及大数的阶乘，这可能导致数值上溢或下溢。为保持精度，应在对数空间中进行计算。PMF的对数为：\n$$ \\ln P(k) = \\ln(n!) + \\ln(N_A!) + \\ln(N_a!) + k\\ln(2) - \\ln((2n)!) - \\ln(n_{AA_k}!) - \\ln(k!) - \\ln(n_{aa_k}!) $$\n对数阶乘 $\\ln(x!)$ 可以使用对数伽马函数 `gammaln` 计算，即 $\\ln(x!) = \\text{gammaln}(x+1)$。\n\n对每个测试用例，算法按以下步骤进行：\n1.  根据输入的基因型计数 $n_{AA,obs}, n_{Aa,obs}, n_{aa,obs}$ 计算 $n, N_A, N_a$。\n2.  处理SNP为单态性的平凡情况（即 $N_A=0$ 或 $N_a=0$）。在这种情况下，只有一种基因型配置是可能的，其概率为 $1$，因此 $p$ 值为 $1$。\n3.  确定 $n_{Aa}$ 的支撑集：从可能的最小值（0或1，取决于奇偶性）迭代到可能的最大值 $\\min(N_A, N_a)$，步长为 $2$。\n4.  计算观测配置的对数概率 $\\ln(P_{obs})$。\n5.  将 $p$ 值初始化为 $0$。遍历支撑集中的所有可能值 $k$。对于每个 $k$，计算其对数概率 $\\ln(P_k)$。\n6.  如果 $\\ln(P_k) \\leq \\ln(P_{obs})$，则将概率 $P_k = \\exp(\\ln(P_k))$ 加到总 $p$ 值中。\n7.  最后，将计算出的 $p$ 值与给定的显著性水平 $\\alpha$ 进行比较。如果 $p  \\alpha$，结果为 $1$（移除）。否则，结果为 $0$（保留）。\n\n对每个指定的测试用例执行此过程以生成最终输出。", "answer": "```python\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Main solver function to process the test suite for Hardy-Weinberg Equilibrium.\n    \"\"\"\n    test_cases = [\n        (50, 20, 30, 1e-6),\n        (36, 48, 16, 1e-6),\n        (100, 0, 0, 1e-6),\n        (18, 2, 0, 0.05),\n        (0, 10, 0, 0.01),\n        (405, 90, 5, 0.05),\n    ]\n\n    results = []\n    for n_AA, n_Aa, n_aa, alpha in test_cases:\n        p_value = calculate_hwe_exact_p_value(n_AA, n_Aa, n_aa)\n        if p_value  alpha:\n            results.append(1)\n        else:\n            results.append(0)\n\n    # Format output as a comma-separated list of integers in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_hwe_exact_p_value(n_AA_obs, n_Aa_obs, n_aa_obs):\n    \"\"\"\n    Calculates the two-sided exact p-value for Hardy-Weinberg Equilibrium.\n\n    Args:\n        n_AA_obs (int): Observed count of homozygous genotype AA.\n        n_Aa_obs (int): Observed count of heterozygous genotype Aa.\n        n_aa_obs (int): Observed count of homozygous genotype aa.\n\n    Returns:\n        float: The calculated p-value.\n    \"\"\"\n    n = n_AA_obs + n_Aa_obs + n_aa_obs\n    if n == 0:\n        return 1.0\n\n    n_A = 2 * n_AA_obs + n_Aa_obs\n    n_a = 2 * n_aa_obs + n_Aa_obs\n    \n    # If the SNP is monomorphic, HWE is trivially satisfied.\n    if n_A == 0 or n_a == 0:\n        return 1.0\n\n    # Determine the range of possible heterozygote counts\n    n_het_min = 0 if n_A % 2 == 0 else 1\n    n_het_max = min(n_A, n_a)\n\n    # Pre-calculate the constant part of the log-probability\n    log_const_term = (gammaln(n + 1) + gammaln(n_A + 1) + gammaln(n_a + 1) -\n                      gammaln(2 * n + 1))\n    \n    log_probs = {}\n    \n    # Calculate log-probability for all possible heterozygote counts\n    for k in range(n_het_min, n_het_max + 1, 2):\n        n_AA_k = (n_A - k) / 2\n        n_aa_k = (n_a - k) / 2\n        \n        # Ensure counts are valid integers, though the loop structure should guarantee this\n        if n_AA_k  0 or n_aa_k  0 or n_AA_k != int(n_AA_k) or n_aa_k != int(n_aa_k):\n            continue\n            \n        log_prob = (log_const_term + k * np.log(2) -\n                    gammaln(n_AA_k + 1) - gammaln(k + 1) - gammaln(n_aa_k + 1))\n        log_probs[k] = log_prob\n\n    # Find the log-probability of the observed configuration\n    # If observed het count is impossible given allele counts, its prob is 0.\n    if n_Aa_obs not in log_probs:\n        # This case should not happen with valid inputs. \n        # If it did, p-value would cover all possible outcomes, so 1.0.\n        return 1.0 \n    \n    log_p_obs = log_probs[n_Aa_obs]\n\n    # Calculate the p-value by summing probabilities of configurations\n    # that are as likely or less likely than the observed one.\n    p_value = 0.0\n    for k, log_p_k in log_probs.items():\n        if log_p_k = log_p_obs:\n            p_value += np.exp(log_p_k)\n            \n    # Clamp p-value to ensure it is within [0, 1] due to potential floating point inaccuracies\n    return max(0.0, min(1.0, p_value))\n\nsolve()\n```", "id": "2394652"}]}