{"hands_on_practices": [{"introduction": "为了真正掌握贝叶斯定理，我们从一个经典的概率练习开始。这个问题涉及选择瓮并从中抽取小球 [@problem_id:353]，它剥离了现实世界的复杂性，让我们能够专注于基本机制。通过解决这个问题，你将练习如何识别和组合先验概率与似然，以计算后验概率，为更高级的应用打下坚实的基础。", "problem": "一个实验包含一个两阶段选择过程。首先，从一个选择袋中抽取一个弹珠，根据其颜色从三只瓮 $\\{U_A, U_B, U_C\\}$ 中选择一只。该选择袋中装有 $c_A$ 个绿色弹珠，$c_B$ 个蓝色弹珠和 $c_C$ 个黄色弹珠。抽到绿色弹珠则选择瓮 $U_A$，抽到蓝色弹珠则选择 $U_B$，抽到黄色弹珠则选择 $U_C$。\n\n其次，在一只瓮被选定后，从中抽取一个球。每只瓮中的物品如下：\n-   瓮 $U_A$ 装有 $r_A$ 个红球和 $w_A$ 个白球。\n-   瓮 $U_B$ 装有 $r_B$ 个红球和 $w_B$ 个白球。\n-   瓮 $U_C$ 装有 $r_C$ 个红球和 $w_C$ 个白球。\n\n实验进行后，抽出的球是红色的。推导该球是从瓮 $U_B$ 中抽出的概率表达式。", "solution": "我们将选择瓮的事件标记为 $U_A,U_B,U_C$，将抽出红球的事件标记为 $R$。\n\n1. 选择瓮 $U_i$ 的先验概率为\n$$\nP(U_i)\\;=\\;\\frac{c_i}{c_A+c_B+c_C}\\,,\\qquad i\\in\\{A,B,C\\}\\,. \n$$\n\n2. 给定选择了瓮 $U_i$，抽出红球的概率为\n$$\nP(R\\mid U_i)\\;=\\;\\frac{r_i}{r_i+w_i}\\,. \n$$\n\n3. 根据全概率公式，抽出红球的概率为\n$$\nP(R)\\;=\\;\\sum_{i\\in\\{A,B,C\\}}P(U_i)\\,P(R\\mid U_i)\n\\;=\\;\\frac{c_A}{c_A+c_B+c_C}\\,\\frac{r_A}{r_A+w_A}\n+\\frac{c_B}{c_A+c_B+c_C}\\,\\frac{r_B}{r_B+w_B}\n+\\frac{c_C}{c_A+c_B+c_C}\\,\\frac{r_C}{r_C+w_C}\\,.\n$$\n\n4. 根据贝叶斯定理，红球来自瓮 $U_B$ 的后验概率为\n$$\nP(U_B\\mid R)\n\\;=\\;\n\\frac{P(U_B)\\,P(R\\mid U_B)}{P(R)}\n\\;=\\;\n\\frac{\\displaystyle\\frac{c_B}{c_A+c_B+c_C}\\,\\frac{r_B}{r_B+w_B}}\n{\\displaystyle\\frac{c_A}{c_A+c_B+c_C}\\,\\frac{r_A}{r_A+w_A}\n+\\frac{c_B}{c_A+c_B+c_C}\\,\\frac{r_B}{r_B+w_B}\n+\\frac{c_C}{c_A+c_B+c_C}\\,\\frac{r_C}{r_C+w_C}}\\,.\n$$\n\n5. 公分母 $c_A+c_B+c_C$ 可以消去，得到最终的简化形式\n$$\nP(U_B\\mid R)\n=\\frac{\\displaystyle\\frac{c_B\\,r_B}{r_B+w_B}}\n{\\displaystyle\\frac{c_A\\,r_A}{r_A+w_A}\n+\\frac{c_B\\,r_B}{r_B+w_B}\n+\\frac{c_C\\,r_C}{r_C+w_C}}\\,.\n$$", "answer": "$$\\boxed{\\frac{\\displaystyle\\frac{c_B\\,r_B}{r_B+w_B}}{\\displaystyle\\frac{c_A\\,r_A}{r_A+w_A}+\\frac{c_B\\,r_B}{r_B+w_B}+\\frac{c_C\\,r_C}{r_C+w_C}}}$$", "id": "353"}, {"introduction": "现在，让我们将基础知识应用到生物学和医学中一个常见的场景。这个问题 [@problem_id:1898684] 模拟了一个诊断挑战，我们需要在给定特定症状和测试结果的情况下，确定患上一种罕见疾病的概率。这是一个绝佳的练习，可以帮助你学习如何整合不同来源的证据——例如疾病流行率、症状出现概率和测试准确性——以严谨、量化的方式更新我们的信念。", "problem": "一位兽医正在研究狗的一种奇特新症状：爪垫出现微弱、间歇性的生物发光。经过广泛研究，确定该症状仅由两种互斥的罕见疾病之一引起：犬类荧光病毒感染（Canine Lumiviral Infection, CLI）或琥珀爪综合征（Amber-Paw Syndrome, APS）。\n\n在普通犬类群体中，CLI的患病率为1/100，而APS的患病率为1/2000。并非所有患有这些疾病的狗都会表现出该症状。患有CLI的狗出现爪垫发光症状的概率为0.80。患有APS的狗出现该症状的概率为0.95。\n\n目前有针对CLI的快速诊断测试，但没有针对APS的测试。CLI测试的灵敏度为0.98，特异性为0.99。\n\n一只出现爪垫发光症状的狗被带到诊所。兽医对它进行了CLI测试，结果为阴性。根据这些信息，这只狗患有琥珀爪综合征的概率是多少？\n\n计算你的答案并四舍五入到三位有效数字。", "solution": "设$C$表示CLI，$A$表示APS，$S$表示爪垫发光症状，$N$表示CLI测试结果为阴性。已知：$P(C)=\\frac{1}{100}=0.01$，$P(A)=\\frac{1}{2000}=0.0005$，$P(S\\mid C)=0.80$，$P(S\\mid A)=0.95$。CLI测试的灵敏度为$0.98$，特异性为$0.99$，因此$P(N\\mid C)=1-0.98=0.02$。又因为$A$与$C$互斥，患有APS的狗即为未患CLI的狗，因此对它进行CLI测试得到阴性结果的概率就是测试的特异性，即$P(N\\mid A)=0.99$。该症状仅由$C$或$A$引起，因此可以忽略其他原因。\n\n我们要求解$P(A\\mid S,N)$。根据贝叶斯定理，并假设在给定病症的情况下，$S$和$N$是条件独立的，\n$$\nP(A\\mid S,N)=\\frac{P(A)P(S\\mid A)P(N\\mid A)}{P(C)P(S\\mid C)P(N\\mid C)+P(A)P(S\\mid A)P(N\\mid A)}.\n$$\n计算各项：\n$$\nP(A)P(S\\mid A)P(N\\mid A)=\\frac{1}{2000}\\cdot 0.95\\cdot 0.99=0.00047025,\n$$\n$$\nP(C)P(S\\mid C)P(N\\mid C)=\\frac{1}{100}\\cdot 0.80\\cdot 0.02=0.00016.\n$$\n因此\n$$\nP(A\\mid S,N)=\\frac{0.00047025}{0.00016+0.00047025}=\\frac{1881}{2521}\\approx 0.746133\\ldots\n$$\n四舍五入到三位有效数字，结果是$0.746$。", "answer": "$$\\boxed{0.746}$$", "id": "1898684"}, {"introduction": "我们最后的练习将处理一个生物信息学中复杂而关键的挑战：混淆效应与辛普森悖论。这个问题 [@problem_id:2374723] 展示了一种情况，其中某个等位基因在总体上看是保护性的，但在每个亚群中都是风险因素。通过使用贝叶斯因果模型，你将学会剖析这些看似矛盾的结果，识别混淆变量，并理解为什么在从遗传数据中得出正确的因果推断时，对群体结构进行校正是至关重要的。", "problem": "一项生物样本库研究汇集了来自两个不同祖源亚群的个体。设二元变量为：基因型指示变量 $G \\in \\{0,1\\}$，表示存在（$G=1$）与不存在（$G=0$）某个等位基因；疾病状态 $D \\in \\{0,1\\}$，表示病例（$D=1$）与对照（$D=0$）；以及亚群 $S \\in \\{s_{0}, s_{1}\\}$。在每个亚群内部，研究人员认为该等位基因会增加风险：对于 $S=s_{0}$，层内风险为 $P(D=1 \\mid G=0, S=s_{0}) = 0.01$ 和 $P(D=1 \\mid G=1, S=s_{0}) = 0.02$；对于 $S=s_{1}$，层内风险为 $P(D=1 \\mid G=0, S=s_{1}) = 0.20$ 和 $P(D=1 \\mid G=1, S=s_{1}) = 0.30$。亚群的混合比例为 $P(S=s_{0}) = 0.70$ 和 $P(S=s_{1}) = 0.30$。该等位基因在 $s_{0}$ 中比在 $s_{1}$ 中常见得多：$P(G=1 \\mid S=s_{0}) = 0.90$ 和 $P(G=1 \\mid S=s_{1}) = 0.10$。\n\n仅使用联合概率、条件概率的定义以及全概率定律作为基本出发点，完成以下任务：为被称为辛普森悖论的观测逆转现象推断出适当的因果解释和调整策略，并计算由上述数值所隐含的边际风险 $P(D=1 \\mid G=1)$ 和 $P(D=1 \\mid G=0)$，以检验该等位基因是否在每个亚群内部有害的情况下，在总体上却表现出保护性。\n\n哪个选项能用贝叶斯因果模型最好地解释该悖论，并指出恢复 $G$ 对 $D$ 的因果效应的正确调整方法？\n\nA. 一个包含边 $S \\rightarrow G$、$S \\rightarrow D$ 和 $G \\rightarrow D$ 的有向无环图（DAG）可以解释这种逆转：$S$ 混淆了 $G \\rightarrow D$ 的关系，因为它同时影响 $G$ 和 $D$。边际关联 $P(D=1 \\mid G)$ 是关于 $S$ 的混合，因此根据给定的数值，可以得到 $P(D=1 \\mid G=1)  P(D=1 \\mid G=0)$，尽管对于每个层 $s \\in \\{s_{0}, s_{1}\\}$，都有 $P(D=1 \\mid G=1, S=s)  P(D=1 \\mid G=0, S=s)$。对 $S$ 进行调整可以恢复该等位基因真实的增风险效应。\n\nB. 一个包含 $G \\rightarrow S \\leftarrow D$ 的DAG（因此 $S$ 是一个对撞节点）可以解释这种逆转：该悖论仅在以 $S$ 为条件时才会出现。不进行条件化时，边际关联等于因果效应，因此无需调整，并且给定的数值将意味着 $P(D=1 \\mid G=1)  P(D=1 \\mid G=0)$。\n\nC. 一个包含 $G \\leftarrow S \\rightarrow D$ 的DAG可以解释这种逆转，但要消除偏倚，必须对结果 $D$ 而非 $S$ 进行调整。总体关联仅在以 $D$ 为条件后才会反转方向。\n\nD. 一个包含 $G \\rightarrow D$ 且没有其他边的DAG可以解释这些数据；不存在混淆，观察到的逆转是抽样变异性。边际关联和条件关联在方向上一致，因此无需进行调整。", "solution": "必须首先验证问题陈述的科学性和逻辑完整性。\n\n**第一步：提取已知条件**\n提供的定量信息如下：\n-   一组三个二元随机变量：$G \\in \\{0,1\\}$ (基因型)，$D \\in \\{0,1\\}$ (疾病状态)，$S \\in \\{s_{0}, s_{1}\\}$ (亚群)。\n-   亚群 $s_{0}$ 的层内条件概率（风险）：\n    $P(D=1 \\mid G=0, S=s_{0}) = 0.01$\n    $P(D=1 \\mid G=1, S=s_{0}) = 0.02$\n-   亚群 $s_{1}$ 的层内条件概率（风险）：\n    $P(D=1 \\mid G=0, S=s_{1}) = 0.20$\n    $P(D=1 \\mid G=1, S=s_{1}) = 0.30$\n-   亚群边际概率（混合比例）：\n    $P(S=s_{0}) = 0.70$\n    $P(S=s_{1}) = 0.30$\n-   以亚群为条件的等位基因频率：\n    $P(G=1 \\mid S=s_{0}) = 0.90$\n    $P(G=1 \\mid S=s_{1}) = 0.10$\n\n**第二步：验证问题陈述**\n该问题描述了一个典型的由混淆导致辛普森悖论的场景，这是一个公认的统计现象。其背景是遗传关联研究中的群体分层，这是生物信息学和统计遗传学中的一个基本课题。所有概率都被明确定义，并且在需要时总和为一（例如，$P(S=s_{0}) + P(S=s_{1}) = 0.70 + 0.30 = 1.0$）。所提供的数据是自洽、一致且科学上可信的。问题是适定的，要求使用有向无环图（DAG）进行涉及概率演算和因果推理的标准分析。核心陈述中没有逻辑矛盾、事实错误或含糊不清之处。因此，该问题是有效的。\n\n**第三步：求解推导**\n任务是计算边际风险，验证悖论，并确定正确的因果解释和调整策略。基本原理是全概率定律和贝叶斯定理。\n\n首先，我们确定变量 $S$、$G$ 和 $D$ 之间的因果关系，以构建一个DAG。\n1.  祖源亚群（$S$）是一个在个体基因型（$G$）之前的群体属性。问题陈述表明，不同亚群的等位基因频率不同（$P(G=1 \\mid S=s_0) \\neq P(G=1 \\mid S=s_1)$），这意味着存在一条因果有向边 $S \\rightarrow G$。\n2.  亚群（$S$）也可以通过除特定等位基因 $G$ 之外的各种遗传、环境或社会经济因素影响疾病风险（$D$）。给定数据显示，不同亚群之间的基线疾病风险差异显著（例如，$P(D=1 \\mid G=0, S=s_0) = 0.01$ 而 $P(D=1 \\mid G=0, S=s_1) = 0.20$）。这意味着存在一条因果有向边 $S \\rightarrow D$。\n3.  问题假设等位基因（$G$）影响疾病风险（$D$）。层内风险证实了这一点：在两个亚群中，存在该等位基因都会增加疾病风险（对于 $s \\in \\{s_0, s_1\\}$，有 $P(D=1 \\mid G=1, S=s) > P(D=1 \\mid G=0, S=s)$）。这证明存在一条因果有向边 $G \\rightarrow D$。\n综合这些，因果结构可以用一个包含边 $S \\rightarrow G$ 和 $S \\rightarrow D$ 以及 $G \\rightarrow D$ 的DAG来表示。在这种结构中，$S$ 是 $G$ 和 $D$ 的共同原因，使其成为 $G$ 与 $D$ 关系的一个混淆变量。路径 $G \\leftarrow S \\rightarrow D$ 是一条非因果的“后门”路径，可以诱导 $G$ 和 $D$ 之间的伪关联。\n\n接下来，我们计算边际（总体）风险，$P(D=1 \\mid G=1)$ 和 $P(D=1 \\mid G=0)$。对于特定基因型 $g \\in \\{0, 1\\}$，边际风险 $P(D=1 \\mid G=g)$ 是通过应用全概率定律，对亚群 $S$ 进行边际化得到的：\n$$P(D=1 \\mid G=g) = \\sum_{s \\in \\{s_0, s_1\\}} P(D=1 \\mid G=g, S=s) P(S=s \\mid G=g)$$\n要使用此公式，我们必须首先使用贝叶斯定理计算 $P(S=s \\mid G=g)$：\n$$P(S=s \\mid G=g) = \\frac{P(G=g \\mid S=s) P(S=s)}{P(G=g)}$$\n这需要基因型的边际概率 $P(G=g)$，同样使用全概率定律求得：\n$$P(G=g) = P(G=g \\mid S=s_0)P(S=s_0) + P(G=g \\mid S=s_1)P(S=s_1)$$\n我们还需要等位基因不存在的概率，即 $P(G=0 \\mid S=s_0) = 1 - 0.90 = 0.10$ 和 $P(G=0 \\mid S=s_1) = 1 - 0.10 = 0.90$。\n\n计算：\n1.  基因型的边际概率：\n    $P(G=1) = (0.90)(0.70) + (0.10)(0.30) = 0.63 + 0.03 = 0.66$\n    $P(G=0) = (0.10)(0.70) + (0.90)(0.30) = 0.07 + 0.27 = 0.34$\n    (检验: $0.66 + 0.34 = 1.0$)\n\n2.  给定基因型的亚群条件概率：\n    $P(S=s_0 \\mid G=1) = \\frac{P(G=1 \\mid S=s_0)P(S=s_0)}{P(G=1)} = \\frac{(0.90)(0.70)}{0.66} = \\frac{0.63}{0.66} = \\frac{21}{22}$\n    $P(S=s_1 \\mid G=1) = \\frac{P(G=1 \\mid S=s_1)P(S=s_1)}{P(G=1)} = \\frac{(0.10)(0.30)}{0.66} = \\frac{0.03}{0.66} = \\frac{1}{22}$\n    $P(S=s_0 \\mid G=0) = \\frac{P(G=0 \\mid S=s_0)P(S=s_0)}{P(G=0)} = \\frac{(0.10)(0.70)}{0.34} = \\frac{0.07}{0.34} = \\frac{7}{34}$\n    $P(S=s_1 \\mid G=0) = \\frac{P(G=0 \\mid S=s_1)P(S=s_1)}{P(G=0)} = \\frac{(0.90)(0.30)}{0.34} = \\frac{0.27}{0.34} = \\frac{27}{34}$\n\n3.  边际风险：\n    $P(D=1 \\mid G=1) = P(D=1 \\mid G=1, S=s_0)P(S=s_0 \\mid G=1) + P(D=1 \\mid G=1, S=s_1)P(S=s_1 \\mid G=1)$\n    $$P(D=1 \\mid G=1) = (0.02)\\left(\\frac{21}{22}\\right) + (0.30)\\left(\\frac{1}{22}\\right) = \\frac{0.42 + 0.30}{22} = \\frac{0.72}{22} \\approx 0.0327$$\n    $P(D=1 \\mid G=0) = P(D=1 \\mid G=0, S=s_0)P(S=s_0 \\mid G=0) + P(D=1 \\mid G=0, S=s_1)P(S=s_1 \\mid G=0)$\n    $$P(D=1 \\mid G=0) = (0.01)\\left(\\frac{7}{34}\\right) + (0.20)\\left(\\frac{27}{34}\\right) = \\frac{0.07 + 5.40}{34} = \\frac{5.47}{34} \\approx 0.1609$$\n\n比较风险，我们发现 $P(D=1 \\mid G=1) \\approx 0.0327  P(D=1 \\mid G=0) \\approx 0.1609$。这展示了一种逆转：在混合人群中，该等位基因表现出保护性。然而，我们已知对于每个层 $s$，都有 $P(D=1 \\mid G=1, S=s) > P(D=1 \\mid G=0, S=s)$。这就是辛普森悖论。混淆变量 $S$ 与暴露（$G$）和结果（$D$）都有关联，并产生了一个伪边际关联。为了估计 $G$ 对 $D$ 的真实因果效应，必须对混淆变量 $S$ 进行调整。这可以通过检查分层特定风险来实现，这些风险一致地表明该等位基因是有害的。悖论的产生是因为携带风险等位基因（$G=1$）的个体主要来自低风险人群（$s_0$），而没有该等位基因（$G=0$）的个体主要来自高风险人群（$s_1$）。\n\n**第四步：评估选项**\n\nA. 该选项提出了包含 $S \\rightarrow G$、$S \\rightarrow D$ 和 $G \\rightarrow D$ 的DAG。这正确地将 $S$ 建模为混淆变量。它指出边际关联 $P(D=1 \\mid G)$ 将会逆转，我们的计算 $P(D=1 \\mid G=1)  P(D=1 \\mid G=0)$ 证实了这一点。它正确地指出真实效应是增加风险的，并且通过对 $S$ 进行调整可以恢复。其推理合理，与我们的推导完全一致。\n**结论：正确。**\n\nB. 该选项提出了一个 $S$ 是对撞节点（$G \\rightarrow S \\leftarrow D$）的DAG。这种因果结构不合逻辑，因为基因型和疾病不会导致祖源。它错误地声称悖论是*由于*对 $S$ 进行条件化而产生的，这与混淆的真相恰恰相反。它还错误地预测边际关联将是正向的。\n**结论：错误。**\n\nC. 该选项正确地识别了混淆结构（$G \\leftarrow S \\rightarrow D$），但建议对结果 $D$ 进行调整。为了找到原因的效应而对结果进行调整是因果推断中的一个根本性错误，这会引入偏倚，而不是消除它。悖论是关于边际关联的观察，而不是在对结果进行条件化后才出现的东西。\n**结论：错误。**\n\nD. 该选项声称不存在混淆，正确的DAG就是 $G \\rightarrow D$。这与给定的概率直接矛盾，因为概率显示了 $S$ 和 $G$ 之间以及 $S$ 和 $D$ 之间的强关联。它错误地将悖论归结为“抽样变异性”，而实际上这是由给定的人群概率所决定的确定性结果。\n**结论：错误。**", "answer": "$$\\boxed{A}$$", "id": "2374723"}]}