{"hands_on_practices": [{"introduction": "在应用BFGS公式之前，我们必须首先计算两个关键向量：步长向量 $s_k$ 和梯度差向量 $y_k$。这个练习将引导你完成这一基本步骤，为后续的更新计算奠定基础。通过一个具体的函数和迭代点，你将练习计算这些构成了BFGS算法核心的向量。[@problem_id:2208670]", "problem": "在数值优化中，拟牛顿法是一类用于寻找函数局部最小值或最大值的算法。这类算法中一个著名的方法是 Broyden-Fletcher-Goldfarb-Shanno (BFGS) 算法，该算法迭代地逼近目标函数的逆黑塞矩阵。此过程中的一个关键步骤是计算从一次迭代到下一次迭代的两个向量：步长向量 $s_k = x_{k+1} - x_k$ 和梯度差向量 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$。\n\n考虑优化一个定义如下的双变量函数 $f(x_1, x_2)$：\n$$\nf(x_1, x_2) = x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)\n$$\n一个优化算法当前处于第 $k$ 次迭代，序列中最近的两个点由向量 $x_k = (0, \\pi)$ 和 $x_{k+1} = (\\frac{\\pi}{2}, 0)$ 给出。\n\n计算步长向量 $s_k = (s_{k,1}, s_{k,2})$ 和梯度差向量 $y_k = (y_{k,1}, y_{k,2})$ 的分量。将您的最终答案表示为包含 $s_{k,1}, s_{k,2}, y_{k,1}, y_{k,2}$ 这四个分量的单个行矩阵。", "solution": "目标是对于给定的函数和点，计算步长向量 $s_k = x_{k+1} - x_k$ 和梯度差向量 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$ 的分量。\n\n首先，我们计算步长向量 $s_k$。给定的点为 $x_k = (0, \\pi)$ 和 $x_{k+1} = (\\frac{\\pi}{2}, 0)$。\n$s_k$ 的分量可以通过用 $x_{k+1}$ 的分量减去 $x_k$ 的分量得到：\n$$\ns_k = x_{k+1} - x_k = \\begin{pmatrix} \\frac{\\pi}{2} \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ \\pi \\end{pmatrix} = \\begin{pmatrix} \\frac{\\pi}{2} - 0 \\\\ 0 - \\pi \\end{pmatrix} = \\begin{pmatrix} \\frac{\\pi}{2} \\\\ -\\pi \\end{pmatrix}\n$$\n所以，$s_{k,1} = \\frac{\\pi}{2}$ 且 $s_{k,2} = -\\pi$。\n\n接下来，我们计算梯度差向量 $y_k$。这需要求出函数 $f(x_1, x_2)$ 的梯度，并在点 $x_k$ 和 $x_{k+1}$ 处进行求值。\n函数为 $f(x_1, x_2) = x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)$。\n梯度 $\\nabla f$ 是一个由偏导数组成的向量：\n$$\n\\nabla f(x_1, x_2) = \\begin{pmatrix} \\frac{\\partial f}{\\partial x_1} \\\\ \\frac{\\partial f}{\\partial x_2} \\end{pmatrix}\n$$\n关于 $x_1$ 的偏导数是：\n$$\n\\frac{\\partial f}{\\partial x_1} = \\frac{\\partial}{\\partial x_1} (x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)) = 2x_1 \\sin(x_2) - x_2^2 \\sin(x_1)\n$$\n关于 $x_2$ 的偏导数是：\n$$\n\\frac{\\partial f}{\\partial x_2} = \\frac{\\partial}{\\partial x_2} (x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)) = x_1^2 \\cos(x_2) + 2x_2 \\cos(x_1)\n$$\n所以梯度向量是：\n$$\n\\nabla f(x_1, x_2) = \\begin{pmatrix} 2x_1 \\sin(x_2) - x_2^2 \\sin(x_1) \\\\ x_1^2 \\cos(x_2) + 2x_2 \\cos(x_1) \\end{pmatrix}\n$$\n现在，我们在点 $x_k = (0, \\pi)$ 处计算梯度：\n$$\n\\nabla f(x_k) = \\nabla f(0, \\pi) = \\begin{pmatrix} 2(0) \\sin(\\pi) - \\pi^2 \\sin(0) \\\\ 0^2 \\cos(\\pi) + 2\\pi \\cos(0) \\end{pmatrix} = \\begin{pmatrix} 0 - \\pi^2(0) \\\\ 0(-1) + 2\\pi(1) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 2\\pi \\end{pmatrix}\n$$\n接下来，我们在点 $x_{k+1} = (\\frac{\\pi}{2}, 0)$ 处计算梯度：\n$$\n\\nabla f(x_{k+1}) = \\nabla f(\\frac{\\pi}{2}, 0) = \\begin{pmatrix} 2(\\frac{\\pi}{2}) \\sin(0) - 0^2 \\sin(\\frac{\\pi}{2}) \\\\ (\\frac{\\pi}{2})^2 \\cos(0) + 2(0) \\cos(\\frac{\\pi}{2}) \\end{pmatrix} = \\begin{pmatrix} \\pi(0) - 0(1) \\\\ \\frac{\\pi^2}{4}(1) + 0(0) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{\\pi^2}{4} \\end{pmatrix}\n$$\n最后，我们计算梯度差向量 $y_k$：\n$$\ny_k = \\nabla f(x_{k+1}) - \\nabla f(x_k) = \\begin{pmatrix} 0 \\\\ \\frac{\\pi^2}{4} \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 2\\pi \\end{pmatrix} = \\begin{pmatrix} 0 - 0 \\\\ \\frac{\\pi^2}{4} - 2\\pi \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{\\pi^2}{4} - 2\\pi \\end{pmatrix}\n$$\n所以，$y_{k,1} = 0$ 且 $y_{k,2} = \\frac{\\pi^2}{4} - 2\\pi$。\n\n这四个分量是 $s_{k,1} = \\frac{\\pi}{2}$，$s_{k,2} = -\\pi$，$y_{k,1} = 0$ 和 $y_{k,2} = \\frac{\\pi^2}{4} - 2\\pi$。\n将这些分量按指定顺序组合成一个行矩阵，得到：\n$$\n\\begin{pmatrix} \\frac{\\pi}{2}   -\\pi   0   \\frac{\\pi^2}{4} - 2\\pi \\end{pmatrix}\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\pi}{2}  -\\pi  0  \\frac{\\pi^{2}}{4} - 2\\pi \\end{pmatrix}}\n$$", "id": "2208670"}, {"introduction": "掌握了如何计算 $s_k$ 和 $y_k$ 之后，我们就可以进行完整的BFGS更新了。本练习将指导你应用完整的BFGS公式，从当前的逆Hessian矩阵近似 $H_k$ 和相关向量出发，计算出更新后的矩阵 $H_{k+1}$。这是拟牛顿法中一个核心的计算环节。[@problem_id:2208621]", "problem": "在数值优化中，拟牛顿法用于寻找函数的最小值。这些方法在每次迭代中构建逆 Hessian 矩阵的近似。其中最流行的更新过程之一是 Broyden-Fletcher-Goldfarb-Shanno (BFGS) 更新公式。\n\n设 $H_k$ 为第 $k$ 次迭代时逆 Hessian 矩阵的近似。从点 $x_k$ 移动到点 $x_{k+1}$ 后，逆 Hessian 矩阵使用以下公式更新为 $H_{k+1}$：\n$$ H_{k+1} = \\left(I - \\frac{s_k y_k^T}{y_k^T s_k}\\right) H_k \\left(I - \\frac{y_k s_k^T}{y_k^T s_k}\\right) + \\frac{s_k s_k^T}{y_k^T s_k} $$\n其中 $I$ 是单位矩阵，步长向量为 $s_k = x_{k+1} - x_k$，梯度的变化量为 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$。\n\n考虑一个函数 $f: \\mathbb{R}^2 \\to \\mathbb{R}$。在第 $k$ 次迭代时，我们有以下信息：\n- 当前的逆 Hessian 矩阵近似为单位矩阵：$H_k = \\begin{pmatrix} 1   0 \\\\ 0   1 \\end{pmatrix}$。\n- 当前点为 $x_k = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n- 当前点的梯度为 $\\nabla f(x_k) = \\begin{pmatrix} -3 \\\\ 1 \\end{pmatrix}$。\n- 下一个点为 $x_{k+1} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix}$。\n- 下一个点的梯度为 $\\nabla f(x_{k+1}) = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n计算更新后的逆 Hessian 矩阵近似 $H_{k+1}$。确定 $H_{k+1}$ 的第二行第一列的元素值。将最终答案四舍五入到三位有效数字。", "solution": "我们使用 BFGS 逆 Hessian 更新公式：\n$$\nH_{k+1}=\\left(I-\\frac{s_{k}y_{k}^{T}}{y_{k}^{T}s_{k}}\\right)H_{k}\\left(I-\\frac{y_{k}s_{k}^{T}}{y_{k}^{T}s_{k}}\\right)+\\frac{s_{k}s_{k}^{T}}{y_{k}^{T}s_{k}}.\n$$\n给定 $H_{k}=I$, $x_{k}=\\begin{pmatrix}1\\\\2\\end{pmatrix}$, $x_{k+1}=\\begin{pmatrix}2\\\\0\\end{pmatrix}$, $\\nabla f(x_{k})=\\begin{pmatrix}-3\\\\1\\end{pmatrix}$ 和 $\\nabla f(x_{k+1})=\\begin{pmatrix}1\\\\-1\\end{pmatrix}$，我们首先计算 $s_k$ 和 $y_k$：\n$$\ns_{k}=x_{k+1}-x_{k}=\\begin{pmatrix}2 - 1\\\\0 - 2\\end{pmatrix} = \\begin{pmatrix}1\\\\-2\\end{pmatrix}\n$$\n$$\ny_{k}=\\nabla f(x_{k+1})-\\nabla f(x_{k})=\\begin{pmatrix}1 - (-3)\\\\-1 - 1\\end{pmatrix} = \\begin{pmatrix}4\\\\-2\\end{pmatrix}.\n$$\n接下来计算标量内积 $y_{k}^{T}s_{k}$：\n$$\ny_{k}^{T}s_{k}= \\begin{pmatrix}4  -2\\end{pmatrix} \\begin{pmatrix}1\\\\-2\\end{pmatrix} = 4 \\cdot 1+(-2)\\cdot(-2)=8.\n$$\n由于 $H_k = I$，公式的第一项可以展开。我们先计算各项：\n$$\nI-\\frac{s_{k}y_{k}^{T}}{y_{k}^{T}s_{k}} = \\begin{pmatrix}1  0\\\\0  1\\end{pmatrix} - \\frac{1}{8}\\begin{pmatrix}1\\\\-2\\end{pmatrix}\\begin{pmatrix}4  -2\\end{pmatrix} = \\begin{pmatrix}1  0\\\\0  1\\end{pmatrix} - \\frac{1}{8}\\begin{pmatrix}4  -2\\\\-8  4\\end{pmatrix} = \\begin{pmatrix}1-\\frac{1}{2}  \\frac{1}{4}\\\\1  1-\\frac{1}{2}\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{2}  \\frac{1}{4}\\\\1  \\frac{1}{2}\\end{pmatrix}\n$$\n$$\nI-\\frac{y_{k}s_{k}^{T}}{y_{k}^{T}s_{k}} = \\begin{pmatrix}1  0\\\\0  1\\end{pmatrix} - \\frac{1}{8}\\begin{pmatrix}4\\\\-2\\end{pmatrix}\\begin{pmatrix}1  -2\\end{pmatrix} = \\begin{pmatrix}1  0\\\\0  1\\end{pmatrix} - \\frac{1}{8}\\begin{pmatrix}4  -8\\\\-2  4\\end{pmatrix} = \\begin{pmatrix}1-\\frac{1}{2}  1\\\\\\frac{1}{4}  1-\\frac{1}{2}\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{2}  1\\\\\\frac{1}{4}  \\frac{1}{2}\\end{pmatrix}\n$$\n将这两项相乘（因为 $H_k=I$）：\n$$\n\\left(I-\\frac{s_{k}y_{k}^{T}}{y_{k}^{T}s_{k}}\\right)\\left(I-\\frac{y_{k}s_{k}^{T}}{y_{k}^{T}s_{k}}\\right) = \\begin{pmatrix}\\frac{1}{2}  \\frac{1}{4}\\\\1  \\frac{1}{2}\\end{pmatrix}\\begin{pmatrix}\\frac{1}{2}  1\\\\\\frac{1}{4}  \\frac{1}{2}\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{4}+\\frac{1}{16}  \\frac{1}{2}+\\frac{1}{8}\\\\\\frac{1}{2}+\\frac{1}{8}  1+\\frac{1}{4}\\end{pmatrix} = \\begin{pmatrix}\\frac{5}{16}  \\frac{5}{8}\\\\ \\frac{5}{8}  \\frac{5}{4}\\end{pmatrix}\n$$\n现在计算公式的第二项：\n$$\n\\frac{s_{k}s_{k}^{T}}{y_{k}^{T}s_{k}} = \\frac{1}{8}\\begin{pmatrix}1\\\\-2\\end{pmatrix}\\begin{pmatrix}1  -2\\end{pmatrix} = \\frac{1}{8}\\begin{pmatrix}1  -2\\\\-2  4\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{8}  -\\frac{1}{4}\\\\-\\frac{1}{4}  \\frac{1}{2}\\end{pmatrix}\n$$\n最后，将两项相加得到 $H_{k+1}$：\n$$\nH_{k+1}=\\begin{pmatrix}\\frac{5}{16}  \\frac{5}{8}\\\\ \\frac{5}{8}  \\frac{5}{4}\\end{pmatrix} + \\begin{pmatrix}\\frac{1}{8}  -\\frac{1}{4}\\\\-\\frac{1}{4}  \\frac{1}{2}\\end{pmatrix} = \\begin{pmatrix}\\frac{5}{16}+\\frac{2}{16}  \\frac{5}{8}-\\frac{2}{8}\\\\ \\frac{5}{8}-\\frac{2}{8}  \\frac{5}{4}+\\frac{2}{4}\\end{pmatrix} = \\begin{pmatrix}\\frac{7}{16}  \\frac{3}{8}\\\\ \\frac{3}{8}  \\frac{7}{4}\\end{pmatrix}\n$$\n第二行第一列的元素是 $\\frac{3}{8}=0.375$。四舍五入到三位有效数字得到 $0.375$。", "answer": "$$\\boxed{0.375}$$", "id": "2208621"}, {"introduction": "BFGS公式的复杂形式并非随意设计，其关键目的之一是满足所谓的“割线条件” $H_{k+1} y_k = s_k$。这个条件确保了新的Hessian近似能够正确反映最近一步的梯度变化信息。本练习旨在通过直接计算来验证这一重要属性，从而加深你对BFGS方法理论基础的理解。[@problem_id:2208659]", "problem": "在数值优化领域，拟牛顿法是寻找函数局部最小值的常用方法。这些方法在每次迭代中构建一个逆Hessian矩阵的近似。Broyden-Fletcher-Goldfarb-Shanno (BFGS) 更新是为此目的最有效的算法之一。\n\n用于将近似逆Hessian矩阵 $H_k$ 更新为 $H_{k+1}$ 的BFGS公式如下：\n$$H_{k+1} = \\left(I - \\frac{s_k y_k^T}{y_k^T s_k}\\right) H_k \\left(I - \\frac{y_k s_k^T}{y_k^T s_k}\\right) + \\frac{s_k s_k^T}{y_k^T s_k}$$\n其中 $I$ 是单位矩阵，$s_k = x_{k+1} - x_k$ 是位置上的步长，$y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$ 是梯度的变化。符号 $v^T$ 表示列向量 $v$ 的转置。\n\n考虑一个在二维空间中拟牛顿优化算法的单步。相关量如下：\n- 初始近似逆Hessian矩阵：$H_k = \\begin{pmatrix} 1   0 \\\\ 0   1 \\end{pmatrix}$\n- 步长向量：$s_k = \\begin{pmatrix} 1 \\\\ 3 \\end{pmatrix}$\n- 梯度变化：$y_k = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}$\n\n你的任务是计算由矩阵-向量乘积 $V = H_{k+1} y_k$ 得到的向量 $V$。\n\n将你的最终答案表示为行矩阵。例如，列向量 $\\begin{pmatrix} a \\\\ b \\end{pmatrix}$ 应写作 $\\begin{pmatrix} a   b \\end{pmatrix}$。", "solution": "我们的任务是计算 $V = H_{k+1}y_k$。我们可以先计算矩阵 $H_{k+1}$，然后将其与 $y_k$ 相乘。\n\nBFGS 逆Hessian更新公式为：\n$$H_{k+1}=\\left(I-\\frac{s_{k}y_{k}^{T}}{y_{k}^{T}s_{k}}\\right)H_{k}\\left(I-\\frac{y_{k}s_{k}^{T}}{y_{k}^{T}s_{k}}\\right)+\\frac{s_{k}s_{k}^{T}}{y_{k}^{T}s_{k}}$$\n给定的量为 $H_{k}=I$，$s_{k}=\\begin{pmatrix}1\\\\3\\end{pmatrix}$，以及 $y_{k}=\\begin{pmatrix}2\\\\1\\end{pmatrix}$。\n\n首先计算标量内积 $y_k^T s_k$：\n$$y_{k}^{T}s_{k}= \\begin{pmatrix} 2  1 \\end{pmatrix} \\begin{pmatrix}1\\\\3\\end{pmatrix} = 2\\cdot 1+1\\cdot 3=5$$\n设 $\\rho_k = \\frac{1}{y_k^T s_k} = \\frac{1}{5}$。\n由于 $H_k = I$，公式简化为：\n$$H_{k+1}=\\left(I-\\rho_k s_{k}y_{k}^{T}\\right)\\left(I-\\rho_k y_{k}s_{k}^{T}\\right)+\\rho_k s_{k}s_{k}^{T}$$\n我们先计算第一项的乘积：\n$$\n\\left(I-\\rho_k s_{k}y_{k}^{T}\\right)\\left(I-\\rho_k y_{k}s_{k}^{T}\\right) = \\left(\\begin{pmatrix}1  0\\\\0  1\\end{pmatrix}-\\frac{1}{5}\\begin{pmatrix}1\\\\3\\end{pmatrix}\\begin{pmatrix}2   1\\end{pmatrix}\\right) \\left(\\begin{pmatrix}1  0\\\\0  1\\end{pmatrix}-\\frac{1}{5}\\begin{pmatrix}2\\\\1\\end{pmatrix}\\begin{pmatrix}1   3\\end{pmatrix}\\right)\n$$\n$$\n= \\left(\\begin{pmatrix}1  0\\\\0  1\\end{pmatrix}-\\frac{1}{5}\\begin{pmatrix}2  1\\\\6  3\\end{pmatrix}\\right) \\left(\\begin{pmatrix}1  0\\\\0  1\\end{pmatrix}-\\frac{1}{5}\\begin{pmatrix}2  6\\\\1  3\\end{pmatrix}\\right)\n$$\n$$\n= \\begin{pmatrix}\\frac{3}{5}   -\\frac{1}{5}\\\\ -\\frac{6}{5}   \\frac{2}{5}\\end{pmatrix} \\begin{pmatrix}\\frac{3}{5}   -\\frac{6}{5}\\\\ -\\frac{1}{5}   \\frac{2}{5}\\end{pmatrix} = \\begin{pmatrix}\\frac{9}{25}+\\frac{1}{25}   -\\frac{18}{25}-\\frac{2}{25}\\\\ -\\frac{18}{25}-\\frac{2}{25}   \\frac{36}{25}+\\frac{4}{25}\\end{pmatrix} = \\begin{pmatrix}\\frac{10}{25}   -\\frac{20}{25}\\\\ -\\frac{20}{25}   \\frac{40}{25}\\end{pmatrix} = \\begin{pmatrix}\\frac{2}{5}   -\\frac{4}{5}\\\\ -\\frac{4}{5}   \\frac{8}{5}\\end{pmatrix}\n$$\n接下来计算第二项：\n$$\\rho_k s_{k}s_{k}^{T}=\\frac{1}{5}\\begin{pmatrix}1\\\\3\\end{pmatrix}\\begin{pmatrix}1   3\\end{pmatrix}=\\frac{1}{5}\\begin{pmatrix}1  3\\\\3  9\\end{pmatrix}=\\begin{pmatrix}\\frac{1}{5}   \\frac{3}{5}\\\\ \\frac{3}{5}   \\frac{9}{5}\\end{pmatrix}$$\n将两项相加得到 $H_{k+1}$：\n$$H_{k+1}=\\begin{pmatrix}\\frac{2}{5}   -\\frac{4}{5}\\\\ -\\frac{4}{5}   \\frac{8}{5}\\end{pmatrix}+\\begin{pmatrix}\\frac{1}{5}   \\frac{3}{5}\\\\ \\frac{3}{5}   \\frac{9}{5}\\end{pmatrix}=\\begin{pmatrix}\\frac{3}{5}   -\\frac{1}{5}\\\\ -\\frac{1}{5}   \\frac{17}{5}\\end{pmatrix}$$\n现在计算 $V=H_{k+1}y_{k}$：\n$$V=\\begin{pmatrix}\\frac{3}{5}   -\\frac{1}{5}\\\\ -\\frac{1}{5}   \\frac{17}{5}\\end{pmatrix}\\begin{pmatrix}2\\\\1\\end{pmatrix}=\\begin{pmatrix}\\frac{3}{5}\\cdot 2-\\frac{1}{5}\\cdot 1\\\\ -\\frac{1}{5}\\cdot 2+\\frac{17}{5}\\cdot 1\\end{pmatrix}=\\begin{pmatrix}\\frac{6-1}{5}\\\\ \\frac{-2+17}{5}\\end{pmatrix}=\\begin{pmatrix}\\frac{5}{5}\\\\ \\frac{15}{5}\\end{pmatrix}=\\begin{pmatrix}1\\\\3\\end{pmatrix}$$\n这个结果恰好等于 $s_k$。这验证了BFGS更新满足割线条件 $H_{k+1}y_{k}=s_{k}$。因此，所要求的行矩阵是 $\\begin{pmatrix}1   3\\end{pmatrix}$。", "answer": "$$\\boxed{\\begin{pmatrix} 1  3 \\end{pmatrix}}$$", "id": "2208659"}]}