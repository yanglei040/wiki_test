{"hands_on_practices": [{"introduction": "狗腿法 (Dogleg Method) 的路径由两个关键点确定。第一个是牛顿步 (Newton step)，它代表了二次模型函数的无约束最优点。通过计算牛顿步 [@problem_id:2212755]，我们确定了在不考虑信赖域限制时的“理想”前进方向和距离，这是狗腿路径的最终目标。", "problem": "在信赖域优化算法中，于当前迭代点，目标函数由一个二次模型 $m(p) = f + g^T p + \\frac{1}{2} p^T B p$ 来近似。该模型描述了从当前点出发，移动一个步长 $p$ 后目标函数的变化。许多信赖域策略（例如狗腿法）中的一个关键组成部分是牛顿步，它是该二次模型的无约束极小值点。\n\n给定梯度向量 $g = \\begin{pmatrix} -4 \\\\ 6 \\end{pmatrix}$ 和一个正定Hessian近似矩阵 $B = \\begin{pmatrix} 2  0 \\\\ 0  3 \\end{pmatrix}$，计算此二次模型的牛顿步 $p_B$。", "solution": "牛顿步是二次模型 $m(p) = f + g^{T} p + \\frac{1}{2} p^{T} B p$ 的无约束极小值点。对于对称正定矩阵 $B$，一阶最优性条件通过将关于 $p$ 的梯度设为零来获得：\n$$\n\\nabla m(p) = g + B p = 0.\n$$\n这产生一个线性系统\n$$\nB p_{B} = -g,\n$$\n因此牛顿步为\n$$\np_{B} = -B^{-1} g.\n$$\n给定 $g = \\begin{pmatrix} -4 \\\\ 6 \\end{pmatrix}$ 和 $B = \\begin{pmatrix} 2  0 \\\\ 0  3 \\end{pmatrix}$，其逆矩阵为\n$$\nB^{-1} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix}.\n$$\n因此，\n$$\nB^{-1} g = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} -4 \\\\ 6 \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ 2 \\end{pmatrix},\n$$\n且\n$$\np_{B} = - \\begin{pmatrix} -2 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ -2 \\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 2 \\\\ -2 \\end{pmatrix}}$$", "id": "2212755"}, {"introduction": "与理想化的牛顿步相对，狗腿路径的另一个关键组成部分是在最速下降方向上的最优步长，通常称为柯西点 (Cauchy point)。它是在信赖域约束内，能使模型函数达到最小的“安全”步长。这个练习 [@problem_id:2212704] 将指导你计算柯西点 $p_C$，它是狗腿路径的起点或第一段。", "problem": "在数值优化领域，信赖域方法是一类用于解决非线性规划问题的算法。这些方法通过在当前点 $x_k$ 周围半径为 $\\Delta$ 的“信赖域”内，最小化真实目标函数的模型函数 $m(p)$，来迭代地寻找步长 $p$。该模型通常是一个二次近似：\n$$m(p) = f(x_k) + g^T p + \\frac{1}{2} p^T B p$$\n其中，$g$ 是目标函数在 $x_k$ 处的梯度，$B$ 是Hessian矩阵的近似。\n\n许多信赖域算法（如狗腿法）的一个基本组成部分是计算柯西点 $p_C$。柯西点被定义为在最速下降方向上使二次模型 $m(p)$ 最小化的向量，并满足步长位于信赖域内的约束，即 $\\|p\\| \\le \\Delta$。\n\n考虑一个优化问题，在当前迭代点，梯度由 $g = \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix}$ 给出，Hessian近似为单位矩阵 $B = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$。信赖域半径设置为 $\\Delta = 4$。\n\n计算此场景下的柯西点 $p_C$。您的答案应该是一个包含精确分数的 2x1 列向量。", "solution": "问题要求计算柯西点 $p_C$，它是以下约束优化问题的解：\n$$ \\min_{p} \\quad m(p) = f(x_k) + g^T p + \\frac{1}{2} p^T B p $$\n$$ \\text{subject to} \\quad p = -\\tau g \\text{ for some } \\tau \\ge 0, \\quad \\text{and} \\quad \\|p\\| \\le \\Delta $$\n\n搜索方向为最速下降方向 $d = -g$。此方向上的任意点可以参数化为 $p(\\tau) = -\\tau g$，其中标量 $\\tau \\ge 0$。\n\n首先，我们将其代入二次模型 $m(p)$，得到一个关于单变量 $\\tau$ 的函数：\n$$ \\phi(\\tau) = m(-\\tau g) = f(x_k) + g^T(-\\tau g) + \\frac{1}{2} (-\\tau g)^T B (-\\tau g) $$\n$$ \\phi(\\tau) = f(x_k) - \\tau (g^T g) + \\frac{1}{2} \\tau^2 (g^T B g) $$\n常数项 $f(x_k)$ 不影响极小值点，因此我们可以专注于最小化与 $\\tau$ 相关的部分。\n\n接下来，我们将信赖域约束 $\\|p\\| \\le \\Delta$ 转换为对 $\\tau$ 的约束：\n$$ \\|p(\\tau)\\| = \\|-\\tau g\\| = |\\tau| \\|g\\| = \\tau \\|g\\| \\le \\Delta $$\n因为我们寻求的是下降方向上的步长，所以 $\\tau \\ge 0$。因此，对 $\\tau$ 的约束为：\n$$ 0 \\le \\tau \\le \\frac{\\Delta}{\\|g\\|} $$\n\n现在，我们通过对 $\\phi(\\tau)$ 求关于 $\\tau$ 的导数并令其为零，来找到该二次函数的无约束极小值点。这将给出在没有信赖域约束的情况下的最优步长 $\\tau^*$。\n$$ \\frac{d\\phi}{d\\tau} = -g^T g + \\tau (g^T B g) = 0 $$\n解出 $\\tau$，我们得到：\n$$ \\tau^* = \\frac{g^T g}{g^T B g} $$\n二阶导数是 $\\frac{d^2\\phi}{d\\tau^2} = g^T B g$。如果它为正，我们就找到了一个极小值点。\n\n让我们使用给定的值计算所需的量：\n$g = \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix}$，$B = I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$，以及 $\\Delta = 4$。\n\n1.  计算 $g^T g$：\n    $g^T g = (3)(3) + (-4)(-4) = 9 + 16 = 25$。\n\n2.  计算 $\\|g\\|$：\n    $\\|g\\| = \\sqrt{g^T g} = \\sqrt{25} = 5$。\n\n3.  计算 $g^T B g$：\n    由于 $B=I$，$g^T B g = g^T I g = g^T g = 25$。\n\n二阶导数 $g^T B g = 25 > 0$，所以 $\\phi(\\tau)$ 是一个凸抛物线，其无约束极小值点确实在 $\\tau^*$。\n\n4.  计算无约束最优步长 $\\tau^*$：\n    $$ \\tau^* = \\frac{g^T g}{g^T B g} = \\frac{25}{25} = 1 $$\n\n5.  确定 $\\tau$ 的可行区间：\n    约束是 $0 \\le \\tau \\le \\frac{\\Delta}{\\|g\\|}$。\n    $$ \\frac{\\Delta}{\\|g\\|} = \\frac{4}{5} = 0.8 $$\n    所以，$\\tau$ 的可行区间是 $[0, 0.8]$。\n\n6.  找到约束最优步长 $\\tau_C$。无约束极小值点 $\\tau^* = 1$ 位于可行区间 $[0, 0.8]$ 之外。由于 $\\phi(\\tau)$ 是一个在 $\\tau=1$ 处取得极小值的凸抛物线，因此在区间 $[0, 0.8]$ 上 $\\phi(\\tau)$ 的最小值必然出现在离 $\\tau=1$ 最近的边界点上。这个点就是 $\\tau = 0.8$。\n    因此，柯西点的步长为 $\\tau_C = \\frac{\\Delta}{\\|g\\|} = \\frac{4}{5}$。\n\n7.  计算柯西点 $p_C$：\n    $$ p_C = -\\tau_C g = -\\frac{4}{5} \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix} = \\begin{pmatrix} -12/5 \\\\ 16/5 \\end{pmatrix} $$\n\n柯西点是 $p_C = \\begin{pmatrix} -12/5 \\\\ 16/5 \\end{pmatrix}$。我们来验证其范数：$\\|p_C\\| = \\sqrt{(-12/5)^2 + (16/5)^2} = \\sqrt{\\frac{144+256}{25}} = \\sqrt{\\frac{400}{25}} = \\sqrt{16} = 4$，这与信赖域半径 $\\Delta$ 完全相等，符合预期。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\frac{12}{5} \\\\ \\frac{16}{5} \\end{pmatrix}\n}\n$$", "id": "2212704"}, {"introduction": "在分别计算了代表“理想”目标的牛顿步（如此问题中的 $p^B$）和代表“安全”起点的最速下降步（$p^U$）之后，狗腿法的核心就是建立一个决策框架。该框架根据信赖域半径 $\\Delta$ 的大小，决定是直接取牛顿步、沿着最速下降方向走到边界，还是在两者之间进行插值。这个练习 [@problem_id:2212701] 正是要求你将这个完整的决策逻辑转化为算法伪代码，这是从理论走向实践的关键一步。", "problem": "在数值优化领域，信赖域方法是一类用于求解无约束非线性规划问题的算法。在每次迭代中，这些算法会围绕当前点定义一个“信赖域”，在该区域内，目标函数的一个模型（通常是二次近似）被认为是可靠的。然后，算法在该信赖域内寻找一个使该模型最小化的步长。\n\n狗腿法（Dogleg method）是近似求解此信赖域子问题的一种常用技术。该子问题是寻找一个步长向量 $p$，以最小化二次模型\n$$m(p) = f_k + g^T p + \\frac{1}{2} p^T B p$$\n并满足约束条件 $\\|p\\|_2 \\le \\Delta$，其中 $g$ 是目标函数的梯度，$B$ 是Hessian矩阵的一个正定近似，$\\Delta > 0$ 是信赖域半径。所有向量和矩阵都在当前迭代点 $x_k$ 处进行计算。\n\n狗腿法通过考虑一条分段线性路径来构造一个试验步长 $p$。该路径连接了原点、沿最速下降方向的无约束极小点，以及完整二次模型的无约束极小点。这两个关键点是：\n1.  拟牛顿步，$p^B = -B^{-1}g$，它是 $m(p)$ 的无约束极小点。\n2.  最速下降步，$p^U = -\\frac{g^T g}{g^T B g}g$，它是 $m(p)$ 沿着负梯度方向 $-g$ 的极小点。\n\n你的任务是选择正确的条件逻辑块，程序将使用该逻辑块根据信赖域半径 $\\Delta$ 以及 $p^B$ 和 $p^U$ 的欧几里得范数来确定试验步长 $p$。为解决此问题，假设 `norm(v)` 计算欧几里得范数 $\\|v\\|_2$。\n\n下列哪个伪代码片段正确地实现了选择狗腿步长 $p$ 的逻辑？\n\nA.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  IF norm(pU) >= delta:\n    Set p = delta * (pU / norm(pU))\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```\n\nB.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  Set p = delta * (pB / norm(pB))\n```\n\nC.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  Set p = delta * (pU / norm(pU))\n```\n\nD.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  IF norm(pU)  delta:\n    Set p = delta * (pU / norm(pU))\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```\n\nE.\n```\nIF norm(pU) >= delta:\n  Set p = delta * (pU / norm(pU))\nELSE:\n  IF norm(pB) = delta:\n    Set p = pB\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```", "solution": "我们在求解二次模型\n$$\nm(p) = f_{k} + g^{T}p + \\frac{1}{2} p^{T} B p\n$$\n的信赖域子问题，约束条件为 $\\|p\\|_{2} \\le \\Delta$，其中 $B$ 是正定的。狗腿法构造了一条分段线性路径，该路径包含两段：从原点到最速下降（柯西）步 $p^{U}$，然后从 $p^{U}$ 到拟牛顿步 $p^{B}$。其定义为\n$$\np^{B} = -B^{-1} g, \\quad p^{U} = -\\frac{g^{T} g}{g^{T} B g}\\, g.\n$$\n\n正确的选择逻辑遵循由信赖域半径 $\\Delta$ 以及 $p^{B}$ 和 $p^{U}$ 的范数决定的三个互斥情况：\n\n1) 如果 $\\|p^{B}\\|_{2} \\le \\Delta$，那么无约束极小点 $p^{B}$ 是可行的。由于 $B$ 是正定的，$p^{B}$ 是 $m(p)$ 在所有 $p$ 上的唯一极小点，并且由于其可行，它也是有约束的极小点。因此，设\n$$\np = p^{B}.\n$$\n\n2) 否则，如果 $\\|p^{B}\\|_{2} > \\Delta$ 且 $\\|p^{U}\\|_{2} \\ge \\Delta$，那么信赖域边界与狗腿路径的第一段（从 $0$ 到 $p^{U}$）相交。在此边界上沿该段的最优步长通过缩放 $p^{U}$ 使其长度为 $\\Delta$ 来获得：\n$$\np = \\Delta \\frac{p^{U}}{\\|p^{U}\\|_{2}}.\n$$\n\n3) 否则，如果 $\\|p^{B}\\|_{2} > \\Delta$ 且 $\\|p^{U}\\|_{2}  \\Delta$，那么信赖域边界与第二段（从 $p^{U}$ 到 $p^{B}$）相交。我们找到唯一的 $\\tau \\in [0,1]$ 使得\n$$\n\\|p^{U} + \\tau (p^{B} - p^{U})\\|_{2} = \\Delta,\n$$\n并设\n$$\np = p^{U} + \\tau (p^{B} - p^{U}).\n$$\n\n与选项比较：\n- 选项A完全实现了这个逻辑：首先检查 $\\|p^{B}\\|_{2} \\le \\Delta$，否则如果 $\\|p^{U}\\|_{2} \\ge \\Delta$，则将 $p^{U}$ 缩放到边界，否则沿着从 $p^{U}$ 到 $p^{B}$ 的狗腿段求解 $\\tau$。\n- 选项B在 $p^{B}$ 位于外部时错误地缩放了它，忽略了狗腿路径和 $p^{U}$ 的作用。\n- 选项C在 $p^{B}$ 位于外部时总是错误地缩放 $p^{U}$，即使当 $\\|p^{U}\\|_{2}  \\Delta$ 时也是如此，而这种情况并不属于第一段边界交叉点。\n- 选项D颠倒了 $p^{U}$ 的边界情况：它在 $\\|p^{U}\\|_{2}  \\Delta$ 时缩放 $p^{U}$，这是不正确的；在这种情况下，边界位于第二段上，需要用 $\\tau$ 进行插值。\n- 选项E在检查 $\\|p^{B}\\|_{2} \\le \\Delta$ 之前先检查 $\\|p^{U}\\|_{2} \\ge \\Delta$，这可能导致即使 $p^{B}$ 是可行的，也选择了缩放后的 $p^{U}$；这违反了只要 $p^{B}$ 位于信赖域内就应选择它的规则。\n\n因此，正确的伪代码片段是选项A。", "answer": "$$\\boxed{A}$$", "id": "2212701"}]}