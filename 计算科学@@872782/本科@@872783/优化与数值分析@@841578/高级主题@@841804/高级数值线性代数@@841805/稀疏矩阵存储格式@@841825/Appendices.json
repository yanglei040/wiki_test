{"hands_on_practices": [{"introduction": "要掌握任何数据格式，第一步是学会如何解读它。本练习是对压缩稀疏行（CSR）格式理解程度的基础检验，而CSR格式是稀疏矩阵计算的基石。通过亲手重建完整的稠密矩阵，我们将加深对 `values`、`col_indices` 和 `row_ptr` 这三个数组如何协同工作的理解。[@problem_id:2204554]", "problem": "在许多科学和工程应用中，矩阵通常是“稀疏”的，这意味着它们的大多数元素为零。存储所有这些零元素是低效的。压缩稀疏行（CSR）格式是存储稀疏矩阵的一种常见方法，它使用三个一维数组。\n\n考虑一个大小为 $4 \\times 4$ 的稀疏矩阵 $A$。在 CSR 格式中（使用从0开始的索引），该矩阵由以下三个数组表示：\n1.  一个数组 `V`，包含 $A$ 的非零元素，按行从左到右读取。\n2.  一个数组 `C`，包含 `V` 中每个对应元素的列索引。\n3.  一个数组 `R`（行指针），大小为 $m+1$（其中 $m$ 是行数），其中第 $i$ 个元素指示了第 $i$ 行的数据在 `V` 和 `C` 中开始的索引。`R` 的最后一个元素是非零元素的总数。\n\n对于我们的 $4 \\times 4$ 矩阵 $A$，这三个数组如下：\n- `V = [5.1, -1.2, 2.0, -3.5, 4.0, 9.8]`\n- `C = [1, 3, 0, 2, 3, 0]`\n- `R = [0, 2, 3, 5, 6]`\n\n重建原始的 $4 \\times 4$ 稠密矩阵 $A$。将您的答案以一个 $4 \\times 4$ 矩阵的形式呈现。", "solution": "我们使用 CSR 的定义并采用从0开始的索引。对于每个行索引 $i \\in \\{0,1,2,3\\}$，第 $i$ 行的非零元素存储在 `V` 和 `C` 的片段中，其索引 $j$ 的范围是从 $R[i]$ 到 $R[i+1]-1$，其中列索引为 $C[j]$，值为 $V[j]$。最后一个元素 $R[4]=6$ 等于非零元素的总数，与 $\\lvert V \\rvert=6$ 相匹配。\n\n第 $0$ 行：索引 $j=R[0]\\ldots R[1]-1=0\\ldots 1$。\n- $j=0$：$C[0]=1$，$V[0]=5.1$ 得到 $A_{0,1}=5.1$。\n- $j=1$：$C[1]=3$，$V[1]=-1.2$ 得到 $A_{0,3}=-1.2$。\n因此第 $0$ 行为 $[0,\\,5.1,\\,0,\\,-1.2]$。\n\n第 $1$ 行：索引 $j=R[1]\\ldots R[2]-1=2\\ldots 2$。\n- $j=2$：$C[2]=0$，$V[2]=2.0$ 得到 $A_{1,0}=2.0$。\n因此第 $1$ 行为 $[2.0,\\,0,\\,0,\\,0]$。\n\n第 $2$ 行：索引 $j=R[2]\\ldots R[3]-1=3\\ldots 4$。\n- $j=3$：$C[3]=2$，$V[3]=-3.5$ 得到 $A_{2,2}=-3.5$。\n- $j=4$：$C[4]=3$，$V[4]=4.0$ 得到 $A_{2,3}=4.0$。\n因此第 $2$ 行为 $[0,\\,0,\\,-3.5,\\,4.0]$。\n\n第 $3$ 行：索引 $j=R[3]\\ldots R[4]-1=5\\ldots 5$。\n- $j=5$：$C[5]=0$，$V[5]=9.8$ 得到 $A_{3,0}=9.8$。\n因此第 $3$ 行为 $[9.8,\\,0,\\,0,\\,0]$。\n\n因此，重建后的稠密矩阵 $A$ 为\n$$\n\\begin{pmatrix}\n0  5.1  0  -1.2 \\\\\n2.0  0  0  0 \\\\\n0  0  -3.5  4.0 \\\\\n9.8  0  0  0\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0  5.1  0  -1.2 \\\\ 2.0  0  0  0 \\\\ 0  0  -3.5  4.0 \\\\ 9.8  0  0  0\\end{pmatrix}}$$", "id": "2204554"}, {"introduction": "稀疏矩阵的存储并非“一刀切”的问题；不同的格式适用于不同的稀疏模式。本练习将超越简单的格式解码，进入量化分析的层面，针对一种特定的“箭头”型矩阵结构，比较压缩稀疏行（CSR）和对角线（DIA）格式的内存占用。在科学计算中，内存往往是关键瓶颈，因此这项技能对于编写高效代码至关重要。[@problem_id:2204576]", "problem": "在科学计算中，稀疏矩阵（主要由零填充的矩阵）通常以专门的格式存储以节省内存。考虑一个 $N \\times N$ 的“箭头”矩阵，其定义为非零元素仅位于主对角线、第一行和第一列的矩阵。\n\n我们希望比较两种常见的存储格式——压缩稀疏行（CSR）和对角线（DIA）——存储这种矩阵的内存效率。\n\n假设非零值存储为双精度浮点数（每个8字节），所有行/列索引和指针存储为整数（每个4字节）。\n\n每种格式的内存需求定义如下：\n\n1.  **压缩稀疏行（CSR）**：此格式使用三个数组：\n    *   `values`：一个大小为 `nnz` 的数组，用于存储非零值，其中 `nnz` 是非零元素的总数。\n    *   `col_indices`：一个大小为 `nnz` 的数组，用于存储每个非零元素的列索引。\n    *   `row_pointers`：一个大小为 $N+1$ 的数组，用于存储 `values` 数组中标记每行开始位置的索引。\n\n2.  **对角线（DIA）**：此格式针对非零元素沿少数几条对角线分布的矩阵进行了优化。它使用两个数组：\n    *   `offsets`：一个大小为 `d` 的数组，用于存储每条对角线相对于主对角线的偏移量，其中 `d` 是非零对角线的数量。\n    *   `values`：一个稠密的 $N \\times d$ 数组。该数组的每一列存储一条非零对角线的元素。如果某条对角线的元素少于 $N$ 个，则 `values` 数组中相应的列将用零填充。\n\n确定最小的整数维度 $N \\ge 2$，使得存储箭头矩阵时，CSR 格式所需的总内存严格小于 DIA 格式所需的总内存。", "solution": "一个 $N \\times N$ 的箭头矩阵在主对角线、第一行和第一列上有非零项。计算唯一的非零项数量：\n- 主对角线贡献 $N$ 个项。\n- 第一行贡献 $N-1$ 个额外的项（不包括重叠的 $(1,1)$ 项）。\n- 第一列贡献 $N-1$ 个额外的项（不包括重叠的 $(1,1)$ 项）。\n因此，非零项的总数为\n$$\n\\text{nnz} = N + (N - 1) + (N - 1) = 3N - 2.\n$$\n\n对于 CSR：\n- `values` 数组存储 $\\text{nnz}$ 个双精度浮点数：$8(3N - 2)$ 字节。\n- `col_indices` 数组存储 $\\text{nnz}$ 个整数：$4(3N - 2)$ 字节。\n- `row_pointers` 数组存储 $N+1$ 个整数：$4(N+1)$ 字节。\n因此，CSR 的总内存为\n$$\nM_{\\text{CSR}} = 8(3N - 2) + 4(3N - 2) + 4(N+1) = 12(3N - 2) + 4(N+1) = 40N - 20.\n$$\n\n对于 DIA：\n- 非零对角线的数量等于主对角线、第一行和第一列中存在的不同偏移量的数量。第一行的偏移量为 $\\{0,1,2,\\ldots,N-1\\}$，第一列的偏移量为 $\\{0,-1,-2,\\ldots,-(N-1)\\}$，因此它们的并集是 $\\{-(N-1),\\ldots,0,\\ldots,(N-1)\\}$，得到\n$$\nd = 2N - 1.\n$$\n- `offsets` 数组存储 $d$ 个整数：$4(2N - 1)$ 字节。\n- `values` 数组是一个稠密的 $N \\times d$ 双精度浮点数数组：$8N(2N - 1)$ 字节。\n因此，DIA 的总内存为\n$$\nM_{\\text{DIA}} = 4(2N - 1) + 8N(2N - 1) = (8N + 4)(2N - 1) = 16N^{2} - 4.\n$$\n\n我们寻找最小的整数 $N \\geq 2$，使得 $M_{\\text{CSR}}  M_{\\text{DIA}}$：\n$$\n40N - 20  16N^{2} - 4\n\\;\\;\\Longleftrightarrow\\;\\;\n16N^{2} - 40N + 16 > 0\n\\;\\;\\Longleftrightarrow\\;\\;\n16(N - 2)\\left(N - \\frac{1}{2}\\right) > 0.\n$$\n这个不等式在 $N > 2$ 时成立。当 $N = 2$ 时，两种格式使用相同的内存。因此，使得 CSR 使用的内存严格小于 DIA 的最小整数 $N \\geq 2$ 是 $N = 3$。", "answer": "$$\\boxed{3}$$", "id": "2204576"}, {"introduction": "在实际应用中，我们常常需要分析一个大型系统的特定部分，这在数学上对应于提取子矩阵的操作。本练习模拟了这样一个任务，要求你深入一个以CSR格式存储的矩阵，精确地抽取出指定的行和列。这个过程将锻炼我们高效操作稀疏数据结构所需的关键算法思维。[@problem_id:2204591]", "problem": "在计算科学中，许多涉及大规模模拟的问题，例如分析网络图或求解离散化的偏微分方程，都会产生大型稀疏矩阵。为了节省内存，这些矩阵以专门的格式存储。\n\n考虑一个表示某系统的大型 $8 \\times 8$ 稀疏矩阵 $A$，它以压缩稀疏行 (CSR) 格式存储。CSR 格式使用三个数组来表示该矩阵：\n- `values`：矩阵非零值的列表，逐行读取。\n- `col_indices`：`values` 数组中每个元素对应的列索引的列表。\n- `row_ptr`：一个指针列表，指示 `values` 和 `col_indices` 数组中每行数据的起始位置。此数组的长度比矩阵的行数多一，其最后一个元素是非零元素的总数 (NNZ)。对于第 `i` 行，其非零元素位于 `values` 数组中从索引 `row_ptr[i]` 到 `row_ptr[i+1]`（不包括 `row_ptr[i+1]`）的位置。\n\n具体的矩阵 $A$ 由以下从0开始索引的 CSR 数组给出：\n- `values` = `[10, 15, 20, 22, 30, 35, 40, 48, 51, 50, 57, 62, 60, 75, 70, 81, 80]`\n- `col_indices` = `[0, 4, 1, 3, 2, 5, 3, 7, 0, 4, 6, 2, 5, 4, 6, 1, 7]`\n- `row_ptr` = `[0, 2, 4, 6, 8, 11, 13, 15, 17]`\n\n我们希望分析一个特定的子系统。这对应于从矩阵 $A$ 中提取一个子矩阵 $B$。该子矩阵由原始矩阵的行和列索引的指定列表定义。子矩阵的行和列由以下从0开始索引的列表给出：\n- `sub_rows` = `[1, 4, 5, 7]`\n- `sub_cols` = `[0, 1, 4, 5]`\n\n提取出的子矩阵 $B$ 的构造方式为 $B_{ij} = A_{sub\\_rows[i], sub\\_cols[j]}$。您的任务是生成这个子矩阵 $B$，并将其表示为坐标列表 (COO) 格式。COO 格式使用三个等长的数组：\n- `data`：非零值的列表。\n- `row`：每个非零值对应的行索引的列表。\n- `col`：每个非零值对应的列索引的列表。\n\n用于 $B$ 的 COO 表示的 `row` 和 `col` 数组中的索引必须是相对于新子矩阵的维度（即，行和列的索引范围都是从0到3）。\n\n在确定子矩阵 $B$ 的 COO 表示后，计算其 `data` 数组中所有数值的总和。", "solution": "我们根据以下规则来解释CSR数组：第 $i$ 行的非零条目位于索引 $k$ 处，其中 $k \\in \\{ \\text{row\\_ptr}[i], \\ldots, \\text{row\\_ptr}[i+1]-1 \\}$，其对应的列为 $\\text{col\\_indices}[k]$，值为 $\\text{values}[k]$。\n\n给定 $\\text{row\\_ptr} = [0,2,4,6,8,11,13,15,17]$，$A$ 的各行为：\n- 行 $0$：索引 $k=0,1$，因此 (c,v)=(0,10),(4,15)，所以 $A_{0,0}=10$，$A_{0,4}=15$。\n- 行 $1$：索引 $k=2,3$，因此 (c,v)=(1,20),(3,22)，所以 $A_{1,1}=20$，$A_{1,3}=22$。\n- 行 $2$：索引 $k=4,5$，因此 (c,v)=(2,30),(5,35)，所以 $A_{2,2}=30$，$A_{2,5}=35$。\n- 行 $3$：索引 $k=6,7$，因此 (c,v)=(3,40),(7,48)，所以 $A_{3,3}=40$，$A_{3,7}=48$。\n- 行 $4$：索引 $k=8,9,10$，因此 (c,v)=(0,51),(4,50),(6,57)，所以 $A_{4,0}=51$，$A_{4,4}=50$，$A_{4,6}=57$。\n- 行 $5$：索引 $k=11,12$，因此 (c,v)=(2,62),(5,60)，所以 $A_{5,2}=62$，$A_{5,5}=60$。\n- 行 $6$：索引 $k=13,14$，因此 (c,v)=(4,75),(6,70)，所以 $A_{6,4}=75$，$A_{6,6}=70$。\n- 行 $7$：索引 $k=15,16$，因此 (c,v)=(1,81),(7,80)，所以 $A_{7,1}=81$，$A_{7,7}=80$。\n\n我们提取子矩阵 $B$，其行和列由 $\\text{sub\\_rows}=[1,4,5,7]$ 和 $\\text{sub\\_cols}=[0,1,4,5]$ 给出，其中 $B_{ij}=A_{\\text{sub\\_rows}[i],\\,\\text{sub\\_cols}[j]}$，并将行和列重新索引为 0,1,2,3。\n\n对于 $i=0$（原始行为 $1$），在列 $\\{0,1,4,5\\}$ 中，只有列 $1$ 的值非零，为 $20$，因此 $B_{0,1}=20$。\n对于 $i=1$（原始行为 $4$），在列 $\\{0,1,4,5\\}$ 中，列 $0$ 和列 $4$ 的值非零，分别为 $51$ 和 $50$，映射到新的列索引 $j=0$ 和 $j=2$，因此 $B_{1,0}=51$，$B_{1,2}=50$。\n对于 $i=2$（原始行为 $5$），在列 $\\{0,1,4,5\\}$ 中，只有列 $5$ 的值非零，为 $60$，映射到新的列索引 $j=3$，因此 $B_{2,3}=60$。\n对于 $i=3$（原始行为 $7$），在列 $\\{0,1,4,5\\}$ 中，只有列 $1$ 的值非零，为 $81$，映射到新的列索引 $j=1$，因此 $B_{3,1}=81$。\n\n因此，一个有效的COO表示（按行升序，然后按列升序排列）为：\n$\\text{data}=[20,51,50,60,81]$，$\\text{row}=[0,1,1,2,3]$，$\\text{col}=[1,0,2,3,1]$。\n\n`data` 数组中各项值的总和是\n$$20+51+50+60+81=262.$$", "answer": "$$\\boxed{262}$$", "id": "2204591"}]}