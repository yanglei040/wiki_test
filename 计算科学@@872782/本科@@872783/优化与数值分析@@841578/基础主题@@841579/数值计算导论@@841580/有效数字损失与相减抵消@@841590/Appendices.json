{"hands_on_practices": [{"introduction": "在数值计算中，相近的两个数相减会导致有效数字的灾难性损失，这一现象被称为“相减抵消”（subtractive cancellation）。本练习提供了一个经典的例子：当 $x$ 是一个很大的正数时，计算 $\\ln(x+1) - \\ln(x)$。此时 $\\ln(x+1)$ 和 $\\ln(x)$ 的值非常接近，直接相减会严重损失精度。通过这个练习，你将学会如何利用基本的对数恒等式对表达式进行代数重构，从而将其转化为一个数值稳定的形式，有效规避计算风险。[@problem_id:2186157]", "problem": "在数值计算中，直接以代数形式计算表达式有时会导致灾难性的精度损失。一个经典的例子是函数 $f(x) = \\ln(x+1) - \\ln(x)$，当 $x$ 为非常大的正数时，该函数的计算会存在问题。当 $x$ 很大时，$\\ln(x+1)$ 和 $\\ln(x)$ 的值非常接近，它们的相减（一种称为“相消”的运算）会导致有效数字的大量损失。\n\n为了进行可靠的计算，函数 $f(x)$ 必须首先被转换为一个数学上等价但数值上稳定的形式，以避免这种减法运算。你的任务是分析当 $x$ 很大时，这种稳定形式的行为。\n\n确定当 $x$ 很大时，$f(x)$ 的数值稳定形式的级数展开。具体来说，求出该展开式中以 $x$ 的反幂表示的前三个非零项。将你的答案表示为变量 $z = \\frac{1}{x}$ 的多项式。", "solution": "我们从给定的函数 $f(x) = \\ln(x+1) - \\ln(x)$ 开始。使用对数恒等式 $\\ln(a) - \\ln(b) = \\ln\\!\\left(\\frac{a}{b}\\right)$，我们得到一个数学上等价且数值上稳定的形式：\n$$\nf(x) = \\ln\\!\\left(\\frac{x+1}{x}\\right) = \\ln\\!\\left(1 + \\frac{1}{x}\\right).\n$$\n对于大的正数 $x$，量 $\\frac{1}{x}$ 很小，因此这种形式避免了相消，适合进行稳定的计算。\n\n引入变量 $z = \\frac{1}{x}$。那么\n$$\nf(x) = \\ln(1+z).\n$$\n为了找到 $x$ 很大时（等价于 $z$ 很小时）的级数展开，我们使用 $\\ln(1+z)$ 在 $z=0$ 处的泰勒级数，即\n$$\n\\ln(1+z) = \\sum_{n=1}^{\\infty} \\frac{(-1)^{n+1}}{n} z^{n}, \\quad \\text{对 } |z| < 1 \\text{ 成立}.\n$$\n因此，前三个非零项是\n$$\n\\ln(1+z) = z - \\frac{z^{2}}{2} + \\frac{z^{3}}{3} + \\cdots.\n$$\n表示为 $z = \\frac{1}{x}$ 的多项式，所求的前三个非零项展开为\n$$\nz - \\frac{1}{2} z^{2} + \\frac{1}{3} z^{3}.\n$$", "answer": "$$\\boxed{z - \\frac{1}{2} z^{2} + \\frac{1}{3} z^{3}}$$", "id": "2186157"}, {"introduction": "我们已经知道代数重构可以提高数值稳定性，但误差究竟是如何在计算过程中产生的呢？这个练习将通过模拟一台假设的计算机上的浮点运算，让你亲手量化这种误差。你将比较两种计算 $x^4 - y^4$（其中 $x$ 和 $y$ 非常接近）的方法：一种是直接计算，另一种是使用因式分解后的稳定形式。通过手动追踪有效数字的变化，你将对相减抵消为何会破坏计算精度有一个具体而深刻的理解。[@problem_id:2186152]", "problem": "一位计算科学家正在研究一个系统，其中一个关键的关注量是差值 $D = x^4 - y^4$。输入值 $x$ 和 $y$ 是从高精度实验中获得的正值，并且它们通常彼此非常接近。这位科学家担心，计算 $D$ 的朴素方法可能会因相减抵消而遭受有效数字损失。\n\n所有计算都在一台假设的十进制计算机上执行。该计算机以规格化浮点格式表示数字，该格式存储10位有效数字的尾数。在每次独立的算术运算（加、减、乘或除）之后，结果都会被四舍五入到10位有效数字。舍入规则是四舍五入到最近的值，当出现平局（即数字以5结尾）时，向远离零的方向舍入。\n\n这位科学家决定比较在给定输入值 $x = 1000.00005$ 和 $y = 1000.00004$ 的情况下计算 $D$ 的两种方法。\n\n-   **方法1（朴素方法）：** 首先计算 $X = x^4$ 和 $Y = y^4$，然后求它们的差值 $D_1 = X - Y$。\n-   **方法2（算法稳定方法）：** 使用代数等价公式 $D_2 = (x-y)(x+y)(x^2+y^2)$ 来计算结果。\n\n假设方法2计算出的值 $D_2$ 是真实值的更精确近似，请计算方法1的相对误差，其定义为 $\\frac{|D_2 - D_1|}{|D_2|}$。所有中间和最终计算都必须使用假设计算机的算术规则来执行。\n\n将最终答案表示为一个四舍五入到三位有效数字的实数。", "solution": "我们将算术建模为具有10位有效数字尾数的十进制浮点数，每次运算后都采用“四舍五入到最近，平局向远离零的方向舍入”的规则。写出 $x=1000.00005=1.00000005\\times 10^{3}$ 和 $y=1000.00004=1.00000004\\times 10^{3}$；这些输入是可以精确表示的。\n\n方法1（朴素方法）：通过平方计算 $X=x^{4}$ 和 $Y=y^{4}$，每次乘法后都进行舍入。\n1) 计算 $x^{2}$：\n$$x^{2}=(1.00000005)^{2}\\times 10^{6}=1.0000001000000025\\times 10^{6}\\;\\;\\to\\;\\;1.000000100\\times 10^{6},$$\n所以 $x^{2}_{\\text{fl}}=1000000.100$。\n2) 计算 $y^{2}$：\n$$y^{2}=(1.00000004)^{2}\\times 10^{6}=1.0000000800000016\\times 10^{6}\\;\\;\\to\\;\\;1.000000080\\times 10^{6},$$\n所以 $y^{2}_{\\text{fl}}=1000000.080$。\n3) 平方得到四次方：\n$$x^{4}=(1.000000100)^{2}\\times 10^{12}=1.000000200000001\\times 10^{12}\\;\\;\\to\\;\\;1.000000200\\times 10^{12},$$\n$$y^{4}=(1.000000080)^{2}\\times 10^{12}=1.0000001600000064\\times 10^{12}\\;\\;\\to\\;\\;1.000000160\\times 10^{12}.$$\n因此\n$$D_{1}=X-Y=(1.000000200-1.000000160)\\times 10^{12}=0.000000040\\times 10^{12}=4.000000000\\times 10^{4}.$$\n\n方法2（稳定方法）：计算 $D_{2}=(x-y)(x+y)(x^{2}+y^{2})$，每次运算后都进行舍入。\n1) 差与和：\n$$x-y=0.00001=1.000000000\\times 10^{-5},\\quad x+y=2000.00009=2.000000090\\times 10^{3}.$$\n2) 平方和（使用上面计算得到的舍入后的 $x^{2},y^{2}$）：\n$$x^{2}+y^{2}=(1.000000100+1.000000080)\\times 10^{6}=2.000000180\\times 10^{6}.$$\n3) 第一次乘积：\n$$(x-y)(x+y)=(1.000000000\\times 10^{-5})(2.000000090\\times 10^{3})=2.000000090\\times 10^{-2}\\;(\\text{已经是 }10\\text{ 位有效数字})。$$\n4) 最终乘积：\n$$D_{2}=(2.000000090\\times 10^{-2})(2.000000180\\times 10^{6})=(2.000000090\\cdot 2.000000180)\\times 10^{4}.$$\n尾数的精确乘积是 $4.0000005400000162$，舍入到10位有效数字后为 $4.000000540$，得到\n$$D_{2}=4.000000540\\times 10^{4}=40000.00540.$$\n\n相对误差（以 $D_{2}$ 为参考）在计算机上计算，每次运算后进行舍入：\n1) 差值：\n$$|D_{2}-D_{1}|=|4.000000540\\times 10^{4}-4.000000000\\times 10^{4}|=0.000000540\\times 10^{4}=5.400000000\\times 10^{-3}.$$\n2) 除法：\n$$\\frac{|D_{2}-D_{1}|}{|D_{2}|}=\\frac{5.400000000\\times 10^{-3}}{4.000000540\\times 10^{4}}=\\left(\\frac{5.400000000}{4.000000540}\\right)\\times 10^{-7}.$$\n执行除法并保留10位有效数字，得到\n$$\\frac{5.400000000}{4.000000540}=1.349999818\\;(\\text{舍入到10位有效数字}),$$\n所以相对误差的机器计算结果是\n$$1.349999818\\times 10^{-7}.$$\n\n最后，将此结果四舍五入到三位有效数字（使用所述的舍入规则）得到\n$$1.35\\times 10^{-7}.$$", "answer": "$$\\boxed{1.35 \\times 10^{-7}}$$", "id": "2186152"}, {"introduction": "数值不稳定性不仅限于基础代数运算，它在统计学和科学建模中也频繁出现。本练习探讨了一个在概率论中的常见问题：如何计算一个随机变量在极小区间内的概率。这通常需要计算累积分布函数 (CDF) 在两个非常接近的点上的差值，从而引发相减抵消。你将运用微积分中的一个基本概念——使用导数进行线性近似——来设计一个稳定的计算策略，这展示了如何将数学原理应用于解决实际的计算挑战。[@problem_id:2186161]", "problem": "在一个生产高精度部件的工厂中，一个关键尺寸与其目标值之间的偏差被建模为一个标准正态随机变量 $Z$。质量控制流程要求计算该偏差落入一个微小区间内的概率。令 $\\Phi(z)$ 为标准正态分布的累积分布函数 (CDF)，它给出概率 $P(Z \\leq z)$。我们希望计算概率 $P = \\Phi(x + \\delta) - \\Phi(x)$，其中 $x = 2.0$ 且 $\\delta = 1.0 \\times 10^{-7}$。\n\n您正在一个旧式计算机系统上工作，该系统以9位有效数字的精度执行所有浮点运算。这意味着任何存储的数字或任何中间计算的结果都必须四舍五入到9位有效数字。您从一个标准数学库中获得了以下数值，这些数值本身的精度超过了您系统的精度：\n$$ \\Phi(2.0) = 0.977249868 $$\n$$ \\Phi(2.0000001) = 0.977249873 $$\n\n一位初级工程师通过在旧式系统上直接减去这两个值来计算概率 $P$。一位高级工程师审查了该计算，并建议对于一个非常小的 $\\delta$，可以通过使用近似式 $P \\approx \\delta \\cdot \\phi(x)$ 获得一个数值上稳定得多的结果，其中 $\\phi(x)$ 是标准正态分布的概率密度函数 (PDF)。在 $x=2.0$ 处的PDF值如下：\n$$ \\phi(2.0) = 0.0539909665 $$\n\n您的任务是使用高级工程师建议的近似方法计算概率 $P$ 的值。请按照所描述的旧式系统上会执行的方式进行计算。将您的最终答案以 $a \\times 10^b$ 的科学记数法形式表示，并四舍五入到三位有效数字。", "solution": "我们需要计算 $P=\\Phi(x+\\delta)-\\Phi(x)$，其中 $x=2.0$ 且 $\\delta=1.0\\times 10^{-7}$。对于小的 $\\delta$，使用 $\\Phi$ 在 $x$ 点的一阶泰勒展开：\n$$\n\\Phi(x+\\delta)\\approx \\Phi(x)+\\Phi'(x)\\,\\delta=\\Phi(x)+\\phi(x)\\,\\delta,\n$$\n因此\n$$\nP\\approx \\delta\\,\\phi(x),\n$$\n其中 $\\phi(x)=\\frac{1}{\\sqrt{2\\pi}}\\exp\\!\\left(-\\frac{x^{2}}{2}\\right)$ 是标准正态PDF。\n\n在该旧式系统上，所有存储的数字和中间结果都四舍五入到 $9$ 位有效数字。将输入存储为 $9$ 位有效数字：\n- $\\delta=1.0\\times 10^{-7}\\to 1.00000000\\times 10^{-7}$，\n- $\\phi(2.0)=0.0539909665=5.39909665\\times 10^{-2}$，它本身已经是 $9$ 位有效数字。\n\n使用 $9$ 位有效数字的精度计算乘积：\n$$\nP\\approx (1.00000000\\times 10^{-7})\\,(5.39909665\\times 10^{-2})\n=(1.00000000\\times 5.39909665)\\times 10^{-9}\n=5.39909665\\times 10^{-9},\n$$\n结果已经是 $9$ 位有效数字，因此不需要进一步的内部舍入。\n\n最后，将结果用科学记数法表示并四舍五入到三位有效数字：\n$$\n5.39909665\\times 10^{-9}\\;\\to\\;5.40\\times 10^{-9}.\n$$", "answer": "$$\\boxed{5.40 \\times 10^{-9}}$$", "id": "2186161"}]}