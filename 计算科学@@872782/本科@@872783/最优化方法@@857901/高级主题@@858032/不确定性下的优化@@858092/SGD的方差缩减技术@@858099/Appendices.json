{"hands_on_practices": [{"introduction": "当处理类别不平衡的数据集时，标准的均匀采样可能效率低下，因为它会对所有数据点一视同仁。分层采样提供了一种更智能的替代方案，它根据数据的内在结构（如类别标签）将数据划分为不同层，并优化各层之间的采样率。在这个结合了理论推导和编程实践的练习中 [@problem_id:3197205]，你将设计一个最优的分层采样方案，并亲眼见证它在降低梯度方差方面的强大威力。", "problem": "给定一个标签不平衡的二元分类数据集，要求您在随机梯度下降（SGD）中，分析不同采样方案下随机梯度估计量的方差。请严格遵循经验风险最小化和无偏梯度估计的基本定义，并避免使用任何未从第一性原理推导出的捷径公式。\n\n考虑二元标签的逻辑回归的经验风险，其定义如下。设有 $n$ 个样本 $\\{(x_i,y_i)\\}_{i=1}^n$，其中特征向量为 $x_i \\in \\mathbb{R}^d$，标签为 $y_i \\in \\{0,1\\}$。单个样本的逻辑损失为\n$$\n\\ell(w; x_i, y_i) = \\log\\big(1 + e^{\\langle w, x_i \\rangle}\\big) - y_i \\langle w, x_i \\rangle,\n$$\n经验风险为\n$$\nL(w) = \\frac{1}{n}\\sum_{i=1}^n \\ell(w; x_i, y_i).\n$$\n设 sigmoid 函数为 $\\sigma(z) = \\frac{1}{1 + e^{-z}}$。单样本梯度为\n$$\ng_i(w) = \\nabla_w \\ell(w; x_i, y_i) = \\big(\\sigma(\\langle w, x_i\\rangle) - y_i\\big)\\, x_i,\n$$\n全梯度为\n$$\ng(w) = \\nabla_w L(w) = \\frac{1}{n}\\sum_{i=1}^n g_i(w).\n$$\n\n通过根据概率质量函数 $p_i$ 从 $\\{1,\\dots,n\\}$ 中采样一个索引 $i$ 并返回\n$$\n\\widehat{g}(w) = \\frac{1}{n p_i} g_i(w),\n$$\n可以构建一个单样本无偏随机梯度估计量，根据期望的线性性质，当对所有 $i$ 都有 $p_i  0$ 时，该估计量满足 $\\mathbb{E}[\\widehat{g}(w)] = g(w)$。\n\n您必须为标签不平衡的二元分类数据集设计一个分层采样方案，具体如下：\n- 根据标签将索引划分为两个层：$S_0 = \\{i \\mid y_i = 0\\}$ 和 $S_1 = \\{i \\mid y_i = 1\\}$，其大小为 $n_0 = |S_0|$ 和 $n_1 = |S_1|$，满足 $n_0 + n_1 = n$。\n- 首先以概率 $q_c$ 采样一个层 $c \\in \\{0,1\\}$。\n- 然后，在选定的层 $c$ 中，均匀采样一个索引 $i \\in S_c$。\n- 使用重要性加权估计量 $\\widehat{g}(w)$，其中 $p_i = q_c / n_c$，权重为 $\\frac{1}{n p_i}$ 以保持无偏性。\n\n根据方差的定义，即与均值的期望平方偏差，\n$$\n\\mathrm{Var}(\\widehat{g}(w)) = \\mathbb{E}\\big[\\|\\widehat{g}(w) - g(w)\\|_2^2\\big] = \\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big] - \\|g(w)\\|_2^2,\n$$\n从第一性原理出发，推导在上述分层方案下 $\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big]$ 的显式表达式。然后，仅使用有效的数学推理（例如，Lagrange 乘子和期望的性质），选择层的概率 $q_0$ 和 $q_1$ 以在约束条件 $q_0 + q_1 = 1$ 和 $q_0, q_1  0$ 下最小化方差。不要引入任何未经证明的公式。\n\n实现一个完整的程序，该程序：\n- 构建以下由数据集和参数向量组成的测试套件。\n- 对每个测试用例，计算均匀采样方差（其中 $p_i = 1/n$，估计量为 $\\widehat{g}(w) = g_i(w)$）以及您推导的分层方案下的方差。\n- 对每个测试用例，输出一个浮点数，其值为分层方差与均匀方差的比率。\n- 如果某个测试用例的均匀方差为零，则该用例的比率定义为 $1.0$。\n- 打印一行包含结果的、用方括号括起来的逗号分隔列表（例如，“[$r_1$,$r_2$,$r_3$]”），其中每个浮点数四舍五入到六位小数。\n\n使用以下测试套件。每个测试用例都明确指定了 $(X,y,w)$。\n\n- 测试用例 1（中度不平衡）：\n  - $n = 8$, $d = 2$。\n  - 正标签索引 $S_1 = \\{1,2,3\\}$，其中 $y_1 = 1$，$y_2 = 1$，$y_3 = 1$，特征向量为\n    $x_1 = [\\,2.0,\\,0.0\\,]$，$x_2 = [\\,1.5,\\,-0.5\\,]$，$x_3 = [\\,1.0,\\,0.5\\,]$。\n  - 负标签索引 $S_0 = \\{4,5,6,7,8\\}$，其中 $y_4 = 0$，$y_5 = 0$，$y_6 = 0$，$y_7 = 0$，$y_8 = 0$，特征向量为\n    $x_4 = [\\,-1.0,\\,0.5\\,]$，$x_5 = [\\,-2.0,\\,1.0\\,]$，$x_6 = [\\,-1.5,\\,-0.5\\,]$，$x_7 = [\\,-0.5,\\,0.2\\,]$，$x_8 = [\\,-1.0,\\,-1.0\\,]$。\n  - 参数向量 $w = [\\,0.2,\\,-0.3\\,]$。\n\n- 测试用例 2（极端不平衡）：\n  - $n = 10$, $d = 2$。\n  - 正标签索引 $S_1 = \\{10\\}$，其中 $y_{10} = 1$，特征向量为 $x_{10} = [\\,3.0,\\,3.0\\,]$。\n  - 负标签索引 $S_0 = \\{1,2,3,4,5,6,7,8,9\\}$，其中对 $i \\in S_0$ 有 $y_i = 0$，特征向量为\n    $x_1 = [\\,-0.1,\\,0.2\\,]$，$x_2 = [\\,-0.2,\\,0.1\\,]$，$x_3 = [\\,-0.3,\\,-0.1\\,]$，$x_4 = [\\,-0.1,\\,-0.2\\,]$，$x_5 = [\\,-0.2,\\,-0.2\\,]$，$x_6 = [\\,-0.05,\\,0.05\\,]$，$x_7 = [\\,-0.15,\\,0.0\\,]$，$x_8 = [\\,-0.1,\\,0.0\\,]$，$x_9 = [\\,-0.25,\\,0.1\\,]$。\n  - 参数向量 $w = [\\,0.1,\\,0.1\\,]$。\n\n- 测试用例 3（平衡且对称）：\n  - $n = 4$, $d = 2$。\n  - 负标签索引 $S_0 = \\{1,2\\}$，其中 $y_1 = 0$，$y_2 = 0$，特征向量为 $x_1 = [\\,1.0,\\,0.0\\,]$，$x_2 = [\\,0.0,\\,1.0\\,]$。\n  - 正标签索引 $S_1 = \\{3,4\\}$，其中 $y_3 = 1$，$y_4 = 1$，特征向量为 $x_3 = [\\,-1.0,\\,0.0\\,]$，$x_4 = [\\,0.0,\\,-1.0\\,]$。\n  - 参数向量 $w = [\\,0.0,\\,0.0\\,]$。\n\n- 测试用例 4（退化的零梯度情况）：\n  - $n = 6$, $d = 2$。\n  - 对所有 $i \\in \\{1,2,3,4,5,6\\}$，特征向量为 $x_i = [\\,0.0,\\,0.0\\,]$。\n  - 标签 $y = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,0\\,]$。\n  - 参数向量 $w = [\\,1.0,\\,-1.0\\,]$。\n\n角度单位和物理单位不适用。您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，每个浮点数四舍五入到六位小数，例如，“[0.732145,0.512340,1.000000,1.000000]”。", "solution": "该问题要求为随机梯度下降（SGD）中的方差减小推导一个最优的分层采样方案，并针对特定测试用例与均匀采样进行比较。解决方案分为两部分：首先，从第一性原理进行形式化推导；其次，实现推导出的公式以计算所需的方差比率。\n\n### 第 1 部分：最优分层采样方案的推导\n\n单样本随机梯度估计量 $\\widehat{g}(w)$ 的方差由下式给出：\n$$\n\\mathrm{Var}(\\widehat{g}(w)) = \\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big] - \\|g(w)\\|_2^2\n$$\n由于 $\\|g(w)\\|_2^2$ 相对于采样过程是一个常数，因此最小化方差等价于最小化估计量的期望 L2 范数平方，即 $\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big]$。\n\n**1. 分层采样下 $\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big]$ 的表达式**\n\n分层采样方案定义为一个两阶段过程：\n1.  以概率 $q_c$ 选择一个层 $c \\in \\{0, 1\\}$。\n2.  从所选的层 $S_c$ 中均匀采样一个索引 $i$。\n\n采样特定索引 $i \\in S_c$ 的概率是选择层 $c$ 的概率与在 $S_c$ 内选择 $i$ 的概率的乘积：\n$$\np_i = P(\\text{采样 } i) = P(\\text{采样 } i \\mid \\text{选择 } S_c) P(\\text{选择 } S_c) = \\frac{1}{|S_c|} \\cdot q_c = \\frac{q_c}{n_c}\n$$\n对于采样索引 $i$，无偏随机梯度估计量为：\n$$\n\\widehat{g}(w) = \\frac{1}{n p_i} g_i(w) = \\frac{n_c}{n q_c} g_i(w), \\quad \\text{对于 } i \\in S_c\n$$\n期望 $\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big]$ 是对这个两阶段采样过程求得的。我们可以使用全期望定律，以所选的层 $c$ 为条件进行计算：\n$$\n\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big] = \\sum_{c \\in \\{0,1\\}} P(\\text{层 } c \\text{ 被选择}) \\cdot \\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2 \\mid \\text{层 } c \\text{ 被选择}\\big]\n$$\n$$\n\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big] = q_0 \\cdot \\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2 \\mid c=0\\big] + q_1 \\cdot \\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2 \\mid c=1\\big]\n$$\n给定选择的层为 $c$，索引 $i$ 从 $S_c$ 中均匀采样。估计量为 $\\widehat{g}(w) = \\frac{n_c}{n q_c} g_i(w)$。条件期望为：\n$$\n\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2 \\mid c\\big] = \\mathbb{E}_{i \\sim \\text{Unif}(S_c)}\\left[\\left\\|\\frac{n_c}{n q_c} g_i(w)\\right\\|_2^2\\right] = \\left(\\frac{n_c}{n q_c}\\right)^2 \\mathbb{E}_{i \\sim \\text{Unif}(S_c)}\\left[\\|g_i(w)\\|_2^2\\right]\n$$\n对来自 $S_c$ 的均匀样本求期望，就是对 $S_c$ 中所有元素的平均值：\n$$\n\\mathbb{E}_{i \\sim \\text{Unif}(S_c)}\\left[\\|g_i(w)\\|_2^2\\right] = \\frac{1}{n_c} \\sum_{i \\in S_c} \\|g_i(w)\\|_2^2\n$$\n将其代回，我们得到：\n$$\n\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2 \\mid c\\big] = \\left(\\frac{n_c}{n q_c}\\right)^2 \\left(\\frac{1}{n_c} \\sum_{i \\in S_c} \\|g_i(w)\\|_2^2\\right) = \\frac{n_c}{n^2 q_c^2} \\sum_{i \\in S_c} \\|g_i(w)\\|_2^2\n$$\n我们定义 $V_c = \\sum_{i \\in S_c} \\|g_i(w)\\|_2^2$ 为层 $c$ 内梯度的 L2 范数平方和。条件期望变为 $\\frac{n_c V_c}{n^2 q_c^2}$。\n\n将其代入全期望定律公式，得到：\n$$\n\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big] = q_0 \\left(\\frac{n_0 V_0}{n^2 q_0^2}\\right) + q_1 \\left(\\frac{n_1 V_1}{n^2 q_1^2}\\right) = \\frac{1}{n^2} \\left( \\frac{n_0 V_0}{q_0} + \\frac{n_1 V_1}{q_1} \\right)\n$$\n这就是估计量期望范数平方的显式表达式。\n\n**2. 最小化方差**\n\n我们需要在约束条件 $q_0 + q_1 = 1$ 和 $q_0, q_1  0$ 下最小化 $f(q_0, q_1) = \\frac{n_0 V_0}{q_0} + \\frac{n_1 V_1}{q_1}$。\n代入 $q_1 = 1 - q_0$，得到一个单变量函数 $q_0 \\in (0,1)$：\n$$\nh(q_0) = \\frac{n_0 V_0}{q_0} + \\frac{n_1 V_1}{1 - q_0}\n$$\n为了找到最小值，我们对 $q_0$ 求导并令其为零。如果 $V_0  0$ 且 $V_1  0$，这是有效的，可以确保临界点在 $(0, 1)$ 区间内。\n$$\n\\frac{dh}{dq_0} = -\\frac{n_0 V_0}{q_0^2} + \\frac{n_1 V_1}{(1 - q_0)^2} = 0\n$$\n$$\n\\frac{n_1 V_1}{(1 - q_0)^2} = \\frac{n_0 V_0}{q_0^2} \\implies \\frac{q_0^2}{(1 - q_0)^2} = \\frac{n_0 V_0}{n_1 V_1}\n$$\n对两边取平方根（并且由于 $q_0, 1-q_0  0$）：\n$$\n\\frac{q_0}{1 - q_0} = \\frac{\\sqrt{n_0 V_0}}{\\sqrt{n_1 V_1}}\n$$\n求解 $q_0$：\n$$\nq_0 \\sqrt{n_1 V_1} = (1 - q_0)\\sqrt{n_0 V_0} = \\sqrt{n_0 V_0} - q_0 \\sqrt{n_0 V_0}\n$$\n$$\nq_0 (\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1}) = \\sqrt{n_0 V_0}\n$$\n最优的层概率为：\n$$\nq_0^* = \\frac{\\sqrt{n_0 V_0}}{\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1}} \\quad \\text{和} \\quad q_1^* = \\frac{\\sqrt{n_1 V_1}}{\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1}}\n$$\n\n**3. 最小期望范数平方和方差**\n\n将这些最优概率代回到 $\\mathbb{E}\\big[\\|\\widehat{g}(w)\\|_2^2\\big]$ 的表达式中：\n$$\n\\mathbb{E}_{\\text{strat}}^*[\\|\\widehat{g}(w)\\|_2^2] = \\frac{1}{n^2} \\left( \\frac{n_0 V_0}{q_0^*} + \\frac{n_1 V_1}{q_1^*} \\right)\n$$\n第一项是 $\\frac{n_0 V_0}{q_0^*} = n_0 V_0 \\cdot \\frac{\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1}}{\\sqrt{n_0 V_0}} = \\sqrt{n_0 V_0} (\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1})$。\n第二项是 $\\frac{n_1 V_1}{q_1^*} = n_1 V_1 \\cdot \\frac{\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1}}{\\sqrt{n_1 V_1}} = \\sqrt{n_1 V_1} (\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1})$。\n将它们相加得到 $(\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1})^2$。因此，最小期望范数平方为：\n$$\n\\mathbb{E}_{\\text{strat}}^*[\\|\\widehat{g}(w)\\|_2^2] = \\frac{1}{n^2} (\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1})^2\n$$\n最优分层采样下的最小化方差为：\n$$\n\\mathrm{Var}_{\\text{strat}}(\\widehat{g}(w)) = \\frac{1}{n^2} (\\sqrt{n_0 V_0} + \\sqrt{n_1 V_1})^2 - \\|g(w)\\|_2^2\n$$\n如果 $V_0=V_1=0$，所有梯度都为零，该方差也为零。\n\n**4. 与均匀采样的比较**\n\n对于均匀采样，对所有 $i$ 都有 $p_i = 1/n$。估计量简化为 $\\widehat{g}_{\\text{unif}}(w) = g_i(w)$。期望范数平方为：\n$$\n\\mathbb{E}_{\\text{unif}}[\\|\\widehat{g}(w)\\|_2^2] = \\mathbb{E}_{i \\sim \\text{Unif}}\\left[\\|g_i(w)\\|_2^2\\right] = \\frac{1}{n} \\sum_{i=1}^n \\|g_i(w)\\|_2^2 = \\frac{1}{n} (V_0 + V_1)\n$$\n均匀采样下的方差为：\n$$\n\\mathrm{Var}_{\\text{unif}}(\\widehat{g}(w)) = \\frac{1}{n} (V_0 + V_1) - \\|g(w)\\|_2^2\n$$\n\n所要求的比率为 $\\mathrm{Var}_{\\text{strat}} / \\mathrm{Var}_{\\text{unif}}$。\n\n### 第 2 部分：测试用例的实现\n\n以下 Python 代码实现了这些推导出的公式，用于计算每个测试用例的方差比率。该逻辑计算单样本梯度、各层范数平方和（$V_0, V_1$）、全梯度范数，并最终计算两种方差以求得它们的比率。特殊情况，如均匀方差为零，会按照规定进行处理。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the variance reduction problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        # Test case 1: Moderate imbalance\n        {\n            \"X\": np.array([\n                [2.0, 0.0], [1.5, -0.5], [1.0, 0.5],  # y=1\n                [-1.0, 0.5], [-2.0, 1.0], [-1.5, -0.5], [-0.5, 0.2], [-1.0, -1.0]  # y=0\n            ]),\n            \"y\": np.array([1, 1, 1, 0, 0, 0, 0, 0]),\n            \"w\": np.array([0.2, -0.3])\n        },\n        # Test case 2: Extreme imbalance\n        {\n            \"X\": np.array([\n                [-0.1, 0.2], [-0.2, 0.1], [-0.3, -0.1], [-0.1, -0.2], [-0.2, -0.2],\n                [-0.05, 0.05], [-0.15, 0.0], [-0.1, 0.0], [-0.25, 0.1], # y=0\n                [3.0, 3.0] # y=1\n            ]),\n            \"y\": np.array([0, 0, 0, 0, 0, 0, 0, 0, 0, 1]),\n            \"w\": np.array([0.1, 0.1])\n        },\n        # Test case 3: Balanced and symmetric\n        {\n            \"X\": np.array([\n                [1.0, 0.0], [0.0, 1.0],  # y=0\n                [-1.0, 0.0], [0.0, -1.0] # y=1\n            ]),\n            \"y\": np.array([0, 0, 1, 1]),\n            \"w\": np.array([0.0, 0.0])\n        },\n        # Test case 4: Degenerate zero-gradient case\n        {\n            \"X\": np.array([\n                [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], \n                [0.0, 0.0], [0.0, 0.0], [0.0, 0.0]\n            ]),\n            \"y\": np.array([0, 0, 0, 1, 1, 0]),\n            \"w\": np.array([1.0, -1.0])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        X, y, w = case[\"X\"], case[\"y\"], case[\"w\"]\n        \n        n, d = X.shape\n\n        # Sigmoid function\n        def sigmoid(z):\n            return 1.0 / (1.0 + np.exp(-z))\n\n        # 1. Compute per-sample gradients g_i(w)\n        w_dot_x = X @ w\n        sigmas = sigmoid(w_dot_x)\n        # Reshape for broadcasting: (n,) - (n, 1) to multiply with X (n, d)\n        coeff = (sigmas - y)[:, np.newaxis]\n        per_sample_grads = coeff * X\n\n        # 2. Compute full gradient g(w) and its squared norm\n        full_grad = np.mean(per_sample_grads, axis=0)\n        full_grad_norm_sq = np.dot(full_grad, full_grad)\n\n        # 3. Compute sum of squared L2-norms of gradients per stratum (V_0, V_1)\n        per_sample_grad_norms_sq = np.sum(per_sample_grads**2, axis=1)\n        \n        indices_S0 = np.where(y == 0)[0]\n        indices_S1 = np.where(y == 1)[0]\n        \n        n0 = len(indices_S0)\n        n1 = len(indices_S1)\n\n        V0 = np.sum(per_sample_grad_norms_sq[indices_S0])\n        V1 = np.sum(per_sample_grad_norms_sq[indices_S1])\n\n        # 4. Compute variance for uniform sampling\n        # E[||g_hat||^2] for uniform sampling\n        E_unif_norm_sq = np.sum(per_sample_grad_norms_sq) / n\n        var_unif = E_unif_norm_sq - full_grad_norm_sq\n\n        # Handle the case where uniform variance is zero\n        if np.isclose(var_unif, 0.0):\n            results.append(1.0)\n            continue\n\n        # 5. Compute variance for optimal stratified sampling\n        # E[||g_hat||^2] for stratified sampling\n        # This formula is numerically stable even if V0 or V1 is 0\n        term_0 = np.sqrt(n0 * V0) if n0  0 else 0.0\n        term_1 = np.sqrt(n1 * V1) if n1  0 else 0.0\n        \n        E_strat_norm_sq = (term_0 + term_1)**2 / n**2\n        var_strat = E_strat_norm_sq - full_grad_norm_sq\n        \n        # 6. Compute and store the ratio\n        ratio = var_strat / var_unif\n        results.append(ratio)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3197205"}, {"introduction": "控制变量法是方差缩减的通用框架，但其成功与否依赖于一个关键假设：我们用于构建控制变量的辅助模型是有效的。本练习 [@problem_id:3197169] 探讨了一个警示性的场景，即一个错误指定的控制变量不仅无法降低方差，反而会使其增加。你的任务是分析这种情况发生的原因，并从数学上推导出一个“安全”边界，以确保方差缩减技术不会事与愿违。", "problem": "考虑随机梯度下降（SGD）在某个固定迭代点上的一个标量随机梯度分量，该分量被建模为随机变量 $G$。假设 $G$ 对于真实的梯度分量是无偏的，因此 $\\mathbb{E}[G]$ 等于该迭代点上的真实梯度分量。一种方差缩减（VR）技术使用一个控制变量 $M$，该变量由梯度的预测模型构建，并形成调整后的估计量 $\\tilde{G}(c) = G - c M$。假设控制变量 $M$ 是零均值的，即 $\\mathbb{E}[M] = 0$，这确保了对于任何标量系数 $c \\in \\mathbb{R}$，$\\tilde{G}(c)$ 都保持无偏。已知二阶统计量如下：\n$$\n\\operatorname{Var}(G) = 4,\\quad \\operatorname{Var}(M) = 9,\\quad \\operatorname{Cov}(G,M) = \\rho\\,\\sigma_G\\,\\sigma_M,\n$$\n其中 $\\rho = -0.2$，$\\sigma_G = 2$，$\\sigma_M = 3$。一位实践者使用了一个针对 $M$ 的错误指定的预测模型，并将系数设置为 $c_0 = -1$。\n\n从方差 $\\operatorname{Var}(X) = \\mathbb{E}\\!\\left[(X - \\mathbb{E}[X])^2\\right]$ 和协方差 $\\operatorname{Cov}(X,Y) = \\mathbb{E}\\!\\left[(X - \\mathbb{E}[X])(Y - \\mathbb{E}[Y])\\right]$ 的基本定义，以及随机变量线性组合的熟知恒等式出发，分析使用一个可能错误的控制变量对 $\\tilde{G}(c)$ 方差的影响：\n\n- 推导用 $\\operatorname{Var}(G)$、$\\operatorname{Var}(M)$ 和 $\\operatorname{Cov}(G,M)$ 表示 $\\operatorname{Var}(\\tilde{G}(c))$ 的表达式，并使用给定的数值计算方差比 $R = \\operatorname{Var}(\\tilde{G}(c_0))/\\operatorname{Var}(G)$。\n\n- 确定使方差不增加（即 $\\operatorname{Var}(\\tilde{G}(c)) \\le \\operatorname{Var}(G)$）的系数 $c$ 的集合，并提出一种将任何提议的系数裁剪到该集合以防止方差增加的安全措施。通过将 $c_0$ 投影到你所确定的集合上，计算出安全系数 $c_{\\mathrm{safe}}$。\n\n将所有数值结果四舍五入到 $4$ 位有效数字。将你的最终答案表示为 $R$ 和 $c_{\\mathrm{safe}}$ 这两个数。", "solution": "问题陈述经评估有效，因为它在科学上基于概率论和优化方法，问题设定良好，目标明确且信息充分，并使用了精确、客观的语言。不存在矛盾、数据缺失或违反科学原理的情况。\n\n按要求，分析分两部分进行。\n\n首先，我们推导调整后估计量 $\\tilde{G}(c) = G - cM$ 的方差表达式，并计算方差比 $R$。估计量 $\\tilde{G}(c)$ 是无偏的，因为控制变量 $M$ 是零均值的：\n$$\n\\mathbb{E}[\\tilde{G}(c)] = \\mathbb{E}[G - cM] = \\mathbb{E}[G] - c\\mathbb{E}[M] = \\mathbb{E}[G] - c(0) = \\mathbb{E}[G]\n$$\n两个随机变量 $X$ 和 $Y$ 的线性组合的方差由以下恒等式给出：\n$$\n\\operatorname{Var}(aX + bY) = a^2\\operatorname{Var}(X) + b^2\\operatorname{Var}(Y) + 2ab\\operatorname{Cov}(X,Y)\n$$\n将此恒等式应用于 $\\tilde{G}(c) = G - cM$，我们确定 $a=1$，$X=G$，$b=-c$ 和 $Y=M$。因此，$\\tilde{G}(c)$ 的方差为：\n$$\n\\operatorname{Var}(\\tilde{G}(c)) = \\operatorname{Var}(G - cM) = (1)^2\\operatorname{Var}(G) + (-c)^2\\operatorname{Var}(M) + 2(1)(-c)\\operatorname{Cov}(G,M)\n$$\n$$\n\\operatorname{Var}(\\tilde{G}(c)) = \\operatorname{Var}(G) + c^2\\operatorname{Var}(M) - 2c\\operatorname{Cov}(G,M)\n$$\n这是控制变量估计量方差的一般表达式。\n\n接下来，我们代入给定的数值。方差为 $\\operatorname{Var}(G) = 4$ 和 $\\operatorname{Var}(M) = 9$。协方差由给定的相关系数 $\\rho = -0.2$ 和标准差 $\\sigma_G = \\sqrt{\\operatorname{Var}(G)} = 2$ 及 $\\sigma_M = \\sqrt{\\operatorname{Var}(M)} = 3$ 计算得出：\n$$\n\\operatorname{Cov}(G,M) = \\rho\\,\\sigma_G\\,\\sigma_M = (-0.2)(2)(3) = -1.2\n$$\n将这些值代入方差表达式中：\n$$\n\\operatorname{Var}(\\tilde{G}(c)) = 4 + c^2(9) - 2c(-1.2) = 9c^2 + 2.4c + 4\n$$\n实践者使用了错误指定的系数 $c_0 = -1$。对于这个选择，方差为：\n$$\n\\operatorname{Var}(\\tilde{G}(c_0 = -1)) = 9(-1)^2 + 2.4(-1) + 4 = 9 - 2.4 + 4 = 10.6\n$$\n方差比 $R$ 是这个新方差与 $G$ 的原始方差之比：\n$$\nR = \\frac{\\operatorname{Var}(\\tilde{G}(c_0))}{\\operatorname{Var}(G)} = \\frac{10.6}{4} = 2.65\n$$\n四舍五入到 $4$ 位有效数字，我们得到 $R = 2.650$。这表明实践者选择的 $c_0=-1$ 使方差增加了一倍以上，这适得其反。\n\n其次，我们确定使方差不增加的系数 $c$ 的集合。这个条件表示为 $\\operatorname{Var}(\\tilde{G}(c)) \\le \\operatorname{Var}(G)$。\n$$\n\\operatorname{Var}(G) + c^2\\operatorname{Var}(M) - 2c\\operatorname{Cov}(G,M) \\le \\operatorname{Var}(G)\n$$\n从两边减去 $\\operatorname{Var}(G)$ 得到关于 $c$ 的二次不等式：\n$$\nc^2\\operatorname{Var}(M) - 2c\\operatorname{Cov}(G,M) \\le 0\n$$\n$$\nc(c\\operatorname{Var}(M) - 2\\operatorname{Cov}(G,M)) \\le 0\n$$\n代入数值 $\\operatorname{Var}(M) = 9$ 和 $\\operatorname{Cov}(G,M) = -1.2$：\n$$\nc(9c - 2(-1.2)) \\le 0 \\implies c(9c + 2.4) \\le 0\n$$\n二次函数 $f(c) = c(9c + 2.4)$ 是一个开口向上的抛物线。它在两根之间的值小于或等于零。根是 $c=0$ 和 $9c + 2.4 = 0 \\implies c = -2.4/9 = -4/15$。因此，使方差不增加的系数集合是闭区间：\n$$\nc \\in \\left[-\\frac{4}{15}, 0\\right]\n$$\n提议的安全措施是将任何建议的系数裁剪到这个集合中。这等价于在区间 $[-\\frac{4}{15}, 0]$ 中找到离建议系数 $c_0 = -1$ 最近的点。这个操作是 $c_0$ 在该区间上的投影。\n$$\nc_{\\mathrm{safe}} = \\operatorname{proj}_{[-\\frac{4}{15}, 0]}(c_0) = \\max\\left(-\\frac{4}{15}, \\min(0, c_0)\\right)\n$$\n代入 $c_0 = -1$：\n$$\nc_{\\mathrm{safe}} = \\max\\left(-\\frac{4}{15}, \\min(0, -1)\\right) = \\max\\left(-\\frac{4}{15}, -1\\right)\n$$\n由于 $-4/15 \\approx -0.2667$，大于 $-1$，所以最大值为 $-4/15$。\n$$\nc_{\\mathrm{safe}} = -\\frac{4}{15}\n$$\n四舍五入到 $4$ 位有效数字，得到 $c_{\\mathrm{safe}} \\approx -0.2667$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.650  -0.2667\n\\end{pmatrix}\n}\n$$", "id": "3197169"}]}