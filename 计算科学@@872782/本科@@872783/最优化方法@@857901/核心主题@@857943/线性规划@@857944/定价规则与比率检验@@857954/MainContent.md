## 引言
作为求解线性规划问题的基石，单纯形法通过在[可行域的顶点](@entry_id:174284)之间进行迭代来系统地寻找最优解。然而，每次迭代都面临两个根本性问题：我们应该选择哪个方向（即哪个变量）进行移动以获得最大收益？以及我们可以在这个方向上走多远而不离开可行区域？这两个问题分别由**定价规则 (Pricing Rules)** 和 **比例检验 (Ratio Tests)** 来回答，它们共同构成了单纯形算法的引擎。本文将深入剖析这两个核心机制。

在“**原理与机制**”章节中，我们将从第一性原理出发，推导定价和比例检验的数学公式，并探讨退化和对偶方法等特殊情况。接着，在“**应用与跨学科联系**”章节，我们将展示这些理论如何在运筹学、经济学和高级分解算法中发挥作用。最后，通过“**动手实践**”部分，您将有机会运用所学知识解决具体问题，从而巩固理解。

## 原理与机制

在[线性规划](@entry_id:138188)的单纯形法中，核心操作是从[可行域](@entry_id:136622)的一个顶点移动到另一个相邻的、目标函数值更优的顶点。这一操作被称为**主元迭代 (pivot)**。每次迭代都精确地涉及将一个当前不在基中的变量（**非基变量**）引入基，并同时从基中移除一个变量（**基变量**），以形成一个新的基。这个过程引发了两个必须回答的基本问题：

1.  **定价问题 (Pricing Problem)**：应该选择哪个非基变量进入基，才能最有效地改善[目标函数](@entry_id:267263)？
2.  **比例检验问题 (Ratio Test Problem)**：当选定的非基变量进入基时，为了维持解的可行性，应该选择哪个基变量离开基？

本章将深入探讨回答这两个问题的原理和机制，它们共同构成了单纯形算法的基石。

### 定价：选择入基变量

定价过程旨在识别一个有潜力改善目标函数值的非基变量。其核心工具是**判别数 (reduced cost)**。

#### 判别数的作用与[最优性检验](@entry_id:164180)

对于一个线性规划问题，其[目标函数](@entry_id:267263)可以完全用非基变量来表达。对于一个给定的基[可行解](@entry_id:634783)，目标函数 $z$ 可以写为：
$$
z = z_0 + \sum_{j \in N} \bar{c}_j x_j
$$
其中，$N$ 是非基变量的索引集合，$z_0$ 是当前基[可行解](@entry_id:634783)的[目标函数](@entry_id:267263)值，$x_j$ 是非基变量，而 $\bar{c}_j$ 就是非基变量 $x_j$ 的判别数。

这个表达式清晰地揭示了判别数的含义：$\bar{c}_j$ 表示在保持其他非基变量为零的情况下，非基变量 $x_j$ 每增加一个单位，[目标函数](@entry_id:267263)值 $z$ 的变化率。

因此，判别数直接指导我们如何选择入基变量：
-   对于**最大化问题**，我们寻找具有**正判别数** ($\bar{c}_j > 0$) 的非基变量，因为增加它的值会使[目标函数](@entry_id:267263)增大。
-   对于**最小化问题**，我们寻找具有**负判别数** ($\bar{c}_j  0$) 的非基变量，因为增加它的值会使[目标函数](@entry_id:267263)减小。

这个关系也引出了单纯形法的**[最优性检验](@entry_id:164180)条件 (optimality condition)**：
-   在一个最大化问题中，如果所有非基变量的判别数都小于或等于零 ($\bar{c}_j \le 0, \forall j \in N$)，则当前解是最优的。
-   在一个最小化问题中，如果所有非基变量的判别数都大于或等于零 ($\bar{c}_j \ge 0, \forall j \in N$)，则当前解是最优的。

这是因为，如果该条件满足，任何对非基变量的非负调整（增加其值）都无法进一步改善目标函数值。例如，在一个最小化问题中，如果所有 $\bar{c}_j \ge 0$，且可行性要求所有 $x_j \ge 0$，那么 $z = z_0 + \sum \bar{c}_j x_j$ 将始终大于或等于 $z_0$。因此，$z_0$ 必定是最小值 [@problem_id:3164072]。

#### 判别数的计算

为了计算判别数，我们引入**[对偶变量](@entry_id:143282) (dual variables)**，也称为**单纯形乘子 (simplex multipliers)** 或 **影子价格 (shadow prices)**，记为向量 $y$。其定义为 $y^T = c_B^T B^{-1}$，其中 $B$ 是当前的基矩阵，$c_B$ 是基变量对应的成本系数向量。影子价格 $y_i$ 在经济学上解释为第 $i$ 个资源约束的边际价值。

利用对偶变量，非基变量 $x_j$ 的判别数可以通过以下公式计算：
$$
\bar{c}_j = c_j - y^T A_j
$$
其中 $c_j$ 是 $x_j$ 的原始成本系数，$A_j$ 是其在约束矩阵 $A$ 中的对应列。这个公式极具启发性：一个变量的“净”边际贡献 ($\bar{c}_j$) 等于其“毛”贡献 ($c_j$) 减去它所消耗资源的“估算”总成本 ($y^T A_j$)。

在一个典型的初始设置中，[松弛变量](@entry_id:268374)构成了初始基。此时，基矩阵 $B$ 是[单位矩阵](@entry_id:156724) $I$，基变量的成本 $c_B$ 通常为零。这使得初始的[对偶变量](@entry_id:143282) $y=0$，进而导致初始判别数就是其原始成本系数，即 $\bar{c}_j = c_j$ [@problem_id:3164034] [@problem_id:3164122]。

#### 定价规则

选择哪个具有“有利”判别数的非基变量作为入基变量，存在多种策略，即**定价规则 (pricing rules)**。

**Dantzig 规则 (最陡边规则)**：这是最经典和最常用的规则。它选择具有最有利判别数的变量，即对于最大化问题选择 $\bar{c}_j$ 最大的变量，对于最小化问题选择 $\bar{c}_j$ 最小（最负）的变量 [@problem_id:3164063]。这个规则是贪婪的，因为它选择了目标函数瞬时改进率最大的方向。

**对 Dantzig 规则的评判**：然而，最陡的下降（或上升）率并不保证在单次迭代中获得最大的总改进量。总改进量 $\Delta z$ 取决于判别数和可行的步长 $\theta$ 的乘积：$\Delta z = \bar{c}_j \theta$。一个判别数不那么“有利”的变量，如果其允许的步长 $\theta$ 远大于 Dantzig 规则选出的变量，那么它可能在一次迭代中带来更大的实际改进。在某些情况下，遵循 Dantzig 规则可能导致总改进量非常小，而选择另一个候选变量反而效果更佳 [@problem_id:3164152]。

**高级定价规则**：为了克服 Dantzig 规则的短视性，研究人员提出了更复杂的规则。
- **最大改进规则 (Greatest Improvement Rule)**：此规则对每个候选入基变量，预先计算其可能的最大步长 $\theta_j$ 和总改进 $\Delta z_j = \bar{c}_j \theta_j$，然[后选择](@entry_id:154665)能带来最大 $\Delta z_j$ 的变量。此方法计算成本更高，因为它需要在定价阶段执行多次比例检验的计算。
- **规范化定价 (Normalized Pricing)**：此规则试图通过对“步长”进行规范化来更公平地比较不同方向的“陡峭”程度。一个常用的方法是根据解向量在基变量空间中移动的欧氏距离来规范化[目标函数](@entry_id:267263)的变化率。该指标为 $-\bar{c}_j / \|B^{-1}A_j\|_2$。选择使该比率最大化的变量，可以看作是选择在几何上最“有效”的下降方向 [@problem_id:3164043]。

### 比例检验：选择出基变量

一旦通过定价选定了入基变量 $x_j$，我们就需要确定它能增加到多大（即步长 $\theta$），同时不违反任何非负约束。这个过程就是**比例检验 (ratio test)**，它同时也会确定哪个基变量将被“挤出”基，变为零。

#### 从第一性原理推导

比例检验的核心是**保持可行性 (maintaining feasibility)**。假设我们让入基变量 $x_j$ 从 0 增加到 $\theta$，而其他非基变量保持为 0。基变量的值 $x_B$ 将如何变化？从约束方程 $Ax=b$ 或 $Bx_B + Nx_N = b$ 出发，我们可以得到：
$$
x_B = B^{-1}b - B^{-1}Nx_N
$$
当只有 $x_j$ 变为 $\theta$ 时，新的基变量向量 $x_B(\theta)$ 为：
$$
x_B(\theta) = x_B^{\text{current}} - \theta (B^{-1}A_j)
$$
其中 $x_B^{\text{current}} = B^{-1}b$ 是当前基变量的值。令 $p_j = B^{-1}A_j$ 为单纯形表中的**[主元列](@entry_id:148772) (pivot column)**。可行性要求 $x_B(\theta) \ge 0$，即其每个分量 $(x_B(\theta))_i \ge 0$。这给我们带来一系列关于 $\theta$ 的不等式：
$$
(x_B^{\text{current}})_i - \theta (p_j)_i \ge 0
$$
对于那些 $(p_j)_i \le 0$ 的分量，当 $\theta \ge 0$ 时，这个不等式自然成立，意味着增加 $x_j$ 不会减少这些基变量的值，因此它们不会限制步长。但对于那些 $(p_j)_i > 0$ 的分量，我们必须满足：
$$
\theta \le \frac{(x_B^{\text{current}})_i}{(p_j)_i}
$$
为了同时满足所有这些限制，我们必须选择不超过所有这些上限的 $\theta$。因此，最大允许步长 $\theta^*$ 就是这些比率中的最小值：
$$
\theta^* = \min \left\{ \frac{(x_B^{\text{current}})_i}{(p_j)_i} \;\bigg|\; (p_j)_i > 0 \right\}
$$
这就是**最小比例检验**的公式。提供这个最小比率的基变量 $(x_B)_i$ 是第一个达到零的变量，因此它必须成为**出基变量 (leaving variable)** [@problem_id:3164122]。

#### 几何解释

比例检验有一个非常直观的几何解释。在[可行域](@entry_id:136622)（一个多面体）的几何图形中，单纯形法的每次迭代对应于从一个顶点沿着一条边移动到另一个相邻的顶点。入基变量的选择确定了移动的**方向**（即沿着哪条边）。比例检验则确定了我们能沿着这条边走**多远**。
步长 $\theta^*$ 恰好是使得当前点 $x(\theta) = x^0 + \theta d$（其中 $x^0$ 是当前顶点，d 是移动方向）撞上[可行域](@entry_id:136622)的另一个“墙面”（即一个新的约束变为[紧约束](@entry_id:635234)）时所移动的距离。提供最小比率的那个约束，就是我们首先遇到的那个墙面。因此，新的点 $x(\theta^*)$ 将位于该约束的超平面上 [@problem_id:3164036]。

### 专题：退化与循环

在理想情况下，每次单纯形迭代的步长 $\theta^*$ 都是严格正的，这意味着我们移动到了一个新的顶点，并且目标函数也得到了严格的改善。然而，在实践中可能会出现一种被称为**退化 (degeneracy)** 的特殊情况。

#### 退化的定义与后果

一个基可行解如果有一个或多个基变量的值为零，则称该解是**退化的**。
退化的直接后果是，在进行比例检验时，可能会得到一个零步长。如果某个基变量 $(x_B)_i = 0$ 且其对应的[主元列](@entry_id:148772)元素 $(p_j)_i > 0$，那么比率 $(x_B)_i / (p_j)_i$ 将为 0。如果这个比率是最小比率，那么最大步长 $\theta^*$ 将为 0 [@problem_id:3164045] [@problem_id:3164063]。

当 $\theta^*=0$ 时，我们执行一次**[退化主元](@entry_id:636499)迭代 (degenerate pivot)**。在这种迭代中：
-   解的数值不会改变（因为步长为零）。
-   [目标函数](@entry_id:267263)值不会改变。
-   但是，基本身会发生变化（一个值为零的基变量被一个值为零的非基[变量替换](@entry_id:141386)）。

从几何上看，算法在同一个顶点上“原地踏步”，只是改变了描述这个顶点的基。虽然这不一定会导致问题，但它带来了**循环 (cycling)** 的风险：算法可能在一系列退化的基之间无限循环，而无法达到最优解。

#### [反循环规则](@entry_id:637416)

为了保证单纯形法的收敛性，必须采用**[反循环规则](@entry_id:637416) (anti-cycling rules)**。这些规则本质上是为选择入基或出基变量时出现的“平局”提供一个确定的打破僵局的方法。

-   **Bland 规则**：这是一个简单的组合规则。当有多个变量可选时，总是选择索引最小的那个变量作为入基变量，并选择索引最小的变量作为出基变量。Bland 证明了这个简单的规则足以防止循环。

-   **[字典序](@entry_id:143032)规则 (Lexicographic Rule)**：这是一个更具代数思想的规则。其核心思想是，将右端项向量 $b$ 进行一个无穷小的扰动，例如，用 $b(\epsilon) = b + (\epsilon, \epsilon^2, \dots, \epsilon^m)^T$ 替换 $b$，其中 $\epsilon$ 是一个极小的正数。这个扰动可以被证明能消除所有的退化（在理论上），使得每个基变量都变为严格正，从而每次迭代的步长也严格为正。在实践中，我们不需要真的使用 $\epsilon$，而是通过比较向量的[字典序](@entry_id:143032)来模拟这个过程，从而在比例检验出现平局时打破僵局 [@problem_id:3164148]。这保证了每次迭代在“[字典序](@entry_id:143032)”意义上都是严格改进的，从而杜绝了循环。

### [对偶单纯形法](@entry_id:164344)：一个不同的视角

标准的单纯形法（也称**[原始单纯形法](@entry_id:634231)**）从一个原始可行解开始，在保持原始可行性的同时，逐步走向对偶可行性（即满足[最优性条件](@entry_id:634091)）。但如果我们面临相反的情况呢？即，我们有一个满足[最优性条件](@entry_id:634091)（所有判别数均“有利”，即**对偶可行**），但其本身不是一个可行解（某些基变量为负，即**原始不可行**）。这种情况在向一个已优化的模型添加新约束后经常出现。

为了解决这类问题，我们使用**[对偶单纯形法](@entry_id:164344) (dual simplex method)**。它的迭代步骤与[原始单纯形法](@entry_id:634231)相反：

1.  **定价 (选择出基变量)**：首先选择一个**出基变量**。[选择规则](@entry_id:140784)是：在所有值为负的基变量中任选一个，例如 $x_{B,r}  0$。这个负的基变量是当前解违反原始可行性的根源。

2.  **比例检验 (选择入基变量)**：接下来，我们需要选择一个非基变量 $x_j$ 进入基，以修复 $x_{B,r}$ 的[不可行性](@entry_id:164663)，同时**保持对偶可行性**（即所有判别数在新基下仍然满足[最优性条件](@entry_id:634091)）。
    为了使 $x_{B,r}$ 的值在迭代后增加（从负值走向正值），主元元素 $\hat{a}_{rj}$（即主元行 $r$ 和[主元列](@entry_id:148772) $j$ 的系数）必须为**负数** ($\hat{a}_{rj}  0$) 。
    为了保持所有判别数非负（在最小化问题中），我们必须执行**对偶比例检验**：在所有满足 $\hat{a}_{rj}  0$ 的候选非基变量 $j$ 中，选择使得比率 $\bar{c}_j / (-\hat{a}_{rj})$ 最小的那个。
    $$
    \text{选择入基变量 } j \text{ 以最小化 } \left\{ \frac{\bar{c}_j}{-\hat{a}_{rj}} \;\bigg|\; \hat{a}_{rj}  0 \right\}
    $$
    这个规则精确地保证了在完成主元迭代后，所有的判别数仍然是非负的，从而维持了对偶可行性 [@problem_id:3164126] [@problem_id:3164072]。

[对偶单纯形法](@entry_id:164344)从一个对偶可行但原始不可行的点出发，通过一系列迭代，在保持对偶可行性的同时，逐步恢复原始可行性，最终达到既原始可行又对偶可行的最优解。它是解决某些类型线性规划问题以及进行[灵敏度分析](@entry_id:147555)时一个极其强大的工具。