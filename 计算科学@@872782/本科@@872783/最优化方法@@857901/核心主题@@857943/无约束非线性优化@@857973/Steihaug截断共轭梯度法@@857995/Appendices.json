{"hands_on_practices": [{"introduction": "Steihaug-TCG 算法的核心在于其处理信赖域边界的有效机制。我们的第一个练习将从最基本的情景入手：当沿着初始最速下降方向的无约束最优点位于信赖域之外时会发生什么。通过这个手算练习[@problem_id:3185651]，你将亲自计算在边界处截断的步长，并验证此时的预测下降量恰好等于柯西点（Cauchy point）所能提供的下降量，从而为理解该算法的“安全保障”机制打下坚实基础。", "problem": "考虑一个用于在当前迭代点附近最小化光滑函数的二阶信赖域二次模型，其定义为\n$$\nm(p) \\;=\\; m(0) \\;+\\; g^{\\top}p \\;+\\; \\tfrac{1}{2}\\,p^{\\top}Hp,\n$$\n其中当前迭代点的梯度为\n$$\ng \\;=\\; \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix},\n$$\n对称正定Hessian近似矩阵为\n$$\nH \\;=\\; \\begin{pmatrix} 2  0 \\\\ 0  6 \\end{pmatrix}.\n$$\n设信赖域半径为\n$$\n\\Delta \\;=\\; 1.\n$$\n应用一次Steihaug的截断共轭梯度法，该方法从以下位置开始\n$$\np_{0} \\;=\\; 0, \\quad d_{0} \\;=\\; -g,\n$$\n并沿着射线移动\n$$\np(\\alpha) \\;=\\; p_{0} + \\alpha d_{0}\n$$\n直到达到一维极小值点或遇到信赖域边界为止。\n\n仅使用信赖域模型的定义和沿初始方向的线搜索，完成以下操作：\n- 通过求解边界方程 $\\|p(\\alpha)\\| = \\Delta$，确定沿方向 $d_{0}$ 触及信赖域边界的第一个试探步长 $\\alpha_{0}$。\n- 通过对单变量模型 $\\phi(\\alpha) = m(p(\\alpha))$ 求导，验证沿 $d_{0}$ 方向的无约束极小值点出现在某个 $\\alpha_{\\star}$ 处，并判断 $\\alpha_{\\star}$ 是否位于信赖域边界之外。\n- 计算步长 $p_{1} = p(\\alpha_{0})$。\n- 计算预测下降量 $m(0) - m(p_{1})$。\n- 计算此数据的柯西下降量，并验证它等于预测下降量。\n\n报告预测下降量和柯西下降量的共同值。将您的答案四舍五入到四位有效数字。", "solution": "问题是对给定的信赖域二次模型应用一次Steihaug的截断共轭梯度法。该过程涉及在信赖域边界内沿最速下降方向寻找使模型最小化的步长。\n\n给定的二次模型为\n$$\nm(p) \\;=\\; m(0) \\;+\\; g^{\\top}p \\;+\\; \\tfrac{1}{2}\\,p^{\\top}Hp\n$$\n其梯度向量为\n$$\ng \\;=\\; \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}\n$$\n对称正定Hessian矩阵为\n$$\nH \\;=\\; \\begin{pmatrix} 2  0 \\\\ 0  6 \\end{pmatrix}\n$$\n信赖域半径为 $\\Delta = 1$。\n\nSteihaug方法的第一步迭代从原点 $p_{0} = 0$ 开始，并沿最速下降方向 $d_{0} = -g$ 搜索。试探步由射线 $p(\\alpha) = p_{0} + \\alpha d_{0} = \\alpha d_{0}$ 定义，其中 $\\alpha \\geq 0$。\n\n首先，我们确定搜索路径与信赖域边界相交时的步长 $\\alpha_{0}$。边界由方程 $\\|p\\| = \\Delta$ 定义。\n代入 $p(\\alpha) = \\alpha d_{0}$，我们得到：\n$$\n\\|\\alpha d_{0}\\| \\;=\\; \\Delta\n$$\n由于 $\\alpha \\ge 0$，这可简化为 $\\alpha \\|d_{0}\\| = \\Delta$。搜索方向 $d_{0} = -g$ 的范数为：\n$$\n\\|d_{0}\\| \\;=\\; \\|-g\\| \\;=\\; \\|g\\| \\;=\\; \\sqrt{3^2 + 4^2} \\;=\\; \\sqrt{9 + 16} \\;=\\; \\sqrt{25} \\;=\\; 5\n$$\n因此，到达边界的步长为：\n$$\n\\alpha_{0} \\;=\\; \\frac{\\Delta}{\\|d_{0}\\|} \\;=\\; \\frac{1}{5} \\;=\\; 0.2\n$$\n\n接下来，我们确定二次模型沿方向 $d_{0}$ 的无约束极小值点。我们定义一个单变量二次函数 $\\phi(\\alpha) = m(p(\\alpha))$：\n$$\n\\phi(\\alpha) \\;=\\; m(0) + g^{\\top}(\\alpha d_{0}) + \\frac{1}{2}(\\alpha d_{0})^{\\top}H(\\alpha d_{0})\n$$\n$$\n\\phi(\\alpha) \\;=\\; m(0) + \\alpha (g^{\\top}d_{0}) + \\frac{1}{2}\\alpha^2 (d_{0}^{\\top}H d_{0})\n$$\n为了找到极小值点 $\\alpha_{\\star}$，我们将关于 $\\alpha$ 的导数设为零：\n$$\n\\phi'(\\alpha) \\;=\\; g^{\\top}d_{0} + \\alpha (d_{0}^{\\top}H d_{0}) \\;=\\; 0\n$$\n这给出了无约束极小值点的步长：\n$$\n\\alpha_{\\star} \\;=\\; -\\frac{g^{\\top}d_{0}}{d_{0}^{\\top}H d_{0}}\n$$\n我们计算这两个二次项。由于 $d_{0} = -g$：\n$$\ng^{\\top}d_{0} \\;=\\; g^{\\top}(-g) \\;=\\; -\\|g\\|^2 \\;=\\; -25\n$$\n$$\nd_{0}^{\\top}H d_{0} \\;=\\; (-g)^{\\top}H(-g) \\;=\\; g^{\\top}H g\n$$\n我们计算 $g^{\\top}H g$：\n$$\ng^{\\top}H g \\;=\\; \\begin{pmatrix} 3  4 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  6 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 3  4 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 24 \\end{pmatrix} \\;=\\; 3(6) + 4(24) \\;=\\; 18 + 96 \\;=\\; 114\n$$\n现在，我们可以求出 $\\alpha_{\\star}$：\n$$\n\\alpha_{\\star} \\;=\\; -\\frac{-25}{114} \\;=\\; \\frac{25}{114} \\approx 0.2193\n$$\n我们将无约束最小化步长 $\\alpha_{\\star}$ 与到达边界的步长 $\\alpha_{0}$ 进行比较：\n$$\n\\alpha_{\\star} \\;=\\; \\frac{25}{114} \\quad > \\quad \\alpha_{0} \\;=\\; \\frac{1}{5} \\;=\\; 0.2\n$$\n由于沿 $d_{0}$ 方向的无约束极小值点位于信赖域边界之外，Steihaug方法将步长截断在边界处。所取的步长为 $p_{1} = p(\\alpha_{0})$。\n\n步长 $p_{1}$ 计算如下：\n$$\np_{1} \\;=\\; \\alpha_{0} d_{0} \\;=\\; 0.2 \\times (-g) \\;=\\; 0.2 \\begin{pmatrix} -3 \\\\ -4 \\end{pmatrix} \\;=\\; \\begin{pmatrix} -0.6 \\\\ -0.8 \\end{pmatrix}\n$$\n\n模型值的预测下降量为 $m(0) - m(p_{1})$。\n$$\nm(0) - m(p_{1}) \\;=\\; - \\left( g^{\\top}p_{1} + \\frac{1}{2} p_{1}^{\\top}H p_{1} \\right)\n$$\n我们计算各项：\n$$\ng^{\\top}p_{1} \\;=\\; \\begin{pmatrix} 3  4 \\end{pmatrix} \\begin{pmatrix} -0.6 \\\\ -0.8 \\end{pmatrix} \\;=\\; 3(-0.6) + 4(-0.8) \\;=\\; -1.8 - 3.2 \\;=\\; -5\n$$\n$$\np_{1}^{\\top}H p_{1} \\;=\\; \\begin{pmatrix} -0.6  -0.8 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  6 \\end{pmatrix} \\begin{pmatrix} -0.6 \\\\ -0.8 \\end{pmatrix} \\;=\\; \\begin{pmatrix} -0.6  -0.8 \\end{pmatrix} \\begin{pmatrix} -1.2 \\\\ -4.8 \\end{pmatrix}\n$$\n$$\np_{1}^{\\top}H p_{1} \\;=\\; (-0.6)(-1.2) + (-0.8)(-4.8) \\;=\\; 0.72 + 3.84 \\;=\\; 4.56\n$$\n预测下降量为：\n$$\nm(0) - m(p_{1}) \\;=\\; - \\left( -5 + \\frac{1}{2}(4.56) \\right) \\;=\\; -(-5 + 2.28) \\;=\\; -(-2.72) \\;=\\; 2.72\n$$\n\n最后，我们必须验证该值等于柯西下降量。柯西点被定义为信赖域内沿最速下降方向的二次模型的极小值点。我们刚刚计算的步长 $p_{1}$ 正是这个问题的柯西点，因为我们发现沿最速下降方向的无约束极小值点在信赖域边界之外，导致步长在边界处被截断。根据定义，柯西下降量是在柯西点的预测模型下降量，即 $m(0) - m(p_{1})$。因此，我们计算出的预测下降量值 $2.72$ 与柯西下降量相同。\n\n问题要求报告这个共同值，并四舍五入到四位有效数字。\n$$\n2.720\n$$", "answer": "$$\\boxed{2.720}$$", "id": "3185651"}, {"introduction": "在第一个练习的基础上，我们自然会问：如果第一步完全落在信赖域内部，算法将如何继续？这个练习[@problem_id:3185626]将引导你探索这种情况。你将执行完整的共轭梯度第一步迭代，然后生成一个新的、与之前方向共轭的搜索方向，并在这个新方向上探索时遇到信赖域边界。这个过程清晰地展示了 Steihaug-TCG 算法的迭代本质，以及它如何逐步逼近最优解直至边界。", "problem": "考虑信赖域子问题的二次模型\n$$m(p) = g^{\\top}p + \\frac{1}{2}p^{\\top}Hp,$$\n其对称正定Hessian矩阵为\n$$H = \\begin{pmatrix}1  0  0 \\\\ 0  2  0 \\\\ 0  0  4\\end{pmatrix},$$\n梯度为\n$$g = \\begin{pmatrix}1 \\\\ 1 \\\\ 0\\end{pmatrix},$$\n信赖域半径为\n$$\\Delta = 1.$$\n从零向量 $p_0 = \\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix}$ 开始，应用Steihaug的截断共轭梯度（TCG）方法，该方法使用共轭梯度（CG）搜索方向，沿每个搜索方向进行精确线搜索，并在检测到负曲率或边界交点时进行截断，以在球 $\\|p\\|_2 \\leq \\Delta$ 内生成迭代点。\n\n执行第一次迭代，计算沿初始CG搜索方向进行精确线搜索所得到的第一步 $p_1$。验证是否 $\\|p_1\\|_2  \\Delta$。继续进行第二次迭代，构造下一个CG搜索方向 $d_2$。假设没有遇到负曲率。证明沿 $d_2$ 的完整步长将离开信赖域，因此在迭代2中必须到达边界。确定唯一的标量 $\\alpha \\in (0,\\infty)$，使得截断步长 $p_1 + \\alpha d_2$ 正好位于边界上，即\n$$\\|p_1 + \\alpha d_2\\|_2 = \\Delta.$$\n\n将 $\\alpha$ 的值报告为一个精确的有理数。不需要四舍五入。在整个过程中使用欧几里得范数 $\\|\\cdot\\|_2$。", "solution": "该问题是适定的，并提供了应用Steihaug的截断共轭梯度（TCG）方法所需的所有信息。我们被给予了二次模型 $m(p) = g^{\\top}p + \\frac{1}{2}p^{\\top}Hp$，及其梯度 $g$、Hessian矩阵 $H$ 和信赖域半径 $\\Delta$。\n给定的参数是：\n$$\nH = \\begin{pmatrix}1  0  0 \\\\ 0  2  0 \\\\ 0  0  4\\end{pmatrix}, \\quad g = \\begin{pmatrix}1 \\\\ 1 \\\\ 0\\end{pmatrix}, \\quad \\Delta = 1\n$$\nTCG方法的起始点是 $p_0 = \\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix}$。\n\n**迭代 1**\n首先，我们初始化残差和搜索方向。二次模型的残差 $r_k$ 为 $r_k = g + Hp_k$。\n开始时，对于 $p_0 = 0$：\n$$r_0 = g + H p_0 = g = \\begin{pmatrix}1 \\\\ 1 \\\\ 0\\end{pmatrix}$$\n共轭梯度（CG）方法中的第一个搜索方向是负残差：\n$$d_1 = -r_0 = \\begin{pmatrix}-1 \\\\ -1 \\\\ 0\\end{pmatrix}$$\n\nTCG方法首先检查是否存在负曲率，即 $d_1^{\\top}Hd_1 \\le 0$。由于 $H$ 是给定的正定矩阵，我们预期曲率为正。\n$$d_1^{\\top}Hd_1 = \\begin{pmatrix}-1  -1  0\\end{pmatrix} \\begin{pmatrix}1  0  0 \\\\ 0  2  0 \\\\ 0  0  4\\end{pmatrix} \\begin{pmatrix}-1 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}-1  -2  0\\end{pmatrix} \\begin{pmatrix}-1 \\\\ -1 \\\\ 0\\end{pmatrix} = (-1)(-1) + (-2)(-1) = 1+2=3$$\n因为 $d_1^{\\top}Hd_1 = 3 > 0$，我们继续。\n\n使 $m(p_0 + \\alpha d_1)$ 最小化的最优步长 $\\alpha_1$ 由标准CG公式给出：\n$$\\alpha_1 = \\frac{r_0^{\\top}r_0}{d_1^{\\top}Hd_1}$$\n我们计算 $r_0^{\\top}r_0$：\n$$r_0^{\\top}r_0 = \\begin{pmatrix}1  1  0\\end{pmatrix} \\begin{pmatrix}1 \\\\ 1 \\\\ 0\\end{pmatrix} = 1^2 + 1^2 + 0^2 = 2$$\n因此，步长为：\n$$\\alpha_1 = \\frac{2}{3}$$\n第一个迭代点是 $p_1$：\n$$p_1 = p_0 + \\alpha_1 d_1 = 0 + \\frac{2}{3}\\begin{pmatrix}-1 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}-2/3 \\\\ -2/3 \\\\ 0\\end{pmatrix}$$\n\n接下来，我们必须验证 $p_1$ 是否在信赖域内，即 $\\|p_1\\|_2 \\le \\Delta$。\n$$\\|p_1\\|_2^2 = \\left(-\\frac{2}{3}\\right)^2 + \\left(-\\frac{2}{3}\\right)^2 + 0^2 = \\frac{4}{9} + \\frac{4}{9} = \\frac{8}{9}$$\n由于 $\\Delta=1$，$\\Delta^2=1$。我们有 $\\|p_1\\|_2^2 = \\frac{8}{9}  1$，这意味着 $\\|p_1\\|_2 = \\frac{\\sqrt{8}}{3} = \\frac{2\\sqrt{2}}{3}  1$。点 $p_1$ 严格位于信赖域内部。\n\n**迭代 2**\n为了进行第二次迭代，我们计算新的残差 $r_1$ 和新的搜索方向 $d_2$。\n$$r_1 = r_0 + \\alpha_1 H d_1 = \\begin{pmatrix}1 \\\\ 1 \\\\ 0\\end{pmatrix} + \\frac{2}{3} \\begin{pmatrix}1  0  0 \\\\ 0  2  0 \\\\ 0  0  4\\end{pmatrix} \\begin{pmatrix}-1 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 1 \\\\ 0\\end{pmatrix} + \\frac{2}{3} \\begin{pmatrix}-1 \\\\ -2 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 - 2/3 \\\\ 1 - 4/3 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1/3 \\\\ -1/3 \\\\ 0\\end{pmatrix}$$\n现在，我们计算新搜索方向的因子 $\\beta_1$：\n$$\\beta_1 = \\frac{r_1^{\\top}r_1}{r_0^{\\top}r_0}$$\n首先，计算 $r_1^{\\top}r_1$：\n$$r_1^{\\top}r_1 = \\left(\\frac{1}{3}\\right)^2 + \\left(-\\frac{1}{3}\\right)^2 + 0^2 = \\frac{1}{9} + \\frac{1}{9} = \\frac{2}{9}$$\n使用前面得到的 $r_0^{\\top}r_0=2$：\n$$\\beta_1 = \\frac{2/9}{2} = \\frac{1}{9}$$\n新的搜索方向 $d_2$ 是：\n$$d_2 = -r_1 + \\beta_1 d_1 = -\\begin{pmatrix}1/3 \\\\ -1/3 \\\\ 0\\end{pmatrix} + \\frac{1}{9}\\begin{pmatrix}-1 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}-1/3 - 1/9 \\\\ 1/3 - 1/9 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}-4/9 \\\\ 2/9 \\\\ 0\\end{pmatrix}$$\n\n问题陈述中提到，沿 $d_2$ 的完整步长将离开信赖域。TCG算法要求我们找到一个从 $p_1$ 开始沿 $d_2$ 方向的步长 $\\alpha > 0$，使其到达信赖域的边界。这意味着我们必须在以下方程中求解 $\\alpha$：\n$$\\|p_1 + \\alpha d_2\\|_2 = \\Delta = 1$$\n两边平方得到：\n$$\\|p_1 + \\alpha d_2\\|_2^2 = 1$$\n展开左侧：\n$$(p_1 + \\alpha d_2)^{\\top}(p_1 + \\alpha d_2) = p_1^{\\top}p_1 + 2\\alpha(p_1^{\\top}d_2) + \\alpha^2(d_2^{\\top}d_2) = 1$$\n这是一个关于 $\\alpha$ 的二次方程，形式为 $A\\alpha^2 + B\\alpha + C = 0$。我们来计算系数。\n$A = d_2^{\\top}d_2 = \\|d_2\\|_2^2 = \\left(-\\frac{4}{9}\\right)^2 + \\left(\\frac{2}{9}\\right)^2 + 0^2 = \\frac{16}{81} + \\frac{4}{81} = \\frac{20}{81}$。\n$B = 2(p_1^{\\top}d_2)$。首先计算 $p_1^{\\top}d_2$：\n$$p_1^{\\top}d_2 = \\begin{pmatrix}-2/3  -2/3  0\\end{pmatrix} \\begin{pmatrix}-4/9 \\\\ 2/9 \\\\ 0\\end{pmatrix} = \\left(-\\frac{2}{3}\\right)\\left(-\\frac{4}{9}\\right) + \\left(-\\frac{2}{3}\\right)\\left(\\frac{2}{9}\\right) = \\frac{8}{27} - \\frac{4}{27} = \\frac{4}{27}$$\n所以，$B = 2\\left(\\frac{4}{27}\\right) = \\frac{8}{27}$。\n$C = p_1^{\\top}p_1 - 1 = \\|p_1\\|_2^2 - 1 = \\frac{8}{9} - 1 = -\\frac{1}{9}$。\n\n关于 $\\alpha$ 的二次方程是：\n$$\\left(\\frac{20}{81}\\right)\\alpha^2 + \\left(\\frac{8}{27}\\right)\\alpha - \\frac{1}{9} = 0$$\n为简化起见，我们将整个方程乘以81：\n$$20\\alpha^2 + 3(8)\\alpha - 9 = 0$$\n$$20\\alpha^2 + 24\\alpha - 9 = 0$$\n我们使用二次公式 $\\alpha = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解 $\\alpha$，其中 $a=20$，$b=24$，$c=-9$：\n$$\\alpha = \\frac{-24 \\pm \\sqrt{24^2 - 4(20)(-9)}}{2(20)} = \\frac{-24 \\pm \\sqrt{576 + 720}}{40} = \\frac{-24 \\pm \\sqrt{1296}}{40}$$\n平方根为 $\\sqrt{1296}=36$。\n$$\\alpha = \\frac{-24 \\pm 36}{40}$$\n这给出了 $\\alpha$ 的两个解：\n$$\\alpha_1 = \\frac{-24 + 36}{40} = \\frac{12}{40} = \\frac{3}{10}$$\n$$\\alpha_2 = \\frac{-24 - 36}{40} = \\frac{-60}{40} = -\\frac{3}{2}$$\n问题要求唯一的标量 $\\alpha \\in (0,\\infty)$。TCG算法考虑沿方向 $d_2$ 的步长，所以我们需要 $\\alpha$ 的正值。\n因此，所求的值为 $\\alpha = \\frac{3}{10}$。", "answer": "$$\\boxed{\\frac{3}{10}}$$", "id": "3185626"}]}