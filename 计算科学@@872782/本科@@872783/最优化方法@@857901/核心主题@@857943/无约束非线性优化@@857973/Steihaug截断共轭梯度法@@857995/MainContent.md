## 引言
在现代科学与工程计算中，许多复杂[优化问题](@entry_id:266749)依赖于[信赖域方法](@entry_id:138393)（Trust-Region Methods）来寻找最优解。这类方法的核心在于，在每次迭代中求解一个二次模型子问题，以确定既能充分下降[目标函数](@entry_id:267263)又足够可靠的步长。然而，当问题规模变得庞大时，精确求解该子问题的传统方法因其高昂的计算成本（通常为 $\mathcal{O}(n^3)$）而变得不切实际。这构成了[大规模优化](@entry_id:168142)领域的一个关键瓶颈。

Steihaug截断[共轭梯度](@entry_id:145712)（TCG）法正是为了解决这一挑战而设计的强大工具。它是一种迭代策略，巧妙地避免了直接构造和分解巨大的Hessian矩阵，从而显著降低了计算开销。本文旨在深入剖析Steihaug-TCG方法的原理、应用与实践。在接下来的内容中，你将学习到：

在 **“原理和机制”** 一章中，我们将详细阐述该方法如何将标准的共轭梯度法嵌入信赖域框架，并介绍其三个核心的“截断”终止条件：命中信赖域边界、检测到[负曲率](@entry_id:159335)，以及在信赖域内部达到足够精度。

随后，**“应用与跨学科联系”** 一章将展示该方法在现实世界中的强大威力，从加速[机器学习模型](@entry_id:262335)（如逻辑回归和深度网络）的训练，到解决地球物理学和[机器人学](@entry_id:150623)中的[反问题](@entry_id:143129)与运动规划。

最后，通过 **“动手实践”** 部分的一系列引导性练习，你将有机会亲手计算和处理不同情景下的截断步，从而将理论知识转化为解决实际问题的能力。这三个部分将共同为你构建一个关于Steihaug-TCG方法的全面而深入的理解。

## 原理和机制

在[信赖域方法](@entry_id:138393)框架内，核心任务是求解二次模型子问题：
$$
\min_{p \in \mathbb{R}^n} m(p) = g^T p + \frac{1}{2} p^T B p \quad \text{s.t.} \quad \|p\| \le \Delta
$$
其中 $g$ 是当前迭代点的梯度，$B$ 是Hessian矩阵或其近似，$\Delta$ 是信赖域半径。虽然存在能够精确求解该子问题的“精确”方法，但它们通常计算成本高昂。例如，对于稠密的Hessian矩阵 $B$，基于其[特征值分解](@entry_id:272091)或求解一个标量“长期方程”（secular equation）的方法通常需要 $\mathcal{O}(n^3)$ 的计算复杂度。当问题规模 $n$ 很大时，这种计算成本可能令人望而却步。

因此，在实践中，特别是在[大规模优化](@entry_id:168142)问题中，我们往往倾向于采用[迭代法](@entry_id:194857)来近似求解该子问题。这些方法的关键优势在于它们通常是“无矩阵的”，即它们不需要显式构造、存储或[分解矩阵](@entry_id:146050) $B$，而仅需计算Hessian向量乘积（即对于给定的向量 $v$，计算 $Bv$）。Steihaug截断共轭梯度法（Steihaug's Truncated Conjugate Gradient, TCG）正是这样一种高效且应用广泛的近似求解策略。其核心思想是，利用共轭梯度（CG）法来探索二次模型 $m(p)$ 的[下降方向](@entry_id:637058)，同时通过一系列精心设计的“截断”规则来确保最终步长 $p$ 始终位于信赖域内。

### 利用共轭梯度法

标准共轭梯度（CG）法是一种用于求解[对称正定](@entry_id:145886)线性方程组 $Bx = c$ 的高效迭代算法。将其应用于优化领域，它等价于求解无约束二次规划问题 $\min_p m(p)$ 的最优解 $p^* = -B^{-1}g$（假设 $B$ 是正定的）。CG方法从初始点 $p_0=0$ 开始，生成一系列搜索方向 $d_k$ 和迭代点 $p_{k+1}$。

在第 $k$ 次迭代中，CG算法的核心步骤如下：
1.  **计算步长 $\alpha_k$**：沿着当前搜索方向 $d_k$，找到使二次模型 $m(p_k + \alpha d_k)$ 最小化的[最优步长](@entry_id:143372)。通过对 $\alpha$ 求导并令其为零，可以得到：
    $$
    \alpha_k = \frac{-d_k^T (g + B p_k)}{d_k^T B d_k}
    $$
    利用残差的定义 $r_k = g + B p_k$ 以及CG方法的性质 $d_k^T r_k = -r_k^T r_k$（对于初次迭代或特定形式的 $d_k$），步长公式可以简化为我们熟悉的形式 [@problem_id:3185604]：
    $$
    \alpha_k = \frac{r_k^T r_k}{d_k^T B d_k}
    $$
2.  **更新迭代点**：$p_{k+1} = p_k + \alpha_k d_k$。
3.  **更新残差**：$r_{k+1} = r_k + \alpha_k B d_k$。
4.  **生成新的搜索方向**：$d_{k+1} = -r_{k+1} + \beta_k d_k$，其中 $\beta_k = \frac{r_{k+1}^T r_{k+1}}{r_k^T r_k}$，以确保新的搜索方向与之前的方向是 $B$-共轭的。

Steihaug方法巧妙地将这套CG迭代机制嵌入到信赖域框架中，但增加了三个关键的终止条件，以适应信赖域约束和处理非正定Hessian矩阵的挑战。

### Steihaug的截断机制：适应信赖域

Steihaug方法从 $p_0 = 0$ 开始执行标准的CG迭代，但在每一步都进行检查。一旦满足以下三个条件之一，迭代就会“截断”并终止。

#### 终止条件 1：命中信赖域边界

在计算出理想的CG步长 $\alpha_k$ 后，我们必须检查更新后的迭代点 $p_{k+1} = p_k + \alpha_k d_k$ 是否会超出信赖域。如果 $\left\|p_k + \alpha_k d_k\right\| \ge \Delta$，那么标准的CG步骤就不可行。

在这种情况下，Steihaug算法不会接受这个越界的点，而是会沿着当前搜索方向 $d_k$ 移动，直到正好到达信赖域的边界。这意味着我们需要寻找一个步长 $\tau > 0$，使得最终的步 $p = p_k + \tau d_k$ 满足 $\left\|p\right\| = \Delta$。这需要求解关于 $\tau$ 的二次方程 [@problem_id:3185604] [@problem_id:3185575]：
$$
\left\|p_k + \tau d_k\right\|^2 = \Delta^2
$$
展开后得到：
$$
(d_k^T d_k) \tau^2 + 2(p_k^T d_k) \tau + (p_k^T p_k - \Delta^2) = 0
$$
我们选择该方程的[正根](@entry_id:199264) $\tau$，它将迭代点从信赖域内部的 $p_k$ 延伸至边界。一旦计算出这个截断步，算法就终止并返回 $p = p_k + \tau d_k$。

例如，考虑一个从 $p_0 = 0$ 开始的简单情况。第一步的搜索方向是 $d_0 = -g$。如果无约束的[最优步长](@entry_id:143372) $\alpha_0$ 使得 $\|\alpha_0 d_0\| > \Delta$，算法将计算一个截断步长 $\tau = \Delta / \|d_0\|$ 并返回步长 $p = \tau d_0$ [@problem_id:3185575]。

#### 终止条件 2：检测到负曲率

标准的CG算法理论上要求Hessian矩阵 $B$ 是正定的，这保证了分母 $d_k^T B d_k > 0$，从而确保了二次模型沿 $d_k$ 方向是向上弯曲的（凸的）。然而，在[信赖域方法](@entry_id:138393)中，$B$ 可能是非正定的（例如，来自[牛顿法](@entry_id:140116)的真实Hessian矩阵在[鞍点](@entry_id:142576)附近，或由于噪声影响的拟牛顿近似 [@problem_id:3185662]）。

Steihaug方法将这种情况转化为一个优势。在每次迭代中，它都会计算曲率项 $d_k^T B d_k$。如果发现 $d_k^T B d_k \le 0$，这说明模型 $m(p)$ 沿着方向 $d_k$ 是平坦的或向下弯曲的（非凸的）。这意味着沿着这个方向移动会持续减小模型值，而唯一的限制就是信赖域边界。

因此，当检测到非正定曲率时，CG迭代立即终止。与命中边界的情况类似，算法会沿着这个“下坡”方向 $d_k$ 一直移动到信赖域边界。最终的步长同样通过求解[二次方程](@entry_id:163234) $\left\|p_k + \tau d_k\right\|^2 = \Delta^2$ 来确定，并返回 $p = p_k + \tau d_k$。

一个特殊的例子是当 $B$ 是[奇异矩阵](@entry_id:148101)时，可能导致 $d_k^T B d_k = 0$。此时，标准的CG步长 $\alpha_k$ 的分母为零，迭代无法进行。Steihaug方法同样将此视为非正定曲率，并执行到边界的截断步骤 [@problem_id:3185569]。

#### 终止条件 3：达到充分的内部解精度

如果CG迭代既没有命中边界，也没有检测到[负曲率](@entry_id:159335)，那么它会像标准的CG过程一样继续进行。随着迭代的进行，残差 $r_k = g + B p_k$ 的范数 $\|r_k\|$ 会逐渐减小，这表示迭代点 $p_k$ 越来越接近无约束二次模型的最小值。

算法设定一个[收敛容差](@entry_id:635614) $\epsilon$，当满足 $\|r_k\| \le \epsilon \|g\|$（或 $\|r_k\| \le \epsilon \|r_0\|$）时，我们认为已经找到了一个足够精确的解。由于这个解是在未触发前两个截断条件的情况下达成的，所以它必然位于信赖域的内部。此时，[算法终止](@entry_id:143996)并返回当前的内部解 $p = p_k$。

### 算法流程与路径几何

综合以上三个条件，我们可以清晰地看到Steihaug TCG算法的完整逻辑。下面的例子 [@problem_id:3185639] 展示了这三个终止条件是如何相互作用的。

假设我们有模型参数 $g = \begin{pmatrix} 2 \\ 1 \end{pmatrix}$，$B = \begin{pmatrix} 2  0 \\ 0  -1 \end{pmatrix}$，信赖域半径 $\Delta = 0.7 \sqrt{5}$，以及[收敛容差](@entry_id:635614) $\epsilon=0.8$。

1.  **初始化 (k=0)**：
    $p_0 = \begin{pmatrix} 0 \\ 0 \end{pmatrix}$
    $r_0 = g + B p_0 = g = \begin{pmatrix} 2 \\ 1 \end{pmatrix}$
    $d_0 = -r_0 = \begin{pmatrix} -2 \\ -1 \end{pmatrix}$

2.  **检查终止条件 (k=0)**：
    -   **内部解?** $\|r_0\| = \sqrt{5}$，$\epsilon\|g\| = 0.8 \sqrt{5}$。因为 $\sqrt{5} \not\le 0.8\sqrt{5}$，所以未收敛。
    -   **[负曲率](@entry_id:159335)?** $d_0^T B d_0 = \begin{pmatrix} -2  -1 \end{pmatrix} \begin{pmatrix} 2  0 \\ 0  -1 \end{pmatrix} \begin{pmatrix} -2 \\ -1 \end{pmatrix} = 7$。因为 $7 > 0$，所以没有[负曲率](@entry_id:159335)。

3.  **计算CG步长**：
    $\alpha_0 = \frac{r_0^T r_0}{d_0^T B d_0} = \frac{5}{7}$

4.  **检查边界命中**：
    -   试探步 $p_1 = p_0 + \alpha_0 d_0 = \frac{5}{7} \begin{pmatrix} -2 \\ -1 \end{pmatrix} = \begin{pmatrix} -10/7 \\ -5/7 \end{pmatrix}$。
    -   计算其范数平方：$\|p_1\|^2 = \frac{100}{49} + \frac{25}{49} = \frac{125}{49} \approx 2.55$。
    -   信赖域半径平方：$\Delta^2 = (0.7\sqrt{5})^2 = 0.49 \times 5 = 2.45$。
    -   由于 $\|p_1\|^2 > \Delta^2$，试探步超出了信赖域。

5.  **截断并终止**：算法命中边界，因此终止。最终步长 $p$ 将是通过求解 $\|p_0 + \tau d_0\|^2 = \Delta^2$ 得到的位于边界上的点。在这个例子中，第一个被触发的终止条件是“命中信赖域边界”。

从几何角度看，Steihaug TCG算法生成了一条从原点开始的、[分段线性](@entry_id:201467)的路径。每一段都是沿着一个CG搜索方向 $d_k$ 延伸的。如果算法执行了 $J$ 次内部迭代后被截断，那么这条路径可以被参数化 [@problem_id:3185590]。这条路径由连接点 $p_0, p_1, \dots, p_J$ 的线段以及从 $p_J$ 沿 $d_J$ 方向延伸到信赖域边界的最后一段组成。最终的解 $p$ 就是这条路径的终点。

### 理论与实践考量

#### 为何二次模型足够好？

Steihaug TCG方法致力于求解一个二次模型 $m(p)$，但我们的最终目标是最小化一个非二次的复杂函数 $f(x)$。这种做法的合理性根植于[泰勒定理](@entry_id:144253) [@problem_id:3185616]。当信赖域半径 $\Delta$ 足够小时，以当前点 $x$ 的梯度 $g=\nabla f(x)$ 和Hessian $B=\nabla^2 f(x)$ 构建的二次模型 $m(p)$ 是对真实函数 $f(x+p)$ 的一个高度精确的局部近似。

更具体地说，如果 $f$ 的Hessian矩阵是[Lipschitz连续的](@entry_id:267396)，那么模型与真实函数之间的误差满足：
$$
|f(x+p) - m(p)| \le \frac{L}{6} \|p\|^3
$$
其中 $L$ 是[Lipschitz常数](@entry_id:146583)。误差是 $\|p\|$ 的三阶项，这意味着对于范数很小的步长 $p$（即小 $\Delta$），这个误差会比模型本身捕获的一阶项（$g^T p$）和二阶项（$\frac{1}{2}p^T B p$）小得多。因此，在小信赖域内，用一个“冻结”的Hessian矩阵 $B$ 来求解二次模型是一个非常可靠的策略，我们无需在CG的内部迭代中重新计算Hessian。

#### 截断对CG性质的影响

标准[共轭梯度法](@entry_id:143436)的美妙之处在于其代数性质，如残差的相互正交性（$r_i^T r_j = 0$ for $i \ne j$）和搜索方向的 $B$-共轭性（$d_i^T B d_j = 0$ for $i \ne j$）。这些性质保证了算法在至多 $n$ 次迭代后能找到二次函数的精确最小值（在无[舍入误差](@entry_id:162651)的情况下）。然而，这些性质严重依赖于每一步都采用精确的步长 $\alpha_k = (r_k^T r_k) / (d_k^T B d_k)$。

当Steihaug方法执行截断时，无论是由于命中边界还是检测到负曲率，所采用的步长 $\tau$ 几乎总是不同于理想的 $\alpha_k$。这一改变会打破CG迭代的“魔力” [@problem_id:3185581]。截断后的残差将不再与之前的残差和搜索方向正交。

这个观察带来了一个至关重要的实践结论：Steihaug TCG是一次性的子问题求解器。在一个完整的信赖域算法的外部迭代中，当我们需要为新的迭代点 $x_{k+1}$ 求解一个新的子问题（具有新的梯度 $g_{new}$ 和Hessian $B_{new}$）时，我们必须从头开始一个新的、独立的TCG过程。即，总是以 $p_0=0$, $r_0=g_{new}$, $d_0=-r_0$ 来初始化。任何试图从上一个被截断的TCG运行中“继续”或“恢复”迭代的做法都是错误的，因为它所依赖的[代数结构](@entry_id:137052)已经被破坏 [@problem_id:3185581]。

#### 计算优势与鲁棒性

Steihaug TCG方法的主要吸[引力](@entry_id:175476)在于其计算效率，尤其是在大规模问题中 [@problem_id:3185600]。
- **复杂度**：每次CG迭代的主要计算成本是Hessian向量乘积 $B d_k$，对于[稠密矩阵](@entry_id:174457) $B$，这需要 $\mathcal{O}(n^2)$ 次操作。如果CG在 $m$ 次迭代后终止，总成本约为 $\mathcal{O}(m n^2)$。在许多情况下，$m$ 远小于 $n$ ($m \ll n$)，这使得TCG的成本远低于精确求解器所需的 $\mathcal{O}(n^3)$。对于 $B$ 是稀疏的或可以通过特定结构快速计算 $B d_k$ 的情况，其优势更加明显。
- **鲁棒性**：该方法通过其负曲率检测机制，自然地处理了Hessian矩阵非正定的情况，这是许多其他方法（如直接[Cholesky分解](@entry_id:147066)）所不具备的。然而，该方法的性能依赖于Hessian向量乘积的质量。如果这个乘积是通过一个有噪声的预估器（oracle）得到的，例如 $v \mapsto Bv + \eta$，那么噪声项 $\eta$ 可能会干扰曲率检测。一个足够大的、方向不利的噪声可能会导致 $p_k^T (B p_k + \eta)$ 的符号与 $p_k^T B p_k$ 的真实符号相反，从而产生“假阳性”（在 $B$ 正定时错误地检测到负曲率）或“假阴性”（未能检测到真实的[负曲率](@entry_id:159335)）[@problem_id:3185584]。在设计算法时，需要意识到这种潜在的敏感性。

综上所述，Steihaug截断共轭梯度法通过将CG的迭代效率与信赖域的几何约束和非凸处理能力巧妙结合，为求解[大规模优化](@entry_id:168142)问题中的[信赖域子问题](@entry_id:168153)提供了一个强大、实用且计算上可行的工具。