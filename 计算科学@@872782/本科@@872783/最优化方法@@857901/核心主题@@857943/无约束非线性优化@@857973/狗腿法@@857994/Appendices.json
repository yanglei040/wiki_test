{"hands_on_practices": [{"introduction": "狗腿法通过一条分段线性路径来近似信赖域子问题的解。这条路径的第一个部分是沿着最速下降方向的线段。本练习旨在计算这条线段的终点——柯西点（Cauchy point），它是在信赖域约束下，二次模型在最速下降方向上的极小值点。掌握柯西点的计算是理解狗腿法的第一步。[@problem_id:2212704]", "problem": "在数值优化领域，信赖域方法是一类用于解决非线性规划问题的算法。这些方法通过在当前点 $x_k$ 周围半径为 $\\Delta$ 的“信赖域”内最小化真实目标函数的模型函数 `m(p)`，来迭代地找到一个步长 `p`。该模型通常是一个二次近似：\n$$m(p) = f(x_k) + g^T p + \\frac{1}{2} p^T B p$$\n其中 $g$ 是目标函数在 $x_k$ 处的梯度，而 $B$ 是对Hessian矩阵的近似。\n\n许多信赖域算法（如狗腿法）的一个基本组成部分是柯西点 $p_C$ 的计算。柯西点被定义为在最速下降方向上使二次模型 $m(p)$ 最小化的向量，且步长受限于信赖域内，即 $\\|p\\| \\le \\Delta$。\n\n考虑一个优化问题，在当前迭代点，梯度由 $g = \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix}$ 给出，Hessian近似为单位矩阵 $B = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$。信赖域半径设为 $\\Delta = 4$。\n\n计算此场景下的柯西点 $p_C$。你的答案应该是一个包含精确分数的 2x1 列向量。", "solution": "问题要求解柯西点 $p_C$，它是以下约束优化问题的解：\n$$ \\min_{p} \\quad m(p) = f(x_k) + g^T p + \\frac{1}{2} p^T B p $$\n$$ \\text{约束条件为} \\quad p = -\\tau g \\text{ 对于某个 } \\tau \\ge 0, \\quad \\text{且} \\quad \\|p\\| \\le \\Delta $$\n\n搜索方向为最速下降方向 $d = -g$。该方向上的任意点可以参数化为 $p(\\tau) = -\\tau g$，其中标量 $\\tau \\ge 0$。\n\n首先，我们将其代入二次模型 $m(p)$，得到一个关于单变量 $\\tau$ 的函数：\n$$ \\phi(\\tau) = m(-\\tau g) = f(x_k) + g^T(-\\tau g) + \\frac{1}{2} (-\\tau g)^T B (-\\tau g) $$\n$$ \\phi(\\tau) = f(x_k) - \\tau (g^T g) + \\frac{1}{2} \\tau^2 (g^T B g) $$\n常数项 $f(x_k)$ 不影响最小化子，因此我们可以专注于最小化与 $\\tau$ 相关的部分。\n\n接下来，我们将信赖域约束 $\\|p\\| \\le \\Delta$ 转换为对 $\\tau$ 的约束：\n$$ \\|p(\\tau)\\| = \\|-\\tau g\\| = |\\tau| \\|g\\| = \\tau \\|g\\| \\le \\Delta $$\n由于我们寻求的是下降方向上的步长，因此 $\\tau \\ge 0$。因此，对 $\\tau$ 的约束为：\n$$ 0 \\le \\tau \\le \\frac{\\Delta}{\\|g\\|} $$\n\n现在，我们通过对 $\\phi(\\tau)$ 求关于 $\\tau$ 的导数并将其设为零，来找到二次函数 $\\phi(\\tau)$ 的无约束最小化子。这将给出在没有信赖域约束的情况下的最优步长 $\\tau^*$。\n$$ \\frac{d\\phi}{d\\tau} = -g^T g + \\tau (g^T B g) = 0 $$\n解出 $\\tau$，我们得到：\n$$ \\tau^* = \\frac{g^T g}{g^T B g} $$\n二阶导数为 $\\frac{d^2\\phi}{d\\tau^2} = g^T B g$。如果它为正，我们就找到了一个极小值。\n\n让我们使用给定的值计算所需的量：\n$g = \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix}$，$B = I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$，且 $\\Delta = 4$。\n\n1.  计算 $g^T g$：\n    $g^T g = (3)(3) + (-4)(-4) = 9 + 16 = 25$。\n\n2.  计算 $\\|g\\|$：\n    $\\|g\\| = \\sqrt{g^T g} = \\sqrt{25} = 5$。\n\n3.  计算 $g^T B g$：\n    因为 $B=I$，$g^T B g = g^T I g = g^T g = 25$。\n\n二阶导数 $g^T B g = 25  0$，所以 $\\phi(\\tau)$ 是一个凸抛物线，其无约束最小值确实在 $\\tau^*$ 处。\n\n4.  计算无约束最优步长 $\\tau^*$：\n    $$ \\tau^* = \\frac{g^T g}{g^T B g} = \\frac{25}{25} = 1 $$\n\n5.  确定 $\\tau$ 的可行区间：\n    约束是 $0 \\le \\tau \\le \\frac{\\Delta}{\\|g\\|}$。\n    $$ \\frac{\\Delta}{\\|g\\|} = \\frac{4}{5} = 0.8 $$\n    所以，$\\tau$ 的可行区间是 $[0, 0.8]$。\n\n6.  找到有约束的最优步长 $\\tau_C$。无约束最小化子 $\\tau^* = 1$ 位于可行区间 $[0, 0.8]$ 之外。由于 $\\phi(\\tau)$ 是一个在 $\\tau=1$ 处取得最小值的凸抛物线，其在区间 $[0, 0.8]$ 上的最小值必然出现在最接近 $\\tau=1$ 的边界点上。这个点是 $\\tau = 0.8$。\n    因此，柯西点的步长为 $\\tau_C = \\frac{\\Delta}{\\|g\\|} = \\frac{4}{5}$。\n\n7.  计算柯西点 $p_C$：\n    $$ p_C = -\\tau_C g = -\\frac{4}{5} \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix} = \\begin{pmatrix} -12/5 \\\\ 16/5 \\end{pmatrix} $$\n\n柯西点为 $p_C = \\begin{pmatrix} -12/5 \\\\ 16/5 \\end{pmatrix}$。我们来验证它的范数：$\\|p_C\\| = \\sqrt{(-12/5)^2 + (16/5)^2} = \\sqrt{\\frac{144+256}{25}} = \\sqrt{\\frac{400}{25}} = \\sqrt{16} = 4$，这与预期相符，恰好等于信赖域半径 $\\Delta$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\frac{12}{5} \\\\ \\frac{16}{5} \\end{pmatrix}\n}\n$$", "id": "2212704"}, {"introduction": "当信赖域足够大，以至于柯西点位于其内部时，狗腿路径会从柯西点延伸向牛顿点，构成路径的第二段。本练习将探讨如何确定当最优步长恰好落在连接柯西点和牛顿点的第二段“狗腿”上时的具体位置。通过这个练习，你将能深入理解狗腿法如何巧妙地在最速下降方向和牛顿方向之间进行插值。[@problem_id:2212758]", "problem": "在数值优化中求解信赖域子问题的背景下，狗腿法是一种寻找近似解的常用方法。该方法通过沿一条由两个关键向量定义的路径来构造一个试探步 $p$：柯西点 $p_U$（沿最速下降方向的极小化子）和牛顿点 $p_B$（二次模型的无约束极小化子）。该路径包含从原点到 $p_U$ 的线段，以及从 $p_U$ 到 $p_B$ 的线段。最终的狗腿步 $p$ 是该路径上距离原点最远但仍位于信赖域（一个半径为 $\\Delta$ 的球体）内的点。\n\n考虑某优化算法的一次特定迭代，其中柯西点和牛顿点由向量 $p_U = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 和 $p_B = \\begin{pmatrix} 4 \\\\ 4 \\end{pmatrix}$ 给出。本次迭代的信赖域半径为 $\\Delta = 3$。\n\n确定狗腿步向量 $p$。请以具有精确分量的列向量形式给出你的答案。", "solution": "我们已知 $p_{U}=\\begin{pmatrix}1 \\\\ 1\\end{pmatrix}$，$p_{B}=\\begin{pmatrix}4 \\\\ 4\\end{pmatrix}$，以及信赖域半径 $\\Delta=3$。计算范数：\n$$\n\\|p_{U}\\|=\\sqrt{1^{2}+1^{2}}=\\sqrt{2},\\quad \\|p_{B}\\|=\\sqrt{4^{2}+4^{2}}=4\\sqrt{2}.\n$$\n由于 $\\|p_{U}\\|  \\Delta  \\|p_{B}\\|$，狗腿步位于从 $p_{U}$ 到 $p_{B}$ 的线段上，并且其范数恰好为 $\\Delta$。将第二段线段参数化为\n$$\np(\\tau)=p_{U}+\\tau\\,(p_{B}-p_{U}),\\quad \\tau\\in[0,1],\n$$\n其中 $p_{B}-p_{U}=\\begin{pmatrix}3 \\\\ 3\\end{pmatrix}$。则\n$$\np(\\tau)=\\begin{pmatrix}1+3\\tau \\\\ 1+3\\tau\\end{pmatrix},\\quad \\|p(\\tau)\\|^{2}=2\\,(1+3\\tau)^{2}.\n$$\n施加信赖域边界条件 $\\|p(\\tau)\\|=\\Delta$：\n$$\n2\\,(1+3\\tau)^{2}=9\\;\\Rightarrow\\;(1+3\\tau)^{2}=\\frac{9}{2}\\;\\Rightarrow\\;1+3\\tau=\\frac{3}{\\sqrt{2}},\n$$\n因为 $\\tau\\geq 0$，所以取正根。因此\n$$\n3\\tau=\\frac{3}{\\sqrt{2}}-1\\;\\Rightarrow\\;\\tau=\\frac{1}{\\sqrt{2}}-\\frac{1}{3},\n$$\n该值位于 $[0,1]$ 区间内。因此\n$$\np=p(\\tau)=\\begin{pmatrix}1+3\\tau \\\\ 1+3\\tau\\end{pmatrix}=\\begin{pmatrix}\\frac{3}{\\sqrt{2}} \\\\ \\frac{3}{\\sqrt{2}}\\end{pmatrix}.\n$$\n等价地，将分母有理化可得 $p=\\begin{pmatrix}\\frac{3\\sqrt{2}}{2} \\\\ \\frac{3\\sqrt{2}}{2}\\end{pmatrix}$。两者均为精确形式。", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{3\\sqrt{2}}{2} \\\\ \\frac{3\\sqrt{2}}{2}\\end{pmatrix}}$$", "id": "2212758"}, {"introduction": "在掌握了狗腿法各个关键部分的计算之后，最后一步是将其整合为一个完整的算法。一个实用的优化程序需要根据牛顿步、柯西步以及信赖域半径之间的关系，来执行一套明确的决策逻辑。本练习要求你将所学知识融会贯通，构建出选择最终步长的完整条件判断结构，这也是狗腿法算法的核心。[@problem_id:2212701]", "problem": "在数值优化领域，信赖域方法是用于求解无约束非线性规划问题的一类算法。在每次迭代中，它们在当前点周围定义一个“信赖域”，在该区域内，目标函数的模型（通常是二次近似）被认为是可靠的。然后，算法寻求一个在信赖域内最小化该模型的步长。\n\n狗腿法（dogleg method）是近似求解此信赖域子问题的一种常用技术。该子问题是找到一个步长向量 $p$，以最小化二次模型\n$$m(p) = f_k + g^T p + \\frac{1}{2} p^T B p$$\n该模型受约束 $\\|p\\|_2 \\le \\Delta$ 的限制，其中 $g$ 是目标函数的梯度，$B$ 是Hessian矩阵的正定近似，$\\Delta  0$ 是信赖域半径。所有向量和矩阵都在当前迭代点 $x_k$ 处求值。\n\n狗腿法通过考虑一条分段线性路径来构造一个试探步长 $p$。这条路径连接了原点、沿最速下降方向的无约束最小化点，以及完整二次模型的无约束最小化点。这两个关键点是：\n1.  拟牛顿步（quasi-Newton step），$p^B = -B^{-1}g$，它是 $m(p)$ 的无约束最小化子。\n2.  最速下降步（steepest-descent step），$p^U = -\\frac{g^T g}{g^T B g}g$，它是 $m(p)$ 沿着负梯度 $-g$ 方向的最小化子。\n\n你的任务是选择正确的条件逻辑块，程序将使用该逻辑块根据信赖域半径 $\\Delta$ 以及 $p^B$ 和 $p^U$ 的欧几里得范数来确定试探步长 $p$。为本题之目的，假设 `norm(v)` 计算欧几里得范数 $\\|v\\|_2$。\n\n下列哪个伪代码片段正确地实现了选择狗腿步长 $p$ 的逻辑？\n\nA.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  IF norm(pU) >= delta:\n    Set p = delta * (pU / norm(pU))\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```\n\nB.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  Set p = delta * (pB / norm(pB))\n```\n\nC.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  Set p = delta * (pU / norm(pU))\n```\n\nD.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  IF norm(pU)  delta:\n    Set p = delta * (pU / norm(pU))\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```\n\nE.\n```\nIF norm(pU) >= delta:\n  Set p = delta * (pU / norm(pU))\nELSE:\n  IF norm(pB) = delta:\n    Set p = pB\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```", "solution": "我们正在求解二次模型的信赖域子问题\n$$\nm(p) = f_{k} + g^{T}p + \\frac{1}{2} p^{T} B p\n$$\n该子问题受约束 $\\|p\\|_{2} \\le \\Delta$ 的限制，其中 $B$ 是正定的。狗腿法构造了一条由两段组成的分段线性路径：从原点到最速下降（柯西）步 $p^{U}$，然后从 $p^{U}$ 到拟牛顿步 $p^{B}$。定义如下\n$$\np^{B} = -B^{-1} g, \\quad p^{U} = -\\frac{g^{T} g}{g^{T} B g}\\, g.\n$$\n\n正确的选择逻辑遵循由信赖域半径 $\\Delta$ 以及 $p^{B}$ 和 $p^{U}$ 的范数决定的三个互斥情况：\n\n1) 如果 $\\|p^{B}\\|_{2} \\le \\Delta$，那么无约束最小化子 $p^{B}$ 是可行的。由于 $B$ 是正定的，$p^{B}$ 是 $m(p)$ 在所有 $p$ 上的唯一最小化子，并且由于它是可行的，它也是约束问题的最小化子。因此，设\n$$\np = p^{B}.\n$$\n\n2) 否则，如果 $\\|p^{B}\\|_{2}  \\Delta$ 且 $\\|p^{U}\\|_{2} \\ge \\Delta$，那么信赖域边界与狗腿路径的第一段（从 $0$ 到 $p^{U}$）相交。沿此段在边界上的最优步长通过将 $p^{U}$ 缩放至长度为 $\\Delta$ 得到：\n$$\np = \\Delta \\frac{p^{U}}{\\|p^{U}\\|_{2}}.\n$$\n\n3) 否则，如果 $\\|p^{B}\\|_{2}  \\Delta$ 且 $\\|p^{U}\\|_{2}  \\Delta$，那么信赖域边界与第二段（从 $p^{U}$ 到 $p^{B}$）相交。我们找到唯一的 $\\tau \\in [0,1]$ 使得\n$$\n\\|p^{U} + \\tau (p^{B} - p^{U})\\|_{2} = \\Delta,\n$$\n并设\n$$\np = p^{U} + \\tau (p^{B} - p^{U}).\n$$\n\n与选项进行比较：\n- 选项 A 完全实现了这个逻辑：首先检查 $\\|p^{B}\\|_{2} \\le \\Delta$，否则如果 $\\|p^{U}\\|_{2} \\ge \\Delta$ 则将 $p^{U}$ 缩放到边界，否则沿着从 $p^{U}$ 到 $p^{B}$ 的狗腿段求解 $\\tau$。\n- 选项 B 在 $p^{B}$ 位于外部时错误地缩放了 $p^{B}$，忽略了狗腿路径和 $p^{U}$ 的作用。\n- 选项 C 在 $p^{B}$ 位于外部时总是错误地缩放 $p^{U}$，即使当 $\\|p^{U}\\|_{2}  \\Delta$ 时也是如此，这不符合第一段边界交叉的情况。\n- 选项 D 颠倒了 $p^{U}$ 的边界情况：它在 $\\|p^{U}\\|_{2}  \\Delta$ 时缩放 $p^{U}$，这是不正确的；在这种情况下，边界位于第二段上，需要用 $\\tau$ 进行插值。\n- 选项 E 在检查 $\\|p^{B}\\|_{2} \\le \\Delta$ 之前检查 $\\|p^{U}\\|_{2} \\ge \\Delta$，这可能导致即使 $p^{B}$ 是可行的，也会选择缩放后的 $p^{U}$；这违反了只要 $p^{B}$ 位于信赖域内就应选择它的规则。\n\n因此，正确的伪代码片段是选项 A。", "answer": "$$\\boxed{A}$$", "id": "2212701"}]}