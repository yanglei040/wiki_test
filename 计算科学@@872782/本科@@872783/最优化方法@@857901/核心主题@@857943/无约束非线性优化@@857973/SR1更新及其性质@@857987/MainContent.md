## 引言
在[非线性优化](@entry_id:143978)的广阔领域中，拟牛顿法通过近似计算[海森矩阵](@entry_id:139140)，在求解效率与计算成本之间取得了精妙的平衡。然而，在众多[拟牛顿法](@entry_id:138962)中，对称秩一（Symmetric Rank-1, SR1）更新因其独特的数学性质而占有特殊地位。与广受欢迎的[BFGS方法](@entry_id:263685)不同，SR1不强制保持[海森矩阵近似](@entry_id:177469)的正定性，这一特性既是其力量的源泉，也带来了独特的挑战。本文旨在系统性地剖析SR1方法，填补从理论到实践应用的认知鸿沟，揭示其在处理现代[优化问题](@entry_id:266749)，尤其是非凸问题时的强大潜力。

通过本文的学习，您将全面掌握[SR1更新](@entry_id:636357)的来龙去脉。在第一章“原理与机制”中，我们将从第一性原理出发，推导SR1公式，深入探讨其不保证[正定性](@entry_id:149643)这一核心特性，并分析由此带来的数值稳定性问题及应对策略。接着，在第二章“应用与交叉学科联系”中，我们将展示SR1如何在[非凸优化](@entry_id:634396)、[鞍点](@entry_id:142576)遍历以及控制理论、机器学习等前沿领域中发挥关键作用。最后，在第三章“动手实践”中，您将有机会通过编码练习，亲手实现和验证SR1的关键行为，巩固所学知识。

现在，让我们从最基本的原理开始，探索[SR1更新](@entry_id:636357)是如何被构建出来，以及它为何在众多优化算法中如此与众不同。

## 原理与机制

在[拟牛顿法](@entry_id:138962)的框架内，我们的核心任务是构建一个近似海森矩阵 $B_k$ 的序列，这个序列既能捕捉目标[函数的曲率](@entry_id:173664)信息，又比计算真实[海森矩阵](@entry_id:139140)的成本低廉。对称秩一（Symmetric Rank-1, SR1）更新公式提供了一种简洁而强大的方法来实现这一目标。本章将深入探讨 SR1 方法的推导、核心性质、[数值稳定性](@entry_id:146550)问题及其在[非凸优化](@entry_id:634396)中的独特作用。

### 从第一性原理推导 SR1 公式

所有[拟牛顿法](@entry_id:138962)的基石是 **[割线条件](@entry_id:164914)**（secant condition）。该条件源于对梯度 $\nabla f$ 在点 $x_{k+1}$ 附近的一阶[泰勒展开](@entry_id:145057)，旨在让更新后的[海森矩阵近似](@entry_id:177469) $B_{k+1}$ 能够精确地反映最近一步的梯度变化。给定步长 $s_k = x_{k+1} - x_k$ 和梯度差 $y_k = \nabla f(x_{k+1}) - \nabla f(x_k)$，[割线条件](@entry_id:164914)要求：

$B_{k+1} s_k = y_k$

SR1 方法的独特之处在于它寻求满足此条件的最简单的校正。具体来说，它假设新的近似矩阵 $B_{k+1}$ 是由旧矩阵 $B_k$ 加上一个 **对称[秩一矩阵](@entry_id:199014)** 得到的。一个通用的对称[秩一矩阵](@entry_id:199014)可以写成 $\gamma z z^\top$ 的形式，其中 $\gamma$ 是一个标量，$z$ 是一个非零向量。因此，更新形式为：

$B_{k+1} = B_k + \gamma z z^\top$

我们将此形式代入[割线条件](@entry_id:164914)中：

$(B_k + \gamma z z^\top) s_k = y_k$

$B_k s_k + \gamma (z^\top s_k) z = y_k$

整理后得到：

$\gamma (z^\top s_k) z = y_k - B_k s_k$

这个等式揭示了校正向量 $z$ 的方向。只要右侧的向量 $y_k - B_k s_k$ 不为零，向量 $z$ 必须与其成比例。为了简化，我们可以直接选择 $z = y_k - B_k s_k$。将这个选择代回上式，我们得到：

$\gamma ((y_k - B_k s_k)^\top s_k) (y_k - B_k s_k) = y_k - B_k s_k$

假设 $y_k - B_k s_k \neq 0$，我们可以消去这个向量，得到关于标量 $\gamma$ 的方程：

$\gamma ((y_k - B_k s_k)^\top s_k) = 1$

这就引出了 SR1 更新的第一个关键点：只要分母 $(y_k - B_k s_k)^\top s_k$ 不为零，我们就可以唯一地确定校正的标量大小 $\gamma$ [@problem_id:3184277]。即：

$\gamma = \frac{1}{(y_k - B_k s_k)^\top s_k}$

将 $\gamma$ 和 $z$ 的表达式代回最初的更新形式，我们便得到了 **SR1 更新公式** [@problem_id:3184234] [@problem_id:2580787]：

$B_{k+1} = B_k + \frac{(y_k - B_k s_k)(y_k - B_k s_k)^\top}{(y_k - B_k s_k)^\top s_k}$

这个公式是在 $(y_k - B_k s_k)^\top s_k \neq 0$ 的条件下，能够满足[割线条件](@entry_id:164914)的 **唯一** [对称秩一更新](@entry_id:636357)。

### SR1 更新的核心性质

SR1 方法具有一系列独特的性质，这些性质决定了它的优势与劣势。

#### 对称性保持

由其构造方式可知，如果初始矩阵 $B_k$ 是对称的，那么校正项 $\frac{(y_k - B_k s_k)(y_k - B_k s_k)^\top}{(y_k - B_k s_k)^\top s_k}$ 也是一个对称矩阵（任何形如 $v v^\top$ 的外积矩阵都是对称的）。两个对称矩阵之和仍然是对称的，因此 SR1 更新能够自动保持[海森矩阵近似](@entry_id:177469)的对称性 [@problem_id:3184234] [@problem_id:2580787]。

#### 不保证[正定性](@entry_id:149643)：弱点与力量的统一

与著名的 BFGS (Broyden–Fletcher–Goldfarb–Shanno) 更新不同，SR1 方法 **不保证** 在 $B_k$ 是正定的情况下，$B_{k+1}$ 仍然是正定的。这是 SR1 最为关键的特性，也是其弱点与力量的来源。

其原因在于更新公式中的分母 $(y_k - B_k s_k)^\top s_k$。这个标量的符号决定了校正项是正半定还是负半定。

*   如果 $(y_k - B_k s_k)^\top s_k > 0$，我们是在 $B_k$ 的基础上增加一个正半定矩阵，这“倾向于”保持[正定性](@entry_id:149643)。
*   如果 $(y_k - B_k s_k)^\top s_k  0$，我们则是在 $B_k$ 的基础上 **减去** 一个正半定矩阵。这就有可能使矩阵的某些[特征值](@entry_id:154894)变为负数，从而导致 $B_{k+1}$ 变为 **[不定矩阵](@entry_id:634961)**（即同时拥有正[特征值](@entry_id:154894)和负[特征值](@entry_id:154894)）。

我们可以通过一个简单的二维例子来具体说明这一点 [@problem_id:3184234]。假设当前的[海森矩阵近似](@entry_id:177469)是单位矩阵 $B_k = I = \begin{pmatrix} 1  0 \\ 0  1 \end{pmatrix}$，它显然是正定的。如果我们选择的步长 $s_k = \begin{pmatrix} 1 \\ 0 \end{pmatrix}$ 和梯度差 $y_k = \begin{pmatrix} -2 \\ 0 \end{pmatrix}$，那么：

$y_k - B_k s_k = \begin{pmatrix} -2 \\ 0 \end{pmatrix} - \begin{pmatrix} 1 \\ 0 \end{pmatrix} = \begin{pmatrix} -3 \\ 0 \end{pmatrix}$

分母为：

$(y_k - B_k s_k)^\top s_k = \begin{pmatrix} -3  0 \end{pmatrix} \begin{pmatrix} 1 \\ 0 \end{pmatrix} = -3  0$

由于分母为负，更新后的矩阵 $B_{k+1}$ 可能会失去[正定性](@entry_id:149643)。我们计算 $B_{k+1}$：

$B_{k+1} = \begin{pmatrix} 1  0 \\ 0  1 \end{pmatrix} + \frac{\begin{pmatrix} -3 \\ 0 \end{pmatrix}\begin{pmatrix} -3  0 \end{pmatrix}}{-3} = \begin{pmatrix} 1  0 \\ 0  1 \end{pmatrix} - \begin{pmatrix} 3  0 \\ 0  0 \end{pmatrix} = \begin{pmatrix} -2  0 \\ 0  1 \end{pmatrix}$

新的近似矩阵 $B_{k+1}$ 的[特征值](@entry_id:154894)为 $-2$ 和 $1$，它是一个[不定矩阵](@entry_id:634961)。这个例子清晰地表明，即使从一个“良好”的[正定矩阵](@entry_id:155546)出发，SR1 更新也可能产生一个[不定矩阵](@entry_id:634961) [@problem_id:2580787]。

虽然失去正定性会导致无法保证搜索方向是[下降方向](@entry_id:637058)，给[线搜索](@entry_id:141607)等[全局化策略](@entry_id:177837)带来麻烦，但这一特性也赋予了 SR1 方法一个独特的能力：**它能够生成[不定矩阵](@entry_id:634961)来近似非凸函数（例如在[鞍点](@entry_id:142576)附近）的真实[海森矩阵](@entry_id:139140)**。

为了更好地理解这一点，让我们比较 SR1 和 BFGS 在一个经典[鞍点](@entry_id:142576)函数 $f(x,y) = x^2 - y^2$ 上的表现 [@problem_id:3170229]。该函数的真实[海森矩阵](@entry_id:139140)是恒定的 $H = \begin{pmatrix} 2  0 \\ 0  -2 \end{pmatrix}$，它是不定的。如果我们从 $B_0=I$ 出发，并沿着某个方向（例如 $s_0 = (\sqrt{2}, 1)^\top$）进行一步迭代，SR1 更新会产生一个[不定矩阵](@entry_id:634961) $B_1^{\mathrm{SR1}}$，其[特征值](@entry_id:154894)一个为正，一个为负。这表明 $B_1^{\mathrm{SR1}}$ 成功地捕捉到了函数固有的[鞍点](@entry_id:142576)几何结构。相比之下，BFGS 方法在满足特定条件（$s_k^\top y_k > 0$）时，会强制保持[海森矩阵近似](@entry_id:177469)的[正定性](@entry_id:149643)。在同样的情况下，BFGS 会生成一个[正定矩阵](@entry_id:155546) $B_1^{\mathrm{BFGS}}$，这相当于用一个局部[凸函数](@entry_id:143075)模型去近似一个非凸函数，从而丢失了关于[负曲率](@entry_id:159335)的关键信息 [@problem_id:3119451]。

因此，SR1 方法在处理非凸问题或需要更精确[海森矩阵近似](@entry_id:177469)的场景中（如[信赖域方法](@entry_id:138393)）尤其具有吸[引力](@entry_id:175476)。它以牺牲稳定性和[下降方向](@entry_id:637058)保证为代价，换取了更真实地反映局部曲率的能力。

### 数值稳定性与实际应用

SR1 公式的分母 $(y_k - B_k s_k)^\top s_k$ 是其“阿喀琉斯之踵”。当这个值等于零或非常接近于零时，更新将失败或导致数值不稳定。

#### 分母为零的条件

一个常见的误解是，分母为零仅当 $y_k = B_k s_k$ 时发生。虽然 $y_k = B_k s_k$ 确实会导致分母为零，但这并非充分必要条件。分母 $(y_k - B_k s_k)^\top s_k$ 是一个[点积](@entry_id:149019)，它为零意味着向量 $y_k - B_k s_k$ 与向量 $s_k$ **正交**。只要这两个向量相互垂直，即使它们都不是[零向量](@entry_id:156189)，分母也为零 [@problem_id:2580787]。

#### 跳过更新（Skipping）

在实际计算中，我们必须避免分母过小导致校正项过大，从而破坏 $B_k$ 中已经积累的曲率信息。因此，实用的 SR1 算法会包含一个 **跳过更新的准则**。一个标准的准则如下：

如果 $|\left(y_k - B_k s_k\right)^\top s_k| \le \eta \lVert y_k - B_k s_k \rVert_2 \lVert s_k \rVert_2$

则跳过本次更新，令 $B_{k+1} = B_k$。其中 $\eta$ 是一个很小的正数（例如 $10^{-8}$）。这个条件利用柯西-施瓦茨不等式，判断向量 $y_k - B_k s_k$ 和 $s_k$ 是否接近正交。如果满足该条件，说明更新是数值不安全的，算法会选择放弃本次更新，保留旧的近似矩阵 [@problem_id:2580787] [@problem_id:3184285]。

跳过更新的情形主要有两类 [@problem_id:3184285]：
1.  **良性跳过**：$B_k$ 已经能够很好地近似 $s_k$ 方向上的曲率，即 $B_k s_k \approx y_k$。此时 $y_k - B_k s_k$ 接近于零向量，分母自然很小。跳过更新是合理的，因为无需校正。
2.  **恶性跳过**：$y_k - B_k s_k$ 远非零向量，但恰好与 $s_k$ 近乎正交。此时跳过更新会损失掉当前步的曲率信息，可能减慢收敛速度。

频繁的跳过更新会阻碍算法学习函数的新曲率信息，但在实践中，对于许多问题，这种策略仍然非常有效。

### 高级性质与收敛性

SR1 方法还有一些更深刻的理论性质，这些性质揭示了它在特定条件下强大的学习能力。

#### 对二次函数的有限终止性

对于一个 $n$ 维的正定二次函数 $f(x) = \frac{1}{2}x^\top Q x - b^\top x$，SR1 方法具有 **有限终止性**。这意味着，如果沿着一组特定的 $n$ 个方向进行更新，SR1 方法可以在至多 $n$ 步后精确地恢复出真实的海森矩阵 $Q$，即 $B_n = Q$。

这一性质的根源在于 SR1 的 **遗传特性**（hereditary property）。在特定条件下（例如，当搜索方向 $s_j$ 是 $Q$-共轭时），一次 SR1 更新不仅满足当前的[割线条件](@entry_id:164914) $B_{k+1}s_k = y_k$，还能保持所有先前的[割线条件](@entry_id:164914) $B_{k+1}s_j = y_j$ (对所有 $j  k$)。

一个更简单的例子是，当我们沿着坐标轴方向进行更新时 [@problem_id:3184203]。假设 $Q$ 是一个对角矩阵，我们从一个部分正确的近似 $B_0$ 开始，然后依次沿着[标准基向量](@entry_id:152417) $e_1, e_2, \dots, e_n$ 作为搜索方向。在每一步 $k$，如果 $B_k$ 在 $e_k$ 方向上的行为已经和 $Q$ 一致，SR1 更新会自动跳过。如果不一致，它会精确地校正第 $k$ 行和第 $k$ 列，同时由于搜索方向的正交性，它不会破坏之前已经校正好的部分。经过 $n$ 步，整个矩阵 $B_n$ 将会与 $Q$ 完全一致。

#### 对真实曲率的快速学习

SR1 对函数真实结构的捕捉能力也体现在其[特征值](@entry_id:154894)的收敛行为上。考虑一个具有负曲率的二次函数，其海森矩阵为 $H = -\gamma u u^\top$（其中 $\|u\|=1, \gamma > 0$）。如果我们从 $B_0 = 0$ 开始，并且所有后续的步长 $s_k$ 都与[负曲率](@entry_id:159335)方向 $u$ 对齐，即 $s_k = \alpha_k u$。

在第一步更新后，我们就会发现 $B_1 = -\gamma u u^\top = H$。也就是说，仅用一步，SR1 就完全学习到了真实的海森矩阵。在之后的所有迭代中，由于 $B_k s_k = H s_k = y_k$，更新将被持续跳过，但近似矩阵已经与真实Hessian矩阵完全一致 [@problem_id:3184224]。这戏剧性地展示了，当迭代信息与函数的内在结构对齐时，SR1 能够以惊人的速度收敛到真实的 Hessian。即使是从一个零矩阵开始，一次更新也能构建出一个有意义的秩一近似 [@problem_id:3184261]。

总而言之，SR1 更新以其简洁的秩一形式，提供了一种在理论上优美且在实践中（尤其对于非凸问题）富有潜力的[海森矩阵近似](@entry_id:177469)方法。它在捕捉真实曲率方面的卓越能力，是以牺牲 BFGS 等方法所具有的稳定性和正定性保证为代价的。理解并驾驭好这种平衡，是有效运用 SR1 方法的关键。