{"hands_on_practices": [{"introduction": "第一个练习将带你亲手体验 DFP 和 BFGS 公式。通过一个简单的二维示例，你将逐步计算这两个更新，从而巩固对它们的理解。这个实践对于揭开抽象公式的神秘面纱至关重要，让你能具体地看到向量 $s_k$ 和 $y_k$ 是如何塑造新的逆 Hessian 矩阵近似的。[@problem_id:3119496]", "problem": "考虑一个二次连续可微函数 $f:\\mathbb{R}^{2}\\to\\mathbb{R}$ 和一个拟牛顿迭代，该迭代维持 $f$ 的逆Hessian矩阵的对称正定近似 $H_{k}$。下一个近似 $H_{k+1}$ 需要满足拟牛顿割线条件 $H_{k+1}y_{k}=s_{k}$，并且是通过在适当的内积空间中遵循最小变化原则对 $H_{k}$ 进行二秩对称校正得到的。有两种这样的经典构造：Davidon–Fletcher–Powell (DFP) 更新和 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 更新，两者都为逆Hessian近似定义，并保证在 $s_{k}^{\\top}y_{k}0$ 时保持正定性。\n\n从基本的拟牛顿割线条件和对称性出发，推导对应于 DFP 和 BFGS 构造的两个逆Hessian更新。然后，在具体情况 $n=2$，$H_{0}=I$，$s=(1,0)^{\\top}$ 和 $y=(1,\\epsilon)^{\\top}$（其中 $\\epsilon$ 为标量且 $s^{\\top}y=10$）下，手动计算得到的更新矩阵 $H_{1}^{\\mathrm{DFP}}$ 和 $H_{1}^{\\mathrm{BFGS}}$。\n\n定义标量函数\n$$\n\\Delta(\\epsilon) \\equiv \\ln\\!\\big(\\det(H_{1}^{\\mathrm{DFP}})\\big) - \\ln\\!\\big(\\det(H_{1}^{\\mathrm{BFGS}})\\big).\n$$\n计算极限\n$$\n\\lim_{\\epsilon\\to 0} \\frac{\\Delta(\\epsilon)}{\\epsilon^{2}}.\n$$\n请将你的最终答案以单个实数形式给出。无需四舍五入。", "solution": "该问题是适定的，具有科学依据，并包含得出唯一解所需的全部必要信息。问题背景为数值优化领域，具体来说是拟牛顿法。下面我将进行求解。\n\n该问题要求推导和应用 Davidon–Fletcher–Powell (DFP) 和 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 的逆Hessian近似 $H_k$ 的更新公式。这些更新是无约束优化的拟牛顿法的核心。它们源于最小变化原则，该原则旨在寻找一个新的近似 $H_{k+1}$，使其在满足割线条件 $H_{k+1} y_k = s_k$ 的同时，在特定范数下最接近当前的近似 $H_k$。这里，$s_k = x_{k+1} - x_k$ 是变量的步长，$y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$ 是梯度的变化。\n\nDFP 对逆Hessian近似 $H_k$ 的更新由下式给出：\n$$\nH_{k+1}^{\\mathrm{DFP}} = H_k + \\frac{s_k s_k^\\top}{s_k^\\top y_k} - \\frac{H_k y_k y_k^\\top H_k}{y_k^\\top H_k y_k}\n$$\n该更新源于在与Hessian矩阵导出的几何结构相关的加权Frobenius范数下最小化 $\\|H_{k+1} - H_k\\|$。\n\nBFGS 对逆Hessian近似 $H_k$ 的更新由下式给出：\n$$\nH_{k+1}^{\\mathrm{BFGS}} = H_k + \\left(1 + \\frac{y_k^\\top H_k y_k}{s_k^\\top y_k}\\right) \\frac{s_k s_k^\\top}{s_k^\\top y_k} - \\frac{H_k y_k s_k^\\top + s_k y_k^\\top H_k}{s_k^\\top y_k}\n$$\nBFGS 更新与 DFP 更新对偶；它是通过最小化Hessian近似 $B_k = H_k^{-1}$ 的变化，然后使用 Sherman-Morrison-Woodbury 公式对结果求逆推导出来的。如果 $s_k^\\top y_k  0$，两个更新都会生成对称矩阵并保持正定性。\n\n我们给定 $k=0$ 且 $n=2$ 的具体情况：\n- 初始逆Hessian近似：$H_0 = I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$\n- 步长向量：$s \\equiv s_0 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$\n- 梯度差向量：$y \\equiv y_0 = \\begin{pmatrix} 1 \\\\ \\epsilon \\end{pmatrix}$\n\n首先，我们计算必要的标量积：\n- $s^\\top y = \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ \\epsilon \\end{pmatrix} = 1(1) + 0(\\epsilon) = 1$。条件 $s^\\top y  0$ 得到满足。\n- $H_0 y = I y = y = \\begin{pmatrix} 1 \\\\ \\epsilon \\end{pmatrix}$。\n- $y^\\top H_0 y = y^\\top (I y) = y^\\top y = \\begin{pmatrix} 1  \\epsilon \\end{pmatrix} \\begin{pmatrix} 1 \\\\ \\epsilon \\end{pmatrix} = 1^2 + \\epsilon^2 = 1 + \\epsilon^2$。\n\n接下来，我们计算必要的外积：\n- $s s^\\top = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 1  0 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix}$。\n- $H_0 y y^\\top H_0 = (H_0 y)(H_0 y)^\\top = y y^\\top = \\begin{pmatrix} 1 \\\\ \\epsilon \\end{pmatrix} \\begin{pmatrix} 1  \\epsilon \\end{pmatrix} = \\begin{pmatrix} 1  \\epsilon \\\\ \\epsilon  \\epsilon^2 \\end{pmatrix}$。\n\n现在我们通过将这些代入 DFP 公式来计算 $H_1^{\\mathrm{DFP}}$：\n$$\nH_1^{\\mathrm{DFP}} = H_0 + \\frac{s s^\\top}{s^\\top y} - \\frac{H_0 y y^\\top H_0}{y^\\top H_0 y}\n$$\n$$\nH_1^{\\mathrm{DFP}} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\frac{1}{1} \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix} - \\frac{1}{1 + \\epsilon^2} \\begin{pmatrix} 1  \\epsilon \\\\ \\epsilon  \\epsilon^2 \\end{pmatrix}\n$$\n$$\nH_1^{\\mathrm{DFP}} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} \\frac{1}{1 + \\epsilon^2}  \\frac{\\epsilon}{1 + \\epsilon^2} \\\\ \\frac{\\epsilon}{1 + \\epsilon^2}  \\frac{\\epsilon^2}{1 + \\epsilon^2} \\end{pmatrix} = \\begin{pmatrix} 2 - \\frac{1}{1 + \\epsilon^2}  -\\frac{\\epsilon}{1 + \\epsilon^2} \\\\ -\\frac{\\epsilon}{1 + \\epsilon^2}  1 - \\frac{\\epsilon^2}{1 + \\epsilon^2} \\end{pmatrix}\n$$\n$$\nH_1^{\\mathrm{DFP}} = \\begin{pmatrix} \\frac{2(1 + \\epsilon^2) - 1}{1 + \\epsilon^2}  -\\frac{\\epsilon}{1 + \\epsilon^2} \\\\ -\\frac{\\epsilon}{1 + \\epsilon^2}  \\frac{1 + \\epsilon^2 - \\epsilon^2}{1 + \\epsilon^2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1 + 2\\epsilon^2}{1 + \\epsilon^2}  -\\frac{\\epsilon}{1 + \\epsilon^2} \\\\ -\\frac{\\epsilon}{1 + \\epsilon^2}  \\frac{1}{1 + \\epsilon^2} \\end{pmatrix}\n$$\n\n接下来，我们计算 $H_1^{\\mathrm{BFGS}}$。我们需要额外的交叉项：\n- $H_0 y s^\\top = y s^\\top = \\begin{pmatrix} 1 \\\\ \\epsilon \\end{pmatrix} \\begin{pmatrix} 1  0 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ \\epsilon  0 \\end{pmatrix}$。\n- $s y^\\top H_0 = s y^\\top = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 1  \\epsilon \\end{pmatrix} = \\begin{pmatrix} 1  \\epsilon \\\\ 0  0 \\end{pmatrix}$。\n代入 BFGS 公式：\n$$\nH_1^{\\mathrm{BFGS}} = H_0 + \\left(1 + \\frac{y^\\top H_0 y}{s^\\top y}\\right) \\frac{s s^\\top}{s^\\top y} - \\frac{H_0 y s^\\top + s y^\\top H_0}{s^\\top y}\n$$\n$$\nH_1^{\\mathrm{BFGS}} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\left(1 + \\frac{1 + \\epsilon^2}{1}\\right) \\frac{1}{1} \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix} - \\frac{1}{1} \\left( \\begin{pmatrix} 1  0 \\\\ \\epsilon  0 \\end{pmatrix} + \\begin{pmatrix} 1  \\epsilon \\\\ 0  0 \\end{pmatrix} \\right)\n$$\n$$\nH_1^{\\mathrm{BFGS}} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + (2 + \\epsilon^2) \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix} - \\begin{pmatrix} 2  \\epsilon \\\\ \\epsilon  0 \\end{pmatrix}\n$$\n$$\nH_1^{\\mathrm{BFGS}} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} 2 + \\epsilon^2  0 \\\\ 0  0 \\end{pmatrix} - \\begin{pmatrix} 2  \\epsilon \\\\ \\epsilon  0 \\end{pmatrix} = \\begin{pmatrix} 1 + 2 + \\epsilon^2 - 2  0 + 0 - \\epsilon \\\\ 0 + 0 - \\epsilon  1 + 0 - 0 \\end{pmatrix}\n$$\n$$\nH_1^{\\mathrm{BFGS}} = \\begin{pmatrix} 1 + \\epsilon^2  -\\epsilon \\\\ -\\epsilon  1 \\end{pmatrix}\n$$\n\n现在我们计算这些矩阵的行列式。\n对于 $H_1^{\\mathrm{DFP}}$：\n$$\n\\det(H_1^{\\mathrm{DFP}}) = \\left(\\frac{1 + 2\\epsilon^2}{1 + \\epsilon^2}\\right) \\left(\\frac{1}{1 + \\epsilon^2}\\right) - \\left(-\\frac{\\epsilon}{1 + \\epsilon^2}\\right) \\left(-\\frac{\\epsilon}{1 + \\epsilon^2}\\right)\n$$\n$$\n\\det(H_1^{\\mathrm{DFP}}) = \\frac{1 + 2\\epsilon^2}{(1 + \\epsilon^2)^2} - \\frac{\\epsilon^2}{(1 + \\epsilon^2)^2} = \\frac{1 + 2\\epsilon^2 - \\epsilon^2}{(1 + \\epsilon^2)^2} = \\frac{1 + \\epsilon^2}{(1 + \\epsilon^2)^2} = \\frac{1}{1 + \\epsilon^2}\n$$\n对于 $H_1^{\\mathrm{BFGS}}$：\n$$\n\\det(H_1^{\\mathrm{BFGS}}) = (1 + \\epsilon^2)(1) - (-\\epsilon)(-\\epsilon) = 1 + \\epsilon^2 - \\epsilon^2 = 1\n$$\n这些结果与 DFP 和 BFGS 的一般行列式更新公式一致：\n$\\det(H_{k+1}^{\\mathrm{DFP}}) = \\det(H_k) \\frac{s_k^\\top y_k}{y_k^\\top H_k y_k}$ 和 $\\det(H_{k+1}^{\\mathrm{BFGS}}) = \\det(H_k) \\frac{s_k^\\top H_k^{-1} s_k}{s_k^\\top y_k}$。\n在我们的情况中，$\\det(H_0)=1$, $s^\\top y = 1$, $y^\\top H_0 y = 1+\\epsilon^2$, $s^\\top H_0^{-1} s = s^\\top I s = s^\\top s = 1$。\n$\\det(H_1^{\\mathrm{DFP}}) = 1 \\cdot \\frac{1}{1+\\epsilon^2} = \\frac{1}{1+\\epsilon^2}$。\n$\\det(H_1^{\\mathrm{BFGS}}) = 1 \\cdot \\frac{1}{1} = 1$。\n\n我们被要求计算当 $\\epsilon \\to 0$ 时 $\\frac{\\Delta(\\epsilon)}{\\epsilon^2}$ 的极限，其中\n$$\n\\Delta(\\epsilon) = \\ln\\big(\\det(H_1^{\\mathrm{DFP}})\\big) - \\ln\\big(\\det(H_1^{\\mathrm{BFGS}})\\big)\n$$\n代入我们的行列式结果：\n$$\n\\Delta(\\epsilon) = \\ln\\left(\\frac{1}{1 + \\epsilon^2}\\right) - \\ln(1) = -\\ln(1 + \\epsilon^2) - 0 = -\\ln(1 + \\epsilon^2)\n$$\n需要计算的极限是：\n$$\n\\lim_{\\epsilon\\to 0} \\frac{\\Delta(\\epsilon)}{\\epsilon^2} = \\lim_{\\epsilon\\to 0} \\frac{-\\ln(1 + \\epsilon^2)}{\\epsilon^2}\n$$\n这是一个 $\\frac{0}{0}$ 的不定型。我们可以使用 $\\ln(1+x)$ 在 $x=0$ 附近的泰勒级数展开来解决这个问题，即 $\\ln(1+x) = x - \\frac{x^2}{2} + O(x^3)$。\n令 $x = \\epsilon^2$，我们有：\n$$\n\\ln(1 + \\epsilon^2) = \\epsilon^2 - \\frac{(\\epsilon^2)^2}{2} + O((\\epsilon^2)^3) = \\epsilon^2 - \\frac{\\epsilon^4}{2} + O(\\epsilon^6)\n$$\n将此代入极限表达式：\n$$\n\\lim_{\\epsilon\\to 0} \\frac{-(\\epsilon^2 - \\frac{\\epsilon^4}{2} + O(\\epsilon^6))}{\\epsilon^2} = \\lim_{\\epsilon\\to 0} \\left(-1 + \\frac{\\epsilon^2}{2} - O(\\epsilon^4)\\right)\n$$\n当 $\\epsilon \\to 0$ 时，除常数项外的所有项都趋于零。\n$$\n\\lim_{\\epsilon\\to 0} \\frac{-\\ln(1 + \\epsilon^2)}{\\epsilon^2} = -1\n$$\n或者，对变量 $u = \\epsilon^2$ 应用洛必达法则 (L'Hôpital's rule)：\n$$\n\\lim_{u\\to 0^+} \\frac{-\\ln(1 + u)}{u} = \\lim_{u\\to 0^+} \\frac{-\\frac{d}{du}\\ln(1 + u)}{\\frac{d}{du}u} = \\lim_{u\\to 0^+} \\frac{-1/(1+u)}{1} = \\frac{-1}{1+0} = -1\n$$\n两种方法都得到相同的结果。", "answer": "$$\n\\boxed{-1}\n$$", "id": "3119496"}, {"introduction": "尽管 DFP 和 BFGS 方法都源于割线方程，但它们的实际表现却可能大相径庭，其中 BFGS 以其卓越的数值稳定性而著称。本练习将呈现一个精心构造的场景，旨在暴露 DFP 公式中的一个特定弱点。通过分析一个 DFP 更新变得数值不稳定的案例，你将直接洞察为何现代优化软件通常更青睐 BFGS 方法。[@problem_id:3119434]", "problem": "考虑严格凸二次函数 $f:\\mathbb{R}^{2}\\to\\mathbb{R}$ 的无约束最小化问题，该函数由 $f(x) = \\tfrac{1}{2} x^{\\top} Q x$ 定义，其中\n$$\nQ \\;=\\; \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix},\n$$\n假设我们应用一个拟牛顿法，其初始逆Hessian近似为\n$$\nH_{0} \\;=\\; \\begin{pmatrix} 1  0 \\\\ 0  10^{-8} \\end{pmatrix}.\n$$\n通过要求第一个拟牛顿搜索方向 $p_{0}$（由 $p_{0} = - H_{0} \\nabla f(x_{0})$ 给出）等于向量\n$$\nv \\;=\\; \\begin{pmatrix} -\\tfrac{1}{3} \\\\ \\tfrac{2}{3} \\end{pmatrix}.\n$$\n来隐式地定义起始点 $x_{0}$。\n取单位步长，使得 $x_{1} = x_{0} + p_{0}$，并定义位移和梯度变化为 $s_{0} = x_{1}-x_{0} = p_{0}$ 和 $y_{0} = \\nabla f(x_{1}) - \\nabla f(x_{0})$。对于这个严格凸二次函数，利用基本事实 $\\nabla f(x) = Q x$ 和 $y_{0} = Q s_{0}$。\n\n你的任务是通过关注曲率量 $y_{0}^{\\top} H_{0} y_{0}$（出现在DFP中）和 $s_{0}^{\\top} y_{0}$（出现在BFGS中），分析为什么在此设置下 Davidon-Fletcher-Powell (DFP) 更新会变得病态，而 Broyden-Fletcher-Goldfarb-Shanno (BFGS) 更新则保持良态。特别地，请计算上述构造中 DFP 关键分母 $y_{0}^{\\top} H_{0} y_{0}$ 的精确值。\n\n将你的最终答案表示为一个实数。不需要四舍五入。", "solution": "我们从二次模型的核心定义开始。对于 $f(x) = \\tfrac{1}{2} x^{\\top} Q x$（其中 $Q$ 为对称正定矩阵），梯度为 $\\nabla f(x) = Q x$。对于一个拟牛顿步，搜索方向为 $p_{0} = - H_{0} \\nabla f(x_{0})$。步长和梯度位移为 $s_{0} = x_{1} - x_{0}$ 和 $y_{0} = \\nabla f(x_{1}) - \\nabla f(x_{0})$。对于二次函数，其梯度是仿射的，因此\n$$\ny_{0} \\;=\\; \\nabla f(x_{0} + s_{0}) - \\nabla f(x_{0}) \\;=\\; Q s_{0}.\n$$\n\n根据构造，我们要求 $p_{0} = v$，其中\n$$\nv \\;=\\; \\begin{pmatrix} -\\tfrac{1}{3} \\\\ \\tfrac{2}{3} \\end{pmatrix}.\n$$\n我们还取单位步长，因此 $s_{0} = p_{0} = v$。所以，\n$$\ny_{0} \\;=\\; Q s_{0} \\;=\\; Q v \\;=\\; \n\\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n\\begin{pmatrix} -\\tfrac{1}{3} \\\\ \\tfrac{2}{3} \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix} 2\\cdot(-\\tfrac{1}{3}) + 1\\cdot(\\tfrac{2}{3}) \\\\ 1\\cdot(-\\tfrac{1}{3}) + 2\\cdot(\\tfrac{2}{3}) \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}.\n$$\n\n因此，$y_{0}$ 正是第二个坐标的单位向量。DFP 更新在其第二项的分母中使用了曲率量 $y_{0}^{\\top} H_{0} y_{0}$。我们计算\n$$\ny_{0}^{\\top} H_{0} y_{0}\n\\;=\\;\n\\begin{pmatrix} 0  1 \\end{pmatrix}\n\\begin{pmatrix} 1  0 \\\\ 0  10^{-8} \\end{pmatrix}\n\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}\n\\;=\\;\n10^{-8}.\n$$\n\n这说明了为什么 Davidon-Fletcher-Powell (DFP) 更新在数值上会变得病态：分母 $y_{0}^{\\top} H_{0} y_{0}$ 极小，因此，涉及除以 $y_{0}^{\\top} H_{0} y_{0}$ 的秩一校正项的量级将变得过大，这会使 $H_{1}$ 不稳定并可能导致停滞。相比之下，对于 Broyden-Fletcher-Goldfarb-Shanno (BFGS) 更新，相关的曲率量是 $s_{0}^{\\top} y_{0}$，此处\n$$\ns_{0}^{\\top} y_{0} \\;=\\; v^{\\top} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} \\;=\\; \\tfrac{2}{3},\n$$\n它是良态的。因此，BFGS 保持了良好的性能，而 DFP 则容易出现数值上危险的放大效应，从而提供了所期望的对比。\n\n所以，所要求的 $y_{0}^{\\top} H_{0} y_{0}$ 的精确值为 $10^{-8}$。", "answer": "$$\\boxed{1 \\times 10^{-8}}$$", "id": "3119434"}, {"introduction": "除了分母过小可能导致的数值不稳定性风险外，DFP 方法还存在其他潜在问题。本练习旨在探讨步长向量 $s_k$ 和梯度变化向量 $y_k$ 之间的几何关系如何影响 DFP 更新的质量。你将证明，即使在满足关键的曲率条件 $y_k^\\top s_k \\gt 0$ 的情况下，更新后的矩阵也可能变得接近奇异，从而可能导致优化过程停滞。[@problem_id:3119410]", "problem": "考虑拟牛顿框架内的 Davidon–Fletcher–Powell (DFP) 逆 Hessian 更新。其基本原则是：割线条件 $H_{k+1} y_k = s_k$、$H_{k+1}$ 的对称性，以及关于由 $H_k$ 导出的加权 Frobenius 范数的最小变化原则。在二维空间中进行计算。设 $H_k = I$ 为 $2 \\times 2$ 单位矩阵，设 $y_k$ 和 $s_k$ 为单位向量（即 $y_k^{\\top} y_k = 1$ 且 $s_k^{\\top} s_k = 1$），并且满足 $y_k^{\\top} s_k = \\cos(\\theta)$，其中 $\\theta \\in (0,\\pi/2)$，所有角度均以弧度为单位。从所述的拟牛顿原则（割线条件、对称性和最小变化）出发，推导 $H_{k+1}$ 的 DFP 逆 Hessian 更新公式，然后显式地计算行列式 $\\det(H_{k+1})$（用 $\\theta$ 表示）。你的最终答案必须是仅依赖于 $\\theta$ 的单个闭式表达式。这个构造应该表明，即使在 $y_k^{\\top} s_k  0$ 的情况下，DFP 也可能产生一个近乎奇异的 $H_{k+1}$。在你的推导中，请阐明分母 $y_k^{\\top} H_k y_k$ 在更新公式的减法项中所起的作用。", "solution": "该问题要求从第一性原理出发，推导 Davidon–Fletcher–Powell (DFP) 逆 Hessian 更新公式，然后在特定条件下计算所得到的更新矩阵 $H_{k+1}$ 的行列式。\n\n### 步骤 1：DFP 更新公式的推导\n\nDFP 更新是拟牛顿方法族的一员。这些方法构造一个矩阵序列 $\\{H_k\\}$ 来近似目标函数 Hessian 矩阵的逆。从 $H_k$ 到 $H_{k+1}$ 的更新必须满足某些条件。我们通过构造性地强制施加这些条件来推导 DFP 公式。\n\n基本原则是：\n1.  **对称性**：逆 Hessian 近似矩阵必须是对称的。如果 $H_k$ 是对称的，我们要求 $H_{k+1}$ 也是对称的。\n2.  **割线条件**：更新必须满足割线方程 $H_{k+1} y_k = s_k$，其中 $s_k = x_{k+1} - x_k$，$y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$。该条件由二阶导数的有限差分近似推导而来。\n3.  **最小变化**：更新后的矩阵应与前一个矩阵 $H_k$ “接近”。DFP 公式源于一种特定的秩二更新选择，该更新由第 $k$ 步可用的向量（即 $s_k$ 和 $H_k y_k$）构造而成。\n\n我们提出一个形式如下的对称秩二更新：\n$$ H_{k+1} = H_k + \\alpha u u^{\\top} + \\beta v v^{\\top} $$\n为了以构造性的方式满足“最小变化”原则，我们从问题中自然存在的向量来构建更新。$u$ 和 $v$ 最合乎逻辑的选择是 $s_k$ 和 $H_k y_k$。割线条件是 $H_{k+1}y_k=s_k$，可以重写为 $H_k y_k + (\\text{校正项})y_k = s_k$。校正项必须弥合 $H_k y_k$ 和 $s_k$ 之间的差距。因此，我们选择 $u=s_k$ 和 $v=H_k y_k$。我们提出的更新是：\n$$ H_{k+1} = H_k + \\alpha s_k s_k^{\\top} + \\beta (H_k y_k) (H_k y_k)^{\\top} $$\n如果 $H_k$ 是对称的，这种形式可以确保 $H_{k+1}$ 也是对称的。我们现在施加割线条件来求解标量系数 $\\alpha$ 和 $\\beta$。\n$$ H_{k+1} y_k = \\left( H_k + \\alpha s_k s_k^{\\top} + \\beta (H_k y_k) (H_k y_k)^{\\top} \\right) y_k = s_k $$\n利用线性和内积的性质：\n$$ H_k y_k + \\alpha s_k (s_k^{\\top} y_k) + \\beta (H_k y_k) (y_k^{\\top} H_k y_k) = s_k $$\n我们可以将包含向量 $s_k$ 和 $H_k y_k$ 的项组合在一起：\n$$ (\\alpha s_k^{\\top} y_k - 1) s_k + (1 + \\beta y_k^{\\top} H_k y_k) H_k y_k = 0 $$\n如果向量 $s_k$ 和 $H_k y_k$ 是线性无关的，则该方程成立的唯一方式是它们的标量系数都为零。\n1.  $\\alpha s_k^{\\top} y_k - 1 = 0 \\implies \\alpha = \\frac{1}{s_k^{\\top} y_k}$\n2.  $1 + \\beta y_k^{\\top} H_k y_k = 0 \\implies \\beta = -\\frac{1}{y_k^{\\top} H_k y_k}$\n\n将这些系数代回我们提出的更新公式，即可得到 DFP 公式：\n$$ H_{k+1} = H_k + \\frac{s_k s_k^{\\top}}{s_k^{\\top} y_k} - \\frac{(H_k y_k) (y_k^{\\top} H_k)}{y_k^{\\top} H_k y_k} = H_k + \\frac{s_k s_k^{\\top}}{s_k^{\\top} y_k} - \\frac{H_k y_k y_k^{\\top} H_k}{y_k^{\\top} H_k y_k} $$\n该公式要求 $s_k^{\\top} y_k  0$（曲率条件）和 $y_k^{\\top} H_k y_k  0$，如果 $H_k$ 是正定的，后者就能得到保证。\n\n### 步骤 2：应用于特定问题\n\n对于一个二维问题，我们有以下给定条件：\n- $H_k = I$，即 $2 \\times 2$ 单位矩阵。\n- $y_k$ 和 $s_k$ 是单位向量：$y_k^{\\top} y_k = 1$ 且 $s_k^{\\top} s_k = 1$。\n- 内积为 $y_k^{\\top} s_k = \\cos(\\theta)$，其中 $\\theta \\in (0, \\pi/2)$。\n\n我们将这些条件代入 DFP 公式。公式中的各项变为：\n- $s_k^{\\top} y_k = y_k^{\\top} s_k = \\cos(\\theta)$。由于 $\\theta \\in (0, \\pi/2)$，$\\cos(\\theta)  0$，满足曲率条件。\n- $H_k y_k = I y_k = y_k$。\n- $y_k^{\\top} H_k y_k = y_k^{\\top} I y_k = y_k^{\\top} y_k = 1$。\n\n问题要求阐明分母 $y_k^{\\top} H_k y_k$ 的作用。在一般的 DFP 更新中，这一项用于缩放负定秩一校正项。如果 $H_k$ 是正定的，这个分母总是正的。但是，如果 $y_k$ 与 $H_k$ 所蕴含的最速下降方向近乎正交（即 $H_k y_k$ 很小），这个分母就可能接近于零，导致数值不稳定性。在我们的特定情况下，由于 $H_k=I$，该分母简化为 $y_k^{\\top} y_k = 1$，不会引起此类问题。\n\n代入这些简化后的项，$H_{k+1}$ 的更新公式变为：\n$$ H_{k+1} = I + \\frac{s_k s_k^{\\top}}{\\cos(\\theta)} - \\frac{y_k y_k^{\\top}}{1} = I + \\frac{1}{\\cos(\\theta)} s_k s_k^{\\top} - y_k y_k^{\\top} $$\n\n### 步骤 3：行列式的计算\n\n为了计算 $\\det(H_{k+1})$，我们使用 Weinstein-Aronszajn 恒等式（也称为矩阵行列式引理），该恒等式指出，对于一个 $n \\times n$ 矩阵 $A$ 和 $n \\times k$ 矩阵 $U, V$，我们有 $\\det(A + UV^{\\top}) = \\det(A) \\det(I_k + V^{\\top}A^{-1}U)$。对于我们的情况，一个更方便的变体是 $\\det(I_n + U M U^{\\top}) = \\det(M) \\det((M^{-1} + U^{\\top}U))$ 或者当 $D$ 为对角矩阵时，$\\det(I_n+UDU^\\top) = \\det(I_k+DU^\\top U)$。\n\n我们的更新是单位矩阵的一个秩二修正。我们可以将其写为：\n$$ H_{k+1} = I + U D U^{\\top} $$\n其中 $U = \\begin{pmatrix} s_k  y_k \\end{pmatrix}$ 是一个 $2 \\times 2$ 矩阵，$D$ 是一个 $2 \\times 2$ 对角矩阵。\n我们来验证这个形式：\n$$ U D U^{\\top} = \\begin{pmatrix} s_k  y_k \\end{pmatrix} \\begin{pmatrix} d_1  0 \\\\ 0  d_2 \\end{pmatrix} \\begin{pmatrix} s_k^{\\top} \\\\ y_k^{\\top} \\end{pmatrix} = d_1 s_k s_k^{\\top} + d_2 y_k y_k^{\\top} $$\n与我们得到的 $H_{k+1}$ 表达式进行比较，可以确定 $d_1 = \\frac{1}{\\cos(\\theta)}$ 和 $d_2 = -1$。\n因此，$D = \\begin{pmatrix} \\frac{1}{\\cos(\\theta)}  0 \\\\ 0  -1 \\end{pmatrix}$。\n\n我们使用恒等式 $\\det(I_n + UDU^{\\top}) = \\det(I_k + DU^{\\top}U)$。这里，$n=2$ 且 $k=2$。我们首先计算矩阵 $U^{\\top}U$：\n$$ U^{\\top}U = \\begin{pmatrix} s_k^{\\top} \\\\ y_k^{\\top} \\end{pmatrix} \\begin{pmatrix} s_k  y_k \\end{pmatrix} = \\begin{pmatrix} s_k^{\\top}s_k  s_k^{\\top}y_k \\\\ y_k^{\\top}s_k  y_k^{\\top}y_k \\end{pmatrix} $$\n使用给定值 $s_k^{\\top}s_k = 1$、$y_k^{\\top}y_k = 1$ 和 $s_k^{\\top}y_k = \\cos(\\theta)$：\n$$ U^{\\top}U = \\begin{pmatrix} 1  \\cos(\\theta) \\\\ \\cos(\\theta)  1 \\end{pmatrix} $$\n接下来，我们计算乘积 $D(U^{\\top}U)$：\n$$ D(U^{\\top}U) = \\begin{pmatrix} \\frac{1}{\\cos(\\theta)}  0 \\\\ 0  -1 \\end{pmatrix} \\begin{pmatrix} 1  \\cos(\\theta) \\\\ \\cos(\\theta)  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{\\cos(\\theta)}  1 \\\\ -\\cos(\\theta)  -1 \\end{pmatrix} $$\n现在我们求 $I_2 + D(U^{\\top}U)$：\n$$ I_2 + D(U^{\\top}U) = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{\\cos(\\theta)}  1 \\\\ -\\cos(\\theta)  -1 \\end{pmatrix} = \\begin{pmatrix} 1 + \\frac{1}{\\cos(\\theta)}  1 \\\\ -\\cos(\\theta)  0 \\end{pmatrix} $$\n最后，我们计算这个 $2 \\times 2$ 矩阵的行列式：\n$$ \\det(H_{k+1}) = \\det(I_2 + D(U^{\\top}U)) = \\left(1 + \\frac{1}{\\cos(\\theta)}\\right)(0) - (1)(-\\cos(\\theta)) $$\n$$ \\det(H_{k+1}) = 0 + \\cos(\\theta) = \\cos(\\theta) $$\n\n### 结论\n更新后的逆 Hessian 近似矩阵的行列式为 $\\det(H_{k+1}) = \\cos(\\theta)$。\n问题要求证明，即使在 $y_k^{\\top}s_k  0$ 的情况下，这种构造也可能产生一个近乎奇异的 $H_{k+1}$。条件 $y_k^{\\top}s_k  0$ 正是 $\\cos(\\theta)  0$，这对于 $\\theta \\in (0, \\pi/2)$ 是满足的。\n如果一个矩阵的行列式为零，则该矩阵是奇异的。如果 $H_{k+1}$ 的行列式接近于零，则它是近乎奇异的。从我们的结果 $\\det(H_{k+1}) = \\cos(\\theta)$ 可以看出，当 $\\theta \\to \\pi/2$ 时，我们有 $\\cos(\\theta) \\to 0$。这意味着，如果位置变化量 $s_k$ 和梯度变化量 $y_k$ 变得近乎正交，DFP 更新会产生一个近乎奇异的逆 Hessian 近似矩阵。这是 DFP 方法的一个已知缺点，可能导致数值困难和收敛缓慢。", "answer": "$$\\boxed{\\cos(\\theta)}$$", "id": "3119410"}]}