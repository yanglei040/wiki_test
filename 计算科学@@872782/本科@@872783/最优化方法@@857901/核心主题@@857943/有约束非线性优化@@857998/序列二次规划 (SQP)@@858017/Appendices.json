{"hands_on_practices": [{"introduction": "理论是基础，但实践是掌握序列二次规划（SQP）这类迭代算法的关键。本节的第一个练习将引导你完成 SQP 的核心计算步骤。我们将解决一个几何意义直观的问题——寻找直线上离原点最近的点——以此来具体实践如何构建并求解 QP 子问题，从而确定迭代的搜索方向 [@problem_id:2201995]。", "problem": "考虑一个优化问题，寻找距离原点最近的点 $(x_1, x_2)$，该点必须满足约束条件，即位于由方程 $x_1 - x_2 + 1 = 0$ 定义的直线上。该问题可以表述为最小化到原点的欧几里得距离的平方：\n$$\n\\begin{aligned}\n\\min_{x_1, x_2} \\quad  f(x_1, x_2) = x_1^2 + x_2^2 \\\\\n\\text{s.t.} \\quad  h(x_1, x_2) = x_1 - x_2 + 1 = 0\n\\end{aligned}\n$$\n你需要执行一次序列二次规划（SQP）方法的迭代来解决此问题。从初始的非可行点 $x_0 = (1, 1)^T$ 开始，确定在第一步中计算出的搜索方向 $p_0 = (p_1, p_2)^T$。\n\n你的最终答案应为一个行矩阵，其中包含搜索方向向量的分量 $p_1$ 和 $p_2$。", "solution": "我们要最小化 $f(x_{1},x_{2})=x_{1}^{2}+x_{2}^{2}$，其等式约束为 $h(x_{1},x_{2})=x_{1}-x_{2}+1=0$。拉格朗日函数为 $L(x,\\lambda)=f(x)+\\lambda h(x)$。其关于 $x$ 的海森矩阵是 $\\nabla_{xx}^{2}L(x,\\lambda)=\\nabla^{2}f(x)+\\lambda\\nabla^{2}h(x)=2I$，因为 $h$ 是线性的。\n\n在初始点 $x_{0}=(1,1)^{T}$，我们有 $\\nabla f(x_{0})=2x_{0}=(2,2)^{T}$，$h(x_{0})=1$ 以及 $\\nabla h(x_{0})=(1,-1)^{T}$。SQP 子问题是\n$$\n\\min_{p}\\; \\frac{1}{2}p^{T}(2I)p+\\nabla f(x_{0})^{T}p\n\\quad\\text{s.t.}\\quad h(x_{0})+\\nabla h(x_{0})^{T}p=0.\n$$\n这可以简化为\n$$\n\\min_{p_{1},p_{2}}\\; p_{1}^{2}+p_{2}^{2}+2p_{1}+2p_{2}\n\\quad\\text{s.t.}\\quad p_{1}-p_{2}=-1.\n$$\n构建子问题的拉格朗日函数 $Q(p,\\mu)=p_{1}^{2}+p_{2}^{2}+2p_{1}+2p_{2}+\\mu\\,(p_{1}-p_{2}+1)$ 并设置平稳性条件：\n$$\n\\frac{\\partial Q}{\\partial p_{1}}=2p_{1}+2+\\mu=0,\\qquad\n\\frac{\\partial Q}{\\partial p_{2}}=2p_{2}+2-\\mu=0,\n$$\n以及约束条件 $p_{1}-p_{2}+1=0$。由平稳性条件可知，$\\mu=-2p_{1}-2=2p_{2}+2$，因此 $p_{1}+p_{2}=-2$。结合 $p_{1}-p_{2}=-1$ 求解，可得 $p_{1}=-\\frac{3}{2}$ 和 $p_{2}=-\\frac{1}{2}$。\n\n因此，第一步的 SQP 搜索方向为 $p_{0}=\\left(-\\frac{3}{2},-\\frac{1}{2}\\right)^T$。", "answer": "$$\\boxed{\\begin{pmatrix}-\\frac{3}{2}  -\\frac{1}{2}\\end{pmatrix}}$$", "id": "2201995"}, {"introduction": "在掌握了线性约束的基础后，我们现在来处理一个更普遍的情况：非线性约束。这个练习要求我们处理一个非线性等式约束，这将引入拉格朗日函数的二阶导数（Hessian 矩阵）。通过包含问题的曲率信息，QP 子问题能够更精确地逼近原始非线性规划，从而给出更有效的搜索步 [@problem_id:2202039]。", "problem": "考虑在等式约束 $x^2 + y^2 = 1$ 下，最大化函数 $f(x, y) = xy$ 的优化问题。\n\n您的任务是执行一次序贯二次规划 (Sequential Quadratic Programming, SQP) 方法的迭代，以找到一个改进的解。该过程从初始可行点 $(x_0, y_0) = \\left(\\frac{\\sqrt{3}}{2}, \\frac{1}{2}\\right)$ 和拉格朗日乘子的初始估计值 $\\lambda_0 = 0$ 开始。\n\n通过求解初始点处的二次子问题并取完整步长，确定下一个迭代点 $(x_1, y_1)$ 的分量。请用精确的解析表达式表示您的答案。", "solution": "问题是在约束 $h(x, y) = x^2 + y^2 - 1 = 0$ 下最大化 $f(x, y) = xy$。序贯二次规划 (Sequential Quadratic Programming, SQP) 方法通常是为最小化问题而构建的。我们可以通过最小化目标函数的相反数，将我们的最大化问题转化为一个最小化问题。令 $g(x, y) = -f(x, y) = -xy$。\n\n现在问题是：\n最小化 $g(x, y) = -xy$\n约束条件为 $h(x, y) = x^2 + y^2 - 1 = 0$。\n\n该问题的拉格朗日函数为 $\\mathcal{L}(x, y, \\lambda) = g(x, y) + \\lambda h(x, y) = -xy + \\lambda(x^2 + y^2 - 1)$。\n\nSQP 方法涉及在当前迭代点 $(x_k, y_k)$ 和乘子估计值 $\\lambda_k$ 处求解一个二次子问题，以找到搜索方向 $p = (p_x, p_y)$。该子问题是：\n最小化 $\\frac{1}{2} p^T B_k p + \\nabla g(x_k, y_k)^T p$\n约束条件为 $\\nabla h(x_k, y_k)^T p + h(x_k, y_k) = 0$。\n这里，$B_k$ 是拉格朗日函数的 Hessian 矩阵，即 $\\nabla^2_{xx} \\mathcal{L}(x_k, y_k, \\lambda_k)$。\n\n我们的起始点是 $(x_0, y_0) = \\left(\\frac{\\sqrt{3}}{2}, \\frac{1}{2}\\right)$，且 $\\lambda_0 = 0$。\n\n首先，我们计算必要的梯度和 Hessian 矩阵。\n目标函数 $g$ 的梯度是 $\\nabla g(x, y) = \\begin{pmatrix} -y \\\\ -x \\end{pmatrix}$。\n在点 $(x_0, y_0)$ 处，$\\nabla g(x_0, y_0) = \\begin{pmatrix} -1/2 \\\\ -\\sqrt{3}/2 \\end{pmatrix}$。\n\n约束函数 $h$ 的梯度是 $\\nabla h(x, y) = \\begin{pmatrix} 2x \\\\ 2y \\end{pmatrix}$。\n在点 $(x_0, y_0)$ 处，$\\nabla h(x_0, y_0) = \\begin{pmatrix} 2(\\sqrt{3}/2) \\\\ 2(1/2) \\end{pmatrix} = \\begin{pmatrix} \\sqrt{3} \\\\ 1 \\end{pmatrix}$。\n\n我们还在起始点处计算约束函数的值：$h(x_0, y_0) = (\\frac{\\sqrt{3}}{2})^2 + (\\frac{1}{2})^2 - 1 = \\frac{3}{4} + \\frac{1}{4} - 1 = 0$。由于该点是可行点，此项为零。\n\n接下来，我们计算拉格朗日函数关于 $(x, y)$ 的 Hessian 矩阵：\n$\\nabla^2_{xx} \\mathcal{L}(x, y, \\lambda) = \\begin{pmatrix} \\frac{\\partial^2 \\mathcal{L}}{\\partial x^2}  \\frac{\\partial^2 \\mathcal{L}}{\\partial x \\partial y} \\\\ \\frac{\\partial^2 \\mathcal{L}}{\\partial y \\partial x}  \\frac{\\partial^2 \\mathcal{L}}{\\partial y^2} \\end{pmatrix}$。\n$\\frac{\\partial \\mathcal{L}}{\\partial x} = -y + 2\\lambda x \\implies \\frac{\\partial^2 \\mathcal{L}}{\\partial x^2} = 2\\lambda$ 且 $\\frac{\\partial^2 \\mathcal{L}}{\\partial y \\partial x} = -1$。\n$\\frac{\\partial \\mathcal{L}}{\\partial y} = -x + 2\\lambda y \\implies \\frac{\\partial^2 \\mathcal{L}}{\\partial y^2} = 2\\lambda$。\n所以，$\\nabla^2_{xx} \\mathcal{L}(x, y, \\lambda) = \\begin{pmatrix} 2\\lambda  -1 \\\\ -1  2\\lambda \\end{pmatrix}$。\n\n我们在起始迭代点 $(x_0, y_0, \\lambda_0) = (\\frac{\\sqrt{3}}{2}, \\frac{1}{2}, 0)$ 处计算此 Hessian 矩阵：\n$B_0 = \\nabla^2_{xx} \\mathcal{L}(x_0, y_0, \\lambda_0) = \\begin{pmatrix} 2(0)  -1 \\\\ -1  2(0) \\end{pmatrix} = \\begin{pmatrix} 0  -1 \\\\ -1  0 \\end{pmatrix}$。\n\n现在，我们可以为步长 $p = (p_x, p_y)$ 构建二次子问题：\n最小化 $\\frac{1}{2} \\begin{pmatrix} p_x  p_y \\end{pmatrix} \\begin{pmatrix} 0  -1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} p_x \\\\ p_y \\end{pmatrix} + \\begin{pmatrix} -1/2  -\\sqrt{3}/2 \\end{pmatrix} \\begin{pmatrix} p_x \\\\ p_y \\end{pmatrix}$\n约束条件为 $\\begin{pmatrix} \\sqrt{3}  1 \\end{pmatrix} \\begin{pmatrix} p_x \\\\ p_y \\end{pmatrix} + 0 = 0$。\n\n这可以简化为：\n最小化 $Q(p_x, p_y) = -p_x p_y - \\frac{1}{2} p_x - \\frac{\\sqrt{3}}{2} p_y$\n约束条件为 $\\sqrt{3} p_x + p_y = 0$。\n\n我们可以通过构造其 KKT (Karush-Kuhn-Tucker) 条件来求解这个有约束的二次规划 (QP) 问题。设 $\\mu$ 是该 QP 约束的拉格朗日乘子。拉格朗日函数是 $\\mathcal{L}_{QP}(p_x, p_y, \\mu) = -p_x p_y - \\frac{1}{2} p_x - \\frac{\\sqrt{3}}{2} p_y + \\mu(\\sqrt{3} p_x + p_y)$。\nKKT 条件是：\n1. $\\frac{\\partial \\mathcal{L}_{QP}}{\\partial p_x} = -p_y - \\frac{1}{2} + \\sqrt{3}\\mu = 0$\n2. $\\frac{\\partial \\mathcal{L}_{QP}}{\\partial p_y} = -p_x - \\frac{\\sqrt{3}}{2} + \\mu = 0$\n3. $\\frac{\\partial \\mathcal{L}_{QP}}{\\partial \\mu} = \\sqrt{3} p_x + p_y = 0$\n\n从 (3) 式，我们得到 $p_y = -\\sqrt{3} p_x$。\n从 (2) 式，我们得到 $\\mu = p_x + \\frac{\\sqrt{3}}{2}$。\n将这两个表达式代入 (1) 式：\n$-(-\\sqrt{3} p_x) - \\frac{1}{2} + \\sqrt{3}\\left(p_x + \\frac{\\sqrt{3}}{2}\\right) = 0$\n$\\sqrt{3} p_x - \\frac{1}{2} + \\sqrt{3} p_x + \\frac{3}{2} = 0$\n$2\\sqrt{3} p_x + 1 = 0$\n$p_x = -\\frac{1}{2\\sqrt{3}} = -\\frac{\\sqrt{3}}{6}$。\n\n现在我们可以求出 $p_y$：\n$p_y = -\\sqrt{3} p_x = -\\sqrt{3} \\left(-\\frac{\\sqrt{3}}{6}\\right) = \\frac{3}{6} = \\frac{1}{2}$。\n\n步长为 $p = (p_x, p_y) = \\left(-\\frac{\\sqrt{3}}{6}, \\frac{1}{2}\\right)$。\n\n新的迭代点 $(x_1, y_1)$ 是通过从 $(x_0, y_0)$ 迈出完整一步得到的：\n$(x_1, y_1) = (x_0, y_0) + (p_x, p_y)$。\n$x_1 = x_0 + p_x = \\frac{\\sqrt{3}}{2} - \\frac{\\sqrt{3}}{6} = \\frac{3\\sqrt{3} - \\sqrt{3}}{6} = \\frac{2\\sqrt{3}}{6} = \\frac{\\sqrt{3}}{3}$。\n$y_1 = y_0 + p_y = \\frac{1}{2} + \\frac{1}{2} = 1$。\n\n因此，下一个迭代点是 $(x_1, y_1) = \\left(\\frac{\\sqrt{3}}{3}, 1\\right)$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{\\sqrt{3}}{3}  1 \\end{pmatrix}}$$", "id": "2202039"}, {"introduction": "SQP 算法非常强大，但并非万无一失。在理想条件下，我们假设 QP 子问题总能给出一个有效的搜索方向，但现实并非总是如此。这个练习将揭示一个重要的潜在陷阱：当原始问题的某些部分不具备“良好”的凸性时，二次近似模型可能失效，导致 QP 子问题无界 [@problem_id:2202011]。理解这种情况对于认识到实际 SQP 求解器中为何需要引入修正（如 Hessian 修正）至关重要。", "problem": "序列二次规划 (SQP) 是一种用于求解约束非线性规划 (NLP) 问题的迭代方法。在每次迭代 $k$ 中，给定当前点 $x_k$ 和一个拉格朗日乘子估计值 $\\lambda_k$，通过求解一个二次规划 (QP) 子问题来找到搜索方向 $p$。\n\n考虑以下一维非线性规划问题：\n最小化 $f(x) = -x^3$，约束条件为 $x \\ge 0$。\n\n我们来分析从可行点 $x_0 = 1$ 开始的 SQP 方法的第一步。寻找搜索方向 $p$ 的 QP 子问题被表述为：\n$$\n\\begin{align*}\n\\min_{p} \\quad  \\nabla f(x_0)^T p + \\frac{1}{2} p^T (\\nabla_{xx}^2 L(x_0, \\lambda_0)) p \\\\\n\\text{s.t.} \\quad  \\nabla c(x_0)^T p + c(x_0) \\ge 0\n\\end{align*}\n$$\n其中 $L(x, \\lambda) = f(x) - \\lambda c(x)$ 是问题 $\\min f(x)$ s.t. $c(x) \\ge 0$ 的拉格朗日函数。对于这个问题，我们使用拉格朗日函数的真实海森矩阵和初始拉格朗日乘子估计值 $\\lambda_0 = 0$。\n\n以下哪个陈述正确描述了这个 QP 子问题的解？\n\nA. QP 子问题是不可行的。\n\nB. QP 子问题在 $p = 0$ 处有唯一极小值点。\n\nC. QP 子问题是下无界的。\n\nD. QP 子问题在 $p = -0.5$ 处有唯一极小值点。\n\nE. QP 子问题在 $p = -1$ 处有唯一极小值点。", "solution": "我们将不等式约束定义为 $c(x)=x$，所以问题是 $\\min f(x)$，约束为 $c(x)\\ge 0$。拉格朗日函数为 $L(x,\\lambda)=f(x)-\\lambda c(x)$。\n\n在起始点 $x_{0}=1$ 和 $\\lambda_{0}=0$ 处，计算 QP 子问题的各个组成部分：\n- 目标梯度：$f'(x)=-3x^{2}$，因此 $\\nabla f(x_{0})=-3$。\n- 约束及其梯度：$c(x)=x$，所以 $c(x_{0})=1$ 且 $c'(x_{0})=1$。\n- 拉格朗日函数的海森矩阵：$\\nabla_{xx}^{2}L(x,\\lambda)=f''(x)-\\lambda c''(x)$。由于 $f''(x)=-6x$ 且 $c''(x)=0$，我们有 $\\nabla_{xx}^{2}L(x_{0},\\lambda_{0})=-6$。\n\n因此，关于步长方向 $p$ 的 QP 子问题是\n$$\n\\min_{p}\\;\\; \\nabla f(x_{0})\\,p+\\frac{1}{2}\\,p^{2}\\,\\nabla_{xx}^{2}L(x_{0},\\lambda_{0})\n=\\min_{p}\\;\\;(-3)p+\\frac{1}{2}(-6)p^{2}\n=\\min_{p}\\;\\; -3p-3p^{2}\n$$\n其线性化约束为\n$$\n\\nabla c(x_{0})\\,p+c(x_{0})\\ge 0 \\;\\;\\Longleftrightarrow\\;\\; p+1\\ge 0 \\;\\;\\Longleftrightarrow\\;\\; p\\ge -1.\n$$\n\n可行集是半直线 $\\{p\\in\\mathbb{R}:p\\ge -1\\}$。目标函数是一个凹二次函数 $\\phi(p)=-3p-3p^{2}$，其首项系数 $-30$。当 $p$ 在可行集内趋向于 $+\\infty$ 时，$\\phi(p)=-3p^{2}-3p\\to -\\infty$。因此，该 QP 子问题是下无界的。\n\n因此，正确的陈述是 QP 子问题是下无界的。", "answer": "$$\\boxed{C}$$", "id": "2202011"}]}