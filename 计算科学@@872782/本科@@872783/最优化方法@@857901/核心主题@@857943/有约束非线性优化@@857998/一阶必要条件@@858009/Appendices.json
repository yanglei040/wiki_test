{"hands_on_practices": [{"introduction": "我们从一个直观的几何问题开始，来掌握一阶必要条件的核心思想。想象一下，如何在一个椭圆上找到离给定点最近的点？这个练习 [@problem_id:3129605] 将引导你利用拉格朗日乘子法，从数学上证明一个深刻的几何直觉：在最优解处，连接给定点和椭圆上最近点的向量，必然与椭圆在该点的法向量平行。通过这个实践，你将把抽象的梯度对齐条件与清晰的几何图像联系起来。", "problem": "考虑一个等式约束优化问题，即最小化一个固定点到椭圆的欧几里得距离的平方。设目标函数为 $f(x_{1},x_{2}) = (x_{1}-y_{1})^{2} + (x_{2}-y_{2})^{2}$，约束条件为椭圆 $g(x_{1},x_{2}) = \\frac{x_{1}^{2}}{a^{2}} + \\frac{x_{2}^{2}}{b^{2}} - 1 = 0$，其中 $a0$ 且 $b0$。一个局部约束极小值点的物理上有意义的必要条件是，目标函数在可行方向上的一阶变分必须为零。从这一基本陈述以及 $f$ 和 $g$ 的可微性出发，推导候选极小值点 $(x_{1}^{\\star},x_{2}^{\\star})$ 及对应的拉格朗日乘子 $\\mu^{\\star}$ 所满足的一阶必要条件（拉格朗日条件），并解释为什么这些条件意味着从 $y$ 到最优点的位移向量与椭圆在 $(x_{1}^{\\star},x_{2}^{\\star})$ 处的法向量对齐。\n\n然后，将此方法应用于参数为 $a=4$，$b=3$ 且点为 $y=(9,0)$ 的具体实例，即：\n$$\n\\min_{(x_{1},x_{2})\\in\\mathbb{R}^{2}} \\;\\; (x_{1}-9)^{2} + (x_{2}-0)^{2} \\quad \\text{subject to} \\quad \\frac{x_{1}^{2}}{16} + \\frac{x_{2}^{2}}{9} = 1.\n$$\n仅使用你推导的一阶必要条件，求出距离平方的最小值。提供最终答案，形式为一个精确的数字。无需四舍五入。", "solution": "我们从等式约束优化的基本陈述开始：如果 $f:\\mathbb{R}^{n}\\to\\mathbb{R}$ 和 $g:\\mathbb{R}^{n}\\to\\mathbb{R}$ 是可微的，并且 $x^{\\star}$ 是 $f$ 在约束 $g(x)=0$ 下的一个局部极小值点，且 $\\nabla g(x^{\\star})\\neq 0$，那么 $f$ 在 $x^{\\star}$ 处沿任何可行方向的一阶变分必须为零。在 $x^{\\star}$ 处的可行方向 $d$ 满足线性化约束 $\\nabla g(x^{\\star})^{\\top} d = 0$。因此，对于每一个这样的 $d$，$f$ 在 $x^{\\star}$ 处沿 $d$ 的方向导数必须满足 $\\nabla f(x^{\\star})^{\\top} d = 0$。这意味着 $\\nabla f(x^{\\star})$ 与每一个与 $\\nabla g(x^{\\star})$ 正交的向量 $d$ 正交，从而得出经典的拉格朗日条件\n$$\n\\nabla f(x^{\\star}) + \\mu^{\\star} \\nabla g(x^{\\star}) = 0\n$$\n对于某个标量 $\\mu^{\\star}\\in\\mathbb{R}$，以及可行性条件 $g(x^{\\star})=0$。这些就是等式约束问题的一阶必要条件（拉格朗日条件）。\n\n对于我们的具体问题，$f(x_{1},x_{2}) = (x_{1}-y_{1})^{2} + (x_{2}-y_{2})^{2}$，其中 $y=(9,0)$，所以 $f(x_{1},x_{2})=(x_{1}-9)^{2}+x_{2}^{2}$。约束条件是 $g(x_{1},x_{2})=\\frac{x_{1}^{2}}{16}+\\frac{x_{2}^{2}}{9}-1=0$。梯度为\n$$\n\\nabla f(x_{1},x_{2}) = \\begin{pmatrix} 2(x_{1}-9) \\\\ 2 x_{2} \\end{pmatrix}, \\quad\n\\nabla g(x_{1},x_{2}) = \\begin{pmatrix} \\frac{2 x_{1}}{16} \\\\ \\frac{2 x_{2}}{9} \\end{pmatrix} = \\begin{pmatrix} \\frac{x_{1}}{8} \\\\ \\frac{2 x_{2}}{9} \\end{pmatrix}.\n$$\n一阶必要（拉格朗日）条件为：\n$$\n\\begin{cases}\n2(x_{1}-9) + \\mu \\cdot \\frac{x_{1}}{8} = 0, \\\\\n2 x_{2} + \\mu \\cdot \\frac{2 x_{2}}{9} = 0, \\\\\n\\frac{x_{1}^{2}}{16} + \\frac{x_{2}^{2}}{9} = 1.\n\\end{cases}\n$$\n第二个平稳性方程可以写成\n$$\n2 x_{2} \\left( 1 + \\frac{\\mu}{9} \\right) = 0,\n$$\n这意味着要么 $x_{2}=0$，要么 $\\mu = -9$。如果 $\\mu=-9$，第一个平稳性方程变为\n$$\n2(x_{1}-9) - 9 \\cdot \\frac{x_{1}}{8} = 0 \\;\\;\\Longleftrightarrow\\;\\; 16(x_{1}-9) - 9 x_{1} = 0 \\;\\;\\Longleftrightarrow\\;\\; 7 x_{1} = 144 \\;\\;\\Longleftrightarrow\\;\\; x_{1} = \\frac{144}{7}.\n$$\n这个候选点不满足约束条件，因为\n$$\n\\frac{x_{1}^{2}}{16} \\;=\\; \\frac{(144/7)^{2}}{16} \\;=\\; \\frac{20736}{49 \\cdot 16} \\;\\; 1,\n$$\n所以不存在 $\\mu=-9$ 的可行点。因此，我们必须有 $x_{2}=0$。\n\n将 $x_{2}=0$ 代入约束条件得到\n$$\n\\frac{x_{1}^{2}}{16} = 1 \\;\\;\\Longrightarrow\\;\\; x_{1} = \\pm 4.\n$$\n我们现在使用第一个平稳性方程来确定相应的拉格朗日乘子，并验证其相对于最优性的可行性。对于 $x_{1}=4$，\n$$\n2(4-9) + \\mu \\cdot \\frac{4}{8} = 0 \\;\\;\\Longleftrightarrow\\;\\; -10 + \\frac{\\mu}{2} = 0 \\;\\;\\Longleftrightarrow\\;\\; \\mu = 20.\n$$\n对于 $x_{1}=-4$，\n$$\n2(-4-9) + \\mu \\cdot \\frac{-4}{8} = 0 \\;\\;\\Longleftrightarrow\\;\\; -26 - \\frac{\\mu}{2} = 0 \\;\\;\\Longleftrightarrow\\;\\; \\mu = -52.\n$$\n两个候选点都满足平稳性和可行性条件；为了选出极小值点，我们计算目标函数的值：\n$$\nf(4,0) = (4-9)^{2} + 0^{2} = 25, \\quad f(-4,0) = (-4-9)^{2} + 0^{2} = 169.\n$$\n因此，极小值点是 $(x_{1}^{\\star},x_{2}^{\\star})=(4,0)$，最小距离平方是 $25$。\n\n几何解释（法向对齐）：平稳性条件 $\\nabla f(x^{\\star}) + \\mu^{\\star} \\nabla g(x^{\\star})=0$ 可以重写为\n$$\n2\\big(x^{\\star} - y\\big) = - \\mu^{\\star} \\nabla g(x^{\\star}),\n$$\n这表明从 $y$ 到最优点 $x^{\\star}$ 的位移向量与约束法向量 $\\nabla g(x^{\\star})$ 是共线的。这表示从 $y$ 到最近点的线段在切点处与椭圆垂直。\n\n因此，距离平方的最小值为 $25$。", "answer": "$$\\boxed{25}$$", "id": "3129605"}, {"introduction": "在理解了等式约束优化的几何直观之后，我们转向一个在数据科学和工程领域中极为常见的应用：约束最小二-乘问题。这个练习 [@problem_id:3129551] 让你将一阶必要条件应用于一个二次目标函数和线性约束的场景。你将学习如何将拉格朗日条件转化为一个结构化的增广线性系统，这是求解此类问题的标准方法，为你解决更复杂的优化模型奠定坚实的基础。", "problem": "考虑由二次目标函数 $f(x) = \\|A x - b\\|^{2}$（其中 $A \\in \\mathbb{R}^{m \\times n}$，$x \\in \\mathbb{R}^{n}$，$b \\in \\mathbb{R}^{m}$）和线性等式约束 $g(x) = \\mathbf{1}^{\\top} x - 1 = 0$（其中 $\\mathbf{1} \\in \\mathbb{R}^{n}$ 表示所有分量都为1的向量）定义的等式约束最小二乘优化问题。从可微性的基本定义和针对等式约束问题的拉格朗日乘子法出发，推导该问题的一阶必要条件（拉格朗日条件）。将这些条件表示为一个单一的、以分块矩阵形式出现的增广线性系统，该系统将平稳性条件与约束耦合在一起。\n\n然后，将具体数据\n$$\nA = \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix}, \\qquad b = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix},\n$$\n代入您得到的系统，并求解最优解 $x \\in \\mathbb{R}^{2}$ 和相关的拉格朗日乘子 $\\lambda \\in \\mathbb{R}$。请提供精确值，无需四舍五入。您的最终答案必须是以单行矩阵形式呈现的三元组 $(x_{1}, x_{2}, \\lambda)$。", "solution": "该优化问题是在线性等式约束 $g(x) = \\mathbf{1}^{\\top} x - 1 = 0$ 下最小化目标函数 $f(x) = \\|A x - b\\|^{2}$。这里，$x \\in \\mathbb{R}^{n}$，$A \\in \\mathbb{R}^{m \\times n}$，$b \\in \\mathbb{R}^{m}$，并且 $\\mathbf{1} \\in \\mathbb{R}^{n}$ 是所有分量都为1的向量。\n\n我们使用拉格朗日乘子法。拉格朗日函数 $\\mathcal{L}(x, \\lambda)$ 定义为：\n$$\n\\mathcal{L}(x, \\lambda) = f(x) + \\lambda g(x)\n$$\n其中 $\\lambda \\in \\mathbb{R}$ 是与等式约束相关的拉格朗日乘子。\n\n最优性的一阶必要条件（在等式约束的特殊情况下也称为 Karush-Kuhn-Tucker 或 KKT 条件）要求拉格朗日函数关于 $x$ 的梯度为零，并且满足原始约束。\n这些条件是：\n1. 平稳性：$\\nabla_x \\mathcal{L}(x, \\lambda) = 0$\n2. 原始可行性：$g(x) = 0$\n\n首先，我们计算目标函数 $f(x)$ 的梯度。该函数可以展开为二次型：\n$$\nf(x) = (A x - b)^{\\top}(A x - b) = (x^{\\top}A^{\\top} - b^{\\top})(A x - b) = x^{\\top}A^{\\top}A x - b^{\\top}A x - x^{\\top}A^{\\top}b + b^{\\top}b\n$$\n由于 $b^{\\top}A x$ 是一个标量，它等于其转置，即 $(b^{\\top}A x)^{\\top} = x^{\\top}A^{\\top}b$。因此，我们可以写成：\n$$\nf(x) = x^{\\top}(A^{\\top}A)x - 2b^{\\top}A x + b^{\\top}b\n$$\n$f(x)$ 关于 $x$ 的梯度是：\n$$\n\\nabla_x f(x) = \\nabla_x (x^{\\top}A^{\\top}A x) - \\nabla_x (2b^{\\top}A x) + \\nabla_x (b^{\\top}b)\n$$\n使用向量微积分的标准结果，我们有 $\\nabla_x(x^{\\top}Qx) = (Q+Q^{\\top})x$ 和 $\\nabla_x(c^{\\top}x) = c$。矩阵 $A^{\\top}A$ 是对称的，所以 $(A^{\\top}A)^{\\top} = A^{\\top}A$。梯度变为：\n$$\n\\nabla_x f(x) = 2A^{\\top}A x - 2A^{\\top}b\n$$\n接下来，我们计算约束函数 $g(x) = \\mathbf{1}^{\\top}x - 1$ 的梯度：\n$$\n\\nabla_x g(x) = \\nabla_x (\\mathbf{1}^{\\top}x - 1) = \\mathbf{1}\n$$\n现在，我们建立平稳性条件 $\\nabla_x \\mathcal{L}(x, \\lambda) = \\nabla_x f(x) + \\lambda \\nabla_x g(x) = 0$：\n$$\n2A^{\\top}A x - 2A^{\\top}b + \\lambda \\mathbf{1} = 0\n$$\n重新整理得到我们系统的第一部分：\n$$\n2A^{\\top}A x + \\lambda \\mathbf{1} = 2A^{\\top}b\n$$\n第二部分是原始可行性条件：\n$$\n\\mathbf{1}^{\\top}x - 1 = 0 \\quad \\implies \\quad \\mathbf{1}^{\\top}x = 1\n$$\n这两个方程可以组合成一个关于变量 $x \\in \\mathbb{R}^n$ 和 $\\lambda \\in \\mathbb{R}$ 的单一增广线性系统。其分块矩阵形式为：\n$$\n\\begin{pmatrix} 2A^{\\top}A  \\mathbf{1} \\\\ \\mathbf{1}^{\\top}  0 \\end{pmatrix} \\begin{pmatrix} x \\\\ \\lambda \\end{pmatrix} = \\begin{pmatrix} 2A^{\\top}b \\\\ 1 \\end{pmatrix}\n$$\n这就是给定问题的一阶必要条件的一般形式。\n\n现在，我们将所提供的数据代入此系统：\n$$\nA = \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix}, \\qquad b = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n在这种情况下，$n=2$，所以 $x = \\begin{pmatrix} x_1 \\\\ x_2 \\end{pmatrix}$ 且 $\\mathbf{1} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。我们计算分块矩阵的各个组成部分：\n矩阵 $A$ 是对称的，所以 $A^{\\top}=A$。\n$$\nA^{\\top}A = A^2 = \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} = \\begin{pmatrix} (2)(2)+(1)(1)  (2)(1)+(1)(3) \\\\ (1)(2)+(3)(1)  (1)(1)+(3)(3) \\end{pmatrix} = \\begin{pmatrix} 5  5 \\\\ 5  10 \\end{pmatrix}\n$$\n$$\n2A^{\\top}A = 2 \\begin{pmatrix} 5  5 \\\\ 5  10 \\end{pmatrix} = \\begin{pmatrix} 10  10 \\\\ 10  20 \\end{pmatrix}\n$$\n接下来，我们计算右侧的向量：\n$$\nA^{\\top}b = A b = \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} (2)(1)+(1)(2) \\\\ (1)(1)+(3)(2) \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ 7 \\end{pmatrix}\n$$\n$$\n2A^{\\top}b = 2 \\begin{pmatrix} 4 \\\\ 7 \\end{pmatrix} = \\begin{pmatrix} 8 \\\\ 14 \\end{pmatrix}\n$$\n将这些代入分块矩阵系统，得到：\n$$\n\\begin{pmatrix} 10  10  1 \\\\ 10  20  1 \\\\ 1  1  0 \\end{pmatrix} \\begin{pmatrix} x_1 \\\\ x_2 \\\\ \\lambda \\end{pmatrix} = \\begin{pmatrix} 8 \\\\ 14 \\\\ 1 \\end{pmatrix}\n$$\n这对应于以下三元线性方程组：\n1. $\\quad 10x_1 + 10x_2 + \\lambda = 8$\n2. $\\quad 10x_1 + 20x_2 + \\lambda = 14$\n3. $\\quad x_1 + x_2 = 1$\n\n从方程(3)，我们可以将 $x_1+x_2=1$ 代入方程(1)：\n$10(x_1+x_2) + \\lambda = 8 \\implies 10(1) + \\lambda = 8 \\implies \\lambda = -2$。\n\n现在我们将 $\\lambda = -2$ 代入方程(2)：\n$10x_1 + 20x_2 + (-2) = 14 \\implies 10x_1 + 20x_2 = 16$。\n两边除以2，我们得到 $5x_1 + 10x_2 = 8$。\n\n我们现在得到一个关于 $x_1$ 和 $x_2$ 的二元方程组：\na. $\\quad x_1 + x_2 = 1$\nb. $\\quad 5x_1 + 10x_2 = 8$\n\n从(a)式，我们得到 $x_1 = 1 - x_2$。将其代入(b)式：\n$5(1-x_2) + 10x_2 = 8$\n$5 - 5x_2 + 10x_2 = 8$\n$5x_2 = 3 \\implies x_2 = \\frac{3}{5}$。\n\n最后，我们求出 $x_1$：\n$x_1 = 1 - x_2 = 1 - \\frac{3}{5} = \\frac{2}{5}$。\n\n解是三元组 $(x_1, x_2, \\lambda)$。\n$x_1 = \\frac{2}{5}$\n$x_2 = \\frac{3}{5}$\n$\\lambda = -2$\n\n最优解为 $x = \\begin{pmatrix} 2/5 \\\\ 3/5 \\end{pmatrix}$，拉格朗日乘子为 $\\lambda = -2$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2}{5}  \\frac{3}{5}  -2 \\end{pmatrix}}\n$$", "id": "3129551"}]}