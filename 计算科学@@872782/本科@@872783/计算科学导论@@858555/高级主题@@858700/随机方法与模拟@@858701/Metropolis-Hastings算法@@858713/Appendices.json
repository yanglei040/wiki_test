{"hands_on_practices": [{"introduction": "掌握Metropolis-Hastings算法的第一步是理解其核心决策机制：如何决定是否接受一个新提议的状态。这个练习 [@problem_id:1343441] 旨在通过一个具体计算来建立直觉，它聚焦于最简单的情形——使用对称提议分布。在这种情况下，算法简化为最初的Metropolis算法，让你能够亲手计算接受概率，从而理解算法如何优先移动到概率更高的区域，同时仍有机会探索概率较低的区域。", "problem": "一项模拟从非负整数集合 $\\{0, 1, 2, \\dots \\}$ 中生成状态。其目标是从一个目标概率分布中进行抽样，其中处于状态 $k$ 的概率（记为 $\\pi(k)$）与 $(1/2)^k$ 成正比。\n\n该模拟使用一个在状态之间转移的马尔可夫链。在任意给定状态 $i  0$ 时，通过以 $1/2$ 的等概率选择 $j=i-1$ 或 $j=i+1$ 来提出下一个状态 $j$ 的提议。如果当前状态为 $i=0$，则总是提议转移到状态 $j=1$。从状态 $i$ 到提议状态 $j$ 的转移概率记为 $Q(j|i)$。\n\n是否接受提议的移动由梅特罗波利斯-哈斯廷斯接受概率决定。\n\n假设链当前处于状态 $X_t=3$，并提议移动到候选状态 $y=4$。计算此移动被接受的概率。请将您的答案表示为一个精确值。", "solution": "我们给定一个非负整数上的目标分布，其概率与 $(1/2)^{k}$ 成正比。将目标分布写为\n$$\n\\pi(k)=C\\left(\\frac{1}{2}\\right)^{k},\n$$\n其中 $C$ 是归一化常数（它将在梅特罗波利斯-哈斯廷斯比率中被抵消）。\n\n提议核 $Q(j\\mid i)$ 定义如下：\n- 如果 $i0$，则 $Q(i-1\\mid i)=\\frac{1}{2}$ 且 $Q(i+1\\mid i)=\\frac{1}{2}$。\n- 如果 $i=0$，则 $Q(1\\mid 0)=1$。\n\n从当前状态 $i$ 移动到提议状态 $y$ 的梅特罗波利斯-哈斯廷斯接受概率为\n$$\n\\alpha(i\\to y)=\\min\\left\\{1,\\ \\frac{\\pi(y)\\,Q(i\\mid y)}{\\pi(i)\\,Q(y\\mid i)}\\right\\}。\n$$\n\n在此，当前状态为 $i=3$，提议状态为 $y=4$。由于 $i=3$ 和 $y=4$ 都大于 $0$，我们有\n$$\nQ(4\\mid 3)=\\frac{1}{2},\\qquad Q(3\\mid 4)=\\frac{1}{2}.\n$$\n因此，\n$$\n\\frac{\\pi(4)\\,Q(3\\mid 4)}{\\pi(3)\\,Q(4\\mid 3)}\n=\\frac{C\\left(\\frac{1}{2}\\right)^{4}\\cdot \\frac{1}{2}}{C\\left(\\frac{1}{2}\\right)^{3}\\cdot \\frac{1}{2}}\n=\\frac{\\left(\\frac{1}{2}\\right)^{4}}{\\left(\\frac{1}{2}\\right)^{3}}\n=\\frac{1}{2}.\n$$\n因此，接受概率为\n$$\n\\alpha(3\\to 4)=\\min\\left\\{1,\\ \\frac{1}{2}\\right\\}=\\frac{1}{2}.\n$$", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "1343441"}, {"introduction": "在实际应用中，提议分布往往不是对称的，这意味着从状态 $i$ 提议到状态 $j$ 的概率与反向提议的概率可能不同。这个练习 [@problem_id:1962671] 在前一个的基础上更进一步，引入了非对称的提议分布。你将学习如何应用完整的Metropolis-Hastings公式，特别是计算关键的“黑斯廷斯修正项” $\\frac{q(i|j)}{q(j|i)}$，它确保了即使在提议不对称的情况下，算法依然能够正确地从目标分布中采样。", "problem": "一个计算模拟使用梅特罗波利斯-哈斯廷斯算法来探索一种蛋白质的构象状态。该模型将蛋白质的结构简化为三种可能的离散状态：状态1、状态2和状态3。模拟的目标是从一个目标平稳分布 $\\pi$ 中生成样本，该分布代表了在每种状态下发现该蛋白质的平衡概率。这个目标分布由下式给出：\n$\\pi(\\text{State 1}) = 0.1$\n$\\pi(\\text{State 2}) = 0.3$\n$\\pi(\\text{State 3}) = 0.6$\n\n该算法通过根据一个提议分布 $q(j|i)$ 提议从当前状态 $i$ 到新状态 $j$ 的转移来进行。提议机制定义如下：\n- 从状态1，提议向状态2转移的概率为 $0.2$，提议向状态3转移的概率为 $0.8$。\n- 从状态2，提议向状态1转移的概率为 $0.5$，提议向状态3转移的概率为 $0.5$。\n- 从状态3，提议向状态1转移的概率为 $0.1$，提议向状态2转移的概率为 $0.9$。\n\n假设模拟当前处于状态1，并且提议了一个向状态3的转移。计算这个特定转移的接受概率。将最终答案表示为一个最简分数。", "solution": "在梅特罗波利斯-哈斯廷斯算法中，从当前状态 $i$ 提议转移到新状态 $j$ 的接受概率为\n$$\n\\alpha_{i \\to j} = \\min\\left(1, \\frac{\\pi(j)\\,q(i \\mid j)}{\\pi(i)\\,q(j \\mid i)}\\right).\n$$\n对于从状态1到状态3的提议转移，我们使用给定的目标概率和提议概率。将给定的小数转换为精确分数，\n$$\n\\pi(\\text{State 3}) = \\frac{3}{5}, \\quad \\pi(\\text{State 1}) = \\frac{1}{10}, \\quad q(3 \\mid 1) = \\frac{4}{5}, \\quad q(1 \\mid 3) = \\frac{1}{10}.\n$$\n代入接受率公式中：\n$$\n\\frac{\\pi(3)\\,q(1 \\mid 3)}{\\pi(1)\\,q(3 \\mid 1)} = \\frac{\\left(\\frac{3}{5}\\right)\\left(\\frac{1}{10}\\right)}{\\left(\\frac{1}{10}\\right)\\left(\\frac{4}{5}\\right)} = \\frac{\\frac{3}{50}}{\\frac{4}{50}} = \\frac{3}{4}.\n$$\n因此，\n$$\n\\alpha_{1 \\to 3} = \\min\\left(1, \\frac{3}{4}\\right) = \\frac{3}{4}.\n$$", "answer": "$$\\boxed{\\frac{3}{4}}$$", "id": "1962671"}, {"introduction": "计算接受率是基础，但理解算法在实际场景中的行为同样至关重要。这个思想实验 [@problem_id:1962668] 提出了一个MCMC方法中的经典难题：当目标分布存在多个峰值（即多峰性）时，采样器可能会遇到什么问题。通过分析这个场景，你将锻炼诊断采样器性能的批判性思维，理解提议分布的选择（如此处的步长）如何深刻影响算法探索整个参数空间的能力，并认识到高接受率并不总是等同于好的采样效果。", "problem": "一位数据科学家正在分析一个复杂气候模型中参数 $\\theta$ 的后验概率分布。分析显示，记为 $p(\\theta)$ 的后验分布是双峰的，在 $\\theta_A$ 和 $\\theta_B$ 处有两个明显的高概率峰，它们之间被一个很宽的极低概率区域隔开。为了探索这个分布并估计后验均值等性质，该科学家采用了Metropolis-Hastings (M-H) 算法。\n\nM-H采样器以位于第一个峰 $\\theta_A$ 附近的高概率区域内的初始值 $\\theta_0$ 进行初始化。使用了一个对称提议分布 $q(\\theta' | \\theta) = \\mathcal{N}(\\theta' | \\theta, \\sigma^2)$，其中 $\\mathcal{N}$ 是一个以当前状态 $\\theta$ 为中心、标准差为 $\\sigma$ 的正态分布，$\\sigma$ 代表提议步长。为了获得高接受率，该科学家为 $\\sigma$ 选择了一个相对于两个峰之间距离 $|\\theta_A - \\theta_B|$ 非常小的值。\n\n在运行M-H采样器非常多次迭代后，下列哪个描述最准确地刻画了这次模拟的预期结果？\n\nA. 采样器将高效地找到后验分布 $p(\\theta)$ 的全局最大值并停留在那里，从而为参数提供一个极好的点估计。\n\nB. 提议状态的接受率将非常低，导致链停留在初始状态 $\\theta_0$ 附近，几乎不探索参数空间。\n\nC. 生成的样本链将高度自相关，其直方图将主要呈现 $\\theta_A$ 附近峰的形状，而无法发现 $\\theta_B$ 附近的峰。\n\nD. 样本将在两个峰之间系统地交替，以规律的频率从 $\\theta_A$ 区域跳到 $\\theta_B$ 区域，然后再跳回来。\n\nE. 链的状态将几乎相互独立，表明采样器已成功收敛到真实的双峰后验分布。", "solution": "我们分析使用对称提议和相对于后验分布 $p(\\theta)$ 在 $\\theta_{A}$ 和 $\\theta_{B}$ 处的两个分离峰之间距离非常小的提议尺度的 Metropolis-Hastings (M-H) 采样器。\n\n对于对称提议 $q(\\theta' \\mid \\theta) = \\mathcal{N}(\\theta' \\mid \\theta, \\sigma^{2})$，Metropolis-Hastings 接受概率为\n$$\na(\\theta \\rightarrow \\theta') = \\min\\left\\{1, \\frac{p(\\theta')}{p(\\theta)}\\right\\}。\n$$\n链在 $\\theta_{A}$ 附近的高概率区域以 $\\theta_{0}$ 初始化。因为选择的 $\\sigma$ 相对于分离距离 $|\\theta_{A} - \\theta_{B}|$ 非常小，所以提议的移动满足 $|\\theta' - \\theta| = O(\\sigma)$，因此会保持在离当前状态非常近的位置。在一个峰附近的高概率区域，对于小步长，$p(\\theta')$ 接近 $p(\\theta)$，因此\n$$\n\\frac{p(\\theta')}{p(\\theta)} \\approx 1,\n$$\n意味着 $a(\\theta \\rightarrow \\theta') \\approx 1$ 并且局部接受率很高。因此，选项 B（非常低的接受率）与小步长、峰内行为相矛盾。\n\n接下来，考虑峰之间的转换。在当前状态接近 $\\theta_{A}$ 时，根据高斯提议直接提议一个接近 $\\theta_{B}$ 的状态的概率是\n$$\nq(\\theta_{B} \\mid \\theta) \\propto \\exp\\left(-\\frac{|\\theta_{B} - \\theta|^{2}}{2 \\sigma^{2}}\\right)。\n$$\n由于 $\\sigma \\ll |\\theta_{A} - \\theta_{B}|$，这个提议概率在 $|\\theta_{A} - \\theta_{B}|^{2} / \\sigma^{2}$ 上是指数级小的。因此，在实际的时间尺度上，基本上永远不会提议直接跳过低概率谷底。或者，通过许多小步穿越谷底需要反复提议移动到 $p(\\theta') \\ll p(\\theta)$ 的区域，对于这种情况\n$$\na(\\theta \\rightarrow \\theta') = \\min\\left\\{1, \\frac{p(\\theta')}{p(\\theta)}\\right\\} \\ll 1,\n$$\n所以这样的步骤绝大多数会被拒绝。因此，链实际上会在 $\\theta_{A}$ 附近被困住很长时间，在实践中无法发现 $\\theta_{B}$。\n\n因为移动非常局部化，且链停留在同一个峰内，所以连续的样本是高度自相关的。因此，经验直方图反映了 $\\theta_{A}$ 周围的局部形状，但没有捕捉到 $\\theta_{B}$ 附近的分离峰。这排除了选项 E（独立性和成功收敛）和选项 D（在峰之间规律交替）。选项 A 是不正确的，因为 M-H 是一个以 $p(\\theta)$ 为目标的采样器，而不是一个优化器；此外，由于步长小和双峰性，它既不能高效地找到全局最大值，也不能停留在那里。\n\n因此，最准确的描述是，链表现出高度自相关，主要在 $\\theta_{A}$ 的邻域内采样，并且未能发现第二个峰 $\\theta_{B}$。\n\n正确选项是 C。", "answer": "$$\\boxed{C}$$", "id": "1962668"}]}