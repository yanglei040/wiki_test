{"hands_on_practices": [{"introduction": "理解蒙特卡洛积分的最好方法莫过于亲手实践。这个练习将带你应用蒙特卡洛方法的核心思想来解决一个多维积分问题。通过一个材料科学中的假设场景，你将估算在一个不规则区域内某种物质的总质量，这正是蒙特卡洛方法能够大放异彩的典型应用，因为它能以惊人的简洁性处理复杂的积分边界。[@problem_id:1376816]", "problem": "一位材料科学家正在研究一种在边长为1米的立方体模具中制造的新合金。坐标系与模具对齐，使其占据由 $0 \\le x \\le 1$，$0 \\le y \\le 1$ 和 $0 \\le z \\le 1$ 定义的区域。一种特殊硬化剂的浓度 $C$ 被发现在模具中仅在一个由不等式 $0 \\le z \\le y \\le x \\le 1$ 定义的特定子区域内非零。在此子区域内，点 $(x,y,z)$ 处的浓度由函数 $C(x,y,z) = k x y z$ 描述，其中 $k$ 是一个常数。在此区域外，浓度为零。模具中硬化剂的总质量由浓度函数在整个1米立方体模具体积上的积分给出。\n\n为了估算这个总质量，一个自动化测量系统在一组 $N=5$ 个样本点上探测浓度，这些样本点被假定为单位立方体内均匀随机抽样的代表。这五个点的坐标是：\n$P_1 = (0.8, 0.7, 0.2)$\n$P_2 = (0.9, 0.5, 0.6)$\n$P_3 = (0.6, 0.8, 0.3)$\n$P_4 = (0.5, 0.4, 0.3)$\n$P_5 = (0.7, 0.9, 0.8)$\n\n给定浓度常数 $k = 4.8 \\text{ kg/m}^6$，根据这五个样本点的数据，计算模具中硬化剂总质量的数值估计。答案以千克（kg）为单位，并四舍五入到三位有效数字。", "solution": "总质量是浓度在单位立方体上的体积积分：\n$$\nM=\\iiint_{[0,1]^{3}} C(x,y,z)\\,dV.\n$$\n在体积为 $V=1$ 的区域上进行均匀随机抽样，使用 $N$ 个样本 $\\{P_{i}\\}_{i=1}^{N}$ 的蒙特卡洛估计量是\n$$\n\\widehat{M}=\\frac{V}{N}\\sum_{i=1}^{N} C(P_{i})=\\frac{1}{N}\\sum_{i=1}^{N} C(P_{i}).\n$$\n这里，如果 $0 \\le z \\le y \\le x \\le 1$，则 $C(x,y,z)=k\\,x y z$，否则 $C=0$。对每个样本评估条件 $0 \\le z \\le y \\le x \\le 1$：\n- $P_{1}=(0.8,0.7,0.2)$：$0.2 \\le 0.7 \\le 0.8$ 为真，贡献为 $k\\cdot 0.8\\cdot 0.7\\cdot 0.2=0.112\\,k$。\n- $P_{2}=(0.9,0.5,0.6)$：$0.6 \\le 0.5$ 为假，贡献为 $0$。\n- $P_{3}=(0.6,0.8,0.3)$：$0.8 \\le 0.6$ 为假，贡献为 $0$。\n- $P_{4}=(0.5,0.4,0.3)$：$0.3 \\le 0.4 \\le 0.5$ 为真，贡献为 $k\\cdot 0.5\\cdot 0.4\\cdot 0.3=0.06\\,k$。\n- $P_{5}=(0.7,0.9,0.8)$：$0.9 \\le 0.7$ 为假，贡献为 $0$。\n因此\n$$\n\\sum_{i=1}^{5} C(P_{i})=(0.112+0.06)\\,k=0.172\\,k,\n$$\n于是\n$$\n\\widehat{M}=\\frac{1}{5}\\cdot 0.172\\,k=0.0344\\,k.\n$$\n代入 $k=4.8$ 得\n$$\n\\widehat{M}=0.0344\\times 4.8=0.16512,\n$$\n四舍五入到三位有效数字后，结果为 $0.165$ 千克。", "answer": "$$\\boxed{0.165}$$", "id": "1376816"}, {"introduction": "虽然基础蒙特卡洛方法十分强大，但其收敛速度可能较慢，这意味着需要大量的样本才能达到理想的精度。本练习将向你介绍一种关键的方差缩减技术——控制变量法，它能显著提高估计的效率。你将学习如何巧妙地利用被积函数的泰勒展开来构造一个有效的控制变量，并定量计算出这种方法带来的精度提升。[@problem_id:1376819]", "problem": "一位计算科学家旨在使用蒙特卡罗方法估计积分 $I = \\int_0^1 \\exp(x^2) dx$ 的值。标准方法包括从 $[0, 1]$ 上的均匀分布中生成 $N$ 个独立的随机数 $X_1, \\dots, X_N$，并计算样本均值 $\\hat{I} = \\frac{1}{N} \\sum_{i=1}^N \\exp(X_i^2)$。这个单样本估计量的方差是 $\\text{Var}(\\exp(X^2))$，其中 $X \\sim U(0,1)$。\n\n为了在给定样本量的情况下提高估计的精度，采用了控制变量技术。选择一个函数 $g(x)$，它与 $f(x) = \\exp(x^2)$ 高度相关，并且其在 $[0, 1]$ 上的积分是解析已知的。所选的控制变量是 $g(x) = 1 + x^2 + \\frac{1}{2}x^4$，其灵感来自于 $f(x)$ 的泰勒展开。\n\n新的估计量由随机变量 $Y_c = f(X) - c(g(X) - \\mu_g)$ 构成，其中 $\\mu_g = \\int_0^1 g(x) dx$，而 $c$ 是一个常数。通过选择一个最优常数 $c = c^*$，可以使这个新估计量的方差 $\\text{Var}(Y_c)$ 最小化。\n\n你的任务是计算使用该最优控制变量所能达到的理论方差缩减因子。该因子定义为标准蒙特卡罗估计量的方差与优化后的控制变量估计量的方差之比，即 $\\frac{\\text{Var}(f(X))}{\\text{Var}(Y_{c^*})}$。\n\n在你的计算中，请使用以下数值：\n- 数学常数 $e \\approx 2.71828$。\n- $\\int_0^1 \\exp(x^2) dx \\approx 1.46265$。\n- $\\int_0^1 \\exp(2x^2) dx \\approx 3.01552$。\n\n将你的最终答案表示为单个数值，并四舍五入到三位有效数字。", "solution": "我们要求解在使用最优控制变量估计 $I=\\int_{0}^{1} f(x)\\,dx$ 时的方差缩减因子，其中 $f(x)=\\exp(x^{2})$ 和 $g(x)=1+x^{2}+\\frac{1}{2}x^{4}$。对于一个控制变量估计量 $Y_{c}=f(X)-c\\left(g(X)-\\mu_{g}\\right)$，其中 $X\\sim U(0,1)$ 且 $\\mu_{g}=\\int_{0}^{1}g(x)\\,dx$，其方差在以下位置最小化：\n$$\nc^{*}=\\frac{\\operatorname{Cov}(f,g)}{\\operatorname{Var}(g)},\n$$\n最小化的方差为\n$$\n\\operatorname{Var}(Y_{c^{*}})=\\operatorname{Var}(f)-\\frac{\\operatorname{Cov}(f,g)^{2}}{\\operatorname{Var}(g)}=\\operatorname{Var}(f)\\left(1-\\rho^{2}\\right),\n$$\n其中 $\\rho$ 是 $f(X)$ 和 $g(X)$ 之间的相关系数。因此，方差缩减因子为\n$$\n\\frac{\\operatorname{Var}(f(X))}{\\operatorname{Var}(Y_{c^{*}})}=\\frac{1}{1-\\rho^{2}}.\n$$\n\n我们现在计算所需的矩。首先，$\\mu_{g}$ 是\n$$\n\\mu_{g}=\\int_{0}^{1}\\left(1+x^{2}+\\frac{1}{2}x^{4}\\right)\\,dx=1+\\frac{1}{3}+\\frac{1}{10}=\\frac{43}{30}.\n$$\n接下来，\n$$\n\\operatorname{E}[g(X)^{2}]=\\int_{0}^{1}\\left(1+2x^{2}+2x^{4}+x^{6}+\\frac{1}{4}x^{8}\\right)\\,dx=1+\\frac{2}{3}+\\frac{2}{5}+\\frac{1}{7}+\\frac{1}{36}=\\frac{2819}{1260},\n$$\n所以\n$$\n\\operatorname{Var}(g)=\\operatorname{E}[g^{2}]-\\mu_{g}^{2}=\\frac{2819}{1260}-\\left(\\frac{43}{30}\\right)^{2}=\\frac{32}{175}.\n$$\n\n对于 $f$，使用给定的值，\n$$\n\\operatorname{E}[f]=\\int_{0}^{1}\\exp(x^{2})\\,dx\\approx 1.46265,\\qquad \\operatorname{E}[f^{2}]=\\int_{0}^{1}\\exp(2x^{2})\\,dx\\approx 3.01552,\n$$\n因此\n$$\n\\operatorname{Var}(f)=\\operatorname{E}[f^{2}]-\\operatorname{E}[f]^{2}\\approx 3.01552-(1.46265)^{2}\\approx 0.8761749775.\n$$\n\n为了计算 $\\operatorname{E}[f\\,g]$，定义 $I_{n}=\\int_{0}^{1}x^{2n}\\exp(x^{2})\\,dx$。使用分部积分法，令 $u=x^{2n-1}$ 和 $dv=x\\exp(x^{2})\\,dx$，得到递推关系\n$$\nI_{n}=\\frac{1}{2}\\exp(1)-\\frac{2n-1}{2}I_{n-1},\\quad I_{0}=\\int_{0}^{1}\\exp(x^{2})\\,dx.\n$$\n使用 $\\exp(1)\\approx 2.71828$ 和 $I_{0}\\approx 1.46265$，我们得到\n$$\nI_{1}=\\frac{1}{2}\\exp(1)-\\frac{1}{2}I_{0}\\approx 0.627815,\\qquad\nI_{2}=\\frac{1}{2}\\exp(1)-\\frac{3}{2}I_{1}\\approx 0.4174175.\n$$\n因此，\n$$\n\\operatorname{E}[f\\,g]=I_{0}+I_{1}+\\frac{1}{2}I_{2}\\approx 1.46265+0.627815+0.20870875\\approx 2.29917375.\n$$\n然后\n$$\n\\operatorname{Cov}(f,g)=\\operatorname{E}[f\\,g]-\\operatorname{E}[f]\\operatorname{E}[g]\\approx 2.29917375-1.46265\\cdot\\frac{43}{30}\\approx 0.20270875,\n$$\n并且\n$$\n\\rho^{2}=\\frac{\\operatorname{Cov}(f,g)^{2}}{\\operatorname{Var}(f)\\operatorname{Var}(g)}\\approx \\frac{(0.20270875)^{2}}{0.8761749775\\cdot\\frac{32}{175}}\\approx 0.256473333.\n$$\n因此方差缩减因子为\n$$\n\\frac{1}{1-\\rho^{2}}\\approx \\frac{1}{1-0.256473333}\\approx 1.34494.\n$$\n四舍五入到三位有效数字，结果是 $1.34$。", "answer": "$$\\boxed{1.34}$$", "id": "1376819"}, {"introduction": "在风险分析、金融工程和物理学等许多领域，估计稀有事件的概率是一个核心挑战。标准蒙特卡洛方法在这种情况下效率极低，因为绝大多数样本都落在我们不感兴趣的“平常”区域。本练习将引导你使用一种更高级的技术——重要性抽样，来解决这个问题。你将学习如何设计一个“倾向于”产生稀有事件的抽样分布，并用重要性权重来修正估计值，从而高效地估算一个高维空间中的微小概率。[@problem_id:1376872]", "problem": "在许多领域，例如通信系统建模或风险分析，估计稀有事件的概率是必要的。考虑一个系统，其状态由一个包含10个独立同分布随机变量的向量 $Z = (Z_1, Z_2, \\dots, Z_{10})$ 描述，每个随机变量都服从标准正态分布 $Z_i \\sim \\mathcal{N}(0,1)$。当此状态向量的L2范数平方 $\\|Z\\|^2 = \\sum_{i=1}^{10} Z_i^2$ 超过临界阈值 $c=60$ 时，定义为发生失效事件。该事件的概率 $P = P(\\|Z\\|^2  60)$ 极小，难以使用标准的蒙特卡洛方法进行估计。\n\n为了获得更高效的估计，我们将采用重要性采样。我们将从一个建议分布 $q(x)$ 中抽取样本 $X = (X_1, X_2, \\dots, X_{10})$，而不是从原始分布 $p(z)$ 中抽取。所选择的建议分布是一个多元正态分布，其分量是独立同分布的，$X_i \\sim \\mathcal{N}(0, \\sigma^2)$，其方差 $\\sigma^2$ 有待确定。\n\n您的任务是计算概率 $P$ 的重要性采样估计值。首先，确定建议分布的方差 $\\sigma^2$ 的适当值。对此选择，一个常见且有效的启发式方法是，将我们关心的量（在此例中为 $\\|X\\|^2$）在建议分布下的期望值设置为阈值 $c$。\n\n确定 $\\sigma^2$ 后，使用一个预先计算好的模拟结果。在一个数值实验中，使用您所确定的 $\\sigma^2$ 值，从建议分布 $q(x)$ 中总共抽取了 $N = 5.0 \\times 10^5$ 个样本。对于这组样本，计算了重要性权重的总和，但仅限于满足稀有事件条件 $\\|X\\|^2  60$ 的样本，结果为 0.617。\n\n基于这些信息，计算概率 $P$ 的数值估计。您的最终答案请用科学记数法表示，并四舍五入到三位有效数字。", "solution": "问题要求基于重要性采样来估计概率 $P = P(\\sum_{i=1}^{10} Z_i^2  60)$，其中 $Z_i \\sim \\mathcal{N}(0,1)$ 是独立的随机变量。\n\n这个概率可以写成一个期望值：\n$$P = E_p\\left[\\mathbb{I}\\left(\\sum_{i=1}^{10} Z_i^2  60\\right)\\right]$$\n其中 $\\mathbb{I}(\\cdot)$ 是指示函数，$E_p[\\cdot]$ 表示关于原始概率分布 $p(z) = \\prod_{i=1}^{10} \\frac{1}{\\sqrt{2\\pi}} \\exp(-z_i^2/2)$ 的期望。\n\n在重要性采样中，我们将此期望重写为关于建议分布 $q(x)$ 的形式：\n$$P = E_q\\left[\\mathbb{I}\\left(\\sum_{i=1}^{10} X_i^2  60\\right) \\frac{p(X)}{q(X)}\\right]$$\n其中 $X \\sim q(x)$。项 $w(X) = p(X)/q(X)$ 是重要性权重。使用从 $q(x)$ 中抽取的 $N$ 个样本 $\\{X^{(j)}\\}_{j=1}^N$ 对 $P$ 进行的蒙特卡洛估计由下式给出：\n$$\\hat{P}_N = \\frac{1}{N} \\sum_{j=1}^N \\mathbb{I}\\left(\\|X^{(j)}\\|^2  60\\right) w(X^{(j)})$$\n\n第一步是确定建议分布 $q(x) = \\prod_{i=1}^{10} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp(-x_i^2/(2\\sigma^2))$ 的方差 $\\sigma^2$。问题中陈述的启发式方法是设置 $E_q[\\|X\\|^2] = 60$。\n\n对于单个分量 $X_i \\sim \\mathcal{N}(0, \\sigma^2)$，其期望为 $E_q[X_i] = 0$，方差为 $\\text{Var}_q(X_i) = \\sigma^2$。其平方的期望为 $E_q[X_i^2] = \\text{Var}_q(X_i) + (E_q[X_i])^2 = \\sigma^2 + 0^2 = \\sigma^2$。\n\n根据期望的线性性质，平方和的期望为：\n$$E_q[\\|X\\|^2] = E_q\\left[\\sum_{i=1}^{10} X_i^2\\right] = \\sum_{i=1}^{10} E_q[X_i^2] = 10 \\sigma^2$$\n应用启发式方法，我们将其设置为阈值 $c=60$：\n$$10 \\sigma^2 = 60 \\implies \\sigma^2 = 6$$\n\n第二步是找出重要性权重函数 $w(x) = p(x)/q(x)$ 的表达式。\n$$p(x) = \\prod_{i=1}^{10} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x_i^2}{2}\\right) = (2\\pi)^{-5} \\exp\\left(-\\frac{1}{2}\\sum_{i=1}^{10} x_i^2\\right) = (2\\pi)^{-5} \\exp\\left(-\\frac{\\|x\\|^2}{2}\\right)$$\n$$q(x) = \\prod_{i=1}^{10} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{x_i^2}{2\\sigma^2}\\right) = (2\\pi\\sigma^2)^{-5} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum_{i=1}^{10} x_i^2\\right) = (2pi\\sigma^2)^{-5} \\exp\\left(-\\frac{\\|x\\|^2}{2\\sigma^2}\\right)$$\n\n其比值为：\n$$w(x) = \\frac{p(x)}{q(x)} = \\frac{(2\\pi)^{-5}}{(2\\pi\\sigma^2)^{-5}} \\frac{\\exp(-\\|x\\|^2/2)}{\\exp(-\\|x\\|^2/(2\\sigma^2))} = (\\sigma^2)^5 \\exp\\left(-\\frac{\\|x\\|^2}{2} + \\frac{\\|x\\|^2}{2\\sigma^2}\\right)$$\n$$w(x) = (\\sigma^2)^5 \\exp\\left(-\\frac{\\|x\\|^2}{2} \\left(1 - \\frac{1}{\\sigma^2}\\right)\\right)$$\n代入 $\\sigma^2 = 6$：\n$$w(x) = 6^5 \\exp\\left(-\\frac{\\|x\\|^2}{2} \\left(1 - \\frac{1}{6}\\right)\\right) = 7776 \\exp\\left(-\\frac{5}{12}\\|x\\|^2\\right)$$\n\n第三步是使用提供的模拟数据来计算估计值。估计量为：\n$$\\hat{P}_N = \\frac{1}{N} \\sum_{j=1}^N \\mathbb{I}(\\|X^{(j)}\\|^2  60) w(X^{(j)})$$\n求和是对所有 $N$ 个样本进行的，但对于任何不满足条件 $\\|X^{(j)}\\|^2  60$ 的样本，指示函数 $\\mathbb{I}(\\cdot)$ 的值为零。因此，该求和等价于只对那些落入稀有事件区域的样本的权重进行求和。\n问题中说明，这个和是给定的：\n$$\\sum_{j \\text{ s.t. } \\|X^{(j)}\\|^2  60} w(X^{(j)}) = 0.617$$\n这是估计量中分子的值，即对所有样本求和的结果：\n$$\\sum_{j=1}^N \\mathbb{I}(\\|X^{(j)}\\|^2  60) w(X^{(j)}) = 0.617$$\n\n样本总数为 $N = 5.0 \\times 10^5$。将这些值代入估计量公式：\n$$\\hat{P}_N = \\frac{0.617}{5.0 \\times 10^5}$$\n\n最后，我们计算数值：\n$$\\hat{P}_N = \\frac{0.617}{500000} = 0.000001234 = 1.234 \\times 10^{-6}$$\n四舍五入到三位有效数字，我们得到 $1.23 \\times 10^{-6}$。", "answer": "$$\\boxed{1.23 \\times 10^{-6}}$$", "id": "1376872"}]}