{"hands_on_practices": [{"introduction": "在蒙特卡洛模拟中，一个常见的挑战是如何用有限的计算资源获得尽可能精确的估计。控制变量法提供了一种优雅的解决方案：利用一个与我们目标估计量相关且期望已知的辅助随机变量来降低方差。这个练习将带你亲手实践控制变量法的核心步骤[@problem_id:1348989]，通过计算最优系数来最小化新估计量的方差，并量化方差缩减的效果，从而让你深入理解该技术如何有效地提升模拟效率。", "problem": "一位分析师试图估计 $\\theta = \\mathbb{E}[(U+1)^2]$ 的值，其中 $U$ 是在区间 $[0, 1]$ 上均匀分布的随机变量。标准方法是使用简单的蒙特卡洛估计量，即生成 $X = (U+1)^2$ 的样本并对其求平均。该估计量的精度由单个样本的方差 $\\operatorname{Var}(X)$ 决定。\n\n为了提高估计效率，提出了一种控制变量技术。使用一个期望值已知的相关随机变量 $C = U$ 来构造一个新的估计量。单个样本的新估计量由 $X(b) = X - b(C - \\mathbb{E}[C])$ 给出，其中 $b$ 是一个待优化的实值常数系数。\n\n你的任务是确定该技术所带来的理论改进。首先，找到使新估计量方差 $\\operatorname{Var}(X(b))$ 最小化的最优系数 $b^*$。然后，计算方差缩减因子，即单个优化后的控制变量样本的方差与单个简单样本方差之比。\n\n将此方差缩减因子 $\\frac{\\operatorname{Var}(X(b^*))}{\\operatorname{Var}(X)}$ 表示为精确分数。", "solution": "设 $U \\sim \\text{Unif}[0,1]$，$X=(U+1)^{2}$ 且 $C=U$。对于 $k \\geq 0$，$\\mathbb{E}[U^{k}]=\\frac{1}{k+1}$。因此 $\\mathbb{E}[U]=\\frac{1}{2}$，$\\mathbb{E}[U^{2}]=\\frac{1}{3}$，$\\mathbb{E}[U^{3}]=\\frac{1}{4}$，$\\mathbb{E}[U^{4}]=\\frac{1}{5}$，且 $\\operatorname{Var}(U)=\\frac{1}{12}$。\n\n将 $X$ 展开为 $X=U^{2}+2U+1$。那么\n$$\n\\mathbb{E}[X]=\\mathbb{E}[U^{2}]+2\\mathbb{E}[U]+1=\\frac{1}{3}+1+1=\\frac{7}{3}.\n$$\n并且\n$$\nX^{2}=(U^{2}+2U+1)^{2}=U^{4}+4U^{3}+6U^{2}+4U+1,\n$$\n所以\n$$\n\\mathbb{E}[X^{2}]=\\frac{1}{5}+4\\cdot\\frac{1}{4}+6\\cdot\\frac{1}{3}+4\\cdot\\frac{1}{2}+1=\\frac{31}{5}.\n$$\n因此\n$$\n\\operatorname{Var}(X)=\\mathbb{E}[X^{2}]-(\\mathbb{E}[X])^{2}=\\frac{31}{5}-\\left(\\frac{7}{3}\\right)^{2}=\\frac{34}{45}.\n$$\n\n计算与 $C=U$ 的协方差：\n$$\n\\operatorname{Cov}(U^{2},U)=\\mathbb{E}[U^{3}]-\\mathbb{E}[U^{2}]\\mathbb{E}[U]=\\frac{1}{4}-\\frac{1}{3}\\cdot\\frac{1}{2}=\\frac{1}{12},\n$$\n所以\n$$\n\\operatorname{Cov}(X,C)=\\operatorname{Cov}(U^{2}+2U+1,U)=\\frac{1}{12}+2\\cdot\\operatorname{Var}(U)=\\frac{1}{12}+2\\cdot\\frac{1}{12}=\\frac{1}{4},\n$$\n且 $\\operatorname{Var}(C)=\\operatorname{Var}(U)=\\frac{1}{12}$。\n\n对于控制变量估计量 $X(b)=X-b(C-\\mathbb{E}[C])$，其方差为\n$$\n\\operatorname{Var}(X(b))=\\operatorname{Var}(X)-2b\\,\\operatorname{Cov}(X,C)+b^{2}\\operatorname{Var}(C).\n$$\n将关于 $b$ 的二次式最小化，得到\n$$\nb^{*}=\\frac{\\operatorname{Cov}(X,C)}{\\operatorname{Var}(C)}=\\frac{\\frac{1}{4}}{\\frac{1}{12}}=3,\n$$\n最小化后的方差为\n$$\n\\operatorname{Var}(X(b^{*}))=\\operatorname{Var}(X)-\\frac{\\operatorname{Cov}(X,C)^{2}}{\\operatorname{Var}(C)}=\\frac{34}{45}-\\frac{\\left(\\frac{1}{4}\\right)^{2}}{\\frac{1}{12}}=\\frac{34}{45}-\\frac{3}{4}=\\frac{1}{180}.\n$$\n\n因此，方差缩减因子为\n$$\n\\frac{\\operatorname{Var}(X(b^{*}))}{\\operatorname{Var}(X)}=\\frac{\\frac{1}{180}}{\\frac{34}{45}}=\\frac{1}{136}.\n$$", "answer": "$$\\boxed{\\frac{1}{136}}$$", "id": "1348989"}, {"introduction": "对偶变量法是一种直观的方差缩减技术，它通过生成具有负相关性的成对样本来抵消随机波动。然而，任何强大的工具都需要正确使用才能发挥其效力，对偶变量法也不例外。这个练习通过构建一个特殊的支付函数，展示了一个对偶变量法反而导致方差增大的反例[@problem_id:2446675]，这警示我们在应用该方法时必须仔细检验其核心前提，从而确保样本间的负相关性。", "problem": "在计算金融定价的蒙特卡洛（MC）模拟中，考虑估计期望收益 $\\mu = \\mathbb{E}[g(X)]$，其中 $X \\sim U(0,1)$ 且 $g:[0,1]\\to\\mathbb{R}$ 是一个二元收益函数。通过取两个边界区间的对称并集来构造收益：对于参数 $a \\in (0,\\tfrac{1}{2})$，定义\n$$\ng(x) = \\mathbf{1}\\{x \\in [0,a] \\cup [1-a,1]\\}.\n$$\n令 $\\widehat{\\mu}_{c}$ 是基于 2 个独立样本 $X_{1},X_{2} \\sim U(0,1)$ 的原始蒙特卡洛（crude MC）估计量：\n$$\n\\widehat{\\mu}_{c} = \\frac{g(X_{1}) + g(X_{2})}{2},\n$$\n并令 $\\widehat{\\mu}_{a}$ 是基于一个对偶变量对 $(X,1-X)$（其中 $X \\sim U(0,1)$）的对偶变量（antithetic variates）估计量：\n$$\n\\widehat{\\mu}_{a} = \\frac{g(X) + g(1-X)}{2}.\n$$\n计算精确的方差比\n$$\nR \\equiv \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})}.\n$$\n给出你的答案，形式为一个实数；无需四舍五入。", "solution": "本题要求计算方差比 $R \\equiv \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})}$，其中 $\\widehat{\\mu}_{c}$ 是原始蒙特卡洛估计量，$\\widehat{\\mu}_{a}$ 是对偶变量估计量，用于估计期望值 $\\mu = \\mathbb{E}[g(X)]$。\n\n首先，我们定义随机变量 $Y = g(X)$，其中 $X \\sim U(0,1)$，收益函数由 $g(x) = \\mathbf{1}\\{x \\in [0,a] \\cup [1-a,1]\\}$ 给出，对于 $a \\in (0, \\frac{1}{2})$。随机变量 $Y$ 是一个伯努利变量，因为它只能取值 $0$ 或 $1$。\n\n成功的概率 $p$ 是 $Y$ 的期望值：\n$$\np = \\mathbb{E}[Y] = \\mathbb{E}[g(X)] = \\int_{0}^{1} g(x) dx = \\int_{0}^{a} 1 \\,dx + \\int_{1-a}^{1} 1 \\,dx = a + (1 - (1-a)) = 2a.\n$$\n由于 $Y$ 是一个参数为 $p=2a$ 的伯努利随机变量，其方差由下式给出：\n$$\n\\operatorname{Var}(Y) = p(1-p) = 2a(1-2a).\n$$\n这也可以直接计算：\n$$\n\\mathbb{E}[Y^{2}] = \\mathbb{E}[g(X)^2] = \\mathbb{E}[g(X)] = 2a,\n$$\n因为对于指示函数，$g(x)^2 = g(x)$。\n因此，\n$$\n\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2 = 2a - (2a)^2 = 2a(1-2a).\n$$\n由于 $a \\in (0, \\frac{1}{2})$，我们有 $a > 0$ 且 $1-2a > 0$，这保证了 $\\operatorname{Var}(Y) > 0$。\n\n接下来，我们计算原始蒙特卡洛估计量 $\\widehat{\\mu}_{c}$ 的方差。\n该估计量定义为 $\\widehat{\\mu}_{c} = \\frac{g(X_{1}) + g(X_{2})}{2}$，其中 $X_{1}, X_{2}$ 是来自 $U(0,1)$ 的独立同分布（i.i.d.）样本。令 $Y_1 = g(X_1)$ 和 $Y_2 = g(X_2)$。$Y_1$ 和 $Y_2$ 是独立同分布的随机变量，其方差为 $\\operatorname{Var}(Y_1) = \\operatorname{Var}(Y_2) = \\operatorname{Var}(Y) = 2a(1-2a)$。\n由于 $Y_1$ 和 $Y_2$ 的独立性，它们和的方差是它们方差的和。\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{c}) = \\operatorname{Var}\\left(\\frac{Y_{1} + Y_{2}}{2}\\right) = \\frac{1}{4}\\operatorname{Var}(Y_1 + Y_2) = \\frac{1}{4}(\\operatorname{Var}(Y_{1}) + \\operatorname{Var}(Y_{2})).\n$$\n代入 $Y$ 的方差：\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{c}) = \\frac{1}{4}(2a(1-2a) + 2a(1-2a)) = \\frac{1}{4}(4a(1-2a)) = a(1-2a).\n$$\n现在，我们计算对偶变量估计量 $\\widehat{\\mu}_{a}$ 的方差。\n该估计量定义为 $\\widehat{\\mu}_{a} = \\frac{g(X) + g(1-X)}{2}$。我们必须分析 $g(X)$ 和 $g(1-X)$ 之间的关系。\n函数 $g(x)$ 关于 $x=\\frac{1}{2}$ 对称。让我们验证 $g(1-x)$ 的这个性质：\n$$\ng(1-x) = \\mathbf{1}\\{1-x \\in [0,a] \\cup [1-a,1]\\}.\n$$\n条件 $1-x \\in [0,a]$ 等价于 $1-a \\le x \\le 1$。\n条件 $1-x \\in [1-a,1]$ 等价于 $0 \\le x \\le a$。\n因此，$g(1-x) = 1$ 当且仅当 $x \\in [0,a] \\cup [1-a,1]$。这与 $g(x)=1$ 的条件相同。对于所有其他 $x \\in (0,1)$， $g(x)$ 和 $g(1-x)$ 均为 $0$。\n因此，对于所有 $x \\in [0,1]$，有 $g(x) = g(1-x)$。\n\n这意味着随机变量 $g(X)$ 和 $g(1-X)$ 是相同的。对偶估计量简化为：\n$$\n\\widehat{\\mu}_{a} = \\frac{g(X) + g(X)}{2} = g(X) = Y.\n$$\n因此，对偶估计量的方差就是 $Y$ 的方差：\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{a}) = \\operatorname{Var}(g(X)) = 2a(1-2a).\n$$\n最后，我们计算所求的比率 $R$：\n$$\nR = \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})} = \\frac{2a(1-2a)}{a(1-2a)}.\n$$\n由于 $a \\in (0, \\frac{1}{2})$，项 $a(1-2a)$ 严格为正，可以从分子和分母中约去。\n$$\nR = 2.\n$$\n该比率是一个常数值，与参数 $a$ 无关。这展示了一个案例，其中对偶抽样技术应用于对称函数时，与使用相同数量函数求值的原始蒙特卡洛方法相比，反而增加了方差。具体来说，它使抽样方差增加了一倍。", "answer": "$$\n\\boxed{2}\n$$", "id": "2446675"}, {"introduction": "重要性抽样是一种极为强大的方差缩减技术，尤其在处理罕见事件或高维积分等难题时表现出色。它的核心思想是“智能地”抽样，即从一个更优的“提议分布”中抽取样本，然后通过权重进行修正，从而将计算资源集中在对结果贡献最大的区域。这个练习将指导你推导一个问题的最优提议分布[@problem_id:2446710]，并让你看到，一个精心选择的提议分布甚至可以将估计量的方差降为零，充分展示了重要性抽样的巨大潜力。", "problem": "考虑一个与计算经济学和金融学相关的蒙特卡洛设置，任务是计算一个正态分布随机变量的指数的期望。设 $X \\sim \\mathcal{N}(0, 100)$，并定义 $h(x) = \\exp(x)$。你将使用重要性抽样方法来估计 $\\mathbb{E}[\\exp(X)]$，其中提议分布 $Q$ 由 $Y \\sim \\mathcal{N}(\\mu, 100)$ 给出，$\\mu \\in \\mathbb{R}$ 是一个未知的平移参数。设 $p(x)$ 和 $q_{\\mu}(x)$ 分别表示 $\\mathcal{N}(0, 100)$ 和 $\\mathcal{N}(\\mu, 100)$ 的概率密度函数。基于从 $q_{\\mu}$ 中抽取的 $n$ 个独立同分布样本 $\\{Y_i\\}_{i=1}^{n}$，重要性抽样估计量为\n$$\nI_n(\\mu) \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} h(Y_i)\\, w_{\\mu}(Y_i), \\quad \\text{其中 } w_{\\mu}(y) \\;=\\; \\frac{p(y)}{q_{\\mu}(y)}.\n$$\n从基本原理出发，不使用任何特定的方差缩减公式，完成以下任务：\n1. 推导 $\\mathbb{E}[\\exp(X)]$ 的闭式表达式。\n2. 推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\,w_{\\mu}(Y))$ 作为 $\\mu$ 的函数，并确定使该方差在 $\\mu \\in \\mathbb{R}$ 上最小化的值 $\\mu^{\\star}$。\n\n将你的最终答案以一个有序对的形式给出，该有序对包含 $\\mathbb{E}[\\exp(X)]$ 的精确值和最优平移 $\\mu^{\\star}$。不需要进行数值舍入，你的答案应为精确值，不带单位。", "solution": "我们首先回顾一下定义。目标分布为 $X \\sim \\mathcal{N}(0, 100)$，其密度函数为\n$$\np(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100,\n$$\n提议分布为 $Y \\sim \\mathcal{N}(\\mu, 100)$，其密度函数为\n$$\nq_{\\mu}(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100.\n$$\n重要性权重为 $w_{\\mu}(x) = p(x)/q_{\\mu}(x)$。\n\n步骤 1：计算 $\\mathbb{E}[\\exp(X)]$ 的闭式解。根据定义，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(x)\\, p(x)\\, dx \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(x - \\frac{x^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n对指数部分进行配方。写出\n$$\nx - \\frac{x^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left(x^{2} - 2\\sigma^{2} x \\right) \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left[(x - \\sigma^{2})^{2} - \\sigma^{4}\\right] \\;=\\; -\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}} + \\frac{\\sigma^{2}}{2}.\n$$\n因此，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right),\n$$\n因为该积分等于 $\\sqrt{2\\pi}\\, \\sigma$。当 $\\sigma^{2} = 100$ 时，这得到\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\exp(50).\n$$\n\n步骤 2：推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y))$ 并在 $\\mu$ 上将其最小化。注意到\n$$\n\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y)) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;-\\; \\left(\\mathbb{E}[\\exp(X)]\\right)^{2}.\n$$\n第二项不依赖于 $\\mu$，因此在 $\\mu$ 上最小化方差等价于最小化二阶矩\n$$\nM(\\mu) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(2x)\\, \\frac{p(x)^{2}}{q_{\\mu}(x)}\\, dx.\n$$\n使用具有共同方差 $\\sigma^{2}$ 的 $p$ 和 $q_{\\mu}$ 的显式形式，\n$$\n\\frac{p(x)^{2}}{q_{\\mu}(x)} \\;=\\; \\frac{\\left(\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)\\right)^{2}}{\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)} \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right).\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n合并指数项：\n$$\n2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x + \\frac{\\mu^{2}}{2\\sigma^{2}}.\n$$\n通过定义以下变量来配方\n$$\nm \\;=\\; 2\\sigma^{2} - \\mu,\n$$\n从而\n$$\n-\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x \\;=\\; -\\frac{(x - m)^{2}}{2\\sigma^{2}} + \\frac{m^{2}}{2\\sigma^{2}}.\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left(\\frac{m^{2}}{2\\sigma^{2}} + \\frac{\\mu^{2}}{2\\sigma^{2}}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - m)^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{m^{2} + \\mu^{2}}{2\\sigma^{2}}\\right).\n$$\n代入 $m = 2\\sigma^{2} - \\mu$，\n$$\nm^{2} + \\mu^{2} \\;=\\; (2\\sigma^{2} - \\mu)^{2} + \\mu^{2} \\;=\\; 4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2},\n$$\n因此\n$$\nM(\\mu) \\;=\\; \\exp\\!\\left(\\frac{4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2}}{2\\sigma^{2}}\\right) \\;=\\; \\exp\\!\\left(2\\sigma^{2} - 2\\mu + \\frac{\\mu^{2}}{\\sigma^{2}}\\right).\n$$\n作为 $\\mu$ 的函数，最小化 $M(\\mu)$ 等价于最小化其指数部分\n$$\ng(\\mu) \\;=\\; \\frac{\\mu^{2}}{\\sigma^{2}} - 2\\mu + 2\\sigma^{2}.\n$$\n这是一个关于 $\\mu$ 的凸二次函数，其导数为\n$$\ng'(\\mu) \\;=\\; \\frac{2\\mu}{\\sigma^{2}} - 2,\n$$\n该导数在以下点处为零\n$$\n\\mu^{\\star} \\;=\\; \\sigma^{2}.\n$$\n由于 $g''(\\mu) = 2/\\sigma^{2} > 0$，该临界点是唯一的最小值点。当 $\\sigma^{2} = 100$ 时，最优平移为\n$$\n\\mu^{\\star} \\;=\\; 100.\n$$\n在 $\\mu^{\\star} = \\sigma^{2}$ 时，提议密度 $q_{\\mu^{\\star}}$ 与 $h(x)\\, p(x)$ 成正比，这会产生一个零方差的重要性抽样估计量，与以下结果一致\n$$\n\\operatorname{Var}_{q_{\\mu^{\\star}}}(h(Y)\\,w_{\\mu^{\\star}}(Y)) \\;=\\; M(\\mu^{\\star}) - \\left(\\mathbb{E}[\\exp(X)]\\right)^{2} \\;=\\; \\exp(\\sigma^{2}) - \\exp(\\sigma^{2}) \\;=\\; 0.\n$$\n总结结果，精确期望为 $\\exp(50)$，最优平移为 $\\mu^{\\star} = 100$。", "answer": "$$\\boxed{\\begin{pmatrix}\\exp(50)  100\\end{pmatrix}}$$", "id": "2446710"}]}