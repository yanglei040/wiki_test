{"hands_on_practices": [{"introduction": "让我们通过一个基础案例，亲手实践伽辽金方法。我们将求解一个带有齐次（即零）边界条件的二阶常微分方程。这个练习的巧妙之处在于，它将整个求解过程浓缩为寻找一个未知系数的计算，让你直观地体会到伽辽金方法的核心——“投影”——是如何运作的。通过这个简单的例子，你将掌握将一个复杂的微分方程问题转化为一个可解的代数问题的基本流程。[@problem_id:2149969]", "problem": "考虑一维稳态热传导方程 $-u'' = \\cos(x)$，该方程描述了在定义域 $x \\in [-\\pi/2, \\pi/2]$ 上一根杆的温度分布 $u(x)$。该杆受到一个由 $\\cos(x)$ 表示的空间变化的内部热源的影响。杆的两端保持固定的零温度，从而得到边界条件 $u(-\\pi/2) = u(\\pi/2) = 0$。\n\n使用伽辽金法，求此边值问题的一个近似解。你需要使用一个形如 $u_a(x) = c \\phi(x)$ 的单一对称试函数，其中基函数是多项式 $\\phi(x) = \\frac{\\pi^2}{4} - x^2$，而 $c$ 是一个待定常数系数。问题中所有的三角函数都以弧度为单位定义。\n\n将你的近似解 $u_a(x)$ 的最终答案表示为 $x$ 和常数 $\\pi$ 的函数。", "solution": "给定边值问题 $-u''(x)=\\cos(x)$，定义域为 $x\\in[-\\pi/2,\\pi/2]$，且满足 $u(-\\pi/2)=u(\\pi/2)=0$。对于齐次狄利克雷边界条件，$-u''=f$ 的伽辽金弱形式为\n$$\n\\int_{-\\pi/2}^{\\pi/2} u'(x)\\,v'(x)\\,dx=\\int_{-\\pi/2}^{\\pi/2} f(x)\\,v(x)\\,dx\n$$\n对所有容许的测试函数 $v$ 均成立。使用由 $\\phi(x)=\\frac{\\pi^{2}}{4}-x^{2}$ 张成的一维试探空间，我们设 $u_{a}(x)=c\\,\\phi(x)$ 并选择 $v=\\phi$。这得到\n$$\nc\\int_{-\\pi/2}^{\\pi/2} \\left(\\phi'(x)\\right)^{2} dx=\\int_{-\\pi/2}^{\\pi/2} \\cos(x)\\,\\phi(x)\\,dx.\n$$\n计算 $\\phi'(x)=-2x$，因此 $\\left(\\phi'(x)\\right)^{2}=4x^{2}$。分母变为\n$$\n\\int_{-\\pi/2}^{\\pi/2}4x^{2}dx=4\\cdot 2\\int_{0}^{\\pi/2}x^{2}dx=8\\cdot \\frac{(\\pi/2)^{3}}{3}=\\frac{\\pi^{3}}{3}.\n$$\n对于分子，\n$$\n\\int_{-\\pi/2}^{\\pi/2}\\cos(x)\\left(\\frac{\\pi^{2}}{4}-x^{2}\\right)dx\n=\\frac{\\pi^{2}}{4}\\int_{-\\pi/2}^{\\pi/2}\\cos(x)dx-\\int_{-\\pi/2}^{\\pi/2}x^{2}\\cos(x)dx.\n$$\n计算第一项：\n$$\n\\frac{\\pi^{2}}{4}\\int_{-\\pi/2}^{\\pi/2}\\cos(x)dx=\\frac{\\pi^{2}}{4}\\left[\\sin(x)\\right]_{-\\pi/2}^{\\pi/2}=\\frac{\\pi^{2}}{4}\\cdot 2=\\frac{\\pi^{2}}{2}.\n$$\n对于第二项，使用偶函数性质和分部积分法：\n$$\n\\int_{-\\pi/2}^{\\pi/2}x^{2}\\cos(x)dx=2\\int_{0}^{\\pi/2}x^{2}\\cos(x)dx,\n$$\n并且\n$$\n\\int x^{2}\\cos(x)\\,dx=x^{2}\\sin(x)+2x\\cos(x)-2\\sin(x)+C.\n$$\n因此，\n$$\n\\int_{0}^{\\pi/2}x^{2}\\cos(x)\\,dx=\\left[x^{2}\\sin(x)+2x\\cos(x)-2\\sin(x)\\right]_{0}^{\\pi/2}=\\frac{\\pi^{2}}{4}-2,\n$$\n所以\n$$\n\\int_{-\\pi/2}^{\\pi/2}x^{2}\\cos(x)dx=2\\left(\\frac{\\pi^{2}}{4}-2\\right)=\\frac{\\pi^{2}}{2}-4.\n$$\n因此分子为\n$$\n\\frac{\\pi^{2}}{2}-\\left(\\frac{\\pi^{2}}{2}-4\\right)=4.\n$$\n所以，\n$$\nc=\\frac{\\int_{-\\pi/2}^{\\pi/2}\\cos(x)\\,\\phi(x)\\,dx}{\\int_{-\\pi/2}^{\\pi/2}\\left(\\phi'(x)\\right)^{2}dx}\n=\\frac{4}{\\pi^{3}/3}=\\frac{12}{\\pi^{3}}.\n$$\n伽辽金近似解为\n$$\nu_{a}(x)=c\\,\\phi(x)=\\frac{12}{\\pi^{3}}\\left(\\frac{\\pi^{2}}{4}-x^{2}\\right).\n$$\n根据构造，该解满足 $u_{a}(\\pm \\pi/2)=0$。", "answer": "$$\\boxed{\\frac{12}{\\pi^{3}}\\left(\\frac{\\pi^{2}}{4}-x^{2}\\right)}$$", "id": "2149969"}, {"introduction": "在解决了理想化的齐次边界问题后，我们来处理一个更贴近实际的挑战：非齐次（非零）边界条件。这个问题将向你展示一种在伽辽金框架内处理此类条件的标准而巧妙的技巧。我们将学习如何将解分解为一个满足给定边界条件的部分，以及一个在边界上为零、可以用基函数展开来近似的部分，这是将理论方法应用于工程实践的关键一步。[@problem_id:2150022]", "problem": "考虑由微分方程 $-u''(x) = 1$（在区间 $x \\in (0, 1)$ 上）和非齐次边界条件 $u(0) = 1$ 及 $u(1) = 2$ 所定义的两点边值问题。\n\n我们希望使用伽辽金法求此问题的近似解。设试探解的形式为 $u_h(x) = (x+1) + c_1 x(1-x)$，其中 $c_1$ 是一个待定的未知常系数。项 $x(1-x)$ 作为解的齐次部分的唯一基函数。\n\n使用伽辽金法，确定系数 $c_1$ 的值。请将答案表示为分数。", "solution": "我们用 $u_{h}(x)=(x+1)+c_{1}\\,x(1-x)$ 来近似解 $u$，该近似解对任意 $c_{1}$ 都满足本质边界条件。在用于 $-u''=1$ 且具有齐次检验空间的伽辽金法中，其弱形式为\n$$\n\\int_{0}^{1} u'(x)\\,v'(x)\\,dx=\\int_{0}^{1} v(x)\\,dx\n$$\n对所有在端点处为零的检验函数 $v$ 成立。使用单个基函数 $v(x)=x(1-x)$，我们计算\n$$\nu_{h}'(x)=1+c_{1}(1-2x), \\quad v'(x)=1-2x.\n$$\n伽辽金方程变为\n$$\n\\int_{0}^{1}\\left[1+c_{1}(1-2x)\\right](1-2x)\\,dx=\\int_{0}^{1}x(1-x)\\,dx.\n$$\n通过拆分项来计算左侧：\n$$\n\\int_{0}^{1}(1-2x)\\,dx + c_{1}\\int_{0}^{1}(1-2x)^{2}\\,dx.\n$$\n我们有\n$$\n\\int_{0}^{1}(1-2x)\\,dx=\\left[x-x^{2}\\right]_{0}^{1}=1-1=0,\n$$\n以及\n$$\n\\int_{0}^{1}(1-2x)^{2}\\,dx=\\int_{0}^{1}\\left(1-4x+4x^{2}\\right)\\,dx=1-2+\\frac{4}{3}=\\frac{1}{3}.\n$$\n右侧为\n$$\n\\int_{0}^{1}x(1-x)\\,dx=\\int_{0}^{1}(x-x^{2})\\,dx=\\left[\\frac{x^{2}}{2}-\\frac{x^{3}}{3}\\right]_{0}^{1}=\\frac{1}{2}-\\frac{1}{3}=\\frac{1}{6}.\n$$\n因此，\n$$\nc_{1}\\cdot\\frac{1}{3}=\\frac{1}{6}\\quad\\Rightarrow\\quad c_{1}=\\frac{1}{2}.\n$$\n为了完整起见，残差形式也给出相同的结果：$u_{h}''(x)=-2c_{1}$，所以 $-u_{h}''-1=2c_{1}-1$，而伽辽金条件 $\\int_{0}^{1}(2c_{1}-1)\\,x(1-x)\\,dx=0$ 导出 $(2c_{1}-1)\\cdot\\frac{1}{6}=0$，因此 $c_{1}=\\frac{1}{2}$。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "2150022"}, {"introduction": "伽辽金方法的真正威力在于它能够通过使用多个基函数来构建高精度的近似解。这个综合性练习将带领你实现从单个系数近似到完整数值方案的飞跃，我们将使用分片线性基函数（线性样条）来系统地求解问题。通过这个实践，你将揭示伽辽金方法是如何作为强大且应用广泛的有限元方法（FEM）的理论基石，并理解从理论到代码实现的完整过程。[@problem_id:3155303]", "problem": "考虑在区间 $[0,1]$ 上由常微分方程 $-u''(x)=f(x)$ 定义的边值问题，其齐次狄利克雷边界条件为 $u(0)=0$ 和 $u(1)=0$。从乘以一个在边界上为零的容许测试函数 $v$ 并进行分部积分的基本步骤开始，推导适用于索博列夫空间 $H^1_0([0,1])$ 中函数的弱（变分）形式。使用此弱形式，实现一个伽辽金方法，其中试探空间和测试空间是在均匀网格上由线性样条（分片线性）基函数张成的相同子空间。该网格将 $[0,1]$ 划分成 $N$ 个相等的子区间，节点为 $x_i=i/N$，其中 $i=0,1,\\ldots,N$。线性样条基应由与内部节点 $x_i$（$i=1,\\ldots,N-1$）相关联的标准帽子函数组成，使得每个基函数都支撑在两个相邻的子区间上，并在每个子区间上是线性的。\n\n您的任务是：\n- 从弱形式和基函数的定义出发，显式地推导组装与伽辽金方法对应的线性系统所需的表达式。将与左侧相关的双线性形式和与右侧相关的线性泛函表示为单元积分。\n- 通过在每个单元上计算所需的一维积分，实现全局刚度矩阵和载荷向量的组装。对于光滑的 $f$，您必须通过精确计算或足够精确的数值求积，将这些积分计算到完全的机器精度。一种可靠的方法是每个单元使用 $q=5$ 个点的高斯-勒让德求积。\n- 求解得到的线性系统以获得线性样条逼近的系数，并构造近似解在包括边界节点在内的网格上的节点值，强制执行齐次狄利克雷边界条件。\n- 对于每个测试用例，计算最大节点误差，其定义为 $\\max_{0\\leq i\\leq N}\\left|u_h(x_i)-u_{\\mathrm{exact}}(x_i)\\right|$，其中 $u_h$ 是伽辽金解，$u_{\\mathrm{exact}}$ 是所选 $f$ 的已知精确解。\n\n在您的解答叙述中，解释这种使用线性样条的伽辽金构造如何以及为何正是一维空间中使用分片线性元的有限元方法。明确地将弱形式、基的选择以及单元组装与标准的有限元解释联系起来。\n\n使用以下测试套件，其中指定了 $N$ 的值、力函数 $f(x)$ 和相应的精确解 $u_{\\mathrm{exact}}(x)$：\n- 测试 1：$N=2$，$f(x)=1$，$u_{\\mathrm{exact}}(x)=\\dfrac{x(1-x)}{2}$。\n- 测试 2：$N=4$，$f(x)=\\sin(\\pi x)$，$u_{\\mathrm{exact}}(x)=\\dfrac{\\sin(\\pi x)}{\\pi^2}$。\n- 测试 3：$N=10$，$f(x)=2$，$u_{\\mathrm{exact}}(x)=x(1-x)$。\n- 测试 4：$N=3$，$f(x)=0$，$u_{\\mathrm{exact}}(x)=0$。\n- 测试 5：$N=8$，$f(x)=\\begin{cases}1,  0 \\le x  1/2 \\\\ 0,  1/2 \\le x \\le 1 \\end{cases}$，$u_{\\mathrm{exact}}(x)=\\begin{cases}-\\dfrac{x^2}{2}+\\dfrac{3}{8}x,  0 \\le x  1/2 \\\\ -\\dfrac{x}{8}+\\dfrac{1}{8},  1/2 \\le x \\le 1 \\end{cases}$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，列表中的每个条目是对应测试用例的最大节点误差，四舍五入到八位小数（例如，$[0.00000000,0.12345678,0.00000001,0.00000000,0.01234567]$）。本问题不涉及物理单位，也不使用角度。最终输出必须将所有提供的测试用例的结果汇总到指定的单行格式中。", "solution": "用户希望使用带有线性样条的有限元方法（FEM）求解一维边值问题。该过程涉及推导弱形式，使用伽辽金方法对其进行离散化，组装所得的线性系统，求解该系统，并根据已知的精确解计算误差。\n\n### 第一步：弱（变分）形式的推导\n\n该问题由微分方程的强形式定义：\n$$ -u''(x) = f(x) \\quad \\text{for } x \\in (0, 1) $$\n其齐次狄利克雷边界条件为：\n$$ u(0) = 0, \\quad u(1) = 0 $$\n\n为了推导弱形式，我们将方程乘以一个容许的测试函数 $v(x)$，并在定义域 $[0,1]$ 上积分。测试函数必须属于一个满足边界条件的空间。合适的空间是索博列夫空间 $H^1_0([0,1])$，它由在边界 $x=0$ 和 $x=1$ 处为零的 $H^1([0,1])$ 中的函数组成。\n\n乘以 $v \\in H^1_0([0,1])$ 并积分得到：\n$$ -\\int_0^1 u''(x) v(x) \\,dx = \\int_0^1 f(x) v(x) \\,dx $$\n\n我们对左侧项 $\\int_0^1 u''(x) v(x) \\,dx$ 应用分部积分：\n$$ \\int_0^1 u''(x) v(x) \\,dx = \\Big[ u'(x) v(x) \\Big]_0^1 - \\int_0^1 u'(x) v'(x) \\,dx $$\n\n边界项 $\\Big[ u'(x) v(x) \\Big]_0^1 = u'(1)v(1) - u'(0)v(0)$ 为零，因为测试函数 $v(x)$ 在边界处为零，即 $v(0) = v(1) = 0$。将其代回，我们得到：\n$$ - \\left( 0 - \\int_0^1 u'(x) v'(x) \\,dx \\right) = \\int_0^1 f(x) v(x) \\,dx $$\n$$ \\int_0^1 u'(x) v'(x) \\,dx = \\int_0^1 f(x) v(x) \\,dx $$\n\n问题的弱形式是寻找一个解 $u \\in H^1_0([0,1])$，使得上述方程对所有测试函数 $v \\in H^1_0([0,1])$ 均成立。这可以抽象地表述为：寻找 $u \\in H^1_0([0,1])$ 使得对所有 $v \\in H^1_0([0,1])$ 都有 $a(u,v) = L(v)$，其中：\n- 双线性形式为 $a(u,v) = \\int_0^1 u'(x)v'(x) \\,dx$。\n- 线性泛函为 $L(v) = \\int_0^1 f(x)v(x) \\,dx$。\n\n### 第二步：使用线性样条的伽辽金离散化\n\n伽辽金方法在一个有限维子空间 $V_h \\subset H^1_0([0,1])$ 中寻找近似解 $u_h(x)$。问题指定 $V_h$ 是均匀网格上的线性样条（连续分片线性函数）空间。\n\n网格由 $N+1$ 个节点 $x_i = i/N = ih$（其中 $i=0, 1, \\dots, N$）组成，其中 $h = 1/N$ 是 $N$ 个子区间（单元）中每个子区间的尺寸。\n\n为确保 $V_h$ 中的任何函数都满足齐次边界条件，我们从以内部节点 $x_i$（$i=1, \\dots, N-1$）为中心的“帽子”函数 $\\phi_i(x)$ 基构建 $V_h$。每个基函数 $\\phi_i(x)$ 定义为：\n$$\n\\phi_i(x) =\n\\begin{cases}\n    \\frac{x - x_{i-1}}{h},  x \\in [x_{i-1}, x_i] \\\\\n    \\frac{x_{i+1} - x}{h},  x \\in [x_i, x_{i+1}] \\\\\n    0,  \\text{otherwise}\n\\end{cases}\n$$\n近似解 $u_h(x)$ 是这些基函数的线性组合：\n$$ u_h(x) = \\sum_{j=1}^{N-1} c_j \\phi_j(x) $$\n系数 $c_j$ 表示解在内部节点处的未知值，即 $c_j = u_h(x_j)$。\n\n伽辽金问题是寻找 $u_h \\in V_h$ 使得对所有 $v_h \\in V_h$ 都有 $a(u_h, v_h) = L(v_h)$。由于集合 $\\{\\phi_i\\}_{i=1}^{N-1}$ 构成 $V_h$ 的一个基，因此只需对每个基函数 $\\phi_i$ 进行测试：\n$$ a\\left(\\sum_{j=1}^{N-1} c_j \\phi_j, \\phi_i\\right) = L(\\phi_i) \\quad \\text{for } i=1, \\dots, N-1 $$\n根据双线性形式 $a(\\cdot, \\cdot)$ 的线性性质，这变成一个线性方程组：\n$$ \\sum_{j=1}^{N-1} c_j \\, a(\\phi_j, \\phi_i) = L(\\phi_i) $$\n这是一个矩阵系统 $K\\mathbf{c} = \\mathbf{F}$，其中 $\\mathbf{c} = [c_1, \\dots, c_{N-1}]^T$ 是未知系数向量，刚度矩阵 $K$ 和载荷向量 $\\mathbf{F}$ 的项为：\n$$ K_{ij} = a(\\phi_i, \\phi_j) = \\int_0^1 \\phi_i'(x) \\phi_j'(x) \\,dx \\quad (\\text{注意：求和中的 } a(\\phi_j, \\phi_i) \\text{ 因对称性导致 } K_{ij}=a(\\phi_i,\\phi_j)) $$\n$$ F_i = L(\\phi_i) = \\int_0^1 f(x) \\phi_i(x) \\,dx $$\n这里，矩阵和向量的索引从 $1$ 到 $N-1$。\n\n### 第三步：刚度矩阵和载荷向量的组装\n\n**刚度矩阵 $K$：**\n帽子函数 $\\phi_i(x)$ 的导数是一个分片常数函数：\n$$\n\\phi_i'(x) =\n\\begin{cases}\n    1/h,  x \\in (x_{i-1}, x_i) \\\\\n    -1/h,  x \\in (x_i, x_{i+1}) \\\\\n    0,  \\text{otherwise}\n\\end{cases}\n$$\n- **对角线项 ($i=j$)：** $\\phi_i'$ 和 $\\phi_i'$ 的支撑集在 $[x_{i-1}, x_{i+1}]$ 上重叠。\n    $$ K_{ii} = \\int_{x_{i-1}}^{x_i} \\left(\\frac{1}{h}\\right)^2 dx + \\int_{x_i}^{x_{i+1}} \\left(-\\frac{1}{h}\\right)^2 dx = \\frac{1}{h^2}(h) + \\frac{1}{h^2}(h) = \\frac{2}{h} $$\n- **非对角线项 ($j=i\\pm1$)：** $\\phi_i'$ 和 $\\phi_{i+1}'$ 的支撑集仅在 $[x_i, x_{i+1}]$ 上重叠。\n    $$ K_{i,i+1} = \\int_{x_i}^{x_{i+1}} \\left(-\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) dx = -\\frac{1}{h^2}(h) = -\\frac{1}{h} $$\n    根据对称性，$K_{i,i-1} = -1/h$。\n- **其他项 ($|i-j|1$)：** 支撑集不重叠，因此被积函数为零。$K_{ij}=0$。\n\n最终得到的 $(N-1) \\times (N-1)$ 刚度矩阵是对称三对角矩阵：\n$$ K = \\frac{1}{h} \\begin{pmatrix} 2  -1  0  \\cdots  0 \\\\ -1  2  -1  \\cdots  0 \\\\ 0  \\ddots  \\ddots  \\ddots  0 \\\\ \\vdots   -1  2  -1 \\\\ 0  \\cdots  0  -1  2 \\end{pmatrix} $$\n\n**载荷向量 $\\mathbf{F}$：**\n项 $F_i$ 由依赖于力函数 $f(x)$ 的积分给出：\n$$ F_i = \\int_0^1 f(x) \\phi_i(x) \\,dx = \\int_{x_{i-1}}^{x_i} f(x) \\frac{x-x_{i-1}}{h} \\,dx + \\int_{x_i}^{x_{i+1}} f(x) \\frac{x_{i+1}-x}{h} \\,dx $$\n对于一般的 $f(x)$，这些积分需要数值计算。问题建议在每个子区间 $[x_{i-1}, x_i]$ 和 $[x_i, x_{i+1}]$ 上使用 $q=5$ 点的高斯-勒让德求积法则以确保高精度。对于积分 $\\int_a^b g(t)dt$，求积法则为：\n$$ \\int_a^b g(t)dt \\approx \\frac{b-a}{2} \\sum_{k=1}^q w_k \\, g\\left( \\frac{b-a}{2}\\xi_k + \\frac{a+b}{2} \\right) $$\n其中 $(\\xi_k, w_k)$ 是 $[-1, 1]$ 上的标准高斯-勒让德点和权重。\n\n### 第四步：与有限元方法 (FEM) 的联系\n\n这整个过程正是一维空间中使用分片线性（P1）元的有限元方法。\n1.  **区域离散化**：将区间 $[0,1]$ 划分为 $N$ 个子区间 $[x_i, x_{i+1}]$。这些就是“有限元”。\n2.  **基的选择**：逼近空间 $V_h$ 由在每个单元上形式简单（线性）的函数构成。线性样条或“帽子函数” $\\phi_i$ 是P1元的标准基函数。它们的关键特性是“局部支撑”（$\\phi_i$ 仅在两个相邻单元上非零），这导致了稀疏的刚度矩阵，这是FEM的一个决定性特征和关键优势。\n3.  **单元组装**：全局刚度矩阵 $K$ 和载荷向量 $\\mathbf{F}$ 是通过对每个单元的贡献求和来构建的。例如，积分 $a(u,v)$ 是在每个单元上的积分之和：$a(u,v)=\\sum_e \\int_e u'v' dx$。通过在基函数非零的小块上积分来计算 $K_{ij}$ 和 $F_i$ 是FEM中标准的“组装”过程。这将一个大的全局问题分解为在每个单元上进行的小型、可管理的计算。\n\n总而言之，伽辽金方法提供了理论框架（将无限维问题投影到有限维空间），而“有限元”部分则指基于区域划分和使用局部支撑的分片多项式基函数的具体实践实现。\n\n### 第五步：求解与误差计算\n\n在组装好 $K$ 和 $\\mathbf{F}$ 之后，求解线性系统 $K\\mathbf{c} = \\mathbf{F}$ 以获得系数向量 $\\mathbf{c}$。这给出了近似解 $u_h$ 在内部节点 $\\{x_i\\}_{i=1}^{N-1}$ 处的值。通过包含边界条件来构造完整的节点解向量 $u_h(x_i)$：\n$$ u_h(x_0)=0, \\quad u_h(x_i)=c_i \\text{ for } i=1,\\dots,N-1, \\quad u_h(x_N)=0 $$\n最后，通过在所有节点上比较近似解与精确解来计算最大节点误差：\n$$ \\text{误差} = \\max_{0 \\le i \\le N} |u_h(x_i) - u_{\\text{exact}}(x_i)| $$\n\n对于某些简单情况，例如当 $f(x)$ 是常数时，已知节点值 $u_h(x_i)$ 是精确的，从而产生零节点误差。这是1D泊松方程和所选离散化特定性质的结果。对于更复杂的 $f(x)$，预计会产生非零误差。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D Poisson equation -u''(x) = f(x) on [0,1] with u(0)=u(1)=0\n    using the Finite Element Method with linear splines.\n    \"\"\"\n\n    # Define test cases: N, f(x), u_exact(x)\n    test_cases = [\n        (2,\n         lambda x: 1.0,\n         lambda x: x * (1 - x) / 2.0\n        ),\n        (4,\n         lambda x: np.sin(np.pi * x),\n         lambda x: np.sin(np.pi * x) / (np.pi**2)\n        ),\n        (10,\n         lambda x: 2.0,\n         lambda x: x * (1 - x)\n        ),\n        (3,\n         lambda x: 0.0,\n         lambda x: 0.0\n        ),\n        (8,\n         lambda x: np.piecewise(x, [x  0.5], [1.0, 0.0]),\n         lambda x: np.piecewise(x, [x  0.5, x >= 0.5],\n                                [lambda y: -y**2 / 2.0 + 3.0 / 8.0 * y,\n                                 lambda y: -y / 8.0 + 1.0 / 8.0])\n        )\n    ]\n\n    results = []\n\n    # Get Gauss-Legendre quadrature points and weights\n    q = 5\n    xi_k, w_k = np.polynomial.legendre.leggauss(q)\n\n    for case_num, (N, f, u_exact) in enumerate(test_cases):\n        h = 1.0 / N\n        nodes = np.linspace(0, 1, N + 1)\n        dim = N - 1  # Dimension of the linear system for interior nodes\n\n        if dim == 0:\n            u_h_nodes = np.zeros(N + 1)\n            u_exact_nodes = u_exact(nodes)\n            error = np.max(np.abs(u_h_nodes - u_exact_nodes))\n            results.append(error)\n            continue\n\n        # Assemble stiffness matrix K\n        K = np.zeros((dim, dim))\n        main_diag = 2.0 / h\n        off_diag = -1.0 / h\n        \n        np.fill_diagonal(K, main_diag)\n        np.fill_diagonal(K[1:], off_diag)\n        np.fill_diagonal(K[:, 1:], off_diag)\n\n        # Assemble load vector F\n        F = np.zeros(dim)\n        for i in range(1, N): # Iterate over interior nodes\n            # Contribution from element [x_{i-1}, x_i]\n            # On this element, phi_i(x) = (x - x_{i-1})/h\n            a, b = nodes[i-1], nodes[i]\n            x_q = 0.5 * (b - a) * xi_k + 0.5 * (a + b)\n            phi_vals = (x_q - a) / h\n            f_vals = f(x_q)\n            integral1 = 0.5 * (b - a) * np.sum(w_k * f_vals * phi_vals)\n\n            # Contribution from element [x_i, x_{i+1}]\n            # On this element, phi_i(x) = (x_{i+1} - x)/h\n            a, b = nodes[i], nodes[i+1]\n            x_q = 0.5 * (b - a) * xi_k + 0.5 * (a + b)\n            phi_vals = (b - x_q) / h\n            f_vals = f(x_q)\n            integral2 = 0.5 * (b - a) * np.sum(w_k * f_vals * phi_vals)\n            \n            F[i-1] = integral1 + integral2\n\n        # Solve the linear system Kc = F\n        coeffs = np.linalg.solve(K, F)\n\n        # Construct the full solution at all nodes\n        u_h_nodes = np.zeros(N + 1)\n        u_h_nodes[1:N] = coeffs\n        \n        # Calculate exact solution at nodes\n        u_exact_nodes = u_exact(nodes)\n\n        # Compute the maximum nodal error\n        error = np.max(np.abs(u_h_nodes - u_exact_nodes))\n        results.append(error)\n\n    # Format output\n    formatted_results = [f\"{r:.8f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3155303"}]}