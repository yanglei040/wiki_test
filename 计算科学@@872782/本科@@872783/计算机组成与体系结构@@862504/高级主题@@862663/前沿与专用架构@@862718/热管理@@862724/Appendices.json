{"hands_on_practices": [{"introduction": "第一个练习提供了基本集总热模型的实际应用。我们将探讨现代CPU中常见的“睿频模式”（turbo mode）功能，该功能通过暂时提高频率和电压来提升性能。通过计算功率增量并应用一阶瞬态热响应，您将确定此睿频窗口的最大安全持续时间，这是动态热管理的一个关键方面。[@problem_id:3684962]", "problem": "一个多核处理器芯片使用动态电压和频率调节 (DVFS) 技术进入一个临时的睿频模式，该模式会同时提高时钟频率和电源电压。该封装可以由一个以环境温度 $T_{\\mathrm{amb}}$ 为参考的单一主导集总热极点来近似，其特征为热阻 $R_{\\mathrm{th}}$ 和热时间常数 $\\tau$。处理器的总功耗是动态功耗和漏电功耗之和。动态功耗由广泛使用的关系式 $P_{\\mathrm{dyn}} = C_{\\mathrm{eff}} V^{2} f$ 建模，其中 $C_{\\mathrm{eff}}$ 是有效开关电容。漏电功耗建模为 $P_{\\mathrm{leak}} = k_{\\mathrm{leak}} V$，其中 $k_{\\mathrm{leak}}$ 是一个常数系数。\n\n在基准运行状态下，处理器以频率 $f_{0} = 3.0 \\times 10^{9}\\ \\mathrm{Hz}$ 和电压 $V_{0} = 1.0\\ \\mathrm{V}$ 运行。在时间 $t = 0$ 时，它进入睿频模式，频率增量为 $\\Delta f = 1.0 \\times 10^{9}\\ \\mathrm{Hz}$，电压增量为 $\\Delta V = 0.1\\ \\mathrm{V}$，因此 $f_{1} = f_{0} + \\Delta f$ 且 $V_{1} = V_{0} + \\Delta V$。使用以下参数：环境温度 $T_{\\mathrm{amb}} = 300\\ \\mathrm{K}$，有效开关电容 $C_{\\mathrm{eff}} = 20 \\times 10^{-9}\\ \\mathrm{F}$，漏电系数 $k_{\\mathrm{leak}} = 10\\ \\mathrm{W}/\\mathrm{V}$，热阻 $R_{\\mathrm{th}} = 0.4\\ \\mathrm{K}/\\mathrm{W}$，以及热时间常数 $\\tau = 10\\ \\mathrm{s}$。最大允许结温为 $T_{\\max} = 340\\ \\mathrm{K}$。\n\n请明确地从能量守恒和一个有物理基础的单极点集总热模型出发，并使用上述功耗模型，首先推导出当系统在 $t=0$ 时从基准模式阶跃到睿频模式后，在 $t \\geq 0$ 时的温度瞬态 $T(t)$。然后，确定最大睿频持续时间 $t_{\\mathrm{win}}$，使得在所有 $t \\in [0, t_{\\mathrm{win}}]$ 的时间内，温度都满足 $T(t) \\leq T_{\\max}$。\n\n将您得到的 $t_{\\mathrm{win}}$ 最终数值四舍五入到四位有效数字，并以秒为单位表示。", "solution": "具有单一主导极点的集总体的热动力学特性可以从能量守恒定律推导出来。设 $T(t)$ 为结温。对于一个通过热阻 $R_{\\mathrm{th}}$ 连接到环境的集总热容 $C_{\\mathrm{th}}$，其能量平衡方程为\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = P(t) - \\frac{T(t) - T_{\\mathrm{amb}}}{R_{\\mathrm{th}}},\n$$\n其中 $P(t)$ 是传递到芯片的总功耗。热时间常数为 $\\tau = R_{\\mathrm{th}} C_{\\mathrm{th}}$，因此我们可以写出\n$$\n\\frac{dT}{dt} = \\frac{1}{C_{\\mathrm{th}}} P(t) - \\frac{T(t) - T_{\\mathrm{amb}}}{R_{\\mathrm{th}} C_{\\mathrm{th}}}\n= \\frac{1}{C_{\\mathrm{th}}} P(t) - \\frac{T(t) - T_{\\mathrm{amb}}}{\\tau}.\n$$\n对于在 $t=0$ 时功耗从基准恒定功耗 $P_{0}$ 阶跃到睿频恒定功耗 $P_{1}$ 的情况，该系统是线性时不变的，其在 $t \\geq 0$ 时的解是标准的一阶响应：\n$$\nT(t) = T_{\\infty} + \\bigl( T(0^{+}) - T_{\\infty} \\bigr) \\exp\\!\\left( -\\frac{t}{\\tau} \\right),\n$$\n其中睿频功耗下的新稳态温度为\n$$\nT_{\\infty} = T_{\\mathrm{amb}} + R_{\\mathrm{th}} P_{1},\n$$\n并且由于温度是连续的，初始条件 $T(0^{+})$ 等于稳态基准温度 $T(0^{-}) = T_{\\mathrm{amb}} + R_{\\mathrm{th}} P_{0}$。\n\n我们现在使用给定的功耗模型计算 $P_{0}$ 和 $P_{1}$。总功耗为\n$$\nP = P_{\\mathrm{dyn}} + P_{\\mathrm{leak}} = C_{\\mathrm{eff}} V^{2} f + k_{\\mathrm{leak}} V.\n$$\n基准值：\n$$\nf_{0} = 3.0 \\times 10^{9}, \\quad V_{0} = 1.0, \\quad C_{\\mathrm{eff}} = 20 \\times 10^{-9}, \\quad k_{\\mathrm{leak}} = 10.\n$$\n计算基准动态功耗：\n$$\nP_{\\mathrm{dyn},0} = C_{\\mathrm{eff}} V_{0}^{2} f_{0} = \\left( 20 \\times 10^{-9} \\right) \\cdot (1.0)^{2} \\cdot \\left( 3.0 \\times 10^{9} \\right) = 60.\n$$\n基准漏电功耗：\n$$\nP_{\\mathrm{leak},0} = k_{\\mathrm{leak}} V_{0} = 10 \\cdot 1.0 = 10.\n$$\n因此，\n$$\nP_{0} = 60 + 10 = 70.\n$$\n睿频值：\n$$\nf_{1} = f_{0} + \\Delta f = 3.0 \\times 10^{9} + 1.0 \\times 10^{9} = 4.0 \\times 10^{9}, \\quad V_{1} = V_{0} + \\Delta V = 1.0 + 0.1 = 1.1.\n$$\n睿频动态功耗：\n$$\nP_{\\mathrm{dyn},1} = C_{\\mathrm{eff}} V_{1}^{2} f_{1} = \\left( 20 \\times 10^{-9} \\right) \\cdot (1.1)^{2} \\cdot \\left( 4.0 \\times 10^{9} \\right)\n= \\left( 20 \\times 10^{-9} \\right) \\cdot 1.21 \\cdot \\left( 4.0 \\times 10^{9} \\right)\n= 96.8.\n$$\n睿频漏电功耗：\n$$\nP_{\\mathrm{leak},1} = k_{\\mathrm{leak}} V_{1} = 10 \\cdot 1.1 = 11.\n$$\n因此，\n$$\nP_{1} = 96.8 + 11 = 107.8.\n$$\n当 $R_{\\mathrm{th}} = 0.4$ 且 $T_{\\mathrm{amb}} = 300$ 时，我们有\n$$\nT(0^{+}) = T_{\\mathrm{amb}} + R_{\\mathrm{th}} P_{0} = 300 + 0.4 \\cdot 70 = 300 + 28 = 328,\n$$\n以及\n$$\nT_{\\infty} = T_{\\mathrm{amb}} + R_{\\mathrm{th}} P_{1} = 300 + 0.4 \\cdot 107.8 = 300 + 43.12 = 343.12.\n$$\n因此睿频模式下的温度瞬态为\n$$\nT(t) = 343.12 + \\left( 328 - 343.12 \\right) \\exp\\!\\left( -\\frac{t}{10} \\right)\n= 343.12 - 15.12 \\exp\\!\\left( -\\frac{t}{10} \\right).\n$$\n为了找到满足 $t \\in [0, t_{\\mathrm{win}}]$ 时 $T(t) \\leq T_{\\max}$ 的最大睿频持续时间 $t_{\\mathrm{win}}$，我们令 $T(t_{\\mathrm{win}}) = T_{\\max}$ 并求解 $t_{\\mathrm{win}}$。当 $T_{\\max} = 340$ 时，\n$$\n340 = 343.12 - 15.12 \\exp\\!\\left( -\\frac{t_{\\mathrm{win}}}{10} \\right).\n$$\n整理得：\n$$\n15.12 \\exp\\!\\left( -\\frac{t_{\\mathrm{win}}}{10} \\right) = 343.12 - 340 = 3.12,\n$$\n$$\n\\exp\\!\\left( -\\frac{t_{\\mathrm{win}}}{10} \\right) = \\frac{3.12}{15.12} = \\frac{13}{63}.\n$$\n取自然对数，\n$$\n-\\frac{t_{\\mathrm{win}}}{10} = \\ln\\!\\left( \\frac{13}{63} \\right),\n\\quad \\Rightarrow \\quad\nt_{\\mathrm{win}} = -10 \\, \\ln\\!\\left( \\frac{13}{63} \\right).\n$$\n数值上，$\\ln\\!\\left( \\frac{13}{63} \\right) \\approx -1.57818537$，所以\n$$\nt_{\\mathrm{win}} \\approx 15.7818537.\n$$\n四舍五入到四位有效数字并以秒表示，\n$$\nt_{\\mathrm{win}} = 15.78.\n$$", "answer": "$$\\boxed{15.78}$$", "id": "3684962"}, {"introduction": "在基本热模型的基础上，本练习深入探讨了微架构、功耗和温度之间错综复杂的关系。您将为一个处理器因热点而限制其指令提取机制的场景建模。此练习要求您首先分析这种限制措施对性能的影响（$IPC$的变化），然后计算由此产生的功耗降低，并最终确定芯片的温度演变，从而突显硬件性能与热行为之间的紧密耦合。[@problem_id:3685015]", "problem": "考虑一个正在经历瞬态热点的超标量处理器。该微架构有一个前端（指令获取、指令缓存和分支预测）和一个后端（重命名、调度、执行单元和提交）。该处理器在电源电压 $V$ 和时钟频率 $f$ 下运行，一个模块的动态功耗由经过充分检验的关系式 $P_{\\text{dyn}} = \\alpha C V^{2} f$ 建模，其中 $\\alpha$ 是活动因子， $C$ 是有效开关电容。芯片的热行为可以建模为连接到环境的单个集总热阻-热容网络，其到环境的热阻为 $R_{\\text{th}}$，封装的热容为 $C_{\\text{th}}$。\n\n在时间 $t = 0$ 时，一个热点触发了指令获取节流，从而减小了获取宽度。这也改变了分支行为并影响了每周期指令数（IPC）。假设以下具有科学依据的参数和模型假设：\n\n- 时钟频率 $f = 3.0 \\,\\mathrm{GHz}$，电源电压 $V = 1.0 \\,\\mathrm{V}$，环境温度 $T_{\\text{amb}} = 25 \\,\\mathrm{^{\\circ}C}$。\n- 热阻 $R_{\\text{th}} = 1.0 \\,\\mathrm{K/W}$，热容 $C_{\\text{th}} = 20 \\,\\mathrm{J/K}$。\n- 在所考虑的时间窗口内，静态泄漏功耗对温度不敏感，为 $P_{\\text{leak}} = 3.0 \\,\\mathrm{W}$。\n- 在 $t  0$ 之前，处理器以稳态运行，参数如下：\n  - 发射宽度 $W_{\\text{issue}} = 4$ 且获取宽度 $W_{\\text{fetch,0}} = 4$。\n  - 分支密度 $d = 0.20$ 分支/指令。\n  - 分支预测错误概率 $m_{0} = 0.05$ /分支。\n  - 预测错误惩罚 $B = 15$ 个周期。\n  - 前端有效开关电容 $C_{\\text{FE}} = 2.0 \\times 10^{-9} \\,\\mathrm{F}$。\n  - 后端有效开关电容 $C_{\\text{BE}} = 8.0 \\times 10^{-9} \\,\\mathrm{F}$。\n  - 当前端主动获取时，每个获取槽位对 $\\alpha_{\\text{FE}}$ 的贡献为每个槽位每周期 $\\alpha_{\\text{slot}} = 0.10$ 的活动增量。在由分支预测错误引起的停顿期间，前端仍有最小限度的翻转，贡献为每周期 $\\alpha_{\\text{stall}} = 0.02$，且与 $W_{\\text{fetch}}$ 无关。\n  - 在后端，每周期提交的每条指令对后端活动的贡献为每条指令每周期 $\\alpha_{u} = 0.10$ 的活动增量（即，后端动态功耗通过相同的 $P_{\\text{dyn}} = \\alpha C V^{2} f$ 模型与 IPC 线性相关）。\n- 在 $t = 0$ 时，获取节流将获取宽度减小到 $W_{\\text{fetch,1}} = 2$。同时，分支预测错误概率增加到 $m_{1} = 0.08$ /分支（分支密度 $d$ 和惩罚 $B$ 保持不变）。\n\n将没有停顿的周期中的提交能力建模为 $W_{c} = \\min\\!\\big(W_{\\text{issue}}, W_{\\text{fetch}}\\big)$。使用以上定义，从第一性原理推导出一个用于计算因分支预测错误停顿而损失的周期比例的自洽表达式，并由此确定节流前和节流后条件下的 IPC $R$。使用这些结果通过 $P_{\\text{dyn}} = \\alpha C V^{2} f$ 计算节流前后的前端和后端动态功耗，然后计算总功耗。假设在 $t = 0$ 之前处理器已运行足够长的时间，达到了由节流前总功耗决定的稳态温度。对于 $t \\ge 0$，将功耗视为到节流后总功耗的阶跃变化。使用集总热阻-热容模型，确定在时间 $t = 0.50 \\,\\mathrm{s}$ 时的芯片温度。\n\n将最终温度四舍五入到四位有效数字。以摄氏度表示最终温度。", "solution": "该问题要求确定在操作参数发生变化后，处理器在特定时间 $t = 0.50 \\, \\mathrm{s}$ 时的芯片温度。解决方案涉及多步分析：首先，确定变化前的初始稳态温度；其次，确定变化后的新功耗；第三，求解瞬态热响应。\n\n首先，我们建立一个性能模型来计算每周期指令数（IPC），用 $R$ 表示。提交宽度 $W_c$ 是在没有停顿的情况下每个周期可以处理的最大指令数，由 $W_c = \\min(W_{\\text{issue}}, W_{\\text{fetch}})$ 给出。停顿是由分支预测错误引入的。设 $S$ 为因停顿而损失的周期比例。则有效 IPC 为 $R = W_c (1 - S)$。\n\n在 $N_{\\text{cyc}}$ 个周期的长时间间隔内提交的指令数是 $N_{\\text{inst}} = R \\times N_{\\text{cyc}}$。分支数是 $N_{\\text{branch}} = N_{\\text{inst}} \\times d$，其中 $d$ 是分支密度。预测错误数是 $N_{\\text{misp}} = N_{\\text{branch}} \\times m$，其中 $m$ 是预测错误概率。每次预测错误花费 $B$ 个周期，所以总停顿周期数是 $N_{\\text{stall}} = N_{\\text{misp}} \\times B = (R \\times N_{\\text{cyc}} \\times d \\times m) \\times B$。停顿周期的比例是 $S = N_{\\text{stall}} / N_{\\text{cyc}} = R \\times d \\times m \\times B$。\n\n我们得到一个关于 $R$ 和 $S$ 的方程组：\n$R = W_c (1 - S)$\n$S = R d m B$\n\n将第二个方程代入第一个方程得到 $R = W_c (1 - R d m B)$。求解 $R$：\n$R = W_c - R W_c d m B$\n$R(1 + W_c d m B) = W_c$\n$$R = \\frac{W_c}{1 + W_c d m B}$$\n\n这个表达式使我们能够计算节流前和节流后两种情况下的 IPC。\n\n状态0：节流前分析 ($t  0$)\n给定的参数是：$W_{\\text{issue}} = 4$, $W_{\\text{fetch,0}} = 4$, $d = 0.20$, $m_0 = 0.05$, 和 $B = 15$。\n提交宽度为 $W_{c,0} = \\min(4, 4) = 4$。\nIPC 为：\n$$R_0 = \\frac{W_{c,0}}{1 + W_{c,0} d m_0 B} = \\frac{4}{1 + (4)(0.20)(0.05)(15)} = \\frac{4}{1 + 0.6} = \\frac{4}{1.6} = 2.5$$\n停顿周期的比例是 $S_0 = R_0 d m_0 B = (2.5)(0.20)(0.05)(15) = 0.375$。\n\n现在，我们计算总功耗 $P_{\\text{total},0}$，它是前端动态功耗 ($P_{\\text{dyn,FE},0}$)、后端动态功耗 ($P_{\\text{dyn,BE},0}$) 和静态泄漏功耗 ($P_{\\text{leak}}$) 的总和。\n动态功耗为 $P_{\\text{dyn}} = \\alpha C V^2 f$。\n前端活动因子 $\\alpha_{\\text{FE},0}$ 是活动获取周期（比例为 $1 - S_0$）和停顿周期（比例为 $S_0$）期间活动的平均值：\n$\\alpha_{\\text{FE},0} = (1 - S_0)(W_{\\text{fetch,0}} \\alpha_{\\text{slot}}) + S_0 \\alpha_{\\text{stall}} = (1 - 0.375)(4 \\times 0.10) + (0.375)(0.02) = (0.625)(0.40) + 0.0075 = 0.25 + 0.0075 = 0.2575$。\n$P_{\\text{dyn,FE},0} = \\alpha_{\\text{FE},0} C_{\\text{FE}} V^2 f = (0.2575)(2.0 \\times 10^{-9} \\, \\mathrm{F})(1.0 \\, \\mathrm{V})^2(3.0 \\times 10^9 \\, \\mathrm{Hz}) = 1.545 \\, \\mathrm{W}$。\n\n后端活动因子与 IPC 成正比：$\\alpha_{\\text{BE},0} = R_0 \\alpha_u = (2.5)(0.10) = 0.25$。\n$P_{\\text{dyn,BE},0} = \\alpha_{\\text{BE},0} C_{\\text{BE}} V^2 f = (0.25)(8.0 \\times 10^{-9} \\, \\mathrm{F})(1.0 \\, \\mathrm{V})^2(3.0 \\times 10^9 \\, \\mathrm{Hz}) = 6.0 \\, \\mathrm{W}$。\n\n节流前的总功耗为：\n$P_{\\text{total},0} = P_{\\text{dyn,FE},0} + P_{\\text{dyn,BE},0} + P_{\\text{leak}} = 1.545 \\, \\mathrm{W} + 6.0 \\, \\mathrm{W} + 3.0 \\, \\mathrm{W} = 10.545 \\, \\mathrm{W}$。\n\n在 $t0$ 时，处理器处于稳态温度 $T(0)$。稳态关系为 $T_{\\text{ss}} = T_{\\text{amb}} + P_{\\text{total}} R_{\\text{th}}$。\n$T(0) = T_{\\text{amb}} + P_{\\text{total},0} R_{\\text{th}} = 25 \\, ^{\\circ}\\mathrm{C} + (10.545 \\, \\mathrm{W})(1.0 \\, \\mathrm{K/W}) = 35.545 \\, ^{\\circ}\\mathrm{C}$。\n\n状态1：节流后分析 ($t \\ge 0$)\n在 $t = 0$ 时，参数变为 $W_{\\text{fetch,1}} = 2$ 和 $m_1 = 0.08$。\n新的提交宽度为 $W_{c,1} = \\min(4, 2) = 2$。\n新的 IPC 为：\n$$R_1 = \\frac{W_{c,1}}{1 + W_{c,1} d m_1 B} = \\frac{2}{1 + (2)(0.20)(0.08)(15)} = \\frac{2}{1 + 0.48} = \\frac{2}{1.48} = \\frac{50}{37} \\approx 1.35135$$\n新的停顿周期比例是 $S_1 = R_1 d m_1 B = (\\frac{50}{37})(0.20)(0.08)(15) = \\frac{12}{37} \\approx 0.32432$。\n\n计算新的总功耗 $P_{\\text{total},1}$：\n$\\alpha_{\\text{FE},1} = (1 - S_1)(W_{\\text{fetch,1}} \\alpha_{\\text{slot}}) + S_1 \\alpha_{\\text{stall}} = (1 - \\frac{12}{37})(2 \\times 0.10) + (\\frac{12}{37})(0.02) = (\\frac{25}{37})(0.20) + \\frac{0.24}{37} = \\frac{5}{37} + \\frac{0.24}{37} = \\frac{5.24}{37}$。\n$P_{\\text{dyn,FE},1} = \\alpha_{\\text{FE},1} C_{\\text{FE}} V^2 f = (\\frac{5.24}{37})(2.0 \\times 10^{-9} \\, \\mathrm{F})(1.0 \\, \\mathrm{V})^2(3.0 \\times 10^9 \\, \\mathrm{Hz}) = \\frac{31.44}{37} \\, \\mathrm{W}$。\n\n$\\alpha_{\\text{BE},1} = R_1 \\alpha_u = (\\frac{50}{37})(0.10) = \\frac{5}{37}$。\n$P_{\\text{dyn,BE},1} = \\alpha_{\\text{BE},1} C_{\\text{BE}} V^2 f = (\\frac{5}{37})(8.0 \\times 10^{-9} \\, \\mathrm{F})(1.0 \\, \\mathrm{V})^2(3.0 \\times 10^9 \\, \\mathrm{Hz}) = \\frac{120}{37} \\, \\mathrm{W}$。\n\n节流后的总功耗为：\n$P_{\\text{total},1} = P_{\\text{dyn,FE},1} + P_{\\text{dyn,BE},1} + P_{\\text{leak}} = \\frac{31.44}{37} \\, \\mathrm{W} + \\frac{120}{37} \\, \\mathrm{W} + 3.0 \\, \\mathrm{W} = \\frac{151.44}{37} + 3.0 = \\frac{151.44 + 111}{37} = \\frac{262.44}{37} \\, \\mathrm{W} \\approx 7.093 \\, \\mathrm{W}$。\n\n最后，我们对瞬态热行为进行建模。该系统由以下一阶微分方程描述：\n$C_{\\text{th}} \\frac{dT}{dt} + \\frac{T(t) - T_{\\text{amb}}}{R_{\\text{th}}} = P_{\\text{total},1}$ for $t \\ge 0$。\n该方程在初始条件 $T(0)$ 下的解为：\n$T(t) = T_{\\text{ss},1} + (T(0) - T_{\\text{ss},1}) \\exp(-t/\\tau_{\\text{th}})$\n其中 $\\tau_{\\text{th}} = R_{\\text{th}} C_{\\text{th}}$ 是热时间常数， $T_{\\text{ss},1}$ 是新的稳态温度。\n\n新的稳态温度为：\n$T_{\\text{ss},1} = T_{\\text{amb}} + P_{\\text{total},1} R_{\\text{th}} = 25 \\, ^{\\circ}\\mathrm{C} + (\\frac{262.44}{37} \\, \\mathrm{W})(1.0 \\, \\mathrm{K/W}) = 25 + \\frac{262.44}{37} \\, ^{\\circ}\\mathrm{C} \\approx 32.093 \\, ^{\\circ}\\mathrm{C}$。\n\n热时间常数为：\n$\\tau_{\\text{th}} = R_{\\text{th}} C_{\\text{th}} = (1.0 \\, \\mathrm{K/W})(20 \\, \\mathrm{J/K}) = 20 \\, \\mathrm{s}$。\n\n现在我们可以计算在 $t = 0.50 \\, \\mathrm{s}$ 时的温度：\n$T(0.50) = T_{\\text{ss},1} + (T(0) - T_{\\text{ss},1}) \\exp(-0.50/\\tau_{\\text{th}})$\n$T(0.50) = (25 + \\frac{262.44}{37}) + \\left(35.545 - (25 + \\frac{262.44}{37})\\right) \\exp(-0.50/20)$\n$T(0.50) = (32.09297...) + (35.545 - 32.09297...) \\exp(-0.025)$\n$T(0.50) = 32.09297... + (3.452027...) \\exp(-0.025)$\n使用 $\\exp(-0.025) \\approx 0.9753099$：\n$T(0.50) \\approx 32.09297 + (3.452027)(0.9753099) \\approx 32.09297 + 3.36680 \\approx 35.45977 \\, ^{\\circ}\\mathrm{C}$。\n\n四舍五入到四位有效数字得到 $35.46 \\, ^{\\circ}\\mathrm{C}$。", "answer": "$$\\boxed{35.46}$$", "id": "3685015"}, {"introduction": "最后一个练习从热分析过渡到控制系统设计。您将研究一个根据温度反馈调整时钟频率的闭环热管理系统。通过对系统动态进行线性化并在离散时间内分析其稳定性，您将推导出控制器“ aggressiveness ”的限制，并比较不同的硬件策略（如自适应发射宽度）如何影响整体系统稳定性，从而深入了解设计稳健的动态电压频率调整（DVFS）控制器所面临的挑战。[@problem_id:3685016]", "problem": "一个指令发射宽度为 $W$ 的超标量处理器核心使用一个热管理回路，该回路根据芯片温度 $T$ 调节时钟频率 $f$。芯片和封装的热动态特性由单个集总热容 $C_{\\mathrm{th}}$ 和热阻 $R_{\\mathrm{th}}$ 建模，因此能量平衡服从以下方程\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} \\;=\\; -\\frac{T - T_{\\mathrm{amb}}}{R_{\\mathrm{th}}} \\;+\\; P(f,W).\n$$\n假设在感兴趣的工作区域内，电源电压保持不变（因此动态电压和频率缩放 (DVFS) 简化为仅频率控制），漏电被吸收为一个恒定的偏移量，动态功耗与指令发射宽度和频率的乘积成正比：\n$$\nP(f,W) \\;=\\; \\beta\\, W\\, f \\;+\\; P_0,\n$$\n其中 $\\beta$ 是一个正常数，$P_0$ 是一个恒定的偏移量。\n\n控制器每 $h$ 秒采样一次温度。在每个采样时刻 $k$，它根据一个比例定律设置时钟频率：\n$$\nf_k \\;=\\; f^{\\ast} \\;+\\; K_f \\left(T_{\\mathrm{ref}} - T_k\\right),\n$$\n其中 $K_f$ 是比例增益，$T_{\\mathrm{ref}}$ 是温度设定点，$(\\cdot)^{\\ast}$ 表示进行线性化时所围绕的平衡值。\n\n考虑两种指令发射宽度策略：\n- 固定宽度策略：$W_k$ 保持在一个恒定的值 $W^{\\ast}$。\n- 带滞回的自适应宽度策略：$W_k$ 在以 $T_{\\mathrm{ref}}$ 为中心、宽度为 $\\Delta T_h$ 的对称滞回带内，在 $W_{\\mathrm{high}}$ 和 $W_{\\mathrm{low}}$ 之间切换。对于滞回带内围绕 $T_{\\mathrm{ref}}$ 的小振荡，将切换效应近似为准线性描述函数斜率 $dW/dT \\approx -\\Delta W / \\Delta T_h$，其中 $\\Delta W = W_{\\mathrm{high}} - W_{\\mathrm{low}}$。\n\n任务：\n1. 从连续时间能量平衡出发，推导围绕平衡点 $(T^{\\ast}, f^{\\ast}, W^{\\ast})$ 的一阶前向欧拉离散时间线性化温度更新，用小偏差 $\\delta T_k = T_k - T^{\\ast}$、$\\delta f_k = f_k - f^{\\ast}$ 和 $\\delta W_k = W_k - W^{\\ast}$ 表示。用 $h$、$C_{\\mathrm{th}}$、$R_{\\mathrm{th}}$、$\\beta$、$f^{\\ast}$ 和 $W^{\\ast}$ 表示乘以 $\\delta T_k$、$\\delta f_k$ 和 $\\delta W_k$ 的系数。\n2. 将结果应用于每种策略，以获得一维闭环映射 $\\delta T_{k+1} = \\lambda\\, \\delta T_k$，并从第一性原理推导保证 $\\delta T_k$ 渐近收敛且无符号交替（即，在离散时间意义上，没有围绕 $T_{\\mathrm{ref}}$ 的振荡）的 $K_f$ 条件。以闭合形式表示每种策略下允许的最大 $K_f$，记为 $K_{f,\\max}^{\\mathrm{fixed}}$ 和 $K_{f,\\max}^{\\mathrm{adapt}}$。\n3. 使用参数 $C_{\\mathrm{th}} = 10\\,\\mathrm{J/K}$、$R_{\\mathrm{th}} = 0.5\\,\\mathrm{K/W}$、$h = 0.1\\,\\mathrm{s}$、$\\beta = 5\\,\\mathrm{W}/(\\mathrm{GHz}\\cdot\\text{issue})$、$f^{\\ast} = 3\\,\\mathrm{GHz}$、$W_{\\mathrm{high}} = 4$、$W_{\\mathrm{low}} = 2$ 和 $\\Delta T_h = 4\\,\\mathrm{K}$，计算比率\n$$\n\\mathcal{R} \\;=\\; \\frac{K_{f,\\max}^{\\mathrm{adapt}}}{K_{f,\\max}^{\\mathrm{fixed}}}.\n$$\n\n将您对 $\\mathcal{R}$ 的最终答案四舍五入到四位有效数字。将最终答案表示为无量纲小数。", "solution": "该问题需要对处理器核心的简化热控制系统进行多步分析。求解过程首先是推导通用的线性化离散时间动态，然后将此模型应用于两种不同的控制策略，分析它们的稳定性，最后计算最大允许增益的比率。\n\n**任务1：线性化离散时间温度更新**\n\n出发点是集总热模型的连续时间能量平衡方程：\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = -\\frac{T - T_{\\mathrm{amb}}}{R_{\\mathrm{th}}} + P(f,W)\n$$\n代入给定的功耗模型 $P(f,W) = \\beta W f + P_0$，得到：\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = -\\frac{T - T_{\\mathrm{amb}}}{R_{\\mathrm{th}}} + \\beta W f + P_0\n$$\n为了线性化该系统，我们考虑围绕稳态平衡点 $(T^{\\ast}, f^{\\ast}, W^{\\ast})$ 的小扰动。设 $T(t) = T^{\\ast} + \\delta T(t)$，$f(t) = f^{\\ast} + \\delta f(t)$ 和 $W(t) = W^{\\ast} + \\delta W(t)$。温度的时间导数为 $\\frac{dT}{dt} = \\frac{d(\\delta T)}{dt}$。在平衡状态下，$\\frac{dT}{dt} = 0$。\n非线性方程可以写成 $\\frac{dT}{dt} = G(T, f, W)$，其中\n$$\nG(T, f, W) = \\frac{1}{C_{\\mathrm{th}}} \\left( -\\frac{T - T_{\\mathrm{amb}}}{R_{\\mathrm{th}}} + \\beta W f + P_0 \\right)\n$$\n扰动的线性化动态由下式给出：\n$$\n\\frac{d(\\delta T)}{dt} \\approx \\frac{\\partial G}{\\partial T}\\bigg|_{*} \\delta T + \\frac{\\partial G}{\\partial f}\\bigg|_{*} \\delta f + \\frac{\\partial G}{\\partial W}\\bigg|_{*} \\delta W\n$$\n在平衡点 $(T^{\\ast}, f^{\\ast}, W^{\\ast})$ 处求得的偏导数是：\n$$\n\\frac{\\partial G}{\\partial T} = -\\frac{1}{C_{\\mathrm{th}} R_{\\mathrm{th}}}\n$$\n$$\n\\frac{\\partial G}{\\partial f} = \\frac{\\beta W}{C_{\\mathrm{th}}} \\implies \\frac{\\partial G}{\\partial f}\\bigg|_{*} = \\frac{\\beta W^{\\ast}}{C_{\\mathrm{th}}}\n$$\n$$\n\\frac{\\partial G}{\\partial W} = \\frac{\\beta f}{C_{\\mathrm{th}}} \\implies \\frac{\\partial G}{\\partial W}\\bigg|_{*} = \\frac{\\beta f^{\\ast}}{C_{\\mathrm{th}}}\n$$\n因此，线性化的连续时间模型是：\n$$\n\\frac{d(\\delta T)}{dt} = -\\frac{1}{C_{\\mathrm{th}} R_{\\mathrm{th}}} \\delta T + \\frac{\\beta W^{\\ast}}{C_{\\mathrm{th}}} \\delta f + \\frac{\\beta f^{\\ast}}{C_{\\mathrm{th}}} \\delta W\n$$\n为了获得离散时间模型，我们应用时间步长为 $h$ 的一阶前向欧拉方法。控制器的输出在采样区间 $[t_k, t_{k+1})$ 内是恒定的，所以我们有 $\\delta T_{k+1} \\approx \\delta T_k + h \\frac{d(\\delta T)}{dt}\\big|_{t=t_k}$。\n$$\n\\delta T_{k+1} = \\delta T_k + h \\left( -\\frac{1}{C_{\\mathrm{th}} R_{\\mathrm{th}}} \\delta T_k + \\frac{\\beta W^{\\ast}}{C_{\\mathrm{th}}} \\delta f_k + \\frac{\\beta f^{\\ast}}{C_{\\mathrm{th}}} \\delta W_k \\right)\n$$\n按扰动项对各项进行分组，我们得到所要求的离散时间更新方程：\n$$\n\\delta T_{k+1} = \\left( 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} \\right) \\delta T_k + \\left( \\frac{h \\beta W^{\\ast}}{C_{\\mathrm{th}}} \\right) \\delta f_k + \\left( \\frac{h \\beta f^{\\ast}}{C_{\\mathrm{th}}} \\right) \\delta W_k\n$$\n因此，系数为：\n- $\\delta T_k$ 的系数：$\\left( 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} \\right)$\n- $\\delta f_k$ 的系数：$\\frac{h \\beta W^{\\ast}}{C_{\\mathrm{th}}}$\n- $\\delta W_k$ 的系数：$\\frac{h \\beta f^{\\ast}}{C_{\\mathrm{th}}}$\n\n**任务2：稳定性和最大增益 $K_f$ 分析**\n\n我们现在通过代入 $\\delta f_k$ 和 $\\delta W_k$ 的控制律来构成闭环系统。比例频率控制律为 $f_k = f^{\\ast} + K_f (T_{\\mathrm{ref}} - T_k)$。用扰动来表示，并注意到平衡温度 $T^{\\ast}$ 就是设定点 $T_{\\mathrm{ref}}$，我们有 $\\delta T_k = T_k - T^{\\ast} = T_k - T_{\\mathrm{ref}}$。\n因此，$\\delta f_k = f_k - f^{\\ast} = K_f (T_{\\mathrm{ref}} - T_k) = -K_f \\delta T_k$。\n\n闭环系统的形式为 $\\delta T_{k+1} = \\lambda \\delta T_k$。为实现无符号交替的渐近收敛（非振荡衰减），离散时间特征值 $\\lambda$ 必须满足 $0 \\le \\lambda  1$。系统在 $|\\lambda|  1$ 时稳定，在 $\\lambda \\ge 0$ 时非振荡。由于对于任何正的 $K_f$，$\\lambda$ 都将是 $K_f$ 的递减函数且小于1，因此关键约束是 $\\lambda \\ge 0$。这决定了最大允许增益 $K_{f,\\max}$。\n\n**策略1：固定宽度策略**\n这里，$W_k = W^{\\ast}$，这意味着 $\\delta W_k = W_k - W^{\\ast} = 0$。将 $\\delta f_k$ 和 $\\delta W_k$ 代入离散时间方程：\n$$\n\\delta T_{k+1} = \\left( 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} \\right) \\delta T_k + \\left( \\frac{h \\beta W^{\\ast}}{C_{\\mathrm{th}}} \\right) (-K_f \\delta T_k) + 0\n$$\n$$\n\\delta T_{k+1} = \\left( 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} - \\frac{h \\beta W^{\\ast} K_f}{C_{\\mathrm{th}}} \\right) \\delta T_k\n$$\n特征值为 $\\lambda_{\\mathrm{fixed}} = 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} - \\frac{h \\beta W^{\\ast} K_f}{C_{\\mathrm{th}}}$。\n条件 $\\lambda_{\\mathrm{fixed}} \\ge 0$ 给出：\n$$\n1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} - \\frac{h \\beta W^{\\ast} K_f}{C_{\\mathrm{th}}} \\ge 0 \\implies K_f \\le \\frac{C_{\\mathrm{th}}}{h \\beta W^{\\ast}}\\left(1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}}\\right)\n$$\n因此，最大增益为：\n$$\nK_{f,\\max}^{\\mathrm{fixed}} = \\frac{C_{\\mathrm{th}} - h/R_{\\mathrm{th}}}{h \\beta W^{\\ast}}\n$$\n\n**策略2：自适应宽度策略**\n对于此策略，指令发射宽度的变化通过围绕 $T_{\\mathrm{ref}}$ 的小振荡的描述函数来近似：$\\frac{dW}{dT} \\approx -\\frac{\\Delta W}{\\Delta T_h}$。用离散扰动来表示，这给出 $\\delta W_k \\approx -\\frac{\\Delta W}{\\Delta T_h} \\delta T_k$。\n将 $\\delta f_k$ 和 $\\delta W_k$ 都代入通用的离散时间模型中：\n$$\n\\delta T_{k+1} = \\left( 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} \\right) \\delta T_k + \\left( \\frac{h \\beta W^{\\ast}}{C_{\\mathrm{th}}} \\right) (-K_f \\delta T_k) + \\left( \\frac{h \\beta f^{\\ast}}{C_{\\mathrm{th}}} \\right) \\left( -\\frac{\\Delta W}{\\Delta T_h} \\delta T_k \\right)\n$$\n特征值为 $\\lambda_{\\mathrm{adapt}} = 1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} - \\frac{h \\beta W^{\\ast} K_f}{C_{\\mathrm{th}}} - \\frac{h \\beta f^{\\ast} \\Delta W}{C_{\\mathrm{th}} \\Delta T_h}$。\n条件 $\\lambda_{\\mathrm{adapt}} \\ge 0$ 给出：\n$$\n1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} - \\frac{h \\beta f^{\\ast} \\Delta W}{C_{\\mathrm{th}} \\Delta T_h} \\ge \\frac{h \\beta W^{\\ast} K_f}{C_{\\mathrm{th}}} \\implies K_f \\le \\frac{C_{\\mathrm{th}}}{h \\beta W^{\\ast}}\\left(1 - \\frac{h}{C_{\\mathrm{th}} R_{\\mathrm{th}}} - \\frac{h \\beta f^{\\ast} \\Delta W}{C_{\\mathrm{th}} \\Delta T_h}\\right)\n$$\n因此，最大增益为：\n$$\nK_{f,\\max}^{\\mathrm{adapt}} = \\frac{C_{\\mathrm{th}} - h/R_{\\mathrm{th}}}{h \\beta W^{\\ast}} - \\frac{f^{\\ast}\\Delta W}{W^{\\ast}\\Delta T_h}\n$$\n值得注意的是，该表达式可以写成 $K_{f,\\max}^{\\mathrm{adapt}} = K_{f,\\max}^{\\mathrm{fixed}} - \\frac{f^{\\ast}\\Delta W}{W^{\\ast}\\Delta T_h}$。\n\n**任务3：比率 $\\mathcal{R}$ 的计算**\n\n我们被要求计算比率 $\\mathcal{R} = \\frac{K_{f,\\max}^{\\mathrm{adapt}}}{K_{f,\\max}^{\\mathrm{fixed}}}$。使用上面推导的表达式：\n$$\n\\mathcal{R} = \\frac{K_{f,\\max}^{\\mathrm{fixed}} - \\frac{f^{\\ast}\\Delta W}{W^{\\ast}\\Delta T_h}}{K_{f,\\max}^{\\mathrm{fixed}}} = 1 - \\frac{1}{K_{f,\\max}^{\\mathrm{fixed}}} \\frac{f^{\\ast}\\Delta W}{W^{\\ast}\\Delta T_h}\n$$\n代入 $K_{f,\\max}^{\\mathrm{fixed}}$ 的表达式：\n$$\n\\mathcal{R} = 1 - \\left( \\frac{h \\beta W^{\\ast}}{C_{\\mathrm{th}} - h/R_{\\mathrm{th}}} \\right) \\left( \\frac{f^{\\ast}\\Delta W}{W^{\\ast}\\Delta T_h} \\right)\n$$\n代表平衡指令发射宽度的项 $W^{\\ast}$（对于自适应策略可能不明确）很方便地被消掉了。\n$$\n\\mathcal{R} = 1 - \\frac{h \\beta f^{\\ast} \\Delta W}{\\Delta T_h (C_{\\mathrm{th}} - h/R_{\\mathrm{th}})}\n$$\n为简化计算中的分母，我们可以将其写为 $\\Delta T_h \\frac{C_{\\mathrm{th}}R_{\\mathrm{th}} - h}{R_{\\mathrm{th}}}$。比率的表达式变为：\n$$\n\\mathcal{R} = 1 - \\frac{h \\beta f^{\\ast} \\Delta W R_{\\mathrm{th}}}{\\Delta T_h (C_{\\mathrm{th}} R_{\\mathrm{th}} - h)}\n$$\n现在，我们代入给定的数值：\n$C_{\\mathrm{th}} = 10\\,\\mathrm{J/K}$\n$R_{\\mathrm{th}} = 0.5\\,\\mathrm{K/W}$\n$h = 0.1\\,\\mathrm{s}$\n$\\beta = 5\\,\\mathrm{W}/(\\mathrm{GHz}\\cdot\\text{issue})$\n$f^{\\ast} = 3\\,\\mathrm{GHz}$\n$W_{\\mathrm{high}} = 4$, $W_{\\mathrm{low}} = 2 \\implies \\Delta W = W_{\\mathrm{high}} - W_{\\mathrm{low}} = 2$\n$\\Delta T_h = 4\\,\\mathrm{K}$\n\n首先，我们计算乘积 $C_{\\mathrm{th}} R_{\\mathrm{th}}$，即热时间常数 $\\tau_{\\mathrm{th}}$：\n$$\n\\tau_{\\mathrm{th}} = C_{\\mathrm{th}} R_{\\mathrm{th}} = (10\\,\\mathrm{J/K})(0.5\\,\\mathrm{K/W}) = 5\\,\\mathrm{J/W} = 5\\,\\mathrm{s}\n$$\n现在我们计算 $\\mathcal{R}$ 表达式中分数部分的分子：\n$$\n\\text{Numerator} = h \\beta f^{\\ast} \\Delta W R_{\\mathrm{th}} = (0.1)(5)(3)(2)(0.5) = 1.5\n$$\n分子的单位：$\\mathrm{s} \\cdot \\frac{\\mathrm{W}}{\\mathrm{GHz} \\cdot \\mathrm{issue}} \\cdot \\mathrm{GHz} \\cdot \\mathrm{issue} \\cdot \\frac{\\mathrm{K}}{\\mathrm{W}} = \\mathrm{s} \\cdot \\mathrm{K}$。\n\n接下来，我们计算分母：\n$$\n\\text{Denominator} = \\Delta T_h (C_{\\mathrm{th}} R_{\\mathrm{th}} - h) = (4)(5 - 0.1) = 4 \\times 4.9 = 19.6\n$$\n分母的单位：$\\mathrm{K} \\cdot (\\mathrm{s}) = \\mathrm{K} \\cdot \\mathrm{s}$。\n\n正如预期的那样，该分数为无量纲。\n$$\n\\frac{1.5}{19.6} = \\frac{15}{196} \\approx 0.076530612...\n$$\n最后，我们计算 $\\mathcal{R}$：\n$$\n\\mathcal{R} = 1 - \\frac{1.5}{19.6} = 1 - 0.076530612... = 0.923469387...\n$$\n四舍五入到四位有效数字得到 $\\mathcal{R} = 0.9235$。这表明自适应宽度策略将频率控制器的最大非振荡增益降低了约 $7.65\\%$。", "answer": "$$\\boxed{0.9235}$$", "id": "3685016"}]}