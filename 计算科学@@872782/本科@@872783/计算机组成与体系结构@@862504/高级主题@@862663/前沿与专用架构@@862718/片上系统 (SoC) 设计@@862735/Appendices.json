{"hands_on_practices": [{"introduction": "在片上系统（SoC）设计中，集成专用硬件加速器是提升性能的常用策略。然而，在投入昂贵的设计和验证资源之前，架构师必须首先评估潜在的性能收益。本练习将运用计算机体系结构中的一个基本定律——Amdahl定律（Amdahl's Law），来量化这一收益。通过分析工作负载中可被加速部分的比例 $p$，你将学会如何预测整体系统加速比，并理解“收益递减”原则在SoC性能优化中的实际意义 ([@problem_id:3684378])。", "problem": "我们正在评估一个集成了固定功能高级加密标准 (AES) 加速器的系统级芯片 (SoC)。在未加速的基准系统中，一个代表性工作负载的总执行时间被归一化为 $1$。该基准时间中有比例为 $p$ 的部分用于 AES 计算，剩余比例为 $1-p$ 的部分用于非 AES 工作。当集成 AES 加速器后，它对 AES 部分提供了相对于在通用核上运行的基准软件 20 倍的加速；非 AES 部分不受影响。\n\n从加速比 $S$ 的定义 $S=\\frac{T_{\\text{base}}}{T_{\\text{new}}}$ 出发，并仅使用将执行时间划分为 AES 和非 AES 部分的方法，推导出当 AES 部分被加速 20 倍时，总加速比 $S$ 作为 $p$ 的函数。然后，确定要使总加速比满足 $S \\ge 3$ 所需的 $p$ 的最小值。\n\n将最小的 $p$ 表示为一个精确的分数。无需进行四舍五入。", "solution": "### 解题过程\n\n设 $T_{\\text{base}}$ 为工作负载在基准系统上的总执行时间。根据题意，我们将其归一化为 $1$。\n$$T_{\\text{base}} = 1$$\n总执行时间由两部分组成：用于 AES 计算的时间和用于非 AES 工作的时间。用于 AES 计算的时间比例为 $p$。因此，在基准系统中 AES 部分所需的时间为：\n$$T_{\\text{AES,base}} = p \\times T_{\\text{base}} = p \\times 1 = p$$\n剩余的时间比例 $1-p$ 用于非 AES 部分：\n$$T_{\\text{non-AES,base}} = (1-p) \\times T_{\\text{base}} = (1-p) \\times 1 = 1-p$$\n\n接下来，我们考虑带有 AES 加速器的新系统。设 $T_{\\text{new}}$ 为在这个新系统上的总执行时间。AES 加速器为工作负载的 AES 部分提供了 20 倍的加速。AES 部分的新执行时间 $T_{\\text{AES,new}}$ 是原始时间除以加速因子：\n$$T_{\\text{AES,new}} = \\frac{T_{\\text{AES,base}}}{20} = \\frac{p}{20}$$\n工作负载的非 AES 部分不受加速器影响，因此其执行时间保持不变：\n$$T_{\\text{non-AES,new}} = T_{\\text{non-AES,base}} = 1-p$$\n新系统的总执行时间是其各部分执行时间之和：\n$$T_{\\text{new}} = T_{\\text{non-AES,new}} + T_{\\text{AES,new}} = (1-p) + \\frac{p}{20}$$\n\n总加速比 $S$ 定义为基准执行时间与新执行时间之比。代入 $T_{\\text{base}}$ 和 $T_{\\text{new}}$ 的表达式，我们可以推导出总加速比 $S$ 作为 $p$ 的函数：\n$$S(p) = \\frac{T_{\\text{base}}}{T_{\\text{new}}} = \\frac{1}{(1-p) + \\frac{p}{20}}$$\n这个表达式表示了总加速比是作为被加速的工作负载比例的函数。这是要求推导的第一部分。\n\n为了简化分母：\n$$S(p) = \\frac{1}{\\frac{20(1-p)}{20} + \\frac{p}{20}} = \\frac{1}{\\frac{20 - 20p + p}{20}} = \\frac{20}{20 - 19p}$$\n\n问题的第二部分要求我们找到使总加速比 $S$ 至少为 $3$ 的 $p$ 的最小值。我们建立不等式：\n$$S(p) \\ge 3$$\n$$\\frac{20}{20 - 19p} \\ge 3$$\n因为 $p$ 代表执行时间的一部分，所以必然有 $0 \\le p \\le 1$。对于这个范围内的 $p$，分母 $20 - 19p$ 总是正数。当 $p=0$ 时，分母是 $20$。当 $p=1$ 时，分母是 $1$。因此，我们可以在不等式两边同时乘以 $20 - 19p$ 而不改变不等号的方向。\n$$20 \\ge 3(20 - 19p)$$\n$$20 \\ge 60 - 57p$$\n现在，我们求解 $p$：\n$$57p \\ge 60 - 20$$\n$$57p \\ge 40$$\n$$p \\ge \\frac{40}{57}$$\n因此，满足条件 $S \\ge 3$ 的 $p$ 的最小值是 $\\frac{40}{57}$。由于题目要求一个精确的分数，这就是最终答案。\n快速验证：如果 $p = \\frac{40}{57}$，那么 $S = \\frac{20}{20 - 19(\\frac{40}{57})} = \\frac{20}{20 - \\frac{760}{57}} = \\frac{20}{\\frac{1140 - 760}{57}} = \\frac{20}{\\frac{380}{57}} = \\frac{20 \\times 57}{380} = \\frac{57}{19} = 3$。这证实了边界条件得到满足。", "answer": "$$\\boxed{\\frac{40}{57}}$$", "id": "3684378"}, {"introduction": "片上系统（SoC）的整体性能不仅取决于其处理核心的速度，还严重依赖于连接所有组件的通信“骨干”——片上互连（interconnect）。本练习将带你深入分析AXI总线的性能，这是一种在现代SoC中广泛使用的标准接口协议。通过计算，你将区分理论峰值带宽与更贴近实际的有效带宽，并理解协议开销（如突发传输间的“气泡”）和总线利用率如何影响真实世界的数据吞吐能力 ([@problem_id:3684382])。", "problem": "一个片上系统 (SoC) 互连使用一个高级微控制器总线架构高级可扩展接口第4版 (AMBA AXI4) 写数据通道，其数据总线为 $64$ 位，时钟频率为 $500\\,\\text{MHz}$。假设采用单数据速率同步接口，当 VALID 和 READY 信号持续有效时，每个时钟周期最多传输一个数据节拍。一次突发传输由数据通道上的 $L$ 个连续数据节拍组成。假设任何时候只有一个未完成的突发传输，并且由于地址/控制握手和突发边界效应，连续突发传输之间平均存在一个时钟周期的空闲（bubble）；忽略任何额外的影响，如纠错码 (ECC)、交错或响应通道反压。\n\n1. 仅使用带宽的基本定义（即每次传输的数据量乘以每秒的传输次数），计算当突发传输背靠背进行、无停顿且忽略协议开销时，数据通道的理论峰值持续带宽。\n\n2. 现在假设在长时间窗口内，互连仲裁器授予该主设备数据通道的平均利用率为 $u=0.70$，并且在上述每个突发传输单个空闲周期的假设下，平均突发长度为 $L=8$ 个节拍。估算数据通道的长期有效带宽。\n\n两个结果都以 $\\text{GB/s}$ 为单位表示，并使用十进制约定 $1\\,\\text{GB}=10^{9}\\,\\text{B}$。将两个数值答案四舍五入到四位有效数字。以 $\\big($峰值带宽, 有效带宽$\\big)$ 的顺序，将最终数值结果表示为一个二元行向量。", "solution": "### 第1部分：理论峰值持续带宽\n\n理论峰值持续带宽 $BW_{peak}$ 定义为最大数据传输速率。这种情况发生在每个时钟周期都传输数据，没有任何停顿或协议开销。\n\n单个节拍传输的数据量等于数据总线宽度 $W_{bus}$。我们将其从位（bit）转换为字节（Byte）：\n$$ W_{bus} = 64\\,\\text{bits} \\times \\frac{1\\,\\text{Byte}}{8\\,\\text{bits}} = 8\\,\\text{Bytes} $$\n\n传输速率由时钟频率 $f_{clk}$ 决定，因为接口是单数据速率，并且我们假设每个周期都发生一次传输。\n$$ f_{clk} = 500\\,\\text{MHz} = 500 \\times 10^{6}\\,\\text{Hz} = 500 \\times 10^{6}\\,\\text{cycles/second} $$\n在峰值情况下，传输速率为 $500 \\times 10^{6}\\,\\text{beats/second}$。\n\n峰值带宽是每个节拍的数据量与每秒节拍数的乘积：\n$$ BW_{peak} = W_{bus} \\times f_{clk} $$\n$$ BW_{peak} = (8\\,\\text{Bytes/beat}) \\times (500 \\times 10^{6}\\,\\text{beats/second}) $$\n$$ BW_{peak} = 4000 \\times 10^{6}\\,\\text{Bytes/second} = 4 \\times 10^{9}\\,\\text{Bytes/second} $$\n\n使用给定的十进制约定 ($1\\,\\text{GB} = 10^{9}\\,\\text{B}$):\n$$ BW_{peak} = 4\\,\\text{GB/s} $$\n\n四舍五入到四位有效数字，结果是 $4.000\\,\\text{GB/s}$。\n\n### 第2部分：长期有效带宽\n\n长期有效带宽 $BW_{eff}$ 考虑了协议层面的低效率和仲裁。给出了两个效率低下的来源：突发之间的单周期空闲和仲裁器利用率。\n\n首先，我们计算由突发结构引起的数据传输效率 $\\eta_{burst}$。一次事务由 $L$ 个数据节拍的突发和随后的一个 $1$ 周期空闲组成。\n一次突发中传输数据所需的时钟周期数为 $L$。\n一次完整的突发事务（数据加开销）的总时钟周期数为 $L+1$。\n\n效率是用于数据传输的周期数与事务总周期数的比率：\n$$ \\eta_{burst} = \\frac{\\text{Data transfer cycles}}{\\text{Total cycles}} = \\frac{L}{L+1} $$\n\n给定平均突发长度 $L=8$:\n$$ \\eta_{burst} = \\frac{8}{8+1} = \\frac{8}{9} $$\n\n其次，互连接口仲裁器仅在部分时间内授予该主设备对数据通道的访问权限，该部分时间由利用率 $u=0.70$ 给出。\n\n有效带宽是理论峰值带宽乘以这两个低效率因子的结果：\n$$ BW_{eff} = BW_{peak} \\times \\eta_{burst} \\times u $$\n代入数值：\n$$ BW_{eff} = (4 \\times 10^{9}\\,\\text{B/s}) \\times \\left(\\frac{8}{9}\\right) \\times 0.70 $$\n$$ BW_{eff} = \\frac{4 \\times 8 \\times 0.70}{9} \\times 10^{9}\\,\\text{B/s} $$\n$$ BW_{eff} = \\frac{22.4}{9} \\times 10^{9}\\,\\text{B/s} $$\n$$ BW_{eff} \\approx 2.4888... \\times 10^{9}\\,\\text{B/s} $$\n$$ BW_{eff} \\approx 2.4888...\\,\\text{GB/s} $$\n\n四舍五入到四位有效数字，结果是 $2.489\\,\\text{GB/s}$。\n\n最终答案要求一个二元行向量，包含峰值带宽和有效带宽，单位均为 $\\text{GB/s}$，并四舍五入到四位有效数字。\n这两个值是 $4.000$ 和 $2.489$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 4.000  2.489 \\end{pmatrix}}\n$$", "id": "3684382"}, {"introduction": "在性能之外，功耗是SoC设计的另一个核心制约因素，尤其对于移动和嵌入式设备而言。本练习探讨了一个经典的嵌入式系统设计抉择：是使用持续“轮询”还是采用节电的“中断驱动”方式来服务外设。通过对两种方案的单位事件能耗进行量化分析，你将学会如何基于数据做出设计决策，从而优化系统的电池续航能力 ([@problem_id:3684444])。", "problem": "一个片上系统 (SoC) 集成了一个通用核心，用于服务一个周期性传感器，该传感器以 $1\\,\\text{kHz}$ 的频率（周期 $T = 1\\,\\text{ms}$）产生一个样本。考虑两种服务策略：忙等待轮询和中断驱动处理。该核心的运行时钟频率为 $f_{\\text{cpu}} = 100\\,\\text{MHz}$，电源电压为 $V = 1.0\\,\\text{V}$。使用标准动态功耗模型 $P_{\\text{dyn}} = \\alpha C_{\\text{L}} V^{2} f$，其中 $\\alpha$ 是活动因子，$C_{\\text{L}}$ 是有效开关电容。假设 $C_{\\text{L}} = 0.5\\,\\text{nF}$。在睡眠状态下，核心消耗的恒定功率为 $P_{\\text{sleep}} = 2\\,\\text{mW}$。\n\n每样本工作量在两种策略中是相同的，包括读取和处理传感器数据以及控制开销，总计 $2400$ 个周期，具体为：$1200$ 个周期用于采集，$800$ 个周期用于计算，$300$ 个周期用于控制开销，以及 $100$ 个周期用于唤醒/上下文操作。执行此工作时，活动因子为 $\\alpha_{\\text{proc}} = 0.6$。在忙等待轮询策略中，当不处理数据时，核心在整个周期内连续执行一个紧凑的状态检查循环，活动因子为 $\\alpha_{\\text{spin}} = 0.2$。在中断驱动策略中，当不处理数据时，核心进入睡眠状态；中断发生时，它执行相同的 $2400$ 个周期的工作，活动因子为 $\\alpha_{\\text{proc}} = 0.6$，然后返回睡眠状态。\n\n从第一性原理出发，分别推导轮询和中断策略中CPU处于活动状态的时间比例，即中央处理器 (CPU) 利用率 $u_{\\text{poll}}$ 和 $u_{\\text{int}}$。然后，使用动态功耗模型和睡眠功耗，推导每种策略在一个传感器周期 $T$ 内的单次事件能耗，并计算能量差 $\\Delta E = E_{\\text{poll}} - E_{\\text{int}}$。根据 $\\Delta E$ 的符号判断哪种策略在能量上更优，但仅报告所要求的数值输出。\n\n答案规格：\n- 报告CPU利用率 $u_{\\text{poll}}$ 和 $u_{\\text{int}}$，以小数形式表示（而非百分比）。\n- 报告能量差 $\\Delta E$，单位为微焦耳。\n- 将所有三个报告的量四舍五入到四位有效数字。\n\n将您的最终答案以单行矩阵 $\\begin{pmatrix} u_{\\text{poll}}  u_{\\text{int}}  \\Delta E \\end{pmatrix}$ 的形式给出。", "solution": "### 求解推导\n\n目标是计算轮询和中断两种策略的CPU利用率 ($u_{\\text{poll}}$, $u_{\\text{int}}$) 以及它们在一个传感器周期 $T$ 内的能量差 ($\\Delta E$)。\n\n首先，我们计算CPU执行每样本工作所需的时间。该工作包含 $N_{\\text{proc}} = 2400$ 个周期，CPU时钟频率为 $f_{\\text{cpu}} = 100\\,\\text{MHz}$。处理时间 $t_{\\text{proc}}$ 为：\n$$t_{\\text{proc}} = \\frac{N_{\\text{proc}}}{f_{\\text{cpu}}} = \\frac{2400\\,\\text{cycles}}{100 \\times 10^6\\,\\text{cycles/s}} = 24 \\times 10^{-6}\\,\\text{s} = 24\\,\\mu\\text{s}$$\n传感器周期给定为 $T = 1\\,\\text{ms} = 1000\\,\\mu\\text{s}$。\n\n**CPU 利用率**\n\nCPU利用率 $u$ 定义为在总周期 $T$ 内，CPU处于活动状态（非睡眠）的时间比例。\n\n对于**轮询策略**，核心始终处于活动状态，因此其利用率为 $u_{\\text{poll}} = 1.0$。\n\n对于**中断驱动策略**，核心仅在处理期间活动，其利用率为：\n$$u_{\\text{int}} = \\frac{t_{\\text{proc}}}{T} = \\frac{24\\,\\mu\\text{s}}{1000\\,\\mu\\text{s}} = 0.024$$\n\n**每周期能量消耗**\n\n首先，计算不同活动状态下的功耗。处理功耗 ($P_{\\text{proc}}$) 为：\n$$P_{\\text{proc}} = \\alpha_{\\text{proc}} C_{\\text{L}} V^{2} f = 0.6 \\times (0.5 \\times 10^{-9}\\,\\text{F}) \\times (1.0\\,\\text{V})^2 \\times (100 \\times 10^6\\,\\text{Hz}) = 30\\,\\text{mW}$$\n自旋等待功耗 ($P_{\\text{spin}}$) 为：\n$$P_{\\text{spin}} = \\alpha_{\\text{spin}} C_{\\text{L}} V^{2} f = 0.2 \\times (0.5 \\times 10^{-9}\\,\\text{F}) \\times (1.0\\,\\text{V})^2 \\times (100 \\times 10^6\\,\\text{Hz}) = 10\\,\\text{mW}$$\n睡眠功耗 $P_{\\text{sleep}}$ 已知为 $2\\,\\text{mW}$。\n\n接下来，计算每个策略在一个周期 $T$ 内的总能耗。\n对于**轮询策略**，能耗为处理能耗加上自旋等待能耗：\n$$E_{\\text{poll}} = (P_{\\text{proc}} \\times t_{\\text{proc}}) + (P_{\\text{spin}} \\times (T - t_{\\text{proc}}))$$\n$$E_{\\text{poll}} = (30\\,\\text{mW} \\times 24\\,\\mu\\text{s}) + (10\\,\\text{mW} \\times 976\\,\\mu\\text{s}) = 0.72\\,\\mu\\text{J} + 9.76\\,\\mu\\text{J} = 10.48\\,\\mu\\text{J}$$\n对于**中断驱动策略**，能耗为处理能耗加上睡眠能耗：\n$$E_{\\text{int}} = (P_{\\text{proc}} \\times t_{\\text{proc}}) + (P_{\\text{sleep}} \\times (T - t_{\\text{proc}}))$$\n$$E_{\\text{int}} = (30\\,\\text{mW} \\times 24\\,\\mu\\text{s}) + (2\\,\\text{mW} \\times 976\\,\\mu\\text{s}) = 0.72\\,\\mu\\text{J} + 1.952\\,\\mu\\text{J} = 2.672\\,\\mu\\text{J}$$\n\n**能量差**\n\n最后，计算能量差 $\\Delta E = E_{\\text{poll}} - E_{\\text{int}}$:\n$$\\Delta E = 10.48\\,\\mu\\text{J} - 2.672\\,\\mu\\text{J} = 7.808\\,\\mu\\text{J}$$", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 1.000  0.02400  7.808 \\end{pmatrix}\n}\n$$", "id": "3684444"}]}