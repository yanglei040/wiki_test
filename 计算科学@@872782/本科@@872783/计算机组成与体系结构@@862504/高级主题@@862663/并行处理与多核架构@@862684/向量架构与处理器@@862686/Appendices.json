{"hands_on_practices": [{"introduction": "向量处理的强大能力始于将数据高效地加载到寄存器中。本练习探讨内存对齐这一关键概念，量化当向量加载跨越缓存行边界时产生的性能损失 [@problem_id:3687644]。理解这一点是编写高性能向量化代码的第一步。", "problem": "一个单指令多数据（SIMD）向量处理器，其一级数据缓存行大小为 $L=64$ 字节，拥有一个单向量加载单元，每周期最多可完成 $P=16$ 字节的对齐数据加载。考虑从一个由单精度浮点值组成的大型数组中进行流式加载，其中每个元素为 $4$ 字节。假设该数组驻留在一级缓存中，因此缓存命中延迟不起主导作用，且稳态吞吐量模型适用。一个向量寄存器包含 $W$ 个浮点数，因此每次加载的字节大小为 $S=4W$ 字节。对齐的向量加载定义为起始地址和加载范围完全位于单个缓存行内的加载。跨边界的向量加载定义为加载范围跨越两个不同缓存行的加载，导致硬件将该加载拆分为两部分。使用以下成本模型，该模型代表了现代向量架构中对拆分加载的处理方式：\n- 对于大小为 $S$ 字节的对齐向量加载，加载单元会发出 $\\lceil S/P \\rceil$ 个大小各为 $P$ 字节的对齐微加载，其稳态成本为每次向量加载 $\\lceil S/P \\rceil$ 个周期。\n- 对于大小为 $S$ 字节的跨边界向量加载，拆分会导致每次向量加载产生 $\\delta=1$ 周期的额外固定开销（用于地址拆分和合并），此外还有数据移动所需的 $\\lceil S/P \\rceil$ 个周期。\n\n从以上定义和给定的成本模型出发，推导对齐和跨边界向量加载的每元素周期数，然后通过比率\n$$\\rho(W)=\\frac{\\text{每元素的周期数 (跨边界)}}{\\text{每元素的周期数 (对齐)}}$$\n来量化当 $W \\in \\{4,8,16\\}$ 时的对齐惩罚。将您的最终答案表示为一个单行矩阵，其中包含按 $W$ 递增顺序排列的三个 $\\rho(W)$ 值。无需四舍五入。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于计算机体系结构的原理，特别是向量处理器性能建模。所有术语都有明确定义，前提条件一致，并提供了足够的信息来推导出唯一解。\n\n目标是推导在特定内存加载成本模型下，SIMD向量处理器的对齐惩罚比率 $\\rho(W)$。该比率定义为：\n$$\n\\rho(W) = \\frac{\\text{每元素的周期数 (跨边界)}}{\\text{每元素的周期数 (对齐)}}\n$$\n问题提供了以下参数：\n- 缓存行大小，$L = 64$ 字节。\n- 向量加载单元吞吐量，$P = 16$ 字节/周期。\n- 单精度浮点元素大小，$4$ 字节。\n- 向量寄存器中的浮点元素数量，$W$。\n- 向量加载的总字节大小，$S = 4W$ 字节。\n- 跨边界加载的固定开销，$\\delta = 1$ 周期。\n\n每次向量加载的成本由模型给出：\n- 对于对齐的向量加载，成本为 $C_{align} = \\lceil S/P \\rceil$ 周期。\n- 对于跨边界的向量加载，成本为 $C_{cross} = \\lceil S/P \\rceil + \\delta$ 周期。\n\n首先，我们将这些成本表示为向量宽度 $W$ 的函数。将 $S = 4W$，$P = 16$ 和 $\\delta = 1$ 代入成本模型：\n$$\nC_{align}(W) = \\left\\lceil \\frac{4W}{16} \\right\\rceil = \\left\\lceil \\frac{W}{4} \\right\\rceil \\quad \\text{每次向量加载的周期数}\n$$\n$$\nC_{cross}(W) = \\left\\lceil \\frac{4W}{16} \\right\\rceil + 1 = \\left\\lceil \\frac{W}{4} \\right\\rceil + 1 \\quad \\text{每次向量加载的周期数}\n$$\n问题要求的是每*元素*的周期数比率。由于每次向量加载操作处理 $W$ 个元素，我们可以通过将每次向量加载的周期数除以 $W$ 来得到每元素的周期数（$CPE$）。\n\n对齐加载的每元素周期数为：\n$$\nCPE_{align}(W) = \\frac{C_{align}(W)}{W} = \\frac{\\left\\lceil \\frac{W}{4} \\right\\rceil}{W}\n$$\n跨边界加载的每元素周期数为：\n$$\nCPE_{cross}(W) = \\frac{C_{cross}(W)}{W} = \\frac{\\left\\lceil \\frac{W}{4} \\right\\rceil + 1}{W}\n$$\n现在，我们可以构建对齐惩罚比率 $\\rho(W)$ 的公式：\n$$\n\\rho(W) = \\frac{CPE_{cross}(W)}{CPE_{align}(W)} = \\frac{\\frac{\\left\\lceil \\frac{W}{4} \\right\\rceil + 1}{W}}{\\frac{\\left\\lceil \\frac{W}{4} \\right\\rceil}{W}}\n$$\n分子和分母中的分母项 $W$ 可以相互抵消，将 $\\rho(W)$ 的表达式简化为：\n$$\n\\rho(W) = \\frac{\\left\\lceil \\frac{W}{4} \\right\\rceil + 1}{\\left\\lceil \\frac{W}{4} \\right\\rceil} = 1 + \\frac{1}{\\left\\lceil \\frac{W}{4} \\right\\rceil}\n$$\n我们需要计算当 $W \\in \\{4, 8, 16\\}$ 时该比率的值。\n\n情况1：$W = 4$\n微加载的数量为 $\\lceil 4/4 \\rceil = \\lceil 1 \\rceil = 1$。\n惩罚比率为：\n$$\n\\rho(4) = 1 + \\frac{1}{\\lceil 4/4 \\rceil} = 1 + \\frac{1}{1} = 2\n$$\n\n情况2：$W = 8$\n微加载的数量为 $\\lceil 8/4 \\rceil = \\lceil 2 \\rceil = 2$。\n惩罚比率为：\n$$\n\\rho(8) = 1 + \\frac{1}{\\lceil 8/4 \\rceil} = 1 + \\frac{1}{2} = \\frac{3}{2}\n$$\n\n情况3：$W = 16$\n微加载的数量为 $\\lceil 16/4 \\rceil = \\lceil 4 \\rceil = 4$。\n惩罚比率为：\n$$\n\\rho(16) = 1 + \\frac{1}{\\lceil 16/4 \\rceil} = 1 + \\frac{1}{4} = \\frac{5}{4}\n$$\n\n最终答案要求将这三个值 $\\rho(4)$、$\\rho(8)$ 和 $\\rho(16)$ 按 $W$ 递增的顺序排列在一个单行矩阵中。这些值为 $2$、$\\frac{3}{2}$ 和 $\\frac{5}{4}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 2  \\frac{3}{2}  \\frac{5}{4} \\end{pmatrix}}\n$$", "id": "3687644"}, {"introduction": "数据进入寄存器后，我们就可以并行执行计算。本实践将深入研究一种基本的并行算法——归约（reduction），通过比较在SIMD处理器上对一个大数组求和的两种策略 [@problem_id:3687551]。你将分析不同的水平（道内）和垂直（跨道）操作序列如何影响总延迟。", "problem": "考虑一个单指令多数据流 (SIMD) 向量处理器，其拥有 $L$ 个通道，每个通道的向量寄存器中存储 $W$ 个单精度浮点元素。您需要设计一个将 $N$ 个浮点数归约为单个标量的方案，使用两种利用水平加法和通道间重排的可选向量化策略。假设所有数据都驻留在寄存器中，内存效应可以忽略不计。这两种策略如下。\n\n策略 A（首先在通道内进行基于树的归约）：在每个通道内，使用水平加法 (HADD) 操作执行二叉树归约，每一步将每个通道的元素数量减半，直到每个通道只剩下一个值。然后，使用二叉树进行跨通道归约，在每一级使用通道间重排 (SHFL) 对通道进行配对，然后进行向量加法 (VADD)，直到为整个向量寄存器生成一个标量。最后，在流式处理 $N$ 个元素的过程中，累加所有向量寄存器产生的结果。\n\n策略 B（首先进行通道间重排）：首先，使用二叉树进行跨通道归约，在每一级使用 SHFL 对通道进行配对，然后进行 VADD，同时保持每个通道有 $W$ 个元素。当只剩下一个通道后，执行通道内的 HADD 二叉树，将剩余的 $W$ 个元素归约为一个标量。最后，在流式处理 $N$ 个元素的过程中，累加所有向量寄存器产生的结果。\n\n假设延迟如下：\n- 水平加法 (HADD) 延迟：$h = 3$ 周期/阶段。\n- 通道间重排 (SHFL) 延迟：$s = 5$ 周期/阶段。\n- 向量加法 (VADD) 延迟：$a = 4$ 周期/阶段。\n\n假设 $L = 8$ 个通道，$W = 16$ 个元素/通道，以及 $N = 2^{20}$ 个浮点数。假设有足够的功能单元容量来将每个向量寄存器结果的标量累加与后续寄存器的向量归约重叠，因此总的关键路径延迟是所有寄存器的每个寄存器的向量归约延迟之和，再加上一个最终的标量加法延迟以合并最后一个寄存器的结果。请以周期为单位表示最终答案。无需四舍五入。\n\n根据第一性原理和二叉树归约的核心定义，计算策略 A 和策略 B 中较快策略的总延迟（以周期为单位）。", "solution": "首先根据所需标准对问题进行验证。\n\n### 第1步：提取给定条件\n- **向量处理器参数：**\n  - 通道数，$L = 8$。\n  - 每个通道的元素数，$W = 16$。\n  - 需要归约的单精度浮点数总数，$N = 2^{20}$。\n- **操作延迟：**\n  - 水平加法 (HADD) 延迟，$h = 3$ 周期/阶段。\n  - 通道间重排 (SHFL) 延迟，$s = 5$ 周期/阶段。\n  - 向量加法 (VADD) 延迟，$a = 4$ 周期/阶段。\n- **归约策略：**\n  - **策略 A：** 通道内 HADD 归约树，然后是跨通道 SHFL+VADD 归约树。\n  - **策略 B：** 跨通道 SHFL+VADD 归约树，然后是通道内 HADD 归约树。\n- **延迟计算模型：**\n  - 数据驻留在寄存器中；内存效应可忽略不计。\n  - 一个结果的标量累加与下一个数据块的向量归约重叠。\n  - 总延迟是所有寄存器的向量归约延迟之和，再加上一个最终的标量加法延迟。\n\n### 第2步：使用提取的给定条件进行验证\n- **科学基础：** 该问题基于计算机体系结构中的标准概念，特别是 SIMD 向量处理器和并行归约算法。操作（HADD、SHFL、VADD）是现代向量指令集架构的代表。该模型在科学上是合理的。\n- **问题定义良好：** 提供了所有必要的参数（$L$、$W$、$N$）和延迟（$h$、$s$、$a$）。策略和整体延迟计算模型均已定义，可导出一个唯一且有意义的解。\n- **客观性：** 问题以精确、定量且无偏见的技术语言陈述。\n- **完整性和一致性：** 元素总数 $N = 2^{20}$ 可以被一个向量寄存器中的元素数量 $L \\times W = 8 \\times 16 = 128 = 2^7$ 整除。需要处理的寄存器数量为 $2^{20} / 2^7 = 2^{13}$，是一个整数。问题内部一致且完整。\n\n### 第3步：结论与行动\n问题有效。将提供完整的解决方案。\n\n### 求解推导\n\n任务是找出两种向量化归约策略中较快者的总延迟。我们从并行归约的第一性原理开始。\n\n对 $k$ 个元素进行二叉树归约所需的阶段数为 $\\lceil \\log_2(k) \\rceil$。一个归约阶段的总延迟是阶段数乘以每个阶段的延迟。\n\n首先，我们确定每个向量寄存器处理的元素数量以及需要处理的向量寄存器总数。\n一个向量寄存器中存储的元素总数为 $V = L \\times W$。\n给定 $L=8$ 和 $W=16$，我们有：\n$$V = 8 \\times 16 = 128 = 2^7 \\text{ 个元素}$$\n需要归约的元素总数为 $N = 2^{20}$。数据必须以块的形式处理，每个块填满一个向量寄存器。块的数量 $N_{chunks}$ 是：\n$$N_{chunks} = \\frac{N}{V} = \\frac{2^{20}}{2^7} = 2^{13} = 8192$$\n\n接下来，我们为每种策略分析将单个向量寄存器的数据归约为单个标量值的延迟。设此延迟为 $T_{reg}$。\n\n**策略 A：首先进行通道内归约**\n\n1.  **通道内归约：** 对于 $L$ 个通道中的每一个，我们使用水平加法 (HADD) 的二叉树将 $W$ 个元素归约为单个元素。\n    -   阶段数：$\\lceil \\log_2(W) \\rceil = \\lceil \\log_2(16) \\rceil = \\lceil 4 \\rceil = 4$。\n    -   此阶段的延迟：$(\\lceil \\log_2(W) \\rceil) \\times h = 4 \\times 3 = 12$ 周期。\n\n2.  **跨通道归约：** 第一阶段后，我们得到 $L$ 个部分和，每个通道一个。将这些归约为单个标量。这需要一个由通道间重排 (SHFL)（用于对齐数据）和向量加法 (VADD) 组成的二叉树。\n    -   阶段数：$\\lceil \\log_2(L) \\rceil = \\lceil \\log_2(8) \\rceil = \\lceil 3 \\rceil = 3$。\n    -   每阶段延迟：$s + a = 5 + 4 = 9$ 周期。\n    -   此阶段的延迟：$(\\lceil \\log_2(L) \\rceil) \\times (s + a) = 3 \\times 9 = 27$ 周期。\n\n策略 A 处理单个向量寄存器的总延迟 $T_A$ 是这两个顺序阶段延迟的总和：\n$$T_A = ((\\lceil \\log_2(W) \\rceil) \\times h) + ((\\lceil \\log_2(L) \\rceil) \\times (s + a)) = 12 + 27 = 39 \\text{ 周期}$$\n\n**策略 B：首先进行跨通道归约**\n\n1.  **跨通道归约：** 我们首先在 $L$ 个通道之间进行归约。在每个阶段，使用 SHFL 对通道进行配对，并使用 VADD 将它们对应的 $W$ 个元素相加。这个过程持续进行，直到所有结果都累加到单个通道中。\n    -   阶段数：$\\lceil \\log_2(L) \\rceil = \\lceil \\log_2(8) \\rceil = 3$。\n    -   每阶段延迟：$s + a = 5 + 4 = 9$ 周期。\n    -   此阶段的延迟：$(\\lceil \\log_2(L) \\rceil) \\times (s + a) = 3 \\times 9 = 27$ 周期。\n\n2.  **通道内归约：** 第一阶段后，一个通道包含 $W$ 个部分和。使用 HADD 操作的二叉树将这些归约为单个标量。\n    -   阶段数：$\\lceil \\log_2(W) \\rceil = \\lceil \\log_2(16) \\rceil = 4$。\n    -   此阶段的延迟：$(\\lceil \\log_2(W) \\rceil) \\times h = 4 \\times 3 = 12$ 周期。\n\n策略 B 处理单个向量寄存器的总延迟 $T_B$ 是这两个顺序阶段延迟的总和：\n$$T_B = ((\\lceil \\log_2(L) \\rceil) \\times (s + a)) + ((\\lceil \\log_2(W) \\rceil) \\times h) = 27 + 12 = 39 \\text{ 周期}$$\n\n**策略比较**\n分析表明 $T_A = T_B = 39$ 周期。操作的顺序不影响归约单个向量寄存器的总延迟，因为两种情况下都必须执行相同的操作集。因此，两种策略速度相同。我们将每个寄存器的延迟定义为 $T_{reg} = 39$ 周期。\n\n**总延迟计算**\n问题陈述，一个结果的标量累加与下一个结果的向量归约重叠。这描述了一个流水线执行模型。流水线的阶段是向量归约（延迟为 $T_{reg}$）和标量累加（设其延迟为 $T_{sadd}$）。根据提供的延迟，可以合理假设单个标量浮点加法的延迟与向量加法功能单元的延迟相同，因此 $T_{sadd} = a = 4$ 周期。\n\n处理 $N_{chunks}$ 个项目的流水线总时间是处理第一个项目通过所有阶段的时间，加上 $(N_{chunks}-1)$ 乘以流水线的周期时间。周期时间由最长的阶段决定。这里，$T_{reg} = 39$ 周期，$T_{sadd} = 4$ 周期，所以向量归约阶段是瓶颈。\n总延迟 $T_{total}$ 为：\n$$T_{total} = (T_{reg} + T_{sadd}) + (N_{chunks} - 1) \\times \\max(T_{reg}, T_{sadd})$$\n$$T_{total} = (T_{reg} + T_{sadd}) + (N_{chunks} - 1) \\times T_{reg}$$\n$$T_{total} = T_{reg} + T_{sadd} + N_{chunks} \\times T_{reg} - T_{reg} = N_{chunks} \\times T_{reg} + T_{sadd}$$\n这个推导出的公式与问题字面上的指令“总的关键路径延迟是所有寄存器的每个寄存器的向量归约延迟之和，再加上一个最终的标量加法延迟”是一致的。\n\n代入计算出的值：\n- $N_{chunks} = 8192$\n- $T_{reg} = 39$ 周期\n- $T_{sadd} = 4$ 周期\n\n$$T_{total} = (8192 \\times 39) + 4$$\n$$T_{total} = (8192 \\times (40 - 1)) + 4 = (8192 \\times 40 - 8192) + 4$$\n$$T_{total} = (327680 - 8192) + 4$$\n$$T_{total} = 319488 + 4 = 319492 \\text{ 周期}$$\n\n较快策略的延迟是 $319492$ 周期，因为两种策略的性能相同。", "answer": "$$\\boxed{319492}$$", "id": "3687551"}, {"introduction": "现实世界中的数据集大小很少恰好是处理器向量宽度的整数倍，这会产生需要特殊处理的“尾部”或“余数”。本题目模拟了处理这些剩余元素的三种常见策略之间的性能权衡 [@problem_id:3687549]。这种分析对于构建稳健且高效的向量循环至关重要。", "problem": "考虑一个单指令多数据（SIMD）向量处理器，它使用 $W$ 个通道的向量宽度，在一个长度为 $N$ 的数组上执行逐元素操作。该处理器必须使用以下三种策略之一来处理 $N \\bmod W \\neq 0$ 的情况：标量余项处理、掩码向量余项处理或循环剥离。假设一个以每个循环体的周期数为单位的稳态成本模型，并具有以下定义：\n\n- 全宽向量迭代的次数为 $q = \\lfloor N / W \\rfloor$，余项为 $r = N \\bmod W$，其中 $0 < r < W$。\n- 一次非对齐的全宽向量迭代成本为 $c_{v}$ 个周期。\n- 一次标量迭代成本为 $c_{s}$ 个周期。\n- 在标量循环中执行的每个动态分支会产生 $p$ 个周期的预期惩罚。\n- 对于掩码向量余项处理策略，构建通道掩码会产生 $c_{\\mathrm{mk}}$ 个周期的一次性成本，并且掩码余项作为一次额外的向量迭代执行，其成本与一次非对齐的全宽迭代相同。\n- 对于循环剥离策略，首先执行一个包含 $r$ 次迭代的标量序言，以便为主向量循环将指针与 $W$ 通道边界对齐；除了 $r$ 次标量迭代之外，此序言还有 $c_{\\mathrm{pl}}$ 个周期的一次性成本。剥离后，对齐的主向量循环每次迭代的成本相对于非对齐成本减少了 $\\delta$ 个周期，因此每次对齐的全宽向量迭代成本为 $c_{v} - \\delta$ 个周期。\n\n使用以下参数：\n- $N = 1025$\n- $W = 32$\n- $c_{v} = 5$\n- $c_{s} = 2$\n- $c_{\\mathrm{mk}} = 3$\n- $\\delta = 0.25$\n- $c_{\\mathrm{pl}} = 4$\n\n从吞吐量建模和循环嵌套中控制流成本的基本原理出发，为每种策略构建周期计数表达式，并推导分支惩罚 $p$（以周期为单位）的两个交叉值，在这两个交叉值下：\n1. 标量余项处理和掩码向量余项处理策略的总周期数相等。\n2. 循环剥离和掩码向量余项处理策略的总周期数相等。\n\n将你的最终答案表示为有序对 $\\left(p_{\\mathrm{SM}}, p_{\\mathrm{PM}}\\right)$，单位为周期。无需四舍五入，必须提供精确值。答案必须是单个计算对象。", "solution": "问题要求确定分支惩罚参数 $p$ 的两个交叉值，在这两个值下，处理循环余项的不同向量化策略具有相同的性能（以执行周期数衡量）。这些策略是标量余项处理、掩码向量余项处理和循环剥离。\n\n首先，我们必须根据所提供的参数，为这三种策略中的每一种建立总周期成本表达式。设 $T_S$、$T_M$ 和 $T_P$ 分别表示标量余项处理、掩码向量余项处理和循环剥离策略的总周期成本。\n\n问题提供了以下参数：\n- 数组长度：$N = 1025$\n- 向量宽度：$W = 32$ 通道\n- 非对齐向量迭代成本：$c_{v} = 5$ 周期\n- 标量迭代成本：$c_{s} = 2$ 周期\n- 掩码构建成本：$c_{\\mathrm{mk}} = 3$ 周期\n- 对齐向量迭代成本减少量：$\\delta = 0.25$ 周期\n- 循环剥离设置成本：$c_{\\mathrm{pl}} = 4$ 周期\n- 标量循环中的分支惩罚：每次迭代 $p$ 个周期\n\n根据 $N$ 和 $W$，我们计算全宽向量迭代的次数 $q$ 和剩余元素的数量 $r$。\n$$q = \\lfloor \\frac{N}{W} \\rfloor = \\lfloor \\frac{1025}{32} \\rfloor = \\lfloor 32.03125 \\rfloor = 32$$\n$$r = N \\bmod W = 1025 \\bmod 32 = 1$$\n问题指明 $0 < r < W$，由于 $r=1$，此条件得到满足。\n\n现在，我们为每种策略构建周期计数表达式。\n\n1.  **标量余项处理策略 ($T_S$)**\n    该策略包括 $q$ 次全宽向量迭代，然后是一个包含 $r$ 次迭代的标量循环来处理余项。\n    - $q$ 次非对齐向量迭代的成本：$q \\cdot c_{v}$\n    - $r$ 次标量迭代的成本：$r \\cdot c_{s}$\n    - 标量循环中 $r$ 次迭代的分支惩罚成本：$r \\cdot p$\n    总成本是这些部分的总和：\n    $$T_S = q \\cdot c_{v} + r \\cdot c_{s} + r \\cdot p$$\n\n2.  **掩码向量余项处理策略 ($T_M$)**\n    该策略包括 $q$ 次全宽向量迭代，然后是一次额外的向量迭代，该迭代使用掩码只处理 $r$ 个剩余元素。\n    - $q$ 次非对齐向量迭代的成本：$q \\cdot c_{v}$\n    - 构建通道掩码的一次性成本：$c_{\\mathrm{mk}}$\n    - 额外的掩码向量迭代的成本，与一次全宽迭代相同：$c_{v}$\n    总成本是这些部分的总和：\n    $$T_M = q \\cdot c_{v} + c_{\\mathrm{mk}} + c_{v} = (q+1) \\cdot c_{v} + c_{\\mathrm{mk}}$$\n\n3.  **循环剥离策略 ($T_P$)**\n    该策略首先执行一个包含 $r$ 次迭代的标量“序言”来对齐数据指针。之后是一个包含 $q$ 次向量迭代的主循环，这些迭代现在是对齐的，因此速度更快。\n    - 标量序言的一次性设置成本：$c_{\\mathrm{pl}}$\n    - 序言中 $r$ 次标量迭代的成本：$r \\cdot c_{s}$\n    - 标量序言中 $r$ 次迭代的分支惩罚成本：$r \\cdot p$\n    - 主循环中 $q$ 次对齐向量迭代的成本：$q \\cdot (c_{v} - \\delta)$\n    总成本是这些部分的总和：\n    $$T_P = c_{\\mathrm{pl}} + r \\cdot c_{s} + r \\cdot p + q \\cdot (c_{v} - \\delta)$$\n\n接下来，我们求解 $p$ 的交叉值。\n\n**交叉点 1：标量余项处理 vs. 掩码向量余项处理 ($p_{\\mathrm{SM}}$)**\n我们令总成本相等，$T_S = T_M$，并求解 $p$。设此值为 $p_{\\mathrm{SM}}$。\n$$q \\cdot c_{v} + r \\cdot c_{s} + r \\cdot p_{\\mathrm{SM}} = (q+1) \\cdot c_{v} + c_{\\mathrm{mk}}$$\n$$q \\cdot c_{v} + r \\cdot c_{s} + r \\cdot p_{\\mathrm{SM}} = q \\cdot c_{v} + c_{v} + c_{\\mathrm{mk}}$$\n两边减去 $q \\cdot c_{v}$：\n$$r \\cdot c_{s} + r \\cdot p_{\\mathrm{SM}} = c_{v} + c_{\\mathrm{mk}}$$\n求解 $p_{\\mathrm{SM}}$：\n$$r \\cdot p_{\\mathrm{SM}} = c_{v} + c_{\\mathrm{mk}} - r \\cdot c_{s}$$\n$$p_{\\mathrm{SM}} = \\frac{c_{v} + c_{\\mathrm{mk}} - r \\cdot c_{s}}{r}$$\n代入给定的数值：\n$$p_{\\mathrm{SM}} = \\frac{5 + 3 - (1) \\cdot (2)}{1} = \\frac{8 - 2}{1} = 6$$\n\n**交叉点 2：循环剥离 vs. 掩码向量余项处理 ($p_{\\mathrm{PM}}$)**\n我们令总成本相等，$T_P = T_M$，并求解 $p$。设此值为 $p_{\\mathrm{PM}}$。\n$$c_{\\mathrm{pl}} + r \\cdot c_{s} + r \\cdot p_{\\mathrm{PM}} + q \\cdot (c_{v} - \\delta) = (q+1) \\cdot c_{v} + c_{\\mathrm{mk}}$$\n$$c_{\\mathrm{pl}} + r \\cdot c_{s} + r \\cdot p_{\\mathrm{PM}} + q \\cdot c_{v} - q \\cdot \\delta = q \\cdot c_{v} + c_{v} + c_{\\mathrm{mk}}$$\n两边减去 $q \\cdot c_{v}$：\n$$c_{\\mathrm{pl}} + r \\cdot c_{s} + r \\cdot p_{\\mathrm{PM}} - q \\cdot \\delta = c_{v} + c_{\\mathrm{mk}}$$\n求解 $p_{\\mathrm{PM}}$：\n$$r \\cdot p_{\\mathrm{PM}} = c_{v} + c_{\\mathrm{mk}} + q \\cdot \\delta - c_{\\mathrm{pl}} - r \\cdot c_{s}$$\n$$p_{\\mathrm{PM}} = \\frac{c_{v} + c_{\\mathrm{mk}} + q \\cdot \\delta - c_{\\mathrm{pl}} - r \\cdot c_{s}}{r}$$\n代入给定的数值：\n$$p_{\\mathrm{PM}} = \\frac{5 + 3 + (32) \\cdot (0.25) - 4 - (1) \\cdot (2)}{1}$$\n$$p_{\\mathrm{PM}} = \\frac{8 + 8 - 4 - 2}{1} = \\frac{16 - 6}{1} = 10$$\n\n两个交叉值分别为 $p_{\\mathrm{SM}} = 6$ 周期和 $p_{\\mathrm{PM}} = 10$ 周期。问题要求答案以有序对 $(p_{\\mathrm{SM}}, p_{\\mathrm{PM}})$ 的形式给出。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n6  10\n\\end{pmatrix}\n}\n$$", "id": "3687549"}]}