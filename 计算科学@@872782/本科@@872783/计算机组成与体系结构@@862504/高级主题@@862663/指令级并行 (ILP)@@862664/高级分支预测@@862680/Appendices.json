{"hands_on_practices": [{"introduction": "现代分支预测器依赖于简单而高效的状态机来学习和适应程序行为。其中，两位饱和计数器是最常见的核心组件，构成了许多预测方案的基础。本练习 [@problem_id:3619723] 将引导你使用马尔可夫链对这种计数器进行建模，从而在面对一个具有已知统计偏差的分支时，定量地分析其动态行为。通过计算其稳态概率分布和最终的误判率，你将从第一性原理出发，深刻理解这些关键组件是如何实现“学习”的。", "problem": "考虑一个两级自适应分支预测器，其模式历史表 (PHT) 的条目是由全局历史寄存器 (GHR) 索引的标准$2$位饱和计数器。我们关注与一个静态分支相关联的单个PHT条目，该分支的结果是独立同分布的 (i.i.d.)，其跳转概率为$P(T)=0.6$，不跳转概率为$P(N)=0.4$。该$2$位饱和计数器有四个状态，分别代表整数值$0,1,2,3$。当分支结果为跳转时，计数器加$1$并在达到$3$时饱和；当分支结果为不跳转时，计数器减$1$并在达到$0$时饱和。当计数器处于状态$0$或$1$时，预测器预测为不跳转；当计数器处于状态$2$或$3$时，预测器预测为跳转。\n\n将计数器的演化建模为一个离散时间马尔可夫链，其状态为$s_{0}, s_{1}, s_{2}, s_{3}$，分别对应于计数器值$0,1,2,3$。仅使用概率论和马尔可夫链的基本定义，以及上述标准的$2$位计数器更新规则：\n\n- 推导计数器状态的稳态概率分布 $\\pi = (\\pi_{0}, \\pi_{1}, \\pi_{2}, \\pi_{3})$。\n- 计算长期期望错误预测率，该率定义为在给定预测器从状态到预测的映射以及分支的独立同分布结果的条件下，预测与结果不匹配的稳态期望比例。\n\n将$P(T)$表示为$p$，$P(N)$表示为$q$，然后在最后设$p=0.6$和$q=0.4$。请以单个行向量的形式提供您的最终答案，其中包含四个稳态概率$(\\pi_{0}, \\pi_{1}, \\pi_{2}, \\pi_{3})$以及错误预测率，请使用精确值。不要四舍五入。无需单位。", "solution": "此问题有效，因为它以马尔可夫链理论为科学基础，问题定义明确、客观，具有唯一解，并包含所有必要信息。我们着手求解。\n\n$2$位饱和计数器的演化可以建模为一个离散时间马尔可夫链。状态空间为 $S = \\{s_0, s_1, s_2, s_3\\}$，其中$s_i$对应于计数器的整数值$i$。分支结果是独立同分布的，跳转概率为$P(T) = p = 0.6$，不跳转概率为$P(N) = q = 0.4$。\n\n状态转移如下：\n- 从状态$s_0$（值$0$）开始：当结果为“跳转”（概率为$p$）时，计数器递增到$1$（状态$s_1$）。当结果为“不跳转”（概率为$q$）时，由于饱和，它保持在$0$（状态$s_0$）。\n- 从状态$s_1$（值$1$）开始：当结果为“跳转”（概率为$p$）时，计数器递增到$2$（状态$s_2$）。当结果为“不跳转”（概率为$q$）时，它递减到$0$（状态$s_0$）。\n- 从状态$s_2$（值$2$）开始：当结果为“跳转”（概率为$p$）时，计数器递增到$3$（状态$s_3$）。当结果为“不跳转”（概率为$q$）时，它递减到$1$（状态$s_1$）。\n- 从状态$s_3$（值$3$）开始：当结果为“跳转”（概率为$p$）时，由于饱和，计数器保持在$3$（状态$s_3$）。当结果为“不跳转”（概率为$q$）时，它递减到$2$（状态$s_2$）。\n\n该系统是一个生灭过程。在稳态下，任意两个相邻状态之间的概率流必须平衡。设$\\pi = (\\pi_0, \\pi_1, \\pi_2, \\pi_3)$为稳态概率分布。细致平衡方程如下：\n\\begin{align*}\n\\pi_0 p = \\pi_1 q  (\\text{流 } s_0 \\leftrightarrow s_1) \\\\\n\\pi_1 p = \\pi_2 q  (\\text{流 } s_1 \\leftrightarrow s_2) \\\\\n\\pi_2 p = \\pi_3 q  (\\text{流 } s_2 \\leftrightarrow s_3)\n\\end{align*}\n根据这些方程，我们可以用$\\pi_0$来表示$\\pi_1$、$\\pi_2$和$\\pi_3$。令$\\rho = p/q$。\n\\begin{align*}\n\\pi_1 = \\pi_0 \\frac{p}{q} = \\pi_0 \\rho \\\\\n\\pi_2 = \\pi_1 \\frac{p}{q} = (\\pi_0 \\rho) \\rho = \\pi_0 \\rho^2 \\\\\n\\pi_3 = \\pi_2 \\frac{p}{q} = (\\pi_0 \\rho^2) \\rho = \\pi_0 \\rho^3\n\\end{align*}\n稳态概率之和必须为$1$：\n$$ \\pi_0 + \\pi_1 + \\pi_2 + \\pi_3 = 1 $$\n将用$\\pi_0$表示的表达式代入：\n$$ \\pi_0 + \\pi_0 \\rho + \\pi_0 \\rho^2 + \\pi_0 \\rho^3 = 1 $$\n$$ \\pi_0 (1 + \\rho + \\rho^2 + \\rho^3) = 1 $$\n这是一个有限几何级数，因此我们可以写成：\n$$ \\pi_0 \\left( \\frac{1 - \\rho^4}{1 - \\rho} \\right) = 1 $$\n$$ \\pi_0 = \\frac{1 - \\rho}{1 - \\rho^4} = \\frac{1}{1 + \\rho + \\rho^2 + \\rho^3} $$\n给定$p=0.6$和$q=0.4$，我们得到$\\rho = \\frac{0.6}{0.4} = \\frac{3}{2}$。\n现在我们计算分母：\n$$ 1 + \\rho + \\rho^2 + \\rho^3 = 1 + \\frac{3}{2} + \\left(\\frac{3}{2}\\right)^2 + \\left(\\frac{3}{2}\\right)^3 = 1 + \\frac{3}{2} + \\frac{9}{4} + \\frac{27}{8} $$\n$$ = \\frac{8}{8} + \\frac{12}{8} + \\frac{18}{8} + \\frac{27}{8} = \\frac{8+12+18+27}{8} = \\frac{65}{8} $$\n所以，$\\pi_0 = \\frac{1}{65/8} = \\frac{8}{65}$。\n现在我们可以计算其他概率：\n$$ \\pi_1 = \\pi_0 \\rho = \\frac{8}{65} \\times \\frac{3}{2} = \\frac{12}{65} $$\n$$ \\pi_2 = \\pi_1 \\rho = \\frac{12}{65} \\times \\frac{3}{2} = \\frac{18}{65} $$\n$$ \\pi_3 = \\pi_2 \\rho = \\frac{18}{65} \\times \\frac{3}{2} = \\frac{27}{65} $$\n稳态概率分布为 $\\pi = (\\frac{8}{65}, \\frac{12}{65}, \\frac{18}{65}, \\frac{27}{65})$。\n\n接下来，我们计算长期错误预测率$M$。预测器的规则是：\n- 如果计数器处于状态$s_0$或$s_1$，则预测为“不跳转”。\n- 如果计数器处于状态$s_2$或$s_3$，则预测为“跳转”。\n\n错误预测在以下两种情况下发生：\n1. 预测器预测为“不跳转”（处于状态$s_0$或$s_1$），而分支结果为“跳转”（概率为$p$）。\n2. 预测器预测为“跳转”（处于状态$s_2$或$s_3$），而分支结果为“不跳转”（概率为$q$）。\n\n总错误预测率是这些互斥事件的概率之和：\n$$ M = P(\\text{状态} \\in \\{s_0, s_1\\}) \\times p + P(\\text{状态} \\in \\{s_2, s_3\\}) \\times q $$\n$$ M = (\\pi_0 + \\pi_1) p + (\\pi_2 + \\pi_3) q $$\n使用计算出的稳态概率：\n$$ \\pi_0 + \\pi_1 = \\frac{8}{65} + \\frac{12}{65} = \\frac{20}{65} $$\n$$ \\pi_2 + \\pi_3 = \\frac{18}{65} + \\frac{27}{65} = \\frac{45}{65} $$\n现在，将这些和以及$p$和$q$的值代入$M$的表达式中：\n$$ M = \\left(\\frac{20}{65}\\right) p + \\left(\\frac{45}{65}\\right) q = \\left(\\frac{20}{65}\\right) \\frac{3}{5} + \\left(\\frac{45}{65}\\right) \\frac{2}{5} $$\n$$ M = \\frac{60}{325} + \\frac{90}{325} = \\frac{150}{325} $$\n化简分数：\n$$ M = \\frac{150 \\div 25}{325 \\div 25} = \\frac{6}{13} $$\n长期错误预测率为 $\\frac{6}{13}$。\n\n最终答案要求一个行向量，包含四个稳态概率和错误预测率。\n这些值为 $(\\pi_0, \\pi_1, \\pi_2, \\pi_3, M) = (\\frac{8}{65}, \\frac{12}{65}, \\frac{18}{65}, \\frac{27}{65}, \\frac{6}{13})$。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{8}{65}  \\frac{12}{65}  \\frac{18}{65}  \\frac{27}{65}  \\frac{6}{13} \\end{pmatrix} } $$", "id": "3619723"}, {"introduction": "使用更长的分支历史来预测结果似乎是一种直观而强大的方法，但这引入了一个关键挑战：别名（aliasing）。本练习 [@problem_id:3619712] 通过一个精心设计的场景来阐释这一现象，其中两个不同的分支因共享相同的历史模式而访问同一个预测器条目，但它们的未来走向却截然相反。你将分析这种“路径干扰”如何导致预测器持续做出错误的预测，并探索由“鸽巢原理”决定的、在历史长度（$m$）与模式历史表大小（$S$）之间的根本性设计权衡。", "problem": "一个两级局部自分支预测器由一个局部历史表（LHT）和一个模式历史表（PHT）组成。LHT为每个静态分支存储最后 $m$ 个结果，作为一个 $m$ 位的局部历史；PHT包含 $S$ 个条目，每个条目是一个两位饱和计数器。PHT仅由 $m$ 位局部历史值索引（不使用分支地址位），这意味着PHT在所有分支之间共享，所有相同的 $m$ 位历史都映射到同一个PHT条目。饱和计数器的更新规则是标准的两位方案：状态 $\\{00,01,10,11\\}$ 分别预测为 $\\{\\text{NT},\\text{NT},\\text{T},\\text{T}\\}$（未跳转、未跳转、跳转、跳转），在结果为跳转时递增，在结果为未跳转时递减，并在两端饱和。假设所有PHT计数器都初始化为 $01$。\n\n考虑两个静态条件分支 $B_{1}$ 和 $B_{2}$，它们在以下周期性踪迹中循环执行。在每个周期开始时，$B_{1}$ 和 $B_{2}$ 在LHT中的局部历史都等于 $m$ 位零向量 $H = 0^{m}$。该周期的过程如下：\n- 执行 $B_{1}$ 一次，实际结果为跳转。\n- 执行 $B_{2}$ 一次，实际结果为未跳转。\n- 然后，为了恢复下一周期的相同局部历史条件，连续执行 $B_{1}$ $m$ 次，结果均为未跳转，再连续执行 $B_{2}$ $m$ 次，结果也均为未跳转，这样在下一周期开始之前，两个分支的局部历史都再次变为 $H = 0^{m}$。\n\n因此，在每个周期中，当每个分支首次访问PHT时，它们都具有相同的最近 $m$ 个结果 $H$，但它们紧接着的未来走向却出现分歧（一个跳转，一个未跳转）。因此，由 $H$ 索引的PHT条目被 $B_{1}$ 和 $B_{2}$ 共享，并交替接收跳转和未跳转结果的更新。\n\n从两级局部预测和两位饱和计数器动态的基本定义出发，分析在多个周期内共享PHT条目上每次访问的预测行为，并解释为什么这构成了路径干扰。从基本原理出发，论证当PHT大小固定时，增加 $m$ 会如何在 $2^{m}  S$（不同历史的数量多于计数器数量）的情况下，因鸽巢原理而导致错误预测恶化，使得冲突不可避免，并阻碍对分歧未来的消歧。然后，在PHT由 $m$ 位局部历史直接索引（无哈希、无折叠）的情况下，确定最大的整数 $m$，使得所有可能的 $m$ 位历史到PHT条目存在一一映射，从而在原理上消除别名效应。\n\n计算PHT大小为 $S = 2{,}048$ 时的这个界限，并报告满足上述条件的单个整数值 $m_{\\max}$。无需四舍五入。", "solution": "该问题被确定为有效，因为它科学地基于计算机体系结构的原理，特别是分支预测，并且问题陈述清晰，提供了得出唯一解所需的所有信息。\n\n该问题描述了一个两级局部自分支预测器。该预测器使用一个局部历史表（LHT）为每个静态分支存储一个 $m$ 位的历史向量，并使用一个大小为 $S$ 的单一共享模式历史表（PHT）。PHT由 $m$ 位局部历史索引。PHT中的每个条目都是一个2位饱和计数器，它决定了预测结果，并根据实际的分支结果进行更新。计数器的状态 $\\{00, 01, 10, 11\\}$ 分别对应于预测未跳转（NT）、未跳转、跳转（T）和跳转。计数器在结果为T时递增，在结果为NT时递减，并在 $11$ 和 $00$ 处饱和。所有计数器都初始化为状态 $01$（弱不跳转）。\n\n我们首先分析共享PHT条目的预测行为。该问题设置了一个涉及两个分支 $B_1$ 和 $B_2$ 的周期性执行踪迹。在每个周期开始时，两个分支都具有完全相同的全零局部历史 $H = 0^m$。因此，它们都将访问同一个PHT条目，我们将其表示为 $PHT[0^m]$。设在一个周期开始时该计数器的状态为 $C$。最初，所有计数器都为 $01$，因此在第一个周期开始时，$C = 01$。\n\n该周期的展开过程如下：\n$1$. 执行 $B_1$。其历史为 $H = 0^m$。预测器访问 $PHT[0^m]$，此时其状态为 $01$。预测结果为NT（未跳转）。实际结果为T（跳转）。这是一次**错误预测**。计数器通过递增更新：$01 \\rightarrow 10$。\n$2$. 执行 $B_2$。其历史也为 $H = 0^m$。预测器访问同一条目 $PHT[0^m]$，此时其状态为 $10$。预测结果为T（跳转）。实际结果为NT（未跳转）。这也是一次**错误预测**。计数器通过递减更新：$10 \\rightarrow 01$。\n\n在这两个关键步骤结束时，计数器 $PHT[0^m]$ 已返回其初始状态 $01$。随后的恢复阶段，即两个分支连续执行 $m$ 次NT（未跳转）结果，其作用是将它们在LHT中的局部历史重置回 $0^m$，为下一个周期做准备。在此恢复过程中，$B_1$ 和 $B_2$ 的历史会随着每次NT结果而改变。这些新的历史很可能会映射到不同的PHT条目，因此 $PHT[0^m]$ 的状态不受影响，在下一个周期开始时仍保持为 $01$。\n\n因此，这个循环在每个周期中都会重复。$B_1$ 总是在计数器状态为 $01$ 时遇到它，预测为NT，但实际结果为T，导致一次错误预测并将计数器更新为 $10$。随后，$B_2$ 总是在计数器状态为 $10$ 时遇到它，预测为T，但实际结果为NT，导致另一次错误预测并将计数器重置为 $01$。由于在共享PHT条目上的相互作用，两个分支都持续发生错误预测。这种现象被称为**路径干扰**或**别名效应（aliasing）**。两条不同的执行路径（一条导致分支 $B_1$ 跳转，另一条导致 $B_2$ 不跳转），它们在分支前共享一个共同的历史模式，被映射到同一个硬件预测资源上。因为它们的结果不同，它们会“争夺”预测器状态的控制权，导致两者都持续获得较差的预测准确率。在这里，$B_1$ 训练预测器期望历史 $0^m$ 对应T结果，而 $B_2$ 则训练它期望NT结果。交替执行使得预测器无法正确学习任何一种模式。\n\n接下来，我们考虑在PHT大小 $S$ 固定的情况下，增加历史长度 $m$ 的影响。更长的历史 $m$ 的目的是捕获更复杂的模式并为预测提供更好的上下文，从而消除在使用较短历史时可能看起来相同的分支行为的歧义。可能的唯一 $m$ 位历史的数量是 $2^m$。这 $2^m$ 个不同的历史必须映射到PHT的 $S$ 个条目中。\n\n如果 $2^m \\le S$，原则上可以为每个不同的历史分配一个唯一的PHT条目。这将消除不同历史模式之间的别名效应。然而，如果我们增加 $m$ 使得 $2^m  S$，**鸽巢原理**规定多个不同的历史模式必须映射到同一个PHT条目。历史的数量随 $m$ 呈指数级增长，而预测器条目的数量 $S$ 是固定的。对于一个大的 $m$，在单个PHT条目上发生冲突的历史数量会变得非常大。这加剧了路径干扰问题。例如，一个与“跳转”结果强相关的历史 $H_1$ 可能与一个与“未跳转”结果强相关的历史 $H_2$ 映射到同一个PHT条目。它们的更新会产生破坏性干扰，从而降低预测准确率。因此，虽然理论上更大的 $m$ 提供了更多的信息用于消歧，但如果PHT不够大以支持它，其好处就会被抵消甚至逆转，因为增加的别名效应率会污染预测。预测器的性能可能会显著恶化。\n\n最后，我们被要求找到最大的整数 $m$，记为 $m_{\\max}$，使得所有可能的 $m$ 位历史到PHT条目的一一映射成为可能。这个条件消除了不同历史模式之间的别名效应。一一映射要求待映射的不同项目的数量（$2^m$ 种可能的历史）不超过可用位置的数量（$S$ 个PHT条目）。这可以用不等式表示：\n$$2^m \\le S$$\n给定PHT大小 $S = 2{,}048$。我们必须找到满足以下条件的最大整数 $m_{\\max}$：\n$$2^{m_{\\max}} \\le 2048$$\n为了求解 $m_{\\max}$，我们可以对两边取以2为底的对数：\n$$\\log_2(2^{m_{\\max}}) \\le \\log_2(2048)$$\n$$m_{\\max} \\le \\log_2(2048)$$\n我们可以通过识别2的幂来计算 $\\log_2(2048)$：\n$$2^{10} = 1024$$\n$$2^{11} = 2 \\times 2^{10} = 2 \\times 1024 = 2048$$\n因此，$\\log_2(2048) = 11$。不等式变为：\n$$m_{\\max} \\le 11$$\n由于 $m$ 必须是整数，满足此条件的最大整数值为 $11$。\n因此，$m_{\\max} = 11$。对于任何历史长度 $m  11$，在大小为 $2{,}048$ 且采用直接索引的PHT中，不同历史模式之间的别名效应变得不可避免。", "answer": "$$\\boxed{11}$$", "id": "3619712"}, {"introduction": "为了达到尽可能高的预测准确率，先进的处理器采用了竞赛式预测器（tournament predictor），它让多种预测策略相互竞争，并动态地选择获胜者。该系统的“智能”在于其“选择器”（chooser）机制，它能随时间推移，学习并判断哪个组件预测器对于特定分支更为可靠。本练习 [@problem_id:3619732] 聚焦于这个选择器的动态行为，要求你计算当一个分支的行为模式发生改变时，选择器需要多少次更新才能调整其偏好。这将帮助你深入理解顶尖预测硬件的自适应能力和响应延迟。", "problem": "一个超标量核心使用一个竞赛预测器，该预测器结合了一个全局历史异或（XOR）索引预测器（gshare）和一个两级局部预测器。竞赛选择器为每个静态分支使用一个 $c$ 位饱和计数器，仅当两个组件预测器预测不一致时才更新：如果 gshare 预测正确而局部预测器不正确，则计数器加 $+1$；如果局部预测器正确而 gshare 不正确，则计数器减1；其他情况不变。如果计数器值至少为 $2^{c-1}$，选择器选择 gshare，否则选择局部预测器。计数器的饱和值为 $0$ 和 $2^{c}-1$。\n\n考虑一个单一的静态分支，其结果形成一个随时间分段周期性的轨迹，周期为 $p$。工作负载在两个阶段之间交替进行：\n\n阶段 $1$：分支的结果是最后 $p$ 个全局结果和程序计数器（PC）的确定性函数。假设全局历史异或索引预测器有一个长度为 $p$ 的全局历史寄存器（GHR），一个足够大以避免该分支索引产生别名效应的模式历史表（PHT），并在短于一个周期 $p$ 的预热后收敛到完美预测。假设局部预测器使用长度为 $p-1$ 的分支局部历史，并在其自身的预热后收敛到每个周期 $p$ 恰好错误预测一个结果。在这些条件下，假设每个周期 $p$ 恰好发生一次不一致，并且在每次不一致时，gshare 都是正确的，而局部预测器是不正确的。设该阶段持续足够长的时间，以至于到阶段 $1$ 结束时，此分支的选择器计数器饱和到 $2^{c}-1$。\n\n阶段 $2$：分支的结果转变为一个不同的确定性函数，该函数依赖于长度为 $p-1$ 的分支局部历史，并且局部预测器在短于一个周期 $p$ 的预热后收敛到完美预测。假设由于阶段 $2$ 中活跃的其他控制流的干扰，gshare 对此分支每个周期 $p$ 恰好错误预测一个结果，并且所有不一致都恰好每个周期 $p$ 发生一次，其中每次不一致时局部预测器都是正确的，而 gshare 是不正确的。\n\n从阶段 $2$ 开始时，此分支的竞赛选择器计数器为 $2^{c}-1$。根据给定的更新规则和阶段 $2$ 的不一致行为，推导选择器从此分支的 gshare 选择翻转到局部预测器选择所需的选择器更新次数的期望值（表示为 $u$）的闭式表达式。请将 $u$ 的最终答案表示为仅包含 $c$ 的闭式解析表达式。无需四舍五入。不包括单位。", "solution": "该问题要求推导竞赛预测器将其偏好从 gshare 预测器切换到局部预测器所需的更新次数。\n\n设 $C$ 表示竞赛选择器使用的 $c$ 位饱和计数器的值。$C$ 的值范围可以从 $0$ 到 $2^c - 1$。\n选择器的选择规则定义如下：\n- 如果计数器值 $C \\ge 2^{c-1}$，则选择 gshare 预测器。\n- 如果计数器值 $C  2^{c-1}$，则选择局部预测器。\n\n场景从阶段 $2$ 开始。根据阶段 $1$ 的描述，所讨论分支的选择器计数器已饱和至其最大值。设 $C_0$ 为阶段 $2$ 开始时的初始计数器值。\n$$C_0 = 2^c - 1$$\n在此初始状态下，选择器选择 gshare 预测器，因为对于任何整数 $c \\ge 1$（一个最小的 1 位计数器），不等式 $2^c - 1 \\ge 2^{c-1}$ 均成立。对于 $c=1$，我们有 $1 \\ge 1$。对于 $c > 1$，$2^c - 2^{c-1} = 2^{c-1}$，所以 $2^c = 2^{c-1} + 2^{c-1}$。不等式变为 $2^{c-1} + 2^{c-1} - 1 \\ge 2^{c-1}$，可化简为 $2^{c-1} - 1 \\ge 0$，该条件对于 $c \\ge 1$ 成立。\n\n在阶段 $2$ 期间，问题陈述指出组件预测器之间的不一致恰好每个周期 $p$ 发生一次。在每次不一致的情况下，局部预测器都是正确的，而 gshare 预测器是不正确的。根据指定的更新规则，“如果局部预测器正确而 gshare 不正确，则选择器...减少 $-1$”。这意味着在阶段 $2$ 中的每次更新事件时，计数器值 $C$ 减少 $1$。\n\n设 $u$ 为自阶段 $2$ 开始以来发生的选择器更新次数。每次更新对应于一个单独的不一致事件。经过 $u$ 次更新后，计数器值 $C_u$ 的演变由以下确定性递推关系给出：\n$$C_u = C_{u-1} - 1$$\n初始条件为 $C_0 = 2^c - 1$。\n展开这个递推关系，我们得到 $C_u$ 的闭式表达式：\n$$C_u = C_0 - u = (2^c - 1) - u$$\n只要计数器未达到其在 $0$ 处的饱和点（当 $u \\ge 2^c - 1$ 时发生），此表达式就有效。\n\n当计数器值 $C$ 首次降至阈值 $2^{c-1}$ 以下时，选择器被称为从 gshare“翻转”其选择到局部预测器。我们正在寻找满足此条件的最小整数更新次数 $u$。\n$$C_u  2^{c-1}$$\n代入 $C_u$ 的表达式：\n$$(2^c - 1) - u  2^{c-1}$$\n我们必须解关于 $u$ 的这个不等式：\n$$u > (2^c - 1) - 2^{c-1}$$\n通过将 $2^c$ 重写为 $2 \\times 2^{c-1}$，我们可以化简不等式的右侧：\n$$u > (2 \\times 2^{c-1}) - 2^{c-1} - 1$$\n$$u > (2-1) \\times 2^{c-1} - 1$$\n$$u > 2^{c-1} - 1$$\n由于 $u$ 必须是表示更新次数的整数，满足此严格不等式的最小整数值 $u$ 是比下界大一：\n$$u = (2^{c-1} - 1) + 1 = 2^{c-1}$$\n\n为了验证这个结果，我们可以检查就在翻转之前和翻转之时计数器的状态。\n让我们考虑更新次数 $u = 2^{c-1}$。\n在第 $(u-1)$ 次更新时，即经过 $2^{c-1}-1$ 次更新后，计数器值为：\n$$C_{u-1} = (2^c - 1) - (2^{c-1} - 1) = 2^c - 2^{c-1} = 2 \\times 2^{c-1} - 2^{c-1} = 2^{c-1}$$\n此时，$C_{u-1} = 2^{c-1}$，满足条件 $C \\ge 2^{c-1}$。因此，选择器仍然选择 gshare 预测器。\n\n在第 $u$ 次更新时，即经过 $2^{c-1}$ 次更新后，计数器值变为：\n$$C_u = C_{u-1} - 1 = 2^{c-1} - 1$$\n现在，计数器值是 $C_u  2^{c-1}$。这触发了翻转，选择器首次选择局部预测器。\n\n因此，选择器翻转所需的精确更新次数是 $2^{c-1}$。问题陈述要求的是更新的“期望数量”。由于所描述的系统演变是完全确定性的，更新次数是一个固定量。在这种情况下，期望值与这个确定性值相同。最终表达式按要求只依赖于 $c$。", "answer": "$$\\boxed{2^{c-1}}$$", "id": "3619732"}]}