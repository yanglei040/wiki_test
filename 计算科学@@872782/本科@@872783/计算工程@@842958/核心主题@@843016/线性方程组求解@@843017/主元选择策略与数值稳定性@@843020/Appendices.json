{"hands_on_practices": [{"introduction": "第一个练习将清晰且具体地展示，为何主元选择不仅是一种优化，更是保证数值稳定性的必要条件。通过处理一个精心设计的 $3 \\times 3$ 小矩阵，您将直接比较带部分主元选择和不带主元选择的高斯消元法。这个实践 [@problem_id:2424558] 将让您亲眼见证，一个糟糕的主元选择如何导致矩阵元素灾难性的增长，而一个简单的行交换却能维护数值的准确性。", "problem": "设 $\\delta$ 是一个固定的正实数参数，满足 $0 < \\delta \\ll 1$。考虑 $3 \\times 3$ 矩阵\n$$\nA_{\\delta} \\;=\\;\n\\begin{pmatrix}\n\\delta & 1 & 1 \\\\\n1 & 1 & 1+\\delta \\\\\n1 & 1+\\delta & 1+2\\delta\n\\end{pmatrix}.\n$$\n定义 $M_{\\mathrm{nopiv}}$ 为对矩阵 $A_{\\delta}$ 进行不使用任何主元选择的高斯消元法所得到的最终上三角因子 $U$ 中所有元素绝对值的最大值。类似地，定义 $M_{\\mathrm{pp}}$ 为使用部分主元高斯消元法得到的结果，其中在每一步消元中，主元选为当前列中从当前行及以下各行中绝对值最大的元素，并相应地交换行。令\n$$\nR(\\delta) \\;=\\; \\frac{M_{\\mathrm{nopiv}}}{M_{\\mathrm{pp}}}.\n$$\n对于 $\\delta = 1.0 \\times 10^{-4}$，计算 $R(\\delta)$ 并将最终结果四舍五入到四位有效数字。答案必须是一个无单位的实数。", "solution": "对问题陈述进行验证。\n\n步骤1：提取已知条件\n- 一个固定的正实数参数 $\\delta$，满足 $0 < \\delta \\ll 1$。\n- 一个 $3 \\times 3$ 矩阵 $A_{\\delta} = \\begin{pmatrix} \\delta & 1 & 1 \\\\ 1 & 1 & 1+\\delta \\\\ 1 & 1+\\delta & 1+2\\delta \\end{pmatrix}$。\n- $M_{\\mathrm{nopiv}}$：对 $A_{\\delta}$ 进行无主元高斯消元法得到的上三角因子 $U$ 中各元素绝对值的最大值。\n- $M_{\\mathrm{pp}}$：对 $A_{\\delta}$ 进行部分主元高斯消元法得到的上三角因子 $U$ 中各元素绝对值的最大值。\n- $R(\\delta) = \\frac{M_{\\mathrm{nopiv}}}{M_{\\mathrm{pp}}}$。\n- 使用特定值 $\\delta = 1.0 \\times 10^{-4}$。\n- $R(\\delta)$ 的最终结果必须四舍五入到四位有效数字。\n\n步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是适定且客观的。这是一个关于高斯消元法的稳定性及主元选择策略作用的数值线性代数标准问题。这些概念是计算科学与工程的基础。所有术语定义明确，所有必要数据均已提供，问题没有矛盾或逻辑缺陷。\n\n步骤3：结论与行动\n问题有效。将提供完整解答。\n\n解题过程包括三个主要部分：执行无主元高斯消元法，执行部分主元高斯消元法，然后计算所需的比率。\n\n第1部分：无主元高斯消元法\n\n我们从矩阵 $A_{\\delta}$ 开始，记为 $A^{(1)}$：\n$$\nA^{(1)} =\n\\begin{pmatrix}\n\\delta & 1 & 1 \\\\\n1 & 1 & 1+\\delta \\\\\n1 & 1+\\delta & 1+2\\delta\n\\end{pmatrix}\n$$\n第一个主元是 $a_{11}^{(1)} = \\delta$。由于 $\\delta$ 非常小，我们预计会出现显著的元素增长。第一步的乘数是 $m_{21} = \\frac{a_{21}^{(1)}}{a_{11}^{(1)}} = \\frac{1}{\\delta}$ 和 $m_{31} = \\frac{a_{31}^{(1)}}{a_{11}^{(1)}} = \\frac{1}{\\delta}$。\n行变换为 $R_2 \\to R_2 - m_{21} R_1$ 和 $R_3 \\to R_3 - m_{31} R_1$。\n新的元素为：\n$a_{22}^{(2)} = a_{22}^{(1)} - m_{21} a_{12}^{(1)} = 1 - \\frac{1}{\\delta} \\cdot 1 = 1 - \\frac{1}{\\delta}$。\n$a_{23}^{(2)} = a_{23}^{(1)} - m_{21} a_{13}^{(1)} = (1+\\delta) - \\frac{1}{\\delta} \\cdot 1 = 1 + \\delta - \\frac{1}{\\delta}$。\n$a_{32}^{(2)} = a_{32}^{(1)} - m_{31} a_{12}^{(1)} = (1+\\delta) - \\frac{1}{\\delta} \\cdot 1 = 1 + \\delta - \\frac{1}{\\delta}$。\n$a_{33}^{(2)} = a_{33}^{(1)} - m_{31} a_{13}^{(1)} = (1+2\\delta) - \\frac{1}{\\delta} \\cdot 1 = 1 + 2\\delta - \\frac{1}{\\delta}$。\n\n消元第一步后的矩阵是：\n$$\nA^{(2)} =\n\\begin{pmatrix}\n\\delta & 1 & 1 \\\\\n0 & 1 - \\frac{1}{\\delta} & 1 + \\delta - \\frac{1}{\\delta} \\\\\n0 & 1 + \\delta - \\frac{1}{\\delta} & 1 + 2\\delta - \\frac{1}{\\delta}\n\\end{pmatrix}\n$$\n第二个主元是 $a_{22}^{(2)} = 1 - \\frac{1}{\\delta}$。第二步的乘数是 $m_{32} = \\frac{a_{32}^{(2)}}{a_{22}^{(2)}} = \\frac{1 + \\delta - 1/\\delta}{1 - 1/\\delta} = \\frac{\\delta^2 + \\delta - 1}{\\delta - 1}$。\n变换为 $R_3 \\to R_3 - m_{32} R_2$，得到新的元素 $a_{33}^{(3)}$：\n$$\na_{33}^{(3)} = a_{33}^{(2)} - m_{32} a_{23}^{(2)} = \\left(1 + 2\\delta - \\frac{1}{\\delta}\\right) - \\frac{\\delta^2 + \\delta - 1}{\\delta - 1} \\left(1 + \\delta - \\frac{1}{\\delta}\\right)\n$$\n$$\na_{33}^{(3)} = \\frac{\\delta + 2\\delta^2 - 1}{\\delta} - \\frac{\\delta^2+\\delta-1}{\\delta-1} \\frac{\\delta^2+\\delta-1}{\\delta} = \\frac{(\\delta+2\\delta^2-1)(\\delta-1) - (\\delta^2+\\delta-1)^2}{\\delta(\\delta-1)}\n$$\n分子化简为 $(2\\delta^3-\\delta^2-2\\delta+1) - (\\delta^4+2\\delta^3-\\delta^2-2\\delta+1) = -\\delta^4$。\n$$\na_{33}^{(3)} = \\frac{-\\delta^4}{\\delta(\\delta - 1)} = \\frac{-\\delta^3}{\\delta-1} = \\frac{\\delta^3}{1-\\delta}\n$$\n最终的上三角矩阵 $U_{\\mathrm{nopiv}}$ 是：\n$$\nU_{\\mathrm{nopiv}} =\n\\begin{pmatrix}\n\\delta & 1 & 1 \\\\\n0 & 1 - \\frac{1}{\\delta} & 1 + \\delta - \\frac{1}{\\delta} \\\\\n0 & 0 & \\frac{\\delta^3}{1 - \\delta}\n\\end{pmatrix}\n$$\n为了求得 $M_{\\mathrm{nopiv}}$，我们找出 $U_{\\mathrm{nopiv}}$ 中所有元素绝对值的最大值。对于 $0 < \\delta \\ll 1$：\n$|u_{11}| = \\delta$。\n$|u_{12}| = 1$。\n$|u_{13}| = 1$。\n$|u_{22}| = |1 - \\frac{1}{\\delta}| = \\frac{1-\\delta}{\\delta} = \\frac{1}{\\delta} - 1$。\n$|u_{23}| = |1 + \\delta - \\frac{1}{\\delta}| = |\\frac{\\delta^2+\\delta-1}{\\delta}| = \\frac{1-\\delta-\\delta^2}{\\delta} = \\frac{1}{\\delta} - 1 - \\delta$。\n$|u_{33}| = |\\frac{\\delta^3}{1 - \\delta}| = \\frac{\\delta^3}{1-\\delta}$。\n比较这些值，最大的是 $|u_{22}| = \\frac{1}{\\delta} - 1$。因此，$M_{\\mathrm{nopiv}} = \\frac{1-\\delta}{\\delta}$。\n\n第2部分：部分主元高斯消元法\n\n我们再次从 $A^{(1)}$ 开始。在第一列中，元素为 $\\delta, 1, 1$。最大的绝对值是 $1$。我们将第1行与第2行交换（与第3行交换会得到等价的结果）。\n$$\nA'^{(1)} =\n\\begin{pmatrix}\n1 & 1 & 1+\\delta \\\\\n\\delta & 1 & 1 \\\\\n1 & 1+\\delta & 1+2\\delta\n\\end{pmatrix}\n$$\n主元是 $a'_{11} = 1$。乘数是 $m_{21} = \\frac{\\delta}{1} = \\delta$ 和 $m_{31} = \\frac{1}{1} = 1$。\n行变换得到：\n$a_{22}^{(2)} = 1 - \\delta \\cdot 1 = 1 - \\delta$。\n$a_{23}^{(2)} = 1 - \\delta(1+\\delta) = 1 - \\delta - \\delta^2$。\n$a_{32}^{(2)} = (1+\\delta) - 1 \\cdot 1 = \\delta$。\n$a_{33}^{(2)} = (1+2\\delta) - 1(1+\\delta) = \\delta$。\n第一步之后的矩阵是：\n$$\nA^{(2)} =\n\\begin{pmatrix}\n1 & 1 & 1+\\delta \\\\\n0 & 1 - \\delta & 1 - \\delta - \\delta^2 \\\\\n0 & \\delta & \\delta\n\\end{pmatrix}\n$$\n对于第二步，我们考虑第二列从对角线向下的元素。这些元素是 $1-\\delta$ 和 $\\delta$。由于 $0 < \\delta \\ll 1$，我们有 $|1-\\delta| > |\\delta|$。不需要进行行交换。\n主元是 $a_{22}^{(2)} = 1 - \\delta$。乘数是 $m_{32} = \\frac{\\delta}{1-\\delta}$。\n新的元素 $a_{33}^{(3)}$ 是：\n$$\na_{33}^{(3)} = \\delta - \\frac{\\delta}{1-\\delta}(1-\\delta-\\delta^2) = \\frac{\\delta(1-\\delta) - \\delta(1-\\delta-\\delta^2)}{1-\\delta} = \\frac{(\\delta-\\delta^2) - (\\delta-\\delta^2-\\delta^3)}{1-\\delta} = \\frac{\\delta^3}{1-\\delta}\n$$\n最终的上三角矩阵 $U_{\\mathrm{pp}}$ 是：\n$$\nU_{\\mathrm{pp}} =\n\\begin{pmatrix}\n1 & 1 & 1+\\delta \\\\\n0 & 1 - \\delta & 1 - \\delta - \\delta^2 \\\\\n0 & 0 & \\frac{\\delta^3}{1 - \\delta}\n\\end{pmatrix}\n$$\n为了求得 $M_{\\mathrm{pp}}$，我们找出 $U_{\\mathrm{pp}}$ 中所有元素绝对值的最大值。\n$|u'_{11}| = 1$。\n$|u'_{12}| = 1$。\n$|u'_{13}| = 1+\\delta$。\n$|u'_{22}| = 1-\\delta$。\n$|u'_{23}| = 1-\\delta-\\delta^2$。\n$|u'_{33}| = \\frac{\\delta^3}{1-\\delta}$。\n对于 $0 < \\delta \\ll 1$，这些值中最大的显然是 $1+\\delta$。因此，$M_{\\mathrm{pp}} = 1+\\delta$。\n\n第3部分：计算 $R(\\delta)$\n\n比率 $R(\\delta)$ 由下式给出：\n$$\nR(\\delta) = \\frac{M_{\\mathrm{nopiv}}}{M_{\\mathrm{pp}}} = \\frac{\\frac{1-\\delta}{\\delta}}{1+\\delta} = \\frac{1-\\delta}{\\delta(1+\\delta)}\n$$\n我们需要为 $\\delta = 1.0 \\times 10^{-4}$ 计算此值。\n代入该值：\n$$\nM_{\\mathrm{nopiv}} = \\frac{1 - 10^{-4}}{10^{-4}} = \\frac{0.9999}{10^{-4}} = 9999\n$$\n$$\nM_{\\mathrm{pp}} = 1 + 10^{-4} = 1.0001\n$$\n$$\nR(10^{-4}) = \\frac{9999}{1.0001}\n$$\n执行除法：\n$$\nR(10^{-4}) \\approx 9998.00019998\n$$\n问题要求将此结果四舍五入到四位有效数字。前四位有效数字是 $9, 9, 9, 8$。第五位有效数字是 $0$，所以我们向下舍入。\n最终结果是 $9998$。", "answer": "$$\n\\boxed{9998}\n$$", "id": "2424558"}, {"introduction": "在理解了主元选择的基本必要性之后，这个练习将探索一系列可选的策略。您将对臭名昭著的病态矩阵——希尔伯特矩阵，实现并比较四种方法，从不使用主元选择到完全主元选择。这个动手实验 [@problem_id:2424559] 是数值分析中的一个经典案例，旨在量化地展示，在求解敏感线性系统时，更复杂的主元技术如何提供更高精度的结果。", "problem": "给定希尔伯特矩阵 $H \\in \\mathbb{R}^{n \\times n}$，其元素为 $H_{ij} = \\dfrac{1}{i + j - 1}$，其中 $i,j \\in \\{1,\\dots,n\\}$。对于给定的 $n$，定义向量 $x_{\\mathrm{true}} \\in \\mathbb{R}^n$ 为 $(x_{\\mathrm{true}})_i = 1$（对所有 $i \\in \\{1,\\dots,n\\}$），并定义 $b = H x_{\\mathrm{true}}$。对于指定测试集中的每个 $n$，通过在四种主元选择策略下构造 $H$ 的分解，然后求解该分解所确定的三角系统，来计算线性系统 $H x = b$ 解的数值近似值 $\\hat{x}$。这四种策略是：\n(1) 无主元选择，其中 $H = L U$，$L$ 是单位下三角矩阵，$U$ 是上三角矩阵，\n(2) 部分主元选择（行主元选择），其中 $P H = L U$，$P$ 是一个置换矩阵，\n(3) 比例部分主元选择（带行缩放的行主元选择），其中 $P H = L U$，$P$ 是一个由行缩放考虑确定的置换矩阵，以及\n(4) 完全主元选择（行和列主元选择），其中 $P H Q = L U$，$P$ 和 $Q$ 是置换矩阵。\n对于每种策略，计算相对 2-范数解误差 $e = \\dfrac{\\lVert \\hat{x} - x_{\\mathrm{true}} \\rVert_2}{\\lVert x_{\\mathrm{true}} \\rVert_2}$。\n\n使用以下测试集进行 $n$ 的测试：$\\{1,3,8,12\\}$。对于此集合中的每个 $n$，返回一个包含四个浮点值的列表，按顺序对应于策略 (1)、(2)、(3) 和 (4) 的相对误差。将所有 $n$ 的结果汇总到一个列表的列表中，并保持 $n$ 的相同顺序。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，不含空格，其中每个内部列表对应测试集中的一个 $n$。每个浮点值必须以科学记数法格式化，小数点后保留 6 位数字。例如，输出应具有以下形式：\n$[[e_{1,1},e_{1,2},e_{1,3},e_{1,4}],[e_{3,1},e_{3,2},e_{3,3},e_{3,4}],[e_{8,1},e_{8,2},e_{8,3},e_{8,4}],[e_{12,1},e_{12,2},e_{12,3},e_{12,4}]]$，\n其中 $e_{n,s}$ 表示大小为 $n$ 和策略为 $s$ 的相对误差。\n\n该问题不涉及任何物理单位。不使用角度。所有最终数值答案必须是按上述规定打印的实数。所有测试用例的答案类型均为浮点数。该问题应纯粹根据矩阵分解、置换矩阵和三角系统求解的定义来解决，并且其描述是完全自洽的，不依赖于任何特定的编程语言或库。", "solution": "所述问题是有效的。这是一个适定的、有科学依据的数值线性代数练习，其核心是线性系统求解中的数值稳定性这一关键课题。所有定义和参数都已明确给出。\n\n基本任务是针对多个维度 $n$ 求解线性方程组 $H x = b$，其中 $H$ 是 $n \\times n$ 的希尔伯特矩阵。$H$ 的元素由 $H_{ij} = \\dfrac{1}{i+j-1}$ 给出，其中 $i,j \\in \\{1, \\dots, n\\}$。向量 $b$ 的构造使得精确解（表示为 $x_{\\mathrm{true}}$）是一个全为 1 的向量：对所有 $i$，$(x_{\\mathrm{true}})_i = 1$。因此，右侧项为 $b = H x_{\\mathrm{true}}$，这意味着其分量为 $b_i = \\sum_{j=1}^{n} H_{ij} = \\sum_{j=1}^{n} \\dfrac{1}{i+j-1}$。\n\n希尔伯特矩阵是病态矩阵的一个经典例子。其条件数 $\\kappa(H) = \\lVert H \\rVert \\lVert H^{-1} \\rVert$ 随 $n$ 以超指数速率增长。这种极端的敏感性意味着在数值计算过程中引入的微小浮点舍入误差可能会被放大，导致最终解 $\\hat{x}$ 出现巨大误差。本问题的目标是观察并量化这种效应，并展示各种主元选择策略在减轻此类数值不稳定性方面的有效性。\n\n求解方法是高斯消元法，该方法在算法上对应于将矩阵 $H$ 分解为一个下三角矩阵 $L$ 和一个上三角矩阵 $U$ 的乘积。一旦获得分解，系统就可以通过连续的正向和反向代入高效地求解。我们将实现并比较此过程的四种变体。对于每个数值解 $\\hat{x}$，我们将计算其相对 2-范数误差：\n$$e = \\frac{\\lVert \\hat{x} - x_{\\mathrm{true}} \\rVert_2}{\\lVert x_{\\mathrm{true}} \\rVert_2}$$\n鉴于对所有 $i$，$(x_{\\mathrm{true}})_i=1$，真实解的范数为 $\\lVert x_{\\mathrm{true}} \\rVert_2 = \\sqrt{\\sum_{i=1}^n 1^2} = \\sqrt{n}$。\n\n四种主元选择策略如下：\n\n1.  **无主元选择**：\n    矩阵 $H$ 直接分解为 $H = LU$，其中 $L$ 是单位下三角矩阵，$U$ 是上三角矩阵。系统 $Hx=b$ 变为 $LUx=b$。这分两个阶段求解：\n    -   首先，使用正向代入求解 $Ly=b$ 得到 $y$。\n    -   然后，使用反向代入求解 $Ux=y$ 得到 $x$。\n    如果任何主元元素 $U_{kk}$ 很小，这种朴素的方法已知是数值不稳定的，因为它可能导致大的乘数和灾难性的精度损失。对于希尔伯特矩阵，主元会变得非常小，这保证了其性能会很差。\n\n2.  **部分主元选择（行主元选择）**：\n    这是提高高斯消元法稳定性的最常用策略。在消元的每一步 $k$ 中，算法会在当前主元列中（从第 $k$ 行向下）搜索绝对值最大的元素。假设该元素位于第 $p$ 行，其中 $p \\ge k$。然后交换第 $k$ 行和第 $p$ 行。这个过程等效于找到一个置换矩阵 $P$，使得分解在置换后的矩阵上进行：$PH=LU$。置换 $P$ 会对 $H$ 的行进行重新排序，以确保消元过程中使用的主元元素尽可能大，从而使 $L$ 中的乘数绝对值被限制在 1 以内。系统 $Hx=b$ 被重写为 $PHx=Pb$，从而得到 $LUx=Pb$。我们求解 $Ly=Pb$，然后求解 $Ux=y$。\n\n3.  **比例部分主元选择**：\n    该策略是部分主元选择的改进。它旨在防止仅仅因为某行整体包含较大项而选择该行中的一个大元素作为主元。在消元之前，为每一行计算一个比例因子 $s_i$，定义为该行中任何元素的最大绝对值：$s_i = \\max_{1 \\le j \\le n} |H_{ij}|$。在第 $k$ 步，算法不是选择原始的最大元素，而是选择主元行 $p$ ($p \\ge k$)，该行使得主元候选值的绝对值与其行比例因子之比最大化：$\\dfrac{|A_{pk}^{(k-1)}|}{s_p}$。这里的矩阵 $A^{(k-1)}$ 表示经过 $k-1$ 步消元后的矩阵状态。选择主元行后，将其与第 $k$ 行交换，然后像标准的部分主元选择一样进行消元。比例因子也必须交换。得到的分解形式仍然是 $PH=LU$。\n\n4.  **完全主元选择**：\n    这是最稳健但也是计算成本最高的主元选择策略。在每一步 $k$ 中，算法会在整个剩余子矩阵 $A^{(k-1)}_{i,j \\ge k}$ 中搜索绝对值最大的元素。如果该元素在位置 $(p, q)$ 处找到，则交换第 $k$ 行与第 $p$ 行，以及第 $k$ 列与第 $q$ 列。这对应于找到两个置换矩阵，$P$（用于行）和 $Q$（用于列），使得 $PHQ=LU$。系统 $Hx=b$ 被转换为 $(PHQ)(Q^T x) = Pb$。令 $z = Q^T x$。我们首先使用正向和反向代入求解系统 $LUz = Pb$ 得到 $z$。然后通过撤销列置换来恢复最终解：$x = Qz$。完全主元选择通过最小化分解过程中的元素增长，提供了数值稳定性方面最好的理论保证，但在每一步都需要进行大量的比较。\n\n我们预计会观察到一个明显的趋势：随着主元选择策略的复杂性增加，误差将减小，从无主元选择（最大误差）到完全主元选择（最小误差）。这证明了主元选择在有限精度算术中为病态系统获得有意义解的关键作用。", "answer": "[[0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00],[1.724286e-14,8.621430e-15,8.621430e-15,8.621430e-15],[4.444211e-08,1.493977e-12,1.213968e-12,1.213968e-12],[1.201416e-01,1.060124e-06,9.274384e-07,9.274384e-07]]", "id": "2424559"}, {"introduction": "在真实的计算工程问题中，特别是大规模系统，矩阵通常是稀疏的。最后一个练习深入探讨了一个关键的权衡问题：为保证数值稳定性而进行的主元选择与为保持计算效率而维持稀疏性之间的冲突。通过分析一个主元选择破坏了旨在减少填充的排序的案例 [@problem_id:2424537]，您将深入理解在为稀疏系统设计稳健且高效的直接求解器时所需做出的复杂决策。", "problem": "您的任务是构建并评估在稀疏直接分解中行主元选择对减少填充排序的影响。对于下面指定的每个矩阵，考虑一个置换向量 $p$（以单行表示法给出）及其关联的置换矩阵 $P \\in \\mathbb{R}^{n \\times n}$。定义对称置换后的矩阵 $\\hat{A} = P A P^{\\top}$。必须考虑 $\\hat{A}$ 的两种分解：\n\n1. 静态排序分解 $\\hat{A} = L_{\\mathrm{np}} U_{\\mathrm{np}}$，其中 $L_{\\mathrm{np}}$ 是单位下三角矩阵，$U_{\\mathrm{np}}$ 是上三角矩阵，在分解过程中不进行任何行交换。\n\n2. 部分主元分解 $P_{\\mathrm{pp}} \\hat{A} = L_{\\mathrm{pp}} U_{\\mathrm{pp}}$，其中 $L_{\\mathrm{pp}}$ 是单位下三角矩阵，$U_{\\mathrm{pp}}$ 是上三角矩阵，$P_{\\mathrm{pp}}$ 是一个置换矩阵，通过在每一步 $k$ 中，从第 $k,k+1,\\ldots,n$ 行中选择第 $k$ 列绝对值最大的元素作为主元而生成。\n\n对于任何矩阵 $M \\in \\mathbb{R}^{n \\times n}$ 和容差 $\\tau = 10^{-12}$，定义结构非零元计数 $\\mathrm{nnz}_{\\tau}(M)$ 为集合 $\\{(i,j) : |M_{ij}| > \\tau\\}$ 的基数。定义填充计数\n$$\nF_{\\mathrm{np}} = \\mathrm{nnz}_{\\tau}(L_{\\mathrm{np}} - I) + \\mathrm{nnz}_{\\tau}(U_{\\mathrm{np}}) - \\mathrm{nnz}_{\\tau}(\\hat{A}),\n$$\n$$\nF_{\\mathrm{pp}} = \\mathrm{nnz}_{\\tau}(L_{\\mathrm{pp}} - I) + \\mathrm{nnz}_{\\tau}(U_{\\mathrm{pp}}) - \\mathrm{nnz}_{\\tau}(\\hat{A}),\n$$\n其中 $I$ 表示单位矩阵。定义交换次数 $s$ 为部分主元分解所执行的行交换次数。定义增长因子\n$$\n\\gamma = \\frac{\\max_{i,j} |U_{ij}|}{\\max_{i,j} |\\hat{A}_{ij}|}.\n$$\n\n对于下面的每个测试用例，计算数对 $(F_{\\mathrm{np}}, F_{\\mathrm{pp}})$、交换次数 $s$ 以及增长因子 $\\gamma_{\\mathrm{np}}$ 和 $\\gamma_{\\mathrm{pp}}$，其中下标表示所使用的分解方法。报告 $\\gamma_{\\mathrm{np}}$ 和 $\\gamma_{\\mathrm{pp}}$ 时，需四舍五入到六位小数。\n\n以下所有矩阵均为实值，维度如指定，其元素被精确定义（本问题不涉及物理单位）。不涉及角度。最终输出应为单行文本，包含格式化为每个用例摘要列表的结果，其中每个摘要是一个列表 $[F_{\\mathrm{np}}, F_{\\mathrm{pp}}, s, \\gamma_{\\mathrm{np}}, \\gamma_{\\mathrm{pp}}]$。例如，程序应打印形如 $[[\\cdot,\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot,\\cdot],\\ldots]$ 的单行文本。\n\n测试套件：\n\n- 用例 1（基准窄带，预计无破坏性主元选择）：\n  - 大小 $n = 8$。\n  - 矩阵 $A^{(1)} \\in \\mathbb{R}^{8 \\times 8}$ 是三对角矩阵，满足\n    $$\n    A^{(1)}_{ii} = 4 \\text{ for } i=1,\\ldots,8,\\quad A^{(1)}_{i,i+1} = A^{(1)}_{i+1,i} = -1 \\text{ for } i=1,\\ldots,7,\n    $$\n    所有其他元素为零。\n  - 置换 $p^{(1)} = [1,2,3,4,5,6,7,8]$。\n\n- 用例 2（存在减少填充的排序，但对角线元素较小以引发破坏性主元选择）：\n  - 大小 $n = 8$。\n  - 矩阵 $A^{(2)} \\in \\mathbb{R}^{8 \\times 8}$ 从与 $A^{(1)}$ 相同的三对角结构开始，然后按如下方式修改：\n    $$\n    A^{(2)}_{1,5} = A^{(2)}_{5,1} = -1,\\quad A^{(2)}_{4,8} = A^{(2)}_{8,4} = -1.\n    $$\n    将所有对角线元素设置为 $4$，除了\n    $$\n    A^{(2)}_{1,1} = 10^{-6},\\quad A^{(2)}_{3,3} = 10^{-6}.\n    $$\n  - 减少填充的置换 $p^{(2)} = [1,5,2,6,3,7,4,8]$。\n\n- 用例 3（由于多个小对角线元素导致的强破坏性主元选择）：\n  - 大小 $n = 8$。\n  - 矩阵 $A^{(3)} \\in \\mathbb{R}^{8 \\times 8}$ 具有与 $A^{(2)}$ 相同的稀疏模式和非对角线值（即，相同的三对角元素和值为 $-1$ 的额外耦合项 $(1,5)$ 和 $(4,8)$），但对角线元素为\n    $$\n    A^{(3)}_{1,1} = A^{(3)}_{2,2} = A^{(3)}_{3,3} = A^{(3)}_{4,4} = 10^{-9},\\quad A^{(3)}_{i,i} = 4 \\text{ for } i \\in \\{5,6,7,8\\}.\n    $$\n  - 使用相同的减少填充的置换 $p^{(3)} = [1,5,2,6,3,7,4,8]$。\n\n数值参数和输出规范：\n\n- 在所有非零元计数中，使用 $\\tau = 10^{-12}$ 作为结构零阈值。\n- 对于每个测试用例 $k \\in \\{1,2,3\\}$，计算并汇总\n  $$\n  [F_{\\mathrm{np}}^{(k)}, F_{\\mathrm{pp}}^{(k)}, s^{(k)}, \\gamma_{\\mathrm{np}}^{(k)}, \\gamma_{\\mathrm{pp}}^{(k)}],\n  $$\n  其中 $\\gamma_{\\mathrm{np}}^{(k)}$ 和 $\\gamma_{\\mathrm{pp}}^{(k)}$ 四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含这三个摘要的逗号分隔列表，并用方括号括起来；即，\n  $$\n  \\big[\\,[F_{\\mathrm{np}}^{(1)}, F_{\\mathrm{pp}}^{(1)}, s^{(1)}, \\gamma_{\\mathrm{np}}^{(1)}, \\gamma_{\\mathrm{pp}}^{(1)}],\\ [F_{\\mathrm{np}}^{(2)}, F_{\\mathrm{pp}}^{(2)}, s^{(2)}, \\gamma_{\\mathrm{np}}^{(2)}, \\gamma_{\\mathrm{pp}}^{(2)}],\\ [F_{\\mathrm{np}}^{(3)}, F_{\\mathrm{pp}}^{(3)}, s^{(3)}, \\gamma_{\\mathrm{np}}^{(3)}, \\gamma_{\\mathrm{pp}}^{(3)}] \\big].\n  $$", "solution": "该问题要求在稀疏矩阵分解的背景下，分析减少填充排序与数值主元选择策略之间的相互作用。我们得到三个测试用例，每个用例由一个矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和一个置换向量 $p$ 定义。任务的核心是比较对称置换矩阵 $\\hat{A} = P A P^{\\top}$ 的两种 LU 分解方法，其中 $P$ 是与 $p$ 对应的置换矩阵。\n\n首先，我们必须形式化置换矩阵 $\\hat{A}$ 的构造过程。一个以单行表示法给出的置换向量 $p = [p_1, p_2, \\ldots, p_n]$ 指定了矩阵索引的一种重排序。我们采用标准解释，即新矩阵 $\\hat{A}$ 的第 $i$ 行和第 $i$ 列对应于原矩阵 $A$ 的第 $p_i$ 行和第 $p_i$ 列。这意味着 $\\hat{A}_{ij} = A_{p_i, p_j}$。在实现时，对于一个 $n \\times n$ 矩阵使用从0开始的索引，如果 $p_{_0}$ 是从0开始的置换索引向量，那么可以通过将此索引应用于 $A$ 的行和列来计算 $\\hat{A}$。\n\n所考虑的两种分解方法是：\n\n$1$. 静态排序分解（无主元选择）：我们直接计算 $\\hat{A}$ 的 LU 分解，使得 $\\hat{A} = L_{\\mathrm{np}} U_{\\mathrm{np}}$，其中 $L_{\\mathrm{np}}$ 是单位下三角矩阵，$U_{\\mathrm{np}}$ 是上三角矩阵。这是通过标准的、不进行任何行交换的高斯消元算法实现的。这种方法严格遵守所提供的排序 $p$，该排序通常被选择来最小化填充（即在因子中产生新的非零元素）。然而，如果遇到一个很小或为零的主元 $U_{kk}$，该方法可能数值不稳定，导致因子中出现大数值。\n\n$2$. 部分主元分解：我们使用部分主元法计算 $\\hat{A}$ 的 LU 分解。这会得到一个形如 $P_{\\mathrm{pp}} \\hat{A} = L_{\\mathrm{pp}} U_{\\mathrm{pp}}$ 的分解，其中 $L_{\\mathrm{pp}}$ 是单位下三角矩阵，$U_{\\mathrm{pp}}$ 是上三角矩阵，$P_{\\mathrm{pp}}$ 是表示在分解过程中执行的行交换的置换矩阵。在消元的每一步 $k$，算法从第 $k$ 列（在第 $k, \\ldots, n-1$ 行中）选择一个绝对值最大的元素作为主元，并将其所在行与第 $k$ 行交换。该策略旨在通过避免除以小数来确保数值稳定性，从而控制因子中元素的大小。其权衡之处在于，这些由 $P_{\\mathrm{pp}}$ 代表的行交换会破坏初始的减少填充排序 $p$，可能导致比静态排序方法多得多的填充。\n\n为了量化这种权衡，我们为每个用例计算几个指标：\n\n- 填充计数 $F_{\\mathrm{np}}$ 和 $F_{\\mathrm{pp}}$，用于衡量与置换矩阵 $\\hat{A}$ 相比，在因子 $L$ 和 $U$ 中产生的新非零元素的数量。结构非零元计数 $\\mathrm{nnz}_{\\tau}(M)$ 定义为矩阵 $M$ 中绝对值超过容差 $\\tau = 10^{-12}$ 的元素数量。那么填充量为 $F = \\mathrm{nnz}_{\\tau}(L - I) + \\mathrm{nnz}_{\\tau}(U) - \\mathrm{nnz}_{\\tau}(\\hat{A})$。\n- 交换次数 $s$，是部分主元算法执行的总行交换次数。它量化了为保证稳定性而改变初始排序的程度。\n- 增长因子 $\\gamma_{\\mathrm{np}}$ 和 $\\gamma_{\\mathrm{pp}}$，用于衡量分解过程中的元素增长，定义为 $\\gamma = \\frac{\\max_{i,j} |U_{ij}|}{\\max_{i,j} |\\hat{A}_{ij}|}$。一个小的增长因子表明分解是数值稳定的。\n\n每个测试用例的算法流程如下：\n$1$. 构建矩阵 $A^{(k)}$ 和基于1的置换向量 $p^{(k)}$。\n$2$. 将 $p^{(k)}$ 转换为基于0的索引数组，以计算对称置换矩阵 $\\hat{A} = P A^{(k)} P^{\\top}$。\n$3$. 对于无主元选择的情况，实现一个直接 LU 分解算法，从 $\\hat{A}$ 生成 $L_{\\mathrm{np}}$ 和 $U_{\\mathrm{np}}$，不进行行交换。计算填充量 $F_{\\mathrm{np}}$ 和增长因子 $\\gamma_{\\mathrm{np}}$。\n$4$. 对于部分主元选择的情况，使用一个鲁棒的库函数（例如 `scipy.linalg.lu_factor`）对 $\\hat{A}$ 执行带部分主元选择的 LU 分解。从其输出中，提取因子 $L_{\\mathrm{pp}}$ 和 $U_{\\mathrm{pp}}$，并确定交换次数 $s$。计算填充量 $F_{\\mathrm{pp}}$ 和增长因子 $\\gamma_{\\mathrm{pp}}$。\n$5$. 对每个用例，汇总结果 $[F_{\\mathrm{np}}, F_{\\mathrm{pp}}, s, \\gamma_{\\mathrm{np}}, \\gamma_{\\mathrm{pp}}]$，其中增长因子四舍五入到六位小数，并将它们格式化为最终的输出结构。\n这种结构化的比较将展示为保证稳定性而进行的主元选择如何破坏保持稀疏性的排序，这是设计大型稀疏系统直接求解器时的一个基本考虑因素。", "answer": "[[0,0,0,1.000000,1.000000],[0,7,2,250001.000000,1.000000],[7,13,4,4000000001.000000,1.000000]]", "id": "2424537"}]}