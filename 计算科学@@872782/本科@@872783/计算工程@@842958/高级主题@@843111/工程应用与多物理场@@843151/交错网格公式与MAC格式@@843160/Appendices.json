{"hands_on_practices": [{"introduction": "一个数值格式的稳定性是其能够用于实际模拟的先决条件。这个练习将指导你使用冯·诺依曼稳定性分析这一基本工具，来推导一个交错网格上平流扩散方程的稳定条件 [@problem_id:2438292]。通过这个过程，你将深入理解不同物理项（平流和扩散）的离散格式如何共同决定最大允许时间步长。", "problem": "考虑一维（$1$D）线性平流-扩散方程\n$$\n\\frac{\\partial \\phi}{\\partial t} + U\\,\\frac{\\partial \\phi}{\\partial x} = \\nu\\,\\frac{\\partial^2 \\phi}{\\partial x^2},\n$$\n在一个周期性域上，其中 $U$ 是空间均匀的恒定平流速度，$\\nu$ 是正常数运动扩散系数。使用间距为 $\\Delta x$ 的均匀网格和一维交错的 Marker-And-Cell (MAC) 布局对空间域进行离散：标量场 $\\phi$ 存储在由整数 $i$ 索引的单元中心，而速度 $U$ 是一个面心的常数，存储在半整数位置 $i+\\tfrac{1}{2}$。使用时间步长为 $\\Delta t$ 的完全显式前向欧拉法进行时间推进。对于空间离散化，使用：\n- 平流项采用守恒通量差分形式，面通量 $(U \\phi)_{i+\\frac{1}{2}}$ 通过面心速度和 $\\phi$ 到面的中心插值 $\\phi_{i+\\frac{1}{2}} = \\tfrac{1}{2}(\\phi_{i+1} + \\phi_i)$ 计算得到，\n- 扩散项在单元中心采用标准的二阶中心差分。\n\n在这些假设下，单元中心值 $\\phi_i$ 在一个时间步长内的更新公式为\n$$\n\\phi_i^{n+1} = \\phi_i^{n} - \\Delta t\\,\\frac{(U\\phi)_{i+\\frac{1}{2}}^{n} - (U\\phi)_{i-\\frac{1}{2}}^{n}}{\\Delta x} + \\Delta t\\,\\nu\\,\\frac{\\phi_{i+1}^{n} - 2\\phi_{i}^{n} + \\phi_{i-1}^{n}}{\\Delta x^2},\n$$\n其中 $(U\\phi)_{i+\\frac{1}{2}}^{n} = U\\,\\tfrac{1}{2}(\\phi_{i+1}^{n} + \\phi_{i}^{n})$，对于 $i-\\tfrac{1}{2}$ 也类似。假设为周期性边界条件。\n\n对这个完全显式的交错网格格式进行 von Neumann 稳定性分析，并确定最大的精确时间步长 $\\Delta t_{\\max}$，表示为关于 $U$、$\\nu$ 和 $\\Delta x$ 的解析表达式，使得所有傅里叶模在一个时间步长内其幅度不被放大。全过程使用国际单位制（SI）；时间步长的单位是秒。以 $U$、$\\nu$ 和 $\\Delta x$ 的单个闭式表达式形式给出你的最终答案。不需要进行数值舍入。", "solution": "首先对问题陈述进行严格的验证程序。\n\n步骤 1：提取已知条件。\n控制偏微分方程是一维线性平流-扩散方程：\n$$\n\\frac{\\partial \\phi}{\\partial t} + U\\,\\frac{\\partial \\phi}{\\partial x} = \\nu\\,\\frac{\\partial^2 \\phi}{\\partial x^2}\n$$\n参数为空间均匀的恒定平流速度 $U$ 和正常数运动扩散系数 $\\nu$。空间域是周期性的，并用均匀网格间距 $\\Delta x$ 进行离散。数值格式定义如下：\n- 时间积分：采用时间步长为 $\\Delta t$ 的完全显式前向欧拉法。\n- 网格布局：交错的 Marker-And-Cell (MAC) 布局，标量 $\\phi$ 位于单元中心 $x_i = i \\Delta x$，速度 $U$ 位于网格面 $x_{i+1/2} = (i+1/2)\\Delta x$。\n- 平流项离散：守恒通量差分形式，其中面通量为 $(U \\phi)_{i+\\frac{1}{2}} = U\\,\\phi_{i+\\frac{1}{2}} = U\\,\\tfrac{1}{2}(\\phi_{i+1} + \\phi_i)$。\n- 扩散项离散：标准的二阶中心差分。\n得到的全离散更新方程如下：\n$$\n\\phi_i^{n+1} = \\phi_i^{n} - \\Delta t\\,\\frac{(U\\phi)_{i+\\frac{1}{2}}^{n} - (U\\phi)_{i-\\frac{1}{2}}^{n}}{\\Delta x} + \\Delta t\\,\\nu\\,\\frac{\\phi_{i+1}^{n} - 2\\phi_{i}^{n} + \\phi_{i-1}^{n}}{\\Delta x^2}\n$$\n通量定义为：\n$$\n(U\\phi)_{i+\\frac{1}{2}}^{n} = U\\,\\frac{\\phi_{i+1}^{n} + \\phi_{i}^{n}}{2} \\quad \\text{和} \\quad (U\\phi)_{i-\\frac{1}{2}}^{n} = U\\,\\frac{\\phi_{i}^{n} + \\phi_{i-1}^{n}}{2}\n$$\n任务是通过执行 von Neumann 稳定性分析，找到最大稳定时间步长 $\\Delta t_{\\max}$。\n\n步骤 2：使用提取的已知条件进行验证。\n评估问题的有效性。\n- **科学基础**：平流-扩散方程是输运现象中的一个基本模型。所描述的数值方法（前向欧拉法、中心差分、交错网格）是计算工程中的标准方法。von Neumann 分析是评估线性有限差分格式稳定性的典型技术。该问题具有科学合理性。\n- **适定性**：问题给出了足够的细节。它提供了控制方程、完整的离散格式和一个明确的目标：确定稳定性极限。稳定性界限的唯一解存在且有意义。\n- **客观性**：问题使用精确、无歧义的数学和技术语言陈述。它不含主观论断。\n- **完备性与一致性**：分析所需的所有要素均已提供。定义中没有矛盾。问题是自洽的。\n\n步骤 3：结论与行动。\n问题有效。现在推导求解过程。\n\n第一步是将给定的通量表达式代入更新方程。\n$$\n\\phi_i^{n+1} = \\phi_i^{n} - \\frac{\\Delta t}{\\Delta x} \\left( U\\,\\frac{\\phi_{i+1}^{n} + \\phi_{i}^{n}}{2} - U\\,\\frac{\\phi_{i}^{n} + \\phi_{i-1}^{n}}{2} \\right) + \\frac{\\nu \\Delta t}{\\Delta x^2} (\\phi_{i+1}^{n} - 2\\phi_i^{n} + \\phi_{i-1}^{n})\n$$\n化简平流项得到：\n$$\n\\phi_i^{n+1} = \\phi_i^{n} - \\frac{U \\Delta t}{2 \\Delta x} (\\phi_{i+1}^{n} - \\phi_{i-1}^{n}) + \\frac{\\nu \\Delta t}{\\Delta x^2} (\\phi_{i+1}^{n} - 2\\phi_i^{n} + \\phi_{i-1}^{n})\n$$\n该格式对于平流项和扩散项都是一个前向时间中心空间（FTCS）离散格式。为了分析其稳定性，我们进行 von Neumann 分析。我们将单个傅里叶模代入网格点 $i$ 和时间层 $n$ 的解中：\n$$\n\\phi_i^n = \\hat{\\phi}^n(k) \\exp(I k x_i) = \\hat{\\phi}^n(k) \\exp(I k i \\Delta x)\n$$\n其中 $I = \\sqrt{-1}$ 是虚数单位，$k$ 是波数，$\\hat{\\phi}^n(k)$ 是在时间 $n$ 的模的振幅。放大因子定义为 $G(k) = \\hat{\\phi}^{n+1}(k) / \\hat{\\phi}^n(k)$。将傅里叶模代入离散方程得到：\n$$\nG(k) \\exp(Iki\\Delta x) = \\exp(Iki\\Delta x) - \\frac{U \\Delta t}{2 \\Delta x} (\\exp(Ik(i+1)\\Delta x) - \\exp(Ik(i-1)\\Delta x)) + \\frac{\\nu \\Delta t}{\\Delta x^2} (\\exp(Ik(i+1)\\Delta x) - 2\\exp(Iki\\Delta x) + \\exp(Ik(i-1)\\Delta x))\n$$\n两边同除以 $\\exp(Iki\\Delta x)$ 得到放大因子 $G(k)$：\n$$\nG(k) = 1 - \\frac{U \\Delta t}{2 \\Delta x} (\\exp(Ik\\Delta x) - \\exp(-Ik\\Delta x)) + \\frac{\\nu \\Delta t}{\\Delta x^2} (\\exp(Ik\\Delta x) - 2 + \\exp(-Ik\\Delta x))\n$$\n使用欧拉恒等式 $\\exp(I\\theta) - \\exp(-I\\theta) = 2I\\sin(\\theta)$ 和 $\\exp(I\\theta) + \\exp(-I\\theta) - 2 = 2\\cos(\\theta) - 2 = -4\\sin^2(\\theta/2)$，并令 $\\alpha = k\\Delta x$，我们有：\n$$\nG(\\alpha) = 1 - \\frac{U \\Delta t}{2 \\Delta x} (2I\\sin(\\alpha)) + \\frac{\\nu \\Delta t}{\\Delta x^2} (2\\cos(\\alpha) - 2)\n$$\n令 Courant 数为 $c = \\frac{U \\Delta t}{\\Delta x}$，扩散数为 $d = \\frac{\\nu \\Delta t}{\\Delta x^2}$。放大因子变为：\n$$\nG(\\alpha) = 1 - I c \\sin(\\alpha) - 4d \\sin^2(\\alpha/2)\n$$\n为使格式稳定，对于所有可能的波数，放大因子的模不得超过 1，即对所有 $\\alpha \\in [-\\pi, \\pi]$，有 $|G(\\alpha)| \\le 1$。我们分析模的平方：\n$$\n|G(\\alpha)|^2 = \\left(1 - 4d \\sin^2(\\alpha/2)\\right)^2 + (-c \\sin(\\alpha))^2 \\le 1\n$$\n$$\n1 - 8d \\sin^2(\\alpha/2) + 16d^2 \\sin^4(\\alpha/2) + c^2 \\sin^2(\\alpha) \\le 1\n$$\n使用恒等式 $\\sin^2(\\alpha) = (2\\sin(\\alpha/2)\\cos(\\alpha/2))^2 = 4\\sin^2(\\alpha/2)\\cos^2(\\alpha/2) = 4\\sin^2(\\alpha/2)(1-\\sin^2(\\alpha/2))$，我们得到：\n$$\n-8d \\sin^2(\\alpha/2) + 16d^2 \\sin^4(\\alpha/2) + 4c^2 \\sin^2(\\alpha/2)(1-\\sin^2(\\alpha/2)) \\le 0\n$$\n令 $S = \\sin^2(\\alpha/2)$。对于 $\\alpha \\in [-\\pi, \\pi]$，$S$ 的范围是从 $0$ 到 $1$。对于 $S > 0$，我们可以除以 $S$：\n$$\n-8d + 16d^2 S + 4c^2 (1-S) \\le 0\n$$\n$$\n(4c^2 - 8d) + S(16d^2 - 4c^2) \\le 0\n$$\n这个不等式在 $S$ 中是线性的，并且必须对所有 $S \\in [0, 1]$ 成立。这只有在不等式在端点 $S=0$ 和 $S=1$ 处成立时才可能。\n对于 $S \\to 0$（长波，$\\alpha \\to 0$）：\n$$\n4c^2 - 8d \\le 0 \\implies c^2 \\le 2d\n$$\n对于 $S=1$（最短波，$\\alpha = \\pm\\pi$）：\n$$\n(4c^2 - 8d) + (16d^2 - 4c^2) \\le 0 \\implies 16d^2 - 8d \\le 0 \\implies 8d(2d-1) \\le 0\n$$\n因为 $\\nu>0$, $\\Delta t>0$ 且 $\\Delta x^2>0$，我们有 $d>0$。因此，第二个条件简化为：\n$$\n2d-1 \\le 0 \\implies d \\le \\frac{1}{2}\n$$\n我们现在有两个必须同时满足以保证稳定性的条件：\n1. $c^2 \\le 2d$\n2. $d \\le \\frac{1}{2}$\n\n将 $c$ 和 $d$ 的定义代回，用物理参数表示。对于条件 1：\n$$\n\\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\le 2\\left(\\frac{\\nu \\Delta t}{\\Delta x^2}\\right) \\implies \\frac{U^2 (\\Delta t)^2}{\\Delta x^2} \\le \\frac{2\\nu \\Delta t}{\\Delta x^2}\n$$\n假设 $\\Delta t > 0$，我们可以简化以找到 $\\Delta t$ 的一个界限：\n$$\nU^2 \\Delta t \\le 2\\nu \\implies \\Delta t \\le \\frac{2\\nu}{U^2} \\quad (\\text{对于 } U \\neq 0)\n$$\n对于条件 2：\n$$\n\\frac{\\nu \\Delta t}{\\Delta x^2} \\le \\frac{1}{2} \\implies \\Delta t \\le \\frac{\\Delta x^2}{2\\nu}\n$$\n时间步长 $\\Delta t$ 必须同时满足这两个约束。因此，最大允许时间步长 $\\Delta t_{\\max}$ 是这两个上界的最小值：\n$$\n\\Delta t_{\\max} = \\min\\left(\\frac{2\\nu}{U^2}, \\frac{\\Delta x^2}{2\\nu}\\right)\n$$\n该表达式是给定数值格式的完整且精确的稳定性极限。", "answer": "$$\n\\boxed{\\min\\left(\\frac{2\\nu}{U^2}, \\frac{\\Delta x^2}{2\\nu}\\right)}\n$$", "id": "2438292"}, {"introduction": "交错网格将不同变量存储在网格的不同位置，这虽然能避免数值伪振荡，但也给数据后处理和可视化带来了挑战。本练习旨在分析和比较几种将速度分量从网格面“去交错化”到网格中心的插值格式 [@problem_id:2438310]。通过分析它们的精度和数值特性，你将学会如何在不同数值格式之间进行权衡，这是计算工程师的一项核心技能。", "problem": "在一个矩形域上使用二维均匀的 Marker-and-Cell (MAC) 网格，其间距为 $\\Delta x$ 和 $\\Delta y$。单元中心位于 $(x_i,y_j)$，东、西面中心位于 $(x_{i+1/2},y_j)$ 和 $(x_{i-1/2},y_j)$，北、南面中心位于 $(x_i,y_{j+1/2})$ 和 $(x_i,y_{j-1/2})$，其中 $x_{i\\pm 1/2} = x_i \\pm \\Delta x/2$ 和 $y_{j\\pm 1/2} = y_j \\pm \\Delta y/2$。面中心速度分量由 $u_{i+1/2,j} \\approx u(x_{i+1/2},y_j)$ 和 $v_{i,j+1/2} \\approx v(x_i,y_{j+1/2})$ 给出，表示光滑精确速度场 $(u(x,y),v(x,y))$ 的采样。\n\n为了在单元中心进行可视化，考虑使用以下两种针对内部单元的格式，从面中心值构造一个去交错的、单元中心的速度 $(u^\\star_{i,j},v^\\star_{i,j})$：\n\n格式 $\\mathrm{S1}$ (沿每个坐标方向的两点算术平均):\n$$\nu^{(1)}_{i,j} = \\frac{1}{2}\\left(u_{i+1/2,j} + u_{i-1/2,j}\\right), \\quad\nv^{(1)}_{i,j} = \\frac{1}{2}\\left(v_{i,j+1/2} + v_{i,j-1/2}\\right).\n$$\n\n格式 $\\mathrm{S2}$ (沿每个坐标方向的对称$4$点高阶中点重构):\n$$\nu^{(2)}_{i,j} = \\frac{-\\,u_{i+3/2,j} + 9\\,u_{i+1/2,j} + 9\\,u_{i-1/2,j} - u_{i-3/2,j}}{16}, \\quad\nv^{(2)}_{i,j} = \\frac{-\\,v_{i,j+3/2} + 9\\,v_{i,j+1/2} + 9\\,v_{i,j-1/2} - v_{i,j-3/2}}{16}.\n$$\n\n将任意单元中心场 $(\\tilde u_{i,j},\\tilde v_{i,j})$ 的单元中心离散散度定义为中心差分算子\n$$\n(\\nabla_h \\cdot \\tilde{\\boldsymbol{u}})_{i,j} \\equiv \\frac{\\tilde u_{i+1,j} - \\tilde u_{i-1,j}}{2\\,\\Delta x} + \\frac{\\tilde v_{i,j+1} - \\tilde v_{i,j-1}}{2\\,\\Delta y}.\n$$\n\n假设精确场是光滑的，并且在指定情况下是精确无散的，即 $\\partial_x u + \\partial_y v \\equiv 0$，且面上的采样值等于在面位置处的精确场值。\n\n下列哪些陈述是正确的？\n\nA. 对于光滑场，格式 $\\mathrm{S1}$ 在单元中心具有二阶精度，并且能精确重构 $u$ 在 $x$ 方向上和 $v$ 在 $y$ 方向上的任意线性场。\n\nB. 对于光滑场，格式 $\\mathrm{S2}$ 在单元中心具有四阶精度，但因为它使用负权重，所以它不是单调的，并且即使在面数据有界的情况下，也可能在陡峭梯度附近产生过冲。\n\nC. 如果精确速度场是无散的，并且面采样是精确的，那么由格式 $\\mathrm{S1}$ 构成的离散散度 $(\\nabla_h \\cdot \\boldsymbol{u}^{(1)})_{i,j}$ 满足 $(\\nabla_h \\cdot \\boldsymbol{u}^{(1)})_{i,j} = \\mathcal{O}(\\Delta x^2 + \\Delta y^2)$。\n\nD. 格式 $\\mathrm{S1}$ 分量式地满足离散极值原理：$u^{(1)}_{i,j}$ 位于 $u_{i-1/2,j}$ 和 $u_{i+1/2,j}$ 之间，并且 $v^{(1)}_{i,j}$ 位于 $v_{i,j-1/2}$ 和 $v_{i,j+1/2}$ 之间。\n\nE. 在均匀网格上，格式 $\\mathrm{S2}$ 退化为格式 $\\mathrm{S1}$，因为两者都是中心对称的。", "solution": "问题陈述已经过验证，被认为是科学上合理的、适定的、客观且自洽的。它是在交错网格上进行有限差分格式数值分析的一个标准练习。我们将通过严格应用泰勒级数分析和数值方法的基本原理来评估每个陈述。\n\n分析的核心在于光滑函数 $f(x)$ 在点 $x_c$ 附近的泰勒级数展开：\n$$ f(x_c + \\delta) = f(x_c) + \\delta f'(x_c) + \\frac{\\delta^2}{2!} f''(x_c) + \\frac{\\delta^3}{3!} f'''(x_c) + \\frac{\\delta^4}{4!} f''''(x_c) + \\mathcal{O}(\\delta^5) $$\n\n### 陈述 A 的分析\n\n该陈述声称格式 $\\mathrm{S1}$ 具有二阶精度，并且能精确重构线性场。\n\n首先，我们分析格式 $\\mathrm{S1}$ 对于速度分量 $u$ 的截断误差。该格式为：\n$$ u^{(1)}_{i,j} = \\frac{1}{2}\\left(u_{i+1/2,j} + u_{i-1/2,j}\\right) $$\n根据假设，面上的值是精确的：$u_{i\\pm 1/2,j} = u(x_i \\pm \\Delta x/2, y_j)$。我们在单元中心 $(x_i, y_j)$ 附近展开这些项：\n$$ u(x_i + \\Delta x/2, y_j) = u(x_i, y_j) + \\frac{\\Delta x}{2}\\frac{\\partial u}{\\partial x} + \\frac{1}{2}\\left(\\frac{\\Delta x}{2}\\right)^2\\frac{\\partial^2 u}{\\partial x^2} + \\mathcal{O}(\\Delta x^3) $$\n$$ u(x_i - \\Delta x/2, y_j) = u(x_i, y_j) - \\frac{\\Delta x}{2}\\frac{\\partial u}{\\partial x} + \\frac{1}{2}\\left(\\frac{\\Delta x}{2}\\right)^2\\frac{\\partial^2 u}{\\partial x^2} - \\mathcal{O}(\\Delta x^3) $$\n将这些代入 $u^{(1)}_{i,j}$ 的公式中：\n$$ u^{(1)}_{i,j} = \\frac{1}{2} \\left[ \\left(u + \\frac{\\Delta x}{2}\\frac{\\partial u}{\\partial x} + \\frac{\\Delta x^2}{8}\\frac{\\partial^2 u}{\\partial x^2}\\right) + \\left(u - \\frac{\\Delta x}{2}\\frac{\\partial u}{\\partial x} + \\frac{\\Delta x^2}{8}\\frac{\\partial^2 u}{\\partial x^2}\\right) + \\mathcal{O}(\\Delta x^4) \\right] $$\n$$ u^{(1)}_{i,j} = u(x_i, y_j) + \\frac{\\Delta x^2}{8}\\frac{\\partial^2 u}{\\partial x^2}(x_i, y_j) + \\mathcal{O}(\\Delta x^4) $$\n截断误差为 $u^{(1)}_{i,j} - u(x_i, y_j) = \\mathcal{O}(\\Delta x^2)$。该格式是二阶精度的。\n\n接下来，我们测试一个在 $x$ 方向的线性场，即 $u(x,y) = a(y)x + b(y)$。为简单起见，设 $u(x) = ax+b$。\n$$ u_{i\\pm 1/2,j} = a(x_i \\pm \\Delta x/2) + b $$\n$$ u^{(1)}_{i,j} = \\frac{1}{2} \\left[ (a(x_i + \\Delta x/2) + b) + (a(x_i - \\Delta x/2) + b) \\right] = \\frac{1}{2} [2ax_i + 2b] = ax_i + b = u(x_i) $$\n该格式精确地重构了单元中心的线性场。同样的逻辑适用于 $v^{(1)}_{i,j}$ 和在 $y$ 方向的线性场。\n\n该陈述完全正确。\n**结论：正确**\n\n### 陈述 B 的分析\n\n该陈述声称格式 $\\mathrm{S2}$ 具有四阶精度且非单调。\n\n首先，我们分析格式 $\\mathrm{S2}$ 对于 $u$ 的截断误差：\n$$ u^{(2)}_{i,j} = \\frac{-\\,u_{i+3/2,j} + 9\\,u_{i+1/2,j} + 9\\,u_{i-1/2,j} - u_{i-3/2,j}}{16} $$\n我们使用 $u(x_i \\pm k\\Delta x/2, y_j)$ 在 $(x_i, y_j)$ 附近的泰勒展开，并按 $\\Delta x$ 的奇偶次幂收集项。\n$$ 9(u_{i+1/2,j} + u_{i-1/2,j}) = 9 \\left[ 2u + 2\\frac{1}{2!}(\\frac{\\Delta x}{2})^2 u_{xx} + 2\\frac{1}{4!}(\\frac{\\Delta x}{2})^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) \\right] = 18u + \\frac{9}{4}\\Delta x^2 u_{xx} + \\frac{3}{32}\\Delta x^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) $$\n$$ -(u_{i+3/2,j} + u_{i-3/2,j}) = - \\left[ 2u + 2\\frac{1}{2!}(\\frac{3\\Delta x}{2})^2 u_{xx} + 2\\frac{1}{4!}(\\frac{3\\Delta x}{2})^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) \\right] = -2u - \\frac{9}{4}\\Delta x^2 u_{xx} - \\frac{27}{32}\\Delta x^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) $$\n将这些相加得到分子：\n$$ \\text{Numerator} = (18u - 2u) + \\left(\\frac{9}{4} - \\frac{9}{4}\\right)\\Delta x^2 u_{xx} + \\left(\\frac{3}{32} - \\frac{27}{32}\\right)\\Delta x^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) $$\n$$ \\text{Numerator} = 16u - \\frac{24}{32}\\Delta x^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) = 16u - \\frac{3}{4}\\Delta x^4 u_{xxxx} + \\mathcal{O}(\\Delta x^6) $$\n除以 $16$：\n$$ u^{(2)}_{i,j} = u(x_i,y_j) - \\frac{3}{64} \\Delta x^4 \\frac{\\partial^4 u}{\\partial x^4}(x_i,y_j) + \\mathcal{O}(\\Delta x^6) $$\n截断误差为 $\\mathcal{O}(\\Delta x^4)$。该格式是四阶精度的。\n\n接下来，我们检查该格式的权重：$\\{-1/16, 9/16, 9/16, -1/16\\}$。负权重的存在意味着该格式不是单调的。一个非单调的线性插值格式不满足离散极值原理。这意味着插值 $u^{(2)}_{i,j}$ 不保证位于输入数据值 $\\{u_{i-3/2,j}, u_{i-1/2,j}, u_{i+1/2,j}, u_{i+3/2,j}\\}$ 的范围内。这可能导致非物理的过冲和下冲，尤其是在高梯度区域。\n\n该陈述完全正确。\n**结论：正确**\n\n### 陈述 C 的分析\n\n该陈述讨论了对于无散场，离散散度 $(\\nabla_h \\cdot \\boldsymbol{u}^{(1)})_{i,j}$ 的值。我们必须分析这个操作的截断误差。\n$$ (\\nabla_h \\cdot \\boldsymbol{u}^{(1)})_{i,j} = \\frac{u^{(1)}_{i+1,j} - u^{(1)}_{i-1,j}}{2\\,\\Delta x} + \\frac{v^{(1)}_{i,j+1} - v^{(1)}_{i,j-1}}{2\\,\\Delta y} $$\n让我们分析 $x$ 分量项。我们使用以下表达式：\n$$ u^{(1)}_{i+1,j} = \\frac{1}{2}(u_{i+3/2,j} + u_{i+1/2,j}) $$\n$$ u^{(1)}_{i-1,j} = \\frac{1}{2}(u_{i-3/2,j} + u_{i-1/2,j}) $$\n有限差分项为：\n$$ \\frac{u^{(1)}_{i+1,j} - u^{(1)}_{i-1,j}}{2\\,\\Delta x} = \\frac{1}{4\\,\\Delta x} \\left[ (u_{i+3/2,j} - u_{i-3/2,j}) + (u_{i+1/2,j} - u_{i-1/2,j}) \\right] $$\n我们在 $(x_i, y_j)$ 附近使用泰勒级数展开：\n$$ u_{i\\pm k/2,j} - u_{i\\mp k/2,j} = k\\Delta x \\frac{\\partial u}{\\partial x} + \\frac{(k\\Delta x)^3}{24} \\frac{\\partial^3 u}{\\partial x^3} + \\mathcal{O}(\\Delta x^5) $$\n对于 $k=3$: $u_{i+3/2,j} - u_{i-3/2,j} = 3\\Delta x u_x + \\frac{27\\Delta x^3}{24}u_{xxx} + \\mathcal{O}(\\Delta x^5) = 3\\Delta x u_x + \\frac{9}{8}\\Delta x^3 u_{xxx} + \\mathcal{O}(\\Delta x^5)$。\n对于 $k=1$: $u_{i+1/2,j} - u_{i-1/2,j} = \\Delta x u_x + \\frac{\\Delta x^3}{24}u_{xxx} + \\mathcal{O}(\\Delta x^5)$。\n代入表达式中：\n$$ \\frac{1}{4\\,\\Delta x} \\left[ \\left(3\\Delta x u_x + \\frac{9}{8}\\Delta x^3 u_{xxx}\\right) + \\left(\\Delta x u_x + \\frac{1}{24}\\Delta x^3 u_{xxx}\\right) + \\mathcal{O}(\\Delta x^5) \\right] $$\n$$ = \\frac{1}{4\\,\\Delta x} \\left[ 4\\Delta x u_x + \\left(\\frac{27+1}{24}\\right)\\Delta x^3 u_{xxx} + \\mathcal{O}(\\Delta x^5) \\right] = u_x + \\frac{28}{96}\\Delta x^2 u_{xxx} + \\mathcal{O}(\\Delta x^4) = u_x + \\frac{7}{24}\\Delta x^2 u_{xxx} + \\mathcal{O}(\\Delta x^4) $$\n对于 $y$ 分量项，可以得到类似的结果。总的离散散度为：\n$$ (\\nabla_h \\cdot \\boldsymbol{u}^{(1)})_{i,j} = \\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) + \\frac{7}{24}\\left(\\Delta x^2 \\frac{\\partial^3 u}{\\partial x^3} + \\Delta y^2 \\frac{\\partial^3 v}{\\partial y^3}\\right) + \\text{h.o.t.} $$\n鉴于精确场是无散的，$\\partial_x u + \\partial_y v = 0$。因此，残余的离散散度为：\n$$ (\\nabla_h \\cdot \\boldsymbol{u}^{(1)})_{i,j} = \\frac{7}{24}\\left(\\Delta x^2 u_{xxx} + \\Delta y^2 v_{yyy}\\right) + \\text{h.o.t.} = \\mathcal{O}(\\Delta x^2, \\Delta y^2) $$\n陈述声称结果是 $\\mathcal{O}(\\Delta x^2 + \\Delta y^2)$，这是这种误差行为的标准表示法。\n\n该陈述是正确的。\n**结论：正确**\n\n### 陈述 D 的分析\n\n该陈述声称格式 $\\mathrm{S1}$ 满足离散极值原理。\n$$ u^{(1)}_{i,j} = \\frac{1}{2}u_{i+1/2,j} + \\frac{1}{2}u_{i-1/2,j} $$\n这是两个面值 $u_{i-1/2,j}$ 和 $u_{i+1/2,j}$ 的加权平均。权重为 $w_1 = 1/2$ 和 $w_2 = 1/2$。\n如果所有权重 $w_k \\ge 0$ 且 $\\sum w_k = 1$，则线性组合 $z = \\sum w_k x_k$ 是一个凸组合。这里，权重是非负的，并且 $1/2 + 1/2 = 1$。因此，$u^{(1)}_{i,j}$ 是 $u_{i-1/2,j}$ 和 $u_{i+1/2,j}$ 的凸组合。\n凸组合的一个基本性质是结果必须位于输入点的凸包内。对于两个点，凸包是它们之间的线段。因此，\n$$ \\min(u_{i-1/2,j}, u_{i+1/2,j}) \\le u^{(1)}_{i,j} \\le \\max(u_{i-1/2,j}, u_{i+1/2,j}) $$\n这意味着插值不能大于输入的最大值或小于输入的最小值。这正是插值的离散极值原理。同样的情况也适用于 $v^{(1)}_{i,j}$。\n\n该陈述是正确的。\n**结论：正确**\n\n### 陈述 E 的分析\n\n该陈述声称格式 $\\mathrm{S2}$ 退化为格式 $\\mathrm{S1}$。\n这是一个错误的断言。这两种格式由具有不同模板的独特公式定义。格式 $\\mathrm{S1}$ 是一个$2$点平均，而格式 $\\mathrm{S2}$ 是一个$4$点公式。它们还具有不同的精度阶数（$\\mathrm{S1}$ 为 $\\mathcal{O}(\\Delta x^2)$，$\\mathrm{S2}$ 为 $\\mathcal{O}(\\Delta x^4)$）。\n两种格式只有在对任何输入场都代数等价时才能“退化”为彼此，但事实并非如此。要使两者相等，我们需要：\n$$ \\frac{-\\,u_{i+3/2,j} + 9\\,u_{i+1/2,j} + 9\\,u_{i-1/2,j} - u_{i-3/2,j}}{16} = \\frac{u_{i+1/2,j} + u_{i-1/2,j}}{2} $$\n这简化为条件 $u_{i+3/2,j} + u_{i-3/2,j} = u_{i+1/2,j} + u_{i-1/2,j}$。\n如陈述 A 的分析所示，两种格式对于线性场都是精确的，因此在这种特定情况下它们产生相同的结果。然而，对于任何 $\\partial^2 u/\\partial x^2 \\neq 0$ 的场，此条件通常不成立。例如，对于 $u(x)=x^2$：\n$$ (x_i+3\\Delta x/2)^2 + (x_i-3\\Delta x/2)^2 = 2x_i^2 + \\frac{9}{2}\\Delta x^2 $$\n$$ (x_i+\\Delta x/2)^2 + (x_i-\\Delta x/2)^2 = 2x_i^2 + \\frac{1}{2}\\Delta x^2 $$\n这两者显然不相等。两种格式都是“中心对称的”这一事实与它们的等价性无关；许多不同的数值格式都共享这些属性。\n\n该陈述不正确。\n**结论：不正确**", "answer": "$$\\boxed{ABCD}$$", "id": "2438310"}, {"introduction": "求解压力泊松方程是不可压缩流体MAC格式算法的核心步骤。这个编程练习将引导你实现一个经典的迭代求解器，并亲手探究一个关键的性能问题：网格各向异性（即拉伸的网格单元）如何影响求解器的收敛速度 [@problem_id:2438296]。这项实践将为你提供宝贵的经验，让你深入了解许多CFD求解器计算核心的实际行为。", "problem": "要求您通过直接数值实验来量化网格单元的纵横比如何影响标记网格法 (MAC) 交错网格上压力泊松方程迭代求解器的收敛速率。考虑单位正方形域 $[0,1]\\times[0,1]$，压力未知数位于单元中心。设 $N_x$ 和 $N_y$ 分别表示沿 $x$ 和 $y$ 方向的内部压力未知数的数量。均匀网格间距为 $\\Delta x = \\dfrac{1}{N_x+1}$ 和 $\\Delta y = \\dfrac{1}{N_y+1}$，因此单元纵横比为 $\\Delta x / \\Delta y = \\dfrac{N_y+1}{N_x+1}$。在 $\\partial \\Omega$ 上施加齐次狄利克雷边界条件 $p=0$，并求解离散泊松方程\n$$\n\\frac{p_{i+1,j}-2 p_{i,j}+p_{i-1,j}}{(\\Delta x)^2}+\\frac{p_{i,j+1}-2 p_{i,j}+p_{i,j-1}}{(\\Delta y)^2}=f_{i,j},\n$$\n对所有内部索引 $(i,j)$，其中源项是在内部单元中心位置 $(x_i,y_j)=(i\\,\\Delta x, j\\,\\Delta y)$（其中 $i\\in\\{1,\\dots,N_x\\}$ 且 $j\\in\\{1,\\dots,N_y\\}$）从连续函数 $f(x,y)=-2\\pi^2\\sin(\\pi x)\\sin(\\pi y)$ 采样得到。使用红黑高斯-赛德尔 (RBGS) 迭代法，从所有内部点 $(i,j)$ 的零场 $p_{i,j}^{(0)}=0$ 开始，并在每次迭代中对所有边界节点强制实施 $p=0$。在每次完整的 RBGS 扫描（一次红点更新和一次黑点更新）后，计算离散残差\n$$\nr_{i,j}=\\frac{p_{i+1,j}-2 p_{i,j}+p_{i-1,j}}{(\\Delta x)^2}+\\frac{p_{i,j+1}-2 p_{i,j}+p_{i,j-1}}{(\\Delta y)^2}-f_{i,j},\n$$\n以及相对残差范数\n$$\n\\mathrm{RelRes}=\\frac{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} r_{i,j}^2\\right)^{1/2}}{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} f_{i,j}^2\\right)^{1/2}}.\n$$\n当 $\\mathrm{RelRes}\\le \\varepsilon$（容差 $\\varepsilon=10^{-6}$）时，或者当达到 $N_{\\max}=100000$ 次完整扫描的硬上限时，以先到者为准，终止迭代。对于每种情况，我们关注的量是达到容差所需的完整 RBGS 扫描次数。\n\n测试套件：对于以下每一对参数 $(N_x,N_y)$，运行上述实验并记录所需的扫描次数（作为整数）：\n- 情况 1：$(N_x,N_y)=(32,32)$。\n- 情况 2：$(N_x,N_y)=(48,12)$。\n- 情况 3：$(N_x,N_y)=(12,48)$。\n- 情况 4：$(N_x,N_y)=(8,8)$。\n- 情况 5：$(N_x,N_y)=(64,16)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表顺序与上述情况相同，例如 $\\texttt{[r_1,r_2,r_3,r_4,r_5]}$，其中每个 $r_k$ 是情况 $k$ 所需的 RBGS 扫描整数次数。", "solution": "所提出的问题是计算工程领域一个适定的数值实验，要求实现一个二维泊松方程的迭代求解器。该问题在科学上是合理的、自洽的，并且所有数据和约束条件都已明确指定。既定目标是量化网格单元纵横比对红黑高斯-赛德尔方法收敛速率的影响。我们将继续推导和实现所需的算法。\n\n控制偏微分方程是在单位正方形域 $\\Omega = [0,1]\\times[0,1]$ 上的泊松方程，具有齐次狄利克雷边界条件：\n$$\n\\nabla^2 p = \\frac{\\partial^2 p}{\\partial x^2} + \\frac{\\partial^2 p}{\\partial y^2} = f(x,y), \\quad \\text{for } (x,y) \\in \\Omega\n$$\n$$\np(x,y) = 0, \\quad \\text{for } (x,y) \\in \\partial\\Omega\n$$\n我们使用有限差分法在均匀笛卡尔网格上对该问题进行离散化。压力未知数 $p_{i,j}$ 位于单元中心 $(x_i, y_j) = (i\\Delta x, j\\Delta y)$，其中内部索引 $i \\in \\{1, \\dots, N_x\\}$ 和 $j \\in \\{1, \\dots, N_y\\}$。网格间距为 $\\Delta x = \\frac{1}{N_x+1}$ 和 $\\Delta y = \\frac{1}{N_y+1}$。对二阶导数使用二阶中心差分格式，我们得到每个内部节点 $(i,j)$ 的离散泊松方程：\n$$\n\\frac{p_{i+1,j}-2 p_{i,j}+p_{i-1,j}}{(\\Delta x)^2}+\\frac{p_{i,j+1}-2 p_{i,j}+p_{i,j-1}}{(\\Delta y)^2}=f_{i,j}\n$$\n其中 $f_{i,j}$ 是源项 $f(x,y)=-2\\pi^2\\sin(\\pi x)\\sin(\\pi y)$ 在 $(x_i, y_j)$ 处的值。齐次边界条件意味着如果 $i=0$、$i=N_x+1$、$j=0$ 或 $j=N_y+1$，则 $p_{i,j}=0$。\n\n为了迭代求解这个系统，我们首先重新整理方程以分离出 $p_{i,j}$。这为点迭代法提供了更新规则。\n$$\np_{i,j} \\left( \\frac{2}{(\\Delta x)^2} + \\frac{2}{(\\Delta y)^2} \\right) = \\frac{p_{i+1,j} + p_{i-1,j}}{(\\Delta x)^2} + \\frac{p_{i,j+1} + p_{i,j-1}}{(\\Delta y)^2} - f_{i,j}\n$$\n设 $\\alpha_x = 1/(\\Delta x)^2$ 和 $\\alpha_y = 1/(\\Delta y)^2$，更新规则变为：\n$$\np_{i,j} = \\frac{ \\alpha_x (p_{i+1,j} + p_{i-1,j}) + \\alpha_y (p_{i,j+1} + p_{i,j-1}) - f_{i,j} }{ 2(\\alpha_x + \\alpha_y) }\n$$\n红黑高斯-赛德尔 (RBGS) 方法通过将网格点划分为“红”和“黑”两组来加速收敛，类似于棋盘格。如果节点 $(i,j)$ 的索引之和 $i+j$ 为偶数，则指定为红点；如果为奇数，则指定为黑点。关键的观察是，任何红点的更新只依赖于其四个邻居，而这些邻居都是黑点。同样，任何黑点的更新只依赖于其红点邻居。\n\n一次完整的 RBGS 扫描分两个阶段进行：\n$1$. **红点更新**：所有红点同时更新。红点 $p_{i,j}$ 的新值是使用其黑点邻居在上一迭代（比如说第 $k$ 次迭代）中的值计算的。\n$$\np_{i,j}^{(k+1/2)} = \\frac{ \\alpha_x (p_{i+1,j}^{(k)} + p_{i-1,j}^{(k)}) + \\alpha_y (p_{i,j+1}^{(k)} + p_{i,j-1}^{(k)}) - f_{i,j} }{ 2(\\alpha_x + \\alpha_y) }, \\quad \\text{for all red } (i,j)\n$$\n$2$. **黑点更新**：所有黑点同时更新。黑点 $p_{i,j}$ 的新值是使用其红点邻居在当前扫描（$k+1/2$）中新更新的值计算的。\n$$\np_{i,j}^{(k+1)} = \\frac{ \\alpha_x (p_{i+1,j}^{(k+1/2)} + p_{i-1,j}^{(k+1/2)}) + \\alpha_y (p_{i,j+1}^{(k+1/2)} + p_{i,j-1}^{(k+1/2)}) - f_{i,j} }{ 2(\\alpha_x + \\alpha_y) }, \\quad \\text{for all black } (i,j)\n$$\n这两个阶段的结果是第 $k+1$ 次扫描结束时的压力场，记为 $p^{(k+1)}$。\n\n在每次完整扫描后，我们必须检查收敛性。这是通过为所有内部节点计算离散残差场 $r_{i,j}$ 来完成的：\n$$\nr_{i,j} = \\alpha_x(p_{i+1,j}-2 p_{i,j}+p_{i-1,j}) + \\alpha_y(p_{i,j+1}-2 p_{i,j}+p_{i,j-1}) - f_{i,j}\n$$\n收敛性通过相对残差范数来评估，该范数定义为残差的离散 $L_2$-范数与源项的离散 $L_2$-范数之比：\n$$\n\\mathrm{RelRes}=\\frac{\\|r\\|_2}{\\|f\\|_2} = \\frac{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} r_{i,j}^2\\right)^{1/2}}{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} f_{i,j}^2\\right)^{1/2}}\n$$\n当 $\\mathrm{RelRes} \\le \\varepsilon = 10^{-6}$ 或扫描次数达到最大限制 $N_{\\max}=100000$ 时，迭代过程终止。记录的结果是执行的完整扫描次数。\n\n对于每对 $(N_x, N_y)$，数值实验的步骤如下：\n$1$. 为压力 $p$ 设置一个 $(N_y+2) \\times (N_x+2)$ 的网格数组，并初始化为零。这考虑了齐次狄利克雷边界条件，这些边界值保持为零。\n$2$. 计算网格间距 $\\Delta x$ 和 $\\Delta y$，以及系数 $\\alpha_x$、$\\alpha_y$。\n$3$. 为内部节点 $i \\in \\{1, \\dots, N_x\\}$, $j \\in \\{1, \\dots, N_y\\}$ 构建源项数组 $f_{i,j}$。计算并存储其 $L_2$ 范数 $\\|f\\|_2$。\n$4$. 根据 $i+j$ 的奇偶性创建布尔掩码，以识别红、黑内部节点。\n$5$. 开始主迭代循环，将扫描计数器初始化为零。\n$6$. 在每次循环中：\n    a. 增加扫描计数器。\n    b. 使用压力数组上的矢量化操作对所有红色内部节点执行红点更新。\n    c. 使用新更新的红点值对所有黑色内部节点执行黑点更新。\n    d. 在内部网格上计算残差场 $r$。\n    e. 计算相对残差范数 $\\mathrm{RelRes}$。\n    f. 如果 $\\mathrm{RelRes} \\le 10^{-6}$，则跳出循环。\n$7$. 返回最终的扫描次数。对问题陈述中指定的每个测试用例重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_rbgs_solver(Nx, Ny):\n    \"\"\"\n    Solves the 2D Poisson equation using Red-Black Gauss-Seidel iteration.\n\n    Args:\n        Nx (int): Number of interior pressure unknowns along x-direction.\n        Ny (int): Number of interior pressure unknowns along y-direction.\n\n    Returns:\n        int: The number of sweeps required to meet the convergence criteria.\n    \"\"\"\n    # Problem parameters\n    epsilon = 1e-6\n    N_max = 100000\n\n    # Grid setup\n    dx = 1.0 / (Nx + 1)\n    dy = 1.0 / (Ny + 1)\n    ax = 1.0 / (dx**2)\n    ay = 1.0 / (dy**2)\n    inv_denom = 1.0 / (2.0 * (ax + ay))\n\n    # Pressure field with boundary layers, initialized to zero\n    # This automatically enforces p=0 boundary conditions.\n    p = np.zeros((Ny + 2, Nx + 2))\n\n    # Source term f\n    # Create coordinate arrays for the full grid (including boundaries)\n    x = np.linspace(0, 1, Nx + 2)\n    y = np.linspace(0, 1, Ny + 2)\n    # The meshgrid is created for the full (Ny+2)x(Nx+2) domain\n    xx, yy = np.meshgrid(x, y) \n\n    f_full = -2.0 * (np.pi**2) * np.sin(np.pi * xx) * np.sin(np.pi * yy)\n    f_interior = f_full[1:-1, 1:-1]\n    norm_f = np.linalg.norm(f_interior)\n    \n    # Pre-compute Red-Black masks for interior points\n    # Index grid for interior points (1 to N, for formula i+j)\n    J, I = np.meshgrid(np.arange(1, Ny + 1), np.arange(1, Nx + 1), indexing='ij')\n    # red_mask: where i+j is even\n    red_mask = (I + J) % 2 == 0\n    # black_mask: where i+j is odd\n    black_mask = ~red_mask\n\n    sweeps = 0\n    for k in range(N_max):\n        sweeps += 1\n\n        # --- Red Update ---\n        # The update for red points depends on their black neighbors.\n        # We can calculate the update for all interior points based on the current\n        # state of p, and then apply it only to the red points.\n        neighbors_sum = (ax * (p[1:-1, 2:] + p[1:-1, :-2]) +\n                         ay * (p[2:, 1:-1] + p[:-2, 1:-1]))\n        p_new_interior = (neighbors_sum - f_interior) * inv_denom\n        p[1:-1, 1:-1][red_mask] = p_new_interior[red_mask]\n\n        # --- Black Update ---\n        # The update for black points depends on their red neighbors, which\n        # have just been updated. Recalculate and apply.\n        neighbors_sum = (ax * (p[1:-1, 2:] + p[1:-1, :-2]) +\n                         ay * (p[2:, 1:-1] + p[:-2, 1:-1]))\n        p_new_interior = (neighbors_sum - f_interior) * inv_denom\n        p[1:-1, 1:-1][black_mask] = p_new_interior[black_mask]\n\n        # --- Convergence Check after a full sweep ---\n        # Calculate the discrete Laplacian of the updated pressure field p\n        laplacian_p = (ax * (p[1:-1, 2:] + p[1:-1, :-2] - 2.0 * p[1:-1, 1:-1]) +\n                       ay * (p[2:, 1:-1] + p[:-2, 1:-1] - 2.0 * p[1:-1, 1:-1]))\n        \n        # Calculate the residual field r = A*p - f\n        r = laplacian_p - f_interior\n        \n        # Calculate the relative residual norm\n        rel_res = np.linalg.norm(r) / norm_f\n        \n        if rel_res = epsilon:\n            break\n            \n    return sweeps\n\ndef solve():\n    \"\"\"\n    Main function to run the experiment for the given test suite.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (32, 32), # Case 1\n        (48, 12), # Case 2\n        (12, 48), # Case 3\n        (8, 8),   # Case 4\n        (64, 16), # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny = case\n        result = run_rbgs_solver(Nx, Ny)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2438296"}]}