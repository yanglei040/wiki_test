{"hands_on_practices": [{"introduction": "本练习是理解电路深度的绝佳起点。我们将为一个基本但至关重要的布尔函数——n输入与（AND）——设计一个电路，并探索在扇入（fan-in）受限的情况下，所能达到的最小深度。这个练习将揭示电路深度与输入数量之间的对数关系，并引入平衡树这一实现最优深度的关键结构[@problem_id:1415173]。", "problem": "在计算复杂性理论的研究中，布尔电路是数字逻辑电路的一种形式化模型。它表示为一个有向无环图，其中的节点要么是没有入边的输入节点，要么是门节点。电路的深度是从任何输入节点到单个输出节点的最长路径的长度。\n\n考虑一个布尔函数族 $\\{A_n\\}_{n \\ge 2}$，其中每个函数 $A_n: \\{0,1\\}^n \\to \\{0,1\\}$ 接受 $n$ 个二进制输入，记为 $x_1, x_2, \\ldots, x_n$。当且仅当其所有输入都为1时，函数 $A_n$ 的值为1；否则，其值为0。\n\n我们希望构造一个电路族 $\\{C_n\\}_{n \\ge 2}$ 来计算 $\\{A_n\\}$，且仅使用双输入与门。对于这样的电路族，其最小可能深度是 $n$ 的什么函数？请用一个关于 $n$ 的闭式解析表达式来表示你的答案。", "solution": "我们要求计算n元与运算 $A_{n}(x_{1},\\dots,x_{n}) = x_{1} \\wedge \\cdots \\wedge x_{n}$ 的、仅由双输入与门构成的任何电路的最小深度。设深度为 $d$。\n\n下界：在任何门的扇入最多为 $2$ 的电路中，深度为 $k$ 的单个门所能受影响的不同输入的数量最多为 $2^{k}$。这可以通过对 $k$ 进行归纳来证明：当 $k=0$ 时，深度为 $0$ 的输出是一条输入线，因此最多依赖于 $1=2^{0}$ 个输入。如果深度至多为 $k-1$ 的每个信号最多依赖于 $2^{k-1}$ 个输入，那么深度为 $k$ 的门有两个输入，每个输入最多依赖于 $2^{k-1}$ 个输入；因此其输出最多依赖于 $2 \\cdot 2^{k-1} = 2^{k}$ 个输入。因此，深度为 $d$ 的最终输出最多可以依赖于 $2^{d}$ 个输入。由于 $A_{n}$ 依赖于所有 $n$ 个输入，我们必须有\n$$\n2^{d} \\geq n \\quad \\Rightarrow \\quad d \\geq \\log_{2}(n).\n$$\n因为 $d$ 是一个整数深度，这给出了下界\n$$\nd \\geq \\lceil \\log_{2}(n) \\rceil.\n$$\n\n上界：构造一个由双输入与门组成的平衡二叉树。在第 $1$ 层，对 $n$ 个输入中的不相交对进行与运算，产生 $\\lceil n/2 \\rceil$ 个输出；在第 $2$ 层，对这些输出中的不相交对进行与运算，产生 $\\lceil \\lceil n/2 \\rceil / 2 \\rceil$ 个输出，以此类推。经过 $k$ 层后，剩余信号的数量最多为\n$$\n\\left\\lceil \\frac{n}{2^{k}} \\right\\rceil.\n$$\n当这个数量等于 $1$ 时我们停止，即，\n$$\n\\left\\lceil \\frac{n}{2^{k}} \\right\\rceil = 1 \\quad \\Longleftrightarrow \\quad \\frac{n}{2^{k}} \\leq 1 \\quad \\Longleftrightarrow \\quad 2^{k} \\geq n.\n$$\n满足此条件的最小整数 $k$ 是 $k = \\lceil \\log_{2}(n) \\rceil$，这正是平衡结构所能达到的深度。所有的门都是双输入与门，并且导线不增加深度。\n\n结合下界和上界，最小可能深度等于 $\\lceil \\log_{2}(n) \\rceil$。", "answer": "$$\\boxed{\\lceil \\log_{2}(n) \\rceil}$$", "id": "1415173"}, {"introduction": "在掌握了理论基础之后，让我们将其应用于一个更具体的场景：算术逻辑单元（ALU）的设计。本练习要求你将一个简单的2位加法器升级为加减法器，这需要你仔细分析电路的尺寸和深度这两个关键性能指标。通过这个实践，你将学会如何评估设计变更对电路复杂度和关键路径长度（即深度）的影响[@problem_id:1415212]。", "problem": "在一个简化的算术逻辑单元（ALU）的设计中，电路由基本的逻辑门构成。在本题中，我们视2输入与门、2输入或门、2输入异或门和1输入非门为基本构建模块。电路的复杂度由两个指标衡量：其`规模`（size），即基本门的总数；其`深度`（depth），即从任何输入到任何输出的最长顺序门路径。假设每个基本门的规模为1，深度为1。\n\n全加器（FA）是一个核心组件，它将三个输入位（$A, B, C_{in}$）相加，生成一个和位（$S$）和一个进位输出位（$C_{out}$）。我们将使用一个由以下布尔表达式定义的标准高效全加器电路：\n$$S = (A \\oplus B) \\oplus C_{in}$$\n$$C_{out} = (A \\land B) \\lor ((A \\oplus B) \\land C_{in})$$\n注意，项 $(A \\oplus B)$ 可以计算一次并为两个输出共享。\n\n初始时，设计一个2位加法器电路来计算两个2位二进制数 $X = x_1x_0$ 和 $Y = y_1y_0$ 的和。该加法器采用纹波进位架构实现，具体如下：\n1.  第一级将最低有效位 $x_0$ 和 $y_0$ 相加。由于此运算的初始进位固定为0，这一级是一个优化的半加器，计算出 $s_0 = x_0 \\oplus y_0$ 和第一个进位位 $c_1 = x_0 \\land y_0$。\n2.  第二级使用一个如上文定义的完整全加器，将最高有效位 $x_1$ 和 $y_1$ 与来自第一级的进位位 $c_1$ 相加。\n\n这个2位加法器电路的完整输出集包括和位 $s_1$ 和 $s_0$，以及最终的进位输出位 $c_2$。\n\n你的任务是将这个初始的2位加法器升级为一个多功能的2位加法器/减法器。这个新电路将接受一个额外的控制输入 `SUB`。\n-   如果 `SUB` = 0，电路必须计算和 $X+Y$。\n-   如果 `SUB` = 1，电路必须使用二的补码表示法计算差 $X-Y$，其计算方式为 $X + (\\text{NOT } Y) + 1$。\n\n确定将原始加法器转换为这个新的加法器/减法器所需的最小`规模`和`深度`增量。修改后电路的输入是 $x_1, x_0, y_1, y_0, \\text{和 } \\text{SUB}$，其输出仍然是两个结果位和最终的进位输出。你的答案应该是一个有序对（规模增量，深度增量）。", "solution": "我们首先总结原始的2位纹波进位加法器，并根据给定的门模型量化其规模和深度。\n\n原始加法器：\n- 第1级（LSB）：对输入 $x_{0}, y_{0}$ 的半加器：\n  - $s_{0} = x_{0} \\oplus y_{0}$（一个异或门），\n  - $c_{1} = x_{0} \\land y_{0}$（一个与门）。\n  - 规模贡献：$2$ 个门。到 $s_{0}$ 和 $c_{1}$ 的深度：$1$。\n- 第2级（MSB）：对 $(x_{1}, y_{1}, c_{1})$ 使用共享异或门实现的全加器：\n  - 令 $t_{1} = x_{1} \\oplus y_{1}$（一个异或门），\n  - $s_{1} = t_{1} \\oplus c_{1}$（一个异或门），\n  - $a_{1} = x_{1} \\land y_{1}$（一个与门），\n  - $a_{2} = t_{1} \\land c_{1}$（一个与门），\n  - $c_{2} = a_{1} \\lor a_{2}$（一个或门）。\n  - 规模贡献：$5$ 个门。到 $c_{2}$ 的最长路径是从 $x_{0}$（或 $y_{0}$）开始：$x_{0} \\to c_{1}$（与门，深度$1$） $\\to a_{2}$（与门，$+1$） $\\to c_{2}$（或门，$+1$），因此总深度为 $3$。所以，原始规模 $=2+5=7$，原始深度 $=3$。\n\n升级为加法器/减法器：\n我们通过以下方式实现二的补码减法：\n- 对位进行条件化 $y_{i}' = y_{i} \\oplus \\mathrm{SUB}$，其中 $i \\in \\{0,1\\}$，以及\n- 使用初始进位 $c_{0} = \\mathrm{SUB}$。\n这实现了 $X + (Y \\oplus \\mathrm{SUB}) + \\mathrm{SUB}$，当 $\\mathrm{SUB}=0$ 时等于 $X+Y$，当 $\\mathrm{SUB}=1$ 时等于 $X-Y$。\n\n为实现最小规模的门级实现与共享：\n- LSB（最低有效位）：\n  - 和 $s_{0}$ 保持为 $s_{0} = x_{0} \\oplus y_{0}$，与 $\\mathrm{SUB}$ 无关，因此我们重用原始的异或门来计算 $s_{0}$，无需改动。\n  - 进位 $c_{1}$ 必须是 $(x_{0}, y_{0}', \\mathrm{SUB})$ 的全加器进位：\n    $$c_{1} = (x_{0} \\land y_{0}') \\lor \\big((x_{0} \\oplus y_{0}') \\land \\mathrm{SUB}\\big).$$\n    通过以下方式最小化实现：\n    - 计算 $y_{0}' = y_{0} \\oplus \\mathrm{SUB}$（一个异或门），\n    - 重用原始的与门作为 $a_{0} = x_{0} \\land y_{0}'$（将其第二个输入从 $y_{0}$ 改为 $y_{0}'$），\n    - 计算 $t_{0} = x_{0} \\oplus y_{0}'$（一个异或门），\n    - 计算 $a_{2}^{(0)} = t_{0} \\land \\mathrm{SUB}$（一个与门），\n    - 输出 $c_{1} = a_{0} \\lor a_{2}^{(0)}$（一个或门）。\n    LSB处净增加的门：$1$个异或门（$y_{0}'$） $+$ $1$个异或门（$t_{0}$） $+$ $1$个与门（$a_{2}^{(0)}$） $+$ $1$个或门 $=4$个新门。原始的 $s_{0}$ 异或门和原始的与门被重用。\n- MSB（最高有效位）：\n  - 预计算 $y_{1}' = y_{1} \\oplus \\mathrm{SUB}$（一个异或门）。\n  - 将 $(x_{1}, y_{1}', c_{1})$ 送入与之前相同的5门全加器结构中（重用相同的门数；仅重新布线输入）。MSB处净增加的门：$1$个异或门。\n\n因此，最小规模增量为\n$$\\Delta\\text{size} = 4\\ \\text{(LSB)} + 1\\ \\text{(MSB)} = 5.$$\n\n升级后的深度分析：\n- LSB（最低有效位）：\n  - $s_{0}$ 的深度仍为 $1$。\n  - 对于 $c_{1}$，从 $y_{0}$ 出发的最长路径：\n    $y_{0} \\to y_{0}'$（异或门，$1$） $\\to t_{0}$（异或门，$+1$） $\\to a_{2}^{(0)}$（与门，$+1$） $\\to c_{1}$（或门，$+1$），总深度为 $4$。\n- MSB（最高有效位）：\n  - 计算 $y_{1}'$（异或门，深度 $1$），然后计算 $t_{1}' = x_{1} \\oplus y_{1}'$（异或门，从 $y_{1}$ 算起深度为 $2$）。\n  - 和输出 $s_{1} = t_{1}' \\oplus c_{1}$：从 $y_{0}$ 出发的路径深度为 $4$（到 $c_{1}$） $+1$（最终异或门） $=5$；从 $y_{1}$ 出发的路径深度为 $2+1=3$。因此 $s_{1}$ 的深度为 $5$。\n  - 进位 $c_{2} = (x_{1} \\land y_{1}') \\lor \\big(t_{1}' \\land c_{1}\\big)$。最长路径从 $y_{0}$ 开始：\n    $y_{0} \\to c_{1}$（深度 $4$） $\\to$ 与 $t_{1}'$ 进行与运算（深度 $+1$） $\\to$ 最终的或运算（深度 $+1$），总计 $6$。\n因此，升级后的电路深度为 $6$。原始深度为 $3$，所以\n$$\\Delta\\text{depth} = 6 - 3 = 3.$$\n\n最小性论证：\n- 规模：将LSB从半加器（2个门）转换为接受可变进位的电路，必然需要相对于其双输入操作数的全加器功能（5个门）。由于需要用 $\\mathrm{SUB}$ 对 $y_{0}$ 进行条件化，一个用于 $y_{0}'$ 的额外异或门是不可避免的，这导致在LSB处至少增加 $+4$ 个门。在MSB处，用 $\\mathrm{SUB}$ 对 $y_{1}$ 进行条件化需要一个异或门，增加 $+1$。在不违反允许的门类型或失去每个全加器内 $A \\oplus B$ 项共享的情况下，不可能进一步减少。\n- 深度：任何正确的 $c_{1}$ 都必须依赖于 $y_{0}$ 和 $\\mathrm{SUB}$，这需要至少一个门来混合 $y_{0}$ 和 $\\mathrm{SUB}$（例如异或门），并至少再有一个门与 $x_{0}$ 和/或 $\\mathrm{SUB}$ 组合以产生正确的全加器进位。这迫使 $y_{0}\\!\\to\\!c_{1}$ 路径的深度至少为 $3$ 或 $4$，具体取决于结构；在只有2输入或门的情况下，最优结构从 $y_{0}$ 到 $c_{1}$ 的深度为 $4$。然后，MSB级必然增加一个异或门来形成 $s_{1}$，并增加两个门（先与后或）来形成 $c_{2}$，使得最长的输入到输出路径达到深度 $6$。因此，在给定的门约束下，增加 $3$ 级深度是不可避免的。\n\n因此，最小增量为\n- 规模增量：$5$，\n- 深度增量：$3$。", "answer": "$$\\boxed{(5, 3)}$$", "id": "1415212"}, {"introduction": "现在，让我们探索一种更为强大的计算模型：使用无界扇入（unbounded fan-in）逻辑门的电路。这种模型允许逻辑门接收任意数量的输入，从而能够以惊人的效率解决某些问题。本练习将挑战你为一个“恰好一个”（exactly one）检测函数设计一个恒定深度电路，这在有界扇入模型中通常是无法实现的，从而突显不同计算模型之间的权衡与能力差异[@problem_id:1415168]。", "problem": "在设计用于多核处理器的专用仲裁器时，一个关键子组件必须检查是否存在唯一的授权请求。该系统有 $n$ 条并行请求线，由布尔输入变量 $x_1, x_2, \\dots, x_n$ 表示。该仲裁器电路必须输出一个信号，该信号为1当且仅当输入线中恰好有一个为1，否则为0。\n\n你需要确定使用一种特定的逻辑电路模型来实现此功能所需的最小计算深度。可用的组件是单输入非门（NOT gates），以及无限制扇入的与门（AND gates）和或门（OR gates）（意味着它们可以接受任意数量的输入）。\n\n电路的深度根据“层”来定义：\n- 输入变量 $x_1, \\dots, x_n$ 被认为在第0层。\n- 如果一个门的所有输入都连接到来自层 $j  k$ 的门的输出，并且至少有一个输入连接到来自第 $k-1$ 层的门的输出，则该门位于第 $k$ 层（对于 $k \\ge 1$）。\n- 整个电路的深度是最终输出门的层号。\n\n假设 $n \\ge 2$，正确实现“恰好一个”功能的电路的最小可能恒定深度是多少？\n\nA. 1\n\nB. 2\n\nC. 3\n\nD. 4\n\nE. 深度不是恒定的，必须依赖于 $n$。", "solution": "设函数为 $\\operatorname{EXACT1}(x_{1},\\dots,x_{n})$，它等于 $1$ 当且仅当 $x_{1},\\dots,x_{n}$ 中恰好有一个为 $1$，即 $\\sum_{i=1}^{n} x_{i}=1$。\n\n上界（深度 $\\le 3$）：使用非门、无限制扇入的与门和或门构建一个深度为 $3$ 的电路，如下所示。\n- 第 $1$ 层：对于每个 $i \\in \\{1,\\dots,n\\}$，使用一个非门计算 $\\bar{x}_{i}$。\n- 第 $2$ 层：对于每个 $i$，计算\n$$\ng_{i} \\;=\\; x_{i} \\land \\bigwedge_{j \\ne i} \\bar{x}_{j}.\n$$\n每个这样的与门从第 $0$ 层和第 $1$ 层获取输入，因此根据给定规则它位于第 $2$ 层。\n- 第 $3$ 层：输出\n$$\ny \\;=\\; \\bigvee_{i=1}^{n} g_{i}.\n$$\n这个或门从第 $2$ 层获取输入；因此它位于第 $3$ 层。\n\n正确性：对于任何输入，$g_{i}=1$ 当且仅当 $x_{i}=1$ 且所有 $j \\ne i$ 的 $x_{j}=0$。因此，$y=1$ 当且仅当恰好一个输入为 $1$。所以 $\\operatorname{EXACT1}$ 可用深度为 $3$ 的电路计算。\n\n下界（深度 $ 3$ 是不可能的）：\n\n1) 深度为 $1$ 是不可能的。第 $1$ 层的一个单门只能是以下之一：\n- 单个输入 $x_{i}$ 的非门，它在所有 $x_{i}=0$ 的赋值上为 $1$，因此不等于 $\\operatorname{EXACT1}$。\n- 输入的某个非空子集的或门，它在任何至少有一个 $1$ 的赋值上都为 $1$，而不仅仅是恰好一个。\n- 输入的某个非空子集的与门，它仅当该子集中的所有输入都为 $1$ 时才为 $1$，在恰好一个为 $1$ 的赋值上绝不为 $1$，除非该子集是单元素集，在这种情况下，它会接受该单个变量为 $1$ 的所有赋值，包括那些有多个 $1$ 的赋值。\n没有任何一种等于 $\\operatorname{EXACT1}$。\n\n2) 深度为 $2$ 是不可能的。考虑第 $2$ 层的输出门，并分析两种可能性。\n\n情况A：输出门是或门。这个或门的每个输入都必须是第 $1$ 层门的输出。第 $1$ 层门只能是以下之一：\n- $\\bar{x}_{i}$（单个变量的非），\n- $\\bigvee_{i \\in S} x_{i}$，对于某个非空集 $S \\subseteq \\{1,\\dots,n\\}$，\n- $\\bigwedge_{i \\in T} x_{i}$，对于某个非空集 $T \\subseteq \\{1,\\dots,n\\}$。\n为了避免在至少有两个 $1$ 的赋值上出现假阳性，每个这样的叶门在所有多个 $1$ 的赋值上都必须为 $0$。这是不可能的：\n- 对于 $\\bar{x}_{i}$，选择任何一个 $x_{i}=0$ 的多 $1$ 赋值；那么 $\\bar{x}_{i}=1$。\n- 对于 $S \\ne \\varnothing$ 的 $\\bigvee_{i \\in S} x_{i}$，选择一个在 $S$ 中有 $1$ 的多 $1$ 赋值；那么这个或门叶节点就是 $1$。\n- 对于 $|T| \\ge 2$ 的 $\\bigwedge_{i \\in T} x_{i}$，恰好在 $T$ 上为 $1$ 的赋值会使该叶节点为 $1$。对于 $|T|=1$，比如说 $T=\\{k\\}$，任何 $x_{k}=1$ 的多 $1$ 赋值也会使该叶节点为 $1$。\n因此，任何这样的叶门都会在某个多 $1$ 赋值上输出 $1$，顶层的或门也会在那里输出 $1$，这与正确性相矛盾。\n\n情况B：输出门是与门。为了使输出在每个独热赋值上都为 $1$，第 $1$ 层的每个输入叶门在所有独热赋值上都必须为 $1$。这就要求：\n- 没有叶门可以是 $\\bar{x}_{i}$，因为它在 $x_{i}=1$ 的独热赋值上为 $0$。\n- 没有叶门可以是 $T \\ne \\varnothing$ 的 $\\bigwedge_{i \\in T} x_{i}$，因为任何独热赋值最多只有一个 $1$，除非 $T$ 是一个单元素集 $\\{k\\}$ 且其独热索引等于 $k$，否则就会失败。但为了在所有独热赋值上都为 $1$，即使是单元素集也是不允许的。\n- 一个叶门 $\\bigvee_{i \\in S} x_{i}$ 在独热索引为 $k$ 的独热赋值上为 $1$ 当且仅当 $k \\in S$。为了对所有独热赋值都为 $1$，$S$ 必须等于 $\\{1,\\dots,n\\}$，即全局或。任何此类或门叶节点的合取在任何至少有一个 $1$ 的赋值（包括有两个或更多 $1$ 的情况）上仍然是 $1$，所以顶层的与门无法拒绝多 $1$ 赋值。\n因此，深度为 $2$ 是不可能的。\n\n结合上界和下界，对于所有 $n \\ge 2$，最小可能的恒定深度是 $3$。因此，正确选项是 C。", "answer": "$$\\boxed{C}$$", "id": "1415168"}]}