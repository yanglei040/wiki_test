{"hands_on_practices": [{"introduction": "入侵检测的一项基本技术是建立系统正常行为的基线，然后标记出显著的偏差。本练习 ([@problem_id:3650732]) 将此概念应用于操作系统资源监控，这是一个常见的异常检测场景。通过分析由 cgroups 收集的 CPU 和 I/O 使用数据，你将学习如何使用均值和标准差等基本统计指标来量化“异常”，并调整检测器的灵敏度以控制误报率。", "problem": "一个操作系统团队使用 Linux 控制组 (cgroups) 来监控单个面向网络服务的资源使用情况。在 $\\Delta = 5\\,\\text{s}$ 的固定采样间隔下，系统会为该服务记录两个单样本指标：中央处理器 (CPU) 利用率和单位为 $\\text{MB}/\\text{s}$ 的输入/输出 (I/O) 吞吐量。系统会维持一个长度为 $W$ 的近期样本滑动窗口（$W$ 足够大以便进行稳定估计），用以计算每个指标的经验均值 $\\hat{\\mu}$ 和经验标准差 $\\hat{\\sigma}$。在每个采样时间 $t$，系统会计算 CPU 和 I/O 的标准化分数（即所谓的 $z$-分数），公式为 $z_{\\text{cpu},t} = (x_{\\text{cpu},t} - \\hat{\\mu}_{\\text{cpu}})/\\hat{\\sigma}_{\\text{cpu}}$ 和 $z_{\\text{io},t} = (x_{\\text{io},t} - \\hat{\\mu}_{\\text{io}})/\\hat{\\sigma}_{\\text{io}}$。异常策略规定，如果任一指标表现出超过 $3$ 个标准差的持续偏差，系统就会发出警报，这意味着对于至少 $K$ 个连续样本，在这 $K$ 个样本中的每一个，都有 $|z_{\\text{cpu},t}| > 3$ 或 $|z_{\\text{io},t}| > 3$ 成立。\n\n假设在良性（非攻击）操作下满足以下条件：\n- 由于窗口大小 $W$ 足够大，每个指标的标准化分数随时间推移是独立同分布的，并且可以很好地用标准正态分布 $\\mathcal{N}(0,1)$ 来建模。\n- 在给定的采样时间，CPU 和 I/O 的标准化分数相互独立。\n- 对于罕见事件，可以忽略连续运行之间的重叠效应，因此，在任何给定样本处开始出现连续 $K$ 次阈值超出的运行概率，可以很好地近似为单样本超出概率的 $K$ 次方。\n\n仅使用这些假设，设计持续偏差长度 $K$，使得在 $30$ 天的良性监控期内，误报的期望数量最多为 $0.5$。请将你的最终答案表示为达到此目标的最小整数 $K$。你的答案必须是单个整数（无单位）。", "solution": "用户希望我为一个异常检测系统确定持续偏差长度 $K$ 的最小整数值。设计约束是在 $30$ 天的监控期内，误报的期望数量不得超过 $0.5$。\n\n### 步骤 1：问题验证\n我将首先验证问题陈述。\n\n**从问题陈述中提取的已知条件：**\n-   采样间隔：$\\Delta = 5\\,\\text{s}$。\n-   指标：CPU 利用率和 I/O 吞吐量。\n-   在每个采样时间 $t$ 计算标准化分数（z-分数）：$z_{\\text{cpu},t}$ 和 $z_{\\text{io},t}$。\n-   警报条件：持续偏差至少 $K$ 个连续样本，其中序列中的每个样本都满足 $|z_{\\text{cpu},t}| > 3$ 或 $|z_{\\text{io},t}| > 3$。\n-   良性（非攻击）操作的假设：\n    1.  每个指标的标准化分数 $z_{\\text{cpu},t}$ 和 $z_{\\text{io},t}$ 随时间独立同分布 (i.i.d.)。\n    2.  两者都可以很好地用标准正态分布 $\\mathcal{N}(0,1)$ 建模。\n    3.  在任何给定的时间 $t$，$z_{\\text{cpu},t}$ 和 $z_{\\text{io},t}$ 相互独立。\n    4.  从一个样本开始的连续 $K$ 次超限运行的概率近似于单样本超限概率的 $K$ 次方。\n-   目标约束：在 $30$ 天的良性监控期内，误报的期望数量最多为 $0.5$。\n-   目标：找到满足此约束的最小整数 $K$。\n\n**根据标准进行验证：**\n1.  **科学或事实上的不健全性**：该问题基于标准的统计建模（正态分布、z-分数、独立事件概率），并将其应用于一个现实的计算机科学问题（用于异常检测的资源监控）。诸如数据服从正态分布和事件独立同分布等假设，是此类模型中常见且明确说明的简化假设。没有违反科学原理。\n2.  **无法形式化或不相关**：该问题在数学上定义明确，并且与操作系统主题相关，特别是在性能监控和入侵检测的背景下，这些是该领域的高级课题。\n3.  **不完整或矛盾的设置**：该问题提供了得出唯一解所需的所有数据和约束。假设是内部一致的。\n4.  **不切实际或不可行**：该场景是一个真实世界系统的简化但合理的模型。所有数值都在现实范围内。\n5.  **不适定或结构不良**：该问题是适定的。存在一个唯一的、稳定的、有意义的整数解 $K$。\n6.  **伪深刻、琐碎或同义反复**：该问题需要进行涉及概率论和对数的多步定量分析。它并非微不足道。\n7.  **超出科学可验证性**：该问题是一个基于给定模型的数学练习，可以根据数学和概率的规则来解决和验证。\n\n**结论：** 问题是 **有效的**。我将继续进行求解。\n\n### 步骤 2：求解推导\n目标是找到最小的整数 $K$，以确保在 $30$ 天的周期内误报的期望数量不超过 $0.5$。\n\n首先，我们计算监控期内的总样本数 $N$。\n监控期为 $T = 30$ 天。采样间隔为 $\\Delta = 5 \\text{ s}$。\n我们将周期 $T$ 转换为秒：\n$$ T = 30 \\text{ 天} \\times 24 \\frac{\\text{小时}}{\\text{天}} \\times 60 \\frac{\\text{分钟}}{\\text{小时}} \\times 60 \\frac{\\text{秒}}{\\text{分钟}} = 2,592,000 \\text{ s} $$\n总样本数为：\n$$ N = \\frac{T}{\\Delta} = \\frac{2,592,000 \\text{ s}}{5 \\text{ s}} = 518,400 $$\n\n接下来，我们确定单个样本被标记为异常的概率。设这个概率为 $p$。如果在单个采样时间 $t$ 出现 $|z_{\\text{cpu},t}| > 3$ 或 $|z_{\\text{io},t}| > 3$ 的情况，就会触发警报。\n设 $A_{\\text{cpu}}$ 为事件 $|z_{\\text{cpu},t}| > 3$，$A_{\\text{io}}$ 为事件 $|z_{\\text{io},t}| > 3$。单样本异常事件为 $A = A_{\\text{cpu}} \\cup A_{\\text{io}}$。\n概率 $p$ 由容斥原理给出：\n$$ p = P(A_{\\text{cpu}} \\cup A_{\\text{io}}) = P(A_{\\text{cpu}}) + P(A_{\\text{io}}) - P(A_{\\text{cpu}} \\cap A_{\\text{io}}) $$\n根据问题的假设，$z_{\\text{cpu},t}$ 和 $z_{\\text{io},t}$ 是独立的。因此，事件 $A_{\\text{cpu}}$ 和 $A_{\\text{io}}$ 是独立的，这意味着 $P(A_{\\text{cpu}} \\cap A_{\\text{io}}) = P(A_{\\text{cpu}}) P(A_{\\text{io}})$。\n\n设 $p_{\\text{metric}}$ 为单个指标的标准化分数超过阈值 $3$ 的概率。由于两个分数都由标准正态分布 $Z \\sim \\mathcal{N}(0,1)$ 建模，我们有：\n$$ p_{\\text{metric}} = P(|Z| > 3) $$\n这个概率可以从标准正态分布的累积分布函数 (CDF) $\\Phi(z)$ 计算得出。\n$$ p_{\\text{metric}} = P(Z > 3) + P(Z  -3) $$\n根据正态分布的对称性，$P(Z  -3) = P(Z  3) = 1 - \\Phi(3)$。\n$$ p_{\\text{metric}} = 2(1 - \\Phi(3)) $$\n使用著名的正态分布“68-95-99.7 法则”，一个值落在均值 $3$ 个标准差范围内的概率约为 $0.9973$。因此，落在此范围之外的概率是：\n$$ p_{\\text{metric}} \\approx 1 - 0.9973 = 0.0027 $$\n使用这个值，我们得到 $P(A_{\\text{cpu}}) = P(A_{\\text{io}}) = p_{\\text{metric}} \\approx 0.0027$。\n现在我们可以计算 $p$：\n$$ p = 2p_{\\text{metric}} - p_{\\text{metric}}^2 \\approx 2(0.0027) - (0.0027)^2 = 0.0054 - 0.00000729 = 0.00539271 $$\n\n如果一个样本连续 $K$ 次异常，就会发出警报。根据问题假设，在任何给定样本处开始的长度为 $K$ 的警报序列的概率是 $p^K$。\n整个周期内的误报期望数量 $E[\\text{alerts}]$ 是样本数 $N$ 乘以在任何样本处开始警报序列的概率。我们忽略末端效应（即，我们假设一个长度为 $K$ 的序列有 $N$ 个潜在的开始时间），这对于大的 $N$ 是一个合理的近似。\n$$ E[\\text{alerts}] = N \\times p^K $$\n问题要求这个期望最多为 $0.5$：\n$$ N p^K \\le 0.5 $$\n我们需要求解满足此不等式的最小整数 $K$。\n$$ 518,400 \\times (0.00539271)^K \\le 0.5 $$\n让我们分离出含有 $K$ 的项：\n$$ (0.00539271)^K \\le \\frac{0.5}{518,400} = \\frac{1}{1,036,800} $$\n为了求解 $K$，我们对两边取自然对数。\n$$ \\ln\\left((0.00539271)^K\\right) \\le \\ln\\left(\\frac{1}{1,036,800}\\right) $$\n$$ K \\ln(0.00539271) \\le -\\ln(1,036,800) $$\n因为 $0.00539271  1$，它的自然对数是负数。当我们除以这个负数时，必须反转不等号。\n$$ K \\ge \\frac{-\\ln(1,036,800)}{\\ln(0.00539271)} $$\n现在，我们计算对数值：\n$$ \\ln(1,036,800) \\approx 13.8516 $$\n$$ \\ln(0.00539271) \\approx -5.2233 $$\n将这些值代回关于 $K$ 的不等式中：\n$$ K \\ge \\frac{-13.8516}{-5.2233} \\approx 2.6517 $$\n由于 $K$ 必须是整数，满足此条件的最小整数值 $K$ 是 $3$。\n\n为了验证，我们检查一下 $K=2$ 和 $K=3$ 时的期望警报数。\n对于 $K=2$：\n$$ E[\\text{alerts}] = 518,400 \\times (0.00539271)^2 \\approx 518,400 \\times (2.9081 \\times 10^{-5}) \\approx 15.07 $$\n这个值大于 $0.5$。\n对于 $K=3$：\n$$ E[\\text{alerts}] = 518,400 \\times (0.00539271)^3 \\approx 518,400 \\times (1.5684 \\times 10^{-7}) \\approx 0.0813 $$\n这个值小于 $0.5$。\n因此，满足所需设计约束的最小整数 $K$ 是 $3$。", "answer": "$$\\boxed{3}$$", "id": "3650732"}, {"introduction": "虽然统计方法很强大，但高级的攻击往往隐藏在看似正常的活动中，因此有效的检测需要结合超越简单指标的丰富上下文信息。这个基于策略设计的练习 ([@problem_id:3650735]) 探讨了如何区分恶意行为与合法的管理任务，例如系统初始化脚本。你将学习利用从系统调用事件中获得的上下文数据（如 TTY 状态、cgroup 路径和 systemd 单元信息）来构建一个精确的检测规则，从而在不产生大量误报的情况下识别出威胁。", "problem": "一个操作系统监控代理检测系统调用 (syscall) $execve$ 并发出结构化事件。每个事件被建模为一个元组 $E = \\langle \\text{pid}, \\text{ppid}, \\text{name}, \\text{argv}, \\text{env}, \\text{tty}, \\text{cgroup}, \\text{path}, \\text{unit}, t \\rangle$，其中 $t$ 是事件时间，$\\text{name}$ 是所执行程序的基本名称，$\\text{tty}$ 表示控制终端（如果没有则为 $\\emptyset$），$\\text{cgroup}$ 是控制组路径，而 $\\text{unit}$ 是已知的关联服务单元名称。您的目标是构建一个运行时策略，当一个非交互式服务通过 $execve$ 意外执行解释器时（例如，启动 $bash$ 或 $python$），该策略会发出警报，同时最大限度地减少来自合法初始化脚本的误报。\n\n从以下根植于操作系统和检测理论的核心定义和事实开始：\n\n- 一个没有控制终端的进程是非交互式的，当且仅当 $\\text{tty} = \\emptyset$。\n- 在使用系统和服务管理器单元的系统中，长期运行的服务通常位于匹配特定模式的控制组下，例如 $\\text{cgroup} \\in \\mathcal{C}$，其中 $\\mathcal{C}$ 包括像 $\\text{system.slice}$ 这样的条目和单元范围的子路径；一次性初始化任务（init 脚本）与类型为 oneshot 的单元或标记为 pre/post 的阶段相关联（例如，$\\text{ExecStartPre}$、$\\text{ExecStartPost}$）。\n- 系统调用 $execve$ 会替换当前的进程映像；当解释器以服务的权限运行时，调用解释器会增加攻击面，尤其是在系统引导后。\n- 解释器构成一个集合 $\\mathcal{I}$，例如 $\\mathcal{I} = \\{\\text{bash}, \\text{sh}, \\text{zsh}, \\text{python}, \\text{perl}, \\text{ruby}, \\text{node}\\}$。\n- 当针对预期的合法行为发出警报时，就会出现误报。初始化脚本被合法地允许在早期引导和单元的 pre/post 阶段运行解释器。\n- 设 $T_{\\text{boot}}$ 为上次系统引导时间。定义一个 $\\Delta$ 秒的早期引导窗口，选择 $\\Delta$ 以覆盖典型的初始化活动。对于本问题，假设 $\\Delta = 300$。\n\n已知所关注的对抗活动涉及一个长期运行的服务（例如，数据库或 Web 服务器进程），该服务在系统引导很久之后因被利用而通过 $execve$ 执行了解释器，而合法的 init 脚本通常在 $t \\in [T_{\\text{boot}}, T_{\\text{boot}} + \\Delta]$ 时间段内和/或作为 oneshot 或 pre/post 阶段运行。您必须选择一个单一的策略谓词 $D(E)$，当且仅当 $D(E)$ 的计算结果为真时，它才会对事件 $E$ 发出警报。\n\n以下哪个策略在检测非交互式服务意外执行解释器的 $execve$ 方面最为有效，同时能最大限度地减少来自合法 init 脚本的误报？请选择最佳选项。\n\nA. 如果 $\\text{tty} = \\emptyset$，$\\text{cgroup} \\in \\mathcal{C}$ 且 $\\text{name} \\in \\mathcal{I}$，则发出警报。\n\nB. 如果 $\\text{tty} = \\emptyset$，$\\text{cgroup} \\in \\mathcal{C}$ 且 $\\text{name} \\in \\mathcal{I}$，则发出警报，但在 $t - T_{\\text{boot}} \\le \\Delta$ 时，或当 $\\text{unit}$ 类型为 oneshot 或阶段为 pre/post 时抑制警报；此外，当 $\\text{ppid}$ 映射到白名单 $\\mathcal{W}$ 中的已知 init 包装器时（例如，$\\text{/etc/init.d}$ 和 $\\text{/lib/systemd}$ 下的路径），也抑制警报。\n\nC. 仅当 $\\text{tty} = \\emptyset$，$\\text{name} \\in \\mathcal{I}$，并且根据监控代理的观察，进程在 $execve$ 之后的 2 秒内打开了一个传输控制协议 (TCP) 套接字时，才发出警报。\n\nD. 如果在 60 分钟的窗口内，从任何非交互式进程观察到的 $\\text{name} \\in \\mathcal{I}$ 的 $execve$ 事件计数超过 10，则发出警报，无论服务单元、引导时间或阶段如何。\n\n通过选择唯一的最佳选项来回答问题。请使用给定的定义和事实来证明您的推理，仔细考虑如何在不漏掉所述对抗行为的情况下减少来自 init 脚本的误报。除了提供的事件字段和陈述的事实之外，不要假设任何未说明的功能或数据。", "solution": "用户希望我选择最优策略来检测入侵。\n\n### 问题验证\n\n**步骤 1：提取已知信息**\n\n-   事件是一个元组 $E = \\langle \\text{pid}, \\text{ppid}, \\text{name}, \\text{argv}, \\text{env}, \\text{tty}, \\text{cgroup}, \\text{path}, \\text{unit}, t \\rangle$。\n-   $t$ 是事件时间。\n-   $\\text{name}$ 是所执行程序的基本名称。\n-   $\\text{tty}$ 是控制终端，如果没有则为 $\\emptyset$。\n-   $\\text{cgroup}$ 是控制组路径。\n-   $\\text{unit}$ 是相关的服务单元名称。\n-   一个进程是非交互式的，当且仅当 $\\text{tty} = \\emptyset$。\n-   长期运行的服务位于控制组 $\\text{cgroup} \\in \\mathcal{C}$ 下，其中 $\\mathcal{C}$ 包括像 $\\text{system.slice}$ 这样的路径。\n-   初始化脚本与类型为 $\\text{oneshot}$ 的单元或像 $\\text{ExecStartPre}$/$\\text{ExecStartPost}$ 这样的阶段相关联。\n-   关注的系统调用是 $execve$。\n-   解释器集合是 $\\mathcal{I} = \\{\\text{bash}, \\text{sh}, \\text{zsh}, \\text{python}, \\text{perl}, \\text{ruby}, \\text{node}\\}$。\n-   误报是针对合法行为（特别是初始化脚本）发出的警报。\n-   $T_{\\text{boot}}$ 是上次系统引导时间。\n-   $\\Delta$ 是早期引导窗口，给定为 $300$ 秒。\n-   对抗目标：检测一个长期运行的服务，在引导很久之后，通过 $execve$ 执行一个解释器。\n-   要忽略的合法行为：在 $t \\in [T_{\\text{boot}}, T_{\\text{boot}} + \\Delta]$ 期间和/或作为 $\\text{oneshot}$ 或 pre/post 阶段一部分运行解释器的 Init 脚本。\n-   任务：选择最佳策略谓词 $D(E)$ 来发出警报。\n\n**步骤 2：使用提取的已知信息进行验证**\n\n-   **科学依据：** 该问题牢固地植根于操作系统（特别是进程管理、系统调用以及像 cgroups 这样的资源管理特性）和计算机安全（入侵检测、威胁建模和端点监控）的原理。所有概念（$execve$、TTY、cgroups、systemd 单元）都是标准且事实正确的。\n-   **问题定义良好：** 该问题定义良好。它提供了一个明确的目标（检测特定的攻击模式）、一个明确的约束（最小化特定类型的误报）、一个定义好的数据模型（事件元组 $E$）以及一组候选解决方案（策略 A-D）以根据目标和约束进行评估。它要求选择“最佳”选项，这可以通过分析每个策略所做的权衡来确定。\n-   **客观性：** 该问题使用精确的技术语言陈述。关键术语（例如，“非交互式”）都有定义。场景描述没有主观或偏见的措辞。\n\n**步骤 3：结论和行动**\n\n问题陈述是有效的。它在科学上是合理的，定义良好且客观。没有矛盾、歧义或缺失信息会妨碍严谨的分析。我将继续推导解决方案。\n\n### 解决方案推导\n\n核心任务是制定一个检测规则 $D(E)$，以平衡两个相互竞争的目标：最大化检测特定威胁的真阳性率和最小化已知合法系统活动产生的误报率。\n\n威胁被定义为一个非交互式的、长期运行的服务执行一个解释器。这转化为事件 $E$ 的以下条件：\n1.  $\\text{tty} = \\emptyset$ (非交互式)\n2.  $\\text{cgroup} \\in \\mathcal{C}$ (长期运行的服务)\n3.  $\\text{name} \\in \\mathcal{I}$ (解释器执行)\n\n要忽略的合法活动（以最小化误报）主要是由于初始化脚本，其特征如下：\n1.  在早期引导窗口内运行：$t - T_{\\text{boot}} \\le \\Delta$。\n2.  与特定的 systemd 单元类型（$\\text{oneshot}$）或阶段（$\\text{pre/post}$）相关联。\n\n现在，我将评估每个提议的策略谓词。\n\n**选项 A 分析**\n\n策略 A：如果 $\\text{tty} = \\emptyset$，$\\text{cgroup} \\in \\mathcal{C}$ 且 $\\text{name} \\in \\mathcal{I}$，则发出警报。\n\n该策略直接实现了描述可疑活动的三个条件。它正确地识别了当一个看起来像服务（$\\text{cgroup} \\in \\mathcal{C}$）且非交互式（$\\text{tty} = \\emptyset$）的进程执行一个解释器（$\\text{name} \\in \\mathcal{I}$）时的情况。然而，问题陈述明确指出，合法的初始化脚本也在此类条件下运行，尤其是在系统启动期间。例如，一个服务单元可能有一个 $\\text{ExecStartPre}$ 指令，该指令运行一个 shell 脚本来设置权限或配置。该脚本将以 $\\text{tty} = \\emptyset$ 运行，位于服务的 cgroup 内（因此 $\\text{cgroup} \\in \\mathcal{C}$），其名称（例如 $\\text{sh}$）将在 $\\mathcal{I}$ 中。该策略没有机制来区分这种合法活动和攻击，导致高误报率，尤其是在引导时。它未能满足最小化约束。\n\n结论：**不正确**。\n\n**选项 B 分析**\n\n策略 B：如果 $\\text{tty} = \\emptyset$，$\\text{cgroup} \\in \\mathcal{C}$ 且 $\\text{name} \\in \\mathcal{I}$，则发出警报，但在 $t - T_{\\text{boot}} \\le \\Delta$ 时，或当 $\\text{unit}$ 类型为 oneshot 或阶段为 pre/post 时抑制警报；此外，当 $\\text{ppid}$ 映射到白名单 $\\mathcal{W}$ 中的已知 init 包装器时，也抑制警报。\n\n该策略以与策略 A 相同的强大检测核心开始。然后，它添加了一系列抑制条件（例外情况），旨在过滤掉合法行为。让我们分析这些抑制条件：\n-   `在 $t - T_{\\text{boot}} \\le \\Delta$ 时抑制`：这直接解决了早期引导窗口期间的合法执行，使用了给定的参数 $T_{\\text{boot}}$ 和 $\\Delta = 300$。\n-   `当 unit 类型为 oneshot 或阶段为 pre/post 时抑制`：这使用了事件元组中的 $\\text{unit}$ 字段来识别可能在任何时候（不仅是引导时）运行解释器的合法的、短暂的任务或服务设置/拆卸脚本。这是区分攻击与正常操作的关键上下文信息。\n-   `当 ppid 映射到白名单 W 中的已知 init 包装器时抑制`：这增加了另一层复杂性，使用进程父级（$\\text{ppid}$）来识别那些是受信任系统组件（例如 systemd 本身，或 `/etc/init.d` 中的脚本）子进程的执行。\n\n该策略是一个多层过滤器。它检测感兴趣的一般模式，然后有条不紊地排除问题陈述中确定的特定合法行为案例。这种方法直接解决了在保持对目标对抗活动（一个已运行的服务，在引导后很久并且在设置阶段之外，意外执行解释器）高敏感度的同时，最小化来自 init 脚本的误报的要求。它极好地利用了事件元组 $E$ 中的可用字段。\n\n结论：**正确**。\n\n**选项 C 分析**\n\n策略 C：仅当 $\\text{tty} = \\emptyset$，$\\text{name} \\in \\mathcal{I}$，并且进程在 $execve$ 之后的 $2$ 秒内打开一个传输控制协议 (TCP) 套接字时，才发出警报。\n\n该策略有几个缺陷。首先，通过省略 $\\text{cgroup} \\in \\mathcal{C}$ 条件，它失去了对“长期运行的服务”的关注，并且会对任何非交互式解释器执行触发，可能包括不属于此策略目标的合法后台作业（例如，cron 作业）。其次，更关键的是，它使检测依赖于后续的网络活动（打开 TCP 套接字）。获得解释器访问权限的攻击者可能会执行许多不立即涉及打开新 TCP 套接字的恶意操作，例如本地侦察、文件操纵或权限提升。此策略将无法检测到此类攻击，导致高假阴性率。目标是检测未经授权的解释器执行本身，而不仅仅是特定的利用后操作。最后，该策略假设监控代理可以将一个 $execve$ 事件与未来的、不同的系统调用事件（`socket` 或 `connect`）关联起来，而问题陈述并未保证此能力，它只定义了 $execve$ 事件 $E$ 的内容。\n\n结论：**不正确**。\n\n**选项 D 分析**\n\n策略 D：如果在 $60$ 分钟的窗口内，从任何非交互式进程观察到的 $\\text{name} \\in \\mathcal{I}$ 的 $execve$ 事件计数超过 $10$，则发出警报。\n\n该策略使用基于阈值的方法。其主要弱点是无法检测单个、蓄意的入侵。所描述的威胁是一个服务派生一个解释器，这可能只发生一次。一个要求超过 10 个此类事件的策略将完全错过这个单一的、高影响力的事件，导致严重地假阴性。此外，10 的阈值和 60 分钟的窗口是任意的，可能与攻击者行为不符。反之，一个合法但复杂的维护脚本或一系列 cron 作业可以轻松地在一小时内触发超过 10 次解释器执行，导致假阳性。该策略丢弃了事件元组中几乎所有有价值的上下文，例如 $\\text{cgroup}$、$\\text{unit}$ 和相对于引导的精确时间，使其成为解决此特定检测问题的一个非常粗糙且无效的工具。\n\n结论：**不正确**。\n\n**总结**\n\n策略 B 明显优于所有其他选项。它制定了一个精确的规则来检测恶意模式，然后结合了特定的、上下文感知的例外情况，这些例外情况直接对应于问题陈述中描述的合法行为来源。这种分层方法是有效检测策略的标志，成功地平衡了敏感性（真阳性）和特异性（低误报）。", "answer": "$$\\boxed{B}$$", "id": "3650735"}, {"introduction": "任何入侵检测系统（IDS）的响应都不是瞬时的，从恶意事件发生到被检测和修复之间总会存在延迟。本练习 ([@problem_id:3650719]) 要求你量化在这种检测延迟期间产生的安全风险。通过将攻击尝试建模为泊松过程，并将检测时间建模为指数随机变量，你将计算在系统暴露于风险的窗口期内所产生的预期经济损失，这为评估安全措施的有效性提供了量化依据。", "problem": "一个 Linux 操作系统使用挂载标志 (mount flags) 来缓解文件系统边界上的各类攻击。标志 $noexec$、$nodev$ 和 $nosuid$ 分别阻止从挂载点执行二进制文件、在挂载点上创建或使用设备文件、以及在挂载点上遵守 set-user-identifier (SUID) 位。一个入侵检测系统 (IDS) 监控内核的挂载事件；如果攻击者在一个受监控的挂载点上移除了这些标志，IDS 最终会检测到这一行为并恢复挂载配置。假设以下模型，该模型基于概率论和操作系统的核心定义：\n\n- 对于与三个标志相对应的三个攻击向量中的每一个，当挂载点处于受损状态（标志被移除）时，攻击者的尝试以泊松过程的形式到达，其恒定速率为每小时 $\\lambda_i$ 次。\n- 在给定一次尝试的条件下，成功入侵的概率取决于保护性标志是否存在。当标志存在时，成功概率为 $\\alpha_i$。当标志被移除时，成功概率为 $\\beta_i$，其中 $\\beta_i  \\alpha_i$。\n- 在向量 $i$ 上的每一次成功入侵都会产生 $L_i$ 美元的预期金钱损失，且各次尝试和各个向量之间是独立的。\n- 在标志移除事件之后，由于无记忆轮询和独立的警报延迟，IDS 的检测并恢复时间 $T$ 服从参数为每小时 $\\mu$ 的指数分布。\n\n假设三个向量是独立的，攻击尝试的到达与检测是独立的，并且在短暂的检测窗口期内，过程是平稳的。\n\n一次挂载事件同时移除了一个关键挂载点上的所有三个标志，该挂载点一直处于此状态直到 IDS 将其恢复。请量化由于标志被移除而在此窗口期内产生的预期额外金钱损失，并与标志在相同持续时间内保持原位的反事实情况进行比较。使用以下参数：\n\n- 对于与 $noexec$ 相关的向量：$\\lambda_1 = 0.03$ 每小时，$\\alpha_1 = 0.05$，$\\beta_1 = 0.60$，$L_1 = 3000$ 美元。\n- 对于与 $nodev$ 相关的向量：$\\lambda_2 = 0.004$ 每小时，$\\alpha_2 = 0.02$，$\\beta_2 = 0.40$，$L_2 = 12000$ 美元。\n- 对于与 $nosuid$ 相关的向量：$\\lambda_3 = 0.015$ 每小时，$\\alpha_3 = 0.01$，$\\beta_3 = 0.50$，$L_3 = 8000$ 美元。\n- IDS 检测参数：$\\mu = 0.5$ 每小时。\n\n以美元表示最终结果，并将答案四舍五入到 $4$ 位有效数字。", "solution": "问题要求计算在漏洞窗口期内产生的预期额外金钱损失。该窗口期从保护性挂载标志被移除时开始，到入侵检测系统 (IDS) 检测到更改并将其恢复时结束。此窗口的持续时间 $T$ 是一个随机变量，服从速率参数为 $\\mu$ 的指数分布。\n\n设 $\\Delta L_{\\text{total}}$ 为总的额外金钱损失。题目说明存在三个独立的攻击向量，索引为 $i \\in \\{1, 2, 3\\}$。根据期望的线性性质，总的预期额外损失是每个向量的预期额外损失之和：\n$$E[\\Delta L_{\\text{total}}] = \\sum_{i=1}^{3} E[\\Delta L_i]$$\n其中 $E[\\Delta L_i]$ 是攻击向量 $i$ 的预期额外损失。\n\n让我们分析单个攻击向量 $i$。\n攻击尝试的到达被建模为速率为 $\\lambda_i$ 的泊松过程。泊松过程的一个关键性质是，如果事件以一个恒定的概率 $p$被独立地选择，那么所选事件构成的过程也是一个速率为 $\\lambda_i p$ 的泊松过程。这被称为泊松稀疏化 (Poisson thinning)。\n\n在本例中，事件是成功的入侵。\n当保护性标志存在时，成功概率为 $\\alpha_i$。成功入侵的速率为 $\\lambda_i^{\\alpha} = \\lambda_i \\alpha_i$。\n当保护性标志被移除时，成功概率为 $\\beta_i$。成功入侵的速率为 $\\lambda_i^{\\beta} = \\lambda_i \\beta_i$。\n\n损失发生在一个随机时间区间 $[0, T]$ 内，其中 $T$ 的概率密度函数为 $f_T(t) = \\mu \\exp(-\\mu t)$（对于 $t \\ge 0$）。该区间的预期持续时间为 $E[T] = \\frac{1}{\\mu}$。\n\n向量 $i$ 的额外损失 $\\Delta L_i$ 是在同一随机持续时间 $T$ 内，标志被移除时发生的损失与标志存在时本应发生的损失之间的差额。设 $N_i^{\\beta}(t)$ 和 $N_i^{\\alpha}(t)$ 分别为在时间间隔 $t$ 内，标志被移除和标志存在时的成功入侵次数。它们是服从参数为 $\\lambda_i \\beta_i t$ 和 $\\lambda_i \\alpha_i t$ 的泊松分布的随机变量。相关的损失为 $L_i N_i^{\\beta}(T)$ 和 $L_i N_i^{\\alpha}(T)$。\n\n预期的额外损失为：\n$$E[\\Delta L_i] = E[L_i N_i^{\\beta}(T) - L_i N_i^{\\alpha}(T)] = L_i \\left( E[N_i^{\\beta}(T)] - E[N_i^{\\alpha}(T)] \\right)$$\n为了求出 $N(T)$ 的期望，其中 $N(t)$ 是一个速率为 $\\lambda'$ 的泊松过程，而 $T$ 是一个独立的随机变量，我们使用全期望定律（也称为塔性质），$E[X] = E_Y[E[X|Y]]$。\n$$E[N(T)] = E_T[E[N(T)|T=t]]$$\n对于一个固定的持续时间 $t$，速率为 $\\lambda'$ 的泊松过程的预期事件数为 $E[N(t)] = \\lambda' t$。\n$$E[N(T)] = E_T[\\lambda' T] = \\lambda' E[T]$$\n由于 $T$ 服从参数为 $\\mu$ 的指数分布，其期望为 $E[T] = \\frac{1}{\\mu}$。\n因此，在这个随机时间区间内的预期事件数为：\n$$E[N(T)] = \\frac{\\lambda'}{\\mu}$$\n将此结果应用于我们的两种情况：\n$$E[N_i^{\\beta}(T)] = \\frac{\\lambda_i \\beta_i}{\\mu}$$\n$$E[N_i^{\\alpha}(T)] = \\frac{\\lambda_i \\alpha_i}{\\mu}$$\n将这些代入向量 $i$ 的预期额外损失的表达式中：\n$$E[\\Delta L_i] = L_i \\left( \\frac{\\lambda_i \\beta_i}{\\mu} - \\frac{\\lambda_i \\alpha_i}{\\mu} \\right) = \\frac{L_i \\lambda_i (\\beta_i - \\alpha_i)}{\\mu}$$\n总的预期额外损失是所有三个向量的和：\n$$E[\\Delta L_{\\text{total}}] = \\sum_{i=1}^{3} \\frac{L_i \\lambda_i (\\beta_i - \\alpha_i)}{\\mu} = \\frac{1}{\\mu} \\sum_{i=1}^{3} L_i \\lambda_i (\\beta_i - \\alpha_i)$$\n现在，我们代入给定的参数。\nIDS 检测参数为 $\\mu = 0.5$ 每小时。\n\n对于向量 $i=1$ ($noexec$)：\n$\\lambda_1 = 0.03$ 每小时，$\\alpha_1 = 0.05$，$\\beta_1 = 0.60$，$L_1 = 3000$ 美元。\n第1项：$L_1 \\lambda_1 (\\beta_1 - \\alpha_1) = 3000 \\times 0.03 \\times (0.60 - 0.05) = 3000 \\times 0.03 \\times 0.55 = 49.5$。\n\n对于向量 $i=2$ ($nodev$)：\n$\\lambda_2 = 0.004$ 每小时，$\\alpha_2 = 0.02$，$\\beta_2 = 0.40$，$L_2 = 12000$ 美元。\n第2项：$L_2 \\lambda_2 (\\beta_2 - \\alpha_2) = 12000 \\times 0.004 \\times (0.40 - 0.02) = 12000 \\times 0.004 \\times 0.38 = 18.24$。\n\n对于向量 $i=3$ ($nosuid$)：\n$\\lambda_3 = 0.015$ 每小时，$\\alpha_3 = 0.01$，$\\beta_3 = 0.50$，$L_3 = 8000$ 美元。\n第3项：$L_3 \\lambda_3 (\\beta_3 - \\alpha_3) = 8000 \\times 0.015 \\times (0.50 - 0.01) = 8000 \\times 0.015 \\times 0.49 = 58.8$。\n\n这些项的总和是：\n$$\\sum_{i=1}^{3} L_i \\lambda_i (\\beta_i - \\alpha_i) = 49.5 + 18.24 + 58.8 = 126.54$$\n最后，我们计算总的预期额外损失：\n$$E[\\Delta L_{\\text{total}}] = \\frac{1}{0.5} \\times 126.54 = 2 \\times 126.54 = 253.08$$\n问题要求答案四舍五入到 $4$ 位有效数字。数字 $253.08$ 四舍五入到四位有效数字是 $253.1$。\n预期的额外损失为 $253.1$ 美元。", "answer": "$$\\boxed{253.1}$$", "id": "3650719"}]}