{"hands_on_practices": [{"introduction": "在许多拜占庭容错场景中，系统可以利用数字签名来验证消息的真实性，从而防止攻击者伪造数据。在这种情况下，设计挑战的重点从确保安全性（即结果的正确性）转移到了确保活性（即系统最终能够达成一个结果）。本练习 [@problem_id:3625118] 将要求你计算，当部分副本可能无响应或恶意行为时，为保证系统最终能取得进展，所需的最少副本数量。", "problem": "一个操作系统服务发现组件需要使用域名系统（DNS）将主机名解析为端点。为了容忍可能返回被污染条目的敌对解析器，客户端实现了一个带有认证数据的拜占庭容错读取协议。客户端并发地查询来自不相交管理域的 $n$ 个独立的递归解析器。最多有 $f$ 个解析器是拜占庭故障的，这符合拜占庭故障的经典定义：它们可能任意行为，包括发送不正确的数据、重放陈旧数据、含糊其辞或根本不响应。\n\n该服务的权威区域受域名系统安全扩展（DNSSEC）保护，客户端使用该区域的公钥验证收到的每个资源记录集。假设权威签名密钥未被泄露，签名方案提供了不可伪造性和数据源认证，并且在解析时，目标名称的记录集对于所有正确的解析器都是唯一且确定的。任何未能通过签名验证、签名有效期无效或与当前有效的已签名资源记录集不完全匹配的响应都会被客户端丢弃。\n\n客户端的接受策略如下：只有在从 $q$ 个不同的解析器收集到 $q$ 个相同的、有效签名的资源记录集后，它才会接受该映射。网络是异步的，因此响应可以被任意延迟，但每个非故障解析器最终都会返回正确的、有效签名的记录集。\n\n从这些定义和属性出发，推导一个封闭形式的表达式，表示客户端必须查询的最小解析器数量 $n$，以保证在任何控制最多 $f$ 个解析器的敌对者情况下，同时满足安全性（它从不接受不正确的映射）和活性（它最终会接受正确的映射）。将您的最终答案表示为 $f$ 和 $q$ 的函数。不需要进行数值取整。", "solution": "问题陈述已经过分析并被认为是有效的。它在科学上基于分布式系统和密码学的原理，特别是带有认证消息的拜占庭容错（BFT）。该问题提法恰当、客观，并包含足够的信息来推导出唯一且有意义的解决方案。\n\n设 $n$ 是客户端查询的解析器总数。\n设 $f$ 是这些解析器中可能出现拜占庭故障的最大数量。\n设 $q$ 是客户端接受一个映射所需的相同且有效签名的资源记录集的数量。\n\n客户端必须保证两个属性：安全性和活性。\n\n1.  **安全性分析**\n\n    安全性要求客户端永远不接受不正确的映射。客户端的接受策略是等待来自 $q$ 个不同解析器的 $q$ 个相同的、有效签名的资源记录集。\n\n    问题陈述指出，系统使用域名系统安全扩展（DNSSEC），权威签名密钥未被泄露，且签名方案提供了不可伪造性。这意味着控制 $f$ 个故障解析器的敌对者无法为任何未经该区域权威所有者签名的资源记录集伪造有效的数字签名。\n\n    此外，问题明确指出，“在解析时，目标名称的记录集对于所有正确的解析器都是唯一且确定的。” 让我们将这个唯一的、当前有效的、正确签名的记录集表示为 $RR_{correct}$。\n\n    任何与 $RR_{correct}$ 不完全匹配的响应都会被客户端丢弃，因为它要么无法通过签名验证，要么被识别为不是“当前有效的已签名资源记录集”。因此，拜占庭解析器无法创建一个不同的、有效签名的记录集 $RR_{incorrect}$ 来通过客户端的验证。它们唯一可能发送的有效签名记录集就是 $RR_{correct}$ 本身。\n\n    因此，客户端不可能收集到 $q$ 个相同且有效签名的不正确记录集副本。唯一能满足接受标准的记录集是 $RR_{correct}$。因此，对于任何 $q \\ge 1$，无论 $n$ 和 $f$ 的值如何，安全性属性都由密码学认证机制无条件保证。\n\n2.  **活性分析**\n\n    活性要求客户端最终接受正确的映射。这意味着必须保证客户端最终能收集到 $q$ 个 $RR_{correct}$ 的副本。\n\n    我们必须考虑敌对者为阻止活性所能制造的最坏情况。敌对者控制 $f$ 个解析器。为了最大限度地阻碍客户端，敌对者会指示所有 $f$ 个故障解析器以阻止客户端取得进展的方式行事。考虑到客户端的验证规则，故障解析器能采取的最具破坏性的行动就是不发送正确的记录集 $RR_{correct}$。这可以通过完全不响应（崩溃故障），或者发送保证会被丢弃的数据（例如，垃圾数据、重放的陈旧记录或用于不同名称的记录）来实现。\n\n    总共有 $n$ 个解析器。在最坏情况下，其中 $f$ 个是故障的，并且对收集 $RR_{correct}$ 没有贡献。剩余的解析器数量是 $n - f$。根据定义，这些解析器是非故障的。\n\n    问题陈述指出，“每个非故障解析器最终都会返回正确的、有效签名的记录集。” 这保证了客户端最终将收到 $n - f$ 个 $RR_{correct}$ 的副本。\n\n    为了使活性属性成立，保证收到的正确响应数量必须足以满足客户端的接受法定人数 $q$。因此，非故障解析器的数量必须至少为 $q$。这给我们带来了以下不等式：\n    $$n - f \\ge q$$\n\n3.  **最小 $n$ 的推导**\n\n    安全性属性没有对 $n$ 施加超出活性要求的额外约束。活性属性要求 $n - f \\ge q$。为了找到解析器的最小数量 $n$，我们可以解这个关于 $n$ 的不等式：\n    $$n \\ge f + q$$\n\n    对于任何包含最多 $f$ 个故障的配置，满足此条件的 $n$ 的最小整数值是在等式成立时。因此，所需的最小解析器数量为：\n    $$n = f + q$$\n\n    当有 $n = f + q$ 个解析器时，在 $f$ 个解析器出现故障且不合作的最坏情况下，仍然有 $(f + q) - f = q$ 个非故障解析器。由于所有非故障解析器都保证最终会以正确的、有效签名的记录集响应，因此客户端保证最终能收到 $q$ 个此类响应，从而满足活性条件。如前所述，安全性已由系统的密码学属性保证。", "answer": "$$\\boxed{f + q}$$", "id": "3625118"}, {"introduction": "共识算法致力于在多个节点间就单一值达成一致，但在许多实际系统中，我们需要聚合来自多个数据源的数据，而其中一些数据源可能是错误的。本练习 [@problem_id:3625176] 探索了一种强大的技术——“截尾均值”（trimmed mean），用于过滤掉恶意的数值输入。你将分析该方法的 worst-case error，从而理解它如何在拜占庭传感器故障的情况下保证估算值的准确性。", "problem": "操作系统（OS）的风扇控制器使用多个板载热传感器来估算中央处理器（CPU）的温度并设置风扇速度。系统必须能容忍拜占庭容错（BFT），其中最多有 $f$ 个传感器可能任意（恶意）行为，而其余的 $n-f$ 个传感器是诚实的。设CPU的真实温度为 $T \\in \\mathbb{R}$。诚实传感器 $i$ 报告的值为 $x_{i} = T + \\varepsilon_{i}$，其中 $|\\varepsilon_{i}| \\leq \\delta$，$\\delta > 0$ 是一个已知的界限。恶意传感器可以不受限制地报告任何实数。\n\n为了聚合这 $n$ 个读数，操作系统使用 $f$-截尾均值估计器：将 $n$ 个报告值排序以获得顺序统计量 $x_{(1)} \\leq x_{(2)} \\leq \\cdots \\leq x_{(n)}$，丢弃最低的 $f$ 个和最高的 $f$ 个值，并计算\n$$\n\\hat{T} = \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} x_{(i)} \\, ,\n$$\n假设 $n \\geq 2f + 1$ 以确保估计器是良定义的。\n\n对手试图在上述约束条件下最大化估计误差。推导绝对误差的紧凑最坏情况上界\n$$\nE = \\sup \\, \\big| \\hat{T} - T \\big| \\, ,\n$$\n该上界需涵盖所有可能的恶意值分配和所有满足 $|\\varepsilon_{i}| \\leq \\delta$ 的诚实噪声实现。将最终的界限表示为 $n$、$f$ 和 $\\delta$ 的闭式函数。您必须以摄氏度表示该界限。不需要进行数值舍入。", "solution": "问题要求绝对估计误差 $E = \\sup \\, \\big| \\hat{T} - T \\big|$ 的紧凑最坏情况上界，其中 $\\hat{T}$ 是真实温度 $T$ 的 $f$-截尾均值估计器。该估计器由下式给出\n$$\n\\hat{T} = \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} x_{(i)}\n$$\n系统由 $n$ 个传感器组成，其中最多有 $f$ 个可能是恶意的（拜占庭式的），并报告任意值。剩下的 $n-f$ 个传感器是诚实的，报告值为 $x_i = T + \\varepsilon_i$，其中噪声 $\\varepsilon_i$ 的界限为 $|\\varepsilon_i| \\leq \\delta$。分析受限于条件 $n \\geq 2f + 1$。\n\n绝对误差是 $|\\hat{T} - T|$。为了找到其上确界，我们可以分析偏差 $\\hat{T} - T$ 的最大和最小可能值。由于问题的对称性（恶意传感器可以报告任意高或低的值，且诚实误差界 $|\\varepsilon_i| \\le \\delta$ 关于0对称），最大正误差 $\\sup(\\hat{T}-T)$ 的大小将与最大负误差 $\\sup(T-\\hat{T})$ 的大小相同。我们将专注于找到 $\\hat{T}$ 的最大可能值。\n\n让我们分析估计器求和中可能出现的值的范围。求和是针对 $i$ 从 $f+1$到 $n-f$ 的顺序统计量 $x_{(i)}$。我们将证明，无论恶意传感器报告何值，任何这样的值 $x_{(i)}$ 都必须在 $[T-\\delta, T+\\delta]$ 的范围内。\n\n首先，让我们为平均窗口中的任何值 $x_{(i)}$ 建立一个上界。平均值中包含的最大值是 $x_{(n-f)}$。考虑最大的 $f+1$ 个报告值集合：$\\{x_{(n-f)}, x_{(n-f+1)}, \\dots, x_{(n)}\\}$。根据顺序统计量的定义，此集合中的所有值都大于或等于 $x_{(n-f)}$。这个集合包含 $f+1$ 个传感器读数。由于只有 $f$ 个恶意传感器，这 $f+1$ 个读数中至少有一个必须来自诚实传感器。设这个诚实的读数为 $x_{h}$。对于这个诚实的读数，我们知道 $x_{h} = T + \\varepsilon_{h}$ 且 $\\varepsilon_{h} \\leq \\delta$，所以 $x_{h} \\leq T + \\delta$。\n由于 $x_{h}$ 在集合 $\\{x_{(n-f)}, \\dots, x_{(n)}\\}$ 中，我们有 $x_{h} \\geq x_{(n-f)}$。\n结合这些不等式得出 $x_{(n-f)} \\leq x_{h} \\leq T + \\delta$。\n由于 $x_{(n-f)}$ 是平均窗口中的最大值，因此对于任何 $i \\in \\{f+1, \\dots, n-f\\}$，我们有 $x_{(i)} \\leq x_{(n-f)} \\leq T + \\delta$。\n\n其次，让我们用对称的论证来建立一个下界。平均值中包含的最小值是 $x_{(f+1)}$。考虑最小的 $f+1$ 个报告值集合：$\\{x_{(1)}, x_{(2)}, \\dots, x_{(f+1)}\\}$。此集合中的所有值都小于或等于 $x_{(f+1)}$。这个集合也包含 $f+1$ 个传感器读数。根据鸽巢原理，这些读数中至少有一个必须来自诚实传感器。设这个诚实的读数为 $x_{h'}$。对于这个读数，$x_{h'} = T + \\varepsilon_{h'}$ 且 $\\varepsilon_{h'} \\geq -\\delta$，所以 $x_{h'} \\geq T - \\delta$。\n由于 $x_{h'}$ 在集合 $\\{x_{(1)}, \\dots, x_{(f+1)}\\}$ 中，我们有 $x_{h'} \\leq x_{(f+1)}$。\n结合这些得出 $x_{(f+1)} \\geq x_{h'} \\geq T - \\delta$。\n由于 $x_{(f+1)}$ 是平均窗口中的最小值，因此对于任何 $i \\in \\{f+1, \\dots, n-f\\}$，我们有 $x_{(i)} \\geq x_{(f+1)} \\geq T - \\delta$。\n\n我们已经证明，对于求和范围内的任何索引 $i$，$f+1 \\leq i \\leq n-f$，相应的顺序统计量 $x_{(i)}$ 受限于\n$$\nT - \\delta \\leq x_{(i)} \\leq T + \\delta\n$$\n这对于任何可能的恶意值集合和任何有效的诚实传感器噪声实现都成立。\n\n现在，我们可以对估计器 $\\hat{T}$ 进行界定。使用求和中每一项的上界：\n$$\n\\hat{T} = \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} x_{(i)} \\leq \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} (T + \\delta)\n$$\n求和中的项数是 $(n-f) - (f+1) + 1 = n-2f$。\n$$\n\\hat{T} \\leq \\frac{1}{n - 2f} (n - 2f)(T + \\delta) = T + \\delta\n$$\n类似地，使用每一项的下界：\n$$\n\\hat{T} = \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} x_{(i)} \\geq \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} (T - \\delta) = T - \\delta\n$$\n结合这些结果，我们发现估计值 $\\hat{T}$ 始终包含在区间 $[T - \\delta, T + \\delta]$ 内。这意味着绝对误差受限于：\n$$\n|\\hat{T} - T| \\leq \\delta\n$$\n这表明 $\\sup \\, |\\hat{T}-T| \\le \\delta$。\n\n为了证明这个界限是紧凑的，我们必须构造一个最坏情况，其中误差恰好为 $\\delta$。对手的目标是最大化误差，这涉及到选择 $f$ 个恶意值，并且是在所有可能的诚实噪声实现 $|\\varepsilon_i| \\le \\delta$ 上进行最大化。为了最大化 $\\hat{T}-T$，对手可以采用以下策略：\n1.  将所有 $n-f$ 个诚实传感器的噪声设置为其最大可能值 $\\varepsilon_i = +\\delta$。这使得所有诚实传感器都报告值 $T+\\delta$。\n2.  将所有 $f$ 个恶意传感器的值设置为某个小于任何诚实读数的值，例如，报告一个非常大的负数（或任何小于 $T+\\delta$ 的值）。一个简单的选择是让它们报告 $T-\\delta$。\n\n这 $n$ 个传感器读数的集合就是 $\\{T-\\delta, \\dots, T-\\delta\\}$（$f$ 次）和 $\\{T+\\delta, \\dots, T+\\delta\\}$（$n-f$ 次）。排序后的读数列表 $x_{(1)} \\leq x_{(2)} \\leq \\cdots \\leq x_{(n)}$ 将是：\n$$\nx_{(1)} = \\cdots = x_{(f)} = T - \\delta\n$$\n$$\nx_{(f+1)} = \\cdots = x_{(n)} = T + \\delta\n$$\n估计器 $\\hat{T}$ 对从 $x_{(f+1)}$ 到 $x_{(n-f)}$ 的值进行平均。在这种情况下，所有这些值都都等于 $T+\\delta$。\n$$\n\\hat{T} = \\frac{1}{n - 2f} \\sum_{i = f + 1}^{n - f} (T + \\delta) = \\frac{1}{n - 2f} (n-2f)(T+\\delta) = T + \\delta\n$$\n在这种情况下，估计误差为 $\\hat{T} - T = (T+\\delta) - T = \\delta$。\n通过对称论证（将诚实噪声设置为 $-\\delta$，并将恶意值设置为一个非常大的正数），可以实现 $-\\delta$ 的误差。\n\n由于绝对误差 $|\\hat{T} - T|$ 总是小于或等于 $\\delta$，并且我们已经证明了一种它恰好等于 $\\delta$ 的情况，因此绝对误差的紧凑最坏情况上界（上确界）是 $\\delta$。题目要求该界限以摄氏度表示，这也是 $\\delta$ 的单位。", "answer": "$$\\boxed{\\delta}$$", "id": "3625176"}, {"introduction": "许多拜占庭容错协议的核心是“法定人数”（quorum）的概念，即必须同意某项决定的最小节点数。这个编程练习 [@problem_id:3625121] 要求你将法定人数交集（quorum intersection）的数学原理转化为一个可工作的程序。你将亲自推导所需法定人数的大小，然后模拟一个共识过程，学会处理包括系统配置不可行和节点违反协议等多种故障情况。", "problem": "给定一个受操作系统休眠启发的场景：在进入低功耗状态之前，一个分布式检查点服务必须就一个要持久化的内存映像摘要达成一致。该系统在多个节点上复制，并且必须容忍拜占庭故障。共识是在带签名的内存映像摘要上执行的，表示为 $h$，每个提议的映像一个。你的任务是编写一个程序，该程序基于拜占庭故障下法定人数规则的集合论推导，来模拟是否可以达成安全共识，如果可以，选择哪个摘要。\n\n使用以下纯粹以逻辑和数学术语陈述的基本原理：\n\n- 拜占庭容错 (BFT) 意味着最多 $f$ 个节点可以任意行为。系统共有 $n$ 个节点。正确节点遵守协议规则，包括在给定的决策轮次中最多为一个摘要签名。\n- 接受规则要求对单个摘要有达到法定人数的签名。如果一个签名在语法上是正确的，并且附加到目标摘要 $h$，则该签名被认为是有效的；否则它是无效的。在本模拟中，有效性是一个为每个签名在测试用例中提供的布尔谓词。\n- 法定人数大小，表示为 $t$，必须被选择以在以下约束条件下保证安全性和活性：\n  1. 安全性：任意两个不同的摘要 $h_a \\neq h_b$ 不能同时被正确节点接受。等价地，任何两个针对不同摘要的法定人数集合必须在至少一个正确节点上相交，因为正确节点每轮最多只为一个摘要签名。\n  2. 活性：如果最多有 $f$ 个节点是拜占庭节点，只要存在足够多的正确签名，正确节点就可以形成一个接受摘要的法定人数。\n- 集合论基础：对于一个包含 $n$ 个节点的全体，任意两个大小为 $t$ 的子集的交集大小至少为 $2t - n$。由于最多有 $f$ 个拜占庭节点，为保证交集至少包含一个正确节点，要求交集的大小超过 $f$。\n\n你的程序必须：\n1. 使用上述约束和集合论事实，从 $n$ 和 $f$ 推导出最小整数法定人数大小 $t$，不依赖任何预先给定的快捷公式。\n2. 验证签名，对每个摘要只计算有效且唯一的签名者，并强制每个正确节点在本轮中最多为一个摘要签名。\n3. 确定是否可以安全地接受一个唯一的摘要。如果一个摘要 $h$ 收集到至少 $t$ 个有效签名，并且没有其他摘要同时做到这一点，那么该摘要就是可接受的；如果多个摘要达到或超过 $t$，或者一个正确节点为多个摘要签名，或者配置对于拜占庭容错不可行，则无法达成安全共识。\n4. 将最终答案生成为单行，包含一个方括号内的逗号分隔整数列表，每个测试用例一个整数，如果可以安全地达成共识，该整数为接受的摘要标识符 $h$，如果无法达成安全共识，则为 $-1$。\n\n可行性检查：拜占庭容错的一个经典充分可行性条件是 $n \\geq 3f + 1$。如果某个测试用例不满足此条件，程序必须为该用例返回 $-1$。\n\n测试套件规范（所有标识符和计数均为整数，所有集合均为有限集；对于每个数学实体，数字都用 LaTeX 包装）：\n- 测试用例 1 (正常路径):\n  - $n = 7$， $f = 2$，正确节点 $\\{0,1,2,3,4\\}$。\n  - 摘要：\n    - $h = 101$，有效签名者 $\\{0,1,2,3,4,5\\}$，全部有效。\n    - $h = 202$，签名者 $\\{5,6\\}$，其中节点 $5$ 的签名有效，节点 $6$ 的签名无效。\n  - 预期行为：只有 $h = 101$ 达到法定人数；接受 $101$。\n- 测试用例 2 (边界可行性):\n  - $n = 4$， $f = 1$，正确节点 $\\{0,1,2\\}$。\n  - 摘要：\n    - $h = 303$，有效签名者 $\\{0,1,2\\}$，全部有效。\n  - 预期行为：接受 $303$。\n- 测试用例 3 (正确节点双重签名导致安全性失效):\n  - $n = 7$， $f = 2$，正确节点 $\\{0,1,2,3,4\\}$。\n  - 摘要：\n    - $h = 404$，有效签名者 $\\{0,1,2,3,5\\}$，全部有效。\n    - $h = 505$，有效签名者 $\\{0,1,2,4,6\\}$，全部有效。\n  - 预期行为：正确节点 $0,1,2$ 为两个摘要签名；拒绝共识并返回 $-1$。\n- 测试用例 4 (不可行的配置):\n  - $n = 6$， $f = 2$，正确节点 $\\{0,1,2,3\\}$。\n  - 摘要：\n    - $h = 606$，有效签名者 $\\{0,1,2,3,4\\}$，全部有效。\n  - 预期行为：由于 $n  3f + 1$ (即 $6  7$)，返回 $-1$。\n- 测试用例 5 (签名数量不足):\n  - $n = 7$， $f = 2$，正确节点 $\\{0,1,2,3,4\\}$。\n  - 摘要：\n    - $h = 707$，签名者 $\\{0,1,2,3\\}$，其中节点 $0,1,2$ 的签名有效，节点 $3$ 的签名无效，只剩下 $3$ 个有效签名。\n  - 预期行为：没有摘要达到法定人数；返回 $-1$。\n- 测试用例 6 (拜占庭节点含糊其辞但法定人数唯一):\n  - $n = 10$， $f = 3$，正确节点 $\\{0,1,2,3,4,5,6\\}$。\n  - 摘要：\n    - $h = 808$，有效签名者 $\\{0,1,2,3,4,5,7\\}$，全部有效。\n    - $h = 909$，有效签名者 $\\{7,8,9,6\\}$，全部有效。\n    - $h = 1000$，有效签名者 $\\{8,9\\}$，全部有效。\n  - 预期行为：只有 $h = 808$ 满足法定人数；接受 $808$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表（例如 $[result_1,result_2,\\dots]$）。对于上述测试套件，程序必须按顺序为每个用例输出接受的摘要标识符或 $-1$。", "solution": "该问题要求设计一个模拟程序，以确定在一个受拜占庭故障影响的分布式系统中，是否可以就内存摘要达成安全共识。解决方案源自拜占庭容错（BFT）的第一性原理，特别关注法定人数的集合论属性。\n\n确定每个测试用例结果的过程基于一系列验证步骤和计算，这些步骤和计算植根于已建立的 BFT 理论。\n\n**步骤 1：系统可行性条件**\n\n该系统由总共 $n$ 个节点描述，其中最多 $f$ 个可能是拜占庭节点。一个广为接受的充分条件是，为了让系统能够在存在 $f$ 个拜占庭故障的情况下解决共识问题，节点总数 $n$ 必须至少为 $3f + 1$。这由不等式表示：\n$$n \\ge 3f + 1$$\n这个条件确保在 $f$ 个节点被发现是故障节点后，剩余的 $n-f$ 个正确节点数量足够多（$n-f \\ge 2f+1$），从而能够投票超过那些可能说谎并制造两个大小为 $f$ 的对立阵营的故障节点。问题陈述中说明，如果某个测试用例不满足此可行性条件，则无法达成安全共识，结果必须为 $-1$。\n\n**步骤 2：最小法定人数大小 ($t$) 的推导**\n\nBFT 安全性的核心在于确保两个冲突的提议（例如，针对不同的摘要 $h_a$ 和 $h_b$）永远不能被系统同时接受。接受一个摘要 $h$ 被定义为从不同节点收集到至少 $t$ 个有效签名，从而达到法定人数。\n\n设 $Q_a$ 是为摘要 $h_a$ 签名的节点集合，$Q_b$ 是为摘要 $h_b$ 签名的节点集合。要使两个摘要都被接受，这些集合的大小必须达到法定人数阈值：$|Q_a| \\ge t$ 和 $|Q_b| \\ge t$。为了推导，我们考虑最小情况，即 $|Q_a| = t$ 和 $|Q_b| = t$。\n\n安全属性要求不可能为冲突的摘要形成两个法定人数集合。根据定义，一个正确的节点在每个决策轮次中最多只为一个摘要签名。因此，如果任何两个潜在法定人数集合的交集 $Q_a \\cap Q_b$ 被保证包含至少一个正确的节点，那么安全性就得以保证。如果一个正确的节点在交集中，它将被要求为 $h_a$ 和 $h_b$ 两者签名。它会为一个签名而拒绝另一个，从而阻止其中一个法定人数集合的形成。\n\n安全性的最坏情况是交集 $Q_a \\cap Q_b$ 完全由拜占庭节点组成。系统中最多有 $f$ 个拜占庭节点。为保证交集至少包含一个正确节点，其大小必须严格大于 $f$。\n$$|Q_a \\cap Q_b| > f$$\n根据集合论，两个集合交集的大小受容斥原理的限制。对于一个包含 $n$ 个节点的全体：\n$$|Q_a \\cap Q_b| \\ge |Q_a| + |Q_b| - n$$\n代入 $|Q_a| = t$ 和 $|Q_b| = t$，我们得到：\n$$|Q_a \\cap Q_b| \\ge 2t - n$$\n结合这两个不等式来强制执行安全要求，得出：\n$$2t - n > f$$\n求解法定人数大小 $t$：\n$$2t > n + f$$\n$$t > \\frac{n+f}{2}$$\n由于 $t$ 必须是一个整数（代表节点计数），满足此严格不等式的最小整数值 $t$ 是通过对右侧取底并加 1 得到的。\n$$t = \\left\\lfloor \\frac{n+f}{2} \\right\\rfloor + 1$$\n该公式提供了安全接受一个摘要所需的最小签名数。\n\n**步骤 3：共识的算法流程**\n\n基于以上原则，可以制定一个确定性算法来评估每个测试用例。\n\n1.  **可行性检查**：对于给定的参数 $n$ 和 $f$，首先验证是否满足 $n \\ge 3f + 1$。如果此条件不成立，则系统不可行。该用例的流程终止，结果为 $-1$。\n\n2.  **法定人数计算**：如果系统可行，则使用推导出的公式计算最小整数法定人数大小 $t$：$t = \\lfloor \\frac{n+f}{2} \\rfloor + 1$。\n\n3.  **签名验证和正确性检查**：\n    a. 初始化数据结构以跟踪每个提议摘要的有效签名数量，并监控正确节点的签名活动。\n    b. 对每个摘要，遍历其签名者列表。只有标记为有效的签名才被计数。\n    c. 同时，检查正确节点是否违反协议。一个正确节点最多只能为一个摘要签名。如果发现一个被标识为正确的节点为两个或多个不同摘要提供了有效签名，这构成了严重的安全故障。该用例的流程终止，结果为 $-1$。根据定义，拜占庭节点被允许签署多个摘要。\n\n4.  **确定最终结果**：\n    a. 处理完所有签名并确认没有正确节点双重签名后，确定哪些摘要（如有）达到了法定人数阈值 $t$。\n    b. 设 $S$ 是累积了至少 $t$ 个有效签名的摘要集合。\n    c. 如果该集合的大小恰好为 1，即 $|S| = 1$，则达成了唯一的安全共识。结果是 $S$ 中唯一摘要的标识符 $h$。\n    d. 如果集合大小为零，即 $|S| = 0$，则没有摘要获得足够的支持。\n    e. 如果集合大小大于 1，即 $|S| > 1$，则有两个或更多摘要达到了法定人数阈值，导致了违反安全性的歧义。\n    f. 在 $|S| \\neq 1$ 的两种情况下，都无法达成安全共识，结果为 $-1$。\n\n这个结构化的流程确保了问题中指定的所有拜占庭容错共识条件都得到严格检查，从而为每种场景得出一个明确的结论。", "answer": "[101, 303, -1, -1, -1, 808]", "id": "3625121"}]}