{"hands_on_practices": [{"introduction": "理论知识只有在实践中应用才能真正被掌握。这个练习将带你从理论走向实践，通过一个简化的场景来计算系统颠簸（thrashing）的临界点 [@problem_id:3685321]。通过这个计算，你将具体地理解工作集（working set）大小、物理内存和系统负载三者之间的关系，这对于任何系统性能分析都至关重要。", "problem": "一个单一的高性能计算（HPC）节点运行着一个支持交换（swapping）和批处理调度的操作系统。该节点拥有总物理随机存取存储器（RAM）为 $M = 256$ GiB。一个批处理队列分派 $n$ 个相同的作业。每个作业都有一个稳态内存工作集，大小为 $W = 9$ GiB，该工作集是在一个适用于工作集模型的固定时间窗口 $\\Delta t$ 内测得的。当总驻留内存需求超过总物理内存的一个分数 $\\beta$ 时，操作系统的内存压力控制器会启动持续的页面回收，其中 $\\beta = 0.82$ 且 $0\\beta1$。\n\n请使用工作集和颠簸（thrashing）的规范定义，从第一性原理出发，形式化描述此工作负载下颠簸开始发生的条件，并推导出不会发生颠簸的最大整数 $n_{\\max}$。其中，颠簸是指持续的页面回收迫使工作集页面被反复换出和重新取回的状态。然后，根据给定的 $M$、$W$ 和 $\\beta$ 值，计算 $n_{\\max}$ 的数值。请将最终答案表示为一个整数计数（无单位）。无需超出最大整数进行舍入。", "solution": "首先，对问题进行验证过程，以确保其科学合理性、一致性和良构性。\n\n### 步骤 1：提取给定条件\n- 总物理随机存取存储器（RAM）：$M = 256$ GiB。\n- 相同作业的数量：$n$。\n- 每个作业的稳态内存工作集：$W = 9$ GiB。\n- 工作集测量时间窗口：$\\Delta t$。\n- 内存压力阈值分数：$\\beta = 0.82$。\n- 阈值约束条件：$0  \\beta  1$。\n- 颠簸的定义：持续的页面回收迫使工作集页面被反复换出和重新取回的状态。\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题在科学上基于操作系统内存管理的原理，特别是 Peter Denning 提出的工作集模型。颠簸（Thrashing）是一个明确定义的现象，当活动进程的总内存需求超过可用物理内存时发生，导致过度的分页活动和系统吞吐量的崩溃。问题陈述使用了标准术语，并提供了一个清晰的、定量的设置。对于高性能计算（HPC）环境而言，给定的内存大小（$M = 256$ GiB）、工作集大小（$W = 9$ GiB）和内存压力阈值（$\\beta = 0.82$）是符合实际的。该问题是自洽的，因为时间窗口 $\\Delta t$ 是给定工作集大小 $W$ 定义的一部分，但其具体数值对于计算而言并非必需。目标是基于这些参数推导出最大作业数 $n_{\\max}$，这是一个良构问题。该问题不包含科学或事实上的不合理之处，没有矛盾，也没有歧义。\n\n### 步骤 3：结论与行动\n该问题被认定为有效。将从第一性原理出发推导解决方案。\n\n### 颠簸条件与解决方案的推导\n\n防止颠簸的基本原则是确保所有并发运行进程的总工作集能够被容纳在可用的物理内存中。一个进程的工作集是它在最近一个时间窗口 $\\Delta t$ 内访问过的页面的集合。为了使进程高效执行，其整个工作集必须驻留在物理内存中。如果工作集中的页面被换出（swapped out），它们很可能很快会再次被需要，从而导致页面错误（page fault）以及随后的 I/O 操作，以将页面从二级存储中取回。当这种情况对大量进程高频率发生时，系统就被称为处于颠簸状态。\n\n问题陈述了有 $n$ 个相同的作业，每个作业的工作集大小为 $W$。将所有 $n$ 个作业的工作集同时保留在内存中所需的总内存需求是总工作集大小，由下式给出：\n$$\n\\text{总工作集需求} = n \\cdot W\n$$\n\n操作系统监控内存压力，并在总驻留内存需求超过总物理内存 $M$ 的一个分数 $\\beta$ 时，开始持续的页面回收。这个阈值 $\\beta \\cdot M$ 代表了操作系统在采取积极措施（如换出可能正在活跃使用的页面）以释放内存之前，允许用户进程占用的最大物理内存量。剩余的部分 $(1-\\beta)M$ 构成了“回收顶空（reclaim headroom）”，为操作系统内核、文件系统缓存保留，并作为应对突发内存分配高峰的缓冲区。\n\n为避免颠簸，所有作业的总工作集需求不得超过此操作内存容量。如果总工作集需求大于 $\\beta \\cdot M$，操作系统将被迫回收属于一个或多个作业工作集的页面。这一行为直接满足了问题中对颠簸的定义：“持续的页面回收迫使工作集页面被反复换出和重新取回。”\n\n因此，无颠簸运行的条件是：\n$$\nn \\cdot W \\le \\beta \\cdot M\n$$\n\n问题要求的是使此条件成立的最大整数 $n_{\\max}$。我们可以通过重排不等式来求解 $n$：\n$$\nn \\le \\frac{\\beta \\cdot M}{W}\n$$\n\n由于 $n$ 必须是代表作业数量的整数，因此最大值 $n_{\\max}$ 是满足此不等式的最大整数。这等同于对不等式右侧的表达式取底（floor）：\n$$\nn_{\\max} = \\left\\lfloor \\frac{\\beta \\cdot M}{W} \\right\\rfloor\n$$\n\n现在，我们代入问题陈述中提供的数值来计算 $n_{\\max}$：\n- $M = 256$ GiB\n- $W = 9$ GiB\n- $\\beta = 0.82$\n\n将这些值代入 $n_{\\max}$ 的表达式中：\n$$\nn_{\\max} = \\left\\lfloor \\frac{0.82 \\cdot 256 \\text{ GiB}}{9 \\text{ GiB}} \\right\\rfloor\n$$\n\nGiB 单位相互抵消，得到一个无量纲的量，这对于作业计数来说是符合预期的。我们进行计算：\n$$\nn_{\\max} = \\left\\lfloor \\frac{209.92}{9} \\right\\rfloor\n$$\n$$\nn_{\\max} = \\left\\lfloor 23.32444... \\right\\rfloor\n$$\n\n该值的底为 $23$。因此，可以并发运行而不会引发颠簸的最大整數作业数量是 $23$。如果运行 $24$ 个作业，它们的总工作集需求（$24 \\cdot 9$ GiB $= 216$ GiB）将超过允许的内存阈值（$0.82 \\cdot 256$ GiB $\\approx 209.92$ GiB），从而触发持续的页面回收，并因此导致颠簸。", "answer": "$$\n\\boxed{23}\n$$", "id": "3685321"}, {"introduction": "理解了颠簸的成因后，我们来看一个更贴近日常应用的场景：浏览器标签页管理。当内存不足时，操作系统必须做出选择，换出哪些页面。这个练习将让你扮演决策者的角色，在一个类似于背包问题的优化场景中，权衡内存占用和用户感知的访问延迟，从而决定换出哪些标签页以保证交互式应用的流畅性 [@problem_id:3685404]。", "problem": "一个现代网络浏览器运行着 $m$ 个标签页，每个标签页由一个工作负载 $W_i$ 表示，其工作集大小为 $s_i$（以兆字节为单位）。操作系统使用交换（swapping）技术：当一个标签页被换出时，其工作集会从物理内存中移除，并在后续访问时从二级存储中读回。对于任何交互式标签页，当恢复一个被换出的标签页时，用户感知的访问延迟被建模为 $$t_i=\\delta+\\frac{s_i}{B}\\times 10^3,$$ 其中 $\\delta$ 是一个固定的设置开销（以毫秒为单位），$B$ 是存储设备的持续顺序读取带宽（以兆字节/秒为单位）。假设交换是以标签页为粒度进行的，因此 $s_i$ 要么全部驻留在内存中，要么全部不驻留。\n\n系统有一个不可避免的常驻操作系统开销 $S_{\\text{sys}}$ 和一个物理内存容量 $M$，两者都以兆字节为单位。令 $\\mathcal{I}$ 表示交互式标签页的索引集合，令 $\\mathcal{N}$ 表示非交互式标签页的索引集合。一个换出标签页的选择是可行的，如果驻留标签页的工作集大小之和加上 $S_{\\text{sys}}$ 不超过 $M$，并且任何被换出的交互式标签页的延迟严格小于一个界限 $\\lambda$。\n\n给定以下具体的工作负载和系统参数：\n- 标签页数量 $m=7$。\n- 交互式标签页：$\\mathcal{I}=\\{1,2,3\\}$，工作集大小为 $s_1=620$ MB, $s_2=420$ MB, $s_3=260$ MB。\n- 非交互式标签页：$\\mathcal{N}=\\{4,5,6,7\\}$，工作集大小为 $s_4=550$ MB, $s_5=480$ MB, $s_6=320$ MB, $s_7=190$ MB。\n- 操作系统开销 $S_{\\text{sys}}=600$ MB。\n- 物理内存容量 $M=1850$ MB。\n- 存储参数：固定开销 $\\delta=10$ 毫秒，持续带宽 $B=200$ MB/s。\n\n从关于内存容量和交换延迟的基本原理出发，将此问题构建为一个关于标签页集合的类背包选择问题，并推导出在满足可行性的同时，最小化最坏情况交互式延迟界限 $\\lambda$ 的选择。确定存在可行选择的 $\\lambda$ 的最小值（以毫秒为单位）。将您的最终数值答案四舍五入到四位有效数字，并以毫秒表示。", "solution": "题目要求找到最小的最坏情况交互式延迟界限 $\\lambda$，使得存在一个可行的标签页交换选择。一个选择如果同时满足内存容量约束和延迟约束，则为可行的。我们将首先形式化这些约束和优化目标，然后系统地确定最小的 $\\lambda$。\n\n令所有标签页的集合为 $\\mathcal{T} = \\{1, 2, 3, 4, 5, 6, 7\\}$。交互式标签页的集合为 $\\mathcal{I}=\\{1,2,3\\}$，非交互式标签页的集合为 $\\mathcal{N}=\\{4,5,6,7\\}$。令 $s_i$ 为标签页 $i$ 的工作集大小。\n我们为每个标签页 $i \\in \\mathcal{T}$ 定义一个二进制决策变量 $x_i$：\n如果标签页 $i$ 保持驻留在物理内存中，则 $x_i = 1$。\n如果标签页 $i$ 被换出到二级存储，则 $x_i = 0$。\n\n一个选择（由值集合 $\\{x_i\\}_{i=1}^7$ 表示）的可行性由两个条件决定：\n\n1.  **内存约束**：所有驻留标签页的总大小加上操作系统开销 $S_{\\text{sys}}$，不得超过物理内存容量 $M$。\n    $$ \\sum_{i=1}^{7} x_i s_i + S_{\\text{sys}} \\le M $$\n    代入给定值：$M=1850$ MB 和 $S_{\\text{sys}}=600$ MB。\n    $$ \\sum_{i=1}^{7} x_i s_i + 600 \\le 1850 $$\n    $$ \\sum_{i=1}^{7} x_i s_i \\le 1250 $$\n    这个不等式表明，所有保留在内存中的标签页的工作集大小之和不得超过 $1250$ MB。\n    表达此约束的另一种方式是根据被换出的标签页。所有标签页的总工作集大小为：\n    $$ \\sum_{i=1}^{7} s_i = (620+420+260) + (550+480+320+190) = 1300 + 1540 = 2840 \\text{ MB} $$\n    令 $\\mathcal{S}$ 为被换出标签页的索引集合，即 $\\mathcal{S} = \\{i \\mid x_i=0\\}$。驻留大小之和为 $\\sum_{i \\notin \\mathcal{S}} s_i = (\\sum_{i=1}^7 s_i) - \\sum_{i \\in \\mathcal{S}} s_i$。内存约束变为：\n    $$ \\left(\\sum_{i=1}^{7} s_i\\right) - \\sum_{i \\in \\mathcal{S}} s_i \\le M - S_{\\text{sys}} $$\n    $$ 2840 - \\sum_{i \\in \\mathcal{S}} s_i \\le 1250 $$\n    $$ \\sum_{i \\in \\mathcal{S}} s_i \\ge 2840 - 1250 = 1590 $$\n    因此，为满足内存约束，被换出标签页的总大小必须至少为 $1590$ MB。\n\n2.  **延迟约束**：对于任何被换出的交互式标签页 $i \\in \\mathcal{I}$ ($x_i=0$)，其访问延迟 $t_i$ 必须严格小于界限 $\\lambda$。\n    $$ t_i  \\lambda \\quad \\forall i \\in \\mathcal{I} \\text{ such that } x_i=0 $$\n    这等价于要求 $\\lambda  \\max \\{t_i \\mid i \\in \\mathcal{I} \\cap \\mathcal{S}\\}$。如果没有交互式标签页被换出 ($\\mathcal{I} \\cap \\mathcal{S} = \\emptyset$)，则对于任何 $\\lambda  0$ 该条件都满足。延迟 $t_i$ 由 $t_i=\\delta+\\frac{s_i}{B}\\times 10^3$ 给出。当 $\\delta=10$ 毫秒且 $B=200$ MB/s 时，交互式标签页的延迟为：\n    $t_1 = 10 + \\frac{620}{200} \\times 1000 = 10 + 3.1 \\times 1000 = 3110$ 毫秒。\n    $t_2 = 10 + \\frac{420}{200} \\times 1000 = 10 + 2.1 \\times 1000 = 2110$ 毫秒。\n    $t_3 = 10 + \\frac{260}{200} \\times 1000 = 10 + 1.3 \\times 1000 = 1310$ 毫秒。\n    注意，$s_1  s_2  s_3$ 意味着 $t_1  t_2  t_3$。\n\n目标是找到存在可行选择 $\\{x_i\\}$ 的 $\\lambda$ 的最小值。这是一个类背包问题，我们必须选择一个要换出的标签页集合 $\\mathcal{S}$，以满足最小总大小约束（$\\ge 1590$ MB），同时最小化成本函数 $L(\\mathcal{S}) = \\max (\\{t_i \\mid i \\in \\mathcal{I} \\cap \\mathcal{S}\\} \\cup \\{0\\})$。最小的 $\\lambda$ 将是允许的 $\\lambda$ 值集合的下确界，这对应于这个最小可能的成本。\n\n我们可以通过按延迟成本递增的顺序考虑各种情景来解决这个问题。\n\n**情景 1：没有交互式标签页被换出。**\n在这种情况下，$\\mathcal{S} \\subseteq \\mathcal{N}$。可以释放的最大内存是所有非交互式标签页的大小之和：\n$$ \\sum_{i \\in \\mathcal{N}} s_i = s_4+s_5+s_6+s_7 = 550+480+320+190 = 1540 \\text{ MB} $$\n所需的交换大小为 $1590$ MB。由于 $1540  1590$，仅通过交换非交互式标签页无法满足内存约束。因此，必须至少换出一个交互式标签页。这意味着最小最坏情况延迟将大于 $0$。\n\n**情景 2：延迟最低的交互式标签页，即标签页 3，被换出。**\n这个情景探讨是否存在一个可行解，其中最大延迟由 $t_3$ 决定。为了达到最小的延迟界限，我们必须尽可能避免交换标签页 1 和 2。让我们测试一个选择的可行性，其中被换出的交互式标签页集合恰好是 $\\{3\\}$。所产生的最大延迟将是 $t_3 = 1310$ 毫秒。\n要使此配置有效，我们必须能够满足内存约束。\n通过交换标签页 3 释放的大小是 $s_3 = 260$ MB。\n通过交换非交互式标签页需要释放的剩余大小是 $1590 - 260 = 1330$ MB。\n所有非交互式标签页的总大小是 $1540$ MB。由于 $1540 \\ge 1330$，可以选择一个非交互式标签页的子集进行交换，使其大小总和至少为 $1330$ MB。例如，我们可以交换所有非交互式标签页 $\\{4, 5, 6, 7\\}$，这将释放 $1540$ MB 的内存。\n因此，一个可行的选择是 $\\mathcal{S}=\\{3, 4, 5, 6, 7\\}$。总交换大小为 $s_3+s_4+s_5+s_6+s_7 = 260+1540 = 1800$ MB，这 $\\ge 1590$ MB。\n对于这个选择，被换出的交互式标签页集合是 $\\{3\\}$，最大延迟是 $t_3 = 1310$ 毫秒。延迟约束要求 $\\lambda  1310$ 毫秒。\n这证实了对于任何 $\\lambda  1310$ 都存在一个可行的配置。\n\n**关于最小 $\\lambda$ 的结论**\n我们已经确定了两个关键点：\n1.  必须交换至少一个交互式标签页。这意味着最小延迟成本必须至少是所有交互式标签页中最小的延迟，即 $t_3 = 1310$ 毫秒。\n2.  存在一个可行配置，其中被换出的交互式标签页中的最大延迟恰好是 $t_3 = 1310$ 毫秒。\n\n任何其他情景，例如交换标签页 2（延迟 $t_2=2110$ 毫秒）或标签页 1（延迟 $t_1=3110$ 毫秒），都会导致更高的最大延迟，因此需要一个更大的 $\\lambda$。因此，最坏情况交互式延迟的最小可能值为 $t_3$。\n\n$\\lambda$ 的最小值是所有可能有效界限集合的最大下界（下确界）。由于存在一个最大交互延迟为 $1310$ 毫秒的可行选择，任何 $\\lambda > 1310$ 毫秒都是一个有效的界限。集合 $(\\text{1310}, \\infty)$ 的下确界是 $1310$。\n\n最终数值答案是 $1310$ 毫秒。题目要求四舍五入到四位有效数字。由于计算出的值是一个精确整数 $1310$，这可以表示为 $1.310 \\times 10^3$，它有四位有效数字。", "answer": "$$\\boxed{1310}$$", "id": "3685404"}, {"introduction": "我们已经探讨了何时会发生颠簸以及如何从应用角度做出优化决策。现在，让我们深入操作系统内核，思考如何设计一个自动化的、公平的页面置换策略 [@problem_id:3685374]。这个练习模拟了一个真实的挑战：在匿名页面（anonymous pages）和文件支持页面（file-backed pages）之间公平地分配回收压力，因为它们被换出和重新读入的成本并不相同。", "problem": "操作系统（OS）通过驱逐文件支持页（可以被丢弃并从文件系统重新读取）或匿名页（必须写入交换区然后稍后读回）来管理物理内存，这个过程被称为交换（swapping）。为了在内存压力下推理这两类页面之间的公平性，我们考虑一个在离散控制窗口中运行的控制器，它设置一个扫描共享参数 $\\theta \\in [0,1]$。该参数被解释为用于匿名页的驱逐工作量的比例，而剩余的 $1-\\theta$ 则用于文件支持页。我们假设，在一个给定的控制窗口内，每类页面的驱逐数量与扫描共享比例近似成正比，这是一个在分页系统中广泛使用的经验性观察。此外，由于匿名页的换入/换出涉及更高的输入/输出（I/O）成本，我们在公平性评估中给予匿名页的驱逐更高的权重。\n\n为单个控制窗口定义以下内容：\n- $E_{f}$ 和 $E_{a}$：分别是在该窗口内测得的文件支持页和匿名页的驱逐次数。\n- $R_{f}$ 和 $R_{a}$：分别是在该窗口开始时驻留的文件支持页和匿名页的数量。\n- $w_{f}$ 和 $w_{a}$：非负权重，分别表示文件支持页和匿名页的单次驱逐重新填充成本，其中 $w_{a}  w_{f}$ 反映了匿名页的回收和稍后重新填充成本更高。\n- 公平性度量 $\\mathcal{F}$ 定义为每个驻留页的成本加权驱逐率之比：\n$$\n\\mathcal{F} \\;=\\; \\frac{ \\dfrac{E_{f}}{w_{f} R_{f}} }{ \\dfrac{E_{a}}{w_{a} R_{a}} } \\, .\n$$\n公平性目标是 $\\mathcal{F} \\approx 1$，这意味着，在考虑了每个驻留页和成本权重后，每个类别承受的驱逐压力相当。\n\n给定当前窗口在 $\\theta_{\\text{old}} = 0.3$ 下的以下测量值：$E_{f} = 1200$，$E_{a} = 400$，$R_{f} = 6000$，$R_{a} = 4000$，$w_{f} = 1$，$w_{a} = 2$。对于下一个窗口，预计总驱逐需求 $E_{\\text{tot}}$ 将大致保持不变，并且假设控制器的扫描共享设置 $\\theta$ 通过 $E_{a} \\approx \\theta \\, E_{\\text{tot}}$ 和 $E_{f} \\approx (1-\\theta)\\, E_{\\text{tot}}$ 决定预期的驱逐次数。\n\n在所述的比例模型下，控制器应为下一个窗口使用哪种 $\\theta$ 的更新规则，以使 $\\mathcal{F}$ 约等于 $1$？\n\nA. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} \\cdot \\sqrt{\\mathcal{F}}\\big)\\big)$。\n\nB. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} / \\sqrt{\\mathcal{F}}\\big)\\big)$。\n\nC. 设置 $\\theta_{\\text{new}} = \\min\\!\\Big(1,\\max\\!\\Big(0, \\dfrac{w_{a} R_{a}}{\\,w_{a} R_{a} + w_{f} R_{f}\\,}\\Big)\\Big)$。\n\nD. 保持 $\\theta$ 不变：$\\theta_{\\text{new}} = \\theta_{\\text{old}}$。\n\n请准确选择一个选项。", "solution": "用户希望我扮演一位严谨的理工科教授，解决这个关于操作系统内存管理控制器的问题。\n\n### 问题验证\n\n首先，我必须验证问题陈述。\n\n**第 1 步：提取已知条件**\n\n- **控制参数**：$\\theta \\in [0,1]$，用于匿名页的驱逐工作量的比例。\n- **系统模型**：\n    - 文件支持页的驱逐工作量为 $1-\\theta$。\n    - 驱逐数量与扫描共享比例近似成正比。\n    - 对于下一个控制窗口，该模型具体为：\n        - $E_{a} \\approx \\theta \\, E_{\\text{tot}}$\n        - $E_{f} \\approx (1-\\theta)\\, E_{\\text{tot}}$\n        其中 $E_{\\text{tot}}$ 是总驱逐次数，假定为常数。\n- **定义**：\n    - $E_{f}, E_{a}$：文件支持页和匿名页的驱逐次数。\n    - $R_{f}, R_{a}$：窗口开始时驻留的文件支持页和匿名页的数量。\n    - $w_{f}, w_{a}$：重新填充成本的非负权重，其中 $w_{a}  w_{f}$。\n- **公平性度量**：$\\mathcal{F} \\;=\\; \\frac{ \\frac{E_{f}}{w_{f} R_{f}} }{ \\frac{E_{a}}{w_{a} R_{a}} }$。\n- **目标**：设置 $\\theta_{\\text{new}}$，使得下一个窗口的公平性度量 $\\mathcal{F}_{\\text{new}}$ 约等于 $1$。\n- **来自当前（旧）窗口的数据**：\n    - $\\theta_{\\text{old}} = 0.3$\n    - $E_{f} = 1200$\n    - $E_{a} = 400$\n    - $R_{f} = 6000$\n    - $R_{a} = 4000$\n    - $w_{f} = 1$\n    - $w_{a} = 2$\n\n**第 2 步：使用提取的已知条件进行验证**\n\n- **科学依据**：该问题在操作系统设计原理，特别是内存管理和分页策略方面有充分的依据。使用基于成本或比例的控制器来平衡不同类型内存（匿名页与文件支持页）之间的驱逐压力的概念是一种真实世界的技术（例如，在 Linux 内核中可见）。该模型是对此类控制问题的简化但有效的表示。\n- **适定性**：该问题是适定的。它提供了所有必要的变量，一个清晰的控制器效应数学模型，以及一个具体的目标（$\\mathcal{F}_{\\text{new}} \\approx 1$）。从这些组件推导出一个唯一的控制律是可能的。\n- **客观性**：问题以客观、正式的语言陈述。\n- **一致性检查**：我们可以检查旧窗口提供的数据与比例模型的一致性。\n    - 总驱逐次数：$E_{\\text{tot}} = E_f + E_a = 1200 + 400 = 1600$。\n    - 模型对 $E_a$ 的预测：$\\theta_{\\text{old}} E_{\\text{tot}} = 0.3 \\times 1600 = 480$。这与测量的 $E_a = 400$ 不同。\n    - 模型对 $E_f$ 的预测：$(1-\\theta_{\\text{old}}) E_{\\text{tot}} = 0.7 \\times 1600 = 1120$。这与测量的 $E_f = 1200$ 不同。\n    问题陈述明确指出比例关系是一个*近似*（“近似成正比”、“预期的驱逐次数 ... 通过 $E_a \\approx \\theta E_{tot}$”）。模型与过去数据之间的差异反映了这是一个复杂系统的简化模型，这在控制工程中是现实情况。任务是使用*陈述的模型*来确定*下一个*控制动作，而不是验证模型的过去性能。因此，该问题并非自相矛盾，而是提出了一个现实的建模挑战。\n\n**第 3 步：结论与行动**\n\n该问题是**有效的**。这是一个标准的、尽管简化的控制理论问题，应用于操作系统中的一个相关主题。我现在将进行求解。\n\n### 解题推导\n\n目标是找到一个 $\\theta$ 的更新规则，使得下一个控制窗口中的公平性度量 $\\mathcal{F}$ 约等于 $1$。设 $\\theta$ 的新值为 $\\theta_{\\text{new}}$。\n\n目标是 $\\mathcal{F}_{\\text{new}} \\approx 1$。为了推导，我们将目标定为精确值 $\\mathcal{F}_{\\text{new}} = 1$。\n公平性度量的定义是：\n$$ \\mathcal{F}_{\\text{new}} = \\frac{ \\dfrac{E_{f, \\text{new}}}{w_{f} R_{f, \\text{new}}} }{ \\dfrac{E_{a, \\text{new}}}{w_{a} R_{a, \\text{new}}} } $$\n设置 $\\mathcal{F}_{\\text{new}} = 1$ 得到完美公平的条件：\n$$ \\frac{E_{f, \\text{new}}}{w_{f} R_{f, \\text{new}}} = \\frac{E_{a, \\text{new}}}{w_{a} R_{a, \\text{new}}} $$\n\n问题陈述我们必须使用比例模型来确定下一个窗口的预期驱逐次数：\n-   $E_{a, \\text{new}} = \\theta_{\\text{new}} E_{\\text{tot}}$\n-   $E_{f, \\text{new}} = (1-\\theta_{\\text{new}}) E_{\\text{tot}}$\n\n这里，$E_{\\text{tot}}$ 是总驱逐需求，假定为常数。$R_{f, \\text{new}}$ 和 $R_{a, \\text{new}}$ 是下一个窗口开始时的驻留页数。\n\n将模型代入公平性条件：\n$$ \\frac{(1-\\theta_{\\text{new}}) E_{\\text{tot}}}{w_{f} R_{f, \\text{new}}} = \\frac{\\theta_{\\text{new}} E_{\\text{tot}}}{w_{a} R_{a, \\text{new}}} $$\n由于 $E_{\\text{tot}}$ 是一个非零常数，它可以从两边消去：\n$$ \\frac{1-\\theta_{\\text{new}}}{w_{f} R_{f, \\text{new}}} = \\frac{\\theta_{\\text{new}}}{w_{a} R_{a, \\text{new}}} $$\n现在我们求解 $\\theta_{\\text{new}}$：\n$$ (1-\\theta_{\\text{new}}) w_{a} R_{a, \\text{new}} = \\theta_{\\text{new}} w_{f} R_{f, \\text{new}} $$\n$$ w_{a} R_{a, \\text{new}} - \\theta_{\\text{new}} w_{a} R_{a, \\text{new}} = \\theta_{\\text{new}} w_{f} R_{f, \\text{new}} $$\n$$ w_{a} R_{a, \\text{new}} = \\theta_{\\text{new}} (w_{f} R_{f, \\text{new}} + w_{a} R_{a, \\text{new}}) $$\n$$ \\theta_{\\text{new}} = \\frac{w_{a} R_{a, \\text{new}}}{w_{f} R_{f, \\text{new}} + w_{a} R_{a, \\text{new}}} $$\n\n这个方程代表了为实现公平性目标而设置 $\\theta$ 的基本原则。控制器应该将 $\\theta$ 设置为成本加权的匿名驻留页与总成本加权的驻留页的比率。\n\n### 逐项分析\n\n现在我将评估每个选项。一个更新规则理想情况下应基于上述推导出的原则。\n\n**C. 设置 $\\theta_{\\text{new}} = \\min\\!\\Big(1,\\max\\!\\Big(0, \\dfrac{w_{a} R_{a}}{\\,w_{a} R_{a} + w_{f} R_{f}\\,}\\Big)\\Big)$。**\n\n该选项的公式 $\\dfrac{w_{a} R_{a}}{w_{a} R_{a} + w_{f} R_{f}}$ 与我推导出的公式在功能上是相同的。公式中的变量 $R_a$ 和 $R_f$ 应被解释为为之设置 $\\theta$ 的窗口开始时的值。使用 $\\min(1, \\max(0, ...))$ 是控制系统中的标准做法，以确保输出保持在有效范围 $[0,1]$ 内，这是一种鲁棒性的措施。此规则是为实现 $\\mathcal{F}=1$ 而推导出的原则的直接实现。\n\n因此，此选项代表了正确的、基于原理的更新规则。控制器应该测量或估计即将到来的 $R_f$ 和 $R_a$ 并应用此公式。\n\n**结论：正确**\n\n**D. 保持 $\\theta$ 不变：$\\theta_{\\text{new}} = \\theta_{\\text{old}}$。**\n\n要检查这是否正确，我们必须计算旧窗口的公平性度量 $\\mathcal{F}_{\\text{old}}$。\n$$ \\mathcal{F}_{\\text{old}} = \\frac{ \\dfrac{E_{f}}{w_{f} R_{f}} }{ \\dfrac{E_{a}}{w_{a} R_{a}} } = \\frac{ \\dfrac{1200}{1 \\cdot 6000} }{ \\dfrac{400}{2 \\cdot 4000} } = \\frac{ \\dfrac{1200}{6000} }{ \\dfrac{400}{8000} } = \\frac{0.2}{0.05} = 4 $$\n由于 $\\mathcal{F}_{\\text{old}} = 4 \\neq 1$，系统不处于公平状态。目标是使 $\\mathcal{F}_{\\text{new}} \\approx 1$。保持 $\\theta$ 不变不会主动纠正这种不平衡。因此，此选项不正确。\n\n**结论：不正确**\n\n**B. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} / \\sqrt{\\mathcal{F}}\\big)\\big)$。**\n\n让我们分析这个控制律的方向。我们有 $\\mathcal{F}_{\\text{old}} = 4$，大于 $1$。这表明与匿名页相比，文件支持页上的成本加权驱逐压力过高。为了纠正这一点，控制器必须增加对匿名页的压力，这意味着增加 $E_a$。根据模型 $E_a \\approx \\theta E_{\\text{tot}}$，这需要增加 $\\theta$。\n这个规则提议 $\\theta_{\\text{new}} = \\theta_{\\text{old}} / \\sqrt{\\mathcal{F}_{\\text{old}}}$。使用 $\\theta_{\\text{old}}=0.3$ 和 $\\mathcal{F}_{\\text{old}}=4$，我们得到：\n$$ \\theta_{\\text{new}} = 0.3 / \\sqrt{4} = 0.3 / 2 = 0.15 $$\n这个规则在应该增加 $\\theta$ 的时候*减少*了它。控制动作的方向是错误的。\n\n**结论：不正确**\n\n**A. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} \\cdot \\sqrt{\\mathcal{F}}\\big)\\big)$。**\n\n这个规则提议 $\\theta_{\\text{new}} = \\theta_{\\text{old}} \\cdot \\sqrt{\\mathcal{F}_{\\text{old}}}$。使用给定数据，这会得到：\n$$ \\theta_{\\text{new}} = 0.3 \\cdot \\sqrt{4} = 0.3 \\cdot 2 = 0.6 $$\n这是一个方向正确的反馈控制律（当 $\\mathcal{F}1$ 时它会增加 $\\theta$）。然而，它是一种启发式方法。它不是从系统模型和公平性目标推导出来的。虽然这种乘法更新规则可能有效，但不能保证它们能一步达到目标。选项 C 中的规则是直接推导出的，作为给定模型下的一步解决方案。问题要求控制器*应该*使用哪种规则来使 $\\mathcal{F} \\approx 1$。从分析上推导出能精确做到这一点的规则（选项 C）是比一个未经证实的启发式方法（选项 A）更合适和更有原则的选择，即使该启发式方法为提供的特定数据产生了合理数值结果。科学或工程问题的核心是识别其基本原理，而这正是选项 C 所代表的。\n\n**结论：不正确**\n\n最严谨和基于原理的答案是直接从问题的模型和目标推导出的那个，即选项 C。它描述了实现期望公平性输出（$\\mathcal{F}=1$）所需的系统状态（$R_f, R_a, w_f, w_a$）和控制输入（$\\theta$）之间的基本关系。", "answer": "$$\\boxed{C}$$", "id": "3685374"}]}