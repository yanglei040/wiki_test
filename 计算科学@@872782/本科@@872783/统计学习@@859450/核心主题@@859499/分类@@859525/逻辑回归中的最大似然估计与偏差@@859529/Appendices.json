{"hands_on_practices": [{"introduction": "偏差（Deviance）是衡量逻辑回归模型拟合优度的关键指标。为了真正理解它，我们首先需要将其分解为基本组成部分。这个练习 [@problem_id:3147524] 将指导你从基本定义出发，推导出总偏差是如何由每个观测值的贡献相加而成，这一概念对于模型诊断至关重要。", "problem": "考虑一个通过最大似然估计 (MLE) 拟合的二元响应逻辑斯蒂回归模型。设观测响应为 $\\{y_{i}\\}_{i=1}^{n}$，其中 $y_{i}\\in\\{0,1\\}$，拟合概率为 $\\{\\hat{p}_{i}\\}_{i=1}^{n}$，其中每个 $y_{i}$ 被建模为条件独立的 $\\operatorname{Bernoulli}(\\hat{p}_{i})$。从伯努利对数似然的定义以及偏差（deviance）的定义出发，即偏差是饱和模型对数似然与拟合模型对数似然之差的两倍。仅使用这些定义，推导出一个表达式，表明偏差是各观测特定项之和。然后，使用您推导出的表达式，为以下八个观测值计算总偏差：\n$$\n\\begin{aligned}\ny_{1}=1,\\ \\hat{p}_{1}=0.84;\\quad y_{2}=0,\\ \\hat{p}_{2}=0.15;\\quad y_{3}=1,\\ \\hat{p}_{3}=0.62;\\\\\ny_{4}=0,\\ \\hat{p}_{4}=0.80;\\quad y_{5}=1,\\ \\hat{p}_{5}=0.30;\\quad y_{6}=0,\\ \\hat{p}_{6}=0.25;\\\\\ny_{7}=1,\\ \\hat{p}_{7}=0.95;\\quad y_{8}=0,\\ \\hat{p}_{8}=0.55.\n\\end{aligned}\n$$\n最后，设计一个诊断规则来标记具有最大逐点偏差贡献的观测值，确保最多标记 $k=2$ 个观测值，并将其应用于上述数据以确定哪些索引将被标记。将总偏差的最终数值四舍五入到四位有效数字。不涉及物理单位，且最终的数值答案必须是单个实数。", "solution": "问题陈述经评估有效。其科学依据在于统计学习的原理，特别是关于逻辑斯蒂回归和拟合优度度量。该问题提法明确，提供了推导所需表达式、计算数值结果和应用诊断规则所需的所有数据和定义。陈述中没有矛盾、歧义或事实错误。\n\n我们首先推导二元逻辑斯蒂回归模型中偏差的一般表达式。问题指出，偏差 $D$ 定义为饱和模型对数似然 $\\ell_{sat}$ 与拟合模型对数似然 $\\ell_{fit}$ 之差的两倍：\n$$\nD = 2(\\ell_{sat} - \\ell_{fit})\n$$\n观测值 $\\{y_i\\}_{i=1}^n$ 被建模为独立的伯努利试验，其中 $y_i \\in \\{0, 1\\}$。单个观测值 $Y_i$（参数为 $p_i$）的概率质量函数为 $P(Y_i=y_i) = p_i^{y_i}(1-p_i)^{1-y_i}$。因此，单个观测值的对数似然为 $\\ln(P(Y_i=y_i)) = y_i \\ln(p_i) + (1-y_i) \\ln(1-p_i)$。\n\n首先，我们确定拟合模型的对数似然 $\\ell_{fit}$。这是通过对各个对数似然求和得到的，使用拟合概率 $\\{\\hat{p}_i\\}_{i=1}^n$：\n$$\n\\ell_{fit} = \\sum_{i=1}^{n} \\left[ y_i \\ln(\\hat{p}_i) + (1 - y_i) \\ln(1 - \\hat{p}_i) \\right]\n$$\n接下来，我们确定饱和模型的对数似然 $\\ell_{sat}$。饱和模型是能完美拟合数据的模型。对于伯努利观测值 $y_i$，如果模型的概率等于其结果，则达到完美拟合。也就是说，饱和模型的概率参数 $p_i^{sat}$ 等于 $y_i$。\n$$\np_i^{sat} = y_i\n$$\n因此，饱和模型的对数似然为：\n$$\n\\ell_{sat} = \\sum_{i=1}^{n} \\left[ y_i \\ln(p_i^{sat}) + (1 - y_i) \\ln(1 - p_i^{sat}) \\right] = \\sum_{i=1}^{n} \\left[ y_i \\ln(y_i) + (1 - y_i) \\ln(1 - y_i) \\right]\n$$\n我们必须计算此和中的各项。\n- 如果 $y_i=1$，则该项为 $1 \\ln(1) + (1-1) \\ln(1-1) = \\ln(1) + 0 \\ln(0) = 0$。\n- 如果 $y_i=0$，则该项为 $0 \\ln(0) + (1-0) \\ln(1-0) = 0 \\ln(0) + \\ln(1) = 0$。\n在这两种情况下，我们都使用了 $\\lim_{x\\to 0^+} x \\ln(x) = 0$ 这一事实。因此，$\\ell_{sat}$ 求和式中的每一项都为零，这意味着饱和模型的总对数似然为零：\n$$\n\\ell_{sat} = 0\n$$\n将 $\\ell_{sat}$ 和 $\\ell_{fit}$ 的表达式代入偏差的定义中，得到：\n$$\nD = 2 \\left( 0 - \\sum_{i=1}^{n} \\left[ y_i \\ln(\\hat{p}_i) + (1-y_i) \\ln(1-\\hat{p}_i) \\right] \\right)\n$$\n$$\nD = -2 \\sum_{i=1}^{n} \\left[ y_i \\ln(\\hat{p}_i) + (1 - y_i) \\ln(1 - \\hat{p}_i) \\right]\n$$\n该表达式表明偏差是各观测特定项之和。第 $i$ 个观测对总偏差的贡献，我们可以称之为逐点偏差 $d_i$，是：\n$$\nd_i = -2 \\left[ y_i \\ln(\\hat{p}_i) + (1 - y_i) \\ln(1 - \\hat{p}_i) \\right]\n$$\n该表达式根据 $y_i$ 的值可以简化：\n- 如果 $y_i=1$，则 $d_i = -2 \\ln(\\hat{p}_i)$。\n- 如果 $y_i=0$，则 $d_i = -2 \\ln(1-\\hat{p}_i)$。\n\n现在，我们通过计算每个 $d_i$ 并将它们相加，来计算给定的 $n=8$ 个观测值的总偏差。\n$d_1$: 对于 $y_1=1, \\hat{p}_1=0.84$，$d_1 = -2 \\ln(0.84) \\approx 0.34870$\n$d_2$: 对于 $y_2=0, \\hat{p}_2=0.15$，$d_2 = -2 \\ln(1-0.15) = -2 \\ln(0.85) \\approx 0.32504$\n$d_3$: 对于 $y_3=1, \\hat{p}_3=0.62$，$d_3 = -2 \\ln(0.62) \\approx 0.95607$\n$d_4$: 对于 $y_4=0, \\hat{p}_4=0.80$，$d_4 = -2 \\ln(1-0.80) = -2 \\ln(0.20) \\approx 3.21888$\n$d_5$: 对于 $y_5=1, \\hat{p}_5=0.30$，$d_5 = -2 \\ln(0.30) \\approx 2.40795$\n$d_6$: 对于 $y_6=0, \\hat{p}_6=0.25$，$d_6 = -2 \\ln(1-0.25) = -2 \\ln(0.75) \\approx 0.57536$\n$d_7$: 对于 $y_7=1, \\hat{p}_7=0.95$，$d_7 = -2 \\ln(0.95) \\approx 0.10258$\n$d_8$: 对于 $y_8=0, \\hat{p}_8=0.55$，$d_8 = -2 \\ln(1-0.55) = -2 \\ln(0.45) \\approx 1.59702$\n\n总偏差是和 $D = \\sum_{i=1}^{8} d_i$：\n$$\nD \\approx 0.34870 + 0.32504 + 0.95607 + 3.21888 + 2.40795 + 0.57536 + 0.10258 + 1.59702\n$$\n$$\nD \\approx 9.53160\n$$\n四舍五入到四位有效数字，总偏差为 $9.532$。\n\n最后，我们设计并应用诊断规则。该规则是标记具有最大逐点偏差贡献的观测值，最多标记 $k=2$ 个。这需要将各个偏差贡献 $d_i$ 按降序排列，并选择前两个。\n计算出的逐点偏差为：\n$d_4 \\approx 3.21888$\n$d_5 \\approx 2.40795$\n$d_8 \\approx 1.59702$\n$d_3 \\approx 0.95607$\n$d_6 \\approx 0.57536$\n$d_1 \\approx 0.34870$\n$d_2 \\approx 0.32504$\n$d_7 \\approx 0.10258$\n\n最大的两个值是 $d_4$ 和 $d_5$。它们对应于索引为 $4$ 和 $5$ 的观测值。因此，该诊断规则将标记观测值 $y_4$ 和 $y_5$。这些大的偏差贡献之所以产生，是因为模型为一个观测到的失败（$y_4=0$）赋予了高的成功概率（$\\hat{p}_4=0.80$），并为一个观测到的成功（$y_5=1$）赋予了低的成功概率（$\\hat{p}_5=0.30$）。\n\n所要求的最终数值答案是四舍五入到四位有效数字的总偏差。", "answer": "$$\n\\boxed{9.532}\n$$", "id": "3147524"}, {"introduction": "在我们理解了偏差的计算之后，区分模型的概率拟合度与分类性能变得至关重要。这项练习 [@problem_id:3147489] 探讨了改变决策阈值如何影响分类错误，但模型的内在偏差却保持不变。这突显了模型评估（基于概率）与策略决策（基于分类）之间的根本区别。", "problem": "考虑一个由逻辑斯蒂回归建模的二元结果设定，其中对于每个观测 $i \\in \\{1,2,\\dots,n\\}$，其特征为 $\\mathbf{x}_i$，模型为 $Y_i=1$ 生成一个拟合概率 $p_i \\in (0,1)$。参数 $\\boldsymbol{\\beta}$ 的伯努利似然 $L(\\boldsymbol{\\beta})$ 定义为模型下观测数据的概率，对数似然为 $\\log L(\\boldsymbol{\\beta})$。残差偏离度定义为拟合模型与饱和模型似然比的对数的 $-2$ 倍，其中饱和模型是能完美拟合观测数据的模型。决策规则使用一个阈值 $t \\in (0,1)$，将每个拟合概率 $p_i$ 映射到一个预测类别 $\\hat{y}_i(t) \\in \\{0,1\\}$，其中如果 $p_i \\ge t$，则 $\\hat{y}_i(t)=1$，否则 $\\hat{y}_i(t)=0$。\n\n给定来自单个逻辑斯蒂回归拟合的 $n=6$ 个观测，其观测结果和拟合概率如下：\n- $y = (y_1,y_2,y_3,y_4,y_5,y_6) = (1,1,0,1,0,0)$,\n- $p = (p_1,p_2,p_3,p_4,p_5,p_6) = (0.85,0.55,0.29,0.31,0.25,0.05)$。\n\n考虑两个决策阈值 $t_1=0.50$ 和 $t_2=0.30$。\n\n下列哪些陈述是正确的？\n\nA. 改变决策阈值不影响此固定逻辑斯蒂回归拟合的残差偏离度；对于上述数据，根据拟合概率计算出的残差偏离度约为 $5.23$，无论使用 $t=0.50$ 还是 $t=0.30$ 来做类别决策，该值都保持不变。\n\nB. 在 $t=0.50$ 下，错分计数为 $1$；而在 $t=0.30$ 下，错分计数为 $0$。\n\nC. 对于任何固定的阈值 $t$，最小化错分计数等价于最大化逻辑斯蒂回归的伯努利似然（从而最小化偏离度）。\n\nD. 当错分成本非对称时，最优决策规则使用的阈值 $t^{\\ast}$ 取决于成本比，而最大似然估计（MLE）拟合及其偏离度保持与阈值无关；因此，通过偏离度进行模型评估和通过阈值设定进行策略决策是可分离的。\n\nE. 降低阈值必然会减小偏离度，因为它使得更多的正向预测与真正的正例对齐。\n\n选择所有适用的选项。", "solution": "用户要求对问题陈述进行严格验证，然后通过详细的解决方案推导出正确答案并评估每个选项。\n\n### 问题验证\n\n**步骤1：提取给定信息**\n- 模型：针对二元结果 $Y_i \\in \\{0, 1\\}$ 的逻辑斯蒂回归。\n- 对于每个观测 $i \\in \\{1, 2, \\dots, n\\}$，模型产生一个拟合概率 $p_i = P(Y_i=1 | \\mathbf{x}_i)$。\n- 残差偏离度定义为拟合模型与饱和模型似然比的对数的 $-2$ 倍。饱和模型能完美拟合数据。\n- 决策规则：对于一个阈值 $t \\in (0,1)$，如果 $p_i \\ge t$，则预测类别为 $\\hat{y}_i(t) = 1$，如果 $p_i  t$，则 $\\hat{y}_i(t) = 0$。\n- 样本量：$n = 6$。\n- 观测结果：$y = (y_1, y_2, y_3, y_4, y_5, y_6) = (1, 1, 0, 1, 0, 0)$。\n- 拟合概率：$p = (p_1, p_2, p_3, p_4, p_5, p_6) = (0.85, 0.55, 0.29, 0.31, 0.25, 0.05)$。\n- 待考虑的决策阈值：$t_1 = 0.50$ 和 $t_2 = 0.30$。\n\n**步骤2：使用提取的给定信息进行验证**\n- **科学依据：** 问题基于统计学习的标准理论，特别是逻辑斯蒂回归、最大似然估计、偏离度和分类阈值。所有提供的定义都是标准的。\n- **定义明确：** 问题提供了评估陈述所需的所有数据（$y$, $p$, $t_1$, $t_2$）和清晰的定义。可以进行唯一的分析。\n- **客观性：** 语言正式且无歧义。问题涉及可验证的数学和统计属性。\n- **缺陷检查：** 问题陈述没有列出的缺陷。\n    - 它不违反任何科学原理。数据点 $(y_4=1, p_4=0.31)$，即模型为一个已发生的事件赋予了低概率，这代表了模型误差，是统计建模中的一个现实特征。\n    - 这是一个在其领域内的正式问题。\n    - 设定是完整和一致的。\n    - 数据对于小样本问题是合理的。\n\n**步骤3：结论和行动**\n问题陈述是有效的。我将继续进行解决方案和逐项分析。\n\n---\n\n### 解决方案推导\n\n问题的核心在于区分模型的拟合优度（通过似然和偏离度衡量）和其分类性能（通过错分计数等依赖于所选决策阈值的指标衡量）。\n\n对于一组 $n$ 个独立观测，逻辑斯蒂回归模型的对数似然为：\n$$ \\ell(\\boldsymbol{\\beta}) = \\sum_{i=1}^n \\left[ y_i \\log(p_i) + (1-y_i) \\log(1-p_i) \\right] $$\n其中 $p_i$ 是拟合概率，它们是模型参数 $\\boldsymbol{\\beta}$ 的函数。\n\n饱和模型是一个假设能完美拟合数据的模型，意味着其对数似然为 $0$。拟合模型的残差偏离度定义为：\n$$ D = -2 \\times (\\ell(\\text{fitted model}) - \\ell(\\text{saturated model})) = -2 \\ell(\\text{fitted model}) $$\n$$ D = -2 \\sum_{i=1}^n \\left[ y_i \\log(p_i) + (1-y_i) \\log(1-p_i) \\right] $$\n关键是，偏离度 $D$ 仅取决于真实结果 $y_i$ 和拟合概率 $p_i$。它不依赖于任何决策阈值 $t$。\n\n### 逐项分析\n\n**A. 改变决策阈值不影响此固定逻辑斯蒂回归拟合的残差偏离度；对于上述数据，根据拟合概率计算出的残差偏离度约为 $5.23$，无论使用 $t=0.50$ 还是 $t=0.30$ 来做类别决策，该值都保持不变。**\n\n陈述的第一部分，“改变决策阈值不影响残差偏离度”，根据定义是正确的。偏离度是基于最大似然估计（MLE）过程产生的概率 $p_i$ 的拟合度量，该过程不涉及阈值。阈值是作为一个独立的后续步骤应用于进行类别预测的。\n\n我们来验证一下计算。\n给定 $y = (1, 1, 0, 1, 0, 0)$ 和 $p = (0.85, 0.55, 0.29, 0.31, 0.25, 0.05)$。\n对数似然为：\n$$ \\ell = \\log(0.85) + \\log(0.55) + \\log(1-0.29) + \\log(0.31) + \\log(1-0.25) + \\log(1-0.05) $$\n$$ \\ell = \\log(0.85) + \\log(0.55) + \\log(0.71) + \\log(0.31) + \\log(0.75) + \\log(0.95) $$\n使用自然对数：\n$$ \\ell \\approx -0.162519 - 0.597837 - 0.342490 - 1.171182 - 0.287682 - 0.051293 \\approx -2.613003 $$\n偏离度为 $D = -2 \\times \\ell$：\n$$ D \\approx -2 \\times (-2.613003) \\approx 5.226006 $$\n这个值约等于 $5.23$。概念性论断和计算都是正确的。\n\n结论：**正确**。\n\n**B. 在 $t=0.50$ 下，错分计数为 $1$；而在 $t=0.30$ 下，错分计数为 $0$。**\n\n我们来计算每个阈值下的预测类别 $\\hat{y}$，并与真实结果 $y = (1, 1, 0, 1, 0, 0)$ 进行比较。拟合概率为 $p = (0.85, 0.55, 0.29, 0.31, 0.25, 0.05)$。\n\n- 对于阈值 $t_1 = 0.50$：\n规则是如果 $p_i \\ge 0.50$，则 $\\hat{y}_i = 1$。\n$p_1=0.85 \\ge 0.50 \\implies \\hat{y}_1=1$ (正确, $y_1=1$)\n$p_2=0.55 \\ge 0.50 \\implies \\hat{y}_2=1$ (正确, $y_2=1$)\n$p_3=0.29  0.50 \\implies \\hat{y}_3=0$ (正确, $y_3=0$)\n$p_4=0.31  0.50 \\implies \\hat{y}_4=0$ (错误, $y_4=1$)\n$p_5=0.25  0.50 \\implies \\hat{y}_5=0$ (正确, $y_5=0$)\n$p_6=0.05  0.50 \\implies \\hat{y}_6=0$ (正确, $y_6=0$)\n预测向量为 $\\hat{y}(0.50) = (1, 1, 0, 0, 0, 0)$。在索引 $4$ 处有一个不匹配。错分计数为 $1$。\n\n- 对于阈值 $t_2 = 0.30$：\n规则是如果 $p_i \\ge 0.30$，则 $\\hat{y}_i = 1$。\n$p_1=0.85 \\ge 0.30 \\implies \\hat{y}_1=1$ (正确, $y_1=1$)\n$p_2=0.55 \\ge 0.30 \\implies \\hat{y}_2=1$ (正确, $y_2=1$)\n$p_3=0.29  0.30 \\implies \\hat{y}_3=0$ (正确, $y_3=0$)\n$p_4=0.31 \\ge 0.30 \\implies \\hat{y}_4=1$ (正确, $y_4=1$)\n$p_5=0.25  0.30 \\implies \\hat{y}_5=0$ (正确, $y_5=0$)\n$p_6=0.05  0.30 \\implies \\hat{y}_6=0$ (正确, $y_6=0$)\n预测向量为 $\\hat{y}(0.30) = (1, 1, 0, 1, 0, 0)$。这与真实结果向量 $y$ 完全相同。错分计数为 $0$。\n\n该陈述是对两个计算的事实报告，两者都是正确的。\n\n结论：**正确**。\n\n**C. 对于任何固定的阈值 $t$，最小化错分计数等价于最大化逻辑斯蒂回归的伯努利似然（从而最小化偏离度）。**\n\n这个陈述从根本上是错误的。它混淆了两个不同的目标函数。\n1.  **最大化似然（最小化偏离度）：** 逻辑斯蒂回归的MLE的目标是找到参数 $\\boldsymbol{\\beta}$ 来最大化对数似然 $\\sum [y_i \\log(p_i) + (1-y_i) \\log(1-p_i)]$。这是关于概率 $p_i$（以及 $\\boldsymbol{\\beta}$）的连续可微函数。它提供了一个“软”的拟合度量，对置信度高的正确预测的奖励多于对边缘预测的奖励。这个优化过程不涉及阈值 $t$。\n2.  **最小化错分计数：** 这个目标函数 $\\sum I(y_i \\neq \\hat{y}_i(t))$ 是一个离散的、不可微的误差“硬”计数，它依赖于一个预先指定的阈值 $t$。\n通常情况下，最大化似然与在给定 $t$ 下最小化错分计数不会得到相同的解。本问题中的数据本身就证明了这一点：MLE拟合是固定的，但随着阈值的改变，错分计数从 $1$ 变为 $0$。\n\n结论：**错误**。\n\n**D. 当错分成本非对称时，最优决策规则使用的阈值 $t^{\\ast}$ 取决于成本比，而最大似然估计（MLE）拟合及其偏离度保持与阈值无关；因此，通过偏离度进行模型评估和通过阈值设定进行策略决策是可分离的。**\n\n这个陈述准确地描述了统计决策理论的一个关键原则。\n- **非对称成本下的最优阈值：** 设 $C_{10}$ 为假阳性（真实为 $0$ 却预测为 $1$）的成本， $C_{01}$ 为假阴性（真实为 $1$ 却预测为 $0$）的成本。为了最小化一个概率为 $p_i$ 的观测的期望成本，当预测为 $1$ 的期望成本小于预测为 $0$ 的期望成本时，应该预测为 $1$：$(1-p_i)C_{10}  p_iC_{01}$。这个不等式可以重排为 $p_i > \\frac{C_{10}}{C_{10} + C_{01}}$。最优阈值为 $t^{\\ast} = \\frac{C_{10}}{C_{10} + C_{01}}$，这显然取决于成本。\n- **MLE/偏离度的阈值无关性：** 正如在选项A的分析中确立的，MLE过程通过最大化似然函数来确定概率 $p_i$。这个过程独立于这些概率的任何后续使用，包括带有非对称成本的分类。偏离度只是这个最大化似然的一个变换。\n- **可分离性：** 结论是正确的。建立概率模型（MLE拟合）的任务与使用该模型进行决策（通过阈值进行策略决策）的任务是分开的。模型提供概率，而决策规则将成本和阈值应用于这些概率。这种分离是根本性的。\n\n结论：**正确**。\n\n**E. 降低阈值必然会减小偏离度，因为它使得更多的正向预测与真正的正例对齐。**\n\n这个陈述在两个层面上都是错误的。\n- 前提，“降低阈值必然会减小偏离度”，是错误的。正如反复强调的，一个已拟合模型的偏离度是一个固定量，不依赖于决策阈值。\n- 理由，“...因为它使得更多的正向预测与真正的正例对齐”，描述的是分类指标（如真阳性率或灵敏度）的变化，而不是模型偏离度的变化。虽然降低阈值确实会增加正向预测的数量，这可能增加真阳性的数量，但它对偏离度没有影响。该陈述将分类性能结果与基于似然的拟合优度度量混为一谈。\n\n结论：**错误**。", "answer": "$$\\boxed{ABD}$$", "id": "3147489"}]}