{"hands_on_practices": [{"introduction": "Metropolis 算法是 MCMC 方法的基石之一。其核心在于一个精巧的接受-拒绝步骤，该步骤通过一个特定的概率（接受概率）来决定是否采纳新的候选样本，从而确保生成的马尔可夫链最终能收敛到目标分布。这个练习将带你亲手计算接受概率，让你直观地理解算法的决策机制 [@problem_id:1371728]。", "problem": "一位数据科学家正在实现一个马尔可夫链蒙特卡洛（MCMC）模拟，以从参数 $x$ 的后验概率分布中抽取样本。目标分布 $\\pi(x)$ 与参数绝对值的负指数成正比，即 $\\pi(x) \\propto \\exp(-|x|)$。\n\n该科学家使用 Metropolis 算法和一个对称的提议分布 $q(x'|x)$，其中给定当前状态 $x$ 提议新状态 $x'$ 的概率等于给定 $x'$ 提议 $x$ 的概率（即，$q(x'|x) = q(x|x')$）。\n\n假设在模拟的某一步，马尔可夫链的当前状态是 $x = 1.5$。然后算法提议移动到一个新的候选状态 $x' = 2.0$。\n\n计算这次特定移动的接受概率。您的答案应该是一个无量纲的实数。将最终答案四舍五入到四位有效数字。", "solution": "对于从 $x$ 到 $x'$ 的移动，当提议分布 $q(x'|x)=q(x|x')$ 对称时，Metropolis 接受概率为\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\frac{\\pi(x')q(x|x')}{\\pi(x)q(x'|x)}\\right)=\\min\\left(1,\\frac{\\pi(x')}{\\pi(x)}\\right).\n$$\n给定目标分布 $\\pi(x)\\propto \\exp(-|x|)$，该比率可简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\frac{\\exp(-|x'|)}{\\exp(-|x|)}=\\exp\\!\\left(-\\left(|x'|-|x|\\right)\\right).\n$$\n当 $x=1.5$ 且 $x'=2.0$ 时，我们有 $|x|=1.5$ 和 $|x'|=2.0$，所以\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\exp\\!\\left(-\\left(2.0-1.5\\right)\\right)=\\exp(-0.5).\n$$\n因此，\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\exp(-0.5)\\right)=\\exp(-0.5).\n$$\n数值上，$\\exp(-0.5)\\approx 0.6065$（四舍五入到四位有效数字）。", "answer": "$$\\boxed{0.6065}$$", "id": "1371728"}, {"introduction": "在掌握了 Metropolis 算法的基本规则后，下一个关键问题是如何有效地“调优”采样器。这个思想实验探讨了提议分布的宽度（步长）这一关键参数对采样器效率的深刻影响 [@problem_id:1932810]。通过对比过窄和过宽的提议分布，你将理解在高接受率和有效探索状态空间之间的权衡，这是 MCMC 实践中的一个核心挑战。", "problem": "一位分析师正在使用马尔可夫链蒙特卡洛（MCMC）方法，具体来说是随机游走Metropolis算法，从一个定义在实数轴上的连续单峰目标概率密度函数 $\\pi(x)$ 中生成样本。该算法按以下方式进行：给定马尔可夫链的当前状态为 $x^{(t)}$，从一个对称的提议分布 $q(x'|x^{(t)})$ 中提议一个新的候选状态 $x'$。在这个具体的实现中，提议是通过添加一个随机扰动生成的：$x' = x^{(t)} + \\epsilon$，其中 $\\epsilon$ 从均值为0、标准差为 $\\sigma$ 的正态分布中抽取，即 $\\epsilon \\sim N(0, \\sigma^2)$。然后，提议的状态 $x'$ 以概率 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$ 被接受为下一个状态 $x^{(t+1)} = x'$。如果提议被拒绝，马尔可夫链将保持在当前状态，即 $x^{(t+1)} = x^{(t)}$。\n\n该分析师正在试验提议分布标准差的两种不同设置：\n1.  一个非常窄的提议分布，其中 $\\sigma = \\sigma_{small}$ 是一个非常小的正数。\n2.  一个非常宽的提议分布，其中 $\\sigma = \\sigma_{large}$ 是一个非常大的正数。\n\n假设马尔可夫链已经在概率不可忽略的区域（例如，在 $\\pi(x)$ 的众数附近）被初始化。以下哪种说法最准确地描述了 MCMC 链在这两种情况下的预期行为？\n\nA. 窄提议（$\\sigma_{small}$）将导致低接受率和缓慢的探索。宽提议（$\\sigma_{large}$）将导致高接受率和快速的探索。\n\nB. 两种提议宽度将导致相似的接受率，但使用宽提议（$\\sigma_{large}$）的链将比使用窄提议（$\\sigma_{small}$）的链更快地探索状态空间。\n\nC. 窄提议（$\\sigma_{small}$）将导致非常高的接受率，但链会非常缓慢地探索状态空间。宽提议（$\\sigma_{large}$）将导致非常低的接受率，导致链在许多次迭代中停留在同一状态。\n\nD. 窄提议（$\\sigma_{small}$）将导致高接受率和快速的探索。宽提议（$\\sigma_{large}$）将导致低接受率和缓慢的探索。\n\nE. 提议分布的宽度对算法性能的影响可以忽略不计；接受率和探索速度都主要由目标分布 $\\pi(x)$ 的性质决定。", "solution": "问题要求我们分析随机游走Metropolis算法的行为，重点关注提议分布 $N(0, \\sigma^2)$ 的宽度（标准差 $\\sigma$）如何影响链的接受率及其探索目标分布 $\\pi(x)$ 状态空间的能力。\n\n从 $x^{(t)}$ 到 $x'$ 的提议移动的接受概率由 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$ 给出。让我们分别分析这两种情况。\n\n**情况1：窄提议分布（$\\sigma = \\sigma_{small}$）**\n\n当标准差 $\\sigma_{small}$ 非常小时，从 $N(0, \\sigma_{small}^2)$ 中抽取的随机扰动 $\\epsilon$ 的量级也会非常小。这意味着提议的状态 $x' = x^{(t)} + \\epsilon$ 将非常接近当前状态 $x^{(t)}$。\n\n由于目标分布 $\\pi(x)$ 是连续的，如果 $x'$ 非常接近 $x^{(t)}$，那么这两点的概率密度值 $\\pi(x')$ 和 $\\pi(x^{(t)})$ 将会非常相似。\n因此，比率 $\\frac{\\pi(x')}{\\pi(x^{(t)})}$ 将非常接近1。\n\n接受概率为 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$。由于比率接近1，接受概率 $\\alpha$ 将会非常高（接近1）。这意味着几乎每一个提议的移动都会被接受。\n\n然而，由于每次接受的移动都只是离前一个位置迈出了一小步，链在状态空间中的移动非常缓慢。这是一种探索目标分布 $\\pi(x)$ 全范围（尤其是尾部）的低效方式。链表现出高自相关性，意味着连续的样本高度相关，需要非常大量的迭代才能获得一组具有代表性的独立样本。这构成了非常缓慢的探索。\n\n**情况2：宽提议分布（$\\sigma = \\sigma_{large}$）**\n\n当标准差 $\\sigma_{large}$ 非常大时，随机扰动 $\\epsilon$ 的量级通常会很大。这意味着提议的状态 $x' = x^{(t)} + \\epsilon$ 很可能离当前状态 $x^{(t)}$ 非常远。\n\n我们已知目标分布 $\\pi(x)$ 是单峰的，且链从高概率区域（众数附近）开始。当链处于这样的区域时，$\\pi(x^{(t)})$ 相对较大。从 $x^{(t)}$ 进行一次大的跳跃很可能会落入分布尾部的遥远区域，那里的概率密度极低。因此，$\\pi(x') \\ll \\pi(x^{(t)})$ 的可能性非常高。\n\n在这种情况下，比率 $\\frac{\\pi(x')}{\\pi(x^{(t)})}$ 将非常接近0。\n\n接受概率为 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$。由于比率非常小，接受概率 $\\alpha$ 也将非常小。这意味着绝大多数提议的移动都将被拒绝。\n\n当提议被拒绝时，链不会移动：$x^{(t+1)} = x^{(t)}$。因此，对于宽提议分布，链将在许多连续的迭代中停留在同一状态，等待一个罕见的、恰好落在另一个高概率区域的提议。这也是一种非常低效的状态空间探索方式。\n\n**结论和选项评估：**\n\n-   窄提议给出**高接受率**但**探索缓慢**。\n-   宽提议给出**低接受率**且**探索缓慢**（因为链会卡住）。\n\n让我们基于此分析评估给出的选项：\n\n-   **A：** 错误。它声称宽提议导致高接受率。\n-   **B：** 错误。它声称两者有相似的接受率。\n-   **C：** 该陈述正确地捕捉了两种行为。窄提议导致高接受率但探索缓慢。宽提议导致非常低的接受率，使链卡住。这是最准确的描述。\n-   **D：** 错误。它声称窄提议导致快速探索。\n-   **E：** 错误。提议分布的宽度是一个关键的调整参数，它深刻地影响算法的性能。\n\n因此，最准确的陈述是 C。", "answer": "$$\\boxed{C}$$", "id": "1932810"}, {"introduction": "MCMC 方法虽然强大，但并非万无一失。这个练习将引导你探究一个典型难题：从多峰分布中采样 [@problem_id:1932795]。它生动地展示了一个调优不当的采样器（特别是步长过小）如何被“困在”分布的单个峰中，从而无法探索整个概率空间，最终导致对目标分布的描述出现严重偏差。", "problem": "一位数据科学家正在使用马尔可夫链蒙特卡洛（MCMC）方法，从一个复杂的一维目标概率密度函数 $\\pi(x)$ 中抽取样本。已知目标分布是一个对称双峰分布，具体来说是两个高斯分布的等权重混合。其密度正比于两个高斯概率密度函数之和：\n$$ \\pi(x) \\propto \\exp\\left(-\\frac{(x - \\mu_A)^2}{2\\sigma_{mode}^2}\\right) + \\exp\\left(-\\frac{(x - \\mu_B)^2}{2\\sigma_{mode}^2}\\right) $$\n参数给定为 $\\mu_A = -10$，$\\mu_B = 10$，以及 $\\sigma_{mode} = 1$。这种结构导致了两个分别以 $x=-10$ 和 $x=10$ 为中心的狭窄且分离良好的概率峰，它们之间有一个概率密度极低的区域。\n\n该科学家使用随机游走Metropolis算法。在每一步，从以当前状态 $x_t$ 为中心的高斯分布中提出了一个新状态 $x'$，即 $x' \\sim N(x_t, \\sigma_{step}^2)$。为了获得高的接受率，该科学家选择了一个非常小的步长方差，设 $\\sigma_{step} = 0.1$。MCMC链在其中一个峰的峰值处初始化，$x_0 = -10$，并运行 $N=10^6$ 次迭代。\n\n下列哪个陈述最准确地描述了MCMC采样器的行为以及最终样本集 $\\{x_1, x_2, \\dots, x_N\\}$ 的统计特性？\n\nA. 样本将分布在目标分布的真实均值 $x=0$ 附近。样本均值将接近0，但样本方差会很大（大于100），准确地反映了两个峰之间的显著分离。\n\nB. 提议移动的接受率将非常低（接近0），因为步长没有根据目标分布的整体尺度进行良好调整。链将停留在其初始位置 $x_0 = -10$ 或其附近。\n\nC. 提议移动的接受率将非常高（接近1）。生成的样本将充分探索对应于 $x=-10$ 处峰的区域，但链将无法转换到位于 $x=10$ 的另一个峰。样本均值将约等于-10。\n\nD. 采样器将有效地探索整个状态空间。链将在两个峰之间频繁来回跳跃，样本的直方图将正确地形成以 $x=-10$ 和 $x=10$ 为中心的两个不同峰。\n\nE. 采样器将表现得像一个简单的随机游走，导致样本从起始点扩散开。最终的样本集将在以 $x=-10$ 为中心的宽区间上近似均匀分布。", "solution": "我们将目标建模为两个高斯密度的等权重混合，它们具有共同的标准差 $\\sigma_{mode}$ 和均值 $\\mu_{A}$、$\\mu_{B}$。在忽略比例常数的情况下，\n$$\n\\pi(x) \\propto \\exp\\!\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right) + \\exp\\!\\left(-\\frac{(x-\\mu_{B})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n使用随机游走Metropolis采样器，提议分布为对称高斯分布 $q(x' \\mid x)=\\mathcal{N}(x,\\sigma_{step}^{2})$，在状态 $x_{t}$ 处对提议 $x'$ 的Metropolis–Hastings接受概率为\n$$\n\\alpha(x_{t},x')=\\min\\!\\left(1,\\frac{\\pi(x')}{\\pi(x_{t})}\\right).\n$$\n\n在 $x_{0}=\\mu_{A}$ 处初始化。由于两个峰分离良好，当 $x$ 靠近 $\\mu_{A}$ 时，$\\pi(x)$ 中来自 $\\mu_{B}$ 分量的贡献相对于来自 $\\mu_{A}$ 分量的贡献可以忽略不计。对于一个满足 $|\\epsilon| \\ll \\sigma_{mode}$ 的小提议增量 $\\epsilon:=x'-x$，主导比率近似给出\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\frac{\\exp\\!\\left(-\\frac{(x'-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}{\\exp\\!\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}=\\exp\\!\\left(-\\frac{(x'-\\mu_{A})^{2}-(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n在 $x\\approx\\mu_{A}$ 处，对于小的 $\\epsilon$，这简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\exp\\!\\left(-\\frac{\\epsilon^{2}}{2\\sigma_{mode}^{2}}\\right),\n$$\n因此当 $\\sigma_{step} \\ll \\sigma_{mode}$ 时，接受概率接近于1，因为典型的 $|\\epsilon|$ 与 $\\sigma_{step}$ 的量级相同。因此，当链在起始峰的附近进行探索时，接受率非常高。\n\n在一次提议中直接从 $\\mu_{A}$ 的邻域跳到 $\\mu_{B}$ 的邻域需要一个量级为 $|\\mu_{B}-\\mu_{A}|$ 的位移。在方差为 $\\sigma_{step}^{2}$ 的高斯提议下，这种跳跃的概率量级为\n$$\n\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{2\\sigma_{step}^{2}}\\right),\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{step}$ 时，这是可以忽略的。\n\n通过许多小的被接受的步长穿过低密度区域，在有限次运行中也是极不可能的，因为谷底的平稳密度比峰值处的密度要小指数级别。在中点 $x^{\\star}=(\\mu_{A}+\\mu_{B})/2$ 处，目标密度为\n$$\n\\pi(x^{\\star}) \\propto 2\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right),\n$$\n而在 $x=\\mu_{A}$ 附近，$\\pi(\\mu_{A}) \\propto 1$（那里的另一个分量可以忽略不计）。因此，比率\n$$\n\\frac{\\pi(x^{\\star})}{\\pi(\\mu_{A})} \\approx 2\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right)\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{mode}$ 时是指数级小的。这意味着需要一个指数级大的期望时间才能到达谷底或另一个峰，其量级为该比率的倒数，当分离很大且提议非常局部时，这远超过给定的 $N$。\n\n因此，当 $\\sigma_{step}$ 相对于 $\\sigma_{mode}$ 选择得非常小，且峰被良好分离时，链具有非常高的接受率，会充分探索起始峰 $x=\\mu_{A}$ 周围的局部盆地，在运行中基本上永远不会转换到另一个峰，并产生一个约等于 $\\mu_{A}$ 的样本均值。在这些选项中，这对应于陈述C。", "answer": "$$\\boxed{C}$$", "id": "1932795"}]}