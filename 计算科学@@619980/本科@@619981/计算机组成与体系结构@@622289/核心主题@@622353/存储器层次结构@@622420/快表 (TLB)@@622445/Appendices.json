{"hands_on_practices": [{"introduction": "要评估一个系统设计的优劣，首先需要建立一个量化其性能的模型。对于转译后备缓冲器（TLB）而言，其核心性能指标是它在多大程度上缩短了平均地址翻译时间。这项练习 [@problem_id:3685658] 将指导你从基本概率原理出发，为一个常见的分层 TLB 结构推导出平均翻译时间（$t_{\\text{AT}}$）的表达式，让你亲手构建一个评估 TLB 性能的坚实分析框架。", "problem": "一个处理器实现了一个$2$级翻译后备缓冲器（TLB）。设第$1$级TLB（L1）的命中率为$H_1$，并且在L1未命中的条件下，第$2$级TLB（L2）的命中率为$H_2$。定义翻译延迟贡献如下：如果L1命中，翻译延迟贡献为$t_1$；如果L1未命中而L2命中，翻译延迟贡献为$t_2$；如果L1和L2都未命中，翻译需要一次硬件页表遍历，其延迟为$t_w$。假设这些贡献是互斥的路径成本，这意味着$t_2$和$t_w$已经包含了任何上游查找的开销。同时假设访问流是平稳的，因此$H_1$和$H_2$是良定义（well-defined）的概率，并且只应用基础的概率论原理（例如全概率公式和期望的定义）。\n\n任务A（推导）：从第一性原理出发，推导出期望地址翻译时间 $t_{\\text{AT}}$ 关于 $H_1$、$H_2$、$t_1$、$t_2$ 和 $t_w$ 的解析表达式。\n\n任务B（流式效应）：在流式访问阶段，L1的时间局部性下降，因此$H_1$减少了$\\Delta H$（其中$0  \\Delta H  H_1$），而$H_2$由于其更大的覆盖范围保持不变。设$t_1 = 0.5$纳秒，$t_2 = 3$纳秒，$t_w = 120$纳秒，$H_2 = 0.97$，以及$\\Delta H = 0.18$。使用您推导的表达式，计算期望翻译时间的变化量 $\\Delta t_{\\text{AT}} = t_{\\text{AT}}^{\\prime} - t_{\\text{AT}}$，其中$t_{\\text{AT}}^{\\prime}$是$H_1$下降后的期望翻译时间。将$\\Delta t_{\\text{AT}}$的最终数值答案以纳秒为单位表示，并四舍五入到四位有效数字。", "solution": "此问题经评估为有效，因为它在科学上基于计算机体系结构的原理，问题设定良好，目标明确，数据充分，并且没有任何事实错误或含糊不清之处。该问题要求对一个分层存储系统进行标准的性能分析。\n\n按照题目要求，解答分为两部分呈现。\n\n任务A：推导期望地址翻译时间 $t_{\\text{AT}}$。\n\n一个地址翻译请求可能导致以下三种互斥结果之一：\n$1$. 第$1$级TLB（L1）命中。\n$2$. 第$1$级TLB（L1）未命中，随后第$2$级TLB（L2）命中。\n$3$. 第$1$级TLB和第$2$级TLB均未命中，需要一次完整的页表遍历。\n\n我们根据所提供的参数来定义这些事件的概率。L1 TLB的命中率给出为$H_1$。这是第一种结果的概率。\n$$P(\\text{L1 hit}) = H_1$$\n因此，L1未命中的概率是$1 - H_1$。\n$$P(\\text{L1 miss}) = 1 - H_1$$\n题目指出，L2的命中率$H_2$是在L1未命中的条件下的。这是一个条件概率：\n$$P(\\text{L2 hit} | \\text{L1 miss}) = H_2$$\n第二种结果（L1未命中且L2命中）的概率可以通过条件概率的定义 $P(A \\cap B) = P(A|B)P(B)$ 求得：\n$$P(\\text{L1 miss} \\cap \\text{L2 hit}) = P(\\text{L2 hit} | \\text{L1 miss}) \\times P(\\text{L1 miss}) = H_2 (1 - H_1)$$\n类似地，在L1未命中的条件下，L2未命中的概率是 $1 - H_2$。\n$$P(\\text{L2 miss} | \\text{L1 miss}) = 1 - H_2$$\n第三种结果（L1未命中且L2未命中）的概率是：\n$$P(\\text{L1 miss} \\cap \\text{L2 miss}) = P(\\text{L2 miss} | \\text{L1 miss}) \\times P(\\text{L1 miss}) = (1 - H_2) (1 - H_1)$$\n这三个事件是完备的。它们的概率之和为$1$：\n$$H_1 + H_2(1 - H_1) + (1 - H_2)(1 - H_1) = H_1 + (1 - H_1)(H_2 + 1 - H_2) = H_1 + (1 - H_1) = 1$$\n与这三种结果相关联的延迟分别为$t_1$、$t_2$和$t_w$。\n\n根据期望值的定义，期望地址翻译时间 $t_{\\text{AT}}$ 是每种结果的概率与其对应延迟的乘积之和：\n$$t_{\\text{AT}} = P(\\text{L1 hit}) \\cdot t_1 + P(\\text{L1 miss} \\cap \\text{L2 hit}) \\cdot t_2 + P(\\text{L1 miss} \\cap \\text{L2 miss}) \\cdot t_w$$\n将概率的表达式代入，得到 $t_{\\text{AT}}$ 的解析表达式：\n$$t_{\\text{AT}} = H_1 t_1 + (1 - H_1) H_2 t_2 + (1 - H_1) (1 - H_2) t_w$$\n这是任务A的最终推导表达式。\n\n任务B：计算期望翻译时间的变化量 $\\Delta t_{\\text{AT}}$。\n\n初始时，期望翻译时间由上述推导的表达式给出。我们将其表示为$t_{\\text{AT}}$。\n在流式访问阶段，L1命中率$H_1$下降了$\\Delta H$。新的L1命中率$H_1^{\\prime}$为：\n$$H_1^{\\prime} = H_1 - \\Delta H$$\n新的期望翻译时间 $t_{\\text{AT}}^{\\prime}$，可以通过将$H_1^{\\prime}$代入$t_{\\text{AT}}$的表达式中求得，而所有其他参数（$H_2$、$t_1$、$t_2$、$t_w$）保持不变：\n$$t_{\\text{AT}}^{\\prime} = H_1^{\\prime} t_1 + (1 - H_1^{\\prime}) H_2 t_2 + (1 - H_1^{\\prime}) (1 - H_2) t_w$$\n期望翻译时间的变化量为 $\\Delta t_{\\text{AT}} = t_{\\text{AT}}^{\\prime} - t_{\\text{AT}}$。\n$$\\Delta t_{\\text{AT}} = \\left( H_1^{\\prime} t_1 + (1 - H_1^{\\prime}) H_2 t_2 + (1 - H_1^{\\prime}) (1 - H_2) t_w \\right) - \\left( H_1 t_1 + (1 - H_1) H_2 t_2 + (1 - H_1) (1 - H_2) t_w \\right)$$\n我们可以按各自的延迟对各项进行分组：\n$$\\Delta t_{\\text{AT}} = (H_1^{\\prime} - H_1) t_1 + ((1 - H_1^{\\prime}) - (1 - H_1)) H_2 t_2 + ((1 - H_1^{\\prime}) - (1 - H_1)) (1 - H_2) t_w$$\n差值项为：\n$$H_1^{\\prime} - H_1 = (H_1 - \\Delta H) - H_1 = -\\Delta H$$\n$$(1 - H_1^{\\prime}) - (1 - H_1) = 1 - (H_1 - \\Delta H) - 1 + H_1 = \\Delta H$$\n将这些代回$\\Delta t_{\\text{AT}}$的表达式中：\n$$\\Delta t_{\\text{AT}} = (-\\Delta H) t_1 + (\\Delta H) H_2 t_2 + (\\Delta H) (1 - H_2) t_w$$\n提取公因式$\\Delta H$得到变化量的最终表达式，该表达式与初始命中率$H_1$无关：\n$$\\Delta t_{\\text{AT}} = \\Delta H (-t_1 + H_2 t_2 + (1 - H_2) t_w)$$\n现在，我们代入所提供的数值：\n$\\Delta H = 0.18$\n$H_2 = 0.97$\n$t_1 = 0.5$ 纳秒\n$t_2 = 3$ 纳秒\n$t_w = 120$ 纳秒\n\n将这些值代入$\\Delta t_{\\text{AT}}$的表达式中：\n$$\\Delta t_{\\text{AT}} = 0.18 \\times (-0.5 + (0.97 \\times 3) + (1 - 0.97) \\times 120)$$\n$$\\Delta t_{\\text{AT}} = 0.18 \\times (-0.5 + 2.91 + 0.03 \\times 120)$$\n$$\\Delta t_{\\text{AT}} = 0.18 \\times (-0.5 + 2.91 + 3.6)$$\n$$\\Delta t_{\\text{AT}} = 0.18 \\times (2.41 + 3.6)$$\n$$\\Delta t_{\\text{AT}} = 0.18 \\times 6.01$$\n$$\\Delta t_{\\text{AT}} = 1.0818$$\n单位是纳秒。题目要求答案四舍五入到四位有效数字。\n$$1.0818 \\text{ ns} \\approx 1.082 \\text{ ns}$$\n因此，期望翻译时间的变化量为$1.082$纳秒。", "answer": "$$\n\\boxed{1.082}\n$$", "id": "3685658"}, {"introduction": "仅仅拥有 TLB 硬件并不能保证高性能，程序的内存访问模式与 TLB 组织结构的交互同样至关重要，不良的交互会导致大量的“冲突未命中”，从而严重降低性能。这项练习 [@problem_id:3685734] 让你扮演系统架构师的角色，通过设计一个“最坏情况”下的访问模式，来主动诱发 TLB 颠簸（thrashing）。这是一个绝佳的实践，可以让你深刻理解组相联缓存的工作机制，以及数据布局对性能的关键影响。", "problem": "翻译后备缓冲器（TLB）是处理器用来加速内存地址翻译的一种虚拟到物理页转换的缓存。考虑一个总容量为 $C$ 个条目、采用 $A$ 路组相联的 TLB，其共有 $N_{\\text{sets}} = \\frac{C}{A}$ 个组，每个组最多可容纳 $A$ 个条目。假设 TLB 在每个组内使用最近最少使用（LRU）替换策略，并且组索引的计算方式为虚拟页号对组数取模，即 $\\text{set\\_index} = \\mathrm{VPN} \\bmod N_{\\text{sets}}$。一个程序以固定的循环顺序重复访问 $W$ 个不同的虚拟页，第 $k$ 个页的页号由 $p_k = p_0 + k S$ 给出（其中 $k = 0, 1, \\dots, W - 1$），$S$ 是以页为单位的整数步长，$p_0$ 是一个任意的基页号。\n\n对 $W$ 和 $S$ 的设计选择控制了这些页如何映射到 TLB 组，从而决定了发生多少次冲突。在所述模型下，为 $W$ 和 $S$ 选择整数值（仅用 $C$ 和 $A$ 的符号表示），以最大化完全由 TLB 中的映射碰撞引起的冲突未命中。然后，计算该无限循环访问流的稳态 TLB 命中率 $H$，$H$ 定义为当循环次数趋于无穷大时，TLB 命中次数占总访问次数的比例的极限。\n\n给出 $W$、$S$ 和 $H$ 关于 $C$ 和 $A$ 的明确公式。将你的最终答案以包含 $W$、$S$ 和 $H$ 的行矩阵形式给出。无需四舍五入，$H$ 必须表示为小数或分数，不带百分号。", "solution": "首先将根据指定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n- TLB 总容量：$C$ 个条目。\n- 相联度：$A$ 路组相联。\n- 组数：$N_{\\text{sets}} = \\frac{C}{A}$。\n- 替换策略：最近最少使用（LRU）。\n- 组索引计算：$\\text{set\\_index} = \\mathrm{VPN} \\bmod N_{\\text{sets}}$，其中 $\\mathrm{VPN}$ 是虚拟页号。\n- 访问模式：对 $W$ 个不同虚拟页的循环访问。\n- 虚拟页号公式：$p_k = p_0 + k S$，其中 $k = 0, 1, \\dots, W - 1$。\n- 步长：$S$ 是一个整数。\n- 基页号：$p_0$ 是一个任意整数。\n- 目标：选择 $W$ 和 $S$ 的整数值（用 $C$ 和 $A$ 表示）以最大化冲突未命中。然后，计算得到的稳态命中率 $H$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 问题描述了一个带有 LRU 替换策略的组相联缓存的标准简化模型，这是计算机组成和体系结构中的一个常见主题。虚拟到物理地址翻译、TLB、组相联、模映射函数以及基于步长的访问模式等概念都是基础且科学合理的。\n- **良构性：** 这个问题是良构的。它要求在一个完全指定的模型中选择一组特定参数（$W$, $S$），以优化一个明确定义的指标（最大化冲突未命中）。循环访问模式的稳态命中率概念也定义明确。我们按照标准假设，$C$ 是 $A$ 的整数倍，从而使得 $N_{\\text{sets}}$ 是一个整数。\n- **客观性：** 问题以精确、技术性和无偏见的语言陈述。\n\n该问题不违反任何无效性标准。它是科学合理、可形式化、完整且良构的。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n目标是选择整数参数 $W$（工作集大小）和 $S$（步长），以最大化 TLB 中的冲突未命中次数。当一次访问映射到一个已满是其他有效条目的 TLB 组，从而强制替换时，就会发生冲突未命中。最高可能的未命中率是 $1$，对应于命中率为 $0$。我们将设法达到这个条件。\n\n访问序列中第 $k$ 个页 $p_k$ 的组索引由下式给出：\n$$ \\text{set\\_index}(p_k) = p_k \\bmod N_{\\text{sets}} = (p_0 + kS) \\bmod N_{\\text{sets}} $$\n其中 $N_{\\text{sets}} = \\frac{C}{A}$。\n\n为最大化冲突，我们应安排多个页映射到同一个组，从而为该组中有限的 $A$ 个条目（路）制造竞争。当工作集中的所有 $W$ 个页都映射到单个 TLB 组时，会发生最极端的竞争。\n\n要使所有 $W$ 个页都映射到同一个组，它们对于所有 $k \\in \\{0, 1, \\dots, W-1\\}$ 的组索引必须相同。设 $p_0$ 的组索引为 $j = p_0 \\bmod N_{\\text{sets}}$。我们需要对于所有后续的页 $p_k$，其组索引也为 $j$。\n$$ (p_0 + kS) \\bmod N_{\\text{sets}} = p_0 \\bmod N_{\\text{sets}} $$\n这个关系成立的充要条件是，对于所有 $k \\in \\{1, \\dots, W-1\\}$，都有 $(kS) \\bmod N_{\\text{sets}} = 0$。要使此条件对任何 $W > 1$ 的选择都成立，步长 $S$ 必须是 $N_{\\text{sets}}$ 的一个非零整数倍。确保这种碰撞的最简单和最基本的选择是设置 $S$ 等于组的数量。\n$$ S = N_{\\text{sets}} = \\frac{C}{A} $$\n这种对 $S$ 的选择保证了所有 $W$ 个页 $p_0, p_1, \\dots, p_{W-1}$ 都映射到同一个 TLB 组，即索引为 $p_0 \\bmod N_{\\text{sets}}$ 的组。\n\n既然所有 $W$ 个页都在争夺单个组中的 $A$ 个位置，我们必须选择 $W$ 来最大化未命中次数。替换策略是 LRU。一个相联度为 $A$ 的组最多能容纳 $A$ 个不同的页转换。如果我们循环访问的页数 $W$ 大于 $A$，将不可避免地导致替换。\n\n为了保证在稳态下每次访问都未命中（这种现象被称为“颠簸”），循环工作集中的不同页数必须刚好足够大，以至于当一个页被再次引用时，它已经被替换出去了。在 LRU 策略下，一个相联度为 $A$ 的组存储了最近使用的 $A$ 个项目。如果我们在一个周期内访问 $W$ 个项目，那么对项目 $i$ 的访问将是未命中，如果项目 $i$ 不在最近访问的 $A$ 个项目之中。\n\n考虑一个 $W$ 个页的循环访问模式。在访问页 $p_k$ 之前，最近的 $A$ 次访问是页 $p_{k-1}, p_{k-2}, \\dots, p_{k-A}$（索引是循环的）。如果选择的 $W$ 使得 $p_k$ 不在这 $A$ 个页的组中，那么对 $p_k$ 的访问将是未命中。使此条件成立的最小整数 $W$ 是 $W = A+1$。\n\n让我们追踪 $W = A+1$ 时的行为。访问模式是循环遍历 $p_0, p_1, \\dots, p_A$。\n1. 访问 $p_0$：未命中。组现在包含 $\\{p_0\\}$。\n2. 访问 $p_1$：未命中。组现在包含 $\\{p_0, p_1\\}$。\n...\nA. 访问 $p_{A-1}$：未命中。组现在包含 $\\{p_0, \\dots, p_{A-1}\\}$。\nA+1. 访问 $p_A$：未命中。组已满。$p_0$ 是 LRU 条目，被替换。组现在包含 $\\{p_1, \\dots, p_A\\}$。\nA+2. 访问 $p_0$（循环重复）：未命中。组包含 $\\{p_1, \\dots, p_A\\}$，所以 $p_0$ 不存在。$p_1$ 现在是 LRU 条目，被替换。\n\n在稳态下（在最初的强制性未命中之后），每次访问都是针对一个已被从组中替换出去的页。对于对页 $p_k$ 的访问，组包含了先前访问的 $A$ 个页，即 $\\{p_{k-1 \\pmod{A+1}}, \\dots, p_{k-A \\pmod{A+1}}\\}$。由于周期中有 $A+1$ 个页，因此可以保证页 $p_k$ 不在组中。所以，每次访问都会导致未命中。\n\n这种情况产生 $1$ 的未命中率，因此命中率为 $0$。命中率为 $0$ 对应于可能的最大未命中次数。因此，我们对 $W$ 和 $S$ 的选择满足了问题的要求。\n\n所选的值是：\n- 工作集大小：$W = A+1$\n- 步长：$S = \\frac{C}{A}$\n\n稳态命中率 $H$ 是命中次数与总访问次数的比率。由于在稳态下每次访问都是未命中，所以命中次数为 $0$。\n$$ H = \\frac{\\text{命中次数}}{\\text{总访问次数}} = \\frac{0}{W} = 0 $$\n\n最终答案由 $W$、$S$ 和 $H$ 的符号表达式组成。\n$W = A+1$\n$S = \\frac{C}{A}$\n$H = 0$", "answer": "$$ \\boxed{\\begin{pmatrix} A+1  \\frac{C}{A}  0 \\end{pmatrix}} $$", "id": "3685734"}, {"introduction": "我们已经探讨了如何衡量 TLB 性能以及性能可能如何退化，那么，我们应如何设计系统来为大型应用程序维持良好性能呢？一个核心概念是 TLB 的“覆盖范围”（reach），即 TLB 能够映射的内存总量。这项练习 [@problem_id:3685718] 旨在探索 TLB 条目数和页面大小之间的重要权衡。通过分析不同页面大小对覆盖特定工作集所需的 TLB 条目数的影响，你将掌握现代操作系统和硬件设计中一个关键的协同优化策略。", "problem": "一个虚拟内存系统使用翻译后备缓冲器（TLB）来缓存最近的虚拟到物理页的转换。设 TLB 有 $C$ 个条目，页面大小为 $P$，因此其 TLB 覆盖范围为 $R = C \\cdot P$ 字节。考虑一个程序，其稳定工作集大小为 $W_s$ 字节，并具有很强的时间局部性，其特征由以下参数模型描述：落在工作集中最频繁访问的 $x$ 字节内的引用累积比例为\n$$\nF(x) = \\left(\\frac{x}{W_s}\\right)^{\\alpha}, \\quad 0 \\le x \\le W_s,\n$$\n其中 $0  \\alpha \\le 1$ 是一个给定的局部性参数。假设采用理想的 TLB 替换策略，总是保留最频繁引用页面的转换，并且 $W_s \\gg P$，因此可以忽略页面边界效应，并且为了估算，$C$ 可以被视为一个实值容量。\n\n要求您配置 TLB，以达到至少 $1 - \\epsilon$ 的目标 TLB 命中率，其中 $\\epsilon$ 是一个给定的较小缺失率。TLB 命中率 $H$ 可以近似为对大小为 $R$ 的最频繁引用区域的覆盖率，即 $H \\approx F(R)$。\n\n正在考虑两种页面大小：$P_1 = 4\\,\\text{KiB}$ 和 $P_2 = 2\\,\\text{MiB}$。设 $W_s = 512\\,\\text{MiB}$，$\\alpha = 0.7$，且 $\\epsilon = 0.01$。\n\n仅使用上述定义和所述模型，推导出达到 $H \\approx 1 - \\epsilon$ 所需的最小 TLB 覆盖范围 $R^{\\star}$（以字节为单位），并由此推导出在每种页面大小 $P_i$ 下所需的最小实值 TLB 条目数 $C_i^{\\star} = R^{\\star} / P_i$。请报告比率 $C_1^{\\star} / C_2^{\\star}$ 作为最终答案，该答案应为一个单一、精确、无单位的数字。不需要四舍五入，您必须给出一个简化的精确值。", "solution": "该问题要求推导两种不同页面大小 $P_1$ 和 $P_2$ 下，最小翻译后备缓冲器（TLB）条目数的比率 $C_1^{\\star} / C_2^{\\star}$。该推导必须基于所提供的关于时间局部性的参数模型。\n\nTLB 命中率 $H$ 由落在 TLB 覆盖范围 $R$ 内的引用累积比例来近似。覆盖范围定义为 TLB 条目数 $C$ 和页面大小 $P$ 的乘积，即 $R = C \\cdot P$。局部性模型由函数 $F(x)$ 给出，其中 $x$ 是内存区域的大小（以字节为单位）：\n$$\nF(x) = \\left(\\frac{x}{W_s}\\right)^{\\alpha}\n$$\n此处，$W_s$ 是工作集大小，$\\alpha$ 是局部性参数。因此，TLB 命中率近似为 $H \\approx F(R)$。\n\n目标是配置 TLB 以达到至少 $1 - \\epsilon$ 的目标命中率，其中 $\\epsilon$ 是最大可容忍的缺失率。这意味着条件 $H \\ge 1 - \\epsilon$。使用所提供的近似，这可以转换为：\n$$\nF(R) \\ge 1 - \\epsilon\n$$\n由于函数 $F(x)$ 在 $x > 0$ 和 $\\alpha > 0$ 时随 $x$ 单调递增，为满足此条件所需的最小 TLB 覆盖范围（我们记为 $R^{\\star}$）可以通过求解等式找到：\n$$\nF(R^{\\star}) = 1 - \\epsilon\n$$\n代入 $F(x)$ 的定义：\n$$\n\\left(\\frac{R^{\\star}}{W_s}\\right)^{\\alpha} = 1 - \\epsilon\n$$\n我们现在可以解出 $R^{\\star}$。首先，我们对等式两边取 $1/\\alpha$ 次幂：\n$$\n\\frac{R^{\\star}}{W_s} = (1 - \\epsilon)^{1/\\alpha}\n$$\n乘以 $W_s$ 得到所需最小 TLB 覆盖范围的表达式：\n$$\nR^{\\star} = W_s (1 - \\epsilon)^{1/\\alpha}\n$$\n该表达式定义了为达到目标命中率，TLB 必须覆盖的最小总内存大小。值得注意的是，$R^{\\star}$ 取决于程序的属性（$W_s$, $\\alpha$）和性能目标（$\\epsilon$），但与页面大小 $P$ 无关。\n\n问题将 TLB 条目数定义为 $C = R/P$。因此，对于页面大小 $P_i$ 所需的最小条目数，记为 $C_i^{\\star}$，由以下公式给出：\n$$\nC_i^{\\star} = \\frac{R^{\\star}}{P_i}\n$$\n使用这个关系，我们可以表示出两种给定页面大小 $P_1$ 和 $P_2$ 所需的最小条目数：\n$$\nC_1^{\\star} = \\frac{R^{\\star}}{P_1}\n$$\n$$\nC_2^{\\star} = \\frac{R^{\\star}}{P_2}\n$$\n我们被要求求出比率 $C_1^{\\star} / C_2^{\\star}$。我们可以使用上面的表达式来构建这个比率：\n$$\n\\frac{C_1^{\\star}}{C_2^{\\star}} = \\frac{\\frac{R^{\\star}}{P_1}}{\\frac{R^{\\star}}{P_2}}\n$$\n项 $R^{\\star}$ 在分子和分母中都存在，所以可以消掉：\n$$\n\\frac{C_1^{\\star}}{C_2^{\\star}} = \\frac{1/P_1}{1/P_2} = \\frac{P_2}{P_1}\n$$\n这个结果表明，所需的 TLB 条目数之比恰好是相应页面大小之比的倒数。确定这个比率不需要 $W_s = 512\\,\\text{MiB}$、$\\alpha = 0.7$ 和 $\\epsilon = 0.01$ 的具体数值。\n\n我们已知页面大小为 $P_1 = 4\\,\\text{KiB}$ 和 $P_2 = 2\\,\\text{MiB}$。为了计算该比率的数值，我们必须将这些大小表示为共同的单位，例如字节。\n第一个页面大小是：\n$$\nP_1 = 4\\,\\text{KiB} = 4 \\times 2^{10}\\,\\text{bytes} = 2^2 \\times 2^{10}\\,\\text{bytes} = 2^{12}\\,\\text{bytes}\n$$\n第二个页面大小是：\n$$\nP_2 = 2\\,\\text{MiB} = 2 \\times 2^{20}\\,\\text{bytes} = 2^{1} \\times 2^{20}\\,\\text{bytes} = 2^{21}\\,\\text{bytes}\n$$\n现在，我们可以将这些值代入比率的表达式中：\n$$\n\\frac{C_1^{\\star}}{C_2^{\\star}} = \\frac{P_2}{P_1} = \\frac{2^{21}\\,\\text{bytes}}{2^{12}\\,\\text{bytes}} = 2^{21-12} = 2^9\n$$\n最后，我们计算 $2^9$ 的精确值：\n$$\n2^9 = 512\n$$\n因此，为了达到相同的目标命中率，使用较小页面大小（$P_1$）的系统所需的 TLB 条目数是使用较大页面大小（$P_2$）系统的 $512$ 倍。", "answer": "$$\\boxed{512}$$", "id": "3685718"}]}