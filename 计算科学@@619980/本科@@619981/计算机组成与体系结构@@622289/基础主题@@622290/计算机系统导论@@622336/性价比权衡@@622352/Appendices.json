{"hands_on_practices": [{"introduction": "处理器设计的核心在于高效处理条件逻辑。传统方法是使用条件分支，但错误预测分支会带来显著的性能损失，而谓词执行则通过执行两个分支路径的指令来避免此问题，但代价是执行了不必要的指令。本练习 [@problem_id:3630750] 让您亲手量化这种权衡。通过为两种方案建立期望执行时间的模型，您将确定一个关键的性能阈值，从而深入理解指令集决策背后的成本效益分析。", "problem": "处理器设计者必须决定何时用指令集架构（ISA）级的谓词执行来替代条件分支。该处理器是一个顺序单发射流水线，其中每条解码的指令（算术或逻辑运算、比较、移动或分支）在执行时（无停顿的情况下）恰好占用 $1$ 个周期。一次错误预测的分支会产生额外的 $M$ 个周期的流水线恢复成本。无论预测是否正确，分支指令本身仍然消耗 $1$ 个周期。谓词指令无论其谓词值如何都会执行；当谓词为假时，指令的架构效应被抑制，但该指令仍然消耗其 $1$ 个周期的执行资源。\n\n考虑一个具有两条路径的特定条件区域：\n- “真”路径包含 $n_{T}$ 条数据操纵指令。\n- “假”路径包含 $n_{F}$ 条数据操纵指令。\n\n一条独立的比较指令为两种设计计算条件标志，并花费 $1$ 个周期。对于分支方案，随后的分支指令选择一条路径执行；对于谓词执行方案，分支被消除，两条路径的数据指令都作为谓词指令执行。设 $q$ 表示真路径是架构上正确路径的动态概率，设 $p$ 表示分支预测器对此分支的方向预测正确的动态概率。为便于本次分析，假设 $p$ 是一个经验性的预测器准确率，且与 $q$ 无关。\n\n对于一个特定的工作负载，假设 $n_{T} = 10$，$n_{F} = 4$，$q = 0.5$，且错误预测的恢复成本为 $M = 15$ 个周期。仅使用期望值和周期计算的基本原理，推导出预测器准确率阈值 $p^{\\star}$，在该阈值下，对于此条件区域的一个动态实例，分支方案的期望周期数等于谓词执行方案的期望周期数。将最终的 $p^{\\star}$ 表示为四舍五入到四位有效数字的小数。答案必须是单个数字，不带单位。", "solution": "该问题是有效的，因为它科学地基于计算机体系结构的原理，问题陈述清晰，提供了所有必要的信息，并且语言客观。我们可以着手推导预测器准确率阈值 $p^{\\star}$。\n\n任务是找到分支预测器准确率 $p^{\\star}$，在该准确率下，对于一个条件区域，两种实现策略（条件分支和谓词执行）的期望执行周期数相同。\n\n首先，我们确定谓词执行方案的总周期数，记为 $C_{\\text{pred}}$。\n根据问题描述，该方案包括一条比较指令，随后将“真”路径和“假”路径中的所有数据操纵指令作为谓词指令执行。每条指令，无论其谓词是真是假，都消耗 $1$ 个周期。因此，总周期数是确定性的，等于执行的指令数之和。\n指令数量包括：\n1.  比较指令：$1$ 个周期。\n2.  “真”路径指令：$n_T$ 个周期。\n3.  “假”路径指令：$n_F$ 个周期。\n\n因此，谓词执行的总周期数为：\n$$C_{\\text{pred}} = 1 + n_T + n_F$$\n\n接下来，我们确定条件分支方案的期望周期数，记为 $E_{\\text{branch}}$。\n这个成本不是确定性的；它取决于采取哪条路径以及分支预测器是否正确。总期望成本是其各组成部分期望成本的总和：\n1.  比较指令成本：$1$ 个周期，总是发生。\n2.  分支指令成本：$1$ 个周期，总是发生。\n3.  执行所选路径上指令的成本。“真”路径有 $n_T$ 条指令，以概率 $q$ 执行。“假”路径有 $n_F$ 条指令，以概率 $(1-q)$ 执行。因此，路径执行的期望周期数为 $q \\cdot n_T + (1-q) \\cdot n_F$。\n4.  因分支预测错误而产生的流水线恢复成本。错误预测以概率 $(1-p)$ 发生，并产生额外的 $M$ 个周期的惩罚。期望惩罚为 $(1-p) M$。\n\n将这些部分相加，分支方案的总期望周期数为：\n$$E_{\\text{branch}} = 1 + 1 + \\left(q \\cdot n_T + (1-q) \\cdot n_F\\right) + (1-p) M$$\n$$E_{\\text{branch}} = 2 + q \\cdot n_T + (1-q) \\cdot n_F + (1-p) M$$\n\n问题要求的是成本相等时的预测器准确率阈值 $p^{\\star}$。我们令 $C_{\\text{pred}} = E_{\\text{branch}}$，并求解 $p = p^{\\star}$：\n$$1 + n_T + n_F = 2 + q \\cdot n_T + (1-q) \\cdot n_F + (1-p^{\\star}) M$$\n\n为了求解 $p^{\\star}$，我们首先分离出包含它的项：\n$$(1-p^{\\star}) M = (1 + n_T + n_F) - (2 + q \\cdot n_T + (1-q) \\cdot n_F)$$\n$$(1-p^{\\star}) M = 1 + n_T + n_F - 2 - q \\cdot n_T - n_F + q \\cdot n_F$$\n$$(1-p^{\\star}) M = n_T - q \\cdot n_T + q \\cdot n_F - 1$$\n$$(1-p^{\\star}) M = n_T(1-q) + q \\cdot n_F - 1$$\n\n现在，我们可以表示出 $p^{\\star}$：\n$$1 - p^{\\star} = \\frac{n_T(1-q) + q \\cdot n_F - 1}{M}$$\n$$p^{\\star} = 1 - \\frac{n_T(1-q) + q \\cdot n_F - 1}{M}$$\n\n问题给出了以下具体值：$n_T = 10$，$n_F = 4$，$q = 0.5$，$M = 15$。我们将这些值代入推导出的 $p^{\\star}$ 表达式中：\n$$p^{\\star} = 1 - \\frac{10(1-0.5) + 4(0.5) - 1}{15}$$\n$$p^{\\star} = 1 - \\frac{10(0.5) + 4(0.5) - 1}{15}$$\n$$p^{\\star} = 1 - \\frac{5 + 2 - 1}{15}$$\n$$p^{\\star} = 1 - \\frac{6}{15}$$\n$$p^{\\star} = 1 - \\frac{2}{5}$$\n$$p^{\\star} = 1 - 0.4$$\n$$p^{\\star} = 0.6$$\n\n问题要求答案为四舍五入到四位有效数字的小数。\n$$p^{\\star} = 0.6000$$", "answer": "$$\\boxed{0.6000}$$", "id": "3630750"}, {"introduction": "存储器层次结构对处理器性能至关重要，而缓存系统的设计是一个经典的成本与性能权衡挑战。本练习将引导您探索如何在1级（$L_1$）和2级（$L_2$）缓存的大小之间进行权衡，您会用到关联缓存大小与命中时间和未命中率的数学模型，从而建立一个关于总内存停顿时间的综合性能模型。通过解决这个带预算约束的优化问题 [@problem_id:3630783]，您将学会如何在系统的不同组件间分配有限资源以达到最佳的全局性能，这是应用于关键硬件设计的核心工程思维。", "problem": "一个单线程顺序处理器执行一个包含 $N = 2 \\times 10^{8}$ 条指令的程序，平均每条指令有 $r = 0.5$ 次内存引用。内存层次结构包括一个大小为 $S_{1}$ (单位为 kibibyte) 的一级 (L1) 缓存和一个大小为 $S_{2}$ (单位为 kibibyte) 的二级 (L2) 缓存。对于缓存行为，以下经验校准关系成立：\n- L1 命中延迟为 $t_{L_{1}}(S_{1}) = t_{1} + b_{1} S_{1}$，其中 $t_{1} = 2$ 个周期，$b_{1} = 0.01$ 周期/kibibyte。\n- L1 未命中率为 $m_{1}(S_{1}) = \\dfrac{a_{1}}{S_{1}}$，其中 $a_{1} = 3.63$。\n- L2 命中延迟为 $t_{L_{2}}(S_{2}) = t_{2} + b_{2} S_{2}$，其中 $t_{2} = 6$ 个周期，$b_{2} = 0.01$ 周期/kibibyte。\n- L2 未命中率为 $m_{2}(S_{2}) = \\dfrac{a_{2}}{S_{2}}$，其中 $a_{2} = 9$。\n- L2 缓存的未命中会引起额外的 $T_{M} = 100$ 个周期的主内存停顿。\n\n假设每次内存引用都会使流水线停顿，停顿时间等于其命中或未命中层级的实际访问延迟，并且独立的内存引用在时间上不重叠（无内存级并行）。使用命中概率和未命中概率的定义、期望的线性性质以及给定的关于 $S_{1}$ 和 $S_{2}$ 的函数，推导每次内存引用的预期停顿周期表达式。然后，将整个程序的总停顿周期写成关于 $S_{1}$ 和 $S_{2}$ 的函数。在线性成本约束 $C(S_{1}, S_{2}) = c_{1} S_{1} + c_{2} S_{2} \\leq B$（其中 $c_{1} = 2$，$c_{2} = 1$，$B = 450$（成本单位））下，确定能使总停顿周期最小化的缓存大小 $S_{1}$ 和 $S_{2}$（单位为 kibibyte）。将您的最终答案表示为一个包含最优 $S_{1}$ 和 $S_{2}$（单位为 kibibyte）的行矩阵。无需四舍五入；给出精确值。", "solution": "用户提供的问题已经过分析，被认为是有效的。这是一个在计算机组成与体系结构领域内定义明确、有科学依据且客观的问题。任务是解决一个约束优化问题，以在给定的成本约束下找到最小化总内存停顿周期的最优缓存大小。\n\n程序中的总内存引用次数由指令数 $N$ 和平均每条指令的内存引用次数 $r$ 的乘积给出。\n$$N_{mem} = N \\times r = (2 \\times 10^{8}) \\times 0.5 = 1 \\times 10^{8}$$\n问题陈述，每次内存引用都会使流水线停顿，停顿时间等于其实际访问延迟。总停顿周期 $T_{stall}$ 是总内存引用次数与每次引用的预期停顿周期的乘积。每次引用的预期停顿时间等同于给定内存层次结构的平均内存访问时间 (AMAT)。\n\n两级缓存层次结构的 AMAT 由标准公式给出：\n$$AMAT = (\\text{L1 命中时间}) + (\\text{L1 未命中率}) \\times (\\text{L1 未命中代价})$$\nL1 未命中代价是在 L1 缓存中处理一次未命中所需的时间，这涉及到访问 L2 缓存。\n$$(\\text{L1 未命中代价}) = (\\text{L2 命中时间}) + (\\text{L2 未命中率}) \\times (\\text{L2 未命中代价})$$\n根据问题陈述：\n- L1 命中时间是 L1 命中延迟 $t_{L_{1}}(S_{1})$。\n- L1 未命中率是 $m_{1}(S_{1})$。\n- L2 命中时间是 L2 命中延迟 $t_{L_{2}}(S_{2})$。注意，这是在 L2 中命中的延迟，它构成了 L1 未命中代价的主要部分。\n- L2 未命中率 $m_{2}(S_{2})$ 是到达 L2 缓存的访问的局部未命中率。\n- L2 未命中代价是来自主内存的额外停顿 $T_{M}$。\n\n设 $E_{stall}(S_{1}, S_{2})$ 为每次内存引用的预期停顿周期。我们可以写出：\n$$E_{stall}(S_{1}, S_{2}) = t_{L_{1}}(S_{1}) + m_{1}(S_{1}) \\left[ t_{L_{2}}(S_{2}) + m_{2}(S_{2}) T_{M} \\right]$$\n整个程序的总停顿周期为：\n$$T_{stall}(S_{1}, S_{2}) = N_{mem} \\times E_{stall}(S_{1}, S_{2})$$\n为了最小化 $T_{stall}$，我们需要最小化 $E_{stall}(S_{1}, S_{2})$，因为 $N_{mem}$ 是一个正的常数。让我们定义要最小化的函数为 $f(S_{1}, S_{2}) = E_{stall}(S_{1}, S_{2})$。代入给定的经验关系：\n$t_{L_{1}}(S_{1}) = t_{1} + b_{1} S_{1}$\n$m_{1}(S_{1}) = \\dfrac{a_{1}}{S_{1}}$\n$t_{L_{2}}(S_{2}) = t_{2} + b_{2} S_{2}$\n$m_{2}(S_{2}) = \\dfrac{a_{2}}{S_{2}}$\n\n函数 $f(S_{1}, S_{2})$ 变为：\n$$f(S_{1}, S_{2}) = (t_{1} + b_{1} S_{1}) + \\frac{a_{1}}{S_{1}} \\left[ (t_{2} + b_{2} S_{2}) + \\left(\\frac{a_{2}}{S_{2}}\\right) T_{M} \\right]$$\n展开此表达式，我们得到：\n$$f(S_{1}, S_{2}) = t_{1} + b_{1} S_{1} + \\frac{a_{1} t_{2}}{S_{1}} + \\frac{a_{1} b_{2} S_{2}}{S_{1}} + \\frac{a_{1} a_{2} T_{M}}{S_{1} S_{2}}$$\n我们必须在成本约束 $C(S_{1}, S_{2}) = c_{1} S_{1} + c_{2} S_{2} \\leq B$ 和物理约束 $S_{1} > 0$ 和 $S_{2} > 0$ 下最小化此函数。对于 $S_{1}, S_{2} > 0$，函数 $f(S_{1}, S_{2})$ 是凸函数，且约束定义了一个凸集。最小值要么是位于可行域内的无约束最小值，要么位于区域的边界上。当 $S_{1} \\to 0$ 或 $S_{2} \\to 0$ 时，$f(S_{1}, S_{2}) \\to \\infty$，因此最小值不能在坐标轴上（$S_{1}=0$ 或 $S_{2}=0$）。\n\n我们首先通过将 $f(S_{1}, S_{2})$ 对 $S_{1}$ 和 $S_{2}$ 的偏导数设为零来找到无约束最小值。\n\n对 $S_{1}$ 的偏导数：\n$$\\frac{\\partial f}{\\partial S_{1}} = b_{1} - \\frac{a_{1} t_{2}}{S_{1}^{2}} - \\frac{a_{1} b_{2} S_{2}}{S_{1}^{2}} - \\frac{a_{1} a_{2} T_{M}}{S_{1}^{2} S_{2}}$$\n令 $\\frac{\\partial f}{\\partial S_{1}} = 0$：\n$$b_{1} = \\frac{1}{S_{1}^{2}} \\left( a_{1} t_{2} + a_{1} b_{2} S_{2} + \\frac{a_{1} a_{2} T_{M}}{S_{2}} \\right) \\implies b_{1} S_{1}^{2} = a_{1} \\left( t_{2} + b_{2} S_{2} + \\frac{a_{2} T_{M}}{S_{2}} \\right)$$\n\n对 $S_{2}$ 的偏导数：\n$$\\frac{\\partial f}{\\partial S_{2}} = \\frac{a_{1} b_{2}}{S_{1}} - \\frac{a_{1} a_{2} T_{M}}{S_{1} S_{2}^{2}}$$\n令 $\\frac{\\partial f}{\\partial S_{2}} = 0$ (并假设 $S_{1} > 0$)：\n$$\\frac{a_{1} b_{2}}{S_{1}} = \\frac{a_{1} a_{2} T_{M}}{S_{1} S_{2}^{2}} \\implies b_{2} = \\frac{a_{2} T_{M}}{S_{2}^{2}} \\implies S_{2}^{2} = \\frac{a_{2} T_{M}}{b_{2}}$$\n这给出了在临界点处 $S_{2}$ 的值：\n$$S_{2} = \\sqrt{\\frac{a_{2} T_{M}}{b_{2}}}$$\n现在，我们将此关系代回到第一个偏导数的方程中。从 $S_{2}^{2} = \\frac{a_{2} T_{M}}{b_{2}}$，我们有 $a_{2} T_{M} = b_{2} S_{2}^{2}$。因此，$\\frac{a_{2} T_{M}}{S_{2}} = b_{2} S_{2}$。\n$S_1$ 的方程变为：\n$$b_{1} S_{1}^{2} = a_{1} (t_{2} + b_{2} S_{2} + b_{2} S_{2}) = a_{1} (t_{2} + 2 b_{2} S_{2})$$\n我们还有 $b_{2} S_{2} = b_{2} \\sqrt{\\frac{a_{2} T_{M}}{b_{2}}} = \\sqrt{a_{2} b_{2} T_{M}}$。代入此式：\n$$b_{1} S_{1}^{2} = a_{1} (t_{2} + 2 \\sqrt{a_{2} b_{2} T_{M}})$$\n这给出了在临界点处 $S_{1}$ 的值：\n$$S_{1} = \\sqrt{\\frac{a_{1}}{b_{1}} \\left( t_{2} + 2 \\sqrt{a_{2} b_{2} T_{M}} \\right)}$$\n现在，我们代入给定的数值：\n$t_{1} = 2$, $t_{2} = 6$, $b_{1} = 0.01$, $b_{2} = 0.01$, $a_{1} = 3.63$, $a_{2} = 9$, $T_{M} = 100$。\n$c_{1} = 2$, $c_{2} = 1$, $B = 450$。\n\n首先，计算 $S_{2}$：\n$$S_{2} = \\sqrt{\\frac{9 \\times 100}{0.01}} = \\sqrt{\\frac{900}{0.01}} = \\sqrt{90000} = 300$$\n所以，无约束问题的最优 $S_{2}$ 是 $300$ kibibyte。\n\n接下来，计算中间项 $\\sqrt{a_{2} b_{2} T_{M}}$：\n$$\\sqrt{a_{2} b_{2} T_{M}} = \\sqrt{9 \\times 0.01 \\times 100} = \\sqrt{9} = 3$$\n现在，计算 $S_{1}$：\n$$S_{1} = \\sqrt{\\frac{3.63}{0.01} \\left( 6 + 2 \\times 3 \\right)} = \\sqrt{363 \\times (6 + 6)} = \\sqrt{363 \\times 12}$$\n$$S_{1} = \\sqrt{(3 \\times 121) \\times (3 \\times 4)} = \\sqrt{3^{2} \\times 11^{2} \\times 2^{2}} = \\sqrt{(3 \\times 11 \\times 2)^{2}} = 3 \\times 11 \\times 2 = 66$$\n所以，无约束问题的最优 $S_{1}$ 是 $66$ kibibyte。\n\n无约束最小值在点 ($S_{1}^{*}, S_{2}^{*}$) = ($66$, $300$)。我们现在必须验证该点是否满足成本约束 $c_{1} S_{1} + c_{2} S_{2} \\leq B$。\n$$C(66, 300) = (2 \\times 66) + (1 \\times 300) = 132 + 300 = 432$$\n预算为 $B = 450$。由于 $432 \\leq 450$，无约束最小值位于成本约束定义的可行域内。因为目标函数是凸函数，所以该点代表了约束优化问题的全局最小值。\n\n因此，使总停顿周期最小化的缓存大小为 $S_{1} = 66$ kibibyte 和 $S_{2} = 300$ kibibyte。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n66  & 300\n\\end{pmatrix}\n}\n$$", "id": "3630783"}, {"introduction": "流水线深度是现代处理器设计中的一个根本性参数。更深的流水线可以带来更高的时钟频率，但同时也加剧了分支预测错误等事件的惩罚，并受到芯片面积和功耗的严格限制。本练习 [@problem_id:3630871] 将引导您建立一个综合模型，来量化流水线深度 $d$ 如何同时影响时钟速度、指令执行效率、物理成本与功耗。通过求解这个多变量约束下的优化问题，您将体验到一个真实的高层次设计挑战，并深刻理解处理器性能是在多重物理和经济约束下进行全局权衡的最终产物。", "problem": "一个微架构团队正在探索流水线深度的成本-性能权衡，该深度被建模为一个实数、非负的设计参数 $d$。时钟频率随深度变化的函数为 $f(d) = f_{0}\\left(1 + \\alpha d\\right)$，而分支预测错误的惩罚（以周期为单位）随深度变化的函数为 $p(d) = p_{0} + \\beta d$。假设理想化的基础每指令周期数 (CPI) 为 $\\mathrm{CPI}_{\\mathrm{ideal}}$，每条已引退指令的分支预测错误率为 $r$（以概率表示）。假设每条指令因分支预测错误而产生的额外周期数是预测错误率与预测错误惩罚（以周期为单位）的乘积。根据流水线处理器的基本性能模型定义，每周期指令数 (IPC) 和每指令周期数 (CPI) 互为倒数。每秒指令数是每周期指令数与时钟频率的乘积。芯片面积随深度变化的函数为 $A(d) = A_{0} + a d$。功耗模型包括动态功耗 $P_{\\mathrm{dyn}}(d) = V^{2} f(d)\\left(C_{0} + c d\\right)$ 和泄漏功耗 $P_{\\mathrm{leak}}(d) = L_{0} + \\ell d$，总功耗为 $P(d) = P_{\\mathrm{dyn}}(d) + P_{\\mathrm{leak}}(d)$。设计必须满足面积预算和功耗上限：$A(d) \\leq A_{\\max}$ 和 $P(d) \\leq P_{\\max}$。将 $d$ 视为一个连续的实数变量。\n\n使用以下参数值，所有计算均采用国际单位制 (SI)：$f_{0} = 2.5 \\times 10^{9}\\ \\mathrm{Hz}$，$\\alpha = 0.04$，$\\mathrm{CPI}_{\\mathrm{ideal}} = 0.9$， $r = 0.04$，$p_{0} = 4$，$\\beta = 0.5$， $A_{0} = 60\\ \\mathrm{mm}^{2}$，$a = 3\\ \\mathrm{mm}^{2}$ 每级，$A_{\\max} = 150\\ \\mathrm{mm}^{2}$，$V = 1.0\\ \\mathrm{V}$，$C_{0} = 12 \\times 10^{-9}\\ \\mathrm{F}$，$c = 0.6 \\times 10^{-9}\\ \\mathrm{F}$ 每级，$L_{0} = 15\\ \\mathrm{W}$，$\\ell = 0.8\\ \\mathrm{W}$ 每级，以及 $P_{\\max} = 110\\ \\mathrm{W}$。功耗单位使用瓦特，频率单位使用赫兹，电容单位使用法拉，电压单位使用伏特，面积单位使用平方毫米。\n\n从每指令周期数和每秒指令数的核心定义（用频率和每指令周期数表示）以及给定的缩放定律出发，推导吞吐量作为 $d$ 的函数，分析其相对于 $d$ 的单调性，并确定在面积和功耗约束下能使每秒指令数最大化的流水线深度 $d^{\\star}$。将最终的最优深度 $d^{\\star}$ 报告为一个无量纲的数字。将您的答案四舍五入到 $4$ 位有效数字。将最终答案表示为不带单位的纯数字。", "solution": "首先根据指定标准验证问题陈述。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 流水线深度：$d$ (实数、非负的设计参数)\n- 时钟频率：$f(d) = f_{0}\\left(1 + \\alpha d\\right)$\n- 分支预测错误惩罚：$p(d) = p_{0} + \\beta d$（以周期为单位）\n- 理想CPI：$\\mathrm{CPI}_{\\mathrm{ideal}}$\n- 分支预测错误率：$r$（概率）\n- 额外周期规则：预测错误率和惩罚的乘积。\n- IPC/CPI 关系：互为倒数，$\\mathrm{IPC} = 1/\\mathrm{CPI}$。\n- 每秒指令数：IPC 和时钟频率的乘积。\n- 芯片面积：$A(d) = A_{0} + a d$\n- 动态功耗：$P_{\\mathrm{dyn}}(d) = V^{2} f(d)\\left(C_{0} + c d\\right)$\n- 泄漏功耗：$P_{\\mathrm{leak}}(d) = L_{0} + \\ell d$\n- 总功耗：$P(d) = P_{\\mathrm{dyn}}(d) + P_{\\mathrm{leak}}(d)$\n- 面积预算：$A(d) \\leq A_{\\max}$\n- 功耗上限：$P(d) \\leq P_{\\max}$\n- 参数值：\n  - $f_{0} = 2.5 \\times 10^{9}\\ \\mathrm{Hz}$\n  - $\\alpha = 0.04$\n  - $\\mathrm{CPI}_{\\mathrm{ideal}} = 0.9$\n  - $r = 0.04$\n  - $p_{0} = 4$\n  - $\\beta = 0.5$\n  - $A_{0} = 60\\ \\mathrm{mm}^{2}$\n  - $a = 3\\ \\mathrm{mm}^{2}$ 每级\n  - $A_{\\max} = 150\\ \\mathrm{mm}^{2}$\n  - $V = 1.0\\ \\mathrm{V}$\n  - $C_{0} = 12 \\times 10^{-9}\\ \\mathrm{F}$\n  - $c = 0.6 \\times 10^{-9}\\ \\mathrm{F}$ 每级\n  - $L_{0} = 15\\ \\mathrm{W}$\n  - $\\ell = 0.8\\ \\mathrm{W}$ 每级\n  - $P_{\\max} = 110\\ \\mathrm{W}$\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题使用标准的处理器性能一阶模型（CPI, IPC）、频率、面积和功耗随流水线深度变化的缩放模型。这些模型虽然经过简化，却是计算机体系结构教育和分析中的主要内容，代表了微架构设计中的基本权衡。该问题牢固地植根于计算机组成与体系结构的原理。\n- **适定性：** 这是一个约束优化问题。它要求在一个由清晰、可量化的约束定义的域上，最大化一个明确定义的目标函数（吞吐量）。所有必要的参数都已提供，并且它们的单位对于所需的计算是一致的（例如，$V^2fC$ 正确地得到功耗单位）。预期存在唯一解。\n- **客观性：** 问题以精确的技术语言陈述，没有主观或模糊的术语。\n- **完整性和一致性：** 问题是自洽的。求解所需的所有变量、函数、约束和数值都已明确提供。给定信息中没有矛盾之处。\n\n**步骤 3：结论与行动**\n该问题是有效的，因为它科学合理、适定、客观且完整。将推导完整的解决方案。\n\n### 求解推导\n\n主要目标是找到在面积和功耗约束下，能使处理器吞吐量（以每秒指令数衡量）最大化的流水线深度 $d$。设吞吐量为 $T(d)$。\n\n首先，我们推导总的每指令周期数 $\\mathrm{CPI}(d)$ 的表达式。总 $\\mathrm{CPI}$ 是理想 $\\mathrm{CPI}$ 与由分支预测错误导致的每指令惩罚周期数之和。\n每次分支预测错误的惩罚由 $p(d) = p_{0} + \\beta d$ 给出。\n分支预测错误率为 $r$。\n由于预测错误导致的每指令额外周期数是错误率与惩罚的乘积：$r \\cdot p(d)$。\n因此，总 $\\mathrm{CPI}$ 作为深度 $d$ 的函数是：\n$$ \\mathrm{CPI}(d) = \\mathrm{CPI}_{\\mathrm{ideal}} + r \\cdot p(d) = \\mathrm{CPI}_{\\mathrm{ideal}} + r (p_{0} + \\beta d) $$\n\n接下来，我们推导每周期指令数 $\\mathrm{IPC}(d)$，它是 $\\mathrm{CPI}(d)$ 的倒数：\n$$ \\mathrm{IPC}(d) = \\frac{1}{\\mathrm{CPI}(d)} = \\frac{1}{\\mathrm{CPI}_{\\mathrm{ideal}} + r (p_{0} + \\beta d)} $$\n\n吞吐量 $T(d)$ 是 $\\mathrm{IPC}(d)$ 和时钟频率 $f(d)$ 的乘积：\n$$ T(d) = \\mathrm{IPC}(d) \\cdot f(d) $$\n代入 $\\mathrm{IPC}(d)$ 和 $f(d) = f_{0}(1 + \\alpha d)$ 的表达式：\n$$ T(d) = \\frac{f_{0}(1 + \\alpha d)}{\\mathrm{CPI}_{\\mathrm{ideal}} + r (p_{0} + \\beta d)} $$\n\n为了找到最优的 $d$，我们首先分析 $T(d)$ 相对于 $d$ 的单调性。我们使用商法则计算导数 $T'(d)$。设分子为 $N(d) = f_{0}(1 + \\alpha d)$，分母为 $D(d) = \\mathrm{CPI}_{\\mathrm{ideal}} + r(p_{0} + \\beta d)$。\n$$ T'(d) = \\frac{N'(d)D(d) - N(d)D'(d)}{[D(d)]^2} $$\n分子和分母的导数是：\n$$ N'(d) = f_{0}\\alpha $$\n$$ D'(d) = r\\beta $$\n将这些代入商法则表达式：\n$$ T'(d) = \\frac{(f_{0}\\alpha)(\\mathrm{CPI}_{\\mathrm{ideal}} + r(p_{0} + \\beta d)) - (f_{0}(1 + \\alpha d))(r\\beta)}{[\\mathrm{CPI}_{\\mathrm{ideal}} + r(p_{0} + \\beta d)]^2} $$\n$T'(d)$ 的符号由其分子决定，因为分母是一个平方项，对于实数 $d$ 总是正的。让我们展开并简化分子：\n$$ f_{0}\\alpha(\\mathrm{CPI}_{\\mathrm{ideal}} + rp_{0}) + f_{0}\\alpha r\\beta d - f_{0}r\\beta - f_{0}\\alpha r\\beta d = f_{0}[\\alpha(\\mathrm{CPI}_{\\mathrm{ideal}} + rp_{0}) - r\\beta] $$\n导数的符号取决于 $\\alpha(\\mathrm{CPI}_{\\mathrm{ideal}} + rp_{0}) - r\\beta$ 这一项。让我们用给定的参数来计算它：\n- $\\alpha = 0.04$\n- $\\mathrm{CPI}_{\\mathrm{ideal}} = 0.9$\n- $r = 0.04$\n- $p_{0} = 4$\n- $\\beta = 0.5$\n$$ \\alpha(\\mathrm{CPI}_{\\mathrm{ideal}} + rp_{0}) = 0.04(0.9 + 0.04 \\times 4) = 0.04(0.9 + 0.16) = 0.04(1.06) = 0.0424 $$\n$$ r\\beta = 0.04 \\times 0.5 = 0.02 $$\n差值为 $0.0424 - 0.02 = 0.0224$。因为这个值是正的，所以对于所有 $d \\ge 0$，$T'(d) > 0$。这意味着吞吐量 $T(d)$ 是流水线深度 $d$ 的严格单调递增函数。\n\n为了最大化一个单调递增函数，我们必须找到满足所有约束的 $d$ 的最大可能值。对 $d$ 的约束是：\n1. $d \\ge 0$ (给定)\n2. 面积约束: $A(d) \\leq A_{\\max}$\n3. 功耗约束: $P(d) \\leq P_{\\max}$\n\n让我们分析面积约束：\n$A_{0} + a d \\leq A_{\\max}$\n$60 + 3 d \\leq 150$\n$3 d \\leq 90$\n$d \\leq 30$\n设这个上界为 $d_{\\text{area}} = 30$。\n\n接下来，让我们分析功耗约束：\n$P(d) = P_{\\mathrm{dyn}}(d) + P_{\\mathrm{leak}}(d) \\leq P_{\\max}$\n$V^{2} f(d)\\left(C_{0} + c d\\right) + L_{0} + \\ell d \\leq P_{\\max}$\n代入 $f(d)$ 的表达式和参数值：\n$ (1.0)^{2} (2.5 \\times 10^{9})(1 + 0.04d)(12 \\times 10^{-9} + 0.6 \\times 10^{-9}d) + 15 + 0.8d \\leq 110 $\n让我们展开这些项：\n$ (2.5)(1 + 0.04d)(12 + 0.6d) + 15 + 0.8d \\leq 110 $\n$ 2.5(12 + 0.6d + 0.48d + 0.024d^2) + 15 + 0.8d - 110 \\leq 0 $\n$ 2.5(12 + 1.08d + 0.024d^2) - 95 + 0.8d \\leq 0 $\n$ 30 + 2.7d + 0.06d^2 - 95 + 0.8d \\leq 0 $\n这可以简化为一个二次不等式：\n$ 0.06d^2 + 3.5d - 65 \\leq 0 $\n\n我们使用二次公式 $d = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 来求解二次方程 $0.06d^2 + 3.5d - 65 = 0$ 的根：\n$$ d = \\frac{-3.5 \\pm \\sqrt{(3.5)^2 - 4(0.06)(-65)}}{2(0.06)} $$\n$$ d = \\frac{-3.5 \\pm \\sqrt{12.25 + 15.6}}{0.12} $$\n$$ d = \\frac{-3.5 \\pm \\sqrt{27.85}}{0.12} $$\n两个根是：\n$ d_1 = \\frac{-3.5 - \\sqrt{27.85}}{0.12}  0$，由于 $d \\ge 0$，这个根没有物理意义。\n$ d_2 = \\frac{-3.5 + \\sqrt{27.85}}{0.12} \\approx \\frac{-3.5 + 5.2773099}{0.12} \\approx \\frac{1.7773099}{0.12} \\approx 14.810916 $\n设这个上界为 $d_{\\text{power}} \\approx 14.810916$。由于该二次函数是一个开口向上的抛物线，不等式 $0.06d^2 + 3.5d - 65 \\leq 0$ 在其两根之间的 $d$ 值上成立。结合 $d \\ge 0$ 的约束，功耗约束意味着 $0 \\le d \\le d_{\\text{power}}$。\n\n$d$ 的可行域是所有约束的交集：\n$d \\ge 0$\n$d \\le d_{\\text{area}} = 30$\n$d \\le d_{\\text{power}} \\approx 14.810916$\n因此，总的约束是 $0 \\le d \\le \\min(30, 14.810916)$，即 $0 \\le d \\le 14.810916$。\n\n由于吞吐量 $T(d)$ 是单调递增的，它在可行区间 $[0, 14.810916]$ 上的最大值将出现在右端点。因此，最优流水线深度 $d^{\\star}$ 是：\n$$ d^{\\star} = d_{\\text{power}} = \\frac{-3.5 + \\sqrt{27.85}}{0.12} \\approx 14.810916 $$\n问题要求答案四舍五入到 $4$ 位有效数字。\n$$ d^{\\star} \\approx 14.81 $$\n\n最优流水线深度 $d^{\\star}$ 由功耗约束决定，该约束比面积约束更严格。", "answer": "$$\\boxed{14.81}$$", "id": "3630871"}]}