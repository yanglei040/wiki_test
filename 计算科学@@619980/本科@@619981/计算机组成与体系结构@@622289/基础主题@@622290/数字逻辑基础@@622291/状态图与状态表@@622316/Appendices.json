{"hands_on_practices": [{"introduction": "在复杂的计算机系统中，多个处理单元常常需要争用共享资源，例如内存端口或总线。一个高效且公平的仲裁器对于维持系统性能至关重要。本练习将引导您设计一个有限状态机（FSM）作为仲裁器，它不仅要根据预设的公平性规则（如严格轮换）来分配资源访问权，还要考虑现实世界中的开销，如上下文切换的延迟。通过这个实践 [@problem_id:3680680]，您将学习如何将系统级的时间行为（服务时间和开销时间）建模为状态，并最终量化您的设计对系统性能（吞吐量）的影响。", "problem": "一个计算机系统包含 $2$ 个独立的执行流水线，标记为 $P_{A}$ 和 $P_{B}$，它们共享一个内存端口。每个流水线一旦被授予对端口的访问权限，就可以发出内存请求，并且在重度内存密集型工作负载下，两个流水线都持续有待处理的请求。该内存端口是非流水线式的，一次处理一个请求，每个请求需要 $t_{s}$ 个周期。当在连续处理的请求之间，被授权的流水线从一个切换到另一个时，上下文重配置会产生 $t_{o}$ 个空闲周期的额外开销，在此期间端口无法处理任何请求。\n\n你需要设计一个确定性有限状态机（FSM），当两个流水线都有待处理请求时，通过严格交替来确保公平性：如果两个流水线的队列中都有请求，FSM将交替授权 $P_{A}, P_{B}, P_{A}, P_{B}, \\dots$；如果只有一个流水线有待处理请求，FSM将继续授权该流水线，而不会产生切换开销。定义二进制输入 $r_{A}$ 和 $r_{B}$ 表示 $P_{A}$ 或 $P_{B}$ 是否有待处理请求（$1$ 表示有，$0$ 表示空），以及二进制输出 $g_{A}$ 和 $g_{B}$ 表示对 $P_{A}$ 或 $P_{B}$ 的授权（$1$ 表示授权，$0$ 表示未授权）。要求FSM使用最少数量的状态，并包含任何必要的瞬时状态来模拟流水线切换时的重配置开销。\n\n给定具体参数 $t_{s} = 2$ 和 $t_{o} = 1$，并假设在重度竞争情况下，$r_{A} = 1$ 和 $r_{B} = 1$ 始终成立，请根据第一性原理推导出最小FSM状态集、其在上述规则下的状态转换行为和输出行为，并计算在这种竞争和交替策略下内存端口的稳态吞吐量（以每周期请求数为单位）。将最终吞吐量表示为每周期请求数的精确有理数（不要求四舍五入）。", "solution": "所述问题具有科学依据，定义明确，客观，并包含足够的信息以获得唯一解。这是一个关于资源仲裁和性能分析的计算机体系结构标准问题。因此，该问题是有效的。\n\n任务是设计一个有限状态机（FSM）来仲裁对共享内存端口的访问，然后计算其在重度竞争下的稳态吞吐量。系统有两个流水线 $P_{A}$ 和 $P_{B}$，请求信号为 $r_{A}$ 和 $r_{B}$，授权信号为 $g_{A}$ 和 $g_{B}$。一个内存请求需要 $t_{s} = 2$ 个周期来处理。流水线之间的切换会产生 $t_{o} = 1$ 个空闲周期的开销。\n\n为了设计FSM，我们必须创建一组状态，以捕捉服务周期和开销周期的时序。此处适合使用摩尔（Moore）机模型，其输出是当前状态的函数。状态不仅必须表示哪个流水线正在被服务，还必须表示在多周期服务或开销周期内的进度。要求使用最少数量的状态集。\n\n我们来定义状态：\n- $S_{IDLE}$：端口空闲，没有请求在被服务。输出：$(g_{A}, g_{B}) = (0, 0)$。\n- $S_{A1}$：为流水线 $P_{A}$ 服务的 $2$ 周期中的第一个周期。输出：$(g_{A}, g_{B}) = (1, 0)$。\n- $S_{A2}$：为流水线 $P_{A}$ 服务的 $2$ 周期中的第二个周期。输出：$(g_{A}, g_{B}) = (1, 0)$。\n- $S_{B1}$：为流水线 $P_{B}$ 服务的 $2$ 周期中的第一个周期。输出：$(g_{A}, g_{B}) = (0, 1)$。\n- $S_{B2}$：为流水线 $P_{B}$ 服务的 $2$ 周期中的第二个周期。输出：$(g_{A}, g_{B}) = (0, 1)$。\n- $S_{O \\to A}$：从 $P_{B}$ 切换到 $P_{A}$ 时的 $1$ 周期开销。输出：$(g_{A}, g_{B}) = (0, 0)$。\n- $S_{O \\to B}$：从 $P_{A}$ 切换到 $P_{B}$ 时的 $1$ 周期开销。输出：$(g_{A}, g_{B}) = (0, 0)$。\n\n对于摩尔机来说，这组 $7$ 个状态是最小的，因为服务状态和开销状态代表了一个序列中不同的时间点，不能合并。两个开销状态 $S_{O \\to A}$ 和 $S_{O \\to B}$ 是必需的，因为尽管它们的输出相同，但它们的无条件下一状态不同（分别为 $S_{A1}$ 和 $S_{B1}$）。同样地，$S_{IDLE}$ 因其基于新请求的条件转移逻辑而与开销状态不同。\n\n状态转换逻辑如下：\n- 从 $S_{IDLE}$：如果没有请求（$(r_{A}, r_{B})=(0,0)$），则保持在 $S_{IDLE}$ 状态。如果只有一个流水线有请求，则开始为其服务（对于 $(1,0)$ 转换到 $S_{A1}$，对于 $(0,1)$ 转换到 $S_{B1}$）。如果两者都有请求（$(1,1)$），我们必须开始交替序列。按照惯例，我们从 $P_{A}$ 开始，转换到 $S_{A1}$。\n- 在为 $P_{A}$（$S_{A1}$, $S_{A2}$）或 $P_{B}$（$S_{B1}$, $S_{B2}$）服务期间，FSM无条件地推进服务周期。$S_{A1} \\to S_{A2}$ 和 $S_{B1} \\to S_{B2}$。这些转换与输入 $r_A, r_B$ 无关，因为服务一旦开始，就不能被抢占。\n- 服务完成后（从 $S_{A2}$ 或 $S_{B2}$），FSM检查请求输入。\n- 从 $S_{A2}$：如果只有 $P_{A}$ 有请求（$(r_{A}, r_{B})=(1,0)$），我们可以通过转换到 $S_{A1}$ 立即为 $P_{A}$ 开始新的服务，从而避免开销。如果 $P_{B}$ 有请求（$(r_{A}, r_{B})=(0,1)$ 或 $(1,1)$），则需要切换，因此我们转换到开销状态 $S_{O \\to B}$。在竞争（$(1,1)$）下的严格交替策略强制要求进行此切换。如果没有请求（$(0,0)$），我们转换到 $S_{IDLE}$。\n- 从 $S_{B2}$：对称地，如果只有 $P_{B}$ 有请求（$(0,1)$），我们循环回到 $S_{B1}$。如果 $P_{A}$ 有请求（$(1,0)$ 或 $(1,1)$），我们必须切换，因此转换到 $S_{O \\to A}$。如果没有剩余请求（$(0,0)$），我们转到 $S_{IDLE}$。\n- 从一个开销状态（$S_{O \\to A}$ 或 $S_{O \\to B}$），转换是无条件的，进入目标流水线的服务开始状态。$S_{O \\to A} \\to S_{A1}$ 和 $S_{O \\to B} \\to S_{B1}$。\n\n现在我们分析重度竞争的特定情况，其中 $r_{A} = 1$ 和 $r_{B} = 1$ 始终成立。FSM将在一个闭环中运行，强制执行严格交替。让我们追踪状态序列。假设周期在对 $P_{B}$ 的服务刚结束后开始。\n1.  当前状态：$S_{B2}$。输入为 $(r_{A}, r_{B})=(1,1)$。由于来自 $P_A$ 的请求待处理且强制交替，必须进行切换。FSM转换到开销状态 $S_{O \\to A}$。\n2.  状态 $S_{O \\to A}$：此状态持续 $t_{o} = 1$ 个周期。授权输出为 $(g_{A}, g_{B}) = (0, 0)$。FSM无条件转换到 $S_{A1}$。\n3.  状态 $S_{A1}$：这是为 $P_A$ 服务的第一个周期。它持续 $1$ 个周期。输出为 $(1, 0)$。FSM无条件转换到 $S_{A2}$。\n4.  状态 $S_{A2}$：这是为 $P_A$ 服务的第二个也是最后一个周期。它持续 $1$ 个周期。输出为 $(1, 0)$。为 $P_A$ 的服务总共需要 $t_{s} = 2$ 个周期。在此状态结束时，FSM检查输入。由于 $(r_{A}, r_{B})=(1,1)$，它必须切换到 $P_B$，转换到 $S_{O \\to B}$。\n5.  状态 $S_{O \\to B}$：此开销状态持续 $t_{o} = 1$ 个周期。输出为 $(0, 0)$。FSM无条件转换到 $S_{B1}$。\n6.  状态 $S_{B1}$：为 $P_B$ 服务的第一个周期。它持续 $1$ 个周期。输出为 $(0, 1)$。FSM无条件转换到 $S_{B2}$。\n7.  状态 $S_{B2}$：为 $P_B$ 服务的第二个周期。它持续 $1$ 个周期。输出为 $(0, 1)$。对 $P_B$ 的服务现已完成（总共 $t_s = 2$ 个周期）。FSM检查输入 $(1,1)$ 并转换回 $S_{O \\to A}$，完成整个交替周期。\n\n稳态下的状态周期为 $S_{O \\to A} \\to S_{A1} \\to S_{A2} \\to S_{O \\to B} \\to S_{B1} \\to S_{B2} \\to S_{O \\to A}$。\n一个完整循环的总周期数是这些状态持续时间的总和：\n总周期数 = $1$ (对于 $S_{O \\to A}$) + $1$ (对于 $S_{A1}$) + $1$ (对于 $S_{A2}$) + $1$ (对于 $S_{O \\to B}$) + $1$ (对于 $S_{B1}$) + $1$ (对于 $S_{B2}$) = $6$ 个周期。\n\n在这个 $6$ 周期的循环中，有两个请求被完全服务：一个为 $P_{A}$（在 $S_{A1}, S_{A2}$ 期间）和一个为 $P_{B}$（在 $S_{B1}, S_{B2}$ 期间）。\n\n吞吐量定义为每周期服务的请求数。\n吞吐量 = $\\frac{\\text{总服务请求数}}{\\text{总周期数}}$\n吞吐量 = $\\frac{2}{6} = \\frac{1}{3}$ 请求/周期。\n\n这可以被推广。服务一个流水线并切换到另一个的时间是 $t_s + t_o$。对于一个涉及两个流水线的完整交替周期，总时间是为 $P_A$ 后跟 $P_B$ 服务的 $(t_s + t_o)$，再加上为 $P_B$ 后跟 $P_A$ 服务的另一个 $(t_s + t_o)$。这是不正确的。服务来自每个流水线的一个请求的总时间是（为 $P_A$ 服务的 $t_s$）+（切换到 $P_B$ 的 $t_o$）+（为 $P_B$ 服务的 $t_s$）+（切换到 $P_A$ 的 $t_o$）。\n服务 $2$ 个请求的总时间 $= t_{s} + t_{o} + t_{s} + t_{o} = 2(t_{s} + t_{o})$。\n吞吐量 = $\\frac{2}{2(t_s+t_o)} = \\frac{1}{t_s+t_o}$。\n使用给定值 $t_s=2$ 和 $t_o=1$：\n吞吐量 = $\\frac{1}{2+1} = \\frac{1}{3}$ 请求/周期。\n结果是一致的。", "answer": "$$\n\\boxed{\\frac{1}{3}}\n$$", "id": "3680680"}, {"introduction": "除了响应外部输入，状态机在生成可预测序列方面也扮演着核心角色，这是处理器内部许多功能的基础。同步计数器便是一个绝佳的例子，它被广泛用于程序计数器、循环控制以及时序生成等。这个练习 [@problem_id:1947756] 将让您亲手实践一个模为 $N$ 的计数器的设计过程，从定义状态序列开始，到推导触发器（在此为 JK 触发器）的激励方程，最终完成逻辑简化。这有助于您掌握将抽象的状态转换要求具体化为门级电路实现的完整流程。", "problem": "一位数字系统工程师的任务是设计一个同步模5计数器。该计数器需要按一个直接的二进制序列（0, 1, 2, 3, 4，然后从0重复）进行循环。该设计将使用三个JK触发器来实现，其输出被指定为状态变量 $Q_2, Q_1, Q_0$，其中 $Q_2$ 是最高有效位（MSB）。为了逻辑最小化，3位空间中的任何未使用状态都可以被视为无关项。\n\n你的任务是确定每个触发器的J和K输入的简化布尔逻辑表达式集。从以下选项中选择正确的表达式集。\n\nA. $J_2 = Q_1, K_2 = Q_1; \\quad J_1 = Q_0, K_1 = Q_0; \\quad J_0 = 1, K_0 = 1$\n\nB. $J_2 = Q_1 Q_0, K_2 = Q_2; \\quad J_1 = Q_0, K_1 = Q_0; \\quad J_0 = Q_2', K_0 = 1$\n\nC. $J_2 = Q_1 Q_0, K_2 = 1; \\quad J_1 = Q_0, K_1 = Q_0; \\quad J_0 = Q_2', K_0 = 1$\n\nD. $J_2 = 1, K_2 = Q_1 Q_0; \\quad J_1 = Q_0, K_1 = Q_0; \\quad J_0 = 1, K_0 = Q_2'$\n\nE. $J_2 = Q_2'Q_1Q_0, K_2 = Q_2; \\quad J_1 = Q_1'Q_0, K_1 = Q_2'Q_0; \\quad J_0 = Q_2'Q_0', K_0 = 1$", "solution": "我们正在设计一个同步模5计数器，使用三个JK触发器，状态变量为 $Q_{2}$ (MSB), $Q_{1}$ 和 $Q_{0}$。所需的直接二进制计数序列为 $000 \\to 001 \\to 010 \\to 011 \\to 100 \\to 000$。未使用的状态 $101,110,111$ 被视为无关项以简化逻辑。\n\n对于JK触发器，从现态 $Q$ 到次态 $Q^{+}$ 的激励要求如下：\n- $0 \\to 0$: $J=0$, $K=$ 无关项。\n- $0 \\to 1$: $J=1$, $K=$ 无关项。\n- $1 \\to 0$: $J=$ 无关项, $K=1$。\n- $1 \\to 1$: $J=$ 无关项, $K=0$。\n\n等效地，在最小化过程中允许使用无关项进行赋值，\n$$\nJ = \\overline{Q}\\,Q^{+}, \\qquad K = Q\\,\\overline{Q^{+}},\n$$\n需要理解的是，对于表中未对 $J$ 或 $K$ 提出要求的转换，这些输入在最小化时可视为无关项。\n\n我们推导每个触发器的输入方程。\n\n1) 对于 $Q_{0}$：\n根据序列，在使用的现态下，$Q_{0}$ 的转换如下：\n- $000: 0 \\to 1$,\n- $001: 1 \\to 0$,\n- $010: 0 \\to 1$,\n- $011: 1 \\to 0$,\n- $100: 0 \\to 0$.\n因此，在状态 $000$ 和 $010$ 时需要 $J_{0}=1$；在状态 $001$ 和 $011$ 时需要 $K_{0}=1$；在状态 $100$ 时，$J_{0}=0$ 且 $K_{0}$ 是无关项。对于所有其他单元（未使用状态），输入是无关项。\n\n对于 $J_{0}$，利用无关项化简，可以将 $000$ 和 $010$ 处两个必需的 1 与无关项单元组合起来，得到简化表达式\n$$\nJ_{0} = \\overline{Q}_{2}.\n$$\n对于 $K_{0}$，由于没有出现 $Q_{0}:1 \\to 1$ 的使用状态转换，我们可以为所有使用状态选择 $K_{0}=1$（并且在无关项状态下也将其设为1），从而得到最简单的有效选择\n$$\nK_{0} = 1.\n$$\n\n2) 对于 $Q_{1}$：\n根据序列，在使用状态下 $Q_{1}$ 的转换如下：\n- $000: 0 \\to 0$,\n- $001: 0 \\to 1$,\n- $010: 1 \\to 1$,\n- $011: 1 \\to 0$,\n- $100: 0 \\to 0$.\n因此，仅在 $001$ 时 $J_{1}=1$；仅在 $011$ 时 $K_{1}=1$；在其他地方，根据激励规则，相应的输入要么是0，要么是无关项。观察到在现态 $001$ 和 $011$ 时恰好有 $Q_{0}=1$，我们可以用同一个信号实现这两种激励：\n$$\nJ_{1} = Q_{0}, \\qquad K_{1} = Q_{0}.\n$$\n\n3) 对于 $Q_{2}$：\n根据序列，在使用状态下 $Q_{2}$ 的转换如下：\n- $000: 0 \\to 0$,\n- $001: 0 \\to 0$,\n- $010: 0 \\to 0$,\n- $011: 0 \\to 1$,\n- $100: 1 \\to 0$.\n因此，仅在 $011$ 时 $J_{2}=1$，这恰好是条件 $Q_{1}Q_{0}=1$，所以\n$$\nJ_{2} = Q_{1}Q_{0}.\n$$\n对于 $K_{2}$，唯一需要的 1 是在状态 $100$ 处（$1 \\to 0$ 的转换）。所有其他使用状态都允许将 $K_{2}$ 视为无关项。因此，我们可以选择最简单的有效赋值\n$$\nK_{2} = 1,\n$$\n因为这满足了在 $100$ 处所需的复位要求，并且不违反任何使用的转换（没有 $Q_{2}:1 \\to 1$ 这种会强制要求 $K_2=0$ 的使用情况）。\n\n综合以上结果，简化的输入方程为\n$$\nJ_{2} = Q_{1}Q_{0}, \\quad K_{2} = 1; \\qquad J_{1} = Q_{0}, \\quad K_{1} = Q_{0}; \\qquad J_{0} = \\overline{Q}_{2}, \\quad K_{0} = 1,\n$$\n这与选项C相符。", "answer": "$$\\boxed{C}$$", "id": "1947756"}]}