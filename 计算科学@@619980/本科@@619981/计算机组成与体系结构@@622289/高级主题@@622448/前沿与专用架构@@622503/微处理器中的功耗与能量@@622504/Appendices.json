{"hands_on_practices": [{"introduction": "现代处理器必须在严格的功耗预算内运行，这一预算被称为热设计功耗（$P_{\\text{TDP}}$）。本练习模拟了一种“功率病毒”——一种旨在最大化功耗的最坏情况工作负载——来演示处理器如何超出其 $P_{\\text{TDP}}$ 限制。通过首先计算峰值功率，然后评估不同的应对策略，您将对热管理这一关键任务以及性能与功耗之间的权衡获得实践性的理解。[@problem_id:3666610]", "problem": "一个$4$核微处理器在标称性能状态 $P0$ 下运行，其电源电压 $V$ 和时钟频率 $f$ 分别为：$V=1.0\\,\\text{V}$ 和 $f=3.0\\,\\text{GHz}$。每个核心包含三个主要单元，在 $P0$ 条件下每个周期的有效开关电容分别为：整数算术逻辑单元簇 ($C_{\\text{ALU}}=1.6\\,\\text{nF}$)，浮点单指令多数据单元 ($C_{\\text{FP}}=1.2\\,\\text{nF}$)，以及加载/存储单元 ($C_{\\text{LS}}=0.8\\,\\text{nF}$)。该芯片还具有共享结构：末级缓存 ($C_{\\text{LLC}}=1.5\\,\\text{nF}$) 和片上网络 ($C_{\\text{NET}}=0.4\\,\\text{nF}$)。一个综合压力工作负载（一种“功率病毒”）能够同时在各个单元上驱动高开关活动因子，在 $P0$ 状态下达到 $\\alpha_{\\text{ALU}}=0.95, \\alpha_{\\text{FP}}=0.90, \\alpha_{\\text{LS}}=0.60, \\alpha_{\\text{LLC}}=0.80, \\alpha_{\\text{NET}}=0.50$。在 $P0$ 状态下的漏电功耗贡献了一个基线值 $P_{\\text{leak}}=12\\,\\text{W}$。\n\n存在两种更低的动态电压和频率缩放（DVFS）状态：$P1$ 状态下 $V=0.90\\,\\text{V}$ 和 $f=2.4\\,\\text{GHz}$，以及 $P2$ 状态下 $V=0.80\\,\\text{V}$ 和 $f=1.8\\,\\text{GHz}$。它们的漏电贡献根据经验表征为 $P_{\\text{leak}}(P1)=9\\,\\text{W}$ 和 $P_{\\text{leak}}(P2)=6\\,\\text{W}$。该平台的热设计功耗（TDP）限制为 $P_{\\text{TDP}}=45\\,\\text{W}$。\n\n假设压力工作负载维持所述的活动因子，动态功耗贡献在各单元和核心间累加，并且共享结构的活动由该病毒下核心的总需求主导。考虑到，应用每核心的占空比节流（在保持 $V$ 和 $f$ 不变的情况下暂停固定比例的周期）会按占空比成比例地缩放动态功耗和吞吐量，并且 DVFS 会随 $f$ 成比例地缩放吞吐量。\n\n任务：估算在 $P0$ 状态下，该病毒引起的最坏情况下的瞬时总功率 $P_{\\max}$。然后选择一个选项，该选项既能 (i) 提供对 $P0$ 状态下 $P_{\\max}$ 的正确估算，又能 (ii) 规定一种对策，在所列策略中以最小的性能损失保证功耗低于或等于 $P_{\\text{TDP}}$。\n\n选项：\n- A. 估算 $P0$ 状态下的 $P_{\\max}$ 为 $54\\,\\text{W}$；在 $P0$ 状态下强制执行每核心 $75\\%$ 活动（$25\\%$ 暂停）的占空比，产生的最坏情况功耗约为 $43\\,\\text{W}$。\n\n- B. 估算 $P0$ 状态下的 $P_{\\max}$ 为 $53.16\\,\\text{W}$；转换到 $P1$ 状态，产生的最坏情况功耗约为 $35.66\\,\\text{W}$，吞吐量下降约 $20\\%$。\n\n- C. 估算 $P0$ 状态下的 $P_{\\max}$ 为 $53.16\\,\\text{W}$；在 $P0$ 状态下将浮点发射宽度限制 $50\\%$（降低浮点活动，其他不变），产生的最坏情况功耗约为 $46\\,\\text{W}$。\n\n- D. 估算 $P0$ 状态下的 $P_{\\max}$ 为 $53.16\\,\\text{W}$；转换到 $P2$ 状态，产生的最坏情况功耗约为 $21.8\\,\\text{W}$，吞吐量下降约 $40\\%$。", "solution": "问题陈述已经过验证，被认为是科学上合理、定义明确且内部一致的。为得出唯一解所需的所有数据均已提供，所涉及的物理原理（CMOS 功耗，DVFS）在计算机工程中是标准内容。\n\n主要任务是首先计算该 $4$ 核微处理器在标称性能状态 $P0$ 下，承受压力工作负载时的最大瞬时功耗 $P_{\\max}$。随后，我们必须评估几种提议的功耗管理策略，以确定哪一种策略能成功将功耗降低到热设计功耗（$P_{\\text{TDP}}$）限制以内，同时产生最小的性能损失。\n\n总功率 $P_{\\text{total}}$ 是动态功率 $P_{\\text{dyn}}$ 和静态（漏电）功率 $P_{\\text{leak}}$ 的和。\n$$P_{\\text{total}} = P_{\\text{dyn}} + P_{\\text{leak}}$$\n给定单元的动态功率使用以下公式计算：\n$$P_{\\text{dyn}} = \\alpha C V^2 f$$\n其中 $\\alpha$ 是开关活动因子，$C$ 是开关电容，$V$ 是电源电压，$f$ 是时钟频率。总动态功率是所有活动组件动态功率的总和。\n\n**步骤 1：计算性能状态 $P0$ 下的 $P_{\\max}$**\n\n状态 $P0$ 的给定参数为：$V_{P0} = 1.0\\,\\text{V}$，$f_{P0} = 3.0\\,\\text{GHz} = 3.0 \\times 10^9\\,\\text{Hz}$，以及 $P_{\\text{leak}, P0} = 12\\,\\text{W}$。核心数量为 $N_{\\text{cores}} = 4$。\n\n首先，我们计算单个核心的动态功率 $P_{\\text{dyn, core}}$，它是其组成单元（ALU, FP, LS）功率的总和。\n$$P_{\\text{dyn, core}} = (\\alpha_{\\text{ALU}} C_{\\text{ALU}} + \\alpha_{\\text{FP}} C_{\\text{FP}} + \\alpha_{\\text{LS}} C_{\\text{LS}}) V_{P0}^2 f_{P0}$$\n代入给定值：\n$$C_{\\text{eff, core}} = (0.95 \\times 1.6 \\times 10^{-9}\\,\\text{F}) + (0.90 \\times 1.2 \\times 10^{-9}\\,\\text{F}) + (0.60 \\times 0.8 \\times 10^{-9}\\,\\text{F})$$\n$$C_{\\text{eff, core}} = (1.52 \\times 10^{-9}\\,\\text{F}) + (1.08 \\times 10^{-9}\\,\\text{F}) + (0.48 \\times 10^{-9}\\,\\text{F}) = 3.08 \\times 10^{-9}\\,\\text{F}$$\n现在，我们计算一个核心的动态功率：\n$$P_{\\text{dyn, core}} = (3.08 \\times 10^{-9}\\,\\text{F}) \\times (1.0\\,\\text{V})^2 \\times (3.0 \\times 10^9\\,\\text{Hz}) = 9.24\\,\\text{W}$$\n\n接下来，我们计算共享结构（包括 LLC 和片上网络）的动态功率 $P_{\\text{dyn, shared}}$。\n$$P_{\\text{dyn, shared}} = (\\alpha_{\\text{LLC}} C_{\\text{LLC}} + \\alpha_{\\text{NET}} C_{\\text{NET}}) V_{P0}^2 f_{P0}$$\n代入给定值：\n$$C_{\\text{eff, shared}} = (0.80 \\times 1.5 \\times 10^{-9}\\,\\text{F}) + (0.50 \\times 0.4 \\times 10^{-9}\\,\\text{F})$$\n$$C_{\\text{eff, shared}} = (1.20 \\times 10^{-9}\\,\\text{F}) + (0.20 \\times 10^{-9}\\,\\text{F}) = 1.40 \\times 10^{-9}\\,\\text{F}$$\n现在，我们计算共享结构的动态功率：\n$$P_{\\text{dyn, shared}} = (1.40 \\times 10^{-9}\\,\\text{F}) \\times (1.0\\,\\text{V})^2 \\times (3.0 \\times 10^9\\,\\text{Hz}) = 4.20\\,\\text{W}$$\n\n总动态功率 $P_{\\text{dyn, total}}$ 是所有 $4$ 个核心和共享结构功率的总和。\n$$P_{\\text{dyn, total}} = N_{\\text{cores}} \\times P_{\\text{dyn, core}} + P_{\\text{dyn, shared}}$$\n$$P_{\\text{dyn, total}} = 4 \\times 9.24\\,\\text{W} + 4.20\\,\\text{W} = 36.96\\,\\text{W} + 4.20\\,\\text{W} = 41.16\\,\\text{W}$$\n\n最后，$P0$ 状态下的最大瞬时总功率 $P_{\\max}$ 是总动态功率和漏电功率的和。\n$$P_{\\max} = P_{\\text{dyn, total}} + P_{\\text{leak}, P0} = 41.16\\,\\text{W} + 12\\,\\text{W} = 53.16\\,\\text{W}$$\n该功耗水平超过了 $P_{\\text{TDP}} = 45\\,\\text{W}$ 的限制，因此需要采取对策。\n\n**步骤 2：评估每个选项**\n\n**选项 A：**估算 $P0$ 状态下的 $P_{\\max}$ 为 $54\\,\\text{W}$；在 $P0$ 状态下强制执行每核心 $75\\%$ 活动（$25\\%$ 暂停）的占空比，产生的最坏情况功耗约为 $43\\,\\text{W}$。\n\n- 估算的 $P_{\\max} \\approx 54\\,\\text{W}$ 是不正确的。我们精确计算出的值为 $53.16\\,\\text{W}$。\n- 我们还是来分析一下这个对策。在 $P0$ 状态下，$d = 0.75$ 的占空比会按比例缩放总动态功率。由于 $V$ 和 $f$ 保持不变，漏电功率也保持不变。\n- 新的总功率：$P'_{\\text{total}} = d \\times P_{\\text{dyn, total}} + P_{\\text{leak}, P0} = 0.75 \\times 41.16\\,\\text{W} + 12\\,\\text{W} = 30.87\\,\\text{W} + 12\\,\\text{W} = 42.87\\,\\text{W}$。\n- 声称的功耗约为 $43\\,\\text{W}$ 与我们的计算结果一致。然而，该选项的初始前提（$P_{\\max}$ 的估算值）是错误的。\n\n结论：**不正确**。对 $P_{\\max}$ 的估算错误。\n\n**选项 B：**估算 $P0$ 状态下的 $P_{\\max}$ 为 $53.16\\,\\text{W}$；转换到 $P1$ 状态，产生的最坏情况功耗约为 $35.66\\,\\text{W}$，吞吐量下降约 $20\\%$。\n\n- 估算的 $P_{\\max} = 53.16\\,\\text{W}$ 是正确的。\n- 对策是转换到状态 $P1$：$V_{P1} = 0.90\\,\\text{V}$，$f_{P1} = 2.4\\,\\text{GHz}$，$P_{\\text{leak}, P1} = 9\\,\\text{W}$。\n- 动态功率与 $V^2 f$ 成正比。我们可以通过缩放 $P0$ 状态的值来找到新的动态功率 $P_{\\text{dyn}, P1}$。\n$$P_{\\text{dyn}, P1} = P_{\\text{dyn, total}} \\times \\frac{V_{P1}^2 f_{P1}}{V_{P0}^2 f_{P0}} = 41.16\\,\\text{W} \\times \\frac{(0.90)^2 \\times 2.4}{(1.0)^2 \\times 3.0} = 41.16\\,\\text{W} \\times \\frac{0.81 \\times 2.4}{3.0} = 41.16\\,\\text{W} \\times 0.648 = 26.67168\\,\\text{W}$$\n- $P1$ 状态下的新总功率为：\n$$P_{\\text{total}, P1} = P_{\\text{dyn}, P1} + P_{\\text{leak}, P1} = 26.67168\\,\\text{W} + 9\\,\\text{W} = 35.67168\\,\\text{W}$$\n- 这个值约为 $35.67\\,\\text{W}$，与选项声称的约 $35.66\\,\\text{W}$ 相符（存在微小的舍入差异）。这低于 $P_{\\text{TDP}} = 45\\,\\text{W}$。\n- 吞吐量与频率成正比。性能下降为：\n$$\\text{Drop} = 1 - \\frac{f_{P1}}{f_{P0}} = 1 - \\frac{2.4\\,\\text{GHz}}{3.0\\,\\text{GHz}} = 1 - 0.8 = 0.2 \\text{ or } 20\\%$$\n- 声称的吞吐量下降约 $20\\%$ 是正确的。\n- 此选项提供了一个有效的对策，性能损失为 $20\\%$。\n\n结论：**正确**。所有声明均已验证。\n\n**选项 C：**估算 $P0$ 状态下的 $P_{\\max}$ 为 $53.16\\,\\text{W}$；在 $P0$ 状态下将浮点发射宽度限制 $50\\%$（降低浮点活动，其他不变），产生的最坏情况功耗约为 $46\\,\\text{W}$。\n\n- 估算的 $P_{\\max} = 53.16\\,\\text{W}$ 是正确的。\n- 对策是将 FP 活动降低 $50\\%$。新的 $\\alpha'_{\\text{FP}} = 0.5 \\times 0.90 = 0.45$。这只影响 FP 单元的动态功率。\n- 总动态功率的减少量是所有核心的 FP 单元功耗的差值。\n- 所有 $4$ 个 FP 单元的原始动态功率：$P_{\\text{dyn,FP,total}} = N_{\\text{cores}} \\times (\\alpha_{\\text{FP}} C_{\\text{FP}}) V_{P0}^2 f_{P0} = 4 \\times (0.90 \\times 1.2 \\times 10^{-9}\\,\\text{F}) \\times (1.0\\,\\text{V})^2 \\times (3.0 \\times 10^9\\,\\text{Hz}) = 12.96\\,\\text{W}$。\n- 减少量是该值的 $50\\%$：$\\Delta P_{\\text{dyn}} = 0.5 \\times 12.96\\,\\text{W} = 6.48\\,\\text{W}$。\n- 新的总功率是：$P'_{\\text{total}} = P_{\\max} - \\Delta P_{\\text{dyn}} = 53.16\\,\\text{W} - 6.48\\,\\text{W} = 46.68\\,\\text{W}$。\n- 声称的新功耗约为 $46\\,\\text{W}$，与我们计算出的 $46.68\\,\\text{W}$ 接近。\n- 然而，新功耗 $46.68\\,\\text{W}$ **大于** $P_{\\text{TDP}} = 45\\,\\text{W}$ 的限制。此策略不足以保证功耗保持在热包络内。\n\n结论：**不正确**。该策略未能将功耗降低到所要求的 $P_{\\text{TDP}}$ 以下。\n\n**选项 D：**估算 $P0$ 状态下的 $P_{\\max}$ 为 $53.16\\,\\text{W}$；转换到 $P2$ 状态，产生的最坏情况功耗约为 $21.8\\,\\text{W}$，吞吐量下降约 $40\\%$。\n\n- 估算的 $P_{\\max} = 53.16\\,\\text{W}$ 是正确的。\n- 对策是转换到状态 $P2$：$V_{P2} = 0.80\\,\\text{V}$，$f_{P2} = 1.8\\,\\text{GHz}$，$P_{\\text{leak}, P2} = 6\\,\\text{W}$。\n- 我们从 $P0$ 状态缩放动态功率：\n$$P_{\\text{dyn}, P2} = P_{\\text{dyn, total}} \\times \\frac{V_{P2}^2 f_{P2}}{V_{P0}^2 f_{P0}} = 41.16\\,\\text{W} \\times \\frac{(0.80)^2 \\times 1.8}{(1.0)^2 \\times 3.0} = 41.16\\,\\text{W} \\times \\frac{0.64 \\times 1.8}{3.0} = 41.16\\,\\text{W} \\times 0.384 = 15.79776\\,\\text{W}$$\n- $P2$ 状态下的新总功率为：\n$$P_{\\text{total}, P2} = P_{\\text{dyn}, P2} + P_{\\text{leak}, P2} = 15.79776\\,\\text{W} + 6\\,\\text{W} = 21.79776\\,\\text{W}$$\n- 这个值约为 $21.8\\,\\text{W}$，与选项的声明相符。这低于 $P_{\\text{TDP}} = 45\\,\\text{W}$。\n- 性能下降为：\n$$\\text{Drop} = 1 - \\frac{f_{P2}}{f_{P0}} = 1 - \\frac{1.8\\,\\text{GHz}}{3.0\\,\\text{GHz}} = 1 - 0.6 = 0.4 \\text{ or } 40\\%$$\n- 声称的吞吐量下降约 $40\\%$ 是正确的。\n- 此选项提供了一个有效的对策，性能损失为 $40\\%$。\n\n结论：**正确**。所有声明均已验证。\n\n**步骤 3：最终比较**\n\n我们必须选择一个既能保证功耗低于或等于 $P_{\\text{TDP}}$，又具有*最小性能损失*的选项。\n- 选项 B 是一个有效的策略，性能损失为 $20\\%$。\n- 选项 D 是一个有效的策略，性能损失为 $40\\%$。\n\n比较两者，选项 B 的性能损失更小（$20\\%$ 对比 $40\\%$）。因此，它是所提供选项中的最优选择。", "answer": "$$\\boxed{B}$$", "id": "3666610"}, {"introduction": "动态电压与频率调节（DVFS）是管理功耗的一项主要技术，但切换电源状态并非瞬时或无代价的；它会产生时间和能量开销。本练习要求您确定“盈亏平衡点”——即一个任务必须运行的最短持续时间，以使切换到低功耗状态是值得的。掌握这一概念对于设计智能的功耗管理策略至关重要，这些策略可避免因频繁、短暂的状态切换而浪费能量。[@problem_id:3666624]", "problem": "一个通用微处理器支持动态电压频率调整 (DVFS)，该技术允许在两个工作点之间切换：一个高性能状态和一个低功耗状态。考虑一个固定的挂钟持续时间为 $T$ 的单一程序阶段，在此期间，系统可以始终保持在高性能状态，也可以在该阶段内切换到低功耗状态。在任何状态下，微处理器的总功耗都是动态功耗和漏电功耗之和，其中动态功耗的模型为 $P_{\\mathrm{dyn}} = C_{\\mathrm{eff}} V^{2} f$，漏电功耗的模型为 $P_{\\mathrm{leak}} = V I_{\\mathrm{leak}}$。这里 $C_{\\mathrm{eff}}$ 表示总有效开关电容。\n\n给定以下测量参数：\n- 有效开关电容 $C_{\\mathrm{eff}} = 9 \\times 10^{-9}$ F。\n- 高性能状态电压 $V_{\\mathrm{H}} = 1.10$ V，频率 $f_{\\mathrm{H}} = 3.2 \\times 10^{9}$ Hz，漏电流 $I_{\\mathrm{leak,H}} = 12$ A。\n- 低功耗状态电压 $V_{\\mathrm{L}} = 0.80$ V，频率 $f_{\\mathrm{L}} = 1.6 \\times 10^{9}$ Hz，漏电流 $I_{\\mathrm{leak,L}} = 5$ A。\n\n状态之间的切换会产生开销：每次 DVFS 转换需要额外的能量 $E_{\\mathrm{tr}} = 0.30$ J，并耗时 $t_{\\mathrm{tr}} = 2.0 \\times 10^{-3}$ s。假设在阶段边界切换进出低功耗状态时，每个阶段有两次转换。同时假设额外能量 $E_{\\mathrm{tr}}$ 是在处理器于转换期间稳定保持在低功耗状态本应消耗的能量之外的开销，并且转换所花费的时间使该阶段内可用于累积低功耗能量节省的时间总共减少了 $2 t_{\\mathrm{tr}}$。\n\n从动态功耗、漏电功耗以及能量作为功耗对时间积分的定义出发，推导最小阶段长度 $t^{*}$，使得在该阶段切换到低功耗状态相对于整个阶段保持在高性能状态能够产生非负的净能量节省。用毫秒表示 $t^{*}$，并将最终答案四舍五入到四位有效数字。", "solution": "问题要求解最小阶段长度，我们将其表示为 $T$，使得在该阶段持续时间内切换到低功耗状态与保持在高性能状态相比，能提供非负的能量节省。这个最小时间表示为 $t^{*}$。\n\n首先，我们建立功耗模型。总功耗 $P$ 是动态功耗 $P_{\\mathrm{dyn}}$ 和漏电功耗 $P_{\\mathrm{leak}}$ 的和。\n给定的模型是：\n$P_{\\mathrm{dyn}} = C_{\\mathrm{eff}} V^{2} f$\n$P_{\\mathrm{leak}} = V I_{\\mathrm{leak}}$\n所以，总功耗为 $P = C_{\\mathrm{eff}} V^{2} f + V I_{\\mathrm{leak}}$。\n\n我们使用给定的参数来计算高性能状态下的总功耗（$P_{\\mathrm{H}}$）和低功耗状态下的总功耗（$P_{\\mathrm{L}}$）。\n\n参数如下：\n有效开关电容 $C_{\\mathrm{eff}} = 9 \\times 10^{-9}$ F。\n高性能状态：$V_{\\mathrm{H}} = 1.10$ V, $f_{\\mathrm{H}} = 3.2 \\times 10^{9}$ Hz, $I_{\\mathrm{leak,H}} = 12$ A。\n低功耗状态：$V_{\\mathrm{L}} = 0.80$ V, $f_{\\mathrm{L}} = 1.6 \\times 10^{9}$ Hz, $I_{\\mathrm{leak,L}} = 5$ A。\n转换开销：能量 $E_{\\mathrm{tr}} = 0.30$ J，时间 $t_{\\mathrm{tr}} = 2.0 \\times 10^{-3}$ s。\n\n对于高性能状态：\n$P_{\\mathrm{dyn,H}} = C_{\\mathrm{eff}} V_{\\mathrm{H}}^{2} f_{\\mathrm{H}} = (9 \\times 10^{-9} \\, \\text{F}) \\times (1.10 \\, \\text{V})^{2} \\times (3.2 \\times 10^{9} \\, \\text{Hz}) = 9 \\times 1.21 \\times 3.2 \\, \\text{W} = 34.848$ W。\n$P_{\\mathrm{leak,H}} = V_{\\mathrm{H}} I_{\\mathrm{leak,H}} = (1.10 \\, \\text{V}) \\times (12 \\, \\text{A}) = 13.2$ W。\n$P_{\\mathrm{H}} = P_{\\mathrm{dyn,H}} + P_{\\mathrm{leak,H}} = 34.848 \\, \\text{W} + 13.2 \\, \\text{W} = 48.048$ W。\n\n对于低功耗状态：\n$P_{\\mathrm{dyn,L}} = C_{\\mathrm{eff}} V_{\\mathrm{L}}^{2} f_{\\mathrm{L}} = (9 \\times 10^{-9} \\, \\text{F}) \\times (0.80 \\, \\text{V})^{2} \\times (1.6 \\times 10^{9} \\, \\text{Hz}) = 9 \\times 0.64 \\times 1.6 \\, \\text{W} = 9.216$ W。\n$P_{\\mathrm{leak,L}} = V_{\\mathrm{L}} I_{\\mathrm{leak,L}} = (0.80 \\, \\text{V}) \\times (5 \\, \\text{A}) = 4.0$ W。\n$P_{\\mathrm{L}} = P_{\\mathrm{dyn,L}} + P_{\\mathrm{leak,L}} = 9.216 \\, \\text{W} + 4.0 \\, \\text{W} = 13.216$ W。\n\n现在我们定义在一个持续时间为 $T$ 的阶段中，两种情况下消耗的总能量。\n\n情况1：微处理器在整个持续时间 $T$ 内保持在高性能状态。\n消耗的总能量 $E_{\\mathrm{H}}$ 是恒定功耗 $P_{\\mathrm{H}}$ 与持续时间 $T$ 的乘积：\n$$E_{\\mathrm{H}} = P_{\\mathrm{H}} T$$\n\n情况2：微处理器切换到低功耗状态。\n这种情况涉及两次转换（例如，在阶段开始时从高到低，在结束时从低到高）。\n这两次转换的总时间为 $2 t_{\\mathrm{tr}}$。\n问题指出，此转换时间减少了可用于低功耗操作的时间。因此，处于低功耗状态的时间为 $T - 2 t_{\\mathrm{tr}}$。\n在这种情况下，总能量 $E_{\\mathrm{L,total}}$ 是三个部分的总和：\n1.  在稳定的低功耗操作期间消耗的能量：$P_{\\mathrm{L}} (T - 2t_{\\mathrm{tr}})$。\n2.  在转换期间消耗的能量。在没有其他信息的情况下，一个标准的保守假设是处理器在转换期间以较高的功耗水平 $P_{\\mathrm{H}}$ 运行。因此，能量为 $P_{\\mathrm{H}} (2t_{\\mathrm{tr}})$。\n3.  两次转换的额外显式能量开销，即 $2 E_{\\mathrm{tr}}$。\n\n将这些部分组合起来，总能量为：\n$$E_{\\mathrm{L,total}} = P_{\\mathrm{L}}(T - 2t_{\\mathrm{tr}}) + P_{\\mathrm{H}}(2t_{\\mathrm{tr}}) + 2E_{\\mathrm{tr}}$$\n\n当能量节省为零时，达到盈亏平衡点，这意味着两种情况下消耗的能量相等。为了获得非负的节省，我们必须有 $E_{\\mathrm{H}} \\geq E_{\\mathrm{L,total}}$。最小时间 $t^{*}$ 对应于等式 $E_{\\mathrm{H}} = E_{\\mathrm{L,total}}$。\n\n$$P_{\\mathrm{H}} T = P_{\\mathrm{L}}(T - 2t_{\\mathrm{tr}}) + P_{\\mathrm{H}}(2t_{\\mathrm{tr}}) + 2E_{\\mathrm{tr}}$$\n\n我们需要解这个关于 $T$ 的方程。\n$$P_{\\mathrm{H}} T = P_{\\mathrm{L}} T - 2P_{\\mathrm{L}}t_{\\mathrm{tr}} + 2P_{\\mathrm{H}}t_{\\mathrm{tr}} + 2E_{\\mathrm{tr}}$$\n重新整理各项以分离出 $T$：\n$$P_{\\mathrm{H}} T - P_{\\mathrm{L}} T = 2P_{\\mathrm{H}}t_{\\mathrm{tr}} - 2P_{\\mathrm{L}}t_{\\mathrm{tr}} + 2E_{\\mathrm{tr}}$$\n$$T(P_{\\mathrm{H}} - P_{\\mathrm{L}}) = 2t_{\\mathrm{tr}}(P_{\\mathrm{H}} - P_{\\mathrm{L}}) + 2E_{\\mathrm{tr}}$$\n功耗差为 $P_{\\mathrm{H}} - P_{\\mathrm{L}} = 48.048 \\, \\text{W} - 13.216 \\, \\text{W} = 34.832$ W。由于该值为正，我们可以用它来除：\n$$T = \\frac{2t_{\\mathrm{tr}}(P_{\\mathrm{H}} - P_{\\mathrm{L}})}{P_{\\mathrm{H}} - P_{\\mathrm{L}}} + \\frac{2E_{\\mathrm{tr}}}{P_{\\mathrm{H}} - P_{\\mathrm{L}}}$$\n$$t^{*} = T = 2t_{\\mathrm{tr}} + \\frac{2E_{\\mathrm{tr}}}{P_{\\mathrm{H}} - P_{\\mathrm{L}}}$$\n这个最小时间 $t^{*}$ 的表达式具有物理意义。它是在转换中损失的时间（$2t_{\\mathrm{tr}}$）与通过在降低的功耗水平下运行来分摊转换的固定能量成本（$2E_{\\mathrm{tr}}$）所需的时间之和。\n\n现在，我们代入数值：\n$t_{\\mathrm{tr}} = 2.0 \\times 10^{-3}$ s\n$E_{\\mathrm{tr}} = 0.30$ J\n$P_{\\mathrm{H}} - P_{\\mathrm{L}} = 34.832$ W\n\n$$t^{*} = 2 \\times (2.0 \\times 10^{-3} \\, \\text{s}) + \\frac{2 \\times 0.30 \\, \\text{J}}{34.832 \\, \\text{W}}$$\n$$t^{*} = 4.0 \\times 10^{-3} \\, \\text{s} + \\frac{0.60}{34.832} \\, \\text{s}$$\n$$t^{*} = 0.004 \\, \\text{s} + 0.017225539... \\, \\text{s}$$\n$$t^{*} = 0.021225539... \\, \\text{s}$$\n\n问题要求答案以毫秒为单位，并四舍五入到四位有效数字。\n$t^{*} = (0.021225539... ) \\times 1000$ ms $= 21.225539...$ ms。\n四舍五入到四位有效数字，我们得到 $21.23$ ms。", "answer": "$$\\boxed{21.23}$$", "id": "3666624"}, {"introduction": "随着我们进入多核时代，由于泄漏功率的影响日益增加，简单地增加更多核心并非总是最节能的解决方案。这个高级练习将阿姆达尔定律的并行加速模型与基本功耗模型相结合，以推导在给定工作负载下实现能量最优的核心数量。通过完成这个符号推导，您将揭示并行性能、动态功耗和静态泄漏之间深刻的权衡关系，这是现代处理器设计中的一个核心挑战。[@problem_id:3666685]", "problem": "一款多核微处理器使用动态电压和频率缩放（DVFS）技术，其电源电压和时钟频率之间的关系通过线性模型 $V(f) = \\beta f$ 给出，其中 $\\beta$ 是一个与技术相关的正常数，$f$ 是时钟频率。每个核心的动态功耗可以很好地用 $P_{\\text{dyn}} = \\gamma V^{2} f$ 来近似，其中 $\\gamma$ 是一个综合了有效开关电容和平均活动因子的正常数。每个核心还表现出漏电（静态）功耗，其模型为 $P_{\\text{leak}} = \\lambda V$，其中 $\\lambda$ 是一个正常数。假设只要核心通电，漏电功耗就持续存在，无论其是否在主动进行开关操作，并且在整个执行期间，所有 $n$ 个核心都保持通电。\n\n考虑在此处理器上完成一个包含 $W$ 个周期的固定作业。作业周期中的 $p$ 部分是完全可并行的，而剩下的 $1 - p$ 部分是串行的。您将比较该作业的两种实现方式：\n- 一种单核实现，运行频率为 $f_{1}$。\n- 一种 $n$ 核实现，其中每个核心以频率 $f_{2} = \\frac{f_{1}}{n}$ 运行（等吞吐率缩放），并在并行部分上获得理想的并行加速。\n\n假设指令级效率是理想的，因此任何核心上的每秒周期数都等于时钟频率，并且没有并行化开销。串行部分在单个核心上执行，并行部分在 $n$ 个核心上均匀执行。忽略核心动态和漏电功耗之外的任何能量（例如，内存和互连能量），并假设 $0  p  1$，$W > 0$，$f_{1} > 0$，$\\beta > 0$，$\\gamma > 0$ 和 $\\lambda > 0$。\n\n仅从给定的基本定律（$P_{\\text{dyn}} = \\gamma V^{2} f$，$P_{\\text{leak}} = \\lambda V$ 和 $V(f) = \\beta f$）以及基本时间关系 $T = \\frac{\\text{cycles}}{f}$ 出发，推导出在 $n$ 个核心上完成该作业所需的总能量（作为 $n$ 的函数），然后确定使该能量最小化的 $n$ 值（将 $n$ 视为一个正实数变量）。请将您的最终答案表示为使能量最小化的核心数 $n^{\\star}$ 的单个闭式符号表达式。不需要进行数值计算，最终表达式中也不应出现单位。如果发现多个驻点，请选择使能量最小化的那一个。", "solution": "### 解题推导\n我们的目标是找到使完成作业所消耗的总能量最小化的核心数 $n$。总能量 $E_{\\text{total}}(n)$ 是串行阶段消耗的能量 $E_{\\text{ser}}$ 和并行阶段消耗的能量 $E_{\\text{par}}$ 的总和。\n\n首先，我们为 $n$ 核系统建立电压和功耗关系。每个核心以频率 $f_{2} = \\frac{f_{1}}{n}$ 运行。相应的电源电压由DVFS模型给出：\n$$V_{2} = V(f_{2}) = \\beta f_{2} = \\frac{\\beta f_{1}}{n}$$\n在此电压和频率下运行的单个核心的动态功耗和漏电功耗可以用 $n$ 表示：\n单个活动核心的功耗为 $P_{\\text{core_active}} = P_{\\text{dyn}} + P_{\\text{leak}} = \\gamma V_{2}^{2} f_{2} + \\lambda V_{2}$。\n单个空闲但通电的核心的功耗仅为漏电功耗，$P_{\\text{core_idle}} = P_{\\text{leak}} = \\lambda V_{2}$。\n\n我们现在分析两个执行阶段。\n\n**1. 串行阶段**\n作业的串行部分包含 $W_{\\text{ser}} = W(1-p)$ 个周期。这部分在单个核心上以频率 $f_{2}$ 执行。此阶段所用时间为：\n$$T_{\\text{ser}} = \\frac{W_{\\text{ser}}}{f_{2}} = \\frac{W(1-p)}{f_{1}/n} = \\frac{n W (1-p)}{f_{1}}$$\n在此阶段，一个核心处于活动状态，其他 $n-1$ 个核心处于空闲但通电状态，只贡献漏电功耗。串行阶段的总功耗 $P_{\\text{ser}}$ 为：\n$$P_{\\text{ser}} = P_{\\text{core_active}} + (n-1) P_{\\text{core_idle}} = (\\gamma V_{2}^{2} f_{2} + \\lambda V_{2}) + (n-1) \\lambda V_{2} = \\gamma V_{2}^{2} f_{2} + n \\lambda V_{2}$$\n串行阶段消耗的能量为 $E_{\\text{ser}} = P_{\\text{ser}} \\times T_{\\text{ser}}$。代入 $T_{\\text{ser}}$ 和 $P_{\\text{ser}}$ 的表达式：\n$$E_{\\text{ser}} = (\\gamma V_{2}^{2} f_{2} + n \\lambda V_{2}) \\left( \\frac{W(1-p)}{f_{2}} \\right) = W(1-p) \\left(\\gamma V_{2}^{2} + \\frac{n \\lambda V_{2}}{f_{2}}\\right)$$\n代入 $V_{2} = \\beta f_{2}$ 和 $f_{2} = f_{1}/n$：\n$$E_{\\text{ser}} = W(1-p) \\left(\\gamma (\\beta f_{2})^{2} + n \\lambda \\beta\\right) = W(1-p) \\left(\\gamma \\beta^{2} \\left(\\frac{f_{1}}{n}\\right)^{2} + n \\lambda \\beta\\right) = W(1-p) \\left(\\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + n \\lambda \\beta\\right)$$\n\n**2. 并行阶段**\n作业的并行部分包含 $W_{\\text{par}} = W p$ 个周期。这项工作被完美地分配给 $n$ 个核心，因此每个核心执行 $W_{\\text{par,core}} = \\frac{W p}{n}$ 个周期。所有 $n$ 个核心都以频率 $f_{2}$ 同时运行。此阶段所用时间由任何单个核心完成其工作份额所需的时间决定：\n$$T_{\\text{par}} = \\frac{W_{\\text{par,core}}}{f_{2}} = \\frac{W p / n}{f_{1}/n} = \\frac{W p}{f_{1}}$$\n在此阶段，所有 $n$ 个核心都处于活动状态。总功耗 $P_{\\text{par}}$ 是所有 $n$ 个活动核心的功耗之和：\n$$P_{\\text{par}} = n \\times P_{\\text{core_active}} = n (\\gamma V_{2}^{2} f_{2} + \\lambda V_{2})$$\n并行阶段消耗的能量为 $E_{\\text{par}} = P_{\\text{par}} \\times T_{\\text{par}}$。代入 $T_{\\text{par}}$ 和 $P_{\\text{par}}$ 的表达式：\n$$E_{\\text{par}} = n(\\gamma V_{2}^{2} f_{2} + \\lambda V_{2}) \\left( \\frac{W p}{f_{1}} \\right)$$\n代入 $V_{2} = \\frac{\\beta f_{1}}{n}$ 和 $f_{2} = \\frac{f_{1}}{n}$：\n$$E_{\\text{par}} = n \\left( \\gamma \\left(\\frac{\\beta f_{1}}{n}\\right)^{2} \\left(\\frac{f_{1}}{n}\\right) + \\lambda \\left(\\frac{\\beta f_{1}}{n}\\right) \\right) \\left( \\frac{W p}{f_{1}} \\right) = \\left( \\frac{\\gamma \\beta^{2} f_{1}^{3}}{n^{2}} + \\lambda \\beta f_{1} \\right) \\left( \\frac{W p}{f_{1}} \\right) = W p \\left( \\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + \\lambda \\beta \\right)$$\n\n**3. 总能量与最小化**\n总能量 $E_{\\text{total}}(n)$ 是两个阶段能量的总和：\n$$E_{\\text{total}}(n) = E_{\\text{ser}} + E_{\\text{par}}$$\n$$E_{\\text{total}}(n) = W(1-p) \\left(\\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + n \\lambda \\beta\\right) + W p \\left( \\frac{\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + \\lambda \\beta \\right)$$\n我们可以展开并按 $n$ 的幂次对项进行分组：\n$$E_{\\text{total}}(n) = \\frac{W(1-p)\\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + W(1-p)n\\lambda\\beta + \\frac{W p \\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + W p \\lambda \\beta$$\n$$E_{\\text{total}}(n) = \\frac{W \\gamma \\beta^{2} f_{1}^{2} ((1-p)+p)}{n^{2}} + n W \\lambda \\beta (1-p) + W p \\lambda \\beta$$\n$$E_{\\text{total}}(n) = \\frac{W \\gamma \\beta^{2} f_{1}^{2}}{n^{2}} + n W \\lambda \\beta (1-p) + W p \\lambda \\beta$$\n为了找到使该能量最小化的 $n$ 值，我们将 $n$ 视为一个正实数变量，计算 $E_{\\text{total}}(n)$ 关于 $n$ 的导数，然后将其设为零。\n让我们定义常数以简化表达式：$A = W \\gamma \\beta^{2} f_{1}^{2}$，$B = W \\lambda \\beta (1-p)$ 和 $C = W p \\lambda \\beta$。能量函数为 $E(n) = A n^{-2} + B n + C$。\n$$\\frac{dE_{\\text{total}}}{dn} = \\frac{d}{dn} (A n^{-2} + B n + C) = -2 A n^{-3} + B$$\n将导数设为零以求得最佳核心数 $n^{\\star}$：\n$$-2 A (n^{\\star})^{-3} + B = 0 \\implies (n^{\\star})^{3} = \\frac{2A}{B}$$\n$$n^{\\star} = \\left(\\frac{2A}{B}\\right)^{\\frac{1}{3}}$$\n现在，我们将 $A$ 和 $B$ 的表达式代回方程中：\n$$n^{\\star} = \\left( \\frac{2 (W \\gamma \\beta^{2} f_{1}^{2})}{W \\lambda \\beta (1-p)} \\right)^{\\frac{1}{3}}$$\n工作负载项 $W$ 和一个因子 $\\beta$ 被消去：\n$$n^{\\star} = \\left( \\frac{2 \\gamma \\beta f_{1}^{2}}{\\lambda (1-p)} \\right)^{\\frac{1}{3}}$$\n为了确认这个驻点是一个最小值点，我们检查二阶导数：\n$$\\frac{d^{2}E_{\\text{total}}}{dn^{2}} = \\frac{d}{dn} (-2 A n^{-3} + B) = 6 A n^{-4} = \\frac{6A}{n^{4}}$$\n鉴于 $W > 0$, $\\gamma > 0$, $\\beta > 0$ 和 $f_{1} > 0$，常数 $A = W \\gamma \\beta^{2} f_{1}^{2}$ 严格为正。对于任何正的核心数 $n$，项 $n^{4}$ 也为正。因此，$\\frac{d^{2}E_{\\text{total}}}{dn^{2}} > 0$，这证实了函数 $E_{\\text{total}}(n)$ 在 $n > 0$ 时是凸函数，我们的解 $n^{\\star}$ 对应于一个全局最小值。", "answer": "$$\\boxed{\\left( \\frac{2 \\gamma \\beta f_{1}^{2}}{\\lambda (1-p)} \\right)^{\\frac{1}{3}}}$$", "id": "3666685"}]}