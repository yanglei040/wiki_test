{"hands_on_practices": [{"introduction": "本练习将深入探讨动态分支预测器的核心构建模块：2位饱和计数器。通过将其行为建模为马尔可夫链，我们可以为一个具有已知跳转概率的分支精确地量化其性能。这项练习 [@problem_id:3619723] 旨在将我们对预测器“学习模式”的定性理解，提升到定量的分析层面，为评估更复杂的预测机制打下坚实的数学基础。", "problem": "考虑一个两级自适应分支预测器，其模式历史表 (PHT) 的条目是由一个全局历史寄存器 (GHR) 索引的标准$2$位饱和计数器。关注与一个静态分支相关联的单个 PHT 条目，该分支的结果是独立同分布的 (i.i.d.)，其跳转概率为 $P(T)=0.6$，不跳转概率为 $P(N)=0.4$。这个$2$位饱和计数器有四个状态，代表整数值 $0,1,2,3$。当分支结果为跳转时，计数器加1，并在3处饱和；当分支结果为不跳转时，计数器减1，并在0处饱和。当计数器处于状态 $0$ 或 $1$ 时，预测器做出不跳转的预测；当处于状态 $2$ 或 $3$ 时，做出跳转的预测。\n\n将计数器的演化建模为一个离散时间马尔可夫链，其状态为 $s_{0}, s_{1}, s_{2}, s_{3}$，分别对应于计数器值 $0,1,2,3$。仅使用概率论和马尔可夫链的基本定义，以及上述标准的$2$位计数器更新规则：\n\n- 推导计数器状态的稳态概率分布 $\\pi = (\\pi_{0}, \\pi_{1}, \\pi_{2}, \\pi_{3})$。\n- 计算长期期望误预测率，其定义为在给定的预测器状态到预测的映射以及分支的独立同分布结果下，预测与结果不匹配的稳态期望比例。\n\n将 $P(T)$ 表示为 $p$，$P(N)$ 表示为 $q$，然后在最后设 $p=0.6$ 和 $q=0.4$。将你的最终答案以一个行向量的形式给出，包含四个稳态概率 $(\\pi_{0}, \\pi_{1}, \\pi_{2}, \\pi_{3})$ 和误预测率，使用精确值。不要四舍五入。无需单位。", "solution": "该问题是有效的，因为它在科学上基于马尔可夫链理论，是适定的，有唯一解，并且是客观的，包含了所有必要信息。我们开始解题。\n\n$2$位饱和计数器的演化可以建模为一个离散时间马尔可夫链。状态空间为 $S = \\{s_0, s_1, s_2, s_3\\}$，其中 $s_i$ 对应于计数器的整数值 $i$。分支结果是独立同分布的，跳转概率为 $P(T) = p = 0.6$，不跳转概率为 $P(N) = q = 0.4$。\n\n状态转移如下：\n- 从状态 $s_0$ (值 $0$)：当结果为‘跳转’(概率为 $p$)时，计数器增加到 $1$ (状态 $s_1$)。当结果为‘不跳转’(概率为 $q$)时，由于饱和，它保持在 $0$ (状态 $s_0$)。\n- 从状态 $s_1$ (值 $1$)：当结果为‘跳转’(概率为 $p$)时，计数器增加到 $2$ (状态 $s_2$)。当结果为‘不跳转’(概率为 $q$)时，它减少到 $0$ (状态 $s_0$)。\n- 从状态 $s_2$ (值 $2$)：当结果为‘跳转’(概率为 $p$)时，计数器增加到 $3$ (状态 $s_3$)。当结果为‘不跳转’(概率为 $q$)时，它减少到 $1$ (状态 $s_1$)。\n- 从状态 $s_3$ (值 $3$)：当结果为‘跳转’(概率为 $p$)时，由于饱和，计数器保持在 $3$ (状态 $s_3$)。当结果为‘不跳转’(概率为 $q$)时，它减少到 $2$ (状态 $s_2$)。\n\n这个系统是一个生灭过程。在稳态下，任何两个相邻状态之间的概率流必须平衡。设 $\\pi = (\\pi_0, \\pi_1, \\pi_2, \\pi_3)$ 为稳态概率分布。相邻状态之间切分的净流量的细致平衡方程为：\n\\begin{align*} \\label{eq:1}\n\\pi_0 p = \\pi_1 q  (\\text{流量 } s_0 \\leftrightarrow s_1) \\\\\n\\pi_1 p = \\pi_2 q  (\\text{流量 } s_1 \\leftrightarrow s_2) \\\\\n\\pi_2 p = \\pi_3 q  (\\text{流量 } s_2 \\leftrightarrow s_3)\n\\end{align*}\n从这些方程中，我们可以用 $\\pi_0$ 来表示 $\\pi_1$, $\\pi_2$ 和 $\\pi_3$。设 $\\rho = p/q$。\n\\begin{align*}\n\\pi_1 = \\pi_0 \\frac{p}{q} = \\pi_0 \\rho \\\\\n\\pi_2 = \\pi_1 \\frac{p}{q} = (\\pi_0 \\rho) \\rho = \\pi_0 \\rho^2 \\\\\n\\pi_3 = \\pi_2 \\frac{p}{q} = (\\pi_0 \\rho^2) \\rho = \\pi_0 \\rho^3\n\\end{align*}\n稳态概率的总和必须为 $1$：\n$$ \\pi_0 + \\pi_1 + \\pi_2 + \\pi_3 = 1 $$\n代入以 $\\pi_0$ 表示的表达式：\n$$ \\pi_0 + \\pi_0 \\rho + \\pi_0 \\rho^2 + \\pi_0 \\rho^3 = 1 $$\n$$ \\pi_0 (1 + \\rho + \\rho^2 + \\rho^3) = 1 $$\n这是一个有限几何级数，所以我们可以写成：\n$$ \\pi_0 \\left( \\frac{1 - \\rho^4}{1 - \\rho} \\right) = 1 $$\n$$ \\pi_0 = \\frac{1 - \\rho}{1 - \\rho^4} = \\frac{1}{1 + \\rho + \\rho^2 + \\rho^3} $$\n给定 $p=0.6$ 和 $q=0.4$，我们有 $\\rho = \\frac{0.6}{0.4} = \\frac{3}{2}$。\n现在我们计算分母：\n$$ 1 + \\rho + \\rho^2 + \\rho^3 = 1 + \\frac{3}{2} + \\left(\\frac{3}{2}\\right)^2 + \\left(\\frac{3}{2}\\right)^3 = 1 + \\frac{3}{2} + \\frac{9}{4} + \\frac{27}{8} $$\n$$ = \\frac{8}{8} + \\frac{12}{8} + \\frac{18}{8} + \\frac{27}{8} = \\frac{8+12+18+27}{8} = \\frac{65}{8} $$\n所以，$\\pi_0 = \\frac{1}{65/8} = \\frac{8}{65}$。\n现在我们可以求出其他概率：\n$$ \\pi_1 = \\pi_0 \\rho = \\frac{8}{65} \\times \\frac{3}{2} = \\frac{12}{65} $$\n$$ \\pi_2 = \\pi_1 \\rho = \\frac{12}{65} \\times \\frac{3}{2} = \\frac{18}{65} $$\n$$ \\pi_3 = \\pi_2 \\rho = \\frac{18}{65} \\times \\frac{3}{2} = \\frac{27}{65} $$\n稳态概率分布为 $\\pi = (\\frac{8}{65}, \\frac{12}{65}, \\frac{18}{65}, \\frac{27}{65})$。\n\n接下来，我们计算长期误预测率 $M$。预测器的规则是：\n- 如果计数器处于状态 $s_0$ 或 $s_1$，则预测‘不跳转’。\n- 如果计数器处于状态 $s_2$ 或 $s_3$，则预测‘跳转’。\n\n在以下两种情况下会发生误预测：\n1. 预测器预测‘不跳转’(处于状态 $s_0$ 或 $s_1$)而分支结果是‘跳转’(概率为 $p$)。\n2. 预测器预测‘跳转’(处于状态 $s_2$ 或 $s_3$)而分支结果是‘不跳转’(概率为 $q$)。\n\n总误预测率是这些不相交事件的概率之和：\n$$ M = P(\\text{状态} \\in \\{s_0, s_1\\}) \\times p + P(\\text{状态} \\in \\{s_2, s_3\\}) \\times q $$\n$$ M = (\\pi_0 + \\pi_1) p + (\\pi_2 + \\pi_3) q $$\n使用计算出的稳态概率：\n$$ \\pi_0 + \\pi_1 = \\frac{8}{65} + \\frac{12}{65} = \\frac{20}{65} $$\n$$ \\pi_2 + \\pi_3 = \\frac{18}{65} + \\frac{27}{65} = \\frac{45}{65} $$\n现在，将这些和以及 $p$ 和 $q$ 的值代入 $M$ 的表达式中：\n$$ M = \\left(\\frac{20}{65}\\right) p + \\left(\\frac{45}{65}\\right) q = \\left(\\frac{20}{65}\\right) \\frac{3}{5} + \\left(\\frac{45}{65}\\right) \\frac{2}{5} $$\n$$ M = \\frac{60}{325} + \\frac{90}{325} = \\frac{150}{325} $$\n化简分数：\n$$ M = \\frac{150 \\div 25}{325 \\div 25} = \\frac{6}{13} $$\n长期误预测率为 $\\frac{6}{13}$。\n\n最终答案要求一个行向量，包含四个稳态概率和误预测率。\n这些值为 $(\\pi_0, \\pi_1, \\pi_2, \\pi_3, M) = (\\frac{8}{65}, \\frac{12}{65}, \\frac{18}{65}, \\frac{27}{65}, \\frac{6}{13})$。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{8}{65}  \\frac{12}{65}  \\frac{18}{65}  \\frac{27}{65}  \\frac{6}{13} \\end{pmatrix} } $$", "id": "3619723"}, {"introduction": "在掌握了单个计数器的工作原理后，我们面临一个系统级挑战：当不同的分支竞争相同的预测资源时会发生什么？本练习 [@problem_id:3619712] 探讨了“路径干扰”（或称“别名”）这一导致误判的常见问题。我们将通过分析一个特定场景，揭示两个具有相同历史模式但未来行为不同的分支如何相互干扰，从而揭示历史长度与预测器表大小之间的根本性权衡。", "problem": "一个两级局部自分支预测器由一个局部历史表 (LHT) 和一个模式历史表 (PHT) 组成。LHT 为每个静态分支存储最近 $m$ 次的结果，形成一个 $m$ 位的局部历史。PHT 有 $S$ 个条目，每个条目是一个两位饱和计数器。PHT 仅通过 $m$ 位的局部历史值进行索引（不使用分支地址位），这意味着 PHT 被所有分支共享，所有相同的 $m$ 位历史都映射到同一个 PHT 条目。饱和计数器的更新规则是标准的两位方案：状态 $\\{00,01,10,11\\}$ 分别预测 $\\{\\text{未发生},\\text{未发生},\\text{发生},\\text{发生}\\}$。当分支结果为“发生”时，计数器加一；当结果为“未发生”时，计数器减一，并在两端饱和。假设所有 PHT 计数器都初始化为 $01$。\n\n考虑两个静态条件分支 $B_{1}$ 和 $B_{2}$，它们在如下的周期性踪迹中循环执行。在每个周期开始时，$B_{1}$ 和 $B_{2}$ 在 LHT 中的局部历史都等于 $m$ 位零向量 $H = 0^{m}$。该周期按以下方式进行：\n- 执行一次 $B_{1}$，实际结果为“发生”。\n- 执行一次 $B_{2}$，实际结果为“未发生”。\n- 然后，为了给下一个周期恢复相同的局部历史条件，连续执行 $m$ 次结果为“未发生”的 $B_{1}$，并连续执行 $m$ 次结果为“未发生”的 $B_{2}$，以便在下一个周期开始前，两个分支的局部历史都再次变为 $H = 0^{m}$。\n\n因此，在每个周期中，当每个分支首次访问 PHT 时，它们都有相同的最近 $m$ 次结果历史 $H$，但它们紧接着的未来走向却不同（一个发生，一个未发生）。因此，由 $H$ 索引的 PHT 条目被 $B_{1}$ 和 $B_{2}$ 共享，并接收到交替的“发生”和“未发生”结果的更新。\n\n从两级局部预测和两位饱和计数器动态学的基本定义出发，分析多个周期内共享 PHT 条目上每次访问的预测行为，并解释为什么这构成了路径干扰。从第一性原理出发，论证在 PHT 大小固定的情况下，当 $2^{m}  S$（不同的历史多于计数器）时，增加 $m$ 会如何因鸽巢原理而恶化预测错误，使得冲突不可避免，并妨碍对不同未来走向的区分。然后，在 PHT 由 $m$ 位局部历史直接索引（无哈希、无折叠）的情况下，确定最大的整数 $m$，使得所有可能的 $m$ 位历史到 PHT 条目之间存在一对一的映射，从而在原则上消除别名效应。\n\n计算当 PHT 大小为 $S = 2048$ 时的这个界限，并报告满足上述条件的单一整数值 $m_{\\max}$。无需四舍五入。", "solution": "该问题被确定为有效，因为它科学地基于计算机体系结构原理，特别是分支预测，并且问题陈述清晰，提供了唯一解所需的所有必要信息。\n\n问题描述了一个两级局部自分支预测器。该预测器使用一个局部历史表 (LHT) 为每个静态分支存储一个 $m$ 位历史向量，以及一个大小为 $S$ 的共享模式历史表 (PHT)。PHT 由 $m$ 位局部历史索引。PHT 中的每个条目是一个2位饱和计数器，它决定预测结果，并根据实际的分支结果进行更新。计数器状态 $\\{00, 01, 10, 11\\}$ 分别对应于“未发生”(NT)、“未发生”(NT)、“发生”(T)和“发生”(T)的预测。计数器在结果为 T 时递增，在结果为 NT 时递减，并在 $11$ 和 $00$ 处饱和。所有计数器都初始化为状态 $01$（弱未发生）。\n\n我们首先分析共享 PHT 条目的预测行为。问题设置了一个涉及两个分支 $B_1$ 和 $B_2$ 的周期性执行踪迹。在每个周期开始时，两个分支都有一个相同的全零局部历史 $H = 0^m$。因此，它们都将访问同一个 PHT 条目，我们将其表示为 $PHT[0^m]$。设一个周期开始时该计数器的状态为 $C$。最初，所有计数器都是 $01$，所以在第一个周期开始时，$C = 01$。\n\n周期展开如下：\n1. 执行 $B_1$。其历史为 $H = 0^m$。预测器访问 $PHT[0^m]$，其状态为 $01$。预测为 NT。实际结果为 T。这是一次**预测错误**。计数器通过递增更新：$01 \\rightarrow 10$。\n2. 执行 $B_2$。其历史也是 $H = 0^m$。预测器访问同一条目 $PHT[0^m]$，其状态现在是 $10$。预测为 T。实际结果为 NT。这也是一次**预测错误**。计数器通过递减更新：$10 \\rightarrow 01$。\n\n在这两个关键步骤结束时，计数器 $PHT[0^m]$ 已返回其初始状态 $01$。随后的恢复阶段，即两个分支都执行 $m$ 次连续的 NT 结果，用于将它们在 LHT 中的局部历史重置回 $0^m$，为下一个周期做准备。在这个恢复过程中，$B_1$ 和 $B_2$ 的历史会随着每个 NT 结果而改变。这些新的历史很可能会映射到不同的 PHT 条目，因此 $PHT[0^m]$ 的状态不受影响，在下一个周期开始时保持为 $01$。\n\n因此，这个循环在每个周期中都会重复。$B_1$ 总是遇到状态为 $01$ 的计数器，预测 NT，但实际为 T，导致一次预测错误并将计数器更新为 $10$。随后，$B_2$ 总是遇到状态为 $10$ 的计数器，预测 T，但实际为 NT，导致另一次预测错误并将计数器重置为 $01$。由于它们在共享 PHT 条目上的相互作用，两个分支总是预测错误。这种现象被称为**路径干扰**或**别名(aliasing)**。两条不同的执行路径（一条导致分支 $B_1$ 发生，另一条导致 $B_2$ 不发生），它们在分支前的历史模式相同，因此被映射到同一个硬件预测资源上。由于它们的结果不同，它们会“争夺”预测器状态的控制权，导致两者都持续地预测不佳。在这里，$B_1$ 训练预测器期望历史 $0^m$ 对应 T 结果，而 $B_2$ 则训练它期望 NT 结果。交替执行使得预测器无法正确学习任何一种模式。\n\n接下来，我们考虑在 PHT 大小 $S$ 固定的情况下增加历史长度 $m$ 的影响。更长的历史 $m$ 的目的是捕捉更复杂的模式并为预测提供更好的上下文，从而消除在使用较短历史时可能看起来相同的分支行为的歧义。唯一的 $m$ 位历史模式的数量为 $2^m$。这 $2^m$ 个不同的历史必须映射到 PHT 的 $S$ 个条目中。\n\n如果 $2^m \\le S$，原则上可以为每个不同的历史分配一个唯一的 PHT 条目。这将消除不同历史模式之间的别名。然而，如果我们增加 $m$ 使得 $2^m  S$，**鸽巢原理**规定多个不同的历史模式必须映射到同一个 PHT 条目。历史的数量随 $m$呈指数增长，而预测器条目数 $S$ 是固定的。对于大的 $m$，在单个 PHT 条目上发生冲突的历史数量会变得非常大。这加剧了路径干扰问题。例如，一个与“发生”结果强相关的历史 $H_1$，可能与一个与“未发生”结果强相关的历史 $H_2$ 映射到同一个 PHT 条目。它们的更新将产生破坏性干扰，从而降低预测准确性。因此，虽然理论上更大的 $m$ 为消除歧义提供了更多信息，但如果 PHT 不够大以支持它，其好处就会被抵消甚至逆转，因为增加的别名率会污染预测。预测器的性能可能会显著恶化。\n\n最后，我们需要找到最大的整数 $m$，记为 $m_{\\max}$，使得所有可能的 $m$ 位历史到 PHT 条目之间可以实现一对一映射。这个条件消除了不同历史模式之间的别名。一对一映射要求待映射的不同项目数量（$2^m$ 种可能的历史）不超过可用槽位数量（$S$ 个 PHT 条目）。这可以用不等式表示：\n$$2^m \\le S$$\n给定 PHT 大小 $S = 2048$。我们必须找到满足以下条件的最大整数 $m_{\\max}$：\n$$2^{m_{\\max}} \\le 2048$$\n为了求解 $m_{\\max}$，我们可以对两边取以 2 为底的对数：\n$$\\log_2(2^{m_{\\max}}) \\le \\log_2(2048)$$\n$$m_{\\max} \\le \\log_2(2048)$$\n我们可以通过识别 2 的幂来计算 $\\log_2(2048)$：\n$$2^{10} = 1024$$\n$$2^{11} = 2 \\times 2^{10} = 2 \\times 1024 = 2048$$\n因此，$\\log_2(2048) = 11$。不等式变为：\n$$m_{\\max} \\le 11$$\n由于 $m$ 必须是整数，满足此条件的最大整数值为 $11$。\n因此，$m_{\\max} = 11$。对于任何历史长度 $m  11$，在大小为 $2048$ 且采用直接索引的 PHT 中，不同历史模式之间的别名将不可避免。", "answer": "$$\\boxed{11}$$", "id": "3619712"}, {"introduction": "现实世界程序的行为复杂多变，单一的预测策略往往难以应对。本练习 [@problem_id:3619732] 探讨了一种先进的解决方案——锦标赛预测器，它通过组合多种策略来应对这一挑战。我们将聚焦于其核心的“选择器”机制，分析它如何根据近期表现自适应地选择更优的预测器，并量化其在程序行为变化时的适应速度。", "problem": "一个超标量核使用一个锦标赛预测器，该预测器结合了一个全局历史异或（XOR）索引预测器（gshare）和一个两级局部预测器。该锦标赛选择器为每个静态分支使用一个 $c$ 位饱和计数器，仅当两个组件预测器意见不一时才更新：如果 gshare 正确而局部预测器不正确，则加 $+1$；如果局部预测器正确而 gshare 不正确，则减 1；其他情况则不改变。如果计数器值至少为 $2^{c-1}$，选择器会选择 gshare，否则选择局部预测器。计数器在 $0$ 和 $2^{c}-1$ 处饱和。\n\n考虑一个单一的静态分支，其结果形成一个随时间分段周期性的轨迹，周期为 $p$。工作负载在两个阶段之间交替：\n\n阶段 1：分支的结果是最后 $p$ 个全局结果和程序计数器（PC）的一个确定性函数。假设全局历史异或索引预测器拥有一个长度为 $p$ 的全局历史寄存器（GHR），一个足够大以避免该分支索引上发生混叠的模式历史表（PHT），并在短于一个周期 $p$ 的预热后收敛到完美预测。假设局部预测器使用长度为 $p-1$ 的分支局部历史，并在其自身的预热后收敛到每个周期 $p$ 恰好预测错误一个结果。在这些条件下，假设每个周期 $p$ 恰好发生一次意见不一，并且在每次意见不一时，gshare 都是正确的，而局部预测器是不正确的。设该阶段持续足够长的时间，以至于到阶段 1 结束时，该分支的选择器计数器饱和到 $2^{c}-1$。\n\n阶段 2：分支的结果转变为一个不同的确定性函数，该函数依赖于长度为 $p-1$ 的分支局部历史，并且局部预测器在短于一个周期 $p$ 的预热后收敛到完美预测。假设由于阶段 2 中其他活动控制流的干扰，gshare 对该分支每个周期 $p$ 恰好预测错误一个结果，并且所有意见不一的情况每个周期 $p$ 恰好发生一次，其中在每次意见不一时，局部预测器是正确的，而 gshare 是不正确的。\n\n从阶段 2 开始时，该分支的锦标赛选择器计数器值为 $2^{c}-1$。根据所述的更新规则和阶段 2 中的意见不一行为，推导出一个闭式表达式，用于计算选择器从选择 gshare 翻转到选择局部预测器所需的选择器更新的期望数量，记为 $u$。请将 $u$ 的最终答案表示为仅含 $c$ 的闭式解析表达式。无需四舍五入。不要包含单位。", "solution": "该问题要求推导锦标赛预测器将其偏好从 gshare 预测器切换到局部预测器所需的更新次数。\n\n设 $C$ 表示锦标赛选择器使用的 $c$ 位饱和计数器的值。$C$ 的值范围可以从 $0$ 到 $2^c - 1$。\n选择器的选择规则定义如下：\n- 如果计数器值 $C \\ge 2^{c-1}$，则选择 gshare 预测器。\n- 如果计数器值 $C  2^{c-1}$，则选择局部预测器。\n\n场景从阶段 2 的开始处着手。根据对阶段 1 的描述，所讨论分支的选择器计数器已经饱和至其最大值。设 $C_0$ 为阶段 2 开始时的初始计数器值。\n$$C_0 = 2^c - 1$$\n在此初始状态下，选择器选择 gshare 预测器，因为对于任何整数 $c \\ge 1$（一个最小的 1 位计数器），不等式 $2^c - 1 \\ge 2^{c-1}$ 均成立。对于 $c=1$，我们有 $1 \\ge 1$。对于 $c > 1$，$2^c - 2^{c-1} = 2^{c-1}$，所以 $2^c = 2^{c-1} + 2^{c-1}$。不等式变为 $2^{c-1} + 2^{c-1} - 1 \\ge 2^{c-1}$，可简化为 $2^{c-1} - 1 \\ge 0$，这个条件对于 $c \\ge 1$ 是成立的。\n\n在阶段 2 期间，问题陈述了组件预测器之间的意见不一每个周期 $p$ 恰好发生一次。在每次意见不一的情况下，局部预测器是正确的，而 gshare 预测器是不正确的。根据指定的更新规则，“如果局部预测器正确而 gshare 不正确，选择器...减 1”。这意味着在阶段 2 的每次更新事件中，计数器值 $C$ 都会减 1。\n\n设 $u$ 为自阶段 2 开始以来发生的选择器更新次数。每次更新对应一个单一的意见不一事件。经过 $u$ 次更新后，计数器值 $C_u$ 的演变由以下确定性递推关系给出：\n$$C_u = C_{u-1} - 1$$\n初始条件为 $C_0 = 2^c - 1$。\n展开此递推关系，我们得到 $C_u$ 的一个闭式表达式：\n$$C_u = C_0 - u = (2^c - 1) - u$$\n该表达式在计数器未达到其在 $0$ 处的饱和点之前是有效的，饱和发生在 $u \\ge 2^c - 1$ 时。\n\n当计数器值 $C$ 首次降至阈值 $2^{c-1}$ 以下时，我们称选择器“翻转”其选择，从 gshare 转向局部预测器。我们正在寻找满足此条件的最小整数更新次数 $u$。\n$$C_u  2^{c-1}$$\n代入 $C_u$ 的表达式：\n$$(2^c - 1) - u  2^{c-1}$$\n我们必须解这个关于 $u$ 的不等式：\n$$u > (2^c - 1) - 2^{c-1}$$\n通过将 $2^c$ 重写为 $2 \\times 2^{c-1}$，我们可以简化不等式的右侧：\n$$u > (2 \\times 2^{c-1}) - 2^{c-1} - 1$$\n$$u > (2-1) \\times 2^{c-1} - 1$$\n$$u > 2^{c-1} - 1$$\n由于 $u$ 必须是表示更新次数的整数，满足此严格不等式的最小整数 $u$ 值比下界大一：\n$$u = (2^{c-1} - 1) + 1 = 2^{c-1}$$\n\n为了验证这个结果，我们可以检查翻转之前和翻转发生时计数器的状态。\n让我们考虑更新次数 $u = 2^{c-1}$。\n在第 $(u-1)$ 次更新时，即经过 $2^{c-1}-1$ 次更新后，计数器的值为：\n$$C_{u-1} = (2^c - 1) - (2^{c-1} - 1) = 2^c - 2^{c-1} = 2 \\times 2^{c-1} - 2^{c-1} = 2^{c-1}$$\n此时，$C_{u-1} = 2^{c-1}$，满足条件 $C \\ge 2^{c-1}$。因此，选择器仍然选择 gshare 预测器。\n\n在第 $u$ 次更新时，即经过 $2^{c-1}$ 次更新后，计数器的值变为：\n$$C_u = C_{u-1} - 1 = 2^{c-1} - 1$$\n现在，计数器值为 $C_u  2^{c-1}$。这触发了翻转，选择器首次选择局部预测器。\n\n因此，选择器翻转所需的确切更新次数是 $2^{c-1}$。问题陈述要求的是更新的“期望数量”。由于所描述的系统演化是完全确定性的，因此更新次数是一个固定量。在这种情况下，期望值与此确定性值相同。最终表达式仅依赖于 $c$，符合要求。", "answer": "$$\\boxed{2^{c-1}}$$", "id": "3619732"}]}