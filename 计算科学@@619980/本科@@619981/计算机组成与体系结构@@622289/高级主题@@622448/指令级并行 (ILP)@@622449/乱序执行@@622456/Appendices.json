{"hands_on_practices": [{"introduction": "乱序执行的核心优势在于它能够发掘指令级并行性，绕过数据无关的停顿。然而，这种潜力受到处理器有限硬件资源的制约。本练习将通过一个具体的指令数据流图，引导你模拟一个乱序超标量处理器的执行过程，从而亲身体会理论上的关键路径与受限于功能单元和发射宽度的实际执行路径之间的差异 ([@problem_id:3662826])。这个实践将帮助你量化结构性冒险 (structural hazards) 对性能的影响。", "problem": "考虑一个指令级数据流图，该图为一个乱序 (OOO) 超标量核心中的顺序程序片段建模。每个节点 $i$ 是一条延迟为 $L_i$ (单位：周期) 的指令，如果 $i$ 依赖于 $j$ 的结果，则存在一条有向边 $j \\rightarrow i$。假设不由任何节点产生的操作数 (例如，常数) 在周期 $0$ 时就绪。该图具有以下节点和边，以及各自的延迟：\n- 节点和延迟：\n  - $I_1$：加载， $L_1 = 3$\n  - $I_2$：加载， $L_2 = 3$\n  - $I_3$：乘法， $L_3 = 3$\n  - $I_4$：整数加法， $L_4 = 1$\n  - $I_5$：整数加法， $L_5 = 1$\n  - $I_6$：乘法， $L_6 = 3$\n  - $I_7$：整数加法， $L_7 = 1$\n  - $I_8$：存储， $L_8 = 1$\n- 有向边 (真相关)：\n  - $I_1 \\rightarrow I_3$, $I_2 \\rightarrow I_3$, $I_2 \\rightarrow I_5$, $I_3 \\rightarrow I_4$, $I_4 \\rightarrow I_6$, $I_5 \\rightarrow I_6$, $I_6 \\rightarrow I_7$, $I_7 \\rightarrow I_8$\n- $I_4$、$I_5$ 和 $I_7$ 的所有其他输入都是在周期 $0$ 时就绪的独立常数。$I_1$、$I_2$ 和 $I_8$ 的地址在周期 $0$ 时就绪，且内存系统没有缓存未命中或冲突。\n\n架构模型 (本题固定)：\n- 该核心执行乱序 (OOO) 执行，具有寄存器重命名、无限大小的保留站 (RS) 和无限大小的重排序缓冲区 (ROB)。\n- 发射宽度 $W = 2$：每个周期最多可以发射 $2$ 条指令。\n- 功能单元 (全部为完全流水化)：\n  - 一个加载单元 (用于 $I_1$、$I_2$)，每个周期最多可以开始一次加载；加载延迟为 $3$。\n  - 两个相同的整数算术逻辑单元 (ALU) 用于加法 (用于 $I_4$、$I_5$、$I_7$)；每个延迟为 $1$，每个周期可以接收一个新的加法操作。\n  - 一个乘法单元 (用于 $I_3$、$I_6$)，延迟为 $3$；每个周期可以接收一个新的乘法操作。\n  - 一个存储单元 (用于 $I_8$)，延迟为 $1$；每个周期可以接收一个新的存储操作。\n- 时序语义：如果一条指令在周期 $t$ 开始执行，其延迟为 $L$，则其结果在周期 $t+L$ 开始时可用。一条依赖指令可以在周期 $t+L$ 开始执行，前提是有一个匹配的功能单元可以接收它，并且在该周期内未超过发射宽度。\n- 确定性决胜规则：在任何周期，对于所有在给定单元可用性下可以发射的就绪指令，调度器按指令索引递增的顺序进行选择，直到达到每周期发射宽度上限。\n\n任务：\n1. 仅使用数据相关和延迟 (即，假设无限功能单元和无限发射宽度)，计算每个节点 $I_i$ 的最早开始时间 $\\operatorname{EST}(I_i)$。然后，在这些仅考虑相关的约束下，计算最终指令 $I_8$ 的关键路径完成时间 $T_{\\mathrm{CP}}$。\n2. 在给定的 OOO 核心约束下，通过逐周期模拟发射来计算 $I_8$ 的实际调度完成时间 $T_{\\mathrm{OOO}}$，模拟需遵循就绪状态、功能单元可用性和发射宽度的限制。请严格按照指定的时序语义和决胜规则进行。\n3. 令 $\\Delta = T_{\\mathrm{OOO}} - T_{\\mathrm{CP}}$。$\\Delta$ 的值是多少？请用一个实数表示您的答案（单位为周期）。在最终的数字答案中不要包含任何单位标签。无需四舍五入。", "solution": "用户希望我解决一个涉及乱序执行的计算机体系结构问题。\n\n### 步骤 1：提取已知条件\n- **节点和延迟 ($L_i$)**：\n  - $I_1$：加载， $L_1 = 3$ 周期\n  - $I_2$：加载， $L_2 = 3$ 周期\n  - $I_3$：乘法， $L_3 = 3$ 周期\n  - $I_4$：整数加法， $L_4 = 1$ 周期\n  - $I_5$：整数加法， $L_5 = 1$ 周期\n  - $I_6$：乘法， $L_6 = 3$ 周期\n  - $I_7$：整数加法， $L_7 = 1$ 周期\n  - $I_8$：存储， $L_8 = 1$ 周期\n- **有向边 (相关性)**：\n  - $I_1 \\rightarrow I_3$, $I_2 \\rightarrow I_3$, $I_2 \\rightarrow I_5$, $I_3 \\rightarrow I_4$, $I_4 \\rightarrow I_6$, $I_5 \\rightarrow I_6$, $I_6 \\rightarrow I_7$, $I_7 \\rightarrow I_8$\n- **初始条件**：\n  - 不由任何节点产生的操作数在周期 0 就绪。\n  - $I_1$、$I_2$ 和 $I_8$ 的地址在周期 0 就绪。\n- **架构模型**：\n  - 乱序 (OOO) 执行，无限大小的保留站 (RS) 和重排序缓冲区 (ROB)。\n  - 发射宽度 $W = 2$ 条指令/周期。\n  - 功能单元 (全部为完全流水化)：\n    - 1 个加载单元 (可启动 1 次加载/周期)。\n    - 2 个整数 ALU (每个可启动 1 次加法/周期，总共 2 次加法/周期)。\n    - 1 个乘法单元 (可启动 1 次乘法/周期)。\n    - 1 个存储单元 (可启动 1 次存储/周期)。\n- **时序语义**：\n  - 在周期 $t$ 开始、延迟为 $L$ 的指令，其结果在周期 $t+L$ 开始时可用。\n- **决胜规则**：\n  - 在就绪指令中，按指令索引递增的顺序发射。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是计算机体系结构中的一个标准练习，具体涉及乱序超标量处理器中的指令调度。\n- **科学依据**：该问题基于成熟的计算机组织与体系结构原理，包括数据流图、关键路径分析以及带资源约束的 OOO 执行建模。所有概念都是标准的、定义明确的。\n- **问题明确**：问题陈述清晰，包含了所有必要的参数（延迟、相关性、机器模型）。确定性的决胜规则确保了调度模拟存在唯一解。\n- **客观性**：语言精确且技术性强，没有主观性或歧义。\n\n该问题是自洽且内部一致的。它没有违反任何科学原理，问题定义良好，并且并非微不足道。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n**第 1 部分：关键路径分析**\n首先，我们仅考虑数据相关，计算每条指令的最早开始时间 $\\operatorname{EST}(I_i)$ 和最早完成时间 $\\operatorname{ECT}(I_i)$。我们假设资源无限。一条指令的 $\\operatorname{EST}$ 是它所依赖的所有指令的 $\\operatorname{ECT}$ 的最大值。没有依赖关系的指令可以在周期 0 开始。完成时间为 $\\operatorname{ECT}(I_i) = \\operatorname{EST}(I_i) + L_i$。\n\n- $\\operatorname{EST}(I_1) = 0$。$\\operatorname{ECT}(I_1) = 0 + L_1 = 0 + 3 = 3$。\n- $\\operatorname{EST}(I_2) = 0$。$\\operatorname{ECT}(I_2) = 0 + L_2 = 0 + 3 = 3$。\n- $\\operatorname{EST}(I_3) = \\max(\\operatorname{ECT}(I_1), \\operatorname{ECT}(I_2)) = \\max(3, 3) = 3$。$\\operatorname{ECT}(I_3) = 3 + L_3 = 3 + 3 = 6$。\n- $\\operatorname{EST}(I_5) = \\operatorname{ECT}(I_2) = 3$。$\\operatorname{ECT}(I_5) = 3 + L_5 = 3 + 1 = 4$。\n- $\\operatorname{EST}(I_4) = \\operatorname{ECT}(I_3) = 6$。$\\operatorname{ECT}(I_4) = 6 + L_4 = 6 + 1 = 7$。\n- $\\operatorname{EST}(I_6) = \\max(\\operatorname{ECT}(I_4), \\operatorname{ECT}(I_5)) = \\max(7, 4) = 7$。$\\operatorname{ECT}(I_6) = 7 + L_6 = 7 + 3 = 10$。\n- $\\operatorname{EST}(I_7) = \\operatorname{ECT}(I_6) = 10$。$\\operatorname{ECT}(I_7) = 10 + L_7 = 10 + 1 = 11$。\n- $\\operatorname{EST}(I_8) = \\operatorname{ECT}(I_7) = 11$。\n\n最终指令 $I_8$ 的关键路径完成时间为 $T_{\\mathrm{CP}} = \\operatorname{ECT}(I_8) = \\operatorname{EST}(I_8) + L_8 = 11 + 1 = 12$。\n\n**第 2 部分：OOO 执行模拟**\n接下来，我们在指定的 OOO 核心上模拟执行，考虑发射宽度 $W=2$ 和功能单元约束。我们跟踪每条指令 $I_i$ 的开始时间 `S(i)` 和完成时间 `C(i)`。\n\n- **周期 0**：\n  - 所有操作数均已就绪的指令：$I_1, I_2$。\n  - 调度器先考虑 $I_1$，再考虑 $I_2$。\n  - $I_1$ 需要加载单元，该单元可用。发射 $I_1$。$S(I_1)=0$, $C(I_1)=0+3=3$。\n  - $I_2$ 需要加载单元。但是，单个加载单元每个周期只能开始一条指令。$I_2$ 无法被发射。\n  - 已发射：{$I_1$}。\n\n- **周期 1**：\n  - 指令 $I_2$ 仍然就绪。\n  - 加载单元可用于开始新操作。发射 $I_2$。$S(I_2)=1$, $C(I_2)=1+3=4$。\n  - 已发射：{$I_2$}。\n\n- **周期 2-3**：\n  - 没有指令就绪。在周期 3 开始时，$I_1$ 完成。\n\n- **周期 4**：\n  - 在此周期开始时，$I_2$ 完成。来自 $I_1$ 的结果（自周期 3 起）和来自 $I_2$ 的结果（现在）均可用。\n  - $I_3$ 变为就绪：其来自 $I_1$ 和 $I_2$ 的输入均可用。就绪时间为 $\\max(C(I_1), C(I_2)) = \\max(3, 4) = 4$。\n  - $I_5$ 变为就绪：其来自 $I_2$ 的输入可用。就绪时间为 $C(I_2) = 4$。\n  - 就绪队列：{$I_3, I_5$}。\n  - 调度器考虑 $I_3$ (需要乘法单元，可用) 和 $I_5$ (需要 ALU，可用)。由于 $W=2$，两者都可以发射。\n  - 发射 $I_3$：$S(I_3)=4$, $C(I_3)=4+3=7$。\n  - 发射 $I_5$：$S(I_5)=4$, $C(I_5)=4+1=5$。\n  - 已发射：{$I_3, I_5$}。\n\n- **周期 5-6**：\n  - 在周期 5 开始时，$I_5$ 完成。没有新指令变为就绪（$I_6$ 在等待 $I_4$）。\n  - 没有指令被发射。\n\n- **周期 7**：\n  - 在此周期开始时，$I_3$ 完成。\n  - $I_4$ 变为就绪：其来自 $I_3$ 的输入可用。就绪时间为 $C(I_3)=7$。\n  - 发射 $I_4$ (需要 ALU，可用)。$S(I_4)=7$, $C(I_4)=7+1=8$。\n  - 已发射：{$I_4$}。\n\n- **周期 8**：\n  - 在此周期开始时，$I_4$ 完成。\n  - $I_6$ 变为就绪：其来自 $I_4$ 和 $I_5$ 的输入均可用。就绪时间为 $\\max(C(I_4), C(I_5)) = \\max(8, 5) = 8$。\n  - 发射 $I_6$ (需要乘法单元，可用)。$S(I_6)=8$, $C(I_6)=8+3=11$。\n  - 已发射：{$I_6$}。\n\n- **周期 9-10**：\n  - 没有指令被发射。\n\n- **周期 11**：\n  - 在此周期开始时，$I_6$ 完成。\n  - $I_7$ 变为就绪：来自 $I_6$ 的输入可用。就绪时间为 $C(I_6)=11$。\n  - 发射 $I_7$ (需要 ALU，可用)。$S(I_7)=11$, $C(I_7)=11+1=12$。\n  - 已发射：{$I_7$}。\n\n- **周期 12**：\n  - 在此周期开始时，$I_7$ 完成。\n  - $I_8$ 变为就绪：来自 $I_7$ 的输入可用。就绪时间为 $C(I_7)=12$。\n  - 发射 $I_8$ (需要存储单元，可用)。$S(I_8)=12$, $C(I_8)=12+1=13$。\n  - 已发射：{$I_8$}。\n\n当 $I_8$ 完成时，模拟结束。实际调度完成时间为 $T_{\\mathrm{OOO}} = C(I_8) = 13$。\n\n**第 3 部分：计算 $\\Delta$**\n题目要求计算 $\\Delta = T_{\\mathrm{OOO}} - T_{\\mathrm{CP}}$ 的值。\n使用前面部分计算出的值：\n$T_{\\mathrm{CP}} = 12$\n$T_{\\mathrm{OOO}} = 13$\n$\\Delta = 13 - 12 = 1$。\n\n延迟是由周期 0 时的结构冒险引起的，此时 $I_1$ 和 $I_2$ 竞争唯一的加载单元。这迫使 $I_2$ 延迟了一个周期，这个一周期延迟沿着关键路径传播到了最终的指令。", "answer": "$$\n\\boxed{1}\n$$", "id": "3662826"}, {"introduction": "为了支持乱序执行，处理器使用寄存器重命名技术来消除伪依赖关系，而这需要一个比架构寄存器数量更多的物理寄存器堆。那么，到底需要多少物理寄存器才能确保处理器在高速运行时不会因为资源耗尽而停顿呢？本练习要求你从第一性原理出发，推导出维持循环在稳态下持续执行所需的最小物理寄存器数量 ([@problem_id:3662897])。通过这个推导，你将深刻理解物理寄存器的生命周期与处理器维持指令吞吐能力之间的内在联系。", "problem": "考虑一个在具有顺序提交和精确异常的寄存器重命名乱序核上运行的单线程循环。该处理器实现了经典的寄存器重命名机制，使用一个重命名映射表和一个物理寄存器空闲列表。在重命名一个目标寄存器时，会立即分配一个新的物理寄存器，而先前映射到该体系结构寄存器名称的物理寄存器仅在重定义该寄存器的指令提交时才返回到空闲列表。提交阶段按顺序更新体系结构映射表，并在重定义指令提交时释放先前的物理映射，不会提前释放。\n\n假设循环和机器具有以下稳态属性：\n- 循环体恰好有 $k$ 个不同的标量临时变量，每个都由一个唯一的体系结构寄存器表示，并且在每次迭代中恰好被重定义一次。\n- 在稳态下，循环以每个周期启动 $1$ 次迭代的持续启动间隔运行（也就是说，每 $1$ 个周期就有一个新的迭代开始重命名）。\n- 对于每个临时变量，在给定的迭代中，从其重命名（分配新目标寄存器）到重定义它的指令顺序提交所需的时间是一个常数 $D$ 个周期。您可以将 $D$ 视为一个整数，并且对于所有 $k$ 个临时变量都相同。\n- 除了这 $k$ 个临时变量外，循环没有重定义其他体系结构寄存器，并且您可以忽略所有其他形式的资源竞争（例如，假设重排序缓冲区和调度器足够大，以至于只有物理寄存器空闲列表可能导致重命名停顿）。\n\n仅使用上面提供的寄存器重命名、活跃期和顺序提交的定义，从第一性原理出发，推导出保证在循环稳态运行时重命名阶段永远不会因空闲列表为空而停顿所需的最小物理寄存器数量 $R_{phys}$。请用 $k$ 和 $D$ 的封闭形式表达式表示您的答案。不要提供不等式。最终表达式中不需要进行数值取整，也不需要单位。", "solution": "该问题要求推导出保证处理器重命名阶段不会停顿所需的最小物理寄存器数量 $R_{phys}$。该系统的特点是一个在乱序核上以稳态运行的循环。\n\n解决这个问题的基本原理是确定在稳态期间同时被使用（已分配但尚未释放）的物理寄存器的总数。为防止停顿，物理寄存器堆必须足够大以容纳所有这些寄存器。这个数量可以通过计算一个物理寄存器的总生命周期，并将其乘以寄存器的分配速率来得到。\n\n我们首先确定分配速率。问题陈述如下：\n- 循环体有 $k$ 个不同的标量临时变量，每个在每次迭代中被重定义一次。\n- 循环以每个周期启动 $1$ 次迭代的持续启动间隔运行。\n这意味着在每个周期，一个新的迭代开始，重命名阶段必须为 $k$ 个被重定义的体系结构寄存器中的每一个分配一个新的物理寄存器。\n因此，分配速率是每个周期 $k$ 个物理寄存器。\n\n接下来，我们来确定一个物理寄存器的生命周期。生命周期从它在重命名阶段被分配开始，到它被释放（返回到空闲列表）结束。问题明确了释放规则：“先前映射到该体系结构寄存器名称的物理寄存器仅在重定义该寄存器的指令提交时才返回到空闲列表。”\n\n考虑一个单一的体系结构寄存器 $A$。我们来追踪在连续的迭代中映射到它的物理寄存器。\n- 在迭代 $i$ 中，假设重定义 $A$ 的指令在周期 $t_i$ 被重命名。此时，一个新的物理寄存器（我们称之为 $P_i$）被分配给 $A$。\n- 在下一次迭代 $i+1$ 中，重定义 $A$ 的指令被重命名。由于启动间隔为 $1$，这发生在周期 $t_{i+1} = t_i + 1$。一个新的物理寄存器 $P_{i+1}$ 被分配给 $A$。\n\n现在，我们来确定 $P_i$ 何时被释放。根据规则，$P_i$（“先前映射的物理寄存器”）在“重定义指令”（来自迭代 $i+1$ 的那条指令）提交时被释放。\n问题陈述，从一条指令重命名到其提交的时间是一个常数 $D$ 个周期。来自迭代 $i+1$ 的指令在周期 $t_{i+1}$ 被重命名。因此，它在周期 $t_{commit} = t_{i+1} + D$ 提交。\n代入 $t_{i+1} = t_i + 1$：\n$$t_{commit} = (t_i + 1) + D = t_i + D + 1$$\n这就是物理寄存器 $P_i$ 被释放的周期。\n\n物理寄存器 $P_i$ 的生命周期是从它在周期 $t_i$ 被分配到在周期 $t_i + D + 1$ 被释放的持续时间。它保持被占用的周期数为：\n$$\\text{Lifetime} = (t_i + D + 1) - t_i = D + 1 \\text{ cycles}$$\n\n我们现在已经确定了计算所需的两个必要组成部分：\n$1$. 从空闲列表消耗物理寄存器的速率是每个周期 $k$ 个寄存器。\n$2$. 每个物理寄存器保持被消耗状态的持续时间是 $D+1$ 个周期。\n\n在一个稳态系统中，被占用的资源总数是到达率和服务时间的乘积。这是利特尔法则（Little's Law）的一个应用。同时活跃的物理寄存器总数 $N_{live}$ 为：\n$$N_{live} = (\\text{registers allocated per cycle}) \\times (\\text{lifetime in cycles})$$\n$$N_{live} = k \\times (D+1)$$\n\n为保证重命名阶段永远不会因空闲列表为空而停顿，可用的物理寄存器总数 $R_{phys}$ 必须至少是这个数值。因此，所需的最小数量为：\n$$R_{phys} = k(D+1)$$\n\n另一种推导方法通过考虑机器状态的一个快照来证实这个结果。在任何时刻，物理寄存器堆必须保存最后提交的（体系结构）状态的值，以及所有在途（推测）状态的值。\n- $k$ 个循环临时变量的已提交状态需要 $k$ 个物理寄存器。\n- 一条指令从其重命名到提交之间都处于“在途”（in-flight）状态。从重命名到提交的时间是 $D$ 个周期。由于启动间隔为 $1$，总是有相当于 $D$ 个迭代的指令已经被重命名但尚未提交。例如，如果在周期 $t$ 重命名的指令在 $t+D$ 提交，那么在周期 $T$ 时，在周期 $T-1, T-2, \\ldots, T-D$ 重命名的指令都处于在途状态。\n- 这 $D$ 个在途的迭代每次都分配了 $k$ 个物理寄存器，总计为 $D \\times k$ 个推测性寄存器。\n被占用的寄存器总数是用于已提交状态和推测状态的寄存器数量之和：\n$$R_{phys} = k_{\\text{committed}} + (D \\times k)_{\\text{speculative}} = k + kD = k(D+1)$$\n两种推导都得出结论，所需的最小物理寄存器数量为 $k(D+1)$。", "answer": "$$\\boxed{k(D+1)}$$", "id": "3662897"}, {"introduction": "现代处理器设计不仅要追求极致性能，还必须应对严格的功耗限制。乱序执行调度器可以变得“更智能”，在满足功率上限的前提下，策略性地选择执行哪些指令以最大化性能。本练习构建了一个功耗感知的调度模型，要求你通过优化不同类型指令的发射率，来计算在给定的功率上限 ($P_{\\mathrm{cap}}$) 下所能达到的最大指令吞吐率 (IPC) ([@problem_id:3662901])。这个练习将展示微体系结构决策如何与系统级的能效目标相结合，体现了现代处理器设计中的一个核心权衡。", "problem": "一个单核超标量乱序 (OOO) 处理器执行一个由三类独立指令组成的稳定指令流：整数算术 ($\\mathrm{I}$)、浮点算术 ($\\mathrm{F}$) 和内存 ($\\mathrm{M}$)。指令窗口足够大，使得处理器总能找到达到每类指令就绪限制的就绪指令，并且加载操作在一级缓存中命中，因此其延迟被乱序执行所掩盖。设峰值发射宽度为 $W$，三类指令的稳态时间平均发射率分别为 $r_{\\mathrm{I}}$、$r_{\\mathrm{F}}$ 和 $r_{\\mathrm{M}}$，单位为每周期指令数。假设这些发射率在稳态下可以被视为实值变量。\n\n总的每周期指令数 (IPC) 定义为 $IPC = r_{\\mathrm{I}} + r_{\\mathrm{F}} + r_{\\mathrm{M}}$。总功耗建模为 $P = P_{\\mathrm{static}} + p_{\\mathrm{I}} r_{\\mathrm{I}} + p_{\\mathrm{F}} r_{\\mathrm{F}} + p_{\\mathrm{M}} r_{\\mathrm{M}}$，其中 $P_{\\mathrm{static}}$ 是静态功耗，$p_{\\mathrm{I}}$、$p_{\\mathrm{F}}$、$p_{\\mathrm{M}}$ 是每类指令的每条发射指令的动态功耗成本。调度器是能量感知的，在每个时间间隔内，它会贪心地优先发射那些每单位动态功耗消耗能获得最大边际每周期指令数增益的指令类别，并受以下约束：\n- 发射宽度：$r_{\\mathrm{I}} + r_{\\mathrm{F}} + r_{\\mathrm{M}} \\le W$。\n- 每类指令的就绪限制：$r_{\\mathrm{I}} \\le R_{\\mathrm{I}}^{\\max}$, $r_{\\mathrm{F}} \\le R_{\\mathrm{F}}^{\\max}$, $r_{\\mathrm{M}} \\le R_{\\mathrm{M}}^{\\max}$。\n- 功耗上限：$P \\le P_{\\mathrm{cap}}$。\n\n考虑以下参数值：\n- 峰值发射宽度 $W = 10$。\n- 静态功耗 $P_{\\mathrm{static}} = 18$ (瓦特)。\n- 功耗上限 $P_{\\mathrm{cap}} = 30$ (瓦特)。\n- 每条发射指令的动态功耗：$p_{\\mathrm{I}} = 2$ (瓦特/每周期指令数)，$p_{\\mathrm{F}} = 3$ (瓦特/每周期指令数)，$p_{\\mathrm{M}} = 6$ (瓦特/每周期指令数)。\n- 每类指令的最大稳态就绪度：$R_{\\mathrm{I}}^{\\max} = 4$, $R_{\\mathrm{F}}^{\\max} = 6$, $R_{\\mathrm{M}}^{\\max} = 6$。\n\n在这些假设和所述的能量感知贪心调度策略下，处理器在功耗上限下能达到什么样的稳态 $IPC$？请用一个数字表示你的答案；如果该值可以精确地写成一个最简分数，请不要四舍五入。", "solution": "我们从核心定义开始。每周期指令数定义为 $IPC = r_{\\mathrm{I}} + r_{\\mathrm{F}} + r_{\\mathrm{M}}$，即每周期平均提交的指令数。在一个具有足够指令窗口和指令独立性的稳态超标量乱序处理器中，在给定约束条件下，提交率等于发射率，因此我们可以用时间平均发射率 $r_{\\mathrm{I}}$、$r_{\\mathrm{F}}$ 和 $r_{\\mathrm{M}}$ 来表示 $IPC$。\n\n功耗通过标准的线性分解建模为静态和动态两个部分，$P = P_{\\mathrm{static}} + P_{\\mathrm{dyn}}$，其中动态部分建模为活动（已发射操作）的线性函数：\n$$\nP = P_{\\mathrm{static}} + p_{\\mathrm{I}} r_{\\mathrm{I}} + p_{\\mathrm{F}} r_{\\mathrm{F}} + p_{\\mathrm{M}} r_{\\mathrm{M}}.\n$$\n在计算机体系结构中，当活动因子与已发射操作的数量成正比时，这是一个广泛用于在固定频率和电压下计算动态功耗的一阶模型。\n\n调度器被指定为能量感知的，并且相对于每单位动态功耗的边际性能是贪心的。对于类别 $\\mathrm{X} \\in \\{\\mathrm{I}, \\mathrm{F}, \\mathrm{M}\\}$，每单位动态功耗的边际 $IPC$ 增益是增加 $r_{\\mathrm{X}}$ 时 $IPC$ 的增量变化与动态功耗的增量变化之比：\n$$\n\\frac{\\partial(IPC)}{\\partial r_{\\mathrm{X}}} \\Big/ \\frac{\\partial P_{\\mathrm{dyn}}}{\\partial r_{\\mathrm{X}}} = \\frac{1}{p_{\\mathrm{X}}}.\n$$\n由于对于每个类别都有 $\\frac{\\partial(IPC)}{\\partial r_{\\mathrm{X}}} = 1$ 且 $\\frac{\\partial P_{\\mathrm{dyn}}}{\\partial r_{\\mathrm{X}}} = p_{\\mathrm{X}}$，调度器的贪心策略是首先将发射率分配给 $p_{\\mathrm{X}}$ 最小的（即 $\\frac{1}{p_{\\mathrm{X}}}$ 最大的）类别，然后是下一个，以此类推，同时遵守发射宽度、每类指令就绪度和功耗上限的约束。因为每单位动态功耗的收益对于每个类别是恒定的，并且决策变量可以被视为连续的（时间平均速率），所以这种贪心分配等价于连续背包问题的解，在所述假设下是最优的。\n\n我们现在应用这些约束和给定的参数。\n\n首先，计算功耗上限下可用的动态功耗预算：\n$$\nP_{\\mathrm{dyn}}^{\\max} = P_{\\mathrm{cap}} - P_{\\mathrm{static}} = 30 - 18 = 12.\n$$\n\n按 $p_{\\mathrm{X}}$ 递增（即 $\\frac{1}{p_{\\mathrm{X}}}$ 递减）的顺序列出类别：\n- 整数：$p_{\\mathrm{I}} = 2$。\n- 浮点：$p_{\\mathrm{F}} = 3$。\n- 内存：$p_{\\mathrm{M}} = 6$。\n\n约束集：\n- 发射宽度：$r_{\\mathrm{I}} + r_{\\mathrm{F}} + r_{\\mathrm{M}} \\le 10$。\n- 就绪度：$r_{\\mathrm{I}} \\le 4$, $r_{\\mathrm{F}} \\le 6$, $r_{\\mathrm{M}} \\le 6$。\n- 动态功耗：$2 r_{\\mathrm{I}} + 3 r_{\\mathrm{F}} + 6 r_{\\mathrm{M}} \\le 12$。\n\n贪心分配步骤 1 (整数类 $\\mathrm{I}$):\n尽可能多地分配给 $\\mathrm{I}$ 类，受就绪度、宽度和功耗的限制。限制因素是\n$$\nr_{\\mathrm{I}} \\le R_{\\mathrm{I}}^{\\max} = 4,\\quad r_{\\mathrm{I}} \\le W = 10,\\quad 2 r_{\\mathrm{I}} \\le 12 \\Rightarrow r_{\\mathrm{I}} \\le 6.\n$$\n因此，这些界限中最紧的是 $r_{\\mathrm{I}} \\le 4$。分配 $r_{\\mathrm{I}} = 4$。这消耗的动态功耗为\n$$\nP_{\\mathrm{dyn,I}} = 2 \\cdot 4 = 8,\n$$\n剩余动态预算为\n$$\nP_{\\mathrm{dyn}}^{\\mathrm{rem}} = 12 - 8 = 4,\n$$\n剩余发射宽度为\n$$\nW^{\\mathrm{rem}} = 10 - 4 = 6.\n$$\n\n贪心分配步骤 2 (浮点类 $\\mathrm{F}$):\n分配给 $\\mathrm{F}$ 类，受就绪度、剩余宽度和剩余动态功耗的限制：\n$$\nr_{\\mathrm{F}} \\le R_{\\mathrm{F}}^{\\max} = 6,\\quad r_{\\mathrm{F}} \\le W^{\\mathrm{rem}} = 6,\\quad 3 r_{\\mathrm{F}} \\le P_{\\mathrm{dyn}}^{\\mathrm{rem}} = 4 \\Rightarrow r_{\\mathrm{F}} \\le \\frac{4}{3}.\n$$\n因此，最紧的界限是 $r_{\\mathrm{F}} \\le \\frac{4}{3}$。分配 $r_{\\mathrm{F}} = \\frac{4}{3}$。这使用了剩余的动态功耗\n$$\nP_{\\mathrm{dyn,F}} = 3 \\cdot \\frac{4}{3} = 4,\n$$\n因此动态预算被完全利用：\n$$\nP_{\\mathrm{dyn}}^{\\mathrm{rem}} = 4 - 4 = 0.\n$$\n\n贪心分配步骤 3 (内存类 $\\mathrm{M}$):\n没有剩余的动态功耗，所以 $r_{\\mathrm{M}} = 0$。\n\n验证所有约束：\n- 发射宽度：$r_{\\mathrm{I}} + r_{\\mathrm{F}} + r_{\\mathrm{M}} = 4 + \\frac{4}{3} + 0 = \\frac{16}{3} \\le 10$ 满足。\n- 就绪度：$r_{\\mathrm{I}} = 4 \\le 4$，$r_{\\mathrm{F}} = \\frac{4}{3} \\le 6$，$r_{\\mathrm{M}} = 0 \\le 6$ 满足。\n- 功耗：\n$$\nP = P_{\\mathrm{static}} + 2 r_{\\mathrm{I}} + 3 r_{\\mathrm{F}} + 6 r_{\\mathrm{M}} = 18 + 2 \\cdot 4 + 3 \\cdot \\frac{4}{3} + 6 \\cdot 0 = 18 + 8 + 4 + 0 = 30,\n$$\n因此 $P = P_{\\mathrm{cap}}$ 满足。\n\n因此，在指定的能量感知贪心调度和功耗上限下，稳态 $IPC$ 为\n$$\nIPC = r_{\\mathrm{I}} + r_{\\mathrm{F}} + r_{\\mathrm{M}} = 4 + \\frac{4}{3} + 0 = \\frac{16}{3}.\n$$", "answer": "$$\\boxed{\\frac{16}{3}}$$", "id": "3662901"}]}