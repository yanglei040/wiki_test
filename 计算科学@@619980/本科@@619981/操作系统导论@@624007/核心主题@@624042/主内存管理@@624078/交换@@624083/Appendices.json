{"hands_on_practices": [{"introduction": "在管理交换机制时，首要任务是理解并避免“颠簸”（thrashing）——一种由于内存过度使用导致系统性能崩溃的状态。本练习将引导你使用内存管理理论的基石——工作集模型，来量化系统何时会进入颠簸状态。通过这个实践，你将学会如何根据系统参数（如物理内存大小和应用程序内存需求）来计算可以并发运行的最大作业数，从而将抽象的颠簸概念与具体的系统容量规划联系起来。[@problem_id:3685321]", "problem": "一个支持交换（swapping）和批处理调度的高性能计算（HPC）节点运行着一个操作系统。该节点拥有总计 $M = 256$ GiB 的物理随机存取存储器（RAM）。一个批处理队列分派 $n$ 个相同的作业。每个作业都有一个稳态内存工作集，大小为 $W = 9$ GiB，这是在适用于工作集模型的固定时间窗口 $\\Delta t$ 内测得的。操作系统的内存压力控制器会维持一个回收预留空间（reclaim headroom），并在总驻留内存需求超过总物理内存的一个比例 $\\beta$ 时，开始持续的页面回收。此处 $\\beta = 0.82$ 且 $0<\\beta<1$。\n\n使用工作集和颠簸（thrashing）的规范定义，其中颠簸是指持续的页面回收迫使工作集页面被反复换出和重新取回的状况，请从第一性原理出发，为该工作负载形式化地描述颠簸开始的条件，并推导出不发生颠簸的最大整数 $n_{\\max}$。然后，根据给定的 $M$、$W$ 和 $\\beta$ 数值计算 $n_{\\max}$。将最终答案表示为一个整数计数（无单位）。无需进行超出最大整数之外的舍入。", "solution": "首先对问题进行验证，以确保其科学合理性、一致性和良构性。\n\n### 步骤 1：提取给定条件\n- 总物理随机存取存储器（RAM）：$M = 256$ GiB。\n- 相同作业的数量：$n$。\n- 每个作业的稳态内存工作集：$W = 9$ GiB。\n- 工作集测量窗口：$\\Delta t$。\n- 内存压力阈值比例：$\\beta = 0.82$。\n- 阈值约束：$0 < \\beta < 1$。\n- 颠簸的定义：持续的页面回收迫使工作集页面被反复换出和重新取回的状况。\n\n### 步骤 2：使用提取的条件进行验证\n该问题在科学上基于操作系统内存管理的原理，特别是 Peter Denning 提出的工作集模型。颠簸（Thrashing）是一个明确定义的现象，当活动进程的组合内存需求超过可用物理内存时就会发生，导致过度的分页活动和系统吞吐量的崩溃。问题陈述使用了标准术语，并提供了一个清晰的量化设定。给定的内存大小（$M = 256$ GiB）、工作集大小（$W = 9$ GiB）和内存压力阈值（$\\beta = 0.82$）对于高性能计算（HPC）环境是现实的。该问题是自洽的，因为时间窗口 $\\Delta t$ 是给定工作集大小 $W$ 定义的一部分，但其具体数值对于计算并非必需。目标是基于这些参数推导出最大作业数 $n_{\\max}$，这是一个良构问题。该问题不包含科学或事实上的不合理之处，没有矛盾，也没有歧义。\n\n### 步骤 3：结论与行动\n问题被认定为有效。将从第一性原理推导解决方案。\n\n### 颠簸条件与解决方案的推导\n\n防止颠簸的基本原则是确保所有并发运行进程的总工作集能够被容纳在可用的物理内存中。一个进程的工作集是它在最近的时间窗口 $\\Delta t$ 内访问过的页面的集合。为了使进程高效执行，其整个工作集必须保持驻留在物理内存中。如果工作集中的页面被换出（swapped out），它们很可能很快会再次被需要，从而导致页面错误（page fault）以及随后的I/O操作，以从二级存储中将页面取回。当这种情况对大量进程以高频率发生时，系统就被称为处于颠簸状态。\n\n问题陈述了有 $n$ 个相同的作业，每个作业的工作集大小为 $W$。将所有 $n$ 个作业的工作集同时保留在内存中所需的总内存需求是总工作集大小，由下式给出：\n$$\n\\text{总工作集需求} = n \\cdot W\n$$\n\n当总驻留内存需求超过总物理内存 $M$ 的一个比例 $\\beta$ 时，操作系统会监控内存压力并开始持续的页面回收。这个阈值 $\\beta \\cdot M$ 代表了操作系统在采取激进措施（例如换出可能正在活跃使用的页面）以释放内存之前，允许用户进程占用的最大物理内存量。剩余的比例 $(1-\\beta)M$ 构成了“回收预留空间”，为操作系统内核、文件系统缓存以及为应对突发内存分配高峰提供缓冲而保留。\n\n为避免颠簸，所有作业的总工作集需求不得超过此操作内存容量。如果总工作集需求大于 $\\beta \\cdot M$，操作系统将被迫回收属于一个或多个作业工作集的页面。这一行为直接满足了问题对颠簸的定义：“持续的页面回收迫使工作集页面被反复换出和重新取回。”\n\n因此，在不发生颠簸的情况下运行的条件是：\n$$\nn \\cdot W \\le \\beta \\cdot M\n$$\n\n问题要求找出使此条件成立的最大整数 $n_{\\max}$。我们可以通过整理不等式来求解 $n$：\n$$\nn \\le \\frac{\\beta \\cdot M}{W}\n$$\n\n由于 $n$ 必须是代表作业数量的整数，因此最大值 $n_{\\max}$ 是满足此不等式的最大整数。这等同于对右侧表达式取底（floor）：\n$$\nn_{\\max} = \\left\\lfloor \\frac{\\beta \\cdot M}{W} \\right\\rfloor\n$$\n\n现在，我们代入问题陈述中提供的数值来计算 $n_{\\max}$：\n- $M = 256$ GiB\n- $W = 9$ GiB\n- $\\beta = 0.82$\n\n将这些值代入 $n_{\\max}$ 的表达式中：\n$$\nn_{\\max} = \\left\\lfloor \\frac{0.82 \\cdot 256 \\text{ GiB}}{9 \\text{ GiB}} \\right\\rfloor\n$$\n\nGiB 单位相互抵消，得到一个无量纲的量，这对于作业计数是符合预期的。我们进行计算：\n$$\nn_{\\max} = \\left\\lfloor \\frac{209.92}{9} \\right\\rfloor\n$$\n$$\nn_{\\max} = \\left\\lfloor 23.32444... \\right\\rfloor\n$$\n\n该值的底为 $23$。因此，可以并发运行而不会引发颠簸的最大整数作业数是 $23$。如果运行 $24$ 个作业，它们的总工作集需求（$24 \\cdot 9$ GiB $= 216$ GiB）将超过允许的内存阈值（$0.82 \\cdot 256$ GiB $\\approx 209.92$ GiB），从而触发持续的页面回收，并因此导致颠簸。", "answer": "$$\n\\boxed{23}\n$$", "id": "3685321"}, {"introduction": "一旦操作系统决定需要通过交换来释放内存，下一个关键问题便是选择换出哪些页面。不同类型的页面（例如，必须写入交换区的匿名页面与可直接丢弃的文件支持页面）其回收成本大相径庭。本练习将引导你探索如何设计一个公平的页面回收策略，通过定义一个量化指标来平衡不同类型页面所承受的回收压力，这体现了如何运用控制论思想来维护系统的整体性能与公平性。[@problem_id:3685374]", "problem": "操作系统（OS）通过驱逐文件支持页（可以被丢弃并从文件系统重新读取）或匿名页（必须被写入交换区并在之后读回）来管理物理内存，这个过程被称为交换（swapping）。为了分析在内存压力下这两类页面之间的公平性，我们考虑一个在离散控制窗口中运行的控制器。该控制器设置一个扫描共享参数 $\\theta \\in [0,1]$，该参数被解释为针对匿名页的驱逐努力所占的比例，而剩余的 $1-\\theta$ 比例的努力则针对文件支持页。假设在一个给定的控制窗口内，每类页面的驱逐数量与扫描共享参数近似成正比，这是分页系统中广泛使用的一个经验性观察。此外，由于匿名页的换入/换出涉及更高的输入/输出（I/O）成本，我们在公平性评估中给予匿名页驱逐比文件支持页驱逐更高的权重。\n\n为单个控制窗口定义如下变量：\n- $E_{f}$ 和 $E_{a}$：分别是在该窗口内测得的文件支持页和匿名页的驱逐数量。\n- $R_{f}$ 和 $R_{a}$：分别是窗口开始时的常驻文件支持页和匿名页数量。\n- $w_{f}$ 和 $w_{a}$：分别代表文件支持页和匿名页的非负权重，用于捕捉单次驱逐的重新填充成本，其中 $w_{a} > w_{f}$ 反映了匿名页的回收和后续填充成本更高。\n- 一个公平性度量 $\\mathcal{F}$，定义为按常驻页面和成本加权的驱逐率之比：\n$$\n\\mathcal{F} \\;=\\; \\frac{ \\dfrac{E_{f}}{w_{f} R_{f}} }{ \\dfrac{E_{a}}{w_{a} R_{a}} } \\, .\n$$\n公平性目标是 $\\mathcal{F} \\approx 1$，这意味着对于每个常驻页面，在成本加权后，每个类别的页面承受着相当的驱逐压力。\n\n在当前窗口中，当 $\\theta_{\\text{old}} = 0.3$ 时，您获得以下测量值：$E_{f} = 1200$, $E_{a} = 400$, $R_{f} = 6000$, $R_{a} = 4000$, $w_{f} = 1$, $w_{a} = 2$。对于下一个窗口，总驱逐需求 $E_{\\text{tot}}$ 预计将保持近似恒定，并且假设控制器的扫描共享设置 $\\theta$ 通过 $E_{a} \\approx \\theta \\, E_{\\text{tot}}$ 和 $E_{f} \\approx (1-\\theta)\\, E_{\\text{tot}}$ 来决定预期的驱逐数量。\n\n在所述的比例模型下，控制器应为下一个窗口使用哪种 $\\theta$ 的更新规则，以使 $\\mathcal{F}$ 近似等于 $1$？\n\nA. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} \\cdot \\sqrt{\\mathcal{F}}\\big)\\big)$。\n\nB. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} / \\sqrt{\\mathcal{F}}\\big)\\big)$。\n\nC. 设置 $\\theta_{\\text{new}} = \\min\\!\\Big(1,\\max\\!\\Big(0, \\dfrac{w_{a} R_{a}}{\\,w_{a} R_{a} + w_{f} R_{f}\\,}\\Big)\\Big)$。\n\nD. 保持 $\\theta$ 不变：$\\theta_{\\text{new}} = \\theta_{\\text{old}}$。\n\n请只选择一个选项。", "solution": "### 问题验证\n\n首先，对问题陈述进行验证。\n\n**步骤1：提取给定条件**\n\n-   **控制参数**：$\\theta \\in [0,1]$，针对匿名页的驱逐努力的比例。\n-   **系统模型**：\n    -   针对文件支持页的驱逐努力为 $1-\\theta$。\n    -   驱逐数量与扫描共享参数近似成正比。\n    -   对于下一个控制窗口，该模型具体表示为：\n        -   $E_{a} \\approx \\theta \\, E_{\\text{tot}}$\n        -   $E_{f} \\approx (1-\\theta)\\, E_{\\text{tot}}$\n        其中 $E_{\\text{tot}}$ 是总驱逐数量，假设为常数。\n-   **定义**：\n    -   $E_{f}, E_{a}$：文件支持页和匿名页的驱逐数量。\n    -   $R_{f}, R_{a}$：窗口开始时的常驻文件支持页和匿名页数量。\n    -   $w_{f}, w_{a}$：用于重新填充成本的非负权重，其中 $w_{a} > w_{f}$。\n-   **公平性度量**：$\\mathcal{F} \\;=\\; \\frac{ \\frac{E_{f}}{w_{f} R_{f}} }{ \\frac{E_{a}}{w_{a} R_{a}} }$。\n-   **目标**：设置 $\\theta_{\\text{new}}$，使得下一个窗口的公平性度量 $\\mathcal{F}_{\\text{new}}$ 近似为 $1$。\n-   **来自当前（旧）窗口的数据**：\n    -   $\\theta_{\\text{old}} = 0.3$\n    -   $E_{f} = 1200$\n    -   $E_{a} = 400$\n    -   $R_{f} = 6000$\n    -   $R_{a} = 4000$\n    -   $w_{f} = 1$\n    -   $w_{a} = 2$\n\n**步骤2：使用提取的给定条件进行验证**\n\n-   **科学依据**：该问题在操作系统设计原理，特别是内存管理和分页策略方面有充分的依据。使用基于成本或比例的控制器来平衡不同类型内存（匿名页与文件支持页）之间的驱逐压力的概念是一种真实世界的技术（例如，在Linux内核中可以看到）。该模型是对此类控制问题的简化但有效的表示。\n-   **适定性**：该问题是适定的。它提供了所有必要的变量，一个清晰的控制器效果数学模型，以及一个具体的目标（$\\mathcal{F}_{\\text{new}} \\approx 1$）。从这些组件中可以推导出一个唯一的控制律。\n-   **客观性**：问题以客观、正式的语言陈述。\n-   **一致性检查**：我们可以检查旧窗口提供的数据与比例模型的一致性。\n    -   总驱逐数量：$E_{\\text{tot}} = E_f + E_a = 1200 + 400 = 1600$。\n    -   模型对 $E_a$ 的预测：$\\theta_{\\text{old}} E_{\\text{tot}} = 0.3 \\times 1600 = 480$。这与测量的 $E_a = 400$ 不同。\n    -   模型对 $E_f$ 的预测：$(1-\\theta_{\\text{old}}) E_{\\text{tot}} = 0.7 \\times 1600 = 1120$。这与测量的 $E_f = 1200$ 不同。\n    问题陈述明确指出，比例关系是一个*近似*（“近似成正比”，“预期的驱逐数量...通过 $E_a \\approx \\theta E_{tot}$”）。模型与过去数据之间的差异反映了这是一个复杂系统的简化模型，这在控制工程中是现实情况。任务是使用*陈述的模型*来确定*下一个*控制动作，而不是验证模型过去性能的准确性。因此，该问题并非自相矛盾，而是提出了一个现实的建模挑战。\n\n**步骤3：结论与行动**\n\n问题是**有效的**。这是一个标准的、尽管简化的、应用于操作系统相关主题的控制理论问题。我现在将进行求解。\n\n### 解题推导\n\n目标是找到一个 $\\theta$ 的更新规则，使得下一个控制窗口中的公平性度量 $\\mathcal{F}$ 近似等于 1。设 $\\theta$ 的新值为 $\\theta_{\\text{new}}$。\n\n目标是 $\\mathcal{F}_{\\text{new}} \\approx 1$。为了推导，我们将目标设为精确值 $\\mathcal{F}_{\\text{new}} = 1$。\n公平性度量的定义是：\n$$ \\mathcal{F}_{\\text{new}} = \\frac{ \\dfrac{E_{f, \\text{new}}}{w_{f} R_{f, \\text{new}}} }{ \\dfrac{E_{a, \\text{new}}}{w_{a} R_{a, \\text{new}}} } $$\n设置 $\\mathcal{F}_{\\text{new}} = 1$ 得到完美公平的条件：\n$$ \\frac{E_{f, \\text{new}}}{w_{f} R_{f, \\text{new}}} = \\frac{E_{a, \\text{new}}}{w_{a} R_{a, \\text{new}}} $$\n\n问题陈述我们必须使用比例模型来确定下一个窗口中的预期驱逐数量：\n-   $E_{a, \\text{new}} = \\theta_{\\text{new}} E_{\\text{tot}}$\n-   $E_{f, \\text{new}} = (1-\\theta_{\\text{new}}) E_{\\text{tot}}$\n\n这里，$E_{\\text{tot}}$ 是总驱逐需求，假设为常数。$R_{f, \\text{new}}$ 和 $R_{a, \\text{new}}$ 是下一个窗口开始时的常驻页面数量。\n\n将模型代入公平性条件：\n$$ \\frac{(1-\\theta_{\\text{new}}) E_{\\text{tot}}}{w_{f} R_{f, \\text{new}}} = \\frac{\\theta_{\\text{new}} E_{\\text{tot}}}{w_{a} R_{a, \\text{new}}} $$\n由于 $E_{\\text{tot}}$ 是一个非零常数，可以从两边消去：\n$$ \\frac{1-\\theta_{\\text{new}}}{w_{f} R_{f, \\text{new}}} = \\frac{\\theta_{\\text{new}}}{w_{a} R_{a, \\text{new}}} $$\n我们现在求解 $\\theta_{\\text{new}}$：\n$$ (1-\\theta_{\\text{new}}) w_{a} R_{a, \\text{new}} = \\theta_{\\text{new}} w_{f} R_{f, \\text{new}} $$\n$$ w_{a} R_{a, \\text{new}} - \\theta_{\\text{new}} w_{a} R_{a, \\text{new}} = \\theta_{\\text{new}} w_{f} R_{f, \\text{new}} $$\n$$ w_{a} R_{a, \\text{new}} = \\theta_{\\text{new}} (w_{f} R_{f, \\text{new}} + w_{a} R_{a, \\text{new}}) $$\n$$ \\theta_{\\text{new}} = \\frac{w_{a} R_{a, \\text{new}}}{w_{f} R_{f, \\text{new}} + w_{a} R_{a, \\text{new}}} $$\n\n这个方程代表了为实现公平性目标而设置 $\\theta$ 的基本原则。控制器应将 $\\theta$ 设置为成本加权的常驻匿名页数量与总成本加权的常驻页面数量之比。\n\n### 逐项分析选项\n\n现在我将评估每个选项。一个更新规则理想情况下应基于上面推导出的原则。\n\n**C. 设置 $\\theta_{\\text{new}} = \\min\\!\\Big(1,\\max\\!\\Big(0, \\dfrac{w_{a} R_{a}}{\\,w_{a} R_{a} + w_{f} R_{f}\\,}\\Big)\\Big)$。**\n\n这个选项的公式 $\\dfrac{w_{a} R_{a}}{w_{a} R_{a} + w_{f} R_{f}}$，在功能上与我推导出的公式相同。公式中的变量 $R_a$ 和 $R_f$ 应被解释为设置 $\\theta$ 的那个窗口开始时的值。使用 $\\min(1, \\max(0, ...))$ 是控制系统中的标准做法，以确保输出保持在有效范围 $[0,1]$ 内，这是一种鲁棒性措施。该规则是为实现 $\\mathcal{F}=1$ 而推导出的原则的直接实现。\n\n因此，该选项代表了正确的、有原则的更新规则。控制器应测量或估计即将到来的 $R_f$ 和 $R_a$，并应用此公式。\n\n**结论：正确**\n\n**D. 保持 $\\theta$ 不变：$\\theta_{\\text{new}} = \\theta_{\\text{old}}$。**\n\n要检查这是否正确，我们必须计算旧窗口的公平性度量 $\\mathcal{F}_{\\text{old}}$。\n$$ \\mathcal{F}_{\\text{old}} = \\frac{ \\dfrac{E_{f}}{w_{f} R_{f}} }{ \\dfrac{E_{a}}{w_{a} R_{a}} } = \\frac{ \\dfrac{1200}{1 \\cdot 6000} }{ \\dfrac{400}{2 \\cdot 4000} } = \\frac{ \\dfrac{1200}{6000} }{ \\dfrac{400}{8000} } = \\frac{0.2}{0.05} = 4 $$\n由于 $\\mathcal{F}_{\\text{old}} = 4 \\neq 1$，系统不处于公平状态。目标是使 $\\mathcal{F}_{\\text{new}} \\approx 1$。保持 $\\theta$ 不变将无法主动纠正这种不平衡。因此，此选项不正确。\n\n**结论：不正确**\n\n**B. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} / \\sqrt{\\mathcal{F}}\\big)\\big)$。**\n\n让我们分析这个控制律的方向。我们有 $\\mathcal{F}_{\\text{old}} = 4$，大于 1。这表明与匿名页相比，施加在文件支持页上的成本加权驱逐压力过高。为了纠正这一点，控制器必须增加对匿名页的压力，即增加 $E_a$。根据模型 $E_a \\approx \\theta E_{\\text{tot}}$，这需要增加 $\\theta$。\n该规则提出 $\\theta_{\\text{new}} = \\theta_{\\text{old}} / \\sqrt{\\mathcal{F}_{\\text{old}}}$。使用 $\\theta_{\\text{old}}=0.3$ 和 $\\mathcal{F}_{\\text{old}}=4$，我们得到：\n$$ \\theta_{\\text{new}} = 0.3 / \\sqrt{4} = 0.3 / 2 = 0.15 $$\n当 $\\theta$ 应该增加时，这个规则反而*减少*了它。控制动作的方向是错误的。\n\n**结论：不正确**\n\n**A. 设置 $\\theta_{\\text{new}} = \\min\\!\\big(1,\\max\\!\\big(0, \\theta_{\\text{old}} \\cdot \\sqrt{\\mathcal{F}}\\big)\\big)$。**\n\n该规则提出 $\\theta_{\\text{new}} = \\theta_{\\text{old}} \\cdot \\sqrt{\\mathcal{F}_{\\text{old}}}$。使用给定的数据，得出：\n$$ \\theta_{\\text{new}} = 0.3 \\cdot \\sqrt{4} = 0.3 \\cdot 2 = 0.6 $$\n这是一个方向正确的反馈控制律（当 $\\mathcal{F}>1$ 时它会增加 $\\theta$）。然而，这是一种启发式方法。它不是从系统模型和公平性目标推导出来的。虽然这种乘法更新规则可能有效，但不能保证在一步之内达到目标。选项 C 中的规则是根据给定模型直接推导出的单步解决方案。问题要求控制器*应该*使用哪种规则来使 $\\mathcal{F} \\approx 1$。与一个未经证实的启发式方法（选项 A）相比，那个经过分析推导出的能够精确做到这一点的规则（选项 C）是最恰当和最有原则的选择，即使该启发式方法为提供的特定数据产生了合理数值结果。科学或工程问题的核心是识别其基本原理，而这正是选项 C 所代表的。\n\n**结论：不正确**\n\n最严谨、最有原则的答案是直接从问题的模型和目标推导出的那个，即选项 C。它描述了实现期望的公平性输出（$\\mathcal{F}=1$）所需系统状态（$R_f, R_a, w_f, w_a$）与控制输入（$\\theta$）之间的基本关系。", "answer": "$$\\boxed{C}$$", "id": "3685374"}, {"introduction": "现代操作系统中的高级功能有时会与基本机制（如交换）产生意想不到的负面交互。本练习提供了一个真实的性能调优场景，探讨了透明大页（Transparent Huge Pages, THP）在特定条件下如何加剧交换活动，导致系统颠簸。你将学习如何通过分析系统指标，设计一个包含平滑（smoothing）和滞后（hysteresis）等鲁棒控制技术的启发式策略，以动态地禁用或启用THP来化解这种冲突，从而确保系统稳定性。[@problem_id:3685380]", "problem": "一个运行透明大页（THP）的系统，在内存压力下会经历间歇性的延迟尖峰。请考虑以下基本原理。当一个页面不在主内存中，必须从二级存储中获取时，就会发生主页面错误，这可能导致交换。交换抖动是指活动进程的工作集超过可用物理内存，导致系统将大量时间用于分页而不是执行有效工作的状态。设每秒页面错误数（pf/s）为速率 $\\text{pf/s} = \\Delta F / \\Delta t$，其中 $\\Delta F$ 是在时间间隔 $\\Delta t$ 内主页面错误累计计数的变化量。设 THP 分配失败率为 $r_{\\text{fail}} = \\Delta N_{\\text{fail}} / \\Delta N_{\\text{attempt}}$，其中 $\\Delta N_{\\text{attempt}}$ 是 THP 分配的尝试次数，$\\Delta N_{\\text{fail}}$ 是其中失败的次数。在内存碎片化和内存压力下，THP 分配失败会引发内核内存规整和页面拆分，这可能会加剧交换活动。你的任务是决定何时禁用 THP 以减轻交换抖动，同时避免振荡。\n\n在时间 $t = 0$ 启用 THP 后，系统在 3 个连续的时间间隔内被观察，每个间隔长度为 $\\Delta t = 10 \\text{ s}$。计数器如下：\n\n- 间隔 $1$：$\\Delta F = 3100$, $\\Delta N_{\\text{attempt}} = 400$, $\\Delta N_{\\text{fail}} = 160$。\n- 间隔 $2$：$\\Delta F = 2600$, $\\Delta N_{\\text{attempt}} = 500$, $\\Delta N_{\\text{fail}} = 200$。\n- 间隔 $3$：$\\Delta F = 1700$, $\\Delta N_{\\text{attempt}} = 300$, $\\Delta N_{\\text{fail}} = 60$。\n\n假设在启用 THP 之前，基线平滑页面错误率为 $m_0 = 50$ pf/s。一个提议的策略旨在仅当 THP 可能导致交换抖动时才禁用它，该策略结合了高页面错误压力和与 THP 相关的内存管理开销的迹象。设阈值为 $\\theta = 200$ pf/s 和 $\\eta = 0.3$。假设需要平滑处理以降低对瞬时尖峰的敏感性，并需要滞后效应以避免在条件接近阈值时发生状态抖动。\n\n哪个选项最恰当地指定了一个基于这些观察和阈值的稳健的禁用-重启用启发式方法，并正确地得出在间隔 3 结束时应采取什么行动的结论？\n\nA. 如果任何单个间隔内的瞬时 $\\text{pf/s}$ 超过 $\\theta$ 或 THP 分配失败率超过 $\\eta$，则禁用 THP；一旦任一瞬时指标低于其阈值，就重新启用。根据给定数据，在间隔 1 结束时禁用，在间隔 3 结束时重新启用。\n\nB. 当作为权重为 $\\alpha = 0.7$ 的指数加权移动平均计算的平滑 $\\text{pf/s}$ 连续至少 2 个间隔超过 $\\theta$，并且 THP 分配失败率也连续至少 2 个间隔超过 $\\eta$ 时，禁用 THP；仅当两个指标连续 3 个间隔保持在较低的滞后阈值 $\\theta_{\\text{low}} = 0.6 \\theta$ 和 $\\eta_{\\text{low}} = 0.5 \\eta$ 以下时才重新启用。根据给定数据，在间隔 2 结束时禁用，并在整个间隔 3 期间保持禁用状态。\n\nC. 如果次要页面错误率超过 $\\theta$，则禁用 THP，无论 THP 分配失败情况如何；当 THP 分配失败率降至 $\\eta$ 以下时重新启用。根据给定数据，在间隔 1 结束时禁用，在间隔 2 结束时重新启用。\n\nD. 仅当 THP 分配失败率连续 3 个间隔超过 $\\eta$ 时才禁用 THP，忽略因噪声太大而被认为不可靠的 $\\text{pf/s}$；当分配失败率降至 $\\eta$ 以下时重新启用。根据给定数据，永不禁用 THP。", "solution": "### 步骤 1：提取已知条件\n- 一个系统正在运行透明大页（THP）。\n- 提供了主页面错误的定义。\n- 提供了交换抖动的定义。\n- 页面错误率定义为 $\\text{pf/s} = \\Delta F / \\Delta t$。\n- THP 分配失败率定义为 $r_{\\text{fail}} = \\Delta N_{\\text{fail}} / \\Delta N_{\\text{attempt}}$。\n- 问题背景指出 THP 分配失败会加剧交换活动。\n- 任务是为 THP 指定一个稳健的禁用-重启用启发式方法，以减轻交换抖动，同时避免振荡。\n- 观察期包括 3 个连续的时间间隔，每个间隔的持续时间为 $\\Delta t = 10 \\text{ s}$。\n- 间隔 1 的数据：$\\Delta F = 3100$, $\\Delta N_{\\text{attempt}} = 400$, $\\Delta N_{\\text{fail}} = 160$。\n- 间隔 2 的数据：$\\Delta F = 2600$, $\\Delta N_{\\text{attempt}} = 500$, $\\Delta N_{\\text{fail}} = 200$。\n- 间隔 3 的数据：$\\Delta F = 1700$, $\\Delta N_{\\text{attempt}} = 300$, $\\Delta N_{\\text{fail}} = 60$。\n- 启用 THP 前的基线平滑页面错误率：$m_0 = 50$ pf/s。\n- 建议的策略阈值：$\\theta = 200$ pf/s 和 $\\eta = 0.3$。\n- 期望的策略特性：平滑处理和滞后效应。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上基于操作系统领域，特别是内存管理。透明大页（THP）、页面错误、交换抖动、内存规整以及它们之间潜在的负面相互作用等概念都是公认的。使用控制论原理，如平滑处理（例如，EWMA）和滞后效应来创建稳定的系统策略，是一种标准且稳健的工程实践。问题提取得当，提供了评估选项中提议的启发式方法所需的所有必要定义和数据。语言客观而精确。数值对于一个高负载下的系统是合理的。该问题没有违反任何指定的无效标准。\n\n### 步骤 3：结论和行动\n问题陈述是**有效的**。将推导解决方案。\n\n### 推导与选项分析\n\n首先，我们根据提供的数据和定义，计算 3 个时间间隔中每个间隔的瞬时指标。设 $p_i$ 为间隔 $i$ 的页面错误率，$r_i$ 为该间隔的 THP 分配失败率。给定的时间间隔长度为 $\\Delta t = 10 \\text{ s}$。\n\n**间隔 1:**\n- 页面错误率: $p_1 = \\frac{\\Delta F_1}{\\Delta t} = \\frac{3100}{10 \\text{ s}} = 310 \\text{ pf/s}$。\n- THP 分配失败率: $r_1 = \\frac{\\Delta N_{\\text{fail,1}}}{\\Delta N_{\\text{attempt,1}}} = \\frac{160}{400} = 0.4$。\n\n**间隔 2:**\n- 页面错误率: $p_2 = \\frac{\\Delta F_2}{\\Delta t} = \\frac{2600}{10 \\text{ s}} = 260 \\text{ pf/s}$。\n- THP 分配失败率: $r_2 = \\frac{\\Delta N_{\\text{fail,2}}}{\\Delta N_{\\text{attempt,2}}} = \\frac{200}{500} = 0.4$。\n\n**间隔 3:**\n- 页面错误率: $p_3 = \\frac{\\Delta F_3}{\\Delta t} = \\frac{1700}{10 \\text{ s}} = 170 \\text{ pf/s}$。\n- THP 分配失败率: $r_3 = \\frac{\\Delta N_{\\text{fail,3}}}{\\Delta N_{\\text{attempt,3}}} = \\frac{60}{300} = 0.2$。\n\n阈值为 $\\theta = 200 \\text{ pf/s}$ 和 $\\eta = 0.3$。\n我们可以将指标与其各自阈值的比较总结如下：\n- 间隔 $1$: $p_1 = 310 > \\theta$ 且 $r_1 = 0.4 > \\eta$。\n- 间隔 $2$: $p_2 = 260 > \\theta$ 且 $r_2 = 0.4 > \\eta$。\n- 间隔 $3$: $p_3 = 170  \\theta$ 且 $r_3 = 0.2  \\eta$。\n\n问题要求一个能避免振荡的“稳健的禁用-重启用启发式方法”，并明确提到平滑处理和滞后效应是理想的特性。我们现在根据这一要求和计算出的数据来评估每个选项。\n\n**A. 如果任何单个间隔内的瞬时 $\\text{pf/s}$ 超过 $\\theta$ 或 THP 分配失败率超过 $\\eta$，则禁用 THP；一旦任一瞬时指标低于其阈值，就重新启用。根据给定数据，在间隔 1 结束时禁用，在间隔 3 结束时重新启用。**\n\n该启发式方法基于瞬时值，并且没有任何形式的平滑处理或滞后效应。一个在单个间隔内穿越阈值就触发的策略，极易受到“状态抖动”或振荡的影响，导致系统频繁地开关 THP。问题陈述明确要求一个能够避免这种行为的稳健策略。因此，所提议的启发式方法设计不佳。应用其逻辑：在间隔 1 结束时，$p_1  \\theta$，所以 THP 会被禁用。在间隔 3 结束时，$p_3  \\theta$ 和 $r_3  \\eta$ 都成立，所以 THP 会被重新启用。虽然基于这个有缺陷的策略得出的行动结论在算术上是合理的，但策略本身并不稳健，且与设计目标相矛盾。\n\n**结论：不正确。**\n\n**B. 当作为权重为 $\\alpha = 0.7$ 的指数加权移动平均计算的平滑 $\\text{pf/s}$ 连续至少 2 个间隔超过 $\\theta$，并且 THP 分配失败率也连续至少 2 个间隔超过 $\\eta$ 时，禁用 THP；仅当两个指标连续 3 个间隔保持在较低的滞后阈值 $\\theta_{\\text{low}} = 0.6 \\theta$ 和 $\\eta_{\\text{low}} = 0.5 \\eta$ 以下时才重新启用。根据给定数据，在间隔 2 结束时禁用，并在整个间隔 3 期间保持禁用状态。**\n\n该启发式方法包含了稳健控制策略的所有期望特性：\n1.  **平滑处理**：它对页面错误率使用指数加权移动平均（EWMA），$m_i = \\alpha p_i + (1-\\alpha) m_{i-1}$，以抑制瞬时尖峰。\n2.  **持续性**：它要求在禁用前条件需连续满足 2 个间隔，在重新启用前需连续满足 3 个间隔，从而防止对短暂波动的反应。\n3.  **滞后效应**：它使用独立的、较低的阈值（$\\theta_{\\text{low}}$, $\\eta_{\\text{low}}$）进行重新启用，以创建一个“死区”，防止在主阈值附近发生状态抖动。\n4.  **组合条件**：它要求同时存在高页面错误压力和高 THP 分配失败率，从而正确诊断所述的特定问题场景。\n\n让我们将此策略应用于数据。平滑参数为 $\\alpha = 0.7$，初始平滑值为 $m_0 = 50 \\text{ pf/s}$。阈值为 $\\theta = 200 \\text{ pf/s}$ 和 $\\eta = 0.3$。\n- **间隔 1：**\n  - 平滑后的 pf/s: $m_1 = \\alpha p_1 + (1-\\alpha)m_0 = (0.7)(310) + (0.3)(50) = 217 + 15 = 232 \\text{ pf/s}$。\n  - 条件：$m_1 = 232  \\theta$ 且 $r_1 = 0.4  \\eta$。这是第一个满足禁用标准的间隔。尚未采取行动。\n- **间隔 2：**\n  - 平滑后的 pf/s: $m_2 = \\alpha p_2 + (1-\\alpha)m_1 = (0.7)(260) + (0.3)(232) = 182 + 69.6 = 251.6 \\text{ pf/s}$。\n  - 条件：$m_2 = 251.6  \\theta$ 且 $r_2 = 0.4  \\eta$。这是连续第二个满足禁用标准的间隔。\n  - **行动**：在间隔 2 结束时，策略被触发，THP 被禁用。\n- **间隔 3：**\n  - 策略保持 THP 禁用状态。重新启用的条件要求指标连续 3 个间隔低于 $\\theta_{\\text{low}} = 0.6 \\theta = 120 \\text{ pf/s}$ 和 $\\eta_{\\text{low}} = 0.5 \\eta = 0.15$。在间隔 3 中，$p_3=170  \\theta_{\\text{low}}$ 且 $r_3 = 0.2  \\eta_{\\text{low}}$。重新启用的条件未被满足。\n\n该启发式方法设计稳健，将其应用于数据得出的结论与选项中所述一致：在间隔 2 结束时禁用，并保持禁用状态。\n\n**结论：正确。**\n\n**C. 如果次要页面错误率超过 $\\theta$，则禁用 THP，无论 THP 分配失败情况如何；当 THP 分配失败率降至 $\\eta$ 以下时重新启用。根据给定数据，在间隔 1 结束时禁用，在间隔 2 结束时重新启用。**\n\n此选项存在根本性缺陷。该策略规则基于**次要**页面错误率。而问题只提供了由 $\\Delta F$ 定义的**主**页面错误的数据。不能用一个指标替代另一个。次要和主页面错误代表不同的系统事件。此外，禁用条件忽略了作为关键指标的 THP 失败率。重新启用的逻辑与禁用逻辑不对称，并且缺乏滞后效应，使其设计不佳。由于无法使用给定数据评估该策略，因此该选项无效。\n\n**结论：不正确。**\n\n**D. 仅当 THP 分配失败率连续 3 个间隔超过 $\\eta$ 时才禁用 THP，忽略因噪声太大而被认为不可靠的 $\\text{pf/s}$；当分配失败率降至 $\\eta$ 以下时重新启用。根据给定数据，永不禁用 THP。**\n\n这个启发式方法的构思很差，因为它完全忽略了它旨在解决的问题的主要症状。交换抖动是由过度的分页活动定义的，因此任何旨在减轻它的策略都必须考虑页面错误率（$\\text{pf/s}$）。虽然失败率 $r_{\\text{fail}}$ 是 THP 引起的压力的一个指标，但它不是抖动的直接度量。重新启用的条件缺乏持续性和滞后效应，使其容易发生状态抖动。应用这个有缺陷的逻辑：\n- 条件：$r_i  \\eta = 0.3$ 连续 3 个间隔。\n- 间隔 1: $r_1 = 0.4  0.3$。（满足 1 个间隔）\n- 间隔 2: $r_2 = 0.4  0.3$。（满足 2 个间隔）\n- 间隔 3: $r_3 = 0.2  0.3$。（不满足）\n该条件没有连续 3 个间隔都满足，因此 THP 从未被禁用。选项中得出的结论是其自身有缺陷规则的正确应用，但规则本身并不合适。\n\n**结论：不正确。**\n\n总之，选项 B 是唯一一个提出与稳健控制系统工程的既定原则（平滑处理、滞后效应、持续性）相一致，并正确解决所述问题（使用相关指标的组合条件）的启发式方法的选项。支持其结论的计算也是正确的。", "answer": "$$\\boxed{B}$$", "id": "3685380"}]}