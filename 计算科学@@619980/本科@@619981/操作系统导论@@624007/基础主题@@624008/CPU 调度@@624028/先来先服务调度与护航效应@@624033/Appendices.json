{"hands_on_practices": [{"introduction": "要理解护航效应，我们首先需要对其进行量化。这个练习将引导你通过一个具体的工作负载，直接比较先来先服务（FCFS）调度与一种理想的抢占式策略——最短剩余处理时间（SRPT）调度。通过计算像“slowdown”（减速因子）这样的关键性能指标，你将具体地体会到非抢占式策略对短作业的惩罚有多严重 [@problem_id:3643765]。", "problem": "考虑一个上下文切换开销可忽略不计且支持抢占的单处理器系统。调度器必须处理一个由八个独立作业组成的轨迹驱动的工作负载，这些作业的到达时间和服务需求（也称为CPU突发）是已知的。这些作业是：\n- 作业 $J_{1}$：到达时间 $0$，服务需求 $20$。\n- 作业 $J_{2}$：到达时间 $1$，服务需求 $1$。\n- 作业 $J_{3}$：到达时间 $2$，服务需求 $2$。\n- 作业 $J_{4}$：到达时间 $3$，服务需求 $1$。\n- 作业 $J_{5}$：到达时间 $4$，服务需求 $3$。\n- 作业 $J_{6}$：到达时间 $10$，服务需求 $1$。\n- 作业 $J_{7}$：到达时间 $10.5$，服务需求 $4$。\n- 作业 $J_{8}$：到达时间 $11$，服务需求 $1$。\n\n您将比较两种调度策略：\n- 先来先服务 (FCFS)：非抢占式，作业按到达时间的非递减顺序进行服务。\n- 最短剩余处理时间 (SRPT)：抢占式，在任何时刻，剩余处理时间最短的作业被调度；平局时，优先选择当前正在运行的作业。\n\n使用以下来自操作系统和排队论的基本定义：\n- 作业 $i$ 的完成时间 $C_{i}$ 是指作业 $i$ 完成服务的时刻。\n- 作业 $i$ 的周转时间（也称 turnaround time）$F_{i}$ 是 $F_{i} = C_{i} - A_{i}$，其中 $A_{i}$ 是到达时间。\n- 作业 $i$ 的慢度（也称 stretch）$S_{i}$ 是 $S_{i} = \\frac{F_{i}}{B_{i}}$，其中 $B_{i}$ 是作业 $i$ 的服务需求。\n\n将服务需求 $B_{i} \\leq 2$ 的作业定义为短作业。设 $\\overline{S}_{\\text{short}}^{\\text{FCFS}}$ 为先来先服务策略下短作业的平均慢度，设 $\\overline{S}_{\\text{short}}^{\\text{SRPT}}$ 为最短剩余处理时间策略下短作业的平均慢度。短作业慢度因子 $\\Phi$ 定义为对于短作业集合，FCFS 相对于 SRPT 引起的平均慢度的乘法增长：\n$$\n\\Phi \\equiv \\frac{\\overline{S}_{\\text{short}}^{\\text{FCFS}}}{\\overline{S}_{\\text{short}}^{\\text{SRPT}}}.\n$$\n\n仅从上述定义出发（不使用额外公式），为给定的轨迹计算 $\\Phi$，并根据护航效应（一种长作业在队列头部导致其后一系列等待作业排队的现象）解释其值。将最终答案四舍五入至四位有效数字。最终答案无需单位。", "solution": "问题要求计算短作业慢度因子 $\\Phi$，该因子用于比较先来先服务 (FCFS) 和最短剩余处理时间 (SRPT) 调度策略在给定作业集上的性能。分析过程分为四个阶段：(1) 识别短作业子集，(2) 模拟 FCFS 下的工作负载以找到短作业的平均慢度，(3) 模拟 SRPT 下的工作负载以找到短作业的平均慢度，以及 (4) 计算比率 $\\Phi$ 并解释其值。\n\n首先，我们识别短作业集合，其定义为服务需求 $B_{i} \\leq 2$ 的作业。服务需求分别为：$B_{1}=20$, $B_{2}=1$, $B_{3}=2$, $B_{4}=1$, $B_{5}=3$, $B_{6}=1$, $B_{7}=4$, and $B_{8}=1$。满足条件 $B_{i} \\leq 2$ 的作业是 $J_{2}$、$J_{3}$、$J_{4}$、$J_{6}$ 和 $J_{8}$。共有 $5$ 个短作业。\n\n接下来，我们分析 FCFS 调度策略。FCFS 是非抢占式的，并按作业的到达顺序提供服务。到达时间 $A_i$ 分别是 $0, 1, 2, 3, 4, 10, 10.5, 11$，因此执行序列是 $J_1, J_2, J_3, J_4, J_5, J_6, J_7, J_8$。\n\nFCFS 下的完成时间 $C_{i}$ 计算如下：\n- 作业 $J_{1}$ ($A_{1}=0, B_{1}=20$)：在 $t=0$ 开始，在 $t=20$ 结束。$C_{1}=20$。\n- 作业 $J_{2}$ ($A_{2}=1, B_{2}=1$)：在 $J_1$ 之后于 $t=20$ 开始，在 $t=20+1=21$ 结束。$C_{2}=21$。\n- 作业 $J_{3}$ ($A_{3}=2, B_{3}=2$)：在 $J_2$ 之后于 $t=21$ 开始，在 $t=21+2=23$ 结束。$C_{3}=23$。\n- 作业 $J_{4}$ ($A_{4}=3, B_{4}=1$)：在 $J_3$ 之后于 $t=23$ 开始，在 $t=23+1=24$ 结束。$C_{4}=24$。\n- 作业 $J_{5}$ ($A_{5}=4, B_{5}=3$)：在 $J_4$ 之后于 $t=24$ 开始，在 $t=24+3=27$ 结束。$C_{5}=27$。\n- 作业 $J_{6}$ ($A_{6}=10, B_{6}=1$)：在 $J_5$ 之后于 $t=27$ 开始，在 $t=27+1=28$ 结束。$C_{6}=28$。\n- 作业 $J_{7}$ ($A_{7}=10.5, B_{7}=4$)：在 $J_6$ 之后于 $t=28$ 开始，在 $t=28+4=32$ 结束。$C_{7}=32$。\n- 作业 $J_{8}$ ($A_{8}=11, B_{8}=1$)：在 $J_7$ 之后于 $t=32$ 开始，在 $t=32+1=33$ 结束。$C_{8}=33$。\n\n现在我们为短作业计算周转时间 $F_{i} = C_{i} - A_{i}$ 和慢度 $S_{i} = F_{i} / B_{i}$：\n- $J_2$: $F_{2} = 21 - 1 = 20$。$S_{2} = \\frac{20}{1} = 20$。\n- $J_3$: $F_{3} = 23 - 2 = 21$。$S_{3} = \\frac{21}{2} = 10.5$。\n- $J_4$: $F_{4} = 24 - 3 = 21$。$S_{4} = \\frac{21}{1} = 21$。\n- $J_6$: $F_{6} = 28 - 10 = 18$。$S_{6} = \\frac{18}{1} = 18$。\n- $J_8$: $F_{8} = 33 - 11 = 22$。$S_{8} = \\frac{22}{1} = 22$。\n\nFCFS 下短作业的平均慢度 $\\overline{S}_{\\text{short}}^{\\text{FCFS}}$ 为：\n$$\n\\overline{S}_{\\text{short}}^{\\text{FCFS}} = \\frac{S_{2} + S_{3} + S_{4} + S_{6} + S_{8}}{5} = \\frac{20 + 10.5 + 21 + 18 + 22}{5} = \\frac{91.5}{5} = 18.3\n$$\n\n接下来，我们分析 SRPT 调度策略。SRPT 是抢占式的，并且总是运行剩余处理时间最短的作业。\n- $t=0$：$J_{1}$ ($A_{1}=0, B_{1}=20$) 到达并开始。剩余时间 $B'_{1}=20$。\n- $t=1$：$J_{2}$ ($A_{2}=1, B_{2}=1$) 到达。$J_{1}$ 已运行 $1$ 个单位，所以 $B'_{1}=19$。由于 $B'_{2}=1  B'_{1}=19$，$J_{2}$ 抢占 $J_{1}$ 并开始。\n- $t=2$：$J_{3}$ ($A_{3}=2, B_{3}=2$) 在 $J_{2}$ 完成时到达。$C_{2}=2$。就绪队列中的作业是 $J_{1}$ ($B'_{1}=19$) 和 $J_{3}$ ($B'_{3}=2$)。由于 $B'_{3}  B'_{1}$，$J_{3}$ 开始。\n- $t=3$：$J_{4}$ ($A_{4}=3, B_{4}=1$) 到达。$J_{3}$ 已运行 $1$ 个单位，所以 $B'_{3}=1$。队列中的作业是 $J_{1}$ ($B'_{1}=19$)、$J_{3}$ ($B'_{3}=1$, 正在运行) 和 $J_{4}$ ($B'_{4}=1$)。由于 $B'_{4}$ 不严格小于正在运行的作业的剩余时间 $B'_{3}$，平局打破规则有利于当前作业，因此 $J_{3}$ 继续。\n- $t=4$：$J_{5}$ ($A_{5}=4, B_{5}=3$) 在 $J_{3}$ 完成时到达。$C_{3}=4$。就绪队列：$J_{1}$ ($B'_{1}=19$)、$J_{4}$ ($B'_{4}=1$)、$J_{5}$ ($B'_{5}=3$) 。$J_{4}$ 因其剩余时间最短而开始。\n- $t=5$：$J_{4}$ 完成。$C_{4}=5$。就绪队列：$J_{1}$ ($B'_{1}=19$)、$J_{5}$ ($B'_{5}=3$) 。$J_{5}$ 开始。\n- $t=8$：$J_{5}$ 完成。$C_{5}=8$。系统中只有 $J_{1}$。$J_{1}$ 恢复执行。\n- $t=10$：$J_{6}$ ($A_{6}=10, B_{6}=1$) 到达。$J_{1}$ 已运行 $2$ 个单位（从 $t=8$ 到 $t=10$），所以其剩余时间为 $B'_{1}=19-2=17$。由于 $B'_{6}=1  B'_{1}=17$，$J_{6}$ 抢占 $J_{1}$。\n- $t=10.5$：$J_{7}$ ($A_{7}=10.5, B_{7}=4$) 到达。$J_{6}$ 已运行 $0.5$ 个单位，$B'_{6}=0.5$。$J_{6}$ 继续运行，因为 $B'_{6}=0.5$ 是最小的。\n- $t=11$：$J_{8}$ ($A_{8}=11, B_{8}=1$) 在 $J_{6}$ 完成时到达。$C_{6}=11$。就绪队列：$J_{1}$ ($B'_{1}=17$)、$J_{7}$ ($B'_{7}=4$)、$J_{8}$ ($B'_{8}=1$) 。$J_{8}$ 开始。\n- $t=12$：$J_{8}$ 完成。$C_{8}=12$。就绪队列：$J_{1}$ ($B'_{1}=17$)、$J_{7}$ ($B'_{7}=4$) 。$J_{7}$ 开始。\n- $t=16$：$J_{7}$ 完成。$C_{7}=16$。$J_{1}$ 恢复执行。\n- $t=33$：$J_{1}$ 运行其剩余的 $17$ 个单位并完成。$C_{1}=33$。\n\n现在我们为 SRPT 下的短作业计算周转时间和慢度：\n- $J_2$: $F_{2} = C_{2} - A_{2} = 2 - 1 = 1$。$S_{2} = \\frac{1}{1} = 1$。\n- $J_3$: $F_{3} = C_{3} - A_{3} = 4 - 2 = 2$。$S_{3} = \\frac{2}{2} = 1$。\n- $J_4$: $F_{4} = C_{4} - A_{4} = 5 - 3 = 2$。$S_{4} = \\frac{2}{1} = 2$。\n- $J_6$: $F_{6} = C_{6} - A_{6} = 11 - 10 = 1$。$S_{6} = \\frac{1}{1} = 1$。\n- $J_8$: $F_{8} = C_{8} - A_{8} = 12 - 11 = 1$。$S_{8} = \\frac{1}{1} = 1$。\n\nSRPT 下短作业的平均慢度 $\\overline{S}_{\\text{short}}^{\\text{SRPT}}$ 为：\n$$\n\\overline{S}_{\\text{short}}^{\\text{SRPT}} = \\frac{S_{2} + S_{3} + S_{4} + S_{6} + S_{8}}{5} = \\frac{1 + 1 + 2 + 1 + 1}{5} = \\frac{6}{5} = 1.2\n$$\n\n最后，我们计算短作业慢度因子 $\\Phi$：\n$$\n\\Phi = \\frac{\\overline{S}_{\\text{short}}^{\\text{FCFS}}}{\\overline{S}_{\\text{short}}^{\\text{SRPT}}} = \\frac{18.3}{1.2} = 15.25\n$$\n四舍五入到四位有效数字，其值为 $15.25$。\n\n这个结果为护航效应提供了一个鲜明、定量的度量。$\\Phi=15.25$ 这个值表明，对于此工作负载，与 SRPT 调度器相比，FCFS 调度器使短作业的平均慢度恶化了超过 $15$ 倍。这是因为长时间运行的作业 $J_{1}$ ($B_1=20$) 首先到达，并且在非抢占式的 FCFS 策略下，它独占了处理器。这迫使所有后续到达的短作业（$J_{2}, J_{3}, J_{4}$）在其后形成“护航队列”等待，导致相对于其微小的服务需求而言极长的周转时间，从而产生非常高的慢度。相比之下，抢占式的 SRPT 策略通过抢占长作业，允许短作业在到达后几乎立即运行。这最大限度地减少了它们的等待时间，并使其慢度接近理想值 $1$，代价是延迟了长作业。$\\Phi$ 的巨大数值表明，像 FCFS 这样对作业大小不敏感的策略可能对短作业的性能极为不利，这一现象是护航效应的核心。", "answer": "$$\n\\boxed{15.25}\n$$", "id": "3643765"}, {"introduction": "除了影响平均性能指标，护航效应还会极大地改变作业等待时间的整体分布。这个思想实验要求你预测当一个长作业中断了一系列短作业流时，等待时间直方图的形态。这项练习旨在培养你对系统动态的直观理解，帮助你形象地看到一个长任务如何造成“双峰”现象：少数作业立即得到服务，而大多数作业则被迫排在长长的队列中 [@problem_id:3643806]。", "problem": "考虑一个单核中央处理器 (CPU)，它运行一个非抢占式的先到先服务 (FCFS) 调度程序。一个教学演示程序可视化了作业到达和执行的时间线，并显示了作业等待时间的直方图。在这个演示中，从时间 $t=0$ 开始，相同的“短”作业以 $\\Delta t = 1$ 时间单位的严格周期到达，每个短作业需要 $s = 0.1$ 个时间单位的 CPU 执行期。在时间 $t=1^{-}$，一个 CPU 执行期为 $L = 10$ 个时间单位的“长”作业被注入；它在原本应于 $t=1$ 到达的短作业之前的无穷小的时间点到达，因此当 CPU 下一次变为空闲时，它会首先到达 FCFS 队列的头部。如果两个作业在完全相同的时间到达，则具有更早无穷小到达时刻的作业在 FCFS 顺序中被认为更早。假设没有上下文切换开销，并且系统最初在其他方面是空闲的。\n\n作业的等待时间定义为从其到达直到其 CPU 服务开始所经过的时间（即，等待时间不包括服务时间）。\n\n请关注在区间 $[0,20]$ 内到达的短作业的等待时间。在不绘制完整时间线的情况下，仅根据非抢占式 FCFS 调度和等待时间的核心定义进行推理，当使用合理的箱宽对这些短作业的等待时间进行分箱时，以下哪项最能描述所得等待时间直方图的定性形状？\n\nA. 在 $0$ 附近有一个单一的窄峰，在较大的等待时间处几乎没有作业分布。\n\nB. 双峰形状：一个在 $0$ 附近的强峰，加上一个由长作业执行期间到达的作业所产生的大等待时间组成的宽簇，形成一个重右尾。\n\nC. 在从 $0$ 到大约 $L$ 的等待时间内近似均匀分布。\n\nD. 一个以 $L/2$ 附近为中心的单峰，因为长作业平均了周围作业的等待时间。\n\nE. 从 $0$ 开始的指数衰减，如同在无记忆的单服务器队列中一样。", "solution": "用户希望我分析一个调度问题，并确定等待时间分布的形状。\n\n### 步骤 1：提取给定条件\n- **调度程序：** 非抢占式先到先服务 (FCFS)。\n- **CPU：** 单核。\n- **短作业：**\n    - 到达：一个周期性的作业序列，我们称之为 $S_k$，其中作业 $S_k$ 在时间 $t_k = k$ 到达。到达从 $t=0$ 开始。到达间隔时间为 $\\Delta t = 1$ 个时间单位。\n    - CPU 执行期：$s = 0.1$ 个时间单位。\n- **长作业：**\n    - 标签：$L_{job}$。\n    - 到达：时间 $t=1^{-}$，意味着在 $t=1$ 之前的无穷小时间点。\n    - CPU 执行期：$L = 10$ 个时间单位。\n- **平局打破规则：** 在 $t=1^{-}$ 的到达先于在 $t=1$ 的到达。\n- **开销：** 无上下文切换开销。\n- **初始状态：** 系统在 $t=0$ 之前是空闲的。\n- **等待时间定义：** 从作业到达直到其 CPU 服务开始所经过的时间。\n- **分析范围：** 在区间 $[0, 20]$ 内到达的短作业的等待时间。这对应于作业 $S_0, S_1, \\dots, S_{20}$。\n\n### 步骤 2：使用提取的给定条件进行验证\n问题陈述描述了一个经典的、确定性的排队场景，在计算机科学中用来说明 FCFS 调度中的“护航效应”。\n- **科学依据：** FCFS 调度、CPU 执行期、等待时间和护航效应的概念是操作系统中的基本主题。该模型是一个标准的 D/D/1 队列（确定性到达、确定性服务时间、单个服务器），带有一个一次性的扰动。所有原理都是合理的。\n- **适定性：** 所有参数（到达时间、服务时间、调度策略）都已明确定义。平局打破规则是清晰的。可以确定一个唯一的事件序列，从而得到一组唯一的等待时间。\n- **目标：** 问题使用精确、定量和明确的语言陈述。\n- **完整性和一致性：** 信息是充分且自洽的。长作业在 $t=1^{-}$ 到达，这明确地将其置于在 $t=1$ 到达的短作业之前，排在 FCFS 队列的前面。\n- **可行性：** 该场景是一个概念模型，但对于一个简化模型来说，数值是物理上可行的。\n- **其他缺陷：** 该问题不是琐碎的、隐喻性的或不适定的。它需要逐步应用调度原理。\n\n### 步骤 3：结论和行动\n问题陈述是**有效的**。我将继续推导解决方案。\n\n### 等待时间的推导\n\n设 $A_k$、$Start_k$ 和 $W_k$ 分别为短作业 $S_k$ 的到达时间、服务开始时间和等待时间。我们考虑的短作业是 $k \\in \\{0, 1, 2, \\dots, 20\\}$ 的 $S_k$。\n\n1.  **作业 $S_0$ (在 $t=0$ 到达)：**\n    - 到达时间 $A_0 = 0$。\n    - CPU 空闲，因此服务立即开始：$Start_0 = 0$。\n    - 等待时间：$W_0 = Start_0 - A_0 = 0 - 0 = 0$。\n    - 该作业在 $t = Start_0 + s = 0 + 0.1 = 0.1$ 完成。CPU 从 $t=0.1$ 开始空闲，直到下一个作业开始。\n\n2.  **长作业 $L_{job}$ 和作业 $S_1$：**\n    - 长作业 $L_{job}$ 在 $A_{L_{job}} = 1^{-}$ 到达。短作业 $S_1$ 在 $A_1 = 1$ 到达。\n    - 在时间 $t=1$，CPU 自 $t=0.1$ 以来一直空闲。FCFS 队列中包含 $L_{job}$，其后是 $S_1$。\n    - 调度程序分派 $L_{job}$。其服务在 $Start_{L_{job}} = 1$ 开始。\n    - $L_{job}$ 运行 $L=10$ 个时间单位，在 $F_{L_{job}} = 1 + 10 = 11$ 完成。\n    - 由于调度程序是非抢占式的，CPU 从 $t=1$ 到 $t=11$ 持续被占用。\n\n3.  **在‘护航’期间到达的作业 ($k \\in [1, 10]$)：**\n    - 短作业 $S_1, S_2, \\dots, S_{10}$ 在时间 $t=1, 2, \\dots, 10$ 到达。所有这些作业都在 $L_{job}$ 占用 CPU 期间到达。它们按 FCFS 顺序排队。\n    - 在 $t=11$ 时，$L_{job}$ 完成。就绪队列包含 $[S_1, S_2, \\dots, S_{10}]$。同时，作业 $S_{11}$ 恰好在 $t=11$ 到达，并被添加到队列末尾。队列变为 $[S_1, S_2, \\dots, S_{10}, S_{11}]$。\n    - 调度程序分派 $S_1$。\n    - 对于 $S_1$：$A_1 = 1$。$Start_1 = 11$。$W_1 = 11 - 1 = 10$。$S_1$ 在 $F_1 = 11 + 0.1 = 11.1$ 完成。\n    - 对于 $S_2$：$A_2 = 2$。$Start_2 = F_1 = 11.1$。$W_2 = 11.1 - 2 = 9.1$。$S_2$ 在 $F_2 = 11.1 + 0.1 = 11.2$ 完成。\n    - 总的来说，对于短作业 $S_k$（其中 $k \\in [1,11]$），它必须等待 $L_{job}$ 和前面的 $k-1$ 个短作业完成。其开始时间为 $Start_k = F_{L_{job}} + (k-1)s = 11 + (k-1) \\times 0.1$。\n    - $S_k$ 的等待时间是 $W_k = Start_k - A_k = (11 + (k-1)s) - k$。\n    - 我们来计算护航队列中直到 $S_{11}$ 的作业：\n        - $W_1 = (11 + 0 \\times 0.1) - 1 = 10$。\n        - $W_2 = (11 + 1 \\times 0.1) - 2 = 9.1$。\n        - $W_3 = (11 + 2 \\times 0.1) - 3 = 8.2$。\n        - ...\n        - $W_{10} = (11 + 9 \\times 0.1) - 10 = 11.9 - 10 = 1.9$。完成时间是 $F_{10} = 11.9 + 0.1 = 12.0$。\n        - $W_{11} = (11 + 10 \\times 0.1) - 11 = 12.0 - 11 = 1.0$。完成时间是 $F_{11} = 12.0 + 0.1 = 12.1$。\n\n4.  **在队列清空期间到达的作业 ($k \\ge 12$):**\n    - 对于 $S_{12}$：$A_{12} = 12$。前一个作业 $S_{11}$ 在 $F_{11}=12.1$ 完成。所以，$S_{12}$ 必须等待。\n    - $Start_{12} = F_{11} = 12.1$。\n    - $W_{12} = 12.1 - 12 = 0.1$。\n    - $S_{12}$ 在 $F_{12} = 12.1 + 0.1 = 12.2$ 完成。\n    - 对于 $S_{13}$：$A_{13} = 13$。CPU 自 $F_{12}=12.2$ 以来一直空闲。因此，$S_{13}$ 可以立即开始。\n    - $Start_{13} = 13$。\n    - $W_{13} = 13 - 13 = 0$。\n    - $S_{13}$ 在 $F_{13} = 13 + 0.1 = 13.1$ 完成。\n\n5.  **护航效应后的作业 ($k \\ge 13$):**\n    - 对于任何 $k \\ge 13$ 的作业 $S_k$，前一个作业 $S_{k-1}$ 在 $t=k-1$ 到达，并在 $F_{k-1} = (k-1) + 0.1 = k - 0.9$ 完成。\n    - 由于 $F_{k-1}  k = A_k$，当 $S_k$ 到达时 CPU 总是空闲的。\n    - 因此，对于所有 $k \\in [13, 20]$，等待时间为 $W_k = 0$。\n\n### 总结与直方图形状\n我们收集所有 $21$ 个短作业（$S_0$ 到 $S_{20}$）的等待时间：\n- $W_0 = 0$。\n- $W_1 = 10.0$。\n- $W_2 = 9.1$。\n- $W_3 = 8.2$。\n- $W_4 = 7.3$。\n- $W_5 = 6.4$。\n- $W_6 = 5.5$。\n- $W_7 = 4.6$。\n- $W_8 = 3.7$。\n- $W_9 = 2.8$。\n- $W_{10} = 1.9$。\n- $W_{11} = 1.0$。\n- $W_{12} = 0.1$。\n- $W_{13}, W_{14}, \\dots, W_{20}$ 均为 $0$。这是 $8$ 个作业。\n\n$W \\approx 0$ 的总作业数：\n- $W=0$：$S_0$ 和 $S_{13}$ 到 $S_{20}$（$1+8=9$ 个作业）。\n- $W=0.1$：$S_{12}$（$1$ 个作业）。\n总共 $21$ 个作业中有 $10$ 个（近一半）的等待时间非常接近于零。这将在直方图的原点处形成一个非常强的窄峰。\n\n具有长等待时间的总作业数：\n- 剩下的 $11$ 个作业（$S_1$ 到 $S_{11}$）的等待时间范围从 $1.0$ 到 $10.0$。这些值广泛分布在这个范围内：$\\{10.0, 9.1, 8.2, \\dots, 1.9, 1.0\\}$。\n这将在直方图中形成一个长的、相对平坦的右尾，代表一个由大等待时间组成的宽簇。\n\n总体形状的特征是在零处有一个主导峰，以及一个延伸到 $W=10$ 的长重尾。从定性意义上讲，这是一个经典的‘双峰’形状，其中一个‘峰’是在零处的峰值，另一个‘峰’是受护航效应影响的作业的广泛分布。\n\n### 逐项分析\n\n**A. 在 $0$ 附近有一个单一的窄峰，在较大的等待时间处几乎没有作业分布。**\n- **不正确。** 虽然在 $0$ 附近有一个强峰（$21$ 个作业中的 $10$ 个），但在较大的等待时间处有非常显著的分布。另外 $11$ 个作业的等待时间从 $1.0$ 到 $10.0$ 不等。这比“几乎没有分布”要多得多。\n\n**B. 双峰形状：一个在 $0$ 附近的强峰，加上一个由长作业执行期间到达的作业所产生的大等待时间组成的宽簇，形成一个重右尾。**\n- **正确。** 这个描述完全符合推导出的分布。在 $W=0$ 附近有一个强峰（包含 $10$ 个作业）。有一个由大等待时间组成的宽簇（$11$ 个作业的等待时间从 $1.0$到 $10.0$）。这个簇是由于长作业阻塞了后续的短作业而直接引起的护航效应。这些大值的存在导致了一个重右尾。\n\n**C. 在从 $0$ 到大约 $L$ 的等待时间内近似均匀分布。**\n- **不正确。** 分布是高度不均匀的。在 $W=0$ 附近有非常高密度的作业集中，而在较大等待时间处的作业分布则很稀疏。均匀分布意味着在每个等待时间区间内作业数量大致相等，而这显然不是事实。\n\n**D. 一个以 $L/2$ 附近为中心的单峰，因为长作业平均了周围作业的等待时间。**\n- **不正确。** 分布不是单峰的，也不围绕 $L/2=5$ 对称。主峰位于 $W=0$。“平均掉”的概念具有误导性；等待时间是由 FCFS 规则系统地决定的，并且在护航队列内的作业呈现下降趋势，而不是围绕平均值的集中趋势。\n\n**E. 从 $0$ 开始的指数衰减，如同在无记忆的单服务器队列中一样。**\n- **不正确。** 等待时间的指数分布是随机 M/M/1 队列（泊松到达，指数服务时间）的特征。本问题描述的是一个确定性的 D/D/1 系统。计算出的等待时间不遵循指数衰减；它们遵循一个特定的、确定性的模式，在零点有大量分布，并带有一个线性递减的值序列。", "answer": "$$\\boxed{B}$$", "id": "3643806"}, {"introduction": "在理解了护航效应之后，我们自然会问：如何避免它？这个问题将带你探索多级反馈队列（MLFQ）——一种现代操作系统中常用的复杂调度程序，并将其与简单的FCFS进行对比。通过分析MLFQ中那些旨在优待短交互式任务的具体规则，以及当这些规则被错误配置时会发生什么，你将对实用调度程序的设计原则以及在实现响应性和公平性之间所做的权衡有更深入的认识 [@problem_id:3643822]。", "problem": "一个单处理器系统运行一个混合工作负载，其中包含一个长时间运行的计算任务和几个短时间的交互式任务。所有任务在时间 $0$ 到达。上下文切换开销为 $0$。每个任务在中央处理器（CPU）突发和单个磁盘的输入/输出（I/O）之间交替进行；一次只能处理一个 I/O，任何额外的 I/O 请求都在磁盘处排队。考虑以下工作负载和调度器。\n\n工作负载：\n- $J_C$（计算密集型）：一次 $60\\,\\text{ms}$ 的 CPU 突发，然后终止。\n- $J_1$、$J_2$、$J_3$（交互式）：每个任务重复以下循环三次，然后终止：一次 $1\\,\\text{ms}$ 的 CPU 突发，后跟一次 $9\\,\\text{ms}$ 的磁盘 I/O。\n\n决胜和排队规则：\n- 当多个任务同时到达时，时间 $0$ 的就绪队列顺序为 $J_C$，然后是 $J_1$、 $J_2$、 $J_3$。\n- 磁盘以先到先服务（First-Come, First-Served）的顺序对 I/O 请求进行排队。\n\n调度器：\n- 调度器 S-FCFS：先到先服务（FCFS），在 CPU 上非抢占式。\n- 调度器 S-MLFQ：多级反馈队列（MLFQ），具有三个优先级。顶层的时间量为 $2\\,\\text{ms}$，中间层的时间量为 $8\\,\\text{ms}$，底层为非抢占式（等效于时间量为 $\\infty$）。调度程序总是运行最高优先级的就绪任务，并在更高优先级的任务就绪时抢占较低优先级的任务。在当前级别用完整个时间片的任务将被降级一级。在时间片结束前因 I/O 而阻塞的任务不会被降级。I/O 完成后，任务被提升到顶层。每隔 $50\\,\\text{ms}$，一次周期性的提升会将所有就绪任务提升到顶层。\n\n仅使用核心定义（FCFS 的含义；上述 MLFQ 规则的含义；响应时间定义为从到达至首次运行的时间；利用率定义为繁忙时间除以经过的总时间）并根据对产生的执行时间线的一致推理，回答以下问题。选择所有正确的选项。\n\nA) 在 S-FCFS 下，$J_1$、$J_2$ 和 $J_3$ 的平均首次响应时间为 $61\\,\\text{ms}$，这说明了由 $J_C$ 引起的护航效应（convoy effect）。\n\nB) 在所指定的 S-MLFQ 下，区间 $[0,20]\\,\\text{ms}$ 内的磁盘利用率严格高于 S-FCFS 下的利用率，因为交互式任务迅速获得 CPU 时间以启动 I/O，从而使 CPU 和 I/O 活动重叠。\n\nC) 如果移除“I/O 完成后，提升到顶层”这条规则，但所有其他 S-MLFQ 规则保持不变，那么在此工作负载下，护航效应会重新出现，因为交互式任务仍会沉降到 $J_C$ 之下。\n\nD) 如果在 S-MLFQ 中将顶层的时间量从 $2\\,\\text{ms}$ 增加到 $20\\,\\text{ms}$，同时保持所有其他规则不变，可能会出现类似护航效应的延迟，因为 $J_C$ 可以在顶层长时间运行，之后交互式任务才能启动它们的 I/O。\n\nE) 如果 S-MLFQ 配置错误，使得一个在时间片结束前因 I/O 而阻塞的任务被降级（而不是保留级别），并且禁用了“I/O 完成后，提升到顶层”的规则，那么经过几个 CPU-I/O 周期后，交互式任务将位于 $J_C$ 之下，并经历对 CPU 的长时间等待，从而重现护航效应。", "solution": "首先验证问题陈述，以确保其科学上合理、定义明确且客观。\n\n**步骤 1：提取已知条件**\n\n*   **系统**：单处理器，上下文切换开销为 $0$。\n*   **任务**：所有任务在时间 $t=0$ 到达。\n    *   $J_C$：一次 CPU 突发 $60\\,\\text{ms}$，然后终止。\n    *   $J_1, J_2, J_3$：每个任务重复循环（CPU 突发 $1\\,\\text{ms}$，磁盘 I/O $9\\,\\text{ms}$）三次，然后终止。\n*   **I/O**：单个磁盘，FCFS 排队。\n*   **初始就绪队列顺序**：$J_C, J_1, J_2, J_3$。\n*   **调度器 S-FCFS**：非抢占式先到先服务。\n*   **调度器 S-MLFQ**：\n    *   优先级：$3$ 个级别。\n    *   时间量：顶层 $Q_1 = 2\\,\\text{ms}$，中间层 $Q_2 = 8\\,\\text{ms}$，底层为 FCFS ($Q_3 = \\infty$)。\n    *   调度：运行最高优先级的就绪任务。抢占较低优先级的任务。\n    *   降级：用完其完整时间量的任务被降级一级。\n    *   I/O 行为：因 I/O 而阻塞的任务*不*被降级。I/O 完成后，任务被提升到顶层。\n    *   提升：每隔 $50\\,\\text{ms}$，所有就绪任务被提升到顶层。\n*   **定义**：\n    *   响应时间：从到达至首次执行的时间。\n    *   利用率：繁忙时间 / 经过的总时间。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n*   **科学基础**：该问题是操作系统中的一个标准练习，涉及 CPU 调度（FCFS、MLFQ）、任务类型（计算密集型 vs. I/O 密集型）和性能现象（护航效应）等基本概念。模型被简化了（例如，上下文切换成本为 $0$），但它们是标准的教学工具。\n*   **定义明确**：问题定义清晰。所有任务参数、调度器规则、初始条件和决胜程序都已明确说明。这允许对系统的执行时间线进行确定性模拟。\n*   **客观性**：问题使用精确、量化和明确的语言陈述。调度器的规则是形式化的，可以直接应用。\n\n**步骤 3：结论与行动**\n\n问题陈述有效。这是一个在操作系统调度领域中格式良好的问题。解决方案将通过在指定的调度器下详细模拟所提供的工作负载来分析每个选项。\n\n**选项 A 分析**\n\n此选项涉及 S-FCFS 调度器。\n*   **调度器**：先到先服务，非抢占式。\n*   **$t=0$ 时的初始就绪队列**：$J_C, J_1, J_2, J_3$。\n*   **执行时间线**：\n    1.  在 $t=0$ 时，从就绪队列头部选择 $J_C$。它以非抢占方式运行。其突发时间为 $60\\,\\text{ms}$。\n    2.  $J_C$ 从 $t=0$ 运行到 $t=60\\,\\text{ms}$。在此期间，$J_1, J_2,$ 和 $J_3$ 在就绪队列中等待。\n    3.  在 $t=60\\,\\text{ms}$ 时，$J_C$ 终止。队列中的下一个任务 $J_1$ 开始执行。\n    4.  在 $t=61\\,\\text{ms}$ 时，$J_1$ 完成其 $1\\,\\text{ms}$ 的 CPU 突发并因 I/O 而阻塞。下一个任务 $J_2$ 开始执行。\n    5.  在 $t=62\\,\\text{ms}$ 时，$J_2$ 完成其 $1\\,\\text{ms}$ 的 CPU 突发并因 I/O 而阻塞。下一个任务 $J_3$ 开始执行。\n*   **响应时间计算**：响应时间是任务首次开始运行的时间减去其到达时间（所有任务均为 $t=0$）。\n    *   响应时间($J_1$) = $60\\,\\text{ms} - 0\\,\\text{ms} = 60\\,\\text{ms}$。\n    *   响应时间($J_2$) = $61\\,\\text{ms} - 0\\,\\text{ms} = 61\\,\\text{ms}$。\n    *   响应时间($J_3$) = $62\\,\\text{ms} - 0\\,\\text{ms} = 62\\,\\text{ms}$。\n*   **平均响应时间**：交互式任务的平均首次响应时间为 $\\frac{60\\,\\text{ms} + 61\\,\\text{ms} + 62\\,\\text{ms}}{3} = \\frac{183\\,\\text{ms}}{3} = 61\\,\\text{ms}$。\n*   **护航效应**：短作业因被困在长作业之后而导致的高平均响应时间，正是护航效应的定义。\n*   **结论**：计算出的平均响应时间为 $61\\,\\text{ms}$，并且原因被正确地确定为护航效应。因此，该陈述是**正确的**。\n\n**选项 B 分析**\n\n此选项比较 S-FCFS 和 S-MLFQ 在区间 $[0, 20]\\,\\text{ms}$ 内的磁盘利用率。\n*   **S-FCFS 在 $[0, 20]\\,\\text{ms}$ 内的利用率**：\n    *   如在 A 中所确定的，$J_C$ 在前 $60\\,\\text{ms}$ 内运行。在前 $20\\,\\text{ms}$ 内没有其他任务运行，也没有启动 I/O。\n    *   磁盘在整个区间内均为空闲。磁盘繁忙时间为 $0\\,\\text{ms}$。\n    *   磁盘利用率 = $\\frac{0\\,\\text{ms}}{20\\,\\text{ms}} = 0$。\n*   **S-MLFQ 在 $[0, 20]\\,\\text{ms}$ 内的利用率**：\n    *   初始状态（$t=0$）：所有任务到达并被放入顶层（L1）队列：$J_C, J_1, J_2, J_3$。L1 的时间量 $Q_1=2\\,\\text{ms}$。\n    *   $t \\in [0, 2)\\,\\text{ms}$：$J_C$ 运行。在 $t=2\\,\\text{ms}$ 时，它用完了其完整的时间量并被降级到 L2。\n    *   $t \\in [2, 3)\\,\\text{ms}$：$J_1$ 运行（来自 L1）。在 $t=3\\,\\text{ms}$ 时，它完成了其 $1\\,\\text{ms}$ 的突发并因 I/O 而阻塞。它不被降级。磁盘开始处理 $J_1$ 的 $9\\,\\text{ms}$ I/O 请求。\n    *   $t \\in [3, 4)\\,\\text{ms}$：$J_2$ 运行（来自 L1）。在 $t=4\\,\\text{ms}$ 时，它因 I/O 而阻塞。\n    *   $t \\in [4, 5)\\,\\text{ms}$：$J_3$ 运行（来自 L1）。在 $t=5\\,\\text{ms}$ 时，它因 I/O 而阻塞。\n    *   $t \\in [5, 12)\\,\\text{ms}$：L1 队列为空。$J_C$ 从 L2 运行。\n    *   **磁盘活动**：磁盘队列是 FCFS。$J_1$ 在 $t=3\\,\\text{ms}$ 请求 I/O，$J_2$ 在 $t=4\\,\\text{ms}$ 请求 I/O，$J_3$ 在 $t=5\\,\\text{ms}$ 请求 I/O。\n        *   磁盘从 $t=3\\,\\text{ms}$ 到 $t=12\\,\\text{ms}$ 为 $J_1$ 服务。\n        *   磁盘从 $t=12\\,\\text{ms}$ 到 $t=21\\,\\text{ms}$ 为 $J_2$ 服务。\n    *   **在 $[0, 20]\\,\\text{ms}$ 内的磁盘繁忙时间**：磁盘从 $t=3\\,\\text{ms}$ 开始持续繁忙直到 $t=20\\,\\text{ms}$（及以后）。\n    *   繁忙时间 = $20\\,\\text{ms} - 3\\,\\text{ms} = 17\\,\\text{ms}$。\n    *   磁盘利用率 = $\\frac{17\\,\\text{ms}}{20\\,\\text{ms}} = 0.85$。\n*   **比较**：S-MLFQ 下的磁盘利用率（$0.85$）严格高于 S-FCFS 下的利用率（$0$）。给出的原因，即交互式任务迅速获得 CPU 时间以启动 I/O，从而允许重叠，与模拟结果完全一致。\n*   **结论**：该陈述是**正确的**。\n\n**选项 C 分析**\n\n此选项涉及一个修改后的 S-MLFQ，其中任务在 I/O 完成后不再被提升到顶层。\n*   **修改后的规则**：I/O 完成后不提升。“因 I/O 而阻塞的任务……不被降级”的规则仍然有效。\n*   **执行时间线**：\n    *   $t \\in [0, 2)\\,\\text{ms}$：$J_C$ 运行（L1），被降级到 L2。\n    *   $t \\in [2, 5)\\,\\text{ms}$：$J_1, J_2, J_3$ 各自从 L1 运行 $1\\,\\text{ms}$ 并因 I/O 而阻塞。由于它们没有用完其完整的时间量，它们*不*被降级。它们保留其 L1 状态。\n    *   在 $t=12\\,\\text{ms}$ 时，$J_1$ 的 I/O 完成。它变为就绪状态。由于它没有被降级，它进入 L1 就绪队列。\n    *   调度程序看到 L1 有一个就绪任务，而当前任务（$J_C$）在 L2。$J_C$ 被抢占，$J_1$ 运行。\n*   **分析**：长时间运行的作业 $J_C$ 被降级到较低优先级的队列。交互式作业 $J_1, J_2, J_3$ 的 CPU 突发（$1\\,\\text{ms}$）短于顶层时间量（$2\\,\\text{ms}$），所以它们从未使用完完整的时间片，也从未被降级。它们始终保持在最高优先级。它们将总是抢占 $J_C$。因此，交互式任务永远不会沉降到 $J_C$ 之下。护航效应被避免了，而不是被创造出来。\n*   **结论**：该陈述的前提（“交互式任务仍会沉降到 $J_C$ 之下”）是错误的，因此其结论也是错误的。该陈述是**不正确的**。\n\n**选项 D 分析**\n\n此选项涉及一个修改后的 S-MLFQ，其中顶层的时间量增加到 $20\\,\\text{ms}$。\n*   **修改后的规则**：$Q_1 = 20\\,\\text{ms}$。\n*   **执行时间线**：\n    *   在 $t=0$ 时，L1 就绪队列是 $J_C, J_1, J_2, J_3$。\n    *   根据决胜规则，$J_C$ 首先运行。它的 CPU 突发是 $60\\,\\text{ms}$，而 L1 的时间量现在是 $20\\,\\text{ms}$。\n    *   $J_C$ 将从 $t=0$ 到 $t=20\\,\\text{ms}$ 运行其完整的时间量。\n    *   在此区间内，短的交互式任务 $J_1, J_2, J_3$ 处于就绪状态，但必须等待 CPU。\n*   **分析**：强迫短作业在长作业运行时等待 $20\\,\\text{ms}$ 是一个显著的延迟，这是护航效应的特征。最高优先级使用短时间量的目的正是为了通过快速识别和服务短突发任务来防止这种情况。将时间量增加到远长于交互式突发的时间，违背了这一目标。\n*   **结论**：所描述的场景正确地指出，一个长的顶层时间量可以重新引入类似护航效应的延迟。该陈述是**正确的**。\n\n**选项 E 分析**\n\n此选项涉及一个配置错误的 S-MLFQ，它有两个变化：因 I/O 而阻塞的任务被降级，并且它们在 I/O 完成后不被提升。\n*   **修改后的规则**：\n    1.  因 I/O 阻塞而降级。\n    2.  I/O 完成后不提升。\n*   **执行时间线与状态分析**：\n    *   $t \\in [0, 2)\\,\\text{ms}$：$J_C$ 运行其完整的 $2\\,\\text{ms}$ L1 时间量，被降级到 L2。\n    *   $t \\in [2, 3)\\,\\text{ms}$：$J_1$ 运行 $1\\,\\text{ms}$（L1）并因 I/O 而阻塞。根据新规则，它被降级到 L2。\n    *   $t \\in [3, 4)\\,\\text{ms}$：$J_2$ 运行（L1），阻塞，降级到 L2。\n    *   $t \\in [4, 5)\\,\\text{ms}$：$J_3$ 运行（L1），阻塞，降级到 L2。\n    *   此时，所有任务实际上都已成为 L2 任务。L1 队列为空。\n    *   $J_C$ 从 L2 运行（从 $t=5\\,\\text{ms}$ 开始），直到在 $t=13\\,\\text{ms}$ 时用完其 $8\\,\\text{ms}$ 的时间量，此时它被降级到 L3。\n    *   交互式作业在完成其 I/O 后，将返回到它们被降级到的级别（L2）的就绪队列。\n    *   例如，$J_1$ 在 $t=12\\,\\text{ms}$ 完成 I/O 并变为 L2 的就绪状态。它必须等待已经在 L2 运行的 $J_C$。\n    *   在 L2 运行后，交互式作业也将因 I/O 而阻塞，并被降级到 L3。\n    *   最终，所有任务都将沉降到底层的 FCFS 队列（L3）。第一个被降级到 L3 就绪队列的任务是 $J_C$（在 $t=13\\,\\text{ms}$）。随着交互式作业完成它们的第二个周期并也被降级到 L3，它们将被放置在 $J_C$ 后面的 FCFS 队列中。\n    *   在周期性提升的间隔之间，系统对于所有任务的行为将像一个 FCFS 调度器。长的 $J_C$ 任务将运行，而短的作业 $J_1, J_2, J_3$ 将在其后排队，经历长时间的等待。这是护航效应的重现。在 $t=50\\,\\text{ms}$ 时的周期性提升会暂时解决护航问题，但随着所有任务再次沉降到底层队列，它会重新形成。\n*   **结论**：所描述的错误配置导致 I/O 密集型作业失去优先级并被困在最低优先级 FCFS 队列中的计算密集型作业之后，这准确地描述了护航效应的重现。该陈述是**正确的**。", "answer": "$$\\boxed{ABDE}$$", "id": "3643822"}]}