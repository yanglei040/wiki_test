{"hands_on_practices": [{"introduction": "在多任务环境中，像内存带宽这样的共享资源必须被精心分配。本练习将演示一种常见的策略，即操作系统在分配资源时，既要满足用户定义的重要性（外部优先级），又要考虑程序的实际需求（内部需求）。你需要通过寻找一个平衡点来计算最终的带宽分配，这个平衡点在全局预算下同时尊重了两种约束。这项练习将提升你将策略规则转化为数学模型并求解系统均衡点的能力。[@problem_id:3649910]", "problem": "一个多道程序操作系统（OS）通过多路复用一个具有有限峰值吞吐量的共享内存总线来服务于多个并发工作负载。管理员以表示相对重要性的非负权重的形式提供外部优先级，同时操作系统也通过从硬件性能计数器计算出的需求估计来观察内部优先级。考虑以下在全局峰值内存带宽预算下实施内存带宽限制的策略：给定外部权重和内部需求估计，操作系统为每个工作负载分配一个与其外部权重成正比但不超过其内部需求的带宽上限。具体来说，对于工作负载索引 $i \\in \\{1,2,3,4\\}$，上限为 $C_i(\\alpha) = \\min\\{\\alpha\\,w_i, D_i\\}$，其中 $\\alpha \\ge 0$ 是一个缩放因子。操作系统选择 $\\alpha$ 以使得分配的总带宽恰好等于全局预算 $B_{\\max}$，即 $\\sum_{i=1}^{4} C_i(\\alpha) = B_{\\max}$。\n\n假设有 4 个工作负载，其外部权重分别为 $w_1 = 3$，$w_2 = 1$，$w_3 = 4$ 和 $w_4 = 2$。每个工作负载的内部需求估计 $D_i$ 是根据末级缓存（LLC）未命中计数器得出的，具体如下：如果一个工作负载每秒有 $m_i$ 次LLC未命中，并且每次LLC未命中都从主存中精确获取一个大小为 $c$ 字节的缓存行，那么该工作负载的瞬时内存带宽需求为 $D_i = m_i \\, c$ 字节/秒。设缓存行大小为 $c = 64$ 字节，并定义 1 吉字节（GB）为 $10^9$ 字节。观测到的LLC未命中率分别为 $m_1 = 150 \\times 10^6$ 次未命中/秒，$m_2 = 50 \\times 10^6$ 次未命中/秒，$m_3 = 500 \\times 10^6$ 次未命中/秒，以及 $m_4 = 200 \\times 10^6$ 次未命中/秒。全局内存带宽预算为 $B_{\\max} = 35$ GB/s。\n\n在上述策略下，确定工作负载 4 的最终带宽上限。以 GB/s 为单位表示您的答案，并将其四舍五入到四位有效数字。", "solution": "问题要求在特定资源分配策略下，确定工作负载 4 的内存带宽上限，记为 $C_4$。该策略为 $N=4$ 个工作负载定义，索引为 $i \\in \\{1, 2, 3, 4\\}$。\n\n首先，我们必须通过计算每个工作负载的内部需求估计 $D_i$ 来将问题形式化。需求由末级缓存（LLC）未命中率 $m_i$ 和缓存行大小 $c$ 的乘积给出。给定的值为：\n- 缓存行大小，$c = 64$ 字节。\n- 工作负载 1 的未命中率，$m_1 = 150 \\times 10^6$ 次未命中/秒。\n- 工作负载 2 的未命中率，$m_2 = 50 \\times 10^6$ 次未命中/秒。\n- 工作负载 3 的未命中率，$m_3 = 500 \\times 10^6$ 次未命中/秒。\n- 工作负载 4 的未命中率，$m_4 = 200 \\times 10^6$ 次未命中/秒。\n\n每个工作负载的需求 $D_i = m_i c$ 计算如下，其中将单位从字节/秒转换为吉字节/秒 (GB/s)，并且 $1 \\text{ GB} = 10^9$ 字节：\n- $D_1 = (150 \\times 10^6 \\text{ s}^{-1}) \\times (64 \\text{ bytes}) = 9600 \\times 10^6 \\text{ bytes/s} = 9.6 \\text{ GB/s}$。\n- $D_2 = (50 \\times 10^6 \\text{ s}^{-1}) \\times (64 \\text{ bytes}) = 3200 \\times 10^6 \\text{ bytes/s} = 3.2 \\text{ GB/s}$。\n- $D_3 = (500 \\times 10^6 \\text{ s}^{-1}) \\times (64 \\text{ bytes}) = 32000 \\times 10^6 \\text{ bytes/s} = 32.0 \\text{ GB/s}$。\n- $D_4 = (200 \\times 10^6 \\text{ s}^{-1}) \\times (64 \\text{ bytes}) = 12800 \\times 10^6 \\text{ bytes/s} = 12.8 \\text{ GB/s}$。\n\n每个工作负载的带宽上限 $C_i(\\alpha)$ 由公式 $C_i(\\alpha) = \\min\\{\\alpha\\,w_i, D_i\\}$ 给出，其中 $w_i$ 是外部权重，$\\alpha$ 是一个缩放因子。给定的权重为 $w_1 = 3$，$w_2 = 1$，$w_3 = 4$ 和 $w_4 = 2$。\n\n必须选择缩放因子 $\\alpha$，使得各个上限之和等于全局内存带宽预算 $B_{\\max} = 35$ GB/s。这给出了主导方程：\n$$ \\sum_{i=1}^{4} C_i(\\alpha) = B_{\\max} $$\n$$ \\min\\{\\alpha w_1, D_1\\} + \\min\\{\\alpha w_2, D_2\\} + \\min\\{\\alpha w_3, D_3\\} + \\min\\{\\alpha w_4, D_4\\} = B_{\\max} $$\n代入已知的 $w_i$、$D_i$ 和 $B_{\\max}$ 值：\n$$ \\min\\{3\\alpha, 9.6\\} + \\min\\{\\alpha, 3.2\\} + \\min\\{4\\alpha, 32.0\\} + \\min\\{2\\alpha, 12.8\\} = 35 $$\n设 $f(\\alpha)$ 为总分配带宽。函数 $f(\\alpha)$ 是连续、单调递增且分段线性的。函数线性段发生变化的点是 $\\alpha$ 的临界值，在这些值上，某个工作负载的分配变为受需求限制，即当 $\\alpha w_i = D_i$ 时。我们将这些临界值记为 $\\alpha_i^* = D_i/w_i$。\n- $\\alpha_1^* = \\frac{D_1}{w_1} = \\frac{9.6}{3} = 3.2$。\n- $\\alpha_2^* = \\frac{D_2}{w_2} = \\frac{3.2}{1} = 3.2$。\n- $\\alpha_3^* = \\frac{D_3}{w_3} = \\frac{32.0}{4} = 8.0$。\n- $\\alpha_4^* = \\frac{D_4}{w_4} = \\frac{12.8}{2} = 6.4$。\n\n我们可以通过检查由这些有序临界值（$3.2, 6.4, 8.0$）定义的区间内的总分配来求解 $\\alpha$。\n\n情况 1：$0 \\le \\alpha  3.2$。\n在此区间内，对所有 $i$ 都有 $\\alpha w_i  D_i$。因此，对所有 $i$ 都有 $C_i(\\alpha) = \\alpha w_i$。\n方程变为 $\\sum_{i=1}^{4} \\alpha w_i = B_{\\max}$，可简化为 $\\alpha \\sum_{i=1}^{4} w_i = B_{\\max}$。\n权重之和为 $\\sum w_i = 3 + 1 + 4 + 2 = 10$。\n所以，$\\alpha(10) = 35$，得到 $\\alpha = 3.5$。\n这个值 $\\alpha = 3.5$ 超出了假设的区间 $[0, 3.2)$。因此，$\\alpha$ 的解必须大于 $3.2$。这表明至少有一个工作负载是受需求限制的。让我们在边界 $\\alpha = 3.2$ 处评估总带宽：\n$f(3.2) = \\min\\{3(3.2), 9.6\\} + \\min\\{1(3.2), 3.2\\} + \\min\\{4(3.2), 32.0\\} + \\min\\{2(3.2), 12.8\\}$\n$f(3.2) = \\min\\{9.6, 9.6\\} + \\min\\{3.2, 3.2\\} + \\min\\{12.8, 32.0\\} + \\min\\{6.4, 12.8\\}$\n$f(3.2) = 9.6 + 3.2 + 12.8 + 6.4 = 32.0$ GB/s。\n由于 $f(3.2) = 32.0  B_{\\max} = 35$，$\\alpha$ 的正确值必须大于 $3.2$。\n\n情况 2：$3.2 \\le \\alpha  6.4$。\n在此区间内，工作负载 1 和 2 受需求限制，因为 $\\alpha \\ge \\alpha_1^* = 3.2$ 且 $\\alpha \\ge \\alpha_2^* = 3.2$。它们的上限固定为其需求：$C_1(\\alpha) = D_1 = 9.6$ 和 $C_2(\\alpha) = D_2 = 3.2$。\n工作负载 3 和 4 仍然是与权重成比例的，因为 $\\alpha  \\alpha_3^* = 8.0$ 且 $\\alpha  \\alpha_4^* = 6.4$。它们的上限是 $C_3(\\alpha) = 4\\alpha$ 和 $C_4(\\alpha) = 2\\alpha$。\n主导方程变为：\n$$ D_1 + D_2 + \\alpha w_3 + \\alpha w_4 = B_{\\max} $$\n$$ 9.6 + 3.2 + 4\\alpha + 2\\alpha = 35 $$\n$$ 12.8 + 6\\alpha = 35 $$\n$$ 6\\alpha = 35 - 12.8 $$\n$$ 6\\alpha = 22.2 $$\n$$ \\alpha = \\frac{22.2}{6} = 3.7 $$\n这个值 $\\alpha = 3.7$ 位于区间 $[3.2, 6.4)$ 内，证实了我们的假设。这是正确的缩放因子。\n\n现在我们可以确定工作负载 4 的最终带宽上限 $C_4$。\n使用已确定的值 $\\alpha=3.7$：\n$$ C_4 = C_4(3.7) = \\min\\{2\\alpha, D_4\\} = \\min\\{2(3.7), 12.8\\} $$\n$$ C_4 = \\min\\{7.4, 12.8\\} = 7.4 $$\n工作负载 4 的带宽上限是 $7.4$ GB/s。\n\n作为最终检查，我们来计算所有上限及其总和：\n$C_1 = \\min\\{3(3.7), 9.6\\} = \\min\\{11.1, 9.6\\} = 9.6$ GB/s。\n$C_2 = \\min\\{1(3.7), 3.2\\} = \\min\\{3.7, 3.2\\} = 3.2$ GB/s。\n$C_3 = \\min\\{4(3.7), 32.0\\} = \\min\\{14.8, 32.0\\} = 14.8$ GB/s。\n$C_4 = 7.4$ GB/s。\n总带宽 $= C_1 + C_2 + C_3 + C_4 = 9.6 + 3.2 + 14.8 + 7.4 = 12.8 + 14.8 + 7.4 = 27.6 + 7.4 = 35.0$ GB/s。\n总和与预算 $B_{\\max} = 35$ GB/s 相匹配。\n\n问题要求答案以 GB/s 为单位表示，并四舍五入到四位有效数字。计算出的值恰好是 $7.4$。为了用四位有效数字表示，我们将其写为 $7.400$。", "answer": "$$ \\boxed{7.400} $$", "id": "3649910"}, {"introduction": "除了简单的资源分配，操作系统在压力下还常常面临关键决策，例如内存不足（Out-of-Memory, OOM）事件。本问题模拟了操作系统如何在一个进程的交换（swap）与终止（kill）之间做出理性选择。你将通过结合外部优先级（保护重要进程）和内部指标（如内存占用和页面错误率）来量化每种行为的“危害”，然后确定最优的、危害最小的行动。这项练习突显了优先级系统如何指导高风险决策。[@problem_id:3649860]", "problem": "一个使用请求分页的操作系统必须通过对单个进程执行一个确切的操作来避免即将发生的内存不足 (Out-Of-Memory (OOM)) 状况：要么将其完全换出到磁盘，要么终止它。这个选择必须在外部优先级（策略层面的重要性）和内部内存行为（驻留集大小和页面错误活动）之间取得平衡。系统设计者提出了一个基于第一性原理的风险加权损害模型：\n\n- 外部策略重要性由进程 $i$ 的外部优先级系数 $w_i$ 体现，其中较大的 $w_i$ 意味着该进程更不容易被终止。\n- 内部内存足迹由驻留集大小 (Resident Set Size (RSS)) $r_i$ 衡量，单位为 $\\text{MiB}$。\n- 内部内存压力由页面错误率 $\\phi_i$ 反映，单位为“次/秒”。\n- 换出进程包括将其驻留集写入磁盘；在持续磁盘吞吐量为 $b$（单位为 $\\text{MiB/s}$）的情况下，换出进程 $i$ 所需的时间 $t^{\\text{swap}}_i$ 等于其驻留集大小除以吞吐量。\n- 一次页面错误使用磁盘输入/输出 (Input/Output (I/O)) 将缺失的页面调入随机存取存储器 (Random Access Memory (RAM))；每次错误的平均服务时间为 $\\tau$ 秒。\n- 换出进程的损害是仅在换出期间产生的两个组成部分之和：与换出时间成正比的停滞成本，以及等于该进程在换出期间的累积页面错误服务时间的颠簸成本。\n- 终止进程的损害与其外部优先级系数成比例变化。\n\n假设有以下系统参数和进程指标：\n- 磁盘吞吐量 $b = 250\\ \\text{MiB/s}$。\n- 平均页面错误服务时间 $\\tau = 0.008\\ \\text{s}$。\n- 换出停滞惩罚率 $\\lambda = 2\\ \\text{损害单位/s}$。\n- 颠簸惩罚率 $\\mu = 1\\ \\text{损害单位/s}$。\n- 基础终止惩罚 $u = 100\\ \\text{损害单位}$。\n\n有三个候选进程，其标识符为 $i \\in \\{1,2,3\\}$：\n- 进程 $1$：外部优先级系数 $w_1 = 1.9$，驻留集大小 $r_1 = 2300\\ \\text{MiB}$，页面错误率 $\\phi_1 = 120\\ \\text{s}^{-1}$。\n- 进程 $2$：外部优先级系数 $w_2 = 0.6$，驻留集大小 $r_2 = 1500\\ \\text{MiB}$，页面错误率 $\\phi_2 = 40\\ \\text{s}^{-1}$。\n- 进程 $3$：外部优先级系数 $w_3 = 0.3$，驻留集大小 $r_3 = 3400\\ \\text{MiB}$，页面错误率 $\\phi_3 = 80\\ \\text{s}^{-1}$。\n\n仅使用上述基本定义，推导出最优换出选择的预期损害 $H_{\\text{swap}}^{\\star}$ 和最优终止选择的预期损害 $H_{\\text{kill}}^{\\star}$，然后计算其差值\n$$\\Delta = H_{\\text{swap}}^{\\star} - H_{\\text{kill}}^{\\star}.$$\n将您最终的 $\\Delta$ 数值四舍五入到四位有效数字。将最终结果表示为一个纯数字（损害单位是隐式的，不得写入答案中）。", "solution": "该问题要求计算与两种可能的操作（换出或终止进程）相关的损害，以缓解内存不足状况。每种操作的最优选择是使相关损害最小化的那个。我们必须首先根据所提供的定义来形式化损害模型。\n\n首先，我们定义换出进程 $i$ 所产生的损害，记为 $H_i^{\\text{swap}}$。问题陈述此损害为停滞成本和颠簸成本之和，两者均在换出进程所需时间内产生。\n\n进程 $i$ 的换出时间 $t^{\\text{swap}}_i$ 是以持续吞吐量 $b$ 将其驻留集大小 $r_i$ 写入磁盘所需的时间。\n$$t^{\\text{swap}}_i = \\frac{r_i}{b}$$\n\n停滞成本被定义为与换出时间成正比，惩罚率为 $\\lambda$。因此，停滞造成的损害为：\n$$H_{i, \\text{stall}} = \\lambda t^{\\text{swap}}_i$$\n\n对颠簸成本的描述有些模糊。它被表述为“等于累积页面错误服务时间”，同时又提供了一个“颠簸惩罚率” $\\mu$。为了确保量纲一致性，我们必须构造一个以损害为单位的公式。进程 $i$ 在其换出期间的“累积页面错误服务时间”是磁盘用于服务该进程页面错误的总繁忙时间。这可以通过计算换出期间的错误次数 $N_i = \\phi_i t^{\\text{swap}}_i$，再乘以每次错误的平均服务时间 $\\tau$ 来得到。因此，总服务时间为 $T_{i, \\text{faults}} = (\\phi_i t^{\\text{swap}}_i) \\tau$。这个量的单位是时间。颠簸惩罚率 $\\mu$ 的单位是“损害单位/秒”。将此速率乘以总服务时间 $T_{i, \\text{faults}}$，即 $\\mu \\cdot T_{i, \\text{faults}}$，会得到一个以损害为单位的量。这是唯一既在量纲上一致又利用了所有给定参数的解释。\n$$H_{i, \\text{thrash}} = \\mu \\cdot T_{i, \\text{faults}} = \\mu (\\phi_i t^{\\text{swap}}_i \\tau)$$\n\n换出进程 $i$ 的总损害是这两个组成部分之和：\n$$H_i^{\\text{swap}} = H_{i, \\text{stall}} + H_{i, \\text{thrash}} = \\lambda t^{\\text{swap}}_i + \\mu \\phi_i t^{\\text{swap}}_i \\tau$$\n提出因子 $t^{\\text{swap}}_i$ 并代入其表达式，得到：\n$$H_i^{\\text{swap}} = (\\lambda + \\mu \\phi_i \\tau) t^{\\text{swap}}_i = (\\lambda + \\mu \\phi_i \\tau) \\frac{r_i}{b}$$\n\n接下来，我们定义终止进程 $i$ 的损害，记为 $H_i^{\\text{kill}}$。问题陈述此损害“与其外部优先级系数 $w_i$ 成比例变化”，并且“较大的 $w_i$ 意味着该进程更不容易被终止”。这表明终止进程的损害是 $w_i$ 的一个单调递增函数。考虑到“基础终止惩罚” $u$，最直接且合乎逻辑的公式是正比关系：\n$$H_i^{\\text{kill}} = u \\cdot w_i$$\n\n问题提供了以下系统参数：\n- 磁盘吞吐量 $b = 250 \\text{ MiB/s}$。\n- 平均页面错误服务时间 $\\tau = 0.008 \\text{ s}$。\n- 换出停滞惩罚率 $\\lambda = 2 \\text{ 损害单位/s}$。\n- 颠簸惩罚率 $\\mu = 1 \\text{ 损害单位/s}$。\n- 基础终止惩罚 $u = 100 \\text{ 损害单位}$。\n\n三个候选进程的指标如下：\n- 进程 $1$：$w_1 = 1.9$，$r_1 = 2300 \\text{ MiB}$，$\\phi_1 = 120 \\text{ s}^{-1}$。\n- 进程 $2$：$w_2 = 0.6$，$r_2 = 1500 \\text{ MiB}$，$\\phi_2 = 40 \\text{ s}^{-1}$。\n- 进程 $3$：$w_3 = 0.3$，$r_3 = 3400 \\text{ MiB}$，$\\phi_3 = 80 \\text{ s}^{-1}$。\n\n现在我们使用推导出的公式 $H_i^{\\text{swap}} = \\frac{r_i}{b}(\\lambda + \\mu \\phi_i \\tau)$ 来计算每个进程的换出损害：\n$$H_1^{\\text{swap}} = \\frac{2300}{250} (2 + 1 \\cdot 120 \\cdot 0.008) = 9.2 (2 + 0.96) = 9.2(2.96) = 27.232$$\n$$H_2^{\\text{swap}} = \\frac{1500}{250} (2 + 1 \\cdot 40 \\cdot 0.008) = 6 (2 + 0.32) = 6(2.32) = 13.92$$\n$$H_3^{\\text{swap}} = \\frac{3400}{250} (2 + 1 \\cdot 80 \\cdot 0.008) = 13.6 (2 + 0.64) = 13.6(2.64) = 35.904$$\n\n最优的换出选择是损害最小的那个。因此，最优换出选择的预期损害 $H_{\\text{swap}}^{\\star}$ 是这些值中的最小值：\n$$H_{\\text{swap}}^{\\star} = \\min\\{H_1^{\\text{swap}}, H_2^{\\text{swap}}, H_3^{\\text{swap}}\\} = \\min\\{27.232, 13.92, 35.904\\} = 13.92$$\n\n接下来，我们使用公式 $H_i^{\\text{kill}} = u \\cdot w_i$ 来计算每个进程的终止损害：\n$$H_1^{\\text{kill}} = 100 \\cdot 1.9 = 190$$\n$$H_2^{\\text{kill}} = 100 \\cdot 0.6 = 60$$\n$$H_3^{\\text{kill}} = 100 \\cdot 0.3 = 30$$\n\n最优的终止选择是损害最小的那个。因此，最优终止选择的预期损害 $H_{\\text{kill}}^{\\star}$ 是这些值中的最小值：\n$$H_{\\text{kill}}^{\\star} = \\min\\{H_1^{\\text{kill}}, H_2^{\\text{kill}}, H_3^{\\text{kill}}\\} = \\min\\{190, 60, 30\\} = 30$$\n\n最后，我们计算差值 $\\Delta$：\n$$\\Delta = H_{\\text{swap}}^{\\star} - H_{\\text{kill}}^{\\star} = 13.92 - 30 = -16.08$$\n\n问题要求将 $\\Delta$ 的最终数值四舍五入到四位有效数字。计算出的值 $-16.08$ 已经有四位有效数字（$1$、$6$、$0$、$8$），因此无需进一步四舍五入。", "answer": "$$\\boxed{-16.08}$$", "id": "3649860"}, {"introduction": "现代系统是复杂的，拥有多个专门的调度器。本练习探讨了一个关键的设计挑战：中央处理器（CPU）和输入/输出（I/O）优先级之间的不匹配问题。你将分析一个独立调度导致系统不稳定的场景，因为一个任务的I/O需求与其CPU使用直接相关。通过评估不同的设计方案，你将揭示为何协调反馈机制对于稳健的性能至关重要，这说明了管理优先级不仅关乎单个资源，更关乎维持整个系统的稳定性。[@problem_id:3649895]", "problem": "一个系统运行两个资源调度器：一个用于中央处理器（CPU），一个用于输入/输出（IO）。每个调度器根据内部优先级和外部优先级的组合对任务进行排序。内部优先级，对于资源 $R \\in \\{\\mathrm{CPU}, \\mathrm{IO}\\}$ 和任务 $i$ 表示为 $P_{int}^{R}(i)$，由操作系统根据运行时观察（如预估的CPU突发长度和观察到的阻塞行为）得出。外部优先级，表示为 $P_{ext}^{R}(i)$，由调度器外部的策略（例如，管理员或服务水平目标）设置，以指示任务在资源 $R$ 上的相对重要性。CPU调度器从可运行任务中选择以分配CPU服务，IO调度器从待处理的IO请求中选择以分配IO服务；每个资源的容量为单位1，因此所有任务的总CPU服务速率和总IO服务速率都限制为 $1$。\n\n考虑两个任务 A 和 B，它们具有以下外部优先级：\n- $P_{ext}^{\\mathrm{CPU}}(A) = 1$, $P_{ext}^{\\mathrm{IO}}(A) = 5$,\n- $P_{ext}^{\\mathrm{CPU}}(B) = 5$, $P_{ext}^{\\mathrm{IO}}(B) = 1$.\n\n每个任务 $i$ 产生的IO请求量与其接收到的CPU服务成正比：具体来说，IO请求到达率 $\\lambda^{\\mathrm{IO}}_i$ 满足 $\\lambda^{\\mathrm{IO}}_i = \\alpha_i \\,\\mu^{\\mathrm{CPU}}_i$，其中 $\\mu^{\\mathrm{CPU}}_i$ 是分配给任务 $i$ 的CPU服务速率，$\\alpha_i$ 是由操作系统测量的任务特定转换因子。假设 $\\alpha_A = 10$ 和 $\\alpha_B = 0.1$。设 $\\mu^{\\mathrm{IO}}_i$ 为分配给任务 $i$ 的IO服务速率。队列稳定性要求对于每个任务 $i$，其IO队列不发散，即 $\\lambda^{\\mathrm{IO}}_i \\le \\mu^{\\mathrm{IO}}_i$。\n\n假设最初每个调度器通过按任务间的 $P_{ext}^{R}(\\cdot)$ 比例分配其资源来独立地强制执行外部优先级，而内部优先级仅反映短期老化，没有跨资源耦合。在这种情况下，具有高 $P_{ext}^{\\mathrm{IO}}$ 的任务可能在IO上受优待，但接收到的CPU很少；而具有高 $P_{ext}^{\\mathrm{CPU}}$ 的任务可能在CPU上受优待，但接收到的IO很少。这种不匹配可能导致饥饿或不稳定，因为IO的到达依赖于CPU服务，而CPU效率依赖于及时的IO完成。\n\n在上述场景中，哪种双调度器接口设计能最稳健地避免饥饿并确保队列稳定，同时保留外部优先级的意图？\n\nA. 保持CPU和IO调度器完全独立，每个调度器严格按照 $P_{ext}^{R}(\\cdot)$ 的比例分配其资源；仅在 $P_{int}^{R}(\\cdot)$ 中使用每个资源的老化机制来缓解饥饿。\n\nB. 对于每个任务 $i$，通过固定的线性标量化将其外部优先级向量 $\\left(P_{ext}^{\\mathrm{CPU}}(i), P_{ext}^{\\mathrm{IO}}(i)\\right)$ 转换为每个资源的有效优先级，例如，$P_{eff}^{\\mathrm{CPU}}(i) = \\alpha P_{ext}^{\\mathrm{CPU}}(i) + \\beta P_{ext}^{\\mathrm{IO}}(i)$ 和 $P_{eff}^{\\mathrm{IO}}(i) = \\gamma P_{ext}^{\\mathrm{IO}}(i) + \\delta P_{ext}^{\\mathrm{CPU}}(i)$，其中系数为常数，然后每个资源根据 $P_{eff}^{R}(\\cdot)$ 独立调度。\n\nC. 引入一个协调的跨调度器反馈接口：对于每个任务 $i$，IO调度器导出其观察到的积压和转换因子 $\\alpha_i$，CPU调度器导出可运行的积压；每个调度器调整其有效优先级 $P_{eff}^{R}(i)$ 以满足队列稳定性所隐含的资源耦合约束（例如，确保 $\\mu^{\\mathrm{IO}}_i \\ge \\alpha_i \\,\\mu^{\\mathrm{CPU}}_i$），同时对分配进行归一化以尊重外部权重 $\\left(P_{ext}^{\\mathrm{CPU}}(i), P_{ext}^{\\mathrm{IO}}(i)\\right)$。\n\nD. 将CPU和IO优先级合并为一个单一的全局标量 $P(i) = P_{ext}^{\\mathrm{CPU}}(i) + P_{ext}^{\\mathrm{IO}}(i)$，在单个队列上运行一个统一的调度器，并让底层资源管理器按此顺序对CPU和IO进行时间分片，无需额外反馈。\n\n选择最佳选项。", "solution": "问题的核心在于两种资源——中央处理器（CPU）和输入/输出（IO）——之间的耦合，以及独立调度器未能管理这种耦合。任务IO队列的稳定性要求IO服务速率至少不小于IO请求速率。这由不等式 $\\lambda^{\\mathrm{IO}}_i \\le \\mu^{\\mathrm{IO}}_i$ 给出，其中 $\\lambda^{\\mathrm{IO}}_i$ 是任务 $i$ 的IO请求到达率，$\\mu^{\\mathrm{IO}}_i$ 是分配给任务 $i$ 的IO服务速率。问题陈述指出 $\\lambda^{\\mathrm{IO}}_i = \\alpha_i \\,\\mu^{\\mathrm{CPU}}_i$，其中 $\\mu^{\\mathrm{CPU}}_i$ 是任务 $i$ 的CPU服务速率，$\\alpha_i$ 是任务特定的转换因子。因此，任务 $i$ 的稳定性条件是 $\\alpha_i \\,\\mu^{\\mathrm{CPU}}_i \\le \\mu^{\\mathrm{IO}}_i$。\n\n初始场景涉及两个任务 A 和 B，参数如下：\n- 外部优先级：$P_{ext}^{\\mathrm{CPU}}(A) = 1$, $P_{ext}^{\\mathrm{IO}}(A) = 5$，以及 $P_{ext}^{\\mathrm{CPU}}(B) = 5$, $P_{ext}^{\\mathrm{IO}}(B) = 1$。\n- 转换因子：$\\alpha_A = 10$, $\\alpha_B = 0.1$。\n\n在初始情况下，资源根据外部优先级按比例分配。假设任务A和B是唯一竞争这些资源的任务，每个资源的总容量 $1$ 将按以下方式分配：\n\n对于CPU调度器：\n总外部优先级为 $P_{ext}^{\\mathrm{CPU}}(A) + P_{ext}^{\\mathrm{CPU}}(B) = 1 + 5 = 6$。\nCPU服务速率为：\n$$ \\mu^{\\mathrm{CPU}}_A = \\frac{P_{ext}^{\\mathrm{CPU}}(A)}{P_{ext}^{\\mathrm{CPU}}(A) + P_{ext}^{\\mathrm{CPU}}(B)} = \\frac{1}{6} $$\n$$ \\mu^{\\mathrm{CPU}}_B = \\frac{P_{ext}^{\\mathrm{CPU}}(B)}{P_{ext}^{\\mathrm{CPU}}(A) + P_{ext}^{\\mathrm{CPU}}(B)} = \\frac{5}{6} $$\n\n对于IO调度器：\n总外部优先级为 $P_{ext}^{\\mathrm{IO}}(A) + P_{ext}^{\\mathrm{IO}}(B) = 5 + 1 = 6$。\nIO服务速率为：\n$$ \\mu^{\\mathrm{IO}}_A = \\frac{P_{ext}^{\\mathrm{IO}}(A)}{P_{ext}^{\\mathrm{IO}}(A) + P_{ext}^{\\mathrm{IO}}(B)} = \\frac{5}{6} $$\n$$ \\mu^{\\mathrm{IO}}_B = \\frac{P_{ext}^{\\mathrm{IO}}(B)}{P_{ext}^{\\mathrm{IO}}(A) + P_{ext}^{\\mathrm{IO}}(B)} = \\frac{1}{6} $$\n\n现在，我们来检查每个任务的稳定性条件 $\\alpha_i \\,\\mu^{\\mathrm{CPU}}_i \\le \\mu^{\\mathrm{IO}}_i$。\n\n对于任务 A：\n我们必须检查是否 $\\alpha_A \\,\\mu^{\\mathrm{CPU}}_A \\le \\mu^{\\mathrm{IO}}_A$。\n代入数值：$10 \\times \\frac{1}{6} \\le \\frac{5}{6}$，简化为 $\\frac{10}{6} \\le \\frac{5}{6}$。此不等式不成立。\n任务A的IO队列是不稳定的。它产生IO请求的速率是它接收IO服务速率的两倍，导致队列无限增长并使任务饥饿。\n\n对于任务 B：\n我们必须检查是否 $\\alpha_B \\,\\mu^{\\mathrm{CPU}}_B \\le \\mu^{\\mathrm{IO}}_B$。\n代入数值：$0.1 \\times \\frac{5}{6} \\le \\frac{1}{6}$，简化为 $\\frac{0.5}{6} \\le \\frac{1}{6}$。此不等式成立。\n任务B的IO队列是稳定的。\n\n这个分析证实了问题陈述中的说法，即初始设计可能导致不稳定。一个稳健的解决方案必须协调资源分配，以满足所有任务的稳定性条件。\n\n**逐项分析**\n\n**A. 保持CPU和IO调度器完全独立，每个调度器严格按照 $P_{ext}^{R}(\\cdot)$ 的比例分配其资源；仅在 $P_{int}^{R}(\\cdot)$ 中使用每个资源的老化机制来缓解饥饿。**\n这个选项描述了最初有缺陷的场景，并提出老化作为解决方案。老化是一种随时间增加任务优先级以防止无限期延迟的机制。然而，它没有解决根本的结构性问题，即CPU驱动的IO生成与IO服务分配之间的速率不匹配。对于任务A，老化可能会给它一个CPU时间片，但这只会通过向已经不堪重负的IO队列生成更多IO请求而加剧问题。老化机制不会动态调整服务速率比例 $\\mu^{\\mathrm{CPU}}_i$ 和 $\\mu^{\\mathrm{IO}}_i$ 以满足物理约束 $\\alpha_i \\,\\mu^{\\mathrm{CPU}}_i \\le \\mu^{\\mathrm{IO}}_i$。因此，这种方法不稳健，无法解决不稳定性问题。\n**结论：错误。**\n\n**B. 对于每个任务 $i$，通过固定的线性标量化将其外部优先级向量 $\\left(P_{ext}^{\\mathrm{CPU}}(i), P_{ext}^{\\mathrm{IO}}(i)\\right)$ 转换为每个资源的有效优先级，例如，$P_{eff}^{\\mathrm{CPU}}(i) = \\alpha P_{ext}^{\\mathrm{CPU}}(i) + \\beta P_{ext}^{\\mathrm{IO}}(i)$ 和 $P_{eff}^{\\mathrm{IO}}(i) = \\gamma P_{ext}^{\\mathrm{IO}}(i) + \\delta P_{ext}^{\\mathrm{CPU}}(i)$，其中系数为常数，然后每个资源根据 $P_{eff}^{R}(\\cdot)$ 独立调度。**\n这种方法试图静态地耦合优先级。关键弱点是系数 $\\alpha$, $\\beta$, $\\gamma$, 和 $\\delta$ 是*恒定*且*固定*的。一个稳健的调度器必须适应任务的特定特征，特别是可能差异很大的转换因子 $\\alpha_i$。一组为任务A和B（$\\alpha_A = 10, \\alpha_B = 0.1$）稳定系统的固定系数，很可能会在面对具有不同 $\\alpha_i$ 值的另一组任务时失败。系统无法学习或使用关键的 $\\alpha_i$ 参数。因为这个解决方案不能适应动态的任务特征，所以它不稳健。\n**结论：错误。**\n\n**C. 引入一个协调的跨调度器反馈接口：对于每个任务 $i$，IO调度器导出其观察到的积压和转换因子 $\\alpha_i$，CPU调度器导出可运行的积压；每个调度器调整其有效优先级 $P_{eff}^{R}(i)$ 以满足队列稳定性所隐含的资源耦合约束（例如，确保 $\\mu^{\\mathrm{IO}}_i \\ge \\alpha_i \\,\\mu^{\\mathrm{CPU}}_i$），同时对分配进行归一化以尊重外部权重 $\\left(P_{ext}^{\\mathrm{CPU}}(i), P_{ext}^{\\mathrm{IO}}(i)\\right)$。**\n这个设计直接解决了问题的根本原因：信息和协调的缺乏。通过创建一个反馈回路，调度器能够意识到跨资源的依赖关系。该设计明确提到使用关键参数（$\\alpha_i$）和状态（积压）来强制执行稳定性约束 $\\mu^{\\mathrm{IO}}_i \\ge \\alpha_i \\,\\mu^{\\mathrm{CPU}}_i$。这是一个自适应的动态控制机制。它通过根据任务的实际、测量的需求调整分配，稳健地解决了稳定性问题。此外，它旨在这样做，同时“对分配进行归一化以尊重外部权重”，这意味着它首先满足硬性物理约束，然后以一种尊重外部优先级策略意图的方式分配剩余的可行容量。这代表了一个成熟且稳健的系统设计。\n**结论：正确。**\n\n**D. 将CPU和IO优先级合并为一个单一的全局标量 $P(i) = P_{ext}^{\\mathrm{CPU}}(i) + P_{ext}^{\\mathrm{IO}}(i)$，在单个队列上运行一个统一的调度器，并让底层资源管理器按此顺序对CPU和IO进行时间分片，无需额外反馈。**\n这种方法极大地简化了问题。\n首先，它通过将不同资源的优先级相加来丢弃关键信息。对于我们的示例任务，$P(A) = 1 + 5 = 6$ 和 $P(B) = 5 + 1 = 6$。调度器会认为它们具有同等重要性，这与外部优先级的意图相矛盾（任务B是CPU重要的，任务A是IO重要的）。\n其次，它提出了一个没有反馈的僵化的“时间片”分配方案。这样的方案对由 $\\alpha_i$ 因子所体现的任务实际资源需求是无知的。任务A每单位CPU服务需要大量的IO服务（$\\alpha_A = 10$），而任务B需要很少（$\\alpha_B = 0.1$）。一个固定的时间分片规则无法适应这种异质性，也无法确保稳定性。这种设计既不是自适应的，也不是信息感知的。\n**结论：错误。**", "answer": "$$\\boxed{C}$$", "id": "3649895"}]}