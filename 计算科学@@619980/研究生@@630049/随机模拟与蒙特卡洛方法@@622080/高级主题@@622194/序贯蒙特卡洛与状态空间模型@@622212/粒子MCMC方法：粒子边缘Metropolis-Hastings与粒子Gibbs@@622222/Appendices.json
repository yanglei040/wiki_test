{"hands_on_practices": [{"introduction": "粒子滤波器的效率，并因此影响粒子MCMC算法的效率，在很大程度上取决于如何生成（或“提议”）粒子。这项练习 [@problem_id:3327380] 让你深入探讨这一核心问题，通过比较两种常见提议策略下重要性权重的方差，揭示“最优”提议分布背后的理论基础。这个推导将帮助你理解是什么决定了粒子滤波器估计的质量。", "problem": "考虑一个标量隐马尔可夫模型 (HMM)，其潜变量状态为 $x_t \\in \\mathbb{R}$，观测值为 $y_t \\in \\mathbb{R}$，由转移密度 $p_{\\theta}(x_t \\mid x_{t-1}) = \\mathcal{N}(x_t ; \\phi x_{t-1}, \\sigma_x^2)$ 和发射密度 $p_{\\theta}(y_t \\mid x_t) = \\mathcal{N}(y_t ; x_t, \\sigma_y^2)$ 指定，其中 $\\phi \\in \\mathbb{R}$，$\\sigma_x^2 > 0$ 和 $\\sigma_y^2 > 0$ 是固定参数。在 Particle Markov chain Monte Carlo (PMCMC) 的背景下，特别是在 Particle Marginal Metropolis–Hastings (PMMH) 或 Particle Gibbs 中使用的粒子滤波器内的单个时间步长，考虑在时间 $t$ 的增量重要性权重，其对于一个通用提议 $q(x_t \\mid x_{t-1}, y_t)$ 定义为\n$$\nw_t(x_t; x_{t-1}, y_t) \\propto \\frac{p_{\\theta}(y_t \\mid x_t)\\, p_{\\theta}(x_t \\mid x_{t-1})}{q(x_t \\mid x_{t-1}, y_t)}.\n$$\n关注单个时间步长 $t$，其中 $x_{t-1} = a \\in \\mathbb{R}$ 且观测值为 $y_t = y \\in \\mathbb{R}$。比较在以下两种提议下增量重要性权重的方差（相对于 $x_t$ 的提议抽样）：\n- bootstrap 提议 $q_{\\text{boot}}(x_t \\mid x_{t-1}, y_t) = p_{\\theta}(x_t \\mid x_{t-1})$，以及\n- 最优提议 $q_{\\text{opt}}(x_t \\mid x_{t-1}, y_t) \\propto p_{\\theta}(y_t \\mid x_t)\\, p_{\\theta}(x_t \\mid x_{t-1})$。\n\n假设方差是在给定固定值 $x_{t-1} = a$ 和 $y_t = y$ 的条件下计算的，并使用未归一化的增量权重。从第一性原理推导出每种提议下的确切方差。然后，将 bootstrap 提议下增量重要性权重的方差作为 $\\phi$、$a$、$y$、$\\sigma_x^2$ 和 $\\sigma_y^2$ 的函数，以闭式解析表达式的形式报告为你的最终答案。\n\n以单个闭式解析表达式作答。不要包含任何单位。", "solution": "问题要求在两种不同的提议分布（bootstrap 提议和最优提议）下，计算粒子滤波器在单个时间步长的增量重要性权重的方差。该模型是一个线性高斯状态空间模型。\n\n首先，我们为单个时间步长 $t$ 建立符号表示，为清晰起见省略下标。\n先验状态固定为 $x_{t-1} = a$。\n当前观测值固定为 $y_t = y$。\n状态转移模型是 $p(x|a) = p_{\\theta}(x_t=x | x_{t-1}=a) = \\mathcal{N}(x; \\phi a, \\sigma_x^2)$。\n观测模型是 $p(y|x) = p_{\\theta}(y_t=y | x_t=x) = \\mathcal{N}(y; x, \\sigma_y^2)$。\n未归一化的增量重要性权重由下式给出\n$$\nw(x) = \\frac{p(y|x) p(x|a)}{q(x|a, y)}\n$$\n方差是关于随机变量 $x \\sim q(x|a, y)$ 计算的，并以固定值 $a$ 和 $y$ 为条件。\n\n首先，我们按照比较的要求，分析最优提议。\n最优提议，在最小化权重方差的意义上，是给定观测值和前一状态下状态的后验分布：\n$$\nq_{\\text{opt}}(x|a, y) = p(x|a, y) = \\frac{p(y|x) p(x|a)}{p(y|a)}\n$$\n其中 $p(y|a) = \\int p(y|x) p(x|a) dx$ 是观测值的边际似然。\n对于这个提议，增量权重是：\n$$\nw_{\\text{opt}}(x) = \\frac{p(y|x) p(x|a)}{q_{\\text{opt}}(x|a, y)} = \\frac{p(y|x) p(x|a)}{ \\frac{p(y|x) p(x|a)}{p(y|a)} } = p(y|a)\n$$\n权重 $w_{\\text{opt}}(x)$ 等于边际似然 $p(y|a)$，它是一个关于 $x$ 的常数。常数的方差为零。\n$$\n\\text{Var}_{x \\sim q_{\\text{opt}}}[w_{\\text{opt}}(x)] = \\text{Var}[p(y|a)] = 0\n$$\n这证明了该提议在权重方差方面的“最优性”。\n\n接下来，我们分析 bootstrap 提议，这是问题的核心。\nbootstrap 提议使用状态转移模型作为提议分布：\n$$\nq_{\\text{boot}}(x|a, y) = p(x|a) = \\mathcal{N}(x; \\phi a, \\sigma_x^2)\n$$\n对于这个提议，增量权重简化为观测似然：\n$$\nw_{\\text{boot}}(x) = \\frac{p(y|x) p(x|a)}{q_{\\text{boot}}(x|a, y)} = \\frac{p(y|x) p(x|a)}{p(x|a)} = p(y|x)\n$$\n具体来说，$w_{\\text{boot}}(x) = \\mathcal{N}(y; x, \\sigma_y^2) = \\frac{1}{\\sqrt{2\\pi\\sigma_y^2}} \\exp\\left(-\\frac{(y-x)^2}{2\\sigma_y^2}\\right)$。\n我们需要计算这个权重的方差 $\\text{Var}_{x \\sim q_{\\text{boot}}}[w_{\\text{boot}}(x)]$，其中随机性来自 $x \\sim q_{\\text{boot}}(x|a,y) = \\mathcal{N}(x; \\phi a, \\sigma_x^2)$。\n方差由 $\\text{Var}(w) = E[w^2] - (E[w])^2$ 给出。\n\n首先，我们计算期望权重 $E[w_{\\text{boot}}(x)]$。\n$$\nE[w_{\\text{boot}}(x)] = \\int_{-\\infty}^{\\infty} w_{\\text{boot}}(x) q_{\\text{boot}}(x) dx = \\int_{-\\infty}^{\\infty} p(y|x) p(x|a) dx\n$$\n这个积分是边际似然 $p(y|a)$。对于这个线性高斯系统，$p(y|a)$ 也是一个高斯分布。因为 $x|a \\sim \\mathcal{N}(\\phi a, \\sigma_x^2)$ 且 $y|x \\sim \\mathcal{N}(x, \\sigma_y^2)$，我们可以将 $y$ 看作 $y=x+\\epsilon_y$，其中 $\\epsilon_y \\sim \\mathcal{N}(0, \\sigma_y^2)$。给定 $a$，$x$ 是一个随机变量，所以 $y$ 是两个独立高斯随机变量（一个是 $x$，另一个是 $\\epsilon_y$）的和，因此也是高斯分布。其均值为 $E[y|a] = E[x|a] = \\phi a$，方差为 $\\text{Var}(y|a) = \\text{Var}(x|a) + \\text{Var}(\\epsilon_y) = \\sigma_x^2 + \\sigma_y^2$。\n因此，$p(y|a) = \\mathcal{N}(y; \\phi a, \\sigma_x^2+\\sigma_y^2)$。\n期望权重是该概率密度函数 (PDF) 在 $y$ 处的值：\n$$\nE[w_{\\text{boot}}(x)] = \\frac{1}{\\sqrt{2\\pi(\\sigma_x^2+\\sigma_y^2)}} \\exp\\left(-\\frac{(y-\\phi a)^2}{2(\\sigma_x^2+\\sigma_y^2)}\\right)\n$$\n期望权重的平方是：\n$$\n(E[w_{\\text{boot}}(x)])^2 = \\frac{1}{2\\pi(\\sigma_x^2+\\sigma_y^2)} \\exp\\left(-\\frac{(y-\\phi a)^2}{\\sigma_x^2+\\sigma_y^2}\\right)\n$$\n\n接下来，我们计算二阶矩 $E[w_{\\text{boot}}(x)^2]$。\n$$\nE[w_{\\text{boot}}(x)^2] = \\int_{-\\infty}^{\\infty} [w_{\\text{boot}}(x)]^2 q_{\\text{boot}}(x) dx = \\int_{-\\infty}^{\\infty} [p(y|x)]^2 p(x|a) dx\n$$\n我们有 $[p(y|x)]^2 = \\left(\\frac{1}{\\sqrt{2\\pi\\sigma_y^2}} \\exp\\left(-\\frac{(y-x)^2}{2\\sigma_y^2}\\right)\\right)^2 = \\frac{1}{2\\pi\\sigma_y^2} \\exp\\left(-\\frac{(y-x)^2}{\\sigma_y^2}\\right)$。\n提议是 $p(x|a) = \\frac{1}{\\sqrt{2\\pi\\sigma_x^2}} \\exp\\left(-\\frac{(x-\\phi a)^2}{2\\sigma_x^2}\\right)$。\n二阶矩的积分是：\n$$\nE[w_{\\text{boot}}(x)^2] = \\int_{-\\infty}^{\\infty} \\frac{1}{2\\pi\\sigma_y^2} \\exp\\left(-\\frac{(x-y)^2}{\\sigma_y^2}\\right) \\frac{1}{\\sqrt{2\\pi\\sigma_x^2}} \\exp\\left(-\\frac{(x-\\phi a)^2}{2\\sigma_x^2}\\right) dx\n$$\n被积函数是两个类高斯函数的乘积。指数部分是 $x$ 的一个二次式：\n$$\n-\\left( \\frac{(x-y)^2}{\\sigma_y^2} + \\frac{(x-\\phi a)^2}{2\\sigma_x^2} \\right) = - \\left( x^2\\left(\\frac{1}{\\sigma_y^2}+\\frac{1}{2\\sigma_x^2}\\right) - 2x\\left(\\frac{y}{\\sigma_y^2}+\\frac{\\phi a}{2\\sigma_x^2}\\right) + \\left(\\frac{y^2}{\\sigma_y^2}+\\frac{(\\phi a)^2}{2\\sigma_x^2}\\right) \\right)\n$$\n这是一个未归一化的高斯形式。对指数中的 $x$ 配方，我们发现 $\\exp(-\\text{二次式})$ 的积分是一个标准结果。计算得出：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{(x-y)^2}{\\sigma_y^2}\\right) \\exp\\left(-\\frac{(x-\\phi a)^2}{2\\sigma_x^2}\\right) dx = \\sqrt{\\frac{2\\pi\\sigma_x^2\\sigma_y^2}{2\\sigma_x^2+\\sigma_y^2}} \\exp\\left(-\\frac{(y-\\phi a)^2}{2\\sigma_x^2+\\sigma_y^2}\\right)\n$$\n将此结果代回 $E[w_{\\text{boot}}(x)^2]$ 的表达式中：\n$$\nE[w_{\\text{boot}}(x)^2] = \\frac{1}{2\\pi\\sigma_y^2 \\sqrt{2\\pi\\sigma_x^2}} \\left( \\sqrt{\\frac{2\\pi\\sigma_x^2\\sigma_y^2}{2\\sigma_x^2+\\sigma_y^2}} \\exp\\left(-\\frac{(y-\\phi a)^2}{2\\sigma_x^2+\\sigma_y^2}\\right) \\right)\n$$\n简化前面的系数：\n$$\n\\frac{1}{2\\pi\\sigma_y^2 \\sqrt{2\\pi}\\sigma_x} \\left( \\sqrt{2\\pi} \\frac{\\sigma_x\\sigma_y}{\\sqrt{2\\sigma_x^2+\\sigma_y^2}} \\right) = \\frac{\\sigma_x\\sigma_y}{2\\pi\\sigma_y^2\\sigma_x\\sqrt{2\\sigma_x^2+\\sigma_y^2}} = \\frac{1}{2\\pi\\sigma_y\\sqrt{2\\sigma_x^2+\\sigma_y^2}}\n$$\n所以，二阶矩是：\n$$\nE[w_{\\text{boot}}(x)^2] = \\frac{1}{2\\pi\\sigma_y\\sqrt{2\\sigma_x^2+\\sigma_y^2}} \\exp\\left(-\\frac{(y-\\phi a)^2}{2\\sigma_x^2+\\sigma_y^2}\\right)\n$$\n最后，通过从二阶矩中减去均值的平方来求得方差：\n$$\n\\text{Var}(w_{\\text{boot}}) = E[w_{\\text{boot}}^2] - (E[w_{\\text{boot}}])^2\n$$\n$$\n\\text{Var}(w_{\\text{boot}}) = \\frac{1}{2\\pi\\sigma_y\\sqrt{2\\sigma_x^2+\\sigma_y^2}} \\exp\\left(-\\frac{(y-\\phi a)^2}{2\\sigma_x^2+\\sigma_y^2}\\right) - \\frac{1}{2\\pi(\\sigma_x^2+\\sigma_y^2)} \\exp\\left(-\\frac{(y-\\phi a)^2}{\\sigma_x^2+\\sigma_y^2}\\right)\n$$\n这就是 bootstrap 提议下增量重要性权重的闭式解析表达式。", "answer": "$$ \\boxed{ \\frac{1}{2\\pi\\sigma_y\\sqrt{2\\sigma_x^2+\\sigma_y^2}} \\exp\\left(-\\frac{(y-\\phi a)^2}{2\\sigma_x^2+\\sigma_y^2}\\right) - \\frac{1}{2\\pi(\\sigma_x^2+\\sigma_y^2)} \\exp\\left(-\\frac{(y-\\phi a)^2}{\\sigma_x^2+\\sigma_y^2}\\right) } $$", "id": "3327380"}, {"introduction": "伪边缘方法的一个关键洞见是，似然估计中的噪声不会破坏算法的正确性，但会降低其效率。这项练习 [@problem_id:3327363] 提供了一个动手推导的机会，旨在量化这种影响。你将精确地展示对数似然估计量的方差如何直接转化为MCMC接受率的降低，从而在理论和实践之间建立起一座桥梁。", "problem": "考虑一个粒子马尔可夫链蒙特卡洛 (PMCMC) 算法，该算法使用粒子边缘梅特罗波利斯-哈斯廷斯 (PMMH) 方法从一个后验分布中采样参数 $ \\theta $。该后验分布的未归一化密度为 $ \\pi(\\theta) p_{\\theta}(y) $，其中 $ p_{\\theta}(y) $ 是一个难以计算的似然，由粒子滤波器进行无偏估计。令 $ \\hat{p}(y \\mid \\theta, U) $ 表示使用随机种子 $ U $ 从粒子滤波器获得的无偏似然估计量。定义对数似然噪声为 $ Z(\\theta, U) = \\log \\hat{p}(y \\mid \\theta, U) - \\log p_{\\theta}(y) $。假设如下：\n- 该估计量在似然尺度上是无偏的，即 $ \\mathbb{E}[\\hat{p}(y \\mid \\theta, U) \\mid \\theta] = p_{\\theta}(y) $，这意味着 $ \\mathbb{E}[\\exp(Z(\\theta, U)) \\mid \\theta] = 1 $。\n- 对于每个固定的 $ \\theta $，$ Z(\\theta, U) $ 的分布近似为方差为 $ \\sigma^{2} $ 的高斯分布，并且（根据无偏性约束）其均值为 $ -\\sigma^{2}/2 $。\n- 在 Metropolis–Hastings 步骤中，对 $ \\theta $ 的提议满足以下条件：在给定当前 $ \\theta $ 和提议的 $ \\theta' $ 的条件下，基于 $ \\pi(\\theta) p_{\\theta}(y) $ 和提议核的精确 Metropolis–Hastings 比率等于 $ 1 $。这分离了似然估计噪声对接受概率的影响。\n- 粒子滤波器在当前状态和提议状态下使用独立的随机性运行，因此相应的对数噪声在给定 $ \\theta $ 和 $ \\theta' $ 的情况下是独立的。\n- 马尔可夫链在关于 $ (\\theta, U) $ 的扩展 PMMH 目标分布上处于平稳状态。\n\n在这些条件下，对于一个提议的移动，PMMH 的接受概率简化为\n$$\n\\alpha = \\min\\left\\{ 1, \\exp\\left(Z' - Z \\right) \\right\\},\n$$\n其中 $ Z' = Z(\\theta', U') $ 是提议的对数噪声，$ Z = Z(\\theta, U) $ 是当前的对数噪声。\n\n从上述基本定义出发，推导平均接受概率 $ \\mathbb{E}[\\alpha] $ 作为噪声方差 $ \\sigma^{2} $ 的函数的闭式解析表达式。其中，期望是关于当前对数噪声的平稳分布和新对数噪声的提议分布联合计算的。您可以用标准正态累积分布函数 $ \\Phi(\\cdot) $ 来表示您的答案。您的最终答案必须是仅依赖于 $ \\sigma^{2} $ 的单一闭式解析表达式。不需要数值近似，也不涉及任何单位。请以精确形式（无舍入）表示最终答案。并用文字或符号简要说明平均接受概率如何依赖于 $ \\sigma^{2} $。", "solution": "目标是在一系列特定的简化假设下，推导粒子边缘梅特罗波利斯-哈斯廷斯 (PMMH) 移动的平均接受概率 $\\mathbb{E}[\\alpha]$ 的闭式解析表达式。接受概率由 $\\alpha = \\min\\left\\{ 1, \\exp\\left(Z' - Z \\right) \\right\\}$ 给出，其中 $Z$ 和 $Z'$ 分别是当前状态和提议状态下的对数似然噪声。\n\n推导的核心在于正确确定当前噪声 $Z$ 和提议噪声 $Z'$ 的概率分布。问题陈述指出，对于任何给定的参数 $\\theta$，对数似然噪声 $Z(\\theta, U) = \\log \\hat{p}(y \\mid \\theta, U) - \\log p_{\\theta}(y)$ 近似为高斯分布。似然估计量是无偏的这一条件，即 $\\mathbb{E}[\\exp(Z(\\theta, U)) \\mid \\theta] = 1$，意味着如果 $Z$ 服从正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$，其均值必须为 $\\mu = -\\sigma^2/2$。因此，对于给定的 $\\theta$，由粒子滤波器生成的对数噪声的分布为 $q(z) = \\mathcal{N}(-\\frac{\\sigma^2}{2}, \\sigma^2)$。\n\n提议的对数噪声 $Z' = Z(\\theta', U')$ 是通过对提议的参数 $\\theta'$ 使用一组新的随机数 $U'$ 运行粒子滤波器而生成的。因此，$Z'$ 的分布是上面指定的分布：\n$$\nZ' \\sim \\mathcal{N}\\left(-\\frac{\\sigma^2}{2}, \\sigma^2\\right)\n$$\n\n当前的对数噪声 $Z$ 是 PMMH 链的一个分量，该链被假设处于平稳状态。PMMH 算法在参数和辅助随机变量 $(\\theta, U)$ 的扩展空间上的平稳分布，其密度与目标分布 $\\pi(\\theta) p_{\\theta}(y)$ 乘以辅助变量的提议分布成正比。在我们的情况下，这对应于 $\\pi(\\theta) \\hat{p}(y|\\theta, U)$。我们可以用对数噪声 $Z$ 来表示它：\n$$\n\\pi_{\\text{stationary}}(\\theta, Z) \\propto \\pi(\\theta) p_{\\theta}(y) \\exp(Z) q(Z \\mid \\theta)\n$$\n其中 $q(Z \\mid \\theta)$ 是 $\\mathcal{N}(-\\sigma^2/2, \\sigma^2)$ 的密度，假设它独立于 $\\theta$。$Z$ 的边缘平稳分布（我们称其密度为 $\\pi(z)$）是通过对 $\\theta$ 积分得到的。关键的是，它与原始噪声分布 $q(z)$ 乘以因子 $\\exp(z)$ 进行加权后成正比：\n$$\n\\pi(z) \\propto q(z) \\exp(z)\n$$\n我们来求这个分布的形式。代入 $q(z)$ 的密度函数：\n$$\n\\pi(z) \\propto \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(z - (-\\sigma^2/2))^2}{2\\sigma^2}\\right) \\exp(z)\n$$\n$$\n\\pi(z) \\propto \\exp\\left(-\\frac{(z + \\sigma^2/2)^2}{2\\sigma^2} + z\\right)\n$$\n我们对指数项进行配方：\n$$\n-\\frac{z^2 + z\\sigma^2 + \\sigma^4/4}{2\\sigma^2} + z = \\frac{-z^2 - z\\sigma^2 - \\sigma^4/4 + 2z\\sigma^2}{2\\sigma^2} = \\frac{-z^2 + z\\sigma^2 - \\sigma^4/4}{2\\sigma^2}\n$$\n$$\n= -\\frac{(z^2 - z\\sigma^2 + \\sigma^4/4)}{2\\sigma^2} = -\\frac{(z - \\sigma^2/2)^2}{2\\sigma^2}\n$$\n这是一个均值为 $\\sigma^2/2$、方差为 $\\sigma^2$ 的高斯分布的核。因此，当前对数噪声 $Z$ 的平稳分布是：\n$$\nZ \\sim \\mathcal{N}\\left(\\frac{\\sigma^2}{2}, \\sigma^2\\right)\n$$\n\n现在我们定义差值 $\\Delta Z = Z' - Z$。由于 $Z'$ 和 $Z$ 是独立的，$\\Delta Z$ 也服从正态分布。其均值和方差为：\n$$\n\\mathbb{E}[\\Delta Z] = \\mathbb{E}[Z'] - \\mathbb{E}[Z] = \\left(-\\frac{\\sigma^2}{2}\\right) - \\left(\\frac{\\sigma^2}{2}\\right) = -\\sigma^2\n$$\n$$\n\\text{Var}(\\Delta Z) = \\text{Var}(Z') + \\text{Var}(Z) = \\sigma^2 + \\sigma^2 = 2\\sigma^2\n$$\n所以，$\\Delta Z \\sim \\mathcal{N}(-\\sigma^2, 2\\sigma^2)$。\n\n平均接受概率是 $\\alpha = \\min\\{1, \\exp(\\Delta Z)\\}$ 的期望。令 $f_{\\Delta Z}(x)$ 为 $\\Delta Z$ 的概率密度函数。则期望为：\n$$\n\\mathbb{E}[\\alpha] = \\int_{-\\infty}^{\\infty} \\min\\{1, \\exp(x)\\} f_{\\Delta Z}(x) \\, dx\n$$\n我们根据 $x$ 的值将积分分成两部分：\n$$\n\\mathbb{E}[\\alpha] = \\int_{-\\infty}^{0} \\exp(x) f_{\\Delta Z}(x) \\, dx + \\int_{0}^{\\infty} 1 \\cdot f_{\\Delta Z}(x) \\, dx\n$$\n第二个积分就是概率 $P(\\Delta Z > 0)$。令 $S$ 为一个标准正态随机变量，$S \\sim \\mathcal{N}(0, 1)$。\n$$\nP(\\Delta Z > 0) = P\\left(\\frac{\\Delta Z - (-\\sigma^2)}{\\sqrt{2\\sigma^2}} > \\frac{0 - (-\\sigma^2)}{\\sqrt{2\\sigma^2}}\\right) = P\\left(S > \\frac{\\sigma^2}{\\sqrt{2\\sigma^2}}\\right) = P\\left(S > \\frac{\\sigma}{\\sqrt{2}}\\right)\n$$\n使用标准正态累积分布函数 $\\Phi(\\cdot)$，这个概率是 $1 - \\Phi(\\sigma/\\sqrt{2}) = \\Phi(-\\sigma/\\sqrt{2})$。\n\n第一个积分是 $\\int_{-\\infty}^{0} \\exp(x) f_{\\Delta Z}(x) \\, dx$。令 $X = \\Delta Z \\sim \\mathcal{N}(\\mu, v)$，其中 $\\mu = -\\sigma^2$ 且 $v = 2\\sigma^2$。该积分是 $\\mathbb{E}[\\exp(X) I(X \\le 0)]$。\n我们知道，对于一个正态分布的变量 $X$，有 $\\exp(x) f_X(x) = \\exp(\\mu + v/2) f_Y(x)$，其中 $Y \\sim \\mathcal{N}(\\mu+v, v)$。\n我们来计算前置因子 $\\exp(\\mu + v/2)$：\n$$\n\\exp\\left(-\\sigma^2 + \\frac{2\\sigma^2}{2}\\right) = \\exp(-\\sigma^2 + \\sigma^2) = \\exp(0) = 1\n$$\n新的均值是 $\\mu+v = -\\sigma^2 + 2\\sigma^2 = \\sigma^2$。所以 $Y \\sim \\mathcal{N}(\\sigma^2, 2\\sigma^2)$。\n第一个积分变为：\n$$\n\\int_{-\\infty}^{0} 1 \\cdot f_Y(x) \\, dx = P(Y \\le 0) = P\\left(\\frac{Y - \\sigma^2}{\\sqrt{2\\sigma^2}} \\le \\frac{0 - \\sigma^2}{\\sqrt{2\\sigma^2}}\\right)\n$$\n$$\n= P\\left(S \\le -\\frac{\\sigma^2}{\\sqrt{2\\sigma^2}}\\right) = P\\left(S \\le -\\frac{\\sigma}{\\sqrt{2}}\\right) = \\Phi\\left(-\\frac{\\sigma}{\\sqrt{2}}\\right)\n$$\n\n结合这两个结果：\n$$\n\\mathbb{E}[\\alpha] = \\Phi\\left(-\\frac{\\sigma}{\\sqrt{2}}\\right) + \\Phi\\left(-\\frac{\\sigma}{\\sqrt{2}}\\right) = 2\\Phi\\left(-\\frac{\\sigma}{\\sqrt{2}}\\right)\n$$\n按要求将其表示为 $\\sigma^2$ 的函数：\n$$\n\\mathbb{E}[\\alpha] = 2\\Phi\\left(-\\sqrt{\\frac{\\sigma^2}{2}}\\right)\n$$\n\n平均接受概率 $\\mathbb{E}[\\alpha]$ 是噪声方差 $\\sigma^2$ 的一个单调递减函数。当 $\\sigma^2 \\to 0$ 时，$\\Phi$ 的自变量趋于 $0$，所以 $\\mathbb{E}[\\alpha] \\to 2\\Phi(0) = 2(1/2) = 1$，这对应于没有估计噪声的情况。当 $\\sigma^2 \\to \\infty$ 时，自变量趋于 $-\\infty$，所以 $\\mathbb{E}[\\alpha] \\to 2\\Phi(-\\infty) = 0$，这意味着对于噪声非常大的似然估计，接受率会趋近于零。", "answer": "$$\n\\boxed{2\\Phi\\left(-\\sqrt{\\frac{\\sigma^2}{2}}\\right)}\n$$", "id": "3327363"}, {"introduction": "在建立了粒子滤波器方差与MCMC效率之间的理论联系之后，一个至关重要的实践问题是如何选择粒子数 $N$。这项练习 [@problem_id:3327322] 让你像从业者一样思考，识别出统计上合理的校准方法。正确地校准 $N$ 以达到期望的估计量方差水平，是设计高效PMMH采样器的关键一步。", "problem": "考虑一个潜状态空间模型，其潜路径为 $\\{x_{t}\\}_{t=1}^{T}$，观测值为 $\\{y_{t}\\}_{t=1}^{T}$，参数为 $\\theta \\in \\Theta$。令 $Z(\\theta) = p(y_{1:T} \\mid \\theta)$ 表示边际似然。在粒子边际Metropolis-Hastings (PMMH) 算法中，一种利用粒子滤波器 (PF) 的马尔可夫链蒙特卡洛 (MCMC) 变体，人们用一个由包含 $N$ 个粒子的序贯蒙特卡洛 (SMC) 方法产生的无偏估计量 $\\hat{Z}_{N}(\\theta)$ 来替代 $Z(\\theta)$。在伪边际理论中已经明确，PMMH 的效率取决于对数似然估计量噪声的方差。一个常见的校准目标是选择 $N$，使得对于用户指定的目标 $\\sigma^{2}_{\\star} > 0$，有 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)] \\approx \\sigma^{2}_{\\star}$。\n\n根据无偏估计的基本定义和粒子近似的中心极限定理 (CLT)，我们知道对于固定的 $\\theta$ 和 $T$，当 $N \\to \\infty$ 时，$\\log \\hat{Z}_{N}(\\theta)$ 的分布会集中，其方差通常以 $1/N$ 的量级衰减。你的任务是找出科学上合理的方法，以 (i) 通过目标 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)] \\approx \\sigma^{2}_{\\star}$ 来选择 $N$，以及 (ii) 使用引导计算或独立的粒子滤波器重复实验来估计 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)]$，同时要遵守 PMMH 链最终必须在固定的 $N$ 下运行的要求。\n\n下列哪些程序是满足目标方差要求并从引导运行或独立粒子滤波器重复实验中估计方差的有效且合理的方法？\n\nA. 固定一个代表性的参数值 $\\theta_{\\mathrm{ref}}$（例如，后验众数近似或初步优化得到的最大似然估计）。对于一组粒子数 $\\{N_{j}\\}_{j=1}^{J}$，对每个 $N_{j}$，在 $\\theta_{\\mathrm{ref}}$ 处运行 $R$ 次独立的 PF 重复实验，以获得独立抽样 $\\{\\log \\hat{Z}_{N_{j}}^{(r)}(\\theta_{\\mathrm{ref}})\\}_{r=1}^{R}$。对每个 $N_{j}$，计算这 $R$ 个值的样本方差 $s^{2}_{N_{j}}$。通过将 $s^{2}_{N_{j}}$ 对 $1/N_{j}$ 进行回归来拟合关系 $s^{2}_{N_{j}} \\approx c(\\theta_{\\mathrm{ref}})/N_{j}$，以估计 $c(\\theta_{\\mathrm{ref}})$。选择 $N_{\\star} = \\lceil c(\\theta_{\\mathrm{ref}})/\\sigma^{2}_{\\star} \\rceil$ 并将此固定的 $N_{\\star}$ 用于主 PMMH 运行。\n\nB. 使用一个临时的 $N_{0}$ 和固定的提议分布运行一个简短的引导 PMMH。在引导过程中的每个访问过的 $\\theta_{t}$ 处，生成 $K \\ge 2$ 次独立的 PF 重复实验，以获得 $\\{\\log \\hat{Z}_{N_{0}}^{(k)}(\\theta_{t})\\}_{k=1}^{K}$ 并计算每次迭代的样本方差 $\\hat{v}_{t}$。将这些方差在引导路径上取平均，以估计整个后验区域的典型方差，$\\bar{v} = \\frac{1}{T_{\\mathrm{pilot}}}\\sum_{t=1}^{T_{\\mathrm{pilot}}} \\hat{v}_{t}$。设置 $N_{\\star} = \\left\\lceil N_{0} \\, \\bar{v} / \\sigma^{2}_{\\star} \\right\\rceil$，然后在生产性 PMMH 中固定使用 $N_{\\star}$。\n\nC. 对于在选定的 $N$ 下的单次 PF 运行，记录增量对数权重，并计算这些增量在所有粒子和时间上的滤波器内样本方差，以此作为 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)]$ 的单次运行代理。调整 $N$ 使此单次运行代理在数值上匹配 $\\sigma^{2}_{\\star}$，而不使用任何独立的 PF 重复实验。\n\nD. 从一个小的 $N$ 开始运行 PMMH，并在链的运行过程中自适应地增加或减少 $N$，以将平均接受率目标设定在约 $0.234$。在整个主 PMMH 运行过程中持续动态调整 $N$，以将接受率稳定在 $0.234$ 附近。\n\nE. 对于给定的 $N$，从单次运行中计算每个时间步的粒子滤波器的有效样本量 (ESS)，并选择足够大的 $N$，使得所有时间步中的最小 ESS 超过 $N$ 的一个固定比例（例如，至少 $0.5 N$）。断定这能保证 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)] \\approx \\sigma^{2}_{\\star}$，并使用得到的 $N$ 继续进行。\n\n选择所有适用项。", "solution": "问题陈述在科学上是合理的、提法恰当且客观的。它准确地描述了粒子边际Metropolis-Hastings (PMMH) 算法的设置以及校准粒子数 N 的挑战。核心概念——通过粒子滤波器 (PF) 进行无偏似然估计、由此产生的 PMMH 算法，以及对数似然估计量的方差与 MCMC 效率之间的关系——在计算统计学领域都是标准且正确的。方差的渐近衰减率 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)] \\propto 1/N$ 是一个已知的理论结果。该问题是有效的。\n\n核心任务是找到一种有原则的方法来选择一个固定的粒子数 $N$，使得对数似然估计量的方差 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)]$ 约等于目标值 $\\sigma^2_{\\star}$。对数似然估计 $\\log \\hat{Z}_{N}(\\theta)$ 是一个随机变量，其随机性来自粒子滤波器的蒙特卡洛过程。要估计任何随机变量的方差，一个基本的统计要求是获取该变量的多个独立样本。因此，任何有效程序都必须涉及对给定的参数值 $\\theta$ 多次独立运行粒子滤波器。让这些独立的估计量表示为 $\\{\\hat{Z}_{N}^{(r)}(\\theta)\\}_{r=1}^R$。然后可以使用对数转换后的值 $\\{\\log \\hat{Z}_{N}^{(r)}(\\theta)\\}_{r=1}^R$ 的样本方差来估计方差。\n\n另一个关键原则是当 $N$ 较大时的渐近关系 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)] \\approx c(\\theta)/N$，其中 $c(\\theta)$ 是一个取决于参数 $\\theta$ 和模型结构但与 $N$ 无关的常数。这个标度律允许人们从用 $N_0$ 个粒子进行的引导运行中获得的方差估计，外推到为达到目标方差 $\\sigma^2_{\\star}$ 所需的粒子数 $N_{\\star}$：\n$$ \\sigma^2_{\\star} \\approx \\operatorname{Var}[\\log \\hat{Z}_{N_{\\star}}(\\theta)] \\approx \\frac{c(\\theta)}{N_{\\star}} $$\n如果我们从一个有 $N_0$ 个粒子的引导运行中得到了方差的估计值 $v_{N_0} \\approx \\operatorname{Var}[\\log \\hat{Z}_{N_0}(\\theta)]$，我们可以写出 $v_{N_0} \\approx c(\\theta)/N_0$。结合这些可以得到选择 $N_{\\star}$ 的规则：\n$$ \\frac{\\sigma^2_{\\star}}{v_{N_0}} \\approx \\frac{N_0}{N_{\\star}} \\implies N_{\\star} \\approx N_0 \\frac{v_{N_0}}{\\sigma^2_{\\star}} $$\n最后，为了让 PMMH 算法能够正确地以目标后验分布 $p(\\theta \\mid y_{1:T})$ 为目标，在整个主 MCMC 运行期间，粒子数 $N$ 必须是固定的。任何对 $N$ 的自适应调整都必须限制在初步的引导或调优阶段。\n\n我们现在根据这些原则来评估每个选项。\n\nA. 此程序在统计上是合理的，并遵循了已建立的最佳实践。\n1. 它正确地认识到，要估计 $\\operatorname{Var}[\\log \\hat{Z}_{N_{j}}(\\theta_{\\mathrm{ref}})]$，必须生成估计量的多个独立实现，这是通过运行 $R$ 次独立的 PF 重复实验来实现的。\n2. 它使用这些重复实验来计算样本方差 $s^{2}_{N_{j}}$，这是真实方差的一个有效估计量。\n3. 它通过使用一组粒子数 $\\{N_j\\}$ 并拟合理论关系 $s^{2}_{N_j} \\approx c(\\theta_{\\mathrm{ref}})/N_{j}$ 来稳健地估计标度常数 $c(\\theta_{\\mathrm{ref}})$。这比依赖于单个配对 $(N_j, s^2_{N_j})$ 更稳定。\n4. 它使用这个估计的关系来求解应能达到目标方差 $\\sigma^2_{\\star}$ 的粒子数 $N_{\\star}$，即 $N_{\\star} = \\lceil c(\\theta_{\\mathrm{ref}})/\\sigma^{2}_{\\star} \\rceil$。\n5. 它正确地规定了这个值 $N_{\\star}$ 在主 PMMH 运行中是固定的，从而确保了最终 MCMC 链的有效性。\n使用一个代表性参数 $\\theta_{\\mathrm{ref}}$ 来执行此校准是一个实际的选择，前提是方差在后验高密度区域内不会发生剧烈变化。\n结论：**正确**。\n\nB. 此程序在统计上也是合理的，并且是 A 中方法的一个更复杂的版本。\n1. 和 A 一样，它在每个参数值 $\\theta_t$ 处正确地使用 $K \\ge 2$ 次独立的 PF 重复实验来获得方差的有效估计 $\\hat{v}_t = \\operatorname{Var}[\\log \\hat{Z}_{N_0}(\\theta_t)]$。\n2. 它不是使用单个点估计 $\\theta_{\\mathrm{ref}}$，而是运行一个引导 PMMH 链来探索后验概率高的区域。这是有利的，因为估计量的方差可能依赖于参数。通过对引导链访问的状态 $\\{\\theta_t\\}$ 上的方差估计 $\\hat{v}_t$ 进行平均，它计算出一个估计值 $\\bar{v}$，该值代表了在典型 PMMH 运行中遇到的方差。\n3. 然后，它使用标度律来确定目标粒子数：$N_{\\star} = \\lceil N_{0} \\, \\bar{v} / \\sigma^{2}_{\\star} \\rceil$。这是对上述外推公式的直接应用。\n4. 关键是，它规定此校准是在引导阶段完成的，并且所得到的 $N_{\\star}$ 在生产性运行中是固定的，从而保持了 PMMH 算法的有效性。\n结论：**正确**。\n\nC. 此程序存在根本性缺陷。它建议从单次粒子滤波器运行中估计 $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)]$。我们感兴趣的量 $\\log \\hat{Z}_{N}(\\theta)$ 是 PF 一次完整运行的单个标量输出。无法从单个样本中估计随机变量的方差。“增量对数权重的滤波器内样本方差”是衡量滤波器*内部*不同时间步粒子多样性的一个指标。虽然它与滤波器的性能有关，但它与*跨独立运行*的最终对数似然估计的方差是不同的量。此程序混淆了这两个截然不同的概念，因此违反了估计方差的基本统计原则。\n结论：**不正确**。\n\nD. 此程序因两个关键原因而无效。首先，0.234 的目标接受率是在特定、理想化条件下（高维高斯目标）为随机游走 Metropolis-Hastings 导出的，通常不适用于 PMMH。PMMH 的最优接受率是对数似然估计量方差的函数，并且通常较低。其次，也是更重要的一点，它建议“在整个主 PMMH 运行过程中持续动态调整 N”。这违反了 PMMH 算法作为有效伪边际方案的条件。一个依赖于链历史的自适应 N 意味着转移核不是平稳的，并且不满足关于目标后验分布的细致平衡条件。由此产生的链将不会从正确的后验分布中抽样。这直接与问题的约束和 PMMH 的理论要求相矛盾。\n结论：**不正确**。\n\nE. 此程序使用的启发式方法不足以实现所述目标。有效样本量 (ESS) 是用于诊断单次 PF 运行中粒子退化的有用指标。低 ESS 确实与似然估计量的高方差相关。因此，确保 ESS 不会崩溃是必要的健全性检查。然而，没有直接的、通用的映射可以保证特定的 ESS 阈值（例如 $0.5N$）对应于特定的目标方差 $\\sigma^2_{\\star}$。这种关系是依赖于模型的并且是复杂的。此方法充其量提供了一个粗略的经验法则，而不是一个用于将 $N$ 校准到特定数值方差目标的有原则的程序。关于保持某个 ESS 就“保证” $\\operatorname{Var}[\\log \\hat{Z}_{N}(\\theta)] \\approx \\sigma^{2}_{\\star}$ 的结论是一个未经证实的夸大之词。与 C 一样，它不恰当地依赖于单次运行的诊断来对一个只能通过多次独立运行才能估计的属性（方差）做出定量声明。\n结论：**不正确**。", "answer": "$$\\boxed{AB}$$", "id": "3327322"}]}